{"hands_on_practices": [{"introduction": "温控元动力学（Well-Tempered Metadynamics, WTMetaD）是一种强大的增强抽样技术，用于加速跨越能量垒的稀有事件。本练习将带您深入该方法的核心机制，通过推导自适应偏置势如何收敛，以及这种收敛如何量化地加速垒穿越过程[@problem_id:3305295]。完成此练习将使您深刻理解偏置沉积规则与最终形成的有效自由能形貌之间的内在联系。", "problem": "考虑一个经典系统，其微观坐标为 $\\mathbf{x}$，在正则系综中以温度 $T$ 演化，势能为 $U(\\mathbf{x})$。令 $\\xi(\\mathbf{x})$ 是一个可微的集体变量。沿 $\\xi$ 的无偏置平衡边际分布为 $P_{0}(\\xi) \\propto \\int \\mathrm{d}\\mathbf{x}\\,\\delta\\!\\left(\\xi-\\xi(\\mathbf{x})\\right)\\exp\\!\\left[-\\beta U(\\mathbf{x})\\right]$，其中 $\\beta = 1/(k_{B}T)$ 且 $k_{B}$ 是玻尔兹曼常数。定义沿 $\\xi$ 的自由能为 $F(\\xi) = -\\beta^{-1}\\ln P_{0}(\\xi) + C$，其中 $C$ 是一个任意常数。\n\n现在应用适温元动力学（WTMetaD），即一个依赖于历史的偏置势 $V(\\xi,t)$，通过在瞬时 $\\xi(t)$ 处沉积一个核函数来更新，其振幅由 $\\exp\\!\\left[-V(\\xi(t),t)/(k_{B}\\Delta T)\\right]$ 调节，其中 $\\Delta T0$ 是一个可调参数，偏置因子为 $\\gamma = (T+\\Delta T)/T$。假设核函数是窄且归一化的，因此在长时间极限下，对于任何固定的 $\\xi$，其平均沉积速率与在偏置动力学下 $\\exp\\!\\left[-V(\\xi(\\mathbf{x}),t)/(k_{B}\\Delta T)\\right]\\delta\\!\\left(\\xi-\\xi(\\mathbf{x})\\right)$ 的稳态期望成正比。在渐近的长时程下，假设偏置收敛到一个与时间无关的极限 $V_{\\infty}(\\xi)$，并且在偏置动力学下沿 $\\xi$ 的边际分布为 $P_{\\infty}(\\xi) \\propto \\exp\\!\\left[-\\beta\\left(F(\\xi)+V_{\\infty}(\\xi)\\right)\\right]$。施加平稳性条件，即关于 $\\xi$ 的平均沉积速率变得与 $\\xi$ 无关。\n\n(a) 仅从这些定义和条件出发，推导渐近偏置 $V_{\\infty}(\\xi)$ 和自由能 $F(\\xi)$ 之间的函数关系，结果可相差一个加性常数。\n\n(b) 令 $\\Delta F$ 表示沿 $\\xi$ 的两个亚稳态盆地之间的无偏置自由能垒。利用过阻尼区域中 Kramers 越垒速率的 Arrhenius 型势垒依赖关系，并假设 WTMetaD 通过有效自由能 $F(\\xi)+V_{\\infty}(\\xi)$ 来改变势垒高度，同时保持动力学前因子不变，计算加速因子 $\\alpha$（偏置速率与无偏置速率之比），用 $\\beta$、$\\Delta F$ 和 $\\gamma$ 表示。\n\n你的最终答案必须以一个包含两个条目的单行矩阵形式给出，使用 LaTeX 的 $\\mathrm{pmatrix}$ 环境：第一个条目是 $V_{\\infty}(\\xi)$ 的闭式表达式（按照惯例将无关的加性常数设为零），第二个条目是加速因子 $\\alpha$ 的闭式表达式。不需要进行数值计算，最终答案中也不应报告单位。", "solution": "此问题被认为是有效的，因为它科学地基于统计力学和增强采样方法的原理，是适定的、客观的且内部一致的。\n\n部分 (a)：渐近偏置势 $V_{\\infty}(\\xi)$ 的推导。\n\n问题陈述，在适温元动力学（WTMetaD）方案中，依赖于历史的偏置势 $V(\\xi,t)$ 以一个被调节的沉积速率进行更新。给定在长时间极限下（$t \\to \\infty$），在集体变量 $\\xi$ 的一个固定值处的平均沉积速率与调节因子乘以指定位置的狄拉克δ函数的稳态期望成正比。让我们将渐近平均沉积速率表示为 $R_{\\infty}(\\xi)$。偏置势收敛到一个与时间无关的极限 $V_{\\infty}(\\xi)$。\n\n稳态期望是相对于偏置正则系综计算的，该系综由势能 $U(\\mathbf{x}) + V_{\\infty}(\\xi(\\mathbf{x}))$ 表征。一个可观测量 $A(\\mathbf{x})$ 的期望值为 $\\langle A(\\mathbf{x}) \\rangle_{V_{\\infty}}$。\n根据问题陈述，沉积速率与以下表达式成正比：\n$$R_{\\infty}(\\xi) \\propto \\left\\langle \\exp\\left[-\\frac{V(\\xi(\\mathbf{x}),t)}{k_{B}\\Delta T}\\right] \\delta\\left(\\xi-\\xi(\\mathbf{x})\\right) \\right\\rangle_{V_{\\infty}}$$\n在渐近极限下，$V(\\xi(\\mathbf{x}),t) \\to V_{\\infty}(\\xi(\\mathbf{x}))$。表达式变为：\n$$R_{\\infty}(\\xi) \\propto \\left\\langle \\exp\\left[-\\frac{V_{\\infty}(\\xi(\\mathbf{x}))}{k_{B}\\Delta T}\\right] \\delta\\left(\\xi-\\xi(\\mathbf{x})\\right) \\right\\rangle_{V_{\\infty}}$$\n狄拉克δ函数 $\\delta\\left(\\xi-\\xi(\\mathbf{x})\\right)$ 迫使 $\\xi(\\mathbf{x})$ 等于 $\\xi$。因此，在期望积分内部，项 $\\exp\\left[-V_{\\infty}(\\xi(\\mathbf{x}))/(k_{B}\\Delta T)\\right]$ 可以被替换为 $\\exp\\left[-V_{\\infty}(\\xi)/(k_{B}\\Delta T)\\right]$。由于此项不再依赖于积分变量 $\\mathbf{x}$，它可以从期望中提出来：\n$$R_{\\infty}(\\xi) \\propto \\exp\\left[-\\frac{V_{\\infty}(\\xi)}{k_{B}\\Delta T}\\right] \\left\\langle \\delta\\left(\\xi-\\xi(\\mathbf{x})\\right) \\right\\rangle_{V_{\\infty}}$$\n项 $\\left\\langle \\delta\\left(\\xi-\\xi(\\mathbf{x})\\right) \\right\\rangle_{V_{\\infty}}$ 根据定义是在偏置动力学下集体变量 $\\xi$ 的边际概率密度，我们将其表示为 $P_{\\infty}(\\xi)$。\n$$P_{\\infty}(\\xi) = \\left\\langle \\delta\\left(\\xi-\\xi(\\mathbf{x})\\right) \\right\\rangle_{V_{\\infty}} = \\frac{\\int \\mathrm{d}\\mathbf{x}\\,\\delta\\!\\left(\\xi-\\xi(\\mathbf{x})\\right)\\exp\\!\\left[-\\beta \\left(U(\\mathbf{x})+V_{\\infty}(\\xi(\\mathbf{x}))\\right)\\right]}{\\int \\mathrm{d}\\mathbf{x}\\,\\exp\\!\\left[-\\beta \\left(U(\\mathbf{x})+V_{\\infty}(\\xi(\\mathbf{x}))\\right)\\right]}$$\n因此，渐近沉积速率与调节因子和偏置概率密度的乘积成正比：\n$$R_{\\infty}(\\xi) \\propto \\exp\\left[-\\frac{V_{\\infty}(\\xi)}{k_{B}\\Delta T}\\right] P_{\\infty}(\\xi)$$\n问题施加了一个平稳性条件：在长时间极限下，沉积速率 $R_{\\infty}(\\xi)$ 变得与 $\\xi$ 无关。我们将其设为一个常数 $K$。\n$$K = \\text{const} \\cdot \\exp\\left[-\\frac{V_{\\infty}(\\xi)}{k_{B}\\Delta T}\\right] P_{\\infty}(\\xi)$$\n这意味着乘积本身必须是常数：\n$$\\exp\\left[-\\frac{V_{\\infty}(\\xi)}{k_{B}\\Delta T}\\right] P_{\\infty}(\\xi) = \\text{constant}$$\n问题还提供了偏置边际分布 $P_{\\infty}(\\xi)$ 与自由能 $F(\\xi)$ 之间的关系：\n$$P_{\\infty}(\\xi) \\propto \\exp\\left[-\\beta\\left(F(\\xi)+V_{\\infty}(\\xi)\\right)\\right]$$\n将此代入平稳性方程：\n$$\\exp\\left[-\\frac{V_{\\infty}(\\xi)}{k_{B}\\Delta T}\\right] \\exp\\left[-\\beta\\left(F(\\xi)+V_{\\infty}(\\xi)\\right)\\right] = \\text{constant}$$\n合并指数项得到：\n$$\\exp\\left[-\\frac{V_{\\infty}(\\xi)}{k_{B}\\Delta T} - \\beta F(\\xi) - \\beta V_{\\infty}(\\xi)\\right] = \\text{constant}$$\n对两边取自然对数：\n$$-\\frac{V_{\\infty}(\\xi)}{k_{B}\\Delta T} - \\beta F(\\xi) - \\beta V_{\\infty}(\\xi) = \\text{constant}$$\n我们求解 $V_{\\infty}(\\xi)$，用 $F(\\xi)$ 来表示。令 $\\beta = 1/(k_B T)$。\n$$-V_{\\infty}(\\xi) \\left(\\frac{1}{k_{B}\\Delta T} + \\frac{1}{k_{B}T}\\right) = \\frac{1}{k_{B}T} F(\\xi) + \\text{constant}$$\n$$-V_{\\infty}(\\xi) \\left(\\frac{T+\\Delta T}{k_{B}T\\Delta T}\\right) = \\frac{1}{k_{B}T} F(\\xi) + \\text{constant}$$\n$$V_{\\infty}(\\xi) = -\\left(\\frac{k_{B}T\\Delta T}{T+\\Delta T}\\right)\\left(\\frac{1}{k_{B}T} F(\\xi) + \\text{constant}'\\right)$$\n$$V_{\\infty}(\\xi) = -\\frac{\\Delta T}{T+\\Delta T} F(\\xi) + \\text{constant}''$$\n偏置因子给定为 $\\gamma = (T+\\Delta T)/T$。由此，我们可以用 $\\gamma$ 来表示前因子：\n$$\\gamma - 1 = \\frac{T+\\Delta T}{T} - 1 = \\frac{\\Delta T}{T}$$\n前因子是 $\\frac{\\Delta T}{T+\\Delta T} = \\frac{\\Delta T/T}{(T+\\Delta T)/T} = \\frac{\\gamma-1}{\\gamma}$。\n所以，关系式为：\n$$V_{\\infty}(\\xi) = -\\frac{\\gamma - 1}{\\gamma} F(\\xi) + \\text{constant}''$$\n按照惯例将任意加性常数设为零，我们得到部分 (a) 的最终表达式：\n$$V_{\\infty}(\\xi) = -\\frac{\\gamma-1}{\\gamma} F(\\xi)$$\n\n部分 (b)：加速因子 $\\alpha$ 的计算。\n\n问题陈述，越垒速率遵循关于自由能垒 $\\Delta F$ 的 Arrhenius 型依赖关系。对于无偏置系统，速率 $k_{\\text{unbiased}}$ 为：\n$$k_{\\text{unbiased}} = A \\exp(-\\beta \\Delta F)$$\n其中 $A$ 是一个动力学前因子。\n\n在 WTMetaD 中，系统在有效自由能 $F_{\\text{eff}}(\\xi) = F(\\xi) + V_{\\infty}(\\xi)$ 下演化。使用部分 (a) 的结果：\n$$F_{\\text{eff}}(\\xi) = F(\\xi) - \\frac{\\gamma-1}{\\gamma}F(\\xi) = \\left(1 - \\frac{\\gamma-1}{\\gamma}\\right)F(\\xi) = \\frac{1}{\\gamma}F(\\xi)$$\n这表明有效自由能景观是原始自由能景观的一个缩放版本。如果两个盆地之间的原始自由能垒是 $\\Delta F = F_{\\text{max}} - F_{\\text{min}}$，那么新的有效势垒 $\\Delta F_{\\text{eff}}$ 是：\n$$\\Delta F_{\\text{eff}} = F_{\\text{eff,max}} - F_{\\text{eff,min}} = \\frac{1}{\\gamma}F_{\\text{max}} - \\frac{1}{\\gamma}F_{\\text{min}} = \\frac{1}{\\gamma}\\Delta F$$\n偏置速率 $k_{\\text{biased}}$ 由此有效势垒决定。问题假设前因子 $A$ 保持不变。\n$$k_{\\text{biased}} = A \\exp(-\\beta \\Delta F_{\\text{eff}}) = A \\exp\\left(-\\frac{\\beta \\Delta F}{\\gamma}\\right)$$\n加速因子 $\\alpha$ 是偏置速率与无偏置速率之比：\n$$\\alpha = \\frac{k_{\\text{biased}}}{k_{\\text{unbiased}}} = \\frac{A \\exp\\left(-\\frac{\\beta \\Delta F}{\\gamma}\\right)}{A \\exp(-\\beta \\Delta F)}$$\n$$\\alpha = \\exp\\left(-\\frac{\\beta \\Delta F}{\\gamma} + \\beta \\Delta F\\right) = \\exp\\left[\\beta \\Delta F \\left(1 - \\frac{1}{\\gamma}\\right)\\right]$$\n这可以写成：\n$$\\alpha = \\exp\\left[\\beta \\Delta F \\left(\\frac{\\gamma-1}{\\gamma}\\right)\\right]$$\n这是部分 (b) 的最终表达式。", "answer": "$$\\boxed{\\begin{pmatrix} -\\frac{\\gamma-1}{\\gamma} F(\\xi)  \\exp\\left[\\beta \\Delta F \\left(\\frac{\\gamma - 1}{\\gamma}\\right)\\right] \\end{pmatrix}}$$", "id": "3305295"}, {"introduction": "王-兰道（Wang-Landau）抽样是一种直接计算系统状态密度的经典算法。在实际应用中，一个关键问题是：我们如何判断模拟已经进行了足够长的时间，结果已经收敛？本练习旨在建立一个严谨的定量工具来回答此问题，它将马尔可夫链的光谱间隙这一抽象理论概念与能量直方图的平坦度这一具体可观测量联系起来，从而弥合了抽象理论与模拟实践分析之间的鸿沟[@problem_id:3305336]。", "problem": "考虑一个系统的王-朗道采样 (WLS)，该系统具有一个离散的能量网格，包含 $m$ 个格子，索引为 $i \\in \\{1,\\dots,m\\}$。当前态密度的估计为 $g(i)$，而（未知的）真实态密度为 $g_{\\mathrm{true}}(i)$。在当前 $g$ 下，能量上的诱导目标分布为 $\\pi_{g}(i) \\propto g_{\\mathrm{true}}(i)/g(i)$，并归一化使得 $\\sum_{i=1}^{m} \\pi_{g}(i) = 1$。假设在能量格子上采用对称的最近邻提议和 Metropolis–Hastings 接受准则，并且我们通过在每一步增加 $1/2$ 的停留概率来使生成的马尔可夫链变得懒惰，以消除周期性。令 $P_{g}$ 表示这个懒惰转移矩阵，它关于 $\\pi_{g}$ 是可逆的，并且其特征值为 $1=\\lambda_{1}  \\lambda_{2} \\ge \\dots \\ge \\lambda_{m} \\ge 0$。定义谱隙为 $\\gamma = 1 - \\lambda_{2}$。\n\n假设该链从 $\\pi_{g}$ 下的平稳状态开始，运行 $n$ 步，产生能量直方图计数 $N_{i}$，$i=1,\\dots,m$。定义均方根 (RMS) 平坦度度量\n$$\nR \\;=\\; \\sqrt{\\frac{1}{m}\\sum_{i=1}^{m}\\left(\\frac{N_{i}}{n} - \\frac{1}{m}\\right)^{2}}.\n$$\n令 $S_{2} \\equiv \\sum_{i=1}^{m} \\pi_{g}(i)^{2}$ 表示 $\\pi_{g}$ 的二阶矩。\n\n仅从马尔可夫链的可逆性、谱隙和平稳性的基本定义，以及经过充分检验的谱性质（在 $L^{2}(\\pi_{g})$ 中的正交特征分解和懒惰链所有特征值的非负性）出发，推导一个非渐近的、期望层面的诊断指标，该指标定量地将谱隙 $\\gamma$ 与直方图平坦度联系起来。具体来说，证明存在一个形如下式的无数据上界\n$$\n\\mathbb{E}[R] \\;\\le\\; \\varepsilon_{\\star}(\\gamma, m, n, S_{2})\n$$\n其中 $\\varepsilon_{\\star}(\\gamma, m, n, S_{2})$ 的显式闭式表达式仅依赖于 $\\gamma$、$m$、$n$ 和 $S_{2}$。\n\n你的任务是推导并给出 $\\varepsilon_{\\star}(\\gamma, m, n, S_{2})$ 的精确解析表达式。最终答案必须是单一的闭式表达式。如果在从 $\\mathbb{E}[R^{2}]$ 的界推导到 $\\mathbb{E}[R]$ 的界时选择取平方根，请使用一个对非负随机变量有效的一般不等式来证明你的步骤。\n\n请以单一闭式形式提供 $\\varepsilon_{\\star}(\\gamma, m, n, S_{2})$ 的显式公式作为最终答案。不需要进行数值评估，也不涉及单位。不要提供不等式；只提供右侧的表达式。", "solution": "目标是推导均方根 (RMS) 平坦度度量期望值 $\\mathbb{E}[R]$ 的一个非渐近上界 $\\varepsilon_{\\star}(\\gamma, m, n, S_{2})$，其中\n$$\nR = \\sqrt{\\frac{1}{m}\\sum_{i=1}^{m}\\left(\\frac{N_{i}}{n} - \\frac{1}{m}\\right)^{2}}\n$$\n样本数为 $n$，格子数为 $m$，$N_i$ 是第 $i$ 个格子的直方图计数。\n\n推导过程首先是找到度量平方的期望值 $\\mathbb{E}[R^2]$ 的一个界，然后将其与 $\\mathbb{E}[R]$ 联系起来。对于任意非负随机变量 $X$，针对凹函数 $f(x)=\\sqrt{x}$ 的琴生不等式表明 $\\mathbb{E}[\\sqrt{X}] \\le \\sqrt{\\mathbb{E}[X]}$。因此，$\\mathbb{E}[R] \\le \\sqrt{\\mathbb{E}[R^2]}$。我们的任务简化为找到 $\\mathbb{E}[R^2]$ 的一个上界。\n\n我们展开 $\\mathbb{E}[R^2]$ 的表达式：\n$$\n\\mathbb{E}[R^2] = \\mathbb{E}\\left[\\frac{1}{m}\\sum_{i=1}^{m}\\left(\\frac{N_{i}}{n} - \\frac{1}{m}\\right)^{2}\\right] = \\frac{1}{m}\\sum_{i=1}^{m} \\mathbb{E}\\left[\\left(\\frac{N_{i}}{n} - \\frac{1}{m}\\right)^{2}\\right]\n$$\n我们使用均方误差的标准分解，将其分解为方差和偏差的平方。对于和中的每一项，令 $\\hat{\\pi}_i = N_i/n$ 为第 $i$ 个格子的经验频率。\n$$\n\\mathbb{E}\\left[\\left(\\hat{\\pi}_i - \\frac{1}{m}\\right)^{2}\\right] = \\mathbb{E}\\left[\\left(\\hat{\\pi}_i - \\mathbb{E}[\\hat{\\pi}_i] + \\mathbb{E}[\\hat{\\pi}_i] - \\frac{1}{m}\\right)^{2}\\right] = \\text{Var}(\\hat{\\pi}_i) + \\left(\\mathbb{E}[\\hat{\\pi}_i] - \\frac{1}{m}\\right)^2\n$$\n交叉项消失，因为 $\\mathbb{E}[\\hat{\\pi}_i - \\mathbb{E}[\\hat{\\pi}_i]] = 0$。\n\n马尔可夫链从其平稳分布 $\\pi_g$ 开始。因此，在任何时间步 $t$，处于状态 $i$ 的概率是 $P(X_t=i) = \\pi_g(i)$。期望的直方图计数 $\\mathbb{E}[N_i]$ 为：\n$$\n\\mathbb{E}[N_i] = \\mathbb{E}\\left[\\sum_{t=0}^{n-1} \\mathbb{I}(X_t=i)\\right] = \\sum_{t=0}^{n-1} \\mathbb{E}[\\mathbb{I}(X_t=i)] = \\sum_{t=0}^{n-1} \\pi_g(i) = n\\pi_g(i)\n$$\n因此，$\\mathbb{E}[\\hat{\\pi}_i] = \\mathbb{E}[N_i/n] = \\pi_g(i)$。\n\n将此代入 $\\mathbb{E}[R^2]$ 的表达式中：\n$$\n\\mathbb{E}[R^2] = \\frac{1}{m}\\sum_{i=1}^{m} \\left( \\text{Var}\\left(\\frac{N_i}{n}\\right) + \\left(\\pi_g(i) - \\frac{1}{m}\\right)^2 \\right)\n$$\n这将界分为两部分：一个方差项，与采样效率有关；一个偏差项，与目标分布 $\\pi_g$ 偏离均匀分布 $1/m$ 的程度有关。\n\n我们首先分析偏差项：\n$$\n\\frac{1}{m}\\sum_{i=1}^{m} \\left(\\pi_g(i) - \\frac{1}{m}\\right)^2 = \\frac{1}{m} \\left( \\sum_{i=1}^{m}\\pi_g(i)^2 - \\frac{2}{m}\\sum_{i=1}^{m}\\pi_g(i) + \\sum_{i=1}^{m}\\frac{1}{m^2} \\right)\n$$\n使用定义 $S_2 = \\sum_{i=1}^{m} \\pi_g(i)^2$ 和归一化条件 $\\sum_{i=1}^{m} \\pi_g(i) = 1$，上式变为：\n$$\n\\frac{1}{m} \\left( S_2 - \\frac{2}{m} \\cdot 1 + m \\cdot \\frac{1}{m^2} \\right) = \\frac{S_2}{m} - \\frac{1}{m^2}\n$$\n现在，我们分析方差项 $\\frac{1}{m}\\sum_i \\text{Var}(\\frac{N_i}{n}) = \\frac{1}{mn^2}\\sum_i \\text{Var}(N_i)$。对于一个平稳马尔可夫链，$N_i = \\sum_{t=0}^{n-1} \\mathbb{I}(X_t=i)$ 的方差由下式给出：\n$$\n\\text{Var}(N_i) = n \\text{Var}_{\\pi_g}(\\mathbb{I}_i) + 2 \\sum_{k=1}^{n-1} (n-k) \\text{Cov}_{\\pi_g}(\\mathbb{I}_i(X_0), \\mathbb{I}_i(X_k))\n$$\n其中 $\\mathbb{I}_i$ 是状态 $i$ 的指示函数。该指示函数的方差为 $\\text{Var}_{\\pi_g}(\\mathbb{I}_i) = \\pi_g(i)(1-\\pi_g(i))$。\n自协方差项可以使用转移算子 $P_g$ 的谱性质来界定。对于一个可逆的马尔可夫链和任意可观测量 $f$，滞后 $k$ 的自协方差有如下界：\n$$\n\\text{Cov}_{\\pi_g}(f(X_0), f(X_k)) \\le \\lambda_2^k \\text{Var}_{\\pi_g}(f)\n$$\n其中 $\\lambda_2$ 是 $P_g$ 的第二大特征值。由于该链是懒惰的，所有特征值都是非负的，这使得该不等式成立。\n将此应用于 $f=\\mathbb{I}_i$：\n$$\n\\text{Var}(N_i) \\le n \\text{Var}_{\\pi_g}(\\mathbb{I}_i) + 2 \\sum_{k=1}^{n-1} (n-k) \\lambda_2^k \\text{Var}_{\\pi_g}(\\mathbb{I}_i) = \\text{Var}_{\\pi_g}(\\mathbb{I}_i) \\left( n + 2 \\sum_{k=1}^{n-1} (n-k) \\lambda_2^k \\right)\n$$\n为了得到一个简单的闭式界，我们对求和项进行界定：\n$$\n\\sum_{k=1}^{n-1} (n-k) \\lambda_2^k \\le \\sum_{k=1}^{n-1} n \\lambda_2^k = n \\sum_{k=1}^{n-1} \\lambda_2^k \\le n \\sum_{k=1}^{\\infty} \\lambda_2^k = n \\frac{\\lambda_2}{1-\\lambda_2}\n$$\n将此代回 $\\text{Var}(N_i)$ 的界中：\n$$\n\\text{Var}(N_i) \\le \\text{Var}_{\\pi_g}(\\mathbb{I}_i) \\left( n + 2n \\frac{\\lambda_2}{1-\\lambda_2} \\right) = n \\text{Var}_{\\pi_g}(\\mathbb{I}_i) \\left( 1 + \\frac{2\\lambda_2}{1-\\lambda_2} \\right) = n \\text{Var}_{\\pi_g}(\\mathbb{I}_i) \\frac{1+\\lambda_2}{1-\\lambda_2}\n$$\n现在我们对所有格子 $i$ 求和：\n$$\n\\sum_{i=1}^m \\text{Var}(N_i) \\le n \\left( \\sum_{i=1}^m \\text{Var}_{\\pi_g}(\\mathbb{I}_i) \\right) \\frac{1+\\lambda_2}{1-\\lambda_2}\n$$\n方差之和为 $\\sum_i \\pi_g(i)(1-\\pi_g(i)) = \\sum_i \\pi_g(i) - \\sum_i \\pi_g(i)^2 = 1-S_2$。\n谱隙为 $\\gamma = 1-\\lambda_2$，所以 $\\lambda_2 = 1-\\gamma$。该分数变为：\n$$\n\\frac{1+\\lambda_2}{1-\\lambda_2} = \\frac{1 + (1-\\gamma)}{1 - (1-\\gamma)} = \\frac{2-\\gamma}{\\gamma}\n$$\n因此，方差之和的界为：\n$$\n\\sum_{i=1}^m \\text{Var}(N_i) \\le n(1-S_2)\\frac{2-\\gamma}{\\gamma}\n$$\n现在我们整合得到 $\\mathbb{E}[R^2]$ 的最终界：\n$$\n\\mathbb{E}[R^2] \\le \\frac{1}{mn^2} \\left( n(1-S_2)\\frac{2-\\gamma}{\\gamma} \\right) + \\left( \\frac{S_2}{m} - \\frac{1}{m^2} \\right)\n$$\n$$\n\\mathbb{E}[R^2] \\le \\frac{(1-S_2)(2-\\gamma)}{mn\\gamma} + \\frac{S_2}{m} - \\frac{1}{m^2}\n$$\n最后，我们取平方根得到 $\\mathbb{E}[R]$ 的界。令 $\\varepsilon_{\\star}^2$ 为上述不等式的右侧。那么 $\\mathbb{E}[R] \\le \\sqrt{\\varepsilon_{\\star}^2} = \\varepsilon_{\\star}$。所求的表达式为：\n$$\n\\varepsilon_{\\star}(\\gamma, m, n, S_{2}) = \\sqrt{\\frac{(1-S_2)(2-\\gamma)}{mn\\gamma} + \\frac{S_2}{m} - \\frac{1}{m^2}}\n$$\n此表达式仅依赖于已声明的变量 $\\gamma$、$m$、$n$ 和 $S_2$，并代表了所要求的非渐近的、期望层面的诊断指标。", "answer": "$$\\boxed{\\sqrt{\\frac{(1-S_{2})(2-\\gamma)}{mn\\gamma} + \\frac{S_{2}}{m} - \\frac{1}{m^{2}}}}$$", "id": "3305336"}, {"introduction": "在计算模拟中，选择合适的增强抽样方法对研究效率至关重要。本练习将对两种基石性技术——基于王-兰道（Wang-Landau）的混合方案与伞形抽样（Umbrella Sampling）——进行直接比较[@problem_id:3305331]。通过推导一种方法优于另一种方法的临界条件，您将学会批判性地分析不同误差来源，包括有限采样的统计不确定性和偏置势不完全收敛带来的系统误差，这是计算科学家必须具备的一项核心技能。", "problem": "考虑一个复杂系统的一维集体变量 (CV) $s$，其处于逆温度 $\\beta = 1/(k_B T)$ 下，其中 $k_B$ 是玻尔兹曼常数，T 是绝对温度。$s$ 的正则概率密度为 $P_{\\beta}(s)$，相关的自由能（也称为平均力势）为 $F(s) = -k_B T \\ln P_{\\beta}(s) + C$，其中 $C$ 是一个无关紧要的常数。\n\n考虑两种增强采样策略来估计目标区间 $s^{\\star}$ 处的 $F(s)$：\n- 伞形采样 (US) 基于一组谐波偏置窗，通过统计最优估计量（如加权直方图分析方法）结合，产生一个有效的、近似无偏的计数 $H_{\\mathrm{US}}(s^{\\star})$，其均值为 $n_{\\mathrm{US}}$，在 $s^{\\star}$ 处的偏置可忽略不计，前提是假设有足够的重叠和正确的全局归一化。\n- 一种混合方案，首先在 CV 空间直接执行王-Landau (WL) 采样，通过自适应地更新偏置 $V_{\\mathrm{WL}}(s)$ 来使 $s$ 的直方图变得平坦，直到直方图达到平坦状态，然后通过对 WL 轨迹进行重加权来重建正则自由能，即使用权重为 $\\exp(\\beta V_{\\mathrm{WL}}(s))$ 的样本来获得估计量 $\\widehat{P}_{\\beta}(s)$，并因此得到 $\\widehat{F}(s)$。\n\n假设满足以下科学标准条件：\n1. CV 范围被离散化为 $B$ 个区间，对于长的采样时间，每个区间的直方图计数可以被建模为独立的泊松随机变量。对于平均计数为 $n$ 的区间，根据应用于平均值为 $n$ 的泊松随机变量的 delta 方法，对数计数的方差满足 $\\mathrm{Var}[\\ln H] \\approx 1/n$。\n2. 在 US 情况下，在 $s^{\\star}$ 处，有效计数为 $H_{\\mathrm{US}}(s^{\\star})$，平均值为 $n_{\\mathrm{US}}$，由于重叠和自洽归一化，$\\ln P_{\\beta}(s^{\\star})$ 中的估计量偏置可忽略不计。在推导出的方差水平上，相关性可以忽略。\n3. 在 WL-重加权情况下，WL 收敛后 $s$ 的直方图近似平坦，因此每个区间的 $H_{\\mathrm{WL}}(s)$ 平均值为 $n_{\\mathrm{WL}}$。用于重加权的 WL 偏置 $V_{\\mathrm{WL}}(s)$ 是不完美的：记为 $V_{\\mathrm{WL}}(s) = V^{\\star}(s) + \\epsilon(s)$，其中 $V^{\\star}(s)$ 是能够精确地使正则 $P_{\\beta}(s)$ 平坦的未知真实偏置，而 $\\epsilon(s)$ 是一个均值为零的小误差。将 $\\epsilon(s)$ 建模为与直方图计数无关，其方差为 $\\mathrm{Var}[\\epsilon(s^{\\star})] = \\sigma_{V}^{2}$。\n4. 忽略一阶上同等影响所有区间的全局归一化涨落，在 $s^{\\star}$ 处的 WL-重加权自由能估计量主要由来自 $H_{\\mathrm{WL}}(s^{\\star})$ 和 $V_{\\mathrm{WL}}(s^{\\star})$ 的局域贡献所决定。\n\n仅从上述定义和假设出发，并且不使用任何这些方法的现成方差公式，推导出一个阈值条件，在该条件下，WL-重加权混合方案在 $s^{\\star}$ 处的自由能估计的均方误差严格小于伞形采样。将您的最终结果表示为最大可容忍 WL 偏置误差方差 $\\sigma_{V,\\max}^{2}$ 的单个、封闭形式的解析表达式，该表达式是 $n_{\\mathrm{WL}}$、$n_{\\mathrm{US}}$、$k_B$ 和 $T$ 的函数，使得 WL-重加权估计量在 $s^{\\star}$ 处的方差不超过伞形采样的方差。\n\n您的答案必须是单一表达式。不需要进行数值计算。最终答案中不要包含任何单位。如果需要中间近似，请在推导过程中从第一性原理出发进行论证。", "solution": "用户希望找到一个阈值条件，在该条件下，混合的王-Landau (WL) 重加权方案比伞形采样 (US) 方案能更准确地估计在特定集体变量值 $s^{\\star}$ 处的自由能 $F(s)$。准确性由均方误差 (MSE) 来衡量。问题要求的是 WL 偏置势的最大可容忍方差 $\\sigma_{V,\\max}^{2}$，以使 WL 方法的方差不超过 US 方法的方差。\n\n让我们首先根据所提供的定义和假设，为每种方法的自由能估计建立均方误差 (MSE) 的表达式。自由能 $F(s)$ 通过 $F(s) = -k_B T \\ln P_{\\beta}(s) + C$ 与正则概率密度 $P_{\\beta}(s)$ 相关，其中 $\\beta = 1/(k_B T)$。对于真实值 $F(s^{\\star})$ 的估计量 $\\widehat{F}(s^{\\star})$，其 MSE 定义为 $\\mathrm{MSE} = E[(\\widehat{F}(s^{\\star}) - F(s^{\\star}))^2] = \\mathrm{Var}[\\widehat{F}(s^{\\star})] + (\\mathrm{Bias}[\\widehat{F}(s^{\\star})])^2$。\n\n首先，我们分析伞形采样 (US) 方法。\n自由能的估计量 $\\widehat{F}_{\\mathrm{US}}(s^{\\star})$ 是从有效直方图计数 $H_{\\mathrm{US}}(s^{\\star})$ 推导出来的。由于 $F(s) \\propto -\\ln P_{\\beta}(s)$ 且 $P_{\\beta}(s)$ 是根据计数 $H(s)$ 估计的，因此自由能的估计量形式为 $\\widehat{F}_{\\mathrm{US}}(s^{\\star}) \\approx -k_B T \\ln H_{\\mathrm{US}}(s^{\\star}) + C'$，其中 $C'$ 是一个常数。\n问题陈述，对于 US 方法，“$\\ln P_{\\beta}(s^{\\star})$ 中的估计量偏置可忽略不计”。这意味着 $\\widehat{F}_{\\mathrm{US}}(s^{\\star})$ 的偏置也是可忽略的。因此，MSE 主要由方差决定：\n$\\mathrm{MSE}_{\\mathrm{US}}(F(s^{\\star})) \\approx \\mathrm{Var}[\\widehat{F}_{\\mathrm{US}}(s^{\\star})]$。\n我们如下计算方差：\n$\\mathrm{Var}[\\widehat{F}_{\\mathrm{US}}(s^{\\star})] = \\mathrm{Var}[ -k_B T \\ln H_{\\mathrm{US}}(s^{\\star}) + C' ] = (-k_B T)^2 \\mathrm{Var}[\\ln H_{\\mathrm{US}}(s^{\\star})]$。\n假设 2 提供了对于平均计数为 $n$ 的区间，$\\mathrm{Var}[\\ln H] \\approx 1/n$。对于在 $s^{\\star}$ 处的 US 情况，平均计数给定为 $n_{\\mathrm{US}}$。\n因此，US 方法的 MSE 为：\n$$ \\mathrm{MSE}_{\\mathrm{US}}(F(s^{\\star})) \\approx (k_B T)^2 \\frac{1}{n_{\\mathrm{US}}} $$\n\n接下来，我们分析混合 WL-重加权方案。\n问题陈述，正则自由能是通过重加权来重建的。正则概率的估计量为 $\\widehat{P}_{\\beta}(s) \\propto H_{\\mathrm{WL}}(s) \\exp(\\beta V_{\\mathrm{WL}}(s))$，其中 $H_{\\mathrm{WL}}(s)$ 是来自 WL 模拟的区间 $s$ 中的计数，而 $V_{\\mathrm{WL}}(s)$ 是最终的 WL 偏置势。\n相应的自由能估计量为：\n$\\widehat{F}_{\\mathrm{WL}}(s) = -k_B T \\ln \\widehat{P}_{\\beta}(s) + C'' = -k_B T \\ln(H_{\\mathrm{WL}}(s)) - k_B T \\ln(\\exp(\\beta V_{\\mathrm{WL}}(s))) + \\text{const}$。\n使用 $\\beta = 1/(k_B T)$，这可以简化为：\n$\\widehat{F}_{\\mathrm{WL}}(s) = -V_{\\mathrm{WL}}(s) - k_B T \\ln H_{\\mathrm{WL}}(s) + \\text{const}$。\n根据问题陈述，此估计量的误差来自两个独立的来源：\n1. WL 偏置势中的残余误差，$\\epsilon(s) = V_{\\mathrm{WL}}(s) - V^{\\star}(s)$，其中 $V^{\\star}(s) = -F(s) + \\text{const}$ 是使能量景观平坦的真实势。这个误差是一个随机变量，其均值为 $E[\\epsilon(s^{\\star})] = 0$，方差为 $\\mathrm{Var}[\\epsilon(s^{\\star})] = \\sigma_{V}^{2}$。\n2. 直方图计数 $H_{\\mathrm{WL}}(s^{\\star})$ 的统计涨落，它是一个平均值为 $n_{\\mathrm{WL}}$ 的泊松随机变量。\n\n估计量 $\\widehat{F}_{\\mathrm{WL}}(s^{\\star})$ 的总方差是这两个独立来源的方差之和。我们还假设此估计量中的任何偏置都是 $1/n_{\\mathrm{WL}}$ 的高阶项，并且对于大样本可以忽略，这与 US 情况类似。因此，我们用方差来近似 MSE。\n$\\mathrm{MSE}_{\\mathrm{WL}}(F(s^{\\star})) \\approx \\mathrm{Var}[\\widehat{F}_{\\mathrm{WL}}(s^{\\star})] = \\mathrm{Var}[-V_{\\mathrm{WL}}(s^{\\star}) - k_B T \\ln H_{\\mathrm{WL}}(s^{\\star})]$。\n考虑到 $\\epsilon(s^{\\star})$（以及因此的 $V_{\\mathrm{WL}}(s^{\\star})$）和 $H_{\\mathrm{WL}}(s^{\\star})$ 的独立性：\n$\\mathrm{Var}[\\widehat{F}_{\\mathrm{WL}}(s^{\\star})] = \\mathrm{Var}[-V_{\\mathrm{WL}}(s^{\\star})] + \\mathrm{Var}[-k_B T \\ln H_{\\mathrm{WL}}(s^{\\star})]$。\n第一项是 $\\mathrm{Var}[-V_{\\mathrm{WL}}(s^{\\star})] = \\mathrm{Var}[-(V^{\\star}(s^{\\star}) + \\epsilon(s^{\\star}))] = \\mathrm{Var}[-\\epsilon(s^{\\star})] = \\mathrm{Var}[\\epsilon(s^{\\star})] = \\sigma_{V}^{2}$，因为 $V^{\\star}(s^{\\star})$ 是一个常数。\n第二项是 $(k_B T)^2 \\mathrm{Var}[\\ln H_{\\mathrm{WL}}(s^{\\star})]$。再次使用假设 2，并用 WL 直方图的平均计数 $n_{\\mathrm{WL}}$，该方差为 $(k_B T)^2 (1/n_{\\mathrm{WL}})$。\n结合这些项，WL-重加权方法的 MSE 为：\n$$ \\mathrm{MSE}_{\\mathrm{WL}}(F(s^{\\star})) \\approx \\sigma_{V}^{2} + (k_B T)^2 \\frac{1}{n_{\\mathrm{WL}}} $$\n\n问题要求的是 WL 方案严格更优的条件，即 $\\mathrm{MSE}_{\\mathrm{WL}}(F(s^{\\star}))  \\mathrm{MSE}_{\\mathrm{US}}(F(s^{\\star}))$。这个条件的阈值可以通过将两个 MSE 设为相等来找到。最大可容忍方差 $\\sigma_{V,\\max}^{2}$ 是在该阈值下 $\\sigma_{V}^{2}$ 的值。\n$ \\mathrm{MSE}_{\\mathrm{WL}}(F(s^{\\star})) = \\mathrm{MSE}_{\\mathrm{US}}(F(s^{\\star})) $\n$$ \\sigma_{V,\\max}^{2} + (k_B T)^2 \\frac{1}{n_{\\mathrm{WL}}} = (k_B T)^2 \\frac{1}{n_{\\mathrm{US}}} $$\n求解 $\\sigma_{V,\\max}^{2}$：\n$$ \\sigma_{V,\\max}^{2} = (k_B T)^2 \\frac{1}{n_{\\mathrm{US}}} - (k_B T)^2 \\frac{1}{n_{\\mathrm{WL}}} $$\n这个表达式可以因式分解得到最终结果。\n$$ \\sigma_{V,\\max}^{2} = (k_B T)^2 \\left( \\frac{1}{n_{\\mathrm{US}}} - \\frac{1}{n_{\\mathrm{WL}}} \\right) $$\n这个结果表示，为了使混合方法的精度与伞形采样方法相匹配，收敛的王-Landau 势中所允许的最大误差方差。要使 WL 方法更优越，$\\sigma_V^2$ 必须小于此值。只有当 $n_{\\mathrm{WL}}  n_{\\mathrm{US}}$ 时，$\\sigma_{V,\\max}^{2}$ 才有正解，这表明 WL 模拟必须在感兴趣的区间内实现更高的有效采样，以补偿由不完美偏置势带来的额外误差源。", "answer": "$$\\boxed{(k_B T)^2 \\left(\\frac{1}{n_{\\mathrm{US}}} - \\frac{1}{n_{\\mathrm{WL}}}\\right)}$$", "id": "3305331"}]}