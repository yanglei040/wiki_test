{"hands_on_practices": [{"introduction": "本次实践将带你掌握指数变量生成的核心技术——反变换法。你将亲手实现该算法，并运用柯尔莫哥洛夫-斯米尔诺夫(Kolmogorov-Smirnov)检验来从统计上验证所生成的样本是否符合目标分布。这个练习旨在打通概率理论与蒙特卡洛模拟实践之间的关键环节，是进行随机模拟的基本功。[@problem_id:2403697]", "problem": "要求您使用第一性原理，对指数分布的抽样进行形式化、实现和验证。考虑一个指数分布，其率参数为 $\\lambda \\in (0,\\infty)$，累积分布函数为 $F(x) = \\mathbb{P}(X \\le x)$。\n\n任务：\n1. 使用逆变换原理，通过对单位区间上均匀分布的变量 $U$ 进行独立抽取，生成 $n$ 个来自率参数为 $\\lambda$ 的指数分布的独立样本。您必须利用以下性质：如果 $U$ 在单位区间上均匀分布，则 $F^{-1}(U)$ 的累积分布函数为 $F$。\n2. 对于每个参数三元组 $(\\lambda,n,\\alpha)$（其中 $\\lambda \\in (0,\\infty)$，$n \\in \\mathbb{N}$，$\\alpha \\in (0,1)$ 为显著性水平），基于您生成的 $n$ 个样本，对率参数为 $\\lambda$ 的指数分布进行单样本分布拟合优度检验。报告 $p$ 值和一个布尔决策：如果在显著性水平 $\\alpha$ 下不拒绝“数据服从率参数为 $\\lambda$ 的指数分布”这一原假设，则该决策为 $\\text{True}$，否则为 $\\text{False}$。$p$ 值必须报告为实数。\n3. 为保证可复现性，请在程序开始时使用固定的整数种子 $s=123456789$ 初始化您的伪随机数生成器一次。\n\n测试套件：\n- 情况 $1$：$(\\lambda,n,\\alpha) = (0.7,1000,0.05)$\n- 情况 $2$：$(\\lambda,n,\\alpha) = (2.3,200,0.01)$\n- 情况 $3$：$(\\lambda,n,\\alpha) = (0.1,500,0.10)$\n- 情况 $4$：$(\\lambda,n,\\alpha) = (10.0,100,0.05)$\n- 情况 $5$：$(\\lambda,n,\\alpha) = (0.5,5,0.20)$\n\n您的程序必须：\n- 实现第 $1$ 项中描述的抽样器，为每种情况生成 $n$ 个样本。\n- 实现第 $2$ 项中描述的检验，并计算每种情况的 $p$ 值。\n- 对于每种情况 $i \\in \\{1,2,3,4,5\\}$，按顺序输出两个值：四舍五入到六位小数的 $p$ 值和上文指定的布尔决策。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含所有结果，形式为一个用方括号括起来的逗号分隔列表。该列表长度必须为 $10$，并按 $[p_1,d_1,p_2,d_2,p_3,d_3,p_4,d_4,p_5,d_5]$ 的顺序排列，其中 $p_i$ 是情况 $i$ 的 $p$ 值（四舍五入到六位小数），$d_i$ 是对应的布尔决策。", "solution": "该问题要求使用逆变换法从指数分布中生成随机样本，然后使用拟合优度检验对这些样本进行统计验证。解决方案分为两部分：首先，推导抽样算法；其次，说明所用的统计检验。\n\n**1. 指数分布的逆变换抽样**\n\n指数分布的特征是其率参数 $\\lambda > 0$。对于一个随机变量 $X$，其概率密度函数 (PDF) 由下式给出：\n$$\nf(x; \\lambda) = \\begin{cases} \\lambda e^{-\\lambda x} & \\text{if } x \\ge 0 \\\\ 0 & \\text{if } x < 0 \\end{cases}\n$$\n累积分布函数 (CDF) $F(x)$ 表示随机变量 $X$ 取值小于或等于 $x$ 的概率。它通过对 PDF 从 $0$ 到 $x$ 积分得到：\n$$\nF(x) = \\mathbb{P}(X \\le x) = \\int_0^x \\lambda e^{-\\lambda t} dt = \\left[ -e^{-\\lambda t} \\right]_0^x = 1 - e^{-\\lambda x} \\quad \\text{for } x \\ge 0\n$$\n逆变换抽样法基于以下原理：如果 $U$ 是从区间 $(0, 1)$ 上的标准均匀分布中抽取的随机变量，则随机变量 $X = F^{-1}(U)$ 将服从由 CDF $F$ 所表征的分布。\n\n为应用此方法，我们必须首先求出 CDF 的反函数，记为 $F^{-1}(u)$。我们令 $u = F(x)$ 并求解 $x$：\n$$\nu = 1 - e^{-\\lambda x}\n$$\n整理各项以分离出 $x$：\n$$\ne^{-\\lambda x} = 1 - u\n$$\n对两边取自然对数：\n$$\n-\\lambda x = \\ln(1 - u)\n$$\n最后，解出 $x$ 得到反 CDF：\n$$\nx = F^{-1}(u) = -\\frac{1}{\\lambda} \\ln(1 - u)\n$$\n因此，要从率参数为 $\\lambda$ 的指数分布中生成一个样本 $x$，我们从 $\\text{Uniform}(0,1)$ 分布中生成一个随机数 $u$，并应用变换 $x = -\\frac{1}{\\lambda} \\ln(1 - u)$。\n\n一个有用的简化源于这样一个性质：如果 $U \\sim \\text{Uniform}(0,1)$，那么随机变量 $V = 1 - U$ 也服从 $\\text{Uniform}(0,1)$ 分布。这使我们能够用 $u$ 替换公式中的 $1-u$，从而得到一个计算上等价且更直接的表达式：\n$$\nx = -\\frac{1}{\\lambda} \\ln(u)\n$$\n此公式将被用于为每个测试用例生成 $n$ 个样本。该过程首先使用指定的种子 $s=123456789$ 初始化伪随机数生成器以确保可复现性。然后，对于每个测试用例 $(\\lambda, n, \\alpha)$，我们从 $\\text{Uniform}(0,1)$ 分布中抽取 $n$ 个独立的值 $u_1, u_2, \\dots, u_n$，并计算相应的指数样本 $x_i = -\\frac{1}{\\lambda} \\ln(u_i)$。\n\n**2. 拟合优度检验**\n\n生成样本数据 $\\{x_1, \\dots, x_n\\}$ 后，必须执行单样本分布拟合优度检验。原假设 $H_0$ 为：数据是从具有指定率参数 $\\lambda$ 的指数分布中抽取的。备择假设 $H_1$ 为：数据并非来自此分布。\n\n适用于此场景的一个标准且恰当的检验是单样本柯尔莫哥洛夫-斯米尔诺夫 (K-S) 检验。该检验将样本数据的经验累积分布函数 (ECDF) $F_n(x)$ 与假设分布的理论 CDF $F(x) = 1 - e^{-\\lambda x}$ 进行比较。ECDF 定义为：\n$$\nF_n(x) = \\frac{1}{n} \\sum_{i=1}^n \\mathbb{I}(x_i \\le x)\n$$\n其中 $\\mathbb{I}(\\cdot)$ 是指示函数。K-S 检验统计量 $D_n$ 是 ECDF 与理论 CDF 在所有可能的 $x$ 值上的最大绝对差：\n$$\nD_n = \\sup_x | F_n(x) - F(x) |\n$$\n在原假设下，$D_n$ 统计量的分布是已知的，并且与被检验的具体连续分布无关。此性质使得计算 $p$ 值成为可能。$p$ 值定义为：假设 $H_0$ 为真时，观测到与从数据中计算出的检验统计量一样极端或更极端的检验统计量的概率。\n\n决策规则基于显著性水平 $\\alpha$：\n- 如果 $p$ 值小于 $\\alpha$，我们拒绝原假设 $H_0$。\n- 如果 $p$ 值大于或等于 $\\alpha$，我们不拒绝原假设 $H_0$。\n\n问题要求一个布尔决策，当不拒绝 $H_0$ 时为 $\\text{True}$。因此，给定测试用例的决策将是比较 $p\\text{值} \\ge \\alpha$ 的结果。在实现上，我们将使用 `scipy.stats.kstest` 函数。`scipy` 中的指数分布实现由一个位置参数 `loc` 和一个尺度参数 `scale` 参数化。为了匹配我们的目标 PDF $\\lambda e^{-\\lambda x}$，我们必须设置 `loc`$=0$ 和 `scale`$=1/\\lambda$。\n\n每个测试用例 $(\\lambda, n, \\alpha)$ 的完整算法如下：\n1. 使用以 $s=123456789$ 为种子的生成器生成 $n$ 个均匀随机数 $u_1, \\dots, u_n$。\n2. 将这些数变换为指数样本 $x_i = -\\frac{1}{\\lambda} \\ln(u_i)$。\n3. 对样本 $\\{x_i\\}$，使用参数为 `loc=0` 和 `scale=1/\\lambda` 的 'expon' 分布进行 K-S 检验。\n4. 从检验结果中获取 $p$ 值。\n5. 计算布尔决策为 $p\\text{值} \\ge \\alpha$。\n6. 报告四舍五入到六位小数的 $p$ 值和布尔决策。\n\n此过程将对所有五个指定的测试用例执行。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import stats\n\ndef solve():\n    \"\"\"\n    Solves the problem by generating exponential samples via inverse transform\n    and validating them with a Kolmogorov-Smirnov goodness-of-fit test.\n\n    The process adheres to the problem's requirements for validation,\n    reproducibility with a fixed seed, and specific output formatting.\n    \"\"\"\n    \n    # Global seed for reproducibility, as per problem statement.\n    # The modern `default_rng` is used for generating pseudo-random numbers.\n    seed = 123456789\n    rng = np.random.default_rng(seed)\n\n    # Test suite: each tuple is (lambda, n, alpha)\n    test_cases = [\n        (0.7, 1000, 0.05),\n        (2.3, 200, 0.01),\n        (0.1, 500, 0.10),\n        (10.0, 100, 0.05),\n        (0.5, 5, 0.20),\n    ]\n\n    results = []\n    for lambda_val, n, alpha in test_cases:\n        # Task 1: Generate n samples from the exponential distribution with rate lambda.\n        # This is implemented using the inverse transform method.\n        # If U is a random variable from Uniform(0, 1), then X = -ln(U)/lambda\n        # is a random variable from Exponential(lambda).\n        \n        # Generate n uniform random numbers in the interval [0.0, 1.0).\n        uniform_samples = rng.uniform(size=n)\n        \n        # Apply the inverse CDF transformation.\n        exponential_samples = -np.log(uniform_samples) / lambda_val\n\n        # Task 2: Conduct a one-sample Kolmogorov-Smirnov test.\n        # The null hypothesis (H0) is that the generated data follows an\n        # exponential distribution with the given rate lambda_val.\n        # The `scipy.stats.expon` distribution is parameterized by `loc` and `scale`.\n        # For a rate lambda, the scale parameter is 1/lambda and loc is 0.\n        scale_param = 1.0 / lambda_val\n        ks_statistic, p_value = stats.kstest(exponential_samples, 'expon', args=(0, scale_param))\n        \n        # The decision is True if we do not reject H0 at significance level alpha.\n        # This occurs when the p-value is greater than or equal to alpha.\n        decision = p_value >= alpha\n        \n        # Format results as specified in the problem statement.\n        p_value_rounded = round(p_value, 6)\n        \n        results.append(p_value_rounded)\n        results.append(decision)\n\n    # Final print statement in the exact required format.\n    # The map(str, ...) function correctly converts boolean values to \"True\"/\"False\".\n    print(f\"[{','.join(map(str, results))}]\")\n\n# Execute the main function to solve the problem and print the output.\nsolve()\n```", "id": "2403697"}, {"introduction": "成功生成样本后，一个核心任务便是估计其背后所遵循分布的参数。本次实践将引导你推导指数分布率参数 $\\lambda$ 的最大似然估计量(MLE)，并深入分析其统计效率。通过计算其方差并与克拉默-拉奥下界(Cramér–Rao lower bound)进行比较，你将能深刻理解估计量的优良性及其在样本量趋于无穷时的表现。[@problem_id:3307724]", "problem": "一次随机模拟使用逆变换采样方法，对 $[0,1]$ 上的均匀伪随机数进行处理，从而从一个具有未知速率参数 $\\lambda>0$ 的指数分布中生成独立同分布 (i.i.d.) 的样本。设 $X_{1},\\dots,X_{n}$ 表示从该指数分布中得到的 i.i.d. 样本，其概率密度函数为：当 $x\\geq 0$ 时，$f(x;\\lambda)=\\lambda \\exp(-\\lambda x)$；其他情况下 $f(x;\\lambda)=0$。假设 $n\\geq 3$。\n\n仅从模型设定和似然函数的定义出发，完成以下任务：\n\n- 推导 $\\lambda$ 的最大似然估计量 (MLE) $\\hat{\\lambda}$。\n- 推导精确的有限样本方差 $\\operatorname{Var}(\\hat{\\lambda})$。\n- 计算 $n$ 个观测值的 Fisher 信息以及对应的 $\\lambda$ 的无偏估计量的 Cramér–Rao 下界 (CRLB)。\n- 通过确定 MLE 是否在有限的 $n$ 值下达到 CRLB 来评估其有效性，并计算定义为 $\\lim_{n\\to\\infty}\\frac{\\text{CRLB}}{\\operatorname{Var}(\\hat{\\lambda})}$ 的渐近有效性。\n\n请将你的最终结果按顺序 $\\bigl(\\hat{\\lambda},\\,\\operatorname{Var}(\\hat{\\lambda}),\\,\\text{CRLB},\\,\\lim_{n\\to\\infty}\\frac{\\text{CRLB}}{\\operatorname{Var}(\\hat{\\lambda})}\\bigr)$ 表示为单行矩阵。不要包含任何单位。答案必须以精确的符号形式给出，无数值四舍五入。", "solution": "本题要求推导指数分布速率参数 $\\lambda$ 的最大似然估计量 (MLE)、其方差、Cramér–Rao 下界 (CRLB) 及其渐近有效性。给定一个来自指数分布的独立同分布 (i.i.d.) 随机变量样本 $X_1, \\dots, X_n$，其概率密度函数 (PDF) 为 $f(x;\\lambda) = \\lambda \\exp(-\\lambda x)$ (当 $x \\geq 0$ 时)。给定样本大小 $n \\geq 3$。\n\n**第1部分：最大似然估计量 (MLE) $\\hat{\\lambda}$ 的推导**\n\n对于 i.i.d. 样本 $X_1, \\dots, X_n$，其似然函数 $L(\\lambda)$ 是各个概率密度函数的乘积：\n$$L(\\lambda; X_1, \\dots, X_n) = \\prod_{i=1}^{n} f(X_i; \\lambda) = \\prod_{i=1}^{n} \\lambda \\exp(-\\lambda X_i)$$\n假设所有 $X_i \\geq 0$，则可简化为：\n$$L(\\lambda) = \\lambda^n \\exp\\left(-\\lambda \\sum_{i=1}^{n} X_i\\right)$$\n为求得 MLE，我们需对 $L(\\lambda)$ 关于 $\\lambda$ 进行最大化。由于对数是单调递增函数，最大化对数似然函数 $\\ell(\\lambda) = \\ln L(\\lambda)$ 更为方便。\n$$\\ell(\\lambda) = \\ln\\left(\\lambda^n \\exp\\left(-\\lambda \\sum_{i=1}^{n} X_i\\right)\\right) = n\\ln\\lambda - \\lambda \\sum_{i=1}^{n} X_i$$\n为求最大值，我们计算 $\\ell(\\lambda)$ 对 $\\lambda$ 的导数并令其为零。该导数即为得分函数。\n$$\\frac{d\\ell}{d\\lambda} = \\frac{n}{\\lambda} - \\sum_{i=1}^{n} X_i$$\n将导数设为零并求解 $\\lambda$，得到估计量 $\\hat{\\lambda}$：\n$$\\frac{n}{\\hat{\\lambda}} - \\sum_{i=1}^{n} X_i = 0 \\implies \\hat{\\lambda} = \\frac{n}{\\sum_{i=1}^{n} X_i}$$\n这也可以用样本均值 $\\bar{X} = \\frac{1}{n} \\sum_{i=1}^{n} X_i$ 表示为 $\\hat{\\lambda} = \\frac{1}{\\bar{X}}$。为确认此为最大值，我们检查二阶导数：\n$$\\frac{d^2\\ell}{d\\lambda^2} = -\\frac{n}{\\lambda^2}$$\n由于 $\\lambda > 0$ 且 $n \\geq 3$，二阶导数恒为负，这证实了 $\\hat{\\lambda}$ 确实是最大似然估计量。\n第一个结果是 $\\hat{\\lambda} = \\frac{n}{\\sum_{i=1}^{n} X_i}$。\n\n**第2部分：方差 $\\operatorname{Var}(\\hat{\\lambda})$ 的推导**\n\n估计量为 $\\hat{\\lambda} = \\frac{n}{S_n}$，其中 $S_n = \\sum_{i=1}^{n} X_i$。由于每个 $X_i$ 是速率为 $\\lambda$ 的 i.i.d. 指数随机变量，即 $X_i \\sim \\text{Exponential}(\\lambda)$，等价描述为 $X_i \\sim \\text{Gamma}(1, \\lambda)$。$n$ 个 i.i.d. 的 $\\text{Gamma}(1, \\lambda)$ 随机变量之和服从 $\\text{Gamma}(n, \\lambda)$ 分布。因此，$S_n \\sim \\text{Gamma}(n, \\lambda)$。\n$S_n$ 的 PDF 为 $f_{S_n}(s) = \\frac{\\lambda^n s^{n-1} \\exp(-\\lambda s)}{\\Gamma(n)}$ (当 $s \\geq 0$ 时)。\n为求 $\\operatorname{Var}(\\hat{\\lambda}) = \\operatorname{Var}\\left(\\frac{n}{S_n}\\right)$，我们首先需要 $S_n^{-1}$ 的矩。这些矩是通过计算伽马变量 $S_n$ 的矩得到的。对于服从 PDF $f(s) = \\frac{\\beta^\\alpha s^{\\alpha-1} e^{-\\beta s}}{\\Gamma(\\alpha)}$ 的 $S_n \\sim \\text{Gamma}(\\alpha, \\beta)$，其 $k$ 阶矩为 $E[S_n^k] = \\frac{\\Gamma(\\alpha+k)}{\\Gamma(\\alpha)\\beta^k}$，前提是 $\\alpha+k>0$。\n在我们的例子中，$\\alpha=n$，速率为 $\\beta=\\lambda$。因此，对于任何满足 $n+k>0$ 的 $k$：\n$$E[S_n^k] = \\frac{\\Gamma(n+k)}{\\Gamma(n)\\lambda^k}$$\n为计算方差，我们需要 $E[\\hat{\\lambda}]$ 和 $E[\\hat{\\lambda}^2]$。\n首先，$E[\\hat{\\lambda}] = E\\left[\\frac{n}{S_n}\\right] = n E[S_n^{-1}]$。使用 $k=-1$：\n$$E[S_n^{-1}] = \\frac{\\Gamma(n-1)}{\\Gamma(n)\\lambda^{-1}} = \\frac{(n-2)!}{(n-1)!}\\lambda = \\frac{\\lambda}{n-1}$$\n此式在 $n-1>0$ (即 $n>1$) 时有效。由于给定 $n \\geq 3$，此条件得到满足。\n$$E[\\hat{\\lambda}] = \\frac{n\\lambda}{n-1}$$\n接着，$E[\\hat{\\lambda}^2] = E\\left[\\left(\\frac{n}{S_n}\\right)^2\\right] = n^2 E[S_n^{-2}]$。使用 $k=-2$：\n$$E[S_n^{-2}] = \\frac{\\Gamma(n-2)}{\\Gamma(n)\\lambda^{-2}} = \\frac{(n-3)!}{(n-1)!}\\lambda^2 = \\frac{\\lambda^2}{(n-1)(n-2)}$$\n此式在 $n-2>0$ (即 $n>2$) 时有效。由于给定 $n \\geq 3$，此条件也得到满足。\n$$E[\\hat{\\lambda}^2] = \\frac{n^2\\lambda^2}{(n-1)(n-2)}$$\n方差为 $\\operatorname{Var}(\\hat{\\lambda}) = E[\\hat{\\lambda}^2] - (E[\\hat{\\lambda}])^2$。\n$$\\operatorname{Var}(\\hat{\\lambda}) = \\frac{n^2\\lambda^2}{(n-1)(n-2)} - \\left(\\frac{n\\lambda}{n-1}\\right)^2 = \\frac{n^2\\lambda^2}{(n-1)(n-2)} - \\frac{n^2\\lambda^2}{(n-1)^2}$$\n$$= n^2\\lambda^2 \\left( \\frac{n-1 - (n-2)}{(n-1)^2(n-2)} \\right) = n^2\\lambda^2 \\left( \\frac{1}{(n-1)^2(n-2)} \\right)$$\n因此，第二个结果是 $\\operatorname{Var}(\\hat{\\lambda}) = \\frac{n^2\\lambda^2}{(n-1)^2(n-2)}$。\n\n**第3部分：Fisher 信息与 Cramér–Rao 下界 (CRLB)**\n\n单个观测值的 Fisher 信息 $I(\\lambda)$ 由 $I(\\lambda) = -E\\left[\\frac{d^2}{d\\lambda^2} \\ln f(X;\\lambda)\\right]$ 给出。\n单个观测值的对数 PDF 为 $\\ln f(x;\\lambda) = \\ln\\lambda - \\lambda x$。其导数为：\n$$\\frac{d}{d\\lambda} \\ln f(x;\\lambda) = \\frac{1}{\\lambda} - x$$\n$$\\frac{d^2}{d\\lambda^2} \\ln f(x;\\lambda) = -\\frac{1}{\\lambda^2}$$\n由于二阶导数相对于 $x$ 是一个常数，其期望就是该常数本身：\n$$I(\\lambda) = -E\\left[-\\frac{1}{\\lambda^2}\\right] = \\frac{1}{\\lambda^2}$$\n对于 $n$ 个 i.i.d. 观测值，总 Fisher 信息是可加的：$I_n(\\lambda) = n I(\\lambda) = \\frac{n}{\\lambda^2}$。\nCramér–Rao 下界 (CRLB) 为 $\\lambda$ 的任何无偏估计量的方差提供了一个下界。该下界由 Fisher 信息的倒数给出：\n$$\\text{CRLB} = \\frac{1}{I_n(\\lambda)} = \\frac{1}{n/\\lambda^2} = \\frac{\\lambda^2}{n}$$\n第三个结果是 $\\text{CRLB} = \\frac{\\lambda^2}{n}$。\n\n**第4部分：有效性评估**\n\n首先，我们评估对于有限的 $n$，MLE 是否能达到 CRLB。CRLB 适用于无偏估计量。我们发现 $E[\\hat{\\lambda}] = \\frac{n\\lambda}{n-1}$，对于任何有限的 $n$，它都不等于 $\\lambda$。由于 $\\hat{\\lambda}$ 是一个有偏估计量，它不能达到为无偏估计量设定的 CRLB。\n\n接下来，我们计算渐近有效性，其定义为当 $n \\to \\infty$ 时，CRLB 与估计量方差之比的极限。\n$$\\text{渐近有效性} = \\lim_{n\\to\\infty} \\frac{\\text{CRLB}}{\\operatorname{Var}(\\hat{\\lambda})}$$\n代入 CRLB 和 $\\operatorname{Var}(\\hat{\\lambda})$ 的表达式：\n$$\\lim_{n\\to\\infty} \\frac{\\frac{\\lambda^2}{n}}{\\frac{n^2\\lambda^2}{(n-1)^2(n-2)}} = \\lim_{n\\to\\infty} \\frac{\\lambda^2}{n} \\cdot \\frac{(n-1)^2(n-2)}{n^2\\lambda^2} = \\lim_{n\\to\\infty} \\frac{(n-1)^2(n-2)}{n^3}$$\n为计算该极限，我们考察 $n$ 的多项式中首项系数之比：\n$$\\lim_{n\\to\\infty} \\frac{(n^2 - 2n + 1)(n-2)}{n^3} = \\lim_{n\\to\\infty} \\frac{n^3 - 4n^2 + 5n - 2}{n^3}$$\n$$= \\lim_{n\\to\\infty} \\left(1 - \\frac{4}{n} + \\frac{5}{n^2} - \\frac{2}{n^3}\\right) = 1$$\n渐近有效性为 $1$，意味着 MLE $\\hat{\\lambda}$ 是渐近有效的。\n第四个结果是 $1$。\n\n**最终结果整理**\n按指定顺序，四个结果如下：\n$1$. $\\hat{\\lambda} = \\frac{n}{\\sum_{i=1}^n X_i}$\n$2$. $\\operatorname{Var}(\\hat{\\lambda}) = \\frac{n^2 \\lambda^2}{(n-1)^2(n-2)}$\n$3$. $\\text{CRLB} = \\frac{\\lambda^2}{n}$\n$4$. $\\lim_{n\\to\\infty}\\frac{\\text{CRLB}}{\\operatorname{Var}(\\hat{\\lambda})} = 1$\n这些结果将以单行矩阵的形式呈现。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{n}{\\sum_{i=1}^{n} X_i} & \\frac{n^2 \\lambda^2}{(n-1)^2(n-2)} & \\frac{\\lambda^2}{n} & 1\n\\end{pmatrix}\n}\n$$", "id": "3307724"}, {"introduction": "一个数学上完美的公式在有限精度的计算机上可能悄无声息地失效。本练习将探讨反变换法中一个至关重要的实际问题——数值稳定性，特别是朴素计算中出现的“灾难性抵消”现象。通过分析浮点数运算的特性，你将理解为何直接计算 $-\\ln(1-U)$ 在 $U$ 接近 $0$ 时会损失精度，并学习如何使用统计上等价且数值上更稳健的替代方案。[@problem_id:3314503]", "problem": "要求您分析在有限精度算术下，连续变量的逆变换采样的数值稳定性。考虑通过对均匀分布变量 $U\\sim\\mathrm{Uniform}(0,1)$ 应用逆变换来从率参数为 $\\lambda>0$ 的指数分布中生成样本，即 $X=F^{-1}(U)$，其中 $F(x)=1-\\exp(-\\lambda x)$。直接的代数重排得到 $X=-\\ln(1-U)/\\lambda$。假设使用符合电气和电子工程师协会 (IEEE) 754 标准的二进制浮点算术，采用舍入到最近的模式。设机器精度为 $\\varepsilon_{\\mathrm{mach}}$（对于 IEEE 754 binary64，$\\varepsilon_{\\mathrm{mach}}=2^{-53}$ 是单位舍入误差的一半，即如果 $x$ 是一个实数，$\\mathrm{fl}(x)$ 表示其舍入后的表示，那么对于一次没有上溢/下溢的正确舍入基本运算，有 $\\mathrm{fl}(x)=x(1+\\delta)$，其中 $|\\delta|\\le \\varepsilon_{\\mathrm{mach}}$）。接下来，令 $\\mathrm{fl}(\\cdot)$ 表示单次浮点运算的舍入结果，并令 $\\text{log1p}(z)$ 表示一个库函数，它能在 $z$ 接近 $0$ 时以高相对精度计算 $\\ln(1+z)$。\n\n请严格从逆变换采样和浮点舍入模型的定义出发，分析通过 $-\\ln(1-U)$ 计算 $X$ 的数值行为，以及通过避免显式计算 $1-U$ 的替代方法的数值行为。特别地，确定下列哪些陈述是正确的。可能有一个以上的正确选项。\n\nA. 在采用舍入到最近模式的 IEEE 754 binary64 标准下，如果 $u  2^{-53}$，那么 $\\mathrm{fl}(1-u)=1$（精确值）。因此，使用 $x=-\\ln(\\mathrm{fl}(1-u))$ 的朴素逆变换会返回 $x=0$，而真实值是 $x=-\\ln(1-u)\\approx u0$。使用 $x=-\\text{log1p}(-u)$ 避免了这种信息损失，因为它不将 $1-u$ 作为一个中间量来计算。\n\nB. 对于接近 $1$ 的 $u$，减法 $1-u$ 是良态的，并且永远不会损失相对精度，因此 $-\\ln(1-u)$ 总是和 $-\\text{log1p}(-u)$ 一样精确。\n\nC. 将 $-\\ln(1-u)$ 替换为 $-\\ln(u)$ 会产生同分布的样本，并严格避免了相消误差；然而，为了防止计算 $\\ln(0)$，必须确保 $u\\in(0,1]$，例如，在应用对数函数之前，可以将精确的零映射到大于 $0$ 的下一个可表示数。\n\nD. 在计算 $-\\ln(1-u)$ 之前，给 $u$ 加上一个固定的正常数 $\\varepsilon$（例如，$u\\leftarrow u+2^{-53}$）是修复相消误差而不使目标分布产生偏差的合理方法。\n\nE. 对于具有可微 $F$ 的一般形式为 $F^{-1}(u)$ 的逆变换，$u$ 中的舍入可能产生灾难性误差的唯一地方是当 $u\\approx 1$ 时；对于 $-\\ln(1-u)$ 来说，$u\\approx 0$ 的值在数值上是无害的。\n\n选择所有正确的选项，并使用关于逆变换方法、$\\ln(1-x)$ 在 $x$ 较小时的行为以及浮点误差模型的基本原理解释你的选择。", "solution": "该问题要求分析使用逆变换方法生成指数随机变量的数值稳定性。\n\n问题的核心在于计算 $X = -\\frac{\\ln(1-U)}{\\lambda}$，其中 $U$ 是来自 $\\mathrm{Uniform}(0,1)$ 分布的随机变量。乘法因子 $1/\\lambda$ 在数值上是稳定的（假设 $\\lambda$ 不接近上溢或下溢的极限），因此我们关注 $-\\ln(1-U)$ 这一项。此计算中的数值问题取决于 $U$ 的值。\n\n对于 $U$ 来说，两个关键的区间是 $U \\to 0$ 和 $U \\to 1$。\n\n情况1：$U = u$，其中 $u$ 接近 $0$。\n数学表达式为 $x = -\\ln(1-u)/\\lambda$。使用 $\\ln(1-z)$ 在 $z=0$ 附近的泰勒级数展开式 $\\ln(1-z) = -z - z^2/2 - \\dots$，我们发现在 $u0$ 且很小时，$x \\approx -(-u)/\\lambda = u/\\lambda$。期望的结果是一个小的正数。\n朴素的浮点计算是 $\\mathrm{fl}(-\\ln(\\mathrm{fl}(1-u))/\\lambda)$。第一步是减法 $\\mathrm{fl}(1-u)$。根据问题对 IEEE 754 binary64 算术的描述，单位舍入误差是 $\\varepsilon_{\\mathrm{mach}} = 2^{-53}$。机器 epsilon，即从 $1$ 到下一个更大的可表示浮点数之间的距离，是 $\\varepsilon = 2\\varepsilon_{\\mathrm{mach}} = 2^{-52}$。\n当一个实数被舍入到最近的浮点数时，任何在区间 $(1 - \\varepsilon/2, 1]$ 内的数都会被舍入为 $1$。这个区间是 $(1 - 2^{-53}, 1]$。如果 $u$ 是一个正的浮点数且 $u  2^{-53}$，那么 $1-u$ 就落在这个区间内，因此 $\\mathrm{fl}(1-u) = 1$。\n因此，对于这样小的 $u$，计算结果为 $\\mathrm{fl}(-\\ln(1)/\\lambda) = 0$。这是一个灾难性的精度损失，因为真实值大约是 $u/\\lambda  0$，而计算结果却是精确的 $0$。这种由于减法导致重要信息丢失的误差，是一种灾难性相消（catastrophic cancellation）。\n\n情况2：$U = u$，其中 $u$ 接近 $1$。\n设 $u = 1-\\delta$，其中 $\\delta  0$ 是一个小数。数学表达式为 $x = -\\ln(1-(1-\\delta))/\\lambda = -\\ln(\\delta)/\\lambda$。当 $\\delta \\to 0^+$ 时，$x \\to +\\infty$。\n计算涉及到减法 $1-u$。计算 $f(u)=1-u$ 这个问题的条件数是 $\\kappa(u) = |u f'(u) / f(u)| = |u(-1)/(1-u)| = |u/(1-u)|$。当 $u \\to 1$ 时，$\\kappa(u) \\to \\infty$。这意味着该问题是病态的：输入 $u$ 的微小相对误差会被放大为输出 $1-u$ 的巨大相对误差。例如，将 $U$ 表示为浮点数时的舍入误差，即使只有一个 $\\varepsilon_{\\mathrm{mach}}$，也可能导致 $1-U$ 这个量的相对误差非常大，然后这个误差会通过自然对数函数传播。\n\n现在我们评估每个选项。\n\nA. 在采用舍入到最近模式的 IEEE 754 binary64 标准下，如果 $u  2^{-53}$，那么 $\\mathrm{fl}(1-u)=1$（精确值）。因此，使用 $x=-\\ln(\\mathrm{fl}(1-u))$ 的朴素逆变换会返回 $x=0$，而真实值是 $x=-\\ln(1-u)\\approx u0$。使用 $x=-\\text{log1p}(-u)$ 避免了这种信息损失，因为它不将 $1-u$ 作为一个中间量来计算。\n\n这个陈述是正确的。正如上面情况1的分析，如果 $u$ 是一个小于单位舍入误差 $\\varepsilon_{\\mathrm{mach}} = 2^{-53}$ 的正数，在浮点算术中执行的减法 $1-u$ 会精确地得到 $1$。这导致 $\\ln(1)=0$，完全丢失了 $u$ 中包含的信息。真实值 $-\\ln(1-u)$ 约等于 $u$，所以这是朴素算法的一个失败。函数 $\\text{log1p}(z)$ 是专门为在 $|z|$ 很小时精确计算 $\\ln(1+z)$ 而设计的。通过将 $-\\ln(1-u)$ 重写为 $-\\text{log1p}(-u)$，我们将小量 $-u$ 直接传递给这个专门的函数，它可以使用数值稳定的方法（如泰勒级数近似）来计算结果，而无需执行导致相消误差的中间减法 $1-u$。这准确地反映了 `log1p` 的目的和功能。**正确**。\n\nB. 对于接近 $1$ 的 $u$，减法 $1-u$ 是良态的，并且永远不会损失相对精度，因此 $-\\ln(1-u)$ 总是和 $-\\text{log1p}(-u)$ 一样精确。\n\n这个陈述是不正确的。第一个论断，即对于接近 $1$ 的 $u$ 来说，减法 $1-u$ 是良态的，是错误的。如情况2的分析所示，计算 $1-u$ 的条件数是 $|u/(1-u)|$，当 $u \\to 1$ 时，它趋向于无穷大。一个病态问题是指微小的相对输入误差可能导致巨大的相对输出误差。虽然浮点减法本身在某些条件下可能是精确的（例如，根据 Sterbenz's Lemma），但其根本问题是病态的，这意味着 $u$ 中的任何误差（例如来自原始随机数生成的误差）都将被极大地放大。由于陈述的前提是错误的，所以该陈述不成立。**不正确**。\n\nC. 将 $-\\ln(1-u)$ 替换为 $-\\ln(u)$ 会产生同分布的样本，并严格避免了相消误差；然而，为了防止计算 $\\ln(0)$，必须确保 $u\\in(0,1]$，例如，在应用对数函数之前，可以将精确的零映射到大于 $0$ 的下一个可表示数。\n\n这个陈述是正确的。如果一个随机变量 $U$ 服从 $\\mathrm{Uniform}(0,1)$ 分布，那么随机变量 $V=1-U$ 也服从 $\\mathrm{Uniform}(0,1)$ 分布。这是均匀分布的一个基本性质。因此，使用 $X = -\\ln(U)/\\lambda$ 生成样本在统计上等同于使用 $X = -\\ln(1-U)/\\lambda$。表达式 $-\\ln(U)/\\lambda$ 不涉及减法 $1-U$，从而完全避免了当原始公式中的 $U$ 接近 $0$ 时发生的灾难性相消问题。这种替代方法在数值上更优越。附带的说明也是正确的：由于均匀随机数生成器可能会产生精确的 $0$，因此必须处理 $U=0$ 的情况，以防止 $\\ln(0)$ 产生错误。这是稳健实现所必需的实际考虑。**正确**。\n\nD. 在计算 $-\\ln(1-u)$ 之前，给 $u$ 加上一个固定的正常数 $\\varepsilon$（例如，$u\\leftarrow u+2^{-53}$）是修复相消误差而不使目标分布产生偏差的合理方法。\n\n这个陈述是不正确的。提议的修改是 $X' = -\\ln(1-(U+\\varepsilon))/\\lambda$。如果 $U \\sim \\mathrm{Uniform}(0,1)$，那么 $U' = U+\\varepsilon$ 服从 $\\mathrm{Uniform}(\\varepsilon, 1+\\varepsilon)$ 分布。使用一个不服从 $\\mathrm{Uniform}(0,1)$ 分布的随机变量应用逆变换方法，将不会从原始目标分布中产生样本。得到的样本 $X'$ 的分布将不同于所期望的指数分布。声称这样做可以“不使目标分布产生偏差”是错误的。这种方法引入了系统误差，即偏差。**不正确**。\n\nE. 对于具有可微 $F$ 的一般形式为 $F^{-1}(u)$ 的逆变换，$u$ 中的舍入可能产生灾难性误差的唯一地方是当 $u\\approx 1$ 时；对于 $-\\ln(1-u)$ 来说，$u\\approx 0$ 的值在数值上是无害的。\n\n这个陈述是不正确的。它提出了两个错误的论断。首先，如选项A的分析所确立的，$u \\approx 0$ 的值恰恰是朴素计算 $-\\ln(1-u)$ 遭受灾难性相消的地方，所以这种情况并非“在数值上是无害的”。其次，关于误差只能在 $u \\approx 1$ 时产生的概括是错误的。对于一个一般的分布，$F^{-1}(u)$ 对 $u$ 变化的敏感度由导数 $(F^{-1})'(u) = 1/f(F^{-1}(u))$ 给出，其中 $f$ 是概率密度函数。只要这个导数值很大，就会发生大误差，这发生在分布的尾部，即 $f(x)$ 很小的地方。对于许多分布，如正态分布，有两个尾部，分别对应于 $u \\to 0$ 和 $u \\to 1$。因此，数值问题可能在 $(0,1)$ 区间的两端出现，而不仅仅是 $u \\approx 1$ 的附近。**不正确**。", "answer": "$$\\boxed{AC}$$", "id": "3314503"}]}