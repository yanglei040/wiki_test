{"hands_on_practices": [{"introduction": "重要性抽样的有效性取决于对提议分布的审慎选择。一个常见的陷阱是选择一个尾部比目标分布衰减更快的提议分布，这种情况被称为“尾部覆盖不足”。本练习 [@problem_id:3241960] 对此失效模式提供了一个清晰的分析性证明，展示了一个看似合理的高斯提议分布在处理柯西目标分布时，如何导致估计量方差无穷大，尽管目标积分本身是简单且有限的。完成此练习对于建立关于可靠重要性抽样估计量必要条件的直觉至关重要。", "problem": "考虑使用重要性采样 (IS) 估计目标期望 $I = \\mathbb{E}_{\\pi}[f(X)]$ 的任务，其中权重函数为 $w(x) = \\frac{\\pi(x)}{q(x)}$，样本从一个提议分布 $q(x)$ 中抽取。从概率密度函数 (PDF) 下期望和方差的基本定义出发：对于任意可测函数 $g$，$\\mathbb{E}_{p}[g(X)] = \\int_{\\mathbb{R}} g(x)\\,p(x)\\,dx$，且 $\\operatorname{Var}_{p}(Y) = \\mathbb{E}_{p}[Y^{2}] - \\left(\\mathbb{E}_{p}[Y]\\right)^{2}$。在重要性采样中，基于从 $q$ 中抽取的样本的 $I$ 的估计量是 $w(X)f(X)$ 的平均值，其在 $q$ 下的方差为 $\\operatorname{Var}_{q}\\!\\left[w(X)f(X)\\right]$。\n\n构造一个一维例子，其中提议分布 $q$ 未能覆盖目标分布 $\\pi$ 的尾部，导致即使目标期望 $I$ 是有限的，方差 $\\operatorname{Var}_{q}\\!\\left[w(X)f(X)\\right]$ 也是无穷大。具体来说，取目标 PDF 为标准 Cauchy 分布\n$$\n\\pi(x) = \\frac{1}{\\pi\\,(1+x^{2})}, \\quad x \\in \\mathbb{R},\n$$\n提议 PDF 为标准正态分布\n$$\nq(x) = \\frac{1}{\\sqrt{2\\pi}}\\,\\exp\\!\\left(-\\frac{x^{2}}{2}\\right), \\quad x \\in \\mathbb{R},\n$$\n被积函数为有界函数\n$$\nf(x) = 1, \\quad x \\in \\mathbb{R}.\n$$\n仅使用上述核心定义，执行以下操作：\n\n1. 精确计算目标期望 $I = \\int_{\\mathbb{R}} f(x)\\,\\pi(x)\\,dx$。\n2. 推导二阶矩 $\\mathbb{E}_{q}\\!\\left[(w(X)f(X))^{2}\\right]$ 的显式积分表达式，并通过基于给定 PDF 的尾部比较论证，证明该积分发散到 $+\\infty$。由此得出结论：当 $I$ 有限时，$\\operatorname{Var}_{q}\\!\\left[w(X)f(X)\\right]$ 是无穷大。\n\n精确陈述 $I$ 的最终数值答案。无需四舍五入，无单位。", "solution": "该问题提出了一个在数值方法领域，特别是在重要性采样方面的适定问题。所有给定的函数——目标分布 $\\pi(x)$、提议分布 $q(x)$ 和被积函数 $f(x)$——都是标准的、定义良好的数学对象。该问题具有科学依据且自成体系，可以进行严格的分析。我们着手完成两项要求的任务。\n\n该问题要求我们研究一个重要性采样场景，其中目标期望是有限的，但估计量的方差是无穷大。各组成部分定义如下：\n目标概率密度函数 (PDF)：标准 Cauchy 分布，$\\pi(x) = \\frac{1}{\\pi(1+x^2)}$。\n提议 PDF：标准正态分布，$q(x) = \\frac{1}{\\sqrt{2\\pi}}\\exp(-\\frac{x^2}{2})$。\n被积函数：$f(x) = 1$。\n目标是估计目标期望 $I = \\mathbb{E}_{\\pi}[f(X)]$。重要性采样权重为 $w(x) = \\frac{\\pi(x)}{q(x)}$。\n\n**1. 目标期望 $I$ 的计算**\n\n目标期望定义为 $I = \\int_{\\mathbb{R}} f(x)\\pi(x)dx$。代入给定的 $f(x)$ 和 $\\pi(x)$ 表达式：\n$$\nI = \\int_{-\\infty}^{\\infty} 1 \\cdot \\frac{1}{\\pi(1+x^2)} dx = \\frac{1}{\\pi} \\int_{-\\infty}^{\\infty} \\frac{1}{1+x^2} dx\n$$\n根据概率密度函数的定义，$\\pi(x)$ 在其支撑集 $\\mathbb{R}$ 上的积分必须等于 $1$。我们可以直接验证这一点。$\\frac{1}{1+x^2}$ 的反导数是 $\\arctan(x)$。因此，我们可以计算这个定积分：\n$$\nI = \\frac{1}{\\pi} \\left[ \\arctan(x) \\right]_{-\\infty}^{\\infty} = \\frac{1}{\\pi} \\left( \\lim_{b \\to \\infty} \\arctan(b) - \\lim_{a \\to -\\infty} \\arctan(a) \\right)\n$$\n使用反正切函数的已知极限，$\\lim_{b \\to \\infty} \\arctan(b) = \\frac{\\pi}{2}$ 和 $\\lim_{a \\to -\\infty} \\arctan(a) = -\\frac{\\pi}{2}$，我们得到：\n$$\nI = \\frac{1}{\\pi} \\left( \\frac{\\pi}{2} - \\left(-\\frac{\\pi}{2}\\right) \\right) = \\frac{1}{\\pi} \\left( \\frac{\\pi}{2} + \\frac{\\pi}{2} \\right) = \\frac{1}{\\pi}(\\pi) = 1\n$$\n目标期望 $I$ 是有限的，且等于 $1$。\n\n**2. 重要性采样估计量方差的分析**\n\n$I$ 的重要性采样估计量的方差由 $\\operatorname{Var}_{q}[w(X)f(X)]$ 给出。使用方差的定义 $\\operatorname{Var}_{p}(Y) = \\mathbb{E}_{p}[Y^2] - (\\mathbb{E}_{p}[Y])^2$，我们有：\n$$\n\\operatorname{Var}_{q}[w(X)f(X)] = \\mathbb{E}_{q}\\left[(w(X)f(X))^2\\right] - \\left( \\mathbb{E}_{q}[w(X)f(X)] \\right)^2\n$$\n首先，让我们计算估计量的期望 $\\mathbb{E}_{q}[w(X)f(X)]$：\n$$\n\\mathbb{E}_{q}[w(X)f(X)] = \\int_{-\\infty}^{\\infty} w(x)f(x)q(x)dx = \\int_{-\\infty}^{\\infty} \\frac{\\pi(x)}{q(x)} \\cdot 1 \\cdot q(x)dx = \\int_{-\\infty}^{\\infty} \\pi(x)dx = I = 1\n$$\n这证实了重要性采样估计量对于 $I$ 是无偏的，因此 $(\\mathbb{E}_{q}[w(X)f(X)])^2 = 1^2 = 1$。因此，方差为无穷大的充要条件是二阶矩 $\\mathbb{E}_{q}\\left[(w(X)f(X))^2\\right]$ 为无穷大。\n\n接下来，我们推导二阶矩的显式积分：\n$$\n\\mathbb{E}_{q}\\left[(w(X)f(X))^2\\right] = \\int_{-\\infty}^{\\infty} (w(x)f(x))^2 q(x) dx\n$$\n代入 $f(x)=1$ 和 $w(x) = \\frac{\\pi(x)}{q(x)}$：\n$$\n\\mathbb{E}_{q}\\left[(w(X)f(X))^2\\right] = \\int_{-\\infty}^{\\infty} \\left(\\frac{\\pi(x)}{q(x)}\\right)^2 q(x) dx = \\int_{-\\infty}^{\\infty} \\frac{\\pi(x)^2}{q(x)} dx\n$$\n现在，我们代入 PDF $\\pi(x)$ 和 $q(x)$ 的表达式：\n$$\n\\frac{\\pi(x)^2}{q(x)} = \\frac{\\left(\\frac{1}{\\pi(1+x^2)}\\right)^2}{\\frac{1}{\\sqrt{2\\pi}}\\exp\\left(-\\frac{x^2}{2}\\right)} = \\frac{\\frac{1}{\\pi^2(1+x^2)^2}}{\\frac{1}{\\sqrt{2\\pi}}\\exp\\left(-\\frac{x^2}{2}\\right)} = \\frac{\\sqrt{2\\pi}}{\\pi^2} \\frac{\\exp\\left(\\frac{x^2}{2}\\right)}{(1+x^2)^2}\n$$\n二阶矩是该表达式的积分：\n$$\n\\mathbb{E}_{q}\\left[(w(X)f(X))^2\\right] = \\frac{\\sqrt{2\\pi}}{\\pi^2} \\int_{-\\infty}^{\\infty} \\frac{\\exp\\left(\\frac{x^2}{2}\\right)}{(1+x^2)^2} dx\n$$\n为了证明这个积分是发散的，我们进行一个尾部比较论证。被积函数是一个正函数。瑕积分 $\\int_{-\\infty}^{\\infty} g(x) dx$ 收敛的一个必要条件是 $\\lim_{|x| \\to \\infty} g(x) = 0$。让我们检验我们被积函数的这个极限：\n$$\n\\lim_{|x| \\to \\infty} \\frac{\\exp\\left(\\frac{x^2}{2}\\right)}{(1+x^2)^2}\n$$\n分子 $\\exp\\left(\\frac{x^2}{2}\\right)$ 呈指数增长。分母 $(1+x^2)^2$ 呈多项式增长（渐近于 $x^4$）。指数增长快于任何多项式增长是微积分的一个基本结论。因此：\n$$\n\\lim_{|x| \\to \\infty} \\frac{\\exp\\left(\\frac{x^2}{2}\\right)}{(1+x^2)^2} = +\\infty\n$$\n由于当 $|x| \\to \\infty$ 时被积函数的极限不为 $0$，不满足收敛的必要条件。因为被积函数是严格为正的，该积分必定发散到 $+\\infty$。\n$$\n\\mathbb{E}_{q}\\left[(w(X)f(X))^2\\right] = +\\infty\n$$\n出现这种情况是因为提议分布 $q(x)$（标准正态分布）的尾部衰减到零的速度（$\\exp(-x^2/2)$）远快于目标分布 $\\pi(x)$（Cauchy 分布，以 $1/x^2$ 的速度衰减）的尾部。这是一个典型的尾部覆盖不足的例子。权重函数 $w(x)$ 在尾部变得极大，导致方差爆炸。\n\n最后，我们对方差得出结论：\n$$\n\\operatorname{Var}_{q}[w(X)f(X)] = \\mathbb{E}_{q}\\left[(w(X)f(X))^2\\right] - \\left( \\mathbb{E}_{q}[w(X)f(X)] \\right)^2 = +\\infty - 1 = +\\infty\n$$\n我们成功地展示了一个例子，其中目标期望 $I$ 是有限的（$I=1$），而重要性采样估计量的方差是无穷大。", "answer": "$$\\boxed{1}$$", "id": "3241960"}, {"introduction": "在理解了选择不当提议分布的风险之后，我们现在转向分析和优化方差这一建设性任务。本练习 [@problem_id:3360244] 提供了一个具体且易于处理的场景，我们使用一个移位后的正态分布作为提议分布，来估计标准正态分布的均值。您将推导出估计量方差关于提议分布移位参数 $ \\theta $ 的闭式表达式，从而能够直观地看到提议分布的选择如何影响效率，并能通过解析方法确定最小化方差的最优提议分布。", "problem": "设 $p(x)$ 为 $\\mathbb{R}$ 上标准正态分布 $\\mathcal{N}(0,1)$ 的概率密度函数。考虑使用基于高斯提议分布族 $\\{q_{\\theta}: \\theta \\in \\mathbb{R}\\}$ 的重要性采样 (IS) 方法来估计目标期望 $I = \\mathbb{E}_{p}[f(X)]$，其中 $f(x)=x$，$q_{\\theta}(x)$ 是 $\\mathcal{N}(\\theta,1)$ 的密度函数。重要性权重定义为 $w_{\\theta}(x) = p(x)/q_{\\theta}(x)$，单次抽样的 IS 被加数为 $Y_{\\theta} = w_{\\theta}(X) f(X)$，其中 $X \\sim q_{\\theta}$。具有 $n$ 次独立同分布抽样的标准蒙特卡洛 (MC) IS 估计量为 $\\widehat{I}_{n}(\\theta) = \\frac{1}{n} \\sum_{i=1}^{n} Y_{\\theta,i}$。\n\n从重要性采样和方差的定义出发，并仅使用高斯指数族经过验证的公式（例如，正态随机变量的矩生成函数），推导方差\n$$\nV(\\theta) \\equiv \\operatorname{Var}_{q_{\\theta}}\\!\\left(Y_{\\theta}\\right),\n$$\n的闭式表达式，使其成为参数 $\\theta$ 的一个显式函数。然后，确定函数 $\\theta \\mapsto V(\\theta)$ 的所有驻点并对其进行分类。\n\n你的最终答案必须以一个使用 $\\LaTeX$ $\\pmatrix$ 环境的双元行向量形式给出，其中第一个元素是 $V(\\theta)$ 的闭式表达式，第二个元素是驻点的集合。答案的任何部分都不需要数值近似，也不涉及任何单位。如果存在多个驻点，请将它们全部列在同一个行向量的第二个元素中，并用逗号分隔。", "solution": "目标是推导方差 $V(\\theta) = \\operatorname{Var}_{q_{\\theta}}(Y_{\\theta})$ 的闭式表达式，并找出 $V(\\theta)$ 的驻点并对其进行分类。方差定义为 $V(\\theta) = \\mathbb{E}_{q_{\\theta}}[Y_{\\theta}^2] - (\\mathbb{E}_{q_{\\theta}}[Y_{\\theta}])^2$。\n\n首先，我们计算重要性采样被加数的期望值 $\\mathbb{E}_{q_{\\theta}}[Y_{\\theta}]$。\n被加数为 $Y_{\\theta} = w_{\\theta}(X) f(X)$，其中 $X \\sim q_{\\theta}$。重要性权重为 $w_{\\theta}(x) = p(x)/q_{\\theta}(x)$。\n其期望为：\n$$\n\\mathbb{E}_{q_{\\theta}}[Y_{\\theta}] = \\mathbb{E}_{q_{\\theta}}\\left[\\frac{p(X)}{q_{\\theta}(X)} f(X)\\right] = \\int_{-\\infty}^{\\infty} \\frac{p(x)}{q_{\\theta}(x)} f(x) q_{\\theta}(x) \\,dx = \\int_{-\\infty}^{\\infty} f(x) p(x) \\,dx = \\mathbb{E}_{p}[f(X)]\n$$\n这就是目标量 $I$。在本问题中，$p(x)$ 是标准正态分布 $\\mathcal{N}(0,1)$ 的概率密度函数 (PDF)，且 $f(x) = x$。\n因此，该期望是标准正态分布的均值：\n$$\n\\mathbb{E}_{q_{\\theta}}[Y_{\\theta}] = I = \\mathbb{E}_{p}[X] = 0\n$$\n由于 $Y_{\\theta}$ 的均值为 0，方差简化为二阶矩：\n$$\nV(\\theta) = \\mathbb{E}_{q_{\\theta}}[Y_{\\theta}^2] - (0)^2 = \\mathbb{E}_{q_{\\theta}}[Y_{\\theta}^2]\n$$\n\n接下来，我们推导这个二阶矩的表达式。被加数的平方为 $Y_{\\theta}^2 = (w_{\\theta}(X) f(X))^2$。\n我们首先求出权重 $w_{\\theta}(x)$ 的显式形式。$p(x)$ 的 PDF 为 $\\frac{1}{\\sqrt{2\\pi}}\\exp(-x^2/2)$，$q_{\\theta}(x)$ 的 PDF 为 $\\frac{1}{\\sqrt{2\\pi}}\\exp(-(x-\\theta)^2/2)$。\n$$\nw_{\\theta}(x) = \\frac{p(x)}{q_{\\theta}(x)} = \\frac{\\frac{1}{\\sqrt{2\\pi}}\\exp\\left(-\\frac{x^2}{2}\\right)}{\\frac{1}{\\sqrt{2\\pi}}\\exp\\left(-\\frac{(x-\\theta)^2}{2}\\right)} = \\exp\\left(-\\frac{x^2}{2} + \\frac{(x-\\theta)^2}{2}\\right)\n$$\n指数项可简化为：\n$$\n-\\frac{x^2}{2} + \\frac{x^2 - 2\\theta x + \\theta^2}{2} = \\frac{-x^2 + x^2 - 2\\theta x + \\theta^2}{2} = -\\theta x + \\frac{\\theta^2}{2}\n$$\n因此，权重为 $w_{\\theta}(x) = \\exp(-\\theta x + \\theta^2/2)$。\n被加数为 $Y_{\\theta} = f(X) w_{\\theta}(X) = X \\exp(-\\theta X + \\theta^2/2)$，其中 $X \\sim q_{\\theta}$，即 $X \\sim \\mathcal{N}(\\theta, 1)$。\n被加数的平方为 $Y_{\\theta}^2 = X^2 \\exp(-2\\theta X + \\theta^2)$。\n现在我们在 $q_{\\theta}$ 下计算其期望：\n$$\nV(\\theta) = \\mathbb{E}_{q_{\\theta}}[Y_{\\theta}^2] = \\mathbb{E}_{q_{\\theta}}\\left[X^2 \\exp(-2\\theta X + \\theta^2)\\right] = \\exp(\\theta^2) \\mathbb{E}_{q_{\\theta}}\\left[X^2 \\exp(-2\\theta X)\\right]\n$$\n为了计算该期望，我们使用 $X \\sim \\mathcal{N}(\\theta, 1)$ 的矩生成函数 (MGF)。一个一般正态随机变量 $Z \\sim \\mathcal{N}(\\mu, \\sigma^2)$ 的 MGF 是 $M_Z(t) = \\exp(\\mu t + \\sigma^2 t^2/2)$。对于 $X \\sim \\mathcal{N}(\\theta, 1)$，我们有 $\\mu = \\theta$ 和 $\\sigma^2 = 1$，所以其 MGF 为：\n$$\nM_X(t) = \\mathbb{E}_{q_{\\theta}}[\\exp(tX)] = \\exp(\\theta t + t^2/2)\n$$\n我们使用性质 $\\mathbb{E}_{q_{\\theta}}[X^2 \\exp(tX)] = \\frac{d^2}{dt^2} M_X(t)$。\n一阶导数：\n$$\n\\frac{d}{dt} M_X(t) = \\frac{d}{dt} \\exp(\\theta t + t^2/2) = (\\theta + t) \\exp(\\theta t + t^2/2)\n$$\n二阶导数（使用乘法法则）：\n$$\n\\frac{d^2}{dt^2} M_X(t) = \\frac{d}{dt} \\left[(\\theta + t) \\exp(\\theta t + t^2/2)\\right] = (1)\\exp(\\theta t + t^2/2) + (\\theta + t)(\\theta + t)\\exp(\\theta t + t^2/2) = \\left[1 + (\\theta + t)^2\\right] \\exp(\\theta t + t^2/2)\n$$\n我们需要计算 $\\mathbb{E}_{q_{\\theta}}[X^2 \\exp(-2\\theta X)]$，这对应于在 MGF 的二阶导数表达式中令 $t = -2\\theta$：\n\\begin{align*}\n\\mathbb{E}_{q_{\\theta}}\\left[X^2 \\exp(-2\\theta X)\\right] = \\left[1 + (\\theta + (-2\\theta))^2\\right] \\exp\\left(\\theta(-2\\theta) + \\frac{(-2\\theta)^2}{2}\\right) \\\\\n= \\left[1 + (-\\theta)^2\\right] \\exp\\left(-2\\theta^2 + \\frac{4\\theta^2}{2}\\right) \\\\\n= (1 + \\theta^2) \\exp(-2\\theta^2 + 2\\theta^2) \\\\\n= (1 + \\theta^2) \\exp(0) = 1 + \\theta^2\n\\end{align*}\n将此结果代回 $V(\\theta)$ 的表达式中：\n$$\nV(\\theta) = \\exp(\\theta^2) \\cdot (1 + \\theta^2)\n$$\n因此，方差的闭式表达式为 $V(\\theta) = (1 + \\theta^2)\\exp(\\theta^2)$。\n\n接下来，我们找出并分类 $V(\\theta)$ 的驻点。驻点出现在一阶导数 $V'(\\theta) = \\frac{dV}{d\\theta}$ 为零的地方。我们使用乘法法则来对 $V(\\theta)$ 求导：\n$$\nV'(\\theta) = \\frac{d}{d\\theta}\\left[(1 + \\theta^2)\\exp(\\theta^2)\\right] = \\left(\\frac{d}{d\\theta}(1+\\theta^2)\\right)\\exp(\\theta^2) + (1+\\theta^2)\\left(\\frac{d}{d\\theta}\\exp(\\theta^2)\\right)\n$$\n$$\nV'(\\theta) = (2\\theta)\\exp(\\theta^2) + (1+\\theta^2)(2\\theta\\exp(\\theta^2)) = 2\\theta\\exp(\\theta^2) [1 + (1+\\theta^2)] = 2\\theta(2+\\theta^2)\\exp(\\theta^2)\n$$\n为了找到驻点，我们令 $V'(\\theta) = 0$：\n$$\n2\\theta(2+\\theta^2)\\exp(\\theta^2) = 0\n$$\n对于任意实数 $\\theta$，$\\exp(\\theta^2) > 0$ 且 $2+\\theta^2 \\ge 2 > 0$。因此，乘积为零的唯一可能是 $2\\theta = 0$，这意味着 $\\theta = 0$。\n在 $\\theta = 0$ 处有一个唯一的驻点。\n\n为了对这个驻点进行分类，我们使用二阶导数检验。我们计算 $V''(\\theta) = \\frac{d^2V}{d\\theta^2}$。\n我们对 $V'(\\theta) = (4\\theta+2\\theta^3)\\exp(\\theta^2)$ 求导：\n$$\nV''(\\theta) = \\frac{d}{d\\theta}\\left[(4\\theta+2\\theta^3)\\exp(\\theta^2)\\right] = (4+6\\theta^2)\\exp(\\theta^2) + (4\\theta+2\\theta^3)(2\\theta\\exp(\\theta^2))\n$$\n$$\nV''(\\theta) = \\exp(\\theta^2) \\left[ (4+6\\theta^2) + 2\\theta(4\\theta+2\\theta^3) \\right] = \\exp(\\theta^2) \\left[ 4+6\\theta^2+8\\theta^2+4\\theta^4 \\right]\n$$\n$$\nV''(\\theta) = (4\\theta^4 + 14\\theta^2 + 4)\\exp(\\theta^2)\n$$\n现在，我们在驻点 $\\theta = 0$ 处计算二阶导数的值：\n$$\nV''(0) = (4(0)^4 + 14(0)^2 + 4)\\exp(0) = (4)(1) = 4\n$$\n由于 $V''(0) = 4 > 0$，驻点 $\\theta=0$ 对应于一个局部最小值。\n此外，对于任意实数 $\\theta$，$V(\\theta) = (1+\\theta^2)\\exp(\\theta^2) \\ge (1)\\exp(0) = 1$，且 $V(0) = 1$。因此，$\\theta=0$ 是一个全局最小值。", "answer": "$$\n\\boxed{\\begin{pmatrix} (1+\\theta^2)\\exp(\\theta^2)  0 \\end{pmatrix}}\n$$", "id": "3360244"}, {"introduction": "除了优化提议分布之外，我们还可以通过结合其他方差缩减技术来显著增强重要性抽样的威力。本练习 [@problem_id:3360258] 探讨了重要性抽样与控制变量法之间的协同作用。您将首先推导出一个基于重要性权重 $w(X)$ 本身的自然控制变量 $w(X) - 1$ 的最优系数的一般形式，然后将此框架应用于一个涉及偏斜对数正态分布的实际问题，从而展示一种设计高效蒙特卡洛估计量的强大复合策略。", "problem": "考虑通过从 $\\mathbb{R}_{+}$ 上的提议密度 $q(x)$ 进行重要性采样来估计积分 $I = \\int_{0}^{\\infty} f(x)\\,p(x)\\,\\mathrm{d}x = \\mathbb{E}_{p}[f(X)]$，使用标准重要性采样估计量 $Z = w(X)\\,f(X)$，其中重要性权重为 $w(x) = p(x)/q(x)$ 且 $X \\sim q$。蒙特卡洛 (MC) 模拟中一种经典的方差缩减技术是使用控制变量。在这种情况下，一个在 $q$ 下的自然零均值控制变量是 $Y = w(X) - 1$，因为 $\\mathbb{E}_{q}[w(X)] = 1$。考虑对于标量 $c \\in \\mathbb{R}$ 的受控估计量 $Z_{c} = w(X)\\,f(X) - c\\,(w(X) - 1)$。\n\n仅从期望、方差和协方差的定义，以及对于任何可积函数 $g$ 的无偏恒等式 $\\mathbb{E}_{q}[w(X)\\,g(X)] = \\mathbb{E}_{p}[g(X)]$ 出发，完成以下任务：\n\n1. 证明对于任何 $c$，$Z_{c}$ 对 $I$ 都是无偏的，并推导使 $\\mathrm{Var}_{q}(Z_{c})$ 最小化的 $c$ 的值。用提议分布 $q$ 下的协方差和方差来表示你的结果。\n\n2. 为了测试在重要性权重与乘积 $w(X)\\,f(X)$ 强相关的偏斜目标上的效果，考虑以下特定选择。令目标密度 $p$ 为参数为 $\\mu_{p}$ 和 $\\sigma$ 的对数正态分布（即，在 $p$ 下 $\\ln X \\sim \\mathcal{N}(\\mu_{p}, \\sigma^{2})$），提议密度 $q$ 为参数为 $\\mu_{q}$ 和相同 $\\sigma$ 的对数正态分布（即，在 $q$ 下 $\\ln X \\sim \\mathcal{N}(\\mu_{q}, \\sigma^{2})$）。设被积函数为 $f(x) = x$。仅使用正态分布的矩生成函数，推导 $\\mathrm{Var}_{q}(w)$、$\\mathbb{E}_{q}[w(X)\\,f(X)]$ 和 $\\mathbb{E}_{q}[w(X)^{2}\\,f(X)]$ 的闭式表达式，并由此将最优 $c$ 简化为一个依赖于 $\\mu_{p}$、$\\mu_{q}$ 和 $\\sigma$ 的闭式表达式。\n\n3. 对于参数值 $\\mu_{p} = 2$，$\\mu_{q} = 0$ 和 $\\sigma = 1.2$，计算你简化的最优 $c$。将你的答案四舍五入到四位有效数字。仅提供最优 $c$ 的数值作为你的最终答案。", "solution": "该问题包含三个部分。首先，我们必须证明一个受控重要性采样估计量的无偏性，并推导最优控制变量系数。其次，我们必须将此结果应用于涉及对数正态分布的特定情况，并推导所需量的闭式表达式。最后，我们必须为一组给定的参数计算最优系数。\n\n### 第1部分：无偏性和最优控制系数\n\n令我们感兴趣的积分为 $I = \\mathbb{E}_{p}[f(X)] = \\int_{0}^{\\infty} f(x)\\,p(x)\\,\\mathrm{d}x$。标准重要性采样估计量是 $Z = w(X)f(X)$，其中 $X \\sim q(x)$ 且 $w(x) = p(x)/q(x)$。提出的受控估计量是 $Z_c = w(X)f(X) - c(w(X) - 1)$，对于标量 $c \\in \\mathbb{R}$。控制变量是 $Y = w(X) - 1$。\n\n为了证明 $Z_c$ 是 $I$ 的一个无偏估计量，我们必须证明其在提议分布 $q$ 下的期望等于 $I$。\n我们计算 $Z_c$ 关于 $q$ 的期望：\n$$ \\mathbb{E}_{q}[Z_c] = \\mathbb{E}_{q}[w(X)f(X) - c(w(X) - 1)] $$\n根据期望的线性性质，\n$$ \\mathbb{E}_{q}[Z_c] = \\mathbb{E}_{q}[w(X)f(X)] - c\\,\\mathbb{E}_{q}[w(X) - 1] $$\n$$ \\mathbb{E}_{q}[Z_c] = \\mathbb{E}_{q}[w(X)f(X)] - c\\,(\\mathbb{E}_{q}[w(X)] - 1) $$\n我们使用给定的无偏恒等式 $\\mathbb{E}_{q}[w(X)g(X)] = \\mathbb{E}_{p}[g(X)]$。\n对于 $g(X) = f(X)$，我们有 $\\mathbb{E}_{q}[w(X)f(X)] = \\mathbb{E}_{p}[f(X)] = I$。\n对于 $g(X) = 1$，一个常数函数，我们有 $\\mathbb{E}_{q}[w(X) \\cdot 1] = \\mathbb{E}_{p}[1] = \\int p(x) \\cdot 1 \\, \\mathrm{d}x = 1$，因为 $p(x)$ 是一个概率密度函数。\n将这些结果代回 $\\mathbb{E}_{q}[Z_c]$ 的表达式中：\n$$ \\mathbb{E}_{q}[Z_c] = I - c\\,(1 - 1) = I - 0 = I $$\n因此，对于任何 $c \\in \\mathbb{R}$ 的选择，$Z_c$ 都是 $I$ 的无偏估计量。\n\n接下来，我们找出使 $Z_c$ 在 $q$ 下的方差最小的 $c$ 值。方差由下式给出：\n$$ \\mathrm{Var}_{q}(Z_c) = \\mathrm{Var}_{q}(w(X)f(X) - c(w(X) - 1)) $$\n令 $Z_0 = w(X)f(X)$ 和 $Y = w(X) - 1$。我们希望最小化关于 $c$ 的 $\\mathrm{Var}_{q}(Z_0 - cY)$。使用随机变量线性组合方差的标准公式：\n$$ \\mathrm{Var}_{q}(Z_0 - cY) = \\mathrm{Var}_{q}(Z_0) + c^2 \\mathrm{Var}_{q}(Y) - 2c\\,\\mathrm{Cov}_{q}(Z_0, Y) $$\n这个表达式是关于 $c$ 的二次式。为了找到最小值，我们对 $c$ 求导并令其等于 $0$：\n$$ \\frac{\\mathrm{d}}{\\mathrm{d}c} \\mathrm{Var}_{q}(Z_c) = 2c\\,\\mathrm{Var}_{q}(Y) - 2\\,\\mathrm{Cov}_{q}(Z_0, Y) = 0 $$\n解出 $c$ 得到最优系数 $c_{\\mathrm{opt}}$：\n$$ c_{\\mathrm{opt}} = \\frac{\\mathrm{Cov}_{q}(Z_0, Y)}{\\mathrm{Var}_{q}(Y)} $$\n现在，我们将 $Z_0$ 和 $Y$ 的定义代回此表达式：\n$$ c_{\\mathrm{opt}} = \\frac{\\mathrm{Cov}_{q}(w(X)f(X), w(X) - 1)}{\\mathrm{Var}_{q}(w(X) - 1)} $$\n分母中的方差可以简化，因为加上一个常数不改变方差：\n$$ \\mathrm{Var}_{q}(w(X) - 1) = \\mathrm{Var}_{q}(w(X)) $$\n分子中的协方差可以使用协方差的双线性性质展开：\n$$ \\mathrm{Cov}_{q}(w(X)f(X), w(X) - 1) = \\mathrm{Cov}_{q}(w(X)f(X), w(X)) - \\mathrm{Cov}_{q}(w(X)f(X), 1) $$\n与常数的协方差为零，所以第二项消失。\n因此，最优系数为：\n$$ c_{\\mathrm{opt}} = \\frac{\\mathrm{Cov}_{q}(w(X)f(X), w(X))}{\\mathrm{Var}_{q}(w(X))} $$\n这就是用提议分布 $q$ 下的协方差和方差表示的所求表达式。\n\n### 第2部分：对数正态分布的特例\n\n给定 $p$ 和 $q$ 是对数正态密度且 $f(x)=x$。\n如果 $X \\sim q$，则 $\\ln X \\sim \\mathcal{N}(\\mu_q, \\sigma^2)$。$q$ 的密度为 $q(x) = \\frac{1}{x\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(\\ln x - \\mu_q)^2}{2\\sigma^2}\\right)$。\n如果一个变量是从 $p$ 中抽取的，它的对数将服从 $\\mathcal{N}(\\mu_p, \\sigma^2)$ 分布。$p$ 的密度为 $p(x) = \\frac{1}{x\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(\\ln x - \\mu_p)^2}{2\\sigma^2}\\right)$。\n重要性权重是 $w(x) = \\frac{p(x)}{q(x)}$：\n$$ w(x) = \\frac{\\exp\\left(-\\frac{(\\ln x - \\mu_p)^2}{2\\sigma^2}\\right)}{\\exp\\left(-\\frac{(\\ln x - \\mu_q)^2}{2\\sigma^2}\\right)} = \\exp\\left(\\frac{(\\ln x - \\mu_q)^2 - (\\ln x - \\mu_p)^2}{2\\sigma^2}\\right) $$\n展开指数中的平方项得到 $\\frac{1}{2\\sigma^2}((\\ln^2 x - 2\\mu_q \\ln x + \\mu_q^2) - (\\ln^2 x - 2\\mu_p \\ln x + \\mu_p^2)) = \\frac{2(\\mu_p - \\mu_q)\\ln x - (\\mu_p^2 - \\mu_q^2)}{2\\sigma^2}$。\n令 $\\Delta\\mu = \\mu_p - \\mu_q$。权重为 $w(x) = \\exp\\left(\\frac{\\Delta\\mu}{\\sigma^2}\\ln x - \\frac{\\mu_p^2 - \\mu_q^2}{2\\sigma^2}\\right)$。\n\n我们将使用正态分布的矩生成函数（MGF）来计算必要的期望值。如果 $Y \\sim \\mathcal{N}(\\mu, \\sigma^2)$，其 MGF 是 $M_Y(t) = \\mathbb{E}[e^{tY}] = \\exp(\\mu t + \\frac{1}{2}\\sigma^2 t^2)$。\n由于 $X \\sim q$，我们有 $Y = \\ln X \\sim \\mathcal{N}(\\mu_q, \\sigma^2)$。$X$ 的 $k$ 阶矩是 $\\mathbb{E}_q[X^k] = \\mathbb{E}_q[e^{k \\ln X}] = \\mathbb{E}_q[e^{kY}] = M_Y(k)$。\n所以，$\\mathbb{E}_q[X^k] = \\exp(k\\mu_q + \\frac{1}{2}k^2\\sigma^2)$。\n\n让我们推导三个所需的量：\n1.  **$\\mathrm{Var}_{q}(w)$**：我们需要 $\\mathbb{E}_q[w^2]$。首先，注意到 $\\mathbb{E}_q[w]=1$。\n    $$ w(x)^2 = \\exp\\left(2\\frac{\\Delta\\mu}{\\sigma^2}\\ln x - \\frac{\\mu_p^2 - \\mu_q^2}{\\sigma^2}\\right) = \\exp\\left(-\\frac{\\mu_p^2 - \\mu_q^2}{\\sigma^2}\\right) x^{2\\Delta\\mu/\\sigma^2} $$\n    $$ \\mathbb{E}_q[w(X)^2] = \\exp\\left(-\\frac{\\mu_p^2 - \\mu_q^2}{\\sigma^2}\\right) \\mathbb{E}_q\\left[X^{2\\Delta\\mu/\\sigma^2}\\right] $$\n    使用矩公式，其中 $k = 2\\Delta\\mu/\\sigma^2$：\n    $$ \\mathbb{E}_q[w(X)^2] = \\exp\\left(-\\frac{\\mu_p^2 - \\mu_q^2}{\\sigma^2}\\right) \\exp\\left(\\left(\\frac{2\\Delta\\mu}{\\sigma^2}\\right)\\mu_q + \\frac{1}{2}\\left(\\frac{2\\Delta\\mu}{\\sigma^2}\\right)^2\\sigma^2\\right) $$\n    指数是 $\\frac{1}{\\sigma^2} [-(\\mu_p^2-\\mu_q^2) + 2\\Delta\\mu\\mu_q + 2(\\Delta\\mu)^2] = \\frac{1}{\\sigma^2}[-(\\mu_p-\\mu_q)(\\mu_p+\\mu_q) + 2(\\mu_p-\\mu_q)\\mu_q + 2(\\mu_p-\\mu_q)^2]$。\n    提出因子 $(\\mu_p-\\mu_q)$：$\\frac{\\mu_p-\\mu_q}{\\sigma^2}[-(\\mu_p+\\mu_q) + 2\\mu_q + 2(\\mu_p-\\mu_q)] = \\frac{\\mu_p-\\mu_q}{\\sigma^2}[\\mu_p-\\mu_q] = \\frac{(\\mu_p-\\mu_q)^2}{\\sigma^2}$。\n    $$ \\mathbb{E}_q[w(X)^2] = \\exp\\left(\\frac{(\\mu_p - \\mu_q)^2}{\\sigma^2}\\right) $$\n    因此，$\\mathrm{Var}_{q}(w) = \\mathbb{E}_q[w^2] - (\\mathbb{E}_q[w])^2 = \\exp\\left(\\frac{(\\mu_p - \\mu_q)^2}{\\sigma^2}\\right) - 1$。\n\n2.  **$\\mathbb{E}_{q}[w(X)f(X)]$**：由于 $f(x)=x$ 并使用恒等式 $\\mathbb{E}_{q}[w(X)g(X)] = \\mathbb{E}_{p}[g(X)]$：\n    $$ \\mathbb{E}_{q}[w(X)f(X)] = \\mathbb{E}_{p}[f(X)] = \\mathbb{E}_{p}[X] $$\n    这是参数为 $\\mu_p$ 和 $\\sigma^2$ 的对数正态随机变量的期望值。如果 $Z \\sim p$，则 $\\ln Z \\sim \\mathcal{N}(\\mu_p, \\sigma^2)$。均值为 $\\mathbb{E}_p[Z] = \\exp(\\mu_p + \\frac{1}{2}\\sigma^2)$。\n    $$ \\mathbb{E}_{q}[w(X)f(X)] = \\exp\\left(\\mu_p + \\frac{\\sigma^2}{2}\\right) $$\n\n3.  **$\\mathbb{E}_{q}[w(X)^2 f(X)]$**：我们有 $w(x)^2 f(x) = w(x)^2 x$。\n    $$ w(x)^2 x = \\exp\\left(-\\frac{\\mu_p^2 - \\mu_q^2}{\\sigma^2}\\right) x^{2\\Delta\\mu/\\sigma^2} \\cdot x = \\exp\\left(-\\frac{\\mu_p^2 - \\mu_q^2}{\\sigma^2}\\right) x^{1+2\\Delta\\mu/\\sigma^2} $$\n    $$ \\mathbb{E}_{q}[w(X)^2 f(X)] = \\exp\\left(-\\frac{\\mu_p^2 - \\mu_q^2}{\\sigma^2}\\right) \\mathbb{E}_{q}\\left[X^{1+2\\Delta\\mu/\\sigma^2}\\right] $$\n    使用矩公式，其中 $k = 1 + 2\\Delta\\mu/\\sigma^2$：\n    $$ \\mathbb{E}_q[X^k] = \\exp\\left(\\left(1+\\frac{2\\Delta\\mu}{\\sigma^2}\\right)\\mu_q + \\frac{1}{2}\\left(1+\\frac{2\\Delta\\mu}{\\sigma^2}\\right)^2\\sigma^2\\right) $$\n    $$ = \\exp\\left(\\mu_q + \\frac{2\\Delta\\mu\\mu_q}{\\sigma^2} + \\frac{\\sigma^2}{2} + 2\\Delta\\mu + \\frac{2(\\Delta\\mu)^2}{\\sigma^2}\\right) $$\n    完整的指数是 $-\\frac{\\mu_p^2-\\mu_q^2}{\\sigma^2} + \\mu_q + \\frac{2\\Delta\\mu\\mu_q}{\\sigma^2} + \\frac{\\sigma^2}{2} + 2\\Delta\\mu + \\frac{2(\\Delta\\mu)^2}{\\sigma^2}$。\n    此式可化简为 $2\\mu_p - \\mu_q + \\frac{\\sigma^2}{2} + \\frac{(\\mu_p-\\mu_q)^2}{\\sigma^2}$。\n    $$ \\mathbb{E}_{q}[w(X)^2 f(X)] = \\exp\\left(2\\mu_p - \\mu_q + \\frac{\\sigma^2}{2} + \\frac{(\\mu_p - \\mu_q)^2}{\\sigma^2}\\right) $$\n\n现在，我们推导 $c_{\\mathrm{opt}}$ 的简化表达式。\n$c_{\\mathrm{opt}} = \\frac{\\mathrm{Cov}_{q}(wf, w)}{\\mathrm{Var}_{q}(w)} = \\frac{\\mathbb{E}_q[w^2 f] - \\mathbb{E}_q[wf]\\mathbb{E}_q[w]}{\\mathbb{E}_q[w^2] - (\\mathbb{E}_q[w])^2} = \\frac{\\mathbb{E}_q[w^2 f] - \\mathbb{E}_q[wf]}{\\mathbb{E}_q[w^2] - 1}$。\n代入推导出的表达式：\n$$ c_{\\mathrm{opt}} = \\frac{\\exp\\left(2\\mu_p - \\mu_q + \\frac{\\sigma^2}{2} + \\frac{(\\mu_p - \\mu_q)^2}{\\sigma^2}\\right) - \\exp\\left(\\mu_p + \\frac{\\sigma^2}{2}\\right)}{\\exp\\left(\\frac{(\\mu_p - \\mu_q)^2}{\\sigma^2}\\right) - 1} $$\n令 $\\Delta\\mu = \\mu_p - \\mu_q$。分子中的第一项可以重写为：\n$\\exp\\left(2\\mu_p - \\mu_q + \\frac{\\sigma^2}{2} + \\frac{\\Delta\\mu^2}{\\sigma^2}\\right) = \\exp\\left(\\mu_p + \\Delta\\mu + \\frac{\\sigma^2}{2} + \\frac{\\Delta\\mu^2}{\\sigma^2}\\right) = \\exp\\left(\\mu_p + \\frac{\\sigma^2}{2}\\right) \\exp\\left(\\Delta\\mu + \\frac{\\Delta\\mu^2}{\\sigma^2}\\right)$。\n分子变为 $\\exp\\left(\\mu_p + \\frac{\\sigma^2}{2}\\right) \\left[ \\exp\\left(\\Delta\\mu + \\frac{\\Delta\\mu^2}{\\sigma^2}\\right) - 1 \\right]$。\n所以，$c_{\\mathrm{opt}}$ 的最终简化表达式为：\n$$ c_{\\mathrm{opt}} = \\exp\\left(\\mu_p + \\frac{\\sigma^2}{2}\\right) \\frac{\\exp\\left((\\mu_p-\\mu_q) + \\frac{(\\mu_p-\\mu_q)^2}{\\sigma^2}\\right) - 1}{\\exp\\left(\\frac{(\\mu_p-\\mu_q)^2}{\\sigma^2}\\right) - 1} $$\n\n### 第3部分：数值计算\n\n给定的参数值为 $\\mu_p = 2$，$\\mu_q = 0$ 和 $\\sigma = 1.2$。\n由此，我们计算：\n$\\Delta\\mu = \\mu_p - \\mu_q = 2 - 0 = 2$。\n$\\sigma^2 = (1.2)^2 = 1.44$。\n现在我们计算 $c_{\\mathrm{opt}}$ 表达式中的各项：\n前置因子：\n$$ \\exp\\left(\\mu_p + \\frac{\\sigma^2}{2}\\right) = \\exp\\left(2 + \\frac{1.44}{2}\\right) = \\exp(2.72) $$\n分母指数中的项：\n$$ \\frac{(\\mu_p-\\mu_q)^2}{\\sigma^2} = \\frac{2^2}{1.44} = \\frac{4}{1.44} = \\frac{400}{144} = \\frac{100}{36} = \\frac{25}{9} $$\n分子指数中的项：\n$$ (\\mu_p-\\mu_q) + \\frac{(\\mu_p-\\mu_q)^2}{\\sigma^2} = 2 + \\frac{25}{9} = \\frac{18}{9} + \\frac{25}{9} = \\frac{43}{9} $$\n将这些代入 $c_{\\mathrm{opt}}$ 的公式中：\n$$ c_{\\mathrm{opt}} = \\exp(2.72) \\frac{\\exp\\left(\\frac{43}{9}\\right) - 1}{\\exp\\left(\\frac{25}{9}\\right) - 1} $$\n现在我们对该表达式进行数值计算：\n$$ \\exp(2.72) \\approx 15.1798135 $$\n$$ \\exp\\left(\\frac{25}{9}\\right) \\approx \\exp(2.7777...) \\approx 16.0825206 $$\n$$ \\exp\\left(\\frac{43}{9}\\right) \\approx \\exp(4.7777...) \\approx 118.825049 $$\n$$ c_{\\mathrm{opt}} \\approx 15.1798135 \\times \\frac{118.825049 - 1}{16.0825206 - 1} = 15.1798135 \\times \\frac{117.825049}{15.0825206} \\approx 15.1798135 \\times 7.8120601 \\approx 118.58135 $$\n将结果四舍五入到四位有效数字得到 $118.6$。", "answer": "$$\n\\boxed{118.6}\n$$", "id": "3360258"}]}