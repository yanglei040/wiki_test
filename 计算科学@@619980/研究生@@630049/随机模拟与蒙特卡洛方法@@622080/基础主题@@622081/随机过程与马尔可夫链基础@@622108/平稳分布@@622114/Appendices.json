{"hands_on_practices": [{"introduction": "理解平稳分布的第一个关键步骤是掌握其基本定义和计算方法。本练习提供了一个具体、小规模的离散马尔可夫链，旨在通过直接求解线性方程组 $\\pi = \\pi P$ 来精确计算其平稳分布。这个基础性的计算实践 [@problem_id:3347139] 能够帮助你巩固平稳分布作为转移矩阵左特征值为 1 的特征向量的核心概念，并熟练掌握验证其不变性和归一性的标准流程。", "problem": "考虑一个离散时间、有限状态的马尔可夫链，其状态空间为 $\\{1,2,3,4\\}$，行随机转移矩阵 $P$ 如下所示：\n$$\nP \\;=\\;\n\\begin{pmatrix}\n\\frac{1}{2}  \\frac{1}{2}  0  0 \\\\\n\\frac{1}{4}  \\frac{1}{2}  \\frac{1}{4}  0 \\\\\n0  \\frac{1}{3}  \\frac{1}{3}  \\frac{1}{3} \\\\\n\\frac{1}{6}  0  \\frac{1}{2}  \\frac{1}{3}\n\\end{pmatrix}.\n$$\n仅使用马尔可夫链转移矩阵和平稳（不变）分布的基本定义，推导并精确计算满足 $\\pi = \\pi P$、$\\sum_{i=1}^{4} \\pi_i = 1$ 且对所有 $i$ 都有 $\\pi_i \\ge 0$ 的平稳分布向量 $\\pi$。将 $\\pi$ 表示为最简有理数形式，并显式地验证计算出的 $\\pi$ 满足不变性和归一化条件。最终答案必须是写成单个行矩阵形式的平稳分布向量。无需四舍五入。", "solution": "平稳分布 $\\pi = \\begin{pmatrix} \\pi_1  \\pi_2  \\pi_3  \\pi_4 \\end{pmatrix}$ 必须满足矩阵方程 $\\pi P = \\pi$。这对应于以下线性方程组：\n$$\n\\begin{cases}\n\\pi_1 = \\frac{1}{2}\\pi_1 + \\frac{1}{4}\\pi_2 + (0)\\pi_3 + \\frac{1}{6}\\pi_4 \\\\\n\\pi_2 = \\frac{1}{2}\\pi_1 + \\frac{1}{2}\\pi_2 + \\frac{1}{3}\\pi_3 + (0)\\pi_4 \\\\\n\\pi_3 = (0)\\pi_1 + \\frac{1}{4}\\pi_2 + \\frac{1}{3}\\pi_3 + \\frac{1}{2}\\pi_4 \\\\\n\\pi_4 = (0)\\pi_1 + (0)\\pi_2 + \\frac{1}{3}\\pi_3 + \\frac{1}{3}\\pi_4\n\\end{cases}\n$$\n该方程组可以重写为 $\\pi(P - I) = 0$，其中 $I$ 是单位矩阵。\n$$\n\\begin{cases}\n-\\frac{1}{2}\\pi_1 + \\frac{1}{4}\\pi_2 + \\frac{1}{6}\\pi_4 = 0  (1) \\\\\n\\frac{1}{2}\\pi_1 - \\frac{1}{2}\\pi_2 + \\frac{1}{3}\\pi_3 = 0  (2) \\\\\n\\frac{1}{4}\\pi_2 - \\frac{2}{3}\\pi_3 + \\frac{1}{2}\\pi_4 = 0  (3) \\\\\n\\frac{1}{3}\\pi_3 - \\frac{2}{3}\\pi_4 = 0  (4)\n\\end{cases}\n$$\n该方程组是线性相关的。我们将用一个变量表示其他三个变量，然后使用归一化条件 $\\pi_1 + \\pi_2 + \\pi_3 + \\pi_4 = 1$ 进行求解。\n\n从方程 (4) 得：\n$$\n\\frac{1}{3}\\pi_3 = \\frac{2}{3}\\pi_4 \\implies \\pi_3 = 2\\pi_4\n$$\n将 $\\pi_3 = 2\\pi_4$ 代入方程 (3)：\n$$\n\\frac{1}{4}\\pi_2 - \\frac{2}{3}(2\\pi_4) + \\frac{1}{2}\\pi_4 = 0 \\\\\n\\frac{1}{4}\\pi_2 - \\frac{4}{3}\\pi_4 + \\frac{1}{2}\\pi_4 = 0 \\\\\n\\frac{1}{4}\\pi_2 = \\left(\\frac{4}{3} - \\frac{1}{2}\\right)\\pi_4 = \\left(\\frac{8-3}{6}\\right)\\pi_4 = \\frac{5}{6}\\pi_4 \\\\\n\\pi_2 = 4 \\cdot \\frac{5}{6}\\pi_4 = \\frac{20}{6}\\pi_4 = \\frac{10}{3}\\pi_4\n$$\n将 $\\pi_2 = \\frac{10}{3}\\pi_4$ 和 $\\pi_3 = 2\\pi_4$ 代入方程 (2)：\n$$\n\\frac{1}{2}\\pi_1 - \\frac{1}{2}\\left(\\frac{10}{3}\\pi_4\\right) + \\frac{1}{3}(2\\pi_4) = 0 \\\\\n\\frac{1}{2}\\pi_1 - \\frac{5}{3}\\pi_4 + \\frac{2}{3}\\pi_4 = 0 \\\\\n\\frac{1}{2}\\pi_1 - \\frac{3}{3}\\pi_4 = 0 \\\\\n\\frac{1}{2}\\pi_1 = \\pi_4 \\implies \\pi_1 = 2\\pi_4\n$$\n现在我们用 $\\pi_4$ 表示所有分量，并应用归一化条件 $\\pi_1 + \\pi_2 + \\pi_3 + \\pi_4 = 1$：\n$$\n2\\pi_4 + \\frac{10}{3}\\pi_4 + 2\\pi_4 + \\pi_4 = 1 \\\\\n\\left(2 + \\frac{10}{3} + 2 + 1\\right)\\pi_4 = 1 \\\\\n\\left(5 + \\frac{10}{3}\\right)\\pi_4 = 1 \\\\\n\\left(\\frac{15+10}{3}\\right)\\pi_4 = 1 \\\\\n\\frac{25}{3}\\pi_4 = 1 \\implies \\pi_4 = \\frac{3}{25}\n$$\n现在我们可以计算其他分量：\n$$\n\\pi_1 = 2\\pi_4 = 2 \\left( \\frac{3}{25} \\right) = \\frac{6}{25} \\\\\n\\pi_2 = \\frac{10}{3}\\pi_4 = \\frac{10}{3} \\left( \\frac{3}{25} \\right) = \\frac{10}{25} = \\frac{2}{5} \\\\\n\\pi_3 = 2\\pi_4 = 2 \\left( \\frac{3}{25} \\right) = \\frac{6}{25}\n$$\n因此，平稳分布为 $\\pi = \\begin{pmatrix} \\frac{6}{25}  \\frac{2}{5}  \\frac{6}{25}  \\frac{3}{25} \\end{pmatrix}$。\n\n**显式验证**\n\n1.  **归一化检验**：\n    $$\n    \\sum_{i=1}^{4} \\pi_i = \\frac{6}{25} + \\frac{2}{5} + \\frac{6}{25} + \\frac{3}{25} = \\frac{6}{25} + \\frac{10}{25} + \\frac{6}{25} + \\frac{3}{25} = \\frac{6+10+6+3}{25} = \\frac{25}{25} = 1\n    $$\n    归一化条件得到满足。\n\n2.  **不变性检验** ($\\pi = \\pi P$)：\n    $$\n    \\pi P = \\begin{pmatrix} \\frac{6}{25}  \\frac{10}{25}  \\frac{6}{25}  \\frac{3}{25} \\end{pmatrix} \\begin{pmatrix}\n    \\frac{1}{2}  \\frac{1}{2}  0  0 \\\\\n    \\frac{1}{4}  \\frac{1}{2}  \\frac{1}{4}  0 \\\\\n    0  \\frac{1}{3}  \\frac{1}{3}  \\frac{1}{3} \\\\\n    \\frac{1}{6}  0  \\frac{1}{2}  \\frac{1}{3}\n    \\end{pmatrix}\n    $$\n    让我们计算结果向量的每个元素：\n    - $(\\pi P)_1 = (\\frac{6}{25})(\\frac{1}{2}) + (\\frac{10}{25})(\\frac{1}{4}) + (\\frac{6}{25})(0) + (\\frac{3}{25})(\\frac{1}{6}) = \\frac{3}{25} + \\frac{5}{50} + 0 + \\frac{1}{50} = \\frac{6}{50} + \\frac{5}{50} + \\frac{1}{50} = \\frac{12}{50} = \\frac{6}{25} = \\pi_1$。\n    - $(\\pi P)_2 = (\\frac{6}{25})(\\frac{1}{2}) + (\\frac{10}{25})(\\frac{1}{2}) + (\\frac{6}{25})(\\frac{1}{3}) + (\\frac{3}{25})(0) = \\frac{3}{25} + \\frac{5}{25} + \\frac{2}{25} + 0 = \\frac{10}{25} = \\frac{2}{5} = \\pi_2$。\n    - $(\\pi P)_3 = (\\frac{6}{25})(0) + (\\frac{10}{25})(\\frac{1}{4}) + (\\frac{6}{25})(\\frac{1}{3}) + (\\frac{3}{25})(\\frac{1}{2}) = 0 + \\frac{5}{50} + \\frac{2}{25} + \\frac{3}{50} = \\frac{5}{50} + \\frac{4}{50} + \\frac{3}{50} = \\frac{12}{50} = \\frac{6}{25} = \\pi_3$。\n    - $(\\pi P)_4 = (\\frac{6}{25})(0) + (\\frac{10}{25})(0) + (\\frac{6}{25})(\\frac{1}{3}) + (\\frac{3}{25})(\\frac{1}{3}) = 0 + 0 + \\frac{2}{25} + \\frac{1}{25} = \\frac{3}{25} = \\pi_4$。\n\n计算出的向量 $\\pi P$ 等于 $\\pi$。不变性条件得到满足。推导出的分布是正确的。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{6}{25}  \\frac{2}{5}  \\frac{6}{25}  \\frac{3}{25} \\end{pmatrix}}\n$$", "id": "3347139"}, {"introduction": "仅仅满足细致平衡条件并不足以保证马尔可夫链蒙特卡洛（MCMC）方法的成功。本练习 [@problem_id:3347152] 通过一个精心设计的思想实验，揭示了算法设计中的一个常见陷阱：当提议分布的支撑集未能完全覆盖目标分布的支撑集时，即使算法在形式上保持了目标分布，链也可能丧失不可约性，导致其无法探索整个状态空间。通过分析这种情况，你将深刻理解不可约性对于保证平稳分布的唯一性和遍历性的至关重要性，这对于设计有效的 MCMC 算法至关重要。", "problem": "考虑一个状态空间 $\\mathsf{X}=\\mathbb{R}$ 及其 Borel $\\sigma$-代数。设目标概率密度 $\\pi$ 是一个支撑在两个不相交的紧区间上的混合分布，定义为\n$$\n\\pi(x)\\;=\\;w\\cdot \\frac{1}{20}\\,\\mathbf{1}_{[-10,\\,10]}(x)\\;+\\;(1-w)\\cdot \\mathbf{1}_{[100,\\,101]}(x),\n$$\n其中 $w \\in (0,1)$ 是一个固定值（例如，$w=0.97$），$\\mathbf{1}_A$ 表示集合 $A$ 的指示函数。考虑以 $\\pi$ 为目标的独立 Metropolis–Hastings 算法，其提议密度为\n$$\nq(y)\\;=\\;\\frac{1}{20}\\,\\mathbf{1}_{[-10,\\,10]}(y).\n$$\n令 $\\mathcal{A}=[-10,\\,10]$ 和 $\\mathcal{B}=[100,\\,101]$，并令 $P$ 表示在 $\\mathsf{X}$ 上得到的马尔可夫转移核。\n\n仅根据马尔可夫链的平稳性（不变性）、不可约性和遍历性的核心定义，以及独立 Metropolis–Hastings 算法的构造，判断下列哪些陈述是正确的。选择所有适用项。\n\nA. 该链以 $\\pi$ 为不变分布，但它不是 $\\pi$-不可约的；此外，对于 $P$ 存在不可数个不同的不变分布。\n\nB. 该链是不可约和遍历的，因为独立提议不依赖于当前状态，因此它最终会以概率 $1$ 探索整个状态空间。\n\nC. 如果从任意 $x\\in \\mathcal{B}$ 初始化，该链将以概率 $1$ 永远停留在该确切状态。\n\nD. 如果将提议替换为对所有 $y\\in\\mathbb{R}$ 的 $q^\\star(y)=\\frac{1}{2}e^{-|y|}$（因此 $q^\\star  0$ 处处成立），则得到的独立 Metropolis–Hastings 链是 $\\pi$-不可约和非周期的，并以 $\\pi$ 为唯一不变分布；此外，如果 $\\sup_{x\\in \\mathsf{X}}\\pi(x)/q^\\star(x)  \\infty$，则它是一致遍历的。\n\nE. 关于 $\\pi$ 的细致平衡方程不成立，因为在 $\\pi(y)0$ 的一个子集上 $q(y)=0$，所以 $\\pi$ 不可能是 $P$ 的平稳分布。", "solution": "该问题描述了一个独立 Metropolis–Hastings (IMH) 算法。对于 IMH 采样器，候选状态 $Y$ 从一个固定的分布 $q(y)$ 中提议，与当前状态 $X_n = x$ 无关。提议的状态以概率\n$$\n\\alpha(x, y) = \\min\\left(1, \\frac{\\pi(y)q(x)}{\\pi(x)q(y)}\\right)\n$$\n被接受。如果提议被接受，则 $X_{n+1} = Y$。如果被拒绝，则 $X_{n+1} = X_n = x$。\n\n目标密度为 $\\pi(x)\\;=\\;w\\cdot \\frac{1}{20}\\,\\mathbf{1}_{\\mathcal{A}}(x)\\;+\\;(1-w)\\cdot \\mathbf{1}_{\\mathcal{B}}(x)$，其中 $\\mathcal{A}=[-10,\\,10]$ 且 $\\mathcal{B}=[100,\\,101]$。$\\pi$ 的支撑集是 $\\text{supp}(\\pi) = \\mathcal{A} \\cup \\mathcal{B}$。\n提议密度为 $q(y)\\;=\\;\\frac{1}{20}\\,\\mathbf{1}_{\\mathcal{A}}(y)$。$q$ 的支撑集是 $\\text{supp}(q) = \\mathcal{A} = [-10, 10]$。\n\n一个关键的观察是，提议密度 $q$ 的支撑集并未覆盖目标密度 $\\pi$ 的整个支撑集。具体来说，对于任何点 $x \\in \\mathcal{B}$，我们有 $\\pi(x) = 1-w  0$，但由于 $x \\notin \\mathcal{A}$，我们有 $q(x) = 0$。\n\n让我们分析当链的当前状态 $X_n = x$ 在集合 $\\mathcal{B}$ 中时的行为。一个新的状态 $Y$ 从 $q$ 中提议，这意味着 $Y$ 总是位于 $\\mathcal{A}$ 中。接受概率为：\n$$\n\\alpha(x, Y) = \\min\\left(1, \\frac{\\pi(Y)q(x)}{\\pi(x)q(Y)}\\right)\n$$\n因为 $x \\in \\mathcal{B}$，我们有 $q(x) = 0$。提议的 $Y$ 在 $\\mathcal{A}$ 中，所以 $Y \\in \\text{supp}(\\pi)$ 且 $Y \\in \\text{supp}(q)$，意味着 $\\pi(Y)0$ 和 $q(Y)0$。同时，对于 $x \\in \\mathcal{B}$，$\\pi(x)  0$。最小值内的比率变为：\n$$\n\\frac{\\pi(Y) \\cdot 0}{\\pi(x)q(Y)} = 0\n$$\n因此，接受概率为 $\\alpha(x, Y) = \\min(1, 0) = 0$。\n这意味着如果链当前处于任何状态 $x \\in \\mathcal{B}$，任何向状态 $Y \\in \\mathcal{A}$ 的提议移动都将以概率 $1$ 被拒绝。链将停留在状态 $x$。因此，$\\mathcal{B}$ 中的每个状态 $x$ 都是一个吸收态。\n\n基于这一核心发现，我们可以评估每个陈述。\n\n**A. 该链以 $\\pi$ 为不变分布，但它不是 $\\pi$-不可约的；此外，对于 $P$ 存在不可数个不同的不变分布。**\n\n1.  **$\\pi$ 的平稳性**：Metropolis-Hastings 算法的构造旨在满足细致平衡条件 $\\pi(x)p(x,y) = \\pi(y)p(y,x)$，这意味着 $\\pi$ 是转移核 $P$ 的一个平稳（不变）分布。即使支撑集不匹配，只要各项被小心处理，此性质仍然成立。对于任何 $x, y$，$\\pi(x)q(y)\\alpha(x,y) = \\min(\\pi(x)q(y), \\pi(y)q(x)) = \\pi(y)q(x)\\alpha(y,x)$。对此进行积分表明 $\\pi$ 是平稳的。所以，这部分是正确的。\n2.  **$\\pi$-不可约性**：如果一个链可以从 $\\text{supp}(\\pi)$ 中的任何状态，在有限步内移动到任何 $\\pi(A)  0$ 的集合 $A \\subseteq \\text{supp}(\\pi)$，则该链是 $\\pi$-不可约的。我们已经证明，如果链从 $x \\in \\mathcal{B}$ 开始，它永远无法转移到 $\\mathcal{A}$ 中的任何状态。令 $x \\in \\mathcal{B}$ 且 $A = \\mathcal{A}$。我们有 $\\pi(A)=w  0$。然而，对于所有 $n \\ge 1$，$P^n(x, \\mathcal{A}) = 0$。因此，该链不是 $\\pi$-不可约的。\n3.  **不可数个不变分布**：由于 $\\mathcal{B}$ 中的每个状态 $x_0$ 都是一个吸收态，转移核满足 $P(x_0, \\{x_0\\}) = 1$。这意味着对于每个 $x_0 \\in \\mathcal{B}$，Dirac delta 测度 $\\delta_{x_0}$ 都是一个不变分布。由于 $\\mathcal{B} = [100, 101]$ 是一个不可数集，因此存在不可数个这样的不同不变分布。\n\n该陈述的所有三个分句都是正确的。\n**结论：正确**\n\n**B. 该链是不可约和遍历的，因为独立提议不依赖于当前状态，因此它最终会以概率 $1$ 探索整个状态空间。**\n\n这个陈述声称链是不可约的，我们刚刚证明了这是错误的。一个不是不可约的链不可能是遍历的。所提供的理由是有缺陷的，因为它忽略了算法的接受-拒绝步骤。虽然提议机制独立于当前状态，但接受概率 $\\alpha(x, y)$ 并非如此，并且在这种情况下，它阻止了链探索整个状态空间。\n**结论：错误**\n\n**C. 如果从任意 $x\\in \\mathcal{B}$ 初始化，该链将以概率 $1$ 永远停留在该确切状态。**\n\n如上所述，如果链处于状态 $x \\in \\mathcal{B}$，任何提议的接受概率都为 $0$。这意味着链将总是拒绝提议并停留在 $x$。因此，对所有 $x \\in \\mathcal{B}$ 都有 $P(x, \\{x\\}) = 1$。这个陈述是我们初步分析的直接结果。\n**结论：正确**\n\n**D. 如果将提议替换为对所有 $y\\in\\mathbb{R}$ 的 $q^\\star(y)=\\frac{1}{2}e^{-|y|}$（因此 $q^\\star0$ 处处成立），则得到的独立 Metropolis–Hastings 链是 $\\pi$-不可约和非周期的，并以 $\\pi$ 为唯一不变分布；此外，如果 $\\sup_{x\\in \\mathsf{X}}\\pi(x)/q^\\star(x)  \\infty$，则它是一致遍历的。**\n\n这个陈述涉及一个假设性的修改。我们必须验证这个新链的各项声明。\n1.  **$\\pi$-不可约性**：新的提议 $q^\\star$ 的支撑集遍及整个 $\\mathbb{R}$。目标 $\\pi$ 的支撑集是 $\\mathcal{A} \\cup \\mathcal{B}$。因此，$\\text{supp}(\\pi) \\subset \\text{supp}(q^\\star)$。对于 IMH 算法，这个条件足以保证 $\\pi$-不可约性。链可以从任何 $x \\in \\text{supp}(\\pi)$ 转移到任何 $\\pi(A)0$ 的集合 $A$，因为向 $A$ 的提议是可能的（$\\int_A q^\\star(y)dy  0$），并且接受概率 $\\alpha(x,y)=\\min(1, \\frac{\\pi(y)q^\\star(x)}{\\pi(x)q^\\star(y)})$ 对于 $y \\in A$ 将是正的。\n2.  **非周期性**：链是非周期的，因为停留在状态 $x$ 的概率 $P(x,\\{x\\})$ 是正的（拒绝概率通常大于 $0$）。\n3.  **唯一不变分布**：由于链是 $\\pi$-不可约的，并且以 $\\pi$ 为平稳分布（通过构造），$\\pi$ 必须是唯一的平稳分布。\n4.  **一致遍历性**：一个标准定理指出，IMH 链是一致遍历的，当且仅当 $\\sup_{x \\in \\mathsf{X}} \\pi(x)/q(x)  \\infty$。让我们对 $\\pi$ 和 $q^\\star$ 检查这一点。比率为 $f(x) = \\frac{\\pi(x)}{q^\\star(x)} = \\frac{\nw\\cdot \\frac{1}{20}\\,\\mathbf{1}_{\\mathcal{A}}(x)\\;+\\;(1-w)\\cdot \\mathbf{1}_{\\mathcal{B}}(x)}{\\frac{1}{2}e^{-|x|}}$。\n此函数仅在紧集 $\\mathcal{A} \\cup \\mathcal{B}$ 上非零。在这个紧集上，分子 $\\pi(x)$ 有上界，而分母 $q^\\star(x)$ 严格为正且有正的下界。因此，该比率有上界。其上确界是有限的。所提供的一致遍历性条件既是一个正确的定理，也为给定的函数所满足。\n\n整个“如果-那么”陈述及其所有组成部分都与已建立的 MCMC 理论一致。\n**结论：正确**\n\n**E. 关于 $\\pi$ 的细致平衡方程不成立，因为在 $\\pi(y)0$ 的一个子集上 $q(y)=0$，所以 $\\pi$ 不可能是 $P$ 的平稳分布。**\n\n细致平衡不成立的前提是错误的。如选项 A 的分析所示，细致平衡方程 $\\pi(x)q(y)\\alpha(x,y) = \\pi(y)q(x)\\alpha(y,x)$ 对所有 $x,y$ 都成立。如果一方因为某个 $q$ 项为零而是零，那么另一方也将是零。例如，如果 $x \\in \\mathcal{A}$ 且 $y \\in \\mathcal{B}$，则 $q(y)=0$，所以等式左边是 $0$。对于等式右边，$\\alpha(y,x)=0$，因为其比率的分子中含有 $q(y)=0$，所以右边也是 $0$。$\\pi$ 不可能是平稳分布的结论也是错误的；我们明确地证明了它是平稳的。\n**结论：错误**\n\n结论摘要：\nA: 正确\nB: 错误\nC: 正确\nD: 正确\nE: 错误\n\n正确的选项是 A, C, 和 D。", "answer": "$$\n\\boxed{ACD}\n$$", "id": "3347152"}, {"introduction": "在确认了平稳分布的存在性和唯一性之后，一个核心的实际问题便是马尔可夫链收敛到该分布的速度。本练习 [@problem_id:3347133] 将理论与计算实践相结合，要求你通过编程来量化和比较两种不同类型马尔可夫链（一个可逆，一个不可逆）的混合时间。通过计算谱隙和混合时间代理指标，你将亲身体验到，即使两条链拥有相同的平稳分布，其收敛效率也可能大相径庭，这为非可逆 MCMC 算法在某些情况下可能具有更优性能的现代研究提供了直观的理解和数值证据。", "problem": "考虑一个在具有 $N$ 个状态（标记为 $\\{0,1,\\dots,N-1\\}$）的环（循环）上的离散时间马尔可夫链。在同一状态空间上，针对一个固定的惰性参数 $\\ell \\in (0,1)$，定义了两个转移核：\n\n- 一个可逆、惰性、对称的最近邻核 $P_{\\mathrm{rev}}$：\n  - 从状态 $i$ 出发，链以概率 $\\ell$ 停留原地，以概率 $(1-\\ell)/2$ 移动到 $(i+1) \\bmod N$，并以概率 $(1-\\ell)/2$ 移动到 $(i-1) \\bmod N$。\n\n- 一个不可逆、惰性、前向的核 $P_{\\mathrm{nonrev}}$：\n  - 从状态 $i$ 出发，链以概率 $\\ell$ 停留原地，并以概率 $1-\\ell$ 移动到 $(i+1) \\bmod N$。\n\n请纯粹从数学角度进行分析。您可以假定马尔可夫链理论和线性代数中的标准定义。使用以下基础知识：\n\n- 平稳（不变）分布 $\\pi$ 的定义为一个满足 $\\pi P = \\pi$ 的概率向量。\n- 对于一个核 $P$，关于分布 $\\pi$ 的可逆性（细致平衡）的定义。\n- 有限随机矩阵 $P$ 的谱由特征值 $\\{\\lambda_k\\}$ 组成，满足 $\\max_k |\\lambda_k| \\le 1$，且对于不可约链，至少有一个特征值等于 $1$。\n- 核 $P$ 的模谱隙定义为 $\\delta(P) \\equiv 1 - \\rho(P)$，其中 $\\rho(P) \\equiv \\max\\{|\\lambda| : \\lambda \\text{ 是 } P \\text{ 的特征值}, \\lambda \\ne 1\\}$。\n- 对于给定的容差 $\\varepsilon \\in (0,1)$，基于谱半径的全变分混合时间的代理指标定义为\n  $$ t_{\\varepsilon}(P) \\equiv \\min\\{ t \\in \\mathbb{N} : \\rho(P)^t \\le \\varepsilon\\} = \\left\\lceil \\frac{\\log(\\varepsilon)}{\\log(\\rho(P))} \\right\\rceil, $$\n  约定 $\\log$ 表示自然对数，并且对于此处考虑的链，有 $0  \\rho(P)  1$。\n\n任务：\n\n1. 对这两个核，分别确定其平稳分布 $\\pi$，并论证该核相对于 $\\pi$ 是否可逆。\n2. 对每个核，证明其所有特征值都位于复平面的闭单位圆盘内，且 $\\lambda = 1$ 是一个特征值。解释为什么对于所考虑的情况（即当 $\\ell \\in (0,1)$ 时 $\\rho(P)  1$），上述定义的模谱隙 $\\delta(P)$ 是良定义的。\n3. 设计一个算法，给定 $(N,\\ell)$，该算法能构建转移矩阵 $P_{\\mathrm{rev}}$ 和 $P_{\\mathrm{nonrev}}$，数值计算所有特征值，识别并移除最接近 $1$ 的特征值（以处理数值舍入误差），然后计算：\n   - 每个核的模谱隙 $\\delta(P)$。\n   - 对于给定的容差 $\\varepsilon$，每个核的代理混合时间 $t_{\\varepsilon}(P)$。\n4. 将该算法实现为一个完整的程序。对于每个测试用例，程序输出一个列表，包含 $[\\delta(P_{\\mathrm{rev}}), \\delta(P_{\\mathrm{nonrev}}), t_{\\varepsilon}(P_{\\mathrm{rev}}), t_{\\varepsilon}(P_{\\mathrm{nonrev}}), \\mathbf{1}\\{t_{\\varepsilon}(P_{\\mathrm{nonrev}})  t_{\\varepsilon}(P_{\\mathrm{rev}})\\}]$，其中 $\\mathbf{1}\\{\\cdot\\}$ 是指示函数，当条件为真时取值为 $1$，否则为 $0$。将所有浮点数输出四舍五入到六位小数。\n\n使用以下参数值测试套件 $(N,\\ell,\\varepsilon)$：\n\n- 情况 A（一般情况）： $(N,\\ell,\\varepsilon) = (10, 0.2, 10^{-4})$。\n- 情况 B（小环，边界情况）： $(N,\\ell,\\varepsilon) = (3, 0.3, 10^{-4})$。\n- 情况 C（大环，低惰性）： $(N,\\ell,\\varepsilon) = (50, 0.05, 10^{-4})$。\n- 情况 D（中等环，高惰性）： $(N,\\ell,\\varepsilon) = (15, 0.9, 10^{-4})$。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含一个以逗号分隔的列表的列表，每个子列表对应一个测试用例的结果，不含空格，并用方括号括起来。也就是说，按 A、B、C、D 的顺序打印一个列表的列表。例如，一个包含两个假设性用例的输出应如下所示\n  $$ [[0.123456,0.234567,100,80,1],[0.111111,0.222222,90,70,1]]. $$", "solution": "### 任务1：平稳分布与可逆性\n\n设状态空间为 $S = \\{0, 1, \\dots, N-1\\}$。如果概率分布 $\\pi = (\\pi_0, \\pi_1, \\dots, \\pi_{N-1})$ 是转移矩阵 $P$ 特征值为 $1$ 的左特征向量，即 $\\pi P = \\pi$，则称其为 $P$ 的平稳分布。\n\n对于所描述的具有循环对称性的系统，均匀分布 $\\pi_{\\text{unif}}$（其中对所有 $i \\in S$，$\\pi_i = 1/N$）是平稳分布的自然候选。我们对两个核都进行验证。\n\n均匀分布是平稳分布的一个充分条件是转移矩阵 $P$ 是双随机的，即其行和与列和均为 $1$。如果 $P$ 是双随机的，且 $\\mathbf{1}$ 是全为一的列向量，那么 $\\mathbf{1}^T P = \\mathbf{1}^T$（因为 $P$ 的列和为 $1$）。取 $\\pi = (1/N)\\mathbf{1}^T$，我们有 $\\pi P = ((1/N)\\mathbf{1}^T)P = (1/N)(\\mathbf{1}^T P) = (1/N)\\mathbf{1}^T = \\pi$。\n\n1.  **核 $P_{\\mathrm{rev}}$**：从状态 $i$ 出发的转移概率为 $(P_{\\mathrm{rev}})_{i,i} = \\ell$，$(P_{\\mathrm{rev}})_{i,(i+1)\\bmod N} = (1-\\ell)/2$，以及 $(P_{\\mathrm{rev}})_{i,(i-1)\\bmod N} = (1-\\ell)/2$。该矩阵是一个对称循环矩阵。每行的和为 $\\ell + (1-\\ell)/2 + (1-\\ell)/2 = 1$。由于矩阵是对称的，每列的和也为 $1$。因此，$P_{\\mathrm{rev}}$ 是双随机的，均匀分布 $\\pi = (1/N, \\dots, 1/N)$ 是其唯一的平稳分布。\n\n    如果一个核 $P$ 满足细致平衡条件：对所有状态 $i, j$ 都有 $\\pi_i P_{ij} = \\pi_j P_{ji}$，则称其相对于分布 $\\pi$ 是可逆的。对于均匀分布 $\\pi_i=\\pi_j=1/N$，此条件简化为 $P_{ij} = P_{ji}$。矩阵 $P_{\\mathrm{rev}}$ 根据其构造就是对称的：$(P_{\\mathrm{rev}})_{i,j} = (P_{\\mathrm{rev}})_{j,i}$。因此，**$P_{\\mathrm{rev}}$ 相对于均匀分布是可逆的**。\n\n2.  **核 $P_{\\mathrm{nonrev}}$**：从状态 $i$ 出发的转移概率为 $(P_{\\mathrm{nonrev}})_{i,i} = \\ell$ 和 $(P_{\\mathrm{nonrev}})_{i,(i+1)\\bmod N} = 1-\\ell$。这也是一个循环矩阵。每行的和为 $\\ell + (1-\\ell) = 1$。因为它是一个循环矩阵，每列都是任何其他列的循环置换，因此必须有相同的和。第一列的和为 $(P_{\\mathrm{nonrev}})_{0,0} + (P_{\\mathrm{nonrev}})_{N-1,0} = \\ell + (1-\\ell) = 1$。因此，$P_{\\mathrm{nonrev}}$ 也是双随机的，均匀分布 $\\pi = (1/N, \\dots, 1/N)$ 是其唯一的平稳分布。\n\n    为检查可逆性，我们测试 $P_{\\mathrm{nonrev}}$ 是否对称。考虑从 $0$ 到 $1$ 的转移：$(P_{\\mathrm{nonrev}})_{0,1} = 1-\\ell$。逆向转移是从 $1$ 到 $0$：$(P_{\\mathrm{nonrev}})_{1,0} = 0$，假设 $N  2$。由于 $\\ell \\in (0,1)$，我们有 $1-\\ell \\neq 0$。因此，$(P_{\\mathrm{nonrev}})_{0,1} \\ne (P_{\\mathrm{nonrev}})_{1,0}$。该矩阵不是对称的。因此，**$P_{\\mathrm{nonrev}}$ 相对于均匀分布是不可逆的**。\n\n### 任务2：特征值性质\n\n1.  **单位圆盘内的特征值**：对于任何随机矩阵 $P$，其所有特征值 $\\lambda$ 都必须满足 $|\\lambda| \\le 1$。设 $v$ 是对应于 $\\lambda$ 的特征向量。设 $k$ 是一个索引，使得 $|v_k| = \\max_i |v_i|$。根据特征向量方程 $\\lambda v = Pv$，我们有 $\\lambda v_k = \\sum_{j=0}^{N-1} P_{kj} v_j$。由三角不等式，有 $|\\lambda||v_k| = |\\sum_j P_{kj} v_j| \\le \\sum_j |P_{kj} v_j| = \\sum_j P_{kj} |v_j|$。由于对所有 $j$ 都有 $|v_j| \\le |v_k|$，我们有 $\\sum_j P_{kj} |v_j| \\le \\sum_j P_{kj} |v_k| = |v_k| \\sum_j P_{kj}$。由于 $P$ 是一个随机矩阵，其行和为 $1$，所以 $\\sum_j P_{kj} = 1$。综合这些，我们得到 $|\\lambda||v_k| \\le |v_k|$。由于 $v$ 是一个特征向量，$v \\ne 0$，所以 $|v_k|  0$，我们可以除以 $|v_k|$ 得到 $|\\lambda| \\le 1$。\n\n2.  **特征值 $\\lambda=1$ 的存在性**：对于任何随机矩阵 $P$，全一向量 $\\mathbf{1} = (1, 1, \\dots, 1)^T$ 是一个特征值为 $1$ 的右特征向量。这是因为 $(P\\mathbf{1})_i = \\sum_j P_{ij} \\cdot 1 = 1$，这正是 $1 \\cdot \\mathbf{1}$ 的第 $i$ 个分量。\n\n3.  **谱隙的良定义性 ($\\rho(P)  1$)**：一个有限、不可约的马尔可夫链是非周期的，当且仅当其特征值 $\\lambda=1$ 是单根的，并且所有其他特征值 $\\lambda'$ 满足 $|\\lambda'|  1$。如果对于任何状态 $i$，时间集合 $\\{ t0 : (P^t)_{ii}  0 \\}$ 的最大公约数为 $1$，则该链是非周期的。对于 $P_{\\mathrm{rev}}$ 和 $P_{\\mathrm{nonrev}}$，惰性参数 $\\ell \\in (0,1)$ 确保了 $(P)_{ii} = \\ell  0$。这意味着从状态 $i$ 到其自身存在长度为 $t=1$ 的转移。因此，最大公约数为 $1$，两个链都是非周期的。两个链也显然是不可约的（可以从任何状态到达任何其他状态）。根据随机矩阵的 Perron-Frobenius 定理，一个不可约且非周期的链具有唯一的平稳分布，$\\lambda=1$ 是一个单特征值，所有其他特征值的模都严格小于 $1$。因此，$\\rho(P) = \\max\\{|\\lambda| : \\lambda \\text{ 是 } P \\text{ 的特征值}, \\lambda \\ne 1\\}  1$。这证实了模谱隙 $\\delta(P) = 1 - \\rho(P)$ 是良定义且为正的，并且 $t_{\\varepsilon}(P)$ 定义中的对数是良定义且为负的。\n\n### 任务3：算法设计\n\n该算法将构建指定的转移矩阵，然后数值计算它们的光谱性质。\n\n1.  **输入**：一个整数 $N  1$，一个惰性参数 $\\ell \\in (0,1)$，以及一个容差 $\\varepsilon \\in (0,1)$。\n\n2.  **矩阵构建**：\n    *   **对于 $P_{\\mathrm{rev}}$**：创建一个初始化为零的 $N \\times N$ 矩阵。对于每一行 $i \\in \\{0, \\dots, N-1\\}$，设置其元素：\n        $$\n        (P_{\\mathrm{rev}})_{i,j} = \\begin{cases} \\ell  \\text{if } j=i \\\\ (1-\\ell)/2  \\text{if } j=(i+1)\\bmod N \\text{ or } j=(i-1)\\bmod N \\\\ 0  \\text{otherwise} \\end{cases}\n        $$\n        注意，对于“减一”的情况，取模操作应实现为 `(i - 1 + N) % N` 以避免负索引。\n    *   **对于 $P_{\\mathrm{nonrev}}$**：创建一个初始化为零的 $N \\times N$ 矩阵。对于每一行 $i \\in \\{0, \\dots, N-1\\}$，设置其元素：\n        $$\n        (P_{\\mathrm{nonrev}})_{i,j} = \\begin{cases} \\ell  \\text{if } j=i \\\\ 1-\\ell  \\text{if } j=(i+1)\\bmod N \\\\ 0  \\text{otherwise} \\end{cases}\n        $$\n\n3.  **谱计算**（对每个矩阵 $P \\in \\{P_{\\mathrm{rev}}, P_{\\mathrm{nonrev}}\\}$）：\n    *   使用标准的数值库（例如 `numpy.linalg.eigvals`）计算所有特征值的谱系 $\\{\\lambda_k\\}_{k=0}^{N-1}$。\n    *   识别平凡特征值 $\\lambda=1$。由于数值精度的原因，这通过找到最接近 $1$ 的特征值 $\\lambda_k$ 来完成，即找到最小化 $|\\lambda_k - 1|$ 的 $k^*$。\n    *   从集合中移除此特征值，形成一个新的包含 $N-1$ 个特征值的集合。\n    *   通过找到这个新集合中特征值的最大绝对值（模）来计算 $\\rho(P)$：\n        $$ \\rho(P) = \\max_{k \\ne k^*} \\{|\\lambda_k|\\} $$\n    *   计算模谱隙：\n        $$ \\delta(P) = 1 - \\rho(P) $$\n    *   计算代理混合时间。该值必须是整数，因此应用向上取整函数：\n        $$ t_{\\varepsilon}(P) = \\left\\lceil \\frac{\\log(\\varepsilon)}{\\log(\\rho(P))} \\right\\rceil $$\n\n4.  **最终比较与输出**：\n    *   在计算出 $t_{\\varepsilon}(P_{\\mathrm{rev}})$ 和 $t_{\\varepsilon}(P_{\\mathrm{nonrev}})$ 之后，评估指示函数 $\\mathbf{1}\\{t_{\\varepsilon}(P_{\\mathrm{nonrev}})  t_{\\varepsilon}(P_{\\mathrm{rev}})\\}$, 其值为 $1$ 如果条件为真，否则为 $0$。\n    *   将给定测试用例的五个最终值组合成一个列表：$[\\delta(P_{\\mathrm{rev}}), \\delta(P_{\\mathrm{nonrev}}), t_{\\varepsilon}(P_{\\mathrm{rev}}), t_{\\varepsilon}(P_{\\mathrm{nonrev}}), \\mathbf{1}\\{\\cdot\\}]$。\n    *   浮点数值需要四舍五入到六位小数。混合时间和指示函数是整数。\n\n该算法为求解提供了一条稳健的数值路径，直接实现了问题陈述中给出的定义。\n\n为求完整，我们可以给出解析的特征值，这些特征值可以因为矩阵是循环矩阵而推导出来。设 $\\omega_N = e^{2\\pi i / N}$。对于第一行为 $(c_0, c_1, \\dots, c_{N-1})$ 的循环矩阵，其特征值为 $\\lambda_j = \\sum_{k=0}^{N-1} c_k \\omega_N^{jk}$，其中 $j=0, \\dots, N-1$。\n\n*   对于 $P_{\\mathrm{rev}}$，特征值是实数：$\\lambda_j = \\ell + (1-\\ell)\\cos(2\\pi j/N)$。\n*   对于 $P_{\\mathrm{nonrev}}$，特征值是复数：$\\lambda_j = \\ell + (1-\\ell)e^{i 2\\pi j/N}$。\n\n在两种情况下，$j=0$ 给出特征值 $\\lambda_0=1$。第二大模 $\\rho(P)$ 在 $j=1$ 和 $j=N-1$ 处取得。\n*   $\\rho(P_{\\mathrm{rev}}) = \\max_{j=1,\\dots,N-1} |\\ell + (1-\\ell)\\cos(2\\pi j/N)|$。\n*   $\\rho(P_{\\mathrm{nonrev}}) = |\\ell + (1-\\ell)e^{i 2\\pi /N}| = \\sqrt{(\\ell+(1-\\ell)\\cos(2\\pi/N))^2 + ((1-\\ell)\\sin(2\\pi/N))^2}$。\n\n这些解析形式与数值方法一致，并为预期结果提供了良好的理论基础。", "answer": "[[0.061972,0.119202,145,74,1],[0.525000,0.725797,14,9,1],[0.003923,0.007827,2343,1174,1],[0.002219,0.004433,4145,2074,1]]", "id": "3347133"}]}