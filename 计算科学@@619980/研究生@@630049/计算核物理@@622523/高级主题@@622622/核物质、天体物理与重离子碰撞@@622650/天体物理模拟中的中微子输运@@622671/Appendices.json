{"hands_on_practices": [{"introduction": "在深入研究中微子输运的复杂数值方法之前，我们首先需要精确地描述中微子本身的统计特性。这个实践练习将引导你计算由费米-狄拉克分布描述的中微子气体的关键统计矩，例如平均能量和能量的均方根。通过这个练习，你将亲手探索简并性参数如何影响中微子能谱的“硬度”，这是理解中微子与物质相互作用率的基础。[@problem_id:3572170]", "problem": "考虑天体物理环境中的一个超相对论性、各向同性的中微子布居，该布居被建模为具有温度 $T$ 和中微子化学势 $\\mu_\\nu$ 的费米-狄拉克分布。假设中微子只有单一种类，静止质量可忽略，并使用自然单位制，其中玻尔兹曼常数、光速和约化普朗克常数满足 $k_{\\mathrm{B}}=c=\\hbar=1$。在这些单位中，能量和温度均以兆电子伏特 (MeV) 为单位进行测量。占据概率由费米-狄拉克函数 $f(E)=\\left[\\exp\\left(\\frac{E-\\mu_\\nu}{T}\\right)+1\\right]^{-1}$ 给出。对于一个超相对论性、各向同性的气体，每单位能量的相空间态密度权重与 $E^2$ 成正比。中微子数谱 $n(E)$ 与 $E^2 f(E)$ 成正比，且归一化常数在矩的比值中被消去。\n\n从连续分布的统计平均值的基本定义出发，平均能量 $\\langle E \\rangle$ 和均方能量 $\\langle E^2 \\rangle$ 由对数谱进行能量加权积分的比值定义：\n$$\n\\langle E \\rangle = \\frac{\\int_{0}^{\\infty} E \\, n(E) \\, dE}{\\int_{0}^{\\infty} n(E) \\, dE}, \\quad\n\\langle E^2 \\rangle = \\frac{\\int_{0}^{\\infty} E^2 \\, n(E) \\, dE}{\\int_{0}^{\\infty} n(E) \\, dE},\n$$\n其中 $n(E) \\propto E^2 f(E)$ 且 $f(E)=\\left[\\exp\\left(\\frac{E-\\mu_\\nu}{T}\\right)+1\\right]^{-1}$。您的任务是实现一个数值稳定的算法来计算这些积分，并为给定的 $T$ 和 $\\mu_\\nu$ 计算 $\\langle E \\rangle$ 和 $\\langle E^2 \\rangle$。然后，将谱硬度 $h$ 定义为无量纲比值：\n$$\nh = \\frac{\\sqrt{\\langle E^2 \\rangle}}{\\langle E \\rangle}.\n$$\n在附带的解题说明中，基于第一性原理和费米-狄拉克分布的结构，解释简并参数 $\\eta=\\mu_\\nu/T$ 如何改变谱硬度。\n\n物理单位要求：将 $\\langle E \\rangle$ 以 MeV 表示，$\\langle E^2 \\rangle$ 以 $\\mathrm{MeV}^2$ 表示，$h$ 为无量纲数。在最终输出中，将每个浮点数结果四舍五入到6位小数。\n\n为确保有意义的覆盖范围，请实现程序以计算以下 $(T,\\mu_\\nu)$ 值测试集的结果，该测试集探究了非简并、中度简并、负简并、强简并和低温情况：\n- 情况1：$T=4$ MeV, $\\mu_\\nu=0$ MeV。\n- 情况2：$T=4$ MeV, $\\mu_\\nu=8$ MeV。\n- 情况3：$T=4$ MeV, $\\mu_\\nu=-4$ MeV。\n- 情况4：$T=1$ MeV, $\\mu_\\nu=20$ MeV。\n- 情况5：$T=0.5$ MeV, $\\mu_\\nu=1.0$ MeV。\n\n您的程序应生成单行输出，其中包含结果，形式为逗号分隔的列表的列表，每个内部列表对应上述顺序的一个情况。每个内部列表必须为 $[\\langle E \\rangle,\\langle E^2 \\rangle,h]$ 的形式，其中 $\\langle E \\rangle$ 以 MeV 为单位，$\\langle E^2 \\rangle$ 以 $\\mathrm{MeV}^2$ 为单位，h为无量纲数，所有值均四舍五入到6位小数。例如，输出格式应类似于：\n$$\n[[e_1,e^2_1,h_1],[e_2,e^2_2,h_2],\\ldots,[e_5,e^2_5,h_5]],\n$$\n其中每个 $e_i$、$e^2_i$ 和 $h_i$ 都是四舍五入到6位小数的浮点数。", "solution": "对用户的问题进行验证。\n\n### 第1步：提取已知条件\n- **模型**: 超相对论性、各向同性的中微子布居。\n- **分布**: 具有温度 $T$ 和中微子化学势 $\\mu_\\nu$ 的费米-狄拉克分布。\n- **假设**: 单一中微子种类，静止质量可忽略。\n- **单位**: 自然单位制，其中 $k_{\\mathrm{B}}=c=\\hbar=1$。能量和温度单位为兆电子伏特 (MeV)。\n- **占据概率**: $f(E)=\\left[\\exp\\left(\\frac{E-\\mu_\\nu}{T}\\right)+1\\right]^{-1}$。\n- **相空间态密度权重**: 与 $E^2$ 成正比。\n- **中微子数谱**: $n(E) \\propto E^2 f(E)$。\n- **平均能量**: $\\langle E \\rangle = \\frac{\\int_{0}^{\\infty} E \\, n(E) \\, dE}{\\int_{0}^{\\infty} n(E) \\, dE}$。\n- **均方能量**: $\\langle E^2 \\rangle = \\frac{\\int_{0}^{\\infty} E^2 \\, n(E) \\, dE}{\\int_{0}^{\\infty} n(E) \\, dE}$。\n- **谱硬度**: $h = \\frac{\\sqrt{\\langle E^2 \\rangle}}{\\langle E \\rangle}$。\n- **简并参数**: $\\eta=\\mu_\\nu/T$。\n- **任务**: 实现一个数值稳定的算法来计算 $\\langle E \\rangle$ 和 $\\langle E^2 \\rangle$，并解释 $\\eta$ 如何改变 $h$。\n- **输出单位**: $\\langle E \\rangle$ 单位为 MeV，$\\langle E^2 \\rangle$ 单位为 $\\mathrm{MeV}^2$，$h$ 为无量纲。\n- **输出格式**: 所有结果四舍五入到6位小数。\n- **测试用例**:\n    1.  $T=4$ MeV, $\\mu_\\nu=0$ MeV。\n    2.  $T=4$ MeV, $\\mu_\\nu=8$ MeV。\n    3.  $T=4$ MeV, $\\mu_\\nu=-4$ MeV。\n    4.  $T=1$ MeV, $\\mu_\\nu=20$ MeV。\n    5.  $T=0.5$ MeV, $\\mu_\\nu=1.0$ MeV。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据**: 该问题在标准统计力学及其在天体物理学中的应用方面有充分的依据。对中微子这类费米子使用费米-狄拉克分布、统计矩的定义以及超相对论性气体的模型，都是物理学中的基本概念。\n- **良构性**: 该问题是良构的。它提供了计算所需量所必需的所有定义、常数和参数。这些积分是良定义的（收敛的费米-狄拉克积分），确保了每个测试用例都存在唯一且有意义的解。\n- **客观性**: 该问题以精确、客观和定量的术语陈述，没有歧义或主观论断。\n\n### 第3步：结论与行动\n该问题有效。将提供完整的解决方案。\n\n问题的核心是计算中微子能谱的统计矩。中微子数谱 $n(E)$ 给定为与相空间态密度（对于超相对论性各向同性气体，其与 $E^2$ 成正比）和费米-狄拉克占据概率 $f(E)$ 的乘积成正比。因此，$n(E) \\propto E^2 f(E)$，其中比例常数是无关紧要的，因为它在定义矩的比值中被消掉了。\n\n将 $n(E)$ 代入平均能量 $\\langle E \\rangle$ 和均方能量 $\\langle E^2 \\rangle$ 的定义中：\n$$\n\\langle E \\rangle = \\frac{\\int_{0}^{\\infty} E \\cdot E^2 f(E) \\, dE}{\\int_{0}^{\\infty} E^2 f(E) \\, dE} = \\frac{\\int_{0}^{\\infty} E^3 f(E) \\, dE}{\\int_{0}^{\\infty} E^2 f(E) \\, dE}\n$$\n$$\n\\langle E^2 \\rangle = \\frac{\\int_{0}^{\\infty} E^2 \\cdot E^2 f(E) \\, dE}{\\int_{0}^{\\infty} E^2 f(E) \\, dE} = \\frac{\\int_{0}^{\\infty} E^4 f(E) \\, dE}{\\int_{0}^{\\infty} E^2 f(E) \\, dE}\n$$\n其中 $f(E)=\\left[\\exp\\left(\\frac{E-\\mu_\\nu}{T}\\right)+1\\right]^{-1}$。\n\n为了简化这些积分并揭示它们对系统物理参数的依赖关系，我们进行变量替换。令 $x = E/T$ 为无量纲能量，因此 $E = xT$ 且 $dE = Tdx$。我们还定义了简并参数 $\\eta = \\mu_\\nu/T$。分子和分母中的一般积分形式为：\n$$\n\\int_{0}^{\\infty} E^k f(E) \\, dE = \\int_{0}^{\\infty} (xT)^k \\left[\\exp\\left(\\frac{xT-\\mu_\\nu}{T}\\right)+1\\right]^{-1} Tdx = T^{k+1} \\int_{0}^{\\infty} \\frac{x^k}{e^{x-\\eta}+1} \\, dx\n$$\n这定义了 $k$ 阶的完整费米-狄拉克积分为 $F_k(\\eta) = \\int_{0}^{\\infty} \\frac{x^k}{e^{x-\\eta}+1} \\, dx$。\n使用这个定义，矩可以表示为：\n$$\n\\langle E \\rangle = \\frac{T^4 F_3(\\eta)}{T^3 F_2(\\eta)} = T \\frac{F_3(\\eta)}{F_2(\\eta)}\n$$\n$$\n\\langle E^2 \\rangle = \\frac{T^5 F_4(\\eta)}{T^3 F_2(\\eta)} = T^2 \\frac{F_4(\\eta)}{F_2(\\eta)}\n$$\n于是，谱硬度 $h$ 为：\n$$\nh = \\frac{\\sqrt{\\langle E^2 \\rangle}}{\\langle E \\rangle} = \\frac{\\sqrt{T^2 \\frac{F_4(\\eta)}{F_2(\\eta)}}}{T \\frac{F_3(\\eta)}{F_2(\\eta)}} = \\frac{T \\sqrt{\\frac{F_4(\\eta)}{F_2(\\eta)}}}{T \\frac{F_3(\\eta)}{F_2(\\eta)}} = \\frac{\\sqrt{F_4(\\eta) F_2(\\eta)}}{F_3(\\eta)}\n$$\n值得注意的是，谱硬度 $h$ 仅取决于简并参数 $\\eta$，而不直接取决于温度 $T$。\n\n积分 $F_k(\\eta)$ 没有以初等函数表示的一般闭式表达式，必须进行数值计算。稳健的数值求积方法适合此任务。对于每个测试用例 $(T, \\mu_\\nu)$，算法如下：\n1.  计算简并参数 $\\eta = \\mu_\\nu / T$。\n2.  在区间 $[0, \\infty)$ 上数值计算积分 $F_2(\\eta)$、$F_3(\\eta)$ 和 $F_4(\\eta)$。\n3.  使用这些值，根据上面推导的表达式计算 $\\langle E \\rangle$、$\\langle E^2 \\rangle$ 和 $h$。\n\n现在，我们分析谱硬度 $h$ 对简并参数 $\\eta$ 的依赖性。参数 $h$ 是均方根能量与平均能量之比，即 $h = E_{rms} / \\langle E \\rangle$，它是衡量能谱相对宽度的指标。\n-   **非简并极限 ($\\eta \\ll 0$)：** 当 $\\mu_\\nu$ 相对于 $T$ 而言是大的负值时，项 $e^{(E-\\mu_\\nu)/T}$ 非常大。$f(E)$ 分母中的 $+1$ 变得可以忽略，因此 $f(E) \\approx e^{-(E-\\mu_\\nu)/T}$。这是麦克斯韦-玻尔兹曼极限。数谱变为 $n(E) \\propto E^2 e^{-E/T}$。在此极限下，矩的比值与 $\\eta$ 无关。积分 $F_k(\\eta)$ 与伽马函数成正比，$F_k(\\eta) \\approx e^{\\eta} \\Gamma(k+1) = e^{\\eta} k!$。硬度 $h$ 趋于一个常数值：\n    $$\n    h \\approx \\frac{\\sqrt{e^{\\eta} 4! \\cdot e^{\\eta} 2!}}{e^{\\eta} 3!} = \\frac{\\sqrt{24 \\cdot 2}}{6} = \\frac{\\sqrt{48}}{6} = \\frac{4\\sqrt{3}}{6} = \\frac{2\\sqrt{3}}{3} \\approx 1.1547\n    $$\n-   **强简并极限 ($\\eta \\gg 0$)：** 当 $\\mu_\\nu$ 相对于 $T$ 而言是大的正值时，分布趋于一个阶跃函数（零温极限）。当 $E  \\mu_\\nu$ 时，$f(E) \\approx 1$；当 $E  \\mu_\\nu$ 时，$f(E) \\approx 0$。积分可以通过积分到费米能级来近似：$F_k(\\eta) \\approx \\int_0^\\eta x^k dx = \\frac{\\eta^{k+1}}{k+1}$。硬度 $h$ 再次趋于一个常数，但值不同：\n    $$\n    h \\approx \\frac{\\sqrt{\\frac{\\eta^5}{5} \\cdot \\frac{\\eta^3}{3}}}{\\frac{\\eta^4}{4}} = \\frac{\\eta^4/\\sqrt{15}}{\\eta^4/4} = \\frac{4}{\\sqrt{15}} \\approx 1.0328\n    $$\n-   **解释：** 随着简并参数 $\\eta$ 从负值增加到正值，谱硬度 $h$ 减小。非简并气体 ($\\eta \\ll 0$) 具有宽的热能分布，导致相对宽度较大，因此 $h$ 值较高。相反，强简并气体 ($\\eta \\gg 0$) 的粒子集中在费米能级 $\\mu_\\nu$ 以下的能态上，导致其能谱相对于其平均能量更加尖锐，从而产生较小的 $h$ 值。因此，更高程度的简并对应于分布更窄意义上的“更硬”的谱。\n\n提供的Python代码使用 `scipy.integrate.quad` 进行数值积分，实现了此算法，为给定的测试用例计算了所需的量，并按规定格式化输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Solves the neutrino statistics problem for a given set of test cases.\n\n    This function calculates the mean energy", "id": "3572170"}, {"introduction": "理解了中微子的能谱分布后，下一步是模拟它们在空间中的传播。本练习将介绍离散纵标 ($S_n$) 方法，这是一种求解辐射输运方程角度依赖性的基本技术。通过使用一个简化的正交配置来计算辐射场的角矩，你将直接体验到如何用一组离散的方向来近似一个连续的辐射场，并评估这种离散化带来的误差。[@problem_id:3572166]", "problem": "给定一个使用$S_n$方案进行中微子输运的离散纵标设置，其中中微子比强度$I(\\boldsymbol{\\Omega})$在单位球面上的连续角积分由一组具有求积权重$\\{w_k\\}$的有限方向集$\\{\\boldsymbol{n}_k\\}$来近似。使用自然单位制，其中光速满足$c = 1$，并将所有输出表示为无量纲量。角矩的基本定义是以下对立体角（单位为球面度）的积分：辐射能量密度$E$、辐射通量矢量$\\boldsymbol{F}$和辐射压力张量$\\boldsymbol{P}$，\n$$\nE = \\int_{4\\pi} I(\\boldsymbol{\\Omega})\\,\\mathrm{d}\\Omega,\\quad\n\\boldsymbol{F} = \\int_{4\\pi} \\boldsymbol{n}\\,I(\\boldsymbol{\\Omega})\\,\\mathrm{d}\\Omega,\\quad\n\\boldsymbol{P} = \\int_{4\\pi} \\boldsymbol{n}\\boldsymbol{n}\\,I(\\boldsymbol{\\Omega})\\,\\mathrm{d}\\Omega,\n$$\n其中$\\boldsymbol{n}$是与$\\boldsymbol{\\Omega}$关联的单位方向矢量，$\\boldsymbol{n}\\boldsymbol{n}$表示外积。对于一个已知的具有恒定强度$I_0$的各向同性源，其解析矩为\n$$\nE_{\\text{true}} = 4\\pi I_0,\\quad \\boldsymbol{F}_{\\text{true}} = \\boldsymbol{0},\\quad \\boldsymbol{P}_{\\text{true}} = \\frac{E_{\\text{true}}}{3}\\,\\boldsymbol{I}_3,\n$$\n其中$\\boldsymbol{I}_3$是$3\\times 3$单位张量。\n\n您必须使用给定的求积方法推导并实现离散纵标近似，然后评估在使用所提供的强度集$\\{I_k\\}$恢复各向同性时的误差。使用以下具有六个轴对齐方向和相等权重的水平对称求积法，该方法能精确积分常数：\n- 方向（单位矢量）：$\\boldsymbol{n}_1 = (1,0,0)$，$\\boldsymbol{n}_2 = (-1,0,0)$，$\\boldsymbol{n}_3 = (0,1,0)$，$\\boldsymbol{n}_4 = (0,-1,0)$，$\\boldsymbol{n}_5 = (0,0,1)$，$\\boldsymbol{n}_6 = (0,0,-1)$。\n- 权重：$w_k = \\frac{4\\pi}{6}$ 对于 $k=1,\\dots,6$，使得 $\\sum_{k=1}^{6} w_k = 4\\pi$。\n\n假设潜在的各向同性强度为$I_0 = 1$。对于每个测试用例，给定一组六个离散强度$\\{I_k\\}_{k=1}^6$，按上述顺序对应于六个方向。计算$E$、$\\boldsymbol{F}$和$\\boldsymbol{P}$的离散近似值，然后计算以下各向同性误差度量：\n- 相对能量误差：$\\varepsilon_E = \\frac{|E - E_{\\text{true}}|}{E_{\\text{true}}}$。\n- 由解析能量归一化的通量大小：$\\varepsilon_F = \\frac{\\|\\boldsymbol{F}\\|_2}{E_{\\text{true}}}$。\n- 压力各向同性偏差（Frobenius范数），由解析各向同性压力大小归一化：$\\varepsilon_P = \\frac{\\|\\boldsymbol{P} - \\boldsymbol{P}_{\\text{true}}\\|_F}{\\|\\boldsymbol{P}_{\\text{true}}\\|_F}$。\n\n测试套件（每个用例是与六个方向按规定顺序对齐的六个强度的列表）：\n- 用例1（完美各向同性）：$[1.0,\\,1.0,\\,1.0,\\,1.0,\\,1.0,\\,1.0]$。\n- 用例2（保持总能量守恒的微小各向异性扰动）：$[1.02,\\,0.98,\\,1.0,\\,1.0,\\,1.1,\\,0.9]$。\n- 用例3（极端前向峰值各向异性）：$[0.0,\\,0.0,\\,0.0,\\,0.0,\\,6.0,\\,0.0]$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的用例结果列表。每个用例结果本身必须是一个用方括号括起来的、按以下顺序排列的逗号分隔列表：\n$$[E,\\ F_x,\\ F_y,\\ F_z,\\ P_{xx},\\ P_{yy},\\ P_{zz},\\ \\varepsilon_E,\\ \\varepsilon_F,\\ \\varepsilon_P],$$\n其中$E$、$F_x$、$F_y$、$F_z$、$P_{xx}$、$P_{yy$、$P_{zz}$、$\\varepsilon_E$、$\\varepsilon_F$和$\\varepsilon_P$是浮点数。例如，总体格式为\n$$[[E_1,F_{x,1},F_{y,1},F_{z,1},P_{xx,1},P_{yy,1},P_{zz,1},\\varepsilon_{E,1},\\varepsilon_{F,1},\\varepsilon_{P,1}],\\ [E_2,\\dots],\\ [E_3,\\dots]].$$", "solution": "用户提供了一个问题陈述，在尝试解决之前需要进行验证。\n\n### 步骤1：提取已知条件\n- **方法**：用于中微子输运的离散纵标（$S_n$）方案。\n- **单位**：自然单位制，光速$c = 1$。\n- **矩的定义**：\n  - 辐射能量密度：$E = \\int_{4\\pi} I(\\boldsymbol{\\Omega})\\,\\mathrm{d}\\Omega$\n  - 辐射通量矢量：$\\boldsymbol{F} = \\int_{4\\pi} \\boldsymbol{n}\\,I(\\boldsymbol{\\Omega})\\,\\mathrm{d}\\Omega$\n  - 辐射压力张量：$\\boldsymbol{P} = \\int_{4\\pi} \\boldsymbol{n}\\boldsymbol{n}\\,I(\\boldsymbol{\\Omega})\\,\\mathrm{d}\\Omega$\n- **解析矩（对于各向同性源$I_0$）**：\n  - $E_{\\text{true}} = 4\\pi I_0$\n  - $\\boldsymbol{F}_{\\text{true}} = \\boldsymbol{0}$\n  - $\\boldsymbol{P}_{\\text{true}} = \\frac{E_{\\text{true}}}{3}\\,\\boldsymbol{I}_3$\n- **求积方案**：\n  - 方向：$\\boldsymbol{n}_1 = (1,0,0)$，$\\boldsymbol{n}_2 = (-1,0,0)$，$\\boldsymbol{n}_3 = (0,1,0)$，$\\boldsymbol{n}_4 = (0,-1,0)$，$\\boldsymbol{n}_5 = (0,0,1)$，$\\boldsymbol{n}_6 = (0,0,-1)$。\n  - 权重：$w_k = \\frac{4\\pi}{6}$ 对于 $k=1,\\dots,6$。\n- **源假设**：潜在的各向同性强度$I_0 = 1$。\n- **输入数据（测试用例）**：三组六个离散强度$\\{I_k\\}_{k=1}^6$：\n  - 用例1：$[1.0,\\,1.0,\\,1.0,\\,1.0,\\,1.0,\\,1.0]$\n  - 用例2：$[1.02,\\,0.98,\\,1.0,\\,1.0,\\,1.1,\\,0.9]$\n  - 用例3：$[0.0,\\,0.0,\\,0.0,\\,0.0,\\,6.0,\\,0.0]$\n- **需要计算的误差度量**：\n  - 相对能量误差：$\\varepsilon_E = \\frac{|E - E_{\\text{true}}|}{E_{\\text{true}}}$\n  - 归一化通量大小：$\\varepsilon_F = \\frac{\\|\\boldsymbol{F}\\|_2}{E_{\\text{true}}}$\n  - 归一化压力偏差：$\\varepsilon_P = \\frac{\\|\\boldsymbol{P} - \\boldsymbol{P}_{\\text{true}}\\|_F}{\\|\\boldsymbol{P}_{\\text{true}}\\|_F}$\n- **输出格式**：一个列表的列表，每个内部列表包含$[E,\\ F_x,\\ F_y,\\ F_z,\\ P_{xx},\\ P_{yy},\\ P_{zz},\\ \\varepsilon_E,\\ \\varepsilon_F,\\ \\varepsilon_P]$。\n\n### 步骤2：使用提取的已知条件进行验证\n根据既定的验证标准对问题进行评估。\n- **科学基础**：该问题基于离散纵标（$S_n$）方法，这是辐射转移理论中一种标准且基础的技术，广泛应用于计算物理学，包括中微子输运。角矩的定义及其在各向同性场中的解析形式是正确的。所选择的求积法是一种简单但有效的$S_2$水平对称求积法。该问题是这些原理的教科书式应用。\n- **适定性**：该问题提供了所有必要信息：矩的定义、精确的求积规则（方向和权重）、测试数据（强度）以及误差度量的精确公式。任务包括直接计算，存在唯一且稳定的解。\n- **客观性**：问题陈述使用了精确、量化且无偏见的语言。所有术语都得到了明确定义。\n\n该问题没有缺陷。它在科学上不是不合理的，也不是不可形式化、不完整、不现实或不适定的。该设置是物理学数值方法的标准练习，并非微不足道或人为设计的。\n\n### 步骤3：结论和行动\n该问题是**有效的**。将开发一个解决方案。\n\n### 解法推导\n\n问题的核心是使用提供的求积规则，将辐射矩定义中的连续角积分替换为离散求和。这种近似的一般形式是：\n$$\n\\int_{4\\pi} f(\\boldsymbol{\\Omega})\\,\\mathrm{d}\\Omega \\approx \\sum_{k=1}^{N} w_k f(\\boldsymbol{n}_k)\n$$\n在这里，$N=6$，所有$k$的权重均为$w_k = \\frac{4\\pi}{6} = \\frac{2\\pi}{3}$，方向$\\{\\boldsymbol{n}_k\\}$是沿笛卡尔坐标轴的单位矢量。\n\n首先，我们确定强度为$I_0=1$的各向同性场的真值。\n- $E_{\\text{true}} = 4\\pi I_0 = 4\\pi$\n- $\\boldsymbol{F}_{\\text{true}} = \\boldsymbol{0} \\implies (F_x, F_y, F_z) = (0,0,0)$\n- $\\boldsymbol{P}_{\\text{true}} = \\frac{E_{\\text{true}}}{3}\\boldsymbol{I}_3 = \\frac{4\\pi}{3}\\boldsymbol{I}_3 = \\mathrm{diag}(\\frac{4\\pi}{3}, \\frac{4\\pi}{3}, \\frac{4\\pi}{3})$\n\n接下来，我们使用给定的求积法，为一组强度$\\{I_k\\}_{k=1}^6$推导矩的离散纵标近似表达式。\n\n1.  **辐射能量密度 ($E$)**：\n    $$\n    E = \\sum_{k=1}^6 w_k I_k = \\frac{2\\pi}{3} (I_1 + I_2 + I_3 + I_4 + I_5 + I_6)\n    $$\n\n2.  **辐射通量矢量 ($\\boldsymbol{F}$)**：\n    $$\n    \\boldsymbol{F} = \\sum_{k=1}^6 w_k I_k \\boldsymbol{n}_k = \\frac{2\\pi}{3} \\left( I_1\\begin{pmatrix}1\\\\0\\\\0\\end{pmatrix} + I_2\\begin{pmatrix}-1\\\\0\\\\0\\end{pmatrix} + I_3\\begin{pmatrix}0\\\\1\\\\0\\end{pmatrix} + I_4\\begin{pmatrix}0\\\\-1\\\\0\\end{pmatrix} + I_5\\begin{pmatrix}0\\\\0\\\\1\\end{pmatrix} + I_6\\begin{pmatrix}0\\\\0\\\\-1\\end{pmatrix} \\right)\n    $$\n    通量矢量的分量为：\n    $$\n    F_x = \\frac{2\\pi}{3} (I_1 - I_2), \\quad F_y = \\frac{2\\pi}{3} (I_3 - I_4), \\quad F_z = \\frac{2\\pi}{3} (I_5 - I_6)\n    $$\n\n3.  **辐射压力张量 ($\\boldsymbol{P}$)**：\n    对于轴对齐方向，外积$\\boldsymbol{n}\\boldsymbol{n}$产生的矩阵在对角线上只有一个非零项。\n    $\\boldsymbol{n}_1\\boldsymbol{n}_1^T = \\mathrm{diag}(1,0,0)$，$\\boldsymbol{n}_2\\boldsymbol{n}_2^T = \\mathrm{diag}(1,0,0)$，以此类推。\n    $$\n    \\boldsymbol{P} = \\sum_{k=1}^6 w_k I_k (\\boldsymbol{n}_k \\boldsymbol{n}_k^T)\n    $$\n    该张量是对角的。对角分量为：\n    $$\n    P_{xx} = w_1 I_1 (1)^2 + w_2 I_2 (-1)^2 = \\frac{2\\pi}{3}(I_1 + I_2)\n    $$\n    $$\n    P_{yy} = w_3 I_3 (1)^2 + w_4 I_4 (-1)^2 = \\frac{2\\pi}{3}(I_3 + I_4)\n    $$\n    $$\n    P_{zz} = w_5 I_5 (1)^2 + w_6 I_6 (-1)^2 = \\frac{2\\pi}{3}(I_5 + I_6)\n    $$\n    非对角元素均为零。\n\n最后，我们定义误差度量的计算公式。\n- **相对能量误差 ($\\varepsilon_E$)**：\n  $$\n  \\varepsilon_E = \\frac{|E - E_{\\text{true}}|}{E_{\\text{true}}} = \\frac{|E - 4\\pi|}{4\\pi}\n  $$\n\n- **归一化通量大小 ($\\varepsilon_F$)**：\n  通量的欧几里得范数为$\\|\\boldsymbol{F}\\|_2 = \\sqrt{F_x^2 + F_y^2 + F_z^2}$。\n  $$\n  \\varepsilon_F = \\frac{\\|\\boldsymbol{F}\\|_2}{E_{\\text{true}}} = \\frac{\\sqrt{F_x^2 + F_y^2 + F_z^2}}{4\\pi}\n  $$\n\n- **归一化压力偏差 ($\\varepsilon_P$)**：\n  这里使用Frobenius范数，$\\|\\boldsymbol{A}\\|_F = \\sqrt{\\sum_{i,j} |A_{ij}|^2}$。\n  偏差张量为$\\Delta\\boldsymbol{P} = \\boldsymbol{P} - \\boldsymbol{P}_{\\text{true}} = \\mathrm{diag}(P_{xx} - \\frac{4\\pi}{3}, P_{yy} - \\frac{4\\pi}{3}, P_{zz} - \\frac{4\\pi}{3})$。\n  其范数为$\\|\\Delta\\boldsymbol{P}\\|_F = \\sqrt{(P_{xx} - \\frac{4\\pi}{3})^2 + (P_{yy} - \\frac{4\\pi}{3})^2 + (P_{zz} - \\frac{4\\pi}{3})^2}$。\n  真实压力张量的范数为$\\|\\boldsymbol{P}_{\\text{true}}\\|_F = \\sqrt{3 \\left(\\frac{4\\pi}{3}\\right)^2} = \\frac{4\\pi}{\\sqrt{3}}$。\n  $$\n  \\varepsilon_P = \\frac{\\|\\boldsymbol{P} - \\boldsymbol{P}_{\\text{true}}\\|_F}{\\|\\boldsymbol{P}_{\\text{true}}\\|_F} = \\frac{\\sqrt{(P_{xx} - \\frac{4\\pi}{3})^2 + (P_{yy} - \\frac{4\\pi}{3})^2 + (P_{zz} - \\frac{4\\pi}{3})^2}}{4\\pi/\\sqrt{3}}\n  $$\n\n这些公式将为每个测试用例实现，以计算所需的输出值。这个$S_2$求积法的特性是它可以精确积分最高1次的多项式。由于$I_0$是一个常数（0次），因此在用例1中，矩$E$和$\\boldsymbol{P}$被精确积分。由于强度是对称的，通量$\\boldsymbol{F}$为零。对于用例2和3，$\\sum I_k = 6$，这意味着离散能量$E = \\frac{2\\pi}{3}(6) = 4\\pi$总是等于$E_{\\text{true}}$，从而得到$\\varepsilon_E=0$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the neutrino transport problem for the given test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (perfect isotropy)\n        [1.0, 1.0, 1.0, 1.0, 1.0, 1.0],\n        # Case 2 (small anisotropic perturbations)\n        [1.02, 0.98, 1.0, 1.0, 1.1, 0.9],\n        # Case 3 (extreme forward-peaked anisotropy)\n        [0.0, 0.0, 0.0, 0.0, 6.0, 0.0]\n    ]\n\n    # --- Quadrature Scheme Definition ---\n    # Directions (unit vectors) as a NumPy array\n    directions = np.array([\n        [1.0, 0.0, 0.0],  # n_1\n        [-1.0, 0.0, 0.0], # n_2\n        [0.0, 1.0, 0.0],  # n_3\n        [0.0, -1.0, 0.0], # n_4\n        [0.0, 0.0, 1.0],  # n_5\n        [0.0, 0.0, -1.0]  # n_6\n    ])\n\n    # Weights: w_k = 4*pi/6 for all k.\n    # Total number of directions N = 6.\n    N = 6\n    weights = np.full(N, 4.0 * np.pi / N)\n\n    # --- Analytic (True) Values ---\n    # Underlying isotropic intensity I_0 = 1\n    I0 = 1.0\n    # True energy density E_true = 4*pi*I0\n    E_true = 4.0 * np.pi * I0\n    # True flux vector F_true = 0\n    F_true = np.zeros(3)\n    # True pressure tensor P_true = (E_true/3) * I_3\n    P_true = (E_true / 3.0) * np.identity(3)\n    \n    # --- Main Calculation Loop ---\n    all_results = []\n    for intensities in test_cases:\n        I_k = np.array(intensities)\n\n        # --- Calculate Discrete Moments ---\n        \n        # 1. Radiation Energy Density (E)\n        # E = sum(w_k * I_k)\n        E = np.sum(weights * I_k)\n\n        # 2. Radiation Flux Vector (F)\n        # F = sum(w_k * I_k * n_k)\n        # This is equivalent to a weighted sum of direction vectors.\n        # We can use np.einsum for a compact calculation: 'i,ij-j'\n        # which means sum over i: weights[i] * I_k[i] * directions[i,j] - result[j]\n        # Or more explicitly:\n        F = np.sum(weights[:, np.newaxis] * I_k[:, np.newaxis] * directions, axis=0)\n\n        # 3. Radiation Pressure Tensor (P)\n        # P = sum(w_k * I_k * (n_k outer_product n_k))\n        P = np.zeros((3, 3))\n        for k in range(N):\n            P += weights[k] * I_k[k] * np.outer(directions[k], directions[k])\n        \n        # --- Calculate Error Metrics ---\n        \n        # 1. Relative energy error (epsilon_E)\n        eps_E = np.abs(E - E_true) / E_true\n\n        # 2. Normalized flux magnitude (epsilon_F)\n        # ||F||_2 is the Euclidean norm (L2 norm)\n        F_norm = np.linalg.norm(F, ord=2)\n        eps_F = F_norm / E_true\n\n        # 3. Pressure isotropy deviation (epsilon_P)\n        # ||A||_F is the Frobenius norm, default for np.linalg.norm on 2D arrays\n        P_deviation = P - P_true\n        P_deviation_norm = np.linalg.norm(P_deviation)\n        P_true_norm = np.linalg.norm(P_true)\n        # Avoid division by zero if P_true_norm is zero\n        eps_P = P_deviation_norm / P_true_norm if P_true_norm  0 else 0.0\n\n        # --- Assemble Results for Printing ---\n        F_x, F_y, F_z = F[0], F[1], F[2]\n        P_xx, P_yy, P_zz = P[0, 0], P[1, 1], P[2, 2]\n\n        case_result = [E, F_x, F_y, F_z, P_xx, P_yy, P_zz, eps_E, eps_F, eps_P]\n        \n        # Convert the list of floats to a string representation for the final output\n        all_results.append(f\"[{','.join(f'{x:.12g}' for x in case_result)}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(all_results)}]\")\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3572166"}, {"introduction": "虽然 $S_n$ 方法直接求解角强度，但在计算上可能非常昂贵，矩方法通过直接演化辐射场的角矩（如能量密度和通量）来提供一种更高效的替代方案。然而，这种方法的关键挑战在于“闭合关系”，即如何用低阶矩来近似高阶矩。本练习将让你在一个具有挑战性的斜入射自由流测试中，评估两种标准矩闭合（M1闭合和Kershaw闭合）的性能，从而揭示它们在模拟非均质介质中辐射束流时固有的优点和局限性。[@problem_id:3572208]", "problem": "考虑自由流极限（无碰撞项）中中微子输运的双矩量公式。令 $E(\\mathbf{x},t)$ 表示中微子能量密度，$\\mathbf{F}(\\mathbf{x},t)$ 表示中微子能流，$\\mathsf{P}(\\mathbf{x},t)$ 表示中微子压力张量。在没有源和吸收的情况下，控制方程为守恒律\n$$\n\\partial_t E + \\nabla \\cdot \\mathbf{F} = 0, \\qquad \\partial_t \\mathbf{F} + c^2 \\nabla \\cdot \\mathsf{P} = 0,\n$$\n其中 $c$ 是光速。为了封闭该系统，使用形式如下的代数 Eddington 张量闭合关系\n$$\n\\mathsf{P} = \\mathsf{D} E, \\quad \\mathsf{D} = \\frac{1 - \\chi(f)}{2} \\, \\mathsf{I} + \\frac{3 \\chi(f) - 1}{2} \\, \\mathbf{n} \\mathbf{n},\n$$\n其中 $\\mathsf{I}$ 是单位张量，流因子 $f$ 定义为 $f \\equiv \\frac{\\lVert \\mathbf{F} \\rVert}{c E}$，$\\mathbf{n}$ 是流方向的单位向量 $\\mathbf{n} \\equiv \\mathbf{F} / \\lVert \\mathbf{F} \\rVert$。函数 $\\chi(f)$（Eddington 因子）取决于所选的矩量闭合关系。在本问题中，您将比较两种标准的闭合关系：\n- Levermore（一阶矩 (M1)）闭合：\n$$\n\\chi_{\\mathrm{Lev}}(f) = \\frac{3 + 4 f^2}{5 + 2 \\sqrt{4 - 3 f^2}}.\n$$\n- Kershaw 闭合：\n$$\n\\chi_{\\mathrm{Ker}}(f) = \\frac{1 + 2 f^2}{3}.\n$$\n\n我们设计了一个穿过密度间断面的自由流斜入射测试，该测试在中微子能量密度中引入一个阶跃，同时保持传播方向均匀。考虑一个二维笛卡尔坐标系，坐标为 $(x,y)$，在 $x=0$ 处存在 $E$ 的平面间断。令左侧状态为 $E_L$（对于 $x  0$）和右侧状态为 $E_R$（对于 $x \\ge 0$），两者在 $y$ 方向上均为常数。在一个以 $x = 0$ 为中心、宽度为 $\\Delta x$ 的代表性界面控制体积内，定义：\n- 局部梯度 $\\mathbf{g} \\equiv \\nabla E = \\big((E_R - E_L)/\\Delta x,\\, 0\\big)$。\n- 射束方向单位向量 $\\mathbf{n} = (\\cos \\theta, \\sin \\theta)$，其中 $\\theta$ 以弧度为单位。\n- 局部视流因子 $f_{\\mathrm{app}} \\in (0, 1]$，用于模拟间断面附近斜入射时的数值角度弥散。\n- 界面中心的局部初始状态 $E_0 \\equiv (E_L + E_R)/2$，$\\mathbf{F}_0 \\equiv c \\, f_{\\mathrm{app}} \\, E_0 \\, \\mathbf{n}$。\n\n使用大小为 $\\Delta t$ 的单步前向欧拉法，根据封闭系统推进矩量：\n$$\nE_1 = E_0 + \\Delta t \\left( - \\nabla \\cdot \\mathbf{F}_0 \\right), \\qquad \\mathbf{F}_1 = \\mathbf{F}_0 + \\Delta t \\left( - c^2 \\nabla \\cdot \\mathsf{P}_0 \\right),\n$$\n其中\n$$\n\\nabla \\cdot \\mathbf{F}_0 = c \\, f_{\\mathrm{app}} \\, (\\mathbf{n} \\cdot \\mathbf{g}), \\qquad \\mathsf{P}_0 = \\mathsf{D}(f_{\\mathrm{app}}) \\, E_0, \\qquad \\nabla \\cdot \\mathsf{P}_0 = \\left[\\frac{1 - \\chi(f_{\\mathrm{app}})}{2}\\right] \\mathbf{g} + \\left[\\frac{3 \\chi(f_{\\mathrm{app}}) - 1}{2}\\right] \\mathbf{n} \\, (\\mathbf{n} \\cdot \\mathbf{g}),\n$$\n其中 $\\chi(f)$ 是所选闭合关系的 Eddington 因子，$\\mathsf{D}(f)$ 使用 $f_{\\mathrm{app}}$ 和 $\\mathbf{n}$ 进行评估。\n\n定义两个诊断量来量化斜入射时由闭合关系引起的伪影：\n- 无量纲的横向通量大小\n$$\nL \\equiv \\frac{\\lVert \\mathbf{F}_{1,\\perp} \\rVert}{c E_0}, \\quad \\text{其中} \\quad \\mathbf{F}_{1,\\perp} \\equiv \\mathbf{F}_1 - (\\mathbf{n} \\cdot \\mathbf{F}_1) \\mathbf{n},\n$$\n它测量了相对于特征自由流尺度 $c E_0$ 的伪横向通量，对于穿过间断面的完美射束状自由流，该值应为零。\n- 一步后的流因子误差\n$$\n\\varepsilon_f \\equiv f_1 - 1, \\quad \\text{其中} \\quad f_1 \\equiv \\frac{\\lVert \\mathbf{F}_1 \\rVert}{c E_1},\n$$\n它测量了在存在间断和斜入射的情况下，由闭合关系引起的与射束极限 $f = 1$ 的偏差。\n\n实现一个程序，对于每个闭合关系，为以下测试套件计算 $L$ 和 $\\varepsilon_f$。使用物理光速 $c = 2.99792458 \\times 10^{10} \\ \\mathrm{cm} \\ \\mathrm{s}^{-1}$。所有能量 $E$ 的单位为 $\\mathrm{erg} \\ \\mathrm{cm}^{-3}$，距离 $\\Delta x$ 的单位为 $\\mathrm{cm}$，时间 $\\Delta t$ 的单位为 $\\mathrm{s}$，$\\theta$ 的单位为弧度。将 $L$ 和 $\\varepsilon_f$ 报告为无量纲实数。\n\n测试套件（每个元组为 $(E_L, E_R, \\Delta x, \\theta, f_{\\mathrm{app}}, \\Delta t)$）：\n- 情况 1：$\\left(1.0 \\times 10^{20}, \\ 0.5 \\times 10^{20}, \\ 1.0 \\times 10^{5}, \\ \\frac{\\pi}{4}, \\ 0.85, \\ 1.0 \\times 10^{-7}\\right)$。\n- 情况 2：$\\left(1.0 \\times 10^{20}, \\ 0.2 \\times 10^{20}, \\ 5.0 \\times 10^{4}, \\ 0.08726646259971647, \\ 0.70, \\ 5.0 \\times 10^{-8}\\right)$。\n- 情况 3：$\\left(1.0 \\times 10^{20}, \\ 0.9 \\times 10^{20}, \\ 1.0 \\times 10^{5}, \\ 1.48352986419518, \\ 0.90, \\ 1.0 \\times 10^{-7}\\right)$。\n\n最终输出规范：\n- 对于每种情况，使用 Levermore 闭合计算对 $(L_{\\mathrm{Lev}}, \\varepsilon_{f,\\mathrm{Lev}})$，并使用 Kershaw 闭合计算对 $(L_{\\mathrm{Ker}}, \\varepsilon_{f,\\mathrm{Ker}})$。\n- 您的程序应生成单行输出，其中包含所有情况的结果，按顺序连接成一个用方括号括起来的逗号分隔列表，每种情况按顺序贡献四个值 $\\left[L_{\\mathrm{Lev}}, \\varepsilon_{f,\\mathrm{Lev}}, L_{\\mathrm{Ker}}, \\varepsilon_{f,\\mathrm{Ker}}\\right]$。例如，总体输出格式为\n$$\n\\left[ L_{\\mathrm{Lev}}^{(1)}, \\varepsilon_{f,\\mathrm{Lev}}^{(1)}, L_{\\mathrm{Ker}}^{(1)}, \\varepsilon_{f,\\mathrm{Ker}}^{(1)}, \\ L_{\\mathrm{Lev}}^{(2)}, \\varepsilon_{f,\\mathrm{Lev}}^{(2)}, L_{\\mathrm{Ker}}^{(2)}, \\varepsilon_{f,\\mathrm{Ker}}^{(2)}, \\ L_{\\mathrm{Lev}}^{(3)}, \\varepsilon_{f,\\mathrm{Lev}}^{(3)}, L_{\\mathrm{Ker}}^{(3)}, \\varepsilon_{f,\\mathrm{Ker}}^{(3)} \\right].\n$$\n所有浮点值都应以默认数字格式打印，不含任何附加文本。", "solution": "## 问题验证 ##\n根据指定标准对问题陈述进行严格评估。\n\n### 步骤 1：提取已知条件\n**控制方程（自由流，无源）：**\n- $E$ 能量密度守恒：$\\partial_t E + \\nabla \\cdot \\mathbf{F} = 0$\n- $\\mathbf{F}$ 能流守恒：$\\partial_t \\mathbf{F} + c^2 \\nabla \\cdot \\mathsf{P} = 0$\n\n**闭合关系（代数 Eddington 张量）：**\n- 压力张量 $\\mathsf{P} = \\mathsf{D} E$\n- Eddington 张量 $\\mathsf{D} = \\frac{1 - \\chi(f)}{2} \\, \\mathsf{I} + \\frac{3 \\chi(f) - 1}{2} \\, \\mathbf{n} \\mathbf{n}$\n- 流因子 $f = \\frac{\\lVert \\mathbf{F} \\rVert}{c E}$\n- 流方向 $\\mathbf{n} = \\mathbf{F} / \\lVert \\mathbf{F} \\rVert$\n\n**Eddington 因子模型 ($\\chi(f)$)：**\n- Levermore (M1)：$\\chi_{\\mathrm{Lev}}(f) = \\frac{3 + 4 f^2}{5 + 2 \\sqrt{4 - 3 f^2}}$\n- Kershaw：$\\chi_{\\mathrm{Ker}}(f) = \\frac{1 + 2 f^2}{3}$\n\n**测试用例设置（二维笛卡尔坐标）：**\n- $x=0$ 处的 $E$ 间断：对于 $x  0$ 为 $E_L$，对于 $x \\ge 0$ 为 $E_R$。\n- 局部梯度：$\\mathbf{g} \\equiv \\nabla E = \\big((E_R - E_L)/\\Delta x,\\, 0\\big)$。\n- 射束方向单位向量：$\\mathbf{n} = (\\cos \\theta, \\sin \\theta)$。\n- 局部视流因子：$f_{\\mathrm{app}} \\in (0, 1]$。\n- 界面中心的初始状态：$E_0 \\equiv (E_L + E_R)/2$, $\\mathbf{F}_0 \\equiv c \\, f_{\\mathrm{app}} \\, E_0 \\, \\mathbf{n}$。\n\n**时间积分（前向欧拉步）：**\n- $E_1 = E_0 + \\Delta t \\left( - \\nabla \\cdot \\mathbf{F}_0 \\right)$\n- $\\mathbf{F}_1 = \\mathbf{F}_0 + \\Delta t \\left( - c^2 \\nabla \\cdot \\mathsf{P}_0 \\right)$\n\n**散度近似：**\n- $\\nabla \\cdot \\mathbf{F}_0 = c \\, f_{\\mathrm{app}} \\, (\\mathbf{n} \\cdot \\mathbf{g})$\n- $\\nabla \\cdot \\mathsf{P}_0 = \\left[\\frac{1 - \\chi(f_{\\mathrm{app}})}{2}\\right] \\mathbf{g} + \\left[\\frac{3 \\chi(f_{\\mathrm{app}}) - 1}{2}\\right] \\mathbf{n} \\, (\\mathbf{n} \\cdot \\mathbf{g})$\n\n**诊断量：**\n- 横向通量大小：$L \\equiv \\frac{\\lVert \\mathbf{F}_{1,\\perp} \\rVert}{c E_0}$，其中 $\\mathbf{F}_{1,\\perp} \\equiv \\mathbf{F}_1 - (\\mathbf{n} \\cdot \\mathbf{F}_1) \\mathbf{n}$。\n- 流因子误差：$\\varepsilon_f \\equiv f_1 - 1$，其中 $f_1 \\equiv \\frac{\\lVert \\mathbf{F}_1 \\rVert}{c E_1}$。\n\n**常数和参数：**\n- 光速：$c = 2.99792458 \\times 10^{10} \\ \\mathrm{cm} \\ \\mathrm{s}^{-1}$。\n- 测试套件（以 $(E_L, E_R, \\Delta x, \\theta, f_{\\mathrm{app}}, \\Delta t)$ 的元组形式）：\n    1.  $(1.0 \\times 10^{20}, \\ 0.5 \\times 10^{20}, \\ 1.0 \\times 10^{5}, \\ \\frac{\\pi}{4}, \\ 0.85, \\ 1.0 \\times 10^{-7})$\n    2.  $(1.0 \\times 10^{20}, \\ 0.2 \\times 10^{20}, \\ 5.0 \\times 10^{4}, \\ 0.08726646259971647, \\ 0.70, \\ 5.0 \\times 10^{-8})$\n    3.  $(1.0 \\times 10^{20}, \\ 0.9 \\times 10^{20}, \\ 1.0 \\times 10^{5}, \\ 1.48352986419518, \\ 0.90, \\ 1.0 \\times 10^{-7})$\n\n### 步骤 2：使用提取的已知条件进行验证\n1.  **科学性：** 该问题基于成熟的辐射输运矩量公式，这是计算天体物理学和物理学中的一种标准技术。控制方程是玻尔兹曼输运方程的前两个矩量。M1 (Levermore) 和 Kershaw 闭合是标准的、广泛使用的代数闭合关系。涉及在间断面上斜入射的测试设置是评估此类闭合关系性能的常用方法。该问题是科学合理的。\n2.  **适定性：** 所有必需的方程、初始条件、常数和参数都已明确提供。计算序列定义清晰，可为每个测试用例得出唯一的数值结果。该问题是适定的。\n3.  **客观性：** 问题以精确的数学和物理术语陈述，没有主观性或模糊性。\n4.  **完整性和一致性：** 问题是自洽的。所提供的 $\\nabla \\cdot \\mathsf{P}_0$ 公式是在假设 Eddington 张量 $\\mathsf{D}$ 在控制体积内为常数的情况下，对 $\\mathsf{P} = \\mathsf{D} E$ 正确应用散度的乘积法则。对于这种单步分析，这是一个合理的近似。所有组件都是一致的。\n5.  **真实性和可行性：** 所提供的能量密度、长度和时间值是中微子输运显著的天体物理环境（如超新星爆发或中子星合并）的典型值。该问题在物理上是可信的，在计算上是可行的。\n\n### 步骤 3：结论与行动\n问题是**有效的**。这是一个在核天体物理学中定义明确的计算问题，符合所有验证标准。将提供解决方案。\n\n## 解答 ##\n该解答需要实现中微子能量密度 $E$ 和能流 $\\mathbf{F}$ 的单步前向欧拉时间演化，然后计算指定的诊断量。计算针对两种不同的矩量闭合方案（Levermore 和 Kershaw）进行。\n\n我们首先为给定的测试用例 $(E_L, E_R, \\Delta x, \\theta, f_{\\mathrm{app}}, \\Delta t)$ 建立状态变量和参数。光速为 $c = 2.99792458 \\times 10^{10} \\ \\mathrm{cm} \\ \\mathrm{s}^{-1}$。\n\n**1. 初始状态和离散梯度**\n\n初始状态定义在跨越 $x=0$ 处间断面的控制体积中心。\n初始能量密度 $E_0$ 是左、右状态的平均值：\n$$\nE_0 = \\frac{E_L + E_R}{2}\n$$\n中微子束沿着由单位向量 $\\mathbf{n}$ 给出的方向传播：\n$$\n\\mathbf{n} = (\\cos\\theta, \\sin\\theta)^T\n$$\n初始能流 $\\mathbf{F}_0$ 使用给定的视流因子 $f_{\\mathrm{app}}$ 构建，该因子模拟了界面上的状态：\n$$\n\\mathbf{F}_0 = c \\, f_{\\mathrm{app}} \\, E_0 \\, \\mathbf{n}\n$$\n跨越宽度为 $\\Delta x$ 的控制体积的能量密度梯度 $\\mathbf{g} = \\nabla E$ 的有限差分近似为：\n$$\n\\mathbf{g} = \\left(\\frac{E_R - E_L}{\\Delta x}, 0\\right)^T\n$$\n该向量表示能量密度的空间变化。\n\n**2. 散度项计算**\n\n前向欧拉更新需要通量的散度 $\\nabla \\cdot \\mathbf{F}_0$ 和压力张量的散度 $\\nabla \\cdot \\mathsf{P}_0$。\n问题给出了通量散度的表达式，该表达式源于假设 $\\mathbf{F} = c f_{\\mathrm{app}} E \\mathbf{n}$ 且 $f_{\\mathrm{app}}$ 和 $\\mathbf{n}$ 为常数：\n$$\n\\nabla \\cdot \\mathbf{F}_0 = \\nabla \\cdot (c f_{\\mathrm{app}} E_0 \\mathbf{n}) = c f_{\\mathrm{app}} \\mathbf{n} \\cdot \\nabla E_0 = c f_{\\mathrm{app}} (\\mathbf{n} \\cdot \\mathbf{g})\n$$\n压力张量的散度由下式给出：\n$$\n\\nabla \\cdot \\mathsf{P}_0 = \\left[\\frac{1 - \\chi(f_{\\mathrm{app}})}{2}\\right] \\mathbf{g} + \\left[\\frac{3 \\chi(f_{\\mathrm{app}}) - 1}{2}\\right] \\mathbf{n} (\\mathbf{n} \\cdot \\mathbf{g})\n$$\n此项的值取决于 Eddington 因子 $\\chi(f_{\\mathrm{app}})$，该因子使用指定的闭合模型计算：\n- **Levermore 闭合：** $\\chi_{\\mathrm{Lev}}(f_{\\mathrm{app}}) = \\frac{3 + 4 f_{\\mathrm{app}}^2}{5 + 2 \\sqrt{4 - 3 f_{\\mathrm{app}}^2}}$\n- **Kershaw 闭合：** $\\chi_{\\mathrm{Ker}}(f_{\\mathrm{app}}) = \\frac{1 + 2 f_{\\mathrm{app}}^2}{3}$\n我们对每个闭合关系分别执行后续步骤。\n\n**3. 前向欧拉时间步**\n\n使用离散化的守恒律将能量密度和通量从时间 $t_0$ 更新到 $t_1 = t_0 + \\Delta t$：\n$$\nE_1 = E_0 - \\Delta t (\\nabla \\cdot \\mathbf{F}_0)\n$$\n$$\n\\mathbf{F}_1 = \\mathbf{F}_0 - \\Delta t \\, c^2 (\\nabla \\cdot \\mathsf{P}_0)\n$$\n\n**4. 诊断量计算**\n\n计算出更新后的状态 $(E_1, \\mathbf{F}_1)$ 后，我们计算两个诊断量。\n\n- **无量纲横向通量大小，$L$：**\n该诊断量化了垂直于预定射束方向 $\\mathbf{n}$ 产生的伪通量。首先，我们将 $\\mathbf{F}_1$ 投影到 $\\mathbf{n}$ 上以找到其平行分量 $(\\mathbf{n} \\cdot \\mathbf{F}_1)\\mathbf{n}$。然后，垂直分量为：\n$$\n\\mathbf{F}_{1,\\perp} = \\mathbf{F}_1 - (\\mathbf{n} \\cdot \\mathbf{F}_1)\\mathbf{n}\n$$\n无量纲大小是其范数，通过特征通量 $c E_0$ 进行缩放：\n$$\nL = \\frac{\\lVert \\mathbf{F}_{1,\\perp} \\rVert}{c E_0}\n$$\n\n- **流因子误差，$\\varepsilon_f$：**\n该诊断量测量更新后的状态偏离自由流极限 ($f=1$) 的程度。我们首先计算新的流因子 $f_1$：\n$$\nf_1 = \\frac{\\lVert \\mathbf{F}_1 \\rVert}{c E_1}\n$$\n误差是与理想值 $1$ 的差值：\n$$\n\\varepsilon_f = f_1 - 1\n$$\n对三个测试用例中的每一个重复此整个过程，并且对于每个用例，都使用 Levermore 和 Kershaw 闭合来计算诊断对 $(L, \\varepsilon_f)$。最终输出将这些结果连接起来。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes closure-induced artifacts in a two-moment neutrino transport test.\n    \"\"\"\n    # Physical constants\n    c = 2.99792458e10  # Speed of light in cm/s\n\n    # Test suite: (E_L, E_R, delta_x, theta, f_app, delta_t)\n    test_cases = [\n        (1.0e20, 0.5e20, 1.0e5, np.pi/4, 0.85, 1.0e-7),\n        (1.0e20, 0.2e20, 5.0e4, 0.08726646259971647, 0.70, 5.0e-8), # theta approx 5 deg\n        (1.0e20, 0.9e20, 1.0e5, 1.48352986419518, 0.90, 1.0e-7),    # theta approx 85 deg\n    ]\n\n    all_results = []\n\n    # Define Eddington factor functions\n    def chi_levermore(f):\n        # The M1 closure requires 4 - 3f^2 = 0, or |f| = 2/sqrt(3) approx 1.1547.\n        # The problem statement guarantees f_app in (0, 1], so this is safe.\n        return (3.0 + 4.0 * f**2) / (5.0 + 2.0 * np.sqrt(4.0 - 3.0 * f**2))\n\n    def chi_kershaw(f):\n        return (1.0 + 2.0 * f**2) / 3.0\n\n    closure_funcs = {\n        'levermore': chi_levermore,\n        'kershaw': chi_kershaw,\n    }\n\n    for case in test_cases:\n        E_L, E_R, delta_x, theta, f_app, delta_t = case\n\n        # 1. Initial State and Discretized Gradients\n        E0 = (E_L + E_R) / 2.0\n        g_vec = np.array([(E_R - E_L) / delta_x, 0.0])\n        n_vec = np.array([np.cos(theta), np.sin(theta)])\n        F0_vec = c * f_app * E0 * n_vec\n\n        # 2. Divergence Term Calculation\n        # This part is common to both closures\n        n_dot_g = np.dot(n_vec, g_vec)\n        div_F0 = c * f_app * n_dot_g\n\n        # Perform calculations for each closure\n        for closure_name in ['levermore', 'kershaw']:\n            chi_func = closure_funcs[closure_name]\n            chi = chi_func(f_app)\n\n            # Calculate divergence of pressure tensor\n            term1_coeff = (1.0 - chi) / 2.0\n            term2_coeff = (3.0 * chi - 1.0) / 2.0\n            div_P0_vec = term1_coeff * g_vec + term2_coeff * n_vec * n_dot_g\n            \n            # 3. Forward Euler Time Step\n            E1 = E0 - delta_t * div_F0\n            F1_vec = F0_vec - delta_t * c**2 * div_P0_vec\n\n            # 4. Diagnostic Calculation\n            # Lateral Flux Magnitude (L)\n            F1_perp_vec = F1_vec - np.dot(n_vec, F1_vec) * n_vec\n            L = np.linalg.norm(F1_perp_vec) / (c * E0)\n\n            # Flux-Factor Error (eps_f)\n            # Handle potential E1=0 case to avoid division by zero\n            if E1 == 0.0:\n                 # In this specific problem setup E1 will not realistically be zero.\n                f1 = np.inf if np.linalg.norm(F1_vec)  0 else 0.0\n            else:\n                f1 = np.linalg.norm(F1_vec) / (c * E1)\n            \n            eps_f = f1 - 1.0\n\n            all_results.extend([L, eps_f])\n            \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "3572208"}]}