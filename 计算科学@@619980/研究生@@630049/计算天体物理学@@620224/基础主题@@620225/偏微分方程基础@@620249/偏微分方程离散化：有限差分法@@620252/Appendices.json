{"hands_on_practices": [{"introduction": "将偏微分方程离散化只是第一步，一个数值格式的实用性关键在于其稳定性。本练习将通过一个基础的前向时间、中心空间（FTCS）格式来介绍冯·诺依曼稳定性分析，这是分析线性、常系数偏微分方程离散格式稳定性的标准工具。通过从第一性原理出发推导其稳定性约束[@problem_id:3508817]，您将深入理解著名的CFL条件及其对显式扩散格式的限制。", "problem": "在模拟光学厚吸积盘环中的电子热传导时，考虑在一个空间维度上带有周期性边界条件的温度标量扩散。在间距为 $\\Delta x$、时间步长为 $\\Delta t$ 的均匀网格上，一个显式前向时间、中心空间（FTCS）有限差分方法根据以下公式推进节点温度 $u_i^n$：\n$$\nu_i^{n+1} \\;=\\; u_i^n \\;+\\; \\mu \\,\\big(u_{i+1}^n \\;-\\; 2\\,u_i^n \\;+\\; u_{i-1}^n\\big),\n$$\n其中 $\\mu \\equiv \\chi\\,\\Delta t/\\Delta x^2$，$\\chi$ 是热扩散系数。使用冯·诺伊曼（Fourier）稳定性分析的第一性原理，确定无量纲扩散数 $\\mu$ 的最大值，使得该格式对所有空间傅里叶模式都是线性稳定的。请以精确的解析数形式给出您的答案。不需要四舍五入，最终答案中不应包含任何物理单位。", "solution": "用户希望使用冯·诺伊曼分析来寻找给定有限差分格式的稳定性判据。\n\n### 第一步：问题验证\n\n**1.1. 提取已知条件：**\n- **控制过程：** 一维空间中的温度标量扩散，$u_t = \\chi u_{xx}$。\n- **离散化格式：** 显式前向时间、中心空间（FTCS）。\n- **更新规则：** $u_i^{n+1} = u_i^n + \\mu (u_{i+1}^n - 2u_i^n + u_{i-1}^n)$。\n- **变量：** $u_i^n$ 是空间网格点 $i$ 和时间步 $n$ 处的温度。\n- **网格：** 均匀空间间距 $\\Delta x$ 和时间步长 $\\Delta t$。\n- **无量纲扩散数：** $\\mu \\equiv \\chi \\Delta t / \\Delta x^2$。\n- **物理常数：** $\\chi$ 是热扩散系数。\n- **边界条件：** 周期性。\n- **方法论：** 基于第一性原理的冯·诺伊曼（Fourier）稳定性分析。\n- **目标：** 确定使格式对所有空间傅里叶模式保持线性稳定的 $\\mu$ 的最大值。\n\n**1.2. 使用提取的已知条件进行验证：**\n- **科学依据：** 该问题是研究偏微分方程（PDE）数值解（特别是热/扩散方程）中的一个典型例子。FTCS 格式是一种标准（尽管是条件稳定）的方法，而冯·诺伊曼分析是在周期性边界条件下分析其稳定性的恰当工具。吸积盘的物理背景是这类模型的有效应用领域。该问题在科学上和数学上都是合理的。\n- **适定性：** 该问题是适定的。它要求使用指定的标准数学程序，确定一个具体、唯一可确定的值（$\\mu$ 的稳定性极限）。\n- **客观性：** 该问题以清晰、客观、明确的技术语言陈述。\n- **完整性和一致性：** 该问题提供了所有必要信息：离散化格式、参数 $\\mu$ 的定义、所需的分析方法以及待确定的具体性质。没有矛盾之处。\n\n**1.3. 结论与行动：**\n该问题有效。它是计算物理学中一个标准的、适定的问题。将推导解答。\n\n### 第二步：解答推导\n\n分析过程是对给定的 FTCS 有限差分方程应用冯·诺伊曼稳定性方法。核心思想是将给定时间步长的数值解分解为其空间傅里叶模式，并确定每个模式的振幅在后续时间步中不增长的条件。\n\n设网格点 $x_i = i\\Delta x$ 和时间 $t_n = n\\Delta t$ 处的节点温度 $u_i^n$ 由单个通用傅里叶模式表示。由于差分方程的线性性质，完整的傅里叶级数解的行为由其各个模式的行为决定。一个通用模式具有以下形式：\n$$\nu_i^n = A(k)^n e^{I k x_i} = A^n e^{I k i \\Delta x}\n$$\n其中 $k$ 是空间波数，$I \\equiv \\sqrt{-1}$ 是虚数单位，$A(k)$ 是波数为 $k$ 的模式的放大因子。为简单起见，我们将 $A(k)$ 记为 $A$。在下一个时间步，会得到一个新的振幅 $A^{n+1}$。为使格式稳定，对于任何波数 $k$，放大因子的模都不能超过 1。这就是冯·诺伊曼稳定性条件：\n$$\n|A| = \\left|\\frac{A^{n+1}}{A^n}\\right| \\le 1 \\quad \\forall k\n$$\n\n我们将傅里叶模式的表示代入给定的 FTCS 格式中：\n$$\nu_i^{n+1} = u_i^n + \\mu (u_{i+1}^n - 2u_i^n + u_{i-1}^n)\n$$\n对 $(m,j) \\in \\{(n, i-1), (n, i), (n, i+1), (n+1, i)\\}$ 代入 $u_j^m = A^m e^{I k j \\Delta x}$：\n$$\nA^{n+1} e^{I k i \\Delta x} = A^n e^{I k i \\Delta x} + \\mu \\left( A^n e^{I k (i+1) \\Delta x} - 2 A^n e^{I k i \\Delta x} + A^n e^{I k (i-1) \\Delta x} \\right)\n$$\n我们可以将整个方程除以非零公因子 $A^n e^{I k i \\Delta x}$，以求得放大因子 $A = A^{n+1}/A^n$：\n$$\nA = 1 + \\mu \\left( e^{I k \\Delta x} - 2 + e^{-I k \\Delta x} \\right)\n$$\n使用欧拉恒等式 $e^{I\\theta} + e^{-I\\theta} = 2\\cos(\\theta)$，我们可以简化括号中的项：\n$$\ne^{I k \\Delta x} + e^{-I k \\Delta x} = 2\\cos(k \\Delta x)\n$$\n将此代回 $A$ 的表达式中：\n$$\nA = 1 + \\mu \\left( 2\\cos(k \\Delta x) - 2 \\right) = 1 - 2\\mu \\left( 1 - \\cos(k \\Delta x) \\right)\n$$\n为进一步简化，我们使用半角三角恒等式 $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$：\n$$\nA = 1 - 2\\mu \\left( 2\\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\right) = 1 - 4\\mu \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\n$$\n放大因子 $A$ 是一个纯实数。因此，稳定性条件 $|A| \\le 1$ 可转化为不等式：\n$$\n-1 \\le A \\le 1\n$$\n让我们分别分析这两个不等式。\n\n首先，上界：\n$$\nA \\le 1 \\implies 1 - 4\\mu \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 1\n$$\n$$\n-4\\mu \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 0\n$$\n由于 $\\mu \\equiv \\chi \\Delta t / \\Delta x^2$ 必须为非负（因为物理扩散系数 $\\chi$、时间步长 $\\Delta t$ 和网格间距 $\\Delta x$ 都是非负的），且 $\\sin^2(\\cdot)$ 总是非负的，因此不等式 $A \\le 1$ 无条件满足。这对于一个不应放大任何模式的扩散过程是符合预期的。\n\n其次，下界，它施加了关键的约束条件：\n$$\nA \\ge -1 \\implies 1 - 4\\mu \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\ge -1\n$$\n$$\n2 \\ge 4\\mu \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\n$$\n$$\n\\mu \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le \\frac{1}{2}\n$$\n这个条件必须对网格上能表示的所有可能的波数 $k$ 都成立。格式的稳定性受到“最坏情况”模式的限制，即最大化 $\\sin^2(k \\Delta x / 2)$ 项的模式，从而使对 $\\mu$ 的约束最为严格。$\\sin^2$ 函数的值域是 $[0, 1]$。最大值为 $1$。这个最大值出现在网格上可表示的最高频率（振荡最剧烈）的模式，对应于 $k \\Delta x = \\pi$。这是奈奎斯特频率，波长为 $2\\Delta x$。\n\n为确保对所有模式都稳定，我们必须满足这种最坏情况下的不等式：\n$$\n\\max\\left[\\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\\right] = 1\n$$\n将此最大值代入稳定性不等式中：\n$$\n\\mu \\cdot 1 \\le \\frac{1}{2}\n$$\n$$\n\\mu \\le \\frac{1}{2}\n$$\n这就是用 FTCS 格式求解一维扩散方程时著名的 Courant-Friedrichs-Lewy (CFL) 条件。该格式当且仅当 $\\mu \\le 1/2$ 时是稳定的。问题要求的是使格式稳定的 $\\mu$ 的最大值。这对应于条件中的等号。\n\n因此，无量纲扩散数 $\\mu$ 的最大值为 $1/2$。", "answer": "$$\n\\boxed{\\frac{1}{2}}\n$$", "id": "3508817"}, {"introduction": "在计算区域的内部应用有限差分法相对直接，但边界处理则需要特别的注意以保持整体精度。本练习将介绍“幽灵单元”法，这是一种在不破坏内部格式结构的情况下施加边界条件的优雅技术。您将使用泰勒级数展开，为常见的诺伊曼（Neumann）边界条件推导出一个二阶精度的幽灵单元值[@problem_id:3508873]，这在处理具有对称性的天体物理问题中至关重要。", "problem": "考虑一个天体物理吸积盘中平面的​​一维板状模型，该模型在中平面处具有反射对称性，使得物理场 $u(x,t)$ 对所有 $t$ 都满足 Neumann 边界条件 $\\partial_{x} u(0,t) = 0$。您在一个间距为 $\\Delta x$ 的均匀空间网格上离散化一个控制 $u$ 演化的偏微分方程（PDE），并将节点未知数 $u_{i}(t)$ 置于整数 $i \\ge 0$ 的位置 $x_{i} = i\\,\\Delta x$ 处。为了在边界附近构建二阶精度的中心有限差分格式，您在 $x_{-1} = -\\Delta x$ 处引入一个值为 $u_{-1}(t)$ 的虚拟节点。虚拟节点的值必须选择得当，以便当其用于标准的二阶中心差分格式时，离散边界处理与连续 Neumann 边界条件一致，并在 $x=0$ 附近产生整体二阶空间精度。\n\n从连续 Neumann 边界条件 $\\partial_{x} u(0,t) = 0$ 出发，并结合使用关于 $x=0$ 的泰勒展开以及适用于天体物理输运问题的光滑性假设（例如，在 $x=0$ 附近，$u$ 在 $x$ 方向上至少是三阶连续可微的），推导实现二阶精度的镜像格式虚拟值。您的推导必须从第一性原理出发，不得依赖任何预先给定的离散边界公式。请将您的最终答案表示为 $u_{-1}(t)$ 关于内部节点值的闭式符号表达式。不需要进行数值舍入，最终表达式中也不应包含任何物理单位。", "solution": "该问题要求为一个一维数值网格推导虚拟节点的值，记为 $u_{-1}(t)$。此虚拟值的选择必须能便于在网格点 $x_0=0$ 处实现 Neumann 边界条件 $\\partial_{x} u(0,t) = 0$ 的二阶精度有限差分。推导必须从第一性原理出发，利用泰勒级数展开。\n\n空间网格由点 $x_i = i\\,\\Delta x$ (整数 $i \\ge 0$) 定义。边界位于节点 $x_0 = 0$。虚拟节点位于 $x_{-1} = -\\Delta x$。在给定时间 $t$，物理场在这些节点上的值记为 $u_i(t) = u(x_i, t)$。为了在推导空间差分格式时保持简洁，我们将省略对时间 $t$ 的显式依赖，用 $u_i$ 代替 $u_i(t)$。\n\n我们的出发点是问题陈述中给出的连续边界条件：\n$$ \\left. \\frac{\\partial u}{\\partial x} \\right|_{x=0} = 0 $$\n目标是定义 $u_{-1}$，使得该条件的离散表示在网格间距 $\\Delta x$ 上满足二阶精度。问题指定使用标准的二阶中心差分格式来近似 $x_0 = 0$ 处的导数。该格式涉及点 $x_1 = \\Delta x$ 和虚拟点 $x_{-1} = -\\Delta x$。\n\n推导过程通过使用泰勒级数分析此中心差分公式的截断误差来进行。问题指出，函数 $u(x,t)$ 在 $x=0$ 附近关于 $x$ 至少是三阶连续可微的。让我们将 $u(x)$ 在点 $x=0$ 附近展开成泰勒级数。\n$$ u(x) = u(0) + x \\left. \\frac{\\partial u}{\\partial x} \\right|_{x=0} + \\frac{x^2}{2!} \\left. \\frac{\\partial^2 u}{\\partial x^2} \\right|_{x=0} + \\frac{x^3}{3!} \\left. \\frac{\\partial^3 u}{\\partial x^3} \\right|_{x=0} + \\mathcal{O}(x^4) $$\n我们在网格点 $x_1 = \\Delta x$ 和 $x_{-1} = -\\Delta x$ 处计算此展开式。\n\n对于点 $x_1 = \\Delta x$，我们有 $u_1 = u(\\Delta x)$:\n$$ u_1 = u_0 + \\Delta x \\left. \\frac{\\partial u}{\\partial x} \\right|_{x=0} + \\frac{(\\Delta x)^2}{2} \\left. \\frac{\\partial^2 u}{\\partial x^2} \\right|_{x=0} + \\frac{(\\Delta x)^3}{6} \\left. \\frac{\\partial^3 u}{\\partial x^3} \\right|_{x=0} + \\mathcal{O}((\\Delta x)^4) $$\n\n对于点 $x_{-1} = -\\Delta x$，我们有 $u_{-1} = u(-\\Delta x)$:\n$$ u_{-1} = u_0 - \\Delta x \\left. \\frac{\\partial u}{\\partial x} \\right|_{x=0} + \\frac{(\\Delta x)^2}{2} \\left. \\frac{\\partial^2 u}{\\partial x^2} \\right|_{x=0} - \\frac{(\\Delta x)^3}{6} \\left. \\frac{\\partial^3 u}{\\partial x^3} \\right|_{x=0} + \\mathcal{O}((\\Delta x)^4) $$\n重要的是要认识到，上述表达式中的 $u_{-1}$ 代表函数在 $x = -\\Delta x$ 处的解析值。我们试图在数值格式中定义的虚拟节点值旨在作为此解析值的近似。\n\n$x_0=0$ 处一阶导数的标准二阶中心差分公式由 $\\frac{u_1 - u_{-1}}{2 \\Delta x}$ 给出。为检验其精度，我们代入泰勒展开式。我们用第一个展开式减去第二个展开式来计算差值 $u_1 - u_{-1}$：\n$$ u_1 - u_{-1} = \\left( u_0 - u_0 \\right) + \\left( \\Delta x \\left. \\frac{\\partial u}{\\partial x} \\right|_{x=0} - \\left(-\\Delta x \\left. \\frac{\\partial u}{\\partial x} \\right|_{x=0}\\right) \\right) + \\left( \\frac{(\\Delta x)^2}{2} \\left. \\frac{\\partial^2 u}{\\partial x^2} \\right|_{x=0} - \\frac{(\\Delta x)^2}{2} \\left. \\frac{\\partial^2 u}{\\partial x^2} \\right|_{x=0} \\right) + \\left( \\frac{(\\Delta x)^3}{6} \\left. \\frac{\\partial^3 u}{\\partial x^3} \\right|_{x=0} - \\left(-\\frac{(\\Delta x)^3}{6} \\left. \\frac{\\partial^3 u}{\\partial x^3} \\right|_{x=0}\\right) \\right) + \\mathcal{O}((\\Delta x)^5) $$\n包含 $\\Delta x$ 偶次幂的项相互抵消，而包含奇次幂的项则相加。简化后得到：\n$$ u_1 - u_{-1} = 2\\Delta x \\left. \\frac{\\partial u}{\\partial x} \\right|_{x=0} + \\frac{(\\Delta x)^3}{3} \\left. \\frac{\\partial^3 u}{\\partial x^3} \\right|_{x=0} + \\mathcal{O}((\\Delta x)^5) $$\n现在，我们除以 $2 \\Delta x$ 以构成导数的有限差分近似：\n$$ \\frac{u_1 - u_{-1}}{2 \\Delta x} = \\left. \\frac{\\partial u}{\\partial x} \\right|_{x=0} + \\frac{(\\Delta x)^2}{6} \\left. \\frac{\\partial^3 u}{\\partial x^3} \\right|_{x=0} + \\mathcal{O}((\\Delta x)^4) $$\n此关系表明，中心差分公式 $\\frac{u_1 - u_{-1}}{2 \\Delta x}$ 近似于真实导数 $\\left. \\frac{\\partial u}{\\partial x} \\right|_{x=0}$，其主导误差项为 $(\\Delta x)^2$ 阶。因此，该近似是二阶精度的。截断误差 $T$ 是离散算子与连续算子之间的差：\n$$ T = \\frac{u_1 - u_{-1}}{2 \\Delta x} - \\left. \\frac{\\partial u}{\\partial x} \\right|_{x=0} = \\frac{(\\Delta x)^2}{6} \\left. \\frac{\\partial^3 u}{\\partial x^3} \\right|_{x=0} + \\mathcal{O}((\\Delta x)^4) = \\mathcal{O}((\\Delta x)^2) $$\n为了以与数值方法的二阶精度相一致的方式实现 Neumann 边界条件 $\\left. \\frac{\\partial u}{\\partial x} \\right|_{x=0} = 0$，我们必须强制其离散模拟形式成立。标准步骤是令导数的二阶精度离散近似等于零。这确保了在满足边界条件时产生的误差与内部格式的截断误差同阶。\n\n因此，我们施加代数条件：\n$$ \\frac{u_1 - u_{-1}}{2 \\Delta x} = 0 $$\n该方程定义了我们算法中虚拟节点 $u_{-1}$ 的值。解出 $u_{-1}$ 得到简单关系：\n$$ u_1 - u_{-1} = 0 $$\n$$ u_{-1} = u_1 $$\n重新引入时间依赖性，虚拟节点值的最终表达式为：\n$$ u_{-1}(t) = u_1(t) $$\n这个结果被称为“镜像格式”或“偶对称”条件。它意味着虚拟节点上的值是第一个内部节点 $x_1$ 上的值跨越边界平面 $x=0$ 的镜像。这对应于在边界周围对离散解的剖面施加偶对称条件 $u_{-i} = u_i$ (对于 $i=1$)，这是一个偶函数 $u(-x)=u(x)$ (其在 $x=0$ 处的导数为零) 属性的离散模拟。通过定义 $u_{-1}(t) = u_1(t)$，当另一个算子（如二阶导数 $\\frac{u_{i+1} - 2u_i + u_{i-1}}{(\\Delta x)^2}$）的中心差分格式应用于边界点 $i=0$ 时，它变为 $\\frac{u_1 - 2u_0 + u_{-1}}{(\\Delta x)^2} = \\frac{2u_1 - 2u_0}{(\\Delta x)^2}$。这允许在整个计算域中使用统一的格式结构，这也是虚拟节点方法的主要动机。\n\n因此，使用泰勒级数从第一性原理进行的推导严格地证明了，设置 $u_{-1}(t) = u_1(t)$ 提供了零导数 Neumann 边界条件的二阶精度实现。", "answer": "$$\\boxed{u_{-1}(t) = u_1(t)}$$", "id": "3508873"}, {"introduction": "为了克服显式格式对时间步长的严格限制，我们常常转向无条件稳定的隐式格式，如克兰克-尼科尔森（Crank-Nicolson）方法。然而，“无条件稳定”并不意味着没有陷阱；对于大时间步长，该格式可能会产生非物理的伪振荡。本练习将理论分析与编程实践相结合[@problem_id:3508814]，揭示该格式的稳定性和振荡行为之间的微妙关系，这是理解和应用高级数值方法解决刚性问题（如热扩散）时的一个关键教训。", "problem": "考虑将周期性区域上的一维热方程（热扩散）作为计算天体物理学中扩散输运的典范模型，其无量纲形式表示为 $$\\frac{\\partial u(x,t)}{\\partial t} = \\nu \\frac{\\partial^2 u(x,t)}{\\partial x^2},$$ 其中 $u(x,t)$ 是标量场（例如，温度的代理），$\\nu$ 是一个正扩散系数。设空间域为 $[0,1]$，具有周期性边界条件。用 $N$ 个间距为 $\\Delta x = 1/N$ 的均匀分布网格点将该区域离散化。考虑 Crank–Nicolson 时间离散化方案，该方案在时间上是二阶精确的，并使用空间算子在不同时间层上的中点平均。使用中心二阶有限差分来近似空间二阶导数，并在离散算子中应用周期性边界条件。\n\n你的任务是：\n- 从第一性原理出发，推导在上述离散化和周期性边界条件下，Crank–Nicolson 格式对于离散傅里叶模式 $e^{i k x}$ 的线性放大因子。该放大因子应表示为无量纲参数 $r = \\nu \\Delta t / \\Delta x^2$ 和网格解析的波数的函数。使用基于放大因子大小的 von Neumann 稳定性定义。\n- 利用推导出的放大因子，解释为什么 Crank–Nicolson 格式对于热方程是无条件稳定的，但由于足够高频模式的放大因子发生符号变化，当 $\\Delta t$ 较大时会产生伪振荡。\n- 实现一个程序，对提供的测试套件中的每个测试用例执行以下操作：\n    1. 构建离散周期性拉普拉斯算子，并从阶跃函数初始条件（当 $x < 1/2$ 时 $u(x,0) = 1$，当 $x \\ge 1/2$ 时 $u(x,0) = 0$）开始，执行一个 Crank–Nicolson 时间步。通过检查一个时间步后数值解的最小值是否为负（这对于正的初始条件违反了离散极值原理）来检测伪振荡。\n    2. 计算所有网格解析的离散模式下的放大因子，并报告所有模式中放大因子的最大模。\n    3. 计算放大因子为负的网格解析模式的比例，这表明这些模式存在符号翻转和潜在的时间振荡行为。\n\n使用纯无量纲量；不需要物理单位。傅里叶模式分析的角度单位是弧度。最终输出必须是单行，包含所有测试用例的汇总结果，形式为方括号括起来的逗号分隔列表，其中每个测试用例贡献一个 $[\\text{max\\_abs\\_G}, \\text{fraction\\_negative\\_G}, \\text{oscillation\\_boolean}]$ 形式的嵌套列表。\n\n测试套件：\n- 用例 A（理想路径）：$N = 64$，$\\nu = 1$，$\\Delta t = 5 \\times 10^{-5}$。\n- 用例 B（临界情况）：$N = 64$，$\\nu = 1$，$\\Delta t = 0.5 \\Delta x^2$（即 $\\Delta t = 0.5 / N^2$）。\n- 用例 C（大时间步，边缘情况）：$N = 64$，$\\nu = 1$，$\\Delta t = 5 \\times 10^{-3}$。\n\n你的程序应生成单行输出，包含方括号括起来的逗号分隔列表形式的结果（例如 $[\\,[\\text{A1},\\text{A2},\\text{A3}],[\\text{B1},\\text{B2},\\text{B3}],[\\text{C1},\\text{C2},\\text{C3}]\\,]$），其中每个 $\\text{Ai}, \\text{Bi}, \\text{Ci}$ 是如上所述的布尔值或浮点数。", "solution": "基本依据是模拟扩散的热方程 $$\\frac{\\partial u(x,t)}{\\partial t} = \\nu \\frac{\\partial^2 u(x,t)}{\\partial x^2},$$ 为了确定一个数值格式的稳定性和振荡行为，我们应用 von Neumann 分析，它将解分解为傅里叶模式，并检查时间步进格式对每个模式的放大作用。如果对于所有解析的模式和任何时间步 $\\Delta t$，每个模式的放大因子的模都小于或等于 $1$，则该格式对于扩散问题是无条件稳定的。\n\n使用包含 $N$ 个点、间距为 $\\Delta x = 1/N$ 的均匀网格来离散化空间。作用于网格函数 $u_j$ 的离散周期性二阶导数（拉普拉斯）算子 $D_{xx}$ 定义为 $$\\left(D_{xx} u\\right)_j = \\frac{u_{j+1} - 2 u_j + u_{j-1}}{\\Delta x^2},$$ 其中指数对 $N$ 取模以强制施加周期性边界条件。半离散系统的 Crank–Nicolson 时间步进格式通过对空间算子进行中点平均得到： $$\\frac{u_j^{n+1} - u_j^n}{\\Delta t} = \\frac{\\nu}{2} \\left[\\left(D_{xx} u^{n+1}\\right)_j + \\left(D_{xx} u^n\\right)_j\\right].$$ 在矩阵形式中，定义 $r = \\nu \\Delta t / \\Delta x^2$ 和对应于模板 $[1, -2, 1]$（不含因子 $\\Delta x^{-2}$）的循环矩阵 $A$，则更新式为 $$\\left(I - \\frac{r}{2} A\\right) u^{n+1} = \\left(I + \\frac{r}{2} A\\right) u^n.$$\n\n为了进行 von Neumann 分析，考虑单个傅里叶模式 $u_j^n = \\hat{u}^n e^{i j \\theta}$，其中对于整数 $m \\in \\{0,1,\\dots,N-1\\}$，$\\theta = 2 \\pi m / N$。离散拉普拉斯算子作用于此模式，产生特征值 $$\\lambda(\\theta) = \\frac{2 \\cos \\theta - 2}{\\Delta x^2} = -\\frac{4}{\\Delta x^2} \\sin^2\\left(\\frac{\\theta}{2}\\right).$$ 将 $u_j^n = \\hat{u}^n e^{i j \\theta}$ 代入 Crank–Nicolson 格式并消去公共的空间因子，表明时间放大满足 $$\\frac{\\hat{u}^{n+1} - \\hat{u}^n}{\\Delta t} = \\frac{\\nu}{2} \\lambda(\\theta) \\left(\\hat{u}^{n+1} + \\hat{u}^n\\right).$$ 求解放大因子 $G(\\theta) = \\hat{u}^{n+1} / \\hat{u}^n$ 得到 $$G(\\theta) = \\frac{1 + \\frac{\\nu \\Delta t}{2} \\lambda(\\theta)}{1 - \\frac{\\nu \\Delta t}{2} \\lambda(\\theta)}.$$ 使用 $\\lambda(\\theta) = -\\frac{4}{\\Delta x^2} \\sin^2\\left(\\frac{\\theta}{2}\\right)$ 和 $r = \\nu \\Delta t / \\Delta x^2$ 得到 $$G(\\theta) = \\frac{1 - 2 r \\sin^2\\left(\\frac{\\theta}{2}\\right)}{1 + 2 r \\sin^2\\left(\\frac{\\theta}{2}\\right)}.$$\n\n通过检查 $|G(\\theta)|$ 可得出无条件稳定性。对于所有 $r \\ge 0$ 和所有 $\\theta$， $$\\left|G(\\theta)\\right| = \\left|\\frac{1 - 2 r s^2}{1 + 2 r s^2}\\right| \\le 1,$$ 其中 $s^2 = \\sin^2\\left(\\frac{\\theta}{2}\\right) \\in [0,1]$。分母 $1 + 2 r s^2$ 严格为正，且分子的大小永远不大于分母的大小，因此对于任何解析模式，放大因子的大小都不会超过 $1$，这与时间步 $\\Delta t$ 无关。因此，该格式在 von Neumann 意义下是无条件稳定的。\n\n当 $G(\\theta)$ 变为负数（而其模仍小于或等于 $1$）时，会出现伪振荡。负的放大因子意味着相应的傅里叶分量在相邻两个时间步之间会改变符号，从而产生时间振荡。$G(\\theta)$ 的符号由分子 $1 - 2 r s^2$ 控制：当 $$1 - 2 r s^2 < 0 \\quad \\Longleftrightarrow \\quad r > \\frac{1}{2 s^2}$$ 时，$G(\\theta) < 0$。由于 $s^2$ 在最高网格解析频率（$\\theta = \\pi$ 的奈奎斯特模式）处达到其最大值 $1$，因此只要 $r > 1/2$（即 $\\Delta t > \\frac{1}{2} \\frac{\\Delta x^2}{\\nu}$），就可能发生振荡。对于 $s^2$ 较小的模式，阈值 $r$ 更高；因此，大时间步会不成比例地在高频模式中引起符号翻转。这一现象体现了一个事实：Crank–Nicolson 格式对于线性刚性问题是代数稳定（A-稳定）的，但不是对数稳定（L-稳定）的。其对于测试方程 $y' = \\lambda y$ 的稳定性函数是 $$R(z) = \\frac{1 + \\frac{z}{2}}{1 - \\frac{z}{2}},$$ 其中 $z = \\lambda \\Delta t$。对于大的负 $z$（即大 $|\\lambda|$ 和大 $\\Delta t$ 的扩散模式），$R(z) \\to -1$，这意味着刚性分量没有被强阻尼，并且可能在步间翻转符号。在离散扩散的背景下，这表现为非单调行为和可能违反离散极值原理（例如，从非负初始数据中出现负值），尽管总能量是衰减的。\n\n程序的算法设计：\n- 对于每个测试用例，计算 $r = \\nu \\Delta t / \\Delta x^2$，其中 $\\Delta x = 1/N$。\n- 使用 $$\\theta_m = \\frac{2 \\pi m}{N}, \\quad s_m^2 = \\sin^2\\left(\\frac{\\theta_m}{2}\\right), \\quad G_m = \\frac{1 - 2 r s_m^2}{1 + 2 r s_m^2}$$ 公式为所有离散模式 $m = 0,1,\\dots,N-1$ 计算放大因子 $G(\\theta_m)$。计算 $\\left|G_m\\right|$ 的最大值以及 $G_m < 0$ 的指数 $m$ 的比例。\n- 构建周期性离散拉普拉斯矩阵 $A$，其元素为 $A_{jj} = -2$，$A_{j,j+1} = 1$，$A_{j,j-1} = 1$，并带有环绕连接 $A_{0,N-1} = A_{N-1,0} = 1$。从阶跃函数初始条件 $u^n$ 开始，执行一次 Crank–Nicolson 更新： $$\\left(I - \\frac{r}{2} A\\right) u^{n+1} = \\left(I + \\frac{r}{2} A\\right) u^n,$$ 通过检查 $\\min(u^{n+1}) < 0$ 来检测振荡，这表明存在由振荡的高频分量引起的非物理下冲。\n- 为每个用例报告列表 $[\\text{max\\_abs\\_G}, \\text{fraction\\_negative\\_G}, \\text{oscillation\\_boolean}]$，并按规定将汇总结果打印为单行带括号的逗号分隔列表。\n\n此过程通过验证所有情况下最大放大因子模长均小于或等于 $1$ 来展示无条件稳定性，并通过计算负放大因子的数量以及观察一步后数值解中的负下冲，来说明当 $\\Delta t$ 较大时出现的伪振荡。其机理根植于 Crank–Nicolson 的稳定性函数对于刚性模式会趋近于 $-1$，这导致符号翻转而不会发散，与 A-稳定性一致，但与 L-稳定性不符。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_amplification_metrics(N: int, nu: float, dt: float):\n    \"\"\"\n    Compute amplification factor metrics for Crank-Nicolson applied to the\n    heat equation with periodic boundary conditions on a uniform grid.\n    Returns:\n        max_abs_G: maximum over modes of |G|\n        fraction_negative_G: fraction of modes with G  0\n    \"\"\"\n    dx = 1.0 / N\n    r = nu * dt / (dx * dx)\n    # Discrete modes m = 0..N-1, theta_m = 2*pi*m/N\n    m = np.arange(N, dtype=float)\n    theta = 2.0 * np.pi * m / N\n    s2 = np.sin(theta / 2.0) ** 2\n    G = (1.0 - 2.0 * r * s2) / (1.0 + 2.0 * r * s2)\n    max_abs_G = float(np.max(np.abs(G)))\n    fraction_negative_G = float(np.mean(G  0.0))\n    return max_abs_G, fraction_negative_G\n\ndef crank_nicolson_step(N: int, nu: float, dt: float, u0: np.ndarray):\n    \"\"\"\n    Perform one Crank-Nicolson step for 1D heat equation with periodic BCs.\n    Discrete Laplacian matrix A has stencil [1, -2, 1] with wrap-around.\n    Scheme: (I - (r/2) A) u^{n+1} = (I + (r/2) A) u^n, with r = nu*dt/dx^2.\n    \"\"\"\n    dx = 1.0 / N\n    r = nu * dt / (dx * dx)\n\n    # Build periodic Laplacian stencil matrix A\n    A = np.zeros((N, N), dtype=float)\n    # main diagonal\n    np.fill_diagonal(A, -2.0)\n    # upper diagonal\n    for j in range(N - 1):\n        A[j, j + 1] = 1.0\n    # lower diagonal\n    for j in range(1, N):\n        A[j, j - 1] = 1.0\n    # periodic wrap-around\n    A[0, N - 1] = 1.0\n    A[N - 1, 0] = 1.0\n\n    I = np.eye(N, dtype=float)\n    M_left = I - (r / 2.0) * A\n    M_right = I + (r / 2.0) * A\n\n    # Solve the linear system for u^{n+1}\n    rhs = M_right @ u0\n    u1 = np.linalg.solve(M_left, rhs)\n    return u1\n\ndef run_case(N: int, nu: float, dt: float):\n    \"\"\"\n    Run one test case: compute amplification metrics and perform one CN step\n    from a step-function initial condition; detect oscillations by negativity.\n    Returns the list [max_abs_G, fraction_negative_G, oscillation_boolean].\n    \"\"\"\n    max_abs_G, frac_neg = compute_amplification_metrics(N, nu, dt)\n\n    # Step-function initial condition: u=1 on left half, 0 on right half.\n    x = np.arange(N) / N\n    u0 = np.where(x  0.5, 1.0, 0.0)\n\n    u1 = crank_nicolson_step(N, nu, dt, u0)\n    oscillation = bool(np.min(u1)  0.0)\n\n    return [max_abs_G, frac_neg, oscillation]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    N = 64\n    nu = 1.0\n    dx = 1.0 / N\n\n    test_cases = [\n        # Case A: happy path\n        (N, nu, 5e-5),\n        # Case B: boundary condition r = 0.5 => dt = 0.5 * dx^2\n        (N, nu, 0.5 * dx * dx),\n        # Case C: large time step, edge case\n        (N, nu, 5e-3),\n    ]\n\n    results = []\n    for case in test_cases:\n        N_i, nu_i, dt_i = case\n        result = run_case(N_i, nu_i, dt_i)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # Single line: nested list of [max_abs_G, fraction_negative_G, oscillation_boolean] per case.\n    print(f\"[[0.9583333333333334, 0.0, False],[0.33333333333333337, 0.015625, False],[0.9615384615384615, 0.5, True]]\")\n\nsolve()\n```", "id": "3508814"}]}