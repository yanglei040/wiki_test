{"hands_on_practices": [{"introduction": "在一个理想化的吸积盘中，物质的轨道运动速度由中心天体的引力精确决定，这被称为开普勒速度。然而，真实的吸积盘是由气体构成的，其内部的热压力会提供一个向外的支撑力，从而在一定程度上抵消引力。通过这个练习 [@problem_id:3517571]，你将定量地计算这种压力梯度效应，并理解为何吸积盘的旋转速度通常是“亚开普勒”的，这是从纯引力模型迈向流体动力学模型的关键一步。", "problem": "您的任务是编写一个完整、可运行的程序，用于模拟在牛顿引力势中围绕中心点质量体运行的薄轴对称气体盘的方位速度剖面，该模型需包括径向气体压力梯度的影响。目标是根据给定的径向温度剖面 $T(R)$ 和表面密度剖面 $\\Sigma(R)$ 计算压力梯度，确定由此产生的方位速度 $v_{\\phi}(R)$，并将其与开普勒速度进行比较。所有物理量必须以国际单位制 (SI) 表示和计算，所有答案必须是如下文所规定的无单位浮点数。\n\n出发点与假设：\n- 点质量 $M$ 的引力势为 $\\Phi(R) = - G M / R$，其中 $G$ 是引力常数，$R$ 是柱坐标半径。\n- 假设一个稳态、轴对称、几何薄盘，其径向速度和自引力均可忽略不计。\n- 在牛顿势下，对圆周运动使用 Euler 方程的径向分量，并包含径向压力梯度项。\n- 在每个半径处使用等温垂直结构，使得 $P = \\rho c_{s}^{2}$，其中 $P$ 是热压力，$\\rho$ 是密度，$c_{s}$ 是等温声速。采用 $c_{s}^{2}(R) = k_{\\mathrm{B}} T(R) / (\\mu m_{p})$，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数，$m_{p}$ 是质子质量，$\\mu$ 是平均分子量。\n- 使用垂直积分压力 $\\Pi(R) \\equiv \\int_{-\\infty}^{+\\infty} P \\, dz$ 和表面密度 $\\Sigma(R) \\equiv \\int_{-\\infty}^{+\\infty} \\rho \\, dz$，并假设垂直方向等温，因此 $\\Pi(R) = \\Sigma(R) c_{s}^{2}(R)$。\n- 将开普勒速度定义为 $v_{K}(R) = \\sqrt{G M / R}$。\n\n要求的推导与计算：\n1. 从上述基本关系出发，推导出在牛顿势下，用 $M$、$\\Sigma(R)$ 以及垂直积分压力 $\\Pi(R)$ 的径向梯度来确定 $v_{\\phi}(R)$ 的表达式。\n2. 实现一个数值方法，从 $\\Pi(R)$ 计算径向导数 $d\\Pi/dR$。在内部使用二阶精度的有限差分格式，在边界使用一阶单边格式。\n3. 计算 $v_{\\phi}(R)$ 并通过评估绝对分数偏差 $\\delta(R) \\equiv \\lvert v_{\\phi}(R)/v_{K}(R) - 1 \\rvert$ 将其与 $v_{K}(R)$ 进行比较。\n4. 对于下面指定的每个测试用例，返回在给定径向网格上 $\\delta(R)$ 的最大值，结果为一个单个浮点数。\n\n需使用的物理常数和单位：\n- 使用 $G = 6.67430 \\times 10^{-11} \\ \\mathrm{m^{3} \\ kg^{-1} \\ s^{-2}}$。\n- 使用 $M_{\\odot} = 1.98847 \\times 10^{30} \\ \\mathrm{kg}$。\n- 使用 $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23} \\ \\mathrm{J \\ K^{-1}}$。\n- 使用 $m_{p} = 1.67262192369 \\times 10^{-27} \\ \\mathrm{kg}$。\n- 使用 $\\mu = 2.34$ (无量纲)。\n- 使用 $1$ 天文单位作为 $1 \\ \\mathrm{AU} = 1.495978707 \\times 10^{11} \\ \\mathrm{m}$。\n- 所有径向距离 $R$ 必须以 $\\mathrm{m}$ 为单位，温度以 $\\mathrm{K}$ 为单位，表面密度 $\\Sigma$ 以 $\\mathrm{kg \\ m^{-2}}$ 为单位，速度以 $\\mathrm{m \\ s^{-1}}$ 为单位，最终报告的偏差必须是无单位浮点数。\n\n需使用的剖面：\n- 温度：$T(R) = T_{0} \\left( R / R_{0} \\right)^{-q}$。\n- 表面密度：如果提供了锥削半径 $R_{c}$，则 $\\Sigma(R) = \\Sigma_{0} \\left( R / R_{0} \\right)^{-p} \\times \\exp\\left( - R / R_{c} \\right)$；否则省略指数因子。\n\n数值微分要求：\n- 对于具有均匀间距 $\\Delta R$ 的半径网格 $\\{ R_{i} \\}_{i=0}^{N-1}$，使用以下方法近似 $d\\Pi/dR$：\n  - 内部点 $i \\in \\{1,2,\\dots,N-2\\}$：$ \\left( d\\Pi/dR \\right)_{i} \\approx \\left( \\Pi_{i+1} - \\Pi_{i-1} \\right) / \\left( 2 \\Delta R \\right)$。\n  - 边界：$ \\left( d\\Pi/dR \\right)_{0} \\approx \\left( \\Pi_{1} - \\Pi_{0} \\right) / \\Delta R$ 和 $ \\left( d\\Pi/dR \\right)_{N-1} \\approx \\left( \\Pi_{N-1} - \\Pi_{N-2} \\right) / \\Delta R$。\n\n测试套件：\n对于以下每个测试用例，将半径网格 $\\{R_{i}\\}$ 构建为在给定边界（含）之间具有给定点数的线性间隔数组，计算 $\\delta(R)$，并返回网格上的最大值。在所有情况下，设置 $M = M_{\\star} \\equiv 1 \\ M_{\\odot}$ 和 $\\mu = 2.34$。\n\n- 测试用例 1 (理想情况，无锥削的幂律)：\n  - $R \\in [0.1 \\ \\mathrm{AU}, \\ 100 \\ \\mathrm{AU}]$，点数 $N = 256$。\n  - $T_{0} = 280 \\ \\mathrm{K}$ 于 $R_{0} = 1 \\ \\mathrm{AU}$，指数 $q = 0.5$。\n  - $\\Sigma_{0} = 17000 \\ \\mathrm{kg \\ m^{-2}}$ 于 $R_{0} = 1 \\ \\mathrm{AU}$，指数 $p = 1.0$。\n  - 无指数锥削（省略指数因子）。\n- 测试用例 2 (边界情况，常数剖面)：\n  - $R \\in [1 \\ \\mathrm{AU}, \\ 10 \\ \\mathrm{AU}]$，点数 $N = 256$。\n  - $T_{0} = 100 \\ \\mathrm{K}$ 于 $R_{0} = 1 \\ \\mathrm{AU}$，指数 $q = 0.0$。\n  - $\\Sigma_{0} = 100 \\ \\mathrm{kg \\ m^{-2}}$ 于 $R_{0} = 1 \\ \\mathrm{AU}$，指数 $p = 0.0$。\n  - 无指数锥削。\n- 测试用例 3 (带锥削的外盘)：\n  - $R \\in [1 \\ \\mathrm{AU}, \\ 200 \\ \\mathrm{AU}]$，点数 $N = 512$。\n  - $T_{0} = 150 \\ \\mathrm{K}$ 于 $R_{0} = 1 \\ \\mathrm{AU}$，指数 $q = 0.4$。\n  - $\\Sigma_{0} = 1000 \\ \\mathrm{kg \\ m^{-2}}$ 于 $R_{0} = 1 \\ \\mathrm{AU}$，指数 $p = 1.0$。\n  - 指数锥削，其中 $R_{c} = 30 \\ \\mathrm{AU}$。\n- 测试用例 4 (热内盘，更陡的梯度)：\n  - $R \\in [0.1 \\ \\mathrm{AU}, \\ 10 \\ \\mathrm{AU}]$，点数 $N = 384$。\n  - $T_{0} = 1000 \\ \\mathrm{K}$ 于 $R_{0} = 0.1 \\ \\mathrm{AU}$，指数 $q = 0.75$。\n  - $\\Sigma_{0} = 10000 \\ \\mathrm{kg \\ m^{-2}}$ 于 $R_{0} = 0.1 \\ \\mathrm{AU}$，指数 $p = 1.5$。\n  - 无指数锥削。\n\n输出内容：\n- 对于每个测试用例，计算最大绝对分数偏差 $\\max_{i} \\delta(R_{i})$。\n- 您的程序应产生单行输出，其中包含一个由四个浮点数组成的逗号分隔列表，并用方括号括起来，每个浮点数都精确到小数点后六位。例如，输出形式为 $[x_{1},x_{2},x_{3},x_{4}]$，其中每个 $x_{j}$ 是一个小数点后有六位数且无单位的浮点数。\n\n角度单位：不使用角度。\n\n百分比：不要使用百分号；偏差是一个分数，必须以无单位浮点数的形式报告。\n\n科学真实性约束：\n- 确保计算出的 $v_{\\phi}^{2}(R)$ 永远不会为负。如果由于舍入误差，数值微分导致一个轻微的负值，则在开平方根之前必须将其视为零。\n\n最终要求：\n- 最终代码必须是自包含的，不需要任何输入，并且仅向标准输出打印指定的单行列表。实现语言和库的约束在执行环境中另行指定。", "solution": "用户请求解决一个计算天体物理问题，该问题涉及计算气体吸积盘中的方位速度剖面。第一步是验证问题陈述。经确认，该问题具有科学依据、良定、客观且内部一致。它代表了吸积盘理论中的一个标准练习。因此，我将提供一个完整的解决方案。\n\n该解决方案包括两个主要阶段：首先，推导方位速度的控制方程；其次，实现一个数值算法，根据给定的物理参数和剖面来求解该方程。\n\n### I. 方位速度方程的推导\n\n在引力势中，控制流体运动的基本关系是 Euler 方程。对于势 $\\Phi$ 内处于圆周运动（$v_R = v_z = 0$, $v_\\phi \\neq 0$）的稳态（$\\partial/\\partial t = 0$）、轴对称（$\\partial/\\partial\\phi = 0$）和无粘性流体，Euler 方程在柱坐标系 $(R, \\phi, z)$ 中的径向分量为：\n$$\n-\\frac{v_{\\phi}^2(R)}{R} = \\frac{\\partial \\Phi(R)}{\\partial R} + \\frac{1}{\\rho}\\frac{\\partial P}{\\partial R}\n$$\n此处，$\\rho$ 是体密度，$P$ 是热压力。左边的项是向心加速度。右边的项分别是单位质量所受的引力和单位质量所受的压力梯度力。\n\n重新排列此方程以求解 $v_{\\phi}^2$ 可得：\n$$\nv_{\\phi}^2(R) = -R\\frac{\\partial \\Phi(R)}{\\partial R} - \\frac{R}{\\rho}\\frac{\\partial P}{\\partial R}\n$$\n对于中心点质量 $M$，牛顿引力势为 $\\Phi(R) = -G M / R$。引力项变为：\n$$\n-R\\frac{\\partial \\Phi(R)}{\\partial R} = -R \\frac{\\partial}{\\partial R}\\left(-\\frac{G M}{R}\\right) = -R\\left(\\frac{G M}{R^2}\\right) = -\\frac{G M}{R}\n$$\n这里有一个符号应用错误。让我们更仔细一些。力是 $\\vec{F} = -m\\nabla\\Phi$。单位质量受到的径向力分量是 $F_R/m = -\\partial\\Phi/\\partial R = -GM/R^2$。这是一个向内（负）的力。径向加速度是 $a_R = -v_\\phi^2/R$。压力是 $-1/\\rho \\cdot \\partial P/\\partial R$。运动方程 $m a_R = F_{R, grav} + F_{R, press}$ 变为：\n$$\nm\\left(-\\frac{v_\\phi^2}{R}\\right) = m\\left(-\\frac{GM}{R^2}\\right) - \\frac{\\partial P}{\\partial R} V\n$$\n其中 V 是一个体积元。除以质量 $m=\\rho V$ 并简化：\n$$\n-\\frac{v_\\phi^2}{R} = -\\frac{GM}{R^2} - \\frac{1}{\\rho}\\frac{\\partial P}{\\partial R}\n$$\n乘以 $-R$：\n$$\nv_\\phi^2(R) = \\frac{GM}{R} + \\frac{R}{\\rho} \\frac{\\partial P}{\\partial R}\n$$\n这个方程正确地表明，负的压力梯度（$\\partial P/\\partial R  0$，即压力向外减小）提供了一个径向力，帮助支撑圆盘以抵抗引力，从而将所需的轨道速度降低到开普勒值以下。\n\n问题要求用垂直积分量来表示。我们假设 $v_{\\phi}$ 和 $\\Phi$ 与垂直坐标 $z$ 无关，并将运动方程（乘以 $\\rho$）对 $z$ 进行积分：\n$$\n\\int_{-\\infty}^{+\\infty} \\rho(R,z) \\frac{v_{\\phi}^2(R)}{R} dz = \\int_{-\\infty}^{+\\infty} \\rho(R,z) \\frac{G M}{R^2} dz + \\int_{-\\infty}^{+\\infty} \\frac{\\partial P(R,z)}{\\partial R} dz\n$$\n使用表面密度 $\\Sigma(R) = \\int \\rho dz$ 和垂直积分压力 $\\Pi(R) = \\int P dz$ 的定义，并对压力项应用莱布尼兹积分法则，我们得到：\n$$\n\\Sigma(R) \\frac{v_{\\phi}^2(R)}{R} = \\Sigma(R) \\frac{G M}{R^2} + \\frac{d\\Pi(R)}{dR}\n$$\n除以 $\\Sigma(R)$ 并乘以 $R$，得到 $v_{\\phi}^2(R)$ 的所需表达式：\n$$\nv_{\\phi}^2(R) = \\frac{G M}{R} + \\frac{R}{\\Sigma(R)}\\frac{d\\Pi(R)}{dR}\n$$\n认识到开普勒速度 $v_K(R) = \\sqrt{G M/R}$，我们得到最终的控制方程：\n$$\nv_{\\phi}^2(R) = v_K^2(R) + \\frac{R}{\\Sigma(R)}\\frac{d\\Pi}{dR}\n$$\n\n### II. 数值实现\n\n对于每个测试用例，算法按以下步骤进行：\n1.  **设置**：来自测试用例的所有物理常数和参数均以 SI 单位定义。径向网格 $R$ 被构建为一个从 $R_{\\min}$ 到 $R_{\\max}$ 的具有 $N$ 个点的线性间隔数组，所有距离都从 AU 转换为米。\n2.  **剖面计算**：使用提供的幂律和可选的指数锥削形式，为径向网格上的每个点计算温度 $T(R)$ 和表面密度 $\\Sigma(R)$ 的径向剖面：\n    $$\n    T(R) = T_{0} \\left( \\frac{R}{R_{0}} \\right)^{-q}\n    $$\n    $$\n    \\Sigma(R) = \\Sigma_{0} \\left( \\frac{R}{R_{0}} \\right)^{-p} \\times \\exp\\left( - \\frac{R}{R_{c}} \\right)\n    $$\n3.  **积分压力**：计算等温声速的平方 $c_s^2(R) = \\frac{k_{\\mathrm{B}} T(R)}{\\mu m_{p}}$。随后，使用给定关系 $\\Pi(R) = \\Sigma(R) c_s^2(R)$ 确定垂直积分压力。\n4.  **数值微分**：对积分压力的径向梯度 $d\\Pi/dR$ 进行数值计算。按照规定，对网格的内部点使用二阶中心差分格式，在两个边界点使用一阶单边（向前/向后）格式。\n    $$\n    \\left( \\frac{d\\Pi}{dR} \\right)_{i} = \\begin{cases}\n        (\\Pi_{1} - \\Pi_{0}) / \\Delta R   \\text{if } i=0 \\\\\n        (\\Pi_{i+1} - \\Pi_{i-1}) / (2\\Delta R)   \\text{if } 1 \\le i \\le N-2 \\\\\n        (\\Pi_{N-1} - \\Pi_{N-2}) / \\Delta R   \\text{if } i=N-1\n    \\end{cases}\n    $$\n    其中 $\\Delta R$ 是均匀的网格间距。\n5.  **速度计算**：计算开普勒速度的平方 $v_K^2(R) = G M / R$。然后将压力梯度项 $\\frac{R}{\\Sigma(R)} \\frac{d\\Pi}{dR}$ 加到 $v_K^2(R)$ 上以获得 $v_{\\phi}^2(R)$。执行检查以确保 $v_{\\phi}^2(R)$ 为非负值，将任何由数值不精确性导致的微小负值设为零。最后，通过取平方根求得 $v_{\\phi}(R)$ 和 $v_K(R)$。\n6.  **偏差分析**：在整个网格上计算绝对分数偏差 $\\delta(R) = |v_{\\phi}(R)/v_K(R) - 1|$。确定此偏差的最大值 $\\max(\\delta(R))$。\n7.  **输出**：收集每个测试用例的最大偏差，并将最终结果格式化并打印为单个逗号分隔的列表。\n\n此过程被系统地应用于问题陈述中提供的所有四个测试用例。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum fractional deviation from Keplerian velocity in a\n    pressure-supported accretion disk for a series of test cases.\n    \"\"\"\n    \n    # Physical constants in SI units\n    G = 6.67430e-11  # m^3 kg^-1 s^-2\n    M_SOLAR = 1.98847e30  # kg\n    KB = 1.380649e-23  # J K^-1\n    MP = 1.67262192369e-27  # kg\n    AU = 1.495978707e11  # m\n    \n    # Fixed parameters for all test cases\n    M_STAR = 1.0 * M_SOLAR\n    MU = 2.34\n\n    # Test cases defined in the problem statement\n    test_cases = [\n        {\n            \"R_range_au\": (0.1, 100), \"N\": 256,\n            \"T0\": 280, \"R0_T_au\": 1.0, \"q\": 0.5,\n            \"Sigma0\": 17000, \"R0_Sigma_au\": 1.0, \"p\": 1.0,\n            \"Rc_au\": None\n        },\n        {\n            \"R_range_au\": (1, 10), \"N\": 256,\n            \"T0\": 100, \"R0_T_au\": 1.0, \"q\": 0.0,\n            \"Sigma0\": 100, \"R0_Sigma_au\": 1.0, \"p\": 0.0,\n            \"Rc_au\": None\n        },\n        {\n            \"R_range_au\": (1, 200), \"N\": 512,\n            \"T0\": 150, \"R0_T_au\": 1.0, \"q\": 0.4,\n            \"Sigma0\": 1000, \"R0_Sigma_au\": 1.0, \"p\": 1.0,\n            \"Rc_au\": 30.0\n        },\n        {\n            \"R_range_au\": (0.1, 10), \"N\": 384,\n            \"T0\": 1000, \"R0_T_au\": 0.1, \"q\": 0.75,\n            \"Sigma0\": 10000, \"R0_Sigma_au\": 0.1, \"p\": 1.5,\n            \"Rc_au\": None\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # 1. Setup: Construct radial grid and convert units to SI\n        r_min_au, r_max_au = case[\"R_range_au\"]\n        N = case[\"N\"]\n        R = np.linspace(r_min_au * AU, r_max_au * AU, N)\n        \n        R0_T = case[\"R0_T_au\"] * AU\n        R0_Sigma = case[\"R0_Sigma_au\"] * AU\n        \n        # 2. Profile Calculation\n        # Temperature profile T(R)\n        T = case[\"T0\"] * (R / R0_T)**(-case[\"q\"])\n\n        # Surface density profile Sigma(R)\n        Sigma = case[\"Sigma0\"] * (R / R0_Sigma)**(-case[\"p\"])\n        if case[\"Rc_au\"] is not None:\n            Rc = case[\"Rc_au\"] * AU\n            Sigma *= np.exp(-R / Rc)\n            \n        # 3. Integrated Pressure Calculation\n        # Isothermal sound speed squared c_s^2(R)\n        cs2 = (KB * T) / (MU * MP)\n        \n        # Vertically integrated pressure Pi(R)\n        Pi = Sigma * cs2\n        \n        # 4. Numerical Differentiation of Pi\n        dPi_dR = np.zeros_like(R)\n        dR = R[1] - R[0]\n        \n        # Central difference for interior points\n        dPi_dR[1:-1] = (Pi[2:] - Pi[0:-2]) / (2 * dR)\n        \n        # One-sided difference for boundaries\n        dPi_dR[0] = (Pi[1] - Pi[0]) / dR  # Forward difference\n        dPi_dR[-1] = (Pi[-1] - Pi[-2]) / dR # Backward difference\n        \n        # 5. Velocity Calculation\n        # Keplerian velocity squared\n        vk2 = G * M_STAR / R\n        \n        # Pressure support term\n        pressure_term = (R / Sigma) * dPi_dR\n        \n        # Azimuthal velocity squared\n        v_phi_sq = vk2 + pressure_term\n        \n        # Ensure v_phi_sq is non-negative\n        v_phi_sq = np.maximum(v_phi_sq, 0)\n        \n        # Calculate velocities\n        v_phi = np.sqrt(v_phi_sq)\n        vk = np.sqrt(vk2)\n        \n        # 6. Deviation Analysis\n        # Handle potential division by zero at R=0, though not possible with given ranges\n        with np.errstate(divide='ignore', invalid='ignore'):\n            delta = np.abs(v_phi / vk - 1)\n        \n        # The result for the case is the maximum deviation\n        max_delta = np.nanmax(delta)\n        results.append(max_delta)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```", "id": "3517571"}, {"introduction": "物质要向内吸积，就必须有效地损失角动量，但这个过程的物理机制是吸积盘理论的核心难题之一。Shakura-Sunyaev $\\alpha$-模型通过引入一个有效黏性来解决这个问题，该黏性产生剪切力矩，将角动量向外输运，从而使物质向内流动。在这个实践中 [@problem_id:3517540]，你将从基本守恒定律出发，推导并实现经典的稳态$\\alpha$-盘解，这是理解吸积盘结构和演化的基石。", "problem": "考虑一个围绕中心点质量运行的稳定、轴对称、几何薄的吸积盘。该盘使用 Shakura–Sunyaev 的粘性方案进行建模，并假设其在垂直方向上是等温的。您的任务是，从适用于计算天体物理学的第一性原理出发，在这些假设下推导、实现并验证表面密度和径向速度的稳态径向分布。\n\n假设与基本原理：\n- 盘是稳定且轴对称的，因此所有物理量都与方位角和时间无关。\n- 引力势是牛顿引力势，并适用开普勒旋转。开普勒角频率为 $\\Omega_{\\mathrm{K}}(R)=\\sqrt{G M / R^{3}}$，其中 $G$ 是引力常数，$M$ 是中心天体质量。\n- 垂直方向上的流体静力学平衡以及等温的垂直结构给出了压力标高 $H(R)=c_{s}(R)/\\Omega_{\\mathrm{K}}(R)$，其中 $c_{s}(R)$ 是等温声速。\n- 使用 Shakura–Sunyaev 的 $\\alpha$ 粘性方案：$\\nu(R)=\\alpha\\,c_{s}(R)\\,H(R)$，其中 $\\alpha$ 是一个无量纲常数。\n- 状态方程是局部等温的，其径向分布由 $c_{s}(R)=c_{s0}\\,[R/R_{0}]^{-q}$ 给出，其中 $c_{s0}$ 是参考半径 $R_{0}$ 处的常数速度，$q$ 是一个无量纲指数。\n- 盘的内边界位于 $R_{\\mathrm{in}}=6 G M / c^{2}$，其中 $c$ 是光速。在 $R_{\\mathrm{in}}$ 处采用零力矩边界条件。\n- 在稳态下，平流质量通量和总径向角动量通量是恒定的。\n\n从上述守恒定律和定义出发，推导稳态径向分布的表达式：\n- 表面密度 $\\Sigma(R)$，\n- 径向速度 $v_{R}(R)$，\n用参数 $M$、$\\dot{M}$、$\\alpha$、$c_{s}(R)$ 和 $R_{\\mathrm{in}}$ 来表示。\n\n然后，实现一个程序，该程序：\n- 构建一个从 $R_{\\mathrm{min}}=(1+\\epsilon)\\,R_{\\mathrm{in}}$ 到 $R_{\\mathrm{out}}$ 的对数间隔半径数组 $R$，其中 $\\epsilon=0.01$，点数为 $N=256$。\n- 使用推导出的表达式计算 $\\Sigma(R)$ 和 $v_{R}(R)$。\n- 通过计算 $F_{M}(R)=-2\\pi R \\Sigma(R) v_{R}(R)$ 并将其与指定的 $\\dot{M}$ 进行比较，来验证质量通量守恒。\n- 通过计算\n$$\nF_{J}(R)=\\dot{M}\\,l(R)-2\\pi R^{3}\\,\\nu(R)\\,\\Sigma(R)\\,\\frac{d\\Omega_{\\mathrm{K}}}{dR},\n$$\n并将其与常数 $F_{J,\\mathrm{in}}=\\dot{M}\\,l(R_{\\mathrm{in}})$ 进行比较，来验证零力矩内边界条件下的角动量通量守恒，其中 $l(R)=R^{2}\\Omega_{\\mathrm{K}}(R)$。\n\n对于每个测试用例，报告以下两个数值：\n- 径向网格上质量通量与指定值 $\\dot{M}$ 的最大相对偏差，定义为 $\\max_{R}\\left|\\frac{F_{M}(R)}{\\dot{M}}-1\\right|$，\n- 径向网格上角动量通量与 $F_{J,\\mathrm{in}}$ 的最大相对偏差，定义为 $\\max_{R}\\left|\\frac{F_{J}(R)}{F_{J,\\mathrm{in}}}-1\\right|$。\n\n使用以下常数：$G=6.67430\\times 10^{-11}\\,\\mathrm{m^{3}\\,kg^{-1}\\,s^{-2}}$，$c=2.99792458\\times 10^{8}\\,\\mathrm{m\\,s^{-1}}$，以及 $M_{\\odot}=1.98847\\times 10^{30}\\,\\mathrm{kg}$。\n\n物理单位：\n- 质量 $M$ 单位为 $\\mathrm{kg}$，\n- 质量吸积率 $\\dot{M}$ 单位为 $\\mathrm{kg\\,s^{-1}}$，\n- 半径 $R$ 单位为 $\\mathrm{m}$，\n- 声速 $c_{s0}$ 单位为 $\\mathrm{m\\,s^{-1}}$，\n- 径向速度 $v_{R}$ 单位为 $\\mathrm{m\\,s^{-1}}$，\n- 表面密度 $\\Sigma$ 单位为 $\\mathrm{kg\\,m^{-2}}$。\n\n不使用角度单位。程序的所有输出必须是如下定义的无量纲浮点数。\n\n测试套件：\n实现您的程序，为以下参数集计算所需的量。在每种情况下，设置 $R_{0}=f_{0}\\,R_{\\mathrm{in}}$ 和 $R_{\\mathrm{out}}=f_{\\mathrm{out}}\\,R_{\\mathrm{in}}$，并使用 $N=256$ 和 $\\epsilon=0.01$。\n\n- 情况 1 (理想情况)：\n  - $M=10\\,M_{\\odot}$，\n  - $\\dot{M}=10^{17}\\,\\mathrm{kg\\,s^{-1}}$，\n  - $\\alpha=0.1$，\n  - $c_{s0}=10^{5}\\,\\mathrm{m\\,s^{-1}}$，\n  - $q=0.5$，\n  - $f_{0}=10$，\n  - $f_{\\mathrm{out}}=500$。\n\n- 情况 2 (较低粘性，恒定声速)：\n  - $M=1\\,M_{\\odot}$，\n  - $\\dot{M}=3\\times 10^{16}\\,\\mathrm{kg\\,s^{-1}}$，\n  - $\\alpha=0.01$，\n  - $c_{s0}=5\\times 10^{4}\\,\\mathrm{m\\,s^{-1}}$，\n  - $q=0$，\n  - $f_{0}=1$，\n  - $f_{\\mathrm{out}}=300$。\n\n- 情况 3 (较高吸积率和中等声速梯度)：\n  - $M=5\\,M_{\\odot}$，\n  - $\\dot{M}=5\\times 10^{18}\\,\\mathrm{kg\\,s^{-1}}$，\n  - $\\alpha=0.2$，\n  - $c_{s0}=2\\times 10^{5}\\,\\mathrm{m\\,s^{-1}}$，\n  - $q=0.25$，\n  - $f_{0}=3$，\n  - $f_{\\mathrm{out}}=1000$。\n\n- 情况 4 (边界情况：小 $\\alpha$ 和较冷的盘)：\n  - $M=30\\,M_{\\odot}$，\n  - $\\dot{M}=10^{18}\\,\\mathrm{kg\\,s^{-1}}$，\n  - $\\alpha=0.005$，\n  - $c_{s0}=10^{4}\\,\\mathrm{m\\,s^{-1}}$，\n  - $q=0.75$，\n  - $f_{0}=1$，\n  - $f_{\\mathrm{out}}=200$。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表。此列表的每个元素对应一个测试用例，并且其本身必须是一个包含上述两个浮点数的双元素列表，顺序为：$\\left[\\left[\\mathrm{mass\\_rel\\_err\\_max}_{1},\\mathrm{angmom\\_rel\\_err\\_max}_{1}\\right],\\ldots,\\left[\\mathrm{mass\\_rel\\_err\\_max}_{4},\\mathrm{angmom\\_rel\\_err\\_max}_{4}\\right]\\right]$。例如：$[[a_{1},b_{1}],[a_{2},b_{2}],[a_{3},b_{3}],[a_{4},b_{4}]]$.", "solution": "该问题陈述是计算天体物理学中一个适定且有科学依据的练习，其根植于标准的 Shakura-Sunyaev 吸积盘模型。所有假设、常数和边界条件都已明确给出且自洽。该问题是有效的。\n\n表面密度 $\\Sigma(R)$ 和径向速度 $v_R(R)$ 的稳态分布的推导源于质量和角动量的基本守恒定律。\n\n**1. 质量守恒**\n对于稳态（$ \\partial/\\partial t = 0 $）、轴对称（$ \\partial/\\partial \\phi = 0 $）的盘，垂直积分后的连续性方程为：\n$$ \\frac{1}{R} \\frac{d}{dR} \\left( R \\Sigma(R) v_R(R) \\right) = 0 $$\n对此方程积分表明 $R \\Sigma v_R$ 是一个常数。质量吸积率 $\\dot{M}$ 定义为单位时间内径向流入半径为 $R$ 的圆柱体的总质量。按照惯例，对于内流，$\\dot{M} > 0$，这意味着 $v_R(R)  0$。\n$$ \\dot{M} = -2\\pi R \\Sigma(R) v_R(R) $$\n该方程陈述了通过盘的质量通量是恒定的。它提供了 $\\Sigma(R)$ 和 $v_R(R)$ 之间的关系：\n$$ v_R(R) = -\\frac{\\dot{M}}{2\\pi R \\Sigma(R)} \\quad (*)$$\n\n**2. 角动量守恒**\n角动量守恒要求在稳态下，通过任何半径的净角动量通量是恒定的。该通量由两个部分组成：吸积气体的平流输运和由剪切引起的粘性输运。问题将总径向角动量通量定义为：\n$$ F_J(R) = \\dot{M} l(R) - 2\\pi R^3 \\nu(R) \\Sigma(R) \\frac{d\\Omega_{\\mathrm{K}}}{dR} $$\n其中 $l(R) = R^2 \\Omega_K(R)$ 是半径 $R$ 处的比角动量，第二项代表粘性力矩。在稳态下，此通量是恒定的。该常数由内边界条件确定。问题指定了在内边界 $R_{\\mathrm{in}}$ 处的零力矩条件。这意味着粘性力矩项在 $R=R_{\\mathrm{in}}$ 处消失。因此，恒定通量等于内边缘处的纯平流通量：\n$$ F_J(R) = F_{J, \\mathrm{in}} = \\dot{M} l(R_{\\mathrm{in}}) $$\n令 $F_J(R)$ 的两个表达式相等，得到盘结构的控制方程：\n$$ \\dot{M} l(R) - 2\\pi R^3 \\nu(R) \\Sigma(R) \\frac{d\\Omega_{\\mathrm{K}}}{dR} = \\dot{M} l(R_{\\mathrm{in}}) $$\n我们现在可以解出表面密度 $\\Sigma(R)$：\n$$ -2\\pi R^3 \\nu(R) \\Sigma(R) \\frac{d\\Omega_{\\mathrm{K}}}{dR} = \\dot{M} \\left( l(R_{\\mathrm{in}}) - l(R) \\right) $$\n$$ \\Sigma(R) = \\frac{\\dot{M} \\left( l(R) - l(R_{\\mathrm{in}}) \\right)}{-2\\pi R^3 \\nu(R) \\frac{d\\Omega_{\\mathrm{K}}}{dR}} $$\n为了简化此表达式，我们使用开普勒角速度分布 $\\Omega_{\\mathrm{K}}(R) = \\sqrt{GM/R^3}$。其导数为：\n$$ \\frac{d\\Omega_{\\mathrm{K}}}{dR} = -\\frac{3}{2} \\sqrt{GM} R^{-5/2} = -\\frac{3}{2} \\frac{\\Omega_{\\mathrm{K}}(R)}{R} $$\n将此代入 $\\Sigma(R)$ 表达式的分母中：\n$$ -2\\pi R^3 \\nu(R) \\left( -\\frac{3}{2} \\frac{\\Omega_{\\mathrm{K}}(R)}{R} \\right) = 3\\pi \\nu(R) R^2 \\Omega_{\\mathrm{K}}(R) $$\n因此，表面密度为：\n$$ \\Sigma(R) = \\frac{\\dot{M} \\left( l(R) - l(R_{\\mathrm{in}}) \\right)}{3\\pi \\nu(R) R^2 \\Omega_{\\mathrm{K}}(R)} $$\n接下来，我们代入比角动量 $l(R) = \\sqrt{GMR}$：\n$$ \\Sigma(R) = \\frac{\\dot{M} \\left( \\sqrt{GMR} - \\sqrt{GMR_{\\mathrm{in}}} \\right)}{3\\pi \\nu(R) R^2 \\sqrt{GM/R^3}} = \\frac{\\dot{M}\\sqrt{GM}\\left( \\sqrt{R} - \\sqrt{R_{\\mathrm{in}}} \\right)}{3\\pi \\nu(R) \\sqrt{GM}\\sqrt{R}} $$\n这简化为在零力矩内边界条件下 Shakura-Sunyaev 盘中表面密度的标准表达式：\n$$ \\Sigma(R) = \\frac{\\dot{M}}{3\\pi\\nu(R)} \\left[ 1 - \\sqrt{\\frac{R_{\\mathrm{in}}}{R}} \\right] \\quad (1) $$\n运动粘滞系数 $\\nu(R)$ 由 $\\alpha$ 方案给出，$\\nu(R) = \\alpha c_s(R) H(R)$。利用垂直标高 $H(R) = c_s(R)/\\Omega_K(R)$，这变为：\n$$ \\nu(R) = \\alpha \\frac{c_s(R)^2}{\\Omega_K(R)} $$\n其中声速分布为 $c_s(R) = c_{s0} (R/R_0)^{-q}$。\n\n**3. 推导的分布表达式**\n在建立了 $\\Sigma(R)$ 的表达式后，我们可以通过将方程 $(1)$ 代入方程 $(*)$ 来求得径向速度 $v_R(R)$：\n$$ v_R(R) = -\\frac{\\dot{M}}{2\\pi R \\left( \\frac{\\dot{M}}{3\\pi\\nu(R)} \\left[ 1 - \\sqrt{\\frac{R_{\\mathrm{in}}}{R}} \\right] \\right)} $$\n简化此表达式得到：\n$$ v_R(R) = - \\frac{3}{2} \\frac{\\nu(R)}{R} \\left( \\frac{1}{1 - \\sqrt{\\frac{R_{\\mathrm{in}}}{R}}} \\right) \\quad (2) $$\n方程 $(1)$ 和 $(2)$ 是稳态表面密度和径向速度分布的最终推导表达式。\n\n**4. 实现与验证**\n程序将实现这些推导出的解析解。问题要求的验证步骤是代数自洽性的检查。\n- **质量通量守恒**：将推导出的 $\\Sigma(R)$ 和 $v_R(R)$ 表达式代入质量通量定义 $F_M(R)=-2\\pi R \\Sigma(R) v_R(R)$ 中，得到：\n$$ F_M(R) = -2\\pi R \\left(\\frac{\\dot{M}}{3\\pi\\nu(R)} \\left[ 1 - \\sqrt{\\frac{R_{\\mathrm{in}}}{R}} \\right]\\right) \\left(- \\frac{3}{2} \\frac{\\nu(R)}{R} \\frac{1}{1 - \\sqrt{\\frac{R_{\\mathrm{in}}}{R}}}\\right) = \\dot{M} $$\n这是一个恒等式。数值计算将测试浮点数实现的保真度。最大相对偏差 $\\max_{R}\\left|\\frac{F_{M}(R)}{\\dot{M}}-1\\right|$ 应在机器精度的数量级。\n- **角动量通量守恒**：$\\Sigma(R)$ 的表达式是直接从 $F_J(R) = F_{J,\\mathrm{in}}$ 的条件推导出来的。因此，使用推导出的 $\\Sigma(R)$ 计算 $F_J(R)$ 必须在解析上返回 $F_{J,\\mathrm{in}}$。\n$$ F_J(R) = \\dot{M}l(R) - 2\\pi R^3 \\nu \\frac{d\\Omega_K}{dR} \\left( \\frac{\\dot{M}(l(R)-l(R_{in}))}{-2\\pi R^3 \\nu \\frac{d\\Omega_K}{dR}} \\right) = \\dot{M}l(R) + \\dot{M}(l(R_{in})-l(R))=\\dot{M}l(R_{in}) $$\n这也是一个恒等式。数值检验 $\\max_{R}\\left|\\frac{F_{J}(R)}{F_{J,\\mathrm{in}}}-1\\right|$ 将同样测试实现的数值准确性。代码将为每个测试用例计算这些最大相对偏差。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Shakura-Sunyaev disk problem for multiple test cases and\n    prints the verification results in the specified format.\n    \"\"\"\n    \n    # Physical and mathematical constants\n    G = 6.67430e-11  # Gravitational constant in m^3 kg^-1 s^-2\n    c = 2.99792458e8  # Speed of light in m s^-1\n    M_sun = 1.98847e30 # Solar mass in kg\n\n    test_cases = [\n        # Case 1: M(Msun), Mdot(kg/s), alpha, cs0(m/s), q, f0, fout\n        (10, 1e17, 0.1, 1e5, 0.5, 10, 500),\n        # Case 2\n        (1, 3e16, 0.01, 5e4, 0, 1, 300),\n        # Case 3\n        (5, 5e18, 0.2, 2e5, 0.25, 3, 1000),\n        # Case 4\n        (30, 1e18, 0.005, 1e4, 0.75, 1, 200)\n    ]\n    \n    results = []\n    for params in test_cases:\n        results.append(solve_case(params, G, c, M_sun))\n\n    # Format the final output string exactly as required, without extra spaces.\n    results_str = \",\".join([f\"[{r[0]},{r[1]}]\" for r in results])\n    print(f\"[{results_str}]\")\n\n\ndef solve_case(params, G, c, M_sun):\n    \"\"\"\n    Computes the verification metrics for a single test case.\n    \"\"\"\n    # Unpack parameters for the current test case\n    M_in_Msun, dot_M, alpha, c_s0, q, f0, fout = params\n    N = 256\n    epsilon = 0.01\n\n    # 1. Preliminary calculations\n    M = M_in_Msun * M_sun\n    # Inner boundary radius (Schwarzschild radius for non-rotating black hole is Rs=2GM/c^2, so Rin=3Rs)\n    R_in = 6 * G * M / c**2\n    # Reference radius and outer radius\n    R0 = f0 * R_in\n    R_out = fout * R_in\n    # Innermost grid point, slightly outside R_in to avoid singularity\n    R_min = (1 + epsilon) * R_in\n    \n    # Construct the logarithmically spaced radial grid\n    R = np.logspace(np.log10(R_min), np.log10(R_out), N, dtype=np.float64)\n\n    # 2. Define physical quantities as functions of radius R\n    \n    # Keplerian angular velocity\n    omega_k_R = np.sqrt(G * M / R**3)\n    \n    # Isothermal sound speed\n    cs_R = c_s0 * (R / R0)**(-q)\n    \n    # Shakura-Sunyaev kinematic viscosity\n    nu_R = alpha * cs_R**2 / omega_k_R\n\n    # 3. Compute derived profiles for Sigma(R) and v_R(R)\n    \n    # Common factor in the standard solution for a zero-torque inner boundary\n    f_boundary = 1 - np.sqrt(R_in / R)\n    \n    # Surface density profile\n    Sigma_R = (dot_M / (3 * np.pi * nu_R)) * f_boundary\n    \n    # Radial velocity profile\n    v_R = - (3 / 2) * (nu_R / R) / f_boundary\n\n    # 4. Verification checks\n    \n    # 4.1. Mass Flux Conservation\n    # Analytically, F_M(R) = -2*pi*R*Sigma(R)*v_R(R) should be exactly M_dot.\n    F_M_R = -2 * np.pi * R * Sigma_R * v_R\n    mass_rel_err_max = np.max(np.abs(F_M_R / dot_M - 1))\n\n    # 4.2. Angular Momentum Flux Conservation\n    \n    # Specific angular momentum\n    l_R = np.sqrt(G * M * R)\n    \n    # Analytical derivative of Keplerian angular velocity\n    d_omega_k_dr_R = -1.5 * omega_k_R / R\n    \n    # Constant angular momentum flux at the inner boundary\n    F_J_in = dot_M * np.sqrt(G * M * R_in)\n    \n    # Angular momentum flux at each radius R, as defined in the problem\n    # F_J(R) = M_dot*l(R) - 2*pi*R^3*nu(R)*Sigma(R)*dOmega_k/dR\n    F_J_R = dot_M * l_R - 2 * np.pi * R**3 * nu_R * Sigma_R * d_omega_k_dr_R\n\n    # The maximum relative deviation from the constant value F_J_in.\n    # Note: F_J_in can be zero if M=0 or Rin=0, handle division by zero.\n    if F_J_in == 0:\n        # If F_J_in is zero, the absolute error is more appropriate.\n        # But for this problem, M  0 and R_in  0, so F_J_in is never zero.\n        ang_mom_rel_err_max = np.max(np.abs(F_J_R))\n    else:\n        ang_mom_rel_err_max = np.max(np.abs(F_J_R / F_J_in - 1))\n        \n    return [mass_rel_err_max, ang_mom_rel_err_max]\n\n\nif __name__ == \"__main__\":\n    solve()\n\n```", "id": "3517540"}, {"introduction": "稳态模型为了解吸积盘提供了重要的理论框架，但它们并未描述盘的动态演化过程。角动量的黏性输运本质上是一个扩散过程，它驱动着盘的结构随时间演变。通过这项练习 [@problem_id:3517585]，你将通过数值方法求解描述黏性演化的时间相关扩散方程，模拟一个气体环在黏性作用下的扩散过程，从而亲身体验现代天体物理学代码中核心的数值技术，并验证其计算结果的收敛性和准确性。", "problem": "您需要设计并实现一个基于守恒定律的计算实验，用于量化和验证薄的轴对称吸积盘中的角动量输运。该实验使用标准的旋转环结构和粘滞薄盘演化方程的守恒数值离散化。您的目标是计算一个可测量的输运率，量化数值误差，并验证随分辨率的收敛性。\n\n从以下基本定律和经过广泛测试的公式和定义开始：\n- 质量守恒（连续性方程）：对于一个表面密度为 $\\,\\Sigma(r,t)\\,$ 的轴对称薄盘，半径为 $\\,r\\,$ 的圆柱体内的质量由于 $\\,\\Sigma\\,$ 的径向通量而变化。\n- 原点处存在一个点质量 $\\,M\\,$ 的牛顿引力。圆形轨道的角速度为 $\\,\\Omega(r) = \\sqrt{GM/r^3}\\,$。比角动量为 $\\,\\ell(r) = r^2 \\Omega(r)\\,$。\n- 在 Navier–Stokes 框架下，运动粘度为 $\\,\\nu\\,$ 且轴对称的薄盘中的粘滞剪切应力为 $\\,T_{r\\varphi} = \\nu \\,\\Sigma\\, r \\,\\dfrac{d\\Omega}{dr}\\,$。\n- 由粘滞应力跨越半径为 $\\,r\\,$ 的圆周所携带的角动量通量为 $\\,F_J(r,t) = -\\,2\\pi\\, r^3 \\,\\nu\\, \\Sigma(r,t)\\, \\dfrac{d\\Omega}{dr}\\,$。对于开普勒盘，$\\,\\dfrac{d\\Omega}{dr} = -\\dfrac{3}{2}\\dfrac{\\Omega}{r}\\,$，因此 $\\,F_J(r,t) = 3\\pi\\,\\nu\\,\\Sigma(r,t)\\,r^2\\,\\Omega(r)\\,$。\n- 在标准薄盘近似下，$\\,\\Sigma(r,t)\\,$ 随粘滞角动量输运的演化由一个扩散型方程描述：\n$$\n\\frac{\\partial \\Sigma}{\\partial t}\n= \\frac{3}{r}\\,\\frac{\\partial}{\\partial r}\\!\\left(r^{1/2}\\,\\frac{\\partial}{\\partial r}\\big(\\nu\\,\\Sigma\\,r^{1/2}\\big)\\right).\n$$\n\n您的数值方法必须：\n- 在一个包含 $\\,N\\,$ 个网格中心的均匀网格上对 $\\,r\\,$ 进行离散化，该网格跨越 $\\,r\\in[r_{\\min},r_{\\max}]\\,$。\n- 使用扩散方程的二阶守恒通量形式演化 $\\,\\Sigma(r,t)\\,$，其中离散通量为\n$$\nF(r,t) = r^{1/2}\\,\\frac{\\partial}{\\partial r}\\big(\\nu\\,\\Sigma(r,t)\\,r^{1/2}\\big),\n$$\n使得\n$$\n\\frac{\\partial \\Sigma}{\\partial t} = \\frac{3}{r}\\,\\frac{\\partial F}{\\partial r}.\n$$\n- 使用零力矩（无通量）边界条件，即在两个计算域边界上设置 $\\,F=0\\,$。\n- 采用一个稳定的显式时间积分器。为保证稳定性，使用时间步长约束\n$$\n\\Delta t \\le C\\,\\frac{\\Delta r^2}{3\\,\\nu},\n$$\n其中 $\\,C=0.2\\,$，$\\,\\Delta r\\,$ 是均匀的径向间距。\n\n初始条件：\n- 构建一个初始均匀的旋转环，中心位于 $\\,r_0=1\\,$，半宽为 $\\,w\\,$。对于 $\\,r\\in[r_0-w,\\,r_0+w]\\,$，令 $\\,\\Sigma(r,0)=\\Sigma_0\\,$，否则 $\\,\\Sigma(r,0)=0\\,$。选择 $\\,\\Sigma_0\\,$ 使得环的总质量等于 $\\,M_{\\rm ring}=1\\,$，即\n$$\nM_{\\rm ring} = 2\\pi \\int_{r_0-w}^{r_0+w} \\Sigma_0\\, r\\, dr = 1,\n$$\n这在给定 $\\,w\\,$ 的情况下唯一确定了 $\\,\\Sigma_0\\,$。\n\n可计算量：\n- $\\,r\\le r_0\\,$ 内部的总角动量为\n$$\nJ_{\\rm in}(t) = \\int_{r_{\\min}}^{r_0} 2\\pi\\,r\\,\\Sigma(r,t)\\,\\ell(r)\\,dr\n= \\int_{r_{\\min}}^{r_0} 2\\pi\\,\\Sigma(r,t)\\,r^{3/2}\\,dr,\n$$\n这里使用了 $\\,G=M=1\\,$，因此 $\\,\\Omega(r)=r^{-3/2}\\,$ 且 $\\,\\ell(r)=\\sqrt{r}\\,$。\n- 跨越 $\\,r_0\\,$ 的测量输运率为\n$$\n\\dot{J}_{\\rm meas} \\approx \\frac{J_{\\rm in}(t_{\\rm end}) - J_{\\rm in}(0)}{t_{\\rm end}}.\n$$\n- 在 $\\,r_0\\,$ 处（使用演化后的 $\\,\\Sigma(r_0,t_{\\rm end})\\,$）的连续介质预测粘滞通量为\n$$\n\\dot{J}_{\\rm pred} = F_J(r_0,t_{\\rm end}) = -\\,2\\pi\\,r_0^3\\,\\nu\\,\\Sigma(r_0,t_{\\rm end})\\,\\frac{d\\Omega}{dr}\\bigg|_{r_0}\n= 3\\pi\\,\\nu\\,\\Sigma(r_0,t_{\\rm end})\\,r_0^2\\,\\Omega(r_0).\n$$\n- 一个案例的绝对误差为\n$$\ne = \\big|\\dot{J}_{\\rm meas} - \\dot{J}_{\\rm pred}\\big|.\n$$\n\n单位：\n- 使用无量纲单位，其中 $\\,G=1\\,$ 和 $\\,M=1\\,$，长度单位为 $\\,r_0\\,$，时间单位与 $\\,\\Omega(r)=r^{-3/2}\\,$ 一致，质量归一化为 $\\,M_{\\rm ring}=1\\,$。所有输出应为无量纲浮点数。\n\n测试套件：\n- 计算域：$\\,r_{\\min}=0.5\\,$, $\\,r_{\\max}=1.5\\,$, $\\,r_0=1\\,$，粘度 $\\,\\nu=10^{-3}\\,$，最终时间 $\\,t_{\\rm end}=10^{-2}\\,$。\n- 需要运行的案例：\n  1. 标准分辨率 $\\,N=128\\,$，环半宽 $\\,w=0.1\\,$。\n  2. 更高分辨率 $\\,N=256\\,$，同样 $\\,w=0.1\\,$。\n  3. 最高分辨率 $\\,N=512\\,$，同样 $\\,w=0.1\\,$。\n  4. 边界/粗糙分辨率 $\\,N=64\\,$，同样 $\\,w=0.1\\,$。\n  5. 边缘/窄环 $\\,N=512\\,$，$\\,w=0.05\\,$。\n- 对于 $\\,w=0.1\\,$ 的套件进行收敛性评估：计算观测到的阶数\n$$\np \\approx \\frac{\\ln(e_{128}/e_{512})}{\\ln(\\Delta r_{128}/\\Delta r_{512})},\n$$\n可选择对相邻对 $\\,\\{128,256\\}$ 和 $\\,\\{256,512\\}$ 的结果进行平均。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含以下无量纲浮点数，形式为方括号内的逗号分隔列表：\n  1. $\\,N=64,\\,w=0.1\\,$ 时的 $\\,e_{64}\\,$，\n  2. $\\,N=128,\\,w=0.1\\,$ 时的 $\\,e_{128}\\,$，\n  3. $\\,N=256,\\,w=0.1\\,$ 时的 $\\,e_{256}\\,$，\n  4. $\\,N=512,\\,w=0.1\\,$ 时的 $\\,e_{512}\\,$，\n  5. 对于 $\\,w=0.1\\,$ 案例观测到的收敛阶数 $\\,p\\,$，\n  6. 对于窄环案例 $\\,N=512,\\,w=0.05\\,$ 的比率 $\\,\\dot{J}_{\\rm meas}/\\dot{J}_{\\rm pred}\\,$。\n- 输出必须严格符合以下格式\n$$\n[\\text{e64},\\text{e128},\\text{e256},\\text{e512},\\text{p},\\text{ratio\\_narrow}],\n$$\n用数值替换占位符，数值由您编程语言的默认字符串转换进行四舍五入。\n\n您提交的必须是一个完整、可运行的程序，该程序执行这些计算并以上述指定的精确格式打印单行输出。", "solution": "该问题陈述已经过严格验证，被认为是一个有效的、具有科学依据且适定的计算天体物理学问题。它概述了一个标准的数值实验，用于验证求解薄吸积盘中粘滞扩散方程的求解器。所有提供的方程、常数和边界条件均与已建立的理论一致，并构成了一套完整的可解问题规范。\n\n解决方案涉及设计并实现一个用于求解指定偏微分方程的数值求解器，并用它来计算所需的物理量和误差度量。方法详述如下。\n\n**1. 控制方程**\n盘表面密度 $\\Sigma(r,t)$ 的演化由粘滞输运下的薄盘方程控制：\n$$\n\\frac{\\partial \\Sigma}{\\partial t} = \\frac{3}{r}\\,\\frac{\\partial}{\\partial r}\\!\\left(r^{1/2}\\,\\frac{\\partial}{\\partial r}\\big(\\nu\\,\\Sigma\\,r^{1/2}\\big)\\right)\n$$\n该方程可以写成指定的守恒通量形式 $\\frac{\\partial \\Sigma}{\\partial t} = \\frac{3}{r}\\frac{\\partial F}{\\partial r}$，其中通量为 $F(r,t) = r^{1/2}\\,\\frac{\\partial}{\\partial r}\\big(\\nu\\,\\Sigma\\,r^{1/2}\\big)$。\n\n**2. 数值离散化**\n采用均匀交错网格上的有限差分法来求解该方程。\n\n**2.1. 空间网格**\n径向域 $r \\in [r_{\\min}, r_{\\max}]$ 被离散化为 $N$ 个宽度均匀的网格，$\\Delta r = (r_{\\max}-r_{\\min})/N$。\n- 网格界面位于 $r_j = r_{\\min} + j \\Delta r$，其中 $j=0, 1, \\ldots, N$。\n- 网格中心位于 $r_{j+1/2} = (r_j+r_{j+1})/2$，其中 $j=0, 1, \\ldots, N-1$。\n表面密度 $\\Sigma$ 是一个网格中心量，定义在 $r_{j+1/2}$ 处，记为 $\\Sigma_{j+1/2}$。\n\n**2.2. 有限差分格式**\n每个网格中心的 $\\Sigma$ 的时间导数被离散化为：\n$$\n\\frac{d\\Sigma_{j+1/2}}{dt} = \\frac{3}{r_{j+1/2}} \\frac{F_{j+1} - F_j}{\\Delta r}\n$$\n其中 $F_j$ 是在界面 $r_j$ 处计算的数值通量。通量 $F(r,t)$ 涉及一个空间导数，该导数也使用二阶中心差分进行离散。令 $V(r,t) = \\nu\\Sigma r^{1/2}$。$V$ 在网格中心处计算为 $V_{j+1/2} = \\nu \\Sigma_{j+1/2} r_{j+1/2}^{1/2}$。那么，内部界面 $r_j$ (对于 $j=1, \\ldots, N-1$) 处的通量为：\n$$\nF_j = r_j^{1/2} \\left[ \\frac{\\partial V}{\\partial r} \\right]_{r_j} \\approx r_j^{1/2} \\frac{V_{j+1/2} - V_{j-1/2}}{\\Delta r} = r_j^{1/2} \\frac{\\nu (\\Sigma_{j+1/2} r_{j+1/2}^{1/2} - \\Sigma_{j-1/2} r_{j-1/2}^{1/2})}{\\Delta r}\n$$\n此格式在空间上是守恒且二阶精确的。\n\n**2.3. 边界条件**\n问题指定了在 $r_{\\min}$ 和 $r_{\\max}$ 处的零力矩（无通量）边界条件。这通过将计算域边界处的通量设置为零来实现：\n$$\nF_0 = 0 \\quad \\text{和} \\quad F_N = 0\n$$\n\n**3. 时间积分**\n关于 $\\Sigma_{j+1/2}$ 的常微分方程组使用显式前向欧拉法向前积分：\n$$\n\\Sigma_{j+1/2}^{n+1} = \\Sigma_{j+1/2}^{n} + \\Delta t \\left[ \\frac{d\\Sigma_{j+1/2}}{dt} \\right]^n\n$$\n其中上标 $n$ 表示时间步。为了保证该显式格式的稳定性，时间步长 $\\Delta t$ 受到扩散方程的 Courant-Friedrichs-Lewy (CFL) 条件的约束：\n$$\n\\Delta t \\le C\\,\\frac{\\Delta r^2}{3\\,\\nu}\n$$\n问题提供了一个安全因子 $C=0.2$。计算达到最终时间 $t_{\\rm end}$ 所需的总步数，并微调 $\\Delta t$ 以确保最后一步恰好落在 $t_{\\rm end}$。\n\n**4. 初始条件**\n初始条件是一个表面密度为 $\\Sigma_0$、半宽为 $w$、中心在 $r_0=1$ 的均匀环。$\\Sigma_0$ 的值通过将环的总质量归一化为 $M_{\\rm ring}=1$ 来确定：\n$$\nM_{\\rm ring} = 2\\pi \\int_{r_0-w}^{r_0+w} \\Sigma_0 r dr = 4\\pi r_0 w \\Sigma_0 = 1 \\implies \\Sigma_0 = \\frac{1}{4\\pi r_0 w}\n$$\n对于每个网格中心 $r_{j+1/2}$，如果 $r_0-w \\le r_{j+1/2} \\le r_0+w$，则初始表面密度 $\\Sigma_{j+1/2}(0)$ 设置为 $\\Sigma_0$，否则设置为 $0$。\n\n**5. 可观测量计算**\n所有量均在 $G=M=1$ 的无量纲单位下计算。\n\n- **初始和最终角动量 ($J_{\\rm in}$):** 盘内部（$r \\le r_0$）的总角动量通过使用中点法则（对网格单元求和）进行数值积分来计算：\n$$\nJ_{\\rm in}(t) = \\int_{r_{\\min}}^{r_0} 2\\pi\\Sigma(r,t)r^{3/2}dr \\approx \\sum_{j=0}^{k-1} 2\\pi \\Sigma_{j+1/2}(t) r_{j+1/2}^{3/2} \\Delta r\n$$\n其中索引 $k$ 使得 $r_k = r_0$。这对初始状态（$t=0$）和最终状态（$t=t_{\\rm end}$）都进行计算。\n\n- **测量的输运率 ($\\dot{J}_{\\rm meas}$):** 这是内盘角动量的时间平均变化率：\n$$\n\\dot{J}_{\\rm meas} = \\frac{J_{\\rm in}(t_{\\rm end}) - J_{\\rm in}(0)}{t_{\\rm end}}\n$$\n\n- **预测的输运率 ($\\dot{J}_{\\rm pred}$):** 这是在最终时刻，跨越边界 $r=r_0$ 的理论瞬时粘滞通量：\n$$\n\\dot{J}_{\\rm pred} = F_J(r_0, t_{\\rm end}) = 3\\pi\\nu\\Sigma(r_0, t_{\\rm end})r_0^{1/2}\n$$\n由于 $r_0=1$，这简化为 $3\\pi\\nu\\Sigma(1, t_{\\rm end})$。$\\Sigma(1, t_{\\rm end})$ 的值通过对两个相邻网格中心的值进行线性插值得到。\n\n- **误差和收敛性:** 绝对误差 $e = |\\dot{J}_{\\rm meas} - \\dot{J}_{\\rm pred}|$ 量化了模拟的一致性。收敛阶 $p$ 通过对连续网格加密对确定的速率进行平均来计算：\n$$\np_1 = \\frac{\\ln(e_{128}/e_{256})}{\\ln(2)}, \\quad p_2 = \\frac{\\ln(e_{256}/e_{512})}{\\ln(2)}, \\quad p = \\frac{p_1+p_2}{2}\n$$\n这为数值格式的准确性提供了一个稳健的度量。一个二阶格式预期会得到 $p \\approx 2$。\n\n最后一个可计算量是窄环情况下的比率 $\\dot{J}_{\\rm meas}/\\dot{J}_{\\rm pred}$。整个过程封装在一个 Python 程序中，以运行指定的测试套件并生成所需的输出。", "answer": "```python\nimport numpy as np\n\ndef run_simulation(N, w, r_min=0.5, r_max=1.5, r_0=1.0, nu=1e-3, t_end=1e-2):\n    \"\"\"\n    Performs one simulation of the accretion disk evolution.\n\n    Args:\n        N (int): Number of radial grid cells.\n        w (float): Half-width of the anitial ring.\n        r_min (float): Inner radius of the domain.\n        r_max (float): Outer radius of the domain.\n        r_0 (float): Center of the initial ring.\n        nu (float): Kinematic viscosity.\n        t_end (float): Final time of the simulation.\n\n    Returns:\n        tuple: A tuple containing (J_dot_meas, J_dot_pred).\n    \"\"\"\n    # Grid setup\n    dr = (r_max - r_min) / N\n    r_interfaces = np.linspace(r_min, r_max, N + 1)\n    r_centers = (r_interfaces[:-1] + r_interfaces[1:]) / 2.0\n\n    # Time step from stability criterion\n    C = 0.2\n    dt_stable = C * dr**2 / (3.0 * nu)\n    num_steps = int(np.ceil(t_end / dt_stable))\n    dt = t_end / num_steps\n\n    # Initial condition\n    sigma_0_const = 1.0 / (4.0 * np.pi * r_0 * w)\n    sigma = np.zeros(N)\n    mask = (r_centers >= r_0 - w)  (r_centers = r_0 + w)\n    sigma[mask] = sigma_0_const\n\n    # Calculate initial angular momentum in the inner disk (r = r_0)\n    # The interface at r_0 is at index k\n    k = int(round((r_0 - r_min) / dr))\n    # Integration is over cells from 0 to k-1\n    J_in_initial = np.sum(2.0 * np.pi * sigma[:k] * r_centers[:k]**1.5 * dr)\n\n    # Time evolution loop\n    for _ in range(num_steps):\n        # Calculate intermediate variable V = nu * Sigma * r^1/2 at cell centers\n        V_centers = nu * sigma * r_centers**0.5\n\n        # Calculate fluxes at interior interfaces\n        # F_j = r_j^1/2 * (V_{j+1/2} - V_{j-1/2}) / dr\n        F_internal = r_interfaces[1:-1]**0.5 * (V_centers[1:] - V_centers[:-1]) / dr\n        \n        # Flux array with boundary conditions F=0\n        F = np.zeros(N + 1)\n        F[1:-1] = F_internal\n\n        # Calculate time derivative of Sigma\n        dsigma_dt = (3.0 / r_centers) * (F[1:] - F[:-1]) / dr\n\n        # Update Sigma using Forward Euler\n        sigma += dt * dsigma_dt\n\n    # Calculate final quantities\n    # Final angular momentum in the inner disk\n    J_in_final = np.sum(2.0 * np.pi * sigma[:k] * r_centers[:k]**1.5 * dr)\n\n    # Measured average transport rate\n    J_dot_meas = (J_in_final - J_in_initial) / t_end\n\n    # Predicted instantaneous transport rate at t_end\n    # Interpolate Sigma at r_0 (interface k)\n    sigma_at_r0 = (sigma[k - 1] + sigma[k]) / 2.0\n    # J_dot_pred = 3 * pi * nu * Sigma(r_0) * r_0^1/2. With r_0=1.\n    J_dot_pred = 3.0 * np.pi * nu * sigma_at_r0\n\n    return J_dot_meas, J_dot_pred\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases_w01 = [\n        (64, 0.1),\n        (128, 0.1),\n        (256, 0.1),\n        (512, 0.1),\n    ]\n\n    test_case_narrow = (512, 0.05)\n\n    errors = {}\n    for N, w in test_cases_w01:\n        J_dot_meas, J_dot_pred = run_simulation(N, w)\n        error = np.abs(J_dot_meas - J_dot_pred)\n        errors[N] = error\n\n    e64 = errors[64]\n    e128 = errors[128]\n    e256 = errors[256]\n    e512 = errors[512]\n\n    # Calculate convergence order p, averaged over adjacent pairs\n    # p = ln(error_ratio) / ln(resolution_ratio)\n    # Resolution ratio for successive doublings is 2.\n    if e128 > 0 and e256 > 0 and e512 > 0:\n        p1 = np.log(e128 / e256) / np.log(2)\n        p2 = np.log(e256 / e512) / np.log(2)\n        p = (p1 + p2) / 2.0\n    else:\n        p = np.nan # Avoid division by zero if errors are zero\n\n    # Run the narrow ring case\n    J_dot_meas_narrow, J_dot_pred_narrow = run_simulation(*test_case_narrow)\n    if J_dot_pred_narrow != 0:\n        ratio_narrow = J_dot_meas_narrow / J_dot_pred_narrow\n    else:\n        ratio_narrow = np.nan # Avoid division by zero\n\n    # Format and print the final output\n    results = [e64, e128, e256, e512, p, ratio_narrow]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3517585"}]}