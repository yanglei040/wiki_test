{"hands_on_practices": [{"introduction": "在引入行星之前，我们的首要任务是构建一个稳定的、处于平衡状态的气体盘。本练习将引导你从第一性原理出发，建立一个一维径向盘模型，确保引力、压力梯度力和离心力相互平衡[@problem_id:3520488]。掌握这种初始设置是任何行星-盘模拟的基础，因为它可以防止初始条件本身引入伪动态，从而确保后续模拟的物理真实性。", "problem": "您需要设计、实现并验证一个围绕中心恒星的气体盘的一维径向初始化模型，该模型中没有嵌入行星。目标是证明所选的边界条件和初始剖面在牛顿引力和理想气体状态方程下，能够产生一个准静态平衡构型。推导和验证必须从第一性原理出发。其计算天体物理背景是一个不含行星的原行星盘，其中主导力是压力梯度和中心引力，且垂直结构是流体静力学的。您必须编写一个完整的、可运行的程序，该程序在指定的径向域上构建盘的状态，并为几组参数集返回布尔值的验证结果。\n\n基本物理基础：\n- 稳态、轴对称的径向动量平衡（源于柱坐标系中径向速度为零的欧拉方程）关联了离心项、中心引力和径向压力梯度。中心引力场是牛顿引力场且球对称。\n- 气体遵循理想气体定律。\n- 垂直流体静力学平衡定义了标高与声速之间的关系。\n- 旋转的稳定性必须满足瑞利判据，引力-旋转平衡由 Toomre 稳定性参数表征。\n\n初始剖面：\n- 面密度由给定的幂律定律给出：$\\Sigma(r) = \\Sigma_0 \\left(\\frac{r}{r_0}\\right)^{-p}$。\n- 温度由给定的幂律定律给出：$T(r) = T_0 \\left(\\frac{r}{r_0}\\right)^{-q}$。\n\n单位与常数：\n- 使用国际单位制 (SI)：长度单位为米，质量单位为千克，时间单位为秒，温度单位为开尔文。\n- 使用 $G$ 表示引力常数，$k_B$ 表示玻尔兹曼常数，$m_p$ 表示质子质量。平均分子量是一个无量纲参数 $\\mu$，定义为气体粒子质量为 $\\mu m_p$。\n\n径向域和边界条件：\n- 计算域是一维径向域 $r \\in [r_{\\mathrm{in}}, r_{\\mathrm{out}}]$，由 $N$ 个网格点离散化。在适当情况下，网格应能解析数个数量级。\n- 径向速度的边界条件是在任何地方（包括边界）均为 $v_r(r)=0$。\n- 径向压力梯度应在边界处使用一致的单边导数计算，在内部使用中心差分计算。\n\n从第一性原理推导：\n- 从稳态径向力平衡出发，推导决定旋转剖面 $v_\\phi(r)$ 的条件，用中心引力和径向压力梯度表示。\n- 使用理想气体定律，用 $T(r)$ 和 $\\mu$ 定义等温声速 $c_s(r)$。\n- 在中心引力下，利用垂直流体静力学平衡，用 $c_s(r)$ 和开普勒角频率定义标高 $H(r)$。\n- 获得与给定 $\\Sigma(r)$ 和 $T(r)$ 一致的中平面密度 $\\rho(r)$ 和中平面压力 $P(r)$。\n\n准静态平衡的验证标准：\n- 旋转的正定性：在整个域上 $v_\\phi^2(r) > 0$。\n- 径向力平衡残差：定义一个无量纲残差 $R(r)$，作为径向力平衡中偏差的量值，并用引力项和压力支持项的量值之和进行归一化。要求 $\\max_r R(r) \\le \\epsilon$，其中 $\\epsilon$ 是指定的容差。\n- 瑞利稳定性：比角动量 $j(r) = r v_\\phi(r)$ 必须在任何地方都满足 $\\frac{dj}{dr} \\ge 0$。\n- Toomre 稳定性：Toomre 参数 $Q(r)$ 必须在任何地方都满足 $Q(r) \\ge 1$。\n\n实现细节：\n- 根据理想气体定律计算 $c_s(r)$。使用牛顿引力计算开普勒角频率。根据垂直流体静力学平衡计算 $H(r)$。假设中平面为高斯垂直结构，根据 $\\Sigma(r)$ 和 $H(r)$ 计算 $\\rho(r)$。计算中平面的 $P(r)$。使用适用于非均匀网格的有限差分格式计算径向压力梯度 $\\frac{dP}{dr}$。计算与径向力平衡一致的 $v_\\phi(r)$。然后评估三个稳定性检查。\n- 残差容差取为 $\\epsilon = 5 \\times 10^{-4}$。\n\n测试套件：\n对于每个测试用例，提供 SI 单位的参数 $(M_\\star,\\Sigma_0,p,T_0,q,\\mu,r_0,r_{\\mathrm{in}},r_{\\mathrm{out}},N)$，其中 $r_0$ 是一个参考半径，应为 $1$ 天文单位 (AU)，以米表示。\n\n- 测试用例 1 (标准路径)：\n    - $M_\\star = 1.98847 \\times 10^{30}\\ \\mathrm{kg}$，$\\Sigma_0 = 5.0 \\times 10^{3}\\ \\mathrm{kg/m^2}$，$p = 1.0$，$T_0 = 280\\ \\mathrm{K}$，$q = 0.5$，$\\mu = 2.34$，$r_0 = 1\\ \\mathrm{AU}$，$r_{\\mathrm{in}} = 0.1\\ \\mathrm{AU}$，$r_{\\mathrm{out}} = 50\\ \\mathrm{AU}$，$N = 512$。\n- 测试用例 2 (更陡的面密度和更冷的外盘)：\n    - $M_\\star = 0.5 \\times 1.98847 \\times 10^{30}\\ \\mathrm{kg}$，$\\Sigma_0 = 3.0 \\times 10^{3}\\ \\mathrm{kg/m^2}$，$p = 1.5$，$T_0 = 120\\ \\mathrm{K}$，$q = 0.7$，$\\mu = 2.34$，$r_0 = 1\\ \\mathrm{AU}$，$r_{\\mathrm{in}} = 1\\ \\mathrm{AU}$，$r_{\\mathrm{out}} = 100\\ \\mathrm{AU}$，$N = 512$。\n- 测试用例 3 (预期会因引力弱和气体热而失败的边缘情况)：\n    - $M_\\star = 0.2 \\times 1.98847 \\times 10^{30}\\ \\mathrm{kg}$，$\\Sigma_0 = 5.0 \\times 10^{2}\\ \\mathrm{kg/m^2}$，$p = 0.5$，$T_0 = 400\\ \\mathrm{K}$，$q = 0.0$，$\\mu = 2.34$，$r_0 = 1\\ \\mathrm{AU}$，$r_{\\mathrm{in}} = 0.5\\ \\mathrm{AU}$，$r_{\\mathrm{out}} = 300\\ \\mathrm{AU}$，$N = 512$。\n- 测试用例 4 (高温内盘，小范围域)：\n    - $M_\\star = 1.98847 \\times 10^{30}\\ \\mathrm{kg}$，$\\Sigma_0 = 8.0 \\times 10^{3}\\ \\mathrm{kg/m^2}$，$p = 0.5$，$T_0 = 1000\\ \\mathrm{K}$，$q = 1.0$，$\\mu = 2.34$，$r_0 = 1\\ \\mathrm{AU}$，$r_{\\mathrm{in}} = 0.05\\ \\mathrm{AU}$，$r_{\\mathrm{out}} = 5\\ \\mathrm{AU}$，$N = 512$。\n\n天文单位换算：\n- $1\\ \\mathrm{AU} = 1.495978707 \\times 10^{11}\\ \\mathrm{m}$。\n\n程序输出规范：\n- 对于每个测试用例，您的程序必须输出一个布尔值，指示准静态平衡验证是否通过 (true) 或失败 (false)。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，\"[true,false,true,false]\"）。使用 Python 的布尔字面量 \"True\" 或 \"False\" 转换成字符串后的形式，不含空格。\n\n程序不应读取任何外部输入；所有常数和测试参数必须在程序中定义。不使用角度。所有物理量均以国际单位制表示。不使用百分比；任何分数形式的量应为无量纲量或根据情况使用国际单位制单位。", "solution": "该问题要求设计并验证一个处于准静态平衡的原行星气体盘的一维径向模型。该解决方案基于流体动力学和牛顿引力的第一性原理构建，并假设气体为理想气体。该过程包括：根据指定的面密度和温度的幂律剖面，推导盘的物理状态——包括密度、压力和旋转速度，然后根据四个物理和数值有效性标准对该状态进行测试。\n\n### 基本原理和控制方程\n\n该模型基于以下物理原理，在柱坐标系 $(r, \\phi, z)$ 中表述，并假设轴对称 ($\\partial/\\partial\\phi = 0$) 和稳态 ($\\partial/\\partial t = 0$) 且无径向流动 ($v_r=0$)。\n\n1.  **径向力平衡**：欧拉动量方程的径向分量描述了中心恒星的引力、径向压力梯度以及旋转引起的离心力之间的平衡。对于密度为 $\\rho$ 的气体微元，其平衡条件为：\n    $$\n    \\frac{v_\\phi^2(r)}{r} = \\frac{GM_\\star}{r^2} + \\frac{1}{\\rho(r)}\\frac{dP(r)}{dr}\n    $$\n    其中 $v_\\phi(r)$ 是方位角速度，$M_\\star$ 是中心恒星的质量，$P(r)$ 是中平面气体压力，$G$ 是引力常数。\n\n2.  **理想气体定律**：气体压力 $P$、密度 $\\rho$ 和温度 $T$ 通过理想气体定律关联：\n    $$\n    P = \\frac{\\rho k_B T}{\\mu m_p}\n    $$\n    其中 $k_B$ 是玻尔兹曼常数，平均粒子质量为 $\\mu m_p$（$\\mu$ 是平均分子量，$m_p$ 是质子质量）。这使我们能够定义等温声速 $c_s$，其平方为 $c_s^2 = P/\\rho = k_B T / (\\mu m_p)$。\n\n3.  **垂直流体静力学平衡**：在薄盘中，垂直结构由垂直压力梯度与恒星引力的垂直分量之间的平衡决定，即 $g_z \\approx (GM_\\star/r^2)(z/r) = \\Omega_K^2 z$，其中 $\\Omega_K(r) = \\sqrt{GM_\\star/r^3}$ 是开普勒角频率。这导致高斯垂直密度剖面 $\\rho(r, z) = \\rho(r) \\exp(-z^2 / (2H(r)^2))$，其中 $\\rho(r)$ 是中平面密度，$H(r)$ 是垂直压力标高，由下式给出：\n    $$\n    H(r) = \\frac{c_s(r)}{\\Omega_K(r)}\n    $$\n    此处，盘的角频率近似为开普勒值，这是初始模型的标准简化。面密度 $\\Sigma(r)$ 是 $\\rho(r, z)$ 的垂直积分，得出 $\\Sigma(r) = \\sqrt{2\\pi} \\rho(r) H(r)$。\n\n### 盘状态的算法实现\n\n盘的状态在一个具有 $N$ 个点的对数间隔的径向网格 $r \\in [r_{\\mathrm{in}}, r_{\\mathrm{out}}]$ 上顺序构建，这适用于跨越数个数量级的域。\n\n1.  **初始剖面**：首先在网格上评估指定的面密度和温度的幂律剖面：\n    $$\n    \\Sigma(r) = \\Sigma_0 \\left(\\frac{r}{r_0}\\right)^{-p} \\quad \\text{和} \\quad T(r) = T_0 \\left(\\frac{r}{r_0}\\right)^{-q}\n    $$\n\n2.  **派生物理量**：使用这些剖面，在每个网格点 $r_i$ 计算以下物理量：\n    -   等温声速：$c_s(r) = \\sqrt{k_B T(r) / (\\mu m_p)}$。\n    -   开普勒角频率：$\\Omega_K(r) = \\sqrt{G M_\\star / r^3}$。\n    -   标高：$H(r) = c_s(r) / \\Omega_K(r)$。\n    -   中平面密度：$\\rho(r) = \\Sigma(r) / (\\sqrt{2\\pi} H(r))$。\n    -   中平面压力：$P(r) = \\rho(r) c_s(r)^2$。\n\n3.  **旋转剖面**：径向压力梯度 $dP/dr$ 使用二阶中心差分（用于内部点）和单边差分（用于边界）进行数值计算，如 `numpy.gradient` 中所实现。然后通过重新整理径向力平衡方程来确定方位角速度 $v_\\phi(r)$：\n    $$\n    v_\\phi^2(r) = \\frac{GM_\\star}{r} + \\frac{r}{\\rho(r)}\\frac{dP(r)}{dr}\n    $$\n    这种表述确保了旋转速度与引力和压力支持之间的平衡相一致。\n\n### 验证标准\n\n生成的盘状态将根据四个标准进行验证，以确保其代表一个物理上合理、处于准静态平衡的构型。\n\n1.  **旋转的正定性**：压力支持项通常为负 ($dP/dr  0$)，其大小不能超过引力项。这要求在整个域上 $v_\\phi^2(r)  0$。若此条件不满足，则表示一个非物理状态，其中压力将压倒引力。\n\n2.  **径向力平衡残差**：定义一个无量纲残差 $R(r)$ 来验证数值上的自洽性。它衡量了径向力（单位质量）平衡中的分数误差：\n    $$\n    R(r) = \\frac{\\left| \\frac{v_\\phi^2}{r} - \\left( \\frac{GM_\\star}{r^2} + \\frac{1}{\\rho}\\frac{dP}{dr} \\right) \\right|}{\\frac{GM_\\star}{r^2} + \\left| \\frac{1}{\\rho}\\frac{dP}{dr} \\right|}\n    $$\n    由于 $v_\\phi^2$ 是为了满足此平衡而计算的，$R(r)$ 应在浮点精度范围内为零。检查 $\\max_r R(r) \\le \\epsilon = 5 \\times 10^{-4}$ 可作为对数值实现的健全性检查。\n\n3.  **瑞利稳定性**：对于旋转流体，流体动力学稳定性要求比角动量 $j(r) = r v_\\phi(r)$ 必须是半径的非减函数。这是瑞利判据：\n    $$\n    \\frac{dj(r)}{dr} \\ge 0\n    $$\n    导数 $dj/dr$ 进行数值计算，并在所有网格点检查该条件。\n\n4.  **Toomre 稳定性**：为了使盘对其自身引力保持稳定，Toomre $Q$ 参数必须大于或等于一。$Q$ 参数由下式给出：\n    $$\n    Q(r) = \\frac{c_s(r) \\kappa(r)}{\\pi G \\Sigma(r)} \\ge 1\n    $$\n    其中 $\\kappa(r)$ 是本轮频率，定义为 $\\kappa^2(r) = \\frac{1}{r^3} \\frac{d(j^2)}{dr}$。导数 $d(j^2)/dr$ 进行数值计算。瑞利稳定性判据确保 $\\kappa^2 \\ge 0$，因此 $\\kappa$ 是实数。\n\n一个测试用例只有在整个计算域上都满足所有四个标准时，才被认为通过验证。最终程序会遍历每个参数集，执行这些计算，并返回一个布尔结果。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the disk validation for all test cases.\n    \"\"\"\n    # Physical and Astronomical Constants in SI units\n    G = 6.67430e-11  # Gravitational constant (m^3 kg^-1 s^-2)\n    K_B = 1.380649e-23  # Boltzmann constant (J K^-1)\n    M_P = 1.67262192e-27  # Proton mass (kg)\n    AU = 1.495978707e11  # Astronomical Unit (m)\n    SOLAR_MASS = 1.98847e30 # Solar mass (kg)\n\n    def check_disk_equilibrium(params):\n        \"\"\"\n        Constructs and validates a 1D protoplanetary disk model.\n\n        Args:\n            params (tuple): A tuple containing the disk parameters in SI units:\n            (M_star, Sigma0, p, T0, q, mu, r0, r_in, r_out, N)\n\n        Returns:\n            bool: True if the disk model passes all validation criteria, False otherwise.\n        \"\"\"\n        M_star, Sigma0, p, T0, q, mu, r0, r_in, r_out, N = params\n        epsilon = 5.0e-4\n\n        # 1. Set up a logarithmically spaced radial grid\n        r = np.geomspace(r_in, r_out, N)\n\n        # 2. Define initial power-law profiles for surface density and temperature\n        Sigma = Sigma0 * (r / r0)**(-p)\n        T = T0 * (r / r0)**(-q)\n\n        # 3. Derive other physical quantities from first principles\n        cs_sq = K_B * T / (mu * M_P)\n        cs = np.sqrt(cs_sq)\n\n        Omega_K_sq = G * M_star / r**3\n        Omega_K = np.sqrt(Omega_K_sq)\n        \n        # Scale height assuming rotation is approximately Keplerian\n        H = cs / Omega_K\n\n        # Midplane density from surface density and scale height\n        rho = Sigma / (np.sqrt(2 * np.pi) * H)\n\n        # Midplane pressure from ideal gas law\n        P = rho * cs_sq\n\n        # 4. Determine the azimuthal velocity from radial force balance\n        # Compute the pressure gradient numerically\n        dPdr = np.gradient(P, r)\n        \n        # Calculate the square of the azimuthal velocity\n        v_phi_sq = G * M_star / r + r * dPdr / rho\n\n        # --- VALIDATION CHECKS ---\n\n        # Criterion 1: Positivity of rotation (v_phi^2 must be positive)\n        if not np.all(v_phi_sq > 0):\n            return False\n        \n        v_phi = np.sqrt(v_phi_sq)\n\n        # Criterion 2: Radial force balance residual\n        a_centrifugal = v_phi_sq / r\n        a_gravity = G * M_star / r**2\n        a_pressure = dPdr / rho\n        \n        numerator = np.abs(a_centrifugal - a_gravity - a_pressure)\n        denominator = a_gravity + np.abs(a_pressure)\n        # Avoid division by zero in the unlikely event denominator is zero\n        denominator[denominator == 0] = 1.0 \n        \n        R = numerator / denominator\n        if not (np.max(R) = epsilon):\n            return False\n\n        # Criterion 3: Rayleigh stability (specific angular momentum non-decreasing)\n        j = r * v_phi\n        djdr = np.gradient(j, r)\n        if not np.all(djdr >= 0):\n            return False\n\n        # Criterion 4: Toomre stability (stable against self-gravity)\n        j_sq = j**2\n        dj_sq_dr = np.gradient(j_sq, r)\n        \n        # Rayleigh stability implies kappa^2 is non-negative.\n        # Add a check for robustness against small numerical errors.\n        if np.any(dj_sq_dr  0):\n             return False # Should be caught by Rayleigh check, but good practice\n        \n        kappa_sq = dj_sq_dr / r**3\n        kappa = np.sqrt(kappa_sq)\n\n        Q = cs * kappa / (np.pi * G * Sigma)\n        if not np.all(Q >= 1):\n            return False\n\n        # If all checks pass, the configuration is valid\n        return True\n\n    # Test suite parameters provided in the problem statement\n    test_cases = [\n        # (M_star, Sigma0, p, T0, q, mu, r0, r_in, r_out, N)\n        # Case 1: Happy path\n        (1.0 * SOLAR_MASS, 5.0e3, 1.0, 280.0, 0.5, 2.34, 1.0 * AU, 0.1 * AU, 50.0 * AU, 512),\n        # Case 2: Steeper density, cooler disk\n        (0.5 * SOLAR_MASS, 3.0e3, 1.5, 120.0, 0.7, 2.34, 1.0 * AU, 1.0 * AU, 100.0 * AU, 512),\n        # Case 3: Expected fail (weak gravity, hot gas)\n        (0.2 * SOLAR_MASS, 5.0e2, 0.5, 400.0, 0.0, 2.34, 1.0 * AU, 0.5 * AU, 300.0 * AU, 512),\n        # Case 4: Hot inner disk, small domain\n        (1.0 * SOLAR_MASS, 8.0e3, 0.5, 1000.0, 1.0, 2.34, 1.0 * AU, 0.05 * AU, 5.0 * AU, 512),\n    ]\n\n    results = []\n    for case in test_cases:\n        is_valid = check_disk_equilibrium(case)\n        results.append(str(is_valid))\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3520488"}, {"introduction": "由于高速开普勒剪切流占主导地位，精确模拟星周盘的流体动力学具有挑战性。本练习将介绍一种精巧的数值方法——残差重映解算器 (residual-plus-remap solver)，它旨在最小化此类流动中的数值误差[@problem_id:3520474]。通过分离出大尺度的背景运动并对其进行精确处理，我们能够在捕捉由行星驱动的微小但至关重要的动力学过程时，获得更高的精度。", "problem": "考虑一个与行星-盘相互作用相关的、较差自转盘的局域同转剪切层模型，其中背景轨道运动是近开普勒的。令旋转频率为 $\\,\\Omega\\,$，开普勒剪切参数为 $\\,q = 3/2\\,$. 在一个固定的径向位置 $\\,x = x_0\\,$，方位角速度可以很好地近似为一个已知的开普勒背景速度与一个小的剩余速度之和，即 $\\,v_y(y,t) = v_K(x_0) + u(y,t)\\,$。在该局域模型中，背景的离心力和潮汐力相互抵消，剩余动力学由不含大的源项的守恒方程控制。\n\n为了将数值耗散与大的背景平流分离开来，我们关注一个由方位角流平流的被动示踪物 $\\,T(y,t)\\,$。该示踪物在长度为 $\\,L\\,$ 的周期性区域上服从守恒律\n$$\n\\frac{\\partial T}{\\partial t} + \\frac{\\partial}{\\partial y}\\left( v_y T \\right) = 0,\n$$\n标准的 Godunov 有限体积法使用通量 $\\,F(T) = v_y T\\,$ 以及在界面处的迎风黎曼通量。在剩余表述中，我们通过减去恒定的背景速度 $\\,v_0 \\equiv v_K(x_0)\\,$ 来分解通量，并在一个以速度 $\\,v_0\\,$ 运动的参考系中重写守恒律：\n$$\n\\frac{\\partial T}{\\partial t} + \\frac{\\partial}{\\partial y}\\left( G(T) \\right) = 0,\\quad G(T) \\equiv (v_y - v_0) T.\n$$\n如果 $\\,u \\ll v_0\\,$，这个剩余定律是伽利略不变的，并且不包含大的输运项。一个用于近开普勒剪切流的良态、低耗散格式在每个时间增量 $\\,\\Delta t\\,$ 内分两步进行：\n- 剩余黎曼步：使用由左右状态和剩余波速 $\\,u = v_y - v_0\\,$ 构造的迎风黎曼通量，求解通量为 $\\,G(T)\\,$ 的守恒律。\n- 背景重映步：在周期性区域上对 $\\,T\\,$ 进行距离为 $\\,v_0 \\Delta t\\,$ 的精确均匀平移，这代表了已知的开普勒平流，且没有数值扩散。\n\n你的任务：\n1) 从上述基本守恒律出发，推导标准表述和剩余表述的精确单元间迎风黎曼通量。对于标准表述，界面通量必须是\n$$\nF^* = \\max(v_y,0)\\,T_L + \\min(v_y,0)\\,T_R,\n$$\n其中 $\\,T_L\\,$ 和 $\\,T_R\\,$ 分别是在一个面上重构的左状态和右状态。对于剩余表述，界面剩余通量必须是\n$$\nG^* = \\max(u,0)\\,T_L + \\min(u,0)\\,T_R,\\quad u = v_y - v_0,\n$$\n随后进行距离为 $\\,v_0 \\Delta t\\,$ 的精确周期性重映。解释为什么这些通量可以从标量守恒律的特征线推得，以及剩余分解如何利用伽利略不变性来减少近开普勒流中的耗散。\n\n2) 在一维周期性区域 $\\,y \\in [0,L)\\,$ 上实现两个一阶有限体积求解器，该区域包含 $\\,N\\,$ 个宽度为 $\\,\\Delta y = L/N\\,$ 的均匀单元：\n- 标准求解器：使用标准 Godunov 通量 $\\,F^*\\,$ 和恒定速度 $\\,v_y = v_0\\,$，将 $\\,T\\,$ 推进一个时间步长 $\\,\\Delta t\\,$。\n- 剩余加重映求解器：使用 $\\,G^*\\,$ 和 $\\,u = 0\\,$（因为在测试中 $\\,v_y = v_0\\,$）执行剩余黎曼步，然后应用距离为 $\\,v_0 \\Delta t\\,$ 的精确周期性重映来表示背景输运。\n\n使用以下数值参数和初始条件：\n- 区域长度 $\\,L = 1\\,$ 和单元数量 $\\,N = 256\\,$。\n- 初始示踪物 $\\,T(y,0) = 1 + A \\sin(2\\pi k y)\\,$，其中 $\\,A = 10^{-2}\\,$ 且整数波数 $\\,k = 4\\,$。\n- 恒定速度 $\\,v_y = v_0\\,$（因此处处 $\\,u = 0\\,$）。\n- 周期性边界条件。\n- Courant 数 $\\,\\mathrm{CFL} = 0.7\\,$ 和单步时间增量 $\\,\\Delta t = \\mathrm{CFL}\\,\\Delta y / |v_0|\\,$。\n- 使用无量纲单位；输出不需要物理单位。\n\n3) 对于下面为 $\\,v_0\\,$ 指定的每个测试用例，用两种求解器将解推进一个时间步长，并计算示踪物场相对于精确解的 $\\,L^1\\,$ 误差\n$$\nT_{\\mathrm{exact}}(y,\\Delta t) = 1 + A \\sin\\!\\left( 2\\pi k \\left[y - v_0 \\Delta t\\right] \\right).\n$$\n将离散 $\\,L^1\\,$ 误差定义为所有单元的单元平均绝对误差之和除以 $\\,N\\,$。对于每个用例，报告比率 $\\,r = E_{\\mathrm{res}}/E_{\\mathrm{std}}\\,$，其中 $\\,E_{\\mathrm{res}}\\,$ 和 $\\,E_{\\mathrm{std}}\\,$ 分别是剩余加重映求解器和标准求解器的误差。\n\n测试套件（三个复杂度和符号覆盖范围递增的用例）：\n- 用例 $\\,1\\,$：$\\,v_0 = 1.3\\,$。\n- 用例 $\\,2\\,$：$\\,v_0 = 20.0\\,$。\n- 用例 $\\,3\\,$：$\\,v_0 = -7.25\\,$。\n\n最终输出要求：\n你的程序应生成单行输出，其中包含三个比率，形式为用方括号括起来的逗号分隔列表，顺序与测试套件相同，例如 $\\,\\left[ r_1, r_2, r_3 \\right]\\,$。每个 $\\,r_i\\,$ 必须是浮点数。不应打印任何额外文本。", "solution": "该问题是有效的。它在科学上基于计算流体动力学原理，是适定的，所有必要的参数和初始条件都已定义，并且其表述是客观的。它为比较专为平流主导的流设计的数值格式提供了一个标准的、尽管是简化的测试用例，这是计算天体物理学中的一个常见挑战。因此，我们可以开始解答。\n\n该问题要求完成两项主要任务：首先，为标量平流方程的两种不同表述推导迎风黎曼通量，并解释剩余加重映方法背后的基本原理；其次，在一个特定的测试用例上实现并比较这两种方法，并报告它们的数值误差之比。\n\n### 1. 推导与理论背景\n\n基本方程是关于被方位角流 $v_y$ 平流的被动示踪物 $T(y,t)$ 的一维守恒律：\n$$\n\\frac{\\partial T}{\\partial t} + \\frac{\\partial}{\\partial y}\\left( v_y T \\right) = 0\n$$\n这是一个双曲型偏微分方程。为了构建 Godunov 型有限体积格式，我们考虑每个单元界面上的黎曼问题。在本问题的背景下，速度 $v_y$ 是恒定的，方程简化为线性平流方程，$\\frac{\\partial T}{\\partial t} + v_y \\frac{\\partial T}{\\partial y} = 0$。该方程的特征速度就是 $v_y$。\n\n**标准表述的通量**\n\n一阶 Godunov 方法将单元界面（比如在位置 $y_{i+1/2}$）处的通量设置为从黎曼问题的精确解中导出的值，该黎曼问题具有左状态 $T_L = T_i$ 和右状态 $T_R = T_{i+1}$。对于线性平流，界面处的解由信息流动的方向决定，该方向由特征速度 $v_y$ 的符号给出。\n- 如果 $v_y  0$，信息从左向右传播。界面处的状态是左状态，$T(y_{i+1/2}, t) = T_L$。通量为 $F^* = v_y T_L$。\n- 如果 $v_y  0$，信息从右向左传播。界面处的状态是右状态，$T(y_{i+1/2}, t) = T_R$。通量为 $F^* = v_y T_R$。\n- 如果 $v_y = 0$，没有平流，通量为 $F^* = 0$。\n\n这些条件可以使用正部算子 $a^+ = \\max(a,0)$ 和负部算子 $a^- = \\min(a,0)$ 表示在一个公式中。因此，迎风黎曼通量 $F^*$ 为：\n$$\nF^* = \\max(v_y, 0) T_L + \\min(v_y, 0) T_R\n$$\n该推导证实了问题陈述中提供的表达式。\n\n**剩余表述的通量**\n\n剩余表述将速度 $v_y$ 分解为一个大的恒定背景速度 $v_0$ 和一个小的剩余速度 $u$，使得 $v_y = v_0 + u$。然后，守恒律在一个以速度 $v_0$ 运动的参考系中被重写。这是通过定义一个新的通量 $G(T) = (v_y - v_0)T = uT$ 来实现的。在此参考系中的控制方程变为：\n$$\n\\frac{\\partial T}{\\partial t} + \\frac{\\partial}{\\partial y}\\left( G(T) \\right) = 0\n$$\n这同样是一个线性平流方程，但其特征速度为 $u$。迎风黎曼通量 $G^*$ 的推导在数学上与前一个情况相同，只是用 $u$ 替换了 $v_y$。因此，剩余动力学的迎风通量为：\n$$\nG^* = \\max(u, 0) T_L + \\min(u, 0) T_R\n$$\n这证实了问题中提供的第二个表达式。\n\n**剩余加重映方法的基本原理**\n\n该方法是一种算子分裂技术。平流的总时间演化算子被分裂为两部分：一部分是由小速度 $u$ 控制的剩余部分，另一部分是由大速度 $v_0$ 控制的背景部分。\n关键的见解在于，这两部分可以用不同的方法求解，每种方法都最适合其平流的特性。\n\n1.  **剩余黎曼步**：方程 $\\frac{\\partial T}{\\partial t} + \\frac{\\partial(uT)}{\\partial y} = 0$ 使用带有通量 $G^*$ 的数值 Godunov 格式求解。一阶迎风格式的数值扩散与平流速度成正比。由于在近开普勒流中 $|u| \\ll |v_0|$，因此在这一步引入的数值误差与求解完整速度 $v_y$ 所引起的误差相比非常小。\n\n2.  **背景重映步**：方程 $\\frac{\\partial T}{\\partial t} + \\frac{\\partial(v_0 T)}{\\partial y} = 0$ 代表了由恒定速度 $v_0$ 引起的平流，它有一个简单的精确解析解：$T(y, t+\\Delta t) = T(y-v_0\\Delta t, t)$。这是一个纯粹的平移。对于周期性区域，可以使用傅里叶方法在数值上实现这种平移，而不会产生扩散误差。具体做法是：计算示踪物分布的快速傅里叶变换 (FFT)，对每个傅里叶模式应用与平移对应的相位移，然后计算逆 FFT。设 $\\hat{T}(m)$ 是 $T(y)$ 的第 $m$ 个傅里叶系数。平移后分布的系数为 $\\hat{T}_{\\text{shifted}}(m) = \\hat{T}(m) \\exp(-i 2\\pi m (v_0 \\Delta t)/L)$。此步骤的精度可达机器精度。\n\n这种分解利用了**伽利略不变性**。剩余方程只是在以速度 $v_0$ 运动的参考系中表示的平流方程。通过变换到这个参考系，我们分离出了流场中“困难”的（非均匀）部分 $u$，其量级很小。我们对这个小量级的流进行数值求解（产生小误差），然后将大量级的均匀运动作为一个精确变换来应用。相比之下，标准方法将一个扩散性数值格式应用于整个速度 $v_y = v_0+u$，导致与 $|v_0|$ 成比例的大量数值耗散。\n\n在本问题的特定测试用例中，我们有 $v_y = v_0$，这意味着剩余速度处处为 $u = 0$。对于剩余加重映求解器，这意味着剩余通量 $G^*$ 为零，因此示踪物场在剩余步中保持不变。整个演化过程由背景重映捕捉，而背景重映在数值上是精确的。所得到的误差 $E_{\\mathrm{res}}$ 应该接近浮点精度。相反，标准求解器仍然有非零通量，并将引入数值扩散，导致一个显著的误差 $E_{\\mathrm{std}}$。因此，比率 $r=E_{\\mathrm{res}}/E_{\\mathrm{std}}$ 预计会非常小。\n\n### 2. 实现与计算\n\n实现遵循有限体积法。对于单元宽度为 $\\Delta y$ 的均匀网格，单元平均示踪物 $T_i$ 从时间 $t^n$ 到 $t^{n+1}=t^n+\\Delta t$ 的更新公式为：\n$$\nT_i^{n+1} = T_i^n - \\frac{\\Delta t}{\\Delta y} (F_{i+1/2}^* - F_{i-1/2}^*)\n$$\n其中 $F_{i\\pm1/2}^*$ 是单元界面处的数值通量。\n\n**数值参数**：\n- 区域长度：$L=1$\n- 单元数量：$N=256$\n- 网格间距：$\\Delta y = L/N = 1/256$\n- 初始条件：$T(y,0) = 1 + A \\sin(2\\pi k y)$，振幅 $A = 10^{-2}$，波数 $k = 4$。\n- Courant 数：$\\mathrm{CFL} = 0.7$\n- 时间步长：$\\Delta t = \\mathrm{CFL} \\, \\Delta y / |v_0|$\n\n对于 $v_0 \\in \\{1.3, 20.0, -7.25\\}$ 的每个测试用例，我们使用两种求解器计算一个时间步长后的解。\n\n- **标准求解器**：我们使用 $v_y=v_0$ 以及界面 $y_{i+1/2}$ 处的单元平均状态 $T_i^n$ 和 $T_{i+1}^n$ 来计算迎风通量 $F^*$。然后，我们应用有限体积更新公式，同时遵守周期性边界条件。\n- **剩余加重映求解器**：\n    1.  由于 $u=0$，剩余通量 $G^*=0$。剩余步之后的场与初始场相同。\n    2.  我们执行精确重映。平移距离为 $v_0 \\Delta t$。以网格单元为单位所需的平移量是 $s = (v_0 \\Delta t) / \\Delta y = \\mathrm{CFL} \\cdot \\mathrm{sgn}(v_0)$，即 $\\pm 0.7$ 个单元。这个亚单元平移通过上述傅里叶方法应用。\n- **误差计算**：将两种求解器的结果 $T_{\\mathrm{std}}$ 和 $T_{\\mathrm{res}}$ 与精确解 $T_{\\mathrm{exact}}(y,\\Delta t) = 1 + A \\sin(2\\pi k [y - v_0 \\Delta t])$ 进行比较。离散 $L^1$ 误差计算为 $E = \\frac{1}{N} \\sum_{i=0}^{N-1} |T_i(\\Delta t) - T_{\\mathrm{exact}}(y_i, \\Delta t)|$。最后，为每个 $v_0$ 计算比率 $r = E_{\\mathrm{res}}/E_{\\mathrm{std}}$。\n\n以下程序实现了这个过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom numpy.fft import fft, ifft, fftfreq\n\ndef solve():\n    \"\"\"\n    Implements and compares standard and residual-plus-remap finite-volume solvers\n    for a 1D linear advection problem.\n    \"\"\"\n    \n    # Define numerical parameters from the problem statement.\n    L = 1.0\n    N = 256\n    A = 1e-2\n    k = 4\n    CFL = 0.7\n\n    # Set up the computational grid\n    dy = L / N\n    # Cell-centered grid coordinates\n    y = (np.arange(N) + 0.5) * dy\n\n    # Define the initial condition for the tracer T\n    T0 = 1.0 + A * np.sin(2 * np.pi * k * y / L)\n\n    # Define the test cases from the problem statement.\n    test_cases = [1.3, 20.0, -7.25]\n    \n    results = []\n    \n    for v0 in test_cases:\n        # Calculate the single-step time increment\n        dt = CFL * dy / abs(v0)\n\n        # --- Standard Godunov Solver ---\n        # A first-order upwind scheme\n        T_std = np.copy(T0)\n        \n        # Reconstruct left and right states at interfaces. For first-order, these\n        # are just the cell-average values. T_L is T_std, T_R is the next cell.\n        T_L = T_std\n        T_R = np.roll(T_std, -1) # Use roll for periodic boundaries\n        \n        # Calculate the intercell upwind flux F* = max(v,0)*T_L + min(v,0)*T_R\n        # This is vectorized for all N interfaces.\n        flux_std = np.maximum(v0, 0) * T_L + np.minimum(v0, 0) * T_R\n        \n        # The flux at the left boundary of cell i is the flux at i-1/2,\n        # which is the rolled version of the flux at i+1/2.\n        flux_left = np.roll(flux_std, 1)\n        flux_right = flux_std\n        \n        # Apply the conservative finite-volume update\n        T_std_new = T_std - (dt / dy) * (flux_right - flux_left)\n\n        # --- Residual-plus-Remap Solver ---\n        # Step 1: Residual Riemann step.\n        # The residual velocity u = v_y - v0 = 0 in this problem.\n        # The residual flux G* = max(u,0)*T_L + min(u,0)*T_R = 0.\n        # Therefore, the field is unchanged in this step.\n        T_res_intermediate = np.copy(T0)\n\n        # Step 2: Background remap step.\n        # Apply an exact translation by distance v0*dt. This is done in Fourier space\n        # to avoid numerical diffusion.\n        \n        # The shift distance in units of grid cells (can be fractional)\n        shift_in_cells = v0 * dt / dy\n        \n        # Frequencies for the discrete Fourier transform\n        # fftfreq(N) gives frequencies in cycles per sample.\n        freqs = fftfreq(N)\n        \n        # Phase shift factor from the Fourier shift theorem\n        phase_shift = np.exp(-1j * 2 * np.pi * freqs * shift_in_cells)\n        \n        # Apply the shift in Fourier space\n        T_hat = fft(T_res_intermediate)\n        T_hat_shifted = T_hat * phase_shift\n        \n        # Transform back to real space. Take the real part, as the initial signal\n        # is real and the operation is theoretically exact.\n        T_res_new = ifft(T_hat_shifted).real\n        \n        # --- Error Calculation ---\n        # Calculate the exact solution at time dt\n        y_shifted = y - v0 * dt\n        T_exact = 1.0 + A * np.sin(2 * np.pi * k * y_shifted / L)\n        \n        # Compute the L1 error for both solvers\n        E_std = np.mean(np.abs(T_std_new - T_exact))\n        E_res = np.mean(np.abs(T_res_new - T_exact))\n        \n        # Calculate the ratio r = E_res / E_std\n        # Handle the case where E_std might be zero to avoid division by zero,\n        # although it's highly unlikely for a diffusive scheme.\n        if E_std == 0:\n            ratio = 0.0 if E_res == 0 else np.inf\n        else:\n            ratio = E_res / E_std\n            \n        results.append(ratio)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3520474"}, {"introduction": "行星会在盘中激发螺旋密度波，这些波在传播过程中携带角动量并施加力矩。最后的这个练习将深入探讨该过程的物理机制，要求你对这些波的粘性耗散进行建模，并验证全局角动量守恒[@problem_id:3520550]。这项实践将行星附近的局部波激发与盘的全局演化联系起来，这是理解行星迁移的关键环节。", "problem": "您正在为一个几何薄的、二维、等温、非自引力的开普勒盘中，由行星驱动的小振幅螺旋波所导致的角动量输运进行建模。一颗质量为 $m_{\\mathrm{p}}$ 的行星，在半径为 $r_{\\mathrm{p}}$ 的圆形轨道上运动，激发了内部和外部的螺旋波，这些波将角动量从它们各自的林德布拉德共振区带走。假设开普勒角频率为 $\\Omega(r) = r^{-3/2}$（单位设置中引力常数乘以恒星质量为1），等温声速为 $c_{\\mathrm{s}}(r) = h\\,r\\,\\Omega(r)$（其中标高比 $h$ 为常数），Shakura-Sunyaev 运动粘度为 $\\nu(r) = \\alpha\\,c_{\\mathrm{s}}(r)^2 / \\Omega(r)$（其中 $\\alpha$ 为常数）。考虑紧密缠绕的波，其方位波数为 $m$，模式频率为 $\\omega = m\\,\\Omega(r_{\\mathrm{p}})$，使得线性的、局域的惯性声波色散关系成立，即\n$$(\\omega - m\\,\\Omega(r))^2 = \\kappa(r)^2 + c_{\\mathrm{s}}(r)^2\\,k(r)^2,$$\n其中，对于开普勒盘，$\\kappa(r) = \\Omega(r)$，$k(r)$ 是沿 WKB (Wentzel-Kramers-Brillouin) 波路径的径向波数。内部和外部林德布拉德共振半径 $r_{\\mathrm{IL}}$ 和 $r_{\\mathrm{OL}}$ 由 $|\\omega - m\\,\\Omega(r_{\\mathrm{L}})| = \\kappa(r_{\\mathrm{L}})$ 隐式定义；使用开普勒恒等式证明 $r_{\\mathrm{IL}} = \\Omega_{\\mathrm{IL}}^{-2/3}$（其中 $\\Omega_{\\mathrm{IL}} = \\Omega(r_{\\mathrm{p}})/(1 - 1/m)$）以及 $r_{\\mathrm{OL}} = \\Omega_{\\mathrm{OL}}^{-2/3}$（其中 $\\Omega_{\\mathrm{OL}} = \\Omega(r_{\\mathrm{p}})/(1 + 1/m)$）。\n\n从线性化的流体方程和剪切流中正则波作用量的定义出发，从第一性原理推导出一个在存在粘性耗散的情况下，由单个 WKB 波分支所携带的径向角动量通量 $F_J(r)$ 的演化方程。您必须从波作用量守恒和粘性应力对扰动所做的功开始。证明在没有耗散的情况下，正则角动量通量 $F_J$ 沿射线是守恒的，并以局域运动粘度、径向波数和径向群速度 $c_g(r)$（定义为在固定模式频率下色散关系对波数的适当导数）来获得领先阶的粘性空间阻尼率。您的推导必须产生一个物理上可解释的表达式，将 $dF_J/dr$ 与波的局域粘性耗散联系起来，并且必须对内部和外部两个分支都有效。\n\n然后，实现一个程序，对于给定的参数和边界，执行以下步骤：\n- 对于给定的 $m$ 和 $r_{\\mathrm{p}}$，计算 $r_{\\mathrm{IL}}$ 和 $r_{\\mathrm{OL}}$。\n- 对于每个分支（内部和外部），选择一个起始半径 $r_0$，该半径稍微偏离相应的共振区，进入传播区域，具体来说，内部支为 $r_0 = r_{\\mathrm{IL}} - \\epsilon$，外部支为 $r_0 = r_{\\mathrm{OL}} + \\epsilon$，其中 $\\epsilon$ 是一个小的偏移量，使得 WKB 近似有效且 $k(r_0)^2  0$。\n- 将行星与波的耦合处理为为每个分支建立一个初始角动量通量 $F_J(r_0)$，其值分别等于一个指定的发射值 $T_{\\mathrm{launch,\\,in}}$ 和 $T_{\\mathrm{launch,\\,out}}$（无量纲力矩单位）。\n- 使用您推导出的粘性阻尼表达式，将 $F_J(r)$ 从 $r_0$ 沿射线积分到相应的域边界（内部支为 $r_{\\mathrm{in}}$，外部支为 $r_{\\mathrm{out}}$），计算以下两者：\n  1. 在 $r_{\\mathrm{in}}$ 和 $r_{\\mathrm{out}}$ 处的边界通量 $F_J$，以及\n  2. 通过沿路径对 $F_J$ 的局域耗散进行积分，计算在 $r_0$ 和边界之间沉积在盘中的累积角动量。\n- 通过检查共振区和边界之间沉积在盘中的角动量是否等于发射通量与边界通量之差，来验证每个分支的全局力矩平衡，即，对于内部和外部两个分支，恒等式\n$$\\Delta J_{\\mathrm{dep}} = T_{\\mathrm{launch}} - F_J(\\text{boundary})$$\n在指定的数值容差范围内成立。\n\n所有计算都应在与上述定义一致的无量纲代码单位中执行，因此不需要进行物理单位转换。角度（如果有的话）通过方位波数 $m$ 隐式处理；不需要角度单位。您的程序必须以适当的分辨率实现数值积分，以捕捉波的阻尼，并且必须拒绝传播条件 $k(r)^2  0$ 不成立的点。\n\n测试套件：\n为以下参数集提供结果，每个参数集指定为一个元组 $(r_{\\mathrm{p}}, m, h, \\alpha, T_{\\mathrm{launch,\\,in}}, T_{\\mathrm{launch,\\,out}}, r_{\\mathrm{in}}, r_{\\mathrm{out}}, \\epsilon, \\text{tol})$，所有量均为无量纲：\n\n1. $(1.0, 20, 0.05, 0.001, 1.0\\times 10^{-5}, 1.2\\times 10^{-5}, 0.40, 2.50, 1.0\\times 10^{-3}, 1.0\\times 10^{-9})$。\n2. $(1.0, 20, 0.05, 0.0, 1.0\\times 10^{-5}, 1.0\\times 10^{-5}, 0.50, 2.00, 1.0\\times 10^{-3}, 1.0\\times 10^{-10})$。\n3. $(1.0, 20, 0.05, 0.005, 1.0\\times 10^{-5}, 1.0\\times 10^{-5}, 0.50, 2.50, 1.0\\times 10^{-3}, 1.0\\times 10^{-9})$。\n4. $(1.0, 30, 0.05, 0.001, 8.0\\times 10^{-6}, 9.0\\times 10^{-6}, 0.70, 1.30, 5.0\\times 10^{-4}, 1.0\\times 10^{-9})$。\n5. $(1.0, 50, 0.05, 0.001, 6.0\\times 10^{-6}, 6.5\\times 10^{-6}, 0.60, 1.80, 5.0\\times 10^{-4}, 1.0\\times 10^{-9})$。\n\n对于每个测试用例，输出一个布尔值，当且仅当全局力矩平衡恒等式对于内部和外部两个分支同时在指定容差内成立时，该值为真。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[r_1,r_2,r_3,r_4,r_5]$），其中 $r_i$ 是上述定义的测试用例 $i$ 的布尔结果。", "solution": "该问题是行星-盘相互作用理论中一个表述清晰且具有科学依据的练习，这是计算天体物理学中的一个基本课题。所有给出的定义、方程和物理假设都是标准的，并且与该主题的既有文献一致。因此，该问题被认为是**有效的**，下面给出了完整的解答。\n\n我们的目标是推导由粘性盘中螺旋密度波携带的径向角动量通量 $F_J(r)$ 的演化方程，然后用这个方程来数值验证角动量守恒。\n\n推导从波作用量守恒原理开始。对于在时不变、轴对称介质中的波，在没有耗散的情况下，波作用量是守恒的。在存在耗散的情况下，其守恒定律为计算波的阻尼提供了一个直接的方法。波的角动量通量与其作用量通量成正比。\n\n令 $\\omega$ 为波在惯性系中的模式频率，$m$ 为其方位波数。在以角频率 $\\Omega(r)$ 旋转的盘中，波在局域共转流体坐标系中的频率是多普勒频移后的频率，$\\omega'(r) = \\omega - m\\,\\Omega(r)$。波作用量密度 $\\mathcal{A}$ 定义为局域流体坐标系中的波能量密度 $E'$ 除以这个局域频率：$\\mathcal{A} = E'/\\omega'$。\n\n在有耗散的稳态下，波作用量守恒由下式给出：\n$$\n\\nabla \\cdot \\vec{\\mathcal{F}}_{\\mathcal{A}} = -\\mathcal{D}_{\\mathcal{A}}\n$$\n其中 $\\vec{\\mathcal{F}}_{\\mathcal{A}} = \\vec{c}_g \\mathcal{A}$ 是波作用量通量，$\\vec{c}_g$ 是群速度，$\\mathcal{D}_{\\mathcal{A}}$ 是单位体积（或在二维盘中为单位面积）的作用量耗散率。对于一个轴对称的二维盘，这简化为：\n$$\n\\frac{1}{r} \\frac{d}{dr}(r \\, c_g(r) \\, \\mathcal{A}(r)) = -\\mathcal{D}_{\\mathcal{A}}(r)\n$$\n其中 $c_g$ 是群速度的径向分量。\n\n通过半径为 $r$ 的圆柱体的总角动量通量 $F_J(r)$ 与总能量通量 $F_E(r)$ 的关系为 $F_J = (m/\\omega) F_E$。能量通量是惯性系中波能量密度 $E$、群速度和面积 $2\\pi r$ 的乘积。能量密度 $E$ 与作用量密度 $\\mathcal{A}$ 的关系为 $E = \\omega \\mathcal{A}$。结合这些，我们找到总角动量通量和作用量密度之间的关系：\n$$\nF_J(r) = \\frac{m}{\\omega} F_E(r) = \\frac{m}{\\omega} (E \\, c_g \\, 2\\pi r) = \\frac{m}{\\omega} ((\\omega \\mathcal{A}) \\, c_g \\, 2\\pi r) = 2\\pi r m c_g(r) \\mathcal{A}(r)\n$$\n对 $F_J(r)$ 关于 $r$ 求导得到：\n$$\n\\frac{dF_J}{dr} = 2\\pi m \\frac{d}{dr}(r c_g \\mathcal{A})\n$$\n代入作用量守恒方程，我们得到：\n$$\n\\frac{dF_J}{dr} = 2\\pi m (-r \\mathcal{D}_{\\mathcal{A}})\n$$\n这个方程提供了关键的联系：角动量通量的径向变化等于波的局域耗散对盘施加的力矩。一个负的 $dF_J/dr$ 对应于对盘的一个正力矩。\n\n作用量的耗散 $\\mathcal{D}_{\\mathcal{A}}$ 源于粘性。对于小振幅波，波作用量的粘性耗散率为 $\\mathcal{D}_{\\mathcal{A}} = 2\\gamma \\mathcal{A}$，其中 $\\gamma$ 是波幅的阻尼率。对于粘性流体，在紧密缠绕极限下，这个阻尼率由 $\\gamma = \\nu k^2$ 给出，其中 $\\nu$ 是运动粘度，$k$ 是径向波数。\n因此，$\\mathcal{D}_{\\mathcal{A}}(r) = 2\\nu(r) k(r)^2 \\mathcal{A}(r)$。\n\n将此代入 $dF_J/dr$ 的方程中：\n$$\n\\frac{dF_J}{dr} = -4\\pi r m \\nu(r) k(r)^2 \\mathcal{A}(r)\n$$\n为了得到一个只含 $F_J$ 的方程，我们用它与 $F_J$ 的关系来表示 $\\mathcal{A}$：$\\mathcal{A}(r) = F_J(r) / (2\\pi r m c_g(r))$。\n$$\n\\frac{dF_J}{dr} = -4\\pi r m \\nu k^2 \\left( \\frac{F_J}{2\\pi r m c_g} \\right) = - \\frac{2\\nu(r) k(r)^2}{c_g(r)} F_J(r)\n$$\n这是一个描述波的角动量通量由于粘性阻尼而发生径向演化的一阶常微分方程。在没有耗散的情况下（$\\nu=0$），$dF_J/dr = 0$，角动量通量守恒，正如预期。\n\n为了解这个方程，我们需要从给定的物理模型中推导出系数的显式表达式。\n1.  **盘的属性**：开普勒角频率为 $\\Omega(r) = r^{-3/2}$（在 $GM_*=1$ 的单位下）。声速为 $c_s(r) = h r \\Omega(r) = h r^{-1/2}$。运动粘度为 $\\nu(r) = \\alpha c_s(r)^2 / \\Omega(r) = \\alpha (h^2 r^{-1}) / (r^{-3/2}) = \\alpha h^2 r^{1/2}$。\n\n2.  **波数 $k(r)$**：从给定的色散关系 $(\\omega - m\\Omega)^2 = \\kappa^2 + c_s^2 k^2$，其中对于开普勒盘 $\\kappa=\\Omega$，我们解出 $k^2$：\n    $$\n    k(r)^2 = \\frac{(\\omega - m\\Omega(r))^2 - \\Omega(r)^2}{c_s(r)^2}\n    $$\n    波在 $k^2  0$ 的区域传播，即在林德布拉德共振区之外。行星的模式频率为 $\\omega = m\\,\\Omega(r_{\\mathrm{p}})$。\n\n3.  **群速度 $c_g(r)$**：径向群速度通过对色散关系求导得到：$c_g = \\partial\\omega/\\partial k$。使用隐函数求导， $c_g = -(\\partial D / \\partial k) / (\\partial D / \\partial \\omega)$，其中 $D(\\omega, k, r) = (\\omega - m\\Omega)^2 - \\Omega^2 - c_s^2 k^2 = 0$。\n    $$\n    \\frac{\\partial D}{\\partial\\omega} = 2(\\omega - m\\Omega) \\quad \\text{和} \\quad \\frac{\\partial D}{\\partial k} = -2c_s^2 k\n    $$\n    这得到 $c_g(r) = \\frac{c_s(r)^2 k(r)}{\\omega - m\\Omega(r)}$。$c_g$ 的符号正确地指示了外部波的向外传播（$\\omega  m\\Omega$）和内部波的向内传播（$\\omega  m\\Omega$）。\n\n结合这些，常微分方程中的阻尼项可以表示为：\n$$\n\\frac{dF_J}{dr} = - \\left( \\frac{2\\nu k^2}{c_s^2 k / (\\omega - m\\Omega)} \\right) F_J = - \\frac{2\\nu(r) |k(r)| (\\omega - m\\Omega(r))}{c_s(r)^2} \\text{sgn}(k) F_J(r)\n$$\n其中 $|k| = \\sqrt{k^2}$。项 $\\text{sgn}(k)$ 可以通过注意到 $\\omega - m\\Omega$ 对每个分支都有正确的符号而被吸收。项 $k/c_g = k^2 (\\omega-m\\Omega)/c_s^2 k^2 = (\\omega-m\\Omega)/c_s^2$。于是常微分方程为：\n$$\n\\frac{dF_J}{dr} = - \\frac{2\\nu k^2 (\\omega-m\\Omega)}{c_s^2} F_J\n$$\n这种形式避免了关于 $k(r)$ 符号的模糊性。\n\n为了执行所需的验证，我们数值积分这个常微分方程。在发射半径 $r_0$ 和边界 $r_b$ 之间沉积到盘中的总角动量是 $\\Delta J_{\\mathrm{dep}} = \\int_{r_0}^{r_b} (-\\frac{dF_J}{dr'}) dr'$。根据微积分基本定理，这等于 $F_J(r_0) - F_J(r_b)$。问题要求我们数值验证这个恒等式。我们可以建立一个由两个常微分方程组成的系统：一个用于 $F_J(r)$，另一个用于累积沉积的动量 $\\Delta J_{\\mathrm{dep}}(r) = \\int_{r_0}^r (-dF_J/dr')dr'$。\n令 $y_0(r) = F_J(r)$ 和 $y_1(r) = \\Delta J_{\\mathrm{dep}}(r)$。该系统为：\n$$\n\\frac{dy_0}{dr} = - \\frac{2\\nu k^2}{c_g} y_0(r)\n$$\n$$\n\\frac{dy_1}{dr} = -\\frac{dy_0}{dr} = \\frac{2\\nu k^2}{c_g} y_0(r)\n$$\n初始条件为 $y_0(r_0) = T_{\\mathrm{launch}}$ 和 $y_1(r_0) = 0$。从 $r_0$ 积分到 $r_b$ 后，我们检查 $|y_1(r_b) - (T_{\\mathrm{launch}} - y_0(r_b))|$ 是否在指定的容差 `tol` 范围内。这证实了所推导物理模型的数值积分的自洽性。", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main solver function to process test cases for planet-disk interaction.\n    \"\"\"\n    test_cases = [\n        (1.0, 20, 0.05, 0.001, 1.0e-5, 1.2e-5, 0.40, 2.50, 1.0e-3, 1.0e-9),\n        (1.0, 20, 0.05, 0.0, 1.0e-5, 1.0e-5, 0.50, 2.00, 1.0e-3, 1.0e-10),\n        (1.0, 20, 0.05, 0.005, 1.0e-5, 1.0e-5, 0.50, 2.50, 1.0e-3, 1.0e-9),\n        (1.0, 30, 0.05, 0.001, 8.0e-6, 9.0e-6, 0.70, 1.30, 5.0e-4, 1.0e-9),\n        (1.0, 50, 0.05, 0.001, 6.0e-6, 6.5e-6, 0.60, 1.80, 5.0e-4, 1.0e-9),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation_for_case(case)\n        results.append(result)\n\n    # Format the final output as a comma-separated list of booleans in a string.\n    print(f\"[{','.join(map(str, [r.title() for r in results]))}]\")\n\ndef run_simulation_for_case(case):\n    \"\"\"\n    Runs the simulation for a single test case and verifies torque balance.\n    \"\"\"\n    rp, m, h, alpha, T_launch_in, T_launch_out, r_in, r_out, epsilon, tol = case\n\n    # Keplerian angular frequency (GM_* = 1)\n    Omega = lambda r: r**(-1.5)\n    # Sound speed\n    cs = lambda r: h * r * Omega(r)\n    # Kinematic viscosity\n    nu = lambda r: alpha * cs(r)**2 / Omega(r) if alpha > 0.0 else 0.0\n\n    Omega_p = Omega(rp)\n    omega_pattern = m * Omega_p\n\n    # Lindblad resonance locations\n    # Omega_IL = omega_pattern / (m - 1) is unstable for m=1, but m>=2 here.\n    Omega_IL = omega_pattern / (m - 1)\n    r_IL = Omega_IL**(-2.0/3.0)\n\n    Omega_OL = omega_pattern / (m + 1)\n    r_OL = Omega_OL**(-2.0/3.0)\n\n    def ode_system(r, y, is_outer_branch):\n        \"\"\"\n        Defines the system of ODEs for flux and deposited angular momentum.\n        y[0] = F_J (Angular momentum flux)\n        y[1] = Delta J_dep (Deposited angular momentum)\n        \"\"\"\n        F_J = y[0]\n        \n        # If viscosity is zero, there's no damping.\n        if alpha == 0.0:\n            return [0.0, 0.0]\n\n        Om_r = Omega(r)\n        cs_r = cs(r)\n        nu_r = nu(r)\n\n        # Wavenumber squared\n        doppler_shifted_freq = omega_pattern - m * Om_r\n        k_sq = (doppler_shifted_freq**2 - Om_r**2) / cs_r**2\n\n        # Propagation condition\n        if k_sq = 0:\n            return [0.0, 0.0]\n\n        # RHS of the ODE for F_J: dF_J/dr = - (2 * nu * k^2 / cg) * F_J\n        # Using the more numerically robust form derived in the solution:\n        # dF_J/dr =  - (2 * nu * k^2 * (omega - m*Omega) / cs^2) * F_J.\n        \n        dF_J_dr_coeff = - (2.0 * nu_r * k_sq * doppler_shifted_freq) / (cs_r**2)\n        dF_J_dr = dF_J_dr_coeff * F_J\n        \n        # d(Delta J)/dr = -dF_J/dr\n        dDelta_J_dr = -dF_J_dr\n\n        return [dF_J_dr, dDelta_J_dr]\n\n    # --- Inner Branch Simulation ---\n    r0_in = r_IL - epsilon\n    rb_in = r_in\n    y0_in = [T_launch_in, 0.0]\n    sol_in = solve_ivp(\n        lambda r, y: ode_system(r, y, is_outer_branch=False),\n        (r0_in, rb_in),\n        y0_in,\n        method='RK45',\n        rtol=1e-13,\n        atol=1e-13,\n    )\n    F_J_final_in = sol_in.y[0, -1]\n    Delta_J_dep_in = sol_in.y[1, -1]\n    \n    balance_check_in = abs(Delta_J_dep_in - (T_launch_in - F_J_final_in))  tol\n\n    # --- Outer Branch Simulation ---\n    r0_out = r_OL + epsilon\n    rb_out = r_out\n    y0_out = [T_launch_out, 0.0]\n    sol_out = solve_ivp(\n        lambda r, y: ode_system(r, y, is_outer_branch=True),\n        (r0_out, rb_out),\n        y0_out,\n        method='RK45',\n        rtol=1e-13,\n        atol=1e-13,\n    )\n    F_J_final_out = sol_out.y[0, -1]\n    Delta_J_dep_out = sol_out.y[1, -1]\n    \n    balance_check_out = abs(Delta_J_dep_out - (T_launch_out - F_J_final_out))  tol\n\n    return str(balance_check_in and balance_check_out).lower()\n\nsolve()\n```", "id": "3520550"}]}