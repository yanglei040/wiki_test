{"hands_on_practices": [{"introduction": "理想磁流体动力学（MHD）的动量方程包含了描述磁场与等离子体相互作用的洛伦兹力项。为了深入理解这一相互作用，将洛伦兹力分解为磁压力梯度和磁张力是至关重要的。本练习通过一个理想化的弯曲磁通管场景，旨在隔离并阐明磁张力的物理效应，揭示磁力线弯曲如何产生一种试图将其拉直的力，这对于理解磁约束聚变和太阳日冕环等现象至关重要。[@problem_id:3539089]", "problem": "在由理想磁流体力学（MHD）描述的静态、理想导电天体物理等离子体中，考虑一个细的、非扭曲的磁通量管，其轴线遵循一条曲率半径为常数 $R$ 的空间曲线。管内的磁场沿管轴的大小恒为 $B$，且处处与轴线相切。管的横截面积沿其长度是均匀的，且磁场是无散的。假设气体压力梯度和外力可忽略不计，并在国际单位制（SI）下使用磁导率 $\\mu_{0}$ 进行计算。\n\n仅使用基本电磁定律和核心定义，从洛伦兹力密度和无散约束出发，推导磁场对管内等离子体施加的单位体积力。将最终的力密度表示为关于 $B$、$\\mu_{0}$、$R$ 和管轴曲线的向内单位法向量 $\\hat{n}$ 的单一闭式解析向量表达式。然后，通过将其与理想磁流体力学动量方程中的磁张力贡献联系起来，解释你的结果。\n\n请以国际单位制单位提供你的最终表达式。无需进行数值计算。", "solution": "该问题要求在理想磁流体力学（MHD）的假设下，推导弯曲磁通量管内等离子体所受的磁力密度。\n\n首先，我们对问题陈述进行验证。\n已知条件如下：\n- 一个静态（$\\mathbf{v} = 0$，$\\partial/\\partial t = 0$）、由理想磁流体力学（MHD）描述的理想导电等离子体。\n- 一根细的、非扭曲的磁通量管，其轴线是曲率半径为常数 $R$ 的曲线。\n- 管内的磁场 $\\mathbf{B}$ 大小恒为 $B$，且处处与管轴相切。\n- 管的横截面积是均匀的。\n- 磁场是无散的：$\\nabla \\cdot \\mathbf{B} = 0$。\n- 气体压力梯度（$\\nabla P$）和外力（例如，重力）可忽略不计。\n- 推导必须从洛伦兹力密度 $\\mathbf{f} = \\mathbf{J} \\times \\mathbf{B}$ 和无散约束开始。\n- 力密度的最终表达式必须用 $B$、$\\mu_0$、$R$ 和向内单位法向量 $\\hat{n}$ 表示。\n\n该问题在科学上基于磁流体力学和电磁学原理。该设置描述了一个标准的、尽管是理想化的物理系统，用于说明磁张力的概念。所有术语都定义明确。该问题是自洽的，不包含任何不可克服的矛盾，只要在处理此类理想化问题的标准框架内解释给定的条件。具体来说，在弯曲管内磁场大小 $B$ 恒定的假设，与纯环向/方位角场几何结构（这是所描述的磁通量管的合适模型）的无散约束是一致的。因此，该问题被认为是有效的。\n\n我们从作用在等离子体上的单位体积洛伦兹力 $\\mathbf{f}$ 开始推导：\n$$\n\\mathbf{f} = \\mathbf{J} \\times \\mathbf{B}\n$$\n其中 $\\mathbf{J}$ 是电流密度，$\\mathbf{B}$ 是磁场向量。\n\n在静态或准静态等离子体中，安培定律（忽略对于理想磁流体力学而言是合适的位移电流）将电流密度与磁场的旋度联系起来：\n$$\n\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}\n$$\n其中 $\\mu_0$ 是自由空间的磁导率。我们可以将 $\\mathbf{J}$ 用 $\\mathbf{B}$ 表示为 $\\mathbf{J} = \\frac{1}{\\mu_0}(\\nabla \\times \\mathbf{B})$。将此代入洛伦兹力方程，得到完全用磁场表示的力密度：\n$$\n\\mathbf{f} = \\frac{1}{\\mu_0} (\\nabla \\times \\mathbf{B}) \\times \\mathbf{B}\n$$\n为了分析这个表达式，我们使用一个标准的向量微积分恒等式：\n$$\n(\\nabla \\times \\mathbf{A}) \\times \\mathbf{A} = (\\mathbf{A} \\cdot \\nabla)\\mathbf{A} - \\frac{1}{2}\\nabla(A^2)\n$$\n将此恒等式应用于我们的力表达式，令 $\\mathbf{A} = \\mathbf{B}$，我们得到：\n$$\n\\mathbf{f} = \\frac{1}{\\mu_0} \\left[ (\\mathbf{B} \\cdot \\nabla)\\mathbf{B} - \\nabla\\left(\\frac{B^2}{2}\\right) \\right]\n$$\n该方程将磁力密度分解为两个不同的物理分量：\n$$\n\\mathbf{f} = \\underbrace{\\frac{1}{\\mu_0}(\\mathbf{B} \\cdot \\nabla)\\mathbf{B}}_{\\text{磁张力}} - \\underbrace{\\nabla\\left(\\frac{B^2}{2\\mu_0}\\right)}_{\\text{磁压力梯度}}\n$$\n我们现在根据问题中给出的具体条件分析每一项。\n\n磁压力梯度项为 $-\\nabla(P_m)$，其中 $P_m = \\frac{B^2}{2\\mu_0}$ 是磁压力。问题指出管内磁场大小 $B$ 恒定。如果标量大小 $B=|\\mathbf{B}|$ 在管体积内处处恒定，那么磁压力 $P_m$ 也恒定。常数的梯度为零。因此，磁压力梯度项为零：\n$$\n\\nabla\\left(\\frac{B^2}{2\\mu_0}\\right) = 0\n$$\n这使得磁张力项成为力的唯一来源。\n\n磁张力项为 $\\mathbf{f}_T = \\frac{1}{\\mu_0}(\\mathbf{B} \\cdot \\nabla)\\mathbf{B}$。算子 $(\\mathbf{B} \\cdot \\nabla)$ 表示沿磁场向量 $\\mathbf{B}$ 方向的方向导数。问题指定场处处与管轴相切且大小恒为 $B$。因此我们可以写出 $\\mathbf{B} = B\\hat{s}$，其中 $\\hat{s}$ 是与轴线曲线相切的单位向量。方向导数算子变为 $B(\\hat{s} \\cdot \\nabla)$，这等价于 $B \\frac{d}{ds}$，其中 $s$ 是沿轴线的弧长。于是张力为：\n$$\n\\mathbf{f} = \\mathbf{f}_T = \\frac{1}{\\mu_0} \\left( B \\frac{d}{ds} \\right) (B\\hat{s})\n$$\n由于 $B$ 是常数标量，可以从导数中提出：\n$$\n\\mathbf{f} = \\frac{B^2}{\\mu_0} \\frac{d\\hat{s}}{ds}\n$$\n根据微分几何中的 Frenet-Serret 公式，切向单位向量 $\\hat{s}$ 对弧长 $s$ 的导数由下式给出：\n$$\n\\frac{d\\hat{s}}{ds} = \\kappa \\hat{n}\n$$\n其中 $\\kappa$ 是曲线的曲率，$\\hat{n}$ 是主法向量，指向曲率中心。问题定义了恒定的曲率半径为 $R$，它与曲率的关系为 $\\kappa = 1/R$。向量 $\\hat{n}$ 被指定为“向内单位法向量”。将这些代入我们的表达式中得到：\n$$\n\\frac{d\\hat{s}}{ds} = \\frac{1}{R} \\hat{n}\n$$\n最后，将此结果代回力密度的表达式，得到最终结果：\n$$\n\\mathbf{f} = \\frac{B^2}{\\mu_0 R} \\hat{n}\n$$\n这是磁场施加在等离子体上的单位体积力。\n\n为了解释，理想磁流体力学动量方程为 $\\rho \\frac{D\\mathbf{v}}{Dt} = -\\nabla P + \\mathbf{J} \\times \\mathbf{B} + \\mathbf{F}_{ext}$。问题要求计算洛伦兹力项 $\\mathbf{J} \\times \\mathbf{B}$。我们的结果表明，对于大小恒定的弯曲磁场，该力指向曲率中心，且完全由磁张力引起。$B^2/\\mu_0$ 这一项的作用是沿磁力线的单位面积张力。由于磁力线是弯曲的，这种张力产生了一个净向内力，类似于试图拉直一根拉紧的弯曲绳子的力。问题的简化假设（静态等离子体，可忽略的气体压力）意味着，在一个更完整的模型中，这种张力需要被其他力（如指向曲率中心之外的气体压力梯度）所平衡，以维持静态平衡。问题中使用的“无散约束”在此设置下是满足的，因为在环形几何中纯方位角场（$\\mathbf{B} = B \\hat{\\phi}$ 且 $B$ 恒定）是无散的，这确认了前提的自洽性。", "answer": "$$\n\\boxed{\\frac{B^2}{\\mu_0 R} \\hat{n}}\n$$", "id": "3539089"}, {"introduction": "在磁化等离子体中，信息不是瞬时传播的，而是通过一组独特的波（即MHD波）来传递。理解这些波的传播速度，即特征速度，对于分析MHD系统的时间演化和设计稳定的数值模拟方案至关重要。本练习要求您通过线性化理想MHD方程来推导这些波的色散关系，并计算在一个给定物理状态下的七个特征波速，从而为构建黎曼求解器和确定CFL条件下的稳定时间步长提供理论基础。[@problem_id:3539067]", "problem": "考虑理想磁流体动力学（MHD）方程组，在亥维赛-洛伦兹单位制下（磁导率设为1），该方程组由质量连续性方程、包含磁力（洛伦兹力）的动量方程、包含理想欧姆定律的感应方程以及无散约束组成。一个均匀、同性的平衡态由常数背景场 $\\rho_{0}$、$p_{0}$、$\\mathbf{v}_{0}$ 和 $\\mathbf{B}_{0}$ 以及比热比为 $\\gamma$ 的绝热状态方程给出。无散约束 $\\nabla \\cdot \\mathbf{B} = 0$ 在初始时是满足的。\n\n将理想MHD方程组在此均匀平衡态附近进行线性化，并假设沿给定单位方向 $\\hat{\\mathbf{n}}$ 传播的平面波微扰正比于 $\\exp\\left[i\\left(k\\,\\hat{\\mathbf{n}}\\cdot\\mathbf{x} - \\omega t\\right)\\right]$。仅使用基本方程和无散约束，推导线性波的色散关系，从而得到在实验室参考系中沿 $\\hat{\\mathbf{n}}$ 方向的特征相速度：被平流的熵模速度 $v_{n}$、阿尔芬速度 $v_{n} \\pm c_{A,n}$，以及快磁声波速度 $v_{n} \\pm c_{f}$ 和慢磁声波速度 $v_{n} \\pm c_{s}$（其中 $c_{f} \\ge c_{s} \\ge 0$）。此处 $v_{n} \\equiv \\mathbf{v}_{0}\\cdot\\hat{\\mathbf{n}}$，$c_{A,n} \\equiv |\\mathbf{B}_{0}\\cdot\\hat{\\mathbf{n}}|/\\sqrt{\\rho_{0}}$，且 $a \\equiv \\sqrt{\\gamma p_{0}/\\rho_{0}}$ 为绝热声速。您必须明确展示无散约束如何在线性化演化过程中得以保持，以及它如何约束微扰。\n\n然后，对于特定的均匀状态\n- $\\rho_{0} = 1$,\n- $p_{0} = 1$,\n- $\\gamma = \\dfrac{5}{3}$,\n- $\\mathbf{v}_{0} = (0.3,\\,-0.2,\\,0.4)$,\n- $\\mathbf{B}_{0} = (1,\\,2,\\,2)$,\n- $\\hat{\\mathbf{n}} = (0,\\,0,\\,1)$,\n\n计算按以下规范顺序排列的七个特征速度\n$$v_{n} - c_{f},\\quad v_{n} - c_{A,n},\\quad v_{n} - c_{s},\\quad v_{n},\\quad v_{n} + c_{s},\\quad v_{n} + c_{A,n},\\quad v_{n} + c_{f}.$$\n\n将所有速度表示为无量纲代码单位下的纯数，并将每个数值四舍五入到 $6$ 位有效数字。以指定顺序将您的最终数值结果表示为单个行向量。最终的方框答案中不应包含任何单位。", "solution": "该问题要求推导理想磁流体动力学（MHD）中线性波的色散关系，并随后计算特定物理状态下的特征波速。此过程始于验证问题陈述，经确认，该问题陈述在科学上是合理的、适定的且完整的。\n\n亥维赛-洛伦兹单位制下的理想MHD方程组为：\n1.  质量连续性：$\\dfrac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\mathbf{v}) = 0$\n2.  动量：$\\rho \\left( \\dfrac{\\partial \\mathbf{v}}{\\partial t} + (\\mathbf{v} \\cdot \\nabla) \\mathbf{v} \\right) = -\\nabla p + (\\nabla \\times \\mathbf{B}) \\times \\mathbf{B}$\n3.  感应：$\\dfrac{\\partial \\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{v} \\times \\mathbf{B})$\n4.  无散约束：$\\nabla \\cdot \\mathbf{B} = 0$\n5.  绝热状态方程：$\\dfrac{d}{dt}\\left(\\dfrac{p}{\\rho^\\gamma}\\right) = 0$，其中 $\\dfrac{d}{dt} = \\dfrac{\\partial}{\\partial t} + \\mathbf{v} \\cdot \\nabla$\n\n我们在由常数 $\\rho_0$、$p_0$、$\\mathbf{v}_0$ 和 $\\mathbf{B}_0$ 定义的均匀平衡态附近对这些方程进行线性化。我们引入小微扰：\n$\\rho = \\rho_0 + \\delta\\rho$，$p = p_0 + \\delta p$，$\\mathbf{v} = \\mathbf{v}_0 + \\delta\\mathbf{v}$，$\\mathbf{B} = \\mathbf{B}_0 + \\delta\\mathbf{B}$。\n将这些代入MHD方程组并仅保留微扰的一阶项，我们得到线性化方程组：\n1.  $\\dfrac{\\partial \\delta\\rho}{\\partial t} + \\mathbf{v}_0 \\cdot \\nabla \\delta\\rho + \\rho_0 \\nabla \\cdot \\delta\\mathbf{v} = 0$\n2.  $\\rho_0 \\left( \\dfrac{\\partial \\delta\\mathbf{v}}{\\partial t} + (\\mathbf{v}_0 \\cdot \\nabla) \\delta\\mathbf{v} \\right) = -\\nabla \\delta p + (\\nabla \\times \\delta\\mathbf{B}) \\times \\mathbf{B}_0$\n3.  $\\dfrac{\\partial \\delta\\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{v}_0 \\times \\delta\\mathbf{B} + \\delta\\mathbf{v} \\times \\mathbf{B}_0)$\n4.  $\\nabla \\cdot \\delta\\mathbf{B} = 0$ (因为 $\\nabla \\cdot \\mathbf{B}_0 = 0$)\n5.  $\\left(\\dfrac{\\partial}{\\partial t} + \\mathbf{v}_0 \\cdot \\nabla\\right) (\\delta p - a^2 \\delta\\rho) = 0$，其中 $a^2 = \\gamma p_0 / \\rho_0$ 是绝热声速的平方。\n\n我们假设微扰的平面波解形式为 $\\delta f \\propto \\exp[i(\\mathbf{k} \\cdot \\mathbf{x} - \\omega t)]$，其中 $\\mathbf{k} = k\\hat{\\mathbf{n}}$。这将微分算子转换为 $\\dfrac{\\partial}{\\partial t} \\to -i\\omega$ 和 $\\nabla \\to i\\mathbf{k}$。\n线性化方程组变为一个代数方程组：\n1.  $-i\\omega \\delta\\rho + i(\\mathbf{k} \\cdot \\mathbf{v}_0) \\delta\\rho + i\\rho_0 (\\mathbf{k} \\cdot \\delta\\mathbf{v}) = 0$\n2.  $-i\\omega\\rho_0\\delta\\mathbf{v} + i\\rho_0(\\mathbf{k} \\cdot \\mathbf{v}_0)\\delta\\mathbf{v} = -i\\mathbf{k}\\delta p + (i\\mathbf{k} \\times \\delta\\mathbf{B}) \\times \\mathbf{B}_0$\n3.  $-i\\omega\\delta\\mathbf{B} = i\\mathbf{k} \\times (\\mathbf{v}_0 \\times \\delta\\mathbf{B} + \\delta\\mathbf{v} \\times \\mathbf{B}_0)$\n4.  $i\\mathbf{k} \\cdot \\delta\\mathbf{B} = 0$\n5.  $(-i\\omega + i\\mathbf{k}\\cdot\\mathbf{v}_0)(\\delta p - a^2 \\delta\\rho) = 0$\n\n让我们定义在等离子体参考系中的多普勒频移频率，$\\omega' = \\omega - \\mathbf{k} \\cdot \\mathbf{v}_0$。方程组简化为：\n1.  $-\\omega' \\delta\\rho + \\rho_0 (\\mathbf{k} \\cdot \\delta\\mathbf{v}) = 0$\n2.  $-\\omega'\\rho_0\\delta\\mathbf{v} = -\\mathbf{k}\\delta p + (\\mathbf{k} \\times \\delta\\mathbf{B}) \\times \\mathbf{B}_0$\n3.  $-\\omega'\\delta\\mathbf{B} = \\mathbf{k} \\times (\\delta\\mathbf{v} \\times \\mathbf{B}_0)$\n4.  $\\mathbf{k} \\cdot \\delta\\mathbf{B} = 0$\n5.  $\\omega'(\\delta p - a^2 \\delta\\rho) = 0$\n\n无散约束 $\\nabla \\cdot \\mathbf{B} = 0$ 在动力学过程中是守恒的。对感应方程取散度可得 $\\dfrac{\\partial (\\nabla \\cdot \\mathbf{B})}{\\partial t} = \\nabla \\cdot (\\nabla \\times \\mathbf{Q}) = 0$，其中 $\\mathbf{Q} = \\mathbf{v} \\times \\mathbf{B}$。因此，若在 $t=0$ 时 $\\nabla \\cdot \\mathbf{B} = 0$，则它在所有时间都保持为零。在傅里叶空间中，这意味着 $\\mathbf{k} \\cdot \\delta\\mathbf{B} = 0$，即磁场微扰完全垂直于波的传播方向。这个约束被线性化的感应方程自动满足：将方程（3）与 $\\mathbf{k}$ 做点积可得 $-\\omega'(\\mathbf{k} \\cdot \\delta\\mathbf{B}) = \\mathbf{k} \\cdot (\\mathbf{k} \\times (\\delta\\mathbf{v} \\times \\mathbf{B}_0)) = 0$。\n\n从方程（5）中，我们得到两族解：\n-   若 $\\omega' \\neq 0$，则 $\\delta p = a^2 \\delta\\rho$。这些是声波和磁波模式。\n-   若 $\\omega' = 0$，则 $\\omega = \\mathbf{k} \\cdot \\mathbf{v}_0$。这给出的相速度为 $\\omega/k = \\mathbf{v}_0 \\cdot \\hat{\\mathbf{n}} = v_n$。这是熵模，对应于随流体流动的密度微扰，其中 $\\delta\\mathbf{v}=0$, $\\delta\\mathbf{B}=0$, $\\delta p=0$。\n\n对于 $\\omega'\\neq 0$ 的模式，我们求解该方程组。为方便起见，选择一个坐标系，其中 $\\mathbf{k} = (0,0,k)$ 且 $\\mathbf{B}_0$ 位于x-z平面内，$\\mathbf{B}_0 = (B_{0x}, 0, B_{0z})$。约束 $\\mathbf{k} \\cdot \\delta\\mathbf{B}=0$ 意味着 $\\delta B_z = 0$。$\\delta\\mathbf{v}$ 和 $\\delta\\mathbf{B}$ 各分量的方程解耦。\n\ny分量方程产生不可压缩横波，即阿尔芬波：\n$$(\\omega'^2 - k^2 c_{A,n}^2) \\delta v_y = 0$$\n其中 $c_{A,n} = |\\mathbf{B}_0 \\cdot \\hat{\\mathbf{k}}|/\\sqrt{\\rho_0}$ 是阿尔芬速度沿传播方向的分量。色散关系为 $\\omega' = \\pm k c_{A,n}$。在实验室参考系中的相速度为 $v_{ph} = \\omega/k = v_n \\pm c_{A,n}$。\n\nx和z分量是耦合的，描述了可压缩磁声波。一个关于 $(\\delta v_x, \\delta v_z)$ 的 $2 \\times 2$ 方程组导出了快磁声波和慢磁声波模式的色散关系。定义流体参考系中的相速度 $V = \\omega'/k$，我们得到一个关于 $V^2$ 的二次方程：\n$$V^4 - (a^2 + c_A^2)V^2 + a^2 c_{A,n}^2 = 0$$\n其中 $c_A^2 = |\\mathbf{B}_0|^2/\\rho_0$ 是总阿尔芬速度的平方。$V^2$ 的解是快磁声波速度的平方（$c_f^2$）和慢磁声波速度的平方（$c_s^2$）：\n$$c_{f,s}^2 = \\frac{1}{2} \\left[ (a^2 + c_A^2) \\pm \\sqrt{(a^2+c_A^2)^2 - 4 a^2 c_{A,n}^2} \\right]$$\n快模对应于‘+’号，慢模对应于‘-’号，这确保了 $c_f \\ge c_s \\ge 0$。实验室参考系中的相速度为 $v_{ph} = v_n \\pm c_f$ 和 $v_n \\pm c_s$。\n\n总之，沿 $\\hat{\\mathbf{n}}$ 方向的七个特征波速为：\n1.  熵模：$v_n$\n2.  阿尔芬模：$v_n \\pm c_{A,n}$\n3.  慢磁声波模：$v_n \\pm c_s$\n4.  快磁声波模：$v_n \\pm c_f$\n\n现在我们为给定的数值计算这些速度：\n-   $\\rho_{0} = 1$\n-   $p_{0} = 1$\n-   $\\gamma = \\dfrac{5}{3}$\n-   $\\mathbf{v}_{0} = (0.3, -0.2, 0.4)$\n-   $\\mathbf{B}_{0} = (1, 2, 2)$\n-   $\\hat{\\mathbf{n}} = (0, 0, 1)$\n\n首先，我们计算所需的物理参数：\n-   沿 $\\hat{\\mathbf{n}}$ 的平流速度：$v_n = \\mathbf{v}_0 \\cdot \\hat{\\mathbf{n}} = (0.3)(0) + (-0.2)(0) + (0.4)(1) = 0.4$。\n-   声速的平方：$a^2 = \\dfrac{\\gamma p_0}{\\rho_0} = \\dfrac{(5/3)(1)}{1} = \\dfrac{5}{3}$。\n-   总阿尔芬速度的平方：$|\\mathbf{B}_0|^2 = 1^2+2^2+2^2 = 9$。所以，$c_A^2 = \\dfrac{|\\mathbf{B}_0|^2}{\\rho_0} = \\dfrac{9}{1} = 9$。\n-   沿 $\\hat{\\mathbf{n}}$ 投影的阿尔芬速度的平方：$\\mathbf{B}_0 \\cdot \\hat{\\mathbf{n}} = (1)(0) + (2)(0) + (2)(1) = 2$。所以，$c_{A,n}^2 = \\dfrac{(\\mathbf{B}_0 \\cdot \\hat{\\mathbf{n}})^2}{\\rho_0} = \\dfrac{2^2}{1} = 4$。\n-   由此，投影的阿尔芬速度为 $c_{A,n} = \\sqrt{4} = 2$。\n\n接下来，我们计算快、慢磁声波速度 $c_f$ 和 $c_s$：\n$$c_{f,s}^2 = \\frac{1}{2} \\left[ \\left(\\frac{5}{3} + 9\\right) \\pm \\sqrt{\\left(\\frac{5}{3}+9\\right)^2 - 4\\left(\\frac{5}{3}\\right)(4)} \\right]$$\n$$c_{f,s}^2 = \\frac{1}{2} \\left[ \\frac{32}{3} \\pm \\sqrt{\\left(\\frac{32}{3}\\right)^2 - \\frac{80}{3}} \\right] = \\frac{1}{2} \\left[ \\frac{32}{3} \\pm \\sqrt{\\frac{1024}{9} - \\frac{240}{9}} \\right]$$\n$$c_{f,s}^2 = \\frac{1}{2} \\left[ \\frac{32}{3} \\pm \\sqrt{\\frac{784}{9}} \\right] = \\frac{1}{2} \\left[ \\frac{32}{3} \\pm \\frac{28}{3} \\right]$$\n-   快模速度的平方：$c_f^2 = \\dfrac{1}{2}\\left(\\dfrac{32+28}{3}\\right) = \\dfrac{1}{2}\\left(\\dfrac{60}{3}\\right) = 10$。所以，$c_f = \\sqrt{10}$。\n-   慢模速度的平方：$c_s^2 = \\dfrac{1}{2}\\left(\\dfrac{32-28}{3}\\right) = \\dfrac{1}{2}\\left(\\dfrac{4}{3}\\right) = \\dfrac{2}{3}$。所以，$c_s = \\sqrt{\\dfrac{2}{3}}$。\n\n最后，我们计算实验室参考系中的七个特征速度，并四舍五入到6位有效数字：\n-   $v_{n} - c_{f} = 0.4 - \\sqrt{10} \\approx 0.4 - 3.16227766 = -2.76227766 \\approx -2.76228$\n-   $v_{n} - c_{A,n} = 0.4 - 2 = -1.60000$\n-   $v_{n} - c_{s} = 0.4 - \\sqrt{2/3} \\approx 0.4 - 0.81649658 = -0.41649658 \\approx -0.416497$\n-   $v_{n} = 0.400000$\n-   $v_{n} + c_{s} = 0.4 + \\sqrt{2/3} \\approx 0.4 + 0.81649658 = 1.21649658 \\approx 1.21650$\n-   $v_{n} + c_{A,n} = 0.4 + 2 = 2.40000$\n-   $v_{n} + c_{f} = 0.4 + \\sqrt{10} \\approx 0.4 + 3.16227766 = 3.56227766 \\approx 3.56228$\n\n计算出的速度按指定的规范顺序以行向量形式呈现。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-2.76228  -1.60000  -0.416497  0.400000  1.21650  2.40000  3.56228\n\\end{pmatrix}\n}\n$$", "id": "3539067"}, {"introduction": "在数值求解MHD方程时，维持磁场的无散约束（$\\nabla \\cdot \\mathbf{B} = 0$）是确保模拟结果物理真实性和数值稳定性的核心挑战之一。违反此约束会导致非物理性的“磁单极子”伪力的产生。本练习将指导您在天体物理学中常见应用的轴对称柱坐标系下，推导并实现一种能够精确维持离散无散条件的先进数值技术——约束输运（Constrained Transport, CT）方法，从而亲身体验构建稳健MHD代码的核心环节。[@problem_id:3539071]", "problem": "您的任务是推导并实现理想磁流体力学 (MHD) 磁感应子系统的、在轴对称柱坐标系下的、考虑度规的约束输运 (CT) 更新方法。您的实现必须是守恒的，即它能够精确地保持磁场无散约束的离散表示，达到机器精度，即使在柱坐标轴附近也是如此。所涉及的物理学是理想磁流体力学 (MHD)，其感应方程由 Maxwell–Faraday 定律和理想 Ohm 定律推导得出。您的推导必须严格从基本定律开始：适用于理想导电流体的 Maxwell–Faraday 定律和理想 Ohm 定律。\n\n出发点和模型假设：\n- 基本的 Maxwell–Faraday 定律为 $\\partial \\mathbf{B}/\\partial t = - \\nabla \\times \\mathbf{E}$，理想 Ohm 定律为 $\\mathbf{E} = - \\mathbf{v} \\times \\mathbf{B}$，其中 $\\mathbf{B}$ 是磁场，$\\mathbf{E}$ 是电场，$\\mathbf{v}$ 是流体速度。\n- 使用轴对称的柱坐标系 $(r,\\phi,z)$，即 $\\partial/\\partial\\phi = 0$。\n- 仅限于更新 $B_r$ 和 $B_z$ 的极向感应子系统，此更新通过 $E_\\phi$ 实现；您可以保持环向分量 $B_\\phi$ 不变，且无需更新质量、动量或能量。\n- 需要保持的离散散度算子是 $\\mathbf{B}$ 在轴对称柱坐标系下的散度：$\\nabla\\cdot\\mathbf{B} = \\frac{1}{r}\\frac{\\partial}{\\partial r}(r B_r) + \\frac{\\partial B_z}{\\partial z}$。\n\n您的任务：\n- 从 Maxwell–Faraday 定律和理想 Ohm 定律出发，在均匀的 $(r,z)$ 网格上，针对轴对称情况，推导面心磁场分量 $B_r$ 和 $B_z$ 的半离散、考虑度规的 CT 更新方程。您必须用位于边心的 $E_\\phi$ 来表示更新方程，并展示柱坐标度规因子如何进入更新方程。\n- 推导一个相容的、面心的离散散度算子，该算子在径向面上使用 $r B_r$，在轴向面上使用 $B_z$，并证明 CT 更新在假定 $z$ 方向为周期性边界条件且在 $r=0$ 处满足正则性条件的情况下，能够精确地（在舍入误差范围内）保持此离散散度。\n- 实现一个程序，该程序：\n  - 构建一个均匀网格，在 $r \\in [0,R]$ 区间有 $N_r$ 个单元，在 $z \\in [0,Z]$ 区间有 $N_z$ 个单元。\n  - 将 $B_r$ 存储在径向面 $(r_{i+1/2}, z_j)$ 上，将 $B_z$ 存储在轴向面 $(r_i, z_{j+1/2})$ 上，其中单元中心的索引为 $i \\in \\{0,\\dots,N_r-1\\}$ 和 $j \\in \\{0,\\dots,N_z-1\\}$，面的索引范围依此确定。此处 $r_i = (i+1/2)\\Delta r$，$z_j = (j+1/2)\\Delta z$，且 $\\Delta r = R/N_r$，$\\Delta z = Z/N_z$。径向面位于 $r_{i+1/2} = i \\Delta r$，$i \\in \\{0,\\dots,N_r\\}$；轴向面位于 $z_{j+1/2} = j \\Delta z$，$j \\in \\{0,\\dots,N_z\\}$。\n  - 初始化 $B_r=0$ 和 $B_z=B_0$（常数）。\n  - 给定一个不随时间变化的速度场，该速度场具有刚体旋转和一个光滑的、在轴上正则的径向流入/流出：\n    - $v_\\phi(r,z) = \\Omega\\, r$，\n    - $v_r(r,z) = a\\, r \\cos\\!\\big(2\\pi z/Z\\big)$，\n    - $v_z(r,z) = 0$。\n  - 根据理想 Ohm 定律，使用当前的 $\\mathbf{B}$ 和给定的 $\\mathbf{v}$，在轴对称条件下计算位于单元角点 $(r_{i+1/2}, z_{j+1/2})$ 的边心 $E_\\phi$。您必须使用 $E_\\phi = -(\\mathbf{v} \\times \\mathbf{B})_\\phi = - (v_r B_z - v_z B_r)$，由于 $v_z=0$，该式可简化为 $E_\\phi = - v_r B_z$。\n  - 使用您推导的考虑度规的更新方程，将 $B_r$ 和 $B_z$ 推进一个或多个 CT 时间步。在 $z$ 方向使用周期性边界条件。在柱坐标轴 $r=0$ 处，通过 $B_r(r=0,\\cdot)=0$ 来强制施加正则性条件。在径向外边界 $r=R$ 处，可使用相同的 CT 公式进行更新（无需额外的流入/流出处理）。\n  - 使用基于极向流的 Courant–Friedrichs–Lewy (CFL) 条件计算时间步长：$\\Delta t = C_{\\mathrm{cfl}} \\min(\\Delta r,\\Delta z)/\\max(|v_r|+|v_z|)$，该值在网格上计算。如果分母的最大值为零，则设置 $\\Delta t = C_{\\mathrm{cfl}} \\min(\\Delta r,\\Delta z)$。\n  - 在指定的步数后，使用与度规一致的算子计算所有单元中心的离散散度的最大绝对值：\n    $$D_{i,j} = \\frac{1}{r_i}\\,\\frac{r_{i+1/2} B_{r,i+1/2,j} - r_{i-1/2} B_{r,i-1/2,j}}{\\Delta r} \\;+\\; \\frac{B_{z,i,j+1/2} - B_{z,i,j-1/2}}{\\Delta z}.$$\n  - 将此最大绝对离散散度报告为一个浮点数。\n\n数值单位：\n- 全过程使用无量纲单位。所有报告的量都必须是无量纲的。\n\n角度单位：\n- 任何关于 $z$ 的三角函数都必须使用弧度。\n\n测试套件：\n实现您的程序以执行以下测试用例，并按下面指定的格式将结果汇总到单行输出。对于每个用例，运行方案 $N_{\\mathrm{steps}}$ 步，并报告最终的最大绝对离散散度。\n\n- 用例 1（顺利路径）：\n  - $N_r = 32$, $N_z = 32$, $R = 1$, $Z = 1$, $B_0 = 1$, $a = 0.5$, $\\Omega = 3$, $C_{\\mathrm{cfl}} = 0.4$, $N_{\\mathrm{steps}} = 10$。\n- 用例 2（近轴和强剪切）：\n  - $N_r = 8$, $N_z = 16$, $R = 0.25$, $Z = 1$, $B_0 = 0.7$, $a = 4.0$, $\\Omega = 10$, $C_{\\mathrm{cfl}} = 0.2$, $N_{\\mathrm{steps}} = 20$。\n- 用例 3（纯旋转，无极向流）：\n  - $N_r = 16$, $N_z = 16$, $R = 1$, $Z = 1$, $B_0 = 2.0$, $a = 0.0$, $\\Omega = 5.0$, $C_{\\mathrm{cfl}} = 0.4$, $N_{\\mathrm{steps}} = 5$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的三个浮点数结果按上述用例的顺序排列（例如，$[r_1,r_2,r_3]$）。每个条目都必须是一个浮点数。输出必须是单行，不含任何附加文本。\n\n科学真实性和约束条件：\n- 确保您的推导仅以 Maxwell–Faraday 定律和理想 Ohm 定律为起点。不要假定任何未从这些原理推导出的专用 MHD 公式。\n- 确保您的实现尊重柱坐标度规因子和轴的正则性，并在 $z$ 方向使用周期性边界条件。", "solution": "用户要求在轴对称柱坐标系下，推导并实现一个针对极向磁场分量的、考虑度规的约束输运 (CT) 更新方法。推导必须从基本原理出发，实现必须在数值上保持磁场的无散条件。\n\n### 第 1 部分：半离散感应方程的推导\n\n问题始于电磁学的两个基本定律：Maxwell-Faraday 定律和适用于理想导电流体的理想 Ohm 定律。\n\n1.  **Maxwell-Faraday 定律**:\n    $$ \\frac{\\partial \\mathbf{B}}{\\partial t} = - \\nabla \\times \\mathbf{E} $$\n    其中 $\\mathbf{B}$ 是磁场矢量，$\\mathbf{E}$ 是电场矢量。\n\n2.  **理想 Ohm 定律**:\n    $$ \\mathbf{E} = - \\mathbf{v} \\times \\mathbf{B} $$\n    其中 $\\mathbf{v}$ 是流体速度。\n\n将理想 Ohm 定律代入 Maxwell-Faraday 定律，得到理想感应方程：\n$$ \\frac{\\partial \\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{v} \\times \\mathbf{B}) $$\n问题设定在柱坐标系 $(r, \\phi, z)$ 中，并假设轴对称，这意味着所有关于方位角 $\\phi$ 的偏导数均为零，即 $\\frac{\\partial}{\\partial \\phi} = 0$。\n\n柱坐标系中的旋度算子由下式给出：\n$$ \\nabla \\times \\mathbf{A} = \\left( \\frac{1}{r}\\frac{\\partial A_z}{\\partial \\phi} - \\frac{\\partial A_\\phi}{\\partial z} \\right) \\hat{\\mathbf{r}} + \\left( \\frac{\\partial A_r}{\\partial z} - \\frac{\\partial A_z}{\\partial r} \\right) \\hat{\\mathbf{\\phi}} + \\frac{1}{r} \\left( \\frac{\\partial (r A_\\phi)}{\\partial r} - \\frac{\\partial A_r}{\\partial \\phi} \\right) \\hat{\\mathbf{z}} $$\n应用轴对称性（$\\frac{\\partial}{\\partial \\phi} = 0$），旋度简化为：\n$$ \\nabla \\times \\mathbf{A} = - \\frac{\\partial A_\\phi}{\\partial z} \\hat{\\mathbf{r}} + \\left( \\frac{\\partial A_r}{\\partial z} - \\frac{\\partial A_z}{\\partial r} \\right) \\hat{\\mathbf{\\phi}} + \\frac{1}{r} \\frac{\\partial (r A_\\phi)}{\\partial r} \\hat{\\mathbf{z}} $$\n问题将分析限制在极向感应子系统，该子系统控制极向磁场分量 $B_r$ 和 $B_z$ 的演化。此演化由电场的环向分量 $E_\\phi$ 驱动。根据轴对称条件下的 Faraday 定律，极向磁场分量的时间导数为：\n$$ \\frac{\\partial B_r}{\\partial t} = (-\\nabla \\times \\mathbf{E})_r = - \\left( -\\frac{\\partial E_\\phi}{\\partial z} \\right) = \\frac{\\partial E_\\phi}{\\partial z} $$\n$$ \\frac{\\partial B_z}{\\partial t} = (-\\nabla \\times \\mathbf{E})_z = - \\left( \\frac{1}{r} \\frac{\\partial (r E_\\phi)}{\\partial r} \\right) = -\\frac{1}{r} \\frac{\\partial (r E_\\phi)}{\\partial r} $$\n环向电场 $E_\\phi$ 由理想 Ohm 定律的 $\\hat{\\mathbf{\\phi}}$ 分量给出：\n$$ E_\\phi = (-\\mathbf{v} \\times \\mathbf{B})_\\phi = -(v_r B_z - v_z B_r) = v_z B_r - v_r B_z $$\n这两个偏微分方程构成了需要进行数值求解的半离散系统。\n\n### 第 2 部分：离散化与约束输运更新\n\n我们在单元宽度为 $\\Delta r$ 和 $\\Delta z$ 的均匀网格上对区域进行离散化。遵循约束输运 (CT) 方法，磁场分量是交错排列的：\n-   $B_r$ 位于径向面，位置为 $(r_{i+1/2}, z_j)$。\n-   $B_z$ 位于轴向面，位置为 $(r_i, z_{j+1/2})$。\n-   $E_\\phi$ 位于单元角点，或在 $r-z$ 平面中的“边”，位置为 $(r_{i+1/2}, z_{j+1/2})$。\n\n这里，$r_i$ 和 $z_j$ 表示单元中心位置，而 $r_{i+1/2}$ 和 $z_{j+1/2}$ 表示面/边位置。网格定义如下：\n-   径向单元中心：$r_i = (i+1/2)\\Delta r$，对于 $i=0, \\dots, N_r-1$。\n-   径向面：$r_{i+1/2} = (i+1)\\Delta r$，对于 $i=-1, \\dots, N_r-1$。问题陈述使用了一种略有不同的索引约定；我们将其映射到标准的有限体积索引。我们定义径向面 $r_f[i] = i \\Delta r$，对于 $i=0, \\dots, N_r$。单元 $i$ 位于 $r_f[i]$ 和 $r_f[i+1]$ 之间。\n-   轴向面和中心也以类似方式定义。\n\n现在，我们使用简单的前向欧拉时间积分步骤，为半离散方程编写有限差分近似。\n\n$B_r$ 的更新，在 $(r_{i+1/2}, z_j)$ 处离散化：\n$$ \\frac{B_{r, i+1/2, j}^{n+1} - B_{r, i+1/2, j}^{n}}{\\Delta t} = \\frac{E_{\\phi, i+1/2, j+1/2}^{n} - E_{\\phi, i+1/2, j-1/2}^{n}}{\\Delta z} $$\n$$ \\implies B_{r, i+1/2, j}^{n+1} = B_{r, i+1/2, j}^{n} + \\frac{\\Delta t}{\\Delta z} (E_{\\phi, i+1/2, j+1/2}^{n} - E_{\\phi, i+1/2, j-1/2}^{n}) $$\n\n$B_z$ 的更新，在 $(r_i, z_{j+1/2})$ 处离散化：\n$$ \\frac{B_{z, i, j+1/2}^{n+1} - B_{z, i, j+1/2}^{n}}{\\Delta t} = - \\frac{1}{r_i} \\left( \\frac{r_{i+1/2} E_{\\phi, i+1/2, j+1/2}^{n} - r_{i-1/2} E_{\\phi, i-1/2, j+1/2}^{n}}{\\Delta r} \\right) $$\n$$ \\implies B_{z, i, j+1/2}^{n+1} = B_{z, i, j+1/2}^{n} - \\frac{\\Delta t}{r_i \\Delta r} (r_{i+1/2} E_{\\phi, i+1/2, j+1/2}^{n} - r_{i-1/2} E_{\\phi, i-1/2, j+1/2}^{n}) $$\n这些就是考虑度规的 CT 更新方程。几何度规因子 ($r$) 已明确包含在内。\n\n### 第 3 部分：离散散度的守恒\n\nCT 方法的显著特点是它能够将无散条件 $\\nabla \\cdot \\mathbf{B} = 0$ 保持到机器精度。$\\mathbf{B}$ 的轴对称散度为：\n$$ \\nabla \\cdot \\mathbf{B} = \\frac{1}{r} \\frac{\\partial (r B_r)}{\\partial r} + \\frac{\\partial B_z}{\\partial z} $$\n在单元中心 $(i, j)$ 处的一个相容的、面心的离散散度算子在问题陈述中给出：\n$$ D_{i,j} = \\frac{1}{r_i \\Delta r} (r_{i+1/2} B_{r, i+1/2, j} - r_{i-1/2} B_{r, i-1/2, j}) + \\frac{1}{\\Delta z} (B_{z, i, j+1/2} - B_{z, i, j-1/2}) $$\n为证明 CT 更新保持此离散散度守恒，我们考察 $D_{i,j}$ 在一个时间步长内的变化，$D_{i,j}^{n+1} - D_{i,j}^{n}$。我们记 $\\delta B = B^{n+1} - B^n$。\n$$ D_{i,j}^{n+1} - D_{i,j}^{n} = \\frac{1}{r_i \\Delta r} (r_{i+1/2} \\delta B_{r, i+1/2, j} - r_{i-1/2} \\delta B_{r, i-1/2, j}) + \\frac{1}{\\Delta z} (\\delta B_{z, i, j+1/2} - \\delta B_{z, i, j-1/2}) $$\n将更新方程中的 $\\delta B$ 表达式代入：\n$$ \\delta B_{r, i+1/2, j} = \\frac{\\Delta t}{\\Delta z} (E_{\\phi, i+1/2, j+1/2} - E_{\\phi, i+1/2, j-1/2}) $$\n$$ \\delta B_{z, i, j+1/2} = - \\frac{\\Delta t}{r_i \\Delta r} (r_{i+1/2} E_{\\phi, i+1/2, j+1/2} - r_{i-1/2} E_{\\phi, i-1/2, j+1/2}) $$\n将这些代入散度变化方程并除以 $\\Delta t$：\n\\begin{align*}\n\\frac{D_{i,j}^{n+1} - D_{i,j}^{n}}{\\Delta t} =  \\frac{1}{r_i \\Delta r} \\left[ r_{i+1/2} \\frac{E_{\\phi, i+1/2, j+1/2} - E_{\\phi, i+1/2, j-1/2}}{\\Delta z} - r_{i-1/2} \\frac{E_{\\phi, i-1/2, j+1/2} - E_{\\phi, i-1/2, j-1/2}}{\\Delta z} \\right] \\\\\n + \\frac{1}{\\Delta z} \\left[ - \\frac{1}{r_i \\Delta r} (r_{i+1/2} E_{\\phi, i+1/2, j+1/2} - r_{i-1/2} E_{\\phi, i-1/2, j+1/2}) \\right. \\\\\n \\left. - \\left( - \\frac{1}{r_i \\Delta r} (r_{i+1/2} E_{\\phi, i+1/2, j-1/2} - r_{i-1/2} E_{\\phi, i-1/2, j-1/2}) \\right) \\right]\n\\end{align*}\n将整个方程乘以 $r_i \\Delta r \\Delta z$ 可简化表达式：\n\\begin{align*}\n\\text{第 1 项 (来自 } B_r\\text{): }  (r_{i+1/2} E_{\\phi, i+1/2, j+1/2} - r_{i+1/2} E_{\\phi, i+1/2, j-1/2}) - (r_{i-1/2} E_{\\phi, i-1/2, j+1/2} - r_{i-1/2} E_{\\phi, i-1/2, j-1/2}) \\\\\n\\text{第 2 项 (来自 } B_z\\text{): }  -(r_{i+1/2} E_{\\phi, i+1/2, j+1/2} - r_{i-1/2} E_{\\phi, i-1/2, j+1/2}) + (r_{i+1/2} E_{\\phi, i+1/2, j-1/2} - r_{i-1/2} E_{\\phi, i-1/2, j-1/2})\n\\end{align*}\n将这两项相加，我们观察到每一项都恰好抵消了：\n$$ (+r_{i+1/2}E_{\\dots,j+1/2}) + (-r_{i+1/2}E_{\\dots,j+1/2}) = 0 $$\n$$ (-r_{i+1/2}E_{\\dots,j-1/2}) + (+r_{i+1/2}E_{\\dots,j-1/2}) = 0 $$\n$$ (-r_{i-1/2}E_{\\dots,j+1/2}) + (+r_{i-1/2}E_{\\dots,j+1/2}) = 0 $$\n$$ (+r_{i-1/2}E_{\\dots,j-1/2}) + (-r_{i-1/2}E_{\\dots,j-1/2}) = 0 $$\n和恒为零。这证明了 $D_{i,j}^{n+1} - D_{i,j}^{n} = 0$，意味着离散散度在每个单元和每个时间步都保持守恒，达到机器精度。只要更新公式和散度算子被正确地构造以处理坐标奇点，这个性质即使在坐标轴上（$i=0$）也成立，而它们确实是这样构造的。对于坐标轴上的单元，项 $r_{i-1/2}$ 变为零，而 $1/r_i$ 因子也得到了正确处理。具体来说，在 $r \\to 0$ 时，如果 $A(0)=0$，我们有 $\\frac{1}{r}\\frac{\\partial(rA)}{\\partial r} \\to 2\\frac{\\partial A}{\\partial r}$。我们在 $i=0$ 处用于 $B_z$ 更新的有限差分模板正确地逼近了这个极限。\n\n### 第 4 部分：实现策略\n\n程序将实现所推导的 CT 方案。\n1.  **网格和场**：为 $B_r$、$B_z$ 和 $E_\\phi$ 设置交错网格数组，要特别注意与面和单元中心相对应的数组维度。\n2.  **初始和边界条件**：初始化 $B_r=0$ 和 $B_z=B_0$。强制施加轴条件 $B_r(r=0)=0$。通过确保 $z=Z$ 边界上的量与 $z=0$ 处的量匹配来处理 $z$ 方向的周期性。\n3.  **时间循环**：对于每个时间步：\n    a.  根据网格上的最大极向速度，由 CFL 条件计算时间步长 $\\Delta t$。\n    b.  在单元角点计算电场 $E_\\phi = v_z B_r - v_r B_z$。由于 $v_z=0$，该式简化为 $E_\\phi = -v_r B_z$。这需要将定义在 $r$-单元中心的 $B_z$ 插值到需要 $E_\\phi$ 的 $r$-面上。一个简单的线性平均就足够了。在坐标轴 $r=0$ 处，$v_r=0$，因此 $E_\\phi(0,z)=0$。\n    c.  使用推导出的 CT 更新公式在时间上推进 $B_r$ 和 $B_z$。需要特别注意坐标轴上的更新。\n4.  **散度计算**：在指定的步数后，使用考虑度规的公式计算所有单元中心的离散散度 $D_{i,j}$。对于一般情况（$i>0$）和坐标轴上的特殊情况（$i=0$），该公式都必须仔细实现。\n5.  **输出**：报告整个网格上计算出的散度的最大绝对值。对于纯旋转的情况（$a=0$），此时 $E_\\phi=0$，场不应演化，初始的零散度应保持到机器精度。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the metric-aware constrained transport problem.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (happy path)\n        {'Nr': 32, 'Nz': 32, 'R': 1.0, 'Z': 1.0, 'B0': 1.0, 'a': 0.5, 'Omega': 3.0, 'C_cfl': 0.4, 'N_steps': 10},\n        # Case 2 (axis proximity and strong shear)\n        {'Nr': 8, 'Nz': 16, 'R': 0.25, 'Z': 1.0, 'B0': 0.7, 'a': 4.0, 'Omega': 10.0, 'C_cfl': 0.2, 'N_steps': 20},\n        # Case 3 (pure rotation, no poloidal flow)\n        {'Nr': 16, 'Nz': 16, 'R': 1.0, 'Z': 1.0, 'B0': 2.0, 'a': 0.0, 'Omega': 5.0, 'C_cfl': 0.4, 'N_steps': 5},\n    ]\n\n    results = []\n    for params in test_cases:\n        result = _solve_case(**params)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef _solve_case(Nr, Nz, R, Z, B0, a, Omega, C_cfl, N_steps):\n    \"\"\"\n    Solves a single instance of the axisymmetric ideal MHD induction problem.\n    \"\"\"\n    # Grid setup\n    dr = R / Nr\n    dz = Z / Nz\n    \n    # r_f: radial face locations. Size Nr+1. r_f[i] is at i*dr.\n    r_f = np.linspace(0.0, R, Nr + 1)\n    # z_f: axial face locations. Size Nz+1. z_f[j] is at j*dz.\n    z_f = np.linspace(0.0, Z, Nz + 1)\n    \n    # r_c: radial cell-center locations. Size Nr. r_c[i] is at (i+0.5)*dr.\n    r_c = (r_f[:-1] + r_f[1:]) / 2.0\n    # z_c: axial cell-center locations. Size Nz. z_c[j] is at (j+0.5)*dz.\n    z_c = (z_f[:-1] + z_f[1:]) / 2.0\n\n    # Field initialization\n    # Br is on radial faces (r_f) and z-cell-centers (z_c)\n    Br = np.zeros((Nr + 1, Nz))\n    # Bz is on r-cell-centers (r_c) and axial faces (z_f)\n    Bz = np.full((Nr, Nz + 1), B0)\n\n    # Main time loop\n    for _ in range(N_steps):\n        # CFL condition\n        # Evaluate vr at cell centers to find max velocity for a stable timestep\n        if a != 0:\n            vr_on_cells = a * r_c[:, None] * np.cos(2.0 * np.pi * z_c[None, :] / Z)\n            v_max = np.max(np.abs(vr_on_cells))\n        else:\n            v_max = 0.0\n        \n        min_dx = min(dr, dz)\n        if v_max > 1e-12: # Avoid division by zero\n            dt = C_cfl * min_dx / v_max\n        else:\n            dt = C_cfl * min_dx\n        \n        # --- Calculate E_phi at corners (r_f, z_f) ---\n        Ephi = np.zeros((Nr + 1, Nz + 1))\n        \n        # E_phi = v_z * B_r - v_r * B_z. With v_z=0, E_phi = -v_r * B_z\n        # E_phi is zero on the axis (r=0) because v_r(r=0)=0. Ephi[0, :] is already 0.\n        \n        # To compute Ephi at (r_f, z_f), we need B_z there.\n        # Bz is at (r_c, z_f). We interpolate Bz from r_c to r_f.\n        Bz_on_rf = np.zeros((Nr, Nz + 1))\n        # Linear interpolation for interior r-faces\n        Bz_on_rf[:-1, :] = 0.5 * (Bz[:-1, :] + Bz[1:, :])\n        # Extrapolation for outer boundary r-face (r=R)\n        Bz_on_rf[-1, :] = Bz[-1, :]\n\n        # Calculate v_r at corners r_f[1:], z_f\n        vr_corners = a * r_f[1:, None] * np.cos(2.0 * np.pi * z_f[None, :] / Z)\n        \n        # Calculate Ephi for r > 0 from Ohm's Law\n        Ephi[1:, :] = -vr_corners * Bz_on_rf\n\n        # --- Update B fields (Constrained Transport method) ---\n        Br_new = Br.copy()\n        Bz_new = Bz.copy()\n        \n        # Update Br (at r_f[i], z_c[j])\n        # Br[0, :] remains 0 due to axis regularity and Ephi[0,:]=0. We update Br[1:,:].\n        E_z_diff = Ephi[1:, 1:] - Ephi[1:, :-1]\n        Br_new[1:, :] += (dt / dz) * E_z_diff\n        \n        # Update Bz (at r_c[i], z_f[j])\n        # For i=0 (axis): a special form derived from limit r->0\n        Bz_new[0, :] -= (2.0 * dt / dr) * Ephi[1, :]\n        \n        # For i > 0 (off-axis)\n        if Nr > 1:\n            rE_r_diff = r_f[2:, None] * Ephi[2:, :] - r_f[1:-1, None] * Ephi[1:-1, :]\n            Bz_new[1:, :] -= (dt / dr) * (1.0 / r_c[1:, None]) * rE_r_diff\n        \n        Br, Bz = Br_new, Bz_new\n    \n    # After loop, compute divergence at cell centers (r_c, z_c)\n    divB = np.zeros((Nr, Nz))\n\n    # r-component of divergence: (1/r) * d/dr (r * Br)\n    # Off-axis part (i > 0)\n    if Nr > 1:\n        rBr_diff = r_f[2:, None] * Br[2:, :] - r_f[1:-1, None] * Br[1:-1, :]\n        divB[1:, :] = (1.0 / (r_c[1:, None] * dr)) * rBr_diff\n    \n    # Axis part (i = 0)\n    rBr_diff_axis = r_f[1] * Br[1, :] - r_f[0] * Br[0, :]\n    divB[0, :] = (1.0 / (r_c[0] * dr)) * rBr_diff_axis\n\n    # z-component of divergence: d/dz (Bz)\n    divB += (1.0 / dz) * (Bz[:, 1:] - Bz[:, :-1])\n    \n    max_abs_divB = np.max(np.abs(divB))\n    \n    return max_abs_divB\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3539071"}]}