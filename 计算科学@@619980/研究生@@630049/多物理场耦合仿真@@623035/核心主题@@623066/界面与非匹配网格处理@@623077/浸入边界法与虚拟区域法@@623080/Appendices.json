{"hands_on_practices": [{"introduction": "在浸入式边界法中，计算弹性力是其核心基石之一。本练习将引导您从第一性原理出发，基于一个连续介质膜的弹性势能泛函 $W[X]$，推导其所产生的力 [@problem_id:3510183]。通过应用变分法计算力密度（即能量的负泛函导数 $F(s) = - \\delta W/\\delta X(s)$），您将能深刻理解势能这一物理概念如何与模拟中所需的具体数学表达式建立联系。", "problem": "考虑一个由连续可微映射 $X : \\Gamma \\to \\mathbb{R}^{d}$ 表示的细长闭合弹性膜，其中 $\\Gamma$ 是一个一维流形，由具有周期性识别的拉格朗日物质坐标 $s \\in [0,L)$ 参数化，且 $d \\in \\{2,3\\}$。在用于多物理场耦合模拟的沉浸边界（IB）方法和虚拟区域（FD）方法中，膜施加于周围流体的弹性力是通过膜能量对构型 $X(s)$ 的负变分导数得到的。假设该膜具有本构表面能\n$$\nW[X] \\;=\\; \\int_{\\Gamma} \\frac{k_s}{2}\\,\\big(|\\partial_s X(s)| - 1\\big)^{2}\\, ds,\n$$\n其中 $k_s>0$ 是一个恒定的材料刚度，$|\\partial_s X|$ 表示切向量 $\\partial_s X$ 的欧几里得范数，并且参考构型对应于单位拉伸。仅使用变分法和连续介质力学的第一性原理，推导弹性张力，并计算由 $F(s) = - \\delta W/\\delta X(s)$ 定义的单位参考长度上的弹性力 $F(s)$，用 $X(s)$ 及其导数显式表示。假设膜是闭合且足够光滑的，因此在分部积分下，边界项由于周期性而消失。将最终答案表示为包含 $X$ 和 $s$ 的单个闭式解析表达式。不需要进行数值近似；最终表达式中不要包含物理单位。", "solution": "问题陈述经评估是有效的。它在连续介质力学和变分法方面有科学依据，是适定的、客观的，并包含获得唯一解所需的所有信息。因此，我们可以进行推导。\n\n单位参考长度上的弹性力 $F(s)$ 定义为势能泛函 $W[X]$ 相对于膜构型 $X(s)$ 的负变分导数：\n$$\nF(s) = -\\frac{\\delta W}{\\delta X(s)}\n$$\n变分导数 $\\frac{\\delta W}{\\delta X(s)}$ 由一阶变分 $\\delta W$ 定义，其中 $\\phi(s)$ 是 $\\Gamma$ 上的任意虚位移，它是一个光滑的周期性向量场：\n$$\n\\delta W = \\int_{\\Gamma} \\frac{\\delta W}{\\delta X(s)} \\cdot \\phi(s) \\, ds\n$$\n我们的目标是从给定的能量泛函计算 $\\delta W$，然后使用分部积分来分离出对应于 $\\frac{\\delta W}{\\delta X(s)}$ 的项。\n\n能量泛函由下式给出：\n$$\nW[X] = \\int_{\\Gamma} \\frac{k_s}{2}\\,\\big(|\\partial_s X(s)| - 1\\big)^{2}\\, ds\n$$\n一阶变分是 $W$ 在 $\\phi(s)$ 方向上的 Gâteaux 导数：\n$$\n\\delta W = \\left. \\frac{d}{d\\epsilon} W[X + \\epsilon \\phi] \\right|_{\\epsilon=0}\n$$\n其中 $\\epsilon$ 是一个小的标量参数。我们将 $X + \\epsilon \\phi$ 代入能量泛函：\n$$\nW[X + \\epsilon \\phi] = \\int_{\\Gamma} \\frac{k_s}{2} \\left( |\\partial_s (X(s) + \\epsilon \\phi(s))| - 1 \\right)^2 \\, ds = \\int_{\\Gamma} \\frac{k_s}{2} \\left( |\\partial_s X + \\epsilon \\partial_s \\phi| - 1 \\right)^2 \\, ds\n$$\n为了继续，我们对小 $\\epsilon$ 的项 $|\\partial_s X + \\epsilon \\partial_s \\phi|$ 进行泰勒展开。其范数的平方为：\n$$\n|\\partial_s X + \\epsilon \\partial_s \\phi|^2 = (\\partial_s X + \\epsilon \\partial_s \\phi) \\cdot (\\partial_s X + \\epsilon \\partial_s \\phi) = |\\partial_s X|^2 + 2\\epsilon (\\partial_s X \\cdot \\partial_s \\phi) + O(\\epsilon^2)\n$$\n取平方根并对小的 $z$ 使用展开式 $\\sqrt{1+z} \\approx 1 + z/2$：\n$$\n|\\partial_s X + \\epsilon \\partial_s \\phi| = \\left( |\\partial_s X|^2 + 2\\epsilon (\\partial_s X \\cdot \\partial_s \\phi) + O(\\epsilon^2) \\right)^{1/2}\n$$\n$$\n= |\\partial_s X| \\left( 1 + 2\\epsilon \\frac{\\partial_s X \\cdot \\partial_s \\phi}{|\\partial_s X|^2} + O(\\epsilon^2) \\right)^{1/2} \\approx |\\partial_s X| \\left( 1 + \\epsilon \\frac{\\partial_s X \\cdot \\partial_s \\phi}{|\\partial_s X|^2} \\right)\n$$\n$$\n= |\\partial_s X| + \\epsilon \\frac{\\partial_s X}{|\\partial_s X|} \\cdot \\partial_s \\phi\n$$\n让我们定义局部拉伸比 $\\lambda(s) = |\\partial_s X(s)|$ 和单位切向量 $\\tau(s) = \\frac{\\partial_s X(s)}{|\\partial_s X(s)|}$。展开式变为：\n$$\n|\\partial_s X + \\epsilon \\partial_s \\phi| \\approx \\lambda(s) + \\epsilon (\\tau(s) \\cdot \\partial_s \\phi(s))\n$$\n将此代回到 $W[X+\\epsilon\\phi]$ 的被积函数中：\n$$\n\\frac{k_s}{2} \\left( (\\lambda(s) + \\epsilon (\\tau(s) \\cdot \\partial_s \\phi(s))) - 1 \\right)^2 = \\frac{k_s}{2} \\left( (\\lambda(s) - 1) + \\epsilon(\\tau(s) \\cdot \\partial_s \\phi(s)) \\right)^2\n$$\n展开此式并只保留 $\\epsilon$ 的一阶项：\n$$\n= \\frac{k_s}{2} \\left( (\\lambda(s) - 1)^2 + 2\\epsilon(\\lambda(s) - 1)(\\tau(s) \\cdot \\partial_s \\phi(s)) + O(\\epsilon^2) \\right)\n$$\n对此表达式积分得到 $W[X+\\epsilon\\phi]$。一阶变分 $\\delta W$ 是与 $\\epsilon$ 成正比的项的积分：\n$$\n\\delta W = \\int_{\\Gamma} k_s (\\lambda(s) - 1) (\\tau(s) \\cdot \\partial_s \\phi(s)) \\, ds\n$$\n项 $T(s) = k_s(\\lambda(s) - 1) = k_s(|\\partial_s X(s)| - 1)$ 是膜中弹性张力的标量大小。对于拉伸（$\\lambda > 1$）它为正，对于压缩（$\\lambda  1$）它为负。张力向量由 $\\mathbf{T}(s) = T(s)\\tau(s)$ 给出。使用此式，变分可以写为：\n$$\n\\delta W = \\int_{\\Gamma} \\mathbf{T}(s) \\cdot \\partial_s \\phi(s) \\, ds\n$$\n为了确定变分导数，我们必须使用分部积分将导数 $\\partial_s$ 从测试函数 $\\phi(s)$ 移到另一项 $\\mathbf{T}(s)$ 上。对于所有函数都是周期性的闭合曲线，边界项消失：\n$$\n\\int_{\\Gamma} \\mathbf{T}(s) \\cdot (\\partial_s \\phi(s)) \\, ds = \\left[ \\mathbf{T}(s) \\cdot \\phi(s) \\right]_0^L - \\int_{\\Gamma} (\\partial_s \\mathbf{T}(s)) \\cdot \\phi(s) \\, ds = - \\int_{\\Gamma} (\\partial_s \\mathbf{T}(s)) \\cdot \\phi(s) \\, ds\n$$\n因此，我们有：\n$$\n\\delta W = - \\int_{\\Gamma} (\\partial_s \\mathbf{T}(s)) \\cdot \\phi(s) \\, ds\n$$\n将此与定义 $\\delta W = \\int_{\\Gamma} \\frac{\\delta W}{\\delta X(s)} \\cdot \\phi(s) \\, ds$ 相比较，我们确定变分导数为：\n$$\n\\frac{\\delta W}{\\delta X(s)} = -\\partial_s \\mathbf{T}(s) = -\\frac{\\partial}{\\partial s} \\left( T(s) \\tau(s) \\right)\n$$\n因此，膜所施加的弹性力密度为：\n$$\nF(s) = - \\frac{\\delta W}{\\delta X(s)} = - \\left(-\\partial_s \\mathbf{T}(s) \\right) = \\partial_s \\mathbf{T}(s)\n$$\n这个结果与连续介质力学一致，其中作用在材料元上的净内力是应力张量的散度。在这种一维情况下，这简化为张力向量的导数。\n\n代入张力大小 $T(s)$ 和切向量 $\\tau(s)$ 的显式表达式，我们得到单位参考长度上的力的最终表达式：\n$$\nF(s) = \\frac{\\partial}{\\partial s} \\left( k_s \\left( |\\partial_s X(s)| - 1 \\right) \\frac{\\partial_s X(s)}{|\\partial_s X(s)|} \\right)\n$$\n这个表达式也可以写成：\n$$\nF(s) = \\frac{\\partial}{\\partial s} \\left( k_s \\left( 1 - \\frac{1}{|\\partial_s X(s)|} \\right) \\partial_s X(s) \\right)\n$$\n这是用膜构型 $X(s)$ 及其导数表示的弹性力密度的完整解析表达式。", "answer": "$$\n\\boxed{\\frac{\\partial}{\\partial s} \\left( k_s \\left( |\\partial_s X(s)| - 1 \\right) \\frac{\\partial_s X(s)}{|\\partial_s X(s)|} \\right)}\n$$", "id": "3510183"}, {"introduction": "将连续介质理论转化为计算实践，需要对控制方程进行离散化。本练习聚焦于如何从一个离散的弯曲能量泛函 $W$ 中，推导出梁结构上产生的离散弹性力 $F_i$ [@problem_id:3510125]。通过应用虚功原理，即 $F_i = -\\frac{\\partial W}{\\partial X_i}$，本练习对于理解如何构建浸入式边界模拟中的力计算模块至关重要，并揭示了离散力模板是如何从力学原理中自然产生的。", "problem": "考虑一个弹性梁，由一维拉格朗日物质点链表示，其位置为 $\\{X_i\\}_{i\\in \\mathbb{Z}}$，其中每个 $X_i \\in \\mathbb{R}^d$，且 $d \\in \\{2,3\\}$。该结构通过浸入边界法（Immersed Boundary (IB) method）与周围流体耦合，其中结构力密度由一个弹性能量泛函得到。假设离散化梁的弯曲能由下式给出\n$$\nW = \\sum_{i} \\frac{\\kappa}{2} \\left\\|X_{i+1}-2X_i+X_{i-1}\\right\\|^{2},\n$$\n其中弯曲刚度 $\\kappa0$。假设链是无限的或周期性的，因此内部模板适用而无需边界修正。\n\n从虚功原理出发，即节点 $i$ 处的拉格朗日力是能量关于 $X_i$ 的负变分导数，即 $F_i = -\\frac{\\partial W}{\\partial X_i}$，推导组装后的离散力 $F_i$ 的闭式表达式，该表达式仅用位置 $X_{i-2}, X_{i-1}, X_i, X_{i+1}, X_{i+2}$ 和参数 $\\kappa$ 表示。你的最终答案必须是 $F_i$ 的单个解析表达式。不得包含任何边值项。提供适用于浸入边界耦合中的表达式，作为要分布到流体中的拉格朗日力。", "solution": "该问题陈述已经过验证，被认为是具有科学依据、适定、客观和自洽的。它代表了从势能泛函构建离散弹性力的一个标准问题，常见于像浸入边界（IB）框架这样的计算方法中。推导过程如下。\n\n该问题要求从给定的弯曲能泛函 $W$ 推导第 $i$ 个物质点上的拉格朗日力 $F_i$。保守力与势能之间的关系由虚功原理给出，该原理指出力是势能相对于位置坐标的负梯度。对于物质点 $i$，这表示为：\n$$\nF_i = -\\frac{\\partial W}{\\partial X_i}\n$$\n其中 $X_i \\in \\mathbb{R}^d$ 是第 $i$ 个点的位置向量，$\\frac{\\partial}{\\partial X_i}$ 表示关于 $X_i$ 分量的梯度算子。\n\n弯曲能 $W$ 由以下求和给出：\n$$\nW = \\sum_{j} \\frac{\\kappa}{2} \\left\\|X_{j+1}-2X_j+X_{j-1}\\right\\|^{2}\n$$\n此处，求和索引 $j$ 遍历链中的所有物质点。由于链被指定为无限或周期性的，我们不需要考虑边界效应。\n\n为了计算力 $F_i$，我们必须对 $W$ 关于 $X_i$ 求导。梯度算子 $\\frac{\\partial}{\\partial X_i}$ 可以移到求和号内部：\n$$\n\\frac{\\partial W}{\\partial X_i} = \\sum_{j} \\frac{\\partial}{\\partial X_i} \\left( \\frac{\\kappa}{2} \\left\\|X_{j+1}-2X_j+X_{j-1}\\right\\|^{2} \\right)\n$$\n此和式中的某个特定项仅当其内容依赖于 $X_i$ 时才非零。检查表达式 $X_{j+1}-2X_j+X_{j-1}$ 表明，它在三种情况下依赖于 $X_i$：\n1. 当 $j = i+1$ 时，该项涉及 $X_{i+2}-2X_{i+1}+X_i$。\n2. 当 $j = i$ 时，该项涉及 $X_{i+1}-2X_i+X_{i-1}$。\n3. 当 $j = i-1$ 时，该项涉及 $X_{i}-2X_{i-1}+X_{i-2}$。\n\n对于所有其他 $j$ 值，被加项关于 $X_i$ 的导数为零。因此，我们只需要考虑这三项导数的和。\n\n让我们将节点 $j$ 处的离散曲率向量定义为 $K_j = X_{j+1}-2X_j+X_{j-1}$。能量泛函可以写为 $W = \\sum_j \\frac{\\kappa}{2} (K_j \\cdot K_j)$。我们计算这三个相关项中每一项关于 $X_i$ 的梯度。我们使用向量微积分恒等式 $\\frac{\\partial}{\\partial V} (\\mathbf{u} \\cdot \\mathbf{u}) = 2 \\left(\\frac{\\partial \\mathbf{u}}{\\partial V}\\right)^T \\mathbf{u}$，其中 $\\left(\\frac{\\partial \\mathbf{u}}{\\partial V}\\right)$ 是向量 $\\mathbf{u}$ 关于向量 $V$ 的雅可比矩阵。\n\n第1项：来自 $j = i+1$ 的贡献。\n相关的能量项是 $W_{i+1} = \\frac{\\kappa}{2} \\|K_{i+1}\\|^2 = \\frac{\\kappa}{2} \\|X_{i+2} - 2X_{i+1} + X_i\\|^2$。\n$K_{i+1}$ 关于 $X_i$ 的雅可比矩阵是 $\\frac{\\partial K_{i+1}}{\\partial X_i} = \\frac{\\partial}{\\partial X_i}(X_{i+2} - 2X_{i+1} + X_i) = I$，其中 $I$ 是 $d \\times d$ 的单位矩阵。\n梯度为：\n$$\n\\frac{\\partial W_{i+1}}{\\partial X_i} = \\frac{\\kappa}{2} \\cdot 2 \\left(\\frac{\\partial K_{i+1}}{\\partial X_i}\\right)^T K_{i+1} = \\kappa I^T K_{i+1} = \\kappa K_{i+1} = \\kappa(X_{i+2} - 2X_{i+1} + X_i)\n$$\n\n第2项：来自 $j = i$ 的贡献。\n相关的能量项是 $W_i = \\frac{\\kappa}{2} \\|K_i\\|^2 = \\frac{\\kappa}{2} \\|X_{i+1} - 2X_i + X_{i-1}\\|^2$。\n$K_i$ 关于 $X_i$ 的雅可比矩阵是 $\\frac{\\partial K_i}{\\partial X_i} = \\frac{\\partial}{\\partial X_i}(X_{i+1} - 2X_i + X_{i-1}) = -2I$。\n梯度为：\n$$\n\\frac{\\partial W_i}{\\partial X_i} = \\frac{\\kappa}{2} \\cdot 2 \\left(\\frac{\\partial K_i}{\\partial X_i}\\right)^T K_i = \\kappa (-2I)^T K_i = -2\\kappa K_i = -2\\kappa(X_{i+1} - 2X_i + X_{i-1})\n$$\n\n第3项：来自 $j = i-1$ 的贡献。\n相关的能量项是 $W_{i-1} = \\frac{\\kappa}{2} \\|K_{i-1}\\|^2 = \\frac{\\kappa}{2} \\|X_i - 2X_{i-1} + X_{i-2}\\|^2$。\n$K_{i-1}$ 关于 $X_i$ 的雅可比矩阵是 $\\frac{\\partial K_{i-1}}{\\partial X_i} = \\frac{\\partial}{\\partial X_i}(X_i - 2X_{i-1} + X_{i-2}) = I$。\n梯度为：\n$$\n\\frac{\\partial W_{i-1}}{\\partial X_i} = \\frac{\\kappa}{2} \\cdot 2 \\left(\\frac{\\partial K_{i-1}}{\\partial X_i}\\right)^T K_{i-1} = \\kappa I^T K_{i-1} = \\kappa K_{i-1} = \\kappa(X_i - 2X_{i-1} + X_{i-2})\n$$\n\n总梯度 $\\frac{\\partial W}{\\partial X_i}$ 是这三项贡献之和：\n$$\n\\frac{\\partial W}{\\partial X_i} = \\frac{\\partial W_{i+1}}{\\partial X_i} + \\frac{\\partial W_i}{\\partial X_i} + \\frac{\\partial W_{i-1}}{\\partial X_i}\n$$\n$$\n\\frac{\\partial W}{\\partial X_i} = \\kappa(X_{i+2} - 2X_{i+1} + X_i) - 2\\kappa(X_{i+1} - 2X_i + X_{i-1}) + \\kappa(X_i - 2X_{i-1} + X_{i-2})\n$$\n现在，我们根据位置向量 $X_k$ 合并同类项：\n- $X_{i+2}$ 的系数：$\\kappa$\n- $X_{i+1}$ 的系数：$-2\\kappa - 2\\kappa = -4\\kappa$\n- $X_{i}$ 的系数：$\\kappa + 4\\kappa + \\kappa = 6\\kappa$\n- $X_{i-1}$ 的系数：$-2\\kappa - 2\\kappa = -4\\kappa$\n- $X_{i-2}$ 的系数：$\\kappa$\n\n汇总这些项，得到梯度的表达式：\n$$\n\\frac{\\partial W}{\\partial X_i} = \\kappa (X_{i+2} - 4X_{i+1} + 6X_i - 4X_{i-1} + X_{i-2})\n$$\n这个结构可被识别为四阶导数算子（双调和算子）的离散模拟，这与 Euler-Bernoulli 梁的物理学一致，其中恢复力与位移的四阶导数成正比。\n\n最后，力 $F_i$ 是该梯度的负值：\n$$\nF_i = -\\frac{\\partial W}{\\partial X_i} = -\\kappa (X_{i+2} - 4X_{i+1} + 6X_i - 4X_{i-1} + X_{i-2})\n$$\n这就是作用在质点 $i$ 上的力的闭式表达式，表示为其邻近点位置的函数。", "answer": "$$\n\\boxed{-\\kappa (X_{i+2} - 4X_{i+1} + 6X_i - 4X_{i-1} + X_{i-2})}\n$$", "id": "3510125"}, {"introduction": "本练习将浸入式边界法的核心组件整合到一个完整的数值实验中。您将模拟一个受压膜与流体间的相互作用，并实现力传播、流体求解和速度插值的完整循环 [@problem_id:3510140]。通过量化跨边界的非物理性“泄漏”，本练习能让您对浸入式边界法的数值特性，以及诸如核函数和网格分辨率等选择如何影响模拟的保真度与守恒性，获得关键的实践见解。", "problem": "考虑一个二维周期性方形域，由区间 $[0,1]\\times[0,1]$ 描述，该区域在每个方向上用 $N$ 个点进行均匀笛卡尔网格离散化，网格间距为 $h=1/N$。一个闭合的弹性边界由一个半径为 $R$、中心位于 $(0.5,0.5)$ 的圆形薄膜表示，该薄膜由 $N_{\\mathrm{L}}$ 个等间距的拉格朗日点离散化，其角度参数化为 $\\theta_i = 2\\pi i/N_{\\mathrm{L}}$（角度以弧度为单位）。假设薄膜两侧存在均匀的压力跳跃 $\\Delta p$，导致在薄膜上产生单位长度上的法向牵引力，大小为 $\\Delta p\\,\\mathbf{n}$，其中 $\\mathbf{n}$ 是单位外法向量。\n\n在沉浸边界法（IBM）中，拉格朗日-欧拉耦合使用一个正则化的狄拉克δ函数，将薄膜牵引力从拉格朗日点 $(\\mathbf{X}_i)$ 散布到欧拉网格上，并将欧拉速度插值回拉格朗日点。具体来说，正则化δ函数定义为\n$$\n\\delta_h(\\mathbf{x})=\\frac{1}{h^2}\\,\\phi\\left(\\frac{x}{h}\\right)\\,\\phi\\left(\\frac{y}{h}\\right),\n$$\n其中，一维核函数 $\\phi(\\cdot)$ 是从一组候选函数中选择的紧支集函数。欧拉力密度则为\n$$\n\\mathbf{F}(\\mathbf{x})=\\sum_{i=0}^{N_{\\mathrm{L}}-1} \\Delta p\\,\\mathbf{n}_i\\,\\delta_h(\\mathbf{x}-\\mathbf{X}_i)\\,ds,\n$$\n其中 $ds = 2\\pi R/N_{\\mathrm{L}}$ 是弧段长度。在没有惯性效应的情况下，欧拉速度 $\\mathbf{u}$ 由稳态斯托克斯方程控制，\n$$\n-\\nabla p + \\mu \\Delta \\mathbf{u} + \\mathbf{F} = \\mathbf{0},\\qquad \\nabla\\cdot\\mathbf{u} = 0,\n$$\n其中 $\\mu$ 为动力粘度，边界条件为周期性。在这个周期性域上，$\\mathbf{u}$ 的唯一无散解可以使用快速傅里叶变换（FFT）通过谱方法表示，即将作用力投影到无散子空间上，并对所有非零波数除以拉普拉斯算子特征值。\n\n拉格朗日速度 $\\mathbf{U}_i$ 通过插值获得，\n$$\n\\mathbf{U}_i = \\sum_{\\text{grid }\\mathbf{x}} \\mathbf{u}(\\mathbf{x}) \\,\\delta_h(\\mathbf{X}_i - \\mathbf{x})\\,h^2,\n$$\n穿过薄膜的面积通量（在二维中，对应于单位深度的体积变化率）通过法向速度的线积分计算，\n$$\n\\frac{dA}{dt} = \\oint_{\\Gamma} \\mathbf{u}\\cdot\\mathbf{n}\\,ds \\approx \\sum_{i=0}^{N_{\\mathrm{L}}-1} \\mathbf{U}_i\\cdot\\mathbf{n}_i\\,ds.\n$$\n在连续介质中，对于一个包围着物质体积的不可压缩流（$\\nabla\\cdot\\mathbf{u}=0$），根据散度定理，面积变化率 $dA/dt$ 应恒为零。然而，在离散的沉浸边界法中，由于核函数 $\\phi(\\cdot)$ 的选择以及拉格朗日间距相对于欧拉网格的配置，导致散布和插值操作之间不匹配，$dA/dt$ 可能不为零。这种伪非零的 $dA/dt$ 被称为泄漏（leakage）。\n\n你的任务是实现一个程序，该程序：\n- 按所述方式离散化薄膜。\n- 使用选定的正则化δ核函数散布均匀压力牵引力。\n- 使用谱投影法求解周期性域上的稳态斯托克斯方程。\n- 将速度插值回薄膜上。\n- 按所述方式计算面积变化率 $dA/dt$。\n\n你必须以无量纲形式处理所有量。角度必须以弧度为单位。对于核函数 $\\phi(\\cdot)$，你必须至少支持以下选择：\n- Peskin四点核（沉浸边界法核）：\n$$\n\\phi(r)=\\begin{cases}\n\\frac{1}{8}\\left(3-2|r|+\\sqrt{1+4|r|-4r^2}\\right),  |r|1, \\\\[6pt]\n\\frac{1}{8}\\left(5-2|r|-\\sqrt{-7+12|r|-4r^2}\\right),  1\\le |r|2, \\\\[6pt]\n0,  \\text{其他.}\n\\end{cases}\n$$\n- 三次B样条基函数：\n$$\n\\phi(r)=\\begin{cases}\n\\frac{1}{6}\\left(4-6|r|^2+3|r|^3\\right),  |r|1, \\\\[6pt]\n\\frac{1}{6}\\left(2-|r|\\right)^3,  1\\le |r|2, \\\\[6pt]\n0,  \\text{其他.}\n\\end{cases}\n$$\n\n对于所有计算，设置 $N=64$, $h=1/N$, $R=0.25$, $\\mu=1$。定义拉格朗日间距比 $s=ds/h$，并通过 $N_{\\mathrm{L}} = \\left\\lfloor \\frac{2\\pi R}{s\\,h} \\right\\rfloor$ 确定 $N_{\\mathrm{L}}$，同时满足约束 $N_{\\mathrm{L}}\\ge 8$。使用单位外法向量 $\\mathbf{n}_i=[\\cos\\theta_i,\\sin\\theta_i]$。用于基于FFT求导的波数必须是 $k_x=2\\pi\\,\\mathrm{freq}_x$ 和 $k_y=2\\pi\\,\\mathrm{freq}_y$，其中 $\\mathrm{freq}$ 是对应于间距 $h$ 的标准离散傅里叶频率。\n\n设计你的代码，为以下由参数对 $(\\text{kernel},s)$ 和压力跳跃 $\\Delta p$ 指定的测试用例集计算 $dA/dt$：\n- 情况 1：$(\\text{peskin4},\\,s=1.0)$，$\\Delta p=1$。\n- 情况 2：$(\\text{peskin4},\\,s=0.5)$，$\\Delta p=1$。\n- 情况 3：$(\\text{peskin4},\\,s=2.0)$，$\\Delta p=1$。\n- 情况 4：$(\\text{bspline3},\\,s=1.0)$，$\\Delta p=1$。\n- 情况 5：$(\\text{bspline3},\\,s=0.5)$，$\\Delta p=1$。\n- 情况 6：$(\\text{bspline3},\\,s=2.0)$，$\\Delta p=1$。\n- 情况 7（边界情况）：$(\\text{peskin4},\\,s=1.0)$，$\\Delta p=0$。\n\n你的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按情况1到7的顺序排列结果，每个结果是计算出的浮点数 $dA/dt$。因为所有量都是无量纲的，所以不要在输出中附加任何物理单位。角度单位是弧度；所有输出必须是十进制浮点数。输出格式必须严格为\n$$\n[\\text{result}_1,\\text{result}_2,\\ldots,\\text{result}_7],\n$$\n其中每个 $\\text{result}_i$ 是一个浮点数值。", "solution": "该问题被认为是有效的，因为它在科学上基于计算流体动力学的原理，特别是沉浸边界法（IBM），并且是一个具有完整且一致给定条件的良构数值问题。该任务涉及模拟流固耦合，以量化一个已知的数值伪影——“泄漏”，该伪影由离散化和耦合核的选择引起。\n\n解决方案通过对每个测试用例逐步实现所述的数值方法来推进。\n\n**1. 域和边界的离散化**\n\n物理设置包括一个二维周期性域 $\\Omega = [0,1] \\times [0,1]$ 和一个半径为 $R=0.25$、中心位于 $(0.5, 0.5)$ 的圆形薄膜 $\\Gamma$。\n\n- **欧拉网格**：域 $\\Omega$ 被离散化为一个 $N \\times N$ 个点的均匀笛卡尔网格，其中 $N=64$。网格间距为 $h = 1/N = 1/64$。网格点位于 $\\mathbf{x}_{j,k} = (j h, k h)$，其中 $j,k \\in \\{0, 1, \\dots, N-1\\}$。\n\n- **拉格朗日网格**：薄膜 $\\Gamma$ 被离散化为 $N_{\\mathrm{L}}$ 个拉格朗日点。点的数量 $N_{\\mathrm{L}}$ 由拉格朗日间距比 $s = ds/h$ 决定，其中 $ds$ 是相邻拉格朗日点之间的弧长。公式为 $N_{\\mathrm{L}} = \\lfloor \\frac{2\\pi R}{s h} \\rfloor$。然后重新计算弧长为 $ds = 2\\pi R/N_{\\mathrm{L}}$，以确保离散化的环是闭合的。拉格朗日点的位置由角度 $\\theta_i = 2\\pi i/N_{\\mathrm{L}}$（其中 $i \\in \\{0, 1, \\dots, N_{\\mathrm{L}}-1\\}$）的参数化给出：\n$$\n\\mathbf{X}_i = (0.5 + R\\cos\\theta_i, 0.5 + R\\sin\\theta_i)\n$$\n在每个点 $\\mathbf{X}_i$ 的单位外法向量是 $\\mathbf{n}_i = (\\cos\\theta_i, \\sin\\theta_i)$。\n\n**2. 核函数与正则化Delta函数**\n\n流体（欧拉）和结构（拉格朗日）之间的相互作用由一个正则化的狄拉克delta函数 $\\delta_h(\\mathbf{x})$ 介导，该函数由一维核函数 $\\phi(r)$ 构造。根据其分段定义，实现了两个指定的核函数：Peskin四点核和三次B样条。这两个核函数的紧支集均为 $4h$，意味着当 $|r| \\ge 2$ 时 $\\phi(r)=0$。\n\n**3. 散布：从拉格朗日力到欧拉力密度**\n\n薄膜两侧均匀的压力跳跃 $\\Delta p$ 产生了一个等于 $\\Delta p \\, \\mathbf{n}$ 的单位长度上的法向力（牵引力）。在每个拉格朗日点 $\\mathbf{X}_i$ 上的离散力为 $\\mathbf{f}_i = \\Delta p \\, \\mathbf{n}_i \\, ds$。\n\n这个拉格朗日力被“散布”到周围的欧拉网格点上，以获得欧拉力密度场 $\\mathbf{F}(\\mathbf{x})$。这个散布操作的公式是：\n$$\n\\mathbf{F}(\\mathbf{x}) = \\sum_{i=0}^{N_{\\mathrm{L}}-1} \\mathbf{f}_i \\, \\delta_h(\\mathbf{x} - \\mathbf{X}_i) = \\frac{1}{h^2} \\sum_{i=0}^{N_{\\mathrm{L}}-1} (\\Delta p \\, \\mathbf{n}_i \\, ds) \\, \\phi\\left(\\frac{x-X_{i,x}}{h}\\right) \\phi\\left(\\frac{y-X_{i,y}}{h}\\right)\n$$\n在数值上，对于每个拉格朗日点 $\\mathbf{X}_i$，我们识别出落在核函数支集范围内的邻近欧拉网格点 $\\mathbf{x}_{j,k}$。然后计算力的贡献并加到欧拉力数组 `Fx` 和 `Fy` 的相应元素上。由于域是周期性的，距离计算考虑了网格的环绕特性。\n\n**4. 求解稳态斯托克斯方程**\n\n流体速度 $\\mathbf{u}$ 和压力 $p$ 由具有周期性边界条件的稳态斯托克斯方程控制：\n$$\n-\\nabla p + \\mu \\Delta \\mathbf{u} + \\mathbf{F} = \\mathbf{0}, \\qquad \\nabla\\cdot\\mathbf{u} = 0\n$$\n鉴于周期性，这些方程在傅里叶空间中可以高效求解。对这些方程应用快速傅里叶变换（FFT）得到：\n$$\n-i\\mathbf{k}\\hat{p} - \\mu |\\mathbf{k}|^2 \\hat{\\mathbf{u}} + \\hat{\\mathbf{F}} = \\mathbf{0}, \\qquad i\\mathbf{k}\\cdot\\hat{\\mathbf{u}} = 0\n$$\n其中 $\\hat{\\cdot}$ 表示傅里叶变换，$\\mathbf{k}=(k_x, k_y)$ 是波矢量，并且 $|\\mathbf{k}|^2=k_x^2+k_y^2$。波数由 $k = 2\\pi f$ 决定，其中 $f$ 是来自 `scipy.fft.fftfreq` 的离散频率。\n\n不可压缩条件（$i\\mathbf{k}\\cdot\\hat{\\mathbf{u}} = 0$）意味着速度矢量 $\\hat{\\mathbf{u}}$ 与波矢量 $\\mathbf{k}$ 正交。通过将动量方程投影到无散子空间，我们可以直接求解 $\\hat{\\mathbf{u}}$：\n$$\n\\hat{\\mathbf{u}}(\\mathbf{k}) = \\frac{1}{\\mu |\\mathbf{k}|^2} \\left( \\hat{\\mathbf{F}} - \\frac{(\\mathbf{k} \\cdot \\hat{\\mathbf{F}})\\mathbf{k}}{|\\mathbf{k}|^2} \\right) \\quad \\text{对于 } \\mathbf{k} \\neq \\mathbf{0}\n$$\n对于零波数模式（$\\mathbf{k}=\\mathbf{0}$），$\\hat{\\mathbf{u}}(\\mathbf{0})$ 设置为零，对应于零平均速度。得到的傅里叶空间中的速度场 $(\\hat{u}_x, \\hat{u}_y)$ 通过逆FFT变换回实空间，得到欧拉速度场 $(u_x, u_y)$。\n\n**5. 插值：从欧拉速度到拉格朗日速度**\n\n薄膜点的速度 $\\mathbf{U}_i$ 是通过在拉格朗日位置 $\\mathbf{X}_i$ 插值欧拉速度场 $\\mathbf{u}(\\mathbf{x})$ 得到的。此操作是散布操作的伴随操作：\n$$\n\\mathbf{U}_i = \\sum_{\\text{grid }\\mathbf{x}} \\mathbf{u}(\\mathbf{x}) \\, \\delta_h(\\mathbf{X}_i - \\mathbf{x}) \\, h^2 = \\sum_{\\text{grid }\\mathbf{x}} \\mathbf{u}(\\mathbf{x}) \\, \\phi\\left(\\frac{X_{i,x}-x}{h}\\right) \\phi\\left(\\frac{Y_{i,y}-y}{h}\\right)\n$$\n在数值上，对于每个拉格朗日点 $\\mathbf{X}_i$，我们再次识别出邻近的欧拉网格点，并计算其速度的加权和以求得 $\\mathbf{U}_i$。\n\n**6. 面积变化率（$dA/dt$）的计算**\n\n最后，通过近似计算沿边界的法向速度的线积分，来计算由薄膜包围的面积的变化率，这是衡量数值泄漏的一个指标：\n$$\n\\frac{dA}{dt} = \\oint_{\\Gamma} \\mathbf{u}\\cdot\\mathbf{n}\\,ds \\approx \\sum_{i=0}^{N_{\\mathrm{L}}-1} \\mathbf{U}_i\\cdot\\mathbf{n}_i\\,ds\n$$\n对问题中指定的每个测试用例计算此值。$\\Delta p = 0$ 的情况作为一个空测试，它应该产生零力、零速度，因此泄漏为零，这验证了基础实现的线性和正确性。", "answer": "```python\nimport numpy as np\nimport scipy.fft\n\ndef peskin4_kernel(r):\n    \"\"\"\n    Computes the Peskin 4-point regularized delta function kernel.\n    \"\"\"\n    r_abs = np.abs(r)\n    val = np.zeros_like(r_abs)\n    \n    # |r|  1\n    mask1 = r_abs  1\n    r1 = r_abs[mask1]\n    val[mask1] = (1/8) * (3 - 2*r1 + np.sqrt(1 + 4*r1 - 4*r1**2))\n    \n    # 1 = |r|  2\n    mask2 = (r_abs >= 1)  (r_abs  2)\n    r2 = r_abs[mask2]\n    # Ensure argument of sqrt is non-negative due to float precision issues\n    sqrt_arg = -7 + 12*r2 - 4*r2**2\n    sqrt_arg[sqrt_arg  0] = 0.0\n    val[mask2] = (1/8) * (5 - 2*r2 - np.sqrt(sqrt_arg))\n\n    return val\n\ndef bspline3_kernel(r):\n    \"\"\"\n    Computes the cardinal cubic B-spline kernel.\n    \"\"\"\n    r_abs = np.abs(r)\n    val = np.zeros_like(r_abs)\n    \n    # |r|  1\n    mask1 = r_abs  1\n    r1 = r_abs[mask1]\n    val[mask1] = (1/6) * (4 - 6*r1**2 + 3*r1**3)\n\n    # 1 = |r|  2\n    mask2 = (r_abs >= 1)  (r_abs  2)\n    r2 = r_abs[mask2]\n    val[mask2] = (1/6) * (2 - r2)**3\n    \n    return val\n\ndef compute_leakage(kernel_name, s, dp):\n    \"\"\"\n    Computes the area change rate (dA/dt) for the given parameters.\n    \"\"\"\n    # System parameters\n    N = 64\n    R = 0.25\n    mu = 1.0\n    h = 1.0 / N\n\n    # Select the kernel function\n    kernels = {'peskin4': peskin4_kernel, 'bspline3': bspline3_kernel}\n    kernel_func = kernels[kernel_name]\n\n    # Lagrangian boundary discretization\n    N_L = int(np.floor(2 * np.pi * R / (s * h)))\n    ds = 2 * np.pi * R / N_L\n    theta = 2 * np.pi * np.arange(N_L) / N_L\n    \n    X_lag = 0.5 + R * np.cos(theta)\n    Y_lag = 0.5 + R * np.sin(theta)\n    nx = np.cos(theta)\n    ny = np.sin(theta)\n\n    # Sanity check: if pressure jump is zero, leakage must be zero\n    if dp == 0:\n        return 0.0\n\n    # --- Step 1: Spreading (Lagrangian force to Eulerian grid) ---\n    Fx = np.zeros((N, N))\n    Fy = np.zeros((N, N))\n    \n    for i in range(N_L):\n        lag_force_x = dp * nx[i] * ds\n        lag_force_y = dp * ny[i] * ds\n        \n        sx = X_lag[i] / h\n        sy = Y_lag[i] / h\n        \n        j_base = int(np.floor(sx))\n        k_base = int(np.floor(sy))\n\n        for dj in range(-1, 3):\n            for dk in range(-1, 3):\n                j = j_base + dj\n                k = k_base + dk\n                \n                rx = sx - j\n                ry = sy - k\n                \n                j_idx, k_idx = j % N, k % N\n                \n                weight = kernel_func(rx) * kernel_func(ry) / h**2\n                \n                Fx[k_idx, j_idx] += lag_force_x * weight\n                Fy[k_idx, j_idx] += lag_force_y * weight\n\n    # --- Step 2: Solve steady Stokes equations in Fourier space ---\n    Fx_hat = scipy.fft.fft2(Fx)\n    Fy_hat = scipy.fft.fft2(Fy)\n\n    freq = scipy.fft.fftfreq(N, h)\n    kx = 2 * np.pi * freq\n    Ky, Kx = np.meshgrid(kx, kx, indexing='ij')\n\n    Ksq = Kx**2 + Ky**2\n    \n    inv_Ksq = np.zeros_like(Ksq)\n    nonzero_mask = Ksq != 0\n    inv_Ksq[nonzero_mask] = 1.0 / Ksq[nonzero_mask]\n    \n    k_dot_Fhat = Kx * Fx_hat + Ky * Fy_hat\n    \n    Fx_hat_solenoidal = Fx_hat - Kx * k_dot_Fhat * inv_Ksq\n    Fy_hat_solenoidal = Fy_hat - Ky * k_dot_Fhat * inv_Ksq\n    \n    ux_hat = Fx_hat_solenoidal * inv_Ksq / mu\n    uy_hat = Fy_hat_solenoidal * inv_Ksq / mu\n\n    ux = np.real(scipy.fft.ifft2(ux_hat))\n    uy = np.real(scipy.fft.ifft2(uy_hat))\n\n    # --- Step 3: Interpolation (Eulerian velocity to Lagrangian points) ---\n    Ux = np.zeros(N_L)\n    Uy = np.zeros(N_L)\n\n    for i in range(N_L):\n        sx = X_lag[i] / h\n        sy = Y_lag[i] / h\n        \n        j_base = int(np.floor(sx))\n        k_base = int(np.floor(sy))\n\n        for dj in range(-1, 3):\n            for dk in range(-1, 3):\n                j = j_base + dj\n                k = k_base + dk\n                \n                rx = sx - j\n                ry = sy - k\n                \n                j_idx, k_idx = j % N, k % N\n                \n                weight = kernel_func(rx) * kernel_func(ry)\n                \n                Ux[i] += ux[k_idx, j_idx] * weight\n                Uy[i] += uy[k_idx, j_idx] * weight\n                \n    # --- Step 4: Calculate Area Change Rate (Leakage) ---\n    dAdt = np.sum((Ux * nx + Uy * ny)) * ds\n    \n    return dAdt\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # (kernel_name, spacing_ratio_s, pressure_jump_dp)\n        ('peskin4', 1.0, 1.0),\n        ('peskin4', 0.5, 1.0),\n        ('peskin4', 2.0, 1.0),\n        ('bspline3', 1.0, 1.0),\n        ('bspline3', 0.5, 1.0),\n        ('bspline3', 2.0, 1.0),\n        ('peskin4', 1.0, 0.0), # Edge case\n    ]\n\n    results = []\n    for kernel_name, s, dp in test_cases:\n        result = compute_leakage(kernel_name, s, dp)\n        results.append(result)\n\n    # Format output as a comma-separated list of floats in brackets\n    print(f\"[{','.join(f'{r:.12e}' for r in results)}]\")\n\nsolve()\n```", "id": "3510140"}]}