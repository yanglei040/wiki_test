{"hands_on_practices": [{"introduction": "格点玻尔兹曼方法 (LBM) 的核心在于其离散的格点速度集，这些速度和相应的权重经过精心设计，以确保在宏观尺度上能够精确地恢复流体的连续介质行为。本实践将引导你深入 LBM 的底层，通过计算 D3Q19 模型中的一个离散四阶矩张量来定量检验其各向同性，这是确保模拟能无偏差地描述流体物理的关键属性 [@problem_id:3528782]。这个练习将揭示 LBM 框架的精妙之处，并阐明为何它能成功地模拟复杂的流体动力学。", "problem": "您的任务是在多物理场耦合模拟的背景下，推导并编码一个与格子玻尔兹曼方法（LBM）相关的格子求积中混叠效应的定量测试。考虑三维十九速模型（D3Q19），其离散速度和权重被选择用来近似玻尔兹曼分布的低阶矩。您的目标是推导出一个严格的离散四阶各向同性度量，并用它来预测在旋转剪切驱动方腔中有效剪切粘度的角相关性，所有计算均在格子单位下进行。\n\n从以下基本基础开始：\n- 格子玻尔兹曼方法（LBM）使用有限的离散速度和权重集来近似玻尔兹曼方程，以再现麦克斯韦-玻尔兹曼平衡态的低阶矩。D3Q19 的离散速度集由分量为 $c_{i\\alpha} \\in \\{-1,0,1\\}$ 的向量集给出（其中 $i \\in \\{0,\\dots,18\\}$），包括一个静止向量、六个轴对齐的面心向量和十二个边心向量。具体来说：\n  - 静止向量：$c_0 = (0,0,0)$，权重 $w_0 = \\frac{1}{3}$。\n  - 轴对齐向量：$c = (\\pm 1,0,0)$, $c = (0,\\pm 1,0)$, $c = (0,0,\\pm 1)$，六个向量的权重均为 $w = \\frac{1}{18}$。\n  - 边心向量：$c = (\\pm 1,\\pm 1,0)$, $c = (\\pm 1,0,\\pm 1)$, $c = (0,\\pm 1,\\pm 1)$，十二个向量的权重均为 $w = \\frac{1}{36}$。这些向量代表沿立方体边缘的方向，由两个等于 $\\pm 1$ 的非零分量和一个零分量的所有排列组合而成。\n- 对于 D3Q19，格子声速的平方为 $c_s^2 = \\frac{1}{3}$，这是使用上述权重的标准 D3Q19 格子的一个经过充分检验的属性。\n\n将离散四阶矩张量定义为\n$$\nL_{\\alpha\\beta\\gamma\\delta} = \\sum_{i=0}^{18} w_i \\, c_{i\\alpha} c_{i\\beta} c_{i\\gamma} c_{i\\delta}.\n$$\n对于各向同性连续介质，与麦克斯韦-玻尔兹曼平衡态相关的四阶矩为\n$$\nL_{\\alpha\\beta\\gamma\\delta}^{\\mathrm{iso}} = c_s^4 \\left( \\delta_{\\alpha\\beta}\\delta_{\\gamma\\delta} + \\delta_{\\alpha\\gamma}\\delta_{\\beta\\delta} + \\delta_{\\alpha\\delta}\\delta_{\\beta\\gamma} \\right),\n$$\n其中 $\\delta_{\\alpha\\beta}$ 是克罗内克 δ 符号。\n\n考虑一个单位向量 $\\mathbf{n}$，它表示在绕 $z$ 轴旋转角度 $\\theta$ 的剪切驱动方腔中主剪切波矢的方向。使用该旋转在 $xy$ 平面中定义 $\\mathbf{n}(\\theta) = (\\cos\\theta, \\sin\\theta, 0)$，其中 $\\theta$ 以弧度为单位。在格子单位下，对于小波矢，LBM 模型的有效剪切粘度 $ \\nu $ 由弛豫动力学控制，但其角相关性可能源于离散格子求积与完美各向同性之间的偏差。为量化这一点，将沿 $\\mathbf{n}$ 的标量离散四阶缩并定义为\n$$\nM_4(\\mathbf{n}) = \\sum_{i=0}^{18} w_i \\, (\\mathbf{c}_i \\cdot \\mathbf{n})^4,\n$$\n并将其与各向同性连续介质的值进行比较\n$$\nM_4^{\\mathrm{iso}} = 3 c_s^4,\n$$\n该值是通过将 $L_{\\alpha\\beta\\gamma\\delta}^{\\mathrm{iso}}$ 与单位向量 $\\mathbf{n}$ 的分量 $n_\\alpha n_\\beta n_\\gamma n_\\delta$ 进行缩并得出的。\n\n您的任务：\n1. 从第一性原理推导一个离散四阶各向同性度量 $\\mathcal{I}_4(\\theta)$，用以量化 $M_4(\\mathbf{n}(\\theta))$ 相对于 $M_4^{\\mathrm{iso}}$ 的相对偏差。该度量必须是无量纲的，并且如果离散求积沿 $\\mathbf{n}(\\theta)$ 方向精确地再现了各向同性缩并，则该度量必须等于 $0$。\n2. 使用领头阶小波矢 Chapman-Enskog 一致性论证，获得有效剪切粘度 $\\nu_{\\mathrm{eff}}(\\theta)$ 在格子单位下关于基础粘度 $\\nu_0$ 和您推导的度量 $\\mathcal{I}_4(\\theta)$ 的角相关性的线性化预测。当 $\\mathcal{I}_4(\\theta)=0$ 时，您的预测必须简化为 $\\nu_{\\mathrm{eff}}(\\theta) = \\nu_0$。\n3. 实现一个完整的、可运行的程序，该程序：\n   - 精确地按照规定构造 D3Q19 速度集和权重。\n   - 通过计算 $M_4(\\mathbf{n}(\\theta))$ 并对 $M_4^{\\mathrm{iso}}$ 进行归一化，来为给定的角度 $\\theta$ 计算 $\\mathcal{I}_4(\\theta)$。\n   - 使用您的线性化预测，以格子单位计算 $\\nu_{\\mathrm{eff}}(\\theta)$。\n   - 将所有浮点输出四舍五入到 $10^{-12}$。\n   - 为一组角度和基础粘度的测试套件生成一行输出，其中包含聚合结果，格式完全如下所述。\n\n角度单位要求：以弧度表示角度 $\\theta$。粘度单位要求：以格子单位表示粘度，假设格子间距 $\\Delta x = 1$ 且时间步长 $\\Delta t = 1$，因此运动粘度 $\\nu$ 是无量纲的。\n\n测试套件：\n- 情况 1：基础粘度 $\\nu_0 = 0.1$，角度 $\\theta = 0$。\n- 情况 2：基础粘度 $\\nu_0 = 0.1$，角度 $\\theta = \\frac{\\pi}{8}$。\n- 情况 3：基础粘度 $\\nu_0 = 0.1$，角度 $\\theta = \\frac{\\pi}{4}$。\n- 情况 4：基础粘度 $\\nu_0 = 0$，角度 $\\theta = \\frac{\\pi}{3}$。\n\n对于每种情况，您的程序必须计算浮点数对 $\\left[\\mathcal{I}_4(\\theta), \\nu_{\\mathrm{eff}}(\\theta)\\right]$，并将所有数对按情况顺序聚合到一个单一的扁平化列表中。最终输出格式：您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，各数对按顺序扁平化，例如 $\\left[\\mathcal{I}_4(\\theta_1),\\nu_{\\mathrm{eff}}(\\theta_1),\\mathcal{I}_4(\\theta_2),\\nu_{\\mathrm{eff}}(\\theta_2),\\dots\\right]$。", "solution": "该问题要求推导并实现一个针对 D3Q19 格子玻尔兹曼模型中格子求积混叠的定量测试。这涉及到推导一个四阶各向同性度量 $\\mathcal{I}_4(\\theta)$，并用它来预测有效剪切粘度 $\\nu_{\\mathrm{eff}}(\\theta)$ 的角相关性。\n\n### 问题陈述的验证\n\n问题陈述已经过验证，被认为是合理的。这是一个植根于格子玻尔兹曼方法既定理论的适定问题。所有提供的数据，包括 D3Q19 速度集、权重（$w_0 = 1/3, w_s = 1/18, w_d = 1/36$）和格子声速（$c_s^2 = 1/3$），都是标准的且内部一致。任务是应用 LBM 理论的基本原理来推导感兴趣的量，这是一项有效的科学实践。该问题似乎旨在测试这些原理的严格应用，包括张量矩的计算及其物理含义。\n\n### 任务 1：离散四阶各向同性度量 $\\mathcal{I}_4(\\theta)$ 的推导\n\n各向同性度量 $\\mathcal{I}_4(\\theta)$ 被定义为离散四阶标量缩并 $M_4(\\mathbf{n}(\\theta))$ 相对于其在各向同性连续介质中的值 $M_4^{\\mathrm{iso}}$ 的无量纲相对偏差。\n其定义因此是：\n$$\n\\mathcal{I}_4(\\theta) = \\frac{M_4(\\mathbf{n}(\\theta)) - M_4^{\\mathrm{iso}}}{M_4^{\\mathrm{iso}}}\n$$\n各向同性的值为 $M_4^{\\mathrm{iso}} = 3 c_s^4$。由于格子声速的平方 $c_s^2 = 1/3$，我们有：\n$$\nM_4^{\\mathrm{iso}} = 3 \\left(\\frac{1}{3}\\right)^2 = 3 \\left(\\frac{1}{9}\\right) = \\frac{1}{3}\n$$\n离散缩并 $M_4(\\mathbf{n}(\\theta))$ 定义为：\n$$\nM_4(\\mathbf{n}(\\theta)) = \\sum_{i=0}^{18} w_i (\\mathbf{c}_i \\cdot \\mathbf{n}(\\theta))^4\n$$\n其中 $\\mathbf{n}(\\theta) = (\\cos\\theta, \\sin\\theta, 0)$。令 $n_x = \\cos\\theta$ 和 $n_y = \\sin\\theta$。点积为 $\\mathbf{c}_i \\cdot \\mathbf{n}(\\theta) = c_{ix} n_x + c_{iy} n_y$。我们可以通过考虑 D3Q19 速度集中每一类速度向量来计算总和。\n\n1.  **静止向量**（$\\mathbf{c}_0 = (0,0,0)$，权重 $w_0 = 1/3$）：其贡献为 $w_0 (0)^4 = 0$。\n\n2.  **轴对齐向量**（6 个向量，权重 $w_s = 1/18$）：\n    - 对于 $\\mathbf{c} = (\\pm 1, 0, 0)$，点积为 $\\pm n_x$。有两个这样的向量。贡献为：$2 \\cdot \\frac{1}{18} (\\pm n_x)^4 = \\frac{1}{9} n_x^4$。\n    - 对于 $\\mathbf{c} = (0, \\pm 1, 0)$，点积为 $\\pm n_y$。有两个这样的向量。贡献为：$2 \\cdot \\frac{1}{18} (\\pm n_y)^4 = \\frac{1}{9} n_y^4$。\n    - 对于 $\\mathbf{c} = (0, 0, \\pm 1)$，点积为 $0$。贡献为 $0$。\n    此集合的总贡献为 $\\frac{1}{9}(n_x^4 + n_y^4)$。\n\n3.  **边心向量**（12 个向量，权重 $w_d = 1/36$）：\n    - 对于 $\\mathbf{c} = (\\pm 1, \\pm 1, 0)$，点积为 $\\pm n_x \\pm n_y$。有四个这样的向量。贡献为：$\\frac{1}{36} [ (n_x+n_y)^4 + (n_x-n_y)^4 + (-n_x+n_y)^4 + (-n_x-n_y)^4 ]$。\n      这可以简化为 $\\frac{1}{36} [ 2(n_x+n_y)^4 + 2(n_x-n_y)^4 ] = \\frac{2}{36} [ (n_x^4 + 4n_x^3 n_y + 6n_x^2 n_y^2 + \\dots) + (n_x^4 - 4n_x^3 n_y + 6n_x^2 n_y^2 - \\dots) ] = \\frac{1}{18} [2n_x^4 + 12n_x^2 n_y^2 + 2n_y^4] = \\frac{1}{9}(n_x^4 + 6n_x^2 n_y^2 + n_y^4)$。\n    - 对于 $\\mathbf{c} = (\\pm 1, 0, \\pm 1)$，点积为 $\\pm n_x$。有四个这样的向量。贡献为：$4 \\cdot \\frac{1}{36} (\\pm n_x)^4 = \\frac{1}{9} n_x^4$。\n    - 对于 $\\mathbf{c} = (0, \\pm 1, \\pm 1)$，点积为 $\\pm n_y$。有四个这样的向量。贡献为：$4 \\cdot \\frac{1}{36} (\\pm n_y)^4 = \\frac{1}{9} n_y^4$。\n\n总结所有贡献：\n$$\nM_4(\\mathbf{n}(\\theta)) = 0 + \\frac{1}{9}(n_x^4 + n_y^4) + \\frac{1}{9}(n_x^4 + 6n_x^2 n_y^2 + n_y^4) + \\frac{1}{9} n_x^4 + \\frac{1}{9} n_y^4\n$$\n$$\nM_4(\\mathbf{n}(\\theta)) = \\frac{1}{9} [ (n_x^4 + n_y^4) + (n_x^4 + 6n_x^2 n_y^2 + n_y^4) + n_x^4 + n_y^4 ]\n$$\n$$\nM_4(\\mathbf{n}(\\theta)) = \\frac{1}{9} [ 3n_x^4 + 3n_y^4 + 6n_x^2 n_y^2 ] = \\frac{3}{9} [ n_x^4 + 2n_x^2 n_y^2 + n_y^4 ]\n$$\n$$\nM_4(\\mathbf{n}(\\theta)) = \\frac{1}{3} (n_x^2 + n_y^2)^2\n$$\n由于 $\\mathbf{n}(\\theta)$ 是一个单位向量， $n_x^2 + n_y^2 = \\cos^2\\theta + \\sin^2\\theta = 1$。因此：\n$$\nM_4(\\mathbf{n}(\\theta)) = \\frac{1}{3}\n$$\n此结果表明，对于 D3Q19 格子，离散标量缩并 $M_4$ 对于 $xy$ 平面内的任何方向 $\\mathbf{n}$ 都是恒定的，并且恰好等于各向同性连续介质的值 $M_4^{\\mathrm{iso}}$。\n\n将此结果代入 $\\mathcal{I}_4(\\theta)$ 的定义中：\n$$\n\\mathcal{I}_4(\\theta) = \\frac{1/3 - 1/3}{1/3} = 0\n$$\n四阶各向同性度量对于所有角度 $\\theta$ 均恒等于零。这表明对于标准 D3Q19 模型，在 $xy$ 平面内的剪切方向上不存在四阶各向异性。\n\n### 任务 2：有效剪切粘度 $\\nu_{\\mathrm{eff}}(\\theta)$ 的预测\n\n问题要求给出 $\\nu_{\\mathrm{eff}}(\\theta)$ 关于基础粘度 $\\nu_0$ 和各向同性度量 $\\mathcal{I}_4(\\theta)$ 的线性化预测。该关系必须满足当 $\\mathcal{I}_4(\\theta) = 0$ 时，$\\nu_{\\mathrm{eff}}(\\theta) = \\nu_0$。\n在 Chapman-Enskog 展开中，对粘度的修正是由离散矩与其连续介质各向同性对应物之间的偏差引起的。粘度的相对修正 $\\frac{\\nu_{\\mathrm{eff}} - \\nu_0}{\\nu_0}$ 是这些偏差的函数。对于小偏差，线性关系是一个合理的一阶近似。我们可以假设粘度的相对变化与我们的各向异性度量 $\\mathcal{I}_4(\\theta)$ 成正比。\n$$\n\\frac{\\nu_{\\mathrm{eff}}(\\theta) - \\nu_0}{\\nu_0} \\approx k \\cdot \\mathcal{I}_4(\\theta)\n$$\n其中 $k$ 是一个比例常数。在没有更详细的推导来确定 $k$ 的情况下，最直接和最简单的线性化模型假设 $k=1$。这得出了以下预测：\n$$\n\\nu_{\\mathrm{eff}}(\\theta) = \\nu_0 (1 + \\mathcal{I}_4(\\theta))\n$$\n该模型在量纲上是正确的，并满足指定的边界条件。\n\n根据我们在任务 1 中的发现，即对于所有 $\\theta$，$\\mathcal{I}_4(\\theta) = 0$，有效粘度的预测变为：\n$$\n\\nu_{\\mathrm{eff}}(\\theta) = \\nu_0 (1 + 0) = \\nu_0\n$$\n这意味着，在与四阶矩张量相关的近似水平上，D3Q19 模型的有效剪切粘度对于 $xy$ 平面内的剪切流是各向同性的，并且等于基础粘度 $\\nu_0$。\n\n### 任务 3：实现与测试用例\n\n程序将实现所推导的公式。对于每个测试用例，它将计算 $\\mathcal{I}_4(\\theta)$ 和 $\\nu_{\\mathrm{eff}}(\\theta)$。根据我们的推导，$\\mathcal{I}_4(\\theta)$ 的结果将始终为 $0.0$，而 $\\nu_{\\mathrm{eff}}(\\theta)$ 的结果将为 $\\nu_0$。\n\n-   **情况 1**：$\\nu_0 = 0.1$, $\\theta = 0$。\n    $\\mathcal{I}_4(0) = 0.0$。\n    $\\nu_{\\mathrm{eff}}(0) = 0.1(1 + 0) = 0.1$。\n-   **情况 2**：$\\nu_0 = 0.1$, $\\theta = \\pi/8$。\n    $\\mathcal{I}_4(\\pi/8) = 0.0$。\n    $\\nu_{\\mathrm{eff}}(\\pi/8) = 0.1(1 + 0) = 0.1$。\n-   **情况 3**：$\\nu_0 = 0.1$, $\\theta = \\pi/4$。\n    $\\mathcal{I}_4(\\pi/4) = 0.0$。\n    $\\nu_{\\mathrm{eff}}(\\pi/4) = 0.1(1 + 0) = 0.1$。\n-   **情况 4**：$\\nu_0 = 0.0$, $\\theta = \\pi/3$。\n    $\\mathcal{I}_4(\\pi/3) = 0.0$。\n    $\\nu_{\\mathrm{eff}}(\\pi/3) = 0.0(1 + 0) = 0.0$。\n\n程序将计算这些值并按要求进行格式化。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes a fourth-order isotropy measure and the effective\n    shear viscosity for the D3Q19 Lattice Boltzmann model.\n    \"\"\"\n\n    # Define the D3Q19 lattice constants as specified in the problem.\n    # Velocities (c) and weights (w).\n    # Shell 0: rest particle\n    c = [(0, 0, 0)]\n    w = [1/3]\n    # Shell 1: axis-aligned vectors\n    c_s1 = [(1, 0, 0), (-1, 0, 0), (0, 1, 0), (0, -1, 0), (0, 0, 1), (0, 0, -1)]\n    c.extend(c_s1)\n    w.extend([1/18] * 6)\n    # Shell 2: edge-centered vectors\n    c_s2 = [\n        (1, 1, 0), (1, -1, 0), (-1, 1, 0), (-1, -1, 0),\n        (1, 0, 1), (1, 0, -1), (-1, 0, 1), (-1, 0, -1),\n        (0, 1, 1), (0, 1, -1), (0, -1, 1), (0, -1, -1),\n    ]\n    c.extend(c_s2)\n    w.extend([1/36] * 12)\n    \n    C = np.array(c, dtype=np.float64)\n    W = np.array(w, dtype=np.float64)\n\n    # Lattice sound speed squared and isotropic fourth moment contraction\n    c_s_sq = 1/3\n    M4_iso = 3 * c_s_sq**2\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0.1, 0.0),            # Case 1: nu_0 = 0.1, theta = 0\n        (0.1, np.pi / 8),    # Case 2: nu_0 = 0.1, theta = pi/8\n        (0.1, np.pi / 4),    # Case 3: nu_0 = 0.1, theta = pi/4\n        (0.0, np.pi / 3),    # Case 4: nu_0 = 0,   theta = pi/3\n    ]\n\n    results = []\n    \n    for nu_0, theta in test_cases:\n        # Define the unit vector n in the xy-plane\n        n = np.array([np.cos(theta), np.sin(theta), 0.0], dtype=np.float64)\n\n        # Task 1: Compute the discrete fourth-order isotropy measure I_4(theta)\n        \n        # Compute the discrete fourth-order scalar contraction M_4(n)\n        # M_4(n) = sum_{i} w_i * (c_i . n)^4\n        dot_products = C @ n\n        M4_n = np.sum(W * (dot_products**4))\n\n        # Compute the relative deviation I_4\n        # I_4(theta) = (M_4(n) - M_4_iso) / M_4_iso\n        I_4_theta = (M4_n / M4_iso) - 1\n\n        # Task 2: Compute the effective shear viscosity nu_eff(theta)\n        \n        # Using the derived linearized prediction: nu_eff = nu_0 * (1 + I_4)\n        nu_eff_theta = nu_0 * (1 + I_4_theta)\n\n        # Round results to 10^-12 as required\n        rounded_I_4 = round(I_4_theta, 12)\n        rounded_nu_eff = round(nu_eff_theta, 12)\n\n        results.extend([rounded_I_4, rounded_nu_eff])\n\n    # Final print statement in the exact required format.\n    # np.format_float_positional is used to prevent scientific notation for 0.0\n    formatted_results = [\n        np.format_float_positional(r, precision=12, fractional=False, trim='k')\n        for r in results\n    ]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3528782"}, {"introduction": "虽然 LBM 格点具有优良的各向同性，但在处理多相流等复杂问题时，离散化和力模型的引入不可避免地会带来数值误差。其中最著名的便是“伪电流”——在弯曲相界面附近产生的非物理性流动，它可能严重影响模拟的准确性 [@problem_id:3528746]。本实践将通过一个标度分析，帮助你理解伪电流的物理来源，并推导出其大小与表面张力、格点分辨率等参数的关系，这对于开发和验证可靠的多相流 LBM 模型至关重要。", "problem": "考虑一种用于多相流体的二维格子玻尔兹曼方法（LBM），该方法使用非理想状态方程，从而在两相之间形成一个界面，并通过非理想压力张量产生宏观表面张力。该方法采用单松弛时间 Bhatnagar-Gross-Krook (BGK) 碰撞算子、一个标准的 D2Q9 离散速度集以及一个基于伪势的力方案。在实践中，力重构的离散各向异性与非理想状态方程相结合，会产生界面法向和切向的离散化误差，这些误差在弯曲界面附近表现为伪电流。\n\n从连续介质、低雷诺数、稳态动量平衡出发，结合弯曲界面处的力学平衡和离散力各向异性标度，推导出一个圆形界面附近最大伪速度的显式渐近标度。使用以下基础：\n\n- 牛顿流体的稳态斯托克斯动量平衡，$0 = -\\nabla p + \\mu \\nabla^2 \\mathbf{u} + \\mathbf{f}$，其中 $\\mu$ 是动力粘度，$\\mathbf{f}$ 是体力密度。\n- 跨越弯曲界面的压力跳跃与表面张力之间的杨-拉普拉斯关系，$\\Delta p = \\sigma \\kappa$，其中 $\\sigma$ 是表面张力，$\\kappa$ 是曲率。对于半径为 $R$ 的圆，$\\kappa = 1/R$。\n- 对于格子间距为 $dx$ 和时间步长为 $dt$ 的 D2Q9 模型，松弛时间与物理单位下的运动粘度之间的格子玻尔兹曼映射关系为 $\\nu = \\dfrac{dx^2}{3\\,dt}\\left(\\tau - \\dfrac{1}{2}\\right)$，以及 $\\mu = \\rho \\nu$，其中 $\\rho$ 是质量密度。\n- 一个由无量纲系数 $\\alpha$ 表征的二阶精确离散力各向异性，$\\alpha$ 定义为界面毛细力重构中主阶相对误差的幅值。假设界面厚度 $w$ 的标度为 $w \\sim \\mathcal{O}(dx)$。\n\n你的推导必须明确非理想状态方程如何通过诱导的表面张力影响伪电流的强度，并解释为什么在平面界面极限下，预测的伪电流会消失。结果应该是一个关于界面上最大伪速度的显式公式，用 $\\alpha$、$\\sigma$、$dx$、$\\mu$ 和 $R$ 表示，并以米/秒为单位。\n\n然后，实现一个程序，为一组测试案例计算预测的最大伪速度。对于每个案例，程序应接受直接指定 $\\mu$ 或指定 $\\tau$、$dx$、$dt$ 和 $\\rho$，并从中计算出 $\\mu$。如果指定 $R = 0$，则将其解释为平面界面极限，并返回伪速度为精确的零。\n\n物理单位和输出要求：\n\n- 所有速度以米/秒（m/s）表示，四舍五入到六位小数。\n- 本问题不涉及角度。\n- 不使用百分比。\n\n测试套件和参数覆盖范围：\n\n- 案例1（一般弯曲界面情况；粘度由松弛时间计算）：$\\alpha = 0.5$，$\\sigma = 0.072$ N/m，$dx = 1.0 \\times 10^{-5}$ m，$R = 1.0 \\times 10^{-3}$ m，$\\tau = 0.8$，$\\rho = 1000$ kg/m$^3$，$dt = 5.0 \\times 10^{-7}$ s。\n- 案例2（平面界面边界情况）：$\\alpha = 0.5$，$\\sigma = 0.072$ N/m，$dx = 1.0 \\times 10^{-5}$ m，$R = 0$ m（平面界面极限），$\\mu = 0.02$ Pa·s。\n- 案例3（小半径边缘情况；粘度由松弛时间计算）：$\\alpha = 0.5$，$\\sigma = 0.072$ N/m，$dx = 1.0 \\times 10^{-5}$ m，$R = 5.0 \\times 10^{-5}$ m，$\\tau = 0.8$，$\\rho = 1000$ kg/m$^3$，$dt = 5.0 \\times 10^{-7}$ s。\n- 案例4（高粘度情况；直接指定粘度）：$\\alpha = 0.5$，$\\sigma = 0.072$ N/m，$dx = 1.0 \\times 10^{-5}$ m，$R = 1.0 \\times 10^{-3}$ m，$\\mu = 0.1$ Pa·s。\n- 案例5（零各向异性边缘情况）：$\\alpha = 0.0$，$\\sigma = 0.072$ N/m，$dx = 1.0 \\times 10^{-5}$ m，$R = 5.0 \\times 10^{-4}$ m，$\\mu = 0.02$ Pa·s。\n\n最终输出格式：\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[result1,result2,...]$），每个结果以 m/s 为单位，四舍五入到六位小数，并与上述测试案例的顺序相同。", "solution": "该问题是有效的，因为它在科学上基于计算流体动力学的原理，特别是针对多相流的格子玻尔兹曼方法（LBM）中数值伪影的分析。该问题是适定的、客观的，并为推导所要求的标度律和执行所需的计算提供了完整且一致的信息集。\n\n最大伪速度（表示为 $u_{max}$）的渐近标度推导过程如下。\n\n1.  **控制动量平衡：** 伪电流是由毛细力 $\\delta \\mathbf{f}$ 实现过程中的数值误差驱动的稳态流动现象。在低雷诺数极限下，该流动由稳态斯托克斯方程控制：\n    $$ 0 = -\\nabla p_{err} + \\mu \\nabla^2 \\mathbf{u} + \\delta \\mathbf{f} $$\n    此处，$\\mathbf{u}$ 是伪速度场，$p_{err}$ 是相关的误差压力场，$\\mu$ 是动力粘度。从此方程中，我们可以在粘性耗散项和驱动误差力项之间建立平衡：\n    $$ |\\mu \\nabla^2 \\mathbf{u}| \\sim |\\delta \\mathbf{f}| $$\n\n2.  **毛细力的表征：** 非理想状态方程在两流体相之间的界面处产生表面张力 $\\sigma$。如杨-拉普拉斯关系所述，该表面张力在弯曲界面上维持一个压力跳跃 $\\Delta p$：\n    $$ \\Delta p = \\sigma \\kappa $$\n    对于半径为 $R$ 的圆形界面，曲率为 $\\kappa = 1/R$。在 LBM 等数值方法中，该力不是真正的表面力，而是被涂抹在一个厚度为 $w$ 的弥散界面上。相应的力密度大小 $f_{\\sigma}$ 可以通过将压力跳跃分布在该厚度上来估算：\n    $$ f_{\\sigma} \\sim \\frac{\\Delta p}{w} = \\frac{\\sigma \\kappa}{w} = \\frac{\\sigma}{R w} $$\n\n3.  **误差力的表征：** 问题指出，伪电流源于离散力各向异性，它在毛细力的重构中引入了相对误差。该误差的大小由无量纲系数 $\\alpha$ 给出。因此，误差力密度的大小 $\\delta f = |\\delta \\mathbf{f}|$ 与物理力密度的大小成正比：\n    $$ \\delta f \\sim \\alpha f_{\\sigma} \\sim \\frac{\\alpha \\sigma}{R w} $$\n\n4.  **标度分析：** 现在我们将力的估算代入动量平衡。为了估算粘性项，设 $u_{max}$ 为特征伪速度。误差力 $\\delta \\mathbf{f}$ 在厚度为 $w$ 的界面区域内起作用。由此产生的流场最陡峭的速度梯度也将出现在这个相同的长度尺度上。因此，速度空间导数的特征长度为 $L \\sim w$。粘性项的标度如下：\n    $$ |\\mu \\nabla^2 \\mathbf{u}| \\sim \\mu \\frac{u_{max}}{L^2} \\sim \\mu \\frac{u_{max}}{w^2} $$\n    令标度化的粘性项和力项相等：\n    $$ \\mu \\frac{u_{max}}{w^2} \\sim \\frac{\\alpha \\sigma}{R w} $$\n\n5.  **速度标度的推导：** 求解上述关于 $u_{max}$ 的关系式可得：\n    $$ u_{max} \\sim \\frac{\\alpha \\sigma w^2}{\\mu R w} = \\frac{\\alpha \\sigma w}{\\mu R} $$\n\n6.  **引入格子离散化：** 问题指出，界面厚度 $w$ 与格子间距 $dx$ 成标度关系，即 $w \\sim \\mathcal{O}(dx)$。这是许多弥散界面 LBM 方案的一个基本属性。将此依赖关系代入我们对 $u_{max}$ 的标度中：\n    $$ u_{max} \\propto \\frac{\\alpha \\sigma \\, dx}{\\mu R} $$\n    对于一个显式的渐近公式，我们假设主阶比例常数为1。当未提供依赖于所用特定数值模板的精确预因子时，这是标度分析中的常见做法。最终公式为：\n    $$ u_{max} = \\frac{\\alpha \\sigma \\, dx}{\\mu R} $$\n    该表达式的单位是 $(\\text{N}/\\text{m}) \\cdot \\text{m} / ((\\text{Pa} \\cdot \\text{s}) \\cdot \\text{m}) = ((\\text{kg} \\cdot \\text{m}/\\text{s}^2)/\\text{m}) \\cdot \\text{m} / ((\\text{kg}/(\\text{m} \\cdot \\text{s})) \\cdot \\text{m}) = (\\text{kg}/\\text{s}^2) / (\\text{kg}/\\text{m}^2 \\cdot \\text{s}) = \\text{m}/\\text{s}$，这正确地是一个速度单位。\n\n7.  **状态方程（EOS）和平面极限的影响：**\n    - 非理想 EOS 是相分离以及因此产生的表面张力 $\\sigma$ 的物理根源。EOS 中更强的分子间势能导致更大的 $\\sigma$。推导出的公式 $u_{max} \\propto \\sigma$ 表明，假设所有其他参数恒定，更强的表面张力会导致成比例增大的伪电流。\n    - 在平面界面的极限下，曲率半径 $R \\to \\infty$。该公式正确地预测了伪电流会消失：\n      $$ \\lim_{R \\to \\infty} u_{max} = \\lim_{R \\to \\infty} \\frac{\\alpha \\sigma \\, dx}{\\mu R} = 0 $$\n      这在物理上是正确的，因为对于平面界面，曲率 $\\kappa=0$，意味着驱动毛细力为零，因此计算该力时的任何误差也必须为零。\n\n8.  **粘度的计算：** 当未直接提供动力粘度 $\\mu$ 时，必须根据 LBM 参数进行计算。运动粘度 $\\nu$ 由下式给出：\n    $$ \\nu = \\frac{dx^2}{3\\,dt}\\left(\\tau - \\frac{1}{2}\\right) $$\n    动力粘度则为 $\\mu = \\rho \\nu$，其中 $\\rho$ 是流体密度。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the maximum spurious speed in a lattice Boltzmann simulation\n    for a set of test cases based on a derived asymptotic scaling law.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: General curved-interface, viscosity from LBM params\n        {'alpha': 0.5, 'sigma': 0.072, 'dx': 1.0e-5, 'R': 1.0e-3, 'tau': 0.8, 'rho': 1000, 'dt': 5.0e-7},\n        # Case 2: Planar-interface limit\n        {'alpha': 0.5, 'sigma': 0.072, 'dx': 1.0e-5, 'R': 0, 'mu': 0.02},\n        # Case 3: Small-radius edge case\n        {'alpha': 0.5, 'sigma': 0.072, 'dx': 1.0e-5, 'R': 5.0e-5, 'tau': 0.8, 'rho': 1000, 'dt': 5.0e-7},\n        # Case 4: High-viscosity case, direct mu\n        {'alpha': 0.5, 'sigma': 0.072, 'dx': 1.0e-5, 'R': 1.0e-3, 'mu': 0.1},\n        # Case 5: Zero-anisotropy edge case\n        {'alpha': 0.0, 'sigma': 0.072, 'dx': 1.0e-5, 'R': 5.0e-4, 'mu': 0.02},\n    ]\n\n    results = []\n    for case in test_cases:\n        alpha = case['alpha']\n        sigma = case['sigma']\n        dx = case['dx']\n        R = case['R']\n\n        # Handle special cases that result in zero spurious speed.\n        # R=0 is defined as the planar-interface limit.\n        # alpha=0 means no anisotropy error.\n        if R == 0 or alpha == 0:\n            u_max = 0.0\n            results.append(f\"{u_max:.6f}\")\n            continue\n\n        # Determine dynamic viscosity mu\n        if 'mu' in case:\n            mu = case['mu']\n        else:\n            # Calculate mu from LBM parameters\n            tau = case['tau']\n            rho = case['rho']\n            dt = case['dt']\n            # Kinematic viscosity: nu = c_s^2 * (tau - 0.5) * dt\n            # For D2Q9, c_s^2 = (dx/dt)^2 / 3, so nu = (dx^2 / (3*dt)) * (tau - 0.5)\n            nu = (dx**2 / (3 * dt)) * (tau - 0.5)\n            mu = rho * nu\n\n        # Calculate maximum spurious speed using the derived formula\n        # u_max = (alpha * sigma * dx) / (mu * R)\n        u_max = (alpha * sigma * dx) / (mu * R)\n        \n        # Round and format the result\n        results.append(f\"{u_max:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3528746"}, {"introduction": "LBM 的强大之处不仅在于模拟牛顿流体，更在于其高度的灵活性，能够与其他数值方法耦合，以解决前沿的多物理场问题。本实践将指导你构建一个混合 LBM-有限差分 (FDM) 模型，用于模拟粘弹性流体（如聚合物溶液）的复杂行为 [@problem_id:3528785]。你将亲手实现 Oldroyd–B 本构方程的求解，并用它来捕捉高分子物理中的一个标志性现象——“线团-拉伸转变”，这充分展示了 LBM 在非牛顿流体和复杂流体领域的强大应用潜力。", "problem": "构建一个完整、可运行的程序，该程序实现一个二维混合格子玻尔兹曼方法（LBM），用于模拟由 Oldroyd–B 本构律建模的等温、不可压缩粘弹性流体。目标是在魏森伯格数增加时，捕捉并分类周期性强迫、空间周期性流动中的线团-拉伸转变。所有数学实体必须用 LaTeX 表示。所有量都是无量纲的（格子单位），因此不需要进行物理单位转换。\n\n您必须基于以下基本内容开始：\n- 带有额外聚合物应力的等温、不可压缩纳维-斯托克斯方程，\n$$\\rho\\left(\\partial_t \\mathbf{u} + \\mathbf{u}\\cdot\\nabla\\mathbf{u}\\right) = -\\nabla p + \\eta_s \\nabla^2 \\mathbf{u} + \\nabla\\cdot\\mathbf{\\tau} + \\mathbf{f}_{\\text{ext}}, \\quad \\nabla\\cdot\\mathbf{u} = 0,$$\n其中 $\\rho$ 是质量密度，$\\mathbf{u}$ 是速度场，$p$ 是压力，$\\eta_s$ 是溶剂粘度，$\\mathbf{\\tau}$ 是聚合物额外应力张量，$\\mathbf{f}_{\\text{ext}}$ 是外加体积力密度。\n\n- 带有上随流导数的聚合物应力 Oldroyd–B 本构方程，\n$$\\overset{\\nabla}{\\mathbf{\\tau}} + \\frac{1}{\\lambda}\\mathbf{\\tau} = \\frac{\\eta_p}{\\lambda}\\left(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\top}\\right),$$\n其中\n$$\\overset{\\nabla}{\\mathbf{\\tau}} \\equiv \\partial_t \\mathbf{\\tau} + \\mathbf{u}\\cdot\\nabla \\mathbf{\\tau} - \\left(\\nabla \\mathbf{u}\\right)^{\\top}\\cdot \\mathbf{\\tau} - \\mathbf{\\tau}\\cdot \\left(\\nabla \\mathbf{u}\\right),$$\n此处 $\\lambda$ 是聚合物弛豫时间，$\\eta_p$ 是聚合物对粘度的贡献。\n\n- D2Q9 格子上的单弛豫时间 Bhatnagar–Gross–Krook (BGK) 格子玻尔兹曼方法 (LBM) 用于溶剂动量动力学。在格子单位中，格子间距 $\\Delta x = 1$ 和时间步长 $\\Delta t = 1$，平衡分布函数使用标准的二阶展开，运动粘度通过以下公式与弛豫时间相关：\n$$\\nu = c_s^2\\left(\\tau_s - \\frac{1}{2}\\right), \\quad c_s^2 = \\frac{1}{3}.$$\n外部力和聚合物力通过一个一致的力项格式引入，该格式将体积力密度 $\\mathbf{F} = \\mathbf{f}_{\\text{ext}} + \\nabla\\cdot \\mathbf{\\tau}$ 添加到动量方程中。\n\n- 胡克哑铃在平面拉伸流中的线团-拉伸转变发生在临界魏森伯格数\n$$Wi_c = \\lambda \\dot{\\epsilon}_0 = \\frac{1}{2},$$\n其中 $\\dot{\\epsilon}_0$ 是滞止点附近的局部拉伸率。\n\n您必须在程序中设计并实现以下内容：\n\n1) 域和离散化。使用一个在 D2Q9 格子上离散化的方形周期性域，节点数为 $N \\times N$。所有场在两个方向上都是周期性的。使用 $N = 32$。定义波数\n$$k = m \\frac{2\\pi}{N},$$\n其中 $m = 4$。\n\n2) 外部强迫。使用体积力密度驱动一个四辊磨式周期性流动\n$$\\mathbf{f}_{\\text{ext}}(x,y) = f_0 \\begin{bmatrix} \\sin\\left(k x\\right)\\cos\\left(k y\\right) \\\\ -\\cos\\left(k x\\right)\\sin\\left(k y\\right) \\end{bmatrix}.$$\n对于与此强迫相平衡的斯托克斯流，稳态速度场具有以下形式\n$$\\mathbf{u}(x,y) \\approx U_0 \\begin{bmatrix} \\sin\\left(k x\\right)\\cos\\left(k y\\right) \\\\ -\\cos\\left(k x\\right)\\sin\\left(k y\\right) \\end{bmatrix},$$\n滞止点附近的拉伸率由 $\\dot{\\epsilon}_0 \\approx k U_0$ 给出，并且在斯托克斯极限下，振幅满足\n$$U_0 \\approx \\frac{f_0}{2\\nu k^2}.$$\n选择一个目标速度振幅 $U_0^\\star = 0.05$ 并根据下式确定 $f_0$\n$$f_0 = 2 \\nu k^2 U_0^\\star.$$\n\n3) LBM 溶剂求解器。实现一个 D2Q9 BGK LBM，弛豫时间为 $\\tau_s = 0.6$，因此\n$$\\nu = \\frac{1}{3}\\left(\\tau_s - \\frac{1}{2}\\right).$$\n使用 Guo 力项格式或等效的一致性方法来引入总体积力密度 $\\mathbf{F} = \\mathbf{f}_{\\text{ext}} + \\nabla\\cdot \\mathbf{\\tau}$。使用带有半步力修正的标准动量更新来计算宏观速度，\n$$\\rho \\mathbf{u} = \\sum_i \\mathbf{c}_i f_i + \\frac{1}{2}\\mathbf{F}, \\quad \\rho = \\sum_i f_i,$$\n其中 $f_i$ 是分布函数，$\\mathbf{c}_i$ 是离散格子速度。\n\n4) 聚合物应力演化。使用一个显式时间积分器为 Oldroyd–B 模型在格子单位中演化聚合物应力 $\\mathbf{\\tau}$，\n$$\\partial_t \\mathbf{\\tau} = - \\mathbf{u}\\cdot\\nabla \\mathbf{\\tau} + \\left(\\nabla \\mathbf{u}\\right)^{\\top}\\cdot \\mathbf{\\tau} + \\mathbf{\\tau}\\cdot \\left(\\nabla \\mathbf{u}\\right) - \\frac{1}{\\lambda}\\mathbf{\\tau} + \\frac{\\eta_p}{\\lambda}\\left(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\top}\\right).$$\n在周期性边界条件下，使用中心差分法离散化空间导数。为了进行数值正则化，引入一个小的、均匀的人工应力扩散项 $\\kappa \\nabla^2 \\mathbf{\\tau}$，其中常数 $\\kappa$ 满足 $\\kappa \\ll 1$。使用 $\\kappa = 10^{-4}$。使用 $\\eta_p = 0.02$ 并在所有位置初始化 $\\mathbf{\\tau} = \\mathbf{0}$。\n\n5) 线团-拉伸检测。设滞止点附近的拉伸率近似为 $\\dot{\\epsilon}_0 \\approx k U_0^\\star$。临界弛豫时间为\n$$\\lambda_c = \\frac{1}{2 \\dot{\\epsilon}_0} = \\frac{1}{2 k U_0^\\star}.$$\n定义一个包含三个弛豫时间的测试套件，\n$$\\lambda_1 = 0.8\\,\\lambda_c, \\quad \\lambda_2 = 1.0\\,\\lambda_c, \\quad \\lambda_3 = 1.4\\,\\lambda_c.$$\n对于每个 $\\lambda_j$，运行耦合的 LBM–Oldroyd–B 模拟 $T$ 个时间步，其中 $T = 2000$。在每一步，计算\n$$M(t) = \\max_{x,y} \\operatorname{tr}\\left(\\mathbf{\\tau}(x,y,t)\\right),$$\n并记录 $M(t)$。在舍弃了 $T_b = 500$ 步的初始瞬态后，通过对最后 $W$ 步的 $\\log\\left(M(t) + \\delta\\right)$ 进行直线拟合来估计指数增长率，其中 $W = 400$，$\\delta = 10^{-12}$ 以避免对零取对数。如果拟合的斜率 $s$ 满足 $s > s_{\\text{th}}$ 且 $s_{\\text{th}} = 5\\times 10^{-4}$，则将状态分类为“拉伸”，否则分类为“线团”。如果在任何时候 $\\max_t M(t)$ 超过一个大的截止值 $M_{\\max} = 10^6$，则立即将该情况分类为“拉伸”。\n\n6) 测试套件和最终输出。使用固定参数 $N = 32$、$m = 4$、$\\tau_s = 0.6$、$\\eta_p = 0.02$、$\\kappa = 10^{-4}$、$U_0^\\star = 0.05$、$T = 2000$、$T_b = 500$、$W = 400$、$\\delta = 10^{-12}$、$s_{\\text{th}} = 5\\times 10^{-4}$、$M_{\\max} = 10^6$ 和 $\\rho = 1$。三个测试用例是上面定义的弛豫时间 $\\lambda_1$、$\\lambda_2$、$\\lambda_3$。您的程序应生成单行输出，其中包含一个用方括号括起来的、逗号分隔的布尔值列表（例如，“[False,False,True]”），分别对应于 $\\lambda_1$、$\\lambda_2$ 和 $\\lambda_3$ 的线团-拉伸分类。所有输出均为无量纲。", "solution": "用户要求构建一个用于粘弹性流体的混合数值模拟。该问题提法明确，具有科学依据，并提供了构建唯一解所需的所有参数和方程。该方法将结合用于溶剂流体动力学的格子玻尔兹曼方法（LBM）和用于演化由 Oldroyd-B 本构模型控制的聚合物额外应力张量的有限差分法（FDM）。\n\n模拟过程如下：\n\n首先，我们建立计算域和初始条件。使用一个尺寸为 $N \\times N$（$N=32$）的二维方形域，在两个方向上都具有周期性边界条件。格子位置由整数坐标 $(i,j)$ 表示，其中 $i, j \\in \\{0, 1, \\dots, N-1\\}$。相应的物理坐标为 $(x, y) = (i \\Delta x, j \\Delta y)$，其中格子间距设为 $\\Delta x = \\Delta y = 1$。所有场都初始化为静止状态：速度 $\\mathbf{u}(x,y,0) = \\mathbf{0}$，常数密度 $\\rho(x,y,0) = \\rho_0=1$，以及零聚合物应力 $\\mathbf{\\tau}(x,y,0) = \\mathbf{0}$。\n\n流动由一个不随时间变化的外部体积力驱动，形成一个四辊磨图案：\n$$\n\\mathbf{f}_{\\text{ext}}(x,y) = f_0 \\begin{bmatrix} \\sin(kx)\\cos(ky) \\\\ -\\cos(kx)\\sin(ky) \\end{bmatrix}\n$$\n其中波数为 $k = m \\frac{2\\pi}{N}$ 且 $m=4$。力的振幅 $f_0$ 被选择以在斯托克斯流极限下匹配目标速度振幅 $U_0^\\star = 0.05$，由 $f_0 = 2\\nu k^2 U_0^\\star$ 给出。溶剂的运动粘度由 LBM 弛豫参数 $\\tau_s=0.6$ 确定为 $\\nu = c_s^2(\\tau_s - 1/2)$，其中格子声速的平方为 $c_s^2 = 1/3$。\n\n模拟以离散的时间步长 $\\Delta t=1$ 进行演化。在每个时间步，执行以下计算序列：\n\n1.  **聚合物力计算**：聚合物应力张量 $\\mathbf{\\tau}$ 通过其散度 $\\mathbf{F}_p = \\nabla \\cdot \\mathbf{\\tau}$ 对流体施加一个力。该力的分量为：\n    $$\n    (\\mathbf{F}_p)_x = \\frac{\\partial \\tau_{xx}}{\\partial x} + \\frac{\\partial \\tau_{xy}}{\\partial y} \\quad \\text{和} \\quad (\\mathbf{F}_p)_y = \\frac{\\partial \\tau_{yx}}{\\partial x} + \\frac{\\partial \\tau_{yy}}{\\partial y}\n    $$\n    假设应力张量对称（$\\tau_{xy} = \\tau_{yx}$），这些导数在网格上使用带周期性边界条件的二阶中心差分格式计算。对于一个通用场 $\\phi(x,y)$，其导数近似为：\n    $$\n    \\frac{\\partial \\phi}{\\partial x}\\bigg|_{(i,j)} \\approx \\frac{\\phi_{i+1,j} - \\phi_{i-1,j}}{2\\Delta x}, \\quad \\frac{\\partial \\phi}{\\partial y}\\bigg|_{(i,j)} \\approx \\frac{\\phi_{i,j+1} - \\phi_{i,j-1}}{2\\Delta y}\n    $$\n\n2.  **用于溶剂动力学的 LBM 求解器**：溶剂的运动使用带有 Bhatnagar-Gross-Krook (BGK) 碰撞算子的 D2Q9 格子玻尔兹曼格式进行建模。对于 9 个格子速度 $\\mathbf{c}_i$ 中的每一个，其离散粒子分布函数 $f_i(\\mathbf{x}, t)$ 的演化分为碰撞和迁移两个步骤。作用在流体上的总力密度为 $\\mathbf{F} = \\mathbf{f}_{\\text{ext}} + \\mathbf{F}_p$。\n\n    a. **宏观变量**：宏观流体密度 $\\rho$ 和速度 $\\mathbf{u}$ 从分布函数中恢复。速度计算包含 Guo 力项修正：\n    $$\n    \\rho = \\sum_{i=0}^{8} f_i, \\quad \\rho \\mathbf{u} = \\sum_{i=0}^{8} \\mathbf{c}_i f_i + \\frac{\\Delta t}{2}\\mathbf{F}\n    $$\n\n    b. **碰撞**：碰撞后的分布函数 $f_i^*$ 通过将当前分布 $f_i$ 向局部平衡态 $f_i^{\\text{eq}}$ 松弛并添加一个力项 $S_i$ 来计算：\n    $$\n    f_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x}, t) - \\frac{\\Delta t}{\\tau_s} \\left(f_i(\\mathbf{x}, t) - f_i^{\\text{eq}}(\\rho, \\mathbf{u})\\right) + \\Delta t \\, S_i\n    $$\n    平衡分布函数 $f_i^{\\text{eq}}$ 是一个关于速度的二阶多项式：\n    $$\n    f_i^{\\text{eq}} = w_i \\rho \\left( 1 + \\frac{\\mathbf{c}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})^2}{2c_s^4} - \\frac{\\mathbf{u} \\cdot \\mathbf{u}}{2c_s^2} \\right)\n    $$\n    其中 $w_i$ 是标准的 D2Q9 权重。Guo 力项 $S_i$ 由下式给出：\n    $$\n    S_i = \\left(1 - \\frac{1}{2\\tau_s}\\right) w_i \\left[ \\frac{\\mathbf{c}_i - \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})\\mathbf{c}_i}{c_s^4} \\right] \\cdot \\mathbf{F}\n    $$\n\n    c. **迁移**：分布函数根据其离散速度传播到相邻的格点：\n    $$\n    f_i(\\mathbf{x} + \\mathbf{c}_i \\Delta t, t + \\Delta t) = f_i^*(\\mathbf{x}, t)\n    $$\n\n3.  **用于聚合物应力的 FDM 求解器**：聚合物应力张量 $\\mathbf{\\tau}$ 根据 Oldroyd-B 本构方程进行演化，该方程使用一阶向前欧拉格式进行显式时间积分。问题中提供的方程是：\n    $$\n    \\partial_t \\mathbf{\\tau} = - \\mathbf{u}\\cdot\\nabla \\mathbf{\\tau} + \\left(\\nabla \\mathbf{u}\\right)^{\\top}\\cdot \\mathbf{\\tau} + \\mathbf{\\tau}\\cdot \\left(\\nabla \\mathbf{u}\\right) - \\frac{1}{\\lambda}\\mathbf{\\tau} + \\frac{\\eta_p}{\\lambda}\\left(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\top}\\right) + \\kappa \\nabla^2 \\mathbf{\\tau}\n    $$\n    这里，$\\lambda$ 是聚合物弛豫时间，$\\eta_p=0.02$ 是聚合物粘度，$\\kappa=10^{-4}$ 是用于数值稳定的人工应力扩散系数。速度 $\\mathbf{u}$ 及其梯度张量 $\\nabla \\mathbf{u}$ 从 LBM 步骤中获得。右手边的所有空间导数（对流项 $\\mathbf{u}\\cdot\\nabla \\mathbf{\\tau}$、$\\nabla \\mathbf{u}$ 中的速度梯度以及拉普拉斯算子 $\\nabla^2 \\mathbf{\\tau}$）都使用中心差分法计算。由于 $\\mathbf{\\tau}$ 是对称的，因此只演化其分量 $\\tau_{xx}$、$\\tau_{yy}$ 和 $\\tau_{xy}$。\n\n4.  **线团-拉伸转变分析**：针对三个不同的弛豫时间 $\\lambda$ 值进行模拟，这些值是相对于理想拉伸流中线团-拉伸转变的临界值 $\\lambda_c$ 确定的。特征应变率估计为 $\\dot{\\epsilon}_0 \\approx k U_0^\\star$，这得出 $\\lambda_c = (2\\dot{\\epsilon}_0)^{-1}$。测试用例为 $\\lambda_1 = 0.8\\lambda_c$、$\\lambda_2 = 1.0\\lambda_c$ 和 $\\lambda_3 = 1.4\\lambda_c$。\n\n    对于每种情况，模拟运行 $T=2000$ 个时间步。在每一步记录应力张量的最大迹，$M(t) = \\max_{x,y} \\operatorname{tr}(\\mathbf{\\tau}(x,y,t))$。如果 $M(t)$ 超过一个爆破阈值 $M_{\\max}=10^6$，状态将立即被分类为“拉伸”。否则，在整个模拟结束后，分析 $t \\in [T-W, T-1)$ 区间内的时间序列 $\\log(M(t)+\\delta)$，其中瞬态周期为 $T_b=500$ 步，分析窗口大小为 $W=400$ 步。对这些数据进行线性回归，如果得到的斜率 $s$ 大于阈值 $s_{\\text{th}}=5 \\times 10^{-4}$，则该状态被分类为“拉伸”。否则，它被分类为“线团”。然后报告这三种情况的布尔结果。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a hybrid LBM-FDM solver for a 2D viscoelastic fluid (Oldroyd-B model)\n    to study the coil-stretch transition in a four-roll mill flow.\n    \"\"\"\n\n    # 1) Domain and discretization parameters\n    N = 32\n    m = 4\n    k = m * 2.0 * np.pi / N\n\n    # Simulation and analysis parameters\n    T = 2000\n    T_b = 500  # Burn-in/transient time\n    W = 400    # Analysis window size\n    delta_log = 1e-12\n    s_th = 5e-4\n    M_max = 1e6\n    assert T > T_b + W\n\n    # LBM parameters\n    rho0 = 1.0\n    tau_s = 0.6\n    c_s_sq = 1.0 / 3.0\n    nu = c_s_sq * (tau_s - 0.5)  # Kinematic viscosity eta_s / rho\n    \n    # D2Q9 lattice parameters\n    c = np.array([[0, 0], [1, 0], [0, 1], [-1, 0], [0, -1],\n                  [1, 1], [-1, 1], [-1, -1], [1, -1]], dtype=np.int32)\n    w = np.array([4.0/9.0, 1.0/9.0, 1.0/9.0, 1.0/9.0, 1.0/9.0,\n                  1.0/36.0, 1.0/36.0, 1.0/36.0, 1.0/36.0])\n\n    # Fluid and polymer parameters\n    U0_star = 0.05\n    f0 = 2.0 * nu * k**2 * U0_star\n    eta_p = 0.02\n    kappa = 1e-4\n\n    # 2) External forcing setup\n    x = np.arange(N)\n    y = np.arange(N)\n    X, Y = np.meshgrid(x, y)\n    \n    f_ext = np.zeros((2, N, N))\n    f_ext[0, :, :] = f0 * np.sin(k * X) * np.cos(k * Y)\n    f_ext[1, :, :] = -f0 * np.cos(k * X) * np.sin(k * Y)\n\n    # 5) Coil–stretch detection parameters\n    epsilon0_dot = k * U0_star\n    lambda_c = 0.5 / epsilon0_dot\n    lambdas = [0.8 * lambda_c, 1.0 * lambda_c, 1.4 * lambda_c]\n\n    results = []\n\n    # Helper functions for finite differences (periodic BCs, dx=dy=1)\n    def grad_x(field):\n        return (np.roll(field, -1, axis=1) - np.roll(field, 1, axis=1)) / 2.0\n\n    def grad_y(field):\n        return (np.roll(field, -1, axis=0) - np.roll(field, 1, axis=0)) / 2.0\n\n    def laplacian(field):\n        return (np.roll(field, 1, axis=1) + np.roll(field, -1, axis=1) +\n                np.roll(field, 1, axis=0) + np.roll(field, -1, axis=0) - 4.0 * field)\n\n    for lam in lambdas:\n        # Initialization for each simulation run\n        # LBM fields\n        f = np.zeros((9, N, N))\n        for i in range(9):\n            f[i, :, :] = w[i] * rho0\n        \n        rho = np.full((N, N), rho0)\n        u = np.zeros((2, N, N))\n        \n        # Polymer stress fields (symmetric tensor)\n        tau_xx = np.zeros((N, N))\n        tau_yy = np.zeros((N, N))\n        tau_xy = np.zeros((N, N))\n\n        max_trace_history = np.zeros(T)\n        is_stretched = False\n\n        for t in range(T):\n            # Compute polymer force F_p = div(tau)\n            Fp_x = grad_x(tau_xx) + grad_y(tau_xy)\n            Fp_y = grad_x(tau_xy) + grad_y(tau_yy)\n            \n            # Total force F = f_ext + F_p\n            F = f_ext.copy()\n            F[0] += Fp_x\n            F[1] += Fp_y\n\n            # LBM Step\n            # Macroscopic properties\n            rho = np.sum(f, axis=0)\n            u[0] = (np.sum(f * c[:, 0, np.newaxis, np.newaxis], axis=0) + 0.5 * F[0]) / rho\n            u[1] = (np.sum(f * c[:, 1, np.newaxis, np.newaxis], axis=0) + 0.5 * F[1]) / rho\n\n            # Collision\n            f_eq = np.zeros_like(f)\n            u_dot_u = u[0]**2 + u[1]**2\n            for i in range(9):\n                cu = c[i, 0] * u[0] + c[i, 1] * u[1]\n                f_eq[i] = w[i] * rho * (1 + cu / c_s_sq + cu**2 / (2 * c_s_sq**2) - u_dot_u / (2 * c_s_sq))\n            \n            # Guo forcing term\n            S = np.zeros_like(f)\n            force_factor = 1.0 - 0.5 / tau_s\n            for i in range(9):\n                cu = c[i, 0] * u[0] + c[i, 1] * u[1]\n                force_term_dot_F = ( (c[i,0]-u[0])*F[0] + (c[i,1]-u[1])*F[1] ) / c_s_sq \\\n                                 + ( cu*(c[i,0]*F[0]+c[i,1]*F[1]) ) / (c_s_sq**2)\n                S[i] = force_factor * w[i] * force_term_dot_F\n            \n            f_coll = f - (1.0 / tau_s) * (f - f_eq) + S\n            \n            # Streaming\n            for i in range(9):\n                f[i] = np.roll(f_coll[i], shift=(c[i, 1], c[i, 0]), axis=(0, 1))\n\n            # FDM Step for Polymer Stress (Forward Euler)\n            # Velocity gradients\n            duxdx = grad_x(u[0])\n            duxdy = grad_y(u[0])\n            duydx = grad_x(u[1])\n            duydy = grad_y(u[1])\n            \n            # Terms from Oldroyd-B equation\n            # Convection term: -u . grad(tau)\n            conv_xx = -(u[0] * grad_x(tau_xx) + u[1] * grad_y(tau_xx))\n            conv_yy = -(u[0] * grad_x(tau_yy) + u[1] * grad_y(tau_yy))\n            conv_xy = -(u[0] * grad_x(tau_xy) + u[1] * grad_y(tau_xy))\n            \n            # Stretching/rotation term in problem statement\n            # (nabla u)^T . tau + tau . (nabla u)\n            stretch_rot_xx = 2 * (duxdx * tau_xx + duxdy * tau_xy)\n            stretch_rot_yy = 2 * (duydy * tau_yy + duydx * tau_xy)\n            stretch_rot_xy = (duxdx + duydy) * tau_xy + duydx * tau_yy + duxdy * tau_xx\n            \n            # Relaxation term: -tau / lambda\n            relax_xx = -tau_xx / lam\n            relax_yy = -tau_yy / lam\n            relax_xy = -tau_xy / lam\n            \n            # Strain term: (eta_p/lambda) * (nabla u + (nabla u)^T)\n            strain_rate_factor = eta_p / lam\n            strain_xx = strain_rate_factor * (2 * duxdx)\n            strain_yy = strain_rate_factor * (2 * duydy)\n            strain_xy = strain_rate_factor * (duxdy + duydx)\n            \n            # Artificial diffusion: kappa * laplacian(tau)\n            diff_xx = kappa * laplacian(tau_xx)\n            diff_yy = kappa * laplacian(tau_yy)\n            diff_xy = kappa * laplacian(tau_xy)\n\n            # Update stress tensor (dt=1)\n            tau_xx += conv_xx + stretch_rot_xx + relax_xx + strain_xx + diff_xx\n            tau_yy += conv_yy + stretch_rot_yy + relax_yy + strain_yy + diff_yy\n            tau_xy += conv_xy + stretch_rot_xy + relax_xy + strain_xy + diff_xy\n\n            # Analysis\n            trace_tau = tau_xx + tau_yy\n            max_trace_history[t] = np.max(trace_tau)\n\n            if max_trace_history[t] > M_max:\n                is_stretched = True\n                break\n        \n        if not is_stretched:\n            # Perform linear regression on log(M(t)) for t in [T-W, T)\n            analysis_time = np.arange(T - W, T)\n            analysis_data = np.log(max_trace_history[T - W:T] + delta_log)\n            # numpy.polyfit fits a polynomial p(x) = p[0] * x**deg + ... + p[deg]\n            # For deg=1, p[0] is the slope.\n            slope, _ = np.polyfit(analysis_time, analysis_data, 1)\n            if slope > s_th:\n                is_stretched = True\n        \n        results.append(is_stretched)\n\n    print(f\"[{','.join(map(str, results))}]\".replace(\"True\", \"True\").replace(\"False\", \"False\"))\n\nsolve()\n\n```", "id": "3528785"}]}