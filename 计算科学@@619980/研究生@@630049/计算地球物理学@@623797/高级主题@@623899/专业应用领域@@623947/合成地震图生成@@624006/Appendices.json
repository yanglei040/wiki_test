{"hands_on_practices": [{"introduction": "在生成任何合成数据之前，我们必须首先正确设计计算网格以避免产生数值伪影。本练习将指导您推导空间采样准则，这是防止空间混叠的关键一步，它建立了接收器间距与介质中的最低波速、信号的最高频率以及波的出现角之间的关系。掌握此项技能是确保您合成地震图保真度的基础。", "problem": "您正在使用有限差分（FD）模拟，为一个各向同性的声学介质设计一个二维合成炮集。检波器将沿着一条水平线以均匀间距 $\\Delta x$ 布置。模拟的震源是一个带限子波，其时间谱在指定的最高频率 $f_{\\max}$ 之上可以忽略不计。为了确保对于在检波器线上视出射角（从垂线方向测量）不超过预设最大值 $\\theta_{\\max}$ 的任何事件，炮集都不会出现空间假频，您必须选择足够小的 $\\Delta x$ 以满足数据中存在的所有平面波分量的空间采样要求。\n\n从以下基本原理出发：\n- 二维常系数声波方程，其单色平面波解 $p(x,z,t)=A \\exp\\{ \\mathrm{i}(\\omega t - k_x x - k_z z)\\}$ 满足频散关系 $\\omega^{2} = v^{2}(k_x^{2} + k_z^{2})$，其中 $v$ 是相速度，$\\omega=2\\pi f$ 是角频率，$(k_x, k_z)$ 是波数矢量。\n- 空间奈奎斯特采样定理，该定理指出，如果一个在波数 $k_x$ 上带限的场，其波数支撑域满足 $|k_x| \\leq \\pi/\\Delta x$，则可以在间距为 $\\Delta x$ 的空间网格上进行采样而不会产生假频，\n\n当模型中的最小相速度为 $v_{\\min}$ 时，推导一个保守的表达式，用于计算最大允许检波器间距 $\\Delta x$，该间距可以防止在所有时间频率（最高至 $f_{\\max}$）和所有出射角（最大至 $\\theta_{\\max}$）下出现空间假频。然后，使用以下设计参数对此间距进行数值计算\n$$v_{\\min} = 2.000 \\times 10^{3} \\text{ m/s}, \\quad f_{\\max} = 1.00 \\times 10^{2} \\text{ Hz}, \\quad \\theta_{\\max} = 60.0^\\circ.$$\n\n最终间距以米为单位表示，并将您的答案四舍五入到四位有效数字。角度使用度数。", "solution": "### 步骤 1：提取已知条件\n- **系统**：二维各向同性声学介质。\n- **任务**：使用有限差分（FD）模拟设计合成炮集。\n- **几何**：检波器沿水平线以均匀间距 $\\Delta x$ 布置。\n- **震源子波**：带限，最高时间频率为 $f_{\\max}$。\n- **核心约束**：对于视出射角 $\\theta$（从垂线方向测量）最大达到 $\\theta_{\\max}$ 的所有事件，避免空间假频。\n- **控制物理**：\n    - 单色平面波解为 $p(x,z,t)=A \\exp\\{ \\mathrm{i}(\\omega t - k_x x - k_z z)\\}$。\n    - 频散关系为 $\\omega^{2} = v^{2}(k_x^{2} + k_z^{2})$，其中 $v$ 是相速度，$\\omega = 2\\pi f$ 是角频率，$(k_x, k_z)$ 是波数矢量。\n- **采样理论**：空间奈奎斯特定理指出，对于带限场，如果 $|k_x| \\leq \\pi/\\Delta x$，则可避免假频。\n- **目标**：推导最大允许检波器间距 $\\Delta x$ 的保守表达式，并进行数值计算。\n- **模型参数**：\n    - 最小相速度：$v_{\\min}$。\n    - 最高频率：$f_{\\max}$。\n    - 最大出射角：$\\theta_{\\max}$。\n- **数值**：\n    - $v_{\\min} = 2.000 \\times 10^{3} \\text{ m/s}$\n    - $f_{\\max} = 1.00 \\times 10^{2} \\text{ Hz}$\n    - $\\theta_{\\max} = 60.0^\\circ$\n\n### 步骤 2：推导与计算\n\n推导过程首先建立水平波数 $k_x$、频率 $f$、速度 $v$ 和出射角 $\\theta$ 之间的关系。然后，我们在指定约束下确定 $k_x$ 的最大可能值，并应用奈奎斯特采样准则来找到相应的最大允许检波器间距 $\\Delta x$。\n\n对于单色平面波，波数矢量 $\\vec{k}$ 的大小由 $k = |\\vec{k}| = \\sqrt{k_x^2 + k_z^2}$ 给出。根据频散关系 $\\omega^2 = v^2 k^2$，这意味着 $k = \\omega/v$。由于 $\\omega = 2\\pi f$，我们有：\n$$k = \\frac{2\\pi f}{v}$$\n出射角 $\\theta$ 是从垂直（$z$）轴测量的。因此，波数矢量的分量通过 $k_x = k \\sin\\theta$ 和 $k_z = k \\cos\\theta$ 与角度 $\\theta$ 相关。代入 $k$ 的表达式，我们得到水平波数 $k_x$：\n$$k_x = \\frac{2\\pi f}{v} \\sin\\theta$$\n空间奈奎斯特采样定理要求采样间隔 $\\Delta x$ 必须足够小，以捕捉信号中存在的最高水平波数而不产生假频。条件是 $|k_x| \\le k_{x, \\text{Nyquist}} = \\frac{\\pi}{\\Delta x}$。为确保该条件对模拟中所有可能的波都成立，我们必须考虑使 $|k_x|$ 最大化的最坏情况。这将得出一个保守的（即足够小的）采样间隔。\n\n$|k_x|$ 的大小在以下情况下最大化：\n1. 频率 $f$ 处于其最大值 $f_{\\max}$。\n2. 相速度 $v$ 处于其最小值 $v_{\\min}$。对于给定的频率，较低速度的介质会导致较短的波长，因此波数较大。\n3. 项 $|\\sin\\theta|$ 被最大化。鉴于角度 $\\theta$ 的范围可以从 $0$ 到 $\\theta_{\\max}$，并且 $\\sin\\theta$ 在区间 $[0^\\circ, 90^\\circ]$ 上是单调递增函数，其最大值出现在 $\\theta = \\theta_{\\max}$ 时。\n\n结合这些因素，得到绝对最大水平波数 $k_{x, \\text{abs_max}}$：\n$$k_{x, \\text{abs_max}} = \\frac{2\\pi f_{\\max}}{v_{\\min}} \\sin\\theta_{\\max}$$\n对于此最大波数，检波器间距 $\\Delta x$ 的无假频条件必须成立：\n$$k_{x, \\text{abs_max}} \\le \\frac{\\pi}{\\Delta x}$$\n代入 $k_{x, \\text{abs_max}}$ 的表达式：\n$$\\frac{2\\pi f_{\\max}}{v_{\\min}} \\sin\\theta_{\\max} \\le \\frac{\\pi}{\\Delta x}$$\n求解 $\\Delta x$，我们找到对检波器间距的约束：\n$$\\Delta x \\le \\frac{\\pi v_{\\min}}{2\\pi f_{\\max} \\sin\\theta_{\\max}}$$\n简化此表达式，得到保证无空间假频的最大允许检波器间距 $\\Delta x_{\\max}$ 的公式：\n$$\\Delta x_{\\max} = \\frac{v_{\\min}}{2 f_{\\max} \\sin\\theta_{\\max}}$$\n这就是推导出的检波器间距的保守表达式。\n\n接下来，我们使用给定的数值来评估这个表达式：\n- $v_{\\min} = 2.000 \\times 10^{3} \\text{ m/s}$\n- $f_{\\max} = 1.00 \\times 10^{2} \\text{ Hz}$\n- $\\theta_{\\max} = 60.0^\\circ$\n\n我们注意到 $\\sin(60.0^\\circ) = \\frac{\\sqrt{3}}{2}$。\n\n将这些值代入 $\\Delta x_{\\max}$ 的公式中：\n$$\\Delta x_{\\max} = \\frac{2.000 \\times 10^{3}}{2 \\times (1.00 \\times 10^{2}) \\times \\sin(60.0^\\circ)}$$\n$$\\Delta x_{\\max} = \\frac{2000}{2 \\times 100 \\times \\frac{\\sqrt{3}}{2}} = \\frac{2000}{100\\sqrt{3}} = \\frac{20}{\\sqrt{3}}$$\n计算数值：\n$$\\Delta x_{\\max} \\approx 11.54700538... \\text{ m}$$\n根据题目要求，结果必须四舍五入到四位有效数字。\n$$\\Delta x_{\\max} \\approx 11.55 \\text{ m}$$", "answer": "$$\\boxed{11.55}$$", "id": "3615906"}, {"introduction": "合成地震图由地质界面上的反射构成，而这些反射是由岩石物理性质的变化所控制的。本练习将探究基本的正入射反射系数，并要求您量化在地震振幅分析中，使用像伽德纳定律（Gardner's Law）这样的经验关系来估算密度，而非使用实测密度数据时，所引入的振幅偏差。通过这个练习，您可以加深对振幅变化及其背后假设的理解，这是定量地震解释中的一项核心技能。", "problem": "您将获得一组代表一维声学地球模型中平面水平界面的层对。每一层都是均匀、各向同性且无损的。一束正入射的平面压缩波向下传播，并与每个界面发生相互作用。对于每个界面，您需要评估使用经验密度-速度幂律关系从压缩波速估计密度，相对于使用实测密度，会在正入射反射系数中引入多大的偏差。\n\n从以下基本原理出发：\n- 在一维、线性、无损的声学介质中，正入射平面波穿过平面界面时，声压和质点速度是连续的。\n- 声阻抗 $Z$ 的定义，其等于体积密度与压缩波速的乘积。\n- 存在一个广泛使用的经验幂律关系，它将体积密度与压缩波速联系起来，该关系最初由实验室和测井数据建立，并由两个正常数参数化。\n\n需要执行的任务和计算的量：\n1. 仅使用上述基本原理，推导两个声学半空间界面处的正入射反射系数，用上、下介质的声阻抗表示。\n2. 使用连接体积密度和压缩波速的经验幂律关系（常数为 $a_g$ 和 $b_g$），将其转换为与本问题中指定单位一致的形式。要使用的标准常数为 $a_g=0.31$ 和 $b_g=0.25$，它们将单位为米/秒的压缩波速映射到单位为克/立方厘米的体积密度。请将此关系转换为输出单位为千克/立方米的密度。您的程序必须统一使用米/秒作为压缩波速单位，千克/立方米作为密度单位。\n3. 对于下面的每个测试界面，计算：\n   - 使用两层中的实测密度计算真实反射系数 $R_{\\text{true}}$。\n   - 通过将实测密度替换为使用您在第2步中建立的单位一致的经验幂律关系从压缩波速估计出的密度，计算Gardner估计的反射系数 $R_{\\text{est}}$。\n   - 有符号振幅偏差 $\\Delta R = R_{\\text{est}} - R_{\\text{true}}$。该量为无量纲，必须以十进制数报告。\n\n数值和单位要求：\n- 压缩波速 $V_P$ 使用单位米/秒。\n- 密度 $\\rho$ 使用单位千克/立方米。\n- 反射系数和振幅偏差是无量纲的。\n- 将每个报告的振幅偏差四舍五入到六位小数。\n\n测试集：\n为以下五个界面计算有符号振幅偏差 $\\Delta R$，每个界面由四元组 $(V_{P1}, \\rho_1, V_{P2}, \\rho_2)$ 指定，其中下标 $1$ 表示上层，下标 $2$ 表示下层。$V_P$ 的单位是米/秒，$\\rho$ 的单位是千克/立方米。\n\n- 情况 1：$(V_{P1}, \\rho_1, V_{P2}, \\rho_2) = (2200, 2150, 2600, 2350)$\n- 情况 2：$(V_{P1}, \\rho_1, V_{P2}, \\rho_2) = (2500, 2200, 6000, 2700)$\n- 情况 3：$(V_{P1}, \\rho_1, V_{P2}, \\rho_2) = (1500, 1800, 1700, 1850)$\n- 情况 4（构造为真实阻抗差为零）：$(V_{P1}, \\rho_1, V_{P2}, \\rho_2) = (2000, 2000, 1600, 2500)$\n- 情况 5（含气砂岩示例）：$(V_{P1}, \\rho_1, V_{P2}, \\rho_2) = (2750, 2400, 2000, 1700)$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含五个测试用例的有符号振幅偏差，格式为用方括号括起来的逗号分隔列表，并四舍五入到六位小数，例如 $[\\Delta R_1,\\Delta R_2,\\Delta R_3,\\Delta R_4,\\Delta R_5]$。输出字符串中不能有空格。由于每个 $\\Delta R$ 都是无量纲的，因此不应打印任何单位。", "solution": "### 第1步：正入射反射系数的推导\n\n两个声学介质之间平面界面上的正入射反射系数 $R$ 可以从声压和质点速度连续的边界条件推导出来。\n\n设界面位于平面 $z=0$ 处。上层介质 ($z0$) 是层1，其性质为 ($\\rho_1$, $V_{P1}$)，下层介质 ($z>0$) 是层2，其性质为 ($\\rho_2$, $V_{P2}$)。一束谐和平面压缩波沿z轴正方向向下传播。\n\n平面波的声压 $P(z,t)$ 和质点速度的法向分量 $u(z,t)$ 可以用位移势 $\\phi(z,t)$ 表示：\n$$P(z,t) = -\\rho \\frac{\\partial \\phi}{\\partial t}$$\n$$u(z,t) = \\frac{\\partial \\phi}{\\partial z}$$\n\n对于角频率为 $\\omega$ 的谐和波，位移势为：\n- 在层1中：$\\phi_1(z,t) = \\left( A_I e^{-ik_1 z} + A_R e^{ik_1 z} \\right) e^{i\\omega t}$\n- 在层2中：$\\phi_2(z,t) = A_T e^{-ik_2 z} e^{i\\omega t}$\n\n这里，$A_I$、$A_R$ 和 $A_T$ 分别是入射波、反射波和透射波的复振幅。各层中的波数为 $k_j = \\omega/V_{Pj}$，其中 $j=1,2$。\n\n各层中的压力和质点速度为：\n- 层1：\n  - $P_1(z,t) = -i\\omega\\rho_1 \\left( A_I e^{-ik_1 z} + A_R e^{ik_1 z} \\right) e^{i\\omega t}$\n  - $u_1(z,t) = -ik_1 \\left( A_I e^{-ik_1 z} - A_R e^{ik_1 z} \\right) e^{i\\omega t}$\n- 层2：\n  - $P_2(z,t) = -i\\omega\\rho_2 A_T e^{-ik_2 z} e^{i\\omega t}$\n  - $u_2(z,t) = -ik_2 A_T e^{-ik_2 z} e^{i\\omega t}$\n\n在 $z=0$ 处应用边界条件：\n1.  压力连续性：$P_1(0,t) = P_2(0,t)$\n    $$\\rho_1 (A_I + A_R) = \\rho_2 A_T$$\n2.  质点速度连续性：$u_1(0,t) = u_2(0,t)$\n    $$k_1 (A_I - A_R) = k_2 A_T$$\n\n我们可以从第一个方程中表示出 $A_T$ 为 $A_T = \\frac{\\rho_1}{\\rho_2} (A_I + A_R)$，并将其代入第二个方程：\n$$k_1 (A_I - A_R) = k_2 \\frac{\\rho_1}{\\rho_2} (A_I + A_R)$$\n\n代入 $k_j = \\omega/V_{Pj}$ 并约去 $\\omega$ 进行简化：\n$$\\frac{1}{V_{P1}} (A_I - A_R) = \\frac{\\rho_1}{V_{P2}\\rho_2} (A_I + A_R)$$\n\n重新整理各项以求解反射系数 $R = A_R/A_I$：\n$$V_{P2}\\rho_2 (A_I - A_R) = V_{P1}\\rho_1 (A_I + A_R)$$\n\n定义声阻抗为 $Z_j = \\rho_j V_{Pj}$：\n$$Z_2 (A_I - A_R) = Z_1 (A_I + A_R)$$\n$$Z_2 A_I - Z_1 A_I = Z_1 A_R + Z_2 A_R$$\n$$A_I (Z_2 - Z_1) = A_R (Z_1 + Z_2)$$\n\n这就得到了正入射反射系数的表达式：\n$$R = \\frac{A_R}{A_I} = \\frac{Z_2 - Z_1}{Z_2 + Z_1}$$\n\n### 第2步：经验幂律的单位转换\n\n问题提供了一个连接体积密度 $\\rho'$ 和压缩波速 $V_P$ 的经验幂律关系（Gardner关系）：\n$$\\rho' = a_g (V_P)^{b_g}$$\n其中 $\\rho'$ 的单位是克/立方厘米 ($\\text{g/cm}^3$)，$V_P$ 的单位是米/秒 ($\\text{m/s}$)，常数为 $a_g=0.31$ 和 $b_g=0.25$。\n\n问题要求密度 $\\rho$ 的单位是千克/立方米 ($\\text{kg/m}^3$)。这些单位之间的换算关系是：\n$$1 \\, \\text{g/cm}^3 = \\frac{10^{-3} \\, \\text{kg}}{(10^{-2} \\, \\text{m})^3} = \\frac{10^{-3}}{10^{-6}} \\, \\text{kg/m}^3 = 1000 \\, \\text{kg/m}^3$$\n因此，要将 $\\rho'$ 从 $\\text{g/cm}^3$ 转换为 $\\text{kg/m}^3$ 的 $\\rho$，我们乘以 $1000$：\n$$\\rho \\, (\\text{in kg/m}^3) = 1000 \\times \\rho' \\, (\\text{in g/cm}^3)$$\n将此应用于经验关系：\n$$\\rho = 1000 \\times a_g (V_P)^{b_g}$$\n代入给定的 $a_g$ 和 $b_g$ 值：\n$$\\rho_{\\text{est}} = 1000 \\times 0.31 \\times (V_P)^{0.25} = 310 (V_P)^{0.25}$$\n这是用于从单位为 $\\text{m/s}$ 的 $V_P$ 估计单位为 $\\text{kg/m}^3$ 的密度 $\\rho_{\\text{est}}$ 的单位一致性方程。我们可以为这些单位定义新的常数：$a=310$ 和 $b=0.25$。\n\n### 第3步：反射系数偏差的计算\n\n对于每个由 $(V_{P1}, \\rho_1, V_{P2}, \\rho_2)$ 指定的界面，我们计算两个反射系数。\n\n1.  **真实反射系数 ($R_{\\text{true}}$)**：\n    这是使用实测的密度和速度计算的。\n    -   真实声阻抗：$Z_1 = \\rho_1 V_{P1}$ 和 $Z_2 = \\rho_2 V_{P2}$。\n    -   真实反射系数：$R_{\\text{true}} = \\frac{Z_2 - Z_1}{Z_2 + Z_1}$。\n\n2.  **Gardner估计的反射系数 ($R_{\\text{est}}$)**：\n    这是通过将实测密度替换为使用转换后的幂律关系从速度估计出的密度来计算的。\n    -   估计密度：$\\rho_{1,\\text{est}} = a (V_{P1})^b$ 和 $\\rho_{2,\\text{est}} = a (V_{P2})^b$，其中 $a=310$ 和 $b=0.25$。\n    -   估计声阻抗：$Z_{1,\\text{est}} = \\rho_{1,\\text{est}} V_{P1} = a (V_{P1})^{b} V_{P1} = a (V_{P1})^{1+b}$ 和 $Z_{2,\\text{est}} = a (V_{P2})^{1+b}$。\n    -   估计反射系数：\n        $$R_{\\text{est}} = \\frac{Z_{2,\\text{est}} - Z_{1,\\text{est}}}{Z_{2,\\text{est}} + Z_{1,\\text{est}}} = \\frac{a (V_{P2})^{1+b} - a (V_{P1})^{1+b}}{a (V_{P2})^{1+b} + a (V_{P1})^{1+b}}$$\n        常数 $a$ 被约去，表达式简化为：\n        $$R_{\\text{est}} = \\frac{(V_{P2})^{1.25} - (V_{P1})^{1.25}}{(V_{P2})^{1.25} + (V_{P1})^{1.25}}$$\n\n3.  **有符号振幅偏差 ($\\Delta R$)**：\n    偏差是估计反射系数与真实反射系数之间的差值。\n    $$\\Delta R = R_{\\text{est}} - R_{\\text{true}}$$\n    为每个案例计算此无量纲量，并四舍五入到六位小数。\n\n此过程将应用于所提供的五个测试案例。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the signed amplitude bias in reflection coefficients\n    for five geological interfaces.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (V_P1, rho_1, V_P2, rho_2)\n    # Units: V_P in m/s, rho in kg/m^3\n    test_cases = [\n        # Case 1\n        (2200.0, 2150.0, 2600.0, 2350.0),\n        # Case 2\n        (2500.0, 2200.0, 6000.0, 2700.0),\n        # Case 3\n        (1500.0, 1800.0, 1700.0, 1850.0),\n        # Case 4 (zero true impedance contrast)\n        (2000.0, 2000.0, 1600.0, 2500.0),\n        # Case 5 (gas-charged sand example)\n        (2750.0, 2400.0, 2000.0, 1700.0),\n    ]\n\n    results = []\n    \n    # Power for Gardner's relation, b = 0.25\n    b = 0.25\n    power = 1.0 + b # This is 1.25\n\n    def calculate_bias(vp1, rho1, vp2, rho2):\n        \"\"\"\n        Calculates the signed amplitude bias for a single interface.\n\n        Args:\n            vp1 (float): P-wave velocity of the upper layer (m/s).\n            rho1 (float): Density of the upper layer (kg/m^3).\n            vp2 (float): P-wave velocity of the lower layer (m/s).\n            rho2 (float): Density of the lower layer (kg/m^3).\n\n        Returns:\n            float: The signed amplitude bias.\n        \"\"\"\n        # 1. Calculate the true reflection coefficient (R_true)\n        z1_true = rho1 * vp1\n        z2_true = rho2 * vp2\n        \n        # Handle the case where Z1 + Z2 is zero to avoid division by zero,\n        # although physically unlikely for positive Vp and rho.\n        if (z1_true + z2_true) == 0:\n            # If Z1 = -Z2, R is undefined. If Z1=Z2=0, also undefined.\n            # Assuming Z1=Z2=0 results in R_true=0 as there is no impedance.\n            # Physically, Z > 0.\n            r_true = 0.0\n        else:\n            r_true = (z2_true - z1_true) / (z2_true + z1_true)\n\n        # 2. Calculate the Gardner-estimated reflection coefficient (R_est)\n        # As derived, R_est = (V_P2^(1+b) - V_P1^(1+b)) / (V_P2^(1+b) + V_P1^(1+b))\n        vp1_pow = vp1 ** power\n        vp2_pow = vp2 ** power\n\n        if (vp1_pow + vp2_pow) == 0:\n            # Should not happen for positive Vp\n            r_est = 0.0\n        else:\n            r_est = (vp2_pow - vp1_pow) / (vp1_pow + vp2_pow)\n\n        # 3. Calculate the signed amplitude bias (Delta R)\n        delta_r = r_est - r_true\n        return delta_r\n\n    for case in test_cases:\n        vp1, rho1, vp2, rho2 = case\n        bias = calculate_bias(vp1, rho1, vp2, rho2)\n        # Format the result to exactly six decimal places for the output string.\n        results.append(f\"{bias:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3615963"}, {"introduction": "这项综合性练习将理论付诸实践，要求您构建一个一维有限差分波动模拟器。您将利用这个虚拟实验室来数值验证地震波互易定理——一个波动物理学的基石原理，该原理指出在无损介质中交换震源和接收点的位置，记录结果不变。接着，您将探究当引入非对称的物理衰减时，这种基本的对称性是如何被打破的，从而深刻理解多种地震方法（如地震干涉法）背后的物理假设。", "problem": "考虑通过对声压场建模，在一维空间中生成和分析合成地震图。从一个有效的物理基础出发：一个作用于压力的线性、时不变、标量声波算子，以及适当的边界条件。对于空间坐标 $x \\in [0,L]$（$L$ 的单位为 $\\mathrm{m}$）和时间 $t \\in [0,T]$（$T$ 的单位为 $\\mathrm{s}$），定义由一个紧凑源驱动的压力场 $p(x,t)$。目标是通过交换震源和接收点的位置来合成虚拟源地震图，并在无损情况下评估位置互易性。然后通过空间非均匀阻尼引入衰减，并结合非对称边界吸收，量化合成对中由此产生的位置对称性偏差。\n\n使用与以下原则一致的离散化方法：\n- 介质在具有 $N_x$ 个点的均匀网格上离散化，网格间距为 $\\Delta x = L/(N_x-1)$，单位为 $\\mathrm{m}$。\n- 时间轴使用均匀步长 $\\Delta t$（单位为 $\\mathrm{s}$），满足与最大波速相关的库朗稳定性条件。\n- 波速 $c(x)$（单位为 $\\mathrm{m/s}$）可以是非均匀的，但为分段常数。密度被隐式地吸收到 $p(x,t)$ 的标量公式中。\n- 演化由一个带可选线性阻尼的标量二阶双曲方程控制：\n$$\n\\frac{\\partial^2 p}{\\partial t^2}(x,t) + \\gamma(x) \\frac{\\partial p}{\\partial t}(x,t) - c(x)^2 \\frac{\\partial^2 p}{\\partial x^2}(x,t) = s(x,t),\n$$\n其中 $\\gamma(x)$（单位为 $\\mathrm{s}^{-1}$）是一个非负阻尼剖面，$s(x,t)$ 是源项。反射边界对应于 $x=0$ 和 $x=L$ 处的零空间梯度。非对称边界吸收是通过仅在其中一个边界附近使 $\\gamma(x)$ 逐渐增强来实现的。\n\n由位于 $x_s$ 的震源在位置 $x_r$ 处产生的虚拟源地震图，是指当震源位于 $x_s$ 时，在 $x_r$ 处记录到的脉冲响应。位置互易性测试比较了在相同介质和边界条件下，震源位于 $x_s$ 时在 $x_r$ 处记录的道，与震源位于 $x_r$ 时在 $x_s$ 处记录的道。通过两条道之间的归一化 $\\ell_2$ 范数差来量化偏差，\n$$\n\\varepsilon = \\frac{\\left\\| d_{r \\leftarrow s}(t) - d_{s \\leftarrow r}(t) \\right\\|_2}{\\max\\left(\\left\\| d_{r \\leftarrow s}(t) \\right\\|_2, \\left\\| d_{s \\leftarrow r}(t) \\right\\|_2\\right)},\n$$\n该值为无量纲。\n\n实现一个有限差分格式，该格式使用时间和空间上的二阶中心差分来推进 $p(x,t)$，在震源网格点注入一个带限脉冲源子波 $s(t)$，并随时间记录接收点网格处的压力。通过选择参数并验证稳定性来确保科学真实性。本问题中不使用任何角度。\n\n设计并运行以下测试套件。所有距离单位为 $\\mathrm{m}$，时间单位为 $\\mathrm{s}$，波速单位为 $\\mathrm{m/s}$：\n\n- 测试用例 A（均匀、无损、反射边界）：\n    - $L = 1000$, $N_x = 801$, $c(x) \\equiv 2000$, $\\gamma(x) \\equiv 0$。\n    - 总时间 $T = 0.40$。\n    - 震源中心频率 $f_0 = 25$。\n    - 震源位置 $x_s = 200$，接收点位置 $x_r = 800$。\n    - 计算 $\\varepsilon$ 并报告一个布尔值，指示 $\\varepsilon \\le 10^{-3}$ 是否成立。\n\n- 测试用例 B（分层、无损、反射边界）：\n    - $L = 1000$, $N_x = 801$, $c(x) = 1800$ for $x \\in [0,500)$ and $c(x) = 2500$ for $x \\in [500,1000]$, $\\gamma(x) \\equiv 0$。\n    - 总时间 $T = 0.50$。\n    - 震源中心频率 $f_0 = 20$。\n    - 震源位置 $x_s = 300$，接收点位置 $x_r = 900$。\n    - 计算 $\\varepsilon$ 并报告一个布尔值，指示 $\\varepsilon \\le 2 \\cdot 10^{-3}$ 是否成立。\n\n- 测试用例 C（均匀介质，带衰减和非对称边界吸收）：\n    - $L = 1000$, $N_x = 801$, $c(x) \\equiv 2200$。\n    - 总时间 $T = 0.60$。\n    - 震源中心频率 $f_0 = 25$。\n    - 震源位置 $x_s = 100$，接收点位置 $x_r = 900$。\n    - 阻尼剖面 $\\gamma(x) = 0$，但在最后 $200$ $\\mathrm{m}$ 的右边界存在一个海绵区域，在该区域内 $\\gamma(x)$ 以二次方形式逐渐增加到 $x=L$ 处的最大值 $\\gamma_{\\max} = 50$ $\\mathrm{s}^{-1}$。\n    - 计算并报告 $\\varepsilon$ 的浮点数值。\n\n您的程序应产生单行输出，其中包含一个逗号分隔的列表，用方括号括起来，按测试用例 A、B、C 的顺序排列结果，即 $[b_A,b_B,\\varepsilon_C]$，其中 $b_A$ 和 $b_B$ 是布尔值，$\\varepsilon_C$ 是一个由编程语言的默认字符串转换四舍五入的浮点数。输出均为无量纲。", "solution": "该问题被评估为有效。它在科学上基于波传播原理，在数学上是适定的，并为地球物理学中的计算实验提供了一套完整且一致的参数。该问题要求实现一个标准的时域有限差分（FDTD）格式来求解带阻尼的一维标量波动方程，这是计算地震学的基石。这些任务涉及在特定条件下验证互易性原理并量化其违背程度，具有科学意义和计算可行性。\n\n解决方案是通过首先离散化控制偏微分方程，然后为指定的测试用例实现所得算法来开发的。\n\n压力场 $p(x,t)$ 的控制方程是带线性阻尼项的一维标量波动方程：\n$$\n\\frac{\\partial^2 p}{\\partial t^2}(x,t) + \\gamma(x) \\frac{\\partial p}{\\partial t}(x,t) - c(x)^2 \\frac{\\partial^2 p}{\\partial x^2}(x,t) = s(x,t)\n$$\n其中 $p$ 是压力，$c(x)$ 是波速，$\\gamma(x)$ 是阻尼系数，$s(x,t)$ 是源项。\n\n我们在一个均匀网格上，使用二阶中心差分来离散化该方程的时间和空间导数。令 $p_i^n$ 表示在空间网格点 $x_i = i\\Delta x$ 和时间 $t_n = n\\Delta t$ 处的压力。导数的离散近似为：\n$$\n\\frac{\\partial^2 p}{\\partial t^2} \\approx \\frac{p_i^{n+1} - 2p_i^n + p_i^{n-1}}{\\Delta t^2}\n$$\n$$\n\\frac{\\partial p}{\\partial t} \\approx \\frac{p_i^{n+1} - p_i^{n-1}}{2\\Delta t}\n$$\n$$\n\\frac{\\partial^2 p}{\\partial x^2} \\approx \\frac{p_{i+1}^n - 2p_i^n + p_{i-1}^n}{\\Delta x^2}\n$$\n将这些近似代入控制方程，并整理项以求解下一个时间步的压力 $p_i^{n+1}$，得到以下显式有限差分更新格式：\n$$\np_i^{n+1} \\left(\\frac{1}{\\Delta t^2} + \\frac{\\gamma_i}{2\\Delta t}\\right) = \\frac{2p_i^n}{\\Delta t^2} - p_i^{n-1}\\left(\\frac{1}{\\Delta t^2} - \\frac{\\gamma_i}{2\\Delta t}\\right) + c_i^2 \\left(\\frac{p_{i+1}^n - 2p_i^n + p_{i-1}^n}{\\Delta x^2}\\right) + s_i^n\n$$\n两边乘以 $\\Delta t^2$ 并重新排列，得到 $p_i^{n+1}$ 的计算公式：\n$$\np_i^{n+1} = \\frac{1}{1 + \\frac{\\gamma_i \\Delta t}{2}} \\left[ 2p_i^n - p_i^{n-1}\\left(1 - \\frac{\\gamma_i \\Delta t}{2}\\right) + \\left(\\frac{c_i \\Delta t}{\\Delta x}\\right)^2 \\left(p_{i+1}^n - 2p_i^n + p_{i-1}^n\\right) \\right] + \\frac{\\Delta t^2 s_i^n}{1 + \\frac{\\gamma_i \\Delta t}{2}}\n$$\n为保证数值稳定性，时间步长 $\\Delta t$ 必须满足 Courant-Friedrichs-Lewy (CFL) 条件，$c_{\\max} \\frac{\\Delta t}{\\Delta x} \\le S$，其中 $c_{\\max}$ 是模型中存在的最大波速，$S$ 是一个称为库朗数的安全因子，我们将其设置为一个保守值 $S=0.5$。\n\n源项 $s(x,t)$ 被建模为空间狄拉克δ函数和时间子波的乘积，$s(x,t) = S(t)\\delta(x-x_s)$。在离散域中，这被近似为 $s_i^n = S(t_n) \\frac{\\delta_{i,i_s}}{\\Delta x}$，其中 $i_s$ 是震源位置 $x_s$ 的网格索引。源子波 $S(t)$ 选择为 Ricker 子波，这是地震学中的标准选择，其中心频率为 $f_0$，时间延迟为 $t_0 = 1/f_0$：\n$$\nS(t) = \\left(1 - 2\\left(\\pi f_0 (t - t_0)\\right)^2\\right) e^{-\\left(\\pi f_0 (t - t_0)\\right)^2}\n$$\n在 $x=0$ 和 $x=L$ 处的反射边界是通过使用零梯度（Neumann）条件 $\\frac{\\partial p}{\\partial x} = 0$ 来实现的。这通过使用鬼点来实现，使得 $p_{-1}^n = p_1^n$ 和 $p_{N_x}^n = p_{N_x-2}^n$，从而简化了在边界 $i=0$ 和 $i=N_x-1$ 处的离散拉普拉斯算子。\n\n问题的核心是测试位置互易性，该原理指出，对于一个线性、时不变且无损的介质，由位于 $x_s$ 的震源在位置 $x_r$ 处记录的地震道与由位于 $x_r$ 的震源在位置 $x_s$ 处记录的地震道是相同的。该原理源于当 $\\gamma(x) = 0$ 时底层波动算子的自伴随性质。我们使用归一化 $\\ell_2$ 范数差 $\\varepsilon$ 来量化与互易性的偏差：\n$$\n\\varepsilon = \\frac{\\left\\| d_{r \\leftarrow s}(t) - d_{s \\leftarrow r}(t) \\right\\|_2}{\\max\\left(\\left\\| d_{r \\leftarrow s}(t) \\right\\|_2, \\left\\| d_{s \\leftarrow r}(t) \\right\\|_2\\right)}\n$$\n对于每个测试用例，我们进行两次模拟：一次是震源在 $x_s$、接收点在 $x_r$，第二次是交换位置。然后我们根据得到的两个时间序列 $d_{r \\leftarrow s}(t)$ 和 $d_{s \\leftarrow r}(t)$ 计算 $\\varepsilon$。\n\n*   对于测试用例 A（均匀、无损）和 B（分层、无损），介质是无损的（$\\gamma(x) \\equiv 0$）。波动算子是自伴随的，互易性必须成立。任何计算出的 $\\varepsilon > 0$ 都将归因于数值伪影，如浮点误差和离散化差异，并且预计会非常小。\n*   对于测试用例 C（均匀、带衰减），阻尼剖面 $\\gamma(x)$ 非零且不对称。这破坏了波动算子的自伴随性。波的传播不再以相同的方式具有时间可逆性，因此位置互易性被明确地破坏。预计会得到一个显著的非零 $\\varepsilon$ 值，反映了由阻尼引入的物理不对称性。具体来说，一个源于 $x_s=100$ 并传播到 $x_r=900$ 的波穿过一个大部分无损的介质，而一个源于 $x_s=900$（在吸收层内部）的波在传播到 $x_r=100$ 之前会立即受到强烈衰减。这导致记录到的地震图截然不同。\n\n该算法的流程是：为每个测试用例设置网格、材料属性（$c(x)$, $\\gamma(x)$）、源子波和 FDTD 系数。然后，主 FDTD 循环随时间迭代计算压力场，注入源并记录接收点位置的地震图。对互易的源-接收点对重复此过程以计算 $\\varepsilon$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for synthetic seismogram generation\n    and reciprocity analysis.\n    \"\"\"\n\n    def run_fd_simulation(L, Nx, T, c_profile_func, gamma_profile_func, f0, xs_pos, xr_pos, courant_S=0.5):\n        \"\"\"\n        Performs a single 1D finite-difference wave propagation simulation.\n\n        Returns:\n            np.ndarray: The recorded seismogram at the receiver location.\n        \"\"\"\n        # ---- 1. Grid and model setup ----\n        dx = L / (Nx - 1)\n        x = np.linspace(0, L, Nx)\n\n        c = c_profile_func(x)\n        gamma = gamma_profile_func(x)\n\n        c_max = np.max(c)\n        if c_max == 0:\n            raise ValueError(\"Maximum velocity cannot be zero.\")\n            \n        dt = courant_S * dx / c_max\n        Nt = int(np.ceil(T / dt))\n        t = np.linspace(0, dt * (Nt - 1), Nt)\n\n        xs_idx = int(round(xs_pos / dx))\n        xr_idx = int(round(xr_pos / dx))\n\n        # ---- 2. Source wavelet setup (Ricker) ----\n        t0 = 1.0 / f0\n        source_t_shifted = t - t0\n        tau_sq = (np.pi * f0 * source_t_shifted)**2\n        source_wavelet = (1.0 - 2.0 * tau_sq) * np.exp(-tau_sq)\n\n        # ---- 3. FDTD setup ----\n        p_prev = np.zeros(Nx)\n        p_curr = np.zeros(Nx)\n        p_next = np.zeros(Nx)\n        seismogram = np.zeros(Nt)\n\n        gdt2 = gamma * dt / 2.0\n        inv_denom = 1.0 / (1.0 + gdt2)\n        \n        # ---- 4. FDTD main loop ----\n        for n in range(Nt - 1):\n            # Calculate spatial second derivative (Laplacian)\n            laplacian = np.zeros(Nx)\n            # Interior points\n            laplacian[1:-1] = (p_curr[2:] - 2 * p_curr[1:-1] + p_curr[:-2])\n            # Reflective (Neumann) boundary conditions\n            laplacian[0] = 2.0 * (p_curr[1] - p_curr[0])\n            laplacian[-1] = 2.0 * (p_curr[-2] - p_curr[-1])\n            laplacian /= dx**2\n\n            # Update pressure field p_next\n            term_p_curr = 2.0 * p_curr\n            term_p_prev = (1.0 - gdt2) * p_prev\n            term_laplacian = dt**2 * c**2 * laplacian\n            \n            p_next = inv_denom * (term_p_curr - term_p_prev + term_laplacian)\n            \n            # Add source term for p at t_n -> p at t_{n+1}\n            source_val = source_wavelet[n]\n            if source_val != 0:\n                p_next[xs_idx] += inv_denom[xs_idx] * (dt**2 * source_val / dx)\n            \n            # ---- 5. Record and update ----\n            seismogram[n+1] = p_next[xr_idx]\n            p_prev, p_curr = p_curr, p_next\n\n        return seismogram\n\n    def compute_reciprocity_error(params):\n        \"\"\"\n        Computes the reciprocity error epsilon for a given set of parameters.\n        \"\"\"\n        L, Nx, T, c_profile_func, gamma_profile_func, f0, xs, xr = params\n        \n        # Simulation 1: Source at xs, Receiver at xr\n        trace1 = run_fd_simulation(L, Nx, T, c_profile_func, gamma_profile_func, f0, xs, xr)\n        \n        # Simulation 2: Source at xr, Receiver at xs (reciprocal)\n        trace2 = run_fd_simulation(L, Nx, T, c_profile_func, gamma_profile_func, f0, xr, xs)\n        \n        # Compute epsilon\n        norm_diff = np.linalg.norm(trace1 - trace2)\n        norm_trace1 = np.linalg.norm(trace1)\n        norm_trace2 = np.linalg.norm(trace2)\n        norm_max = max(norm_trace1, norm_trace2)\n        \n        if norm_max == 0:\n            return 0.0\n        \n        return norm_diff / norm_max\n\n    # --- Test Case A ---\n    L_A, Nx_A, T_A, f0_A, xs_A, xr_A = 1000, 801, 0.40, 25, 200, 800\n    c_prof_A = lambda x: np.full_like(x, 2000.0)\n    gamma_prof_A = lambda x: np.zeros_like(x)\n    params_A = (L_A, Nx_A, T_A, c_prof_A, gamma_prof_A, f0_A, xs_A, xr_A)\n    epsilon_A = compute_reciprocity_error(params_A)\n    result_A = epsilon_A = 1e-3\n\n    # --- Test Case B ---\n    L_B, Nx_B, T_B, f0_B, xs_B, xr_B = 1000, 801, 0.50, 20, 300, 900\n    def c_prof_B(x):\n        c = np.full_like(x, 1800.0)\n        c[x >= 500] = 2500.0\n        return c\n    gamma_prof_B = lambda x: np.zeros_like(x)\n    params_B = (L_B, Nx_B, T_B, c_prof_B, gamma_prof_B, f0_B, xs_B, xr_B)\n    epsilon_B = compute_reciprocity_error(params_B)\n    result_B = epsilon_B = 2e-3\n\n    # --- Test Case C ---\n    L_C, Nx_C, T_C, f0_C, xs_C, xr_C = 1000, 801, 0.60, 25, 100, 900\n    c_prof_C = lambda x: np.full_like(x, 2200.0)\n    def gamma_prof_C(x):\n        gamma = np.zeros_like(x)\n        sponge_width = 200.0\n        sponge_start = L_C - sponge_width\n        sponge_zone = x >= sponge_start\n        rel_pos = (x[sponge_zone] - sponge_start) / sponge_width\n        gamma[sponge_zone] = 50.0 * rel_pos**2\n        return gamma\n    params_C = (L_C, Nx_C, T_C, c_prof_C, gamma_prof_C, f0_C, xs_C, xr_C)\n    result_C = compute_reciprocity_error(params_C)\n\n    results = [result_A, result_B, result_C]\n    print(f\"[{results[0]},{results[1]},{results[2]}]\")\n\nsolve()\n\n```", "id": "3615893"}]}