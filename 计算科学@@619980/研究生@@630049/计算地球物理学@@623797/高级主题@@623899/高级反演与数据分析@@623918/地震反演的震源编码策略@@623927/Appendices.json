{"hands_on_practices": [{"introduction": "源编码策略的一个主要目标是提高地震数据采集和反演的效率。然而，效率的提升不能以牺牲数据质量为代价。这个练习将通过一个理想化的场景，带我们回到问题的根本：即我们如何通过编码和解码过程来控制随机噪声？[@problem_id:3614649] 这个练习要求我们推导在使用正交编码时，解码后信号中的噪声方差。通过这个推导，你将亲手验证增加实验次数对压制噪声的量化效果，这是理解编码增益背后统计原理的关键一步。", "problem": "一次海洋地震采集勘探使用带编码的同步震源，以加速用于反演的数据采集。在每个固定的时间采样点，跨越多次实验所采集的数据可以被视为一个线性系统。存在 $N$ 个同步震源，勘探执行 $K$ 次重复实验，其中震源由已知编码进行调制。在一个固定时间采样点上的线性模型为\n$$\n\\mathbf{y} = \\mathbf{C}\\,\\mathbf{s} + \\mathbf{n},\n$$\n其中 $\\mathbf{y} \\in \\mathbb{R}^{K}$ 收集了 $K$ 次实验中测得的振幅，$\\mathbf{s} \\in \\mathbb{R}^{N}$ 收集了该时间采样点上未知的真实震源响应，$\\mathbf{C} \\in \\mathbb{R}^{K \\times N}$ 是已知的编码矩阵，$\\mathbf{n} \\in \\mathbb{R}^{K}$ 是测量噪声。假设以下物理和统计条件成立：\n- 编码矩阵 $\\mathbf{C}$ 的列是正交且等能量的，并且 $K \\ge N$。$\\mathbf{C}$ 的元素为 $\\pm 1$。因此，$\\mathbf{C}^{\\top}\\mathbf{C} = K\\,\\mathbf{I}_{N}$。\n- 噪声 $\\mathbf{n}$ 是零均值、白噪声，并且在各次实验之间是独立的，其协方差为 $\\mathbb{E}[\\mathbf{n}\\mathbf{n}^{\\top}] = \\sigma^{2}\\,\\mathbf{I}_{K}$，其中 $\\sigma^{2}$ 是每次实验、每个时间采样点的噪声方差。\n- 解码是通过求解线性最小二乘问题来获得估计值\n$$\n\\widehat{\\mathbf{s}} = \\arg\\min_{\\mathbf{z} \\in \\mathbb{R}^{N}} \\|\\mathbf{y} - \\mathbf{C}\\,\\mathbf{z}\\|_{2}^{2},\n$$\n这会得到标准正规方程解 $\\widehat{\\mathbf{s}} = (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{y}$。\n- 将振幅视为无量纲，因此方差也为无量纲。\n\n仅使用这些假设以及期望和协方差的线性性质，计算解码后在固定时间采样点上任意单个震源分量 $\\widehat{s}_{i}$ 的解码噪声方差。请用 $\\sigma$ 和 $K$ 将你的最终答案表示为一个精确的解析表达式。不需要进行数值舍入。最终答案必须是一个不带单位的单一表达式。", "solution": "用户希望我解决一个计算地球物理学中的问题，具体涉及地震采集中震源编码。\n\n### 步骤 1：提取已知条件\n- 线性模型为 $\\mathbf{y} = \\mathbf{C}\\,\\mathbf{s} + \\mathbf{n}$。\n- $\\mathbf{y} \\in \\mathbb{R}^{K}$ 是 $K$ 次实验中测得的振幅向量。\n- $\\mathbf{s} \\in \\mathbb{R}^{N}$ 是未知的真实震源响应向量。\n- $\\mathbf{C} \\in \\mathbb{R}^{K \\times N}$ 是已知的编码矩阵。\n- $\\mathbf{n} \\in \\mathbb{R}^{K}$ 是测量噪声向量。\n- $N$ 是同步震源的数量。\n- $K$ 是重复实验的次数。\n- 约束条件 $K \\ge N$ 成立。\n- 编码矩阵 $\\mathbf{C}$ 的列是正交且等能量的，其元素为 $\\pm 1$。该性质可由方程 $\\mathbf{C}^{\\top}\\mathbf{C} = K\\,\\mathbf{I}_{N}$ 概括，其中 $\\mathbf{I}_{N}$ 是 $N \\times N$ 单位矩阵。\n- 噪声 $\\mathbf{n}$ 是零均值的，即 $\\mathbb{E}[\\mathbf{n}] = \\mathbf{0}$。\n- 噪声协方差为 $\\mathbb{E}[\\mathbf{n}\\mathbf{n}^{\\top}] = \\sigma^{2}\\,\\mathbf{I}_{K}$，其中 $\\sigma^{2}$ 是每次实验的噪声方差，$\\mathbf{I}_{K}$ 是 $K \\times K$ 单位矩阵。\n- 估计的震源响应向量 $\\widehat{\\mathbf{s}}$ 通过线性最小二乘解获得：$\\widehat{\\mathbf{s}} = (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{y}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题具有科学合理性。它描述了一种使用编码震源对同步采集的地震数据进行混合波场分离的标准方法。线性模型、最小二乘估计以及关于噪声的统计假设是信号处理和反演问题中的基本概念。编码矩阵 $\\mathbf{C}$ 的性质与实际中使用的矩阵（如哈达玛矩阵）的性质一致。\n- **适定性**：该问题是适定的。所有必需的变量和条件都已指定。条件 $\\mathbf{C}^{\\top}\\mathbf{C} = K\\,\\mathbf{I}_{N}$ 保证了矩阵 $\\mathbf{C}^{\\top}\\mathbf{C}$ 是可逆的（因为 $K \\neq 0$），从而确保 $\\widehat{\\mathbf{s}}$ 存在唯一解。目标是计算一个特定的、明确定义的统计量。\n- **客观性**：该问题以精确、客观的数学语言陈述。\n- **完整性和一致性**：该问题是自洽的，没有矛盾。给定的关系 $\\mathbf{C}^{\\top}\\mathbf{C} = K\\,\\mathbf{I}_{N}$ 与关于 $\\mathbf{C}$ 具有正交列且元素为 $\\pm 1$ 的描述是一致的。每个列向量 $\\mathbf{c}_{j}$ 的范数平方是 $\\mathbf{c}_{j}^{\\top}\\mathbf{c}_{j} = \\sum_{i=1}^{K} (\\pm 1)^{2} = K$。正交性意味着对于 $i \\neq j$，有 $\\mathbf{c}_{i}^{\\top}\\mathbf{c}_{j} = 0$。这些共同构成了 $\\mathbf{C}^{\\top}\\mathbf{C} = K\\,\\mathbf{I}_{N}$。\n- **结论**：该问题有效，可以按所述方式求解。\n\n### 步骤 3：推导\n目标是计算单个解码后震源分量 $\\mathrm{Var}(\\widehat{s}_{i})$ 的方差。这是向量 $\\widehat{\\mathbf{s}}$ 的协方差矩阵（记为 $\\mathrm{Cov}(\\widehat{\\mathbf{s}})$）的第 $i$ 个对角线元素。\n\n首先，我们将估计的震源向量 $\\widehat{\\mathbf{s}}$ 用真实震源 $\\mathbf{s}$ 和噪声 $\\mathbf{n}$ 来表示。我们将线性模型 $\\mathbf{y} = \\mathbf{C}\\,\\mathbf{s} + \\mathbf{n}$ 代入 $\\widehat{\\mathbf{s}}$ 的表达式中：\n$$\n\\widehat{\\mathbf{s}} = (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}(\\mathbf{C}\\,\\mathbf{s} + \\mathbf{n})\n$$\n使用矩阵乘法的分配律：\n$$\n\\widehat{\\mathbf{s}} = (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{C}\\,\\mathbf{s} + (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{n}\n$$\n项 $(\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{C}$ 简化为单位矩阵 $\\mathbf{I}_{N}$。因此，表达式变为：\n$$\n\\widehat{\\mathbf{s}} = \\mathbf{I}_{N}\\,\\mathbf{s} + (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{n} = \\mathbf{s} + (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{n}\n$$\n此方程表明，估计向量 $\\widehat{\\mathbf{s}}$ 是真实信号向量 $\\mathbf{s}$ 与一个代表解码后噪声的项之和。让我们求 $\\widehat{\\mathbf{s}}$ 的期望值。由于 $\\mathbf{s}$ 和 $\\mathbf{C}$ 是确定性的，且期望算子是线性的：\n$$\n\\mathbb{E}[\\widehat{\\mathbf{s}}] = \\mathbb{E}[\\mathbf{s} + (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{n}] = \\mathbf{s} + (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbb{E}[\\mathbf{n}]\n$$\n我们已知噪声是零均值的，$\\mathbb{E}[\\mathbf{n}] = \\mathbf{0}$。因此：\n$$\n\\mathbb{E}[\\widehat{\\mathbf{s}}] = \\mathbf{s}\n$$\n这表明最小二乘估计量是无偏的。\n\n接下来，我们计算 $\\widehat{\\mathbf{s}}$ 的协方差矩阵。协方差矩阵定义为 $\\mathrm{Cov}(\\widehat{\\mathbf{s}}) = \\mathbb{E}[(\\widehat{\\mathbf{s}} - \\mathbb{E}[\\widehat{\\mathbf{s}}])(\\widehat{\\mathbf{s}} - \\mathbb{E}[\\widehat{\\mathbf{s}}])^{\\top}]$。\n代入 $\\mathbb{E}[\\widehat{\\mathbf{s}}] = \\mathbf{s}$，我们得到：\n$$\n\\widehat{\\mathbf{s}} - \\mathbb{E}[\\widehat{\\mathbf{s}}] = (\\mathbf{s} + (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{n}) - \\mathbf{s} = (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{n}\n$$\n所以协方差矩阵为：\n$$\n\\mathrm{Cov}(\\widehat{\\mathbf{s}}) = \\mathbb{E}\\left[ \\left( (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{n} \\right) \\left( (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{n} \\right)^{\\top} \\right]\n$$\n让我们定义矩阵 $\\mathbf{A} = (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}$。该表达式变为 $\\mathbb{E}[(\\mathbf{A}\\mathbf{n})(\\mathbf{A}\\mathbf{n})^{\\top}] = \\mathbb{E}[\\mathbf{A}\\mathbf{n}\\mathbf{n}^{\\top}\\mathbf{A}^{\\top}]$。由于 $\\mathbf{A}$ 是一个常数矩阵，我们可以将其从期望中提出：\n$$\n\\mathrm{Cov}(\\widehat{\\mathbf{s}}) = \\mathbf{A}\\,\\mathbb{E}[\\mathbf{n}\\mathbf{n}^{\\top}]\\,\\mathbf{A}^{\\top} = \\left( (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top} \\right) \\mathbb{E}[\\mathbf{n}\\mathbf{n}^{\\top}] \\left( (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top} \\right)^{\\top}\n$$\n我们已知 $\\mathbb{E}[\\mathbf{n}\\mathbf{n}^{\\top}] = \\sigma^{2}\\,\\mathbf{I}_{K}$。将其代入：\n$$\n\\mathrm{Cov}(\\widehat{\\mathbf{s}}) = \\left( (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top} \\right) (\\sigma^{2}\\,\\mathbf{I}_{K}) \\left( \\mathbf{C}((\\mathbf{C}^{\\top}\\mathbf{C})^{-1})^{\\top} \\right)\n$$\n矩阵 $\\mathbf{C}^{\\top}\\mathbf{C}$ 是对称的，所以它的逆也是对称的，即 $((\\mathbf{C}^{\\top}\\mathbf{C})^{-1})^{\\top} = (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}$。表达式简化为：\n$$\n\\mathrm{Cov}(\\widehat{\\mathbf{s}}) = \\sigma^{2} (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\\mathbf{C}^{\\top}\\mathbf{C}(\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\n$$\n由于 $\\mathbf{C}^{\\top}\\mathbf{C}$ 是可逆的，其乘积 $(\\mathbf{C}^{\\top}\\mathbf{C})(\\mathbf{C}^{\\top}\\mathbf{C})^{-1}$ 是单位矩阵 $\\mathbf{I}_{N}$。\n$$\n\\mathrm{Cov}(\\widehat{\\mathbf{s}}) = \\sigma^{2} (\\mathbf{C}^{\\top}\\mathbf{C})^{-1} \\mathbf{I}_{N} = \\sigma^{2} (\\mathbf{C}^{\\top}\\mathbf{C})^{-1}\n$$\n现在，我们使用编码矩阵的特定性质 $\\mathbf{C}^{\\top}\\mathbf{C} = K\\,\\mathbf{I}_{N}$。我们对这个表达式求逆：\n$$\n(\\mathbf{C}^{\\top}\\mathbf{C})^{-1} = (K\\,\\mathbf{I}_{N})^{-1} = \\frac{1}{K}\\mathbf{I}_{N}^{-1} = \\frac{1}{K}\\mathbf{I}_{N}\n$$\n将此结果代入我们的协方差矩阵表达式中：\n$$\n\\mathrm{Cov}(\\widehat{\\mathbf{s}}) = \\sigma^{2} \\left( \\frac{1}{K}\\mathbf{I}_{N} \\right) = \\frac{\\sigma^{2}}{K}\\mathbf{I}_{N}\n$$\n单个解码后震源分量 $\\widehat{s}_{i}$ 的方差是协方差矩阵 $\\mathrm{Cov}(\\widehat{\\mathbf{s}})$ 的第 $i$ 个对角线元素。\n$$\n\\mathrm{Var}(\\widehat{s}_{i}) = [\\mathrm{Cov}(\\widehat{\\mathbf{s}})]_{ii} = \\left[ \\frac{\\sigma^{2}}{K}\\mathbf{I}_{N} \\right]_{ii}\n$$\n由于单位矩阵 $\\mathbf{I}_{N}$ 的第 $i$ 个对角线元素是 1，我们有：\n$$\n\\mathrm{Var}(\\widehat{s}_{i}) = \\frac{\\sigma^{2}}{K}\n$$\n这个结果与索引 $i$ 无关，意味着所有震源分量的解码后噪声方差都相同。它与实验次数 $K$ 成反比，这是信号平均原理所预期的结果。", "answer": "$$\n\\boxed{\\frac{\\sigma^{2}}{K}}\n$$", "id": "3614649"}, {"introduction": "在理想情况下，正交编码能够完美地分离各个炮集的信号。但在实际的地震采集中，震源和接收器的几何布局会引入传播时延，从而破坏编码的理想正交性。[@problem_id:3614647] 这个实践练习要求你编写一个程序，来模拟并量化这种几何效应对编码正交性的影响。你将通过计算“有效”编码矩阵的条件数，直观地理解不规则的炮点间距是如何导致源间串扰（cross-talk），并学会评估解码问题的数值稳定性。", "problem": "您的任务是构建一个完整、可运行的程序，该程序用于量化在同步震源地震采集中，不规则的空间炮点间距如何与确定性震源编码的正交性相互作用，并计算由此产生的去混叠条件数。您的程序必须基于以下有物理和数值依据的模型和定义。\n\n考虑一条一维海洋采集测线，在位置 $x_r$ 处有一个接收器，同时在位置 $\\{x_s^{(i)}\\}_{i=1}^S$ 处有 $S$ 个同步激发的震源。每个震源由一个长度为 $N$ 个样本的确定性二元序列 $\\{c_i[n]\\}_{n=0}^{N-1}$ 进行编码，这些序列是作为一个 $N$ 阶 Walsh–Hadamard 矩阵的不同列向量生成的。采样频率为 $f_s$（单位：赫兹），恒定传播速度为 $v$（单位：米/秒）。在接收器处记录的混合数据被建模为由各自编码调制的震源响应的线性叠加。为了分离编码正交性与采集几何相互作用的影响，假设每个震源的编码由于几何走时而产生时间上的偏移，使其在去混叠系统矩阵中的有效贡献是其编码经过时移和窗口截断后的版本。\n\n定义震源 $i$ 的整数时间偏移为\n$$\nm_i = \\text{round}\\!\\left( \\frac{|x_s^{(i)} - x_r|}{v} f_s \\right),\n$$\n对应于走时 $|x_s^{(i)} - x_r|/v$ 秒所引起的离散采样延迟。设 $\\mathbf{A} \\in \\mathbb{R}^{N \\times S}$ 表示去混叠矩阵，其第 $i$ 列是编码 $\\{c_i[n]\\}$ 右移 $m_i$ 个样本并补零的结果，即：\n$$\na_i[n] = \n\\begin{cases}\n0,  0 \\le n  m_i, \\\\\nc_i[n - m_i],  m_i \\le n \\le N-1.\n\\end{cases}\n$$\n去混叠正规矩阵（几何偏移下的编码格拉姆矩阵）为 $\\mathbf{G} = \\mathbf{A}^\\top \\mathbf{A} \\in \\mathbb{R}^{S \\times S}$。去混叠条件数定义为\n$$\n\\kappa(\\mathbf{G}) = \\frac{\\lambda_{\\max}(\\mathbf{G})}{\\lambda_{\\min}(\\mathbf{G})},\n$$\n其中 $\\lambda_{\\max}(\\mathbf{G})$ 和 $\\lambda_{\\min}(\\mathbf{G})$ 分别表示 $\\mathbf{G}$ 的最大和最小特征值。较大的 $\\kappa(\\mathbf{G})$ 表示由于所引起的时移降低了编码震源的有效正交性，从而导致去混叠的稳定性较差。\n\n从波场的线性叠加原理和均匀采样下确定性编码正交性的定义出发，推导为以下测试套件形成 $\\mathbf{A}$、构建 $\\mathbf{G}$ 并计算 $\\kappa(\\mathbf{G})$ 的计算流程。所有距离必须以米（m）为单位，速度以米/秒（m/s）为单位，采样频率以赫兹（Hz）为单位。输出（条件数）为无量纲浮点数。\n\n测试套件参数集：\n\n1. 案例1（基准规则间距，几何延迟为零）：\n   - $N = 128$, $f_s = 500$ Hz, $v = 1500$ m/s, $x_r = 0$ m, $S = 8$,\n   - 炮点位置 $x_s^{(i)}$：对于 $i = 1, \\dots, 8$，所有值均为 $0$ m。\n\n2. 案例2（轻度不规则间距，产生微小但明确的采样延迟）：\n   - $N = 128$, $f_s = 500$ Hz, $v = 1500$ m/s, $x_r = 0$ m, $S = 8$,\n   - 炮点位置 $x_s^{(i)} \\in \\{0, 3, 6, 9, 12, 15, 18, 21\\}$ m。\n\n3. 案例3（强度不规则间距，其中一个远震源导致大的延迟和窗口截断）：\n   - $N = 128$, $f_s = 500$ Hz, $v = 1500$ m/s, $x_r = 0$ m, $S = 8$,\n   - 炮点位置 $x_s^{(i)} \\in \\{0, 3, 6, 9, 354, 12, 15, 18\\}$ m。\n\n4. 案例4（增加同步震源数量，延迟范围更广且不规则）：\n   - $N = 128$, $f_s = 1000$ Hz, $v = 1500$ m/s, $x_r = 0$ m, $S = 32$,\n   - 炮点位置 $x_s^{(i)}$ 由列表明确给出\n     $\\{0, 2.0, 1.5, 4.0, 3.5, 7.0, 6.5, 9.0, 10.5, 13.0, 12.5, 16.0, 17.5, 20.0, 22.5, 25.0, 27.5, 30.0, 33.5, 36.0, 38.5, 41.0, 43.5, 46.0, 48.5, 50.0, 52.5, 55.0, 57.5, 60.0, 62.5, 65.0\\}$ m。\n\n实现要求：\n\n- 确定性编码必须取自一个 $N$ 阶 Walsh–Hadamard 矩阵的前 $S$ 列。\n- 时移必须以右移的方式应用，并补零和截断至 $N$ 个样本的长度。\n- $\\mathbf{G}$ 的特征值必须进行数值计算，并且条件数必须按照上述定义进行评估。如果由于舍入误差，$\\lambda_{\\min}(\\mathbf{G})$ 在数值上为非正数，则将条件数视为无穷大。\n- 您的程序必须生成单行输出，其中包含四个案例的四个条件数，以逗号分隔，并用方括号括起来。每个条件数必须四舍五入到六位小数。例如：“[1.000000,1.234567,3.210000,5.678901]”。", "solution": "该问题要求计算几种同步震源地震采集场景下的去混叠条件数。这个数字量化了从单个震源分离信号（一个称为去混叠的过程）的数值稳定性。问题的核心在于确定性震源编码（被选择为正交的）与采集几何之间的相互作用，后者引入的时移会破坏这种正交性。\n\n解决方案将遵循以下基本原理推导得出：\n1.  使用 Walsh-Hadamard 矩阵生成正交震源编码。\n2.  计算每个震源由几何位置引起的时延。\n3.  通过将这些时延应用于震源编码，构建去混叠矩阵 $\\mathbf{A}$。\n4.  形成正规矩阵 $\\mathbf{G} = \\mathbf{A}^\\top \\mathbf{A}$。\n5.  从其特征值计算条件数 $\\kappa(\\mathbf{G})$。\n\n**1. 正交震源编码**\n在同步震源采集中，每个震源由一个唯一的编码进行调制，以便后续分离。理想的编码是相互正交的。问题指定使用 Walsh-Hadamard 矩阵的列。一个阶数为 $N$（其中 $N$ 是 2 的幂）的 Walsh-Hadamard 矩阵 $\\mathbf{H}_N$ 是一个元素为 $+1$ 和 $-1$ 的方阵。其定义特性是其列（和行）相互正交。具体来说，对于任意两个不同的列 $\\mathbf{c}_i$ 和 $\\mathbf{c}_j$，它们的点积为零：$\\mathbf{c}_i^\\top \\mathbf{c}_j = 0$。任何列的平方范数为 $\\mathbf{c}_i^\\top \\mathbf{c}_i = N$。这种正交性可以通过矩阵方程 $\\mathbf{H}_N^\\top \\mathbf{H}_N = N \\mathbf{I}_N$ 来概括，其中 $\\mathbf{I}_N$ 是 $N$ 阶单位矩阵。\n\n对于这个问题，$S$ 个震源的编码是 $\\mathbf{H}_N$ 的前 $S$ 列，表示为 $\\{\\mathbf{c}_i\\}_{i=1}^S$。如果没有时延，去混叠矩阵 $\\mathbf{A}$ 就只是矩阵 $\\mathbf{C} = [\\mathbf{c}_1, \\dots, \\mathbf{c}_S]$。正规矩阵将是 $\\mathbf{G} = \\mathbf{C}^\\top \\mathbf{C}$，它是一个 $S \\times S$ 的对角矩阵，所有对角元素都等于 $N$。对于这样的矩阵，$\\lambda_{\\max}(\\mathbf{G}) = \\lambda_{\\min}(\\mathbf{G}) = N$，条件数 $\\kappa(\\mathbf{G}) = 1$。这代表了一个完全良态的去混叠问题。\n\n**2. 几何引起的时延**\n从位于 $x_s^{(i)}$ 的震源发出的地震波以速度 $v$ 传播到位于 $x_r$ 的接收器。走时为 $\\Delta t_i = |x_s^{(i)} - x_r|/v$。在采样频率为 $f_s$ 的数字采样系统中，这个连续时延对应于 $m_i$ 个样本的离散偏移。根据问题的定义，这个整数偏移计算如下：\n$$\nm_i = \\text{round}\\!\\left( \\frac{|x_s^{(i)} - x_r|}{v} f_s \\right)\n$$\n\n**3. 去混叠矩阵 $\\mathbf{A}$**\n震源 $i$ 的时延 $m_i$ 意味着其编码序列 $\\mathbf{c}_i$ 在记录的数据道中实际上晚了 $m_i$ 个样本开始。这通过构建一组新的“有效”编码向量 $\\{\\mathbf{a}_i\\}_{i=1}^S$ 来建模，这些向量构成了去混叠矩阵 $\\mathbf{A}$ 的列。向量 $\\mathbf{a}_i$ 是原始编码向量 $\\mathbf{c}_i$ 的右移和截断版本。$\\mathbf{A}$ 的第 $i$ 列的第 $n$ 个元素由下式给出：\n$$\na_i[n] = \n\\begin{cases}\n0,  0 \\le n  m_i, \\\\\nc_i[n - m_i],  m_i \\le n \\le N-1.\n\\end{cases}\n$$\n这个操作实际上在编码的开头用 $m_i$ 个零填充，并截断编码的末尾，因此得到的向量 $\\mathbf{a}_i$ 的长度仍然是 $N$。如果 $m_i \\ge N$，则整个向量 $\\mathbf{a}_i$ 将为零。\n\n**4. 正规矩阵 $\\mathbf{G}$ 及其条件数**\n去混叠正规矩阵定义为 $\\mathbf{G} = \\mathbf{A}^\\top \\mathbf{A}$。元素 $G_{ij}$ 是移位后编码向量的点积：$G_{ij} = \\mathbf{a}_i^\\top \\mathbf{a}_j$。由于时移，即使 $\\mathbf{c}_i^\\top \\mathbf{c}_j = 0$（对于 $i \\ne j$），点积 $\\mathbf{a}_i^\\top \\mathbf{a}_j$ 通常为非零。这些非零的非对角元素代表了在接收器处测量的震源之间的“串扰”或正交性损失。对角元素 $G_{ii} = \\mathbf{a}_i^\\top \\mathbf{a}_i$ 代表了移位和截断后编码的能量，其值小于或等于原始能量 $N$。\n\n$\\mathbf{G}$ 的条件数定义为 $\\kappa(\\mathbf{G}) = \\lambda_{\\max}(\\mathbf{G}) / \\lambda_{\\min}(\\mathbf{G})$，它衡量了去混叠问题的稳定性。$\\kappa(\\mathbf{G}) = 1$ 是理想值。大的条件数表示 $\\mathbf{G}$ 接近奇异，表明数据中的小误差可能导致分离出的震源信号产生大误差。这意味着一个病态且数值不稳定的去混叠问题。如果 $\\mathbf{G}$ 变为奇异矩阵，则 $\\lambda_{\\min}(\\mathbf{G}) = 0$，条件数被认为是无穷大。\n\n**计算算法**\n为了计算每个测试案例的条件数，执行以下步骤：\n1.  获取参数：编码长度 $N$、震源数 $S$、采样频率 $f_s$、速度 $v$、接收器位置 $x_r$ 和震源位置 $\\{x_s^{(i)}\\}$。\n2.  生成 $N \\times N$ 的 Walsh-Hadamard 矩阵 $\\mathbf{H}_N$。取其前 $S$ 列作为震源编码，形成 $N \\times S$ 矩阵 $\\mathbf{C}$。\n3.  对于每个震源 $i=1, \\dots, S$，使用给定公式计算整数样本偏移 $m_i$。\n4.  为 $\\mathbf{A}$ 初始化一个 $N \\times S$ 的零矩阵。\n5.  对于每个震源 $i$，通过将编码 $\\mathbf{c}_i$ 移动 $m_i$ 个样本来构造其对应的列 $\\mathbf{a}_i$，并根据定义应用补零和截断。如果 $m_i  N$，则 $\\mathbf{c}_i$ 的前 $N-m_i$ 个元素被放置到 $\\mathbf{a}_i$ 中，从索引 $m_i$ 开始。\n6.  计算 $S \\times S$ 的正规矩阵 $\\mathbf{G} = \\mathbf{A}^\\top \\mathbf{A}$。\n7.  计算实对称矩阵 $\\mathbf{G}$ 的特征值。\n8.  找到最大特征值 $\\lambda_{\\max}$ 和最小特征值 $\\lambda_{\\min}$。\n9.  如果 $\\lambda_{\\min} \\le 0$，则条件数被视为无穷大。否则，计算为 $\\kappa(\\mathbf{G}) = \\lambda_{\\max} / \\lambda_{\\min}$。\n10. 最终值四舍五入到六位小数。\n\n此过程应用于指定的四个测试案例中的每一个。\n- 案例1代表了零时移的理想情景（所有 $i$ 的 $m_i=0$），其中 $\\mathbf{A}=\\mathbf{C}$ 且保持了完美的正交性，从而得到 $\\kappa(\\mathbf{G}) = 1$。\n- 案例2引入了微小但不同的时移，导致正交性轻微退化，条件数略大于1。\n- 案例3包含一个具有大时移的震源，导致其编码被大量截断。预计这将严重影响正交性并大幅增加条件数。\n- 案例4增加了震源密度（$S=32$），导致更复杂的串扰相互作用，并可能产生更高的条件数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import hadamard\n\ndef solve():\n    \"\"\"\n    Computes the deblending condition number for four simultaneous-source\n    seismic acquisition scenarios.\n    \"\"\"\n    test_cases = [\n        {\n            \"N\": 128, \"fs\": 500, \"v\": 1500, \"xr\": 0, \"S\": 8,\n            \"xs\": np.array([0, 0, 0, 0, 0, 0, 0, 0], dtype=float)\n        },\n        {\n            \"N\": 128, \"fs\": 500, \"v\": 1500, \"xr\": 0, \"S\": 8,\n            \"xs\": np.array([0, 3, 6, 9, 12, 15, 18, 21], dtype=float)\n        },\n        {\n            \"N\": 128, \"fs\": 500, \"v\": 1500, \"xr\": 0, \"S\": 8,\n            \"xs\": np.array([0, 3, 6, 9, 354, 12, 15, 18], dtype=float)\n        },\n        {\n            \"N\": 128, \"fs\": 1000, \"v\": 1500, \"xr\": 0, \"S\": 32,\n            \"xs\": np.array([\n                0, 2.0, 1.5, 4.0, 3.5, 7.0, 6.5, 9.0, 10.5, 13.0, 12.5, 16.0, \n                17.5, 20.0, 22.5, 25.0, 27.5, 30.0, 33.5, 36.0, 38.5, 41.0, \n                43.5, 46.0, 48.5, 50.0, 52.5, 55.0, 57.5, 60.0, 62.5, 65.0\n            ], dtype=float)\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N = case[\"N\"]\n        fs = case[\"fs\"]\n        v = case[\"v\"]\n        xr = case[\"xr\"]\n        S = case[\"S\"]\n        xs = case[\"xs\"]\n\n        # Step 1: Generate Walsh-Hadamard matrix and extract codes\n        # The codes are the first S columns of the Hadamard matrix.\n        H = hadamard(N)\n        C = H[:, :S]\n\n        # Step 2: Calculate integer time shifts for each source\n        shifts_m = np.round(np.abs(xs - xr) / v * fs).astype(int)\n\n        # Step 3: Construct the deblending matrix A by applying shifts\n        A = np.zeros((N, S), dtype=float)\n        for i in range(S):\n            m_i = shifts_m[i]\n            if m_i  N:\n                # The length of the code segment that fits\n                code_len = N - m_i\n                # Get the code for the current source\n                code_i = C[:, i]\n                # Place the truncated code into the shifted position in A\n                A[m_i:, i] = code_i[:code_len]\n        \n        # Step 4: Compute the normal matrix G = A^T * A\n        G = A.T @ A\n\n        # Step 5: Compute eigenvalues of G\n        # eigvalsh is used for real symmetric matrices, it is efficient and returns sorted eigenvalues.\n        eigenvalues = np.linalg.eigvalsh(G)\n        \n        lambda_min = eigenvalues[0]  # Smallest eigenvalue\n        lambda_max = eigenvalues[-1] # Largest eigenvalue\n\n        # Step 6: Calculate the condition number\n        # As per problem, if lambda_min = 0, treat as infinite.\n        # Use a small tolerance for floating point comparison.\n        if lambda_min = 1e-9: # A small tolerance is safer than exact zero\n            cond_num = np.inf\n        else:\n            cond_num = lambda_max / lambda_min\n            \n        results.append(cond_num)\n\n    # Format the results as specified: a list of strings rounded to 6 decimal places.\n    # Handle the case of an infinite condition number.\n    formatted_results = []\n    for r in results:\n        if np.isinf(r):\n            formatted_results.append(\"inf\") \n        else:\n            formatted_results.append(f\"{r:.6f}\")\n\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```", "id": "3614647"}, {"introduction": "我们已经看到，像Walsh-Hadamard序列这样的现成编码，其性能可能会因采集几何而受到影响。那么，我们能否做得更好？我们是否可以针对特定情况“设计”出更优的编码？[@problem_id:3614697] 这个高级练习将你带到现代编码策略的前沿，它要求你构建一个目标函数，旨在通过优化编码向量来最小化全波形反演中梯度估计的方差，并推导出求解该优化问题所需的目标函数梯度。完成此练习将让你深入理解如何从“使用”编码转向“设计”编码，这是发展更高效、更稳健反演算法的核心思想。", "problem": "考虑声波全波形反演（FWI），其中一组 $S$ 个独立的地震炮在固定的背景介质中，通过线性化声波方程和二次最小二乘数据错配计算，产生逐炮错配梯度 $\\mathbf{g}_s \\in \\mathbb{R}^{M}$，其中 $s \\in \\{1,\\dots,S\\}$。将这些梯度堆叠成一个矩阵 $G \\in \\mathbb{R}^{S \\times M}$，方法是设置 $G_{s,:} = \\mathbf{g}_s^{\\top}$。在震源编码策略中，使用 $K$ 个编码向量 $\\{\\mathbf{c}_i\\}_{i=1}^{K}$（其中 $\\mathbf{c}_i \\in \\mathbb{R}^{S}$）来形成编码梯度 $\\mathbf{h}_i = G^{\\top} \\mathbf{c}_i \\in \\mathbb{R}^{M}$。目标是调整编码 $\\{\\mathbf{c}_i\\}$，以最小化编码梯度在编码索引上的方差，同时强制编码具有单位范数和近似正交性。\n\n令 $C \\in \\mathbb{R}^{S \\times K}$ 是以 $\\mathbf{c}_i$ 为列的编码矩阵，并令 $\\mathbf{1} \\in \\mathbb{R}^{K}$ 表示全一向量。对于每个模型参数索引 $m \\in \\{1,\\dots,M\\}$，将编码值 $h_i(m)$ 定义为 $\\mathbf{h}_i$ 的第 $m$ 个分量。考虑每个参数在不同编码下的样本方差，\n$$\n\\operatorname{Var}_{i}\\big(h_i(m)\\big) = \\frac{1}{K}\\sum_{i=1}^{K} h_i(m)^{2} - \\left(\\frac{1}{K}\\sum_{i=1}^{K} h_i(m)\\right)^{2},\n$$\n并将方差目标函数定义为对所有 $m$ 的平均值，\n$$\nJ(C) = \\frac{1}{M} \\sum_{m=1}^{M} \\operatorname{Var}_{i}\\big(h_i(m)\\big).\n$$\n为了强制执行约束 $\\|\\mathbf{c}_i\\|_{2} = 1$ 和 $\\langle \\mathbf{c}_i, \\mathbf{c}_j \\rangle \\approx 0$（对于 $i \\neq j$），使用带有权重 $\\alpha > 0$ 和 $\\beta > 0$ 的惩罚项形式，\n$$\nP_{\\text{norm}}(C) = \\alpha \\sum_{i=1}^{K} \\left(\\|\\mathbf{c}_i\\|_{2}^{2} - 1\\right)^{2},\n\\quad\nP_{\\text{ortho}}(C) = \\beta \\sum_{1 \\leq i  j \\leq K} \\left(\\mathbf{c}_i^{\\top} \\mathbf{c}_j\\right)^{2}.\n$$\n令 $F(C) = J(C) + P_{\\text{norm}}(C) + P_{\\text{ortho}}(C)$ 为总目标函数。仅使用线性算子、内积、方差和矩阵微积分的定义和性质，用矩阵形式明确地表达 $F(C)$，并推导出关于编码矩阵 $C$ 的梯度 $\\nabla_{C} F(C)$，用 $G$、$C$、$K$、$M$、$\\alpha$ 和 $\\beta$ 表示你的结果。你的最终答案必须是单个闭式解析表达式。最终答案中不含物理单位。不要近似；请提供精确表达式。", "solution": "该问题是适定的、有科学依据且客观的。所有变量和函数都有明确定义，任务是在计算地球物理学的有效科学背景下进行标准的矩阵微积分推导。因此，我们可以着手求解。\n\n总目标函数由 $F(C) = J(C) + P_{\\text{norm}}(C) + P_{\\text{ortho}}(C)$ 给出。根据梯度算子的线性性质，总目标函数的梯度是其各组成项梯度之和：\n$$\n\\nabla_{C} F(C) = \\nabla_{C} J(C) + \\nabla_{C} P_{\\text{norm}}(C) + \\nabla_{C} P_{\\text{ortho}}(C).\n$$\n我们将分别推导每一项的梯度。在整个推导过程中，我们将使用以下标准定义：$I_K$ 是 $K \\times K$ 单位矩阵；$\\mathbf{1}_K$ 是 $K \\times 1$ 的全一向量；对于向量 $\\mathbf{v}$，$\\operatorname{diag}(\\mathbf{v})$ 是一个对角矩阵，其对角线上的元素是 $\\mathbf{v}$ 的元素；对于方阵 $A$，$\\operatorname{diag}(A)$ 是一个包含 $A$ 对角线元素的列向量。弗罗贝尼乌斯内积为 $\\langle A, B \\rangle_F = \\operatorname{Tr}(A^{\\top}B)$。\n\n首先，我们将目标函数 $F(C)$ 的每一项用矩阵表示法来表达。\n编码梯度的矩阵是 $H = G^{\\top}C \\in \\mathbb{R}^{M \\times K}$，其中第 $i$ 列是 $\\mathbf{h}_i$，元素 $H_{mi}$ 是 $h_i(m)$。\n\n1.  **方差目标函数 $J(C)$**：\n    $J(C) = \\frac{1}{M} \\sum_{m=1}^{M} \\operatorname{Var}_{i}\\big(h_i(m)\\big) = \\frac{1}{M} \\sum_{m=1}^{M} \\left[ \\frac{1}{K}\\sum_{i=1}^{K} h_i(m)^{2} - \\left(\\frac{1}{K}\\sum_{i=1}^{K} h_i(m)\\right)^{2} \\right]$。\n    我们识别出对 $i$ 和 $m$ 的求和。\n    项 $\\sum_{m=1}^{M} \\sum_{i=1}^{K} h_i(m)^{2}$ 是 $H$ 的弗罗贝尼乌斯范数的平方，即 $\\|H\\|_F^2 = \\operatorname{Tr}(H^{\\top}H)$。\n    项 $\\sum_{i=1}^{K} h_i(m)$ 是向量 $H\\mathbf{1}_K$ 的第 $m$ 个元素。\n    和 $\\sum_{m=1}^{M} \\left(\\sum_{i=1}^{K} h_i(m)\\right)^{2}$ 是向量 $H\\mathbf{1}_K$ 的欧几里得范数的平方，即 $\\|H\\mathbf{1}_K\\|_2^2$。\n    将这些代入 $J(C)$ 的表达式中：\n    $J(C) = \\frac{1}{M} \\left[ \\frac{1}{K} \\|H\\|_F^2 - \\frac{1}{K^2} \\|H\\mathbf{1}_K\\|_2^2 \\right]$。\n    现在，代入 $H = G^{\\top}C$：\n    $J(C) = \\frac{1}{MK} \\operatorname{Tr}((G^{\\top}C)^{\\top}(G^{\\top}C)) - \\frac{1}{MK^2} (G^{\\top}C\\mathbf{1}_K)^{\\top}(G^{\\top}C\\mathbf{1}_K)$\n    $J(C) = \\frac{1}{MK} \\operatorname{Tr}(C^{\\top}GG^{\\top}C) - \\frac{1}{MK^2} \\mathbf{1}_K^{\\top}C^{\\top}GG^{\\top}C\\mathbf{1}_K$。\n\n2.  **范数惩罚项 $P_{\\text{norm}}(C)$**：\n    $P_{\\text{norm}}(C) = \\alpha \\sum_{i=1}^{K} \\left(\\|\\mathbf{c}_i\\|_{2}^{2} - 1\\right)^{2}$。\n    平方范数 $\\|\\mathbf{c}_i\\|_2^2$ 是矩阵 $C^{\\top}C$ 的第 $i$ 个对角元素。这对应于向量 $\\operatorname{diag}(C^{\\top}C)$ 的第 $i$ 个元素。\n    所以，$P_{\\text{norm}}(C) = \\alpha \\sum_{i=1}^{K} \\left( (\\operatorname{diag}(C^{\\top}C))_i - 1 \\right)^{2} = \\alpha \\|\\operatorname{diag}(C^{\\top}C) - \\mathbf{1}_K\\|_2^2$。\n\n3.  **正交性惩罚项 $P_{\\text{ortho}}(C)$**：\n    $P_{\\text{ortho}}(C) = \\beta \\sum_{1 \\leq i  j \\leq K} \\left(\\mathbf{c}_i^{\\top} \\mathbf{c}_j\\right)^{2}$。\n    内积 $\\mathbf{c}_i^{\\top}\\mathbf{c}_j$ 是 $C^{\\top}C$ 的第 $(i,j)$ 个元素。求和是对 $C^{\\top}C$ 上三角部分的非对角元素的平方进行的。由于 $C^{\\top}C$ 是对称的，我们可以将其写为所有非对角元素平方和的一半：\n    $P_{\\text{ortho}}(C) = \\frac{\\beta}{2} \\sum_{i \\neq j} ( (C^{\\top}C)_{ij} )^2$。\n    这个和是 $C^{\\top}C$ 的弗罗贝尼乌斯范数的平方减去其对角元素平方和：\n    $P_{\\text{ortho}}(C) = \\frac{\\beta}{2} \\left(\\|C^{\\top}C\\|_F^2 - \\|\\operatorname{diag}(C^{\\top}C)\\|_F^2 \\right)$。\n\n现在，我们推导每一项的梯度。\n\n**$J(C)$ 的梯度**：\n令 $A = GG^{\\top}$，这是一个对称的 $S \\times S$ 矩阵。\n$J(C) = \\frac{1}{MK} \\operatorname{Tr}(C^{\\top}AC) - \\frac{1}{MK^2} \\mathbf{1}_K^{\\top}C^{\\top}AC\\mathbf{1}_K$。\n我们使用矩阵微积分恒等式：对于对称矩阵 $A$，有 $\\nabla_X \\operatorname{Tr}(X^{\\top}AX) = AX + A^{\\top}X = 2AX$；对于对称矩阵 $B$，有 $\\nabla_X \\mathbf{a}^{\\top}X^{\\top}BX\\mathbf{a} = BX\\mathbf{a}\\mathbf{a}^{\\top} + B^{\\top}X\\mathbf{a}\\mathbf{a}^{\\top} = 2BX\\mathbf{a}\\mathbf{a}^{\\top}$。\n$\\nabla_C J(C) = \\frac{1}{MK} (2AC) - \\frac{1}{MK^2} (2AC\\mathbf{1}_K\\mathbf{1}_K^{\\top})$。\n$\\nabla_C J(C) = \\frac{2}{MK} AC - \\frac{2}{MK^2} AC\\mathbf{1}_K\\mathbf{1}_K^{\\top} = \\frac{2}{MK} AC \\left(I_K - \\frac{1}{K}\\mathbf{1}_K\\mathbf{1}_K^{\\top}\\right)$。\n将 $A=GG^{\\top}$ 代回：\n$$\n\\nabla_C J(C) = \\frac{2}{MK} GG^{\\top}C \\left(I_K - \\frac{1}{K}\\mathbf{1}_K\\mathbf{1}_K^{\\top}\\right).\n$$\n\n**$P_{\\text{norm}}(C)$ 的梯度**：\n$P_{\\text{norm}}(C) = \\alpha \\sum_{i=1}^{K} \\left(\\mathbf{c}_i^{\\top}\\mathbf{c}_i - 1\\right)^{2}$。\n为了求得关于矩阵 $C$ 的梯度，我们可以先求出关于每一列 $\\mathbf{c}_k$ 的梯度，然后将结果组合起来。$\\nabla_C P_{\\text{norm}}(C)$ 的第 $k$ 列是 $\\nabla_{\\mathbf{c}_k} P_{\\text{norm}}(C)$。\n$\\nabla_{\\mathbf{c}_k} P_{\\text{norm}}(C) = \\alpha \\nabla_{\\mathbf{c}_k} \\left(\\mathbf{c}_k^{\\top}\\mathbf{c}_k - 1\\right)^{2} = \\alpha \\cdot 2(\\mathbf{c}_k^{\\top}\\mathbf{c}_k - 1) \\cdot (2\\mathbf{c}_k) = 4\\alpha (\\|\\mathbf{c}_k\\|_2^2 - 1)\\mathbf{c}_k$。\n将这些列组装成梯度矩阵，得到一个其第 $k$ 列是 $C$ 的第 $k$ 列的缩放版本的矩阵。这可以写成与一个对角矩阵的后乘：\n$$\n\\nabla_C P_{\\text{norm}}(C) = 4\\alpha C \\operatorname{diag}\\left(\\operatorname{diag}(C^{\\top}C) - \\mathbf{1}_K\\right).\n$$\n\n**$P_{\\text{ortho}}(C)$ 的梯度**：\n$P_{\\text{ortho}}(C) = \\beta \\sum_{1 \\leq i  j \\leq K} \\left(\\mathbf{c}_i^{\\top} \\mathbf{c}_j\\right)^{2}$。\n同样，我们计算对第 $k$ 列 $\\mathbf{c}_k$ 的梯度贡献。对于给定的 $k$，$\\mathbf{c}_k$ 出现在 $(\\mathbf{c}_i^{\\top}\\mathbf{c}_k)^2$（当 $i  k$）和 $(\\mathbf{c}_k^{\\top}\\mathbf{c}_j)^2$（当 $j > k$）这些项中。\n关于 $\\mathbf{c}_k$ 的梯度是：\n$\\nabla_{\\mathbf{c}_k} P_{\\text{ortho}}(C) = \\beta \\sum_{j \\neq k} \\nabla_{\\mathbf{c}_k} (\\mathbf{c}_k^{\\top}\\mathbf{c}_j)^2 = \\beta \\sum_{j \\neq k} 2(\\mathbf{c}_k^{\\top}\\mathbf{c}_j)\\mathbf{c}_j$。\n这是梯度矩阵的第 $k$ 列。用矩阵形式，这个操作可以表示为：\n$\\sum_{j \\neq k} \\mathbf{c}_j (\\mathbf{c}_j^{\\top}\\mathbf{c}_k) = C \\left( (C^{\\top}C)_{\\text{col } k} - (C^{\\top}C)_{kk}\\mathbf{e}_k \\right)$，其中 $\\mathbf{e}_k$ 是第 $k$ 个标准基向量。\n将此扩展到所有列，完整的梯度矩阵是：\n$2\\beta C \\left( C^{\\top}C - \\operatorname{diag}(\\operatorname{diag}(C^{\\top}C)) \\right)$。\n因此：\n$$\n\\nabla_C P_{\\text{ortho}}(C) = 2\\beta C \\left(C^{\\top}C - \\operatorname{diag}(\\operatorname{diag}(C^{\\top}C))\\right).\n$$\n\n**总梯度**：\n结合这三个分量，总梯度 $\\nabla_C F(C)$ 为：\n$$\n\\nabla_C F(C) = \\frac{2}{MK} GG^{\\top}C \\left(I_K - \\frac{1}{K}\\mathbf{1}_K\\mathbf{1}_K^{\\top}\\right) + 4\\alpha C \\operatorname{diag}\\left(\\operatorname{diag}(C^{\\top}C) - \\mathbf{1}_K\\right) + 2\\beta C \\left(C^{\\top}C - \\operatorname{diag}(\\operatorname{diag}(C^{\\top}C))\\right).\n$$\n这就是总目标函数关于编码矩阵 $C$ 的梯度的最终闭式解析表达式。", "answer": "$$\n\\boxed{\\frac{2}{MK} GG^{\\top}C \\left(I_K - \\frac{1}{K}\\mathbf{1}_K\\mathbf{1}_K^{\\top}\\right) + 4\\alpha C \\operatorname{diag}\\left(\\operatorname{diag}(C^{\\top}C) - \\mathbf{1}_K\\right) + 2\\beta C \\left(C^{\\top}C - \\operatorname{diag}(\\operatorname{diag}(C^{\\top}C))\\right)}\n$$", "id": "3614697"}]}