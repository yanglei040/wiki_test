{"hands_on_practices": [{"introduction": "有限元网格的质量直接影响数值解的物理真实性，一个精心设计的网格是获得可靠模拟结果的前提。本练习将通过一个具体的计算，揭示单元几何形状（尤其是钝角三角形）如何破坏离散算子的关键属性（即M-矩阵性质），从而可能导致非物理的数值振荡。通过完成这个实践[@problem_id:3594914]，你将深入理解离散最大值原理及其在保证解的稳定性方面的重要性，并将理论与实践紧密联系起来。", "problem": "考虑均匀各向同性介质中的二维热传导方程，\n$$c\\,\\partial_t u - \\nabla \\cdot (k\\,\\nabla u) = f \\quad \\text{in } \\Omega \\subset \\mathbb{R}^2,$$\n其中热导率 $k>0$ 和体积热容 $c>0$ 为常数。在三角形网格上进行线性有限元空间离散化后，半离散系统具有以下形式\n$$M\\,\\dot{\\mathbf{u}} + K\\,\\mathbf{u} = \\mathbf{F},$$\n其中 $M$ 是质量矩阵，$K$ 是刚度矩阵，$\\mathbf{F}$ 是载荷向量。经过大小为 $\\Delta t>0$ 的后向欧拉时间步长后，全离散系统为\n$$(M + \\Delta t\\,K)\\,\\mathbf{u}^{n+1} = M\\,\\mathbf{u}^n + \\Delta t\\,\\mathbf{F}^{n+1}.$$\n一个非对角元素非正且其逆矩阵所有元素非负的矩阵称为 M 矩阵（单调矩阵）。在能为离散算子生成 M 矩阵的网格上，离散极值原理成立，从而避免了伪超调。\n\n构建以下简单的网格片：两个三角形共享节点 $1$ 和 $2$ 之间的内部边，节点坐标为\n$$\\mathbf{x}_1=(0,0),\\quad \\mathbf{x}_2=(1,0),\\quad \\mathbf{x}_3=(0.5,\\,0.1),\\quad \\mathbf{x}_4=(0.5,\\,-0.1),$$\n三角形为 $T_1=(1,2,3)$ 和 $T_2=(1,2,4)$。取 $k=1$ 和 $c=1$。严格根据弱形式和线性形函数的定义，推导单元刚度贡献 $K_{12}^{T_1}$ 和 $K_{12}^{T_2}$，并为该网格片组装非对角刚度项 $K_{12}$。然后，根据 $(M+\\Delta t\\,K)$ 的性质和离散极值原理进行推理，评估其对后向欧拉解的影响以及是否可能出现超调。\n\n下列陈述中，哪些是正确的？\n\nA. 对于此网格，组装后的非对角刚度项 $K_{12}$ 是严格为正的，这违反了空间算子的 M 矩阵性质，并可能在后向欧拉解中导致内部边附近出现超调。\n\nB. 使用质量集中（对角阵 $M$）可以保证即使在钝角三角形上，$(M+\\Delta t\\,K)$ 的非对角元也为非正，因此离散极值原理成立。\n\nC. 如果某些非对角刚度项为正，则在固定的网格上，仅减小时间步长 $\\Delta t$ 不能保证消除超调；这种违规源于几何原因。\n\nD. 通过重新划分网格（通过适当的边翻转）得到锐角或 Delaunay 三角剖分，可以恢复非正的非对角刚度项和离散极值原理所需的单调性。", "solution": "该问题陈述被评估为有效，因为它在偏微分方程数值方法的理论中有科学依据，问题设定良好，目标明确，数据充分，并使用精确、客观的语言。\n\n问题的核心是确定给定网格片的刚度矩阵非对角项 $K_{12}$ 的符号，并分析其对后向欧拉时间步进格式的影响。\n\n刚度矩阵 $K$ 源于项 $-\\nabla \\cdot (k\\,\\nabla u)$ 的空间离散化。其矩阵元由弱形式给出：\n$$ K_{ij} = \\int_\\Omega k (\\nabla \\phi_j \\cdot \\nabla \\phi_i) \\, d\\Omega $$\n其中 $\\phi_i$ 和 $\\phi_j$ 是与节点 $i$ 和 $j$ 相关联的线性基（帽）函数。全局矩阵元 $K_{12}$ 通过对包含节点 $1$ 和 $2$ 的所有单元的贡献求和来组装。在本例中，这些单元是三角形 $T_1 = (1,2,3)$ 和 $T_2 = (1,2,4)$。\n$$ K_{12} = K_{12}^{T_1} + K_{12}^{T_2} = \\int_{T_1} k (\\nabla \\phi_2 \\cdot \\nabla \\phi_1) \\, d\\Omega + \\int_{T_2} k (\\nabla \\phi_2 \\cdot \\nabla \\phi_1) \\, d\\Omega $$\n对于三角形上的线性单元，有一个标准公式将非对角单元刚度项与相应边对角的余切值联系起来。对于由节点 $i$ 和 $j$ 共享的边，三角形的第三个顶点为 $k$，其贡献为：\n$$ K_{ij}^T = -k \\frac{\\cot \\theta_k}{2} $$\n其中 $\\theta_k$ 是三角形在顶点 $k$ 处的内角。\n\n我们将此公式应用于给定的网格片，其中 $k=1$。\n\n对于三角形 $T_1 = (1,2,3)$：\n顶点为 $\\mathbf{x}_1=(0,0)$、$\\mathbf{x}_2=(1,0)$ 和 $\\mathbf{x}_3=(0.5,\\,0.1)$。非对角项 $K_{12}^{T_1}$ 对应于边 $(1,2)$，所以我们需要对角顶点 $\\mathbf{x}_3$ 处的角 $\\theta_3$。我们可以使用构成该角的向量的点积来求得此角：\n$$ \\mathbf{v}_{31} = \\mathbf{x}_1 - \\mathbf{x}_3 = (0-0.5, \\, 0-0.1) = (-0.5, -0.1) $$\n$$ \\mathbf{v}_{32} = \\mathbf{x}_2 - \\mathbf{x}_3 = (1-0.5, \\, 0-0.1) = (0.5, -0.1) $$\n角 $\\theta_3$ 的余弦值为：\n$$ \\cos \\theta_3 = \\frac{\\mathbf{v}_{31} \\cdot \\mathbf{v}_{32}}{|\\mathbf{v}_{31}| |\\mathbf{v}_{32}|} = \\frac{(-0.5)(0.5) + (-0.1)(-0.1)}{\\sqrt{(-0.5)^2 + (-0.1)^2} \\sqrt{(0.5)^2 + (-0.1)^2}} = \\frac{-0.25 + 0.01}{0.25 + 0.01} = \\frac{-0.24}{0.26} = -\\frac{12}{13} $$\n由于 $\\cos \\theta_3  0$，角 $\\theta_3$ 是一个钝角。为了求出余切，我们先求正弦：\n$$ \\sin \\theta_3 = \\sqrt{1 - \\cos^2 \\theta_3} = \\sqrt{1 - \\left(-\\frac{12}{13}\\right)^2} = \\sqrt{1 - \\frac{144}{169}} = \\sqrt{\\frac{25}{169}} = \\frac{5}{13} $$\n余切值为：\n$$ \\cot \\theta_3 = \\frac{\\cos \\theta_3}{\\sin \\theta_3} = \\frac{-12/13}{5/13} = -\\frac{12}{5} = -2.4 $$\n现在我们计算来自 $T_1$ 的刚度贡献：\n$$ K_{12}^{T_1} = -k \\frac{\\cot \\theta_3}{2} = -(1) \\frac{-2.4}{2} = 1.2 $$\n\n对于三角形 $T_2 = (1,2,4)$：\n顶点为 $\\mathbf{x}_1=(0,0)$、$\\mathbf{x}_2=(1,0)$ 和 $\\mathbf{x}_4=(0.5,\\,-0.1)$。这个三角形是 $T_1$ 沿x轴的镜像。根据对称性，顶点 $\\mathbf{x}_4$ 处的角 $\\theta_4$ 等于 $\\theta_3$。因此，$\\cot \\theta_4 = -2.4$。\n来自 $T_2$ 的刚度贡献为：\n$$ K_{12}^{T_2} = -k \\frac{\\cot \\theta_4}{2} = -(1) \\frac{-2.4}{2} = 1.2 $$\n\n最后，我们通过对各项贡献求和来组装全局（网格片）刚度项 $K_{12}$：\n$$ K_{12} = K_{12}^{T_1} + K_{12}^{T_2} = 1.2 + 1.2 = 2.4 $$\n结果是非对角刚度项 $K_{12}$ 是严格为正的。\n\n后向欧拉法的全离散系统是 $(M + \\Delta t\\,K)\\,\\mathbf{u}^{n+1} = M\\,\\mathbf{u}^n + \\Delta t\\,\\mathbf{F}^{n+1}$。设系统矩阵为 $A = M + \\Delta t\\,K$。一个 M 矩阵必须具有非正的非对角元。非对角项 $A_{12}$ 由下式给出：\n$$ A_{12} = M_{12} + \\Delta t\\,K_{12} $$\n一致质量矩阵项 $M_{12}$ 大于零（$M_{12} = \\sum_e \\int_{T_e} c \\phi_1 \\phi_2 d\\Omega > 0$）。当 $c=1$ 时，$M_{12} = M_{12}^{T_1} + M_{12}^{T_2} = \\frac{1 \\cdot \\text{Area}(T_1)}{12} + \\frac{1 \\cdot \\text{Area}(T_2)}{12} = \\frac{0.05}{12} + \\frac{0.05}{12} = \\frac{0.1}{12} > 0$。\n由于 $M_{12} > 0$、$K_{12} = 2.4 > 0$ 和 $\\Delta t > 0$，因此对于任何 $\\Delta t > 0$ 的选择，非对角项 $A_{12}$ 都是严格为正的。\n$$ A_{12} = M_{12} + 2.4\\,\\Delta t > 0 $$\n系统矩阵 $A$ 不是一个 M 矩阵。因此，防止伪振荡的离散极值原理不保证成立。\n\n现在，我们评估每个给定的选项。\n\nA. 对于此网格，组装后的非对角刚度项 $K_{12}$ 是严格为正的，这违反了空间算子的 M 矩阵性质，并可能在后向欧拉解中导致内部边附近出现超调。\n我们的计算表明 $K_{12}=2.4$，是严格为正的。这违反了刚度矩阵成为 M 矩阵相关矩阵的必要条件（对于 $i \\ne j$，$K_{ij} \\le 0$）。由此产生的后向欧拉系统矩阵 $A=M+\\Delta t K$ 也将有一个正的非对角项 $A_{12}$，意味着它不是一个 M 矩阵。众所周知，不具备 M 矩阵性质会导致数值解中出现非物理的超调和下冲。因此，这个陈述是准确的。\n**结论：正确。**\n\nB. 使用质量集中（对角阵 $M$）可以保证即使在钝角三角形上，$(M+\\Delta t\\,K)$ 的非对角元也为非正，因此离散极值原理成立。\n如果使用质量集中，质量矩阵 $M$ 变为对角矩阵，所以其非对角项为零，即 $M_{12}=0$。系统矩阵的非对角项变为 $A_{12} = 0 + \\Delta t\\,K_{12} = \\Delta t(2.4)$。由于 $\\Delta t > 0$ 和 $K_{12} > 0$，$A_{12}$ 仍然是严格为正的。关于非对角元变为非正的陈述是错误的。因此，离散极值原理不被保证。\n**结论：不正确。**\n\nC. 如果某些非对角刚度项为正，则在固定的网格上，仅减小时间步长 $\\Delta t$ 不能保证消除超调；这种违规源于几何原因。\n$K_{12}$ 的正值是网格三角形中钝角的直接结果，这是一个纯粹的几何属性。如上所示，系统矩阵的非对角项为 $A_{12} = M_{12} + \\Delta t\\,K_{12}$。由于 $M_{12}$（无论是一致质量矩阵还是集中质量矩阵）和 $K_{12}$ 都是非负的，且至少 $K_{12}$ 是严格为正的，所以对于任何 $\\Delta t > 0$，$A_{12}$ 都是严格为正的。减小 $\\Delta t$ 会缩小 $\\Delta t K_{12}$ 项的大小，但不会改变其符号。对于所有 $\\Delta t >0$，M 矩阵条件仍然被违反。根本原因是网格几何形状，而不是时间步长的大小。\n**结论：正确。**\n\nD. 通过重新划分网格（通过适当的边翻转）得到锐角或 Delaunay 三角剖分，可以恢复非正的非对角刚度项和离散极值原理所需的单调性。\n由共享边 $(i,j)$ 的三角形组装而成的非对角项 $K_{ij}$ 为非正（$K_{ij} \\le 0$），当且仅当该边对角的余切值之和为非负。该条件等价于要求对角之和小于或等于 $\\pi$（$180^\\circ$），这恰好是该边的 Delaunay 条件。对所有内部边都满足此条件的三角剖分是 Delaunay 三角剖分。创建一个完全由锐角（或非钝角）三角形组成的网格是一个更严格的条件，它也保证了对于所有 $i \\ne j$ 都有 $K_{ij} \\le 0$。因此，重新划分网格以满足 Delaunay 条件或非钝角条件将确保所有非对角刚度项均为非正。这将恢复系统矩阵（在有合适的质量矩阵，如集中质量矩阵的情况下）的 M 矩阵性质，从而恢复离散极值原理。\n**结论：正确。**", "answer": "$$\\boxed{ACD}$$", "id": "3594914"}, {"introduction": "在有限元实现中，计算质量矩阵和刚度矩阵时常采用数值积分，而积分规则的选择会对离散系统的动力学特性产生微妙而深远的影响。本练习[@problem_id:3594966]旨在探索不同积分方案（精确积分与降阶积分）如何改变问题的谱特性。通过对一维热传导问题进行谱分析，你将精确量化数值积分误差如何扭曲离散扩散算子的特征值，从而加深对计算保真度与效率之间权衡的理解。", "problem": "考虑在一个代表岩石圈横断面的均匀介质中的一维热扩散，其边界条件为周期性的。控制方程为定义域 $x \\in [0,L]$ 上的抛物型偏微分方程 $u_{t} = \\kappa u_{xx}$，其中 $\\kappa0$ 是一个常数。设 $V_{h}$ 是在一个包含 $N$ 个大小为 $h=L/N$ 的单元的均匀网格上的连续分段线性函数空间。标准伽辽金半离散化得到矩阵常微分方程 $M \\dot{\\mathbf{u}} + K \\mathbf{u} = \\mathbf{0}$，其中质量矩阵 $M$ 和刚度矩阵 $K$ 的元素分别为 $M_{ij} = \\int_{0}^{L} \\phi_{i} \\phi_{j} \\, \\mathrm{d}x$ 和 $K_{ij} = \\kappa \\int_{0}^{L} \\phi_{i}' \\phi_{j}' \\, \\mathrm{d}x$，其中 $\\{\\phi_{i}\\}$ 表示标准的帽状基函数。\n\n定义离散扩散算子 $A = M^{-1}K$，并假设采用周期性边界条件，因此离散傅里叶模态是由均匀组装产生的循环矩阵的特征向量。假设 $K$ 是精确积分的。考虑 $M$ 的两种选择：精确积分的质量矩阵 $M^{\\mathrm{ex}}$ 和通过在每个单元中心的单个 Gauss 点计算的减缩积分质量矩阵 $M^{\\mathrm{ri}}$。\n\n仅使用伽辽金方法的基本定义、均匀网格上的单元组装以及循环矩阵的离散傅里叶分析，推导算子 $A$ 对应于无量纲波数 $\\theta \\in (0,\\pi)$ 的特征值 $\\lambda^{\\mathrm{ex}}(\\theta)$ 和 $\\lambda^{\\mathrm{ri}}(\\theta)$ 的精确表达式，其中 $\\theta = 2\\pi m/N$，对于某个整数 $m \\in \\{1,2,\\dots,N-1\\}$，且当 $N$ 为偶数时 $m \\neq N/2$。基于这些结果，确定精确的乘性畸变因子\n$$\nR(\\theta) = \\frac{\\lambda^{\\mathrm{ri}}(\\theta)}{\\lambda^{\\mathrm{ex}}(\\theta)}\n$$\n该因子分离出质量矩阵中由求积引起的相容性误差对离散扩散算子特征值的影响。将 $R(\\theta)$ 表示为仅含 $\\theta$ 的闭式解析表达式。不需要数值近似或四舍五入。将最终答案表示为无单位的精确符号表达式。", "solution": "该问题是有效的，因为它在偏微分方程的数值分析方面有科学依据，是适定的、客观的，并且包含获得唯一解所需的所有信息。\n\n该问题要求在质量矩阵 $M$ 的两种不同选择下，离散扩散算子 $A = M^{-1}K$ 的特征值之比。离散化是在具有 $N$ 个大小为 $h=L/N$ 的单元的均匀网格上，并采用周期性边界条件进行的。这种设置确保了全局刚度矩阵 $K$ 和两个质量矩阵（$M^{\\mathrm{ex}}$ 用于精确积分，$M^{\\mathrm{ri}}$ 用于减缩积分）都是循环矩阵。\n\n循环矩阵的一个基本性质是它们可以被离散傅里叶变换对角化。这意味着它们都共享同一组特征向量，即离散傅里叶模态 $\\mathbf{v}_m$，其分量为 $(\\mathbf{v}_m)_j = \\exp(i j \\theta)$，其中 $\\theta = 2\\pi m / N$ 是模态 $m$ 的无量纲波数。如果 $\\hat{K}(\\theta)$ 和 $\\hat{M}(\\theta)$ 分别是 $K$ 和 $M$ 对应于波数 $\\theta$ 的特征向量的特征值，那么算子 $A = M^{-1}K$ 的特征值 $\\lambda(\\theta)$ 就由这些特征值的比值给出：\n$$\nA \\mathbf{v} = M^{-1}K \\mathbf{v} = M^{-1}(\\hat{K}(\\theta)\\mathbf{v}) = \\hat{K}(\\theta) M^{-1}\\mathbf{v} = \\hat{K}(\\theta) \\frac{1}{\\hat{M}(\\theta)} \\mathbf{v} = \\frac{\\hat{K}(\\theta)}{\\hat{M}(\\theta)} \\mathbf{v}\n$$\n因此，$\\lambda(\\theta) = \\frac{\\hat{K}(\\theta)}{\\hat{M}(\\theta)}$。\n\n离散扩散算子的两组特征值为：\n$$\n\\lambda^{\\mathrm{ex}}(\\theta) = \\frac{\\hat{K}(\\theta)}{\\hat{M}^{\\mathrm{ex}}(\\theta)} \\quad \\text{和} \\quad \\lambda^{\\mathrm{ri}}(\\theta) = \\frac{\\hat{K}(\\theta)}{\\hat{M}^{\\mathrm{ri}}(\\theta)}\n$$\n所需的畸变因子 $R(\\theta)$ 是它们的比值：\n$$\nR(\\theta) = \\frac{\\lambda^{\\mathrm{ri}}(\\theta)}{\\lambda^{\\mathrm{ex}}(\\theta)} = \\frac{\\hat{K}(\\theta) / \\hat{M}^{\\mathrm{ri}}(\\theta)}{\\hat{K}(\\theta) / \\hat{M}^{\\mathrm{ex}}(\\theta)} = \\frac{\\hat{M}^{\\mathrm{ex}}(\\theta)}{\\hat{M}^{\\mathrm{ri}}(\\theta)}\n$$\n这个结果显著地简化了问题，因为它表明刚度矩阵的性质相互抵消，我们只需要比较两个质量矩阵的特征值。为求完整，按照问题陈述的要求，我们将在计算最终比值之前推导所有三个矩阵（$K$、$M^{\\mathrm{ex}}$、$M^{\\mathrm{ri}}$）的特征值。\n\n首先，我们计算长度为 $h$ 的一个一般单元 $[x_j, x_{j+1}]$ 的单元矩阵。局部基函数是线性的“帽状”函数，在该单元上为 $n_j(x) = (x_{j+1}-x)/h$ 和 $n_{j+1}(x) = (x-x_j)/h$。它们的导数是 $n_j'(x) = -1/h$ 和 $n_{j+1}'(x) = 1/h$。\n\n单元刚度矩阵 $K^e$ 的元素为 $K^e_{ab} = \\int_{x_j}^{x_{j+1}} \\kappa \\, n'_a(x) n'_b(x) \\, \\mathrm{d}x$：\n$K^e_{11} = \\int_{x_j}^{x_{j+1}} \\kappa (-\\frac{1}{h})^2 \\, \\mathrm{d}x = \\frac{\\kappa}{h^2} h = \\frac{\\kappa}{h}$。\n$K^e_{12} = \\int_{x_j}^{x_{j+1}} \\kappa (-\\frac{1}{h})(\\frac{1}{h}) \\, \\mathrm{d}x = -\\frac{\\kappa}{h}$。\n根据对称性，$K^e_{21} = -\\frac{\\kappa}{h}$ 且 $K^e_{22} = \\frac{\\kappa}{h}$。\n$$\nK^e = \\frac{\\kappa}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}\n$$\n\n精确积分的单元质量矩阵 $M^{e, \\mathrm{ex}}$ 的元素为 $M^{e, \\mathrm{ex}}_{ab} = \\int_{x_j}^{x_{j+1}} n_a(x) n_b(x) \\, \\mathrm{d}x$：\n$M^{e, \\mathrm{ex}}_{11} = \\int_{x_j}^{x_{j+1}} \\left(\\frac{x_{j+1}-x}{h}\\right)^2 \\, \\mathrm{d}x = \\frac{h}{3}$。\n$M^{e, \\mathrm{ex}}_{12} = \\int_{x_j}^{x_{j+1}} \\left(\\frac{x_{j+1}-x}{h}\\right)\\left(\\frac{x-x_j}{h}\\right) \\, \\mathrm{d}x = \\frac{h}{6}$。\n根据对称性，$M^{e, \\mathrm{ex}}_{21} = \\frac{h}{6}$ 且 $M^{e, \\mathrm{ex}}_{22} = \\frac{h}{3}$。\n$$\nM^{e, \\mathrm{ex}} = \\frac{h}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}\n$$\n\n减缩积分的单元质量矩阵 $M^{e, \\mathrm{ri}}$ 是使用位于单元中心 $x_c = (x_j+x_{j+1})/2$ 的单个 Gauss 点计算的。其求积法则为 $\\int_{x_j}^{x_{j+1}} f(x) \\, \\mathrm{d}x \\approx h f(x_c)$。被积函数为 $n_a(x)n_b(x)$。在 $x_c$ 点，我们有 $n_j(x_c) = 1/2$ 和 $n_{j+1}(x_c) = 1/2$。\n$M^{e, \\mathrm{ri}}_{11} \\approx h \\cdot n_j(x_c) \\cdot n_j(x_c) = h(\\frac{1}{2})(\\frac{1}{2}) = \\frac{h}{4}$。\n$M^{e, \\mathrm{ri}}_{12} \\approx h \\cdot n_j(x_c) \\cdot n_{j+1}(x_c) = h(\\frac{1}{2})(\\frac{1}{2}) = \\frac{h}{4}$。\n根据对称性，$M^{e, \\mathrm{ri}}_{21} = M^{e, \\mathrm{ri}}_{22} = \\frac{h}{4}$。\n$$\nM^{e, \\mathrm{ri}} = \\frac{h}{4} \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix}\n$$\n\n接下来，我们组装全局矩阵。对于一个一般节点 $i$，全局矩阵 $C$ 的对角元素 $C_{ii}$ 是来自左侧单元 $[x_{i-1}, x_i]$ 的局部 $C^e_{22}$ 和来自右侧单元 $[x_i, x_{i+1}]$ 的局部 $C^e_{11}$ 之和。非对角元素 $C_{i, i+1}$ 是来自单元 $[x_i, x_{i+1}]$ 的局部 $C^e_{12}$。该结构生成一个由模板 $(c_1, c_0, c_1)$ 定义的对称三对角循环矩阵，其中 $c_0$ 是主对角元素，$c_1$ 是非对角元素。\n$c_0(C) = C^e_{11} + C^e_{22}$，$c_1(C) = C^e_{12}$。\n\n$K$ 的模板： $c_0 = \\frac{\\kappa}{h} + \\frac{\\kappa}{h} = \\frac{2\\kappa}{h}$，$c_1 = -\\frac{\\kappa}{h}$。模板：$\\frac{\\kappa}{h}(-1, 2, -1)$。\n$M^{\\mathrm{ex}}$ 的模板： $c_0 = \\frac{2h}{6} + \\frac{2h}{6} = \\frac{4h}{6}$，$c_1 = \\frac{h}{6}$。模板：$\\frac{h}{6}(1, 4, 1)$。\n$M^{\\mathrm{ri}}$ 的模板： $c_0 = \\frac{h}{4} + \\frac{h}{4} = \\frac{2h}{4}$，$c_1 = \\frac{h}{4}$。模板：$\\frac{h}{4}(1, 2, 1)$。\n\n具有模板 $(c_1, c_0, c_1)$ 的对称循环矩阵的特征值为 $\\hat{C}(\\theta) = c_0 + 2c_1\\cos(\\theta)$。\n使用这个公式，我们求得这些矩阵的特征值：\n$\\hat{K}(\\theta) = \\frac{2\\kappa}{h} + 2(-\\frac{\\kappa}{h})\\cos(\\theta) = \\frac{2\\kappa}{h}(1 - \\cos(\\theta)) = \\frac{4\\kappa}{h}\\sin^2(\\frac{\\theta}{2})$。\n$\\hat{M}^{\\mathrm{ex}}(\\theta) = \\frac{4h}{6} + 2(\\frac{h}{6})\\cos(\\theta) = \\frac{h}{3}(2 + \\cos(\\theta))$。\n$\\hat{M}^{\\mathrm{ri}}(\\theta) = \\frac{2h}{4} + 2(\\frac{h}{4})\\cos(\\theta) = \\frac{h}{2}(1 + \\cos(\\theta))$。\n\n现在我们可以写出 $\\lambda^{\\mathrm{ex}}(\\theta)$ 和 $\\lambda^{\\mathrm{ri}}(\\theta)$ 的表达式：\n$$\n\\lambda^{\\mathrm{ex}}(\\theta) = \\frac{\\hat{K}(\\theta)}{\\hat{M}^{\\mathrm{ex}}(\\theta)} = \\frac{\\frac{2\\kappa}{h}(1 - \\cos(\\theta))}{\\frac{h}{3}(2 + \\cos(\\theta))} = \\frac{6\\kappa}{h^2}\\frac{1 - \\cos(\\theta)}{2 + \\cos(\\theta)}\n$$\n$$\n\\lambda^{\\mathrm{ri}}(\\theta) = \\frac{\\hat{K}(\\theta)}{\\hat{M}^{\\mathrm{ri}}(\\theta)} = \\frac{\\frac{2\\kappa}{h}(1 - \\cos(\\theta))}{\\frac{h}{2}(1 + \\cos(\\theta))} = \\frac{4\\kappa}{h^2}\\frac{1 - \\cos(\\theta)}{1 + \\cos(\\theta)}\n$$\n最后，我们计算畸变因子 $R(\\theta)$：\n$$\nR(\\theta) = \\frac{\\lambda^{\\mathrm{ri}}(\\theta)}{\\lambda^{\\mathrm{ex}}(\\theta)} = \\frac{\\frac{4\\kappa}{h^2}\\frac{1 - \\cos(\\theta)}{1 + \\cos(\\theta)}}{\\frac{6\\kappa}{h^2}\\frac{1 - \\cos(\\theta)}{2 + \\cos(\\theta)}} = \\frac{4}{6} \\frac{2 + \\cos(\\theta)}{1 + \\cos(\\theta)}\n$$\n化简常数项得到畸变因子的最终表达式：\n$$\nR(\\theta) = \\frac{2}{3} \\frac{2 + \\cos(\\theta)}{1 + \\cos(\\theta)}\n$$\n如题目所要求，该表达式是仅关于 $\\theta$ 的函数，分离出了由质量矩阵中的求积误差引起的谱畸变。对于指定范围 $\\theta \\in (0, \\pi)$，分母 $1+\\cos(\\theta)$ 非零。", "answer": "$$\n\\boxed{\\frac{2(2+\\cos(\\theta))}{3(1+\\cos(\\theta))}}\n$$", "id": "3594966"}, {"introduction": "在求解大规模瞬态地球物理问题时，算法的计算效率与可扩展性与数值精度同等重要。本练习[@problem_id:3594947]要求你构建一个计算性能模型，用于在现代高性能计算架构上定量比较经典时间步进方法与先进的时空并行方法的求解时间。通过这个实践，你将学习如何评估不同数值策略的实际可行性，并理解算法、硬件架构与问题规模之间的复杂相互作用，这是连接数值理论与高性能计算实践的关键一步。", "problem": "考虑计算地球物理学中的抛物线扩散方程，例如，它模拟了脉冲注入下多孔介质中的压力扩散，方程为 $u_t - \\nabla\\cdot(\\kappa\\nabla u)=f$，定义在一个有界空间域上，具有齐次Dirichlet边界条件和给定的初始条件。为简单起见，设空间域为一维，$x\\in[0,L]$，具有恒定的扩散系数 $\\kappa0$ 和一个由时间频率 $\\omega$（单位为弧度/秒）主导的强时变源 $f(x,t)$。从扩散通量 $\\mathbf{q}=-\\kappa\\nabla u$ 的守恒原理和平衡定律 $u_t + \\nabla\\cdot\\mathbf{q}=f$ 出发，推导其弱形式，并指定一个在均匀网格上使用分段线性形函数的协调伽辽金（Galerkin）空间离散化方法。以此为基础，定义并比较两种时间离散化策略：\n\n- 基于单步隐式方法的经典时间步进有限元法（FEM）。\n- 基于在时间板（slabs）上进行连续伽辽金（Galerkin）离散化的时空有限元法（FEM），该方法支持时间维度上的并行化。\n\n您必须设计一个计算效率模型，该模型使用Roofline模型预测在现代高性能计算（HPC）架构上的求解时间，并整合以下基于科学的假设：\n\n- 对于具有 $N$ 个自由度的一维空间网格，由空间FEM离散化产生的刚度矩阵是稀疏的，具有近似三对角结构。假设非零元素数 $\\text{nnz}$ 按 $3N$ 的比例缩放。\n- 用于隐式求解的Krylov迭代（例如，使用适当多重网格预处理的共轭梯度法）具有一个与 $N$ 无关的恒定迭代次数 $I$（由于网格无关的收敛性）。每次迭代主要由稀疏矩阵向量乘积和向量更新主导。为便于计算，假设每次迭代的浮点运算次数按 $2\\cdot \\text{nnz} + 12N$ 缩放，每次迭代移动的字节数按 $8\\cdot(2\\cdot \\text{nnz}+6N)$ 缩放。\n- 每次迭代的Roofline执行时间是计算约束时间 $f_{\\text{iter}}/F_{\\text{peak}}$ 和内存约束时间 $b_{\\text{iter}}/B_{\\text{mem}}$ 的最大值，其中 $f_{\\text{iter}}$ 和 $b_{\\text{iter}}$ 分别是每次迭代的浮点运算次数和移动的字节数，$F_{\\text{peak}}$ 是架构的峰值浮点运算速率（单位为浮点运算次数/秒），$B_{\\text{mem}}$ 是内存带宽（单位为字节/秒）。\n- 强时变源对时间分辨率有要求。为将主导频率 $\\omega$ 解析到指定精度，使用由每周期点数要求 $n_{\\text{ppp}}$ 决定的时间步长 $dt$：$dt = 2\\pi/(\\omega n_{\\text{ppp}})$。对于总模拟时间 $T$，时间步数是 $N_t = \\lceil T/dt \\rceil$。\n\n并行可扩展性假设：\n\n- 空间并行性：对于 $P$ 个总核心，空间并行效率受每核心最小自由度阈值 $N_{\\min}$ 的限制。定义空间并发度为 $C_s=\\min\\{P,\\max(1,\\lfloor N/N_{\\min}\\rfloor)\\}$，并假设在主导迭代成本上，扩展到此限制为止是完美缩放的。\n- 对于经典的时间步进法，时间步是顺序执行的。总求解时间是 $N_t$ 乘以每步时间（迭代时间乘以 $I$ 除以 $C_s$），再加上每步的同步/通信开销 $\\alpha_{\\text{comm}}$（以秒为单位）。\n- 对于时空FEM，假设时间并行并发度为 $C_t=\\min\\{ \\lfloor P/C_s\\rfloor, \\lfloor c_{\\text{time}} N_t \\rfloor \\}$，其中 $c_{\\text{time}}\\in(0,1]$ 衡量了由时间板求解器及其调度所暴露的时间并行工作的比例。有效并发度为 $C_s\\cdot C_t$，受 $P$ 的限制。总求解时间是经典顺序工作量除以 $C_s\\cdot C_t$，再加上一个并行化开销，该开销包括一个同步项 $\\alpha_{\\text{sync}}\\log_2(N_t)$ 和一个减少的通信项 $\\alpha_{\\text{comm}} N_t/C_t$。\n\n实现一个程序，针对下面的测试套件，为每个案例计算经典时间步进FEM的预测总求解时间（以秒为单位）、时空FEM的预测总求解时间（以秒为单位），以及定义为经典时间步进时间与时空时间之比的加速比（无量纲，以小数表示）。将所有报告的时间和加速比四舍五入到六位小数。使用以下固定的架构和算法参数，所有单位保持一致：\n\n- $F_{\\text{peak}} = 1.5\\times 10^{12}$ 浮点运算次数/秒。\n- $B_{\\text{mem}} = 2.0\\times 10^{11}$ 字节/秒。\n- $P = 64$ 个核心。\n- $N_{\\min} = 2000$ 每核心自由度（为获得良好空间扩展性的最小值）。\n- $I = 10$ 每次隐式求解的Krylov迭代次数。\n- $c_{\\text{time}} = 0.5$ 有效时间并行暴露因子。\n- $\\alpha_{\\text{sync}} = 5\\times 10^{-6}$ 秒。\n- $\\alpha_{\\text{comm}} = 1\\times 10^{-6}$ 秒。\n- $n_{\\text{ppp}} = 20$ 每周期点数。\n\n四个案例的测试套件参数（所有量均使用指定单位；角频率 $\\omega$ 单位为弧度/秒，时间 $T$ 单位为秒，空间自由度 $N$ 是空间未知数的数量）：\n\n- 案例1：$N = 10000$, $T = 1.0$, $\\omega = 2\\pi\\cdot 50$, $\\kappa = 1.0$, $L = 1.0$。\n- 案例2：$N = 2048$, $T = 0.5$, $\\omega = 2\\pi\\cdot 500$, $\\kappa = 1.0$, $L = 1.0$。\n- 案例3：$N = 32768$, $T = 0.2$, $\\omega = 2\\pi\\cdot 10$, $\\kappa = 1.0$, $L = 1.0$。\n- 案例4：$N = 64$, $T = 0.1$, $\\omega = 2\\pi\\cdot 1000$, $\\kappa = 1.0$, $L = 1.0$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，条目按 $[\\text{t\\_TM\\_case1},\\text{t\\_ST\\_case1},\\text{speedup\\_case1},\\text{t\\_TM\\_case2},\\text{t\\_ST\\_case2},\\text{speedup\\_case2},\\text{t\\_TM\\_case3},\\text{t\\_ST\\_case3},\\text{speedup\\_case3},\\text{t\\_TM\\_case4},\\text{t\\_ST\\_case4},\\text{speedup\\_case4}]$ 的顺序排列，其中每个数值都四舍五入到六位小数，时间单位为秒。", "solution": "该问题要求制定并实现一个计算性能模型，以比较两种求解抛物线扩散方程的有限元法（FEM）策略：一种是经典的时间步进（TM）方法，另一种是具有时间并行性的时空（ST）方法。该模型基于给定高性能计算（HPC）架构的Roofline方法论。\n\n### 步骤1：提取给定信息\n\n**问题类型：**\n- 抛物线扩散方程：$u_t - \\nabla\\cdot(\\kappa\\nabla u)=f$，在 $x\\in[0,L]$ 上。\n- 齐次Dirichlet边界条件。\n- 恒定扩散系数 $\\kappa > 0$。\n- 时变源 $f(x,t)$，具有主导时间频率 $\\omega$。\n- 空间离散化：在具有 $N$ 个自由度（DoFs）的均匀网格上，使用分段线性函数的协调伽辽金（Galerkin）方法。\n- 时间离散化：经典隐式时间步进与时空连续伽辽金（Galerkin）。\n\n**计算模型参数：**\n- 空间刚度矩阵：稀疏，三对角结构，非零元素数 $\\text{nnz} \\approx 3N$。\n- 隐式求解器：Krylov方法，迭代次数为常数 $I$。\n- 每次Krylov迭代的浮点运算次数：$f_{\\text{iter}} = 2 \\cdot \\text{nnz} + 12N$。\n- 每次Krylov迭代移动的字节数：$b_{\\text{iter}} = 8 \\cdot (2 \\cdot \\text{nnz} + 6N)$。\n- 每次迭代的Roofline时间：$T_{\\text{iter}} = \\max(f_{\\text{iter}}/F_{\\text{peak}}, b_{\\text{iter}}/B_{\\text{mem}})$。\n- 时间分辨率：$dt = 2\\pi / (\\omega n_{\\text{ppp}})$。\n- 时间步数：$N_t = \\lceil T/dt \\rceil$。\n\n**并行可扩展性参数：**\n- 总核心数：$P$。\n- 空间并发度：$C_s=\\min\\{P,\\max(1,\\lfloor N/N_{\\min}\\rfloor)\\}$。\n- 时间并行并发度（用于ST）：$C_t=\\min\\{ \\lfloor P/C_s\\rfloor, \\lfloor c_{\\text{time}} N_t \\rfloor \\}$。\n- TM求解时间：$T_{\\text{TM}} = N_t \\cdot ( (I \\cdot T_{\\text{iter}} / C_s) + \\alpha_{\\text{comm}} )$。\n- ST求解时间：$T_{\\text{ST}} = (N_t \\cdot I \\cdot T_{\\text{iter}}) / (C_s \\cdot C_t) + \\alpha_{\\text{sync}}\\log_2(N_t) + (\\alpha_{\\text{comm}} N_t/C_t)$。\n\n**固定常量：**\n- 峰值浮点运算速率：$F_{\\text{peak}} = 1.5 \\times 10^{12}$ ops/s。\n- 内存带宽：$B_{\\text{mem}} = 2.0 \\times 10^{11}$ bytes/s。\n- 总可用核心数：$P = 64$。\n- 用于空间扩展的每核心最小自由度：$N_{\\min} = 2000$。\n- 每次求解的Krylov迭代次数：$I = 10$。\n- 时间并行暴露因子：$c_{\\text{time}} = 0.5$。\n- 同步开销系数：$\\alpha_{\\text{sync}} = 5 \\times 10^{-6}$ s。\n- 每步通信开销：$\\alpha_{\\text{comm}} = 1 \\times 10^{-6}$ s。\n- 用于时间分辨率的每周期点数：$n_{\\text{ppp}} = 20$。\n\n**测试案例：**\n- 案例1：$N = 10000$, $T = 1.0$, $\\omega = 2\\pi\\cdot 50$, $\\kappa = 1.0$, $L = 1.0$。\n- 案例2：$N = 2048$, $T = 0.5$, $\\omega = 2\\pi\\cdot 500$, $\\kappa = 1.0$, $L = 1.0$。\n- 案例3：$N = 32768$, $T = 0.2$, $\\omega = 2\\pi\\cdot 10$, $\\kappa = 1.0$, $L = 1.0$。\n- 案例4：$N = 64$, $T = 0.1$, $\\omega = 2\\pi\\cdot 1000$, $\\kappa = 1.0$, $L = 1.0$。\n\n### 步骤2：使用提取的给定信息进行验证\n\n根据验证标准对问题进行审查。\n- **科学基础：** 该问题设置在计算地球物理学的背景下，使用了扩散方程这一基本偏微分方程（PDE）。所引用的数值方法（FEM、Krylov求解器）和性能建模工具（Roofline模型）是科学计算和高性能计算（HPC）中的标准和成熟方法。\n- **适定性：** 问题提供了一套完整的显式公式和输入参数。对于每个测试案例，输入通过一系列确定的计算唯一地决定了所需的输出。\n- **客观性：** 问题陈述是定量的，并使用精确的技术语言。它不包含主观论断。\n- **完整性与一致性：** 指定性能模型所需的所有参数（$F_{\\text{peak}}, B_{\\text{mem}}, P, N_{\\min}, I, c_{\\text{time}}, \\alpha_{\\text{sync}}, \\alpha_{\\text{comm}}, n_{\\text{ppp}}$）均已提供。测试案例供给了必要的输入（$N, T, \\omega$）。物理参数 $\\kappa$ 和 $L$ 虽然是物理问题的一部分，但不是给定的抽象性能模型的输入。这是性能建模中一种常见且有效的简化，其中重点是作为问题规模（$N, N_t$）函数的计算成本，而不是物理特性。模型假设Krylov迭代次数 $I$ 为常数，这是一个明确的指令，它抽象掉了对 $\\kappa$ 的依赖。因此，问题是自洽的，没有欠定。提供的公式或数据中没有矛盾。\n- **其他缺陷：** 该问题并非微不足道、隐喻性或不适定的。它是一个定义明确的计算练习，需要仔细实现一个多步骤模型。\n\n### 步骤3：结论与行动\n\n该问题是**有效的**。所提供的背景和数据在科学上是合理的、一致的，并且足以进行求解。\n\n### 基于原则的解决方案设计\n\n解决方案涉及系统地应用所提供的性能模型。为清晰和正确起见，计算被分解为模块化的步骤。\n\n**1. 给定案例的通用参数**\n对于由（$N, T, \\omega$）定义的每个测试案例，我们首先计算TM和ST模型共有的参数。\n\n- **时间离散化：** 所需的时间步长 $dt$ 由使用 $n_{\\text{ppp}}$ 个点解析每个周期的主导时间频率 $\\omega$ 的需求决定。周期为 $2\\pi/\\omega$。\n$$dt = \\frac{2\\pi}{\\omega \\cdot n_{\\text{ppp}}}$$\n对于持续时间为 $T$ 的模拟，总时间步数 $N_t$ 为：\n$$N_t = \\lceil \\frac{T}{dt} \\rceil$$\n\n- **每次迭代的成本（Roofline模型）：** 单次Krylov迭代的成本由工作负载和机器能力决定。\n    - 稀疏矩阵中的非零项数量为 $\\text{nnz} = 3N$。\n    - 每次迭代的浮点运算次数：$f_{\\text{iter}} = 2 \\cdot \\text{nnz} + 12N = 2(3N) + 12N = 18N$。\n    - 每次迭代移动的字节数：$b_{\\text{iter}} = 8 \\cdot (2 \\cdot \\text{nnz} + 6N) = 8 \\cdot (2(3N) + 6N) = 8(12N) = 96N$。\n    - 根据Roofline模型，一次迭代的执行时间 $T_{\\text{iter}}$ 受计算吞吐量或内存带宽的限制：\n    $$T_{\\text{iter}} = \\max\\left(\\frac{f_{\\text{iter}}}{F_{\\text{peak}}}, \\frac{b_{\\text{iter}}}{B_{\\text{mem}}}\\right) = \\max\\left(\\frac{18N}{F_{\\text{peak}}}, \\frac{96N}{B_{\\text{mem}}}\\right)$$\n\n- **单时间步求解成本：** 一个隐式时间步需要求解一个线性系统。通过 $I$ 次Krylov迭代，执行此求解的顺序时间 $T_{\\text{solve}}$ 是：\n$$T_{\\text{solve}} = I \\cdot T_{\\text{iter}}$$\n\n**2. 经典时间步进（TM）FEM的求解时间**\n经典的TM方法并行化空间维度，但顺序执行时间步。\n\n- **空间并发度（$C_s$）：** 用于空间并行化的核心数受总核心数 $P$ 和相对于每核心最小所需自由度 $N_{\\min}$ 的问题大小的限制。\n$$C_s = \\min\\{P, \\max(1, \\lfloor N/N_{\\min} \\rfloor)\\}$$\n$\\max(1, \\cdot)$ 确保至少分配一个核心。\n\n- **总时间（$T_{\\text{TM}}$）：** 总时间是步数 $N_t$ 乘以每步的时间。每步的时间是并行化的计算工作（$T_{\\text{solve}}/C_s$）加上通信开销 $\\alpha_{\\text{comm}}$。\n$$T_{\\text{TM}} = N_t \\left( \\frac{T_{\\text{solve}}}{C_s} + \\alpha_{\\text{comm}} \\right)$$\n\n**3. 时空（ST）FEM的求解时间**\nST方法在时间维度上增加了第二级并行。\n\n- **空间并发度（$C_s$）：** 此计算方式与TM案例完全相同。\n- **时间并发度（$C_t$）：** 时间并行组的数量受空间分布后剩余的核心数（$\\lfloor P/C_s \\rfloor$）和时间维度上可用的并行工作量（由 $\\lfloor c_{\\text{time}} N_t \\rfloor$ 建模）的限制。\n$$C_t = \\min\\{ \\lfloor P/C_s \\rfloor, \\lfloor c_{\\text{time}} N_t \\rfloor \\}$$\n为避免问题，如果计算结果 $C_t=0$，则应将其视为 $C_t=1$，因为没有时间并行，但计算仍必须继续。该公式确保 $P/C_s \\ge 1$，因此除非 $c_{\\text{time}}N_t  1$，否则 $C_t$ 至少为 $\\min\\{1, \\dots\\}$。我们将确保 $C_t \\ge 1$。\n\n- **总时间（$T_{\\text{ST}}$）：** 总计算工作量 $W_{\\text{total}} = N_t \\cdot T_{\\text{solve}}$ 分布在有效并发度 $C_{\\text{eff}} = C_s \\cdot C_t$ 上。为这种更复杂的并行化方案增加了开销。\n$$T_{\\text{ST}} = \\frac{N_t \\cdot T_{\\text{solve}}}{C_s \\cdot C_t} + \\alpha_{\\text{sync}}\\log_2(N_t) + \\frac{\\alpha_{\\text{comm}} N_t}{C_t}$$\n如果 $N_t \\le 1$，则 $\\log_2(N_t)$ 项取为 $0$。\n\n**4. 加速比**\n加速比是基线方法（TM）的执行时间与增强方法（ST）的执行时间之比。\n$$\\text{Speedup} = \\frac{T_{\\text{TM}}}{T_{\\text{ST}}}$$\n\n对每个测试案例实施这些公式，以计算所需的指标。", "answer": "[0.000188,0.000078,2.417242,0.000940,0.000216,4.354157,0.000049,0.000030,1.642953,0.000957,0.000244,3.921389]", "id": "3594947"}]}