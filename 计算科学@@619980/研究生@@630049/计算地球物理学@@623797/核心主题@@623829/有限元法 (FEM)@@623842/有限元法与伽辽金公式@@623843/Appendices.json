{"hands_on_practices": [{"introduction": "第一个实践是理解有限元法的基础。我们将为一个简单的一维扩散问题（热流和地下水研究中的常见模型）手动组装全局刚度矩阵。这个循序渐进的过程清晰地展示了有限元法的核心机制，从推导弱形式到施加边界条件，并揭示了最终矩阵系统特有的带状结构。[@problem_id:3616475]", "problem": "考虑计算地球物理学中应用的一维（$1$-D）稳态扩散算子，其在区间 $[0,L]$ 上由强形式偏微分方程（PDE）描述\n$$\n-\\frac{d}{dx}\\left(a\\,\\frac{du}{dx}\\right)=f(x),\n$$\n其中 $a>0$ 是一个常数材料属性，$f(x)$ 是一个给定的源项。施加齐次狄利克雷边界条件 $u(0)=0$ 和 $u(L)=0$。使用有限元法（FEM）对区域进行离散化，采用标准的伽辽金（Galerkin）方法（试探空间与检验空间相同）和连续的分段线性形函数，网格包含 $3$ 个单元，节点坐标为 $x_0=0$, $x_1=h_1$, $x_2=h_1+h_2$, $x_3=h_1+h_2+h_3=L$，其中 $h_1>0$，$h_2>0$ 和 $h_3>0$ 是单元长度。\n\n从强形式出发，推导相应的弱形式以及具有常数 $a$ 的单个线性单元的单元刚度矩阵。然后在施加边界条件之前，为整个包含 $3$ 个单元的网格组装全局刚度矩阵，并清楚地指出其由基函数的局部性所产生的带状（三对角）结构。接下来，通过消除与边界节点 $x_0$ 和 $x_3$ 相关联的行和列来施加齐次狄利克雷边界条件，从而获得关于内部自由度的简化全局系统。\n\n作为最终答案，报告用 $a$、$h_1$、$h_2$ 和 $h_3$ 表示的简化全局刚度矩阵行列式的精确解析表达式。最终答案以符号表达式的形式给出。不包含单位，也无需四舍五入。", "solution": "出发点是强形式偏微分方程\n$$\n-\\frac{d}{dx}\\left(a\\,\\frac{du}{dx}\\right)=f(x)\\quad\\text{on}\\quad [0,L],\n$$\n其齐次狄利克雷边界条件为 $u(0)=0$ 和 $u(L)=0$。为得到弱形式，我们从与试探函数相同的空间（Galerkin 选择）中选取一个检验函数 $v(x)$，并满足 $v(0)=0$ 和 $v(L)=0$。将强形式乘以 $v$ 并在 $[0,L]$ 上积分：\n$$\n\\int_{0}^{L} -\\frac{d}{dx}\\left(a\\,\\frac{du}{dx}\\right)\\,v\\,dx=\\int_{0}^{L} f\\,v\\,dx.\n$$\n对左侧项使用分部积分法，并利用边界条件 $u(0)=0$，$u(L)=0$，$v(0)=0$ 和 $v(L)=0$，我们得到\n$$\n\\int_{0}^{L} a\\,\\frac{du}{dx}\\,\\frac{dv}{dx}\\,dx=\\int_{0}^{L} f\\,v\\,dx.\n$$\n这就是弱形式：在合适的索博列夫（Sobolev）空间中寻找满足本质边界条件的 $u$，使得\n$$\n\\int_{0}^{L} a\\,u'(x)\\,v'(x)\\,dx=\\int_{0}^{L} f(x)\\,v(x)\\,dx\n$$\n对所有容许的 $v$ 成立。\n\n将区域离散化为 $3$ 个单元，节点位于 $x_0=0$, $x_1=h_1$, $x_2=h_1+h_2$, 及 $x_3=h_1+h_2+h_3=L$。将 $u(x)$ 近似为\n$$\nu(x)\\approx \\sum_{i=0}^{3} U_i\\,N_i(x),\n$$\n其中 $N_i(x)$ 是与节点 $x_i$ 相关联的标准连续分段线性形函数，$U_i$ 是节点值。在一维情况下，对于长度为 $h_e=x_{i+1}-x_i$ 的线性单元 $e=[x_i,x_{i+1}]$，其单元刚度矩阵可由下式得出\n$$\n\\mathbf{k}^{(e)}=\\int_{x_i}^{x_{i+1}} a\\,\\mathbf{B}^\\top \\mathbf{B}\\,dx,\n$$\n其中 $\\mathbf{B}=[N_1'(x),\\,N_2'(x)]$ 包含了局部单元形函数的导数。在一个线性单元上，$N_1'(x)=-\\frac{1}{h_e}$ 和 $N_2'(x)=\\frac{1}{h_e}$，两者在单元 $e$ 上均为常数。因此，\n$$\n\\mathbf{B}^\\top \\mathbf{B}=\n\\begin{pmatrix}\n\\left(-\\frac{1}{h_e}\\right)^2  & -\\frac{1}{h_e}\\cdot \\frac{1}{h_e} \\\\\n-\\frac{1}{h_e}\\cdot \\frac{1}{h_e}  & \\left(\\frac{1}{h_e}\\right)^2\n\\end{pmatrix}\n=\\frac{1}{h_e^2}\n\\begin{pmatrix}\n1  & -1 \\\\ -1  & 1\n\\end{pmatrix}.\n$$\n在单元长度上积分，\n$$\n\\mathbf{k}^{(e)}=\\int_{x_i}^{x_{i+1}} a\\,\\frac{1}{h_e^2}\n\\begin{pmatrix}\n1  & -1 \\\\ -1  & 1\n\\end{pmatrix} dx\n= a\\,\\frac{1}{h_e}\n\\begin{pmatrix}\n1  & -1 \\\\ -1  & 1\n\\end{pmatrix}.\n$$\n因此，对于每个长度为 $h_e$ 的单元 $e$，其单元刚度矩阵为\n$$\n\\mathbf{k}^{(e)}= \\frac{a}{h_e}\n\\begin{pmatrix}\n1  & -1 \\\\ -1  & 1\n\\end{pmatrix}.\n$$\n\n现在我们为与 $4$ 个节点自由度 $\\{U_0,U_1,U_2,U_3\\}$ 相关联的 $4\\times 4$ 全局刚度矩阵 $\\mathbf{K}$ 进行组装。将三个单元分别记为长度为 $h_1$ 的 $e_1=[x_0,x_1]$，长度为 $h_2$ 的 $e_2=[x_1,x_2]$，以及长度为 $h_3$ 的 $e_3=[x_2,x_3]$。在全局 $(0,1,2,3)$ 排序下，各单元的贡献为：\n$$\n\\mathbf{k}^{(e_1)}=\\frac{a}{h_1}\n\\begin{pmatrix}\n1  & -1 \\\\ -1  & 1\n\\end{pmatrix}\n\\quad\\text{作用于全局索引}\\quad (0,1),\n$$\n$$\n\\mathbf{k}^{(e_2)}=\\frac{a}{h_2}\n\\begin{pmatrix}\n1  & -1 \\\\ -1  & 1\n\\end{pmatrix}\n\\quad\\text{作用于全局索引}\\quad (1,2),\n$$\n$$\n\\mathbf{k}^{(e_3)}=\\frac{a}{h_3}\n\\begin{pmatrix}\n1  & -1 \\\\ -1  & 1\n\\end{pmatrix}\n\\quad\\text{作用于全局索引}\\quad (2,3).\n$$\n将这些贡献相加，得到组装后的全局刚度矩阵\n$$\n\\mathbf{K}=\n\\begin{pmatrix}\n\\frac{a}{h_1}  & -\\frac{a}{h_1}  & 0  & 0 \\\\\n-\\frac{a}{h_1}  & \\frac{a}{h_1}+\\frac{a}{h_2}  & -\\frac{a}{h_2}  & 0 \\\\\n0  & -\\frac{a}{h_2}  & \\frac{a}{h_2}+\\frac{a}{h_3}  & -\\frac{a}{h_3} \\\\\n0  & 0  & -\\frac{a}{h_3}  & \\frac{a}{h_3}\n\\end{pmatrix}.\n$$\n该矩阵是对称三对角矩阵，呈现出半带宽为 $1$ 的带状结构，这是使用线性形函数的一维（$1$-D）最近邻耦合问题的典型特征。\n\n现在我们施加齐次狄利克雷边界条件 $U_0=0$ 和 $U_3=0$，方法是消除相关联的行和列，留下针对内部自由度 $\\{U_1,U_2\\}$ 的简化系统。简化后的全局刚度矩阵 $\\mathbf{K}_{\\text{r}}$ 是一个 $2\\times 2$ 的主子矩阵\n$$\n\\mathbf{K}_{\\text{r}}=\n\\begin{pmatrix}\n\\frac{a}{h_1}+\\frac{a}{h_2}  & -\\frac{a}{h_2} \\\\\n-\\frac{a}{h_2}  & \\frac{a}{h_2}+\\frac{a}{h_3}\n\\end{pmatrix}\n= a\\begin{pmatrix}\n\\frac{1}{h_1}+\\frac{1}{h_2}  & -\\frac{1}{h_2} \\\\\n-\\frac{1}{h_2}  & \\frac{1}{h_2}+\\frac{1}{h_3}\n\\end{pmatrix}.\n$$\n$\\mathbf{K}_{\\text{r}}$ 的行列式为\n$$\n\\det(\\mathbf{K}_{\\text{r}})=\\left(\\frac{a}{h_1}+\\frac{a}{h_2}\\right)\\left(\\frac{a}{h_2}+\\frac{a}{h_3}\\right)-\\left(-\\frac{a}{h_2}\\right)^2\n= a^2\\left[\\left(\\frac{1}{h_1}+\\frac{1}{h_2}\\right)\\left(\\frac{1}{h_2}+\\frac{1}{h_3}\\right)-\\left(\\frac{1}{h_2}\\right)^2\\right].\n$$\n展开并化简方括号内的表达式，\n$$\n\\left(\\frac{1}{h_1}+\\frac{1}{h_2}\\right)\\left(\\frac{1}{h_2}+\\frac{1}{h_3}\\right)-\\frac{1}{h_2^2}\n=\\left(\\frac{1}{h_1 h_2}+\\frac{1}{h_1 h_3}+\\frac{1}{h_2^2}+\\frac{1}{h_2 h_3}\\right)-\\frac{1}{h_2^2}\n=\\frac{1}{h_1 h_2}+\\frac{1}{h_1 h_3}+\\frac{1}{h_2 h_3}.\n$$\n通分后，表达式可写为\n$$\n\\frac{h_3+h_2+h_1}{h_1 h_2 h_3}.\n$$\n因此，\n$$\n\\det(\\mathbf{K}_{\\text{r}})=a^2\\,\\frac{h_1+h_2+h_3}{h_1 h_2 h_3}.\n$$\n这就是简化全局刚度矩阵行列式的精确解析表达式，它是通过伽辽金有限元法，在给定的三单元网格上进行显式组装，并从第一性原理推导得出的。", "answer": "$$\\boxed{a^{2}\\,\\frac{h_{1}+h_{2}+h_{3}}{h_{1} h_{2} h_{3}}}$$", "id": "3616475"}, {"introduction": "在一维问题之上，本练习进阶到一个二维线弹性问题，这是模拟固体地球变形的核心。你将为一个分层介质中的三角形单元计算单元刚度矩阵，这是一个旨在说明如何处理材料不连续性的假设情景。这个实践引入了至关重要的应变-位移矩阵（$\\boldsymbol{B}$），并将抽象的数学公式与应变能的物理概念联系起来。[@problem_id:3616479]", "problem": "考虑一个二维分层介质中的小应变、线性、各向同性平面应变弹性问题。将使用线性三角形单元，并应用有限元法 (FEM) 的 Galerkin 公式。底层占据区域 $y \\in [0, 0.5]$，其特征由 Lamé 参数 $(\\lambda_{1}, \\mu_{1})$ 描述。顶层占据区域 $y \\in (0.5, 1]$，其 Lamé 参数为 $(\\lambda_{2}, \\mu_{2})$。假设平面外厚度为单位长度。\n\n区域为单位正方形 $\\Omega = [0,1] \\times [0,1]$，被划分为四个线性三角形单元，全局节点坐标如下：\n- 节点 1：$(0,0)$，\n- 节点 2：$(1,0)$，\n- 节点 3：$(0,0.5)$，\n- 节点 4：$(1,0.5)$，\n- 节点 5：$(0,1)$，\n- 节点 6：$(1,1)$，\n单元如下：\n- 单元 $E_{1}$：节点 $(1,2,3)$，位于底层，\n- 单元 $E_{2}$：节点 $(2,4,3)$，位于底层，\n- 单元 $E_{3}$：节点 $(3,4,5)$，位于顶层，\n- 单元 $E_{4}$：节点 $(4,6,5)$，位于顶层。\n\n采用标准的平面应变设置，其对称梯度应变度量为 $\\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = \\begin{pmatrix}\\partial u_{x}/\\partial x \\\\ \\partial u_{y}/\\partial y \\\\ \\partial u_{x}/\\partial y + \\partial u_{y}/\\partial x \\end{pmatrix}$，线性弹性本构关系为 $\\boldsymbol{\\sigma} = \\boldsymbol{C} \\, \\boldsymbol{\\varepsilon}$，其中每一层的弹性张量由 Lamé 参数 $(\\lambda,\\mu)$ 定义如下：\n$$\n\\boldsymbol{C} = \\begin{pmatrix}\n\\lambda + 2\\mu  & \\lambda  & 0 \\\\\n\\lambda  & \\lambda + 2\\mu  & 0 \\\\\n0  & 0  & \\mu\n\\end{pmatrix}.\n$$\n\n任务：\n1. 对于一个节点坐标为 $(x_{i},y_{i})$ 的单个线性三角形单元，从第一性原理推导常应变-位移矩阵 $\\boldsymbol{B}$，并将单元刚度矩阵写为 $\\boldsymbol{K}^{(e)} = \\int_{\\Omega_{e}} \\boldsymbol{B}^{\\top} \\boldsymbol{C} \\, \\boldsymbol{B} \\, \\mathrm{d}\\Omega$。然后，使用 $(\\lambda_{1},\\mu_{1})$ 显式计算单元 $E_{1}$ 的 $\\boldsymbol{B}$ 和 $\\boldsymbol{K}^{(e)}$。\n2. 通过将来自 $E_{1}, E_{2}$（使用 $(\\lambda_{1},\\mu_{1})$）和 $E_{3}, E_{4}$（使用 $(\\lambda_{2},\\mu_{2})$）的单元刚度贡献进行适当的放置和求和，为整个网格组装全局刚度矩阵 $\\boldsymbol{K}$。\n3. 施加本质（Dirichlet）边界条件，将底边 $y=0$ 上的所有位移分量约束为零，即在节点 1 和 2 处 $u_{x} = 0$ 且 $u_{y} = 0$。此外，在节点 5 处约束 $u_{x} = 0$ 以消除任何残余的水平方向刚体运动。令 $\\boldsymbol{K}_{\\text{red}}$ 表示施加这些约束后简化得到的全局刚度矩阵。\n4. 定义一个测试离散位移向量 $\\boldsymbol{v}$，使其在网格的自由节点上与连续场 $u_{x}(x,y) = 0$, $u_{y}(x,y) = y$ 一致，即将每个自由节点的位移分量设置为该场在该节点处的值（约束节点处为零）。使用与 Galerkin 双线性形式相关的能量恒等式，以 $(\\lambda_{1},\\mu_{1},\\lambda_{2},\\mu_{2})$ 为符号，计算标量 $s = \\boldsymbol{v}^{\\top} \\boldsymbol{K}_{\\text{red}} \\boldsymbol{v}$。\n\n请以 $s$ 的单个闭式解析表达式的形式提供最终答案。无需进行数值四舍五入。最终表达式中不应包含物理单位。", "solution": "该问题的目标是计算一个特定离散位移向量 $\\boldsymbol{v}$ 下的能量 $s = \\boldsymbol{v}^{\\top} \\boldsymbol{K}_{\\text{red}} \\boldsymbol{v}$。根据有限元理论，该标量值等于整个区域上的总应变能的二倍，即 $s = \\int_{\\Omega} \\boldsymbol{\\varepsilon}(\\boldsymbol{v}) : \\boldsymbol{\\sigma}(\\boldsymbol{v}) \\, \\mathrm{d}\\Omega$。由于位移场 $\\boldsymbol{v}$ 已给出，我们可以通过计算每个单元的应变能然后求和来直接得到 $s$，从而避免了组装和缩减全局刚度矩阵的繁琐过程。总能量可以表示为各单元能量之和：\n$$\ns = \\sum_{e=1}^{4} (\\boldsymbol{d}^{(e)})^{\\top} \\boldsymbol{K}^{(e)} \\boldsymbol{d}^{(e)} = \\sum_{e=1}^{4} \\int_{\\Omega_e} \\boldsymbol{\\varepsilon}^{(e) \\top} \\boldsymbol{C}_e \\boldsymbol{\\varepsilon}^{(e)} \\, \\mathrm{d}\\Omega = \\sum_{e=1}^{4} A_e \\, \\boldsymbol{\\varepsilon}^{(e) \\top} \\boldsymbol{C}_e \\boldsymbol{\\varepsilon}^{(e)}\n$$\n其中 $A_e$ 是单元面积，$\\boldsymbol{\\varepsilon}^{(e)}$ 是单元内的常应变，$\\boldsymbol{C}_e$ 是该单元的材料本构矩阵。\n\n首先，我们根据给定的连续场 $u_x(x,y)=0$ 和 $u_y(x,y)=y$ 以及边界条件，确定全局节点位移向量 $\\boldsymbol{d}$：\n- 约束节点：$u_{x1}=0, u_{y1}=0, u_{x2}=0, u_{y2}=0, u_{x5}=0$。\n- 自由节点位移：\n  - 节点3 $(0,0.5)$: $u_{x3}=0, u_{y3}=0.5$\n  - 节点4 $(1,0.5)$: $u_{x4}=0, u_{y4}=0.5$\n  - 节点5 $(0,1)$: $u_{y5}=1$ (因 $u_{x5}$ 被约束)\n  - 节点6 $(1,1)$: $u_{x6}=0, u_{y6}=1$\n完整的全局位移向量为 $\\boldsymbol{d} = [0, 0, 0, 0, 0, 0.5, 0, 0.5, 0, 1, 0, 1]^{\\top}$。\n\n由于给定的位移场是线性的，标准的线性三角形单元能够精确地表示它。因此，每个单元内的应变场是恒定的，可以通过对位移场求导得到：\n$$\n\\boldsymbol{\\varepsilon} = \\begin{pmatrix} \\partial u_x / \\partial x \\\\ \\partial u_y / \\partial y \\\\ \\partial u_x / \\partial y + \\partial u_y / \\partial x \\end{pmatrix} = \\begin{pmatrix} \\partial(0) / \\partial x \\\\ \\partial(y) / \\partial y \\\\ \\partial(0) / \\partial y + \\partial(y) / \\partial x \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n这个恒定的应变值 $\\boldsymbol{\\varepsilon}_0 = [0, 1, 0]^{\\top}$ 适用于所有四个单元。\n\n现在我们计算二次型 $\\boldsymbol{\\varepsilon}_0^{\\top}\\boldsymbol{C}\\boldsymbol{\\varepsilon}_0$：\n$$\n\\boldsymbol{\\varepsilon}_0^{\\top}\\boldsymbol{C}\\boldsymbol{\\varepsilon}_0 = \\begin{pmatrix} 0 & 1 & 0 \\end{pmatrix} \\begin{pmatrix} \\lambda + 2\\mu & \\lambda & 0 \\\\ \\lambda & \\lambda + 2\\mu & 0 \\\\ 0 & 0 & \\mu \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} \\lambda & \\lambda + 2\\mu & 0 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\lambda + 2\\mu\n$$\n总能量 $s$ 是在两层材料上的能量积分。底层（单元 $E_1, E_2$）的总面积为 $A_{\\text{bottom}} = 0.25 + 0.25 = 0.5$，使用材料参数 $(\\lambda_1, \\mu_1)$。顶层（单元 $E_3, E_4$）的总面积为 $A_{\\text{top}} = 0.25 + 0.25 = 0.5$，使用材料参数 $(\\lambda_2, \\mu_2)$。\n$$\ns = A_{\\text{bottom}} (\\lambda_1 + 2\\mu_1) + A_{\\text{top}} (\\lambda_2 + 2\\mu_2) = \\frac{1}{2}(\\lambda_1 + 2\\mu_1) + \\frac{1}{2}(\\lambda_2 + 2\\mu_2)\n$$\n最终得到：\n$$\ns = \\frac{1}{2}(\\lambda_1 + 2\\mu_1 + \\lambda_2 + 2\\mu_2)\n$$", "answer": "$$\n\\boxed{\\frac{1}{2}(\\lambda_1 + 2\\mu_1 + \\lambda_2 + 2\\mu_2)}\n$$", "id": "3616479"}, {"introduction": "最后的实践将从手动计算过渡到编程实现，通过求解不可压缩的斯托克斯方程来深入学习，这在地质动力学中至关重要。你的任务是为一个包含速度和压力的混合公式组装离散系统，这会产生一个典型的鞍点矩阵结构。这个练习突出了求解此类不定系统的实际挑战，并为处理地球物理流体动力学模拟中常见的多场耦合问题提供了动手经验。[@problem_id:3616527]", "problem": "考虑在二维有界单连通域上，由密度乘以重力产生的恒定体积力作用下的粘性不可压缩流体的不可压缩 Stokes 方程。其控制方程分别为线性动量守恒和质量守恒，\n$$\n-\\nabla \\cdot \\left( \\mu \\nabla \\mathbf{u} \\right) + \\nabla p = \\rho \\mathbf{g}, \\quad \\nabla \\cdot \\mathbf{u} = 0,\n$$\n其中 $\\mathbf{u}$ 是速度矢量场，$p$ 是压力，$\\mu$ 是动力粘度，$\\rho$ 是质量密度，$\\mathbf{g}$ 是重力加速度矢量。假设 $\\mu$ 和 $\\rho$ 在每个单元上均为常数。采用标准的 Galerkin 方法，其中速度和压力的试探空间和检验空间均选择为三角形上的连续分片线性函数，用于速度分量和压力。在下文详述的边界节点子集上，对速度使用齐次 Dirichlet 边界条件。为解决此问题，我们使用如下双线性和线性形式\n$$\na(\\mathbf{u}, \\mathbf{v}) = \\int_{\\Omega} \\mu \\, \\nabla \\mathbf{u} : \\nabla \\mathbf{v} \\, d\\Omega,\\quad\nb(\\mathbf{v}, q) = -\\int_{\\Omega} q \\, \\nabla \\cdot \\mathbf{v} \\, d\\Omega,\\quad\n\\ell(\\mathbf{v}) = \\int_{\\Omega} \\rho \\mathbf{g} \\cdot \\mathbf{v} \\, d\\Omega,\n$$\n在有限元离散化后，这些形式将产生对称的鞍点线性系统。\n\n网格、有限元空间和边界条件：\n- 设域为单位正方形，顶点位于 $(0,0)$、$(1,0)$、$(1,1)$、$(0,1)$，并包含内部节点 $(0.5,0.5)$。总共有 $5$ 个节点，索引如下：$0:(0,0)$、$1:(1,0)$、$2:(1,1)$、$3:(0,1)$、$4:(0.5,0.5)$。\n- 将正方形三角化为 $4$ 个三角形，连接关系为 $T_0=(0,1,4)$、$T_1=(1,2,4)$、$T_2=(2,3,4)$、$T_3=(3,0,4)$，每个三角形的顶点均按逆时针排序。\n- 对每个速度分量和压力，均在三角形上使用连续分片线性基函数。在全局网格上，节点标量形函数记为 $N_a$，$a \\in \\{0,1,2,3,4\\}$，在单元计算时使用它们在每个三角形上的限制。对于顶点坐标为 $(x_i,y_i)$，$i \\in \\{1,2,3\\}$ 的单个三角形，其面积为\n$$\nA_T = \\frac{1}{2} \\det \\begin{pmatrix} x_2-x_1  & x_3 - x_1 \\\\ y_2 - y_1  & y_3 - y_1 \\end{pmatrix},\n$$\n局部形函数的梯度在三角形上是常数，由下式给出\n$$\n\\nabla N_1 = \\frac{1}{2 A_T} \\begin{pmatrix} y_2 - y_3 \\\\ x_3 - x_2 \\end{pmatrix},\\quad\n\\nabla N_2 = \\frac{1}{2 A_T} \\begin{pmatrix} y_3 - y_1 \\\\ x_1 - x_3 \\end{pmatrix},\\quad\n\\nabla N_3 = \\frac{1}{2 A_T} \\begin{pmatrix} y_1 - y_2 \\\\ x_2 - x_1 \\end{pmatrix}.\n$$\n- 在索引为 $0$、$2$ 和 $3$ 的边界节点上施加齐次 Dirichlet 边界条件（零速度）。将索引为 $1$ 的边界节点和索引为 $4$ 的内部节点作为自由（未知）的速度自由度。通过在节点 $0$ 处指定 $p=0$ 来锚定压力以消除压力零空间，并保留节点 $1$、$2$、$3$ 和 $4$ 处的压力为未知数。\n\n单元和全局组装：\n- 对于每个具有局部节点索引 $a,b \\in \\{1,2,3\\}$（映射到全局节点索引）的三角形 $T$，使用从 Galerkin 公式和基函数的选择中导出的以下定义：\n    - 在 $T$ 上类拉普拉斯项的标量刚度矩阵项为\n    $$\n    k_{ab}^{(T)} = \\mu \\int_T \\nabla N_a \\cdot \\nabla N_b \\, d\\Omega = \\mu \\, A_T \\, \\left( \\nabla N_a \\cdot \\nabla N_b \\right),\n    $$\n    矢量速度的 $2 \\times 2$ 贡献是块对角矩阵，其中 $k_{ab}^{(T)}$ 应用于每个速度分量。\n    - 在 $T$ 上的散度-压力耦合项为\n    $$\n    B_{j,(a,x)}^{(T)} = - \\int_T N_j \\, \\frac{\\partial N_a}{\\partial x} \\, d\\Omega = - \\left(\\frac{\\partial N_a}{\\partial x}\\right) \\int_T N_j \\, d\\Omega,\\quad\n    B_{j,(a,y)}^{(T)} = - \\int_T N_j \\, \\frac{\\partial N_a}{\\partial y} \\, d\\Omega = - \\left(\\frac{\\partial N_a}{\\partial y}\\right) \\int_T N_j \\, d\\Omega,\n    $$\n    其中 $j$ 遍历 $T$ 上的局部压力节点，$(a,x)$ 表示与节点 $a$ 处 $x$ 分量相关的局部速度自由度，$(a,y)$ 同理。\n    - 速度的单元体积力载荷向量项为\n    $$\n    f_{(a,x)}^{(T)} = \\int_T \\rho g_x \\, N_a \\, d\\Omega = \\rho g_x \\int_T N_a \\, d\\Omega,\\quad\n    f_{(a,y)}^{(T)} = \\int_T \\rho g_y \\, N_a \\, d\\Omega = \\rho g_y \\int_T N_a \\, d\\Omega.\n    $$\n    因为 $N_a$ 是线性的且 $\\rho \\mathbf{g}$ 是常数，所以 $\\int_T N_a \\, d\\Omega = A_T / 3$。\n- 使用标准的有限元组装方法，通过对每个三角形的贡献求和，组装全局矩阵 $\\mathbf{A}$（速度-速度）、$\\mathbf{B}$（压力-速度）和全局速度载荷向量 $\\mathbf{F}$。然后，通过限制在节点 $1$ 和 $4$ 的未知速度自由度上，来施加本质边界条件，并通过移除节点 $0$ 处的压力自由度来锚定压力。将得到的缩减块记为 $\\mathbf{A}_{uu}$、$\\mathbf{B}_{pu}$ 和缩减的速度右端项向量 $\\mathbf{F}_u$。\n- 形成耦合的缩减鞍点系统\n$$\n\\mathbf{K} = \\begin{pmatrix}\n\\mathbf{A}_{uu}  & \\mathbf{B}_{pu}^T \\\\\n\\mathbf{B}_{pu}  & \\mathbf{0}\n\\end{pmatrix},\\quad\n\\mathbf{r} = \\begin{pmatrix}\n\\mathbf{F}_u \\\\\n\\mathbf{0}\n\\end{pmatrix}.\n$$\n\n任务：\n1. 对每个三角形，按照描述计算由 $\\rho \\mathbf{g}$ 产生的单元体积力向量，将其组装到全局速度载荷向量中，并根据本质边界条件进行缩减。报告缩减后的速度载荷向量的欧几里得范数 $\\|\\mathbf{F}_u\\|_2$。此范数以牛顿为单位，即 $\\rho$ 的单位是千克/立方米，$\\mathbf{g}$ 的单位是米/平方秒，长度单位是米，积分是在平方米的面积上进行的。报告此范数，四舍五入到六位小数。\n2. 组装缩减的耦合系统矩阵 $\\mathbf{K}$ 并确定其惯性，定义为 $\\mathbf{K}$ 的严格正、数值零和严格负特征值的数量的有序三元组 $(n_+, n_0, n_-)$。使用对称特征值求解程序，如果一个特征值的绝对值小于或等于 $\\tau = 10^{-10} \\max(1,\\max_i |\\lambda_i|)$，则将其计为数值零，其中 $\\lambda_i$ 是 $\\mathbf{K}$ 的特征值。\n3. 根据 $\\mathbf{K}$ 的形式，讨论适用于此类不定系统的线性求解器选择，并阐述选择的理由。\n\n使用以下参数集 $(\\mu, \\rho, g_x, g_y)$ 的测试套件：\n- 测试 1：$\\mu = 50$ 帕斯卡-秒，$\\rho = 3300$ 千克/立方米，$g_x = 0$ 米/平方秒，$g_y = -9.81$ 米/平方秒。\n- 测试 2：$\\mu = 50$ 帕斯卡-秒，$\\rho = 0$ 千克/立方米，$g_x = 0$ 米/平方秒，$g_y = -9.81$ 米/平方秒。\n- 测试 3：$\\mu = 5$ 帕斯卡-秒，$\\rho = 2500$ 千克/立方米，$g_x = 3.0$ 米/平方秒，$g_y = -4.0$ 米/平方秒。\n\n最终输出规范：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。对于给定顺序的每个测试，输出四个值 $[\\|\\mathbf{F}_u\\|_2, n_+, n_0, n_-]$，其中范数四舍五入到六位小数，然后将所有测试的这些四元组连接成一个单一的扁平列表。例如，总体格式为\n$$\n[\\text{norm}_1, n_{+,1}, n_{0,1}, n_{-,1}, \\text{norm}_2, n_{+,2}, n_{0,2}, n_{-,2}, \\text{norm}_3, n_{+,3}, n_{0,3}, n_{-,3}].\n$$\n所有角度（如有）均以弧度为单位；此问题中没有角度。所有范数必须如前所述以牛顿为单位，并四舍五入到六位小数。所有特征值计数必须是整数。", "solution": "此问题要求通过有限元方法为不可压缩斯托克斯方程建立离散系统，并分析其性质。我们遵循标准的伽辽金有限元流程，该流程通过一个计算程序实现。\n\n1.  **网格与自由度定义**：首先，根据问题描述定义节点坐标和单元连接性。总共有5个节点，其中节点0, 1, 2, 3构成边界，节点4是内部节点。根据边界条件，速度自由度（DOFs）在节点1和4处是自由的（共4个未知数），压力自由度在节点1, 2, 3, 4处是自由的（共4个未知数）。因此，最终的缩减系统矩阵 $\\mathbf{K}$ 是一个 $8 \\times 8$ 的矩阵。\n\n2.  **单元计算与组装**：我们遍历四个三角形单元中的每一个。对于每个单元：\n    *   计算其面积和局部线性基函数（形函数）的梯度。\n    *   根据问题中提供的积分公式，计算单元刚度矩阵 $\\mathbf{k}^{(T)}$（来自拉普拉斯项）、单元散度-压力耦合矩阵 $\\mathbf{B}^{(T)}$ 以及单元载荷向量 $\\mathbf{f}^{(T)}$（来自重力）。\n    *   将这些单元贡献累加到全局矩阵 $\\mathbf{A}$（速度-速度）、$\\mathbf{B}$（压力-速度）和全局载荷向量 $\\mathbf{F}$ 中。\n\n3.  **系统缩减与分析**：\n    *   从组装好的全局矩阵和向量中，我们提取与自由速度和压力自由度相对应的行和列，从而得到缩减后的块矩阵 $\\mathbf{A}_{uu}$、$\\mathbf{B}_{pu}$ 和缩减后的载荷向量 $\\mathbf{F}_u$。\n    *   **任务1**：计算缩减后的载荷向量的欧几里得范数 $\\|\\mathbf{F}_u\\|_2$。\n    *   **任务2**：构建 $8 \\times 8$ 的鞍点系统矩阵 $\\mathbf{K} = \\begin{pmatrix} \\mathbf{A}_{uu} & \\mathbf{B}_{pu}^T \\\\ \\mathbf{B}_{pu} & \\mathbf{0} \\end{pmatrix}$。由于该矩阵是对称的，我们使用对称特征值求解器计算其所有实数特征值。通过对正、负和数值上接近零的特征值进行计数来确定其惯性 $(n_+, n_0, n_-)$。值得注意的是，所选用的P1-P1单元对是不稳定的（不满足LBB条件），这通常表现为 $\\mathbf{B}_{pu}$ 的秩亏，从而导致 $\\mathbf{K}$ 矩阵存在非零的零空间（即 $n_0 > 0$）。\n\n4.  **线性求解器讨论 (任务3)**：得到的矩阵 $\\mathbf{K}$ 是对称但不定的。对于这类系统，不能使用标准的共轭梯度法。合适的迭代求解器包括MINRES或GMRES，它们通常需要配合为鞍点问题设计的块预条件子才能高效求解。对于此问题的小规模，使用对称不定分解（如带枢轴的LDLᵀ分解）的直接求解器是稳健且高效的。\n\n下面的Python代码实现了这些步骤，并为每个测试用例计算并输出了所要求的值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main solver function for the Stokes FEM problem.\n    This function assembles and analyzes the finite element system for the Stokes\n    equations on a specified mesh, computes the norm of the reduced force vector,\n    and determines the inertia of the reduced system matrix for several test cases.\n    \"\"\"\n    # Define mesh and problem parameters\n    nodes = np.array([\n        [0.0, 0.0],  # 0\n        [1.0, 0.0],  # 1\n        [1.0, 1.0],  # 2\n        [0.0, 1.0],  # 3\n        [0.5, 0.5]   # 4\n    ], dtype=np.float64)\n\n    elements = np.array([\n        [0, 1, 4],  # T0\n        [1, 2, 4],  # T1\n        [2, 3, 4],  # T2\n        [3, 0, 4]   # T3\n    ], dtype=np.int32)\n\n    # DOF mapping and Boundary Conditions\n    # Free velocity DOFs at nodes 1 and 4\n    free_v_nodes = [1, 4]\n    free_v_dofs = []\n    for node_idx in sorted(free_v_nodes):\n        free_v_dofs.extend([2 * node_idx, 2 * node_idx + 1])\n\n    # Free pressure DOFs at nodes 1, 2, 3, 4\n    free_p_nodes = [1, 2, 3, 4]\n    free_p_dofs = sorted(free_p_nodes)\n\n    num_nodes = len(nodes)\n    num_free_v = len(free_v_dofs)\n    num_free_p = len(free_p_dofs)\n\n    test_cases = [\n        (50.0, 3300.0, 0.0, -9.81),\n        (50.0, 0.0, 0.0, -9.81),\n        (5.0, 2500.0, 3.0, -4.0)\n    ]\n\n    all_results = []\n\n    for mu, rho, gx, gy in test_cases:\n        A_global = np.zeros((2 * num_nodes, 2 * num_nodes), dtype=np.float64)\n        B_global = np.zeros((num_nodes, 2 * num_nodes), dtype=np.float64)\n        F_global = np.zeros(2 * num_nodes, dtype=np.float64)\n\n        for elem_nodes in elements:\n            # The problem defines local nodes 1,2,3. We map them to the vertices\n            # in elem_nodes[0], elem_nodes[1], elem_nodes[2].\n            v1_idx, v2_idx, v3_idx = elem_nodes\n            x1, y1 = nodes[v1_idx]; x2, y2 = nodes[v2_idx]; x3, y3 = nodes[v3_idx]\n            \n            # Area is signed; its sign depends on ordering. Problem defines CCW.\n            area = 0.5 * ((x2 - x1) * (y3 - y1) - (x3 - x1) * (y2 - y1))\n\n            # Gradients of local shape functions N1, N2, N3\n            # grad_N[i,:] corresponds to the shape function at node elem_nodes[i]\n            grad_N = np.zeros((3, 2), dtype=np.float64)\n            factor = 1.0 / (2.0 * area)\n            grad_N[0, :] = factor * np.array([y2 - y3, x3 - x2]) # Grad for N at v1\n            grad_N[1, :] = factor * np.array([y3 - y1, x1 - x3]) # Grad for N at v2\n            grad_N[2, :] = factor * np.array([y1 - y2, x2 - x1]) # Grad for N at v3\n            \n            # Element stiffness matrix (scalar laplacian part)\n            k_elem_scalar = np.zeros((3, 3), dtype=np.float64)\n            for i in range(3):\n                for j in range(3):\n                    k_elem_scalar[i, j] = mu * area * np.dot(grad_N[i, :], grad_N[j, :])\n\n            # Element B matrix rows are identical for all pressure nodes in the element\n            b_row_elem = np.zeros(6, dtype=np.float64)\n            for i in range(3):\n                b_row_elem[2*i]   = -(area / 3.0) * grad_N[i, 0]\n                b_row_elem[2*i+1] = -(area / 3.0) * grad_N[i, 1]\n            \n            # Element F vector\n            f_elem = np.zeros(6, dtype=np.float64)\n            f_val_x = rho * gx * area / 3.0\n            f_val_y = rho * gy * area / 3.0\n            for i in range(3):\n                f_elem[2*i] = f_val_x\n                f_elem[2*i+1] = f_val_y\n            \n            # Assembly\n            for i in range(3):\n                g_p_dof = elem_nodes[i]\n                g_i_v_dof_x, g_i_v_dof_y = 2 * elem_nodes[i], 2 * elem_nodes[i] + 1\n                \n                # Assemble F contributions\n                F_global[g_i_v_dof_x] += f_elem[2*i]\n                F_global[g_i_v_dof_y] += f_elem[2*i+1]\n\n                for j in range(3):\n                    g_j_v_dof_x = 2 * elem_nodes[j]\n                    g_j_v_dof_y = 2 * elem_nodes[j] + 1\n                    \n                    # Assemble A block\n                    A_global[g_i_v_dof_x, g_j_v_dof_x] += k_elem_scalar[i, j]\n                    A_global[g_i_v_dof_y, g_j_v_dof_y] += k_elem_scalar[i, j]\n                \n                # Assemble B block (row for p_i)\n                for j_local in range(3):\n                    g_j_v_dof_x = 2 * elem_nodes[j_local]\n                    g_j_v_dof_y = 2 * elem_nodes[j_local] + 1\n                    B_global[g_p_dof, g_j_v_dof_x] += b_row_elem[2*j_local]\n                    B_global[g_p_dof, g_j_v_dof_y] += b_row_elem[2*j_local+1]\n        \n        # Reduce matrices and vector\n        A_uu = A_global[np.ix_(free_v_dofs, free_v_dofs)]\n        B_pu = B_global[np.ix_(free_p_dofs, free_v_dofs)]\n        F_u = F_global[free_v_dofs]\n\n        # Task 1: Norm of reduced force vector\n        norm_Fu = np.linalg.norm(F_u)\n        \n        # Task 2: Inertia of K\n        K_mat = np.block([\n            [A_uu, B_pu.T],\n            [B_pu, np.zeros((num_free_p, num_free_p))]\n        ])\n        \n        eigenvalues = eigh(K_mat, eigvals_only=True)\n        \n        max_abs_eig = 0.0\n        if len(eigenvalues) > 0:\n            max_abs_eig = np.max(np.abs(eigenvalues))\n        tau = 1e-10 * max(1.0, max_abs_eig)\n\n        n_plus = int(np.sum(eigenvalues > tau))\n        n_minus = int(np.sum(eigenvalues  -tau))\n        n_zero = len(eigenvalues) - n_plus - n_minus\n        \n        all_results.extend([f\"{norm_Fu:.6f}\", n_plus, n_zero, n_minus])\n\n    # Final print statement\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "3616527"}]}