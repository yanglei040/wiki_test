{"hands_on_practices": [{"introduction": "在地球物理学中，我们经常处理复杂的几何形状，因此非结构化网格上的有限体积法（FVM）至关重要。本练习将带你实践FVM中最基本也是最核心的一步：在单个控制体积（一个四面体单元）上计算几何量。通过精确计算面法向量和面积，并确保它们正确的方向性，你将为保证离散守恒和精确通量计算打下坚实的基础[@problem_id:3616607]。", "problem": "考虑一个由三角化区域中的四面体单元定义的单个控制体。该四面体的顶点为 $V_0=(0,0,0)$、$V_1=(2,0,0)$、$V_2=(0,3,0)$ 和 $V_3=(0,0,6)$，坐标单位为 $\\mathrm{m}$。将此四面体视为有限体积法 (Finite Volume Method, FVM) 中的一个控制体，用于求解形式为 $\\nabla \\cdot \\boldsymbol{u} = s$ 的守恒定律，其中 $\\boldsymbol{u}$ 是给定的速度场，$s$ 是一个源项。通过控制体边界的体积通量由 $\\boldsymbol{u} \\cdot \\boldsymbol{n}$ 在边界上的面积分给出，其中 $\\boldsymbol{n}$ 是向外的单位法向量。\n\n一个散度协调的离散化方法要求对四面体的每个三角形面 $f$ 执行以下几何和定向步骤：仅使用顶点坐标计算面心、面面积 $A_f$ 和单位外法向量 $\\boldsymbol{n}_f$。使用以下几何构造来确保正确定向：对于一个具有有序顶点 $(\\boldsymbol{v}_1,\\boldsymbol{v}_2,\\boldsymbol{v}_3)$ 的面，其定向面积矢量定义为 $\\boldsymbol{S}_f=\\tfrac{1}{2}[(\\boldsymbol{v}_2-\\boldsymbol{v}_1) \\times (\\boldsymbol{v}_3-\\boldsymbol{v}_1)]$，并在必要时翻转 $\\boldsymbol{S}_f$ 的符号，以使 $\\boldsymbol{S}_f \\cdot (\\boldsymbol{x}_f-\\boldsymbol{x}_c)>0$ 成立，其中 $\\boldsymbol{x}_f$ 是面心，$\\boldsymbol{x}_c$ 是单元中心。然后有 $A_f=|\\boldsymbol{S}_f|$ 和 $\\boldsymbol{n}_f=\\boldsymbol{S}_f/|\\boldsymbol{S}_f|$。\n\n设速度场为 $\\boldsymbol{u}(x,y,z)=(\\alpha x,\\, \\beta y,\\, \\gamma z)$，其中 $\\alpha=1\\,\\mathrm{s}^{-1}$、$\\beta=2\\,\\mathrm{s}^{-1}$ 和 $\\gamma=2\\,\\mathrm{s}^{-1}$。对于每个面 $f$，在面心 $\\boldsymbol{x}_f$ 处计算 $\\boldsymbol{u}$ 的值，计算定向面通量 $\\Phi_f=\\boldsymbol{u}(\\boldsymbol{x}_f) \\cdot \\boldsymbol{n}_f\\,A_f=\\boldsymbol{u}(\\boldsymbol{x}_f) \\cdot \\boldsymbol{S}_f$，然后对所有面求和，以获得通过四面体边界的净向外体积通量。\n\n从守恒的积分形式（净向外通量等于 $\\boldsymbol{u}\\cdot \\boldsymbol{n}$ 在边界上的面积分）出发，并仅使用上述定义，从顶点坐标开始明确执行计算。给出净向外体积通量的最终数值。请以 $\\mathrm{m}^{3}/\\mathrm{s}$ 为单位表示您的答案，并四舍五入到四位有效数字。", "solution": "该问题被认为是有效的，因为它具有科学依据、提法明确且客观。它为有限体积法背景下的一个标准数值分析问题提供了完整且一致的设定。我们可以开始求解。\n\n目标是计算通过四面体控制体边界的净向外体积通量。问题规定，这需要通过对四面体的四个面上的通量求和来完成，其中每个面通量使用中点法则进行近似。净通量 $\\Phi_{\\text{net}}$ 由下式给出：\n$$\n\\Phi_{\\text{net}} = \\sum_{f} \\Phi_f = \\sum_{f} \\boldsymbol{u}(\\boldsymbol{x}_f) \\cdot \\boldsymbol{S}_f\n$$\n其中求和遍及四面体的四个面，$ \\boldsymbol{x}_f $ 是面 $f$ 的中心，$ \\boldsymbol{S}_f $ 是面 $f$ 的定向面积矢量。\n\n四面体的顶点为 $V_0=(0,0,0)$、$V_1=(2,0,0)$、$V_2=(0,3,0)$ 和 $V_3=(0,0,6)$，坐标单位为米。\n速度场为 $\\boldsymbol{u}(x,y,z) = (\\alpha x, \\beta y, \\gamma z)$，常数 $\\alpha = 1\\,\\mathrm{s}^{-1}$、$\\beta = 2\\,\\mathrm{s}^{-1}$ 和 $\\gamma = 2\\,\\mathrm{s}^{-1}$。\n\n首先，我们计算四面体单元的中心 $\\boldsymbol{x}_c$：\n$$\n\\boldsymbol{x}_c = \\frac{1}{4} (V_0 + V_1 + V_2 + V_3) = \\frac{1}{4} ((0,0,0) + (2,0,0) + (0,3,0) + (0,0,6))\n$$\n$$\n\\boldsymbol{x}_c = \\frac{1}{4} (2, 3, 6) = (0.5, 0.75, 1.5)\n$$\n\n四面体的四个面是：\n1.  $f_1$：位于 $xy$ 平面上的面，顶点为 $(V_0, V_1, V_2)$。\n2.  $f_2$：位于 $xz$ 平面上的面，顶点为 $(V_0, V_1, V_3)$。\n3.  $f_3$：位于 $yz$ 平面上的面，顶点为 $(V_0, V_2, V_3)$。\n4.  $f_4$：斜面，顶点为 $(V_1, V_2, V_3)$。\n\n我们现在将按照指定程序计算每个面的通量。\n\n**面 1：顶点 $(V_0, V_1, V_2)$**\n我们将顶点排序为 $(\\boldsymbol{v}_1, \\boldsymbol{v}_2, \\boldsymbol{v}_3) = (V_0, V_1, V_2)$。\n初始定向面积矢量 $\\boldsymbol{S}_{f_1}'$ 为：\n$$\n\\boldsymbol{S}_{f_1}' = \\frac{1}{2} ( (V_1 - V_0) \\times (V_2 - V_0) ) = \\frac{1}{2} ( (2,0,0) \\times (0,3,0) ) = \\frac{1}{2} (0,0,6) = (0,0,3)\n$$\n面心 $\\boldsymbol{x}_{f_1}$ 为：\n$$\n\\boldsymbol{x}_{f_1} = \\frac{1}{3} (V_0 + V_1 + V_2) = \\frac{1}{3} (2,3,0)\n$$\n为确定向外方向，我们检查 $\\boldsymbol{S}_{f_1}' \\cdot (\\boldsymbol{x}_{f_1} - \\boldsymbol{x}_c)$ 的符号：\n$$\n(0,0,3) \\cdot \\left( \\frac{1}{3}(2,3,0) - \\frac{1}{4}(2,3,6) \\right) = (0,0,3) \\cdot \\left( \\frac{2}{3} - \\frac{1}{2}, 1 - \\frac{3}{4}, 0 - \\frac{3}{2} \\right) = (0,0,3) \\cdot \\left( \\frac{1}{6}, \\frac{1}{4}, -\\frac{3}{2} \\right) = -4.5\n$$\n由于结果为负，我们必须翻转符号。正确定向的面积矢量为 $\\boldsymbol{S}_{f_1} = -\\boldsymbol{S}_{f_1}' = (0,0,-3)$。\n面心处的速度为 $\\boldsymbol{u}(\\boldsymbol{x}_{f_1}) = (\\alpha \\frac{2}{3}, \\beta \\cdot 1, \\gamma \\cdot 0) = (1 \\cdot \\frac{2}{3}, 2 \\cdot 1, 2 \\cdot 0) = (\\frac{2}{3}, 2, 0)$。\n通过面 $f_1$ 的通量为：\n$$\n\\Phi_{f_1} = \\boldsymbol{u}(\\boldsymbol{x}_{f_1}) \\cdot \\boldsymbol{S}_{f_1} = (\\frac{2}{3}, 2, 0) \\cdot (0,0,-3) = 0\n$$\n\n**面 2：顶点 $(V_0, V_1, V_3)$**\n我们将顶点排序为 $(\\boldsymbol{v}_1, \\boldsymbol{v}_2, \\boldsymbol{v}_3) = (V_0, V_3, V_1)$。\n初始定向面积矢量 $\\boldsymbol{S}_{f_2}'$ 为：\n$$\n\\boldsymbol{S}_{f_2}' = \\frac{1}{2} ( (V_3 - V_0) \\times (V_1 - V_0) ) = \\frac{1}{2} ( (0,0,6) \\times (2,0,0) ) = \\frac{1}{2} (0,12,0) = (0,6,0)\n$$\n面心 $\\boldsymbol{x}_{f_2}$ 为：\n$$\n\\boldsymbol{x}_{f_2} = \\frac{1}{3} (V_0 + V_1 + V_3) = \\frac{1}{3} (2,0,6)\n$$\n检查方向：\n$$\n(0,6,0) \\cdot \\left( \\frac{1}{3}(2,0,6) - \\frac{1}{4}(2,3,6) \\right) = (0,6,0) \\cdot \\left( \\frac{2}{3} - \\frac{1}{2}, 0 - \\frac{3}{4}, 2 - \\frac{3}{2} \\right) = (0,6,0) \\cdot \\left( \\frac{1}{6}, -\\frac{3}{4}, \\frac{1}{2} \\right) = -4.5\n$$\n结果为负，所以 $\\boldsymbol{S}_{f_2} = -\\boldsymbol{S}_{f_2}' = (0,-6,0)$。\n面心处的速度为 $\\boldsymbol{u}(\\boldsymbol{x}_{f_2}) = (\\alpha \\frac{2}{3}, \\beta \\cdot 0, \\gamma \\cdot 2) = (1 \\cdot \\frac{2}{3}, 2 \\cdot 0, 2 \\cdot 2) = (\\frac{2}{3}, 0, 4)$。\n通过面 $f_2$ 的通量为：\n$$\n\\Phi_{f_2} = \\boldsymbol{u}(\\boldsymbol{x}_{f_2}) \\cdot \\boldsymbol{S}_{f_2} = (\\frac{2}{3}, 0, 4) \\cdot (0,-6,0) = 0\n$$\n\n**面 3：顶点 $(V_0, V_2, V_3)$**\n我们将顶点排序为 $(\\boldsymbol{v}_1, \\boldsymbol{v}_2, \\boldsymbol{v}_3) = (V_0, V_2, V_3)$。\n初始定向面积矢量 $\\boldsymbol{S}_{f_3}'$ 为：\n$$\n\\boldsymbol{S}_{f_3}' = \\frac{1}{2} ( (V_2 - V_0) \\times (V_3 - V_0) ) = \\frac{1}{2} ( (0,3,0) \\times (0,0,6) ) = \\frac{1}{2} (18,0,0) = (9,0,0)\n$$\n面心 $\\boldsymbol{x}_{f_3}$ 为：\n$$\n\\boldsymbol{x}_{f_3} = \\frac{1}{3} (V_0 + V_2 + V_3) = \\frac{1}{3} (0,3,6) = (0,1,2)\n$$\n检查方向：\n$$\n(9,0,0) \\cdot \\left( (0,1,2) - (0.5, 0.75, 1.5) \\right) = (9,0,0) \\cdot (-0.5, 0.25, 0.5) = -4.5\n$$\n结果为负，所以 $\\boldsymbol{S}_{f_3} = -\\boldsymbol{S}_{f_3}' = (-9,0,0)$。\n面心处的速度为 $\\boldsymbol{u}(\\boldsymbol{x}_{f_3}) = (\\alpha \\cdot 0, \\beta \\cdot 1, \\gamma \\cdot 2) = (1 \\cdot 0, 2 \\cdot 1, 2 \\cdot 2) = (0,2,4)$。\n通过面 $f_3$ 的通量为：\n$$\n\\Phi_{f_3} = \\boldsymbol{u}(\\boldsymbol{x}_{f_3}) \\cdot \\boldsymbol{S}_{f_3} = (0,2,4) \\cdot (-9,0,0) = 0\n$$\n通过坐标平面上三个面的通量均为零，因为对于每个这样的面，速度垂直于该面的分量在该面上的任何地方都为零。\n\n**面 4：顶点 $(V_1, V_2, V_3)$**\n我们将顶点排序为 $(\\boldsymbol{v}_1, \\boldsymbol{v}_2, \\boldsymbol{v}_3) = (V_1, V_2, V_3)$。\n初始定向面积矢量 $\\boldsymbol{S}_{f_4}'$ 为：\n$$\n\\boldsymbol{S}_{f_4}' = \\frac{1}{2} ( (V_2 - V_1) \\times (V_3 - V_1) ) = \\frac{1}{2} ( (-2,3,0) \\times (-2,0,6) ) = \\frac{1}{2} (18,12,6) = (9,6,3)\n$$\n面心 $\\boldsymbol{x}_{f_4}$ 为：\n$$\n\\boldsymbol{x}_{f_4} = \\frac{1}{3} (V_1 + V_2 + V_3) = \\frac{1}{3} (2,3,6)\n$$\n检查方向：\n$$\n(9,6,3) \\cdot \\left( \\frac{1}{3}(2,3,6) - \\frac{1}{4}(2,3,6) \\right) = (9,6,3) \\cdot \\left( \\frac{1}{12}(2,3,6) \\right) = \\frac{1}{12} (18+18+18) = \\frac{54}{12} = 4.5\n$$\n结果为正，所以方向已是向外：$\\boldsymbol{S}_{f_4} = \\boldsymbol{S}_{f_4}' = (9,6,3)$。\n面心处的速度为 $\\boldsymbol{u}(\\boldsymbol{x}_{f_4}) = (\\alpha \\frac{2}{3}, \\beta \\cdot 1, \\gamma \\cdot 2) = (1 \\cdot \\frac{2}{3}, 2 \\cdot 1, 2 \\cdot 2) = (\\frac{2}{3}, 2, 4)$。\n通过面 $f_4$ 的通量为：\n$$\n\\Phi_{f_4} = \\boldsymbol{u}(\\boldsymbol{x}_{f_4}) \\cdot \\boldsymbol{S}_{f_4} = (\\frac{2}{3}, 2, 4) \\cdot (9,6,3) = (\\frac{2}{3})(9) + (2)(6) + (4)(3) = 6 + 12 + 12 = 30\n$$\n\n**总净通量**\n净向外体积通量是所有四个面通量之和：\n$$\n\\Phi_{\\text{net}} = \\Phi_{f_1} + \\Phi_{f_2} + \\Phi_{f_3} + \\Phi_{f_4} = 0 + 0 + 0 + 30 = 30\n$$\n单位是 $\\mathrm{m}^3/\\mathrm{s}$。问题要求四舍五入到四位有效数字，所以答案是 $30.00\\,\\mathrm{m}^3/\\mathrm{s}$。\n\n作为验证，我们可以使用散度定理。精确的净通量是速度场散度的体积分：\n$$\n\\Phi_{\\text{net, exact}} = \\int_V (\\nabla \\cdot \\boldsymbol{u}) \\, dV\n$$\n$\\boldsymbol{u}$ 的散度为：\n$$\n\\nabla \\cdot \\boldsymbol{u} = \\frac{\\partial}{\\partial x}(\\alpha x) + \\frac{\\partial}{\\partial y}(\\beta y) + \\frac{\\partial}{\\partial z}(\\gamma z) = \\alpha + \\beta + \\gamma = 1 + 2 + 2 = 5\\,\\mathrm{s}^{-1}\n$$\n由于散度是常数，通量等于 $(\\alpha + \\beta + \\gamma)$ 乘以四面体的体积 $\\mathcal{V}$：\n$$\n\\mathcal{V} = \\frac{1}{6} |(V_1-V_0) \\cdot ((V_2-V_0) \\times (V_3-V_0))| = \\frac{1}{6} |(2,0,0) \\cdot ((0,3,0) \\times (0,0,6))| = \\frac{1}{6} |(2,0,0) \\cdot (18,0,0)| = \\frac{36}{6} = 6\\,\\mathrm{m}^3\n$$\n因此，精确的通量为：\n$$\n\\Phi_{\\text{net, exact}} = (5\\,\\mathrm{s}^{-1}) \\times (6\\,\\mathrm{m}^3) = 30\\,\\mathrm{m}^3/\\mathrm{s}\n$$\n问题中规定的数值方法（面积分的中点法则）对于多边形/多面体域上的线性速度场是精确的，因此我们计算的结果与精确的解析解相匹配。\n\n最终答案，四舍五入到四位有效数字，为 $30.00\\,\\mathrm{m}^3/\\mathrm{s}$。", "answer": "$$\\boxed{30.00}$$", "id": "3616607"}, {"introduction": "数值格式在离散求解偏微分方程时，会引入额外的项，从而改变其行为，这种现象可以通过修正方程分析来揭示。本练习旨在通过推导全局Lax–Friedrichs通量的修正方程，来量化其内含的人工粘性[@problem_id:3616566]。理解人工粘性不仅有助于解释数值激波的展宽，也是评估和设计更高级格式（如高阶TVD格式）的关键一步。", "problem": "考虑标量守恒律偏微分方程 (PDE) $u_t + (f(u))_x = 0$，其在一个间距为 $\\Delta x$ 的均匀一维网格上，通过守恒型有限体积 (FV) 方法进行离散。令 $u_i(t)$ 表示单元 $i$ 中的单元平均值。半离散有限体积格式为\n$$\n\\frac{d u_i}{d t} = -\\frac{1}{\\Delta x}\\left(F_{i+1/2} - F_{i-1/2}\\right),\n$$\n其中数值通量为全局 Lax–Friedrichs (GLF) 通量\n$$\nF_{i+1/2} = \\frac{1}{2}\\left(f(u_i) + f(u_{i+1})\\right) - \\frac{1}{2}\\,\\alpha\\,(u_{i+1} - u_i),\n$$\n其中常数 $\\alpha \\ge \\sup_{u} |f'(u)|$ 被选择用来在全局上界定特征速度。假设 $u(x,t)$ 在 $\\Delta x$ 的尺度上是光滑的，因此泰勒展开是有效的。\n\n(a) 从上述的半离散有限体积格式和 GLF 通量出发，推导空间主阶修正方程，即 $u(x,t)$ 在忽略 $\\mathcal{O}(\\Delta x^2)$ 阶项的情况下所满足的偏微分方程，并确定人工粘性项 $\\nu\\,u_{xx}$ 中的系数 $\\nu$。\n\n(b) 现在特化为无粘 Burgers 通量 $f(u) = \\frac{1}{2}u^2$，并考虑一个连接常数左状态 $u_L$ 和右状态 $u_R$（$u_L > u_R$）的单一稳态行进激波，其跳跃幅度为 $\\Delta u = u_L - u_R > 0$。利用 (a) 部分中修正方程的粘性行波分析，将特征激波厚度 $\\delta$ 定义为稳态粘性 Burgers 激波剖面中双曲正切函数自变量里系数的倒数。证明 $\\delta$ 与人工粘性系数成线性关系，并用 $\\nu$ 和 $\\Delta u$ 表示 $\\delta$。然后，通过将跨越激波的网格单元数定义为 $N_{\\text{shock}} = \\delta/\\Delta x$，将此厚度与网格分辨率联系起来，并完全用 $\\alpha$ 和 $\\Delta u$ 表示 $N_{\\text{shock}}$。\n\n你的最终答案必须是 $N_{\\text{shock}}$ 以 $\\alpha$ 和 $\\Delta u$ 表示的单个闭式解析表达式。无需进行数值计算。如果你引入任何角度量，请以弧度表示。最终答案中不要包含单位。", "solution": "用户希望我分两部分解决一个问题。首先，我需要为带有全局 Lax-Friedrichs 通量的有限体积格式推导修正方程。其次，我需要将其应用于 Burgers 方程，以确定解析一个稳态激波所需的网格单元数。\n\n该问题在科学上和数学上都是适定的，为严格推导提供了所有必要的信息和定义。这是守恒律数值分析中的一个标准练习。因此，该问题是有效的，我将开始解答。\n\n(a) 空间主阶修正方程的推导。\n\n我们从给定的半离散有限体积格式开始\n$$\n\\frac{d u_i}{d t} = -\\frac{1}{\\Delta x}\\left(F_{i+1/2} - F_{i-1/2}\\right)\n$$\n其中 $u_i(t)$ 是解 $u(x,t)$ 在以 $x_i$ 为中心的单元 $i$ 内的单元平均值。对于光滑解，有 $u_i(t) = u(x_i, t) + \\mathcal{O}(\\Delta x^2)$，因此 $\\frac{du_i}{dt} = u_t(x_i, t) + \\mathcal{O}(\\Delta x^2)$。我们将 $u(x_i, t)$ 记为 $u_i$，其空间导数记为 $u_x, u_{xx}$ 等，均在 $x_i$ 处取值。通量 $F_{i+1/2}$ 是全局 Lax-Friedrichs 通量：\n$$\nF_{i+1/2} = \\frac{1}{2}\\left(f(u_i) + f(u_{i+1})\\right) - \\frac{1}{2}\\,\\alpha\\,(u_{i+1} - u_i)\n$$\n为了求得修正方程，我们对格式右侧在点 $x_i$ 附近进行泰勒级数展开。右侧为\n$$\n-\\frac{1}{\\Delta x} \\left[ \\left(\\frac{1}{2}(f_i + f_{i+1}) - \\frac{\\alpha}{2}(u_{i+1} - u_i)\\right) - \\left(\\frac{1}{2}(f_{i-1} + f_i) - \\frac{\\alpha}{2}(u_i - u_{i-1})\\right) \\right]\n$$\n$$\n= -\\frac{1}{2\\Delta x}(f_{i+1} - f_{i-1}) + \\frac{\\alpha}{2\\Delta x}(u_{i+1} - 2u_i + u_{i-1})\n$$\n我们将项 $u_{i\\pm1}$ 和 $f_{i\\pm1} = f(u_{i\\pm1})$ 在 $x_i$ 附近展开：\n$$\nu_{i\\pm1} = u(x_i \\pm \\Delta x) = u_i \\pm \\Delta x u_x + \\frac{\\Delta x^2}{2} u_{xx} \\pm \\frac{\\Delta x^3}{6} u_{xxx} + \\mathcal{O}(\\Delta x^4)\n$$\n$u_{i+1} - 2u_i + u_{i-1}$ 项是 $\\Delta x^2 u_{xx}$ 的标准二阶中心差分近似：\n$$\nu_{i+1} - 2u_i + u_{i-1} = \\Delta x^2 u_{xx} + \\mathcal{O}(\\Delta x^4)\n$$\n$f_{i+1} - f_{i-1}$ 项是通量函数 $f(u)$ 的中心差分。\n我们将其展开为：\n$$\nf_{i+1} = f(u(x_i+\\Delta x)) = f(u_i) + \\Delta x (f(u))_x + \\frac{\\Delta x^2}{2} (f(u))_{xx} + \\mathcal{O}(\\Delta x^3)\n$$\n$$\nf_{i-1} = f(u(x_i-\\Delta x)) = f(u_i) - \\Delta x (f(u))_x + \\frac{\\Delta x^2}{2} (f(u))_{xx} - \\mathcal{O}(\\Delta x^3)\n$$\n所以，$f_{i+1} - f_{i-1} = 2\\Delta x (f(u))_x + \\mathcal{O}(\\Delta x^3) = 2\\Delta x f'(u)u_x + \\mathcal{O}(\\Delta x^3)$。\n\n将这些展开式代回格式的右侧：\n$$\n-\\frac{1}{2\\Delta x}(2\\Delta x f'(u)u_x + \\mathcal{O}(\\Delta x^3)) + \\frac{\\alpha}{2\\Delta x}(\\Delta x^2 u_{xx} + \\mathcal{O}(\\Delta x^4))\n$$\n$$\n= -f'(u)u_x + \\frac{\\alpha \\Delta x}{2} u_{xx} + \\mathcal{O}(\\Delta x^2)\n$$\n将左侧 ($u_t$) 与此表达式相等，得到修正方程：\n$$\nu_t = -f'(u)u_x + \\frac{\\alpha \\Delta x}{2} u_{xx}\n$$\n可重写为\n$$\nu_t + (f(u))_x = \\frac{\\alpha \\Delta x}{2} u_{xx}\n$$\n这就是空间主阶修正方程。右侧的项是人工粘性项 $\\nu u_{xx}$，其中人工粘性系数为\n$$\n\\nu = \\frac{\\alpha \\Delta x}{2}\n$$\n\n(b) 无粘 Burgers 方程的激波厚度。\n\n我们特化为无粘 Burgers 通量 $f(u) = \\frac{1}{2}u^2$。修正方程变为粘性 Burgers 方程：\n$$\nu_t + u u_x = \\nu u_{xx}\n$$\n我们寻找形如 $u(x,t) = U(\\xi)$ 的稳态行波解，其中 $\\xi = x - st$，$s$ 是恒定的波速。偏导数变为关于 $\\xi$ 的常导数：$u_t = -sU'$ 和 $u_x = U'$。代入偏微分方程，我们得到关于剖面 $U(\\xi)$ 的常微分方程（ODE）：\n$$\n-sU' + UU' = \\nu U''\n$$\n我们将此方程对 $\\xi$ 积分一次：\n$$\n-sU + \\frac{1}{2}U^2 = \\nu U' + C_1\n$$\n其中 $C_1$ 是一个积分常数。该激波连接了当 $\\xi \\to -\\infty$ 时的常数左状态 $u_L$ 和当 $\\xi \\to +\\infty$ 时的常数右状态 $u_R$。在这些极限下，解是常数，因此其导数 $U'$ 必须为零。应用这些边界条件：\n当 $\\xi \\to -\\infty$ 时，$U \\to u_L$ 且 $U' \\to 0$，所以 $-su_L + \\frac{1}{2}u_L^2 = C_1$。\n当 $\\xi \\to +\\infty$ 时，$U \\to u_R$ 且 $U' \\to 0$，所以 $-su_R + \\frac{1}{2}u_R^2 = C_1$。\n令 $C_1$ 的两个表达式相等，得到 Rankine-Hugoniot 激波速度 $s$：\n$$\n-su_L + \\frac{1}{2}u_L^2 = -su_R + \\frac{1}{2}u_R^2 \\implies s(u_L - u_R) = \\frac{1}{2}(u_L^2 - u_R^2) = \\frac{1}{2}(u_L - u_R)(u_L + u_R)\n$$\n因为 $u_L \\ne u_R$，我们得到 $s = \\frac{1}{2}(u_L + u_R)$。\n\n剖面的常微分方程为 $\\nu U' = -sU + \\frac{1}{2}U^2 - C_1$。对右侧的二次式进行因式分解：\n$$\n\\nu U' = \\frac{1}{2}(U^2 - 2sU - 2C_1) = \\frac{1}{2}(U^2 - (u_L+u_R)U + u_L u_R) = \\frac{1}{2}(U-u_L)(U-u_R)\n$$\n这是一个可分离变量的常微分方程。我们通过分离变量来求解它，对于 $u_R  U  u_L$：\n$$\n\\frac{dU}{(U-u_L)(U-u_R)} = \\frac{1}{2\\nu} d\\xi\n$$\n使用部分分式分解，$\\frac{1}{(U-u_L)(U-u_R)} = \\frac{1}{u_L-u_R}\\left(\\frac{1}{U-u_L} - \\frac{1}{U-u_R}\\right)$，我们积分得：\n$$\n\\frac{1}{u_L-u_R}\\int\\left(\\frac{1}{U-u_L} - \\frac{1}{U-u_R}\\right)dU = \\int\\frac{1}{2\\nu}d\\xi\n$$\n$$\n\\frac{1}{u_L-u_R}\\left(\\ln|U-u_L| - \\ln|U-u_R|\\right) = \\frac{\\xi}{2\\nu} + C_2 \\implies \\ln\\left(\\frac{u_L-U}{U-u_R}\\right) = \\frac{u_L-u_R}{2\\nu}\\xi + C_3\n$$\n求解 $U$ 并通过在 $U = (u_L+u_R)/2$ 处设置原点 $\\xi=0$ 来确定积分常数，我们得到经典的双曲正切剖面：\n$$\nU(\\xi) = \\frac{u_L+u_R}{2} - \\frac{u_L-u_R}{2} \\tanh\\left(\\frac{u_L-u_R}{4\\nu}\\xi\\right)\n$$\n问题将特征激波厚度 $\\delta$ 定义为双曲正切函数自变量中 $\\xi$ 的系数的倒数。该系数是 $\\frac{u_L-u_R}{4\\nu}$。\n因此，激波厚度是\n$$\n\\delta = \\left( \\frac{u_L - u_R}{4\\nu} \\right)^{-1} = \\frac{4\\nu}{u_L - u_R}\n$$\n使用跳跃幅度 $\\Delta u = u_L - u_R$ 的定义，我们有 $\\delta = \\frac{4\\nu}{\\Delta u}$。这表明 $\\delta$ 与 $\\nu$ 成线性关系。\n\n最后，我们将这个厚度与网格分辨率联系起来。跨越激波的网格单元数定义为 $N_{\\text{shock}} = \\delta/\\Delta x$。代入 $\\delta$ 和 $\\nu = \\frac{\\alpha\\Delta x}{2}$ 的表达式：\n$$\nN_{\\text{shock}} = \\frac{1}{\\Delta x} \\delta = \\frac{1}{\\Delta x} \\frac{4\\nu}{\\Delta u} = \\frac{1}{\\Delta x} \\frac{4}{\\Delta u} \\left(\\frac{\\alpha \\Delta x}{2}\\right)\n$$\n$\\Delta x$ 项相互抵消，剩下：\n$$\nN_{\\text{shock}} = \\frac{2\\alpha}{\\Delta u}\n$$\n此表达式完全用全局 Lax-Friedrichs 参数 $\\alpha$ 和激波跳跃幅度 $\\Delta u$ 给出了激波内的网格单元数。", "answer": "$$\n\\boxed{\\frac{2\\alpha}{\\Delta u}}\n$$", "id": "3616566"}, {"introduction": "在计算地球物理学中，许多问题，如反应输运，既包含需要精细时间步长的平流项，又包含需要大时间步长的刚性源项，同时解还必须满足物理约束（如浓度非负）。本练习是一个综合性的挑战，要求你设计并实现一个高阶、保正的隐式-显式（IMEX）有限体积格式来解决这类问题[@problem_id:3616608]。通过本练习，你将掌握如何结合算子分裂、高阶重构和保正限制器等先进技术，来构建一个能够应对复杂物理现象的稳健求解器。", "problem": "设计并实现一种一维有限体积法，用于求解带有刚性源项的反应输运守恒律。该方法需同时具有保正性和高阶精度。考虑一个在周期性域 $[0,L]$ 内的标量浓度场 $c(x,t)$，它满足以下守恒律\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(u\\,c\\right) = R(c),\n$$\n其中 $u$ 是一个恒定的平流速度，$R(c)$ 是一个模拟反应的源项。对于此问题，采用线性弛豫源\n$$\nR(c) = k\\left(c_{\\mathrm{eq}} - c\\right),\n$$\n其中 $k>0$ 是一个刚度参数（反应速率），$c_{\\mathrm{eq}}\\ge 0$ 是一个平衡浓度，当 $c^\\ast = c_{\\mathrm{eq}}$ 时满足 $R(c^\\ast)=0$。目标是设计并实现一种隐式-显式 (IMEX) 格式，定义为隐式-显式 (IMEX) Runge-Kutta 或 IMEX 分裂方法。该格式要求在时间上是二阶的，并对平流项在空间上使用保正性的高阶重构。具体要求如下：\n\n- 使用一种基于受限线性重构的具有二阶空间精度的有限体积法（例如，使用 minmod 斜率限制器的守恒律单调上游中心格式 (MUSCL)），并通过对斜率进行乘法缩放来强制实现重构界面状态的正定性，以便当网格平均值为非负时，左右界面状态保持非负。\n- 使用隐式-显式时间积分：使用强稳定性保持二阶 Runge-Kutta 方法 (SSPRK2) 显式处理平流项，并使用后向欧拉法隐式处理刚性源项。为获得整体二阶精度，采用 Strang 型分裂（半步隐式源项，全步显式平流，半步隐式源项）。\n- 确保在初始数据非负且显式平流更新满足 Courant–Friedrichs–Lewy (CFL) 时间步长限制（即使用 $\\Delta t = \\mathrm{CFL}\\,\\Delta x/|u|$，其中 $\\mathrm{CFL}$ 为严格小于 1 的固定常数）的条件下，该格式在所有时间点上都保持 $c$ 的正定性。\n- 证明该 IMEX 格式能够精确保持满足 $R(c^\\ast)=0$ 的平衡态，即如果初始条件 $c(x,0)=c^\\ast$ 为常数，那么根据格式的构造，对于所有时间 $t$，都有 $c(x,t)=c^\\ast$。\n\n待实现的离散化细节：\n\n- 空间网格：$N$ 个均匀有限体积网格覆盖 $[0,L]$，采用周期性边界条件。网格平均值 $c_i^n$ 近似于 $\\frac{1}{\\Delta x}\\int_{x_{i-1/2}}^{x_{i+1/2}} c(x,t^n)\\,dx$，其中 $\\Delta x=L/N$，$t^n$ 是第 $n$ 个时间点。\n- 重构：使用 minmod 限制器计算斜率，然后将每个斜率乘以一个在 $[0,1]$ 区间内的因子，以确保当网格平均值为非负时，每个网格中重构的左、右界面状态均为非负。平流项的通量应为迎风通量，与 $u$ 的符号一致，并在重构的界面状态处进行计算。\n- 时间积分：每个大小为 $\\Delta t$ 的时间步执行一个 Strang 分裂步，包括：\n  1. 对源项进行时间步长为 $\\Delta t/2$ 的隐式后向欧拉半步积分，\n  2. 对平流项进行时间步长为 $\\Delta t$ 的显式 SSPRK2 全步积分，\n  3. 对源项再次进行时间步长为 $\\Delta t/2$ 的隐式后向欧拉半步积分。\n  对于指定的线性弛豫源 $R(c)=k(c_{\\mathrm{eq}}-c)$，每个半步的后向欧拉更新应被精确求解。平流步骤应使用保正性的受限重构和迎风通量。\n\n单位：\n\n- $x$ 单位为米 ($\\mathrm{m}$)，\n- $t$ 单位为秒 ($\\mathrm{s}$)，\n- $u$ 单位为米/秒 ($\\mathrm{m/s}$)，\n- $c$ 和 $c_{\\mathrm{eq}}$ 单位为摩尔/立方米 ($\\mathrm{mol/m^3}$)，\n- $k$ 单位为秒的倒数 ($\\mathrm{s^{-1}}$)。\n\n您的程序应实现上述格式，并运行以下测试套件。对于每个测试用例，模拟直到最终时间 $T$，时间步长由 $\\Delta t = \\mathrm{CFL}\\,\\Delta x/|u|$ 决定，其中 $\\mathrm{CFL}=0.45$。使用周期性边界条件。对于每个测试，返回所要求的量化指标。\n\n测试套件：\n\n1. 刚性弛豫下的标准正定性路径：\n   - 参数：$L=1\\,\\mathrm{m}$，$N=200$，$u=0.5\\,\\mathrm{m/s}$，$k=1000\\,\\mathrm{s^{-1}}$，$c_{\\mathrm{eq}}=1.0\\,\\mathrm{mol/m^3}$，$T=0.1\\,\\mathrm{s}$。\n   - 初始条件：$c(x,0)=0.5+0.5\\sin(2\\pi x/L)\\,\\mathrm{mol/m^3}$。\n   - 输出：在域上 $c(x,T)$ 的最小值，以 $\\mathrm{mol/m^3}$ 为单位，表示为浮点数。\n\n2. 平衡态的精确保持：\n   - 参数：$L=1\\,\\mathrm{m}$，$N=100$，$u=1.0\\,\\mathrm{m/s}$，$k=10^6\\,\\mathrm{s^{-1}}$，$c_{\\mathrm{eq}}=0.3\\,\\mathrm{mol/m^3}$，$T=0.05\\,\\mathrm{s}$。\n   - 初始条件：$c(x,0)=c_{\\mathrm{eq}}$ (常数)。\n   - 输出：$\\max_{x}|c(x,T)-c_{\\mathrm{eq}}|$，以 $\\mathrm{mol/m^3}$ 为单位，表示为浮点数。\n\n3. 接近零浓度的边缘情况：\n   - 参数：$L=1\\,\\mathrm{m}$，$N=200$，$u=0.2\\,\\mathrm{m/s}$，$k=500\\,\\mathrm{s^{-1}}$，$c_{\\mathrm{eq}}=0.0\\,\\mathrm{mol/m^3}$，$T=0.05\\,\\mathrm{s}$。\n   - 初始条件：$c(x,0)=10^{-12}+10^{-3}\\exp\\left(-\\frac{(x-0.5L)^2}{(0.05L)^2}\\right)\\,\\mathrm{mol/m^3}$。\n   - 输出：在域上 $c(x,T)$ 的最小值，以 $\\mathrm{mol/m^3}$ 为单位，表示为浮点数。\n\n4. 三角形初始剖面下的强平流：\n   - 参数：$L=1\\,\\mathrm{m}$，$N=150$，$u=2.0\\,\\mathrm{m/s}$，$k=1000\\,\\mathrm{s^{-1}}$，$c_{\\mathrm{eq}}=0.5\\,\\mathrm{mol/m^3}$，$T=0.02\\,\\mathrm{s}$。\n   - 初始条件：$c(x,0)=\\max\\left(0, 1 - 2\\left|\\frac{x}{L}-0.5\\right|\\right)\\,\\mathrm{mol/m^3}$ (一个以 $x=L/2$ 为中心、振幅为 1 的三角形)。\n   - 输出：在域上 $c(x,T)$ 的最小值，以 $\\mathrm{mol/m^3}$ 为单位，表示为浮点数。\n\n最终输出格式：\n\n- 您的程序应产生单行输出，其中包含四个测试用例的结果，格式为逗号分隔的浮点数列表，并用方括号括起来，例如 $[r_1,r_2,r_3,r_4]$，其中每个 $r_i$ 是上面定义的特定于用例的输出。不应打印任何额外文本。", "solution": "该问题要求为标量反应输运方程设计并实现一个一维有限体积格式。该格式必须是二阶精确、保正的，并采用适用于刚性源项的隐式-显式 (IMEX) 时间积分策略。该问题是适定的、科学上合理的，并为唯一实现提供了足够的细节。\n\n控制守恒律为：\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(u\\,c\\right) = R(c)\n$$\n其中 $c(x,t)$ 是浓度，$u$ 是恒定的平流速度，$R(c) = k(c_{\\mathrm{eq}} - c)$ 是线性弛豫源项。刚度由速率 $k > 0$ 控制，平衡态为 $c_{\\mathrm{eq}} \\ge 0$。\n\n整体数值方法是使用算子分裂法构建的，具体来说是 Strang 分裂法，这是一种二阶精确的技术。该方法将平流和反应过程解耦。从 $t^n$ 到 $t^{n+1} = t^n + \\Delta t$ 的单个时间步计算如下：\n$$\nc^{n+1} = \\mathcal{L}_{\\mathcal{S}}^{\\Delta t/2} \\circ \\mathcal{L}_{\\mathcal{A}}^{\\Delta t} \\circ \\mathcal{L}_{\\mathcal{S}}^{\\Delta t/2} (c^n)\n$$\n其中 $\\mathcal{L}_{\\mathcal{S}}^{\\tau}$ 是在时间长度 $\\tau$ 内求解反应方程 $\\frac{\\partial c}{\\partial t} = R(c)$ 的算子，而 $\\mathcal{L}_{\\mathcal{A}}^{\\tau}$ 是在时间长度 $\\tau$ 内求解平流方程 $\\frac{\\partial c}{\\partial t} + \\frac{\\partial (uc)}{\\partial x} = 0$ 的算子。\n\n1.  **隐式源项步 ($\\mathcal{L}_{\\mathcal{S}}^{\\Delta t/2}$)**\n    反应项是刚性的，这需要使用隐式时间积分方法以避免时间步长过小而无法接受。按照规定使用后向欧拉方法。对于方程 $\\frac{dc_i}{dt} = k(c_{\\mathrm{eq}} - c_i)$，在时间步长 $\\Delta \\tau$ 内从 $c_i^{\\text{in}}$ 到 $c_i^{\\text{out}}$ 的更新为：\n    $$\n    \\frac{c_i^{\\text{out}} - c_i^{\\text{in}}}{\\Delta \\tau} = k(c_{\\mathrm{eq}} - c_i^{\\text{out}})\n    $$\n    这是一个关于 $c_i^{\\text{out}}$ 的线性方程，可以精确求解：\n    $$\n    c_i^{\\text{out}} (1 + k \\Delta \\tau) = c_i^{\\text{in}} + k \\Delta \\tau c_{\\mathrm{eq}} \\quad \\implies \\quad c_i^{\\text{out}} = \\frac{c_i^{\\text{in}} + k \\Delta \\tau c_{\\mathrm{eq}}}{1 + k \\Delta \\tau}\n    $$\n    此更新应用于 $\\Delta \\tau = \\Delta t/2$。如果 $c_i^{\\text{in}} \\ge 0$，并且已知 $k, \\Delta \\tau, c_{\\mathrm{eq}} \\ge 0$，显然 $c_i^{\\text{out}} \\ge 0$。因此，此步骤是无条件保正的。\n\n2.  **显式平流步 ($\\mathcal{L}_{\\mathcal{A}}^{\\Delta t}$)**\n    平流部分由均匀网格上的有限体积法处理，该网格包含 $N$ 个宽度为 $\\Delta x = L/N$ 的网格。网格 $i$ 中的网格平均浓度表示为 $c_i$。平流方程的半离散形式为：\n    $$\n    \\frac{dc_i}{dt} = -\\frac{1}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n    $$\n    其中 $F_{i+1/2}$ 是网格 $i$ 和网格 $i+1$ 之间界面上的数值通量。为达到二阶空间精度，使用了 MUSCL 型重构。\n\n    *   **分段线性重构：** 在每个网格 $i$ 内部，解被重构为线性函数：\n        $$\n        p_i(x) = c_i + \\frac{\\sigma_i}{\\Delta x} (x - x_i)\n        $$\n        其中 $x_i$ 是网格中心，$\\sigma_i$ 是斜率（表示为网格上的浓度差）。那么，网格界面 $x_{i \\pm 1/2}$ 处的值为：\n        $$\n        c_{i-1/2, R} = c_i - \\frac{\\sigma_i}{2}, \\quad c_{i+1/2, L} = c_i + \\frac{\\sigma_i}{2}\n        $$\n\n    *   **斜率限制 (minmod)：** 为防止伪振荡，斜率 $\\sigma_i$ 受到限制。它通过将 minmod 函数应用于向前和向后差分来计算：\n        $$\n        \\sigma_i^{\\text{orig}} = \\text{minmod}(c_{i+1} - c_i, c_i - c_{i-1})\n        $$\n        其中 minmod 函数定义为：\n        $$\n        \\text{minmod}(a, b) = \\begin{cases} \\text{sgn}(a) \\min(|a|, |b|)   \\text{if } ab  0 \\\\ 0   \\text{otherwise} \\end{cases}\n        $$\n        使用周期性边界条件来查找网格 $i=0$ 和 $i=N-1$ 的相邻值。\n\n    *   **保正性斜率缩放：** 为确保重构的界面值为非负，原始斜率 $\\sigma_i^{\\text{orig}}$ 会乘以一个因子 $\\theta_i \\in [0, 1]$。我们要求每当 $c_i \\ge 0$ 时，$c_i \\pm \\sigma_i/2 \\ge 0$。这等价于 $|\\sigma_i| \\le 2c_i$。缩放后的斜率是 $\\sigma_i = \\theta_i \\sigma_i^{\\text{orig}}$，其中选择缩放因子 $\\theta_i$ 在满足约束条件下的最大值：\n        $$\n        \\theta_i = \\min\\left(1, \\frac{2c_i}{|\\sigma_i^{\\text{orig}}|}\\right)\n        $$\n        仅当 $|\\sigma_i^{\\text{orig}}|  0$ 且 $c_i \\ge 0$ 时才应用此缩放。\n\n    *   **迎风通量：** 数值通量是在重构的界面状态处计算的迎风通量。\n        $$\n        F_{i+1/2} = u^+ c_{i+1/2, L} + u^- c_{i+1/2, R}\n        $$\n        其中 $u^+ = \\max(u, 0)$，$u^- = \\min(u, 0)$。请注意，$c_{i+1/2, R}$ 是根据网格 $i+1$ 中的数据计算得出的。\n\n    *   **SSPRK2 时间积分：** 该半离散系统使用二阶强稳定性保持 Runge-Kutta (SSPRK2) 方法进行时间推进。将半离散系统的右端项表示为 $\\mathcal{A}(c)_i$，在 $\\Delta t$ 时间内的更新从 $c^{\\text{in}}$ 到 $c^{\\text{out}}$ 如下：\n        $$\n        \\begin{aligned}\n        c^* = c^{\\text{in}} + \\Delta t \\, \\mathcal{A}(c^{\\text{in}}) \\\\\n        c^{\\text{out}} = \\frac{1}{2}c^{\\text{in}} + \\frac{1}{2}\\left(c^* + \\Delta t \\, \\mathcal{A}(c^*)\\right)\n        \\end{aligned}\n        $$\n        在 CFL 条件 $|u|\\Delta t / \\Delta x \\le 1/2$ 下，该方法对平流方程是保正的。指定的 CFL 约束 $0.45$ 满足此条件。\n\n3.  **平衡态保持**\n    该格式必须保持恒定平衡态，即如果对所有 $i$ 都有 $c_i^n = c_{\\mathrm{eq}}$，那么 $c_i^{n+1} = c_{\\mathrm{eq}}$。\n    *   **第一源项步：** 输入 $c_i^{\\text{in}} = c_{\\mathrm{eq}}$，更新后得到 $c_i^{\\text{out}} = \\frac{c_{\\mathrm{eq}} + k(\\Delta t/2)c_{\\mathrm{eq}}}{1 + k(\\Delta t/2)} = c_{\\mathrm{eq}}$。\n    *   **平流步：** 输入为常数场 $c_i = c_{\\mathrm{eq}}$。向前和向后差分均为零，因此 minmod 限制器产生零斜率，即 $\\sigma_i=0$。重构是平坦的，$p_i(x) = c_{\\mathrm{eq}}$。界面通量均为 $F_{i\\pm 1/2} = u c_{\\mathrm{eq}}$。右端项 (RHS) 为 $\\mathcal{A}(c)_i = -\\frac{1}{\\Delta x}(u c_{\\mathrm{eq}} - u c_{\\mathrm{eq}}) = 0$。当 SSPRK2 方法应用于零右端项时，解不会发生变化。\n    *   **第二源项步：** 与第一步类似，此步也保持常数状态 $c_{\\mathrm{eq}}$。\n    因此，整个 Strang 分裂格式被证明能精确地保持恒定平衡态。\n\n这些组件的组合提供了一个完整的数值方法，满足了问题陈述的所有要求。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the specified test cases and print the results.\n    \"\"\"\n\n    def minmod(a, b):\n        \"\"\"\n        Element-wise minmod function for two numpy arrays.\n        \"\"\"\n        out = np.zeros_like(a, dtype=float)\n        mask = (a * b) > 0\n        signs = np.sign(a)\n        out[mask] = signs[mask] * np.minimum(np.abs(a[mask]), np.abs(b[mask]))\n        return out\n\n    def calculate_rhs_adv(c, u, dx):\n        \"\"\"\n        Calculates the right-hand side of the semi-discrete advection equation\n        using a positivity-preserving MUSCL scheme with a minmod limiter.\n        \"\"\"\n        # Periodic boundary conditions for neighbors\n        c_im1 = np.roll(c, 1)\n        c_ip1 = np.roll(c, -1)\n\n        # 1. Slope calculation with minmod limiter\n        delta_plus = c_ip1 - c\n        delta_minus = c - c_im1\n        slopes_orig = minmod(delta_plus, delta_minus)\n\n        # 2. Positivity-preserving slope scaling\n        slopes = np.copy(slopes_orig)\n        abs_slopes = np.abs(slopes_orig)\n        # Avoid division by zero or scaling very small numbers\n        mask = (c > 1e-15)  (abs_slopes > 1e-15)\n        \n        if np.any(mask):\n            theta = np.minimum(1.0, 2.0 * c[mask] / abs_slopes[mask])\n            slopes[mask] *= theta\n            \n        # Ensure slopes for cells with c=0 are zero\n        slopes[c = 1e-15] = 0.0\n\n        # 3. Reconstruction at interfaces\n        # c_L[i] is the left state at interface i+1/2 (from cell i)\n        # c_R[i] is the right state at interface i-1/2 (from cell i)\n        c_L = c + slopes / 2.0\n        c_R = c - slopes / 2.0\n\n        # 4. Upwind flux calculation\n        u_plus = max(u, 0.0)\n        u_minus = min(u, 0.0)\n        \n        # c_R_ip1 is the right state at interface i+1/2 (from cell i+1)\n        c_R_ip1 = np.roll(c_R, -1)\n        fluxes = u_plus * c_L + u_minus * c_R_ip1\n\n        # 5. Divergence calculation\n        fluxes_im12 = np.roll(fluxes, 1)\n        rhs = -(fluxes - fluxes_im12) / dx\n        return rhs\n\n    def advection_step(c_in, dt, u, dx):\n        \"\"\"\n        Performs one full advection step over dt using SSPRK2.\n        \"\"\"\n        # SSPRK2 Stage 1\n        rhs1 = calculate_rhs_adv(c_in, u, dx)\n        c_star = c_in + dt * rhs1\n\n        # SSPRK2 Stage 2\n        rhs2 = calculate_rhs_adv(c_star, u, dx)\n        c_out = 0.5 * c_in + 0.5 * (c_star + dt * rhs2)\n        \n        # Enforce positivity due to potential floating point errors\n        c_out[c_out  0] = 0.0\n        return c_out\n\n    def source_step(c_in, dt_source, k, c_eq):\n        \"\"\"\n        Performs one implicit source step over dt_source using backward Euler.\n        \"\"\"\n        c_out = (c_in + k * dt_source * c_eq) / (1.0 + k * dt_source)\n        return c_out\n\n    def strang_split_step(c_n, dt, u, dx, k, c_eq):\n        \"\"\"\n        Performs one full time step using Strang splitting.\n        \"\"\"\n        # Half step for the source term\n        c_1 = source_step(c_n, dt / 2.0, k, c_eq)\n        # Full step for the advection term\n        c_2 = advection_step(c_1, dt, u, dx)\n        # Another half step for the source term\n        c_np1 = source_step(c_2, dt / 2.0, k, c_eq)\n        return c_np1\n\n    def run_simulation(params):\n        \"\"\"\n        Runs a simulation for a given set of parameters.\n        \"\"\"\n        L = params['L']\n        N = params['N']\n        u = params['u']\n        k = params['k']\n        c_eq = params['c_eq']\n        T = params['T']\n        ic_func = params['ic_func']\n        output_metric = params['output_metric']\n        CFL = 0.45\n\n        # Spatial grid\n        dx = L / N\n        x = np.linspace(0, L, N, endpoint=False) + dx / 2.0\n\n        # Time stepping\n        if abs(u) > 1e-12:\n            dt = CFL * dx / abs(u)\n        else: # If u is zero, advection step is trivial. Set a reasonable dt.\n            dt = T / 10.0 \n\n        # Initial condition\n        c = ic_func(x, L, c_eq)\n\n        # Main time loop\n        t = 0.0\n        while t  T:\n            dt_actual = min(dt, T - t)\n            c = strang_split_step(c, dt_actual, u, dx, k, c_eq)\n            t += dt_actual\n        \n        # Post-processing to get the required output\n        if output_metric == 'min':\n            return np.min(c)\n        elif output_metric == 'max_abs_err':\n            return np.max(np.abs(c - c_eq))\n        \n        return None\n\n\n    test_cases = [\n        {\n            'L': 1.0, 'N': 200, 'u': 0.5, 'k': 1000.0, 'c_eq': 1.0, 'T': 0.1,\n            'ic_func': lambda x, L, c_eq: 0.5 + 0.5 * np.sin(2 * np.pi * x / L),\n            'output_metric': 'min'\n        },\n        {\n            'L': 1.0, 'N': 100, 'u': 1.0, 'k': 1e6, 'c_eq': 0.3, 'T': 0.05,\n            'ic_func': lambda x, L, c_eq: np.full_like(x, c_eq),\n            'output_metric': 'max_abs_err'\n        },\n        {\n            'L': 1.0, 'N': 200, 'u': 0.2, 'k': 500.0, 'c_eq': 0.0, 'T': 0.05,\n            'ic_func': lambda x, L, c_eq: 1e-12 + 1e-3 * np.exp(-((x - 0.5 * L)**2) / ((0.05 * L)**2)),\n            'output_metric': 'min'\n        },\n        {\n            'L': 1.0, 'N': 150, 'u': 2.0, 'k': 1000.0, 'c_eq': 0.5, 'T': 0.02,\n            'ic_func': lambda x, L, c_eq: np.maximum(0.0, 1.0 - 2.0 * np.abs(x / L - 0.5)),\n            'output_metric': 'min'\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        result = run_simulation(params)\n        results.append(result)\n\n    print(f\"[{','.join(f'{r:.15g}' for r in results)}]\")\n\nsolve()\n```", "id": "3616608"}]}