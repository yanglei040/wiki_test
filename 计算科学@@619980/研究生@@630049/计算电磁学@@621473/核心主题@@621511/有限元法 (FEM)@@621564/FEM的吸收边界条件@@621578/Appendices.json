{"hands_on_practices": [{"introduction": "任何实践都始于基础。在本练习中，我们将从第一性原理出发，推导最简单的一阶吸收边界条件（ABC），并计算其在平面波以任意角度入射时的反射系数。这个练习将揭示局部吸收边界条件固有的角度依赖性误差，这是理解和应用这些数值技术时必须掌握的核心概念。通过这个计算，您将亲身体会到为什么简单的吸收边界条件在处理斜入射波时会失效 [@problem_id:3287162]。", "problem": "考虑一个均匀、无源、各向同性的介质，其折射率恒定。设时谐标量场 $u$ 在二维半空间域 $\\Omega = \\{ (x,y) \\in \\mathbb{R}^{2} : x  0 \\}$ 中满足标量亥姆霍兹方程 $\\Delta u + k^{2} u = 0$，其中 $k > 0$ 是实波数，时间依赖关系为 $\\exp(-i \\omega t)$。人工边界 $\\Gamma$ 是平面 $\\{ x = 0 \\}$，其单位外法线向量为 $\\boldsymbol{n} = (1,0)$。在对无界域进行有限元方法 (FEM) 截断时，必须在 $\\Gamma$ 上施加吸收边界条件 (ABC) 以抑制伪反射。\n\n从标量亥姆霍兹方程和 $\\Gamma$ 附近的局部平面波分析出发，利用 $\\Delta$ 的法向-切向分解以及切向导数的傅里叶符号，得到 Dirichlet-to-Neumann 映射的一个单向（出射）近似。基于此近似，推导施加在 $\\Gamma$ 上的一阶边界算子，使其能够强制沿 $\\boldsymbol{n}$ 方向的局部出射行为，并证明当该算子作用于一个精确沿 $\\Gamma$ 法向传播的平面波时，它会简化为一个能够湮灭该出射平面波的 Robin 型条件。\n\n现在，设一个入射平面波 $u_{\\mathrm{inc}}(\\boldsymbol{x}) = \\exp\\!\\big(i k \\,\\boldsymbol{d} \\cdot \\boldsymbol{x}\\big)$ 从 $\\Omega$ 内部入射到 $\\Gamma$ 上，其单位传播方向为 $\\boldsymbol{d}$。入射角 $\\theta \\in [0,\\pi/2)$ 由 $\\boldsymbol{d} \\cdot \\boldsymbol{n} = \\cos\\theta$ 定义，且 $\\theta$ 以弧度为单位。当推导的一阶 ABC 施加在 $\\Gamma$ 上时，会在 $\\Omega$ 中产生一个镜面反射平面波 $u_{\\mathrm{ref}}(\\boldsymbol{x}) = R(\\theta)\\,\\exp\\!\\big(i k \\,\\boldsymbol{d}_{r} \\cdot \\boldsymbol{x}\\big)$，其中 $\\boldsymbol{d}_{r}$ 是 $\\boldsymbol{d}$ 关于 $\\Gamma$ 的反射（其切向分量不变，法向分量反向）。将角度依赖的误差定义为复反射振幅 $R(\\theta)$，即反射波与入射波的振幅之比。\n\n推导 $R(\\theta)$ 关于 $\\theta$ 和 $k$ 的闭式解析表达式，并将最终答案表示为单个符号表达式。无需进行数值计算。", "solution": "问题陈述已经过验证，被认为是一个在计算电磁学领域中良定的、有科学依据的问题。\n\n该问题要求推导二维半空间中标量亥姆霍兹方程的一阶吸收边界条件 (ABC)，然后利用此 ABC 求出入射平面波的反射系数。\n\n控制方程是时谐场 $u$ 的标量亥姆霍兹方程，其时间依赖关系为 $\\exp(-i\\omega t)$：\n$$\n\\Delta u + k^{2} u = 0\n$$\n域是半空间 $\\Omega = \\{ (x,y) \\in \\mathbb{R}^{2} : x  0 \\}$，人工边界 $\\Gamma$ 位于 $x=0$ 处。单位外法线向量为 $\\boldsymbol{n}=(1,0)$，指向计算域外部。\n\n首先，我们推导一阶 ABC。吸收边界条件必须只允许波从计算域 $\\Omega$ 中传出。在这种几何结构中，“出射”意味着沿单位外法线方向传播，即正 $x$ 方向。\n\n我们将拉普拉斯算子 $\\Delta$ 分解为相对于边界 $\\Gamma$ 的法向和切向分量：\n$$\n\\Delta = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}\n$$\n将其代入亥姆霍兹方程，得到：\n$$\n\\frac{\\partial^2 u}{\\partial x^2} + \\frac{\\partial^2 u}{\\partial y^2} + k^{2} u = 0\n$$\n我们可以重新整理此式，以分离出法向导数项：\n$$\n\\frac{\\partial^2 u}{\\partial x^2} = - \\left( \\frac{\\partial^2}{\\partial y^2} + k^2 \\right) u\n$$\n这是一个算子方程。为了创建一个单向波动方程，我们试图将这个二阶算子“分解”为两个一阶算子，分别对应于在 $+x$ 和 $-x$ 方向上传播的波。我们可以通过在切向方向 $y$ 上使用傅里叶变换来形式上实现这一点。设 $k_y$ 为切向波数。在傅里叶域中，算子 $\\frac{\\partial}{\\partial y}$ 变换为乘以 $ik_y$，而 $\\frac{\\partial^2}{\\partial y^2}$ 变换为乘以 $-k_y^2$。方程变为：\n$$\n\\frac{\\partial^2 \\hat{u}}{\\partial x^2} = - \\left( -k_y^2 + k^2 \\right) \\hat{u}\n$$\n其中 $\\hat{u}(x, k_y)$ 是 $u(x,y)$ 关于 $y$ 的傅里叶变换。令 $k_x = \\sqrt{k^2 - k_y^2}$。方程现在是 $\\frac{\\partial^2 \\hat{u}}{\\partial x^2} + k_x^2 \\hat{u} = 0$。\n通解为 $\\hat{u}(x, k_y) = A \\exp(i k_x x) + B \\exp(-i k_x x)$。\n项 $\\exp(i k_x x)$ 表示在 $+x$ 方向上传播的波（出射），而 $\\exp(-i k_x x)$ 表示在 $-x$ 方向上传播的波（入射）。为了吸收出射波，我们必须施加一个边界条件，该条件能被解的出射波部分满足。对于出射波，我们有 $\\hat{u}(x, k_y) \\propto \\exp(i k_x x)$。对 $x$ 求导得到：\n$$\n\\frac{\\partial \\hat{u}}{\\partial x} = i k_x \\hat{u} = i \\sqrt{k^2 - k_y^2} \\hat{u}\n$$\n这是出射波的精确 Dirichlet-to-Neumann (DtN) 映射。为了将其变换回空间域，我们将 $ik_y$ 替换为 $\\frac{\\partial}{\\partial y}$，因此 $-k_y^2$ 被替换为 $\\frac{\\partial^2}{\\partial y^2}$。由于 $\\frac{\\partial}{\\partial n} = \\frac{\\partial}{\\partial x}$，精确的 ABC 由伪微分算子方程给出：\n$$\n\\frac{\\partial u}{\\partial n} = i \\sqrt{k^2 + \\frac{\\partial^2}{\\partial y^2}} u\n$$\n该算子是非局部的。一阶局部 ABC 是通过对几乎沿边界法向传播的波近似平方根得到的。对于近法向传播，切向波数 $k_y$ 与 $k$ 相比很小。我们可以使用平方根项的泰勒级数展开：\n$$\n\\sqrt{k^2 - k_y^2} = k \\sqrt{1 - \\frac{k_y^2}{k^2}} \\approx k \\left(1 - \\frac{1}{2}\\frac{k_y^2}{k^2} + \\dots \\right)\n$$\n一阶（或最低阶）近似只取第一项，$\\sqrt{k^2 - k_y^2} \\approx k$。将此代入精确的 DtN 映射中得到：\n$$\n\\frac{\\partial \\hat{u}}{\\partial x} \\approx i k \\hat{u}\n$$\n变换回空间域，得到一阶局部 ABC：\n$$\n\\frac{\\partial u}{\\partial n} - i k u = 0 \\quad \\text{on } \\Gamma\n$$\n这是一个 Robin 型边界条件。对于一个精确沿 $\\Gamma$ 法向传播的出射平面波 $u(x,y) = A\\exp(ikx)$，我们有 $k_y=0$。法向导数为 $\\frac{\\partial u}{\\partial n} = \\frac{\\partial u}{\\partial x} = ikA\\exp(ikx) = iku$。应用 ABC 算子得到 $(\\frac{\\partial}{\\partial n} - ik)u = iku - iku = 0$。因此，该 ABC 完全湮灭了法向出射的平面波。\n\n接下来，我们推导反射系数 $R(\\theta)$。入射波是 $u_{\\mathrm{inc}}(\\boldsymbol{x}) = \\exp(i k \\boldsymbol{d} \\cdot \\boldsymbol{x})$。它从 $\\Omega$ 内部（其中 $x0$）向 $\\Gamma$ 传播。其传播方向 $\\boldsymbol{d}$ 必须有一个正的 $x$ 分量。给定 $\\boldsymbol{d} \\cdot \\boldsymbol{n} = \\cos\\theta$ 且 $\\boldsymbol{n}=(1,0)$，我们有 $d_x = \\cos\\theta$。由于 $\\boldsymbol{d}$ 是一个单位向量，所以 $d_y = \\sin\\theta$（我们可以不失一般性地选择符号）。因此，$\\boldsymbol{d} = (\\cos\\theta, \\sin\\theta)$。\n入射波为：\n$$\nu_{\\mathrm{inc}}(x,y) = \\exp\\!\\big(ik(x\\cos\\theta + y\\sin\\theta)\\big)\n$$\n反射波为 $u_{\\mathrm{ref}}(\\boldsymbol{x}) = R(\\theta)\\exp(i k \\boldsymbol{d}_r \\cdot \\boldsymbol{x})$。反射方向 $\\boldsymbol{d}_r$ 的法向分量反向，切向分量不变：$\\boldsymbol{d}_r = (-\\cos\\theta, \\sin\\theta)$。\n反射波为：\n$$\nu_{\\mathrm{ref}}(x,y) = R(\\theta)\\exp\\!\\big(ik(-x\\cos\\theta + y\\sin\\theta)\\big)\n$$\n边界附近的总场为 $u = u_{\\mathrm{inc}} + u_{\\mathrm{ref}}$。\n我们在边界 $x=0$ 处对总场施加推导的一阶 ABC，即 $\\frac{\\partial u}{\\partial x} - iku = 0$。\n\n首先，计算 $u$ 及其法向导数 $\\frac{\\partial u}{\\partial x}$ 在 $x=0$ 处的值：\n$$\nu(0,y) = \\exp\\!\\big(ik(y\\sin\\theta)\\big) + R(\\theta)\\exp\\!\\big(ik(y\\sin\\theta)\\big) = \\big(1+R(\\theta)\\big)\\exp\\!\\big(iky\\sin\\theta\\big)\n$$\n对 $x$ 的导数为：\n$$\n\\frac{\\partial u}{\\partial x} = ik\\cos\\theta \\exp\\!\\big(ik(x\\cos\\theta + y\\sin\\theta)\\big) + R(\\theta)(-ik\\cos\\theta)\\exp\\!\\big(ik(-x\\cos\\theta + y\\sin\\theta)\\big)\n$$\n在 $x=0$ 处计算：\n$$\n\\frac{\\partial u}{\\partial x}(0,y) = ik\\cos\\theta \\exp\\!\\big(iky\\sin\\theta\\big) - ik\\cos\\theta R(\\theta)\\exp\\!\\big(iky\\sin\\theta\\big) = ik\\cos\\theta\\big(1-R(\\theta)\\big)\\exp\\!\\big(iky\\sin\\theta\\big)\n$$\n现在，将这些表达式代入 ABC 方程中：\n$$\nik\\cos\\theta\\big(1-R(\\theta)\\big)\\exp\\!\\big(iky\\sin\\theta\\big) - ik\\big(1+R(\\theta)\\big)\\exp\\!\\big(iky\\sin\\theta\\big) = 0\n$$\n由于 $k>0$，项 $ik$ 和 $\\exp(iky\\sin\\theta)$ 非零，可以消去。这留下一个关于 $R(\\theta)$ 的代数方程：\n$$\n\\cos\\theta\\big(1-R(\\theta)\\big) - \\big(1+R(\\theta)\\big) = 0\n$$\n$$\n\\cos\\theta - R(\\theta)\\cos\\theta - 1 - R(\\theta) = 0\n$$\n现在，我们求解 $R(\\theta)$：\n$$\n\\cos\\theta - 1 = R(\\theta) + R(\\theta)\\cos\\theta\n$$\n$$\n\\cos\\theta - 1 = R(\\theta) (1 + \\cos\\theta)\n$$\n$$\nR(\\theta) = \\frac{\\cos\\theta - 1}{1 + \\cos\\theta}\n$$\n这是反射系数 $R(\\theta)$ 的闭式解析表达式。该结果与波数 $k$ 无关，这是一阶近似的一个特性。对于法向入射（$\\theta=0$），$R(0) = \\frac{1-1}{1+1} = 0$，证实了完美吸收。对于掠射（$\\theta \\to \\pi/2$），$R(\\theta) \\to \\frac{0-1}{1+0} = -1$，表示全反射。", "answer": "$$\n\\boxed{\\frac{\\cos\\theta - 1}{\\cos\\theta + 1}}\n$$", "id": "3287162"}, {"introduction": "在实际的有限元仿真中，我们通常使用曲面（如球面）来截断无限大的计算区域。此练习旨在解决一个关键问题：当我们将为平面推导的吸收边界条件应用于曲面边界时，会引入多大的误差？通过分析一个出射球面波与球面边界的相互作用，我们将量化这种由几何曲率引起的误差 [@problem_id:3287140]。这有助于我们建立关于局部吸收边界条件局限性的直观认识，并理解边界曲率半径与波长之比的重要性。", "problem": "考虑一个在均匀、各向同性、无源的外部区域中的时谐电磁散射问题，其角频率为 $\\omega$，波数为 $k = \\omega \\sqrt{\\mu \\epsilon}$，其中 $\\mu$ 是磁导率，$\\epsilon$ 是电容率。一个基于有限元法 (FEM) 的数值求解器用一个以原点为中心、半径为 $R$ 的球形人工边界来截断无界域。为了消除在这个截断边界上的反射，在球形边界 $r = R$ 上施加了一个一阶平面吸收边界条件 (ABC)，该条件对于局部平面出射波是合理的。\n\n假设在所有散射体外部，电场或磁场的任何笛卡尔分量的主导远场行为都由标量亥姆霍兹方程控制，并且可以很好地近似为一个球对称出射解。令 $u(r)$ 表示这样一个标量场分量的代表，它在外部区域满足标量亥姆霍兹方程 $(\\nabla^{2} + k^{2}) u = 0$，并且是渐近出射的。\n\n定义在 $r = R$ 处，由于在球形边界上施加一阶平面 ABC 而引起的无量纲边界算子失配为\n$$\n\\varepsilon(kR) \\equiv \\left|\\frac{\\left.\\frac{\\partial u}{\\partial r} - i k\\, u\\right|_{r=R}}{i k\\, u(R)}\\right|.\n$$\n从控制方程和出射球面波的远场形式出发，推导当 $kR \\to \\infty$ 时 $\\varepsilon(kR)$ 的主阶表达式，并用 $1/(kR)$ 表示你的最终结果。最终答案必须是单一的闭式解析表达式。误差度量 $\\varepsilon(kR)$ 是无量纲的，不需要物理单位。", "solution": "该问题要求量化当一个为平面波设计的一阶吸收边界条件（ABC）被应用于球形边界上的球对称出射波时所产生的误差。\n\n**1. 确定出射球面波的形式**\n\n标量场 $u(r)$ 满足球对称的亥姆霍兹方程：\n$$\n\\frac{d^{2} u}{d r^{2}} + \\frac{2}{r} \\frac{d u}{d r} + k^{2} u = 0\n$$\n该方程的通解是入射球面波和出射球面波的线性组合。由于问题指定 $u(r)$ 是一个出射解（物理上对应于能量从原点向外辐射），我们只取解的出射部分：\n$$\nu(r) = C \\frac{e^{ikr}}{r}\n$$\n其中 $C$ 是一个复常数。\n\n**2. 计算场的径向导数**\n\n接下来，我们计算 $u(r)$ 对径向坐标 $r$ 的导数：\n$$\n\\frac{du}{dr} = \\frac{d}{dr} \\left( C \\frac{e^{ikr}}{r} \\right) = C \\left( \\frac{ik e^{ikr}}{r} - \\frac{e^{ikr}}{r^2} \\right)\n$$\n将 $u(r)$ 代回上式，我们可以将导数表示为 $u(r)$ 的函数：\n$$\n\\frac{du}{dr} = \\left( ik - \\frac{1}{r} \\right) C \\frac{e^{ikr}}{r} = \\left( ik - \\frac{1}{r} \\right) u(r)\n$$\n\n**3. 代入误差度量公式**\n\n问题定义了边界算子失配（误差）$\\varepsilon(kR)$ 为：\n$$\n\\varepsilon(kR) \\equiv \\left|\\frac{\\left.\\frac{\\partial u}{\\partial r} - i k\\, u\\right|_{r=R}}{i k\\, u(R)}\\right|\n$$\n一阶平面ABC算子是 $(\\frac{\\partial}{\\partial r} - ik)$。我们将上面推导的 $\\frac{du}{dr}$ 的表达式代入误差公式的分子中，并在 $r=R$ 处进行计算：\n$$\n\\left.\\frac{\\partial u}{\\partial r} - i k\\, u\\right|_{r=R} = \\left( ik - \\frac{1}{R} \\right) u(R) - i k u(R) = -\\frac{1}{R} u(R)\n$$\n现在，将这个结果代回完整的 $\\varepsilon(kR)$ 表达式中：\n$$\n\\varepsilon(kR) = \\left| \\frac{-\\frac{1}{R} u(R)}{i k u(R)} \\right|\n$$\n由于 $u(R)$ 不为零，我们可以消去它：\n$$\n\\varepsilon(kR) = \\left| \\frac{-1/R}{ik} \\right| = \\left| \\frac{i}{kR} \\right|\n$$\n取绝对值后得到：\n$$\n\\varepsilon(kR) = \\frac{1}{kR}\n$$\n这个结果即为所求的 $\\varepsilon(kR)$ 的表达式。它表明，当一阶平面ABC应用于曲率为 $1/R$ 的球形边界时，其相对误差与无量纲参数 $kR$ 成反比。当边界半径远大于波长时（即 $kR \\to \\infty$），误差趋于零，这与我们的物理直觉相符。", "answer": "$$\n\\boxed{\\frac{1}{kR}}\n$$", "id": "3287140"}, {"introduction": "从理论分析转向编程实践，最后的这个练习将指导您在有限元方法（FEM）框架内完成吸收边界条件的数值实现。您的任务是构建代表吸收边界条件的“边界质量矩阵”，这是将连续的弱形式方程转化为离散线性系统的关键一步。这项动手编程任务涉及处理实际的几何形状（三角形面元）、使用专业的矢量基函数（Nédélec 边元）以及应用数值积分（求积）[@problem_id:3287119]，它将完美地连接起理论公式与最终的计算程序。", "problem": "给定任务是，在使用一阶 Nédélec 边元进行计算电磁学的有限元方法 (FEM) 中，于一阶吸收边界条件下，推导、实现并数值计算与三角形边界面上的切向电场相关的局部边界质量矩阵。推导必须从时谐麦克斯韦方程组和物理上一致的一阶吸收边界模型开始；实现必须遵循 Nédélec 基的协变性质，并在每个三角形面上组装适当的切向贡献。计算任务是通过数值积分计算局部面质量矩阵的项，而不依赖预先计算的单元矩阵，仅使用面的形状和定义的表面导纳。\n\n从时谐麦克斯韦方程组开始，其相量遵循 $e^{j \\omega t}$ 的符号约定，在一个均匀、各向同性、无源的域 $\\Omega \\subset \\mathbb{R}^3$ 中，其边界为 $\\partial \\Omega$：\n$$\n\\nabla \\times \\mathbf{E} = - j \\omega \\mu \\mathbf{H}, \\quad \\nabla \\times \\mathbf{H} = j \\omega \\varepsilon \\mathbf{E}.\n$$\n考虑电场的旋度-旋度公式，其标准弱形式通过乘以一个测试函数 $\\mathbf{v}$ 并在 $\\Omega$ 上进行分部积分得到。在边界的吸收部分，将外部的物理辐射条件替换为从均匀外部介质中的 Silver-Müller 辐射条件获得的一阶阻抗边界条件，模型化为：\n$$\n\\mathbf{n} \\times \\mathbf{H} = - Y_s \\mathbf{E}_t,\n$$\n其中 $\\mathbf{n}$ 是指向 $\\partial \\Omega$ 外部的单位法向量，$\\mathbf{E}_t = \\mathbf{E} - (\\mathbf{E}\\cdot \\mathbf{n}) \\mathbf{n}$ 是 $\\mathbf{E}$ 的切向分量，而 $Y_s$ 是与外部介质相关的表面导纳（单位：西门子）。推导弱形式的边界贡献，该贡献产生一个边界双线性项，此项是由 $Y_s$ 缩放的切向电场分量的表面 $L^2$ 内积，并从第一性原理出发，论证为何此项是矫顽的并代表被动能量吸收。\n\n设三角形边界单元 $f$ 上的场近似使用三角形上的一阶第一族 Nédélec（边）元，其基函数为与边相关的 $\\{\\mathbf{N}_1, \\mathbf{N}_2, \\mathbf{N}_3\\}$。在一个具有重心坐标 $(\\lambda_1, \\lambda_2, \\lambda_3)$ 和面内常数梯度 $\\{\\nabla \\lambda_i\\}_{i=1}^3$ 的三角形上，分别与顶点 $(1)$、$(2)$、$(3)$ 相对的边相关联的规范一阶 Nédélec 基函数（三角形上的第一族）为：\n$$\n\\mathbf{N}_1 = \\lambda_2 \\nabla \\lambda_3 - \\lambda_3 \\nabla \\lambda_2, \\quad\n\\mathbf{N}_2 = \\lambda_3 \\nabla \\lambda_1 - \\lambda_1 \\nabla \\lambda_3, \\quad\n\\mathbf{N}_3 = \\lambda_1 \\nabla \\lambda_2 - \\lambda_2 \\nabla \\lambda_1.\n$$\n解释如何通过几何迹和投影 $\\mathbf{P}_t = \\mathbf{I} - \\mathbf{n} \\mathbf{n}^\\top$ 在面上强制执行切向分量，以及为什么对于这些基于面的基函数，切向投影使其保持不变。面 $f$ 上的局部边界质量矩阵项由下式给出：\n$$\nM^{(f)}_{ij} = \\int_{f} Y_s \\, \\mathbf{N}_i \\cdot \\mathbf{N}_j \\, \\mathrm{d}s,\n$$\n其中点积在面切平面中计算。详细说明如何使用足以精确积分最高二次多项式的对称求积法则来数值计算此积分，以及如何通过构建一个正交的平面内基底并求解仿射重心坐标梯度，来为嵌入在 $\\mathbb{R}^3$ 中的任意三角形面一致地计算 $\\nabla \\lambda_i$。\n\n您的程序必须为每个三角形面实现以下步骤：\n- 为具有顶点 $\\mathbf{v}_1, \\mathbf{v}_2, \\mathbf{v}_3 \\in \\mathbb{R}^3$ 的面的切平面构建一个正交基底 $\\{\\mathbf{e}_1, \\mathbf{e}_2\\}$，并通过将 $\\mathbf{v}_k$ 映射到 $(x_k, y_k)$（其中 $(x_1,y_1) = (0,0)$，$(x_2, y_2)$ 与 $\\mathbf{e}_1$ 对齐，而 $(x_3,y_3)$ 通过投影到 $\\mathbf{e}_1, \\mathbf{e}_2$ 上获得），从而在局部坐标 $(x,y)$ 中表示该面。\n- 通过强制执行 $\\lambda_i(\\mathbf{v}_j) = \\delta_{ij}$ (对于 $j \\in \\{1,2,3\\}$) 来求解仿射重心坐标函数 $\\lambda_i(x,y) = a_i x + b_i y + c_i$，并在局部 $(x,y)$ 平面中提取 $\\nabla \\lambda_i = [a_i, b_i]$。\n- 使用一个对称的3点求积法则，其重心坐标点为 $(\\lambda_1, \\lambda_2, \\lambda_3) \\in \\{(1/6, 1/6, 2/3), (1/6, 2/3, 1/6), (2/3, 1/6, 1/6)\\}$，权重等于 $A_f/3$（其中 $A_f$ 是面面积），来计算 $\\int_f Y_s \\, \\mathbf{N}_i \\cdot \\mathbf{N}_j \\, \\mathrm{d}s$。\n- 组装具有项 $M^{(f)}_{ij}$ 的局部 $3 \\times 3$ 矩阵 $M^{(f)}$。\n\n物理单位：将 $Y_s$ 的单位视为西门子 ($\\mathrm{S}$)。$M^{(f)}$ 的项必须以国际单位制 (SI) 报告。角度，如果在测试套件中用于构造旋转的三角形，必须以弧度表示。\n\n测试套件和输出规范：\n- 使用 $\\mathbb{R}^3$ 中的以下 4 个三角形面及其相关的表面导纳 $Y_s$：\n    1. 面 $f_1$：$\\mathbf{v}_1 = (0,0,0)$, $\\mathbf{v}_2 = (1,0,0)$, $\\mathbf{v}_3 = (0,1,0)$, $Y_s = 1.0$ $\\mathrm{S}$。\n    2. 面 $f_2$：一个在平面 $z=1$ 内绕 $z$ 轴旋转角度 $\\theta = \\pi/6$ 弧度的全等三角形，其顶点为 $\\mathbf{v}_1 = (0,0,1)$, $\\mathbf{v}_2 = (\\cos \\theta, \\sin \\theta, 1)$, $\\mathbf{v}_3 = (-\\sin \\theta, \\cos \\theta, 1)$, $Y_s = 2.0$ $\\mathrm{S}$。\n    3. 面 $f_3$：一个斜三角形，$\\mathbf{v}_1 = (0,0,0)$, $\\mathbf{v}_2 = (2,0,0)$, $\\mathbf{v}_3 = (0.3, 1.5, 0.2)$, $Y_s = 0.5$ $\\mathrm{S}$。\n    4. 面 $f_4$：一个测试近退化面积的小三角形，$\\mathbf{v}_1 = (0,0,0)$, $\\mathbf{v}_2 = (10^{-3}, 0, 0)$, $\\mathbf{v}_3 = (0, 10^{-3}, 0)$, $Y_s = 1.0$ $\\mathrm{S}$。\n- 您的程序必须为每个面计算局部边界质量矩阵 $M^{(f)}$，并以行主序展平其项后返回。\n- 最终输出格式：您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表形式的结果，其中每个面的结果本身也是一个用方括号括起来的逗号分隔列表。例如，输出必须类似于 $[\\,[m_{11},m_{12},\\dots,m_{33}],\\,[\\dots],\\,[\\dots],\\,[\\dots]\\,]$，所有项都以 SI 单位报告为无量纲数值。\n\n不允许外部输入。您的代码必须是一个在 Python 中使用已批准库的完整、可运行的程序，并且必须对给定的测试套件执行上述基于数值积分的组装。组装必须通过几何平面基底实现切向投影，并遵循本问题中陈述的 Nédélec 基定义，不得调用外部有限元软件包。", "solution": "该问题要求为一阶吸收边界条件（ABC）推导、实现并计算局部边界质量矩阵。下面是详细的理论推导和实现说明。\n\n### 理论推导\n\n**1. 弱形式与边界项**\n\n我们从时谐麦克斯韦方程组（时间因子为 $e^{j\\omega t}$）的电场旋度-旋度方程出发：\n$$\n\\nabla \\times (\\nabla \\times \\mathbf{E}) - k^2 \\mathbf{E} = \\mathbf{0}\n$$\n为推导其弱形式，我们将该方程与一个矢量测试函数 $\\mathbf{v}$ 做点积，并在计算域 $\\Omega$ 上积分。利用矢量恒等式和散度定理进行分部积分，得到：\n$$\n\\int_{\\Omega} (\\nabla \\times \\mathbf{E}) \\cdot (\\nabla \\times \\mathbf{v}) \\, \\mathrm{d}V - k^2 \\int_{\\Omega} \\mathbf{E} \\cdot \\mathbf{v} \\, \\mathrm{d}V - \\int_{\\partial \\Omega} (\\mathbf{n} \\times (\\nabla \\times \\mathbf{E})) \\cdot \\mathbf{v} \\, \\mathrm{d}s = 0\n$$\n边界积分项中的 $\\nabla \\times \\mathbf{E}$ 可以用麦克斯韦第一方程替换为 $-j \\omega \\mu \\mathbf{H}$：\n$$\n-\\int_{\\partial \\Omega} (\\mathbf{n} \\times (-j \\omega \\mu \\mathbf{H})) \\cdot \\mathbf{v} \\, \\mathrm{d}s = j \\omega \\mu \\int_{\\partial \\Omega} (\\mathbf{n} \\times \\mathbf{H}) \\cdot \\mathbf{v} \\, \\mathrm{d}s\n$$\n现在，我们施加一阶阻抗边界条件（ABC） $\\mathbf{n} \\times \\mathbf{H} = -Y_s \\mathbf{E}_t$，其中 $\\mathbf{E}_t$ 是电场的切向分量。代入后，边界项变为：\n$$\nj \\omega \\mu \\int_{\\partial \\Omega} (-Y_s \\mathbf{E}_t) \\cdot \\mathbf{v} \\, \\mathrm{d}s = -j \\omega \\mu \\int_{\\partial \\Omega} Y_s \\mathbf{E}_t \\cdot \\mathbf{v}_t \\, \\mathrm{d}s\n$$\n注意，由于 $\\mathbf{E}_t$ 是纯切向的，它与 $\\mathbf{v}$ 的点积等价于它与 $\\mathbf{v}$ 的切向分量 $\\mathbf{v}_t$ 的点积。将此项移回弱形式的左侧，得到最终的边界贡献双线性项：\n$$\nB(\\mathbf{E}, \\mathbf{v}) = j \\omega \\mu \\int_{\\partial \\Omega} Y_s \\mathbf{E}_t \\cdot \\mathbf{v}_t \\, \\mathrm{d}s\n$$\n在有限元离散化中，我们将电场 $\\mathbf{E}$ 展开为基函数 $\\mathbf{N}_j$ 的线性组合 $\\mathbf{E} \\approx \\sum_j e_j \\mathbf{N}_j$，并令测试函数 $\\mathbf{v}$ 为基函数 $\\mathbf{N}_i$。这样，边界项在系统矩阵中的贡献来自于一个局部边界质量矩阵 $M^{(f)}$，其元素为：\n$$\nM^{(f)}_{ij} = \\int_{f} Y_s \\, \\mathbf{N}_i \\cdot \\mathbf{N}_j \\, \\mathrm{d}s\n$$\n这里的积分是在边界上的单个三角面 $f$ 上进行的。\n\n**2. 物理意义与Nédélec基函数**\n\n该边界项代表能量流出计算域。离开边界的坡印廷矢量 $\\mathbf{S} = \\mathbf{E} \\times \\mathbf{H}^*$ 的法向分量为 $\\mathbf{S} \\cdot \\mathbf{n} = (\\mathbf{E} \\times \\mathbf{H}^*) \\cdot \\mathbf{n} = - (\\mathbf{n} \\times \\mathbf{E}) \\cdot \\mathbf{H}^* = \\mathbf{E}_t \\cdot (\\mathbf{n} \\times \\mathbf{H})^*$。代入ABC，得到 $\\mathbf{S} \\cdot \\mathbf{n} = \\mathbf{E}_t \\cdot (-Y_s \\mathbf{E}_t)^* = -Y_s^* |\\mathbf{E}_t|^2$。为保证能量向外流（吸收），时间平均功率流 $\\frac{1}{2}\\operatorname{Re}(\\mathbf{S} \\cdot \\mathbf{n})$ 必须为正，这意味着 $\\operatorname{Re}(-Y_s^*) \\geq 0$ 或 $\\operatorname{Re}(Y_s) \\geq 0$。如果 $Y_s$ 是正实数，那么 $B(\\mathbf{u}, \\mathbf{u})$ 正比于 $\\|\\mathbf{u}_t\\|_{L^2(\\partial\\Omega)}^2$，这保证了边界项是耗散的，有助于整个系统的矫顽性。\n\n一阶Nédélec边元（第一族）是为 $\\mathbf{H}(\\mathbf{curl})$ 空间量身定做的。其基函数 $\\mathbf{N}_i$ 是与三角形的边相关联的矢量场。根据定义 $\\mathbf{N}_i = \\lambda_j \\nabla \\lambda_k - \\lambda_k \\nabla \\lambda_j$，由于重心坐标的梯度 $\\nabla \\lambda_k$ 是位于三角形平面内的常数向量，所以 $\\mathbf{N}_i$ 本身就是完全位于该平面内的矢量。因此，它们的法向分量为零，切向投影 $\\mathbf{P}_t$ 不会改变它们，即 $(\\mathbf{N}_i)_t = \\mathbf{N}_i$。这使得在计算边界积分时可以直接使用 $\\mathbf{N}_i \\cdot \\mathbf{N}_j$ 而无需显式投影。\n\n### 数值实现\n\n为了在 $\\mathbb{R}^3$ 中的任意三角形上计算 $M^{(f)}_{ij}$，我们遵循问题中描述的步骤：\n1.  **建立局部坐标系**：为三角形创建一个局部二维坐标系。这通过将顶点 $\\mathbf{v}_1$ 置于原点，将边 $\\mathbf{v}_1\\mathbf{v}_2$ 与局部x轴对齐来实现。这简化了几何计算，并将三维积分问题转化为二维问题。\n2.  **计算重心梯度**：在建立的局部二维坐标系 $(x', y')$ 中，重心坐标 $\\lambda_i$ 是线性函数，其梯度 $\\nabla' \\lambda_i$ 是常数向量。这些梯度可以根据顶点的局部坐标和三角形面积 $A_f$ 解析计算。\n3.  **数值积分**：使用指定的3点对称求积法则来计算积分。该方法对最高二次多项式是精确的，而我们的被积函数 $\\mathbf{N}_i \\cdot \\mathbf{N}_j$ 正好是关于重心坐标的二次多项式。对于每个求积点，我们：\n    a.  获取其重心坐标 $(\\lambda_1, \\lambda_2, \\lambda_3)$。\n    b.  使用这些坐标和预先计算的梯度 $\\nabla' \\lambda_k$ 来评估基函数 $\\mathbf{N}_i$ 和 $\\mathbf{N}_j$ 的值。\n    c.  计算它们的点积。\n    d.  将结果乘以求积权重（$A_f/3$）和表面导纳 $Y_s$，并累加到相应的矩阵元素 $M^{(f)}_{ij}$ 中。\n\n这个过程为组装 $\\mathbb{R}^3$ 中任何非退化三角形面的边界质量矩阵提供了一种稳健且准确的方法。", "answer": "```python\nimport numpy as np\n\ndef compute_local_boundary_mass_matrix(v1, v2, v3, Ys):\n    \"\"\"\n    Computes the local boundary mass matrix for a triangular face using Nédélec elements.\n    \n    Args:\n        v1, v2, v3 (np.ndarray): 3D coordinates of the triangle vertices.\n        Ys (float): Surface admittance.\n\n    Returns:\n        np.ndarray: The 3x3 local boundary mass matrix M.\n    \"\"\"\n    # Step 1: Establish face geometry and local coordinate system\n    u1 = v2 - v1\n    u2 = v3 - v1\n\n    u1_norm = np.linalg.norm(u1)\n    if u1_norm  1e-15:\n        return np.zeros((3, 3)) # Degenerate triangle\n\n    e1 = u1 / u1_norm\n    u2_proj_e1 = np.dot(u2, e1)\n    u2_perp = u2 - u2_proj_e1 * e1\n    u2_perp_norm = np.linalg.norm(u2_perp)\n\n    if u2_perp_norm  1e-15:\n        return np.zeros((3, 3)) # Degenerate triangle\n\n    e2 = u2_perp / u2_perp_norm\n\n    # Area of the triangle\n    p1_loc = np.array([0., 0.])\n    p2_loc = np.array([u1_norm, 0.])\n    p3_loc = np.array([u2_proj_e1, u2_perp_norm])\n    Af = 0.5 * p2_loc[0] * p3_loc[1]\n    \n    if Af  1e-30:\n        return np.zeros((3,3))\n\n    # Step 2: Compute barycentric gradients in the local 2D system\n    inv_2Af = 1.0 / (2.0 * Af)\n    x1, y1 = p1_loc\n    x2, y2 = p2_loc\n    x3, y3 = p3_loc\n    \n    # Gradients of barycentric coordinates lambda_i\n    grad_lambda1 = inv_2Af * np.array([y2 - y3, x3 - x2])\n    grad_lambda2 = inv_2Af * np.array([y3 - y1, x1 - x3])\n    grad_lambda3 = inv_2Af * np.array([y1 - y2, x2 - x1])\n    \n    grads = [grad_lambda1, grad_lambda2, grad_lambda3]\n\n    # Step 3: Perform quadrature\n    # 3-point symmetric rule, exact for quadratic polynomials\n    quad_points_bary = [\n        np.array([1/6, 1/6, 2/3]),\n        np.array([1/6, 2/3, 1/6]),\n        np.array([2/3, 1/6, 1/6])\n    ]\n    quad_weight = Af / 3.0\n    \n    M = np.zeros((3, 3))\n\n    for lambdas in quad_points_bary:\n        l1, l2, l3 = lambdas\n        \n        # Evaluate Nédélec basis functions at the quadrature point\n        # N_i is associated with edge opposite to vertex i\n        N1 = l2 * grads[2] - l3 * grads[1]\n        N2 = l3 * grads[0] - l1 * grads[2]\n        N3 = l1 * grads[1] - l2 * grads[0]\n        \n        N_vectors = [N1, N2, N3]\n        \n        # Accumulate matrix entries\n        for i in range(3):\n            for j in range(3):\n                dot_product = np.dot(N_vectors[i], N_vectors[j])\n                M[i, j] += quad_weight * dot_product\n                \n    # Final matrix is scaled by surface admittance\n    M *= Ys\n    \n    return M\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    pi = np.pi\n    \n    test_cases = [\n        # Case 1: Standard right triangle\n        {'v1': np.array([0., 0., 0.]), 'v2': np.array([1., 0., 0.]), 'v3': np.array([0., 1., 0.]), 'Ys': 1.0},\n        # Case 2: Rotated congruent triangle\n        {'v1': np.array([0., 0., 1.]), \n         'v2': np.array([np.cos(pi/6), np.sin(pi/6), 1.]), \n         'v3': np.array([-np.sin(pi/6), np.cos(pi/6), 1.]), 'Ys': 2.0},\n        # Case 3: Skewed triangle\n        {'v1': np.array([0., 0., 0.]), 'v2': np.array([2., 0., 0.]), 'v3': np.array([0.3, 1.5, 0.2]), 'Ys': 0.5},\n        # Case 4: Small triangle (scaled version of case 1)\n        {'v1': np.array([0., 0., 0.]), 'v2': np.array([1e-3, 0., 0.]), 'v3': np.array([0., 1e-3, 0.]), 'Ys': 1.0},\n    ]\n\n    all_results = []\n    for case in test_cases:\n        M = compute_local_boundary_mass_matrix(case['v1'], case['v2'], case['v3'], case['Ys'])\n        # Flatten the matrix in row-major order and convert to list\n        flat_M = M.flatten().tolist()\n        all_results.append(flat_M)\n\n    # Format the final output string\n    result_str = \",\".join([f\"[{','.join(f'{x:.15e}' for x in res)}]\" for res in all_results])\n    \n    print(f\"[{result_str}]\")\n\nsolve()\n\n```", "id": "3287119"}]}