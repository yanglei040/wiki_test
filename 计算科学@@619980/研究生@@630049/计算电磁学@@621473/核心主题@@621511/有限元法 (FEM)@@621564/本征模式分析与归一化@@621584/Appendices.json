{"hands_on_practices": [{"introduction": "本练习是本征模分析的基石，我们将从一个经典的、可解析求解的问题入手：一个具有完美导电壁的矩形谐振腔。通过在这些理想边界条件下对麦克斯韦方程组应用分离变量法，你将从第一性原理推导出基本的横电 (TE) 模和横磁 (TM) 模及其谐振频率。这项练习 [@problem_id:3303755] 对于建立一个具体而深刻的理解至关重要，即离散的本征模是如何产生的，以及在一个简单的无损耗系统中它们是如何被归一化的。", "problem": "一个理想电导体 (PEC) 矩形腔占据区域 $0 \\le x \\le a$，$0 \\le y \\le b$，$0 \\le z \\le d$，并填充有介电常数为 $\\epsilon$、磁导率为 $\\mu$ 的均匀各向同性材料。假设场为时谐场，时间依赖关系为 $e^{\\jmath \\omega t}$，且腔内无源。PEC 边界条件为电场 $\\mathbf{E}$ 的切向分量在所有六个壁上均为零。\n\n从无源麦克斯韦方程组和 PEC 边界条件出发，推导腔本征模式的旋度-旋度特征值问题，并使用分离变量法构建允许的本征函数。将解相对于 $z$ 轴分为横电 ($\\text{TE}$，其中 $E_{z}=0$ 且 $H_{z} \\neq 0$) 和横磁 ($\\text{TM}$，其中 $H_{z}=0$ 且 $E_{z} \\neq 0$) 两个族，并确定在 $[0,a]\\times[0,b]\\times[0,d]$ 上对每个族满足 PEC 条件的可分离函数的可容许集。\n\n从第一性原理出发，推导由旋度-旋度算符对这些可分离本征函数施加的色散关系，并由此确定本征频率 $\\omega_{mnp}$，用腔体尺寸 $a$、$b$、$d$、材料参数 $\\epsilon$、$\\mu$ 以及与 $\\text{TE}$ 和 $\\text{TM}$ 模式的边界条件一致的非负整数 $m$、$n$、$p$ 来表示。\n\n给出 $z$ 方向标量场分量 $H_{z}(x,y,z)$ (对于 $\\text{TE}$) 和 $E_{z}(x,y,z)$ (对于 $\\text{TM}$) 的显式表达式，并解释如何从麦克斯韦方程组获得横向场分量。\n\n对分离的标量本征函数施加一个数学上适定的归一化，要求其在腔体体积上的 $L^2$-范数等于 1，即对于 $\\text{TE}$ 模式，选择标量归一化 $\\int_{V} |H_{z}(x,y,z)|^{2}\\,dV = 1$；对于 $\\text{TM}$ 模式，选择 $\\int_{V} |E_{z}(x,y,z)|^{2}\\,dV = 1$。计算乘以可分离解的相应闭式归一化常数，并明确考虑 $\\text{TE}$ 模式中 $m=0$ 或 $n=0$ 的特殊情况。\n\n最后，给出本征频率 $\\omega_{mnp}$ 关于 $m$、$n$、$p$、$a$、$b$、$d$、$\\epsilon$ 和 $\\mu$ 的闭式解析表达式。你的最终答案必须是单个表达式。不需要任何数值。", "solution": "该问题陈述是计算电磁学中的一个标准练习，具有科学依据、适定且客观。所有关于几何结构、材料属性和边界条件的必要信息均已提供且自洽。因此，该问题是有效的，我们可以进行求解。\n\n分析始于线性、各向同性、均匀介质中的无源、时谐 Maxwell 方程组，假设时间依赖关系为 $e^{\\jmath \\omega t}$:\n$$ \\nabla \\times \\mathbf{E} = -\\jmath \\omega \\mu \\mathbf{H} $$\n$$ \\nabla \\times \\mathbf{H} = \\jmath \\omega \\epsilon \\mathbf{E} $$\n$$ \\nabla \\cdot \\mathbf{E} = 0 $$\n$$ \\nabla \\cdot \\mathbf{H} = 0 $$\n为得到旋度-旋度特征值问题，我们对第一个方程取旋度，并将第二个方程代入结果中：\n$$ \\nabla \\times (\\nabla \\times \\mathbf{E}) = -\\jmath \\omega \\mu (\\nabla \\times \\mathbf{H}) = -\\jmath \\omega \\mu (\\jmath \\omega \\epsilon \\mathbf{E}) = \\omega^2 \\mu \\epsilon \\mathbf{E} $$\n令 $k^2 = \\omega^2 \\mu \\epsilon$。电场的旋度-旋度特征值方程为：\n$$ \\nabla \\times \\nabla \\times \\mathbf{E} - k^2 \\mathbf{E} = 0 $$\n使用矢量恒等式 $\\nabla \\times (\\nabla \\times \\mathbf{E}) = \\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^2 \\mathbf{E}$ 和无源条件 $\\nabla \\cdot \\mathbf{E} = 0$，上式可简化为矢量亥姆霍兹方程：\n$$ \\nabla^2 \\mathbf{E} + k^2 \\mathbf{E} = 0 $$\n磁场 $\\mathbf{H}$ 也满足一个类似的方程。在边界条件下，该方程的解是腔的本征模式，而对应的 $k$ 值（以及 $\\omega$ 值）是特征值或本征频率。\n\n腔内的场可以相对于 $z$ 轴分为两个独立的族：横磁 (TM) 模式，其中 $H_z = 0$；以及横电 (TE) 模式，其中 $E_z = 0$。\n\n对于这两种模式类型，我们使用分离变量法求解。考虑一个满足标量亥姆霍兹方程 $(\\nabla^2 + k^2)\\psi = 0$ 的通用标量分量 $\\psi(x, y, z)$，我们假设解的形式为 $\\psi(x,y,z) = X(x)Y(y)Z(z)$。将其代入方程得到：\n$$ \\frac{1}{X}\\frac{d^2X}{dx^2} + \\frac{1}{Y}\\frac{d^2Y}{dy^2} + \\frac{1}{Z}\\frac{d^2Z}{dz^2} + k^2 = 0 $$\n该方程可分离为三个常微分方程，分离常数分别为 $-k_x^2$、$-k_y^2$ 和 $-k_z^2$:\n$$ \\frac{d^2X}{dx^2} + k_x^2 X = 0 $$\n$$ \\frac{d^2Y}{dy^2} + k_y^2 Y = 0 $$\n$$ \\frac{d^2Z}{dz^2} + k_z^2 Z = 0 $$\n这些常数必须满足色散关系：$k_x^2 + k_y^2 + k_z^2 = k^2 = \\omega^2 \\mu \\epsilon$。\n\n本征函数的具体形式由理想电导体 (PEC) 边界条件决定，该条件规定电场 $\\mathbf{E}$ 的切向分量在由 $x=0,a$、$y=0,b$ 和 $z=0,d$ 定义的腔体所有六个壁上必须为零。\n\n**横磁 (TM) 模式 ($H_z=0, E_z \\neq 0$)**\n纵向分量 $E_z$ 必须满足标量亥姆霍兹方程。$E_z$ 的边界条件是：\n- 在 $x=0,a$ 和 $y=0,b$ 处的壁上，$E_z$ 是切向的。因此，$E_z(0,y,z) = E_z(a,y,z) = 0$ 且 $E_z(x,0,z) = E_z(x,b,z) = 0$。\n- 横向电场分量 $E_x$ 和 $E_y$ 在 $z=0,d$ 处的壁上是切向的。可以证明，横向场与纵向场之间的关系为 $\\mathbf{E}_t = \\frac{1}{k_c^2} \\nabla_t (\\frac{\\partial E_z}{\\partial z})$，其中 $k_c^2=k_x^2+k_y^2$。为了使 $E_x$ 和 $E_y$ 在 $z=0,d$ 处为零，我们需要 $\\frac{\\partial E_z}{\\partial z} = 0$ 在 $z=0,d$ 成立。\n\n将这些条件应用于分离解：\n- $X(0)=0$ 和 $X(a)=0 \\implies X(x) \\propto \\sin(k_x x)$，其中 $k_x = \\frac{m\\pi}{a}$，$m=1,2,3,\\dots$。\n- $Y(0)=0$ 和 $Y(b)=0 \\implies Y(y) \\propto \\sin(k_y y)$，其中 $k_y = \\frac{n\\pi}{b}$，$n=1,2,3,\\dots$。\n- $Z'(0)=0$ 和 $Z'(d)=0 \\implies Z(z) \\propto \\cos(k_z z)$，其中 $k_z = \\frac{p\\pi}{d}$，$p=0,1,2,\\dots$。\n对于一个非平凡的 TM 模式， $m$ 和 $n$ 都必须非零。$z$ 方向标量分量的通用形式是：\n$$ E_z(x,y,z) = C^{\\text{TM}}_{mnp} \\sin\\left(\\frac{m\\pi x}{a}\\right) \\sin\\left(\\frac{n\\pi y}{b}\\right) \\cos\\left(\\frac{p\\pi z}{d}\\right) $$\n指数为 $m \\ge 1, n \\ge 1, p \\ge 0$。\n\n**横电 (TE) 模式 ($E_z=0, H_z \\neq 0$)**\n纵向分量 $H_z$ 满足标量亥姆霍兹方程。边界条件施加在切向电场上。横向电场通过 $\\mathbf{E}_t = \\frac{\\jmath \\omega \\mu}{k_c^2} (\\hat{\\mathbf{z}} \\times \\nabla_t H_z)$ 与 $H_z$ 相关联，这给出 $E_x = \\frac{\\jmath\\omega\\mu}{k_c^2}\\frac{\\partial H_z}{\\partial y}$ 和 $E_y = -\\frac{\\jmath\\omega\\mu}{k_c^2}\\frac{\\partial H_z}{\\partial x}$。\nPEC 条件是：\n- $E_y(0,y,z) = E_y(a,y,z) = 0 \\implies \\frac{\\partial H_z}{\\partial x} = 0$ 在 $x=0,a$ 处。\n- $E_x(x,0,z) = E_x(x,b,z) = 0 \\implies \\frac{\\partial H_z}{\\partial y} = 0$ 在 $y=0,b$ 处。\n- $E_x(x,y,0) = E_x(x,y,d) = 0$ 且 $E_y(x,y,0) = E_y(x,y,d) = 0$。\n\n将这些条件应用于分离解：\n- $X'(0)=0$ 和 $X'(a)=0 \\implies X(x) \\propto \\cos(k_x x)$，其中 $k_x = \\frac{m\\pi}{a}$，$m=0,1,2,\\dots$。\n- $Y'(0)=0$ 和 $Y'(b)=0 \\implies Y(y) \\propto \\cos(k_y y)$，其中 $k_y = \\frac{n\\pi}{b}$，$n=0,1,2,\\dots$。\n为满足 $z=0,d$ 壁上的边界条件，完整分析表明 $Z(z)$ 的合适形式是正弦函数。这确保了 $E_x \\propto \\sin(k_z z)$ 和 $E_y \\propto \\sin(k_z z)$，它们在 $z=0$ 处为零。在 $z=d$ 处的条件要求 $\\sin(k_z d)=0$。\n- $Z(0)=0$ 和 $Z(d)=0 \\implies Z(z) \\propto \\sin(k_z z)$，其中 $k_z = \\frac{p\\pi}{d}$，$p=1,2,3,\\dots$。\n对于一个非平凡的 TE 模式，$m$ 或 $n$ 中至少有一个必须非零（否则 $k_c^2=0$ 且 $H_z$ 为常数，导致电场为零）。此外，为了使 $H_z$ 存在，$p$ 必须非零。通用形式为：\n$$ H_z(x,y,z) = C^{\\text{TE}}_{mnp} \\cos\\left(\\frac{m\\pi x}{a}\\right) \\cos\\left(\\frac{n\\pi y}{b}\\right) \\sin\\left(\\frac{p\\pi z}{d}\\right) $$\n指数为 $m \\ge 0, n \\ge 0$（但不能同时为零，$m^2+n^2 \\neq 0$），以及 $p \\ge 1$。\n\n**本征频率和横向场推导**\n对于 TE 和 TM 模式，本征频率 $\\omega_{mnp}$ 均由色散关系确定：\n$$ \\omega_{mnp}^2 \\mu \\epsilon = k^2 = k_x^2 + k_y^2 + k_z^2 = \\left(\\frac{m\\pi}{a}\\right)^2 + \\left(\\frac{n\\pi}{b}\\right)^2 + \\left(\\frac{p\\pi}{d}\\right)^2 $$\n求解 $\\omega_{mnp}$ 得到腔体谐振频率的通用表达式：\n$$ \\omega_{mnp} = \\frac{1}{\\sqrt{\\mu\\epsilon}} \\sqrt{\\left(\\frac{m\\pi}{a}\\right)^2 + \\left(\\frac{n\\pi}{b}\\right)^2 + \\left(\\frac{p\\pi}{d}\\right)^2} $$\n横向场分量（$\\mathbf{E}_t, \\mathbf{H}_t$）可以通过求解从 Maxwell 旋度方程推导出的代数方程组，由纵向分量（$E_z, H_z$）获得，这会得到形如 $\\mathbf{E}_t = f(\\nabla_t E_z, \\nabla_t H_z)$ 和 $\\mathbf{H}_t = g(\\nabla_t E_z, \\nabla_t H_z)$ 的表达式。具体而言，可以得到：\n$$ \\mathbf{E}_t = -\\frac{\\jmath}{k_c^2} \\left( k_z \\nabla_t E_z - \\omega\\mu (\\hat{\\mathbf{z}} \\times \\nabla_t H_z) \\right) $$\n$$ \\mathbf{H}_t = -\\frac{\\jmath}{k_c^2} \\left( k_z \\nabla_t H_z + \\omega\\epsilon (\\hat{\\mathbf{z}} \\times \\nabla_t E_z) \\right) $$\n对于驻波解，应使用导数 $\\partial/\\partial z$ 而不是因子 $-\\jmath k_z$。\n\n**归一化常数**\n归一化常数通过施加条件——标量场分量（TM 模式为 $E_z$，TE 模式为 $H_z$）在腔体体积 $V=abd$ 上的 $L^2$-范数等于 1——来求得。我们使用以下定积分：\n$\\int_0^L \\sin^2(\\frac{k\\pi u}{L}) du = \\frac{L}{2}$，对于 $k \\ge 1$。\n$\\int_0^L \\cos^2(\\frac{k\\pi u}{L}) du = L$ 对于 $k=0$，$ = \\frac{L}{2}$ 对于 $k \\ge 1$。这可以写成 $\\frac{L}{2}(1+\\delta_{k0})$，其中 $\\delta_{ij}$ 是克罗内克 δ 符号。\n\n对于 TM 模式，$\\int_V |E_z|^2 dV = 1$:\n$$ |C^{\\text{TM}}_{mnp}|^2 \\left(\\frac{a}{2}\\right) \\left(\\frac{b}{2}\\right) \\left(\\frac{d(1+\\delta_{p0})}{2}\\right) = 1 $$\n$$ C^{\\text{TM}}_{mnp} = \\sqrt{\\frac{8}{abd(1+\\delta_{p0})}} \\quad (m,n \\ge 1; p \\ge 0) $$\n\n对于 TE 模式，$\\int_V |H_z|^2 dV = 1$:\n$$ |C^{\\text{TE}}_{mnp}|^2 \\left(\\frac{a(1+\\delta_{m0})}{2}\\right) \\left(\\frac{b(1+\\delta_{n0})}{2}\\right) \\left(\\frac{d}{2}\\right) = 1 $$\n$$ C^{\\text{TE}}_{mnp} = \\sqrt{\\frac{8}{abd(1+\\delta_{m0})(1+\\delta_{n0})}} \\quad (m,n \\ge 0, m^2+n^2 \\neq 0; p \\ge 1) $$\n这些常数确保本征函数在指定的归一化条件下形成一个标准正交集。\n\n最终要求的表达式是本征频率 $\\omega_{mnp}$。", "answer": "$$ \\boxed{ \\frac{1}{\\sqrt{\\mu\\epsilon}} \\sqrt{ \\left(\\frac{m\\pi}{a}\\right)^{2} + \\left(\\frac{n\\pi}{b}\\right)^{2} + \\left(\\frac{p\\pi}{d}\\right)^{2} } } $$", "id": "3303755"}, {"introduction": "真实世界的应用常常涉及有损耗或各向异性的材料，这使得底层的电磁学算符变为非厄米 (non-Hermitian) 算符。本练习将超越理想系统，探索至关重要的双正交性 (biorthogonality) 概念。通过一个数值练习 [@problem_id:3303766]，你将发现为何我们熟悉的本征矢量正交性会失效，以及如何正确地使用不同的左、右本征矢量来构成一个完备的基。这个动手实践问题突显了在复杂介质中进行精确模式分析时，双正交内积的必要性，这是现代计算电磁学中的一个基本概念。", "problem": "给定一个均匀介质中频域Maxwell本征问题的有限维平面波表述。作用于波矢为 $\\mathbf{k} \\in \\mathbb{R}^3$ 的平面波上的旋度算子由叉积矩阵 $\\mathbf{K}(\\mathbf{k}) \\in \\mathbb{R}^{3 \\times 3}$ 表示，定义为\n$$\n\\mathbf{K}(\\mathbf{k}) = \n\\begin{bmatrix}\n0  &-k_z  &k_y \\\\\nk_z  &0  &-k_x \\\\\n-k_y  &k_x  &0\n\\end{bmatrix},\n$$\n使得对于任意 $\\mathbf{v} \\in \\mathbb{C}^3$，有 $\\mathbf{K}(\\mathbf{k}) \\mathbf{v} = \\mathbf{k} \\times \\mathbf{v}$。考虑以下形式的一阶Maxwell广义本征问题\n$$\n\\mathbf{K}_6(\\mathbf{k}) \\, \\boldsymbol{\\Psi} = \\omega \\, \\mathbf{M} \\, \\boldsymbol{\\Psi},\n$$\n其中 $6 \\times 6$ 算子为\n$$\n\\mathbf{K}_6(\\mathbf{k}) = \n\\begin{bmatrix}\n\\mathbf{0}  &i \\, \\mathbf{K}(\\mathbf{k}) \\\\\n- i \\, \\mathbf{K}(\\mathbf{k})  &\\mathbf{0}\n\\end{bmatrix},\n$$\n以及本构 $6 \\times 6$ 矩阵 $\\mathbf{M}$ 为\n$$\n\\mathbf{M} =\n\\begin{bmatrix}\n\\boldsymbol{\\varepsilon}  &\\boldsymbol{\\xi} \\\\\n\\boldsymbol{\\zeta}  &\\boldsymbol{\\mu}\n\\end{bmatrix},\n$$\n其中 $\\boldsymbol{\\varepsilon}$、$\\boldsymbol{\\mu}$、$\\boldsymbol{\\xi}$ 和 $\\boldsymbol{\\zeta}$ 是 $3 \\times 3$ 的分块矩阵。状态矢量为 $\\boldsymbol{\\Psi} = \\begin{bmatrix} \\mathbf{E} \\\\ \\mathbf{H} \\end{bmatrix} \\in \\mathbb{C}^{6}$。对于具有磁电耦合的互易介质，互易性条件要求 $\\boldsymbol{\\zeta} = - \\boldsymbol{\\xi}^{T}$。在没有磁电耦合的情况下，$\\boldsymbol{\\xi} = \\mathbf{0}$ 且 $\\boldsymbol{\\zeta} = \\mathbf{0}$，本构矩阵简化为块对角矩阵 $\\mathbf{M} = \\operatorname{diag}(\\boldsymbol{\\varepsilon}, \\boldsymbol{\\mu})$。\n\n从Maxwell方程组和本构关系 $\\mathbf{D} = \\boldsymbol{\\varepsilon} \\mathbf{E} + \\boldsymbol{\\xi} \\mathbf{H}$ 及 $\\mathbf{B} = \\boldsymbol{\\mu} \\mathbf{H} + \\boldsymbol{\\zeta} \\mathbf{E}$ 出发，可以推导出在 $\\boldsymbol{\\xi} = \\boldsymbol{\\zeta} = \\mathbf{0}$ 的均匀介质中，关于电场 $\\mathbf{E}$ 的二阶旋度-旋度本征问题为\n$$\n\\left( \\mathbf{K}(\\mathbf{k}) \\, \\boldsymbol{\\mu}^{-1} \\, \\mathbf{K}(\\mathbf{k}) \\right) \\mathbf{E} = \\omega^2 \\, \\boldsymbol{\\varepsilon} \\, \\mathbf{E}.\n$$\n定义矩阵 $\\mathbf{A}(\\mathbf{k}) = \\mathbf{K}(\\mathbf{k}) \\, \\boldsymbol{\\mu}^{-1} \\, \\mathbf{K}(\\mathbf{k})$；对于 $\\boldsymbol{\\mu} = \\mathbf{I}$，这可简化为 $\\mathbf{A}(\\mathbf{k}) = \\mathbf{K}(\\mathbf{k})^2 = - \\|\\mathbf{k}\\|^2 \\mathbf{I} + \\mathbf{k} \\mathbf{k}^{T}$。\n\n对于一个广义本征问题 $\\mathbf{A} \\mathbf{x} = \\lambda \\mathbf{B} \\mathbf{x}$，其中 $\\mathbf{B}$ 可能为非厄米矩阵（例如，由于各向异性损耗），其右本征矢量 $\\mathbf{x}_n$ 和左本征矢量 $\\tilde{\\mathbf{x}}_n$ 满足\n$$\n\\mathbf{A} \\mathbf{x}_n = \\lambda_n \\mathbf{B} \\mathbf{x}_n, \\quad \\tilde{\\mathbf{x}}_n^{\\dagger} \\mathbf{A} = \\lambda_n \\, \\tilde{\\mathbf{x}}_n^{\\dagger} \\mathbf{B},\n$$\n其中 ${}^\\dagger$ 表示共轭转置。双正交性和归一化条件为\n$$\n\\langle \\tilde{\\mathbf{x}}_m, \\mathbf{x}_n \\rangle_{\\mathbf{B}} \\equiv \\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{B} \\mathbf{x}_n = \\delta_{mn}.\n$$\n在电场旋度-旋度问题中，$\\mathbf{B} = \\boldsymbol{\\varepsilon}$。在包含磁电耦合的完整一阶表述中，内积中合适的度规是 $\\mathbf{M}$，因此双正交性条件变为\n$$\n\\langle \\tilde{\\boldsymbol{\\Psi}}_m, \\boldsymbol{\\Psi}_n \\rangle_{\\mathbf{M}} \\equiv \\tilde{\\boldsymbol{\\Psi}}_m^{\\dagger} \\mathbf{M} \\, \\boldsymbol{\\Psi}_n = \\delta_{mn}.\n$$\n\n您的任务是：\n- 为指定的广义本征问题构建左、右本征模式的双正交集，并验证经过适当归一化后，相应的内积满足克罗内克δ性质。\n- 量化忽略左-右配对或忽略磁电耦合的朴素内积的失效程度。\n- 对以下三个测试案例进行数值实现此验证。\n\n所有量均视为无量纲；不要报告任何物理单位。此问题不涉及角度。\n\n测试组：\n- 案例A（无损耗，无耦合，一阶）：设 $\\mathbf{k} = [\\, 1.1, \\, 0.7, \\, 0.9 \\,]^T$，$\\boldsymbol{\\varepsilon} = 2.0 \\, \\mathbf{I}$，$\\boldsymbol{\\mu} = 1.3 \\, \\mathbf{I}$，$\\boldsymbol{\\xi} = \\mathbf{0}$，$\\boldsymbol{\\zeta} = \\mathbf{0}$。构建 $\\mathbf{K}_6(\\mathbf{k})$ 和 $\\mathbf{M} = \\operatorname{diag}(\\boldsymbol{\\varepsilon}, \\boldsymbol{\\mu})$。计算左、右本征矢量并评估偏差\n$$\nd_A = \\max_{m,n} \\left| \\tilde{\\boldsymbol{\\Psi}}_m^{\\dagger} \\mathbf{M} \\, \\boldsymbol{\\Psi}_n - \\delta_{mn} \\right|,\n$$\n在缩放每个右本征矢量 $\\boldsymbol{\\Psi}_n$ 以满足 $\\tilde{\\boldsymbol{\\Psi}}_n^{\\dagger} \\mathbf{M} \\, \\boldsymbol{\\Psi}_n = 1$ 之后。\n\n- 案例B（各向异性损耗，无耦合，针对 $\\mathbf{E}$ 的旋度-旋度问题）：设 $\\mathbf{k} = [\\, 1.1, \\, 0.7, \\, 0.9 \\,]^T$，$\\boldsymbol{\\mu} = \\mathbf{I}$，以及\n$$\n\\boldsymbol{\\varepsilon} =\n\\begin{bmatrix}\n2.0 + 0.2 i  &0.1 + 0.05 i  &0.0 + 0.02 i \\\\\n0.1 + 0.05 i  &1.5 + 0.15 i  &0.02 + 0.01 i \\\\\n0.0 + 0.02 i  &0.02 + 0.01 i  &1.2 + 0.1 i\n\\end{bmatrix}.\n$$\n构建 $\\mathbf{A}(\\mathbf{k}) = - \\|\\mathbf{k}\\|^2 \\mathbf{I} + \\mathbf{k} \\mathbf{k}^T$。计算：\n1. 仅使用右本征矢量的朴素右-右格拉姆偏差：\n$$\nd_{B,\\text{wrong}} = \\max_{m \\neq n} \\left| \\mathbf{x}_m^{\\dagger} \\boldsymbol{\\varepsilon} \\, \\mathbf{x}_n \\right|,\n$$\n在将每个右本征矢量 $\\mathbf{x}_n$ 缩放至单位 $\\boldsymbol{\\varepsilon}$-范数 $\\mathbf{x}_n^{\\dagger} \\boldsymbol{\\varepsilon} \\, \\mathbf{x}_n = 1$ 之后。\n2. 使用左-右配对的正确双正交偏差：\n$$\nd_{B,\\text{right}} = \\max_{m,n} \\left| \\tilde{\\mathbf{x}}_m^{\\dagger} \\boldsymbol{\\varepsilon} \\, \\mathbf{x}_n - \\delta_{mn} \\right|,\n$$\n在缩放每个右本征矢量以满足 $\\tilde{\\mathbf{x}}_n^{\\dagger} \\boldsymbol{\\varepsilon} \\, \\mathbf{x}_n = 1$ 之后。\n\n- 案例C（各向异性损耗且有磁电耦合，一阶）：设 $\\mathbf{k} = [\\, 1.1, \\, 0.7, \\, 0.9 \\,]^T$，以及\n$$\n\\boldsymbol{\\varepsilon} =\n\\begin{bmatrix}\n2.0 + 0.05 i  &0.04 + 0.02 i  &0.01 + 0.01 i \\\\\n0.04 + 0.02 i  &1.4 + 0.02 i  &0.03 + 0.01 i \\\\\n0.01 + 0.01 i  &0.03 + 0.01 i  &1.7 + 0.01 i\n\\end{bmatrix}, \\quad\n\\boldsymbol{\\mu} =\n\\begin{bmatrix}\n1.1 + 0.01 i  &0  &0 \\\\\n0  &1.0 + 0.02 i  &0 \\\\\n0  &0  &0.9 + 0.03 i\n\\end{bmatrix},\n$$\n$$\n\\boldsymbol{\\xi} =\n\\begin{bmatrix}\n0.02 + 0.01 i  &-0.01 + 0.005 i  &0.0 + 0.002 i \\\\\n0.005 - 0.004 i  &0.015 + 0.006 i  &-0.007 + 0.003 i \\\\\n-0.003 + 0.002 i  &0.004 - 0.001 i  &0.01 + 0.005 i\n\\end{bmatrix}, \\quad\n\\boldsymbol{\\zeta} = - \\boldsymbol{\\xi}^{T}.\n$$\n构建 $\\mathbf{K}_6(\\mathbf{k})$ 和 $\\mathbf{M} = \\begin{bmatrix} \\boldsymbol{\\varepsilon} & \\boldsymbol{\\xi} \\\\ \\boldsymbol{\\zeta} & \\boldsymbol{\\mu} \\end{bmatrix}$。计算两个偏差：\n1. 使用忽略磁电耦合的错误度规，\n$$\nd_{C,\\text{wrong}} = \\max_{m \\neq n} \\left| \\tilde{\\boldsymbol{\\Psi}}_m^{\\dagger} \\, \\operatorname{diag}(\\boldsymbol{\\varepsilon}, \\boldsymbol{\\mu}) \\, \\boldsymbol{\\Psi}_n \\right|,\n$$\n在缩放以满足 $\\tilde{\\boldsymbol{\\Psi}}_n^{\\dagger} \\, \\operatorname{diag}(\\boldsymbol{\\varepsilon}, \\boldsymbol{\\mu}) \\, \\boldsymbol{\\Psi}_n = 1$ 之后。\n2. 使用正确的度规，\n$$\nd_{C,\\text{right}} = \\max_{m,n} \\left| \\tilde{\\boldsymbol{\\Psi}}_m^{\\dagger} \\, \\mathbf{M} \\, \\boldsymbol{\\Psi}_n - \\delta_{mn} \\right|,\n$$\n在缩放每个右本征矢量以满足 $\\tilde{\\boldsymbol{\\Psi}}_n^{\\dagger} \\, \\mathbf{M} \\, \\boldsymbol{\\Psi}_n = 1$ 之后。\n\n您的程序必须：\n- 实现矩阵的构建，为每个广义本征问题计算左、右本征矢量，执行指定的归一化，并评估如上定义的偏差 $d_A$、$d_{B,\\text{wrong}}$、$d_{B,\\text{right}}$、$d_{C,\\text{wrong}}$ 和 $d_{C,\\text{right}}$。\n- 生成单行输出，其中包含这五个结果，格式需严格遵守：用方括号括起来的逗号分隔列表，顺序为 $[d_A, d_{B,\\text{wrong}}, d_{B,\\text{right}}, d_{C,\\text{wrong}}, d_{C,\\text{right}}]$。\n\n预期的输出类型是实值浮点数。不允许用户输入，所有数据均已在上方明确给出。", "solution": "该问题要求对广义Maxwell本征问题的本征矢量的双正交性条件进行数值验证。在计算电磁学中，该分析是描述复杂介质（可能具有各向异性、损耗或表现出磁电耦合）中模式的基础。问题的核心在于广义非厄米本征问题的性质。\n\n广义本征值问题由方程 $\\mathbf{A} \\mathbf{x} = \\lambda \\mathbf{B} \\mathbf{x}$ 给出，其中 $\\mathbf{A}$ 和 $\\mathbf{B}$ 是方阵。相应的左本征值问题由 $\\tilde{\\mathbf{x}}^{\\dagger} \\mathbf{A} = \\lambda \\tilde{\\mathbf{x}}^{\\dagger} \\mathbf{B}$ 定义。如果系统的“度规”矩阵（在此为 $\\mathbf{B}$）不是厄米矩阵和正定矩阵，则该本征问题通常是非厄米的，并且左本征矢量 $\\tilde{\\mathbf{x}}_n$ 不仅仅是右本征矢量 $\\mathbf{x}_n$ 的共轭转置。它们构成一个独立的集合。\n\n对应于不同本征值的左、右本征矢量关于度规 $\\mathbf{B}$ 是正交的。为了证明这一点，考虑两个本征对 $(\\lambda_n, \\mathbf{x}_n, \\tilde{\\mathbf{x}}_n)$ 和 $(\\lambda_m, \\mathbf{x}_m, \\tilde{\\mathbf{x}}_m)$:\n$$\n\\mathbf{A} \\mathbf{x}_n = \\lambda_n \\mathbf{B} \\mathbf{x}_n\n$$\n$$\n\\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{A} = \\lambda_m \\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{B}\n$$\n用 $\\tilde{\\mathbf{x}}_m^{\\dagger}$ 左乘第一个方程，并用 $\\mathbf{x}_n$ 右乘第二个方程，得到：\n$$\n\\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{A} \\mathbf{x}_n = \\lambda_n \\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{B} \\mathbf{x}_n\n$$\n$$\n\\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{A} \\mathbf{x}_n = \\lambda_m \\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{B} \\mathbf{x}_n\n$$\n将这两个方程相减得到 $(\\lambda_n - \\lambda_m) \\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{B} \\mathbf{x}_n = 0$。对于非简并谱，其中 $\\lambda_n \\neq \\lambda_m$，必然有 $\\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{B} \\mathbf{x}_n = 0$。这就是双正交性条件。\n\n对于 $m=n$ 的情况，内积 $\\tilde{\\mathbf{x}}_n^{\\dagger} \\mathbf{B} \\mathbf{x}_n$ 通常不为零。我们可以对右本征矢量进行归一化，以形成一个双正交归一基。通过定义一组新的右本征矢量 $\\mathbf{x}'_n = c_n \\mathbf{x}_n$，缩放因子为 $c_n = 1 / (\\tilde{\\mathbf{x}}_n^{\\dagger} \\mathbf{B} \\mathbf{x}_n)$，我们得到完整的双正交归一关系：\n$$\n\\langle \\tilde{\\mathbf{x}}_m, \\mathbf{x}'_n \\rangle_{\\mathbf{B}} \\equiv \\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{B} \\mathbf{x}'_n = \\delta_{mn}\n$$\n其中 $\\delta_{mn}$ 是克罗内克δ。数值实现将为给定的电磁本征问题验证此性质，并在使用不正确程序时量化其误差。\n\n解决方案通过为每个测试案例实现特定任务来展开。\n\n案例 A：一阶、无损耗、无耦合。\n本征问题是 $\\mathbf{K}_6(\\mathbf{k}) \\boldsymbol{\\Psi} = \\omega \\mathbf{M} \\boldsymbol{\\Psi}$。在这里，$\\mathbf{A} = \\mathbf{K}_6(\\mathbf{k})$ 且 $\\mathbf{B} = \\mathbf{M} = \\operatorname{diag}(2.0 \\, \\mathbf{I}, 1.3 \\, \\mathbf{I})$。矩阵 $\\mathbf{K}_6(\\mathbf{k})$ 是厄米矩阵，而 $\\mathbf{M}$ 是实数、对称且正定的。这构成了一个广义厄米本征问题。在这种情况下，左本征矢量是右本征矢量的共轭转置，标准的正交性成立。$d_A$的计算将证实双正交归一关系，此处该关系简化为标准正交性。由此产生的偏差应接近机器精度。\n\n案例 B：关于 $\\mathbf{E}$ 的二阶旋度-旋度问题，各向异性损耗。\n本征问题是 $\\mathbf{A}(\\mathbf{k}) \\mathbf{E} = \\omega^2 \\boldsymbol{\\varepsilon} \\mathbf{E}$。在这里，$\\mathbf{A} = \\mathbf{A}(\\mathbf{k}) = \\mathbf{K}(\\mathbf{k})^2$ 是一个实对称矩阵，因此是厄米矩阵。度规矩阵 $\\mathbf{B} = \\boldsymbol{\\varepsilon}$ 是一个复对称矩阵，但由于材料损耗（虚部）的存在，它不是厄米矩阵。因此，该本征问题是非厄米的。\n$d_{B,\\text{wrong}}$量化了仅使用右本征矢量 $\\mathbf{x}_n$ 来构造正交基的朴素尝试所产生的误差，这些矢量被归一化为单位 $\\boldsymbol{\\varepsilon}$-范数 ($\\mathbf{x}_n^{\\dagger} \\boldsymbol{\\varepsilon} \\mathbf{x}_n = 1$)。由于该问题是非厄米的，右本征矢量关于$\\boldsymbol{\\varepsilon}$内积不是正交的，因此预计该偏差会很大。\n$d_{B,\\text{right}}$量化了同时使用左 $\\tilde{\\mathbf{x}}_n$ 和右 $\\mathbf{x}_n$ 本征矢量的双正交归一化程序的正确性。预计该偏差将接近机器精度，从而证实双正交性原理的有效性。\n\n案例 C：一阶，具有各向异性损耗和磁电耦合。\n本征问题同样是 $\\mathbf{K}_6(\\mathbf{k}) \\boldsymbol{\\Psi} = \\omega \\mathbf{M} \\boldsymbol{\\Psi}$。虽然 $\\mathbf{K}_6(\\mathbf{k})$ 是厄米矩阵，但由于损耗材料（$\\boldsymbol{\\varepsilon} \\neq \\boldsymbol{\\varepsilon}^{\\dagger}, \\boldsymbol{\\mu} \\neq \\boldsymbol{\\mu}^{\\dagger}$）以及磁电耦合块的结构（$\\boldsymbol{\\zeta} = -\\boldsymbol{\\xi}^T$，这并不意味着 $\\boldsymbol{\\xi} = \\boldsymbol{\\zeta}^{\\dagger}$），完整的本构矩阵 $\\mathbf{M}$ 不是厄米矩阵。该问题是确定无疑的非厄米问题。\n$d_{C,\\text{wrong}}$ 衡量了在内积度规中忽略磁电耦合项 $\\boldsymbol{\\xi}$ 和 $\\boldsymbol{\\zeta}$ 时的正交性误差。度规被错误地假定为 $\\mathbf{M}_{\\text{wrong}} = \\operatorname{diag}(\\boldsymbol{\\varepsilon}, \\boldsymbol{\\mu})$。由于这不是广义本征问题的真正度规 $\\mathbf{M}$，双正交关系将不成立，预计会出现较大的偏差。\n$d_{C,\\text{right}}$ 使用了正确的、完整的度规 $\\mathbf{M}$。这恢复了问题的正确结构，双正交归一关系 $\\tilde{\\boldsymbol{\\Psi}}_m^{\\dagger} \\mathbf{M} \\boldsymbol{\\Psi}_n = \\delta_{mn}$ 应在数值精度范围内成立。由此产生的偏差预计会很小。\n\n下面的程序实现了这些计算。它构建矩阵，使用 `scipy.linalg.eig` 求解广义本征问题以获得左、右本征矢量，应用指定的归一化，并计算所需的偏差。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eig\n\ndef solve():\n    \"\"\"\n    Computes biorthogonality deviations for three electromagnetic eigenproblems.\n    \"\"\"\n    \n    # Common parameter for all cases\n    k_vec = np.array([1.1, 0.7, 0.9])\n\n    def construct_K(k):\n        \"\"\"Constructs the 3x3 curl operator matrix K(k).\"\"\"\n        kx, ky, kz = k\n        return np.array([\n            [0, -kz, ky],\n            [kz, 0, -kx],\n            [-ky, kx, 0]\n        ])\n\n    results = []\n\n    # Case A: Lossless, no coupling, first-order\n    K_mat = construct_K(k_vec)\n    K6_A = np.block([\n        [np.zeros((3, 3)), 1j * K_mat],\n        [-1j * K_mat, np.zeros((3, 3))]\n    ])\n    eps_A = 2.0 * np.eye(3)\n    mu_A = 1.3 * np.eye(3)\n    M_A = np.block([\n        [eps_A, np.zeros((3, 3))],\n        [np.zeros((3, 3)), mu_A]\n    ])\n\n    _, vl_A, vr_A = eig(K6_A, M_A, left=True, right=True)\n    \n    norm_factors_A = np.einsum('ij,ik,kj->j', vl_A.conj(), M_A, vr_A)\n    vr_A_norm = vr_A / norm_factors_A\n    \n    G_A = vl_A.conj().T @ M_A @ vr_A_norm\n    d_A = np.max(np.abs(G_A - np.eye(6)))\n    results.append(d_A)\n\n    # Case B: Anisotropic loss, no coupling, curl-curl for E\n    eps_B = np.array([\n        [2.0 + 0.2j, 0.1 + 0.05j, 0.0 + 0.02j],\n        [0.1 + 0.05j, 1.5 + 0.15j, 0.02 + 0.01j],\n        [0.0 + 0.02j, 0.02 + 0.01j, 1.2 + 0.1j]\n    ])\n    A_B = -np.dot(k_vec, k_vec) * np.eye(3) + np.outer(k_vec, k_vec)\n\n    _, vl_B, vr_B = eig(A_B, eps_B, left=True, right=True)\n    \n    # B, wrong: Naive right-right Gram deviation\n    norm_factors_B_wrong = np.einsum('ij,ik,kj->j', vr_B.conj(), eps_B, vr_B)\n    vr_B_norm_wrong = vr_B / np.sqrt(norm_factors_B_wrong)\n    \n    G_B_wrong = vr_B_norm_wrong.conj().T @ eps_B @ vr_B_norm_wrong\n    np.fill_diagonal(G_B_wrong, 0)\n    d_B_wrong = np.max(np.abs(G_B_wrong))\n    results.append(d_B_wrong)\n    \n    # B, right: Correct biorthogonal deviation\n    norm_factors_B_right = np.einsum('ij,ik,kj->j', vl_B.conj(), eps_B, vr_B)\n    vr_B_norm_right = vr_B / norm_factors_B_right\n    \n    G_B_right = vl_B.conj().T @ eps_B @ vr_B_norm_right\n    d_B_right = np.max(np.abs(G_B_right - np.eye(3)))\n    results.append(d_B_right)\n\n    # Case C: Anisotropic loss with magneto-electric coupling, first-order\n    eps_C = np.array([\n        [2.0 + 0.05j, 0.04 + 0.02j, 0.01 + 0.01j],\n        [0.04 + 0.02j, 1.4 + 0.02j, 0.03 + 0.01j],\n        [0.01 + 0.01j, 0.03 + 0.01j, 1.7 + 0.01j]\n    ])\n    mu_C = np.array([\n        [1.1 + 0.01j, 0, 0],\n        [0, 1.0 + 0.02j, 0],\n        [0, 0, 0.9 + 0.03j]\n    ])\n    xi_C = np.array([\n        [0.02 + 0.01j, -0.01 + 0.005j, 0.0 + 0.002j],\n        [0.005 - 0.004j, 0.015 + 0.006j, -0.007 + 0.003j],\n        [-0.003 + 0.002j, 0.004 - 0.001j, 0.01 + 0.005j]\n    ])\n    zeta_C = -xi_C.T\n    \n    K6_C = K6_A # Same K6 matrix\n    M_C = np.block([\n        [eps_C, xi_C],\n        [zeta_C, mu_C]\n    ])\n\n    _, vl_C, vr_C = eig(K6_C, M_C, left=True, right=True)\n\n    # C, wrong: Incorrect metric (no coupling)\n    M_C_wrong = np.block([\n        [eps_C, np.zeros((3,3))],\n        [np.zeros((3,3)), mu_C]\n    ])\n    norm_factors_C_wrong = np.einsum('ij,ik,kj->j', vl_C.conj(), M_C_wrong, vr_C)\n    vr_C_norm_wrong = vr_C / norm_factors_C_wrong\n\n    G_C_wrong = vl_C.conj().T @ M_C_wrong @ vr_C_norm_wrong\n    np.fill_diagonal(G_C_wrong, 0)\n    d_C_wrong = np.max(np.abs(G_C_wrong))\n    results.append(d_C_wrong)\n\n    # C, right: Correct metric\n    norm_factors_C_right = np.einsum('ij,ik,kj->j', vl_C.conj(), M_C, vr_C)\n    vr_C_norm_right = vr_C / norm_factors_C_right\n    \n    G_C_right = vl_C.conj().T @ M_C @ vr_C_norm_right\n    d_C_right = np.max(np.abs(G_C_right - np.eye(6)))\n    results.append(d_C_right)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3303766"}, {"introduction": "当材料的响应具有频率依赖性（即色散）时，场与物质的相互作用会变得更加复杂。这个高级练习 [@problem_id:3303727] 深入探讨了在这种介质中本征模归一化的深刻物理意义，并将其与储能和因果律原理联系起来。你将推导并数值验证，正确的能量密度表达式并非简单的静态形式，而是包含一个由克拉默-克若尼 (Kramers–Kronig) 关系决定的频率导数项。这项练习提供了一个关键的洞见：正确的归一化不仅仅是一种数学约定，而是基本物理定律的直接结果，忽略它会导致诸如负能量等非物理的预测。", "problem": "考虑一个线性、时不变、无源且因果的色散介电介质中的本征模归一化问题。该介质由标量相对介电常数函数 $ \\varepsilon_r(\\omega) $ 描述，并采用 $ e^{-i \\omega t} $ 的时谐约定。请从第一性原理出发：宏观麦克斯韦方程组、时谐场的坡印亭定理以及线性响应理论，其中极化强度 $ \\mathbf{P}(t) $ 是与一个在 $ t < 0 $ 时为零的极化率 $ \\chi(t) $ 的因果卷积。因果性意味着 $ \\varepsilon_r(\\omega) $ 在复频率上半平面是解析的，并且其实部和虚部由 Kramers–Kronig 关系联系。无源性意味着对于 $ \\omega > 0 $，场做的功是非负的，这要求对于 $ \\omega > 0 $，有 $ \\operatorname{Im} \\varepsilon_r(\\omega) \\ge 0 $。基于这些基础，构建一个有理有据的论证，说明在色散介质中，正确的电磁能量内积（以及本征模归一化）必须涉及导数 $ \\partial_{\\omega}(\\omega \\varepsilon(\\omega)) $，而非 $ \\varepsilon(\\omega) $ 本身。您的论证必须基于存储能量的正定性以及由因果性所蕴含的解析性，不借助任何未经证明的捷径。\n\n然后，通过数值方法给出一个反例，证明如果在归一化中忽略色散（即使用 $ \\varepsilon(\\omega) $ 代替 $ \\partial_{\\omega}(\\omega \\varepsilon(\\omega)) $），所得的电场能量密度在某些频率下可能变为负值，从而违反无源性界限。使用单极点洛伦兹模型来描述标量相对介电常数\n$$\n\\varepsilon_r(\\omega) \\;=\\; \\varepsilon_{\\infty} \\;+\\; \\Delta \\varepsilon \\,\\frac{\\omega_0^2}{\\omega_0^2 \\;-\\; \\omega^2 \\;-\\; i\\,\\gamma\\,\\omega},\n$$\n其中参数 $ \\varepsilon_{\\infty} > 0 $、$ \\Delta \\varepsilon > 0 $、$ \\omega_0 > 0 $ 和阻尼 $ \\gamma \\ge 0 $ 均为实数。令绝对介电常数为 $ \\varepsilon(\\omega) = \\varepsilon_0 \\,\\varepsilon_r(\\omega) $，其中 $ \\varepsilon_0 $ 是真空介电常数，并假设介质是各向同性的。\n\n定义带有色散归一化的周期平均电场能量密度候选表达式，\n$$\nw_{\\mathrm{correct}}(\\omega) \\;=\\; \\frac{1}{4}\\,\\varepsilon_0 \\,\\operatorname{Re}\\!\\left[ \\frac{\\partial}{\\partial \\omega}\\bigl(\\omega \\,\\varepsilon_r(\\omega)\\bigr) \\right] \\,|\\mathbf{E}_0|^2,\n$$\n以及不正确的非色散替代表达式，\n$$\nw_{\\mathrm{wrong}}(\\omega) \\;=\\; \\frac{1}{4}\\,\\varepsilon_0 \\,\\operatorname{Re}\\!\\left[ \\varepsilon_r(\\omega) \\right] \\,|\\mathbf{E}_0|^2,\n$$\n其中 $ \\mathbf{E}_0 $ 是给定的场振幅。对于上述洛伦兹模型，实现解析导数\n$$\n\\frac{\\partial \\varepsilon_r}{\\partial \\omega}(\\omega) \\;=\\; \\Delta \\varepsilon \\,\\omega_0^2 \\,\\frac{2\\omega \\;+\\; i\\,\\gamma}{\\left(\\omega_0^2 \\;-\\; \\omega^2 \\;-\\; i\\,\\gamma\\,\\omega\\right)^2},\n$$\n然后计算\n$$\n\\frac{\\partial}{\\partial \\omega}\\bigl(\\omega \\,\\varepsilon_r(\\omega)\\bigr) \\;=\\; \\varepsilon_r(\\omega) \\;+\\; \\omega \\,\\frac{\\partial \\varepsilon_r}{\\partial \\omega}(\\omega).\n$$\n\n使用以下固定常数和测试套件。常数：\n- 真空介电常数：$ \\varepsilon_0 = 8.8541878128 \\times 10^{-12} \\,\\mathrm{F/m} $。\n- 场振幅：$ |\\mathbf{E}_0| = 1.0 \\,\\mathrm{V/m} $。\n- 体积：$ V = 1.0 \\,\\mathrm{m}^3 $ (因此，在此单位体积设定下，能量密度的数值等于以焦耳为单位的总电场能量)。\n- 材料参数：$ \\varepsilon_{\\infty} = 2.25 $，$ \\Delta \\varepsilon = 4.0 $，以及 $ \\omega_0 = 2\\pi \\times 2.0 \\times 10^{14} \\,\\mathrm{rad/s} $。\n\n包含三组参数 $ (\\gamma, \\omega) $ 的测试套件：\n- 情况 $ \\mathbf{1} $ (正常路径，远低于共振)：$ \\gamma = 0.05\\,\\omega_0 $，$ \\omega = 0.50\\,\\omega_0 $。\n- 情况 $ \\mathbf{2} $ (反例，高于共振)：$ \\gamma = 0.02\\,\\omega_0 $，$ \\omega = 1.05\\,\\omega_0 $。\n- 情况 $ \\mathbf{3} $ (近共振边缘，小阻尼)：$ \\gamma = 0.005\\,\\omega_0 $，$ \\omega = 1.005\\,\\omega_0 $。\n\n对每种情况，计算：\n- 以 $ \\mathrm{J/m^3} $ 为单位的 $ w_{\\mathrm{correct}} $。\n- 以 $ \\mathrm{J/m^3} $ 为单位的 $ w_{\\mathrm{wrong}} $。\n- 比率 $ \\rho = w_{\\mathrm{wrong}} / w_{\\mathrm{correct}} $ (无量纲)，当 $ w_{\\mathrm{correct}} $ 在数值上非常小时需进行安全处理。\n- 布尔值 $ b_{\\mathrm{KK}} $，如果 $ \\operatorname{Re}\\!\\left[\\partial_{\\omega}(\\omega \\varepsilon_r)\\right] \\ge 0 $ 则为 $ \\mathrm{True} $，否则为 $ \\mathrm{False} $，作为对因果性和 Kramers–Kronig 关系所蕴含的正定性的数值检验。\n- 布尔值 $ b_{\\mathrm{wrong}} $，如果 $ w_{\\mathrm{wrong}} \\ge 0 $ 则为 $ \\mathrm{True} $，否则为 $ \\mathrm{False} $，指示非色散替代方案是否违反了电场贡献的无源性界限 $ w \\ge 0 $。\n\n角度单位为弧度。所有类频率量 $ \\omega $、$ \\omega_0 $ 和 $ \\gamma $ 必须以弧度/秒为单位处理。能量必须以 $ \\mathrm{J/m^3} $ 表示。\n\n您的程序必须计算所有三种情况的结果，并生成一个单行输出，该输出包含一个具有以下顺序的扁平化列表：\n$$\n\\bigl[w_{\\mathrm{correct}}^{(1)},\\; w_{\\mathrm{wrong}}^{(1)},\\; \\rho^{(1)},\\; b_{\\mathrm{KK}}^{(1)},\\; b_{\\mathrm{wrong}}^{(1)},\\; w_{\\mathrm{correct}}^{(2)},\\; w_{\\mathrm{wrong}}^{(2)},\\; \\rho^{(2)},\\; b_{\\mathrm{KK}}^{(2)},\\; b_{\\mathrm{wrong}}^{(2)},\\; w_{\\mathrm{correct}}^{(3)},\\; w_{\\mathrm{wrong}}^{(3)},\\; \\rho^{(3)},\\; b_{\\mathrm{KK}}^{(3)},\\; b_{\\mathrm{wrong}}^{(3)}\\bigr].\n$$\n浮点数必须以科学记数法打印，并精确到六位有效数字，布尔值必须打印为 $ \\mathrm{True} $ 或 $ \\mathrm{False} $。例如，一个浮点数应显示为 1.234570e-03，一个布尔值应显示为 $ \\mathrm{True} $。最终输出必须是包含此列表的单行，元素之间用逗号分隔，并用方括号括起来，不含任何额外文本。无需用户输入。代码必须是自包含的，并且可以在指定环境中直接运行。", "solution": "所述问题是有效的。它在科学上基于经典电磁学和线性响应理论的原理，是适定的，具有一组唯一可发现的数值结果，并且没有歧义或矛盾。我们可以开始求解。\n\n问题的核心是为一个线性、因果、无源的色散介电介质建立周期平均电场能量密度的正确表达式。标准的、非色散的电场能量密度表达式 $w_e = \\frac{1}{2} \\mathbf{D} \\cdot \\mathbf{E} = \\frac{1}{2}\\varepsilon |\\mathbf{E}|^2$ 是不充分的，因为 $\\mathbf{D}$ 和 $\\mathbf{E}$ 之间的关系是依赖于历史的（时间上非局域），这在频域中表现为频率依赖的介电常数 $\\varepsilon(\\omega)$。\n\n我们的推导始于宏观麦克斯韦方程组和表达能量守恒的坡印亭定理。在一个无源区域，微观坡印亭定理为：\n$$\n-\\nabla \\cdot (\\mathbf{E} \\times \\mathbf{H}) = \\mathbf{E} \\cdot \\frac{\\partial \\mathbf{D}}{\\partial t} + \\mathbf{H} \\cdot \\frac{\\partial \\mathbf{B}}{\\partial t}\n$$\n左边的项是流出微分体积的功率。右边的项代表场对介质做功的速率，这部分功被分为存储能量和耗散能量（热量）。我们关注电场的贡献项 $\\mathbf{E} \\cdot \\frac{\\partial \\mathbf{D}}{\\partial t}$。\n\n对于一个严格单色场，例如 $\\mathbf{E}(t) = \\operatorname{Re}[\\mathbf{E}_0 e^{-i\\omega t}]$，系统处于稳态。根据定义，存储能量变化率的周期平均为零。$\\mathbf{E} \\cdot \\frac{\\partial \\mathbf{D}}{\\partial t}$ 的周期平均只产生作为热量耗散的平均功率 $Q$。\n$$\nQ = \\langle \\mathbf{E} \\cdot \\frac{\\partial \\mathbf{D}}{\\partial t} \\rangle = \\frac{\\omega}{2} \\operatorname{Im}[\\varepsilon(\\omega)] |\\mathbf{E}_0|^2\n$$\n由于无源性要求介质不能成为能量源，我们必须有 $Q \\ge 0$，这意味着对于 $\\omega > 0$，有 $\\operatorname{Im}[\\varepsilon(\\omega)] \\ge 0$。\n\n为了求得存储能量，我们必须考虑从零开始建立场所需的能量。这需要一个非单色场。一种物理上直观且数学上严谨的方法是考虑一个准单色场，其振幅相对于其振荡周期变化缓慢。我们将这样的场表示为：\n$$\n\\mathbf{E}(t) = \\operatorname{Re}\\left[ \\mathbf{E}_0(t) e^{-i\\omega_c t} \\right]\n$$\n其中 $\\mathbf{E}_0(t)$ 是缓慢变化的复包络，$\\omega_c$ 是载波频率。因为 $\\mathbf{E}_0(t)$ 变化缓慢，其傅里叶谱 $\\mathbf{E}_0(\\omega')$ 在 $\\omega'=0$ 附近有尖锐的峰值。相应地，$\\mathbf{E}(t)$ 的频谱在 $\\omega = \\pm \\omega_c$ 附近达到峰值。\n\n频域中的本构关系是 $\\mathbf{D}(\\omega) = \\varepsilon(\\omega)\\mathbf{E}(\\omega)$。对于我们的准单色场，这意味着位移矢量包络 $\\mathbf{D}_0(t)$ 的频谱由 $\\mathbf{D}_0(\\omega') = \\varepsilon(\\omega_c + \\omega') \\mathbf{E}_0(\\omega')$ 给出。由于 $\\mathbf{E}_0(\\omega')$ 仅在小的 $\\omega'$ 处非零，我们可以在 $\\omega_c$ 附近对 $\\varepsilon(\\omega_c + \\omega')$ 进行泰勒展开：\n$$\n\\varepsilon(\\omega_c + \\omega') \\approx \\varepsilon(\\omega_c) + \\omega' \\frac{d\\varepsilon}{d\\omega}\\bigg|_{\\omega=\\omega_c}\n$$\n将此代回，我们得到：\n$$\n\\mathbf{D}_0(\\omega') \\approx \\varepsilon(\\omega_c) \\mathbf{E}_0(\\omega') + \\frac{d\\varepsilon}{d\\omega}\\bigg|_{\\omega_c} (\\omega' \\mathbf{E}_0(\\omega'))\n$$\n为了返回时域，我们应用傅里叶逆变换。频域中的乘以 $\\omega'$ 对应于时域中的算子 $i \\frac{d}{dt}$。因此，时域包络关系为：\n$$\n\\mathbf{D}_0(t) \\approx \\varepsilon(\\omega_c) \\mathbf{E}_0(t) + i \\frac{d\\varepsilon}{d\\omega}\\bigg|_{\\omega=\\omega_c} \\frac{d\\mathbf{E}_0(t)}{dt}\n$$\n现在我们计算场做功的周期平均速率 $\\langle\\mathbf{E} \\cdot \\frac{\\partial \\mathbf{D}}{\\partial t}\\rangle$。这个平均值必须等于耗散功率 $Q$ 与存储能量密度变化率 $dw_e/dt$ 之和。经过详细计算，包括代入 $\\mathbf{E}(t)$ 和 $\\mathbf{D}(t)$ 的包络表达式并在一个周期内进行平均（这将消除快速振荡项），我们发现：\n$$\n\\langle\\mathbf{E} \\cdot \\frac{\\partial \\mathbf{D}}{\\partial t}\\rangle = \\frac{\\omega_c}{2}\\operatorname{Im}[\\varepsilon(\\omega_c)]|\\mathbf{E}_0|^2 + \\frac{1}{4} \\frac{d}{dt} \\left( \\operatorname{Re}\\left[ \\frac{d}{d\\omega}(\\omega\\varepsilon(\\omega))\\right]_{\\omega=\\omega_c} |\\mathbf{E}_0|^2 \\right)\n$$\n辨识各项，第一项是耗散功率 $Q$ 的已知表达式。因此，第二项必须是存储电场能量密度的变化率 $dw_e/dt$。通过对此项进行时间积分，我们确定了周期平均电场能量密度，我们将其记为 $w_{\\mathrm{correct}}$：\n$$\nw_{\\mathrm{correct}}(\\omega) = \\frac{1}{4} \\operatorname{Re}\\left[ \\frac{d}{d\\omega}\\bigl(\\omega\\varepsilon(\\omega)\\bigr) \\right] |\\mathbf{E}_0|^2\n$$\n代入 $\\varepsilon(\\omega) = \\varepsilon_0 \\varepsilon_r(\\omega)$ 即可得到问题描述中给出的表达式。项 $\\frac{d}{d\\omega}(\\omega\\varepsilon) = \\varepsilon + \\omega\\frac{d\\varepsilon}{d\\omega}$ 包含两个贡献：第一项 $\\varepsilon$ 与瞬时场极化有关，而第二项 $\\omega\\frac{d\\varepsilon}{d\\omega}$ 则解释了存储在引起色散的振荡电荷（例如，束缚在原子中的电子）的动能和势能中的额外能量。\n\n对于无源介质，物理稳定性要求总能量密度为非负值，即 $w_{\\mathrm{correct}} \\ge 0$。介质的因果性（响应不能先于激励）意味着 $\\varepsilon_r(\\omega)$ 在复频率上半平面是一个解析函数。这一性质与无源性（对于 $\\omega > 0$，有 $\\operatorname{Im}[\\varepsilon_r(\\omega)] \\ge 0$）相结合，通过 Kramers–Kronig 关系导出了一个对任何无源介质都成立的普适结果：\n$$\n\\operatorname{Re}\\left[ \\frac{d}{d\\omega}\\bigl(\\omega\\,\\varepsilon_r(\\omega)\\bigr) \\right] \\ge 0\n$$\n这保证了正确定制的能量密度的正定性。相比之下，基于用 $\\varepsilon$ 简单替换 $\\frac{d}{d\\omega}(\\omega\\varepsilon)$ 的朴素替代方案 $w_{\\mathrm{wrong}}$ 可能会变为负值。在反常色散区域（通常出现在共振频率 $\\omega_0$ 稍高的频率处），介电常数的实部 $\\operatorname{Re}[\\varepsilon_r(\\omega)]$ 可能为负。这将意味着负的能量密度，明显违反了热力学稳定性，从而证明了为什么 $w_{\\mathrm{wrong}}$ 是一个不正确的表述。数值计算部分将展示这种物理上的荒谬性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes correct and incorrect energy densities for a dispersive Lorentz medium\n    to demonstrate the importance of the dispersive normalization term.\n    \"\"\"\n    # Define the constants from the problem statement.\n    # Vacuum permittivity in F/m\n    eps0 = 8.8541878128e-12\n    # Electric field amplitude squared in (V/m)^2\n    E0_sq = 1.0**2\n    \n    # Define the material parameters for the Lorentz model.\n    # High-frequency permittivity limit\n    eps_inf = 2.25\n    # Oscillator strength\n    delta_eps = 4.0\n    # Resonance frequency in rad/s\n    omega0 = 2.0 * np.pi * 2.0e14\n\n    # Define the test suite of parameter sets (gamma, omega).\n    # gamma is damping rate, omega is evaluation frequency.\n    test_cases = [\n        # Case 1: Far below resonance\n        (0.05 * omega0, 0.50 * omega0),\n        # Case 2: Above resonance (counterexample region)\n        (0.02 * omega0, 1.05 * omega0),\n        # Case 3: Near-resonant edge with small damping\n        (0.005 * omega0, 1.005 * omega0),\n    ]\n\n    # List to store the flat results for all cases.\n    results = []\n\n    for gamma, omega in test_cases:\n        # Use complex numbers for calculation convenience.\n        omega_c = complex(omega)\n        gamma_c = complex(gamma)\n\n        omega_sq = omega_c**2\n        omega0_sq = omega0**2\n        \n        # Denominator of the Lorentz model fraction\n        denominator = omega0_sq - omega_sq - 1j * gamma_c * omega_c\n        \n        # Calculate relative permittivity eps_r(omega)\n        eps_r = eps_inf + delta_eps * omega0_sq / denominator\n        \n        # Calculate the derivative of relative permittivity d(eps_r)/d(omega)\n        # using the provided analytical formula.\n        numerator_deriv = 2.0 * omega_c + 1j * gamma_c\n        deriv_eps_r = delta_eps * omega0_sq * numerator_deriv / (denominator**2)\n        \n        # Calculate the full dispersive term d(omega * eps_r)/d(omega)\n        d_omega_eps_r_full = eps_r + omega_c * deriv_eps_r\n        \n        # Calculate w_correct: the correct, dispersive energy density\n        w_correct = 0.25 * eps0 * E0_sq * d_omega_eps_r_full.real\n        \n        # Calculate w_wrong: the incorrect, non-dispersive surrogate\n        w_wrong = 0.25 * eps0 * E0_sq * eps_r.real\n        \n        # Calculate the ratio rho = w_wrong / w_correct with safe division.\n        # The theory guarantees w_correct >= 0. We use a small tolerance.\n        if abs(w_correct)  1e-30:\n            rho = np.inf if w_wrong != 0.0 else 0.0\n        else:\n            rho = w_wrong / w_correct\n\n        # b_KK: Check if the Kramers-Kronig-derived positivity holds.\n        b_KK = (d_omega_eps_r_full.real >= 0.0)\n        \n        # b_wrong: Check if the incorrect energy density is non-negative.\n        b_wrong = (w_wrong >= 0.0)\n        \n        # Extend the master results list with the results for this case.\n        results.extend([w_correct, w_wrong, rho, b_KK, b_wrong])\n\n    # Format the final list for printing as per the specified format.\n    formatted_results = []\n    for item in results:\n        if isinstance(item, (bool, np.bool_)):\n            # Format booleans as True/False strings.\n            formatted_results.append(str(item))\n        elif isinstance(item, (float, np.floating)):\n            # Format floats to scientific notation with 6 significant digits after the decimal point.\n            formatted_results.append(f\"{item:.6e}\")\n    \n    # The final print statement must produce only the specified single-line format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3303727"}]}