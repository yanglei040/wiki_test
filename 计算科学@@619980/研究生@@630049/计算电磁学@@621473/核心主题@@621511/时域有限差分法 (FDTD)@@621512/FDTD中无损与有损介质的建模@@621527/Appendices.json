{"hands_on_practices": [{"introduction": "任何时域有限差分（FDTD）模拟的核心都是一组在时间上步进电磁场的更新方程。对于介电常数等属性依赖于频率的色散材料，这需要对安培定律进行扩展，以包含材料的极化响应。本次实践将指导您从第一性原理出发，为一个有耗、单极点德拜（Debye）介质推导这些关键的更新方程。通过这次练习 [@problem_id:3331618]，您将掌握在FDTD中实现和理解高级材料模型所必需的基础解析技能。", "problem": "考虑一个由单极点Debye松弛模型描述的非磁性线性各向同性电介质，其在交错的Yee时间网格上使用时域有限差分(FDTD)方法进行仿真。设电场在整数时间点 $t^{n} = n \\,\\Delta t$ 更新，磁场在半整数时间点 $t^{n+\\frac{1}{2}} = \\left(n+\\tfrac{1}{2}\\right)\\Delta t$ 更新。本构关系为 $ \\mathbf{D}(t) = \\epsilon_{\\infty} \\mathbf{E}(t) + \\mathbf{P}(t) $，其中 $\\epsilon_{\\infty}$ 是高频介电常数，$\\mathbf{P}(t)$ 是极化密度，服从Debye常微分方程\n$$\n\\frac{d \\mathbf{P}}{dt} = \\frac{\\Delta \\epsilon}{\\tau} \\,\\mathbf{E}(t) - \\frac{1}{\\tau}\\,\\mathbf{P}(t),\n$$\n其中 $\\Delta \\epsilon = \\epsilon_{s} - \\epsilon_{\\infty} \\ge 0$ 是介电常数的静态增量，$\\tau  0$ 是松弛时间。该介质可以是有损的，具有均匀电导率 $\\sigma \\ge 0$，产生传导电流密度 $\\mathbf{J}_{\\mathrm{c}}(t) = \\sigma \\mathbf{E}(t)$。忽略任何外加源。\n\n从时域中的Maxwell–Ampère定律出发，\n$$\n\\frac{\\partial \\mathbf{D}}{\\partial t} = \\nabla \\times \\mathbf{H} - \\mathbf{J}_{\\mathrm{c}},\n$$\n根据以下建模和离散化假设，推导在时间 $t^{n+1}$ 的电场 $\\mathbf{E}^{n+1}$ 的全显式更新公式，该公式用时间层 $t^{n}$ 和 $t^{n+\\frac{1}{2}}$ 的已知量表示。所有这些假设都必须在您的推导中使用并加以说明：\n\n- 假设电场在此区间内在其交错更新层 $t^{n}$ 处是时间上的分段常数，通过对区间 $[t^{n}, t^{n+1}]$ 上的精确时间积分来处理极化动力学。\n- 在时间区间 $[t^{n}, t^{n+1}]$ 上以与Yee网格交错一致的形式离散化Maxwell–Ampère定律，使得 $\\mathbf{H}$ 的离散旋度在 $t^{n+\\frac{1}{2}}$ 处求值，而其余各项则在整数时间点表示。\n- 为在存在传导的情况下保持二阶精度，使用时间上的梯形法则来近似区间上的传导电流，即，使用 $\\mathbf{E}^{n}$ 和 $\\mathbf{E}^{n+1}$ 的平均值。\n\n您的最终更新公式必须具有仿射形式\n$$\n\\mathbf{E}^{n+1} = C_{E}\\,\\mathbf{E}^{n} + C_{H}\\,\\left(\\nabla \\times \\mathbf{H}\\right)^{n+\\frac{1}{2}} + C_{P}\\,\\mathbf{P}^{n},\n$$\n其中标量系数 $C_{E}$、$C_{H}$ 和 $C_{P}$ 表示为 $\\epsilon_{\\infty}$、$\\Delta \\epsilon$、$\\tau$、$\\sigma$ 和 $\\Delta t$ 的闭合形式函数。将这三个系数报告为一个单行向量。不得代入任何数值；只提供精确的解析表达式。答案必须是无量纲的，并且必须精确表示，不得舍入。在您的推导中，从上述定律和定义出发，不要调用任何非从这些第一性原理获得的、预先推导出的更新捷径。", "solution": "该问题要求在以单极点Debye松弛为特征的有损、色散电介质中，推导电场 $\\mathbf{E}$ 的显式时域有限差分(FDTD)更新方程。推导必须从Maxwell方程组出发，并遵守特定的离散化假设。\n\n验证步骤确认了该问题具有科学依据、是适定的、客观且完整的。它代表了计算电磁学中一个标准的、不平凡的任务。因此，我们开始进行求解。\n\n推导从Maxwell–Ampère定律开始，其形式如下：\n$$\n\\frac{\\partial \\mathbf{D}}{\\partial t} = \\nabla \\times \\mathbf{H} - \\mathbf{J}_{\\mathrm{c}}\n$$\n这里，$\\mathbf{D}$ 是电位移场，$\\mathbf{H}$ 是磁场，$\\mathbf{J}_{\\mathrm{c}}$ 是传导电流密度。为了在时间上离散化该方程，我们将其在时间区间 $[t^{n}, t^{n+1}]$ 上进行积分，其中 $t^n = n \\Delta t$。\n$$\n\\int_{t^{n}}^{t^{n+1}} \\frac{\\partial \\mathbf{D}}{\\partial t} dt = \\int_{t^{n}}^{t^{n+1}} (\\nabla \\times \\mathbf{H}) dt - \\int_{t^{n}}^{t^{n+1}} \\mathbf{J}_{\\mathrm{c}} dt\n$$\n左侧可以通过微积分基本定理精确计算：\n$$\n\\mathbf{D}(t^{n+1}) - \\mathbf{D}(t^{n}) = \\mathbf{D}^{n+1} - \\mathbf{D}^{n}\n$$\n对于右侧的各项，我们应用指定的离散化规则。\n首先，磁场项根据Yee网格进行离散化，其中 $\\mathbf{H}$ 在半整数时间步长处求值。通过假设被积函数在区间中点 $t^{n+\\frac{1}{2}}$ 处的值为常数，该积分使用中点法则进行近似，这在 $\\Delta t$ 上是二阶精确的：\n$$\n\\int_{t^{n}}^{t^{n+1}} (\\nabla \\times \\mathbf{H}) dt \\approx (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} \\, \\Delta t\n$$\n其次，根据问题陈述中的规定，传导电流项的积分使用梯形法则进行近似。这也是二阶精确的。给定 $\\mathbf{J}_{\\mathrm{c}}(t) = \\sigma \\mathbf{E}(t)$，我们有：\n$$\n\\int_{t^{n}}^{t^{n+1}} \\mathbf{J}_{\\mathrm{c}}(t) dt \\approx \\frac{\\Delta t}{2} \\left(\\mathbf{J}_{\\mathrm{c}}^{n} + \\mathbf{J}_{\\mathrm{c}}^{n+1}\\right) = \\frac{\\sigma \\Delta t}{2} \\left(\\mathbf{E}^{n} + \\mathbf{E}^{n+1}\\right)\n$$\n将这些近似代入积分后的Maxwell-Ampère定律，得到：\n$$\n\\mathbf{D}^{n+1} - \\mathbf{D}^{n} = (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} \\, \\Delta t - \\frac{\\sigma \\Delta t}{2} \\left(\\mathbf{E}^{n} + \\mathbf{E}^{n+1}\\right)\n$$\n接下来，我们引入Debye介质的本构关系：$\\mathbf{D}(t) = \\epsilon_{\\infty} \\mathbf{E}(t) + \\mathbf{P}(t)$。将其应用于时间步长 $n$ 和 $n+1$：\n$$\n\\mathbf{D}^n = \\epsilon_{\\infty} \\mathbf{E}^n + \\mathbf{P}^n\n$$\n$$\n\\mathbf{D}^{n+1} = \\epsilon_{\\infty} \\mathbf{E}^{n+1} + \\mathbf{P}^{n+1}\n$$\n将这些代入离散化的Maxwell方程，得到：\n$$\n(\\epsilon_{\\infty} \\mathbf{E}^{n+1} + \\mathbf{P}^{n+1}) - (\\epsilon_{\\infty} \\mathbf{E}^{n} + \\mathbf{P}^{n}) = (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} \\, \\Delta t - \\frac{\\sigma \\Delta t}{2} (\\mathbf{E}^{n} + \\mathbf{E}^{n+1})\n$$\n这个方程包含未知的极化量 $\\mathbf{P}^{n+1}$。为了找到它的表达式，我们必须求解极化密度 $\\mathbf{P}(t)$ 的Debye常微分方程：\n$$\n\\frac{d \\mathbf{P}}{dt} = \\frac{\\Delta \\epsilon}{\\tau} \\mathbf{E}(t) - \\frac{1}{\\tau}\\mathbf{P}(t) \\implies \\frac{d \\mathbf{P}}{dt} + \\frac{1}{\\tau}\\mathbf{P}(t) = \\frac{\\Delta \\epsilon}{\\tau} \\mathbf{E}(t)\n$$\n问题要求在假设电场 $\\mathbf{E}(t)$ 在区间 $[t^n, t^{n+1}]$ 上是分段常数，并取其在区间开始时的值，即对于 $t \\in [t^n, t^{n+1}]$ 有 $\\mathbf{E}(t) = \\mathbf{E}^n$ 的前提下，对此常微分方程进行精确积分。在此假设下，该常微分方程变成一个带常数强迫项的一阶线性微分方程：\n$$\n\\frac{d \\mathbf{P}}{dt} + \\frac{1}{\\tau}\\mathbf{P}(t) = \\frac{\\Delta \\epsilon}{\\tau} \\mathbf{E}^n\n$$\n对于形式为 $y'(t) + a y(t) = C$ 且初始条件为 $y(t_0) = y_0$ 的常微分方程，其通解为 $y(t) = (y_0 - C/a) \\exp(-a(t-t_0)) + C/a$。在这里，$y(t) = \\mathbf{P}(t)$, $a = 1/\\tau$, $C = (\\Delta \\epsilon / \\tau) \\mathbf{E}^n$，初始条件为 $\\mathbf{P}(t^n) = \\mathbf{P}^n$。项 $C/a$ 为 $\\Delta \\epsilon \\mathbf{E}^n$。\n在该区间内 $\\mathbf{P}(t)$ 的解为：\n$$\n\\mathbf{P}(t) = \\left(\\mathbf{P}^n - \\Delta \\epsilon \\mathbf{E}^n\\right) \\exp\\left(-\\frac{t-t^n}{\\tau}\\right) + \\Delta \\epsilon \\mathbf{E}^n\n$$\n我们需要 $\\mathbf{P}^{n+1} = \\mathbf{P}(t^{n+1})$，通过设置 $t = t^{n+1} = t^n + \\Delta t$ 可以得到：\n$$\n\\mathbf{P}^{n+1} = \\left(\\mathbf{P}^n - \\Delta \\epsilon \\mathbf{E}^n\\right) \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right) + \\Delta \\epsilon \\mathbf{E}^n\n$$\n重新整理此式可得极化的更新方程：\n$$\n\\mathbf{P}^{n+1} = \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right) \\mathbf{P}^n + \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{E}^n\n$$\n现在我们将 $\\mathbf{P}^{n+1}$ 的这个表达式代回主离散方程中。首先，我们重新整理主方程以分离出包含 $\\mathbf{E}^{n+1}$ 的项：\n$$\n\\epsilon_{\\infty} \\mathbf{E}^{n+1} + \\frac{\\sigma \\Delta t}{2} \\mathbf{E}^{n+1} = \\epsilon_{\\infty} \\mathbf{E}^{n} - \\frac{\\sigma \\Delta t}{2} \\mathbf{E}^{n} + (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} \\, \\Delta t + \\mathbf{P}^n - \\mathbf{P}^{n+1}\n$$\n让我们计算项 $\\mathbf{P}^n - \\mathbf{P}^{n+1}$：\n$$\n\\mathbf{P}^n - \\mathbf{P}^{n+1} = \\mathbf{P}^n - \\left[ \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right) \\mathbf{P}^n + \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{E}^n \\right]\n$$\n$$\n\\mathbf{P}^n - \\mathbf{P}^{n+1} = \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{P}^n - \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{E}^n\n$$\n将此代入 $\\mathbf{E}^{n+1}$ 的方程中：\n$$\n\\left(\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}\\right) \\mathbf{E}^{n+1} = \\left(\\epsilon_{\\infty} - \\frac{\\sigma \\Delta t}{2}\\right) \\mathbf{E}^{n} + (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} \\, \\Delta t + \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{P}^n - \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{E}^n\n$$\n现在，我们将右侧 $\\mathbf{E}^n$ 的系数组合在一起：\n$$\n\\left(\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}\\right) \\mathbf{E}^{n+1} = \\left[ \\left(\\epsilon_{\\infty} - \\frac{\\sigma \\Delta t}{2}\\right) - \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\right] \\mathbf{E}^{n} + \\Delta t (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} + \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{P}^n\n$$\n最后，我们通过除以左侧的因子来求解 $\\mathbf{E}^{n+1}$，以获得所需的仿射形式 $\\mathbf{E}^{n+1} = C_{E}\\,\\mathbf{E}^{n} + C_{H}\\,\\left(\\nabla \\times \\mathbf{H}\\right)^{n+\\frac{1}{2}} + C_{P}\\,\\mathbf{P}^{n}$。\n各系数被确定为：\n$$\nC_{E} = \\frac{\\left(\\epsilon_{\\infty} - \\frac{\\sigma \\Delta t}{2}\\right) - \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right)}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}\n$$\n$$\nC_{H} = \\frac{\\Delta t}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}\n$$\n$$\nC_{P} = \\frac{1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}\n$$\n这就是用于 $\\mathbf{E}^{n+1}$ 显式更新方程的三个标量系数。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{\\epsilon_{\\infty} - \\frac{\\sigma \\Delta t}{2} - \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right)}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}  \\frac{\\Delta t}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}  \\frac{1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}\n\\end{pmatrix}\n}\n$$", "id": "3331618"}, {"introduction": "在掌握了基本的更新方案之后，我们现在将探索一种更精确的方法来处理频率相关的极化现象。本次实践引入了分段线性递归卷积（PLRC）技术，它通过假设电场在一个时间步内呈线性变化，从而改进了简单的分段常数近似。这项练习 [@problem_id:3331560] 不仅要求您推导新的更新权重，还要求您分析因截断卷积历史而产生的数值误差，这是实现内存高效的实用算法时的一个关键考量。", "problem": "考虑一个在时域有限差分（FDTD）方法中建模的、不含静态电导率的单极点Debye电介质。位移场的本构关系为\n$$\n\\mathbf{D}(t) = \\varepsilon_0 \\varepsilon_{\\infty} \\mathbf{E}(t) + \\varepsilon_0 \\Delta \\varepsilon \\int_{0}^{t} \\frac{1}{\\tau} \\exp\\!\\left(-\\frac{t-t'}{\\tau}\\right) \\mathbf{E}(t')\\, dt',\n$$\n其中 $\\varepsilon_0$ 是自由空间介电常数，$\\varepsilon_{\\infty}$ 是光学极限相对介电常数，$\\Delta \\varepsilon = \\varepsilon_s - \\varepsilon_{\\infty}$ 是Debye强度，$\\tau$ 是弛豫时间。定义归一化的Debye卷积积分\n$$\nI(t) = \\int_{0}^{t} \\frac{1}{\\tau} \\exp\\!\\left(-\\frac{t-t'}{\\tau}\\right) E(t')\\, dt',\n$$\n因此 $\\mathbf{D}(t) = \\varepsilon_0 \\varepsilon_{\\infty} \\mathbf{E}(t) + \\varepsilon_0 \\Delta \\varepsilon\\, I(t)\\, \\hat{\\mathbf{e}}$，其中 $E(t)$ 是电场的单个笛卡尔分量，$\\hat{\\mathbf{e}}$ 是相应的单位矢量。\n\n令 $t_n = n \\Delta t$，其中时间步长 $\\Delta t$ 为常数。在分段线性递归卷积（PLRC）方法中，$E(t)$ 在每个区间 $[t_{n-1}, t_n]$ 上被近似为线性函数。仅使用此线性近似和上述指数Debye核，从第一性原理出发，为离散采样 $I^n \\equiv I(t_n)$ 推导出一个形式如下的单步递归关系\n$$\nI^n = \\kappa\\, I^{n-1} + w_0 E^n + w_1 E^{n-1},\n$$\n其中权重 $w_0$ 和 $w_1$ 仅依赖于 $\\Delta t$ 和 $\\tau$，而 $\\kappa$ 是指数衰减因子。然后：\n\n1) 对于 $\\tau = 0.5\\ \\mathrm{ns}$ 和 $\\Delta t = 10\\ \\mathrm{ps}$，计算PLRC权重 $w_0$ 和 $w_1$ 的数值。将 $w_0$ 和 $w_1$ 以无量纲数的形式报告，并将每个值四舍五入到六位有效数字。\n\n2) 假设在仅保留递归的最近 $M$ 项后，完整的PLRC历史被截断，即，比 $M$ 步更早的贡献被舍弃。假设离散电场采样对于所有 $n$ 都满足 $|E^n| \\le E_{\\max}$，其中 $E_{\\max}$ 是一个已知上界，单位为伏特/米。推导 $I^n$ 中截断误差大小的解析上界，该上界是 $M$、$\\Delta t$、$\\tau$ 和 $E_{\\max}$ 的函数。将你的上界表示为闭式表达式，且最终的上界表达式中不包含单位。\n\n在你的推导中使用简写 $\\alpha \\equiv \\Delta t/\\tau$ 和 $\\kappa \\equiv \\exp(-\\alpha)$。你的最终答案必须由一个行矩阵构成，按顺序包含 $w_0$ 和 $w_1$ 的四舍五入后的数值，以及你推导出的以 $M$、$\\Delta t$、$\\tau$ 和 $E_{\\max}$ 表示的闭式解析上界。", "solution": "该问题要求得到关于在FDTD中单极点Debye电介质模型的分段线性递归卷积（PLRC）实现的两个主要结果。第一，递归更新系数的推导和数值计算。第二，递归卷积截断误差的解析上界。\n\n第1部分：PLRC递归关系和系数的推导\n\n归一化的Debye卷积积分由下式给出\n$$ I(t) = \\int_{0}^{t} \\frac{1}{\\tau} \\exp\\left(-\\frac{t-t'}{\\tau}\\right) E(t')\\, dt' $$\n我们希望找到离散采样 $I^n \\equiv I(t_n)$ 的递归关系，其中 $t_n = n\\Delta t$。\n我们可以通过在 $t' = t_{n-1}$ 处分割积分来写出 $I(t_n)$：\n$$ I^n = \\int_{0}^{t_{n-1}} \\frac{1}{\\tau} \\exp\\left(-\\frac{t_n-t'}{\\tau}\\right) E(t')\\, dt' + \\int_{t_{n-1}}^{t_n} \\frac{1}{\\tau} \\exp\\left(-\\frac{t_n-t'}{\\tau}\\right) E(t')\\, dt' $$\n我们来分析第一个积分项。通过提出对应一个时间步长的项，我们得到：\n$$ \\int_{0}^{t_{n-1}} \\frac{1}{\\tau} \\exp\\left(-\\frac{t_n-t_{n-1}}{\\tau}\\right) \\exp\\left(-\\frac{t_{n-1}-t'}{\\tau}\\right) E(t')\\, dt' $$\n$$ = \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right) \\int_{0}^{t_{n-1}} \\frac{1}{\\tau} \\exp\\left(-\\frac{t_{n-1}-t'}{\\tau}\\right) E(t')\\, dt' $$\n这个表达式正好是 $\\exp(-\\Delta t/\\tau) I(t_{n-1})$。使用给定的简写 $\\kappa \\equiv \\exp(-\\Delta t/\\tau)$，该项为 $\\kappa I^{n-1}$。\n因此，递归关系开始为：\n$$ I^n = \\kappa I^{n-1} + \\int_{t_{n-1}}^{t_n} \\frac{1}{\\tau} \\exp\\left(-\\frac{t_n-t'}{\\tau}\\right) E(t')\\, dt' $$\n剩下的任务是计算最近一个时间区间 $[t_{n-1}, t_n]$ 上的积分。PLRC方法将电场 $E(t')$ 在此区间上近似为一个线性函数：\n$$ E(t') \\approx E^{n-1} + \\frac{E^n - E^{n-1}}{\\Delta t} (t' - t_{n-1}) \\quad \\text{for } t_{n-1} \\le t' \\le t_n $$\n我们将此代入积分。为方便起见，我们进行变量替换 $s = t_n - t'$，这意味着 $t' = t_n - s$ 且 $dt' = -ds$。积分上下限从 $t' \\in [t_{n-1}, t_n]$ 变为 $s \\in [\\Delta t, 0]$。\n积分变为：\n$$ \\Delta I^n = \\frac{1}{\\tau} \\int_{\\Delta t}^{0} \\exp\\left(-\\frac{s}{\\tau}\\right) \\left[ E^{n-1} + \\frac{E^n - E^{n-1}}{\\Delta t} (t_n - s - t_{n-1}) \\right] (-ds) $$\n$$ \\Delta I^n = \\frac{1}{\\tau} \\int_{0}^{\\Delta t} \\exp\\left(-\\frac{s}{\\tau}\\right) \\left[ E^{n-1} + \\frac{E^n - E^{n-1}}{\\Delta t} (\\Delta t - s) \\right] ds $$\n重新整理方括号中的项，按 $E^n$ 和 $E^{n-1}$ 分组：\n$$ E^{n-1} + (E^n - E^{n-1}) - \\frac{E^n - E^{n-1}}{\\Delta t}s = E^n - \\frac{E^n - E^{n-1}}{\\Delta t}s $$\n所以积分为：\n$$ \\Delta I^n = \\frac{1}{\\tau} \\int_{0}^{\\Delta t} \\exp\\left(-\\frac{s}{\\tau}\\right) \\left[ E^n - \\frac{E^n - E^{n-1}}{\\Delta t}s \\right] ds $$\n$$ \\Delta I^n = \\frac{E^n}{\\tau} \\int_{0}^{\\Delta t} \\exp\\left(-\\frac{s}{\\tau}\\right) ds - \\frac{E^n - E^{n-1}}{\\tau \\Delta t} \\int_{0}^{\\Delta t} s \\exp\\left(-\\frac{s}{\\tau}\\right) ds $$\n我们计算这两个定积分。\n第一个积分为：\n$$ \\int_{0}^{\\Delta t} \\exp\\left(-\\frac{s}{\\tau}\\right) ds = \\left[-\\tau \\exp\\left(-\\frac{s}{\\tau}\\right)\\right]_{0}^{\\Delta t} = \\tau\\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) $$\n第二个积分使用分部积分法 $\\int u dv = uv - \\int v du$ 计算，其中 $u=s$ 且 $dv = \\exp(-s/\\tau)ds$：\n$$ \\int_{0}^{\\Delta t} s \\exp\\left(-\\frac{s}{\\tau}\\right) ds = \\left[-s\\tau \\exp\\left(-\\frac{s}{\\tau}\\right)\\right]_{0}^{\\Delta t} + \\int_{0}^{\\Delta t} \\tau \\exp\\left(-\\frac{s}{\\tau}\\right)ds $$\n$$ = -\\Delta t \\tau \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right) + \\tau \\left[ \\tau\\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\right] $$\n$$ = \\tau^2 \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) - \\Delta t \\tau \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right) $$\n将这些结果代入 $\\Delta I^n$ 的表达式中：\n$$ \\Delta I^n = \\frac{E^n}{\\tau} \\left[\\tau(1-\\kappa)\\right] - \\frac{E^n - E^{n-1}}{\\tau \\Delta t} \\left[ \\tau^2(1-\\kappa) - \\Delta t \\tau \\kappa \\right] $$\n$$ \\Delta I^n = E^n (1-\\kappa) - \\left(E^n - E^{n-1}\\right) \\left[ \\frac{\\tau}{\\Delta t}(1-\\kappa) - \\kappa \\right] $$\n使用 $\\alpha \\equiv \\Delta t/\\tau$，这可以简化为：\n$$ \\Delta I^n = E^n (1-\\kappa) - \\left(E^n - E^{n-1}\\right) \\left[ \\frac{1-\\kappa}{\\alpha} - \\kappa \\right] $$\n现在我们可以通过识别 $E^n$ 和 $E^{n-1}$ 的系数来找到 $w_0$ 和 $w_1$：\n$$ \\Delta I^n = E^n \\left( (1-\\kappa) - \\left(\\frac{1-\\kappa}{\\alpha} - \\kappa\\right) \\right) + E^{n-1} \\left( \\frac{1-\\kappa}{\\alpha} - \\kappa \\right) $$\n系数为：\n$$ w_0 = 1 - \\kappa - \\frac{1-\\kappa}{\\alpha} + \\kappa = 1 - \\frac{1-\\kappa}{\\alpha} = 1 - \\frac{1-\\exp(-\\Delta t/\\tau)}{\\Delta t/\\tau} $$\n$$ w_1 = \\frac{1-\\kappa}{\\alpha} - \\kappa = \\frac{1-\\exp(-\\Delta t/\\tau)}{\\Delta t/\\tau} - \\exp(-\\Delta t/\\tau) $$\n完整的递归关系是 $I^n = \\kappa I^{n-1} + w_0 E^n + w_1 E^{n-1}$。\n\n对于数值计算，我们有 $\\tau = 0.5\\ \\mathrm{ns} = 0.5 \\times 10^{-9}\\ \\mathrm{s}$ 和 $\\Delta t = 10\\ \\mathrm{ps} = 10 \\times 10^{-12}\\ \\mathrm{s}$。\n无量纲参数 $\\alpha$ 是：\n$$ \\alpha = \\frac{\\Delta t}{\\tau} = \\frac{10 \\times 10^{-12}\\ \\mathrm{s}}{0.5 \\times 10^{-9}\\ \\mathrm{s}} = \\frac{10}{500} = 0.02 $$\n指数衰减因子 $\\kappa$ 是：\n$$ \\kappa = \\exp(-\\alpha) = \\exp(-0.02) \\approx 0.98019867 $$\n现在我们计算权重 $w_0$ 和 $w_1$：\n$$ w_0 = 1 - \\frac{1 - \\exp(-0.02)}{0.02} \\approx 1 - \\frac{1 - 0.98019867}{0.02} \\approx 1 - 0.99006634 = 0.00993366 $$\n$$ w_1 = \\frac{1 - \\exp(-0.02)}{0.02} - \\exp(-0.02) \\approx 0.99006634 - 0.98019867 = 0.00986767 $$\n使用更高精度并四舍五入到六位有效数字：\n$w_0 \\approx 0.00993367$\n$w_1 \\approx 0.00986766$\n\n第2部分：截断误差界\n\n完整的递归关系是 $I^n = \\kappa I^{n-1} + \\Delta I^n$，其中 $\\Delta I^n = w_0 E^n + w_1 E^{n-1}$。\n通过重复应用递归关系，我们可以用 $I^{n-M}$ 来表示 $I^n$：\n$$ I^n = \\kappa^M I^{n-M} + \\sum_{j=0}^{M-1} \\kappa^j \\Delta I^{n-j} $$\n在 $M$ 项后截断递归意味着我们忽略了早于 $t_{n-M}$ 时刻的贡献。这等同于在上述公式中设置 $I^{n-M}=0$，从而得到截断值 $I^n_{\\text{trunc}}$。\n$$ I^n_{\\text{trunc}} = \\sum_{j=0}^{M-1} \\kappa^j \\Delta I^{n-j} $$\n截断误差 $\\mathcal{E}^n$ 是精确值与截断值之差：\n$$ \\mathcal{E}^n = I^n - I^n_{\\text{trunc}} = \\kappa^M I^{n-M} $$\n为了找到这个误差大小的上界，即 $|\\mathcal{E}^n| = \\kappa^M |I^{n-M}|$，我们需要找到 $|I^{n-M}|$ 的上界。\n从卷积积分的定义可知：\n$$ I^{n-M} = I(t_{n-M}) = \\int_{0}^{t_{n-M}} \\frac{1}{\\tau} \\exp\\left(-\\frac{t_{n-M}-t'}{\\tau}\\right) E(t')\\, dt' $$\n我们已知电场的大小是有界的，即对于所有的 $k$ 都有 $|E^k| \\le E_{\\max}$。由于在PLRC方案中 $E(t')$ 是离散值之间的线性插值，其大小也受 $E_{\\max}$ 的限制：对于所有 $t' \\ge 0$ 都有 $|E(t')| \\le E_{\\max}$。\n取积分的绝对值：\n$$ |I^{n-M}| \\le \\int_{0}^{t_{n-M}} \\frac{1}{\\tau} \\left|\\exp\\left(-\\frac{t_{n-M}-t'}{\\tau}\\right) E(t')\\right|\\, dt' \\le \\frac{E_{\\max}}{\\tau} \\int_{0}^{t_{n-M}} \\exp\\left(-\\frac{t_{n-M}-t'}{\\tau}\\right) dt' $$\n该积分的计算结果为：\n$$ \\int_{0}^{t_{n-M}} \\exp\\left(-\\frac{t_{n-M}-t'}{\\tau}\\right) dt' = \\left[\\tau \\exp\\left(-\\frac{t_{n-M}-t'}{\\tau}\\right)\\right]_{0}^{t_{n-M}} = \\tau (1 - \\exp(-t_{n-M}/\\tau)) $$\n因此，我们得到上界：\n$$ |I^{n-M}| \\le E_{\\max} \\left(1 - \\exp(-t_{n-M}/\\tau)\\right) $$\n对于长时间运行的仿真，$t_{n-M} \\to \\infty$，指数项消失。$I^{n-M}$ 的最坏情况下的幅值在稳态直流极限（$E(t)=E_{\\text{const}}$）下达到，此时 $I(t) \\to E_{\\text{const}}$。因此上界为 $|I^{n-M}| \\le E_{\\max}$。\n将此代入误差表达式：\n$$ |\\mathcal{E}^n| \\le \\kappa^M E_{\\max} = \\exp(-M \\Delta t/\\tau) E_{\\max} $$\n这就是所求的截断误差大小的解析上界。它是一个依赖于 $M$、$\\Delta t$、$\\tau$ 和 $E_{\\max}$ 的闭式表达式。\n最终答案需要这两个数值权重和这个误差界表达式。\n\n数值四舍五入到六位有效数字：\n$w_0 = 1 - (1 - \\exp(-0.02))/0.02 \\approx 0.00993367$\n$w_1 = (1 - \\exp(-0.02))/0.02 - \\exp(-0.02) \\approx 0.00986766$\n\n解析误差界：$E_{\\max} \\exp(-M \\Delta t / \\tau)$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.00993367  0.00986766  E_{\\max} \\exp\\left(-\\frac{M \\Delta t}{\\tau}\\right)\n\\end{pmatrix}\n}\n$$", "id": "3331560"}, {"introduction": "真实的模拟场景常常涉及与FDTD网格不一致的材料界面，这会导致所谓的“阶梯”误差。我们最后的实践将焦点从时间更新转移到空间域，解决如何精确表示这类倾斜界面的挑战。通过一个引导性的数值实验 [@problem_id:3331577]，您将比较两种常见的子单元平均技术，并量化它们在满足电磁场边界条件方面的效果，从而对共形FDTD方法的原理获得具体的认识。", "problem": "考虑一个用于时域有限差分（FDTD）法的二维Yee单元。FDTD法是一种在时域中求解麦克斯韦方程组的交错网格算法。该正方形单元的边长为 $\\Delta$，在 $(x,y)$ 平面上的顶点坐标为 $(\\pm \\Delta/2, \\pm \\Delta/2)$。一个平面材料界面沿直线 $\\hat{\\mathbf{n}}\\cdot \\mathbf{r} = 0$ 切割该单元，该直线穿过单元中心。其中，单位法向量为 $\\hat{\\mathbf{n}} = (\\cos \\theta, \\sin \\theta)$，$\\theta$ 是法向量相对于 $x$ 轴的角度（以弧度为单位）。在 $\\hat{\\mathbf{n}}\\cdot \\mathbf{r}  0$ 一侧的介质，其介电常数为 $\\epsilon_1$，电导率为 $\\sigma_1$；在 $\\hat{\\mathbf{n}}\\cdot \\mathbf{r}  0$ 一侧的介质，其介电常数为 $\\epsilon_2$，电导率为 $\\sigma_2$。假设存在角频率为 $\\omega = 2\\pi f$（频率 $f$ 的单位为 $\\mathrm{Hz}$）的时谐场，并定义复介电常数 $\\epsilon_c = \\epsilon - i \\sigma/\\omega$ 以统一处理无损耗和有损耗材料。\n\n在用于二维横磁（TM）模式（磁场垂直于平面）的Yee单元中，平面内电场由位于正方形四条边中心的分量表示：顶边位于 $y = \\Delta/2$，底边位于 $y = -\\Delta/2$，左边位于 $x = -\\Delta/2$，右边位于 $x = \\Delta/2$。当界面切割单元时，为边中心的电场更新分配材料属性需要一种插值策略。考虑以下两种策略：\n\n1. 体积加权插值：通过根据单元内两种介质的面积分数对 $\\epsilon_{c,1}$ 和 $\\epsilon_{c,2}$ 进行加权，为所有边分配一个单一的有效复介电常数。对于穿过正方形中心的直线界面，每种介质的面积分数均为 $1/2$，因此有效复介电常数为 $\\epsilon_{c,\\mathrm{vol}} = \\frac{1}{2}\\epsilon_{c,1} + \\frac{1}{2}\\epsilon_{c,2}$。\n\n2. 边加权插值：通过根据每条边位于各介质中的边长分数对 $\\epsilon_{c,1}$ 和 $\\epsilon_{c,2}$ 进行加权，为每条边分配一个有效复介电常数。对于给定端点为 $\\mathbf{r}_1$ 和 $\\mathbf{r}_2$ 的边 $e$，定义有符号值 $s_1 = \\hat{\\mathbf{n}}\\cdot \\mathbf{r}_1$ 和 $s_2 = \\hat{\\mathbf{n}}\\cdot \\mathbf{r}_2$。位于 $\\hat{\\mathbf{n}}\\cdot \\mathbf{r}  0$ 介质中的边长分数（记为 $f_e$）定义如下：如果 $s_1  0$ 且 $s_2  0$，则 $f_e = 1$；如果 $s_1  0$ 且 $s_2  0$，则 $f_e = 0$；如果 $s_1$ 和 $s_2$ 符号相反，则 $f_e$ 等于 $\\hat{\\mathbf{n}}\\cdot \\mathbf{r}  0$ 的线段部分所占的分数，即如果 $s_2  0$，则 $f_e = s_2/(s_2 - s_1)$，如果 $s_1  0$，则 $f_e = s_1/(s_1 - s_2)$。如果 $s_1 = s_2 = 0$，则设 $f_e = 1/2$。那么，边 $e$ 的边加权有效复介电常数为 $\\epsilon_{c,\\mathrm{edge}}(e) = (1 - f_e)\\epsilon_{c,1} + f_e \\epsilon_{c,2}$。\n\n在斜角下边界条件的执行情况，通过无自由表面电荷时的法向通量连续性条件来量化，即广义法向通量 $\\epsilon_c E_n$ 在界面上的连续性，其中 $E_n$ 是电场相对于 $\\hat{\\mathbf{n}}$ 的法向分量。如果两种介质中的真实场为 $\\mathbf{E}_1 = E_t \\hat{\\mathbf{t}} + E_{n,1} \\hat{\\mathbf{n}}$ 和 $\\mathbf{E}_2 = E_t \\hat{\\mathbf{t}} + E_{n,2} \\hat{\\mathbf{n}}$，其中单位切向量为 $\\hat{\\mathbf{t}} = (-\\sin \\theta, \\cos \\theta)$，则精确的连续性条件得出 $E_{n,2} = (\\epsilon_{c,1}/\\epsilon_{c,2}) E_{n,1}$，而切向分量 $E_t$ 是连续的。跨越两种介质的边 $e$ 上的离散Yee边变量无法表示法向分量的跳变；相反，单个边值隐式地表示了跨边的加权平均值：$E_{n,\\mathrm{edge}}(e) = (1 - f_e) E_{n,1} + f_e E_{n,2}$。定义参考法向通量 $D_{n,0} = \\epsilon_{c,1} E_{n,1}$，根据连续性条件，它也等于 $\\epsilon_{c,2} E_{n,2}$。在选定的插值策略下，为边分配了 $\\epsilon_{c,\\mathrm{eff}}$，则边 $e$ 上的离散化法向通量为 $\\epsilon_{c,\\mathrm{eff}}(e) E_{n,\\mathrm{edge}}(e)$。边 $e$ 上的归一化残差为\n$$\nr_e = \\left| \\frac{\\epsilon_{c,\\mathrm{eff}}(e) E_{n,\\mathrm{edge}}(e)}{D_{n,0}} - 1 \\right|,\n$$\n其中 $|\\cdot|$ 表示复数的模。通过均方根值将所有四条边上的执行误差进行汇总\n$$\nR = \\sqrt{ \\frac{1}{4} \\sum_{e \\in \\{\\mathrm{top}, \\mathrm{bottom}, \\mathrm{left}, \\mathrm{right}\\}} r_e^2 }.\n$$\n计算体积加权策略的 $R_{\\mathrm{vol}}$ 和边加权策略的 $R_{\\mathrm{edge}}$。在前者中，所有边使用 $\\epsilon_{c,\\mathrm{eff}}(e) = \\epsilon_{c,\\mathrm{vol}}$；在后者中，使用每条边的 $\\epsilon_{c,\\mathrm{edge}}(e)$。使用 $E_{n,1} = 1$ $\\mathrm{V}/\\mathrm{m}$，因此 $D_{n,0} = \\epsilon_{c,1}$。\n\n设计一个程序，对于给定的一组参数 $(\\Delta,\\theta,\\epsilon_1,\\sigma_1,\\epsilon_2,\\sigma_2,f)$，计算 $R_{\\mathrm{vol}}$ 和 $R_{\\mathrm{edge}}$ 作为无量纲浮点数。角度必须以弧度为单位提供，介电常数以 $\\mathrm{F}/\\mathrm{m}$ 为单位，电导率以 $\\mathrm{S}/\\mathrm{m}$ 为单位，频率以 $\\mathrm{Hz}$ 为单位，$\\Delta$ 以 $\\mathrm{m}$ 为单位。\n\n测试套件：\n使用真空介电常数 $\\epsilon_0 = 8.854187817\\times 10^{-12}\\,\\mathrm{F}/\\mathrm{m}$。在所有情况下，令 $\\Delta = 1\\,\\mathrm{m}$。评估以下四个测试用例：\n\n1. 斜角，中等对比度，弱损耗：$\\theta = \\pi/4$，$\\epsilon_1 = 2.5 \\epsilon_0$，$\\sigma_1 = 0$，$\\epsilon_2 = 6 \\epsilon_0$，$\\sigma_2 = 0.01$，$f = 1\\times 10^{9}$。\n\n2. 界面法线沿 $x$ 轴，无损耗：$\\theta = 0$，$\\epsilon_1 = 1 \\epsilon_0$，$\\sigma_1 = 0$，$\\epsilon_2 = 4 \\epsilon_0$，$\\sigma_2 = 0$，$f = 5\\times 10^{9}$。\n\n3. 界面法线沿 $y$ 轴，不对称损耗：$\\theta = \\pi/2$，$\\epsilon_1 = 2 \\epsilon_0$，$\\sigma_1 = 0.1$，$\\epsilon_2 = 10 \\epsilon_0$，$\\sigma_2 = 0$，$f = 1\\times 10^{8}$。\n\n4. 大斜角 ($80^\\circ$)，高对比度和高损耗：$\\theta = 80\\pi/180$，$\\epsilon_1 = 1.5 \\epsilon_0$，$\\sigma_1 = 0$，$\\epsilon_2 = 12 \\epsilon_0$，$\\sigma_2 = 0.5$，$f = 2\\times 10^{9}$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个含四个元素的列表，每个元素对应一个测试用例。每个元素都是一个双元素列表 $[R_{\\mathrm{vol}}, R_{\\mathrm{edge}}]$（按此顺序）。例如，打印的输出必须具有 $[[r_{1,\\mathrm{vol}},r_{1,\\mathrm{edge}}],[r_{2,\\mathrm{vol}},r_{2,\\mathrm{edge}}],[r_{3,\\mathrm{vol}},r_{3,\\mathrm{edge}}],[r_{4,\\mathrm{vol}},r_{4,\\mathrm{edge}}]]$ 的形式，所有值均为无量纲浮点数。", "solution": "该问题要求分析和比较在计算电磁学的时域有限差分（FDTD）方法中使用的两种不同的材料参数插值方案。该比较基于一个度量标准，该标准量化了在穿过单个Yee单元的平面电介质界面上，电场法向分量的电磁边界条件的违背程度。\n\n### 基本原理：边界条件\n\n在两种介质之间无自由表面电荷的平面界面处，麦克斯韦方程组对电场 $\\mathbf{E}$ 和电位移场 $\\mathbf{D} = \\epsilon \\mathbf{E}$ 施加了连续性条件。平行于界面的电场分量 $E_t$ 是连续的。垂直于界面的电位移场分量 $D_n$ 也是连续的。对于角频率为 $\\omega$ 的时谐场，在介电常数为 $\\epsilon$、电导率为 $\\sigma$ 的有损耗介质中，这些性质可以方便地使用复介电常数 $\\epsilon_c = \\epsilon - i \\sigma/\\omega$ 来描述。电位移场变为 $\\mathbf{D} = \\epsilon_c \\mathbf{E}$。\n\n跨越介质1和介质2之间界面的 $\\mathbf{D}$ 的法向分量的连续性表示为 $D_{n,1} = D_{n,2}$，这意味着：\n$$\n\\epsilon_{c,1} E_{n,1} = \\epsilon_{c,2} E_{n,2}\n$$\n此处，$E_{n,1}$ 和 $E_{n,2}$ 是界面两侧电场的法向分量。此关系表明，法向电场分量 $E_n$ 通常是不连续的。法向位移通量的参考值取为 $D_{n,0} = \\epsilon_{c,1} E_{n,1}$。问题设定 $E_{n,1} = 1\\,\\mathrm{V/m}$，因此 $D_{n,0} = \\epsilon_{c,1}$。\n\n### 数值离散化与平均\n\nFDTD方法在交错网格（Yee网格）上对空间进行离散化。在二维横磁（TM）仿真中，电场分量（$E_x$，$E_y$）位于单元格的边中心。当界面穿过一个单元格时，边上的单个离散场值必须代表两种不同介质中的场行为。这使得在该位置的FDTD更新方程需要一个有效的材料参数。\n\n该问题定义了两种策略来确定边长为 $\\Delta$ 的正方形Yee单元四条边上电场分量的有效复介电常数 $\\epsilon_{c,\\mathrm{eff}}$。界面穿过单元中心 $(0,0)$，并由 $\\hat{\\mathbf n} \\cdot \\mathbf r = 0$ 定义，其中 $\\hat{\\mathbf n} = (\\cos\\theta, \\sin\\theta)$。\n\n### 插值策略\n\n1.  **体积加权平均：** 基于单元内两种介质的面积分数计算出一个单一的有效介电常数。由于界面穿过中心，两部分面积相等。\n    $$\n    \\epsilon_{c,\\mathrm{vol}} = \\frac{1}{2}\\epsilon_{c,1} + \\frac{1}{2}\\epsilon_{c,2}\n    $$\n    这个值用于所有四条边，无论它们如何被界面切割。\n\n2.  **边加权平均：** 基于每条边位于各介质中的长度分数，为每条边计算一个单独的有效介电常数。对于边 $e$，令 $f_e$ 为其在介质2中（即 $\\hat{\\mathbf{n}}\\cdot \\mathbf{r}  0$ 的区域）的长度分数。该边的有效介电常数为：\n    $$\n    \\epsilon_{c,\\mathrm{edge}}(e) = (1 - f_e)\\epsilon_{c,1} + f_e \\epsilon_{c,2}\n    $$\n    分数 $f_e$ 是通过在边的端点 $\\mathbf{r}_1$ 和 $\\mathbf{r}_2$ 处计算 $s = \\hat{\\mathbf{n}}\\cdot\\mathbf{r}$ 来确定的。令 $s_1 = \\hat{\\mathbf{n}}\\cdot\\mathbf{r}_1$ 和 $s_2 = \\hat{\\mathbf{n}}\\cdot\\mathbf{r}_2$。如果边被切割，交点会将其分成几段。分数 $f_e$ 是在介质2中的线段长度与总边长的比率。这可以使用线性插值计算。\n\n### 误差度量公式\n\n跨越界面的边上的离散场变量无法表示法向场分量 $E_n$ 的不连续跳变。该问题将边上的有效法向场建模为加权平均值：\n$$\nE_{n,\\mathrm{edge}}(e) = (1 - f_e) E_{n,1} + f_e E_{n,2}\n$$\n使用连续性条件 $E_{n,2} = (\\epsilon_{c,1}/\\epsilon_{c,2}) E_{n,1}$ 并设置 $E_{n,1}=1$，这变为：\n$$\nE_{n,\\mathrm{edge}}(e) = (1 - f_e) + f_e \\frac{\\epsilon_{c,1}}{\\epsilon_{c,2}}\n$$\n边上的离散化法向通量则为 $D_{n,\\mathrm{discr}}(e) = \\epsilon_{c,\\mathrm{eff}}(e) E_{n,\\mathrm{edge}}(e)$。插值方案的质量通过此离散化通量逼近真实连续通量 $D_{n,0} = \\epsilon_{c,1}$ 的程度来衡量。边 $e$ 的归一化残差定义为：\n$$\nr_e = \\left| \\frac{D_{n,\\mathrm{discr}}(e)}{D_{n,0}} - 1 \\right| = \\left| \\frac{\\epsilon_{c,\\mathrm{eff}}(e) E_{n,\\mathrm{edge}}(e)}{\\epsilon_{c,1}} - 1 \\right|\n$$\n代入 $E_{n,\\mathrm{edge}}(e)$ 的表达式：\n$$\nr_e = \\left| \\frac{\\epsilon_{c,\\mathrm{eff}}(e)}{\\epsilon_{c,1}} \\left( (1 - f_e) + f_e \\frac{\\epsilon_{c,1}}{\\epsilon_{c,2}} \\right) - 1 \\right|\n$$\n\n对于**体积加权**方案，所有边的 $\\epsilon_{c,\\mathrm{eff}}(e) = \\epsilon_{c,\\mathrm{vol}}$，并且使用相应的 $f_e$ 计算每条边的残差 $r_{e,\\mathrm{vol}}$。\n\n对于**边加权**方案，$\\epsilon_{c,\\mathrm{eff}}(e) = \\epsilon_{c,\\mathrm{edge}}(e)$。残差项变为：\n$$\nr_{e,\\mathrm{edge}} = \\left| \\frac{(1 - f_e)\\epsilon_{c,1} + f_e \\epsilon_{c,2}}{\\epsilon_{c,1}} \\left( (1 - f_e) + f_e \\frac{\\epsilon_{c,1}}{\\epsilon_{c,2}} \\right) - 1 \\right|\n$$\n令 $\\eta = \\epsilon_{c,2}/\\epsilon_{c,1}$，表达式简化为：\n$$\n\\frac{D_{n,\\mathrm{discr}}(e)}{D_{n,0}} = \\left( (1 - f_e) + f_e \\eta \\right) \\left( (1 - f_e) + f_e \\frac{1}{\\eta} \\right)\n$$\n展开此乘积可得：\n$$\n(1 - f_e)^2 + f_e(1 - f_e)\\frac{1}{\\eta} + f_e(1 - f_e)\\eta + f_e^2 = 1 - 2f_e + 2f_e^2 + f_e(1 - f_e)\\left(\\eta + \\frac{1}{\\eta}\\right)\n$$\n残差是与1之差的模：\n$$\nr_{e,\\mathrm{edge}} = \\left| -2f_e + 2f_e^2 + f_e(1 - f_e)\\left(\\eta + \\frac{1}{\\eta}\\right) \\right| = \\left| f_e(1 - f_e) \\left( -2 + \\eta + \\frac{1}{\\eta} \\right) \\right|\n$$\n这导出了更具洞察力的形式：\n$$\nr_{e,\\mathrm{edge}} = \\left| f_e(1 - f_e) \\frac{(\\eta - 1)^2}{\\eta} \\right|\n$$\n这表明，如果边未被切割（$f_e=0$ 或 $f_e=1$）或没有材料对比（$\\eta=1$），则边加权方案的误差为零；当界面平分边时（$f_e=0.5$），误差最大。\n\n### 计算算法\n\n每种方案的总误差是四个单元边上残差的均方根（RMS）：\n$$\nR = \\sqrt{ \\frac{1}{4} \\sum_{e \\in \\{\\mathrm{top}, \\mathrm{bottom}, \\mathrm{left}, \\mathrm{right}\\}} r_e^2 }\n$$\n\n对于每个测试用例，算法按以下步骤进行：\n1.  计算角频率 $\\omega = 2\\pi f$ 和复介电常数 $\\epsilon_{c,1}$ 和 $\\epsilon_{c,2}$。\n2.  定义几何结构：法向量 $\\hat{\\mathbf n}$ 和四个单元边的端点。\n3.  对于每条边 $e$：\n    a. 计算端点到界面的有符号距离 $s_1$ 和 $s_2$。\n    b. 根据 $s_1$ 和 $s_2$ 的符号和值计算分数 $f_e$。\n    c. 使用 $\\epsilon_{c,\\mathrm{vol}} = (\\epsilon_{c,1}+\\epsilon_{c,2})/2$ 计算残差 $r_{e,\\mathrm{vol}}$。\n    d. 使用基于 $\\eta = \\epsilon_{c,2}/\\epsilon_{c,1}$ 和 $f_e$ 的派生公式计算残差 $r_{e,\\mathrm{edge}}$。\n4.  通过对残差平方的平均值取平方根来计算 RMS 误差 $R_{\\mathrm{vol}}$ 和 $R_{\\mathrm{edge}}$。\n5.  返回数值对 $[R_{\\mathrm{vol}}, R_{\\mathrm{edge}}]$。\n\n对每个提供的测试用例都执行此过程。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the FDTD interface modeling problem for the given test suite.\n    \"\"\"\n    \n    # Physical constant for permittivity of vacuum\n    epsilon_0 = 8.854187817e-12  # F/m\n\n    def compute_errors_for_case(delta, theta, eps1, sig1, eps2, sig2, f):\n        \"\"\"\n        Computes R_vol and R_edge for a single set of parameters.\n        \"\"\"\n        # Step 1: Calculate complex permittivities\n        omega = 2.0 * np.pi * f\n        # Handle potential division by zero if omega is zero, though not in test cases\n        if omega == 0:\n            # In a static case, conductivity term would dominate. This problem assumes time-harmonic fields.\n            # We can assign a very large number for the imaginary part if sigma is non-zero.\n            # However, problem constraints ensure f > 0.\n            pass\n        \n        eps_c1 = eps1 - 1j * sig1 / omega\n        eps_c2 = eps2 - 1j * sig2 / omega\n\n        # Step 2: Define geometry\n        n_hat = np.array([np.cos(theta), np.sin(theta)])\n        half_delta = delta / 2.0\n\n        edges = [\n            (np.array([-half_delta,  half_delta]), np.array([half_delta,  half_delta])),  # Top\n            (np.array([-half_delta, -half_delta]), np.array([half_delta, -half_delta])), # Bottom\n            (np.array([-half_delta, -half_delta]), np.array([-half_delta,  half_delta])), # Left\n            (np.array([ half_delta, -half_delta]), np.array([ half_delta,  half_delta]))   # Right\n        ]\n\n        r_vol_sq_sum = 0.0\n        r_edge_sq_sum = 0.0\n\n        # Step 3: Loop over the four edges\n        for r1, r2 in edges:\n            # 3a. Compute signed distances\n            s1 = np.dot(n_hat, r1)\n            s2 = np.dot(n_hat, r2)\n            \n            # 3b. Calculate f_e\n            # Use small tolerance for floating point comparisons to zero\n            tol = 1e-12 \n            if abs(s1)  tol and abs(s2)  tol:\n                f_e = 0.5\n            elif s1 >= -tol and s2 >= -tol:\n                f_e = 1.0\n            elif s1 = tol and s2 = tol:\n                f_e = 0.0\n            else: # Edge is cut by the interface\n                # Intersection parameter alpha along segment from r1 to r2\n                # is alpha = -s1 / (s2 - s1)\n                if s2 > s1: # s2 > 0, s1  0\n                    f_e = s2 / (s2 - s1)\n                else: # s1 > 0, s2  0\n                    f_e = s1 / (s1 - s2)\n            \n            # 3c-d. Calculate residuals for both schemes\n            ratio_eps = eps_c1 / eps_c2\n            e_n_term = (1.0 - f_e) + f_e * ratio_eps\n\n            # Volume-weighted residual\n            eps_c_vol = 0.5 * (eps_c1 + eps_c2)\n            r_vol = np.abs((eps_c_vol / eps_c1) * e_n_term - 1.0)\n            r_vol_sq_sum += r_vol**2\n\n            # Edge-weighted residual\n            eta = eps_c2 / eps_c1\n            if abs(eta - 1.0)  tol or f_e * (1.0 - f_e) == 0:\n                r_edge = 0.0\n            else:\n                # Use numerically stable and insightful formula\n                r_edge = np.abs(f_e * (1.0 - f_e) * ((eta - 1.0)**2 / eta))\n            \n            r_edge_sq_sum += r_edge**2\n\n        # Step 4: Compute RMS errors\n        R_vol = np.sqrt(r_vol_sq_sum / 4.0)\n        R_edge = np.sqrt(r_edge_sq_sum / 4.0)\n        \n        # Step 5: Return result\n        return [R_vol, R_edge]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.0, np.pi/4.0, 2.5 * epsilon_0, 0.0, 6.0 * epsilon_0, 0.01, 1.0e9),\n        (1.0, 0.0, 1.0 * epsilon_0, 0.0, 4.0 * epsilon_0, 0.0, 5.0e9),\n        (1.0, np.pi/2.0, 2.0 * epsilon_0, 0.1, 10.0 * epsilon_0, 0.0, 1.0e8),\n        (1.0, 80.0*np.pi/180.0, 1.5 * epsilon_0, 0.0, 12.0 * epsilon_0, 0.5, 2.0e9)\n    ]\n\n    results = []\n    for case in test_cases:\n        result = compute_errors_for_case(*case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # Convert list of lists to string and remove spaces for compact representation.\n    output_str = str(results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```", "id": "3331577"}]}