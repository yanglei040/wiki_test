{"hands_on_practices": [{"introduction": "在提取S参数之前，我们必须首先理解FDTD算法本身如何影响波的传播。本练习 [@problem_id:3345955] 深入探讨了数值色散这一离散网格的固有产物。通过本练习，您将学会如何量化由离散化引入的频率相关相位误差，并建立一个物理模型来对其进行后处理校正。", "problem": "考虑一个一维时域有限差分（FDTD）模型，该模型模拟的是一条长度为 $L$、终端接匹配负载的均匀、各向同性、非磁性介质传输线，其空间步长为均匀的 $\\Delta x$，时间步长为 $\\Delta t$。相对介电常数为 $\\varepsilon_r$，相对磁导率为 $\\mu_r$，真空光速为 $c$。Courant 数定义为 $S_c = c \\Delta t / \\Delta x$。从 $x=0$ 处的输入端口到 $x=L$ 处的输出端口之间的传输特性由散射参数 $S_{21}(\\omega)$ 表征，该参数从离散时间 FDTD 模型中获得。目标是量化由 Courant 数 $S_c$ 引起的数值色散对 $S_{21}$ 相位的影响，并利用已知介质的物理传播常数 $\\beta(\\omega)$ 来开发一种后验相位展开校正方法。\n\n从 Maxwell 方程组和一维蛙跳 Yee 格式出发，推导该格式的离散时间色散关系，并由此推导出均匀介质的数值色散传播常数 $k_{\\text{num}}(\\omega)$。同时，从介质的本构关系推导出物理传播常数 $\\beta(\\omega)$，并用它来设计一种后验相位展开校正策略，以从 FDTD 模型输出的数值折叠相位中恢复出物理上一致的相位。\n\n在单个角频率 $\\omega_0$ 处，使用推导出的量计算以下三个以弧度为单位的误差度量：\n- $e_{\\text{pre}}$：折叠的数值相位 $\\phi_{\\text{meas}}(\\omega_0)$ 与物理相位 $\\phi_{\\text{phys}}(\\omega_0)$ 之间的绝对主值差，\n- $e_{\\text{unwrap}}$：在进行任何色散校正之前，通过选择整数倍 $2\\pi$ 的分支以最小化与 $\\phi_{\\text{phys}}(\\omega_0)$ 的偏差后，得到的绝对主值差，\n- $e_{\\text{corr}}$：在进行分支选择和基于数值与物理传播常数之差构建的色散校正之后，得到的绝对主值差。\n\n您的程序必须通过纯粹的逻辑和数学实现以下步骤：\n1. 使用一维 Yee 格式的离散色散关系，计算数值色散传播常数 $k_{\\text{num}}(\\omega_0)$。该常数是 $S_c$、$\\Delta x$ 和 $\\Delta t$ 的函数，其中均匀介质的特性由 $(\\varepsilon_r,\\mu_r)$ 描述，线长为 $L$。定义介质的类 Courant 数 $S = v \\Delta t / \\Delta x$，其中波速 $v = c/\\sqrt{\\varepsilon_r \\mu_r}$。所有量必须在国际单位制（SI）中保持一致，角度以弧度为单位。\n2. 定义物理传播常数 $\\beta(\\omega) = \\omega/v$ 和物理相位 $\\phi_{\\text{phys}}(\\omega_0) = -\\beta(\\omega_0) L$（以弧度为单位）。\n3. 将数值预测的 FDTD 测量相位定义为折叠的主值 $\\phi_{\\text{meas}}(\\omega_0) = \\operatorname{wrap}(-k_{\\text{num}}(\\omega_0) L)$，其中 $\\operatorname{wrap}(\\cdot)$ 将角度映射到区间 $(-\\pi,\\pi]$。\n4. 计算 $e_{\\text{pre}} = \\left|\\operatorname{wrap}(\\phi_{\\text{meas}}(\\omega_0) - \\phi_{\\text{phys}}(\\omega_0))\\right|$（以弧度为单位）。\n5. 使用 $\\beta(\\omega_0)$ 执行后验相位展开，通过选择一个整数分支 $N$ 来最小化与 $\\phi_{\\text{phys}}(\\omega_0)$ 的偏差，即选择 $N$ 使得 $\\phi_{\\text{unwrap}}(\\omega_0) = \\phi_{\\text{meas}}(\\omega_0) + 2\\pi N$ 尽可能接近 $\\phi_{\\text{phys}}(\\omega_0)$，然后计算 $e_{\\text{unwrap}} = \\left|\\operatorname{wrap}(\\phi_{\\text{unwrap}}(\\omega_0) - \\phi_{\\text{phys}}(\\omega_0))\\right|$（以弧度为单位）。\n6. 从传播常数之差构建一个色散校正项，将其应用于 $\\phi_{\\text{unwrap}}(\\omega_0)$，并计算 $e_{\\text{corr}}$ 作为校正后相位与 $\\phi_{\\text{phys}}(\\omega_0)$ 之间的绝对主值差，所有单位均为弧度。\n\n使用以下测试参数集（所有单位均为国际单位制；角度必须以弧度为单位）：\n- 空间步长 $\\Delta x = 10^{-3}\\ \\mathrm{m}$，\n- 线长 $L = 5\\times 10^{-1}\\ \\mathrm{m}$，\n- 相对介电常数 $\\varepsilon_r = 4$，\n- 相对磁导率 $\\mu_r = 1$，\n- 真空光速 $c = 2.99792458\\times 10^{8}\\ \\mathrm{m/s}$，\n- 频率 $f_0 = 3\\times 10^{10}\\ \\mathrm{Hz}$，因此 $\\omega_0 = 2\\pi f_0$，\n- Courant 数 $S_c \\in \\{2\\times 10^{-1},\\,5\\times 10^{-1},\\,9\\times 10^{-1}\\}$。\n\n设计您的算法，使其在反三角函数的参数接近其定义域边界时具有数值鲁棒性。您的程序应生成单行输出，其中包含上述三个 Courant 数的九个结果，顺序为 $[e_{\\text{pre}}(S_c=0.2),e_{\\text{unwrap}}(S_c=0.2),e_{\\text{corr}}(S_c=0.2),e_{\\text{pre}}(S_c=0.5),e_{\\text{unwrap}}(S_c=0.5),e_{\\text{corr}}(S_c=0.5),e_{\\text{pre}}(S_c=0.9),e_{\\text{unwrap}}(S_c=0.9),e_{\\text{corr}}(S_c=0.9)]$，数值以弧度为单位表示为浮点数，用逗号分隔，并用方括号括起来，不含任何额外文本。", "solution": "该问题要求对一维时域有限差分（FDTD）模拟中的数值色散进行定量分析。具体来说，我们需要推导数值传播常数，将其与物理传播常数进行比较，并计算与传输散射参数 $S_{21}(\\omega)$ 的相位相关的三个误差度量。\n\n### 步骤 1：传播常数的推导\n\n#### 物理传播常数 $\\beta(\\omega)$\n一个由相对介电常数 $\\varepsilon_r$ 和相对磁导率 $\\mu_r$ 表征的物理介质支持横电磁（TEM）波。这些波的相速度 $v$ 由下式给出：\n$$v = \\frac{c}{\\sqrt{\\varepsilon_r \\mu_r}}$$\n其中 $c$ 是真空中的光速。对于形式为 $e^{j(\\omega t - \\beta x)}$ 的谐波，在这种理想介质中的色散关系是线性的：\n$$\\beta(\\omega) = \\frac{\\omega}{v} = \\frac{\\omega \\sqrt{\\varepsilon_r \\mu_r}}{c}$$\n在没有反射的情况下，长度为 $L$ 的传输系数 $S_{21}$ 的相位是 $\\phi_{\\text{phys}}(\\omega) = -\\beta(\\omega) L$。\n\n#### 数值传播常数 $k_{\\text{num}}(\\omega)$\n一维 Yee 蛙跳格式将 Maxwell 方程组离散化。对于形式为 $E_y \\propto e^{j(\\omega n\\Delta t - k_{\\text{num}} i\\Delta x)}$ 的平面波解，将其代入有限差分方程，得到该格式的数值色散关系：\n$$\\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\frac{v \\Delta t}{\\Delta x} \\sin\\left(\\frac{k_{\\text{num}} \\Delta x}{2}\\right)$$\n此处，$\\Delta x$ 和 $\\Delta t$ 分别是空间和时间网格步长。我们定义介质 Courant 数为 $S = v \\Delta t / \\Delta x$。该关系式变为：\n$$\\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = S \\cdot \\sin\\left(\\frac{k_{\\text{num}} \\Delta x}{2}\\right)$$\n当 $S \\le 1$ 时，FDTD 格式是稳定的。问题提供了真空 Courant 数 $S_c = c \\Delta t / \\Delta x$，由此我们推导出 $S = S_c / \\sqrt{\\varepsilon_r \\mu_r}$。对于所有测试用例，$S \\le 1$，确保了稳定性。\n\n求解数值传播常数 $k_{\\text{num}}$ 可得：\n$$k_{\\text{num}}(\\omega) = \\frac{2}{\\Delta x} \\arcsin\\left(\\frac{1}{S} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right)\\right)$$\n该方程揭示了 $k_{\\text{num}}$ 与 $\\omega$ 不呈线性关系，这一现象被称为数值色散。数值相速度 $v_{\\text{num}} = \\omega/k_{\\text{num}}$ 是频率相关的，并且通常小于物理速度 $v$。\n\n### 步骤 2：相位误差与校正策略\n\nFDTD 模拟实际上测量的是由 $k_{\\text{num}}$ 决定的相位。原始数值相位为 $\\phi_{\\text{num\\_raw}}(\\omega) = -k_{\\text{num}}(\\omega) L$。然而，标准的信号处理函数（如复数辐角函数）返回一个被折叠到区间 $(-\\pi, \\pi]$ 的主值。我们将此折叠操作定义为 $\\operatorname{wrap}(\\cdot)$。因此，测量到的相位为 $\\phi_{\\text{meas}}(\\omega) = \\operatorname{wrap}(\\phi_{\\text{num\\_raw}}(\\omega))$。\n\n总的物理相位 $\\phi_{\\text{phys}}(\\omega) = -\\beta(\\omega) L$ 可能是一个很大的负值，跨越多个 $2\\pi$。折叠操作会丢弃整数个完整的周期。\n\n该问题定义了一个三阶段过程，用以在特定频率 $\\omega_0$ 处量化和校正相位误差。\n\n1.  **校正前误差 ($e_{\\text{pre}}$)**：这是折叠的数值相位与真实物理相位之间的直接主值差。它捕捉了相位折叠模糊性和数值色散的综合影响。\n    $$e_{\\text{pre}} = \\left|\\operatorname{wrap}(\\phi_{\\text{meas}}(\\omega_0) - \\phi_{\\text{phys}}(\\omega_0))\\right|$$\n\n2.  **相位展开与误差 ($e_{\\text{unwrap}}$)**：后验展开使用已知的物理相位 $\\phi_{\\text{phys}}(\\omega_0)$ 作为参考来校正周期模糊性。我们找到一个整数 $N$，以最小化展开后相位与物理相位之间的差异。\n    $$N = \\operatorname{round}\\left(\\frac{\\phi_{\\text{phys}}(\\omega_0) - \\phi_{\\text{meas}}(\\omega_0)}{2\\pi}\\right)$$\n    展开后的相位为：\n    $$\\phi_{\\text{unwrap}}(\\omega_0) = \\phi_{\\text{meas}}(\\omega_0) + 2\\pi N$$\n    剩余误差 $e_{\\text{unwrap}}$ 是这个展开后相位与物理相位之间的主值差。根据构造， $|\\phi_{\\text{unwrap}} - \\phi_{\\text{phys}}| \\le \\pi$，因此在误差计算中的折叠函数在形式上是多余的，但为了保持一致性而保留。这个误差 $e_{\\text{unwrap}}$ 将数值色散的影响与相位折叠模糊性分离开来。\n    $$e_{\\text{unwrap}} = \\left|\\operatorname{wrap}(\\phi_{\\text{unwrap}}(\\omega_0) - \\phi_{\\text{phys}}(\\omega_0))\\right| = \\left|\\phi_{\\text{unwrap}}(\\omega_0) - \\phi_{\\text{phys}}(\\omega_0)\\right|$$\n\n3.  **色散校正与误差 ($e_{\\text{corr}}$)**：数值色散导致的相位误差为 $\\Delta\\phi_{\\text{disp}} = \\phi_{\\text{num\\_raw}} - \\phi_{\\text{phys}} = -(k_{\\text{num}} - \\beta)L$。为了校正它，我们可以定义一个校正项 $C = (k_{\\text{num}} - \\beta)L = - \\Delta\\phi_{\\text{disp}}$。将此项加到我们对真实数值相位的最佳估计上，应该能得到真实的物理相位。问题指定将此校正应用于 $\\phi_{\\text{unwrap}}$。\n    $$\\phi_{\\text{corr}}(\\omega_0) = \\phi_{\\text{unwrap}}(\\omega_0) + (k_{\\text{num}}(\\omega_0) - \\beta(\\omega_0))L$$\n    最终误差 $e_{\\text{corr}}$ 是这个完全校正后的相位与物理相位之间的主值差。\n    $$e_{\\text{corr}} = \\left|\\operatorname{wrap}(\\phi_{\\text{corr}}(\\omega_0) - \\phi_{\\text{phys}}(\\omega_0))\\right|$$\n    正如我们的推导所证明的，如果 $k_{\\text{num}}$ 和 $\\beta$ 的值是精确已知的，这个校正会完美地抵消色散误差，留下的残余误差是 $2\\pi$ 的整数倍。对此类值进行 `wrap` 操作会得到零（在浮点精度范围内）。\n\n### 步骤 3：算法实现\n\n算法基于这些推导出的公式实现。\n对于每个给定的 Courant 数 $S_c$：\n1.  计算一组辅助参数：$\\Delta t = S_c \\Delta x/c$，$v=c/\\sqrt{\\varepsilon_r\\mu_r}$，以及 $S=v\\Delta t/\\Delta x$。\n2.  计算物理传播常数 $\\beta(\\omega_0) = \\omega_0/v$。\n3.  使用其推导公式计算数值传播常数 $k_{\\text{num}}(\\omega_0)$。\n4.  计算物理相位 $\\phi_{\\text{phys}} = -\\beta L$ 和测量的数值相位 $\\phi_{\\text{meas}} = \\operatorname{wrap}(-k_{\\text{num}} L)$。折叠函数 $\\operatorname{wrap}(\\theta)$ 可以通过 $\\arctan2(\\sin\\theta, \\cos\\theta)$ 进行鲁棒实现。\n5.  根据上述定义计算 $e_{\\text{pre}}$、$e_{\\text{unwrap}}$ 和 $e_{\\text{corr}}$。\n6.  收集九个结果（3个 $S_c$ 值中的每一个对应 3 个误差），并按指定格式进行格式化。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes phase errors due to numerical dispersion in a 1D FDTD simulation.\n\n    This function implements the analytical formulas derived for phase errors in a\n    1D FDTD model of a dielectric transmission line. It calculates three error\n    metrics (pre-correction, post-unwrapping, and post-dispersion-correction)\n    for a set of given Courant numbers.\n    \"\"\"\n\n    # --- Problem Givens ---\n    # Spatial step in meters\n    delta_x = 1.0e-3\n    # Line length in meters\n    L = 0.5\n    # Relative permittivity\n    epsilon_r = 4.0\n    # Relative permeability\n    mu_r = 1.0\n    # Speed of light in vacuum in m/s\n    c = 2.99792458e8\n    # Operating frequency in Hz\n    f0 = 3.0e10\n    # Test suite for vacuum Courant numbers\n    sc_values = [0.2, 0.5, 0.9]\n\n    # Angular frequency in rad/s\n    omega0 = 2.0 * np.pi * f0\n\n    # List to store the final results\n    results = []\n\n    def wrap_to_pi(angle):\n        \"\"\"\n        Wraps an angle to the interval (-pi, pi] using arctan2.\n        This is a robust way to handle the principal value.\n        \"\"\"\n        return np.arctan2(np.sin(angle), np.cos(angle))\n\n    # --- Main Calculation Loop ---\n    for sc in sc_values:\n        # Step 1: Calculate auxiliary and derived parameters\n        delta_t = sc * delta_x / c\n        v_medium = c / np.sqrt(epsilon_r * mu_r)\n        s_medium = v_medium * delta_t / delta_x\n\n        # Step 2: Compute physical and numerical propagation constants\n        # Physical propagation constant (linear dispersion)\n        beta_phys = omega0 / v_medium\n        \n        # Numerical propagation constant (from FDTD dispersion relation)\n        # The argument to arcsin is guaranteed to be in [-1, 1] for stable FDTD (S=1)\n        # and for frequencies below the numerical cutoff. The problem parameters\n        # satisfy this.\n        arg_arcsin = (1.0 / s_medium) * np.sin(omega0 * delta_t / 2.0)\n        # Clamping for absolute robustness, though not required for these specific inputs.\n        arg_arcsin = np.clip(arg_arcsin, -1.0, 1.0)\n        k_num = (2.0 / delta_x) * np.arcsin(arg_arcsin)\n\n        # Step 3: Define physical and measured phases\n        phi_phys = -beta_phys * L\n        phi_num_raw = -k_num * L\n        phi_meas = wrap_to_pi(phi_num_raw)\n\n        # Step 4: Compute pre-correction error (e_pre)\n        e_pre = np.abs(wrap_to_pi(phi_meas - phi_phys))\n\n        # Step 5: Perform phase unwrapping and compute e_unwrap\n        # Find the integer number of 2*pi cycles to add to phi_meas\n        # to get closest to phi_phys.\n        N = np.round((phi_phys - phi_meas) / (2.0 * np.pi))\n        phi_unwrap = phi_meas + 2.0 * np.pi * N\n        # The error after unwrapping isolates the numerical dispersion effect.\n        # The inner wrap is technically redundant as |phi_unwrap - phi_phys| = pi.\n        e_unwrap = np.abs(wrap_to_pi(phi_unwrap - phi_phys))\n\n        # Step 6: Apply dispersion correction and compute e_corr\n        # The correction term is the analytical difference between numerical and physical phase accumulation.\n        dispersion_correction = (k_num - beta_phys) * L\n        phi_corr = phi_unwrap + dispersion_correction\n        # The error after a perfect correction should be a multiple of 2*pi,\n        # which wraps to zero.\n        e_corr = np.abs(wrap_to_pi(phi_corr - phi_phys))\n        \n        results.extend([e_pre, e_unwrap, e_corr])\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3345955"}, {"introduction": "为了计算模式振幅，我们必须通过交叠积分将仿真场投影到模式基函数上。本练习 [@problem_id:3345928] 旨在解决一个实际挑战：在Yee元胞上，电场和磁场是空间交错的，无法直接相乘。您将实现并比较不同的插值方案以将场分量配置到同一位置，并量化由此引入的误差，这是精确计算功率和S参数的关键一步。", "problem": "要求您通过将交错的电场和磁场分量插值到一个公共端口平面，来实现、验证和量化一种在时域有限差分 (FDTD) Yee 网格上提取模式振幅的离散重叠积分方法。目标是为一个已知的矩形波导模式推导并计算横向电磁场重叠积分的离散版本，并量化由 Yee 方案中的时间交错引起的插值误差。\n\n推导必须以麦克斯韦方程组、坡印亭矢量定义和 Yee 网格交错为基础。具体来说，请使用以下原理：\n- 均匀、无源区域中的频域麦克斯韦旋度方程：$\\nabla \\times \\mathbf{E} = -j \\omega \\mu \\mathbf{H}$ 和 $\\nabla \\times \\mathbf{H} = j \\omega \\epsilon \\mathbf{E}$，时间约定为 $e^{j \\omega t}$。\n- 三维离散 Yee 网格交错：$\\mathbf{E}$ 分量位于整数时间索引的边上，而 $\\mathbf{H}$ 分量位于半整数时间索引的面上，这在空间离散化中表现为在相应坐标方向上的半个单元偏移；在垂直于 $\\hat{\\mathbf{z}}$ 轴的平面上，切向电场 $\\mathbf{E}_t$ 位于 $z$ 索引的平面上，而切向磁场 $\\mathbf{H}_t$ 位于偏移了 $\\Delta z/2$ 的平面上。\n- 在单位法向量为 $\\hat{\\mathbf{n}}$ 的平面上的复坡印亭矢量：$\\mathbf{S} = \\frac{1}{2}\\mathbf{E} \\times \\mathbf{H}^*$，通过该平面的功率流由 $\\frac{1}{2}\\mathrm{Re}\\int_A (\\mathbf{E}\\times\\mathbf{H}^*)\\cdot \\hat{\\mathbf{n}}\\, dA$ 给出。\n- 基于模式正交性的重叠提取方法，对于一个期望的场为 $(\\mathbf{E}_m,\\mathbf{H}_m)$ 的前向传播模式，可以从坡印亭算子的双线性形式构建振幅估计器。一种这样的对称估计器使用内积 $\\int_{A} (\\mathbf{E}\\times\\mathbf{H}_m^*)\\cdot \\hat{\\mathbf{n}}\\, dA$ 和 $\\int_{A} (\\mathbf{E}_m\\times\\mathbf{H}^*)\\cdot \\hat{\\mathbf{n}}\\, dA$，并通过自内积 $\\int_{A} (\\mathbf{E}_m\\times\\mathbf{H}_m^*)\\cdot \\hat{\\mathbf{n}}\\, dA$ 进行归一化。\n\n您需要考虑一个理想电导体矩形波导，其沿 $x$ 轴的宽度为 $a$，沿 $y$ 轴的高度为 $b$，传播方向为 $+\\hat{\\mathbf{z}}$，内部填充真空。选择截止频率以上的主模横电模 $\\mathrm{TE}_{10}$。$\\mathrm{TE}_{10}$ 场的相量形式解析解可以从纵向磁场 $H_z = H_0 \\cos\\left(\\frac{\\pi x}{a}\\right) e^{-j \\beta z}$ 以及横电模中横向场的关系式导出。截止波的波数为 $k_c^2 = \\left(\\frac{\\pi}{a}\\right)^2$，波数为 $k_0 = \\omega \\sqrt{\\mu_0 \\epsilon_0}$，当 $\\omega$ 高于截止频率时，传播常数为 $\\beta = \\sqrt{k_0^2 - k_c^2}$。在任何 $z$ 平面上，$\\mathrm{TE}_{10}$ 的横向场分量 $E_y$ 和 $H_x$ 非零，而 $E_x$ 和 $H_y$ 为零。对该模式进行归一化，使得前向时间平均功率为 $P=1\\,\\mathrm{W}$，即选择 $H_0$ 使得 $\\frac{1}{2}\\mathrm{Re}\\int_A (\\mathbf{E}_m\\times\\mathbf{H}_m^*)\\cdot \\hat{\\mathbf{z}}\\, dA = 1\\,\\mathrm{W}$。所有物理量必须使用国际单位制 (SI) 表示。\n\n您的程序必须：\n- 在横截面 $x \\in [0,a]$，$y \\in [0,b]$ 上构建一个 Yee 网格，沿 $x$ 轴有 $N_x$ 个单元，沿 $y$ 轴有 $N_y$ 个单元。使用 $\\Delta x = a/N_x$，$\\Delta y = b/N_y$，并设置 $\\Delta z = \\Delta x$。\n- 在适用于 $\\mathbf{E}$ 和 $\\mathbf{H}$ 的 Yee 网格位置上对解析 $\\mathrm{TE}_{10}$ 场进行采样：在端口平面 $z=0$ 上，切向电场分量 $E_y$ 位于 $(x_i, y_{j+\\frac{1}{2}}, z_k)$；切向磁场分量 $H_x$ 位于 $(x_i, y_{j+\\frac{1}{2}}, z_{k+\\frac{1}{2}})$ 和 $(x_i, y_{j+\\frac{1}{2}}, z_{k-\\frac{1}{2}})$，这对应于 $z=\\pm \\Delta z/2$。假设在这些点上，连续场与离散样本完全匹配。\n- 通过两种方式将交错的磁场插值到电场端口平面 $z=0$：(i) 沿 $z$ 轴进行线性插值，方法是对 $z=\\pm \\Delta z/2$ 处的值进行平均；(ii) 进行最近邻插值，方法是取 $z=+\\Delta z/2$ 处的值。\n- 使用 $x$ 方向的复合梯形法则（端点权重为二分之一）和 $y$ 方向的中点法则，以及均匀求积面积元 $\\Delta A = \\Delta x \\Delta y$，在端口上构造离散重叠积分。使用对称双线性估计器计算模式振幅 $a$：\n  $$a_{\\mathrm{est}} = \\frac{ \\int_A (\\mathbf{E}\\times\\mathbf{H}_m^*)\\cdot \\hat{\\mathbf{z}}\\, dA + \\int_A (\\mathbf{E}_m\\times\\mathbf{H}^*)\\cdot \\hat{\\mathbf{z}}\\, dA }{ 2 \\int_A (\\mathbf{E}_m\\times\\mathbf{H}_m^*)\\cdot \\hat{\\mathbf{z}}\\, dA }.$$\n  以离散形式，在需要时对磁场进行插值后，在同一共置端口平面样本集 $(x_i, y_{j+\\frac{1}{2}}, z=0)$ 上计算所有三个积分。因为 $\\mathrm{TE}_{10}$ 在此平面上只有 $E_y$ 和 $H_x$ 分量，所以在每个共置样本点上使用 $(\\mathbf{E}\\times\\mathbf{H}^*)\\cdot \\hat{\\mathbf{z}} = E_x H_y^* - E_y H_x^* = - E_y H_x^*$。\n- 将每个测试用例的插值误差定义为估计振幅与理想值之间的绝对差，即 $|a_{\\mathrm{est}} - 1|$。\n\n所有数值常数必须使用国际单位制 (SI)。具体来说，使用 $c = 299792458\\,\\mathrm{m/s}$，$\\mu_0 = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$，以及 $\\epsilon_0 = 1/(\\mu_0 c^2)$。波导横截面为 $a = 0.02286\\,\\mathrm{m}$ 和 $b = 0.01016\\,\\mathrm{m}$。使用工作频率 $f = 10\\times 10^{9}\\,\\mathrm{Hz}$（即 $10\\,\\mathrm{GHz}$）。角度（如适用）必须以弧度为单位。\n\n将您的解决方案实现为一个完整、可运行的程序，该程序为以下 $(N_x,N_y,\\text{interp})$ 测试套件计算插值误差：\n- 测试 1：$(N_x,N_y,\\text{interp}) = (200,100,\\text{linear})$。\n- 测试 2：$(N_x,N_y,\\text{interp}) = (40,20,\\text{linear})$。\n- 测试 3：$(N_x,N_y,\\text{interp}) = (40,20,\\text{nearest})$。\n- 测试 4：$(N_x,N_y,\\text{interp}) = (200,100,\\text{nearest})$。\n\n您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3,result4]”），其中每个结果是相应测试用例的浮点插值误差 $|a_{\\mathrm{est}} - 1|$。所有输出均表示为不带单位的普通十进制浮点数。不允许用户输入。计算必须完全自包含。确保结果具有确定性。", "solution": "该问题要求计算与在时域有限差分 (FDTD) 网格上插值交错电磁场相关的误差度量。任务的核心是实现一个离散重叠积分来估计模式振幅，并量化由两种不同的磁场插值方案引入的误差。\n\n我们首先推导矩形波导中横电 $\\mathrm{TE}_{10}$ 模的解析表达式，这将作为我们“采样的”数值场的基础。考虑一个沿 $x$ 轴尺寸为 $a$、沿 $y$ 轴尺寸为 $b$ 的矩形波导，内部填充真空 ($\\mu_0, \\epsilon_0$)。传播方向为 $+\\hat{\\mathbf{z}}$。\n\n对于 $\\mathrm{TE}$ 模，传播方向上的电场为零，$E_z = 0$。场可以从纵向磁场分量 $H_z$ 导出。对于 $\\mathrm{TE}_{10}$ 模，其表达式为 $H_z(x, y, z) = H_0 \\cos\\left(\\frac{\\pi x}{a}\\right) e^{-j \\beta z}$，其中 $H_0$ 是一个振幅常数，$\\beta$ 是传播常数。横向场分量可以通过麦克斯韦旋度方程 $\\nabla \\times \\mathbf{E} = -j \\omega \\mu_0 \\mathbf{H}$ 和 $\\nabla \\times \\mathbf{H} = j \\omega \\epsilon_0 \\mathbf{E}$ 求得，假设时谐依赖关系为 $e^{j \\omega t}$。\n对于一个通用 $\\mathrm{TE}$ 模，横向场由以下公式给出：\n$$ \\mathbf{E}_t = \\frac{j\\omega\\mu_0}{k_c^2} (\\nabla_t H_z \\times \\hat{\\mathbf{z}}) $$\n$$ \\mathbf{H}_t = \\frac{j\\beta}{k_c^2} \\nabla_t H_z $$\n其中 $k_c$ 是截止波数。对于 $\\mathrm{TE}_{10}$ 模，$k_c = \\pi/a$ 且 $\\nabla_t H_z = \\frac{\\partial H_z}{\\partial x}\\hat{\\mathbf{x}} = -H_0\\frac{\\pi}{a}\\sin(\\frac{\\pi x}{a})e^{-j\\beta z}\\hat{\\mathbf{x}}$。\n\n将这些代入通用表达式，得到 $\\mathrm{TE}_{10}$ 模的非零横向分量：\n$$ E_y(x,z) = \\frac{j\\omega\\mu_0}{(\\pi/a)^2} \\left(-H_0\\frac{\\pi}{a}\\sin\\left(\\frac{\\pi x}{a}\\right)e^{-j\\beta z}\\right) = -j \\frac{\\omega\\mu_0 a}{\\pi} H_0 \\sin\\left(\\frac{\\pi x}{a}\\right) e^{-j \\beta z} $$\n通过 $\\frac{\\partial E_y}{\\partial z} = -j\\omega\\mu_0 H_x$ 和 $\\frac{\\partial}{\\partial z} \\rightarrow -j\\beta$，我们得到 $-j\\beta E_y = -j\\omega\\mu_0 H_x$，因此 $H_x = \\frac{\\beta}{\\omega\\mu_0}E_y$。使用导出的 $E_y$ 表达式：\n$$ H_x = \\frac{\\beta}{\\omega\\mu_0} \\left(-j \\frac{\\omega\\mu_0 a}{\\pi} H_0 \\sin\\left(\\frac{\\pi x}{a}\\right) e^{-j \\beta z}\\right) = -j \\frac{\\beta a}{\\pi} H_0 \\sin\\left(\\frac{\\pi x}{a}\\right) e^{-j \\beta z} $$\n这证实了我们的推导。为了设置一个确定的振幅，我们对模式进行归一化，使其携带的时间平均功率为 $P = 1\\,\\mathrm{W}$。功率是复坡印亭矢量 $S_z = \\frac{1}{2}(E_x H_y^* - E_y H_x^*) = -\\frac{1}{2}E_y H_x^*$ 的实部在波导横截面 $A=ab$ 上的积分。我们选择 $H_0$ 为实数且为正。\n$$ S_z = -\\frac{1}{2} \\left(-j \\frac{\\omega\\mu_0 a}{\\pi} H_0 \\sin\\left(\\frac{\\pi x}{a}\\right)\\right) \\left(+j \\frac{\\beta a}{\\pi} H_0 \\sin\\left(\\frac{\\pi x}{a}\\right)\\right) = \\frac{1}{2} \\frac{\\omega\\mu_0\\beta a^2}{\\pi^2} H_0^2 \\sin^2\\left(\\frac{\\pi x}{a}\\right) $$\n功率为 $P = \\int_0^b \\int_0^a S_z \\,dx\\,dy$。由于被积函数与 $y$ 无关，对 $y$ 的积分得到 $b$。$\\sin^2(\\pi x/a)$ 从 $0$ 到 $a$ 的积分为 $a/2$。\n$$ P = b \\cdot \\int_0^a S_z(x) dx = \\frac{ab}{4} \\frac{\\omega\\mu_0\\beta a^2}{\\pi^2} H_0^2 $$\n设置 $P=1\\,\\mathrm{W}$ 并求解 $H_0$：\n$$ H_0 = \\sqrt{\\frac{4\\pi^2}{a^3 b \\omega \\mu_0 \\beta}} $$\n传播常数 $\\beta$ 由 $\\beta = \\sqrt{k_0^2 - k_c^2}$ 给出，其中 $k_0 = \\omega/c = 2\\pi f \\sqrt{\\mu_0\\epsilon_0}$ 是自由空间波数，$f$ 是频率。\n\n问题的核心是计算模式振幅估计器 $a_{\\mathrm{est}}$：\n$$ a_{\\mathrm{est}} = \\frac{ \\int_A (\\mathbf{E}\\times\\mathbf{H}_m^*)\\cdot \\hat{\\mathbf{z}}\\, dA + \\int_A (\\mathbf{E}_m\\times\\mathbf{H}^*)\\cdot \\hat{\\mathbf{z}}\\, dA }{ 2 \\int_A (\\mathbf{E}_m\\times\\mathbf{H}_m^*)\\cdot \\hat{\\mathbf{z}}\\, dA } $$\n此处，$(\\mathbf{E}_m, \\mathbf{H}_m)$ 是端口平面 $z=0$ 处的解析模式场。场 $(\\mathbf{E}, \\mathbf{H})$ 代表“数值”场。在这个问题中，它们是通过在交错的 Yee 网格位置对解析模式 $(\\mathbf{E}_m, \\mathbf{H}_m)$ 进行采样而生成的。具体来说，$\\mathbf{E} = E_y(x, z=0)\\hat{\\mathbf{y}}$，是在端口平面上采样的。场 $\\mathbf{H}$ 是通过将在 $z=\\pm\\Delta z/2$ 处采样的 $H_x$ 值插值回端口平面 $z=0$ 得到的。\n在 $z=\\pm\\Delta z/2$ 处的磁场为 $H_x(x, \\pm\\Delta z/2) = H_x(x,0) e^{\\mp j\\beta \\Delta z/2}$。\n两种插值方案产生：\n1.  **线性插值**：$H_{x,\\text{linear}}(x,0) = \\frac{1}{2}[H_x(x, +\\Delta z/2) + H_x(x, -\\Delta z/2)] = H_x(x,0) \\frac{e^{-j\\beta \\Delta z/2} + e^{+j\\beta \\Delta z/2}}{2} = H_x(x,0) \\cos(\\beta \\Delta z/2)$。\n2.  **最近邻插值**：问题指定取 $z=+\\Delta z/2$ 处的值。因此，$H_{x,\\text{nearest}}(x,0) = H_x(x, +\\Delta z/2) = H_x(x,0) e^{-j\\beta \\Delta z/2}$。\n\n令 $C_{\\text{interp}}$ 为插值产生的复数因子，使得插值后的磁场为 $\\mathbf{H} = H_x(x,0) C_{\\text{interp}} \\hat{\\mathbf{x}}$。\n- 对于线性插值，$C_{\\text{linear}} = \\cos(\\beta \\Delta z/2)$。\n- 对于最近邻插值，$C_{\\text{nearest}} = e^{-j\\beta \\Delta z/2}$。\n\n由于 $\\mathbf{E}=\\mathbf{E}_m$ 且 $\\mathbf{H}=C_{\\text{interp}}\\mathbf{H}_m$，振幅估计器简化为：\n$$ a_{\\mathrm{est}} = \\frac{\\int (\\mathbf{E}_m\\times\\mathbf{H}_m^*)\\cdot d\\mathbf{A} + \\int (\\mathbf{E}_m\\times(C_{\\text{interp}}\\mathbf{H}_m)^*)\\cdot d\\mathbf{A}}{2\\int (\\mathbf{E}_m\\times\\mathbf{H}_m^*)\\cdot d\\mathbf{A}} = \\frac{(1+C_{\\text{interp}}^*) \\int (\\mathbf{E}_m\\times\\mathbf{H}_m^*)\\cdot d\\mathbf{A}}{2 \\int (\\mathbf{E}_m\\times\\mathbf{H}_m^*)\\cdot d\\mathbf{A}} = \\frac{1+C_{\\text{interp}}^*}{2} $$\n这个深刻的简化表明，只要所有积分使用相同的求积方法，振幅估计就仅取决于插值常数，而不取决于场分布或数值积分方案的具体细节。求积误差完全抵消。问题要求计算误差量 $|a_{\\mathrm{est}} - 1|$。\n\n算法如下：\n1.  以 SI 单位定义物理和波导常数。\n2.  计算派生参数：角频率 $\\omega$、自由空间波数 $k_0$、截止波数 $k_c$ 和传播常数 $\\beta$。\n3.  遍历每个测试用例 $(N_x, N_y, \\text{interp})$。\n4.  对于每个用例，计算网格间距 $\\Delta x = a/N_x$ 并设置 $\\Delta z = \\Delta x$。\n5.  确定插值因子 $C_{\\text{interp}}$：如果 `interp` 是 'linear'，$C_{\\text{interp}} = \\cos(\\beta \\Delta z/2)$；如果是 'nearest'，$C_{\\text{interp}} = e^{-j\\beta \\Delta z/2}$。\n6.  计算估计振幅 $a_{\\mathrm{est}} = (1+C_{\\text{interp}}^*)/2$。\n7.  计算插值误差为 $|a_{\\mathrm{est}} - 1|$。\n8.  存储结果以供最终输出。\n\n尽管解析简化很巧妙，但所提供的实现将按照问题规定执行完整的离散积分，这可以作为对该结果的数值验证。由于 $\\mathrm{TE}_{10}$ 场在 $y$ 方向上是均匀的，因此对 $y$ 方向的积分简化为乘以高度 $b$。对 $x$ 方向的积分将使用梯形法则完成。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the interpolation error for S-parameter extraction on a Yee grid.\n    \"\"\"\n    \n    # Physical constants in SI units\n    C0 = 299792458.0  # Speed of light in vacuum (m/s)\n    MU0 = 4 * np.pi * 1e-7  # Permeability of vacuum (H/m)\n    EPS0 = 1 / (MU0 * C0**2)  # Permittivity of vacuum (F/m)\n\n    # Waveguide and simulation parameters\n    A = 0.02286  # Waveguide width 'a' (m)\n    B = 0.01016  # Waveguide height 'b' (m)\n    F = 10e9     # Operating frequency (Hz)\n\n    # Derived parameters\n    OMEGA = 2 * np.pi * F  # Angular frequency (rad/s)\n    K0 = OMEGA / C0        # Free-space wavenumber (rad/m)\n    KC = np.pi / A         # TE10 cutoff wavenumber (rad/m)\n\n    # Check if frequency is above cutoff\n    f_c = C0 / (2 * A)\n    if F = f_c:\n        raise ValueError(\"Operating frequency is not above the TE10 cutoff frequency.\")\n        \n    BETA = np.sqrt(K0**2 - KC**2)  # Propagation constant (rad/m)\n\n    # Normalize TE10 mode to 1 W power\n    # H0^2 = (4 * np.pi**2) / (A**3 * B * OMEGA * MU0 * BETA)\n    # The absolute value of H0 is not needed due to cancellation, but we define\n    # the field functions for completeness and adherence to the methodology.\n    \n    # For simplicity, we can use arbitrary amplitude H0=1, as it will cancel out.\n    H0_amp = 1.0 \n    \n    # TE10 modal fields at z=0 (without H0_amp, which will be multiplied later)\n    # E_y is proportional to sin(pi*x/a), is purely imaginary\n    # H_x is proportional to sin(pi*x/a), is purely imaginary\n    # The product -Ey*Hx* is real and proportional to sin^2(pi*x/a)\n    def E_ym_func(x):\n        return -1j * (OMEGA * MU0 * A / np.pi) * np.sin(np.pi * x / A)\n\n    def H_xm_func(x):\n        return -1j * (BETA * A / np.pi) * np.sin(np.pi * x / A)\n\n    # Test cases\n    test_cases = [\n        (200, 100, 'linear'),\n        (40, 20, 'linear'),\n        (40, 20, 'nearest'),\n        (200, 100, 'nearest'),\n    ]\n\n    results = []\n    \n    for nx, ny, interp_method in test_cases:\n        # Grid parameters\n        dx = A / nx\n        dy = B / ny\n        dz = dx  # As specified\n\n        # Grid for x-integration\n        x_grid = np.linspace(0, A, nx + 1)\n        \n        # Analytically, a_est depends only on C_interp.\n        # We can calculate this directly to verify the full numerical integration.\n        arg = BETA * dz / 2\n        if interp_method == 'linear':\n            c_interp = np.cos(arg)\n        elif interp_method == 'nearest':\n            c_interp = np.exp(-1j * arg)\n        else:\n            raise ValueError(f\"Unknown interpolation method: {interp_method}\")\n        \n        a_est_analytic = (1 + np.conj(c_interp)) / 2\n        error_analytic = np.abs(a_est_analytic - 1)\n        \n        # Full numerical integration as per problem description\n        # to demonstrate the process, though it analytically simplifies.\n        \n        # Sample analytic mode fields on the grid\n        E_y_m_grid = H0_amp * E_ym_func(x_grid)\n        H_x_m_grid = H0_amp * H_xm_func(x_grid)\n        \n        # Create the interpolated H-field on the grid\n        H_x_interp_grid = H_x_m_grid * c_interp\n        \n        # Define the discrete integration over the cross-section\n        def discrete_integral(integrand_on_x_grid):\n            # Integrand is independent of y, so y-integral is multiplication by B\n            integral_x = np.trapz(integrand_on_x_grid, dx=dx)\n            return B * integral_x\n            \n        # Calculate terms for the amplitude estimator formula\n        \n        # Denominator term P_m = integral(-E_m * H_m*)\n        integrand_denom = -E_y_m_grid * np.conj(H_x_m_grid)\n        integral_denom = discrete_integral(integrand_denom)\n        \n        # Numerator term 1: integral(-E * H_m*)\n        # E is sampled from E_m at z=0, so E = E_m\n        integrand_num1 = -E_y_m_grid * np.conj(H_x_m_grid)\n        integral_num1 = discrete_integral(integrand_num1)\n        \n        # Numerator term 2: integral(-E_m * H*)\n        # H is the interpolated field\n        integrand_num2 = -E_y_m_grid * np.conj(H_x_interp_grid)\n        integral_num2 = discrete_integral(integrand_num2)\n\n        # Calculate estimated amplitude\n        # Note: 2 * integral_denom is the denominator of a_est formula\n        a_est_numeric = (integral_num1 + integral_num2) / (2 * integral_denom)\n\n        # Calculate the error. We use the numeric result as it follows the\n        # full requested procedure. It should be very close to the analytic one.\n        error_numeric = np.abs(a_est_numeric - 1)\n\n        results.append(error_numeric)\n\n    # Format output as specified\n    print(f\"[{','.join(f'{r:.15f}' for r in results)}]\")\n\n\nsolve()\n```", "id": "3345928"}, {"introduction": "FDTD仿真产生的是时域信号，必须通过傅里叶变换转换为频域的S参数。由于仿真只能在有限时间内进行，这一过程会受到频谱泄漏的影响。本分析练习 [@problem_id:3345984] 将指导您推导在简单矩形窗下所造成的最坏情况误差，从而深刻理解仿真时间与频谱精度之间的权衡关系。", "problem": "在用于提取散射参数（S参数）的单端口时域有限差分（FDTD）仿真中，反射系数 $S_{11}(\\omega)$ 是从有限时长的时域信号中估计的。考虑一个宽带激励和一个在长度为 $T$ 的有限时间间隔内记录反射波的接收器。设窗口为矩形窗，即当 $t\\in[0,T]$ 时，$w(t)=1$，否则 $w(t)=0$。在频率 $\\omega_{0}$ 处的频谱估计量是归一化的有限时间傅里叶积分\n\n$$\n\\hat{S}_{11}(\\omega_{0})=\\frac{1}{T}\\int_{0}^{T} s(t)\\,\\exp(-j\\omega_{0} t)\\,dt,\n$$\n\n其中 $s(t)$ 是反射波信号，其连续时间傅里叶变换满足 $s(t)=\\frac{1}{2\\pi}\\int_{-\\infty}^{\\infty} S_{11}^{\\star}(\\omega)\\,\\exp(j\\omega t)\\,d\\omega$，其中 $S_{11}^{\\star}(\\omega)$ 表示真实的连续谱反射系数。假设入射归一化是理想的，因此在极限 $T\\to\\infty$ 下估计量是无偏的，并且在有限的 $T$ 下唯一的系统误差是由加窗引起的频谱泄漏。\n\n假设在真实频谱中的 $\\omega_{0}$ 处存在一个尖锐陷波，即 $S_{11}^{\\star}(\\omega_{0})=0$。假设在陷波附近有以下局部正则性和有界性模型：\n- 存在一个半宽度 $\\Omega_{n}0$，使得对于所有满足 $|\\Delta|\\Omega_{n}$ 的 $\\Delta=\\omega-\\omega_{0}$，都有 $|S_{11}^{\\star}(\\omega)|\\leq L\\,|\\Delta|$，其中 $L0$ 是一个先验斜率界，用于描述陷波在远离 $\\omega_{0}$ 时填充的快慢程度。\n- 存在一个测量半带宽 $\\Delta_{H}0$，使得当 $|\\omega-\\omega_{0}|\\Delta_{H}$ 时，$S_{11}^{\\star}(\\omega)=0$，而当 $\\Omega_{n}\\leq|\\omega-\\omega_{0}|\\leq \\Delta_{H}$ 时，有 $|S_{11}^{\\star}(\\omega)|\\leq S_{b}$，其中 $S_{b}0$ 为已知。\n- 假设处于 $0\\Omega_{n}\\leq \\frac{2}{T}$ 且 $\\Delta_{H}\\geq \\frac{2}{T}$ 的情况。\n\n仅使用上述定义、有限时间估计量与真实频谱之间的卷积关系，以及矩形窗频谱核的基本包络界，推导在陷波中心的偏差大小的最坏情况下的界 $\\mathcal{B}_{\\mathrm{rect}}(T,\\Omega_{n},\\Delta_{H},L,S_{b})$，\n\n$$\n\\big|\\hat{S}_{11}(\\omega_{0})-S_{11}^{\\star}(\\omega_{0})\\big|,\n$$\n\n该界对所有与此模型一致的频谱均成立。您可以使用标准定义 $\\mathrm{sinc}(x)=\\frac{\\sin x}{x}$ 以及对于所有实数 $x$，都有 $|\\mathrm{sinc}(x)|\\leq \\min\\{1,\\frac{1}{|x|}\\}$ 这一事实。\n\n然后，提出一种基于离散扁长球状序列（DPSS）的窗函数，以减小这个最坏情况下的界。请指明您将使用的时间-带宽积 $NW$ 和DPSS阶数，并定性地论证在相同的陷波场景下，为何这个选择能减小推导出的界。您的提议应使用给定参数 $(T,\\Omega_{n},\\Delta_{H},L,S_{b})$ 来表示；然而，您的最终答案必须仅为 $\\mathcal{B}_{\\mathrm{rect}}(T,\\Omega_{n},\\Delta_{H},L,S_{b})$ 的闭式解析表达式。无需进行数值计算，最终答案中也不应报告单位。", "solution": "该问题要求在真实频谱存在陷波（即 $S_{11}^{\\star}(\\omega_0) = 0$）的频率 $\\omega_0$ 处，计算反射系数 $S_{11}(\\omega)$ 的频谱估计量的偏差的最坏情况下的界。偏差定义为估计值 $\\hat{S}_{11}(\\omega_0)$ 与真实值 $S_{11}^{\\star}(\\omega_0)$ 之间差值的绝对值。\n\n估计量由下式给出\n$$ \\hat{S}_{11}(\\omega_0) = \\frac{1}{T} \\int_0^T s(t) \\exp(-j\\omega_0 t) dt $$\n其中 $s(t)$ 是反射信号，$T$ 是观测时长。这可以表示为对加窗信号的傅里叶变换求值。矩形窗为当 $t \\in [0, T]$ 时 $w(t)=1$，否则 $w(t)=0$。估计量可写为\n$$ \\hat{S}_{11}(\\omega_0) = \\frac{1}{T} \\mathcal{F}\\{s(t)w(t)\\}(\\omega_0) $$\n根据卷积定理，两个时域信号乘积的傅里叶变换是它们各自傅里叶变换的卷积，并按 $\\frac{1}{2\\pi}$ 进行缩放：\n$$ \\mathcal{F}\\{s(t)w(t)\\}(\\omega) = \\frac{1}{2\\pi} \\left( \\mathcal{F}\\{s(t)\\} * \\mathcal{F}\\{w(t)\\} \\right)(\\omega) = \\frac{1}{2\\pi} \\left( S_{11}^{\\star} * W \\right)(\\omega) $$\n其中 $S_{11}^{\\star}(\\omega)$ 是真实频谱，$W(\\omega)$ 是矩形窗 $w(t)$ 的傅里叶变换：\n$$ W(\\omega) = \\int_0^T \\exp(-j\\omega t) dt = T \\exp\\left(-\\frac{j\\omega T}{2}\\right) \\mathrm{sinc}\\left(\\frac{\\omega T}{2}\\right) $$\n将此代入估计量表达式中，可得 $\\hat{S}_{11}(\\omega_0)$ 与真实频谱 $S_{11}^{\\star}(\\omega)$ 之间的卷积关系：\n$$ \\hat{S}_{11}(\\omega_0) = \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} S_{11}^{\\star}(\\omega') \\exp\\left(-j\\frac{(\\omega_0 - \\omega')T}{2}\\right) \\mathrm{sinc}\\left(\\frac{(\\omega_0 - \\omega')T}{2}\\right) d\\omega' $$\n令积分变量为 $\\Delta = \\omega' - \\omega_0$，由于 $\\mathrm{sinc}$ 是偶函数，我们有：\n$$ \\hat{S}_{11}(\\omega_0) = \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} S_{11}^{\\star}(\\omega_0+\\Delta) \\exp\\left(j\\frac{\\Delta T}{2}\\right) \\mathrm{sinc}\\left(\\frac{\\Delta T}{2}\\right) d\\Delta $$\n偏差为 $|\\hat{S}_{11}(\\omega_0) - S_{11}^{\\star}(\\omega_0)|$。给定 $S_{11}^{\\star}(\\omega_0)=0$，偏差大小为 $|\\hat{S}_{11}(\\omega_0)|$。我们可以使用积分的三角不等式来对其进行界定：\n$$ \\left|\\hat{S}_{11}(\\omega_0)\\right| \\le \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} \\left|S_{11}^{\\star}(\\omega_0+\\Delta)\\right| \\left|\\mathrm{sinc}\\left(\\frac{\\Delta T}{2}\\right)\\right| d\\Delta $$\n现在我们应用给定的频谱模型。当 $|\\Delta|  \\Delta_H$ 时频谱为零，因此积分区间为 $[-\\Delta_H, \\Delta_H]$。$|S_{11}^{\\star}(\\omega_0+\\Delta)|$ 的界在 $\\Delta$ 上是对称的。因此被积函数是 $\\Delta$ 的偶函数，这使我们能够从 $0$ 积分到 $\\Delta_H$ 并乘以 2：\n$$ \\left|\\hat{S}_{11}(\\omega_0)\\right| \\le \\frac{1}{\\pi} \\int_{0}^{\\Delta_H} \\left|S_{11}^{\\star}(\\omega_0+\\Delta)\\right|_{\\mathrm{worst-case}} \\left|\\mathrm{sinc}\\left(\\frac{\\Delta T}{2}\\right)\\right| d\\Delta $$\n我们根据频谱模型将积分分成两个区域：\n1. 对于 $0 \\le \\Delta  \\Omega_n$：$|S_{11}^{\\star}(\\omega_0+\\Delta)| \\le L\\Delta$。\n2. 对于 $\\Omega_n \\le \\Delta \\le \\Delta_H$：$|S_{11}^{\\star}(\\omega_0+\\Delta)| \\le S_b$。\n\n该界变为：\n$$ \\mathcal{B}_{\\mathrm{rect}} = \\frac{1}{\\pi} \\left[ \\int_{0}^{\\Omega_n} L\\Delta \\left|\\mathrm{sinc}\\left(\\frac{\\Delta T}{2}\\right)\\right| d\\Delta + \\int_{\\Omega_n}^{\\Delta_H} S_b \\left|\\mathrm{sinc}\\left(\\frac{\\Delta T}{2}\\right)\\right| d\\Delta \\right] $$\n我们使用给定的界 $|\\mathrm{sinc}(x)| \\le \\min\\{1, 1/|x|\\}$。这两个界之间的转换发生在 $|\\Delta|=2/T$ 处。\n\n对于第一个积分，定义域为 $0 \\le \\Delta \\le \\Omega_n$。在给定 $\\Omega_n \\le 2/T$ 的情况下，我们有 $\\Delta T/2 \\le \\Omega_n T/2 \\le 1$。在此范围内，界 $|\\mathrm{sinc}(\\Delta T/2)| \\le 1$ 是更紧的。\n$$ \\int_{0}^{\\Omega_n} L\\Delta \\left|\\mathrm{sinc}\\left(\\frac{\\Delta T}{2}\\right)\\right| d\\Delta \\le \\int_{0}^{\\Omega_n} L\\Delta \\cdot 1 \\, d\\Delta = \\frac{1}{2}L\\Omega_n^2 $$\n\n对于第二个积分，定义域为 $\\Omega_n \\le \\Delta \\le \\Delta_H$。给定 $\\Omega_n \\le 2/T$ 和 $\\Delta_H \\ge 2/T$，因此我们必须在 $\\Delta=2/T$ 处分割此积分。\n$$ \\int_{\\Omega_n}^{\\Delta_H} S_b \\left|\\mathrm{sinc}\\left(\\frac{\\Delta T}{2}\\right)\\right| d\\Delta = S_b \\left[ \\int_{\\Omega_n}^{2/T} \\left|\\mathrm{sinc}\\left(\\frac{\\Delta T}{2}\\right)\\right| d\\Delta + \\int_{2/T}^{\\Delta_H} \\left|\\mathrm{sinc}\\left(\\frac{\\Delta T}{2}\\right)\\right| d\\Delta \\right] $$\n在范围 $\\Omega_n \\le \\Delta \\le 2/T$ 内，我们使用 $|\\mathrm{sinc}(\\Delta T/2)| \\le 1$：\n$$ \\int_{\\Omega_n}^{2/T} \\left|\\mathrm{sinc}\\left(\\frac{\\Delta T}{2}\\right)\\right| d\\Delta \\le \\frac{2}{T} - \\Omega_n $$\n在范围 $2/T \\le \\Delta \\le \\Delta_H$ 内，我们使用 $|\\mathrm{sinc}(\\Delta T/2)| \\le 1/(\\Delta T/2) = 2/(\\Delta T)$：\n$$ \\int_{2/T}^{\\Delta_H} \\left|\\mathrm{sinc}\\left(\\frac{\\Delta T}{2}\\right)\\right| d\\Delta \\le \\int_{2/T}^{\\Delta_H} \\frac{2}{\\Delta T} d\\Delta = \\frac{2}{T} \\ln\\left(\\frac{\\Delta_H T}{2}\\right) $$\n合并各项，最终的界 $\\mathcal{B}_{\\mathrm{rect}}$ 为：\n$$ \\mathcal{B}_{\\mathrm{rect}}(T,\\Omega_{n},\\Delta_{H},L,S_{b}) = \\frac{1}{\\pi} \\left[ \\frac{1}{2}L\\Omega_n^2 + S_b\\left(\\frac{2}{T} - \\Omega_n\\right) + \\frac{2S_b}{T}\\ln\\left(\\frac{\\Delta_H T}{2}\\right) \\right] $$\n\n关于替代窗函数的提议，矩形窗的主要误差来源是其 $\\mathrm{sinc}$ 谱旁瓣的缓慢 $1/|\\Delta|$ 衰减，这导致了对数项。为了减小这个误差，需要一个旁瓣衰减更快的窗函数。\n离散扁长球状序列（DPSS），也称为 Slepian 窗，是一个绝佳的选择。具体来说，我们建议对给定的时间长度 $T$ 使用一阶DPSS（对应于最大特征值的序列）。关键的设计参数是时间-带宽积，通常表示为 $NW$ 或 $C$。鉴于陷波是未分辨的（$\\Omega_n \\le 2/T$），矩形窗的主瓣已经比我们感兴趣的谱特征宽。因此，略微增加主瓣宽度以换取旁瓣水平的急剧降低是可接受的权衡。对于要求高动态范围的应用，时间-带宽积的一个标准选择是 $NW=4$。这个选择将使得由远端谱能量（由 $S_b$ 和 $\\Delta_H$ 表征）产生的泄漏项的衰减速度远快于对数衰减，从而显著降低最坏情况下的偏差。", "answer": "$$\\boxed{\\frac{1}{\\pi} \\left( \\frac{1}{2} L \\Omega_n^2 + S_b\\left( \\frac{2}{T} - \\Omega_n \\right) + \\frac{2S_b}{T}\\ln\\left(\\frac{\\Delta_H T}{2}\\right) \\right)}$$", "id": "3345984"}]}