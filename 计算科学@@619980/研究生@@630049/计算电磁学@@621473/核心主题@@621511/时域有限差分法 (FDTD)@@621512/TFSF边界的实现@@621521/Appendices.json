{"hands_on_practices": [{"introduction": "在将总场/散射场（TFSF）边界条件付诸实践之前，我们必须掌握一项基本技能：在FDTD算法所规定的离散时空位置上，精确计算入射场的数值。本练习旨在提供这项核心技能的实践，它将平面波的连续数学描述转化为数值算法所需的离散值。这是从理论走向代码的关键第一步，确保您能够准确地在交错的Yee元胞网格上对入射波进行采样[@problem_id:3318287]。", "problem": "一个三维时域有限差分 (FDTD) 仿真使用总场/散射场 (TFSF) 边界将单色平面波注入均匀、各向同性、无源、非色散的介质（自由空间）中。TFSF 边界将总场区域与散射场区域分隔开，并在其表面上需要校正项，以确保总场区域中仅存在入射平面波，而散射场区域中仅存在散射场。该平面波由其波矢量 $\\mathbf{k}$、极化单位矢量 $\\hat{p}$ 和角频率 $\\omega$ 表征。离散化对电磁场分量使用交错的 Yee 网格，并采用蛙跳法时间步进。\n\n物理设置为自由空间，光速为 $c$，介电常数为 $\\epsilon_{0}$，磁导率为 $\\mu_{0}$，并遵循麦克斯韦方程组。入射平面波是这些方程的一个解，其形式为横电磁波，电场为\n$$\\mathbf{E}_{\\mathrm{inc}}(\\mathbf{r},t)=\\Re\\left\\{E_{0}\\,\\hat{p}\\,\\exp\\!\\left(i\\big(\\mathbf{k}\\cdot\\mathbf{r}-\\omega t\\big)\\right)\\right\\},$$\n磁场为\n$$\\mathbf{H}_{\\mathrm{inc}}(\\mathbf{r},t)=\\Re\\left\\{H_{0}\\,\\hat{h}\\,\\exp\\!\\left(i\\big(\\mathbf{k}\\cdot\\mathbf{r}-\\omega t\\big)\\right)\\right\\},$$\n其中 $E_{0}$ 和 $H_{0}$ 是满足自由空间中平面波关系的实振幅，$\\hat{h}=\\hat{k}\\times\\hat{p}/\\eta_{0}$，其中 $\\hat{k}=\\mathbf{k}/|\\mathbf{k}|$ 且 $\\eta_{0}=\\sqrt{\\mu_{0}/\\epsilon_{0}}$，并且 $\\mathbf{E}_{\\mathrm{inc}}$ 和 $\\mathbf{H}_{\\mathrm{inc}}$ 的相位相同。数值网格使用空间步长 $\\Delta x$、$\\Delta y$、$\\Delta z$ 和时间步长 $\\Delta t$。在 Yee 网格上，每个单元内的场分量采样位置是交错的，电场在整数时间索引 $n$ 处采样，而磁场在半整数时间索引 $n+\\tfrac{1}{2}$ 处采样。\n\n考虑位于 Yee 网格中由索引 $i=i_{b}$ 定义的平面 $x=x_{b}$ 上的 $+x$ TFSF 面。此面所需的校正项涉及在以下分量位置处计算的入射场相位因子：\n- 对于时间索引 $n$ 处的电场：$E_{y}$ 位于 $\\big(i_{b},\\,j+\\tfrac{1}{2},\\,k\\big)$，$E_{z}$ 位于 $\\big(i_{b},\\,j,\\,k+\\tfrac{1}{2}\\big)$。\n- 对于时间索引 $n+\\tfrac{1}{2}$ 处的磁场：$H_{y}$ 位于 $\\big(i_{b}-\\tfrac{1}{2},\\,j,\\,k+\\tfrac{1}{2}\\big)$，$H_{z}$ 位于 $\\big(i_{b}-\\tfrac{1}{2},\\,j+\\tfrac{1}{2},\\,k\\big)$。\n\n所有位置都对应于由 $x=i\\Delta x$、$y=j\\Delta y$ 和 $z=k\\Delta z$ 给出的物理坐标 $\\mathbf{r}=\\big(x,\\,y,\\,z\\big)$，半索引偏移也作相应解释。在场采样位置 $\\mathbf{r}$ 和时间 $t$ 处的入射场相位因子是复数量\n$$\\Phi(\\mathbf{r},t)=\\exp\\!\\left(i\\big(\\mathbf{k}\\cdot\\mathbf{r}-\\omega t\\big)\\right).$$\n\n给定以下参数：\n- 自由空间光速 $c=3.0\\times 10^{8}\\,\\mathrm{m/s}$。\n- 频率 $f=3.0\\times 10^{9}\\,\\mathrm{Hz}$ 和角频率 $\\omega=2\\pi f$。\n- 波长 $\\lambda=c/f$，以及均匀的空间步长 $\\Delta x=\\Delta y=\\Delta z=\\lambda/10$。\n- 时间步长 $\\Delta t=\\Delta x/(c\\sqrt{3})=1/(10 f\\sqrt{3})$，与三维中的 Courant–Friedrichs–Lewy 稳定性极限一致。\n- 波矢量 $\\mathbf{k}=k_{0}\\,\\hat{k}$，其中 $k_{0}=\\omega/c$，传播方向单位矢量为 $\\hat{k}=\\frac{1}{\\sqrt{3}}\\big(1,\\,1,\\,1\\big)$。\n- 极化单位矢量 $\\hat{p}=\\frac{1}{\\sqrt{2}}\\big(1,\\,-1,\\,0\\big)$。\n- TFSF 面索引和校正索引：$i_{b}=12$, $j=5$, $k=8$。\n- 时间索引 $n=30$。\n\n使用上述 Yee 网格采样约定和给定参数，计算在 $+x$ TFSF 面上校正节点的入射场的四个复相位因子：\n$$\\Phi_{E_{y}}=\\Phi\\!\\left(\\mathbf{r}_{E_{y}},\\,t_{E}\\right),\\quad \\Phi_{E_{z}}=\\Phi\\!\\left(\\mathbf{r}_{E_{z}},\\,t_{E}\\right),\\quad \\Phi_{H_{y}}=\\Phi\\!\\left(\\mathbf{r}_{H_{y}},\\,t_{H}\\right),\\quad \\Phi_{H_{z}}=\\Phi\\!\\left(\\mathbf{r}_{H_{z}},\\,t_{H}\\right),$$\n其中 $\\mathbf{r}_{E_{y}}=\\big(i_{b}\\Delta x,\\,(j+\\tfrac{1}{2})\\Delta y,\\,k\\Delta z\\big)$，$\\mathbf{r}_{E_{z}}=\\big(i_{b}\\Delta x,\\,j\\Delta y,\\,(k+\\tfrac{1}{2})\\Delta z\\big)$，$\\mathbf{r}_{H_{y}}=\\big((i_{b}-\\tfrac{1}{2})\\Delta x,\\,j\\Delta y,\\,(k+\\tfrac{1}{2})\\Delta z\\big)$，$\\mathbf{r}_{H_{z}}=\\big((i_{b}-\\tfrac{1}{2})\\Delta x,\\,(j+\\tfrac{1}{2})\\Delta y,\\,k\\Delta z\\big)$，以及 $t_{E}=n\\Delta t$，$t_{H}=(n+\\tfrac{1}{2})\\Delta t$。\n\n以弧度为单位，用精确的解析表达式表示最终答案，不要进行数值舍入，并使用规定的格式将四个相位因子呈现在一个行矩阵中。", "solution": "问题要求计算入射平面波在 Yee 网格上特定位置和时间的四个复相位因子：$\\Phi_{E_{y}}$、$\\Phi_{E_{z}}$、$\\Phi_{H_{y}}$ 和 $\\Phi_{H_{z}}$。这些因子对于在时域有限差分 (FDTD) 仿真中实现总场/散射场 (TFSF) 边界条件至关重要。\n\n复相位因子定义为 $\\Phi(\\mathbf{r},t)=\\exp\\!\\left(i\\big(\\mathbf{k}\\cdot\\mathbf{r}-\\omega t\\big)\\right)$。指数的自变量 $\\phi(\\mathbf{r},t) = \\mathbf{k}\\cdot\\mathbf{r}-\\omega t$ 是波的相位。我们的主要任务是为四个指定的场分量中的每一个计算该相位。\n\n首先，我们根据给定信息确定关键的数值参数。\n频率为 $f=3.0\\times 10^{9}\\,\\mathrm{Hz}$。\n角频率为 $\\omega=2\\pi f$。\n光速为 $c=3.0\\times 10^{8}\\,\\mathrm{m/s}$。\n波长为 $\\lambda=c/f$。\n空间离散化步长是均匀的：$\\Delta x=\\Delta y=\\Delta z=\\frac{\\lambda}{10} = \\frac{c}{10f}$。\n时间步长为 $\\Delta t=\\frac{\\Delta x}{c\\sqrt{3}} = \\frac{c/(10f)}{c\\sqrt{3}} = \\frac{1}{10f\\sqrt{3}}$。\n\n波矢量为 $\\mathbf{k} = k_0 \\hat{k}$，其中波数为 $k_0 = \\frac{\\omega}{c} = \\frac{2\\pi f}{c} = \\frac{2\\pi}{\\lambda}$。\n传播方向为 $\\hat{k}=\\frac{1}{\\sqrt{3}}\\big(1,\\,1,\\,1\\big)$。\n因此，波矢量的分量为 $k_x = k_y = k_z = k_0 \\frac{1}{\\sqrt{3}} = \\frac{2\\pi}{\\lambda\\sqrt{3}}$。\n\n我们现在可以计算每个网格步长和每个时间步长的数值相移。\n每个方向上每个空间步长的相移为：\n$$k_x \\Delta x = k_y \\Delta y = k_z \\Delta z = \\left(\\frac{2\\pi}{\\lambda\\sqrt{3}}\\right)\\left(\\frac{\\lambda}{10}\\right) = \\frac{2\\pi}{10\\sqrt{3}} = \\frac{\\pi}{5\\sqrt{3}}$$\n每个时间步长的相移为：\n$$\\omega \\Delta t = (2\\pi f)\\left(\\frac{1}{10f\\sqrt{3}}\\right) = \\frac{2\\pi}{10\\sqrt{3}} = \\frac{\\pi}{5\\sqrt{3}}$$\n值得注意的是，这些值是相同的。我们用 $\\alpha$ 表示这个公共的相位增量：\n$$\\alpha = \\frac{\\pi}{5\\sqrt{3}}$$\n将分母有理化得到 $\\alpha = \\frac{\\pi\\sqrt{3}}{15}$。但是，我们将继续使用第一种形式。\n\n在时间 $n\\Delta t$ 时，一般网格点 $(i\\Delta x, j\\Delta y, k\\Delta z)$ 处的相位可以表示为：\n$\\phi = k_x(i\\Delta x) + k_y(j\\Delta y) + k_z(k\\Delta z) - \\omega(n\\Delta t) = i(k_x\\Delta x) + j(k_y\\Delta y) + k(k_z\\Delta z) - n(\\omega\\Delta t) = \\alpha(i+j+k-n)$。\n我们将使用这个简化的结构，并考虑每个分量在空间和时间上的半步长偏移。给定的索引为 $i_b=12$、$j=5$、$k=8$ 和 $n=30$。\n\n1.  **$E_y$ 分量的相位因子 ($\\Phi_{E_{y}}$):**\n    $E_y$ 分量位于 $\\mathbf{r}_{E_{y}}=\\big(i_{b}\\Delta x,\\,(j+\\tfrac{1}{2})\\Delta y,\\,k\\Delta z\\big)$ 处，并在时间 $t_{E}=n\\Delta t$ 采样。\n    相位为：\n    $$\\phi_{E_{y}} = \\mathbf{k}\\cdot\\mathbf{r}_{E_{y}} - \\omega t_{E} = k_x(i_b\\Delta x) + k_y\\left(\\left(j+\\tfrac{1}{2}\\right)\\Delta y\\right) + k_z(k\\Delta z) - \\omega(n\\Delta t)$$\n    $$\\phi_{E_{y}} = i_b(k_x\\Delta x) + \\left(j+\\tfrac{1}{2}\\right)(k_y\\Delta y) + k(k_z\\Delta z) - n(\\omega\\Delta t)$$\n    $$\\phi_{E_{y}} = \\alpha\\left(i_b + j + \\tfrac{1}{2} + k - n\\right)$$\n    代入给定的索引值：\n    $$\\phi_{E_{y}} = \\alpha\\left(12 + 5 + \\tfrac{1}{2} + 8 - 30\\right) = \\alpha\\left(25 + \\tfrac{1}{2} - 30\\right) = \\alpha\\left(-5 + \\tfrac{1}{2}\\right) = -\\frac{9}{2}\\alpha$$\n    $$\\phi_{E_{y}} = -\\frac{9}{2} \\left(\\frac{\\pi}{5\\sqrt{3}}\\right) = -\\frac{9\\pi}{10\\sqrt{3}} = -\\frac{9\\pi\\sqrt{3}}{30} = -\\frac{3\\pi\\sqrt{3}}{10}$$\n    所以，相位因子为 $\\Phi_{E_{y}} = \\exp\\left(-i\\frac{3\\pi\\sqrt{3}}{10}\\right)$。\n\n2.  **$E_z$ 分量的相位因子 ($\\Phi_{E_{z}}$):**\n    $E_z$ 分量位于 $\\mathbf{r}_{E_{z}}=\\big(i_{b}\\Delta x,\\,j\\Delta y,\\,(k+\\tfrac{1}{2})\\Delta z\\big)$ 处，并在时间 $t_{E}=n\\Delta t$ 采样。\n    相位为：\n    $$\\phi_{E_{z}} = \\mathbf{k}\\cdot\\mathbf{r}_{E_{z}} - \\omega t_{E} = k_x(i_b\\Delta x) + k_y(j\\Delta y) + k_z\\left(\\left(k+\\tfrac{1}{2}\\right)\\Delta z\\right) - \\omega(n\\Delta t)$$\n    $$\\phi_{E_{z}} = \\alpha\\left(i_b + j + k + \\tfrac{1}{2} - n\\right)$$\n    这与 $E_y$ 的相位表达式相同。\n    $$\\phi_{E_{z}} = \\alpha\\left(12 + 5 + 8 + \\tfrac{1}{2} - 30\\right) = -\\frac{9}{2}\\alpha = -\\frac{3\\pi\\sqrt{3}}{10}$$\n    因此，相位因子也相同：$\\Phi_{E_{z}} = \\exp\\left(-i\\frac{3\\pi\\sqrt{3}}{10}\\right)$。\n\n3.  **$H_y$ 分量的相位因子 ($\\Phi_{H_{y}}$):**\n    $H_y$ 分量位于 $\\mathbf{r}_{H_{y}}=\\big((i_{b}-\\tfrac{1}{2})\\Delta x,\\,j\\Delta y,\\,(k+\\tfrac{1}{2})\\Delta z\\big)$ 处，并在时间 $t_{H}=(n+\\tfrac{1}{2})\\Delta t$ 采样。\n    相位为：\n    $$\\phi_{H_{y}} = \\mathbf{k}\\cdot\\mathbf{r}_{H_{y}} - \\omega t_{H} = k_x\\left(\\left(i_b-\\tfrac{1}{2}\\right)\\Delta x\\right) + k_y(j\\Delta y) + k_z\\left(\\left(k+\\tfrac{1}{2}\\right)\\Delta z\\right) - \\omega\\left(\\left(n+\\tfrac{1}{2}\\right)\\Delta t\\right)$$\n    $$\\phi_{H_{y}} = \\alpha\\left(\\left(i_b-\\tfrac{1}{2}\\right) + j + \\left(k+\\tfrac{1}{2}\\right) - \\left(n+\\tfrac{1}{2}\\right)\\right)$$\n    $$\\phi_{H_{y}} = \\alpha\\left(i_b + j + k - n - \\tfrac{1}{2}\\right)$$\n    代入索引值：\n    $$\\phi_{H_{y}} = \\alpha\\left(12 + 5 + 8 - 30 - \\tfrac{1}{2}\\right) = \\alpha\\left(25 - 30 - \\tfrac{1}{2}\\right) = \\alpha\\left(-5 - \\tfrac{1}{2}\\right) = -\\frac{11}{2}\\alpha$$\n    $$\\phi_{H_{y}} = -\\frac{11}{2}\\left(\\frac{\\pi}{5\\sqrt{3}}\\right) = -\\frac{11\\pi}{10\\sqrt{3}} = -\\frac{11\\pi\\sqrt{3}}{30}$$\n    对应的相位因子为 $\\Phi_{H_{y}} = \\exp\\left(-i\\frac{11\\pi\\sqrt{3}}{30}\\right)$。\n\n4.  **$H_z$ 分量的相位因子 ($\\Phi_{H_{z}}$):**\n    $H_z$ 分量位于 $\\mathbf{r}_{H_{z}}=\\big((i_{b}-\\tfrac{1}{2})\\Delta x,\\,(j+\\tfrac{1}{2})\\Delta y,\\,k\\Delta z\\big)$ 处，并在时间 $t_{H}=(n+\\tfrac{1}{2})\\Delta t$ 采样。\n    相位为：\n    $$\\phi_{H_{z}} = \\mathbf{k}\\cdot\\mathbf{r}_{H_{z}} - \\omega t_{H} = k_x\\left(\\left(i_b-\\tfrac{1}{2}\\right)\\Delta x\\right) + k_y\\left(\\left(j+\\tfrac{1}{2}\\right)\\Delta y\\right) + k_z(k\\Delta z) - \\omega\\left(\\left(n+\\tfrac{1}{2}\\right)\\Delta t\\right)$$\n    $$\\phi_{H_{z}} = \\alpha\\left(\\left(i_b-\\tfrac{1}{2}\\right) + \\left(j+\\tfrac{1}{2}\\right) + k - \\left(n+\\tfrac{1}{2}\\right)\\right)$$\n    $$\\phi_{H_{z}} = \\alpha\\left(i_b + j + k - n - \\tfrac{1}{2}\\right)$$\n    该表达式与 $H_y$ 的相位相同。\n    $$\\phi_{H_{z}} = \\alpha\\left(12 + 5 + 8 - 30 - \\tfrac{1}{2}\\right) = -\\frac{11}{2}\\alpha = -\\frac{11\\pi\\sqrt{3}}{30}$$\n    因此，相位因子为 $\\Phi_{H_{z}} = \\exp\\left(-i\\frac{11\\pi\\sqrt{3}}{30}\\right)$。\n\n所需的四个复相位因子是：\n$\\Phi_{E_{y}} = \\exp\\left(-i\\frac{3\\pi\\sqrt{3}}{10}\\right)$\n$\\Phi_{E_{z}} = \\exp\\left(-i\\frac{3\\pi\\sqrt{3}}{10}\\right)$\n$\\Phi_{H_{y}} = \\exp\\left(-i\\frac{11\\pi\\sqrt{3}}{30}\\right)$\n$\\Phi_{H_{z}} = \\exp\\left(-i\\frac{11\\pi\\sqrt{3}}{30}\\right)$\n\n这些结果将呈现在一个行矩阵中。", "answer": "$$\n\\boxed{\n\\begin{pmatrix} \\exp\\left(-i\\frac{3\\pi\\sqrt{3}}{10}\\right)  \\exp\\left(-i\\frac{3\\pi\\sqrt{3}}{10}\\right)  \\exp\\left(-i\\frac{11\\pi\\sqrt{3}}{30}\\right)  \\exp\\left(-i\\frac{11\\pi\\sqrt{3}}{30}\\right) \\end{pmatrix}\n}\n$$", "id": "3318287"}, {"introduction": "许多实际的仿真场景涉及具有频率相关特性（即色散）的材料，而TFSF源的实现必须考虑这一复杂性。本练习将超越自由空间的假设，应对在色散介质中注入单色波的挑战，此处以Drude模型为例。您将通过编程实现介质复阻抗的计算，并利用它为TFSF源生成具有正确相位和幅值的时域电场和磁场序列[@problem_id:3318221]。", "problem": "考虑在时域有限差分 (FDTD) 方法中实现的总场/散射场 (TFSF) 边界处的一维平面波注入。支持入射波的介质是均匀、各向同性、非磁性且具有 Drude 型电响应的色散介质。其物理基础是时域麦克斯韦方程组和频域中的本构关系。令 $E$ 和 $H$ 分别表示电场和磁场，$D$ 表示电通量密度，$B$ 表示磁通量密度，$t$ 表示时间，$\\omega$ 表示角频率，$\\mu_0$ 表示自由空间磁导率，$\\epsilon_0$ 表示自由空间介电常数。频域 Drude 介电常数定义为\n$$\n\\epsilon(\\omega) = \\epsilon_0\\left(1 - \\frac{\\omega_p^2}{\\omega^2 + i \\gamma \\omega}\\right),\n$$\n其中 $\\omega_p$ 是等离子体角频率，$\\gamma$ 是碰撞频率。对于角频率为 $\\omega = 2\\pi f$ 的单色平面波，其本征阻抗为\n$$\n\\eta(\\omega) = \\sqrt{\\frac{\\mu_0}{\\epsilon(\\omega)}}.\n$$\n在正入射条件下，$E$ 沿一个横向方向极化，而 $H$ 沿与之正交的横向方向极化，相量场满足平面波关系 $H = E/\\eta(\\omega)$。\n\n在标准的蛙跳 FDTD 离散化中，TFSF 边界必须注入在交错时间点上采样的入射场：在时间 $t_n = n\\,\\Delta t$ 处的离散时间电场序列 $E[n]$ 和在时间 $t_{n+\\frac{1}{2}} = \\left(n+\\frac{1}{2}\\right)\\Delta t$ 处的离散时间磁场序列 $H[n]$，其中 $\\Delta t$ 是时间步长。为了构建与目标单色频率下色散介质一致的注入入射序列，假设电场为单位振幅的正弦激励，即从相量 $E_0 = 1$（单位 $\\mathrm{V/m}$）导出的实值谐波信号。需要计算的注入离散时间序列为：\n- 电场：$E[n] = \\Re\\left\\{E_0\\,e^{i \\omega n \\Delta t}\\right\\}$，单位为 $\\mathrm{V/m}$。\n- 磁场：$H[n] = \\Re\\left\\{\\frac{E_0}{\\eta(\\omega)}\\,e^{i \\omega \\left(n+\\frac{1}{2}\\right)\\Delta t}\\right\\}$，单位为 $\\mathrm{A/m}$。\n\n所有角度必须以弧度处理。使用 $\\mu_0 = 4\\pi\\times 10^{-7}\\ \\mathrm{H/m}$ 和 $\\epsilon_0 = 8.854187817\\times 10^{-12}\\ \\mathrm{F/m}$。对于数值输出，将每个样本四舍五入到 $6$ 位小数。\n\n您的任务是编写一个完整、可运行的程序，对于给定的参数 $\\omega_p$（单位 $\\mathrm{rad/s}$）、$\\gamma$（单位 $\\mathrm{s^{-1}}$）、$\\Delta t$（单位 $\\mathrm{s}$）和目标频率 $f$（单位 $\\mathrm{Hz}$），计算在 TFSF 边界注入的离散时间入射 $E$ 和 $H$ 序列，共 $N$ 个样本，其中 $N$ 由每个测试用例指定。程序必须实现上述公式，并为以下测试套件生成结果：\n\n- 测试用例 1（通用介质，中等色散）：$\\omega_p = 5.0\\times 10^{14}\\ \\mathrm{rad/s}$，$\\gamma = 1.0\\times 10^{12}\\ \\mathrm{s^{-1}}$，$\\Delta t = 1.0\\times 10^{-16}\\ \\mathrm{s}$，$f = 2.0\\times 10^{14}\\ \\mathrm{Hz}$，$N = 8$。\n- 测试用例 2（无损 Drude，$\\gamma = 0$）：$\\omega_p = 4.0\\times 10^{14}\\ \\mathrm{rad/s}$，$\\gamma = 0.0\\ \\mathrm{s^{-1}}$，$\\Delta t = 1.0\\times 10^{-16}\\ \\mathrm{s}$，$f = 3.0\\times 10^{14}\\ \\mathrm{Hz}$，$N = 8$。\n- 测试用例 3（强阻尼）：$\\omega_p = 6.0\\times 10^{14}\\ \\mathrm{rad/s}$，$\\gamma = 5.0\\times 10^{14}\\ \\mathrm{s^{-1}}$，$\\Delta t = 5.0\\times 10^{-16}\\ \\mathrm{s}$，$f = 1.0\\times 10^{14}\\ \\mathrm{Hz}$，$N = 8$。\n- 测试用例 4（近奈奎斯特采样）：$\\omega_p = 3.0\\times 10^{14}\\ \\mathrm{rad/s}$，$\\gamma = 1.0\\times 10^{13}\\ \\mathrm{s^{-1}}$，$\\Delta t = 1.0\\times 10^{-15}\\ \\mathrm{s}$，$f = 0.49/\\Delta t\\ \\mathrm{Hz}$，$N = 8$。\n\n要求的最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个测试用例对应一个条目。每个条目必须是一对列表 $[E\\_seq, H\\_seq]$，其中 $E\\_seq$ 是 $N$ 个四舍五入的 $E[n]$ 样本列表（单位 $\\mathrm{V/m}$），$H\\_seq$ 是 $N$ 个四舍五入的 $H[n]$ 样本列表（单位 $\\mathrm{A/m}$）。例如，输出必须具有以下形式：\n$$\n\\left[ [ [E\\_1], [H\\_1] ], [ [E\\_2], [H\\_2] ], [ [E\\_3], [H\\_3] ], [ [E\\_4], [H\\_4] ] \\right],\n$$\n其中每个 $[E\\_k]$ 和 $[H\\_k]$ 包含 $N$ 个四舍五入到 $6$ 位小数的实数。输出必须严格为遵循此确切格式的单行。", "solution": "该问题陈述经评估有效。其科学基础是计算电磁学的原理，特别是时域有限差分 (FDTD) 方法和用于材料色散的 Drude 模型。该问题是适定的，为每个测试用例提供了所有必要的物理常数、数学公式和输入参数，以计算唯一、可验证的解。术语精确客观，设置自洽且逻辑一致。\n\n任务是计算要在一维平面波的“总场/散射场”(TFSF) 边界处注入的离散时间入射电场序列 $E[n]$ 和磁场序列 $H[n]$。介质是色散的 Drude 材料。序列需要计算 $N$ 个时间步。\n\n每个测试用例的计算过程如下：\n\n1.  **定义常数和参数**：\n    物理常数是自由空间磁导率 $\\mu_0 = 4\\pi\\times 10^{-7}\\ \\mathrm{H/m}$ 和自由空间介电常数 $\\epsilon_0 = 8.854187817\\times 10^{-12}\\ \\mathrm{F/m}$。\n    对于每个测试用例，我们都给定了等离子体角频率 $\\omega_p$（单位 $\\mathrm{rad/s}$）、碰撞频率 $\\gamma$（单位 $\\mathrm{s^{-1}}$）、FDTD 时间步长 $\\Delta t$（单位 $\\mathrm{s}$）、源频率 $f$（单位 $\\mathrm{Hz}$）和样本数 $N$。\n\n2.  **计算角频率**：\n    角频率 $\\omega$ 根据给定的源频率 $f$ 使用以下关系计算：\n    $$ \\omega = 2\\pi f $$\n\n3.  **计算复介电常数**：\n    频域 Drude 介电常数 $\\epsilon(\\omega)$ 是一个复数，使用提供的公式计算：\n    $$ \\epsilon(\\omega) = \\epsilon_0\\left(1 - \\frac{\\omega_p^2}{\\omega^2 + i \\gamma \\omega}\\right) $$\n    其中 $i = \\sqrt{-1}$ 是虚数单位。此计算需要复数运算。为了便于数值实现，可以将分数的实部和虚部分离：\n    $$ \\frac{\\omega_p^2}{\\omega^2 + i \\gamma \\omega} = \\frac{\\omega_p^2}{\\omega(\\omega + i \\gamma)} = \\frac{\\omega_p^2(\\omega - i \\gamma)}{\\omega(\\omega^2 + \\gamma^2)} = \\frac{\\omega_p^2 \\omega}{\\omega(\\omega^2 + \\gamma^2)} - i \\frac{\\omega_p^2 \\gamma}{\\omega(\\omega^2 + \\gamma^2)} = \\frac{\\omega_p^2}{\\omega^2 + \\gamma^2} - i \\frac{\\omega_p^2 \\gamma}{\\omega(\\omega^2 + \\gamma^2)} $$\n    因此，复相对介电常数 $\\epsilon_r(\\omega) = \\epsilon(\\omega)/\\epsilon_0$ 是：\n    $$ \\epsilon_r(\\omega) = \\left(1 - \\frac{\\omega_p^2}{\\omega^2 + \\gamma^2}\\right) + i \\left(\\frac{\\omega_p^2 \\gamma}{\\omega(\\omega^2 + \\gamma^2)}\\right) $$\n\n4.  **计算复本征阻抗**：\n    介质的本征阻抗 $\\eta(\\omega)$ 也是一个复数量，由以下公式确定：\n    $$ \\eta(\\omega) = \\sqrt{\\frac{\\mu_0}{\\epsilon(\\omega)}} $$\n    这涉及对一个复数开平方，将得到另一个复数 $\\eta(\\omega) = \\eta_r + i\\eta_i$。\n\n5.  **确定场相量**：\n    入射电场是一个单位振幅的实值正弦波，由相量 $E_0 = 1\\ \\mathrm{V/m}$ 导出。相应的磁场相量 $H_{phasor}$ 使用平面波关系求得：\n    $$ H_{phasor} = \\frac{E_0}{\\eta(\\omega)} = \\frac{1}{\\eta(\\omega)} $$\n    这将是一个复数，表示磁场相对于电场的振幅和相位。令其为 $H_{phasor} = H_r + i H_i$。\n\n6.  **生成离散时间场序列**：\n    FDTD 方法使用蛙跳格式，因此电场和磁场在交错的时间实例上采样。我们为每个场生成 $N$ 个样本，索引为 $n=0, 1, ..., N-1$。\n\n    a.  **电场序列**：电场在整数时间步 $t_n = n\\,\\Delta t$ 采样。\n        $$ E[n] = \\Re\\left\\{E_0\\,e^{i \\omega n \\Delta t}\\right\\} = \\Re\\left\\{1 \\cdot e^{i \\omega n \\Delta t}\\right\\} = \\cos(\\omega n \\Delta t) $$\n\n    b.  **磁场序列**：磁场在半整数时间步 $t_{n+\\frac{1}{2}} = \\left(n+\\frac{1}{2}\\right)\\Delta t$ 采样。\n        $$ H[n] = \\Re\\left\\{H_{phasor}\\,e^{i \\omega \\left(n+\\frac{1}{2}\\right) \\Delta t}\\right\\} $$\n        使用 $H_{phasor} = H_r + i H_i$ 和欧拉公式 $e^{i\\theta} = \\cos\\theta + i\\sin\\theta$ 展开，其中 $\\theta_n = \\omega \\left(n+\\frac{1}{2}\\right) \\Delta t$：\n        $$ H[n] = \\Re\\left\\{(H_r + i H_i)(\\cos\\theta_n + i\\sin\\theta_n)\\right\\} $$\n        $$ H[n] = \\Re\\left\\{(H_r \\cos\\theta_n - H_i \\sin\\theta_n) + i (H_r \\sin\\theta_n + H_i \\cos\\theta_n)\\right\\} $$\n        $$ H[n] = H_r \\cos\\left(\\omega \\left(n+\\frac{1}{2}\\right) \\Delta t\\right) - H_i \\sin\\left(\\omega \\left(n+\\frac{1}{2}\\right) \\Delta t\\right) $$\n\n7.  **数值计算与格式化**：\n    对每个测试用例执行以上步骤。将得到的 $E[n]$ 和 $H[n]$（对于 $n \\in [0, N-1]$）的值四舍五入到 $6$ 位小数。最终输出的结构是一个结果列表，其中每个结果是一对分别包含电场和磁场序列的列表。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the discrete-time incident E and H sequences for a TFSF boundary in a Drude medium.\n    \"\"\"\n    # Constants\n    mu_0 = 4 * np.pi * 1e-7  # Permeability of free space (H/m)\n    eps_0 = 8.854187817e-12  # Permittivity of free space (F/m)\n\n    # Test cases: (omega_p, gamma, dt, f_str, N)\n    # f_str is used because f in case 4 depends on dt\n    test_cases = [\n        (5.0e14, 1.0e12, 1.0e-16, \"2.0e14\", 8),  # Case 1\n        (4.0e14, 0.0, 1.0e-16, \"3.0e14\", 8),     # Case 2\n        (6.0e14, 5.0e14, 5.0e-16, \"1.0e14\", 8),  # Case 3\n        (3.0e14, 1.0e13, 1.0e-15, \"0.49/dt\", 8), # Case 4\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        wp, gamma, dt, f_str, N = case\n        \n        # Calculate frequency f\n        if f_str == \"0.49/dt\":\n            f = 0.49 / dt\n        else:\n            f = float(f_str)\n            \n        # 1. Angular frequency\n        omega = 2 * np.pi * f\n\n        # 2. Complex permittivity\n        # The denominator of the Drude term\n        # For gamma=0, omega must be non-zero, which is true for all test cases.\n        if omega == 0:\n            if wp == 0:\n                # DC in vacuum\n                epsilon_complex = eps_0\n            else:\n                # DC in plasma, polarizability is infinite, this is a physical singularity.\n                # However, the problem setup ensures omega > 0.\n                # Setting to a very large number to avoid division by zero.\n                epsilon_complex = np.inf\n        else:\n            denominator = omega**2 + 1j * gamma * omega\n            epsilon_complex = eps_0 * (1 - wp**2 / denominator)\n\n        # 3. Complex intrinsic impedance\n        # np.sqrt handles complex arguments correctly.\n        eta_complex = np.sqrt(mu_0 / epsilon_complex)\n\n        # 4. Magnetic field phasor for E0=1\n        H_phasor = 1.0 / eta_complex\n\n        # 5. Generate discrete-time sequences\n        n_vals = np.arange(N)\n\n        # Electric field sequence\n        # E[n] = Re{1 * exp(j*omega*n*dt)} = cos(omega*n*dt)\n        e_sequence_raw = np.cos(omega * n_vals * dt)\n        \n        # Magnetic field sequence\n        # H[n] = Re{H_phasor * exp(j*omega*(n+0.5)*dt)}\n        time_staggered = (n_vals + 0.5) * dt\n        h_sequence_raw = np.real(H_phasor * np.exp(1j * omega * time_staggered))\n\n        # 6. Round to 6 decimal places and convert to list\n        e_sequence = np.round(e_sequence_raw, 6).tolist()\n        h_sequence = np.round(h_sequence_raw, 6).tolist()\n        \n        all_results.append([e_sequence, h_sequence])\n\n    # Final print statement in the exact required format.\n    # The str() representation of a list of lists of lists matches the example format.\n    print(all_results)\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3318221"}, {"introduction": "FDTD方法在宽带分析中表现出强大的能力，这对于在一定频率范围内表征器件至关重要。为此，我们需要一个具有明确频谱内容的入射脉冲，例如平顶谱。本实践练习将引导您完成“波形工程”的全过程：从一个期望的频谱出发，您将运用傅里叶理论和窗函数等信号处理技术，构建并分析一个适用于高级宽带TFSF仿真的时域脉冲[@problem_id:3318239]。", "problem": "您正在为计算电磁学中的时域有限差分 (FDTD) 方法实现总场/散射场 (TFSF) 边界注入。为了将频谱受控的宽带平面波注入总场区，您需要一个时域入射电场波形，其连续角频率谱的幅值在指定频带内是平坦的，而在该频带外可以忽略不计。您的任务是严格地从第一性原理出发，推导、离散化、加窗并评估这样的波形，并用代码实现它。\n\n从与实值时域信号的厄米对称性一致的傅里叶变换对的定义开始。使用以下约定，其中角频率用 $\\omega$ 表示：\n$$\nF(\\omega) = \\int_{-\\infty}^{+\\infty} f(t)\\, e^{-\\mathrm{i}\\omega t}\\, dt, \\quad\nf(t) = \\frac{1}{2\\pi}\\int_{-\\infty}^{+\\infty} F(\\omega)\\, e^{+\\mathrm{i}\\omega t}\\, d\\omega.\n$$\n构造一个实值时域波形 $f(t)$，其连续谱幅值在频带 $[\\omega_1,\\omega_2]$ 内等于一个恒定的目标振幅，在该频带外可以忽略不计，并满足厄米对称性要求 $F(-\\omega)=F(\\omega)^\\ast$ 以确保 $f(t)$ 是实数。对波形施加物理缩放，使得入射电场满足 $f(0)=E_0$，其中 $E_0$ 的单位是伏特/米 (V/m)。为了使 $f(t)$ 适用于时间步进和TFSF注入，通过将 $f(t)$ 乘以一个定义在有限区间上的平滑偶函数窗 $w(t)$ 来强制其具有有限时长；加窗对频谱泄漏和带内波纹的影响必须包含在评估中。\n\n在均匀网格 $t_n=(n-n_0)\\,\\Delta t$（其中 $n=0,1,\\dots,N-1$）上离散化 $f(t)$，$\\Delta t$ 的单位是秒，且 $n_0=(N-1)/2$ 以使得 $t_{n_0}=0$。使用参数为 $\\alpha\\in[0,1]$ 的Tukey窗（其中 $\\alpha=0$ 为矩形窗，$\\alpha=1$ 为Hann窗）来定义 $w[n]=w(t_n)$。实现对 $f[n]=f(t_n)\\,w[n]$ 的数值稳健计算，包括由傅里叶变换构造所决定的在 $t=0$ 处的极限值。通过补零实数快速傅里叶变换 (FFT) 计算离散频谱，以 $F_{\\Delta t}(\\omega)\\approx \\Delta t\\sum_n f[n]e^{-\\mathrm{i}\\omega t_n}$ 来近似连续变换 $F(\\omega)$。\n\n为每种情况定义并计算以下量化指标：\n- 归一化带内平均幅值：\n$$\nm_1=\\frac{\\langle |F_{\\Delta t}(\\omega)|\\rangle_{\\omega\\in[\\omega_1,\\omega_2]}}{K},\n$$\n- 归一化带内均方根波纹：\n$$\nm_2=\\frac{\\sqrt{\\langle\\left(|F_{\\Delta t}(\\omega)|-\\langle |F_{\\Delta t}(\\omega)|\\rangle\\right)^2\\rangle_{\\omega\\in[\\omega_1,\\omega_2]}}}{K},\n$$\n- 归一化带外最大泄漏：\n$$\nm_3=\\frac{\\max_{\\omega\\notin[\\omega_1,\\omega_2]} |F_{\\Delta t}(\\omega)|}{K},\n$$\n其中 $K$ 是在所述变换约定下，由构造和归一化条件 $f(0)=E_0$ 所隐含的恒定目标谱幅值。所有的 $\\omega$ 单位为弧度/秒，$\\Delta t$ 单位为秒，$E_0$ 单位为伏特/米。角度必须以弧度为单位。指标 $m_1$、$m_2$ 和 $m_3$ 是无量纲的。仅使用正频率分支计算这些指标。\n\n实现该算法并为以下测试集计算指标。每个参数集以 $(\\omega_1,\\omega_2,E_0,\\Delta t,N,\\alpha)$ 的形式给出，单位和数值均已指定：\n- 情况 A (标准宽带): $\\omega_1=2\\pi\\cdot 1.0\\times 10^9\\ \\mathrm{rad/s}$, $\\omega_2=2\\pi\\cdot 3.0\\times 10^9\\ \\mathrm{rad/s}$, $E_0=1.0\\ \\mathrm{V/m}$, $\\Delta t=2.0\\times 10^{-11}\\ \\mathrm{s}$, $N=4096$, $\\alpha=0.5$。\n- 情况 B (窄带): $\\omega_1=2\\pi\\cdot 0.5\\times 10^9\\ \\mathrm{rad/s}$, $\\omega_2=2\\pi\\cdot 0.55\\times 10^9\\ \\mathrm{rad/s}$, $E_0=0.5\\ \\mathrm{V/m}$, $\\Delta t=5.0\\times 10^{-10}\\ \\mathrm{s}$, $N=8192$, $\\alpha=0.2$。\n- 情况 C (包含零点附近的低频): $\\omega_1=0\\ \\mathrm{rad/s}$, $\\omega_2=2\\pi\\cdot 0.5\\times 10^9\\ \\mathrm{rad/s}$, $E_0=1.0\\ \\mathrm{V/m}$, $\\Delta t=5.0\\times 10^{-10}\\ \\mathrm{s}$, $N=4096$, $\\alpha=1.0$。\n- 情况 D (接近奈奎斯特频率的高频带): $\\omega_1=2\\pi\\cdot 18.0\\times 10^9\\ \\mathrm{rad/s}$, $\\omega_2=2\\pi\\cdot 22.0\\times 10^9\\ \\mathrm{rad/s}$, $E_0=1.0\\ \\mathrm{V/m}$, $\\Delta t=2.0\\times 10^{-11}\\ \\mathrm{s}$, $N=4096$, $\\alpha=0.7$。\n\n您的程序必须为每种情况按上述顺序计算 $(m_1,m_2,m_3)$，并将所有四种情况的标量结果聚合到一个列表中。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，顺序如下\n$$\n[m_1^{(A)},m_2^{(A)},m_3^{(A)},m_1^{(B)},m_2^{(B)},m_3^{(B)},m_1^{(C)},m_2^{(C)},m_3^{(C)},m_1^{(D)},m_2^{(D)},m_3^{(D)}].\n$$\n所有计算量必须遵守上述指定的单位；输出值为无量纲的浮点数。", "solution": "该问题要求推导并实现一种时域波形，该波形适用于通过总场/散射场 (TFSF) 边界将宽带平面波注入到时域有限差分 (FDTD) 仿真中。该波形必须具有一个在指定频带内近似平坦的频谱，并根据 $t=0$ 时刻给定的峰值电场值进行归一化。\n\n推导从第一性原理出发，首先构造一个满足问题约束的理想频谱 $F(\\omega)$。然后，我们通过傅里叶逆变换获得相应的时域信号 $f(t)$。随后，对这个理想信号进行离散化、加窗以获得有限时长，并对其频谱特性进行数值分析。\n\n**1. 理想频谱的构造**\n\n目标是获得一个实值时域信号 $f(t)$，其频谱幅值 $|F(\\omega)|$ 在角频率 $\\omega$ 处于频带 $[\\omega_1, \\omega_2]$ 内时为常数。为了使 $f(t)$ 为实数，其傅里叶变换 $F(\\omega)$ 必须表现出厄米对称性，即 $F(-\\omega) = F(\\omega)^*$，其中星号表示复共轭。这意味着幅值是偶函数，即 $|F(-\\omega)|=|F(\\omega)|$，而相位是奇函数，即 $\\arg(F(-\\omega)) = -\\arg(F(\\omega))$。\n\n满足这些条件的最简单方法是定义一个实偶频谱。我们假设一个理想频谱 $F_{ideal}(\\omega)$，其在正频带 $[\\omega_1, \\omega_2]$ 和相应的负频带 $[-\\omega_2, -\\omega_1]$ 内具有一个我们称之为 $S_0$ 的恒定振幅：\n$$\nF_{ideal}(\\omega) =\n\\begin{cases}\nS_0  \\text{if } \\omega \\in [-\\omega_2, -\\omega_1] \\cup [\\omega_1, \\omega_2] \\\\\n0  \\text{otherwise}\n\\end{cases}\n$$\n此处，$S_0$ 是一个代表频谱振幅的实常数。这种构造确保了 $F_{ideal}(\\omega)$ 是实偶函数，从而轻易地满足了厄米对称性。\n\n**2. 时域波形的推导**\n\n时域波形 $f(t)$ 通过应用问题陈述中定义的傅里叶逆变换得到：\n$$\nf(t) = \\frac{1}{2\\pi}\\int_{-\\infty}^{+\\infty} F(\\omega)\\, e^{+\\mathrm{i}\\omega t}\\, d\\omega\n$$\n代入我们的 $F_{ideal}(\\omega)$：\n$$\nf(t) = \\frac{1}{2\\pi} \\int_{[-\\omega_2, -\\omega_1] \\cup [\\omega_1, \\omega_2]} S_0\\, e^{\\mathrm{i}\\omega t}\\, d\\omega = \\frac{S_0}{2\\pi} \\left( \\int_{-\\omega_2}^{-\\omega_1} e^{\\mathrm{i}\\omega t}\\, d\\omega + \\int_{\\omega_1}^{\\omega_2} e^{\\mathrm{i}\\omega t}\\, d\\omega \\right)\n$$\n对于 $t \\neq 0$ 的情况，指数函数的积分是 $\\frac{e^{\\mathrm{i}\\omega t}}{\\mathrm{i}t}$。计算定积分：\n$$\nf(t) = \\frac{S_0}{2\\pi\\mathrm{i}t} \\left( \\left[ e^{\\mathrm{i}\\omega t} \\right]_{-\\omega_2}^{-\\omega_1} + \\left[ e^{\\mathrm{i}\\omega t} \\right]_{\\omega_1}^{\\omega_2} \\right)\n= \\frac{S_0}{2\\pi\\mathrm{i}t} \\left( (e^{-\\mathrm{i}\\omega_1 t} - e^{-\\mathrm{i}\\omega_2 t}) + (e^{\\mathrm{i}\\omega_2 t} - e^{\\mathrm{i}\\omega_1 t}) \\right)\n$$\n重新整理各项并使用欧拉公式 $2\\mathrm{i}\\sin(x) = e^{\\mathrm{i}x} - e^{-\\mathrm{i}x}$：\n$$\nf(t) = \\frac{S_0}{2\\pi\\mathrm{i}t} \\left( (e^{\\mathrm{i}\\omega_2 t} - e^{-\\mathrm{i}\\omega_2 t}) - (e^{\\mathrm{i}\\omega_1 t} - e^{-\\mathrm{i}\\omega_1 t}) \\right) = \\frac{S_0}{2\\pi\\mathrm{i}t} \\left( 2\\mathrm{i}\\sin(\\omega_2 t) - 2\\mathrm{i}\\sin(\\omega_1 t) \\right)\n$$\n这可以简化为时域波形的解析表达式：\n$$\nf(t) = \\frac{S_0}{\\pi t} \\left( \\sin(\\omega_2 t) - \\sin(\\omega_1 t) \\right) \\quad \\text{for } t \\neq 0\n$$\n对于 $t=0$ 这个特定点，被积函数变为 $1$。积分给出频谱块的总面积：\n$$\nf(0) = \\frac{S_0}{2\\pi} \\left( (\\omega_2 - \\omega_1) + (\\omega_2 - \\omega_1) \\right) = \\frac{S_0(\\omega_2 - \\omega_1)}{\\pi}\n$$\n这个结果与 $f(t)$ 在 $t \\to 0$ 时的极限是一致的，这可以通过使用洛必达法则或识别sinc函数的形式来验证：$\\lim_{x\\to 0} \\frac{\\sin(ax)}{x} = a$。\n\n**3. 归一化和目标谱幅值 $K$**\n\n问题要求波形被归一化以满足 $f(0) = E_0$。使用我们对 $f(0)$ 的表达式：\n$$\nE_0 = \\frac{S_0(\\omega_2 - \\omega_1)}{\\pi}\n$$\n这使我们能够求解频谱振幅 $S_0$。问题将目标谱幅值定义为 $K$，因此我们有 $K = S_0$：\n$$\nK = \\frac{\\pi E_0}{\\omega_2 - \\omega_1}\n$$\n此关系在所有 $\\omega_2  \\omega_1$ 的情况下都成立，包括 $\\omega_1 = 0$ 的低通情况。将此结果代回到 $f(t)$ 的表达式中，我们得到最终归一化的连续波形：\n$$\nf(t) = \\frac{E_0}{\\omega_2 - \\omega_1} \\frac{\\sin(\\omega_2 t) - \\sin(\\omega_1 t)}{t}\n$$\n在 $t=0$ 处的值定义为 $f(0)=E_0$。\n\n**4. 离散化、加窗和频谱分析**\n\n连续信号 $f(t)$ 的时长是无限的，必须进行截断才能在时步仿真中使用。这是通过采样和加窗来完成的。信号在均匀时间网格 $t_n = (n-n_0)\\Delta t$（其中 $n=0, 1, \\dots, N-1$，$n_0 = (N-1)/2$）上进行离散化。这将 $t=0$ 点置于时间窗的中心。对于测试用例中使用的偶数 $N$ 值，$n_0$ 是一个半整数，这意味着没有采样点恰好落在 $t=0$ 上，这方便地避免了需要用特殊逻辑来处理 $f(t_n)$ 公式中的可去奇点。\n\n离散信号 $f[n] = f(t_n)$ 与长度为 $N$、参数为 $\\alpha$ 的Tukey窗 $w[n]$ 相乘。Tukey窗提供了一个平坦的中心区域和两端平滑的余弦锥形过渡，与突变的矩形窗相比，这有助于减少频谱泄漏。用于分析的最终有限时长信号是 $f_{win}[n] = f[n] \\cdot w[n]$。\n\n$f_{win}[n]$ 的频谱通过使用补零快速傅里叶变换 (FFT) 来计算，以近似连续频谱 $F_{\\Delta t}(\\omega) \\approx \\Delta t \\sum_n f_{win}[n] e^{-\\mathrm{i}\\omega t_n}$。具体来说，由于输入信号是实数，我们采用实数FFT (`rfft`) 以提高效率。近似频谱的幅值为 $|F_{\\Delta t}(\\omega_k)| = \\Delta t |F_{RFFT}[k]|$，其中 $F_{RFFT}[k]$ 是 `rfft` 算法的系数，$\\omega_k$ 是对应的离散角频率。使用一个显著的补零因子（例如 $16N$）来获得高分辨率的频谱，以便进行精确的指标计算。\n\n**5. 量化指标**\n\n这三个指标用于评估所生成频谱相对于理想频谱的质量。它们是根据离散谱幅值 $|F_{\\Delta t}(\\omega_k)|$（我们记为 $S_k$）计算的。平均算子 $\\langle\\cdot\\rangle_{\\omega\\in[\\omega_1,\\omega_2]}$ 被解释为对所有落在频带 $[\\omega_1, \\omega_2]$ 内的离散频率点 $\\omega_k$ 取算术平均值。\n\n-   $m_1$ (归一化带内平均幅值): 该指标衡量平均频谱振幅与目标值 $K$ 的匹配程度。\n    $$ m_1 = \\frac{\\mathrm{mean}(\\{S_k \\mid \\omega_1 \\le \\omega_k \\le \\omega_2\\})}{K} $$\n-   $m_2$ (归一化带内均方根波纹): 该指标量化了带内频谱的平坦度。它是带内频谱幅值的标准差，并用 $K$ 进行归一化。\n    $$ m_2 = \\frac{\\mathrm{std}(\\{S_k \\mid \\omega_1 \\le \\omega_k \\le \\omega_2\\})}{K} $$\n-   $m_3$ (归一化带外最大泄漏): 该指标衡量频谱的纯度，表示由于加窗和离散化而泄漏到目标频带外的能量峰值水平。\n    $$ m_3 = \\frac{\\max(\\{S_k \\mid \\omega_k  \\omega_1 \\text{ or } \\omega_k  \\omega_2\\})}{K} $$\n\n接下来的实现将对每个测试用例应用这一完整过程。", "answer": "```python\nimport numpy as np\nfrom scipy.signal.windows import tukey\n\ndef solve():\n    \"\"\"\n    Derives, implements, and assesses a broadband waveform for FDTD TFSF injection.\n    \"\"\"\n    # Each tuple contains: (w1, w2, E0, dt, N, alpha)\n    # w1, w2 in rad/s; E0 in V/m; dt in s; N is dimensionless; alpha is dimensionless.\n    test_cases = [\n        # Case A: Happy path broadband\n        (2 * np.pi * 1.0e9, 2 * np.pi * 3.0e9, 1.0, 2.0e-11, 4096, 0.5),\n        # Case B: Narrow band\n        (2 * np.pi * 0.5e9, 2 * np.pi * 0.55e9, 0.5, 5.0e-10, 8192, 0.2),\n        # Case C: Low pass (includes DC)\n        (0.0, 2 * np.pi * 0.5e9, 1.0, 5.0e-10, 4096, 1.0),\n        # Case D: High band near Nyquist\n        (2 * np.pi * 18.0e9, 2 * np.pi * 22.0e9, 1.0, 2.0e-11, 4096, 0.7),\n    ]\n\n    all_results = []\n    \n    for w1, w2, E0, dt, N, alpha in test_cases:\n        # Step 1: Calculate the target spectral magnitude K\n        # K = (pi * E0) / (w2 - w1)\n        # This formula is valid for w2 > w1.\n        if w2 > w1:\n            K = (np.pi * E0) / (w2 - w1)\n        else:\n            # For w1=w2, an ideal spectrum would be a Dirac delta,\n            # which is not the case here. The problem has w2>w1 for all cases.\n            all_results.extend([np.nan, np.nan, np.nan])\n            continue\n            \n        # Step 2: Create the ideal continuous-time signal f(t) and discretize it\n        n0 = (N - 1) / 2.0\n        n_indices = np.arange(N)\n        t = (n_indices - n0) * dt\n        \n        # Calculate f(t) = E0/(w2-w1) * (sin(w2*t) - sin(w1*t))/t\n        # For even N, t never equals 0, so no division by zero occurs.\n        # The formula is implemented directly.\n        f_t = (E0 / (w2 - w1)) * (np.sin(w2 * t) - np.sin(w1 * t)) / t\n\n        # Step 3: Apply the Tukey window\n        # The window is symmetric and centered by default.\n        window = tukey(N, alpha=alpha, sym=True)\n        f_win = f_t * window\n        \n        # Step 4: Compute the spectrum using a zero-padded real FFT\n        # A large padding factor provides a finely sampled spectrum for accurate metrics.\n        M_fft = 16 * N\n        \n        # Compute the one-sided real FFT\n        F_rfft = np.fft.rfft(f_win, n=M_fft)\n        \n        # Calculate the spectrum magnitude, scaled by dt to approximate the continuous Fourier Transform\n        S_k = dt * np.abs(F_rfft)\n\n        # Step 5: Get the corresponding frequency bins\n        # rfftfreq gives frequencies in cycles/unit-time, convert to rad/s\n        omega_k = 2 * np.pi * np.fft.rfftfreq(M_fft, d=dt)\n        \n        # Step 6: Calculate the metrics m1, m2, m3\n        # Create boolean masks for in-band and out-of-band frequencies\n        in_band_mask = (omega_k >= w1)  (omega_k = w2)\n        out_of_band_mask = (omega_k  w1) | (omega_k > w2)\n        \n        S_in = S_k[in_band_mask]\n        S_out = S_k[out_of_band_mask]\n        \n        # m1: Normalized in-band mean magnitude\n        if S_in.size > 0:\n            mean_S_in = np.mean(S_in)\n            m1 = mean_S_in / K\n        else:\n            m1 = 0.0 # No points in band\n\n        # m2: Normalized in-band RMS ripple (std dev)\n        if S_in.size > 1:\n            m2 = np.std(S_in) / K\n        else:\n            m2 = 0.0 # Not enough points to calculate standard deviation\n\n        # m3: Normalized maximum out-of-band leakage\n        if S_out.size > 0:\n            m3 = np.max(S_out) / K\n        else:\n            m3 = 0.0 # No points out of band\n\n        all_results.extend([m1, m2, m3])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{x:.6f}' for x in all_results)}]\")\n\nsolve()\n```", "id": "3318239"}]}