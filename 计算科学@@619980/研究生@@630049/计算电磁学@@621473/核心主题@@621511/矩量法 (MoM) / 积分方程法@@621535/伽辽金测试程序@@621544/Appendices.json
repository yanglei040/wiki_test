{"hands_on_practices": [{"introduction": "伽辽金方法的核心在于将连续的偏微分方程（PDE）转化为离散的代数方程组。本练习将引导你完成这一关键过程的第一步：从麦克斯韦方程的弱形式出发，推导并计算单个有限元矩阵的元素。通过使用计算电磁学中至关重要的 Nédélec 基函数，你将亲手实践理论，加深对伽辽金测试流程如何将物理定律转化为可计算形式的理解 [@problem_id:3309726]。", "problem": "考虑有界利普希茨域 $\\Omega \\subset \\mathbb{R}^{3}$ 中的时谐无源麦克斯韦旋度-旋度方程，\n$$\\nabla \\times \\left(\\mu^{-1} \\nabla \\times \\mathbf{E}\\right) - \\omega^{2} \\epsilon \\mathbf{E} = \\mathbf{0} \\quad \\text{in } \\Omega,$$\n其中 $\\mu$ 是磁导率，$\\epsilon$ 是介电常数，$\\omega$ 是角频率。设试探和检验空间为具有平方可积旋度的平方可积向量场的索博列夫空间，记为 $H(\\nabla \\times;\\Omega)$，并考虑使用基于四面体的 $H(\\nabla \\times)$-协调的第一类 Nédélec 棱元，通过有限元法 (FEM) 进行伽辽金离散化。\n\n1. 从第一性原理出发，通过使用检验函数 $\\boldsymbol{\\phi} \\in H(\\nabla \\times;\\Omega)$ 测试并对旋度算子进行适当的分部积分，得到弱（变分）形式，推导出与基函数 $\\boldsymbol{\\phi}_{m}$ 和 $\\boldsymbol{\\phi}_{n}$ 对应的伽辽金双线性形式矩阵元的精确表达式：\n$$a_{mn} = \\int_{\\Omega} \\mu^{-1} \\left(\\nabla \\times \\boldsymbol{\\phi}_{m}\\right)\\cdot\\left(\\nabla \\times \\boldsymbol{\\phi}_{n}\\right)\\, d\\Omega \\;-\\; \\omega^{2} \\int_{\\Omega} \\epsilon \\, \\boldsymbol{\\phi}_{m}\\cdot \\boldsymbol{\\phi}_{n}\\, d\\Omega.$$\n\n2. 在单个四面体单元 $T \\subset \\Omega$ 上显式计算该矩阵元，其顶点为 $\\mathbf{x}_{1}=(0,0,0)$、$\\mathbf{x}_{2}=(h,0,0)$、$\\mathbf{x}_{3}=(0,h,0)$ 和 $\\mathbf{x}_{4}=(0,0,h)$，并假设 $\\mu$ 和 $\\epsilon$ 在 $T$ 上为常数。使用与定向棱 $(\\mathbf{x}_{1},\\mathbf{x}_{2})$ 相关联的最低阶第一类 Nédélec 棱基函数，该函数通过 $T$ 上的重心坐标 $\\{\\lambda_{i}\\}_{i=1}^{4}$ 定义为\n$$\\boldsymbol{\\phi}_{12} = \\lambda_{1}\\nabla \\lambda_{2} - \\lambda_{2}\\nabla \\lambda_{1}.$$\n以闭式形式计算此单个单元 $T$ 的对角矩阵元 $a_{12,12}$。\n\n以 $h$、$\\mu$、$\\epsilon$ 和 $\\omega$ 的单个闭式解析表达式的形式给出你的最终答案。无需进行数值计算。最终答案中不要包含单位，但假设 $\\mu$ 和 $\\epsilon$ 是具有物理意义的常数。如果进行任何中间数值简化，请保留精确的有理因子。无需四舍五入。", "solution": "该问题要求完成两项任务。首先，推导时谐麦克斯韦旋度-旋度方程的伽辽金双线性形式。其次，在给定的四面体单元上，使用特定的基函数，计算所得有限元矩阵的特定对角元。\n\n### 第1部分：双线性形式的推导\n\n控制偏微分方程 (PDE) 是在域 $\\Omega$ 内的时谐无源麦克斯韦旋度-旋度方程：\n$$ \\nabla \\times \\left(\\mu^{-1} \\nabla \\times \\mathbf{E}\\right) - \\omega^{2} \\epsilon \\mathbf{E} = \\mathbf{0} $$\n这里，$\\mathbf{E}$ 是电场相量，$\\mu$ 是磁导率，$\\epsilon$ 是介电常数，$\\omega$ 是角频率。\n\n为了获得弱（或变分）形式，我们遵循标准的伽辽金程序。我们将偏微分方程乘以一个来自适当函数空间（给定为 $H(\\nabla \\times;\\Omega)$）的向量检验函数 $\\boldsymbol{\\phi}$，并在域 $\\Omega$ 上积分：\n$$ \\int_{\\Omega} \\boldsymbol{\\phi} \\cdot \\left[ \\nabla \\times \\left(\\mu^{-1} \\nabla \\times \\mathbf{E}\\right) - \\omega^{2} \\epsilon \\mathbf{E} \\right] d\\Omega = 0 $$\n这可以分为两项：\n$$ \\int_{\\Omega} \\boldsymbol{\\phi} \\cdot \\left( \\nabla \\times \\left(\\mu^{-1} \\nabla \\times \\mathbf{E}\\right) \\right) d\\Omega - \\omega^{2} \\int_{\\Omega} \\epsilon \\, \\boldsymbol{\\phi} \\cdot \\mathbf{E} \\, d\\Omega = 0 $$\n为了降低对试探函数 $\\mathbf{E}$ 的微分阶数，我们对第一项应用分部积分。相关的向量微积分恒等式是：\n$$ \\int_{\\Omega} \\mathbf{F} \\cdot (\\nabla \\times \\mathbf{G}) \\, d\\Omega = \\int_{\\Omega} (\\nabla \\times \\mathbf{F}) \\cdot \\mathbf{G} \\, d\\Omega - \\oint_{\\partial\\Omega} (\\mathbf{F} \\times \\mathbf{G}) \\cdot \\mathbf{\\hat{n}} \\, dS $$\n令 $\\mathbf{F} = \\boldsymbol{\\phi}$ 和 $\\mathbf{G} = \\mu^{-1} \\nabla \\times \\mathbf{E}$。应用此恒等式，第一项变为：\n$$ \\int_{\\Omega} \\left(\\nabla \\times \\boldsymbol{\\phi}\\right) \\cdot \\left(\\mu^{-1} \\nabla \\times \\mathbf{E}\\right) d\\Omega - \\oint_{\\partial\\Omega} \\left(\\boldsymbol{\\phi} \\times (\\mu^{-1} \\nabla \\times \\mathbf{E})\\right) \\cdot \\mathbf{\\hat{n}} \\, dS $$\n在适当的边界条件下，边界积分项 $\\oint_{\\partial\\Omega} \\left(\\boldsymbol{\\phi} \\times (\\mu^{-1} \\nabla \\times \\mathbf{E})\\right) \\cdot \\mathbf{\\hat{n}} \\, dS$ 会消失。例如，对于理想电导体 (PEC) 边界，$\\mathbf{\\hat{n}} \\times \\mathbf{E} = \\mathbf{0}$，我们在试探空间上强制施加此条件，这也意味着 $\\mathbf{\\hat{n}} \\times \\boldsymbol{\\phi} = \\mathbf{0}$，从而使被积函数为零。对于理想磁导体 (PMC) 边界，$\\mathbf{\\hat{n}} \\times \\mathbf{H} = \\mathbf{0}$，这在 $\\partial\\Omega$ 上可转化为 $\\mathbf{\\hat{n}} \\times (\\mu^{-1} \\nabla \\times \\mathbf{E}) = \\mathbf{0}$，这是一个自然边界条件，也使边界积分为零。由于问题陈述中的目标表达式没有边界项，我们假定存在这样的条件。\n\n消去边界项后，弱形式为：求 $\\mathbf{E} \\in H(\\nabla \\times;\\Omega)$（满足本质边界条件），使得对于所有检验函数 $\\boldsymbol{\\phi} \\in H(\\nabla \\times;\\Omega)$（满足齐次本质边界条件）成立：\n$$ \\int_{\\Omega} \\mu^{-1} \\left(\\nabla \\times \\boldsymbol{\\phi}\\right)\\cdot\\left(\\nabla \\times \\mathbf{E}\\right) d\\Omega \\,-\\, \\omega^{2} \\int_{\\Omega} \\epsilon \\, \\boldsymbol{\\phi}\\cdot\\mathbf{E} \\, d\\Omega = 0 $$\n在有限元法 (FEM) 中，我们在由基函数 $\\{\\boldsymbol{\\phi}_n\\}_{n=1}^N$ 张成的有限维子空间中寻求近似解 $\\mathbf{E}_h$。我们将 $\\mathbf{E}_h$ 表示为这些基函数的线性组合：\n$$ \\mathbf{E}_h = \\sum_{n=1}^{N} e_n \\boldsymbol{\\phi}_n $$\n其中 $e_n$ 是未知的复系数。伽辽金法对试探空间和检验空间使用同一组函数。我们将 $\\mathbf{E}$ 替换为 $\\mathbf{E}_h$，并依次选择每个基函数 $\\boldsymbol{\\phi}_m$ 作为检验函数 $\\boldsymbol{\\phi}$ ($m=1, \\dots, N$)：\n$$ \\int_{\\Omega} \\mu^{-1} \\left(\\nabla \\times \\boldsymbol{\\phi}_m\\right)\\cdot\\left(\\nabla \\times \\sum_{n=1}^{N} e_n \\boldsymbol{\\phi}_n\\right) d\\Omega \\,-\\, \\omega^{2} \\int_{\\Omega} \\epsilon \\, \\boldsymbol{\\phi}_m \\cdot \\left(\\sum_{n=1}^{N} e_n \\boldsymbol{\\phi}_n \\right) d\\Omega = 0 $$\n根据积分的线性性质，我们可以将其写成一个矩阵系统：\n$$ \\sum_{n=1}^{N} e_n \\left[ \\int_{\\Omega} \\mu^{-1} \\left(\\nabla \\times \\boldsymbol{\\phi}_m\\right)\\cdot\\left(\\nabla \\times \\boldsymbol{\\phi}_n\\right) d\\Omega \\,-\\, \\omega^{2} \\int_{\\Omega} \\epsilon \\, \\boldsymbol{\\phi}_m \\cdot \\boldsymbol{\\phi}_n \\, d\\Omega \\right] = 0 $$\n这是一个线性方程组 $\\mathbf{A}\\mathbf{e} = \\mathbf{0}$。系统矩阵 $\\mathbf{A}$ 的矩阵元 $a_{mn}$ 是方括号内的表达式：\n$$ a_{mn} = \\int_{\\Omega} \\mu^{-1} \\left(\\nabla \\times \\boldsymbol{\\phi}_{m}\\right)\\cdot\\left(\\nabla \\times \\boldsymbol{\\phi}_{n}\\right) d\\Omega \\;-\\; \\omega^{2} \\int_{\\Omega} \\epsilon \\, \\boldsymbol{\\phi}_{m}\\cdot \\boldsymbol{\\phi}_{n}\\, d\\Omega $$\n推导到此结束。\n\n### 第2部分：$a_{12,12}$ 的显式计算\n\n我们需要计算基函数 $\\boldsymbol{\\phi}_{12}$ 在单个四面体单元 $T$ 上的对角元 $a_{12,12}$。由于 $\\mu$ 和 $\\epsilon$ 在 $T$ 上是常数，我们有：\n$$ a_{12,12} = \\mu^{-1} \\int_{T} |\\nabla \\times \\boldsymbol{\\phi}_{12}|^2 dV - \\omega^{2} \\epsilon \\int_{T} |\\boldsymbol{\\phi}_{12}|^2 dV $$\n四面体 $T$ 的顶点是 $\\mathbf{x}_{1}=(0,0,0)$、$\\mathbf{x}_{2}=(h,0,0)$、$\\mathbf{x}_{3}=(0,h,0)$ 和 $\\mathbf{x}_{4}=(0,0,h)$。该四面体的体积为 $|T| = \\frac{1}{6}h^3$。\n\n基函数为 $\\boldsymbol{\\phi}_{12} = \\lambda_{1}\\nabla \\lambda_{2} - \\lambda_{2}\\nabla \\lambda_{1}$，其中 $\\lambda_i$ 是重心坐标。对于点 $\\mathbf{x}=(x,y,z) \\in T$，其重心坐标为：\n$\\lambda_1 = 1 - \\frac{x+y+z}{h}$, $\\lambda_2 = \\frac{x}{h}$, $\\lambda_3 = \\frac{y}{h}$, $\\lambda_4 = \\frac{z}{h}$。\n它们的梯度是常向量：\n$\\nabla \\lambda_1 = \\left(-\\frac{1}{h}, -\\frac{1}{h}, -\\frac{1}{h}\\right)$, $\\nabla \\lambda_2 = \\left(\\frac{1}{h}, 0, 0\\right)$。\n\n首先，我们计算 $\\boldsymbol{\\phi}_{12}$ 的旋度。使用恒等式 $\\nabla \\times (f\\mathbf{A}) = f(\\nabla \\times \\mathbf{A}) + \\nabla f \\times \\mathbf{A}$ 并注意到对于任何标量场 $\\lambda$，$\\nabla \\times (\\nabla \\lambda) = \\mathbf{0}$：\n$$ \\nabla \\times \\boldsymbol{\\phi}_{12} = \\nabla \\times (\\lambda_1 \\nabla \\lambda_2) - \\nabla \\times (\\lambda_2 \\nabla \\lambda_1) = (\\nabla \\lambda_1 \\times \\nabla \\lambda_2) - (\\nabla \\lambda_2 \\times \\nabla \\lambda_1) = 2(\\nabla \\lambda_1 \\times \\nabla \\lambda_2) $$\n在单元 $T$ 上，旋度是一个常向量：\n$$ \\nabla \\lambda_1 \\times \\nabla \\lambda_2 = \\frac{1}{h^2} \\det \\begin{pmatrix} \\mathbf{\\hat{i}} & \\mathbf{\\hat{j}} & \\mathbf{\\hat{k}} \\\\ -1 & -1 & -1 \\\\ 1 & 0 & 0 \\end{pmatrix} = \\frac{1}{h^2} \\left(0, -1, 1\\right) $$\n$$ \\nabla \\times \\boldsymbol{\\phi}_{12} = \\frac{2}{h^2} \\left(0, -1, 1\\right) $$\n旋度的模的平方是：\n$$ |\\nabla \\times \\boldsymbol{\\phi}_{12}|^2 = \\left(\\frac{2}{h^2}\\right)^2 (0^2 + (-1)^2 + 1^2) = \\frac{4}{h^4} \\cdot 2 = \\frac{8}{h^4} $$\n第一个积分（刚度矩阵贡献）是：\n$$ \\int_{T} |\\nabla \\times \\boldsymbol{\\phi}_{12}|^2 dV = \\frac{8}{h^4} \\int_{T} dV = \\frac{8}{h^4} |T| = \\frac{8}{h^4} \\left(\\frac{h^3}{6}\\right) = \\frac{4}{3h} $$\n接下来，我们计算第二个积分（质量矩阵贡献）。我们计算 $|\\boldsymbol{\\phi}_{12}|^2$：\n$$ |\\boldsymbol{\\phi}_{12}|^2 = |\\lambda_1 \\nabla \\lambda_2 - \\lambda_2 \\nabla \\lambda_1|^2 = \\lambda_1^2 |\\nabla \\lambda_2|^2 - 2\\lambda_1\\lambda_2(\\nabla\\lambda_1 \\cdot \\nabla\\lambda_2) + \\lambda_2^2|\\nabla\\lambda_1|^2 $$\n我们计算梯度的点积和叉积：\n$|\\nabla \\lambda_1|^2 = \\frac{1}{h^2}((-1)^2 + (-1)^2 + (-1)^2) = \\frac{3}{h^2}$\n$|\\nabla \\lambda_2|^2 = \\frac{1}{h^2}(1^2 + 0^2 + 0^2) = \\frac{1}{h^2}$\n$\\nabla \\lambda_1 \\cdot \\nabla \\lambda_2 = \\frac{1}{h^2}((-1)(1) + (-1)(0) + (-1)(0)) = -\\frac{1}{h^2}$\n将这些代入 $|\\boldsymbol{\\phi}_{12}|^2$ 的表达式中：\n$$ |\\boldsymbol{\\phi}_{12}|^2 = \\lambda_1^2 \\left(\\frac{1}{h^2}\\right) - 2\\lambda_1\\lambda_2\\left(-\\frac{1}{h^2}\\right) + \\lambda_2^2\\left(\\frac{3}{h^2}\\right) = \\frac{1}{h^2} \\left(\\lambda_1^2 + 2\\lambda_1\\lambda_2 + 3\\lambda_2^2\\right) $$\n为了在 $T$ 上对此进行积分，我们使用在 $d$ 维单纯形上积分重心坐标幂的标准公式：$\\int_T \\prod_{i=0}^d \\lambda_i^{p_i} dV = \\frac{d! \\prod p_i!}{(\\sum p_i + d)!}|T|$。对于我们的三维四面体（$d=3$）：\n$$ \\int_T \\lambda_1^{p_1} \\lambda_2^{p_2} \\lambda_3^{p_3} \\lambda_4^{p_4} dV = \\frac{3! p_1! p_2! p_3! p_4!}{(p_1+p_2+p_3+p_4+3)!} |T| $$\n我们需要计算 $\\int_T \\lambda_1^2 dV$、$\\int_T \\lambda_1\\lambda_2 dV$ 和 $\\int_T \\lambda_2^2 dV$：\n$$ \\int_T \\lambda_1^2 dV = \\frac{3! \\cdot 2!}{5!} |T| = \\frac{6 \\cdot 2}{120} |T| = \\frac{1}{10}|T| $$\n$$ \\int_T \\lambda_1\\lambda_2 dV = \\frac{3! \\cdot 1! \\cdot 1!}{5!} |T| = \\frac{6}{120} |T| = \\frac{1}{20}|T| $$\n$$ \\int_T \\lambda_2^2 dV = \\frac{3! \\cdot 2!}{5!} |T| = \\frac{1}{10}|T| $$\n所以，第二个积分是：\n$$ \\int_{T} |\\boldsymbol{\\phi}_{12}|^2 dV = \\frac{1}{h^2} \\int_T (\\lambda_1^2 + 2\\lambda_1\\lambda_2 + 3\\lambda_2^2) dV $$\n$$ = \\frac{|T|}{h^2} \\left( \\frac{1}{10} + 2\\left(\\frac{1}{20}\\right) + 3\\left(\\frac{1}{10}\\right) \\right) = \\frac{|T|}{h^2} \\left(\\frac{1}{10} + \\frac{1}{10} + \\frac{3}{10}\\right) = \\frac{|T|}{h^2} \\left(\\frac{5}{10}\\right) = \\frac{|T|}{2h^2} $$\n代入 $|T| = h^3/6$：\n$$ \\int_{T} |\\boldsymbol{\\phi}_{12}|^2 dV = \\frac{h^3/6}{2h^2} = \\frac{h}{12} $$\n最后，我们合并这些项来求 $a_{12,12}$：\n$$ a_{12,12} = \\mu^{-1} \\left(\\frac{4}{3h}\\right) - \\omega^{2} \\epsilon \\left(\\frac{h}{12}\\right) = \\frac{4}{3\\mu h} - \\frac{\\omega^2 \\epsilon h}{12} $$", "answer": "$$\\boxed{\\frac{4}{3\\mu h} - \\frac{\\omega^{2} \\epsilon h}{12}}$$", "id": "3309726"}, {"introduction": "在推导出伽辽金矩阵的积分表达式后，下一步自然是思考如何用数值方法计算这些积分。本练习探讨了一个在计算科学中普遍存在却又很微妙的问题：“变分犯罪”，即不精确的数值积分如何破坏弱形式的内在对称性。通过编写代码，你将研究不精确积分如何导致一个本应能量耗散的物理系统，在数值上出现非物理的能量增长，从而揭示了数值积分方案的选择对仿真稳定性和准确性的深远影响 [@problem_id:3309793]。", "problem": "考虑单位正方形域 $[0,1]\\times[0,1]$ 上的二维横电 (TE) 形式的麦克斯韦方程组，其中单连通域内具有均匀、无量纲的电导率 $\\sigma>0$，且边界为完全绝缘，因此能量平衡中的边值积分为零。电场有一个非零标量分量 $E_z(x,y,t)$，而磁场是平面内矢量 $H(x,y,t)=\\left(H_x(x,y,t),H_y(x,y,t)\\right)$。无量纲的强形式 TE 系统为\n$$\n\\partial_t H_x = -\\partial_y E_z,\\quad\n\\partial_t H_y = \\phantom{-}\\partial_x E_z,\\quad\n\\partial_t E_z = -\\partial_x H_y + \\partial_y H_x - \\sigma E_z.\n$$\n根据麦克斯韦方程组和标准操作（分部积分和使用消除边界项的边界条件），连续能量泛函\n$$\n\\mathcal{E}(t)=\\tfrac{1}{2}\\int_{[0,1]^2}\\left(\\lvert H\\rvert^2+\\lvert E_z\\rvert^2\\right)\\,dx\\,dy\n$$\n满足能量恒等式\n$$\n\\frac{d}{dt}\\mathcal{E}(t)=-\\sigma\\int_{[0,1]^2}\\lvert E_z\\rvert^2\\,dx\\,dy\\le 0,\n$$\n因此对于 $\\sigma>0$，能量是不增的。\n\n在伽辽金测试过程中，设标量场 $E_z$ 近似为 $E_z(x,y,t)\\approx\\sum_{i=1}^{N_e}e_i(t)\\,\\phi_i(x,y)$，矢量场 $H$ 近似为 $H(x,y,t)\\approx\\sum_{j=1}^{N_h}h_j(t)\\,\\psi_j(x,y)$，其中 $\\{\\phi_i\\}_{i=1}^{N_e}$ 是标量基函数，$\\{\\psi_j\\}_{j=1}^{N_h}$ 是矢量基函数。定义电场和磁场的对称正定质量矩阵\n$$\nM_e[i,k]=\\int_{[0,1]^2}\\phi_i\\,\\phi_k\\,dx\\,dy,\\qquad\nM_h[j,\\ell]=\\int_{[0,1]^2}\\psi_j\\cdot\\psi_\\ell\\,dx\\,dy.\n$$\n定义由旋度相互作用产生的耦合矩阵\n$$\nA[i,j]=\\int_{[0,1]^2}\\phi_i\\left(\\partial_x \\psi_j^{(y)}-\\partial_y \\psi_j^{(x)}\\right)\\,dx\\,dy,\\qquad\nB[j,i]=\\int_{[0,1]^2}\\psi_j\\cdot\\left(-\\partial_y\\phi_i,\\ \\partial_x\\phi_i\\right)\\,dx\\,dy,\n$$\n其中 $\\psi_j^{(x)}$ 和 $\\psi_j^{(y)}$ 表示 $\\psi_j$ 的分量。对于足够光滑的 $\\phi_i$ 和 $\\psi_j$ 以及精确计算的积分，分部积分意味着 $B=-A^\\top$，这会产生一个与连续情况相似的离散能量恒等式。然而，如果旋度-旋度内积被欠积分（一种变分犯罪），离散分部积分的一致性可能被破坏，使得 $B\\ne -A^\\top$，这可能导致即使在 $\\sigma>0$ 时也出现非物理的能量增长。\n\n在此问题中，固定 $N_e=2$ 和 $N_h=2$，并使用以下在边界上为零以消除边界项的多项式基函数：\n- 对于电场，\n$$\n\\phi_1(x,y)=x(1-x)\\,y(1-y),\\qquad\n\\phi_2(x,y)=\\bigl(x(1-x)\\bigr)^2\\,y(1-y).\n$$\n- 对于磁场，\n$$\n\\psi_1(x,y)=\\bigl(\\phi_1(x,y),\\ 0\\bigr),\\qquad\n\\psi_2(x,y)=\\bigl(0,\\ \\phi_2(x,y)\\bigr).\n$$\n通过这些选择，矩阵 $M_e$、$M_h$、$A$ 和 $B$ 均为 $2\\times 2$。设 $A$ 用求积法则 $Q_A$ 集成，$B$ 用（可能不同的）求积法则 $Q_B$ 集成。电场和磁场质量矩阵 $M_e$ 和 $M_h$ 必须用高精度求积法则集成。考虑两种求积法则：\n- 每个维度上 5 阶的高精度高斯-勒让德张量积法则（记为 $Q_\\mathrm{G5}$）。\n- 在域中心 $(x,y)=\\left(\\tfrac{1}{2},\\tfrac{1}{2}\\right)$ 使用单点的严重欠积分的中点法则（记为 $Q_\\mathrm{MP}$）。\n\n定义离散能量\n$$\n\\mathcal{E}_h(e,h)=\\tfrac{1}{2}\\left(e^\\top M_e\\,e+h^\\top M_h\\,h\\right),\n$$\n其中 $e\\in\\mathbb{R}^{2}$ 和 $h\\in\\mathbb{R}^{2}$ 是系数向量。半离散伽辽金系统在状态 $(e,h)$ 下的瞬时离散能量变化率由下式给出\n$$\n\\frac{d}{dt}\\mathcal{E}_h(e,h)=-\\sigma\\,e^\\top M_e\\,e+e^\\top A\\,h+h^\\top B\\,e.\n$$\n对于固定的 $M_e$、$M_h$、$A$ 和 $B$，通过在约束条件 $e^\\top M_e\\,e=1$ 和 $h^\\top M_h\\,h=1$ 下对 $e$ 和 $h$ 进行优化，定义单位能量状态下的最坏情况瞬时能量增长。证明这个最坏情况变化率等于\n$$\n\\max_{\\substack{e^\\top M_e e=1\\\\ h^\\top M_h h=1}}\\left[-\\sigma\\,e^\\top M_e e+e^\\top(A+B^\\top)h\\right]=-\\sigma+\\left\\|M_e^{-1/2}(A+B^\\top)M_h^{-1/2}\\right\\|_2,\n$$\n其中 $\\|\\cdot\\|_2$ 表示谱范数，$M_e^{-1/2}$、$M_h^{-1/2}$ 是对称逆平方根。因此，当且仅当以下条件成立时，表示存在非物理的能量增长：\n$$\n\\left\\|M_e^{-1/2}(A+B^\\top)M_h^{-1/2}\\right\\|_2>\\sigma.\n$$\n\n你的任务是编写一个完整、可运行的程序，该程序：\n- 用 $Q_\\mathrm{G5}$ 集成 $M_e$ 和 $M_h$。\n- 用选定的法则 $Q_A\\in\\{Q_\\mathrm{G5},Q_\\mathrm{MP}\\}$ 集成 $A$，用 $Q_B\\in\\{Q_\\mathrm{G5},Q_\\mathrm{MP}\\}$ 集成 $B$。\n- 计算谱范数 $\\left\\|M_e^{-1/2}(A+B^\\top)M_h^{-1/2}\\right\\|_2$ 并将其与给定的 $\\sigma$ 进行比较。\n- 输出一个布尔值，指示不等式 $\\left\\|M_e^{-1/2}(A+B^\\top)M_h^{-1/2}\\right\\|_2>\\sigma$ 是否成立，这标志着由于求积引起的变分犯罪，在有损介质中出现了非物理的瞬时能量增长。\n\n所有量都是无量纲的。不使用角度。最终输出是布尔值。\n\n使用以下参数值测试套件来检验不同情况：\n- 情况 1（理想情况，能量精确衰减）：$Q_A=Q_\\mathrm{G5}$，$Q_B=Q_\\mathrm{G5}$，$\\sigma=0.1$。\n- 情况 2（变分犯罪，仅对 A 中的旋度-旋度项进行欠积分）：$Q_A=Q_\\mathrm{MP}$，$Q_B=Q_\\mathrm{G5}$，$\\sigma=0.001$。\n- 情况 3（强损耗缓解的变分犯罪）：$Q_A=Q_\\mathrm{MP}$，$Q_B=Q_\\mathrm{G5}$，$\\sigma=10.0$。\n- 情况 4（两个耦合项上对称的欠积分）：$Q_A=Q_\\mathrm{MP}$，$Q_B=Q_\\mathrm{MP}$，$\\sigma=0.001$。\n\n你的程序应该生成一行输出，其中包含四个案例的结果，形式为逗号分隔的列表，并用方括号括起来，例如 $\\left[\\text{结果}_1,\\text{结果}_2,\\text{结果}_3,\\text{结果}_4\\right]$。结果必须是四个布尔值，顺序与上面列出的案例顺序相同。", "solution": "问题陈述已经过严格验证，并被确定为有效。它在科学上基于计算电磁学的原理，特别是应用于麦克斯韦方程组的伽辽金有限元方法。这是一个适定问题，所有必要的数据、函数和条件都已明确定义。它提出了一个可在计算上验证的任务，没有内部矛盾、歧义或依赖于伪科学。\n\n任务是确定二维横电 (TE) 麦克斯韦方程组的半离散近似是否会因为“变分犯罪”——即在弱形式中对不同项使用不一致的数值求积——而表现出非物理的能量增长。这种增长的判据由不等式 $\\left\\|M_e^{-1/2}(A+B^\\top)M_h^{-1/2}\\right\\|_2 > \\sigma$ 给出，其中 $\\sigma$ 是物理电导率。正的结果表明数值误差可以超过物理耗散，从而导致不稳定的模拟。\n\n解决方案通过执行必要的计算步骤来评估四个给定测试案例中该不等式的左侧。\n\n**1. 基函数及其导数**\n问题指定了单位正方形 $[0,1] \\times [0,1]$ 上的多项式基函数。\n对于标量电场 $E_z$，其中 $N_e=2$：\n$$\n\\phi_1(x,y) = x(1-x)y(1-y) = (x-x^2)(y-y^2) \\\\\n\\phi_2(x,y) = (x(1-x))^2 y(1-y) = (x^2-2x^3+x^4)(y-y^2)\n$$\n对于矢量磁场 $H$，其中 $N_h=2$：\n$$\n\\psi_1(x,y) = (\\phi_1(x,y), 0) \\\\\n\\psi_2(x,y) = (0, \\phi_2(x,y))\n$$\n构建耦合矩阵 $A$ 和 $B$ 需要这些基函数的偏导数：\n$$\n\\partial_x \\phi_1(x,y) = (1-2x)y(1-y) \\\\\n\\partial_y \\phi_1(x,y) = x(1-x)(1-2y) \\\\\n\\partial_x \\phi_2(x,y) = (2(x-x^2)(1-2x))y(1-y) = (2x-6x^2+4x^3)(y-y^2) \\\\\n\\partial_y \\phi_2(x,y) = (x(1-x))^2(1-2y)\n$$\n\n**2. 数值求积**\n矩阵元素由单位正方形上的积分定义。这些积分使用两种指定的求积法则进行近似：\n- $Q_\\mathrm{G5}$：在每个维度上使用 5 点高斯-勒让德求积的张量积法则。该法则具有高阶精度，足以精确地积分此问题中的所有多项式被积函数。二维积分计算为 $\\int_0^1 \\int_0^1 f(x,y) \\,dx\\,dy \\approx \\sum_{k=1}^5 \\sum_{l=1}^5 w'_k w'_l f(x'_k, x'_l)$，其中 $(x'_k, w'_k)$ 是从标准区间 $[-1,1]$ 映射到 $[0,1]$ 的求积点和权重。\n- $Q_\\mathrm{MP}$：单点中点法则。该法则将积分近似为 $\\int_0^1 \\int_0^1 f(x,y) \\,dx\\,dy \\approx f(0.5, 0.5)$，即在域中心使用权重为 1 的单点求值。这是一个非常低阶的法则，会显著地欠积分多项式被积函数。\n\n**3. 矩阵集成**\n矩阵 $M_e, M_h, A, B$ 均为 $2 \\times 2$。它们的元素通过对其积分定义应用指定的求积法则来计算。\n\n- **质量矩阵 ($M_e$, $M_h$)：** 两者都使用高精度法则 $Q_\\mathrm{G5}$ 进行集成。\n  $$\n  M_e[i,k] = \\int_0^1\\int_0^1 \\phi_i \\phi_k \\,dx\\,dy, \\quad i,k \\in \\{1,2\\} \\\\\n  M_h[j,\\ell] = \\int_0^1\\int_0^1 \\psi_j \\cdot \\psi_\\ell \\,dx\\,dy, \\quad j,\\ell \\in \\{1,2\\}\n  $$\n  根据 $\\psi_j$ 的定义，$M_h$ 是一个对角矩阵，其元素为 $M_h[1,1]=\\int \\phi_1^2$，$M_h[2,2]=\\int \\phi_2^2$，以及 $M_h[1,2]=M_h[2,1]=0$。\n\n- **耦合矩阵 ($A$, $B$)：** 根据测试案例的指定，使用 $Q_\\mathrm{G5}$ 或 $Q_\\mathrm{MP}$ 进行集成。\n  $A$ 的定义是 $A[i,j] = \\int_0^1\\int_0^1 \\phi_i (\\partial_x \\psi_j^{(y)} - \\partial_y \\psi_j^{(x)}) \\,dx\\,dy$。\n  各元素的被积函数为：\n  $$\n  A[1,1]: -\\phi_1 \\partial_y \\phi_1 \\quad A[1,2]: \\phi_1 \\partial_x \\phi_2 \\\\\n  A[2,1]: -\\phi_2 \\partial_y \\phi_1 \\quad A[2,2]: \\phi_2 \\partial_x \\phi_2\n  $$\n  $B$ 的定义是 $B[j,i] = \\int_0^1\\int_0^1 \\psi_j \\cdot (-\\partial_y\\phi_i, \\partial_x\\phi_i) \\,dx\\,dy$。\n  各元素的被积函数为：\n  $$\n  B[1,1]: -\\phi_1 \\partial_y \\phi_1 \\quad B[1,2]: -\\phi_1 \\partial_y \\phi_2 \\\\\n  B[2,1]: \\phi_2 \\partial_x \\phi_1 \\quad B[2,2]: \\phi_2 \\partial_x \\phi_2\n  $$\n  当对 $A$ 和 $B$ 都使用 $Q_\\mathrm{G5}$ 时，由于基函数在边界上为零，精确的分部积分性质 $B=-A^\\top$ 成立。这导致 $A+B^\\top=0$。当使用 $Q_\\mathrm{MP}$ 时，我们注意到 $\\phi_1$ 和 $\\phi_2$ 的所有一阶偏导数在中点 $(0.5, 0.5)$ 处均为零。因此，任何用 $Q_\\mathrm{MP}$ 集成的矩阵（$A$ 或 $B$）都将是零矩阵。\n\n**4. 能量增长判据的计算**\n对于每个测试案例，执行以下步骤：\n1.  使用 $Q_\\mathrm{G5}$ 集成 $M_e$ 和 $M_h$。\n2.  根据该案例的规则 $Q_A$ 集成 $A$，规则 $Q_B$ 集成 $B$。\n3.  计算矩阵 $C = A+B^\\top$。\n4.  计算质量矩阵的对称逆平方根 $M_e^{-1/2}$ 和 $M_h^{-1/2}$。这可以通过先使用 `scipy.linalg.sqrtm` 找到主平方根 $M^{1/2}$，然后对结果求逆来实现。\n5.  构建矩阵 $K = M_e^{-1/2} C M_h^{-1/2}$。\n6.  计算谱范数 $\\|K\\|_2$，即 $K$ 的最大奇异值。\n7.  将计算出的范数与给定的电导率 $\\sigma$ 进行比较，以评估布尔条件 $\\|K\\|_2 > \\sigma$。\n\n对所有四个案例重复此过程，以生成最终的布尔结果列表。\n- **情况 1 ($Q_A=Q_\\mathrm{G5}, Q_B=Q_\\mathrm{G5}$):** $A+B^\\top = 0$，因此范数为 $0$。不等式 $0 > \\sigma$ 为假。\n- **情况 2 ($Q_A=Q_\\mathrm{MP}, Q_B=Q_\\mathrm{G5}$):** $A=0$，所以 $C=B^\\top$。$B$ 非零，导致范数为正。对于较小的 $\\sigma=0.001$，不等式预计为真。\n- **情况 3 ($Q_A=Q_\\mathrm{MP}, Q_B=Q_\\mathrm{G5}$):** 与情况 2 相同，但 $\\sigma=10.0$ 较大。范数可能小于 $\\sigma$，因此不等式预计为假。\n- **情况 4 ($Q_A=Q_\\mathrm{MP}, Q_B=Q_\\mathrm{MP}$):** $A=0$ 且 $B=0$，所以 $C=0$。范数为 $0$。不等式 $0 > \\sigma$ 为假。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import sqrtm\n\ndef solve():\n    \"\"\"\n    Solves the problem of detecting non-physical energy growth in a\n    Galerkin discretization of Maxwell's equations due to quadrature-induced\n    variational crimes.\n    \"\"\"\n\n    # Define basis functions and their partial derivatives\n    def phi1(x, y):\n        return (x - x**2) * (y - y**2)\n\n    def dphi1_dx(x, y):\n        return (1 - 2*x) * (y - y**2)\n\n    def dphi1_dy(x, y):\n        return (x - x**2) * (1 - 2*y)\n\n    def phi2(x, y):\n        return (x - x**2)**2 * (y - y**2)\n\n    def dphi2_dx(x, y):\n        return (2 * (x - x**2) * (1 - 2*x)) * (y - y**2)\n\n    def dphi2_dy(x, y):\n        return (x - x**2)**2 * (1 - 2*y)\n    \n    # Store functions in lists for easier iteration\n    # Indices 0 and 1 correspond to basis functions 1 and 2\n    phis = [phi1, phi2]\n    dphis_dx = [dphi1_dx, dphi2_dx]\n    dphis_dy = [dphi1_dy, dphi2_dy]\n    \n    # Define numerical quadrature function\n    # Cache Gauss-Legendre points and weights for efficiency\n    g5_points, g5_weights = np.polynomial.legendre.leggauss(5)\n    g5_points_01 = 0.5 * (g5_points + 1.0)\n    g5_weights_01 = 0.5 * g5_weights\n\n    def integrate(integrand_func, rule='G5'):\n        if rule == 'MP':\n            return integrand_func(0.5, 0.5)\n        elif rule == 'G5':\n            integral_val = 0.0\n            for i in range(5):\n                for j in range(5):\n                    integral_val += g5_weights_01[i] * g5_weights_01[j] * integrand_func(g5_points_01[i], g5_points_01[j])\n            return integral_val\n        else:\n            raise ValueError(f\"Unknown quadrature rule: {rule}\")\n\n    # --- Matrix Assembly Functions ---\n    def assemble_Me(quad_rule):\n        Me = np.zeros((2, 2))\n        for i in range(2):\n            for k in range(2):\n                integrand = lambda x, y: phis[i](x, y) * phis[k](x, y)\n                Me[i, k] = integrate(integrand, quad_rule)\n        return Me\n\n    def assemble_Mh(quad_rule):\n        Mh = np.zeros((2, 2))\n        # M_h[0,0] = integral(phi1^2)\n        Mh[0, 0] = integrate(lambda x, y: phis[0](x, y)**2, quad_rule)\n        # M_h[1,1] = integral(phi2^2)\n        Mh[1, 1] = integrate(lambda x, y: phis[1](x, y)**2, quad_rule)\n        # Off-diagonal terms are zero\n        return Mh\n\n    def assemble_A(quad_rule):\n        A = np.zeros((2, 2))\n        for i in range(2): # Row index for phi_i\n            # j=0 (column 1) corresponds to psi_1 = (phi1, 0)\n            integrand_A_i0 = lambda x, y, i=i: -phis[i](x,y) * dphis_dy[0](x,y)\n            A[i, 0] = integrate(integrand_A_i0, quad_rule)\n            \n            # j=1 (column 2) corresponds to psi_2 = (0, phi2)\n            integrand_A_i1 = lambda x, y, i=i: phis[i](x,y) * dphis_dx[1](x,y)\n            A[i, 1] = integrate(integrand_A_i1, quad_rule)\n        return A\n        \n    def assemble_B(quad_rule):\n        B = np.zeros((2, 2))\n        # j=0 (row 1) corresponds to psi_1\n        for i in range(2): # Column index for phi_i\n            integrand_B_0i = lambda x, y, i=i: -phis[0](x,y) * dphis_dy[i](x,y)\n            B[0, i] = integrate(integrand_B_0i, quad_rule)\n\n        # j=1 (row 2) corresponds to psi_2\n        for i in range(2): # Column index for phi_i\n            integrand_B_1i = lambda x, y, i=i: phis[1](x,y) * dphis_dx[i](x,y)\n            B[1, i] = integrate(integrand_B_1i, quad_rule)\n        return B\n        \n    # Define test cases from the problem statement\n    test_cases = [\n        # (Q_A, Q_B, sigma)\n        ('G5', 'G5', 0.1),      # Case 1\n        ('MP', 'G5', 0.001),    # Case 2\n        ('MP', 'G5', 10.0),     # Case 3\n        ('MP', 'MP', 0.001),    # Case 4\n    ]\n\n    results = []\n\n    # Assemble mass matrices once using high-accuracy quadrature\n    Me = assemble_Me('G5')\n    Mh = assemble_Mh('G5')\n\n    # Compute inverse square roots of mass matrices\n    # These are symmetric positive definite, so sqrtm is well-defined\n    # and returns the principal (unique SPD) square root.\n    Me_sqrt = sqrtm(Me)\n    Mh_sqrt = sqrtm(Mh)\n    Me_inv_sqrt = np.linalg.inv(Me_sqrt)\n    Mh_inv_sqrt = np.linalg.inv(Mh_sqrt)\n\n    # Process each test case\n    for q_a_rule, q_b_rule, sigma in test_cases:\n        A = assemble_A(q_a_rule)\n        B = assemble_B(q_b_rule)\n        \n        # Form the \"error\" matrix C = A + B^T\n        C = A + B.T\n        \n        # If C is numerically zero, the norm is zero, no need for matrix math\n        if np.allclose(C, 0):\n            norm_val = 0.0\n        else:\n            # Form the matrix K for the norm calculation\n            K = Me_inv_sqrt @ C @ Mh_inv_sqrt\n            \n            # Compute the spectral norm (largest singular value)\n            norm_val = np.linalg.norm(K, 2)\n        \n        # Check for non-physical energy growth\n        growth_detected = norm_val > sigma\n        results.append(growth_detected)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3309793"}, {"introduction": "在求解波动方程的特征值问题时，一个常见的挑战是“伪模”的出现，这些非物理的数值解会污染计算结果，使物理模式的识别变得困难。本练习介绍了一种通过增强伽辽金测试流程来解决此问题的实用技术。你将通过实施一个基于散度的惩罚项，并量化其对消除伪模的影响，来亲身体验如何主动修改弱形式以提高离散算子的谱精度 [@problem_id:3309795]。", "problem": "考虑一个单连通的理想电导体 (PEC) 腔体中的无源时谐麦克斯韦特征值问题，该腔体占据单位正方形区域 $\\Omega = [0,1]^2$，边界为 $\\partial\\Omega$。电场 $\\mathbf{E}$ 满足以下强形式算子方程：\n$$\n\\nabla \\times \\nabla \\times \\mathbf{E} = \\lambda \\, \\mathbf{E} \\quad \\text{in } \\Omega,\\quad \\mathbf{n}\\times \\mathbf{E} = \\mathbf{0} \\quad \\text{on } \\partial\\Omega,\n$$\n其中 $\\lambda$ 表示波数的平方。标准的伽辽金弱形式为：\n$$\n\\int_{\\Omega} (\\nabla \\times \\mathbf{E}) \\cdot (\\nabla \\times \\mathbf{v}) \\, d\\mathbf{x} = \\lambda \\int_{\\Omega} \\mathbf{E}\\cdot \\mathbf{v} \\, d\\mathbf{x},\n$$\n对于所有容许的测试函数 $\\mathbf{v}$，其中 $\\mathbf{n}$ 是 $\\partial\\Omega$ 上的单位外法向量，所有矢量微分算子都在具有适当迹的分布意义下取值。众所周知，当试探/测试空间包含形如 $\\nabla \\phi$（其中 $\\phi$ 是标量势）的无旋场时，恒等式 $\\nabla \\times \\nabla \\phi = \\mathbf{0}$ 会导致无旋分量以伪特征对的形式污染离散谱。\n\n您的任务是提出、推导、离散化并量化一种伽辽金测试方法，该方法使用无旋测试来分离和惩罚无旋分量。具体来说，通过添加一个形式如下的项，用基于散度的罚项来增广弱形式，以强制抑制无旋模式：\n$$\n\\alpha \\int_{\\Omega} (\\nabla \\cdot \\mathbf{E}) (\\nabla \\cdot \\mathbf{v}) \\, d\\mathbf{x},\n$$\n其中罚参数 $\\alpha \\ge 0$，$\\mathbf{v}$ 从一个包含无旋测试函数的空间中选取。目标是量化 $\\alpha$ 对消除所得离散特征值问题中伪模式的影响。\n\n使用一个大小为 $N_x \\times N_y$ 的内部节点的均匀笛卡尔网格对 $\\Omega$ 进行离散化，其在 $x$ 方向的间距为 $h = 1/(N_x+1)$，在 $y$ 方向的间距为 $h = 1/(N_y+1)$（为简化数值常数，假设 $N_x = N_y$，但独立实现 $N_x$ 和 $N_y$）。通过在内部节点上定义的分量 $(E_x, E_y)$ 来表示场 $\\mathbf{E}$，并定义以下一致的离散算子，所有算子都作用于在内部节点上索引并通过域外齐次狄利克雷数据（零）扩展的数组：\n\n- $x$ 和 $y$ 方向的向前差分，分别表示为 $D_x^f$ 和 $D_y^f$：\n$$\n(D_x^f u)_{i,j} = \\frac{u_{i+1,j} - u_{i,j}}{h}, \\quad (D_y^f u)_{i,j} = \\frac{u_{i,j+1} - u_{i,j}}{h},\n$$\n其中 $u$ 在内部索引范围之外扩展为 $0$。\n\n- $x$ 和 $y$ 方向的向后差分，分别表示为 $D_x^b$ 和 $D_y^b$：\n$$\n(D_x^b u)_{i,j} = \\frac{u_{i,j} - u_{i-1,j}}{h}, \\quad (D_y^b u)_{i,j} = \\frac{u_{i,j} - u_{i,j-1}}{h},\n$$\n采用相同的零扩展约定。\n\n- 矢量场 $(E_x, E_y)$ 在节点 $(i,j)$ 处的离散标量旋度（平面外分量）由下式给出：\n$$\n(\\nabla \\times \\mathbf{E})_{i,j} = (D_x^f E_y)_{i,j} - (D_y^f E_x)_{i,j}.\n$$\n\n- $\\mathbf{E}$ 在节点 $(i,j)$ 处的离散散度由下式给出：\n$$\n(\\nabla \\cdot \\mathbf{E})_{i,j} = (D_x^b E_x)_{i,j} + (D_y^b E_y)_{i,j}.\n$$\n\n使用这些算子，组装对称半正定矩阵\n$$\n\\mathbf{A}_\\alpha = \\mathbf{C}^\\top \\mathbf{C} + \\alpha \\, \\mathbf{G}^\\top \\mathbf{G},\n$$\n其中 $\\mathbf{C}$ 将未知量向量 $[E_x; E_y]$ 映射到离散旋度值，$\\mathbf{G}$ 将 $[E_x; E_y]$ 映射到离散散度值。使用集中质量内积，从而使广义特征值问题简化为 $\\mathbf{A}_\\alpha$ 的标准对称特征问题。\n\n将伪模式定义为与小于某个小的非负阈值 $\\tau$ 的特征值相关联的特征向量，该阈值应根据浮点数量级和网格间距来设置。您将实现一个程序，对于每个测试用例，组装 $\\mathbf{A}_\\alpha$，计算其全谱，并返回严格小于 $\\tau$ 的特征值的数量。\n\n您必须在指定的环境中实现该程序。不允许用户输入；参数必须硬编码。您的程序必须解决以下测试用例集，每个用例由元组 $(N_x, N_y, \\alpha, \\tau)$ 指定：\n\n- 用例 1: $(8, 8, 0.0, 1.0 \\times 10^{-9})$。\n- 用例 2: $(8, 8, 1.0 \\times 10^{-6}, 1.0 \\times 10^{-9})$。\n- 用例 3: $(8, 8, 1.0 \\times 10^{-3}, 1.0 \\times 10^{-9})$。\n- 用例 4: $(8, 8, 1.0 \\times 10^{-1}, 1.0 \\times 10^{-9})$。\n- 用例 5: $(6, 6, 0.0, 1.0 \\times 10^{-9})$。\n- 用例 6: $(6, 6, 1.0 \\times 10^{-3}, 1.0 \\times 10^{-9})$。\n\n您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[r_1,r_2,r_3,r_4,r_5,r_6]$），其中每个 $r_k$ 是相应测试用例中小于阈值 $\\tau$ 的特征值的整数计数。由于此离散分析中不出现物理单位，您必须报告不带单位的纯整数。此问题中不出现角度，也不报告百分比。", "solution": "该问题要求对一种散度惩罚方法进行公式化和数值实现，以抑制二维时谐麦克斯韦特征值问题的有限差分离散化中所产生的伪非物理模式。分析将在具有理想电导体 (PEC) 边界条件的单位正方形区域 $\\Omega = [0,1]^2$ 上进行。\n\n控制连续问题是找到满足矢量亥姆霍兹方程的电场 $\\mathbf{E}$ 和相应的波数平方 $\\lambda$：\n$$\n\\nabla \\times \\nabla \\times \\mathbf{E} = \\lambda \\, \\mathbf{E} \\quad \\text{in } \\Omega\n$$\n在边界 $\\partial\\Omega$ 上满足 PEC 边界条件 $\\mathbf{n}\\times \\mathbf{E} = \\mathbf{0}$。通过与测试函数 $\\mathbf{v}$ 作内积并进行分部积分，得到的标准弱形式为：\n$$\n\\int_{\\Omega} (\\nabla \\times \\mathbf{E}) \\cdot (\\nabla \\times \\mathbf{v}) \\, d\\mathbf{x} = \\lambda \\int_{\\Omega} \\mathbf{E}\\cdot \\mathbf{v} \\, d\\mathbf{x}\n$$\n众所周知，当用于 $\\mathbf{E}$ 和 $\\mathbf{v}$ 的离散函数空间包含非平凡的无旋函数时，此公式会遭受谱污染。这些形如 $\\nabla\\phi$ 的函数属于旋度算子 $\\nabla \\times (\\nabla \\phi) = \\mathbf{0}$ 的核，导致了伪零特征值解。\n\n为缓解此问题，我们通过一个惩罚非零散度场的罚项来增广弱形式。增广后的弱形式为：\n$$\n\\int_{\\Omega} (\\nabla \\times \\mathbf{E}) \\cdot (\\nabla \\times \\mathbf{v}) \\, d\\mathbf{x} + \\alpha \\int_{\\Omega} (\\nabla \\cdot \\mathbf{E}) (\\nabla \\cdot \\mathbf{v}) \\, d\\mathbf{x} = \\lambda_{\\alpha} \\int_{\\Omega} \\mathbf{E}\\cdot \\mathbf{v} \\, d\\mathbf{x}\n$$\n其中 $\\alpha \\ge 0$ 是一个罚参数。该项为任何非无散的解 $\\mathbf{E}$ 增加了一个“代价”。由于无源区域中的物理本征模式是无散的（$\\nabla \\cdot \\mathbf{E} = 0$），理想情况下，此罚项仅影响通常不是无散的伪无旋模式。\n\n我们使用一个 $N_x \\times N_y$ 内部节点的均匀笛卡尔网格对区域 $\\Omega$ 进行离散化。网格间距为 $h_x = 1/(N_x+1)$ 和 $h_y = 1/(N_y+1)$。电场分量 $(E_x, E_y)$ 配置在 $N_x N_y$ 个内部节点的每一个上。总自由度数为 $N_{dof} = 2 N_x N_y$。我们将未知量组织成一个长度为 $N_{dof}$ 的单一向量 $\\mathbf{u}$，其中前 $N_x N_y$ 个元素表示 $E_x$ 分量，后 $N_x N_y$ 个元素表示 $E_y$ 分量，两者都使用网格节点的行主序字典映射进行排序。域外齐次狄利克雷数据的条件意味着边界上的场分量被设置为零。\n\n连续微分算子由指定的有限差分算子近似。设 $\\mathbf{u}_x$ 和 $\\mathbf{u}_y$ 是 $\\mathbf{u}$ 中分别对应于 $E_x$ 和 $E_y$ 的子向量。离散旋度和散度可以表示为矩阵-向量积：\n- 离散旋度：$(\\nabla \\times \\mathbf{E})_{disc} = \\mathbf{C} \\mathbf{u} = \\mathbf{D}_x^f \\mathbf{u}_y - \\mathbf{D}_y^f \\mathbf{u}_x$。大小为 $(N_xN_y) \\times (2N_xN_y)$ 的矩阵 $\\mathbf{C}$ 构造为 $\\mathbf{C} = [-\\mathbf{D}_y^f, \\mathbf{D}_x^f]$，其中 $\\mathbf{D}_x^f$ 和 $\\mathbf{D}_y^f$ 是向前差分算子的矩阵表示。\n- 离散散度：$(\\nabla \\cdot \\mathbf{E})_{disc} = \\mathbf{G} \\mathbf{u} = \\mathbf{D}_x^b \\mathbf{u}_x + \\mathbf{D}_y^b \\mathbf{u}_y$。大小为 $(N_xN_y) \\times (2N_xN_y)$ 的矩阵 $\\mathbf{G}$ 构造为 $\\mathbf{G} = [\\mathbf{D}_x^b, \\mathbf{D}_y^b]$，其中 $\\mathbf{D}_x^b$ 和 $\\mathbf{D}_y^b$ 是向后差分的矩阵表示。在给定的边界条件下，它们与向前差分的关系为 $\\mathbf{D}_x^b = -(\\mathbf{D}_x^f)^T$ 和 $\\mathbf{D}_y^b = -(\\mathbf{D}_y^f)^T$。\n\n增广弱形式中的积分通过在网格单元上的求和来近似。假设单元面积为 $h_x h_y$，这导致一个离散广义特征值问题：\n$$\n(h_x h_y)(\\mathbf{C}^T \\mathbf{C} + \\alpha \\mathbf{G}^T \\mathbf{G}) \\mathbf{u} = \\lambda_{\\alpha} (h_x h_y) \\mathbf{I} \\mathbf{u}\n$$\n问题指定了集中质量内积，从而得到单位质量矩阵 $\\mathbf{I}$。单元面积项 $h_x h_y$ 在等式两边被约掉，得到矩阵 $\\mathbf{A}_\\alpha$ 的标准对称特征值问题：\n$$\n\\mathbf{A}_\\alpha \\mathbf{u} = \\lambda_{\\alpha} \\mathbf{u}, \\quad \\text{where} \\quad \\mathbf{A}_\\alpha = \\mathbf{C}^T \\mathbf{C} + \\alpha \\, \\mathbf{G}^T \\mathbf{G}\n$$\n$\\mathbf{A}_\\alpha$ 的特征值 $\\lambda_\\alpha$ 是波数平方的离散近似。\n\n现在我们分析 $\\alpha$ 的影响。矩阵 $\\mathbf{A}_\\alpha$ 是对称半正定的，这保证了其特征值为实的非负数。\n- 当 $\\alpha = 0$ 时，系统矩阵为 $\\mathbf{A}_0 = \\mathbf{C}^T \\mathbf{C}$。特征值是 $\\mathbf{C}$ 的奇异值的平方。对应于特征值 $0$ 的特征向量是 $\\mathbf{C}$ 的零空间中的向量，它们代表离散无旋场。这些就是伪模式。它们的数量是 $\\ker(\\mathbf{C})$ 的维数。\n- 当 $\\alpha > 0$ 时，考虑一个伪模式 $\\mathbf{u}_s$ 使得 $\\mathbf{C}\\mathbf{u}_s = \\mathbf{0}$。相应的特征值由瑞利商给出：\n$$\n\\lambda_{\\alpha,s} = \\frac{\\mathbf{u}_s^T \\mathbf{A}_\\alpha \\mathbf{u}_s}{\\mathbf{u}_s^T \\mathbf{u}_s} = \\frac{\\mathbf{u}_s^T (\\mathbf{C}^T \\mathbf{C} + \\alpha \\mathbf{G}^T \\mathbf{G}) \\mathbf{u}_s}{\\|\\mathbf{u}_s\\|^2} = \\frac{\\|\\mathbf{C}\\mathbf{u}_s\\|^2 + \\alpha \\|\\mathbf{G}\\mathbf{u}_s\\|^2}{\\|\\mathbf{u}_s\\|^2} = \\alpha \\frac{\\|\\mathbf{G}\\mathbf{u}_s\\|^2}{\\|\\mathbf{u}_s\\|^2}\n$$\n一个非平凡的离散无旋场（一个离散梯度）通常不是无散的，所以 $\\mathbf{G}\\mathbf{u}_s \\neq \\mathbf{0}$。因此，其特征值从 $0$ 被“提升”到一个与 $\\alpha$ 成正比的正值。通过选择一个足够大的 $\\alpha$，我们可以将所有伪模式的特征值移到远离零的位置，从而有效地将它们与具有物理意义的低频段谱分离开来。\n\n数值任务是实现这一过程。对于每个测试用例 $(N_x, N_y, \\alpha, \\tau)$，我们为一个 $(N_x \\times N_y)$ 网格构建稀疏矩阵 $\\mathbf{D}_x^f$ 和 $\\mathbf{D}_y^f$，组装 $\\mathbf{C}$ 和 $\\mathbf{G}$，形成稠密矩阵 $\\mathbf{A}_\\alpha$，计算其全特征谱，并计算严格小于给定阈值 $\\tau$ 的特征值的数量。这个计数可以量化剩余伪模式的数量。随着 $\\alpha$ 从 $0$ 开始增加，这个计数预计会减少，从而证明惩罚方法的有效性。", "answer": "```python\nimport numpy as np\nfrom scipy import sparse\n\ndef construct_operators(Nx, Ny):\n    \"\"\"\n    Constructs discrete curl (C) and divergence (G) operator matrices.\n\n    Args:\n        Nx (int): Number of interior grid points in the x-direction.\n        Ny (int): Number of interior grid points in the y-direction.\n\n    Returns:\n        tuple: A tuple containing the sparse matrices (C, G).\n    \"\"\"\n    hx = 1.0 / (Nx + 1)\n    hy = 1.0 / (Ny + 1)\n    N = Nx * Ny\n\n    # We use row-major ordering for grid nodes: index k = i * Ny + j\n    # This seems to be the common convention, but the problem states i*Nx+j for row-major.\n    # Let's use i*Ny+j which corresponds to x being the 'slow' index and y being 'fast'.\n    # This choice affects the structure of Dx_f.\n\n    # 1D forward difference matrix for y-direction on a single column (size Ny x Ny)\n    diagonals_y = [-np.ones(Ny), np.ones(Ny - 1)]\n    offsets_y = [0, 1]\n    By = sparse.diags(diagonals_y, offsets_y, shape=(Ny, Ny), format='csc') / hy\n\n    # Full Dy^f acting on the 2D grid (Nx*Ny vector)\n    # This forms a block diagonal matrix with Nx blocks of By.\n    Dy_f = sparse.kron(sparse.eye(Nx, format='csc'), By, format='csc')\n\n    # Full Dx^f acting on the 2D grid.\n    # This couples node k=i*Ny+j with node k'= (i+1)*Ny+j = k+Ny.\n    diagonals_x = [-np.ones(N), np.ones(N - Ny)]\n    offsets_x = [0, Ny]\n    Dx_f = sparse.diags(diagonals_x, offsets_x, shape=(N, N), format='csc') / hx\n\n    # Backward differences are negative transposes of forward differences with these BCs\n    Dx_b = -Dx_f.transpose(copy=True)\n    Dy_b = -Dy_f.transpose(copy=True)\n\n    # The unknown vector is stacked as [E_x, E_y].\n    # C = [-Dy^f, Dx^f]\n    C = sparse.hstack([-Dy_f, Dx_f], format='csc')\n    \n    # G = [Dx^b, Dy^b]\n    G = sparse.hstack([Dx_b, Dy_b], format='csc')\n    \n    return C, G\n\ndef solve_eigenproblem(Nx, Ny, alpha, tau):\n    \"\"\"\n    Assembles the matrix A_alpha, computes its eigenvalues, and counts\n    the number of eigenvalues below a threshold tau.\n\n    Args:\n        Nx (int): Number of interior grid points in the x-direction.\n        Ny (int): Number of interior grid points in the y-direction.\n        alpha (float): The penalty parameter.\n        tau (float): The eigenvalue threshold.\n\n    Returns:\n        int: The number of eigenvalues of A_alpha strictly less than tau.\n    \"\"\"\n    if Nx != Ny:\n        # The problem statement simplifies hx=hy. Let's ensure this.\n        raise ValueError(\"This implementation assumes Nx=Ny for simplicity.\")\n        \n    C, G = construct_operators(Nx, Ny)\n    \n    # A_alpha = C.T * C + alpha * (G.T * G)\n    # The @ operator is overloaded for sparse matrix multiplication\n    A_alpha = C.transpose() @ C + alpha * (G.transpose() @ G)\n    \n    # The matrix size is small enough to be densified for full eigenvalue computation.\n    A_dense = A_alpha.toarray()\n    \n    # Compute eigenvalues. np.linalg.eigh is for symmetric/hermitian matrices\n    # and returns only the eigenvalues, sorted.\n    eigenvalues = np.linalg.eigvalsh(A_dense)\n    \n    # Count eigenvalues strictly less than tau\n    count = np.sum(eigenvalues  tau)\n    \n    return int(count)\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    # Test cases: (Nx, Ny, alpha, tau)\n    test_cases = [\n        (8, 8, 0.0, 1.0e-9),\n        (8, 8, 1.0e-6, 1.0e-9),\n        (8, 8, 1.0e-3, 1.0e-9),\n        (8, 8, 1.0e-1, 1.0e-9),\n        (6, 6, 0.0, 1.0e-9),\n        (6, 6, 1.0e-3, 1.0e-9),\n    ]\n\n    results = []\n    for case in test_cases:\n        Nx, Ny, alpha, tau = case\n        result = solve_eigenproblem(Nx, Ny, alpha, tau)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3309795"}]}