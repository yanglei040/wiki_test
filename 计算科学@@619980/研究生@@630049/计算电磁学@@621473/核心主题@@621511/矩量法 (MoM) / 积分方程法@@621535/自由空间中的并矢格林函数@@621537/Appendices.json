{"hands_on_practices": [{"introduction": "并矢格林函数是将任意电流源与其辐射场联系起来的强大工具。第一个动手实践旨在搭建一座桥梁，应用该抽象形式推导振荡电偶极子这一电磁学基本结果的辐射方向图。通过这个经典问题，我们可以直观地理解并矢格林函数如何将源的特性转化为远场的物理可观测量。[@problem_id:3303047]", "problem": "一个振荡点电偶极子位于均匀自由空间（介电常数为 $\\varepsilon_{0}$，磁导率为 $\\mu_{0}$）的原点，其复相量偶极矩振幅为 $\\mathbf{p}_{0} = p_{0}\\,\\hat{\\mathbf{z}}$。假设时间依赖性为 $\\exp(-i \\omega t)$，定义自由空间波数 $k = \\omega \\sqrt{\\mu_{0}\\varepsilon_{0}}$，并用 $\\eta_{0} = \\sqrt{\\mu_{0}/\\varepsilon_{0}}$ 表示自由空间波阻抗，用 $c = 1/\\sqrt{\\mu_{0}\\varepsilon_{0}}$ 表示光速。设自由空间中的电并矢格林函数为张量 $\\mathbf{G}^{E}(\\mathbf{r},\\mathbf{r}')$，该张量在以下意义上求解矢量亥姆霍兹方程：对于任意外加电流密度 $\\mathbf{J}(\\mathbf{r}')$，辐射电场满足\n$$\n\\nabla \\times \\nabla \\times \\mathbf{E}(\\mathbf{r}) - k^{2}\\mathbf{E}(\\mathbf{r}) = i \\omega \\mu_{0} \\mathbf{J}(\\mathbf{r}), \\quad \\mathbf{E}(\\mathbf{r}) = i \\omega \\mu_{0} \\int \\mathbf{G}^{E}(\\mathbf{r},\\mathbf{r}') \\cdot \\mathbf{J}(\\mathbf{r}') \\, dV'.\n$$\n将振荡电偶极子视为一个点源，其等效电流密度为 $\\mathbf{J}(\\mathbf{r}) = -i \\omega \\mathbf{p}_{0}\\,\\delta(\\mathbf{r})$。仅使用频域麦克斯韦方程组、自由空间并矢格林函数的定义、其远场渐近形式以及时均坡印亭定理，完成以下任务：\n\n1. 推导偶极子辐射的远场电场和磁场，作为观测方向 $\\hat{\\mathbf{r}}$ 和从 $+\\hat{\\mathbf{z}}$ 轴测量的极角 $\\theta$ 的函数。\n\n2. 根据这些场，推导单位立体角的时均辐射功率，并确定归一化角辐射方向图 $F(\\theta)$，其定义为无量纲且归一化，使得 $\\max_{\\theta} F(\\theta) = 1$。\n\n3. 对所有立体角进行积分，以获得总时均辐射功率 $P_{\\text{rad}}$。\n\n答案格式要求：\n- 提供你的最终答案，形式为一个数对，包含：\n  - 归一化角辐射方向图 $F(\\theta)$，纯粹表示为 $\\theta$ 的函数。\n  - 总时均辐射功率 $P_{\\text{rad}}$，用 $\\omega$、 $|p_{0}|$、 $\\varepsilon_{0}$ 和 $c$ 进行符号表示。\n- 以国际单位制（SI）中的瓦特（watts）表示 $P_{\\text{rad}}$。\n- 将两个答案放在一个单行矩阵中，作为最终的方框答案。\n- 无需进行数值计算或四舍五入。", "solution": "该问题陈述具有科学依据、内容自洽且定义明确。它描述了电磁理论中的一个典型问题——点电偶极子的辐射——使用了标准的定义和方程。因此，该问题被认为是有效的。\n\n由外加电流密度 $\\mathbf{J}(\\mathbf{r}')$ 辐射的电场 $\\mathbf{E}(\\mathbf{r})$ 由涉及电并矢格林函数 $\\mathbf{G}^{E}(\\mathbf{r},\\mathbf{r}')$ 的积分关系给出：\n$$\n\\mathbf{E}(\\mathbf{r}) = i \\omega \\mu_{0} \\int \\mathbf{G}^{E}(\\mathbf{r},\\mathbf{r}') \\cdot \\mathbf{J}(\\mathbf{r}') \\, dV'\n$$\n位于原点的点电偶极子由等效電流密度 $\\mathbf{J}(\\mathbf{r}') = -i \\omega \\mathbf{p}_{0}\\,\\delta(\\mathbf{r}')$ 表示，其中 $\\mathbf{p}_{0} = p_{0}\\,\\hat{\\mathbf{z}}$，$\\delta(\\mathbf{r}')$ 是三维狄拉克δ函数。\n\n将电流密度代入 $\\mathbf{E}(\\mathbf{r})$ 的积分中得到：\n$$\n\\mathbf{E}(\\mathbf{r}) = i \\omega \\mu_{0} \\int \\mathbf{G}^{E}(\\mathbf{r},\\mathbf{r}') \\cdot (-i \\omega \\mathbf{p}_{0}\\,\\delta(\\mathbf{r}')) \\, dV'\n$$\n利用狄拉克δ函数的筛选性质，即 $\\int f(\\mathbf{x}')\\delta(\\mathbf{x}')d\\mathbf{x}'=f(\\mathbf{0})$，我们可以在 $\\mathbf{r}'=\\mathbf{0}$ 处计算积分：\n$$\n\\mathbf{E}(\\mathbf{r}) = (i \\omega)(-i \\omega) \\mu_{0} \\mathbf{G}^{E}(\\mathbf{r},\\mathbf{0}) \\cdot \\mathbf{p}_{0} = \\omega^{2} \\mu_{0} \\mathbf{G}^{E}(\\mathbf{r},\\mathbf{0}) \\cdot \\mathbf{p}_{0}\n$$\n问题要求远场解。对于位于 $\\mathbf{r}'=\\mathbf{0}$ 的源，自由空间并矢格林函数 $\\mathbf{G}^{E}(\\mathbf{r},\\mathbf{r}')$ 的远场渐近形式为\n$$\n\\mathbf{G}^{E}(\\mathbf{r},\\mathbf{0}) \\approx (\\mathbf{I} - \\hat{\\mathbf{r}}\\hat{\\mathbf{r}}) \\frac{\\exp(ik|\\mathbf{r}|)}{4\\pi|\\mathbf{r}|} \\quad \\text{as } |\\mathbf{r}| \\to \\infty\n$$\n其中 $\\mathbf{I}$ 是单位并矢，$\\hat{\\mathbf{r}}=\\mathbf{r}/|\\mathbf{r}|$ 是径向单位矢量，$r=|\\mathbf{r}|$。项 $\\hat{\\mathbf{r}}\\hat{\\mathbf{r}}$ 表示并矢积。\n\n将此渐近形式代入 $\\mathbf{E}(\\mathbf{r})$ 的表达式中，得到远场电场：\n$$\n\\mathbf{E}(\\mathbf{r}) \\approx \\omega^{2} \\mu_{0} \\left[ (\\mathbf{I} - \\hat{\\mathbf{r}}\\hat{\\mathbf{r}}) \\frac{\\exp(ikr)}{4\\pi r} \\right] \\cdot \\mathbf{p}_{0}\n$$\n项 $(\\mathbf{I} - \\hat{\\mathbf{r}}\\hat{\\mathbf{r}}) \\cdot \\mathbf{p}_{0}$ 将偶极矩矢量 $\\mathbf{p}_{0}$ 投影到垂直于观测方向 $\\hat{\\mathbf{r}}$ 的平面上。给定 $\\mathbf_p_0 = p_0\\hat{\\mathbf{z}}$。在球坐标中，$\\hat{\\mathbf{z}} = \\cos\\theta\\,\\hat{\\mathbf{r}} - \\sin\\theta\\,\\hat{\\boldsymbol{\\theta}}$，与 $\\hat{\\mathbf{r}}$ 的点积为 $\\hat{\\mathbf{r}} \\cdot \\hat{\\mathbf{z}} = \\cos\\theta$。\n因此，投影为：\n$$\n(\\mathbf{I} - \\hat{\\mathbf{r}}\\hat{\\mathbf{r}}) \\cdot \\mathbf{p}_{0} = \\mathbf{p}_{0} - \\hat{\\mathbf{r}}(\\hat{\\mathbf{r}} \\cdot \\mathbf{p}_{0}) = p_{0}\\hat{\\mathbf{z}} - \\hat{\\mathbf{r}}(p_{0}\\cos\\theta) = p_{0}(\\hat{\\mathbf{z}} - \\hat{\\mathbf{r}}\\cos\\theta)\n$$\n代入 $\\hat{\\mathbf{z}}$ 的球坐标表示：\n$$\np_{0}((\\cos\\theta\\,\\hat{\\mathbf{r}} - \\sin\\theta\\,\\hat{\\boldsymbol{\\theta}}) - \\hat{\\mathbf{r}}\\cos\\theta) = -p_{0}\\sin\\theta\\,\\hat{\\boldsymbol{\\theta}}\n$$\n将此结果代回 $\\mathbf{E}(\\mathbf{r})$ 的表达式中：\n$$\n\\mathbf{E}(\\mathbf{r}) \\approx \\omega^{2} \\mu_{0} \\frac{\\exp(ikr)}{4\\pi r} (-p_{0}\\sin\\theta\\,\\hat{\\boldsymbol{\\theta}}) = -\\frac{\\omega^{2} \\mu_{0} p_{0} \\sin\\theta}{4\\pi r} \\exp(ikr) \\hat{\\boldsymbol{\\theta}}\n$$\n使用关系式 $k = \\omega\\sqrt{\\mu_0\\varepsilon_0}$ 和 $c=1/\\sqrt{\\mu_0\\varepsilon_0}$，我们可以写出 $\\omega^2\\mu_0 = k^2c^2\\mu_0 = k^2/ \\varepsilon_0$。电场于是为：\n$$\n\\mathbf{E}(\\mathbf{r}) \\approx -\\frac{k^{2} p_{0}}{4\\pi\\varepsilon_{0}} \\frac{\\exp(ikr)}{r} \\sin\\theta\\,\\hat{\\boldsymbol{\\theta}}\n$$\n这是远场电场，完成了任务1的第一部分。\n\n对于任务1的第二部分，我们求远场磁场 $\\mathbf{H}(\\mathbf{r})$。在远场中，辐射场局部类似于横电磁（TEM）平面波，其磁场与电场的关系为 $\\mathbf{H} = \\frac{1}{\\eta_{0}} \\hat{\\mathbf{r}} \\times \\mathbf{E}$，其中 $\\eta_{0} = \\sqrt{\\mu_{0}/\\varepsilon_{0}}$ 是自由空间阻抗。\n$$\n\\mathbf{H}(\\mathbf{r}) \\approx \\frac{1}{\\eta_{0}} \\hat{\\mathbf{r}} \\times \\left( -\\frac{k^{2} p_{0}}{4\\pi\\varepsilon_{0}} \\frac{\\exp(ikr)}{r} \\sin\\theta\\,\\hat{\\boldsymbol{\\theta}} \\right)\n$$\n使用叉积 $\\hat{\\mathbf{r}} \\times \\hat{\\boldsymbol{\\theta}} = \\hat{\\boldsymbol{\\phi}}$:\n$$\n\\mathbf{H}(\\mathbf{r}) \\approx -\\frac{k^{2} p_{0}}{4\\pi\\eta_{0}\\varepsilon_{0}} \\frac{\\exp(ikr)}{r} \\sin\\theta\\,\\hat{\\boldsymbol{\\phi}}\n$$\n常数组可以利用 $\\eta_0\\varepsilon_0 = \\sqrt{\\mu_0/\\varepsilon_0}\\varepsilon_0 = \\sqrt{\\mu_0\\varepsilon_0} = 1/c$ 来简化。\n所以，$\\frac{k^2}{\\eta_0\\varepsilon_0} = k^2 c = k(\\omega)$。\n$$\n\\mathbf{H}(\\mathbf{r}) \\approx -\\frac{k\\omega p_{0}}{4\\pi} \\frac{\\exp(ikr)}{r} \\sin\\theta\\,\\hat{\\boldsymbol{\\phi}}\n$$\n$\\mathbf{E}(\\mathbf{r})$ 和 $\\mathbf{H}(\\mathbf{r})$ 的表达式完成了任务1。\n\n对于任务2，我们推导单位立体角的时均辐射功率。这可以从时均坡印亭矢量 $\\langle\\mathbf{S}\\rangle = \\frac{1}{2}\\text{Re}\\{\\mathbf{E} \\times \\mathbf{H}^*\\}$ 的径向分量得到。\n$$\n\\mathbf{H}^*(\\mathbf{r}) \\approx -\\frac{k\\omega p_{0}^*}{4\\pi} \\frac{\\exp(-ikr)}{r} \\sin\\theta\\,\\hat{\\boldsymbol{\\phi}}\n$$\n$$\n\\mathbf{E} \\times \\mathbf{H}^* \\approx \\left( -\\frac{k^{2} p_{0}}{4\\pi\\varepsilon_{0}} \\frac{\\exp(ikr)}{r} \\sin\\theta\\,\\hat{\\boldsymbol{\\theta}} \\right) \\times \\left( -\\frac{k\\omega p_{0}^*}{4\\pi} \\frac{\\exp(-ikr)}{r} \\sin\\theta\\,\\hat{\\boldsymbol{\\phi}} \\right)\n$$\n负号相消，且 $\\exp(ikr)\\exp(-ikr)=1$。矢量叉积为 $\\hat{\\boldsymbol{\\theta}} \\times \\hat{\\boldsymbol{\\phi}} = \\hat{\\mathbf{r}}$。\n$$\n\\mathbf{E} \\times \\mathbf{H}^* \\approx \\frac{k^3\\omega |p_0|^2 \\sin^2\\theta}{16\\pi^2\\varepsilon_0 r^2} \\hat{\\mathbf{r}}\n$$\n此表达式纯为实数，因此 $\\text{Re}\\{\\mathbf{E} \\times \\mathbf{H}^*\\} = \\mathbf{E} \\times \\mathbf{H}^*$。\n$$\n\\langle\\mathbf{S}\\rangle = \\frac{1}{2} \\frac{k^3\\omega |p_0|^2 \\sin^2\\theta}{16\\pi^2\\varepsilon_0 r^2} \\hat{\\mathbf{r}} = \\frac{k^3\\omega |p_0|^2 \\sin^2\\theta}{32\\pi^2\\varepsilon_0 r^2} \\hat{\\mathbf{r}}\n$$\n为了用要求的变量表示，我们代入 $k=\\omega/c$：\n$$\nk^3\\omega = (\\omega/c)^3\\omega = \\omega^4/c^3\n$$\n$$\n\\langle\\mathbf{S}\\rangle = \\frac{\\omega^4 |p_0|^2}{32\\pi^2\\varepsilon_0 c^3 r^2} \\sin^2\\theta\\,\\hat{\\mathbf{r}}\n$$\n单位立体角的时均辐射功率，记为 $\\frac{dP_{\\text{rad}}}{d\\Omega}$，由 $r^2$ 乘以坡印亭矢量的大小给出：\n$$\n\\frac{dP_{\\text{rad}}}{d\\Omega} = r^2 |\\langle\\mathbf{S}\\rangle| = \\frac{\\omega^4 |p_0|^2}{32\\pi^2\\varepsilon_0 c^3} \\sin^2\\theta\n$$\n归一化角辐射方向图 $F(\\theta)$ 定义为无量綱且最大值为1。功率的角依赖性包含在 $\\sin^2\\theta$ 项中。$\\sin^2\\theta$ 的最大值为1，出现在 $\\theta=\\pi/2$。因此，归一化辐射方向图为：\n$$\nF(\\theta) = \\sin^2\\theta\n$$\n这完成了任务2。\n\n对于任务3，我们通过对所有立体角 $\\Omega$ 积分单位立体角的功率来求得总时均辐射功率 $P_{\\text{rad}}$。立体角微元为 $d\\Omega = \\sin\\theta d\\theta d\\phi$。\n$$\nP_{\\text{rad}} = \\int_{\\Omega} \\frac{dP_{\\text{rad}}}{d\\Omega} d\\Omega = \\int_{0}^{2\\pi} \\int_{0}^{\\pi} \\left( \\frac{\\omega^4 |p_0|^2}{32\\pi^2\\varepsilon_0 c^3} \\sin^2\\theta \\right) \\sin\\theta d\\theta d\\phi\n$$\n被积函数与 $\\phi$ 无关，因此对 $\\phi$ 的积分得到 $2\\pi$：\n$$\nP_{\\text{rad}} = \\frac{\\omega^4 |p_0|^2}{32\\pi^2\\varepsilon_0 c^3} (2\\pi) \\int_{0}^{\\pi} \\sin^3\\theta d\\theta = \\frac{\\omega^4 |p_0|^2}{16\\pi\\varepsilon_0 c^3} \\int_{0}^{\\pi} \\sin^3\\theta d\\theta\n$$\n我们计算剩下的积分：\n$$\n\\int_{0}^{\\pi} \\sin^3\\theta d\\theta = \\int_{0}^{\\pi} \\sin\\theta(1-\\cos^2\\theta)d\\theta\n$$\n设 $u = \\cos\\theta$，则 $du = -\\sin\\theta d\\theta$。积分限从 $\\theta=0 \\to u=1$ 和 $\\theta=\\pi \\to u=-1$ 变化。\n$$\n\\int_{0}^{\\pi} \\sin^3\\theta d\\theta = \\int_{1}^{-1} (1-u^2)(-du) = \\int_{-1}^{1} (1-u^2)du = \\left[u - \\frac{u^3}{3}\\right]_{-1}^{1}\n$$\n$$\n= \\left(1 - \\frac{1}{3}\\right) - \\left(-1 - \\frac{(-1)^3}{3}\\right) = \\frac{2}{3} - \\left(-1 + \\frac{1}{3}\\right) = \\frac{2}{3} - \\left(-\\frac{2}{3}\\right) = \\frac{4}{3}\n$$\n将此结果代入 $P_{\\text{rad}}$ 的表达式：\n$$\nP_{\\text{rad}} = \\frac{\\omega^4 |p_0|^2}{16\\pi\\varepsilon_0 c^3} \\left(\\frac{4}{3}\\right) = \\frac{\\omega^4 |p_0|^2}{12\\pi\\varepsilon_0 c^3}\n$$\n这是偶极子辐射的总时均功率，用要求的物理常量表示。该表达式采用国际单位制（瓦特）。这完成了任务3。\n\n最终答案由数对 $(F(\\theta), P_{\\text{rad}})$ 组成。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\sin^2\\theta & \\frac{\\omega^4 |p_0|^2}{12\\pi\\varepsilon_0 c^3}\n\\end{pmatrix}\n}\n$$", "id": "3303047"}, {"introduction": "虽然偶极子辐射等解析解具有深刻的洞察力，但许多现实世界的问题必须依赖数值方法。本实践深入探讨了在数值求解器中使用格林函数的主要挑战：当源点和场点重合时出现的强奇性。它将指导您完成奇点减去方案的理论推导，这是矩量法（MoM）等计算方法中的一项关键技术。[@problem_id:3309732]", "problem": "考虑一个理想导电表面，该表面位于一个均匀、各向同性、无源的区域中，其特征为角频率 $\\omega$、磁导率 $\\mu$、介电常数 $\\epsilon$ 和波数 $k = \\omega \\sqrt{\\mu \\epsilon}$。在频域电场积分方程 (EFIE) 中，作用于表面电流密度 $\\mathbf{J}(\\mathbf{r}')$ 的算子通常用并矢格林函数 $\\overline{\\overline{G}}(\\mathbf{r},\\mathbf{r}')$ 来表示，其中 $\\mathbf{r}$ 和 $\\mathbf{r}'$ 是表面上的位置矢量，$R = |\\mathbf{r} - \\mathbf{r}'|$。自由空间中矢量亥姆霍兹方程的并矢格林函数由标量亥姆霍兹格林函数与亥姆霍兹算子的卷积定义，可写为\n$$\n\\overline{\\overline{G}}(\\mathbf{r},\\mathbf{r}') = \\left( \\overline{\\overline{I}} + \\frac{1}{k^{2}} \\nabla \\nabla \\right) \\frac{\\exp(\\mathrm{i} k R)}{4 \\pi R},\n$$\n其中 $\\overline{\\overline{I}}$ 是单位并矢，$\\nabla$ 相对于 $\\mathbf{r}$ 作用。在使用 Rao–Wilton–Glisson (RWG) 基函数（在每个三角形上具有分段常数表面散度的分段线性切向矢量函数）的矩量法 (MoM) Galerkin 过程中，当 $\\mathbf{r}' \\to \\mathbf{r}$ 时，涉及 $\\overline{\\overline{G}}(\\mathbf{r},\\mathbf{r}')$ 的积分是弱奇异到强奇异的。\n\n从频域麦克斯韦方程组和上面 $\\overline{\\overline{G}}(\\mathbf{r},\\mathbf{r}')$ 的定义出发，通过系统地展开标量核并对由并矢算子 $\\overline{\\overline{I}} + \\frac{1}{k^{2}} \\nabla \\nabla$ 产生的奇异性进行分类，来分析当 $R \\to 0$ 时的局部奇异性结构。然后，构建一个奇异性减法方案，该方案通过以下方式，使得所有采用 RWG 基函数和测试函数的逐单元 Galerkin 测试积分至多是弱奇异的，从而可以用标准奇异积分法（如 Duffy 变换）进行数值积分：\n\n- 将标量核分解为奇异的静态部分和正则的余项。\n- 使用分部积分将超奇异贡献重塑为涉及 RWG 函数表面散度的弱奇异形式，以及\n- 确定必须进行数值积分的正则化并矢核的闭合形式解析表达式。\n\n提供最终的正则化并矢核，作为 $k$、$R$、$\\overline{\\overline{I}}$ 和微分算子的单个闭合形式解析表达式，适用于在采用 RWG 函数的 Galerkin 测试矩量法中直接使用。无需进行数值计算。", "solution": "该问题要求推导用于 Galerkin 测试的矩量法 (MoM) 求解电场积分方程 (EFIE) 的正则化并矢核。正则化过程必须处理当源点和观察点重合时，在并矢格林函数中出现的奇异性。\n\n出发点是问题陈述中给出的矢量亥姆霍兹方程的并矢格林函数：\n$$\n\\overline{\\overline{G}}(\\mathbf{r},\\mathbf{r}') = \\left( \\overline{\\overline{I}} + \\frac{1}{k^{2}} \\nabla \\nabla \\right) G_s(R)\n$$\n其中 $G_s(R) = \\frac{\\exp(\\mathrm{i} k R)}{4 \\pi R}$ 是标量亥姆霍兹格林函数，$R = |\\mathbf{r} - \\mathbf{r}'|$，$\\overline{\\overline{I}}$ 是单位并矢，$\\nabla$ 是相对于观察坐标 $\\mathbf{r}$ 的梯度算子。\n\n通过检查其组成项的行为来分析当 $R \\to 0$ 时 $\\overline{\\overline{G}}$ 中的奇异性。标量格林函数 $G_s(R)$ 具有 $O(R^{-1})$ 阶的奇异性。当在二维面元上积分时，这会产生一个弱奇异积分，该积分是可积的。第二项涉及算子 $\\nabla \\nabla$。$G_s(R)$ 的导数行为如下：\n$$\n\\nabla G_s(R) \\sim O(R^{-2})\n$$\n$$\n\\nabla \\nabla G_s(R) \\sim O(R^{-3})\n$$\n$O(R^{-3})$ 的行为被称为超奇异性。涉及此类项的面积分是发散的，不能使用标准求积法则进行数值计算。奇异性减法方案的目标是重新表述问题，以避免直接对该超奇异项进行积分。\n\n该过程如问题所述，包含三个主要步骤。\n\n**步骤 1：标量核的分解**\n\n我们将标量格林函数 $G_s(R)$ 分解为一个奇异的静态部分和一个正则的余项。静态部分对应于波数 $k \\to 0$ 的情况，即拉普拉斯方程的格林函数 $G_0(R)$。\n$$\nG_s(R) = G_0(R) + G_{rem}(R)\n$$\n其中：\n- 奇异静态部分为 $G_0(R) = \\frac{1}{4 \\pi R}$。\n- 正则余项为 $G_{rem}(R) = G_s(R) - G_0(R) = \\frac{\\exp(\\mathrm{i} k R) - 1}{4 \\pi R}$。\n\n余项 $G_{rem}(R)$ 在 $R \\to 0$ 时是正则的（即有限且光滑的）。这可以通过指数项的泰勒级数展开来证明：\n$$\n\\exp(\\mathrm{i} k R) = 1 + \\mathrm{i} k R + \\frac{(\\mathrm{i} k R)^2}{2!} + \\dots\n$$\n$$\nG_{rem}(R) = \\frac{(1 + \\mathrm{i} k R + O(R^2)) - 1}{4 \\pi R} = \\frac{\\mathrm{i} k}{4 \\pi} + O(R)\n$$\n当 $R \\to 0$ 时，$G_{rem}(R)$ 趋近于常数值 $\\frac{\\mathrm{i} k}{4 \\pi}$。$G_{rem}(R)$ 相对于 $R$ 的所有导数在 $R \\to 0$ 时也都是正则的。\n\n将此分解代入 $\\overline{\\overline{G}}$ 的表达式中，我们可以将并矢核分解为奇异部分和正则部分：\n$$\n\\overline{\\overline{G}} = \\left( \\overline{\\overline{I}} + \\frac{1}{k^{2}} \\nabla \\nabla \\right) (G_0(R) + G_{rem}(R)) = \\overline{\\overline{G}}_{sing} + \\overline{\\overline{G}}_{reg}\n$$\n其中：\n- 奇异并矢核是 $\\overline{\\overline{G}}_{sing} = \\left( \\overline{\\overline{I}} + \\frac{1}{k^{2}} \\nabla \\nabla \\right) G_0(R)$。\n- 正则并矢核是 $\\overline{\\overline{G}}_{reg} = \\left( \\overline{\\overline{I}} + \\frac{1}{k^{2}} \\nabla \\nabla \\right) G_{rem}(R)$。\n\n正则核 $\\overline{\\overline{G}}_{reg}$ 对所有 $R$ 都具有良好行为，并且可以使用标准求积方法进行数值积分。奇异核 $\\overline{\\overline{G}}_{sing}$ 包含了所有有问题的奇异性，需要特殊处理。\n\n**步骤 2：通过分部积分对奇异部分进行正则化**\n\n在 Galerkin 过程中，我们计算形如 $\\langle \\mathbf{f}_m, \\mathcal{L} \\mathbf{f}_n \\rangle$ 的矩阵元，其中 $\\mathbf{f}_m$ 和 $\\mathbf{f}_n$ 是测试函数和基函数（此处为 RWG 函数），$\\mathcal{L}$ 是积分算子。涉及 $\\overline{\\overline{G}}_{sing}$ 超奇异部分的积分是：\n$$\nI_{hyper} = \\frac{1}{k^2} \\int_S \\mathbf{f}_m(\\mathbf{r}) \\cdot \\left( \\int_{S'} (\\nabla \\nabla G_0(\\mathbf{r}, \\mathbf{r}')) \\cdot \\mathbf{f}_n(\\mathbf{r}') dS' \\right) dS\n$$\n这个积分可以通过使用表面散度定理（曲面上的格林恒等式或分部积分的一种形式），将导数从格林函数转移到基函数和测试函数上，从而进行正则化。对于表面 $S$ 上的切向矢量场 $\\mathbf{F}$ 和标量场 $\\phi$ 的恒等式是 $\\int_S \\mathbf{F} \\cdot \\nabla_s \\phi \\, dS = - \\int_S (\\nabla_s \\cdot \\mathbf{F}) \\phi \\, dS$，假设 $\\mathbf{F}$ 在 $S$ 的边界上为零。应用此恒等式两次可得：\n$$\n\\int_S \\mathbf{f}_m \\cdot (\\nabla (\\nabla \\cdot \\mathbf{A})) dS = - \\int_S (\\nabla_s \\cdot \\mathbf{f}_m) (\\nabla \\cdot \\mathbf{A}) dS\n$$\n以及\n$$\n\\int_{S'} (\\nabla' G_0) \\cdot \\mathbf{f}_n dS' = - \\int_{S'} G_0 (\\nabla'_s \\cdot \\mathbf{f}_n) dS'\n$$\n结合这些结果，我们可以将超奇异积分重写为：\n$$\nI_{hyper} = - \\frac{1}{k^2} \\int_S \\int_{S'} (\\nabla_s \\cdot \\mathbf{f}_m(\\mathbf{r})) G_0(R) (\\nabla'_s \\cdot \\mathbf{f}_n(\\mathbf{r}')) dS' dS\n$$\n这个变换后的积分仅为弱奇异，因为其核现在是 $G_0(R) \\sim O(R^{-1})$。对于 RWG 基函数，表面散度 $\\nabla_s \\cdot \\mathbf{f}$ 是分段常数，这使得该形式特别适用于解析积分或专门的数值积分。\n\n因此，完整奇异部分 $\\overline{\\overline{G}}_{sing}$ 的积分计算如下：\n$$\n\\langle \\mathbf{f}_m, \\int \\overline{\\overline{G}}_{sing} \\cdot \\mathbf{f}_n dS' \\rangle = \\int_S \\int_{S'} G_0(R) (\\mathbf{f}_m \\cdot \\mathbf{f}_n) dS' dS - \\frac{1}{k^2} \\int_S \\int_{S'} (\\nabla_s \\cdot \\mathbf{f}_m) G_0(R) (\\nabla'_s \\cdot \\mathbf{f}_n) dS' dS\n$$\n右侧的两个积分都是弱奇异的，并且通常对于重合的三角形单元通过解析方法或特殊求积法进行计算。\n\n**步骤 3：用于数值积分的正则化核的确定**\n\n整体计算方案涉及将总矩阵元的计算分为两部分：\n1.  使用步骤2中推导的正则化公式，对涉及奇异静态核 $G_0(R)$ 的积分进行解析或专门的计算。\n2.  对涉及正则核 $\\overline{\\overline{G}}_{reg}$ 的积分进行标准数值求积。\n\n问题要求确定“必须进行数值积分的正则化并矢核”。这对应于完整并矢格林函数的正则部分，我们已将其确定为 $\\overline{\\overline{G}}_{reg}$。其被积函数是完全正则的，使其适合直接进行数值积分。\n\n因此，在该方案的数值积分部分中使用的正则化并矢核的闭合形式解析表达式为：\n$$\n\\overline{\\overline{K}}_{num} = \\overline{\\overline{G}}_{reg} = \\left( \\overline{\\overline{I}} + \\frac{1}{k^{2}} \\nabla \\nabla \\right) G_{rem}(R)\n$$\n代入 $G_{rem}(R)$ 的表达式，我们得到最终形式。", "answer": "$$\n\\boxed{\\left( \\overline{\\overline{I}} + \\frac{1}{k^{2}} \\nabla \\nabla \\right) \\left( \\frac{\\exp(\\mathrm{i} k R) - 1}{4 \\pi R} \\right)}\n$$", "id": "3309732"}, {"introduction": "理论的真正力量在于其解决实际问题的能力。最后一个实践将前一个练习中的正则化理论转化为具体的数值算法。您将通过编写代码来计算体电流产生的电场，正确处理近场奇点并验证结果，从而完成从理论到实际计算的完整过程。[@problem_id:3303052]", "problem": "您的任务是设计并实现一个数值方案，用于通过并矢格林函数计算自由空间中体电流分布产生的频域电场，该方案采用加减准静态核的方法进行奇异性减去。计算必须基于电磁学的第一性原理和格林函数的基本定义。\n\n您推导方法所必须依据的基础理论包括：\n- 频域中的麦克斯韦方程组（时间依赖性为 $e^{+i \\omega t}$）、自由空间中的本构关系，以及波数定义 $k = \\omega \\sqrt{\\mu_0 \\epsilon_0}$。\n- 标量自由空间亥姆霍兹格林函数 $G_0(\\mathbf{r},\\mathbf{r}') = \\dfrac{e^{i k |\\mathbf{r} - \\mathbf{r}'|}}{4 \\pi |\\mathbf{r} - \\mathbf{r}'|}$。\n- 由电流密度 $\\mathbf{J}(\\mathbf{r}')$ 产生的电场的并矢格林函数表示，\n  $$ \\mathbf{E}(\\mathbf{r}) = i \\omega \\mu_0 \\int_{\\mathbb{R}^3} \\left[ \\mathbf{I} + \\frac{1}{k^2} \\nabla \\nabla \\right] G_0(\\mathbf{r},\\mathbf{r}') \\cdot \\mathbf{J}(\\mathbf{r}') \\, d\\mathbf{r}' , $$\n  其中 $\\mathbf{I}$ 是单位并矢，$\\nabla$ 作用于 $\\mathbf{r}$。\n- 对于径向函数 $f$，$ \\nabla \\nabla f(|\\mathbf{r}-\\mathbf{r}'|)$ 沿 $\\hat{\\mathbf{R}} \\hat{\\mathbf{R}}$ 和 $\\mathbf{I} - \\hat{\\mathbf{R}} \\hat{\\mathbf{R}}$ 方向的分量分解，其中 $\\mathbf{R} = \\mathbf{r} - \\mathbf{r}'$ 且 $\\hat{\\mathbf{R}} = \\mathbf{R}/|\\mathbf{R}|$。\n- 对奇异部分取极限 $k \\to 0$ 得到的准静态核，以及库仑势的黑塞矩阵（Hessian）的分布恒等式，\n  $$ \\nabla \\nabla \\left(\\frac{1}{R}\\right) = \\operatorname{PV}\\left[\\frac{3 \\hat{\\mathbf{R}} \\hat{\\mathbf{R}} - \\mathbf{I}}{R^3}\\right] - \\frac{4 \\pi}{3} \\mathbf{I} \\, \\delta(\\mathbf{R}), $$\n  其中 $\\operatorname{PV}$ 表示柯西主值。\n\n您的任务是：\n- 从上述基本理论出发，推导作用于 $\\mathbf{J}$ 的并矢核的显式算法形式，该形式需适合在离散网格上进行数值计算，且不得调用绕过推导过程的简化公式。\n- 通过在奇异点（$\\mathbf{r} = \\mathbf{r}'$）周围的一个小球形邻域内加减准静态核来实现奇异性减去，并加回可解析积分的delta函数自能项。具体来说，由准静态核产生的解析修正应作为一个局域“自能项”被包含在内，该项与 $-\\mathbf{J}(\\mathbf{r})/(3 k^2)$ 成正比，并乘以 $\\mathbf{E}(\\mathbf{r})$ 的相应物理前置因子。\n\n数值设置：\n- 考虑在以原点为中心、边长为 $a$ 的有限立方体域内存在均匀电流密度 $\\mathbf{J}(\\mathbf{r}') = J_0 \\, \\hat{\\mathbf{x}}$，域外为零。该立方体被均匀离散化，每边有 $N$ 个点，间距为 $\\Delta = a/(N-1)$，数值积分通过对网格单元上的核进行求和来执行。\n- 观测点 $\\mathbf{r}$ 可在立方体内或外。当 $\\mathbf{r}$ 在内部时，通过为准静态部分排除 $\\mathbf{r}$ 周围半径为 $R_0$ 的球（使用 $R_0 = 2 \\Delta$），在该球内对正则化核进行数值积分，并加回分布恒等式所蕴含的解析自能项，来进行奇异性减去。当 $\\mathbf{r}$ 在外部时，不需要进行减去操作。\n- 使用真空常数 $\\mu_0 = 4 \\pi \\times 10^{-7} \\, \\mathrm{H/m}$ 和 $c = 299{,}792{,}458 \\, \\mathrm{m/s}$，其中 $\\epsilon_0 = 1/(\\mu_0 c^2)$。波数为 $k = \\omega/c$，其中 $\\omega = 2 \\pi f$。\n\n您的程序必须计算以下三个测试用例中电场的模 $|\\mathbf{E}(\\mathbf{r})|$，单位为伏特/米 (V/m)，每个用例由 $(a, N, f, J_0, \\mathbf{r})$ 指定：\n1. 情况 A（带减去的通用内部点）：\n   - $a = 0.2 \\, \\mathrm{m}$，$N = 41$，$f = 1.0 \\times 10^8 \\, \\mathrm{Hz}$，$J_0 = 1.0 \\, \\mathrm{A/m^2}$，$\\mathbf{r} = (0,0,0) \\, \\mathrm{m}$。观测点在立方体内。使用 $R_0 = 2 \\Delta$ 应用奇异性减去。\n2. 情况 B（不带减去的外部点）：\n   - $a = 0.2 \\, \\mathrm{m}$，$N = 41$，$f = 1.0 \\times 10^8 \\, \\mathrm{Hz}$，$J_0 = 1.0 \\, \\mathrm{A/m^2}$，$\\mathbf{r} = (0,0,1.0) \\, \\mathrm{m}$。观测点在立方体外。不应用减去操作。\n3. 情况 C（带减去的近准静态内部点）：\n   - $a = 0.2 \\, \\mathrm{m}$，$N = 41$，$f = 1.0 \\times 10^6 \\, \\mathrm{Hz}$，$J_0 = 1.0 \\, \\mathrm{A/m^2}$，$\\mathbf{r} = (0,0,0) \\, \\mathrm{m}$。观测点在立方体内。使用 $R_0 = 2 \\Delta$ 应用奇异性减去。\n\n不涉及角度单位。物理单位：以十进制浮点数形式报告模的大小，单位为伏特/米 (V/m)。\n\n您的程序应生成单行输出，其中包含三个结果，格式为方括号内以逗号分隔的列表，顺序为 [情况 A, 情况 B, 情况 C]，例如 \"[x_A,x_B,x_C]\"。每个条目必须是代表 $|\\mathbf{E}(\\mathbf{r})|$（单位 V/m）的浮点数。\n\n您的实现必须是完全自包含的，不得要求用户输入或外部文件，并且必须能直接运行。所有数值步骤和使用的任何常数都必须在程序中明确定义。", "solution": "该问题要求设计并实现一个数值方案，用以计算由体电流密度 $\\mathbf{J}(\\mathbf{r}')$ 产生的电场 $\\mathbf{E}(\\mathbf{r})$。该方法基于并矢格林函数形式体系，并采用奇异性减去技术来处理当观测点 $\\mathbf{r}$ 位于源区域内部时核函数的奇异行为。\n\n### 1. 理论构建\n\n在频域中（假设时间依赖性为 $e^{+i\\omega t}$），由自由空间中的电流密度 $\\mathbf{J}(\\mathbf{r}')$ 产生的电场 $\\mathbf{E}(\\mathbf{r})$ 由以下体积分方程给出：\n$$\n\\mathbf{E}(\\mathbf{r}) = \\int_{V'} \\overline{\\overline{K}}(\\mathbf{r}, \\mathbf{r}') \\cdot \\mathbf{J}(\\mathbf{r}') \\, dV'\n$$\n其中 $V'$ 是源体积，$\\overline{\\overline{K}}(\\mathbf{r}, \\mathbf{r}')$ 是电场核。该核通过 $\\overline{\\overline{K}} = i \\omega \\mu_0 \\overline{\\overline{G}}_E$ 与并矢格林函数 $\\overline{\\overline{G}}_E$ 相关。并矢格林函数表示为：\n$$\n\\overline{\\overline{G}}_E(\\mathbf{r}, \\mathbf{r}') = \\left[ \\mathbf{I} + \\frac{1}{k^2} \\nabla \\nabla \\right] G_0(\\mathbf{r},\\mathbf{r}')\n$$\n此处，$\\mathbf{I}$ 是单位并矢，$k = \\omega/c$ 是自由空间中的波数，$\\nabla$ 作用于观测点坐标 $\\mathbf{r}$，$G_0(\\mathbf{r},\\mathbf{r}')$ 是标量自由空间亥姆霍兹格林函数：\n$$\nG_0(\\mathbf{r}, \\mathbf{r}') = \\frac{e^{ikR}}{4\\pi R}\n$$\n其中 $\\mathbf{R} = \\mathbf{r} - \\mathbf{r}'$ 且 $R = |\\mathbf{R}|$。\n\n计算该积分的主要挑战在于当 $R \\to 0$ 时核的奇异性。$\\nabla\\nabla G_0$ 项包含一个 $O(1/R^3)$ 阶的不可积（强）奇异性。\n\n### 2. 并矢核的推导\n\n为了推导核的显式形式，我们必须计算其黑塞矩阵（Hessian） $\\nabla \\nabla G_0(R)$。对于一个普遍的径向函数 $f(R)$，其黑塞矩阵可表示为：\n$$\n\\nabla \\nabla f(R) = \\left( \\frac{d^2f}{dR^2} - \\frac{1}{R}\\frac{df}{dR} \\right) \\hat{\\mathbf{R}}\\hat{\\mathbf{R}} + \\frac{1}{R}\\frac{df}{dR} \\mathbf{I}\n$$\n其中 $\\hat{\\mathbf{R}} = \\mathbf{R}/R$。对于 $f(R) = G_0(R) = \\frac{e^{ikR}}{4\\pi R}$，其导数为：\n$$\n\\frac{dG_0}{dR} = \\frac{e^{ikR}}{4\\pi} \\left( \\frac{ik}{R} - \\frac{1}{R^2} \\right)\n$$\n$$\n\\frac{d^2G_0}{dR^2} = \\frac{e^{ikR}}{4\\pi} \\left( \\frac{-k^2}{R} - \\frac{2ik}{R^2} + \\frac{2}{R^3} \\right)\n$$\n将这些导数代入黑塞矩阵公式，得到：\n$$\n\\nabla \\nabla G_0(R) = \\frac{e^{ikR}}{4\\pi R^3} \\left[ (-k^2R^2 - 3ikR + 3) \\hat{\\mathbf{R}}\\hat{\\mathbf{R}} + (ikR - 1) \\mathbf{I} \\right]\n$$\n完整的核 $\\overline{\\overline{K}} = i\\omega\\mu_0 (\\mathbf{I} G_0 + \\frac{1}{k^2}\\nabla\\nabla G_0)$ 于是可以写为：\n$$\n\\overline{\\overline{K}}(\\mathbf{R}) = \\frac{i\\omega\\mu_0 e^{ikR}}{4\\pi k^2 R^3} \\left[ (k^2R^2+ikR-1)\\mathbf{I} + (-k^2R^2-3ikR+3)\\hat{\\mathbf{R}}\\hat{\\mathbf{R}} \\right]\n$$\n当 $R \\to 0$ 时，与 $3\\hat{\\mathbf{R}}\\hat{\\mathbf{R}}/R^3$ 和 $-\\mathbf{I}/R^3$ 成比例的项占主导地位，表现出强 $O(1/R^3)$ 奇异性。\n\n### 3. 奇异性减去\n\n为处理此奇异性，我们减去并加上一个准静态核。当 $R \\to 0$ 时，$\\nabla\\nabla G_0$ 的奇异行为与更简单的静电势 $1/R$ 的奇异行为相似。问题给出了库仑势的黑塞矩阵的分布恒等式：\n$$\n\\nabla \\nabla \\left(\\frac{1}{R}\\right) = \\operatorname{PV}\\left[\\frac{3 \\hat{\\mathbf{R}} \\hat{\\mathbf{R}} - \\mathbf{I}}{R^3}\\right] - \\frac{4 \\pi}{3} \\mathbf{I} \\, \\delta(\\mathbf{R})\n$$\n其中 $\\operatorname{PV}$ 表示柯西主值。核的准静态部分，即造成强奇异性的部分，定义为：\n$$\n\\overline{\\overline{K}}_{\\text{qs,PV}}(\\mathbf{R}) = \\frac{i\\omega\\mu_0}{k^2} \\operatorname{PV}\\left[\\nabla\\nabla\\left(\\frac{1}{4\\pi R}\\right)\\right] = \\frac{i\\omega\\mu_0}{4\\pi k^2} \\operatorname{PV}\\left[\\frac{3 \\hat{\\mathbf{R}} \\hat{\\mathbf{R}} - \\mathbf{I}}{R^3}\\right]\n$$\n通过加上和减去此准静态核并分离出delta函数贡献，$\\mathbf{E}(\\mathbf{r})$ 的积分被重写为：\n$$\n\\mathbf{E}(\\mathbf{r}) = \\int_{V'} \\left( \\overline{\\overline{K}}(\\mathbf{R}) - \\overline{\\overline{K}}_{\\text{qs,PV}}(\\mathbf{R}) \\right) \\cdot \\mathbf{J}(\\mathbf{r}') \\, dV' + \\operatorname{PV} \\int_{V'} \\overline{\\overline{K}}_{\\text{qs,PV}}(\\mathbf{R}) \\cdot \\mathbf{J}(\\mathbf{r}') \\, dV' + \\mathbf{E}_{\\text{self}}\n$$\n“自能项” $\\mathbf{E}_{\\text{self}}$ 源于该恒等式中的delta函数部分：\n$$\n\\mathbf{E}_{\\text{self}} = \\int_{V'} \\frac{i\\omega\\mu_0}{k^2} \\left(-\\frac{1}{3}\\mathbf{I}\\delta(\\mathbf{R})\\right) \\cdot \\mathbf{J}(\\mathbf{r}') \\, dV' = -\\frac{i\\omega\\mu_0}{3k^2} \\mathbf{J}(\\mathbf{r})\n$$\n剩余的核 $\\overline{\\overline{K}}_{\\text{reg}}(\\mathbf{R}) = \\overline{\\overline{K}}(\\mathbf{R}) - \\overline{\\overline{K}}_{\\text{qs,PV}}(\\mathbf{R})$ 是正则化的。虽然它仍然以 $O(1/R)$ 的形式弱发散，但这种奇异性是可积的，从而允许直接进行数值求和。\n\n### 4. 数值算法\n\n根据问题的规定，对于源体积内的一个观测点 $\\mathbf{r}$，我们将数值积分域进行划分。\n1.  **减去球之外 ($R > R_0$)**：使用完整的核 $\\overline{\\overline{K}}(\\mathbf{R})$。被积函数是良态的。\n2.  **减去球之内 ($0  R \\le R_0$)**：使用正则化核 $\\overline{\\overline{K}}_{\\text{reg}}(\\mathbf{R}) = \\overline{\\overline{K}}(\\mathbf{R}) - \\overline{\\overline{K}}_{\\text{qs,PV}}(\\mathbf{R})$ 进行数值积分。这避免了强奇异性。\n3.  **解析修正**：被减去项的贡献 $\\int_{V' \\cap B_{R_0}} \\overline{\\overline{K}}_{\\text{qs,PV}} \\cdot \\mathbf{J}' dV'$（其中 $B_{R_0}$ 是半径为 $R_0$ 的球）被解析地处理。对于球形区域和常数 $\\mathbf{J}$，根据对称性，主值积分为零。delta函数的贡献作为自能项 $\\mathbf{E}_{\\text{self}}$ 被加回。\n\n对于内部点 $\\mathbf{r}$ 的离散化计算为：\n$$\n\\mathbf{E}(\\mathbf{r}) \\approx \\sum_{\\mathbf{r}'_i, |\\mathbf{R}_i| > R_0} \\overline{\\overline{K}}(\\mathbf{R}_i) \\cdot \\mathbf{J}(\\mathbf{r}'_i)\n\\Delta V + \\sum_{\\mathbf{r}'_i, 0  |\\mathbf{R}_i| \\le R_0} \\overline{\\overline{K}}_{\\text{reg}}(\\mathbf{R}_i) \\cdot \\mathbf{J}(\\mathbf{r}'_i) \\Delta V + \\mathbf{E}_{\\text{self}}\n$$\n其中 $\\Delta V = (a/(N-1))^3$ 是一个网格单元的体积。对于外部点，$R$ 永远不为零，因此不需要减去操作，所有源单元都只使用完整的核 $\\overline{\\overline{K}}$。\n\n核与矢量的乘积可以表示为 $\\overline{\\overline{K}}\\cdot\\mathbf{J} = (\\alpha \\mathbf{I} + \\beta \\hat{\\mathbf{R}}\\hat{\\mathbf{R}}) \\cdot \\mathbf{J} = \\alpha \\mathbf{J} + \\beta(\\hat{\\mathbf{R}}\\cdot\\mathbf{J})\\hat{\\mathbf{R}}$。完整核的系数为：\n$$\n\\alpha_{\\text{full}} = \\frac{i\\omega\\mu_0 e^{ikR}}{4\\pi k^2 R^3} (k^2R^2+ikR-1)\n$$\n$$\n\\beta_{\\text{full}} = \\frac{i\\omega\\mu_0 e^{ikR}}{4\\pi k^2 R^3} (-k^2R^2-3ikR+3)\n$$\n准静态部分的系数为：\n$$\n\\alpha_{\\text{qs}} = \\frac{i\\omega\\mu_0}{4\\pi k^2 R^3} (-1)\n$$\n$$\n\\beta_{\\text{qs}} = \\frac{i\\omega\\mu_0}{4\\pi k^2 R^3} (3)\n$$\n在减去半径 $R_0$ 内，数值实现将使用 $\\alpha_{\\text{reg}} = \\alpha_{\\text{full}} - \\alpha_{\\text{qs}}$ 和 $\\beta_{\\text{reg}} = \\beta_{\\text{full}} - \\beta_{\\text{qs}}$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the electric field from a volume current source using a dyadic Green's function\n    with singularity subtraction.\n    \"\"\"\n    # Define physical constants\n    MU0 = 4 * np.pi * 1e-7  # Vacuum permeability (H/m)\n    C = 299792458.0         # Speed of light in vacuum (m/s)\n    EPS0 = 1 / (MU0 * C**2)  # Vacuum permittivity (F/m)\n\n    test_cases = [\n        # Case A: (a, N, f, J0, r_obs) - Internal point\n        (0.2, 41, 1.0e8, 1.0, np.array([0.0, 0.0, 0.0])),\n        # Case B: (a, N, f, J0, r_obs) - External point\n        (0.2, 41, 1.0e8, 1.0, np.array([0.0, 0.0, 1.0])),\n        # Case C: (a, N, f, J0, r_obs) - Near-quasistatic internal point\n        (0.2, 41, 1.0e6, 1.0, np.array([0.0, 0.0, 0.0])),\n    ]\n\n    results = []\n    for case in test_cases:\n        a, N, f, J0, r_obs = case\n\n        # Derived parameters\n        omega = 2 * np.pi * f\n        k = omega / C\n        delta = a / (N - 1)\n        dV = delta**3\n        R0 = 2 * delta\n        \n        # Current density vector\n        J_vec = np.array([J0, 0.0, 0.0], dtype=complex)\n        \n        # Grid setup for the source cube\n        half_width = a / 2.0\n        grid_coords = np.linspace(-half_width, half_width, N)\n        \n        E_total = np.array([0.0, 0.0, 0.0], dtype=complex)\n\n        # Check if observation point is inside the source volume\n        is_internal = np.all(np.abs(r_obs) = half_width + 1e-9)\n\n        # Numerical integration over the source volume\n        for x_p in grid_coords:\n            for y_p in grid_coords:\n                for z_p in grid_coords:\n                    r_prime = np.array([x_p, y_p, z_p])\n                    \n                    R_vec = r_obs - r_prime\n                    R = np.linalg.norm(R_vec)\n                    \n                    # Skip the singularity point r = r' itself. It is handled by the self-term.\n                    if R  1e-12:\n                        continue\n                    \n                    R_hat = R_vec / R\n                    \n                    # Select kernel based on position (internal/external point) and distance\n                    use_regularized_kernel = is_internal and R = R0\n                    \n                    if use_regularized_kernel:\n                        # Regularized kernel: K_full - K_qs\n                        # Numerically more stable to compute (K_full - K_qs) directly\n                        # Full kernel coeffients\n                        exp_ikR = np.exp(1j * k * R)\n                        \n                        common_factor_full = 1j * omega * MU0 * exp_ikR / (4 * np.pi * k**2 * R**3)\n                        alpha_full = common_factor_full * (k**2 * R**2 + 1j * k * R - 1)\n                        beta_full = common_factor_full * (-k**2 * R**2 - 3j * k * R + 3)\n                        \n                        # Quasistatic kernel coefficients\n                        common_factor_qs = 1j * omega * MU0 / (4 * np.pi * k**2 * R**3)\n                        alpha_qs = common_factor_qs * (-1)\n                        beta_qs = common_factor_qs * (3)\n                        \n                        alpha = alpha_full - alpha_qs\n                        beta = beta_full - beta_qs\n                    else:\n                        # Full kernel\n                        exp_ikR = np.exp(1j * k * R)\n                        \n                        common_factor = 1j * omega * MU0 * exp_ikR / (4 * np.pi * k**2 * R**3)\n                        alpha = common_factor * (k**2 * R**2 + 1j * k * R - 1)\n                        beta = common_factor * (-k**2 * R**2 - 3j * k * R + 3)\n                        \n                    # Calculate contribution from this source cell\n                    Rhat_dot_J = np.dot(R_hat, J_vec)\n                    dE = (alpha * J_vec + beta * Rhat_dot_J * R_hat) * dV\n                    E_total += dE\n                    \n        # Add the analytical self-term for internal points\n        if is_internal:\n            # E_self = - (1j * omega * MU0) / (3 * k**2) * J_vec\n            # This can also be written as -1j / (3 * omega * EPS0) * J_vec\n            J_at_r_obs = np.array([J0, 0.0, 0.0], dtype=complex)\n            E_self = -1j / (3 * omega * EPS0) * J_at_r_obs\n            E_total += E_self\n\n        # Calculate the magnitude of the total electric field\n        E_magnitude = np.linalg.norm(np.abs(E_total))\n        results.append(E_magnitude)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3303052"}]}