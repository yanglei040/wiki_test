{"hands_on_practices": [{"introduction": "本章的第一个练习将带您深入了解旋度适应样条空间的基本性质。在应用这些先进的函数空间求解麦克斯韦方程等物理问题之前，我们必须首先掌握其“蓝图”：它包含多少个基函数（即空间的维度），以及它所能描述的电磁场有多平滑（即连续性）。通过这个练习 [@problem_id:3320575]，您将亲手从底层的张量积B样条构造出发，推导出这些核心属性，为后续更复杂的应用打下坚实的基础。", "problem": "考虑一个二维参数域，其在每个参数方向上都具有相同的开放均匀节点矢量。设多项式次数为 $p=3$，每个参数方向上有 $n$ 个控制点。内部节点的重复度为 $1$，端点重复度为 $p+1$。因此，每个方向上的单变量节点区间数量为 $n-p$。对于计算电磁学，考虑与二维离散 de Rham 序列相关的旋度协调等几何空间，即向量值样条空间\n$$\\mathcal{V}^{1} = S^{p-1,p} \\times S^{p,p-1},$$\n其中 $S^{a,b}$ 表示在给定节点矢量上构建的双次数为 $(a,b)$ 的张量积 B 样条空间。\n\n从开放均匀 B 样条的核心定义及其连续性性质（单变量维数等于节点区间数加上多项式次数，跨越重复度为 $m$ 的内部节点的单元间连续性为 $C^{p-m}$）以及上述旋度协调空间 $\\mathcal{V}^{1}$ 的定义出发：\n\n- 用 $n$ 表示，推导 $\\mathcal{V}^{1}$ 中张量积基函数的总数。\n- 确定由 $\\mathcal{V}^{1}$ 表示的向量场跨越任意内部节点线的最小全局单元间连续性阶数。\n- 将单级 $k$-细化定义为在两个参数方向上将次数提升一，同时保持内部节点重复度不变（因而保持节点区间数固定）。在此操作下，推导细化后的旋度协调空间中张量积基函数的总数以及新的最小全局单元间连续性阶数。\n\n将你的最终答案以单行矩阵的形式提供，按顺序包含\n$$\\big[\\mathcal{V}^{1} \\text{ 的初始维数},\\ \\text{初始最小全局连续性阶数},\\ \\text{细化后维数},\\ \\text{细化后最小全局连续性阶数}\\big],$$\n用 $n$ 的符号表示。无需数值四舍五入，也不涉及单位。", "solution": "问题要求推导一个特定的旋度协调等几何空间在初始状态和经过一级 $k$-细化后的维数和最小全局单元间连续性。解题过程将基于所提供的定义，首先分析初始配置，然后分析细化后的配置。\n\n设两个参数方向用 $\\xi$ 和 $\\eta$ 表示。开放均匀节点矢量在两个方向上是相同的。\n初始多项式次数为 $p=3$。\n每个单变量方向上的控制点数量为 $n$。\n每个单变量方向上的节点区间数量为 $n-p$。\n内部节点重复度为 $m=1$。\n旋度协调空间定义为 $\\mathcal{V}^{1} = S^{p-1,p} \\times S^{p,p-1}$。\n\n一个关键信息是基于给定节点矢量结构构建的单变量 B 样条空间维数的关系式：\n次数为 $d$ 的单变量样条空间的维数由以下公式给出：\n$$\n\\text{dim}_{\\text{1D}}(d) = (\\text{节点区间数}) + d\n$$\n对于给定的问题，节点区间数为 $n-p$。因此，次数为 $d$ 的单变量空间的维数为 $(n-p)+d$。\n\n另一个关键定义是次数为 $d$ 的单变量 B 样条跨越重复度为 $m$ 的内部节点的单元间连续性：\n$$\n\\text{连续性} = C^{d-m}\n$$\n\n第 1 部分：$\\mathcal{V}^{1}$ 的初始维数\n\n空间 $\\mathcal{V}^{1}$ 是两个张量积样条空间 $S^{p-1,p}$ 和 $S^{p,p-1}$ 的笛卡尔积。$\\mathcal{V}^{1}$ 的基函数总数（维数）是其分量空间维数之和：\n$$\n\\text{dim}(\\mathcal{V}^{1}) = \\text{dim}(S^{p-1,p}) + \\text{dim}(S^{p,p-1})\n$$\n张量积空间的维数是相应单变量空间维数的乘积。我们使用给定的次数 $p=3$。\n\n对于空间 $S^{p-1,p} = S^{2,3}$：\n$\\xi$ 方向的次数为 $d_{\\xi} = p-1 = 2$。\n$\\eta$ 方向的次数为 $d_{\\eta} = p = 3$。\n节点区间数为 $n-p = n-3$。\n$\\xi$ 方向的单变量空间维数为 $\\text{dim}_{\\text{1D}}(2) = (n-p) + (p-1) = n-1$。\n$\\eta$ 方向的单变量空间维数为 $\\text{dim}_{\\text{1D}}(3) = (n-p) + p = n$。\n因此，张量积空间 $S^{2,3}$ 的维数为：\n$$\n\\text{dim}(S^{2,3}) = (n-1) \\times n = n(n-1)\n$$\n\n对于空间 $S^{p,p-1} = S^{3,2}$：\n$\\xi$ 方向的次数为 $d_{\\xi} = p = 3$。\n$\\eta$ 方向的次数为 $d_{\\eta} = p-1 = 2$。\n$\\xi$ 方向的单变量空间维数为 $\\text{dim}_{\\text{1D}}(3) = (n-p) + p = n$。\n$\\eta$ 方向的单变量空间维数为 $\\text{dim}_{\\text{1D}}(2) = (n-p) + (p-1) = n-1$。\n因此，张量积空间 $S^{3,2}$ 的维数为：\n$$\n\\text{dim}(S^{3,2}) = n \\times (n-1) = n(n-1)\n$$\n\n$\\mathcal{V}^{1}$ 中基函数的总数是其和：\n$$\n\\text{dim}(\\mathcal{V}^{1}) = n(n-1) + n(n-1) = 2n(n-1)\n$$\n这是空间的初始维数。\n\n第 2 部分：初始最小全局连续性\n\n一个向量场 $\\mathbf{v} \\in \\mathcal{V}^{1}$ 可以写为 $\\mathbf{v}(\\xi, \\eta) = (v_1(\\xi, \\eta), v_2(\\xi, \\eta))$，其中 $v_1 \\in S^{p-1, p}$ 且 $v_2 \\in S^{p, p-1}$。向量场 $\\mathbf{v}$ 的全局连续性由其分量跨越所有内部单元边界（节点线）的最低连续性阶数决定。内部节点重复度为 $m=1$。\n\n对于第一个分量，$v_1 \\in S^{p-1,p} = S^{2,3}$：\n跨越内部节点线 $\\xi = \\text{const}$ 的连续性：次数为 $d_{\\xi}=2$。连续性为 $C^{d_{\\xi}-m} = C^{2-1} = C^1$。\n跨越内部节点线 $\\eta = \\text{const}$ 的连续性：次数为 $d_{\\eta}=3$。连续性为 $C^{d_{\\eta}-m} = C^{3-1} = C^2$。\n$v_1$ 的最小连续性为 $C^1$。\n\n对于第二个分量，$v_2 \\in S^{p,p-1} = S^{3,2}$：\n跨越内部节点线 $\\xi = \\text{const}$ 的连续性：次数为 $d_{\\xi}=3$。连续性为 $C^{d_{\\xi}-m} = C^{3-1} = C^2$。\n跨越内部节点线 $\\eta = \\text{const}$ 的连续性：次数为 $d_{\\eta}=2$。连续性为 $C^{d_{\\eta}-m} = C^{2-1} = C^1$。\n$v_2$ 的最小连续性为 $C^1$。\n\n向量场 $\\mathbf{v}$ 的整体全局连续性是其分量连续性的最小值，即 $\\min(C^1, C^1) = C^1$。因此，最小全局单元间连续性阶数为 $1$。\n\n第 3 部分：$k$-细化后的维数\n\n$k$-细化操作将次数增加一，因此新的次数为 $p_{new} = p+1 = 3+1 = 4$。节点区间数和内部重复度保持不变。\n新的旋度协调空间为 $\\mathcal{V}^{1}_{\\text{refined}} = S^{p_{new}-1, p_{new}} \\times S^{p_{new}, p_{new}-1} = S^{3,4} \\times S^{4,3}$。\n我们计算这个新空间的维数。节点区间数仍然是 $n-p = n-3$。\n\n对于空间 $S^{3,4}$：\n$\\xi$ 方向（次数 3）的单变量空间维数为 $(n-p) + p = n$。\n$\\eta$ 方向（次数 4）的单变量空间维数为 $(n-p) + (p+1) = n+1$。\n$S^{3,4}$ 的维数为 $n(n+1)$。\n\n对于空间 $S^{4,3}$：\n$\\xi$ 方向（次数 4）的单变量空间维数为 $(n-p) + (p+1) = n+1$。\n$\\eta$ 方向（次数 3）的单变量空间维数为 $(n-p) + p = n$。\n$S^{4,3}$ 的维数为 $(n+1)n$。\n\n细化后空间的总维数为：\n$$\n\\text{dim}(\\mathcal{V}^{1}_{\\text{refined}}) = n(n+1) + n(n+1) = 2n(n+1)\n$$\n\n第 4 部分：细化后的最小全局连续性\n\n我们现在确定细化后空间 $\\mathcal{V}^{1}_{\\text{refined}} = S^{3,4} \\times S^{4,3}$ 的连续性。新的次数基为 $p_{new}=4$（源于 $p=3$），重复度保持为 $m=1$。设 $\\mathbf{v}_{\\text{refined}} = (v_{1r}, v_{2r})$，其中 $v_{1r} \\in S^{3,4}$ 且 $v_{2r} \\in S^{4,3}$。\n\n对于分量 $v_{1r} \\in S^{3,4}$：\n跨越线 $\\xi = \\text{const}$ 的连续性：次数 $d_\\xi=3$。连续性为 $C^{3-1} = C^2$。\n跨越线 $\\eta = \\text{const}$ 的连续性：次数 $d_\\eta=4$。连续性为 $C^{4-1} = C^3$。\n$v_{1r}$ 的最小连续性为 $C^2$。\n\n对于分量 $v_{2r} \\in S^{4,3}$：\n跨越线 $\\xi = \\text{const}$ 的连续性：次数 $d_\\xi=4$。连续性为 $C^{4-1} = C^3$。\n跨越线 $\\eta = \\text{const}$ 的连续性：次数 $d_\\eta=3$。连续性为 $C^{3-1} = C^2$。\n$v_{2r}$ 的最小连续性为 $C^2$。\n\n细化后向量场的最小全局单元间连续性为 $\\min(C^2, C^2) = C^2$。阶数为 $2$。\n\n总结一下，所要求的四个量是：\n1.  $\\mathcal{V}^{1}$ 的初始维数：$2n(n-1)$\n2.  初始最小全局连续性阶数：$1$\n3.  细化后维数：$2n(n+1)$\n4.  细化后最小全局连续性阶数：$2$\n这些将按要求以行矩阵的形式呈现。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2n(n-1) & 1 & 2n(n+1) & 2\n\\end{pmatrix}\n}\n$$", "id": "3320575"}, {"introduction": "掌握了函数空间的基本构造后，我们转向一个关键的实际问题：如何精确地在计算机中处理这些复杂的函数。本练习聚焦于数值积分，这是将连续的物理定律转化为离散的代数方程的核心步骤。您将通过分析 [@problem_id:3320524] 探索计算单元矩阵所需的求积法则，并理解为何选择正确的积分精度至关重要——这不仅关乎计算的准确性，更直接影响到数值解的稳定性，防止出现非物理的“伪模式”。", "problem": "考虑在三维域上对无源麦克斯韦特征问题进行等几何分析（IGA）离散化，使用由非均匀有理B样条（NURBS）构造的旋度协调样条空间。控制连续特征问题是以下弱形式：求非零的 $\\boldsymbol{u}\\in \\mathbf{H}(\\mathrm{curl},\\Omega)$ 和 $\\lambda\\in\\mathbb{R}$，使得\n$$\n\\int_{\\Omega} \\mu^{-1}\\,\\mathrm{curl}\\,\\boldsymbol{u}\\cdot\\mathrm{curl}\\,\\boldsymbol{v}\\,\\mathrm{d}\\boldsymbol{x}\n= \\lambda \\int_{\\Omega} \\epsilon\\,\\boldsymbol{u}\\cdot\\boldsymbol{v}\\,\\mathrm{d}\\boldsymbol{x}\n\\quad\\text{for all }\\boldsymbol{v}\\in \\mathbf{H}(\\mathrm{curl},\\Omega),\n$$\n其中 $\\epsilon$ 和 $\\mu$ 是正常数材料参数，$\\mathbf{H}(\\mathrm{curl},\\Omega)$ 表示具有平方可积旋度的平方可积向量场空间。在IGA中，几何映射 $\\boldsymbol{F}\\!:\\hat{\\Omega}\\subset\\mathbb{R}^3\\to\\Omega$ 由某个次数的NURBS表示，离散的 $\\mathbf{H}(\\mathrm{curl})$ 空间通过每个参数方向上次数为 $p$ 的张量积NURBS基函数的适当组合，并结合协变Piola变换来构建。\n\n为分析积分精度的目的，假设以下设置：\n- 参数域为 $\\hat{\\Omega}=[0,1]^3$，具有开放、均匀的节点向量，以及每个参数方向上次数为 $p$ 的张量积NURBS基函数。\n- 使用协变Piola变换：$\\boldsymbol{u} = \\boldsymbol{J}^{-T}\\,\\hat{\\boldsymbol{u}}$，其中 $\\boldsymbol{J}=\\nabla_{\\boldsymbol{\\xi}}\\boldsymbol{F}$ 是几何映射的雅可比矩阵，帽子符号表示 $\\hat{\\Omega}$ 上的函数。\n- 考虑两种几何表示情况：(i) 仿射多项式几何映射，即 $\\boldsymbol{J}$ 是常数且所有NURBS权重均为均匀的（因此NURBS基简化为多项式B样条）；(ii) 次数大于一的、带有非均匀NURBS权重的一般多项式几何映射（因此基函数和几何因子是参数坐标的有理函数）。\n- 单元积分为每个参数方向上具有 $q$ 个点的张量积Gauss–Legendre法则。\n\n从一维Gauss–Legendre法则多项式精确性的基本事实出发，即 $q$ 个点可以精确积分任何次数最高为 $2q-1$ 的单变量多项式，并结合多项式次数在乘积和导数下的基本行为，确定下面哪个关于精确积分单元质量和刚度双线性形式所需的最小积分阶数，以及关于欠积分对稳定性和伪特征值的影响的陈述是正确的。\n\nA. 在仿射几何和均匀权重的情况下，质量和刚度双线性形式的被积函数在 $\\hat{\\Omega}$ 上都是多项式。每个参数方向上具有 $q=p+1$ 个点的张量积Gauss–Legendre法则可以精确积分质量和刚度矩阵。如果使用 $q < p+1$ 对质量矩阵进行欠积分，可能会导致质量矩阵秩亏，从而在广义特征值问题中产生伪特征模式。\n\nB. 在仿射几何和均匀权重的情况下，质量双线性形式的被积函数是次数为 $2p$ 的多项式，而刚度双线性形式的被积函数是次数为 $2(p-1)$ 的多项式。因此，每个参数方向上具有 $q=p$ 个点的张量积Gauss–Legendre法则可以精确积分质量和刚度矩阵。欠积分对特征值问题的稳定性没有影响。\n\nC. 在一般NURBS几何的情况下，质量和刚度双线性形式的被积函数在 $\\hat{\\Omega}$ 上都是多项式，因为NURBS基的有理分母被几何变换项抵消了。因此，每个参数方向上具有 $q=p+1$ 个点的张量积Gauss–Legendre法则可以精确积分质量和刚度矩阵。\n\nD. 在一般NURBS几何的情况下，质量和刚度双线性形式的被积函数在 $\\hat{\\Omega}$ 上都是有理函数，因此无法用Gauss–Legendre法则精确积分。然而，为了保持稳定性，必须使用足够高的积分阶数，通常为 $q=2p-1$。如果使用 $q < 2p-1$ 对刚度矩阵进行欠积分，可能会导致刚度矩阵的零空间不正确，从而在特征值问题中产生伪特征模式和体积锁定。", "solution": "### 第1步：提取已知条件\n\n问题陈述提供了以下信息：\n-   **控制问题**：无源麦克斯韦特征问题的弱形式：求非零的 $\\boldsymbol{u}\\in \\mathbf{H}(\\mathrm{curl},\\Omega)$ 和 $\\lambda\\in\\mathbb{R}$，使得\n    $$ \\int_{\\Omega} \\mu^{-1}\\,\\mathrm{curl}\\,\\boldsymbol{u}\\cdot\\mathrm{curl}\\,\\boldsymbol{v}\\,\\mathrm{d}\\boldsymbol{x} = \\lambda \\int_{\\Omega} \\epsilon\\,\\boldsymbol{u}\\cdot\\boldsymbol{v}\\,\\mathrm{d}\\boldsymbol{x} \\quad\\text{for all }\\boldsymbol{v}\\in \\mathbf{H}(\\mathrm{curl},\\Omega) $$\n-   **双线性形式**：\n    -   刚度： $a(\\boldsymbol{u}, \\boldsymbol{v}) = \\int_{\\Omega} \\mu^{-1}\\,\\mathrm{curl}\\,\\boldsymbol{u}\\cdot\\mathrm{curl}\\,\\boldsymbol{v}\\,\\mathrm{d}\\boldsymbol{x}$\n    -   质量： $m(\\boldsymbol{u}, \\boldsymbol{v}) = \\int_{\\Omega} \\epsilon\\,\\boldsymbol{u}\\cdot\\boldsymbol{v}\\,\\mathrm{d}\\boldsymbol{x}$\n-   **离散化**：在三维域 $\\Omega$ 上的等几何分析（IGA）。\n    -   $\\boldsymbol{u}$ 和 $\\boldsymbol{v}$ 的离散空间是一个旋度协调样条空间。\n    -   该空间由参数域 $\\hat{\\Omega} = [0,1]^3$ 上每个参数方向次数为 $p$ 的张量积非均匀有理B样条（NURBS）构造而成。\n    -   几何映射为 $\\boldsymbol{F}\\!:\\hat{\\Omega}\\to\\Omega$。\n    -   向量场从参数域 $\\hat{\\Omega}$ 到物理域 $\\Omega$ 的变换是协变Piola变换：$\\boldsymbol{u} = \\boldsymbol{J}^{-T}\\,\\hat{\\boldsymbol{u}}$，其中 $\\boldsymbol{J}=\\nabla_{\\boldsymbol{\\xi}}\\boldsymbol{F}$ 是映射的雅可比矩阵。\n-   **积分**：\n    -   单元积分为每个参数方向具有 $q$ 个点的张量积Gauss–Legendre法则。\n    -   一个 $q$ 点一维Gauss–Legendre法则可以精确积分任何次数最高为 $2q-1$ 的单变量多项式。\n-   **几何情况**：\n    -   情况(i)：仿射多项式几何和均匀权重。这意味着 $\\boldsymbol{F}$ 是一个线性映射，因此其雅可比矩阵 $\\boldsymbol{J}$ 是一个常数矩阵。NURBS基函数简化为多项式B样条。\n    -   情况(ii)：次数 $>1$ 且具有非均匀权重的一般多项式几何。这意味着 $\\boldsymbol{F}$ 和基函数是参数坐标 $\\boldsymbol{\\xi}$ 的有理函数。\n\n### 第2步：使用提取的已知条件进行验证\n\n问题陈述描述了在使用IGA的高级计算电磁学中一个标准且重要的场景。麦克斯韦特征问题的公式化、$\\mathbf{H}(\\mathrm{curl})$协调空间的使用、Piola变换以及多项式（B样条）和有理（NURBS）情况之间的区别，都是完善且科学上可靠的概念。问题要求分析积分要求以及欠积分的后果，这是有限元分析中的一个关键课题。该问题是自洽的、客观的、适定的，为进行所需分析提供了足够的细节。没有科学或数学上的缺陷。\n\n**结论**：问题有效。\n\n### 第3步：推导与选项分析\n\n我们必须分析当质量和刚度双线性形式被拉回到参数域 $\\hat{\\Omega}$ 时的被积函数。为简单起见，假设材料参数 $\\epsilon$ 和 $\\mu$ 是常数。\n\n微分算子和体积元的变换如下：\n$$ \\mathrm{d}\\boldsymbol{x} = \\det(\\boldsymbol{J})\\,\\mathrm{d}\\boldsymbol{\\xi} $$\n$$ \\boldsymbol{u}(\\boldsymbol{x}) = \\boldsymbol{J}^{-T} \\hat{\\boldsymbol{u}}(\\boldsymbol{\\xi}) $$\n$$ \\mathrm{curl}_{\\boldsymbol{x}} \\boldsymbol{u}(\\boldsymbol{x}) = \\frac{1}{\\det(\\boldsymbol{J})} \\boldsymbol{J} (\\mathrm{curl}_{\\boldsymbol{\\xi}} \\hat{\\boldsymbol{u}}(\\boldsymbol{\\xi})) $$\n\n参数域上的双线性形式变为：\n-   **质量**： $m(\\boldsymbol{u}, \\boldsymbol{v}) = \\int_{\\hat{\\Omega}} \\epsilon\\, (\\boldsymbol{J}^{-T} \\hat{\\boldsymbol{u}}) \\cdot (\\boldsymbol{J}^{-T} \\hat{\\boldsymbol{v}}) \\, \\det(\\boldsymbol{J}) \\,\\mathrm{d}\\boldsymbol{\\xi} = \\int_{\\hat{\\Omega}} \\epsilon\\, \\hat{\\boldsymbol{u}}^T (\\det(\\boldsymbol{J})\\boldsymbol{J}^{-1}\\boldsymbol{J}^{-T}) \\hat{\\boldsymbol{v}} \\,\\mathrm{d}\\boldsymbol{\\xi}$\n-   **刚度**： $a(\\boldsymbol{u}, \\boldsymbol{v}) = \\int_{\\hat{\\Omega}} \\mu^{-1} \\left( \\frac{1}{\\det(\\boldsymbol{J})} \\boldsymbol{J}\\,\\mathrm{curl}_{\\boldsymbol{\\xi}}\\,\\hat{\\boldsymbol{u}} \\right) \\cdot \\left( \\frac{1}{\\det(\\boldsymbol{J})} \\boldsymbol{J}\\,\\mathrm{curl}_{\\boldsymbol{\\xi}}\\,\\hat{\\boldsymbol{v}} \\right) \\det(\\boldsymbol{J}) \\,\\mathrm{d}\\boldsymbol{\\xi} = \\int_{\\hat{\\Omega}} \\mu^{-1} (\\mathrm{curl}_{\\boldsymbol{\\xi}}\\,\\hat{\\boldsymbol{u}})^T \\left(\\frac{\\boldsymbol{J}^T\\boldsymbol{J}}{\\det(\\boldsymbol{J})}\\right) (\\mathrm{curl}_{\\boldsymbol{\\xi}}\\,\\hat{\\boldsymbol{v}}) \\,\\mathrm{d}\\boldsymbol{\\xi}$\n\n**情况(i)：仿射几何和均匀权重（B样条）**\n\n在这种情况下，几何映射 $\\boldsymbol{F}$ 是仿射的，因此雅可比矩阵 $\\boldsymbol{J}$ 是一个常数矩阵。因此，$\\det(\\boldsymbol{J})$、$\\boldsymbol{J}^{-1}$ 以及几何因子 $\\det(\\boldsymbol{J})\\boldsymbol{J}^{-1}\\boldsymbol{J}^{-T}$ 和 $\\frac{\\boldsymbol{J}^T\\boldsymbol{J}}{\\det(\\boldsymbol{J})}$ 都是常数。NURBS基函数是多项式B样条。离散的 $\\mathbf{H}(\\mathrm{curl})$ 空间由次数为 $p$ 的张量积样条构成。一个标准的构造方法（例如，基于有限元外微分，FEEC）产生的基函数 $\\hat{\\boldsymbol{u}}$ 的分量是混合次数的多项式。对于一个基于次数 $p$ 的空间，其分量通常在某些方向上是次数最高为 $p$ 的多项式，在其他方向上是 $p-1$。\n\n-   **质量被积函数**：被积函数是两个基函数分量 $\\hat{u}_i \\hat{v}_i$ 的乘积，再乘以常数。最高多项式次数出现在，例如，当变量 $\\xi_k$ 中一个次数为 $p$ 的分量被平方时。这会产生一个在 $\\xi_k$ 上次数为 $2p$ 的多项式。要使张量积积分法则精确，它必须在每个方向上都精确。要用 $q$ 个Gauss点精确积分一个次数为 $2p$ 的单变量多项式，我们需要 $2q-1 \\ge 2p$，这意味着 $q \\ge p + 1/2$。由于 $q$ 必须是整数，所以最小值是 $q=p+1$。\n\n-   **刚度被积函数**：被积函数涉及 $\\mathrm{curl}_{\\boldsymbol{\\xi}}\\,\\hat{\\boldsymbol{u}}$ 和 $\\mathrm{curl}_{\\boldsymbol{\\xi}}\\,\\hat{\\boldsymbol{v}}$ 分量的乘积。一个次数为 $d$ 的样条的导数是一个次数为 $d-1$ 的样条。$\\mathrm{curl}_{\\boldsymbol{\\xi}}\\,\\hat{\\boldsymbol{u}}$ 的分量是由 $\\hat{\\boldsymbol{u}}$ 分量的导数构成的。让我们考虑 $\\mathrm{curl}_{\\boldsymbol{\\xi}}\\,\\hat{\\boldsymbol{u}}$ 的一个分量，例如 $(\\mathrm{curl}_{\\boldsymbol{\\xi}}\\,\\hat{\\boldsymbol{u}})_2 = \\partial_{\\xi_3} \\hat{u}_1 - \\partial_{\\xi_1} \\hat{u}_3$。在一个标准构造中，$\\hat{u}_1$ 在 $\\xi_1$ 中的次数可能是 $p$，在 $\\xi_2, \\xi_3$ 中的次数可能是 $p-1$。那么 $\\partial_{\\xi_3} \\hat{u}_1$ 在 $\\xi_1$ 中的次数是 $p$，在 $\\xi_2$ 中是 $p-1$，在 $\\xi_3$ 中是 $p-2$。刚度被积函数中的项 $(\\partial_{\\xi_3} \\hat{u}_1)^2$ 在 $\\xi_1$ 中的次数将是 $2p$。因此，刚度被积函数中最高的单变量多项式次数也是 $2p$。这同样需要 $2q-1 \\ge 2p$，所以 $q=p+1$。\n\n-   **仿射情况的结论**：质量和刚度矩阵都需要每个方向上具有 $q=p+1$ 个点的积分法则才能实现精确积分。\n\n-   **欠积分的后果**：麦克斯韦特征问题有一个与梯度场对应的无限维零空间（对于 $\\lambda=0$）。一个稳定的数值离散化必须正确地捕捉这个零空间。稳定性依赖于一个离散的inf-sup条件，这与离散紧性的性质有关。质量矩阵定义了离散空间上的内积。如果它被欠积分（即，如果 $q < p+1$），它可能变得秩亏。这意味着存在非零的离散场 $\\hat{\\boldsymbol{u}}_h$ 使得 $\\int \\hat{\\boldsymbol{u}}_h \\cdot \\hat{\\boldsymbol{u}}_h$ 的数值计算结果为零。这些非物理的零能模式可以污染广义特征值问题的谱，产生伪特征模式。因此，对质量矩阵进行精确积分对于稳定性至关重要。\n\n**选项 A 分析**：与我们的推导完全一致。\n\n**选项 B 分析**：声称刚度被积函数的次数为 $2(p-1)$，因此 $q=p$ 就足够了。这忽略了在旋度协调空间中，导数不会在所有方向上都降低多项式次数的可能性。它还错误地声称欠积分没有影响。因此，B是错误的。\n\n**情况(ii)：一般NURBS几何**\n\n在这种情况下，$\\boldsymbol{J}$ 是有理函数，基函数 $\\hat{\\boldsymbol{u}}$ 也是有理函数。因此，质量和刚度双线性形式的被积函数都是有理函数。它们通常无法用任何阶数的Gauss–Legendre法则精确积分。需要使用足够高的阶数以达到所需的精度。\n\n**选项 C 分析**：声称被积函数是多项式。这是错误的。NURBS的有理性质会传递给被积函数。\n\n**选项 D 分析**：正确地指出被积函数是有理的。然而，它声称需要 $q=2p-1$ 才能保持稳定，并且将欠积分与体积锁定联系起来。虽然需要足够高的阶数，但并没有一个通用的魔法数字。体积锁定是与弹性力学中（通常）欠积分的刚度矩阵相关联的现象，而伪特征模式更多地与欠积分的质量矩阵相关。因此，D的推理是混乱和不准确的。\n\n**最终结论**：选项 A 最准确地描述了仿射情况下的积分要求及其对稳定性的影响。", "answer": "$$\\boxed{A}$$", "id": "3320524"}, {"introduction": "现在，是时候将所有理论知识付诸实践了！这个综合性练习 [@problem_id:3320548] 将引导您完成一个核心的计算任务：为一个几何形状任意弯曲的NURBS单元组装“旋度-旋度”刚度矩阵。您将亲手编写代码，处理从几何映射、雅可比矩阵计算到在数值积分点上评估基函数旋度的完整流程。完成这项练习后，您将对等几何分析代码的内部工作原理有一个具体而深入的理解，并能体会到几何扭曲对计算结果的影响。", "problem": "设 $\\Omega \\subset \\mathbb{R}^3$ 是参考参数域 $\\widehat{\\Omega} = [0,1]^3$ 在一个三变量非均匀有理B样条（NURBS）映射 $\\boldsymbol{\\Phi} : \\widehat{\\Omega} \\to \\Omega$ 下的像。考虑来自频域麦克斯韦方程变分形式的旋度-旋度双线性形式 $a(\\mathbf{u},\\mathbf{v}) = \\int_{\\Omega} (\\nabla \\times \\mathbf{u}) \\cdot (\\nabla \\times \\mathbf{v}) \\, d\\mathbf{x}$，该形式使用等几何旋度协调样条空间进行离散，并令 $K_{ab}$ 表示与基函数 $\\mathbf{N}_a$ 和 $\\mathbf{N}_b$ 相关的刚度矩阵项。使用 H(curl)-协调空间的协变 Piola 变换，映射后的旋度变换为 $\\nabla \\times \\mathbf{u} = \\dfrac{1}{J} \\mathbf{D}\\boldsymbol{\\Phi} \\, (\\widehat{\\nabla} \\times \\widehat{\\mathbf{u}})$，其中 $\\mathbf{D}\\boldsymbol{\\Phi}$ 是 $\\boldsymbol{\\Phi}$ 的雅可比矩阵，$J = \\det(\\mathbf{D}\\boldsymbol{\\Phi})$，$\\widehat{\\nabla}$ 表示关于参数坐标的微分。因此，在 $\\widehat{\\Omega}$ 上计算的单元刚度项满足\n$$\nK_{ab} = \\int_{\\widehat{\\Omega}} \\frac{1}{J(\\boldsymbol{\\xi})} \\left[ \\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}_a(\\boldsymbol{\\xi}) \\right]^{\\top} \\left[ \\mathbf{D}\\boldsymbol{\\Phi}(\\boldsymbol{\\xi})^{\\top} \\mathbf{D}\\boldsymbol{\\Phi}(\\boldsymbol{\\xi}) \\right] \\left[ \\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}_b(\\boldsymbol{\\xi}) \\right] \\, d\\boldsymbol{\\xi},\n$$\n其中 $\\boldsymbol{\\xi} = (\\xi,\\eta,\\zeta)$。\n\n你的任务是使用高斯求积法计算单个弯曲六面体 NURBS 补片的映射旋度-旋度刚度矩阵的选定项，并通过求积点上的最大雅可比条件数来分析其对几何扭曲的敏感性。\n\n几何与映射：\n- 该 NURBS 体在每个参数方向上的次数均为 $2$，具有开放均匀节点向量 $\\Xi = [0,0,0,1,1,1]$，$\\mathcal{H} = [0,0,0,1,1,1]$ 和 $\\mathcal{Z} = [0,0,0,1,1,1]$。相应的一维 $2$ 次 B 样条基等于 $2$ 次 Bernstein 多项式：$B_0^2(t) = (1-t)^2$, $B_1^2(t) = 2t(1-t)$, $B_2^2(t) = t^2$，其导数为 $B_0^{2\\,\\prime}(t) = -2(1-t)$，$B_1^{2\\,\\prime}(t) = 2(1-2t)$，$B_2^{2\\,\\prime}(t) = 2t$。\n- 三变量 NURBS 基为 $R_{ijk}(\\xi,\\eta,\\zeta) = \\dfrac{w_{ijk} B_i^2(\\xi) B_j^2(\\eta) B_k^2(\\zeta)}{\\sum_{p=0}^2\\sum_{q=0}^2\\sum_{r=0}^2 w_{pqr} B_p^2(\\xi) B_q^2(\\eta) B_r^2(\\zeta)}$，其中权 $w_{ijk} > 0$，控制点为 $\\mathbf{P}_{ijk} \\in \\mathbb{R}^3$。映射为 $\\boldsymbol{\\Phi}(\\xi,\\eta,\\zeta) = \\sum_{i,j,k=0}^2 \\mathbf{P}_{ijk} R_{ijk}(\\xi,\\eta,\\zeta)$。\n- 雅可比矩阵为 $\\mathbf{D}\\boldsymbol{\\Phi} = \\left[ \\dfrac{\\partial \\boldsymbol{\\Phi}}{\\partial \\xi} \\ \\dfrac{\\partial \\boldsymbol{\\Phi}}{\\partial \\eta} \\ \\dfrac{\\partial \\boldsymbol{\\Phi}}{\\partial \\zeta} \\right]$，其中每一列通过使用商法则对 $R_{ijk}$ 进行有理求导来计算，且 $J = \\det(\\mathbf{D}\\boldsymbol{\\Phi})$。几何敏感性通过在求积点计算的谱条件数 $\\kappa(\\mathbf{D}\\boldsymbol{\\Phi})$ 来量化，我们报告 $\\max \\kappa(\\mathbf{D}\\boldsymbol{\\Phi})$。\n\n离散 $H(\\mathrm{curl})$ 基：\n- 遵循张量积边空间范式，在 $\\widehat{\\Omega}$ 上构造三个参数化旋度协调基函数，其在与边方向正交的方向上次数减一：\n  1. $\\widehat{\\mathbf{N}}^{(\\xi)}(\\xi,\\eta,\\zeta) = \\left[ B_1^2(\\xi) \\, B_1^1(\\eta) \\, B_1^1(\\zeta), \\ 0, \\ 0 \\right]^{\\top}$,\n  2. $\\widehat{\\mathbf{N}}^{(\\eta)}(\\xi,\\eta,\\zeta) = \\left[ 0, \\ B_1^1(\\xi) \\, B_1^2(\\eta) \\, B_1^1(\\zeta), \\ 0 \\right]^{\\top}$,\n  3. $\\widehat{\\mathbf{N}}^{(\\zeta)}(\\xi,\\eta,\\zeta) = \\left[ 0, \\ 0, \\ B_1^1(\\xi) \\, B_1^1(\\eta) \\, B_1^2(\\zeta) \\right]^{\\top}$,\n  其中一维 $1$ 次开放均匀基为 $B_0^1(t) = 1 - t$, $B_1^1(t) = t$，其导数为 $B_0^{1\\,\\prime}(t) = -1$, $B_1^{1\\,\\prime}(t) = 1$。\n- 参数旋度按分量计算 $\\widehat{\\nabla} \\times \\widehat{\\mathbf{v}} = \\left[ \\dfrac{\\partial \\widehat{v}_z}{\\partial \\eta} - \\dfrac{\\partial \\widehat{v}_y}{\\partial \\zeta}, \\ \\dfrac{\\partial \\widehat{v}_x}{\\partial \\zeta} - \\dfrac{\\partial \\widehat{v}_z}{\\partial \\xi}, \\ \\dfrac{\\partial \\widehat{v}_y}{\\partial \\xi} - \\dfrac{\\partial \\widehat{v}_x}{\\partial \\eta} \\right]^{\\top}$，对于上述基，这简化为\n  $\\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}^{(\\xi)} = \\left[ 0, \\ \\dfrac{\\partial f}{\\partial \\zeta}, \\ -\\dfrac{\\partial f}{\\partial \\eta} \\right]^{\\top}$，其中 $f = B_1^2(\\xi) B_1^1(\\eta) B_1^1(\\zeta)$，\n  $\\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}^{(\\eta)} = \\left[ -\\dfrac{\\partial g}{\\partial \\zeta}, \\ 0, \\ \\dfrac{\\partial g}{\\partial \\xi} \\right]^{\\top}$，其中 $g = B_1^1(\\xi) B_1^2(\\eta) B_1^1(\\zeta)$，\n  以及 $\\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}^{(\\zeta)} = \\left[ \\dfrac{\\partial h}{\\partial \\eta}, \\ -\\dfrac{\\partial h}{\\partial \\xi}, \\ 0 \\right]^{\\top}$，其中 $h = B_1^1(\\xi) B_1^1(\\eta) B_1^2(\\zeta)$。\n\n数值积分：\n- 在 $[0,1]$ 上使用每个方向 $4$ 个点的张量积高斯-勒让德求积法，即 $4 \\times 4 \\times 4$ 个点。一维节点和权重通过 $t = \\dfrac{s+1}{2}$ 和 $w_t = \\dfrac{w_s}{2}$ 从 $[-1,1]$ 映射到 $[0,1]$，并通过张量积组合。在求积点 $\\boldsymbol{\\xi}$ 处，$K_{ab}$ 的被积函数是 $(1/J) \\, \\mathbf{c}_a^{\\top} \\, \\mathbf{G} \\, \\mathbf{c}_b$，其中 $\\mathbf{c}_a = \\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}_a$，$\\mathbf{G} = \\mathbf{D}\\boldsymbol{\\Phi}^{\\top} \\mathbf{D}\\boldsymbol{\\Phi}$，以及 $J = \\det(\\mathbf{D}\\boldsymbol{\\Phi})$。\n\n几何扭曲模型：\n- 通过 $\\mathbf{P}_{ijk}^{\\mathrm{base}} = \\left( u_i, v_j, w_k \\right)$ 定义基础控制点坐标，其中 $u_i = [0, \\tfrac{1}{2}, 1]_i$, $v_j = [0, \\tfrac{1}{2}, 1]_j$, $w_k = [0, \\tfrac{1}{2}, 1]_k$，以及基础权重 $w_{ijk} = 1$。\n- 引入一个扭曲振幅 $\\delta \\ge 0$ 和一个中心权重因子 $\\omega_{\\mathrm{c}} \\ge 1$。对于每个控制点，令 $s(i,j,k)$ 为等于 $1$ 的索引计数，并定义一个偏移向量 $\\boldsymbol{d} = \\delta \\, \\dfrac{s(i,j,k)}{3} \\, [0.2, -0.1, 0.15]^{\\top}$。将扭曲后的控制点设置为 $\\mathbf{P}_{ijk} = \\mathbf{P}_{ijk}^{\\mathrm{base}} + \\boldsymbol{d}$。通过 $w_{ijk} = 1 + (\\omega_{\\mathrm{c}} - 1) \\times \\alpha(s)$ 定义权重，其中 $\\alpha(3)=1$, $\\alpha(2)=0.5$, $\\alpha(1)=0.25$ 且 $\\alpha(0)=0$。\n\n任务：\n1. 实现上述几何和基，并使用在 $[0,1]^3$ 上的 $4 \\times 4 \\times 4$ 高斯求积法，计算与 $\\{\\widehat{\\mathbf{N}}^{(\\xi)}, \\widehat{\\mathbf{N}}^{(\\eta)}, \\widehat{\\mathbf{N}}^{(\\zeta)}\\}$ 中的对相应的，具有项 $K_{11}, K_{22}, K_{33}, K_{12}, K_{13}, K_{23}$ 的 $3 \\times 3$ 刚度子矩阵。\n2. 在每个求积点，计算雅可比矩阵 $\\mathbf{D}\\boldsymbol{\\Phi}$、其行列式 $J$ 及其谱条件数 $\\kappa(\\mathbf{D}\\boldsymbol{\\Phi})$。报告所有求积点中的最大条件数 $\\max \\kappa(\\mathbf{D}\\boldsymbol{\\Phi})$。\n3. 通过运行下面的测试套件，评估刚度项对几何扭曲的敏感性。\n\n测试套件：\n- 情况 A (无扭曲): $\\delta = 0.0$，$\\omega_{\\mathrm{c}} = 1.0$。\n- 情况 B (中度扭曲): $\\delta = 0.12$，$\\omega_{\\mathrm{c}} = 2.0$。\n- 情况 C (强扭曲): $\\delta = 0.25$，$\\omega_{\\mathrm{c}} = 4.0$。\n\n对于每种情况，计算并返回列表 $[K_{11}, K_{22}, K_{33}, K_{12}, K_{13}, K_{23}, \\max \\kappa(\\mathbf{D}\\boldsymbol{\\Phi})]$，其中所有量都是无量纲实数。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含结果，格式为一个逗号分隔的列表，包含三个情况的结果，每个情况都是一个包含七个浮点数的列表，用方括号括起来。例如：$[[r_{A,1},\\dots,r_{A,7}],[r_{B,1},\\dots,r_{B,7}],[r_{C,1},\\dots,r_{C,7}]]$。不应打印其他文本。", "solution": "用户提供的问题被评估为有效，具有科学合理性、良定性及完整性。它构成了计算电磁学领域中等几何分析内一个明确定义的计算任务。将提供完整的解决方案，随后附上 Python 实现。\n\n问题要求计算单个非均匀有理B样条（NURBS）单元的旋度-旋度刚度矩阵的选定项，并分析其几何敏感性。刚度矩阵项 $K_{ab}$ 是离散化双线性形式 $a(\\mathbf{u},\\mathbf{v}) = \\int_{\\Omega} (\\nabla \\times \\mathbf{u}) \\cdot (\\nabla \\times \\mathbf{v}) \\, d\\mathbf{x}$ 的分量。使用协变 Piola 变换，此积分被拉回到参数参考域 $\\widehat{\\Omega} = [0,1]^3$，得到：\n$$\nK_{ab} = \\int_{\\widehat{\\Omega}} \\frac{1}{J(\\boldsymbol{\\xi})} \\left[ \\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}_a(\\boldsymbol{\\xi}) \\right]^{\\top} \\left[ \\mathbf{D}\\boldsymbol{\\Phi}(\\boldsymbol{\\xi})^{\\top} \\mathbf{D}\\boldsymbol{\\Phi}(\\boldsymbol{\\xi}) \\right] \\left[ \\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}_b(\\boldsymbol{\\xi}) \\right] \\, d\\boldsymbol{\\xi}\n$$\n此处，$\\widehat{\\mathbf{N}}_a$ 是参数基函数，$\\boldsymbol{\\Phi}$ 是从参数空间到物理空间的 NURBS 映射，$\\mathbf{D}\\boldsymbol{\\Phi}$ 是其雅可比矩阵，$J = \\det(\\mathbf{D}\\boldsymbol{\\Phi})$ 是雅可比行列式。项 $\\mathbf{G}(\\boldsymbol{\\xi}) = \\mathbf{D}\\boldsymbol{\\Phi}(\\boldsymbol{\\xi})^{\\top} \\mathbf{D}\\boldsymbol{\\Phi}(\\boldsymbol{\\xi})$ 是映射的第一基本形式，或称度量张量。\n\n解决方案通过以下步骤实现：\n\n1.  **数值积分**：使用 $4 \\times 4 \\times 4$ 张量积高斯-勒让德求积法则在参考立方体 $[0,1]^3$ 上近似该积分。标准的高斯-勒让德节点 $s_i$ 和权重 $w_{s,i}$ 在 $[-1,1]$ 上通过 $\\xi_i = (s_i+1)/2$ 和 $w_{\\xi,i} = w_{s,i}/2$ 映射到 $[0,1]$。然后，该积分被近似为对 $4^3=64$ 个求积点 $\\boldsymbol{\\xi}_q$ 的带权 $W_q$ 的和：\n    $$\n    K_{ab} \\approx \\sum_{q=1}^{64} W_q \\frac{1}{J(\\boldsymbol{\\xi}_q)} \\left[ \\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}_a(\\boldsymbol{\\xi}_q) \\right]^{\\top} \\mathbf{G}(\\boldsymbol{\\xi}_q) \\left[ \\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}_b(\\boldsymbol{\\xi}_q) \\right]\n    $$\n\n2.  **基函数和参数旋度**：问题指定了在 $[0,1]$ 上的 1 次和 2 次开放 B 样条基，它们等价于 Bernstein 多项式。\n    -   1 次：$B_0^1(t) = 1-t$, $B_1^1(t) = t$。其导数为 $B_0^{1\\,\\prime}(t) = -1$, $B_1^{1\\,\\prime}(t) = 1$。\n    -   2 次：$B_0^2(t) = (1-t)^2$, $B_1^2(t) = 2t(1-t)$, $B_2^2(t) = t^2$。其导数为 $B_0^{2\\,\\prime}(t) = -2(1-t)$, $B_1^{2\\,\\prime}(t) = 2(1-2t)$, $B_2^{2\\,\\prime}(t) = 2t$。\n    \n    参数域上的三个旋度协调基函数是张量积。它们的旋度，记为 $\\mathbf{c}_a(\\boldsymbol{\\xi}) = \\widehat{\\nabla} \\times \\widehat{\\mathbf{N}}_a(\\boldsymbol{\\xi})$，必须在每个求积点 $\\boldsymbol{\\xi}_q = (\\xi_q, \\eta_q, \\zeta_q)$ 处进行评估。\n    -   对于 $\\widehat{\\mathbf{N}}^{(\\xi)} = [B_1^2(\\xi) B_1^1(\\eta) B_1^1(\\zeta), 0, 0]^\\top$，其旋度为 $\\mathbf{c}^{(\\xi)} = [0, \\frac{\\partial \\widehat{N}_x}{\\partial \\zeta}, -\\frac{\\partial \\widehat{N}_x}{\\partial \\eta}]^\\top$：\n        $$ \\mathbf{c}^{(\\xi)} = [0, \\ B_1^2(\\xi) B_1^1(\\eta) B_1^{1\\,\\prime}(\\zeta), \\ -B_1^2(\\xi) B_1^{1\\,\\prime}(\\eta) B_1^1(\\zeta)]^\\top $$\n    -   对于 $\\widehat{\\mathbf{N}}^{(\\eta)} = [0, B_1^1(\\xi) B_1^2(\\eta) B_1^1(\\zeta), 0]^\\top$，其旋度为 $\\mathbf{c}^{(\\eta)} = [-\\frac{\\partial \\widehat{N}_y}{\\partial \\zeta}, 0, \\frac{\\partial \\widehat{N}_y}{\\partial \\xi}]^\\top$：\n        $$ \\mathbf{c}^{(\\eta)} = [-B_1^1(\\xi) B_1^2(\\eta) B_1^{1\\,\\prime}(\\zeta), \\ 0, \\ B_1^{1\\,\\prime}(\\xi) B_1^2(\\eta) B_1^1(\\zeta)]^\\top $$\n    -   对于 $\\widehat{\\mathbf{N}}^{(\\zeta)} = [0, 0, B_1^1(\\xi) B_1^1(\\eta) B_1^2(\\zeta)]^\\top$，其旋度为 $\\mathbf{c}^{(\\zeta)} = [\\frac{\\partial \\widehat{N}_z}{\\partial \\eta}, -\\frac{\\partial \\widehat{N}_z}{\\partial \\xi}, 0]^\\top$：\n        $$ \\mathbf{c}^{(\\zeta)} = [B_1^1(\\xi) B_1^{1\\,\\prime}(\\eta) B_1^2(\\zeta), \\ -B_1^{1\\,\\prime}(\\xi) B_1^1(\\eta) B_1^2(\\zeta), \\ 0]^\\top $$\n    \n3.  **NURBS 几何与雅可比矩阵**：对于由扭曲振幅 $\\delta$ 和中心权重 $\\omega_c$ 定义的每个测试用例，首先确定 $3 \\times 3 \\times 3$ 的控制点集 $\\mathbf{P}_{ijk}$ 和权重 $w_{ijk}$。映射为 $\\boldsymbol{\\Phi}(\\boldsymbol{\\xi}) = \\mathbf{A}(\\boldsymbol{\\xi}) / W(\\boldsymbol{\\xi})$，其中：\n    $$\n    \\mathbf{A}(\\boldsymbol{\\xi}) = \\sum_{i,j,k=0}^2 w_{ijk} \\mathbf{P}_{ijk} B_i^2(\\xi) B_j^2(\\eta) B_k^2(\\zeta), \\quad W(\\boldsymbol{\\xi}) = \\sum_{i,j,k=0}^2 w_{ijk} B_i^2(\\xi) B_j^2(\\eta) B_k^2(\\zeta)\n    $$\n    雅可比矩阵 $\\mathbf{D}\\boldsymbol{\\Phi} = [\\frac{\\partial \\boldsymbol{\\Phi}}{\\partial \\xi}, \\frac{\\partial \\boldsymbol{\\Phi}}{\\partial \\eta}, \\frac{\\partial \\boldsymbol{\\Phi}}{\\partial \\zeta}]$ 的各列是使用有理函数的商法则计算的。例如，关于 $\\xi$ 的导数为：\n    $$\n    \\frac{\\partial \\boldsymbol{\\Phi}}{\\partial \\xi} = \\frac{1}{W(\\boldsymbol{\\xi})} \\left( \\frac{\\partial \\mathbf{A}}{\\partial \\xi} - \\boldsymbol{\\Phi}(\\boldsymbol{\\xi}) \\frac{\\partial W}{\\partial \\xi} \\right)\n    $$\n    其中 $\\mathbf{A}$ 和 $W$ 的导数涉及 B 样条基函数的导数。\n\n4.  **组装与敏感性分析**：主要的计算循环遍历求积点。在每个点 $\\boldsymbol{\\xi}_q$：\n    -   评估三个旋度向量 $\\mathbf{c}^{(\\xi)}, \\mathbf{c}^{(\\eta)}, \\mathbf{c}^{(\\zeta)}$。\n    -   计算雅可比矩阵 $\\mathbf{D}\\boldsymbol{\\Phi}(\\boldsymbol{\\xi}_q)$，以及其行列式 $J$ 和度量张量 $\\mathbf{G}$。\n    -   计算谱条件数 $\\kappa(\\mathbf{D}\\boldsymbol{\\Phi}) = \\|\\mathbf{D}\\boldsymbol{\\Phi}\\|_2 \\|\\mathbf{D}\\boldsymbol{\\Phi}^{-1}\\|_2$，并跟踪所有求积点中的最大值。\n    -   对每对基函数 $(a,b)$ 计算被积函数，加权并加到相应的刚度矩阵项 $K_{ab}$ 中。\n\n循环结束后，收集 $3 \\times 3$ 刚度矩阵的上三角项 $\\{K_{11}, K_{22}, K_{33}, K_{12}, K_{13}, K_{23}\\}$ 和最大条件数。对指定的三个测试用例中的每一个重复此过程。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes curl-curl stiffness matrix entries and geometric sensitivity for a\n    distorted NURBS element in an isogeometric analysis context.\n    \"\"\"\n\n    # --- Part A: Basis Functions and Derivatives ---\n    B0_1, B1_1 = (lambda t: 1 - t), (lambda t: t)\n    B0_1_p, B1_1_p = (lambda t: -1.0), (lambda t: 1.0)\n    \n    B0_2, B1_2, B2_2 = (lambda t: (1 - t)**2), (lambda t: 2 * t * (1 - t)), (lambda t: t**2)\n    B0_2_p, B1_2_p, B2_2_p = (lambda t: -2 * (1 - t)), (lambda t: 2 * (1 - 2 * t)), (lambda t: 2 * t)\n    \n    B2_funcs = [B0_2, B1_2, B2_2]\n    B2_p_funcs = [B0_2_p, B1_2_p, B2_2_p]\n\n    # --- Part B: Parametric H(curl) Basis Curls ---\n    def eval_curl_basis_curls(xi, eta, zeta):\n        # Curl of basis function N^(xi)\n        c_xi = np.array([\n            0.0,\n            B1_2(xi) * B1_1(eta) * B1_1_p(zeta),\n            -B1_2(xi) * B1_1_p(eta) * B1_1(zeta)\n        ])\n        # Curl of basis function N^(eta)\n        c_eta = np.array([\n            -B1_1(xi) * B1_2(eta) * B1_1_p(zeta),\n            0.0,\n            B1_1_p(xi) * B1_2(eta) * B1_1(zeta)\n        ])\n        # Curl of basis function N^(zeta)\n        c_zeta = np.array([\n            B1_1(xi) * B1_1_p(eta) * B1_2(zeta),\n            -B1_1_p(xi) * B1_1(eta) * B1_2(zeta),\n            0.0\n        ])\n        return [c_xi, c_eta, c_zeta]\n\n    # --- Part C: Geometry Model and Jacobian Evaluation ---\n    def get_geom_params(delta, omega_c):\n        coords = [0.0, 0.5, 1.0]\n        P = np.zeros((3, 3, 3, 3))\n        w = np.zeros((3, 3, 3))\n        alpha_map = {0: 0.0, 1: 0.25, 2: 0.5, 3: 1.0}\n        d_vec = delta * np.array([0.2, -0.1, 0.15]) / 3.0\n\n        for i, j, k in np.ndindex(3, 3, 3):\n            P[i, j, k, :] = [coords[i], coords[j], coords[k]]\n            s = (i == 1) + (j == 1) + (k == 1)\n            P[i, j, k, :] += s * d_vec\n            w[i, j, k] = 1.0 + (omega_c - 1.0) * alpha_map[s]\n        return P, w\n\n    def eval_jacobian(xi, eta, zeta, P, w):\n        b_xi = np.array([f(xi) for f in B2_funcs])\n        b_eta = np.array([f(eta) for f in B2_funcs])\n        b_zeta = np.array([f(zeta) for f in B2_funcs])\n        db_xi = np.array([f(xi) for f in B2_p_funcs])\n        db_eta = np.array([f(eta) for f in B2_p_funcs])\n        db_zeta = np.array([f(zeta) for f in B2_p_funcs])\n\n        B = np.einsum('i,j,k->ijk', b_xi, b_eta, b_zeta)\n        B_dxi = np.einsum('i,j,k->ijk', db_xi, b_eta, b_zeta)\n        B_deta = np.einsum('i,j,k->ijk', b_xi, db_eta, b_zeta)\n        B_dzeta = np.einsum('i,j,k->ijk', b_xi, b_eta, db_zeta)\n    \n        W_val = np.sum(w * B)\n        dW_dxi = np.sum(w * B_dxi)\n        dW_deta = np.sum(w * B_deta)\n        dW_dzeta = np.sum(w * B_dzeta)\n\n        wP = w[..., np.newaxis] * P\n        A_val = np.sum(wP * B[..., np.newaxis], axis=(0, 1, 2))\n        dA_dxi = np.sum(wP * B_dxi[..., np.newaxis], axis=(0, 1, 2))\n        dA_deta = np.sum(wP * B_deta[..., np.newaxis], axis=(0, 1, 2))\n        dA_dzeta = np.sum(wP * B_dzeta[..., np.newaxis], axis=(0, 1, 2))\n        \n        Phi_val = A_val / W_val\n        dPhi_dxi = (dA_dxi - Phi_val * dW_dxi) / W_val\n        dPhi_deta = (dA_deta - Phi_val * dW_deta) / W_val\n        dPhi_dzeta = (dA_dzeta - Phi_val * dW_dzeta) / W_val\n        \n        return np.stack([dPhi_dxi, dPhi_deta, dPhi_dzeta], axis=1)\n\n    # --- Part D: Main Calculation Loop ---\n    test_cases = [\n        (0.0, 1.0),\n        (0.12, 2.0),\n        (0.25, 4.0)\n    ]\n    all_results = []\n    \n    n_quad = 4\n    q_pts, q_wts = np.polynomial.legendre.leggauss(n_quad)\n    q_pts = (q_pts + 1.0) / 2.0\n    q_wts = q_wts / 2.0\n\n    for delta, omega_c in test_cases:\n        P, w = get_geom_params(delta, omega_c)\n\n        K = np.zeros((3, 3))\n        max_kappa = 0.0\n\n        for i, j, k in np.ndindex(n_quad, n_quad, n_quad):\n            xi, eta, zeta = q_pts[i], q_pts[j], q_pts[k]\n            quad_weight = q_wts[i] * q_wts[j] * q_wts[k]\n        \n            curl_basis_vectors = eval_curl_basis_curls(xi, eta, zeta)\n            DPhi = eval_jacobian(xi, eta, zeta, P, w)\n            \n            J = np.linalg.det(DPhi)\n            if J == 0.0: J = 1e-14\n            \n            G = DPhi.T @ DPhi\n            kappa = np.linalg.cond(DPhi)\n            max_kappa = max(max_kappa, kappa)\n            \n            factor = quad_weight / J\n            for row in range(3):\n                for col in range(row, 3):\n                    c_a, c_b = curl_basis_vectors[row], curl_basis_vectors[col]\n                    integrand_val = c_a.T @ G @ c_b\n                    K[row, col] += integrand_val * factor\n        \n        for row in range(3):\n            for col in range(row + 1, 3):\n                K[col, row] = K[row, col]\n\n        case_results = [\n            K[0, 0], K[1, 1], K[2, 2],\n            K[0, 1], K[0, 2], K[1, 2],\n            max_kappa\n        ]\n        all_results.append(case_results)\n\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "3320548"}]}