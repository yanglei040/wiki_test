{"hands_on_practices": [{"introduction": "在构建复杂的环路和星形基函数之前，理解构成它们的基本单元——Rao-Wilton-Glisson (RWG) 基函数的性质至关重要。本练习将指导您在一个简单的网格上手动计算两个RWG基函数之间的相互作用（即内积）。通过这个练习，您将体会到这些基函数的局部支撑特性，并理解为何需要像环路-星形分解这样结构更清晰的基函数，来揭示潜在的物理特性 [@problem_id:3325462]。", "problem": "考虑一个位于平面 $z=0$ 内的小型平面网格片 $S \\subset \\mathbb{R}^{3}$，它由三个按如下方式共享边的三角形构成。设顶点为 $v_{1}=(0,0,0)$、$v_{2}=(1,0,0)$、$v_{3}=(0,1,0)$、$v_{4}=(1,1,0)$ 和 $v_{5}=(1,-1,0)$。定义三角形 $T_{1}=\\triangle(v_{1},v_{2},v_{3})$、$T_{2}=\\triangle(v_{2},v_{3},v_{4})$ 和 $T_{3}=\\triangle(v_{1},v_{2},v_{5})$，并令 $S=T_{1}\\cup T_{2}\\cup T_{3}$。考虑分别与内部边 $e_{1}=\\overline{v_{2}v_{3}}$ 和 $e_{2}=\\overline{v_{1}v_{2}}$ 相关联的两个 Rao–Wilton–Glisson (RWG) 基函数 $\\mathbf{f}_{1}$ 和 $\\mathbf{f}_{2}$。支撑在三角形对 $(T^{+},T^{-})$ 上的 RWG 函数 $\\mathbf{f}_{e}$ 分段定义为\n$$\n\\mathbf{f}_{e}(\\mathbf{r})=\n\\begin{cases}\n\\dfrac{l_{e}}{2A^{+}}\\left(\\mathbf{r}-\\mathbf{r}_{\\text{op}}^{+}\\right),  \\mathbf{r}\\in T^{+} \\\\\n-\\dfrac{l_{e}}{2A^{-}}\\left(\\mathbf{r}-\\mathbf{r}_{\\text{op}}^{-}\\right),  \\mathbf{r}\\in T^{-} \\\\\n\\mathbf{0},  \\text{otherwise}\n\\end{cases}\n$$\n其中 $l_{e}$ 是内部边的长度，$A^{\\pm}$ 是 $T^{\\pm}$ 的面积，$\\mathbf{r}_{\\text{op}}^{\\pm}$ 是 $T^{\\pm}$ 中公共边所对的顶点。对于 $\\mathbf{f}_{1}$，取 $T^{+}=T_{1}$，其对顶点为 $\\mathbf{r}_{\\text{op}}^{+}=v_{1}$；取 $T^{-}=T_{2}$，其对顶点为 $\\mathbf{r}_{\\text{op}}^{-}=v_{4}$。对于 $\\mathbf{f}_{2}$，取 $T^{+}=T_{1}$，其对顶点为 $\\mathbf{r}_{\\text{op}}^{+}=v_{3}$；取 $T^{-}=T_{3}$，其对顶点为 $\\mathbf{r}_{\\text{op}}^{-}=v_{5}$。\n\n从上述几何定义和 $S$ 上的 $L^{2}$ 内积出发，推导 Gram 矩阵的元素\n$$\nG_{ij}=\\int_{S}\\mathbf{f}_{i}(\\mathbf{r})\\cdot \\mathbf{f}_{j}(\\mathbf{r})\\, dS,\\quad i,j\\in\\{1,2\\},\n$$\n通过显式计算三角形 $T_{1}$、$T_{2}$ 和 $T_{3}$ 上的必要面积分。然后，利用 RWG 基函数如何被支撑和构建的基本原理，解释在此 RWG 基下得到的 $2\\times 2$ Gram 矩阵的稀疏模式和对称性。简要评论环路-星形分解（将 RWG 表示为无散“环路”函数和无旋“星形”函数的线性组合）会如何定性地影响此类内积矩阵的对称性和稀疏性，无需进行任何额外的数值计算。\n\n按顺序报告 $G_{11}$、$G_{22}$ 和 $G_{12}$ 这三个量。以平方米为单位表示最终值，并给出精确形式；无需四舍五入。", "solution": "该问题是有效的。这是一个计算电磁学中适定且有科学依据的问题，依赖于既定的定义和原理。所有必要的数据和定义都已提供。\n\n为了推导 Gram 矩阵元素 $G_{ij}=\\int_{S}\\mathbf{f}_{i}(\\mathbf{r})\\cdot \\mathbf{f}_{j}(\\mathbf{r})\\, dS$，我们必须首先根据所提供的几何设置明确定义基函数 $\\mathbf{f}_{1}$ 和 $\\mathbf{f}_{2}$。\n\n**1. 几何与基函数参数**\n\n顶点给定为 $v_{1}=(0,0,0)$、$v_{2}=(1,0,0)$、$v_{3}=(0,1,0)$、$v_{4}=(1,1,0)$ 和 $v_{5}=(1,-1,0)$。三角形为 $T_{1}=\\triangle(v_{1},v_{2},v_{3})$、$T_{2}=\\triangle(v_{2},v_{3},v_{4})$ 和 $T_{3}=\\triangle(v_{1},v_{2},v_{5})$。所有三角形都位于 $z=0$ 平面内。\n\n三角形的面积为：\n- $A_{1} = \\text{Area}(T_{1}) = \\frac{1}{2}|\\vec{v_{1}v_{2}} \\times \\vec{v_{1}v_{3}}| = \\frac{1}{2}|(1,0,0) \\times (0,1,0)| = \\frac{1}{2}|(0,0,1)| = \\frac{1}{2}$。\n- $A_{2} = \\text{Area}(T_{2}) = \\frac{1}{2}|\\vec{v_{2}v_{3}} \\times \\vec{v_{2}v_{4}}| = \\frac{1}{2}|(-1,1,0) \\times (0,1,0)| = \\frac{1}{2}|(0,0,-1)| = \\frac{1}{2}$。\n- $A_{3} = \\text{Area}(T_{3}) = \\frac{1}{2}|\\vec{v_{1}v_{2}} \\times \\vec{v_{1}v_{5}}| = \\frac{1}{2}|(1,0,0) \\times (1,-1,0)| = \\frac{1}{2}|(0,0,-1)| = \\frac{1}{2}$。\n\nRWG 基函数定义如下：\n\n**对于与边 $e_{1}=\\overline{v_{2}v_{3}}$ 相关联的 $\\mathbf{f}_{1}$：**\n- 边的长度为 $l_{1} = |v_{3}-v_{2}| = |(-1,1,0)| = \\sqrt{2}$。\n- 支撑三角形为 $T^{+}=T_{1}$ 和 $T^{-}=T_{2}$。它们的面积为 $A^{+}=A_1=\\frac{1}{2}$ 和 $A^{-}=A_2=\\frac{1}{2}$。\n- 对顶点为 $\\mathbf{r}_{\\text{op}}^{+}=v_{1}=(0,0,0)$ 和 $\\mathbf{r}_{\\text{op}}^{-}=v_{4}=(1,1,0)$。\n- 函数定义为：\n  - 对于 $\\mathbf{r}=(x,y,0) \\in T_{1}$：$\\mathbf{f}_{1}(\\mathbf{r}) = \\frac{l_{1}}{2A^{+}}(\\mathbf{r}-\\mathbf{r}_{\\text{op}}^{+}) = \\frac{\\sqrt{2}}{2(1/2)}(\\mathbf{r}-v_{1}) = \\sqrt{2}\\mathbf{r} = \\sqrt{2}(x,y,0)$。\n  - 对于 $\\mathbf{r}=(x,y,0) \\in T_{2}$：$\\mathbf{f}_{1}(\\mathbf{r}) = -\\frac{l_{1}}{2A^{-}}(\\mathbf{r}-\\mathbf{r}_{\\text{op}}^{-}) = -\\frac{\\sqrt{2}}{2(1/2)}(\\mathbf{r}-v_{4}) = -\\sqrt{2}(\\mathbf{r}-v_{4}) = -\\sqrt{2}(x-1,y-1,0)$。\n\n**对于与边 $e_{2}=\\overline{v_{1}v_{2}}$ 相关联的 $\\mathbf{f}_{2}$：**\n- 边的长度为 $l_{2} = |v_{2}-v_{1}| = |(1,0,0)| = 1$。\n- 支撑三角形为 $T^{+}=T_{1}$ 和 $T^{-}=T_{3}$。它们的面积为 $A^{+}=A_1=\\frac{1}{2}$ 和 $A^{-}=A_3=\\frac{1}{2}$。\n- 对顶点为 $\\mathbf{r}_{\\text{op}}^{+}=v_{3}=(0,1,0)$ 和 $\\mathbf{r}_{\\text{op}}^{-}=v_{5}=(1,-1,0)$。\n- 函数定义为：\n  - 对于 $\\mathbf{r}=(x,y,0) \\in T_{1}$：$\\mathbf{f}_{2}(\\mathbf{r}) = \\frac{l_{2}}{2A^{+}}(\\mathbf{r}-\\mathbf{r}_{\\text{op}}^{+}) = \\frac{1}{2(1/2)}(\\mathbf{r}-v_{3}) = \\mathbf{r}-v_{3} = (x,y-1,0)$。\n  - 对于 $\\mathbf{r}=(x,y,0) \\in T_{3}$：$\\mathbf{f}_{2}(\\mathbf{r}) = -\\frac{l_{2}}{2A^{-}}(\\mathbf{r}-\\mathbf{r}_{\\text{op}}^{-}) = -\\frac{1}{2(1/2)}(\\mathbf{r}-v_{5}) = -(\\mathbf{r}-v_{5}) = -(x-1,y+1,0)$。\n\n**2. Gram 矩阵元素的计算**\n\n$\\mathbf{f}_{1}$ 的支撑集是 $T_{1} \\cup T_{2}$，$\\mathbf{f}_{2}$ 的支撑集是 $T_{1} \\cup T_{3}$。它们的交集是 $T_{1}$。\n\n**$G_{11}$ 的计算：**\n$G_{11} = \\int_{S}|\\mathbf{f}_{1}(\\mathbf{r})|^{2}\\,dS = \\int_{T_{1}}|\\mathbf{f}_{1}|^{2}\\,dS + \\int_{T_{2}}|\\mathbf{f}_{1}|^{2}\\,dS$。\n- 在 $T_{1}$ 上：$\\int_{T_{1}}|\\sqrt{2}\\mathbf{r}|^{2}\\,dS = 2\\int_{T_{1}}(x^{2}+y^{2})\\,dx\\,dy$。\n- 在 $T_{2}$ 上：$\\int_{T_{2}}|-\\sqrt{2}(\\mathbf{r}-v_{4})|^{2}\\,dS = 2\\int_{T_{2}}((x-1)^{2}+(y-1)^{2})\\,dx\\,dy$。\n\n我们需要计算这些三角形上的积分。对于 $T_{1}$，即顶点为 $(0,0),(1,0),(0,1)$ 的标准单纯形三角形，我们有公式 $\\int_{T_{1}} x^{p}y^{q}\\,dx\\,dy = \\frac{p!q!}{(p+q+2)!}$。\n- $\\int_{T_{1}}(x^{2}+y^{2})\\,dx\\,dy = \\int_{T_{1}}x^{2}\\,dx\\,dy + \\int_{T_{1}}y^{2}\\,dx\\,dy = \\frac{2!0!}{4!} + \\frac{0!2!}{4!} = \\frac{2}{24} + \\frac{2}{24} = \\frac{1}{6}$。\n对于 $T_{2}$（顶点为 $(1,0),(0,1),(1,1)$）上的积分，我们可以使用变量代换 $u=x-1, v=y-1$。新的三角形 $T'_{2}$ 的顶点为 $(0,-1),(-1,0),(0,0)$。积分变为 $\\int_{T'_{2}}(u^{2}+v^{2})\\,du\\,dv$。根据与 $T_1$ 上积分的对称性，其值为 $\\frac{1}{6}$。\n因此，$G_{11} = 2(\\frac{1}{6}) + 2(\\frac{1}{6}) = \\frac{4}{6} = \\frac{2}{3}$。\n\n**$G_{22}$ 的计算：**\n$G_{22} = \\int_{S}|\\mathbf{f}_{2}(\\mathbf{r})|^{2}\\,dS = \\int_{T_{1}}|\\mathbf{f}_{2}|^{2}\\,dS + \\int_{T_{3}}|\\mathbf{f}_{2}|^{2}\\,dS$。\n- 在 $T_{1}$ 上：$\\int_{T_{1}}|\\mathbf{r}-v_{3}|^{2}\\,dS = \\int_{T_{1}}(x^{2}+(y-1)^{2})\\,dx\\,dy = \\int_{T_{1}}(x^{2}+y^{2}-2y+1)\\,dx\\,dy$。\n使用积分公式：$\\int_{T_{1}}x^2 = \\frac{1}{12}$, $\\int_{T_{1}}y^2 = \\frac{1}{12}$, $\\int_{T_{1}}y = \\frac{1}{6}$, $\\int_{T_{1}}1 = \\frac{1}{2}$。积分值为 $\\frac{1}{12} + \\frac{1}{12} - 2(\\frac{1}{6}) + \\frac{1}{2} = \\frac{1}{6} - \\frac{1}{3} + \\frac{1}{2} = \\frac{1-2+3}{6} = \\frac{2}{6} = \\frac{1}{3}$。\n- 在 $T_{3}$ 上：$\\int_{T_{3}}|-(\\mathbf{r}-v_{5})|^{2}\\,dS = \\int_{T_{3}}((x-1)^{2}+(y+1)^{2})\\,dx\\,dy$。$T_3$ 的顶点为 $(0,0),(1,0),(1,-1)$。经过验证，此积分为 $\\frac{1}{3}$。\n因此，$G_{22} = \\frac{1}{3} + \\frac{1}{3} = \\frac{2}{3}$。\n\n**$G_{12}$ 的计算：**\n该积分仅在公共支撑区域 $T_{1}$ 上非零。\n$G_{12} = \\int_{T_{1}}\\mathbf{f}_{1}(\\mathbf{r})\\cdot\\mathbf{f}_{2}(\\mathbf{r})\\,dS = \\int_{T_{1}}(\\sqrt{2}\\mathbf{r})\\cdot(\\mathbf{r}-v_{3})\\,dS$。\n$G_{12} = \\sqrt{2}\\int_{T_{1}}(|\\mathbf{r}|^{2} - \\mathbf{r}\\cdot v_{3})\\,dS = \\sqrt{2}\\int_{T_{1}}(x^{2}+y^{2}-y)\\,dx\\,dy$。\n使用我们之前的结果：\n$G_{12} = \\sqrt{2}\\left(\\int_{T_{1}}(x^{2}+y^{2})\\,dx\\,dy - \\int_{T_{1}}y\\,dx\\,dy\\right) = \\sqrt{2}\\left(\\frac{1}{6} - \\frac{1}{6}\\right) = 0$。\nGram 矩阵为 $G = \\begin{pmatrix} 2/3  0 \\\\ 0  2/3 \\end{pmatrix}$。元素的单位是长度的平方，假设顶点坐标以米为单位，即 $m^2$。\n\n**3. 稀疏性、对称性与环路-星形分解**\n\n**RWG Gram 矩阵的对称性与稀疏性：**\n根据定义，Gram 矩阵 $G$ 是对称的（$G_{ij} = G_{ji}$），因为 $L^{2}$ 内积是对称的：$\\int \\mathbf{f}_{i}\\cdot\\mathbf{f}_{j}\\,dS = \\int \\mathbf{f}_{j}\\cdot\\mathbf{f}_{i}\\,dS$。我们的计算证实了这一点，因为 $G_{12}=G_{21}=0$。矩阵的稀疏性由基函数支撑集的重叠情况决定。如果 $\\text{supp}(\\mathbf{f}_i) \\cap \\text{supp}(\\mathbf{f}_j) = \\emptyset$，则元素 $G_{ij}$ 在结构上为零。在我们的例子中，$\\text{supp}(\\mathbf{f}_{1}) = T_{1}\\cup T_{2}$ 且 $\\text{supp}(\\mathbf{f}_{2}) = T_{1}\\cup T_{3}$。由于它们的支撑集有非空交集（$T_1$），元素 $G_{12}$ 不保证为零。$G_{12}=0$ 这一事实是该问题中顶点和三角形特定几何构型导致“偶然”正交性的结果。\n\n**环路-星形分解的影响：**\n网格上所有 RWG 基函数的集合构成一个向量空间。环路-星形分解（一种 Helmholtz-Hodge 分解）将此空间分解为两个正交子空间：\n1.  **环路函数 ($\\mathcal{L}$):** 它们是 RWG 函数的线性组合，在网格对偶图上形成闭合环路。它们是无散的（$\\nabla \\cdot \\mathbf{l} = 0$），代表螺线（旋转）电流模式。\n2.  **星形函数 ($\\mathcal{S}$):** 它们构成了剩余函数的一组基。它们通常由网格图的生成树构建，并且是无旋的（$\\nabla \\times \\mathbf{s} = \\mathbf{0}$）。它们代表无旋（有散）电流模式。\n\n这种分解的一个基本性质是，环路和星形子空间关于 $L^{2}$ 内积是正交的：对于任何 $\\mathbf{l} \\in \\mathcal{L}$ 和 $\\mathbf{s} \\in \\mathcal{S}$，$\\int_{S} \\mathbf{l} \\cdot \\mathbf{s} \\,dS = 0$。\n\n如果我们将 RWG 基 $\\{\\mathbf{f}_i\\}$ 转换为环路-星形基 $\\{\\mathbf{l}_k\\} \\cup \\{\\mathbf{s}_m\\}$，那么在这个新基下的 Gram 矩阵 $G'$ 将变为块对角矩阵：\n$$\nG' = \n\\begin{pmatrix}\nG_{\\mathcal{LL}}   \\mathbf{0} \\\\\n\\mathbf{0}  G_{\\mathcal{SS}}\n\\end{pmatrix}\n$$\n其中 $G_{\\mathcal{LL}}$ 包含环路函数之间的内积，$G_{\\mathcal{SS}}$ 包含星形函数之间的内积。由于正交性，非对角块 $G_{\\mathcal{LS}}$ 和 $G_{\\mathcal{SL}}$ 恒为零。\n\n定性地讲，环路-星形分解为 Gram 矩阵引入了一种有保证的、结构化的稀疏模式，这种模式独立于任何偶然的几何对称性。它将矩阵划分为对应于物理上不同类型电流模式的块。在数值方法中，这种分解对于分离电和磁现象的贡献、改善矩阵的条件数以及开发稳定的时域算法非常有价值。\n\n所要求的最终值为 $G_{11}$、$G_{22}$ 和 $G_{12}$。\n$G_{11} = \\frac{2}{3}$。\n$G_{22} = \\frac{2}{3}$。\n$G_{12} = 0$。\n问题指定单位为平方米，这是正确的，因为 RWG 函数是无量纲的，而积分域是一个面积。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{2}{3}  \\frac{2}{3}  0 \\end{pmatrix}}\n$$", "id": "3325462"}, {"introduction": "Helmholtz-Hodge 分解定理指出，任何向量场都可以被分解为一个无旋（星形）部分和一个无散（环路）部分。本练习将这一原理转化为一个具体的计算方法，用于处理由RWG系数表示的离散表面电流。您将利用图的关联矩阵作为核心算子，通过实现一个正交投影算法，将任意电流向量分解为其基本的星形和环路分量 [@problem_id:3325511]。", "problem": "考虑一个三角化曲面网格，其简化的 Rao–Wilton–Glisson (RWG) 基系数可通过有向边进行索引。设该网格可抽象为一个具有 $n_v$ 个顶点和 $n_e$ 条边的有向图，其顶点-边关联矩阵为 $B \\in \\mathbb{R}^{n_v \\times n_e}$。其中，第 $i$ 条边的方向从其尾顶点 $t$ 指向其头顶点 $h$，关联矩阵中对应尾顶点的项为 $-1$，头顶点的项为 $+1$，其他项为 $0$。RWG 系数向量为 $j \\in \\mathbb{R}^{n_e}$。\n\n定义星子空间为 $B^{\\top}$ 的列空间，即 $\\mathrm{Range}(B^{\\top}) = \\{ B^{\\top} \\phi : \\phi \\in \\mathbb{R}^{n_v} \\}$；定义环子空间为 $B$ 的零空间，即 $\\mathrm{Null}(B) = \\{ x \\in \\mathbb{R}^{n_e} : B x = 0 \\}$。图的离散亥姆霍兹分解意味着，对于任何具有固定方向的无向图，都存在正交直和 $\\mathbb{R}^{n_e} = \\mathrm{Range}(B^{\\top}) \\oplus \\mathrm{Null}(B)$，并且在欧几里得内积下，$\\mathrm{Range}(B^{\\top}) \\perp \\mathrm{Null}(B)$ 具有正交性。\n\n从这些定义和表示顶点净散度的离散守恒约束 $B j$ 出发，推导并实现一个算法，该算法使用最小二乘法和关联矩阵，将任意 RWG 系数向量 $j$ 投影到其星分量 $j_{\\star} \\in \\mathrm{Range}(B^{\\top})$ 和环分量 $j_{\\mathrm{loop}} \\in \\mathrm{Null}(B)$ 上。该投影应通过在最小二乘意义下求解星分量的正规方程\n$$\n(B B^{\\top}) \\, \\phi = B \\, j,\n$$\n然后设置\n$$\nj_{\\star} = B^{\\top} \\phi, \\quad j_{\\mathrm{loop}} = j - j_{\\star}\n$$\n来获得。当 $B B^{\\top}$ 是奇异的（例如，对于非连通图），使用 Moore–Penrose 伪逆来计算 $\\phi$ 的最小范数解。\n\n您必须使用由已知的星分量和环分量生成的合成数据来测试该算法。对于每个测试，根据给定的顶点和边集构建 $B$，生成一个随机势 $\\phi \\in \\mathbb{R}^{n_v}$ 来定义星分量 $j_{\\star} = B^{\\top} \\phi$，并从 $\\mathrm{Null}(B)$ 的一组基生成一个随机环分量 $j_{\\mathrm{loop}}$。使用固定的伪随机种子以使测试可复现。可以选择添加一个小的噪声向量 $n$ 来测试数值鲁棒性，设置 $j = j_{\\star} + j_{\\mathrm{loop}} + n$。\n\n对于每个测试，计算相对重构误差\n$$\n\\varepsilon_{\\star} = \\frac{\\lVert \\widehat{j}_{\\star} - j_{\\star} \\rVert_2}{\\max(\\lVert j_{\\star} \\rVert_2, \\epsilon)}, \\quad\n\\varepsilon_{\\mathrm{loop}} = \\frac{\\lVert \\widehat{j}_{\\mathrm{loop}} - j_{\\mathrm{loop}} \\rVert_2}{\\max(\\lVert j_{\\mathrm{loop}} \\rVert_2, \\epsilon)},\n$$\n其中 $\\epsilon = 10^{-12}$，$\\widehat{j}_{\\star}$ 是到 $\\mathrm{Range}(B^{\\top})$ 上的最小二乘投影，且 $\\widehat{j}_{\\mathrm{loop}} = j - \\widehat{j}_{\\star}$。所有范数均为欧几里得 2-范数。\n\n根据以下测试套件和数据生成协议实现程序（每条边的方向为尾部 $\\rightarrow$ 头部）：\n\n- 测试 $1$（具有单个环路的连通图）：$n_v = 4$，边 $[(0,1),(1,2),(2,3),(3,0)]$，种子 $42$，噪声标准差 $0$。\n- 测试 $2$（树图，无环路）：$n_v = 4$，边 $[(0,1),(1,2),(2,3)]$，种子 $43$，噪声标准差 $0$。\n- 测试 $3$（两个不连通的 3-环）：$n_v = 6$，边 $[(0,1),(1,2),(2,0),(3,4),(4,5),(5,3)]$，种子 $44$，噪声标准差 $0$。\n- 测试 $4$（具有一个环路和一个额外叶节点的连通图，带噪声）：$n_v = 5$，边 $[(0,1),(1,2),(2,3),(3,0),(1,4)]$，种子 $45$，噪声标准差 $10^{-6}$。\n\n对于每个测试：\n- 根据指定的 $n_v$ 和边列表构建 $B$。\n- 使用奇异值分解计算 $\\mathrm{Null}(B)$ 的一组基，其中零奇异值的容差为 $10^{-12}$。\n- 使用提供的种子，将 $\\phi$ 的各项作为独立的标准正态分布项进行抽样。\n- 计算 $j_{\\star} = B^{\\top} \\phi$。\n- 使用相同的种子，将环路基的系数作为独立的标准正态分布项进行抽样，并构造成零空间基向量的线性组合 $j_{\\mathrm{loop}}$（如果零空间是平凡的，则设置 $j_{\\mathrm{loop}} = 0$）。\n- 使用给定的噪声标准差和相同的种子，抽样独立的标准正态噪声项；设置 $j = j_{\\star} + j_{\\mathrm{loop}} + n$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果按以下顺序排列\n$$\n[\\varepsilon_{\\mathrm{loop}}^{(1)}, \\varepsilon_{\\star}^{(1)}, \\varepsilon_{\\mathrm{loop}}^{(2)}, \\varepsilon_{\\star}^{(2)}, \\varepsilon_{\\mathrm{loop}}^{(3)}, \\varepsilon_{\\star}^{(3)}, \\varepsilon_{\\mathrm{loop}}^{(4)}, \\varepsilon_{\\star}^{(4)}],\n$$\n其中上标 $(k)$ 索引测试 $k$。输出是无单位的实数。不应打印其他任何文本。", "solution": "用户提供的问题已经过验证，被认为是适定的、科学上合理的和完整的。为得到唯一且有意义的解所需的所有数据、约束和定义均已提供。该问题是线性代数和图上离散微积分的一个标准应用，具体涉及离散域上向量场的 Helmholtz-Hodge 分解。\n\n核心任务是将一个给定的向量 $j \\in \\mathbb{R}^{n_e}$（表示图的边上的系数）分解为两个正交分量：一个星分量 $j_{\\star}$ 和一个环分量 $j_{\\mathrm{loop}}$。这些分量分别位于星子空间 $\\mathrm{Range}(B^{\\top})$ 和环子空间 $\\mathrm{Null}(B)$ 中，其中 $B \\in \\mathbb{R}^{n_v \\times n_e}$ 是顶点-边关联矩阵。该分解由 $j = j_{\\star} + j_{\\mathrm{loop}}$ 给出。\n\n星分量 $j_{\\star}$ 是 $j$ 在子空间 $\\mathrm{Range}(B^{\\top})$ 上的正交投影。根据定义，该子空间中的任何向量都可以表示为 $B^{\\top}\\phi$，其中 $\\phi \\in \\mathbb{R}^{n_v}$ 是某个势向量。该投影通过求解一个最小二乘问题来找到，该问题旨在最小化 $j$ 与其在星子空间中的近似值之间的距离：\n$$\n\\min_{\\phi \\in \\mathbb{R}^{n_v}} \\lVert j - B^{\\top}\\phi \\rVert_2^2\n$$\n为求最小值，我们将平方范数对 $\\phi$ 求导，并令梯度为零。目标函数为：\n$$\nf(\\phi) = (j - B^{\\top}\\phi)^{\\top}(j - B^{\\top}\\phi) = j^{\\top}j - 2\\phi^{\\top}B j + \\phi^{\\top}B B^{\\top}\\phi\n$$\n关于 $\\phi$ 的梯度是 $\\nabla_{\\phi} f(\\phi) = -2 B j + 2 B B^{\\top}\\phi$。将其设为零可得到正规方程：\n$$\n(B B^{\\top}) \\phi = B j\n$$\n矩阵 $L = B B^{\\top}$ 是图拉普拉斯算子。如果图不是单个顶点，则该矩阵是奇异的。其零空间 $\\mathrm{Null}(L) = \\mathrm{Null}(B^{\\top})$ 的维数等于图的连通分量的数量。然而，该方程组总是相容的，因为右端项 $B j$ 总是与 $L$ 的零空间正交。证明如下：对于任何向量 $v \\in \\mathrm{Null}(L) = \\mathrm{Null}(B^{\\top})$，我们有 $B^{\\top}v=0$。其内积为 $(B j)^{\\top}v = j^{\\top}B^{\\top}v = j^{\\top}0 = 0$。这种正交性保证了 $\\phi$ 的解总是存在的。\n\n虽然 $\\phi$ 的解存在，但如果 $L$ 是奇异的，解则不唯一。如果 $\\phi_s$ 是一个特解，那么对于任何 $\\phi_0 \\in \\mathrm{Null}(L)$，$\\phi_s + \\phi_0$ 也是一个解。然而，最终得到的星分量 $j_{\\star} = B^{\\top}\\phi$ 是唯一的。这是因为 $B^{\\top}(\\phi_s + \\phi_0) = B^{\\top}\\phi_s + B^{\\top}\\phi_0 = B^{\\top}\\phi_s + 0 = B^{\\top}\\phi_s$。\n\n为了获得一个特定的、数值稳定的解，我们使用 Moore-Penrose 伪逆，用上标“$+$”表示。$\\phi$ 的最小范数最小二乘解由下式给出：\n$$\n\\phi_{\\text{sol}} = (B B^{\\top})^{+} (B j)\n$$\n利用这个 $\\phi_{\\text{sol}}$，我们表示为 $\\widehat{j}_{\\star}$ 的估计星分量计算如下：\n$$\n\\widehat{j}_{\\star} = B^{\\top} \\phi_{\\text{sol}}\n$$\n一旦找到星分量，便可利用分解的正交性，通过减法得到环分量 $\\widehat{j}_{\\mathrm{loop}}$：\n$$\n\\widehat{j}_{\\mathrm{loop}} = j - \\widehat{j}_{\\star}\n$$\n得到的向量 $\\widehat{j}_{\\mathrm{loop}}$ 保证位于环子空间 $\\mathrm{Null}(B)$ 中，因为 $B\\widehat{j}_{\\mathrm{loop}} = B(j - \\widehat{j}_{\\star}) = B j - B(B^{\\top}\\phi_{\\text{sol}}) = B j - (B B^{\\top})\\phi_{\\text{sol}}$。由于 $\\phi_{\\text{sol}}$ 是最小二乘解，$(B B^{\\top})\\phi_{\\text{sol}}$ 是 $B j$ 在 $B B^{\\top}$ 的值域上的正交投影。正如我们证明的相容性，$B j$ 位于 $B B^{\\top}$ 的值域中，因此投影是精确的：$(B B^{\\top})\\phi_{\\text{sol}} = B j$。因此，$B\\widehat{j}_{\\mathrm{loop}} = 0$，这证实了 $\\widehat{j}_{\\mathrm{loop}} \\in \\mathrm{Null}(B)$。\n\n对于每个测试用例，实现将遵循以下步骤：\n1.  根据给定的顶点数 $n_v$ 和边列表构建关联矩阵 $B$。\n2.  生成合成的基准真相数据。为了可复现性，对随机数生成器设置种子。\n    a. 使用奇异值分解 (SVD) 找到 $B$ 的零空间 $\\mathrm{Null}(B)$ 的一组基。这些基向量是对应于小于 $10^{-12}$ 容差的奇异值的右奇异向量。\n    b. 真实的环分量 $j_{\\mathrm{loop}}$ 是通过这些零空间基向量的随机线性组合创建的。如果零空间是平凡的（例如，对于树图），则 $j_{\\mathrm{loop}}$ 是零向量。\n    c. 真实的星分量 $j_{\\star}$ 是通过一个随机势向量 $\\phi_{\\text{true}}$ 创建的，即 $j_{\\star} = B^{\\top}\\phi_{\\text{true}}$。\n    d. 生成一个噪声向量 $n$，并将总向量构造为 $j = j_{\\star} + j_{\\mathrm{loop}} + n$。\n3.  将投影算法应用于 $j$ 以计算估计值 $\\widehat{j}_{\\star}$ 和 $\\widehat{j}_{\\mathrm{loop}}$。\n4.  最后，通过将估计分量与基准真相分量进行比较，并用基准真相的范数进行归一化（使用一个小的常数 $\\epsilon = 10^{-12}$ 以防止除以零），来计算相对重构误差 $\\varepsilon_{\\star}$ 和 $\\varepsilon_{\\mathrm{loop}}$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for loop-star decomposition.\n    \"\"\"\n    test_cases = [\n        {'nv': 4, 'edges': [(0, 1), (1, 2), (2, 3), (3, 0)], 'seed': 42, 'noise_std': 0.0},\n        {'nv': 4, 'edges': [(0, 1), (1, 2), (2, 3)], 'seed': 43, 'noise_std': 0.0},\n        {'nv': 6, 'edges': [(0, 1), (1, 2), (2, 0), (3, 4), (4, 5), (5, 3)], 'seed': 44, 'noise_std': 0.0},\n        {'nv': 5, 'edges': [(0, 1), (1, 2), (2, 3), (3, 0), (1, 4)], 'seed': 45, 'noise_std': 1e-6},\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        nv = case['nv']\n        edges = case['edges']\n        seed = case['seed']\n        noise_std = case['noise_std']\n        \n        ne = len(edges)\n        rng = np.random.default_rng(seed)\n\n        # 1. Build the incidence matrix B\n        B = np.zeros((nv, ne))\n        for i, (tail, head) in enumerate(edges):\n            B[tail, i] = -1.0\n            B[head, i] = 1.0\n\n        # 2. Generate ground truth data (j_star and j_loop)\n        \n        # 2a. Find a basis for Null(B) using SVD\n        # The rows of Vh corresponding to small singular values form a basis for Null(B)\n        try:\n            _, s, Vh = np.linalg.svd(B)\n        except np.linalg.LinAlgError:\n            # SVD may not converge for some matrices, although not expected here\n            all_results.extend([np.nan, np.nan])\n            continue\n            \n        svd_tol = 1e-12\n        null_space_basis_rows = Vh[s  svd_tol]\n\n        # 2b. Generate j_loop\n        if null_space_basis_rows.shape[0] > 0:\n            # Transpose to get basis vectors as columns\n            null_space_basis = null_space_basis_rows.T\n            # Generate random coefficients for the basis vectors\n            loop_coeffs = rng.standard_normal(null_space_basis.shape[1])\n            j_loop = null_space_basis @ loop_coeffs\n        else:\n            j_loop = np.zeros(ne)\n\n        # 2c. Generate j_star\n        phi_true = rng.standard_normal(nv)\n        j_star = B.T @ phi_true\n        \n        # 2d. Generate noise and construct the total vector j\n        noise = rng.standard_normal(ne) * noise_std\n        j = j_star + j_loop + noise\n\n        # 3. Apply the projection algorithm\n        # Solve (BB^T) * phi = B*j using the pseudoinverse\n        L = B @ B.T\n        rhs = B @ j\n        \n        # phi_sol is the minimum-norm solution for the potential\n        phi_sol = np.linalg.pinv(L) @ rhs\n        \n        # Compute the estimated star and loop components\n        j_star_hat = B.T @ phi_sol\n        j_loop_hat = j - j_star_hat\n\n        # 4. Calculate relative reconstruction errors\n        epsilon = 1e-12\n        \n        # Error for the star component\n        norm_j_star = np.linalg.norm(j_star)\n        err_star = np.linalg.norm(j_star_hat - j_star) / max(norm_j_star, epsilon)\n        \n        # Error for the loop component\n        norm_j_loop = np.linalg.norm(j_loop)\n        err_loop = np.linalg.norm(j_loop_hat - j_loop) / max(norm_j_loop, epsilon)\n        \n        all_results.extend([err_loop, err_star])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n\n```", "id": "3325511"}, {"introduction": "环路-星形分解的真正威力在于它能够分离不同的物理现象。由于星形函数是无旋的，它们与标量势和电荷积累直接相关。这个高级实践将挑战您仅使用星形基函数来模拟均匀外电场下导体板上的准静态电荷分布。这个过程将展示该分解如何成为一个强大工具，用于在复杂的电磁问题中隔离和分析特定的物理效应 [@problem_id:3325476]。", "problem": "给定一个薄的、理想导电的矩形板，其被建模为一个带边界的平面三角化曲面域。考虑由均匀入射电场引起的低频准静态激励。在感应表面电流的环-星分解中，星子空间对应于无旋场，这些场可以通过以顶点为中心的星形组合，在三角剖分上由 Rao-Wilton-Glisson (RWG) 边函数构造而成。本问题的目的是在一个三角化的矩形上显式构造星基函数的散度，并通过弱施加高斯定理所蕴含的边界通量来计算由均匀入射场引起的离散电荷累积模式，从而展现边缘效应。\n\n从以下基本基础开始：\n- 平面域上的曲面散度定理指出，对于域 $\\Omega$（其边界为 $\\partial \\Omega$）上的任何足够光滑的矢量场 $\\mathbf{J}$，有 $\\int_{\\Omega} \\nabla_{s} \\cdot \\mathbf{J}\\, dS = \\int_{\\partial \\Omega} \\mathbf{J} \\cdot \\mathbf{n}_{\\partial \\Omega}\\, ds$，其中 $\\mathbf{n}_{\\partial \\Omega}$ 是沿边界曲线的单位外法向量。\n- RWG (Rao-Wilton-Glisson) 基函数定义在由两个相邻三角形共享的内部边上，在这两个三角形上具有分段线性支撑，并具有分段常数曲面散度。对于与长度为 $l_{e}$ 的内部边 $e$ 相关联的 RWG 函数 $f_{e}$，其相邻三角形的面积分别为 $A^{+}$ 和 $A^{-}$，则在一个相邻三角形上有 $\\nabla_{s} \\cdot f_{e} = +\\frac{l_{e}}{A^{+}}$，在另一个上有 $\\nabla_{s} \\cdot f_{e} = -\\frac{l_{e}}{A^{-}}$，符号由一致的定向决定。\n- 顶点 $v$ 处的顶点-星基函数 $S_{v}$ 是围绕 $v$ 的 RWG 函数的带符号和，即 $S_{v} = \\sum_{e \\ni v} c(v,e)\\, f_{e}$，其中 $c(v,e) \\in \\{+1,-1\\}$ 编码了顶点 $v$ 是定向边 $e$ 的正端点还是负端点。$S_{v}$ 的散度则是贡献的 RWG 函数散度的相应带符号和。\n\n您的任务是建立一个自洽的数值模型，并仅使用星子空间，计算由均匀入射电场在板上引起的归一化离散电荷累积模式。具体而言：\n\n1. 几何与离散化：\n   - 域是一个矩形 $\\Omega = [0,L_{x}] \\times [0,L_{y}]$，被离散为 $N_{x} \\times N_{y}$ 个矩形单元，每个单元通过从左下到右上的角点对角线分割成两个逆时针定向的三角形。\n   - 设节点集为 $\\{(x_{i}, y_{j})\\}$，其中 $i \\in \\{0,\\dots,N_{x}\\}$ 且 $j \\in \\{0,\\dots,N_{y}\\}$，且 $x_{i} = \\frac{i}{N_{x}} L_{x}$ 和 $y_{j} = \\frac{j}{N_{y}} L_{y}$。\n   - 构造所有具有一致逆时针定向的三角形。构造所有内部边（每条由恰好两个三角形共享）和边界边（每条由恰好一个三角形共享）。对于每条内部边，定义一个从索引较小的节点到索引较大的节点的全局边定向。\n\n2. 环-星构造与散度映射：\n   - 在所有顶点 $v$ 上建立顶点-星基 $\\{S_{v}\\}$，作为与 $v$ 相关联的内部边上的 RWG 函数 $f_{e}$ 的和，其符号 $c(v,e) \\in \\{+1,-1\\}$ 的选择方式是：如果 $v$ 是全局定向边 $e$ 的起始节点，则 $c(v,e)=+1$；如果 $v$ 是结束节点，则 $c(v,e)=-1$。\n   - 对于由三角形 $T^{+}$ 和 $T^{-}$ 共享的每条内部边 $e$，通过比较边的定向与每个三角形中边的局部逆时针定向来确定符号 $s(T^{\\pm}, e) \\in \\{+1,-1\\}$。对于三角形 $T$ 和边 $e$，积分散度贡献等于 $s(T,e)\\, l_{e}$。\n   - 组装一个矩阵 $D \\in \\mathbb{R}^{N_{T} \\times N_{V}}$，该矩阵通过以下方式将星系数 $\\boldsymbol{\\alpha} \\in \\mathbb{R}^{N_{V}}$ 映射到每个三角形的積分散度 $\\mathbf{d} \\in \\mathbb{R}^{N_{T}}$：\n     $$ \\mathbf{d} = D \\, \\boldsymbol{\\alpha}, $$\n     其中 $N_{T}$ 是三角形的数量，$N_{V}$ 是顶点的数量。条目 $D_{t,v}$ 是对所有既与顶点 $v$ 相关联又属于三角形 $t$ 的内部边 $e$ 的 $c(v,e)\\, s(t,e)\\, l_{e}$ 的求和。\n\n3. 均匀场激励与目标边界通量：\n   - 设均匀入射场为 $\\mathbf{E}_{0} = (E_{x}, E_{y})$，与板相切。考虑替代目标场 $\\mathbf{J}_{\\mathrm{target}} = \\mathbf{E}_{0}$，它在整个域上是恒定的，并代表了通过 $\\mathbf{J} = -\\nabla_{s} u$ 从标量势 $u(\\mathbf{r}) = -\\mathbf{E}_{0} \\cdot \\mathbf{r}$ 获得的无旋场。\n   - 对于三角形 $t$ 的每个边界边，其定向切线 $\\hat{\\mathbf{t}}$ 与局部三角形边界定向匹配，外法向单位向量 $\\hat{\\mathbf{n}}_{\\mathrm{out}}$ 通过将 $\\hat{\\mathbf{t}}$ 旋转-90度获得，形成积分目标通量贡献 $q_{t,e} = (\\mathbf{E}_{0} \\cdot \\hat{\\mathbf{n}}_{\\mathrm{out}})\\, l_{e}$，其中 $l_{e}$ 是边长。定义每个三角形的目标值为：\n     $$ q_{t} = \\sum_{\\text{boundary edges } e \\subset \\partial t} q_{t,e}. $$\n     对于内部边，没有贡献，因为它们的通量在相邻三角形之间相互抵消。收集成 $\\mathbf{q} \\in \\mathbb{R}^{N_{T}}$。\n\n4. 星系数的确定：\n   - 通过最小化 Tikhonov 正则化最小二乘目标函数来确定星系数 $\\boldsymbol{\\alpha}$：\n     $$ \\min_{\\boldsymbol{\\alpha}} \\, \\left\\| D \\boldsymbol{\\alpha} - \\mathbf{q} \\right\\|_{2}^{2} + \\lambda \\left\\| \\boldsymbol{\\alpha} \\right\\|_{2}^{2}, $$\n     其中 $\\lambda  0$ 是一个小的正则化参数，以确保解的稳定性。求解正规方程：\n     $$ (D^{\\top} D + \\lambda I)\\, \\boldsymbol{\\alpha} = D^{\\top} \\mathbf{q}. $$\n\n5. 归一化与度量：\n   - 设周长为 $P = 2 (L_{x} + L_{y})$，入射场幅值为 $\\|\\mathbf{E}_{0}\\| = \\sqrt{E_{x}^{2} + E_{y}^{2}}$。将实现的每个三角形的积分散度 $\\mathbf{d} = D \\boldsymbol{\\alpha}$ 按比例因子 $S = \\|\\mathbf{E}_{0}\\| \\, P$ 进行归一化，即定义 $\\tilde{\\mathbf{d}} = \\mathbf{d}/S$。所有报告的值必须是无量纲的。\n   - 根据 $\\tilde{\\mathbf{d}}$ 定义以下四种度量：\n     1) 净归一化电荷：$C_{\\mathrm{net}} = \\sum_{t=1}^{N_{T}} \\tilde{d}_{t}$。\n     2) 边缘平衡误差：通过将每个边界三角形的 $|\\tilde{d}_{t}|$ 按比例 $|q_{t,e}|$ 分配给其边界边，来构建相对于入射场的正侧和负侧总和，并累加到 $C_{+}$（对于 $(\\mathbf{E}_{0}\\cdot \\hat{\\mathbf{n}}_{\\mathrm{out}})  0$ 的边）和 $C_{-}$（对于 $(\\mathbf{E}_{0}\\cdot \\hat{\\mathbf{n}}_{\\mathrm{out}})  0$ 的边）中。然后定义 $E_{\\mathrm{bal}} = |\\, |C_{+}| - |C_{-}| \\,|$。\n     3) 内部最大幅值：$M_{\\mathrm{int}} = \\max\\{ |\\tilde{d}_{t}| \\,:\\, t \\text{ has no boundary edges} \\}$。\n     4) 边缘集中分数：$F_{\\mathrm{edge}} = \\left( \\sum_{t \\in \\mathcal{B}} |\\tilde{d}_{t}| \\right) \\big/ \\left( \\sum_{t=1}^{N_{T}} |\\tilde{d}_{t}| \\right)$，其中 $\\mathcal{B}$ 是至少有一条边界边的三角形集合。\n\n6. 要求的输出：\n   - 对于下面的每个测试用例，计算并输出列表 $[C_{\\mathrm{net}}, E_{\\mathrm{bal}}, M_{\\mathrm{int}}, F_{\\mathrm{edge}}]$ 作为浮点数。\n   - 您的程序应生成单行输出，其中包含所有提供的测试用例的结果，形式为一个用方括号括起来的逗号分隔列表，每个测试用例的列表本身也用方括号括起来。例如，要求的格式是 $[ [r_{1,1}, r_{1,2}, r_{1,3}, r_{1,4}], [r_{2,1}, r_{2,2}, r_{2,3}, r_{2,4}], \\dots ]$。\n\n测试套件：\n- 案例 1：$L_{x} = 1.0$, $L_{y} = 1.0$, $N_{x} = 8$, $N_{y} = 8$, $\\mathbf{E}_{0} = (1.0, 0.0)$。\n- 案例 2：$L_{x} = 2.0$, $L_{y} = 1.0$, $N_{x} = 12$, $N_{y} = 6$, $\\mathbf{E}_{0} = (0.0, 1.0)$。\n- 案例 3：$L_{x} = 1.0$, $L_{y} = 1.0$, $N_{x} = 10$, $N_{y} = 7$, $\\mathbf{E}_{0} = \\left(\\frac{1}{\\sqrt{2}}, \\frac{1}{\\sqrt{2}}\\right)$。\n- 案例 4：$L_{x} = 2.0$, $L_{y} = 0.2$, $N_{x} = 40$, $N_{y} = 4$, $\\mathbf{E}_{0} = (1.0, 0.0)$。\n\n所有输出都必须是无量纲的，按规定计算，并以上述确切的最终输出格式呈现。不需要其他单位。角度（如有）必须以弧度为单位，但此处除了矢量的点积外，您不需要任何三角函数。", "solution": "用户提供的问题经评估为**有效的**。这是一个在计算电磁学中适定且有科学依据的问题，没有矛盾、歧义和未经证实的论断。任务是基于环-星分解和矩量法实现一个数值模型，用以分析在均匀电场激励下，三角化矩形板上的电荷累积。问题提供了清晰、逐步的算法描述，将严格遵循。\n\n解决方案包括以下步骤：\n1.  **几何建模与离散化**：一个矩形域 $\\Omega = [0,L_{x}] \\times [0,L_{y}]$ 被离散化为 $N_{x} \\times N_{y}$ 个单元格的网格。每个单元格被细分为两个逆时针定向的三角形。此过程生成一组顶点（节点）、一个由顶点索引定义的三角形列表，以及内部和边界边的集合。\n2.  **基函数与算子构造**：模型的核心是构造离散散度算子，由矩阵 $D$ 表示。星基函数 $\\{S_v\\}$ 在每个顶点 $v$ 处定义为 Rao-Wilton-Glisson (RWG) 基函数 $\\{f_e\\}$ 在相关内部边上的带符号和。矩阵 $D \\in \\mathbb{R}^{N_{T} \\times N_{V}}$ 将星基展开的系数 $\\boldsymbol{\\alpha}$ 映射到每个三角形上的积分曲面散度。一个条目 $D_{t,v}$ 代表星基函数 $S_v$ 在三角形 $t$ 上的积分散度，由以下公式给出：\n    $$ D_{t,v} = \\sum_{e \\in \\mathcal{E}_t \\cap \\mathcal{E}_v} c(v,e)\\, s(t,e)\\, l_{e} $$\n    其中 $\\mathcal{E}_t$ 和 $\\mathcal{E}_v$ 分别是属于三角形 $t$ 和与顶点 $v$ 相关联的内部边集。符号 $c(v,e) \\in \\{+1,-1\\}$ 取决于 $v$ 是全局定向边 $e$ 的起始节点还是结束节点。符号 $s(t,e) \\in \\{+1,-1\\}$ 比较全局边定向与边在三角形 $t$ 内的局部逆时针遍历方向。项 $l_e$ 是边 $e$ 的长度。$D$ 的零空间对应于一个常数势（即 $\\boldsymbol{\\alpha}$ 是一个常数向量），这导致一个秩亏系统。\n\n3.  **激励与边界条件**：施加一个均匀入射电场 $\\mathbf{E}_0$。从曲面散度定理推导出的物理边界条件要求域内的总散度等于通过边界的净通量。这通过定义一个目标通量向量 $\\mathbf{q} \\in \\mathbb{R}^{N_{T}}$ 来弱施加。对于每个三角形 $t$，分量 $q_t$ 是 $\\mathbf{E}_0$ 通过其边界边的积分通量之和：\n    $$ q_{t} = \\sum_{\\text{boundary edges } e \\subset \\partial t} (\\mathbf{E}_{0} \\cdot \\hat{\\mathbf{n}}_{\\mathrm{out}})\\, l_{e} $$\n    其中 $\\hat{\\mathbf{n}}_{\\mathrm{out}}$ 是域边界上指向外部的边的法线。\n\n4.  **求解线性系统**：星系数 $\\boldsymbol{\\alpha}$ 通过求解一个 Tikhonov 正则化最小二乘问题来找到，该问题旨在使实现的散度 $D\\boldsymbol{\\alpha}$ 与目标通量 $\\mathbf{q}$ 相匹配。这导出了正规方程：\n    $$ (D^{\\top} D + \\lambda I)\\, \\boldsymbol{\\alpha} = D^{\\top} \\mathbf{q} $$\n    正则化项 $\\lambda I$，带有一个小的参数 $\\lambda  0$（此处选择为 $\\lambda=10^{-12}$），通过惩罚非物理性解并在 $D^TD$ 的零空间存在的情况下稳定求逆过程，来确保矩阵是可逆的。\n\n5.  **后处理与度量计算**：一旦找到 $\\boldsymbol{\\alpha}$，实现的每个三角形的积分散度计算为 $\\mathbf{d} = D\\boldsymbol{\\alpha}$。该向量通过一个因子 $S = \\|\\mathbf{E}_{0}\\| P$ 进行归一化，其中 $P$ 是板的周长，以产生无量纲量 $\\tilde{\\mathbf{d}}$。最后，从 $\\tilde{\\mathbf{d}}$ 计算四个指定的度量：\n    -   $C_{\\mathrm{net}}$：净归一化电荷，由于散度算子的性质，应接近于零。\n    -   $E_{\\mathrm{bal}}$：边界上正负电荷累积之间的平衡误差。\n    -   $M_{\\mathrm{int}}$：内部三角形中的最大电荷幅值，表明从边界的泄漏。\n    -   $F_{\\mathrm{edge}}$：集中在边界三角形上的总电荷幅值的分数，量化预期的边缘效应。\n\n实现将对问题陈述中提供的每个测试用例遵循这些步骤。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function that iterates through test cases and prints results\n    in the specified format.\n    \"\"\"\n    test_cases = [\n        {'Lx': 1.0, 'Ly': 1.0, 'Nx': 8, 'Ny': 8, 'E0': (1.0, 0.0)},\n        {'Lx': 2.0, 'Ly': 1.0, 'Nx': 12, 'Ny': 6, 'E0': (0.0, 1.0)},\n        {'Lx': 1.0, 'Ly': 1.0, 'Nx': 10, 'Ny': 7, 'E0': (1/np.sqrt(2), 1/np.sqrt(2))},\n        {'Lx': 2.0, 'Ly': 0.2, 'Nx': 40, 'Ny': 4, 'E0': (1.0, 0.0)},\n    ]\n\n    results = []\n    for case in test_cases:\n        # Each test case is solved by a dedicated function\n        res = compute_metrics_for_case(**case)\n        results.append(res)\n\n    # Format the output as a list of lists of floats, e.g., [[r1,r2,...],[r1,r2,...]]\n    # The map(str,...) and join combination achieves this format precisely.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef compute_metrics_for_case(Lx, Ly, Nx, Ny, E0):\n    \"\"\"\n    Computes the four required metrics for a single test case following the\n    problem's methodology.\n    \"\"\"\n    # A small regularization parameter for Tikhonov regularization\n    LAMBDA = 1e-12\n    E0_vec = np.array(E0)\n\n    # 1. Geometry and discretization\n    num_nodes_x = Nx + 1\n    num_nodes_y = Ny + 1\n    num_nodes = num_nodes_x * num_nodes_y\n    num_triangles = 2 * Nx * Ny\n\n    # Create nodes with y-index varying fastest to match node_idx function\n    x_coords = np.linspace(0, Lx, num_nodes_x)\n    y_coords = np.linspace(0, Ly, num_nodes_y)\n    node_list = []\n    for i in range(num_nodes_x):\n        for j in range(num_nodes_y):\n            node_list.append([x_coords[i], y_coords[j]])\n    nodes = np.array(node_list)\n\n    def node_idx(i, j):\n        return i * num_nodes_y + j\n\n    # Create triangles with consistent CCW orientation\n    triangles = []\n    for i in range(Nx):\n        for j in range(Ny):\n            v_ll, v_lr, v_ul, v_ur = node_idx(i, j), node_idx(i + 1, j), node_idx(i, j + 1), node_idx(i + 1, j + 1)\n            triangles.append([v_ll, v_lr, v_ur])\n            triangles.append([v_ll, v_ur, v_ul])\n    \n    # Identify interior and boundary edges\n    edge_to_triangles = {}\n    for t_idx, t_verts in enumerate(triangles):\n        for i in range(3):\n            v1, v2 = t_verts[i], t_verts[(i + 1) % 3]\n            edge = tuple(sorted((v1, v2)))\n            edge_to_triangles.setdefault(edge, []).append(t_idx)\n\n    interior_edges = {e for e, t_list in edge_to_triangles.items() if len(t_list) == 2}\n    boundary_edges = {e for e, t_list in edge_to_triangles.items() if len(t_list) == 1}\n\n    # 2. Assemble divergence matrix D\n    D = np.zeros((num_triangles, num_nodes))\n    for t_idx, t_verts in enumerate(triangles):\n        local_edges_verts = [(t_verts[0], t_verts[1]), (t_verts[1], t_verts[2]), (t_verts[2], t_verts[0])]\n        for v_node_idx in t_verts:\n            D_tv_val = 0.0\n            for v_start_local, v_end_local in local_edges_verts:\n                if v_node_idx in (v_start_local, v_end_local):\n                    edge_global = tuple(sorted((v_start_local, v_end_local)))\n                    if edge_global in interior_edges:\n                        edge_len = np.linalg.norm(nodes[v_end_local] - nodes[v_start_local])\n                        c_sign = 1 if v_node_idx == edge_global[0] else -1\n                        s_sign = 1 if (v_start_local, v_end_local) == edge_global else -1\n                        D_tv_val += c_sign * s_sign * edge_len\n            D[t_idx, v_node_idx] = D_tv_val\n\n    # 3. Assemble target vector q\n    q = np.zeros(num_triangles)\n    for t_idx, t_verts in enumerate(triangles):\n        local_edges_verts = [(t_verts[0], t_verts[1]), (t_verts[1], t_verts[2]), (t_verts[2], t_verts[0])]\n        for v_start, v_end in local_edges_verts:\n            if tuple(sorted((v_start, v_end))) in boundary_edges:\n                t_vec = nodes[v_end] - nodes[v_start]\n                n_vec = np.array([t_vec[1], -t_vec[0]])\n                flux = np.dot(E0_vec, n_vec)\n                q[t_idx] += flux\n\n    # 4. Determine star coefficients alpha\n    DtD = D.T @ D\n    A = DtD + LAMBDA * np.identity(num_nodes)\n    b = D.T @ q\n    alpha = np.linalg.solve(A, b)\n    \n    # 5. Calculate metrics\n    d = D @ alpha\n    perimeter = 2 * (Lx + Ly)\n    E0_mag = np.linalg.norm(E0_vec)\n    if E0_mag  1e-15: return [0.0, 0.0, 0.0, 0.0]\n    scale = E0_mag * perimeter\n    if scale  1e-15: return [0.0, 0.0, 0.0, 0.0]\n    d_tilde = d / scale\n    \n    # Metric 1: C_net\n    C_net = np.sum(d_tilde)\n    \n    # Metric 2: E_bal\n    C_plus, C_minus = 0.0, 0.0\n    boundary_triangle_indices = sorted(list({t_idx for e in boundary_edges for t_idx in edge_to_triangles[e]}))\n    for t_idx in boundary_triangle_indices:\n        t_verts = triangles[t_idx]\n        local_edges_verts = [(t_verts[0], t_verts[1]), (t_verts[1], t_verts[2]), (t_verts[2], t_verts[0])]\n        boundary_edges_info = []\n        total_abs_q_t = 0.0\n        for v_start, v_end in local_edges_verts:\n            if tuple(sorted((v_start, v_end))) in boundary_edges:\n                t_vec = nodes[v_end] - nodes[v_start]\n                n_vec = np.array([t_vec[1], -t_vec[0]])\n                q_te = np.dot(E0_vec, n_vec)\n                boundary_edges_info.append(q_te)\n                total_abs_q_t += abs(q_te)\n        if total_abs_q_t > 1e-15:\n            d_t_tilde_mag = abs(d_tilde[t_idx])\n            for q_te in boundary_edges_info:\n                fraction = abs(q_te) / total_abs_q_t\n                charge_contribution = d_t_tilde_mag * fraction\n                if q_te > 0: C_plus += charge_contribution\n                else: C_minus += charge_contribution\n    E_bal = abs(C_plus - C_minus)\n    \n    # Metric 3: M_int\n    all_triangle_indices = set(range(num_triangles))\n    interior_triangle_indices = list(all_triangle_indices - set(boundary_triangle_indices))\n    M_int = np.max(np.abs(d_tilde[interior_triangle_indices])) if interior_triangle_indices else 0.0\n        \n    # Metric 4: F_edge\n    sum_abs_d_boundary = np.sum(np.abs(d_tilde[list(boundary_triangle_indices)]))\n    sum_abs_d_total = np.sum(np.abs(d_tilde))\n    F_edge = sum_abs_d_boundary / sum_abs_d_total if sum_abs_d_total > 1e-15 else 0.0\n    \n    return [C_net, E_bal, M_int, F_edge]\n\nif __name__ == '__main__':\n    solve()\n\n```", "id": "3325476"}]}