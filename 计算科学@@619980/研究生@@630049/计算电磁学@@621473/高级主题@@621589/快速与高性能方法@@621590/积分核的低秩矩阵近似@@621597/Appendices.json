{"hands_on_practices": [{"introduction": "低秩近似的有效性取决于积分核的平滑度。然而，高频亥姆霍兹（Helmholtz）核由于其振荡相位而不平滑。通过提取主要的、快速变化的相分量，我们可以“平滑化”核函数，留下一个数值秩更低的光滑残差核。这项动手编程练习 [@problem_id:3326914] 让你能直接观察并量化通过相位提取技术实现的秩显著降低，这是加速高频积分方程求解器的基石技术。", "problem": "考虑自由空间中的时谐电磁散射，该过程由标量亥姆霍兹方程建模，其中波数 $k$ 的单位是弧度/米。相关的自由空间格林函数为 $G(\\mathbf r,\\mathbf r') = \\dfrac{e^{i k \\lVert \\mathbf r - \\mathbf r' \\rVert}}{4\\pi \\lVert \\mathbf r - \\mathbf r' \\rVert}$，其中 $\\mathbf r,\\mathbf r' \\in \\mathbb R^3$，$\\lVert \\cdot \\rVert$ 表示欧几里得范数。在许多积分方程提法中，需要构建一个矩阵，其元素与 $G(\\mathbf r_i, \\mathbf r'_j)$ 成正比，其中 $\\{\\mathbf r_i\\}$ 是“目标”簇上的离散化点，$\\{\\mathbf r'_j\\}$ 是“源”簇上的离散化点。因子 $e^{i k \\lVert \\mathbf r - \\mathbf r' \\rVert}$ 中的高频振荡会阻碍低秩近似。\n\n一种常见的解决方法是通过对距离函数进行局部线性化来提取相位。设目标簇和源簇的中心分别为 $\\mathbf r_c$ 和 $\\mathbf r'_c$，并定义 $\\mathbf R_0 = \\mathbf r_c - \\mathbf r'_c$，$R_0 = \\lVert \\mathbf R_0 \\rVert$ 以及单位向量 $\\hat{\\mathbf u} = \\dfrac{\\mathbf R_0}{R_0}$。映射 $(\\mathbf r,\\mathbf r') \\mapsto \\lVert \\mathbf r - \\mathbf r' \\rVert$ 在 $(\\mathbf r_c,\\mathbf r'_c)$ 处的一阶泰勒线性化得到相位函数\n$$\nd(\\mathbf r,\\mathbf r') = R_0 + \\hat{\\mathbf u} \\cdot (\\mathbf r - \\mathbf r_c) - \\hat{\\mathbf u} \\cdot (\\mathbf r' - \\mathbf r'_c),\n$$\n该函数捕捉了主导的相位变化。定义原始核矩阵\n$$\nK_{ij} = \\frac{e^{i k \\lVert \\mathbf r_i - \\mathbf r'_j \\rVert}}{\\lVert \\mathbf r_i - \\mathbf r'_j \\rVert},\n$$\n以及相位提取后的残差核矩阵\n$$\nR_{ij} = \\frac{e^{i k \\left(\\lVert \\mathbf r_i - \\mathbf r'_j \\rVert - d(\\mathbf r_i,\\mathbf r'_j)\\right)}}{\\lVert \\mathbf r_i - \\mathbf r'_j \\rVert}.\n$$\n此处，矩阵 $A$ 的数值秩定义为满足 $\\sigma_\\ell(A) \\ge \\varepsilon \\, \\sigma_{\\max}(A)$ 的奇异值 $\\sigma_\\ell(A)$ 的数量，其中 $\\sigma_{\\max}(A)$ 是最大奇异值，$\\varepsilon$ 是一个指定的相对容差。\n\n任务：实现一个程序，为一组由 $\\mathbb R^3$ 中两个直线段（位于平面 $z=0$ 内）组成的几何结构构建矩阵 $K$ 和 $R$。这些线段参数化如下\n$$\n\\mathbf r(s) = \\mathbf r_c + s \\, \\hat{\\mathbf t}, \\quad s \\in [-L/2,L/2], \\quad \\lVert \\hat{\\mathbf t} \\rVert = 1,\n$$\n用于目标线段，以及\n$$\n\\mathbf r'(s') = \\mathbf r'_c + s' \\, \\hat{\\mathbf t}', \\quad s' \\in [-L/2,L/2], \\quad \\lVert \\hat{\\mathbf t}' \\rVert = 1,\n$$\n用于源线段。分别用 $M$ 和 $N$ 个点离散化每个线段，使用在 $[-L/2,L/2]$ 上的均匀样本 $s_m$ 和 $s'_n$。使用以下约定和参数：\n- 所有距离单位为米，波数 $k$ 的单位为弧度/米。\n- 角度以弧度为单位。\n- 线段长度为 $L = 1$。\n- 目标线段的中心为 $\\mathbf r_c = (0,0,0)$，其方向为 $\\hat{\\mathbf t} = (1,0,0)$。\n- 源线段的中心为 $\\mathbf r'_c = (0,D,0)$，其方向为 $\\hat{\\mathbf t}' = (\\cos \\theta, \\sin \\theta, 0)$。\n- 对两个线段均使用 $M = N = 64$ 个均匀间隔的样本。\n- 使用相对容差 $\\varepsilon = 10^{-10}$ 计算数值秩。\n\n对于每个测试用例，构建 $K$ 和 $R$ 并计算：\n- $K$ 的数值秩，记为 $r_K$。\n- $R$ 的数值秩，记为 $r_R$。\n- 秩的下降量 $\\Delta r = r_K - r_R$。\n\n测试套件：\n- 用例 1：$k = 50$，$D = 0.5$，$\\theta = 0$。\n- 用例 2：$k = 200$，$D = 0.5$，$\\theta = 0$。\n- 用例 3：$k = 200$，$D = 5.0$，$\\theta = 0$。\n- 用例 4：$k = 100$，$D = \\frac{1}{2}$，$\\theta = \\frac{\\pi}{4}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果为一个三元组 $[r_K,r_R,\\Delta r]$。例如，一个有效的输出格式是 $[[r_{K,1},r_{R,1},\\Delta r_1],[r_{K,2},r_{R,2},\\Delta r_2],\\dots]$。每个 $r_K$、$r_R$ 和 $\\Delta r$ 都必须是整数。", "solution": "用户的问题是有效的。它在科学上基于计算电磁学的原理，特别是关于积分方程核的低秩近似。问题是适定的，提供了所有必要的参数、定义和约束，并且没有歧义或矛盾。\n\n解决方案首先实现几何结构，然后构建指定的矩阵。问题的核心是展示通过从积分核中提取主导的、快速振荡的相位分量来实现的数值秩降低。\n\n首先，我们为每个测试用例建立几何设置。目标线段是固定的，中心在 $\\mathbf r_c=(0,0,0)$，长度为 $L=1$，方向为 $\\hat{\\mathbf t}=(1,0,0)$。源线段的长度也为 $L=1$，中心在 $\\mathbf r'_c=(0,D,0)$，由方向向量 $\\hat{\\mathbf t}'=(\\cos\\theta, \\sin\\theta, 0)$ 定向。参数 $D$ 和 $\\theta$ 随每个测试用例而变化。每个线段被离散化为一组点。目标线段被离散化为 $M=64$ 个点 $\\{\\mathbf r_i\\}_{i=1}^{M}$，源线段被离散化为 $N=64$ 个点 $\\{\\mathbf r'_j\\}_{j=1}^{N}$。这些点是通过在参数化区间上进行均匀采样来选择的，即 $\\mathbf r_i = \\mathbf r_c + s_i \\hat{\\mathbf t}$ 和 $\\mathbf r'_j = \\mathbf r'_c + s'_j \\hat{\\mathbf t}'$，其中 $s_i$ 和 $s'_j$ 从 $[-L/2, L/2]$ 上的均匀网格中抽取。\n\n离散化点确定后，我们构建 $M \\times N$ 核矩阵。第一个矩阵是原始核矩阵 $K$，其元素为\n$$\nK_{ij} = \\frac{e^{i k \\lVert \\mathbf r_i - \\mathbf r'_j \\rVert}}{\\lVert \\mathbf r_i - \\mathbf r'_j \\rVert}.\n$$\n复指数项 $e^{i k \\lVert \\mathbf r_i - \\mathbf r'_j \\rVert}$ 在波数 $k$ 较大时会快速振荡，这通常导致矩阵 $K$ 具有高数值秩。\n\n为了降低这个秩，采用了一种相位提取技术。距离函数 $\\lVert \\mathbf r - \\mathbf r' \\rVert$ 在簇中心 $(\\mathbf r_c, \\mathbf r'_c)$ 附近被线性化。这得到了由下式给出的近似距离函数 $d(\\mathbf r, \\mathbf r')$\n$$\nd(\\mathbf r,\\mathbf r') = R_0 + \\hat{\\mathbf u} \\cdot (\\mathbf r - \\mathbf r_c) - \\hat{\\mathbf u} \\cdot (\\mathbf r' - \\mathbf r'_c),\n$$\n其中 $\\mathbf R_0 = \\mathbf r_c - \\mathbf r'_c$，$R_0 = \\lVert \\mathbf R_0 \\rVert$，且 $\\hat{\\mathbf u} = \\mathbf R_0 / R_0$。这个函数捕捉了簇之间的主导线性相位变化。\n\n然后，通过从真实相位中减去这个线性相位来定义残差核矩阵 $R$：\n$$\nR_{ij} = \\frac{e^{i k \\left(\\lVert \\mathbf r_i - \\mathbf r'_j \\rVert - d(\\mathbf r_i,\\mathbf r'_j)\\right)}}{\\lVert \\mathbf r_i - \\mathbf r'_j \\rVert}.\n$$\n$R$ 中复指数的自变量是 $k$ 乘以距离的泰勒近似误差。当簇被良好分离时（即 $R_0$ 相对于簇的大小而言很大），这个误差很小，并且在各个点上变化缓慢，从而得到一个更平滑的核矩阵。更平滑的矩阵其奇异值衰减更快，从而导致更低的数值秩。\n\n最后一步是计算数值秩。对于给定的矩阵 $A$，我们使用奇异值分解 (SVD) 计算其奇异值 $\\sigma_\\ell(A)$。数值秩是满足条件 $\\sigma_\\ell(A) \\ge \\varepsilon \\, \\sigma_{\\max}(A)$ 的奇异值的数量，其中 $\\sigma_{\\max}(A)$ 是最大奇异值，$\\varepsilon = 10^{-10}$ 是指定的相对容差。我们分别计算矩阵 $K$ 和 $R$ 的秩 $r_K$ 和 $r_R$，以及它们的差值 $\\Delta r = r_K - r_R$。\n\n该实现利用 `numpy` 进行高效的向量化计算。逐对距离 $\\lVert \\mathbf r_i - \\mathbf r'_j \\rVert$ 和其他矩阵量是使用广播计算的，这避免了 Python 中的显式循环，并显著提高了性能。奇异值是使用 `numpy.linalg.svd` 计算的。对问题陈述中提供的每个测试用例重复整个过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_ranks(k, D, theta):\n    \"\"\"\n    Constructs matrices K and R and computes their numerical ranks for a given geometry.\n\n    Args:\n        k (float): Wavenumber in radians per meter.\n        D (float): Separation distance between segment centers.\n        theta (float): Angle of the source segment in radians.\n\n    Returns:\n        list: A list containing [r_K, r_R, delta_r], the integer ranks and their difference.\n    \"\"\"\n    # Define constants and parameters from the problem statement\n    L = 1.0\n    M = 64\n    N = 64\n    epsilon = 1e-10\n\n    # Define segment geometry\n    rc = np.array([0.0, 0.0, 0.0])\n    t_hat = np.array([1.0, 0.0, 0.0])\n    rc_prime = np.array([0.0, D, 0.0])\n    t_prime_hat = np.array([np.cos(theta), np.sin(theta), 0.0])\n\n    # Generate uniformly spaced discretization points for both segments\n    s = np.linspace(-L / 2, L / 2, M)\n    s_prime = np.linspace(-L / 2, L / 2, N)\n\n    # Compute 3D coordinates of points\n    ri = rc + s[:, np.newaxis] * t_hat\n    rj_prime = rc_prime + s_prime[:, np.newaxis] * t_prime_hat\n\n    # Compute the matrix of pairwise distances ||r_i - r'_j||\n    # Use numpy broadcasting for an efficient, loop-free calculation\n    # ri becomes (M, 1, 3) and rj_prime becomes (1, N, 3)\n    # The difference is broadcasted to (M, N, 3)\n    dist_mat = np.linalg.norm(ri[:, np.newaxis, :] - rj_prime[np.newaxis, :, :], axis=2)\n\n    # Construct the original kernel matrix K\n    K = np.exp(1j * k * dist_mat) / dist_mat\n\n    # Compute the linearized phase function d(r, r')\n    R0_vec = rc - rc_prime\n    R0 = np.linalg.norm(R0_vec)\n    # The direction vector u_hat will be [0, -1, 0] since D > 0\n    u_hat = R0_vec / R0\n\n    # Compute dot products for the linearization\n    ri_minus_rc = ri - rc\n    rj_p_minus_rc_p = rj_prime - rc_prime\n    dot1 = ri_minus_rc @ u_hat\n    dot2 = rj_p_minus_rc_p @ u_hat\n    \n    # Construct the matrix of linearized distances d_ij using broadcasting\n    d_mat = R0 + dot1[:, np.newaxis] - dot2[np.newaxis, :]\n\n    # Construct the residual kernel matrix R\n    residual_phase = dist_mat - d_mat\n    R = np.exp(1j * k * residual_phase) / dist_mat\n\n    def compute_numerical_rank(A, eps):\n        \"\"\"Helper function to compute numerical rank based on singular values.\"\"\"\n        s = np.linalg.svd(A, compute_uv=False)\n        if len(s) == 0:\n            return 0\n        s_max = s[0]\n        # The threshold must be strictly non-negative\n        threshold = eps * s_max if s_max > 0 else 0\n        rank = np.sum(s >= threshold)\n        return int(rank)\n\n    # Compute the numerical ranks and their difference\n    r_K = compute_numerical_rank(K, epsilon)\n    r_R = compute_numerical_rank(R, epsilon)\n    delta_r = r_K - r_R\n\n    return [r_K, r_R, delta_r]\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (k, D, theta)\n        (50.0, 0.5, 0.0),\n        (200.0, 0.5, 0.0),\n        (200.0, 5.0, 0.0),\n        (100.0, 0.5, np.pi / 4),\n    ]\n\n    results = []\n    for case in test_cases:\n        k, D, theta = case\n        result = calculate_ranks(k, D, theta)\n        results.append(result)\n\n    # Format the output string precisely as required: [[rK1,rR1,dr1],[rK2,rR2,dr2],...]\n    inner_parts = []\n    for res in results:\n        # Format each triple as [val1,val2,val3] with no spaces\n        inner_parts.append(f\"[{res[0]},{res[1]},{res[2]}]\")\n    \n    # Join the triples with commas and enclose in brackets\n    final_output = f\"[{','.join(inner_parts)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "3326914"}, {"introduction": "一旦我们知道低秩近似是可行的，一个关键问题是：所需的秩如何依赖于物理设置？这个问题的核心在于，数值秩从根本上与相互作用的“空间-带宽积”相关，而这又取决于相互作用物体的横向空间和角展度。这个练习 [@problem_id:3326998] 提供了一个具体（尽管是理想化的）场景，帮助你建立关于散射物体几何形状（特别是垂直于相互作用方向的维度）如何决定其相互作用矩阵复杂性及数值秩的直观理解。", "problem": "考虑一个三维时谐散射问题，该问题由标量亥姆霍兹方程控制，其自由空间格林函数为 $G(\\mathbf{x},\\mathbf{y}) = \\dfrac{\\exp\\!\\left(i k |\\mathbf{x}-\\mathbf{y}|\\right)}{4\\pi |\\mathbf{x}-\\mathbf{y}|}$，其中 $k$ 是波数，$\\mathbf{x},\\mathbf{y}\\in\\mathbb{R}^{3}$。两个相同的细长团簇沿着由单位向量 $\\hat{\\mathbf{z}}$ 表示的固定传播方向相隔距离 $R$。每个团簇的长度为 $L$，横截面直径为 $D$，且 $L \\gg D$。团簇的取向可以是与 $\\hat{\\mathbf{z}}$ 对齐（其长轴平行于传播方向），也可以是正交取向（其长轴垂直于传播方向）。假设处于高频、远场区域，即 $k R \\gg 1$，$L \\ll R$，$D \\ll R$，并忽略两个团簇之间的多次散射。\n\n令 $\\mathcal{X}$ 和 $\\mathcal{Y}$ 表示两个团簇占据的不相交支撑域，并考虑通过离散化积分算子 $T: f \\mapsto u$ 得到的相互作用矩阵块 $\\mathbf{M}$，其中\n$$\nu(\\mathbf{x}) = \\int_{\\mathcal{Y}} G(\\mathbf{x},\\mathbf{y})\\, f(\\mathbf{y})\\, dS(\\mathbf{y}), \\quad \\mathbf{x}\\in\\mathcal{X}.\n$$\n将 $\\mathbf{M}$ 在固定精度容差 $\\varepsilon$ 下的数值秩定义为最小整数 $r(\\varepsilon)$，使得 $\\mathbf{M}$ 可以被一个秩为 $r(\\varepsilon)$ 的矩阵以精度 $\\varepsilon$ 逼近。在高频、远场区域，$\\mathbf{M}$ 的低秩可逼近性由垂直于 $\\hat{\\mathbf{z}}$ 的横向坐标上的相位变化控制，这是通过对偶 $(\\mathcal{X},\\mathcal{Y})$ 使用 $G(\\mathbf{x},\\mathbf{y})$ 的角谱或菲涅尔近似实现的。\n\n将每个团簇视为一个细长的矩形区域，因此对于平行对齐情况，其在垂直于 $\\hat{\\mathbf{z}}$ 的平面内的横向足迹的特征尺寸为 $D \\times D$，而对于正交对齐情况，其特征尺寸为 $L \\times D$。仅使用标量亥姆霍兹格林函数、横向坐标的二次远场展开，以及基于限制在横向支撑域上的核函数的空间带宽积进行的自由度计数，推导数值秩之比的前导阶渐近表达式：\n$$\n\\frac{r_{\\perp}(\\varepsilon)}{r_{\\parallel}(\\varepsilon)},\n$$\n其中，$r_{\\parallel}(\\varepsilon)$ 对应于两个团簇都与 $\\hat{\\mathbf{z}}$ 对齐的情况，$r_{\\perp}(\\varepsilon)$ 对应于两个团簇都与 $\\hat{\\mathbf{z}}$ 正交的情况，并且 $k$、$R$、$L$、$D$ 和 $\\varepsilon$ 均相同。\n\n你的最终答案必须是仅用 $L$ 和 $D$ 表示的单一闭式符号表达式。无需进行数值计算或四舍五入。答案是无量纲的；不要包含单位。", "solution": "用户希望我扮演一位严谨的STEM教授。我需要首先验证问题，然后提供一个解决方案。\n\n### 第一步：提取已知条件\n- **格林函数**：$G(\\mathbf{x},\\mathbf{y}) = \\dfrac{\\exp(i k |\\mathbf{x}-\\mathbf{y}|)}{4\\pi |\\mathbf{x}-\\mathbf{y}|}$，对于 $\\mathbf{x},\\mathbf{y}\\in\\mathbb{R}^{3}$。\n- **波数**：$k$。\n- **几何结构**：两个相同的细长团簇，沿着单位向量 $\\hat{\\mathbf{z}}$ 相隔距离 $R$。\n- **团簇尺寸**：长度 $L$，直径 $D$，且 $L \\gg D$。\n- **物理区域**：高频、远场，满足 $k R \\gg 1$，$L \\ll R$，$D \\ll R$。\n- **相互作用**：忽略团簇间的多次散射。\n- **支撑域**：$\\mathcal{X}$ 和 $\\mathcal{Y}$ 是两个团簇占据的不相交空间支撑域。\n- **积分算子**：$u(\\mathbf{x}) = \\int_{\\mathcal{Y}} G(\\mathbf{x},\\mathbf{y})\\, f(\\mathbf{y})\\, dS(\\mathbf{y})$，对于 $\\mathbf{x}\\in\\mathcal{X}$。\n- **矩阵**：$\\mathbf{M}$ 是该积分算子的离散化。\n- **数值秩**：$r(\\varepsilon)$ 是以精度 $\\varepsilon$ 逼近 $\\mathbf{M}$ 所需的最小秩。\n- **近似方法**：秩由核函数的相位变化决定，使用菲涅尔近似（横向坐标的二次远场展开）进行分析。\n- **秩估计**：秩将通过基于空间带宽积的自由度计数来估计。\n- **团簇模型**：\n    - **平行对齐 ($\\parallel$)**：每个团簇的长轴平行于 $\\hat{\\mathbf{z}}$。横向足迹的特征尺寸为 $D \\times D$。\n    - **正交对齐 ($\\perp$)**：每个团簇的长轴垂直于 $\\hat{\\mathbf{z}}$。横向足迹的特征尺寸为 $L \\times D$。\n- **目标**：推导比值 $\\frac{r_{\\perp}(\\varepsilon)}{r_{\\parallel}(\\varepsilon)}$ 的前导阶渐近表达式，用 $L$ 和 $D$ 表示。\n\n### 第二步：使用提取的已知条件进行验证\n该问题在计算电磁学和数值分析领域有坚实的科学基础，具体涉及边界积分方程求解器的加速。标量亥姆霍兹方程、其格林函数、数值秩的概念，以及使用菲涅尔近似等低秩近似方法，都是标准且成熟的原理。问题是适定的，提供了明确的目标，并指定了推导方法（菲涅尔近似核的空间带宽积）。语言客观而精确。给定的条件（$L \\gg D$, $kR \\gg 1$, $L \\ll R$）对于许多散射问题在物理上是现实的。问题不包含任何矛盾、歧义或不合理的假设。这是指定领域内一个标准的、非平凡的问题。\n\n### 第三步：结论与行动\n问题是**有效的**。将推导解答。\n\n### 解答推导\n问题要求我们求出细长散射团簇两种不同方向下的数值秩之比 $\\frac{r_{\\perp}(\\varepsilon)}{r_{\\parallel}(\\varepsilon)}$。相互作用矩阵 $\\mathbf{M}$ 的数值秩 $r(\\varepsilon)$ 由连续积分算子的自由度数量决定，而自由度数量又通过限制在团簇横向域上的核函数 $G(\\mathbf{x},\\mathbf{y})$ 的空间带宽积来估计。\n\n设两个团簇 $\\mathcal{X}$ 和 $\\mathcal{Y}$ 的中心相隔向量 $R\\hat{\\mathbf{z}}$。我们可以建立一个坐标系，其中一个点表示为 $\\mathbf{v} = (\\mathbf{v}_t, v_z)$，$\\mathbf{v}_t$ 是横向坐标向量。对于 $\\mathbf{x} \\in \\mathcal{X}$ 和 $\\mathbf{y} \\in \\mathcal{Y}$，我们可以写成 $\\mathbf{x} \\approx ( \\mathbf{x}_t, R)$ 和 $\\mathbf{y} \\approx (\\mathbf{y}_t, 0)$。它们之间的距离是 $|\\mathbf{x} - \\mathbf{y}| = \\sqrt{|\\mathbf{x}_t - \\mathbf{y}_t|^2 + (x_z - y_z)^2}$。\n\n问题指定使用横向坐标的二次远场展开。在远场假设下（$|\\mathbf{x}_t|, |\\mathbf{y}_t| \\ll R$ 且团簇内 $x_z, y_z$ 的变化远小于 $R$），距离可以近似为：\n$$\n|\\mathbf{x}-\\mathbf{y}| \\approx (x_z - y_z) + \\frac{|\\mathbf{x}_t - \\mathbf{y}_t|^2}{2(x_z - y_z)} \\approx R + \\frac{|\\mathbf{x}_t|^2 - 2\\mathbf{x}_t \\cdot \\mathbf{y}_t + |\\mathbf{y}_t|^2}{2R}\n$$\n这是菲涅尔近似的基础。将此代入格林函数 $G(\\mathbf{x}, \\mathbf{y})$，积分算子的核变为：\n$$\nG(\\mathbf{x},\\mathbf{y}) \\approx \\frac{\\exp(i k R)}{4\\pi R} \\exp\\left( i k \\frac{|\\mathbf{x}_t - \\mathbf{y}_t|^2}{2R} \\right)\n$$\n我们可以将核分解为依赖于 $\\mathbf{x}_t$ 和 $\\mathbf{y}_t$ 的部分：\n$$\nG(\\mathbf{x},\\mathbf{y}) \\approx \\left[ \\frac{\\exp(i k R)}{4\\pi R} \\exp\\left(\\frac{ik |\\mathbf{x}_t|^2}{2R}\\right) \\right] \\left[ \\exp\\left(\\frac{ik |\\mathbf{y}_t|^2}{2R}\\right) \\right] \\exp\\left(-i \\frac{k}{R} \\mathbf{x}_t \\cdot \\mathbf{y}_t\\right)\n$$\n项 $\\exp(ik|\\mathbf{x}_t|^2/2R)$ 和 $\\exp(ik|\\mathbf{y}_t|^2/2R)$ 是二次相位因子。形式为 $A(\\mathbf{x}) K_0(\\mathbf{x},\\mathbf{y}) B(\\mathbf{y})$ 的核的数值秩与 $K_0(\\mathbf{x},\\mathbf{y})$ 的数值秩相同，只要 $A(\\mathbf{x})$ 和 $B(\\mathbf{y})$ 不为零（此处它们是幺模的）。因此，秩由本质上的傅里叶型核决定：\n$$\nK_0(\\mathbf{x}_t, \\mathbf{y}_t) = \\exp\\left(-i \\frac{k}{R} \\mathbf{x}_t \\cdot \\mathbf{y}_t\\right)\n$$\n具有此核的算子（其映射关系为从支撑在横向域 $\\Omega_Y$ 上的函数到支撑在 $\\Omega_X$ 上的函数）的数值秩 $r(\\varepsilon)$ 由空间带宽积给出。空间域是 $\\Omega_Y$，其“面积”是 $S_{space} = \\operatorname{Area}(\\Omega_Y)$。核函数将函数映射到“频率”域。频率变量是 $\\mathbf{y}_t$ 的共轭变量，由 $\\boldsymbol{\\nu} = \\frac{k}{2\\pi R} \\mathbf{x}_t$ 给出。频率范围由 $\\mathbf{x}_t$ 在域 $\\Omega_X$ 上的空间范围决定。频带的“面积”是：\n$$\nS_{band} = \\operatorname{Area}\\left(\\left\\{ \\frac{k}{2\\pi R} \\mathbf{x}_t \\mid \\mathbf{x}_t \\in \\Omega_X \\right\\}\\right) = \\left(\\frac{k}{2\\pi R}\\right)^2 \\operatorname{Area}(\\Omega_X)\n$$\n自由度的数量，它与数值秩 $r(\\varepsilon)$ 成正比，是以下乘积：\n$$\nr(\\varepsilon) \\propto S_{space} \\cdot S_{band} = \\operatorname{Area}(\\Omega_Y) \\cdot \\left(\\frac{k}{2\\pi R}\\right)^2 \\operatorname{Area}(\\Omega_X)\n$$\n由于两个团簇是相同的，它们的横向域 $\\Omega_X$ 和 $\\Omega_Y$ 具有相同的面积，我们记为 $S_{transverse}$。\n$$\nr(\\varepsilon) \\propto (S_{transverse})^2 \\left(\\frac{k}{2\\pi R}\\right)^2\n$$\n因子 $(k/2\\pi R)^2$ 和依赖于 $\\varepsilon$ 的比例常数对于两种对齐情况是相同的，并将在比率中抵消。因此，秩与横向面积的平方成正比：\n$$\nr(\\varepsilon) \\propto (S_{transverse})^2\n$$\n\n现在，我们为两种指定情况计算这个值。\n\n**情况1：平行对齐 ($\\parallel$)**\n在此配置中，两个团簇的长轴都与传播方向 $\\hat{\\mathbf{z}}$ 对齐。横向足迹的特征尺寸为 $D \\times D$。横向支撑域的面积是：\n$$\nS_{\\parallel} = D \\times D = D^2\n$$\n这种情况下的数值秩为：\n$$\nr_{\\parallel}(\\varepsilon) \\propto (S_{\\parallel})^2 = (D^2)^2 = D^4\n$$\n\n**情况2：正交对齐 ($\\perp$)**\n在此配置中，两个团簇的长轴都垂直于传播方向 $\\hat{\\mathbf{z}}$。横向足迹的特征尺寸为 $L \\times D$。横向支撑域的面积是：\n$$\nS_{\\perp} = L \\times D = LD\n$$\n这种情况下的数值秩为：\n$$\nr_{\\perp}(\\varepsilon) \\propto (S_{\\perp})^2 = (LD)^2 = L^2 D^2\n$$\n\n**数值秩之比**\n最后，我们计算两种配置的秩之比：\n$$\n\\frac{r_{\\perp}(\\varepsilon)}{r_{\\parallel}(\\varepsilon)} = \\frac{C \\cdot L^2 D^2}{C \\cdot D^4}\n$$\n其中 $C$ 代表公共的比例常数。\n$$\n\\frac{r_{\\perp}(\\varepsilon)}{r_{\\parallel}(\\varepsilon)} = \\frac{L^2 D^2}{D^4} = \\frac{L^2}{D^2} = \\left(\\frac{L}{D}\\right)^2\n$$\n结果仅依赖于 $L$ 和 $D$，符合要求。这个结果在物理上是直观的：一个更大的横向截面（正交情况）导致核函数具有更快的相位振荡，这需要一个更高秩的表示。考虑到 $L \\gg D$，我们有 $r_{\\perp}(\\varepsilon) \\gg r_{\\parallel}(\\varepsilon)$。", "answer": "$$\n\\boxed{\\left(\\frac{L}{D}\\right)^{2}}\n$$", "id": "3326998"}, {"introduction": "低秩近似从来都不是精确的，因此理解近似误差如何影响最终的物理结果至关重要。通过使用散射场的积分表示（Stratton-Chu 公式）和基本的数学不等式，我们可以推导出一个严格的界。这个界限将计算出的表面电流误差与可观测的物理量——远场散射振幅的误差联系起来。这项实践 [@problem_id:3326935] 演示了如何进行误差分析，从而根据低秩压缩阶段使用的容差，为最终仿真输出的准确性提供保证。", "problem": "考虑一个电磁平面波被一个完美电导体障碍物进行的的时谐散射。该障碍物具有光滑的闭合边界面 $\\Gamma \\subset \\mathbb{R}^{3}$，并嵌入在一个均匀背景介质中。该介质的特征为波数 $k0$ 和本征阻抗 $\\eta0$。精确的感应表面电流密度是一个矢量场 $\\mathbf{J} \\in L^{2}(\\Gamma)^{3}$，它由电场积分方程得到。假设一个基于振荡格林核的低秩矩阵近似（例如，$\\mathcal{H}$-矩阵或快速多极子类型压缩）的数值格式产生了一个近似电流 $\\mathbf{J}_{h} \\in L^{2}(\\Gamma)^{3}$，其 $L^{2}$ 误差有界，满足 $\\|\\mathbf{J}-\\mathbf{J}_{h}\\|_{L^{2}(\\Gamma)} \\le \\varepsilon$，其中 $\\varepsilon0$ 从低秩近似和离散化稳定性中可知。\n\n在观测方向 $\\hat{\\mathbf{r}} \\in \\mathbb{S}^{2}$ 上的远场散射振幅 $\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}})$ 由纯表面电流的 Stratton–Chu (SC) 表示法给出，\n$$\n\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) \\;=\\; \\frac{i k \\, \\eta}{4 \\pi} \\, \\hat{\\mathbf{r}} \\times \\Big( \\hat{\\mathbf{r}} \\times \\int_{\\Gamma} \\exp\\!\\big(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}'\\big) \\, \\mathbf{J}(\\mathbf{r}') \\, \\mathrm{d}S' \\Big),\n$$\n而 $\\mathbf{E}^{\\infty}_{h}(\\hat{\\mathbf{r}})$ 的定义类似，只需将 $\\mathbf{J}$ 替换为 $\\mathbf{J}_{h}$。此处 $i$ 是虚数单位，$\\times$ 表示矢量叉积。令 $|\\Gamma|$ 表示 $\\Gamma$ 的表面积，并令 $\\|\\cdot\\|_{2}$ 表示 $\\mathbb{C}^{3}$ 中矢量的欧几里得范数。\n\n仅使用 SC 表示法和基本范数不等式，推导一个形式如下的方向一致上界\n$$\n\\sup_{\\hat{\\mathbf{r}} \\in \\mathbb{S}^{2}} \\big\\| \\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) - \\mathbf{E}^{\\infty}_{h}(\\hat{\\mathbf{r}}) \\big\\|_{2} \\;\\le\\; C \\, \\varepsilon,\n$$\n并计算仅使用给定信息所能保证的最紧常数 $C$。将您的最终界表示为关于 $k$, $\\eta$, $|\\Gamma|$ 和 $\\varepsilon$ 的单个闭式解析表达式。最终答案中不要包含物理单位。", "solution": "该问题要求推导远场散射振幅误差的一个方向一致上界，该误差源于数值计算的表面电流密度的误差。我们需要根据所提供的信息找到可能的最紧上界。\n\n令精确和近似的表面电流密度分别为 $\\mathbf{J}$ 和 $\\mathbf{J}_{h}$。电流中的误差为 $\\Delta\\mathbf{J}(\\mathbf{r}') = \\mathbf{J}(\\mathbf{r}') - \\mathbf{J}_{h}(\\mathbf{r}')$。我们已知该误差的 $L^{2}$-范数由 $\\varepsilon$ 界定：\n$$\n\\|\\Delta\\mathbf{J}\\|_{L^{2}(\\Gamma)} = \\left( \\int_{\\Gamma} \\|\\Delta\\mathbf{J}(\\mathbf{r}')\\|_{2}^{2} \\, \\mathrm{d}S' \\right)^{1/2} \\le \\varepsilon\n$$\n\n远场散射振幅 $\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}})$ 由 Stratton–Chu 表示法给出。利用积分和叉积运算的线性性质，远场振幅的误差 $\\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) = \\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) - \\mathbf{E}^{\\infty}_{h}(\\hat{\\mathbf{r}})$ 可以表示为：\n$$\n\\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) = \\frac{i k \\, \\eta}{4 \\pi} \\, \\hat{\\mathbf{r}} \\times \\left( \\hat{\\mathbf{r}} \\times \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\mathbf{J}(\\mathbf{r}') \\, \\mathrm{d}S' \\right) - \\frac{i k \\, \\eta}{4 \\pi} \\, \\hat{\\mathbf{r}} \\times \\left( \\hat{\\mathbf{r}} \\times \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\mathbf{J}_{h}(\\mathbf{r}') \\, \\mathrm{d}S' \\right)\n$$\n$$\n\\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) = \\frac{i k \\, \\eta}{4 \\pi} \\, \\hat{\\mathbf{r}} \\times \\left( \\hat{\\mathbf{r}} \\times \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\left( \\mathbf{J}(\\mathbf{r}') - \\mathbf{J}_{h}(\\mathbf{r}') \\right) \\, \\mathrm{d}S' \\right)\n$$\n$$\n\\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) = \\frac{i k \\, \\eta}{4 \\pi} \\, \\hat{\\mathbf{r}} \\times \\left( \\hat{\\mathbf{r}} \\times \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\Delta\\mathbf{J}(\\mathbf{r}') \\, \\mathrm{d}S' \\right)\n$$\n\n我们需要找到此误差的欧几里得范数在所有可能的观测方向 $\\hat{\\mathbf{r}} \\in \\mathbb{S}^{2}$ 上的上确界。\n$$\n\\sup_{\\hat{\\mathbf{r}} \\in \\mathbb{S}^{2}} \\left\\| \\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) \\right\\|_{2} = \\sup_{\\hat{\\mathbf{r}} \\in \\mathbb{S}^{2}} \\left\\| \\frac{i k \\, \\eta}{4 \\pi} \\, \\hat{\\mathbf{r}} \\times \\left( \\hat{\\mathbf{r}} \\times \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\Delta\\mathbf{J}(\\mathbf{r}') \\, \\mathrm{d}S' \\right) \\right\\|_{2}\n$$\n\n首先，我们使用标量 $\\alpha \\in \\mathbb{C}$ 的性质 $\\|\\alpha \\mathbf{v}\\|_{2} = |\\alpha| \\|\\mathbf{v}\\|_{2}$。前置因子为 $\\frac{i k \\eta}{4\\pi}$。由于 $k0$ 和 $\\eta0$，其模为 $\\left| \\frac{i k \\eta}{4\\pi} \\right| = \\frac{|i| k \\eta}{4\\pi} = \\frac{k \\eta}{4\\pi}$。\n$$\n\\left\\| \\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) \\right\\|_{2} = \\frac{k \\eta}{4\\pi} \\left\\| \\hat{\\mathbf{r}} \\times \\left( \\hat{\\mathbf{r}} \\times \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\Delta\\mathbf{J}(\\mathbf{r}') \\, \\mathrm{d}S' \\right) \\right\\|_{2}\n$$\n\n令 $\\mathbf{V}(\\hat{\\mathbf{r}}) = \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\Delta\\mathbf{J}(\\mathbf{r}') \\, \\mathrm{d}S'$。项 $\\hat{\\mathbf{r}} \\times (\\hat{\\mathbf{r}} \\times \\mathbf{V})$ 表示矢量 $-\\mathbf{V}$ 在垂直于单位矢量 $\\hat{\\mathbf{r}}$ 的平面上的投影。这种投影的范数总是小于或等于原始矢量的范数。即，对于任何矢量 $\\mathbf{V} \\in \\mathbb{C}^{3}$ 和单位矢量 $\\hat{\\mathbf{r}} \\in \\mathbb{R}^{3}$，我们有 $\\|\\hat{\\mathbf{r}} \\times (\\hat{\\mathbf{r}} \\times \\mathbf{V})\\|_{2} \\le \\|\\mathbf{V}\\|_{2}$。这个不等式是紧的，当 $\\mathbf{V}$ 与 $\\hat{\\mathbf{r}}$ 正交时，等号成立。\n应用这个不等式，我们得到：\n$$\n\\left\\| \\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) \\right\\|_{2} \\le \\frac{k \\eta}{4\\pi} \\left\\| \\mathbf{V}(\\hat{\\mathbf{r}}) \\right\\|_{2} = \\frac{k \\eta}{4\\pi} \\left\\| \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\Delta\\mathbf{J}(\\mathbf{r}') \\, \\mathrm{d}S' \\right\\|_{2}\n$$\n\n接下来，我们使用积分的三角不等式，该不等式表明积分的范数小于或等于范数的积分：$\\|\\int \\mathbf{f}(x) \\, dx\\|_{2} \\le \\int \\|\\mathbf{f}(x)\\|_{2} \\, dx$。\n$$\n\\left\\| \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\Delta\\mathbf{J}(\\mathbf{r}') \\, \\mathrm{d}S' \\right\\|_{2} \\le \\int_{\\Gamma} \\left\\| \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2} \\, \\mathrm{d}S'\n$$\n指数项是一个模为1的复标量，即 $|\\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}')| = 1$，因为其自变量是纯虚数。因此：\n$$\n\\int_{\\Gamma} \\left\\| \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2} \\, \\mathrm{d}S' = \\int_{\\Gamma} |\\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}')| \\left\\| \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2} \\, \\mathrm{d}S' = \\int_{\\Gamma} \\left\\| \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2} \\, \\mathrm{d}S'\n$$\n这个中间界与方向 $\\hat{\\mathbf{r}}$ 无关。结合目前的步骤：\n$$\n\\sup_{\\hat{\\mathbf{r}} \\in \\mathbb{S}^{2}} \\left\\| \\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) \\right\\|_{2} \\le \\frac{k \\eta}{4\\pi} \\int_{\\Gamma} \\left\\| \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2} \\, \\mathrm{d}S'\n$$\n\n剩下的积分是 $\\Delta\\mathbf{J}$ 的大小在曲面 $\\Gamma$ 上的 $L^1$-范数。我们已知的是 $L^2$-范数的一个界。为了关联这两个范数，我们使用积分的柯西-施瓦茨不等式。令 $f(\\mathbf{r}') = \\|\\Delta\\mathbf{J}(\\mathbf{r}')\\|_{2}$ 且 $g(\\mathbf{r}') = 1$。该不等式表述为：\n$$\n\\left( \\int_{\\Gamma} f(\\mathbf{r}') g(\\mathbf{r}') \\, \\mathrm{d}S' \\right)^2 \\le \\left( \\int_{\\Gamma} |f(\\mathbf{r}')|^2 \\, \\mathrm{d}S' \\right) \\left( \\int_{\\Gamma} |g(\\mathbf{r}')|^2 \\, \\mathrm{d}S' \\right)\n$$\n代入我们的函数：\n$$\n\\left( \\int_{\\Gamma} \\left\\| \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2} \\cdot 1 \\, \\mathrm{dS}' \\right)^2 \\le \\left( \\int_{\\Gamma} \\left\\| \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2}^2 \\, \\mathrm{d}S' \\right) \\left( \\int_{\\Gamma} 1^2 \\, \\mathrm{d}S' \\right)\n$$\n右边的项分别是 $\\Delta\\mathbf{J}$ 的 $L^2$-范数的平方和表面积 $|\\Gamma|$。\n$$\n\\left( \\int_{\\Gamma} \\left\\| \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2} \\, \\mathrm{d}S' \\right)^2 \\le \\|\\Delta\\mathbf{J}\\|_{L^2(\\Gamma)}^2 \\cdot |\\Gamma|\n$$\n两边取平方根，得到：\n$$\n\\int_{\\Gamma} \\left\\| \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2} \\, \\mathrm{d}S' \\le \\|\\Delta\\mathbf{J}\\|_{L^2(\\Gamma)} \\sqrt{|\\Gamma|}\n$$\n\n最后，我们将此结果代入远场误差的不等式中，并使用给定条件 $\\|\\Delta\\mathbf{J}\\|_{L^2(\\Gamma)} \\le \\varepsilon$：\n$$\n\\sup_{\\hat{\\mathbf{r}} \\in \\mathbb{S}^{2}} \\left\\| \\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) \\right\\|_{2} \\le \\frac{k \\eta}{4\\pi} \\left( \\|\\Delta\\mathbf{J}\\|_{L^2(\\Gamma)} \\sqrt{|\\Gamma|} \\right) \\le \\frac{k \\eta \\varepsilon \\sqrt{|\\Gamma|}}{4\\pi}\n$$\n这就给出了所求的方向一致上界。常数 $C$ 为 $C = \\frac{k \\eta \\sqrt{|\\Gamma|}}{4\\pi}$。这个界是仅使用给定信息所能得到的最紧界，因为可以构造一个最坏情况下的误差电流 $\\Delta\\mathbf{J}$，它能在某个特定方向 $\\hat{\\mathbf{r}}$ 上使推导中使用的每个不等式都取等号。例如，对于一个固定的方向 $\\hat{\\mathbf{r}}_0$，一个形式为 $\\Delta\\mathbf{J}(\\mathbf{r}') = c \\exp(i k \\hat{\\mathbf{r}}_0 \\cdot \\mathbf{r}') \\mathbf{u}_0$ 且满足 $\\|\\Delta\\mathbf{J}\\|_{L^2(\\Gamma)} = \\varepsilon$ 和 $\\mathbf{u}_0 \\perp \\hat{\\mathbf{r}}_0$ 的误差电流将达到这个界。\n\n因此，方向一致上界的最终表达式为：\n$$\n\\sup_{\\hat{\\mathbf{r}} \\in \\mathbb{S}^{2}} \\big\\| \\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) - \\mathbf{E}^{\\infty}_{h}(\\hat{\\mathbf{r}}) \\big\\|_{2} \\le \\frac{k \\eta \\varepsilon \\sqrt{|\\Gamma|}}{4 \\pi}\n$$", "answer": "$$\\boxed{\\frac{k \\eta \\varepsilon \\sqrt{|\\Gamma|}}{4 \\pi}}$$", "id": "3326935"}]}