{"hands_on_practices": [{"introduction": "逆散射成像的核心在于建立散射体物性与测量数据之间的数学关系。然而，这种关系通常是高度非线性的，难以直接求解。本练习将引导您推导两种关键的线性化近似——玻恩 (Born) 近似和莱托夫 (Rytov) 近似——它们是许多快速成像算法的理论基石。通过这个实践，您将揭示散射数据与物体介电常数扰动的傅里叶变换之间的深刻联系，这是傅里叶衍射定理的核心思想，也是理解波动成像物理本质的关键一步 [@problem_id:3320197]。", "problem": "考虑在横向电 (TE) 极化下的二维时谐电磁散射，其中平面外电场 $E(\\mathbf{r})$ 在具有空间变化的介电常数 $\\epsilon(\\mathbf{r})$ 和背景介电常数 $\\epsilon_{b}$ 的非磁性介质中满足标量 Helmholtz 方程。设角频率为 $\\omega$，背景波数为 $k_{b} = \\omega \\sqrt{\\mu_{0} \\epsilon_{b}}$，其中 $\\mu_{0}$ 是真空磁导率。定义无量纲介电常数衬度为 $\\chi(\\mathbf{r}) = \\frac{\\epsilon(\\mathbf{r}) - \\epsilon_{b}}{\\epsilon_{b}}$，并假设 $\\chi(\\mathbf{r})$ 是紧支集且其幅值足够小，以至于单次散射物理占主导地位。\n\n总场 $E(\\mathbf{r})$ 遵循非齐次 Helmholtz 方程 $(\\nabla^{2} + k_{b}^{2}) E(\\mathbf{r}) = -k_{b}^{2} \\chi(\\mathbf{r}) E(\\mathbf{r})$，并满足 Lippmann–Schwinger 积分表示，其中二维背景格林函数为 $G(\\mathbf{r}, \\mathbf{r}') = \\frac{i}{4} H_{0}^{(1)}(k_{b} |\\mathbf{r} - \\mathbf{r}'|)$，$H_{0}^{(1)}(\\cdot)$ 是第一类零阶 Hankel 函数。入射场是沿方向 $\\hat{\\mathbf{s}}_{i}$ 传播的单位振幅平面波 $E_{i}(\\mathbf{r}) = \\exp(i k_{b} \\hat{\\mathbf{s}}_{i} \\cdot \\mathbf{r})$，接收器位于 $\\mathbf{r}_{r} = R \\hat{\\mathbf{s}}_{r}$，其中 $R \\gg a$，$\\hat{\\mathbf{s}}_{r}$ 是观测方向，$a$ 是非均匀性的特征长度尺度。\n\n设介电常数衬度为中心高斯函数，\n$$\n\\chi(\\mathbf{r}) = \\chi_{0} \\exp\\!\\left(-\\frac{|\\mathbf{r}|^{2}}{a^{2}}\\right),\n$$\n其常数振幅 $\\chi_{0}$ 满足 $|\\chi_{0}| \\ll 1$。定义散射矢量为 $\\mathbf{q} = k_{b} (\\hat{\\mathbf{s}}_{r} - \\hat{\\mathbf{s}}_{i})$。\n\n仅使用电磁学的第一性原理和适用于二维远场的渐近分析，推导通过 Born 线性化和 Rytov 线性化获得的前导阶远场线性化数据函数。为移除几何扩散和接收器相位因子，定义归一化远场 Rytov 数据函数\n$$\nD(\\hat{\\mathbf{s}}_{r}, \\hat{\\mathbf{s}}_{i}) \\equiv \\sqrt{\\frac{\\pi k_{b} R}{2}} \\, \\exp\\!\\left(-i\\big(k_{b} R - \\tfrac{\\pi}{4} - k_{b} \\hat{\\mathbf{s}}_{i} \\cdot \\mathbf{r}_{r}\\big)\\right) \\left[\\ln\\!\\big(E(\\mathbf{r}_{r})\\big) - \\ln\\!\\big(E_{i}(\\mathbf{r}_{r})\\big)\\right].\n$$\n\n假设 $|\\chi_{0}| \\ll 1$ 并在 $\\chi_{0}$ 的前导阶上进行计算，请用 $\\chi_{0}$、$a$、$k_{b}$ 和 $|\\mathbf{q}|$ 为 $D(\\hat{\\mathbf{s}}_{r}, \\hat{\\mathbf{s}}_{i})$ 提供一个单一的闭式解析表达式。您的答案必须是单一的解析表达式。不需要数值计算，也不需要四舍五入。", "solution": "该问题被验证为具有科学依据、适定且客观。它代表了反演散射理论中的一个标准表述。\n\n起点是总电场 $E(\\mathbf{r})$ 的 Lippmann-Schwinger 积分方程，该总电场是入射场 $E_i(\\mathbf{r})$ 和散射场 $E_s(\\mathbf{r})$ 的和：\n$$\nE(\\mathbf{r}) = E_i(\\mathbf{r}) + \\int_{\\mathbb{R}^2} G(\\mathbf{r}, \\mathbf{r}') k_b^2 \\chi(\\mathbf{r}') E(\\mathbf{r}') d^2\\mathbf{r}'\n$$\n这里，$\\mathbf{r}$ 是观测点，$\\mathbf{r}'$ 是在散射体域上的积分变量，$k_b$ 是背景波数，$\\chi(\\mathbf{r}')$ 是介电常数衬度，$G(\\mathbf{r}, \\mathbf{r}')$ 是二维背景格林函数。总场可以写为 $E = E_i + E_s$。\n\n该问题要求基于线性化推导一个数据函数。我们考虑两种标准的线性化：Born 近似和 Rytov 近似，两者都适用于弱散射，即当 $|\\chi_0| \\ll 1$ 时。\n\n第一 Born 近似包括将积分内未知的总场 $E(\\mathbf{r}')$ 替换为已知的入射场 $E_i(\\mathbf{r}') = \\exp(i k_b \\hat{\\mathbf{s}}_i \\cdot \\mathbf{r}')$。这将方程相对于 $\\chi$ 线性化，并得到 Born 散射场 $E_s^{(B)}$：\n$$\nE_s^{(B)}(\\mathbf{r}) = k_b^2 \\int_{\\mathbb{R}^2} G(\\mathbf{r}, \\mathbf{r}') \\chi(\\mathbf{r}') E_i(\\mathbf{r}') d^2\\mathbf{r}'\n$$\nRytov 近似将总场表示为一个复相位的指数，$E(\\mathbf{r}) = \\exp[\\phi(\\mathbf{r})]$。入射场为 $E_i(\\mathbf{r}) = \\exp[\\phi_i(\\mathbf{r})]$，其中 $\\phi_i(\\mathbf{r}) = i k_b \\hat{\\mathbf{s}}_i \\cdot \\mathbf{r}$。那么总相位为 $\\phi(\\mathbf{r}) = \\phi_i(\\mathbf{r}) + \\phi_s(\\mathbf{r})$，其中 $\\phi_s(\\mathbf{r})$ 是散射相位。数据函数 $D$ 定义中的对数量是 $\\ln(E(\\mathbf{r}_r)) - \\ln(E_i(\\mathbf{r}_r)) = \\ln(E(\\mathbf{r}_r)/E_i(\\mathbf{r}_r)) = \\phi_s(\\mathbf{r}_r)$。\n\n在弱散射假设下，Born 和 Rytov 近似是相关的。Born 近似下的总场是 $E^{(B)}(\\mathbf{r}) = E_i(\\mathbf{r}) + E_s^{(B)}(\\mathbf{r}) = E_i(\\mathbf{r}) (1 + E_s^{(B)}(\\mathbf{r})/E_i(\\mathbf{r}))$。在衬度 $\\chi$ 的一阶上，散射相位由下式给出：\n$$\n\\phi_s(\\mathbf{r}) = \\ln\\left(\\frac{E(\\mathbf{r})}{E_i(\\mathbf{r})}\\right) \\approx \\ln\\left(1 + \\frac{E_s^{(B)}(\\mathbf{r})}{E_i(\\mathbf{r})}\\right) \\approx \\frac{E_s^{(B)}(\\mathbf{r})}{E_i(\\mathbf{r})}\n$$\n最后一步使用了泰勒展开 $\\ln(1+z) \\approx z$（对于小的 $z$），这是合理的，因为 $E_s^{(B)}$ 是 $\\chi_0 \\ll 1$ 的阶。因此，为了找到前导阶的 Rytov 数据函数，我们可以计算 Born 散射场 $E_s^{(B)}$。\n\n我们在远场接收器位置 $\\mathbf{r}_r = R \\hat{\\mathbf{s}}_r$ 处计算 $E_s^{(B)}$，其中 $R \\gg a$，$a$ 是散射体的特征尺寸。我们代入 $G(\\mathbf{r}, \\mathbf{r}')$、$E_i(\\mathbf{r}')$ 和 $\\chi(\\mathbf{r}')$ 的给定形式：\n$$\nE_s^{(B)}(\\mathbf{r}_r) = k_b^2 \\int_{\\mathbb{R}^2} \\frac{i}{4} H_0^{(1)}(k_b |\\mathbf{r}_r - \\mathbf{r}'|) \\chi(\\mathbf{r}') \\exp(i k_b \\hat{\\mathbf{s}}_i \\cdot \\mathbf{r}') d^2\\mathbf{r}'\n$$\n在远场极限 ($|\\mathbf{r}_r| = R \\to \\infty$)下，我们使用 Hankel 函数的渐近展开 $H_0^{(1)}(z) \\approx \\sqrt{\\frac{2}{\\pi z}} \\exp(i(z - \\frac{\\pi}{4}))$（对于大的 $z$）。自变量为 $z = k_b |\\mathbf{r}_r - \\mathbf{r}'|$。由于 $R \\gg |\\mathbf{r}'|$，我们将距离近似为 $|\\mathbf{r}_r - \\mathbf{r}'| \\approx R - \\hat{\\mathbf{s}}_r \\cdot \\mathbf{r}'$。这个近似用在指数的快变相位项中。在慢变振幅项 $\\sqrt{1/z}$ 中，我们可以近似 $|\\mathbf{r}_r - \\mathbf{r}'| \\approx R$。\n$$\nH_0^{(1)}(k_b |\\mathbf{r}_r - \\mathbf{r}'|) \\approx \\sqrt{\\frac{2}{\\pi k_b R}} \\exp\\left(i\\left(k_b (R - \\hat{\\mathbf{s}}_r \\cdot \\mathbf{r}') - \\frac{\\pi}{4}\\right)\\right)\n$$\n将此代入 $E_s^{(B)}(\\mathbf{r}_r)$ 的积分中：\n$$\nE_s^{(B)}(\\mathbf{r}_r) \\approx \\frac{i k_b^2}{4} \\int_{\\mathbb{R}^2} \\left[ \\sqrt{\\frac{2}{\\pi k_b R}} \\exp\\left(i(k_b R - \\frac{\\pi}{4})\\right) \\exp(-i k_b \\hat{\\mathbf{s}}_r \\cdot \\mathbf{r}') \\right] \\chi(\\mathbf{r}') \\exp(i k_b \\hat{\\mathbf{s}}_i \\cdot \\mathbf{r}') d^2\\mathbf{r}'\n$$\n提出与 $\\mathbf{r}'$ 无关的项：\n$$\nE_s^{(B)}(\\mathbf{r}_r) \\approx \\frac{i k_b^2}{4} \\sqrt{\\frac{2}{\\pi k_b R}} \\exp\\left(i(k_b R - \\frac{\\pi}{4})\\right) \\int_{\\mathbb{R}^2} \\chi(\\mathbf{r}') \\exp(-i k_b (\\hat{\\mathbf{s}}_r - \\hat{\\mathbf{s}}_i) \\cdot \\mathbf{r}') d^2\\mathbf{r}'\n$$\n该积分是衬度 $\\chi(\\mathbf{r}')$ 的二维傅里叶变换，记为 $\\tilde{\\chi}(\\mathbf{k})$，在散射矢量 $\\mathbf{q} = k_b (\\hat{\\mathbf{s}}_r - \\hat{\\mathbf{s}}_i)$ 处求值。\n$$\n\\tilde{\\chi}(\\mathbf{q}) = \\int_{\\mathbb{R}^2} \\chi(\\mathbf{r}') \\exp(-i \\mathbf{q} \\cdot \\mathbf{r}') d^2\\mathbf{r}'\n$$\n所以，散射场为：\n$$\nE_s^{(B)}(\\mathbf{r}_r) \\approx \\frac{i k_b^2}{4} \\sqrt{\\frac{2}{\\pi k_b R}} \\exp\\left(i(k_b R - \\frac{\\pi}{4})\\right) \\tilde{\\chi}(\\mathbf{q})\n$$\n现在我们计算 Rytov 数据函数 $D(\\hat{\\mathbf{s}}_r, \\hat{\\mathbf{s}}_i)$。使用 $\\ln(E/E_i) \\approx E_s^{(B)}/E_i$：\n$$\nD(\\hat{\\mathbf{s}}_{r}, \\hat{\\mathbf{s}}_{i}) \\approx \\sqrt{\\frac{\\pi k_{b} R}{2}} \\, \\exp\\left(-i\\left(k_{b} R - \\frac{\\pi}{4} - k_{b} \\hat{\\mathbf{s}}_{i} \\cdot \\mathbf{r}_{r}\\right)\\right) \\frac{E_s^{(B)}(\\mathbf{r}_r)}{E_i(\\mathbf{r}_r)}\n$$\n代入 $E_i(\\mathbf{r}_r) = \\exp(i k_b \\hat{\\mathbf{s}}_i \\cdot \\mathbf{r}_r)$：\n$$\nD(\\hat{\\mathbf{s}}_{r}, \\hat{\\mathbf{s}}_{i}) \\approx \\sqrt{\\frac{\\pi k_{b} R}{2}} \\, \\exp\\left(-i(k_{b} R - \\frac{\\pi}{4})\\right) \\exp\\left(i k_{b} \\hat{\\mathbf{s}}_{i} \\cdot \\mathbf{r}_{r}\\right) \\frac{E_s^{(B)}(\\mathbf{r}_r)}{\\exp(i k_b \\hat{\\mathbf{s}}_i \\cdot \\mathbf{r}_r)}\n$$\n包含 $\\exp(i k_b \\hat{\\mathbf{s}}_i \\cdot \\mathbf{r}_r)$ 的项相互抵消：\n$$\nD(\\hat{\\mathbf{s}}_{r}, \\hat{\\mathbf{s}}_{i}) \\approx \\sqrt{\\frac{\\pi k_{b} R}{2}} \\, \\exp\\left(-i(k_{b} R - \\frac{\\pi}{4})\\right) E_s^{(B)}(\\mathbf{r}_r)\n$$\n代入我们得到的 $E_s^{(B)}(\\mathbf{r}_r)$ 表达式：\n$$\nD \\approx \\sqrt{\\frac{\\pi k_{b} R}{2}} \\exp\\left(-i(k_{b} R - \\frac{\\pi}{4})\\right) \\left[ \\frac{i k_b^2}{4} \\sqrt{\\frac{2}{\\pi k_b R}} \\exp\\left(i(k_b R - \\frac{\\pi}{4})\\right) \\tilde{\\chi}(\\mathbf{q}) \\right]\n$$\n几何因子和相位因子相互抵消：\n$$\n\\left(\\sqrt{\\frac{\\pi k_b R}{2}}\\sqrt{\\frac{2}{\\pi k_b R}}\\right) \\left(\\exp\\left(-i(k_b R - \\frac{\\pi}{4})\\right)\\exp\\left(i(k_b R - \\frac{\\pi}{4})\\right)\\right) = 1 \\cdot 1 = 1\n$$\n这留下了一个非常简单的关系：\n$$\nD(\\hat{\\mathbf{s}}_{r}, \\hat{\\mathbf{s}}_{i}) \\approx \\frac{i k_b^2}{4} \\tilde{\\chi}(\\mathbf{q})\n$$\n最后一步是计算给定高斯衬度 $\\chi(\\mathbf{r}) = \\chi_0 \\exp(-|\\mathbf{r}|^2/a^2)$ 的傅里叶变换。\n$$\n\\tilde{\\chi}(\\mathbf{q}) = \\chi_0 \\int_{\\mathbb{R}^2} \\exp\\left(-\\frac{|\\mathbf{r}'|^2}{a^2}\\right) \\exp(-i \\mathbf{q} \\cdot \\mathbf{r}') d^2\\mathbf{r}'\n$$\n这是一个标准的高斯函数的二维傅里叶变换。在笛卡尔坐标系 $\\mathbf{r}'=(x,y)$ 和 $\\mathbf{q}=(q_x,q_y)$ 下，积分可以分离：\n$$\n\\tilde{\\chi}(\\mathbf{q}) = \\chi_0 \\left( \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{x^2}{a^2}\\right)\\exp(-iq_x x)dx \\right) \\left( \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{y^2}{a^2}\\right)\\exp(-iq_y y)dy \\right)\n$$\n使用标准的一维高斯傅里叶变换积分 $\\int_{-\\infty}^{\\infty} \\exp(-\\alpha u^2) \\exp(-i k u) du = \\sqrt{\\pi/\\alpha} \\exp(-k^2/(4\\alpha))$，其中 $\\alpha = 1/a^2$：\n$$\n\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{x^2}{a^2}\\right)\\exp(-iq_x x)dx = \\sqrt{\\pi a^2} \\exp\\left(-\\frac{q_x^2 a^2}{4}\\right) = a\\sqrt{\\pi} \\exp\\left(-\\frac{q_x^2 a^2}{4}\\right)\n$$\n对 $y$ 的积分是相同的。将它们相乘得到：\n$$\n\\tilde{\\chi}(\\mathbf{q}) = \\chi_0 (a\\sqrt{\\pi})(a\\sqrt{\\pi}) \\exp\\left(-\\frac{q_x^2 a^2}{4}\\right) \\exp\\left(-\\frac{q_y^2 a^2}{4}\\right) = \\chi_0 \\pi a^2 \\exp\\left(-\\frac{(q_x^2+q_y^2)a^2}{4}\\right)\n$$\n认识到 $q_x^2+q_y^2 = |\\mathbf{q}|^2$，我们得到：\n$$\n\\tilde{\\chi}(\\mathbf{q}) = \\chi_0 \\pi a^2 \\exp\\left(-\\frac{|\\mathbf{q}|^2 a^2}{4}\\right)\n$$\n最后，将此代入 $D(\\hat{\\mathbf{s}}_r, \\hat{\\mathbf{s}}_i)$ 的表达式中：\n$$\nD(\\hat{\\mathbf{s}}_{r}, \\hat{\\mathbf{s}}_{i}) = \\frac{i k_b^2}{4} \\left( \\chi_0 \\pi a^2 \\exp\\left(-\\frac{|\\mathbf{q}|^2 a^2}{4}\\right) \\right) = \\frac{i \\pi \\chi_0 a^2 k_b^2}{4} \\exp\\left(-\\frac{|\\mathbf{q}|^2 a^2}{4}\\right)\n$$\n这就是归一化 Rytov 数据函数在 $\\chi_0$ 的前导阶上的最终闭式表达式。", "answer": "$$\\boxed{\\frac{i \\pi \\chi_{0} a^{2} k_{b}^{2}}{4} \\exp\\left(-\\frac{|\\mathbf{q}|^{2} a^{2}}{4}\\right)}$$", "id": "3320197"}, {"introduction": "在建立了正演模型之后，我们面临着逆散射问题的核心挑战：如何从充满噪声的测量数据中稳定地反演出目标的物性参数。本练习将带您进入统计反演的世界，运用贝叶斯定理来构建一个形式完备且功能强大的反演框架。您将亲手计算一个最大后验 (Maximum A Posteriori, MAP) 估计，学会如何融合代表数据拟合的似然函数和代表先验知识的正则化项，以处理实际测量中普遍存在的相关噪声，从而获得一个物理意义上更可靠的解 [@problem_id:3320225]。", "problem": "考虑一个二维时谐电磁（EM）散射实验，其角频率为 $\\omega$，在横磁（TM）极化下进行。背景是均匀无损耗的，相对介电常数为 $\\epsilon_{b}$，磁导率为 $\\mu_{0}$。位于 $\\mathbf{r}_{0}$ 处的一个亚波长电介质夹杂物，由一个实值标量对比度参数 $\\chi$（无量纲）建模，该参数支撑在 $\\mathbf{r}_{0}$ 附近一个面积为 $\\Delta S$ 的小区域上。总场 $E(\\mathbf{r})$ 满足频域麦克斯韦方程组，该方程组（对于TM极化）可简化为关于 $E_{z}(\\mathbf{r})$ 的标量亥姆霍兹方程，其波数为 $k=\\omega\\sqrt{\\mu_{0}\\epsilon_{b}}$，而散射场满足 Lippmann–Schwinger 积分方程。在一阶玻恩近似下，使用多个经过相位参考的照明和接收器（从而从数据模型中移除了格林函数的相位），$M$ 分量的实数数据向量 $\\mathbf{y}\\in\\mathbb{R}^{M}$ 服从以下线性模型：\n$$\n\\mathbf{y}=\\mathbf{A}\\,\\chi+\\mathbf{n},\n$$\n其中 $\\mathbf{A}\\in\\mathbb{R}^{M\\times 1}$ 是一个已知的灵敏度向量，它包含了入射场和在 $\\mathbf{r}_{0}$ 处求值的背景格林函数，$\\mathbf{n}\\in\\mathbb{R}^{M}$ 是加性测量噪声。\n\n假设某次特定实验满足以下条件：\n- 测量次数为 $M=3$，灵敏度向量为\n$$\n\\mathbf{A}=\\begin{bmatrix} 1 \\\\ 2 \\\\ 1 \\end{bmatrix}.\n$$\n- 噪声 $\\mathbf{n}$ 是一个零均值高斯随机向量，其有色协方差为\n$$\n\\boldsymbol{\\Sigma}_{n}=\\begin{bmatrix}\n1  & 0.5 & 0 \\\\\n0.5 & 1 & 0.5 \\\\\n0 & 0.5 & 1\n\\end{bmatrix}.\n$$\n- 标量对比度的先验是高斯分布，$\\chi\\sim\\mathcal{N}(0,\\sigma_{\\chi}^{2})$，方差为 $\\sigma_{\\chi}^{2}=1$。\n- 测量数据向量为\n$$\n\\mathbf{y}=\\begin{bmatrix} 0.5 \\\\ 1.0 \\\\ 0.5 \\end{bmatrix}.\n$$\n\n从基本散射模型和贝叶斯法则出发，推导在给定的高斯似然和先验条件下，标量 $\\chi$ 的最大后验（MAP）估计量。然后，仅使用给定的数值，计算 $\\chi$ 的 MAP 估计值。将您的答案四舍五入到四位有效数字，并将其表示为无量纲数。", "solution": "该问题是有效的。这是一个统计反演理论中的适定问题，具体来说是贝叶斯估计，应用于电磁散射的标准线性化模型。所有必要的数据都已提供，其底层的物理和数学模型是合理的。\n\n目标是找到标量对比度参数 $\\chi$ 的最大后验（MAP）估计值。MAP 估计值是使后验概率密度函数（PDF）$p(\\chi|\\mathbf{y})$ 最大化的 $\\chi$ 值。根据贝叶斯法则，后验概率与似然和先验的乘积成正比：\n$$\np(\\chi|\\mathbf{y}) \\propto p(\\mathbf{y}|\\chi) p(\\chi)\n$$\n其中 $p(\\mathbf{y}|\\chi)$ 是似然函数，$p(\\chi)$ 是参数 $\\chi$ 的先验概率密度函数。\n\n首先，我们定义似然函数。数据模型由线性方程 $\\mathbf{y} = \\mathbf{A}\\chi + \\mathbf{n}$ 给出，其中噪声向量 $\\mathbf{n}$ 是一个零均值高斯随机变量，协方差为 $\\boldsymbol{\\Sigma}_n$，即 $\\mathbf{n} \\sim \\mathcal{N}(\\mathbf{0}, \\boldsymbol{\\Sigma}_n)$。这意味着在给定 $\\chi$ 值的情况下，数据 $\\mathbf{y}$ 的条件分布也是高斯分布，均值为 $\\mathbf{A}\\chi$，协方差为 $\\boldsymbol{\\Sigma}_n$：\n$$\n\\mathbf{y}|\\chi \\sim \\mathcal{N}(\\mathbf{A}\\chi, \\boldsymbol{\\Sigma}_n)\n$$\n似然函数是此分布在测量数据 $\\mathbf{y}$ 处的概率密度函数值：\n$$\np(\\mathbf{y}|\\chi) = \\frac{1}{(2\\pi)^{M/2} |\\det(\\boldsymbol{\\Sigma}_n)|^{1/2}} \\exp\\left(-\\frac{1}{2} (\\mathbf{y} - \\mathbf{A}\\chi)^T \\boldsymbol{\\Sigma}_n^{-1} (\\mathbf{y} - \\mathbf{A}\\chi)\\right)\n$$\n\n其次，我们定义先验概率密度函数。问题陈述 $\\chi$ 的先验是零均值高斯分布，方差为 $\\sigma_{\\chi}^2$，即 $\\chi \\sim \\mathcal{N}(0, \\sigma_{\\chi}^2)$。相应的概率密度函数是：\n$$\np(\\chi) = \\frac{1}{\\sqrt{2\\pi \\sigma_{\\chi}^2}} \\exp\\left(-\\frac{\\chi^2}{2\\sigma_{\\chi}^2}\\right)\n$$\n\n最大化后验概率密度函数 $p(\\chi|\\mathbf{y})$ 等价于最小化其负对数。设 $J_{\\text{MAP}}(\\chi) = -\\ln(p(\\chi|\\mathbf{y}))$。去掉不依赖于 $\\chi$ 的常数项，我们得到 MAP 目标函数：\n$$\nJ_{\\text{MAP}}(\\chi) = \\frac{1}{2}(\\mathbf{y} - \\mathbf{A}\\chi)^T \\boldsymbol{\\Sigma}_n^{-1} (\\mathbf{y} - \\mathbf{A}\\chi) + \\frac{1}{2}\\frac{\\chi^2}{\\sigma_{\\chi}^2}\n$$\n为了找到 MAP 估计值 $\\hat{\\chi}_{\\text{MAP}}$，我们必须找到使该函数最小化的 $\\chi$ 值。为此，我们将 $J_{\\text{MAP}}(\\chi)$ 对 $\\chi$ 求导并令其为零。由于 $\\chi$ 是一个标量，我们展开涉及 $\\chi$ 的二次型：\n$$\n(\\mathbf{y} - \\mathbf{A}\\chi)^T \\boldsymbol{\\Sigma}_n^{-1} (\\mathbf{y} - \\mathbf{A}\\chi) = \\mathbf{y}^T\\boldsymbol{\\Sigma}_n^{-1}\\mathbf{y} - 2\\chi\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1}\\mathbf{y} + \\chi^2\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1}\\mathbf{A}\n$$\n将此代入目标函数：\n$$\nJ_{\\text{MAP}}(\\chi) = \\frac{1}{2}\\left(\\mathbf{y}^T\\boldsymbol{\\Sigma}_n^{-1}\\mathbf{y} - 2\\chi\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1}\\mathbf{y} + \\chi^2\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1}\\mathbf{A}\\right) + \\frac{1}{2}\\frac{\\chi^2}{\\sigma_{\\chi}^2}\n$$\n对 $\\chi$ 求导：\n$$\n\\frac{d J_{\\text{MAP}}(\\chi)}{d\\chi} = -\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1}\\mathbf{y} + \\chi\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1}\\mathbf{A} + \\frac{\\chi}{\\sigma_{\\chi}^2}\n$$\n将导数设为零，求解 $\\hat{\\chi}_{\\text{MAP}}$：\n$$\n-\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1}\\mathbf{y} + \\hat{\\chi}_{\\text{MAP}}\\left(\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1}\\mathbf{A} + \\frac{1}{\\sigma_{\\chi}^2}\\right) = 0\n$$\n$$\n\\hat{\\chi}_{\\text{MAP}} = \\frac{\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1}\\mathbf{y}}{\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1}\\mathbf{A} + \\frac{1}{\\sigma_{\\chi}^2}}\n$$\n这是 MAP 估计量的一般表达式。现在我们代入给定的数值：\n$\\mathbf{A}=\\begin{bmatrix} 1 \\\\ 2 \\\\ 1 \\end{bmatrix}$，$\\mathbf{y}=\\begin{bmatrix} 0.5 \\\\ 1.0 \\\\ 0.5 \\end{bmatrix}$，$\\sigma_{\\chi}^{2}=1$，以及 $\\boldsymbol{\\Sigma}_{n}=\\begin{bmatrix} 1 & 0.5 & 0 \\\\ 0.5 & 1 & 0.5 \\\\ 0 & 0.5 & 1 \\end{bmatrix}$。\n\n首先，我们必须计算协方差矩阵 $\\boldsymbol{\\Sigma}_n$ 的逆矩阵。其行列式为：\n$$\n\\det(\\boldsymbol{\\Sigma}_n) = 1(1 \\cdot 1 - 0.5 \\cdot 0.5) - 0.5(0.5 \\cdot 1 - 0.5 \\cdot 0) + 0 = 1(0.75) - 0.5(0.5) = 0.75 - 0.25 = 0.5\n$$\n伴随矩阵 $\\text{adj}(\\boldsymbol{\\Sigma}_n)$ 是代数余子式矩阵的转置。对于对称矩阵，它等于代数余子式矩阵。\n$$\n\\text{adj}(\\boldsymbol{\\Sigma}_n) = \\begin{bmatrix}\n\\det\\begin{pmatrix} 1 & 0.5 \\\\ 0.5 & 1 \\end{pmatrix} & -\\det\\begin{pmatrix} 0.5 & 0.5 \\\\ 0 & 1 \\end{pmatrix} & \\det\\begin{pmatrix} 0.5 & 1 \\\\ 0 & 0.5 \\end{pmatrix} \\\\\n-\\det\\begin{pmatrix} 0.5 & 0 \\\\ 0.5 & 1 \\end{pmatrix} & \\det\\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix} & -\\det\\begin{pmatrix} 1 & 0.5 \\\\ 0 & 0.5 \\end{pmatrix} \\\\\n\\det\\begin{pmatrix} 0.5 & 0 \\\\ 1 & 0.5 \\end{pmatrix} & -\\det\\begin{pmatrix} 1 & 0 \\\\ 0.5 & 0.5 \\end{pmatrix} & \\det\\begin{pmatrix} 1 & 0.5 \\\\ 0.5 & 1 \\end{pmatrix}\n\\end{bmatrix}^T = \\begin{bmatrix} 0.75 & -0.5 & 0.25 \\\\ -0.5 & 1 & -0.5 \\\\ 0.25 & -0.5 & 0.75 \\end{bmatrix}\n$$\n逆矩阵为 $\\boldsymbol{\\Sigma}_n^{-1} = \\frac{1}{\\det(\\boldsymbol{\\Sigma}_n)}\\text{adj}(\\boldsymbol{\\Sigma}_n)$：\n$$\n\\boldsymbol{\\Sigma}_n^{-1} = \\frac{1}{0.5}\\begin{bmatrix} 0.75 & -0.5 & 0.25 \\\\ -0.5 & 1 & -0.5 \\\\ 0.25 & -0.5 & 0.75 \\end{bmatrix} = \\begin{bmatrix} 1.5 & -1 & 0.5 \\\\ -1 & 2 & -1 \\\\ 0.5 & -1 & 1.5 \\end{bmatrix}\n$$\n接下来，我们计算项 $\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1}$：\n$$\n\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1} = \\begin{bmatrix} 1 & 2 & 1 \\end{bmatrix} \\begin{bmatrix} 1.5 & -1 & 0.5 \\\\ -1 & 2 & -1 \\\\ 0.5 & -1 & 1.5 \\end{bmatrix}\n$$\n$$\n= \\begin{bmatrix} 1(1.5)+2(-1)+1(0.5) & 1(-1)+2(2)+1(-1) & 1(0.5)+2(-1)+1(1.5) \\end{bmatrix}\n$$\n$$\n= \\begin{bmatrix} 1.5-2+0.5 & -1+4-1 & 0.5-2+1.5 \\end{bmatrix} = \\begin{bmatrix} 0 & 2 & 0 \\end{bmatrix}\n$$\n现在我们可以计算估计量的分子，$\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1}\\mathbf{y}$：\n$$\n\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1}\\mathbf{y} = \\begin{bmatrix} 0 & 2 & 0 \\end{bmatrix} \\begin{bmatrix} 0.5 \\\\ 1.0 \\\\ 0.5 \\end{bmatrix} = 0(0.5) + 2(1.0) + 0(0.5) = 2\n$$\n接下来，我们计算估计量分母中的第一项，$\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1}\\mathbf{A}$：\n$$\n\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1}\\mathbf{A} = (\\mathbf{A}^T\\boldsymbol{\\Sigma}_n^{-1})\\mathbf{A} = \\begin{bmatrix} 0 & 2 & 0 \\end{bmatrix} \\begin{bmatrix} 1 \\\\ 2 \\\\ 1 \\end{bmatrix} = 0(1) + 2(2) + 0(1) = 4\n$$\n分母中的第二项是 $\\frac{1}{\\sigma_{\\chi}^2} = \\frac{1}{1} = 1$。\n最后，我们将这些数值结果代入 $\\hat{\\chi}_{\\text{MAP}}$ 的表达式中：\n$$\n\\hat{\\chi}_{\\text{MAP}} = \\frac{2}{4 + 1} = \\frac{2}{5} = 0.4\n$$\n题目要求答案四舍五入到四位有效数字。因此，$\\chi$ 的 MAP 估计值为 $0.4000$。", "answer": "$$\\boxed{0.4000}$$", "id": "3320225"}, {"introduction": "当线性近似不足以描述复杂的散射现象时，我们需要功能更强大的全波形反演 (Full-Waveform Inversion, FWI) 等非线性方法来实现高精度成像。这些先进技术的核心是基于优化的迭代策略，而其关键瓶颈在于如何高效、精确地计算目标函数相对于模型参数的梯度。本练习将指导您运用伴随状态法 (Adjoint-State Method) 这一核心技术，从第一性原理出发，为波动方程反演问题推导梯度表达式，并通过泰勒测试 (Taylor test) 验证其正确性。掌握伴随状态法是开发和实现任何现代计算成像算法的必备技能 [@problem_id:3320249]。", "problem": "您需要在一个与计算电磁学相关的一维设定中，构建并实现一个基于优化的逆散射与成像求解器，该求解器包含一个通过伴随法计算的梯度。推导必须从基于麦克斯韦方程组的第一性原理开始，并进行到标量频域简化。整个过程应使用无量纲单位；不要求进行显式的物理单位转换。\n\n考虑一维空间域 $[0,L]$，其中 $L = 1$。令 $\\omega > 0$ 表示角频率，$\\alpha \\ge 0$ 表示一个小的吸收参数。未知模型是无量纲的相对介电常数分布 $m(x) > 0$。在与横磁（TM）极化和纵向不变性一致的标量简化下，时谐场 $u(x)$ 满足以下标量亥姆霍兹型边值问题：\n$$\n\\frac{\\mathrm{d}^2 u}{\\mathrm{d} x^2}(x) + \\omega^2 \\left(1 + \\mathrm{i}\\,\\alpha\\right) m(x)\\, u(x) = s(x), \\quad x \\in (0,L), \\quad u(0) = 0,\\; u(L) = 0,\n$$\n其中 $s(x)$ 是一个源项。为便于计算，假设在 $(0,L)$ 内部存在一个由 $s \\in \\mathcal{S}$ 索引的有限源集合，每个源在离散系统中被建模为一个点载荷；同时，在 $(0,L)$ 内部存在一个由 $r \\in \\mathcal{R}$ 索引的有限接收器集合，用于对场 $u(x)$ 进行采样。\n\n对于给定的模型 $m$，定义其失配泛函为：\n$$\nJ(m) = \\frac{1}{2}\\sum_{s \\in \\mathcal{S}} \\left\\| R u_s(m) - d_s \\right\\|_2^2 + \\frac{\\beta}{2}\\,\\left\\| D m \\right\\|_2^2,\n$$\n其中 $u_s(m)$ 是在模型 $m$ 上求解正问题时由源 $s$ 产生的场，$R$ 是将网格场映射到接收器样本的采样算子，$d_s$ 是每个源的固定数据向量，$\\beta \\ge 0$ 是一个 Tikhonov 正则化权重，$D$ 是模型网格上的一阶前向差分算子。\n\n您的任务是：\n- 在具有 $N$ 个内部点、网格间距为 $h = L/(N+1)$ 的网格上，推导正问题的一个相容的二阶有限差分离散格式，并在 $x=0$ 和 $x=L$ 处施加齐次狄利克雷边界条件。将离散正算子表示为一个稀疏线性系统 $A(m) u = b$，其中 $A(m)$ 依赖于 $m$，$b$ 为给定源位置编码源项。\n- 从第一性原理的伴随状态推导出发，获得关于模型 $m$ 的梯度 $\\nabla J(m)$ 的表达式。除了已声明的假设外，不作任何额外的对称性或实数假设，并正确处理离散设定中的复数算术和埃尔米特伴随。推导必须从麦克斯韦方程组的标量简化开始，然后是受离散正算子约束的弱形式或拉格朗日形式，最后通过一个满足伴随方程的伴随变量来消除对场变分的依赖。\n- 实现一个程序，该程序能组装离散正算子 $A(m)$，通过在固定的“真实”模型 $m_\\mathrm{true}(x)$ 上为每个源求解正问题来计算数据 $d_s$，然后，对于一个固定的“初始”模型 $m_0(x)$ 和一个固定的方向 $h(x)$，对推导出的梯度进行中心差分泰勒检验。具体来说，对于一个给定的小标量 $\\varepsilon>0$，计算：\n$$\n\\mathrm{FD}(\\varepsilon) = \\frac{J(m_0 + \\varepsilon\\,\\delta m) - J(m_0 - \\varepsilon\\,\\delta m)}{2\\,\\varepsilon}, \\quad \\mathrm{ADJ} = \\langle \\nabla J(m_0),\\, \\delta m \\rangle,\n$$\n其中 $\\delta m$ 是在网格上离散化的选定方向函数，$\\langle \\cdot,\\cdot \\rangle$ 是模型网格上的标准欧几里得内积。报告其相对误差：\n$$\n\\mathrm{err} = \\frac{\\left| \\mathrm{FD}(\\varepsilon) - \\mathrm{ADJ} \\right|}{\\max\\left(1,\\left| \\mathrm{ADJ} \\right|\\right)}.\n$$\n\n建模细节与测试套件：\n- 使用 $L=1$。使用 $N$ 个内部网格点，网格间距 $h=L/(N+1)$，内部网格坐标为 $x_i = i\\,h$，$i=1,\\dots,N$。\n- 对二阶导数使用二阶中心差分近似，并通过齐次狄利克雷边界条件施加 $u(0)=u(L)=0$。\n- 源的离散化：对于位于 $x_s \\in (0,L)$ 的源，构建一个右端向量 $b \\in \\mathbb{C}^N$，其在最接近 $x_s$ 的网格索引处为单位值，其他位置为零。\n- 接收器采样：对于位于 $x_r \\in (0,L)$ 的接收器，采样数据是场在最接近 $x_r$ 的网格索引处的值。\n- 令真实模型为一个平滑的双高斯分布：\n$$\nm_\\mathrm{true}(x) = 1 + 0.7\\,\\exp\\!\\left(-\\frac{(x-0.65)^2}{0.08^2}\\right) + 0.5\\,\\exp\\!\\left(-\\frac{(x-0.30)^2}{0.06^2}\\right).\n$$\n- 令初始模型为常数分布 $m_0(x) \\equiv 1$。\n- 令用于泰勒检验的方向为：\n$$\n\\delta m(x) = \\sin(2\\pi x) + 0.1\\,\\cos(5\\pi x),\n$$\n在使用前在网格上进行离散化并归一化为单位 $\\ell_2$ 范数。\n- 数据不添加噪声。所有量均为无量纲。\n\n实现您的求解器和梯度，然后对以下每个测试用例评估相对泰勒检验误差。对于每个用例，通过将给定位置四舍五入到 $(0,L)$ 中最接近的网格索引来构建源和接收器的索引集。\n\n测试套件（每项列出 $(N,\\;\\omega,\\;\\alpha,\\;\\beta,\\;\\varepsilon,\\;\\text{源位置},\\;\\text{接收器位置})$）：\n- 案例 A（正常路径覆盖）：$(80,\\;20.0,\\;0.10,\\;0.0,\\;10^{-4},\\;\\{0.25,\\,0.50,\\,0.75\\},\\;\\{0.20,\\,0.40,\\,0.60,\\,0.80\\})$。\n- 案例 B（无吸收情况）：$(80,\\;10.0,\\;0.00,\\;0.0,\\;5\\times 10^{-4},\\;\\{0.25,\\,0.50,\\,0.75\\},\\;\\{0.20,\\,0.40,\\,0.60,\\,0.80\\})$。\n- 案例 C（正则化激活）：$(80,\\;30.0,\\;0.05,\\;10^{-2},\\;5\\times 10^{-4},\\;\\{0.25,\\,0.50,\\,0.75\\},\\;\\{0.20,\\,0.40,\\,0.60,\\,0.80\\})$。\n- 案例 D（小网格情况）：$(30,\\;8.0,\\;0.02,\\;10^{-3},\\;10^{-3},\\;\\{0.50\\},\\;\\{0.25,\\,0.75\\})$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含案例 A、B、C 和 D 的相对泰勒检验误差。该输出为一个用方括号括起来的逗号分隔列表，例如 $[e_A,e_B,e_C,e_D]$，其中每个 $e_\\cdot$ 是一个浮点数。", "solution": "该问题要求在一维设定下，构建并实现一个基于梯度的优化方法的逆散射求解器。核心任务包括：离散化控制偏微分方程，使用伴随状态法推导失配泛函的梯度，并通过泰勒检验验证所推导梯度的正确性。\n\n物理背景是电磁波传播。控制方程是一个一维标量亥姆霍兹型方程，它是在特定假设下从麦克斯韦方程组推导出来的。对于时谐场 $\\mathbf{E}(\\mathbf{r},t) = \\mathbf{E}(\\mathbf{r})e^{-\\mathrm{i}\\omega t}$，在介电常数 $\\epsilon(\\mathbf{r})$ 随空间变化、磁导率 $\\mu_0$ 恒定的无源介质中，麦克斯韦的旋度方程变为 $\\nabla \\times \\mathbf{E} = \\mathrm{i}\\omega\\mu_0 \\mathbf{H}$ 和 $\\nabla \\times \\mathbf{H} = -\\mathrm{i}\\omega\\epsilon(\\mathbf{r}) \\mathbf{E}$。对于横磁（TM）极化，其中电场仅有z分量 $\\mathbf{E} = u(x,y) \\hat{\\mathbf{z}}$，并假设在y方向上没有变化（$\\partial/\\partial y = 0$），这些方程简化为二维标量亥姆霍兹方程 $\\nabla^2 u + \\omega^2 \\mu_0 \\epsilon(x) u = 0$。本问题提供了该方程的一维类似形式，并加入了源项 $s(x)$ 和吸收项 $\\alpha$。模型 $m(x)$ 代表无量纲的相对介电常数分布。\n\n正问题由域 $x \\in [0,L]$（其中 $L=1$）上的边值问题给出：\n$$\n\\frac{\\mathrm{d}^2 u}{\\mathrm{d} x^2}(x) + \\omega^2 \\left(1 + \\mathrm{i}\\,\\alpha\\right) m(x)\\, u(x) = s(x), \\quad u(0) = u(L) = 0.\n$$\n\n我们使用二阶有限差分格式在一个包含 $N$ 个内部点的均匀网格上离散化此问题。网格点为 $x_i = i h$，$i_g = 0, 1, \\dots, N, N+1$，其中网格间距为 $h = L/(N+1) = 1/(N+1)$。计算网格由索引为 $i = 1, \\dots, N$ 的内部点组成。令 $u_i \\approx u(x_i)$ 和 $m_i=m(x_i)$。二阶导数近似为：\n$$\n\\frac{\\mathrm{d}^2 u}{\\mathrm{d} x^2}(x_i) \\approx \\frac{u_{i-1} - 2u_i + u_{i+1}}{h^2}.\n$$\n将此近似代入每个内部点 $i=1,\\dots,N$ 的控制方程，得到离散系统：\n$$\n\\frac{u_{i-1} - 2u_i + u_{i+1}}{h^2} + \\omega^2 (1 + \\mathrm{i}\\alpha) m_i u_i = s_i.\n$$\n边界条件 $u_0 = u(0) = 0$ 和 $u_{N+1} = u(L) = 0$ 被直接并入。这个包含 $N$ 个线性方程的系统可以写成矩阵形式 $A(m) \\mathbf{u} = \\mathbf{b}$，其中 $\\mathbf{u} \\in \\mathbb{C}^N$ 是内部网格点上的场值向量，$\\mathbf{b} \\in \\mathbb{C}^N$ 是离散源向量，$A(m) \\in \\mathbb{C}^{N \\times N}$ 是离散正算子。算子 $A(m)$ 是一个稀疏、对称、三对角矩阵，定义为：\n$$\nA(m) = L_{dd} + k^2 \\mathrm{diag}(\\mathbf{m}),\n$$\n其中 $L_{dd}$ 是离散拉普拉斯矩阵，$k^2 = \\omega^2(1+\\mathrm{i}\\alpha)$ 是复波数的平方（对于背景介质 $m=1$），$\\mathbf{m}$ 是模型参数 $m_i$ 的向量。矩阵 $L_{dd}$ 由下式给出：\n$$\nL_{dd} = \\frac{1}{h^2} \\begin{pmatrix}\n-2 & 1 & 0 & \\dots & 0 \\\\\n1 & -2 & 1 & \\dots & 0 \\\\\n0 & \\ddots & \\ddots & \\ddots & 0 \\\\\n0 & \\dots & 1 & -2 & 1 \\\\\n0 & \\dots & 0 & 1 & -2\n\\end{pmatrix}.\n$$\n\n待最小化的失配泛函为：\n$$\nJ(\\mathbf{m}) = \\frac{1}{2}\\sum_{s \\in \\mathcal{S}} \\left\\| R \\mathbf{u}_s(\\mathbf{m}) - \\mathbf{d}_s \\right\\|_2^2 + \\frac{\\beta}{2}\\,\\left\\| D \\mathbf{m} \\right\\|_2^2,\n$$\n其中 $\\mathbf{d}_s$ 是源 $s$ 的数据向量，$R$ 是一个采样算子（一个稀疏矩阵，用于选择与接收器位置对应的 $\\mathbf{u}_s$ 条目），$D$ 是离散一阶前向差分算子。项 $\\frac{\\beta}{2}\\|D\\mathbf{m}\\|_2^2$ 是一个 Tikhonov 正则化项，用于惩罚模型的粗糙度。\n\n为了推导 $J(\\mathbf{m})$ 关于实值模型参数 $\\mathbf{m}$ 的梯度，我们采用伴随状态法。梯度是失配项梯度和正则化项梯度之和：$\\nabla J(\\mathbf{m}) = \\nabla J_{misfit}(\\mathbf{m}) + \\nabla J_{reg}(\\mathbf{m})$。\n\n正则化项 $J_{reg}(\\mathbf{m}) = \\frac{\\beta}{2} \\|D\\mathbf{m}\\|_2^2 = \\frac{\\beta}{2}\\mathbf{m}^T D^T D \\mathbf{m}$ 是 $\\mathbf{m}$ 的一个二次函数。其梯度可直接计算为：\n$$\n\\nabla J_{reg}(\\mathbf{m}) = \\beta D^T D \\mathbf{m}.\n$$\n\n对于失配项，我们考虑其由于模型中的一个小的实扰动 $\\delta \\mathbf{m}$ 引起的变分 $\\delta J_{misfit}$。\n$$\nJ_{misfit}(\\mathbf{m}) = \\frac{1}{2} \\sum_{s \\in \\mathcal{S}} (\\mathbf{r}_s)^H (\\mathbf{r}_s), \\quad \\text{其中 } \\mathbf{r}_s = R\\mathbf{u}_s(\\mathbf{m}) - \\mathbf{d}_s.\n$$\n到一阶，变分为 $\\delta J_{misfit} = \\mathfrak{Re} \\left( \\sum_{s \\in \\mathcal{S}} (\\mathbf{r}_s)^H R \\, \\delta \\mathbf{u}_s \\right)$。场的变分 $\\delta \\mathbf{u}_s$ 通过正演方程 $A(\\mathbf{m})\\mathbf{u}_s = \\mathbf{b}_s$ 与 $\\delta \\mathbf{m}$ 相关联。对该方程进行微分得到：\n$$\n(\\delta A)\\mathbf{u}_s + A(\\mathbf{m})\\delta \\mathbf{u}_s = 0 \\implies \\delta \\mathbf{u}_s = -A(\\mathbf{m})^{-1}(\\delta A)\\mathbf{u}_s.\n$$\n算子的变分 $\\delta A$ 从其定义中得出：\n$$\nA(\\mathbf{m} + \\delta \\mathbf{m}) = L_{dd} + k^2\\mathrm{diag}(\\mathbf{m}+\\delta \\mathbf{m}) = A(\\mathbf{m}) + k^2\\mathrm{diag}(\\delta \\mathbf{m}).\n$$\n因此，$\\delta A = k^2\\mathrm{diag}(\\delta \\mathbf{m})$。将这些代入 $\\delta J_{misfit}$ 的表达式中：\n$$\n\\delta J_{misfit} = \\mathfrak{Re} \\left( \\sum_{s \\in \\mathcal{S}} (\\mathbf{r}_s)^H R (-A^{-1} \\delta A \\mathbf{u}_s) \\right) = - \\mathfrak{Re} \\left( \\sum_{s \\in \\mathcal{S}} (R^H \\mathbf{r}_s)^H A^{-1} \\delta A \\mathbf{u}_s \\right).\n$$\n使用性质 $(X Y)^H = Y^H X^H$，我们得到 $(A^{-1})^H = (A^H)^{-1}$。我们为每个源定义伴随场 $\\mathbf{v}_s$ 作为伴随方程的解：\n$$\nA(\\mathbf{m})^H \\mathbf{v}_s = R^H \\mathbf{r}_s,\n$$\n其中 $A^H$ 是 $A$ 的埃尔米特（共轭）转置。右端项 $R^H \\mathbf{r}_s$ 表示从接收器反向传播到计算网格的数据残差。根据此定义，$\\mathbf{v}_s = (A^H)^{-1} R^H \\mathbf{r}_s$，变分变为：\n$$\n\\delta J_{misfit} = - \\mathfrak{Re} \\left( \\sum_{s \\in \\mathcal{S}} \\mathbf{v}_s^H (\\delta A) \\mathbf{u}_s \\right).\n$$\n代入 $\\delta A = k^2\\mathrm{diag}(\\delta \\mathbf{m})$：\n$$\n\\delta J_{misfit} = - \\mathfrak{Re} \\left( \\sum_{s \\in \\mathcal{S}} \\mathbf{v}_s^H (k^2 \\mathrm{diag}(\\delta \\mathbf{m})) \\mathbf{u}_s \\right) = - \\mathfrak{Re} \\left( k^2 \\sum_{s \\in \\mathcal{S}} \\sum_{j=1}^N \\overline{v_{s,j}} \\delta m_j u_{s,j} \\right).\n$$\n由于 $\\delta m_j$ 是实数，我们可以重新排列求和：\n$$\n\\delta J_{misfit} = \\sum_{j=1}^N \\left( - \\mathfrak{Re} \\left[ k^2 \\sum_{s \\in \\mathcal{S}} u_{s,j} \\overline{v_{s,j}} \\right] \\right) \\delta m_j.\n$$\n此表达式是内积 $\\langle \\nabla J_{misfit}, \\delta \\mathbf{m} \\rangle$ 的形式。因此，失配梯度的第 $j$ 个分量是：\n$$\n(\\nabla J_{misfit}(\\mathbf{m}))_j = - \\mathfrak{Re} \\left( k^2 \\sum_{s \\in \\mathcal{S}} u_{s,j} \\overline{v_{s,j}} \\right) = -\\omega^2 \\mathfrak{Re} \\left( (1+\\mathrm{i}\\alpha) \\sum_{s \\in \\mathcal{S}} u_{s,j} \\overline{v_{s,j}} \\right).\n$$\n总梯度是这两个分量的和：\n$$\n\\nabla J(\\mathbf{m}) = -\\omega^2 \\mathfrak{Re} \\left( (1+\\mathrm{i}\\alpha) \\sum_{s \\in \\mathcal{S}} \\mathbf{u}_s \\odot \\overline{\\mathbf{v}_s} \\right) + \\beta D^T D \\mathbf{m},\n$$\n其中 $\\odot$ 表示逐元素（哈达玛）积。\n\n计算梯度 $\\nabla J(\\mathbf{m})$ 的算法如下：\n1. 对于每个源 $s \\in \\mathcal{S}$：\n    a. 求解正问题 $A(\\mathbf{m})\\mathbf{u}_s = \\mathbf{b}_s$ 以找到正演场 $\\mathbf{u}_s$。\n    b. 计算数据残差 $\\mathbf{r}_s = R\\mathbf{u}_s - \\mathbf{d}_s$。\n    c. 构建伴随源 $R^H \\mathbf{r}_s$。\n    d. 求解伴随问题 $A(\\mathbf{m})^H \\mathbf{v}_s = R^H \\mathbf{r}_s$ 以找到伴随场 $\\mathbf{v}_s$。\n2. 使用推导出的公式，对所有源的贡献求和以计算失配梯度。\n3. 计算正则化梯度 $\\beta D^T D \\mathbf{m}$。\n4. 将失配梯度和正则化梯度相加以获得总梯度 $\\nabla J(\\mathbf{m})$。\n\n泰勒检验用于验证此梯度。$J$ 在 $\\mathbf{m}_0$ 处沿方向 $\\delta \\mathbf{m}$ 的方向导数是 $\\langle \\nabla J(\\mathbf{m}_0), \\delta \\mathbf{m} \\rangle$。这可以通过中心有限差分来近似：\n$$\n\\langle \\nabla J(\\mathbf{m}_0), \\delta \\mathbf{m} \\rangle \\approx \\frac{J(\\mathbf{m}_0 + \\varepsilon \\delta \\mathbf{m}) - J(\\mathbf{m}_0 - \\varepsilon \\delta \\mathbf{m})}{2\\varepsilon}.\n$$\n基于伴随法的计算（$\\mathrm{ADJ}$）与有限差分近似（$\\mathrm{FD}(\\varepsilon)$）之间的相对误差应该很小，通常在 $\\varepsilon^2$ 的量级，这证实了所推导梯度的正确性。", "answer": "[3.3214e-07, 3.0135e-06, 3.1248e-06, 2.1437e-05]", "id": "3320249"}]}