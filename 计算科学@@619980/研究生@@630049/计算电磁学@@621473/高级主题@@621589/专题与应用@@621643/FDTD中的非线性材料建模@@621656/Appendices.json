{"hands_on_practices": [{"introduction": "为了在FDTD仿真中获得数值稳定性和通用性，我们通常使用一套无量纲的“代码单位”。本练习将指导您完成从物理单位到代码单位的关键转换过程，特别是针对非线性磁化率 $\\chi^{(3)}$。掌握这项技能对于正确设置任何非线性电磁仿真的参数至关重要 [@problem_id:3334794]。", "problem": "考虑一个使用时域有限差分（FDTD）方法模拟的瞬时各向同性克尔介质。宏观本构关系基于麦克斯韦方程组和三阶（立方）介质的非线性极化定义：电通量密度为 $D = \\epsilon_0 E + P$，其中非线性极化为 $P_{\\text{NL}} = \\epsilon_0 \\chi^{(3)} |E|^{2} E$。此处，$\\epsilon_0$ 是真空介电常数，$\\chi^{(3)}$ 是国际单位制（SI）中的（标量）三阶电极化率，单位为 $\\mathrm{m}^{2}/\\mathrm{V}^{2}$。\n\n在您的FDTD代码中，您分别使用为电场、时间和长度选择的尺度对场和坐标进行无量纲化：$\\tilde{E} = E / E_{s}$，$\\tilde{t} = t / t_{s}$，$\\tilde{x} = x / x_{s}$。为了使麦克斯韦旋度方程在这些代码单位中无系数，您选择的时间和长度尺度满足 $t_{s} = x_{s} / c$，其中 $c = 1/\\sqrt{\\mu_0 \\epsilon_0}$ 是真空中的光速，$\\mu_0$ 是真空磁导率。假设介质是线性各向同性且非磁性的，其相对磁导率等于1。\n\n仅从麦克斯韦方程组和上述本构定义出发，推导一个表达式，用于将国际单位制中的物理三阶电极化率 $\\chi^{(3)}$ 转换为在您的 FDTD 更新中计算代码单位下的克尔极化时所使用的无量纲系数。然后，使用您的结果，计算当所选场尺度为 $E_{s} = 5.0 \\times 10^{8}~\\mathrm{V}/\\mathrm{m}$ 时，对于 $\\chi^{(3)} = 2.7 \\times 10^{-22}~\\mathrm{m}^{2}/\\mathrm{V}^{2}$ 的材料，该无量纲系数的数值。设 $x_{s}$ 和 $t_{s}$ 满足 $t_{s} = x_{s}/c$。\n\n将您的最终无量纲系数四舍五入到四位有效数字。在最终数值答案中不要包含单位。", "solution": "用户希望在一个时域有限差分（FDTD）模拟中，找出克尔非线性的无量纲系数，并为一个给定的材料和场尺度计算其数值。\n\n### 第 1 步：无量纲系数的推导\n\n起点是瞬时各向同性克尔介质中电通量密度 $D$ 的本构关系。题目中给出如下：\n$$D = \\epsilon_0 E + P$$\n其中 $P$ 是材料极化。题目进一步指明非线性极化为：\n$$P_{\\text{NL}} = \\epsilon_0 \\chi^{(3)} |E|^{2} E$$\n题目的设定意味着极化的线性部分为零（即线性相对介电常数 $\\epsilon_r = 1$），因此总极化就是非线性部分，$P = P_{\\text{NL}}$。所以，完整的本构关系是：\n$$D = \\epsilon_0 E + \\epsilon_0 \\chi^{(3)} |E|^{2} E$$\n这可以因式分解为：\n$$D = \\epsilon_0 \\left(1 + \\chi^{(3)} |E|^2 \\right) E$$\n此处，$D$、$E$、$\\epsilon_0$ 和 $\\chi^{(3)}$ 均采用国际单位制（SI）单位。\n\n接下来，我们引入 FDTD 模拟中使用的无量纲变量（也称为代码单位）。这些变量通过对物理量进行缩放来定义：\n$$E = E_{s} \\tilde{E}$$\n$$t = t_{s} \\tilde{t}$$\n$$\\nabla = \\frac{1}{x_{s}} \\tilde{\\nabla}$$\n其中 $E_s$、$t_s$ 和 $x_s$ 分别是电场、时间和长度的缩放常数。波浪号（~）表示无量纲量。\n\n为了正确地归一化本构关系，我们还必须定义一个无量纲的电通量密度 $\\tilde{D}$。$D$ 的一个一致的缩放关系可以从要求麦克斯韦旋度方程在新单位下变为无系数推导出来。安培定律是 $\\nabla \\times H = \\frac{\\partial D}{\\partial t}$。为了使无量纲形式 $\\tilde{\\nabla} \\times \\tilde{H} = \\frac{\\partial \\tilde{D}}{\\partial \\tilde{t}}$ 成立，并且给定磁场的标准缩放 $H_s = E_s / Z_0$（其中 $Z_0 = \\sqrt{\\mu_0/\\epsilon_0}$ 是自由空间阻抗）以及条件 $t_s = x_s/c$，$D$ 的缩放因子必须是：\n$$D_s = \\frac{t_s}{x_s} H_s = \\frac{1}{c} \\frac{E_s}{Z_0} = \\frac{1}{c} E_s \\left(c \\epsilon_0\\right) = \\epsilon_0 E_s$$\n因此，无量纲的电通量密度是：\n$$\\tilde{D} = \\frac{D}{D_s} = \\frac{D}{\\epsilon_0 E_s}$$\n\n现在我们可以将缩放后的变量代入物理本构关系中，以找到相应的无量纲关系。\n$$\\tilde{D} = \\frac{\\epsilon_0 \\left(1 + \\chi^{(3)} |E|^2 \\right) E}{\\epsilon_0 E_s}$$\n消去 $\\epsilon_0$：\n$$\\tilde{D} = \\frac{\\left(1 + \\chi^{(3)} |E|^2 \\right) E}{E_s}$$\n代入 $E = E_s \\tilde{E}$：\n$$\\tilde{D} = \\frac{\\left(1 + \\chi^{(3)} |E_s \\tilde{E}|^2 \\right) (E_s \\tilde{E})}{E_s}$$\n通过消去 $E_s$ 来简化：\n$$\\tilde{D} = \\left(1 + \\chi^{(3)} E_s^2 |\\tilde{E}|^2 \\right) \\tilde{E}$$\n展开此表达式得到：\n$$\\tilde{D} = \\tilde{E} + \\left( \\chi^{(3)} E_s^2 \\right) |\\tilde{E}|^2 \\tilde{E}$$\n这个方程是本构关系的无量纲形式。在 FDTD 更新中，项 $\\tilde{P}_{\\text{NL}} = (\\chi^{(3)} E_s^2) |\\tilde{E}|^2 \\tilde{E}$ 代表了代码单位中的克尔极化。因此，乘以非线性项 $|\\tilde{E}|^2 \\tilde{E}$ 的无量纲系数是 $\\chi^{(3)} E_s^2$。\n\n让我们将这个无量纲系数称为 $\\gamma$。将物理电极化率转换为无量纲系数的表达式是：\n$$\\gamma = \\chi^{(3)} E_s^2$$\n作为检验，我们可以验证单位。$\\chi^{(3)}$ 的单位被给出为 $\\mathrm{m}^2/\\mathrm{V}^2$，$E_s$ 的单位是 $\\mathrm{V}/\\mathrm{m}$。\n$$[\\gamma] = [\\chi^{(3)}] [E_s^2] = \\left(\\frac{\\mathrm{m}^2}{\\mathrm{V}^2}\\right) \\left(\\frac{\\mathrm{V}}{\\mathrm{m}}\\right)^2 = \\frac{\\mathrm{m}^2}{\\mathrm{V}^2} \\frac{\\mathrm{V}^2}{\\mathrm{m}^2} = 1$$\n得到的系数 $\\gamma$ 确实是无量纲的，符合要求。\n\n### 第 2 步：数值计算\n\n题目要求计算这个无量纲系数 $\\gamma$ 的数值，给定以下物理值：\n- 三阶电极化率：$\\chi^{(3)} = 2.7 \\times 10^{-22}~\\mathrm{m}^{2}/\\mathrm{V}^{2}$\n- 电场尺度：$E_{s} = 5.0 \\times 10^{8}~\\mathrm{V}/\\mathrm{m}$\n\n使用推导出的公式：\n$$\\gamma = \\chi^{(3)} E_s^2$$\n代入给定值：\n$$\\gamma = (2.7 \\times 10^{-22}) \\times (5.0 \\times 10^{8})^2$$\n$$\\gamma = (2.7 \\times 10^{-22}) \\times (25.0 \\times 10^{16})$$\n$$\\gamma = (2.7 \\times 25.0) \\times 10^{-22+16}$$\n$$\\gamma = 67.5 \\times 10^{-6}$$\n$$\\gamma = 6.75 \\times 10^{-5}$$\n题目要求答案四舍五入到四位有效数字。为了将 $6.75 \\times 10^{-5}$ 表示为四位有效数字，我们追加一个零。\n$$\\gamma = 6.750 \\times 10^{-5}$$", "answer": "$$\\boxed{6.750 \\times 10^{-5}}$$", "id": "3334794"}, {"introduction": "许多复杂的材料响应（例如色散和弛豫效应）可以通过辅助微分方程（ADE）有效地建模。然而，求解ADE的数值格式选择并非无关紧要，它直接影响整个仿真的精度。本练习将带您通过泰勒级数分析，来确定维持FDTD方法固有二阶精度所必需的离散化方案，这是保证数值模型高保真度的核心步骤 [@problem_id:3334760]。", "problem": "考虑一个一维各向同性非磁性介质，其在时域有限差分(FDTD)法中使用的Yee网格上进行建模。电场$E(x,t)$配置在整数时间步上，磁场$H(x,t)$配置在半整数时间步上。位移场为$D = \\varepsilon_{0} E + P$，其中$P(x,t)$是一个非线性极化项，通过一个辅助微分方程(ADE)来描述弱克尔型非线性。假设非线性极化遵循一阶弛豫定律\n$$\n\\frac{\\partial P(x,t)}{\\partial t} = F\\big(E(x,t),P(x,t)\\big), \\quad F(E,P) = -\\gamma P + \\sigma |E|^{2} E,\n$$\n其中$\\gamma  0$和$\\sigma \\ge 0$是常数材料参数。电场通过标准的蛙跳格式进行更新，该格式在没有材料色散和非线性的情况下具有二阶时间精度。非线性极化变量$P$在时间上与$E$配置在相同的电场节点上。\n\n给定ADE通过一个通用的单参数、两能级隐式格式进行离散化\n$$\nP^{n+1} = P^{n} + \\Delta t \\left[(1-\\theta) F\\!\\left(E^{n},P^{n}\\right) + \\theta F\\!\\left(E^{n+1},P^{n+1}\\right)\\right],\n$$\n其中$\\Delta t$是时间步长，$n$是时间索引，$\\theta \\in \\mathbb{R}$是一个时间中心化参数。假设耦合的麦克斯韦-ADE系统足够光滑，所有需要的时间导数都存在且有界，并且当$P$在相同的整数时间层上已知时，用于$E$的麦克斯韦更新的Yee离散化在时间上是二阶精确的。\n\n从麦克斯韦方程组和上述ADE出发，利用局部截断误差的泰勒级数相容性分析，确定时间中心化参数$\\theta$的唯一值。该值是使得当$P$与$E$在Yee网格上配置在同一位置时，ADE的整体时间积分在电场节点上保持二阶时间精度，从而保持包含非线性极化的耦合FDTD更新对$E$的二阶精度的充分必要条件。\n\n请以单个实数的形式提供您的最终答案。无需四舍五入，此参数没有物理单位。", "solution": "该问题要求找到一个用于非线性辅助微分方程(ADE)的数值格式中的时间中心化参数$\\theta$的唯一值，该值能够保持整个时域有限差分(FDTD)方法的二阶精度。\n\n给定的ADE描述了非线性极化$P(x,t)$的演化，其形式如下：\n$$\n\\frac{\\partial P}{\\partial t} = F(E,P) = -\\gamma P + \\sigma |E|^{2} E\n$$\n对于每个空间位置$x$的$P$，这是一个关于时间的一阶常微分方程。电场$E(x,t)$充当一个随时间变化的强迫项。\n\n提出的用于在时间步长$\\Delta t$上，从时间$t^n = n\\Delta t$到$t^{n+1} = (n+1)\\Delta t$积分此ADE的数值格式为：\n$$\nP^{n+1} = P^{n} + \\Delta t \\left[(1-\\theta) F(E^{n},P^{n}) + \\theta F(E^{n+1},P^{n+1})\\right]\n$$\n这是一个通用的单参数、两能级隐式格式，其中$P^n$表示$P(t^n)$的数值近似。当$\\theta=0$时，它是显式欧拉法；当$\\theta=1$时，它是隐式欧拉法；当$\\theta=1/2$时，它是梯形法则（或Crank-Nicolson方法）。\n\n为确保耦合的FDTD系统在时间上保持二阶精度，ADE的数值积分也必须是二阶精确的。这意味着该方法对$P$的全局误差必须是$O(\\Delta t^2)$阶。对于单步法，这要求局部截断误差(LTE)为$O(\\Delta t^3)$阶。\n\n让我们进行泰勒级数相容性分析来确定LTE。LTE用$T^{n+1}$表示，是将精确解$P(t)$代入数值公式后得到的残差。\n$$\nP(t^{n+1}) - P(t^n) - \\Delta t \\left[(1-\\theta) F(E(t^n), P(t^n)) + \\theta F(E(t^{n+1}), P(t^{n+1}))\\right] = T^{n+1}\n$$\n我们在时间$t^n$附近展开所有随时间变化的项。令$\\dot{f}$表示全时间导数$df/dt$。\n精确解$P(t^{n+1})$的泰勒级数为：\n$$\nP(t^{n+1}) = P(t^n) + \\Delta t \\dot{P}(t^n) + \\frac{\\Delta t^2}{2} \\ddot{P}(t^n) + O(\\Delta t^3)\n$$\n根据控制ADE，我们有$\\dot{P}(t) = F(E(t), P(t))$。我们将其记为$\\dot{P} = F$。对时间求导得到$\\ddot{P} = \\dot{F}$。将这些代入$P(t^{n+1})$的展开式中，得到：\n$$\nP(t^{n+1}) = P(t^n) + \\Delta t F(t^n) + \\frac{\\Delta t^2}{2} \\dot{F}(t^n) + O(\\Delta t^3)\n$$\n这里，$F(t^n)$是$F(E(t^n), P(t^n))$的简写。\n\n接下来，我们在$t^n$附近展开$F(E(t^{n+1}), P(t^{n+1})) \\equiv F(t^{n+1})$项：\n$$\nF(t^{n+1}) = F(t^n) + \\Delta t \\dot{F}(t^n) + O(\\Delta t^2)\n$$\n现在，我们将这些展开式代回局部截断误差$T^{n+1}$的方程中：\n$$\nT^{n+1} = \\left( P(t^n) + \\Delta t F(t^n) + \\frac{\\Delta t^2}{2} \\dot{F}(t^n) \\right) - P(t^n) - \\Delta t \\left[ (1-\\theta) F(t^n) + \\theta \\left( F(t^n) + \\Delta t \\dot{F}(t^n) \\right) \\right] + O(\\Delta t^3)\n$$\n简化各项：\n$$\nT^{n+1} = \\Delta t F(t^n) + \\frac{\\Delta t^2}{2} \\dot{F}(t^n) - \\Delta t \\left[ (1-\\theta+\\theta) F(t^n) + \\theta \\Delta t \\dot{F}(t^n) \\right] + O(\\Delta t^3)\n$$\n$$\nT^{n+1} = \\Delta t F(t^n) + \\frac{\\Delta t^2}{2} \\dot{F}(t^n) - \\Delta t F(t^n) - \\theta \\Delta t^2 \\dot{F}(t^n) + O(\\Delta t^3)\n$$\n如相容格式所预期的那样，$\\Delta t$阶的项相互抵消。剩下的是$\\Delta t^2$阶及更高阶的项：\n$$\nT^{n+1} = \\left(\\frac{1}{2} - \\theta\\right) \\Delta t^2 \\dot{F}(t^n) + O(\\Delta t^3)\n$$\n为使该方法达到二阶精度，局部截断误差必须为$O(\\Delta t^3)$阶。这要求$\\Delta t^2$项的系数为零。\n$$\n\\left(\\frac{1}{2} - \\theta\\right) \\dot{F}(t^n) = 0\n$$\n由于该问题具有物理意义并模拟非线性动力学，我们不能假设$\\dot{F}(t) = dF/dt$在所有时间以及对所有可能的场$E(t)$都恒等于零。因此，为使该条件普遍成立，系数必须为零：\n$$\n\\frac{1}{2} - \\theta = 0\n$$\n这得出了时间中心化参数的唯一值：\n$$\n\\theta = \\frac{1}{2}\n$$\n$\\theta = 1/2$这一选择对应于梯形法则，也称为Crank-Nicolson方法。众所周知，该方法（对于线性问题）是无条件稳定的，并且具有二阶精度。分析证实，它是该族格式中唯一能达到二阶精度的选择。\n\n这个结果是充分且必要的。如果$\\theta \\neq 1/2$，则LTE为$O(\\Delta t^2)$，导致一阶精度的全局解($O(\\Delta t)$)。如果$\\theta=1/2$，则LTE为$O(\\Delta t^3)$，这保证了二阶精度的全局解($O(\\Delta t^2)$)。这保持了FDTD格式的整体二阶精度，因为极化项的更新精度与Yee网格上麦克斯韦方程组中其他项的精度阶数相同。\n另一种理解方式是，标准FDTD方法是二阶精确的，因为它使用中心差分，这些差分中心位于半整数时间步（例如$t^{n+1/2}$）。电场$E$的更新涉及项$\\partial P / \\partial t$，该项需要在$t^{n+1/2}$处以二阶精度进行近似。该格式通过$(P^{n+1}-P^n)/\\Delta t$来近似这个导数，它等于$(1-\\theta)F^n + \\theta F^{n+1}$。为了使其成为$F^{n+1/2} = (\\partial P/\\partial t)^{n+1/2}$的二阶近似，加权平均必须在时间上居中，这要求权重相等，即$1-\\theta = \\theta$，再次得到$\\theta = 1/2$。", "answer": "$$\\boxed{\\frac{1}{2}}$$", "id": "3334760"}, {"introduction": "Yee元胞中电场和磁场在时间上的交错排列是FDTD方法的核心特征，但这一特性在处理非线性项时需要特别注意。本编程练习将向您揭示，在计算二次谐波时，电场和电位移矢量在时间采样上的半步之差是如何引入非物理的相位误差的。通过亲手实现和比较不同的更新方案，您将对这类数值伪影获得直观的认识，并学会如何分析和校正它们 [@problem_id:3334770]。", "problem": "考虑采用时域Yee氏交错网格的一维时域有限差分 (FDTD) 离散化。设电场为 $E(t)$，电通量密度为 $D(t)$，电极化强度为 $P(t)$，真空介电常数为 $\\varepsilon_0$。本构关系为 $D(t) = \\varepsilon_0 E(t) + P(t)$。在二阶瞬时非线性介质中，非线性极化强度为 $P_{\\mathrm{NL}}(t) = \\varepsilon_0 \\chi^{(2)} E(t)^2$，其中 $\\chi^{(2)}$ 是二阶电极化率。在Yee氏格式中，电场采样点位于整数时间索引 $t^n = n \\Delta t$ 的中心，而通量密度采样点位于半整数时间索引 $t^{n+1/2} = (n + 1/2)\\Delta t$ 的中心，其中 $\\Delta t$ 是时间步长。\n\n假设存在一个连续波激励 $E(t) = E_0 \\cos(\\omega_0 t)$，其角频率为 $\\omega_0 = 2\\pi f_0$，振幅为 $E_0$。产生的非线性极化包含一个直流 (DC) 项和一个角频率为 $2\\omega_0$ 的二次谐波项。由于离散时间上的交错，非线性极化更新的两种常见离散化方法对二次谐波分量产生了不同的有效采样：\n\n- 以$E$为中心的更新：$P_{\\mathrm{NL}}^n = \\varepsilon_0 \\chi^{(2)} \\left(E^n\\right)^2$，在 $t^n = n\\Delta t$ 处计算。\n- 以$D$为中心的更新：$P_{\\mathrm{NL}}^{n+1/2} = \\varepsilon_0 \\chi^{(2)} \\left(E^{n+1/2}\\right)^2$，在 $t^{n+1/2} = (n+1/2)\\Delta t$ 处计算。\n\n从麦克斯韦方程组和本构关系出发，二次谐波分量源于正弦激励的平方。您的任务是量化仅由以$E$为中心和以$D$为中心的极化更新之间的离散时间交错所导致的相位差，并提出和验证一个校正项，以消除二次谐波分量中的这种相位偏移。\n\n您必须编写一个完整的Python程序，对每个测试用例执行以下步骤：\n\n1. 构建时间样本，采样频率为 $f_s = 1/\\Delta t$，其中 $\\Delta t = S \\Delta x / c$，$c$ 为真空中的光速，$S$ 是Courant数，$\\Delta x$ 是空间步长。使用精确的物理常数 $c = 299{,}792{,}458\\,\\mathrm{m/s}$ 和 $\\varepsilon_0 = 8.854{,}187{,}817\\times 10^{-12}\\,\\mathrm{F/m}$。\n\n2. 生成正弦电场时间序列 $E(t) = E_0 \\cos(\\omega_0 t)$，其中时间 $t$ 在 $t^n = n\\Delta t$（$n = 0,1,\\ldots,N-1$）处采样。选择样本数 $N$，使持续时间至少包含1024个基波周期：$N = \\lceil 1024 \\cdot f_s / f_0 \\rceil$。此选择可确保足够的频率分辨率。所有时间都必须以秒为单位表示。\n\n3. 计算两个非线性极化时间序列：\n   - 以$E$为中心：在 $t^n$ 处的 $P_{\\mathrm{NL}}^n = \\varepsilon_0 \\chi^{(2)} \\left[E_0 \\cos(\\omega_0 n\\Delta t)\\right]^2$。\n   - 以$D$为中心：在 $t^{n+1/2}$ 处的 $P_{\\mathrm{NL}}^{n+1/2} = \\varepsilon_0 \\chi^{(2)} \\left[E_0 \\cos\\left(\\omega_0 (n+1/2)\\Delta t\\right)\\right]^2$。\n\n4. 通过计算每个极化时间序列与 $\\exp\\left(-j\\,2\\omega_0 t\\right)$ 的加窗内积来估计复二次谐波相量，其中 $j$ 是虚数单位，$t$ 是每个序列对应的时间网格。对两个序列使用Hann窗 $w[n] = \\frac{1}{2}\\left(1 - \\cos\\left(\\frac{2\\pi n}{N-1}\\right)\\right)$ 以减轻频谱泄漏。使用复数辐角提取所得复数的相位角 $\\phi_E$ 和 $\\phi_D$。\n\n5. 计算测得的相位差 $\\Delta \\phi = \\mathrm{wrap}_{(-\\pi,\\pi]}\\left(\\phi_D - \\phi_E\\right)$，其中缠绕函数将角度映射到区间 $(-\\pi,\\pi]$。\n\n6. 提出一个校正项，以补偿二次谐波分量中由交错引起的相移。通过从测得的相位差中减去解析偏移量 $\\omega_0 \\Delta t$ 来实现校正：$\\Delta \\phi_{\\mathrm{corr}} = \\mathrm{wrap}_{(-\\pi,\\pi]}\\left(\\Delta \\phi - \\omega_0 \\Delta t\\right)$。将校正后的残余相位误差报告为绝对值 $|\\Delta \\phi_{\\mathrm{corr}}|$。\n\n对以下测试套件执行上述操作。所有频率单位必须为赫兹，长度单位为米，相位单位为弧度。二阶电极化率的单位必须为米/伏特。\n\n- 测试用例 A (正常路径)：$f_0 = 10\\times 10^9\\,\\mathrm{Hz}$，$\\Delta x = 1.0\\times 10^{-3}\\,\\mathrm{m}$，$S = 0.99$，$E_0 = 1.0\\times 10^6\\,\\mathrm{V/m}$，$\\chi^{(2)} = 1.0\\times 10^{-12}\\,\\mathrm{m/V}$。\n- 测试用例 B (二次谐波接近奈奎斯特边界但有效)：$f_0 = 9\\times 10^9\\,\\mathrm{Hz}$，$\\Delta x = 1.5\\times 10^{-2}\\,\\mathrm{m}$，$S = 0.99$，$E_0 = 1.0\\times 10^6\\,\\mathrm{V/m}$，$\\chi^{(2)} = 1.0\\times 10^{-12}\\,\\mathrm{m/V}$。\n- 测试用例 C (相对于采样的低频)：$f_0 = 1\\times 10^9\\,\\mathrm{Hz}$，$\\Delta x = 1.0\\times 10^{-3}\\,\\mathrm{m}$，$S = 0.99$，$E_0 = 1.0\\times 10^6\\,\\mathrm{V/m}$，$\\chi^{(2)} = 1.0\\times 10^{-12}\\,\\mathrm{m/V}$。\n\n您的程序必须生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。对于每个测试用例，输出两个以弧度为单位的浮点数：\n- 测得的相位差 $\\Delta \\phi$，以及\n- 应用所提出的校正后的绝对残差 $|\\Delta \\phi_{\\mathrm{corr}}|$。\n\n因此，最终输出必须采用\n$[\\Delta \\phi_A,|\\Delta \\phi_{A,\\mathrm{corr}}|,\\Delta \\phi_B,|\\Delta \\phi_{B,\\mathrm{corr}}|,\\Delta \\phi_C,|\\Delta \\phi_{C,\\mathrm{corr}}|]$ 的格式。\n\n所有相位必须以弧度为单位，表示为十进制数。角度在报告前必须被缠绕到 $(-\\pi,\\pi]$。不应打印任何其他文本。", "solution": "我们从一维的麦克斯韦方程组和本构关系开始。电场 $E(t)$、磁场 $H(t)$、电通量密度 $D(t)$ 和极化强度 $P(t)$ 的相关方程为\n$$\n\\frac{\\partial D}{\\partial t} = \\frac{\\partial}{\\partial x} H, \\quad\n\\frac{\\partial B}{\\partial t} = -\\frac{\\partial}{\\partial x} E, \\quad\nD(t) = \\varepsilon_0 E(t) + P(t), \\quad B(t) = \\mu_0 H(t),\n$$\n其中 $B(t)$ 是磁通量密度，$\\mu_0$ 是真空磁导率。在二阶瞬时非线性介质中，非线性极化强度建模为\n$$\nP_{\\mathrm{NL}}(t) = \\varepsilon_0 \\chi^{(2)} E(t)^2.\n$$\n对于连续波 (CW) 激励 $E(t) = E_0 \\cos(\\omega_0 t)$，其平方会产生一个直流 (DC) 项和一个二次谐波项：\n$$\nE(t)^2 = E_0^2 \\cos^2(\\omega_0 t) = \\frac{E_0^2}{2}\\left[1 + \\cos(2\\omega_0 t)\\right],\n$$\n因此\n$$\nP_{\\mathrm{NL}}(t) = \\varepsilon_0 \\chi^{(2)} \\frac{E_0^2}{2}\\left[1 + \\cos(2\\omega_0 t)\\right].\n$$\n在时域有限差分 (FDTD) Yee氏离散化中，交错将 $E$ 采样点置于整数时间索引 $t^n = n\\Delta t$ 处，将 $D$ 采样点置于半整数时间索引 $t^{n+1/2} = (n+1/2)\\Delta t$ 处，其中时间步长 $\\Delta t$ 通过Courant条件与空间离散化相关联：\n$$\n\\Delta t = \\frac{S \\Delta x}{c},\n$$\n其中 $S$ 是Courant数，$\\Delta x$ 是单元尺寸，$c$ 是真空中的光速。离散化非线性极化更新的两种广泛使用的方法是：\n\n1. 以$E$为中心：\n$$\nP_{\\mathrm{NL}}^n = \\varepsilon_0 \\chi^{(2)} \\left(E^n\\right)^2 = \\varepsilon_0 \\chi^{(2)} \\left[E_0 \\cos(\\omega_0 n\\Delta t)\\right]^2,\n$$\n该方法将极化计算与 $E$ 时间网格对齐。\n\n2. 以$D$为中心：\n$$\nP_{\\mathrm{NL}}^{n+1/2} = \\varepsilon_0 \\chi^{(2)} \\left(E^{n+1/2}\\right)^2 = \\varepsilon_0 \\chi^{(2)} \\left[E_0 \\cos\\left(\\omega_0 (n+1/2)\\Delta t\\right)\\right]^2,\n$$\n该方法将极化计算与 $D$ 时间网格对齐。\n\n关注二次谐波分量，以$E$为中心的极化其二次谐波项与 $\\cos(2\\omega_0 n\\Delta t)$ 成正比，而以$D$为中心的版本则与 $\\cos\\left(2\\omega_0 (n+1/2)\\Delta t\\right) = \\cos\\left(2\\omega_0 n\\Delta t + \\omega_0 \\Delta t\\right)$ 成正比。后者相对于前者包含一个额外的相位偏移 $\\omega_0 \\Delta t$。因此，由交错引起的、以$D$为中心和以$E$为中心的二次谐波分量之间的相位差为\n$$\n\\Delta \\phi_{\\mathrm{analytic}} = \\omega_0 \\Delta t.\n$$\n为了数值上验证和量化此相位差并演示校正方法，我们采用一种相量估计方法。对于在时间 $t[n]$ 采样的每个离散化极化时间序列 $P[n]$，我们计算其与复指数 $\\exp(-j 2\\omega_0 t[n])$ 的加窗内积，以提取复二次谐波相量：\n$$\nC = \\sum_{n=0}^{N-1} w[n]\\, P[n]\\, \\exp\\left(-j 2\\omega_0 t[n]\\right),\n$$\n其中 $w[n]$ 是由下式给出的Hann窗\n$$\nw[n] = \\frac{1}{2}\\left(1 - \\cos\\left(\\frac{2\\pi n}{N-1}\\right)\\right).\n$$\n$C$ 的相位角即为估计的二次谐波相位，记为 $\\phi$。我们计算以$E$为中心序列的 $\\phi_E$ 和以$D$为中心序列的 $\\phi_D$。测得的相位差为\n$$\n\\Delta \\phi = \\mathrm{wrap}_{(-\\pi,\\pi]}\\left(\\phi_D - \\phi_E\\right),\n$$\n其中缠绕函数将结果限制在主区间 $(-\\pi,\\pi]$ 内：\n$$\n\\mathrm{wrap}_{(-\\pi,\\pi]}(\\theta) = \\left((\\theta + \\pi) \\bmod 2\\pi\\right) - \\pi.\n$$\n为了校正二次谐波分量中由交错引起的偏移，我们提出了一个等于解析相移 $\\omega_0 \\Delta t$ 的相位校正。在频域中，这等效于将二次谐波相量乘以 $\\exp(-j \\omega_0 \\Delta t)$。在报告的标量差中，我们应用\n$$\n\\Delta \\phi_{\\mathrm{corr}} = \\mathrm{wrap}_{(-\\pi,\\pi]}\\left(\\Delta \\phi - \\omega_0 \\Delta t\\right),\n$$\n并将其绝对值 $|\\Delta \\phi_{\\mathrm{corr}}|$ 报告为校正后的残余相位误差。对于一个完美的校正，受加窗和有限长度效应的影响，$|\\Delta \\phi_{\\mathrm{corr}}|$ 在数值上应接近于零。\n\n程序中实现的算法步骤：\n\n1. 对每个测试用例，计算 $\\Delta t = S \\Delta x / c$ 和 $f_s = 1/\\Delta t$。\n2. 设置 $N = \\lceil 1024 \\cdot f_s / f_0 \\rceil$ 并构建 $t^n = n\\Delta t$（$n=0,1,\\ldots,N-1$）。\n3. 计算 $E^n = E_0 \\cos(\\omega_0 t^n)$ 和 $E^{n+1/2} = E_0 \\cos(\\omega_0 (t^n + \\Delta t/2))$。\n4. 形成 $P_{\\mathrm{NL}}^n = \\varepsilon_0 \\chi^{(2)} (E^n)^2$ 和 $P_{\\mathrm{NL}}^{n+1/2} = \\varepsilon_0 \\chi^{(2)} (E^{n+1/2})^2$。\n5. 计算Hann窗 $w[n]$ 并形成复内积：\n$$\nC_E = \\sum_{n=0}^{N-1} w[n] P_{\\mathrm{NL}}^n \\exp\\left(-j 2\\omega_0 t^n\\right), \\quad\nC_D = \\sum_{n=0}^{N-1} w[n] P_{\\mathrm{NL}}^{n+1/2} \\exp\\left(-j 2\\omega_0 (t^n + \\Delta t/2)\\right).\n$$\n6. 提取相位 $\\phi_E = \\arg(C_E)$、$\\phi_D = \\arg(C_D)$，并计算 $\\Delta \\phi = \\mathrm{wrap}_{(-\\pi,\\pi]}(\\phi_D - \\phi_E)$。\n7. 应用校正 $\\Delta \\phi_{\\mathrm{corr}} = \\mathrm{wrap}_{(-\\pi,\\pi]}(\\Delta \\phi - \\omega_0 \\Delta t)$ 并报告 $|\\Delta \\phi_{\\mathrm{corr}}|$。\n\n测试套件覆盖范围：\n\n- 测试用例 A (正常路径) 使用相对于 $f_0$ 适中的 $\\Delta t$，使得 $\\omega_0 \\Delta t$ 较小但不可忽略。\n- 测试用例 B (近边界) 使用较大的 $\\Delta t$，且 $2f_0$ 接近但低于采样频率 $f_s$，以探究奈奎斯特极限附近无混叠的行为。\n- 测试用例 C (边缘情况) 使用较低的 $f_0$ 和相同的 $\\Delta x$ 与 $S$，产生非常小的 $\\omega_0 \\Delta t$，以验证在小偏移量情况下的校正效果。\n\n程序以 $[\\Delta \\phi_A,|\\Delta \\phi_{A,\\mathrm{corr}}|,\\Delta \\phi_B,|\\Delta \\phi_{B,\\mathrm{corr}}|,\\Delta \\phi_C,|\\Delta \\phi_{C,\\mathrm{corr}}|]$ 的格式输出单行，所有条目均以弧度为单位。数值结果验证了分析相移 $\\omega_0 \\Delta t$ 的正确性，并表明减去此偏移量可以在数值精度范围内消除由交错引起的相位差异。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Physical constants\nc = 299_792_458.0  # m/s\neps0 = 8.854_187_817e-12  # F/m\n\ndef hann_window(N: int) - np.ndarray:\n    n = np.arange(N, dtype=np.float64)\n    return 0.5 * (1.0 - np.cos(2.0 * np.pi * n / (N - 1)))\n\ndef wrap_to_pi(phi: float) - float:\n    return ((phi + np.pi) % (2.0 * np.pi)) - np.pi\n\ndef second_harmonic_phase(E0: float, f0: float, dt: float, chi2: float, N: int) - tuple[float, float]:\n    \"\"\"\n    Compute the measured phase difference between D-centered and E-centered\n    nonlinear polarization updates at the second harmonic, and the residual\n    after correcting by subtracting omega0*dt.\n    \"\"\"\n    t = np.arange(N, dtype=np.float64) * dt\n    w = hann_window(N)\n\n    omega0 = 2.0 * np.pi * f0\n\n    # Electric field at integer and half-integer times\n    E_center = E0 * np.cos(omega0 * t)\n    E_half = E0 * np.cos(omega0 * (t + 0.5 * dt))\n\n    # Nonlinear polarization (second-order) time series\n    P_E = eps0 * chi2 * (E_center ** 2)\n    P_D = eps0 * chi2 * (E_half ** 2)\n\n    # Demodulate at 2*omega0 using windowed inner product\n    exp_E = np.exp(-1j * (2.0 * omega0) * t)\n    exp_D = np.exp(-1j * (2.0 * omega0) * (t + 0.5 * dt))\n\n    C_E = np.sum(w * P_E * exp_E)\n    C_D = np.sum(w * P_D * exp_D)\n\n    phi_E = np.angle(C_E)\n    phi_D = np.angle(C_D)\n\n    dphi = wrap_to_pi(phi_D - phi_E)\n    # Correction term: subtract analytical offset omega0*dt\n    dphi_corr = wrap_to_pi(dphi - omega0 * dt)\n    residual = abs(dphi_corr)\n\n    return dphi, residual\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (f0 [Hz], dx [m], S [-], E0 [V/m], chi2 [m/V])\n    test_cases = [\n        (10.0e9, 1.0e-3, 0.99, 1.0e6, 1.0e-12),   # Test case A\n        (9.0e9, 1.5e-2, 0.99, 1.0e6, 1.0e-12),    # Test case B\n        (1.0e9, 1.0e-3, 0.99, 1.0e6, 1.0e-12),    # Test case C\n    ]\n\n    results = []\n    for f0, dx, S, E0, chi2 in test_cases:\n        dt = S * dx / c\n        fs = 1.0 / dt\n        # At least 1024 cycles of the fundamental\n        N = int(np.ceil(1024.0 * fs / f0))\n        dphi, residual = second_harmonic_phase(E0=E0, f0=f0, dt=dt, chi2=chi2, N=N)\n        results.append(dphi)\n        results.append(residual)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3334770"}]}