{"hands_on_practices": [{"introduction": "检验理论正确性的最基本方法之一就是通过数值实验进行验证。本练习旨在通过对一个已知的二维标量场源进行边界积分，从而在数值上验证惠更斯原理的有效性。通过将惠更斯积分方程离散化并与精确解进行比较，您可以亲身体验如何将理论公式转化为实际的计算代码，并评估数值近似的准确性。[@problem_id:3314980]", "problem": "考虑自由空间中的二维 ($2$D) 时谐横磁 (TM) 极化，其中标量电场分量 $E_z$ 服从标量 Helmholtz 方程。设 $u(\\mathbf{r})$ 表示角频率为 $\\omega$、自由空间波数为 $k$ (单位为弧度/米) 的单频解的标量场 $E_z(\\mathbf{r})$。在自由空间中，无源区域内的 $u(\\mathbf{r})$ 满足齐次 Helmholtz 方程 $(\\nabla^2 + k^2) u(\\mathbf{r}) = 0$，二维 Helmholtz 方程的基本解 (自由空间格林函数) 为函数\n$$\nG(\\mathbf{r}, \\mathbf{r}') = \\frac{\\mathrm{i}}{4} H_0^{(1)}\\!\\big(k \\, \\lvert \\mathbf{r} - \\mathbf{r}' \\rvert \\big),\n$$\n其中 $H_\\nu^{(1)}$ 是第一类 $\\nu$ 阶 Hankel 函数，$\\mathrm{i}$ 表示虚数单位。Huygens 等效原理将闭合轮廓 $\\Gamma$ 外部的场表示为 $\\Gamma$ 上的等效电磁源分布。在 TM 标量情况下，这简化为一个边界积分表达式，其中涉及场在 $\\Gamma$ 上的值及其法向导数。\n\n设 $\\Gamma$ 是以原点为中心、半径为 $a$ 的圆，由角度 $\\phi \\in [0, 2\\pi)$ 参数化，其单位外法线 $\\hat{\\mathbf{n}}'(\\phi)$ 沿径向向外(指向外部区域)。考虑位于原点的一个点源，其产生的精确场为\n$$\nu(\\mathbf{r}) = \\frac{\\mathrm{i}}{4} H_0^{(1)}\\!\\big(k \\, r\\big),\n$$\n其中 $r = \\lvert \\mathbf{r} \\rvert$。在边界 $\\Gamma$ 上，场及其外法向导数为\n$$\nu(a) = \\frac{\\mathrm{i}}{4} H_0^{(1)}\\!\\big(k \\, a\\big), \\quad \\frac{\\partial u}{\\partial n}\\bigg|_{r=a} = \\frac{\\mathrm{i}}{4} \\left(-k\\right) H_1^{(1)}\\!\\big(k \\, a\\big).\n$$\n对于 $\\Gamma$ 外的观测点 $\\mathbf{r}$，其外部场的标量 Huygens 边界积分表示为\n$$\nu(\\mathbf{r}) = \\int_{\\Gamma} \\left[ G(\\mathbf{r}, \\mathbf{r}') \\, \\frac{\\partial u(\\mathbf{r}')}{\\partial n'} - u(\\mathbf{r}') \\, \\frac{\\partial G(\\mathbf{r}, \\mathbf{r}')}{\\partial n'} \\right] \\, \\mathrm{d}s',\n$$\n其中 $\\mathrm{d}s'$ 是 $\\Gamma$ 上的线元，$\\hat{\\mathbf{n}}'$ 是 $\\Gamma$ 上的外法线，且\n$$\n\\frac{\\partial G(\\mathbf{r}, \\mathbf{r}')}{\\partial n'} = \\nabla' G(\\mathbf{r}, \\mathbf{r}') \\cdot \\hat{\\mathbf{n}}' = \\frac{\\mathrm{i} k}{4} H_1^{(1)}\\!\\big(k \\, R\\big) \\, \\left(\\hat{\\mathbf{n}}' \\cdot \\hat{\\mathbf{R}}\\right),\n$$\n其中 $R = \\lvert \\mathbf{r} - \\mathbf{r}' \\rvert$ 且 $\\hat{\\mathbf{R}} = (\\mathbf{r} - \\mathbf{r}')/R$。此表示体现了等效原理：外部场可由 $\\Gamma$ 上的等效源再现，这些等效源编码了 $u$ 及其法向导数。\n\n任务：使用 $N$ 个面板的均匀角度剖分和中点法则，推导、实现并测试 $\\Gamma$ 上 Huygens 边界积分的数值离散化。具体而言，对于 $m \\in \\{0, 1, \\dots, N-1\\}$，使用 $\\Delta \\phi = \\frac{2\\pi}{N}$，将 $\\Gamma$ 参数化为 $\\phi_m = \\left(m + \\frac{1}{2}\\right) \\Delta \\phi$，源点为 $\\mathbf{r}'(\\phi_m) = a \\, [\\cos\\phi_m, \\sin\\phi_m]$，外法线为 $\\hat{\\mathbf{n}}'(\\phi_m) = [\\cos\\phi_m, \\sin\\phi_m]$，权重为 $w = a \\, \\Delta \\phi$。对于一个在极坐标 $(r_o, \\theta_o)$ 中指定的观测点，计算其数值近似解\n$$\nu_{\\mathrm{num}}(\\mathbf{r}_o) \\approx \\sum_{m=0}^{N-1} \\left[ G\\big(\\mathbf{r}_o, \\mathbf{r}'(\\phi_m)\\big) \\, \\frac{\\partial u}{\\partial n}\\bigg|_{r=a} - u(a) \\, \\frac{\\partial G\\big(\\mathbf{r}_o, \\mathbf{r}'(\\phi_m)\\big)}{\\partial n'} \\right] \\, w,\n$$\n并将其与精确场进行比较\n$$\nu_{\\mathrm{exact}}(\\mathbf{r}_o) = \\frac{\\mathrm{i}}{4} H_0^{(1)}\\!\\big(k \\, r_o\\big).\n$$\n计算相对误差\n$$\n\\varepsilon = \\frac{\\lvert u_{\\mathrm{num}}(\\mathbf{r}_o) - u_{\\mathrm{exact}}(\\mathbf{r}_o) \\rvert}{\\lvert u_{\\mathrm{exact}}(\\mathbf{r}_o) \\rvert}.\n$$\n\n使用以下测试套件，所有距离单位为米，角度单位为弧度，波数 $k$ 的单位为弧度/米：\n- 测试用例 1 (正常路径): $k = 20$, $a = 0.5$, $N = 200$, $r_o = 1.2$, $\\theta_o = 0.7$。\n- 测试用例 2 (粗糙离散化边界情况): $k = 20$, $a = 0.5$, $N = 16$, $r_o = 1.2$, $\\theta_o = 0.7$。\n- 测试用例 3 (近边界边缘情况): $k = 20$, $a = 0.5$, $N = 400$, $r_o = 0.55$, $\\theta_o = 1.3$。\n- 测试用例 4 (远场情况): $k = 20$, $a = 0.5$, $N = 200$, $r_o = 3.0$, $\\theta_o = 2.1$。\n\n您的程序必须为每个测试用例计算相对误差 $\\varepsilon$，并生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个值四舍五入到六位小数 (例如, $[0.001234,0.056789,0.000001,0.012345]$)。角度必须解释为弧度，波数单位必须是弧度/米。输出是无量纲的。不应读取任何输入；所有参数均根据上述测试套件进行硬编码。", "solution": "该问题要求对自由空间中的二维时谐标量场，数值验证 Huygens 等效原理。该场由位于原点的线源生成，其在圆形边界外部的值将使用边界积分表示法进行计算。此数值结果将与已知的解析解进行比较，以量化中点法则离散化的精度。\n\n标量场 $u(\\mathbf{r})$ 满足齐次 Helmholtz 方程 $(\\nabla^2 + k^2) u(\\mathbf{r}) = 0$，其隐式时间依赖性为 $e^{-\\mathrm{i}\\omega t}$，其中 $k$ 是自由空间波数。由原点处的线源产生的精确场由以原点为中心的自由空间格林函数给出：\n$$\nu_{\\mathrm{exact}}(\\mathbf{r}) = \\frac{\\mathrm{i}}{4} H_0^{(1)}\\!\\big(k \\, r\\big)\n$$\n其中 $r = \\lvert \\mathbf{r} \\rvert$，$H_0^{(1)}$ 是第一类零阶 Hankel 函数，$\\mathrm{i}$ 是虚数单位。\n\n根据 Huygens 原理，对于闭合轮廓 $\\Gamma$ 外部区域中的任意观测点 $\\mathbf{r}$，场 $u(\\mathbf{r})$ 可以根据其在 $\\Gamma$ 上的值和法向导数值进行重构。对于二维标量问题，这由以下边界积分方程表示：\n$$\nu(\\mathbf{r}) = \\int_{\\Gamma} \\left[ G(\\mathbf{r}, \\mathbf{r}') \\, \\frac{\\partial u(\\mathbf{r}')}{\\partial n'} - u(\\mathbf{r}') \\, \\frac{\\partial G(\\mathbf{r}, \\mathbf{r}')}{\\partial n'} \\right] \\, \\mathrm{d}s'\n$$\n此处，$\\mathbf{r}'$ 是轮廓 $\\Gamma$ 上的一个点，$\\mathrm{d}s'$ 是微分弧长元，$\\hat{\\mathbf{n}}'$ 是 $\\Gamma$ 上指向外部的单位法向量。核函数 $G(\\mathbf{r}, \\mathbf{r}')$ 是自由空间格林函数：\n$$\nG(\\mathbf{r}, \\mathbf{r}') = \\frac{\\mathrm{i}}{4} H_0^{(1)}\\!\\big(k \\, \\lvert \\mathbf{r} - \\mathbf{r}' \\rvert \\big)\n$$\n$G$ 关于源坐标 $\\mathbf{r}'$ 的梯度是 $\\nabla' G(\\mathbf{r}, \\mathbf{r}') = \\frac{\\mathrm{d}G}{\\mathrm{d}R} \\nabla' R$。对于 $R=\\lvert \\mathbf{r}-\\mathbf{r}' \\rvert$，我们有 $\\nabla' R = \\frac{\\mathbf{r}' - \\mathbf{r}}{R}$。格林函数关于其自变量 $z=kR$ 的导数是 $\\frac{\\mathrm{d}}{\\mathrm{d}z} \\left(\\frac{\\mathrm{i}}{4} H_0^{(1)}(z)\\right) = \\frac{-\\mathrm{i}k}{4}H_1^{(1)}(z)$。因此，\n$$\n\\nabla' G(\\mathbf{r}, \\mathbf{r}') = \\frac{-\\mathrm{i}k}{4} H_1^{(1)}(kR)\\frac{\\mathbf{r}' - \\mathbf{r}}{R}\n$$\n因此，格林函数的法向导数为\n$$\n\\frac{\\partial G(\\mathbf{r}, \\mathbf{r}')}{\\partial n'} = \\nabla' G(\\mathbf{r}, \\mathbf{r}') \\cdot \\hat{\\mathbf{n}}' = \\frac{-\\mathrm{i}k}{4} H_1^{(1)}(kR)\\frac{(\\mathbf{r}' - \\mathbf{r})\\cdot\\hat{\\mathbf{n}}'}{R} = \\frac{\\mathrm{i}k}{4} H_1^{(1)}(kR)\\frac{(\\mathbf{r} - \\mathbf{r}')\\cdot\\hat{\\mathbf{n}}'}{R}\n$$\n该表达式与问题描述中提供的公式相匹配，其中 $\\hat{\\mathbf{R}} = (\\mathbf{r} - \\mathbf{r}')/R$。\n\n对于本问题，$\\Gamma$ 是一个以原点为中心、半径为 $a$ 的圆。积分方程所需的边界数据从已知的解析解推导得出：\n$$\nu(\\mathbf{r}')\\big|_{r'=a} = u(a) = \\frac{\\mathrm{i}}{4} H_0^{(1)}\\!\\big(k \\, a\\big)\n$$\n$$\n\\frac{\\partial u(\\mathbf{r}')}{\\partial n'}\\bigg|_{r'=a} = \\frac{\\partial u}{\\partial r'}\\bigg|_{r'=a} = \\frac{\\mathrm{d}}{\\mathrm{d}r'} \\left[ \\frac{\\mathrm{i}}{4} H_0^{(1)}\\!\\big(k \\, r'\\big) \\right]_{r'=a} = \\frac{-\\mathrm{i} k}{4} H_1^{(1)}\\!\\big(k \\, a\\big)\n$$\n\n任务是使用中点法则来近似边界积分。我们将圆形轮廓 $\\Gamma$ 剖分为 $N$ 个均匀的面板。第 $m$ 个面板的中点位于角度 $\\phi_m = (m + \\frac{1}{2})\\Delta\\phi$ 处，其中 $m \\in \\{0, 1, \\dots, N-1\\}$，$\\Delta\\phi = 2\\pi/N$。源点的坐标为 $\\mathbf{r}'_m = (a\\cos\\phi_m, a\\sin\\phi_m)$。面板长度为 $w = a\\Delta\\phi$。\n\n积分的数值近似变为以下求和形式：\n$$\nu_{\\mathrm{num}}(\\mathbf{r}_o) = \\sum_{m=0}^{N-1} \\left[ G(\\mathbf{r}_o, \\mathbf{r}'_m) \\left(\\frac{-\\mathrm{i} k}{4} H_1^{(1)}\\!\\big(k \\, a\\big)\\right) - \\left(\\frac{\\mathrm{i}}{4} H_0^{(1)}\\!\\big(k \\, a\\big)\\right) \\frac{\\partial G(\\mathbf{r}_o, \\mathbf{r}'_m)}{\\partial n'_m} \\right] w\n$$\n其中 $\\mathbf{r}_o$ 是以极坐标 $(r_o, \\theta_o)$ 给出的观测点。\n\n在实现中，我们为每个面板 $m$ 计算几何项。距离 $R_m = \\lvert \\mathbf{r}_o - \\mathbf{r}'_m \\rvert$ 使用余弦定理计算：\n$$\nR_m = \\sqrt{r_o^2 + a^2 - 2ar_o\\cos(\\theta_o - \\phi_m)}\n$$\n在 $\\mathbf{r}'_m$ 处的外法线是 $\\hat{\\mathbf{n}}'_m = (\\cos\\phi_m, \\sin\\phi_m)$。计算格林函数导数所需的点积是 $\\hat{\\mathbf{n}}'_m \\cdot \\hat{\\mathbf{R}}_m = (\\hat{\\mathbf{n}}'_m \\cdot (\\mathbf{r}_o - \\mathbf{r}'_m)) / R_m$。分子为：\n$$\n\\hat{\\mathbf{n}}'_m \\cdot (\\mathbf{r}_o - \\mathbf{r}'_m) = \\hat{\\mathbf{n}}'_m \\cdot \\mathbf{r}_o - \\hat{\\mathbf{n}}'_m \\cdot \\mathbf{r}'_m = r_o \\cos(\\theta_o - \\phi_m) - a\n$$\n这就得到了计算格林函数法向导数所需的项。通过将这些表达式代入求和式，我们计算出 $u_{\\mathrm{num}}(\\mathbf{r}_o)$。\n\n最后一步是通过将数值结果与观测点处的精确解析解 $u_{\\mathrm{exact}}(\\mathbf{r}_o) = \\frac{\\mathrm{i}}{4} H_0^{(1)}\\!\\big(k \\, r_o\\big)$ 进行比较，来计算相对误差 $\\varepsilon$：\n$$\n\\varepsilon = \\frac{\\lvert u_{\\mathrm{num}}(\\mathbf{r}_o) - u_{\\mathrm{exact}}(\\mathbf{r}_o) \\rvert}{\\lvert u_{\\mathrm{exact}}(\\mathbf{r}_o) \\rvert}\n$$\n提供的 Python 代码为每个测试用例实现了此算法。它使用 `NumPy` 进行向量化计算以提高效率，并使用 `SciPy` 来计算所需的 Hankel 函数 $H_0^{(1)}$ 和 $H_1^{(1)}$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import special as sp\n\ndef compute_error(k, a, N, r_o, theta_o):\n    \"\"\"\n    Computes the relative error of the numerical Huygens integral\n    approximation for a given set of parameters.\n\n    Args:\n        k (float): Wavenumber in radians/meter.\n        a (float): Radius of the circular contour in meters.\n        N (int): Number of panels for numerical integration.\n        r_o (float): Radial coordinate of the observation point in meters.\n        theta_o (float): Angular coordinate of the observation point in radians.\n\n    Returns:\n        float: The computed relative error.\n    \"\"\"\n    # Numerical constants and discretization parameters\n    i_unit = 1j\n    delta_phi = 2.0 * np.pi / N\n    # Midpoint rule weight (panel arc length)\n    w = a * delta_phi\n\n    # Midpoint angles for all N panels (vectorized)\n    m = np.arange(N)\n    phi_m = (m + 0.5) * delta_phi\n\n    # Observation point in Cartesian coordinates\n    xo = r_o * np.cos(theta_o)\n    yo = r_o * np.sin(theta_o)\n\n    # Source points on the contour in Cartesian coordinates (vectorized)\n    xp_m = a * np.cos(phi_m)\n    yp_m = a * np.sin(phi_m)\n\n    # Distances R_m from each source point to the observation point (vectorized)\n    # Using law of cosines for robustness and simplicity\n    R_m = np.sqrt(r_o**2 + a**2 - 2 * a * r_o * np.cos(theta_o - phi_m))\n\n    # --- Pre-calculate boundary data on the contour r=a ---\n    # Field u(a) on the boundary\n    u_on_a = (i_unit / 4.0) * sp.hankel1(0, k * a)\n    # Normal derivative ∂u/∂n on the boundary\n    du_dn_on_a = (-i_unit * k / 4.0) * sp.hankel1(1, k * a)\n\n    # --- Evaluate kernels of the integral equation (vectorized) ---\n    # Green's function G(r_o, r'_m)\n    G_m = (i_unit / 4.0) * sp.hankel1(0, k * R_m)\n\n    # Dot product (n' · R_hat) for the normal derivative of the Green's function\n    ndotRhat_m = (r_o * np.cos(theta_o - phi_m) - a) / R_m\n    \n    # Normal derivative of Green's function ∂G(r_o, r'_m)/∂n'\n    dGdn_m = (i_unit * k / 4.0) * sp.hankel1(1, k * R_m) * ndotRhat_m\n\n    # --- Compute the numerical integral using the midpoint rule ---\n    # Evaluate the integrand for each panel (vectorized)\n    integrand = G_m * du_dn_on_a - u_on_a * dGdn_m\n    \n    # Sum over all panels and multiply by the panel weight\n    u_num = np.sum(integrand) * w\n\n    # --- Compute the exact solution ---\n    u_exact = (i_unit / 4.0) * sp.hankel1(0, k * r_o)\n\n    # --- Compute the relative error ---\n    relative_error = np.abs(u_num - u_exact) / np.abs(u_exact)\n    \n    return relative_error\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # (k, a, N, r_o, theta_o)\n    test_cases = [\n        (20.0, 0.5, 200, 1.2, 0.7),\n        (20.0, 0.5, 16, 1.2, 0.7),\n        (20.0, 0.5, 400, 0.55, 1.3),\n        (20.0, 0.5, 200, 3.0, 2.1),\n    ]\n\n    results = []\n    for case in test_cases:\n        k, a, N, r_o, theta_o = case\n        error = compute_error(k, a, N, r_o, theta_o)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    # Each value is formatted to six decimal places.\n    print(f\"[{','.join([f'{err:.6f}' for err in results])}]\")\n\nsolve()\n```", "id": "3314980"}, {"introduction": "在验证了原理的正确性之后，下一个实际问题是如何在计算中有效地应用它。对于任何基于快速傅里叶变换（FFT）的传播算法，对惠更斯面进行适当的采样至关重要，以避免混叠误差。本练习将物理概念（倏逝波的衰减）与数值要求（采样率）联系起来，指导您如何根据给定的误差容限来确定关键的数值参数。[@problem_id:3314987]", "problem": "一个局限于半空间 $z<0$ 内的时谐电磁源分布被一个与自由空间中 $z=0$ 平面重合的平面惠更斯面所包围，其外法向单位矢量为 $\\hat{\\mathbf{n}}=\\hat{\\mathbf{z}}$。根据惠更斯原理和等效原理，半空间 $z>0$ 中的场可以由位于 $z=0$ 平面上的等效电表面电流密度 $\\mathbf{J}_{s}=\\hat{\\mathbf{n}}\\times\\mathbf{H}$ 和磁表面电流密度 $\\mathbf{M}_{s}=-\\hat{\\mathbf{n}}\\times\\mathbf{E}$ 产生，其中 $\\mathbf{E}$ 和 $\\mathbf{H}$ 是该表面上的原始场。计算电磁学中的一个数值求解器在 $z=0$ 平面上沿 $x$ 和 $y$ 方向以间距 $\\Delta$ 对这些等效电流进行均匀采样，并使用通过快速傅里叶变换 (FFT) 计算的二维离散傅里叶变换 (DFT) 来实现一个从 $z=0$ 到 $z>0$ 区域内目标平面 $z=d$ 的角谱传播模型。\n\n假设自由空间波数为 $k=2\\pi f/c$，其中 $f$ 是频率，$c$ 是真空中的光速。在角谱表示中，一个幅度为 $k_{t}=\\sqrt{k_{x}^{2}+k_{y}^{2}}$ 的横向空间频率分量对场的贡献因子为 $\\exp(i k_{z} z)$，其中当 $k_{t}\\leq k$ 时（传播谱），$k_{z}=\\sqrt{k^{2}-k_{t}^{2}}$；当 $k_{t}>k$ 时（倏逝谱），$k_{z}=i\\sqrt{k_{t}^{2}-k^{2}}$，因此倏逝分量按 $\\exp\\!\\big(-\\sqrt{k_{t}^{2}-k^{2}}\\,z\\big)$ 衰减。\n\n为了控制由均匀采样引入的频谱复制所引起的混叠，您决定选择一个 $\\Delta$，使得离散频谱的第一个复制谱起始于一个横向波数偏移处，该偏移远在对 $z=d$ 处场有影响的不可忽略频谱区域之外。您为 $z=d$ 处倏逝分量的相对幅度贡献设定一个容差 $\\eta$，并定义一个有效横向频谱截止波数 $K$，使得 $k_{t}\\geq K$ 的倏逝分量在 $z=d$ 处衰减到幅度小于 $\\eta$。然后，您要求对于所有 $k_{t}\\leq K$ 的频谱分量，均匀采样的数据都没有混叠。\n\n给定 $f=10\\,\\mathrm{GHz}$，$d=0.05\\,\\mathrm{m}$，$\\eta=1.0\\times 10^{-4}$，$c=299{,}792{,}458\\,\\mathrm{m/s}$，以及与 $c=1/\\sqrt{\\mu_{0}\\varepsilon_{0}}$ 一致的自由空间参数 $\\mu_{0}$ 和 $\\varepsilon_{0}$，请确定最大允许的均匀采样间距 $\\Delta$（在 $x$ 和 $y$ 方向上相同），以确保在由 $z=d$ 处的容差所隐含的有效截止波数 $K$ 之前，频谱不会发生混叠。请以米为单位表示您的最终答案 $\\Delta$，并将答案四舍五入到四位有效数字。", "solution": "该问题要求计算平面惠更斯面上的采样间距 $\\Delta$，使得在使用二维离散傅里叶变换 (DFT) 和快速傅里叶变换 (FFT) 将场传播到 $z=d$ 时，离散频谱的周期性复制谱不会与在观测平面对场有显著贡献的那部分频谱发生重叠。推导必须从场的基本表示和等效原理开始。\n\n从频域中无源区的时谐麦克斯韦方程组开始，\n$$\n\\nabla\\times \\mathbf{E} = -i\\omega\\mu_{0}\\mathbf{H}, \\qquad \\nabla\\times \\mathbf{H} = i\\omega\\varepsilon_{0}\\mathbf{E},\n$$\n其中 $\\omega=2\\pi f$，自由空间波数 $k=\\omega\\sqrt{\\mu_{0}\\varepsilon_{0}}=\\omega/c=2\\pi f/c$。根据闭合曲面 $S$（此处为 $z=0$ 平面）上的等效原理，等效表面电流\n$$\n\\mathbf{J}_{s}=\\hat{\\mathbf{n}}\\times\\mathbf{H}, \\qquad \\mathbf{M}_{s}=-\\hat{\\mathbf{n}}\\times\\mathbf{E}\n$$\n可以再现 $z>0$ 中的外部场，同时强制 $z<0$ 内的场为零。$z>0$ 中的场可以通过平面波角谱来表示。将 $z=0$ 平面上的切向场（以及因此的等效电流）写成 $(x,y)$ 的函数，其二维傅里叶变换产生频谱系数 $A(k_{x},k_{y})$，这些系数以轴向依赖关系 $\\exp(i k_{z} z)$ 传播到 $z>0$ 区域，其中\n$$\nk_{t} = \\sqrt{k_{x}^{2}+k_{y}^{2}}, \\qquad\nk_{z} =\n\\begin{cases}\n\\sqrt{k^{2}-k_{t}^{2}},  k_{t}\\leq k \\quad \\text{(propagating)},\\\\\ni\\sqrt{k_{t}^{2}-k^{2}},  k_{t}>k \\quad \\text{(evanescent)}.\n\\end{cases}\n$$\n对于 $k_{t}>k$，轴向因子为 $\\exp(i k_{z} z)=\\exp\\!\\big(-\\sqrt{k_{t}^{2}-k^{2}}\\,z\\big)$，产生沿 $z$ 方向的指数衰减。\n\n为了根据 $z=d$ 处的容差 $\\eta$ 设定一个有效横向频谱截止波数 $K$，要求在截止波数处的倏逝分量已衰减至 $\\eta$：\n$$\n\\exp\\!\\big(-\\sqrt{K^{2}-k^{2}}\\,d\\big) = \\eta, \\quad \\text{with } K>k.\n$$\n求解 $K$ 可得\n$$\n\\sqrt{K^{2}-k^{2}} = \\frac{\\ln(1/\\eta)}{d}\n\\quad \\Longrightarrow \\quad\nK = \\sqrt{k^{2} + \\left(\\frac{\\ln(1/\\eta)}{d}\\right)^{2}}.\n$$\n在 $x$ 和 $y$ 方向上以间距 $\\Delta$ 在矩形网格上进行均匀采样，会沿每个频谱轴产生周期为 $2\\pi/\\Delta$ 的连续频谱的周期性复制谱。为避免混叠，我们希望保留的基带频谱必须位于非重叠区域内，即其在 $k_{x}$ 和 $k_{y}$ 方向的范围必须严格位于复制周期的一半之内。一个充分条件是，半径为 $K$ 的圆形支撑域被包含在正方形 $\\{|k_{x}|\\leq \\pi/\\Delta,\\,|k_{y}|\\leq \\pi/\\Delta\\}$ 内，这得出了采样条件\n$$\n\\Delta \\leq \\frac{\\pi}{K}.\n$$\n因此，在截止波数 $K$ 之前不发生混叠的最大允许间距为\n$$\n\\Delta_{\\max} = \\frac{\\pi}{K} = \\frac{\\pi}{\\sqrt{k^{2} + \\left(\\dfrac{\\ln(1/\\eta)}{d}\\right)^{2}}}.\n$$\n\n现在使用给定的参数计算数值。首先，计算在 $f=10\\,\\mathrm{GHz}$ 时的自由空间波数：\n$$\nk = \\frac{2\\pi f}{c} = \\frac{2\\pi \\times 10^{10}\\,\\mathrm{Hz}}{299{,}792{,}458\\,\\mathrm{m/s}} \\approx 209.4395102393\\,\\mathrm{rad/m}.\n$$\n接下来，计算在 $z=d=0.05\\,\\mathrm{m}$ 处，容差为 $\\eta=1.0\\times 10^{-4}$ 时的有效倏逝衰减率参数：\n$$\n\\frac{\\ln(1/\\eta)}{d} = \\frac{\\ln(10^{4})}{0.05\\,\\mathrm{m}} = \\frac{9.210340371976184}{0.05}\\,\\mathrm{m^{-1}} \\approx 184.2068074395\\,\\mathrm{m^{-1}}.\n$$\n然后，\n$$\nK = \\sqrt{k^{2} + \\left(\\frac{\\ln(1/\\eta)}{d}\\right)^{2}}\n\\approx \\sqrt{(209.4395102393)^{2} + (184.2068074395)^{2}}\\,\\mathrm{m^{-1}}\n\\approx 278.922\\,\\mathrm{m^{-1}}.\n$$\n最后，\n$$\n\\Delta_{\\max} = \\frac{\\pi}{K} \\approx \\frac{3.141592653589793}{278.922}\\,\\mathrm{m} \\approx 0.011264\\,\\mathrm{m}.\n$$\n四舍五入到四位有效数字并以米表示，所需的采样间距为\n$$\n\\Delta_{\\max} \\approx 0.01126\\,\\mathrm{m}.\n$$", "answer": "$$\\boxed{0.01126}$$", "id": "3314987"}, {"introduction": "许多现代电磁设备，如超表面和相控阵，都具有周期性结构，其场分布遵循弗洛凯（Floquet）理论。本练习将等效原理的应用扩展到这些周期性系统，您将学习如何处理由布洛赫-弗洛凯（Bloch-Floquet）准周期性描述的场。通过分析周期单元上的等效电流，您将量化离散采样在布里渊区中引起的混叠误差，这是模拟周期性结构时的一个关键考量因素。[@problem_id:3314918]", "problem": "考虑一个放置在 $z=0$ 处的平面惠更斯表面，该表面封闭了一个尺寸为 $L_x \\times L_y$ 的周期性晶胞，其向外单位法向量为 $\\hat{\\mathbf{n}}=\\hat{\\mathbf{z}}$。在计算电磁学中，等效原理将表面外的场替换为等效的电和磁表面电流密度，这些电流密度在外部区域再现原始场。设惠更斯表面上的切向电场为 $\\mathbf{E}_{t}(x,y)$，切向磁场为 $\\mathbf{H}_{t}(x,y)$。等效的电和磁表面电流密度由基本边界关系定义\n$$\\mathbf{J}_{s}(x,y)=\\hat{\\mathbf{n}}\\times \\mathbf{H}_{t}(x,y),\\qquad \\mathbf{M}_{s}(x,y)=-\\hat{\\mathbf{n}}\\times \\mathbf{E}_{t}(x,y).$$\n假设场满足周期性边界条件，其布洛赫-弗洛凯准周期性由横向布洛赫波数 $k_{x0}$ 和 $k_{y0}$ 指定：\n$$\\mathbf{E}_{t}(x+L_x,y)=\\mathbf{E}_{t}(x,y)e^{\\mathrm{i} k_{x0} L_x},\\quad \\mathbf{E}_{t}(x,y+L_y)=\\mathbf{E}_{t}(x,y)e^{\\mathrm{i} k_{y0} L_y},$$\n对于 $\\mathbf{H}_{t}(x,y)$ 也类似。为了方便，可以分解出布洛赫相位，并将场写为\n$$\\mathbf{E}_{t}(x,y)=\\mathbf{E}_{0}\\,F(x,y)\\,e^{\\mathrm{i}(k_{x0}x+k_{y0}y)},\\qquad \\mathbf{H}_{t}(x,y)=\\mathbf{H}_{0}\\,G(x,y)\\,e^{\\mathrm{i}(k_{x0}x+k_{y0}y)},$$\n其中 $\\mathbf{E}_{0}=\\left(E_0\\cos\\psi, E_0\\sin\\psi, 0\\right)$ 和 $\\mathbf{H}_{0}=\\left(H_0\\cos\\phi, H_0\\sin\\phi, 0\\right)$ 是恒定的切向偏振矢量（角度以弧度表示），而 $F(x,y)$ 和 $G(x,y)$ 是在双重弗洛凯级数中展开的 $L_x \\times L_y$ 周期性标量函数\n$$F(x,y)=\\sum_{m\\in\\mathbb{Z}}\\sum_{n\\in\\mathbb{Z}}A_{m,n}\\,e^{\\mathrm{i}2\\pi\\left(\\frac{m x}{L_x}+\\frac{n y}{L_y}\\right)},\\qquad G(x,y)=\\sum_{m\\in\\mathbb{Z}}\\sum_{n\\in\\mathbb{Z}}B_{m,n}\\,e^{\\mathrm{i}2\\pi\\left(\\frac{m x}{L_x}+\\frac{n y}{L_y}\\right)}.$$\n因此，去相位等效电流 $\\tilde{\\mathbf{J}}_{s}(x,y)=\\mathbf{J}_{s}(x,y)e^{-\\mathrm{i}(k_{x0}x+k_{y0}y)}$ 和 $\\tilde{\\mathbf{M}}_{s}(x,y)=\\mathbf{M}_{s}(x,y)e^{-\\mathrm{i}(k_{x0}x+k_{y0}y)}$ 具有由 $(m,n)$ 索引的弗洛凯展开，其系数分别与 $A_{m,n}$ 和 $B_{m,n}$ 成正比。\n\n在实践中，我们在一个 $N_x \\times N_y$ 点的均匀离散网格上对 $\\tilde{\\mathbf{J}}_{s}(x,y)$ 和 $\\tilde{\\mathbf{M}}_{s}(x,y)$ 进行数值采样：\n$$x_p=\\frac{p L_x}{N_x},\\quad y_q=\\frac{q L_y}{N_y},\\quad p=0,\\dots,N_x-1,\\quad q=0,\\dots,N_y-1,$$\n并通过二维离散傅里叶变换 (DFT) 估计模式系数。由采样引起的中心布里渊区由索引集定义\n$$\\mathcal{B}=\\left\\{(m,n): m\\in[-\\lfloor N_x/2\\rfloor,\\ldots,\\lfloor N_x/2\\rfloor-1],\\; n\\in[-\\lfloor N_y/2\\rfloor,\\ldots,\\lfloor N_y/2\\rfloor-1]\\right\\}.$$\n当 $F$ 和 $G$ 的真实弗洛凯内容 $(m,n)$ 位于 $\\mathcal{B}$ 之外时，离散采样会通过模 $N_x$ 和 $N_y$ 的剩余类将这些模式混叠回 $\\mathcal{B}$。定义混叠映射 $\\alpha(m;N_x)=((m+\\lfloor N_x/2\\rfloor)\\bmod N_x)-\\lfloor N_x/2\\rfloor$，对于 $n$ 也类似。\n\n对于一组固定的模式振幅 $\\{A_{m,n}\\}$ 和 $\\{B_{m,n}\\}$，将每个模式的组合能量定义为\n$$\\mathcal{E}_{m,n}=(E_0^2+H_0^2)\\left(|A_{m,n}|^2+|B_{m,n}|^2\\right),$$\n并将 $\\mathcal{B}$ 内的真实能量定义为\n$$\\mathcal{E}_{\\mathrm{true}}=\\sum_{(m,n)\\in \\mathcal{B}} \\mathcal{E}_{m,n},$$\n以及混叠到 $\\mathcal{B}$ 内的能量定义为\n$$\\mathcal{E}_{\\mathrm{alias}}=\\sum_{(m,n)\\notin \\mathcal{B}} \\mathcal{E}_{m,n},$$\n它计算了所有将被折叠到采样的中心布里渊区中的能量。通过混叠分数来量化离散采样下的混叠\n$$\\eta=\\frac{\\mathcal{E}_{\\mathrm{alias}}}{\\mathcal{E}_{\\mathrm{true}}+\\mathcal{E}_{\\mathrm{alias}}},$$\n并约定如果 $\\mathcal{E}_{\\mathrm{true}}=0$ 和 $\\mathcal{E}_{\\mathrm{alias}}=0$ 同时成立，则 $\\eta=0$。\n\n您的任务是编写一个完整的、可运行的程序，对以下每个测试用例：\n- 构建去相位等效电流 $\\tilde{\\mathbf{J}}_{s}(x,y)$ 和 $\\tilde{\\mathbf{M}}_{s}(x,y)$，\n- 执行 DFT 以恢复采样的模式内容（这是为了内部验证映射，但不属于最终的数值输出），以及\n- 使用上述能量定义计算混叠分数 $\\eta$。\n\n所有物理长度 $L_x$ 和 $L_y$ 必须以米为单位处理，布洛赫波数 $k_{x0}$ 和 $k_{y0}$ 以弧度/米为单位，角度 $\\phi$ 和 $\\psi$ 以弧度为单位。最终输出的 $\\eta$ 是无量纲的浮点数。\n\n测试套件：\n- 案例 $1$（正常路径；预期混叠可忽略不计）：\n  - $L_x=0.2\\,\\mathrm{m}$，$L_y=0.2\\,\\mathrm{m}$，\n  - $N_x=32$，$N_y=32$，\n  - $k_{x0}=0.2\\times \\frac{2\\pi}{L_x}$，$k_{y0}=-0.3\\times \\frac{2\\pi}{L_y}$，\n  - $E_0=1.0$，$H_0=1.0$，$\\phi=0.7$（弧度），$\\psi=1.2$（弧度），\n  - 模式振幅（同样应用于 $F$ 和 $G$，即取 $A_{m,n}=B_{m,n}$）：\n    - $(m,n)=(0,0)$，其中 $|A_{0,0}|=1.0$，\n    - $(m,n)=(5,0)$，其中 $|A_{5,0}|=0.6$，\n    - $(m,n)=(-7,2)$，其中 $|A_{-7,2}|=0.4$，\n    - $(m,n)=(3,-6)$，其中 $|A_{3,-6}|=0.5$，\n    - $(m,n)=(9,9)$，其中 $|A_{9,9}|=0.3$。\n- 案例 $2$（中等混叠；部分内容在 $\\mathcal{B}$ 之外）：\n  - $L_x=0.2\\,\\mathrm{m}$，$L_y=0.2\\,\\mathrm{m}$，\n  - $N_x=8$，$N_y=8$，\n  - $k_{x0}=0.4\\times \\frac{2\\pi}{L_x}$，$k_{y0}=0.1\\times \\frac{2\\pi}{L_y}$，\n  - $E_0=2.0$，$H_0=1.5$，$\\phi=0.9$（弧度），$\\psi=0.3$（弧度），\n  - 模式振幅与案例 $1$ 相同（同样应用于 $F$ 和 $G$）。\n- 案例 $3$（边缘情况；所有内容都在 $\\mathcal{B}$ 之外）：\n  - $L_x=0.2\\,\\mathrm{m}$，$L_y=0.2\\,\\mathrm{m}$，\n  - $N_x=6$，$N_y=6$，\n  - $k_{x0}=0.95\\times \\frac{\\pi}{L_x}$，$k_{y0}=0.95\\times \\frac{\\pi}{L_y}$，\n  - $E_0=1.0$，$H_0=1.0$，$\\phi=0.5$（弧度），$\\psi=1.1$（弧度），\n  - 模式振幅（同样应用于 $F$ 和 $G$）：\n    - $(m,n)=(5,5)$，其中 $|A_{5,5}|=1.0$，\n    - $(m,n)=(-4,4)$，其中 $|A_{-4,4}|=0.7$。\n\n实现细节：\n- 使用采样网格 $(x_p,y_q)$ 并根据指定的模式振幅计算 $F(x_p,y_q)$ 和 $G(x_p,y_q)$，然后生成 $\\mathbf{E}_{t}(x_p,y_q)$ 和 $\\mathbf{H}_{t}(x_p,y_q)$ 以及去相位电流 $\\tilde{\\mathbf{J}}_{s}(x_p,y_q)$ 和 $\\tilde{\\mathbf{M}}_{s}(x_p,y_q)$。\n- 计算每个去相位电流分量的二维快速傅里叶变换 (FFT) 以验证模式索引和混叠映射（FFT 的数值无需输出；这是一个验证步骤）。\n- 使用 $\\mathcal{E}_{\\mathrm{true}}$ 和 $\\mathcal{E}_{\\mathrm{alias}}$ 的定义计算 $\\eta$（注意，在每个案例中 $A_{m,n}$ 和 $B_{m,n}$ 都是相同的，因此组合能量会相应简化）。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如 $[r_1,r_2,r_3]$，其中 $r_i$ 分别是案例 $1$、$2$ 和 $3$ 的 $\\eta$ 计算值。\n\n所有输出的 $\\eta$ 都必须是浮点数。角度以弧度为单位。如果在采样的中心布里渊区内没有能量，也没有能量混叠进来，则该案例的输出为 $0.0$。", "solution": "推导始于 Maxwell 方程组和电磁边界条件。在一个具有向外单位法向量 $\\hat{\\mathbf{n}}$ 的封闭表面上，等效原理规定了再现表面外场所需的等效电和磁表面电流：$\\mathbf{J}_{s}=\\hat{\\mathbf{n}}\\times \\mathbf{H}$ 和 $\\mathbf{M}_{s}=-\\hat{\\mathbf{n}}\\times \\mathbf{E}$。对于一个位于 $z=0$ 的平面惠更斯表面，法向量为 $\\hat{\\mathbf{n}}=\\hat{\\mathbf{z}}$，因此明确地\n$$\\mathbf{J}_{s}(x,y)=\\hat{\\mathbf{z}}\\times \\mathbf{H}_{t}(x,y)=\\left(-H_{y}(x,y),\\,H_{x}(x,y),\\,0\\right),$$\n$$\\mathbf{M}_{s}(x,y)=-\\hat{\\mathbf{z}}\\times \\mathbf{E}_{t}(x,y)=\\left(E_{y}(x,y),\\,-E_{x}(x,y),\\,0\\right).$$\n在具有布洛赫-弗洛凯准周期性的周期性边界条件下，切向场可以分解为一个布洛赫相位和一个周期性部分。引入恒定的切向偏振矢量 $\\mathbf{E}_{0}=\\left(E_0\\cos\\psi,E_0\\sin\\psi,0\\right)$ 和 $\\mathbf{H}_{0}=\\left(H_0\\cos\\phi,H_0\\sin\\phi,0\\right)$（角度 $\\psi$ 和 $\\phi$ 以弧度为单位），以及在倒易晶格上允许傅里叶-弗洛凯展开的周期性标量函数 $F(x,y)$ 和 $G(x,y)$：\n$$F(x,y)=\\sum_{m\\in\\mathbb{Z}}\\sum_{n\\in\\mathbb{Z}}A_{m,n}e^{\\mathrm{i}2\\pi\\left(\\frac{m x}{L_x}+\\frac{n y}{L_y}\\right)},\\qquad G(x,y)=\\sum_{m\\in\\mathbb{Z}}\\sum_{n\\in\\mathbb{Z}}B_{m,n}e^{\\mathrm{i}2\\pi\\left(\\frac{m x}{L_x}+\\frac{n y}{L_y}\\right)}.$$\n使用布洛赫波数 $k_{x0}$ 和 $k_{y0}$，切向场为\n$$\\mathbf{E}_{t}(x,y)=\\mathbf{E}_{0}\\,F(x,y)\\,e^{\\mathrm{i}(k_{x0}x+k_{y0}y)},\\qquad \\mathbf{H}_{t}(x,y)=\\mathbf{H}_{0}\\,G(x,y)\\,e^{\\mathrm{i}(k_{x0}x+k_{y0}y)}.$$\n引入去相位电流 $\\tilde{\\mathbf{J}}_{s}(x,y)=\\mathbf{J}_{s}(x,y)e^{-\\mathrm{i}(k_{x0}x+k_{y0}y)}$ 和 $\\tilde{\\mathbf{M}}_{s}(x,y)=\\mathbf{M}_{s}(x,y)e^{-\\mathrm{i}(k_{x0}x+k_{y0}y)}$。代入场的表示并利用线性关系可得\n$$\\tilde{\\mathbf{J}}_{s}(x,y)=\\hat{\\mathbf{z}}\\times \\left(\\mathbf{H}_{0}\\,G(x,y)\\right)=\\left(-H_{0}\\sin\\phi,\\,H_{0}\\cos\\phi,\\,0\\right)G(x,y),$$\n$$\\tilde{\\mathbf{M}}_{s}(x,y)=-\\hat{\\mathbf{z}}\\times \\left(\\mathbf{E}_{0}\\,F(x,y)\\right)=\\left(E_{0}\\sin\\psi,\\,-E_{0}\\cos\\psi,\\,0\\right)F(x,y).$$\n因此，去相位等效电流的弗洛凯内容与 $F$ 和 $G$ 的完全相同，其矢量值系数与 $A_{m,n}$ 和 $B_{m,n}$ 成正比。对于每个模式 $(m,n)$，矢量值系数的组合平方大小与 $(E_0^2+H_0^2)\\left(|A_{m,n}|^2+|B_{m,n}|^2\\right)$ 成正比，因为 $\\left\\| \\left(-H_{0}\\sin\\phi,H_{0}\\cos\\phi,0\\right)\\right\\|^2=H_0^2$ 且 $\\left\\| \\left(E_{0}\\sin\\psi,-E_{0}\\cos\\psi,0\\right)\\right\\|^2=E_0^2$。\n\n为了数值估计模式系数，在 $N_x \\times N_y$ 网格点 $x_p=pL_x/N_x, y_q=qL_y/N_y$（其中 $p=0,\\dots,N_x-1, q=0,\\dots,N_y-1$）上对去相位电流进行采样。二维离散傅里叶变换 (DFT)，实现为快速傅里叶变换 (FFT)，将采样映射到由整数 $k_x\\in\\{0,\\dots,N_x-1\\}$ 和 $k_y\\in\\{0,\\dots,N_y-1\\}$ 索引的离散谱箱。为了将频谱中心置于主布里渊区，应用标准的频率移位以获得 $\\left[-\\lfloor N_x/2\\rfloor,\\dots,\\lfloor N_x/2\\rfloor-1\\right]$ 中的索引，对于 $n$ 也类似。因此，由采样引起的中心布里渊区 $\\mathcal{B}$ 为\n$$\\mathcal{B}=\\left\\{(m,n): m\\in[-\\lfloor N_x/2\\rfloor,\\ldots,\\lfloor N_x/2\\rfloor-1],\\; n\\in[-\\lfloor N_y/2\\rfloor,\\ldots,\\lfloor N_y/2\\rfloor-1]\\right\\}.$$\n任何在 $\\mathcal{B}$ 之外的真实弗洛凯索引 $(m,n)$ 都会通过模 $N_x$ 和 $N_y$ 的剩余类混叠到 $\\mathcal{B}$ 中。中心化混叠映射为\n$$\\alpha(m;N_x)=\\left((m+\\lfloor N_x/2\\rfloor)\\bmod N_x\\right)-\\lfloor N_x/2\\rfloor,\\qquad \\alpha(n;N_y)=\\left((n+\\lfloor N_y/2\\rfloor)\\bmod N_y\\right)-\\lfloor N_y/2\\rfloor.$$\n因此，如果 $(m,n)\\notin \\mathcal{B}$，则采样的频谱在中心化离散谱中的谱箱 $(\\alpha(m;N_x),\\alpha(n;N_y))$ 处包含该能量。由于去相位等效电流将矢量方向和标量周期函数分解开来，每个模式的组合能量为\n$$\\mathcal{E}_{m,n}=(E_0^2+H_0^2)\\left(|A_{m,n}|^2+|B_{m,n}|^2\\right),$$\n这与偏振角 $\\phi$ 和 $\\psi$ 无关。采样的中心布里渊区内的真实能量为\n$$\\mathcal{E}_{\\mathrm{true}}=\\sum_{(m,n)\\in \\mathcal{B}}\\mathcal{E}_{m,n},$$\n而从外部折叠进 $\\mathcal{B}$ 的混叠能量为\n$$\\mathcal{E}_{\\mathrm{alias}}=\\sum_{(m,n)\\notin \\mathcal{B}}\\mathcal{E}_{m,n}.$$\n一个稳健的混叠标量量化指标是混叠分数\n$$\\eta=\\frac{\\mathcal{E}_{\\mathrm{alias}}}{\\mathcal{E}_{\\mathrm{true}}+\\mathcal{E}_{\\mathrm{alias}}},$$\n其值在 $[0,1]$ 范围内，当所有模式能量都在 $\\mathcal{B}$ 内时等于 $0$，当所有模式能量都在 $\\mathcal{B}$ 外并完全混叠时等于 $1$。\n\n算法步骤：\n- 对于每个测试用例，根据给定的振幅 $A_{m,n}$ 和 $B_{m,n}$ 以及给定的 $E_0$ 和 $H_0$，为每个指定的 $(m,n)$ 对计算模式能量 $\\mathcal{E}_{m,n}$，并按规定假设 $A_{m,n}=B_{m,n}$。在 $(m,n)\\in\\mathcal{B}$ 上累加 $\\mathcal{E}_{\\mathrm{true}}$，在 $(m,n)\\notin\\mathcal{B}$ 上累加 $\\mathcal{E}_{\\mathrm{alias}}$。\n- 计算混叠分数 $\\eta=\\mathcal{E}_{\\mathrm{alias}}/(\\mathcal{E}_{\\mathrm{true}}+\\mathcal{E}_{\\mathrm{alias}})$，特殊情况是如果 $\\mathcal{E}_{\\mathrm{true}}=0$ 和 $\\mathcal{E}_{\\mathrm{alias}}=0$ 同时成立，则 $\\eta=0$。\n- 作为一个内部验证步骤，从模式和构建 $F(x_p,y_q)$ 和 $G(x_p,y_q)$，形成 $\\mathbf{E}_{t}(x_p,y_q)$ 和 $\\mathbf{H}_{t}(x_p,y_q)$，然后得到去相位电流 $\\tilde{\\mathbf{J}}_{s}(x_p,y_q)$ 和 $\\tilde{\\mathbf{M}}_{s}(x_p,y_q)$。应用二维 FFT 和频率移位，观察离散谱能量是否集中在对应于 $(\\alpha(m;N_x),\\alpha(n;N_y))$ 的谱箱中，从而确认混叠映射。此验证不影响计算出的 $\\eta$，也不属于程序的打印输出部分。\n\n对于提供的测试套件：\n- 案例 $1$ 中 $(N_x,N_y)=(32,32)$，因此 $\\mathcal{B}$ 包含所有列出的 $(m,n)$，使得 $\\mathcal{E}_{\\mathrm{alias}}=0$ 且 $\\eta=0$。\n- 案例 $2$ 中 $(N_x,N_y)=(8,8)$，因此有几个 $(m,n)$ 位于 $\\mathcal{B}$ 之外并对 $\\mathcal{E}_{\\mathrm{alias}}$ 有贡献，产生 $0 < \\eta < 1$。\n- 案例 $3$ 中 $(N_x,N_y)=(6,6)$，所有列出的 $(m,n)$ 都位于 $\\mathcal{B}$ 之外；因此根据给定的定义 $\\mathcal{E}_{\\mathrm{true}}=0$ 且 $\\eta=1$（除非退化的振幅为零）。\n\n最终程序实现了这些步骤，为每个案例计算 $\\eta$，并以精确要求的格式 $[\\eta_1,\\eta_2,\\eta_3]$ 打印单行结果，其中每个 $\\eta_i$ 都是一个浮点数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef center_index(k: int, N: int) -> int:\n    \"\"\"Map integer k to centered index in [-N//2, ..., N//2-1].\"\"\"\n    return ((k + (N // 2)) % N) - (N // 2)\n\ndef in_central_zone(m: int, N: int) -> bool:\n    \"\"\"Check if integer m lies in the central Brillouin zone for size N.\"\"\"\n    return (-N // 2) <= m and m <= (N // 2 - 1)\n\ndef build_periodic_function(Lx, Ly, Nx, Ny, modes):\n    \"\"\"\n    Build periodic function F(x,y)=sum A_mn exp(i 2pi (m x/Lx + n y/Ly)),\n    sampled on the Nx-by-Ny grid. 'modes' is list of (m, n, amplitude).\n    \"\"\"\n    x = np.arange(Nx) * (Lx / Nx)\n    y = np.arange(Ny) * (Ly / Ny)\n    X, Y = np.meshgrid(x, y, indexing='xy')\n    F = np.zeros((Ny, Nx), dtype=np.complex128)\n    for m, n, amp in modes:\n        phase = 2.0 * np.pi * (m * X / Lx + n * Y / Ly)\n        F += amp * np.exp(1j * phase)\n    return F, X, Y\n\ndef compute_dephased_currents(Lx, Ly, Nx, Ny, kx0, ky0, E0, H0, phi, psi, modes):\n    \"\"\"\n    Compute dephased equivalent currents:\n    J_tilde = n x H_t * exp(-i(kx0 x + ky0 y)) and\n    M_tilde = - n x E_t * exp(-i(kx0 x + ky0 y)).\n    Assume F = G with given modes.\n    \"\"\"\n    F, X, Y = build_periodic_function(Lx, Ly, Nx, Ny, modes)\n    # Bloch phase\n    bloch = np.exp(1j * (kx0 * X + ky0 * Y))\n    # Tangential fields\n    Ex = E0 * np.cos(psi) * F * bloch\n    Ey = E0 * np.sin(psi) * F * bloch\n    Hx = H0 * np.cos(phi) * F * bloch\n    Hy = H0 * np.sin(phi) * F * bloch\n    # Equivalent currents at z=0 with normal z-hat\n    Jx = -Hy\n    Jy = Hx\n    Mx = Ey\n    My = -Ex\n    # Dephase\n    dephase = np.exp(-1j * (kx0 * X + ky0 * Y))\n    Jx_t = Jx * dephase\n    Jy_t = Jy * dephase\n    Mx_t = Mx * dephase\n    My_t = My * dephase\n    return Jx_t, Jy_t, Mx_t, My_t\n\ndef fft_verify(Jx_t, Jy_t, Mx_t, My_t):\n    \"\"\"\n    Perform 2D FFT and shift to verify modal positions.\n    Returns the combined spectral energy array (not used in final result).\n    \"\"\"\n    # 2D FFTs\n    JxF = np.fft.fftshift(np.fft.fft2(Jx_t))\n    JyF = np.fft.fftshift(np.fft.fft2(Jy_t))\n    MxF = np.fft.fftshift(np.fft.fft2(Mx_t))\n    MyF = np.fft.fftshift(np.fft.fft2(My_t))\n    # Combined energy across components\n    energy = (np.abs(JxF)**2 + np.abs(JyF)**2 + np.abs(MxF)**2 + np.abs(MyF)**2)\n    return energy\n\ndef alias_fraction(Lx, Ly, Nx, Ny, kx0, ky0, E0, H0, phi, psi, modes):\n    \"\"\"\n    Compute aliasing fraction eta = E_alias / (E_true + E_alias).\n    We assume A_mn = B_mn = amplitude provided in modes.\n    \"\"\"\n    # Combined energy per mode factor\n    factor = (E0**2 + H0**2) * 2.0  # since |A|^2 + |B|^2 with A=B => 2|A|^2\n    E_true = 0.0\n    E_alias = 0.0\n    for m, n, amp in modes:\n        Emn = factor * (np.abs(amp)**2)\n        in_m = in_central_zone(m, Nx)\n        in_n = in_central_zone(n, Ny)\n        if in_m and in_n:\n            E_true += Emn\n        else:\n            # This mode will alias into the central zone\n            E_alias += Emn\n    denom = E_true + E_alias\n    if denom == 0.0:\n        eta = 0.0\n    else:\n        eta = E_alias / denom\n\n    # Optional internal verification: build and FFT dephased currents\n    # (Not used in final printed output.)\n    Jx_t, Jy_t, Mx_t, My_t = compute_dephased_currents(Lx, Ly, Nx, Ny, kx0, ky0, E0, H0, phi, psi, modes)\n    _ = fft_verify(Jx_t, Jy_t, Mx_t, My_t)\n    return eta\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (Lx, Ly, Nx, Ny, kx0, ky0, E0, H0, phi, psi, modes)\n    case1_modes = [\n        (0, 0, 1.0),\n        (5, 0, 0.6),\n        (-7, 2, 0.4),\n        (3, -6, 0.5),\n        (9, 9, 0.3),\n    ]\n    case2_modes = case1_modes.copy()\n    case3_modes = [\n        (5, 5, 1.0),\n        (-4, 4, 0.7),\n    ]\n\n    Lx = 0.2\n    Ly = 0.2\n\n    case1 = (\n        Lx, Ly, 32, 32,\n        0.2 * (2.0 * np.pi / Lx), -0.3 * (2.0 * np.pi / Ly),\n        1.0, 1.0, 0.7, 1.2,\n        case1_modes\n    )\n    case2 = (\n        Lx, Ly, 8, 8,\n        0.4 * (2.0 * np.pi / Lx), 0.1 * (2.0 * np.pi / Ly),\n        2.0, 1.5, 0.9, 0.3,\n        case2_modes\n    )\n    case3 = (\n        Lx, Ly, 6, 6,\n        0.95 * (np.pi / Lx), 0.95 * (np.pi / Ly),\n        1.0, 1.0, 0.5, 1.1,\n        case3_modes\n    )\n\n    test_cases = [case1, case2, case3]\n\n    results = []\n    for (Lx, Ly, Nx, Ny, kx0, ky0, E0, H0, phi, psi, modes) in test_cases:\n        eta = alias_fraction(Lx, Ly, Nx, Ny, kx0, ky0, E0, H0, phi, psi, modes)\n        # Ensure a standard float representation\n        results.append(float(eta))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3314918"}]}