{"hands_on_practices": [{"introduction": "第一个实践将深入探讨辐射条件的物理核心。我们将探索Sommerfeld和Silver-Müller条件中符号的决定性作用，展示正确的符号如何确保能量向外辐射，而错误的符号则导致非物理的能量流入。通过结合理论分析和实际的编程练习 [@problem_id:3347707]，您将构建一个诊断工具来验证计算边界上的能量流方向。", "problem": "考虑在均匀、各向同性、无源的外部区域中的时谐电磁场，其复相量约定为 $e^{- i \\omega t}$，介电常数为 $\\epsilon$，磁导率为 $\\mu$。令 $Z = \\sqrt{\\mu / \\epsilon}$ 表示本征阻抗，$k = \\omega \\sqrt{\\mu \\epsilon}$ 表示波数，两者均为严格正实数。坡印廷矢量由时间平均表达式 $\\mathbf{S} = \\tfrac{1}{2} \\operatorname{Re}\\left( \\mathbf{E} \\times \\mathbf{H}^{\\ast} \\right)$ 给出，其中 $\\mathbf{E}$ 和 $\\mathbf{H}$ 是电场和磁场相量，${}^{\\ast}$ 表示复共轭。\n\n在计算电磁学中，通常通过施加辐射边界条件来截断无界的外部域。对于齐次亥姆霍兹方程的一个解 $u$，标量Sommerfeld辐射条件是渐近条件 $\\partial_r u - i k u \\to 0$（当 $r \\to \\infty$ 时），其中 $r$ 是径向坐标。相反，如果在截断边界上施加符号相反的条件 $\\partial_r u + i k u = 0$，这将选择入射球面波而不是出射波。其矢量模拟形式，即Silver-Müller辐射条件，关联了边界附近的切向场：对于一个出射的局部平面波，$\\hat{\\mathbf{n}} \\times \\mathbf{H} + \\frac{1}{Z} \\mathbf{E} \\to \\mathbf{0}$，其中 $\\hat{\\mathbf{n}}$ 是向外的单位法向量。入射波则满足 $\\hat{\\mathbf{n}} \\times \\mathbf{H} - \\frac{1}{Z} \\mathbf{E} \\to \\mathbf{0}$。\n\n你的任务是：\n\n1) 从复相量的麦克斯韦方程组出发，\n$$\n\\nabla \\times \\mathbf{E} = i \\omega \\mu \\mathbf{H}, \\qquad \\nabla \\times \\mathbf{H} = - i \\omega \\epsilon \\mathbf{E}, \\qquad \\nabla \\cdot \\mathbf{E} = 0, \\qquad \\nabla \\cdot \\mathbf{H} = 0,\n$$\n以及无损介质中的平面波关系，论证Sommerfeld条件中的符号如何决定截断边界附近的局部平面波是出射波还是入射波。然后证明，符号错误的Sommerfeld条件 $\\partial_r u + i k u = 0$ 意味着入射波，并导致通过边界的非物理净能量流入，即在截断边界 $\\Gamma$ 上 $\\int_{\\Gamma} \\mathbf{S} \\cdot \\hat{\\mathbf{n}} \\, ds \\le 0$。\n\n2) 设计一个离散验证程序。给定一个半径为 $R$（单位：米）的圆形截断，该截断由边界上的 $N$ 个等距点 $\\theta_j$ 离散化，并给定一个复标量振幅 $u(\\theta)$，表示沿边界的切向电场大小，该程序需计算穿过边界的离散坡印廷通量。使用Silver-Müller关系从 $u$ 重建切向磁场，然后将 $\\mathbf{S} \\cdot \\hat{\\mathbf{n}}$ 沿边界的积分进行离散化。具体来说，设\n$$\n\\mathbf{E}(\\theta_j) = u(\\theta_j) \\, \\hat{\\mathbf{t}}(\\theta_j), \\qquad \\hat{\\mathbf{t}}(\\theta) = \\big( -\\sin \\theta, \\cos \\theta, 0 \\big), \\qquad \\hat{\\mathbf{n}}(\\theta) = \\big( \\cos \\theta, \\sin \\theta, 0 \\big),\n$$\n对于出射波，使用 $\\hat{\\mathbf{n}} \\times \\mathbf{H} + \\frac{1}{Z} \\mathbf{E} = \\mathbf{0}$ 来确定 $\\mathbf{H}(\\theta_j)$；而对于入射波，使用 $\\hat{\\mathbf{n}} \\times \\mathbf{H} - \\frac{1}{Z} \\mathbf{E} = \\mathbf{0}$。离散通量定义为\n$$\n\\Phi_{\\mathrm{em}} = \\sum_{j=1}^{N} \\left[ \\tfrac{1}{2} \\operatorname{Re}\\left( \\mathbf{E}(\\theta_j) \\times \\mathbf{H}(\\theta_j)^{\\ast} \\right) \\cdot \\hat{\\mathbf{n}}(\\theta_j) \\right] \\Delta s, \\qquad \\Delta s = \\frac{2 \\pi R}{N}.\n$$\n此外，定义一个基于亥姆霍兹标量 $u$ 和由Sommerfeld边界算子所隐含的法向导数 $\\partial_r u$ 的标量代理通量：\n$$\n\\Phi_{\\mathrm{sc}} = \\sum_{j=1}^{N} \\left[ \\frac{1}{k} \\operatorname{Im}\\left( u(\\theta_j)^{\\ast} \\, \\partial_r u(\\theta_j) \\right) \\right] \\Delta s,\n$$\n其中，在 $e^{- i \\omega t}$ 约定下，当模拟边界附近的局部平面波时，出射条件为 $\\partial_r u = i k u$，入射条件为 $\\partial_r u = - i k u$。\n\n3) 将该验证程序实现为一个程序。给定一个参数集的测试套件，该程序返回一个归一化通量，用于诊断出射与入射的能量传输。用正边界权重\n$$\nW = \\sum_{j=1}^{N} \\left[ |u(\\theta_j)|^2 \\right] \\Delta s,\n$$\n对通量进行归一化，并定义归一化电磁通量 $\\varphi_{\\mathrm{em}} = \\Phi_{\\mathrm{em}} / \\left( \\tfrac{1}{2 Z} W \\right)$ 和归一化标量通量 $\\varphi_{\\mathrm{sc}} = \\Phi_{\\mathrm{sc}} / W$。在无损介质和局部平面波假设下，两种归一化都必须与辐射条件所隐含的符号相匹配：出射为 $+1$，入射为 $-1$，而对于恒为零的场则为 $0$。\n\n你的程序必须为每个测试用例生成边界上的 $u(\\theta)$，并计算下面指定的输出。你必须对角度使用弧度，对 $R$ 使用米（m），对 $k$ 使用弧度/米（rad/m）。最终答案必须是无量纲的浮点数或布尔值，与指定完全一致。\n\n测试套件：\n- 用例 A（正常路径，出射）：$k = 8$ rad/m, $R = 1$ m, $N = 512$, 阻抗 $Z = 376.730313669$ (ohm), Sommerfeld符号为正确的出射符号，边界场 $u(\\theta) = \\left( 1 + 0.5 \\cos(3 \\theta) \\right) e^{i (2 \\theta)} e^{i k R}$。\n- 用例 B（错误符号，入射）：参数与用例A相同，但强制使用符号错误的Sommerfeld条件；使用相同的 $u(\\theta)$。\n- 用例 C（边界情况，零场）：$k = 8$ rad/m, $R = 1$ m, $N = 512$, $Z = 376.730313669$, 且 $u(\\theta) \\equiv 0$；强制使用错误符号。\n- 用例 D（一致性检查）：$k = 12$ rad/m, $R = 0.7$ m, $N = 1024$, $Z = 376.730313669$, 符号错误的Sommerfeld条件；$u(\\theta) = \\left( 1 + 0.3 \\cos(5 \\theta) + 0.2 \\sin(4 \\theta) \\right) e^{i (4 \\theta)} e^{- i k R}$。\n\n所需输出：\n- 对于用例 A：输出归一化电磁通量 $\\varphi_{\\mathrm{em}}$，作为一个浮点数。\n- 对于用例 B：输出归一化电磁通量 $\\varphi_{\\mathrm{em}}$，作为一个浮点数。\n- 对于用例 C：输出归一化电磁通量 $\\varphi_{\\mathrm{em}}$，作为一个浮点数（期望恰好为 $0.0$）。\n- 对于用例 D：输出一个布尔值，指示是否 $|\\varphi_{\\mathrm{em}} - \\varphi_{\\mathrm{sc}}| \\le 10^{-12}$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的结果列表（例如，\"[resultA,resultB,resultC,resultD]\"）。", "solution": "该问题要求一个两部分的回应：一个关于电磁辐射条件的理论推导，以及一个数值验证程序的实现。\n\n### 第1部分：辐射条件和能量通量的理论分析\n\n本节在时谐约定为 $e^{-i\\omega t}$ 的背景下，验证了时谐电磁学中Sommerfeld和Silver-Müller辐射条件的物理解释。\n\n我们从均匀、各向同性、无损介质中复相量 $\\mathbf{E}$ 和 $\\mathbf{H}$ 的无源麦克斯韦方程组开始：\n$$\n\\nabla \\times \\mathbf{E} = i \\omega \\mu \\mathbf{H}\n$$\n$$\n\\nabla \\times \\mathbf{H} = - i \\omega \\epsilon \\mathbf{E}\n$$\n参数 $k = \\omega \\sqrt{\\mu\\epsilon}$ 和 $Z = \\sqrt{\\mu/\\epsilon}$ 分别是波数和本征阻抗。\n\n考虑一个沿单位矢量 $\\hat{\\mathbf{k}}$ 方向传播的局部平面波。场可以写成 $\\mathbf{E}(\\mathbf{r}) = \\mathbf{E}_0 e^{i \\mathbf{k} \\cdot \\mathbf{r}}$ 和 $\\mathbf{H}(\\mathbf{r}) = \\mathbf{H}_0 e^{i \\mathbf{k} \\cdot \\mathbf{r}}$，其中 $\\mathbf{k} = k \\hat{\\mathbf{k}}$。将这些代入第一个麦克斯韦方程（$\\nabla \\times \\mathbf{E}$）得到：\n$$\n\\nabla \\times (\\mathbf{E}_0 e^{i k \\hat{\\mathbf{k}} \\cdot \\mathbf{r}}) = i k (\\hat{\\mathbf{k}} \\times \\mathbf{E}_0) e^{i k \\hat{\\mathbf{k}} \\cdot \\mathbf{r}} = i k (\\hat{\\mathbf{k}} \\times \\mathbf{E})\n$$\n将其与 $i \\omega \\mu \\mathbf{H}$ 等同，我们得到：\n$$\ni k (\\hat{\\mathbf{k}} \\times \\mathbf{E}) = i \\omega \\mu \\mathbf{H} \\implies \\mathbf{H} = \\frac{k}{\\omega \\mu} (\\hat{\\mathbf{k}} \\times \\mathbf{E})\n$$\n使用 $k = \\omega \\sqrt{\\mu\\epsilon}$ 和 $Z = \\sqrt{\\mu/\\epsilon}$，我们发现 $\\frac{k}{\\omega\\mu} = \\frac{\\omega\\sqrt{\\mu\\epsilon}}{\\omega\\mu} = \\sqrt{\\frac{\\epsilon}{\\mu}} = \\frac{1}{Z}$。因此，对于平面波，场由以下关系式关联：\n$$\n\\mathbf{H} = \\frac{1}{Z} (\\hat{\\mathbf{k}} \\times \\mathbf{E})\n$$\n这个关系确立了 $\\mathbf{E}$、$\\mathbf{H}$ 和 $\\hat{\\mathbf{k}}$ 的正交性。\n\n在远离源的地方，辐射的球面波会变得局部平坦。\n对于一个**出射波**，局部传播方向是径向向外，所以 $\\hat{\\mathbf{k}} = \\hat{\\mathbf{r}}$，其中 $\\hat{\\mathbf{r}}$ 是径向单位矢量。标量场分量的渐近形式是 $u(r) \\sim \\frac{e^{ikr}}{r}$。其径向导数为 $\\partial_r u = (ik - 1/r) u$。当 $r \\to \\infty$ 时，这导致了Sommerfeld辐射条件：$\\partial_r u - iku \\to 0$。对于矢量场，当 $\\hat{\\mathbf{k}} = \\hat{\\mathbf{r}}$ 且向外法向量 $\\hat{\\mathbf{n}} = \\hat{\\mathbf{r}}$ 时，平面波关系变为 $\\mathbf{H} = \\frac{1}{Z} (\\hat{\\mathbf{n}} \\times \\mathbf{E})$。与 $\\hat{\\mathbf{n}}$ 取叉积并使用横向条件 $\\hat{\\mathbf{n}} \\cdot \\mathbf{E} = 0$：\n$$\n\\hat{\\mathbf{n}} \\times \\mathbf{H} = \\frac{1}{Z} \\hat{\\mathbf{n}} \\times (\\hat{\\mathbf{n}} \\times \\mathbf{E}) = \\frac{1}{Z} \\left( \\hat{\\mathbf{n}}(\\hat{\\mathbf{n}} \\cdot \\mathbf{E}) - \\mathbf{E}(\\hat{\\mathbf{n}} \\cdot \\hat{\\mathbf{n}}) \\right) = -\\frac{1}{Z}\\mathbf{E}\n$$\n这正是出射波的Silver-Müller辐射条件：$\\hat{\\mathbf{n}} \\times \\mathbf{H} + \\frac{1}{Z}\\mathbf{E} \\to \\mathbf{0}$。\n\n对于一个**入射波**，传播方向是径向向内，$\\hat{\\mathbf{k}} = -\\hat{\\mathbf{r}}$。渐近标量场为 $u(r) \\sim \\frac{e^{-ikr}}{r}$。其导数为 $\\partial_r u = (-ik - 1/r) u$，当 $r \\to \\infty$ 时，这导致了“符号错误”的Sommerfeld条件：$\\partial_r u + iku \\to 0$。相应的场关系是 $\\mathbf{H} = \\frac{1}{Z} (-\\hat{\\mathbf{n}} \\times \\mathbf{E})$。这产生了入射波的Silver-Müller条件：$\\hat{\\mathbf{n}} \\times \\mathbf{H} - \\frac{1}{Z}\\mathbf{E} \\to \\mathbf{0}$。\n\n现在我们分析能量通量。时间平均的坡印廷矢量是 $\\mathbf{S} = \\frac{1}{2} \\operatorname{Re}(\\mathbf{E} \\times \\mathbf{H}^*)$。通过一个具有向外法向量 $\\hat{\\mathbf{n}}$ 的封闭曲面 $\\Gamma$ 的净功率通量是 $\\int_{\\Gamma} \\mathbf{S} \\cdot \\hat{\\mathbf{n}} \\, ds$。\n对于**出射波**，$\\mathbf{H} = \\frac{1}{Z} (\\hat{\\mathbf{n}} \\times \\mathbf{E})$，所以 $\\mathbf{H}^* = \\frac{1}{Z} (\\hat{\\mathbf{n}} \\times \\mathbf{E}^*)$，因为 $Z$ 是实数。\n$$\n\\mathbf{S} = \\frac{1}{2Z} \\operatorname{Re}\\left( \\mathbf{E} \\times (\\hat{\\mathbf{n}} \\times \\mathbf{E}^*) \\right) = \\frac{1}{2Z} \\operatorname{Re}\\left( \\hat{\\mathbf{n}}(\\mathbf{E} \\cdot \\mathbf{E}^*) - \\mathbf{E}^*(\\mathbf{E} \\cdot \\hat{\\mathbf{n}}) \\right)\n$$\n对于横向波，$\\mathbf{E} \\cdot \\hat{\\mathbf{n}} = 0$，所以这简化为：\n$$\n\\mathbf{S} = \\frac{1}{2Z} \\operatorname{Re}\\left( \\hat{\\mathbf{n}} |\\mathbf{E}|^2 \\right) = \\frac{|\\mathbf{E}|^2}{2Z} \\hat{\\mathbf{n}}\n$$\n通量密度为 $\\mathbf{S} \\cdot \\hat{\\mathbf{n}} = \\frac{|\\mathbf{E}|^2}{2Z} \\ge 0$。这表示能量向外流动，对于包含在 $\\Gamma$ 内的源来说，这是物理上正确的。\n\n对于由“符号错误”的Sommerfeld条件选择的**入射波**，$\\mathbf{H} = -\\frac{1}{Z} (\\hat{\\mathbf{n}} \\times \\mathbf{E})$。类似的推导得出：\n$$\n\\mathbf{S} = -\\frac{|\\mathbf{E}|^2}{2Z} \\hat{\\mathbf{n}}\n$$\n通量密度为 $\\mathbf{S} \\cdot \\hat{\\mathbf{n}} = -\\frac{|\\mathbf{E}|^2}{2Z} \\le 0$。通过边界的总通量 $\\int_{\\Gamma} \\mathbf{S} \\cdot \\hat{\\mathbf{n}} \\, ds$ 是负的（如果 $\\mathbf{E} = \\mathbf{0}$ 则为零），这表示从无穷远处进入无源区域的非物理净能量流入。\n\n### 第2部分：离散验证程序的设计\n\n该程序在半径为 $R$、有 $N$ 个点的圆形边界上离散化解析公式。\n边界由 $\\theta \\in [0, 2\\pi)$ 参数化。离散角度为 $\\theta_j = j \\frac{2\\pi}{N}$，其中 $j=0, \\dots, N-1$。弧长元素为 $\\Delta s = \\frac{2\\pi R}{N}$。\n\n**电磁通量（$\\Phi_{\\mathrm{em}}$）：**\n通量是 $\\int \\mathbf{S} \\cdot \\hat{\\mathbf{n}} \\, ds$ 的离散版本。在每个点 $\\theta_j$ 的被积函数是 $\\mathbf{S}_j \\cdot \\hat{\\mathbf{n}}_j$。从第1部分我们发现 $\\mathbf{S} \\cdot \\hat{\\mathbf{n}} = \\pm \\frac{|\\mathbf{E}|^2}{2Z}$。问题定义了 $\\mathbf{E}(\\theta_j) = u(\\theta_j) \\hat{\\mathbf{t}}(\\theta_j)$，所以 $|\\mathbf{E}(\\theta_j)|^2 = |u(\\theta_j)|^2 |\\hat{\\mathbf{t}}(\\theta_j)|^2 = |u(\\theta_j)|^2$。\n让我们定义一个符号参数 $s_{cond}$，使得对于出射条件 $s_{cond}=+1$，对于入射条件 $s_{cond}=-1$。那么，\n$$\n(\\mathbf{S} \\cdot \\hat{\\mathbf{n}})_j = s_{cond} \\frac{|u(\\theta_j)|^2}{2Z}\n$$\n总离散通量是：\n$$\n\\Phi_{\\mathrm{em}} = \\sum_{j=0}^{N-1} \\left( s_{cond} \\frac{|u(\\theta_j)|^2}{2Z} \\right) \\Delta s = \\frac{s_{cond}}{2Z} \\sum_{j=0}^{N-1} |u(\\theta_j)|^2 \\Delta s\n$$\n归一化权重是 $W = \\sum_{j=0}^{N-1} |u(\\theta_j)|^2 \\Delta s$。因此，$\\Phi_{\\mathrm{em}} = \\frac{s_{cond}}{2Z} W$。\n归一化电磁通量定义为 $\\varphi_{\\mathrm{em}} = \\Phi_{\\mathrm{em}} / \\left( \\frac{1}{2Z} W \\right)$。\n$$\n\\varphi_{\\mathrm{em}} = \\frac{\\frac{s_{cond}}{2Z} W}{\\frac{1}{2Z} W} = s_{cond}\n$$\n所以，$\\varphi_{\\mathrm{em}}$ 应该对于出射波计算为 $+1$，对于入射波计算为 $-1$，前提是 $W \\neq 0$。如果 $u(\\theta) \\equiv 0$，那么 $W=0$，通量自然为 $0$。\n\n**标量通量（$\\Phi_{\\mathrm{sc}}$）：**\n标量通量定义为 $\\Phi_{\\mathrm{sc}} = \\sum_{j} \\left[ \\frac{1}{k} \\operatorname{Im}\\left( u_j^{\\ast} \\, \\partial_r u_j \\right) \\right] \\Delta s$。\n对于出射条件，$\\partial_r u = iku$。求和中的项变为：\n$$\n\\frac{1}{k} \\operatorname{Im}(u^* (iku)) = \\frac{1}{k} \\operatorname{Im}(ik|u|^2) = \\frac{1}{k} (k|u|^2) = |u|^2\n$$\n对于入射条件，$\\partial_r u = -iku$。该项变为：\n$$\n\\frac{1}{k} \\operatorname{Im}(u^* (-iku)) = \\frac{1}{k} \\operatorname{Im}(-ik|u|^2) = \\frac{1}{k} (-k|u|^2) = -|u|^2\n$$\n用我们的符号参数 $s_{cond}$ 表示，被加数为 $s_{cond} |u(\\theta_j)|^2$。总标量通量是：\n$$\n\\Phi_{\\mathrm{sc}} = \\sum_{j=0}^{N-1} \\left( s_{cond} |u(\\theta_j)|^2 \\right) \\Delta s = s_{cond} \\sum_{j=0}^{N-1} |u(\\theta_j)|^2 \\Delta s = s_{cond} W\n$$\n归一化标量通量定义为 $\\varphi_{\\mathrm{sc}} = \\Phi_{\\mathrm{sc}} / W$。\n$$\n\\varphi_{\\mathrm{sc}} = \\frac{s_{cond} W}{W} = s_{cond}\n$$\n这表明，在将标量Sommerfeld条件和矢量Silver-Müller条件联系起来的局部平面波假设下，$\\varphi_{\\mathrm{em}} = \\varphi_{\\mathrm{sc}}$。数值实现将验证这种一致性。\n\n### 第3部分：测试用例的实现\n\n程序将为每个测试用例实现上面推导出的求和公式。\n- **用例 A（出射）：** $s_{cond}=+1$。程序为给定函数计算 $u(\\theta_j)$，然后计算 $\\varphi_{\\mathrm{em}}$。预期结果是 $1.0$。\n- **用例 B（入射）：** $s_{cond}=-1$。程序使用相同的 $u(\\theta_j)$，但采用相反的符号约定。预期结果是 $-1.0$。\n- **用例 C（零场）：** $u(\\theta_j) \\equiv 0$，这意味着归一化权重 $W=0$。必须避免除以零。物理上通量为零，所以代码将返回 $0.0$ 作为特殊情况。\n- **用例 D（一致性检查）：** $s_{cond}=-1$。程序使用各自的求和公式计算 $\\varphi_{\\mathrm{em}}$ 和 $\\varphi_{\\mathrm{sc}}$。根据我们的推导，两者都应等于 $-1$。检查 $|\\varphi_{\\mathrm{em}} - \\varphi_{\\mathrm{sc}}| \\le 10^{-12}$ 应该评估为 `True`，考虑了潜在的浮点不精确性。\n实现将不会使用解析捷径 $\\varphi = s_{cond}$，而是会执行完整的求和，以按要求演示离散验证过程。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by implementing a discrete verification routine for\n    electromagnetic and scalar radiation conditions.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"name\": \"A\",\n            \"k\": 8.0,\n            \"R\": 1.0,\n            \"N\": 512,\n            \"Z\": 376.730313669,\n            \"condition\": \"outgoing\",\n            \"u_func\": lambda theta, k, R: (1 + 0.5 * np.cos(3 * theta)) * np.exp(1j * 2 * theta) * np.exp(1j * k * R),\n            \"output_type\": \"phi_em\"\n        },\n        {\n            \"name\": \"B\",\n            \"k\": 8.0,\n            \"R\": 1.0,\n            \"N\": 512,\n            \"Z\": 376.730313669,\n            \"condition\": \"incoming\",\n            \"u_func\": lambda theta, k, R: (1 + 0.5 * np.cos(3 * theta)) * np.exp(1j * 2 * theta) * np.exp(1j * k * R),\n            \"output_type\": \"phi_em\"\n        },\n        {\n            \"name\": \"C\",\n            \"k\": 8.0,\n            \"R\": 1.0,\n            \"N\": 512,\n            \"Z\": 376.730313669,\n            \"condition\": \"incoming\",\n            \"u_func\": lambda theta, k, R: np.zeros_like(theta, dtype=complex),\n            \"output_type\": \"phi_em\"\n        },\n        {\n            \"name\": \"D\",\n            \"k\": 12.0,\n            \"R\": 0.7,\n            \"N\": 1024,\n            \"Z\": 376.730313669,\n            \"condition\": \"incoming\",\n            \"u_func\": lambda theta, k, R: (1 + 0.3 * np.cos(5 * theta) + 0.2 * np.sin(4 * theta)) * np.exp(1j * 4 * theta) * np.exp(-1j * k * R),\n            \"output_type\": \"consistency_check\"\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        k = case[\"k\"]\n        R = case[\"R\"]\n        N = case[\"N\"]\n        Z = case[\"Z\"]\n        condition = case[\"condition\"]\n        u_func = case[\"u_func\"]\n        output_type = case[\"output_type\"]\n\n        if condition == \"outgoing\":\n            # Correct-sign Sommerfeld/Silver-Müller\n            sign = 1.0\n        else: # incoming\n            # Wrong-sign Sommerfeld/Silver-Müller\n            sign = -1.0\n\n        # Discretize the boundary\n        theta = np.linspace(0, 2 * np.pi, N, endpoint=False)\n        delta_s = 2 * np.pi * R / N\n\n        # Evaluate the scalar field u on the boundary\n        u_theta = u_func(theta, k, R)\n        u_abs_sq = np.abs(u_theta)**2\n\n        # Calculate the normalization weight W\n        W = np.sum(u_abs_sq) * delta_s\n\n        # Handle the zero-field case to avoid division by zero\n        if W  1e-30: # Use a small tolerance for floating point comparison\n            if output_type == \"phi_em\":\n                results.append(0.0)\n            elif output_type == \"consistency_check\":\n                # With zero field, both fluxes are 0, so their difference is 0.\n                results.append(True)\n            continue\n\n        # Calculate normalized electromagnetic flux phi_em\n        # The term in the sum for Phi_em is (S.n) = sign * |u|^2 / (2Z)\n        s_dot_n = sign * u_abs_sq / (2 * Z)\n        Phi_em = np.sum(s_dot_n) * delta_s\n        phi_em = Phi_em / (W / (2 * Z))\n\n        if output_type == \"phi_em\":\n            results.append(phi_em)\n        elif output_type == \"consistency_check\":\n            # Calculate normalized scalar flux phi_sc\n            # The term in the sum for Phi_sc is (1/k)*Im(u* du/dr) = sign * |u|^2\n            scalar_integrand = sign * u_abs_sq\n            Phi_sc = np.sum(scalar_integrand) * delta_s\n            phi_sc = Phi_sc / W\n            \n            # Perform the consistency check\n            is_consistent = np.abs(phi_em - phi_sc) = 1e-12\n            results.append(is_consistent)\n\n    # Format the final output string exactly as required\n    output_str = f\"[{results[0]},{results[1]},{results[2]},{str(results[3]).lower() if isinstance(results[3], bool) else results[3]}]\"\n    print(output_str)\n\nsolve()\n```", "id": "3347707"}, {"introduction": "在建立了向外能量流的物理原理之后，我们现在转向辐射场的数学结构。远场天然地可以用矢量球谐函数基来描述，对应于不同的多极矩贡献（TE和TM模式）。这个练习 [@problem_id:3347712] 将指导您进行推导，看Silver-Müller条件的简洁矢量形式 $\\mathbf{H}_\\infty = \\frac{1}{\\eta}\\hat{\\mathbf{r}} \\times \\mathbf{E}_\\infty$ 是如何转化为谐波域中TE和TM分量之间一个简单而优雅的耦合矩阵的。", "problem": "考虑一个均匀、各向同性、无源的介质中的时谐电磁场，其角频率为 $\\omega$，介电常数为 $\\varepsilon$，磁导率为 $\\mu$，时间约定为 $\\exp(-i \\omega t)$。设本征阻抗为 $\\eta = \\sqrt{\\mu/\\varepsilon}$，波数量为 $k = \\omega \\sqrt{\\mu \\varepsilon}$。在辐射区，Sommerfeld 辐射条件蕴含了远场的 Silver–Müller 辐射条件。\n\n定义单位球面上的切向无散矢量球谐函数为 $X_{\\ell m}(\\hat{\\mathbf{x}}) = \\frac{1}{\\sqrt{\\ell(\\ell+1)}} \\mathbf{L} Y_{\\ell m}(\\hat{\\mathbf{x}})$，其中 $Y_{\\ell m}$ 是标量球谐函数，$\\mathbf{L} = -i\\, \\mathbf{x} \\times \\nabla$ 是角动量算符。在远场中，麦克斯韦方程组的任何出射解都可以渐近展开为\n$$\n\\mathbf{E}(r \\hat{\\mathbf{x}}) \\sim \\frac{\\exp(i k r)}{k r}\\, \\mathbf{E}_{\\infty}(\\hat{\\mathbf{x}}), \\qquad\n\\mathbf{H}(r \\hat{\\mathbf{x}}) \\sim \\frac{\\exp(i k r)}{k r}\\, \\mathbf{H}_{\\infty}(\\hat{\\mathbf{x}}),\n$$\n其领头阶振幅对每个 $\\ell, m$ 分解为\n$$\n\\mathbf{E}_{\\infty}(\\hat{\\mathbf{x}}) = \\sum_{\\ell=1}^{\\infty}\\sum_{m=-\\ell}^{\\ell} \\Big( A_{\\ell m}\\, X_{\\ell m}(\\hat{\\mathbf{x}}) + B_{\\ell m}\\, \\hat{\\mathbf{x}} \\times X_{\\ell m}(\\hat{\\mathbf{x}}) \\Big),\n$$\n其中 $A_{\\ell m}$ 是磁型（横电，TE）多极子的电场振幅，$B_{\\ell m}$ 是电型（横磁，TM）多极子的电场振幅。\n\n从时谐麦克斯韦方程组和出射矢量球面波的渐近形式出发，使用 Sommerfeld 和 Silver–Müller 辐射条件，推导在远场领头阶下，对于每个固定的 $(\\ell,m)$，将电场振幅对 $\\begin{pmatrix} A_{\\ell m} \\\\ B_{\\ell m} \\end{pmatrix}$ 映射到同一基 $\\{X_{\\ell m}, \\hat{\\mathbf{x}} \\times X_{\\ell m}\\}$ 中相应磁场振幅对 $\\begin{pmatrix} C_{\\ell m} \\\\ D_{\\ell m} \\end{pmatrix}$ 的线性算符。该磁场振幅对定义为\n$$\n\\mathbf{H}_{\\infty}(\\hat{\\mathbf{x}}) = \\sum_{\\ell=1}^{\\infty}\\sum_{m=-\\ell}^{\\ell} \\Big( C_{\\ell m}\\, X_{\\ell m}(\\hat{\\mathbf{x}}) + D_{\\ell m}\\, \\hat{\\mathbf{x}} \\times X_{\\ell m}(\\hat{\\mathbf{x}}) \\Big).\n$$\n将最终结果表示为单个 $2\\times 2$ 矩阵 $M(\\eta)$，使得对于所有 $(\\ell,m)$，都有 $\\begin{pmatrix} C_{\\ell m} \\\\ D_{\\ell m} \\end{pmatrix} = M(\\eta) \\begin{pmatrix} A_{\\ell m} \\\\ B_{\\ell m} \\end{pmatrix}$。你的最终答案必须是这个矩阵，以 $\\eta$ 的闭式解析表达式给出。最终矩阵中不要包含任何单位。不需要进行数值近似。", "solution": "我们从均匀、各向同性、无源介质中，在 $\\exp(-i \\omega t)$ 时间约定下的时谐麦克斯韦方程组开始：\n$$\n\\nabla \\times \\mathbf{E} = i \\omega \\mu\\, \\mathbf{H}, \\qquad \\nabla \\times \\mathbf{H} = - i \\omega \\varepsilon\\, \\mathbf{E}.\n$$\n定义本征阻抗 $\\eta = \\sqrt{\\mu/\\varepsilon}$ 和波数 $k = \\omega \\sqrt{\\mu \\varepsilon}$。对于出射波 $u$，标量 Sommerfeld 辐射条件为\n$$\n\\lim_{r \\to \\infty} r \\left( \\frac{\\partial u}{\\partial r} - i k u \\right) = 0,\n$$\n对于矢量电磁场，该条件推广为 Silver–Müller 辐射条件。在当前的时间约定下，领头阶的 Silver–Müller 条件为\n$$\n\\mathbf{H}_{\\infty}(\\hat{\\mathbf{x}}) = \\frac{1}{\\eta}\\, \\hat{\\mathbf{x}} \\times \\mathbf{E}_{\\infty}(\\hat{\\mathbf{x}}),\n$$\n其中远场振幅定义为\n$$\n\\mathbf{E}(r \\hat{\\mathbf{x}}) \\sim \\frac{\\exp(i k r)}{k r}\\, \\mathbf{E}_{\\infty}(\\hat{\\mathbf{x}}), \\qquad\n\\mathbf{H}(r \\hat{\\mathbf{x}}) \\sim \\frac{\\exp(i k r)}{k r}\\, \\mathbf{H}_{\\infty}(\\hat{\\mathbf{x}}),\n$$\n当 $r \\to \\infty$ 时。\n\n接下来，我们回顾矢量球谐函数。设 $Y_{\\ell m}(\\hat{\\mathbf{x}})$ 表示标量球谐函数，$\\mathbf{L} = -i\\, \\mathbf{x} \\times \\nabla$ 为角动量算符。切向无散矢量球谐函数为\n$$\nX_{\\ell m}(\\hat{\\mathbf{x}}) = \\frac{1}{\\sqrt{\\ell(\\ell+1)}}\\, \\mathbf{L} Y_{\\ell m}(\\hat{\\mathbf{x}}).\n$$\n矢量亥姆霍兹方程的出射解可以用磁型 $\\mathbf{M}_{\\ell m}^{(3)}$ 和电型 $\\mathbf{N}_{\\ell m}^{(3)}$ 的矢量球面波函数来表示，其中上标 $(3)$ 表示使用第一类球汉克尔函数 $h_{\\ell}^{(1)}(k r)$ 来满足辐射条件。当 $r \\to \\infty$ 时，使用大宗量渐近式 $h_{\\ell}^{(1)}(k r) \\sim (-i)^{\\ell+1} \\frac{\\exp(i k r)}{k r}$ 并应用旋度算符恒等式，领头切向部分满足\n$$\n\\mathbf{M}_{\\ell m}^{(3)}(r, \\hat{\\mathbf{x}}) \\sim (-i)^{\\ell+1} \\frac{\\exp(i k r)}{k r}\\, X_{\\ell m}(\\hat{\\mathbf{x}}), \\qquad\n\\mathbf{N}_{\\ell m}^{(3)}(r, \\hat{\\mathbf{x}}) \\sim (-i)^{\\ell+1} \\frac{\\exp(i k r)}{k r}\\, \\hat{\\mathbf{x}} \\times X_{\\ell m}(\\hat{\\mathbf{x}}).\n$$\n这表明，在远场的领头阶，两个独立的切向方向是 $X_{\\ell m}$ 和 $\\hat{\\mathbf{x}} \\times X_{\\ell m}$。\n\n因此，远场电场振幅可以展开为\n$$\n\\mathbf{E}_{\\infty}(\\hat{\\mathbf{x}}) = \\sum_{\\ell=1}^{\\infty}\\sum_{m=-\\ell}^{\\ell} \\Big( A_{\\ell m}\\, X_{\\ell m}(\\hat{\\mathbf{x}}) + B_{\\ell m}\\, \\hat{\\mathbf{x}} \\times X_{\\ell m}(\\hat{\\mathbf{x}}) \\Big),\n$$\n其中，按照惯例，$A_{\\ell m}$ 乘以磁型（横电，TE）模式，$B_{\\ell m}$ 乘以电型（横磁，TM）模式。类似地，将磁场远场振幅写为\n$$\n\\mathbf{H}_{\\infty}(\\hat{\\mathbf{x}}) = \\sum_{\\ell=1}^{\\infty}\\sum_{m=-\\ell}^{\\ell} \\Big( C_{\\ell m}\\, X_{\\ell m}(\\hat{\\mathbf{x}}) + D_{\\ell m}\\, \\hat{\\mathbf{x}} \\times X_{\\ell m}(\\hat{\\mathbf{x}}) \\Big).\n$$\n\n应用 Silver–Müller 关系。利用线性和对于单位球面上任意切向矢量 $\\mathbf{T}$（$\\hat{\\mathbf{x}} \\cdot \\mathbf{T} = 0$）均成立的矢量恒等式，\n$$\n\\hat{\\mathbf{x}} \\times \\left( \\hat{\\mathbf{x}} \\times \\mathbf{T} \\right) = - \\mathbf{T},\n$$\n我们得到\n$$\n\\mathbf{H}_{\\infty}(\\hat{\\mathbf{x}}) = \\frac{1}{\\eta}\\, \\hat{\\mathbf{x}} \\times \\mathbf{E}_{\\infty}(\\hat{\\mathbf{x}})\n= \\frac{1}{\\eta} \\sum_{\\ell,m} \\Big( A_{\\ell m}\\, \\hat{\\mathbf{x}} \\times X_{\\ell m} + B_{\\ell m}\\, \\hat{\\mathbf{x}} \\times (\\hat{\\mathbf{x}} \\times X_{\\ell m}) \\Big)\n= \\sum_{\\ell,m} \\Big( - \\frac{B_{\\ell m}}{\\eta}\\, X_{\\ell m} + \\frac{A_{\\ell m}}{\\eta}\\, \\hat{\\mathbf{x}} \\times X_{\\ell m} \\Big).\n$$\n通过与基 $\\{X_{\\ell m}, \\hat{\\mathbf{x}} \\times X_{\\ell m}\\}$ 中的系数进行辨识，对于每个 $(\\ell,m)$ 我们有\n$$\n\\begin{pmatrix} C_{\\ell m} \\\\ D_{\\ell m} \\end{pmatrix} = \\frac{1}{\\eta} \\begin{pmatrix} 0  -1 \\\\ 1  0 \\end{pmatrix} \\begin{pmatrix} A_{\\ell m} \\\\ B_{\\ell m} \\end{pmatrix}.\n$$\n该矩阵与 $(\\ell,m)$ 无关，并表示远场中磁型（横电）和电型（横磁）多极子振幅之间的领头阶 Silver–Müller 耦合关系。它就是所求的线性算符 $M(\\eta)$。", "answer": "$$\\boxed{\\frac{1}{\\eta}\\begin{pmatrix}0  -1 \\\\ 1  0\\end{pmatrix}}$$", "id": "3347712"}, {"introduction": "我们的最后一个实践在一个完整的散射问题——计算电磁学的基石——的背景下综合了这些概念。我们将首先通过叠加基本解来构建一个复杂的入射波包，然后求解由一个规范物体（圆柱体）产生的散射场。核心任务 [@problem_id:3347687] 是数值验证所产生的散射场固有地满足Sommerfeld辐射条件，从而证实散射物理学正确地将总场划分为入射部分和一个纯粹的出射散射部分。", "problem": "考虑由标量亥姆霍兹方程所支配的二维空间中的时谐波传播，以此作为在偏振无关设置下电磁场单个笛卡尔分量的模型。令 $k \\gt 0$ 表示波数。对于有界散射体 $D$，外部场 $u(\\mathbf{x})$（其中 $\\mathbf{x} \\in \\mathbb{R}^2 \\setminus \\overline{D}$）在外部域中满足标量亥姆霍兹方程\n$$\n\\Delta u(\\mathbf{x}) + k^2 u(\\mathbf{x}) = 0,\n$$\n并满足出射波的索末菲辐射条件\n$$\n\\lim_{r \\to \\infty} r^{1/2} \\left( \\frac{\\partial u}{\\partial r}(\\mathbf{x}) - i k \\, u(\\mathbf{x}) \\right) = 0, \\quad r = \\|\\mathbf{x}\\|.\n$$\n完整麦克斯韦方程组的矢量推广是 Silver–Müller 辐射条件，它对电场和磁场之间的渐近关系施加了约束；本问题侧重于标量索末菲条件，该条件是二维空间中每个出射柱面波分量的适当极限形式。在本问题中，角度必须全部以弧度处理。\n\n从以下基本且经过充分检验的事实出发：\n\n1. 二维空间中的出射自由空间基本解（格林函数）由下式给出\n$$\n\\Phi_k(\\mathbf{x}, \\mathbf{y}) = \\frac{i}{4} H^{(1)}_0\\!\\left(k \\|\\mathbf{x} - \\mathbf{y}\\|\\right),\n$$\n其中 $H^{(1)}_0$ 是第一类 0 阶汉克尔函数。对于固定的 $\\mathbf{y}$，$\\Phi_k(\\cdot, \\mathbf{y})$ 在远离 $\\mathbf{y}$ 的地方求解亥姆霍兹方程，并满足索末菲辐射条件。\n\n2. 如果一个场的有限叠加中的每个加项都在一个域中满足亥姆霍兹方程并满足索末菲辐射条件，那么该叠加在该域中也满足亥姆霍兹方程和索末菲辐射条件。\n\n3. 对于一个以原点为中心、半径为 $a$ 的声软圆柱体的散射场，其总场 $u^{\\text{tot}} = u^{\\text{inc}} + u^{\\text{scat}}$ 满足边界条件 $u^{\\text{tot}}(r=a,\\phi)=0$，该散射场可表示为一个角向傅里叶级数\n$$\nu^{\\text{scat}}(r,\\phi) = \\sum_{n=-\\infty}^{\\infty} a_n \\, H_n^{(1)}(k r)\\, e^{i n \\phi}, \\quad r \\ge a,\n$$\n其中 $H_n^{(1)}$ 是第一类 n 阶汉克尔函数，系数 $\\{a_n\\}$ 通过使用 $r=a$ 上的边界数据的傅里叶系数来匹配边界条件确定。\n\n您的任务是：\n\nA. 根据第 1-2 项，推导出以下由出射基本解构成的“类高斯波束”叠加在二维空间中满足索末菲辐射条件。对于固定的源圆半径 $r_s \\ge 0$、波束方向 $\\theta_0 \\in [0,2\\pi)$ 和高斯宽度参数 $\\sigma \\gt 0$，定义入射场\n$$\nu^{\\text{inc}}(\\mathbf{x}) = \\int_{0}^{2\\pi} w(\\theta;\\theta_0,\\sigma)\\, \\Phi_k\\!\\big(\\mathbf{x}, \\mathbf{y}(\\theta)\\big)\\, \\frac{d\\theta}{2\\pi},\n\\quad \\text{其中} \\quad\n\\mathbf{y}(\\theta) = r_s(\\cos\\theta,\\sin\\theta),\n$$\n且 $w(\\theta;\\theta_0,\\sigma)$ 是一个集中在 $\\theta=\\theta_0$ 附近的光滑、$2\\pi$-周期的高斯窗。通过适当地论证将大 $r$ 极限移到积分号内的合理性，得出结论：对于任何固定的 $r_s$、$\\theta_0$ 和 $\\sigma$，$u^{\\text{inc}}$ 都满足索末菲辐射条件。\n\nB. 使用分离变量法和圆上傅里叶模态的正交性，证明半径为 $a$ 的声软圆柱体的散射场可以表示为\n$$\nu^{\\text{scat}}(r,\\phi) = \\sum_{n=-\\infty}^{\\infty} \\frac{c_n}{H_n^{(1)}(k a)}\\, H_n^{(1)}(k r)\\, e^{i n \\phi},\n$$\n其中\n$$\nc_n = \\frac{1}{2\\pi} \\int_0^{2\\pi} \\big(-u^{\\text{inc}}(a,\\phi)\\big) e^{-i n \\phi}\\, d\\phi,\n$$\n是为满足 $u^{\\text{tot}}(a,\\phi)=0$ 所需的边界数据的傅里叶系数。\n\nC. 设计一个数值程序，通过计算在固定观测半径 $R \\gg a$ 处的归一化索末菲残差来验证出射性\n$$\n\\mathcal{E}(R;u) = \\frac{\\left(\\int_0^{2\\pi} \\left| \\sqrt{R}\\left(\\frac{\\partial u}{\\partial r}(R,\\alpha) - i k \\, u(R,\\alpha)\\right) \\right|^2 \\, \\frac{d\\alpha}{2\\pi} \\right)^{1/2}}\n{\\left(\\int_0^{2\\pi} \\left| u(R,\\alpha) \\right|^2 \\, \\frac{d\\alpha}{2\\pi} \\right)^{1/2}}.\n$$\n对于一个精确的出射场，在二维空间中，渐近性表明当 $R \\to \\infty$ 时，$\\mathcal{E}(R;u) \\to 0$。\n\n实现一个程序，该程序：\n\n1. 通过在 $\\theta$ 上使用等距梯形求积法数值积分部分 A 中的叠加来构造 $u^{\\text{inc}}$，其中周期性高斯窗为\n$$\nw(\\theta;\\theta_0,\\sigma) = \\exp\\!\\left(-\\frac{1}{2}\\left(\\frac{\\operatorname{wrap}(\\theta-\\theta_0)}{\\sigma}\\right)^2\\right),\n$$\n其中 $\\operatorname{wrap}(\\varphi) \\in [-\\pi,\\pi)$ 是 $2\\pi$-周期化的角度差。\n\n2. 通过使用梯形法则计算 $-u^{\\text{inc}}(a,\\phi)$ 在 $\\phi$ 上的傅里叶系数，并使用标准的三项递推关系来获得 $H_n^{(1)}(k r)$ 的径向导数，从而利用部分 B 中的截断级数计算圆柱体外部的散射场 $u^{\\text{scat}}$。\n\n3. 对于以下每个测试用例，在一个均匀的观测角度网格 $\\alpha \\in [0,2\\pi)$ 上计算 $\\mathcal{E}(R;u^{\\text{inc}})$ 和 $\\mathcal{E}(R;u^{\\text{scat}})$，对 $\\alpha$ 积分使用至少 $360$ 个采样角度。\n\n测试套件（角度以弧度为单位；所有量均为无量纲）：\n\n- 情况 1: $k=3.0$, $a=0.4$, $r_s=0.1$, $\\sigma=0.4$, $\\theta_0=0.0$, $R=5.0$.\n- 情况 2: $k=6.0$, $a=0.5$, $r_s=0.2$, $\\sigma=0.3$, $\\theta_0=\\pi/6$, $R=6.0$.\n- 情况 3: $k=1.5$, $a=0.3$, $r_s=0.05$, $\\sigma=1.0$, $\\theta_0=\\pi/2$, $R=4.0$.\n\n您的程序应生成单行输出，包含六个结果，顺序如下\n$$\n\\big[\\mathcal{E}(R;u^{\\text{inc}})_{\\text{情况 1}},\\ \\mathcal{E}(R;u^{\\text{scat}})_{\\text{情况 1}},\\ \\mathcal{E}(R;u^{\\text{inc}})_{\\text{情况 2}},\\ \\mathcal{E}(R;u^{\\text{scat}})_{\\text{情况 2}},\\ \\mathcal{E}(R;u^{\\text{inc}})_{\\text{情况 3}},\\ \\mathcal{E}(R;u^{\\text{scat}})_{\\text{情况 3}} \\big],\n$$\n打印为方括号括起来的逗号分隔列表（例如，“[0.0123,0.00456, ... ]”）。每个条目必须是浮点数。不需要物理单位；以无量纲形式处理问题。角度必须解释为弧度。输出必须是单行，不含任何附加文本。", "solution": "该问题在科学和数学上是适定的。它提出了计算散射理论中的一个标准任务：构造入射场和散射场，并数值验证它们满足所需的辐射条件。所有定义、方程和参数都与已建立的理论一致。解题过程按要求分为三个部分。\n\n**A. 验证 $u^{\\text{inc}}$ 满足索末菲辐射条件**\n\n入射场定义为基本解的连续叠加：\n$$\nu^{\\text{inc}}(\\mathbf{x}) = \\int_{0}^{2\\pi} w(\\theta;\\theta_0,\\sigma)\\, \\Phi_k\\!\\big(\\mathbf{x}, \\mathbf{y}(\\theta)\\big)\\, \\frac{d\\theta}{2\\pi}\n$$\n其中 $\\mathbf{y}(\\theta)$ 描绘了一个半径为 $r_s$ 的圆。已知基本解 $\\Phi_k(\\mathbf{x}, \\mathbf{y}) = \\frac{i}{4} H^{(1)}_0(k\\|\\mathbf{x}-\\mathbf{y}\\|)$ 对于任何固定的源点 $\\mathbf{y}$ 都满足索末菲条件。令 $r = \\|\\mathbf{x}\\|$。索末菲条件算子为 $\\mathcal{S}[u] = \\lim_{r \\to \\infty} r^{1/2} \\left( \\frac{\\partial u}{\\partial r} - i k u \\right)$。\n\n将此算子应用于 $u^{\\text{inc}}(\\mathbf{x})$：\n$$\n\\mathcal{S}[u^{\\text{inc}}] = \\lim_{r \\to \\infty} r^{1/2} \\left( \\frac{\\partial}{\\partial r} \\int_{0}^{2\\pi} w(\\theta) \\Phi_k(\\mathbf{x}, \\mathbf{y}(\\theta)) \\frac{d\\theta}{2\\pi} - i k \\int_{0}^{2\\pi} w(\\theta) \\Phi_k(\\mathbf{x}, \\mathbf{y}(\\theta)) \\frac{d\\theta}{2\\pi} \\right)\n$$\n为证明极限和微分算子与积分可交换，我们可以依赖于汉克尔函数及其导数在大自变量下的一致收敛性质。源点 $\\mathbf{y}(\\theta)$ 被限制在一个有界集合（半径为 $r_s$ 的圆）内，且权重函数 $w(\\theta)$ 是光滑且有界的。当 $r \\to \\infty$ 时，距离 $\\|\\mathbf{x}-\\mathbf{y}(\\theta)\\|$ 的行为如同 $r - \\hat{\\mathbf{x}} \\cdot \\mathbf{y}(\\theta) + O(1/r)$，其中 $\\hat{\\mathbf{x}}=\\mathbf{x}/r$。$\\Phi_k(\\mathbf{x}, \\mathbf{y}(\\theta))$ 及其导数 $\\frac{\\partial}{\\partial r}\\Phi_k$ 的渐近形式相对于 $\\theta$ 是一致的。这允许进行交换：\n$$\n\\mathcal{S}[u^{\\text{inc}}] = \\int_{0}^{2\\pi} w(\\theta) \\left[ \\lim_{r \\to \\infty} r^{1/2} \\left( \\frac{\\partial \\Phi_k(\\mathbf{x}, \\mathbf{y}(\\theta))}{\\partial r} - i k \\Phi_k(\\mathbf{x}, \\mathbf{y}(\\theta)) \\right) \\right] \\frac{d\\theta}{2\\pi}\n$$\n方括号内的项是 $\\mathcal{S}[\\Phi_k(\\cdot, \\mathbf{y}(\\theta))]$，对于每个 $\\theta$ 均为 $0$。零的积分是零。因此，$u^{\\text{inc}}$ 满足索末菲辐射条件。同样的推理也证实了当 $\\|\\mathbf{x}\\|  r_s$ 时，$u^{\\text{inc}}$ 满足亥姆霍兹方程。\n\n**B. 散射场级数的推导**\n\n总场 $u^{\\text{tot}} = u^{\\text{inc}} + u^{\\text{scat}}$ 必须满足声软边界条件 $u^{\\text{tot}}(r, \\phi)|_{r=a} = 0$。这意味着：\n$$\nu^{\\text{scat}}(a, \\phi) = -u^{\\text{inc}}(a, \\phi)\n$$\n散射场 $u^{\\text{scat}}$ 必须在外部域 $r  a$ 中求解亥姆霍兹方程并满足索末菲辐射条件。通过在极坐标下使用分离变量法，这种出射场的一般形式是一个柱谐函数级数：\n$$\nu^{\\text{scat}}(r, \\phi) = \\sum_{n=-\\infty}^{\\infty} b_n H_n^{(1)}(kr) e^{in\\phi}\n$$\n系数 $b_n$ 由 $r=a$ 处的边界条件确定。我们将 $r=a$ 处的级数与边界数据相等：\n$$\n\\sum_{n=-\\infty}^{\\infty} b_n H_n^{(1)}(ka) e^{in\\phi} = -u^{\\text{inc}}(a, \\phi)\n$$\n右侧的表达式是 $\\phi$ 的一个 $2\\pi$-周期函数，可以由其傅里叶级数 $\\sum_{n=-\\infty}^{\\infty} c_n e^{in\\phi}$ 表示，其中系数 $c_n$ 由下式给出：\n$$\nc_n = \\frac{1}{2\\pi} \\int_0^{2\\pi} \\big(-u^{\\text{inc}}(a,\\phi)\\big) e^{-i n \\phi}\\, d\\phi\n$$\n根据傅里叶级数系数的唯一性，我们可以对每个模态 $n$ 的项进行等价：\n$$\nb_n H_n^{(1)}(ka) = c_n \\implies b_n = \\frac{c_n}{H_n^{(1)}(ka)}\n$$\n这是良定义的，因为汉克尔函数 $H_n^{(1)}(z)$ 在 $z0$ 时没有实零点。将 $b_n$ 代回 $u^{\\text{scat}}$ 的级数，得到所需的表达式：\n$$\nu^{\\text{scat}}(r,\\phi) = \\sum_{n=-\\infty}^{\\infty} \\frac{c_n}{H_n^{(1)}(k a)}\\, H_n^{(1)}(k r)\\, e^{i n \\phi}\n$$\n\n**C. 数值实现**\n\n数值程序旨在为 $u^{\\text{inc}}$ 和 $u^{\\text{scat}}$ 计算索末菲残差 $\\mathcal{E}(R; u)$。\n\n$1\\text{.}$ **场评估 ($u^{\\text{inc}}$)**：用于计算 $u^{\\text{inc}}(r, \\alpha)$ 的积分使用 $N_\\theta$ 点等距梯形法则进行离散化。其径向导数 $\\frac{\\partial}{\\partial r}u^{\\text{inc}}$ 通过在积分号下求导来计算。基本解的导数涉及 $H_0^{(1)'}(z) = -H_1^{(1)}(z)$，从而得到：\n    $$\n    \\frac{\\partial}{\\partial r} \\Phi_k(\\mathbf{x}, \\mathbf{y}) = \\frac{-ik}{4} H_1^{(1)}(k\\rho) \\frac{r - r_s\\cos(\\alpha-\\theta)}{\\rho}, \\quad \\rho = \\|\\mathbf{x}-\\mathbf{y}(\\theta)\\|\n    $$\n    这也通过梯形积分法计算。\n\n$2\\text{.}$ **傅里叶系数 ($c_n$)**：$-u^{\\text{inc}}(a, \\phi)$ 的系数 $c_n$ 的计算方法是，首先在 $\\phi \\in [0, 2\\pi)$ 的一个 $N_\\phi$ 点等距网格上评估 $u^{\\text{inc}}(a, \\phi)$，然后应用快速傅里叶变换 (FFT)。使用关系式 $c_n \\approx \\frac{1}{N_\\phi} (\\text{FFT}(-u^{\\text{inc}}))_n$。\n\n$3\\text{.}$ **场评估 ($u^{\\text{scat}}$)**：$u^{\\text{scat}}$ 的无穷级数被截断为在模态 $n \\in [-N_{\\text{max}}, N_{\\text{max}}]$ 上的有限和。径向导数 $\\frac{\\partial}{\\partial r}u^{\\text{scat}}$ 通过逐项求导计算。汉克尔函数的导数 $H_n^{(1)'}(z)$ 使用稳定的递推关系进行评估：\n    $$\n    H_n^{(1)'}(z) = \\frac{1}{2} \\left[ H_{n-1}^{(1)}(z) - H_{n+1}^{(1)}(z) \\right]\n    $$\n\n$4\\text{.}$ **残差计算**：$\\mathcal{E}(R;u)$ 的分子和分母中的积分使用一个在观测角 $\\alpha \\in [0, 2\\pi)$ 上的 $N_\\alpha$ 点等距梯形法则来计算。对于函数 $f(\\alpha)$，积分 $\\int_0^{2\\pi} |f(\\alpha)|^2 \\frac{d\\alpha}{2\\pi}$ 由 $\\frac{1}{N_\\alpha} \\sum_{j=0}^{N_\\alpha-1} |f(\\alpha_j)|^2$ 近似。\n\n该实现使用 `numpy` 进行数组操作，使用 `scipy.special.hankel1` 计算汉克尔函数。选择的数值参数确保了足够的精度：$N_\\theta=360$，$N_\\phi=360$（与代码中的 $N_\\alpha$ 相同），$N_\\alpha=360$，以及 $N_{\\text{max}}=30$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import hankel1\n\ndef solve():\n    \"\"\"\n    Computes the Sommerfeld residuals for incident and scattered fields\n    for a series of test cases.\n    \"\"\"\n    test_cases = [\n        # (k, a, rs, sigma, theta0, R)\n        (3.0, 0.4, 0.1, 0.4, 0.0, 5.0),\n        (6.0, 0.5, 0.2, 0.3, np.pi/6, 6.0),\n        (1.5, 0.3, 0.05, 1.0, np.pi/2, 4.0),\n    ]\n\n    results = []\n\n    # Numerical parameters\n    N_theta = 360  # Quadrature points for incident field integral\n    N_alpha = 360  # Quadrature points for residuals and Fourier series\n    N_max = 30     # Truncation for scattered field series\n\n    for case in test_cases:\n        k, a, rs, sigma, theta0, R = case\n\n        # Helper to wrap angles to [-pi, pi)\n        def wrap(phi):\n            return (phi + np.pi) % (2 * np.pi) - np.pi\n\n        # Helper to compute u_inc and its radial derivative\n        def get_inc_field(r_obs, alpha_grid, theta_grid):\n            w_vals = np.exp(-0.5 * (wrap(theta_grid - theta0) / sigma)**2)\n            \n            u_vals = np.zeros(len(alpha_grid), dtype=complex)\n            u_deriv_vals = np.zeros(len(alpha_grid), dtype=complex)\n            \n            for i, alpha in enumerate(alpha_grid):\n                rho_vals = np.sqrt(r_obs**2 + rs**2 - 2 * r_obs * rs * np.cos(alpha - theta_grid))\n                \n                # Small stabilization in case rho becomes zero\n                rho_vals[rho_vals == 0] = 1e-12 \n                \n                # u_inc\n                integrand_u = w_vals * (1j/4) * hankel1(0, k * rho_vals)\n                u_vals[i] = np.mean(integrand_u)\n                \n                # du_inc/dr\n                deriv_factor = (r_obs - rs * np.cos(alpha - theta_grid)) / rho_vals\n                integrand_deriv = w_vals * (-1j*k/4) * hankel1(1, k * rho_vals) * deriv_factor\n                u_deriv_vals[i] = np.mean(integrand_deriv)\n                \n            return u_vals, u_deriv_vals\n\n        # Helper to compute the Sommerfeld residual\n        def get_residual(r_obs, u_vals, u_deriv_vals):\n            residual_vec = np.sqrt(r_obs) * (u_deriv_vals - 1j * k * u_vals)\n            numerator_sq = np.mean(np.abs(residual_vec)**2)\n            denominator_sq = np.mean(np.abs(u_vals)**2)\n            if denominator_sq  1e-30:\n                return 0.0\n            return np.sqrt(numerator_sq / denominator_sq)\n\n        # Grids\n        theta_grid = np.linspace(0, 2 * np.pi, N_theta, endpoint=False)\n        alpha_grid = np.linspace(0, 2 * np.pi, N_alpha, endpoint=False)\n\n        # 1. Compute residual for u_inc\n        u_inc_R, u_inc_deriv_R = get_inc_field(R, alpha_grid, theta_grid)\n        E_inc = get_residual(R, u_inc_R, u_inc_deriv_R)\n        results.append(E_inc)\n\n        # 2. Compute scattered field\n        # 2a. Incident field on cylinder boundary r=a\n        u_inc_a, _ = get_inc_field(a, alpha_grid, theta_grid)\n        \n        # 2b. Fourier coefficients of -u_inc(a, phi)\n        c_coeffs_fft = np.fft.fft(-u_inc_a) / N_alpha\n        \n        n_indices = np.arange(-N_max, N_max + 1)\n        fft_indices = np.mod(n_indices, N_alpha)\n        c_n = c_coeffs_fft[fft_indices]\n        \n        # 2c. Evaluate scattered field series at R\n        ka = k * a\n        kR = k * R\n        \n        h_n_ka = hankel1(n_indices, ka)\n        series_coeffs = c_n / (h_n_ka + 1e-100) # Denominator stabilization\n\n        # Precompute Hankel functions for r=R to speed up the loop\n        h_n_kR_vals = hankel1(n_indices, kR)\n        h_n_prime_kR_vals = (k/2.0) * (hankel1(n_indices - 1, kR) - hankel1(n_indices + 1, kR))\n        \n        u_scat_R = np.zeros(N_alpha, dtype=complex)\n        u_scat_deriv_R = np.zeros(N_alpha, dtype=complex)\n\n        for i, alpha in enumerate(alpha_grid):\n            exp_term = np.exp(1j * n_indices * alpha)\n            u_scat_R[i] = np.sum(series_coeffs * h_n_kR_vals * exp_term)\n            u_scat_deriv_R[i] = np.sum(series_coeffs * h_n_prime_kR_vals * exp_term)\n            \n        # 3. Compute residual for u_scat\n        E_scat = get_residual(R, u_scat_R, u_scat_deriv_R)\n        results.append(E_scat)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "3347687"}]}