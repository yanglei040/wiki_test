{"hands_on_practices": [{"introduction": "为了打下坚实的基础，我们从一个直接的动手计算开始。这个练习要求您为一个在高斯过程回归中出现的简单 $2 \\times 2$ 矩阵计算 Cholesky 分解，从而巩固算法的基本步骤及其在现代机器学习应用中的相关性。[@problem_id:3423975]", "problem": "考虑一个数据同化设置中的线性观测模型，其中潜状态被赋予一个高斯过程 (GP) 先验。在高斯过程回归 (GPR) 中，两个输入位置上带噪声的观测函数值的协方差是先验协方差与一个独立观测噪声方差之和。具体来说，设先验协方差矩阵为 $K=\\begin{pmatrix}1  0.9\\\\ 0.9  1\\end{pmatrix}$，观测噪声方差为 $\\sigma^2=0.1$，因此观测数据的总协方差为 $A=K+\\sigma^2I$。为了反问题中的代理建模和超参数推断，需要两个计算基元：行列式的自然对数 $\\ln\\det(A)$ 和具有正对角线元素且满足 $A=L\\,L^{\\top}$ 的下三角 Cholesky 因子 $L$。\n\n从行列式以及对称正定矩阵的 Cholesky 分解的定义和基本性质出发，对于给定的 $K$ 和 $\\sigma^2$，显式计算 $\\ln\\det(K+\\sigma^2I)$ 和 Cholesky 因子 $L$。使用自然对数并提供精确的代数表达式（不要进行四舍五入）。你的最终答案必须包含这两个量，其中 Cholesky 因子需由其非零元素指明。", "solution": "用户提供了一个来自数据同化和机器学习领域的有效、适定的问题陈述。\n\n该问题要求计算高斯过程回归的两个基本量：协方差矩阵的行列式的自然对数 $\\ln\\det(A)$，以及该矩阵的 Cholesky 因子 $L$。\n\n给定的量是：\n先验协方差矩阵 $K = \\begin{pmatrix} 1  0.9 \\\\ 0.9  1 \\end{pmatrix}$。\n观测噪声方差 $\\sigma^2=0.1$。\n观测数据的总协方差由模型 $A=K+\\sigma^2I$ 给出，其中 $I$ 是 $2 \\times 2$ 的单位矩阵。\n\n首先，我们构造矩阵 $A$。\n$$\nI = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}\n$$\n$$\nA = K + \\sigma^2I = \\begin{pmatrix} 1  0.9 \\\\ 0.9  1 \\end{pmatrix} + 0.1 \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}\n$$\n$$\nA = \\begin{pmatrix} 1  0.9 \\\\ 0.9  1 \\end{pmatrix} + \\begin{pmatrix} 0.1  0 \\\\ 0  0.1 \\end{pmatrix} = \\begin{pmatrix} 1.1  0.9 \\\\ 0.9  1.1 \\end{pmatrix}\n$$\n为了保持精确性，我们可以将这些小数值表示为分数：\n$$\nA = \\begin{pmatrix} \\frac{11}{10}  \\frac{9}{10} \\\\ \\frac{9}{10}  \\frac{11}{10} \\end{pmatrix}\n$$\n\n接下来，我们计算第一个所需量 $\\ln\\det(A)$。\n一个 $2 \\times 2$ 矩阵 $\\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix}$ 的行列式由公式 $ad - bc$ 给出。\n$$\n\\det(A) = \\left(\\frac{11}{10}\\right) \\left(\\frac{11}{10}\\right) - \\left(\\frac{9}{10}\\right) \\left(\\frac{9}{10}\\right) = \\frac{121}{100} - \\frac{81}{100} = \\frac{121 - 81}{100} = \\frac{40}{100} = \\frac{2}{5}\n$$\n因此，行列式的自然对数是：\n$$\n\\ln\\det(A) = \\ln\\left(\\frac{2}{5}\\right)\n$$\n\n第二，我们计算 Cholesky 因子 $L$。$A$ 是一个对称正定矩阵，因此存在一个唯一的、具有正对角线元素的下三角矩阵 $L$，使得 $A = L L^{\\top}$。设 $L$ 为：\n$$\nL = \\begin{pmatrix} L_{11}  0 \\\\ L_{21}  L_{22} \\end{pmatrix}\n$$\n条件 $A=LL^{\\top}$ 给出：\n$$\n\\begin{pmatrix} A_{11}  A_{12} \\\\ A_{21}  A_{22} \\end{pmatrix} = \\begin{pmatrix} L_{11}  0 \\\\ L_{21}  L_{22} \\end{pmatrix} \\begin{pmatrix} L_{11}  L_{21} \\\\ 0  L_{22} \\end{pmatrix} = \\begin{pmatrix} L_{11}^2  L_{11}L_{21} \\\\ L_{21}L_{11}  L_{21}^2 + L_{22}^2 \\end{pmatrix}\n$$\n我们通过令矩阵的元素相等来求解 $L$ 的元素：\n$(1,1)$ 元素给出 $A_{11} = L_{11}^2$：\n$$\nL_{11}^2 = \\frac{11}{10} \\implies L_{11} = \\sqrt{\\frac{11}{10}}\n$$\n我们根据 Cholesky 分解的要求取正根。\n\n$(2,1)$ 元素给出 $A_{21} = L_{21}L_{11}$：\n$$\nL_{21} = \\frac{A_{21}}{L_{11}} = \\frac{9/10}{\\sqrt{11/10}} = \\frac{9}{10} \\frac{\\sqrt{10}}{\\sqrt{11}} = \\frac{9}{\\sqrt{10}\\sqrt{11}} = \\frac{9}{\\sqrt{110}}\n$$\n\n$(2,2)$ 元素给出 $A_{22} = L_{21}^2 + L_{22}^2$：\n$$\nL_{22}^2 = A_{22} - L_{21}^2 = \\frac{11}{10} - \\left(\\frac{9}{\\sqrt{110}}\\right)^2 = \\frac{11}{10} - \\frac{81}{110}\n$$\n为了相减，我们找到一个公分母：\n$$\nL_{22}^2 = \\frac{11 \\times 11}{110} - \\frac{81}{110} = \\frac{121 - 81}{110} = \\frac{40}{110} = \\frac{4}{11}\n$$\n取正平方根：\n$$\nL_{22} = \\sqrt{\\frac{4}{11}} = \\frac{2}{\\sqrt{11}}\n$$\n因此，Cholesky 因子是：\n$$\nL = \\begin{pmatrix} \\sqrt{\\frac{11}{10}}  0 \\\\ \\frac{9}{\\sqrt{110}}  \\frac{2}{\\sqrt{11}} \\end{pmatrix}\n$$\n问题要求计算两个量：$\\ln\\det(A)$ 和 Cholesky 因子 $L$ 的非零元素，即 $L_{11}$、$L_{21}$ 和 $L_{22}$。\n\n最终值为：\n$\\ln\\det(A) = \\ln(\\frac{2}{5})$\n$L_{11} = \\sqrt{\\frac{11}{10}}$\n$L_{21} = \\frac{9}{\\sqrt{110}}$\n$L_{22} = \\frac{2}{\\sqrt{11}}$", "answer": "$$\n\\boxed{\\begin{pmatrix} \\ln\\left(\\frac{2}{5}\\right)  \\sqrt{\\frac{11}{10}}  \\frac{9}{\\sqrt{110}}  \\frac{2}{\\sqrt{11}} \\end{pmatrix}}\n$$", "id": "3423975"}, {"introduction": "在掌握了基本计算方法之后，我们现在来探讨 Cholesky 分解的结构特性。这个练习将通过分块矩阵代数，演示当矩阵被增广时如何高效地更新其 Cholesky 分解，这在递归算法和信号处理中是一种常见的操作。[@problem_id:3222581]", "problem": "考虑对称正定（SPD）矩阵 $A \\in \\mathbb{R}^{2 \\times 2}$，其表达式为\n$$\nA = \\begin{pmatrix}\n4  2 \\\\\n2  3\n\\end{pmatrix},\n$$\n及其 Cholesky 因子 $G$（对角线元素为正的下三角矩阵），满足 $A = G G^{\\top}$，其中\n$$\nG = \\begin{pmatrix}\n2  0 \\\\\n1  \\sqrt{2}\n\\end{pmatrix}.\n$$\n通过在 $A$ 上附加一行和一列来构造增广矩阵 $B \\in \\mathbb{R}^{3 \\times 3}$：\n$$\nB = \\begin{pmatrix}\nA  b \\\\\nb^{\\top}  c\n\\end{pmatrix}, \\quad\nb = \\begin{pmatrix}\n1 \\\\\n2\n\\end{pmatrix}, \\quad c = 2.\n$$\n仅使用 SPD 矩阵的 Cholesky 分解定义和分块矩阵乘法，推导出确定 $B$ 的 Cholesky 因子 $H$ 所需的关系，并计算 $H$ 的右下角对角线元素（即 $B = H H^{\\top}$ 中下三角因子 $H$ 的 $(3,3)$ 元）。将最终数值答案四舍五入到四位有效数字。不需要单位。", "solution": "首先对问题进行验证。\n\n### 步骤 1：提取已知条件\n-   给定矩阵 $A \\in \\mathbb{R}^{2 \\times 2}$ 为 $A = \\begin{pmatrix} 4  2 \\\\ 2  3 \\end{pmatrix}$。题目说明其为对称正定（SPD）矩阵。\n-   $A$ 的 Cholesky 因子给定为 $G = \\begin{pmatrix} 2  0 \\\\ 1  \\sqrt{2} \\end{pmatrix}$，满足 $A = GG^{\\top}$，其中 $G$ 是对角线元素为正的下三角矩阵。\n-   构造了一个增广矩阵 $B \\in \\mathbb{R}^{3 \\times 3}$，其形式为 $B = \\begin{pmatrix} A  b \\\\ b^{\\top}  c \\end{pmatrix}$。\n-   向量 $b$ 为 $b = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$。\n-   标量 $c$ 为 $c = 2$。\n-   我们需要找到 $B$ 的 Cholesky 因子 $H$，其中 $B = HH^{\\top}$，并具体计算元素 $H_{33}$。\n-   最终数值答案应四舍五入到四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学依据**：该问题植根于数值线性代数，特别是 Cholesky 分解，这是一种求解 SPD 矩阵线性系统的标准方法。\n-   **适定性**：\n    -   我们验证给定信息的一致性。给定矩阵 $A$ 的 Cholesky 分解表示为 $G G^{\\top}$：\n        $$\n        G G^{\\top} = \\begin{pmatrix} 2  0 \\\\ 1  \\sqrt{2} \\end{pmatrix} \\begin{pmatrix} 2  1 \\\\ 0  \\sqrt{2} \\end{pmatrix} = \\begin{pmatrix} (2)(2) + (0)(0)  (2)(1) + (0)(\\sqrt{2}) \\\\ (1)(2) + (\\sqrt{2})(0)  (1)(1) + (\\sqrt{2})(\\sqrt{2}) \\end{pmatrix} = \\begin{pmatrix} 4  2 \\\\ 2  1+2 \\end{pmatrix} = \\begin{pmatrix} 4  2 \\\\ 2  3 \\end{pmatrix} = A\n        $$\n        给定的因子 $G$ 确实是 $A$ 的正确 Cholesky 因子。矩阵 $A$ 是 SPD 矩阵，因为其顺序主子式为 $D_1 = 4 > 0$ 和 $D_2 = \\det(A) = 4 \\times 3 - 2 \\times 2 = 12 - 4 = 8 > 0$。\n    -   为了使 $B$ 的 Cholesky 分解存在，$B$ 必须是 SPD 矩阵。我们构造 $B$ 并进行检查：\n        $$\n        B = \\begin{pmatrix} 4  2  1 \\\\ 2  3  2 \\\\ 1  2  2 \\end{pmatrix}\n        $$\n        $B$ 是对称的。其顺序主子式为：\n        $D_1 = 4 > 0$。\n        $D_2 = \\det\\begin{pmatrix} 4  2 \\\\ 2  3 \\end{pmatrix} = 8 > 0$。\n        $D_3 = \\det(B) = 4(3 \\cdot 2 - 2 \\cdot 2) - 2(2 \\cdot 2 - 2 \\cdot 1) + 1(2 \\cdot 2 - 3 \\cdot 1) = 4(2) - 2(2) + 1(1) = 8 - 4 + 1 = 5 > 0$。\n        由于所有顺序主子式均为正，$B$ 是 SPD 矩阵，且存在唯一的对角线元素为正的 Cholesky 因子 $H$。\n-   **客观性**：该问题以精确的数学术语陈述，没有任何主观性。\n\n### 步骤 3：结论与行动\n该问题是自洽的、一致的且科学上是适定的。验证成功。我们继续进行求解。\n\n矩阵 $B$ 是一个 $3 \\times 3$ 的 SPD 矩阵，其 Cholesky 因子 $H$ 是一个对角线元素为正的 $3 \\times 3$ 下三角矩阵，使得 $B = H H^{\\top}$。题目要求我们找到元素 $H_{33}$。我们将按要求使用分块矩阵乘法。\n\n我们按规定对矩阵 $B$ 进行分块：\n$$\nB = \\begin{pmatrix} A  b \\\\ b^{\\top}  c \\end{pmatrix}\n$$\n其中 $A$ 是 $2 \\times 2$ 矩阵，$b$ 是 $2 \\times 1$ 向量，$c$ 是一个标量。我们对下三角矩阵 $H$ 进行相应的分块：\n$$\nH = \\begin{pmatrix} L  \\mathbf{0} \\\\ \\mathbf{h}^{\\top}  \\delta \\end{pmatrix}\n$$\n这里，$L$ 是一个 $2 \\times 2$ 的下三角矩阵，$\\mathbf{0}$ 是一个 $2 \\times 1$ 的零向量，$\\mathbf{h}^{\\top}$ 是一个 $1 \\times 2$ 的行向量（因此 $\\mathbf{h}$ 是一个 $2 \\times 1$ 的列向量），$\\delta$ 是一个标量，对应于我们所求的元素 $H_{33}$。根据 Cholesky 分解的定义，对角线元素必须为正，所以 $\\delta > 0$。\n\n$H$ 的转置是：\n$$\nH^{\\top} = \\begin{pmatrix} L^{\\top}  \\mathbf{h} \\\\ \\mathbf{0}^{\\top}  \\delta \\end{pmatrix}\n$$\n现在，我们以分块形式计算乘积 $H H^{\\top}$：\n$$\nH H^{\\top} = \\begin{pmatrix} L  \\mathbf{0} \\\\ \\mathbf{h}^{\\top}  \\delta \\end{pmatrix} \\begin{pmatrix} L^{\\top}  \\mathbf{h} \\\\ \\mathbf{0}^{\\top}  \\delta \\end{pmatrix} = \\begin{pmatrix} L L^{\\top}  L \\mathbf{h} \\\\ \\mathbf{h}^{\\top} L^{\\top}  \\mathbf{h}^{\\top} \\mathbf{h} + \\delta^2 \\end{pmatrix}\n$$\n通过令 $B = H H^{\\top}$，我们比较各个分块：\n$$\n\\begin{pmatrix} A  b \\\\ b^{\\top}  c \\end{pmatrix} = \\begin{pmatrix} L L^{\\top}  L \\mathbf{h} \\\\ (L \\mathbf{h})^{\\top}  \\mathbf{h}^{\\top} \\mathbf{h} + \\delta^2 \\end{pmatrix}\n$$\n这给了我们一个由三个矩阵/向量方程组成的方程组：\n1.  $A = L L^{\\top}$\n2.  $b = L \\mathbf{h}$\n3.  $c = \\mathbf{h}^{\\top} \\mathbf{h} + \\delta^2$\n\n我们一步步求解这个方程组。\n由方程（1），$A = L L^{\\top}$。这表明 $L$ 是 $A$ 的 Cholesky 因子。问题陈述中给出了 $A$ 的 Cholesky 因子为 $G$。由于 SPD 矩阵的对角线元素为正的 Cholesky 因子是唯一的，我们必有 $L = G$。\n$$\nL = G = \\begin{pmatrix} 2  0 \\\\ 1  \\sqrt{2} \\end{pmatrix}\n$$\n由方程（2），$b = L \\mathbf{h}$。由于 $L$ 是下三角矩阵，我们可以使用前向替换法求解向量 $\\mathbf{h}$。\n$$\n\\begin{pmatrix} 2  0 \\\\ 1  \\sqrt{2} \\end{pmatrix} \\mathbf{h} = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}\n$$\n设 $\\mathbf{h} = \\begin{pmatrix} h_1 \\\\ h_2 \\end{pmatrix}$。方程组为：\n$$\n2 h_1 = 1 \\implies h_1 = \\frac{1}{2}\n$$\n$$\n1 h_1 + \\sqrt{2} h_2 = 2 \\implies \\frac{1}{2} + \\sqrt{2} h_2 = 2\n$$\n求解 $h_2$：\n$$\n\\sqrt{2} h_2 = 2 - \\frac{1}{2} = \\frac{3}{2} \\implies h_2 = \\frac{3}{2 \\sqrt{2}} = \\frac{3\\sqrt{2}}{4}\n$$\n所以，向量 $\\mathbf{h}$ 是 $\\mathbf{h} = \\begin{pmatrix} 1/2 \\\\ 3\\sqrt{2}/4 \\end{pmatrix}$。\n\n最后，由方程（3），$c = \\mathbf{h}^{\\top} \\mathbf{h} + \\delta^2$，我们可以解出 $\\delta$，即所求的元素 $H_{33}$。\n$$\n\\delta^2 = c - \\mathbf{h}^{\\top} \\mathbf{h}\n$$\n首先，计算 $\\mathbf{h}^{\\top} \\mathbf{h}$：\n$$\n\\mathbf{h}^{\\top} \\mathbf{h} = \\begin{pmatrix} \\frac{1}{2}  \\frac{3\\sqrt{2}}{4} \\end{pmatrix} \\begin{pmatrix} \\frac{1}{2} \\\\ \\frac{3\\sqrt{2}}{4} \\end{pmatrix} = \\left(\\frac{1}{2}\\right)^2 + \\left(\\frac{3\\sqrt{2}}{4}\\right)^2 = \\frac{1}{4} + \\frac{9 \\cdot 2}{16} = \\frac{1}{4} + \\frac{18}{16} = \\frac{4}{16} + \\frac{18}{16} = \\frac{22}{16} = \\frac{11}{8}\n$$\n现在将这个值和 $c=2$ 代入关于 $\\delta^2$ 的方程中：\n$$\n\\delta^2 = 2 - \\frac{11}{8} = \\frac{16}{8} - \\frac{11}{8} = \\frac{5}{8}\n$$\n由于 $\\delta = H_{33}$ 必须为正，我们取正平方根：\n$$\n\\delta = \\sqrt{\\frac{5}{8}} = \\frac{\\sqrt{5}}{\\sqrt{8}} = \\frac{\\sqrt{5}}{2\\sqrt{2}} = \\frac{\\sqrt{5}\\sqrt{2}}{2\\sqrt{2}\\sqrt{2}} = \\frac{\\sqrt{10}}{4}\n$$\n问题要求数值答案四舍五入到四位有效数字。\n$$\n\\delta = \\frac{\\sqrt{10}}{4} \\approx \\frac{3.16227766}{4} \\approx 0.790569415\n$$\n将此值四舍五入到四位有效数字得到 $0.7906$。", "answer": "$$\n\\boxed{0.7906}\n$$", "id": "3222581"}, {"introduction": "我们的最后一个练习将解决数值计算中的一个关键问题：稳定性。您将分析 Cholesky 主元在对角移位下的行为，并设计一个稳健的算法来寻找确保分解成功所需的最小移位量，从而将理论理解与实用的高性能实现联系起来。[@problem_id:3537154]", "problem": "给定一个实对称矩阵 $A \\in \\mathbb{R}^{n \\times n}$，考虑对角移位族 $A_{\\delta} = A + \\delta I$，其中 $\\delta \\in \\mathbb{R}$。对于每个使 $A_{\\delta}$ 为对称正定 (SPD) 的 $\\delta$，存在唯一的 Cholesky 分解 $A_{\\delta} = L(\\delta) L(\\delta)^{\\top}$，其中 $L(\\delta)$ 是一个具有严格正对角元的下三角矩阵。$L(\\delta)$ 的对角元，记作 $L_{ii}(\\delta)$，通常被称为 Cholesky 主元。\n\n您的任务如下。\n\n- 从第一性原理出发，推导一个控制 $L(\\delta)$ 相对于 $\\delta$ 变化率的关系。仅使用 Cholesky 分解的核心定义，即对于任何使 $A_{\\delta}$ 为 SPD 的 $\\delta$，有 $L(\\delta) L(\\delta)^{\\top} = A + \\delta I$。对此恒等式关于 $\\delta$ 求导，并证明其导数 $S(\\delta) := \\frac{d}{d\\delta}L(\\delta)$ 满足以下形式的结构化三角 Sylvester 方程\n  $$ S(\\delta) L(\\delta)^{\\top} + L(\\delta) S(\\delta)^{\\top} = I. $$\n  仅利用三角矩阵的代数性质和 $L(\\delta)$ 对角元的严格正性，推导出唯一确定 $S(\\delta)$ 的逐元关系。从这些关系中，证明对于每个索引 $i$（$1 \\le i \\le n$），第 $i$ 个主元的导数满足 $L_{ii}'(\\delta) = S_{ii}(\\delta) > 0$，因此每个主元 $L_{ii}(\\delta)$ 是关于 $\\delta$ 的严格递增函数。\n\n- 提出一个数值稳定的算法，在带有舍入误差的有限精度算术中，选择最小的非负移位 $\\delta_{\\min}$，使得对 $A_{\\delta_{\\min}}$ 进行无分块、无主元选择的 Cholesky 分解：\n  $$\n  A_{\\delta_{\\min}} = L L^{\\top}\n  $$\n  不会崩溃，并且所有主元 $L_{ii} \\ge \\tau$，其中 $\\tau > 0$ 是一个给定的阈值。您的算法应：\n  1. 利用主元 $L_{ii}(\\delta)$ 相对于 $\\delta$ 的单调性来证明对 $\\delta$ 进行区间限定与二分搜索的合理性。\n  2. 将在无分块 Cholesky 递归中遇到的任何非正被开方数视为需要增加 $\\delta$ 的崩溃。\n  3. 算法终止时得到的 $\\delta_{\\min}$ 应能保证，在浮点运算中实际计算出的分解中，最小主元至少为 $\\tau$。\n  4. 为关于 $\\delta$ 的二分法指定一个绝对或相对的停止容差 $\\varepsilon_{\\delta} > 0$，并说明二分法为何会终止。\n\n- 将您的算法实现为一个完整的程序，对于每个测试用例，返回最小的 $\\delta \\ge 0$，使得在双精度算术中对 $A + \\delta I$ 进行直接的无分块 Cholesky 实现能够成功而不崩溃，并满足 $\\min_i L_{ii} \\ge \\tau$。使用 Cholesky 递归的直接实现来揭示实际的有限精度行为；不要依赖隐藏了主元增长行为的库函数调用。\n\n使用以下测试套件。对于每个案例，输入是一个对称矩阵 $A$ 和一个正阈值 $\\tau$：\n  - 案例 1 (良态 SPD):\n    $$ A_1 = \\begin{bmatrix} 4  1  0 \\\\ 1  3  0.5 \\\\ 0  0.5  2 \\end{bmatrix}, \\quad \\tau_1 = 1.0. $$\n  - 案例 2 (主对角元极小的 SPD):\n    $$ A_2 = \\operatorname{diag}(10^{-8}, 1, 2), \\quad \\tau_2 = 10^{-3}. $$\n  - 案例 3 (不定对称，需要移位才能变为 SPD):\n    $$ A_3 = \\begin{bmatrix} 0  1 \\\\ 1  0 \\end{bmatrix}, \\quad \\tau_3 = 0.1. $$\n  - 案例 4 (半正定对角，需要移位以获得正主元):\n    $$ A_4 = \\operatorname{diag}(0, 2, 3), \\quad \\tau_4 = 0.5. $$\n\n您的程序应产生单行输出，其中包含按测试套件顺序排列的结果，形式为方括号括起来的逗号分隔列表，例如\n$$ [\\delta_1,\\delta_2,\\delta_3,\\delta_4]. $$\n\n最终输出中的所有数字都应为浮点十进制表示。不涉及物理单位。不涉及角度。不涉及百分比。每个测试用例唯一接受的输出是满足上述规范的标量浮点数 $\\delta_i$。算法必须是通用的，不得硬编码任何答案。", "solution": "此问题被评估为有效，因为它科学地基于数值线性代数的原理，是适定问题，并且陈述客观。它要求推导关于 Cholesky 分解敏感性的标准结果，并基于这些结果设计和实现一个数值上合理的算法。\n\n### 第 1 部分：理论推导\n\n对称正定 (SPD) 矩阵 $A_{\\delta} = A + \\delta I$ 的 Cholesky 分解由以下恒等式给出：\n$$L(\\delta) L(\\delta)^{\\top} = A + \\delta I$$\n其中 $L(\\delta)$ 是一个具有严格正对角元（$L_{ii}(\\delta) > 0$）的下三角矩阵。为了求出 $L(\\delta)$ 相对于 $\\delta$ 的变化率，我们对此恒等式关于 $\\delta$ 求导。矩阵 $A$ 相对于 $\\delta$ 是常数。对左侧使用矩阵微分的乘积法则，并直接对右侧求导，我们得到：\n$$\\frac{d}{d\\delta}(L(\\delta)) L(\\delta)^{\\top} + L(\\delta) \\frac{d}{d\\delta}(L(\\delta)^{\\top}) = \\frac{d}{d\\delta}(A) + \\frac{d}{d\\delta}(\\delta I)$$\n令 $S(\\delta) = \\frac{d}{d\\delta}L(\\delta)$。那么 $\\frac{d}{d\\delta}(L(\\delta)^{\\top}) = (\\frac{d}{d\\delta}L(\\delta))^{\\top} = S(\\delta)^{\\top}$。$A$ 的导数是零矩阵，$\\delta I$ 的导数是单位矩阵 $I$。将这些代入求导后的方程，得到：\n$$S(\\delta) L(\\delta)^{\\top} + L(\\delta) S(\\delta)^{\\top} = I$$\n这就是关于 $S(\\delta)$ 的结构化三角 Sylvester 方程。\n\n由于在 $A_\\delta$ 为 SPD 的定义域内，对于所有 $\\delta$，$L(\\delta)$ 都是下三角矩阵，其非对角元 $L_{ij}(\\delta)$（当 $i  j$ 时）恒等于零。因此，它们的导数也必须为零：$S_{ij}(\\delta) = \\frac{d}{d\\delta}L_{ij}(\\delta) = 0$（当 $i  j$ 时）。这表明 $S(\\delta)$ 也是一个下三角矩阵。\n\n$S(\\delta)$（记作 $S$）相对于 $L(\\delta)$（记作 $L$）的逐元关系可以通过逐列求解 Sylvester 方程来推导。对于 $j=1, \\dots, n$ 和 $i=j, \\dots, n$：\n$$ (S L^{\\top})_{ij} + (L S^{\\top})_{ij} = \\sum_{k=1}^{j} S_{ik} L_{jk} + \\sum_{k=1}^{i} L_{ik} S_{jk} = \\delta_{ij} $$\n其中 $\\delta_{ij}$ 是克罗内克 delta。由于 $S$ 是下三角矩阵，当 $k>j$ 时 $S_{jk}=0$。\n对于对角元 ($i=j$)：\n$$ 2 \\sum_{k=1}^{j} S_{jk} L_{jk} = 1 $$\n$$ 2 \\left( S_{jj} L_{jj} + \\sum_{k=1}^{j-1} S_{jk} L_{jk} \\right) = 1 \\implies S_{jj} = \\frac{1}{2 L_{jj}} \\left(1 - 2\\sum_{k=1}^{j-1} S_{jk} L_{jk}\\right) $$\n对于非对角元 ($ij$)：\n$$ \\sum_{k=1}^{j} S_{ik} L_{jk} + \\sum_{k=1}^{j} L_{ik} S_{jk} = 0 $$\n$$ S_{ij} L_{jj} + L_{ij} S_{jj} + \\sum_{k=1}^{j-1} (S_{ik} L_{jk} + L_{ik} S_{jk}) = 0 \\implies S_{ij} = -\\frac{1}{L_{jj}} \\left( L_{ij} S_{jj} + \\sum_{k=1}^{j-1} (S_{ik} L_{jk} + L_{ik} S_{jk}) \\right) $$\n这些关系允许通过逐列向前代入法唯一确定 $S$ 的所有元素。\n\n为证明 $L_{ii}'(\\delta) = S_{ii}(\\delta) > 0$，我们使用以舒尔补 (Schur complements) 定义的 Cholesky 主元。第 $i$ 个主元的平方 $L_{ii}(\\delta)^2$ 是 $A_{\\delta}$ 的前导 $(i-1) \\times (i-1)$ 子矩阵的舒尔补的 $(1,1)$ 元。我们将 $A_{\\delta}$ 分块如下：\n$$ A_{\\delta} = \\begin{pmatrix} A_{11}+\\delta I_{i-1}  \\mathbf{a}_{12} \\\\ \\mathbf{a}_{21}  A_{22}+\\delta I_{n-i+1} \\end{pmatrix} $$\n其中 $A_{11}$ 是 $(i-1) \\times (i-1)$ 矩阵，$\\mathbf{a}_{21} = \\mathbf{a}_{12}^\\top$ 是 $A$ 的第 $i$ 行/列的相关部分。主元 $L_{ii}(\\delta)$ 由以下公式确定：\n$$ L_{ii}(\\delta)^2 = (A_{ii} + \\delta) - \\mathbf{a}_{21}^{\\top} (A_{11} + \\delta I_{i-1})^{-1} \\mathbf{a}_{21} $$\n令 $M(\\delta) = A_{11} + \\delta I_{i-1}$。关于 $\\delta$ 求导：\n$$ 2 L_{ii}(\\delta) L_{ii}'(\\delta) = 1 - \\mathbf{a}_{21}^{\\top} \\frac{d}{d\\delta}(M(\\delta)^{-1}) \\mathbf{a}_{21} $$\n使用恒等式 $\\frac{d}{d\\delta}(M^{-1}) = -M^{-1} (\\frac{dM}{d\\delta}) M^{-1}$ 并注意到 $\\frac{dM}{d\\delta} = I_{i-1}$，我们得到：\n$$ \\frac{d}{d\\delta}(M(\\delta)^{-1}) = -M(\\delta)^{-2} $$\n将此代回：\n$$ 2 L_{ii}(\\delta) L_{ii}'(\\delta) = 1 - \\mathbf{a}_{21}^{\\top} (-M(\\delta)^{-2}) \\mathbf{a}_{21} = 1 + \\mathbf{a}_{21}^{\\top} M(\\delta)^{-2} \\mathbf{a}_{21} $$\n要使 $A_{\\delta}$ 为 SPD，其主子矩阵 $M(\\delta)$ 必须为 SPD。因此，其逆矩阵 $M(\\delta)^{-1}$ 及其逆的平方 $M(\\delta)^{-2} = (M(\\delta)^{-1})^{\\top} M(\\delta)^{-1}$ 也都是 SPD。因此，二次型 $\\mathbf{a}_{21}^{\\top} M(\\delta)^{-2} \\mathbf{a}_{21}$ 是非负的。这导致：\n$$ 2 L_{ii}(\\delta) L_{ii}'(\\delta) \\ge 1 $$\n由于 $L(\\delta)$ 具有严格正的对角元，$L_{ii}(\\delta) > 0$。因此，我们可以除以 $2L_{ii}(\\delta)$ 得到：\n$$ L_{ii}'(\\delta) = S_{ii}(\\delta) \\ge \\frac{1}{2 L_{ii}(\\delta)} > 0 $$\n这证明了每个 Cholesky 主元 $L_{ii}(\\delta)$ 都是关于 $\\delta$ 的严格递增函数。\n\n### 第 2 部分：算法设计\n\n目标是找到最小的非负移位 $\\delta_{\\min} \\ge 0$，使得对 $A_{\\delta_{\\min}} = A + \\delta_{\\min} I$ 的无分块 Cholesky 分解能够成功，并产生满足 $L_{ii} \\ge \\tau$ 的主元，其中 $\\tau > 0$ 是给定的阈值。\n\n1.  **二分法的合理性**：在第 1 部分中，我们证明了每个主元 $L_{ii}(\\delta)$ 都是关于 $\\delta$ 的严格递增函数。因此，最小主元 $g(\\delta) = \\min_i L_{ii}(\\delta)$ 是一个关于 $\\delta$ 的连续非递减函数。我们正在寻找最小的 $\\delta \\ge 0$ 使得 $g(\\delta) \\ge \\tau$。这等价于找到单调函数 $f(\\delta) = g(\\delta) - \\tau = 0$ 的根。$f(\\delta)$ 的单调性使得该问题适合使用二分搜索，这种方法是稳健的，并且一旦找到一个满足 $f(\\delta_{\\text{low}})  0$ 和 $f(\\delta_{\\text{high}}) \\ge 0$ 的限定区间 $[\\delta_{\\text{low}}, \\delta_{\\text{high}}]$，就保证收敛。\n\n2.  **崩溃处理**：对矩阵 $M$ 的无分块 Cholesky 递归涉及计算 $L_{jj} = \\sqrt{M_{jj} - \\sum_{k=1}^{j-1} L_{jk}^2}$。如果被开方数 $M_{jj} - \\sum_{k=1}^{j-1} L_{jk}^2$ 为非正数，则发生崩溃。我们的算法将实现一个显式检查此条件的 Cholesky 分解例程。崩溃被视为未能满足主元阈值，需要一个更大的 $\\delta$。\n\n3.  **算法**：\n    a. 首先，尝试对 $\\delta=0$ 进行 Cholesky 分解。如果成功且所有主元都 $\\ge \\tau$，则 $\\delta_{\\min}=0$ 是解。\n    b. 否则，我们知道 $\\delta_{\\min}>0$。我们建立一个搜索区间 $[\\delta_{\\text{low}}, \\delta_{\\text{high}}]$。设置 $\\delta_{\\text{low}}=0$。\n    c. 通过扩展搜索找到一个上界 $\\delta_{\\text{high}}$。从一个猜测开始，例如 $\\delta_{\\text{high}} = \\tau$，并重复地将其加倍（$\\delta_{\\text{high}} \\leftarrow 2\\delta_{\\text{high}}$），直到对 $A+\\delta_{\\text{high}}I$ 的 Cholesky 分解成功并且所有主元都 $\\ge \\tau$。这保证会终止，因为当 $\\delta \\to \\infty$ 时，$A+\\delta I \\approx \\delta I$，其主元 $\\sqrt{\\delta}$ 最终将超过任何有限的 $\\tau$。\n    d. 建立区间 $[\\delta_{\\text{low}}, \\delta_{\\text{high}}]$ 后，执行二分搜索。在每次迭代中，计算 $\\delta_{\\text{mid}} = \\delta_{\\text{low}} + 0.5(\\delta_{\\text{high}} - \\delta_{\\text{low}})$。尝试对 $A+\\delta_{\\text{mid}}I$ 进行 Cholesky 分解。\n        - 如果成功且主元 $\\ge \\tau$，这意味着 $\\delta_{\\text{mid}}$ 是一个有效（但可能不是最小）的移位。我们更新区间以搜索更小的移位：$\\delta_{\\text{high}} \\leftarrow \\delta_{\\text{mid}}$。\n        - 如果失败或主元条件未满足，则 $\\delta_{\\text{mid}}$ 太小。我们更新：$\\delta_{\\text{low}} \\leftarrow \\delta_{\\text{mid}}$。\n    e. 最终解是 $\\delta_{\\text{high}}$。此值是在容差范围内找到的最小移位，对于该移位，在浮点运算中计算的分解满足主元条件。\n\n4.  **终止与容差**：当区间宽度 $\\delta_{high} - \\delta_{low}$ 小于预设的绝对容差 $\\varepsilon_{\\delta} > 0$ 时，二分法终止。在双精度算术中，为 $\\varepsilon_{\\delta}$ 选择一个小数（如 $10^{-12}$）是合理的。所需的迭代次数与初始区间宽度和容差呈对数关系，保证了有限次终止。", "answer": "```python\nimport numpy as np\n\ndef _attempt_cholesky(matrix):\n    \"\"\"\n    Performs an unblocked Cholesky factorization M = LL^T.\n    Returns (L, min_pivot) on success, or (None, -1.0) on breakdown.\n    A breakdown occurs if a non-positive radicand is encountered.\n    \"\"\"\n    n = matrix.shape[0]\n    L = np.zeros_like(matrix, dtype=np.float64)\n\n    for j in range(n):\n        # Calculate sum for the diagonal element L[j, j]\n        s_diag = np.dot(L[j, :j], L[j, :j])\n        \n        radicand = matrix[j, j] - s_diag\n        if radicand = 0:\n            return None, -1.0  # Breakdown\n\n        l_jj = np.sqrt(radicand)\n        L[j, j] = l_jj\n\n        # Calculate elements in the j-th column below the diagonal\n        for i in range(j + 1, n):\n            s_offdiag = np.dot(L[i, :j], L[j, :j])\n            L[i, j] = (matrix[i, j] - s_offdiag) / l_jj\n\n    min_pivot = np.min(np.diag(L))\n    return L, min_pivot\n\ndef find_min_shift(A, tau, eps_delta=1e-12, max_iter=100):\n    \"\"\"\n    Finds the minimal non-negative shift delta such that A + delta*I has a \n    Cholesky factorization with all pivots >= tau.\n    \"\"\"\n    n = A.shape[0]\n    I = np.identity(n)\n\n    # 1. Check if delta = 0 works\n    L_0, min_pivot_0 = _attempt_cholesky(A)\n    if L_0 is not None and min_pivot_0 >= tau:\n        return 0.0\n\n    # 2. Bracket the solution: find delta_high\n    delta_low = 0.0\n    # Initial guess for the upper bound. Expand until it works.\n    delta_high = tau \n    if delta_high == 0.0:  # Handle tau=0 case, though problem states tau > 0\n        delta_high = 1e-6\n    \n    for _ in range(max_iter):\n        L_h, min_pivot_h = _attempt_cholesky(A + delta_high * I)\n        if L_h is not None and min_pivot_h >= tau:\n            break  # Found a valid upper bound\n        delta_high *= 2.0\n    else:\n        # This safeguard should not be triggered for valid inputs\n        raise RuntimeError(\"Failed to find an upper bound for delta.\")\n\n    # 3. Bisection search for the minimal delta\n    for _ in range(max_iter):\n        if delta_high - delta_low  eps_delta:\n            break\n        \n        delta_mid = delta_low + 0.5 * (delta_high - delta_low)\n        if delta_mid == delta_low or delta_mid == delta_high: # Stagnation\n            break\n\n        L_mid, min_pivot_mid = _attempt_cholesky(A + delta_mid * I)\n\n        if L_mid is not None and min_pivot_mid >= tau:\n            # delta_mid is a potential solution, try for smaller\n            delta_high = delta_mid\n        else:\n            # delta_mid is too small\n            delta_low = delta_mid\n    \n    return delta_high\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        (np.array([[4, 1, 0], [1, 3, 0.5], [0, 0.5, 2]], dtype=np.float64), 1.0),\n        (np.diag([1e-8, 1, 2]).astype(np.float64), 1e-3),\n        (np.array([[0, 1], [1, 0]], dtype=np.float64), 0.1),\n        (np.diag([0, 2, 3]).astype(np.float64), 0.5)\n    ]\n    \n    results = []\n    for A, tau in test_cases:\n        delta = find_min_shift(A, tau)\n        results.append(delta)\n    \n    # Format the final output string exactly as required\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3537154"}]}