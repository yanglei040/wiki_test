{"hands_on_practices": [{"introduction": "在深入研究有限精度算术带来的复杂性之前，我们必须首先掌握理想化的理论基础。这个练习通过一个具体的例子，要求你手动执行Lanczos迭代的每一步，以此来巩固其核心的三项递推关系以及在精确算术下完美的正交性是如何得以维持的[@problem_id:3557380]。这种基础性的笔算练习对于理解后续数值误差如何破坏这一理想结构至关重要。", "problem": "考虑从一个单位向量开始，将 Lanczos 迭代应用于一个实对称矩阵。由矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 和初始向量 $q_{1} \\in \\mathbb{R}^{n}$ 生成的 $k$ 阶 Krylov 子空间定义为 $K_{k}(A,q_{1})=\\operatorname{span}\\{q_{1},A q_{1},A^{2} q_{1},\\dots,A^{k-1} q_{1}\\}$。我们需要寻找 $K_{k}(A,q_{1})$ 的一个标准正交基 $\\{q_{1},\\dots,q_{k}\\}$，使得 $A$ 在此基下的表示 $T_{k} = Q_{k}^{\\top} A Q_{k}$（其中 $Q_{k} = [q_{1}\\ \\cdots\\ q_{k}] \\in \\mathbb{R}^{n \\times k}$）是一个对称三对角矩阵。在精确算术中，此构造依赖于对称性和正交投影性质，而非数值启发式方法。\n\n给定 $A \\in \\mathbb{R}^{4 \\times 4}$ 和 $q_{1} \\in \\mathbb{R}^{4}$ 如下\n$$\nA = \\begin{pmatrix}\n2  1  0  0 \\\\\n1  2  1  0 \\\\\n0  1  2  1 \\\\\n0  0  1  2\n\\end{pmatrix}, \\qquad\nq_{1} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n使用精确算术，并从 Krylov 子空间的定义以及标准正交基产生对称三对角投影的要求出发，推导构建 Lanczos 向量和标量所需的三项递推关系，执行四步 Lanczos 迭代以获得 $q_{2}$、$q_{3}$、$q_{4}$ 以及标量 $\\alpha_{1}、\\alpha_{2}、\\alpha_{3}、\\alpha_{4}$ 和 $\\beta_{2}、\\beta_{3}、\\beta_{4}$。构造 $Q_{4}=[q_{1}\\ q_{2}\\ q_{3}\\ q_{4}]$ 和 $T_{4} = Q_{4}^{\\top} A Q_{4}$，并精确验证 $Q_{4}^{\\top} Q_{4} = I$ 和 $Q_{4}^{\\top} A Q_{4} = T_{4}$。\n\n最后，计算诊断量\n$$\nD \\;=\\; \\|Q_{4}^{\\top} Q_{4} - I\\|_{F} \\;+\\; \\|Q_{4}^{\\top} A Q_{4} - T_{4}\\|_{F},\n$$\n其中 $\\|\\cdot\\|_{F}$ 表示 Frobenius 范数，并给出其精确值。无需舍入。", "solution": "在尝试任何解答之前，需对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n- 矩阵 $A \\in \\mathbb{R}^{4 \\times 4}$:\n$$\nA = \\begin{pmatrix}\n2  1  0  0 \\\\\n1  2  1  0 \\\\\n0  1  2  1 \\\\\n0  0  1  2\n\\end{pmatrix}\n$$\n- 初始向量 $q_{1} \\in \\mathbb{R}^{4}$:\n$$\nq_{1} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n- Krylov 子空间定义：$K_{k}(A,q_{1})=\\operatorname{span}\\{q_{1},A q_{1},A^{2} q_{1},\\dots,A^{k-1} q_{1}\\}$。\n- 标准正交基：$\\{q_{1},\\dots,q_{k}\\}$ for $K_{k}(A,q_{1})$。\n- 标准正交矩阵：$Q_{k} = [q_{1}\\ \\cdots\\ q_{k}] \\in \\mathbb{R}^{n \\times k}$。\n- 三对角投影：$T_{k} = Q_{k}^{\\top} A Q_{k}$。\n- 约束条件：$T_k$ 必须是对称三对角矩阵，且算术是精确的。\n- 任务：\n    1. 推导 Lanczos 迭代的三项递推关系。\n    2. 执行四步 Lanczos 迭代以找到 $q_{2}、q_{3}、q_{4}$ 以及标量 $\\alpha_{1}、\\alpha_{2}、\\alpha_{3}、\\alpha_{4}$ 和 $\\beta_{2}、\\beta_{3}、\\beta_{4}$。\n    3. 构造 $Q_{4}$ 和 $T_{4}$。\n    4. 验证 $Q_{4}^{\\top} Q_{4} = I$ 和 $Q_{4}^{\\top} A Q_{4} = T_{4}$。\n    5. 计算诊断量 $D = \\|Q_{4}^{\\top} Q_{4} - I\\|_{F} + \\|Q_{4}^{\\top} A Q_{4} - T_{4}\\|_{F}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题是数值线性代数中的一个标准练习，重点是 Lanczos 算法。其概念、矩阵和初始向量都是该主题下的标准内容，且十分贴切。\n- **适定性**：该问题是适定的。对于给定的对称矩阵和起始向量，Lanczos 算法产生唯一的向量和标量序列（在符号约定标准化的前提下）。任务具体，并能得出一个唯一、可验证的结果。\n- **客观性**：问题以精确、客观的数学语言陈述。\n- **完整性与一致性**：所有必要的数据（$A$、$q_{1}$）和定义均已提供。不存在矛盾之处。\n- **可行性与现实性**：该问题是在精确算术下的理论计算，对于所给的小矩阵而言是完全可行的。\n\n### 步骤 3：结论与行动\n问题有效。将提供解答。\n\n### 三项递推关系的推导\n\nLanczos 算法为 Krylov 子空间 $K_k(A, q_1)$ 构建一个标准正交基 $\\{q_1, q_2, \\dots, q_k\\}$。矩阵 $Q_k = [q_1 \\ \\dots \\ q_k]$ 的列是标准正交的，因此 $Q_k^\\top Q_k = I_k$。$A$ 在此基上的投影为 $T_k = Q_k^\\top A Q_k$。对于对称矩阵 $A$，$T_k$ 是对称三对角矩阵。\n\n关系式 $Q_k^\\top A Q_k = T_k$ 可以重写为 $A Q_k = Q_k T_k$。然而，Krylov 子空间 $K_k(A, q_1)$ 通常不是 $A$ 的一个不变子空间，因此 $A Q_k$ 会有一个分量在 $Q_k$ 的张成空间之外。完整的 Lanczos 关系由下式给出：\n$$AQ_k = Q_k T_k + r_k e_k^\\top$$\n其中 $r_k$ 是一个与 $K_k$ 正交的残差向量，$e_k$ 是 $\\mathbb{R}^k$ 中的第 $k$ 个标准基向量。残差写为 $r_k = \\beta_{k+1} q_{k+1}$。这给出了关系式：\n$$A Q_k = Q_k T_k + \\beta_{k+1} q_{k+1} e_k^\\top$$\n我们来考察当 $j  k$ 时此矩阵方程的第 $j$ 列：\n$$A q_j = (Q_k T_k)_j = \\sum_{i=1}^k q_i (T_k)_{ij}$$\n由于 $T_k$ 是对称三对角矩阵，其第 $j$ 列仅在位置 $j-1$、$j$ 和 $j+1$ 处有非零项：$(T_k)_{j-1,j} = \\beta_j$，$(T_k)_{jj} = \\alpha_j$，以及 $(T_k)_{j+1,j} = \\beta_{j+1}$。由此得出：\n$$A q_j = \\beta_j q_{j-1} + \\alpha_j q_j + \\beta_{j+1} q_{j+1}$$\n其中我们定义 $q_0=0$ 和 $\\beta_1=0$。这就是基本的三项递推关系。\n\n为确定标量 $\\alpha_j$ 和 $\\beta_{j+1}$，我们利用向量 $q_i$ 的标准正交性。将递推式与 $q_j$ 作内积：\n$$q_j^\\top A q_j = q_j^\\top(\\beta_j q_{j-1} + \\alpha_j q_j + \\beta_{j+1} q_{j+1})$$\n$$q_j^\\top A q_j = \\beta_j q_j^\\top q_{j-1} + \\alpha_j q_j^\\top q_j + \\beta_{j+1} q_j^\\top q_{j+1}$$\n利用 $q_j^\\top q_{j-1} = 0$ 和 $q_j^\\top q_j = 1$，我们得到 $\\alpha_j$ 的公式：\n$$\\alpha_j = q_j^\\top A q_j$$\n为找到 $\\beta_{j+1}$，我们重排递推关系以定义一个残差向量 $r_j$：\n$$r_j = \\beta_{j+1} q_{j+1} = A q_j - \\alpha_j q_j - \\beta_j q_{j-1}$$\n此残差的模 $\\beta_{j+1}$ 的选择是为了确保 $q_{j+1}$ 是一个单位向量：\n$$\\beta_{j+1} = \\|r_j\\|_2 = \\| A q_j - \\alpha_j q_j - \\beta_j q_{j-1} \\|_2$$\n那么下一个 Lanczos 向量是 $q_{j+1} = r_j / \\beta_{j+1}$，前提是 $\\beta_{j+1} \\neq 0$。如果 $\\beta_{j+1} = 0$，算法终止。\n\n### 执行 Lanczos 迭代\n\n给定 $A$ 和 $q_1$。我们初始化 $\\beta_1 = 0$ 和 $q_0 = \\mathbf{0}$。\n\n**步骤 $j=1$**：\n- 计算 $v_1 = A q_1$：\n$$v_1 = \\begin{pmatrix} 2  1  0  0 \\\\ 1  2  1  0 \\\\ 0  1  2  1 \\\\ 0  0  1  2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$$\n- 计算 $\\alpha_1 = q_1^\\top v_1$：\n$$\\alpha_1 = \\begin{pmatrix} 1  0  0  0 \\end{pmatrix} \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = 2$$\n- 计算 $r_1 = v_1 - \\alpha_1 q_1 - \\beta_1 q_0$：\n$$r_1 = \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} - 2 \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} - 0 \\cdot \\mathbf{0} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$$\n- 计算 $\\beta_2 = \\|r_1\\|_2 = \\sqrt{0^2+1^2+0^2+0^2} = 1$。\n- 计算 $q_2 = r_1 / \\beta_2$：\n$$q_2 = \\frac{1}{1} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$$\n\n**步骤 $j=2$**：\n- 计算 $v_2 = A q_2$：\n$$v_2 = \\begin{pmatrix} 2  1  0  0 \\\\ 1  2  1  0 \\\\ 0  1  2  1 \\\\ 0  0  1  2 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 2 \\\\ 1 \\\\ 0 \\end{pmatrix}$$\n- 计算 $\\alpha_2 = q_2^\\top v_2$：\n$$\\alpha_2 = \\begin{pmatrix} 0  1  0  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\\\ 1 \\\\ 0 \\end{pmatrix} = 2$$\n- 计算 $r_2 = v_2 - \\alpha_2 q_2 - \\beta_2 q_1$：\n$$r_2 = \\begin{pmatrix} 1 \\\\ 2 \\\\ 1 \\\\ 0 \\end{pmatrix} - 2 \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} - 1 \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$$\n- 计算 $\\beta_3 = \\|r_2\\|_2 = \\sqrt{0^2+0^2+1^2+0^2} = 1$。\n- 计算 $q_3 = r_2 / \\beta_3$：\n$$q_3 = \\frac{1}{1} \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$$\n\n**步骤 $j=3$**：\n- 计算 $v_3 = A q_3$：\n$$v_3 = \\begin{pmatrix} 2  1  0  0 \\\\ 1  2  1  0 \\\\ 0  1  2  1 \\\\ 0  0  1  2 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 2 \\\\ 1 \\end{pmatrix}$$\n- 计算 $\\alpha_3 = q_3^\\top v_3$：\n$$\\alpha_3 = \\begin{pmatrix} 0  0  1  0 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\\\ 2 \\\\ 1 \\end{pmatrix} = 2$$\n- 计算 $r_3 = v_3 - \\alpha_3 q_3 - \\beta_3 q_2$：\n$$r_3 = \\begin{pmatrix} 0 \\\\ 1 \\\\ 2 \\\\ 1 \\end{pmatrix} - 2 \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix} - 1 \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix}$$\n- 计算 $\\beta_4 = \\|r_3\\|_2 = \\sqrt{0^2+0^2+0^2+1^2} = 1$。\n- 计算 $q_4 = r_3 / \\beta_4$：\n$$q_4 = \\frac{1}{1} \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix}$$\n\n**步骤 $j=4$**：\n- 计算 $v_4 = A q_4$：\n$$v_4 = \\begin{pmatrix} 2  1  0  0 \\\\ 1  2  1  0 \\\\ 0  1  2  1 \\\\ 0  0  1  2 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 2 \\end{pmatrix}$$\n- 计算 $\\alpha_4 = q_4^\\top v_4$：\n$$\\alpha_4 = \\begin{pmatrix} 0  0  0  1 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 2 \\end{pmatrix} = 2$$\n- 计算 $r_4 = v_4 - \\alpha_4 q_4 - \\beta_4 q_3$：\n$$r_4 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 2 \\end{pmatrix} - 2 \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix} - 1 \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$$\n- 计算 $\\beta_5 = \\|r_4\\|_2 = 0$。迭代终止。\n\n计算出的标量为：$\\alpha_1=2, \\alpha_2=2, \\alpha_3=2, \\alpha_4=2$ 和 $\\beta_2=1, \\beta_3=1, \\beta_4=1$。\nLanczos 向量为：$q_1=e_1, q_2=e_2, q_3=e_3, q_4=e_4$。\n\n### $Q_4$ 和 $T_4$ 的构造\n\n矩阵 $Q_4$ 由 Lanczos 向量构成：\n$$Q_4 = [q_1 \\ q_2 \\ q_3 \\ q_4] = \\begin{pmatrix} 1  0  0  0 \\\\ 0  1  0  0 \\\\ 0  0  1  0 \\\\ 0  0  0  1 \\end{pmatrix} = I_4$$\n矩阵 $T_4$ 是由标量 $\\alpha$ 和 $\\beta$ 构成的对称三对角矩阵：\n$$T_4 = \\begin{pmatrix} \\alpha_1  \\beta_2  0  0 \\\\ \\beta_2  \\alpha_2  \\beta_3  0 \\\\ 0  \\beta_3  \\alpha_3  \\beta_4 \\\\ 0  0  \\beta_4  \\alpha_4 \\end{pmatrix} = \\begin{pmatrix} 2  1  0  0 \\\\ 1  2  1  0 \\\\ 0  1  2  1 \\\\ 0  0  1  2 \\end{pmatrix}$$\n我们观察到，在这种特定情况下，$T_4 = A$。\n\n### 验证\n\n我们必须验证 (1) $Q_4^\\top Q_4 = I$ 和 (2) $Q_4^\\top A Q_4 = T_4$。\n1.  由于 $Q_4 = I_4$，其转置为 $Q_4^\\top = I_4^\\top = I_4$。因此，\n    $$Q_4^\\top Q_4 = I_4 \\cdot I_4 = I_4$$\n    第一个恒等式得到验证。\n2.  使用 $Q_4 = I_4$，我们计算左侧：\n    $$Q_4^\\top A Q_4 = I_4^\\top A I_4 = I_4 A I_4 = A$$\n    根据我们的构造，右侧是 $T_4 = A$。因此，\n    $$A = A$$\n    第二个恒等式也得到验证。\n\n### 诊断量的计算\n\n诊断量为 $D = \\|Q_{4}^{\\top} Q_{4} - I\\|_{F} + \\|Q_{4}^{\\top} A Q_{4} - T_{4}\\|_{F}$。\n基于上述的精确验证：\n- 第一项是 $Q_4^\\top Q_4 - I = I_4 - I_4 = 0_{4 \\times 4}$，即 $4 \\times 4$ 的零矩阵。\n- 第二项是 $Q_4^\\top A Q_4 - T_4 = A - A = 0_{4 \\times 4}$。\n\n矩阵 $M$ 的 Frobenius 范数是 $\\|M\\|_F = \\sqrt{\\sum_{i,j} |M_{ij}|^2}$。对于零矩阵，此范数为 $0$。\n因此，\n$$D = \\|0_{4 \\times 4}\\|_{F} + \\|0_{4 \\times 4}\\|_{F} = 0 + 0 = 0$$\n诊断量的精确值为 $0$。这个结果是预料之中的，因为问题是在精确算术下执行的，其中 Lanczos 算法的理论性质完全成立。诊断量 $D$ 旨在衡量正交性的损失和投影的残差，在这个理想化的背景下它们均为零。", "answer": "$$\n\\boxed{0}\n$$", "id": "3557380"}, {"introduction": "理论与现实之间的鸿沟源于有限精度。这个动手编程练习将带你直面Lanczos迭代中最关键的失效机制：当残差范数 $\\beta_k$ 变得极小（即“近乎奇异”或near-breakdown）时，正交性会发生灾难性的损失[@problem_id:3557387]。通过构建一个带有可控舍入模型的Lanczos迭代器，并精心设计具有微小 $\\beta_k$ 值的矩阵，你将能够亲眼观察并量化这一现象的发生。", "problem": "考虑一个实对称矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 和一个单位范数起始向量 $v_1 \\in \\mathbb{R}^n$ 的经典三项Lanczos迭代。在精确算術中，Lanczos基向量 $v_k$ 是相互正交的，直到残差范数 $\\beta_k = \\lVert r_k \\rVert_2$ 等于零时发生崩溃。在浮点算術中，计算步骤会经历舍入，Lanczos基可能会失去正交性。在本任务中，您将分析小的残差范数 $\\beta_k$（接近崩溃）如何与舍入相互作用，从而导致正交性的突然丧失。您将构造具有人为设计的接近崩溃的矩阵，并在受控的舍入模型下观察正交性的漂移。\n\n基本定义与精确算術中的迭代：\n- 令 $v_0 = 0$ 且 $\\beta_0 = 0$。对于 $k = 1, 2, \\dots$，定义\n$$\nw_k = A v_k - \\beta_{k-1} v_{k-1}, \\quad \\alpha_k = v_k^\\top w_k, \\quad r_k = w_k - \\alpha_k v_k, \\quad \\beta_k = \\lVert r_k \\rVert_2, \\quad v_{k+1} = \\frac{r_k}{\\beta_k} \\text{ if } \\beta_k \\neq 0.\n$$\n- 当前Lanczos基 $V_k = [v_1,\\dots,v_k]$ 的正交性由以下公式衡量\n$$\n\\Delta_k = \\lVert V_k^\\top V_k - I_k \\rVert_F,\n$$\n其中 $I_k$ 是 $k \\times k$ 单位矩阵，$\\lVert \\cdot \\rVert_F$ 表示弗罗贝尼乌斯范数。\n\n模拟有限精度的舍入模型：\n- 在每次计算标量或向量（$w_k$, $\\alpha_k$, $r_k$, $\\beta_k$, $v_{k+1}$）之后，应用舍入到 $s$ 位有效十进制数字。对于一个非零标量 $x$，其舍入后的版本表示为\n$$\n\\mathrm{round}_s(x) = \\mathrm{round}\\left(x, \\; s - 1 - \\left\\lfloor \\log_{10} |x| \\right\\rfloor \\right),\n$$\n其中 $\\mathrm{round}(x, d)$ 将 $x$ 舍入到 $d$ 位小数。对于向量和矩阵的元素，逐元素应用相同的有效数字规则。等于 $0$ 的元素保持为 $0$。\n\n通过三对角矩阵构造接近崩溃的情况：\n- 如果 $A$ 是一个对角线元素为 $\\alpha_1,\\dots,\\alpha_n$、次对角线元素为 $\\beta_1,\\dots,\\beta_{n-1}$ 的三对角矩阵，且起始向量为 $v_1 = e_1$（第一个标准基向量），那么在精确算術中，只要 $\\beta_k \\neq 0$，Lanczos迭代就会恢复由 $A$ 的元素定义的 $\\alpha_k$ 和 $\\beta_k$，并生成 $v_k = e_k$。\n- 因此，为了在特定迭代中构造接近崩溃的情况，可以选择一个对称三对角矩阵 $A$，使其在选定的索引处的次对角线元素 $\\beta_k$ 很小。\n\n您的程序必须：\n1. 实现上述舍入模型的经典Lanczos迭代，从 $v_1 = e_1$ 开始，并使用一个对称三对角输入矩阵 $A$。\n2. 在每次迭代 $k$ 中，累积正交性漂移 $\\Delta_k$ 并报告在所执行的迭代中的最大值 $\\max_{1 \\le k \\le m} \\Delta_k$，其中 $m$ 是预期的迭代次数（如果 $\\beta_k$ 被舍入为零或变得小于避免除以极小数的安全阈值，则迭代可能提前终止）。\n3. 使用以下测试套件，每个套件由 $(n, \\{\\alpha_i\\}_{i=1}^n, \\{\\beta_i\\}_{i=1}^{n-1}, s, m)$ 指定：\n   - 测试 1（基准，无接近崩溃）：\n     - $n = 40$\n     - 对所有 $i = 1,\\dots,40$，$\\alpha_i = 0$\n     - 对所有 $i = 1,\\dots,39$，$\\beta_i = 1$\n     - $s = 14$\n     - $m = 40$\n   - 测试 2（单个轻微的接近崩溃）：\n     - $n = 40$\n     - 对所有 $i = 1,\\dots,40$，$\\alpha_i = 0$\n     - 对所有 $i \\in \\{1,\\dots,39\\}$，$\\beta_i = 1$，除了 $\\beta_{25} = 10^{-8}$\n     - $s = 8$\n     - $m = 40$\n   - 测试 3（多个严重的接近崩溃）：\n     - $n = 50$\n     - 对所有 $i = 1,\\dots,50$，$\\alpha_i = 0$\n     - 对所有 $i \\in \\{1,\\dots,49\\}$，$\\beta_i = 1$，除了 $\\beta_{10} = \\beta_{20} = \\beta_{30} = \\beta_{40} = 10^{-12}$\n     - $s = 10$\n     - $m = 50$\n   - 测试 4（早期的接近崩溃边界）：\n     - $n = 30$\n     - 对所有 $i = 1,\\dots,30$，$\\alpha_i = 0$\n     - 对所有 $i \\in \\{2,\\dots,29\\}$，$\\beta_i = 1$，且 $\\beta_{1} = 10^{-16}$\n     - $s = 8$\n     - $m = 30$\n\n终止的安全规则：\n- 如果舍入后的残差范数 $\\beta_k$ 等于 $0$ 或其绝对值小于 $10^{-s}$，则终止迭代，并计算截至该点生成的所有向量的最大正交性漂移。\n\n最终输出要求：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个测试用例对应一个浮点数，按上述顺序排列。例如，它应输出\n$$\n[\\delta_1,\\delta_2,\\delta_3,\\delta_4]\n$$\n其中 $\\delta_j$ 是为测试 $j$ 观察到的最大正交性漂移 $\\max_k \\Delta_k$。", "solution": "此问题要求分析Lanczos迭代在模拟有限精度算術的特定舍入模型下正交性的损失。我们通过构造具有人为设计的接近崩溃情况的对称三对角矩阵来探索这一现象，已知这种情况会加剧正交性损失。\n\n### 基本原理\n\n**精确算術中的Lanczos迭代**\n经典Lanczos算法是一种迭代方法，用于寻找大型对称矩阵 $A$ 的特征值和特征向量，或更广泛地，为克雷洛夫子空间构造一个正交基。从一个单位范数向量 $v_1$ 开始，该迭代生成一个向量序列 $v_1, v_2, \\dots, v_m$ 和两个标量序列 $\\alpha_1, \\dots, \\alpha_m$ 和 $\\beta_1, \\dots, \\beta_{m-1}$。核心迭代步骤定义为：\n$$\n\\beta_k v_{k+1} = A v_k - \\alpha_k v_k - \\beta_{k-1} v_{k-1}\n$$\n其中 $\\alpha_k = v_k^\\top A v_k$ 且 $\\beta_k = \\lVert A v_k - \\alpha_k v_k - \\beta_{k-1} v_{k-1} \\rVert_2$。这些关系可以总结为矩阵形式：\n$$\nA V_k = V_k T_k + r_k e_k^\\top\n$$\n这里，$V_k = [v_1, v_2, \\dots, v_k]$ 是Lanczos向量组成的矩阵，$T_k$ 是一个对称三对角矩阵，其对角线元素为 $\\{\\alpha_i\\}_{i=1}^k$，次对角线元素为 $\\{\\beta_i\\}_{i=1}^{k-1}$，$r_k$ 是第 $k$ 步的残差向量，$e_k$ 是大小为 $k$ 的第 $k$ 个标准基向量。在精确算術中，Lanczos向量是相互正交的，即 $V_k^\\top V_k = I_k$，其中 $I_k$ 是 $k \\times k$ 单位矩阵。如果对于某个 $k  n$，$\\beta_k = 0$，则迭代终止，这表明已找到一个不变子空间。\n\n**有限精度中的正交性损失**\n在浮点算術的实际计算中，每一步都会引入舍入误差。我们将计算出的量用帽子符号表示，例如 $\\hat{v}_k$。严格的正交性会丢失，即 $\\hat{V}_k^\\top \\hat{V}_k \\neq I_k$。C. C. Paige 的开创性工作表明，正交性的损失并非随机，而是遵循特定模式。向量 $\\hat{v}_i$ 和 $\\hat{v}_j$ 之间的正交性会保持得很好，直到三对角矩阵 $T_k$ 的一个特征值（称为里兹值）收敛到原始矩阵 $A$ 的一个特征值。\n\n这种收敛的信号是一个非常小的残差范数，$\\beta_k \\approx 0$。这种情况被称为接近崩溃。当 $\\beta_k$ 很小时，计算下一个向量的归一化步骤 $\\hat{v}_{k+1} = \\hat{r}_k / \\hat{\\beta}_k$ 在数值上变得不稳定。分子 $\\hat{r}_k$ 包含了先前步骤累积的舍入误差。将这些误差除以一个非常小的 $\\hat{\\beta}_k$ 会极大地放大它们，导致得到的向量 $\\hat{v}_{k+1}$ 在先前的Lanczos向量方向上具有显著分量，从而破坏了正交性。正交性损失的程度，由 $\\lVert \\hat{V}_k^\\top \\hat{V}_k - I_k \\rVert$ 衡量，对于某个 $j  k$ 近似与 $\\epsilon / \\beta_{j}$ 成正比，其中 $\\epsilon$ 是机器精度。\n\n**问题的实验设计**\n此问题旨在直接展示这一原理。\n1.  **人为构造的崩溃**：通过选择矩阵 $A$ 为对称三对角矩阵并以 $v_1 = e_1$ 开始，Lanczos迭代在精确算術中会完美地恢复 $A$ 的对角线和次对角线元素作为 $\\alpha_k$ 和 $\\beta_k$ 系数。因此，我们可以通过将 $A$ 的特定次对角线元素设置为非常小的值来人为地构造接近崩溃的情况。\n2.  **受控舍入**：引入一个舍入模型来模拟具有 $s$ 位有效十进制数字的有限精度算術。这使得有效机器精度 $\\epsilon$ 约为 $10^{-s}$。\n3.  **观察**：我们使用弗罗贝尼乌斯范数 $\\Delta_k = \\lVert V_k^\\top V_k - I_k \\rVert_F$ 来衡量正交性损失。我们预期在一次迭代 $j$ 之后，如果人为设计的 $\\beta_j$ 的数量级与有效精度 $10^{-s}$ 相似或更小，$\\Delta_k$ 会急剧增加。\n\n### 算法实现\n\n解决方案涉及实现带有指定舍入模型的Lanczos迭代，该模型在每次算術运算后应用。\n```python\nimport numpy as np\nimport math\n\ndef round_scalar(x, s):\n    \"\"\"\n    Rounds a scalar x to s significant decimal digits.\n    \"\"\"\n    if x == 0.0:\n        return 0.0\n    # Use a small epsilon to handle potential log10 of very small numbers\n    # close to machine precision limit, although not strictly needed for test cases.\n    if abs(x)  1e-300:\n        return 0.0\n    \n    d = s - 1 - math.floor(math.log10(abs(x)))\n    return round(x, int(d))\n\ndef round_array(arr, s):\n    \"\"\"\n    Rounds each element of a numpy array to s significant decimal digits.\n    \"\"\"\n    # Create an empty array to store results.\n    res = np.zeros_like(arr, dtype=float)\n    # Iterate through each element for individual rounding logic.\n    for i, x in np.ndenumerate(arr):\n        if x != 0:\n            res[i] = round_scalar(x, s)\n    return res\n\ndef run_lanczos_simulation(n, alpha_diag, beta_offdiag, s, m):\n    \"\"\"\n    Performs the Lanczos iteration with a specified rounding model.\n    \"\"\"\n    # 1. Construct the tridiagonal matrix A\n    A = np.diag(alpha_diag)\n    if n > 1:\n        A += np.diag(beta_offdiag, k=1) + np.diag(beta_offdiag, k=-1)\n\n    # 2. Define a helper function for rounding within this context\n    def round_s(value):\n        if isinstance(value, np.ndarray):\n            return round_array(value, s)\n        else:\n            return round_scalar(value, s)\n\n    # 3. Initialize Lanczos iteration state\n    v_curr = np.zeros(n)\n    v_curr[0] = 1.0\n    \n    v_prev = np.zeros(n)\n    beta_prev = 0.0\n    \n    lanczos_vectors = []\n    max_orthogonality_drift = 0.0\n\n    # 4. Main loop for k = 1, 2, ..., m\n    for k in range(1, m + 1):\n        lanczos_vectors.append(v_curr)\n        \n        # Measure orthogonality drift Delta_k\n        V_k = np.array(lanczos_vectors).T\n        I_k = np.identity(k)\n        orth_matrix_diff = V_k.T @ V_k - I_k\n        delta_k = np.linalg.norm(orth_matrix_diff, 'fro')\n        max_orthogonality_drift = max(max_orthogonality_drift, delta_k)\n        \n        # Check for termination by iteration count\n        if k == m:\n            break\n            \n        # Perform one step of the Lanczos iteration with rounding\n        w_unrounded = A @ v_curr - beta_prev * v_prev\n        w = round_s(w_unrounded)\n        \n        alpha_unrounded = v_curr.T @ w\n        alpha = round_s(alpha_unrounded)\n        \n        r_unrounded = w - alpha * v_curr\n        r = round_s(r_unrounded)\n        \n        beta_unrounded = np.linalg.norm(r)\n        beta = round_s(beta_unrounded)\n        \n        # Check for termination by small beta or zero beta\n        if beta == 0 or abs(beta)  10.0**(-s):\n            break\n            \n        v_next_unrounded = r / beta\n        v_next = round_s(v_next_unrounded)\n        \n        # Update state for the next iteration\n        v_prev = v_curr\n        v_curr = v_next\n        beta_prev = beta\n        \n    return max_orthogonality_drift\n```", "answer": "[2.12239452335198e-14,1.4142135501861572,1.1578135839958343e-10,0.0]", "id": "3557387"}, {"introduction": "观察并理解了问题之后，下一步是学习如何在实践中管理它。当一个计算出的Ritz对 $(\\theta_i, u_i)$ 看起来收敛时，我们如何能确定它确实是一个好的近似特征对呢？这个练习介绍了一种修正的残差上界，它将测得的正交性损失考虑在内，让你能够基于这些信息做出明智的、符合实际的决策，判断哪些计算结果足够可靠，可以被“锁定”为已收敛[@problem_id:3557372]。", "problem": "考虑一个对称矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 和经过 $k$ 步的 Lanczos 迭代，该迭代产生一个基 $\\hat{Q}_k \\in \\mathbb{R}^{n \\times k}$ 和一个三对角矩阵 $\\hat{T}_k \\in \\mathbb{R}^{k \\times k}$。在精确算术和完美的标准正交列下，Lanczos 关系为 $A Q_k = Q_k T_k + \\beta_k q_{k+1} e_k^{\\top}$，并且 $\\hat{T}_k$ 的里兹对 $(\\theta_i, y_i)$ 生成在 $\\operatorname{span}\\{Q_k\\}$ 中的里兹向量 $u_i = Q_k y_i$，其残差为 $r_i = A u_i - \\theta_i u_i$。然而，在有限精度舍入和正交性损失的情况下，与完美正交性的偏离可以通过格拉姆缺陷的谱范数来衡量：$\\delta := \\|\\hat{Q}_k^{\\top} \\hat{Q}_k - I\\|_2$。假设有以下测量值和数据可用：\n- Lanczos 迭代的步数为 $k = 4$，三对角矩阵 $\\hat{T}_4$ 为\n$$\n\\hat{T}_4 = \\begin{pmatrix}\n3  1  0  0 \\\\\n1  1  0.5  0 \\\\\n0  0.5  -2  0.8 \\\\\n0  0  0.8  5\n\\end{pmatrix}.\n$$\n- 正交性损失（格拉姆缺陷的谱范数）测量为 $\\delta = 3.0 \\times 10^{-12}$。\n- $A$ 的谱范数的一个先验界已知：$\\|A\\|_2 \\leq 20$。\n- 最后一个 Lanczos 递推系数测量为 $\\hat{\\beta}_4 = 5.0 \\times 10^{-8}$。\n- $\\hat{T}_4$ 的里兹对 $(\\theta_i, y_i)$ 经过数值计算并归一化，使得 $\\|y_i\\|_2 = 1$。最后一个分量的绝对值 $c_i := |e_4^{\\top} y_i|$ 为\n$$\nc_1 = 2.0 \\times 10^{-2}, \\quad c_2 = 4.5 \\times 10^{-1}, \\quad c_3 = 1.5 \\times 10^{-5}, \\quad c_4 = 9.0 \\times 10^{-1}.\n$$\n如果一个里兹对 $(\\theta_i, u_i)$ 的修正后残差范数上界最多为给定的容差 $\\tau = 1.0 \\times 10^{-8}$，则该里兹对可以被安全地锁定。\n\n仅使用基本定义和关于 Lanczos 迭代及里兹残差的经过充分检验的事实，推导一个 $\\|r_i\\|_2$ 的保守修正上界，该上界考虑了测量的正交性损失，并用 $\\hat{\\beta}_4$、$c_i$、$\\|A\\|_2$ 和 $\\delta$ 表示。然后，为每个 $i \\in \\{1,2,3,4\\}$ 评估此界，并确定哪些里兹对可以在容差 $\\tau$ 下被安全地锁定。最后，将可锁定的里兹对总数报告为一个整数，无需舍入。在适当时，所有中间数值量均以科学记数法表示。最终答案必须是单个数字。", "solution": "该问题是有效的。这是一个关于 Lanczos 迭代实际行为的数值线性代数中定义明确的问题。所有必要的数据都已提供，并且其科学背景是合理的。\n\n目标是推导出一个里兹对残差范数 $\\|r_i\\|_2$ 的修正上界，该上界考虑了计算出的 Lanczos 基 $\\hat{Q}_k$ 中的正交性损失，然后使用此界来确定有多少里兹对可以被视为收敛。\n\n首先，我们在有限精度 Lanczos 迭代中建立各量之间的关系。该过程生成一个基 $\\hat{Q}_k \\in \\mathbb{R}^{n \\times k}$ 和一个三对角矩阵 $\\hat{T}_k \\in \\mathbb{R}^{k \\times k}$，它们满足递推关系：\n$$ A \\hat{Q}_k = \\hat{Q}_k \\hat{T}_k + \\hat{\\beta}_k \\hat{q}_{k+1} e_k^{\\top} + F_k $$\n这里，$\\hat{q}_{k+1}$ 是下一个 Lanczos 向量，且 $\\|\\hat{q}_{k+1}\\|_2 = 1$，$\\hat{\\beta}_k$ 是递推系数，$F_k \\in \\mathbb{R}^{n \\times k}$ 是一个表示在第 $k$ 步累积的浮点误差的矩阵。\n\n一个里兹对 $(\\theta_i, \\hat{u}_i)$ 由 $\\hat{T}_k$ 的一个特征对 $(\\theta_i, y_i)$ 构成。里兹向量为 $\\hat{u}_i = \\hat{Q}_k y_i$，其中 $\\hat{T}_k y_i = \\theta_i y_i$ 且 $\\|y_i\\|_2=1$。相应的残差为 $r_i = A \\hat{u}_i - \\theta_i \\hat{u}_i$。\n\n为了找到 $r_i$ 的表达式，我们代入 $\\hat{u}_i = \\hat{Q}_k y_i$：\n$$ r_i = A(\\hat{Q}_k y_i) - \\theta_i(\\hat{Q}_k y_i) = (A \\hat{Q}_k) y_i - \\hat{Q}_k (\\theta_i y_i) $$\n使用 $A\\hat{Q}_k$ 的递推关系和属性 $\\hat{T}_k y_i = \\theta_i y_i$：\n$$ r_i = (\\hat{Q}_k \\hat{T}_k + \\hat{\\beta}_k \\hat{q}_{k+1} e_k^{\\top} + F_k) y_i - \\hat{Q}_k (\\hat{T}_k y_i) $$\n$$ r_i = \\hat{Q}_k (\\hat{T}_k y_i) + \\hat{\\beta}_k \\hat{q}_{k+1} (e_k^{\\top} y_i) + F_k y_i - \\hat{Q}_k (\\hat{T}_k y_i) $$\n$$ r_i = \\hat{\\beta}_k (e_k^{\\top} y_i) \\hat{q}_{k+1} + F_k y_i $$\n取 2-范数并应用三角不等式，我们得到残差范数的一个界：\n$$ \\|r_i\\|_2 = \\|\\hat{\\beta}_k (e_k^{\\top} y_i) \\hat{q}_{k+1} + F_k y_i\\|_2 \\leq |\\hat{\\beta}_k| |e_k^{\\top} y_i| \\|\\hat{q}_{k+1}\\|_2 + \\|F_k y_i\\|_2 $$\n鉴于 $\\|\\hat{q}_{k+1}\\|_2 = 1$、$\\|y_i\\|_2=1$ 并定义 $c_i = |e_k^{\\top} y_i|$，这可以简化为：\n$$ \\|r_i\\|_2 \\leq \\hat{\\beta}_k c_i + \\|F_k\\|_2 $$\n第一项 $\\hat{\\beta}_k c_i$ 表示精确算术中的残差范数。第二项 $\\|F_k\\|_2$ 是由于有限精度引起的修正。\n\n问题要求用 $\\delta = \\|\\hat{Q}_k^{\\top} \\hat{Q}_k - I\\|_2$ 和 $\\|A\\|_2$ 来表示这个界。C. C. Paige 关于 Lanczos 算法的基础性工作表明，正交性损失（由 $\\delta$ 量化）和误差项 $F_k$ 都源于在正交化步骤中累积的浮点误差。这两个量都与机器精度 $\\epsilon_M$ 和矩阵范数 $\\|A\\|_2$ 成比例。因此，在误差分析中，使用测量的正交性损失 $\\delta$ 作为总累积误差大小的代理是标准做法。一个简单、保守且物理上合理的误差项模型是 $\\|F_k\\|_2 \\approx \\|A\\|_2 \\delta$。这导致了所要求的保守修正残差范数上界，我们将其表示为 $B_i$：\n$$ B_i = \\hat{\\beta}_k c_i + \\|A\\|_2 \\delta $$\n\n对于 $k=4$，我们有以下给定值：\n- $\\hat{\\beta}_4 = 5.0 \\times 10^{-8}$\n- $\\|A\\|_2 \\leq 20$，因此为了得到一个保守的界，我们使用 $\\|A\\|_2 = 20$。\n- $\\delta = 3.0 \\times 10^{-12}$\n- $c_1 = 2.0 \\times 10^{-2}$\n- $c_2 = 4.5 \\times 10^{-1}$\n- $c_3 = 1.5 \\times 10^{-5}$\n- $c_4 = 9.0 \\times 10^{-1}$\n- 锁定容差为 $\\tau = 1.0 \\times 10^{-8}$。\n\n首先，我们计算所有界共有的修正项：\n$$ \\|A\\|_2 \\delta = 20 \\times (3.0 \\times 10^{-12}) = 60 \\times 10^{-12} = 6.0 \\times 10^{-11} $$\n\n现在，我们为每个里兹对评估界 $B_i$，并检查是否 $B_i \\leq \\tau$。\n\n对于 $i=1$：\n$$ B_1 = \\hat{\\beta}_4 c_1 + \\|A\\|_2 \\delta = (5.0 \\times 10^{-8})(2.0 \\times 10^{-2}) + 6.0 \\times 10^{-11} $$\n$$ B_1 = 1.0 \\times 10^{-9} + 6.0 \\times 10^{-11} = 1.0 \\times 10^{-9} + 0.06 \\times 10^{-9} = 1.06 \\times 10^{-9} $$\n由于 $1.06 \\times 10^{-9} \\leq 1.0 \\times 10^{-8}$，里兹对 1 可以被锁定。\n\n对于 $i=2$：\n$$ B_2 = \\hat{\\beta}_4 c_2 + \\|A\\|_2 \\delta = (5.0 \\times 10^{-8})(4.5 \\times 10^{-1}) + 6.0 \\times 10^{-11} $$\n$$ B_2 = 22.5 \\times 10^{-9} + 6.0 \\times 10^{-11} = 2.25 \\times 10^{-8} + 0.006 \\times 10^{-8} = 2.256 \\times 10^{-8} $$\n由于 $2.256 \\times 10^{-8} > 1.0 \\times 10^{-8}$，里兹对 2 不能被锁定。\n\n对于 $i=3$：\n$$ B_3 = \\hat{\\beta}_4 c_3 + \\|A\\|_2 \\delta = (5.0 \\times 10^{-8})(1.5 \\times 10^{-5}) + 6.0 \\times 10^{-11} $$\n$$ B_3 = 7.5 \\times 10^{-13} + 6.0 \\times 10^{-11} = 0.075 \\times 10^{-11} + 6.0 \\times 10^{-11} = 6.075 \\times 10^{-11} $$\n由于 $6.075 \\times 10^{-11} \\leq 1.0 \\times 10^{-8}$，里兹对 3 可以被锁定。\n\n对于 $i=4$：\n$$ B_4 = \\hat{\\beta}_4 c_4 + \\|A\\|_2 \\delta = (5.0 \\times 10^{-8})(9.0 \\times 10^{-1}) + 6.0 \\times 10^{-11} $$\n$$ B_4 = 45.0 \\times 10^{-9} + 6.0 \\times 10^{-11} = 4.5 \\times 10^{-8} + 0.006 \\times 10^{-8} = 4.506 \\times 10^{-8} $$\n由于 $4.506 \\times 10^{-8} > 1.0 \\times 10^{-8}$，里兹对 4 不能被锁定。\n\n可以被安全锁定的里兹对是第 1 对和第 3 对。可锁定的里兹对总数为 2。", "answer": "$$\n\\boxed{2}\n$$", "id": "3557372"}]}