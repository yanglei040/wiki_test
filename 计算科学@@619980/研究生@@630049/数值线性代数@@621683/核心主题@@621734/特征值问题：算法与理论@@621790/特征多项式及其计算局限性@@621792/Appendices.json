{"hands_on_practices": [{"introduction": "要理解为什么通过特征多项式计算特征值是不稳定的，我们必须探究矩阵的基本代数结构。本练习深入探讨了矩阵的若尔当（Jordan）范式、其特征多项式以及最小多项式之间的关系。通过分析一个具有重复特征值和非平凡若尔当块的矩阵 [@problem_id:3536789]，您将从第一性原理层面理解亏损矩阵（defective matrix）如何导致高重根的出现，而这正是数值病态问题的根源所在。", "problem": "设 $\\lambda_{0} \\in \\mathbb{R}$，并考虑一个大小为 $k$ 的若尔当块，定义为 $J_{k}(\\lambda_{0}) = \\lambda_{0} I_{k} + N_{k}$，其中 $I_{k}$ 是 $k \\times k$ 的单位矩阵，$N_{k}$ 是一个严格上三角矩阵，其第一超对角线上的元素为1，其余元素为0。定义 $5 \\times 5$ 矩阵\n$$\nA \\;=\\; \\operatorname{diag}\\!\\big(J_{3}(\\lambda_{0}),\\, J_{2}(\\lambda_{0})\\big).\n$$\n从以下基本定义出发：特征多项式 $p_{A}(\\lambda)$ 为 $p_{A}(\\lambda) = \\det(\\lambda I - A)$；最小多项式 $m_{A}(\\lambda)$ 是使得 $m_{A}(A) = 0$ 的次数最低的唯一首一多项式；矩阵 $N$ 是幂零的，如果对于某个正整数 $q$ 有 $N^{q} = 0$，其中最小的 $q$ 称为幂零指数。从这些定义推导 $m_{A}(\\lambda)$ 和 $p_{A}(\\lambda)$，并严格证明为什么一个特征值对应的最大若尔当块的大小决定了最小多项式中相应因子的指数，而代数重数决定了特征多项式中的指数。特别地，解释幂零部分 $N_{3}$ 和 $N_{2}$ 在确定 $m_{A}(\\lambda)$ 中 $(\\lambda - \\lambda_{0})$ 的指数时所起的作用，并说明为什么 $p_{A}(\\lambda)$ 中的重根在数值上是敏感的：仅使用数值线性代数中的标准事实，给出一个有理有据的论证，说明当存在重特征值时，通过系数确定法计算 $p_{A}(\\lambda)$ 是病态的，并且微小的扰动通常会改变若尔当结构，从而改变 $p_{A}(\\lambda)$ 根的重数，并可能改变 $m_{A}(\\lambda)$ 中的指数。\n\n将您的最终答案表示为上述矩阵 $A$ 的最小多项式 $m_{A}(\\lambda)$ 的显式闭合形式表达式。不要在最终答案中提供中间步骤。无需四舍五入。[@problem_id:48]", "solution": "首先验证该问题是自洽的、有科学依据且适定的。所有定义和前提都是线性代数和数值分析中的标准内容。矩阵 $A$ 被精确定义为 $A = \\operatorname{diag}(J_{3}(\\lambda_{0}),\\, J_{2}(\\lambda_{0}))$，其中 $J_{k}(\\lambda_{0})$ 是一个大小为 $k$、特征值为 $\\lambda_{0} \\in \\mathbb{R}$ 的若尔当块。任务是推导 $A$ 的特征多项式和最小多项式，解释若尔当结构与这些多项式之间的联系，并讨论其数值意义。该问题有效，我们开始求解。\n\n矩阵 $A$ 是一个 $5 \\times 5$ 的分块对角矩阵：\n$$\nA = \\begin{pmatrix} J_{3}(\\lambda_{0})  \\mathbf{0}_{3 \\times 2} \\\\ \\mathbf{0}_{2 \\times 3}  J_{2}(\\lambda_{0}) \\end{pmatrix}\n$$\n其中 $\\mathbf{0}_{m \\times n}$ 是 $m \\times n$ 的零矩阵，若尔当块定义为 $J_{k}(\\lambda_{0}) = \\lambda_{0} I_{k} + N_{k}$。具体而言，\n$$\nJ_{3}(\\lambda_{0}) = \\begin{pmatrix} \\lambda_{0}  1  0 \\\\ 0  \\lambda_{0}  1 \\\\ 0  0  \\lambda_{0} \\end{pmatrix} \\quad \\text{和} \\quad J_{2}(\\lambda_{0}) = \\begin{pmatrix} \\lambda_{0}  1 \\\\ 0  \\lambda_{0} \\end{pmatrix}.\n$$\n矩阵 $N_{3}$ 和 $N_{2}$ 是以下形式的幂零矩阵：\n$$\nN_3 = \\begin{pmatrix} 0  1  0 \\\\ 0  0  1 \\\\ 0  0  0 \\end{pmatrix} \\quad \\text{和} \\quad N_2 = \\begin{pmatrix} 0  1 \\\\ 0  0 \\end{pmatrix}.\n$$\n首先，我们从定义 $p_{A}(\\lambda) = \\det(\\lambda I - A)$ 推导特征多项式 $p_{A}(\\lambda)$。矩阵 $\\lambda I - A$ 也是一个分块对角矩阵：\n$$\n\\lambda I - A = \\begin{pmatrix} \\lambda I_3 - J_3(\\lambda_0)  \\mathbf{0}_{3 \\times 2} \\\\ \\mathbf{0}_{2 \\times 3}  \\lambda I_2 - J_2(\\lambda_0) \\end{pmatrix}.\n$$\n分块对角矩阵的行列式是其对角线上各分块行列式的乘积：\n$$\np_{A}(\\lambda) = \\det(\\lambda I_3 - J_3(\\lambda_0)) \\cdot \\det(\\lambda I_2 - J_2(\\lambda_0)).\n$$\n我们来分析单个分块 $\\lambda I_k - J_k(\\lambda_0)$:\n$$\n\\lambda I_k - J_k(\\lambda_0) = \\lambda I_k - (\\lambda_0 I_k + N_k) = (\\lambda - \\lambda_0) I_k - N_k.\n$$\n这是一个上三角矩阵，每个对角位置上的值都是 $(\\lambda - \\lambda_0)$。三角矩阵的行列式是其对角元素的乘积。因此，对于一个大小为 $k$ 的分块：\n$$\n\\det((\\lambda - \\lambda_0) I_k - N_k) = (\\lambda - \\lambda_0)^k.\n$$\n将此应用于我们的具体情况：\n$$\n\\det(\\lambda I_3 - J_3(\\lambda_0)) = (\\lambda - \\lambda_0)^3 \\quad \\text{和} \\quad \\det(\\lambda I_2 - J_2(\\lambda_0)) = (\\lambda - \\lambda_0)^2.\n$$\n因此，$A$ 的特征多项式为：\n$$\np_{A}(\\lambda) = (\\lambda - \\lambda_0)^3 \\cdot (\\lambda - \\lambda_0)^2 = (\\lambda - \\lambda_0)^5.\n$$\n这个推导过程说明了一个普遍原理：特征多项式中因子 $(\\lambda - \\lambda_i)$ 的指数是与特征值 $\\lambda_i$ 相关的所有若尔当块大小之和。根据定义，这个和就是 $\\lambda_i$ 的代数重数。对于矩阵 $A$，唯一的特征值是 $\\lambda_0$，其代数重数为 $3+2=5$。\n\n接下来，我们推导最小多项式 $m_{A}(\\lambda)$。根据凯莱-哈密顿定理 (Cayley-Hamilton theorem)，$p_{A}(A) = 0$，这意味着 $m_{A}(\\lambda)$ 必须整除 $p_{A}(\\lambda)$。由于 $p_{A}(\\lambda)$ 唯一的不可约因子是 $(\\lambda - \\lambda_0)$，最小多项式必定形如 $m_{A}(\\lambda) = (\\lambda - \\lambda_0)^q$，其中 $q$ 是某个满足 $1 \\le q \\le 5$ 的整数。根据定义，$m_{A}(\\lambda)$ 是使得 $m_{A}(A) = \\mathbf{0}$ 的次数最低的首一多项式。我们需要找到使得 $(A - \\lambda_0 I)^q = \\mathbf{0}$ 成立的最小正整数 $q$。\n\n我们来计算矩阵多项式 $(A - \\lambda_0 I)^q$：\n$$\nA - \\lambda_0 I = \\operatorname{diag}(J_3(\\lambda_0) - \\lambda_0 I_3, J_2(\\lambda_0) - \\lambda_0 I_2) = \\operatorname{diag}(N_3, N_2).\n$$\n将这个分块对角矩阵升到 $q$ 次幂得到：\n$$\n(A - \\lambda_0 I)^q = \\operatorname{diag}(N_3^q, N_2^q).\n$$\n该矩阵为零矩阵当且仅当 $N_3^q = \\mathbf{0}$ 和 $N_2^q = \\mathbf{0}$ 同时成立。\n我们需要确定 $N_k$ 的幂零指数，即使得 $N_k^j = \\mathbf{0}$ 的最小整数 $j$。对于一个大小为 $k$ 的标准幂零若尔当块 $N_k$，每次乘以自身，超对角线上的 1 会向上一条对角线移动。$N_k^j$ 的 1 在第 $j$ 条超对角线上。因此，$N_k^{k-1}$ 在右上角有一个 1，而 $N_k^k = \\mathbf{0}$。$N_k$ 的幂零指数为 $k$。\n对于我们的分块， $N_3$ 的幂零指数是 $3$，$N_2$ 的幂零指数是 $2$。\n条件 $N_3^q = \\mathbf{0}$ 要求 $q \\ge 3$。\n条件 $N_2^q = \\mathbf{0}$ 要求 $q \\ge 2$。\n要同时满足这两个条件，$q$ 必须大于或等于这些所需指数的最大值：$q \\ge \\max(3, 2) = 3$。最小多项式对应于最小的整数 $q$，因此 $q=3$。\n所以，$A$ 的最小多项式为：\n$$\nm_A(\\lambda) = (\\lambda - \\lambda_0)^3.\n$$\n这个推导过程严格证明了一般规则：最小多项式中因子 $(\\lambda - \\lambda_i)$ 的指数是与特征值 $\\lambda_i$ 相关的*最大*若尔当块的大小。幂零部分 $N_3$ 和 $N_2$ 在此过程中起核心作用。矩阵 $(A - \\lambda_0 I)$ 是幂零的，其幂零指数恰好是最小多项式的次数（减去任何其他不同特征值因子的次数，此处没有）。$\\operatorname{diag}(N_{k_1}, N_{k_2}, \\dots)$ 的幂零指数是 $\\max(k_1, k_2, \\dots)$，即最大分块的大小。$N_3$ 分块作为较大的一个，决定了最小多项式的次数，因为它的幂零性要求 ($q \\ge 3$) 是最严格的。\n\n最后，我们讨论通过特征多项式计算特征值的数值敏感性问题。通过先计算 $p_A(\\lambda) = \\sum_{i=0}^n c_i \\lambda^i$ 的系数，然后求其根来寻找特征值的过程，被认为是数值不稳定的，特别是当根具有高重数时。\n设 $p(\\lambda)$ 是一个多项式，它有一个重数为 $m > 1$ 的根 $\\lambda_0$。这个根对多项式系数扰动的敏感性很高。考虑对多项式的一个小扰动，$\\tilde{p}(\\lambda) = p(\\lambda) + \\epsilon g(\\lambda)$，其中 $\\epsilon$ 是一个很小的参数。$\\tilde{p}(\\lambda)$ 的根会从 $\\lambda_0$ 扰动到 $\\tilde{\\lambda}$。当 $\\lambda$ 接近 $\\lambda_0$ 时，我们可以近似认为 $p(\\lambda) \\approx C(\\lambda - \\lambda_0)^m$，其中 $C \\neq 0$ 是某个常数。扰动后根的方程是 $\\tilde{p}(\\tilde{\\lambda}) = C(\\tilde{\\lambda} - \\lambda_0)^m + \\epsilon g(\\tilde{\\lambda}) \\approx 0$。假设 $g(\\lambda_0) \\neq 0$，这得到 $(\\tilde{\\lambda} - \\lambda_0)^m \\approx -\\epsilon g(\\lambda_0)/C$。于是根的扰动量级为：\n$$\n|\\tilde{\\lambda} - \\lambda_0| \\approx \\left| \\frac{\\epsilon g(\\lambda_0)}{C} \\right|^{1/m} = O(\\epsilon^{1/m}).\n$$\n对于 $m>1$，指数 $1/m$ 小于 $1$。这意味着根的扰动 $O(\\epsilon^{1/m})$ 远大于系数的扰动 $O(\\epsilon)$。例如，如果 $m=5$ (就像我们的 $p_{A}(\\lambda)$ 的情况) 且 $\\epsilon=10^{-10}$，根的扰动量级为 $(10^{-10})^{1/5} = 10^{-2}$，误差被放大了 $10^8$ 倍。这种极端的敏感性是病态问题的标志。\n\n此外，对矩阵 $A$ 本身的微小扰动会对其代数结构产生深远影响。矩阵 $A$ 是亏损的，意味着它不可对角化。这是因为 $\\lambda_0$ 的几何重数（若尔当块的数量，为2）小于其代数重数（为5）。矩阵扰动理论的一个基本结果是，亏损矩阵不是“一般”情况。对 $A$ 的一个小的、任意的扰动 $E$，得到的 $A' = A + E$ 几乎必然会产生一个具有互异特征值的矩阵 $A'$。\n对于矩阵 $A$，一个范数很小的一般扰动 $E$ 将产生一个扰动矩阵 $A'$，它有5个互异的特征值 $\\lambda_1', \\dots, \\lambda_5'$，都与 $\\lambda_0$ 相距很近。若尔当结构被破坏了。$A$ 的若尔当标准型是 $\\operatorname{diag}(J_3(\\lambda_0), J_2(\\lambda_0))$。$A'$ 的若尔当标准型将是一个对角矩阵 $\\operatorname{diag}(\\lambda_1', \\dots, \\lambda_5')$，它由五个 $1 \\times 1$ 的若尔当块组成。\n这会急剧地改变特征多项式和最小多项式。特征多项式变为 $p_{A'}(\\lambda) = \\prod_{i=1}^5 (\\lambda - \\lambda_i')$，它有5个单根。对于可对角化矩阵，最小多项式是不同线性因子的乘积，因此最小多项式变为 $m_{A'}(\\lambda) = p_{A'}(\\lambda)$。最小多项式的次数从 $A$ 的 $3$ 次跃升到 $A'$ 的 $5$ 次。\n这种不稳定性——即无穷小扰动可以根本性地改变若尔当结构、根的重数以及最小多项式的次数——解释了为什么特征值的数值方法（如QR算法）被设计为直接处理矩阵，以避免形成特征多项式系数这个中间的病态步骤。它们通过迭代将矩阵转换为一种可以稳定读取特征值的形式（如上三角的舒尔分解 (Schur form) 形式）。", "answer": "$$\n\\boxed{(\\lambda - \\lambda_{0})^{3}}\n$$", "id": "3536789"}, {"introduction": "理论上的数学等价性在有限精度的浮点运算中往往会失效。本实践的核心原则是，正交变换能够保持数值稳定性（例如，保持范数和误差幅度），而一般的、病态的相似变换则可能灾难性地放大舍入误差。这个编码练习为数值线性代数的核心原则提供了直接的经验证据 [@problem_id:3536821]。通过亲手实现并比较一个稳定与一个不稳定的计算路径，您将亲眼见证理论上等价的计算在实践中会如何导致截然不同的结果，从而深刻理解选择数值稳定算法的至关重要性。", "problem": "考虑一个 $n \\times n$ 矩阵 $A$ 的特征多项式 $p_A(\\lambda)$ 的数值计算，其定义为 $p_A(\\lambda) = \\det(\\lambda I - A)$。一个基本事实是，$p_A$ 在相似变换下是不变的：对于任意可逆矩阵 $S$，都有 $p_A(\\lambda) = p_{S^{-1} A S}(\\lambda)$。一个特例是正交相似变换，其中 $Q$ 是正交矩阵（即 $Q^\\top Q = I$），从而有 $p_A(\\lambda) = p_{Q^\\top A Q}(\\lambda)$。在浮点运算中，计算会受到舍入误差的影响，其遵循标准模型 $\\operatorname{fl}(x \\circ y) = (x \\circ y)(1 + \\delta)$，其中 $|\\delta| \\leq u$，$u$ 是单位舍入。在数值线性代数中，正交变换在谱范数下是保范数的，即 $\\|Q^\\top A Q\\|_2 = \\|A\\|_2$，而由 $S$ 进行的一般相似变换可能会放大范数，其程度由条件数 $\\kappa_2(S) = \\|S\\|_2 \\|S^{-1}\\|_2$ 控制。\n\n您的任务是，使用一个固定的、基于迹的方案，通过经验性方法比较正交与非正交相似变换对 $p_A(\\lambda)$ 系数数值计算的影响。具体而言：\n\n- 使用 Faddeev–LeVerrier 递推式来计算特征多项式的系数。令 $B_0 = I$，对于 $k = 1, 2, \\dots, n$，定义\n  $$\n  c_k = -\\frac{1}{k}\\operatorname{tr}(A B_{k-1}), \\quad B_k = A B_{k-1} + c_k I,\n  $$\n  使得特征多项式为 $p_A(\\lambda) = \\lambda^n + c_1 \\lambda^{n-1} + \\cdots + c_n$。\n- 该递推式将在两种数值上不同的算术模型中实现：\n  1. 对于给定的整数矩阵 $A$，在有理数上进行精确算术，以便输出的系数在数学上是精确的（这些系数定义了 $p_A$ 的基准真相）。\n  2. 应用于 $A$ 的变换版本的双精度浮点算术。\n\n使用以下科学依据和定义，无需进一步推导：(i) 特征多项式在相似变换下的不变性，(ii) 正交矩阵满足 $Q^\\top Q = I$，(iii) 带有单位舍入 $u$ 的标准浮点舍入模型，以及 (iv) 谱范数在正交相似变换下的不变性，而一般相似变换可能将中间量放大，放大比例与基变换的条件数成正比。\n\n对于下面的每个测试用例，执行以下操作：\n1. 使用指定的随机种子，从 $\\{-2,-1,0,1,2\\}$ 中均匀抽取元素，构建一个整数矩阵 $A \\in \\mathbb{Z}^{n \\times n}$。\n2. 使用精确有理数算术计算精确的系数向量 $\\mathbf{c}_{\\mathrm{exact}} = (c_1,\\dots,c_n)$（此分支不使用浮点数）。\n3. 使用指定的种子，通过对一个具有独立标准正态分布条目的 $n \\times n$ 矩阵进行 QR 分解，生成一个正交矩阵 $Q$，并在浮点算术中定义 $A_{\\mathrm{orth}} = Q^\\top A Q$。\n4. 使用指定的指数，构建一个对角的、可逆的、非正交的相似矩阵 $S = \\operatorname{diag}(10^{\\alpha_0}, \\dots, 10^{\\alpha_{n-1}})$，并在浮点算术中定义 $A_{\\mathrm{non}} = S^{-1} A S$。\n5. 使用浮点算术，通过相同的 Faddeev–LeVerrier 方案，从 $A_{\\mathrm{orth}}$ 计算 $\\mathbf{c}_{\\mathrm{orth}}$，从 $A_{\\mathrm{non}}$ 计算 $\\mathbf{c}_{\\mathrm{non}}$。\n6. 量化相对系数误差\n   $$\n   e_{\\mathrm{orth}} = \\frac{\\|\\mathbf{c}_{\\mathrm{orth}} - \\mathbf{c}_{\\mathrm{exact}}\\|_\\infty}{\\|\\mathbf{c}_{\\mathrm{exact}}\\|_\\infty}, \\quad\n   e_{\\mathrm{non}} = \\frac{\\|\\mathbf{c}_{\\mathrm{non}} - \\mathbf{c}_{\\mathrm{exact}}\\|_\\infty}{\\|\\mathbf{c}_{\\mathrm{exact}}\\|_\\infty}.\n   $$\n7. 将放大率 $r = e_{\\mathrm{non}}/e_{\\mathrm{orth}}$ 报告为一个浮点数。\n\n测试套件：\n- 用例 1（理想情况）：$n = 6$，$A$ 的种子为 $2025$，$Q$ 的种子为 $123$，$S = \\operatorname{diag}(10^{0}, 10^{1}, 10^{2}, 10^{3}, 10^{4}, 10^{5})$。\n- 用例 2（边界情况：无非正交畸变）：$n = 6$，与用例 1 相同的 $A$，$Q$ 的种子为 $321$，$S = I$（即所有指数均为零）。\n- 用例 3（边缘情况：更强的非正交畸变）：$n = 6$，与用例 1 相同的 $A$，$Q$ 的种子为 $999$，$S = \\operatorname{diag}(10^{0}, 10^{2}, 10^{4}, 10^{6}, 10^{8}, 10^{10})$。\n\n用例 1-3 中的所有矩阵都将根据所述种子确定性地构建，以便结果是可复现的。\n\n您的程序必须：\n- 实现使用有理数算术的精确 Faddeev–LeVerrier 算法，从整数 $A$ 生成 $\\mathbf{c}_{\\mathrm{exact}}$。\n- 实现浮点 Faddeev–LeVerrier 算法，分别从 $A_{\\mathrm{orth}}$ 和 $A_{\\mathrm{non}}$ 生成 $\\mathbf{c}_{\\mathrm{orth}}$ 和 $\\mathbf{c}_{\\mathrm{non}}$。\n- 对于每个用例，计算比率 $r = e_{\\mathrm{non}}/e_{\\mathrm{orth}}$ 并将其存储为 Python 浮点数。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含三个比率，形式为用方括号括起来的逗号分隔列表（例如，“[r1,r2,r3]”）。此问题不涉及单位。不涉及角度。不涉及百分比；所有比率都应作为普通十进制数输出。", "solution": "用户希望解决一个数值线性代数问题。\n该问题要求对计算给定 $n \\times n$ 矩阵 $A$ 的特征多项式 $p_A(\\lambda) = \\det(\\lambda I - A)$ 系数的数值稳定性进行经验性研究。任务的核心是比较应用正交相似变换与应用非正交、病态的相似变换后所得结果的准确性。在精确算术中，特征多项式在任何相似变换下都保持不变，即 $p_A(\\lambda) = p_{S^{-1}AS}(\\lambda)$，但由于浮点误差，这一性质在数值计算中常常失效。本实验旨在量化这种失效。\n\n用于计算系数的算法是 Faddeev–LeVerrier 递推式。对于一个 $n \\times n$ 矩阵，该方法生成特征多项式 $p_A(\\lambda) = \\lambda^n + c_1 \\lambda^{n-1} + \\cdots + c_n$ 的系数 $c_1, \\dots, c_n$。递推式通过初始化 $B_0 = I$（$n \\times n$ 单位矩阵）然后对 $k = 1, 2, \\dots, n$ 进行迭代来定义：\n$$c_k = -\\frac{1}{k}\\operatorname{tr}(A B_{k-1})$$\n$$B_k = A B_{k-1} + c_k I$$\n众所周知，该算法在数值上是不稳定的，部分原因在于它涉及重复的矩阵乘法，这会放大初始误差。\n\n为了进行受控的数值实验，我们对每个测试用例采用三管齐下的计算策略：\n\n1.  **精确基准值计算**：为了建立一个无误差的基准，系数向量 $\\mathbf{c}_{\\mathrm{exact}} = (c_1, \\dots, c_n)$ 是通过使用精确有理数算术实现的 Faddeev–LeVerrier 算法从初始整数矩阵 $A$ 计算得出的。这是通过将所有数字和矩阵条目表示为 `fractions.Fraction` 对象来实现的，确保所有除法和其他运算都在没有任何舍入误差的情况下执行。这个向量 $\\mathbf{c}_{\\mathrm{exact}}$ 作为衡量浮点计算结果的基准。\n\n2.  **正交变换路径**：生成一个正交矩阵 $Q$（其中 $Q^\\top Q = I$），并使用标准的双精度浮点算术计算变换后的矩阵 $A_{\\mathrm{orth}} = Q^\\top A Q$。正交变换对于谱范数是完美条件的，其条件数 $\\kappa_2(Q) = 1$，并且它们是保范数的，$\\|Q^\\top A Q\\|_2 = \\|A\\|_2$。因此，从 $A$ 到 $A_{\\mathrm{orth}}$ 的变换引入的数值扰动极小。然后将 Faddeev–LeVerrier 算法应用于 $A_{\\mathrm{orth}}$（在浮点算术中）以生成系数向量 $\\mathbf{c}_{\\mathrm{orth}}$。预计此向量中的误差主要来自算法本身固有的不稳定性，而非变换过程。\n\n3.  **非正交变换路径**：构建一个非正交的对角相似矩阵 $S$，其条目跨越多个数量级。这使得 $S$ 成为病态的，具有很大的条件数 $\\kappa_2(S) = \\|S\\|_2 \\|S^{-1}\\|_2$。变换后的矩阵 $A_{\\mathrm{non}} = S^{-1} A S$ 在浮点算术中计算。$A_{\\mathrm{non}}$ 的元素由 $(A_{\\mathrm{non}})_{ij} = (S^{-1}AS)_{ij} = A_{ij} S_{jj} / S_{ii}$ 给出。$S$ 对角元素之间的巨大比率会急剧改变 $A_{\\mathrm{non}}$ 中条目的尺度（与 $A$ 相比），可能导致在矩阵运算中将较小的数加到较大的数上时丢失有效数字。将 Faddeev–LeVerrier 算法应用于 $A_{\\mathrm{non}}$ 以找到 $\\mathbf{c}_{\\mathrm{non}}$。预计产生的误差会远大于正交情况下的误差，并被相似变换的病态性所放大。\n\n最后一步是量化和比较误差。使用无穷范数计算正交和非正交路径的相对误差：\n$$e_{\\mathrm{orth}} = \\frac{\\|\\mathbf{c}_{\\mathrm{orth}} - \\mathbf{c}_{\\mathrm{exact}}\\|_\\infty}{\\|\\mathbf{c}_{\\mathrm{exact}}\\|_\\infty}, \\quad e_{\\mathrm{non}} = \\frac{\\|\\mathbf{c}_{\\mathrm{non}} - \\mathbf{c}_{\\mathrm{exact}}\\|_\\infty}{\\|\\mathbf{c}_{\\mathrm{exact}}\\|_\\infty}$$\n放大率 $r = e_{\\mathrm{non}} / e_{\\mathrm{orth}}$ 衡量了病态非正交变换相对于稳定正交变换多引入了多少数值误差。一个远大于1的比率 $r \\gg 1$ 表明，在实践中使用正交变换具有更优的数值稳定性。对于 $S=I$ 的特殊情况，“非正交”路径导致 $A_{\\mathrm{non}}=A$，我们预计 $e_{\\mathrm{non}}$ 和 $e_{\\mathrm{orth}}$ 的量级相近，从而得到 $r \\approx 1$。", "answer": "```python\nimport numpy as np\nfrom fractions import Fraction\n\ndef faddeev_leverrier_exact(A_int, n):\n    \"\"\"\n    Computes characteristic polynomial coefficients using exact rational arithmetic.\n    All intermediate calculations are done using Python's Fraction type.\n    \"\"\"\n    A_frac = np.array([[Fraction(x) for x in row] for row in A_int], dtype=object)\n    I_frac = np.array([[Fraction(int(i==j)) for j in range(n)] for i in range(n)], dtype=object)\n    \n    B = I_frac.copy()\n    c_coeffs = []\n    \n    for k in range(1, n + 1):\n        # B_{k} = A*B_{k-1} + c_k*I\n        # c_k = -1/k * tr(A*B_{k-1})\n        AB = A_frac @ B\n        tr_AB = np.trace(AB)\n        c_k = -tr_AB / Fraction(k)\n        c_coeffs.append(c_k)\n        B = AB + c_k * I_frac\n        \n    return np.array(c_coeffs, dtype=object)\n\ndef faddeev_leverrier_float(A_float, n):\n    \"\"\"\n    Computes characteristic polynomial coefficients using standard floating-point arithmetic.\n    \"\"\"\n    B = np.identity(n)\n    c_coeffs = np.zeros(n)\n    \n    for k in range(1, n + 1):\n        AB = A_float @ B\n        c_k = -np.trace(AB) / k\n        c_coeffs[k-1] = c_k\n        B = AB + c_k * np.identity(n)\n        \n    return c_coeffs\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and compute error amplification ratios.\n    \"\"\"\n    test_cases = [\n        {'n': 6, 'seed_A': 2025, 'seed_Q': 123, 'S_exponents': [0, 1, 2, 3, 4, 5]},\n        {'n': 6, 'seed_A': 2025, 'seed_Q': 321, 'S_exponents': [0, 0, 0, 0, 0, 0]},\n        {'n': 6, 'seed_A': 2025, 'seed_Q': 999, 'S_exponents': [0, 2, 4, 6, 8, 10]},\n    ]\n\n    ratios = []\n\n    for case in test_cases:\n        n = case['n']\n        seed_A = case['seed_A']\n        seed_Q = case['seed_Q']\n        S_exponents = case['S_exponents']\n\n        # Step 1: Construct integer matrix A deterministically.\n        rng_A = np.random.default_rng(seed_A)\n        A_int = rng_A.integers(-2, 3, size=(n, n))\n\n        # Step 2: Compute exact coefficients c_exact using rational arithmetic.\n        c_exact = faddeev_leverrier_exact(A_int, n)\n        c_exact_float = np.array([float(c) for c in c_exact])\n        norm_c_exact = np.linalg.norm(c_exact_float, ord=np.inf)\n        \n        if norm_c_exact == 0:\n            # Handle the unlikely degenerate case where c_exact is a zero vector.\n            ratios.append(float('nan'))\n            continue\n\n        A_float = A_int.astype(float)\n\n        # Step 3: Form orthogonal matrix Q and A_orth.\n        rng_Q = np.random.default_rng(seed_Q)\n        Z = rng_Q.standard_normal(size=(n, n))\n        Q, _ = np.linalg.qr(Z)\n        A_orth = Q.T @ A_float @ Q\n\n        # Step 4: Form non-orthogonal matrix S and A_non.\n        S_diag = np.array([10.0**exp for exp in S_exponents])\n        # Efficiently compute A_non = S_inv @ A @ S for diagonal S.\n        # (A_non)_ij = A_ij * (S_j / S_i)\n        A_non = A_float * (S_diag / S_diag[:, np.newaxis])\n\n        # Step 5: Compute float coefficients for transformed matrices.\n        c_orth = faddeev_leverrier_float(A_orth, n)\n        c_non = faddeev_leverrier_float(A_non, n)\n        \n        # Step 6: Quantify relative coefficient errors.\n        err_vec_orth = c_orth - c_exact_float\n        e_orth = np.linalg.norm(err_vec_orth, ord=np.inf) / norm_c_exact\n        \n        err_vec_non = c_non - c_exact_float\n        e_non = np.linalg.norm(err_vec_non, ord=np.inf) / norm_c_exact\n\n        # Step 7: Report the amplification ratio r.\n        # If e_orth is zero, the orthogonal path was perfectly accurate.\n        if e_orth == 0:\n            r = float('inf') if e_non > 0 else 1.0\n        else:\n            r = e_non / e_orth\n        ratios.append(r)\n\n    print(f\"[{','.join(map(str, ratios))}]\")\n\nsolve()\n```", "id": "3536821"}, {"introduction": "特征多项式的不稳定性，根源在于其经典的单项式基 $\\{1, x, x^2, \\dots\\}$ 表示。一个关键的解决思路是更换基底。本练习的核心思想是，将多项式的表示从单项式基更换为一组正交多项式基（如切比雪夫多项式），可以得到一个在数值上远为稳定的表示，因为这些基函数本身是有界的且表现良好。这项实践将带您从诊断问题转向探索一种强大的解决方案 [@problem_id:3536768]。通过在切比雪夫基中表示特征多项式，您将学习到一种在稳健的数值软件中用于控制病态问题的标准技术，这不仅揭示了单项式基的缺陷，也让您掌握了一种更优越的多项式处理方法。", "problem": "在数值线性代数中，特征多项式 $p_A(x) = \\det(x I - A)$ 的单项式系数是矩阵 $A$ 特征值的初等对称函数，其数值大小可能增长很快，这在有限精度算术中会导致数值不稳定性。考虑将单项式基 $\\{1, x, x^2, \\dots, x^n\\}$ 替换为一个缩放到包含谱的区间上的正交多项式基。设 $\\{\\lambda_i\\}_{i=1}^n$ 是一个实对称矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 的实特征值，其谱包含在 $[a,b]$ 内，并令仿射映射 $\\phi(x) = \\dfrac{2 x - (a+b)}{b-a}$ 将 $[a,b]$ 映射到 $[-1,1]$。定义 $q(t) = p_A(\\phi^{-1}(t))$，并将其在 $[-1,1]$ 上按第一类切比雪夫多项式 $\\{T_k\\}_{k=0}^n$ 进行展开，其中 $T_k(\\cos \\theta) = \\cos(k \\theta)$ 对于 $\\theta \\in [0,\\pi]$。\n\n任务：\n- 从 $p_A$ 的定义、仿射映射 $\\phi$ 以及 $\\{T_k\\}$ 在 $[-1,1]$ 上关于权函数 $w(t) = (1 - t^2)^{-1/2}$ 的正交性出发，推导切比雪夫展开式 $q(t) = \\sum_{k=0}^{n} c_k T_k(t)$，并用 $M = \\max_{t \\in [-1,1]} |q(t)|$ 表示切比雪夫系数的一个界。您的推导必须阐明正交性和在 $[-1,1]$ 上的有界性 $|T_k(t)| \\leq 1$ 如何共同缓解了相对于宽区间上的单项式基而言的系数增长问题。\n- 利用 $p_A(x) = \\prod_{i=1}^{n} (x - \\lambda_i)$ 的结构，解释为何单项式系数会随 $n$ 组合增长，并随区间宽度 $b-a$ 不利地缩放，而切比雪夫系数则由 $M$ 控制，且与区间的平移和缩放无关。\n- 提出一种数值稳定的变换，用于从切比雪夫系数向量 $\\boldsymbol{c} = (c_0,\\dots,c_n)^{\\mathsf{T}}$ 中恢复单项式系数向量，并使精度损失最小。您的方案必须基于第一性原理，可使用三项递推关系构建 $T_k(\\phi(x))$ 的单项式表示（并进行适当缩放），或使用切比雪夫到单项式转换的正交分解（例如 QR 分解），并证明其在浮点运算中的后向稳定性。\n- 对于具体情况 $n=3$，特征值为 $\\{\\lambda_1,\\lambda_2,\\lambda_3\\} = \\{-0.9,\\, 0.05,\\, 0.8\\}$，区间为 $[a,b] = [-1,1]$（因此 $\\phi$ 是恒等映射），计算：\n  1. 单项式系数向量 $\\boldsymbol{m} = (a_0,a_1,a_2,a_3)^{\\mathsf{T}}$，使得 $p_A(x) = a_3 x^3 + a_2 x^2 + a_1 x + a_0$。\n  2. 切比雪夫系数向量 $\\boldsymbol{c} = (c_0,c_1,c_2,c_3)^{\\mathsf{T}}$，使得 $p_A(x) = \\sum_{k=0}^{3} c_k T_k(x)$。\n  3. 比率 $R = \\dfrac{\\|\\boldsymbol{m}\\|_2}{\\|\\boldsymbol{c}\\|_2}$。\n  \n将您最终的数值答案 $R$ 四舍五入到四位有效数字。", "solution": "问题陈述科学合理、提法明确且内部一致，可以进行严格求解。我们按顺序解决每个任务。\n\n首先，我们推导 $q(t) = p_A(\\phi^{-1}(t))$ 的切比雪夫展开式及其系数的界。多项式 $q(t)$ 的次数为 $n$，可以在第一类切比雪夫多项式基 $\\{T_k(t)\\}_{k=0}^n$ 上展开为 $q(t) = \\sum_{k=0}^{n} c_k T_k(t)$。系数 $c_k$ 是通过利用切比雪夫多项式在区间 $[-1,1]$ 上关于权函数 $w(t) = (1-t^2)^{-1/2}$ 的正交性来求得的。\n\n正交关系为 $\\int_{-1}^{1} T_j(t) T_k(t) w(t) dt = 0$（当 $j \\neq k$ 时）。归一化常数为：\n$$ \\int_{-1}^{1} T_k^2(t) w(t) dt = \\int_{-1}^{1} \\frac{T_k^2(t)}{\\sqrt{1-t^2}} dt = \\begin{cases} \\pi  k=0 \\\\ \\pi/2  k>0 \\end{cases} $$\n为了求特定系数 $c_j$，我们将展开式乘以 $T_j(t)w(t)$ 并在 $[-1,1]$ 上积分：\n$$ \\int_{-1}^{1} q(t) T_j(t) w(t) dt = \\sum_{k=0}^{n} c_k \\int_{-1}^{1} T_k(t) T_j(t) w(t) dt = c_j \\int_{-1}^{1} T_j^2(t) w(t) dt $$\n这给出了系数的公式：\n$$ c_0 = \\frac{1}{\\pi} \\int_{-1}^{1} \\frac{q(t)}{\\sqrt{1-t^2}} dt $$\n$$ c_k = \\frac{2}{\\pi} \\int_{-1}^{1} \\frac{q(t) T_k(t)}{\\sqrt{1-t^2}} dt \\quad \\text{for } k > 0 $$\n为了界定这些系数，我们使用给定的最大值 $M = \\max_{t \\in [-1,1]} |q(t)|$ 以及在区间 $t \\in [-1,1]$ 上对所有 $k$ 都有 $|T_k(t)| \\le 1$ 的性质。\n对于 $c_0$：\n$$ |c_0| = \\left| \\frac{1}{\\pi} \\int_{-1}^{1} \\frac{q(t)}{\\sqrt{1-t^2}} dt \\right| \\le \\frac{1}{\\pi} \\int_{-1}^{1} \\frac{|q(t)|}{\\sqrt{1-t^2}} dt \\le \\frac{M}{\\pi} \\int_{-1}^{1} \\frac{1}{\\sqrt{1-t^2}} dt = \\frac{M}{\\pi} [\\arcsin(t)]_{-1}^{1} = \\frac{M}{\\pi} \\left(\\frac{\\pi}{2} - \\left(-\\frac{\\pi}{2}\\right)\\right) = M $$\n对于 $k > 0$ 的 $c_k$：\n$$ |c_k| = \\left| \\frac{2}{\\pi} \\int_{-1}^{1} \\frac{q(t) T_k(t)}{\\sqrt{1-t^2}} dt \\right| \\le \\frac{2}{\\pi} \\int_{-1}^{1} \\frac{|q(t)| |T_k(t)|}{\\sqrt{1-t^2}} dt \\le \\frac{2M}{\\pi} \\int_{-1}^{1} \\frac{1}{\\sqrt{1-t^2}} dt = \\frac{2M}{\\pi} (\\pi) = 2M $$\n因此，切比雪夫系数是有界的：$|c_0| \\le M$ 且对于 $k>0$ 有 $|c_k| \\le 2M$。这表明相对于函数在区间上的最大值，系数不会任意大。这缓解了系数增长问题，因为基函数 $T_k(t)$ 本身受限于 $1$。相比之下，单项式基函数 $x^k$ 是无界的，并且在远离 $0$ 的区间上可能变得近似线性相关，导致病态问题，即函数的微小变化可能引起单项式系数的巨大变化。正交有界基确保了系数是多项式的一个稳定表示。\n\n其次，我们解释系数增长的差异。特征多项式为 $p_A(x) = \\prod_{i=1}^{n} (x - \\lambda_i)$。展开这个乘积得到单项式表示 $p_A(x) = \\sum_{k=0}^{n} a_k x^k$（其中 $a_n=1$）。根据韦达定理，系数 $a_k$ 是特征值的初等对称多项式：\n$$ a_{n-k} = (-1)^k \\sum_{1 \\le i_1  \\dots  i_k \\le n} \\lambda_{i_1} \\lambda_{i_2} \\cdots \\lambda_{i_k} $$\n$a_{n-k}$ 的求和包含 $\\binom{n}{k}$ 项。这个数字随 $n$ 呈组合增长，在 $k \\approx n/2$ 时达到峰值。如果特征值 $\\lambda_i$ 的量级很大（即区间 $[a,b]$ 远离 $0$），乘积 $\\lambda_{i_1} \\cdots \\lambda_{i_k}$ 可能会非常巨大。例如，如果所有 $\\lambda_i \\approx \\lambda_0$，那么 $|a_{n-k}| \\approx \\binom{n}{k} |\\lambda_0|^k$。这显示了系数随维度 $n$ 和谱的位置（平移）的不利增长。区间宽度 $b-a$ 也影响了特征值的潜在量级。\n相比之下，切比雪夫系数 $c_k$ 是针对多项式 $q(t) = p_A(\\phi^{-1}(t))$ 在 $[-1,1]$ 上的。这个变换将特征值 $\\lambda_i \\in [a,b]$ 映射到 $\\mu_i = \\phi(\\lambda_i) \\in [-1,1]$。我们有 $q(t) = \\prod_{i=1}^n (\\phi^{-1}(t) - \\lambda_i) = \\left(\\frac{b-a}{2}\\right)^n \\prod_{i=1}^n (t - \\mu_i)$。此多项式在 $[-1,1]$ 上的最大值为 $M = \\max_{t \\in [-1,1]} |q(t)|$。如前所示，切比雪夫系数受 $M$ 和 $2M$ 的界定。尽管 $M$ 本身取决于区间宽度 $b-a$，但关键点在于，系数是相对于函数在归一化区间上的最大值有界的。通过映射到标准区间并使用表现良好（正交且有界）的基，消除了因选择不当的基（任意区间上的单项式）而导致的病态问题。数值稳定性来源于基本身的性质，不是因为系数的绝对值小，而是因为它们相对于函数尺度 $M$ 的大小是有界的。\n\n第三，我们提出一种从切比雪夫系数向量 $\\boldsymbol{c}$ 恢复单项式系数向量 $\\boldsymbol{m}$ 的数值稳定方法。多项式为 $p_A(x) = \\sum_{k=0}^{n} c_k T_k(\\phi(x))$。我们想要求解 $p_A(x) = \\sum_{j=0}^{n} a_j x^j$ 中的系数 $a_j$。令 $\\phi(x) = \\alpha x + \\beta$，其中 $\\alpha = \\frac{2}{b-a}$ 且 $\\beta = -\\frac{a+b}{b-a}$。基多项式为 $P_k(x) = T_k(\\phi(x))$。我们可以使用切比雪夫多项式的三项递推关系 $T_{k+1}(t) = 2t T_k(t) - T_{k-1}(t)$ 来生成每个 $P_k(x)$ 的单项式表示。代入 $t = \\phi(x)$ 得到基多项式的递推关系：\n$$ P_{k+1}(x) = 2(\\alpha x + \\beta) P_k(x) - P_{k-1}(x) $$\n此关系可以应用于单项式系数向量。设 $\\boldsymbol{p}_k$ 是 $P_k(x)$ 的系数向量，使得 $P_k(x) = \\sum_{j=0}^k (\\boldsymbol{p}_k)_j x^j$。设 $S$ 是系数向量上的升位算子，对应于乘以 $x$。递推关系变为：\n$$ \\boldsymbol{p}_{k+1} = 2\\alpha S \\boldsymbol{p}_k + 2\\beta \\boldsymbol{p}_k - \\boldsymbol{p}_{k-1} $$\n算法如下：\n1. 初始化 $\\boldsymbol{p}_0$ 为 $P_0(x)=1$ 的系数向量，即 $\\boldsymbol{p}_0 = (1, 0, \\dots, 0)^{\\mathsf{T}}$。\n2. 初始化 $\\boldsymbol{p}_1$ 为 $P_1(x)=\\phi(x)=\\alpha x + \\beta$ 的系数向量，即 $\\boldsymbol{p}_1 = (\\beta, \\alpha, 0, \\dots, 0)^{\\mathsf{T}}$。\n3. 对于 $k=1, \\dots, n-1$，使用向量递推关系计算 $\\boldsymbol{p}_{k+1}$。\n4. 最终的单项式系数向量是线性组合 $\\boldsymbol{m} = \\sum_{k=0}^{n} c_k \\boldsymbol{p}_k$。\n此方法是数值稳定的。它避免了直接计算基变换矩阵，该矩阵的元素可能涉及大的、符号交替的二项式表达式，这些表达式容易发生灾难性抵消。三项递推仅涉及简单的算术运算（标量乘法和向量加法），且误差传播得到良好控制。这构成了一个用于计算矩阵-向量乘积 $C\\boldsymbol{c}$ 的后向稳定算法，其中 $C$ 是以 $\\boldsymbol{p}_k$ 为列的（可能病态的）转换矩阵。\n\n第四，我们对 $n=3$，特征值为 $\\{-0.9, 0.05, 0.8\\}$，区间为 $[a,b] = [-1,1]$ 的具体情况进行计算。\n仿射映射为 $\\phi(x) = \\frac{2x - (-1+1)}{1-(-1)} = x$。这简化了问题，使得 $p_A(x)=q(x)$。\n\n1. 单项式系数向量 $\\boldsymbol{m}$：\n特征多项式为 $p_A(x) = (x - (-0.9))(x - 0.05)(x - 0.8) = (x+0.9)(x-0.05)(x-0.8)$。\n展开此式：\n$p_A(x) = (x^2 + 0.85x - 0.045)(x-0.8)$\n$p_A(x) = x^3 + 0.85x^2 - 0.045x - 0.8x^2 - 0.68x + 0.036$\n$p_A(x) = 1x^3 + 0.05x^2 - 0.725x + 0.036$\n根据问题的约定 $p_A(x) = a_3x^3 + a_2x^2 + a_1x + a_0$，单项式系数向量为 $\\boldsymbol{m} = (a_0, a_1, a_2, a_3)^{\\mathsf{T}} = (0.036, -0.725, 0.05, 1)^{\\mathsf{T}}$。\n\n2. 切比雪夫系数向量 $\\boldsymbol{c}$：\n我们将 $p_A(x)$ 表示在切比雪夫基 $\\{T_0(x), T_1(x), T_2(x), T_3(x)\\}$ 上。我们使用以下关系：\n$x^3 = \\frac{1}{4}(T_3(x) + 3T_1(x))$\n$x^2 = \\frac{1}{2}(T_2(x) + T_0(x))$\n$x = T_1(x)$\n$1 = T_0(x)$\n将这些代入 $p_A(x)$ 的单项式形式：\n$p_A(x) = 1 \\cdot \\left(\\frac{1}{4}T_3(x) + \\frac{3}{4}T_1(x)\\right) + 0.05 \\cdot \\left(\\frac{1}{2}T_2(x) + \\frac{1}{2}T_0(x)\\right) - 0.725 \\cdot T_1(x) + 0.036 \\cdot T_0(x)$\n按 $T_k(x)$ 分组各项：\n$c_3 = \\frac{1}{4} = 0.25$\n$c_2 = \\frac{0.05}{2} = 0.025$\n$c_1 = \\frac{3}{4} - 0.725 = 0.75 - 0.725 = 0.025$\n$c_0 = \\frac{0.05}{2} + 0.036 = 0.025 + 0.036 = 0.061$\n切比雪夫系数向量为 $\\boldsymbol{c} = (c_0, c_1, c_2, c_3)^{\\mathsf{T}} = (0.061, 0.025, 0.025, 0.25)^{\\mathsf{T}}$。\n\n3. 比率 $R = \\dfrac{\\|\\boldsymbol{m}\\|_2}{\\|\\boldsymbol{c}\\|_2}$：\n我们计算向量的欧几里得范数。\n$\\|\\boldsymbol{m}\\|_2^2 = (0.036)^2 + (-0.725)^2 + (0.05)^2 + 1^2 = 0.001296 + 0.525625 + 0.0025 + 1 = 1.529421$\n$\\|\\boldsymbol{m}\\|_2 = \\sqrt{1.529421} \\approx 1.2366976$\n$\\|\\boldsymbol{c}\\|_2^2 = (0.061)^2 + (0.025)^2 + (0.025)^2 + (0.25)^2 = 0.003721 + 0.000625 + 0.000625 + 0.0625 = 0.067471$\n$\\|\\boldsymbol{c}\\|_2 = \\sqrt{0.067471} \\approx 0.2597518$\n比率为 $R = \\dfrac{1.2366976}{0.2597518} \\approx 4.76105$。\n四舍五入到四位有效数字，我们得到 $R = 4.761$。", "answer": "$$\n\\boxed{4.761}\n$$", "id": "3536768"}]}