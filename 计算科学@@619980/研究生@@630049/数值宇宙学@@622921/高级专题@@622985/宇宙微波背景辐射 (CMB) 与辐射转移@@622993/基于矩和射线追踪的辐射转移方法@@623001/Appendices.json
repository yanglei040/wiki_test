{"hands_on_practices": [{"introduction": "理解辐射转移方程矩系统的双曲性质是构建现代数值格式的第一步。本练习将引导你通过分析推导一维M1矩系统的特征波速，这是一个揭示系统内信息传播速度的关键物理量[@problem_id:3479797]。这个结果不仅具有理论意义，它还直接为设计如HLL等近似黎曼求解器提供了必要的输入。", "problem": "考虑在与数值宇宙学相关的局部闵可夫斯基时空片中的无源、无吸收的辐射输运。通过对辐射转移方程在立体角上积分得到的角矩方程是辐射能量方程和辐射动量方程，\n$$\\partial_{t} E + \\nabla \\cdot \\boldsymbol{F} = 0,\\qquad \\partial_{t} \\boldsymbol{F} + c^{2} \\nabla \\cdot \\mathsf{P} = 0,$$\n其中 $E$ 是辐射能量密度，$\\boldsymbol{F}$ 是辐射通量，$\\mathsf{P}$ 是辐射压力张量，$c$ 是光速。在一维沿 $x$ 方向的设定中，这简化为\n$$\\partial_{t} E + \\partial_{x} F = 0,\\qquad \\partial_{t} F + c^{2} \\partial_{x} P_{xx} = 0,$$\n其中 $F$ 是通量的 $x$ 分量，$P_{xx}$ 是压力张量的 $xx$ 分量。\n\n使用一阶最大熵矩封闭 (M1) 来封闭该系统，其中爱丁顿张量为\n$$\\mathsf{D} = \\frac{1 - \\chi}{2}\\,\\mathsf{I} + \\frac{3\\chi - 1}{2}\\,\\boldsymbol{n}\\otimes\\boldsymbol{n},$$\n其中 $\\mathsf{I}$ 是单位张量，$\\boldsymbol{n} = \\boldsymbol{F}/|\\boldsymbol{F}|$ 是单位通量方向，而爱丁顿因子 $\\chi$ 通过 Levermore–Minerbo 关系式被指定为约化通量 $f$ 的函数，其中 $f \\equiv |\\boldsymbol{F}|/(c E)$，关系式为\n$$\\chi(f) = \\frac{3 + 4 f^{2}}{5 + 2\\sqrt{4 - 3 f^{2}}},\\qquad 0 \\le f \\le 1.$$\n在一维沿通量方向上，$P_{xx} = \\chi(f)\\,E$。\n\n在空间均匀、稳态的背景态 $(E_{0}, F_{0})$（其约化通量为 $f_{0} \\equiv |F_{0}|/(c E_{0}) \\in (0,1]$）附近对系统进行线性化。假设存在小振幅平面波微扰，并且与用于验证近似黎曼求解器（如 Harten–Lax–van Leer (HLL) 求解器）的解析线性波测试一致，将爱丁顿因子视为冻结在其背景值上，即在一阶上 $\\chi(f) \\approx \\chi(f_{0})$。推导所得双曲系统的特征速度，并以 $c$ 和 $f_{0}$ 的函数形式给出其闭式解。\n\n最后，在光学薄极限 $f_{0} \\to 1$ 下，讨论你的特征速度与自由流辐射的射线追踪预期结果的一致性。你的最终答案必须是写成单行矩阵的两个特征速度。不需要进行数值近似；用 $c$ 和 $f_{0}$ 符号化地表示你的结果，并且在最终的方框答案中不要包含单位。", "solution": "该问题要求在 M1 封闭下，并遵循特定的线性化近似，推导一维辐射输运矩方程的特征速度。该方程组由以下公式给出：\n$$\n\\partial_{t} E + \\partial_{x} F = 0\n$$\n$$\n\\partial_{t} F + c^{2} \\partial_{x} P_{xx} = 0\n$$\n其中 $E$ 是辐射能量密度，$F$ 是辐射通量的 $x$ 分量，$P_{xx}$ 是辐射压力张量的 $xx$ 分量。该系统可以写成守恒律形式 $\\partial_{t} \\mathbf{U} + \\partial_{x} \\mathbf{G}(\\mathbf{U}) = 0$，其中状态向量 $\\mathbf{U}$ 和通量向量 $\\mathbf{G}(\\mathbf{U})$ 是：\n$$\n\\mathbf{U} = \\begin{pmatrix} E \\\\ F \\end{pmatrix}, \\qquad \\mathbf{G}(\\mathbf{U}) = \\begin{pmatrix} F \\\\ c^{2} P_{xx} \\end{pmatrix}\n$$\n系统通过一维的 M1 封闭关系式进行封闭，即 $P_{xx} = \\chi(f)E$，其中 $\\chi$ 是爱丁顿因子，$f = |F|/(cE)$ 是约化通量。因此，通量向量为：\n$$\n\\mathbf{G}(\\mathbf{U}) = \\begin{pmatrix} F \\\\ c^{2} \\chi(f) E \\end{pmatrix}\n$$\n问题要求我们在一个均匀背景态 $(E_{0}, F_{0})$ 附近对系统进行线性化，并将爱丁顿因子视为冻结在其背景值 $\\chi_{0} = \\chi(f_{0})$ 上，其中 $f_{0} = |F_{0}|/(cE_{0})$。这种近似常用于构建 HLL 类型的数值求解器，并且为了求特征速度，它有效地使系统变为线性。在此近似下，压力分量变为 $P_{xx} \\approx \\chi_{0}E$。通量向量简化为：\n$$\n\\mathbf{G}(\\mathbf{U}) \\approx \\begin{pmatrix} F \\\\ c^{2} \\chi_{0} E \\end{pmatrix}\n$$\n利用这个线性化的通量，方程组变为：\n$$\n\\partial_{t} E + \\partial_{x} F = 0\n$$\n$$\n\\partial_{t} F + c^{2} \\chi_{0} \\partial_{x} E = 0\n$$\n这个双曲系统的特征速度 $\\lambda$ 是雅可比矩阵 $\\mathbf{J} = \\frac{\\partial \\mathbf{G}}{\\partial \\mathbf{U}}$ 的特征值。我们计算 $\\mathbf{J}$ 的分量如下：\n$$\n\\mathbf{J} = \\begin{pmatrix} \\frac{\\partial G_{1}}{\\partial E} & \\frac{\\partial G_{1}}{\\partial F} \\\\ \\frac{\\partial G_{2}}{\\partial E} & \\frac{\\partial G_{2}}{\\partial F} \\end{pmatrix} = \\begin{pmatrix} \\frac{\\partial}{\\partial E}(F) & \\frac{\\partial}{\\partial F}(F) \\\\ \\frac{\\partial}{\\partial E}(c^{2} \\chi_{0} E) & \\frac{\\partial}{\\partial F}(c^{2} \\chi_{0} E) \\end{pmatrix}\n$$\n由于 $\\chi_{0}$ 被视为常数，导数为：\n$$\n\\frac{\\partial G_{1}}{\\partial E} = 0, \\qquad \\frac{\\partial G_{1}}{\\partial F} = 1\n$$\n$$\n\\frac{\\partial G_{2}}{\\partial E} = c^{2} \\chi_{0}, \\qquad \\frac{\\partial G_{2}}{\\partial F} = 0\n$$\n因此，雅可比矩阵为：\n$$\n\\mathbf{J} = \\begin{pmatrix} 0 & 1 \\\\ c^{2} \\chi_{0} & 0 \\end{pmatrix}\n$$\n特征值 $\\lambda$ 通过求解特征方程 $\\det(\\mathbf{J} - \\lambda \\mathbf{I}) = 0$ 得到，其中 $\\mathbf{I}$ 是单位矩阵。\n$$\n\\det \\begin{pmatrix} -\\lambda & 1 \\\\ c^{2} \\chi_{0} & -\\lambda \\end{pmatrix} = (-\\lambda)(-\\lambda) - (1)(c^{2} \\chi_{0}) = \\lambda^{2} - c^{2} \\chi_{0} = 0\n$$\n这得到 $\\lambda^{2} = c^{2} \\chi_{0}$，两个特征速度是：\n$$\n\\lambda_{\\pm} = \\pm c \\sqrt{\\chi_{0}}\n$$\n为了用 $c$ 和背景约化通量 $f_{0}$ 来表示这些速度，我们代入给定的 Levermore–Minerbo 关系式，计算在 $f_{0}$ 处的爱丁顿因子：\n$$\n\\chi_{0} = \\chi(f_{0}) = \\frac{3 + 4 f_{0}^{2}}{5 + 2\\sqrt{4 - 3 f_{0}^{2}}}\n$$\n因此，特征速度为：\n$$\n\\lambda_{\\pm} = \\pm c \\sqrt{\\frac{3 + 4 f_{0}^{2}}{5 + 2\\sqrt{4 - 3 f_{0}^{2}}}}\n$$\n接下来，我们分析光学薄（自由流）极限，其中 $f_{0} \\to 1$。在此极限下，辐射场是最大程度各向异性的。我们首先计算当 $f_{0} \\to 1$ 时爱丁顿因子 $\\chi_{0}$ 的值：\n$$\n\\lim_{f_{0} \\to 1} \\chi_{0} = \\lim_{f_{0} \\to 1} \\frac{3 + 4 f_{0}^{2}}{5 + 2\\sqrt{4 - 3 f_{0}^{2}}} = \\frac{3 + 4(1)^{2}}{5 + 2\\sqrt{4 - 3(1)^{2}}} = \\frac{7}{5 + 2\\sqrt{1}} = \\frac{7}{7} = 1\n$$\n所以，在自由流极限下，$\\chi_{0} \\to 1$。我们现在可以求出此极限下的特征速度：\n$$\n\\lim_{f_{0} \\to 1} \\lambda_{\\pm} = \\pm c \\sqrt{\\lim_{f_{0} \\to 1} \\chi_{0}} = \\pm c \\sqrt{1} = \\pm c\n$$\n这个结果与射线追踪方法的预期一致。射线追踪在几何光学极限下是精确的，此时辐射沿直线（射线）以光速 $c$ 传播。守恒律系统的特征速度代表了小扰动的传播速度。在自由流极限（$f_{0} \\to 1$）下，辐射流体的行为像是一群全部沿相同方向（或在一维情况下沿相反方向）运动的光子。对此流动的任何扰动也必须以光速传播。M1 系统的特征速度在此极限下变为 $\\pm c$ 的事实表明，该矩模型正确地再现了光学薄区域中辐射的基本传播速度。对于任何基于矩方法的辐射转移方法来说，这是一个关键的物理一致性要求，而此分析证实了 M1 封闭，即使在简化的“冻结 $\\chi$”假设下，也满足这个检验。\n两个特征速度是 $\\lambda_{-} = -c \\sqrt{\\frac{3 + 4 f_{0}^{2}}{5 + 2\\sqrt{4 - 3 f_{0}^{2}}}}$ 和 $\\lambda_{+} = c \\sqrt{\\frac{3 + 4 f_{0}^{2}}{5 + 2\\sqrt{4 - 3 f_{0}^{2}}}}$。", "answer": "$$\n\\boxed{\\begin{pmatrix} -c \\sqrt{\\frac{3 + 4 f_{0}^{2}}{5 + 2\\sqrt{4 - 3 f_{0}^{2}}}} & c \\sqrt{\\frac{3 + 4 f_{0}^{2}}{5 + 2\\sqrt{4 - 3 f_{0}^{2}}}} \\end{pmatrix}}\n$$", "id": "3479797"}, {"introduction": "从理论分析到代码实现是数值科学家的核心技能。在本练习中，你将把前一练习[@problem_id:3479797]中获得的理论知识付诸实践，构建一个完整的一维有限体积求解器来模拟M1辐射转移方程[@problem_id:3479813]。你将实现一个HLL近似黎曼求解器，处理周期性边界条件，并应用数值限制器来保证解的物理实在性，从而全面体验开发一个鲁棒辐射转移模块的过程。", "problem": "您的任务是设计并实现一个用于数值宇宙学中辐射转移的灰体一阶矩系统（简称 M1）的一维有限体积法。该方法使用守恒变量 $(E,F)$，其中 $E$ 是辐射能量密度，$F$ 是辐射通量。该方法必须使用 Harten–Lax–van Leer (HLL) 近似黎曼求解器，其信号速度由指定闭合关系下通量雅可比矩阵的特征值得出。您必须确保更新过程保持 $E$ 的正性，并遵守物理约束 $\\lvert F \\rvert \\leq c E$。在整个问题中，请使用无量纲单位，并设置光速 $c=1$。\n\n从基本且经过充分检验的原理开始：\n- 无源、频率积分（灰体）的一维辐射矩方程为\n$$\n\\partial_t E + \\partial_x F = 0, \\qquad \\partial_t F + \\partial_x P = 0,\n$$\n其中 $P$ 是辐射压强。\n- 需要一个矩闭合关系来将 $P$ 表示为 $(E,F)$ 的函数。在灰体 M1 框架中，压强由下式给出\n$$\nP = \\chi(f)\\, E, \\qquad f = \\frac{F}{c E},\n$$\n其中 $\\chi(f)$ 是爱丁顿因子，$f$ 是约化通量。在本问题中，$c=1$，因此 $f=F/E$。\n- 使用 Levermore-M1（也称为最大熵 Minerbo）闭合关系，其爱丁顿因子为\n$$\n\\chi(f) = \\frac{3 + 4 f^2}{5 + 2\\sqrt{4 - 3 f^2}}, \\quad \\text{for } \\lvert f \\rvert \\leq 1.\n$$\n\n基于这些基础，推导状态向量 $U=(E,F)^\\top$ 和通量 $F(U)=(F, P)^\\top$ 的守恒形式一维双曲系统。计算雅可比矩阵 $A(U) = \\partial F/\\partial U$ 作为 $(E,F)$ 的函数，并用 $E$、$F$、$\\chi(f)$ 和 $\\mathrm{d}\\chi/\\mathrm{d}f$ 表示其特征值 $\\lambda_\\pm$。使用这些特征值定义左右状态 $(U_L,U_R)$ 之间 HLL 通量的左右信号速度 $(s_L,s_R)$，并构建 HLL 数值通量。明确说明如何在离散格式中确保 $E$ 的正性和物理约束 $\\lvert F \\rvert \\leq E$。使用带有 Courant–Friedrichs–Lewy (CFL) 条件的守恒显式更新。\n\n您的程序必须实现：\n- 在 $[0,1]$ 上对所有测试使用带周期性边界的均匀网格有限体积离散化。\n- 一个显式向前欧拉时间积分器，其时间步长 $\\Delta t$ 满足基于域内最大绝对特征值的适当 CFL 条件。\n- 在每个界面处使用 HLL 通量，其信号速度设置为根据 $U_L$ 和 $U_R$ 计算出的特征值的最小值和最大值。\n- 一个保持正性的后处理限制器，它强制执行 $E \\ge \\varepsilon$（其中 $\\varepsilon > 0$ 是一个小的“底”值）以及物理约束 $\\lvert F \\rvert \\leq E$。\n\n科学和数值要求：\n- 使用 $c=1$ 且无物理单位；所有量均为无量纲。\n- 不出现角度；不需要角度单位。\n- 从第一性原理设计格式，并用 $E$、$F$、$\\chi(f)$ 和 $\\mathrm{d}\\chi/\\mathrm{d}f$ 明确写出所有公式；不要使用任何未经推导的简化公式。\n\n测试套件：\n在 $[0,1]$ 上使用周期性边界为以下四个测试用例实现并运行该方法。对于每个用例，使用一个包含 $N$ 个单元的均匀网格、一个固定的最终时间 $T$ 和一个 CFL 数 $\\nu$：\n1. 理想情况下的光滑脉冲：\n   - $N = 200$, $T = 0.10$, $\\nu = 0.40$,\n   - 初始条件：$E(x) = 1 + 0.1 \\exp\\big(-\\frac{(x-0.5)^2}{2 \\sigma^2}\\big)$，其中 $\\sigma = 0.05$，$F(x) = 0.2\\,E(x)$。\n2. 近真空鲁棒性：\n   - $N = 200$, $T = 0.05$, $\\nu = 0.40$,\n   - 初始条件：$E(x) = 10^{-6} + 10^{-3}\\,\\mathbf{1}_{\\lvert x-0.5 \\rvert  0.1}$，$F(x) = 0$，其中 $\\mathbf{1}_S$ 是集合 $S$ 的指示函数。\n3. 近自由传播：\n   - $N = 200$, $T = 0.05$, $\\nu = 0.40$,\n   - 初始条件：$E(x) = 1$，$F(x) = 0.9\\,E(x)$。\n4. 黎曼型间断：\n   - $N = 200$, $T = 0.05$, $\\nu = 0.40$,\n   - 初始条件：当 $x  0.5$ 时 $E(x) = 1$，当 $x \\ge 0.5$ 时 $E(x) = 0.1$，且 $F(x) = 0$。\n\n对于每个测试用例，将求解器运行到时间 $T$，并检查所有单元的正性和通量界：\n- 条件 $C_1$：$\\min_i E_i(T) \\ge 0$。\n- 条件 $C_2$：$\\max_i \\big(\\lvert F_i(T) \\rvert - E_i(T)\\big) \\le 0$。\n您的程序必须为每个测试用例输出一个布尔值，表示 $C_1$ 和 $C_2$ 是否同时成立。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含按顺序排列的四个测试用例的布尔结果，格式为逗号分隔并用方括号括起来的列表，例如，`[True,False,True,True]`。", "solution": "该问题要求设计并实现一个用于灰体一阶矩系统（M1）辐射转移的一维有限体积法。解决方案将从第一性原理出发构建，从控制方程开始，推导数值格式所需的所有必要组件。\n\n### 1. 灰体 M1 系统与闭合关系\n无源一维系统的控制方程描述了辐射能量密度 $E$ 和辐射通量 $F$ 的守恒：\n$$\n\\partial_t E + \\partial_x F = 0\n$$\n$$\n\\partial_t F + \\partial_x P = 0\n$$\n其中 $P$ 是辐射压强。这个偏微分方程组可以表示为守恒向量形式 $\\partial_t U + \\partial_x \\mathcal{F}(U) = 0$，其中状态向量 $U$ 和通量向量 $\\mathcal{F}(U)$ 定义如下：\n$$\nU = \\begin{pmatrix} E \\\\ F \\end{pmatrix}, \\qquad \\mathcal{F}(U) = \\begin{pmatrix} F \\\\ P \\end{pmatrix}\n$$\n需要一个闭合关系来将压强 $P$ 表示为守恒变量 $E$ 和 $F$ 的函数。问题指定了 M1 闭合关系，其中 $P = \\chi(f) E$。量 $f$ 是约化通量，定义为 $f = F/(cE)$。当光速设为 $c=1$ 时，这简化为 $f=F/E$。变量的物理域受到 $E \\ge 0$ 和通量不能超过能量密度的约束，即 $|F| \\le E$，这对应于 $|f| \\le 1$。\n\n问题指定了 Levermore-M1（或 Minerbo）闭合关系，其中爱丁顿因子 $\\chi(f)$ 由下式给出：\n$$\n\\chi(f) = \\frac{3 + 4 f^2}{5 + 2\\sqrt{4 - 3 f^2}}, \\quad \\text{for } |f| \\le 1\n$$\n这个闭合关系使得通量向量 $\\mathcal{F}(U)$ 可以完全用状态向量 $U$ 的分量来表示：\n$$\n\\mathcal{F}(U) = \\begin{pmatrix} F \\\\ \\chi(F/E) E \\end{pmatrix}\n$$\n\n### 2. 通量雅可比矩阵及其特征值\n为了分析系统的波结构并构建 Harten–Lax–van Leer (HLL) 求解器，我们必须计算通量向量的雅可比矩阵 $A(U) = \\partial \\mathcal{F}(U) / \\partial U$。\n$$\nA(U) = \\frac{\\partial \\mathcal{F}(U)}{\\partial U} = \\begin{pmatrix} \\frac{\\partial F}{\\partial E}  \\frac{\\partial F}{\\partial F} \\\\ \\frac{\\partial P}{\\partial E}  \\frac{\\partial P}{\\partial F} \\end{pmatrix}\n$$\n雅可比矩阵的分量计算如下。顶行是平凡的：$\\partial F/\\partial E = 0$ 和 $\\partial F/\\partial F = 1$。对于底行，我们对 $P(E,F) = \\chi(F/E)E$ 使用链式法则。设 $\\chi' = \\mathrm{d}\\chi/\\mathrm{d}f$：\n$$\n\\frac{\\partial P}{\\partial F} = \\frac{\\partial}{\\partial F} \\left( \\chi(f) E \\right) = E \\frac{\\mathrm{d}\\chi}{\\mathrm{d}f} \\frac{\\partial f}{\\partial F} = E \\chi' \\left( \\frac{1}{E} \\right) = \\chi'\n$$\n$$\n\\frac{\\partial P}{\\partial E} = \\frac{\\partial}{\\partial E} \\left( \\chi(f) E \\right) = \\chi(f) \\cdot 1 + E \\frac{\\mathrm{d}\\chi}{\\mathrm{d}f} \\frac{\\partial f}{\\partial E} = \\chi(f) + E \\chi' \\left( -\\frac{F}{E^2} \\right) = \\chi(f) - \\frac{F}{E} \\chi' = \\chi - f \\chi'\n$$\n因此，雅可比矩阵为：\n$$\nA(U) = \\begin{pmatrix} 0  1 \\\\ \\chi - f \\chi'  \\chi' \\end{pmatrix}\n$$\n$A(U)$ 的特征值 $\\lambda$ 代表了系统的特征波速，是特征方程 $\\det(A - \\lambda I) = 0$ 的根：\n$$\n\\det \\begin{pmatrix} -\\lambda  1 \\\\ \\chi - f \\chi'  \\chi' - \\lambda \\end{pmatrix} = (-\\lambda)(\\chi' - \\lambda) - (\\chi - f \\chi') = \\lambda^2 - \\chi' \\lambda - (\\chi - f \\chi') = 0\n$$\n解此关于 $\\lambda$ 的二次方程，得到两个特征值：\n$$\n\\lambda_{\\pm}(U) = \\frac{\\chi' \\pm \\sqrt{(\\chi')^2 + 4(\\chi - f \\chi')}}{2}\n$$\n只要判别式 $\\Delta = (\\chi')^2 + 4(\\chi - f \\chi')$ 为正，系统就是严格双曲的。对于给定的 Levermore-M1 闭合关系，这对所有 $|f|1$ 都成立。实现时需要 $\\chi'(f)$ 的显式公式，但对于特征值的此符号推导而言则非必需。\n\n### 3. 有限体积离散化\n空间域 $[0,1]$ 被离散化为 $N$ 个宽度为 $\\Delta x = 1/N$ 的均匀单元。单元中心位于 $x_i = (i+1/2)\\Delta x$，其中 $i=0, \\dots, N-1$。令 $U_i(t)$ 为单元 $i$ 内的单元平均状态。通过将守恒律在单元 $i$（从界面 $x_{i-1/2}$到 $x_{i+1/2}$）上积分，我们得到半离散有限体积格式：\n$$\n\\frac{\\mathrm{d}U_i}{\\mathrm{d}t} = -\\frac{1}{\\Delta x} \\left( \\mathcal{F}^*_{i+1/2} - \\mathcal{F}^*_{i-1/2} \\right)\n$$\n其中 $\\mathcal{F}^*_{i+1/2}$ 是单元 $i$ 和单元 $i+1$ 之间界面处的数值通量。\n\n### 4. HLL 近似黎曼求解器\n数值通量 $\\mathcal{F}^*_{i+1/2}$ 使用 HLL 近似黎曼求解器计算。给定界面处的左状态 $U_L = U_i$ 和右状态 $U_R = U_{i+1}$，HLL 通量为：\n$$\n\\mathcal{F}^*_{HLL}(U_L, U_R) = \\begin{cases} \\mathcal{F}(U_L)  \\text{if } s_L \\ge 0 \\\\ \\frac{s_R \\mathcal{F}(U_L) - s_L \\mathcal{F}(U_R) + s_L s_R (U_R - U_L)}{s_R - s_L}  \\text{if } s_L  0  s_R \\\\ \\mathcal{F}(U_R)  \\text{if } s_R \\le 0 \\end{cases}\n$$\n信号速度 $s_L$ 和 $s_R$ 是对界面处黎曼扇中最慢和最快波的估计。按规定，我们使用 Davis (1988) 估计，该估计基于左右状态的最小和最大特征值：\n$$\ns_L = \\min(\\lambda_-(U_L), \\lambda_-(U_R))\n$$\n$$\ns_R = \\max(\\lambda_+(U_L), \\lambda_+(U_R))\n$$\n其中 $\\lambda_-(U)$ 和 $\\lambda_+(U)$ 分别是针对给定状态 $U$ 计算的较小和较大的特征值。\n\n### 5. 时间积分与 CFL 条件\n使用显式向前欧拉方法进行时间积分：\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x} \\left( (\\mathcal{F}^*)_{i+1/2}^n - (\\mathcal{F}^*)_{i-1/2}^n \\right)\n$$\n其中上标 $n$ 表示时间层。时间步长 $\\Delta t$ 必须满足 Courant–Friedrichs–Lewy (CFL) 条件以保证稳定性：\n$$\n\\Delta t = \\nu \\frac{\\Delta x}{\\lambda_{\\text{max}}}\n$$\n其中 $\\nu$ 是 CFL 数（给定为 $0.40$），$\\lambda_{\\text{max}}$ 是在时间 $t^n$ 时整个网格上的最大绝对波速：\n$$\n\\lambda_{\\text{max}} = \\max_{i=0, \\dots, N-1} \\left( \\max(|\\lambda_-(U_i^n)|, |\\lambda_+(U_i^n)|) \\right)\n$$\n\n### 6. 保证正性和物理性的限制器\n向前欧拉更新本身不保证更新后的状态 $U_i^{n+1}$ 是物理上有效的，即 $E_i^{n+1}  0$ 且 $|F_i^{n+1}| \\le E_i^{n+1}$。必须应用一个后处理限制器。设欧拉步得到的未限制更新状态为 $U_i^{\\text{upd}} = (E_i^{\\text{upd}}, F_i^{\\text{upd}})$。物理上有效的状态 $U_i^{n+1}$ 通过以下两步过程获得：\n\n1.  **能量密度的正性**：能量密度被强制置于一个小的正“底”值 $\\varepsilon$之上：\n    $$ E_i^{n+1} = \\max(E_i^{\\text{upd}}, \\varepsilon) $$\n    一个小的数值（如 $\\varepsilon=10^{-12}$）可以防止后续计算 $f$ 时出现除以零的情况，并保持正性。\n\n2.  **通量限制**：约化通量 $f_i^{n+1} = F_i^{n+1}/E_i^{n+1}$ 必须满足 $|f_i^{n+1}| \\le 1$ 以确保双曲性和物理性。更新后的通量 $F_i^{\\text{upd}}$ 会相应调整。我们计算一个测试约化通量 $f_{\\text{test}} = F_i^{\\text{upd}} / E_i^{n+1}$（使用刚刚限制过的能量密度）。如果 $|f_{\\text{test}}| \\ge 1$，则将通量缩放回物理域内。为避免 $|f|=1$ 处的奇异边界，我们将其缩放到一个略小于 $1$ 的值，例如 $1-\\delta$，其中 $\\delta$ 是一个小的容差。\n    $$\n    F_i^{n+1} = \\begin{cases}\n    (1-\\delta) E_i^{n+1}  \\text{if } f_{\\text{test}} \\ge 1-\\delta \\\\\n    -(1-\\delta) E_i^{n+1}  \\text{if } f_{\\text{test}} \\le -(1-\\delta) \\\\\n    F_i^{\\text{upd}}  \\text{otherwise}\n    \\end{cases}\n    $$\n    这种保护措施确保传递到下一个时间步的状态始终处于物理的、严格双曲的区域。\n\n### 7. 周期性边界条件\n对于一个有 $N$ 个单元（索引为 $i=0, \\dots, N-1$）的网格，周期性边界意味着单元 $0$ 的左邻居是单元 $N-1$，而单元 $N-1$ 的右邻居是单元 $0$。这在计算单元界面处的数值通量时处理。例如，用于单元 $0$ 更新的通量 $(\\mathcal{F}^*)_{-1/2}$ 是使用状态 $U_L = U_{N-1}$ 和 $U_R = U_0$ 计算的。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# A small tolerance to prevent division by zero or other numerical issues.\n# Also used for flux limiting near the |f|=1 boundary.\nTOL = 1e-12\n\ndef levermore_chi(f):\n    \"\"\"\n    Computes the Levermore-M1 Eddington factor chi(f).\n    f is the reduced flux, |f| = 1.\n    \"\"\"\n    f_sq = f**2\n    # The limiter ensures 4 - 3*f^2 >= 1, so the sqrt argument is safe and positive.\n    g = np.sqrt(4.0 - 3.0 * f_sq)\n    return (3.0 + 4.0 * f_sq) / (5.0 + 2.0 * g)\n\ndef levermore_dchi_df(f):\n    \"\"\"\n    Computes the derivative of the Levermore-M1 Eddington factor, d(chi)/df.\n    \"\"\"\n    # The derivative is an odd function, so dchi/df(0) = 0.\n    # We handle f=0 separately to avoid potential 0/0 issues in a naive formula.\n    result = np.zeros_like(f)\n    nonzero_f = np.abs(f) > TOL\n\n    f_nz = f[nonzero_f]\n    f_sq = f_nz**2\n    # The limiter ensures the argument is positive.\n    g = np.sqrt(4.0 - 3.0 * f_sq)\n    \n    # Numerator of the derivative formula derived via symbolic differentiation.\n    num = f_nz * (40.0 * g + 82.0 - 24.0 * f_sq)\n    # Denominator of the derivative formula.\n    den = g * (5.0 + 2.0 * g)**2\n    \n    result[nonzero_f] = num / den\n    return result\n\ndef get_eigenvalues(E, F):\n    \"\"\"\n    Computes the eigenvalues of the M1 system Jacobian.\n    \"\"\"\n    # Floor for energy to prevent division by zero for f.\n    E_floor = np.maximum(E, TOL)\n    f = F / E_floor\n    \n    # Clip f to be strictly within (-1, 1) to handle any numerical errors\n    # and satisfy the precondition for the closure functions.\n    f = np.clip(f, -(1.0 - TOL), 1.0 - TOL)\n    \n    chi_val = levermore_chi(f)\n    dchi_df_val = levermore_dchi_df(f)\n    \n    # Discriminant of the characteristic quadratic equation for eigenvalues.\n    discriminant = dchi_df_val**2 + 4.0 * (chi_val - f * dchi_df_val)\n    # Ensure non-negativity due to potential floating-point inaccuracies.\n    sqrt_discriminant = np.sqrt(np.maximum(0.0, discriminant))\n    \n    lambda_p = 0.5 * (dchi_df_val + sqrt_discriminant)\n    lambda_m = 0.5 * (dchi_df_val - sqrt_discriminant)\n    \n    return lambda_m, lambda_p\n\ndef hll_flux(Ul, Ur, Fl, Fr, sL, sR):\n    \"\"\"\n    Computes the HLL numerical flux given left/right states, fluxes, and signal speeds.\n    \"\"\"\n    # The HLL flux is given by a three-case piecewise function. The three cases\n    # (sL >= 0), (sR = 0), and (sL  0  sR) are mutually exclusive.\n    flux = np.zeros_like(Ul)\n    \n    # Case 1: sL >= 0. The entire Riemann fan moves to the right. Use left flux.\n    mask1 = sL >= 0\n    flux[:, mask1] = Fl[:, mask1]\n    \n    # Case 3: sR = 0. The entire Riemann fan moves to the left. Use right flux.\n    mask3 = sR = 0\n    flux[:, mask3] = Fr[:, mask3]\n    \n    # Case 2: sL  0  sR. The star region is between the waves.\n    mask2 = (sL  0)  (sR > 0)\n    \n    num = sR[mask2] * Fl[:, mask2] - sL[mask2] * Fr[:, mask2] + sL[mask2] * sR[mask2] * (Ur[:, mask2] - Ul[:, mask2])\n    den = sR[mask2] - sL[mask2]\n    \n    flux[:, mask2] = num / den\n    \n    return flux\n\ndef run_simulation(N, T, nu, E0_func, F0_func):\n    \"\"\"\n    Runs a single M1 simulation case and checks final state physicality.\n    \"\"\"\n    # Grid setup\n    dx = 1.0 / N\n    x = np.linspace(dx / 2.0, 1.0 - dx / 2.0, N)\n    \n    # Initial conditions\n    E = E0_func(x)\n    F = F0_func(x, E)\n    U = np.array([E, F])\n    \n    t = 0.0\n    while t  T:\n        # 1. Calculate CFL-limited time step\n        lambda_m, lambda_p = get_eigenvalues(U[0, :], U[1, :])\n        max_abs_lambda = np.max(np.maximum(np.abs(lambda_m), np.abs(lambda_p)))\n        \n        if max_abs_lambda  TOL: # Handle static case\n            dt = T - t\n        else:\n            dt = nu * dx / max_abs_lambda\n        \n        dt = min(dt, T - t)\n        \n        # 2. Compute interface fluxes using HLL\n        # Periodic boundaries: roll arrays to get left and right state at interfaces.\n        Ul = U\n        Ur = np.roll(U, -1, axis=1) # U_{i+1} for interface i+1/2\n\n        # Calculate fluxes F(U) for left and right states\n        # Protect against division by zero for f\n        f_l = Ul[1,:] / np.maximum(TOL, Ul[0,:])\n        f_r = Ur[1,:] / np.maximum(TOL, Ur[0,:])\n        Fl = np.array([Ul[1,:], levermore_chi(f_l) * Ul[0,:]])\n        Fr = np.array([Ur[1,:], levermore_chi(f_r) * Ur[0,:]])\n        \n        # Get eigenvalues for left and right states\n        lambda_m_l, lambda_p_l = get_eigenvalues(Ul[0, :], Ul[1, :])\n        lambda_m_r, lambda_p_r = get_eigenvalues(Ur[0, :], Ur[1, :])\n        \n        # Davis (1988) signal speed estimates\n        sL = np.minimum(lambda_m_l, lambda_m_r)\n        sR = np.maximum(lambda_p_l, lambda_p_r)\n        \n        # Compute HLL fluxes at interfaces x_{i+1/2}\n        F_iph = hll_flux(Ul, Ur, Fl, Fr, sL, sR)\n        \n        # Get fluxes at x_{i-1/2} by rolling the array of interface fluxes\n        F_imh = np.roll(F_iph, 1, axis=1)\n        \n        # 3. Update state vector (Forward Euler)\n        U_upd = U - (dt / dx) * (F_iph - F_imh)\n        \n        # 4. Apply post-update limiter for positivity and physicality\n        E_new = np.maximum(U_upd[0, :], TOL)\n        F_new = U_upd[1, :]\n        \n        f_test = F_new / np.maximum(E_new, TOL)\n        \n        # Enforce |f| = 1\n        limit_factor = 1.0 - TOL\n        mask_too_high = f_test > limit_factor\n        mask_too_low = f_test  -limit_factor\n        \n        F_new[mask_too_high] = limit_factor * E_new[mask_too_high]\n        F_new[mask_too_low] = -limit_factor * E_new[mask_too_low]\n        \n        U = np.array([E_new, F_new])\n        \n        # 5. Advance time\n        t += dt\n\n    # Final checks for positivity and physicality\n    E_final = U[0, :]\n    F_final = U[1, :]\n    \n    c1 = np.min(E_final) >= 0.0\n    c2 = np.max(np.abs(F_final) - E_final) = 0.0 # Will be = -TOL*E on limited cells\n    \n    return c1 and c2\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run the simulations, and print results.\n    \"\"\"\n    sigma = 0.05\n    test_cases = [\n        { # 1. Happy-path smooth pulse\n            \"N\": 200, \"T\": 0.10, \"nu\": 0.40,\n            \"E0_func\": lambda x: 1.0 + 0.1 * np.exp(-(x - 0.5)**2 / (2.0 * sigma**2)),\n            \"F0_func\": lambda x, E: 0.2 * E\n        },\n        { # 2. Near-vacuum robustness\n            \"N\": 200, \"T\": 0.05, \"nu\": 0.40,\n            \"E0_func\": lambda x: 1e-6 + 1e-3 * (np.abs(x - 0.5)  0.1),\n            \"F0_func\": lambda x, E: 0.0 * E\n        },\n        { # 3. Near free-streaming\n            \"N\": 200, \"T\": 0.05, \"nu\": 0.40,\n            \"E0_func\": lambda x: np.ones_like(x),\n            \"F0_func\": lambda x, E: 0.9 * E\n        },\n        { # 4. Riemann-type discontinuity\n            \"N\": 200, \"T\": 0.05, \"nu\": 0.40,\n            \"E0_func\": lambda x: 1.0 * (x  0.5) + 0.1 * (x >= 0.5),\n            \"F0_func\": lambda x, E: 0.0 * E\n        }\n    ]\n    \n    results = []\n    for case in test_cases:\n        result = run_simulation(case[\"N\"], case[\"T\"], case[\"nu\"], case[\"E0_func\"], case[\"F0_func\"])\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3479813"}, {"introduction": "任何近似方法都有其局限性，理解这些局限性与理解方法本身同样重要。这最后一个练习提供了一个批判性的视角，通过将M1矩方法与精确的射线追踪解进行直接比较，尤其是在辐射束交叉形成角焦散的挑战性场景中。通过亲手实现并量化两者之间的差异[@problem_id:3479787]，你将深入理解M1闭合的内在弱点，以及为何射线追踪方法在这些情况下仍然是黄金标准。", "problem": "您的任务是为三个非共线辐射源在真空中的情况，构建并比较由矩闭合模型和基于射线的模型所预测的二阶矩辐射各向异性。目标是使用爱丁顿张量的本征结构作为诊断工具，量化一阶矩闭合（M1）在存在多个产生角焦散的非共线光束时的行为。\n\n从以下基本基础开始。考虑在稳态、光学薄真空中的比强度 $I(\\boldsymbol{n})$。角矩定义为\n$$\nE = \\frac{1}{c} \\int I(\\boldsymbol{n}) \\, d\\Omega, \\quad \\boldsymbol{F} = \\int I(\\boldsymbol{n}) \\boldsymbol{n} \\, d\\Omega, \\quad \\mathsf{P} = \\frac{1}{c} \\int I(\\boldsymbol{n}) \\boldsymbol{n}\\boldsymbol{n} \\, d\\Omega,\n$$\n其中 $E$ 是辐射能量密度，$\\boldsymbol{F}$ 是辐射通量，$\\mathsf{P}$ 是辐射压力张量，$c$ 是光速，爱丁顿张量为 $\\mathsf{D} = \\mathsf{P} / E$。定义归约通量 $f = \\|\\boldsymbol{F}\\|/(c E) \\in [0,1]$。在 M1 闭合（一阶矩闭合）中，我们写作\n$$\n\\mathsf{D}_{\\mathrm{M1}} = \\frac{1 - \\chi}{2} \\mathsf{I} + \\frac{3\\chi - 1}{2} \\, \\hat{\\boldsymbol{F}} \\hat{\\boldsymbol{F}},\n$$\n对于 $f \\neq 0$，有 $\\hat{\\boldsymbol{F}} = \\boldsymbol{F}/\\|\\boldsymbol{F}\\|$，并且 $\\chi = \\chi(f)$ 由 Levermore–Minerbo 表达式给出\n$$\n\\chi(f) = \\frac{3 + 4 f^2}{5 + 2\\sqrt{4 - 3 f^2}}.\n$$\n在真空中对于 $N$ 个点源的精确几何光学极限下，每个源在场点的比强度被限制在沿视线的 delta 函数束中，因此在场点的基于射线的爱丁顿张量可以计算为\n$$\n\\mathsf{D}_{\\mathrm{ray}} = \\frac{\\sum_{i=1}^{N} w_i \\, \\boldsymbol{n}_i \\boldsymbol{n}_i}{\\sum_{i=1}^{N} w_i},\n$$\n其中 $\\boldsymbol{n}_i$ 是从场点到源 $i$ 的单位向量，$w_i \\propto L_i / r_i^2$，$L_i$ 是源的光度，$r_i$ 是从场点到源 $i$ 的距离。相应的归约通量可以计算为\n$$\nf = \\frac{\\left\\|\\sum_{i=1}^{N} w_i \\, \\boldsymbol{n}_i \\right\\|}{\\sum_{i=1}^{N} w_i},\n$$\n这里忽略了一个在 $f$ 和 $\\mathsf{D}_{\\mathrm{ray}}$ 中都精确抵消的整体正常数因子。\n\n您的程序必须严格以无量纲形式实现以下任务（任何地方都不得使用物理单位；所有量都应视为无单位量）：\n\n- 设置三个点源，位置如下\n$$\n\\boldsymbol{s}_1 = (-1, 0, 0), \\quad \\boldsymbol{s}_2 = (1, 0, 0), \\quad \\boldsymbol{s}_3 = \\left(0, \\sqrt{3}, 0\\right),\n$$\n光度相等 $L_1 = L_2 = L_3 = 1$。对于任何场点 $\\boldsymbol{x}$，为每个源 $i$ 定义向量 $\\boldsymbol{d}_i = \\boldsymbol{s}_i - \\boldsymbol{x}$，距离 $r_i = \\|\\boldsymbol{d}_i\\|$，单位方向 $\\boldsymbol{n}_i = \\boldsymbol{d}_i / r_i$，以及权重 $w_i = L_i / r_i^2$。\n\n- 对于每个测试场点，计算 $\\mathsf{D}_{\\mathrm{ray}}$ 和归约通量 $f$。根据 $f$ 和 $\\hat{\\boldsymbol{F}} = \\left(\\sum_i w_i \\boldsymbol{n}_i\\right) / \\left\\|\\sum_i w_i \\boldsymbol{n}_i\\right\\|$（对于 $f \\neq 0$），使用上面的 M1 公式计算 $\\mathsf{D}_{\\mathrm{M1}}$。在 $f = 0$ 的特殊情况下，定义 $\\mathsf{D}_{\\mathrm{M1}} = \\mathsf{I}/3$，不使用 $\\hat{\\boldsymbol{F}}$。\n\n- 作为角焦散和光束交叉的诊断工具，为每个场点计算弗罗贝尼乌斯范数差异\n$$\n\\Delta = \\left\\|\\mathsf{D}_{\\mathrm{M1}} - \\mathsf{D}_{\\mathrm{ray}}\\right\\|_{\\mathrm{F}} = \\sqrt{\\mathrm{tr}\\left[\\left(\\mathsf{D}_{\\mathrm{M1}} - \\mathsf{D}_{\\mathrm{ray}}\\right)^{\\mathsf{T}}\\left(\\mathsf{D}_{\\mathrm{M1}} - \\mathsf{D}_{\\mathrm{ray}}\\right)\\right]},\n$$\n并计算 $\\mathsf{D}_{\\mathrm{ray}}$ 和 $\\mathsf{D}_{\\mathrm{M1}}$ 的本征值，每个都按非递增顺序排序。\n\n您的程序应为以下测试场点套件实现上述功能：\n- 情况 1（在三角形中心对称的三束交叉）：$\\boldsymbol{x}^{(1)} = \\left(0, \\frac{\\sqrt{3}}{3}, 0\\right)$。\n- 情况 2（近单束主导）：$\\boldsymbol{x}^{(2)} = \\left(-\\frac{1}{2}, 0, 0\\right)$。\n- 情况 3（双束对射及第三束离轴）：$\\boldsymbol{x}^{(3)} = (0, 0, 0)$。\n- 情况 4（一般的偏离中心点）：$\\boldsymbol{x}^{(4)} = (0.2, 0.1, 0)$。\n\n对于每种情况 $k \\in \\{1,2,3,4\\}$，将标量结果定义为在 $\\boldsymbol{x}^{(k)}$ 处 $\\mathsf{D}_{\\mathrm{M1}}$ 和 $\\mathsf{D}_{\\mathrm{ray}}$ 之间的弗罗贝尼乌斯范数差异 $\\Delta^{(k)}$，表示为一个无量纲浮点数。您的程序必须输出一行，其中包含这四个结果的列表，以逗号分隔，并用方括号括起来，顺序为情况 1 到 4，例如 $[a,b,c,d]$，其中 $a、b、c、d$ 均为浮点数的小数表示。不应打印任何其他文本。\n\n该测试套件旨在涵盖：\n- 一个 $f = 0$ 的对称角焦散情况（情况 1），\n- 一个 $f \\approx 1$ 的近自由流情况（情况 2），\n- 一个带有部分抵消的混合交叉情况（情况 3），\n- 一个一般的离轴配置（情况 4）。\n\n您的实现必须是一个完整、可运行的程序，按照规定以数值方式执行所有计算，并以所描述的精确格式生成最终输出行。", "solution": "该问题陈述已经过验证，被认为是科学上合理、定义明确、客观且自洽的。它提出了计算辐射转移领域中一个标准且有意义的任务：将基于矩的闭合近似（M1）与几何光学极限下的精确射线解进行比较。所有必要的定义、方程和参数都已提供，不存在内部矛盾或歧义。因此，该问题被认为是有效的，并将提供一个解决方案。\n\n目标是计算一阶矩（M1）闭合预测的爱丁顿张量 $\\mathsf{D}_{\\mathrm{M1}}$ 与射线追踪极限下的精确爱丁顿张量 $\\mathsf{D}_{\\mathrm{ray}}$ 之间的差异，该系统由三个点源组成。这种差异可以衡量 M1 闭合在涉及非共线辐射束场景中的准确性。\n\n对于给定的场点 $\\boldsymbol{x}$，总体步骤如下。给定三个源，位置分别为 $\\boldsymbol{s}_1 = (-1, 0, 0)$、$\\boldsymbol{s}_2 = (1, 0, 0)$ 和 $\\boldsymbol{s}_3 = (0, \\sqrt{3}, 0)$，每个源的光度均为单位光度 $L_i=1$。对于每个源 $i \\in \\{1, 2, 3\\}$，我们首先计算几何量：\n从场点到源的向量为 $\\boldsymbol{d}_i = \\boldsymbol{s}_i - \\boldsymbol{x}$。\n距离为 $r_i = \\|\\boldsymbol{d}_i\\|$。\n单位方向向量为 $\\boldsymbol{n}_i = \\boldsymbol{d}_i / r_i$。\n与源 $i$ 在点 $\\boldsymbol{x}$ 处的辐射相关的权重为 $w_i = L_i / r_i^2 = 1/r_i^2$。\n\n有了这些量，我们就可以构建爱丁顿张量。基于射线的爱丁顿张量在这种光学薄真空场景中是精确的，它是方向向量外积的加权平均：\n$$\n\\mathsf{D}_{\\mathrm{ray}} = \\frac{\\sum_{i=1}^{3} w_i \\boldsymbol{n}_i \\boldsymbol{n}_i^{\\mathsf{T}}}{\\sum_{i=1}^{3} w_i}\n$$\n其中 $\\boldsymbol{n}_i \\boldsymbol{n}_i^{\\mathsf{T}}$ 是外积。\n\n为了构建 M1 闭合张量，我们首先需要归约通量 $f$。它由相同的权重和方向向量计算得出：\n$$\nf = \\frac{\\left\\|\\sum_{i=1}^{3} w_i \\boldsymbol{n}_i \\right\\|}{\\sum_{i=1}^{3} w_i}\n$$\n如果 $f  0$，我们定义单位通量向量 $\\hat{\\boldsymbol{F}} = \\frac{\\sum w_i \\boldsymbol{n}_i}{\\|\\sum w_i \\boldsymbol{n}_i\\|}$。M1 张量则由以下公式给出：\n$$\n\\mathsf{D}_{\\mathrm{M1}} = \\frac{1 - \\chi(f)}{2} \\mathsf{I} + \\frac{3\\chi(f) - 1}{2} \\hat{\\boldsymbol{F}} \\hat{\\boldsymbol{F}}^{\\mathsf{T}}\n$$\n其中 $\\mathsf{I}$ 是 $3 \\times 3$ 单位矩阵，$\\chi(f)$ 是 Levermore-Minerbo 爱丁顿因子：\n$$\n\\chi(f) = \\frac{3 + 4 f^2}{5 + 2\\sqrt{4 - 3 f^2}}\n$$\n在净通量为零的特殊情况，即 $f=0$ 时，M1 闭合默认为各向同性状态，$\\mathsf{D}_{\\mathrm{M1}} = \\frac{1}{3}\\mathsf{I}$。\n\n两个模型之间的差异由张量之差的弗罗贝尼乌斯范数来量化：\n$$\n\\Delta = \\left\\|\\mathsf{D}_{\\mathrm{M1}} - \\mathsf{D}_{\\mathrm{ray}}\\right\\|_{\\mathrm{F}} = \\sqrt{\\mathrm{tr}\\left[\\left(\\mathsf{D}_{\\mathrm{M1}} - \\mathsf{D}_{\\mathrm{ray}}\\right)^{\\mathsf{T}}\\left(\\mathsf{D}_{\\mathrm{M1}} - \\mathsf{D}_{\\mathrm{ray}}\\right)\\right]}\n$$\n现在我们将此过程应用于四个指定的场点。\n\n情况 1：在 $\\boldsymbol{x}^{(1)} = \\left(0, \\frac{\\sqrt{3}}{3}, 0\\right)$ 处的对称交叉。\n该点是三个源形成的等边三角形的质心。到所有源的距离相等：$r_1=r_2=r_3=2/\\sqrt{3}$。因此，权重也相等：$w_1=w_2=w_3=3/4$。方向向量为 $\\boldsymbol{n}_1 = (-\\sqrt{3}/2, -1/2, 0)$、$\\boldsymbol{n}_2 = (\\sqrt{3}/2, -1/2, 0)$ 和 $\\boldsymbol{n}_3 = (0, 1, 0)$。总和 $\\sum w_i \\boldsymbol{n}_i$ 与 $\\sum \\boldsymbol{n}_i = \\boldsymbol{0}$ 成正比，这意味着归约通量 $f=0$。\n对于基于射线的张量，我们发现：\n$$\n\\mathsf{D}_{\\mathrm{ray}} = \\frac{1}{3} \\sum_{i=1}^{3} \\boldsymbol{n}_i \\boldsymbol{n}_i^{\\mathsf{T}} = \\frac{1}{3} \\left( \\begin{pmatrix} 3/4  \\sqrt{3}/4  0 \\\\ \\sqrt{3}/4  1/4  0 \\\\ 0  0  0 \\end{pmatrix} + \\begin{pmatrix} 3/4  -\\sqrt{3}/4  0 \\\\ -\\sqrt{3}/4  1/4  0 \\\\ 0  0  0 \\end{pmatrix} + \\begin{pmatrix} 0  0  0 \\\\ 0  1  0 \\\\ 0  0  0 \\end{pmatrix} \\right) = \\begin{pmatrix} 1/2  0  0 \\\\ 0  1/2  0 \\\\ 0  0  0 \\end{pmatrix}\n$$\n$\\mathsf{D}_{\\mathrm{ray}}$ 的本征值为 $(1/2, 1/2, 0)$，表示一个局限于 $xy$ 平面的平面内各向同性辐射场，这是对三个共面光束对称交叉的正确描述。\n对于 M1 闭合，由于 $f=0$，张量是各向同性的：\n$$\n\\mathsf{D}_{\\mathrm{M1}} = \\frac{1}{3}\\mathsf{I} = \\begin{pmatrix} 1/3  0  0 \\\\ 0  1/3  0 \\\\ 0  0  1/3 \\end{pmatrix}\n$$\nM1 的本征值为 $(1/3, 1/3, 1/3)$。M1 模型未能捕捉场的真实各向异性，错误地预测了完全的各向同性。这是 M1 在角焦散处因通量对称抵消而出现的已知缺陷。\n差异为 $\\Delta^{(1)} = \\sqrt{(-1/6)^2 + (-1/6)^2 + (1/3)^2} = \\sqrt{1/36 + 1/36 + 4/36} = \\sqrt{6/36} = 1/\\sqrt{6} \\approx 0.408248$。\n\n情况 2：在 $\\boldsymbol{x}^{(2)} = (-1/2, 0, 0)$ 处的近单束主导。\n该点靠近源 1。权重为 $w_1=4$，$w_2=4/9 \\approx 0.444$，$w_3=4/13 \\approx 0.308$。辐射场由源 1 主导。\n数值计算给出的归约通量 $f \\approx 0.84078$。这对应于一个近自由流状态，但其他两个源也有显著贡献。\n单位通量方向为 $\\hat{\\boldsymbol{F}} \\approx (-0.985, 0.170, 0)$。\n基于射线的张量计算为 $\\mathsf{D}_{\\mathrm{ray}} \\approx \\begin{pmatrix} 0.871  0.038  0 \\\\ 0.038  0.036  0 \\\\ 0  0  0 \\end{pmatrix}$。其本征值约为 $(0.873, 0.034, 0)$，表示一个由一束主导的高度各向异性的场，具有较小的垂直压力分量。\n当 $f \\approx 0.84078$ 时，我们得到 $\\chi(f) \\approx 0.7678$。M1 张量则为 $\\mathsf{D}_{\\mathrm{M1}} \\approx \\begin{pmatrix} 0.803  -0.143  0 \\\\ -0.143  0.140  0 \\\\ 0  0  0.057 \\end{pmatrix}$。根据其构造，其本征值为 $(\\chi, \\frac{1-\\chi}{2}, \\frac{1-\\chi}{2}) \\approx (0.768, 0.116, 0.116)$。M1 闭合正确地捕捉到了强的各向异性，但假设了围绕净通量向量的轴对称性，而这对于三束配置来说并不完全正确。\n差异为 $\\Delta^{(2)} \\approx 0.201089$。\n\n情况 3：在 $\\boldsymbol{x}^{(3)} = (0, 0, 0)$ 处的双束对射。\n这是原点。距离为 $r_1=1$，$r_2=1$ 和 $r_3=\\sqrt{3}$。权重为 $w_1=1$，$w_2=1$ 和 $w_3=1/3$。\n来自源 1 和源 2 的通量沿 x 轴完全抵消。净通量向量为 $\\boldsymbol{V} = (0, 1/3, 0)$。总权重为 $W=7/3$。归约通量为 $f = (1/3)/(7/3) = 1/7 \\approx 0.142857$。单位通量方向为 $\\hat{\\boldsymbol{F}}=(0, 1, 0)$。\n基于射线的张量为：\n$$\n\\mathsf{D}_{\\mathrm{ray}} = \\frac{3}{7} \\left( 1 \\cdot \\begin{pmatrix}1  0  0 \\\\ 0  0  0 \\\\ 0  0  0\\end{pmatrix} + 1 \\cdot \\begin{pmatrix}1  0  0 \\\\ 0  0  0 \\\\ 0  0  0\\end{pmatrix} + \\frac{1}{3} \\cdot \\begin{pmatrix}0  0  0 \\\\ 0  1  0 \\\\ 0  0  0\\end{pmatrix} \\right) = \\begin{pmatrix} 6/7  0  0 \\\\ 0  1/7  0 \\\\ 0  0  0 \\end{pmatrix}\n$$\n其本征值为 $(6/7, 1/7, 0)$，代表两个强的反向传播束和一个较弱的垂直束。\n对于 M1 张量，$f=1/7$ 给出 $\\chi(1/7) \\approx 0.35996$。M1 的本征值为 $(\\chi, \\frac{1-\\chi}{2}, \\frac{1-\\chi}{2}) \\approx (0.360, 0.320, 0.320)$。\n$$\n\\mathsf{D}_{\\mathrm{M1}} = \\frac{1-\\chi}{2}\\mathsf{I} + \\frac{3\\chi-1}{2} \\begin{pmatrix}0  0  0 \\\\ 0  1  0 \\\\ 0  0  0\\end{pmatrix} \\approx \\begin{pmatrix} 0.320  0  0 \\\\ 0  0.360  0 \\\\ 0  0  0.320 \\end{pmatrix}\n$$\nM1 张量几乎是各向同性的，完全未能捕捉到压力张量沿 x 轴的强束状特性，在该轴上通量为零但压力最大。\n差异为 $\\Delta^{(3)} = \\sqrt{(6/7-0.320)^2 + (1/7-0.360)^2 + (0-0.320)^2} \\approx 0.643325$。\n\n情况 4：在 $\\boldsymbol{x}^{(4)} = (0.2, 0.1, 0)$ 处的一般偏离中心点。\n这是一个没有特殊对称性的一般点。所有计算都必须以数值方式进行。\n权重为 $w_1 = 1/1.45 \\approx 0.690$，$w_2 = 1/0.65 \\approx 1.538$ 和 $w_3 = 1/(0.04 + (\\sqrt{3}-0.1)^2) \\approx 0.369$。\n数值计算发现归约通量为 $f \\approx 0.44391$。\n基于射线的张量为 $\\mathsf{D}_{\\mathrm{ray}} \\approx \\begin{pmatrix} 0.589  -0.198  0 \\\\ -0.198  0.339  0 \\\\ 0  0  0 \\end{pmatrix}$，本征值为 $(0.690, 0.238, 0)$。\n对于 M1 模型，$\\chi(f) \\approx 0.4632$。M1 张量为 $\\mathsf{D}_{\\mathrm{M1}} \\approx \\begin{pmatrix} 0.390  -0.192  0 \\\\ -0.192  0.518  0 \\\\ 0  0  0.268 \\end{pmatrix}$，本征值为 $(0.268, 0.297, 0.611)$。\n差异为 $\\Delta^{(4)} \\approx 0.370535$。\n\n在所有涉及光束交叉的情况（1, 3, 4）中，M1 闭合都显示出与精确解的显著偏差，其中最大的误差发生在通量抵消掩盖了强压力各向异性的地方。正如预期的那样，该模型在近自由流情况（2）中表现最好。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the discrepancy between M1 and ray-tracing Eddington tensors\n    for three point sources at four specified field points.\n    \"\"\"\n    # Define source positions (s_1, s_2, s_3) and luminosities\n    s_sources = np.array([\n        [-1.0, 0.0, 0.0],\n        [1.0, 0.0, 0.0],\n        [0.0, np.sqrt(3.0), 0.0]\n    ])\n    L_sources = np.array([1.0, 1.0, 1.0])\n    num_sources = len(L_sources)\n\n    # Define the test suite of field points (x_1, x_2, x_3, x_4)\n    test_points = [\n        np.array([0.0, np.sqrt(3.0) / 3.0, 0.0]),\n        np.array([-0.5, 0.0, 0.0]),\n        np.array([0.0, 0.0, 0.0]),\n        np.array([0.2, 0.1, 0.0])\n    ]\n\n    results = []\n    \n    for x_point in test_points:\n        # Step 1: Compute geometric quantities for each source\n        # d_i = s_i - x\n        d_vectors = s_sources - x_point\n        \n        # r_i = ||d_i||\n        r_distances = np.linalg.norm(d_vectors, axis=1)\n        \n        # n_i = d_i / r_i\n        # Use r_distances[:, np.newaxis] to enable broadcasting for division\n        n_vectors = d_vectors / r_distances[:, np.newaxis]\n        \n        # w_i = L_i / r_i^2\n        w_weights = L_sources / r_distances**2\n\n        # Step 2: Compute the ray-based Eddington tensor D_ray\n        W_total = np.sum(w_weights)\n        \n        D_ray_numerator = np.zeros((3, 3))\n        for i in range(num_sources):\n            D_ray_numerator += w_weights[i] * np.outer(n_vectors[i], n_vectors[i])\n        \n        D_ray = D_ray_numerator / W_total\n\n        # Step 3: Compute the M1 closure Eddington tensor D_m1\n        # V = sum(w_i * n_i)\n        V_flux_vec = np.sum(w_weights[:, np.newaxis] * n_vectors, axis=0)\n        norm_V = np.linalg.norm(V_flux_vec)\n        \n        # f = ||V|| / W_total\n        f_reduced_flux = norm_V / W_total\n        \n        # Check for the isotropic case (f=0)\n        if np.isclose(f_reduced_flux, 0.0):\n            D_m1 = np.identity(3) / 3.0\n        else:\n            # F_hat = V / ||V||\n            F_hat_direction = V_flux_vec / norm_V\n            \n            # chi(f) = (3 + 4f^2) / (5 + 2*sqrt(4 - 3f^2))\n            chi_factor = (3.0 + 4.0 * f_reduced_flux**2) / \\\n                         (5.0 + 2.0 * np.sqrt(4.0 - 3.0 * f_reduced_flux**2))\n            \n            # D_m1 = (1-chi)/2 * I + (3*chi-1)/2 * F_hat F_hat^T\n            D_m1 = (1.0 - chi_factor) / 2.0 * np.identity(3) + \\\n                   (3.0 * chi_factor - 1.0) / 2.0 * np.outer(F_hat_direction, F_hat_direction)\n\n        # Step 4: Compute the Frobenius norm discrepancy\n        # delta = ||D_m1 - D_ray||_F\n        discrepancy = np.linalg.norm(D_m1 - D_ray, 'fro')\n        results.append(discrepancy)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "3479787"}]}