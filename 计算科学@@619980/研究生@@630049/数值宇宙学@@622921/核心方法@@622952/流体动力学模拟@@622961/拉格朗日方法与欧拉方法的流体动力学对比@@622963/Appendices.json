{"hands_on_practices": [{"introduction": "在模拟宇宙演化时，我们必须将流体力学方程转换到膨胀的（共动）坐标系中。这个变换会引入新的项，例如“哈勃阻力”项，它会阻尼 peculiar velocities。这个练习 [@problem_id:3477164] 提炼出了这个关键项，要求你比较两种简单的时间积分方案，这两种方案分别体现了欧拉方法和拉格朗日方法的精神，从而揭示它们不同的设计哲学如何导致不同水平的计算精度。", "problem": "考虑一个在膨胀的、空间平坦的宇宙中的牛顿、非相对论性、可压缩流体。令物理（固有）坐标为 $\\mathbf{r}$，共动坐标为 $\\mathbf{x}$，宇宙尺度因子为 $a(t)$。坐标之间的映射关系为 $\\mathbf{r}(t) = a(t)\\,\\mathbf{x}(t)$。定义物理速度 $\\mathbf{u}(t,\\mathbf{r}) \\equiv d\\mathbf{r}/dt$ 和本动速度 $\\mathbf{v}(t,\\mathbf{x}) \\equiv a(t)\\,d\\mathbf{x}/dt$，使得 $\\mathbf{u} = H(t)\\,\\mathbf{r} + \\mathbf{v}$，其中 $H(t) \\equiv \\dot{a}/a$ 是哈勃参数。从质量和动量守恒以及流体的牛顿第二定律出发，推导欧拉方程的共动形式，并明确指出动量方程中与 $-H(t)\\,\\mathbf{v}$ 成正比的源项（“哈勃阻力”项）。说明所有作出的假设，并清晰地定义所有变量。你必须从物理欧拉方程出发，通过应用链式法则和本动量的定义，映射到共动变量；不得直接假设目标共动方程的形式。\n\n完成推导后，考虑均匀流和无源极限，此时空间导数、压力梯度和本动引力均消失，因此本动速度因哈勃阻力而服从一个纯粹的常微分方程（ODE）：\n$$\n\\frac{d\\mathbf{v}}{dt} = -H(t)\\,\\mathbf{v}.\n$$\n你的任务是实现两种在思想上分别对应欧拉方法和拉格朗日方法的时间离散化策略，并量化 $-H(t)\\,\\mathbf{v}$ 项的离散化偏差：\n\n- 欧拉更新（基于网格的观点）：使用在每步开始时求值的一阶向前欧拉步进方法来推进该常微分方程。\n- 拉格朗日更新（基于粒子追踪的观点）：使用在步长的开始和结束时都对 $H(t)$ 进行采样的二阶时间中心梯形步进方法来推进该常微分方程。\n\n对于每种策略，计算在有限时间区间内 $\\mathbf{v}(t)$ 的数值解，并将其与给定 $H(t)$ 的精确解析解进行比较。将标量速度幅值 $v$ 在最终时刻 $t_{\\mathrm{f}}$ 的离散化偏差定义为相对误差\n$$\n\\epsilon \\equiv \\frac{v_{\\mathrm{num}}(t_{\\mathrm{f}}) - v_{\\mathrm{exact}}(t_{\\mathrm{f}})}{v_{\\mathrm{exact}}(t_{\\mathrm{f}})},\n$$\n以小数形式表示（而非百分比）。两种策略使用相同的初始条件 $v(t_0) = v_0$。\n\n单位和数值规范：\n- 所有时间单位必须是秒（$\\mathrm{s}$），速度单位是米/秒（$\\mathrm{m/s}$），哈勃参数单位是反秒（$\\mathrm{s}^{-1}$）。\n- 为简单起见，将 $v$ 视为标量幅值，并报告每个测试的标量偏差。\n\n实现一个单一程序，为以下测试套件计算欧拉和拉格朗日离散化偏差。对于每种情况，假设一个空间均匀的流体元，并仅关注上述常微分方程：\n\n- 情况 1（恒定哈勃参数，中等步长）：$H(t) = H_0$，其中 $H_0 = 2.27\\times 10^{-18}\\,\\mathrm{s}^{-1}$，$t_0 = 0\\,\\mathrm{s}$，$v_0 = 3.0\\times 10^{5}\\,\\mathrm{m/s}$，$\\Delta t = 5.0\\times 10^{16}\\,\\mathrm{s}$，$N = 10$ 步。精确解为 $v_{\\mathrm{exact}}(t_{\\mathrm{f}}) = v_0\\exp\\!\\left(-H_0\\,N\\,\\Delta t\\right)$。\n- 情况 2（物质主导的膨胀）：$H(t) = \\frac{2}{3\\,t}$，$t_0 = 1.0\\times 10^{16}\\,\\mathrm{s}$，$v_0 = 3.0\\times 10^{5}\\,\\mathrm{m/s}$，$\\Delta t = 5.0\\times 10^{15}\\,\\mathrm{s}$，$N = 8$ 步。精确解为 $v_{\\mathrm{exact}}(t_{\\mathrm{f}}) = v_0\\left(\\frac{t_0}{t_0 + N\\,\\Delta t}\\right)^{2/3}$。\n- 情况 3（恒定哈勃参数，小步长边界）：$H(t) = H_0$，其中 $H_0 = 2.27\\times 10^{-18}\\,\\mathrm{s}^{-1}$，$t_0 = 0\\,\\mathrm{s}$，$v_0 = 3.0\\times 10^{5}\\,\\mathrm{m/s}$，$\\Delta t = 1.0\\times 10^{15}\\,\\mathrm{s}$，$N = 10$ 步。精确解为 $v_{\\mathrm{exact}}(t_{\\mathrm{f}}) = v_0\\exp\\!\\left(-H_0\\,N\\,\\Delta t\\right)$。\n- 情况 4（恒定哈勃参数，极端粗糙步长）：$H(t) = H_0$，其中 $H_0 = 2.27\\times 10^{-18}\\,\\mathrm{s}^{-1}$，$t_0 = 0\\,\\mathrm{s}$，$v_0 = 3.0\\times 10^{5}\\,\\mathrm{m/s}$，$\\Delta t = 5.0\\times 10^{18}\\,\\mathrm{s}$，$N = 1$ 步。精确解为 $v_{\\mathrm{exact}}(t_{\\mathrm{f}}) = v_0\\exp\\!\\left(-H_0\\,N\\,\\Delta t\\right)$。\n\n你的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个条目必须是一个双元素列表，按给定顺序包含相应情况的欧拉偏差和拉格朗日偏差。例如，输出格式必须是\n`[[\\epsilon_{E,1},\\epsilon_{L,1}],[\\epsilon_{E,2},\\epsilon_{L,2}],[\\epsilon_{E,3},\\epsilon_{L,3}],[\\epsilon_{E,4},\\epsilon_{L,4}]]`。", "solution": "该问题首先要求推导在膨胀宇宙中牛顿流体的欧拉方程的共动形式，其次要求实现并比较两种数值方案，用于求解本动速度演化的简化版本。\n\n首先将对问题陈述进行验证。\n\n**第 1 步：提取给定条件**\n-   坐标映射：$\\mathbf{r}(t) = a(t)\\,\\mathbf{x}(t)$，其中 $\\mathbf{r}$ 是物理坐标，$\\mathbf{x}$ 是共动坐标， $a(t)$ 是宇宙尺度因子。\n-   哈勃参数：$H(t) \\equiv \\dot{a}/a$。\n-   物理速度：$\\mathbf{u}(t,\\mathbf{r}) \\equiv d\\mathbf{r}/dt$。\n-   本动速度：$\\mathbf{v}(t,\\mathbf{x}) \\equiv a(t)\\,d\\mathbf{x}/dt$。\n-   速度关系：$\\mathbf{u} = H(t)\\,\\mathbf{r} + \\mathbf{v}$。\n-   本动速度的简化常微分方程：$\\frac{d\\mathbf{v}}{dt} = -H(t)\\,\\mathbf{v}$，在均匀流、无源极限下有效。\n-   离散化偏差定义：$\\epsilon \\equiv \\frac{v_{\\mathrm{num}}(t_{\\mathrm{f}}) - v_{\\mathrm{exact}}(t_{\\mathrm{f}})}{v_{\\mathrm{exact}}(t_{\\mathrm{f}})}$。\n-   欧拉更新：一阶向前欧拉步进。\n-   拉格朗日更新：二阶时间中心梯形步进。\n-   情况 1：$H(t) = H_0 = 2.27\\times 10^{-18}\\,\\mathrm{s}^{-1}$，$t_0 = 0\\,\\mathrm{s}$，$v_0 = 3.0\\times 10^{5}\\,\\mathrm{m/s}$，$\\Delta t = 5.0\\times 10^{16}\\,\\mathrm{s}$，$N = 10$。精确解：$v_{\\mathrm{exact}}(t_{\\mathrm{f}}) = v_0\\exp(-H_0\\,N\\,\\Delta t)$。\n-   情况 2：$H(t) = \\frac{2}{3\\,t}$，$t_0 = 1.0\\times 10^{16}\\,\\mathrm{s}$，$v_0 = 3.0\\times 10^{5}\\,\\mathrm{m/s}$，$\\Delta t = 5.0\\times 10^{15}\\,\\mathrm{s}$，$N = 8$。精确解：$v_{\\mathrm{exact}}(t_{\\mathrm{f}}) = v_0\\left(\\frac{t_0}{t_0 + N\\,\\Delta t}\\right)^{2/3}$。\n-   情况 3：$H(t) = H_0 = 2.27\\times 10^{-18}\\,\\mathrm{s}^{-1}$，$t_0 = 0\\,\\mathrm{s}$，$v_0 = 3.0\\times 10^{5}\\,\\mathrm{m/s}$，$\\Delta t = 1.0\\times 10^{15}\\,\\mathrm{s}$，$N = 10$。精确解：$v_{\\mathrm{exact}}(t_{\\mathrm{f}}) = v_0\\exp(-H_0\\,N\\,\\Delta t)$。\n-   情况 4：$H(t) = H_0 = 2.27\\times 10^{-18}\\,\\mathrm{s}^{-1}$，$t_0 = 0\\,\\mathrm{s}$，$v_0 = 3.0\\times 10^{5}\\,\\mathrm{m/s}$，$\\Delta t = 5.0\\times 10^{18}\\,\\mathrm{s}$，$N = 1$。精确解：$v_{\\mathrm{exact}}(t_{\\mathrm{f}}) = v_0\\exp(-H_0\\,N\\,\\Delta t)$。\n\n**第 2 步：使用提取的给定条件进行验证**\n-   **科学依据**：该问题设置在牛顿宇宙学的标准框架内，使用了流体近似，这是大尺度结构形成理论的基石。共动欧拉方程的推导是宇宙学中一个基本且标准的练习。物理常数和参数的数量级是符合实际的。\n-   **适定性**：推导部分是一个标准的证明。数值部分是一个定义明确的常微分方程初值问题，具有指定的初始条件、时间步长和数值方法。所提供的精确解是正确的，可作为可靠的基准。\n-   **客观性**：该问题使用精确的数学和物理术语，没有主观性语言。\n-   该问题没有表现出验证标准中列出的任何缺陷。它在科学上是合理的、自洽的，并且是可形式化的。\n\n**第 3 步：结论与行动**\n问题有效。将提供解决方案。\n\n**第 1 部分：共动欧拉方程的推导**\n\n我们从物理坐标 $(\\mathbf{r}, t)$ 中可压缩、无粘性流体的欧拉方程开始。连续性方程（质量守恒）和动量方程为：\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\nabla_{\\mathbf{r}} \\cdot (\\rho \\mathbf{u}) = 0\n$$\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} + (\\mathbf{u} \\cdot \\nabla_{\\mathbf{r}}) \\mathbf{u} = -\\frac{1}{\\rho}\\nabla_{\\mathbf{r}} P - \\nabla_{\\mathbf{r}} \\Phi\n$$\n在这里，$\\rho(t,\\mathbf{r})$ 是流体密度，$P(t,\\mathbf{r})$ 是压力，$\\mathbf{u}(t,\\mathbf{r})$ 是物理速度场，$\\Phi(t,\\mathbf{r})$ 是引力势。算子 $\\nabla_{\\mathbf{r}}$ 是关于物理坐标 $\\mathbf{r}$ 的梯度。\n\n我们的目标是将这些方程变换到共动坐标 $\\mathbf{x}$ 中，它通过 $\\mathbf{r} = a(t) \\mathbf{x}$ 与物理坐标相关联。尺度因子 $a(t)$ 描述了宇宙的整体膨胀。\n\n首先，我们建立导数和速度的变换规则。\n梯度算子变换如下：\n$$\n\\nabla_{\\mathbf{r}} = \\frac{1}{a(t)}\\nabla_{\\mathbf{x}}\n$$\n在固定物理位置 $\\mathbf{r}$ 的偏时间导数与在固定共动位置 $\\mathbf{x}$ 的偏时间导数相关。对于任何场 $f(t, \\mathbf{r}(t, \\mathbf{x}))$，链式法则给出：\n$$\n\\frac{\\partial f}{\\partial t}\\bigg|_{\\mathbf{x}} = \\frac{\\partial f}{\\partial t}\\bigg|_{\\mathbf{r}} + \\left(\\frac{\\partial \\mathbf{r}}{\\partial t}\\bigg|_{\\mathbf{x}}\\right) \\cdot \\nabla_{\\mathbf{r}} f\n$$\n由于 $\\mathbf{r} = a(t)\\mathbf{x}$，我们有 $\\frac{\\partial \\mathbf{r}}{\\partial t}\\big|_{\\mathbf{x}} = \\dot{a}\\mathbf{x} = \\frac{\\dot{a}}{a} (a\\mathbf{x}) = H(t)\\mathbf{r}$。这得到：\n$$\n\\frac{\\partial}{\\partial t}\\bigg|_{\\mathbf{r}} = \\frac{\\partial}{\\partial t}\\bigg|_{\\mathbf{x}} - H(t)\\mathbf{r} \\cdot \\nabla_{\\mathbf{r}}\n$$\n物理速度 $\\mathbf{u}$ 是流体元物理位置的全时间导数：\n$$\n\\mathbf{u} = \\frac{d\\mathbf{r}}{dt} = \\frac{d(a\\mathbf{x})}{dt} = \\dot{a}\\mathbf{x} + a\\dot{\\mathbf{x}} = H(a\\mathbf{x}) + a\\frac{d\\mathbf{x}}{dt} = H\\mathbf{r} + \\mathbf{v}\n$$\n这与所提供的本动速度 $\\mathbf{v} \\equiv a(t)d\\mathbf{x}/dt$ 的定义相符。\n\n现在我们变换连续性方程：\n$$\n\\left(\\frac{\\partial}{\\partial t}\\bigg|_{\\mathbf{x}} - H\\mathbf{r} \\cdot \\nabla_{\\mathbf{r}}\\right) \\rho + \\nabla_{\\mathbf{r}} \\cdot (\\rho \\mathbf{u}) = 0\n$$\n代入 $\\mathbf{r}=a\\mathbf{x}$，$\\mathbf{u}=H a \\mathbf{x} + \\mathbf{v}$，以及 $\\nabla_{\\mathbf{r}} = \\frac{1}{a}\\nabla_{\\mathbf{x}}$：\n$$\n\\frac{\\partial \\rho}{\\partial t} - H(a\\mathbf{x}) \\cdot \\left(\\frac{1}{a}\\nabla_{\\mathbf{x}}\\right) \\rho + \\frac{1}{a}\\nabla_{\\mathbf{x}} \\cdot (\\rho (H a \\mathbf{x} + \\mathbf{v})) = 0\n$$\n$$\n\\frac{\\partial \\rho}{\\partial t} - H(\\mathbf{x} \\cdot \\nabla_{\\mathbf{x}})\\rho + \\frac{1}{a}\\nabla_{\\mathbf{x}} \\cdot (\\rho H a \\mathbf{x}) + \\frac{1}{a}\\nabla_{\\mathbf{x}} \\cdot (\\rho \\mathbf{v}) = 0\n$$\n使用散度的乘法法则，$\\nabla_{\\mathbf{x}} \\cdot (\\rho H a \\mathbf{x}) = H a [(\\nabla_{\\mathbf{x}}\\rho)\\cdot\\mathbf{x} + \\rho(\\nabla_{\\mathbf{x}}\\cdot\\mathbf{x})]$。由于 $\\nabla_{\\mathbf{x}}\\cdot\\mathbf{x}=3$，这变为 $H a [(\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}}\\rho) + 3\\rho]$。方程简化为：\n$$\n\\frac{\\partial \\rho}{\\partial t} - H(\\mathbf{x} \\cdot \\nabla_{\\mathbf{x}})\\rho + H(\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}}\\rho) + 3H\\rho + \\frac{1}{a}\\nabla_{\\mathbf{x}} \\cdot (\\rho \\mathbf{v}) = 0\n$$\n$H(\\mathbf{x} \\cdot \\nabla_{\\mathbf{x}})\\rho$ 项相互抵消，得到共动连续性方程：\n$$\n\\frac{\\partial \\rho}{\\partial t} + 3H\\rho + \\frac{1}{a}\\nabla_{\\mathbf{x}} \\cdot (\\rho \\mathbf{v}) = 0\n$$\n\n接下来，我们变换动量方程。让我们分析左手边（LHS）：\nLHS = $\\frac{\\partial \\mathbf{u}}{\\partial t}\\big|_{\\mathbf{r}} + (\\mathbf{u} \\cdot \\nabla_{\\mathbf{r}}) \\mathbf{u}$。\n第一项是：\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t}\\bigg|_{\\mathbf{r}} = \\left(\\frac{\\partial}{\\partial t}\\bigg|_{\\mathbf{x}} - H\\mathbf{r} \\cdot \\nabla_{\\mathbf{r}}\\right) \\mathbf{u} = \\frac{\\partial \\mathbf{u}}{\\partial t}\\bigg|_{\\mathbf{x}} - H(a\\mathbf{x}) \\cdot \\left(\\frac{1}{a}\\nabla_{\\mathbf{x}}\\right)(H a \\mathbf{x} + \\mathbf{v})\n$$\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t}\\bigg|_{\\mathbf{x}} = \\frac{\\partial}{\\partial t}(Ha\\mathbf{x} + \\mathbf{v}) = (\\dot{H}a + H\\dot{a})\\mathbf{x} + \\frac{\\partial \\mathbf{v}}{\\partial t} = (\\dot{H}+H^2)a\\mathbf{x} + \\frac{\\partial \\mathbf{v}}{\\partial t}\n$$\n所以，$\\frac{\\partial \\mathbf{u}}{\\partial t}\\big|_{\\mathbf{r}} = (\\dot{H}+H^2)a\\mathbf{x} + \\frac{\\partial \\mathbf{v}}{\\partial t} - H(\\mathbf{x} \\cdot \\nabla_{\\mathbf{x}})(Ha\\mathbf{x} + \\mathbf{v}) = (\\dot{H}+H^2)a\\mathbf{x} + \\frac{\\partial \\mathbf{v}}{\\partial t} - H^2a\\mathbf{x} - H(\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v} = \\dot{H}a\\mathbf{x} + \\frac{\\partial \\mathbf{v}}{\\partial t} - H(\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v}$。\n\n第二项，即平流导数，是：\n$$\n(\\mathbf{u} \\cdot \\nabla_{\\mathbf{r}}) \\mathbf{u} = \\left((Ha\\mathbf{x}+\\mathbf{v}) \\cdot \\frac{1}{a}\\nabla_{\\mathbf{x}}\\right) (Ha\\mathbf{x}+\\mathbf{v})\n$$\n$$\n= \\left(H\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}} + \\frac{1}{a}\\mathbf{v}\\cdot\\nabla_{\\mathbf{x}}\\right) (Ha\\mathbf{x}+\\mathbf{v})\n$$\n$$\n= H\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}}(Ha\\mathbf{x}) + H\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}}(\\mathbf{v}) + \\frac{1}{a}(\\mathbf{v}\\cdot\\nabla_{\\mathbf{x}})(Ha\\mathbf{x}) + \\frac{1}{a}(\\mathbf{v}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v}\n$$\n这计算得出：$H^2a\\mathbf{x} + H(\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v} + H\\mathbf{v} + \\frac{1}{a}(\\mathbf{v}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v}$。\n\n合并左手边的所有项：\nLHS = $\\left(\\dot{H}a\\mathbf{x} + \\frac{\\partial \\mathbf{v}}{\\partial t} - H(\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v}\\right) + \\left(H^2a\\mathbf{x} + H(\\mathbf{x}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v} + H\\mathbf{v} + \\frac{1}{a}(\\mathbf{v}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v}\\right)$\n$$\n\\text{LHS} = \\frac{\\partial \\mathbf{v}}{\\partial t} + (\\dot{H}+H^2)a\\mathbf{x} + H\\mathbf{v} + \\frac{1}{a}(\\mathbf{v}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v}\n$$\n\n动量方程的右手边（RHS）变换如下：\nRHS = $-\\frac{1}{\\rho}\\nabla_{\\mathbf{r}} P - \\nabla_{\\mathbf{r}} \\Phi = -\\frac{1}{a\\rho}\\nabla_{\\mathbf{x}} P - \\frac{1}{a}\\nabla_{\\mathbf{x}} \\Phi$。\n总引力势 $\\Phi$ 被分为由平均密度 $\\bar{\\rho}(t)$ 引起的背景部分 $\\Phi_b$ 和由密度涨落 $\\delta\\rho = \\rho - \\bar{\\rho}$ 引起的本动部分 $\\phi$。背景势满足 $\\nabla^2_{\\mathbf{r}}\\Phi_b = 4\\pi G \\bar{\\rho}$。根据牛顿极限下的 Birkhoff 定理，在 $\\mathbf{r}$ 处的背景引力为 $-\\nabla_{\\mathbf{r}}\\Phi_b = -(\\frac{4\\pi G \\bar{\\rho}}{3})\\mathbf{r}$。从非相对论性流体的第二 Friedmann 方程（$\\ddot{a}/a = \\dot{H}+H^2 = -4\\pi G \\bar{\\rho}/3$），我们有 $-\\nabla_{\\mathbf{r}}\\Phi_b = (\\dot{H}+H^2)\\mathbf{r} = (\\dot{H}+H^2)a\\mathbf{x}$。\n所以，$-\\frac{1}{a}\\nabla_{\\mathbf{x}}\\Phi = -\\frac{1}{a}\\nabla_{\\mathbf{x}}\\Phi_b - \\frac{1}{a}\\nabla_{\\mathbf{x}}\\phi = -\\nabla_{\\mathbf{r}}\\Phi_b - \\frac{1}{a}\\nabla_{\\mathbf{x}}\\phi = (\\dot{H}+H^2)a\\mathbf{x} - \\frac{1}{a}\\nabla_{\\mathbf{x}}\\phi$。\n\n将完整的左手边和右手边相等：\n$$\n\\frac{\\partial \\mathbf{v}}{\\partial t} + (\\dot{H}+H^2)a\\mathbf{x} + H\\mathbf{v} + \\frac{1}{a}(\\mathbf{v}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v} = -\\frac{1}{a\\rho}\\nabla_{\\mathbf{x}} P + (\\dot{H}+H^2)a\\mathbf{x} - \\frac{1}{a}\\nabla_{\\mathbf{x}}\\phi\n$$\n背景加速度项 $(\\dot{H}+H^2)a\\mathbf{x}$ 从两边消去。我们得到共动动量方程：\n$$\n\\frac{\\partial \\mathbf{v}}{\\partial t} + H\\mathbf{v} + \\frac{1}{a}(\\mathbf{v} \\cdot \\nabla_{\\mathbf{x}})\\mathbf{v} = -\\frac{1}{a\\rho}\\nabla_{\\mathbf{x}} P - \\frac{1}{a}\\nabla_{\\mathbf{x}}\\phi\n$$\n共动坐标中本动速度的全导数或对流导数为 $d\\mathbf{v}/dt = \\partial \\mathbf{v}/\\partial t + (\\dot{\\mathbf{x}}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v} = \\partial \\mathbf{v}/\\partial t + (\\frac{\\mathbf{v}}{a}\\cdot\\nabla_{\\mathbf{x}})\\mathbf{v}$。因此，该方程可以写成：\n$$\n\\frac{d\\mathbf{v}}{dt} + H\\mathbf{v} = -\\frac{1}{a\\rho}\\nabla_{\\mathbf{x}} P - \\frac{1}{a}\\nabla_{\\mathbf{x}}\\phi\n$$\n重新整理以将源项隔离在右边：\n$$\n\\frac{d\\mathbf{v}}{dt} = -H(t)\\mathbf{v} - \\frac{1}{a\\rho}\\nabla_{\\mathbf{x}} P - \\frac{1}{a}\\nabla_{\\mathbf{x}}\\phi\n$$\n**$-H(t)\\mathbf{v}$** 项被明确地识别为“哈勃阻力”项。它起到摩擦力的作用，随着宇宙的膨胀而阻尼本动速度。\n\n**作出的假设：**\n1.  流体是理想的（无粘性和非导热的）。\n2.  动力学是非相对论性的（$v \\ll c$, $P \\ll \\rho c^2$）。\n3.  引力在背景 FLRW 度规上由牛顿理论描述。这在远小于哈勃半径的尺度上是有效的。\n4.  宇宙是空间平坦的（$k=0$）。\n5.  引力势可分离为一个平滑的背景分量和一个本动微扰。\n\n**第 2 部分：离散化偏差的数值计算**\n\n我们的任务是用两种不同的数值方案求解简化的常微分方程 $\\frac{dv}{dt} = -H(t)v$（对于标量速度幅值 $v$），并计算相对误差。\n\n**欧拉更新（向前欧拉法）：**\n这是一种一阶显式方法。在第 $n+1$ 步的速度使用第 $n$ 步的值来更新：\n$$v_{n+1} = v_n + \\Delta t \\left( \\frac{dv}{dt} \\right)_n = v_n + \\Delta t (-H(t_n)v_n) = v_n(1 - H(t_n)\\Delta t)$$\n\n**拉格朗日更新（梯形法则）：**\n这是一种二阶隐式方法。更新规则对时间步长开始和结束时的导数进行平均：\n$$v_{n+1} = v_n + \\frac{\\Delta t}{2}\\left[ \\left(\\frac{dv}{dt}\\right)_n + \\left(\\frac{dv}{dt}\\right)_{n+1} \\right] = v_n + \\frac{\\Delta t}{2}[-H(t_n)v_n - H(t_{n+1})v_{n+1}]$$\n解出 $v_{n+1}$：\n$$v_{n+1}\\left(1 + \\frac{\\Delta t}{2}H(t_{n+1})\\right) = v_n\\left(1 - \\frac{\\Delta t}{2}H(t_n)\\right)$$\n$$v_{n+1} = v_n \\frac{1 - \\frac{1}{2}H(t_n)\\Delta t}{1 + \\frac{1}{2}H(t_{n+1})\\Delta t}$$\n\n下面的代码为每个测试用例实现了这两种方案，计算最终速度 $v_{\\mathrm{num}}(t_f)$，并将其与给定的 $v_{\\mathrm{exact}}(t_f)$ 进行比较，报告离散化偏差 $\\epsilon = (v_{\\mathrm{num}} - v_{\\mathrm{exact}})/v_{\\mathrm{exact}}$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the discretization bias for Eulerian (Forward Euler) and\n    Lagrangian (Trapezoidal) schemes for the Hubble drag ODE.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: constant Hubble, moderate step\n        {\n            \"H_func\": lambda t, H0=2.27e-18: H0,\n            \"H0\": 2.27e-18,\n            \"t0\": 0.0,\n            \"v0\": 3.0e5,\n            \"dt\": 5.0e16,\n            \"N\": 10,\n            \"exact_sol\": lambda v0, H0, N, dt, t0: v0 * np.exp(-H0 * N * dt)\n        },\n        # Case 2: matter-dominated expansion\n        {\n            \"H_func\": lambda t: 2.0 / (3.0 * t) if t > 0 else np.inf,\n            \"t0\": 1.0e16,\n            \"v0\": 3.0e5,\n            \"dt\": 5.0e15,\n            \"N\": 8,\n            \"exact_sol\": lambda v0, H0, N, dt, t0: v0 * (t0 / (t0 + N * dt))**(2.0/3.0)\n        },\n        # Case 3: constant Hubble, small step\n        {\n            \"H_func\": lambda t, H0=2.27e-18: H0,\n            \"H0\": 2.27e-18,\n            \"t0\": 0.0,\n            \"v0\": 3.0e5,\n            \"dt\": 1.0e15,\n            \"N\": 10,\n            \"exact_sol\": lambda v0, H0, N, dt, t0: v0 * np.exp(-H0 * N * dt)\n        },\n        # Case 4: constant Hubble, extreme coarse step\n        {\n            \"H_func\": lambda t, H0=2.27e-18: H0,\n            \"H0\": 2.27e-18,\n            \"t0\": 0.0,\n            \"v0\": 3.0e5,\n            \"dt\": 5.0e18,\n            \"N\": 1,\n            \"exact_sol\": lambda v0, H0, N, dt, t0: v0 * np.exp(-H0 * N * dt)\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        t0 = case[\"t0\"]\n        v0 = case[\"v0\"]\n        dt = case[\"dt\"]\n        N = case[\"N\"]\n        H_func = case[\"H_func\"]\n        H0 = case.get(\"H0\") # Will be None if not applicable\n\n        # Calculate exact solution\n        v_exact = case[\"exact_sol\"](v0, H0, N, dt, t0)\n\n        # Eulerian (Forward Euler) simulation\n        v_euler = v0\n        t_current = t0\n        for _ in range(N):\n            H_current = H_func(t_current)\n            v_euler = v_euler * (1.0 - H_current * dt)\n            t_current += dt\n        \n        bias_eulerian = (v_euler - v_exact) / v_exact\n\n        # Lagrangian (Trapezoidal) simulation\n        v_lagrange = v0\n        t_current = t0\n        for _ in range(N):\n            H_current = H_func(t_current)\n            H_next = H_func(t_current + dt)\n            \n            numerator = 1.0 - 0.5 * H_current * dt\n            denominator = 1.0 + 0.5 * H_next * dt\n            \n            v_lagrange = v_lagrange * (numerator / denominator)\n            t_current += dt\n\n        bias_lagrangian = (v_lagrange - v_exact) / v_exact\n        \n        results.append([bias_eulerian, bias_lagrangian])\n\n    # Format the final output string exactly as required\n    inner_strings = [f\"[{e_E},{e_L}]\" for e_E, e_L in results]\n    final_output = f\"[{','.join(inner_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "3477164"}, {"introduction": "任何流体力学代码的核心任务之一是平流——即物质属性随流体流动的过程。这个看似简单的任务是数值误差的一个主要来源。本练习 [@problem_id:3477134] 设计了一个经典测试：让一个平滑的波在一个网格上平移，并使用一个无理数速度来暴露长期累积的误差。你将直接比较一个基于网格的欧拉方法和一个基于粒子思想的拉格朗日方法，直观地看到它们如何以不同方式处理数值扩散和相位误差。", "problem": "考虑一维周期性域中无源标量场的守恒平流，这是一个典型的子问题，出现在数值宇宙学中的流体动力学组件中，其中固定空间网格上的平流可能会产生伪相位和振幅伪影，通常称为“鬼影流”误差。设域为 $[0,L]$，其中 $L=1$，标量场为 $u(x,t)$，满足线性平流方程\n$$\n\\partial_t u(x,t) + v\\,\\partial_x u(x,t) = 0,\n$$\n其中速度 $v$ 为常数。初始条件是一个以弧度为单位指定的光滑周期性模式：\n$$\nu(x,0) = \\sin(2\\pi x) + 0.25\\cos(6\\pi x),\n$$\n其中三角函数以弧度为其参数。所有量均为无量纲。\n\n您必须实现并比较两种数值方法在长时间内的离散 $L_2$ 误差增长情况：\n\n- 在具有 $N$ 个单元的均匀网格上使用欧拉有限体积法，采用与 $v$ 符号一致的迎风格式通量。网格在空间中是固定的，应用周期性边界条件，并且必须通过适当选择时间步长来确保稳定性。\n- 拉格朗日平移，然后在每个步骤中保守地重映到固定的欧拉网格上，使用特征线法在平移后获得固定网格位置上的场。在实践中，在每个时间步，将场平移物理距离 $v\\,\\Delta t$，然后使用尊重周期性的线性插值重映到原始固定网格。\n\n为了消除速度和网格之间可能掩盖长期误差累积的公度效应，强制使用一个无理数 Courant–Friedrichs–Lewy (CFL) 数。定义 Courant 数\n$$\nc \\equiv \\frac{v\\,\\Delta t}{\\Delta x},\n$$\n并在每个测试案例中设置 $v = \\sqrt{2}$ 和 $c = \\frac{\\sqrt{3}}{7}$。这里 $\\Delta x=L/N$，$\\Delta t = c\\,\\Delta x / v$。\n\n对于每个测试案例，从 $t=0$ 到 $t = n\\,\\Delta t$ 演化两种方案 $n$ 个时间步，然后计算每种方案相对于精确解的离散 $L_2$ 误差\n$$\nu_{\\text{exact}}(x,t) = \\sin\\!\\big(2\\pi (x - v t)\\big) + 0.25\\cos\\!\\big(6\\pi (x - v t)\\big),\n$$\n使用单元中心 $x_i = (i+0.5)\\Delta x$ 上的离散范数：\n$$\n\\|e\\|_{2,\\Delta} = \\left(\\Delta x \\sum_{i=0}^{N-1} \\left[u_i - u_{\\text{exact}}(x_i,t)\\right]^2 \\right)^{1/2}.\n$$\n\n从守恒定律出发，基于第一性原理实现这两种方案，不调用专门的平流黑箱例程。欧拉更新必须从控制体上的通量差推导出来，拉格朗日步骤必须从特征线法后跟与周期性边界一致的基于插值的重映推导出来。\n\n所有输出均为无量纲浮点数。角度使用弧度。您的程序应评估以下测试套件，该套件涵盖了“理想路径”、步数的边界条件以及分辨率敏感性：\n\n- 测试 1：$N=64$， $n=1000$。\n- 测试 2：$N=128$， $n=2000$。\n- 测试 3：$N=64$， $n=0$。\n- 测试 4：$N=64$， $n=1$。\n\n对于每个测试案例，返回一个包含两个浮点数的列表，四舍五入到 $6$ 位小数：最终时间的欧拉离散 $L_2$ 误差和拉格朗日离散 $L_2$ 误差。您的程序应生成单行输出，其中包含所有测试案例的结果，形式为方括号内由逗号分隔的此类列表。例如，输出格式必须是\n`[[e_E,1,e_L,1],[e_E,2,e_L,2],[e_E,3,e_L,3],[e_E,4,e_L,4]]`\n其中每个 $e_{E,k}$ 和 $e_{L,k}$ 都是四舍五入到 $6$ 位小数的浮点数。", "solution": "我们从一维空间中无源标量平流的守恒陈述开始，\n$$\n\\partial_t u(x,t) + \\partial_x (F) = 0, \\quad F = v\\,u,\n$$\n其中速度 $v$ 是常数。解析解可由特征线法得出。特征线满足 $dx/dt = v$，因此解沿着线 $x - v t = \\text{const}$ 是常数，这意味着\n$$\nu(x,t) = u_0(x - v t),\n$$\n其中 $u_0(x)$ 是初始条件。在 $[0,L]$ 上使用周期性边界条件，通过模 $L$ 环绕可以保持此形式。\n\n我们定义一个具有 $N$ 个单元的均匀网格，单元宽度为 $\\Delta x = L/N$，单元中心为 $x_i = (i+0.5)\\Delta x$，其中 $i \\in \\{0,\\dots,N-1\\}$。时间步长基于 Courant–Friedrichs–Lewy (CFL) 数 $c$ 来选择，\n$$\nc \\equiv \\frac{v\\,\\Delta t}{\\Delta x}.\n$$\n我们设置 $v=\\sqrt{2}$ 和 $c = \\frac{\\sqrt{3}}{7}$，这是一个无理数，因此\n$$\n\\Delta t = \\frac{c\\,\\Delta x}{v}.\n$$\n这保证了每步的平移是单元宽度的无理数分数，从而避免了随时间与网格单元的精确对齐，并揭示了累积的数值误差。\n\n欧拉有限体积迎风格式方案：\n我们在控制体 $[x_{i-1/2},x_{i+1/2}]$ 上对守恒定律进行积分并应用散度定理，得到\n$$\n\\frac{d}{dt} \\bar{u}_i(t) = -\\frac{1}{\\Delta x}\\left(F_{i+1/2} - F_{i-1/2}\\right),\n$$\n其中 $\\bar{u}_i$ 是单元平均值。当 $v>0$ 时，界面处的迎风格式通量使用左侧状态，$F_{i+1/2} = v\\,\\bar{u}_i$，而 $F_{i-1/2} = v\\,\\bar{u}_{i-1}$。通过前向欧拉步进行时间离散化，\n$$\n\\bar{u}_i^{n+1} = \\bar{u}_i^n - \\frac{\\Delta t}{\\Delta x}\\left(v\\,\\bar{u}_i^n - v\\,\\bar{u}_{i-1}^n\\right) = \\bar{u}_i^n - c\\left(\\bar{u}_i^n - \\bar{u}_{i-1}^n\\right),\n$$\n对于 $v>0$，这在 $0  c \\le 1$ 时是稳定的。通过定义 $\\bar{u}_{-1}^n \\equiv \\bar{u}_{N-1}^n$ 来强制执行周期性边界。虽然在实践中我们演化的是单元中心处的点值，但对于光滑场，这种离散更新与有限体积迎风方法是一致的，并捕捉了固定网格上的欧拉平流机制。\n\n带重映的拉格朗日平移：\n根据特征线法，在时间 $t^{n+1}$ 位置 $x$ 处的精确连续解是 $u(x,t^{n+1}) = u(x - v\\,\\Delta t, t^n)$。为了在固定的网格点 $x_i$ 处求值，我们需要 $u(\\cdot, t^n)$ 在网格外的点 $y_i = x_i - v\\,\\Delta t$ 处的值。在离散网格上，我们通过在最近的单元中心样本之间进行周期性线性插值来近似这个值。令对应于 $y_i$ 的小数索引为\n$$\nj_i = \\frac{y_i}{\\Delta x} - 0.5,\n$$\n其整数部分为 $k_i = \\lfloor j_i \\rfloor$，小数部分为 $\\theta_i = j_i - k_i$。周期性索引为 $k_i \\bmod N$ 和 $(k_i+1) \\bmod N$。在 $x_i$ 处的重映值为\n$$\nu_i^{n+1} = (1-\\theta_i) u_{k_i}^n + \\theta_i u_{k_i+1}^n,\n$$\n所有索引都取模 $N$ 以强制周期性。这实现了在每个时间步中先进行拉格朗日步骤（平移 $v\\,\\Delta t$），然后进行保守重映到固定的欧拉网格。虽然连续特征线解是精确的，但离散插值会引入受控的误差，其性质与欧拉数值扩散和色散不同。\n\n精确解和误差度量：\n在最终时间 $t^n = n\\,\\Delta t$，网格上的精确解为\n$$\nu_{\\text{exact}}(x_i,t^n) = \\sin\\!\\big(2\\pi(x_i - v\\,t^n)\\big) + 0.25\\cos\\!\\big(6\\pi(x_i - v\\,t^n)\\big).\n$$\n我们计算离散 $L_2$ 误差为\n$$\n\\|e\\|_{2,\\Delta} = \\left(\\Delta x \\sum_{i=0}^{N-1} \\left[u_i^n - u_{\\text{exact}}(x_i,t^n)\\right]^2 \\right)^{1/2}.\n$$\n这个离散范数是连续 $L_2$ 范数的黎曼和近似，保持了与分辨率相关的正确缩放。\n\n算法设计：\n- 初始化网格和单元中心 $x_i = (i+0.5)\\Delta x$，并设置 $u_i^0 = \\sin(2\\pi x_i) + 0.25\\cos(6\\pi x_i)$。\n- 使用 $v=\\sqrt{2}$ 和 $c=\\sqrt{3}/7$ 计算 $\\Delta t = c\\,\\Delta x / v$。\n- 对于欧拉平流，使用迎风格式更新 $\\bar{u}_i^{n+1} = \\bar{u}_i^n - c(\\bar{u}_i^n - \\bar{u}_{i-1}^n)$ 迭代 $n$ 次。\n- 对于拉格朗日平移，通过对在 $x_i - v\\,\\Delta t$ 处求值的 $u^n$ 进行周期性线性插值来获得 $u^{n+1}$，迭代 $n$ 次。\n- 经过 $n$ 步后，计算 $t^n = n\\,\\Delta t$，构建 $u_{\\text{exact}}(x_i,t^n)$，并为每种方案评估离散 $L_2$ 误差。\n- 对每个测试案例重复上述步骤。无理数 $c$ 防止了每步位移与网格间距之间的同步，从而揭示了数值伪影的长期累积。\n\n数值考虑：\n- 欧拉迎风法是一阶精度的，并引入随时间累积的数值扩散，通常表现为平流模式的振幅衰减。其相位误差取决于 $c$ 和分辨率。\n- 带有线性重映的拉格朗日平移在每一步更有效地保持振幅，但引入了具有不同色散特性的插值误差。在长时间内，无理数的每步位移阻止了重映误差的周期性抵消，从而可以清晰地比较增长率。\n- 对三角函数使用弧度确保了与初始模式定义的一致性。所有量都是无量纲的，不需要进行物理单位转换。\n\n输出规格：\n对于每个测试案例，返回一个列表 $[e_E, e_L]$，其中 $e_E$ 是欧拉离散 $L_2$ 误差，$e_L$ 是拉格朗日离散 $L_2$ 误差，两者都四舍五入到 $6$ 位小数。将四个测试案例的结果汇总为单行，格式如下：\n`[[e_E,1,e_L,1],[e_E,2,e_L,2],[e_E,3,e_L,3],[e_E,4,e_L,4]]`。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef initial_condition(x):\n    # Trigonometric functions use radians by default in numpy.\n    return np.sin(2.0 * np.pi * x) + 0.25 * np.cos(6.0 * np.pi * x)\n\ndef exact_solution(x, v, t):\n    return np.sin(2.0 * np.pi * (x - v * t)) + 0.25 * np.cos(6.0 * np.pi * (x - v * t))\n\ndef eulerian_upwind(u, c):\n    # v  0 assumed; upwind uses left neighbor. Periodic wrap.\n    # u_{i}^{n+1} = u_{i}^{n} - c (u_{i}^{n} - u_{i-1}^{n})\n    u_prev = u\n    u_shift_left = np.roll(u_prev, 1)\n    return u_prev - c * (u_prev - u_shift_left)\n\ndef lagrangian_translate_linear(u, shift, dx):\n    # shift is physical distance v*dt. Map u(x - shift) to the fixed grid.\n    # Cell centers at x_i = (i + 0.5) * dx. The fractional index for y_i = x_i - shift is:\n    # j = y / dx - 0.5. Then linear interp between floor(j) and floor(j)+1 with periodic wrap.\n    N = u.size\n    # Indices grid i=0..N-1 corresponds to x_i = (i+0.5)*dx\n    # Compute j for all i in vectorized form: j_i = i - shift/dx\n    # Because j = y/dx - 0.5 = ((i+0.5)dx - shift)/dx - 0.5 = i - shift/dx\n    j = np.arange(N, dtype=float) - (shift / dx)\n    k = np.floor(j).astype(int)\n    theta = j - k\n    k0 = np.mod(k, N)\n    k1 = np.mod(k + 1, N)\n    return (1.0 - theta) * u[k0] + theta * u[k1]\n\ndef discrete_L2(u, u_exact, dx):\n    return np.sqrt(dx * np.sum((u - u_exact) ** 2))\n\ndef run_case(N, n_steps, v, c, L=1.0):\n    dx = L / N\n    dt = c * dx / v\n    x_centers = (np.arange(N, dtype=float) + 0.5) * dx\n    # Initialize\n    u0 = initial_condition(x_centers)\n    # Eulerian evolution\n    u_e = u0.copy()\n    # Lagrangian evolution\n    u_l = u0.copy()\n    # Per-step physical shift\n    shift = v * dt\n    for _ in range(n_steps):\n        u_e = eulerian_upwind(u_e, c)\n        u_l = lagrangian_translate_linear(u_l, shift, dx)\n    t_final = n_steps * dt\n    u_exact = exact_solution(x_centers, v, t_final)\n    err_e = discrete_L2(u_e, u_exact, dx)\n    err_l = discrete_L2(u_l, u_exact, dx)\n    return err_e, err_l\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case is (N, n_steps)\n    test_cases = [\n        (64, 1000),\n        (128, 2000),\n        (64, 0),\n        (64, 1),\n    ]\n    # Constants: v = sqrt(2), c = sqrt(3)/7 (irrational Courant number)\n    v = np.sqrt(2.0)\n    c = np.sqrt(3.0) / 7.0\n\n    results = []\n    for N, n_steps in test_cases:\n        err_e, err_l = run_case(N, n_steps, v, c, L=1.0)\n        # Round to 6 decimal places as required\n        results.append([round(err_e, 6), round(err_l, 6)])\n\n    # Final print statement in the exact required format.\n    # Format: [[eE1,eL1],[eE2,eL2],[eE3,eL3],[eE4,eL4]]\n    print(f\"[{','.join('[' + ','.join(map(lambda x: f'{x:.6f}', pair)) + ']' for pair in results)}]\")\n\nsolve()\n```", "id": "3477134"}, {"introduction": "现在我们进入一个更全面的分析，针对完整的线性化流体力学方程。评估一个数值方案精度的有力方法是研究它如何传播不同波长的波，这个概念由数值色散关系捕捉。这个高级练习 [@problem_id:3477154] 要求你推导并比较一个典型的拉格朗日方法（光滑粒子流体动力学，SPH）和一个现代欧拉方法（使用黎曼解算器的有限体积法）的色散关系。这将为你提供关于它们在数值色散和耗散方面的各自优缺点的深刻见解。", "problem": "考虑在一个空间平坦、均匀膨胀的 Friedmann–Lemaître–Robertson–Walker (FLRW) 背景中，具有恒定声速 $c_s$ 的正压气体的一维线性化流体动力学。在共动坐标 $x$ 中进行计算，并假设在感兴趣的时间区间内标度因子满足 $a(t) \\approx 1$，且哈勃膨胀率 $H \\equiv \\dot{a}/a$ 是一个常数。设背景密度为 $\\rho_0$，并考虑围绕均匀状态的密度小扰动 $\\delta \\rho(x,t)$ 和本动速度 $v(x,t)$。\n\n使用的基本原理：\n- 共动坐标中等温气体的线性化连续性方程和动量方程：\n  - $\\partial_t \\delta \\rho + (\\rho_0/a)\\,\\partial_x v = 0$,\n  - $\\partial_t v + H v + (c_s^2/(a\\rho_0))\\,\\partial_x \\delta \\rho = 0$.\n- 平面波扰动 $\\propto \\exp(i k x - i \\omega t)$ 以及色散关系 $\\omega(k)$ 的定义。\n- 用于线性系统的、带有黎曼求解器的有限体积通量差分形式，以及用于空间梯度的、带有紧支集核函数的光滑粒子流体动力学 (SPH)。\n\n任务：\n1. 基于上述基本原理，推导在傅里叶空间中控制扰动矢量 $Q \\equiv [\\delta \\rho, v]^T$ 演化的半离散线性算子，分别针对以下情况：\n   - 一种拉格朗日光滑粒子流体动力学 (SPH) 离散化方法，在间距为 $\\Delta x$ 的均匀粒子格点上使用光滑长度参数为 $h$ 的一维三次样条核函数。对线性扰动和均匀粒子质量，一致地处理核函数梯度。将相互作用限制在核函数支撑域内。\n   - 一种欧拉有限体积离散化方法，在间距为 $\\Delta x$ 的均匀网格上使用与 Harten–Lax–van Leer–Contact (HLLC) 族一致的双波近似黎曼求解器，用于线性声学系统。使用分段常数重构（一阶）和周期性边界条件。对于线性声学系统，在求解器所隐含的数值耗散项中，采用通量雅可比矩阵 $A = \\begin{bmatrix} 0  \\rho_0 \\\\ c_s^2/\\rho_0  0 \\end{bmatrix}$ 及其绝对值 $|A|$。\n2. 使用半离散算子，通过求解空间算子矩阵的特征值问题，得到数值色散关系 $\\omega_{\\mathrm{SPH}}(k)$ 和 $\\omega_{\\mathrm{E}}(k)$。使用关系式 $-i \\omega = \\lambda$，其中 $\\lambda$ 是空间算子的一个半离散特征值。\n3. 对于 $a=1$ 时的连续谱基准，推导在均匀膨胀背景下小振幅声波的解析色散关系 $\\omega_{\\mathrm{cont}}(k)$，并用 $c_s$、$k$ 和 $H$ 明确表示。\n\n通过计算数值色散关系（实部和虚部）与连续谱的偏差，量化 SPH 相对于欧拉有限体积方法的核函数偏差和一致性。计算适用于指定的波数和平滑长度测试套件：\n- $\\Delta \\omega_{\\mathrm{SPH,\\,Re}} = \\mathrm{Re}(\\omega_{\\mathrm{SPH}}) - \\mathrm{Re}(\\omega_{\\mathrm{cont}})$,\n- $\\Delta \\omega_{\\mathrm{SPH,\\,Im}} = \\mathrm{Im}(\\omega_{\\mathrm{SPH}}) - \\mathrm{Im}(\\omega_{\\mathrm{cont}})$,\n- $\\Delta \\omega_{\\mathrm{E,\\,Re}} = \\mathrm{Re}(\\omega_{\\mathrm{E}}) - \\mathrm{Re}(\\omega_{\\mathrm{cont}})$,\n- $\\Delta \\omega_{\\mathrm{E,\\,Im}} = \\mathrm{Im}(\\omega_{\\mathrm{E}}) - \\mathrm{Im}(\\omega_{\\mathrm{cont}})$.\n\n所有频率必须以 $\\mathrm{s}^{-1}$ 为单位表示。虚部是阻尼率，通常为非正值。对于每种方法，选择 $\\omega$ 的实部为非负的色散关系分支（正频率声学模式），并报告该分支的偏差。\n\n对所有测试用例使用以下全局一致的参数：\n- 域长度 $L = 1.0\\,\\mathrm{m}$，网格点数 $N = 64$，因此 $\\Delta x = L/N$。\n- 声速 $c_s = 1000\\,\\mathrm{m/s}$。\n- 背景密度 $\\rho_0 = 1.0\\,\\mathrm{kg/m^3}$。\n- 标度因子 $a = 1$ 贯穿始终。\n\n通过 $k_n = n\\, (2\\pi/L)$（$n$为整数）定义波数集，并包括一个接近奈奎斯特极限 $k_{\\mathrm{Ny}} = \\pi/\\Delta x$ 的高波数情况。\n\n测试套件（每个案例是一个元组 $(k, h, H)$）：\n- 案例 1（理想情况，小 $k$，中等平滑，无膨胀）：$k = k_1$, $h = 2.0\\,\\Delta x$, $H = 0\\,\\mathrm{s}^{-1}$。\n- 案例 2（中等 $k$，中等平滑，轻度膨胀）：$k = k_{10}$, $h = 2.0\\,\\Delta x$, $H = 100\\,\\mathrm{s}^{-1}$。\n- 案例 3（近奈奎斯特，色散主导区，中等平滑，无膨胀）：$k = 0.8\\,k_{\\mathrm{Ny}}$, $h = 2.0\\,\\Delta x$, $H = 0\\,\\mathrm{s}^{-1}$。\n- 案例 4（理想情况，小 $k$，欠平滑 SPH 挑战一致性，无膨胀）：$k = k_1$, $h = 1.2\\,\\Delta x$, $H = 0\\,\\mathrm{s}^{-1}$。\n- 案例 5（中等 $k$，重度平滑，轻度膨胀）：$k = k_5$, $h = 3.0\\,\\Delta x$, $H = 50\\,\\mathrm{s}^{-1}$。\n- 案例 6（中等 $k$，中等平滑，近临界膨胀阻尼）：$k = k_8$, $h = 2.0\\,\\Delta x$, $H = 0.9\\times 2 c_s k$。\n\n您的程序必须为每个测试用例计算上述定义的四个偏差，并将它们汇总到单行输出中。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含结果，格式为逗号分隔的列表的列表，每个内部列表按 $[\\Delta \\omega_{\\mathrm{SPH,\\,Re}}, \\Delta \\omega_{\\mathrm{SPH,\\,Im}}, \\Delta \\omega_{\\mathrm{E,\\,Re}}, \\Delta \\omega_{\\mathrm{E,\\,Im}}]$ 的顺序排列，所有值均以 $\\mathrm{s}^{-1}$ 为单位，并用方括号括起来。例如：`[[x_1,y_1,u_1,v_1],[x_2,y_2,u_2,v_2],...]`。\n\n科学真实性约束：\n- 使用具有紧支集 $2h$ 和一维标准归一化的一维三次样条核函数。\n- 使用与均匀格点一致的周期性，并将 SPH 相互作用限制在满足 $|m|\\Delta x \\le 2h$ 的整数邻居偏移量 $m$ 上。\n- 对于欧拉方法，根据双波黎曼求解器对此对称线性声学系统的处理方式，来处理雅可比矩阵的绝对值 $|A|$。\n\n您的解决方案必须是一个完整的、可运行的 Python 程序，该程序实现上述要求并以确切指定的格式打印最终输出。", "solution": "用户希望在一个膨胀宇宙背景下，对一维线性化流体动力学问题进行验证和求解，并比较拉格朗日 (SPH) 和欧拉 (有限体积) 数值方法。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n\n- **系统**：一维线性化流体动力学的正压气体。\n- **背景几何**：空间平坦、均匀膨胀的 Friedmann–Lemaître–Robertson–Walker (FLRW) 背景。\n- **坐标**：共动坐标 $x$。\n- **参数与近似**：\n    - 恒定声速 $c_s$。\n    - 标度因子 $a(t) \\approx 1$。\n    - 恒定哈勃膨胀率 $H \\equiv \\dot{a}/a$。\n    - 背景密度 $\\rho_0$。\n    - 扰动：密度 $\\delta \\rho(x,t)$，本动速度 $v(x,t)$。\n- **基本方程**：\n    - 连续性方程：$\\partial_t \\delta \\rho + (\\rho_0/a)\\,\\partial_x v = 0$。\n    - 动量方程：$\\partial_t v + H v + (c_s^2/(a\\rho_0))\\,\\partial_x \\delta \\rho = 0$。\n- **分析方法**：\n    - 平面波扰动 $\\propto \\exp(i k x - i \\omega t)$。\n    - 色散关系 $\\omega(k)$。\n    - 半离散特征值关系：$-i \\omega = \\lambda$。\n- **数值方案**：\n    - **SPH**：拉格朗日法，一维三次样条核函数，光滑长度为 $h$，均匀粒子格点间距为 $\\Delta x$，相互作用限制在核函数支撑域内。\n    - **欧拉法**：有限体积法，均匀网格间距为 $\\Delta x$，双波近似黎曼求解器（HLLC 族），分段常数重构，周期性边界条件。\n    - **欧拉通量雅可比矩阵**：$A = \\begin{bmatrix} 0  \\rho_0 \\\\ c_s^2/\\rho_0  0 \\end{bmatrix}$ 及其绝对值 $|A|$，如求解器所示。\n- **任务**：\n    1. 推导 SPH 和欧拉法的傅里叶空间半离散线性算子。\n    2. 获取数值色散关系 $\\omega_{\\mathrm{SPH}}(k)$ 和 $\\omega_{\\mathrm{E}}(k)$。\n    3. 推导连续谱解析色散关系 $\\omega_{\\mathrm{cont}}(k)$。\n    4. 计算偏差：$\\Delta \\omega_{\\mathrm{SPH,\\,Re}}$、$\\Delta \\omega_{\\mathrm{SPH,\\,Im}}$、$\\Delta \\omega_{\\mathrm{E,\\,Re}}$、$\\Delta \\omega_{\\mathrm{E,\\,Im}}$。\n- **全局参数**：\n    - $L = 1.0\\,\\mathrm{m}$。\n    - $N = 64$。\n    - $\\Delta x = L/N$。\n    - $c_s = 1000\\,\\mathrm{m/s}$。\n    - $\\rho_0 = 1.0\\,\\mathrm{kg/m^3}$。\n    - $a = 1$。\n- **波数**：$k_n = n\\, (2\\pi/L)$， $k_{\\mathrm{Ny}} = \\pi/\\Delta x$。\n- **测试套件**：提供了6个 $(k, h, H)$ 的测试用例。\n- **输出格式**：单行，逗号分隔的列表的列表：`[[d_re_sph, d_im_sph, d_re_e, d_im_e], ...]`。\n\n**步骤2：使用提取的已知条件进行验证**\n\n1.  **科学上成立**：该问题在宇宙学标准模型（FLRW 度规）和流体物理学（流体动力学方程）方面有坚实的基础。使用线性化方程进行扰动分析是一种标准且有效的方法。所用的数值方法（SPH，一种拉格朗日方法；有限体积法，一种欧拉方法）是计算天体物理学和宇宙学的核心技术。\n2.  **适定性**：该问题是适定的。它要求推导和比较色散关系，这是分析数值方案准确性和稳定性的标准技术。给定的参数和方程足以确定每种方案唯一的数值色散关系以及解析的连续谱基准。\n3.  **客观性**：问题以精确、客观的数学和物理语言陈述。任务是定量的，没有主观解释的余地。\n4.  **完整性**：问题是自洽的。所有必要的方程、参数、数值方案定义和测试用例都已明确提供。\n5.  **一致性**：所提供的数据或方程内部没有矛盾。参数在物理上是一致的。\n\n**步骤3：结论与行动**\n\n该问题是**有效**的。这是一个天体物理学数值方法的标准理论练习，尽管比较复杂。我们将着手解决。\n\n### 基于原理的解决方案\n\n问题的核心是推导并比较在膨胀介质中声波的色散关系，这种关系由连续谱方程和两种不同的数值离散化方法表示。色散关系 $\\omega(k)$ 将平面波模式的时间频率 $\\omega$ 与其空间波数 $k$ 联系起来。对于数值方案，这种关系揭示了该方案传播不同尺度波的准确性，以及它引入了哪些数值误差（色散和耗散）。\n\n**1. 连续谱解析色散关系，$\\omega_{\\mathrm{cont}}(k)$**\n\n我们从给定的线性化流体动力学方程开始，设标度因子 $a=1$：\n$$\n\\partial_t \\delta \\rho + \\rho_0\\,\\partial_x v = 0\n$$\n$$\n\\partial_t v + H v + \\frac{c_s^2}{\\rho_0}\\,\\partial_x \\delta \\rho = 0\n$$\n我们寻求形式为 $\\delta\\rho(x,t) = \\delta\\tilde{\\rho} e^{i(kx - \\omega t)}$ 和 $v(x,t) = \\tilde{v} e^{i(kx - \\omega t)}$ 的平面波解。将它们代入方程，并将 $\\partial_t$ 替换为 $-i\\omega$，$\\partial_x$ 替换为 $ik$，得到关于振幅 $\\delta\\tilde{\\rho}$ 和 $\\tilde{v}$ 的线性系统：\n$$\n\\begin{bmatrix} -i\\omega  i k \\rho_0 \\\\ i k c_s^2/\\rho_0  -i\\omega + H \\end{bmatrix} \\begin{bmatrix} \\delta\\tilde{\\rho} \\\\ \\tilde{v} \\end{bmatrix} = \\begin{bmatrix} 0 \\\\ 0 \\end{bmatrix}\n$$\n为了得到非平凡解，矩阵的行列式必须为零：\n$$\n(-i\\omega)(-i\\omega + H) - (i k \\rho_0)\\left(\\frac{i k c_s^2}{\\rho_0}\\right) = 0\n$$\n$$\n-\\omega^2 - i\\omega H + k^2 c_s^2 = 0 \\quad \\implies \\quad \\omega^2 + i\\omega H - (k c_s)^2 = 0\n$$\n这是一个关于 $\\omega$ 的二次方程。解出 $\\omega$：\n$$\n\\omega = \\frac{-iH \\pm \\sqrt{(iH)^2 - 4(1)(-(k c_s)^2)}}{2} = -\\frac{iH}{2} \\pm \\sqrt{(k c_s)^2 - \\left(\\frac{H}{2}\\right)^2}\n$$\n问题要求选择实部非负的分支，我们将其表示为 $\\omega_{\\mathrm{cont}}(k)$。这对应于正频率声学模式。解取决于平方根参数的符号。令 $S_c = (k c_s)^2 - (H/2)^2$。\n如果 $S_c \\ge 0$，波是传播的。我们为实部选择正根：\n$$\n\\mathrm{Re}(\\omega_{\\mathrm{cont}}) = \\sqrt{S_c}, \\quad \\mathrm{Im}(\\omega_{\\mathrm{cont}}) = -\\frac{H}{2}\n$$\n如果 $S_c  0$，波是过阻尼的（非传播）。平方根变为虚数，$\\sqrt{S_c} = i\\sqrt{-S_c}$。\n$$\n\\omega_{\\mathrm{cont}} = -\\frac{iH}{2} \\pm i\\sqrt{-S_c} = i \\left( -\\frac{H}{2} \\pm \\sqrt{\\left(\\frac{H}{2}\\right)^2 - (k c_s)^2} \\right)\n$$\n在这种情况下，$\\mathrm{Re}(\\omega_{\\mathrm{cont}}) = 0$。虚部对应于阻尼。我们选择阻尼最小（即虚部最大，也就是负得最少）的模式，这对应于在平方根前取正号。\n$$\n\\mathrm{Re}(\\omega_{\\mathrm{cont}}) = 0, \\quad \\mathrm{Im}(\\omega_{\\mathrm{cont}}) = -\\frac{H}{2} + \\sqrt{-S_c}\n$$\n$-H/2$ 项代表了由宇宙膨胀引起的物理阻尼（哈勃拖曳）。\n\n**2. SPH 数值色散关系，$\\omega_{\\mathrm{SPH}}(k)$**\n\n光滑粒子流体动力学 (SPH) 将流体离散为一组粒子。对于均匀格点上的线性扰动，我们可以推导出一个有效的微分算子。通过在均匀状态（$\\rho=\\rho_0, v=0, m_j = \\rho_0 \\Delta x$）附近对标准 SPH 连续性方程和动量方程进行线性化，我们发现空间导数算子 $\\partial_x$ 被一个离散算子近似，其对平面波 $e^{ikx}$ 的作用是乘以 $i k_{\\mathrm{eff, SPH}}$。有效波数 $k_{\\mathrm{eff, SPH}}$ 由下式给出：\n$$\nk_{\\mathrm{eff, SPH}}(k) = \\Delta x \\sum_{m} \\sin(k m \\Delta x) \\frac{\\partial W(m\\Delta x, h)}{\\partial x}\n$$\n其中 $W(x, h)$ 是 SPH 平滑核函数。求和遍及核函数紧支集内的所有邻近粒子 $m$。对于偶核函数 $W$，其导数 $\\partial_x W$ 是奇函数。求和可以简化为：\n$$\nk_{\\mathrm{eff, SPH}}(k) = 2 \\Delta x \\sum_{m=1}^{M} \\sin(k m \\Delta x) \\frac{\\partial W(m\\Delta x, h)}{\\partial x}\n$$\n其中 $M = \\lfloor 2h/\\Delta x \\rfloor$。\n对于支撑域为 $2h$ 的一维三次样条核函数，我们定义 $u = |x|/h$。核函数为 $W(x, h) = \\frac{2}{3h} \\sigma(u)$，其中\n$$\n\\sigma(u) = \\begin{cases} 1 - \\frac{3}{2}u^2 + \\frac{3}{4}u^3  0 \\le u \\le 1 \\\\ \\frac{1}{4}(2-u)^3  1  u \\le 2 \\\\ 0  u > 2 \\end{cases}\n$$\n其导数为 $\\partial_x W = \\mathrm{sign}(x) \\frac{1}{h} \\frac{\\partial W}{\\partial u} = \\mathrm{sign}(x) \\frac{2}{3h^2} \\sigma'(u)$，其中\n$$\n\\sigma'(u) = \\begin{cases} -3u + \\frac{9}{4}u^2  0 \\le u \\le 1 \\\\ -\\frac{3}{4}(2-u)^2  1  u \\le 2 \\\\ 0  u > 2 \\end{cases}\n$$\n傅里叶空间中的半离散 SPH 方程形式上与连续谱方程相同，但用 $k_{\\mathrm{eff, SPH}}$ 替换了 $k$。这意味着色散关系 $\\omega_{\\mathrm{SPH}}(k)$ 具有与 $\\omega_{\\mathrm{cont}}(k)$ 相同的函数形式，只需进行此替换：\n$$\n\\omega_{\\mathrm{SPH}} = -\\frac{iH}{2} \\pm \\sqrt{(c_s k_{\\mathrm{eff, SPH}})^2 - \\left(\\frac{H}{2}\\right)^2}\n$$\n至关重要的是，在均匀格点上对理想气体的标准动量守恒 SPH 方程进行线性化，不会引入人工粘性项。因此，$\\omega_{\\mathrm{SPH}}$ 的虚部完全由物理哈勃拖曳决定，就像连续谱情况一样：在传播区域中 $\\mathrm{Im}(\\omega_{\\mathrm{SPH}}) = -H/2$。任何与连续谱的偏差都纯粹是色散性的（即在 $\\omega$ 的实部中）。\n\n**3. 欧拉数值色散关系，$\\omega_{\\mathrm{E}}(k)$**\n\n欧拉有限体积方案在固定网格上离散化守恒律。单元 $i$ 的半离散方程为：\n$$\n\\frac{dQ_i}{dt} = -\\frac{1}{\\Delta x}(\\hat{F}_{i+1/2} - \\hat{F}_{i-1/2}) + S(Q_i)\n$$\n其中 $Q=[\\delta\\rho, v]^T$ 且 $S(Q)=[0, -Hv]^T$。对于分段常数数据和指定的线性系统，在界面 $i+1/2$ 处与 HLL 族一致的一阶精度迎风通量为：\n$$\n\\hat{F}_{i+1/2} = \\frac{1}{2}(F_i + F_{i+1}) - \\frac{1}{2}|A|(Q_{i+1} - Q_i)\n$$\n其中 $F(Q) = AQ$。通量雅可比矩阵 $A = \\begin{bmatrix} 0  \\rho_0 \\\\ c_s^2/\\rho_0  0 \\end{bmatrix}$ 的特征值为 $\\pm c_s$。矩阵绝对值为 $|A|=c_s I$。\n将通量代入更新方程，得到一个空间算子，它用中心差分加上一个数值耗散项来近似 $\\partial_x A Q$。对结果系统应用平面波分析 ($Q_j = \\tilde{Q} e^{ikj\\Delta x}$)，得到一个矩阵方程 $\\frac{d\\tilde{Q}}{dt} = M_E(k) \\tilde{Q}$。$M_E(k)$ 的特征值 $\\lambda$ 通过 $\\lambda = -i\\omega_E$ 与数值频率相关。\n求解 $M_E(k)$ 的特征值问题得到：\n$$\n\\lambda = -\\left(c_s \\frac{1-\\cos(k\\Delta x)}{\\Delta x}\\right) - \\frac{H}{2} \\pm \\sqrt{\\left(\\frac{H}{2}\\right)^2 - \\left(c_s \\frac{\\sin(k\\Delta x)}{\\Delta x}\\right)^2}\n$$\n使用 $\\lambda = -i\\omega_E$ 和 $1-\\cos\\theta = 2\\sin^2(\\theta/2)$，我们求出 $\\omega_E$：\n$$\n\\omega_E = i\\left(c_s \\frac{2\\sin^2(k\\Delta x/2)}{\\Delta x} + \\frac{H}{2}\\right) \\pm \\sqrt{\\left(c_s \\frac{\\sin(k\\Delta x)}{\\Delta x}\\right)^2 - \\left(\\frac{H}{2}\\right)^2}\n$$\n那么正频率分支的频率为：\n$$\n\\mathrm{Re}(\\omega_{E}) = \\sqrt{\\left(c_s k_{\\mathrm{eff, E}}\\right)^2 - \\left(\\frac{H}{2}\\right)^2}, \\quad \\mathrm{Im}(\\omega_{E}) = -\\frac{H}{2} - c_s \\frac{2\\sin^2(k\\Delta x/2)}{\\Delta x}\n$$\n（对于过阻尼情况，进行类似连续谱推导的适当修改）。在这里，有效波数是 $k_{\\mathrm{eff, E}} = \\sin(k\\Delta x)/\\Delta x$。与 SPH 不同，欧拉方案引入了一个数值耗散项 $-c_s \\frac{2\\sin^2(k\\Delta x/2)}{\\Delta x}$，它会加到物理阻尼上，导致波的衰减速度比应有的快，尤其是在高波数时。\n\n**4. 偏差计算**\n最后一步是在代码中实现这些推导出的公式，为每个测试用例的参数进行求值，并计算四个指定的偏差：$\\Delta \\omega_{\\mathrm{SPH,\\,Re}}$、$\\Delta \\omega_{\\mathrm{SPH,\\,Im}}$、$\\Delta \\omega_{\\mathrm{E,\\,Re}}$ 和 $\\Delta \\omega_{\\mathrm{E,\\,Im}}$。这些结果量化了每种数值方法相对于精确连续谱解的色散和耗散误差。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes deviations in numerical dispersion relations for SPH and Eulerian\n    methods from the analytical continuum solution for linearized hydrodynamics\n    in an expanding background.\n    \"\"\"\n\n    # Globally consistent parameters from the problem statement\n    L = 1.0  # Domain length in m\n    N = 64  # Number of grid points\n    delta_x = L / N  # Grid/particle spacing in m\n    c_s = 1000.0  # Sound speed in m/s\n    \n    # Wavenumber definitions\n    k_n = lambda n: n * (2 * np.pi / L)\n    k_ny = np.pi / delta_x\n\n    # Test suite from the problem statement: (k, h, H)\n    test_cases = [\n        (k_n(1), 2.0 * delta_x, 0.0),\n        (k_n(10), 2.0 * delta_x, 100.0),\n        (0.8 * k_ny, 2.0 * delta_x, 0.0),\n        (k_n(1), 1.2 * delta_x, 0.0),\n        (k_n(5), 3.0 * delta_x, 50.0),\n        (k_n(8), 2.0 * delta_x, 0.9 * 2 * c_s * k_n(8)),\n    ]\n\n    def sigma_prime(u):\n        \"\"\"\n        Derivative of the 1D cubic spline kernel shape function sigma(u).\n        \"\"\"\n        u = np.abs(u)\n        if 0 = u = 1:\n            return -3 * u + (9.0 / 4.0) * u**2\n        elif 1  u = 2:\n            return -(3.0 / 4.0) * (2 - u)**2\n        else:\n            return 0.0\n\n    def get_dispersion_relation(k, H, k_eff, numerical_damping=0.0):\n        \"\"\"\n        Generic function to calculate dispersion relation for a given effective\n        wavenumber and numerical damping. Selects the positive frequency branch.\n        \"\"\"\n        arg_sqrt = (c_s * k_eff)**2 - (H / 2.0)**2\n        \n        if arg_sqrt >= 0:\n            re_omega = np.sqrt(arg_sqrt)\n            im_omega = -H / 2.0 - numerical_damping\n        else: # Overdamped case\n            re_omega = 0.0\n            im_omega = -H / 2.0 + np.sqrt(-arg_sqrt) - numerical_damping\n            \n        return re_omega, im_omega\n\n    results = []\n    for k, h, H in test_cases:\n        # 1. Continuum Analytic Solution\n        re_cont, im_cont = get_dispersion_relation(k, H, k_eff=k)\n\n        # 2. SPH Numerical Solution\n        M = int(np.floor(2 * h / delta_x))\n        m_vals = np.arange(1, M + 1)\n        \n        sum_terms = np.sin(k * m_vals * delta_x) * \\\n                    np.array([sigma_prime(m * delta_x / h) for m in m_vals])\n        \n        # dW/dx = sign(x) * (2/(3*h^2)) * sigma'(|x|/h)\n        # k_eff_sph = 2 * delta_x * sum_{m>0} sin(k*m*dx) * (dW/dx)(m*dx)\n        k_eff_sph = (2 * delta_x) * np.sum(sum_terms * (2.0 / (3.0 * h**2)))\n        \n        re_sph, im_sph = get_dispersion_relation(k, H, k_eff=k_eff_sph)\n\n        # 3. Eulerian Numerical Solution\n        k_eff_e = np.sin(k * delta_x) / delta_x\n        numerical_damping_e = c_s * (2 * np.sin(k * delta_x / 2.0)**2) / delta_x\n        \n        re_e, im_e = get_dispersion_relation(k, H, k_eff=k_eff_e, \n                                             numerical_damping=numerical_damping_e)\n        \n        # 4. Calculate deviations\n        delta_re_sph = re_sph - re_cont\n        delta_im_sph = im_sph - im_cont\n        delta_re_e = re_e - re_cont\n        delta_im_e = im_e - im_cont\n        \n        results.append([delta_re_sph, delta_im_sph, delta_re_e, delta_im_e])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3477154"}]}