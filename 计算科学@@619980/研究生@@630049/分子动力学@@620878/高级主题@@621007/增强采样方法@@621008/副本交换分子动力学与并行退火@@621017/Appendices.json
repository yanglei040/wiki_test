{"hands_on_practices": [{"introduction": "任何副本交换分子动力学（REMD）模拟的第一步都是设计有效的温度阶梯。本练习将指导你完成一个基础但至关重要的任务：基于恒定热容和高斯能量分布的简化物理模型，设计一个几何温度阶梯以确保相邻副本之间具有恒定的交换接受率。通过这个实践 [@problem_id:3442135]，你将掌握连接统计力学理论与实际模拟参数设置的核心技能。", "problem": "一个经典分子系统将使用副本交换分子动力学 (REMD)（也称为并行退火）进行模拟，其最低温度为 $300$ K，最高温度为 $600$ K。目的是设计一个几何温度阶梯，使得任意一对相邻副本之间交换构象的期望接受概率为一个恒定的指定目标值。\n\n假设以下基本依据和模型假定：\n- 在逆温度 $\\beta$ 下，正则系综赋予能量 $E$ 的概率密度为 $P_{\\beta}(E) \\propto g(E)\\exp(-\\beta E)$，其中 $g(E)$ 是态密度，$\\beta = 1/(k_{B}T)$，$k_{B}$ 是玻尔兹曼常数。\n- 在正则系综中，能量方差满足 $\\sigma^{2}(T) = \\langle (E - \\langle E \\rangle)^{2} \\rangle_{T} = k_{B}T^{2}C_{V}(T)$，平均能量满足 $\\mathrm{d}\\langle E \\rangle/\\mathrm{d}T = C_{V}(T)$，其中 $C_{V}(T)$ 是定容热容。\n- 在所关心的温度范围内，热容是恒定的，等于 $C_{V} = 60\\,k_{B}$，并且每个温度下的能量分布都可以很好地用具有上述平均值和方差的高斯分布来近似。\n- 在逆温度 $\\beta$ 和 $\\beta'$ 下，相邻副本之间的 REMD 交换使用与细致平衡一致的 Metropolis 接受准则：尝试交换能量为 $E$ 和 $E'$ 的构象时，接受概率为 $a = \\min\\{1, \\exp[(\\beta - \\beta')(E' - E)]\\}$。\n- 温度阶梯是几何的，即相邻温度满足 $T' = r\\,T$，其中 $r > 1$ 是整个阶梯的恒定比率。\n\n设目标最近邻交换接受概率为 $p^{\\star} = 0.3$。从正则系综的定义和 Metropolis 接受准则出发，利用能量分布的高斯近似和 $C_{V}$ 的恒定性，推导出所需几何比率 $r$ 作为 $p^{\\star}$ 和 $C_{V}$ 函数的解析表达式。然后，确定所需的最小整数副本数 $N$，使得具有该比率的几何阶梯能够覆盖从 $300$ K 到 $600$ K 的范围（含两端），即 $T_{\\min} = 300$ K 和 $T_{\\max} = 600$ K 位于阶梯的两端。\n\n给出最终答案，即最小整数 $N$，不带单位。除了 $N$ 必须是整数这一事实外，不需要其他舍入说明。", "solution": "用户希望找到副本交换分子动力学 (REMD) 模拟所需的最小副本数。\n\n### 步骤 1：提取给定条件\n- 最低温度: $T_{\\min} = 300\\,\\text{K}$\n- 最高温度: $T_{\\max} = 600\\,\\text{K}$\n- 定容热容: $C_V = 60\\,k_B$ (在温度范围内恒定)\n- 正则系综中的概率密度: $P_{\\beta}(E) \\propto g(E)\\exp(-\\beta E)$，其中 $\\beta = 1/(k_B T)$\n- 能量方差: $\\sigma^{2}(T) = k_{B}T^{2}C_{V}(T)$\n- 平均能量关系: $\\mathrm{d}\\langle E \\rangle/\\mathrm{d}T = C_{V}(T)$\n- 能量分布用高斯分布近似。\n- 在逆温度 $\\beta$ 和 $\\beta'$ 下，能量为 $E$ 和 $E'$ 的构象之间的交换的 Metropolis 接受概率: $a = \\min\\{1, \\exp[(\\beta - \\beta')(E' - E)]\\}$\n- 温度阶梯是几何的: $T' = r\\,T$，其中比率 $r > 1$ 是恒定的。\n- 目标最近邻交换接受概率: $p^{\\star} = 0.3$。\n\n### 步骤 2：使用提取的条件进行验证\n该问题定义明确，其科学基础是统计力学和计算物理学的原理，特别是 REMD 方法背后的理论。所有必要的物理量、常数和模型假设（高斯能量分布、恒定的 $C_V$）都已明确给出。该问题是自洽的、客观的，不包含任何科学或逻辑上的矛盾。问题提法恰当，可以导出一个唯一的、有意义的解。该问题是有效的。\n\n### 步骤 3：求解过程\n\n该问题需要分两步解决：首先，推导几何比率 $r$ 的解析表达式；其次，计算最小整数副本数 $N$。\n\n#### 几何比率 $r$ 的推导\n\n在温度 $T_i$ 和 $T_{i+1}$（对应逆温度为 $\\beta_i > \\beta_{i+1}$）下，两个相邻副本之间交换构象的 Metropolis 接受概率由下式给出：\n$$a = \\min\\{1, \\exp[(\\beta_i - \\beta_{i+1})(E_i - E_{i+1})]\\}$$\n这里，$E_i$ 是当前处于温度 $T_i$ 的构象的能量，$E_{i+1}$ 是当前处于温度 $T_{i+1}$ 的构象的能量。在尝试交换之前，系统处于平衡状态，因此 $E_i$ 是从正则分布 $P_{\\beta_i}(E)$ 中抽取的随机变量，$E_{i+1}$ 是从 $P_{\\beta_{i+1}}(E)$ 中抽取的随机变量。\n\n令 $Y = (\\beta_i - \\beta_{i+1})(E_i - E_{i+1})$。期望接受概率 $p^{\\star}$ 是 $a$ 在 $E_i$ 和 $E_{i+1}$ 分布上的平均值：\n$$p^{\\star} = \\langle \\min\\{1, \\exp(Y)\\} \\rangle$$\n问题指出能量分布是高斯分布。由于 $E_i$ 和 $E_{i+1}$ 是独立的随机变量，它们的差也是一个高斯随机变量。因此，$Y$ 是一个高斯随机变量。设其均值为 $\\mu_Y$，方差为 $\\sigma_Y^2$。\n\n对于一个高斯变量 $Y \\sim \\mathcal{N}(\\mu_Y, \\sigma_Y^2)$，一个标准结果是，如果近似 $\\mu_Y \\approx -\\sigma_Y^2/2$ 成立，则期望接受概率简化为：\n$$p^{\\star} = 2 \\Phi_Z\\left(-\\frac{\\sigma_Y}{2}\\right)$$\n其中 $\\Phi_Z$ 是标准正态分布的累积分布函数 (CDF)。此近似在相邻温度差异较小的情况下有效，这也是高效 REMD 的典型条件。\n\n我们来验证条件 $\\mu_Y \\approx -\\sigma_Y^2/2$。令 $\\Delta\\beta = \\beta_i - \\beta_{i+1}$。\n$Y$ 的均值为 $\\mu_Y = \\Delta\\beta (\\langle E_i \\rangle - \\langle E_{i+1} \\rangle)$。\n使用基本关系 $\\mathrm{d}\\langle E \\rangle/\\mathrm{d}\\beta = -\\sigma^2(T)$，我们可以近似平均能量的差值：\n$$\\langle E_{i+1} \\rangle - \\langle E_i \\rangle \\approx \\frac{\\mathrm{d}\\langle E \\rangle}{\\mathrm{d}\\beta} (\\beta_{i+1} - \\beta_i) = -\\sigma^2(T_i)(-\\Delta\\beta) = \\sigma^2(T_i)\\Delta\\beta$$\n所以，$\\mu_Y \\approx \\Delta\\beta (-\\sigma^2(T_i)\\Delta\\beta) = -(\\Delta\\beta)^2 \\sigma^2(T_i)$。\n$Y$ 的方差是 $\\sigma_Y^2 = (\\Delta\\beta)^2 \\text{Var}(E_i - E_{i+1}) = (\\Delta\\beta)^2 (\\text{Var}(E_i) + \\text{Var}(E_{i+1}))$。\n$$\\sigma_Y^2 = (\\Delta\\beta)^2 (\\sigma^2(T_i) + \\sigma^2(T_{i+1}))$$\n对于小的温度差异，$\\sigma^2(T_{i+1}) \\approx \\sigma^2(T_i)$，所以 $\\sigma_Y^2 \\approx (\\Delta\\beta)^2 (2\\sigma^2(T_i))$。\n比较这两个表达式，我们发现确实有 $\\mu_Y \\approx -\\sigma_Y^2/2$。\n\n关系式 $p^{\\star} = 2 \\Phi_Z(-\\sigma_Y/2)$ 可以被反转以求得 $\\sigma_Y$：\n$$ \\Phi_Z\\left(-\\frac{\\sigma_Y}{2}\\right) = \\frac{p^{\\star}}{2} \\implies -\\frac{\\sigma_Y}{2} = \\Phi_Z^{-1}\\left(\\frac{p^{\\star}}{2}\\right) $$\n$$ \\sigma_Y = -2 \\Phi_Z^{-1}\\left(\\frac{p^{\\star}}{2}\\right) $$\n令 $K = -2 \\Phi_Z^{-1}(p^{\\star}/2)$。则 $\\sigma_Y^2 = K^2$。\n\n现在，我们用几何比率 $r$ 和热容 $C_V$ 来表示 $\\sigma_Y^2$。\n温度通过 $T_{i+1} = r T_i$ 相关联。逆温度为 $\\beta_i = 1/(k_B T_i)$ 和 $\\beta_{i+1} = 1/(k_B T_{i+1}) = \\beta_i/r$。\n温度 $T$ 下的能量方差为 $\\sigma^2(T) = k_B T^2 C_V$。\n$$ \\sigma_Y^2 = \\left(\\beta_i - \\frac{\\beta_i}{r}\\right)^2 (\\sigma^2(T_i) + \\sigma^2(rT_i)) $$\n$$ \\sigma_Y^2 = \\beta_i^2 \\left(1 - \\frac{1}{r}\\right)^2 (k_B T_i^2 C_V + k_B (rT_i)^2 C_V) $$\n代入 $\\beta_i = 1/(k_B T_i)$：\n$$ \\sigma_Y^2 = \\frac{1}{k_B^2 T_i^2} \\left(\\frac{r-1}{r}\\right)^2 (k_B C_V T_i^2 (1+r^2)) $$\n$$ \\sigma_Y^2 = \\frac{C_V}{k_B} \\frac{(r-1)^2}{r^2} (1+r^2) $$\n令 $C_V' = C_V/k_B$。所需接受概率的条件是：\n$$ K^2 = C_V' \\frac{(r-1)^2(1+r^2)}{r^2} $$\n这是一个关于 $r$ 的四次方程。我们可以重新整理并求解它。\n$$ \\left(\\frac{K^2}{C_V'}\\right)r^2 = (r^2-2r+1)(r^2+1) = r^4 - 2r^3 + 2r^2 - 2r + 1 $$\n$$ r^4 - 2r^3 + \\left(2 - \\frac{K^2}{C_V'}\\right)r^2 - 2r + 1 = 0 $$\n这是一个倒数方程。两边同除以 $r^2$ (因为 $r\\neq0$)：\n$$ \\left(r^2 + \\frac{1}{r^2}\\right) - 2\\left(r + \\frac{1}{r}\\right) + \\left(2 - \\frac{K^2}{C_V'}\\right) = 0 $$\n令 $y = r + 1/r$。那么 $r^2 + 1/r^2 = y^2 - 2$。方程变为一个关于 $y$ 的二次方程：\n$$ (y^2 - 2) - 2y + \\left(2 - \\frac{K^2}{C_V'}\\right) = 0 \\implies y^2 - 2y - \\frac{K^2}{C_V'} = 0$$\n求解 $y$：\n$$ y = \\frac{2 \\pm \\sqrt{4 - 4(-K^2/C_V')}}{2} = 1 \\pm \\sqrt{1 + \\frac{K^2}{C_V'}} $$\n由于 $r>1$，我们必须有 $y = r+1/r > 2$。因此我们取正根：\n$$ y = 1 + \\sqrt{1 + \\frac{K^2}{C_V/k_B}} $$\n现在我们求解 $r + 1/r = y$，即 $r^2 - yr + 1 = 0$。\n$$ r = \\frac{y \\pm \\sqrt{y^2-4}}{2} $$\n因为我们要求 $r>1$，我们必须选择正号。$r$ 的最终解析表达式是：\n$$ r = \\frac{y + \\sqrt{y^2-4}}{2} \\quad \\text{where} \\quad y = 1 + \\sqrt{1 + \\frac{4\\left(\\Phi_Z^{-1}(p^{\\star}/2)\\right)^2}{C_V/k_B}} $$\n\n#### 副本数 $N$ 的计算\n\n给定 $C_V = 60 k_B$，所以 $C_V' = C_V/k_B = 60$。目标接受概率是 $p^{\\star} = 0.3$。\n首先，我们求 $\\Phi_Z^{-1}(p^{\\star}/2) = \\Phi_Z^{-1}(0.15)$ 的值。使用标准统计表或计算器，$\\Phi_Z^{-1}(0.15) \\approx -1.03643$。\n然后，$K = -2 \\Phi_Z^{-1}(0.15) \\approx -2(-1.03643) = 2.07286$。\n所以，$K^2 \\approx 4.2967$。\n\n现在我们计算 $y$：\n$$ y = 1 + \\sqrt{1 + \\frac{4.2967}{60}} = 1 + \\sqrt{1 + 0.07161} = 1 + \\sqrt{1.07161} \\approx 1 + 1.03519 = 2.03519 $$\n接下来，我们计算 $r$：\n$$ r = \\frac{2.03519 + \\sqrt{(2.03519)^2 - 4}}{2} = \\frac{2.03519 + \\sqrt{4.14199 - 4}}{2} = \\frac{2.03519 + \\sqrt{0.14199}}{2} $$\n$$ r \\approx \\frac{2.03519 + 0.37682}{2} = \\frac{2.41201}{2} \\approx 1.2060 $$\n温度阶梯必须覆盖从 $T_{\\min} = 300\\,\\text{K}$ 到 $T_{\\max} = 600\\,\\text{K}$ 的范围。假设有 $N$ 个副本，索引从 $0$ 到 $N-1$。那么 $T_0 = T_{\\min}$ 且 $T_{i} = T_0 r^i$。最高温度必须至少为 $T_{\\max}$：\n$$ T_{N-1} = T_0 r^{N-1} \\ge T_{\\max} $$\n$$ r^{N-1} \\ge \\frac{T_{\\max}}{T_{\\min}} = \\frac{600}{300} = 2 $$\n对两边取自然对数：\n$$ (N-1)\\ln(r) \\ge \\ln(2) $$\n$$ N-1 \\ge \\frac{\\ln(2)}{\\ln(r)} $$\n$$ N \\ge 1 + \\frac{\\ln(2)}{\\ln(r)} $$\n使用我们计算出的 $r$ 值：\n$$ N \\ge 1 + \\frac{\\ln(2)}{\\ln(1.2060)} \\approx 1 + \\frac{0.69315}{0.18727} \\approx 1 + 3.7013 = 4.7013 $$\n由于副本数 $N$ 必须是整数，所以 $N$ 的最小整数值是大于或等于 $4.7013$ 的最小整数，即 $5$。\n一个包含 $N=5$ 个副本、比率为 $r \\approx 1.2060$ 且起始温度为 $T_0=300\\,\\text{K}$ 的阶梯将具有以下温度：$300.0, 361.8, 436.4, 526.4, 634.8$ K，这覆盖了所需的范围。", "answer": "$$\\boxed{5}$$", "id": "3442135"}, {"introduction": "虽然几何温度阶梯在理想情况下很有用，但真实系统的热容 $C_V(T)$ 常常随温度显著变化，尤其是在相变附近。本练习 [@problem_id:3442105] 介绍了一种更先进和稳健的温度设置方法，它利用信息论中的 Kullback-Leibler (KL) 散度来量化相邻副本分布的“距离”。通过确保相邻副本间的 KL 散度恒定，你可以构建一个自适应的温度网格，在热容峰值区域（如玻璃化转变）自动增加副本密度，从而显著提高采样效率。", "problem": "设计一种算法，为副本交换分子动力学 (REMD) 和并行退火构建优化的温度网格，其方法是在相邻的正则系综之间强制施加一个恒定的 Kullback–Leibler (KL) 散度。从第一性原理出发，给定正则概率密度 $\\rho_{\\beta}(\\mathbf{x}) \\propto \\exp(-\\beta U(\\mathbf{x}))$，其中逆温度为 $\\beta = 1/T$（在约化单位中，玻尔兹曼常数设为 $k_{\\mathrm{B}} = 1$），以及 Kullback–Leibler 散度的定义 $D_{\\mathrm{KL}}(\\rho \\parallel \\sigma) = \\int \\rho \\ln(\\rho / \\sigma)\\, d\\mathbf{x}$。推导一个关于微小 $\\Delta T$ 的二阶表达式，该表达式将局部不对称性 $D_{\\mathrm{KL}}(\\rho_{T} \\parallel \\rho_{T+\\Delta T})$ 与定容比热 $C_V(T)$ 联系起来，并展示当所有相邻副本间施加一个均匀的目标散度 $\\delta$ 时，如何由此得出一个决定最优温度网格间距的微分定律。\n\n使用您推导出的定律，定义一个数值稳健的程序，用于在给定的温度区间 $[T_{\\min}, T_{\\max}]$ 和副本数 $N$ 的条件下，通过在温度上均衡一个适当的弧长泛函，来计算一个优化的温度集 $\\{T_i\\}_{i=0}^{N-1}$。展示如何直接通过对 $T$ 的积分计算相应的目标散度 $\\delta$，以及如何反演累积弧长以获得温度。您的程序必须完全以约化单位（无量纲）表示，其中 $T$ 为约化温度单位， $C_V$ 为约化热容单位，最终的温度网格也必须以约化单位表示。本问题中除约化单位外，不出现其他物理量纲。\n\n通过一个光滑的正热容曲线，在一个玻璃态聚合物熔体的替代模型上评估您的算法。该曲线捕捉了一个展宽的台阶形式的玻璃化转变外加一个 $\\alpha$-弛豫肩：\n$$\nC_V(T) \\;=\\; a \\;+\\; \\frac{b}{2}\\left[1 + \\tanh\\!\\left(\\frac{T - T_g}{w}\\right)\\right] \\;+\\; p \\exp\\!\\left(-\\frac{(T - T_p)^2}{2\\sigma^2}\\right).\n$$\n所有参数和温度均为约化单位。在整个问题中，假设 $k_{\\mathrm{B}}=1$。\n\n实现一个完整的程序，该程序：\n- 仅使用您推导的信息和定律，为每个测试用例推导恒定散度温度网格，不依赖任何外部数据。\n- 对于每个相邻对 $(T_i, T_{i+1})$，根据您的推导计算小步长不对称散度估计值 $D_i \\equiv D_{\\mathrm{KL}}(\\rho_{T_i} \\parallel \\rho_{T_{i+1}})$，并报告 $\\{D_i\\}$ 与均匀目标 $\\delta$ 的最大相对偏差。\n- 生成一行输出，其中包含所有测试用例的结果列表，格式为方括号括起来的逗号分隔列表。对于每个测试用例，输出一个包含三个条目的列表：目标散度 $\\delta$、最大相对偏差以及完整的温度网格（作为浮点数列表）。所有浮点数值必须四舍五入到 $6$ 位小数。\n\n测试套件。使用以下三个测试用例，每个用例由 $(a,b,T_g,w,p,T_p,\\sigma,T_{\\min},T_{\\max},N)$ 指定：\n- 用例 1: $(a,b,T_g,w,p,T_p,\\sigma,T_{\\min},T_{\\max},N) = (1.0, 2.5, 0.5, 0.06, 1.2, 0.65, 0.07, 0.3, 1.2, 12)$。\n- 用例 2: $(a,b,T_g,w,p,T_p,\\sigma,T_{\\min},T_{\\max},N) = (1.0, 2.5, 0.5, 0.06, 1.2, 0.65, 0.07, 0.4, 0.6, 6)$。\n- 用例 3: $(a,b,T_g,w,p,T_p,\\sigma,T_{\\min},T_{\\max},N) = (0.8, 3.5, 0.45, 0.04, 1.5, 0.58, 0.05, 0.25, 0.9, 10)$。\n\n最终输出格式。您的程序应生成一行输出，其中包含结果，格式为方括号括起来的逗号分隔列表，每个测试用例对应一个形式为 $[\\delta, \\mathrm{max\\_rel\\_dev}, [T_0, T_1, \\dots, T_{N-1}]]$ 的列表。所有数字必须四舍五入到 $6$ 位小数。例如，语法模板为 $[[\\delta_1, d_1, [\\dots]],[\\delta_2, d_2, [\\dots]],[\\delta_3, d_3, [\\dots]]]$。", "solution": "该问题要求设计并实现一种算法，用于为副本交换分子动力学 (REMD) 生成优化的温度网格，方法是确保相邻副本的正则概率分布之间具有恒定的 Kullback-Leibler (KL) 散度。解决方案需要从第一性原理进行推导，然后在一个模型系统上进行数值实现和评估。\n\n### 第一部分：第一性原理推导\n\n我们从统计力学和信息论的基本定义开始，使用约化单位，其中玻尔兹曼常数 $k_{\\mathrm{B}}$ 设为 $1$。\n\n一个势能为 $U(\\mathbf{x})$ 的系统在逆温度 $\\beta = 1/T$ 下的正则概率密度由下式给出：\n$$\n\\rho_{\\beta}(\\mathbf{x}) = \\frac{1}{Z(\\beta)} e^{-\\beta U(\\mathbf{x})}\n$$\n其中 $\\mathbf{x}$ 代表系统的微观状态坐标，而 $Z(\\beta) = \\int e^{-\\beta U(\\mathbf{x})} d\\mathbf{x}$ 是正则配分函数。\n\n从分布 $\\sigma$ 到分布 $\\rho$ 的 Kullback–Leibler (KL) 散度定义为：\n$$\nD_{\\mathrm{KL}}(\\rho \\parallel \\sigma) = \\int \\rho(\\mathbf{x}) \\ln\\left(\\frac{\\rho(\\mathbf{x})}{\\sigma(\\mathbf{x})}\\right) d\\mathbf{x}\n$$\n这个量度量了用 $\\sigma$ 近似 $\\rho$ 时丢失的信息。对于 REMD，我们关心的是相邻温度下的分布之间的散度，特别是 $D_{\\mathrm{KL}}(\\rho_{T} \\parallel \\rho_{T+\\Delta T})$。以逆温度 $\\beta$ 表示，设两个状态分别处于 $\\beta_1$ 和 $\\beta_2$。其散度为：\n$$\nD_{\\mathrm{KL}}(\\rho_{\\beta_1} \\parallel \\rho_{\\beta_2}) = \\int \\rho_{\\beta_1}(\\mathbf{x}) \\ln\\left(\\frac{Z(\\beta_2)^{-1} e^{-\\beta_1 U(\\mathbf{x})}}{Z(\\beta_2)^{-1} e^{-\\beta_2 U(\\mathbf{x})}}\\right) d\\mathbf{x}\n$$\n$$\nD_{\\mathrm{KL}}(\\rho_{\\beta_1} \\parallel \\rho_{\\beta_2}) = \\int \\rho_{\\beta_1}(\\mathbf{x}) \\left[ \\ln\\left(\\frac{Z(\\beta_2)}{Z(\\beta_1)}\\right) - (\\beta_1 - \\beta_2) U(\\mathbf{x}) \\right] d\\mathbf{x}\n$$\n分离积分并利用 $\\int \\rho_{\\beta_1}(\\mathbf{x}) d\\mathbf{x} = 1$ 和 $\\int U(\\mathbf{x}) \\rho_{\\beta_1}(\\mathbf{x}) d\\mathbf{x} = \\langle U \\rangle_{\\beta_1}$（在 $\\beta_1$ 时的平均能量），我们得到精确表达式：\n$$\nD_{\\mathrm{KL}}(\\rho_{\\beta_1} \\parallel \\rho_{\\beta_2}) = \\ln\\left(\\frac{Z(\\beta_2)}{Z(\\beta_1)}\\right) - (\\beta_1 - \\beta_2) \\langle U \\rangle_{\\beta_1}\n$$\n\n为了推导小步长近似，我们考虑 $\\beta_2 = \\beta_1 + \\Delta\\beta$，并在 $\\beta_1$ 周围对 $\\ln Z(\\beta_1 + \\Delta\\beta)$ 进行泰勒级数展开至 $\\Delta\\beta$ 的二阶：\n$$\n\\ln Z(\\beta_1 + \\Delta\\beta) \\approx \\ln Z(\\beta_1) + \\left.\\frac{\\partial \\ln Z}{\\partial \\beta}\\right|_{\\beta_1} \\Delta\\beta + \\frac{1}{2} \\left.\\frac{\\partial^2 \\ln Z}{\\partial \\beta^2}\\right|_{\\beta_1} (\\Delta\\beta)^2\n$$\n从统计力学中，我们有以下关系：\n平均能量为 $\\langle U \\rangle_{\\beta} = -\\frac{\\partial \\ln Z}{\\partial \\beta}$。\n定容热容为 $C_V(T) = \\frac{\\partial \\langle U \\rangle}{\\partial T} = \\frac{\\partial \\langle U \\rangle}{\\partial \\beta} \\frac{d\\beta}{dT} = \\frac{\\partial}{\\partial \\beta}\\left(-\\frac{\\partial \\ln Z}{\\partial \\beta}\\right) \\left(-\\frac{1}{T^2}\\right) = \\beta^2 \\frac{\\partial^2 \\ln Z}{\\partial \\beta^2}$。\n因此，$\\frac{\\partial^2 \\ln Z}{\\partial \\beta^2} = \\frac{C_V(T)}{\\beta^2} = T^2 C_V(T)$。\n\n将这些导数代入泰勒展开式中：\n$$\n\\ln Z(\\beta_1 + \\Delta\\beta) - \\ln Z(\\beta_1) \\approx -\\langle U \\rangle_{\\beta_1} \\Delta\\beta + \\frac{1}{2} T_1^2 C_V(T_1) (\\Delta\\beta)^2\n$$\n现在，我们将其代入 $D_{\\mathrm{KL}}(\\rho_{\\beta_1} \\parallel \\rho_{\\beta_1+\\Delta\\beta})$ 的精确表达式中。注意 $\\beta_1-\\beta_2 = -\\Delta\\beta$。\n$$\nD_{\\mathrm{KL}}(\\rho_{\\beta_1} \\parallel \\rho_{\\beta_1+\\Delta\\beta}) = (\\ln Z(\\beta_1+\\Delta\\beta) - \\ln Z(\\beta_1)) - (-\\Delta\\beta)\\langle U \\rangle_{\\beta_1}\n$$\n$$\nD_{\\mathrm{KL}} \\approx \\left(-\\langle U \\rangle_{\\beta_1} \\Delta\\beta + \\frac{1}{2} T_1^2 C_V(T_1) (\\Delta\\beta)^2\\right) + \\Delta\\beta \\langle U \\rangle_{\\beta_1}\n$$\n$$\nD_{\\mathrm{KL}} \\approx \\frac{1}{2} T_1^2 C_V(T_1) (\\Delta\\beta)^2\n$$\n问题指定了在温度 $T$ 和 $T+\\Delta T$ 状态之间的散度。逆温度的变化是 $\\Delta\\beta = \\frac{1}{T+\\Delta T} - \\frac{1}{T} = \\frac{T - (T+\\Delta T)}{T(T+\\Delta T)} \\approx -\\frac{\\Delta T}{T^2}$。\n将此代入我们对 $D_{\\mathrm{KL}}$ 的近似中：\n$$\nD_{\\mathrm{KL}}(T, T+\\Delta T) \\approx \\frac{1}{2} T^2 C_V(T) \\left(-\\frac{\\Delta T}{T^2}\\right)^2 = \\frac{C_V(T)}{2T^2} (\\Delta T)^2\n$$\n这就是所要求的、将 KL 散度与比热 $C_V(T)$ 联系起来的、针对小温度步长 $\\Delta T$ 的二阶表达式。\n\n### 第二部分：微分定律与数值程序\n\n为了创建最优温度网格，我们强制要求对于所有相邻的副本对 $(T_i, T_{i+1})$，此散度为常数 $\\delta$。\n$$\n\\delta \\approx \\frac{C_V(T_i)}{2T_i^2} (T_{i+1} - T_i)^2\n$$\n整理此式可得局部温度间距：\n$$\n|T_{i+1} - T_i| \\approx T_i \\sqrt{\\frac{2\\delta}{C_V(T_i)}}\n$$\n这意味着对于一个精细的温度网格，副本的密度应与 $\\sqrt{C_V(T)}/T$ 成正比。\n\n为了将其形式化，我们定义温度流形上的一个微分弧长元 $ds$，使得相等的弧长步长对应相等的 KL 散度。根据我们的近似，有 $\\sqrt{\\delta} \\approx \\frac{\\sqrt{C_V(T)}}{\\sqrt{2}T} |\\Delta T|$。因此，我们可以将弧长元定义为：\n$$\nds = \\frac{\\sqrt{C_V(T)}}{\\sqrt{2}T} dT\n$$\n对于从 $T$ 到 $T+\\Delta T$ 的一个小温度步长，弧长为 $\\Delta s \\approx \\frac{\\sqrt{C_V(T)}}{\\sqrt{2}T} \\Delta T$，相应的 KL 散度为 $\\delta \\approx (\\Delta s)^2$。\n\n为了构建覆盖 $[T_{\\min}, T_{\\max}]$ 的 $N$ 个温度 $\\{T_i\\}_{i=0}^{N-1}$ 的网格，我们必须将该区间的总弧长划分为 $N-1$ 个相等的段。总弧长 $S_{\\text{total}}$ 是积分：\n$$\nS_{\\text{total}} = \\int_{T_{\\min}}^{T_{\\max}} \\frac{\\sqrt{C_V(T')}}{\\sqrt{2}T'} dT'\n$$\n如果将此总长度分成 $N-1$ 个相等的段，则每段的弧长为 $\\Delta S = S_{\\text{total}}/(N-1)$。于是，恒定的目标散度 $\\delta$ 由下式给出：\n$$\n\\delta = (\\Delta S)^2 = \\left( \\frac{S_{\\text{total}}}{N-1} \\right)^2 = \\frac{1}{(N-1)^2} \\left( \\int_{T_{\\min}}^{T_{\\max}} \\frac{\\sqrt{C_V(T')}}{\\sqrt{2}T'} dT' \\right)^2\n$$\n$$\n\\delta = \\frac{1}{2(N-1)^2} \\left( \\int_{T_{\\min}}^{T_{\\max}} \\frac{\\sqrt{C_V(T')}}{T'} dT' \\right)^2\n$$\n\n寻找温度 $T_i$ 的数值程序如下：\n1.  数值计算总弧长积分 $S_{\\text{total}}$。这需要一个数值积分程序。\n2.  使用上述公式计算目标散度 $\\delta$。\n3.  定义累积弧长函数 $S(T)$：\n    $$\n    S(T) = \\int_{T_{\\min}}^{T} \\frac{\\sqrt{C_V(T')}}{\\sqrt{2}T'} dT'\n    $$\n4.  温度 $T_i$ 通过划分总弧长来找到。每个 $T_i$ 的条件是：\n    $$\n    S(T_i) = i \\cdot \\frac{S_{\\text{total}}}{N-1} \\quad \\text{for } i = 0, 1, \\dots, N-1.\n    $$\n5.  这意味着我们必须求函数 $S(T)$ 的反函数。一种数值上稳健的方法是：\n    a. 在 $[T_{\\min}, T_{\\max}]$ 上创建一个精细的温度网格。\n    b. 在此网格上计算累积积分 $S(T)$。\n    c. 创建目标弧长值 $s_i = i \\cdot S_{\\text{total}} / (N-1)$。\n    d. 使用线性插值法找到与目标值 $s_i$ 对应的温度 $T_i$。具体来说，我们通过将精细网格上的温度作为其累积弧长的函数进行插值来找到 $T_i$。\n\n### 第三部分：验证\n\n计算出温度网格 $\\{T_i\\}$ 后，我们通过计算每对相邻温度 $(T_i, T_{i+1})$ 的散度来验证网格的质量，使用推导的小步长公式：\n$$\nD_i = \\frac{C_V(T_i)}{2T_i^2} (T_{i+1} - T_i)^2 \\quad \\text{for } i = 0, \\dots, N-2.\n$$\n然后计算这些值与目标散度 $\\delta$ 的最大相对偏差：\n$$\n\\text{max\\_rel\\_dev} = \\max_{i} \\left| \\frac{D_i - \\delta}{\\delta} \\right|\n$$\n这个度量量化了数值生成的网格满足恒定散度标准的程度。一个较小的值表明根据设计原则，网格质量很高。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Solves the REMD temperature grid optimization problem for the given test cases.\n    \"\"\"\n    test_cases = [\n        # (a, b, Tg, w, p, Tp, sigma, Tmin, Tmax, N)\n        (1.0, 2.5, 0.5, 0.06, 1.2, 0.65, 0.07, 0.3, 1.2, 12),\n        (1.0, 2.5, 0.5, 0.06, 1.2, 0.65, 0.07, 0.4, 0.6, 6),\n        (0.8, 3.5, 0.45, 0.04, 1.5, 0.58, 0.05, 0.25, 0.9, 10),\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        a, b, Tg, w, p, Tp, sigma, Tmin, Tmax, N = case\n\n        def cv_func(T):\n            \"\"\"\n            Surrogate model for the heat capacity C_V(T).\n            \"\"\"\n            term1 = a\n            term2 = (b / 2.0) * (1.0 + np.tanh((T - Tg) / w))\n            term3 = p * np.exp(-((T - Tp)**2) / (2.0 * sigma**2))\n            return term1 + term2 + term3\n\n        def arc_length_integrand(T):\n            \"\"\"\n            The integrand for the arc-length calculation, sqrt(C_V(T)) / T.\n            The factor of sqrt(2) is absorbed into the calculation of delta.\n            \"\"\"\n            return np.sqrt(cv_func(T)) / T\n\n        # Step 1: Compute total arc-length integral L_g = integral(sqrt(Cv)/T dT)\n        # Using a large number of points for high accuracy in numerical integration.\n        num_points_integration = 20000 \n        T_fine = np.linspace(Tmin, Tmax, num_points_integration)\n        \n        # Calculate the integrand on the fine grid\n        g_vals = arc_length_integrand(T_fine)\n        \n        # Use cumulative trapezoidal rule to get the cumulative arc length function\n        S_fine = integrate.cumulative_trapezoid(g_vals, T_fine, initial=0.0)\n        \n        # Total arc-length integral (L_g)\n        L_g = S_fine[-1]\n\n        if N = 1:\n             # Handle edge case where N is 1 or less\n             if N == 1:\n                temps = [Tmin]\n                delta = 0.0\n                max_rel_dev = 0.0\n             else: # N  1 case\n                temps = []\n                delta = 0.0\n                max_rel_dev = 0.0\n\n             temps_str = f\"[{','.join([f'{t:.6f}' for t in temps])}]\"\n             case_str = f\"[{delta:.6f},{max_rel_dev:.6f},{temps_str}]\"\n             all_results.append(case_str)\n             continue\n\n        # Step 2: Compute the uniform target divergence delta\n        delta = 0.5 * (L_g / (N - 1))**2\n\n        # Step 3: Compute the temperature grid by inverting the cumulative arc-length function\n        # We want N temperatures, so we need N target arc-length values.\n        S_targets = np.linspace(0, L_g, N)\n        \n        # Use interpolation to find temperatures T_i that correspond to S_targets.\n        # This effectively inverts the S(T) function.\n        temp_grid = np.interp(S_targets, S_fine, T_fine)\n        \n        # Ensure T_min and T_max are set exactly\n        temp_grid[0] = Tmin\n        temp_grid[-1] = Tmax\n\n        # Step 4: Validate the grid by computing deviations\n        divergences = []\n        for i in range(N - 1):\n            Ti = temp_grid[i]\n            Ti1 = temp_grid[i+1]\n            if Ti  0:\n                cv_i = cv_func(Ti)\n                di = (cv_i / (2.0 * Ti**2)) * (Ti1 - Ti)**2\n                divergences.append(di)\n\n        if delta  0:\n            rel_devs = [np.abs(d - delta) / delta for d in divergences]\n            max_rel_dev = np.max(rel_devs) if rel_devs else 0.0\n        else:\n            max_rel_dev = 0.0\n\n        # Step 5: Format the output for this case\n        temps_str = f\"[{','.join([f'{t:.6f}' for t in temp_grid])}]\"\n        case_str = f\"[{delta:.6f},{max_rel_dev:.6f},{temps_str}]\"\n        all_results.append(case_str)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```", "id": "3442105"}, {"introduction": "成功设置温度阶梯后，评估模拟的采样效率变得至关重要。我们需要确认副本是否在整个温度空间中进行了充分的混合，这通常通过计算“往返时间”来衡量。本练习 [@problem_id:3442032] 将副本在温度空间中的运动简化为一个一维随机游走模型，并让你推导计算一个副本从最低温扩散到最高温再返回所需平均时间的表达式，这是量化 REMD 模拟收敛性的关键指标。", "problem": "考虑一个生物分子系统的复本交换分子动力学 (REMD) 模拟，该模拟在由 $M$ 个温度组成的阶梯 $T_1  T_2  \\dots  T_M$ 上执行并行退火。对应的逆温度为 $\\{\\beta_{1} > \\beta_{2} > \\dots > \\beta_{M}\\}$，其中 $\\beta_{i} = 1/(k_{B} T_{i})$，$k_{B}$ 是玻尔兹曼常数。交换尝试在相邻温度之间进行，遵循标准的复本交换Metropolis准则：位于 $(\\beta_{i}, \\beta_{i+1})$ 且持有瞬时势能 $(E_{i}, E_{i+1})$ 的复本之间的交换被接受的概率为 $A_{i} = \\min\\left(1, \\exp\\left((\\beta_{i} - \\beta_{i+1})(E_{i+1} - E_{i})\\right)\\right)$。假设系统已达到平衡，并且由于对称提议下的细致平衡，边 $i$（温度 $T_{i}$ 和 $T_{i+1}$ 之间）上的平均接受概率在两个方向上是相等的；将此平均值记为 $a_{i}$。\n\n在每次交换尝试时，模拟会交替地为所有奇-偶相邻对和所有偶-奇相邻对提议交换。为了对单个标记复本在温度索引空间中的移动进行建模，这种调度可以表示为在状态 $i \\in \\{1, 2, \\dots, M\\}$ 上的一个离散时间生灭马尔可夫链，其中跨越边 $i$（任一方向）的移动被提议的概率为 $1/2$，并以概率 $a_{i}$ 被接受。因此，在一次交换尝试中，从状态 $i$ 移动到 $i+1$ 的概率是 $u_{i} = \\frac{1}{2} a_{i}$，从状态 $i$ 移动到 $i-1$ 的概率是 $d_{i} = \\frac{1}{2} a_{i-1}$，其中 $d_{1} = 0$ 和 $u_{M} = 0$。剩余的概率对应于停留在当前状态。\n\n给定 $M = 8$ 和一组相邻接受概率\n$$\na_{1} = 0.30,\\quad a_{2} = 0.25,\\quad a_{3} = 0.20,\\quad a_{4} = 0.15,\\quad a_{5} = 0.20,\\quad a_{6} = 0.25,\\quad a_{7} = 0.30.\n$$\n交换尝试周期为 $\\tau_{\\mathrm{ex}} = 2.0\\,\\mathrm{ps}$，即马尔可夫链中的一个离散时间步长对应于 $2.0\\,\\mathrm{ps}$ 的模拟时间。\n\n从细致平衡和马尔可夫链动力学的第一性原理出发，推导期望往返时间（从 $T_{1}$ 上升到 $T_{8}$ 再下降回 $T_{1}$）的解析表达式，以离散交换尝试次数为单位，然后计算其物理时间值。最终答案以纳秒表示，并四舍五入到四位有效数字。", "solution": "用户要求我解决一个与复本交换分子动力学 (REMD) 相关的问题。\n\n### 步骤1：提取已知条件\n-   一个使用并行退火的复本交换分子动力学 (REMD) 模拟。\n-   温度（复本）数量：$M = 8$。\n-   温度阶梯：$T_1  T_2  \\dots  T_M$，逆温度为 $\\{\\beta_{1} > \\beta_{2} > \\dots > \\beta_{M}\\}$，其中 $\\beta_{i} = 1/(k_{B} T_{i})$。\n-   在 $(\\beta_{i}, \\beta_{i+1})$ 处的复本之间，能量为 $(E_{i}, E_{i+1})$ 时的交换接受概率：$A_{i} = \\min\\left(1, \\exp\\left((\\beta_{i} - \\beta_{i+1})(E_{i+1} - E_{i})\\right)\\right)$。\n-   $T_i$ 和 $T_{i+1}$ 之间的相邻交换的平均接受概率为 $a_i$。\n-   复本移动被建模为在状态 $i \\in \\{1, 2, \\dots, M\\}$ 上的离散时间生灭马尔可夫链。\n-   从状态 $i$ 移动到 $i+1$ 的概率：$u_{i} = \\frac{1}{2} a_{i}$，其中 $u_{M} = 0$。\n-   从状态 $i$ 移动到 $i-1$ 的概率：$d_{i} = \\frac{1}{2} a_{i-1}$，其中 $d_{1} = 0$。\n-   给定的接受概率：$a_{1} = 0.30$，$a_{2} = 0.25$，$a_{3} = 0.20$，$a_{4} = 0.15$，$a_{5} = 0.20$，$a_{6} = 0.25$，$a_{7} = 0.30$。\n-   交换尝试周期：$\\tau_{\\mathrm{ex}} = 2.0\\,\\mathrm{ps}$。\n-   任务是推导期望往返时间（$T_1 \\to T_8 \\to T_1$）的解析表达式，并计算其以纳秒为单位的值，四舍五入到四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n1.  **科学依据**：该问题基于成熟的统计力学方法——复本交换分子动力学（REMD）或并行退火。Metropolis接受准则的陈述是正确的。将复本扩散建模为一维生灭过程是分析REMD模拟时使用的标准且有效的简化方法。\n2.  **适定性**：该问题是适定的。它提供了一个明确定义的马尔可夫链模型，并要求计算一个可计算的量，即往返的平均首达时间。所有必要的参数（$M$、$a_i$、$\\tau_{\\mathrm{ex}}$）都已提供。存在一个唯一、稳定且有意义的解。\n3.  **客观性**：该问题以精确、客观的语言陈述。没有主观或基于观点的陈述。\n4.  **无其他缺陷**：该问题是自洽的，没有矛盾，数据是一致的。这是一个与其所述主题直接相关的可形式化问题。它并非微不足道，因为它需要为特定的生灭过程推导平均首达时间。\n\n### 步骤3：结论与行动\n该问题是**有效的**。现在开始求解过程。\n\n### 推导与求解\n\n问题要求计算从最低温度 $T_1$（状态 $i=1$）开始，行进到最高温度 $T_M$（状态 $i=M=8$），再返回到 $T_1$ 的期望往返时间。这个时间 $\\tau_{RT}$ 是两个平均首达时间（MFPT）之和：\n1.  从状态 1 到状态 $M$ 的MFPT，记为 $\\tau_{1 \\to M}$。\n2.  从状态 $M$ 到状态 1 的MFPT，记为 $\\tau_{M \\to 1}$。\n\n所以，$\\tau_{RT} = \\tau_{1 \\to M} + \\tau_{M \\to 1}$。我们将以离散交换尝试次数为单位，推导这两个量的表达式。\n\n复本的移动由状态 $\\{1, 2, \\dots, M\\}$ 上的离散时间生灭马尔可夫链描述。转移概率给出如下：\n-   $u_i = P(i \\to i+1) = \\frac{1}{2} a_i$，对于 $i \\in \\{1, \\dots, M-1\\}$。\n-   $d_i = P(i \\to i-1) = \\frac{1}{2} a_{i-1}$，对于 $i \\in \\{2, \\dots, M\\}$。\n-   $r_i = P(i \\to i) = 1 - u_i - d_i$。\n边界条件是 $d_1 = 0$ 和 $u_M = 0$，这对应于反射边界。\n\n该模型的一个关键属性是状态 $i$ 的向上转移概率与状态 $i+1$ 的向下转移概率之间的关系：\n$u_i = \\frac{1}{2} a_i$\n$d_{i+1} = \\frac{1}{2} a_i$\n因此，对于 $i \\in \\{1, \\dots, M-1\\}$，$u_i = d_{i+1}$。这极大地简化了分析。\n\n**1. 计算 $\\tau_{1 \\to M}$**\n设 $k_i$ 是从状态 $i$ 开始，首次到达状态 $M$ 的期望步数（MFPT）。我们关心的是 $k_1$。在此计算中，目标状态 $M$ 被视为吸收态，因此 $k_M = 0$。\n对于任何状态 $i \\in \\{1, \\dots, M-1\\}$，期望时间由单步递推关系给出：\n$$ k_i = 1 + u_i k_{i+1} + d_i k_{i-1} + (1 - u_i - d_i)k_i $$\n整理后得到：\n$$ u_i(k_i - k_{i+1}) + d_i(k_i - k_{i-1}) = 1 $$\n$$ u_i(k_i - k_{i+1}) - d_i(k_{i-1} - k_i) = 1 $$\n在反射边界 $i=1$ 处，我们有 $d_1=0$，因此一个特殊关系成立：\n$$ u_1(k_1 - k_2) = 1 \\implies k_1 - k_2 = \\frac{1}{u_1} $$\n对于 $i > 1$，我们可以使用一般递推关系。让我们建立一个模式。对于 $i=2$：\n$$ u_2(k_2 - k_3) - d_2(k_1 - k_2) = 1 $$\n使用 $d_2 = u_1$ 和 $k_1-k_2 = 1/u_1$：\n$$ u_2(k_2 - k_3) - u_1\\left(\\frac{1}{u_1}\\right) = 1 \\implies u_2(k_2 - k_3) = 2 \\implies k_2 - k_3 = \\frac{2}{u_2} $$\n我们可以通过归纳法证明 $k_i - k_{i+1} = i/u_i$。\n假设 $k_{i-1} - k_i = (i-1)/u_{i-1}$。递推关系是 $u_i(k_i-k_{i+1}) = 1 + d_i(k_{i-1}-k_i)$。\n使用 $d_i = u_{i-1}$ 和假设：\n$$ u_i(k_i - k_{i+1}) = 1 + u_{i-1}\\left(\\frac{i-1}{u_{i-1}}\\right) = 1 + (i-1) = i $$\n因此，对于 $i \\in \\{1, \\dots, M-1\\}$，$k_i - k_{i+1} = i/u_i$。归纳成功。\n\n为了找到 $k_1$，我们使用伸缩求和：\n$$ k_1 - k_M = \\sum_{i=1}^{M-1} (k_i - k_{i+1}) $$\n由于 $k_M=0$，我们得到 $\\tau_{1 \\to M}$ 的表达式：\n$$ \\tau_{1 \\to M} = k_1 = \\sum_{i=1}^{M-1} (k_i - k_{i+1}) = \\sum_{i=1}^{M-1} \\frac{i}{u_i} $$\n\n**2. 计算 $\\tau_{M \\to 1}$**\n设 $g_i$ 是从状态 $i$ 开始，首次到达状态 1 的MFPT。我们想要求 $g_M$。现在状态 1 是吸收态，因此 $g_1 = 0$。递推关系相同，但边界条件不同。\n$$ u_i(g_i - g_{i+1}) - d_i(g_{i-1} - g_i) = 1 $$\n在反射边界 $i=M$ 处，我们有 $u_M=0$：\n$$ -d_M(g_{M-1} - g_M) = 1 \\implies g_M - g_{M-1} = \\frac{1}{d_M} $$\n对于 $i=M-1$：\n$$ u_{M-1}(g_{M-1} - g_M) - d_{M-1}(g_{M-2} - g_{M-1}) = 1 $$\n使用 $g_M-g_{M-1} = 1/d_M$ 和 $u_{M-1}=d_M$：\n$$ d_M\\left(-\\frac{1}{d_M}\\right) - d_{M-1}(g_{M-2} - g_{M-1}) = 1 \\implies -1 + d_{M-1}(g_{M-1} - g_{M-2}) = 1 $$\n$$ d_{M-1}(g_{M-1} - g_{M-2}) = 2 \\implies g_{M-1} - g_{M-2} = \\frac{2}{d_{M-1}} $$\n我们可以通过归纳法证明 $g_{i+1} - g_i = (M-i)/d_{i+1}$。\n这对 $i=M-1$ 成立（$g_M-g_{M-1} = (M-(M-1))/d_M = 1/d_M$），也对 $i=M-2$ 成立（$g_{M-1}-g_{M-2}=(M-(M-2))/d_{M-1}=2/d_{M-1}$）。一般性证明与 $k_i$ 的证明类似。\n\n为了找到 $g_M$，我们使用伸缩求和：\n$$ g_M - g_1 = \\sum_{i=1}^{M-1} (g_{i+1} - g_i) $$\n由于 $g_1=0$，我们得到 $\\tau_{M \\to 1}$ 的表达式：\n$$ \\tau_{M \\to 1} = g_M = \\sum_{i=1}^{M-1} (g_{i+1} - g_i) = \\sum_{i=1}^{M-1} \\frac{M-i}{d_{i+1}} $$\n\n**3. 总往返时间 $\\tau_{RT}$**\n以交换尝试次数为单位的总期望往返时间是：\n$$ \\tau_{RT\\_steps} = \\tau_{1 \\to M} + \\tau_{M \\to 1} = \\sum_{i=1}^{M-1} \\frac{i}{u_i} + \\sum_{i=1}^{M-1} \\frac{M-i}{d_{i+1}} $$\n使用恒等式 $u_i = \\frac{1}{2} a_i$ 和 $d_{i+1} = \\frac{1}{2} a_i$：\n$$ \\tau_{RT\\_steps} = \\sum_{i=1}^{M-1} \\frac{i}{(1/2)a_i} + \\sum_{i=1}^{M-1} \\frac{M-i}{(1/2)a_i} = 2 \\left( \\sum_{i=1}^{M-1} \\frac{i}{a_i} + \\sum_{i=1}^{M-1} \\frac{M-i}{a_i} \\right) $$\n合并求和：\n$$ \\tau_{RT\\_steps} = 2 \\sum_{i=1}^{M-1} \\left( \\frac{i + M - i}{a_i} \\right) = 2 \\sum_{i=1}^{M-1} \\frac{M}{a_i} $$\n这得出了期望步数的最终解析表达式：\n$$ \\tau_{RT\\_steps} = 2M \\sum_{i=1}^{M-1} \\frac{1}{a_i} $$\n\n**4. 数值计算**\n给定 $M=8$ 和接受概率 $a_1, \\dots, a_7$。首先，我们计算总和：\n$$ \\sum_{i=1}^{7} \\frac{1}{a_i} = \\frac{1}{a_1} + \\frac{1}{a_2} + \\frac{1}{a_3} + \\frac{1}{a_4} + \\frac{1}{a_5} + \\frac{1}{a_6} + \\frac{1}{a_7} $$\n$$ \\sum_{i=1}^{7} \\frac{1}{a_i} = \\frac{1}{0.30} + \\frac{1}{0.25} + \\frac{1}{0.20} + \\frac{1}{0.15} + \\frac{1}{0.20} + \\frac{1}{0.25} + \\frac{1}{0.30} $$\n使用分数以保持精度：\n$$ \\sum_{i=1}^{7} \\frac{1}{a_i} = \\frac{10}{3} + 4 + 5 + \\frac{100}{15} + 5 + 4 + \\frac{10}{3} $$\n$$ \\sum_{i=1}^{7} \\frac{1}{a_i} = \\frac{10}{3} + 4 + 5 + \\frac{20}{3} + 5 + 4 + \\frac{10}{3} = 2 \\left(\\frac{10}{3} + 4 + 5\\right) + \\frac{20}{3} $$\n$$ \\sum_{i=1}^{7} \\frac{1}{a_i} = 2 \\left(\\frac{10}{3} + \\frac{12}{3} + \\frac{15}{3}\\right) + \\frac{20}{3} = 2 \\left(\\frac{37}{3}\\right) + \\frac{20}{3} = \\frac{74}{3} + \\frac{20}{3} = \\frac{94}{3} $$\n现在，我们计算总步数：\n$$ \\tau_{RT\\_steps} = 2M \\sum_{i=1}^{M-1} \\frac{1}{a_i} = 2(8) \\left(\\frac{94}{3}\\right) = 16 \\times \\frac{94}{3} = \\frac{1504}{3} $$\n这大约是 $501.333...$ 次交换尝试。\n\n**5. 转换为物理时间**\n一次交换尝试的持续时间是 $\\tau_{\\mathrm{ex}} = 2.0\\,\\mathrm{ps}$。往返的总物理时间是：\n$$ \\tau_{RT} = \\tau_{RT\\_steps} \\times \\tau_{\\mathrm{ex}} = \\frac{1504}{3} \\times 2.0\\,\\mathrm{ps} = \\frac{3008}{3}\\,\\mathrm{ps} $$\n$\\tau_{RT} \\approx 1002.666...\\,\\mathrm{ps}$。\n问题要求答案以纳秒（ns）为单位，其中 $1\\,\\mathrm{ns} = 1000\\,\\mathrm{ps}$。\n$$ \\tau_{RT} = \\frac{1002.666...}{1000}\\,\\mathrm{ns} = 1.002666...\\,\\mathrm{ns} $$\n四舍五入到四位有效数字，我们得到 $1.003\\,\\mathrm{ns}$。", "answer": "$$\n\\boxed{1.003}\n$$", "id": "3442032"}]}