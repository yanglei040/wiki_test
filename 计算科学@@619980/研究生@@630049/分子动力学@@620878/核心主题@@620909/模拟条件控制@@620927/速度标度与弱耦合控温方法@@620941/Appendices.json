{"hands_on_practices": [{"introduction": "在控制温度之前，我们必须能够准确地测量它。本练习 [@problem_id:3459751] 提供了一个从模拟快照计算瞬时动能温度的实践场景。它要求您通过仔细计算所有平移和旋转自由度，同时减去由全局约束移除的自由度，来应用能量均分定理——这是分析任何分子模拟的一项基本技能。", "problem": "考虑一个分子动力学（MD）模拟，该模拟包含一个系综，由 $N_{m}$ 个相同的刚性线性分子组成，位于一个周期性的立方盒子中。MD积分器在每个时间步都会移除整体质心的漂移，这等效于将系统的总线动量约束为零。速度标度弱耦合恒温器所使用的瞬时动能温度 $T_{\\mathrm{kin}}$ 的定义是，将所有被恒温的二次自由度的瞬时总动能与热能相等。\n\n对于一个刚性线性分子，动能由平动部分和转动部分组成。转动能包括绕通过质心的两个相互垂直的轴的转动；绕分子轴的转动不产生贡献，因为在该轴上的转动惯量在经典层面上可以忽略不计。\n\n从单个瞬时构型中，您记录了以下量：\n- 平动和 $S_{v} \\equiv \\sum_{i=1}^{N_{m}} m_{i}\\,|\\mathbf{v}_{i}|^{2} = 6.60 \\times 10^{-18}$ J。\n- 转动和 $S_{\\omega} \\equiv \\sum_{i=1}^{N_{m}} \\boldsymbol{\\omega}_{i}^{\\top}\\mathbf{I}_{i}\\,\\boldsymbol{\\omega}_{i} = 4.17 \\times 10^{-18}$ J。\n\n假设 $N_{m} = 512$，并且只施加了整体质心约束（没有其他全局约束）。玻尔兹曼常数为 $k_{B} = 1.380649 \\times 10^{-23}$ J K$^{-1}$。\n\n从第一性原理和对刚性线性分子的恰当自由度计数出发，计算与速度标度弱耦合恒温器相一致的瞬时动能温度 $T_{\\mathrm{kin}}$。将您的答案四舍五入到四位有效数字，并以开尔文为单位表示温度。", "solution": "在尝试求解之前，将首先验证问题的科学合理性、自洽性和清晰度。\n\n### 步骤1：提取已知条件\n\n- 分子数：$N_{m} = 512$\n- 分子类型：相同的刚性线性分子\n- 约束：总线动量为零（$\\sum_{i=1}^{N_{m}} m_{i} \\mathbf{v}_{i} = \\mathbf{0}$）\n- 每个分子的转动自由度：$2$（绕分子轴的转动可忽略）\n- 平动和：$S_{v} \\equiv \\sum_{i=1}^{N_{m}} m_{i}\\,|\\mathbf{v}_{i}|^{2} = 6.60 \\times 10^{-18}$ J\n- 转动和：$S_{\\omega} \\equiv \\sum_{i=1}^{N_{m}} \\boldsymbol{\\omega}_{i}^{\\top}\\mathbf{I}_{i}\\,\\boldsymbol{\\omega}_{i} = 4.17 \\times 10^{-18}$ J\n- 玻尔兹曼常数：$k_{B} = 1.380649 \\times 10^{-23}$ J K$^{-1}$\n- 瞬时动能温度（$T_{\\mathrm{kin}}$）的定义：满足被恒温自由度的总瞬时动能与热能之间关系的量，类似于能量均分定理。\n\n### 步骤2：使用提取的已知条件进行验证\n\n根据所需标准对问题进行评估：\n\n- **科学基础**：该问题植根于经典统计力学和分子动力学（MD）模拟的基本原理。动能、自由度、约束以及恒温器动能温度的定义等概念都是该领域中标准且成熟的。\n- **良态问题**：所有必要的数据（$N_m$、$S_v$、$S_\\omega$、$k_B$）和条件（刚性线性分子，总动量为零）均已提供，足以计算出瞬时动能温度的唯一值。\n- **客观性**：问题以精确、定量的语言陈述，没有歧义或主观论断。\n\n该问题不存在任何列出的缺陷。这是一个标准的、自洽的物理问题，需要仔细计算自由度，这是统计力学中的一项常见任务。所提供的数值对于纳米尺度的模拟是物理上合理的。\n\n### 步骤3：结论与行动\n\n问题陈述是**有效的**。将提供解答。\n\n### 解答\n\n瞬时动能温度 $T_{\\mathrm{kin}}$ 是通过将系统的总瞬时动能 $K_{\\mathrm{total}}$ 与可用的（被恒温的）二次自由度数 $N_{\\mathrm{dof}}$ 相关联来定义的。这种关系是能量均分定理的一个瞬时应用：\n$$K_{\\mathrm{total}} = \\frac{1}{2} N_{\\mathrm{dof}} k_{B} T_{\\mathrm{kin}}$$\n为了求出 $T_{\\mathrm{kin}}$，我们必须首先根据所提供的信息确定 $K_{\\mathrm{total}}$ 和 $N_{\\mathrm{dof}}$。\n\n**1. 计算总瞬时动能（$K_{\\mathrm{total}}$）**\n\n总动能是所有分子的平动动能和转动动能之和：\n$$K_{\\mathrm{total}} = K_{\\mathrm{trans}} + K_{\\mathrm{rot}}$$\n平动动能 $K_{\\mathrm{trans}}$ 由 $K_{\\mathrm{trans}} = \\sum_{i=1}^{N_{m}} \\frac{1}{2} m_{i} |\\mathbf{v}_{i}|^{2}$ 给出。使用所提供的平动和 $S_{v} = \\sum_{i=1}^{N_{m}} m_{i} |\\mathbf{v}_{i}|^{2}$，我们有：\n$$K_{\\mathrm{trans}} = \\frac{1}{2} S_{v}$$\n对于刚体系统，转动动能 $K_{\\mathrm{rot}}$ 由 $K_{\\mathrm{rot}} = \\sum_{i=1}^{N_{m}} \\frac{1}{2} \\boldsymbol{\\omega}_{i}^{\\top}\\mathbf{I}_{i}\\,\\boldsymbol{\\omega}_{i}$ 给出。使用所提供的转动和 $S_{\\omega} = \\sum_{i=1}^{N_{m}} \\boldsymbol{\\omega}_{i}^{\\top}\\mathbf{I}_{i}\\,\\boldsymbol{\\omega}_{i}$，我们有：\n$$K_{\\mathrm{rot}} = \\frac{1}{2} S_{\\omega}$$\n因此，总瞬时动能为：\n$$K_{\\mathrm{total}} = \\frac{1}{2} S_{v} + \\frac{1}{2} S_{\\omega} = \\frac{1}{2} (S_{v} + S_{\\omega})$$\n代入给定值：\n$$S_{v} = 6.60 \\times 10^{-18} \\, \\mathrm{J}$$\n$$S_{\\omega} = 4.17 \\times 10^{-18} \\, \\mathrm{J}$$\n$$K_{\\mathrm{total}} = \\frac{1}{2} (6.60 \\times 10^{-18} \\, \\mathrm{J} + 4.17 \\times 10^{-18} \\, \\mathrm{J}) = \\frac{1}{2} (10.77 \\times 10^{-18} \\, \\mathrm{J}) = 5.385 \\times 10^{-18} \\, \\mathrm{J}$$\n\n**2. 计算自由度数（$N_{\\mathrm{dof}}$）**\n\n被恒温的自由度数是动能表达式中二次项的总数减去施加于系统的约束数。\n\n对于一个由 $N_{m}$ 个相同的刚性线性分子组成的系统：\n- 每个分子有 $3$ 个平动自由度，与其质心在三维空间中的运动相关。\n- 每个分子有 $2$ 个转动自由度，因为绕与分子对齐的主轴的转动在经典上可以忽略不计。\n因此，一个无约束系统的总自由度数为 $(3 + 2)N_m = 5 N_m$。\n\n问题陈述施加了一个约束：移除了整体质心的漂移。这等效于将系统的总线动量设为零：\n$$\\sum_{i=1}^{N_{m}} m_{i} \\mathbf{v}_{i} = \\mathbf{0}$$\n这是一个矢量方程，它对系统的速度施加了 $3$ 个独立的标量约束（对应于笛卡尔坐标的 $x, y, z$ 每个分量）。这些约束使平动自由度的数量减少了 $3$。转动自由度不受此约束的影响。\n\n因此，被恒温的自由度数为：\n$$N_{\\mathrm{dof}} = (\\text{总自由度}) - (\\text{约束数})$$\n$$N_{\\mathrm{dof}} = (3 N_{m} + 2 N_{m}) - 3 = 5 N_{m} - 3$$\n代入给定值 $N_{m} = 512$：\n$$N_{\\mathrm{dof}} = 5(512) - 3 = 2560 - 3 = 2557$$\n\n**3. 计算瞬时动能温度（$T_{\\mathrm{kin}}$）**\n\n我们现在重新整理 $T_{\\mathrm{kin}}$ 的定义方程：\n$$T_{\\mathrm{kin}} = \\frac{2 K_{\\mathrm{total}}}{N_{\\mathrm{dof}} k_{B}}$$\n代入 $K_{\\mathrm{total}}$、$N_{\\mathrm{dof}}$ 的计算值和 $k_{B}$ 的给定值：\n$$K_{\\mathrm{total}} = 5.385 \\times 10^{-18} \\, \\mathrm{J}$$\n$$N_{\\mathrm{dof}} = 2557$$\n$$k_{B} = 1.380649 \\times 10^{-23} \\, \\mathrm{J}\\,\\mathrm{K}^{-1}$$\n$$T_{\\mathrm{kin}} = \\frac{2 \\times (5.385 \\times 10^{-18})}{2557 \\times (1.380649 \\times 10^{-23})} = \\frac{1.077 \\times 10^{-17}}{3.530347 \\times 10^{-19}} \\, \\mathrm{K}$$\n$$T_{\\mathrm{kin}} \\approx 305.068... \\, \\mathrm{K}$$\n\n问题要求将答案四舍五入到四位有效数字。\n$$T_{\\mathrm{kin}} \\approx 305.1 \\, \\mathrm{K}$$\n这就是与弱耦合恒温器所用定义相一致的系统瞬时动能温度。", "answer": "$$\n\\boxed{305.1}\n$$", "id": "3459751"}, {"introduction": "现在我们知道了如何测量温度，让我们来探索弱耦合恒温器的核心算法。本练习 [@problem_id:3459750] 将引导您推导控制 Berendsen 恒温器行为的离散时间更新方程。通过求解这个方程，您将对一阶温度弛豫过程有定量的理解，并能够预测将系统冷却或加热到目标温度需要多少模拟步数。", "problem": "在一次使用弱耦合（Berendsen）恒温器的恒温分子动力学（MD）模拟中，根据能量均分定理，瞬时动能温度定义为与总动能成正比，因此将所有速度按因子 $\\lambda$ 缩放会使温度缩放 $\\lambda^{2}$ 倍。弱耦合恒温器旨在以弛豫时间 $\\tau_{T}$ 将动能温度向目标温度 $T_{0}$ 进行一阶弛豫。考虑一个时间步长为 $\\Delta t$ 的时间离散化，并令 $T_{n}$ 表示应用 $n$ 次恒温器后的动能温度，其初始值为 $T_{0\\text{,init}}=T(0)=T_{i}$。\n\n从牛顿力学的基本定律、能量均分定理以及通过在每个离散时间步进行速度重标度来实现的朝向目标温度一阶弛豫原理出发，推导 $T_{n}$ 的离散时间更新关系，并以闭合形式求解，从而得到 $T_{n}$ 作为 $n$、$T_{i}$、$T_{0}$、$\\Delta t$ 和 $\\tau_{T}$ 的函数。然后，确定为确保 $\\lvert T_{n}-T_{0}\\rvert\\le \\varepsilon$ 所需的最小整数步数 $n$。\n\n使用以下物理上现实的参数：$T_{0}=300\\,\\mathrm{K}$，$T_{i}=800\\,\\mathrm{K}$，$\\Delta t=2\\,\\mathrm{fs}$，$\\tau_{T}=0.2\\,\\mathrm{ps}$ 和 $\\varepsilon=2\\,\\mathrm{K}$。最终答案只需报告最小整数 $n$。在确定此最小整数之外，无需按有效数字进行舍入。请酌情以 $\\mathrm{K}$ 为单位表示任何中间温度，以 $\\mathrm{fs}$ 或 $\\mathrm{ps}$ 为单位表示时间。", "solution": "该问题是有效的，因为它在科学上基于分子动力学和统计力学的原理，是良构的，具有明确的目标和充足的数据，并且表述客观。\n\nBerendsen 恒温器旨在以特征弛豫时间 $\\tau_{T}$ 强制系统温度 $T$ 向目标温度 $T_{0}$ 进行一阶动能弛豫。其底层的连续动力学由以下微分方程描述：\n$$\n\\frac{dT}{dt} = \\frac{T_{0} - T}{\\tau_{T}}\n$$\n在时间步长为 $\\Delta t$ 的分子动力学模拟中，此方程的简单前向欧拉离散化提供了基于第 $n$ 步温度 $T_{n}$ 来更新第 $n+1$ 步温度 $T_{n+1}$ 的规则：\n$$\n\\frac{T_{n+1} - T_{n}}{\\Delta t} = \\frac{T_{0} - T_{n}}{\\tau_{T}}\n$$\n这可以被重新整理以直接表示 $T_{n+1}$：\n$$\nT_{n+1} = T_{n} + \\frac{\\Delta t}{\\tau_{T}} (T_{0} - T_{n})\n$$\n这一更新在物理上是通过在每个步骤中将所有粒子速度乘以一个因子 $\\lambda$ 来实现的。动能温度 $T$ 与总动能成正比，而总动能是速度的二次函数。因此，将速度缩放 $\\lambda$ 倍会使温度缩放 $\\lambda^{2}$ 倍：$T_{n+1} = \\lambda_{n}^{2} T_{n}$。选择缩放因子 $\\lambda_{n}$ 以满足离散化的弛豫方程。\n\n我们定义常数比率 $r = \\frac{\\Delta t}{\\tau_{T}}$。递归关系变为：\n$$\nT_{n+1} = T_{n} + r(T_{0} - T_{n}) = (1-r)T_{n} + rT_{0}\n$$\n这是一个一阶线性非齐次递归关系。为了求解它，我们可以通过设置 $T_{n+1} = T_{n} = T_{eq}$ 来找到不动点，这给出 $T_{eq} = (1-r)T_{eq} + rT_{0}$，从而得到 $rT_{eq} = rT_{0}$，因此平衡温度为 $T_{eq} = T_{0}$，正如预期。\n\n我们定义一个新变量 $\\delta_{n} = T_{n} - T_{0}$，表示与目标温度的偏差。将 $T_{n} = \\delta_{n} + T_{0}$ 代入递归关系中：\n$$\n(\\delta_{n+1} + T_{0}) = (1-r)(\\delta_{n} + T_{0}) + rT_{0}\n$$\n$$\n\\delta_{n+1} + T_{0} = (1-r)\\delta_{n} + (1-r)T_{0} + rT_{0}\n$$\n$$\n\\delta_{n+1} + T_{0} = (1-r)\\delta_{n} + T_{0}\n$$\n$$\n\\delta_{n+1} = (1-r)\\delta_{n}\n$$\n这是一个简单的几何级数。其解为 $\\delta_{n} = (1-r)^{n} \\delta_{0}$。\n初始偏差为 $\\delta_{0} = T(0) - T_{0} = T_{i} - T_{0}$，其中 $T_{i}$ 是初始温度。\n代回后，我们得到第 $n$ 步的偏差表达式：\n$$\nT_{n} - T_{0} = (T_{i} - T_{0})(1-r)^{n}\n$$\n因此，$T_{n}$ 的闭合形式解为：\n$$\nT_{n} = T_{0} + (T_{i} - T_{0}) \\left( 1 - \\frac{\\Delta t}{\\tau_{T}} \\right)^{n}\n$$\n问题要求找到最小的整数步数 $n$，以确保系统温度与目标温度之间的绝对差小于或等于容差 $\\varepsilon$：\n$$\n|T_{n} - T_{0}| \\le \\varepsilon\n$$\n使用推导出的 $T_{n} - T_{0}$ 表达式：\n$$\n\\left| (T_{i} - T_{0}) \\left( 1 - \\frac{\\Delta t}{\\tau_{T}} \\right)^{n} \\right| \\le \\varepsilon\n$$\n给定的参数为：\n- 初始温度 $T_{i}=800\\,\\mathrm{K}$\n- 目标温度 $T_{0}=300\\,\\mathrm{K}$\n- 时间步长 $\\Delta t=2\\,\\mathrm{fs}$\n- 弛豫时间 $\\tau_{T}=0.2\\,\\mathrm{ps} = 200\\,\\mathrm{fs}$\n- 温度容差 $\\varepsilon=2\\,\\mathrm{K}$\n\n首先，我们计算各项的值。初始温差为 $T_{i} - T_{0} = 800\\,\\mathrm{K} - 300\\,\\mathrm{K} = 500\\,\\mathrm{K}$。这是一个正数。\n时间尺度的比率为 $r = \\frac{\\Delta t}{\\tau_{T}} = \\frac{2\\,\\mathrm{fs}}{200\\,\\mathrm{fs}} = 0.01$。\n项 $(1 - \\frac{\\Delta t}{\\tau_{T}}) = 1 - 0.01 = 0.99$。此项为正且小于1。\n因此，该不等式可以写成不带绝对值符号的形式：\n$$\n(T_{i} - T_{0}) \\left( 1 - \\frac{\\Delta t}{\\tau_{T}} \\right)^{n} \\le \\varepsilon\n$$\n我们需要求解 $n$：\n$$\n\\left( 1 - \\frac{\\Delta t}{\\tau_{T}} \\right)^{n} \\le \\frac{\\varepsilon}{T_{i} - T_{0}}\n$$\n对两边取自然对数：\n$$\nn \\ln\\left( 1 - \\frac{\\Delta t}{\\tau_{T}} \\right) \\le \\ln\\left( \\frac{\\varepsilon}{T_{i} - T_{0}} \\right)\n$$\n由于 $1 - \\frac{\\Delta t}{\\tau_{T}}  1$，其对数为负。因此，当我们除以 $\\ln(1 - \\frac{\\Delta t}{\\tau_{T}})$ 时，必须反转不等号的方向：\n$$\nn \\ge \\frac{\\ln\\left( \\frac{\\varepsilon}{T_{i} - T_{0}} \\right)}{\\ln\\left( 1 - \\frac{\\Delta t}{\\tau_{T}} \\right)}\n$$\n现在，我们代入数值：\n$$\nn \\ge \\frac{\\ln\\left( \\frac{2}{800 - 300} \\right)}{\\ln\\left( 1 - \\frac{2}{200} \\right)}\n$$\n$$\nn \\ge \\frac{\\ln\\left( \\frac{2}{500} \\right)}{\\ln\\left( 1 - 0.01 \\right)}\n$$\n$$\nn \\ge \\frac{\\ln(0.004)}{\\ln(0.99)}\n$$\n使用计算器计算对数值：\n$$\n\\ln(0.004) \\approx -5.52146\n$$\n$$\n\\ln(0.99) \\approx -0.01005\n$$\n因此，关于 $n$ 的不等式为：\n$$\nn \\ge \\frac{-5.52146}{-0.01005} \\approx 549.399\n$$\n由于 $n$ 必须是代表模拟步数的整数，我们必须取满足此条件的最小整数。这是计算值的上取整。\n$$\nn_{min} = \\lceil 549.399 \\rceil = 550\n$$\n因此，至少需要 $550$ 次恒温器应用（步）才能将温度偏差降至指定容差范围内。", "answer": "$$\n\\boxed{550}\n$$", "id": "3459750"}, {"introduction": "虽然速度标度恒温器很简单，但它们也存在一些重大缺陷，尤其是在与约束系统一起使用时。本练习 [@problem_id:3459691] 深入探讨了“伪加热”这一关键问题，即简单的速度标度会引入能量，而这些能量随后又被约束算法移除，从而导致能量漂移。这要求您从将速度投影到约束流形上的角度进行思考，这是一种复杂但至关重要的技术，可确保恒温器仅作用于有效的热运动。", "problem": "一个包含$N$个粒子的分子动力学系统，其笛卡尔坐标为 $\\mathbf{x} \\in \\mathbb{R}^{3N}$，速度为 $\\mathbf{v} \\in \\mathbb{R}^{3N}$，质量矩阵为对角阵 $\\mathbf{M} = \\mathrm{diag}(m_1, m_2, \\dots, m_{3N})$。该系统受到$m$个完整约束 $\\boldsymbol{\\phi}(\\mathbf{x}) = \\mathbf{0}$（例如，固定键长），其雅可比矩阵为 $\\mathbf{B}(\\mathbf{x}) = \\partial \\boldsymbol{\\phi} / \\partial \\mathbf{x} \\in \\mathbb{R}^{m \\times 3N}$。为使速度与约束保持一致，必须满足瞬时约束兼容性条件：$\\mathbf{B}\\,\\mathbf{v} = \\mathbf{0}$。\n\n弱耦合控温器（例如Berendsen方法）试图通过在离散时间点上将速度乘以一个标量因子 $\\lambda$ 来进行重标定，从而使动能温度弛豫至目标值。$\\lambda$ 的选择基于瞬时动能温度与目标温度的偏差。动能为 $K(\\mathbf{v}) = \\tfrac{1}{2}\\,\\mathbf{v}^{\\top}\\mathbf{M}\\mathbf{v}$，动能温度通过能量均分定理与动能自由度数和 $K$ 相关。\n\n朴素的速度标定可能会导致受约束键的伪加热，因为标定过程可能引入违反 $\\mathbf{B}\\,\\mathbf{v} = \\mathbf{0}$ 的速度分量，从而在重新施加约束时导致约束力做功。考虑在单次控温步骤中修改 $\\mathbf{v}$ 的方法，以便在重标定动能的同时，不向受约束的模式注入能量。\n\n哪个选项指定了一种方法，该方法从第一性原理以及上述定义的结构 $\\mathbf{M}$ 和 $\\mathbf{B}$ 出发，通过确保在控温步骤中约束力不做功来防止伪加热？\n\nA. 将控温标定因子 $\\lambda$ 统一应用于所有粒子的速度，即 $\\mathbf{v}^{\\prime} = \\lambda\\,\\mathbf{v}$，然后让约束算法（例如 SHAKE 或 RATTLE）通过将 $\\mathbf{v}^{\\prime}$ 投影回 $\\{\\mathbf{v} \\,|\\, \\mathbf{B}\\,\\mathbf{v} = \\mathbf{0}\\}$ 来修正任何漂移。\n\nB. 在标定之前，使用质量加权投影算符 $\\mathbf{P} = \\mathbf{I} - \\mathbf{M}^{-1}\\mathbf{B}^{\\top}\\left(\\mathbf{B}\\,\\mathbf{M}^{-1}\\mathbf{B}^{\\top}\\right)^{-1}\\mathbf{B}$ 将 $\\mathbf{v}$ 投影到约束流形的切空间上，得到 $\\mathbf{v}_{\\mathrm{tan}} = \\mathbf{P}\\,\\mathbf{v}$。仅对切向分量进行标定：$\\mathbf{v}^{\\prime} = \\lambda\\,\\mathbf{v}_{\\mathrm{tan}} + \\left(\\mathbf{I}-\\mathbf{P}\\right)\\mathbf{v}$，并在必要时将约束重新施加至机器精度。\n\nC. 通过计算 $\\mathbf{B}\\,\\mathbf{v}$ 来识别 $\\mathbf{v}$ 沿约束方向的分量，并仅对这些分量乘以 $\\lambda$ 进行标定，保持不受约束的分量不变，从而使约束违背被控温器抑制。\n\nD. 将所有参与约束的原子 $i$ 的速度设为零，即 $\\mathbf{v}_{i} = \\mathbf{0}$，并对剩余原子的速度乘以 $\\lambda$ 进行标定，以达到目标温度，同时避免能量流入受约束的键。\n\nE. 选择一个质量加权的、针对特定原子的标定因子 $\\lambda_{i}$，使得较重的原子比较轻的原子标定得少，并应用 $\\mathbf{v}^{\\prime}_{i} = \\lambda_{i}\\,\\mathbf{v}_{i}$，其中 $\\lambda_{i}$ 的确定旨在保持总动能不变，但减少受约束坐标的涨落。", "solution": "首先验证问题陈述，以确保其科学上合理、良定且客观。\n\n### 步骤1：提取已知条件\n- 分子动力学系统有 $N$ 个粒子。\n- 笛卡尔坐标由向量 $\\mathbf{x} \\in \\mathbb{R}^{3N}$ 表示。\n- 笛卡尔速度由向量 $\\mathbf{v} \\in \\mathbb{R}^{3N}$ 表示。\n- 质量矩阵是对角阵，$\\mathbf{M} = \\mathrm{diag}(m_1, m_2, \\dots, m_{3N})$。\n- 系统受到 $m$ 个完整约束，$\\boldsymbol{\\phi}(\\mathbf{x}) = \\mathbf{0}$。\n- 约束雅可比矩阵为 $\\mathbf{B}(\\mathbf{x}) = \\partial \\boldsymbol{\\phi} / \\partial \\mathbf{x} \\in \\mathbb{R}^{m \\times 3N}$。\n- 为使速度与约束一致，必须满足 $\\mathbf{B}\\,\\mathbf{v} = \\mathbf{0}$。\n- 弱耦合控温器通过一个标量因子 $\\lambda$ 来重标定速度。\n- 动能为 $K(\\mathbf{v}) = \\tfrac{1}{2}\\,\\mathbf{v}^{\\top}\\mathbf{M}\\mathbf{v}$。\n- 问题在于朴素的速度标定会引起伪加热，其定义为：在速度标定步骤引入或放大了约束违背后，重新施加约束时，约束力所做的功。\n- 目标是找到一种重标定动能的方法，该方法不会向受约束的模式注入能量，这意味着在控温步骤中约束力不做功。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据：** 该问题牢固地植根于经典力学和计算统计力学的原理，特别是分子动力学（MD）模拟。完整约束、约束雅可比矩阵、质量加权度量和投影算符等概念是高级MD文献中的标准内容。将控温器与SHAKE或RATTLE等约束算法耦合时出现的“伪加热”或能量漂移问题，是一种有充分文献记载的人为效应。\n- **良定性：** 该问题提供了一套清晰且充分的定义来构建解决方案。它要求找到一种满足明确定义的物理条件（约束力不做功）的特定方法。预期在选项中存在一个唯一的、具有物理意义的解。\n- **客观性：** 语言形式化、技术性强，且不含主观性。\n\n### 步骤3：结论与行动\n问题陈述是有效的。它描述了分子动力学模拟中的一个标准且不平凡的问题。解决方案可以从约束力学的第一性原理推导得出。\n\n### 解题推导\n\n如果系统的速度矢量中存在一个分量，会在后续的时间步中导致对约束 $\\boldsymbol{\\phi}(\\mathbf{x}) = \\mathbf{0}$ 的违背，那么约束力所做的功就非零。速度矢量 $\\mathbf{v}$ 在构型 $\\mathbf{x}$ 处与约束一致的条件是，它必须位于约束流形的切空间内。这在数学上表示为 $\\mathbf{B}\\,\\mathbf{v} = \\mathbf{0}$。\n\n任意速度矢量 $\\mathbf{v}$ 均可唯一地分解为在质量加权内积（$\\langle \\mathbf{a}, \\mathbf{b} \\rangle_M = \\mathbf{a}^\\top \\mathbf{M} \\mathbf{b}$）下正交的两个分量：一个与约束流形相切的分量 $\\mathbf{v}_{\\mathrm{tan}}$ 和一个与其正交的分量 $\\mathbf{v}_{\\mathrm{orth}}$。\n$$ \\mathbf{v} = \\mathbf{v}_{\\mathrm{tan}} + \\mathbf{v}_{\\mathrm{orth}} $$\n根据定义，$\\mathbf{v}_{\\mathrm{tan}}$ 满足约束条件，即 $\\mathbf{B}\\,\\mathbf{v}_{\\mathrm{tan}} = \\mathbf{0}$。正交分量 $\\mathbf{v}_{\\mathrm{orth}}$ 代表违背约束的运动，并位于由约束梯度张成的空间中，即对于某个系数向量 $\\boldsymbol{\\gamma}$，有 $\\mathbf{v}_{\\mathrm{orth}} = \\mathbf{M}^{-1}\\mathbf{B}^{\\top}\\boldsymbol{\\gamma}$。\n\n当使用数值积分器时，速度会发生轻微漂移，从而获得一个微小但非零的 $\\mathbf{v}_{\\mathrm{orth}}$ 分量。朴素的速度标定 $\\mathbf{v}' = \\lambda\\,\\mathbf{v}$ 会同时标定两个分量：\n$$ \\mathbf{v}' = \\lambda\\,\\mathbf{v}_{\\mathrm{tan}} + \\lambda\\,\\mathbf{v}_{\\mathrm{orth}} $$\n如果控温器正在加热系统（$\\lambda > 1$），这会放大违背约束的分量 $\\mathbf{v}_{\\mathrm{orth}}$。随后应用约束算法（如RATTLE）时，需要移除这个被放大的分量，这对应于约束力对系统做负功，移除了能量，并导致与预期的控温器作用产生偏差。这就是“伪加热”或能量不守恒问题。\n\n为防止这种情况，控温过程必须只标定对应于有效热运动的速度分量，即 $\\mathbf{v}_{\\mathrm{tan}}$。违背约束的“漂移”分量 $\\mathbf{v}_{\\mathrm{orth}}$ 不应受控温器影响。因此，正确的标定过程是：\n$$ \\mathbf{v}' = \\lambda\\,\\mathbf{v}_{\\mathrm{tan}} + \\mathbf{v}_{\\mathrm{orth}} $$\n该过程将与有效自由度相关的动能 $K_{\\mathrm{tan}} = \\tfrac{1}{2}\\,\\mathbf{v}_{\\mathrm{tan}}^{\\top}\\mathbf{M}\\mathbf{v}_{\\mathrm{tan}}$ 标定 $\\lambda^2$ 倍，同时保持违背约束分量的动能 $K_{\\mathrm{orth}} = \\tfrac{1}{2}\\,\\mathbf{v}_{\\mathrm{orth}}^{\\top}\\mathbf{M}\\mathbf{v}_{\\mathrm{orth}}$ 不变。由于控温步骤不改变 $\\mathbf{v}_{\\mathrm{orth}}$，因此它不对受约束的模式做功。\n\n为实现这一点，我们需要一个投影算符 $\\mathbf{P}$，它能将任意速度矢量 $\\mathbf{v}$ 投影到切空间上：$\\mathbf{v}_{\\mathrm{tan}} = \\mathbf{P}\\,\\mathbf{v}$。那么正交分量就是 $\\mathbf{v}_{\\mathrm{orth}} = (\\mathbf{I}-\\mathbf{P})\\mathbf{v}$。投影到切空间（即 $\\mathbf{B}$ 的零空间）的质量加权投影算符的正确形式为：\n$$ \\mathbf{P} = \\mathbf{I} - \\mathbf{M}^{-1}\\mathbf{B}^{\\top}\\left(\\mathbf{B}\\,\\mathbf{M}^{-1}\\mathbf{B}^{\\top}\\right)^{-1}\\mathbf{B} $$\n可以验证，对任意 $\\mathbf{v}$，都有 $\\mathbf{B}(\\mathbf{P}\\mathbf{v}) = \\mathbf{0}$，这证实了该算符确实投影到切空间。将此投影算符代入所需的标定过程，得到：\n$$ \\mathbf{v}' = \\lambda(\\mathbf{P}\\mathbf{v}) + (\\mathbf{I}-\\mathbf{P})\\mathbf{v} $$\n\n### 逐项分析选项\n\n**A. 将控温标定因子 $\\lambda$ 统一应用于所有粒子的速度，即 $\\mathbf{v}^{\\prime} = \\lambda\\,\\mathbf{v}$，然后让约束算法（例如 SHAKE 或 RATTLE）通过将 $\\mathbf{v}^{\\prime}$ 投影回 $\\{\\mathbf{v} \\,|\\, \\mathbf{B}\\,\\mathbf{v} = \\mathbf{0}\\}$ 来修正任何漂移。**\n这正是问题中描述的导致问题的朴素方法。如果初始速度 $\\mathbf{v}$ 包含一个因数值漂移而违背约束的分量 $\\mathbf{v}_{\\mathrm{orth}}$，将其标定为 $\\lambda\\mathbf{v}$ 会产生一个新的违背分量 $\\lambda\\mathbf{v}_{\\mathrm{orth}}$。约束算法随后必须移除该分量，这会做功并导致能量不守恒。\n**结论：** 不正确。\n\n**B. 在标定之前，使用质量加权投影算符 $\\mathbf{P} = \\mathbf{I} - \\mathbf{M}^{-1}\\mathbf{B}^{\\top}\\left(\\mathbf{B}\\,\\mathbf{M}^{-1}\\mathbf{B}^{\\top}\\right)^{-1}\\mathbf{B}$ 将 $\\mathbf{v}$ 投影到约束流形的切空间上，得到 $\\mathbf{v}_{\\mathrm{tan}} = \\mathbf{P}\\,\\mathbf{v}$。仅对切向分量进行标定：$\\mathbf{v}^{\\prime} = \\lambda\\,\\mathbf{v}_{\\mathrm{tan}} + \\left(\\mathbf{I}-\\mathbf{P}\\right)\\mathbf{v}$，并在必要时将约束重新施加至机器精度。**\n该选项与推导出的正确方法完全匹配。它正确地识别了质量加权投影算符 $\\mathbf{P}$，将速度矢量分解为切向（$\\mathbf{P}\\mathbf{v}$）和正交（$(\\mathbf{I}-\\mathbf{P})\\mathbf{v}$）分量，并且只对切向分量进行标定。这确保了控温器仅作用于无约束的自由度，从而防止了控温步骤本身对受约束模式做功。\n**结论：** 正确。\n\n**C. 通过计算 $\\mathbf{B}\\,\\mathbf{v}$ 来识别 $\\mathbf{v}$ 沿约束方向的分量，并仅对这些分量乘以 $\\lambda$ 进行标定，保持不受约束的分量不变，从而使约束违背被控温器抑制。**\n此方法与要求正好相反。“$\\mathbf{v}$ 沿约束方向的分量”指的是 $\\mathbf{v}_{\\mathrm{orth}}$。该选项建议标定违背约束的分量，而保持有效的热运动分量不变。这混淆了控温器（温度控制）和约束算法（几何强制）的角色，并且无法正确调节系统有效动能模式的温度。对于 $\\lambda  1$ 的情况，它会加剧对约束的违背。\n**结论：** 不正确。\n\n**D. 将所有参与约束的原子 $i$ 的速度设为零，即 $\\mathbf{v}_{i} = \\mathbf{0}$，并对剩余原子的速度乘以 $\\lambda$ 进行标定，以达到目标温度，同时避免能量流入受约束的键。**\n这是一个物理上无效的方法。约束限制的是相对运动，而非所有运动。例如，一个刚性键合的双原子分子仍然可以平动和转动。将受约束原子的速度设为零会错误地停止它们的有效运动，从而破坏系统的动力学和热力学。\n**结论：** 不正确。\n\n**E. 选择一个质量加权的、针对特定原子的标定因子 $\\lambda_{i}$，使得较重的原子比较轻的原子标定得少，并应用 $\\mathbf{v}^{\\prime}_{i} = \\lambda_{i}\\,\\mathbf{v}_{i}$，其中 $\\lambda_{i}$ 的确定旨在保持总动能不变，但减少受约束坐标的涨落。**\n这个选项包含几个错误。首先，控温器的功能是改变而非保持动能。其次，使用非均匀的、针对特定原子的标定因子 $\\mathbf{v}'_i = \\lambda_i \\mathbf{v}_i$ 而不考虑约束的几何结构（即雅可比矩阵 $\\mathbf{B}$），通常会引入或放大约束违背。对于原子 $i$ 和 $j$ 之间的一个键约束，如果用不同的因子 $\\lambda_i \\neq \\lambda_j$ 来标定它们的速度，会改变其相对速度，很可能违背约束条件。所提出的临时质量加权方案没有解决所述问题的严格依据。\n**结论：** 不正确。", "answer": "$$\\boxed{B}$$", "id": "3459691"}]}