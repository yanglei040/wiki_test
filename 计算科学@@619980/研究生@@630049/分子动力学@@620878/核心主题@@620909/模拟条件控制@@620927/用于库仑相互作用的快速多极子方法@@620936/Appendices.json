{"hands_on_practices": [{"introduction": "快速多极子方法（FMM）的核心思想是用一组多极矩来近似描述远离观察点的电荷簇所产生的电场。虽然我们通常直观地用笛卡尔坐标系中的单极矩（总电荷）、偶极矩和四极矩来理解电荷分布，但FMM算法在数学上更常使用球谐函数作为基组。本练习旨在通过从基本定义出发，推导笛卡尔坐标系下的多极矩，并建立它们与球谐多极矩系数之间的精确联系，从而巩固您对FMM数学基础的理解。[@problem_id:3411980]", "problem": "在一次使用快速多极子方法 (FMM) 处理库仑相互作用的分子动力学模拟中，考虑一个由 $N$ 个点电荷 $\\{q_{i}\\}_{i=1}^{N}$ 组成的电荷簇，其位置 $\\{\\mathbf{r}_{i}\\}_{i=1}^{N}$ 是相对于选定在原点 $\\mathbf{0}$ 的展开中心而言的。库仑核由 $1/|\\mathbf{R}-\\mathbf{r}|$ 给出，该电荷簇在场点 $\\mathbf{R}$ 处产生的电势为\n$$\n\\phi(\\mathbf{R}) \\;=\\; \\frac{1}{4\\pi \\epsilon_{0}} \\sum_{i=1}^{N} \\frac{q_{i}}{|\\mathbf{R}-\\mathbf{r}_{i}|}.\n$$\n假设球谐函数 $Y_{\\ell}^{m}(\\theta,\\varphi)$ 是带有 Condon–Shortley 相位的归一化正交复球谐函数，其归一化条件为 $\\int |Y_{\\ell}^{m}(\\theta,\\varphi)|^{2}\\, d\\Omega = 1$。定义实心球谐函数 $r^{\\ell} Y_{\\ell}^{m}(\\theta,\\varphi)$，并使用标准的拉普拉斯展开来表示 $1/|\\mathbf{R}-\\mathbf{r}|$（其中 $|\\mathbf{R}|$ 大于电荷簇半径）。\n\n从 $\\phi(\\mathbf{R})$ 的基本定义、球谐函数的正交归一性以及库仑核的性质出发，推导该电荷簇直至四极矩阶的笛卡尔坐标系多极矩：\n- 总（单极）电荷 $Q = \\sum_{i=1}^{N} q_{i}$，\n- 偶极矩矢量 $\\mathbf{p} = \\sum_{i=1}^{N} q_{i} \\mathbf{r}_{i}$，\n- 无迹笛卡尔四极矩张量 $Q_{ab} = \\sum_{i=1}^{N} q_{i} \\left( 3 x_{i}^{(a)} x_{i}^{(b)} - r_{i}^{2} \\delta_{ab} \\right)$，其中 $x_{i}^{(a)}$ 是 $\\mathbf{r}_{i}$ 的第 $a$ 个笛卡尔分量 ($a,b \\in \\{x,y,z\\}$)，$r_{i} = |\\mathbf{r}_{i}|$，$\\delta_{ab}$ 是克罗内克 δ 符号。\n\n然后，将这些笛卡尔矩与电势的球谐函数展开式中出现的球谐多极矩系数 $M_{\\ell}^{m}$（对于 $\\ell = 0, 1, 2$）联系起来。请用 $\\{q_{i}, \\mathbf{r}_{i}\\}$ 给出 $M_{\\ell}^{m}$ 的显式表达式，并在可能的情况下用笛卡尔量 $Q$、$\\mathbf{p}$ 和 $Q_{ab}$ 来表示它们。最后，用笛卡尔四极矩张量分量给出球谐四极矩系数 $M_{2}^{0}$ 的闭合形式表达式。将最终答案表示为单个解析表达式。无需进行数值计算。", "solution": "我们从点电荷簇产生的电势开始，\n$$\n\\phi(\\mathbf{R}) \\;=\\; \\frac{1}{4\\pi \\epsilon_{0}} \\sum_{i=1}^{N} \\frac{q_{i}}{|\\mathbf{R}-\\mathbf{r}_{i}|}.\n$$\n对于包含该电荷簇的球面以外的场点 $\\mathbf{R}$，库仑核可以进行球谐函数（拉普拉斯）展开，\n$$\n\\frac{1}{|\\mathbf{R}-\\mathbf{r}|} \\;=\\; \\sum_{\\ell=0}^{\\infty} \\sum_{m=-\\ell}^{\\ell} \\frac{4\\pi}{2\\ell+1} \\frac{r^{\\ell}}{R^{\\ell+1}} Y_{\\ell}^{m}(\\Omega_{\\mathbf{R}}) Y_{\\ell}^{-m}(\\Omega_{\\mathbf{r}}),\n$$\n其中 $\\Omega_{\\mathbf{r}}$ 和 $\\Omega_{\\mathbf{R}}$ 分别表示 $\\mathbf{r}$ 和 $\\mathbf{R}$ 的角坐标，$Y_{\\ell}^{m}$ 是遵循 Condon–Shortley 相位约定的归一化正交复球谐函数。将此展开式代入电势表达式中可得\n$$\n\\phi(\\mathbf{R}) \\;=\\; \\frac{1}{4\\pi \\epsilon_{0}} \\sum_{i=1}^{N} q_{i} \\sum_{\\ell=0}^{\\infty} \\sum_{m=-\\ell}^{\\ell} \\frac{4\\pi}{2\\ell+1} \\frac{r_{i}^{\\ell}}{R^{\\ell+1}} Y_{\\ell}^{m}(\\Omega_{\\mathbf{R}}) Y_{\\ell}^{-m}(\\Omega_{\\mathbf{r}_{i}}).\n$$\n交换求和顺序并定义球谐多极矩系数\n$$\nM_{\\ell}^{m} \\;=\\; \\sum_{i=1}^{N} q_{i} \\, r_{i}^{\\ell} \\, Y_{\\ell}^{-m}(\\Omega_{\\mathbf{r}_{i}}),\n$$\n我们得到\n$$\n\\phi(\\mathbf{R}) \\;=\\; \\frac{1}{4\\pi \\epsilon_{0}} \\sum_{\\ell=0}^{\\infty} \\sum_{m=-\\ell}^{\\ell} \\frac{4\\pi}{2\\ell+1} \\frac{M_{\\ell}^{m}}{R^{\\ell+1}} \\, Y_{\\ell}^{m}(\\Omega_{\\mathbf{R}}).\n$$\n因此，任务简化为将 $\\ell=0,1,2$ 时的 $M_{\\ell}^{m}$ 与笛卡尔多极矩联系起来。\n\n我们采用以下笛卡尔多极矩定义：\n- 单极矩（总电荷）：\n$$\nQ \\;=\\; \\sum_{i=1}^{N} q_{i}.\n$$\n- 偶极矩：\n$$\n\\mathbf{p} \\;=\\; \\sum_{i=1}^{N} q_{i} \\, \\mathbf{r}_{i} \\;=\\; \\left( \\sum_{i=1}^{N} q_{i} x_{i}, \\; \\sum_{i=1}^{N} q_{i} y_{i}, \\; \\sum_{i=1}^{N} q_{i} z_{i} \\right).\n$$\n- 无迹四极矩张量：\n$$\nQ_{ab} \\;=\\; \\sum_{i=1}^{N} q_{i} \\left( 3 x_{i}^{(a)} x_{i}^{(b)} - r_{i}^{2} \\delta_{ab} \\right), \\quad r_{i}^{2} \\;=\\; x_{i}^{2} + y_{i}^{2} + z_{i}^{2}.\n$$\n现在我们通过使用 $Y_{\\ell}^{m}$ 在笛卡尔坐标系下的显式形式，将这些矩与 $M_{\\ell}^{m}$ 联系起来。（归一化正交的）复球谐函数对于低阶满足以下熟知的关系：\n- 对于 $\\ell=0$：\n$$\nY_{0}^{0}(\\theta,\\varphi) \\;=\\; \\frac{1}{\\sqrt{4\\pi}}.\n$$\n因此，\n$$\nM_{0}^{0} \\;=\\; \\sum_{i=1}^{N} q_{i} \\, r_{i}^{0} \\, Y_{0}^{0}(\\Omega_{\\mathbf{r}_{i}}) \\;=\\; \\frac{1}{\\sqrt{4\\pi}} \\sum_{i=1}^{N} q_{i} \\;=\\; \\frac{Q}{\\sqrt{4\\pi}}.\n$$\n\n- 对于 $\\ell=1$，球谐函数为\n$$\nY_{1}^{0}(\\theta,\\varphi) \\;=\\; \\sqrt{\\frac{3}{4\\pi}} \\cos\\theta \\;=\\; \\sqrt{\\frac{3}{4\\pi}} \\frac{z}{r}, \n$$\n$$\nY_{1}^{\\pm 1}(\\theta,\\varphi) \\;=\\; \\mp \\sqrt{\\frac{3}{8\\pi}} \\sin\\theta \\, \\exp(\\pm i \\varphi) \\;=\\; \\mp \\sqrt{\\frac{3}{8\\pi}} \\frac{x \\pm i y}{r}.\n$$\n因此，\n$$\nM_{1}^{0} \\;=\\; \\sum_{i=1}^{N} q_{i} r_{i} Y_{1}^{0}(\\Omega_{\\mathbf{r}_{i}}) \\;=\\; \\sqrt{\\frac{3}{4\\pi}} \\sum_{i=1}^{N} q_{i} z_{i} \\;=\\; \\sqrt{\\frac{3}{4\\pi}} \\, p_{z},\n$$\n以及\n$$\nM_{1}^{1} \\;=\\; \\sum_{i=1}^{N} q_{i} r_{i} Y_{1}^{-1}(\\Omega_{\\mathbf{r}_{i}}) \\;=\\; \\sqrt{\\frac{3}{8\\pi}} \\sum_{i=1}^{N} q_{i} (x_{i} - i y_{i}) \\;=\\; \\sqrt{\\frac{3}{8\\pi}} \\left( p_{x} - i p_{y} \\right),\n$$\n$$\nM_{1}^{-1} \\;=\\; \\sum_{i=1}^{N} q_{i} r_{i} Y_{1}^{1}(\\Omega_{\\mathbf{r}_{i}}) \\;=\\; -\\sqrt{\\frac{3}{8\\pi}} \\sum_{i=1}^{N} q_{i} (x_{i} + i y_{i}) \\;=\\; -\\sqrt{\\frac{3}{8\\pi}} \\left( p_{x} + i p_{y} \\right).\n$$\n\n- 对于 $\\ell=2$，相关的球谐函数为\n$$\nY_{2}^{0}(\\theta,\\varphi) \\;=\\; \\sqrt{\\frac{5}{16\\pi}} \\left( 3\\cos^{2}\\theta - 1 \\right) \\;=\\; \\sqrt{\\frac{5}{16\\pi}} \\frac{3 z^{2} - r^{2}}{r^{2}},\n$$\n$$\nY_{2}^{\\pm 1}(\\theta,\\varphi) \\;=\\; \\mp \\sqrt{\\frac{15}{8\\pi}} \\frac{z (x \\pm i y)}{r^{2}},\n$$\n$$\nY_{2}^{\\pm 2}(\\theta,\\varphi) \\;=\\; \\sqrt{\\frac{15}{32\\pi}} \\frac{(x \\pm i y)^{2}}{r^{2}}.\n$$\n使用这些表达式，可以得到\n$$\nM_{2}^{0} \\;=\\; \\sum_{i=1}^{N} q_{i} r_{i}^{2} Y_{2}^{0}(\\Omega_{\\mathbf{r}_{i}}) \\;=\\; \\sqrt{\\frac{5}{16\\pi}} \\sum_{i=1}^{N} q_{i} \\left( 3 z_{i}^{2} - r_{i}^{2} \\right).\n$$\n这可以用笛卡尔四极矩张量来表示。根据定义，\n$$\nQ_{zz} \\;=\\; \\sum_{i=1}^{N} q_{i} \\left( 3 z_{i}^{2} - r_{i}^{2} \\right),\n$$\n所以\n$$\nM_{2}^{0} \\;=\\; \\sqrt{\\frac{5}{16\\pi}} \\, Q_{zz}.\n$$\n为完整起见，其他的四极球谐系数也类似地与笛卡尔二阶矩相关：\n$$\nM_{2}^{\\pm 1} \\;=\\; \\sum_{i=1}^{N} q_{i} r_{i}^{2} Y_{2}^{\\mp 1}(\\Omega_{\\mathbf{r}_{i}}),\n$$\n$$\nM_{2}^{\\pm 2} \\;=\\; \\sum_{i=1}^{N} q_{i} r_{i}^{2} Y_{2}^{\\mp 2}(\\Omega_{\\mathbf{r}_{i}}).\n$$\n这些可以用笛卡尔四极矩分量（例如 $Q_{xz}$、$Q_{yz}$、$Q_{xx}-Q_{yy}$、$Q_{xy}$）的组合来表示，但题目特别要求给出 $M_{2}^{0}$ 的闭合形式表达式。因此，所求的关系式为\n$$\nM_{2}^{0} \\;=\\; \\sqrt{\\frac{5}{16\\pi}} \\, Q_{zz}.\n$$\n这就完成了直至四极矩阶的推导，并提供了从笛卡尔多极矩系数到球谐多极矩系数的显式映射，该映射与在快速多极子方法中用于库仑相互作用的归一化正交复球谐函数相一致。", "answer": "$$\\boxed{\\sqrt{\\frac{5}{16\\pi}}\\,Q_{zz}}$$", "id": "3411980"}, {"introduction": "理解了多极矩的表示后，下一步是在实际模拟中应用这些概念。在分子动力学模拟中，设置正确的参数以在计算精度和效率之间取得平衡至关重要。本练习将指导您推导如何选择近场截断半径 $r_c$ 和Verlet邻居列表的“表皮”厚度 $\\Delta$，以确保总力误差低于预设的容差 $\\epsilon$。通过这个练习，您将学习如何将FMM的理论截断误差界与实际算法参数联系起来，这是配置高效且准确模拟的关键一步。[@problem_id:3411978]", "problem": "考虑一个三维分子动力学系统，其中的点电荷通过库仑势相互作用，并使用快速多极子方法（FMM）来加速长程相互作用。设粒子的数密度为 $\\,\\rho\\,$（假定均匀），并假设每个粒子的电荷量大小以 $\\,|q_i| \\le q_{\\max}\\,$ 为界。库仑常数为 $\\,k_e = \\frac{1}{4\\pi \\varepsilon_0}\\,$。FMM 针对拉普拉斯核进行配置，其截断阶数为 $\\,p \\in \\mathbb{N}\\,$，对于良好分离的团簇相互作用，源-目标接受参数为 $\\,\\eta \\in (0,1)\\,$。在 FMM 层级结构的最细层上，每个源团簇由一个半径为 $\\,a\\,$ 的球体表示，该球体包含的源的总电荷量大小以 $\\,Q_{\\text{cell}} \\le \\rho q_{\\max} \\frac{4}{3}\\pi a^3\\,$ 为界。对于分离距离至多为截断距离 $\\,r_c\\,$ 的近场相互作用，执行直接、精确的对计算，而远场相互作用由 FMM 处理。\n\n邻居列表使用厚度为 $\\,\\Delta\\,$ 的韦尔莱“皮层”构建：在列表构建时，任何分离距离至多为 $\\,r_c + \\Delta\\,$ 的粒子对都将被记录。邻居列表每 $\\,M\\,$ 步重建一次，每步时长为 $\\,h\\,$，且所有粒子的速度以 $\\,v_{\\max}\\,$ 为界。在两次邻居列表重建之间，任何分离距离变为至多 $\\,r_c\\,$ 的粒子对都必须已包含在前一次重建的列表中，以避免近场遗漏。\n\n从以下基础依据和经过充分检验的事实出发：\n\n- 两个点电荷之间的库仑力大小为 $\\,F(r) = k_e \\frac{|q_i q_j|}{r^2}\\,$.\n- 对于拉普拉斯核，对于包含在半径为 $\\,a\\,$ 的球体内的源，在目标距离 $\\,r > a\\,$ 处，截断多极展开余项容许一个形式为\n$$\nE_{\\text{FMM}}(r) \\le k_e \\frac{Q_{\\text{cell}}}{r^2}\\,\\frac{(p+1)\\,(a/r)^{p+1}}{1 - a/r}\n$$\n的力误差界，这是多极展开余项的几何级数界和一次径向微分的标准推论。\n- 一个带有“皮层” $\\,\\Delta\\,$ 且每 $\\,M h\\,$ 重建一次的邻居列表，如果 $\\,\\Delta \\ge 2 v_{\\max} M h\\,$，则保证没有近场遗漏。\n\n假设近场区域是围绕每个目标的半径为 $\\,r_c\\,$ 的球，而远场区域是其补集。推导关于 $\\,r_c\\,$ 和 $\\,\\Delta\\,$ 选择的条件，以保证在邻居列表重建之间的任何时刻，任何粒子上的总力误差都以目标容差 $\\,\\epsilon > 0\\,$ 为上界。具体而言：\n\n1. 通过在远场区域上对上述单个团簇的余项界进行积分，推导粒子上远场 FMM 截斷误差的一个上界。在此過程中，使用均匀密度近似和接受参数 $\\,\\eta\\,$ 来界定 $\\,\\frac{1}{1 - a/r}\\,$。利用此上界，给出一个关于 $\\,r_c\\,$ 的充分条件，以确保远场对力误差的贡献至多为 $\\,\\epsilon\\,$。\n2. 推导保证邻居列表重建之间没有近场遗漏的最小 $\\,\\Delta\\,$。\n\n将您关于 $\\,r_c\\,$ 和 $\\,\\Delta\\,$ 的最终公式用 $\\,\\epsilon\\,$, $\\,p\\,$, $\\,\\eta\\,$, $\\,a\\,$, $\\,\\rho\\,$, $\\,q_{\\max}\\,$, $\\,k_e\\,$, $\\,v_{\\max}\\,$, $\\,M\\,$ 和 $\\,h\\,$ 明确表示。您的最终答案必须是关于对偶 $\\,\\big(r_c, \\Delta\\big)\\,$ 的单个解析表达式。无需进行数值计算。将 $\\,r_c\\,$ 和 $\\,\\Delta\\,$ 的单位表示为米。无需四舍五入。", "solution": "首先根据指定标准对问题进行验证。\n\n### 问题验证\n\n**步骤1：提取给定条件**\n\n-   系统：三维分子动力学系统，包含点电荷。\n-   相互作用：库仑势，$F(r) = k_e \\frac{|q_i q_j|}{r^2}$。\n-   长程方法：用于拉普拉斯核的快速多极子方法（FMM）。\n-   粒子数密度：$\\rho$（均匀）。\n-   电荷界限：$|q_i| \\le q_{\\max}$。\n-   库仑常数：$k_e = \\frac{1}{4\\pi \\varepsilon_0}$。\n-   FMM 截断阶数：$p \\in \\mathbb{N}$。\n-   FMM 接受参数：$\\eta \\in (0,1)$。\n-   FMM 源团簇表示：半径为 $a$ 的球体。\n-   最细层单元中的电荷：$Q_{\\text{cell}} \\le \\rho q_{\\max} \\frac{4}{3}\\pi a^3$。\n-   近场截断距离：$r_c$。分离距离 $\\le r_c$ 的相互作用被直接计算。\n-   远场区域：分离距离 $> r_c$。\n-   邻居列表“皮层”：$\\Delta$。\n-   邻居列表重建频率：每 $M$ 步。\n-   时间步长：$h$。\n-   最大粒子速度：$v_{\\max}$。\n-   邻居列表条件：在重建时记录分离距离至多为 $r_c + \\Delta$ 的粒子对。\n-   FMM 力误差界（给定事实）：对于距离 $r > a$ 的单个半径为 $a$ 的源团簇，其误差 $E_{\\text{FMM}}$ 的界为\n    $$ E_{\\text{FMM}}(r) \\le k_e \\frac{Q_{\\text{cell}}}{r^2}\\,\\frac{(p+1)\\,(a/r)^{p+1}}{1 - a/r} $$\n-   邻居列表有效性条件（给定事实）：$\\Delta \\ge 2 v_{\\max} M h$。\n-   目标总力误差容差：$\\epsilon > 0$。\n\n**步骤2：使用提取的给定条件进行验证**\n\n-   **科学上成立：** 该问题描述了快速多极子方法和邻居列表在分子动力学中的标准应用，这两者都是计算科学中的成熟技术。所提供的 FMM 误差界是从拉普拉斯方程的多极展开理论推导出的标准结果。关于韦尔莱“皮层”厚度的条件也是分子模拟中的一个经典结果。该问题牢固地建立在物理学和数值分析的既定原则之上。\n-   **良态性：** 该问题提供了推导所要求的关于 $r_c$ 和 $\\Delta$ 的条件所需的所有必要参数和关系。目标陈述清晰，并期望得到一个唯一的解析解。\n-   **客观性：** 问题以精确、定量的术语陈述，不含主觀語言或意見。\n\n**步骤3：结论与行动**\n\n该问题是有效的。它科学上合理、良态、客观且自洽。将按要求推导解答。\n\n### 条件的推导\n\n目标是找到近场截斷半径 $r_c$ 和邻居列表“皮层”厚度 $\\Delta$ 的表达式，它们共同确保任何粒子上的总力误差都以容差 $\\epsilon$ 为界。问题指明，对于远场，FMM 截断误差是唯一考虑的误差源。\n\n**1. 关于近场截断半径 $r_c$ 的条件**\n\n来自远场的总力误差 $E_{\\text{total, far}}$ 必须小于或等于总容差 $\\epsilon$。我们被要求通过在整个远场区域（即与目标粒子的距离 $r$ 大于 $r_c$ 的空间）上对给定的单个团簇误差界进行积分，来推导该误差的一个上界。\n\n在距离 $r$ 处的单个源团簇的给定误差界为：\n$$ E_{\\text{FMM}}(r) \\le k_e \\frac{Q_{\\text{cell}}}{r^2}\\,\\frac{(p+1)\\,(a/r)^{p+1}}{1 - a/r} $$\n我们被指示进行几次替换以创建一个可处理的积分。\n\n首先，我们使用给定的均匀密度近似来界定源单元中的总电荷：\n$$ Q_{\\text{cell}} \\le \\rho q_{\\max} \\frac{4}{3}\\pi a^3 $$\n其次，我们使用接受参数 $\\eta$ 来界定分母。多极展开的使用对于良好分离的团簇是有效的。在 FMM 的背景下，这意味着源团簇大小与距离之比很小。我们假设条件 $a/r \\le \\eta$ 对所有远场相互作用（即距离 $r \\ge r_c$）都成立。这意味着我们必须有 $a/r_c \\le \\eta$。在此条件下，$1 - a/r \\ge 1 - \\eta$，因此：\n$$ \\frac{1}{1 - a/r} \\le \\frac{1}{1 - \\eta} $$\n将这些界限代入单个团簇的误差表达式，得到：\n$$ E_{\\text{FMM}}(r) \\le k_e \\frac{\\rho q_{\\max} \\frac{4}{3}\\pi a^3}{r^2} \\frac{(p+1)(a/r)^{p+1}}{1 - \\eta} $$\n为了找到总误差，我们在远场区域 $r \\in [r_c, \\infty)$ 上对此界进行积分。我们将源团簇的分布建模为一个连续体。半径为 $r$、厚度为 $dr$ 的球壳中的源团簇数量 $dN_{clusters}$ 是球壳的体积 $4\\pi r^2 dr$ 除以单个球形团簇的体积 $\\frac{4}{3}\\pi a^3$。\n$$ dN_{clusters} = \\frac{4\\pi r^2 dr}{\\frac{4}{3}\\pi a^3} = \\frac{3r^2}{a^3} dr $$\n总远场误差 $E_{\\text{total, far}}$ 的上界是单个团簇误差界乘以团簇数密度的积分。假设在最坏情况下，所有误差矢量都相长叠加，我们对误差的大小进行积分：\n$$ E_{\\text{total, far}} \\le \\int_{r_c}^{\\infty} \\left( k_e \\frac{\\rho q_{\\max} \\frac{4}{3}\\pi a^3}{r^2} \\frac{(p+1)a^{p+1}r^{-(p+1)}}{1 - \\eta} \\right) \\left( \\frac{3r^2}{a^3} \\right) dr $$\n简化积分内的项：\n$$ E_{\\text{total, far}} \\le \\int_{r_c}^{\\infty} k_e (\\rho q_{\\max} 4\\pi) \\frac{p+1}{1 - \\eta} a^{p+1} r^{-(p+1)} dr $$\n我们可以将常数项移出积分：\n$$ E_{\\text{total, far}} \\le \\frac{4\\pi k_e \\rho q_{\\max} (p+1) a^{p+1}}{1 - \\eta} \\int_{r_c}^{\\infty} r^{-(p+1)} dr $$\n该积分的计算结果为：\n$$ \\int_{r_c}^{\\infty} r^{-(p+1)} dr = \\left[ \\frac{r^{-p}}{-p} \\right]_{r_c}^{\\infty} = 0 - \\left( \\frac{r_c^{-p}}{-p} \\right) = \\frac{1}{p r_c^p} $$\n这里我们使用了 $p \\in \\mathbb{N}$，因此 $p \\ge 1$ 这一事实。\n将此结果代回，得到总远场误差的上界：\n$$ E_{\\text{total, far}} \\le \\frac{4\\pi k_e \\rho q_{\\max} (p+1) a^{p+1}}{1 - \\eta} \\frac{1}{p r_c^p} $$\n为确保误差在容差 $\\epsilon$ 之内，我们施加条件 $E_{\\text{total, far}} \\le \\epsilon$：\n$$ \\frac{4\\pi k_e \\rho q_{\\max} a^{p+1} (p+1)}{p (1 - \\eta) r_c^p} \\le \\epsilon $$\n对此不等式求解 $r_c$ 即可得到充分条件。满足此条件的 $r_c$ 的最小值为：\n$$ r_c^p \\ge \\frac{4\\pi k_e \\rho q_{\\max} a^{p+1} (p+1)}{\\epsilon p (1 - \\eta)} $$\n$$ r_c = \\left( \\frac{4\\pi k_e \\rho q_{\\max} a^{p+1} (p+1)}{\\epsilon p (1 - \\eta)} \\right)^{1/p} $$\n\n**2. 关于邻居列表“皮层” $\\Delta$ 的条件**\n\n邻居列表的设计目的是包含在两次连续的列表重建之間可能進入近場範圍（$r \\le r_c$）的所有粒子對。两次重建之间的时间为 $T = M h$。\n考虑两个粒子。在时间间隔 $T$ 内，每个粒子可以行进的最大距离为 $v_{\\max} T$。它们之间分离距离的最大减少量发生在它们直接朝向对方移动时，在这种情况下，它们的分离距离最多可以减少 $2 v_{\\max} T$。\n为了保证任何最终分离距离 $r(t_0+T) \\le r_c$ 的粒子对都已包含在时刻 $t_0$ 构建的邻居列表中，它们的初始分离距离 $r(t_0)$ 必须小于或等于邻居列表的截断距离 $r_c + \\Delta$。\n初始和最终分离距离之间的关系是 $r(t_0) \\le r(t_0+T) + 2 v_{\\max} T$。\n为确保最终分离距离为 $r_c$ 的粒子对被捕捉到，我们需要包含那些初始分离距离至多为 $r_c + 2 v_{\\max} T$ 的粒子对。因此，邻居列表的截断距离必须至少这么大：\n$$ r_c + \\Delta \\ge r_c + 2 v_{\\max} T $$\n$$ \\Delta \\ge 2 v_{\\max} T = 2 v_{\\max} M h $$\n问题要求的是保证没有遗漏的最小 $\\Delta$。这对应于等式：\n$$ \\Delta = 2 v_{\\max} M h $$\n这个条件在问题陈述本身中已作为“经过充分检验的事实”给出，因此这部分的推導是直接应用该事实来找到最小值。\n\n结合这些结果，便确定了 $r_c$ 和 $\\Delta$ 的条件。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\left( \\frac{4\\pi k_e \\rho q_{\\max} a^{p+1} (p+1)}{\\epsilon p (1 - \\eta)} \\right)^{1/p}  2 v_{\\max} M h\n\\end{pmatrix}\n}\n$$", "id": "3411978"}, {"introduction": "在配置并运行了模拟之后，一个关键的后续步骤是评估其计算结果的准确性。本练习将向您介绍量化数值误差的标准方法，特别是 $L_2$ 范数（均方根误差）和 $L_\\infty$ 范数（最大误差）。通过处理一组假设的FMM计算数据，您将亲手计算电势和力的近似误差，并学会如何区分和解读不同误差来源（如近场与远场）的贡献。这项技能对于验证数值方法的可靠性和解释模拟结果至关重要。[@problem_id:3411988]", "problem": "考虑一个由 $M=4$ 个目标粒子组成的分子动力学系统，其中长程库仑相互作用通过快速多极方法（FMM）计算库仑势和力。位于位置 $\\mathbf{r}_i$ 的单个点电荷 $q$ 在 $\\mathbf{r}$ 处观测到的库仑势定义为 $\\phi(\\mathbf{r}) = \\frac{1}{4\\pi\\varepsilon_0}\\frac{q}{|\\mathbf{r}-\\mathbf{r}_i|}$，其对单位测试电荷产生的相应力为 $\\mathbf{F}(\\mathbf{r}) = -\\nabla \\phi(\\mathbf{r})$。在多体环境中，精确的势和力是所有源的总和，而 FMM 通过分离近场相互作用（在截断半径内直接计算）和远场相互作用（通过多极展开近似）来提供近似值。\n\n给定以下在 $M=4$ 个目标上的离散数据（以无量纲简化单位表示）。精确的势值为\n$$\nV^{\\mathrm{exact}} = \\big( \\, 1.000 \\,,\\, 0.500 \\,,\\, 0.250 \\,,\\, 0.125 \\, \\big),\n$$\nFMM 近似的势值为\n$$\nV^{\\mathrm{FMM}} = \\big( \\, 0.970 \\,,\\, 0.515 \\,,\\, 0.260 \\,,\\, 0.100 \\, \\big).\n$$\n势近似误差分解为近场和远场贡献，满足 $\\Delta V^{\\mathrm{near}} + \\Delta V^{\\mathrm{far}} = V^{\\mathrm{FMM}} - V^{\\mathrm{exact}}$，其中\n$$\n\\Delta V^{\\mathrm{near}} = \\big( \\, -0.020 \\,,\\, 0.010 \\,,\\, 0.004 \\,,\\, -0.020 \\, \\big), \\quad\n\\Delta V^{\\mathrm{far}} = \\big( \\, -0.010 \\,,\\, 0.005 \\,,\\, 0.006 \\,,\\, -0.005 \\, \\big).\n$$\n精确的力模为\n$$\nF^{\\mathrm{exact}} = \\big( \\, 1.200 \\,,\\, 0.600 \\,,\\, 0.300 \\,,\\, 0.150 \\, \\big),\n$$\nFMM 近似的力模为\n$$\nF^{\\mathrm{FMM}} = \\big( \\, 1.260 \\,,\\, 0.580 \\,,\\, 0.320 \\,,\\, 0.120 \\, \\big).\n$$\n力近似误差分解为近场和远场贡献，满足 $\\Delta F^{\\mathrm{near}} + \\Delta F^{\\mathrm{far}} = F^{\\mathrm{FMM}} - F^{\\mathrm{exact}}$，其中\n$$\n\\Delta F^{\\mathrm{near}} = \\big( \\, 0.050 \\,,\\, -0.015 \\,,\\, 0.010 \\,,\\, -0.025 \\, \\big), \\quad\n\\Delta F^{\\mathrm{far}} = \\big( \\, 0.010 \\,,\\, -0.005 \\,,\\, 0.010 \\,,\\, -0.005 \\, \\big).\n$$\n\n从向量范数和相对误差的定义开始。对于任意离散值向量 $x = (x_1, x_2, \\dots, x_M)$ 及其近似值 $\\tilde{x} = (\\tilde{x}_1, \\tilde{x}_2, \\dots, \\tilde{x}_M)$，定义误差向量 $\\Delta x = \\tilde{x} - x$，无穷范数 $\\|x\\|_{\\infty} = \\max_{1 \\le i \\le M} |x_i|$，$L_2$范数 $\\|x\\|_{2} = \\big( \\sum_{i=1}^{M} x_i^2 \\big)^{1/2}$，以及相对误差范数\n$$\nE_{\\infty}^{x} = \\frac{\\|\\Delta x\\|_{\\infty}}{\\|x\\|_{\\infty}}, \n\\qquad\nE_{2}^{x} = \\frac{\\|\\Delta x\\|_{2}}{\\|x\\|_{2}}.\n$$\n对于分解后的误差 $\\Delta x = \\Delta x^{\\mathrm{near}} + \\Delta x^{\\mathrm{far}}$，定义特定贡献的相对误差\n$$\nE_{\\infty}^{x,\\mathrm{near}} = \\frac{\\|\\Delta x^{\\mathrm{near}}\\|_{\\infty}}{\\|x\\|_{\\infty}}, \\quad\nE_{\\infty}^{x,\\mathrm{far}} = \\frac{\\|\\Delta x^{\\mathrm{far}}\\|_{\\infty}}{\\|x\\|_{\\infty}}, \\quad\nE_{2}^{x,\\mathrm{near}} = \\frac{\\|\\Delta x^{\\mathrm{near}}\\|_{2}}{\\|x\\|_{2}}, \\quad\nE_{2}^{x,\\mathrm{far}} = \\frac{\\|\\Delta x^{\\mathrm{far}}\\|_{2}}{\\|x\\|_{2}}.\n$$\n\n任务：\n- 计算势近似的 $E_{\\infty}^{V}$ 和 $E_{2}^{V}$ 以及力模近似的 $E_{\\infty}^{F}$ 和 $E_{2}^{F}$。\n- 计算特定贡献的误差 $E_{\\infty}^{F,\\mathrm{near}}$ 和 $E_{2}^{V,\\mathrm{far}}$。\n- 定义一个灵敏度指数\n$$\nS \\equiv \\frac{E_{\\infty}^{F,\\mathrm{near}}}{E_{2}^{V,\\mathrm{far}}},\n$$\n它比较了力中的近场尖峰相对于势中的远场总误差如何影响最坏情况误差。将 $S$ 计算为一个无量纲数，并将答案四舍五入到四位有效数字。", "solution": "该问题要求计算快速多极方法（FMM）模拟中势和力近似的各种误差度量，最终计算出灵敏度指数 $S$。该过程涉及将所提供的向量范数和相对误差的定义直接应用于给定的数值数据。\n\n目标粒子的数量为 $M=4$。给定的数据向量如下：\n精确势： $V^{\\mathrm{exact}} = \\big( \\, 1.000 \\,,\\, 0.500 \\,,\\, 0.250 \\,,\\, 0.125 \\, \\big)$\nFMM 势： $V^{\\mathrm{FMM}} = \\big( \\, 0.970 \\,,\\, 0.515 \\,,\\, 0.260 \\,,\\, 0.100 \\, \\big)$\n近场势误差： $\\Delta V^{\\mathrm{near}} = \\big( \\, -0.020 \\,,\\, 0.010 \\,,\\, 0.004 \\,,\\, -0.020 \\, \\big)$\n远场势误差： $\\Delta V^{\\mathrm{far}} = \\big( \\, -0.010 \\,,\\, 0.005 \\,,\\, 0.006 \\,,\\, -0.005 \\, \\big)$\n精确力模： $F^{\\mathrm{exact}} = \\big( \\, 1.200 \\,,\\, 0.600 \\,,\\, 0.300 \\,,\\, 0.150 \\, \\big)$\nFMM 力模： $F^{\\mathrm{FMM}} = \\big( \\, 1.260 \\,,\\, 0.580 \\,,\\, 0.320 \\,,\\, 0.120 \\, \\big)$\n近场力误差： $\\Delta F^{\\mathrm{near}} = \\big( \\, 0.050 \\,,\\, -0.015 \\,,\\, 0.010 \\,,\\, -0.025 \\, \\big)$\n远场力误差： $\\Delta F^{\\mathrm{far}} = \\big( \\, 0.010 \\,,\\, -0.005 \\,,\\, 0.010 \\,,\\, -0.005 \\, \\big)$\n\n首先，我们计算总误差向量 $\\Delta V = V^{\\mathrm{FMM}} - V^{\\mathrm{exact}}$ 和 $\\Delta F = F^{\\mathrm{FMM}} - F^{\\mathrm{exact}}$。\n$$\n\\Delta V = \\big( \\, 0.970 - 1.000 \\,,\\, 0.515 - 0.500 \\,,\\, 0.260 - 0.250 \\,,\\, 0.100 - 0.125 \\, \\big) = \\big( \\, -0.030 \\,,\\, 0.015 \\,,\\, 0.010 \\,,\\, -0.025 \\, \\big)\n$$\n$$\n\\Delta F = \\big( \\, 1.260 - 1.200 \\,,\\, 0.580 - 0.600 \\,,\\, 0.320 - 0.300 \\,,\\, 0.120 - 0.150 \\, \\big) = \\big( \\, 0.060 \\,,\\, -0.020 \\,,\\, 0.020 \\,,\\, -0.030 \\, \\big)\n$$\n作为一致性检查，我们确认 $\\Delta V = \\Delta V^{\\mathrm{near}} + \\Delta V^{\\mathrm{far}}$ 和 $\\Delta F = \\Delta F^{\\mathrm{near}} + \\Delta F^{\\mathrm{far}}$，这对于给定数据是成立的。\n\n接下来，我们计算所需的向量范数。\n对于精确势向量 $V^{\\mathrm{exact}}$：\n$$\n\\|V^{\\mathrm{exact}}\\|_{\\infty} = \\max_{1 \\le i \\le 4} |V_i^{\\mathrm{exact}}| = \\max\\big( \\, |1.000| \\,,\\, |0.500| \\,,\\, |0.250| \\,,\\, |0.125| \\, \\big) = 1.000\n$$\n$$\n\\|V^{\\mathrm{exact}}\\|_{2} = \\sqrt{\\sum_{i=1}^{4} (V_i^{\\mathrm{exact}})^2} = \\sqrt{1.000^2 + 0.500^2 + 0.250^2 + 0.125^2} = \\sqrt{1.0 + 0.25 + 0.0625 + 0.015625} = \\sqrt{1.328125}\n$$\n对于势误差向量 $\\Delta V$：\n$$\n\\|\\Delta V\\|_{\\infty} = \\max\\big( \\, |-0.030| \\,,\\, |0.015| \\,,\\, |0.010| \\,,\\, |-0.025| \\, \\big) = 0.030\n$$\n$$\n\\|\\Delta V\\|_{2} = \\sqrt{(-0.030)^2 + 0.015^2 + 0.010^2 + (-0.025)^2} = \\sqrt{0.0009 + 0.000225 + 0.0001 + 0.000625} = \\sqrt{0.00185}\n$$\n对于精确力向量 $F^{\\mathrm{exact}}$：\n$$\n\\|F^{\\mathrm{exact}}\\|_{\\infty} = \\max\\big( \\, |1.200| \\,,\\, |0.600| \\,,\\, |0.300| \\,,\\, |0.150| \\, \\big) = 1.200\n$$\n$$\n\\|F^{\\mathrm{exact}}\\|_{2} = \\sqrt{1.200^2 + 0.600^2 + 0.300^2 + 0.150^2} = \\sqrt{1.44 + 0.36 + 0.09 + 0.0225} = \\sqrt{1.9125}\n$$\n对于力误差向量 $\\Delta F$：\n$$\n\\|\\Delta F\\|_{\\infty} = \\max\\big( \\, |0.060| \\,,\\, |-0.020| \\,,\\, |0.020| \\,,\\, |-0.030| \\, \\big) = 0.060\n$$\n$$\n\\|\\Delta F\\|_{2} = \\sqrt{0.060^2 + (-0.020)^2 + 0.020^2 + (-0.030)^2} = \\sqrt{0.0036 + 0.0004 + 0.0004 + 0.0009} = \\sqrt{0.0053}\n$$\n对于最终指数所需的特定误差分量：\n$$\n\\|\\Delta F^{\\mathrm{near}}\\|_{\\infty} = \\max\\big( \\, |0.050| \\,,\\, |-0.015| \\,,\\, |0.010| \\,,\\, |-0.025| \\, \\big) = 0.050\n$$\n$$\n\\|\\Delta V^{\\mathrm{far}}\\|_{2} = \\sqrt{(-0.010)^2 + 0.005^2 + 0.006^2 + (-0.005)^2} = \\sqrt{0.0001 + 0.000025 + 0.000036 + 0.000025} = \\sqrt{0.000186}\n$$\n现在我们根据问题中的定义计算相对误差。\n总相对势误差：\n$$\nE_{\\infty}^{V} = \\frac{\\|\\Delta V\\|_{\\infty}}{\\|V^{\\mathrm{exact}}\\|_{\\infty}} = \\frac{0.030}{1.000} = 0.030\n$$\n$$\nE_{2}^{V} = \\frac{\\|\\Delta V\\|_{2}}{\\|V^{\\mathrm{exact}}\\|_{2}} = \\frac{\\sqrt{0.00185}}{\\sqrt{1.328125}} \\approx 0.03728\n$$\n总相对力误差：\n$$\nE_{\\infty}^{F} = \\frac{\\|\\Delta F\\|_{\\infty}}{\\|F^{\\mathrm{exact}}\\|_{\\infty}} = \\frac{0.060}{1.200} = 0.050\n$$\n$$\nE_{2}^{F} = \\frac{\\|\\Delta F\\|_{2}}{\\|F^{\\mathrm{exact}}\\|_{2}} = \\frac{\\sqrt{0.0053}}{\\sqrt{1.9125}} \\approx 0.05267\n$$\n计算灵敏度指数所需的特定贡献相对误差：\n$$\nE_{\\infty}^{F,\\mathrm{near}} = \\frac{\\|\\Delta F^{\\mathrm{near}}\\|_{\\infty}}{\\|F^{\\mathrm{exact}}\\|_{\\infty}} = \\frac{0.050}{1.200} = \\frac{1}{24} \\approx 0.041667\n$$\n$$\nE_{2}^{V,\\mathrm{far}} = \\frac{\\|\\Delta V^{\\mathrm{far}}\\|_{2}}{\\|V^{\\mathrm{exact}}\\|_{2}} = \\frac{\\sqrt{0.000186}}{\\sqrt{1.328125}} \\approx 0.011834\n$$\n最后，我们使用 $E_{\\infty}^{F,\\mathrm{near}}$ 和 $E_{2}^{V,\\mathrm{far}}$ 的结果计算灵敏度指数 $S$。\n$$\nS \\equiv \\frac{E_{\\infty}^{F,\\mathrm{near}}}{E_{2}^{V,\\mathrm{far}}} = \\frac{\\|\\Delta F^{\\mathrm{near}}\\|_{\\infty} / \\|F^{\\mathrm{exact}}\\|_{\\infty}}{\\|\\Delta V^{\\mathrm{far}}\\|_{2} / \\|V^{\\mathrm{exact}}\\|_{2}} = \\frac{0.050 / 1.200}{\\sqrt{0.000186} / \\sqrt{1.328125}}\n$$\n代入中间值：\n$$\nS = \\frac{1/24}{\\sqrt{0.000186 / 1.328125}} \\approx \\frac{0.0416666...}{\\sqrt{0.000140045...}} \\approx \\frac{0.0416666...}{0.0118340...} \\approx 3.520884\n$$\n将结果四舍五入到四位有效数字，得到：\n$$\nS \\approx 3.521\n$$", "answer": "$$\\boxed{3.521}$$", "id": "3411988"}]}