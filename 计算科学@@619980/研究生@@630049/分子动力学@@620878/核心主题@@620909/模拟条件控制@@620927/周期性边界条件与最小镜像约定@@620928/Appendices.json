{"hands_on_practices": [{"introduction": "在分子动力学模拟中，周期性边界条件（PBC）最直接的应用是在正交晶胞中。这个练习将指导你亲手实现最小镜像约定（MIC）的核心算法，即对每个坐标分量独立进行包裹。通过这个实践 [@problem_id:3474216]，你将掌握在周期性系统中正确计算粒子间位移的基础，这是后续计算力和能量的关键第一步。", "problem": "考虑一个受周期性边界条件约束的正交晶系模拟单元。设沿三个笛卡尔坐标轴的盒子边长分别为 $L_x$、$L_y$ 和 $L_z$，两个粒子的位置向量分别为 $\\mathbf{r}_i = (r_{i,x}, r_{i,y}, r_{i,z})$ 和 $\\mathbf{r}_j = (r_{j,x}, r_{j,y}, r_{j,z})$。未包装位移为 $\\Delta \\mathbf{r} = \\mathbf{r}_j - \\mathbf{r}_i$，其分量为 $\\Delta r_\\alpha$，其中 $\\alpha \\in \\{x,y,z\\}$。在周期性边界条件下，位置向量在每个坐标轴上相差盒子长度的整数倍平移时是等效的。最小镜像约定要求为每个分量选择一个代表性位移，使其位于一个以零为中心、宽度等于盒子长度的半开区间内。\n\n从周期性边界条件的定义和整数平移下的等价类概念出发，推导出一个基于原理的逐分量变换。该变换对每个坐标轴 $\\alpha \\in \\{x,y,z\\}$ 选择一个整数 $n_\\alpha$，使得包装后的分量\n$$\n\\Delta r_\\alpha^{\\mathrm{MIC}} = \\Delta r_\\alpha - n_\\alpha L_\\alpha\n$$\n满足半开区间约束\n$$\n\\Delta r_\\alpha^{\\mathrm{MIC}} \\in \\left[-\\frac{L_\\alpha}{2}, \\frac{L_\\alpha}{2}\\right).\n$$\n解释您对 $n_\\alpha$ 的选择如何强制执行最小镜像约定和区间约束，包括处理 $\\Delta r_\\alpha$ 恰好在 $\\pm L_\\alpha/2$ 处或与零相差 $L_\\alpha$ 的整数倍等边界情况。\n\n实现一个完整的程序，该程序能够：\n- 对于一组给定的盒子长度和位置对 $(\\mathbf{r}_i,\\mathbf{r}_j)$，计算未包装位移 $\\Delta \\mathbf{r}$。\n- 应用推导出的逐分量最小镜像约定变换以获得 $\\Delta \\mathbf{r}^{\\mathrm{MIC}}$。\n- 对每个测试用例，验证所有三个分量都满足 $\\Delta r_\\alpha^{\\mathrm{MIC}} \\in \\left[-\\frac{L_\\alpha}{2}, \\frac{L_\\alpha}{2}\\right)$（其中 $\\alpha=x,y,z$），并考虑一个物理上合理的容差以处理浮点数舍入。\n\n所有量均以无量纲的约化单位给出；无需进行物理单位转换。本问题不涉及角度。\n\n使用以下测试套件，该套件旨在探测一般行为、大位移和平移以及边界条件：\n1. $L=(3.0,\\,4.0,\\,5.0)$, $\\mathbf{r}_i=(0.9,\\,-1.9,\\,2.4)$, $\\mathbf{r}_j=(1.1,\\,3.7,\\,-2.6)$.\n2. $L=(10.0,\\,8.0,\\,6.0)$, $\\mathbf{r}_i=(0.0,\\,0.0,\\,0.0)$, $\\mathbf{r}_j=(5.0,\\,-4.0,\\,3.0)$.\n3. $L=(7.0,\\,7.0,\\,7.0)$, $\\mathbf{r}_i=(0.0,\\,0.0,\\,0.0)$, $\\mathbf{r}_j=(24.4,\\,-17.4,\\,35.0)$.\n4. $L=(2.0,\\,3.0,\\,4.0)$, $\\mathbf{r}_i=(0.0,\\,0.0,\\,0.0)$, $\\mathbf{r}_j=(0.0,\\,1.49,\\,-2.01)$.\n5. $L=(5.0,\\,4.0,\\,10.0)$, $\\mathbf{r}_i=(0.0,\\,0.0,\\,0.0)$, $\\mathbf{r}_j=(12.5,\\,-6.0,\\,25.0)$.\n6. $L=(9.3,\\,4.7,\\,2.1)$, $\\mathbf{r}_i=(3.2,\\,-2.35,\\,1.05)$, $\\mathbf{r}_j=(-7.1,\\,5.05,\\,-4.25)$.\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素是一个布尔值，指示相应测试用例的包装位移是否对所有三个分量都满足所述的区间约束（例如，$[\\mathrm{True},\\mathrm{True},\\ldots]$）。", "solution": "该问题要求推导并实现一个逐分量变换，用于计算在周期性边界条件（PBC）下正交晶系模拟单元中两个粒子 $\\mathbf{r}_i$ 和 $\\mathbf{r}_j$ 之间的位移向量。此变换必须遵守最小镜像约定（MIC），该约定规定，得到的包装位移向量 $\\Delta \\mathbf{r}^{\\mathrm{MIC}}$ 对应于粒子 $j$ 与粒子 $i$ 的任何周期性镜像之间的最短距离。\n\n模拟单元由其沿笛卡尔坐标轴的边长 $L_x$、$L_y$ 和 $L_z$ 定义。在周期性边界条件下，位于位置 $\\mathbf{r}$ 的粒子等效于位于 $\\mathbf{r} + n_x L_x \\hat{\\mathbf{x}} + n_y L_y \\hat{\\mathbf{y}} + n_z L_z \\hat{\\mathbf{z}}$ 的无限个镜像粒子集合，其中 $n_x、n_y、n_z$ 为任意整数。\n\n未包装位移向量由 $\\Delta \\mathbf{r} = \\mathbf{r}_j - \\mathbf{r}_i$ 给出。包装位移向量 $\\Delta \\mathbf{r}^{\\mathrm{MIC}}$ 是通过选择粒子 $i$ 的一个特定周期性镜像，使得其与粒子 $j$ 的距离最小化而得到的。对于正交晶系单元，这种最小化可以对每个笛卡尔分量独立进行。\n\n对于每个分量 $\\alpha \\in \\{x,y,z\\}$，我们寻找一个整数 $n_\\alpha$，使得包装后的位移分量，\n$$\n\\Delta r_\\alpha^{\\mathrm{MIC}} = \\Delta r_\\alpha - n_\\alpha L_\\alpha\n$$\n位于以零为中心的指定半开区间内：\n$$\n\\Delta r_\\alpha^{\\mathrm{MIC}} \\in \\left[-\\frac{L_\\alpha}{2}, \\frac{L_\\alpha}{2}\\right)\n$$\n通过将 $\\Delta r_\\alpha^{\\mathrm{MIC}}$ 的定义代入区间约束，我们得到关于 $n_\\alpha$ 的一个不等式：\n$$\n-\\frac{L_\\alpha}{2} \\le \\Delta r_\\alpha - n_\\alpha L_\\alpha  \\frac{L_\\alpha}{2}\n$$\n我们可以解这个关于 $n_\\alpha$ 的复合不等式。首先，我们考虑左边部分：\n$$\n-\\frac{L_\\alpha}{2} \\le \\Delta r_\\alpha - n_\\alpha L_\\alpha\n$$\n$$\nn_\\alpha L_\\alpha \\le \\Delta r_\\alpha + \\frac{L_\\alpha}{2}\n$$\n两边同除以 $L_\\alpha$（恒为正），我们得到：\n$$\nn_\\alpha \\le \\frac{\\Delta r_\\alpha}{L_\\alpha} + \\frac{1}{2}\n$$\n接下来，我们考虑右边部分：\n$$\n\\Delta r_\\alpha - n_\\alpha L_\\alpha  \\frac{L_\\alpha}{2}\n$$\n$$\n\\Delta r_\\alpha - \\frac{L_\\alpha}{2}  n_\\alpha L_\\alpha\n$$\n两边同除以 $L_\\alpha$ 得到：\n$$\n\\frac{\\Delta r_\\alpha}{L_\\alpha} - \\frac{1}{2}  n_\\alpha\n$$\n结合这两个结果，我们发现整数 $n_\\alpha$ 必须满足：\n$$\n\\frac{\\Delta r_\\alpha}{L_\\alpha} - \\frac{1}{2}  n_\\alpha \\le \\frac{\\Delta r_\\alpha}{L_\\alpha} + \\frac{1}{2}\n$$\n这个关于 $n_\\alpha$ 的区间宽度恰好为 $1$，即 $\\left(\\frac{\\Delta r_\\alpha}{L_\\alpha} + \\frac{1}{2}\\right) - \\left(\\frac{\\Delta r_\\alpha}{L_\\alpha} - \\frac{1}{2}\\right) = 1$。因此，对于 $\\frac{\\Delta r_\\alpha}{L_\\alpha}$ 的任何值，都存在一个唯一的整数 $n_\\alpha$ 满足此条件。这个唯一的整数可以通过将量 $\\frac{\\Delta r_\\alpha}{L_\\alpha}$ 四舍五入到最近的整数来找到。\n\n必须仔细选择具体的舍入规则，以遵循目标区间 $\\left[-\\frac{L_\\alpha}{2}, \\frac{L_\\alpha}{2}\\right)$ 的半开性质。让我们分析边界情况，即 $\\frac{\\Delta r_\\alpha}{L_\\alpha}$ 恰好位于两个整数中间，例如，对于某个整数 $k$，有 $\\frac{\\Delta r_\\alpha}{L_\\alpha} = k + \\frac{1}{2}$。我们关于 $n_\\alpha$ 的不等式变为：\n$$\n(k + \\frac{1}{2}) - \\frac{1}{2}  n_\\alpha \\le (k + \\frac{1}{2}) + \\frac{1}{2}\n$$\n$$\nk  n_\\alpha \\le k + 1\n$$\n唯一的整数解是 $n_\\alpha = k+1$。这意味着形式为 $k + \\frac{1}{2}$ 的值必须向上舍入到下一个整数 $k+1$。这种舍入行为（半值向上舍入）可以通过向下取整函数（floor function）实现：\n$$\nn_\\alpha = \\left\\lfloor \\frac{\\Delta r_\\alpha}{L_\\alpha} + \\frac{1}{2} \\right\\rfloor\n$$\n该公式正确地确定了要减去的盒子长度的整数倍。例如，如果 $\\Delta r_\\alpha = \\frac{L_\\alpha}{2}$，那么 $\\frac{\\Delta r_\\alpha}{L_\\alpha} = \\frac{1}{2}$。我们的公式给出 $n_\\alpha = \\lfloor \\frac{1}{2} + \\frac{1}{2} \\rfloor = \\lfloor 1 \\rfloor = 1$。得到的包装分量是 $\\Delta r_\\alpha^{\\mathrm{MIC}} = \\frac{L_\\alpha}{2} - 1 \\cdot L_\\alpha = -\\frac{L_\\alpha}{2}$，它正确地落在区间的包含性下界上。如果 $\\Delta r_\\alpha$ 略小于 $\\frac{L_\\alpha}{2}$，比如说 $\\frac{L_\\alpha}{2} - \\epsilon$，那么 $\\frac{\\Delta r_\\alpha}{L_\\alpha} = \\frac{1}{2} - \\frac{\\epsilon}{L_\\alpha}$。该公式给出 $n_\\alpha = \\lfloor (\\frac{1}{2} - \\frac{\\epsilon}{L_\\alpha}) + \\frac{1}{2} \\rfloor = \\lfloor 1 - \\frac{\\epsilon}{L_\\alpha} \\rfloor = 0$。包装分量是 $\\Delta r_\\alpha^{\\mathrm{MIC}} = (\\frac{L_\\alpha}{2} - \\epsilon) - 0 = \\frac{L_\\alpha}{2} - \\epsilon$，它正确地位于区间内部。这表明所推导的 $n_\\alpha$ 选择正确地强制执行了最小镜像约定和半开区间约束。\n\n实现过程将首先计算未包装的位移分量 $\\Delta r_\\alpha$。然后，对每个分量，计算对应的整数 $n_\\alpha = \\lfloor \\frac{\\Delta r_\\alpha}{L_\\alpha} + 0.5 \\rfloor$。最后，计算包装位移 $\\Delta r_\\alpha^{\\mathrm{MIC}} = \\Delta r_\\alpha - n_\\alpha L_\\alpha$。验证步骤会检查是否对所有三个分量都满足 $-L_\\alpha/2 \\le \\Delta r_\\alpha^{\\mathrm{MIC}}  L_\\alpha/2$，并使用一个小的数值容差来处理浮点数的不精确性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the periodic boundary condition problem for a given set of test cases.\n    It derives and applies the minimum image convention transformation and verifies\n    that the resulting wrapped displacement vectors fall within the specified\n    half-open interval.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (L, r_i, r_j)\n        (np.array([3.0, 4.0, 5.0]), np.array([0.9, -1.9, 2.4]), np.array([1.1, 3.7, -2.6])),\n        (np.array([10.0, 8.0, 6.0]), np.array([0.0, 0.0, 0.0]), np.array([5.0, -4.0, 3.0])),\n        (np.array([7.0, 7.0, 7.0]), np.array([0.0, 0.0, 0.0]), np.array([24.4, -17.4, 35.0])),\n        (np.array([2.0, 3.0, 4.0]), np.array([0.0, 0.0, 0.0]), np.array([0.0, 1.49, -2.01])),\n        (np.array([5.0, 4.0, 10.0]), np.array([0.0, 0.0, 0.0]), np.array([12.5, -6.0, 25.0])),\n        (np.array([9.3, 4.7, 2.1]), np.array([3.2, -2.35, 1.05]), np.array([-7.1, 5.05, -4.25])),\n    ]\n\n    results = []\n    # A small tolerance for floating-point comparisons.\n    epsilon = 1e-9\n\n    for L, r_i, r_j in test_cases:\n        # Step 1: Compute the unwrapped displacement vector.\n        delta_r = r_j - r_i\n\n        # Step 2: Apply the derived componentwise minimum image convention (MIC) transformation.\n        # The integer n_alpha is chosen such that the wrapped displacement satisfies\n        # delta_r_mic_alpha is in [-L_alpha/2, L_alpha/2).\n        # This is achieved by n = floor(delta_r / L + 0.5)\n        \n        # In NumPy, this is equivalent to np.floor(delta_r / L + 0.5).\n        n_vector = np.floor(delta_r / L + 0.5)\n        \n        delta_r_mic = delta_r - n_vector * L\n\n        # Step 3: Verify that the wrapped displacement components satisfy the interval constraint.\n        # The condition is -L/2 = delta_r_mic  L/2.\n        half_L = L / 2.0\n\n        # Check lower bound: delta_r_mic >= -half_L\n        # With tolerance: delta_r_mic - (-half_L) >= -epsilon\n        lower_bound_check = (delta_r_mic + half_L) >= -epsilon\n\n        # Check upper bound: delta_r_mic  half_L\n        # With tolerance: half_L - delta_r_mic > epsilon\n        upper_bound_check = (half_L - delta_r_mic) > epsilon\n\n        # The result is True only if all components satisfy both constraints.\n        is_valid = np.all(lower_bound_check) and np.all(upper_bound_check)\n        results.append(is_valid)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3474216"}, {"introduction": "掌握了最小镜像约定的基本实现后，理解其物理重要性至关重要。这个练习 [@problem_id:3474194] 构建了一个思想实验，让你量化一个忽略周期性边界的朴素邻居搜索算法所引入的误差。通过亲手计算被遗漏的势能和相互作用力，你将对周期性边界条件和最小镜像约定为何是精确模拟物理性质的基石有一个具体而深刻的认识。", "problem": "考虑一个边长为 $L$ 的三维立方模拟单元，具有周期性边界条件 (PBC)。中心对相互作用由 Lennard-Jones $12$-$6$ 势建模，在球形截断半径 $r_c$ 处截断（但未移动）：势能定义为 $U(r) = 4 \\epsilon \\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^6\\right]$（当 $r \\leq r_c$）和 $U(r) = 0$（当 $r  r_c$），其中 $r$ 是粒子间距，$\\epsilon$ 是能量尺度，$\\sigma$ 是特征长度。\n\n一种忽略 PBC 的朴素邻居搜索算法使用存储在主单元中的位置之间的直接欧几里得距离，而不是最小镜像约定 (MIC)。设两个粒子放置在位置 $\\mathbf{r}_1 = (\\delta, 0, 0)$ 和 $\\mathbf{r}_2 = (L - \\delta, 0, 0)$，其中 $0  \\delta  \\frac{L}{4}$。朴素搜索将主单元内的间距 $|x_2 - x_1|$ 与 $r_c$ 进行比较，而物理上正确的 MIC 距离则比较最小镜像间距。\n\n- 证明这种构型是一个反例，说明忽略 PBC 可能会漏掉一个根据 MIC 应该被包括的近邻对。仅使用 PBC 和最小镜像约定的定义，确定朴素邻居搜索排除该粒子对而 MIC 邻居搜索包含该粒子对时，$(\\delta, r_c, L)$ 必须满足的充分必要条件。\n- 在该条件下，计算对势能的缺失贡献以及粒子 $1$ 在 $x$ 轴上受到的缺失作用力。通过中心力关系表达力，并注意符号，使用粒子 $i$ 因粒子 $j$ 而受到的力的常规定义 $\\mathbf{F}_i = - \\nabla_i U(r)$。\n- 以 $\\epsilon$ 为单位报告缺失的势能，以 $\\epsilon / \\sigma$ 为单位报告 $x$ 轴上的缺失力分量。将最终答案以包含这两个无量纲量的单行矩阵形式给出。不需要数值，也无需四舍五入。", "solution": "对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n-   **系统**：三维立方模拟单元，边长 $L$。\n-   **边界条件**：周期性边界条件 (PBC)。\n-   **势**：Lennard-Jones 12-6 势，$U(r) = 4 \\epsilon \\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^6\\right]$ (当 $r \\leq r_c$)。\n-   **截断**：$U(r) = 0$ (当 $r > r_c$)。\n-   **粒子位置**：$\\mathbf{r}_1 = (\\delta, 0, 0)$ 和 $\\mathbf{r}_2 = (L - \\delta, 0, 0)$。\n-   **约束**：$0  \\delta  \\frac{L}{4}$。\n-   **朴素搜索**：使用主单元内的直接欧几里得距离。\n-   **正确搜索**：使用最小镜像约定 (MIC)。\n-   **力的定义**：粒子 $i$ 因粒子 $j$ 受到的力为 $\\mathbf{F}_i = - \\nabla_i U(r)$。\n-   **目标**：\n    1.  找出朴素搜索失败（排除粒子对）而 MIC 搜索成功（包含粒子对）时，$(\\delta, r_c, L)$ 需满足的充分必要条件。\n    2.  在此条件下，计算缺失的对势能。\n    3.  在此条件下，计算粒子 $1$ 在 $x$ 轴上受到的缺失作用力。\n    4.  以 $\\epsilon$ 为单位报告缺失的能量，以 $\\epsilon / \\sigma$ 为单位报告缺失的作用力。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学依据**：该问题在计算材料科学和分子模拟的原理上有充分的依据。Lennard-Jones 势、周期性边界条件、最小镜像约定和势截断都是该领域的标准和基本概念。\n-   **适定性**：该问题是适定的。粒子位置、势函数形式和搜索方法都已明确定义。目标清晰，可以推导出唯一的解析解。约束条件 $0  \\delta  L/4$ 对于确保 MIC 计算的明确性和最小镜像矢量的良好定义至关重要。\n-   **客观性**：语言精确、技术性强，没有主观或含糊不清的陈述。\n\n### 步骤 3：结论与行动\n该问题是**有效的**。这是一个计算物理学中的标准、适定的问题，旨在检验对 PBC 和 MIC 的理解。将提供完整解答。\n\n### 解答\n\n本题在一个具有周期性边界条件 (PBC) 的立方单元中，针对一个特定的双粒子构型，对比了朴素邻居搜索与使用最小镜像约定 (MIC) 的物理正确搜索。\n\n首先，我们确定朴素搜索失败而 MIC 搜索成功的条件。\n\n朴素邻居搜索根据主模拟单元中给出的坐标计算间距。从粒子 $1$ 到粒子 $2$ 的间距矢量为 $\\mathbf{r}_{12}^{\\text{naive}} = \\mathbf{r}_2 - \\mathbf{r}_1$。\n分量为：\n$x$ 分量：$(L - \\delta) - \\delta = L - 2\\delta$\n$y$ 分量：$0 - 0 = 0$\n$z$ 分量：$0 - 0 = 0$\n朴素间距是该矢量的模：\n$$r^{\\text{naive}} = |L - 2\\delta|$$\n给定约束条件 $0  \\delta  \\frac{L}{4}$，我们有 $0  2\\delta  \\frac{L}{2}$，这意味着 $L - 2\\delta > \\frac{L}{2} > 0$。因此，$r^{\\text{naive}} = L - 2\\delta$。\n如果粒子对的间距大于截断半径 $r_c$，朴素搜索会将其排除。排除的条件是：\n$$L - 2\\delta > r_c$$\n\n物理上正确的搜索使用最小镜像约定。对于边长为 $L$ 的立方盒子，每个维度的距离分量 $d_\\alpha = r_{2, \\alpha} - r_{1, \\alpha}$ 被替换为 $d'_\\alpha = d_\\alpha - L \\cdot \\lfloor \\frac{d_\\alpha}{L} + \\frac{1}{2} \\rfloor$，其中 $\\lfloor \\cdot \\rfloor$ 是向下取整函数（等同于四舍五入到最近的整数）。\n对于 $x$ 分量，$d_x = L - 2\\delta$。校正项涉及 $\\lfloor \\frac{L-2\\delta}{L} + \\frac{1}{2} \\rfloor = \\lfloor 1 - \\frac{2\\delta}{L} + \\frac{1}{2} \\rfloor = \\lfloor \\frac{3}{2} - \\frac{2\\delta}{L} \\rfloor$。\n由 $0  \\delta  \\frac{L}{4}$ 可得 $0  \\frac{2\\delta}{L}  \\frac{1}{2}$。因此，$1  \\frac{3}{2} - \\frac{2\\delta}{L}  \\frac{3}{2}$。该量的向下取整值为 $1$。\n$x$ 方向的最小镜像间距矢量分量是 $d'_x = (L-2\\delta) - L \\cdot 1 = -2\\delta$。\n其他分量不变：$d'_y = 0$ 和 $d'_z = 0$。\n最小镜像间距矢量为 $\\mathbf{r}_{12}^{\\text{MIC}} = (-2\\delta, 0, 0)$。MIC 距离是其模：\n$$r^{\\text{MIC}} = \\sqrt{(-2\\delta)^2 + 0^2 + 0^2} = 2\\delta$$\n如果粒子对的间距小于或等于截断半径，MIC 搜索会将其包含在内。包含的条件是：\n$$2\\delta \\le r_c$$\n要使朴素搜索失败而 MIC 搜索成功，两个条件必须同时成立。因此，充分必要条件是：\n$$2\\delta \\le r_c  L - 2\\delta$$\n\n接下来，我们计算缺失的势能。朴素搜索错误地将该粒子对的能量赋为 $0$。正确的势能是使用 MIC 距离 $r = r^{\\text{MIC}} = 2\\delta$ 计算的。由于此距离在截断半径内，能量非零。\n缺失的势能是：\n$$U_{\\text{missed}} = U(r=2\\delta) = 4 \\epsilon \\left[ \\left(\\frac{\\sigma}{2\\delta}\\right)^{12} - \\left(\\frac{\\sigma}{2\\delta}\\right)^6 \\right]$$\n以 $\\epsilon$ 为单位，即为：\n$$\\frac{U_{\\text{missed}}}{\\epsilon} = 4 \\left[ \\frac{\\sigma^{12}}{(2\\delta)^{12}} - \\frac{\\sigma^6}{(2\\delta)^6} \\right] = 4 \\left[ \\frac{\\sigma^{12}}{4096\\delta^{12}} - \\frac{\\sigma^6}{64\\delta^6} \\right] = \\frac{\\sigma^{12}}{1024\\delta^{12}} - \\frac{\\sigma^6}{16\\delta^6}$$\n\n最后，我们计算粒子 $1$ 在 $x$ 轴上受到的缺失作用力。粒子 $1$ 受到的力是 $\\mathbf{F}_1 = - \\nabla_1 U(r_{12})$，其中 $r_{12}$ 是 MIC 距离。\n力的 $x$ 分量是 $F_{1,x} = -\\frac{\\partial}{\\partial x_1} U(r_{12})$。使用链式法则，$F_{1,x} = -\\frac{dU}{dr} \\frac{\\partial r}{\\partial x_1}$。\nMIC 距离 $r$ 是粒子 $1$ 坐标和粒子 $2$ 最近镜像坐标的函数。粒子 $1$ 的位置是 $(x_1, y_1, z_1) = (\\delta, 0, 0)$。粒子 $2$ 的最近镜像位置在 $(x_2-L, y_2, z_2) = (L-\\delta-L, 0, 0) = (-\\delta, 0, 0)$。\n所以，$r = \\sqrt{(x_1 - (-\\delta))^2 + (y_1-0)^2 + (z_1-0)^2} = \\sqrt{(x_1+\\delta)^2}$。由于 $x_1=\\delta>0$，这给出 $r = x_1+\\delta$。\n偏导数为 $\\frac{\\partial r}{\\partial x_1} = 1$。\n因此，对于这个特定的几何构型，$F_{1,x} = -\\frac{dU}{dr}$。\n我们来计算势的导数：\n$$U(r) = 4\\epsilon (\\sigma^{12}r^{-12} - \\sigma^6 r^{-6})$$\n$$\\frac{dU}{dr} = 4\\epsilon (-12\\sigma^{12}r^{-13} + 6\\sigma^6 r^{-7}) = 24\\epsilon \\left( \\frac{\\sigma^6}{r^7} - 2\\frac{\\sigma^{12}}{r^{13}} \\right)$$\n力分量是：\n$$F_{1,x} = -\\frac{dU}{dr} = -24\\epsilon \\left( \\frac{\\sigma^6}{r^7} - 2\\frac{\\sigma^{12}}{r^{13}} \\right) = 24\\epsilon \\left( 2\\frac{\\sigma^{12}}{r^{13}} - \\frac{\\sigma^6}{r^7} \\right)$$\n我们在 MIC 距离 $r = 2\\delta$ 处计算该值：\n$$F_{1,x} = 24\\epsilon \\left( 2\\frac{\\sigma^{12}}{(2\\delta)^{13}} - \\frac{\\sigma^6}{(2\\delta)^{7}} \\right) = 24\\epsilon \\left( \\frac{2\\sigma^{12}}{8192\\delta^{13}} - \\frac{\\sigma^6}{128\\delta^7} \\right)$$\n$$F_{1,x} = 24\\epsilon \\left( \\frac{\\sigma^{12}}{4096\\delta^{13}} - \\frac{\\sigma^6}{128\\delta^7} \\right) = \\epsilon \\left( \\frac{24\\sigma^{12}}{4096\\delta^{13}} - \\frac{24\\sigma^6}{128\\delta^7} \\right)$$\n化简分数：$\\frac{24}{4096} = \\frac{3}{512}$ 和 $\\frac{24}{128} = \\frac{3}{16}$。\n$$F_{1,x} = \\epsilon \\left( \\frac{3\\sigma^{12}}{512\\delta^{13}} - \\frac{3\\sigma^6}{16\\delta^7} \\right)$$\n问题要求以 $\\epsilon / \\sigma$ 为单位表示该力分量。\n$$\\frac{F_{1,x}}{\\epsilon/\\sigma} = \\frac{F_{1,x}\\sigma}{\\epsilon} = \\sigma \\left( \\frac{3\\sigma^{12}}{512\\delta^{13}} - \\frac{3\\sigma^6}{16\\delta^7} \\right) = \\frac{3\\sigma^{13}}{512\\delta^{13}} - \\frac{3\\sigma^7}{16\\delta^7}$$\n这也可以写作 $3 \\left[ \\frac{1}{512}\\left(\\frac{\\sigma}{\\delta}\\right)^{13} - \\frac{1}{16}\\left(\\frac{\\sigma}{\\delta}\\right)^7 \\right]$。\n\n这两个无量纲量是缺失的势能和缺失的力分量：\n1.  能量：$\\frac{\\sigma^{12}}{1024\\delta^{12}} - \\frac{\\sigma^6}{16\\delta^6}$\n2.  力：$\\frac{3\\sigma^{13}}{512\\delta^{13}} - \\frac{3\\sigma^7}{16\\delta^7}$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{\\sigma^{12}}{1024\\delta^{12}} - \\frac{\\sigma^{6}}{16\\delta^{6}}  \\frac{3\\sigma^{13}}{512\\delta^{13}} - \\frac{3\\sigma^{7}}{16\\delta^{7}}\n\\end{pmatrix}\n}\n$$", "id": "3474194"}, {"introduction": "尽管分量包裹算法在正交晶胞中行之有效，但它在倾斜的、非正交的三斜晶胞中会失效。这个练习 [@problem_id:3435070] 揭示了这种失效，并引导你运用分数坐标和度规张量来解决这个问题，这代表了处理任意晶胞形状的通用方法。完成这个例子将帮助你理解在更复杂的模拟环境中保证计算准确性的鲁棒性技术。", "problem": "一个分子动力学模拟在歪斜的三斜晶胞中采用周期性边界条件（PBC）。设布拉菲晶格由晶格矢量 $\\mathbf{a}_1$、$\\mathbf{a}_2$ 和 $\\mathbf{a}_3$ 生成，这些矢量作为列组成了晶胞矩阵 $\\mathbf{H}$。位于笛卡尔坐标位置 $\\mathbf{r}_i$ 和 $\\mathbf{r}_j$ 的两个粒子通过最小镜像约定（MIC）相互作用，根据定义，该约定在所有晶格镜像中选择最短的欧几里得分离矢量。在歪斜晶胞中，笛卡尔坐标系下朴素的逐分量包裹方法可能无法确定真实的最小镜像。\n\n考虑由以下矢量定义的歪斜晶胞：\n$$\n\\mathbf{a}_1 = \\begin{pmatrix} 10 \\\\ 0 \\\\ 0 \\end{pmatrix},\\quad\n\\mathbf{a}_2 = \\begin{pmatrix} 4 \\\\ 8 \\\\ 0 \\end{pmatrix},\\quad\n\\mathbf{a}_3 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 10 \\end{pmatrix},\n$$\n因此 $\\mathbf{H} = \\begin{pmatrix} 10  4  0 \\\\ 0  8  0 \\\\ 0  0  10 \\end{pmatrix}$。设两个粒子的位置（笛卡尔坐标，单位为埃）为\n$$\n\\mathbf{r}_i = \\begin{pmatrix} 4.5 \\\\ 7.5 \\\\ 1.0 \\end{pmatrix},\\qquad\n\\mathbf{r}_j = \\begin{pmatrix} 0.5 \\\\ 1.0 \\\\ 1.5 \\end{pmatrix}.\n$$\n\n1. 使用朴素的逐分量包裹方法，将盒子视为边长为 $L_x = 10$、$L_y = 8$ 和 $L_z = 10$ 的正交盒子（即，将 $\\mathbf{r}_j - \\mathbf{r}_i$ 的每个笛卡尔分量独立地包裹到 $(-L_\\alpha/2, L_\\alpha/2]$ 区间内，其中 $\\alpha \\in \\{x,y,z\\}$），计算得到的包裹后的分离矢量及其欧几里得范数。简要解释为什么此过程在歪斜晶胞中会失败。\n\n2. 从 PBC 和 MIC 的第一性原理出发，即镜像是通过整数晶格平移得到的，且最小镜像距离为\n$$\n\\min_{\\mathbf{n}\\in\\mathbb{Z}^3} \\left\\| \\left(\\mathbf{r}_j - \\mathbf{r}_i\\right) + \\mathbf{H}\\,\\mathbf{n} \\right\\|_2,\n$$\n推导并应用基于度规张量的方法：通过 $\\left(\\mathbf{r}_j - \\mathbf{r}_i\\right) = \\mathbf{H}\\,\\mathbf{s}$ 引入分数坐标 $\\mathbf{s}$，将距离平方表示为包含度规张量 $\\mathbf{G} = \\mathbf{H}^{\\mathsf{T}}\\mathbf{H}$ 的二次型，并确定使 $\\|\\mathbf{H}(\\mathbf{s}+\\mathbf{m})\\|_2$ 最小化的整数矢量 $\\mathbf{m}\\in\\mathbb{Z}^3$。明确计算校正后的最小镜像分离矢量及其欧几里得范数。\n\n只报告校正后的最小镜像距离的大小。将答案四舍五入到四位有效数字。以埃为单位表示最终距离。", "solution": "该问题要求计算歪斜三斜晶胞中两个粒子之间的最小镜像距离。在进行求解之前，有必要对问题陈述进行验证。\n\n### 问题验证\n\n**第一步：提取已知条件**\n- 晶胞晶格矢量：\n$$\n\\mathbf{a}_1 = \\begin{pmatrix} 10 \\\\ 0 \\\\ 0 \\end{pmatrix},\\quad\n\\mathbf{a}_2 = \\begin{pmatrix} 4 \\\\ 8 \\\\ 0 \\end{pmatrix},\\quad\n\\mathbf{a}_3 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 10 \\end{pmatrix}\n$$\n- 晶胞矩阵 $\\mathbf{H}$：\n$$\n\\mathbf{H} = \\begin{pmatrix} 10  4  0 \\\\ 0  8  0 \\\\ 0  0  10 \\end{pmatrix}\n$$\n- 粒子笛卡尔坐标位置（单位为埃）：\n$$\n\\mathbf{r}_i = \\begin{pmatrix} 4.5 \\\\ 7.5 \\\\ 1.0 \\end{pmatrix},\\quad\n\\mathbf{r}_j = \\begin{pmatrix} 0.5 \\\\ 1.0 \\\\ 1.5 \\end{pmatrix}\n$$\n- 朴素逐分量包裹的定义：使用 $L_x = 10$，$L_y = 8$，$L_z = 10$，将 $\\mathbf{r}_j - \\mathbf{r}_i$ 的每个笛卡尔分量包裹到 $(-L_\\alpha/2, L_\\alpha/2]$ 区间内，其中 $\\alpha \\in \\{x,y,z\\}$。\n- 最小镜像约定（MIC）的定义：在所有整数矢量 $\\mathbf{n}\\in\\mathbb{Z}^3$ 中，找到 $\\| (\\mathbf{r}_j - \\mathbf{r}_i) + \\mathbf{H}\\,\\mathbf{n} \\|_2$ 的最小值。\n- 正确方法的步骤：使用分数坐标 $\\mathbf{s}$，其中 $(\\mathbf{r}_j - \\mathbf{r}_i) = \\mathbf{H}\\,\\mathbf{s}$，将距离平方与度规张量 $\\mathbf{G} = \\mathbf{H}^{\\mathsf{T}}\\mathbf{H}$ 关联，并找到使 $\\|\\mathbf{H}(\\mathbf{s}+\\mathbf{m})\\|_2$ 最小化的整数矢量 $\\mathbf{m}$。\n\n**第二步：使用提取的已知条件进行验证**\n- **科学依据：** 该问题牢固地基于分子动力学模拟的标准和基本原理，特别是在非正交（三斜）模拟晶胞中周期性边界条件（PBC）和最小镜像约定（MIC）的实现。分数坐标和度规张量的使用是固态物理学和计算材料科学中的标准技术。\n- **适定性：** 所有必要的数据（晶格矢量、粒子位置）都已提供。目标明确陈述：计算最小镜像距离，并将朴素方法与正确方法进行对比。最小镜像距离的存在性和唯一性得到保证。\n- **客观性：** 该问题以精确、形式化的数学和物理语言陈述，没有歧义或主观论断。\n\n**第三步：结论与行动**\n该问题是有效的。现在将提供完整的解答。\n\n### 解答\n\n该问题要求计算两个粒子之间的最小镜像距离，首先考虑一种朴素方法，然后是针对歪斜晶胞的正确、严谨的方法。\n\n笛卡尔坐标系中的原始分离矢量是：\n$$\n\\mathbf{r}_{ij} = \\mathbf{r}_j - \\mathbf{r}_i = \\begin{pmatrix} 0.5 - 4.5 \\\\ 1.0 - 7.5 \\\\ 1.5 - 1.0 \\end{pmatrix} = \\begin{pmatrix} -4.0 \\\\ -6.5 \\\\ 0.5 \\end{pmatrix}\n$$\n单位为埃。\n\n**1. 朴素的逐分量包裹**\n\n该方法错误地将歪斜晶胞视为边长等于 $\\mathbf{H}$ 对角线元素 $L_x=10$、$L_y=8$ 和 $L_z=10$ 的正交盒子。每个分量 $\\Delta r_\\alpha$ 的包裹操作为 $\\Delta r_{\\alpha}' = \\Delta r_\\alpha - L_\\alpha \\cdot \\text{round}(\\Delta r_\\alpha / L_\\alpha)$。\n\n- $x$分量: $\\Delta r_x' = -4.0 - 10 \\cdot \\text{round}(-4.0/10) = -4.0 - 10 \\cdot 0 = -4.0$。\n- $y$分量: $\\Delta r_y' = -6.5 - 8 \\cdot \\text{round}(-6.5/8) = -6.5 - 8 \\cdot (-1) = 1.5$。\n- $z$分量: $\\Delta r_z' = 0.5 - 10 \\cdot \\text{round}(0.5/10) = 0.5 - 10 \\cdot 0 = 0.5$。\n\n朴素分离矢量为 $\\Delta\\mathbf{r}_{\\text{naive}} = \\begin{pmatrix} -4.0 \\\\ 1.5 \\\\ 0.5 \\end{pmatrix}$。其范数的平方为 $(-4.0)^2 + (1.5)^2 + (0.5)^2 = 16 + 2.25 + 0.25 = 18.5$。距离为 $\\sqrt{18.5} \\approx 4.301$ Å。\n\n这个过程是不正确的，因为它忽略了晶胞矩阵 $\\mathbf{H}$ 的非对角元素，在此例中为 $H_{12}=4$。它假设晶格矢量是正交的，但事实并非如此，因为 $\\mathbf{a}_1 \\cdot \\mathbf{a}_2 = 40 \\neq 0$。应用PBC需要通过真实晶格矢量 $\\mathbf{a}_1, \\mathbf{a}_2, \\mathbf{a}_3$ 的整数倍组合进行平移，而不是通过与笛卡尔轴对齐的矢量进行平移。\n\n**2. 正确的基于度规张量的方法**\n\nMIC在于找到一个整数矢量 $\\mathbf{m} \\in \\mathbb{Z}^3$，使得矢量 $\\Delta\\mathbf{r}_{\\text{min}} = \\mathbf{r}_{ij} + \\mathbf{H}\\mathbf{m}$ 具有最小可能的欧几里得范数。\n\n为解决此问题，我们将问题转换到分数坐标空间 $\\mathbf{s}$ 中。笛卡尔分离矢量 $\\mathbf{r}_{ij}$ 通过 $\\mathbf{r}_{ij} = \\mathbf{H}\\mathbf{s}$ 与其分数坐标对应物 $\\mathbf{s}$ 相关联。因此，$\\mathbf{s} = \\mathbf{H}^{-1}\\mathbf{r}_{ij}$。\n\n首先，我们必须计算晶胞矩阵 $\\mathbf{H}$ 的逆矩阵：\n$$\n\\mathbf{H} = \\begin{pmatrix} 10  4  0 \\\\ 0  8  0 \\\\ 0  0  10 \\end{pmatrix}\n$$\n对于上三角矩阵，其逆矩阵也是上三角矩阵。我们求解 $\\mathbf{H}\\mathbf{s} = \\mathbf{r}_{ij}$：\n$10s_1 + 4s_2 = r_{ij,x}$\n$8s_2 = r_{ij,y}$\n$10s_3 = r_{ij,z}$\n求解 $\\mathbf{s}$（用 $\\mathbf{r}_{ij}$ 表示）可得：\n$s_3 = r_{ij,z}/10$\n$s_2 = r_{ij,y}/8$\n$s_1 = (r_{ij,x} - 4s_2)/10 = r_{ij,x}/10 - 4/10 \\cdot r_{ij,y}/8 = r_{ij,x}/10 - r_{ij,y}/20$。\n这对应于逆矩阵：\n$$\n\\mathbf{H}^{-1} = \\begin{pmatrix} 1/10  -1/20  0 \\\\ 0  1/8  0 \\\\ 0  0  1/10 \\end{pmatrix} = \\begin{pmatrix} 0.1  -0.05  0 \\\\ 0  0.125  0 \\\\ 0  0  0.1 \\end{pmatrix}\n$$\n现在，我们计算分数分离矢量 $\\mathbf{s}$：\n$$\n\\mathbf{s} = \\mathbf{H}^{-1}\\mathbf{r}_{ij} = \\begin{pmatrix} 0.1  -0.05  0 \\\\ 0  0.125  0 \\\\ 0  0  0.1 \\end{pmatrix} \\begin{pmatrix} -4.0 \\\\ -6.5 \\\\ 0.5 \\end{pmatrix} = \\begin{pmatrix} 0.1(-4.0) - 0.05(-6.5) \\\\ 0.125(-6.5) \\\\ 0.1(0.5) \\end{pmatrix} = \\begin{pmatrix} -0.4 + 0.325 \\\\ -0.8125 \\\\ 0.05 \\end{pmatrix} = \\begin{pmatrix} -0.075 \\\\ -0.8125 \\\\ 0.05 \\end{pmatrix}\n$$\n需要最小化的矢量是 $\\Delta \\mathbf{r} = \\mathbf{H}(\\mathbf{s} + \\mathbf{m})$。距离的平方是 $d^2 = \\|\\Delta \\mathbf{r}\\|^2 = \\Delta \\mathbf{r}^{\\mathsf{T}}\\Delta \\mathbf{r} = (\\mathbf{s}+\\mathbf{m})^{\\mathsf{T}}\\mathbf{H}^{\\mathsf{T}}\\mathbf{H}(\\mathbf{s}+\\mathbf{m}) = (\\mathbf{s}+\\mathbf{m})^{\\mathsf{T}}\\mathbf{G}(\\mathbf{s}+\\mathbf{m})$，其中 $\\mathbf{G} = \\mathbf{H}^{\\mathsf{T}}\\mathbf{H}$ 是度规张量。选择矢量 $\\mathbf{m}$ 是为了将 $\\mathbf{s}+\\mathbf{m}$ 的分量移入中心镜像，通常定义在区间 $[-0.5, 0.5]$ 内。这可以通过将整数矢量 $\\mathbf{m}$ 的每个分量 $m_k$ 设置为对应分量 $s_k$ 的最近整数的负值来实现：\n$$\nm_k = -\\text{round}(s_k)\n$$\n对于我们的分数矢量 $\\mathbf{s}$：\n- $m_1 = -\\text{round}(-0.075) = -0 = 0$\n- $m_2 = -\\text{round}(-0.8125) = -(-1) = 1$\n- $m_3 = -\\text{round}(0.05) = -0 = 0$\n因此，用于平移的整数矢量为 $\\mathbf{m} = \\begin{pmatrix} 0  1  0 \\end{pmatrix}^{\\mathsf{T}}$。\n\n包裹后的分数矢量 $\\mathbf{s}' = \\mathbf{s} + \\mathbf{m}$ 是：\n$$\n\\mathbf{s}' = \\begin{pmatrix} -0.075 \\\\ -0.8125 \\\\ 0.05 \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -0.075 \\\\ 0.1875 \\\\ 0.05 \\end{pmatrix}\n$$\n最后，我们将这个最小镜像分数矢量转换回笛卡尔坐标，以获得最小镜像分离矢量 $\\Delta\\mathbf{r}_{\\text{min}}$：\n$$\n\\Delta\\mathbf{r}_{\\text{min}} = \\mathbf{H}\\mathbf{s}' = \\begin{pmatrix} 10  4  0 \\\\ 0  8  0 \\\\ 0  0  10 \\end{pmatrix} \\begin{pmatrix} -0.075 \\\\ 0.1875 \\\\ 0.05 \\end{pmatrix} = \\begin{pmatrix} 10(-0.075) + 4(0.1875) \\\\ 8(0.1875) \\\\ 10(0.05) \\end{pmatrix} = \\begin{pmatrix} -0.75 + 0.75 \\\\ 1.5 \\\\ 0.5 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1.5 \\\\ 0.5 \\end{pmatrix}\n$$\n校正后的最小镜像距离是该矢量的欧几里得范数：\n$$\nd_{\\text{min}} = \\|\\Delta\\mathbf{r}_{\\text{min}}\\|_2 = \\sqrt{0^2 + (1.5)^2 + (0.5)^2} = \\sqrt{0 + 2.25 + 0.25} = \\sqrt{2.5}\n$$\n数值为 $d_{\\text{min}} \\approx 1.5811388...$ Å。四舍五入到四位有效数字得到 $1.581$ Å。这个距离明显小于通过朴素方法获得的距离，这说明了正确程序的重要性。", "answer": "$$ \\boxed{1.581} $$", "id": "3435070"}]}