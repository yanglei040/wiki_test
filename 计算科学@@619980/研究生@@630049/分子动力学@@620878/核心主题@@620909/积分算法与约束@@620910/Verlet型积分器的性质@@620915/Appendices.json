{"hands_on_practices": [{"introduction": "要有效地使用任何数值积分器，第一步是理解其稳定性和误差特性。这个练习通过对谐振子（分子系统中最基本振荡运动的模型）进行严格的分析，引导您推导出速度Verlet积分器的精确稳定边界和相位误差[@problem_id:3438597]。通过这个过程，您将深入理解积分器步长和系统固有频率之间的相互作用。", "problem": "考虑一个一维谐振子，其哈密顿量为 $H=\\tfrac{p^{2}}{2 m}+\\tfrac{1}{2} k q^{2}$，角频率为 $\\omega=\\sqrt{k/m}$。在分子动力学 (MD) 中，速度-Verlet积分器使用时间步长 $h$ 和加速度 $a=-\\omega^{2} q$，根据牛顿定律 $m \\ddot{q}=-k q$ 来推进位置 $q$ 和速度 $v$。请严格地从这些基础出发，推导速度-Verlet积分器对于谐振子的精确线性更新映射，分析其特征值，并以 $\\omega$ 和 $h$ 表示，求得精确的稳定性边界。从该线性映射出发，将离散频率 $\\omega_{h}$ 定义为每步的旋转角除以时间步长，并将其表示为 $\\omega$ 和 $h$ 的闭合形式函数。最后，令 $\\delta \\phi$ 表示在一个精确的连续时间周期 $T=2 \\pi / \\omega$ 内累积的相位误差，其定义为时间 $T$ 后的数值相位增量减去 $2 \\pi$。推导 $\\delta \\phi$ 以弧度为单位、用 $\\omega$ 和 $h$ 表示的闭合形式表达式。\n\n你的推导必须从牛顿第二定律和速度-Verlet更新规则出发，并且除了这些定义之外，不得假定积分器的任何预先声明的属性。将你的最终答案以行矩阵 $\\left(h_{\\max}, \\omega_{h}, \\delta \\phi\\right)$ 的形式给出，其中 $h_{\\max}$ 是以 $\\omega$ 的函数表示的最大稳定时间步长，$\\omega_{h}$ 是离散频率，$\\delta \\phi$ 是每个周期的相位误差（以弧度为单位）。无需进行数值评估或取整，最终表达式必须是精确的闭合形式。", "solution": "该问题要求分析应用于一维谐振子的速度-Verlet积分器。该分析包括推导线性更新映射、确定稳定性边界、寻找数值频率以及计算相位误差。整个推导过程必须按照问题中的定义，从第一性原理出发。\n\n首先，我们陈述标准的速度-Verlet算法。对于一个具有位置 $q(t)$、速度 $v(t)$ 和加速度 $a(t)$ 的粒子，其在时间 $t+h$ 的状态由在时间 $t$ 的状态计算得出，如下所示：\n1. 更新位置：$q(t+h) = q(t) + h v(t) + \\frac{h^2}{2} a(t)$\n2. 计算未来加速度：从 $q(t+h)$ 计算 $a(t+h)$。\n3. 更新速度：$v(t+h) = v(t) + \\frac{h}{2} [a(t) + a(t+h)]$\n\n对于一维谐振子，哈密顿量为 $H=\\frac{p^{2}}{2 m}+\\frac{1}{2} k q^{2}$，其中 $p=mv$ 是动量。运动方程由牛顿第二定律给出，$m\\ddot{q} = -kq$。加速度为 $a(t) = \\ddot{q}(t) = -\\frac{k}{m} q(t)$。使用给定的角频率定义 $\\omega = \\sqrt{k/m}$，加速度为 $a(t) = -\\omega^2 q(t)$。\n\n令 $q_n = q(nh)$ 和 $v_n = v(nh)$ 分别表示在第 $n$ 个时间步的位置和速度。相应的加速度为 $a_n = -\\omega^2 q_n$。对于谐振子，速度-Verlet更新规则变为：\n$q_{n+1} = q_n + h v_n + \\frac{h^2}{2} a_n = q_n + h v_n - \\frac{h^2 \\omega^2}{2} q_n$\n$v_{n+1} = v_n + \\frac{h}{2} [a_n + a_{n+1}]$\n\n为了求得 $v_{n+1}$，我们首先需要 $a_{n+1} = -\\omega^2 q_{n+1}$。代入 $q_{n+1}$ 的表达式：\n$a_{n+1} = -\\omega^2 \\left( q_n + h v_n - \\frac{h^2 \\omega^2}{2} q_n \\right)$\n\n现在，我们将 $a_n$ 和 $a_{n+1}$ 代入速度更新方程：\n$v_{n+1} = v_n + \\frac{h}{2} \\left[ -\\omega^2 q_n - \\omega^2 \\left( q_n + h v_n - \\frac{h^2 \\omega^2}{2} q_n \\right) \\right]$\n$v_{n+1} = v_n - \\frac{h \\omega^2}{2} \\left[ q_n + q_n + h v_n - \\frac{h^2 \\omega^2}{2} q_n \\right]$\n$v_{n+1} = v_n - \\frac{h \\omega^2}{2} \\left[ (2 - \\frac{h^2 \\omega^2}{2}) q_n + h v_n \\right]$\n$v_{n+1} = v_n - \\omega^2 h (1 - \\frac{h^2 \\omega^2}{4}) q_n - \\frac{h^2 \\omega^2}{2} v_n$\n\n现在我们可以写出完整的线性更新映射，它将状态向量 $(q_{n+1}, v_{n+1})^T$ 表示为 $(q_n, v_n)^T$ 的一个线性变换。\n$q_{n+1} = \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) q_n + h v_n$\n$v_{n+1} = -\\omega^2 h \\left(1 - \\frac{\\omega^2 h^2}{4}\\right) q_n + \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) v_n$\n\n这可以写成矩阵形式：\n$$\n\\begin{pmatrix} q_{n+1} \\\\ v_{n+1} \\end{pmatrix} = M \\begin{pmatrix} q_n \\\\ v_n \\end{pmatrix}\n$$\n其中更新矩阵 $M$，也称为转移矩阵，是：\n$$\nM = \\begin{pmatrix} 1 - \\frac{\\omega^2 h^2}{2}  h \\\\ -\\omega^2 h \\left(1 - \\frac{\\omega^2 h^2}{4}\\right)  1 - \\frac{\\omega^2 h^2}{2} \\end{pmatrix}\n$$\n\n该积分器的稳定性由矩阵 $M$ 的特征值 $\\lambda$ 决定。特征值是特征方程 $\\det(M - \\lambda I) = 0$ 的解，其中 $I$ 是单位矩阵。\n$$\n\\det \\begin{pmatrix} 1 - \\frac{\\omega^2 h^2}{2} - \\lambda  h \\\\ -\\omega^2 h \\left(1 - \\frac{\\omega^2 h^2}{4}\\right)  1 - \\frac{\\omega^2 h^2}{2} - \\lambda \\end{pmatrix} = 0\n$$\n$$\n\\left(1 - \\frac{\\omega^2 h^2}{2} - \\lambda\\right)^2 + h^2 \\omega^2 \\left(1 - \\frac{\\omega^2 h^2}{4}\\right) = 0\n$$\n$$\n\\left(\\lambda - \\left(1 - \\frac{\\omega^2 h^2}{2}\\right)\\right)^2 = -h^2 \\omega^2 \\left(1 - \\frac{\\omega^2 h^2}{4}\\right)\n$$\n$$\n\\lambda - \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) = \\pm i \\omega h \\sqrt{1 - \\frac{\\omega^2 h^2}{4}}\n$$\n$$\n\\lambda = 1 - \\frac{\\omega^2 h^2}{2} \\pm i \\omega h \\sqrt{1 - \\frac{\\omega^2 h^2}{4}}\n$$\n如果特征值的模长小于或等于1，则数值积分是稳定的。我们来计算 $|\\lambda|^2$：\n$$\n|\\lambda|^2 = \\left(1 - \\frac{\\omega^2 h^2}{2}\\right)^2 + \\left(\\omega h \\sqrt{1 - \\frac{\\omega^2 h^2}{4}}\\right)^2\n$$\n$$\n|\\lambda|^2 = \\left(1 - \\omega^2 h^2 + \\frac{\\omega^4 h^4}{4}\\right) + \\omega^2 h^2 \\left(1 - \\frac{\\omega^2 h^2}{4}\\right)\n$$\n$$\n|\\lambda|^2 = 1 - \\omega^2 h^2 + \\frac{\\omega^4 h^4}{4} + \\omega^2 h^2 - \\frac{\\omega^4 h^4}{4} = 1\n$$\n这个结果 $|\\lambda|^2=1$ 成立的充要条件是平方根内的参数为非负数，这确保了特征值是单位圆上的一对共轭复数。如果该参数为负，特征值将变为实数，其中一个的模长将大于1，导致指数增长和不稳定性。因此，稳定性条件是：\n$1 - \\frac{\\omega^2 h^2}{4} \\geq 0 \\implies \\omega^2 h^2 \\leq 4$\n由于 $\\omega$ 和 $h$ 均为正数，这得到 $\\omega h \\leq 2$。最大稳定时间步长 $h_{\\max}$ 对应于等式成立的情况，即 $\\omega h_{\\max} = 2$，这意味着 $h_{\\max} = \\frac{2}{\\omega}$。\n\n接下来，我们推导离散频率 $\\omega_h$。在稳定区域内，特征值的形式为 $\\lambda = e^{\\pm i \\theta_h}$，其中 $\\theta_h$ 是每一步的数值相位增量。我们可以将 $\\lambda$ 写成 $\\lambda = \\cos(\\theta_h) + i \\sin(\\theta_h)$。通过将其与 $\\lambda$ 的表达式进行比较，我们确定：\n$\\cos(\\theta_h) = \\text{Re}(\\lambda) = 1 - \\frac{\\omega^2 h^2}{2}$\n数值频率 $\\omega_h$ 定义为单位时间内的相位增量，因此 $\\omega_h = \\theta_h / h$。\n$\\theta_h = \\omega_h h = \\arccos\\left(1 - \\frac{\\omega^2 h^2}{2}\\right)$\n因此，离散频率是：\n$\\omega_h = \\frac{1}{h} \\arccos\\left(1 - \\frac{\\omega^2 h^2}{2}\\right)$\n\n最后，我们推导在一个精确的连续时间周期 $T = 2\\pi / \\omega$ 内的相位误差 $\\delta \\phi$。一个周期内的时间步数为 $N = T/h = \\frac{2\\pi}{\\omega h}$。\n在时间 $T$ 内的总数值相位增量是 $N \\theta_h = N (\\omega_h h)$。\n同一周期内的总精确相位增量是 $\\omega T = \\omega(\\frac{2\\pi}{\\omega}) = 2\\pi$。\n相位误差 $\\delta \\phi$ 是数值相位增量与精确相位增量之差：\n$\\delta \\phi = N \\omega_h h - 2\\pi$\n$\\delta \\phi = \\left(\\frac{2\\pi}{\\omega h}\\right) \\omega_h h - 2\\pi = \\frac{2\\pi \\omega_h}{\\omega} - 2\\pi = 2\\pi \\left(\\frac{\\omega_h}{\\omega} - 1\\right)$\n代入 $\\omega_h$ 的表达式：\n$\\delta \\phi = 2\\pi \\left(\\frac{1}{\\omega h} \\arccos\\left(1 - \\frac{\\omega^2 h^2}{2}\\right) - 1\\right)$\n\n所求的三个量是 $h_{\\max} = \\frac{2}{\\omega}$，$\\omega_h = \\frac{1}{h} \\arccos\\left(1 - \\frac{\\omega^2 h^2}{2}\\right)$，以及 $\\delta \\phi = 2\\pi \\left(\\frac{1}{\\omega h} \\arccos\\left(1 - \\frac{\\omega^2 h^2}{2}\\right) - 1\\right)$。", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{2}{\\omega}  \\frac{1}{h} \\arccos\\left(1 - \\frac{\\omega^2 h^2}{2}\\right)  2\\pi \\left( \\frac{1}{\\omega h} \\arccos\\left(1 - \\frac{\\omega^2 h^2}{2}\\right) - 1 \\right) \\end{pmatrix}}$$", "id": "3438597"}, {"introduction": "Verlet型积分器的一个标志性特性是其辛性，这保证了长期能量守恒的有界误差，对于可靠的分子动力学模拟至关重要。本练习将通过一个直接的数值比较来阐明这一概念[@problem_id:3438625]。您将实现辛性的速度Verlet积分器和一个看似合理但非辛性的预测-校正方案，并以定量方式展示它们在能量守恒方面的巨大差异。", "problem": "考虑一个一维哈密顿系统，在分子动力学中，该系统在一个光滑势能下遵循牛顿第二定律。设哈密顿量由下式给出\n$$\nH(x,p) = \\frac{p^2}{2m} + V(x), \\quad p = m v,\n$$\n其中质量 $m$ 为常数，$x$ 为位置，$p$ 为动量，$v$ 为速度，势能为\n$$\nV(x) = \\frac{1}{2} k x^2 + \\frac{\\lambda}{4} x^4,\n$$\n因此力为 $F(x) = -\\frac{dV}{dx} = -k x - \\lambda x^3$，加速度为 $a(x) = \\frac{F(x)}{m}$。从初始条件 $x(0) = x_0$，$v(0) = v_0$ 出发，考虑两种单步时间积分方法，步长为 $\\Delta t$，每步只进行一次力 $F$ 的计算：\n\n- 速度-Verlet（Velocity-Verlet，对称的，踢-漂移-踢形式）。在第 $n$ 步使用存储的加速度 $a_n = a(x_n)$：\n  1. 半步踢（Half-kick）：$v_{n+\\frac{1}{2}} = v_n + \\frac{\\Delta t}{2} a_n$。\n  2. 漂移（Drift）：$x_{n+1} = x_n + \\Delta t\\, v_{n+\\frac{1}{2}}$。\n  3. 计算力（Force）：$a_{n+1} = a(x_{n+1})$。\n  4. 半步踢（Half-kick）：$v_{n+1} = v_{n+\\frac{1}{2}} + \\frac{\\Delta t}{2} a_{n+1}$。\n\n- 预测-校正Verlet（Predictor–corrector Verlet），使用单个预测力，并且不在校正后的位置重新计算。在第 $n$ 步使用存储的加速度 $a_n = a(x_n)$：\n  1. 位置预测：$x_{n+1}^{(p)} = x_n + \\Delta t\\, v_n + \\frac{\\Delta t^2}{2} a_n$。\n  2. 预测力：$a_{n+1}^{(p)} = a\\!\\left(x_{n+1}^{(p)}\\right)$。\n  3. 速度校正：$v_{n+1} = v_n + \\frac{\\Delta t}{2}\\left(a_n + a_{n+1}^{(p)}\\right)$。\n  4. 使用梯形速度进行位置校正：$x_{n+1} = x_n + \\frac{\\Delta t}{2}\\left(v_n + v_{n+1}\\right)$。\n  5. 为下一步设置 $a_{n+1} \\leftarrow a_{n+1}^{(p)}$，而不在校正后的 $x_{n+1}$ 处重新计算力。\n\n两种方法每步都只进行一次 $F$ 的计算，确保计算成本相匹配。\n\n任务：使用第一性原理和数值证据，证明在上述“预测-校正Verlet”方法中重用之前步骤的速度会降低其相对于纯粹速度-Verlet方法的辛性（symplecticity）。量化由此产生的哈密顿量 $H$ 在长时间内的长期漂移（secular drift），并与同等计算成本下的速度-Verlet方法进行比较。使用 $H(t) - H(0)$ 对时间 $t$ 的最小二乘线性回归来估计一个恒定的漂移率（斜率），单位为能量/单位时间。\n\n在你的推理和实现中必须依赖的基本原理：牛顿第二定律、哈密顿量的定义以及上述给出的正则更新规则。避免使用任何无法从这些原理推导出的简化公式。\n\n你的程序必须：\n- 完全按照规定实现两种积分器。\n- 对于每个轨迹，在每一步计算哈密顿量 $H(t) = \\frac{1}{2} m v(t)^2 + V(x(t))$，并构成 $y(t) = H(t) - H(0)$。\n- 通过普通最小二乘法估计漂移斜率 $\\beta$，即 $y$ 对 $t$ 的斜率，如下所示：\n  $$\n  \\beta = \\frac{\\sum_i (t_i - \\bar{t})(y_i - \\bar{y})}{\\sum_i (t_i - \\bar{t})^2},\n  $$\n  其中 $(t_i, y_i)$ 是每一步的采样对，上划线表示算术平均值。\n- 为每个测试用例报告一个速度-Verlet的漂移斜率和一个预测-校正Verlet的漂移斜率，单位为能量/单位时间。\n\n使用以下测试套件以确保覆盖典型、小步长和近边界行为。每个元组是 $(m, k, \\lambda, x_0, v_0, \\Delta t, T_{\\text{total}})$，其中 $T_{\\text{total}}$ 是模拟的总物理时间：\n- 情况A（小步长，近守恒基准）：$(m, k, \\lambda, x_0, v_0, \\Delta t, T_{\\text{total}}) = (1.0, 1.0, 1.0, 1.0, 0.0, 0.005, 2000.0)$。\n- 情况B（典型步长）：$(1.0, 1.0, 1.0, 1.0, 0.0, 0.020, 2000.0)$。\n- 情况C（较大步长）：$(1.0, 1.0, 1.0, 1.0, 0.0, 0.050, 2000.0)$。\n- 情况D（近边界较大步长，较短时间范围以避免发散）：$(1.0, 1.0, 1.0, 1.0, 0.0, 0.080, 500.0)$。\n\n所有量都是无量纲的；报告的漂移斜率以能量/单位时间为单位。\n\n最终输出格式：\n- 你的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果。每个情况的两个漂移斜率按顺序排列，先是速度-Verlet，然后是预测-校正Verlet，并按A、B、C、D的顺序连接所有情况的结果。例如，输出应类似于一个列表，如 [resultA_VV,resultA_PCV,resultB_VV,resultB_PCV,resultC_VV,resultC_PCV,resultD_VV,resultD_PCV]。", "solution": "该问题要求对两种数值积分方案——速度-Verlet和一种特定的预测-校正方法——进行比较分析，用于一个一维哈密顿系统。分析的重点是哈密顿量的长期守恒性，这是衡量此类系统积分器质量的关键指标。\n\n该物理系统由哈密顿量 $H(x,p) = \\frac{p^2}{2m} + V(x)$ 控制，其中 $p=mv$ 是动量，$m$ 是质量，$V(x) = \\frac{1}{2} k x^2 + \\frac{\\lambda}{4} x^4$ 是势能。这对应于牛顿第二定律 $m\\ddot{x} = F(x)$，其中力 $F(x) = -\\frac{dV}{dx} = -k x - \\lambda x^3$，加速度 $a(x) = F(x)/m$。\n\n用于哈密顿系统的数值积分器理想情况下是“几何的”，意味着它们在相空间中保留了真实连续流的基本几何特性。这些性质中最重要的是辛性（symplecticity）。一个辛积分器应用于哈密顿系统时，并不会精确守恒真实的哈密顿量 $H$，而是精确守恒一个附近的“影子”哈密顿量 $H_{\\Delta t}$。这意味着真实能量 $H$ 的数值误差在任意长的模拟时间内都保持有界，表现为振荡而没有长期漂移。单步积分器映射 $\\Phi_{\\Delta t}$ 是辛的必要条件是它必须是时间可逆的，即执行一个前向步骤 $\\Phi_{\\Delta t}$ 后再执行一个后向步骤 $\\Phi_{-\\Delta t}$ 必须使系统返回其初始状态。\n\n**1. 速度-Verlet (VV) 积分器分析**\n\n速度-Verlet算法由以下从步骤 $n$到 $n+1$ 的更新序列定义：\n1. $v_{n+\\frac{1}{2}} = v_n + \\frac{\\Delta t}{2} a(x_n)$\n2. $x_{n+1} = x_n + \\Delta t\\, v_{n+\\frac{1}{2}}$\n3. $a_{n+1} = a(x_{n+1})$\n4. $v_{n+1} = v_{n+\\frac{1}{2}} + \\frac{\\Delta t}{2} a_{n+1}$\n\n该算法是几何积分器家族的一员。其辛性可以通过证明它是一种二阶对称分裂方法来严格建立。哈密顿量 $H = T(p) + V(x)$ 被分裂为其动能 ($T$) 和势能 ($V$) 部分。这些部分的确切演化算子可以组合起来以近似完整的演化。速度-Verlet算法代表了映射 $\\Phi_{\\Delta t} = \\mathcal{O}_V(\\Delta t/2) \\mathcal{O}_T(\\Delta t) \\mathcal{O}_V(\\Delta t/2)$，其中 $\\mathcal{O}_V(\\delta t)$ 是在势能 $V$ 下演化时间 $\\delta t$ 的确切过程（对动量的“踢”），而 $\\mathcal{O}_T(\\delta t)$ 是在动能 $T$ 下演化时间 $\\delta t$ 的确切过程（位置的“漂移”）。由于每个分量映射都是辛的，它们的组合也是辛的。\n\n由于其辛性，速度-Verlet积分器表现出卓越的长期能量守恒性。数值能量将围绕真实的初始能量振荡，但不会随时间系统性地增加或减少。这些振荡的幅度取决于时间步长 $\\Delta t$，但平均能量保持恒定。数值实验预期会得出能量漂移斜率 $\\beta$ 在统计上为零。\n\n**2. 预测-校正Verlet (PCV) 积分器分析**\n\n这种特定的预测-校正方案定义如下：\n1. 位置预测：$x_{n+1}^{(p)} = x_n + \\Delta t\\, v_n + \\frac{\\Delta t^2}{2} a_n$\n2. 预测力：$a_{n+1}^{(p)} = a(x_{n+1}^{(p)})$\n3. 速度校正：$v_{n+1} = v_n + \\frac{\\Delta t}{2}(a_n + a_{n+1}^{(p)})$\n4. 位置校正：$x_{n+1} = x_n + \\frac{\\Delta t}{2}(v_n + v_{n+1})$\n5. 为下一步设置 $a_{n+1} \\leftarrow a_{n+1}^{(p)}$。\n\n该算法尽管每步只使用一次力计算，但违反了几何积分的原理。其核心缺陷在于状态 $(x, v)$ 推进方式上的根本不一致。\n\n在步骤3中，速度 $v_{n+1}$ 是使用在一个临时的、*预测的* 位置 $x_{n+1}^{(p)}$ 处计算的力来计算的。在步骤4中，这个新速度被用来计算最终位置 $x_{n+1}$。这个最终位置 $x_{n+1}$ 通常不等于预测位置 $x_{n+1}^{(p)}$。关键在于，最终位置处的力 $F(x_{n+1})$ 从未被计算或使用。这破坏了作为辛性基础的对称结构。\n\n通过将步骤3代入步骤4，我们可以找到位置的显式更新规则：\n$$\nx_{n+1} = x_n + \\frac{\\Delta t}{2}\\left(v_n + \\left[v_n + \\frac{\\Delta t}{2}(a_n + a_{n+1}^{(p)})\\right]\\right) = x_n + \\Delta t v_n + \\frac{\\Delta t^2}{4}(a_n + a_{n+1}^{(p)})\n$$\n与速度-Verlet的位置更新中包含 $\\frac{\\Delta t^2}{2}a_n$ 项不同，此方法的位置更新依赖于一个未来（预测的）加速度。这种不对称的依赖性破坏了映射 $(x_n, v_n) \\to (x_{n+1}, v_{n+1})$ 的时间可逆性。由于时间可逆性是辛性的一个必要条件，因此该积分器是非辛的。\n\n对于非辛积分器，不存在守恒的影子哈密顿量。数值误差以有偏的方式累积，导致总能量 $H$ 出现长期漂移。这意味着能量在长时间模拟中会系统性地增加或减少。这种漂移是算法的真实产物，而不仅仅是随机误差，其速率预计会随着时间步长 $\\Delta t$ 的增加而增加。\n\n**数值演示**\n\n提供的代码实现了两种积分器，用于为给定的测试用例生成轨迹。对于每个轨迹，在每个时间步 $t_i$ 计算总能量 $H(t_i) = \\frac{1}{2} m v_i^2 + V(x_i)$。能量漂移率 $\\beta$ 通过对能量偏差 $y_i = H(t_i) - H(0)$ 与时间 $t_i$ 进行普通最小二乘线性回归来量化。此回归的斜率 $\\beta$ 衡量了能量变化的平均速率。我们预期速度-Verlet方法的 $\\beta \\approx 0$，而预测-校正方案的 $\\beta$ 不为零且依赖于 $\\Delta t$，从而为辛性的退化和由此产生的能量漂移提供数值证据。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares Velocity-Verlet and a Predictor-Corrector Verlet\n    integrator for a 1D nonlinear oscillator, quantifying the energy drift.\n    \"\"\"\n\n    def acceleration(x, m, k, lambda_):\n        \"\"\"Computes acceleration a = F/m.\"\"\"\n        force = -k * x - lambda_ * x**3\n        return force / m\n\n    def hamiltonian(x, v, m, k, lambda_):\n        \"\"\"Computes the Hamiltonian H = K + V.\"\"\"\n        potential_energy = 0.5 * k * x**2 + 0.25 * lambda_ * x**4\n        kinetic_energy = 0.5 * m * v**2\n        return kinetic_energy + potential_energy\n\n    def calculate_drift_slope(t_vals, H_vals):\n        \"\"\"\n        Estimates the drift slope beta via ordinary least squares, as defined\n        in the problem statement.\n        \"\"\"\n        y_vals = H_vals - H_vals[0]\n        t_mean = np.mean(t_vals)\n        y_mean = np.mean(y_vals)\n        \n        numerator = np.sum((t_vals - t_mean) * (y_vals - y_mean))\n        denominator = np.sum((t_vals - t_mean)**2)\n        \n        if denominator == 0.0:\n            return 0.0\n            \n        return numerator / denominator\n\n    def run_velocity_verlet(m, k, lambda_, x0, v0, dt, T_total):\n        \"\"\"Runs a simulation using the Velocity-Verlet integrator.\"\"\"\n        num_steps = int(round(T_total / dt))\n        t_vals = np.linspace(0, num_steps * dt, num_steps + 1)\n        H_vals = np.zeros(num_steps + 1)\n        \n        x, v = x0, v0\n        a = acceleration(x, m, k, lambda_)\n        \n        H_vals[0] = hamiltonian(x, v, m, k, lambda_)\n        \n        for i in range(num_steps):\n            # 1. Half-kick\n            v_half = v + 0.5 * dt * a\n            # 2. Drift\n            x_new = x + dt * v_half\n            # 3. Force calculation at new position\n            a_new = acceleration(x_new, m, k, lambda_)\n            # 4. Half-kick\n            v_new = v_half + 0.5 * dt * a_new\n            \n            # Update state for next iteration\n            x, v, a = x_new, v_new, a_new\n            \n            # Store Hamiltonian\n            H_vals[i + 1] = hamiltonian(x, v, m, k, lambda_)\n            \n        return t_vals, H_vals\n\n    def run_predictor_corrector_verlet(m, k, lambda_, x0, v0, dt, T_total):\n        \"\"\"Runs a simulation using the specified Predictor-Corrector integrator.\"\"\"\n        num_steps = int(round(T_total / dt))\n        t_vals = np.linspace(0, num_steps * dt, num_steps + 1)\n        H_vals = np.zeros(num_steps + 1)\n        \n        x, v = x0, v0\n        # a_n is stored from the previous step\n        a = acceleration(x, m, k, lambda_)\n        \n        H_vals[0] = hamiltonian(x, v, m, k, lambda_)\n\n        for i in range(num_steps):\n            # 1. Predictor for position\n            x_p = x + dt * v + 0.5 * dt**2 * a\n            # 2. Predicted force/acceleration\n            a_p = acceleration(x_p, m, k, lambda_)\n            # 3. Corrector for velocity\n            v_new = v + 0.5 * dt * (a + a_p)\n            # 4. Corrector for position\n            x_new = x + 0.5 * dt * (v + v_new)\n            \n            # Update state for next iteration\n            x = x_new\n            v = v_new\n            # 5. Set a_{n+1} - a_{n+1}^{(p)} for the next step's \"a_n\"\n            a = a_p\n            \n            # Store Hamiltonian\n            H_vals[i + 1] = hamiltonian(x, v, m, k, lambda_)\n            \n        return t_vals, H_vals\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (m, k, lambda, x0, v0, dt, T_total)\n        (1.0, 1.0, 1.0, 1.0, 0.0, 0.005, 2000.0), # Case A\n        (1.0, 1.0, 1.0, 1.0, 0.0, 0.020, 2000.0), # Case B\n        (1.0, 1.0, 1.0, 1.0, 0.0, 0.050, 2000.0), # Case C\n        (1.0, 1.0, 1.0, 1.0, 0.0, 0.080, 500.0),  # Case D\n    ]\n\n    results = []\n    for params in test_cases:\n        m, k, lambda_, x0, v0, dt, T_total = params\n\n        # Run Velocity-Verlet simulation and calculate drift\n        t_vv, H_vv = run_velocity_verlet(m, k, lambda_, x0, v0, dt, T_total)\n        slope_vv = calculate_drift_slope(t_vv, H_vv)\n        results.append(slope_vv)\n        \n        # Run Predictor-Corrector Verlet simulation and calculate drift\n        t_pcv, H_pcv = run_predictor_corrector_verlet(m, k, lambda_, x0, v0, dt, T_total)\n        slope_pcv = calculate_drift_slope(t_pcv, H_pcv)\n        results.append(slope_pcv)\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.8e}' for r in results)}]\")\n\nsolve()\n```", "id": "3438625"}, {"introduction": "即使是稳定且辛性的积分器也存在局限性，尤其是在模拟具有多种时间尺度的复杂系统时。本练习探讨了数值共振现象，在这种情况下，积分步长与系统固有频率之间的相互作用可能导致巨大的误差，即使满足了标准的稳定性判据[@problem_id:3438643]。理解这种共振对于选择合适的步长和避免模拟中出现人为的能量传递至关重要。", "problem": "考虑一个分子动力学（MD）模型，该模型具有两个单位质量的自由度，其坐标为 $q_{1}$ 和 $q_{2}$，共轭动量为 $p_{1}$ 和 $p_{2}$，由哈密顿量控制\n$$\nH(q,p) \\;=\\; \\frac{1}{2}\\big(p_{1}^{2} + p_{2}^{2}\\big) \\;+\\; \\frac{1}{2}\\omega_{1}^{2} q_{1}^{2} \\;+\\; \\frac{1}{2}\\omega_{2}^{2} q_{2}^{2} \\;+\\; \\epsilon\\, q_{1}^{2} q_{2}^{2},\n$$\n其中 $\\epsilon$ 是一个小的无量纲耦合参数，且 $\\omega_{1},\\omega_{2}0$ 是不同的特征频率。该系统使用速度-Verlet格式进行积分，固定时间步长为 $h0$。\n\n从牛顿第二定律 $m\\,\\ddot{q} = -\\partial V/\\partial q$（其中 $m=1$）以及速度-Verlet更新的定义方程出发\n$$\nq^{n+1} \\;=\\; q^{n} \\;+\\; h\\,v^{n} \\;+\\; \\frac{h^{2}}{2}\\,a(q^{n}), \\qquad\nv^{n+1} \\;=\\; v^{n} \\;+\\; \\frac{h}{2}\\big(a(q^{n}) + a(q^{n+1})\\big),\n$$\n其中 $a(q) = -\\nabla V(q)$，执行以下分析：\n\n- 对于势为 $V(q) = \\tfrac{1}{2}\\omega^{2} q^{2}$ 的单个非耦合谐振模式，推导由速度-Verlet方法引起的线性位置递推关系，并证明在 $(q^{n},q^{n-1})$ 上的一步映射是按离散相角 $\\phi(\\omega h)$ 的旋转，即，当 $h\\omega  2$ 时，其特征乘子为 $\\exp(\\pm i\\,\\phi)$，其中 $\\phi \\in (0,\\pi)$。\n\n- 在上述弱耦合双频系统中（$|q_{1}|,|q_{2}|$ 和 $\\epsilon$ 较小），使用辛积分子的主阶后向误差分析来论证为何当整数组合满足 $k_{1}\\phi_{1} \\pm k_{2}\\phi_{2} \\approx m\\pi$（其中 $k_{1},k_{2},m$ 为小整数）时，离散相角 $\\phi_{1} = \\phi(\\omega_{1} h)$ 和 $\\phi_{2} = \\phi(\\omega_{2} h)$ 的近公度性会在修正哈密顿量中产生小分母，从而产生参数共振和大的长时间能量误差，即使在单模线性稳定性条件 $h\\omega_1  2$ 和 $h\\omega_2  2$ 成立的情况下也是如此。\n\n给定 $\\omega_{1} = 1\\,\\text{rad}\\,\\text{ps}^{-1}$，$\\omega_{2} = \\sqrt{2}\\,\\text{rad}\\,\\text{ps}^{-1}$，并关注 $k_{1} = k_{2} = m = 1$ 的最低阶共振，确定满足共振条件 $\\phi_{1} + \\phi_{2} = \\pi$ 的最小正时间步长 $h$（单位为皮秒 ps），且满足条件 $h\\,\\omega_{\\max}  2$，其中 $\\omega_{\\max} = \\max\\{\\omega_{1},\\omega_{2}\\}$。将您的最终结果 $h$ 以 $\\text{ps}$ 为单位表示，并四舍五入到4位有效数字。", "solution": "经评估，该问题是有效的。它在科学上植根于经典力学和数值分析领域，特别是关于哈密顿系统的辛积分子的性质。该问题提法得当、内容自洽，并提供了所有必要的参数和定义。它不包含任何矛盾或歧义。\n\n我们将按要求分三部分解决该问题。\n\n首先，我们分析一个势为 $V(q) = \\frac{1}{2}\\omega^{2} q^{2}$ 且单位质量 $m=1$ 的单个非耦合谐振模式。其运动方程为 $\\ddot{q} = -\\frac{\\partial V}{\\partial q} = -\\omega^{2}q$。加速度为 $a(q) = -\\omega^{2}q$。速度-Verlet更新方程为：\n$$\nq^{n+1} = q^{n} + h\\,v^{n} + \\frac{h^{2}}{2}\\,a(q^{n}) = q^{n} + h\\,v^{n} - \\frac{h^{2}\\omega^{2}}{2}\\,q^{n}\n$$\n$$\nv^{n+1} = v^{n} + \\frac{h}{2}\\big(a(q^{n}) + a(q^{n+1})\\big) = v^{n} - \\frac{h\\omega^{2}}{2}\\big(q^{n} + q^{n+1}\\big)\n$$\n为了获得位置 $q$ 的递推关系，我们消去速度 $v$。从第一个方程，我们表示出 $h\\,v^{n}$：\n$$\nh\\,v^{n} = q^{n+1} - q^{n} + \\frac{h^{2}\\omega^{2}}{2}\\,q^{n}\n$$\n我们还需要 $h\\,v^{n-1}$ 的表达式，这可以通过将索引 $n \\to n-1$ 移位得到：\n$$\nh\\,v^{n-1} = q^{n} - q^{n-1} + \\frac{h^{2}\\omega^{2}}{2}\\,q^{n-1}\n$$\n现在，我们用 $v^{n-1}$ 来重写 $v^{n}$ 的速度更新方程：\n$$\nv^{n} = v^{n-1} - \\frac{h\\omega^{2}}{2}\\big(q^{n-1} + q^{n}\\big)\n$$\n乘以 $h$ 得到：\n$$\nh\\,v^{n} = h\\,v^{n-1} - \\frac{h^{2}\\omega^{2}}{2}\\big(q^{n-1} + q^{n}\\big)\n$$\n代入 $h\\,v^{n}$ 和 $h\\,v^{n-1}$ 的表达式：\n$$\nq^{n+1} - q^{n} + \\frac{h^{2}\\omega^{2}}{2}\\,q^{n} = \\left(q^{n} - q^{n-1} + \\frac{h^{2}\\omega^{2}}{2}\\,q^{n-1}\\right) - \\frac{h^{2}\\omega^{2}}{2}\\big(q^{n-1} + q^{n}\\big)\n$$\n化简该方程：\n$$\nq^{n+1} - q^{n} + \\frac{h^{2}\\omega^{2}}{2}\\,q^{n} = q^{n} - q^{n-1} - \\frac{h^{2}\\omega^{2}}{2}\\,q^{n}\n$$\n$$\nq^{n+1} - \\left(2 - h^{2}\\omega^{2}\\right) q^{n} + q^{n-1} = 0\n$$\n这就是线性位置递推关系。为了分析其性质，我们通过代入 $q^{n} = \\lambda^{n}$ 来考虑其特征方程：\n$$\n\\lambda^{2} - \\left(2 - h^{2}\\omega^{2}\\right)\\lambda + 1 = 0\n$$\n其根（特征乘子）由二次公式给出：\n$$\n\\lambda = \\frac{(2 - h^{2}\\omega^{2}) \\pm \\sqrt{(2 - h^{2}\\omega^{2})^{2} - 4}}{2}\n$$\n如果乘子是单位圆上的一对共轭复数，则该映射对应于一个旋转，这要求判别式为负：\n$(2 - h^{2}\\omega^{2})^{2} - 4  0 \\implies (2 - h^{2}\\omega^{2})^{2}  4 \\implies |2 - h^{2}\\omega^{2}|  2$\n这等价于 $-2  2 - h^{2}\\omega^{2}  2$。右侧不等式 $2 - h^{2}\\omega^{2}  2$ 意味着 $-h^{2}\\omega^{2}  0$，对于 $h, \\omega  0$ 这总是成立的。左侧不等式 $-2  2 - h^{2}\\omega^{2}$ 意味着 $h^{2}\\omega^{2}  4$，或 $h\\omega  2$。这就是速度-Verlet方法的线性稳定性条件。当此条件成立时，我们可以定义一个离散相角 $\\phi \\in (0,\\pi)$，使得：\n$$\n\\cos(\\phi) = \\frac{2 - h^{2}\\omega^{2}}{2} = 1 - \\frac{h^{2}\\omega^{2}}{2}\n$$\n条件 $h\\omega  2$ 确保了 $-1  \\cos(\\phi)  1$。特征方程变为 $\\lambda^{2} - 2\\cos(\\phi)\\lambda + 1 = 0$，其根为 $\\lambda = \\cos(\\phi) \\pm i\\sin(\\phi) = \\exp(\\pm i\\phi)$。这证实了状态空间上的一步映射是按角度 $\\phi = \\arccos\\left(1 - \\frac{h^{2}\\omega^{2}}{2}\\right)$ 的旋转。\n\n第二，我们使用后向误差分析来解释数值共振。速度-Verlet方法是辛的。对于任何哈密顿系统 $H$ 和任何辛积分子，都存在一个修正哈密顿量 $H_{\\text{mod}}$，它是关于时间步长 $h$ 的渐近级数，并被数值算法精确守恒。对于像速度-Verlet这样的对称方法，该级数只包含 $h$ 的偶次幂：\n$$\nH_{\\text{mod}} = H + h^{2}H_{(2)} + h^{4}H_{(4)} + \\mathcal{O}(h^{6})\n$$\n数值轨迹 $(q^{n}, p^{n})$ 是由 $H_{\\text{mod}}$ 定义的哈密顿系统的精确解。修正项 $H_{(k)}$ 的构建涉及求解用于平均掉该方法误差的同调方程。这个平均化过程，通常通过正则变换（例如，李级数）执行，会涉及到与未扰动系统频率相关的分母。\n在我们的弱耦合系统中，原始哈密顿量为 $H = H_{0} + V_{\\text{pert}}$，其中 $H_{0}$ 是两个非耦合谐振子的哈密顿量，而 $V_{\\text{pert}} = \\epsilon\\, q_{1}^{2} q_{2}^{2}$ 是微扰。在 $H_{0}$ 下的真实动力学涉及频率 $\\omega_{1}$ 和 $\\omega_{2}$。然而，数值映射每一步将每个模式的相位推进 $\\phi_{1} = \\phi(\\omega_{1}h)$ 和 $\\phi_{2} = \\phi(\\omega_{2}h)$。\n微扰项 $V_{\\text{pert}}$ 可以在未扰动振子的角变量中展开成傅里叶级数。项 $q_{1}^{2}q_{2}^{2}$ 包含形式为 $k_{1}\\theta_{1} \\pm k_{2}\\theta_{2}$（其中 $k_{1}, k_{2}$ 是小整数）的相位组合的振荡分量。对于给定的四次势，主导项对应于 $k_{1}=2, k_{2}=2$。\n在构造修正哈密顿量 $H_{\\text{mod}}$ 时，微扰中的项被变换掉。这个变换级数包含的分母对应于积分器一步作用下这些振荡分量的相位变化。当一个相位组合在映射下几乎静止时，就会发生共振，这意味着其总相位推进接近 $2\\pi$ 的倍数。对于相位为 $k_{1}\\theta_{1} \\pm k_{2}\\theta_{2}$ 的项，共振条件是 $k_{1}\\phi_{1} \\pm k_{2}\\phi_{2} \\approx 2m\\pi$。问题陈述使用了 $m\\pi$，这是由于具有特定对称性的势的范式变换的特定结构所致。对于四次耦合 $q_1^2 q_2^2$，最低阶共振是 $2\\phi_1 \\pm 2\\phi_2 \\approx 2m\\pi$，可简化为 $\\phi_1 \\pm \\phi_2 \\approx m\\pi$。这与给定的 $k_1=k_2=1$ 的条件相符。\n当 $k_{1}\\phi_{1} \\pm k_{2}\\phi_{2} \\approx m\\pi$ 时，$H_{\\text{mod}}$ 级数中的分母会变得非常小。这导致 $h$ 的高阶项系数变得很大。修正哈密顿量 $H_{\\text{mod}}$ 在结构上变得与原始哈密顿量 $H$ 非常不同。虽然数值轨迹能高精度地守恒 $H_{\\text{mod}}$，但原始能量 $H$ 并不守恒，并且可能在长时间内表现出大的系统性漂移。这是一种数值参数共振，其中能量在模式之间交换，由离散化驱动。即使单个线性稳定性条件 $h\\omega_1  2$ 和 $h\\omega_2  2$ 得到满足，这种情况也可能发生。\n\n第三，我们确定满足最低阶共振条件 $\\phi_{1} + \\phi_{2} = \\pi$（其中 $k_{1}=k_{2}=m=1$）的最小正时间步长 $h$。我们有 $\\omega_{1} = 1\\,\\text{rad}\\,\\text{ps}^{-1}$ 和 $\\omega_{2} = \\sqrt{2}\\,\\text{rad}\\,\\text{ps}^{-1}$。该条件变为：\n$$\n\\arccos\\left(1 - \\frac{\\omega_{1}^{2}h^{2}}{2}\\right) + \\arccos\\left(1 - \\frac{\\omega_{2}^{2}h^{2}}{2}\\right) = \\pi\n$$\n令 $x = 1 - \\frac{\\omega_{1}^{2}h^{2}}{2}$ 且 $y = 1 - \\frac{\\omega_{2}^{2}h^{2}}{2}$。方程为 $\\arccos(x) + \\arccos(y) = \\pi$。对于 $x, y \\in [-1,1]$，该恒等式当且仅当 $x+y=0$ 时成立。所以我们需要：\n$$\n\\left(1 - \\frac{\\omega_{1}^{2}h^{2}}{2}\\right) + \\left(1 - \\frac{\\omega_{2}^{2}h^{2}}{2}\\right) = 0\n$$\n$$\n2 - \\frac{h^{2}}{2}(\\omega_{1}^{2} + \\omega_{2}^{2}) = 0\n$$\n$$\nh^{2} = \\frac{4}{\\omega_{1}^{2} + \\omega_{2}^{2}}\n$$\n我们寻求最小的正时间步长，因此我们取正根：\n$$\nh = \\sqrt{\\frac{4}{\\omega_{1}^{2} + \\omega_{2}^{2}}} = \\frac{2}{\\sqrt{\\omega_{1}^{2} + \\omega_{2}^{2}}}\n$$\n代入给定的频率：\n$$\nh = \\frac{2}{\\sqrt{(1)^{2} + (\\sqrt{2})^{2}}} = \\frac{2}{\\sqrt{1+2}} = \\frac{2}{\\sqrt{3}}\\,\\text{ps}\n$$\n我们必须验证该时间步长满足稳定性条件 $h\\,\\omega_{\\max}  2$，其中 $\\omega_{\\max} = \\max\\{1, \\sqrt{2}\\} = \\sqrt{2}\\,\\text{rad}\\,\\text{ps}^{-1}$。\n$$\nh\\,\\omega_{\\max} = \\frac{2}{\\sqrt{3}}\\sqrt{2} = \\frac{2\\sqrt{2}}{\\sqrt{3}} = 2\\sqrt{\\frac{2}{3}}\n$$\n由于 $\\frac{2}{3}  1$，我们有 $\\sqrt{\\frac{2}{3}}  1$，因此 $2\\sqrt{\\frac{2}{3}}  2$。稳定性条件得到满足。\n时间步长的数值为：\n$$\nh = \\frac{2}{\\sqrt{3}} \\approx 1.154700538... \\,\\text{ps}\n$$\n四舍五入到4位有效数字，我们得到 $h \\approx 1.155\\,\\text{ps}$。", "answer": "$$\n\\boxed{1.155}\n$$", "id": "3438643"}]}