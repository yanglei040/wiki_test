{"hands_on_practices": [{"introduction": "要从根本上理解第一类和第二类力场的区别，最直接的方法就是考察它们在势能面（PES）局域曲率上的差异。这个曲率由Hessian矩阵精确描述，其非对角元素直接反映了不同内坐标之间的耦合强度。通过为简单的三原子分子推导Hessian矩阵[@problem_id:3400965]，我们可以亲眼看到第二类力场中的交叉项是如何在数学上引入这种耦合的，从而为更精确的振动分析奠定基础。", "problem": "考虑一个非线性三原子分子 $A\\!-\\!B\\!-\\!C$，其内坐标为 $q_{1} = r_{AB}$、$q_{2} = r_{BC}$ 和 $q_{3} = \\theta_{ABC}$。在分子动力学 (MD) 中，参考几何构型附近的小振幅振动可以通过势能面 (PES) 的二次近似来捕捉，相应的内坐标中的 Hessian 矩阵定义为 $H_{ij} = \\left.\\frac{\\partial^{2}V}{\\partial q_{i}\\,\\partial q_{j}}\\right|_{q=q^{0}}$，其中 $q^{0} = (r_{AB}^{0}, r_{BC}^{0}, \\theta_{ABC}^{0})$ 是参考几何构型。\n\n仅使用基本定义和广泛接受的键合相互作用的分子内势能形式，为以下两种情况构建内坐标 Hessian 矩阵：\n\n(i) 一个I类力场模型，具有纯谐波的键伸缩和角弯曲，\n$$\nV_{\\mathrm{I}} = \\tfrac{1}{2}k_{1}\\left(q_{1} - q_{1}^{0}\\right)^{2} + \\tfrac{1}{2}k_{2}\\left(q_{2} - q_{2}^{0}\\right)^{2} + \\tfrac{1}{2}k_{3}\\left(q_{3} - q_{3}^{0}\\right)^{2},\n$$\n其中 $k_{1}$、$k_{2}$ 和 $k_{3}$ 是正的力常数。\n\n(ii) 一个II类力场模型，在上述基础上增加了伸缩-弯曲耦合项，\n$$\nV_{\\mathrm{II}} = V_{\\mathrm{I}} + k_{sb,1}\\left(q_{1} - q_{1}^{0}\\right)\\left(q_{3} - q_{3}^{0}\\right) + k_{sb,2}\\left(q_{2} - q_{2}^{0}\\right)\\left(q_{3} - q_{3}^{0}\\right),\n$$\n其中 $k_{sb,1}$ 和 $k_{sb,2}$ 是耦合常数。\n\n通过在 $q=q^{0}$ 处计算相应的二阶导数，为每种情况符号化地推导 $H_{ij}$，识别非对角元素，并比较非对角结构如何从情况 (i) 变为情况 (ii)。对于您最终报告的结果，请提供情况 (ii) 的非对角元素 $H_{12}$、$H_{13}$ 和 $H_{23}$，以 $\\left(H_{12},\\,H_{13},\\,H_{23}\\right)$ 的顺序排列，并表示为单个解析行矩阵。不需要数值近似，报告的行矩阵中也不应包含单位。", "solution": "用户提供了一个科学基础扎实、问题明确且客观的问题。它基于分子力学和振动光谱学的标准定义和模型。所有必要信息都已提供，问题没有矛盾或含糊不清之处。因此，该问题被认为是有效的，并将提供完整的解决方案。\n\n该问题要求为非线性三原子分子 $A\\!-\\!B\\!-\\!C$ 构建内坐标 Hessian 矩阵 $H$。该矩阵的元素定义为势能函数 $V$ 相对于内坐标 $q_i$ 的二阶偏导数，并在参考几何构型 $q^0$ 处求值。内坐标为 $q_{1} = r_{AB}$、$q_{2} = r_{BC}$ 和 $q_{3} = \\theta_{ABC}$。参考几何构型为 $q^{0} = (q_{1}^{0}, q_{2}^{0}, q_{3}^{0})$。因此，Hessian 矩阵元素 $H_{ij}$ 由下式给出：\n$$\nH_{ij} = \\left.\\frac{\\partial^{2}V}{\\partial q_{i}\\,\\partial q_{j}}\\right|_{q=q^{0}}\n$$\n我们将为提供的两种势能函数计算该矩阵。\n\n**情况 (i): I类力场**\n\nI类模型的势能函数为：\n$$\nV_{\\mathrm{I}} = \\tfrac{1}{2}k_{1}\\left(q_{1} - q_{1}^{0}\\right)^{2} + \\tfrac{1}{2}k_{2}\\left(q_{2} - q_{2}^{0}\\right)^{2} + \\tfrac{1}{2}k_{3}\\left(q_{3} - q_{3}^{0}\\right)^{2}\n$$\n其中 $k_{1}$、$k_{2}$ 和 $k_{3}$ 是正的力常数。我们通过计算所需的二阶偏导数来进行。\n\n首先，我们计算 Hessian 矩阵的对角元素 $H_{ii}$：\n$$\n\\frac{\\partial V_{\\mathrm{I}}}{\\partial q_{1}} = k_{1}\\left(q_{1} - q_{1}^{0}\\right) \\implies H_{11} = \\left.\\frac{\\partial^{2}V_{\\mathrm{I}}}{\\partial q_{1}^{2}}\\right|_{q=q^{0}} = \\left. k_{1} \\right|_{q=q^{0}} = k_{1}\n$$\n$$\n\\frac{\\partial V_{\\mathrm{I}}}{\\partial q_{2}} = k_{2}\\left(q_{2} - q_{2}^{0}\\right) \\implies H_{22} = \\left.\\frac{\\partial^{2}V_{\\mathrm{I}}}{\\partial q_{2}^{2}}\\right|_{q=q^{0}} = \\left. k_{2} \\right|_{q=q^{0}} = k_{2}\n$$\n$$\n\\frac{\\partial V_{\\mathrm{I}}}{\\partial q_{3}} = k_{3}\\left(q_{3} - q_{3}^{0}\\right) \\implies H_{33} = \\left.\\frac{\\partial^{2}V_{\\mathrm{I}}}{\\partial q_{3}^{2}}\\right|_{q=q^{0}} = \\left. k_{3} \\right|_{q=q^{0}} = k_{3}\n$$\n接下来，我们计算非对角元素 $H_{ij}$（$i \\neq j$）。根据混合偏导数的相等性（克莱罗定理），$H_{ij} = H_{ji}$。\n$$\nH_{12} = \\frac{\\partial}{\\partial q_{1}}\\left(\\frac{\\partial V_{\\mathrm{I}}}{\\partial q_{2}}\\right) = \\frac{\\partial}{\\partial q_{1}}\\left(k_{2}\\left(q_{2} - q_{2}^{0}\\right)\\right) = 0\n$$\n由于导数处处为零，其在 $q=q^0$ 处的值也为 $0$。\n$$\nH_{13} = \\frac{\\partial}{\\partial q_{1}}\\left(\\frac{\\partial V_{\\mathrm{I}}}{\\partial q_{3}}\\right) = \\frac{\\partial}{\\partial q_{1}}\\left(k_{3}\\left(q_{3} - q_{3}^{0}\\right)\\right) = 0\n$$\n$$\nH_{23} = \\frac{\\partial}{\\partial q_{2}}\\left(\\frac{\\partial V_{\\mathrm{I}}}{\\partial q_{3}}\\right) = \\frac{\\partial}{\\partial q_{2}}\\left(k_{3}\\left(q_{3} - q_{3}^{0}\\right)\\right) = 0\n$$\n因此，对于I类模型，Hessian 矩阵是对角矩阵：\n$$\nH_{\\mathrm{I}} = \\begin{pmatrix} k_{1} & 0 & 0 \\\\ 0 & k_{2} & 0 \\\\ 0 & 0 & k_{3} \\end{pmatrix}\n$$\n所有非对角元素均为零。这表明在这个简谐模型中，键的伸缩和角的弯曲是完全解耦的。\n\n**情况 (ii): II类力场**\n\nII类模型的势能函数包含交叉项：\n$$\nV_{\\mathrm{II}} = V_{\\mathrm{I}} + k_{sb,1}\\left(q_{1} - q_{1}^{0}\\right)\\left(q_{3} - q_{3}^{0}\\right) + k_{sb,2}\\left(q_{2} - q_{2}^{0}\\right)\\left(q_{3} - q_{3}^{0}\\right)\n$$\n$V_{\\mathrm{II}}$ 的 Hessian 矩阵可以通过将新项的二阶导数加到 $V_{\\mathrm{I}}$ 的 Hessian 矩阵上来计算。令 $V_{\\text{cross}} = k_{sb,1}\\left(q_{1} - q_{1}^{0}\\right)\\left(q_{3} - q_{3}^{0}\\right) + k_{sb,2}\\left(q_{2} - q_{2}^{0}\\right)\\left(q_{3} - q_{3}^{0}\\right)$。\n\n让我们重新计算 Hessian 矩阵的元素。\n对角元素为：\n$$\n\\frac{\\partial^{2}V_{\\text{cross}}}{\\partial q_{1}^{2}} = \\frac{\\partial}{\\partial q_{1}}\\left(k_{sb,1}\\left(q_{3} - q_{3}^{0}\\right)\\right) = 0\n$$\n$$\n\\frac{\\partial^{2}V_{\\text{cross}}}{\\partial q_{2}^{2}} = \\frac{\\partial}{\\partial q_{2}}\\left(k_{sb,2}\\left(q_{3} - q_{3}^{0}\\right)\\right) = 0\n$$\n$$\n\\frac{\\partial^{2}V_{\\text{cross}}}{\\partial q_{3}^{2}} = \\frac{\\partial}{\\partial q_{3}}\\left(k_{sb,1}\\left(q_{1} - q_{1}^{0}\\right) + k_{sb,2}\\left(q_{2} - q_{2}^{0}\\right)\\right) = 0\n$$\n因此，Hessian 矩阵 $H_{\\mathrm{II}}$ 的对角元素与 $H_{\\mathrm{I}}$ 的对角元素相同：$H_{11} = k_{1}$、$H_{22} = k_{2}$ 和 $H_{33} = k_{3}$。\n\n现在我们计算非对角元素：\n$$\nH_{12} = \\left.\\frac{\\partial^{2}V_{\\mathrm{II}}}{\\partial q_{1}\\,\\partial q_{2}}\\right|_{q=q^{0}} = \\frac{\\partial}{\\partial q_{1}}\\left(\\frac{\\partial V_{\\mathrm{I}}}{\\partial q_{2}} + \\frac{\\partial V_{\\text{cross}}}{\\partial q_{2}}\\right) = \\frac{\\partial}{\\partial q_{1}}\\left(k_{2}(q_{2}-q_{2}^{0}) + k_{sb,2}(q_{3}-q_{3}^{0})\\right) = 0\n$$\n所以 $H_{12}$ 元素保持为零。该项代表伸缩-伸缩耦合，而这种特定的II类势能形式中不包含此项。\n$$\nH_{13} = \\left.\\frac{\\partial^{2}V_{\\mathrm{II}}}{\\partial q_{1}\\,\\partial q_{3}}\\right|_{q=q^{0}} = \\frac{\\partial}{\\partial q_{1}}\\left(\\frac{\\partial V_{\\mathrm{I}}}{\\partial q_{3}} + \\frac{\\partial V_{\\text{cross}}}{\\partial q_{3}}\\right) = \\frac{\\partial}{\\partial q_{1}}\\left(k_{3}(q_{3}-q_{3}^{0}) + k_{sb,1}(q_{1}-q_{1}^{0}) + k_{sb,2}(q_{2}-q_{2}^{0})\\right) = k_{sb,1}\n$$\n在 $q=q^0$ 处求值即为 $k_{sb,1}$。\n$$\nH_{23} = \\left.\\frac{\\partial^{2}V_{\\mathrm{II}}}{\\partial q_{2}\\,\\partial q_{3}}\\right|_{q=q^{0}} = \\frac{\\partial}{\\partial q_{2}}\\left(\\frac{\\partial V_{\\mathrm{I}}}{\\partial q_{3}} + \\frac{\\partial V_{\\text{cross}}}{\\partial q_{3}}\\right) = \\frac{\\partial}{\\partial q_{2}}\\left(k_{3}(q_{3}-q_{3}^{0}) + k_{sb,1}(q_{1}-q_{1}^{0}) + k_{sb,2}(q_{2}-q_{2}^{0})\\right) = k_{sb,2}\n$$\n在 $q=q^0$ 处求值即为 $k_{sb,2}$。\n\nII类模型的完整 Hessian 矩阵为：\n$$\nH_{\\mathrm{II}} = \\begin{pmatrix} k_{1} & 0 & k_{sb,1} \\\\ 0 & k_{2} & k_{sb,2} \\\\ k_{sb,1} & k_{sb,2} & k_{3} \\end{pmatrix}\n$$\n\n**比较与最终答案**\n\n比较这两种情况的 Hessian 矩阵揭示了II类交叉项的影响。\n- 在I类模型 ($H_{\\mathrm{I}}$) 中，Hessian 矩阵是对角的。所有非对角元素都为零。这对应于一个势能面，在该势能面上，内运动（两次伸缩和一次弯曲）在谐波近似下是相互独立的。\n- 在II类模型 ($H_{\\mathrm{II}}$) 中，非对角元素 $H_{13}$ 和 $H_{23}$（以及它们的对称对应项 $H_{31}$ 和 $H_{32}$）是非零的。它们分别等于耦合常数 $k_{sb,1}$ 和 $k_{sb,2}$。这引入了键 $A\\!-\\!B$ 的伸缩与角 $\\theta_{ABC}$ 的弯曲之间的耦合，以及键 $B\\!-\\!C$ 的伸缩与角 $\\theta_{ABC}$ 的弯曲之间的耦合。这是一个在物理上更真实的表示，因为拉伸一个键通常会改变电子结构，从而影响相邻角的刚度。伸缩-伸缩耦合项 $H_{12}$ 仍然为零，因为势能中没有包含 $(q_1-q_1^0)(q_2-q_2^0)$ 项。\n\n问题要求以有序行矩阵的形式给出情况 (ii) 的非对角项 $H_{12}$、$H_{13}$ 和 $H_{23}$。根据我们的推导：\n$H_{12} = 0$\n$H_{13} = k_{sb,1}$\n$H_{23} = k_{sb,2}$\n\n因此，所要求的行矩阵为 $(0, k_{sb,1}, k_{sb,2})$。", "answer": "$$\n\\boxed{\\begin{pmatrix} 0 & k_{sb,1} & k_{sb,2} \\end{pmatrix}}\n$$", "id": "3400965"}, {"introduction": "理论上的优势最终需要通过与更精确的“真实”物理世界的比较来验证，在分子建模中，这个参照标准通常来自量子力学（QM）计算。本练习[@problem_id:3400982]将带你进入力场参数化的核心环节，通过将第一类和第二类模型拟合到给定的QM Hessian矩阵，你将定量地评估交叉项在多大程度上提高了模型再现真实势能面局域形状的能力。这个过程不仅揭示了第二类力场的必要性，也让你体验到计算化学家如何构建更可靠的分子模型。", "problem": "考虑一个丁烷片段，它在内坐标中由中心碳-碳键的扭转角$\\phi$以及两个相邻的价键弯曲角$\\theta_1$和$\\theta_2$描述。在与分子动力学（MD）相关的谐振子近似中，平衡几何构型附近的势能可以展开为二阶：$E(\\mathbf{q}) \\approx E_0 + \\frac{1}{2} \\mathbf{q}^\\top \\mathbf{H} \\mathbf{q}$，其中$\\mathbf{q} = (\\phi,\\theta_1,\\theta_2)^\\top$，$\\mathbf{H}$是势能相对于这些内坐标的二阶导数Hessian矩阵。Hessian矩阵的元素单位为$\\mathrm{kcal\\,mol^{-1}\\,rad^{-2}}$，并且所有角度都必须以弧度表示。\n\n一个量子力学（QM）计算提供了在这些内坐标下的目标Hessian矩阵$\\mathbf{H}^{(\\mathrm{QM})}$。你的任务是拟合两种力场模型的参数以近似$\\mathbf{H}^{(\\mathrm{QM})}$，然后量化每种拟合的残差：\n\n- I类力场：仅包含$\\phi$、$\\theta_1$和$\\theta_2$的独立谐振项。模型势能为$E_\\mathrm{I}(\\mathbf{q}) = \\frac{1}{2} k_\\phi \\phi^2 + \\frac{1}{2} k_{\\theta_1} \\theta_1^2 + \\frac{1}{2} k_{\\theta_2} \\theta_2^2$，没有交叉耦合项。相应的模型Hessian矩阵是对角矩阵，$\\mathbf{H}_\\mathrm{I} = \\mathrm{diag}(k_\\phi, k_{\\theta_1}, k_{\\theta_2})$。\n\n- II类力场：在I类的基础上扩展，包含了扭转-角耦合项。模型势能为$E_\\mathrm{II}(\\mathbf{q}) = \\frac{1}{2} k_\\phi \\phi^2 + \\frac{1}{2} k_{\\theta_1} \\theta_1^2 + \\frac{1}{2} k_{\\theta_2} \\theta_2^2 + k_{\\phi\\theta_1} \\phi \\theta_1 + k_{\\phi\\theta_2} \\phi \\theta_2$。相应的模型Hessian矩阵在对角线以及$\\phi$–$\\theta_1$和$\\phi$–$\\theta_2$非对角线上有非零元素：$\\mathbf{H}_\\mathrm{II}$具有$\\left(\\mathbf{H}_\\mathrm{II}\\right)_{11} = k_\\phi$，$\\left(\\mathbf{H}_\\mathrm{II}\\right)_{22} = k_{\\theta_1}$，$\\left(\\mathbf{H}_\\mathrm{II}\\right)_{33} = k_{\\theta_2}$，$\\left(\\mathbf{H}_\\mathrm{II}\\right)_{12} = \\left(\\mathbf{H}_\\mathrm{II}\\right)_{21} = k_{\\phi\\theta_1}$，以及$\\left(\\mathbf{H}_\\mathrm{II}\\right)_{13} = \\left(\\mathbf{H}_\\mathrm{II}\\right)_{31} = k_{\\phi\\theta_2}$，而$\\left(\\mathbf{H}_\\mathrm{II}\\right)_{23} = \\left(\\mathbf{H}_\\mathrm{II}\\right)_{32} = 0$。\n\n对于每个模型类别，确定使残差Hessian矩阵差的Frobenius范数平方$\\|\\mathbf{H}^{(\\mathrm{QM})} - \\mathbf{H}_\\mathrm{model}\\|_F^2$最小化的参数，并报告每个测试用例的残差Frobenius范数$\\|\\mathbf{H}^{(\\mathrm{QM})} - \\mathbf{H}_\\mathrm{model}\\|_F$。Frobenius范数定义为$\\|\\mathbf{A}\\|_F = \\sqrt{\\sum_{i,j} a_{ij}^2}$。\n\n使用以下$\\mathbf{H}^{(\\mathrm{QM})}$矩阵的测试套件，每个矩阵的单位均为$\\mathrm{kcal\\,mol^{-1}\\,rad^{-2}}$，并以弧度表示：\n\n- 测试用例$1$（典型耦合）：\n$$\n\\mathbf{H}^{(\\mathrm{QM})}_1 =\n\\begin{pmatrix}\n5.0 & 0.5 & -0.4 \\\\\n0.5 & 20.0 & 0.3 \\\\\n-0.4 & 0.3 & 18.0\n\\end{pmatrix}\n\\ \\mathrm{kcal\\,mol^{-1}\\,rad^{-2}}.\n$$\n\n- 测试用例$2$（无耦合边界）：\n$$\n\\mathbf{H}^{(\\mathrm{QM})}_2 =\n\\begin{pmatrix}\n4.0 & 0.0 & 0.0 \\\\\n0.0 & 15.0 & 0.0 \\\\\n0.0 & 0.0 & 16.0\n\\end{pmatrix}\n\\ \\mathrm{kcal\\,mol^{-1}\\,rad^{-2}}.\n$$\n\n- 测试用例$3$（强扭转-角耦合边缘情况）：\n$$\n\\mathbf{H}^{(\\mathrm{QM})}_3 =\n\\begin{pmatrix}\n6.0 & 3.0 & -2.5 \\\\\n3.0 & 22.0 & 0.2 \\\\\n-2.5 & 0.2 & 19.0\n\\end{pmatrix}\n\\ \\mathrm{kcal\\,mol^{-1}\\,rad^{-2}}.\n$$\n\n对于每个测试用例，你的程序必须通过最小化$\\|\\mathbf{H}^{(\\mathrm{QM})} - \\mathbf{H}_\\mathrm{model}\\|_F^2$来拟合I类和II类模型的参数，然后计算最小化的残差$\\|\\mathbf{H}^{(\\mathrm{QM})} - \\mathbf{H}_\\mathrm{model}\\|_F$。将每个残差以$\\mathrm{kcal\\,mol^{-1}\\,rad^{-2}}$为单位表示为浮点数。\n\n最终输出格式：你的程序应生成一行输出，包含一个用方括号括起来的逗号分隔列表，顺序为$\\left[r_1^{\\mathrm{I}}, r_1^{\\mathrm{II}}, r_2^{\\mathrm{I}}, r_2^{\\mathrm{II}}, r_3^{\\mathrm{I}}, r_3^{\\mathrm{II}}\\right]$，其中$r_i^{\\mathrm{I}}$和$r_i^{\\mathrm{II}}$分别是测试用例$i$的I类和II类拟合的最小化残差Frobenius范数。\n\n角度单位要求：所有角度均为弧度。物理单位要求：以$\\mathrm{kcal\\,mol^{-1}\\,rad^{-2}}$报告残差。\n\n为覆盖性设计：\n- 典型耦合用例测试存在扭转-角耦合和角-角耦合时的一般行为。\n- 无耦合边界用例确保对角化的QM Hessian矩阵能被两种模型精确再现。\n- 强扭转-角耦合边缘用例展示了II类模型中扭转-角耦合项的优势。\n\n你的程序必须是自包含的，不需要任何输入，并且严格匹配所需的单行输出格式。", "solution": "该问题是有效的。这是一个适定的优化问题，其基础是计算化学和分子建模的原理，特别是力场参数化。所有必要的数据和定义都已提供，没有科学或逻辑上的不一致之处。\n\n目标是确定I类和II类力场模型的参数，以最佳地近似给定的量子力学（QM）Hessian矩阵`$\\mathbf{H}^{(\\mathrm{QM})}$`。“最佳”近似被定义为最小化残差矩阵的Frobenius范数平方`$\\|\\mathbf{H}^{(\\mathrm{QM})} - \\mathbf{H}_\\mathrm{model}\\|_F^2$`的近似。然后我们将报告得到的残差Frobenius范数`$\\|\\mathbf{H}^{(\\mathrm{QM})} - \\mathbf{H}_\\mathrm{model}\\|_F$`。\n\n设QM Hessian矩阵表示为`$\\mathbf{H}$`，其元素为`$h_{ij}$`。问题使用坐标向量`$\\mathbf{q} = (\\phi, \\theta_1, \\theta_2)^\\top$`，因此Hessian矩阵是一个`$3 \\times 3$`的对称矩阵。需要最小化的目标函数是残差矩阵`$\\mathbf{R} = \\mathbf{H} - \\mathbf{H}_\\mathrm{model}$`的元素平方和：\n$$\nL = \\|\\mathbf{R}\\|_F^2 = \\sum_{i=1}^3 \\sum_{j=1}^3 (R_{ij})^2 = \\sum_{i=1}^3 \\sum_{j=1}^3 (h_{ij} - (\\mathbf{H}_\\mathrm{model})_{ij})^2\n$$\n为了找到每个模型的最优参数，我们将`$L$`对每个参数求偏导数并将其设为零。\n\n### I类模型拟合\n\nI类模型的Hessian矩阵是对角矩阵：\n$$\n\\mathbf{H}_\\mathrm{I} = \\begin{pmatrix} k_\\phi & 0 & 0 \\\\ 0 & k_{\\theta_1} & 0 \\\\ 0 & 0 & k_{\\theta_2} \\end{pmatrix}\n$$\n残差的Frobenius范数平方为：\n$$\nL_\\mathrm{I}(k_\\phi, k_{\\theta_1}, k_{\\theta_2}) = \\sum_{i,j} (h_{ij} - (\\mathbf{H}_\\mathrm{I})_{ij})^2\n$$\n展开这个和得到：\n$$\nL_\\mathrm{I} = (h_{11} - k_\\phi)^2 + (h_{22} - k_{\\theta_1})^2 + (h_{33} - k_{\\theta_2})^2 + \\sum_{i \\neq j} h_{ij}^2\n$$\n为了最小化`$L_\\mathrm{I}$`，我们通过将偏导数设为零来求解参数：\n$$\n\\frac{\\partial L_\\mathrm{I}}{\\partial k_\\phi} = -2(h_{11} - k_\\phi) = 0 \\implies k_\\phi = h_{11}\n$$\n$$\n\\frac{\\partial L_\\mathrm{I}}{\\partial k_{\\theta_1}} = -2(h_{22} - k_{\\theta_1}) = 0 \\implies k_{\\theta_1} = h_{22}\n$$\n$$\n\\frac{\\partial L_\\mathrm{I}}{\\partial k_{\\theta_2}} = -2(h_{33} - k_{\\theta_2}) = 0 \\implies k_{\\theta_2} = h_{33}\n$$\n最优参数就是目标QM Hessian矩阵的对角元素。优化后的I类Hessian矩阵`$\\mathbf{H}_\\mathrm{I}^*$`是`$\\mathbf{H}$`的对角部分。残差矩阵`$\\mathbf{R}_\\mathrm{I}^* = \\mathbf{H} - \\mathbf{H}_\\mathrm{I}^*$`仅由`$\\mathbf{H}$`的非对角元素组成。最小化的Frobenius范数平方是这些非对角元素的平方和：\n$$\n\\|\\mathbf{R}_\\mathrm{I}^*\\|_F^2 = \\sum_{i \\neq j} h_{ij}^2 = 2(h_{12}^2 + h_{13}^2 + h_{23}^2)\n$$\n因此，报告的残差范数为：\n$$\nr^\\mathrm{I} = \\|\\mathbf{R}_\\mathrm{I}^*\\|_F = \\sqrt{2(h_{12}^2 + h_{13}^2 + h_{23}^2)}\n$$\n\n### II类模型拟合\n\nII类模型的Hessian矩阵包括扭转-角耦合项，但不包括角-角耦合项：\n$$\n\\mathbf{H}_\\mathrm{II} = \\begin{pmatrix} k_\\phi & k_{\\phi\\theta_1} & k_{\\phi\\theta_2} \\\\ k_{\\phi\\theta_1} & k_{\\theta_1} & 0 \\\\ k_{\\phi\\theta_2} & 0 & k_{\\theta_2} \\end{pmatrix}\n$$\n残差的Frobenius范数平方为：\n$$\nL_\\mathrm{II}(k_\\phi, k_{\\theta_1}, k_{\\theta_2}, k_{\\phi\\theta_1}, k_{\\phi\\theta_2}) = \\sum_{i,j} (h_{ij} - (\\mathbf{H}_\\mathrm{II})_{ij})^2\n$$\n对于每个参数，最小化过程同样是可分离的。关于对角力常数`$k_\\phi, k_{\\theta_1}, k_{\\theta_2}$`的导数与I类情况相同，得到`$k_\\phi = h_{11}$`、`$k_{\\theta_1} = h_{22}$`和`$k_{\\theta_2} = h_{33}$`。对于非对角耦合常数：\n$$\n\\frac{\\partial L_\\mathrm{II}}{\\partial k_{\\phi\\theta_1}} = \\frac{\\partial}{\\partial k_{\\phi\\theta_1}} \\left[ (h_{12}-k_{\\phi\\theta_1})^2 + (h_{21}-k_{\\phi\\theta_1})^2 \\right] = -2(h_{12}-k_{\\phi\\theta_1}) -2(h_{21}-k_{\\phi\\theta_1}) = 0\n$$\n因为`$h_{12} = h_{21}$`，这简化为`$ -4(h_{12}-k_{\\phi\\theta_1}) = 0 \\implies k_{\\phi\\theta_1} = h_{12}$`。类似地，`$k_{\\phi\\theta_2} = h_{13}$`。\n\n最优参数是QM Hessian矩阵中对应的元素。该模型唯一无法捕捉的元素是角-角耦合项`$h_{23}$`和`$h_{32}$`。残差矩阵`$\\mathbf{R}_\\mathrm{II}^* = \\mathbf{H} - \\mathbf{H}_\\mathrm{II}^*$`为：\n$$\n\\mathbf{R}_\\mathrm{II}^* = \\begin{pmatrix} 0 & 0 & 0 \\\\ 0 & 0 & h_{23} \\\\ 0 & h_{32} & 0 \\end{pmatrix}\n$$\n最小化的Frobenius范数平方为`$\\|\\mathbf{R}_\\mathrm{II}^*\\|_F^2 = h_{23}^2 + h_{32}^2 = 2h_{23}^2$`。报告的残差范数为：\n$$\nr^\\mathrm{II} = \\|\\mathbf{R}_\\mathrm{II}^*\\|_F = \\sqrt{2h_{23}^2} = \\sqrt{2} |h_{23}|\n$$\n\n### 测试用例计算\n\n**测试用例1：** `$\\mathbf{H}^{(\\mathrm{QM})}_1 = \\begin{pmatrix} 5.0 & 0.5 & -0.4 \\\\ 0.5 & 20.0 & 0.3 \\\\ -0.4 & 0.3 & 18.0 \\end{pmatrix}$`\n这里，`$h_{12} = 0.5$`，`$h_{13} = -0.4$`，以及`$h_{23} = 0.3$`。\n- I类残差：`$r_1^\\mathrm{I} = \\sqrt{2(0.5^2 + (-0.4)^2 + 0.3^2)} = \\sqrt{2(0.25 + 0.16 + 0.09)} = \\sqrt{2(0.5)} = \\sqrt{1.0} = 1.0$`。\n- II类残差：`$r_1^\\mathrm{II} = \\sqrt{2}|0.3| \\approx 0.424264$`。\n\n**测试用例2：** `$\\mathbf{H}^{(\\mathrm{QM})}_2 = \\begin{pmatrix} 4.0 & 0.0 & 0.0 \\\\ 0.0 & 15.0 & 0.0 \\\\ 0.0 & 0.0 & 16.0 \\end{pmatrix}$`\n这里，`$h_{12} = 0.0$`，`$h_{13} = 0.0$`，以及`$h_{23} = 0.0$`。\n- I类残差：`$r_2^\\mathrm{I} = \\sqrt{2(0.0^2 + 0.0^2 + 0.0^2)} = 0.0$`。\n- II类残差：`$r_2^\\mathrm{II} = \\sqrt{2}|0.0| = 0.0$`。\n正如预期的，如果目标Hessian矩阵没有耦合，两种模型都能完美地再现它。\n\n**测试用例3：** `$\\mathbf{H}^{(\\mathrm{QM})}_3 = \\begin{pmatrix} 6.0 & 3.0 & -2.5 \\\\ 3.0 & 22.0 & 0.2 \\\\ -2.5 & 0.2 & 19.0 \\end{pmatrix}$`\n这里，`$h_{12} = 3.0$`，`$h_{13} = -2.5$`，以及`$h_{23} = 0.2$`。\n- I类残差：`$r_3^\\mathrm{I} = \\sqrt{2(3.0^2 + (-2.5)^2 + 0.2^2)} = \\sqrt{2(9.0 + 6.25 + 0.04)} = \\sqrt{2(15.29)} = \\sqrt{30.58} \\approx 5.529919$`。\n- II类残差：`$r_3^\\mathrm{II} = \\sqrt{2}|0.2| \\approx 0.282843$`。\n这个案例表明，当QM数据中存在强的扭转-角耦合时，II类模型的扭转-角耦合项能显著改善拟合效果。残差误差减少了近`$20$`倍。\n\n最终结果列表是`$[r_1^\\mathrm{I}, r_1^\\mathrm{II}, r_2^\\mathrm{I}, r_2^\\mathrm{II}, r_3^\\mathrm{I}, r_3^\\mathrm{II}]`。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the residual Frobenius norms for Class I and Class II force field\n    models fitted to target Quantum Mechanical Hessians.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # The Hessian matrices H_QM are given in units of kcal mol^-1 rad^-2.\n    # The coordinate order is (phi, theta_1, theta_2).\n    test_cases = [\n        # Test case 1 (typical coupling)\n        np.array([\n            [5.0, 0.5, -0.4],\n            [0.5, 20.0, 0.3],\n            [-0.4, 0.3, 18.0]\n        ]),\n        # Test case 2 (no coupling boundary)\n        np.array([\n            [4.0, 0.0, 0.0],\n            [0.0, 15.0, 0.0],\n            [0.0, 0.0, 16.0]\n        ]),\n        # Test case 3 (strong torsion-angle coupling edge)\n        np.array([\n            [6.0, 3.0, -2.5],\n            [3.0, 22.0, 0.2],\n            [-2.5, 0.2, 19.0]\n        ])\n    ]\n\n    results = []\n    for h_qm in test_cases:\n        # Extract the relevant off-diagonal elements from the QM Hessian.\n        # h_12 corresponds to the phi-theta_1 coupling.\n        h12 = h_qm[0, 1]\n        # h_13 corresponds to the phi-theta_2 coupling.\n        h13 = h_qm[0, 2]\n        # h_23 corresponds to the theta_1-theta_2 coupling.\n        h23 = h_qm[1, 2]\n\n        # Calculate residual for Class I model.\n        # The optimal Class I model is a diagonal matrix of the diagonal elements\n        # of H_QM. The residual norm is the Frobenius norm of the off-diagonal\n        # elements of H_QM.\n        # ||R_I||_F^2 = h12^2 + h21^2 + h13^2 + h31^2 + h23^2 + h32^2\n        # Since H_QM is symmetric, this is 2 * (h12^2 + h13^2 + h23^2).\n        residual_norm_sq_I = 2 * (h12**2 + h13**2 + h23**2)\n        residual_norm_I = np.sqrt(residual_norm_sq_I)\n        results.append(residual_norm_I)\n\n        # Calculate residual for Class II model.\n        # The optimal Class II model captures the diagonal and the phi-theta\n        # coupling terms (h12, h13). The only uncaptured term is the\n        # angle-angle coupling (h23).\n        # ||R_II||_F^2 = h23^2 + h32^2 = 2 * h23^2\n        residual_norm_sq_II = 2 * h23**2\n        residual_norm_II = np.sqrt(residual_norm_sq_II)\n        results.append(residual_norm_II)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3400982"}, {"introduction": "虽然第二类力场因其高精度而备受青睐，但在实际的分子动力学模拟中，它们与其它加速技术（如约束算法）的相互作用却并非一目了然。本练习[@problem_id:3400984]探讨了一个高级但至关重要的情景：当我们为了使用更大的时间步长而约束高频振动（例如，固定氢键键长）时，原本重要的交叉项会发生什么变化？通过分析这一思想实验，你将理解约束如何可能改变甚至消除交叉项的物理效应，这对于设计高效且物理上合理的模拟方案至关重要。", "problem": "在经典分子动力学 (MD) 中，诸如 SHAKE 约束算法 (SHAKE) 等约束可用于将选定的内坐标固定在指定值，从而从数值积分中移除快速的高频自由度。考虑一个由原子 $i$-$j$-$k$ 形成的单角自由度 $\\theta$，其中 $j$-$k$ 键（例如，与氢的键）的长度为 $r$。在 II 类力场中，这个三原子体系的势能由谐振键、谐振角和伸缩-弯曲交叉项之和建模，\n$$\nU(r,\\theta) \\;=\\; \\tfrac{1}{2} k_r \\,(r - r_0)^2 \\;+\\; \\tfrac{1}{2} k_\\theta \\,(\\theta - \\theta_0)^2 \\;+\\; k_{sb}\\,(r - r_0)\\,(\\theta - \\theta_0),\n$$\n其中 $k_r$、$k_\\theta$、$k_{sb}$ 是正常数，$r_0$、$\\theta_0$ 分别是参考键长和参考键角。假设完整约束在所有时间都将键长固定为 $r=r_c$（$r_c$ 可能等于 $r_0$ 也可能不等于），并考虑两种消除坐标 $r$ 的方法：\n- 精确完整约束：在时间上恒定地强制 $r=r_c$，并计算 $\\theta$ 上的广义力，即约束势相对于 $\\theta$ 的负梯度。\n- 绝热消除：将 $r$ 视为受 $\\theta$ 支配的快坐标，通过在固定 $\\theta$ 的情况下对 $U(r,\\theta)$ 关于 $r$ 进行最小化，并定义一个有效势 $U_{\\mathrm{eff}}(\\theta)=\\min_r U(r,\\theta)$。\n\n仅使用广义力、完整约束以及保守力与势能之间的负梯度关系的基本定义，推断在每种消除方案下，伸缩-弯曲交叉项如何改变有效角能量学，以及其贡献是否在简化描述中保留下来。下列哪些陈述是正确的？选择所有适用的选项。\n\nA. 在 $r=r_0$ 的精确完整约束下，伸缩-弯曲交叉项对角产生零广义力，不贡献能量；消除 $r$ 后，$\\theta$ 的剩余势是刚度为 $k_\\theta$ 的纯谐振势。\n\nB. 如果约束键长固定在值 $r_c \\neq r_0$，伸缩-弯曲交叉项会对角产生一个恒定的力矩，将有效平衡角移动 $\\Delta\\theta = -\\dfrac{k_{sb}}{k_\\theta}(r_c - r_0)$，而关于新最小值的曲率保持为 $k_\\theta$。\n\nC. 通过在固定 $\\theta$ 的情况下对能量关于 $r$ 进行最小化（快坐标的绝热消除）来消除键长，会产生一个有效角刚度 $k_\\theta^{\\mathrm{eff}} = k_\\theta - \\dfrac{k_{sb}^2}{k_r}$，这表明即使没有显式的 $r$，伸缩-弯曲耦合也以重整化的形式保留下来。\n\nD. 在有约束的情况下，无论 $r_c = r_0$ 是否成立，伸缩-弯曲耦合总是保留下来，并产生与绝热消除中相同的 $k_\\theta$ 重整化。\n\nE. 在没有任何显式交叉项的 I 类力场中，对与氢的键施加约束会通过拉格朗日乘子再现相同的重整化 $k_\\theta \\to k_\\theta - \\dfrac{k_{sb}^2}{k_r}$。", "solution": "我们从经典力学中保守力与势能的标准关系出发：与坐标共轭的广义力是势能相对于该坐标的负偏导数。对于角坐标，广义力为\n$$\nF_\\theta(r,\\theta) \\;=\\; -\\frac{\\partial U}{\\partial \\theta}.\n$$\n我们还使用完整约束的定义，即它将一个坐标固定为时间上的恒等式。在精确约束 $r=r_c$ 下，动力学在约束流形上演化，有效角力由 $U(r_c,\\theta)$ 计算得出。\n\n考虑势能\n$$\nU(r,\\theta) \\;=\\; \\tfrac{1}{2} k_r \\,(r - r_0)^2 \\;+\\; \\tfrac{1}{2} k_\\theta \\,(\\theta - \\theta_0)^2 \\;+\\; k_{sb}\\,(r - r_0)\\,(\\theta - \\theta_0).\n$$\n为简洁起见，定义 $x = r - r_0$ 和 $y = \\theta - \\theta_0$。则\n$$\nU(x,y) \\;=\\; \\tfrac{1}{2} k_r x^2 \\;+\\; \\tfrac{1}{2} k_\\theta y^2 \\;+\\; k_{sb}\\,x\\,y,\n$$\n角力为\n$$\nF_\\theta(x,y) \\;=\\; -\\frac{\\partial U}{\\partial \\theta} \\;=\\; -\\frac{\\partial U}{\\partial y} \\;=\\; -\\left(k_\\theta y + k_{sb} x\\right).\n$$\n\n在 $r=r_c$ 处的精确完整约束：\n- 如果 $r_c = r_0$，则在所有时间 $x = r_c - r_0 = 0$。交叉项 $k_{sb} x y$ 在约束势中恒等于零，广义力简化为\n$$\nF_\\theta \\;=\\; -k_\\theta y.\n$$\n约束势变为 $U_{\\mathrm{constr}}(\\theta) = \\tfrac{1}{2}k_\\theta y^2$，它在 $\\theta$ 上是纯谐振的，刚度为 $k_\\theta$。因此，当约束键被固定在其参考长度时，伸缩-弯曲的贡献在能量或力中均不复存在。\n\n- 如果 $r_c \\neq r_0$，则 $x = r_c - r_0$ 是一个非零常数。约束势为\n$$\nU_{\\mathrm{constr}}(\\theta) \\;=\\; \\tfrac{1}{2} k_r x^2 \\;+\\; \\tfrac{1}{2} k_\\theta y^2 \\;+\\; k_{sb} x y,\n$$\n其中 $\\tfrac{1}{2} k_r x^2$ 项是一个恒定偏移量。沿约束流形的广义角力为\n$$\nF_\\theta \\;=\\; -\\left(k_\\theta y + k_{sb} x\\right).\n$$\n令 $F_\\theta=0$，得到最小值在\n$$\ny^\\star \\;=\\; -\\frac{k_{sb}}{k_\\theta}\\,x \\;=\\; -\\frac{k_{sb}}{k_\\theta}\\,(r_c - r_0).\n$$\n关于该最小值的 $\\theta$ 曲率是二阶导数 $\\frac{\\partial^2 U_{\\mathrm{constr}}}{\\partial \\theta^2} = k_\\theta$，所以刚度保持为 $k_\\theta$。因此，非平衡约束通过来自交叉项的恒定力矩线性地移动平衡角，但不改变 $\\theta$ 曲率。\n\n通过对 $r$ 进行最小化实现的绝热消除：\n在该方案中，我们通过求解 $\\frac{\\partial U}{\\partial r} = 0$ 在固定 $\\theta$ 的情况下消除 $r$，这等价于 $\\frac{\\partial U}{\\partial x}=0$：\n$$\n\\frac{\\partial U}{\\partial x} \\;=\\; k_r x + k_{sb} y \\;=\\; 0 \\quad \\Rightarrow \\quad x^\\star(y) \\;=\\; -\\frac{k_{sb}}{k_r}\\,y.\n$$\n将 $x^\\star(y)$ 代入 $U(x,y)$ 得到 $\\theta$ 的有效势：\n\\begin{align*}\nU_{\\mathrm{eff}}(y) \n&= \\tfrac{1}{2} k_r \\left(x^\\star\\right)^2 + \\tfrac{1}{2} k_\\theta y^2 + k_{sb}\\,x^\\star\\,y \\\\\n&= \\tfrac{1}{2} k_r \\left(\\frac{k_{sb}^2}{k_r^2} y^2\\right) + \\tfrac{1}{2} k_\\theta y^2 - k_{sb}\\left(\\frac{k_{sb}}{k_r} y\\right) y \\\\\n&= \\tfrac{1}{2}\\left(\\frac{k_{sb}^2}{k_r}\\right) y^2 + \\tfrac{1}{2} k_\\theta y^2 - \\left(\\frac{k_{sb}^2}{k_r}\\right) y^2 \\\\\n&= \\tfrac{1}{2}\\left(k_\\theta - \\frac{k_{sb}^2}{k_r}\\right) y^2.\n\\end{align*}\n因此，即使 $r$ 已被消除，交叉项也以角刚度重整化的形式保留下来，\n$$\nk_\\theta^{\\mathrm{eff}} \\;=\\; k_\\theta - \\frac{k_{sb}^2}{k_r},\n$$\n注意这与在 $r=r_0$ 处的精确约束有定性差异：绝热消除允许 $r$ 与 $\\theta$ 一致地弛豫，而耦合降低了有效角刚度。相比之下，精确约束将 $r$ 固定在一个与 $\\theta$ 无关的常数上；如果该常数等于 $r_0$，则交叉项对 $\\theta$ 既不贡献能量也不贡献力。\n\n最后，考虑力场类型的作用。在 I 类力场中，势是可分离的，并且缺少 $r$ 和 $\\theta$ 之间的显式交叉项。因此，没有参数 $k_{sb}$，也没有伸缩-弯曲耦合可以进行重整化。强制约束的拉格朗日乘子引入内约束力以维持 $r=r_c$，但不会创造势能中不存在的新物理耦合；因此，在没有 $k_{sb}$ 的力场中，不会出现类似于 $k_{sb}^2/k_r$ 的重整化。\n\n逐项分析：\n- A：正确。当 $r=r_0$ 时，$x=0$ 恒成立，所以交叉项 $k_{sb} x y$ 及其对角力 $-k_{sb} x$ 的贡献都消失了。$\\theta$ 的约束势是纯粹的 $\\tfrac{1}{2}k_\\theta y^2$，刚度为 $k_\\theta$。\n\n- B：正确。当 $r_c \\neq r_0$ 时，$x$ 是一个非零常数。角力为 $-k_\\theta y - k_{sb} x$，这导致移动后的最小值为 $y^\\star = -(k_{sb}/k_\\theta)x = -(k_{sb}/k_\\theta)(r_c-r_0)$。$\\theta$ 的曲率保持为 $k_\\theta$。\n\n- C：正确。绝热消除得到 $x^\\star = -(k_{sb}/k_r) y$ 和 $U_{\\mathrm{eff}}(\\theta) = \\tfrac{1}{2}(k_\\theta - k_{sb}^2/k_r) y^2$，表明耦合以刚度重整化的形式保留下来。\n\n- D：不正确。在 $r=r_0$ 的精确约束下，耦合不复存在；没有重整化，只有一个刚度为 $k_\\theta$ 的纯谐振角项。重整化源于允许 $r$ 与 $\\theta$ 一致地弛豫，而这是约束所阻止的。\n\n- E：不正确。I 类力场缺少伸缩-弯曲交叉项 ($k_{sb}=0$)，因此没有机制可以生成重整化 $k_\\theta \\to k_\\theta - k_{sb}^2/k_r$。由拉格朗日乘子强制执行的约束力不会引入势能中不存在的新交叉项。", "answer": "$$\\boxed{ABC}$$", "id": "3400984"}]}