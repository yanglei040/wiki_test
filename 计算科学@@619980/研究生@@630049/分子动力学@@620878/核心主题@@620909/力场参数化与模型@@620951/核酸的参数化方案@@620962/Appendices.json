{"hands_on_practices": [{"introduction": "理解力场的基本组成部分，即非键合的范德华相互作用和库仑相互作用，是参数化研究的第一步。本练习提供了一个直接的计算机会，让学生能够亲手计算这些能量项，从而理解它们如何对分子间相互作用（例如此处的DNA碱基堆积）做出贡献，并体会不同能量项的相对重要性。通过这个基于第一性原理的计算，您可以为更复杂的自动化参数化协议打下坚实的基础。[@problem_id:3430376]", "problem": "在分子动力学(MD)核酸参数化方案的背景下，考虑一个堆叠的腺嘌呤-胸腺嘧啶二聚体的简化双位点粗粒化表示。每个核碱基由两个相互作用位点表示，其非键参数源于一个拟合量子力学目标数据的方案，并使用Lorentz–Berthelot混合规则将以原子为中心的范德华项与静电项结合。假设堆叠是平行的，并以物理上合理的平面间距分开，横向偏移反映在给定的位点间距中。使用标准的$12$–$6$ Lennard-Jones势、用于组合不同位点的Lorentz–Berthelot混合规则以及带点电荷的无屏蔽库仑相互作用。在与千焦耳每摩尔 (kJ mol$^{-1}$)、纳米 (nm) 和元电荷 ($e$) 兼容的单位中，库仑常数为 $k_{\\mathrm{c}} = 138.935456 \\,\\mathrm{kJ\\,mol^{-1}\\,nm\\,e^{-2}}$。能量必须以千焦耳每摩尔计算。\n\n两个相互作用对及其参数为：\n- 对1：腺嘌呤位点 $A_1$ 和胸腺嘧啶位点 $T_1$\n  - 部分电荷：$q_{A_1} = -0.01\\,e$, $q_{T_1} = +0.01\\,e$\n  - Lennard–Jones参数：$\\sigma_{A_1} = 0.340\\,\\mathrm{nm}$, $\\epsilon_{A_1} = 0.45\\,\\mathrm{kJ\\,mol^{-1}}$; $\\sigma_{T_1} = 0.340\\,\\mathrm{nm}$, $\\epsilon_{T_1} = 0.45\\,\\mathrm{kJ\\,mol^{-1}}$\n  - 位点间距：$r_1 = 0.350\\,\\mathrm{nm}$\n- 对2：腺嘌呤位点 $A_2$ 和胸腺嘧啶位点 $T_2$\n  - 部分电荷：$q_{A_2} = -0.03\\,e$, $q_{T_2} = +0.03\\,e$\n  - Lennard–Jones参数：$\\sigma_{A_2} = 0.325\\,\\mathrm{nm}$, $\\epsilon_{A_2} = 0.30\\,\\mathrm{kJ\\,mol^{-1}}$; $\\sigma_{T_2} = 0.296\\,\\mathrm{nm}$, $\\epsilon_{T_2} = 0.30\\,\\mathrm{kJ\\,mol^{-1}}$\n  - 位点间距：$r_2 = 0.370\\,\\mathrm{nm}$\n\n从$12$–$6$ Lennard-Jones势和库仑定律的基本定义出发，使用Lorentz–Berthelot混合规则获得每对的不同位点Lennard-Jones参数，然后计算堆叠二聚体相互作用能的Lennard-Jones贡献$E_{\\mathrm{LJ}}$和库仑贡献$E_{\\mathrm{C}}$：\n- 计算并求和 $E_{\\mathrm{LJ},1}$ 和 $E_{\\mathrm{LJ},2}$ 以获得 $E_{\\mathrm{LJ}}$。\n- 计算并求和 $E_{\\mathrm{C},1}$ 和 $E_{\\mathrm{C},2}$ 以获得 $E_{\\mathrm{C}}$。\n\n最后，报告量值比 $R = \\left|E_{\\mathrm{LJ}}\\right| / \\left|E_{\\mathrm{C}}\\right|$ 作为一个标量，该比例定量评估了哪个项在稳定化中占主导地位。将您的$R$最终值四舍五入到四位有效数字。将$R$表示为一个无量纲数。", "solution": "该问题被评估为有效，因为它具有科学依据、提法明确、客观且自洽。这是分子力学和生物物理化学领域的一个标准计算问题。所有必要的数据和常数都已提供，并且所需的计算也已明确规定。\n\n两个粗粒化核碱基之间的总相互作用能是Lennard-Jones ($E_{\\mathrm{LJ}}$)贡献和库仑 ($E_{\\mathrm{C}}$)贡献的总和。这些贡献是为两个相互作用对中的每一个计算然后相加的。\n\n两个相距为 $r$ 的位点之间的Lennard-Jones相互作用能 $E_{\\mathrm{LJ}}(r)$ 由 $12$–$6$ 势给出：\n$$E_{\\mathrm{LJ}}(r) = 4\\epsilon_{ij} \\left[ \\left(\\frac{\\sigma_{ij}}{r}\\right)^{12} - \\left(\\frac{\\sigma_{ij}}{r}\\right)^{6} \\right]$$\n其中 $\\sigma_{ij}$ 是势为零时的距离，$\\epsilon_{ij}$ 是相互作用位点对 $i$ 和 $j$ 的势阱深度。\n\n两个相距为 $r$ 的点电荷 $q_i$ 和 $q_j$ 之间的库仑相互作用能 $E_{\\mathrm{C}}(r)$ 由库仑定律给出：\n$$E_{\\mathrm{C}}(r) = k_{\\mathrm{c}} \\frac{q_i q_j}{r}$$\n其中 $k_{\\mathrm{c}}$ 是库仑常数，给定为 $k_{\\mathrm{c}} = 138.935456 \\,\\mathrm{kJ\\,mol^{-1}\\,nm\\,e^{-2}}$。\n\n不同位点间相互作用的参数 ($\\sigma_{ij}$ and $\\epsilon_{ij}$) 是使用Lorentz–Berthelot混合规则根据单个位点的参数 ($\\sigma_i$, $\\epsilon_i$ and $\\sigma_j$, $\\epsilon_j$) 确定的：\n$\\sigma_{ij}$ 的算术平均值：\n$$\\sigma_{ij} = \\frac{\\sigma_i + \\sigma_j}{2}$$\n$\\epsilon_{ij}$ 的几何平均值：\n$$\\epsilon_{ij} = \\sqrt{\\epsilon_i \\epsilon_j}$$\n\n我们现在将这些原理应用于每个相互作用对。\n\n对1：腺嘌呤位点 $A_1$ 和胸腺嘧啶位点 $T_1$。\n给定的参数是：\n$q_{A_1} = -0.01\\,e$, $q_{T_1} = +0.01\\,e$\n$\\sigma_{A_1} = 0.340\\,\\mathrm{nm}$, $\\epsilon_{A_1} = 0.45\\,\\mathrm{kJ\\,mol^{-1}}$\n$\\sigma_{T_1} = 0.340\\,\\mathrm{nm}$, $\\epsilon_{T_1} = 0.45\\,\\mathrm{kJ\\,mol^{-1}}$\n$r_1 = 0.350\\,\\mathrm{nm}$\n\n首先，我们计算 $A_1$-$T_1$ 对的混合Lennard-Jones参数：\n$\\sigma_1 = \\sigma_{A_1 T_1} = \\frac{\\sigma_{A_1} + \\sigma_{T_1}}{2} = \\frac{0.340\\,\\mathrm{nm} + 0.340\\,\\mathrm{nm}}{2} = 0.340\\,\\mathrm{nm}$\n$\\epsilon_1 = \\epsilon_{A_1 T_1} = \\sqrt{\\epsilon_{A_1} \\epsilon_{T_1}} = \\sqrt{(0.45\\,\\mathrm{kJ\\,mol^{-1}}) \\times (0.45\\,\\mathrm{kJ\\,mol^{-1}})} = 0.45\\,\\mathrm{kJ\\,mol^{-1}}$\n\n现在，我们计算对1的Lennard-Jones能量：\n$E_{\\mathrm{LJ},1} = 4\\epsilon_1 \\left[ \\left(\\frac{\\sigma_1}{r_1}\\right)^{12} - \\left(\\frac{\\sigma_1}{r_1}\\right)^{6} \\right]$\n$E_{\\mathrm{LJ},1} = 4(0.45) \\left[ \\left(\\frac{0.340}{0.350}\\right)^{12} - \\left(\\frac{0.340}{0.350}\\right)^{6} \\right]$\n$E_{\\mathrm{LJ},1} = 1.8 \\left[ (0.971428...)^{12} - (0.971428...)^{6} \\right]$\n$E_{\\mathrm{LJ},1} = 1.8 [0.705315... - 0.839830...] = 1.8(-0.134515...) = -0.242127...\\,\\mathrm{kJ\\,mol^{-1}}$\n\n接下来，我们计算对1的库仑能量：\n$E_{\\mathrm{C},1} = k_{\\mathrm{c}} \\frac{q_{A_1} q_{T_1}}{r_1} = (138.935456) \\frac{(-0.01\\,e)(+0.01\\,e)}{0.350\\,\\mathrm{nm}}$\n$E_{\\mathrm{C},1} = 138.935456 \\frac{-0.0001}{0.350} = -0.0396958...\\,\\mathrm{kJ\\,mol^{-1}}$\n\n对2：腺嘌呤位点 $A_2$ 和胸腺嘧啶位点 $T_2$。\n给定的参数是：\n$q_{A_2} = -0.03\\,e$, $q_{T_2} = +0.03\\,e$\n$\\sigma_{A_2} = 0.325\\,\\mathrm{nm}$, $\\epsilon_{A_2} = 0.30\\,\\mathrm{kJ\\,mol^{-1}}$\n$\\sigma_{T_2} = 0.296\\,\\mathrm{nm}$, $\\epsilon_{T_2} = 0.30\\,\\mathrm{kJ\\,mol^{-1}}$\n$r_2 = 0.370\\,\\mathrm{nm}$\n\n首先，我们计算 $A_2$-$T_2$ 对的混合Lennard-Jones参数：\n$\\sigma_2 = \\sigma_{A_2 T_2} = \\frac{\\sigma_{A_2} + \\sigma_{T_2}}{2} = \\frac{0.325\\,\\mathrm{nm} + 0.296\\,\\mathrm{nm}}{2} = 0.3105\\,\\mathrm{nm}$\n$\\epsilon_2 = \\epsilon_{A_2 T_2} = \\sqrt{\\epsilon_{A_2} \\epsilon_{T_2}} = \\sqrt{(0.30\\,\\mathrm{kJ\\,mol^{-1}}) \\times (0.30\\,\\mathrm{kJ\\,mol^{-1}})} = 0.30\\,\\mathrm{kJ\\,mol^{-1}}$\n\n现在，我们计算对2的Lennard-Jones能量：\n$E_{\\mathrm{LJ},2} = 4\\epsilon_2 \\left[ \\left(\\frac{\\sigma_2}{r_2}\\right)^{12} - \\left(\\frac{\\sigma_2}{r_2}\\right)^{6} \\right]$\n$E_{\\mathrm{LJ},2} = 4(0.30) \\left[ \\left(\\frac{0.3105}{0.370}\\right)^{12} - \\left(\\frac{0.3105}{0.370}\\right)^{6} \\right]$\n$E_{\\mathrm{LJ},2} = 1.2 \\left[ (0.839189...)^{12} - (0.839189...)^{6} \\right]$\n$E_{\\mathrm{LJ},2} = 1.2 [0.121800... - 0.349000...] = 1.2(-0.227200...) = -0.272640...\\,\\mathrm{kJ\\,mol^{-1}}$\n\n接下来，我们计算对2的库仑能量：\n$E_{\\mathrm{C},2} = k_{\\mathrm{c}} \\frac{q_{A_2} q_{T_2}}{r_2} = (138.935456) \\frac{(-0.03\\,e)(+0.03\\,e)}{0.370\\,\\mathrm{nm}}$\n$E_{\\mathrm{C},2} = 138.935456 \\frac{-0.0009}{0.370} = -0.338271...\\,\\mathrm{kJ\\,mol^{-1}}$\n\n总能量通过将每对的贡献相加得到。\n总Lennard-Jones能量：\n$E_{\\mathrm{LJ}} = E_{\\mathrm{LJ},1} + E_{\\mathrm{LJ},2} = (-0.242127...) + (-0.272640...) = -0.514767...\\,\\mathrm{kJ\\,mol^{-1}}$\n\n总库仑能量：\n$E_{\\mathrm{C}} = E_{\\mathrm{C},1} + E_{\\mathrm{C},2} = (-0.0396958...) + (-0.338271...) = -0.377967...\\,\\mathrm{kJ\\,mol^{-1}}$\n\n最后，我们计算量值比 $R = \\left|E_{\\mathrm{LJ}}\\right| / \\left|E_{\\mathrm{C}}\\right|$：\n$R = \\frac{|-0.514767...\\,\\mathrm{kJ\\,mol^{-1}}|}{|-0.377967...\\,\\mathrm{kJ\\,mol^{-1}}|}$\n$R = \\frac{0.514767...}{0.377967...} = 1.361937...$\n\n问题要求将$R$的最终值四舍五入到四位有效数字。\n$R \\approx 1.362$\n这个比值大于1，表明在这个特定的粗粒化模型和几何结构中，Lennard-Jones项对吸引稳定能的贡献大于静电项。", "answer": "$$\\boxed{1.362}$$", "id": "3430376"}, {"introduction": "一个可靠的力场参数不仅需要理论上的自洽，更必须能够复现实验观测结果。本练习将引导您完成一个关键的参数验证工作流程：调整一个敏感的参数（如1-4非键相互作用的缩放因子），观察其对模拟构象系综（核糖环的构象）的影响，并将计算得到的系综平均性质（NMR J-耦合常数）与实验值进行定量比较。这个过程体现了参数化研究中连接理论模型与真实世界数据的迭代优化核心思想。[@problem_id:3430408]", "problem": "您的任务是编写一个完整、可运行的程序，该程序使用一个简化但有科学依据的方案，模拟1–4非键相互作用标度对核糖环构象平衡以及系综平均的核磁共振（NMR）标量耦合的影响。该方案与用于核酸的分子动力学（MD）力场的参数化方案保持一致。\n\n您必须使用的基本原理包括：(i) 通过玻尔兹曼分布的经典统计力学，(ii) 用于系综平均的叠加原理，以及 (iii) 用于NMR中邻位标量耦合的Karplus关系式。基于这些原理，推导出用于计算作为能量函数的系综布居以及从这些布居计算平均可观测量的算法。\n\n假设核糖环的伪旋转采用一个三态构象模型，构象异构体由 $i \\in \\{1,2,3\\}$ 标记，其中 $i=1$ 对应C3′-endo，$i=2$ 对应C2′-endo，以及 $i=3$ 对应O4′-endo。在给定的1–4标度下，构象异构体 $i$ 的总势能为\n$$\nE_i(S_\\text{elec}, S_\\text{LJ}) = E_i^{(0)} + S_\\text{elec}\\,E_{i,\\text{elec}}^{(1\\text{–}4)} + S_\\text{LJ}\\,E_{i,\\text{LJ}}^{(1\\text{–}4)}\n$$\n其中 $E_i^{(0)}$ 是构象异构体 $i$ 不包括1–4非键项的基线分子内能量，$E_{i,\\text{elec}}^{(1\\text{–}4)}$ 和 $E_{i,\\text{LJ}}^{(1\\text{–}4)}$ 分别是构象异构体 $i$ 的静电和Lennard–Jones（LJ）1–4相互作用贡献，$S_\\text{elec}$ 和 $S_\\text{LJ}$ 分别是静电和Lennard–Jones 1–4标度因子。\n\n使用以下物理上合理的参数，能量单位为千焦每摩尔，温度单位为开尔文：\n- 温度 $T = 298$。\n- 气体常数 $R = 8.314462618\\times 10^{-3}$。\n- 基线能量：$E_1^{(0)} = 0.0$， $E_2^{(0)} = 0.8$， $E_3^{(0)} = 4.0$。\n- 静电1–4项：$E_{1,\\text{elec}}^{(1\\text{–}4)} = -0.6$， $E_{2,\\text{elec}}^{(1\\text{–}4)} = -0.2$， $E_{3,\\text{elec}}^{(1\\text{–}4)} = -0.1$。\n- Lennard–Jones 1–4项：$E_{1,\\text{LJ}}^{(1\\text{–}4)} = 0.4$， $E_{2,\\text{LJ}}^{(1\\text{–}4)} = 0.1$， $E_{3,\\text{LJ}}^{(1\\text{–}4)} = 0.2$。\n\n设两个邻位质子-质子耦合的特定构象异构体的二面角（单位：度）为：\n- 对于 $\\,^3J_{\\text{H1′–H2′}}$：$\\varphi_{12}^{(1)} = 60$， $\\varphi_{12}^{(2)} = 180$， $\\varphi_{12}^{(3)} = 300$。\n- 对于 $\\,^3J_{\\text{H3′–H4′}}$：$\\varphi_{34}^{(1)} = 180$， $\\varphi_{34}^{(2)} = 60$， $\\varphi_{34}^{(3)} = 300$。\n\n使用以下形式的Karplus关系式计算邻位耦合\n$$\nJ(\\varphi) = A\\cos^2(\\varphi) + B\\cos(\\varphi) + C\n$$\n其中参数为 $A = 7.09$，$B = -1.42$，$C = 1.77$，并且在计算余弦函数时将 $\\varphi$ 解释为弧度。得到的 $J$ 值必须以赫兹为单位计算。对于每个构象异构体 $i$，耦合值为 $J_{12}^{(i)} = J(\\varphi_{12}^{(i)})$ 和 $J_{34}^{(i)} = J(\\varphi_{34}^{(i)})$。\n\n构象异构体的布居由玻尔兹曼分布确定。定义 $\\beta = 1/(RT)$ 和未归一化权重 $w_i = \\exp\\!\\big(-\\beta\\,E_i(S_\\text{elec}, S_\\text{LJ})\\big)$。构象异构体 $i$ 的归一化布居为 $p_i = w_i / \\sum_{j=1}^{3} w_j$。系综平均耦合为\n$$\n\\langle J_{12} \\rangle = \\sum_{i=1}^{3} p_i J_{12}^{(i)}, \\qquad \\langle J_{34} \\rangle = \\sum_{i=1}^{3} p_i J_{34}^{(i)}\n$$\n\n将这些系综平均耦合与固定的实验参考值（单位：赫兹）进行比较：\n- $J_{12}^{\\text{(exp)}} = 5.50$，\n- $J_{34}^{\\text{(exp)}} = 6.90$。\n\n按如下方式计算均方根误差（RMSE），单位为赫兹：\n$$\n\\text{RMSE} = \\sqrt{\\frac{1}{2}\\left( (\\langle J_{12} \\rangle - J_{12}^{\\text{(exp)}})^2 + (\\langle J_{34} \\rangle - J_{34}^{\\text{(exp)}})^2 \\right)}\n$$\n\n对于每个指定的测试用例，您的程序必须以浮点数的形式计算RMSE（单位：赫兹）。角度在输入时必须以度为单位处理，但在进行三角函数求值时需转换为弧度，能量必须以千焦每摩尔为单位处理。使用 $T = 298$ 和 $R = 8.314462618\\times 10^{-3}$ 计算 $\\beta$，并以浮点数形式表示最终的RMSE结果（单位：赫兹）。\n\n测试套件：评估以下四个标度因子对 $(S_\\text{elec}, S_\\text{LJ})$：\n1. $(1.0, 1.0)$，\n2. $(0.8333333333, 0.5)$，\n3. $(0.0, 0.0)$，\n4. $(1.2, 1.2)$。\n\n最终输出格式：您的程序应生成单行输出，其中包含四个RMSE结果，顺序与上述测试用例相同，形式为逗号分隔的列表并用方括号括起，例如 $\\texttt{[r_1,r_2,r_3,r_4]}$。每个 $r_k$ 都必须是浮点数。不应打印任何其他文本。所有数值答案均以赫兹为单位，并且必须在此单行输出中表示为十进制浮点值。", "solution": "该问题已经过验证，并被确定为科学上合理、良构且完整。所有必要的数据和定义均已提供，以获得唯一且有意义的解。该问题模拟了计算生物物理学中用于力场参数化的一个标准流程，其基础是统计力学原理及其在结构生物学中的应用。\n\n解将通过系统地应用所提供的原理和方程推导得出。目标是为一组标度因子 $(S_\\text{elec}, S_\\text{LJ})$ 计算计算出的NMR J-耦合与实验值之间的均方根误差（RMSE）。该框架涉及一个用于核糖环构象的三态模型。\n\n首先，我们确定整个计算过程中使用的常数。给定温度为 $T = 298 \\text{ K}$，气体常数为 $R = 8.314462618 \\times 10^{-3} \\text{ kJ mol}^{-1} \\text{K}^{-1}$。由此，我们定义热能项 $\\beta = 1/(RT)$。\n$$\n\\beta = \\frac{1}{RT} = \\frac{1}{(8.314462618 \\times 10^{-3} \\text{ kJ mol}^{-1} \\text{K}^{-1}) \\times (298 \\text{ K})} \\approx 0.403597 \\text{ mol kJ}^{-1}\n$$\n\n模型的核心由三个不同的构象态组成，由 $i \\in \\{1, 2, 3\\}$ 索引。每个态 $i$ 的势能是1–4非键相互作用标度因子 $S_\\text{elec}$ 和 $S_\\text{LJ}$ 的函数。能量由以下线性组合给出：\n$$\nE_i(S_\\text{elec}, S_\\text{LJ}) = E_i^{(0)} + S_\\text{elec}\\,E_{i,\\text{elec}}^{(1\\text{–}4)} + S_\\text{LJ}\\,E_{i,\\text{LJ}}^{(1\\text{–}4)}\n$$\n此处，$E_i^{(0)}$ 是基线能量，$E_{i,\\text{elec}}^{(1\\text{–}4)}$ 和 $E_{i,\\text{LJ}}^{(1\\text{–}4)}$ 分别是静电和Lennard-Jones 1–4相互作用能。为三个态提供的参数如下（单位均为 kJ/mol）：\n- 态 $i=1$ (C3′-endo): $E_1^{(0)} = 0.0$, $E_{1,\\text{elec}}^{(1\\text{–}4)} = -0.6$, $E_{1,\\text{LJ}}^{(1\\text{–}4)} = 0.4$。\n- 态 $i=2$ (C2′-endo): $E_2^{(0)} = 0.8$, $E_{2,\\text{elec}}^{(1\\text{–}4)} = -0.2$, $E_{2,\\text{LJ}}^{(1\\text{–}4)} = 0.1$。\n- 态 $i=3$ (O4′-endo): $E_3^{(0)} = 4.0$, $E_{3,\\text{elec}}^{(1\\text{–}4)} = -0.1$, $E_{3,\\text{LJ}}^{(1\\text{–}4)} = 0.2$。\n\n根据统计力学原理，每个态 $i$ 在热平衡时的布居 $p_i$ 由其玻尔兹曼权重决定。未归一化的权重 $w_i$ 由该态的能量 $E_i$ 计算得出：\n$$\nw_i = \\exp(-\\beta E_i)\n$$\n然后，通过将单个权重除以所有权重之和（配分函数 $Z = \\sum_{j=1}^{3} w_j$），找到归一化的布居 $p_i$：\n$$\np_i = \\frac{w_i}{\\sum_{j=1}^{3} w_j}\n$$\n由于能量 $E_i$ 依赖于标度因子 $(S_\\text{elec}, S_\\text{LJ})$，因此布居也依赖于这些因子。\n\n接下来，我们将每个构象异构体的结构与一个可观测量——NMR标量耦合 $J$ 联系起来。Karplus关系式提供了一个函数，可将邻位二面角 $\\varphi$ 映射到一个J-耦合值：\n$$\nJ(\\varphi) = A\\cos^2(\\varphi) + B\\cos(\\varphi) + C\n$$\n给定的参数为 $A = 7.09$，$B = -1.42$，$C = 1.77$。输入的二面角单位为度，在计算余弦函数时必须通过 $\\varphi_{\\text{rad}} = \\varphi_{\\text{deg}} \\times \\pi / 180$ 转换为弧度。\n\n问题定义了两个特定的耦合，$\\,^3J_{\\text{H1′–H2′}}$ 和 $\\,^3J_{\\text{H3′–H4′}}$，它们分别依赖于每个态 $i$ 的二面角 $\\varphi_{12}^{(i)}$ 和 $\\varphi_{34}^{(i)}$。我们预先计算这些特定于状态的耦合值 $J_{12}^{(i)}$ 和 $J_{34}^{(i)}$，因为它们与标度因子无关。\n\n对于 $\\,^3J_{\\text{H1′–H2′}}$：\n- $J_{12}^{(1)} = J(60^\\circ) = J(\\pi/3 \\text{ rad}) = 7.09\\cos^2(\\pi/3) - 1.42\\cos(\\pi/3) + 1.77 = 7.09(0.5)^2 - 1.42(0.5) + 1.77 = 2.8325 \\text{ Hz}$。\n- $J_{12}^{(2)} = J(180^\\circ) = J(\\pi \\text{ rad}) = 7.09\\cos^2(\\pi) - 1.42\\cos(\\pi) + 1.77 = 7.09(-1)^2 - 1.42(-1) + 1.77 = 10.28 \\text{ Hz}$。\n- $J_{12}^{(3)} = J(300^\\circ) = J(5\\pi/3 \\text{ rad}) = 7.09\\cos^2(5\\pi/3) - 1.42\\cos(5\\pi/3) + 1.77 = 7.09(0.5)^2 - 1.42(0.5) + 1.77 = 2.8325 \\text{ Hz}$。\n\n对于 $\\,^3J_{\\text{H3′–H4′}}$：\n- $J_{34}^{(1)} = J(180^\\circ) = 10.28 \\text{ Hz}$。\n- $J_{34}^{(2)} = J(60^\\circ) = 2.8325 \\text{ Hz}$。\n- $J_{34}^{(3)} = J(300^\\circ) = 2.8325 \\text{ Hz}$。\n\n实验测量的J-耦合是所有热可及构象的系综平均。系综平均耦合 $\\langle J_{12} \\rangle$ 和 $\\langle J_{34} \\rangle$ 是通过对特定于状态的耦合进行加权平均来计算的，其中权重是布居 $p_i$：\n$$\n\\langle J_{12} \\rangle = \\sum_{i=1}^{3} p_i J_{12}^{(i)}\n\\qquad\n\\langle J_{34} \\rangle = \\sum_{i=1}^{3} p_i J_{34}^{(i)}\n$$\n\n最后，我们通过将计算出的系综平均值与固定的实验参考值（$J_{12}^{\\text{(exp)}} = 5.50 \\text{ Hz}$ 和 $J_{34}^{\\text{(exp)}} = 6.90 \\text{ Hz}$）进行比较，来评估我们模型在给定标度因子 $(S_\\text{elec}, S_\\text{LJ})$ 下的质量。偏差由均方根误差（RMSE）量化：\n$$\n\\text{RMSE} = \\sqrt{\\frac{1}{2}\\left( (\\langle J_{12} \\rangle - J_{12}^{\\text{(exp)}})^2 + (\\langle J_{34} \\rangle - J_{34}^{\\text{(exp)}})^2 \\right)}\n$$\n\n对于每个测试用例 $(S_\\text{elec}, S_\\text{LJ})$ 的算法流程如下：\n$1$. 对于每个构象异构体 $i \\in \\{1, 2, 3\\}$，计算总能量 $E_i(S_\\text{elec}, S_\\text{LJ})$。\n$2$. 使用这些能量计算玻尔兹曼权重 $w_i$ 并将其归一化以获得布居 $p_i$。\n$3$. 使用预先计算的 $J^{(i)}$ 值和计算出的布居 $p_i$ 来计算系综平均耦合 $\\langle J_{12} \\rangle$ 和 $\\langle J_{34} \\rangle$。\n$4$. 通过将平均耦合与实验目标值进行比较，计算最终的RMSE值。\n\n此流程将针对四个指定的标度因子对进行实现。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the RMSE between calculated and experimental NMR J-couplings\n    for a three-state ribose model as a function of 1-4 scaling factors.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.0, 1.0),\n        (0.8333333333, 0.5),\n        (0.0, 0.0),\n        (1.2, 1.2),\n    ]\n\n    # --- Constants and Physical Parameters ---\n    T = 298.0  # Temperature in Kelvin\n    R = 8.314462618e-3  # Gas constant in kJ/mol/K\n    beta = 1.0 / (R * T)  # Thermal energy term in (kJ/mol)^-1\n\n    # --- Energy Parameters (in kJ/mol) ---\n    # Rows correspond to states i=1, 2, 3. Columns are E0, E_elec, E_lj.\n    energy_params = np.array([\n        # E_i^(0), E_{i,elec}^{(1-4)}, E_{i,LJ}^{(1-4)}\n        [0.0, -0.6, 0.4],  # State 1: C3'-endo\n        [0.8, -0.2, 0.1],  # State 2: C2'-endo\n        [4.0, -0.1, 0.2],  # State 3: O4'-endo\n    ])\n    E0 = energy_params[:, 0]\n    E_elec_14 = energy_params[:, 1]\n    E_lj_14 = energy_params[:, 2]\n\n    # --- Karplus Relation Parameters and Angles ---\n    A_karp, B_karp, C_karp = 7.09, -1.42, 1.77  # J in Hz\n\n    # Dihedral angles for each conformer (in degrees)\n    phi_12_deg = np.array([60.0, 180.0, 300.0])  # For J_H1'-H2'\n    phi_34_deg = np.array([180.0, 60.0, 300.0])  # For J_H3'-H4'\n\n    # Convert angles to radians for trigonometric functions\n    phi_12_rad = np.deg2rad(phi_12_deg)\n    phi_34_rad = np.deg2rad(phi_34_deg)\n\n    # --- Experimental Data ---\n    J12_exp = 5.50  # Hz\n    J34_exp = 6.90  # Hz\n\n    # --- Pre-computation of State-Specific J-Couplings ---\n    def karplus(phi_rad, A, B, C):\n        \"\"\"Calculates J-coupling from dihedral angle using the Karplus relation.\"\"\"\n        cos_phi = np.cos(phi_rad)\n        return A * cos_phi**2 + B * cos_phi + C\n\n    # J-couplings for each of the 3 conformers\n    J12_conf = karplus(phi_12_rad, A_karp, B_karp, C_karp)\n    J34_conf = karplus(phi_34_rad, A_karp, B_karp, C_karp)\n\n    results = []\n    for S_elec, S_LJ in test_cases:\n        # Step 1: Calculate total energy for each conformer\n        E_total = E0 + S_elec * E_elec_14 + S_LJ * E_lj_14\n\n        # Step 2: Calculate Boltzmann weights and populations\n        weights = np.exp(-beta * E_total)\n        populations = weights / np.sum(weights)\n\n        # Step 3: Calculate ensemble-averaged J-couplings\n        J12_avg = np.sum(populations * J12_conf)\n        J34_avg = np.sum(populations * J34_conf)\n\n        # Step 4: Compute the Root-Mean-Square Error (RMSE)\n        err_sq_12 = (J12_avg - J12_exp)**2\n        err_sq_34 = (J34_avg - J34_exp)**2\n        rmse = np.sqrt(0.5 * (err_sq_12 + err_sq_34))\n        results.append(rmse)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3430408"}, {"introduction": "一个强大的力场需要其参数在不同的分子环境中具有良好的可移植性（transferability）。这项高级练习模拟了一个完整的核酸关键二面角重参数化流程，其中使用了更为真实的多维量子化学扫描数据。本练习的重点不仅在于拟合一个耦合的势能面，更在于检验所推导参数在不同DNA构象（A型、B型和Z型DNA）中的可移植性，这是衡量参数集质量的最终标准。[@problem_id:3430379]", "problem": "要求您设计并实现一个完整且可测试的、针对核酸中糖苷扭转角 $\\chi$ 的参数化流程。该流程使用基于糖环褶皱与 $\\chi$ 的二维量子力学 (QM) 扫描，然后评估其对典型的 A-、B- 和 Z-型糖环褶皱构象的可移植性。其科学背景是分子动力学 (MD) 力场参数化，其中扭转势由扭转角的截断傅里叶级数表示，并且可能存在与糖环褶皱坐标的势耦合。\n\n从以下基本原理和核心定义开始：\n- 在经典分子力学中，势能被分解为总和 $E = E_{\\text{bond}} + E_{\\text{angle}} + E_{\\text{dihedral}} + E_{\\text{nonbonded}}$，其中像 $\\chi$ 这样的二面角的 $E_{\\text{dihedral}}$ 通常由周期函数表示。\n- 对于周期性扭转，一种经过充分检验的表示方法是截断傅里叶级数。对于单个扭转角 $\\chi$，这可以写成一个截至选定阶数 $N$ 的有限余弦和正弦项之和，其系数待从数据中拟合。\n- 如果扭转角与一个正交坐标（此处为糖环褶皱伪旋转角 $P$）弱耦合，可以通过在线性模型中包含每个 $P$ 的偏移量，将依赖于 $P$ 的偏移量从依赖于 $\\chi$ 的傅里叶级数中分离出来。这利用了能量贡献的可加性，并为可移植性测试分离出依赖于 $\\chi$ 的部分。\n\n您将实施以下建模和拟合方法：\n1. 将模型能量表示为 $E_{\\text{model}}(P_i, \\chi_j) = c_i + \\sum_{n=1}^{N} \\left( A_n \\cos(n \\chi_j) + B_n \\sin(n \\chi_j) \\right)$，其中 $c_i$ 是第 $i$ 个采样伪旋转角 $P_i$ 的特定于糖环褶皱的偏移量，而 $A_n, B_n$ 是与 $P$ 无关的全局 $\\chi$ 扭转傅里叶系数。角度单位必须是弧度，能量单位必须是千焦/摩尔 (kJ/mol)。\n2. 通过最小化所有采样 $(P_i, \\chi_j)$ 对的残差平方和，将未知数 $\\{A_n, B_n\\}_{n=1}^{N}$ 和 $\\{c_i\\}$ 拟合到一个人造 QM 能量网格 $E_{\\text{QM}}(P_i, \\chi_j)$。这是一个关于未知系数的线性最小二乘问题。\n3. 通过仅使用依赖于 $\\chi$ 的傅里叶分量（对于新的 $P$，偏移量 $c_i$ 是未知的），预测代表 A-、B- 和 Z-型糖环褶皱的测试伪旋转角下的相对 $\\chi$ 能量剖面，以此评估可移植性。将任意角度 $\\tilde{P}$ 的相对能量定义为 $\\Delta E(\\tilde{P}, \\chi) = E(\\tilde{P}, \\chi) - \\langle E(\\tilde{P}, \\chi) \\rangle_{\\chi}$，其中 $\\langle \\cdot \\rangle_{\\chi}$ 表示在 $\\chi$ 网格上的平均值。对于每个测试的 $\\tilde{P}$，计算预测的相对剖面与真实的相对剖面之间的均方根误差 (RMSE)，单位为 kJ/mol。\n\n您的程序应：\n- 为模型使用阶数为 $N = 3$ 的截断傅里叶级数，因此基函数为 $\\cos(\\chi)$, $\\sin(\\chi)$, $\\cos(2 \\chi)$, $\\sin(2 \\chi)$, $\\cos(3 \\chi)$, $\\sin(3 \\chi)$。\n- 使用一个包含 $M = 5$ 个值的训练伪旋转网格，定义为 $P_i = 0.2\\pi + i \\cdot 0.3\\pi$，其中 $i \\in \\{0,1,2,3,4\\}$。\n- 使用一个包含 $N_{\\chi} = 24$ 个角度的 $\\chi$ 网格，定义为 $\\chi_j = -\\pi + \\dfrac{2\\pi j}{N_{\\chi}}$，其中 $j \\in \\{0,1,\\dots,N_{\\chi}-1\\}$。\n- 使用以下代表性的测试伪旋转角进行可移植性评估：$P_{\\mathrm{A}} = \\pi/10$ (A-型，近似于 $\\text{C3'-endo}$)，$P_{\\mathrm{B}} = 9\\pi/10$ (B-型，近似于 $\\text{C2'-endo}$)，以及 $P_{\\mathrm{Z}} = 4\\pi/9$ (Z-型代表)。\n- 使用已知的“真实”参数生成人造 QM 能量，以实现一个可控且可测试的工作流程。所有能量单位必须为 $\\mathrm{kJ/mol}$，角度单位必须为弧度。定义一个基线仅糖环偏移量 $C_0(P) = 1.5 \\cos(P) + 0.5 \\sin(2P)$ 和基线 $\\chi$-级数系数 $\\{a_n\\}_{n=1}^{3}$ 和 $\\{b_n\\}_{n=1}^{3}$，其中 $a_1 = 2.0$, $b_1 = -1.0$, $a_2 = 0.5$, $b_2 = 0.2$, $a_3 = 0.3$, $b_3 = -0.1$。按如下方式为三个独立的测试案例构建“真实”能量 $E_{\\text{true}}(P,\\chi)$：\n  - 案例 1 (无耦合，模型类别匹配)：\n    $$E_{\\text{true}}(P,\\chi) = C_0(P) + \\sum_{n=1}^{3} \\left( a_n \\cos(n\\chi) + b_n \\sin(n\\chi) \\right).$$\n  - 案例 2 (模型中未包含的轻微 $P$–$\\chi$ 耦合)：\n    $$E_{\\text{true}}(P,\\chi) = C_0(P) + \\sum_{n=1}^{3} \\left( a_n \\cos(n\\chi) + b_n \\sin(n\\chi) \\right) + 0.6 \\sin(P)\\cos(\\chi).$$\n  - 案例 3 (模型中未包含的高阶谐波和 $P$–$\\chi$ 耦合)：\n    $$E_{\\text{true}}(P,\\chi) = C_0(P) + \\sum_{n=1}^{3} \\left( a_n \\cos(n\\chi) + b_n \\sin(n\\chi) \\right) + 0.7 \\cos(4\\chi) + 0.4 \\cos(2P)\\sin(2\\chi).$$\n  在所有案例中，$E_{\\text{true}}$ 的单位均为 $\\mathrm{kJ/mol}$。\n\n对于上述三个案例中的每一个：\n- 使用训练网格 $\\{P_i,\\chi_j\\}$ 拟合 $\\{A_n,B_n\\}$ 和 $\\{c_i\\}$。\n- 使用拟合的 $\\{A_n,B_n\\}$ 预测在 $P_{\\mathrm{A}}$, $P_{\\mathrm{B}}$, 和 $P_{\\mathrm{Z}}$ 处的相对 $\\chi$ 剖面，并计算相对于从这些 $P$ 值的 $E_{\\text{true}}$ 计算出的真实相对剖面的 RMSE，单位为 $\\mathrm{kJ/mol}$。\n\n角度单位必须是弧度。能量单位必须是 $\\mathrm{kJ/mol}$。以 $\\mathrm{kJ/mol}$ 为单位报告 RMSE 值，并四舍五入到 4 位小数。\n\n测试套件和最终输出规范：\n- 精确按照描述实现这三个合成案例。\n- 您的程序必须输出一个单行，其中包含一个用方括号括起来的逗号分隔列表，该列表包含三个子列表，每个案例一个，每个子列表按 $[\\mathrm{RMSE}_{\\mathrm{A}}, \\mathrm{RMSE}_{\\mathrm{B}}, \\mathrm{RMSE}_{\\mathrm{Z}}]$ 排序。\n- 最终输出格式必须是单行，例如：\n  `[[x_1A,x_1B,x_1Z],[x_2A,x_2B,x_2Z],[x_3A,x_3B,x_3Z]]`\n  其中每个 $x$ 是一个四舍五入到 4 位小数的十进制浮点数。输出字符串中不能有空格。", "solution": "该问题是有效的，因为它提出了一个在计算化学和数值方法领域中具有科学依据、提法得当且客观的练习。它详细描述了一个标准的力场参数化工作流程，包括数据生成、通过线性最小二乘法进行模型拟合以及可移植性评估。所有定义、常数和程序都已明确说明，构成了一个自成体系且可验证的问题。\n\n解决方案首先为势能面构建一个线性模型，然后将其拟合到人造数据。接着，通过预测新系统构象的能量剖面来评估拟合参数的可移植性。\n\n### 1. 模型公式化与线性最小二乘法\n\n该问题要求将核酸系统的势能 $E$ 参数化为糖环褶皱伪旋转角 $P$ 和糖苷扭转角 $\\chi$ 的函数。所提出的模型将能量分离为一个依赖于糖环褶皱的偏移量和一个全局依赖于 $\\chi$ 的扭转项：\n$$E_{\\text{model}}(P_i, \\chi_j) = c_i + \\sum_{n=1}^{N} \\left( A_n \\cos(n \\chi_j) + B_n \\sin(n \\chi_j) \\right)$$\n此处，$c_i$ 是特定糖环褶皱 $P_i$ 的恒定能量偏移量，而 $\\{A_n, B_n\\}$ 是扭转势的傅里叶系数，假设与 $P$ 无关。傅里叶级数在阶数 $N=3$ 处截断。待确定的参数是 $M=5$ 个偏移量 $\\{c_i\\}_{i=0}^{M-1}$ 和 $2N = 6$ 个傅里叶系数 $\\{A_n, B_n\\}_{n=1}^{N}$。\n\n该模型对于其 $M + 2N = 11$ 个未知参数是线性的。因此，拟合过程可以被视为一个线性最小二乘问题。给定一组 $K = M \\times N_{\\chi} = 5 \\times 24 = 120$ 个量子力学 (QM) 能量值 $E_{\\text{QM}}(P_i, \\chi_j)$，我们的目标是找到使残差平方和最小化的参数向量 $\\mathbf{p}$。该问题用矩阵形式表示为：\n$$ \\mathbf{E}_{\\text{data}} \\approx \\mathbf{Xp} $$\n其中 $\\mathbf{E}_{\\text{data}}$ 是包含 $K$ 个 QM 能量值的向量，$\\mathbf{p}$ 是包含 11 个未知参数的向量，$\\mathbf{X}$ 是 $K \\times 11$ 的设计矩阵。\n\n### 2. 设计矩阵和参数向量\n\n参数向量 $\\mathbf{p}$ 的排序如下：\n$$ \\mathbf{p} = [c_0, c_1, c_2, c_3, c_4, A_1, B_1, A_2, B_2, A_3, B_3]^T $$\n设计矩阵 $\\mathbf{X}$ 的每一行对应一个特定的训练数据点 $(P_i, \\chi_j)$。$\\mathbf{X}$ 的列是在该点评估的模型基函数。对于对应于 $(P_i, \\chi_j)$ 的行，其条目为：\n$$ \\mathbf{X}_{(i,j), \\cdot} = [ \\underbrace{\\delta_{i,0}, \\delta_{i,1}, \\dots, \\delta_{i,4}}_{\\text{偏移项}}, \\underbrace{\\cos(1\\chi_j), \\sin(1\\chi_j), \\dots, \\cos(3\\chi_j), \\sin(3\\chi_j)}_{\\text{傅里叶项}} ] $$\n其中 $\\delta_{i,k}$ 是克罗内克 δ，当 $k=i$ 时为 1，否则为 0。这种结构确保参数 $c_i$ 仅对具有糖环褶皱 $P_i$ 的数据点有效。\n\n### 3. 参数拟合\n\n对于三个合成测试案例中的每一个，我们首先通过在训练网格 $\\{P_i, \\chi_j\\}$ 上评估特定案例的 $E_{\\text{true}}(P, \\chi)$ 函数来生成“真实”的 QM 能量数据向量 $\\mathbf{E}_{\\text{data}}$。设计矩阵 $\\mathbf{X}$ 对所有案例都是相同的。最小化欧几里得范数 $||\\mathbf{E}_{\\text{data}} - \\mathbf{Xp}||_2$ 的最优参数向量 $\\mathbf{p}$ 是通过标准的线性最小二乘求解器（如 `numpy.linalg.lstsq`）找到的。此过程得出最佳拟合的偏移量 $\\{c_i\\}$ 和傅里叶系数 $\\{A_n, B_n\\}$。\n\n### 4. 可移植性评估\n\n问题的核心是评估拟合的全局傅里叶参数 $\\{A_n, B_n\\}$ 在预测未包含在训练集中的新糖环褶皱构象下的扭转能量剖面方面的表现如何。这些测试褶皱是 $P_{\\mathrm{A}}$、$P_{\\mathrm{B}}$ 和 $P_{\\mathrm{Z}}$。\n\n对于每个测试褶皱 $\\tilde{P} \\in \\{P_{\\mathrm{A}}, P_{\\mathrm{B}}, P_{\\mathrm{Z}}\\}$，评估包括以下步骤：\n1.  **生成真实相对剖面**：计算在所有 $j \\in \\{0, \\dots, N_{\\chi}-1\\}$ 上的真实能量剖面 $E_{\\text{true}}(\\tilde{P}, \\chi_j)$。然后通过减去在 $\\chi$ 网格上的平均能量来计算真实的*相对*能量剖面：\n    $$ \\Delta E_{\\text{true}}(\\tilde{P}, \\chi_j) = E_{\\text{true}}(\\tilde{P}, \\chi_j) - \\frac{1}{N_{\\chi}} \\sum_{k=0}^{N_{\\chi}-1} E_{\\text{true}}(\\tilde{P}, \\chi_k) $$\n2.  **生成预测相对剖面**：仅使用拟合的全局傅里叶系数来构建预测的扭转势：\n    $$ E_{\\text{pred}}(\\chi_j) = \\sum_{n=1}^{3} \\left( A_n \\cos(n \\chi_j) + B_n \\sin(n \\chi_j) \\right) $$\n    预测的*相对*能量剖面 $\\Delta E_{\\text{pred}}(\\chi_j)$ 同样通过减去 $E_{\\text{pred}}(\\chi_j)$ 在网格上的平均值来获得。由于在均匀间隔网格上离散傅里叶变换的性质，这个平均值实际上为零，因此 $\\Delta E_{\\text{pred}}(\\chi_j) \\approx E_{\\text{pred}}(\\chi_j)$。\n3.  **计算 RMSE**：均方根误差 (RMSE) 量化了真实和预测相对剖面之间的差异：\n    $$ \\text{RMSE} = \\sqrt{ \\frac{1}{N_{\\chi}} \\sum_{j=0}^{N_{\\chi}-1} (\\Delta E_{\\text{true}}(\\tilde{P}, \\chi_j) - \\Delta E_{\\text{pred}}(\\chi_j))^2 } $$\n对三个合成数据案例中的每个案例，都为三个测试褶皱中的每一个计算此 RMSE。然后按规定汇总和格式化结果。案例 1 中，真实能量函数与模型形式相匹配，预计会产生接近零的 RMSE，从而验证该方法。案例 2 和 3 引入了模型中不存在的耦合项和高阶项，用以测试其鲁棒性并揭示由此产生的建模误差的大小。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the complete workflow for parameterizing and testing a nucleic acid \n    glycosidic torsion potential.\n    \"\"\"\n\n    # 1. Define constants, grids, and true parameters\n    N = 3  # Fourier series order\n    M = 5  # Number of training puckers\n    N_chi = 24  # Number of chi angles\n    \n    # Training and test grids (angles in radians)\n    P_train = 0.2 * np.pi + np.arange(M) * 0.3 * np.pi\n    chi_grid = -np.pi + (2 * np.pi * np.arange(N_chi)) / N_chi\n    P_test = np.array([np.pi / 10, 9 * np.pi / 10, 4 * np.pi / 9])  # P_A, P_B, P_Z\n\n    # \"True\" baseline Fourier coefficients for synthetic data generation\n    a_true = {1: 2.0, 2: 0.5, 3: 0.3}\n    b_true = {1: -1.0, 2: 0.2, 3: -0.1}\n\n    # Helper functions for generating synthetic \"QM\" energies\n    def C0_func(P):\n        return 1.5 * np.cos(P) + 0.5 * np.sin(2 * P)\n\n    def fourier_base(chi, a_coeffs, b_coeffs):\n        E = np.zeros_like(chi) if isinstance(chi, np.ndarray) else 0.0\n        for n in range(1, N + 1):\n            E += a_coeffs.get(n, 0) * np.cos(n * chi) + b_coeffs.get(n, 0) * np.sin(n * chi)\n        return E\n\n    # True energy functions for the three cases\n    def E_true_case1(P, chi):\n        return C0_func(P) + fourier_base(chi, a_true, b_true)\n\n    def E_true_case2(P, chi):\n        return E_true_case1(P, chi) + 0.6 * np.sin(P) * np.cos(chi)\n\n    def E_true_case3(P, chi):\n        return E_true_case1(P, chi) + 0.7 * np.cos(4 * chi) + 0.4 * np.cos(2 * P) * np.sin(2 * chi)\n    \n    # List of synthetic energy functions to iterate through\n    e_true_funcs = [E_true_case1, E_true_case2, E_true_case3]\n\n    # 2. Build the design matrix X (once, as it's common to all cases)\n    num_data_points = M * N_chi\n    num_params = M + 2 * N\n    X = np.zeros((num_data_points, num_params))\n\n    for i in range(M):\n        for j in range(N_chi):\n            row_idx = i * N_chi + j\n            chi = chi_grid[j]\n            \n            # Column for pucker-specific offset c_i\n            X[row_idx, i] = 1.0\n            \n            # Columns for global Fourier coefficients A_n, B_n\n            for n in range(1, N + 1):\n                col_idx_cos = M + 2 * (n - 1)\n                col_idx_sin = M + 2 * (n - 1) + 1\n                X[row_idx, col_idx_cos] = np.cos(n * chi)\n                X[row_idx, col_idx_sin] = np.sin(n * chi)\n\n    all_results = []\n    # Loop over the three synthetic data cases\n    for case_func in e_true_funcs:\n        \n        # 3. Generate training data and fit the model\n        # Generate the vector of \"true\" energies on the training grid\n        E_data = np.zeros(num_data_points)\n        for i in range(M):\n            for j in range(N_chi):\n                row_idx = i * N_chi + j\n                E_data[row_idx] = case_func(P_train[i], chi_grid[j])\n        \n        # Perform linear least-squares fit to find the optimal parameters\n        params, _, _, _ = np.linalg.lstsq(X, E_data, rcond=None)\n        \n        # Extract the fitted global Fourier coefficients\n        An_fit = {}\n        Bn_fit = {}\n        for n in range(1, N + 1):\n            An_fit[n] = params[M + 2 * (n - 1)]\n            Bn_fit[n] = params[M + 2 * (n - 1) + 1]\n\n        # 4. Assess transferability by predicting profiles at test puckers\n        case_rmses = []\n        \n        # The predicted torsional profile is determined by the fitted Fourier coeffs\n        E_pred_profile = fourier_base(chi_grid, An_fit, Bn_fit)\n        \n        # The predicted relative profile is the profile minus its mean.\n        # This mean is nearly zero due to basis orthogonality on the grid.\n        Delta_E_pred_profile = E_pred_profile - np.mean(E_pred_profile)\n\n        for p_val in P_test:\n            # Calculate the \"true\" energy profile at the test pucker\n            E_true_profile_test = case_func(p_val, chi_grid)\n            \n            # Calculate the \"true\" relative energy profile\n            Delta_E_true_profile_test = E_true_profile_test - np.mean(E_true_profile_test)\n            \n            # Calculate RMSE between true and predicted relative profiles\n            rmse = np.sqrt(np.mean((Delta_E_true_profile_test - Delta_E_pred_profile)**2))\n            case_rmses.append(round(rmse, 4))\n            \n        all_results.append(case_rmses)\n\n    # 5. Format and print the final output\n    # The final output must be a single-line string with no spaces.\n    # Ex: [[0.0,0.0,0.0],[0.1,0.2,0.3],[0.4,0.5,0.6]]\n    output_str = str(all_results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```", "id": "3430379"}]}