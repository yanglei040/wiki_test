{"hands_on_practices": [{"introduction": "构建可靠的原子间势函数，其基石是确保模型能遵循基本的物理定律。对于由相同原子组成的体系，一个核心原则是粒子不可区分性，这意味着体系的总能量在任意交换两个原子标签时必须保持不变。本实践将探讨如何将这种排列对称性要求转化为对模型参数的具体数学约束，并由此推导出多体势函数中独立参数的数量。理解这一点对于开发和应用现代机器学习势至关重要。[@problem_id:3413133]", "problem": "一个单原子分子体系通过参数化的三体势进行建模，该势的形式受到量子力学训练数据和实验可观测量的启发。该势函数被写为三元组描述符的线性泛函，这些描述符是根据每个三元组内的三个原子间距计算得出的。设 $\\{g_{\\alpha}(r)\\}_{\\alpha=1}^{P}$ 为对距离在 $[0,\\infty)$ 上的一个固定径向基，原子 $i$, $j$, $k$ 的有序三元组描述符定义为\n$$\n\\mathbf{x}_{ijk} \\in \\mathbb{R}^{P^{3}}, \\quad \\left[\\mathbf{x}_{ijk}\\right]_{\\alpha\\beta\\gamma} \\equiv g_{\\alpha}(r_{ij})\\,g_{\\beta}(r_{jk})\\,g_{\\gamma}(r_{ki}),\n$$\n对于所有索引 $\\alpha,\\beta,\\gamma \\in \\{1,\\dots,P\\}$，其中 $r_{ab}$ 是原子 $a$ 和 $b$ 之间的标量距离。三元组 $(i,j,k)$ 的模型能量贡献为 $E_{ijk} = \\mathbf{c}^{\\top}\\mathbf{x}_{ijk}$，其中 $\\mathbf{c} \\in \\mathbb{R}^{P^{3}}$，总三体能量是所有有序三元组能量贡献之和。\n\n全同原子的基本不可区分性要求总能量在原子标签的任何置换下保持不变。这要求三体贡献在三个元素上的对称群的作用下保持不变。仅使用物理可观测量在全同粒子置换下的对称性这一基本要求以及上述描述符的定义，并且不假设任何特定的预对称化公式，完成以下任务：\n\n1. 形式化地构造一种强制对称性的方法：可以通过将对应于相同无序基函数三元组的 $(\\alpha,\\beta,\\gamma)$ 置换的参数 $\\mathbf{c}$ 进行绑定，或者通过使用作用于有序边 $(ij)$, $(jk)$, $(ki)$ 的对称群上的平均算子来对称化描述符。请论证对于线性模型，这两种方法为何是等价的。\n\n2. 从群在索引三元组上的作用以及不可区分选择的组合学的第一性原理出发，推导在对每个三元组内的三个全同原子施加完全置换对称性后，参数空间的确切维度。请用一个关于 $P$ 的闭式解析表达式表示你的答案。\n\n你的最终答案必须是经过对称性约化后独立参数数量的单个闭式表达式。不需要进行数值代入。如果引入角度，单位必须是弧度，但此问题中仅出现径向距离且未要求单位。最终答案必须是单个闭式解析表达式，而不是不等式或方程式。", "solution": "用户提供了一个关于构建对称三体原子间势并确定其参数空间维度的问题陈述。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n-   一个单原子分子体系。\n-   三体势被建模为三元组描述符的线性泛函。\n-   对偶径向基为 $\\{g_{\\alpha}(r)\\}_{\\alpha=1}^{P}$，其中 $r \\in [0,\\infty)$。\n-   原子 $i, j, k$ 的有序三元组描述符是一个向量 $\\mathbf{x}_{ijk} \\in \\mathbb{R}^{P^{3}}$，其分量为 $[\\mathbf{x}_{ijk}]_{\\alpha\\beta\\gamma} = g_{\\alpha}(r_{ij})\\,g_{\\beta}(r_{jk})\\,g_{\\gamma}(r_{ki})$，其中 $\\alpha,\\beta,\\gamma \\in \\{1,\\dots,P\\}$，$r_{ab}$ 是原子 $a$ 和 $b$ 之间的距离。\n-   有序三元组 $(i,j,k)$ 的能量贡献为 $E_{ijk} = \\mathbf{c}^{\\top}\\mathbf{x}_{ijk}$，其中 $\\mathbf{c} \\in \\mathbb{R}^{P^{3}}$ 是一个参数向量。$\\mathbf{c}$ 的分量记为 $c_{\\alpha\\beta\\gamma}$。\n-   总三体能量是对所有有序三元组求和。\n-   对称性要求：总能量必须在原子标签的任何置换下保持不变，这要求三体贡献在三个元素上的对称群作用下保持不变。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学上合理**：该问题在计算材料科学和化学领域，特别是在机器学习原子间势的开发中，具有充分的科学依据。使用基于径向基函数张量积的描述符以及施加置换对称性，是诸如 ACE (Atomic Cluster Expansion)、MTP (Moment Tensor Potentials) 等模型中的标准和关键概念。\n-   **问题良定**：该问题是良定的。它要求就两种等效的对称性强制方法进行形式化论证，并推导所得参数空间的维度。这些都是明确的数学目标。\n-   **客观性**：该问题以精确、客观和数学化的语言陈述。\n\n该问题没有科学缺陷，是自洽的，并描述了物理学和应用数学中一个现实且非平凡的任务。不存在使其无效的缺陷。\n\n**步骤3：结论与行动**\n问题是**有效的**。将提供完整解答。\n\n---\n\n### 解答\n\n一个有序原子三元组 $(i,j,k)$ 的能量贡献由下式给出\n$$\nE_{ijk} = \\mathbf{c}^{\\top}\\mathbf{x}_{ijk} = \\sum_{\\alpha=1}^{P} \\sum_{\\beta=1}^{P} \\sum_{\\gamma=1}^{P} c_{\\alpha\\beta\\gamma} g_{\\alpha}(r_{ij}) g_{\\beta}(r_{jk}) g_{\\gamma}(r_{ki})\n$$\n全同粒子的不可区分性这一基本要求规定，物理系统的能量必须在这些粒子的标签置换下保持不变。对于三体势，这意味着来自一组三个原子 $\\{i,j,k\\}$ 的能量贡献必须与我们如何标记它们无关。这个依赖于原子几何构型的能量函数，必须在原子索引上的对称群 $S_3$ 的作用下保持不变。\n\n设由原子 $i,j,k$ 定义的几何构型的三体能量记为 $U_{ijk}$。问题要求我们强制对称性 $U_{\\pi(i)\\pi(j)\\pi(k)} = U_{ijk}$ 对任意置换 $\\pi \\in S_3$ 成立。我们假设此能量的函数形式是给定形式，因此 $U_{ijk} = E_{ijk}$。让我们分析置换对基函数自变量的影响。设 $d_1 = r_{ij}$，$d_2 = r_{jk}$ 和 $d_3 = r_{ki}$。则能量是函数 $U(d_1, d_2, d_3)$。\n\n考虑置换 $\\pi = (j,k)$，它交换原子 $j$ 和 $k$。新的有序三元组是 $(i,k,j)$。对应的距离是 $d'_1 = r_{ik} = d_3$，$d'_2 = r_{kj} = d_2$ 和 $d'_3 = r_{ji} = d_1$。这不是自变量的简单置换。\n\n让我们更精确一点。问题陈述了“三个元素上的对称群”对“三体贡献”的作用。来自原子 $i,j,k$ 的贡献必须是不变的。让我们分析函数 $E_{ijk}$ 的自变量在原子标签置换下是如何变换的。\n设 $\\pi=(j,k)$。原子三元组变为 $(i,k,j)$。提供给函数的距离是 $(r_{ik}, r_{kj}, r_{ji}) = (r_{ki}, r_{jk}, r_{ij})$。这个新三元组的能量表达式是：\n$$\nE_{ikj} = \\sum_{\\alpha\\beta\\gamma} c_{\\alpha\\beta\\gamma} g_{\\alpha}(r_{ik}) g_{\\beta}(r_{kj}) g_{\\gamma}(r_{ji}) = \\sum_{\\alpha\\beta\\gamma} c_{\\alpha\\beta\\gamma} g_{\\alpha}(r_{ki}) g_{\\beta}(r_{jk}) g_{\\gamma}(r_{ij})\n$$\n不变性要求 $E_{ijk} = E_{ikj}$ 表明：\n$$\n\\sum_{\\alpha\\beta\\gamma} c_{\\alpha\\beta\\gamma} g_{\\alpha}(r_{ij}) g_{\\beta}(r_{jk}) g_{\\gamma}(r_{ki}) = \\sum_{\\alpha\\beta\\gamma} c_{\\alpha\\beta\\gamma} g_{\\alpha}(r_{ki}) g_{\\beta}(r_{jk}) g_{\\gamma}(r_{ij})\n$$\n我们可以重新标记右侧的求和索引。令 $\\alpha'=\\gamma, \\beta'=\\beta, \\gamma'=\\alpha$。\n$$\n\\sum_{\\alpha'\\beta'\\gamma'} c_{\\gamma'\\beta'\\alpha'} g_{\\gamma'}(r_{ij}) g_{\\beta'}(r_{jk}) g_{\\alpha'}(r_{ki})\n$$\n由于基函数 $\\{g_{\\lambda}(r)\\}$ 是线性无关的，张量积函数 $\\{g_\\alpha(r_1)g_\\beta(r_2)g_\\gamma(r_3)\\}$ 构成了三变量函数的一个基。因此，我们可以逐项比较系数：$c_{\\alpha\\beta\\gamma} = c_{\\gamma\\beta\\alpha}$。这对应于交换第一个和第三个索引。\n\n现在考虑一个轮换置换 $\\pi = (i,j,k)$。新的三元组是 $(j,k,i)$。距离是 $(r_{jk}, r_{ki}, r_{ij})$。不变性 $E_{ijk} = E_{jki}$ 意味着：\n$$\n\\sum_{\\alpha\\beta\\gamma} c_{\\alpha\\beta\\gamma} g_{\\alpha}(r_{ij}) g_{\\beta}(r_{jk}) g_{\\gamma}(r_{ki}) = \\sum_{\\alpha\\beta\\gamma} c_{\\alpha\\beta\\gamma} g_{\\alpha}(r_{jk}) g_{\\beta}(r_{ki}) g_{\\gamma}(r_{ij})\n$$\n将右侧重新标记为 $\\alpha'=\\gamma, \\beta'=\\alpha, \\gamma'=\\beta$ 得到：\n$$\n\\sum_{\\alpha'\\beta'\\gamma'} c_{\\beta'\\gamma'\\alpha'} g_{\\beta'}(r_{ij}) g_{\\gamma'}(r_{jk}) g_{\\alpha'}(r_{ki})\n$$\n比较系数得到 $c_{\\alpha\\beta\\gamma} = c_{\\beta\\gamma\\alpha}$。这是索引的一个轮换置换。\n\n索引 $(\\alpha,\\beta,\\gamma)$ 上的这两个置换，即 $(\\alpha,\\gamma)$ 和 $(\\alpha,\\beta, \\gamma)$，生成了完整的对称群 $S_3$。因此，能量在所有原子置换下保持不变的条件是系数张量 $\\mathbf{c}$ 必须在其索引的任何置换下都是完全对称的：\n$$\nc_{\\alpha\\beta\\gamma} = c_{\\sigma(\\alpha)\\sigma(\\beta)\\sigma(\\gamma)} \\quad \\forall \\sigma \\in S_3\n$$\n\n**1. 对称性强制方法的构建及其等价性**\n\n**方法1：参数绑定**\n该方法直接实现了上面推导出的对称性条件。我们约束参数张量 $\\mathbf{c}$ 为一个对称张量。这意味着对于任何索引多重集 $\\{\\alpha, \\beta, \\gamma\\}$，所有系数 $c_{\\alpha'\\beta'\\gamma'}$（其中 $(\\alpha',\\beta',\\gamma')$ 是 $(\\alpha, \\beta, \\gamma)$ 的一个置换）都被设置为相等。例如，$c_{123} = c_{132} = c_{213} = c_{231} = c_{312} = c_{321}$，以及 $c_{112} = c_{121} = c_{211}$。独立参数与从 $\\{1, \\dots, P\\}$ 中抽取的三个索引的无序多重集一一对应。\n\n**方法2：描述符对称化**\n在这种方法中，我们从一个一般的、非对称的参数张量 $\\mathbf{c}'$ 开始，转而在描述符向量 $\\mathbf{x}_{ijk}$ 上强制对称性。问题建议使用一个“作用于有序边 $(ij), (jk), (ki)$ 的对称群上的平均算子”。这些有序边与张量积 $g_{\\alpha}(r_{ij})\\,g_{\\beta}(r_{jk})\\,g_{\\gamma}(r_{ki})$ 中的三个位置相关联。因此，对这些边的作用就是对索引 $(\\alpha, \\beta, \\gamma)$ 的作用。\n\n让我们定义一个对称化描述符 $\\mathbf{x}^{\\text{sym}}$，其分量为：\n$$\n[\\mathbf{x}^{\\text{sym}}_{ijk}]_{\\alpha\\beta\\gamma} = \\frac{1}{|S_3|} \\sum_{\\sigma \\in S_3} g_{\\sigma(\\alpha)}(r_{ij}) g_{\\sigma(\\beta)}(r_{jk}) g_{\\sigma(\\gamma)}(r_{ki})\n$$\n能量则计算为 $E_{ijk} = (\\mathbf{c}')^{\\top} \\mathbf{x}^{\\text{sym}}_{ijk}$：\n$$\nE_{ijk} = \\sum_{\\alpha\\beta\\gamma} c'_{\\alpha\\beta\\gamma} \\left( \\frac{1}{6} \\sum_{\\sigma \\in S_3} g_{\\sigma(\\alpha)}(r_{ij}) g_{\\sigma(\\beta)}(r_{jk}) g_{\\sigma(\\gamma)}(r_{ki}) \\right)\n$$\n我们可以重新排列求和顺序：\n$$\nE_{ijk} = \\frac{1}{6} \\sum_{\\sigma \\in S_3} \\sum_{\\alpha\\beta\\gamma} c'_{\\alpha\\beta\\gamma} g_{\\sigma(\\alpha)}(r_{ij}) g_{\\sigma(\\beta)}(r_{jk}) g_{\\sigma(\\gamma)}(r_{ki})\n$$\n让我们重新标记内部求和索引：令 $(\\alpha', \\beta', \\gamma') = \\sigma(\\alpha, \\beta, \\gamma)$，则 $(\\alpha, \\beta, \\gamma) = \\sigma^{-1}(\\alpha', \\beta', \\gamma')$。\n$$\nE_{ijk} = \\frac{1}{6} \\sum_{\\sigma \\in S_3} \\sum_{\\alpha'\\beta'\\gamma'} c'_{\\sigma^{-1}(\\alpha', \\beta', \\gamma')} g_{\\alpha'}(r_{ij}) g_{\\beta'}(r_{jk}) g_{\\gamma'}(r_{ki})\n$$\n将关于 $\\sigma$ 的求和移到内部，并将 $(\\alpha', \\beta', \\gamma')$ 重命名回 $(\\alpha, \\beta, \\gamma)$：\n$$\nE_{ijk} = \\sum_{\\alpha\\beta\\gamma} \\left( \\frac{1}{6} \\sum_{\\sigma \\in S_3} c'_{\\sigma^{-1}(\\alpha, \\beta, \\gamma)} \\right) g_{\\alpha}(r_{ij}) g_{\\beta}(r_{jk}) g_{\\gamma}(r_{ki})\n$$\n该表达式的形式为 $E_{ijk} = \\sum_{\\alpha\\beta\\gamma} c_{\\alpha\\beta\\gamma} g_{\\alpha}(r_{ij}) g_{\\beta}(r_{jk}) g_{\\gamma}(r_{ki})$，其中有效系数为：\n$$\nc_{\\alpha\\beta\\gamma} = \\frac{1}{6} \\sum_{\\sigma \\in S_3} c'_{\\sigma^{-1}(\\alpha, \\beta, \\gamma)}\n$$\n这些有效系数 $c_{\\alpha\\beta\\gamma}$ 根据构造是完全对称的。对于任何置换 $\\pi \\in S_3$，有 $c_{\\pi(\\alpha)\\pi(\\beta)\\pi(\\gamma)} = \\frac{1}{6} \\sum_{\\sigma \\in S_3} c'_{\\sigma^{-1}(\\pi(\\alpha), \\pi(\\beta), \\pi(\\gamma))}$。令 $\\tau = \\sigma^{-1}\\pi$，求和遍及所有 $\\tau \\in S_3$，因此 $c_{\\pi(\\alpha)\\pi(\\beta)\\pi(\\gamma)} = c_{\\alpha\\beta\\gamma}$。\n\n**等价性：**\n这两种方法是等价的，因为它们都导出了相同的能量函数形式。能量是基乘积 $g_{\\alpha}(r_{ij}) g_{\\beta}(r_{jk}) g_{\\gamma}(r_{ki})$ 的线性泛函。两种方法都将此泛函限制在对称系数张量的子空间上。设 $S$ 是 $\\mathbb{R}^{P^3}$ 中对称张量的子空间。方法1将参数向量 $\\mathbf{c}$ 限制在 $S$ 中。方法2取一个任意的参数向量 $\\mathbf{c}'$，并通过平均化将其有效地投影到对称子空间 $S$ 上，产生一个位于 $S$ 中的有效参数向量 $\\mathbf{c} = \\mathcal{P}(\\mathbf{c}')$。在这两种情况下，所有可以表示的可能势函数的集合，都恰好是由对称张量 $\\mathbf{c} \\in S$ 参数化的势函数集合。参数空间是同构的，并且对于用一种方法描述的任何势，都存在另一种方法中的等价表示。\n\n**2. 对称参数空间的维度**\n\n对系数张量 $\\mathbf{c}$ 施加完全置换对称性，要求 $c_{\\alpha\\beta\\gamma}$ 在其三个索引的任何置换下都保持不变。因此，独立参数的数量就是从集合 $\\{1, 2, \\dots, P\\}$ 中有放回地选择三个索引的方法数，其中选择的顺序无关紧要。这是一个对特定大小的多重集进行计数的经典组合问题。\n\n从一个包含 $n$ 个元素的集合中选择一个大小为 $k$ 的多重集的方法数由多重集系数给出，通常称为“隔板法”公式：\n$$\n\\left(\\!\\!{n \\choose k}\\!\\!\\right) = \\binom{n+k-1}{k}\n$$\n在我们的例子中，我们是从 $n=P$ 个可能值中选择 $k=3$ 个索引（$\\alpha, \\beta, \\gamma$）。所以，独立参数的数量是：\n$$\nN = \\left(\\!\\!{P \\choose 3}\\!\\!\\right) = \\binom{P+3-1}{3} = \\binom{P+2}{3}\n$$\n这可以展开写为：\n$$\n\\binom{P+2}{3} = \\frac{(P+2)!}{3!(P+2-3)!} = \\frac{(P+2)(P+1)P}{3 \\cdot 2 \\cdot 1} = \\frac{P(P+1)(P+2)}{6}\n$$\n\n我们也可以通过考虑索引 $\\{\\alpha, \\beta, \\gamma\\}$ 的三种情况来推导这个结果：\n1.  三个索引完全相同 $(\\alpha=\\beta=\\gamma)$。选择这一个索引有 $\\binom{P}{1}=P$ 种方法。\n2.  恰好有两个索引相同（例如 $\\alpha=\\beta \\neq \\gamma$）。我们首先从 $P$ 中选择两个不同的索引，有 $\\binom{P}{2}$ 种方法。对于每一对索引，比如 $\\{i, j\\}$，我们可以形成两个不同的大小为3的多重集：$\\{i,i,j\\}$ 和 $\\{i,j,j\\}$。所以，共有 $2\\binom{P}{2} = P(P-1)$ 种这样的组合。\n3.  三个索引都不同 $(\\alpha \\neq \\beta \\neq \\gamma)$。选择三个不同的索引有 $\\binom{P}{3}$ 种方法。\n\n独立参数的总数是这些情况的总和：\n$$\nN = \\binom{P}{1} + 2\\binom{P}{2} + \\binom{P}{3} = P + P(P-1) + \\frac{P(P-1)(P-2)}{6}\n$$\n化简后得到：\n$$\nN = P^2 + \\frac{P^3 - 3P^2 + 2P}{6} = \\frac{6P^2 + P^3 - 3P^2 + 2P}{6} = \\frac{P^3 + 3P^2 + 2P}{6} = \\frac{P(P+1)(P+2)}{6}\n$$\n这证实了从多重集系数公式得到的结果。施加完全置换对称性后，参数空间的维度是 $\\binom{P+2}{3}$。", "answer": "$$\\boxed{\\binom{P+2}{3}}$$", "id": "3413133"}, {"introduction": "一次成功的参数拟合，其意义远不止于获得一个较低的误差值；更重要的是理解数据在多大程度上能够确定模型的参数。本实践介绍了一个强大的诊断工具——费雪信息矩阵（Fisher Information Matrix, FIM）。你将学习如何运用 FIM 来诊断所谓的“草率模型”（sloppy model）——即模型中存在某些参数组合难以被数据有效约束的情况，并量化参数的不确定性。这让你能超越简单的误差评估，深入洞察模型与数据之间的关系。[@problem_id:3413114]", "problem": "考虑一个用于分子动力学中的双位点二聚体模型，该模型用于将参数与量子和实验的能量及响应数据进行拟合。每个构型由一对类型为 A 和 B 的位点组成，它们相距 $r_k$，并受到大小为 $E_k$ 的均匀外部电场的作用。构型 k 的模型总能量是范德华（vdW）Lennard–Jones 相互作用与在线性响应下带有 Thole 型屏蔽的各向同性极化贡献之和，\n$$\n\\mathcal{E}_k(\\boldsymbol{\\theta}) \\equiv \\mathcal{E}_{\\mathrm{LJ}}(r_k;\\epsilon,\\sigma) + \\mathcal{E}_{\\mathrm{pol}}(r_k,E_k;\\alpha_A,\\alpha_B,a),\n$$\n其中参数向量为 $\\boldsymbol{\\theta} = (\\epsilon,\\sigma,\\alpha_A,\\alpha_B,a)$。Lennard–Jones 相互作用为\n$$\n\\mathcal{E}_{\\mathrm{LJ}}(r;\\epsilon,\\sigma) = 4\\,\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6}\\right],\n$$\n而在外场作用下的极化能通过带有屏蔽有效极化率的线性响应进行建模，\n$$\n\\mathcal{E}_{\\mathrm{pol}}(r,E;\\alpha_A,\\alpha_B,a) = -\\frac{1}{2}\\,E^2\\;\\frac{\\alpha_A+\\alpha_B}{1 + a\\,r^{-3}}.\n$$\n这种 $\\mathcal{E}_{\\mathrm{pol}}$ 形式是一种简化的各向同性平均场近似，它通过一个与距离相关的、与 $r^{-3}$ 成正比的屏蔽，捕捉了相互极化的主导阶衰减，这与偶极-偶极耦合是一致的。\n\n假设测量噪声是独立同分布的高斯噪声，其方差为 $\\sigma_n^2$，并且在高斯似然下采用最大似然估计（MLE）目标。对于给定的参数向量 $\\boldsymbol{\\theta}$，在高斯噪声下的费雪信息矩阵（FIM）$\\mathbf{I}(\\boldsymbol{\\theta})$ 定义为\n$$\nI_{ij}(\\boldsymbol{\\theta}) \\equiv \\mathbb{E}\\left[\\partial_{\\theta_i} \\log L(\\boldsymbol{\\theta})\\;\\partial_{\\theta_j} \\log L(\\boldsymbol{\\theta})\\right],\n$$\n其中 $L(\\boldsymbol{\\theta})$ 是似然函数。在所述的高斯模型下，这可以简化为梯度外积对所有数据的求和，\n$$\n\\mathbf{I}(\\boldsymbol{\\theta}) = \\frac{1}{\\sigma_n^2}\\sum_{k} \\left(\\nabla_{\\boldsymbol{\\theta}} \\mathcal{E}_k(\\boldsymbol{\\theta})\\right)\\left(\\nabla_{\\boldsymbol{\\theta}} \\mathcal{E}_k(\\boldsymbol{\\theta})\\right)^{\\top}.\n$$\n\n对于下面的每个测试用例，您的程序必须计算费雪信息矩阵 $\\mathbf{I}(\\boldsymbol{\\theta})$，并通过条件数诊断其病态性\n$$\n\\kappa(\\mathbf{I}) \\equiv \\frac{\\lambda_{\\max}}{\\lambda_{\\min}},\n$$\n其中 $\\lambda_{\\max}$ 和 $\\lambda_{\\min}$ 分别是 $\\mathbf{I}$ 的最大和最小特征值，并使用近似的 Cramér–Rao 下界协方差矩阵 $\\mathbf{C} \\approx \\mathbf{I}^{-1}$ 来评估参数的可辨识性。当 $\\mathbf{I}$ 是奇异或接近奇异时，使用一个小的 Tikhonov 正则化项 $\\lambda_{\\mathrm{reg}}$ 来定义\n$$\n\\mathbf{C} \\approx \\left(\\mathbf{I} + \\lambda_{\\mathrm{reg}}\\mathbf{I}_5\\right)^{-1},\n$$\n其中 $\\mathbf{I}_5$ 是 $5\\times 5$ 的单位矩阵。定义参数 $\\theta_i$ 的相对不确定度为\n$$\n\\rho_i \\equiv \\frac{\\sqrt{C_{ii}}}{|\\theta_i|}.\n$$\n如果参数满足 $\\rho_i \\le \\tau$（其中 $\\tau$ 是阈值），则该参数被认为是可辨识的。\n\n设置正则化项为 $\\lambda_{\\mathrm{reg}} = 10^{-12}$，可辨识性阈值为 $\\tau = 0.5$。对于条件数，如果最小特征值满足 $\\lambda_{\\min} \\le 10^{-12}$，则将矩阵视为奇异矩阵，并设置 $\\kappa(\\mathbf{I}) = +\\infty$；否则，使用比率 $\\lambda_{\\max}/\\lambda_{\\min}$。\n\n根据上述定义，为 $\\boldsymbol{\\theta}$ 中的每个参数从第一性原理计算梯度 $\\nabla_{\\boldsymbol{\\theta}}\\mathcal{E}_k$，然后构建 $\\mathbf{I}(\\boldsymbol{\\theta})$。\n\n测试套件：\n- 用例 1（通用情况，信息丰富的场和变化的距离）：\n    - 参数：$\\boldsymbol{\\theta} = (\\epsilon,\\sigma,\\alpha_A,\\alpha_B,a) = (0.20, 3.50, 1.20, 0.80, 0.30)$。\n    - 距离：$[3.00, 3.50, 4.00, 4.50, 5.00]$。\n    - 电场：$[0.30, 0.50, 0.70, 0.90, 1.10]$。\n    - 噪声方差：$\\sigma_n^2 = 0.01$。\n- 用例 2（边界情况，无电场；极化参数不可观测）：\n    - 参数：$\\boldsymbol{\\theta} = (0.20, 3.50, 1.20, 0.80, 0.30)$。\n    - 距离：$[3.00, 3.50, 4.00, 4.50, 5.00]$。\n    - 电场：$[0.00, 0.00, 0.00, 0.00, 0.00]$。\n    - 噪声方差：$\\sigma_n^2 = 0.01$。\n- 用例 3（边缘情况，重复的距离；解析范德华参数的能力降低）：\n    - 参数：$\\boldsymbol{\\theta} = (0.20, 3.50, 1.20, 0.80, 0.30)$。\n    - 距离：$[4.00, 4.00, 4.00, 4.00, 4.00]$。\n    - 电场：$[0.30, 0.50, 0.70, 0.90, 1.10]$。\n    - 噪声方差：$\\sigma_n^2 = 0.02$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表：$[\\kappa_1,\\kappa_2,\\kappa_3,N_1,N_2,N_3]$，其中 $\\kappa_j$ 是用例 $j$ 的条件数（按规定，对于奇异情况使用 $+\\infty$），$N_j$ 是在阈值 $\\tau$ 下，用例 $j$ 中可辨识参数的整数计数。\n\n所有的数学推导都必须从上面提供的基本定义开始。输出值是无量纲的，不需要报告物理单位。代码必须是一个完整、可运行的程序，并且不得读取任何输入或文件。", "solution": "目标是为给定的物理模型计算费雪信息矩阵（FIM），使用条件数诊断参数的病态性，并使用 Cramér–Rao 下界评估参数的可辨识性。将对三个不同的测试用例进行分析。\n\n对于位点间距为 $r_k$、外场为 $E_k$ 的构型 $k$，其模型能量由下式给出：\n$$\n\\mathcal{E}_k(\\boldsymbol{\\theta}) = \\mathcal{E}_{\\mathrm{LJ}}(r_k;\\epsilon,\\sigma) + \\mathcal{E}_{\\mathrm{pol}}(r_k,E_k;\\alpha_A,\\alpha_B,a)\n$$\n其中参数向量为 $\\boldsymbol{\\theta} = (\\epsilon,\\sigma,\\alpha_A,\\alpha_B,a)$。两个能量分量是：\n$$\n\\mathcal{E}_{\\mathrm{LJ}}(r;\\epsilon,\\sigma) = 4\\,\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6}\\right]\n$$\n$$\n\\mathcal{E}_{\\mathrm{pol}}(r,E;\\alpha_A,\\alpha_B,a) = -\\frac{1}{2}\\,E^2\\;\\frac{\\alpha_A+\\alpha_B}{1 + a\\,r^{-3}}\n$$\n\n第一步是通过对 $\\boldsymbol{\\theta}$ 中的五个参数分别求偏导数来计算能量函数的梯度 $\\nabla_{\\boldsymbol{\\theta}}\\mathcal{E}_k(\\boldsymbol{\\theta})$。为清晰起见，对于单个构型，我们省略下标 k：\n\n1.  **关于 $\\epsilon$ 的导数**：只有 Lennard-Jones 项依赖于 $\\epsilon$。\n    $$\n    \\frac{\\partial\\mathcal{E}}{\\partial\\epsilon} = \\frac{\\partial}{\\partial\\epsilon} \\left(4\\,\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6}\\right]\\right) = 4\\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6}\\right]\n    $$\n\n2.  **关于 $\\sigma$ 的导数**：只有 Lennard-Jones 项依赖于 $\\sigma$。\n    $$\n    \\frac{\\partial\\mathcal{E}}{\\partial\\sigma} = \\frac{\\partial}{\\partial\\sigma} \\left(4\\,\\epsilon\\left[\\sigma^{12}r^{-12} - \\sigma^{6}r^{-6}\\right]\\right) = 4\\,\\epsilon\\left[12\\sigma^{11}r^{-12} - 6\\sigma^{5}r^{-6}\\right] = \\frac{24\\epsilon}{\\sigma}\\left[2\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6}\\right]\n    $$\n\n3.  **关于 $\\alpha_A$ 的导数**：只有极化项依赖于 $\\alpha_A$。\n    $$\n    \\frac{\\partial\\mathcal{E}}{\\partial\\alpha_A} = \\frac{\\partial}{\\partial\\alpha_A}\\left(-\\frac{1}{2}\\,E^2\\;\\frac{\\alpha_A+\\alpha_B}{1 + a\\,r^{-3}}\\right) = -\\frac{1}{2}\\,E^2\\;\\frac{1}{1 + a\\,r^{-3}}\n    $$\n\n4.  **关于 $\\alpha_B$ 的导数**：只有极化项依赖于 $\\alpha_B$。\n    $$\n    \\frac{\\partial\\mathcal{E}}{\\partial\\alpha_B} = \\frac{\\partial}{\\partial\\alpha_B}\\left(-\\frac{1}{2}\\,E^2\\;\\frac{\\alpha_A+\\alpha_B}{1 + a\\,r^{-3}}\\right) = -\\frac{1}{2}\\,E^2\\;\\frac{1}{1 + a\\,r^{-3}}\n    $$\n    关键要注意的是 $\\frac{\\partial\\mathcal{E}}{\\partial\\alpha_A} = \\frac{\\partial\\mathcal{E}}{\\partial\\alpha_B}$。这意味着存在结构性不可辨识问题；模型只能解析总和 $\\alpha_A + \\alpha_B$，而不能解析它们各自的值。\n\n5.  **关于 $a$ 的导数**：只有极化项依赖于 $a$。\n    $$\n    \\frac{\\partial\\mathcal{E}}{\\partial a} = -\\frac{1}{2}\\,E^2(\\alpha_A+\\alpha_B)\\frac{\\partial}{\\partial a}\\left( (1 + a\\,r^{-3})^{-1} \\right) = \\frac{1}{2}\\,E^2(\\alpha_A+\\alpha_B)\\frac{r^{-3}}{(1 + a\\,r^{-3})^2}\n    $$\n\n利用这些解析导数，我们可以为每个数据构型 $k$ 构建梯度向量 $\\mathbf{g}_k = \\nabla_{\\boldsymbol{\\theta}}\\mathcal{E}_k(\\boldsymbol{\\theta})$。然后，通过对所有 $k$ 个数据点的梯度向量的外积求和，并按噪声方差 $\\sigma_n^2$ 的倒数进行缩放，来构建费雪信息矩阵（FIM）：\n$$\n\\mathbf{I}(\\boldsymbol{\\theta}) = \\frac{1}{\\sigma_n^2}\\sum_{k} \\mathbf{g}_k \\mathbf{g}_k^{\\top}\n$$\n\n一旦计算出 $5 \\times 5$ 的 FIM $\\mathbf{I}(\\boldsymbol{\\theta})$，我们便进行分析：\n\n**病态性诊断**：我们计算对称矩阵 $\\mathbf{I}$ 的特征值。设最大和最小特征值分别为 $\\lambda_{\\max}$ 和 $\\lambda_{\\min}$。条件数为 $\\kappa(\\mathbf{I}) = \\lambda_{\\max}/\\lambda_{\\min}$。如果 $\\lambda_{\\min}$ 低于一个数值阈值（$\\lambda_{\\min} \\le 10^{-12}$），则该矩阵被认为是奇异的，条件数取为无穷大，即 $\\kappa(\\mathbf{I}) = +\\infty$。一个非常大或无穷大的条件数表明模型是“病态的”，即至少有一个参数组合受数据的约束很差。$\\alpha_A$ 和 $\\alpha_B$ 之间的结构性不可辨识性保证了只要电场不为零，FIM 就将是奇异的，从而导致无穷大的条件数。\n\n**参数可辨识性**：FIM 的逆矩阵近似了参数估计协方差矩阵的 Cramér–Rao 下界，即 $\\mathbf{C} \\approx \\mathbf{I}^{-1}$。为了处理奇异或近奇异的 FIM，我们使用 Tikhonov 正则化：\n$$\n\\mathbf{C} \\approx \\left(\\mathbf{I} + \\lambda_{\\mathrm{reg}}\\mathbf{I}_5\\right)^{-1}\n$$\n其中 $\\lambda_{\\mathrm{reg}} = 10^{-12}$。该矩阵的对角元素 $C_{ii}$ 代表参数 $\\theta_i$ 估计的方差。每个参数的相对不确定度定义为：\n$$\n\\rho_i = \\frac{\\sqrt{C_{ii}}}{|\\theta_i|}\n$$\n如果参数 $\\theta_i$ 的相对不确定度低于指定阈值，即 $\\rho_i \\le \\tau=0.5$，则该参数被认为是可辨识的。\n\n程序为所提供的三个测试用例中的每一个都实现了这整个过程——计算梯度、构建 FIM 以及执行后续分析。然后，将包含每个用例 $j$ 的条件数 $\\kappa_j$ 和可辨识参数计数 $N_j$ 的结果格式化为所需的输出字符串。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    It computes the Fisher Information Matrix (FIM), condition number,\n    and parameter identifiability for three different scenarios of a\n    two-site dimer model.\n    \"\"\"\n    test_cases = [\n        {\n            \"name\": \"Case 1 (general)\",\n            \"params\": (0.20, 3.50, 1.20, 0.80, 0.30),\n            \"distances\": [3.00, 3.50, 4.00, 4.50, 5.00],\n            \"fields\": [0.30, 0.50, 0.70, 0.90, 1.10],\n            \"noise_var\": 0.01\n        },\n        {\n            \"name\": \"Case 2 (no field)\",\n            \"params\": (0.20, 3.50, 1.20, 0.80, 0.30),\n            \"distances\": [3.00, 3.50, 4.00, 4.50, 5.00],\n            \"fields\": [0.00, 0.00, 0.00, 0.00, 0.00],\n            \"noise_var\": 0.01\n        },\n        {\n            \"name\": \"Case 3 (repeated distance)\",\n            \"params\": (0.20, 3.50, 1.20, 0.80, 0.30),\n            \"distances\": [4.00, 4.00, 4.00, 4.00, 4.00],\n            \"fields\": [0.30, 0.50, 0.70, 0.90, 1.10],\n            \"noise_var\": 0.02\n        }\n    ]\n\n    lambda_reg = 1e-12\n    identifiability_threshold = 0.5\n    singularity_threshold = 1e-12\n\n    def calculate_gradient(theta, r, E):\n        \"\"\"\n        Calculates the gradient of the energy function w.r.t. parameters.\n        theta = (epsilon, sigma, alpha_A, alpha_B, a)\n        \"\"\"\n        epsilon, sigma, alpha_A, alpha_B, a = theta\n        grad = np.zeros(5, dtype=float)\n\n        # Lennard-Jones term derivatives\n        if r > 0:\n            s_over_r = sigma / r\n            s_over_r_6 = s_over_r**6\n            s_over_r_12 = s_over_r_6**2\n            \n            # dE/d(epsilon)\n            grad[0] = 4.0 * (s_over_r_12 - s_over_r_6)\n            \n            # dE/d(sigma)\n            if sigma > 0:\n                grad[1] = (24.0 * epsilon / sigma) * (2.0 * s_over_r_12 - s_over_r_6)\n\n        # Polarization term derivatives\n        if E != 0:\n            r_inv3 = r**(-3)\n            denom_pol = 1.0 + a * r_inv3\n            \n            if abs(denom_pol) > 1e-15: # Avoid division by zero\n                # dE/d(alpha_A) and dE/d(alpha_B)\n                common_pol_deriv = -0.5 * E**2 / denom_pol\n                grad[2] = common_pol_deriv\n                grad[3] = common_pol_deriv\n                \n                # dE/d(a)\n                alpha_sum = alpha_A + alpha_B\n                grad[4] = 0.5 * E**2 * alpha_sum * r_inv3 / (denom_pol**2)\n                \n        return grad\n\n    def analyze_case(case_data):\n        \"\"\"\n        Performs the full FIM analysis for a single case.\n        \"\"\"\n        theta = np.array(case_data[\"params\"])\n        distances = case_data[\"distances\"]\n        fields = case_data[\"fields\"]\n        noise_var = case_data[\"noise_var\"]\n        \n        num_params = len(theta)\n        fim = np.zeros((num_params, num_params), dtype=float)\n        \n        for r, E in zip(distances, fields):\n            grad = calculate_gradient(theta, r, E)\n            fim += np.outer(grad, grad)\n            \n        fim /= noise_var\n        \n        # Eigenvalue analysis for condition number\n        eigvals = np.linalg.eigvalsh(fim)\n        lambda_min, lambda_max = eigvals[0], eigvals[-1]\n        \n        if lambda_min = singularity_threshold:\n            kappa = np.inf\n        else:\n            kappa = lambda_max / lambda_min\n            \n        # Identifiability analysis\n        fim_reg = fim + lambda_reg * np.identity(num_params)\n        try:\n            cov_matrix = np.linalg.inv(fim_reg)\n        except np.linalg.LinAlgError:\n            # Should not happen due to regularization, but as a safeguard\n            return kappa, 0\n\n        identifiable_count = 0\n        for i in range(num_params):\n            # A parameter value of zero cannot be assessed by relative uncertainty.\n            if abs(theta[i])  1e-15:\n                continue\n            \n            # Variance must be non-negative.\n            C_ii = cov_matrix[i, i]\n            if C_ii  0:\n                continue\n\n            rho_i = np.sqrt(C_ii) / np.abs(theta[i])\n            \n            if rho_i = identifiability_threshold:\n                identifiable_count += 1\n                \n        return kappa, identifiable_count\n\n    # Process all cases and collect results\n    kappas = []\n    identifiable_counts = []\n    for case in test_cases:\n        kappa, N = analyze_case(case)\n        kappas.append(kappa)\n        identifiable_counts.append(N)\n    \n    final_results = kappas + identifiable_counts\n    \n    # Format and print the final output as a single line\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```", "id": "3413114"}, {"introduction": "一个模型的最终价值在于其对未见数据的预测能力，即泛化能力。然而，直接来自高成本分子动力学轨迹的训练数据点之间存在时间上的关联性，这违背了标准交叉验证方法的独立性假设，并可能导致对模型性能过于乐观的评估。本实践将指导你应用正确的“分组交叉验证”（blocked cross-validation）方法，从而为你的模型泛化误差提供一个更可靠的估计，这是任何严谨建模工作中都不可或缺的一步。[@problem_id:3413140]", "problem": "您正在将一个参数化的原子间势 $U_{\\theta}(\\mathbf{R})$ 拟合到一个由分子动力学（MD）轨迹在温度 $T$ 下生成的构型数据集 $\\{\\mathbf{R}_{i}\\}$ 上，其中每个构型 $\\mathbf{R}_{i}$ 包含 $N_{i}$ 个原子。对于每个构型，您拥有密度泛函理论（DFT; Density Functional Theory）的参考量：总能量 $E^{\\mathrm{QM}}(\\mathbf{R}_{i})$ 和原子力 $\\{\\mathbf{F}^{\\mathrm{QM}}_{i,a}\\}_{a=1}^{N_{i}}$，根据保守力的定义，$\\mathbf{F}^{\\mathrm{QM}}_{i,a}=-\\nabla_{\\mathbf{r}_{i,a}}E^{\\mathrm{QM}}(\\mathbf{R}_{i})$。该势预测的能量为 $E_{\\theta}(\\mathbf{R}_{i})$，力为 $\\{\\mathbf{F}_{\\theta,i,a}\\}_{a=1}^{N_{i}}$，其中 $\\mathbf{F}_{\\theta,i,a}=-\\nabla_{\\mathbf{r}_{i,a}}U_{\\theta}(\\mathbf{R}_{i})$。该轨迹表现出时间相关性，其特征在于物理相关可观测量（例如，能量、结构序参数）的非零积分自相关时间 $\\tau_{\\mathrm{int}}$，这意味着相邻的帧在统计上不是独立的。\n\n您的目标是通过交叉验证来估计拟合模型的泛化误差，这种方式要尊重相关性结构，并为验证折叠上的能量和力定义科学上有意义的预测误差度量。请选择一个选项，该选项正确地构建了使用分块折叠的交叉验证策略，证明了为什么在存在相关MD数据时这是必要的，并提供了计算能量和力的预测误差的适当公式，以避免尺寸和分量数偏差。\n\nA. 将轨迹划分为长度为 $L$ 的连续块，其中 $L \\geq c\\,\\tau_{\\mathrm{int}}$ 且 $c \\geq 1$，将整个块分配给 $K$ 个折叠而不拆分块，并在训练块和验证块之间放置一个宽度为 $g \\geq \\tau_{\\mathrm{int}}$ 的隔离带（排除的帧），以抑制相关性泄漏。理由：标准的 $K$ 折交叉验证假设验证样本与训练样本近似独立，这对于具有自相关的MD轨迹是不成立的；分块和隔离带通过在超过 $\\tau_{\\mathrm{int}}$ 的时间上分离样本来恢复近似独立性。对于验证集 $\\mathcal{V}$ 上的预测误差，使用单原子能量均方根误差\n$$\n\\mathrm{RMSE}_{E}=\\sqrt{\\frac{1}{\\sum_{i \\in \\mathcal{V}} N_{i}} \\sum_{i \\in \\mathcal{V}} \\sum_{a=1}^{N_{i}}\\left(\\frac{E_{\\theta}(\\mathbf{R}_{i})-E^{\\mathrm{QM}}(\\mathbf{R}_{i})}{N_{i}}\\right)^{2}},\n$$\n和每个笛卡尔分量的力均方根误差\n$$\n\\mathrm{RMSE}_{F}=\\sqrt{\\frac{1}{3\\sum_{i \\in \\mathcal{V}} N_{i}} \\sum_{i \\in \\mathcal{V}} \\sum_{a=1}^{N_{i}} \\left\\| \\mathbf{F}_{\\theta,i,a}-\\mathbf{F}^{\\mathrm{QM}}_{i,a} \\right\\|^{2}}.\n$$\n\nB. 随机打乱所有帧并执行标准的 $K$ 折交叉验证，不进行分块或设置隔离带，因为打乱可以近似实现独立性。理由：由于力是梯度，它们比能量去相关更快，因此泄漏可以忽略不计。对于预测误差，计算构型级别的能量均方根误差\n$$\n\\mathrm{RMSE}_{E}=\\sqrt{\\frac{1}{|\\mathcal{V}|} \\sum_{i \\in \\mathcal{V}} \\left( E_{\\theta}(\\mathbf{R}_{i})-E^{\\mathrm{QM}}(\\mathbf{R}_{i}) \\right)^{2}},\n$$\n和力均方根误差\n$$\n\\mathrm{RMSE}_{F}=\\sqrt{\\frac{1}{|\\mathcal{V}|} \\sum_{i \\in \\mathcal{V}} \\sum_{a=1}^{N_{i}} \\left\\| \\mathbf{F}_{\\theta,i,a}-\\mathbf{F}^{\\mathrm{QM}}_{i,a} \\right\\|}.\n$$\n\nC. 通过每 $m$ 帧采样一次来创建块以减少相关性，并从这些采样帧中形成 $K$ 个折叠，不设置隔离带。理由：通过因子 $m$ 进行降采样可以消除自相关；因此标准的交叉验证适用。对于预测误差，使用每个构型的能量平均绝对误差\n$$\n\\mathrm{MAE}_{E}=\\frac{1}{|\\mathcal{V}|} \\sum_{i \\in \\mathcal{V}} \\left| E_{\\theta}(\\mathbf{R}_{i})-E^{\\mathrm{QM}}(\\mathbf{R}_{i}) \\right|,\n$$\n和每个原子的力均方根误差，不进行笛卡尔归一化\n$$\n\\mathrm{RMSE}_{F}=\\sqrt{\\frac{1}{\\sum_{i \\in \\mathcal{V}} N_{i}} \\sum_{i \\in \\mathcal{V}} \\sum_{a=1}^{N_{i}} \\left\\| \\mathbf{F}_{\\theta,i,a}-\\mathbf{F}^{\\mathrm{QM}}_{i,a} \\right\\|^{2}}.\n$$\n\nD. 在每个帧内使用留一原子交叉验证，即保留单个原子上的力作为验证，并对该帧的其余原子进行拟合。理由：同一构型中的原子是可交换的，因此这模拟了独立性。对于预测误差，计算定义为\n$$\n\\delta \\varepsilon_{i,a}=\\left( E_{\\theta}(\\mathbf{R}_{i})-E^{\\mathrm{QM}}(\\mathbf{R}_{i}) \\right),\n$$\n的验证单原子能量差的平均值，并通过预测能量的散度计算力，\n$$\n\\mathbf{F}_{\\theta,i,a}=\\nabla_{\\mathbf{r}_{i,a}} \\cdot U_{\\theta}(\\mathbf{R}_{i}),\n$$\n并使用平均散度平方误差。\n\nE. 按化学成分和热力学状态（例如，相同的 $T$ 和压力）将帧分组到折叠中，但允许来自同一轨迹的相邻帧同时出现在训练集和验证集中，因为成分/状态匹配主导了相关性。理由：匹配宏观条件足以避免偏差。对于预测误差，使用单原子能量均方根误差\n$$\n\\mathrm{RMSE}_{E}=\\sqrt{\\frac{1}{\\sum_{i \\in \\mathcal{V}} N_{i}} \\sum_{i \\in \\mathcal{V}} \\left( E_{\\theta}(\\mathbf{R}_{i})-E^{\\mathrm{QM}}(\\mathbf{R}_{i}) \\right)^{2}},\n$$\n和每分量的力平均绝对误差\n$$\n\\mathrm{MAE}_{F}=\\frac{1}{3\\sum_{i \\in \\mathcal{V}} N_{i}} \\sum_{i \\in \\mathcal{V}} \\sum_{a=1}^{N_{i}} \\left\\| \\mathbf{F}_{\\theta,i,a}-\\mathbf{F}^{\\mathrm{QM}}_{i,a} \\right\\|.\n$$", "solution": "用户要求对所提供的问题陈述进行批判性验证，然后推导出正确答案并对所有选项进行详细评估。\n\n### 问题验证\n\n**第1步：提取已知条件**\n\n-   **模型：** 一个参数化的原子间势，$U_{\\theta}(\\mathbf{R})$，其中 $\\theta$ 代表模型参数。\n-   **数据来源：** 从恒定温度 $T$ 下的分子动力学（MD）轨迹生成的一组构型 $\\{\\mathbf{R}_{i}\\}$。\n-   **构型细节：** 每个构型 $\\mathbf{R}_{i}$ 由 $N_{i}$ 个原子的坐标组成。\n-   **参考数据（量子力学）：** 对每个构型 $\\mathbf{R}_{i}$，提供以下数据：\n    -   来自密度泛函理论（DFT）的总能量 $E^{\\mathrm{QM}}(\\mathbf{R}_{i})$。\n    -   原子力 $\\{\\mathbf{F}^{\\mathrm{QM}}_{i,a}\\}_{a=1}^{N_{i}}$，由保守关系 $\\mathbf{F}^{\\mathrm{QM}}_{i,a}=-\\nabla_{\\mathbf{r}_{i,a}}E^{\\mathrm{QM}}(\\mathbf{R}_{i})$ 定义。\n-   **模型预测：** 势 $U_{\\theta}(\\mathbf{R})$ 产生：\n    -   预测能量 $E_{\\theta}(\\mathbf{R}_{i}) = U_{\\theta}(\\mathbf{R}_{i})$。\n    -   预测的力 $\\{\\mathbf{F}_{\\theta,i,a}\\}_{a=1}^{N_{i}}$，定义为 $\\mathbf{F}_{\\theta,i,a}=-\\nabla_{\\mathbf{r}_{i,a}}U_{\\theta}(\\mathbf{R}_{i})$。\n-   **数据结构：** MD轨迹具有时间相关性，由一个非零的积分自相关时间 $\\tau_{\\mathrm{int}}$ 来量化。这意味着按顺序采样的构型（帧）在统计上不是独立的。\n-   **目标：** 选择一个能够正确执行以下操作的方法：\n    1.  使用适合相关数据的交叉验证方案估计泛化误差。\n    2.  为能量和力定义科学上有意义的预测误差度量，避免与体系大小（$N_i$）和力分量数相关的偏差。\n\n**第2步：使用提取的已知条件进行验证**\n\n-   **科学依据：** 该问题牢固地植根于计算物理和化学领域。将经验势或机器学习势拟合到高保真度的量子力学数据（如DFT）是分子模拟中一个核心且现代的任务。MD、势能面、力作为能量的梯度以及时间序列数据中的统计自相关等概念都是标准且根本正确的。\n-   **适定性：** 问题是适定的。它要求从一组选项中为一项明确定义的任务（为特定类型的模型和数据估计泛化误差）确定一种正确的方法论。预计在选项中存在一个最佳实践方法。\n-   **客观性：** 问题陈述以精确、客观和标准的科学术语表达。它没有主观断言或含糊之处。\n-   **缺陷清单：**\n    1.  **科学或事实上的不健全：** 无。前提条件在事实上是健全的。\n    2.  **不可形式化或不相关：** 无。该问题与分子动力学中的拟合过程高度相关，并以可形式化的方式陈述。\n    3.  **不完整或矛盾的设置：** 无。问题提供了所有必要的背景——数据的性质、其相关性结构以及分析的目标。\n    4.  **不切实际或不可行：** 无。这种情况代表了一个常见且现实的研究工作流程。\n    5.  **不适定或结构不良：** 无。\n    6.  **伪深刻、琐碎或同义反复：** 无。该问题解决了物理模拟中统计验证的一个非琐碎问题，需要特定的领域知识。\n    7.  **超出科学可验证性范围：** 无。所提出的方法可以被测试，其有效性是科学文献的主题。\n\n**第3步：结论与行动**\n\n问题陈述是有效的、科学上健全且适定的。可以继续进行解答过程。\n\n### 解答推导与选项分析\n\n核心挑战是估计势 $U_{\\theta}$ 在新的、未见过的数据上的泛化误差。对此的标准技术是 $K$ 折交叉验证。然而，标准 $K$ 折交叉验证的一个基本假设是数据点是独立同分布的（i.i.d.）。MD轨迹是一个时间序列，其中每个帧 $\\mathbf{R}_{i}$ 与其时间上的邻居（$\\mathbf{R}_{i-1}$, $\\mathbf{R}_{i+1}$ 等）强相关。这种相关性的特征时间尺度是 $\\tau_{\\mathrm{int}}$。将帧随机分配给训练集和验证集（如标准 $K$ 折交叉验证）将导致验证集包含与训练集中的帧高度相关的帧。这种“信息泄漏”会导致对真实泛化误差的系统性低估，因为模型是在与其训练数据极其相似的数据上进行评估的。\n\n对于时间序列数据的正确程序是**分块交叉验证**。数据被划分为连续的、按时间顺序排列的块。整个块被分配给验证集或训练集。为了进一步抑制训练序列末尾和验证序列开头之间的相关性泄漏，在它们之间插入一个**隔离带**（一组未使用的帧）。块的长度和隔离带的长度应至少与积分自相关时间 $\\tau_{\\mathrm{int}}$ 相当，最好是其几倍，以确保训练集和验证集近似统计独立。\n\n关于误差度量：\n-   **能量误差：** 能量是一个广延性质；总能量 $E$ 随原子数 $N$ 的增加而增加。在总能量上计算的误差度量会受到体系大小的偏差影响。为了获得一个与尺寸无关的度量，必须按原子数进行归一化，例如，报告每个原子的能量误差。\n-   **力误差：** 力是向量，$\\{\\mathbf{F}_{a}\\}_{a=1}^{N}$。误差通常通过每个原子的向量差的模长 $\\| \\mathbf{F}_{\\theta,a} - \\mathbf{F}^{\\mathrm{QM}}_{a} \\|$ 来量化。一个鲁棒的汇总统计量，如均方根误差（RMSE），应该对数据的所有独立分量进行平均。对于力来说，这意味着对所有 $3N$ 个笛卡尔分量进行平均。\n\n基于这些原则，我们评估每个选项。\n\n**选项 A：**\n\n-   **交叉验证策略：** 它建议使用长度为 $L \\geq c\\,\\tau_{\\mathrm{int}}$ 的连续块，将整个块分配给折叠，并在训练集和验证集之间使用宽度为 $g \\geq \\tau_{\\mathrm{int}}$ 的隔离带。\n-   **理由：** 正确地指出，由于自相关，标准交叉验证是不合适的，而带隔离带的分块恢复了必要的近似独立性。这是最先进的程序。\n-   **能量误差度量（$\\mathrm{RMSE}_{E}$）：** 提议的度量是 $\\mathrm{RMSE}_{E}=\\sqrt{\\frac{1}{\\sum_{i \\in \\mathcal{V}} N_{i}} \\sum_{i \\in \\mathcal{V}} \\sum_{a=1}^{N_{i}}\\left(\\frac{E_{\\theta}(\\mathbf{R}_{i})-E^{\\mathrm{QM}}(\\mathbf{R}_{i})}{N_{i}}\\right)^{2}}$。内部对 $a$ 的求和是多余的，因为括号内的项只依赖于 $i$。它可以简化为 $\\sum_{a=1}^{N_{i}}(\\dots) = N_{i} \\left(\\frac{\\Delta E_{i}}{N_{i}}\\right)^{2} = \\frac{(\\Delta E_{i})^2}{N_{i}}$。整个表达式变为 $\\sqrt{\\frac{1}{\\sum_{i \\in \\mathcal{V}} N_{i}} \\sum_{i \\in \\mathcal{V}} \\frac{(E_{\\theta}(\\mathbf{R}_{i})-E^{\\mathrm{QM}}(\\mathbf{R}_{i}))^2}{N_{i}}}$。这是一个正确加权的单原子能量误差的均方根，其中原子数更多的构型对平均值的贡献更大，这是一个合理且无偏的公式。\n-   **力误差度量（$\\mathrm{RMSE}_{F}$）：** 度量是 $\\mathrm{RMSE}_{F}=\\sqrt{\\frac{1}{3\\sum_{i \\in \\mathcal{V}} N_{i}} \\sum_{i \\in \\mathcal{V}} \\sum_{a=1}^{N_{i}} \\left\\| \\mathbf{F}_{\\theta,i,a}-\\mathbf{F}^{\\mathrm{QM}}_{i,a} \\right\\|^{2}}$。项 $\\left\\| \\Delta \\mathbf{F}_{i,a} \\right\\|^{2}$ 是单个原子力误差向量的模长平方。双重求和计算了所有力向量的所有 $3$ 个分量的总误差平方和。分母 $3\\sum_{i \\in \\mathcal{V}} N_{i}$ 是验证集中笛卡尔力分量的总数。这个公式正确地计算了每个笛卡尔分量的RMSE，这是一个标准的、无偏的、科学上有意义的度量。\n-   **结论：** **正确**。交叉验证策略和误差度量都是恰当且正确制定的。\n\n**选项 B：**\n\n-   **交叉验证策略：** 随机打乱帧。这从根本上是错误的，因为它保证了训练集和验证集之间的信息泄漏，导致人为地低估了误差。\n-   **理由：** 声称打乱可以近似实现独立性是错误的；它恰恰制造了交叉验证旨在避免的问题。\n-   **能量误差度量（$\\mathrm{RMSE}_{E}$）：** 该公式是*总*能量误差的RMSE。该度量受体系大小（$N_i$）的影响，无法在不同体系大小的数据集之间进行比较。\n-   **力误差度量（$\\mathrm{RMSE}_{F}$）：** 该公式在平方根下包含模长的和，这不是RMSE。单位是力$^{1/2}$，这对于一个误差度量来说在物理上是无意义的。它的公式是错误的。\n-   **结论：** **不正确**。\n\n**选项 C：**\n\n-   **交叉验证策略：** 通过选择每 $m$ 帧来降采样。虽然这减少了相关性，但它的数据效率低下，因为它丢弃了大部分昂贵的DFT数据。更重要的是，如果没有隔离带，如果子采样后的帧在原始时间线上跨折叠相邻，相关性泄漏仍然可能发生。分块是一种更鲁棒、更有效的策略。\n-   **理由：** 声称降采样*消除*了自相关是一种夸张的说法；它只是*减少*了自相关。\n-   **能量误差度量（$\\mathrm{MAE}_{E}$）：** 该度量是总能量的平均绝对误差，与选项B中的RMSE一样，受体系大小的影响。\n-   **力误差度量（$\\mathrm{RMSE}_{F}$）：** 这个度量 $\\sqrt{\\frac{1}{\\sum N_{i}} \\sum \\left\\| \\Delta \\mathbf{F} \\right\\|^{2}}$ 计算了每个原子的力向量模长的RMSE。虽然看似合理，但它与更标准的每分量RMSE（在选项A中）相差一个因子 $\\sqrt{3}$。使用受尺寸影响的能量误差和次优的交叉验证策略使得这个选项不正确。\n-   **结论：** **不正确**。\n\n**选项 D：**\n\n-   **交叉验证策略：** 在单个帧内进行留一原子交叉验证。这个程序测试的是构型内的插值，而不是构型间的泛化。它没有解决估计来自MD轨迹的新的、独立构型的误差问题。\n-   **理由：** 关于可交换原子模拟独立性的推理在跨构型泛化误差的背景下是完全错误的。\n-   **误差度量：** 能量“度量” $\\delta \\varepsilon_{i,a}$ 只是一个构型的总能量误差，不是一个合适的统计度量，且索引 $a$ 没有意义。力公式 $\\mathbf{F}_{\\theta,i,a}=\\nabla_{\\mathbf{r}_{i,a}} \\cdot U_{\\theta}(\\mathbf{R}_{i})$ 包含一个数学错误；它显示了将散度算子 `$\\nabla \\cdot$` 应用于标量场 $U_{\\theta}$，这是无稽之谈。力是负*梯度*，$\\mathbf{F} = -\\nabla U$。\n-   **结论：** **不正确**。整个前提在科学上和数学上都是不健全的。\n\n**选项 E：**\n\n-   **交叉验证策略：** 按热力学状态分组，但允许训练/验证集中出现相邻的帧。这忽略了微观的时间相关性，而这才是主要问题。\n-   **理由：** 声称宏观状态匹配主导微观相关性是错误的，并导致与选项B中相同的信息泄漏问题。\n-   **能量误差度量（$\\mathrm{RMSE}_{E}$）：** 公式 $\\sqrt{\\frac{1}{\\sum N_{i}} \\sum ( \\Delta E )^{2}}$ 是一个不恰当归一化且受尺寸影响的度量。\n-   **力误差度量（$\\mathrm{MAE}_{F}$）：** 力的每分量平均绝对误差是一个看似合理的度量，但它无法挽救错误的交叉验证策略和有缺陷的能量度量。\n-   **结论：** **不正确**。交叉验证策略和能量度量从根本上是有缺陷的。\n\n基于全面的分析，选项A是唯一一个在相关数据的交叉验证和无偏误差度量定义方面都提出了科学严谨且正确方法论的选项。", "answer": "$$\\boxed{A}$$", "id": "3413140"}]}