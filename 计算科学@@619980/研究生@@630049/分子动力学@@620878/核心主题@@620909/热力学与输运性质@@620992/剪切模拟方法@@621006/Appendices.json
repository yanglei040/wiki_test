{"hands_on_practices": [{"introduction": "为了在周期性系统中模拟剪切流，我们必须正确地将空间的连续变形映射到离散的模拟盒子中。这个练习旨在建立简单剪切流的连续速度场与Lees-Edwards边界条件中使用的特定坐标变换之间的基本联系，这是许多非平衡模拟的基石[@problem_id:3445268]。通过从第一性原理出发进行推导，您将清晰地理解宏观流动如何在微观层面得到体现。", "problem": "考虑一个均匀平面简单剪切流的三维分子动力学模拟，其流动沿 $x$ 方向，梯度沿 $y$ 方向。施加的剪切速率是恒定的，记为 $\\dot{\\gamma}$。因此，连续介质速度场是均匀的，并由 $v_{x}(\\mathbf{r},t)=\\dot{\\gamma}\\,y$、$v_{y}(\\mathbf{r},t)=0$ 和 $v_{z}(\\mathbf{r},t)=0$ 给出。设一个质点的初始位置为 $\\mathbf{r}(0)=(x_{0},y_{0},z_{0})$，并将累积应变定义为 $\\gamma(t)=\\dot{\\gamma}\\,t$。假设变形是纯仿射的（没有非仿射涨落）。\n\n仅从运动学关系 $\\mathrm{d}\\mathbf{r}/\\mathrm{d}t=\\mathbf{v}(\\mathbf{r},t)$ 和给定的速度场出发，推导对于任意 $t\\ge 0$ 时 $\\mathbf{r}(t)$ 的显式时间演化，以笛卡尔分量 $(x(t),y(t),z(t))$ 表示。然后，考虑一个三斜周期性晶胞，该晶胞特化为一个边长为 $L_{x}$、$L_{y}$ 和 $L_{z}$ 的正交参考系，并服从 Lees–Edwards 边界条件（滑动周期性边界）。当一个粒子穿过 $y=+L_{y}/2$ 处的上边界，并通过设置 $y\\mapsto y-L_{y}$ 被重新映射回主盒子时，确定必须同时应用的单一仿射 $x$ 位移 $\\Delta x_{\\mathrm{LE}}(t)$，以在周期性延拓系统中保持均匀剪切映射。\n\n你的最终答案必须是一个单行矩阵，依次包含 $x(t)$、$y(t)$、$z(t)$ 和 $\\Delta x_{\\mathrm{LE}}(t)$，并用 $x_{0}$、$y_{0}$、$z_{0}$、$\\gamma(t)$ 和 $L_{y}$ 表示。最终答案中不要包含单位。不需要进行数值舍入。", "solution": "该问题被认为是有效的，因为它以连续介质力学和分子动力学的原理为科学基础，是适定的（具有足够的信息以获得唯一解），并且使用客观、正式的语言进行陈述。\n\n解答过程分为两部分：首先，推导仿射剪切变形下的粒子轨迹；其次，确定 Lees-Edwards 边界条件所要求的坐标位移。\n\n第1部分：粒子轨迹 $\\mathbf{r}(t)$ 的推导\n\n质点的运动由运动学关系 $\\mathrm{d}\\mathbf{r}/\\mathrm{d}t = \\mathbf{v}(\\mathbf{r},t)$ 决定，其中 $\\mathbf{r}(t) = (x(t), y(t), z(t))$ 是在时间 $t$ 的位置矢量。施加的速度场由 $v_{x}(\\mathbf{r},t)=\\dot{\\gamma}\\,y$、$v_{y}(\\mathbf{r},t)=0$ 和 $v_{z}(\\mathbf{r},t)=0$ 给出。这为 $\\mathbf{r}(t)$ 的分量提供了一个一阶常微分方程组（ODEs）：\n$$\n\\frac{\\mathrm{d}x}{\\mathrm{d}t} = \\dot{\\gamma}\\,y(t)\n$$\n$$\n\\frac{\\mathrm{d}y}{\\mathrm{d}t} = 0\n$$\n$$\n\\frac{\\mathrm{d}z}{\\mathrm{d}t} = 0\n$$\n初始条件指定为 $\\mathbf{r}(0) = (x_0, y_0, z_0)$。\n\n我们首先求解 $y(t)$ 和 $z(t)$ 的方程。\n将 $\\mathrm{d}y/\\mathrm{d}t = 0$ 从 $t=0$ 积分到任意时间 $t$：\n$$\n\\int_{y(0)}^{y(t)} \\mathrm{d}y' = \\int_{0}^{t} 0\\,\\mathrm{d}t' \\implies y(t) - y_0 = 0 \\implies y(t) = y_0\n$$\n类似地，对于 $z$ 分量：\n$$\n\\int_{z(0)}^{z(t)} \\mathrm{d}z' = \\int_{0}^{t} 0\\,\\mathrm{d}t' \\implies z(t) - z_0 = 0 \\implies z(t) = z_0\n$$\n质点的 $y$ 和 $z$ 坐标随时间保持不变，等于其初始值。\n\n现在，我们求解 $x$ 分量。将 $y(t) = y_0$ 代入 $x(t)$ 的常微分方程：\n$$\n\\frac{\\mathrm{d}x}{\\mathrm{d}t} = \\dot{\\gamma}\\,y_0\n$$\n由于 $\\dot{\\gamma}$ 和 $y_0$ 都是常数，我们可以直接对该方程从 $t=0$ 到 $t$ 进行时间积分：\n$$\n\\int_{x(0)}^{x(t)} \\mathrm{d}x' = \\int_{0}^{t} \\dot{\\gamma}\\,y_0\\,\\mathrm{d}t' \\implies x(t) - x_0 = \\dot{\\gamma}\\,y_0\\,t\n$$\n这给出了 $x(t)$ 的解：\n$$\nx(t) = x_0 + \\dot{\\gamma}\\,y_0\\,t\n$$\n题目将累积应变定义为 $\\gamma(t) = \\dot{\\gamma}\\,t$。将此代入 $x(t)$ 的表达式中：\n$$\nx(t) = x_0 + y_0\\,\\gamma(t)\n$$\n总而言之，纯仿射变形的位置矢量的时间演化为：\n$$\n\\mathbf{r}(t) = (x(t), y(t), z(t)) = (x_0 + y_0\\,\\gamma(t), y_0, z_0)\n$$\n\n第2部分：Lees-Edwards 边界条件位移 $\\Delta x_{\\mathrm{LE}}(t)$ 的推导\n\nLees-Edwards 边界条件通过使模拟晶胞随时间变形来模拟周期性系统中的剪切。一个初始基矢为 $\\mathbf{a}_1(0)=(L_x, 0, 0)$、$\\mathbf{a}_2(0)=(0, L_y, 0)$ 和 $\\mathbf{a}_3(0)=(0, 0, L_z)$ 的正交盒子变形为一个三斜盒子。随时间变化的基矢是通过应用变形梯度张量得到的，该张量对应于上面推导的仿射映射。\n仿射变换为 $\\mathbf{r}(t) = \\mathbf{F}(t)\\cdot\\mathbf{r}(0)$，其中变形梯度张量 $\\mathbf{F}(t)$ 是：\n$$\n\\mathbf{F}(t) = \\begin{pmatrix} 1  \\gamma(t)  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\n在时间 $t$ 的基矢为 $\\mathbf{a}_i(t) = \\mathbf{F}(t)\\cdot\\mathbf{a}_i(0)$。\n$$\n\\mathbf{a}_1(t) = \\mathbf{F}(t)\\cdot(L_x, 0, 0)^T = (L_x, 0, 0)^T\n$$\n$$\n\\mathbf{a}_2(t) = \\mathbf{F}(t)\\cdot(0, L_y, 0)^T = (\\gamma(t) L_y, L_y, 0)^T\n$$\n$$\n\\mathbf{a}_3(t) = \\mathbf{F}(t)\\cdot(0, 0, L_z)^T = (0, 0, L_z)^T\n$$\n周期性镜像晶格的几何形状由这些随时间变化的矢量描述。镜像粒子位置 $\\mathbf{r}_{\\text{image}}$ 与主盒子中粒子位置 $\\mathbf{r}_{\\text{primary}}$ 的关系为 $\\mathbf{r}_{\\text{image}} = \\mathbf{r}_{\\text{primary}} + n_1\\mathbf{a}_1(t) + n_2\\mathbf{a}_2(t) + n_3\\mathbf{a}_3(t)$，其中 $n_1, n_2, n_3$ 为整数。\n\n该问题考虑一个粒子穿过主模拟晶胞的上边界（通常定义为 $y \\in [-L_y/2, L_y/2)$）。当一个粒子的 $y$ 坐标超过 $L_y/2$ 时，它实际上已经进入了主晶胞“上方”的周期性镜像晶胞，这对应于晶格矢量 $\\mathbf{a}_2(t)$（即 $n_2=1$，$n_1=0$，$n_3=0$）。\n\n为了将粒子重新映射回主晶胞，其坐标必须平移该晶格矢量的负值。设 $\\mathbf{r}_{\\text{old}}$ 为重新映射前的坐标，$\\mathbf{r}_{\\text{new}}$ 为重新映射后的坐标。变换为：\n$$\n\\mathbf{r}_{\\text{new}} = \\mathbf{r}_{\\text{old}} - \\mathbf{a}_2(t)\n$$\n以分量形式表示，这给出：\n$$\nx_{\\text{new}} = x_{\\text{old}} - (\\gamma(t) L_y)\n$$\n$$\ny_{\\text{new}} = y_{\\text{old}} - L_y\n$$\n$$\nz_{\\text{new}} = z_{\\text{old}} - 0\n$$\n题目陈述，当重新映射 $y \\mapsto y-L_y$ 发生时，一个同时发生的位移 $\\Delta x_{\\mathrm{LE}}(t)$ 应用于 $x$ 坐标，使得 $x_{\\text{new}} = x_{\\text{old}} + \\Delta x_{\\mathrm{LE}}(t)$。\n通过将我们推导出的 $x$ 的变换与此定义进行比较，我们可以确定该位移：\n$$\n\\Delta x_{\\mathrm{LE}}(t) = - \\gamma(t) L_y\n$$\n该位移是仿射的，因为它仅取决于全局累积应变 $\\gamma(t)$ 和盒子高度 $L_y$，而不取决于单个粒子的坐标。\n\n因此，所要求的四个量是：\n1. $x(t) = x_0 + y_0\\,\\gamma(t)$\n2. $y(t) = y_0$\n3. $z(t) = z_0$\n4. $\\Delta x_{\\mathrm{LE}}(t) = - \\gamma(t) L_y$\n它们被组合成一个单行矩阵作为最终答案。", "answer": "$$\n\\boxed{\\begin{pmatrix} x_0 + y_0 \\gamma(t)  y_0  z_0  -\\gamma(t) L_y \\end{pmatrix}}\n$$", "id": "3445268"}, {"introduction": "在掌握了剪切边界的运动学基础后，本实践将深入探讨最小镜像约定（minimum image convention）在实现过程中的关键细节。这个动手编程练习将清晰地展示，如果天真地应用周期性边界条件，将会导致错误的力计算和模拟伪影[@problem_id:3445317]。通过比较一个正确的、考虑了Lees-Edwards边界的算法与一个简化的错误算法，您将能够量化误差，并理解为何精确的几何处理对于准确的剪切模拟是不可或缺的。", "problem": "您需要编写一个完整、可运行的程序，用于在二维分子动力学设置中，在 Lees-Edwards 边界条件下验证剪切周期性重映的最小镜像约定，并量化在周期性包裹过程中若忽略剪切引起的水平位移所产生的力误差。该程序必须从第一性原理实现物理和几何，并为给定的测试套件生成一个汇总结果的单行输出。\n\n您必须使用的基本基础是牛顿定律以及运动学和粒子间力的核心定义：(i) 牛顿第二定律，$m\\,d^2\\mathbf{r}/dt^2=\\mathbf{F}$，(ii) $\\mathbf{v}=d\\mathbf{r}/dt$，(iii) 粒子间力为势的负梯度，$\\mathbf{F}(\\mathbf{r})=-\\nabla U(\\mathbf{r})$。剪切流是沿 x 方向的简单剪切，其梯度在 y 方向上。周期性边界条件是 Lees-Edwards，它规定在执行最小镜像包裹时，x 方向的位移与 y 方向板层的穿越次数成正比。\n\n几何与重映：\n- 考虑位于边长为 $L_x$ 和 $L_y$ 的二维矩形域中的两个粒子，其位置分别为 $\\mathbf{r}_i=(x_i,y_i)$ 和 $\\mathbf{r}_j=(x_j,y_j)$。\n- 令 $s$ 表示每次穿越 y 晶胞时由剪切引起的 x 位移，其值为 $s=\\dot{\\gamma}\\,t\\,L_y$，其中 $\\dot{\\gamma}$ 是剪切速率，t 是时间。在本问题中，$s$ 被视为一个给定参数。\n- 将原始分离分量定义为 $\\Delta x_{\\text{raw}}=x_j-x_i$ 和 $\\Delta y_{\\text{raw}}=y_j-y_i$。\n- 在 Lees-Edwards 边界条件下，正确的剪切最小镜像分离按如下方式构建：\n  1. 计算 $n_y=\\operatorname{round}(\\Delta y_{\\text{raw}}/L_y)$，这是将 y 方向的分离带入主区间所需的 y 晶胞穿越的最近整数次数。\n  2. 计算 y 包裹后的分离 $\\Delta y=\\Delta y_{\\text{raw}}-n_y\\,L_y$。\n  3. 应用剪切引起的 x 位移和 x 包裹：$\\Delta x=\\Delta x_{\\text{raw}}-n_y\\,s$，然后计算 $n_x=\\operatorname{round}(\\Delta x/L_x)$，最后 $\\Delta x\\leftarrow\\Delta x-n_x\\,L_x$。\n- 忽略剪切的、不正确的朴素最小镜像分离仅使用标准包裹（无 x 位移）：$\\Delta y_{\\text{naive}}=\\Delta y_{\\text{raw}}-n_y\\,L_y$，其中 $n_y=\\operatorname{round}(\\Delta y_{\\text{raw}}/L_y)$；以及 $\\Delta x_{\\text{naive}}=\\Delta x_{\\text{raw}}-n_x\\,L_x$，其中 $n_x=\\operatorname{round}(\\Delta x_{\\text{raw}}/L_x)$。\n\n粒子间力：\n- 使用约化单位（Lennard-Jones 单位）下的 Lennard-Jones 对势，其中 $\\sigma=1$ 和 $\\epsilon=1$，并使用对截断半径 $r_c$。\n- 对力必须由势的负梯度计算得出。截断按如下方式执行：如果标量分离 $r=\\sqrt{\\Delta x^2+\\Delta y^2}$ 满足 $r\\ge r_c$，则力为 $\\mathbf{F}=\\mathbf{0}$；否则，计算非零的 Lennard-Jones 力。\n\n量化力误差：\n- 对于每个测试用例，分别使用正确的剪切最小镜像分离和忽略剪切的朴素分离计算力矢量 $\\mathbf{F}_{\\text{correct}}$ 和 $\\mathbf{F}_{\\text{naive}}$。\n- 将误差度量定义为两个力矢量之差的欧几里得范数：$E=\\|\\mathbf{F}_{\\text{correct}}-\\mathbf{F}_{\\text{naive}}\\|$。此量在 Lennard-Jones 约化单位中是无量纲的。\n\n单位：\n- 所有长度必须以 Lennard-Jones 约化单位处理，其中 $\\sigma=1$。力在 Lennard-Jones 约化单位中必须是无量纲的。最终答案必须是无量纲的浮点数。\n\n测试套件：\n实现以下四个测试用例，每个用例由 $(L_x,L_y,s,x_i,y_i,x_j,y_j,r_c)$ 指定：\n1. 基线，无剪切：$(L_x,L_y,s)=(10,10,0)$，粒子 $(x_i,y_i)=(1.0,1.0)$ 和 $(x_j,y_j)=(3.4,2.0)$，截断半径 $r_c=2.5$。这是一个两种方法结果一致的理想情况。\n2. 小 $L_y$ 的剪切，产生一个接近截断半径的边界情况（正确方法计算结果在截断半径内，朴素方法在截断半径外）：$(L_x,L_y,s)=(10,2,2)$，粒子 $(x_i,y_i)=(9.0,0.95)$ 和 $(x_j,y_j)=(1.55,2.05)$，截断半径 $r_c=2.5$。\n3. 小 $L_y$ 的剪切，产生相反的边界情况（正确方法计算结果在截断半径外，朴素方法在截断半径内）：$(L_x,L_y,s)=(10,2,2)$，粒子 $(x_i,y_i)=(9.0,0.95)$ 和 $(x_j,y_j)=(7.0,2.05)$，截断半径 $r_c=2.5$。\n4. 大剪切幅度，以测试剪切包裹的鲁棒性：$(L_x,L_y,s)=(10,2,12)$，粒子 $(x_i,y_i)=(9.0,0.95)$ 和 $(x_j,y_j)=(1.55,2.05)$，截断半径 $r_c=2.5$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含四个测试用例的误差结果，格式为方括号内以逗号分隔的列表，例如 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4]$，其中每个 $\\text{result}_k$ 是一个 Lennard-Jones 约化单位下的浮点数。", "solution": "该问题要求对在稳态剪切流下的二维分子动力学模拟中，因不正确应用最小镜像约定 (MIC) 而引入的误差进行定量分析。具体来说，我们将比较使用正确的 Lees-Edwards 周期性边界条件计算的粒子间力，与忽略了空间维度间剪切耦合的朴素实现所计算的力。此分析将针对四个特定的测试用例进行。\n\n这个问题的科学基础是牛顿力学和凝聚态物质的统计力学。粒子间的力由势能函数导出，而模拟域的周期性则通过适用于剪切系统的特定几何映射算法来处理。\n\n首先，我们来定义粒子间的相互作用。问题指定了在约化单位下的 Lennard-Jones (LJ) 势 $U(r)$，其中能量标度 $\\epsilon$ 和长度标度 $\\sigma$ 均为1。该势由以下公式给出：\n$$\nU(r) = 4\\epsilon \\left[ \\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6} \\right] \\quad \\xrightarrow{\\epsilon=1, \\sigma=1} \\quad U(r) = 4\\left(r^{-12} - r^{-6}\\right)\n$$\n其中 $r$ 是两个粒子间的标量距离。应用了截断距离 $r_c$，使得当 $r \\ge r_c$ 时相互作用为零。\n\n一个粒子受另一个粒子作用的力 $\\mathbf{F}$ 是势的负梯度，$\\mathbf{F} = -\\nabla U(r)$。由于 $U$ 是分离矢量 $\\mathbf{r}$ 的模 $r = \\|\\mathbf{r}\\|$ 的函数，我们使用链式法则：\n$$\n\\mathbf{F}(\\mathbf{r}) = -\\frac{dU}{dr} \\frac{\\partial r}{\\partial \\mathbf{r}} = -\\frac{dU}{dr} \\frac{\\mathbf{r}}{r}\n$$\n势对 $r$ 的导数是：\n$$\n\\frac{dU}{dr} = 4 \\left( -12r^{-13} + 6r^{-7} \\right) = -24 \\left( 2r^{-13} - r^{-7} \\right)\n$$\n将此代入力表达式，得到：\n$$\n\\mathbf{F}(\\mathbf{r}) = 24 \\left( 2r^{-13} - r^{-7} \\right) \\frac{\\mathbf{r}}{r} = \\left( 48r^{-14} - 24r^{-8} \\right) \\mathbf{r}\n$$\n如果 $r  r_c$，则计算此力；否则，$\\mathbf{F} = \\mathbf{0}$。\n\n接下来，我们处理问题的核心：在尺寸为 $L_x \\times L_y$ 的剪切周期域中计算最小镜像分离矢量 $\\mathbf{r} = (\\Delta x, \\Delta y)$。对于位于绝对位置 $\\mathbf{r}_i = (x_i, y_i)$ 和 $\\mathbf{r}_j = (x_j, y_j)$ 的两个粒子，原始分离为 $\\mathbf{r}_{\\text{raw}} = \\mathbf{r}_j - \\mathbf{r}_i = (\\Delta x_{\\text{raw}}, \\Delta y_{\\text{raw}})$。\n\n朴素最小镜像约定忽略了剪切。它将分离矢量的 x 和 y 分量独立地包裹到中心周期性盒子中，其范围是从 $-L/2$ 到 $L/2$。\n1. 包裹 y 分量：$\\Delta y_{\\text{naive}} = \\Delta y_{\\text{raw}} - L_y \\cdot \\operatorname{round}(\\Delta y_{\\text{raw}} / L_y)$。\n2. 包裹 x 分量：$\\Delta x_{\\text{naive}} = \\Delta x_{\\text{raw}} - L_x \\cdot \\operatorname{round}(\\Delta x_{\\text{raw}} / L_x)$。\n朴素分离矢量为 $\\mathbf{r}_{\\text{naive}} = (\\Delta x_{\\text{naive}}, \\Delta y_{\\text{naive}})$。\n\n正确的 Lees-Edwards 边界条件考虑了模拟盒子正在变形这一事实。一个粒子在 y 方向上穿越边界时，会被重映并附加一个 x 方向的位移。总累积的 x 位移由 $s$ 给出。算法如下：\n1. 计算穿越的 y 镜像数量：$n_y = \\operatorname{round}(\\Delta y_{\\text{raw}} / L_y)$。\n2. 像之前一样包裹 y 分量：$\\Delta y = \\Delta y_{\\text{raw}} - n_y L_y$。\n3. 将剪切引起的位移应用于原始 x 分离：$\\Delta x_{\\text{shifted}} = \\Delta x_{\\text{raw}} - n_y s$。\n4. 包裹移位后的 x 分量：$\\Delta x = \\Delta x_{\\text{shifted}} - L_x \\cdot \\operatorname{round}(\\Delta x_{\\text{shifted}} / L_x)$。\n正确的剪切分离矢量为 $\\mathbf{r}_{\\text{correct}} = (\\Delta x, \\Delta y)$。\n\n需要量化的误差是使用正确的 Lees-Edwards 分离计算的力矢量 $\\mathbf{F}_{\\text{correct}}$ 与使用朴素分离计算的力矢量 $\\mathbf{F}_{\\text{naive}}$ 之差的欧几里得范数：\n$$\nE = \\| \\mathbf{F}_{\\text{correct}} - \\mathbf{F}_{\\text{naive}} \\|\n$$\n\n我们现在将这个框架应用于四个测试用例。所有计算将使用 $\\operatorname{round()}$ 函数，其行为是四舍五入到最近的整数，其中 .5 向最近的偶数取整（这是 Python/NumPy 中的标准行为）。\n\n用例 1: $(L_x, L_y, s, x_i, y_i, x_j, y_j, r_c) = (10, 10, 0, 1.0, 1.0, 3.4, 2.0, 2.5)$。\n- $\\mathbf{r}_{\\text{raw}} = (2.4, 1.0)$。\n- 由于 $s=0$ 且没有穿越边界（$n_y=\\operatorname{round}(1.0/10)=0$, $n_x=\\operatorname{round}(2.4/10)=0$），两种方法得到相同的分离矢量：$\\mathbf{r}_{\\text{correct}} = \\mathbf{r}_{\\text{naive}} = (2.4, 1.0)$。\n- 距离为 $r = \\sqrt{2.4^2 + 1.0^2} = \\sqrt{6.76} = 2.6$。\n- 由于 $r = 2.6 > r_c = 2.5$，两个力都为零：$\\mathbf{F}_{\\text{correct}} = \\mathbf{F}_{\\text{naive}} = \\mathbf{0}$。\n- 误差为 $E_1 = \\|\\mathbf{0} - \\mathbf{0}\\| = 0.0$。\n\n用例 2: $(L_x, L_y, s, x_i, y_i, x_j, y_j, r_c) = (10, 2, 2, 9.0, 0.95, 1.55, 2.05, 2.5)$。\n- $\\mathbf{r}_{\\text{raw}} = (1.55 - 9.0, 2.05 - 0.95) = (-7.45, 1.1)$。\n- 正确的 Lees-Edwards：\n  - $n_y = \\operatorname{round}(1.1/2) = \\operatorname{round}(0.55) = 1$。\n  - $\\Delta y = 1.1 - 1 \\cdot 2 = -0.9$。\n  - $\\Delta x_{\\text{shifted}} = -7.45 - 1 \\cdot s = -7.45 - 2 = -9.45$。\n  - $\\Delta x = -9.45 - 10 \\cdot \\operatorname{round}(-9.45/10) = -9.45 - 10 \\cdot (-1) = 0.55$。\n  - $\\mathbf{r}_{\\text{correct}} = (0.55, -0.9)$。$r_{\\text{correct}} = \\sqrt{0.55^2 + (-0.9)^2} = \\sqrt{1.1125} \\approx 1.055  r_c$。\n- 朴素 MIC：\n  - $\\Delta y_{\\text{naive}} = 1.1 - 1 \\cdot 2 = -0.9$。\n  - $\\Delta x_{\\text{naive}} = -7.45 - 10 \\cdot \\operatorname{round}(-7.45/10) = -7.45 - 10 \\cdot (-1) = 2.55$。\n  - $\\mathbf{r}_{\\text{naive}} = (2.55, -0.9)$。$r_{\\text{naive}} = \\sqrt{2.55^2 + (-0.9)^2} = \\sqrt{7.3125} \\approx 2.704 > r_c$。\n- 在这里，$\\mathbf{F}_{\\text{correct}}$ 是非零的，而 $\\mathbf{F}_{\\text{naive}} = \\mathbf{0}$。误差 $E_2$ 是 $\\mathbf{F}_{\\text{correct}}$ 的大小。\n- 对于 $\\mathbf{r}_{\\text{correct}}$，力的标量前因子为 $(48(1.055)^{-14} - 24(1.055)^{-8}) \\approx 6.566$。\n- $\\mathbf{F}_{\\text{correct}} \\approx 6.566 \\cdot (0.55, -0.9) = (3.611, -5.909)$。\n- $E_2 = \\|\\mathbf{F}_{\\text{correct}}\\| = \\sqrt{3.611^2 + (-5.909)^2} \\approx 6.925$。\n\n用例 3: $(L_x, L_y, s, x_i, y_i, x_j, y_j, r_c) = (10, 2, 2, 9.0, 0.95, 7.0, 2.05, 2.5)$。\n- $\\mathbf{r}_{\\text{raw}} = (7.0 - 9.0, 2.05 - 0.95) = (-2.0, 1.1)$。\n- 正确的 Lees-Edwards：\n  - $n_y = \\operatorname{round}(1.1/2) = 1$。\n  - $\\Delta y = 1.1 - 1 \\cdot 2 = -0.9$。\n  - $\\Delta x_{\\text{shifted}} = -2.0 - 1 \\cdot s = -2.0 - 2 = -4.0$。\n  - $\\Delta x = -4.0 - 10 \\cdot \\operatorname{round}(-4.0/10) = -4.0 - 10 \\cdot 0 = -4.0$。\n  - $\\mathbf{r}_{\\text{correct}} = (-4.0, -0.9)$。$r_{\\text{correct}} = \\sqrt{(-4.0)^2 + (-0.9)^2} = \\sqrt{16.81} = 4.1 > r_c$。\n- 朴素 MIC：\n  - $\\Delta y_{\\text{naive}} = 1.1 - 1 \\cdot 2 = -0.9$。\n  - $\\Delta x_{\\text{naive}} = -2.0 - 10 \\cdot \\operatorname{round}(-2.0/10) = -2.0 - 10 \\cdot 0 = -2.0$。\n  - $\\mathbf{r}_{\\text{naive}} = (-2.0, -0.9)$。$r_{\\text{naive}} = \\sqrt{(-2.0)^2 + (-0.9)^2} = \\sqrt{4.81} \\approx 2.193  r_c$。\n- 在这里，$\\mathbf{F}_{\\text{correct}} = \\mathbf{0}$，而 $\\mathbf{F}_{\\text{naive}}$ 是非零的。误差 $E_3$ 是 $\\mathbf{F}_{\\text{naive}}$ 的大小。\n- 对于 $\\mathbf{r}_{\\text{naive}}$，力的标量前因子为 $(48(2.193)^{-14} - 24(2.193)^{-8}) \\approx -0.044$。\n- $\\mathbf{F}_{\\text{naive}} \\approx -0.044 \\cdot (-2.0, -0.9) = (0.089, 0.040)$。\n- $E_3 = \\|\\mathbf{F}_{\\text{naive}}\\| = \\sqrt{0.089^2 + 0.040^2} \\approx 0.097$。\n\n用例 4: $(L_x, L_y, s, x_i, y_i, x_j, y_j, r_c) = (10, 2, 12, 9.0, 0.95, 1.55, 2.05, 2.5)$。\n- 粒子位置和域与用例 2 相同，只有剪切位移 $s$ 从 2 变为 12。\n- $\\mathbf{r}_{\\text{raw}} = (-7.45, 1.1)$。\n- 正确的 Lees-Edwards：\n  - $n_y = \\operatorname{round}(1.1/2) = 1$。\n  - $\\Delta y = 1.1 - 1 \\cdot 2 = -0.9$。\n  - $\\Delta x_{\\text{shifted}} = -7.45 - 1 \\cdot s = -7.45 - 12 = -19.45$。\n  - $\\Delta x = -19.45 - 10 \\cdot \\operatorname{round}(-19.45/10) = -19.45 - 10 \\cdot (-2) = 0.55$。\n  - $\\mathbf{r}_{\\text{correct}} = (0.55, -0.9)$，这与用例 2 中的结果完全相同。Lees-Edwards 算法通过在 x 方向上适当地选择周期镜像，正确地处理了大剪切。\n- 朴素 MIC：\n  - 朴素计算与 $s$ 无关，因此其结果与用例 2 相同：$\\mathbf{r}_{\\text{naive}} = (2.55, -0.9)$。\n- 由于 $\\mathbf{r}_{\\text{correct}}$ 和 $\\mathbf{r}_{\\text{naive}}$ 都与用例 2 中的相同，因此计算出的力 $\\mathbf{F}_{\\text{correct}}$ 和 $\\mathbf{F}_{\\text{naive}}$ 也相同。\n- 因此，误差是相同的：$E_4 = E_2 \\approx 6.925$。\n- 这证实了 Lees-Edwards 算法的鲁棒性。大剪切 $s=12$ 等效于位移 $s=2$，因为额外的位移 10 是 $L_x$ 的整数倍，并通过包裹到 x 方向的不同周期镜像而被吸收。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Validates and solves the problem of calculating force errors in a 2D sheared\n    system with Lees-Edwards boundary conditions versus a naive implementation.\n    \"\"\"\n\n    def calculate_force(r_vec, r_c, epsilon=1.0, sigma=1.0):\n        \"\"\"\n        Calculates the Lennard-Jones force for a given separation vector.\n\n        Args:\n            r_vec (np.ndarray): The 2D separation vector (dx, dy).\n            r_c (float): The cutoff distance.\n            epsilon (float): The LJ energy parameter (set to 1.0 for reduced units).\n            sigma (float): The LJ length parameter (set to 1.0 for reduced units).\n\n        Returns:\n            np.ndarray: The 2D force vector.\n        \"\"\"\n        r_sq = np.dot(r_vec, r_vec)\n        r_c_sq = r_c * r_c\n        \n        if r_sq = r_c_sq:\n            return np.array([0.0, 0.0])\n\n        # Use r_sq for calculations to avoid unnecessary sqrt\n        sigma_sq = sigma * sigma\n        inv_r_sq = sigma_sq / r_sq\n        inv_r_6 = inv_r_sq * inv_r_sq * inv_r_sq\n        inv_r_12 = inv_r_6 * inv_r_6\n\n        # F = (48 * eps * (inv_r_12 / sigma^2) - 24 * eps * (inv_r_6 / sigma^2)) * r_vec\n        # In reduced units (sigma=1, eps=1), this simplifies:\n        force_magnitude_over_r_sq = 4.0 * epsilon * (12.0 * inv_r_12 - 6.0 * inv_r_6) / r_sq\n        \n        # The formula from the derivation is F = (48*r^-14 - 24*r^-8)*r_vec\n        # Let's use it directly for clarity.\n        r = np.sqrt(r_sq)\n        scalar_part = 48.0 * epsilon * (sigma**12) / (r**14) - 24.0 * epsilon * (sigma**6) / (r**8)\n        \n        return scalar_part * r_vec\n\n    def get_separation(r_i, r_j, L, s, is_naive):\n        \"\"\"\n        Computes the minimum-image separation vector.\n\n        Args:\n            r_i (np.ndarray): Position of particle i.\n            r_j (np.ndarray): Position of particle j.\n            L (np.ndarray): Box dimensions (Lx, Ly).\n            s (float): Shear displacement.\n            is_naive (bool): True for naive MIC, False for Lees-Edwards.\n\n        Returns:\n            np.ndarray: The 2D minimum-image separation vector.\n        \"\"\"\n        r_raw = r_j - r_i\n        Lx, Ly = L[0], L[1]\n\n        if is_naive:\n            # Naive MIC: independent wrapping\n            ny = np.round(r_raw[1] / Ly)\n            dy = r_raw[1] - ny * Ly\n            \n            nx = np.round(r_raw[0] / Lx)\n            dx = r_raw[0] - nx * Lx\n        else:\n            # Correct Lees-Edwards MIC\n            ny = np.round(r_raw[1] / Ly)\n            dy = r_raw[1] - ny * Ly\n            \n            dx_shifted = r_raw[0] - ny * s\n            nx = np.round(dx_shifted / Lx)\n            dx = dx_shifted - nx * Lx\n\n        return np.array([dx, dy])\n\n    # (Lx, Ly, s, xi, yi, xj, yj, rc)\n    test_cases = [\n        (10.0, 10.0, 0.0, 1.0, 1.0, 3.4, 2.0, 2.5),\n        (10.0, 2.0, 2.0, 9.0, 0.95, 1.55, 2.05, 2.5),\n        (10.0, 2.0, 2.0, 9.0, 0.95, 7.0, 2.05, 2.5),\n        (10.0, 2.0, 12.0, 9.0, 0.95, 1.55, 2.05, 2.5),\n    ]\n\n    results = []\n    for case in test_cases:\n        Lx, Ly, s, xi, yi, xj, yj, rc = case\n        \n        r_i = np.array([xi, yi])\n        r_j = np.array([xj, yj])\n        L = np.array([Lx, Ly])\n\n        # Calculate separation vectors\n        r_correct = get_separation(r_i, r_j, L, s, is_naive=False)\n        r_naive = get_separation(r_i, r_j, L, s, is_naive=True)\n\n        # Calculate forces\n        F_correct = calculate_force(r_correct, rc)\n        F_naive = calculate_force(r_naive, rc)\n\n        # Calculate error\n        force_diff = F_correct - F_naive\n        error = np.linalg.norm(force_diff)\n        results.append(error)\n    \n    # Format a list of floats into the required string format\n    formatted_results = [f\"{res:.8f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3445317"}, {"introduction": "当模拟复杂的分子流体时，剪切算法、恒温器以及系统内禀自由度之间的相互作用带来了新的挑战。这个高级实践探讨了在SLLOD框架下，不同的恒温方案如何可能无意中破坏角动量等基本守恒定律[@problem_id:3445327]。通过分析由此产生的虚拟力矩及其对压力张量$ \\boldsymbol{\\sigma} $的影响，您将认识到选择能够尊重系统内蕴物理规律的算法是何其重要。", "problem": "考虑一个二维分子动力学模型，其中有一个刚性双原子分子（哑铃模型），由两个质量均为 $m$ 的相同原子组成，它们之间由长度为 $a$ 的固定键连接，分子中心位于原点，因此质心位置为 $\\mathbf{R} = \\mathbf{0}$。设系统受到均匀简剪切作用，其特征由速度梯度张量 $\\boldsymbol{\\kappa}$ 描述，对于简剪切，$\\boldsymbol{\\kappa}$ 只有一个非零元素 $\\kappa_{xy} = \\dot{\\gamma}$，并且周期性通过 Lees-Edwards 边界条件（LEBC）在概念上强制执行。使用流动/奇异分解和 SLLOD 运动方程作为基本基础：对于每个原子 $i$，其奇异位置 $\\mathbf{r}_i$、奇异动量 $\\mathbf{p}_i$ 和力 $\\mathbf{F}_i$ 进入非惯性形式的牛顿第二定律，且运动学满足 $\\mathrm{d}\\mathbf{r}_i/\\mathrm{d}t = \\mathbf{p}_i/m + \\boldsymbol{\\kappa}\\,\\mathbf{r}_i$。假设唯一的原子间力是施加刚性约束的力（无其他势），并认为刚体表示是精确的。\n\n设哑铃分子的朝向由单位向量 $\\mathbf{u} = (\\cos\\theta, \\sin\\theta)$ 给出，因此相对于质心的原子位置为 $\\mathbf{r}_1 = (a/2)\\,\\mathbf{u}$ 和 $\\mathbf{r}_2 = -(a/2)\\,\\mathbf{u}$。设总质心奇异动量为 $\\mathbf{P} = (P_x,P_y)$，绕质心的平面外角动量为 $L_z$。对于一个具有相等质量的二维刚性哑铃，其绕质心的标量转动惯量为 $I = m a^2/2$，角速度为 $\\omega = L_z/I$。原子 $i$ 的旋转奇异动量为 $m\\,\\omega\\,\\hat{\\mathbf{z}}\\times\\mathbf{r}_i$，其中 $\\hat{\\mathbf{z}}$ 是垂直于平面的单位向量。因此，原子的奇异动量为 $\\mathbf{p}_i = \\mathbf{P}/2 + m\\,\\omega\\,\\hat{\\mathbf{z}}\\times\\mathbf{r}_i$。\n\n您将比较 SLLOD 下的两种恒温方案，以评估角动量守恒及其对所测应力的影响：\n\n1) 应用于每个原子的高斯等动能恒温器 (GIK)（下文称“原子 GIK”），其中恒温器乘子 $ \\alpha $ 通过动量方程中的一个非哈密顿项 $-\\alpha\\,\\mathbf{p}_i$ 等效地作用于每个原子的奇异动量，其选择方式使得瞬时奇异动能 $K = \\sum_i \\mathbf{p}_i^2/(2m)$ 随时间保持恒定。\n\n2) 仅应用于分子质心的高斯等动能恒温器（下文称“分子 GIK”），其中乘子 $ \\alpha_{\\mathrm{trans}} $ 作用于总质心奇异动量 $\\mathbf{P}$，使得平动动能 $K_{\\mathrm{trans}} = \\mathbf{P}^2/(4m)$ 随时间保持恒定；相等且平行的恒温器力被分配给各个原子，从而使绕质心的净恒温器力矩为零。\n\n从由以下各项组成的基本基础出发：牛顿第二定律、SLLOD 流动运动学、刚性约束运动学，以及等动能约束 $\\mathrm{d}K/\\mathrm{d}t = 0$（对于原子 GIK）或 $\\mathrm{d}K_{\\mathrm{trans}}/\\mathrm{d}t = 0$（对于分子 GIK），推导：\n\n- 瞬时恒温器乘子 $ \\alpha $ 和 $ \\alpha_{\\mathrm{trans}} $ 的表达式，用当前的奇异动量、剪切速率 $ \\dot{\\gamma} $ 和等动能条件表示，适用于二维简剪切。\n\n- 由此产生的绕质心的瞬时净恒温器力矩 $ M_z = \\sum_i (r_{i,x} F_{i,y} - r_{i,y} F_{i,x}) $，其中 $ \\mathbf{F}_i $ 是作用于原子 $ i $ 的恒温器力。使用此结果来确定在给定状态下，所选恒温器是否破坏了旋转不变量（在无外力矩情况下的绕质心角动量）。\n\n- 通过 Irving–Kirkwood 动量通量形式，恒温器力对所测柯西应力张量的贡献，此处限定为体力项 $ \\boldsymbol{\\sigma}^{(\\mathrm{th})} = (1/V) \\sum_i \\mathbf{r}_i \\otimes \\mathbf{F}_i $，其中 $ V $ 是二维系统面积。由此，提取由 $ \\sigma_{xy}^{(\\mathrm{th})} - \\sigma_{yx}^{(\\mathrm{th})} $ 量化的反对称部分和剪切分量 $ \\sigma_{xy}^{(\\mathrm{th})} $。解释非零的恒温器力矩密度如何与反对称应力相关。\n\n然后实现一个程序，对于一组指定的测试用例，使用您推导的公式为每个用例计算以下内容：\n\n- 一个布尔标志，指示在给定状态下恒温器是否破坏了旋转不变量，定义为若 $ |M_z| > \\varepsilon $（容差 $ \\varepsilon = 10^{-12} $）则为“真”。\n\n- 来自恒温器的反对称应力贡献 $ S_{\\mathrm{asym}} = (\\sigma_{xy}^{(\\mathrm{th})} - \\sigma_{yx}^{(\\mathrm{th})}) = M_z / V $。\n\n- 恒温器对剪切分量的贡献 $ \\sigma_{xy}^{(\\mathrm{th})} $。\n\n使用约化的 Lennard–Jones 单位（无量纲），其中 $ m = 1 $，$ a = 1 $，以及一个边长为 $L_x = L_y = 10$ 的方形模拟单元，因此 $ V = L_x L_y = 100 $。角度必须以弧度提供。除了施加刚性的力和所描述的恒温器力外，没有其他力。所有量都是从指定的初始状态在单个瞬时计算的（无需时间积分）。\n\n测试套件（每个测试用例是一个元组，包含 $(\\dot{\\gamma}, P_x, P_y, L_z, \\theta, \\text{thermostat})$，其中 $\\text{thermostat} \\in \\{\\text{atomic}, \\text{molecular}, \\text{none}\\}$）：\n\n- 用例 A（剪切下原子 GIK 的正常路径）：$(0.5, 1.0, 0.5, 0.3, \\pi/6, \\text{atomic})$。\n\n- 用例 B（相同剪切下分子 GIK 的比较）：$(0.5, 1.0, 0.5, 0.3, \\pi/6, \\text{molecular})$。\n\n- 用例 C（无剪切，原子 GIK）：$(0.0, 1.0, 0.5, 0.3, \\pi/6, \\text{atomic})$。\n\n- 用例 D（零角动量的边界情况）：$(0.8, 0.3, -0.2, 0.0, \\pi/3, \\text{atomic})$。\n\n- 用例 E（零质心动量但有限角动量在 $45^\\circ$ 的边界情况）：$(1.2, 0.0, 0.0, 0.4, \\pi/4, \\text{atomic})$。\n\n您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表形式的结果，其中每个测试用例的结果本身是一个包含三个条目的列表，顺序为 $[\\text{broken}, S_{\\mathrm{asym}}, \\sigma_{xy}^{(\\mathrm{th})}]$，其中 $\\text{broken}$ 对 true 报告为 $1$，对 false 报告为 $0$。例如，一个有效的整体输出格式是 $[[1,0.001,-0.0005],[0,0.0,0.0],\\dots]$。所有应力必须以约化的 Lennard–Jones 单位（无量纲）报告。", "solution": "此问题被评估为有效，因为它科学地基于非平衡分子动力学的原理，问题陈述清晰，信息充分且一致，并要求进行形式化的、可验证的推导和计算。\n\n任务是推导在 SLLOD 动力学下两种不同恒温方案的恒温器乘子、力矩和应力的表达式，然后为一组给定的测试用例计算这些量。\n\n我们从必要的推导开始。系统是一个二维刚性哑铃，原子质量 $m=1$，键长 $a=1$。模拟体积为 $V=100$。\n\n原子 $i$ 的奇异位置 $\\mathbf{r}_i$ 和奇异动量 $\\mathbf{p}_i$ 的基本 SLLOD 运动方程为：\n$$\n\\frac{\\mathrm{d}\\mathbf{r}_i}{\\mathrm{d}t} = \\frac{\\mathbf{p}_i}{m} + \\boldsymbol{\\kappa}\\mathbf{r}_i\n$$\n$$\n\\frac{\\mathrm{d}\\mathbf{p}_i}{\\mathrm{d}t} = \\mathbf{F}_i^{\\text{int}} + \\mathbf{F}_i^{\\text{th}} - \\boldsymbol{\\kappa}\\mathbf{p}_i\n$$\n其中 $\\mathbf{F}_i^{\\text{int}}$ 代表所有内力（此处仅为约束力），$\\mathbf{F}_i^{\\text{th}}$ 是恒温器力，$\\boldsymbol{\\kappa}$ 是速度梯度张量，对于二维简剪切，其形式为 $\\boldsymbol{\\kappa} = \\begin{pmatrix} 0  \\dot{\\gamma} \\\\ 0  0 \\end{pmatrix}$。$-\\boldsymbol{\\kappa}\\mathbf{p}_i$ 项是非惯性 SLLOD 项。总奇异动能 $K = \\sum_i \\frac{\\mathbf{p}_i^2}{2m}$ 的时间导数为：\n$$\n\\frac{\\mathrm{d}K}{\\mathrm{d}t} = \\sum_i \\frac{\\mathbf{p}_i}{m} \\cdot \\frac{\\mathrm{d}\\mathbf{p}_i}{\\mathrm{d}t} = \\frac{1}{m} \\sum_i \\mathbf{p}_i \\cdot (\\mathbf{F}_i^{\\text{int}} + \\mathbf{F}_i^{\\text{th}} - \\boldsymbol{\\kappa}\\mathbf{p}_i)\n$$\n对于刚体，内约束力不对奇异动量做功，因此 $\\sum_i \\mathbf{p}_i \\cdot \\mathbf{F}_i^{\\text{int}} = 0$。表达式简化为：\n$$\n\\frac{\\mathrm{d}K}{\\mathrm{d}t} = \\frac{1}{m} \\sum_i \\mathbf{p}_i \\cdot \\mathbf{F}_i^{\\text{th}} - \\frac{1}{m} \\sum_i \\mathbf{p}_i \\cdot (\\boldsymbol{\\kappa}\\mathbf{p}_i)\n$$\nSLLOD 项展开为 $\\sum_i \\mathbf{p}_i \\cdot (\\boldsymbol{\\kappa}\\mathbf{p}_i) = \\sum_i p_{i,x}(\\dot{\\gamma}p_{i,y}) = \\dot{\\gamma}\\sum_i p_{i,x}p_{i,y}$。\n\n### 1. 恒温器乘子的推导\n\n**a) 原子高斯等动能恒温器 (GIK)**\n\n对于此恒温器，每个原子上的力为 $\\mathbf{F}_i^{\\text{th}} = -\\alpha \\mathbf{p}_i$。等动能约束为 $\\frac{\\mathrm{d}K}{\\mathrm{d}t} = 0$。\n将力代入 $\\frac{\\mathrm{d}K}{\\mathrm{d}t}$ 方程：\n$$\n0 = \\frac{1}{m} \\sum_i \\mathbf{p}_i \\cdot (-\\alpha \\mathbf{p}_i) - \\frac{\\dot{\\gamma}}{m}\\sum_i p_{i,x}p_{i,y}\n$$\n$$\n0 = -\\frac{\\alpha}{m} \\sum_i \\mathbf{p}_i^2 - \\frac{\\dot{\\gamma}}{m}\\sum_i p_{i,x}p_{i,y}\n$$\n注意到 $\\sum_i \\mathbf{p}_i^2 = 2mK$，我们可以解出乘子 $\\alpha$：\n$$\n\\alpha = - \\frac{\\dot{\\gamma} \\sum_i p_{i,x}p_{i,y}}{2mK} = - \\frac{\\dot{\\gamma} \\sum_i p_{i,x}p_{i,y}}{\\sum_i \\mathbf{p}_i^2}\n$$\n\n**b) 分子高斯等动能恒温器 (GIK)**\n\n该恒温器仅作用于质心 (COM) 奇异动量 $\\mathbf{P} = \\sum_i \\mathbf{p}_i$。每个原子上的恒温器力为 $\\mathbf{F}_i^{\\text{th}} = -\\frac{1}{2}\\alpha_{\\mathrm{trans}}\\mathbf{P}$。等动能约束作用于平动动能 $K_{\\mathrm{trans}} = \\frac{\\mathbf{P}^2}{4m}$，要求 $\\frac{\\mathrm{d}K_{\\mathrm{trans}}}{\\mathrm{d}t} = 0$。\n\n总奇异动量 $\\mathbf{P}$ 的时间演化为：\n$$\n\\frac{\\mathrm{d}\\mathbf{P}}{\\mathrm{d}t} = \\sum_i \\frac{\\mathrm{d}\\mathbf{p}_i}{\\mathrm{d}t} = \\sum_i (\\mathbf{F}_i^{\\text{int}} + \\mathbf{F}_i^{\\text{th}} - \\boldsymbol{\\kappa}\\mathbf{p}_i) = \\mathbf{0} + \\sum_i \\mathbf{F}_i^{\\text{th}} - \\boldsymbol{\\kappa}\\sum_i \\mathbf{p}_i = -\\alpha_{\\mathrm{trans}}\\mathbf{P} - \\boldsymbol{\\kappa}\\mathbf{P}\n$$\n$K_{\\mathrm{trans}}$ 的时间导数为：\n$$\n\\frac{\\mathrm{d}K_{\\mathrm{trans}}}{\\mathrm{d}t} = \\frac{\\mathrm{d}}{\\mathrm{d}t}\\left(\\frac{\\mathbf{P}^2}{4m}\\right) = \\frac{2\\mathbf{P} \\cdot \\dot{\\mathbf{P}}}{4m} = \\frac{\\mathbf{P}}{2m} \\cdot (-\\alpha_{\\mathrm{trans}}\\mathbf{P} - \\boldsymbol{\\kappa}\\mathbf{P}) = -\\frac{\\alpha_{\\mathrm{trans}}\\mathbf{P}^2}{2m} - \\frac{\\mathbf{P} \\cdot \\boldsymbol{\\kappa}\\mathbf{P}}{2m}\n$$\n应用约束 $\\frac{\\mathrm{d}K_{\\mathrm{trans}}}{\\mathrm{d}t} = 0$ 并注意到 $\\mathbf{P} \\cdot \\boldsymbol{\\kappa}\\mathbf{P} = \\dot{\\gamma}P_xP_y$：\n$$\n0 = -\\frac{\\alpha_{\\mathrm{trans}}\\mathbf{P}^2}{2m} - \\frac{\\dot{\\gamma}P_xP_y}{2m}\n$$\n解出 $\\alpha_{\\mathrm{trans}}$（假设 $\\mathbf{P}^2 \\neq 0$）：\n$$\n\\alpha_{\\mathrm{trans}} = - \\frac{\\dot{\\gamma}P_xP_y}{\\mathbf{P}^2}\n$$\n\n### 2. 净恒温器力矩 ($M_z$) 的推导\n\n绕质心的净恒温器力矩为 $M_z = \\sum_i (\\mathbf{r}_i \\times \\mathbf{F}_i^{\\text{th}})_z$。\n\n**a) 原子 GIK**\n当 $\\mathbf{F}_i^{\\text{th}} = -\\alpha \\mathbf{p}_i$ 时：\n$$\nM_z = \\sum_i (\\mathbf{r}_i \\times (-\\alpha\\mathbf{p}_i))_z = -\\alpha \\sum_i (\\mathbf{r}_i \\times \\mathbf{p}_i)_z\n$$\n$\\sum_i (\\mathbf{r}_i \\times \\mathbf{p}_i)_z$ 项是绕质心角动量 $L_z$ 的定义。因此：\n$$\nM_z^{\\text{atomic}} = -\\alpha L_z\n$$\n由于在剪切下（$\\dot{\\gamma} \\neq 0$），$\\alpha$ 通常非零，因此该恒温器对分子施加净力矩，导致 $L_z$ 随时间变化。因此，原子 GIK 恒温器破坏了旋转不变量。\n\n**b) 分子 GIK**\n当 $\\mathbf{F}_i^{\\text{th}} = -\\frac{1}{2}\\alpha_{\\mathrm{trans}}\\mathbf{P}$ 时：\n$$\nM_z = \\sum_i \\left(\\mathbf{r}_i \\times \\left(-\\frac{1}{2}\\alpha_{\\mathrm{trans}}\\mathbf{P}\\right)\\right)_z = -\\frac{1}{2}\\alpha_{\\mathrm{trans}} \\left( \\left(\\sum_i \\mathbf{r}_i\\right) \\times \\mathbf{P} \\right)_z\n$$\n由于质心位于原点，$\\sum_i m_i \\mathbf{r}_i = \\mathbf{0}$。对于相同质量，这意味着 $\\sum_i \\mathbf{r}_i = \\mathbf{0}$。因此：\n$$\nM_z^{\\text{molecular}} = 0\n$$\n该恒温器被设计为无力矩的，因此它守恒分子的角动量。\n\n### 3. 恒温器应力贡献 ($\\boldsymbol{\\sigma}^{(\\mathrm{th})}$) 的推导\n\n对应力张量的体力贡献由 $\\boldsymbol{\\sigma}^{(\\mathrm{th})} = \\frac{1}{V} \\sum_i \\mathbf{r}_i \\otimes \\mathbf{F}_i^{\\text{th}}$ 给出。\n\n**a) 原子 GIK**\n$$\n\\boldsymbol{\\sigma}^{(\\mathrm{th}), \\text{atomic}} = \\frac{1}{V} \\sum_i \\mathbf{r}_i \\otimes (-\\alpha\\mathbf{p}_i) = -\\frac{\\alpha}{V} \\sum_i \\mathbf{r}_i \\otimes \\mathbf{p}_i\n$$\n我们关心的分量是：\n$$\n\\sigma_{xy}^{(\\mathrm{th})} = -\\frac{\\alpha}{V} \\sum_i r_{i,x} p_{i,y}\n\\qquad\n\\sigma_{yx}^{(\\mathrm{th})} = -\\frac{\\alpha}{V} \\sum_i r_{i,y} p_{i,x}\n$$\n\n**b) 分子 GIK**\n$$\n\\boldsymbol{\\sigma}^{(\\mathrm{th}), \\text{molecular}} = \\frac{1}{V} \\sum_i \\mathbf{r}_i \\otimes \\left(-\\frac{1}{2}\\alpha_{\\mathrm{trans}}\\mathbf{P}\\right) = -\\frac{\\alpha_{\\mathrm{trans}}}{2V} \\left(\\sum_i \\mathbf{r}_i\\right) \\otimes \\mathbf{P}\n$$\n由于 $\\sum_i \\mathbf{r}_i = \\mathbf{0}$，应力贡献恒为零：\n$$\n\\boldsymbol{\\sigma}^{(\\mathrm{th}), \\text{molecular}} = \\mathbf{0}\n$$\n\n**反对称应力与力矩的关系**\n应力的反对称部分为 $S_{\\mathrm{asym}} = \\sigma_{xy}^{(\\mathrm{th})} - \\sigma_{yx}^{(\\mathrm{th})}$。\n$$\nS_{\\mathrm{asym}} = \\frac{1}{V} \\sum_i (r_{i,x} F_{i,y}^{\\text{th}} - r_{i,y} F_{i,x}^{\\text{th}}) = \\frac{1}{V} \\sum_i (\\mathbf{r}_i \\times \\mathbf{F}_i^{\\text{th}})_z = \\frac{M_z}{V}\n$$\n这证明了净恒温器力矩密度 ($M_z/V$) 与应力张量的反对称部分之间存在直接对应关系。在连续介质力学中，对称应力张量是体力偶（单位体积的力矩）不存在的结果。施加净力矩的恒温器，如 SLLOD 下的原子 GIK，充当微观体力偶，导致可观测的反对称应力。\n\n### 4. 用于实现的公式\n\n为了计算，我们用给定的状态变量 $(\\mathbf{P}, L_z, \\theta)$ 来表示这些和。使用 $m=1, a=1$：\n*   角速度为 $\\omega = L_z/I = L_z/(ma^2/2) = 2L_z$。\n*   原子动量分解为：\n    $\\mathbf{p}_1 = \\mathbf{P}/2 + (-L_z \\sin\\theta, L_z \\cos\\theta)$\n    $\\mathbf{p}_2 = \\mathbf{P}/2 - (-L_z \\sin\\theta, L_z \\cos\\theta)$\n*   所需的求和项为：\n    $\\sum_i \\mathbf{p}_i^2 = \\frac{\\mathbf{P}^2}{2} + 2L_z^2$\n    $\\sum_i p_{i,x}p_{i,y} = \\frac{P_x P_y}{2} - L_z^2 \\sin(2\\theta)$\n    $\\sum_i r_{i,x} p_{i,y} = \\frac{\\cos\\theta}{2}(p_{1,y}-p_{2,y}) = \\frac{\\cos\\theta}{2}(2L_z\\cos\\theta) = L_z \\cos^2\\theta$\n\n利用这些，为原子 GIK 计算的量是：\n1.  $\\alpha = - \\dot{\\gamma} \\frac{P_x P_y/2 - L_z^2 \\sin(2\\theta)}{\\mathbf{P}^2/2 + 2L_z^2}$\n2.  $M_z = -\\alpha L_z$。如果 $|M_z| > 10^{-12}$，则标志 `broken` 为 $1$，否则为 $0$。\n3.  $S_{\\mathrm{asym}} = M_z/V$。\n4.  $\\sigma_{xy}^{(\\mathrm{th})} = -\\frac{\\alpha}{V}\\sum_i r_{i,x} p_{i,y} = -\\frac{\\alpha L_z \\cos^2\\theta}{V} = \\frac{M_z \\cos^2\\theta}{V} = S_{\\mathrm{asym}}\\cos^2\\theta$。\n\n对于分子 GIK 和无恒温器的情况，$M_z=0$，$S_{\\mathrm{asym}}=0$，$\\sigma_{xy}^{(\\mathrm{th})}=0$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the molecular dynamics thermostat problem for a series of test cases.\n    \"\"\"\n    # System parameters in reduced units\n    m = 1.0\n    a = 1.0\n    V = 100.0\n    \n    # Tolerance for checking if rotational invariants are broken\n    epsilon = 1e-12\n\n    test_cases = [\n        # (gamma_dot, Px, Py, Lz, theta, thermostat_type)\n        (0.5, 1.0, 0.5, 0.3, np.pi / 6, 'atomic'),      # Case A\n        (0.5, 1.0, 0.5, 0.3, np.pi / 6, 'molecular'),    # Case B\n        (0.0, 1.0, 0.5, 0.3, np.pi / 6, 'atomic'),      # Case C\n        (0.8, 0.3, -0.2, 0.0, np.pi / 3, 'atomic'),     # Case D\n        (1.2, 0.0, 0.0, 0.4, np.pi / 4, 'atomic'),      # Case E\n    ]\n\n    results = []\n    for case in test_cases:\n        gamma_dot, Px, Py, Lz, theta, thermostat_type = case\n\n        # Initialize results to zero\n        broken = 0\n        S_asym = 0.0\n        sigma_xy_th = 0.0\n\n        if thermostat_type == 'atomic' and gamma_dot != 0:\n            # Calculate terms based on derived formulas\n            P_sq = Px**2 + Py**2\n            \n            # Sum of p_i^2 = P^2/2 + 2*Lz^2 for m=1\n            sum_p_sq = P_sq / 2.0 + 2.0 * Lz**2\n            \n            # Sum of p_ix * p_iy = (Px*Py)/2 - Lz^2*sin(2*theta)\n            sum_px_py = (Px * Py) / 2.0 - (Lz**2) * np.sin(2 * theta)\n            \n            # The thermostat multiplier alpha\n            # Denominator sum_p_sq cannot be zero unless the system is fully at rest.\n            if sum_p_sq == 0:\n                alpha = 0.0\n            else:\n                alpha = -gamma_dot * sum_px_py / sum_p_sq\n            \n            # Net thermostat torque M_z\n            Mz = -alpha * Lz\n            \n            # Check if rotational invariants are broken\n            if abs(Mz) > epsilon:\n                broken = 1\n            \n            # Antisymmetric stress S_asym = M_z / V\n            S_asym = Mz / V\n\n            # Shear component of thermostat stress\n            # sigma_xy_th = S_asym * cos^2(theta)\n            sigma_xy_th = S_asym * (np.cos(theta)**2)\n\n        elif thermostat_type == 'molecular':\n            # For molecular GIK, torque and stress contribution are zero by design.\n            broken = 0\n            S_asym = 0.0\n            sigma_xy_th = 0.0\n\n        elif thermostat_type == 'none' or (thermostat_type == 'atomic' and gamma_dot == 0):\n            # With no thermostat, or no shear, there is no thermostat force, torque, or stress.\n            broken = 0\n            S_asym = 0.0\n            sigma_xy_th = 0.0\n\n        results.append([broken, S_asym, sigma_xy_th])\n    \n    # Format the final output string as specified\n    # The str() of a list is its string representation, e.g., '[1, 0.1, 0.2]'\n    # We join these string representations with a comma.\n    output_str_parts = []\n    for res_list in results:\n        # Format each number inside the inner list\n        formatted_inner = f\"[{res_list[0]}, {res_list[1]:.8f}, {res_list[2]:.8f}]\"\n        output_str_parts.append(formatted_inner)\n    \n    output_str = f\"[{','.join(output_str_parts)}]\"\n    \n    # The expected output format is slightly different, let's adjust\n    # E.g., [[1, 0.001, -0.0005], [0, 0.0, 0.0]]\n    final_output = f\"[{','.join(map(lambda x: str(x).replace(' ', ''), results))}]\"\n    print(final_output)\n\n\nsolve()\n```", "id": "3445327"}]}