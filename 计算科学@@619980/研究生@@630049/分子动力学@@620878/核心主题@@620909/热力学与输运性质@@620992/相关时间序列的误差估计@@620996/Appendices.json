{"hands_on_practices": [{"introduction": "为了准确估计统计误差，我们必须首先理解时间序列中的相关性如何影响其均值的方差。本练习提供了一个基础性的理解，它使用一阶自回归模型（AR(1)过程），这是一个对分子动力学模拟中常见相关数据的简单而有效的表示。通过从第一性原理推导该模型下样本均值 $\\bar{X}_N$ 的标准误差，您将能精确地量化误差相对于独立同分布（i.i.d.）数据被放大了多少，从而揭示正确处理时间相关性的根本重要性。[@problem_id:3411615]", "problem": "假设一个从分子动力学 (MD) 中获得的标量可观测量的时间序列 $X_{t}$，该序列在均匀时间步长下采样，是严格平稳的，并且可以很好地用一阶自回归 (AR) 过程，具体来说是一阶自回归模型 (AR(1)) 来建模。即，该过程满足 $X_{t} = \\mu + \\phi \\left(X_{t-1} - \\mu\\right) + \\varepsilon_{t}$，其中 $|\\phi|  1$，$\\mu$ 是平稳均值，$\\varepsilon_{t}$ 是均值为0且方差有限的独立同分布新息。令 $\\bar{X}_{N} = \\frac{1}{N} \\sum_{t=1}^{N} X_{t}$ 表示 $N$ 个连续观测值的样本均值。\n\n从自协方差和相关随机变量之和的方差的定义出发，仅利用 AR(1) 结构和平稳性，推导在大 $N$ 极限下 $\\bar{X}_{N}$ 的渐近标准误差。然后，通过确定AR(1)过程中$\\bar{X}_{N}$的渐近标准误差与具有相同边际方差的独立同分布(i.i.d.)过程的渐近标准误差相差的乘法因子，与i.i.d.情况进行定量比较。\n\n将您的最终答案表示为一个仅依赖于 $\\phi$ 的单一闭式解析表达式。无需进行数值计算，最终表达式中不应包含任何单位。不要对结果进行四舍五入或近似。", "solution": "该问题被验证为具有科学依据、适定且客观。这是时间序列分析和统计力学中的一个标准推导。所有必要信息都已提供，且没有矛盾之处。\n\n主要目标是推导AR(1)过程中样本均值$\\bar{X}_N$的渐近标准误差与具有相同边际方差的独立同分布(i.i.d.)过程的渐近标准误差相差的乘法因子。该因子是这两个标准误差的比值。\n\n令时间序列表示为 $\\{X_t\\}$。$N$ 个观测值的样本均值为 $\\bar{X}_N = \\frac{1}{N} \\sum_{t=1}^{N} X_t$。样本均值的方差由下式给出：\n$$\n\\text{Var}(\\bar{X}_N) = \\text{Var}\\left(\\frac{1}{N} \\sum_{t=1}^{N} X_t\\right) = \\frac{1}{N^2} \\text{Var}\\left(\\sum_{t=1}^{N} X_t\\right)\n$$\n相关随机变量之和的方差是其协方差矩阵中所有元素的总和：\n$$\n\\text{Var}\\left(\\sum_{t=1}^{N} X_t\\right) = \\sum_{i=1}^{N} \\sum_{j=1}^{N} \\text{Cov}(X_i, X_j)\n$$\n对于平稳过程，协方差 $\\text{Cov}(X_i, X_j)$ 仅依赖于时间延迟 $|i-j|$。我们定义自协方差函数为 $\\gamma(k) = \\text{Cov}(X_t, X_{t+k})$。注意 $\\gamma(0) = \\text{Var}(X_t) \\equiv \\sigma_X^2$ 是该过程的边际方差，并且 $\\gamma(k) = \\gamma(-k)$。\n\n我们可以通过合并具有相同延迟 $k$ 的项来重写这个双重求和：\n$$\n\\sum_{i=1}^{N} \\sum_{j=1}^{N} \\text{Cov}(X_i, X_j) = \\sum_{i=1}^{N} \\text{Var}(X_i) + \\sum_{i \\neq j} \\text{Cov}(X_i, X_j) = N\\gamma(0) + 2 \\sum_{k=1}^{N-1} (N-k)\\gamma(k)\n$$\n因子 $(N-k)$ 是延迟为 $k$ 的观测值对的数量。将此代入 $\\text{Var}(\\bar{X}_N)$ 的表达式中：\n$$\n\\text{Var}(\\bar{X}_N) = \\frac{1}{N^2} \\left[ N\\gamma(0) + 2 \\sum_{k=1}^{N-1} (N-k)\\gamma(k) \\right] = \\frac{1}{N} \\left[ \\gamma(0) + 2 \\sum_{k=1}^{N-1} \\left(1-\\frac{k}{N}\\right)\\gamma(k) \\right]\n$$\n对于大样本量 $N \\to \\infty$，对于任何固定的 $k$，项 $(1 - k/N)$ 趋近于 $1$。如果自协方差函数衰减得足够快，使得 $\\sum_{k=1}^{\\infty} \\gamma(k)$ 收敛，我们就可以取其渐近极限：\n$$\n\\lim_{N\\to\\infty} N \\text{Var}(\\bar{X}_N) = \\gamma(0) + 2 \\sum_{k=1}^{\\infty} \\gamma(k) = \\sum_{k=-\\infty}^{\\infty} \\gamma(k)\n$$\n因此，对于大的 $N$，均值的方差近似为：\n$$\n\\text{Var}(\\bar{X}_N) \\approx \\frac{1}{N} \\left( \\gamma(0) + 2 \\sum_{k=1}^{\\infty} \\gamma(k) \\right)\n$$\n接下来，我们确定指定的 AR(1) 过程 $X_t = \\mu + \\phi(X_{t-1} - \\mu) + \\varepsilon_t$ 的自协方差函数 $\\gamma(k)$。令 $Y_t = X_t - \\mu$。用中心化变量 $Y_t$ 表示的过程为 $Y_t = \\phi Y_{t-1} + \\varepsilon_t$。\n\n方差 $\\gamma(0) = \\text{Var}(X_t) = \\text{Var}(Y_t)$。利用平稳性性质 $\\text{Var}(Y_t) = \\text{Var}(Y_{t-1})$，我们可以写出：\n$$\n\\text{Var}(Y_t) = \\text{Var}(\\phi Y_{t-1} + \\varepsilon_t)\n$$\n由于 $Y_{t-1}$ 是过去新息 $\\{\\varepsilon_{t-1}, \\varepsilon_{t-2}, \\dots\\}$ 的函数，它与当前新息 $\\varepsilon_t$ 不相关。因此：\n$$\n\\text{Var}(Y_t) = \\phi^2 \\text{Var}(Y_{t-1}) + \\text{Var}(\\varepsilon_t)\n$$\n$$\n\\gamma(0) = \\phi^2 \\gamma(0) + \\sigma_\\varepsilon^2 \\implies \\gamma(0)(1-\\phi^2) = \\sigma_\\varepsilon^2 \\implies \\gamma(0) = \\frac{\\sigma_\\varepsilon^2}{1-\\phi^2}\n$$\n其中 $\\sigma_\\varepsilon^2 = \\text{Var}(\\varepsilon_t)$。因为 $|\\phi|1$，所以这是成立的。因此，边际方差为 $\\sigma_X^2 = \\gamma(0)$。\n\n现在我们求延迟 $k > 0$ 时的自协方差：\n$$\n\\gamma(k) = \\text{Cov}(Y_t, Y_{t-k}) = E[Y_t Y_{t-k}] = E[(\\phi Y_{t-1} + \\varepsilon_t)Y_{t-k}]\n$$\n因为当 $k > 0$ 时，$Y_{t-k}$ 与 $\\varepsilon_t$ 不相关：\n$$\n\\gamma(k) = \\phi E[Y_{t-1} Y_{t-k}] = \\phi \\text{Cov}(Y_{t-1}, Y_{t-k}) = \\phi \\gamma(k-1)\n$$\n这是一个递推关系。其解为，对于 $k \\ge 0$，$\\gamma(k) = \\gamma(0)\\phi^k$。由于 $\\gamma(-k) = \\gamma(k)$，我们得到通式 $\\gamma(k) = \\gamma(0)\\phi^{|k|}$。\n\n现在我们可以将其代入均值方差的渐近公式中：\n$$\n\\text{Var}_{\\text{AR(1)}}(\\bar{X}_N) \\approx \\frac{1}{N} \\left( \\gamma(0) + 2 \\sum_{k=1}^{\\infty} \\gamma(0)\\phi^k \\right) = \\frac{\\gamma(0)}{N} \\left( 1 + 2 \\sum_{k=1}^{\\infty} \\phi^k \\right)\n$$\n该和是一个几何级数，因为 $|\\phi|1$ 所以它收敛：\n$$\n\\sum_{k=1}^{\\infty} \\phi^k = \\frac{\\phi}{1-\\phi}\n$$\n将这个和代回到方差表达式中：\n$$\n\\text{Var}_{\\text{AR(1)}}(\\bar{X}_N) \\approx \\frac{\\gamma(0)}{N} \\left( 1 + 2\\frac{\\phi}{1-\\phi} \\right) = \\frac{\\gamma(0)}{N} \\left( \\frac{1-\\phi+2\\phi}{1-\\phi} \\right) = \\frac{\\gamma(0)}{N} \\left( \\frac{1+\\phi}{1-\\phi} \\right)\n$$\nAR(1)过程的样本均值的渐近标准误差是该方差的平方根：\n$$\n\\text{SE}_{\\text{AR(1)}}(\\bar{X}_N) \\approx \\sqrt{\\frac{\\gamma(0)}{N} \\left( \\frac{1+\\phi}{1-\\phi} \\right)}\n$$\n对于具有相同边际方差 $\\sigma_X^2 = \\gamma(0)$ 的独立同分布(i.i.d.)过程的参考情况，观测值是不相关的，因此当 $k \\neq 0$ 时 $\\gamma(k) = 0$。样本均值的方差是：\n$$\n\\text{Var}_{\\text{i.i.d.}}(\\bar{X}_N) = \\frac{1}{N^2} \\sum_{t=1}^N \\text{Var}(X_t) = \\frac{1}{N^2} N\\gamma(0) = \\frac{\\gamma(0)}{N}\n$$\ni.i.d.情况下的标准误差是：\n$$\n\\text{SE}_{\\text{i.i.d.}}(\\bar{X}_N) = \\sqrt{\\frac{\\gamma(0)}{N}}\n$$\n最后，AR(1)过程的渐近标准误差与i.i.d.情况相差的乘法因子是它们标准误差的比值：\n$$\n\\text{Factor} = \\frac{\\text{SE}_{\\text{AR(1)}}(\\bar{X}_N)}{\\text{SE}_{\\text{i.i.d.}}(\\bar{X}_N)} = \\frac{\\sqrt{\\frac{\\gamma(0)}{N} \\left( \\frac{1+\\phi}{1-\\phi} \\right)}}{\\sqrt{\\frac{\\gamma(0)}{N}}} = \\sqrt{\\frac{1+\\phi}{1-\\phi}}\n$$\n这个因子通常与积分自相关时间的概念有关，它量化了序列相关性对样本均值估计不确定性的影响。", "answer": "$$\\boxed{\\sqrt{\\frac{1+\\phi}{1-\\phi}}}$$", "id": "3411615"}, {"introduction": "在对相关性的理论影响有了认识之后，我们转向一种广泛应用的实用误差估计方法：分块平均法（block averaging）。该技术将一个长的、相关的时间序列分组成若干个数据块，这些数据块的平均值近似独立，从而可以对统计误差进行可靠的估计。本动手实践将指导您实施一个稳健的策略来选择数据块的大小，并应用积分自相关时间（Integrated Autocorrelation Time, $\\tau_{\\mathrm{int}}$）的概念来为分子动力学模拟中的可观测量计算置信区间。[@problem_id:3411613]", "problem": "给你一个离散时间、平稳、遍历的时间序列 $\\{X_t\\}_{t=1}^N$，它代表了分子动力学（MD）模拟中势能的样本。令 $\\mu = \\mathbb{E}[X_t]$ 和 $\\sigma^2 = \\mathrm{Var}(X_t)$ 分别表示每个样本的均值和方差。令自协方差函数为 $\\gamma(t) = \\mathrm{Cov}(X_s, X_{s+t})$，自相关函数为 $\\rho(t) = \\gamma(t)/\\gamma(0)$，其中整数延迟 $t \\ge 0$。积分自相关时间（IACT）$\\tau_{\\mathrm{int}}$ 定义为 $\\tau_{\\mathrm{int}} = \\tfrac{1}{2} + \\sum_{t=1}^{\\infty} \\rho(t)$，假设 $\\rho(t)$ 是绝对可和的。样本均值为 $\\bar{X}_N = \\tfrac{1}{N}\\sum_{t=1}^N X_t$。\n\n任务1（推导）：仅使用上述定义以及平稳、混合过程的自协方差之和的渐近行为，推导出一个关于 $\\bar{X}_N$ 方差 $\\mathrm{Var}(\\bar{X}_N)$ 的渐近大$N$表达式，该表达式明确包含 $\\sigma^2$、$\\tau_{\\mathrm{int}}$ 和 $N$。使用你的推导，在正态近似下，根据 $\\sigma^2$、$\\tau_{\\mathrm{int}}$ 和 $N$ 构建 $\\bar{X}_N$ 的一个95%双边置信区间。必须使用95%双边高斯分位数，对应于 $z_{0.975}$。\n\n任务2（块大小选择）：非重叠块平均法是将相关数据组织成近似独立的块均值的标准设计选择。设块大小为整数 $b \\ge 1$，完整块的数量为 $M = \\lfloor N/b \\rfloor$。根据以下确定性策略选择 $b$，该策略的动机是要求有足够多的块以满足中心极限定理的条件，同时倾向于选择比相关尺度长的块：\n- 计算优选大小 $b_0 = \\lceil 20 \\, \\tau_{\\mathrm{int}} \\rceil$。\n- 如果 $\\lfloor N / b_0 \\rfloor \\ge 30$，则设置 $b = b_0$；否则，设置 $b = \\max\\{1, \\lfloor N/30 \\rfloor\\}$。\n\n任务3（数值计算）：对于下面的每个测试用例，给你 $N$、$\\tau_{\\mathrm{int}}$ 的估计值以及每个样本标准差 $s$ 的估计值（因此 $\\sigma \\approx s$）。计算：\n- 使用任务2中的策略选择的块大小 $b$（无单位整数）。\n- 使用任务1的结果计算的 $\\bar{X}_N$ 的95%双边置信区间的半宽 $h$。将 $h$ 以千焦/摩尔（kJ/mol）为单位表示，并四舍五入到三位有效数字。\n\n使用以下测试套件（每个三元组为 $(N, \\tau_{\\mathrm{int}}, s)$，其中 $s$ 的单位是 kJ/mol）：\n- 案例A：$(N, \\tau_{\\mathrm{int}}, s) = (10^6, 500, 50)$。\n- 案例B：$(N, \\tau_{\\mathrm{int}}, s) = (5 \\times 10^4, 0.5, 10)$。\n- 案例C：$(N, \\tau_{\\mathrm{int}}, s) = (2 \\times 10^4, 3000, 20)$。\n- 案例D：$(N, \\tau_{\\mathrm{int}}, s) = (10^3, 600, 5)$。\n\n最终输出格式：你的程序应生成单行输出，包含A、B、C、D四个案例的结果列表。每个结果必须是一个二元列表 $[b, h]$，其中 $b$ 是一个整数， $h$ 是一个四舍五入到三位有效数字的浮点数。整个输出必须是一个用方括号括起来的、逗号分隔的列表，例如，`[[b_A,h_A],[b_B,h_B],[b_C,h_C],[b_D,h_D]]`。半宽 $h$ 必须以 kJ/mol 为单位表示。不应打印任何额外文本。", "solution": "该问题被评估为有效。它在科学上基于统计力学和时间序列分析的原理，特别是关于分子动力学（MD）模拟中相关数据的分析。该问题是良构的，提供了推导和计算所需量所必需的所有定义、数据和约束。任务是客观且可形式化的。\n\n解决方案按规定分三部分进行：理论推导、算法性块大小选择的描述，以及给定测试用例的数值计算。\n\n任务1：样本均值方差和置信区间的推导\n\n设 $\\{X_t\\}_{t=1}^N$ 是一个平稳时间序列，其均值为 $\\mu = \\mathbb{E}[X_t]$，方差为 $\\sigma^2 = \\mathrm{Var}(X_t)$。样本均值定义为 $\\bar{X}_N = \\frac{1}{N}\\sum_{t=1}^N X_t$。我们寻求其方差 $\\mathrm{Var}(\\bar{X}_N)$ 的一个渐近表达式。\n\n根据方差的性质，\n$$\n\\mathrm{Var}(\\bar{X}_N) = \\mathrm{Var}\\left(\\frac{1}{N}\\sum_{t=1}^N X_t\\right) = \\frac{1}{N^2} \\mathrm{Var}\\left(\\sum_{t=1}^N X_t\\right)\n$$\n随机变量之和的方差是其协方差矩阵中所有元素的总和：\n$$\n\\mathrm{Var}\\left(\\sum_{t=1}^N X_t\\right) = \\sum_{i=1}^N \\sum_{j=1}^N \\mathrm{Cov}(X_i, X_j)\n$$\n由于平稳性，自协方差 $\\mathrm{Cov}(X_i, X_j)$ 仅取决于时间延迟 $\\tau = |i-j|$，我们将其表示为 $\\gamma(i-j)$。\n$$\n\\mathrm{Var}(\\bar{X}_N) = \\frac{1}{N^2} \\sum_{i=1}^N \\sum_{j=1}^N \\gamma(j-i)\n$$\n这个双重求和可以通过延迟 $t = j-i$ 进行重新索引，其范围从 $-(N-1)$ 到 $N-1$。对于给定的延迟 $t$，有 $N-|t|$ 对 $(i,j)$ 满足 $j-i=t$。\n$$\n\\mathrm{Var}(\\bar{X}_N) = \\frac{1}{N^2} \\sum_{t=-(N-1)}^{N-1} (N-|t|) \\gamma(t)\n$$\n在求和内部将项 $(N-|t|)$ 除以 $N$ 得到：\n$$\n\\mathrm{Var}(\\bar{X}_N) = \\frac{1}{N} \\sum_{t=-(N-1)}^{N-1} \\left(1 - \\frac{|t|}{N}\\right) \\gamma(t)\n$$\n使用自协方差函数的对称性 $\\gamma(t) = \\gamma(-t)$，我们可以写出：\n$$\n\\mathrm{Var}(\\bar{X}_N) = \\frac{1}{N} \\left[ \\gamma(0) + 2 \\sum_{t=1}^{N-1} \\left(1 - \\frac{t}{N}\\right) \\gamma(t) \\right]\n$$\n对于大量的样本 $N$，并且对于相关性衰减足够快的过程（一个“混合”过程，这在遍历性分子动力学模拟中很典型），对于 $\\gamma(t)$ 显著不为零的延迟 $t$，项 $t/N$ 可以忽略不计。当 $t$ 很大时，由于 $\\gamma(t) \\to 0$，这个和也可以扩展到无穷大。这给出了大$N$下的渐近表达式：\n$$\n\\mathrm{Var}(\\bar{X}_N) \\approx \\frac{1}{N} \\left[ \\gamma(0) + 2 \\sum_{t=1}^{\\infty} \\gamma(t) \\right]\n$$\n回顾定义 $\\gamma(0) = \\sigma^2$ 和自相关函数 $\\rho(t) = \\gamma(t)/\\gamma(0)$，我们可以提出 $\\sigma^2$：\n$$\n\\mathrm{Var}(\\bar{X}_N) \\approx \\frac{\\sigma^2}{N} \\left[ 1 + 2 \\sum_{t=1}^{\\infty} \\rho(t) \\right]\n$$\n问题将积分自相关时间（IACT）定义为 $\\tau_{\\mathrm{int}} = \\frac{1}{2} + \\sum_{t=1}^{\\infty} \\rho(t)$。根据这个定义，我们可以将这个和表示为 $2\\sum_{t=1}^{\\infty} \\rho(t) = 2\\tau_{\\mathrm{int}} - 1$。将此代入方差表达式中：\n$$\n\\mathrm{Var}(\\bar{X}_N) \\approx \\frac{\\sigma^2}{N} \\left[ 1 + (2\\tau_{\\mathrm{int}} - 1) \\right] = \\frac{2 \\tau_{\\mathrm{int}} \\sigma^2}{N}\n$$\n这就是所求的样本均值方差的渐近表达式。量 $N_{\\mathrm{eff}} = N / (2\\tau_{\\mathrm{int}})$ 可以解释为有效独立样本数。\n\n对于真实均值 $\\mu$ 的95%双边置信区间，我们援引平稳时间序列的中心极限定理，该定理指出对于大$N$，$\\bar{X}_N$ 近似服从正态分布。标准化变量 $Z = (\\bar{X}_N - \\mu) / \\sqrt{\\mathrm{Var}(\\bar{X}_N)}$ 服从标准正态分布。置信区间由 $\\bar{X}_N \\pm h$ 给出，其中 $h$ 是半宽：\n$$\nh = z_{0.975} \\sqrt{\\mathrm{Var}(\\bar{X}_N)} = z_{0.975} \\sqrt{\\frac{2 \\tau_{\\mathrm{int}} \\sigma^2}{N}}\n$$\n其中 $z_{0.975}$ 是标准正态分布的 $0.975$ 分位数。使用数值库，该值为 $z_{0.975} \\approx 1.959964$。\n\n任务2：块大小选择策略\n\n选择块大小 $b$ 的策略是一个基于总样本数 $N$ 和 IACT $\\tau_{\\mathrm{int}}$ 的确定性算法。\n1.  计算一个优选块大小 $b_0 = \\lceil 20 \\, \\tau_{\\mathrm{int}} \\rceil$。这旨在使块的长度远大于相关时间 ($2\\tau_{\\mathrm{int}}$)。\n2.  计算这将产生的块数 $M_0 = \\lfloor N / b_0 \\rfloor$。\n3.  如果 $M_0 \\ge 30$，则有足够的块数使得中心极限定理适用于块平均值。在这种情况下，块大小设置为 $b = b_0$。\n4.  如果 $M_0  30$，则对于给定的 $N$，优选块大小 $b_0$ 太大。该策略转而优先考虑至少有30个块，将块大小设置为 $b = \\max\\{1, \\lfloor N/30 \\rfloor\\}$。$\\max\\{1, ...\\}$ 确保块大小至少为1。\n\n任务3：数值计算\n\n对于每个测试用例 $(N, \\tau_{\\mathrm{int}}, s)$，我们计算块大小 $b$ 和置信区间半宽 $h$。\n块大小 $b$ 按照任务2的逻辑计算为整数值。\n半宽 $h$ 使用任务1的公式计算，用给定的估计值 $s$ 代替 $\\sigma$：\n$$\nh = z_{0.975} \\cdot s \\cdot \\sqrt{\\frac{2 \\tau_{\\mathrm{int}}}{N}}\n$$\n结果 $h$ 随后四舍五入到三位有效数字。为了实现这种四舍五入并保持正确的格式（例如，尾随零），用于四舍五入的小数位数 $d$ 从值的以10为底的对数确定：$d = \\text{sf} - 1 - \\lfloor \\log_{10}|h| \\rfloor$，其中 $\\text{sf}=3$。最终值随后格式化为 $d$ 位小数。\n\n四个测试用例如下处理：\n- 案例A：$(N, \\tau_{\\mathrm{int}}, s) = (10^6, 500, 50)$\n  $b_0 = \\lceil 20 \\times 500 \\rceil = 10000$。$\\lfloor 10^6 / 10000 \\rfloor = 100 \\ge 30$，所以 $b=10000$。\n  $h = 1.959964 \\times 50 \\times \\sqrt{2 \\times 500 / 10^6} \\approx 3.0989$ kJ/mol。四舍五入到3位有效数字， $h=3.10$ kJ/mol。\n- 案例B：$(N, \\tau_{\\mathrm{int}}, s) = (5 \\times 10^4, 0.5, 10)$\n  $b_0 = \\lceil 20 \\times 0.5 \\rceil = 10$。$\\lfloor 5 \\times 10^4 / 10 \\rfloor = 5000 \\ge 30$，所以 $b=10$。\n  $h = 1.959964 \\times 10 \\times \\sqrt{2 \\times 0.5 / (5 \\times 10^4)} \\approx 0.08765$ kJ/mol。四舍五入到3位有效数字， $h=0.0877$ kJ/mol。\n- 案例C：$(N, \\tau_{\\mathrm{int}}, s) = (2 \\times 10^4, 3000, 20)$\n  $b_0 = \\lceil 20 \\times 3000 \\rceil = 60000$。$\\lfloor 2 \\times 10^4 / 60000 \\rfloor = 0  30$，所以 $b = \\max\\{1, \\lfloor 2 \\times 10^4 / 30 \\rfloor\\} = 666$。\n  $h = 1.959964 \\times 20 \\times \\sqrt{2 \\times 3000 / (2 \\times 10^4)} \\approx 21.471$ kJ/mol。四舍五入到3位有效数字， $h=21.5$ kJ/mol。\n- 案例D：$(N, \\tau_{\\mathrm{int}}, s) = (10^3, 600, 5)$\n  $b_0 = \\lceil 20 \\times 600 \\rceil = 12000$。$\\lfloor 10^3 / 12000 \\rfloor = 0  30$，所以 $b = \\max\\{1, \\lfloor 10^3 / 30 \\rfloor\\} = 33$。\n  $h = 1.959964 \\times 5 \\times \\sqrt{2 \\times 600 / 10^3} \\approx 10.735$ kJ/mol。四舍五入到3位有效数字， $h=10.7$ kJ/mol。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Solves the problem by calculating block size and confidence interval half-width\n    for a set of test cases related to correlated time series analysis.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple is (N, tau_int, s)\n    test_cases = [\n        (10**6, 500.0, 50.0),        # Case A\n        (5 * 10**4, 0.5, 10.0),    # Case B\n        (2 * 10**4, 3000.0, 20.0),  # Case C\n        (10**3, 600.0, 5.0),         # Case D\n    ]\n\n    # Pre-calculate the 95% two-sided Gaussian quantile (z_{0.975})\n    z_975 = norm.ppf(0.975)\n    \n    # This list will store the final results for all test cases.\n    results_list = []\n\n    for case in test_cases:\n        N, tau_int, s = case\n\n        # Task 2: Block size selection\n        # Compute the preferred block size b_0\n        b0 = np.ceil(20 * tau_int)\n        \n        # Check if using b_0 yields at least 30 blocks\n        if np.floor(N / b0) >= 30:\n            b = int(b0)\n        else:\n            # Otherwise, set block size to ensure about 30 blocks\n            b = int(max(1, np.floor(N / 30)))\n\n        # Task 3: Numerical evaluation of the half-width h\n        # Formula derived in Task 1: h = z * s * sqrt(2 * tau_int / N)\n        # We must handle the case where N or tau_int is zero to avoid division errors,\n        # although the test cases prevent this.\n        if N > 0 and tau_int >= 0:\n            h_unrounded = z_975 * s * np.sqrt(2 * tau_int / N)\n        else:\n            h_unrounded = 0.0\n\n        results_list.append([b, h_unrounded])\n\n    # Format the final output string according to the problem specification.\n    # The half-width 'h' must be represented as a number rounded to three\n    # significant figures, which requires careful string formatting to handle\n    # cases like 3.10 correctly.\n    formatted_results = []\n    for b_val, h_val in results_list:\n        if h_val == 0:\n            h_str = \"0.0\"\n        else:\n            # Calculate the number of decimal places required for 3 significant figures.\n            # a) Find the magnitude of the number: floor(log10(|h|))\n            # b) Decimal places = sf - 1 - magnitude, where sf=3\n            magnitude = np.floor(np.log10(np.abs(h_val)))\n            decimals = 3 - 1 - int(magnitude)\n            h_str = f\"{h_val:.{decimals}f}\"\n        \n        # In Python 3, str(float) might not produce the required trailing zeros,\n        # e.g., str(3.10) is '3.1'. To conform to the \"three significant figures\"\n        # requirement in the output representation, we format it as a string.\n        # However, the final output must not have quotes around numbers.\n        # Python's list-to-string conversion will handle this. We must convert\n        # the formatted string back to a float for cases like '3.10' -> 3.1,\n        # yet this loses the formatting. The most compliant interpretation\n        # is to construct the final string manually.\n        formatted_results.append(f\"[{b_val},{h_str}]\")\n        \n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output_string)\n\nsolve()\n```", "id": "3411613"}, {"introduction": "虽然使用启发式规则选择分块大小的平均法是有效的，但我们可以通过优化分块大小本身来达到更高的严谨性。这个高级练习将统计估计理论与模拟的物理模型直接联系起来，将系统性质（如在恒压模拟中的体积）的涨落处理为Ornstein-Uhlenbeck过程。您将推导出能够最小化方差估计值均方误差的最优分块时长，从而在统计偏差和方差之间取得最佳平衡，为给定的总模拟时间提供最可靠的不确定性量化。[@problem_id:3411678]", "problem": "在采用随机控压器的等温等压分子动力学（MD）模拟中，模拟单元体积的微小平衡涨落可被建模为对热力学力和随机热噪声的线性响应。假设控压器引起一个单一的特征弛豫速率，称为控压器摩擦速率，用 $\\xi$ 表示，单位为时间的倒数；并假设对于围绕平衡点的微小偏差，体积时间序列 $V(t)$ 演化为一个平稳高斯马尔可夫过程。将控压器驱动的 $V(t)$ 视为一个 Ornstein–Uhlenbeck (OU) 过程，其弛豫由 $\\xi$ 控制，平稳方差为 $\\sigma_{V}^{2}$，并假设在总观测时间 $T$ 内轨迹被连续记录。\n\n您需要将轨迹划分为 $m$ 个相等的连续区块，每个区块的时间长度为 $L$，因此 $m = T/L$。设 $Y_{j}$ 为 $V(t)$ 在区块 $j$ 上的均值，并通过取区块均值的样本方差再按区块数量进行缩放来定义整体时间平均值 $\\bar{V}$ 的方差估计量：$\\widehat{\\mathrm{Var}}(\\bar{V}) := s_{Y}^{2}/m$，其中 $s_{Y}^{2}$ 是 $\\{Y_{j}\\}_{j=1}^{m}$ 的样本方差。\n\n从 Ornstein–Uhlenbeck 过程的标准随机动力学假设以及方差和自协方差的基本时间序列定义出发，执行以下操作：\n\n- 推导 $V(t)$ 的自相关结构，将其表示为控压器摩擦速率 $\\xi$ 和积分自相关时间的函数。\n- 计算单个区块均值 $Y_{j}$ 的精确方差以及两个区块均值 $Y_{j}$ 和 $Y_{j+k}$ 之间的互协方差。\n- 使用这些结果获得以 $\\sigma_{V}^{2}$、$\\xi$ 和 $T$ 表示的 $\\mathrm{Var}(\\bar{V})$ 的精确表达式。\n- 在忽略区块间相关性的情况下，分析 $\\widehat{\\mathrm{Var}}(\\bar{V})$ 的偏差，并在区块均值对于足够大的 $L$ 是近似独立的独立高斯变量的假设下，估计 $\\widehat{\\mathrm{Var}}(\\bar{V})$ 的方差。\n- 构建一个显式的近似均方误差泛函 $\\mathrm{MSE}(L)$，该泛函能捕捉 $\\widehat{\\mathrm{Var}}(\\bar{V})$ 的偏差和方差之间作为区块时长 $L$、总观测时间 $T$ 和控压器摩擦速率 $\\xi$ 函数的主导阶权衡。\n- 对该 $\\mathrm{MSE}(L)$ 就 $L$ 进行最小化，以获得最优区块时长 $L^{\\ast}$ 的闭式解析表达式。\n\n将最优区块时长 $L^{\\ast}$ 表示为一个以秒为单位、用 $T$ 和 $\\xi$ 表示的单一解析表达式，最终表达式中不应包含其他参数。无需进行数值舍入。最终答案必须是单一的闭式表达式，并且最终方框内的表达式不得包含任何单位。", "solution": "用户在分子动力学模拟的统计分析领域提供了一个有效且适定的问题。该问题要求推导用于估计一个时间平均性质（建模为 Ornstein-Uhlenbeck 过程）方差的最优区块长度。解决方案按问题陈述中概述的任务顺序进行。\n\n体积涨落 $V(t)$ 被建模为一个平稳的 Ornstein-Uhlenbeck (OU) 过程。对应的 $V(t)$ 的朗之万方程（为进行协方差计算，不失一般性地将其均值 $\\mu_V$ 设为 $0$）是：\n$$\n\\frac{dV(t)}{dt} = -\\xi V(t) + \\eta(t)\n$$\n其中 $\\xi$ 是控压器摩擦速率，$\\eta(t)$ 是一个白噪声项，满足 $\\langle \\eta(t) \\eta(t') \\rangle = 2D \\delta(t-t')$。该过程的平稳方差是 $\\sigma_V^2 = \\langle V(t)^2 \\rangle = D/\\xi$。\n\n**1. $V(t)$ 的自相关结构**\n\n对于平稳 OU 过程，其自相关函数 (ACF) 由下式给出：\n$$\nC_V(\\tau) = \\text{Cov}(V(t), V(t+\\tau)) = \\langle V(t)V(t+\\tau) \\rangle = \\sigma_V^2 \\exp(-\\xi |\\tau|)\n$$\n归一化的自相关函数是 $\\rho_V(\\tau) = C_V(\\tau) / C_V(0) = \\exp(-\\xi |\\tau|)$。\n\n积分自相关时间 $\\tau_{int}$ 是归一化自相关函数的积分：\n$$\n\\tau_{int} = \\int_0^\\infty \\rho_V(\\tau) d\\tau = \\int_0^\\infty \\exp(-\\xi \\tau) d\\tau = \\left[ -\\frac{1}{\\xi} \\exp(-\\xi \\tau) \\right]_0^\\infty = \\frac{1}{\\xi}\n$$\n所以，相关性的特征时间尺度是控压器摩擦速率的倒数。\n\n**2. 区块均值的方差和协方差**\n\n时长为 $L$ 的区块 $j$ 上 $V(t)$ 的均值是 $Y_j = \\frac{1}{L} \\int_{(j-1)L}^{jL} V(t) \\, dt$。由于 $\\langle V(t) \\rangle = 0$，我们有 $\\langle Y_j \\rangle = 0$。\n\n单个区块均值的方差 $\\mathrm{Var}(Y_j)$ 由自相关函数在区块上的二重积分给出：\n$$\n\\mathrm{Var}(Y_j) = \\langle Y_j^2 \\rangle = \\frac{1}{L^2} \\int_{(j-1)L}^{jL} \\int_{(j-1)L}^{jL} \\langle V(t)V(t') \\rangle \\, dt \\, dt'\n$$\n为简单起见，我们将积分域平移到 $[0, L]$：\n$$\n\\mathrm{Var}(Y_j) = \\frac{\\sigma_V^2}{L^2} \\int_0^L \\int_0^L \\exp(-\\xi|t-t'|) \\, dt \\, dt' = \\frac{2\\sigma_V^2}{L^2} \\int_0^L dt \\int_0^t dt' \\exp(-\\xi(t-t'))\n$$\n内层积分为 $\\int_0^t \\exp(-\\xi(t-t')) \\, dt' = \\exp(-\\xi t) \\left[\\frac{1}{\\xi}\\exp(\\xi t')\\right]_0^t = \\frac{1}{\\xi}(1 - \\exp(-\\xi t))$。\n外层积分变为：\n$$\n\\frac{2\\sigma_V^2}{L^2} \\int_0^L \\frac{1}{\\xi}(1 - \\exp(-\\xi t)) \\, dt = \\frac{2\\sigma_V^2}{\\xi L^2} \\left[t + \\frac{1}{\\xi}\\exp(-\\xi t)\\right]_0^L = \\frac{2\\sigma_V^2}{\\xi L^2} \\left(L + \\frac{1}{\\xi}(\\exp(-\\xi L) - 1)\\right)\n$$\n因此，区块均值的精确方差为：\n$$\n\\mathrm{Var}(Y_j) = \\frac{2\\sigma_V^2}{\\xi^2 L^2} \\left(\\xi L - 1 + \\exp(-\\xi L)\\right)\n$$\n对于 $k \\ge 1$，区块均值 $Y_j$ 和 $Y_{j+k}$ 之间的互协方差为：\n$$\n\\mathrm{Cov}(Y_j, Y_{j+k}) = \\frac{1}{L^2} \\int_{(j-1)L}^{jL} dt \\int_{(j+k-1)L}^{(j+k)L} dt' \\, \\sigma_V^2 \\exp(-\\xi(t'-t))\n$$\n因为 $t' > t$。令 $u = t - (j-1)L$ 及 $v = t' - (j+k-1)L$。则 $t'-t = v-u+kL$。\n$$\n\\mathrm{Cov}(Y_j, Y_{j+k}) = \\frac{\\sigma_V^2}{L^2} \\int_0^L du \\int_0^L dv \\, \\exp(-\\xi(v-u+kL)) = \\frac{\\sigma_V^2}{L^2} \\exp(-\\xi kL) \\left(\\int_0^L \\exp(\\xi u) du\\right) \\left(\\int_0^L \\exp(-\\xi v) dv\\right)\n$$\n这两个积分分别得到 $\\frac{1}{\\xi}(\\exp(\\xi L) - 1)$ 和 $\\frac{1}{\\xi}(1 - \\exp(-\\xi L))$。它们的乘积是 $\\frac{1}{\\xi^2}(\\exp(\\xi L) - 2 + \\exp(-\\xi L)) = \\frac{1}{\\xi^2}(\\exp(\\xi L/2) - \\exp(-\\xi L/2))^2$。\n乘积的一个更简单的形式是 $\\frac{1}{\\xi^2}(\\exp(\\xi L)-1)(1-\\exp(-\\xi L)) = \\frac{1}{\\xi^2}\\exp(\\xi L)(1-\\exp(-\\xi L))^2$。\n所以，协方差为：\n$$\n\\mathrm{Cov}(Y_j, Y_{j+k}) = \\frac{\\sigma_V^2}{\\xi^2 L^2} (1 - \\exp(-\\xi L))^2 \\exp(-\\xi(k-1)L)\n$$\n\n**3. 整体均值 $\\bar{V}$ 的精确方差**\n\n整体均值为 $\\bar{V} = \\frac{1}{T} \\int_0^T V(t) \\, dt$。其方差 $\\mathrm{Var}(\\bar{V})$ 的函数形式与 $\\mathrm{Var}(Y_j)$ 相同，只是将 $L$ 替换为 $T$：\n$$\n\\mathrm{Var}(\\bar{V}) = \\frac{2\\sigma_V^2}{\\xi^2 T^2} \\left(\\xi T - 1 + \\exp(-\\xi T)\\right)\n$$\n在长观测时间 $T \\gg 1/\\xi$ 的极限下，该表达式简化为众所周知的结果：\n$$\n\\mathrm{Var}(\\bar{V}) \\approx \\frac{2\\sigma_V^2}{\\xi T} = \\frac{2 \\sigma_V^2 \\tau_{int}}{T}\n$$\n\n**4. 估计量 $\\widehat{\\mathrm{Var}}(\\bar{V})$ 的偏差和方差**\n\n估计量为 $\\widehat{\\mathrm{Var}}(\\bar{V}) = s_Y^2 / m$，其中 $s_Y^2 = \\frac{1}{m-1}\\sum_{j=1}^m (Y_j - \\bar{Y})^2$ 且 $m=T/L$。\n估计量的期望为 $\\mathrm{E}[\\widehat{\\mathrm{Var}}(\\bar{V})] = \\frac{1}{m} \\mathrm{E}[s_Y^2]$。相关时间序列的样本方差的期望为 $\\mathrm{E}[s_Y^2] = \\mathrm{Var}(Y_j) - \\frac{2}{m-1}\\sum_{k=1}^{m-1}(1-k/m)\\mathrm{Cov}(Y_j, Y_{j+k})$。\n估计量的偏差为 $\\mathrm{Bias} = \\mathrm{E}[\\widehat{\\mathrm{Var}}(\\bar{V})] - \\mathrm{Var}(\\bar{V})$。\n为了找到最优的 $L$，我们需要在区块长度 $L \\gg \\tau_{int} = 1/\\xi$ 时偏差的主导阶行为。在此极限下，区块间的相关性很弱且迅速衰减。对偏差的主要贡献来自相邻区块 ($k=1$) 间的协方差。\n$$\n\\mathrm{Bias} \\approx \\frac{1}{m} \\left( \\mathrm{Var}(Y_j) - \\mathrm{Var}(Y_j) - 2\\mathrm{Cov}(Y_j, Y_{j+1}) \\right) = -\\frac{2}{m} \\mathrm{Cov}(Y_j, Y_{j+1})\n$$\n使用 $\\mathrm{Cov}(Y_j, Y_{j+1})$ 的表达式并取 $L \\gg 1/\\xi$ 的极限：\n$$\n\\mathrm{Cov}(Y_j, Y_{j+1}) = \\frac{\\sigma_V^2}{\\xi^2 L^2} (1 - \\exp(-\\xi L))^2 \\approx \\frac{\\sigma_V^2}{\\xi^2 L^2}\n$$\n那么偏差为：\n$$\n\\mathrm{Bias} \\approx -\\frac{2}{m} \\frac{\\sigma_V^2}{\\xi^2 L^2} = -\\frac{2L}{T} \\frac{\\sigma_V^2}{\\xi^2 L^2} = -\\frac{2\\sigma_V^2}{T\\xi^2 L}\n$$\n偏差的平方为：\n$$\n(\\mathrm{Bias})^2 \\approx \\left(-\\frac{2\\sigma_V^2}{T\\xi^2 L}\\right)^2 = \\frac{4\\sigma_V^4}{T^2\\xi^4 L^2}\n$$\n现在我们估计该估计量的方差。问题要求我们假设对于较大的 $L$，区块均值 $Y_j$ 是近似独立的独立高斯变量。在此假设下，$(m-1)s_Y^2/\\mathrm{Var}(Y_j)$ 近似服从自由度为 $m-1$ 的卡方分布。那么 $s_Y^2$ 的方差为 $\\mathrm{Var}(s_Y^2) \\approx \\frac{2(\\mathrm{Var}(Y_j))^2}{m-1}$。\n我们的估计量的方差为：\n$$\n\\mathrm{Var}(\\widehat{\\mathrm{Var}}(\\bar{V})) = \\frac{1}{m^2} \\mathrm{Var}(s_Y^2) \\approx \\frac{2(\\mathrm{Var}(Y_j))^2}{m^2(m-1)}\n$$\n对于大的 $m$（通常 $T \\gg L$），我们可以近似 $m-1 \\approx m$。对于大的 $L$，$\\mathrm{Var}(Y_j) \\approx \\frac{2\\sigma_V^2}{\\xi L}$。\n$$\n\\mathrm{Var}(\\widehat{\\mathrm{Var}}(\\bar{V})) \\approx \\frac{2}{m^3} \\left(\\frac{2\\sigma_V^2}{\\xi L}\\right)^2 = \\frac{8\\sigma_V^4}{m^3 \\xi^2 L^2}\n$$\n代入 $m=T/L$：\n$$\n\\mathrm{Var}(\\widehat{\\mathrm_Var}}(\\bar{V})) \\approx \\frac{8\\sigma_V^4}{(T/L)^3 \\xi^2 L^2} = \\frac{8\\sigma_V^4 L^3}{T^3 \\xi^2 L^2} = \\frac{8\\sigma_V^4 L}{T^3 \\xi^2}\n$$\n\n**5. 均方误差泛函**\n\n均方误差 (MSE) 是偏差的平方与方差之和：\n$$\n\\mathrm{MSE}(L) = (\\mathrm{Bias})^2 + \\mathrm{Var}(\\widehat{\\mathrm{Var}}(\\bar{V}))\n$$\n使用我们的主导阶近似，我们构建 MSE 泛函：\n$$\n\\mathrm{MSE}(L) \\approx \\frac{4\\sigma_V^4}{T^2\\xi^4 L^2} + \\frac{8\\sigma_V^4 L}{T^3 \\xi^2}\n$$\n这个泛函捕捉了本质的权衡：偏差平方项随 $L^{-2}$ 减小，而方差项随 $L^1$ 增大。\n\n**6. 最优区块时长 $L^{\\ast}$**\n\n为了找到最小化 MSE 的最优区块时长 $L^{\\ast}$，我们对 $\\mathrm{MSE}(L)$ 关于 $L$ 求导，并令其导数为零。\n$$\n\\frac{d}{dL} \\mathrm{MSE}(L) = \\frac{d}{dL} \\left( \\frac{4\\sigma_V^4}{T^2\\xi^4} L^{-2} + \\frac{8\\sigma_V^4}{T^3 \\xi^2} L \\right) = 0\n$$\n$$\n-2 \\cdot \\frac{4\\sigma_V^4}{T^2\\xi^4} L^{-3} + \\frac{8\\sigma_V^4}{T^3 \\xi^2} = 0\n$$\n$$\n\\frac{8\\sigma_V^4}{T^2\\xi^4 L^3} = \\frac{8\\sigma_V^4}{T^3 \\xi^2}\n$$\n我们可以消去公因子 $8\\sigma_V^4$：\n$$\n\\frac{1}{T^2\\xi^4 L^3} = \\frac{1}{T^3 \\xi^2}\n$$\n解出 $L^3$：\n$$\nL^3 = \\frac{T^3 \\xi^2}{T^2\\xi^4} = \\frac{T}{\\xi^2}\n$$\n取立方根得到最优区块时长 $L^{\\ast}$：\n$$\nL^{\\ast} = \\left(\\frac{T}{\\xi^2}\\right)^{1/3} = T^{1/3} \\xi^{-2/3}\n$$\n这就是用总观测时间 $T$ 和控压器摩擦速率 $\\xi$ 表示的最优区块时长的闭式解析表达式。", "answer": "$$ \\boxed{ \\left( \\frac{T}{\\xi^2} \\right)^{1/3} } $$", "id": "3411678"}]}