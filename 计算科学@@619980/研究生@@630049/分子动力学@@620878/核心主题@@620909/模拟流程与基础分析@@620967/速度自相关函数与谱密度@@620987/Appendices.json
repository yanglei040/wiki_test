{"hands_on_practices": [{"introduction": "理论和实践的结合始于一个基础模型。本练习将从最简单的非平庸速度自相关函数（VACF）模型——指数衰减——出发，它代表了一个纯粹的马尔可夫记忆丧失过程。通过手动推导其傅里叶变换，你将直接揭示关联衰减的时间尺度 $ \\gamma $ 如何决定谱密度峰的宽度，从而深刻理解时间和频率域之间的基本对应关系。[@problem_id:3459372]", "problem": "考虑一个平衡分子动力学 (MD) 中的单粒子速度过程，该过程是平稳遍历的，其速度自相关函数 (VAF) 记为 $C_{v}(t)$。功率谱密度 (PSD) $S_{v}(\\omega)$（其中 $\\omega$ 为角频率）由 Wiener–Khinchin 定理定义为 VAF 的傅里叶变换，\n$$\nS_{v}(\\omega) = \\int_{-\\infty}^{\\infty} C_{v}(t)\\,\\exp(i\\,\\omega t)\\,dt.\n$$\n假设 VAF 严格呈指数形式，\n$$\nC_{v}(t) = A\\,\\exp(-\\gamma\\,|t|),\n$$\n其中 $A>0$ 和 $\\gamma>0$ 为常数。从上述核心定义出发，推导 $S_{v}(\\omega)$ 作为 $\\omega$ 函数的精确解析表达式，并用 $A$ 和 $\\gamma$ 表示其半峰全宽 (FWHM) 和在 $\\omega=0$ 处的峰高。将最终答案表示为单行矩阵，其中依次包含 $S_{v}(\\omega)$、FWHM 和峰高这三个量。无需进行数值四舍五入，也无需单位。", "solution": "该问题有效。它在科学上基于统计力学和分子动力学的原理，特别是 Wiener–Khinchin 定理和指数衰减速度自相关函数 (VAF) 的通用模型。该问题是适定的，提供了推导唯一解析解所需的所有信息。\n\n任务是在给定 VAF $C_{v}(t) = A\\,\\exp(-\\gamma\\,|t|)$ 的情况下，推导功率谱密度 (PSD) $S_{v}(\\omega)$、其半峰全宽 (FWHM) 及其峰高。\n\nPSD 的定义由 Wiener–Khinchin 定理给出：\n$$\nS_{v}(\\omega) = \\int_{-\\infty}^{\\infty} C_{v}(t)\\,\\exp(i\\,\\omega t)\\,dt\n$$\n代入给定的 VAF 表达式 $C_{v}(t)$，我们得到：\n$$\nS_{v}(\\omega) = \\int_{-\\infty}^{\\infty} A\\,\\exp(-\\gamma\\,|t|)\\,\\exp(i\\,\\omega t)\\,dt\n$$\n由于 $A$ 是常数，我们可以将其从积分中提取出来：\n$$\nS_{v}(\\omega) = A \\int_{-\\infty}^{\\infty} \\exp(-\\gamma\\,|t|)\\,\\exp(i\\,\\omega t)\\,dt\n$$\n绝对值函数 $|t|$ 定义为：当 $t \\ge 0$ 时 $|t| = t$；当 $t  0$ 时 $|t| = -t$。我们必须将积分在定义域 $(-\\infty, 0)$ 和 $(0, \\infty)$ 上拆分为两部分：\n$$\nS_{v}(\\omega) = A \\left( \\int_{-\\infty}^{0} \\exp(-\\gamma\\,(-t))\\,\\exp(i\\,\\omega t)\\,dt + \\int_{0}^{\\infty} \\exp(-\\gamma\\,t)\\,\\exp(i\\,\\omega t)\\,dt \\right)\n$$\n$$\nS_{v}(\\omega) = A \\left( \\int_{-\\infty}^{0} \\exp(\\gamma t)\\,\\exp(i\\,\\omega t)\\,dt + \\int_{0}^{\\infty} \\exp(-\\gamma t)\\,\\exp(i\\,\\omega t)\\,dt \\right)\n$$\n我们合并每个积分中的指数：\n$$\nS_{v}(\\omega) = A \\left( \\int_{-\\infty}^{0} \\exp((\\gamma + i\\omega)t)\\,dt + \\int_{0}^{\\infty} \\exp(-(\\gamma - i\\omega)t)\\,dt \\right)\n$$\n现在我们计算每个积分。对于第一个积分：\n$$\n\\int_{-\\infty}^{0} \\exp((\\gamma + i\\omega)t)\\,dt = \\left[ \\frac{\\exp((\\gamma + i\\omega)t)}{\\gamma + i\\omega} \\right]_{t=-\\infty}^{t=0}\n$$\n上限给出 $\\frac{\\exp(0)}{\\gamma + i\\omega} = \\frac{1}{\\gamma + i\\omega}$。下限是 $\\lim_{t \\to -\\infty} \\frac{\\exp(\\gamma t)\\exp(i\\omega t)}{\\gamma + i\\omega}$。由于 $\\gamma  0$，当 $t \\to -\\infty$ 时 $\\exp(\\gamma t) \\to 0$。项 $\\exp(i\\omega t)$ 是有界的。因此，极限为 $0$。第一个积分的计算结果为 $\\frac{1}{\\gamma + i\\omega}$。\n\n对于第二个积分：\n$$\n\\int_{0}^{\\infty} \\exp(-(\\gamma - i\\omega)t)\\,dt = \\left[ \\frac{\\exp(-(\\gamma - i\\omega)t)}{-(\\gamma - i\\omega)} \\right]_{t=0}^{t=\\infty}\n$$\n下限给出 $\\frac{\\exp(0)}{-(\\gamma - i\\omega)} = -\\frac{1}{-(\\gamma-i\\omega)} = \\frac{1}{\\gamma-i\\omega}$。上限是 $\\lim_{t \\to \\infty} \\frac{\\exp(-\\gamma t)\\exp(i\\omega t)}{-(\\gamma - i\\omega)}$。由于 $\\gamma  0$，当 $t \\to \\infty$ 时 $\\exp(-\\gamma t) \\to 0$。因此，上限为 $0$。第二个积分的计算结果为 $0 - \\left(-\\frac{1}{\\gamma-i\\omega}\\right) = \\frac{1}{\\gamma - i\\omega}$。\n\n将这些结果代回 $S_v(\\omega)$ 的表达式中：\n$$\nS_{v}(\\omega) = A \\left( \\frac{1}{\\gamma + i\\omega} + \\frac{1}{\\gamma - i\\omega} \\right)\n$$\n为了合并这些项，我们使用公分母 $(\\gamma + i\\omega)(\\gamma - i\\omega) = \\gamma^2 - (i\\omega)^2 = \\gamma^2 - (-1)\\omega^2 = \\gamma^2 + \\omega^2$：\n$$\nS_{v}(\\omega) = A \\left( \\frac{(\\gamma - i\\omega) + (\\gamma + i\\omega)}{\\gamma^2 + \\omega^2} \\right) = A \\left( \\frac{2\\gamma}{\\gamma^2 + \\omega^2} \\right)\n$$\n所以，PSD的解析表达式是一个关于 $\\omega$ 的洛伦兹函数：\n$$\nS_{v}(\\omega) = \\frac{2A\\gamma}{\\omega^2 + \\gamma^2}\n$$\n这是要求的第一个量。\n\n接下来，我们求 PSD 的峰高。PSD 是一个分母中含有 $\\omega^2$ 的函数。由于 $\\omega^2 \\ge 0$，当 $\\omega = 0$ 时分母最小。这对应于函数的峰值。峰高为 $S_{v}(0)$:\n$$\nS_{v, \\text{peak}} = S_{v}(0) = \\frac{2A\\gamma}{0^2 + \\gamma^2} = \\frac{2A\\gamma}{\\gamma^2} = \\frac{2A}{\\gamma}\n$$\n这是要求的第三个量。\n\n最后，我们确定半峰全宽 (FWHM)。FWHM 是 PSD 等于其最大值一半时两个 $\\omega$ 值之差。半峰高为 $\\frac{1}{2}S_{v, \\text{peak}} = \\frac{1}{2}\\left(\\frac{2A}{\\gamma}\\right) = \\frac{A}{\\gamma}$。我们令 $S_{v}(\\omega)$ 等于此值，并求解 $\\omega$:\n$$\n\\frac{2A\\gamma}{\\omega^2 + \\gamma^2} = \\frac{A}{\\gamma}\n$$\n由于 $A  0$ 和 $\\gamma  0$，我们可以消去两边的 $A$ 并交叉相乘：\n$$\n2\\gamma^2 = \\omega^2 + \\gamma^2\n$$\n$$\n\\omega^2 = \\gamma^2\n$$\n这给出了 $\\omega$ 的两个解：$\\omega = \\pm \\gamma$。FWHM 是 $\\omega$ 轴上这两点之间的距离：\n$$\n\\text{FWHM} = \\gamma - (-\\gamma) = 2\\gamma\n$$\n这是要求的第二个量。\n\n按要求的顺序，这三个量分别是 $S_{v}(\\omega)$ 的表达式、FWHM 和峰高。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{2A\\gamma}{\\omega^{2} + \\gamma^{2}}  2\\gamma  \\frac{2A}{\\gamma} \\end{pmatrix}}\n$$", "id": "3459372"}, {"introduction": "理解了理想模型后，我们将转向描述真实稠密流体的物理现实。速度自相关函数在极短时间内的行为并非任意，而是粒子间相互作用力的直接体现。本练习将引导你建立起宏观关联函数 $ C_v(t) $ 的初始曲率与微观粒子间相互作用势和径向分布函数 $ g(r) $ 之间的桥梁。[@problem_id:3459347]", "problem": "考虑一个在三维空间中，数密度为 $\\rho$、温度为 $T$、粒子质量为 $m$ 的均匀、各向同性、单原子 Lennard-Jones 流体。粒子间通过成对相加的势 $\\phi_{\\mathrm{LJ}}(r) = 4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$ 相互作用，其中 $\\epsilon$ 和 $\\sigma$ 是常规的 Lennard-Jones 参数。令 $C_v(t)$ 表示单个笛卡尔分量的平衡速度自相关函数 (VACF)，定义为 $C_v(t) = \\langle v_x(0)\\,v_x(t)\\rangle$，其中 $\\langle \\cdot \\rangle$ 表示平衡系综平均。\n\n仅从牛顿第二定律、VACF 的定义以及成对相加力的假设出发，推导 $C_v(t)$ 在 $t=0$ 时的初始曲率的表达式，该表达式用均方加速度 $\\langle a_x^2\\rangle$ 表示，然后将标记粒子的总均方加速度 $\\langle a^2\\rangle$ 用径向对分布函数 $g(r)$ 和对势的导数表示。您可以假设：\n- 空间均匀性和各向同性，\n- 平衡态的平稳性和时间反演不变性，\n- 来自不同邻居的力贡献在平均后去相关，因此总力的平方中的交叉项平均为零（这是一种与忽略三体作用力-作用力相关性一致的低阶闭合）。\n\n使用这些步骤，得到一个以 $\\rho$、$m$、$g(r)$、$\\epsilon$ 和 $\\sigma$ 表示的 $C_v''(0)$ 的最终解析表达式。将您的最终答案表示为包含一个 $r$ 积分和已知函数的单一闭合形式表达式。不要引入超出指定范围的任何唯象参数。不需要进行数值计算。最终答案必须是 $C_v''(0)$ 的单一解析表达式；不要报告中间结果。", "solution": "本题要求推导 Lennard-Jones 流体单分量速度自相关函数初始曲率 $C_v''(0)$ 的表达式。推导将分三步进行：首先，将 $C_v''(t)$ 与力自相关函数联系起来；其次，用对势和径向分布函数表示均方力；第三，将这些结果与 Lennard-Jones 势的具体形式相结合。\n\n单个笛卡尔分量（例如 $x$）的速度自相关函数定义为：\n$$C_v(t) = \\langle v_x(0)\\,v_x(t)\\rangle$$\n其中 $v_x(t)$ 是粒子在时间 $t$ 的速度的 $x$ 分量，而 $\\langle \\cdot \\rangle$ 表示平衡系综平均。\n\n为了求出 $t=0$ 时的曲率，我们必须计算 $C_v(t)$ 的二阶导数并在 $t=0$ 处求值。$C_v(t)$ 对时间 $t$ 求导得到：\n$$C_v'(t) = \\frac{d}{dt}\\langle v_x(0)\\,v_x(t)\\rangle = \\langle v_x(0)\\,\\frac{d}{dt}v_x(t)\\rangle = \\langle v_x(0)\\,a_x(t)\\rangle$$\n其中 $a_x(t) = \\dot{v}_x(t)$ 是加速度的 $x$ 分量。\n\n再次求导得到：\n$$C_v''(t) = \\langle v_x(0)\\,\\dot{a}_x(t)\\rangle$$\n其中 $\\dot{a}_x(t)$ 是急动度（jerk）的 $x$ 分量。在 $t=0$ 处求值得到 $C_v''(0) = \\langle v_x(0)\\,\\dot{a}_x(0)\\rangle$。为了用均方加速度来表示这个表达式，我们使用平衡态的平稳性属性。对于任意两个动力学变量 $A(t)$ 和 $B(t)$，平稳性意味着 $\\langle \\dot{A}(t)B(t+\\tau) \\rangle = - \\langle A(t)\\dot{B}(t+\\tau) \\rangle$。\n\n令 $A(t) = v_x(t)$ 且 $B(t) = a_x(t) = \\dot{v}_x(t)$。在 $t=0$ 时应用该恒等式得到：\n$$\\langle \\dot{v}_x(0)\\,a_x(\\tau) \\rangle = - \\langle v_x(0)\\,\\dot{a}_x(\\tau) \\rangle$$\n注意到 $\\dot{v}_x(0)=a_x(0)$，我们有：\n$$\\langle a_x(0)\\,a_x(\\tau) \\rangle = - \\langle v_x(0)\\,\\dot{a}_x(\\tau) \\rangle$$\n从我们关于二阶导数的表达式可以看出，右边是 $-C_v''(\\tau)$。因此，我们建立了 VACF 的二阶导数与加速度自相关函数之间的联系：\n$$C_v''(t) = - \\langle a_x(0)\\,a_x(t) \\rangle$$\n在 $t=0$ 处求值得到所需的初始关系：\n$$C_v''(0) = - \\langle a_x(0)^2 \\rangle = - \\langle a_x^2 \\rangle$$\n\n接下来，我们用微观属性来表示均方加速度 $\\langle a_x^2 \\rangle$。根据牛顿第二定律，质量为 $m$ 的粒子的加速度 $\\mathbf{a}$ 与作用在其上的总力 $\\mathbf{F}$ 之间的关系为 $\\mathbf{a} = \\mathbf{F}/m$。作用于一个标记粒子（标记为 $i$）上的总力是来自所有其他粒子 $j$ 的力的成对相加总和：\n$$\\mathbf{F}_i = \\sum_{j \\neq i} \\mathbf{f}_{ij}$$\n其中 $\\mathbf{f}_{ij} = -\\nabla_i \\phi(r_{ij})$ 是粒子 $j$ 对粒子 $i$ 的作用力，其中 $r_{ij} = |\\mathbf{r}_i - \\mathbf{r}_j|$ 且 $\\phi(r)$ 是对势。\n\n标记粒子的均方加速度是：\n$$\\langle a^2 \\rangle = \\langle \\mathbf{a} \\cdot \\mathbf{a} \\rangle = \\frac{1}{m^2} \\langle \\mathbf{F} \\cdot \\mathbf{F} \\rangle = \\frac{1}{m^2} \\left\\langle \\left( \\sum_{j \\neq i} \\mathbf{f}_{ij} \\right) \\cdot \\left( \\sum_{k \\neq i} \\mathbf{f}_{ik} \\right) \\right\\rangle = \\frac{1}{m^2} \\left\\langle \\sum_{j \\neq i} |\\mathbf{f}_{ij}|^2 + \\sum_{j \\neq i} \\sum_{k \\neq j, k \\neq i} \\mathbf{f}_{ij} \\cdot \\mathbf{f}_{ik} \\right\\rangle$$\n题目给出的假设是来自不同邻居的力的贡献去相关，这意味着交叉项的平均值为零：当 $j \\neq k$ 时 $\\langle \\mathbf{f}_{ij} \\cdot \\mathbf{f}_{ik} \\rangle = 0$。表达式简化为：\n$$\\langle a^2 \\rangle = \\frac{1}{m^2} \\left\\langle \\sum_{j \\neq i} |\\mathbf{f}_{ij}|^2 \\right\\rangle$$\n成对函数之和的平均值可以使用径向对分布函数 $g(r)$ 来计算。项 $\\rho g(r) d\\mathbf{r}$ 给出了在距离标记粒子 $r$ 处的体积元 $d\\mathbf{r}$ 中找到另一个粒子的概率，其中 $\\rho$ 是数密度。\n$$\\langle a^2 \\rangle = \\frac{1}{m^2} \\rho \\int |\\mathbf{f}(r)|^2 g(r) \\, d\\mathbf{r}$$\n力是纯粹的中心力，$\\mathbf{f}(r) = -\\frac{d\\phi}{dr} \\hat{\\mathbf{r}}$，所以其大小的平方是 $|\\mathbf{f}(r)|^2 = (\\frac{d\\phi}{dr})^2$。在球坐标系下积分（$d\\mathbf{r} = 4\\pi r^2 dr$）：\n$$\\langle a^2 \\rangle = \\frac{4\\pi\\rho}{m^2} \\int_0^\\infty \\left(\\frac{d\\phi(r)}{dr}\\right)^2 g(r) r^2 dr$$\n系统是各向同性的，所以均方加速度的分量相等：$\\langle a^2 \\rangle = \\langle a_x^2 \\rangle + \\langle a_y^2 \\rangle + \\langle a_z^2 \\rangle = 3\\langle a_x^2 \\rangle$。因此：\n$$\\langle a_x^2 \\rangle = \\frac{1}{3}\\langle a^2 \\rangle = \\frac{4\\pi\\rho}{3m^2} \\int_0^\\infty \\left(\\frac{d\\phi(r)}{dr}\\right)^2 g(r) r^2 dr$$\n将此代入我们关于 $C_v''(0)$ 的表达式中：\n$$C_v''(0) = - \\frac{4\\pi\\rho}{3m^2} \\int_0^\\infty \\left(\\frac{d\\phi(r)}{dr}\\right)^2 g(r) r^2 dr$$\n\n最后，我们代入 Lennard-Jones 势 $\\phi_{\\mathrm{LJ}}(r) = 4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$。它对 $r$ 的导数是：\n$$\\frac{d\\phi_{\\mathrm{LJ}}}{dr} = 4\\epsilon \\left[ \\sigma^{12}(-12)r^{-13} - \\sigma^6(-6)r^{-7} \\right] = 4\\epsilon \\left[ -12\\frac{\\sigma^{12}}{r^{13}} + 6\\frac{\\sigma^6}{r^7} \\right] = \\frac{24\\epsilon}{r} \\left[ \\left(\\frac{\\sigma}{r}\\right)^6 - 2\\left(\\frac{\\sigma}{r}\\right)^{12} \\right]$$\n对导数求平方得到：\n$$\\left(\\frac{d\\phi_{\\mathrm{LJ}}}{dr}\\right)^2 = \\left(\\frac{24\\epsilon}{r}\\right)^2 \\left[ \\left(\\frac{\\sigma}{r}\\right)^6 - 2\\left(\\frac{\\sigma}{r}\\right)^{12} \\right]^2 = \\frac{576\\epsilon^2}{r^2} \\left[ \\left(\\frac{\\sigma}{r}\\right)^{12} - 4\\left(\\frac{\\sigma}{r}\\right)^{18} + 4\\left(\\frac{\\sigma}{r}\\right)^{24} \\right]$$\n将此代入 $C_v''(0)$ 的积分中：\n$$C_v''(0) = - \\frac{4\\pi\\rho}{3m^2} \\int_0^\\infty \\left( \\frac{576\\epsilon^2}{r^2} \\left[ 4\\left(\\frac{\\sigma}{r}\\right)^{24} - 4\\left(\\frac{\\sigma}{r}\\right)^{18} + \\left(\\frac{\\sigma}{r}\\right)^{12} \\right] \\right) g(r) r^2 dr$$\n被积函数中的 $r^2$ 项相互抵消。常数前因子可以简化：\n$$\\frac{4\\pi\\rho}{3m^2} \\cdot 576\\epsilon^2 = \\frac{2304\\pi\\rho\\epsilon^2}{3m^2} = \\frac{768\\pi\\rho\\epsilon^2}{m^2}$$\n这就得到了速度自相关函数初始曲率的最终表达式：\n$$C_v''(0) = - \\frac{768\\pi\\rho\\epsilon^2}{m^2} \\int_0^\\infty \\left[ 4\\left(\\frac{\\sigma}{r}\\right)^{24} - 4\\left(\\frac{\\sigma}{r}\\right)^{18} + \\left(\\frac{\\sigma}{r}\\right)^{12} \\right] g(r) dr$$", "answer": "$$\\boxed{- \\frac{768\\pi\\rho\\epsilon^{2}}{m^{2}} \\int_0^\\infty \\left[ 4 \\left(\\frac{\\sigma}{r}\\right)^{24} - 4 \\left(\\frac{\\sigma}{r}\\right)^{18} + \\left(\\frac{\\sigma}{r}\\right)^{12} \\right] g(r) dr}$$", "id": "3459347"}, {"introduction": "理论知识最终需要应用于真实数据分析。分子动力学模拟产生的是有限长度的离散时间序列，而非完美的解析函数。本练习将指导你构建一个稳健的计算流程，包括数据分段、加窗函数以及使用 Jackknife 重采样进行误差估计等关键技术，从而从模拟轨迹中可靠地提取谱密度及其不确定性。[@problem_id:3459412]", "problem": "您需要从第一性原理出发，实现一个完整的计算流程，用于从分子动力学（MD）产生的单条有限轨迹中估计速度谱密度 $S_v(\\omega)$ 及其相关的置信区间。您的程序必须使用一个基于物理的朗之万动力学随机模型来合成单条稳态速度轨迹，然后使用分段和加窗技术，再对分段进行“删一”jackknife重采样，来估计 $S_v(\\omega)$ 并在一个目标角频率处获得置信区间。此任务必须纯粹以数学和算法术语来表述，且不得依赖外部输入。所有物理量必须以指定的单位表示，所有输出都必须进行数值量化。\n\n基本原理：\n- 使用牛顿力学和朗之万方程描述一个质量为 $m$ 的粒子，该粒子在温度 $T$ 下受到系数为 $\\gamma$ 的线性摩擦。瞬时速度 $v(t)$ 遵循一个稳态 Ornstein–Uhlenbeck 过程，该过程与能量均分定理一致。平衡速度方差满足 $\\mathrm{Var}(v) = k_{\\mathrm{B}} T / m$，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数。\n- 对于一个稳态过程，速度自相关函数 $C_v(t)$ 定义为 $C_v(t) = \\langle v(0) v(t) \\rangle$，而速度谱密度 $S_v(\\omega)$ 是通过 Wiener–Khinchin 定理与 $C_v(t)$ 相关联的谱测度。您的估计量必须从这些基本定义中推导出来，不得使用问题陈述中的快捷公式。\n\n轨迹生成：\n- 通过精确离散化模拟朗之万速度动力学（弛豫速率为 $\\lambda = \\gamma/m$）的稳態 Ornstein–Uhlenbeck 过程，生成一条合成速度轨迹 $\\{v_n\\}_{n=0}^{N-1}$，其时间点均匀分布 $t_n = n\\,\\Delta t$，时间步长 $\\Delta t$ 以秒为单位。使用高斯初始条件 $v_0 \\sim \\mathcal{N}(0, k_{\\mathrm{B}} T / m)$ 和精确的离散时间更新规则 $v_{n+1} = a\\, v_n + \\eta_n$，其中 $a = e^{-\\lambda\\,\\Delta t}$ 且 $\\eta_n \\sim \\mathcal{N}(0, \\sigma_d^2)$ 在 $n$ 上独立同分布，$\\sigma_d^2$ 的选择应确保该过程是严格稳态的。通过为每个测试用例固定一个伪随机数生成器种子来确保数值可复现性。\n\n谱估计流程：\n- 将单条轨迹分割成 $K$ 个长度为 $L$ 个样本的、不重叠的连续段（如果 $N$ 不是 $L$ 的倍数，则丢弃余数）。对每个分段：\n  - 移除该段的均值以强制实现零均值稳态性。\n  - 应用汉宁窗（Hann window，也称 Hanning window）以减轻谱泄漏。使用长度为 $L$ 的标准离散汉宁窗。\n  - 对加窗后的分段计算单边离散傅里叶变换，并使用在加窗下保持方差的适当归一化方法，构建一个以周/秒（赫兹）为单位的功率谱密度的单边修正周期图估计量。然后通过从周/秒到弧度/秒的转换，将其转换为角频率下的 $S_v(\\omega)$ 估计量。您选择的归一化方法必须使 $S_v(\\omega)$ 的单位为 $\\mathrm{m}^2/\\mathrm{s}$。\n- 将各分段的单边周期图进行平均，以在由分段长度和采样间隔决定的离散角频率网格上获得分段平均谱估计 $\\widehat{S}_v(\\omega)$。\n\n置信区间：\n- 对 $K$ 个分段使用“删一”jackknife重采样，以估计在单个目标角频率 $\\omega^\\star$ 处的 $\\widehat{S}_v(\\omega)$ 的标准误。构建 $K$ 个留一法均值，并计算在 $\\omega^\\star$ 处的 jackknife 标准误。使用正态近似和 z-score $z = 1.96$，构建一个置信水平为 $0.95$ 的双边置信区间。\n\n单位与输出：\n- 速度单位必须为 $\\mathrm{m}/\\mathrm{s}$，时间单位为 $\\mathrm{s}$，角频率单位为 $\\mathrm{rad}/\\mathrm{s}$，谱密度 $S_v(\\omega)$ 单位为 $\\mathrm{m}^2/\\mathrm{s}$。置信水平必须表示为小数 $0.95$。\n- 对于每个测试用例，计算并报告在目标角频率 $\\omega^\\star$ 处评估的以下四个值：点估计 $\\widehat{S}_v(\\omega^\\star)$、置信下界、置信上界，以及一个布尔值，该布尔值指示已知的理论 Ornstein–Uhlenbeck 谱密度在 $\\omega^\\star$ 处是否位于 jackknife 区间内。该布尔值必须通过将区间与用于生成轨迹的 Ornstein–Uhlenbeck 过程参数所对应的 $S_v(\\omega)$ 的物理推导表达式进行比较来计算。\n\n测试套件：\n实现并解决以下三个测试用例，每个用例由 $(m, \\gamma, T, \\Delta t, N, L, \\omega^\\star, \\text{seed})$ 定义：\n- 案例 1（一般情况）：$m = 6.63\\times 10^{-26}\\,\\mathrm{kg}$，$\\gamma = 6.63\\times 10^{-14}\\,\\mathrm{kg}/\\mathrm{s}$， $T = 300\\,\\mathrm{K}$， $\\Delta t = 1.0\\times 10^{-15}\\,\\mathrm{s}$， $N = 131072$， $L = 16384$， $\\omega^\\star = \\gamma/m$， seed $= 123$。\n- 案例 2（分段数少的边界条件）：$m = 6.63\\times 10^{-26}\\,\\mathrm{kg}$，$\\gamma = 3.315\\times 10^{-14}\\,\\mathrm{kg}/\\mathrm{s}$， $T = 300\\,\\mathrm{K}$， $\\Delta t = 1.0\\times 10^{-15}\\,\\mathrm{s}$， $N = 32768$， $L = 8192$， $\\omega^\\star = \\gamma/m$， seed $= 456$。\n- 案例 3（高摩擦，短相关）：$m = 6.63\\times 10^{-26}\\,\\mathrm{kg}$，$\\gamma = 3.315\\times 10^{-13}\\,\\mathrm{kg}/\\mathrm{s}$， $T = 300\\,\\mathrm{K}$， $\\Delta t = 5.0\\times 10^{-16}\\,\\mathrm{s}$， $N = 65536$， $L = 8192$， $\\omega^\\star = \\gamma/m$， seed $= 789$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含三个测试用例的结果，结果为用方括号括起来的逗号分隔列表。每个测试用例的结果本身必须是包含四个元素的列表，顺序为 $[\\widehat{S}_v(\\omega^\\star), \\text{lower}, \\text{upper}, \\text{covered}]$。例如，输出必须类似于 $[[x_1,y_1,z_1,\\text{True}],[x_2,y_2,z_2,\\text{False}],[x_3,y_3,z_3,\\text{True}]]$，其中 $x_i$、$y_i$ 和 $z_i$ 的数值以 $\\mathrm{m}^2/\\mathrm{s}$ 为单位表示。", "solution": "该问题要求实现一个计算流程，以估计一个经历朗之万动力学过程的粒子的速度谱密度 $S_v(\\omega)$。解决方案涉及合成一条速度轨迹，应用统计信号处理技术来估计谱，并使用 jackknife 重采样来计算置信区间。该问题是适定的，并且其科学基础根植于统计力学和时间序列分析的原理。\n\n**1. 物理模型与理论谱密度**\n\n一个质量为 $m$ 的粒子在温度为 $T$ 的流体中的运动由朗之万方程描述。在没有外势的情况下，并假设存在一个系数为 $\\gamma$ 的线性摩擦力，速度 $v(t)$ 的演化遵循：\n$$ m \\frac{dv}{dt} = -\\gamma v(t) + F_R(t) $$\n其中 $F_R(t)$ 是一个快速涨落的随机力，被建模为高斯白噪声，其性质为 $\\langle F_R(t) \\rangle = 0$ 和 $\\langle F_R(t) F_R(t') \\rangle = 2 \\gamma k_{\\mathrm{B}} T \\delta(t-t')$。这种表述确保了系统能够达到热平衡，满足涨落耗散定理。这里，$k_{\\mathrm{B}}$ 是玻尔兹曼常数。\n\n这个随机微分方程的解 $v(t)$ 是一个稳态的 Ornstein-Uhlenbeck (OU) 过程。速度是一个高斯随机变量，其均值为零，$\\langle v(t) \\rangle = 0$，方差由能量均分定理给出：\n$$ \\sigma_v^2 = \\langle v(t)^2 \\rangle = \\frac{k_{\\mathrm{B}} T}{m} $$\n这个稳态过程的速度自相关函数（VACF）为：\n$$ C_v(\\tau) = \\langle v(t) v(t+\\tau) \\rangle = \\langle v^2 \\rangle e^{-\\lambda |\\tau|} = \\frac{k_{\\mathrm{B}} T}{m} e^{-\\lambda |\\tau|} $$\n其中 $\\lambda = \\gamma/m$ 是速度的特征弛豫速率。\n\n速度谱密度 $S_v(\\omega)$ 通过 Wiener-Khinchin 定理与 VACF 相关联。它是 $C_v(\\tau)$ 的傅里叶变换。我们关心的是为 $\\omega \\ge 0$ 定义的单边谱密度，其单位为 $(\\text{速度})^2 \\cdot \\text{时间}$，即 $\\mathrm{m}^2/\\mathrm{s}$。它由以下公式给出：\n$$ S_v(\\omega) = 2 \\int_{-\\infty}^{\\infty} C_v(\\tau) e^{-i\\omega\\tau} d\\tau = 2 \\left( \\frac{k_{\\mathrm{B}} T}{m} \\right) \\int_{-\\infty}^{\\infty} e^{-\\lambda |\\tau|} e^{-i\\omega\\tau} d\\tau $$\n计算该积分得到理论上的洛伦兹谱：\n$$ S_v(\\omega) = \\frac{2 k_{\\mathrm{B}} T}{m} \\left( \\frac{2\\lambda}{\\lambda^2 + \\omega^2} \\right) = \\frac{4 k_{\\mathrm{B}} T \\gamma}{m^2(\\lambda^2 + \\omega^2)} = \\frac{4 k_{\\mathrm{B}} T \\gamma}{\\gamma^2 + (m\\omega)^2} $$\n对于目标角频率为 $\\omega^\\star = \\lambda$ 的特定情况，此表达式简化为：\n$$ S_v(\\lambda) = \\frac{2 k_{\\mathrm{B}} T}{m} \\left( \\frac{2\\lambda}{\\lambda^2 + \\lambda^2} \\right) = \\frac{2 k_{\\mathrm{B}} T}{m} \\left( \\frac{2\\lambda}{2\\lambda^2} \\right) = \\frac{2 k_{\\mathrm{B}} T}{m\\lambda} = \\frac{2 k_{\\mathrm{B}} T}{\\gamma} $$\n这个理论值将用于检查我们估计的置信区间是否“覆盖”了真实值。\n\n**2. 轨迹生成：OU 过程的精确离散化**\n\n为了在离散时间点 $t_n = n\\Delta t$ 生成一条合成速度轨迹 $\\{v_n\\}_{n=0}^{N-1}$，我们使用 OU 过程的精确解析解。在时间 $t_{n+1}$ 的速度与在时间 $t_n$ 的速度通过以下方式关联：\n$$ v_{n+1} = v(t_n + \\Delta t) = v_n e^{-\\lambda \\Delta t} + \\int_{t_n}^{t_{n+1}} e^{-\\lambda(t_{n+1}-s)} \\frac{F_R(s)}{m} ds $$\n这可以写成一个离散时间更新规则：\n$$ v_{n+1} = a v_n + \\eta_n $$\n其中 $a = e^{-\\lambda \\Delta t}$。项 $\\eta_n$ 是一个高斯随机变量，与 $v_n$ 无关，均值为零。为了使过程保持稳态，方差必须保持恒定，即 $\\mathrm{Var}(v_{n+1}) = \\mathrm{Var}(v_n) = \\sigma_v^2$。对更新规则取方差：\n$$ \\mathrm{Var}(v_{n+1}) = a^2 \\mathrm{Var}(v_n) + \\mathrm{Var}(\\eta_n) $$\n$$ \\sigma_v^2 = a^2 \\sigma_v^2 + \\sigma_d^2 \\implies \\sigma_d^2 = \\sigma_v^2 (1 - a^2) = \\frac{k_{\\mathrm{B}} T}{m} (1 - e^{-2\\lambda\\Delta t}) $$\n其中 $\\sigma_d^2 = \\mathrm{Var}(\\eta_n)$。通过从 $\\mathcal{N}(0, \\sigma_v^2)$ 中抽取初始速度 $v_0$，并随后为每一步从 $\\mathcal{N}(0, \\sigma_d^2)$ 生成噪声项 $\\eta_n$ 来生成轨迹。为随机数生成器设置固定种子可确保可复现性。\n\n**3. 谱估计流程**\n\n有限时间序列的原始周期图是真实谱密度的一个高方差、有偏估计量。为了改善其统计特性，我们使用 Welch 方法，该方法涉及分段、加窗和平均。\n\n- **分段：**将 $N$ 个点组成的轨迹划分为 $K = \\lfloor N/L \\rfloor$ 个不重叠的段，每段长度为 $L$。对各段进行平均可以将最终估计的方差减少约 $K$ 倍。\n- **去均值：**对于每个分段，减去其局部均值。这一点至关重要，因为任何非零均值都会在零频率处产生巨大的伪影。\n- **加窗：**将每个分段乘以一个汉宁窗，$w_j = 0.5(1 - \\cos(2\\pi j / (L-1)))$，其中 $j=0, \\dots, L-1$。加窗操作使信号在分段边界处逐渐变细，这可以减轻谱泄漏——即由于有限信号的隐式矩形窗效应，功率从一个频率仓扩散到其他频率仓的现象。\n- **周期图计算与归一化：**对于每个加窗分段 $y_j$，我们计算其离散傅里叶变换（DFT），$Y_k = \\sum_{j=0}^{L-1} y_j e^{-i 2\\pi jk/L}$。然后构造单位为 $\\mathrm{m}^2/s$ 的单边功率谱密度（PSD）估计量 $P(f)$。正确的归一化至关重要，必须考虑 DFT 的定义、时间步长 $\\Delta t$ 以及因加窗造成的功率损失。在频率 $f_k = k/(L\\Delta t)$ 处，单边 PSD $P(f_k)$ 的合适估计量为：\n$$ P(f_k) = \\frac{2 \\Delta t}{\\sum_{j=0}^{L-1} w_j^2} |Y_k|^2, \\quad \\text{for } 0  k  L/2 $$\n因子 2 是因为将负频率折叠到了正频率上。直流（$k=0$）和奈奎斯特（如果 $L$ 为偶数，则为 $k=L/2$）频率不加倍。项 $\\sum w_j^2$ 补偿了由窗口引起的能量减少。\n- **单位转换：**问题要求的是单位角频率（rad/s）下的谱密度 $S_v(\\omega)$，而不是单位周期频率（Hz）下的。它们的关系可以从总方差守恒推导得出：$\\int_0^\\infty P(f) df = \\int_0^\\infty S_v(\\omega) d\\omega$。由于 $\\omega=2\\pi f$，这意味着 $S_v(\\omega) = P(f)/(2\\pi)$。因此，单位 rad/s 下的谱密度估计量为：\n$$ \\widehat{S}_{v, \\text{segment}}(\\omega_k) = \\frac{P(f_k)}{2\\pi} = \\frac{\\Delta t}{\\pi \\sum w_j^2} |Y_k|^2, \\quad \\text{for } 0  k  L/2 $$\n- **平均：**最终的谱估计 $\\widehat{S}_v(\\omega)$ 是 $K$ 个独立分段周期图的平均值：\n$$ \\widehat{S}_v(\\omega_k) = \\frac{1}{K} \\sum_{i=1}^{K} \\widehat{S}_{v, \\text{segment } i}(\\omega_k) $$\n\n**4. 通过 Jackknife 重采样估计置信区间**\n\n为了量化我们在目标频率 $\\omega^\\star$ 处的点估计 $\\widehat{S}_v(\\omega^\\star)$ 的不确定性，我们使用“删一”jackknife重采样。这是一种用于估计估计量方差的非参数技术。\n\n首先，我们在我们的网格 $\\omega_k = 2\\pi k/(L\\Delta t)$ 上找到最接近 $\\omega^\\star$ 的离散频率索引 $k^\\star$。设来自 $K$ 个分段的此频率处的周期图估计值集合为 $\\{P_1, P_2, \\dots, P_K\\}$。点估计是它们的均值：$\\hat{\\theta} = \\frac{1}{K} \\sum_{i=1}^K P_i$。\n\njackknife 流程如下：\n1.  对于每个 $i \\in \\{1, \\dots, K\\}$，通过移除第 $i$ 个周期图 $P_i$ 来创建一个“留一”样本。\n2.  计算每个子样本的留一均值：$\\hat{\\theta}_{(i)} = \\frac{1}{K-1} \\sum_{j \\ne i} P_j$。\n3.  $\\hat{\\theta}$ 的方差的 jackknife 估计由以下公式给出：\n$$ \\widehat{\\mathrm{Var}}_{\\mathrm{jack}}(\\hat{\\theta}) = \\frac{K-1}{K} \\sum_{i=1}^K (\\hat{\\theta}_{(i)} - \\bar{\\theta})^2 $$\n其中 $\\bar{\\theta} = \\frac{1}{K} \\sum_{i=1}^K \\hat{\\theta}_{(i)}$ 是留一估计的均值。一个已知的性质是 $\\bar{\\theta}=\\hat{\\theta}$。\n4.  jackknife 标准误是此方差的平方根：$\\mathrm{SE}_{\\mathrm{jack}}(\\hat{\\theta}) = \\sqrt{\\widehat{\\mathrm{Var}}_{\\mathrm{jack}}(\\hat{\\theta})}$。\n5.  使用正态近似构建一个置信水平为 $1-\\alpha$（此处为 $0.95$）的双边置信区间：\n$$ [\\hat{\\theta} - z_{\\alpha/2} \\cdot \\mathrm{SE}_{\\mathrm{jack}}(\\hat{\\theta}), \\quad \\hat{\\theta} + z_{\\alpha/2} \\cdot \\mathrm{SE}_{\\mathrm{jack}}(\\hat{\\theta})] $$\n对于 $95\\%$ 的置信水平，$\\alpha=0.05$ 且 z-score 为 $z_{0.025} = 1.96$。最后，报告置信下界和上界，以及一个指示理论值 $S_v(\\omega^\\star)$ 是否落在此计算区间内的布尔值。", "answer": "```python\nimport numpy as np\nfrom scipy.constants import k as k_B\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation and analysis for all test cases.\n    \"\"\"\n\n    test_cases = [\n        # (m, gamma, T, dt, N, L, omega_star_factor, seed)\n        # Case 1: General case\n        (6.63e-26, 6.63e-14, 300.0, 1.0e-15, 131072, 16384, 1.0, 123),\n        # Case 2: Boundary condition with few segments\n        (6.63e-26, 3.315e-14, 300.0, 1.0e-15, 32768, 8192, 1.0, 456),\n        # Case 3: High-friction, short correlation\n        (6.63e-26, 3.315e-13, 300.0, 5.0e-16, 65536, 8192, 1.0, 789),\n    ]\n\n    results = []\n    for case in test_cases:\n        m, gamma, T, dt, N, L, omega_star_factor, seed = case\n        results.append(analyze_trajectory(m, gamma, T, dt, N, L, omega_star_factor, seed))\n\n    # Format the final output string\n    # The requirement is a string that looks like a Python list of lists\n    formatted_results = \",\".join(map(str, results))\n    print(f\"[{formatted_results}]\")\n\ndef analyze_trajectory(m, gamma, T, dt, N, L, omega_star_factor, seed):\n    \"\"\"\n    Performs the full pipeline for a single test case.\n    1. Generates trajectory.\n    2. Estimates spectral density.\n    3. Calculates confidence intervals.\n    4. Performs coverage check.\n    \"\"\"\n\n    # --- 1. Trajectory Generation ---\n    # Setup Ornstein-Uhlenbeck process parameters\n    rng = np.random.default_rng(seed)\n    lambda_rate = gamma / m\n    var_v = k_B * T / m\n    std_v = np.sqrt(var_v)\n    a = np.exp(-lambda_rate * dt)\n    var_d = var_v * (1 - a**2)\n    std_d = np.sqrt(var_d)\n\n    # Generate the velocity trajectory\n    v = np.empty(N, dtype=np.float64)\n    v[0] = rng.normal(loc=0.0, scale=std_v)\n    noise = rng.normal(loc=0.0, scale=std_d, size=N-1)\n    for n in range(N - 1):\n        v[n+1] = a * v[n] + noise[n]\n\n    # --- 2. Spectral Estimation ---\n    K = N // L  # Number of non-overlapping segments\n\n    # Reshape trajectory into K segments of length L\n    segments = v[:K*L].reshape(K, L)\n\n    # Prepare for spectral analysis\n    hann_win = np.hanning(L)\n    win_norm = np.sum(hann_win**2)\n    \n    # Calculate frequency grid for one-sided real FFT\n    # Frequencies in Hz (cycles/sec)\n    freqs_hz = np.fft.rfftfreq(L, dt)\n    # Frequencies in rad/sec\n    freqs_rad_per_s = 2 * np.pi * freqs_hz\n    \n    num_freqs = len(freqs_rad_per_s)\n    segment_periodograms = np.empty((K, num_freqs), dtype=np.float64)\n\n    for i in range(K):\n        segment = segments[i, :]\n        # Remove segment mean\n        segment = segment - np.mean(segment)\n        # Apply Hann window\n        windowed_segment = segment * hann_win\n        # Compute DFT\n        fft_coeffs = np.fft.rfft(windowed_segment)\n        \n        # Compute one-sided power spectral density (PSD) in (m/s)^2 / Hz\n        psd_hz = (2 * dt / win_norm) * np.abs(fft_coeffs)**2\n        # DC (k=0) and Nyquist (k=L/2) are not doubled\n        psd_hz[0] /= 2\n        if L % 2 == 0:\n            psd_hz[-1] /= 2\n            \n        # Convert PSD from per-Hz to per-rad/s for S_v(omega)\n        # S_v(omega) = P(f) / (2*pi) where f = omega/(2*pi)\n        sv_omega = psd_hz / (2 * np.pi)\n        segment_periodograms[i, :] = sv_omega\n\n    # Average periodograms across segments for the final estimate\n    sv_hat = np.mean(segment_periodograms, axis=0)\n\n    # --- 3. Confidence Interval Calculation ---\n    omega_star = omega_star_factor * lambda_rate\n    \n    # Find the index of the frequency bin closest to omega_star\n    k_star_idx = np.argmin(np.abs(freqs_rad_per_s - omega_star))\n    \n    # Point estimate of the spectral density at omega_star\n    point_estimate = sv_hat[k_star_idx]\n    \n    # Get all segment periodogram values at the target frequency\n    p_k_star_samples = segment_periodograms[:, k_star_idx]\n    \n    # Delete-one jackknife resampling\n    leave_one_out_means = np.empty(K, dtype=np.float64)\n    for i in range(K):\n        # Calculate mean of samples with element i removed\n        leave_one_out_means[i] = np.mean(np.delete(p_k_star_samples, i))\n    \n    # Mean of leave-one-out means (should be equal to the original mean for this estimator)\n    mean_of_loocv_means = np.mean(leave_one_out_means)\n\n    # Jackknife estimate of the variance of the mean\n    jackknife_var = ((K - 1) / K) * np.sum((leave_one_out_means - mean_of_loocv_means)**2)\n    jackknife_se = np.sqrt(jackknife_var)\n\n    # Construct the 95% confidence interval using Normal approximation\n    z_score = 1.96\n    ci_lower = point_estimate - z_score * jackknife_se\n    ci_upper = point_estimate + z_score * jackknife_se\n    \n    # --- 4. Coverage Check ---\n    # Theoretical value of S_v(omega) for OU process at omega_star = lambda\n    sv_theory = (2 * k_B * T) / gamma\n    \n    covered = (ci_lower = sv_theory) and (sv_theory = ci_upper)\n\n    return [point_estimate, ci_lower, ci_upper, bool(covered)]\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3459412"}]}