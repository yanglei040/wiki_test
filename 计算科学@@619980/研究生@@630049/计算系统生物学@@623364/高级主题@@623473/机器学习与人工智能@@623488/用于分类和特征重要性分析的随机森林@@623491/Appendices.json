{"hands_on_practices": [{"introduction": "随机森林的力量源于其构成单元：决策树。而每棵决策树的核心机制在于其节点如何选择最佳分裂点。本练习将带你深入这一核心，通过亲手计算基尼不纯度（Gini impurity）的下降值，来为单个基因表达特征确定最佳的分裂阈值 [@problem_id:3342859]。掌握这一基本计算是理解随机森林如何从数据中学习和做出决策的第一步。", "problem": "一项计算系统生物学的联合研究旨在基于基因 $X$ 的单个归一化信使核糖核酸（mRNA）表达特征，预测一个癌细胞系是药物敏感型还是药物抗性型。作为训练随机森林（RF）分类器的一个子程序，一个二元分裂在该连续特征上使用 Gini 不纯度准则进行评估。对于一个在两个类别（敏感s，抗性r）上具有经验类别分布 $\\mathbf{p} = (p_{\\text{s}}, p_{\\text{r}})$ 的节点，Gini 不纯度定义为 $G(\\mathbf{p}) = 1 - \\sum_{k} p_{k}^{2}$。一次分裂的不纯度减少量定义为父节点的不纯度减去预期的分裂后不纯度，其中期望是根据样本落入每个子节点的经验概率计算的。\n\n给定一个大小为 $N = 120$ 的父节点，其类别计数为（48个敏感型，72个抗性型）。基因 $X$ 表达上的四个候选阈值产生以下左/右子节点的类别计数，其中每个阈值 $t$ 将表达值 $\\leq t$ 的样本分到左子节点，其余的到右子节点：\n\n- 阈值 $t = 3.0$：左 $(6, 18)$，右 $(42, 54)$。\n- 阈值 $t = 5.5$：左 $(18, 30)$，右 $(30, 42)$。\n- 阈值 $t = 7.0$：左 $(30, 40)$，右 $(18, 32)$。\n- 阈值 $t = 8.5$：左 $(40, 55)$，右 $(8, 17)$。\n\n仅从 Gini 不纯度的定义和“预期分裂后不纯度等于由子节点经验样本比例加权的子节点不纯度之和”（即，应用于节点成员关系的全概率定律）这一原理出发，计算每个候选阈值的不纯度减少量 $\\Delta G$，并找出最佳分裂（即最大化 $\\Delta G$ 的分裂）。作为最终答案，请提供最大不纯度减少量 $\\Delta G_{\\max}$ 的精确值，表示为最简有理数形式。不要包含单位，也不要四舍五入。", "solution": "该问题要求根据 Gini 不纯度减少准则，评估决策树中一个数据集节点的四种候选分裂。目标是找出最大化此减少量的分裂，并提供该最大减少量的精确值。\n\n对于一个有 $C$ 个类别，经验类别比例为 $\\mathbf{p} = (p_1, p_2, \\ldots, p_C)$ 的节点，其 Gini 不纯度由以下公式给出：\n$$G(\\mathbf{p}) = 1 - \\sum_{k=1}^{C} p_{k}^{2}$$\n对于二元分裂，不纯度减少量（记为 $\\Delta G$）是父节点不纯度与两个子节点不纯度的加权平均值之间的差：\n$$\\Delta G = G_{\\text{parent}} - \\left( \\frac{N_{\\text{left}}}{N} G_{\\text{left}} + \\frac{N_{\\text{right}}}{N} G_{\\text{right}} \\right)$$\n其中 $N$ 是父节点中的样本总数，而 $N_{\\text{left}}$ 和 $N_{\\text{right}}$ 分别是左、右子节点中的样本数。\n\n首先，我们计算父节点的 Gini 不纯度 $G_{\\text{parent}}$。\n父节点共有 $N=120$ 个样本，其中“敏感”类的计数为 $N_s = 48$，“抗性”类的计数为 $N_r = 72$。\n类别比例为：\n$$p_s = \\frac{N_s}{N} = \\frac{48}{120} = \\frac{2}{5}$$\n$$p_r = \\frac{N_r}{N} = \\frac{72}{120} = \\frac{3}{5}$$\n父节点的 Gini 不纯度为：\n$$G_{\\text{parent}} = 1 - \\left( p_{s}^{2} + p_{r}^{2} \\right) = 1 - \\left( \\left(\\frac{2}{5}\\right)^2 + \\left(\\frac{3}{5}\\right)^2 \\right) = 1 - \\left( \\frac{4}{25} + \\frac{9}{25} \\right) = 1 - \\frac{13}{25} = \\frac{12}{25}$$\n\n接下来，我们评估四个候选分裂中的每一个。\n\n**1. 阈值 $t = 3.0$**\n- 左子节点计数：$(N_{s,L}, N_{r,L}) = (6, 18)$。总大小 $N_L = 6+18=24$。\n- 右子节点计数：$(N_{s,R}, N_{r,R}) = (42, 54)$。总大小 $N_R = 42+54=96$。\n左子节点的比例为 $p_{s,L} = \\frac{6}{24} = \\frac{1}{4}$ 和 $p_{r,L} = \\frac{18}{24} = \\frac{3}{4}$。\n左子节点的 Gini 不纯度为：\n$$G_L = 1 - \\left( \\left(\\frac{1}{4}\\right)^2 + \\left(\\frac{3}{4}\\right)^2 \\right) = 1 - \\left( \\frac{1}{16} + \\frac{9}{16} \\right) = 1 - \\frac{10}{16} = \\frac{6}{16} = \\frac{3}{8}$$\n右子节点的比例为 $p_{s,R} = \\frac{42}{96} = \\frac{7}{16}$ 和 $p_{r,R} = \\frac{54}{96} = \\frac{9}{16}$。\n右子节点的 Gini 不纯度为：\n$$G_R = 1 - \\left( \\left(\\frac{7}{16}\\right)^2 + \\left(\\frac{9}{16}\\right)^2 \\right) = 1 - \\left( \\frac{49}{256} + \\frac{81}{256} \\right) = 1 - \\frac{130}{256} = \\frac{126}{256} = \\frac{63}{128}$$\n此次分裂的不纯度减少量为：\n$$\\Delta G_1 = G_{\\text{parent}} - \\left(\\frac{N_L}{N}G_L + \\frac{N_R}{N}G_R\\right) = \\frac{12}{25} - \\left(\\frac{24}{120}\\left(\\frac{3}{8}\\right) + \\frac{96}{120}\\left(\\frac{63}{128}\\right)\\right)$$\n$$\\Delta G_1 = \\frac{12}{25} - \\left(\\frac{1}{5}\\left(\\frac{3}{8}\\right) + \\frac{4}{5}\\left(\\frac{63}{128}\\right)\\right) = \\frac{12}{25} - \\left(\\frac{3}{40} + \\frac{63}{160}\\right) = \\frac{12}{25} - \\left(\\frac{12}{160} + \\frac{63}{160}\\right) = \\frac{12}{25} - \\frac{75}{160} = \\frac{12}{25} - \\frac{15}{32}$$\n$$\\Delta G_1 = \\frac{12 \\times 32 - 15 \\times 25}{25 \\times 32} = \\frac{384 - 375}{800} = \\frac{9}{800}$$\n\n**2. 阈值 $t = 5.5$**\n- 左子节点计数：$(18, 30)$。$N_L = 48$。比例：$p_{s,L} = \\frac{18}{48} = \\frac{3}{8}, p_{r,L} = \\frac{30}{48} = \\frac{5}{8}$。\n- 右子节点计数：$(30, 42)$。$N_R = 72$。比例：$p_{s,R} = \\frac{30}{72} = \\frac{5}{12}, p_{r,R} = \\frac{42}{72} = \\frac{7}{12}$。\n$$G_L = 1 - \\left(\\left(\\frac{3}{8}\\right)^2 + \\left(\\frac{5}{8}\\right)^2\\right) = 1 - \\left(\\frac{9}{64} + \\frac{25}{64}\\right) = 1 - \\frac{34}{64} = \\frac{30}{64} = \\frac{15}{32}$$\n$$G_R = 1 - \\left(\\left(\\frac{5}{12}\\right)^2 + \\left(\\frac{7}{12}\\right)^2\\right) = 1 - \\left(\\frac{25}{144} + \\frac{49}{144}\\right) = 1 - \\frac{74}{144} = \\frac{70}{144} = \\frac{35}{72}$$\n不纯度减少量为：\n$$\\Delta G_2 = \\frac{12}{25} - \\left(\\frac{48}{120}\\left(\\frac{15}{32}\\right) + \\frac{72}{120}\\left(\\frac{35}{72}\\right)\\right) = \\frac{12}{25} - \\left(\\frac{2}{5}\\left(\\frac{15}{32}\\right) + \\frac{3}{5}\\left(\\frac{35}{72}\\right)\\right)$$\n$$\\Delta G_2 = \\frac{12}{25} - \\left(\\frac{3}{16} + \\frac{7}{24}\\right) = \\frac{12}{25} - \\left(\\frac{9}{48} + \\frac{14}{48}\\right) = \\frac{12}{25} - \\frac{23}{48}$$\n$$\\Delta G_2 = \\frac{12 \\times 48 - 23 \\times 25}{25 \\times 48} = \\frac{576 - 575}{1200} = \\frac{1}{1200}$$\n\n**3. 阈值 $t = 7.0$**\n- 左子节点计数：$(30, 40)$。$N_L = 70$。比例：$p_{s,L} = \\frac{30}{70} = \\frac{3}{7}, p_{r,L} = \\frac{40}{70} = \\frac{4}{7}$。\n- 右子节点计数：$(18, 32)$。$N_R = 50$。比例：$p_{s,R} = \\frac{18}{50} = \\frac{9}{25}, p_{r,R} = \\frac{32}{50} = \\frac{16}{25}$。\n$$G_L = 1 - \\left(\\left(\\frac{3}{7}\\right)^2 + \\left(\\frac{4}{7}\\right)^2\\right) = 1 - \\left(\\frac{9}{49} + \\frac{16}{49}\\right) = 1 - \\frac{25}{49} = \\frac{24}{49}$$\n$$G_R = 1 - \\left(\\left(\\frac{9}{25}\\right)^2 + \\left(\\frac{16}{25}\\right)^2\\right) = 1 - \\left(\\frac{81}{625} + \\frac{256}{625}\\right) = 1 - \\frac{337}{625} = \\frac{288}{625}$$\n不纯度减少量为：\n$$\\Delta G_3 = \\frac{12}{25} - \\left(\\frac{70}{120}\\left(\\frac{24}{49}\\right) + \\frac{50}{120}\\left(\\frac{288}{625}\\right)\\right) = \\frac{12}{25} - \\left(\\frac{7}{12}\\left(\\frac{24}{49}\\right) + \\frac{5}{12}\\left(\\frac{288}{625}\\right)\\right)$$\n$$\\Delta G_3 = \\frac{12}{25} - \\left(\\frac{2}{7} + \\frac{24}{125}\\right) = \\frac{12}{25} - \\left(\\frac{250}{875} + \\frac{168}{875}\\right) = \\frac{12}{25} - \\frac{418}{875}$$\n$$\\Delta G_3 = \\frac{12 \\times 35 - 418}{875} = \\frac{420 - 418}{875} = \\frac{2}{875}$$\n\n**4. 阈值 $t = 8.5$**\n- 左子节点计数：$(40, 55)$。$N_L = 95$。比例：$p_{s,L} = \\frac{40}{95} = \\frac{8}{19}, p_{r,L} = \\frac{55}{95} = \\frac{11}{19}$。\n- 右子节点计数：$(8, 17)$。$N_R = 25$。比例：$p_{s,R} = \\frac{8}{25}, p_{r,R} = \\frac{17}{25}$。\n$$G_L = 1 - \\left(\\left(\\frac{8}{19}\\right)^2 + \\left(\\frac{11}{19}\\right)^2\\right) = 1 - \\left(\\frac{64}{361} + \\frac{121}{361}\\right) = 1 - \\frac{185}{361} = \\frac{176}{361}$$\n$$G_R = 1 - \\left(\\left(\\frac{8}{25}\\right)^2 + \\left(\\frac{17}{25}\\right)^2\\right) = 1 - \\left(\\frac{64}{625} + \\frac{289}{625}\\right) = 1 - \\frac{353}{625} = \\frac{272}{625}$$\n不纯度减少量为：\n$$\\Delta G_4 = \\frac{12}{25} - \\left(\\frac{95}{120}\\left(\\frac{176}{361}\\right) + \\frac{25}{120}\\left(\\frac{272}{625}\\right)\\right) = \\frac{12}{25} - \\left(\\frac{19}{24}\\frac{176}{19^2} + \\frac{5}{24}\\frac{272}{5^4}\\right)$$\n$$\\Delta G_4 = \\frac{12}{25} - \\left(\\frac{1}{24}\\frac{176}{19} + \\frac{1}{24}\\frac{272}{125}\\right) = \\frac{12}{25} - \\frac{1}{24}\\left(\\frac{176 \\times 125 + 272 \\times 19}{19 \\times 125}\\right)$$\n$$\\Delta G_4 = \\frac{12}{25} - \\frac{1}{24}\\left(\\frac{22000 + 5168}{2375}\\right) = \\frac{12}{25} - \\frac{27168}{24 \\times 2375} = \\frac{12}{25} - \\frac{1132}{2375}$$\n$$\\Delta G_4 = \\frac{12 \\times 95 - 1132}{2375} = \\frac{1140 - 1132}{2375} = \\frac{8}{2375}$$\n\n最后，我们比较四个不纯度减少值以找到最大值。\n$\\Delta G_1 = \\frac{9}{800}$，$\\Delta G_2 = \\frac{1}{1200}$，$\\Delta G_3 = \\frac{2}{875}$，$\\Delta G_4 = \\frac{8}{2375}$。\n转换为小数以便比较：\n$\\Delta G_1 = 0.01125$\n$\\Delta G_2 \\approx 0.000833$\n$\\Delta G_3 \\approx 0.002286$\n$\\Delta G_4 \\approx 0.003368$\n最大值为 $\\Delta G_1$。\n因此，最佳分裂的阈值为 $t = 3.0$，最大不纯度减少量为 $\\Delta G_{\\max} = \\frac{9}{800}$。此分数为最简形式。", "answer": "$$\\boxed{\\frac{9}{800}}$$", "id": "3342859"}, {"introduction": "在了解了如何进行单次分裂后，下一步是评估一个特征在整棵树中的总体重要性。平均不纯度减少（Mean Decrease in Impurity, MDI）是一种常用的衡量标准，它通过累加一个特征在树中所有分裂节点上带来的不纯度减少量来量化其贡献。本练习将指导你对一个给定的决策树计算MDI值，从而将分裂的局部效益汇总为对特征重要性的全局评估 [@problem_id:3342894]。", "problem": "一个计算系统生物学实验室正在使用随机森林分类器，根据分子测量结果将单细胞分层为两种表型类别：类别标签 $Y \\in \\{0,1\\}$，其中 $Y=1$ 表示通路激活状态，$Y=0$ 表示非激活状态。每个细胞测量两个特征：$x_{1}$ 是一个转录因子的对数转换表达量，$x_{2}$ 是一个通路基因的启动子甲基化分数。考虑森林中的一棵决策树，它在一个包含 $N_{\\text{total}} = 100$ 个细胞的平衡数据集上训练得到，所有细胞的样本权重相等。\n\n该树具有以下结构。根节点（记为 $t_{0}$）在特征 $x_{1}$ 的阈值 $\\tau_{1}$ 处分裂，将 $N_{L}(t_{0}) = 50$ 个细胞分到左侧，将 $N_{R}(t_{0}) = 50$ 个细胞分到右侧。$t_{0}$ 及其子节点的类别计数如下：\n- 在 $t_{0}$：类别 $(Y=1,Y=0)$ 的计数为 $(55,45)$。\n- 左子节点 $t_{1}$：类别 $(Y=1,Y=0)$ 的计数为 $(40,10)$；节点 $t_{1}$ 进一步在特征 $x_{2}$ 的阈值 $\\tau_{2}$ 处分裂。\n- 右子节点 $t_{2}$：类别 $(Y=1,Y=0)$ 的计数为 $(15,35)$；节点 $t_{2}$ 进一步在特征 $x_{1}$ 的阈值 $\\tau'_{1}$ 处分裂。\n\n这些后续分裂产生的终端叶节点的类别计数和样本大小如下：\n- 从 $t_{1}$ （在 $x_{2}$ 上分裂）得到：$t_{3}$ 的样本数为 $N(t_{3}) = 30$，计数为 $(30,0)$；$t_{4}$ 的样本数为 $N(t_{4}) = 20$，计数为 $(10,10)$。\n- 从 $t_{2}$ （在 $x_{1}$ 上分裂）得到：$t_{5}$ 的样本数为 $N(t_{5}) = 20$，计数为 $(10,10)$；$t_{6}$ 的样本数为 $N(t_{6}) = 30$，计数为 $(5,25)$。\n\n假设节点的不纯度由基尼不纯度量化，对于一个具有类别概率 $\\{p_{k}(t)\\}_{k \\in \\{0,1\\}}$ 的节点 $t$，其定义为 $G(t) = 1 - \\sum_{k \\in \\{0,1\\}} p_{k}(t)^{2}$。特征 $x_{j}$ 的平均不纯度减少（MDI）特征重要性，是对所有使用 $x_{j}$ 进行分裂的节点，由这些分裂引起的不纯度减少量进行聚合，并按到达每个分裂节点的总训练样本的比例进行加权。终端叶节点不计入贡献。\n\n仅使用这些定义和所提供的计数，计算这棵决策树的平均不纯度减少 $VI^{\\text{MDI}}(x_{1})$ 和 $VI^{\\text{MDI}}(x_{2})$，不对特征进行任何事后归一化。将你的最终答案表示为一个二元行矩阵 $\\big[VI^{\\text{MDI}}(x_{1}) \\;\\; VI^{\\text{MDI}}(x_{2})\\big]$，使用精确值，不要四舍五入。", "solution": "特征 $x_{j}$ 的平均不纯度减少 (MDI) 是通过对所有在特征 $x_{j}$ 上发生分裂的节点 $t$ 的不纯度减少量求和来计算的。每次减少都按到达节点 $t$ 的样本比例进行加权。公式为：\n$$VI^{\\text{MDI}}(x_{j}) = \\sum_{t \\text{ splits on } x_{j}} \\frac{N(t)}{N_{\\text{total}}} \\Delta G(t)$$\n其中 $\\Delta G(t)$ 是节点 $t$ 的不纯度减少量，由下式给出：\n$$\\Delta G(t) = G(t) - \\frac{N_{L}(t)}{N(t)}G(t_{L}) - \\frac{N_{R}(t)}{N(t)}G(t_{R})$$\n这里 $t_L$ 和 $t_R$ 分别是 $t$ 的左、右子节点，$G(t)$ 是基尼不纯度。对于一个类别 $Y=1$ 和 $Y=0$ 的计数分别为 $(n_1, n_0)$ 的节点 $t$，其基尼不纯度为：\n$$G(t) = 1 - \\left( \\left(\\frac{n_1}{n_1+n_0}\\right)^2 + \\left(\\frac{n_0}{n_1+n_0}\\right)^2 \\right)$$\n\n首先，我们计算树中所有节点的基尼不纯度。\n- $t_{0}$：计数 $(55, 45)$，$N(t_{0})=100$。\n$G(t_{0}) = 1 - \\left( \\left(\\frac{55}{100}\\right)^2 + \\left(\\frac{45}{100}\\right)^2 \\right) = 1 - \\left( \\left(\\frac{11}{20}\\right)^2 + \\left(\\frac{9}{20}\\right)^2 \\right) = 1 - \\frac{121+81}{400} = 1 - \\frac{202}{400} = \\frac{198}{400} = \\frac{99}{200}$。\n\n- $t_{1}$：计数 $(40, 10)$，$N(t_{1})=50$。\n$G(t_{1}) = 1 - \\left( \\left(\\frac{40}{50}\\right)^2 + \\left(\\frac{10}{50}\\right)^2 \\right) = 1 - \\left( \\left(\\frac{4}{5}\\right)^2 + \\left(\\frac{1}{5}\\right)^2 \\right) = 1 - \\frac{16+1}{25} = 1 - \\frac{17}{25} = \\frac{8}{25}$。\n\n- $t_{2}$：计数 $(15, 35)$，$N(t_{2})=50$。\n$G(t_{2}) = 1 - \\left( \\left(\\frac{15}{50}\\right)^2 + \\left(\\frac{35}{50}\\right)^2 \\right) = 1 - \\left( \\left(\\frac{3}{10}\\right)^2 + \\left(\\frac{7}{10}\\right)^2 \\right) = 1 - \\frac{9+49}{100} = 1 - \\frac{58}{100} = \\frac{42}{100} = \\frac{21}{50}$。\n\n- $t_{3}$ (叶节点)：计数 $(30, 0)$，$N(t_{3})=30$。\n$G(t_{3}) = 1 - \\left( \\left(\\frac{30}{30}\\right)^2 + \\left(\\frac{0}{30}\\right)^2 \\right) = 1 - 1 = 0$。\n\n- $t_{4}$ (叶节点)：计数 $(10, 10)$，$N(t_{4})=20$。\n$G(t_{4}) = 1 - \\left( \\left(\\frac{10}{20}\\right)^2 + \\left(\\frac{10}{20}\\right)^2 \\right) = 1 - \\left( \\left(\\frac{1}{2}\\right)^2 + \\left(\\frac{1}{2}\\right)^2 \\right) = 1 - \\frac{1}{4} - \\frac{1}{4} = \\frac{1}{2}$。\n\n- $t_{5}$ (叶节点)：计数 $(10, 10)$，$N(t_{5})=20$。\n$G(t_{5}) = G(t_{4}) = \\frac{1}{2}$。\n\n- $t_{6}$ (叶节点)：计数 $(5, 25)$，$N(t_{6})=30$。\n$G(t_{6}) = 1 - \\left( \\left(\\frac{5}{30}\\right)^2 + \\left(\\frac{25}{30}\\right)^2 \\right) = 1 - \\left( \\left(\\frac{1}{6}\\right)^2 + \\left(\\frac{5}{6}\\right)^2 \\right) = 1 - \\frac{1+25}{36} = 1 - \\frac{26}{36} = \\frac{10}{36} = \\frac{5}{18}$。\n\n接下来，我们计算每次分裂的MDI贡献。\n分裂节点是 $t_0$（在 $x_1$ 上）、$t_1$（在 $x_2$ 上）和 $t_2$（在 $x_1$ 上）。\n\n来自 $t_{0}$ 处分裂的贡献（特征 $x_{1}$）：\n权重是 $\\frac{N(t_{0})}{N_{\\text{total}}} = \\frac{100}{100} = 1$。不纯度减少量为：\n$\\Delta G(t_{0}) = G(t_{0}) - \\frac{N(t_{1})}{N(t_{0})}G(t_{1}) - \\frac{N(t_{2})}{N(t_{0})}G(t_{2}) = \\frac{99}{200} - \\frac{50}{100}\\left(\\frac{8}{25}\\right) - \\frac{50}{100}\\left(\\frac{21}{50}\\right)$\n$\\Delta G(t_{0}) = \\frac{99}{200} - \\frac{1}{2}\\left(\\frac{8}{25}\\right) - \\frac{1}{2}\\left(\\frac{21}{50}\\right) = \\frac{99}{200} - \\frac{4}{25} - \\frac{21}{100} = \\frac{99}{200} - \\frac{32}{200} - \\frac{42}{200} = \\frac{99-74}{200} = \\frac{25}{200} = \\frac{1}{8}$。\n来自此分裂对 $VI^{\\text{MDI}}(x_{1})$ 的贡献是 $1 \\times \\frac{1}{8} = \\frac{1}{8}$。\n\n来自 $t_{1}$ 处分裂的贡献（特征 $x_{2}$）：\n权重是 $\\frac{N(t_{1})}{N_{\\text{total}}} = \\frac{50}{100} = \\frac{1}{2}$。不纯度减少量为：\n$\\Delta G(t_{1}) = G(t_{1}) - \\frac{N(t_{3})}{N(t_{1})}G(t_{3}) - \\frac{N(t_{4})}{N(t_{1})}G(t_{4}) = \\frac{8}{25} - \\frac{30}{50}(0) - \\frac{20}{50}\\left(\\frac{1}{2}\\right)$\n$\\Delta G(t_{1}) = \\frac{8}{25} - \\frac{2}{5}\\left(\\frac{1}{2}\\right) = \\frac{8}{25} - \\frac{1}{5} = \\frac{8-5}{25} = \\frac{3}{25}$。\n来自此分裂对 $VI^{\\text{MDI}}(x_{2})$ 的贡献是 $\\frac{1}{2} \\times \\frac{3}{25} = \\frac{3}{50}$。\n\n来自 $t_{2}$ 处分裂的贡献（特征 $x_{1}$）：\n权重是 $\\frac{N(t_{2})}{N_{\\text{total}}} = \\frac{50}{100} = \\frac{1}{2}$。不纯度减少量为：\n$\\Delta G(t_{2}) = G(t_{2}) - \\frac{N(t_{5})}{N(t_{2})}G(t_{5}) - \\frac{N(t_{6})}{N(t_{2})}G(t_{6}) = \\frac{21}{50} - \\frac{20}{50}\\left(\\frac{1}{2}\\right) - \\frac{30}{50}\\left(\\frac{5}{18}\\right)$\n$\\Delta G(t_{2}) = \\frac{21}{50} - \\frac{1}{5} - \\frac{3}{5}\\left(\\frac{5}{18}\\right) = \\frac{21}{50} - \\frac{1}{5} - \\frac{1}{6} = \\frac{63}{150} - \\frac{30}{150} - \\frac{25}{150} = \\frac{63-55}{150} = \\frac{8}{150} = \\frac{4}{75}$。\n来自此分裂对 $VI^{\\text{MDI}}(x_{1})$ 的贡献是 $\\frac{1}{2} \\times \\frac{4}{75} = \\frac{2}{75}$。\n\n最后，我们对每个特征的贡献求和。\n对于特征 $x_{1}$，分裂发生在 $t_{0}$ 和 $t_{2}$。\n$VI^{\\text{MDI}}(x_{1}) = (\\text{来自 } t_{0} \\text{ 的贡献}) + (\\text{来自 } t_{2} \\text{ 的贡献}) = \\frac{1}{8} + \\frac{2}{75}$。\n$8$ 和 $75$ 的最小公倍数是 $8 \\times 75 = 600$。\n$VI^{\\text{MDI}}(x_{1}) = \\frac{1 \\times 75}{600} + \\frac{2 \\times 8}{600} = \\frac{75+16}{600} = \\frac{91}{600}$。\n\n对于特征 $x_{2}$，唯一的分裂发生在 $t_{1}$。\n$VI^{\\text{MDI}}(x_{2}) = (\\text{来自 } t_{1} \\text{ 的贡献}) = \\frac{3}{50}$。\n\n最终答案是行矩阵 $[VI^{\\text{MDI}}(x_{1}) \\;\\; VI^{\\text{MDI}}(x_{2})]$。\n$VI^{\\text{MDI}}(x_{1}) = \\frac{91}{600}$\n$VI^{\\text{MDI}}(x_{2}) = \\frac{3}{50} = \\frac{3 \\times 12}{50 \\times 12} = \\frac{36}{600}$。\n所要求的矩阵是 $\\big[ \\frac{91}{600} \\;\\; \\frac{3}{50} \\big]$。", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{91}{600} & \\frac{3}{50} \\end{pmatrix}}$$", "id": "3342894"}, {"introduction": "虽然MDI是一种直观的特征重要性度量，但它可能存在偏差。置换重要性（Permutation Importance）提供了一种更稳健、模型无关的替代方法，它通过评估模型性能在特征信息被破坏后的下降程度来衡量特征的重要性。本练习将利用袋外（Out-of-Bag, OOB）样本，通过对单个基因的表达值进行置换，来亲手计算其置换重要性及其在不同树间的方差，让你对这一强大技术及其内在不确定性有更深刻的理解 [@problem_id:3342911]。", "problem": "考虑一个简化的计算系统生物学分类任务，其中训练一个随机森林 (RF) 分类器，以从基因表达特征 $(G_1,G_2,G_3)$ 中区分表型 $y \\in \\{0,1\\}$。该随机森林包含 $T=3$ 棵决策树，这些决策树是从一个包含 $N=6$ 个样本的数据集中通过自助重采样 (bootstrap resampling) 训练得到的。数据集如下：\n$i=1: (x_{11},x_{12},x_{13};y_1)=(1.0,5.5,6.0;1)$,\n$i=2: (x_{21},x_{22},x_{23};y_2)=(2.5,3.0,7.5;1)$,\n$i=3: (x_{31},x_{32},x_{33};y_3)=(3.5,6.5,5.5;1)$,\n$i=4: (x_{41},x_{42},x_{43};y_4)=(1.5,2.5,4.0;0)$,\n$i=5: (x_{51},x_{52},x_{53};y_5)=(4.0,4.5,6.5;0)$,\n$i=6: (x_{61},x_{62},x_{63};y_6)=(2.0,5.0,3.5;0)$,\n其中 $x_{i1}$、$x_{i2}$ 和 $x_{i3}$ 分别表示 $G_1$、$G_2$ 和 $G_3$ 的测量表达量。\n\n这三棵树是基于以下自助样本（训练样本的索引列表，有放回）进行训练的：对于树 $t=1$，$B_1 = [1,2,5,5,6,6]$；对于树 $t=2$，$B_2 = [1,3,3,4,6,6]$；对于树 $t=3$，$B_3 = [2,2,3,5,5,6]$。树 $t$ 的袋外 (Out-of-Bag, OOB) 样本集是补集 $O_t=\\{1,\\dots,N\\}\\setminus B_t$（忽略重复项）：因此 $O_1=\\{3,4\\}$，$O_2=\\{2,5\\}$，$O_3=\\{1,4\\}$。\n\n每棵训练好的树根据以下规则确定性地预测一个类别 $\\hat{y}_t(x)$：\n- 树 $t=1$：如果 $x_{2} \\ge 5.0$，则预测 $\\hat{y}_1(x)=1$，否则预测 $\\hat{y}_1(x)=0$。\n- 树 $t=2$：如果 $x_{3} \\ge 6.0$，则预测 $\\hat{y}_2(x)=1$；否则，如果 $x_{2} \\ge 4.0$，则预测 $\\hat{y}_2(x)=1$；否则预测 $\\hat{y}_2(x)=0$。\n- 树 $t=3$：如果 $x_{1} \\le 2.0$，则预测 $\\hat{y}_3(x)=0$；否则，如果 $x_{2} \\ge 6.0$，则预测 $\\hat{y}_3(x)=1$；否则预测 $\\hat{y}_3(x)=0$。\n\n将树 $t$ 的 OOB 错分率定义为 $L_t^{\\mathrm{OOB}}=\\frac{1}{|O_t|}\\sum_{i\\in O_t}\\mathbf{1}\\{\\hat{y}_t(x_i)\\ne y_i\\}$，其中 $\\mathbf{1}\\{\\cdot\\}$ 是指示函数。为评估基因 $G_2$（表示为 $j=2$）的置换重要性，根据以下映射，在每棵树的 OOB 集内对 $x_{i2}$ 值执行单次 OOB 置换：\n- 对于 $t=1$ 在 $O_1=\\{3,4\\}$ 上，交换 $x_{32}$ 和 $x_{42}$，使得置换后的值为 $x_{32}^{\\pi}=2.5$ 和 $x_{42}^{\\pi}=6.5$。\n- 对于 $t=2$ 在 $O_2=\\{2,5\\}$ 上，交换 $x_{22}$ 和 $x_{52}$，使得 $x_{22}^{\\pi}=4.5$ 和 $x_{52}^{\\pi}=3.0$。\n- 对于 $t=3$ 在 $O_3=\\{1,4\\}$ 上，交换 $x_{12}$ 和 $x_{42}$，使得 $x_{12}^{\\pi}=2.5$ 和 $x_{42}^{\\pi}=5.5$。\n\n使用这些置换后的值（并保持所有其他特征 $x_{i1}$ 和 $x_{i3}$ 不变），计算置换后的 OOB 错分率 $L_t^{\\mathrm{perm}}=\\frac{1}{|O_t|}\\sum_{i\\in O_t}\\mathbf{1}\\{\\hat{y}_t(x_i^{\\pi})\\ne y_i\\}$，其中对于 $i\\in O_t$，$x_i^{\\pi}$ 是将 $x_{i2}$ 替换为 $x_{i2}^{\\pi}$ 后的样本。对于每棵树，定义单次置换重要性增量 $\\Delta_t=L_t^{\\mathrm{perm}}-L_t^{\\mathrm{OOB}}$。\n\n最后，计算：\n- 聚合重要性 $\\bar{\\Delta}=\\frac{1}{T}\\sum_{t=1}^{T}\\Delta_t$；以及\n- 跨树无偏样本方差 $s^2=\\frac{1}{T-1}\\sum_{t=1}^{T}\\left(\\Delta_t-\\bar{\\Delta}\\right)^2$。\n\n以包含两个条目的行矩阵 $\\left(\\bar{\\Delta}, s^2\\right)$ 的形式报告您的最终答案，在适当情况下使用有理数表示。无需四舍五入。在您的解答中，从业内单次 OOB 置换引起的重要性估计不确定性的角度，简要解释 $s^2$ 相对于 $\\bar{\\Delta}$ 的大小。", "solution": "任务是计算基因 $G_2$ 的聚合置换重要性 $\\bar{\\Delta}$ 及其样本方差 $s^2$。这需要对森林中的 $T=3$ 棵树中的每一棵进行逐步计算。\n\n数据集包含 $N=6$ 个样本：\n$x_1=(1.0, 5.5, 6.0; y_1=1)$\n$x_2=(2.5, 3.0, 7.5; y_2=1)$\n$x_3=(3.5, 6.5, 5.5; y_3=1)$\n$x_4=(1.5, 2.5, 4.0; y_4=0)$\n$x_5=(4.0, 4.5, 6.5; y_5=0)$\n$x_6=(2.0, 5.0, 3.5; y_6=0)$\n\n对于每棵树 $t$，我们首先计算袋外 (OOB) 错分率 $L_t^{\\mathrm{OOB}}$，然后计算对 OOB 样本的特征 $G_2$ 进行置换后的错分率 $L_t^{\\mathrm{perm}}$，最后计算重要性增量 $\\Delta_t = L_t^{\\mathrm{perm}} - L_t^{\\mathrm{OOB}}$。\n\n**树 $t=1$**\n决策规则为：如果 $x_2 \\ge 5.0$，则 $\\hat{y}_1(x)=1$，否则 $\\hat{y}_1(x)=0$。\nOOB 样本集为 $O_1=\\{3,4\\}$，因此 $|O_1|=2$。对应的样本是 $x_3=(3.5, 6.5, 5.5; y_3=1)$ 和 $x_4=(1.5, 2.5, 4.0; y_4=0)$。\n\n1.  **计算 $L_1^{\\mathrm{OOB}}$**：\n    - 对于样本 $i=3$：$x_{32} = 6.5 \\ge 5.0$，所以 $\\hat{y}_1(x_3)=1$。真实标签是 $y_3=1$。预测正确。错分指示符 $\\mathbf{1}\\{\\hat{y}_1(x_3) \\ne y_3\\} = 0$。\n    - 对于样本 $i=4$：$x_{42} = 2.5   5.0$，所以 $\\hat{y}_1(x_4)=0$。真实标签是 $y_4=0$。预测正确。错分指示符 $\\mathbf{1}\\{\\hat{y}_1(x_4) \\ne y_4\\} = 0$。\n    - $L_1^{\\mathrm{OOB}} = \\frac{1}{|O_1|} \\sum_{i \\in O_1} \\mathbf{1}\\{\\hat{y}_1(x_i) \\ne y_i\\} = \\frac{1}{2}(0+0) = 0$。\n\n2.  **计算 $L_1^{\\mathrm{perm}}$**：\n    对 $O_1$ 中样本的特征 $G_2$ ($x_{i2}$) 的值进行置换。给定 $x_{32}^{\\pi}=2.5$ 和 $x_{42}^{\\pi}=6.5$。\n    置换后的 OOB 样本是 $x_3^{\\pi}=(3.5, 2.5, 5.5)$ (真实标签 $y_3=1$) 和 $x_4^{\\pi}=(1.5, 6.5, 4.0)$ (真实标签 $y_4=0$)。\n    - 对于样本 $i=3$：置换后的特征值为 $x_{32}^{\\pi}=2.5  5.0$，所以 $\\hat{y}_1(x_3^{\\pi})=0$。真实标签是 $y_3=1$。预测错误。$\\mathbf{1}\\{\\hat{y}_1(x_3^{\\pi}) \\ne y_3\\} = 1$。\n    - 对于样本 $i=4$：置换后的特征值为 $x_{42}^{\\pi}=6.5 \\ge 5.0$，所以 $\\hat{y}_1(x_4^{\\pi})=1$。真实标签是 $y_4=0$。预测错误。$\\mathbf{1}\\{\\hat{y}_1(x_4^{\\pi}) \\ne y_4\\} = 1$。\n    - $L_1^{\\mathrm{perm}} = \\frac{1}{|O_1|} \\sum_{i \\in O_1} \\mathbf{1}\\{\\hat{y}_1(x_i^{\\pi}) \\ne y_i\\} = \\frac{1}{2}(1+1) = 1$。\n\n3.  **计算 $\\Delta_1$**：\n    $\\Delta_1 = L_1^{\\mathrm{perm}} - L_1^{\\mathrm{OOB}} = 1 - 0 = 1$。\n\n**树 $t=2$**\n决策规则为：如果 $x_3 \\ge 6.0$，则预测 $\\hat{y}_2(x)=1$；否则，如果 $x_2 \\ge 4.0$，则预测 $\\hat{y}_2(x)=1$；否则预测 $\\hat{y}_2(x)=0$。\nOOB 样本集为 $O_2=\\{2,5\\}$，因此 $|O_2|=2$。样本是 $x_2=(2.5, 3.0, 7.5; y_2=1)$ 和 $x_5=(4.0, 4.5, 6.5; y_5=0)$。\n\n1.  **计算 $L_2^{\\mathrm{OOB}}$**：\n    - 对于样本 $i=2$：$x_{23} = 7.5 \\ge 6.0$，所以 $\\hat{y}_2(x_2)=1$。真实标签是 $y_2=1$。正确。$\\mathbf{1}\\{\\hat{y}_2(x_2) \\ne y_2\\} = 0$。\n    - 对于样本 $i=5$：$x_{53} = 6.5 \\ge 6.0$，所以 $\\hat{y}_2(x_5)=1$。真实标签是 $y_5=0$。错误。$\\mathbf{1}\\{\\hat{y}_2(x_5) \\ne y_5\\} = 1$。\n    - $L_2^{\\mathrm{OOB}} = \\frac{1}{2}(0+1) = \\frac{1}{2}$。\n\n2.  **计算 $L_2^{\\mathrm{perm}}$**：\n    置换给出 $x_{22}^{\\pi}=4.5$ 和 $x_{52}^{\\pi}=3.0$。置换后的样本是 $x_2^{\\pi}=(2.5, 4.5, 7.5)$ (真实标签 $y_2=1$) 和 $x_5^{\\pi}=(4.0, 3.0, 6.5)$ (真实标签 $y_5=0$)。\n    - 对于样本 $i=2$：$x_{23} = 7.5 \\ge 6.0$，所以第一个规则触发。$\\hat{y}_2(x_2^{\\pi})=1$。真实标签 $y_2=1$。正确。$\\mathbf{1}\\{\\hat{y}_2(x_2^{\\pi}) \\ne y_2\\} = 0$。\n    - 对于样本 $i=5$：$x_{53} = 6.5 \\ge 6.0$，所以第一个规则触发。$\\hat{y}_2(x_5^{\\pi})=1$。真实标签 $y_5=0$。错误。$\\mathbf{1}\\{\\hat{y}_2(x_5^{\\pi}) \\ne y_5\\} = 1$。\n    - $L_2^{\\mathrm{perm}} = \\frac{1}{2}(0+1) = \\frac{1}{2}$。\n\n3.  **计算 $\\Delta_2$**：\n    $\\Delta_2 = L_2^{\\mathrm{perm}} - L_2^{\\mathrm{OOB}} = \\frac{1}{2} - \\frac{1}{2} = 0$。\n\n**树 $t=3$**\n决策规则为：如果 $x_1 \\le 2.0$，则预测 $\\hat{y}_3(x)=0$；否则，如果 $x_2 \\ge 6.0$，则预测 $\\hat{y}_3(x)=1$；否则预测 $\\hat{y}_3(x)=0$。\nOOB 样本集为 $O_3=\\{1,4\\}$，因此 $|O_3|=2$。样本是 $x_1=(1.0, 5.5, 6.0; y_1=1)$ 和 $x_4=(1.5, 2.5, 4.0; y_4=0)$。\n\n1.  **计算 $L_3^{\\mathrm{OOB}}$**：\n    - 对于样本 $i=1$：$x_{11} = 1.0 \\le 2.0$，所以 $\\hat{y}_3(x_1)=0$。真实标签 $y_1=1$。错误。$\\mathbf{1}\\{\\hat{y}_3(x_1) \\ne y_1\\} = 1$。\n    - 对于样本 $i=4$：$x_{41} = 1.5 \\le 2.0$，所以 $\\hat{y}_3(x_4)=0$。真实标签 $y_4=0$。正确。$\\mathbf{1}\\{\\hat{y}_3(x_4) \\ne y_4\\} = 0$。\n    - $L_3^{\\mathrm{OOB}} = \\frac{1}{2}(1+0) = \\frac{1}{2}$。\n\n2.  **计算 $L_3^{\\mathrm{perm}}$**：\n    置换给出 $x_{12}^{\\pi}=2.5$ 和 $x_{42}^{\\pi}=5.5$。置换后的样本是 $x_1^{\\pi}=(1.0, 2.5, 6.0)$ (真实标签 $y_1=1$) 和 $x_4^{\\pi}=(1.5, 5.5, 4.0)$ (真实标签 $y_4=0$)。\n    - 对于样本 $i=1$：$x_{11} = 1.0 \\le 2.0$，所以第一个规则触发。$\\hat{y}_3(x_1^{\\pi})=0$。真实标签 $y_1=1$。错误。$\\mathbf{1}\\{\\hat{y}_3(x_1^{\\pi}) \\ne y_1\\} = 1$。\n    - 对于样本 $i=4$：$x_{41} = 1.5 \\le 2.0$，所以第一个规则触发。$\\hat{y}_3(x_4^{\\pi})=0$。真实标签 $y_4=0$。正确。$\\mathbf{1}\\{\\hat{y}_3(x_4^{\\pi}) \\ne y_4\\} = 0$。\n    - $L_3^{\\mathrm{perm}} = \\frac{1}{2}(1+0) = \\frac{1}{2}$。\n\n3.  **计算 $\\Delta_3$**：\n    $\\Delta_3 = L_3^{\\mathrm{perm}} - L_3^{\\mathrm{OOB}} = \\frac{1}{2} - \\frac{1}{2} = 0$。\n\n**最终聚合**\n单个的重要性增量为 $\\Delta_1=1$，$\\Delta_2=0$ 和 $\\Delta_3=0$。\n\n-   **聚合重要性 $\\bar{\\Delta}$**：\n    $$ \\bar{\\Delta} = \\frac{1}{T}\\sum_{t=1}^{T}\\Delta_t = \\frac{1}{3}(1+0+0) = \\frac{1}{3} $$\n\n-   **跨树无偏样本方差 $s^2$**：\n    $$ s^2 = \\frac{1}{T-1}\\sum_{t=1}^{T}\\left(\\Delta_t-\\bar{\\Delta}\\right)^2 = \\frac{1}{3-1}\\left[ \\left(1-\\frac{1}{3}\\right)^2 + \\left(0-\\frac{1}{3}\\right)^2 + \\left(0-\\frac{1}{3}\\right)^2 \\right] $$\n    $$ s^2 = \\frac{1}{2}\\left[ \\left(\\frac{2}{3}\\right)^2 + \\left(-\\frac{1}{3}\\right)^2 + \\left(-\\frac{1}{3}\\right)^2 \\right] $$\n    $$ s^2 = \\frac{1}{2}\\left[ \\frac{4}{9} + \\frac{1}{9} + \\frac{1}{9} \\right] = \\frac{1}{2}\\left( \\frac{6}{9} \\right) = \\frac{1}{2}\\left( \\frac{2}{3} \\right) = \\frac{1}{3} $$\n\n聚合重要性为 $\\bar{\\Delta} = \\frac{1}{3}$，样本方差为 $s^2 = \\frac{1}{3}$。\n\n**解释**\n基因 $G_2$ 的平均重要性估计为 $\\bar{\\Delta} = 1/3$。该估计值在三棵树间的样本方差为 $s^2 = 1/3$。因此标准差为 $s = \\sqrt{s^2} = \\sqrt{1/3} \\approx 0.577$。方差等于均值（因此标准差大于均值）这一事实表明重要性估计存在非常高的不确定性。这种不稳定性源于过程的随机性，特别是在每棵树的极小 OOB 集上执行的单次置换。三棵树中有两棵显示出零重要性增量，而一棵显示出 $1$ 的大增量。这种高方差表明 $\\bar{\\Delta}$ 的估计值不可靠，需要更多的树和/或每棵树更多的置换才能获得稳定的特征重要性度量。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{3}  \\frac{1}{3}\n\\end{pmatrix}\n}\n$$", "id": "3342911"}]}