{"hands_on_practices": [{"introduction": "反应-扩散方程是发育生物学中描述形态发生素浓度分布的基石模型。在应用复杂的机器学习模型之前，进行无量纲化等经典分析至关重要。这一过程有助于识别控制系统行为（如模式形成）的关键物理参数，这对于设计和解释物理信息机器学习（PIML）模型至关重要。本练习 [@problem_id:3337921] 将指导你完成这一关键的建模前步骤，通过推导和分析，你将深入理解物理定律如何决定生物系统的动态行为。", "problem": "考虑单个形态发生素浓度场 $u(x,t)$ 的一维反应扩散方程，\n$$\nu_{t} = D\\,u_{xx} + k\\,f(u),\n$$\n该方程定义在空间域 $x \\in [0,L]$ 上，具有齐次诺伊曼边界条件 $u_{x}(0,t) = 0$ 和 $u_{x}(L,t) = 0$，以及初始条件 $u(x,0) = u_{0}(x)$。此处，$D>0$ 是扩散系数，$k>0$ 是反应速率常数，$f(u)$ 是一个与生物化学生成-降解定律一致的光滑反应动力学函数。在物理信息计算建模中，目标是将机理约束整合到学习系统中：物理信息神经网络 (PINN) 是一种神经函数逼近器，其训练所用的损失函数包含一个数据失配项和一个物理残差项，该残差项用于惩罚在配置点上对控制方程的违反。在计算系统生物学中，无量纲化对于识别指导区域发现和数据驱动推断中残差加权的控制参数至关重要。\n\n任务：\n- 仅从无量纲化的基本定义和给定方程出发，选择空间、时间和浓度的特征尺度，将方程转换为单位区间上的无量纲形式，并确定量化特征反应时间与特征扩散时间之比的无量纲群。解释该群的物理意义，说明反应与扩散的主导地位如何影响空间模式形成的趋势。\n- 设 $u^{*}$ 是一个满足 $f(u^{*})=0$ 的空间齐次平衡点，且 $r := f'(u^{*})>0$。围绕相应的平衡点对无量纲方程进行线性化，并在给定的边界条件下使用分离变量法，求出由 $n \\in \\mathbb{N}$ 索引的空间余弦模态的时间增长率 $\\sigma_{n}$，其中 $n=1$ 是第一个非平凡模态。\n- 使用“当增长率为正时模态增长”的线性稳定性判据，确定第一个空间模态从衰减过渡到增长时无量纲反应扩散比的临界值的闭式解析表达式。最终答案仅用 $r$ 表示。无需数值四舍五入。最终答案是无量纲的，因此报告时无需单位。\n在您的推导中，通过解释为什么在物理信息神经网络 (PINN)（用于从有限数据中推断 $u(x,t)$ 和 $f(u)$）的损失函数中，识别并使用适当的无量纲区域对于平衡物理残差项很重要，从而将该阈值的解释与物理信息机器学习联系起来。", "solution": "问题陈述已经过验证，被认为是具有科学依据、适定且客观的。它提出了一个数学生物学中的标准问题，需要一系列逻辑化、可形式化的步骤来解决。所有必要的数据和条件均已提供，不存在内部矛盾或不科学的前提。因此，我将给出完整解答。\n\n该问题要求完成关于一维反应扩散系统的三个主要任务：无量纲化与解释、线性稳定性分析、以及一个不稳定性临界参数值的推导，并结合物理信息机器学习 (PINN) 的背景对其进行解释。\n\n**第1部分：无量纲化与解释**\n\n控制偏微分方程 (PDE) 如下：\n$$\nu_{t} = D u_{xx} + k f(u)\n$$\n变量和参数包括：浓度 $u(x,t)$、空间坐标 $x \\in [0,L]$、时间 $t$、扩散系数 $D > 0$ 和反应速率常数 $k > 0$。边界条件为齐次诺伊曼条件：$u_x(0,t) = 0$ 和 $u_x(L,t) = 0$。\n\n为了使系统无量纲化，我们引入无量纲变量。题目要求将空间域映射到单位区间，这决定了特征长度尺度的选择，即 $x_c = L$。我们根据给定的平衡点选择特征浓度尺度 $u_c = u^*$。对于时间尺度，问题中有两个内禀尺度：扩散时间尺度 $\\tau_D = L^2/D$ 和反应时间尺度 $\\tau_R \\sim 1/k$。我们选择用扩散时间来缩放时间，即 $t_c = \\tau_D = L^2/D$，因为这种约定能将无量纲扩散系数设为1。\n\n带有波浪号的无量纲变量为：\n$$\n\\tilde{x} = \\frac{x}{L}, \\quad \\tilde{t} = \\frac{t}{L^2/D}, \\quad \\tilde{u}(\\tilde{x}, \\tilde{t}) = \\frac{u(x,t)}{u^*}\n$$\n我们使用链式法则变换偏导数：\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial (u^* \\tilde{u})}{\\partial \\tilde{t}} \\frac{\\partial \\tilde{t}}{\\partial t} = u^* \\frac{\\partial \\tilde{u}}{\\partial \\tilde{t}} \\frac{D}{L^2}\n$$\n$$\n\\frac{\\partial u}{\\partial x} = \\frac{\\partial (u^* \\tilde{u})}{\\partial \\tilde{x}} \\frac{\\partial \\tilde{x}}{\\partial x} = u^* \\frac{\\partial \\tilde{u}}{\\partial \\tilde{x}} \\frac{1}{L} \\implies \\frac{\\partial^2 u}{\\partial x^2} = u^* \\frac{\\partial^2 \\tilde{u}}{\\partial \\tilde{x}^2} \\frac{1}{L^2}\n$$\n将这些代入原始偏微分方程：\n$$\nu^* \\frac{D}{L^2} \\frac{\\partial \\tilde{u}}{\\partial \\tilde{t}} = D \\left( u^* \\frac{1}{L^2} \\frac{\\partial^2 \\tilde{u}}{\\partial \\tilde{x}^2} \\right) + k f(u^* \\tilde{u})\n$$\n为简化起见，我们将整个方程除以因子 $u^* D / L^2$：\n$$\n\\frac{\\partial \\tilde{u}}{\\partial \\tilde{t}} = \\frac{\\partial^2 \\tilde{u}}{\\partial \\tilde{x}^2} + \\frac{k L^2}{D} \\frac{f(u^* \\tilde{u})}{u^*}\n$$\n这就是反应扩散方程的无量纲形式。为简化符号，我们去掉变量 $x, t, u$ 上的波浪号，并定义一个无量纲反应函数 $\\tilde{f}(u) = f(u^* u) / u^*$。方程变为：\n$$\nu_t = u_{xx} + \\gamma \\tilde{f}(u)\n$$\n其中唯一的无量纲群 $\\gamma$ 是：\n$$\n\\gamma = \\frac{k L^2}{D}\n$$\n这个无量纲群是两个特征时间尺度的比值：扩散时间 $\\tau_D = L^2/D$ 和特征反应时间 $\\tau_R = 1/k$。因此，$\\gamma = \\tau_D / \\tau_R$。\n\n$\\gamma$ 的物理意义关系到反应与扩散的主导地位。\n- 如果 $\\gamma \\ll 1$，则 $\\tau_D \\ll \\tau_R$，意味着扩散远快于反应。浓度的任何空间变化都会在反应能显著改变局部浓度之前被扩散平滑掉。这种状态会抑制空间模式的形成。\n- 如果 $\\gamma \\gg 1$，则 $\\tau_D \\gg \\tau_R$，意味着反应远快于扩散。形态发生素的局域生成或消耗发生的时间尺度远小于其扩散穿过整个区域所需的时间。这可能导致微小初始异质性的放大，从而产生陡峭的梯度和可能稳定的空间模式。\n\n**第2部分：线性稳定性分析**\n\n我们现在围绕齐次平衡点对无量纲方程 $u_t = u_{xx} + \\gamma \\tilde{f}(u)$ 进行线性化。原始系统中的平衡点 $u^*$ 对应于无量纲系统中的 $\\tilde{u}^*=1$。我们检查这确实是一个平衡点：$\\tilde{f}(1) = f(u^* \\cdot 1) / u^* = f(u^*) / u^* = 0 / u^* = 0$。\n\n设 $u(x,t) = 1 + v(x,t)$，其中 $v(x,t)$ 是一个小扰动。将其代入无量纲偏微分方程，并在 $u=1$ 附近对 $\\tilde{f}(u)$ 进行泰勒展开：\n$$\n\\frac{\\partial}{\\partial t}(1+v) = \\frac{\\partial^2}{\\partial x^2}(1+v) + \\gamma \\left( \\tilde{f}(1) + v \\tilde{f}'(1) + \\mathcal{O}(v^2) \\right)\n$$\n$$\nv_t = v_{xx} + \\gamma v \\tilde{f}'(1)\n$$\n我们需要计算 $\\tilde{f}'(1)$。根据 $\\tilde{f}(u)$ 的定义：\n$$\n\\tilde{f}'(u) = \\frac{d}{du} \\left( \\frac{f(u^* u)}{u^*} \\right) = \\frac{1}{u^*} f'(u^* u) \\cdot u^* = f'(u^* u)\n$$\n在平衡点 $u=1$ 处，这给出 $\\tilde{f}'(1) = f'(u^*)$。问题将此导数定义为 $r = f'(u^*) > 0$。因此，扰动 $v(x,t)$ 的线性化方程为：\n$$\nv_t = v_{xx} + \\gamma r v\n$$\n无量纲空间域是 $x \\in [0,1]$，边界条件是 $v_x(0,t)=0$ 和 $v_x(1,t)=0$。我们使用分离变量法，假设解的形式为 $v(x,t) = X(x) \\exp(\\sigma t)$。将其代入线性化偏微分方程得到：\n$$\n\\sigma X(x) \\exp(\\sigma t) = X''(x) \\exp(\\sigma t) + \\gamma r X(x) \\exp(\\sigma t)\n$$\n整理后得到空间部分的常微分方程：\n$$\nX''(x) - (\\sigma - \\gamma r) X(x) = 0\n$$\n我们通常将此方程写成标准特征值问题 $X''(x) + \\lambda X(x) = 0$，其中特征值 $\\lambda = -(\\sigma - \\gamma r)$。该 Sturm-Liouville 问题在 $x \\in [0,1]$ 上具有齐次诺伊曼边界条件 $X'(0)=0$ 和 $X'(1)=0$，其解为余弦模态 $X_n(x) = \\cos(n\\pi x)$，对应的特征值为 $\\lambda_n = (n\\pi)^2$，其中整数 $n \\ge 0$。\n\n通过重排 $\\lambda_n = -(\\sigma_n - \\gamma r)$，我们可以找到每个模态 $n$ 的时间增长率 $\\sigma_n$：\n$$\n\\sigma_n = \\gamma r - \\lambda_n = \\gamma r - (n\\pi)^2 \\quad \\text{对于 } n \\in \\{0, 1, 2, ...\\}\n$$\n\n**第3部分：第一个空间模态的临界值**\n\n问题要求的是第一个*空间*模态从衰减过渡到增长的条件。$n=0$ 模态是齐次模态（$\\cos(0)=1$），而第一个非平凡空间模态对应于 $n=1$。该模态的增长率为：\n$$\n\\sigma_1 = \\gamma r - (1 \\cdot \\pi)^2 = \\gamma r - \\pi^2\n$$\n如果增长率为正（$\\sigma_1 > 0$），模态则增长；如果增长率为负（$\\sigma_1 < 0$），则衰减。过渡发生在增长率为零的临界点。设 $\\gamma_c$ 是无量纲比率 $\\gamma$ 的临界值。\n$$\n\\sigma_1 = 0 \\implies \\gamma_c r - \\pi^2 = 0\n$$\n求解 $\\gamma_c$，我们得到临界值的闭式解析表达式：\n$$\n\\gamma_c = \\frac{\\pi^2}{r}\n$$\n\n**与物理信息机器学习 (PINN) 的联系**\n\n在计算系统生物学中，无量纲化和识别临界参数的过程对于 PINN 的实际应用至关重要。PINN 通过最小化一个损失函数 $\\mathcal{L}$ 来学习逼近解 $u(x,t)$，该损失函数通常包括一个数据失配项 $\\mathcal{L}_{\\text{data}}$ 和一个物理残差项 $\\mathcal{L}_{\\text{phys}}$。原始有量纲方程的物理残差为 $\\mathcal{R}_{\\text{dim}} = u_t - D u_{xx} - k f(u)$。损失项由该残差的范数计算得出，例如 $\\mathcal{L}_{\\text{phys}} = ||\\mathcal{R}_{\\text{dim}}||^2$。\n\n训练 PINN 的一个主要挑战是多尺度动力学。如果系数 $D$ 和 $k$ 的数量级差异巨大，残差 $\\mathcal{R}_{\\text{dim}}$ 中的各项也将具有悬殊的尺度。在基于梯度的优化过程中，幅度最大的项将主导损失及其梯度，使得神经网络难以学习其他项的影响。这会导致病态优化问题以及训练缓慢或失败。\n\n无量纲化可作为一种问题预处理。通过将方程转换为 $u_t = u_{xx} + \\gamma \\tilde{f}(u)$，我们将参数复杂性整合到单一的无量纲群 $\\gamma$ 中。物理残差变为 $\\mathcal{R}_{\\text{dimless}} = u_t - u_{xx} - \\gamma \\tilde{f}(u)$。在这里，微分算子的系数为1。反应相对于扩散的重要性现在由 $\\gamma$ 明确控制。\n\n在这种无量纲区域中工作对于平衡物理残差至关重要。如果 $\\gamma \\approx 1$，各项自然平衡，为优化器提供了一个条件更好的损失景观。我们的分析揭示了一个临界值 $\\gamma_c = \\pi^2/r$，在该值处系统的定性行为发生变化（特别是出现空间模式形成不稳定性）。为了让 PINN 准确捕捉这种物理转变，驱动它的各项（扩散与反应）必须在损失函数中得到适当的体现。如果使用有量纲形式，例如当 $D$ 非常小时，$u_{xx}$ 项可能会被优化器在数值上忽略，使得 PINN 无法学习任何由扩散驱动的模式形成。无量纲形式确保了即使 $D$很小，其相对于反应的影响也能被 $\\gamma$ 捕捉到，从而使 PINN 能够学习正确的动力学，尤其是在像 $\\gamma_c$ 这样的临界阈值附近。", "answer": "$$\\boxed{\\frac{\\pi^2}{r}}$$", "id": "3337921"}, {"introduction": "物理信息机器学习（PIML）中的一个关键挑战是确保神经网络的输出尊重基本的物理约束，例如浓度非负或概率归一。本练习 [@problem_id:3337944] 探讨了多种重参数化技术，如 softplus 和 softmax 函数，它们是将物理上合理的模型构建起来的重要工具。理解这些方法是将物理定律转化为神经网络可以处理的语言的关键一步，是实现有效 PIML 模型的必备技能。", "problem": "一个包含物种 $\\mathrm{A}$ 和 $\\mathrm{B}$ 的可逆生化反应网络，在一个充分混合的体积中遵循质量作用动力学，其常微分方程 (ODEs) 为\n$$\n\\frac{d c_{\\mathrm{A}}}{d t} = - k_1 c_{\\mathrm{A}} + k_2 c_{\\mathrm{B}}, \\quad\n\\frac{d c_{\\mathrm{B}}}{d t} = \\phantom{-} k_1 c_{\\mathrm{A}} - k_2 c_{\\mathrm{B}},\n$$\n其中 $c_{\\mathrm{A}}(t)$ 和 $c_{\\mathrm{B}}(t)$ 是浓度，$k_1, k_2 \\ge 0$ 是速率常数。该系统是封闭的，因此总浓度是守恒的：对于所有 $t$，$c_{\\mathrm{A}}(t) + c_{\\mathrm{B}}(t) = C_{\\mathrm{tot}}$，其中 $C_{\\mathrm{tot}} > 0$ 是一个常数。在大数极限下，浓度被定义为单位体积内的分子数，因此对于所有 $t$，$c_{\\mathrm{A}}(t) \\ge 0$ 和 $c_{\\mathrm{B}}(t) \\ge 0$ 必须成立。一个与物种 $\\mathrm{A}$ 耦合的受体以概率 $p_{\\mathrm{on}}(t) \\in [0,1]$ 激活，其失活概率为 $p_{\\mathrm{off}}(t) = 1 - p_{\\mathrm{on}}(t)$。在一个更一般的 K-态马尔可夫模型 ($K \\ge 2$) 中，状态概率构成一个向量 $\\mathbf{p}(t) \\in \\mathbb{R}^K$，该向量必须位于概率单纯形上，即对于所有的 $i$ 和 $t$，$\\sum_{i=1}^K p_i(t) = 1$ 且 $p_i(t) \\ge 0$。如果内在噪声不可忽略，标量浓度 $c(t)$ 可以用一个伊藤形式的随机微分方程 (SDE) 来建模\n$$\nd c = a(c,t)\\, dt + b(c,t)\\, dW_t,\n$$\n其中 $a$ 是漂移项，$b$ 是扩散振幅，$W_t$ 是一个标准维纳过程。在物理信息神经网络 (PINNs) 中，通过神经网络来近似未知函数，并通过惩罚常微分方程、偏微分方程或随机微分方程的残差来强制执行控制定律。然而，神经网络的输出通常在 $\\mathbb{R}$ 中是无约束的，必须进行变换以强制执行物理约束 $c \\ge 0$、$\\mathbf{p} \\in \\Delta^{K-1}$（概率单纯形）和线性守恒律。\n\n从第一性原理出发，解释为什么浓度和概率必须保持非负，以及为什么需要 $\\sum_i p_i = 1$。然后考虑将无约束的网络输出映射到可行变量的重参数化方法，同时允许使用自动微分来计算残差。设 $g:\\mathbb{R}\\to \\mathbb{R}_{\\ge 0}$ 是一个光滑的、严格递增的函数，例如 softplus 函数 $g(u) = \\log(1+e^{u})$ 或指数函数 $g(u) = e^{u}$。设 softmax 映射定义为 $p_i = \\mathrm{softmax}_i(\\mathbf{v}) = \\frac{e^{v_i}}{\\sum_{j=1}^K e^{v_j}}$。设 logistic 映射定义为 $\\sigma(u) = \\frac{1}{1+e^{-u}}$。假设所有函数都足够光滑，以保证在适用的情况下可以使用链式法则和伊藤引理。\n\n在上述背景下，以下哪些陈述是正确的？\n\nA. 使用 $c_{\\mathrm{A}}(t) = g(u_{\\mathrm{A}}(t))$ 和 $c_{\\mathrm{B}}(t) = g(u_{\\mathrm{B}}(t))$，其中 $g$ 为 softplus 函数，并对一个 K-态概率向量使用 $\\mathbf{p}(t) = \\mathrm{softmax}(\\mathbf{v}(t))$，可以保证浓度和概率的非负性，并强制执行 $\\sum_i p_i = 1$。此外，通过链式法则以 $u$ 定义 ODE 残差 $R(u) = \\frac{d}{dt} g(u) - f(g(u))$，确保了当且仅当 $c$ 中的原始残差为零，$R(c) = \\frac{d c}{dt} - f(c) \\equiv 0$ 时，$R(u) \\equiv 0$ 成立，前提是 $g'(u) > 0$。\n\nB. 在 PINNs 中，对于浓度，指数参数化 $c(t) = e^{u(t)}$ 总是优于 softplus 参数化，因为它避免了精确的零值，从而消除了简并稳态，并在所有情况下都提高了数值稳定性。\n\nC. 对于一个 K-态概率向量，$\\mathbf{p}(t) = \\mathrm{softmax}(\\mathbf{v}(t))$ 既强制了非负性和归一化，也自动保证了相关的福克-普朗克方程的边界概率通量在单纯形的面上消失，而无需任何额外的建模考虑。\n\nD. 为了精确地施加 $\\mathrm{A} \\leftrightarrow \\mathrm{B}$ 系统的线性和正性守恒律，可以设置 $\\big(c_{\\mathrm{A}}(t), c_{\\mathrm{B}}(t)\\big) = C_{\\mathrm{tot}} \\, \\mathrm{softmax}\\!\\big( (u_{\\mathrm{A}}(t), u_{\\mathrm{B}}(t)) \\big)$。这通过构造保证了对于所有 $t$，$c_{\\mathrm{A}}(t), c_{\\mathrm{B}}(t) \\ge 0$ 且 $c_{\\mathrm{A}}(t) + c_{\\mathrm{B}}(t) = C_{\\mathrm{tot}}$，并且 PINN 仍然可以通过应用链式法则来计算 $\\frac{d c}{d t}$，从而强制执行 ODE。\n\nE. 对于单个伯努利概率 $p_{\\mathrm{on}}(t) \\in [0,1]$，使用 $p_{\\mathrm{on}}(t) = \\tanh\\!\\big(u(t)\\big)$ 进行参数化是一个合适的选择，它通过将 $\\mathbb{R}$ 映射到区间 $[0,1]$ 来强制执行约束。\n\nF. 如果 $c$ 满足 SDE $d c = a(c,t)\\, dt + b(c,t)\\, dW_t$，并且通过重参数化 $c(t) = s(t)^2$ 来强制非负性（其中 $s(t)$ 无约束），那么一个与以 $s(t)$ 表示的 SDE 相匹配的正确的物理信息损失函数必须包含由变量变换所蕴含的伊藤修正。忽略伊藤项会导致在变换后的坐标中对漂移项产生系统性偏差的表示。\n\n选择所有适用项。", "solution": "浓度来自于计算一个体积内不可区分的分子数量，然后除以该体积。如果 $N(t)$ 是分子数，$V$ 是体积，那么 $c(t) = \\frac{N(t)}{V}$。由于 $N(t) \\in \\mathbb{N}_0$ 且 $V > 0$，我们有 $c(t) \\ge 0$。在确定性的质量作用动力学中，控制 $\\frac{d c}{d t} = f(c)$ 的向量场 $f(c)$ 使得非负象限是前向不变的：从 $c(0) \\ge 0$ 开始，对于所有 $t \\ge 0$ 都有 $c(t) \\ge 0$。这可以被证明，因为生产项是非负反应速率的总和，而消耗项与现有浓度成正比；特别地，在任何存在某个 $c_i = 0$ 的边界上，相应的消耗项会消失，不能将 $c_i$ 驱动为负值。\n\n概率遵循概率公理：对于任何事件 $E$，$P(E) \\ge 0$ 且 $P(\\Omega) = 1$，并且对于有限划分，概率之和为 1。对于一个 K-态马尔可夫链，状态概率定义了一个向量 $\\mathbf{p}(t)$，满足对于所有 $t$，$p_i(t) \\ge 0$ 且 $\\sum_{i=1}^K p_i(t) = 1$。这些约束反映了概率是归一化的度量并且不能为负。\n\n物理信息神经网络通过惩罚从网络输出及其导数计算出的残差来强制执行控制方程。由于原始输出是无约束的，重参数化将 $\\mathbb{R}$ 映射到可行域，同时支持自动微分。如果 $c(t) = g(u(t))$ 且 $g$ 是一个光滑的严格递增函数，那么根据链式法则，$\\frac{d c}{d t} = g'(u) \\frac{d u}{d t}$。对于一个 ODE $\\frac{d c}{d t} - f(c) = 0$，变换后的残差可以写为 $R(u) = g'(u) \\frac{d u}{d t} - f\\big(g(u)\\big)$。如果 $R(u) \\equiv 0$，那么 $c = g(u)$ 满足原始 ODE。反之，如果 $c$ 满足 ODE 且我们用 $g(u)$ 表示 $c$，可微性以及 $g'(u)>0$ 意味着 $R(u) \\equiv 0$。对于概率，softmax 映射 $\\mathrm{softmax}_i(\\mathbf{v}) = \\frac{e^{v_i}}{\\sum_j e^{v_j}}$ 确保了 $p_i \\ge 0$ 且 $\\sum_i p_i = 1$。对于单个概率，logistic 映射 $\\sigma(u) = \\frac{1}{1+e^{-u}}$ 将 $\\mathbb{R}$ 映射到 $(0,1)$。\n\n我们现在分析每个选项。\n\n选项 A: 该选项提出 $c_{\\mathrm{A}} = g(u_{\\mathrm{A}})$，$c_{\\mathrm{B}} = g(u_{\\mathrm{B}})$，其中 $g$ 是 softplus 函数 $g(u) = \\log(1+e^{u})$。softplus 函数是光滑、严格递增的，其导数 $g'(u) = \\frac{1}{1+e^{-u}} > 0$，并且对于所有 $u$，$g(u) \\ge 0$；因此它保证了浓度的非负性。softmax 映射 $\\mathbf{p} = \\mathrm{softmax}(\\mathbf{v})$ 产生 $p_i \\ge 0$ 且 $\\sum_i p_i = 1$。对于 ODE 残差，当 $c = g(u)$ 时，链式法则给出 $\\frac{d c}{d t} = g'(u) \\frac{d u}{d t}$，所以变换后的残差是 $R(u) = g'(u)\\frac{d u}{d t} - f\\big(g(u)\\big)$。如果 $R(u) \\equiv 0$，那么 $c$ 满足 $\\frac{d c}{d t} - f(c) = 0$。反之，如果 $c$ 满足 ODE 并且我们用 $g(u)$ 表示 $c$，可微性以及 $g'(u)>0$ 意味着 $R(u) \\equiv 0$。因此，该选项的陈述是正确的。结论：正确。\n\n选项 B: 该选项断言 $c = e^{u}$ 总是优于 softplus，因为它避免了零值，从而在所有情况下都消除了简并稳态并提高了数值稳定性。虽然 $e^{u}$ 确保了严格正性 ($c > 0$)，但零浓度是物理上有意义的极限（例如，物种灭绝或边界平衡），排除 $c=0$ 可能不合意，如果真实解达到或接近边界的话。在数值上，对于大的正 $u$，$e^u$ 可能导致梯度爆炸，对于大的负 $u$，可能导致梯度消失，这可能损害训练的稳定性。softplus 函数 $g(u) = \\log(1+e^u)$ 也是严格递增和非负的，其尾部行为更温和，并且具有可控的近零区域；它不一定会损害稳定性，并且可以在极限情况下近似零而不排除零。因此，关于普遍优越性和稳定性改进的绝对性论断是错误的。结论：不正确。\n\n选项 C: 虽然 $\\mathbf{p} = \\mathrm{softmax}(\\mathbf{v})$ 确实强制了 $p_i \\ge 0$ 和 $\\sum_i p_i = 1$，但它本身并不能保证与单纯形上的随机模型相关的福克-普朗克方程的任何边界通量条件。零通量或反射边界条件取决于随机动力学（漂移和扩散结构）及其与边界的相互作用；仅靠重参数化并不能在没有对随机算子进行适当建模的情况下施加这些物理边界条件。因此，关于自动使边界通量消失的额外声明是没有根据的。结论：不正确。\n\n选项 D: 定义 $\\big(c_{\\mathrm{A}}, c_{\\mathrm{B}}\\big) = C_{\\mathrm{tot}} \\, \\mathrm{softmax}\\!\\big( (u_{\\mathrm{A}}, u_{\\mathrm{B}}) \\big)$。softmax 产生非负且总和为 1 的分量。乘以 $C_{\\mathrm{tot}}$ 确保了对于所有 $t$，$c_{\\mathrm{A}}, c_{\\mathrm{B}} \\ge 0$ 且 $c_{\\mathrm{A}} + c_{\\mathrm{B}} = C_{\\mathrm{tot}}$ 恒成立。在 PINN 中，可以通过自动微分计算 $\\frac{d c}{d t}$，将链式法则应用于 softmax。守恒律通过构造被精确满足；可以在此参数化中评估和最小化 ODE 残差。虽然 softmax 的雅可比矩阵具有非平凡的结构并引入了耦合，但这并没有不一致之处：如果 $c$ 满足 ODE，则通过链式法则从 $u$ 计算出的残差为零，反之亦然，这取决于 softmax 对 $u$ 中加性常数的不变性。因此，该选项关于强制正性和守恒律同时仍能强制执行 ODE 的陈述是正确的。结论：正确。\n\n选项 E: 映射 $\\tanh(u)$ 的取值范围是 $(-1,1)$，而不是 $[0,1]$。因此 $p_{\\mathrm{on}} = \\tanh(u)$ 并不能强制约束在 $[0,1]$ 内。一个正确的有界映射应该是 $p_{\\mathrm{on}} = \\sigma(u) = \\frac{1}{1+e^{-u}} \\in (0,1)$ 或仿射变换 $p_{\\mathrm{on}} = \\frac{1}{2}\\big( \\tanh(u) + 1 \\big) \\in (0,1)$。如陈述所述，$p_{\\mathrm{on}} = \\tanh(u)$ 的选择是不恰当的。结论：不正确。\n\n选项 F: 当 $c = s^2$ 且 $d c = a(c,t)\\, dt + b(c,t)\\, dW_t$ 时，伊藤引理给出了 $s$ 的 SDE，或者等价地，将 $c$ 的漂移和扩散与 $s$ 的漂移和扩散联系起来。记 $c = g(s)$，其中 $g(s) = s^2$，$g'(s) = 2 s$ 且 $g''(s) = 2$。如果对 $s$ 建模并通过 $d c = g'(s)\\, d s + \\tfrac{1}{2} g''(s)\\, (d s)^2$ 计算 $d c$，则 $(d s)^2$ 项会在 $c$ 的漂移中产生一个与 $g''(s)$ 和 $s$ 的扩散成比例的伊藤修正。反之，如果试图定义一个与 $c$ 中的目标 SDE 一致的 $s$ 的 SDE，那么 $s$ 的漂移必须包含由 $g''$ 引起的项。忽略伊藤修正会导致从变换后的过程所隐含的漂移与目标 $a(c,t)$ 之间出现不匹配，从而产生一个有偏的物理信息残差。因此，任何重参数化后正确的物理信息损失函数都必须包含伊藤项。结论：正确。\n\n因此，正确的陈述是 A、D 和 F。", "answer": "$$\\boxed{ADF}$$", "id": "3337944"}, {"introduction": "本章将以一个完整的动手编程练习作为结束。这个问题 [@problem_id:3337934] 综合了 PIML 的核心思想，要求你从含噪声的数据中推断生化反应速率常数。你将构建一个优化模型，该模型同时最小化与测量数据的误差，以及一个强制执行热力学一致性（一项基本物理定律）的惩罚项。这个练习从头到尾地展示了如何构建和解决一个物理知识通知的逆问题，为你应用这些技术解决实际研究问题提供了蓝图。", "problem": "给定一个由三种代谢物 $A$、$B$ 和 $C$ 之间的三个单分子可逆反应组成的闭合循环生化网络：\n- 反应 $\\mathcal{R}_1$：$A \\leftrightharpoons B$，\n- 反应 $\\mathcal{R}_2$：$B \\leftrightharpoons C$，\n- 反应 $\\mathcal{R}_3$：$C \\leftrightharpoons A$。\n\n假设为理想稀溶液，因此活度等于浓度。令 $c_A$、$c_B$ 和 $c_C$ 表示浓度（单位为 $\\mathrm{mM}$）。根据质量作用动力学，反应 $\\mathcal{R}_i$ 的净通量为\n$$\nj_i \\;=\\; k_{f,i}\\,c_{\\mathrm{react},i} \\;-\\; k_{r,i}\\,c_{\\mathrm{prod},i},\n$$\n其中 $k_{f,i}$ 和 $k_{r,i}$ 分别是正向和逆向速率常数（单位为 $\\mathrm{s^{-1}}$），$c_{\\mathrm{react},i}$ 和 $c_{\\mathrm{prod},i}$ 分别是反应 $\\mathcal{R}_i$ 的反应物和产物浓度。在恒定温度 $T$ 并假设理想性的条件下，热力学一致性要求每个反应都满足\n$$\n\\ln\\!\\left(\\frac{k_{f,i}}{k_{r,i}}\\right) \\;=\\; -\\frac{\\Delta G_i^\\circ}{R\\,T},\n$$\n其中 $\\Delta G_i^\\circ$ 是反应 $\\mathcal{R}_i$ 的标准吉布斯自由能变化（单位为 $\\mathrm{J/mol}$），$R$ 是摩尔气体常数（单位为 $\\mathrm{J/(mol\\cdot K)}$），$T$ 是绝对温度（单位为 $\\mathrm{K}$）。\n\n您的任务是构建并求解一个物理信息逆问题：在强制满足热力学一致性的同时，推断出一组正速率常数 $\\{k_{f,i},k_{r,i}\\}_{i=1}^3$，使其最佳拟合在近平衡条件下测量的稳态净通量和浓度。使用一个包含以下各项的最小二乘目标函数：\n- 一项用于衡量质量作用通量与测量通量之间平衡的数据失配项，\n- 一项用于惩罚偏离上述对数比率约束的热力学惩罚项，\n- 一项小的 Tikhonov 幅度正则化，在数据接近细致平衡时倾向于选择较小的速率常数。\n\n您必须从以下基本原理和事实出发：\n- 质量作用动力学通过上述双线性形式将反应通量与分子活度（此处为浓度）关联起来。\n- 化学亲和势关系和平衡常数定义意味着，对于粒子数无净化学计量变化的单分子可逆反应，有 $\\Delta G^\\circ = -R T \\ln K_\\mathrm{eq}$，其中 $K_\\mathrm{eq} = k_f/k_r$。\n- 当 $|\\Delta G| \\ll R T$ 时，测量的稳态净通量反映了近平衡条件，但若无正则化，其本身无法唯一确定速率常数的大小。\n\n在所有测试用例中统一使用以下常数：\n- 温度 $T = 298.15\\,\\mathrm{K}$（在计算中精确使用此值，单位为 $\\mathrm{K}$），\n- 摩尔气体常数 $R = 8.314\\,\\mathrm{J/(mol\\cdot K)}$。\n\n各物质的标准生成吉布斯自由能为：\n- $G_f^\\circ(A) = -10\\,\\mathrm{kJ/mol}$，\n- $G_f^\\circ(B) = -9\\,\\mathrm{kJ/mol}$，\n- $G_f^\\circ(C) = -11\\,\\mathrm{kJ/mol}$。\n\n根据这些生成能，使用公式 $\\Delta G^\\circ = \\sum_{\\text{products}} \\nu\\,G_f^\\circ - \\sum_{\\text{reactants}} \\nu\\,G_f^\\circ$ 确定每个反应的 $\\Delta G_i^\\circ$，并转换为 $\\mathrm{J/mol}$ 进行计算。反应方向定义为 $A \\to B$、$B \\to C$ 和 $C \\to A$。\n\n按如下方式构建优化问题。令决策变量为六个正速率常数 $\\mathbf{k} = (k_{f,1},k_{r,1},k_{f,2},k_{r,2},k_{f,3},k_{r,3})$。通过堆叠以下各项来定义残差向量 $\\mathbf{r}(\\mathbf{k})$：\n- 对于每个反应 $\\mathcal{R}_i$，质量作用通量残差为\n$$\nr^{(\\mathrm{flux})}_i \\;=\\; k_{f,i}\\,c_{\\mathrm{react},i} \\;-\\; k_{r,i}\\,c_{\\mathrm{prod},i} \\;-\\; j_i^{(\\mathrm{meas})},\n$$\n- 对于每个反应 $\\mathcal{R}_i$，热力学残差为\n$$\nr^{(\\mathrm{thermo})}_i \\;=\\; \\sqrt{\\lambda_{\\mathrm{th}}}\\,\\Big(\\ln(k_{f,i}) - \\ln(k_{r,i}) + \\frac{\\Delta G_i^\\circ}{R\\,T}\\Big),\n$$\n- 对于 $\\mathbf{k}$ 中的每个速率常数，幅度正则化残差为\n$$\nr^{(\\mathrm{mag})}_\\ell \\;=\\; \\sqrt{\\lambda_{\\mathrm{mag}}}\\,k_\\ell.\n$$\n此处，$\\lambda_{\\mathrm{th}}$ 和 $\\lambda_{\\mathrm{mag}}$ 是非负权重，您必须按测试套件中的指定使用。目标是在 $k_\\ell > 0$ 的约束下，最小化残差平方和 $\\|\\mathbf{r}(\\mathbf{k})\\|_2^2$。\n\n通过使用对数进行重参数化来实施此方法以强制正值：令 $x_\\ell = \\ln k_\\ell$，则 $k_\\ell = \\exp(x_\\ell)$，然后在 $\\mathbf{x}$ 上求解无约束非线性最小二乘问题。\n\n物理单位与报告：\n- 浓度 $c$ 的单位为 $\\mathrm{mM}$，\n- 通量 $j$ 的单位为 $\\mathrm{mM/s}$，\n- 速率常数 $k$ 的单位为 $\\mathrm{s^{-1}}$，\n- 温度 $T$ 的单位为 $\\mathrm{K}$，\n- 吉布斯能单位换算后为 $\\mathrm{J/mol}$。\n将最终推断的速率常数以 $\\mathrm{s^{-1}}$ 表示。\n\n测试套件。对于下方的每个测试用例，使用给定的浓度和在正向 $A \\to B$、$B \\to C$、$C \\to A$ 上的测量净通量，以及指定的正则化权重：\n- 测试用例1（标称近平衡，带有小的噪声通量失配）：\n  - $(c_A,c_B,c_C) = (1.0,\\,1.2,\\,0.9)$，单位 $\\mathrm{mM}$，\n  - $(j_1^{(\\mathrm{meas})},j_2^{(\\mathrm{meas})},j_3^{(\\mathrm{meas})}) = (0.0030,\\,0.0028,\\,0.0032)$，单位 $\\mathrm{mM/s}$，\n  - $(\\lambda_{\\mathrm{th}},\\lambda_{\\mathrm{mag}}) = (100.0,\\,1.0\\times 10^{-4})$。\n- 测试用例2（非常接近细致平衡，通量极小）：\n  - $(c_A,c_B,c_C) = (1.0,\\,0.668,\\,1.496)$，单位 $\\mathrm{mM}$，\n  - $(j_1^{(\\mathrm{meas})},j_2^{(\\mathrm{meas})},j_3^{(\\mathrm{meas})}) = (1.0\\times 10^{-5},\\,1.0\\times 10^{-5},\\,1.0\\times 10^{-5})$，单位 $\\mathrm{mM/s}$，\n  - $(\\lambda_{\\mathrm{th}},\\lambda_{\\mathrm{mag}}) = (1000.0,\\,1.0\\times 10^{-3})$。\n- 测试用例3（病态近平衡驱动，分母较小）：\n  - $(c_A,c_B,c_C) = (1.0,\\,0.670,\\,1.500)$，单位 $\\mathrm{mM}$，\n  - $(j_1^{(\\mathrm{meas})},j_2^{(\\mathrm{meas})},j_3^{(\\mathrm{meas})}) = (0.0010,\\,0.0010,\\,0.0010)$，单位 $\\mathrm{mM/s}$，\n  - $(\\lambda_{\\mathrm{th}},\\lambda_{\\mathrm{mag}}) = (500.0,\\,1.0\\times 10^{-3})$。\n\n您的程序必须：\n- 根据给定的生成能计算 $\\Delta G_i^\\circ$，\n- 为每个测试用例求解上述最小二乘问题，\n- 以浮点数形式返回推断的速率常数，单位为 $\\mathrm{s^{-1}}$。\n\n最终输出格式：\n- 生成单行输出，其中包含一个无空格、逗号分隔的Python风格列表，该列表按以下顺序汇总每个测试用例推断出的速率常数：$[k_{f,1},k_{r,1},k_{f,2},k_{r,2},k_{f,3},k_{r,3}]$，然后按测试用例1、2、3的顺序串联。\n- 例如，输出应类似于 $[v_1,v_2,\\dots,v_{18}]$，其中每个 $v_i$ 都是一个浮点数。", "solution": "所提出的问题是计算系统生物学中一个有科学依据且适定的逆问题。它要求从带有噪声的浓度和通量的近平衡测量数据中，推断出一个循环生化网络的六个反应速率常数。该问题的核心在于将数据驱动的模型拟合目标与基本热力学约束相结合，这是物理信息建模的一个标志性特征。\n\n该问题是有效的，因为它基于化学动力学和热力学的既定原理，提供了所有必要的数据和约束，并且被构建为一个可解的非线性最小二乘优化问题。我们现在将着手进行一个有原则的求解。\n\n首先，我们确定系统的热力学参数。每个反应 $\\mathcal{R}_i$ 的标准吉布斯自由能变化 $\\Delta G_i^\\circ$ 是根据给定的标准生成吉布斯自由能 $G_f^\\circ$，利用关系式 $\\Delta G^\\circ = \\sum_{\\text{products}} \\nu\\,G_f^\\circ - \\sum_{\\text{reactants}} \\nu\\,G_f^\\circ$ 计算得出的。反应方向定义为 $\\mathcal{R}_1: A \\to B$、$\\mathcal{R}_2: B \\to C$ 和 $\\mathcal{R}_3: C \\to A$。提供的生成能为 $G_f^\\circ(A) = -10\\,\\mathrm{kJ/mol}$、$G_f^\\circ(B) = -9\\,\\mathrm{kJ/mol}$ 和 $G_f^\\circ(C) = -11\\,\\mathrm{kJ/mol}$。将单位从 $\\mathrm{kJ/mol}$ 转换为 $\\mathrm{J/mol}$ 后：\n$$\n\\Delta G_1^\\circ = G_f^\\circ(B) - G_f^\\circ(A) = (-9000) - (-10000) = 1000\\,\\mathrm{J/mol}\n$$\n$$\n\\Delta G_2^\\circ = G_f^\\circ(C) - G_f^\\circ(B) = (-11000) - (-9000) = -2000\\,\\mathrm{J/mol}\n$$\n$$\n\\Delta G_3^\\circ = G_f^\\circ(A) - G_f^\\circ(C) = (-10000) - (-11000) = 1000\\,\\mathrm{J/mol}\n$$\n沿此循环的自由能变化总和为 $\\Delta G_1^\\circ + \\Delta G_2^\\circ + \\Delta G_3^\\circ = 1000 - 2000 + 1000 = 0\\,\\mathrm{J/mol}$，这正符合热力学第一定律对于循环过程的要求。\n\n问题在于找到一组六个速率常数 $\\mathbf{k} = (k_{f,1}, k_{r,1}, k_{f,2}, k_{r,2}, k_{f,3}, k_{r,3})$，以最佳地解释实验测量结果。这被构建为一个非线性最小二乘优化问题。目标是最小化一个复合残差向量 $\\mathbf{r}(\\mathbf{k})$ 的欧几里得范数平方 $\\|\\mathbf{r}(\\mathbf{k})\\|_2^2$。该向量有12个分量，包含三种不同类型的残差。\n\n1.  **通量失配残差**：这三个残差量化了质量作用动力学模型与测量通量（$j_i^{(\\mathrm{meas})}$）之间的差异。对于每个反应 $\\mathcal{R}_i$，残差为：\n    $$\n    r^{(\\mathrm{flux})}_i = k_{f,i}\\,c_{\\mathrm{react},i} - k_{r,i}\\,c_{\\mathrm{prod},i} - j_i^{(\\mathrm{meas})}\n    $$\n    其中对于 $\\mathcal{R}_1$，$(c_{\\mathrm{react},1}, c_{\\mathrm{prod},1}) = (c_A, c_B)$；对于 $\\mathcal{R}_2$，$(c_{\\mathrm{react},2}, c_{\\mathrm{prod},2}) = (c_B, c_C)$；对于 $\\mathcal{R}_3$，$(c_{\\mathrm{react},3}, c_{\\mathrm{prod},3}) = (c_C, c_A)$。\n\n2.  **热力学惩罚残差**：这三个残差以软约束的形式强制实现热力学一致性。它们惩罚动力学平衡常数（$K_{\\mathrm{eq},i} = k_{f,i}/k_{r,i}$）与热力学平衡常数（$\\exp(-\\Delta G_i^\\circ / (RT))$）之间关系的偏离。每个反应 $\\mathcal{R}_i$ 的残差为：\n    $$\n    r^{(\\mathrm{thermo})}_i = \\sqrt{\\lambda_{\\mathrm{th}}}\\,\\left(\\ln(k_{f,i}) - \\ln(k_{r,i}) + \\frac{\\Delta G_i^\\circ}{R\\,T}\\right)\n    $$\n    其中 $R=8.314\\,\\mathrm{J/(mol\\cdot K)}$，$T=298.15\\,\\mathrm{K}$，$\\lambda_{\\mathrm{th}}$ 是一个权重因子。这种形式比直接使用比率 $k_{f,i}/k_{r,i}$ 在数值上更优越。\n\n3.  **幅度正则化残差**：这六个残差对速率常数应用 Tikhonov（或 $L_2$）正则化。这对于获得唯一且稳定的解至关重要，特别是当数据接近平衡状态，无法唯一确定速率常数的绝对大小时。正则化会惩罚大的速率常数，从而有效地选择与数据一致的最“简单”的动力学模型。对于每个速率常数 $k_\\ell \\in \\mathbf{k}$，其残差为：\n    $$\n    r^{(\\mathrm{mag})}_\\ell = \\sqrt{\\lambda_{\\mathrm{mag}}}\\,k_\\ell\n    $$\n    其中 $\\lambda_{\\mathrm{mag}}$ 是一个小的正正则化参数。\n\n速率常数必须为正值，$k_\\ell > 0$。为了自然地施加此约束，我们对问题进行重参数化。我们定义一组新变量 $\\mathbf{x}$ 作为速率常数的自然对数：$x_\\ell = \\ln k_\\ell$。因此，$k_\\ell = \\exp(x_\\ell)$。这将关于 $\\mathbf{k}$ 的约束优化问题转化为关于 $\\mathbf{x} \\in \\mathbb{R}^6$ 的无约束问题。残差用 $\\mathbf{x}$ 表示。例如，$\\mathcal{R}_i$ 的热力学残差变为 $\\sqrt{\\lambda_{\\mathrm{th}}}\\,(x_{f,i} - x_{r,i} + \\Delta G_i^\\circ/(RT))$。\n\n在此设置下，对于每个测试用例，我们构建完整的12维残差向量 $\\mathbf{r}(\\mathbf{x})$ 并求解无约束非线性最小二乘问题：\n$$\n\\min_{\\mathbf{x} \\in \\mathbb{R}^6} \\|\\mathbf{r}(\\mathbf{x})\\|_2^2\n$$\n该问题使用诸如 Levenberg-Marquardt 等迭代算法进行数值求解，该算法在 `scipy.optimize.least_squares` 函数中实现。该过程从 $\\mathbf{x}$ 的一个初始猜测（例如，$\\mathbf{x}_0 = \\mathbf{0}$，对应于所有 $k_\\ell=1$）开始，并不断对其进行优化，直到找到最小值。然后，最终的优化向量 $\\mathbf{x}_{\\text{opt}}$ 通过 $\\mathbf{k}_{\\text{opt}} = \\exp(\\mathbf{x}_{\\text{opt}})$ 转换回物理速率常数。对所提供的三个测试用例中的每一个重复此过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import least_squares\n\ndef solve():\n    \"\"\"\n    Solves a physics-informed inverse problem to infer biochemical rate constants.\n    \"\"\"\n    # Define physical and chemical constants\n    R = 8.314  # Molar gas constant in J/(mol*K)\n    T = 298.15 # Absolute temperature in K\n    RT = R * T\n\n    # Standard Gibbs free energies of formation in J/mol\n    Gf_A = -10000.0\n    Gf_B = -9000.0\n    Gf_C = -11000.0\n\n    # Calculate standard Gibbs free energy changes for reactions in J/mol\n    # R1: A -> B\n    # R2: B -> C\n    # R3: C -> A\n    dG0_1 = Gf_B - Gf_A\n    dG0_2 = Gf_C - Gf_B\n    dG0_3 = Gf_A - Gf_C\n    dG0_vec = np.array([dG0_1, dG0_2, dG0_3])\n    \n    # Pre-compute the thermodynamic constraint term dG0/(RT)\n    dG0_over_RT = dG0_vec / RT\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1\n        {\n            \"conc\": np.array([1.0, 1.2, 0.9]),  # (cA, cB, cC) in mM\n            \"flux\": np.array([0.0030, 0.0028, 0.0032]),  # (j1, j2, j3) in mM/s\n            \"lambda\": (100.0, 1.0e-4)  # (lambda_th, lambda_mag)\n        },\n        # Test case 2\n        {\n            \"conc\": np.array([1.0, 0.668, 1.496]),\n            \"flux\": np.array([1.0e-5, 1.0e-5, 1.0e-5]),\n            \"lambda\": (1000.0, 1.0e-3)\n        },\n        # Test case 3\n        {\n            \"conc\": np.array([1.0, 0.670, 1.500]),\n            \"flux\": np.array([0.0010, 0.0010, 0.0010]),\n            \"lambda\": (500.0, 1.0e-3)\n        }\n    ]\n\n    all_inferred_constants = []\n\n    # Process each test case\n    for case in test_cases:\n        conc = case[\"conc\"]\n        j_meas = case[\"flux\"]\n        lambda_th, lambda_mag = case[\"lambda\"]\n        \n        # Define reactant and product concentrations for vectorized computation\n        # For R1(A->B), R2(B->C), R3(C->A)\n        c_react = np.array([conc[0], conc[1], conc[2]])  # [cA, cB, cC]\n        c_prod = np.array([conc[1], conc[2], conc[0]])   # [cB, cC, cA]\n\n        def residual_function(log_k_vec):\n            \"\"\"\n            Calculates the residual vector for the least-squares optimization.\n            \n            Args:\n                log_k_vec (np.ndarray): A 6-element vector of the natural logarithm\n                                        of the rate constants:\n                                        [ln(kf1), ln(kr1), ln(kf2), ln(kr2), ln(kf3), ln(kr3)]\n            \n            Returns:\n                np.ndarray: A 12-element residual vector.\n            \"\"\"\n            # Reparameterize to enforce positivity of rate constants\n            k_vec = np.exp(log_k_vec)\n            \n            # Unpack forward and reverse rate constants\n            kf_vec = k_vec[0::2]  # [kf1, kf2, kf3]\n            kr_vec = k_vec[1::2]  # [kr1, kr2, kr3]\n\n            # 1. Flux misfit residuals (3 components)\n            flux_residuals = kf_vec * c_react - kr_vec * c_prod - j_meas\n\n            # 2. Thermodynamic penalty residuals (3 components)\n            # Use log-transformed variables directly for better numerical stability\n            log_kf_vec = log_k_vec[0::2]\n            log_kr_vec = log_k_vec[1::2]\n            thermo_residuals = np.sqrt(lambda_th) * (log_kf_vec - log_kr_vec + dG0_over_RT)\n\n            # 3. Magnitude regularization residuals (6 components)\n            mag_residuals = np.sqrt(lambda_mag) * k_vec\n\n            # Concatenate all residuals into a single vector\n            return np.concatenate((flux_residuals, thermo_residuals, mag_residuals))\n\n        # Initial guess for the log-transformed rate constants (k=1 for all)\n        x0 = np.zeros(6)\n\n        # Solve the nonlinear least-squares problem\n        # The 'lm' method is robust for this type of problem.\n        result = least_squares(residual_function, x0, method='lm')\n\n        # Extract the optimized rate constants by exponentiating the solution vector\n        optimal_k = np.exp(result.x)\n        all_inferred_constants.extend(optimal_k)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{k:.8f}' for k in all_inferred_constants)}]\")\n\nsolve()\n```", "id": "3337934"}]}