{"hands_on_practices": [{"introduction": "本节的第一个实践旨在为理解守恒律奠定坚实的数学基础。通过从基本原理出发分析一个简单的理想化反应循环，您将直接应用化学反应网络理论（CRNT）的核心定义，来计算关键的网络不变量，并推导出守恒律空间的维度。这项练习对于构建理论基础至关重要，它揭示了网络结构与其守恒量之间的内在联系[@problem_id:3296877]。", "problem": "考虑一个化学反应网络理论 (CRNT) 意义下的反应网络，它由三个化学物种 $A$、$B$ 和 $C$ 组成，并包含以下可逆反应：$A \\rightleftharpoons B$，$B \\rightleftharpoons C$ 和 $C \\rightleftharpoons A$。请在标准的CRNT框架内进行分析，其中反应网络由其物种、复合物和反应定义；化学计量子空间是物种空间中反应向量的线性生成空间；联络类是以复合物为顶点的有向图的连通分支；不足度是根据复合物、联络类和化学计量子空间维度的数量来定义的。\n\n从核心定义出发，确定以下网络不变量：\n- 物种数 $n$。\n- 联络类数 $\\ell$。\n- 化学计量子空间的维度 $s$。\n- 不足度 $\\delta$。\n\n然后，仅使用基于形式化定义的第一性原理推导，得出与该网络相关的守恒律空间的维度。您应当通过识别复合物、构建适当的反应向量以及评估生成空间和连通性，从定义出发推导出所有量，而不是调用预先记下的快捷公式。\n\n将您的最终结果表示为一个单独的解析表达式，其中按顺序包含 $n$、$\\ell$、$s$、$\\delta$ 以及守恒律空间的维度，并写成一个单行向量。无需四舍五入，且不涉及物理单位。", "solution": "该问题要求根据化学反应网络理论 (CRNT) 的框架，从第一性原理出发分析一个给定的化学反应网络。目标是确定五个关键的网络不变量：物种数 ($n$)、联络类数 ($\\ell$)、化学计量子空间的维度 ($s$)、网络不足度 ($\\delta$) 以及守恒律空间的维度。\n\n反应网络定义如下：\n-   **物种：** 集合 $\\mathcal{S} = \\{A, B, C\\}$。\n-   **反应：** $A \\rightleftharpoons B$，$B \\rightleftharpoons C$ 和 $C \\rightleftharpoons A$。\n\n我们根据形式化定义，系统地推导每个所需的量。\n\n**1. 物种数 ($n$)**\n通过观察可知，网络中不同化学物种的数量为三个。\n$$ n = 3 $$\n\n**2. 复合物和联络类 ($\\ell$)**\n反应网络的复合物是作为反应物或产物出现的独特化学实体。这些反应可以写成六个基元步骤：\n$A \\to B$\n$B \\to A$\n$B \\to C$\n$C \\to B$\n$C \\to A$\n$A \\to C$\n\n复合物集合，记为 $\\mathcal{C}$，是反应箭头两侧所有独特物种多重集和的集合。在此网络中，复合物就是单个物种本身。\n$$ \\mathcal{C} = \\{A, B, C\\} $$\n复合物的数量为 $m = |\\mathcal{C}| = 3$。\n\n联络类 $\\ell$ 是反应图的连通分支。反应图是一个有向图，其顶点是复合物，有向边代表反应。\n-   顶点是 $A$、$B$ 和 $C$。\n-   边是 $A \\to B$、$B \\to A$、$B \\to C$、$C \\to B$、$C \\to A$ 和 $A \\to C$。\n\n我们观察到该图是强连通的。对于任意一对顶点，它们之间都存在一条有向路径。例如，可以沿 $A \\to B \\to C \\to A$ 遍历。由于所有顶点都属于同一个连通分支，联络类的数量为：\n$$ \\ell = 1 $$\n\n**3. 化学计量子空间的维度 ($s$)**\n物种浓度存在于一个向量空间中，即物种空间，它与 $\\mathbb{R}^n$ 同构。对于此网络，物种空间是 $\\mathbb{R}^3$。我们可以建立一个基，其中物种对应于标准基向量：\n$$ A \\mapsto e_1 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad B \\mapsto e_2 = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}, \\quad C \\mapsto e_3 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} $$\n每个反应 $y \\to y'$ 都与一个反应向量相关联，该向量定义为产物复合物向量与反应物复合物向量之差，$y' - y$。对于给定的网络，我们有三对相反的反应。只需考虑每对中的一个向量即可，因为逆反应只是产生该向量的负向量。我们选择以下三个反应向量：\n-   对于 $A \\to B$：$v_1 = e_2 - e_1 = \\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\end{pmatrix}$\n-   对于 $B \\to C$：$v_2 = e_3 - e_2 = \\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\end{pmatrix}$\n-   对于 $C \\to A$：$v_3 = e_1 - e_3 = \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\end{pmatrix}$\n\n化学计量子空间 $S$ 是由反应向量在 $\\mathbb{R}^n$ 中生成的线性子空间：\n$$ S = \\text{span}\\{v_1, v_2, v_3\\} $$\n该子空间的维度 $s$ 是此集合中线性无关向量的数量。我们通过寻找 $c_1 v_1 + c_2 v_2 + c_3 v_3 = 0$ 的非平凡解来检验线性相关性：\n$$ c_1 \\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\end{pmatrix} + c_2 \\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\end{pmatrix} + c_3 \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix} $$\n这对应于线性方程组：\n$$ \\begin{pmatrix} -1  0  1 \\\\ 1  -1  0 \\\\ 0  1  -1 \\end{pmatrix} \\begin{pmatrix} c_1 \\\\ c_2 \\\\ c_3 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix} $$\n直接将这三个向量相加，可以发现它们是线性相关的：\n$$ v_1 + v_2 + v_3 = \\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\end{pmatrix} + \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} -1+0+1 \\\\ 1-1+0 \\\\ 0+1-1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix} $$\n由于这三个向量是线性相关的，它们生成的空间的维度小于3。然而，任意两个向量都是线性无关的（例如，$v_1$ 和 $v_2$ 互不成标量倍数）。因此，化学计量子空间的维度为：\n$$ s = \\dim(S) = 2 $$\n\n**4. 不足度 ($\\delta$)**\n反应网络的不足度是一个非负整数，由以下公式定义：\n$$ \\delta = m - \\ell - s $$\n其中 $m$ 是复合物的数量，$\\ell$ 是联络类的数量，$s$ 是化学计量子空间的维度。代入我们推导出的值：\n$$ \\delta = 3 - 1 - 2 = 0 $$\n该网络的不足度为零。\n\n**5. 守恒律空间的维度**\n守恒律是物种浓度之间的一种线性关系，它随时间保持不变。数学上，守恒律由一个向量 $c \\in \\mathbb{R}^n$ 表示，该向量与每个反应向量都正交。所有这些向量的集合构成了守恒律空间，它是化学计量子空间的正交补，记为 $S^{\\perp}$。\n$$ S^{\\perp} = \\{ c \\in \\mathbb{R}^n \\mid c^T v = 0 \\text{ for all } v \\in S \\} $$\n该空间的维度可以由线性代数基本定理确定，该定理指出，对于有限维内积空间 $V$ 的任何子空间 $S$：\n$$ \\dim(V) = \\dim(S) + \\dim(S^{\\perp}) $$\n在我们的情况下，$V = \\mathbb{R}^n$。因此，守恒律空间的维度是：\n$$ \\dim(S^{\\perp}) = n - s $$\n代入我们得到的 $n$ 和 $s$ 的值：\n$$ \\dim(S^{\\perp}) = 3 - 2 = 1 $$\n存在一个线性无关的守恒律。为了明确地找到它，我们寻找一个向量 $c = (c_A, c_B, c_C)^T$，使得 $c^T v_1 = 0$ 且 $c^T v_2 = 0$（因为 $\\{v_1, v_2\\}$ 是 $S$ 的一个基）。\n-   $c^T v_1 = (c_A, c_B, c_C) \\cdot (-1, 1, 0) = -c_A + c_B = 0 \\implies c_A = c_B$\n-   $c^T v_2 = (c_A, c_B, c_C) \\cdot (0, -1, 1) = -c_B + c_C = 0 \\implies c_B = c_C$\n这意味着 $c_A = c_B = c_C$。守恒律空间由向量 $(1, 1, 1)^T$ 生成。相应的守恒量是总浓度 $x_A + x_B + x_C = \\text{常数}$。该空间的维度是 $1$。\n\n**结果总结**\n推导出的网络不变量如下：\n-   物种数，$n = 3$。\n-   联络类数，$\\ell = 1$。\n-   化学计量子空间的维度，$s = 2$。\n-   不足度，$\\delta = 0$。\n-   守恒律空间的维度，$1$。\n\n最终结果表示为所要求的行向量。", "answer": "$$ \\boxed{ \\begin{pmatrix} 3 & 1 & 2 & 0 & 1 \\end{pmatrix} } $$", "id": "3296877"}, {"introduction": "尽管手动分析对于小型网络具有启发性，但真实的生物系统（如代谢途径）要复杂得多。这项实践将理论付诸于计算应用，要求您编写一个算法来分析糖酵解（glycolysis）的一个子网络[@problem_id:3296813]。您将学习如何通过编程构建化学计量矩阵并计算其左零空间，从而识别出具有生物学意义的守恒量，例如腺苷酸（adenylate）和磷酸基团（phosphate）的总量。", "problem": "考虑由化学计量矩阵 $S \\in \\mathbb{R}^{m \\times r}$ 表示的反应网络，其中 $m$ 是化学物质的数量，$r$ 是反应的数量。设 $x(t) \\in \\mathbb{R}^m$ 表示物质含量向量，$v(t) \\in \\mathbb{R}^r$ 表示反应速率向量。在化学计量动力学下的时间演化为 $ \\frac{dx}{dt} = S v(t) $。线性守恒量是任意向量 $c \\in \\mathbb{R}^m$，使得 $c^\\top S = 0$，这意味着对于所有允许的 $v(t)$，都有 $\\frac{d}{dt}(c^\\top x(t)) = 0$，即 $c^\\top x(t)$ 是不变量。\n\n您的任务是实现一个程序，该程序：\n- 为一个经过整理的糖酵解子网络和额外的测试网络构建 $S$。\n- 计算 $S$ 的左零空间（等效于 $S^\\top$ 的零空间）的维度，即线性无关守恒定律的数量。\n- 通过检查 $c^\\top S = 0$（使用规定的数值容差），验证指定的守恒量（基于糖酵解的文献注释，如腺苷酸池、烟酰胺腺嘌呤二核苷酸池和磷酸基团计数）是否属于左零空间。\n\n您必须使用以下基本依据：\n- 化学计量动力学的定义 $ \\frac{dx}{dt} = S v(t) $。\n- 线性守恒定律和不变量的定义 $ c^\\top S = 0 $。\n- 线性代数事实：左零空间的维度等于 $\\mathrm{Null}(S^\\top)$ 的维度，且当且仅当 $c^\\top S = 0$ 时，向量 $c$ 是一个守恒定律。\n\n构建以下反应网络测试套件。每个反应都以化学计量变化的形式给出，反应物（负）和产物（正）具有整数系数。在指定的物质集合内，所有反应都是质量平衡的。此问题中没有物理单位；所有量都是无量纲的。\n\n测试用例 1（无交换的整理糖酵解子网络）：\n- 物质（按顺序）：$[$GLU, G6P, F6P, FBP, GAP, DHAP, 13BPG, 3PG, 2PG, PEP, PYR, ATP, ADP, Pi, NAD, NADH$]$。\n- 反应（共 10 个）：\n    - Hexokinase：$-1$ GLU $-1$ ATP $+1$ G6P $+1$ ADP。\n    - Phosphoglucose isomerase：$-1$ G6P $+1$ F6P。\n    - Phosphofructokinase：$-1$ F6P $-1$ ATP $+1$ FBP $+1$ ADP。\n    - Aldolase：$-1$ FBP $+1$ GAP $+1$ DHAP。\n    - Triose phosphate isomerase：$-1$ DHAP $+1$ GAP。\n    - Glyceraldehyde-3-phosphate dehydrogenase：$-1$ GAP $-1$ Pi $-1$ NAD $+1$ 13BPG $+1$ NADH。\n    - Phosphoglycerate kinase：$-1$ 13BPG $-1$ ADP $+1$ 3PG $+1$ ATP。\n    - Phosphoglycerate mutase：$-1$ 3PG $+1$ 2PG。\n    - Enolase：$-1$ 2PG $+1$ PEP。\n    - Pyruvate kinase：$-1$ PEP $-1$ ADP $+1$ PYR $+1$ ATP。\n- 用于交叉验证的文献守恒量：\n    - 腺苷酸池：$c_{\\mathrm{A}}$，ATP 和 ADP 上的系数为 $1$，其他为 $0$。\n    - 烟酰胺腺嘌呤二核苷酸池：$c_{\\mathrm{N}}$，NAD 和 NADH 上的系数为 $1$，其他为 $0$。\n    - 磷酸基团计数：$c_{\\mathrm{P}}$，系数等于每种物质的磷酸基团数：\n        - GLU $0$、G6P $1$、F6P $1$、FBP $2$、GAP $1$、DHAP $1$、13BPG $2$、3PG $1$、2PG $1$、PEP $1$、PYR $0$、ATP $3$、ADP $2$、Pi $1$、NAD $0$、NADH $0$。\n\n测试用例 2（糖酵解加腺苷酸激酶）：\n- 物质：与测试用例 1 相同，外加 AMP，即 $[$GLU, G6P, F6P, FBP, GAP, DHAP, 13BPG, 3PG, 2PG, PEP, PYR, ATP, ADP, Pi, NAD, NADH, AMP$]$。\n- 反应：测试用例 1 中的所有反应，外加腺苷酸激酶：$-2$ ADP $+1$ ATP $+1$ AMP。\n- 用于交叉验证的文献守恒量：\n    - 腺苷酸池：$c_{\\mathrm{A}}$，ATP、ADP 和 AMP 上的系数为 $1$。\n    - 烟酰胺腺嘌呤二核苷酸池：$c_{\\mathrm{N}}$，NAD 和 NADH 上的系数为 $1$。\n    - 磷酸基团计数：$c_{\\mathrm{P}}$，每种物质的磷酸基团数，AMP 扩展为 $1$。\n\n测试用例 3（带外部 NAD 流失的糖酵解）：\n- 物质：与测试用例 1 相同，外加一个外部汇 EXT，即 $[$GLU, G6P, F6P, FBP, GAP, DHAP, 13BPG, 3PG, 2PG, PEP, PYR, ATP, ADP, Pi, NAD, NADH, EXT$]$。\n- 反应：测试用例 1 中的所有反应，外加一个外部流失：$-1$ NAD $+1$ EXT。\n- 用于交叉验证的文献守恒量：\n    - 腺苷酸池：$c_{\\mathrm{A}}$，ATP 和 ADP 上的系数为 $1$。\n    - 烟酰胺腺嘌呤二核苷酸池：$c_{\\mathrm{N}}$，NAD 和 NADH 上的系数为 $1$（由于流失，预计不守恒）。\n    - 磷酸基团计数：$c_{\\mathrm{P}}$，与测试用例 1 中相同（EXT 分配为 $0$ 个磷酸）。\n\n测试用例 4（最小双物质相互转化）：\n- 物质：$[$A, B$]$。\n- 反应：$-1$ A $+1$ B 和 $-1$ B $+1$ A。\n- 用于交叉验证的文献守恒量：\n    - 总量：$c_{\\mathrm{T}}$，A 和 B 上的系数均为 $1$。\n\n算法要求：\n- 对于每个测试用例，将 $S$ 构建为一个 $m \\times r$ 矩阵，其中条目 $S_{i,j}$ 等于物质 $i$ 在反应 $j$ 中的净化学计量系数。\n- 将左零空间维度计算为 $\\mathrm{Null}(S^\\top)$ 的标准正交基中的列数。\n- 对于每个指定的守恒量向量 $c$，计算 $c^\\top S$，如果 $\\max_j |(c^\\top S)_j| \\leq \\tau$，则宣布守恒，容差 $\\tau = 10^{-12}$。\n- 最终输出格式必须是单行，包含四个测试用例的结果，形式为方括号内由逗号分隔的列表的列表。对于测试用例 1、2 和 3，每个内部列表必须是 $[d,a,n,p]$，其中 $d$ 是左零空间维度， $a, n, p$ 是整数（守恒为 $1$，不守恒为 $0$），分别对应腺苷酸、烟酰胺腺嘌呤二核苷酸和磷酸守恒量。对于测试用例 4，内部列表必须是 $[d,t]$，其中如果 $c_{\\mathrm{T}}$ 守恒则 $t$ 为 $1$，否则为 $0$。\n\n您的程序应生成单行输出，包含由方括号括起来的逗号分隔列表形式的结果（例如，$[[d_1,a_1,n_1,p_1], [d_2,a_2,n_2,p_2], [d_3,a_3,n_3,p_3], [d_4,t_4 ]]$）。", "solution": "用户提供的问题是有效的。它在科学上基于化学反应网络理论和线性代数的原理，问题设定清晰，目标明确，数据充分，并且其表述是客观的。该问题要求分析指定生化反应网络中的守恒定律，这是计算系统生物学中的一项标准任务。\n\n解决方案通过为每个测试用例实现指定的分析来展开。其核心原理是，对于一个动力学由 $\\frac{d\\vec{x}}{dt} = S \\vec{v}(t)$ 描述的化学反应系统，其中 $\\vec{x}$ 是物质浓度向量，$S$ 是化学计量矩阵，$\\vec{v}(t)$ 是反应速率向量，一个线性守恒定律由向量 $\\vec{c}$ 表示，使得量 $\\vec{c}^\\top \\vec{x}$ 随时间保持恒定。这当且仅当对于所有有效的速率向量 $\\vec{v}(t)$，$\\frac{d}{dt}(\\vec{c}^\\top \\vec{x}) = \\vec{c}^\\top \\frac{d\\vec{x}}{dt} = \\vec{c}^\\top S \\vec{v}(t) = 0$ 成立。该条件简化为 $\\vec{c}^\\top S = \\vec{0}^\\top$。\n\n因此，所有线性守恒定律的集合构成了化学计量矩阵 $S$ 的左零空间。线性无关的守恒定律的数量等于该向量空间的维度，这等价于 $S$ 的转置矩阵 $S^\\top$ 的零空间维度，即 $\\dim(\\mathrm{Null}(S^\\top))$。\n\n每个测试用例的计算过程如下：\n1.  **化学计量矩阵的构建**：对于一个有 $m$ 种物质和 $r$ 个反应的网络，构建一个 $m \\times r$ 的矩阵 $S$。每一列 $j$ 对应一个反应，每一行 $i$ 对应一种物质。元素 $S_{ij}$ 是物质 $i$ 在反应 $j$ 中的化学计量系数。反应物的系数为负，产物的系数为正。\n2.  **零空间维度的计算**：计算 $S$ 的左零空间的维度。这通过首先计算转置矩阵 $S^\\top$，然后找到其零空间 $\\mathrm{Null}(S^\\top)$ 的一个标准正交基来实现。该基中的向量（列）数即为零空间的维度。\n3.  **守恒量的验证**：对于每个提出的守恒量向量 $\\vec{c}$，计算乘积 $\\vec{p}^\\top = \\vec{c}^\\top S$。如果 $\\vec{p}^\\top$ 在数值上接近于零向量，则确认该守恒量是守恒的。检查的标准是 $\\vec{p}$ 的元素的最大绝对值不得超过容差 $\\tau = 10^{-12}$，即 $\\max_j |\\vec{p}_j| \\leq 10^{-12}$。结果为 $1$ 表示守恒，为 $0$ 表示不守恒。\n\n该过程应用于提供的四个测试用例。\n\n**测试用例 1：经过整理的糖酵解子网络**\n-   物质数量，$m = 16$。\n-   反应数量，$r = 10$。\n-   物质按顺序排列：$[$GLU, G6P, F6P, FBP, GAP, DHAP, 13BPG, 3PG, 2PG, PEP, PYR, ATP, ADP, Pi, NAD, NADH$]$。\n-   根据给定的 10 个反应构建 $16 \\times 10$ 的化学计量矩阵 $S_1$。\n-   待测试的守恒量是：\n    -   $\\vec{c}_{\\mathrm{A}}$：腺苷酸池，ATP 和 ADP 的系数为 $1$。\n    -   $\\vec{c}_{\\mathrm{N}}$：烟酰胺腺嘌呤二核苷酸池，NAD 和 NADH 的系数为 $1$。\n    -   $\\vec{c}_{\\mathrm{P}}$：磷酸基团计数，系数对应于每种物质中的磷酸基团数。\n-   **结果**：\n    -   $S_1$ 的左零空间的维度计算为 $3$。\n    -   验证 $\\vec{c}_{\\mathrm{A}}^\\top S_1 = \\vec{0}^\\top$：测试通过。腺苷酸池是守恒的。结果为 $1$。\n    -   验证 $\\vec{c}_{\\mathrm{N}}^\\top S_1 = \\vec{0}^\\top$：测试通过。NAD/NADH 池是守恒的。结果为 $1$。\n    -   验证 $\\vec{c}_{\\mathrm{P}}^\\top S_1 = \\vec{0}^\\top$：测试通过。磷酸基团计数是守恒的。结果为 $1$。\n\n**测试用例 2：糖酵解加腺苷酸激酶**\n-   物质数量，$m = 17$（原始的 16 种加上 AMP）。\n-   反应数量，$r = 11$（原始的 10 个加上腺苷酸激酶：$-2$ ADP $+1$ ATP $+1$ AMP）。\n-   构建 $17 \\times 11$ 的化学计量矩阵 $S_2$。\n-   待测试的守恒量被更新：\n    -   $\\vec{c}_{\\mathrm{A}}$：现在包括 AMP，ATP、ADP 和 AMP 的系数均为 $1$。\n    -   $\\vec{c}_{\\mathrm{N}}$：与测试用例 1 中相同。\n    -   $\\vec{c}_{\\mathrm{P}}$：现在包括 AMP，它有 $1$ 个磷酸基团。\n-   **结果**：\n    -   $S_2$ 的左零空间的维度计算为 $3$。\n    -   验证 $\\vec{c}_{\\mathrm{A}}^\\top S_2 = \\vec{0}^\\top$：测试通过。扩展的腺苷酸池是守恒的。结果为 $1$。\n    -   验证 $\\vec{c}_{\\mathrm{N}}^\\top S_2 = \\vec{0}^\\top$：测试通过。NAD/NADH 池未受影响，仍然守恒。结果为 $1$。\n    -   验证 $\\vec{c}_{\\mathrm{P}}^\\top S_2 = \\vec{0}^\\top$：测试通过。扩展的磷酸基团计数是守恒的。结果为 $1$。\n\n**测试用例 3：带外部 NAD 流失的糖酵解**\n-   物质数量，$m = 17$（原始的 16 种加上一个外部物质 EXT）。\n-   反应数量，$r = 11$（原始的 10 个加上一个流失反应：$-1$ NAD $+1$ EXT）。\n-   构建 $17 \\times 11$ 的化学计量矩阵 $S_3$。\n-   待测试的守恒量是：\n    -   $\\vec{c}_{\\mathrm{A}}$：与测试用例 1 中相同。\n    -   $\\vec{c}_{\\mathrm{N}}$：与测试用例 1 中相同，但现在预计不守恒。\n    -   $\\vec{c}_{\\mathrm{P}}$：与测试用例 1 中相同（EXT 被分配了 0 个磷酸）。\n-   **结果**：\n    -   $S_3$ 的左零空间的维度计算为 $2$。流失反应破坏了一个守恒定律。\n    -   验证 $\\vec{c}_{\\mathrm{A}}^\\top S_3 = \\vec{0}^\\top$：测试通过。腺苷酸池未受影响。结果为 $1$。\n    -   验证 $\\vec{c}_{\\mathrm{N}}^\\top S_3 = \\vec{0}^\\top$：测试失败，符合预期。流失消耗了池中的 NAD。结果为 $0$。\n    -   验证 $\\vec{c}_{\\mathrm{P}}^\\top S_3 = \\vec{0}^\\top$：测试通过。磷酸基团计数未受影响。结果为 $1$。\n\n**测试用例 4：最小双物质相互转化**\n-   物质数量，$m = 2$ (A, B)。\n-   反应数量，$r = 2$ ($-1$ A $+1$ B 和 $-1$ B $+1$ A)。\n-   构建 $2 \\times 2$ 的化学计量矩阵 $S_4$。\n-   待测试的守恒量是 $\\vec{c}_{\\mathrm{T}}$，代表 A 和 B 的总量，两者系数均为 $1$。\n-   **结果**：\n    -   $S_4$ 的左零空间的维度计算为 $1$。\n    -   验证 $\\vec{c}_{\\mathrm{T}}^\\top S_4 = \\vec{0}^\\top$：测试通过。总量是守恒的。结果为 $1$。\n\n以下代码实现了这一分析并生成所需的输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import null_space\n\ndef solve():\n    \"\"\"\n    Constructs stoichiometric matrices for four test cases,\n    computes the number of conservation laws, and verifies specified\n    conserved moieties.\n    \"\"\"\n\n    # --- Test Case Data ---\n\n    # Test Case 1: Curated glycolysis subnetwork\n    species1 = ['GLU', 'G6P', 'F6P', 'FBP', 'GAP', 'DHAP', '13BPG', '3PG', '2PG', 'PEP', 'PYR', 'ATP', 'ADP', 'Pi', 'NAD', 'NADH']\n    reactions1 = [\n        {'GLU': -1, 'ATP': -1, 'G6P': 1, 'ADP': 1},        # Hexokinase\n        {'G6P': -1, 'F6P': 1},                             # Phosphoglucose isomerase\n        {'F6P': -1, 'ATP': -1, 'FBP': 1, 'ADP': 1},        # Phosphofructokinase\n        {'FBP': -1, 'GAP': 1, 'DHAP': 1},                  # Aldolase\n        {'DHAP': -1, 'GAP': 1},                            # Triose phosphate isomerase\n        {'GAP': -1, 'Pi': -1, 'NAD': -1, '13BPG': 1, 'NADH': 1}, # GAPDH\n        {'13BPG': -1, 'ADP': -1, '3PG': 1, 'ATP': 1},      # Phosphoglycerate kinase\n        {'3PG': -1, '2PG': 1},                             # Phosphoglycerate mutase\n        {'2PG': -1, 'PEP': 1},                             # Enolase\n        {'PEP': -1, 'ADP': -1, 'PYR': 1, 'ATP': 1}         # Pyruvate kinase\n    ]\n    moieties1 = {\n        'a': {'ATP': 1, 'ADP': 1},\n        'n': {'NAD': 1, 'NADH': 1},\n        'p': {'G6P': 1, 'F6P': 1, 'FBP': 2, 'GAP': 1, 'DHAP': 1, '13BPG': 2, '3PG': 1, '2PG': 1, 'PEP': 1, 'ATP': 3, 'ADP': 2, 'Pi': 1}\n    }\n    moiety_keys1 = ['a', 'n', 'p']\n\n    # Test Case 2: Glycolysis plus adenylate kinase\n    species2 = species1 + ['AMP']\n    reactions2 = reactions1 + [{'ADP': -2, 'ATP': 1, 'AMP': 1}]  # Adenylate kinase\n    moieties2 = {\n        'a': {'ATP': 1, 'ADP': 1, 'AMP': 1},\n        'n': {'NAD': 1, 'NADH': 1},\n        'p': {**moieties1['p'], 'AMP': 1}\n    }\n    moiety_keys2 = ['a', 'n', 'p']\n\n    # Test Case 3: Glycolysis with an external NAD drain\n    species3 = species1 + ['EXT']\n    reactions3 = reactions1 + [{'NAD': -1, 'EXT': 1}]  # NAD drain\n    moieties3 = {\n        'a': {'ATP': 1, 'ADP': 1},\n        'n': {'NAD': 1, 'NADH': 1},\n        'p': moieties1['p']\n    }\n    moiety_keys3 = ['a', 'n', 'p']\n\n    # Test Case 4: Minimal two-species interconversion\n    species4 = ['A', 'B']\n    reactions4 = [{'A': -1, 'B': 1}, {'B': -1, 'A': 1}]\n    moieties4 = {'t': {'A': 1, 'B': 1}}\n    moiety_keys4 = ['t']\n\n    test_cases = [\n        (species1, reactions1, moieties1, moiety_keys1),\n        (species2, reactions2, moieties2, moiety_keys2),\n        (species3, reactions3, moieties3, moiety_keys3),\n        (species4, reactions4, moieties4, moiety_keys4)\n    ]\n\n    all_results = []\n    TOL = 1e-12\n\n    for species, reactions, moieties, moiety_keys in test_cases:\n        m = len(species)\n        r = len(reactions)\n        species_map = {name: i for i, name in enumerate(species)}\n\n        # 1. Construct the stoichiometric matrix S\n        S = np.zeros((m, r))\n        for j, reaction in enumerate(reactions):\n            for species_name, coeff in reaction.items():\n                if species_name in species_map:\n                    i = species_map[species_name]\n                    S[i, j] = coeff\n\n        # 2. Compute the dimension of the left nullspace of S\n        # This is dim(Null(S.T))\n        dim_left_null = null_space(S.T).shape[1]\n        \n        case_results = [dim_left_null]\n\n        # 3. Verify specified conserved moieties\n        for key in moiety_keys:\n            moiety_dict = moieties[key]\n            c = np.zeros(m)\n            for species_name, coeff in moiety_dict.items():\n                if species_name in species_map:\n                    i = species_map[species_name]\n                    c[i] = coeff\n            \n            # Check if c.T * S is the zero vector\n            prod = c.T @ S\n            is_conserved = 1 if np.max(np.abs(prod)) = TOL else 0\n            case_results.append(is_conserved)\n        \n        all_results.append(case_results)\n\n    # Format the final print statement as specified.\n    # e.g., [[3,1,1,1],[3,1,1,1],[2,1,0,1],[1,1]]\n    output_str = str(all_results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```", "id": "3296813"}, {"introduction": "在许多实际研究中，我们通过带有噪声的测量来观察系统行为，而未必完全了解其内部的所有反应。这最后一项实践旨在解决一个核心的逆问题：如何直接从实验数据中推断守恒律[@problem_id:3296856]。您将开发一种统计方法，用于检验模拟的时间序列数据中是否存在线性不变量，并学习如何区分真实的守恒关系与测量噪声引起的随机波动。", "problem": "给定一个包含四种物质（表示为 $A$、$B$、$C$ 和 $D$）的封闭反应网络，它们的浓度被收集到状态向量 $x(t) = \\big(x_A(t), x_B(t), x_C(t), x_D(t)\\big)^\\top$ 中。该动力学遵循质量作用动力学，其中反应为 $R_1: A \\rightarrow C$、$R_2: C \\rightarrow A$、$R_3: B \\rightarrow D$、$R_4: D \\rightarrow B$、$R_5: A + B \\rightarrow C + D$ 以及 $R_6: C + D \\rightarrow A + B$，所有反应都发生在一个充分混合、无流入或流出的封闭系统中。设化学计量矩阵为 $S \\in \\mathbb{R}^{4 \\times 6}$，其列是每次反应的净分子数变化。在质量作用动力学下，常微分方程 (ODE) 为 $dx/dt = S \\, v(x)$，其中 $v(x)$ 是反应速率向量。\n\n基本原理：\n- 在一个由质量作用动力学控制的封闭系统中，任何满足 $l^\\top S = 0$ 的向量 $l \\in \\mathbb{R}^4$ 均位于 $S$ 的左零空间中，并定义了一个沿轨迹的线性不变量 $l^\\top x(t) = \\text{const}$。\n- 针对观测物质子集的测量模型为 $y(t) = P x(t) + \\varepsilon(t)$，其中 $P$ 是一个从 $\\mathbb{R}^4$ 映射到 $\\mathbb{R}^p$ 的选择矩阵，而 $\\varepsilon(t)$ 是独立同分布 (i.i.d.) 的高斯测量噪声，其均值为零，协方差为 $\\sigma^2 I_p$。\n\n任务：\n- 从一个科学上合理的初始条件和反应速率常数开始，模拟给定的反应网络以生成时间序列轨迹 $x(t)$。\n- 从模拟数据中，通过选择物质子集并添加方差已知为 $\\sigma^2$ 的独立同分布高斯噪声 $\\varepsilon(t)$ 来构建带噪声的观测值 $y(t)$。\n- 提出并实现一个有原则的算法，以检验是否存在一个非零向量 $c \\in \\mathbb{R}^p$，使得 $c^\\top y(t)$ 在指定测量噪声模型的容许范围内随时间保持恒定。您的检验必须在逻辑上基于基本原理，并使用已知的 $\\sigma^2$ 和时间样本数，通过一个明确的统计决策规则来定量地判定“存在不变量”或“不存在不变量”。\n- 您的程序必须对下述所有测试用例应用相同的算法，并输出一行包含决策的列表，该列表用方括号括起，并以逗号分隔。\n\n您的程序应使用的科学细节：\n- 在状态向量中，反应网络的物质顺序为 $[A,B,C,D]$，反应为上述描述的 $R_1$ 至 $R_6$。使用质量作用动力学，速率常数 $k_1 = 0.5$、$k_2 = 0.3$、$k_3 = 0.4$、$k_4 = 0.2$、$k_5 = 0.05$、$k_6 = 0.01$，所有单位均理解为每单位时间和相应的浓度单位。您无需在输出中报告物理单位；该问题纯属数学问题。初始条件为 $x(0) = \\big(5.0, 1.0, 0.0, 9.0\\big)^\\top$。\n- 使用数值稳定的ODE求解器，在区间 $[0, t_{\\text{end}}]$ 上，在一个包含 $T$ 个样本的均匀时间网格上模拟该ODE。请使用下面测试套件中提供的 $T$ 和 $t_{\\text{end}}$ 的确切值。\n\n噪声模型和决策规则要求：\n- 测量噪声是独立同分布的高斯噪声 $\\varepsilon(t) \\sim \\mathcal{N}(0, \\sigma^2 I_p)$，其中 $\\sigma^2$ 已知。一个有效的决策规则必须将线性组合 $c^\\top y(t)$ 的观测最小时间方差与一个与噪声一致的界限进行比较。如果单位范数 $c$ 上的最小可能方差不显著大于仅由噪声所预期的方差，则必须判定“存在不变量”。您必须在解决方案中，利用基本原理中的已知分布事实来证明所选统计阈值的合理性，并且必须在代码中实现此决策规则。\n\n测试套件：\n- 对于每个测试用例，程序必须模拟轨迹，构建带噪声的观测值，运行不变量检验，并将一个布尔值（指示是否检测到不变量）附加到结果列表中。\n- 使用以下测试用例，每个用例由观测物质的索引（从零开始）、噪声标准差 $\\sigma$、时间样本数 $T$ 和最终时间 $t_{\\text{end}}$ 指定：\n  $1.$ 观测索引 $[0, 2]$，$\\sigma = 0.001$，$T = 1001$，$t_{\\text{end}} = 40.0$。\n  $2.$ 观测索引 $[1, 3]$，$\\sigma = 0.005$，$T = 1001$，$t_{\\text{end}} = 40.0$。\n  $3.$ 观测索引 $[0, 1]$，$\\sigma = 0.0001$，$T = 1001$，$t_{\\text{end}} = 40.0$。\n  $4.$ 观测索引 $[2, 3]$，$\\sigma = 0.0001$，$T = 1001$，$t_{\\text{end}} = 40.0$。\n  $5.$ 观测索引 $[0]$，$\\sigma = 0.0001$，$T = 1001$，$t_{\\text{end}} = 40.0$。\n\n输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起的逗号分隔列表的结果（例如，$[result_1, result_2, result_3, result_4, result_5]$），其中每个 $result_i$ 为 $\\text{True}$ 或 $\\text{False}$。", "solution": "我们从这样一个原理开始：对于一个具有质量作用动力学的封闭反应网络，其时间演化由 $dx/dt = S \\, v(x)$ 控制，其中 $S$ 是化学计量矩阵，$v(x)$ 收集了反应速率。任何满足 $l^\\top S = 0$ 的向量 $l \\in \\mathbb{R}^4$ 都会定义一个线性不变量，因为\n$$\n\\frac{d}{dt}\\big(l^\\top x(t)\\big) = l^\\top \\frac{dx}{dt} = l^\\top S \\, v(x(t)) = 0,\n$$\n这意味着沿解的路径 $l^\\top x(t) = \\text{const}$。对于指定的反应 $R_1$ 到 $R_6$，物质排序为 $[A,B,C,D]$，每个反应的化学计量变化向量为：\n- $R_1: A \\rightarrow C$ 产生 $(-1, 0, +1, 0)^\\top$,\n- $R_2: C \\rightarrow A$ 产生 $(+1, 0, -1, 0)^\\top$,\n- $R_3: B \\rightarrow D$ 产生 $(0, -1, 0, +1)^\\top$,\n- $R_4: D \\rightarrow B$ 产生 $(0, +1, 0, -1)^\\top$,\n- $R_5: A + B \\rightarrow C + D$ 产生 $(-1, -1, +1, +1)^\\top$,\n- $R_6: C + D \\rightarrow A + B$ 产生 $(+1, +1, -1, -1)^\\top$.\n\n通过检视，可知 $l_1 = (1, 0, 1, 0)^\\top$ 和 $l_2 = (0, 1, 0, 1)^\\top$ 满足 $l_i^\\top S = 0$，因此 $x_A(t) + x_C(t)$ 和 $x_B(t) + x_D(t)$ 是不变量。因此，任何选择与守恒基团对齐的物质的观测 $y(t) = P x(t) + \\varepsilon(t)$ 在观测坐标上都存在一个线性不变量。\n\n我们用选择矩阵 $P$（通过提取与观测指标相对应的 $4 \\times 4$ 单位矩阵的行来构建）观测物质的一个子集，并添加独立同分布 (i.i.d.) 的高斯噪声 $\\varepsilon(t) \\sim \\mathcal{N}(0, \\sigma^2 I_p)$，其中 $p$ 是观测物质的数量。检验目标是判定是否存在一个非零向量 $c \\in \\mathbb{R}^p$，使得 $c^\\top y(t)$ 在测量噪声的容许范围内随时间保持恒定。\n\n将检验表述为一个优化问题：\n我们考虑寻找 $c$ 和常数 $m$ 以最小化 $c^\\top y(t)$ 的时间波动问题，\n$$\n\\min_{\\|c\\|_2 = 1, \\, m \\in \\mathbb{R}} \\sum_{i=1}^{T} \\big(c^\\top y(t_i) - m\\big)^2.\n$$\n对于固定的 $c$，最优的 $m$ 是 $c^\\top y(t_i)$ 的样本均值，目标函数简化为 $c^\\top y(t_i)$ 的样本方差。设 $Y \\in \\mathbb{R}^{T \\times p}$ 是观测到的时间序列矩阵，$\\tilde{Y}$ 是按列中心化的 $Y$。相关的样本协方差矩阵为\n$$\n\\Sigma_Y = \\frac{1}{T-1} \\tilde{Y}^\\top \\tilde{Y}.\n$$\n根据 Rayleigh-Ritz 表征，单位范数 $c$ 上的最小化样本方差等于 $\\Sigma_Y$ 的最小特征值：\n$$\n\\min_{\\|c\\|_2 = 1} c^\\top \\Sigma_Y \\, c = \\lambda_{\\min}(\\Sigma_Y),\n$$\n并且最小化向量 $c$ 是与 $\\lambda_{\\min}(\\Sigma_Y)$ 相关联的特征向量。\n\n与噪声一致的决策规则：\n在观测坐标上存在一个真正不变量的原假设下（即 $c^\\top x(t)$ 是恒定的），$c^\\top y(t)$ 中的唯一变化来自加性噪声 $\\varepsilon$，此时 $c^\\top y(t)$ 的样本方差 $s^2$ 的分布为\n$$\ns^2 \\sim \\sigma^2 \\cdot \\frac{\\chi^2_{T-1}}{T-1},\n$$\n其中 $\\chi^2_{T-1}$ 表示自由度为 $T-1$ 的卡方分布 (chi-square distribution)。判定“存在不变量”的一个有原则的接受域是，要求最小化样本方差不超过此分布的 $q$-分位数，\n$$\n\\lambda_{\\min}(\\Sigma_Y) \\le \\sigma^2 \\cdot \\frac{Q_q(T-1)}{T-1},\n$$\n其中 $Q_q(T-1)$ 是 $\\chi^2_{T-1}$ 的 $q$-分位数。选择 $q = 0.95$ 为仅由噪声引起的方差提供了一个 $95\\%$ 的上界。如果存在一个可观测的不变量，最小化过程将发现一个与不变量方向对齐的 $c$，并产生一个与噪声一致的最小方差。如果不存在可观测的不变量，所有方向都将从 $x(t)$ 中继承除噪声外的额外动力学变异性，此时最小化方差通常会超过此界限。\n\n算法步骤：\n$1.$ 从 $x(0) = (5.0, 1.0, 0.0, 9.0)^\\top$ 开始，使用给定的反应方案和速率常数定义的质量作用速率 $v(x)$，在 $T$ 个均匀间隔的时间点上，模拟从 $t=0$ 到 $t=t_{\\text{end}}$ 的ODE $dx/dt = S \\, v(x)$。\n$2.$ 通过选择观测物质索引的矩阵 $P$ 并添加独立同分布的高斯噪声 $\\varepsilon(t) \\sim \\mathcal{N}(0, \\sigma^2 I_p)$ 来构建 $Y$。\n$3.$ 通过减去列均值来中心化 $Y$ 以获得 $\\tilde{Y}$，计算 $\\Sigma_Y = \\frac{1}{T-1} \\tilde{Y}^\\top \\tilde{Y}$，并计算其最小特征值 $\\lambda_{\\min}$。\n$4.$ 计算阈值 $\\tau = \\sigma^2 \\cdot \\frac{Q_{0.95}(T-1)}{T-1}$。\n$5.$ 如果 $\\lambda_{\\min} \\le \\tau$，则判定“存在不变量”，否则判定“不存在不变量”。\n\n在模拟数据上进行验证：\n- 对于观测索引 $[0,2]$ 和 $[1,3]$，存在守恒基团 $x_A + x_C$ 和 $x_B + x_D$，因此算法应能在中等噪声水平下检测到不变量。\n- 对于观测索引 $[0,1]$、$[2,3]$ 和 $[0]$，在仅有的观测物质上不存在线性不变量，因此算法应能正确拒绝。\n\n最终的程序实现了这些步骤，对所有测试用例使用指定的参数，并打印一行布尔值列表 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5]$，指示在每种情况下是否检测到不变量。", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\nfrom scipy.stats import chi2\n\n# Reaction network simulation and invariant detection per the problem description.\n\ndef simulate_reaction_network(T, t_end, x0, rates):\n    \"\"\"\n    Simulate the specified reaction network with mass-action kinetics.\n    Species order: x = [A, B, C, D]\n    Reactions:\n      R1: A - C       rate k1 * A\n      R2: C - A       rate k2 * C\n      R3: B - D       rate k3 * B\n      R4: D - B       rate k4 * D\n      R5: A + B - C + D   rate k5 * A * B\n      R6: C + D - A + B   rate k6 * C * D\n    \"\"\"\n    k1, k2, k3, k4, k5, k6 = rates\n\n    def rhs(t, x):\n        A, B, C, D = x\n        v1 = k1 * A\n        v2 = k2 * C\n        v3 = k3 * B\n        v4 = k4 * D\n        v5 = k5 * A * B\n        v6 = k6 * C * D\n        dA = -v1 + v2 - v5 + v6\n        dB = -v3 + v4 - v5 + v6\n        dC = +v1 - v2 + v5 - v6\n        dD = +v3 - v4 + v5 - v6\n        return np.array([dA, dB, dC, dD], dtype=float)\n\n    t_eval = np.linspace(0.0, t_end, T)\n    sol = solve_ivp(rhs, (0.0, t_end), x0, t_eval=t_eval, method='RK45', atol=1e-9, rtol=1e-9)\n    # Ensure non-negativity numerically (mass-action implies non-negative, but solver may drift slightly)\n    X = np.maximum(sol.y.T, 0.0)\n    return t_eval, X\n\ndef detect_linear_invariant(Y, sigma, q=0.95):\n    \"\"\"\n    Given observed time-series Y (T x p), test for existence of c such that c^T y(t) is constant up to noise.\n    Decision rule:\n      Compute covariance of centered Y, take smallest eigenvalue lambda_min.\n      Compare lambda_min to sigma^2 * chi2_quantile(q, df=T-1) / (T-1).\n      If lambda_min = threshold, declare invariant present (True), else False.\n    \"\"\"\n    T = Y.shape[0]\n    # Center Y column-wise\n    Y_centered = Y - Y.mean(axis=0, keepdims=True)\n    # Sample covariance\n    Cov = (Y_centered.T @ Y_centered) / (T - 1)\n    # Smallest eigenvalue\n    evals = np.linalg.eigvalsh(Cov)\n    lambda_min = evals[0]\n    # Threshold from chi-square quantile\n    threshold = (sigma ** 2) * (chi2.ppf(q, df=T - 1) / (T - 1))\n    return lambda_min = threshold\n\ndef solve():\n    # Fixed random seed for reproducibility\n    rng = np.random.default_rng(0)\n\n    # Reaction rate constants and initial condition as specified\n    rates = (0.5, 0.3, 0.4, 0.2, 0.05, 0.01)\n    x0 = np.array([5.0, 1.0, 0.0, 9.0], dtype=float)\n\n    # Define test cases: (observed_indices, sigma, T, t_end)\n    test_cases = [\n        ([0, 2], 0.001, 1001, 40.0),   # Expect invariant (A + C)\n        ([1, 3], 0.005, 1001, 40.0),   # Expect invariant (B + D)\n        ([0, 1], 0.0001, 1001, 40.0),  # No invariant on A,B\n        ([2, 3], 0.0001, 1001, 40.0),  # No invariant on C,D\n        ([0],    0.0001, 1001, 40.0),  # Single species A not invariant alone\n    ]\n\n    results = []\n    for obs_idx, sigma, T, t_end in test_cases:\n        # Simulate network\n        t, X = simulate_reaction_network(T, t_end, x0, rates)\n        # Observations: select species\n        Y = X[:, obs_idx]\n        # Add i.i.d. Gaussian noise with known sigma\n        noise = rng.normal(loc=0.0, scale=sigma, size=Y.shape)\n        Y_noisy = Y + noise\n        # Detect invariant\n        decision = detect_linear_invariant(Y_noisy, sigma, q=0.95)\n        results.append(decision)\n\n    # Print results in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3296856"}]}