{"hands_on_practices": [{"introduction": "为了理解适应度景观，我们首先必须学习如何从其基本组成部分——基因效应——来构建它。这个练习提供了一个具体的方法，让我们看到单个基因的加性效应和基因间的上位性相互作用是如何共同塑造景观的拓扑结构。通过计算一个简单的三位点系统的所有基因型适应度，并识别其局部最适点，我们可以亲手体验到景观崎岖性的来源 [@problem_id:3307467]。", "problem": "考虑一个演化系统生物学中的二元基因型适应度景观，该景观有三个位点，每个位点可以处于参考状态 $0$ 或突变状态 $1$。设基因型由向量 $\\boldsymbol{x} = (x_{1}, x_{2}, x_{3}) \\in \\{0,1\\}^{3}$ 表示，适应度被建模为马尔萨斯适应度（对数适应度），由一个加性与成对上位性模型定义\n$$\nF(\\boldsymbol{x}) = a_{1} x_{1} + a_{2} x_{2} + a_{3} x_{3} + e_{12} x_{1} x_{2} + e_{13} x_{1} x_{3} + e_{23} x_{2} x_{3}.\n$$\n该模型是适应度景观中对上位性的标准表示，其中 $a_{i}$ 是每个位点的加性贡献，$e_{ij}$ 捕捉了成对上位性相互作用。两个基因型之间的汉明距离 $d_{H}(\\boldsymbol{x}, \\boldsymbol{y})$ 定义为 $\\boldsymbol{x}$ 和 $\\boldsymbol{y}$ 之间不同位点的数量，$\\boldsymbol{x}$ 的汉明邻居是任何满足 $d_{H}(\\boldsymbol{x}, \\boldsymbol{y}) = 1$ 的基因型 $\\boldsymbol{y}$。局部最大值是一个基因型 $\\boldsymbol{x}$，满足对于其所有汉明邻居 $\\boldsymbol{y}$ 都有 $F(\\boldsymbol{x}) > F(\\boldsymbol{y})$；适应度相等的情况不被视为局部最大值。\n\n使用以下参数值构建具有加性项和成对上位性项的最小三位点景观：\n$$\na_{1} = 0.4,\\quad a_{2} = -0.3,\\quad a_{3} = 0.9,\\quad e_{12} = 0.8,\\quad e_{13} = -0.7,\\quad e_{23} = -0.4.\n$$\n枚举所有基因型，计算它们的适应度值 $F(\\boldsymbol{x})$，并根据上述汉明邻域定义确定所有局部最大值。用其整数索引标记每个基因型\n$$\nI(\\boldsymbol{x}) = 4 x_{1} + 2 x_{2} + x_{3},\n$$\n即，通过其二进制值 $x_{1} x_{2} x_{3}$，其中 $x_{1}$ 为最高有效位。将局部最大值的索引集合表示为按升序排列的行矩阵。无需四舍五入，也无物理单位。", "solution": "首先验证问题，以确保其具有科学依据、是良定的和客观的。\n\n### 步骤1：提取给定条件\n-   基因型空间：$\\boldsymbol{x} = (x_{1}, x_{2}, x_{3}) \\in \\{0,1\\}^{3}$。\n-   适应度函数：$F(\\boldsymbol{x}) = a_{1} x_{1} + a_{2} x_{2} + a_{3} x_{3} + e_{12} x_{1} x_{2} + e_{13} x_{1} x_{3} + e_{23} x_{2} x_{3}$。\n-   参数值：$a_{1} = 0.4$, $a_{2} = -0.3$, $a_{3} = 0.9$, $e_{12} = 0.8$, $e_{13} = -0.7$, $e_{23} = -0.4$。\n-   邻域定义：$\\boldsymbol{x}$ 的汉明邻居是任何满足汉明距离 $d_{H}(\\boldsymbol{x}, \\boldsymbol{y}) = 1$ 的基因型 $\\boldsymbol{y}$。\n-   局部最大值定义：一个基因型 $\\boldsymbol{x}$ 是局部最大值，如果对于其所有汉明邻居 $\\boldsymbol{y}$ 都有 $F(\\boldsymbol{x}) > F(\\boldsymbol{y})$。适应度相等的情况不被视为局部最大值。\n-   基因型索引：$I(\\boldsymbol{x}) = 4 x_{1} + 2 x_{2} + x_{3}$。\n-   目标：找到所有局部最大值的索引，并将其表示为按升序排列的行矩阵。\n\n### 步骤2：使用提取的给定条件进行验证\n该问题具有科学依据，因为它使用了适应度景观的标准加性与成对上位性模型，这是演化系统生物学中一个成熟的概念。该问题是良定的：基因型空间是有限的，适应度函数及其参数是明确定义的，并且识别局部最大值的标准是明确的。这确保了存在唯一且可计算的解。问题陈述是客观的，使用了形式化的数学语言。它是自洽的，为求解提供了所有必要的信息。计算是可行的，设置在逻辑上是一致的。\n\n### 步骤3：结论与行动\n该问题是有效的。下面提供详细的解决方案。\n\n具有指定参数的适应度函数为：\n$$\nF(x_1, x_2, x_3) = 0.4 x_{1} - 0.3 x_{2} + 0.9 x_{3} + 0.8 x_{1} x_{2} - 0.7 x_{1} x_{3} - 0.4 x_{2} x_{3}.\n$$\n我们必须枚举所有 $2^3 = 8$ 个基因型，计算它们的适应度值，然后对每个基因型检查局部最大值条件。\n\n基因型的索引从 $0$ 到 $7$。我们为每个基因型 $\\boldsymbol{x} = (x_1, x_2, x_3)$ 计算适应度 $F(\\boldsymbol{x})$。\n\n-   **基因型 0：** $\\boldsymbol{x} = (0,0,0)$，索引 $I = 0$。\n    $F(0,0,0) = 0.4(0) - 0.3(0) + 0.9(0) + 0.8(0)(0) - 0.7(0)(0) - 0.4(0)(0) = 0$。\n-   **基因型 1：** $\\boldsymbol{x} = (0,0,1)$，索引 $I = 1$。\n    $F(0,0,1) = 0.4(0) - 0.3(0) + 0.9(1) + 0.8(0)(0) - 0.7(0)(1) - 0.4(0)(1) = 0.9$。\n-   **基因型 2：** $\\boldsymbol{x} = (0,1,0)$，索引 $I = 2$。\n    $F(0,1,0) = 0.4(0) - 0.3(1) + 0.9(0) + 0.8(0)(1) - 0.7(0)(0) - 0.4(1)(0) = -0.3$。\n-   **基因型 3：** $\\boldsymbol{x} = (0,1,1)$，索引 $I = 3$。\n    $F(0,1,1) = 0.4(0) - 0.3(1) + 0.9(1) + 0.8(0)(1) - 0.7(0)(1) - 0.4(1)(1) = -0.3 + 0.9 - 0.4 = 0.2$。\n-   **基因型 4：** $\\boldsymbol{x} = (1,0,0)$，索引 $I = 4$。\n    $F(1,0,0) = 0.4(1) - 0.3(0) + 0.9(0) + 0.8(1)(0) - 0.7(1)(0) - 0.4(0)(0) = 0.4$。\n-   **基因型 5：** $\\boldsymbol{x} = (1,0,1)$，索引 $I = 5$。\n    $F(1,0,1) = 0.4(1) - 0.3(0) + 0.9(1) + 0.8(1)(0) - 0.7(1)(1) - 0.4(0)(1) = 0.4 + 0.9 - 0.7 = 0.6$。\n-   **基因型 6：** $\\boldsymbol{x} = (1,1,0)$，索引 $I = 6$。\n    $F(1,1,0) = 0.4(1) - 0.3(1) + 0.9(0) + 0.8(1)(1) - 0.7(1)(0) - 0.4(1)(0) = 0.4 - 0.3 + 0.8 = 0.9$。\n-   **基因型 7：** $\\boldsymbol{x} = (1,1,1)$，索引 $I = 7$。\n    $F(1,1,1) = 0.4(1) - 0.3(1) + 0.9(1) + 0.8(1)(1) - 0.7(1)(1) - 0.4(1)(1) = 0.4 - 0.3 + 0.9 + 0.8 - 0.7 - 0.4 = 0.7$。\n\n适应度值摘要（用 $F_I$ 表示索引为 $I$ 的适应度）：\n$F_0 = 0$；$F_1 = 0.9$；$F_2 = -0.3$；$F_3 = 0.2$；$F_4 = 0.4$；$F_5 = 0.6$；$F_6 = 0.9$；$F_7 = 0.7$。\n\n现在，我们检查每个基因型的局部最大值条件。\n\n-   **基因型 0 (0,0,0)：** $F_0=0$。邻居是 $(1,0,0)$, $(0,1,0)$, $(0,0,1)$ (索引 $4, 2, 1$）。它们的适应度值为 $F_4=0.4$, $F_2=-0.3$, $F_1=0.9$。因为 $F_0 \\ngtr F_4$ 且 $F_0 \\ngtr F_1$，所以它不是一个局部最大值。\n\n-   **基因型 1 (0,0,1)：** $F_1=0.9$。邻居是 $(1,0,1)$, $(0,1,1)$, $(0,0,0)$ (索引 $5, 3, 0$)。它们的适应度值为 $F_5=0.6$, $F_3=0.2$, $F_0=0$。我们检查 $F_1$ 是否严格大于所有邻居的适应度值：\n    -   $F_1 > F_5 \\implies 0.9 > 0.6$ (真)\n    -   $F_1 > F_3 \\implies 0.9 > 0.2$ (真)\n    -   $F_1 > F_0 \\implies 0.9 > 0$ (真)\n    所有条件均成立。索引为 $1$ 的基因型是局部最大值。\n\n-   **基因型 2 (0,1,0)：** $F_2=-0.3$。邻居是 $(1,1,0)$, $(0,0,0)$, $(0,1,1)$ (索引 $6, 0, 3$)。它们的适应度值为 $F_6=0.9$, $F_0=0$, $F_3=0.2$。因为 $F_2 \\ngtr F_6$，所以它不是一个局部最大值。\n\n-   **基因型 3 (0,1,1)：** $F_3=0.2$。邻居是 $(1,1,1)$, $(0,0,1)$, $(0,1,0)$ (索引 $7, 1, 2$)。它们的适应度值为 $F_7=0.7$, $F_1=0.9$, $F_2=-0.3$。因为 $F_3 \\ngtr F_7$ 且 $F_3 \\ngtr F_1$，所以它不是一个局部最大值。\n\n-   **基因型 4 (1,0,0)：** $F_4=0.4$。邻居是 $(0,0,0)$, $(1,1,0)$, $(1,0,1)$ (索引 $0, 6, 5$)。它们的适应度值为 $F_0=0$, $F_6=0.9$, $F_5=0.6$。因为 $F_4 \\ngtr F_6$ 且 $F_4 \\ngtr F_5$，所以它不是一个局部最大值。\n\n-   **基因型 5 (1,0,1)：** $F_5=0.6$。邻居是 $(0,0,1)$, $(1,1,1)$, $(1,0,0)$ (索引 $1, 7, 4$)。它们的适应度值为 $F_1=0.9$, $F_7=0.7$, $F_4=0.4$。因为 $F_5 \\ngtr F_1$ 且 $F_5 \\ngtr F_7$，所以它不是一个局部最大值。\n\n-   **基因型 6 (1,1,0)：** $F_6=0.9$。邻居是 $(0,1,0)$, $(1,0,0)$, $(1,1,1)$ (索引 $2, 4, 7$)。它们的适应度值为 $F_2=-0.3$, $F_4=0.4$, $F_7=0.7$。我们检查 $F_6$ 是否严格大于所有邻居的适应度值：\n    -   $F_6 > F_2 \\implies 0.9 > -0.3$ (真)\n    -   $F_6 > F_4 \\implies 0.9 > 0.4$ (真)\n    -   $F_6 > F_7 \\implies 0.9 > 0.7$ (真)\n    所有条件均成立。索引为 $6$ 的基因型是局部最大值。\n\n-   **基因型 7 (1,1,1)：** $F_7=0.7$。邻居是 $(0,1,1)$, $(1,0,1)$, $(1,1,0)$ (索引 $3, 5, 6$)。它们的适应度值为 $F_3=0.2$, $F_5=0.6$, $F_6=0.9$。因为 $F_7 \\ngtr F_6$，所以它不是一个局部最大值。\n\n被确定为局部最大值的基因型具有索引 $1$ 和 $6$。按升序排列，索引集合为 $\\{1, 6\\}$。这必须表示为一个行矩阵。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 & 6\n\\end{pmatrix}\n}\n$$", "id": "3307467"}, {"introduction": "在构建了适应度景观之后，我们来解决一个逆问题：如果我们有实验测得的一组适应度数据，我们如何量化其背后潜在的基因相互作用？本练习介绍了一种强大的数学工具——沃尔什-哈达玛变换（Walsh-Hadamard Transform），它能将复杂的适应度数据分解为一系列可解释的谱分量。通过这种方法，我们可以精确地计算出每个基因的独立效应、基因间的配对上位性乃至更高阶的相互作用强度 [@problem_id:3307521]。", "problem": "考虑一个二元三基因座基因型空间 $\\mathcal{G} = \\{0,1\\}^3$，其基因型表示为 $\\mathbf{b} = (b_1,b_2,b_3)$，以及一个无量纲适应度函数 $f: \\mathcal{G} \\to \\mathbb{R}$。在演化系统生物学中，适应度景观可以表示为超立方体上的一个函数，并使用 $\\{-1,1\\}^3$ 上的正交基分解为加性和上位性贡献。通过 $s_i = 2 b_i - 1$ 为每个基因座定义自旋变量 $s_i \\in \\{-1,1\\}$。基于自旋乘积的正交分解被称为沃尔什-哈达玛变换 (WHT)。从 $\\{0,1\\}^3$ 上适应度景观的基本定义、超立方体上特征函数的正交性以及映射 $\\mathbf{b} \\mapsto \\mathbf{s}$ 出发，执行分解，得到加性和上位性谱分量，并重构适应度函数 $f(s_1,s_2,s_3)$。\n\n观测到的适应度值为：\n- $f(0,0,0) = 4$,\n- $f(1,0,0) = 5$,\n- $f(0,1,0) = 6$,\n- $f(0,0,1) = 3$,\n- $f(1,1,0) = 9$,\n- $f(1,0,1) = 6$,\n- $f(0,1,1) = 7$,\n- $f(1,1,1) = 13$.\n\n仅使用上述指明的基本基，通过自旋表示上的WHT量化加性、成对上位性和三阶上位性系数，并将适应度函数重构为关于 $s_1, s_2, s_3$ 的多项式。将您最终重构的适应度函数 $f(s_1,s_2,s_3)$ 表示为具有精确有理数系数的单一闭式解析表达式。无需四舍五入。将最终答案报告为关于 $s_1, s_2, s_3$ 的显式多项式。", "solution": "用户希望我解决这个问题。\n\n### 步骤 1：问题验证\n\n**1.1. 提取已知条件：**\n\n-   **基因型空间：** 一个二元三基因座基因型空间 $\\mathcal{G} = \\{0,1\\}^3$。基因型表示为 $\\mathbf{b} = (b_1,b_2,b_3)$。\n-   **适应度函数：** 一个无量纲适应度函数 $f: \\mathcal{G} \\to \\mathbb{R}$。\n-   **自旋变量映射：** 自旋变量 $s_i \\in \\{-1,1\\}$ 由二元等位基因 $b_i \\in \\{0,1\\}$ 通过映射 $s_i = 2 b_i - 1$ 定义。\n-   **分解方法：** 超立方体 $\\{-1,1\\}^3$ 上的适应度函数将使用自旋乘积的正交基分解为加性和上位性贡献，这对应于沃尔什-哈达玛变换 (WHT)。\n-   **任务：** 量化加性、成对上位性和三阶上位性系数。将适应度函数 $f(s_1,s_2,s_3)$ 重构为自旋变量的多项式。\n-   **观测到的适应度数据：**\n    -   $f(0,0,0) = 4$\n    -   $f(1,0,0) = 5$\n    -   $f(0,1,0) = 6$\n    -   $f(0,0,1) = 3$\n    -   $f(1,1,0) = 9$\n    -   $f(1,0,1) = 6$\n    -   $f(0,1,1) = 7$\n    -   $f(1,1,1) = 13$\n-   **最终答案格式：** 具有精确有理数系数的 $f(s_1,s_2,s_3)$ 的单一闭式解析表达式。\n\n**1.2. 使用提取的已知条件进行验证：**\n\n-   **科学依据：** 该问题是演化系统生物学领域的一个标准练习，特别涉及适应度景观的分析。使用沃尔什-哈达玛变换将超立方体上的函数分解为其谱分量（加性和上位性效应）是一种成熟且基础的技术。该问题在科学上是合理的，并且表述正确。\n-   **良态性：** 该问题提供了一套完整的数据（对于 $2^3 = 8$ 种可能的基因型，有 $8$ 个适应度值）。有限群上的沃尔什-哈达玛变换是一种定义明确的线性变换，可产生一组唯一的系数。该问题没有歧义，并有唯一解。\n-   **客观性：** 问题陈述以精确、客观和标准的科学语言编写。没有主观或基于意见的内容。\n-   **完整性和一致性：** 提供了所有必要信息。已知条件中没有矛盾。\n-   **其他标准：** 该问题并非无足轻重，属于科学领域，可验证且结构良好。\n\n**1.3. 结论与行动：**\n\n该问题是**有效的**。将提供完整解答。\n\n### 步骤 2：解题\n\n该问题要求将定义在二元超立方体 $\\{0,1\\}^3$ 上的适应度函数分解为其上位性分量。这可以通过首先将函数映射到自旋超立方体 $\\{-1,1\\}^3$ 上，然后应用沃尔什-哈达玛变换来实现。\n\n首先，我们使用关系式 $s_i = 2b_i - 1$ 将二元基因型 $\\mathbf{b} = (b_1,b_2,b_3)$ 映射到自旋基因型 $\\mathbf{s} = (s_1,s_2,s_3)$。$b_i=0$ 的值映射到 $s_i=-1$，$b_i=1$ 的值映射到 $s_i=1$。我们列出每个对应自旋基因型的适应度值：\n-   $f(-1,-1,-1) = f(0,0,0) = 4$\n-   $f(1,-1,-1) = f(1,0,0) = 5$\n-   $f(-1,1,-1) = f(0,1,0) = 6$\n-   $f(-1,-1,1) = f(0,0,1) = 3$\n-   $f(1,1,-1) = f(1,1,0) = 9$\n-   $f(1,-1,1) = f(1,0,1) = 6$\n-   $f(-1,1,1) = f(0,1,1) = 7$\n-   $f(1,1,1) = f(1,1,1) = 13$\n\n适应度函数 $f(\\mathbf{s})$ 可以表示为自旋超立方体上正交基函数的线性组合。这些基函数是沃尔什函数，对于自旋表示法，它们是自旋变量的乘积。对于一个三基因座系统，这 $2^3=8$ 个基函数是 $\\chi_I(\\mathbf{s}) = \\prod_{i \\in I} s_i$，其中 $I$ 是 $\\{1,2,3\\}$ 的一个子集。该函数可以写作：\n\n$$\nf(s_1,s_2,s_3) = \\sum_{I \\subseteq \\{1,2,3\\}} w_I \\chi_I(s_1,s_2,s_3)\n$$\n\n展开后为：\n$$\nf(s_1,s_2,s_3) = w_{\\emptyset} + w_{\\{1\\}}s_1 + w_{\\{2\\}}s_2 + w_{\\{3\\}}s_3 + w_{\\{1,2\\}}s_1s_2 + w_{\\{1,3\\}}s_1s_3 + w_{\\{2,3\\}}s_2s_3 + w_{\\{1,2,3\\}}s_1s_2s_3\n$$\n为简便起见，我们将 $w_{\\emptyset}$ 表示为 $w_0$，$w_{\\{i\\}}$ 表示为 $w_i$，$w_{\\{i,j\\}}$ 表示为 $w_{ij}$，$w_{\\{1,2,3\\}}$ 表示为 $w_{123}$。\n\n系数 $w_I$ 是函数 $f$ 在基函数 $\\chi_I$ 上的投影。它们使用超立方体上函数空间的内积计算，该内积定义为 $\\langle g_1, g_2 \\rangle = \\frac{1}{2^3} \\sum_{\\mathbf{s} \\in \\{-1,1\\}^3} g_1(\\mathbf{s})g_2(\\mathbf{s})$。由于沃尔什函数的正交性，系数由下式给出：\n\n$$\nw_I = \\langle f, \\chi_I \\rangle = \\frac{1}{8} \\sum_{\\mathbf{s} \\in \\{-1,1\\}^3} f(\\mathbf{s}) \\chi_I(\\mathbf{s})\n$$\n\n我们现在计算这 8 个系数中的每一个。我们按字典序对 $\\mathbf{s}$ 进行求和：$(-1,-1,-1), (-1,-1,1), \\dots, (1,1,1)$。对应的适应度值为 $(4, 3, 6, 7, 5, 6, 9, 13)$。\n\n-   **平均适应度 ($w_0$)：**\n    $w_0 = \\frac{1}{8} \\sum f(\\mathbf{s}) = \\frac{1}{8}(4+3+6+7+5+6+9+13) = \\frac{53}{8}$。\n\n-   **加性效应 ($w_1, w_2, w_3$)：**\n    $w_1 = \\frac{1}{8} \\sum f(\\mathbf{s})s_1 = \\frac{1}{8}(-4-3-6-7+5+6+9+13) = \\frac{13}{8}$。\n    $w_2 = \\frac{1}{8} \\sum f(\\mathbf{s})s_2 = \\frac{1}{8}(-4-3+6+7-5-6+9+13) = \\frac{17}{8}$。\n    $w_3 = \\frac{1}{8} \\sum f(\\mathbf{s})s_3 = \\frac{1}{8}(-4+3-6+7-5+6-9+13) = \\frac{5}{8}$。\n\n-   **成对上位性效应 ($w_{12}, w_{13}, w_{23}$):**\n    $w_{12} = \\frac{1}{8} \\sum f(\\mathbf{s})s_1s_2 = \\frac{1}{8}(+4+3-6-7-5-6+9+13) = \\frac{5}{8}$。\n    $w_{13} = \\frac{1}{8} \\sum f(\\mathbf{s})s_1s_3 = \\frac{1}{8}(+4-3+6-7-5+6-9+13) = \\frac{5}{8}$。\n    $w_{23} = \\frac{1}{8} \\sum f(\\mathbf{s})s_2s_3 = \\frac{1}{8}(+4-3-6+7+5-6-9+13) = \\frac{5}{8}$。\n\n-   **三阶上位性效应 ($w_{123}$):**\n    $w_{123} = \\frac{1}{8} \\sum f(\\mathbf{s})s_1s_2s_3 = \\frac{1}{8}(-4+3+6-7+5-6-9+13) = \\frac{1}{8}$。\n\n计算出所有系数后，我们可以将适应度函数重构为关于 $s_1, s_2, s_3$ 的多项式：\n$$\nf(s_1,s_2,s_3) = w_0 + w_1 s_1 + w_2 s_2 + w_3 s_3 + w_{12} s_1 s_2 + w_{13} s_1 s_3 + w_{23} s_2 s_3 + w_{123} s_1 s_2 s_3\n$$\n代入计算出的值：\n$$\nf(s_1,s_2,s_3) = \\frac{53}{8} + \\frac{13}{8} s_1 + \\frac{17}{8} s_2 + \\frac{5}{8} s_3 + \\frac{5}{8} s_1 s_2 + \\frac{5}{8} s_1 s_3 + \\frac{5}{8} s_2 s_3 + \\frac{1}{8} s_1 s_2 s_3\n$$\n这可以写成更紧凑的形式：\n$$\nf(s_1,s_2,s_3) = \\frac{1}{8} (53 + 13 s_1 + 17 s_2 + 5 s_3 + 5 s_1 s_2 + 5 s_1 s_3 + 5 s_2 s_3 + s_1 s_2 s_3)\n$$\n这就是所要求的、具有精确有理数系数的重构适应度函数的闭式解析表达式。\n\n我们可以通过代入一个点来验证这个结果，例如 $\\mathbf{s}=(1,1,1)$：\n$$\nf(1,1,1) = \\frac{1}{8}(53+13+17+5+5+5+5+1) = \\frac{104}{8} = 13.\n$$\n这与给定的值 $f(1,1,1)=13$ 相匹配。\n对 $\\mathbf{s}=(-1,-1,-1)$ 进行另一次检验：\n$$\nf(-1,-1,-1) = \\frac{1}{8}(53-13-17-5+5+5+5-1) = \\frac{1}{8}(53-35+15-1) = \\frac{32}{8} = 4.\n$$\n这也与给定的值 $f(0,0,0)=4$ 相匹配，证实了系数的正确性。", "answer": "$$\n\\boxed{\\frac{53}{8} + \\frac{13}{8} s_1 + \\frac{17}{8} s_2 + \\frac{5}{8} s_3 + \\frac{5}{8} s_1 s_2 + \\frac{5}{8} s_1 s_3 + \\frac{5}{8} s_2 s_3 + \\frac{1}{8} s_1 s_2 s_3}\n$$", "id": "3307521"}, {"introduction": "掌握了如何构建和分析静态的适应度景观后，我们转向一个更具动态性的核心问题：景观的结构如何影响进化路径？这个计算练习将引导我们探索“进化可达性”这一概念，研究不同类型的上位性（如符号上位性）如何塑造崎岖的景观，从而可能将种群困在局部最适点，或者引导其走向全局最优。通过在一个具有特定上位性模式的景观集合上进行蒙特卡洛模拟，我们可以定量地洞察进化的可预测性问题 [@problem_id:3307506]。", "problem": "给定一个双等位基因、四基因座的基因型空间，该空间被建模为维度为 $4$ 的超立方体的顶点。每个基因型由一个二进制向量 $x \\in \\{0,1\\}^4$ 表示，其中 $x_i = 1$ 表示基因座 $i$ 上的衍生等位基因，$x_i = 0$ 表示祖先等位基因。适应度景观是一个映射 $w: \\{0,1\\}^4 \\to \\mathbb{R}$。从野生型 $0000$ 到全1基因型 $1111$ 的一条严格适应度递增路径是一个由 $5$ 个基因型组成的序列 $(g_0,g_1,g_2,g_3,g_4)$，使得 $g_0 = 0000$，$g_4 = 1111$，每个 $g_{k+1}$ 与 $g_k$ 的区别在于将一个 $0$ 翻转为 $1$，并且对于所有 $k \\in \\{0,1,2,3\\}$ 都有 $w(g_{k+1}) - w(g_k) > 0$。总共有 $4! = 24$ 种这样的单调突变顺序。如果至少存在一条到达 $1111$ 的这样的路径，我们就说全局最优解是可以通过严格适应度递增路径到达的。\n\n我们考虑一个 $w(x)$ 的参数模型，在该模型中，两两双基因座上位性受到控制，同时保证 $1111$ 是全局最大值。具体来说，令\n$$\nw(x) = \\sum_{i=0}^3 a_i x_i + \\sum_{0 \\le i  j \\le 3} b_{ij} x_i x_j + c \\prod_{k=0}^3 x_k,\n$$\n其中 $c$ 固定为一个正常数，以确保 $1111$ 是全局最优。$a_i$ 和 $b_{ij}$ 是从连续分布中抽取的随机变量，这些分布受到约束，以便在所有其他基因座处于祖先状态时，在每个双基因座面上实现预设的成对符号上位性定性模式。对于给定的基因座对 $(i,j)$，当其他基因座设置为 $0$ 时，双基因座适应度为\n$w(00)=0$, $w(10)=a_i$, $w(01)=a_j$, $w(11)=a_i + a_j + b_{ij}$。\n将在基因背景 $x_j=0$ 和 $x_j=1$ 上于基因座 $i$ 处发生突变的边际效应分别定义为 $\\Delta_i^{(0)} = a_i$ 和 $\\Delta_i^{(1)} = a_i + b_{ij}$。基因座对 $(i,j)$ 上的定性上位性类别定义如下：\n- 无符号上位性（“none”）：$a_i(a_i + b_{ij})  0$ 且 $a_j(a_j + b_{ij})  0$。\n- 符号上位性（“sign”）：$a_i(a_i + b_{ij})  0$ 或 $a_j(a_j + b_{ij})  0$ 中恰好一个成立。\n- 互反符号上位性（“reciprocal”）：$a_i(a_i + b_{ij})  0$ 和 $a_j(a_j + b_{ij})  0$ 两者皆成立。\n\n我们采用以下生成方案来计算在所有 $\\binom{4}{2} = 6$ 个基因座对上指定成对上位性模式下，$1111$ 可通过严格适应度递增路径到达的概率：\n1. 独立抽取主效应 $a_i \\sim \\mathrm{Uniform}(0.2, 0.8)$，其中 $i \\in \\{0,1,2,3\\}$。这些抽样保证 $a_i > 0$。\n2. 对于每个无序对 $(i,j)$，从一个连续均匀分布中抽取一个相互作用 $b_{ij}$，该分布的区间强制执行所要求的上位性类别（当其他基因座固定为 $0$ 时）：\n   - 如果类别是“none”，则从 $( -\\min(a_i,a_j), 1 )$ 中均匀采样 $b_{ij}$。\n   - 如果类别是“sign”，则从 $( -\\max(a_i,a_j), -\\min(a_i,a_j) )$ 中均匀采样 $b_{ij}$。\n   - 如果类别是“reciprocal”，则从 $( -1, -\\max(a_i,a_j) )$ 中均匀采样 $b_{ij}$。\n   在所有情况下，也设置 $b_{ji} = b_{ij}$ 和 $b_{ii} = 0$。\n3. 固定 $c = 10$，以便对于上述范围内的任何 $(a,b)$，$w(1111)$ 都超过其他所有 $15$ 个基因型。\n\n给定所有 $6$ 个基因座对上的定性上位性模式，我们将目标概率定义为通过上述程序生成的随机景观中，至少存在一条从 $0000$ 到 $1111$ 的严格递增路径的景观所占比例的蒙特卡洛（MC）极限。\n\n你的任务是实现一个程序，对于下面的每个测试用例，使用指定的伪随机种子执行 $N$ 次独立同分布的 $(a,b)$ 蒙特卡洛抽样，并估计可达性概率 $\\hat{p}$，即至少有一条严格适应度递增路径到达 $1111$ 的抽样比例。请精确使用上述模型。对于每个测试用例，返回 $\\hat{p}$ 作为浮点数，四舍五入到三位小数。最终输出必须是单行文本，包含所有测试用例的结果，形式为逗号分隔的列表，并用方括号括起来。\n\n测试套件规范。共有 $4$ 个测试用例。基因座索引为 $\\{0,1,2,3\\}$，基因座对按固定顺序排列：$\\{(0,1),(0,2),(0,3),(1,2),(1,3),(2,3)\\}$。每个测试用例是一个三元组：$(\\text{pattern}, N, \\text{seed})$，其中 pattern 是一个包含 $6$ 个字符串的列表，字符串来自 $\\{\\text{\"none\"}, \\text{\"sign\"}, \\text{\"reciprocal\"}\\}$。\n\n- 测试用例 1（理想情况，无任何符号上位性）：\n  - pattern $=$ $[\\text{\"none\"},\\text{\"none\"},\\text{\"none\"},\\text{\"none\"},\\text{\"none\"},\\text{\"none\"}]$\n  - $N = 10000$\n  - seed $= 1337$\n- 测试用例 2（单个符号上位性对）：\n  - pattern $=$ $[\\text{\"sign\"},\\text{\"none\"},\\text{\"none\"},\\text{\"none\"},\\text{\"none\"},\\text{\"none\"}]$\n  - $N = 10000$\n  - seed $= 4242$\n- 测试用例 3（单个互反符号上位性对）：\n  - pattern $=$ $[\\text{\"reciprocal\"},\\text{\"none\"},\\text{\"none\"},\\text{\"none\"},\\text{\"none\"},\\text{\"none\"}]$\n  - $N = 10000$\n  - seed $= 202311$\n- 测试用例 4（三个形成链的互反符号对）：\n  - pattern $=$ $[\\text{\"reciprocal\"},\\text{\"none\"},\\text{\"none\"},\\text{\"reciprocal\"},\\text{\"none\"},\\text{\"reciprocal\"}]$\n  - $N = 10000$\n  - seed $= 777$\n\n程序要求：\n- 精确实现上述生成模型，其中 $c = 10$，$a_i \\sim \\mathrm{Uniform}(0.2,0.8)$，且 $b_{ij}$ 从模式所隐含的开区间中抽取。\n- 完全按照定义计算所有 $16$ 个基因型 $x \\in \\{0,1\\}^4$ 的 $w(x)$。\n- 通过检查 $24$ 个单调突变顺序中是否有任何一个产生从 $0000$ 到 $1111$ 的严格递增适应度序列来确定可达性。\n- 对于每个测试用例，估计 $\\hat{p}$ 为一个在 $[0,1]$ 区间内的浮点数，并四舍五入到三位小数。\n- 最终输出格式：单行文本，包含四个结果，形式为逗号分隔的列表并用方括号括起来，例如 $[\\hat{p}_1,\\hat{p}_2,\\hat{p}_3,\\hat{p}_4]$，每个 $\\hat{p}_k$ 都四舍五入到三位小数。不应打印任何额外文本。\n\n不涉及物理单位。所有概率必须以 $[0,1]$ 区间内的小数形式报告。", "solution": "用户提供的问题陈述是有效的。它在计算进化生物学领域有科学依据，在数学上是适定的，并为数值模拟提供了完整、明确的规范。所有必要的参数、分布、定义和程序都已明确定义，构成一个自洽且可解的问题。没有矛盾、事实错误或主观元素。\n\n该问题要求估计一个4基因座系统的全局适应度最优解通过严格适应度递增路径可达的概率。这是适应度景观研究中的一个经典问题。解决方案涉及基于所提供的精确生成模型进行的蒙特卡洛模拟。\n\n一个基因型由一个二进制向量 $x = (x_0, x_1, x_2, x_3) \\in \\{0,1\\}^4$ 表示。适应度 $w(x)$ 由以下函数给出：\n$$\nw(x) = \\sum_{i=0}^3 a_i x_i + \\sum_{0 \\le i  j \\le 3} b_{ij} x_i x_j + c \\prod_{k=0}^3 x_k\n$$\n该函数包括来自单个基因座的加性效应（$a_i$ 项）、成对的上位性相互作用（$b_{ij}$ 项）以及一个系数为 $c$ 的四阶相互作用项。所提供的问题陈述在乘积项中有一个小的印刷错误，写为 $x_1 x_2 x_3 x_4$，使用了基于1的基因座索引，但上下文暗示了一个与测试套件规范中得出的基于0的索引一致的4基因座模型。正确的解释，与4基因座相互作用一致，是 $x$ 的所有四个分量的乘积。\n\n问题的核心是确定从野生型 $0000$ 到基因型 $1111$ 的可达性。从 $0000$ 到 $1111$ 的路径是一系列4次突变，每次突变将一个 $0$ 翻转为 $1$。这些突变发生的顺序定义了一条特定的路径。总共有 $4! = 24$ 种这样独特的顺序或路径。一条路径 $(g_0, g_1, g_2, g_3, g_4)$，其中 $g_0=0000$，如果对于所有 $k \\in \\{0, 1, 2, 3\\}$ 都有 $w(g_{k+1})  w(g_k)$，则该路径是严格适应度递增的。如果这 $24$ 条路径中至少有一条是严格适应度递增的，则认为全局最优解 $1111$ 是可达的。\n\n我们将编写一个程序，以估计不同成对上位性情景下的可达性概率 $\\hat{p}$。该估计是通过对每个测试用例进行 $N$ 次试验的蒙特卡洛模拟来执行的。每次试验包括以下步骤：\n\n1.  **景观生成**：通过对参数 $a_i$ 和 $b_{ij}$ 进行采样来生成一个随机的适应度景观。为保证可复现性，随机数生成器将被设定种子。\n    -   主效应 $a_i$ 对于 $i \\in \\{0,1,2,3\\}$ 从 $\\mathrm{Uniform}(0.2, 0.8)$ 中独立抽取。\n    -   $\\binom{4}{2}=6$ 对中的每一对的上位性系数 $b_{ij}$ 从特定的均匀分布中抽取。每个 $b_{ij}$ 的区间取决于预先指定的定性上位性类别（“none”、“sign”或“reciprocal”）以及相应的主效应值 $a_i$ 和 $a_j$。\n    -   最高阶项的系数固定为 $c=10$。\n\n2.  **适应度计算**：对于生成的景观，计算并存储所有 $2^4 = 16$ 个基因型的适应度值 $w(x)$。基因型可以高效地表示为从 $0$（代表 $0000$）到 $15$（代表 $1111$）的整数，其中整数是二进制基因型字符串的十进制表示。\n\n3.  **可达性检查**：检查所有 $24$ 条可能的突变路径。\n    -   每条路径对应于基因座索引 $\\{0, 1, 2, 3\\}$ 的一个排列。对于一个排列 $(\\pi_0, \\pi_1, \\pi_2, \\pi_3)$，基因型路径为 $g_0 = 0000$，$g_1$（在基因座 $\\pi_0$ 上突变），$g_2$（在 $g_1$ 的基础上于基因座 $\\pi_1$ 上突变），依此类推。\n    -   对于每条路径，通过比较预先计算的适应度值来检查所有 $4$ 个突变步骤是否都是适应度递增的。\n    -   如果找到一条严格递增的路径，则该景观被标记为“可达”，并终止对当前景观的检查（因为只需要一条这样的路径）。\n\n4.  **概率估计**：在 $N$ 次试验后，估计的概率 $\\hat{p}$ 计算为可达景观数与总试验次数 $N$ 的比率。然后将该值按要求四舍五入到三位小数。\n\n对问题中指定的每个测试用例重复此过程，得出一系列估计的概率。实现将使用 `numpy` 进行数值运算，使用 `itertools` 生成排列和组合。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom itertools import permutations, combinations\n\ndef has_accessible_path(fitness_values):\n    \"\"\"\n    Checks if at least one strictly increasing path exists from 0000 to 1111.\n\n    Args:\n        fitness_values: A numpy array of 16 fitness values, indexed by genotype integer.\n\n    Returns:\n        True if an accessible path exists, False otherwise.\n    \"\"\"\n    # A path is a permutation of the 4 loci to be mutated.\n    for path_order in permutations(range(4)):\n        current_g_int = 0\n        is_path_accessible = True\n        for i in range(4):\n            locus_to_mutate = path_order[i]\n            # Flip the bit for the locus to mutate\n            next_g_int = current_g_int | (1  locus_to_mutate)\n            \n            # Check for strictly increasing fitness\n            if fitness_values[next_g_int] = fitness_values[current_g_int]:\n                is_path_accessible = False\n                break\n            current_g_int = next_g_int\n        \n        if is_path_accessible:\n            return True\n            \n    return False\n\ndef estimate_accessibility_probability(pattern, N, seed):\n    \"\"\"\n    Estimates the accessibility probability for a given epistasis pattern.\n\n    Args:\n        pattern: A list of 6 strings specifying the epistasis class for each pair.\n        N: The number of Monte Carlo samples.\n        seed: The seed for the random number generator.\n\n    Returns:\n        The estimated probability, rounded to 3 decimal places.\n    \"\"\"\n    rng = np.random.default_rng(seed)\n    # Pairs are in lexicographical order: (0,1), (0,2), (0,3), (1,2), (1,3), (2,3)\n    pairs = list(combinations(range(4), 2))\n    \n    accessible_count = 0\n    c = 10.0\n\n    for _ in range(N):\n        # 1. Generate landscape parameters\n        a = rng.uniform(0.2, 0.8, size=4)\n        B = np.zeros((4, 4))\n        \n        for k, (i, j) in enumerate(pairs):\n            ep_type = pattern[k]\n            ai, aj = a[i], a[j]\n            min_a, max_a = min(ai, aj), max(ai, aj)\n            \n            if ep_type == \"none\":\n                low, high = -min_a, 1.0\n            elif ep_type == \"sign\":\n                low, high = -max_a, -min_a\n            else:  # \"reciprocal\"\n                low, high = -1.0, -max_a\n                \n            bij = rng.uniform(low, high)\n            B[i, j] = B[j, i] = bij\n            \n        # 2. Calculate fitness for all 16 genotypes\n        fitness_values = np.zeros(16)\n        for g_int in range(16):\n            # Convert integer to binary vector representation\n            x = np.array([(g_int  i)  1 for i in range(4)], dtype=np.int8)\n            \n            term1 = np.dot(a, x)\n            \n            term2 = 0.0\n            for i_idx in range(4):\n                for j_idx in range(i_idx + 1, 4):\n                    term2 += B[i_idx, j_idx] * x[i_idx] * x[j_idx]\n            \n            # The original problem statement had a typo with 1-based indexing\n            # The correct 4th-order term for 0-indexed loci is product of all x_k\n            term3 = c * np.prod(x)\n            \n            fitness_values[g_int] = term1 + term2 + term3\n\n        # 3. Check for accessibility\n        if has_accessible_path(fitness_values):\n            accessible_count += 1\n            \n    probability = accessible_count / N\n    return round(probability, 3)\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # Test case 1\n        ([\"none\", \"none\", \"none\", \"none\", \"none\", \"none\"], 10000, 1337),\n        # Test case 2\n        ([\"sign\", \"none\", \"none\", \"none\", \"none\", \"none\"], 10000, 4242),\n        # Test case 3\n        ([\"reciprocal\", \"none\", \"none\", \"none\", \"none\", \"none\"], 10000, 202311),\n        # Test case 4\n        ([\"reciprocal\", \"none\", \"none\", \"reciprocal\", \"none\", \"reciprocal\"], 10000, 777)\n    ]\n\n    results = []\n    for pattern, N, seed in test_cases:\n        p_hat = estimate_accessibility_probability(pattern, N, seed)\n        results.append(p_hat)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3307506"}]}