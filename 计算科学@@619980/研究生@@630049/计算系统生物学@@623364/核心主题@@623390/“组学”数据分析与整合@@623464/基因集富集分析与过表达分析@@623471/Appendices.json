{"hands_on_practices": [{"introduction": "要真正掌握基因集富集分析（GSEA），理解其核心算法是至关重要的一步。这个练习旨在揭开GSEA中“移动加权统计量”（running-sum statistic）的神秘面纱，通过一个小型、可管理的数据集，引导你逐步完成富集分数（Enrichment Score, ES）的计算。通过这个动手过程，你不仅能明白ES是如何量化基因集在排序列表顶端或底端的富集程度，还能识别出驱动富集信号的关键基因——即“领先边”（leading-edge）子集 [@problem_id:3315251]。", "problem": "考虑基因集富集分析 (GSEA)，该方法评估一个预定义的基因集中的成员是否非随机地分布在一个排序后的全基因组列表的两端。GSEA 中的富集分数 (ES) 是通过一个沿着排序列表构建的、类似柯尔莫哥洛夫-斯米尔诺夫检验的运行总和统计量来定义的：当遇到集合中的基因时，分数增加；当遇到不在集合中的基因时，分数减少。其中，命中的增量由基因水平的统计量加权，而未命中的减量则被选择以平衡整个过程。\n\n给定一个长度为 $N$ 的示例排序列表 $\\mathcal{L}$，由有序的基因-统计量对组成：\n$$\\mathcal{L} = \\big[(g_1, r_1), (g_2, r_2), \\dots, (g_{10}, r_{10})\\big],$$\n该列表已按 $|r_i|$ 的降序排列。绝对基因水平统计量为：\n$$|r_1| = 4.0,\\ |r_2| = 3.0,\\ |r_3| = 2.5,\\ |r_4| = 2.2,\\ |r_5| = 2.0,\\ |r_6| = 1.5,\\ |r_7| = 1.2,\\ |r_8| = 1.0,\\ |r_9| = 1.0,\\ |r_{10}| = 0.8.$$\n一个大小为 $K$ 的小基因集 $\\mathcal{S}$ 定义为：\n$$\\mathcal{S} = \\{g_2,\\ g_5,\\ g_9\\},\\quad K = 3,\\quad N = 10.$$\n\n假设使用加权 GSEA 运行总和统计量，指数参数 $\\alpha = 1$，并遵循以下基于标准 GSEA 定义的归一化规则：当位置 $i$ 是一个命中（$g_i \\in \\mathcal{S}$）时，运行总和增加归一化的命中权重 $\\frac{|r_i|^{\\alpha}}{\\sum_{g_j \\in \\mathcal{S}} |r_j|^{\\alpha}}$；当位置 $i$ 是一个未命中（$g_i \\notin \\mathcal{S}$）时，运行总和减少 $\\frac{1}{N-K}$。运行总和从 $0$ 开始，并从 $i = 1$ 到 $i = N$ 顺序更新。\n\n任务：\n- 使用上述规则，计算富集分数 (ES)，即运行总和沿 $\\mathcal{L}$ 达到的离 $0$ 的最大偏差。\n- 识别前导子集 (leading-edge subset)，该子集定义为在达到 ES 的位置（含该位置）之前遇到的、属于 $\\mathcal{S}$ 的基因所组成的子集。\n\n答案规格：\n- 以单个精确的有理数形式报告 ES，不进行四舍五入。\n- 无需单位。", "solution": "问题陈述已经过验证，被认为是合理、适定且基于计算系统生物学原理的。它提供了完整且一致的数据和规则集以执行所要求的计算。\n\n任务是为一个给定的基因集 $\\mathcal{S}$ 和一个排序的基因列表 $\\mathcal{L}$ 计算富集分数 (ES) 并识别前导子集。该分析基于加权的基因集富集分析 (GSEA) 运行总和统计量。\n\n首先，我们从问题描述中确定参数。排序列表中的基因总数为 $N=10$。目标基因集为 $\\mathcal{S} = \\{g_2, g_5, g_9\\}$，其大小为 $K=3$。用于加权的指数参数为 $\\alpha=1$。\n\n运行总和的计算需要识别排序列表中的哪些基因是“命中”（$\\mathcal{S}$ 的成员）以及哪些是“未命中”（非 $\\mathcal{S}$ 的成员）。\n基因集为 $\\mathcal{S} = \\{g_2, g_5, g_9\\}$。沿着排序列表 $\\mathcal{L}$（从 $i=1$ 到 $i=10$）的命中和未命中序列如下：\n- $i=1$: $g_1 \\notin \\mathcal{S}$ (未命中)\n- $i=2$: $g_2 \\in \\mathcal{S}$ (命中)\n- $i=3$: $g_3 \\notin \\mathcal{S}$ (未命中)\n- $i=4$: $g_4 \\notin \\mathcal{S}$ (未命中)\n- $i=5$: $g_5 \\in \\mathcal{S}$ (命中)\n- $i=6$: $g_6 \\notin \\mathcal{S}$ (未命中)\n- $i=7$: $g_7 \\notin \\mathcal{S}$ (未命中)\n- $i=8$: $g_8 \\notin \\mathcal{S}$ (未命中)\n- $i=9$: $g_9 \\in \\mathcal{S}$ (命中)\n- $i=10$: $g_{10} \\notin \\mathcal{S}$ (未命中)\n\n共有 $K=3$ 次命中和 $N-K=7$ 次未命中。\n\n接下来，我们计算运行总和的步长。\n对于一次命中，增量由 $\\frac{|r_i|^{\\alpha}}{\\sum_{g_j \\in \\mathcal{S}} |r_j|^{\\alpha}}$ 给出。当 $\\alpha=1$ 时，这变为 $\\frac{|r_i|}{\\sum_{g_j \\in \\mathcal{S}} |r_j|}$。\n我们来计算 $\\mathcal{S}$ 中基因的总权重，也就是命中增量的分母：\n$$ W_{\\mathcal{S}} = \\sum_{g_j \\in \\mathcal{S}} |r_j| = |r_2| + |r_5| + |r_9| $$\n使用给定的值 $|r_2|=3.0$、 $|r_5|=2.0$ 和 $|r_9|=1.0$：\n$$ W_{\\mathcal{S}} = 3.0 + 2.0 + 1.0 = 6.0 $$\n命中的增量为：\n- 对于 $i=2$ 处的 $g_2$：$\\frac{|r_2|}{W_{\\mathcal{S}}} = \\frac{3.0}{6.0} = \\frac{1}{2}$\n- 对于 $i=5$ 处的 $g_5$：$\\frac{|r_5|}{W_{\\mathcal{S}}} = \\frac{2.0}{6.0} = \\frac{1}{3}$\n- 对于 $i=9$ 处的 $g_9$：$\\frac{|r_9|}{W_{\\mathcal{S}}} = \\frac{1.0}{6.0} = \\frac{1}{6}$\n\n对于一次未命中，减量是一个常数：\n$$ \\text{Decrement} = \\frac{1}{N-K} = \\frac{1}{10-3} = \\frac{1}{7} $$\n\n现在，我们计算运行总和，记为 $S_i$，从 $S_0=0$ 开始。\n- $i=1$ (未命中): $S_1 = S_0 - \\frac{1}{7} = -\\frac{1}{7}$\n- $i=2$ (命中): $S_2 = S_1 + \\frac{1}{2} = -\\frac{1}{7} + \\frac{1}{2} = -\\frac{2}{14} + \\frac{7}{14} = \\frac{5}{14}$\n- $i=3$ (未命中): $S_3 = S_2 - \\frac{1}{7} = \\frac{5}{14} - \\frac{2}{14} = \\frac{3}{14}$\n- $i=4$ (未命中): $S_4 = S_3 - \\frac{1}{7} = \\frac{3}{14} - \\frac{2}{14} = \\frac{1}{14}$\n- $i=5$ (命中): $S_5 = S_4 + \\frac{1}{3} = \\frac{1}{14} + \\frac{1}{3} = \\frac{3}{42} + \\frac{14}{42} = \\frac{17}{42}$\n- $i=6$ (未命中): $S_6 = S_5 - \\frac{1}{7} = \\frac{17}{42} - \\frac{6}{42} = \\frac{11}{42}$\n- $i=7$ (未命中): $S_7 = S_6 - \\frac{1}{7} = \\frac{11}{42} - \\frac{6}{42} = \\frac{5}{42}$\n- $i=8$ (未命中): $S_8 = S_7 - \\frac{1}{7} = \\frac{5}{42} - \\frac{6}{42} = -\\frac{1}{42}$\n- $i=9$ (命中): $S_9 = S_8 + \\frac{1}{6} = -\\frac{1}{42} + \\frac{7}{42} = \\frac{6}{42} = \\frac{1}{7}$\n- $i=10$ (未命中): $S_{10} = S_9 - \\frac{1}{7} = \\frac{1}{7} - \\frac{1}{7} = 0$\n最终值 $S_{10}=0$ 确认了总增量和总减量之间的平衡。\n\n富集分数 (ES) 定义为运行总和达到的离 $0$ 的最大偏差。这对应于寻找 $\\max_{i \\in \\{1,...,10\\}}|S_i|$。\n我们列出运行总和的绝对值：\n- $|S_1| = |-\\frac{1}{7}| = \\frac{1}{7} = \\frac{6}{42}$\n- $|S_2| = |\\frac{5}{14}| = \\frac{5}{14} = \\frac{15}{42}$\n- $|S_3| = |\\frac{3}{14}| = \\frac{3}{14} = \\frac{9}{42}$\n- $|S_4| = |\\frac{1}{14}| = \\frac{1}{14} = \\frac{3}{42}$\n- $|S_5| = |\\frac{17}{42}| = \\frac{17}{42}$\n- $|S_6| = |\\frac{11}{42}| = \\frac{11}{42}$\n- $|S_7| = |\\frac{5}{42}| = \\frac{5}{42}$\n- $|S_8| = |-\\frac{1}{42}| = \\frac{1}{42}$\n- $|S_9| = |\\frac{1}{7}| = \\frac{1}{7} = \\frac{6}{42}$\n- $|S_{10}| = |0| = 0$\n\n比较这些值，最大值为 $\\frac{17}{42}$。\n因此，富集分数为 $\\text{ES} = \\frac{17}{42}$。这个最大偏差出现在位置 $i=5$ 处。\n\n第二个任务是识别前导子集。该子集被定义为在排序列表 $\\mathcal{L}$ 中，直到并包括达到 ES 的位置时所遇到的 $\\mathcal{S}$ 的成员。\nES 在 $i=5$ 处达到。\n排序列表中直到位置 $5$ 的基因为 $\\{g_1, g_2, g_3, g_4, g_5\\}$。\n基因集为 $\\mathcal{S} = \\{g_2, g_5, g_9\\}$。\n这两个集合的交集给出了前导子集：\n$$ \\text{Leading-edge subset} = \\{g_1, g_2, g_3, g_4, g_5\\} \\cap \\{g_2, g_5, g_9\\} = \\{g_2, g_5\\} $$\n\n富集分数是 $\\frac{17}{42}$，前导子集是 $\\{g_2, g_5\\}$。问题指定将 ES 作为最终答案报告。", "answer": "$$\\boxed{\\frac{17}{42}}$$", "id": "3315251"}, {"introduction": "在通路分析领域，基因集富集分析（GSEA）和过表达分析（ORA）是两种主要的工具，但它们回答的统计学问题不尽相同。本练习挑战你批判性地思考这两种方法在统计原理上的根本差异：GSEA对整个基因排序列表的分布敏感，而ORA依赖于一个固定的显著性阈值来统计基因数量。通过分析一些精心设计的假想情景，你将培养出一种重要的直觉，从而能够在不同生物学背景下选择合适的方法，并正确解读为何有时两种方法的结果会出现分歧 [@problem_id:3315305]。", "problem": "您正在分析一项病例-对照RNA测序研究，其中每个基因都根据差异表达被赋予一个连续的、带符号的排序统计量（例如，双样本$t$-统计量或信噪比）。对于一个预定义的通路基因集$S$，我们考虑两种富集分析方法：基因集富集分析（GSEA）和过表达分析（ORA）。ORA需要对排序统计量选择一个固定的阈值，以声明一组基因为差异表达基因，然后检验$S$中包含的超过阈值的基因是否比在背景基因中总的超过阈值的基因数量下随机预期的要多。而GSEA则使用完整的排序列表来计算一个运行总和统计量，当在排序列表中遇到$S$的成员时，该统计量会增加（基因水平统计量越强，贡献越大），否则减少，并通过表型-标签置换来评估其显著性。\n\n根据这些方法的第一性原理，当$S$中的一小部分基因在排序列表的顶端表现出非常强的集中效应，而$S$的大多数成员表现出微弱但协同的、不足以通过固定阈值的效应时，两种方法的结果可能会出现分歧。请考虑以下候选情景。在每个情景中，$N$是基因总数，$K$是通过固定阈值被宣布为差异表达的基因数量，$n=|\\mathcal{S}|$是基因集的大小，$h$是来自$S$中超过阈值的基因数量。排名指的是在全基因组排序列表中的位置（排名$1$是顶端）。\n\n以下哪种情景可能在$S$的GSEA分析中（在表型-标签置换下）产生统计上显著的结果，而ORA分析（使用水平为$\\alpha=0.05$的单侧过表达检验）却未能达到统计显著性？\n\nA. $N=20000$, $K=400$, $n=200$, $h=6$。来自$S$中超过阈值的$h=6$个基因占据了排名$\\{1,2,3,5,9,27\\}$。$S$中剩余的$n-h=194$个成员具有中等的正向统计量，使得其中约$75\\%$的基因排名在$10000$以上（即，在前一半），但没有高到足以超过阈值。\n\nB. $N=20000$, $K=600$, $n=150$, $h=20$。来自$S$中超过阈值的$h=20$个基因占据了排名$\\{1,2,3,4,5,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34\\}$。剩余的$n-h=130$个成员在排名中近乎均匀分布。\n\nC. $N=20000$, $K=2000$, $n=50$, $h=3$。来自$S$中超过阈值的$h=3$个基因占据了排名$\\{1,2,5\\}$。$S$中剩余的$n-h=47$个基因具有微弱的正向统计量，但大多低于阈值，并集中在排序列表的前$60\\%$。\n\nD. $N=20000$, $K=1500$, $n=300$, $h=10$。$S$中的$n$个成员在排序列表中均匀散布；特别是，超过阈值的$h=10$个基因散布在排名$5000$到$18000$之间，而$S$中剩余的$n-h=290$个成员相对于背景没有显示出协同性的偏移。\n\n选择所有适用的选项，并从第一性原理出发解释你的选择，而不是援引预先记忆的决策规则。你的解释应说明为什么ORA的固定阈值计数模型在你选择的情景中产生不显著的结果，而GSEA对排名分布的敏感性可以因$S$中一小部分强烈偏移的排名而检测到显著的富集。", "solution": "问题要求找出基因集富集分析（GSEA）可能具有统计显著性而过表达分析（ORA）不具有统计显著性的情景。这需要对每种方法背后的统计学原理有精确的理解。\n\n**第一性原理：ORA vs. GSEA**\n\n**过表达分析（ORA）：**\nORA对基因进行二元分类操作：它们要么是“差异表达”（DE），要么是“非差异表达”。这种分类基于一个基因的统计量是否超过一个预定义的固定阈值。然后，该方法检验基因集$S$是否在DE基因列表中过表达。零假设$H_0$是，$S$中的成员成为DE基因的可能性不比不在$S$中的基因更高。统计检验基于超几何分布。给定总共$N$个基因，其中$K$个是DE基因，以及一个大小为$n$的基因集$S$，在$S$中随机观察到恰好$h$个DE基因的概率是：\n$$ P(X=h) = \\frac{\\binom{n}{h} \\binom{N-n}{K-h}}{\\binom{N}{K}} $$\n单侧过表达检验通过计算观察到$h$个或更多DE基因在$S$中的概率来得出p值：\n$$ p = P(X \\ge h) = \\sum_{i=h}^{\\min(n,K)} \\frac{\\binom{n}{i} \\binom{N-n}{K-i}}{\\binom{N}{K}} $$\n如果$p \\le \\alpha$，则结果被认为是统计显著的，问题中指定$\\alpha = 0.05$。ORA的一个关键特征是，它丢弃了所有关于统计量大小超出阈值的信息，并完全忽略了阈值以下的所有基因。$h$个基因的确切排名无关紧要，只有它们的数量重要。\n\n**基因集富集分析（GSEA）：**\n相比之下，GSEA是无阈值的。它使用所有$N$个基因的完整排序列表。它评估基因集$S$的成员是随机分布在整个排序列表中，还是集中在顶部或底部。它计算一个运行总和富集分数（ES）。沿着排序列表从排名$1$走到$N$：\n- 如果排名为$j$的基因在$S$中，运行总和增加，通常增加的量与基因的排序统计量成正比。\n- 如果排名为$j$的基因不在$S$中，运行总和减少。\nES是这个运行总和与零的最大偏差。GSEA可以检测到两种ORA可能错过的信号：\n1.  **前导边富集（Leading Edge Enrichment）：** $S$中的一小部分基因（“前导边”）高度集中在排序列表的最顶端。即使这些基因的总数很少，它们的极端排名也会对产生大的ES有很大贡献。\n2.  **协同偏移（Coordinated Shift）：** $S$中的大多数基因在某个方向上表现出微小但协同的偏移（例如，大多数基因轻微上调），即使很少或没有基因能通过ORA所要求的严格阈值。\n\n一个能产生显著GSEA结果但非显著ORA结果的情景，通常会具有GSEA敏感的信号（前导边和/或协同偏移），但不足以为ORA产生一个统计上显著的计数$h$。我们现在将评估每个情景。\n\n---\n\n**情景A的分析**\n\n**已知条件：** $N=20000$, $K=400$, $n=200$, $h=6$。\n**ORA分析：**\n在零假设下，$S$集合中DE基因的期望数量是：\n$$ E[h] = K \\times \\frac{n}{N} = 400 \\times \\frac{200}{20000} = 4 $$\n观测到的计数是$h=6$，仅比期望计数4略大。为评估显著性，我们计算p值$P(X \\ge 6)$，这是一个总体为$N=20000$、其中有$K=400$个成功案例（DE基因）、抽取一个大小为$n=200$的样本（基因集）、并观察到$h=6$个成功案例的超几何分布。\np值是$X=6, 7, ..., 200$的概率总和：\n$$ p = P(X \\ge 6) = \\sum_{i=6}^{200} \\frac{\\binom{200}{i} \\binom{19800}{400-i}}{\\binom{20000}{400}} \\approx 0.155 $$\n由于$p \\approx 0.155 > 0.05$，ORA结果**不具有统计显著性**。\n\n**GSEA分析：**\n问题陈述，$S$中$h=6$个DE基因占据了极高的排名：$\\{1, 2, 3, 5, 9, 27\\}$。这构成了一个强大的“前导边”。GSEA的运行总和会在排序列表的开始处急剧增加。此外，$S$中剩余的$194$个基因并非随机分布；它们显示出协同的、中等的正向偏移，其中“$75\\%$的基因排名在$10000$以上（即，在前一半）”。这种集体的微弱信号，加上强大的前导边，正是GSEA设计用来检测的那种模式。这很可能导致一个大的、正的富集分数（ES），并通过表型置换检验发现其是显著的。\n\n**结论：** 这个情景呈现了一个经典案例：ORA因阈值以上基因数量不足而失败，而GSEA通过整合前导边基因的极端排名信号和基因集其余部分的协同偏移信号而成功。此选项**正确**。\n\n---\n\n**情景B的分析**\n\n**已知条件：** $N=20000$, $K=600$, $n=150$, $h=20$。\n**ORA分析：**\n$S$集合中DE基因的期望数量是：\n$$ E[h] = K \\times \\frac{n}{N} = 600 \\times \\frac{150}{20000} = 4.5 $$\n观测到的计数是$h=20$，是期望值的四倍多。这表明存在强烈的过表达。超几何p值为$P(X \\ge 20)$，对于$N=20000$, $K=600$, $n=150$。\n$$ p = P(X \\ge 20) = \\sum_{i=20}^{150} \\frac{\\binom{150}{i} \\binom{19850}{600-i}}{\\binom{20000}{600}} \\approx 1.5 \\times 10^{-11} $$\n由于$p \\ll 0.05$，ORA结果**高度统计显著**。\n\n**GSEA分析：**\n$h=20$个DE基因占据了顶端排名$\\{1, 2, 3, 4, 5, 6, 8, ..., 34\\}$。这构成了一个异常强大的前导边，这肯定会导致一个显著的GSEA结果。\n\n**结论：** 在这种情景下，ORA和GSEA都会是显著的。这不满足ORA未能达到显著性的条件。此选项**不正确**。\n\n---\n\n**情景C的分析**\n\n**已知条件：** $N=20000$, $K=2000$, $n=50$, $h=3$。\n**ORA分析：**\n$S$集合中DE基因的期望数量是：\n$$ E[h] = K \\times \\frac{n}{N} = 2000 \\times \\frac{50}{20000} = 5 $$\n观测到的计数是$h=3$，小于期望数量。这是低表达（欠表达），而不是过表达。单侧过表达检验检查$P(X \\ge h)$。这里我们计算$P(X \\ge 3)$。\n$$ p = P(X \\ge 3) = \\sum_{i=3}^{50} \\frac{\\binom{50}{i} \\binom{19950}{2000-i}}{\\binom{20000}{2000}} \\approx 0.903 $$\n由于$p \\approx 0.903 > 0.05$，ORA结果**不具有统计显著性**。\n\n**GSEA分析：**\n虽然来自$S$的DE基因数量很少（$h=3$），但它们的排名位于列表的绝对顶端：$\\{1, 2, 5\\}$。这代表了一个非常小但极其有效的前导边。GSEA的运行总和会经历一个剧烈的初始增长。此外，$S$中剩余的$47$个基因显示出协同偏移，它们“集中在排序列表的前$60\\%$”。这种强大的（尽管微小的）前导边与基因集其余部分的微妙协同偏移相结合，使得GSEA很可能检测到一个显著的富集信号，而ORA因只看到一个不显著的低表达（$h=3$ vs. $E[h]=5$）而失败。\n\n**结论：** 这个情景是GSEA对排名分布的敏感性与ORA依赖简单计数的另一个很好的例子。ORA不显著，而GSEA很可能是显著的。此选项**正确**。\n\n---\n\n**情景D的分析**\n\n**已知条件：** $N=20000$, $K=1500$, $n=300$, $h=10$。\n**ORA分析：**\n$S$集合中DE基因的期望数量是：\n$$ E[h] = K \\times \\frac{n}{N} = 1500 \\times \\frac{300}{20000} = 22.5 $$\n观测到的计数是$h=10$，不到期望值的一半。与情景C一样，这是低表达。对$P(X \\ge 10)$的单侧过表达检验将产生一个非常大的p值。\n$$ p = P(X \\ge 10) = \\sum_{i=10}^{300} \\frac{\\binom{300}{i} \\binom{19700}{1500-i}}{\\binom{20000}{1500}} \\approx 0.9996 $$\n由于$p \\approx 0.9996 > 0.05$，ORA结果**不具有统计显著性**。\n\n**GSEA分析：**\n问题明确指出，“$S$中的$n$个成员在排序列表中均匀散布……而$S$中剩余的$n-h=290$个成员相对于背景没有显示出协同性的偏移”。集合成员在排序列表中均匀或随机分布是GSEA的零假设。没有前导边（少数DE基因分布广泛且不在顶端），也没有协同偏移。因此，GSEA的运行总和会在零附近随机波动，ES也将不显著。\n\n**结论：** 在这种情景下，ORA和GSEA都不会显著。它不满足指定的标准。此选项**不正确**。", "answer": "$$\\boxed{AC}$$", "id": "3315305"}, {"introduction": "在真实的生物信息学分析中，通路富集分析通常涉及对数千个基因集进行同时检验，这带来了严重的多重假设检验问题。如果不进行校正，原始的 $p$ 值会产生大量假阳性结果。这个练习将带你实践Benjamini-Hochberg（BH）程序，这是一种控制伪发现率（False Discovery Rate, FDR）的标准且至关重要的方法。掌握这项计算技能，是从海量原始 $p$ 值中筛选出可靠的显著富集通路的关键，也是任何严谨的基因组学研究中必不可少的一步 [@problem_id:3315266]。", "problem": "在一项差异表达研究的超表示分析（ORA）中，假设您使用超几何检验对 $m=12$ 个预定义的基因集进行了富集检验，得到了基因集 $\\mathrm{GS}1$ 到 $\\mathrm{GS}12$ 的以下原始 $p$ 值：\n- $\\mathrm{GS}1$: $0.004$\n- $\\mathrm{GS}2$: $0.020$\n- $\\mathrm{GS}3$: $0.020$\n- $\\mathrm{GS}4$: $0.0008$\n- $\\mathrm{GS}5$: $0.12$\n- $\\mathrm{GS}6$: $0.040$\n- $\\mathrm{GS}7$: $0.040$\n- $\\mathrm{GS}8$: $0.008$\n- $\\mathrm{GS}9$: $0.16$\n- $\\mathrm{GS}{10}$: $0.0024$\n- $\\mathrm{GS}{11}$: $0.040$\n- $\\mathrm{GS}{12}$: $0.064$\n\n您希望使用 Benjamini–Hochberg (BH) 程序将错误发现率（FDR）控制在 $\\alpha=0.05$ 的水平，并报告 Benjamini–Hochberg 校正后的 $q$ 值（BH 校正 $p$ 值）。计算所有 $12$ 个基因集的 BH 校正 $q$ 值，确定在 $\\alpha=0.05$ 水平下哪些基因集是显著的，并简要说明原始 $p$ 值中的相同值（ties）以及超几何 $p$ 值的离散性如何影响 BH 校正和决策规则。\n\n报告在 $\\alpha=0.05$ 水平下显著基因集的数量作为您的最终答案。最终答案必须是一个整数。最终答案无需四舍五入说明。", "solution": "此问题已经过验证。\n\n### 步骤 1：提取已知信息\n- 基因集（假设）的数量，$m=12$。\n- 来自基因集 $\\mathrm{GS}1$ 到 $\\mathrm{GS}12$ 超几何检验的原始 $p$ 值集合：\n  - $\\mathrm{GS}1$: $0.004$\n  - $\\mathrm{GS}2$: $0.020$\n  - $\\mathrm{GS}3$: $0.020$\n  - $\\mathrm{GS}4$: $0.0008$\n  - $\\mathrm{GS}5$: $0.12$\n  - $\\mathrm{GS}6$: $0.040$\n  - $\\mathrm{GS}7$: $0.040$\n  - $\\mathrm{GS}8$: $0.008$\n  - $\\mathrm{GS}9$: $0.16$\n  - $\\mathrm{GS}{10}$: $0.0024$\n  - $\\mathrm{GS}{11}$: $0.040$\n  - $\\mathrm{GS}{12}$: $0.064$\n- 期望的错误发现率（FDR）控制水平，$\\alpha=0.05$。\n- 指定的统计程序：Benjamini–Hochberg (BH)。\n- 要求输出：\n  1. 所有 $12$ 个基因集的 BH 校正 $q$ 值。\n  2. 在 $\\alpha=0.05$ 水平下显著的基因集的识别。\n  3. 关于相同值和离散性如何影响 BH 程序的论证。\n  4. 显著基因集的总数。\n\n### 步骤 2：使用提取的已知信息进行验证\n评估问题的有效性。\n- **科学依据**：该问题描述了一个在常见的生物信息学背景（超表示分析）中用于多重假设检验校正的标准且广泛使用的统计程序（Benjamini-Hochberg）。使用超几何检验进行 ORA 是标准做法。该问题在科学上是合理的。\n- **良态问题**：该问题提供了所有必要的数据（$m$、完整的 $p$ 值列表、$\\alpha$）和一个明确定义的目标。Benjamini-Hochberg 程序是一个确定性算法，会产生唯一的解。\n- **客观性**：该问题以精确、定量和无偏见的语言陈述。\n\n该问题是自包含、一致的，并且没有违反任何指定的无效标准。\n\n### 步骤 3：结论与行动\n此问题是**有效的**。将提供解答。\n\nBenjamini–Hochberg (BH) 程序用于控制错误发现率（FDR），即在所有被拒绝的原假设中，错误阳性（假阳性）的预期比例。该程序涉及计算校正后的 $p$ 值（通常称为 $q$ 值），并将它们与期望的 FDR 水平 $\\alpha$ 进行比较。\n\n首先，我们必须将 $m=12$ 个原始 $p$ 值从最小到最大排序。设 $P_{(1)}, P_{(2)}, \\dots, P_{(m)}$ 为排序后的 $p$ 值，设 $i$ 为每个 $p$ 值的秩，其中 $i=1, \\dots, m$。\n\n原始 $p$ 值排序如下：\n$$\n\\begin{array}{c|c|c}\n\\text{原始ID}  \\text{原始 } p\\text{ 值}  \\text{秩 } (i) \\\\\n\\hline\n\\mathrm{GS}4  0.0008  1 \\\\\n\\mathrm{GS}{10}  0.0024  2 \\\\\n\\mathrm{GS}1  0.004  3 \\\\\n\\mathrm{GS}8  0.008  4 \\\\\n\\mathrm{GS}2  0.020  5 \\\\\n\\mathrm{GS}3  0.020  6 \\\\\n\\mathrm{GS}6  0.040  7 \\\\\n\\mathrm{GS}7  0.040  8 \\\\\n\\mathrm{GS}{11}  0.040  9 \\\\\n\\mathrm{GS}{12}  0.064  10 \\\\\n\\mathrm{GS}5  0.12  11 \\\\\n\\mathrm{GS}9  0.16  12 \\\\\n\\end{array}\n$$\n\n对于第 $i$ 个排序的 $p$ 值 $P_{(i)}$，BH 校正的 $q$ 值定义为：\n$$q_{(i)} = \\min_{j=i}^{m} \\left( \\frac{m}{j} P_{(j)} \\right)$$\n这个定义确保了得到的 $q$ 值是单调不减的，即 $q_{(1)} \\le q_{(2)} \\le \\dots \\le q_{(m)}$。一种实用的计算方法是，首先为每个秩 $i$ 计算中间值 $q'_{(i)} = \\frac{m}{i} P_{(i)}$，然后从秩 $i=m-1$ 向下迭代到 $1$ 并设置 $q_{(i)} = \\min(q'_{(i)}, q_{(i+1)})$ 来强制单调性，其中 $q_{(m)} = q'_{(m)}$。\n\n我们现在计算所有 $12$ 个基因集的 $q$ 值。这里，$m=12$。\n$$\n\\begin{array}{c|c|c|c|c}\n\\text{秩 } (i)  \\text{ID}  \\text{原始 } p\\text{ 值, } P_{(i)}  q'_{(i)} = \\frac{12}{i} P_{(i)}  \\text{BH 校正 } q\\text{ 值, } q_{(i)} \\\\\n\\hline\n1  \\mathrm{GS}4  0.0008  \\frac{12}{1}(0.0008) = 0.0096  0.0096 \\\\\n2  \\mathrm{GS}{10}  0.0024  \\frac{12}{2}(0.0024) = 0.0144  0.0144 \\\\\n3  \\mathrm{GS}1  0.004  \\frac{12}{3}(0.004) = 0.016  0.016 \\\\\n4  \\mathrm{GS}8  0.008  \\frac{12}{4}(0.008) = 0.024  0.024 \\\\\n5  \\mathrm{GS}2  0.020  \\frac{12}{5}(0.020) = 0.048  0.040 \\\\\n6  \\mathrm{GS}3  0.020  \\frac{12}{6}(0.020) = 0.040  0.040 \\\\\n7  \\mathrm{GS}6  0.040  \\frac{12}{7}(0.040) \\approx 0.06857  \\approx 0.05333 \\\\\n8  \\mathrm{GS}7  0.040  \\frac{12}{8}(0.040) = 0.060  \\approx 0.05333 \\\\\n9  \\mathrm{GS}{11}  0.040  \\frac{12}{9}(0.040) \\approx 0.05333  \\approx 0.05333 \\\\\n10  \\mathrm{GS}{12}  0.064  \\frac{12}{10}(0.064) = 0.0768  0.0768 \\\\\n11  \\mathrm{GS}5  0.12  \\frac{12}{11}(0.12) \\approx 0.13091  \\approx 0.13091 \\\\\n12  \\mathrm{GS}9  0.16  \\frac{12}{12}(0.16) = 0.16  0.16 \\\\\n\\end{array}\n$$\n最后一列的最终 $q$ 值是通过确保单调性得出的。例如，$q_{(9)} = \\min(q'_{(9)}, q_{(10)}) = \\min(0.05333..., 0.0768) = 0.05333...$。然后 $q_{(8)} = \\min(q'_{(8)}, q_{(9)}) = \\min(0.060, 0.05333...) = 0.05333...$，依此类推。\n\n如果一个基因集的校正 $q$ 值小于或等于 FDR 控制水平 $\\alpha=0.05$，则认为该基因集是显著的。\n- $q_{\\mathrm{GS}4} = 0.0096 \\le 0.05$ (显著)\n- $q_{\\mathrm{GS}{10}} = 0.0144 \\le 0.05$ (显著)\n- $q_{\\mathrm{GS}1} = 0.016 \\le 0.05$ (显著)\n- $q_{\\mathrm{GS}8} = 0.024 \\le 0.05$ (显著)\n- $q_{\\mathrm{GS}2} = 0.040 \\le 0.05$ (显著)\n- $q_{\\mathrm{GS}3} = 0.040 \\le 0.05$ (显著)\n- $q_{\\mathrm{GS}6} \\approx 0.05333 > 0.05$ (不显著)\n- $q_{\\mathrm{GS}7} \\approx 0.05333 > 0.05$ (不显著)\n- $q_{\\mathrm{GS}{11}} \\approx 0.05333 > 0.05$ (不显著)\n- $q_{\\mathrm{GS}{12}} = 0.0768 > 0.05$ (不显著)\n- $q_{\\mathrm{GS}5} \\approx 0.13091 > 0.05$ (不显著)\n- $q_{\\mathrm{GS}9} = 0.16 > 0.05$ (不显著)\n\n因此，在 FDR 为 $\\alpha=0.05$ 的水平下，有 $6$ 个显著的基因集：$\\mathrm{GS}1$、$\\mathrm{GS}2$、$\\mathrm{GS}3$、$\\mathrm{GS}4$、$\\mathrm{GS}8$ 和 $\\mathrm{GS}{10}$。\n\n关于相同值和离散性：\n- **相同值（Ties）**：原始 $p$ 值包含相同的值（例如，$P_{\\mathrm{GS}2} = P_{\\mathrm{GS}3} = 0.020$）。BH 程序为它们分配连续的秩（秩 5 和 6）。强制单调性的步骤，$q_{(i)} = \\min(q'_{(i)}, q_{(i+1)})$，确保所有具有相同原始 $p$ 值的基因集获得相同的校正 $q$ 值。这是因为任何一组相同 $p$ 值的最终 $q$ 值是由该组计算出的校正值中的最小值决定的。在这个例子中，$q'_{(6)} = 0.040$ 小于 $q'_{(5)} = 0.048$，所以 $\\mathrm{GS}2$ 和 $\\mathrm{GS}3$ 都被赋予了 $0.040$ 的校正 $q$ 值。这是处理相同值的标准且正确的方法。\n- **离散性**：这些 $p$ 值来自超几何检验，该检验基于离散分布。BH 程序的原始证明假设检验统计量是连续的。对于离散的 $p$ 值，属性 $P(p \\le u|H_0) \\le u$ 成立（而不是等式）。这使得标准的 BH 程序变得保守，意味着实际的 FDR 被控制在名义水平 $\\alpha$ 或以下。虽然这保证了 FDR 的控制，但与专门为离散检验设计的方法相比，可能会导致统计功效的损失。在此问题的背景下，应用标准的 BH 程序是有效的，尽管可能偏于保守。\n\n发现显著的基因集总数为 $6$。", "answer": "$$\\boxed{6}$$", "id": "3315266"}]}