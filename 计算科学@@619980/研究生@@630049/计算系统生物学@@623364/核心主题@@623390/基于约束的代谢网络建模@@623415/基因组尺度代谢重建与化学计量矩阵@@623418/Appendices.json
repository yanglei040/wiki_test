{"hands_on_practices": [{"introduction": "代谢模型中反应的方向性并非随意设定，而是受到热力学基本定律的严格制约。本练习将指导您计算在特定细胞条件下反应的吉布斯自由能（$\\Delta_r G'$），并据此判断反应的热力学可行性。这是为通量平衡分析（FBA）设置真实约束（如不可逆性）的关键一步，确保模型预测具有物理化学基础。[@problem_id:3316719]", "problem": "考虑一个嵌入在基因组尺度代谢化学计量表示中的单一胞内反应。该反应根据化学计量式 $2A + B \\rightarrow C + D$ 消耗代谢物 $A$ 和 $B$ 以产生代谢物 $C$ 和 $D$。该反应的化学计量矩阵中对应的列，写作化学计量系数向量为 $\\boldsymbol{\\nu}^{(r)} = \\begin{pmatrix} \\nu_A \\\\ \\nu_B \\\\ \\nu_C \\\\ \\nu_D \\end{pmatrix} = \\begin{pmatrix} -2 \\\\ -1 \\\\ 1 \\\\ 1 \\end{pmatrix}$。假设在生化标准状态（pH $7$，$I \\approx 0.1$ M）下，标准生成吉布斯自由能由 $\\Delta_f G_A^\\circ = -120$ kJ/mol, $\\Delta_f G_B^\\circ = -80$ kJ/mol, $\\Delta_f G_C^\\circ = -220$ kJ/mol, 和 $\\Delta_f G_D^\\circ = -90$ kJ/mol 给出。胞质活度为 $a_A = 0.2$, $a_B = 0.1$, $a_C = 1.0 \\times 10^{-6}$, 以及 $a_D = 1.0 \\times 10^{-4}$。设绝对温度为 $T = 310$ K，通用气体常数为 $R = 8.314462618 \\times 10^{-3}$ kJ mol$^{-1}$ K$^{-1}$。反应自由能的符号约定由上述化学计量式设定，当反应按所写方向进行，消耗 $A$ 和 $B$ 并生成 $C$ 和 $D$ 时，正向通量 $v_r$ 定义为正。\n\n从化学势的定义和反应的化学计量表示出发，推导标准反应吉布斯能 $\\Delta_r G^\\circ$（用标准生成吉布斯自由能 $\\Delta_f G_i^\\circ$ 和化学计量系数 $\\nu_i$ 表示），然后使用代谢物活度在温度 $T$ 下求得变换反应吉布斯能 $\\Delta_r G^\\prime$。在稳态流平衡分析（FBA）的背景下，其中通量 $\\boldsymbol{v}$ 满足 $\\mathbf{S}\\boldsymbol{v} = \\boldsymbol{0}$，当在给定活度下 $\\Delta_r G^\\prime \\ll 0$ 时，构建标量通量 $v_r$ 的不等式，以强制反应的不可逆性。最后，使用所提供的数据计算 $\\Delta_r G^\\prime$ 的数值，并将您的最终数值答案以 kJ/mol 为单位表示，四舍五入到四位有效数字。", "solution": "首先对问题进行验证。\n\n**第 1 步：提取已知条件**\n- 反应化学计量式：$2A + B \\rightarrow C + D$\n- 化学计量系数向量：$\\boldsymbol{\\nu}^{(r)} = \\begin{pmatrix} \\nu_A \\\\ \\nu_B \\\\ \\nu_C \\\\ \\nu_D \\end{pmatrix} = \\begin{pmatrix} -2 \\\\ -1 \\\\ 1 \\\\ 1 \\end{pmatrix}$\n- 标准生成吉布斯自由能：$\\Delta_f G_A^\\circ = -120$ kJ/mol, $\\Delta_f G_B^\\circ = -80$ kJ/mol, $\\Delta_f G_C^\\circ = -220$ kJ/mol, $\\Delta_f G_D^\\circ = -90$ kJ/mol。\n- 胞质活度：$a_A = 0.2$, $a_B = 0.1$, $a_C = 1.0 \\times 10^{-6}$, $a_D = 1.0 \\times 10^{-4}$。\n- 绝对温度：$T = 310$ K。\n- 通用气体常数：$R = 8.314462618 \\times 10^{-3}$ kJ mol$^{-1}$ K$^{-1}$。\n- 通量符号约定：正向反应的 $v_r  0$。\n\n**第 2 步：使用提取的已知条件进行验证**\n该问题具有科学依据，借鉴了化学热力学的基本原理及其在计算系统生物学（流平衡分析）中的应用。问题提法得当，提供了一套完整且一致的数据，足以进行所要求的推导和计算。语言客观、精确。该问题未违反任何无效性标准。例如，化学计量关系 $2A + B \\rightarrow C + D$ 与所提供的化学计量向量完全一致，其中反应物系数为负，产物系数为正。所有物理量都具有适当的单位和在生化背景下合理的数量级。\n\n**第 3 步：结论与行动**\n该问题被认定为有效。将提供完整解答。\n\n**反应吉布斯能的推导**\n\n标准反应吉布斯自由能 $\\Delta_r G^\\circ$ 是当一摩尔反应发生，且所有反应物和产物都维持在其标准状态时吉布斯能的变化。根据赫斯定律，这可以从每种物质 $i$ 的标准生成吉布斯自由能 $\\Delta_f G_i^\\circ$ 计算得出。该变化量是产物的生成能总和减去反应物的生成能总和，每一项都由其化学计量系数加权。采用产物的化学计量系数 $\\nu_i$ 为正、反应物的为负的约定，该关系可紧凑地表示为对所有参与物质的求和：\n$$\n\\Delta_r G^\\circ = \\sum_i \\nu_i \\Delta_f G_i^\\circ\n$$\n在向量表示法中，这对应于反应的转置化学计量向量 $(\\boldsymbol{\\nu}^{(r)})^T$ 与标准生成吉布斯自由能向量 $\\boldsymbol{\\Delta_f G^\\circ}$ 的点积：\n$$\n\\Delta_r G^\\circ = (\\boldsymbol{\\nu}^{(r)})^T \\boldsymbol{\\Delta_f G^\\circ} = \\begin{pmatrix} -2  -1  1  1 \\end{pmatrix} \\begin{pmatrix} \\Delta_f G_A^\\circ \\\\ \\Delta_f G_B^\\circ \\\\ \\Delta_f G_C^\\circ \\\\ \\Delta_f G_D^\\circ \\end{pmatrix}\n$$\n\n物质 $i$ 在指定活度 $a_i$ 下的化学势 $\\mu_i$ 与其标准化学势 $\\mu_i^\\circ$（等于其标准生成吉布斯自由能 $\\Delta_f G_i^\\circ$）通过以下方程关联：\n$$\n\\mu_i = \\mu_i^\\circ + RT \\ln a_i\n$$\n其中 $R$ 是通用气体常数，$T$ 是绝对温度。在这些非标准条件下，实际的反应吉布斯自由能，称为变换反应吉布斯能 $\\Delta_r G^\\prime$，是产物和反应物化学势的总和，并由其化学计量系数 $\\nu_i$ 加权：\n$$\n\\Delta_r G^\\prime = \\sum_i \\nu_i \\mu_i\n$$\n代入 $\\mu_i$ 的表达式：\n$$\n\\Delta_r G^\\prime = \\sum_i \\nu_i (\\mu_i^\\circ + RT \\ln a_i) = \\sum_i \\nu_i \\mu_i^\\circ + \\sum_i \\nu_i RT \\ln a_i\n$$\n第一项是 $\\Delta_r G^\\circ$ 的定义。第二项可以简化为：\n$$\n\\Delta_r G^\\prime = \\Delta_r G^\\circ + RT \\sum_i \\ln(a_i^{\\nu_i}) = \\Delta_r G^\\circ + RT \\ln \\left( \\prod_i a_i^{\\nu_i} \\right)\n$$\n乘积项 $\\prod_i a_i^{\\nu_i}$ 是反应商 $Q$。对于反应 $2A + B \\rightarrow C + D$，这是：\n$$\nQ = a_A^{-2} a_B^{-1} a_C^{1} a_D^{1} = \\frac{a_C a_D}{a_A^2 a_B}\n$$\n因此，最终推导出的变换反应吉布斯能表达式为：\n$$\n\\Delta_r G^\\prime = \\Delta_r G^\\circ + RT \\ln Q\n$$\n\n**FBA 中的通量不可逆性约束**\n\n热力学第二定律要求，只有当吉布斯自由能变化为负（$\\Delta_r G'  0$）时，反应才能自发进行。在 FBA 的背景下，通量 $v_r$ 代表反应的速率。通量的方向与 $\\Delta_r G^\\prime$ 的符号相关联。\n- 如果 $\\Delta_r G'  0$，正向反应是自发的，意味着 $v_r \\ge 0$。\n- 如果 $\\Delta_r G^\\prime > 0$，逆向反应是自发的，意味着 $v_r \\le 0$。\n- 如果 $\\Delta_r G^\\prime = 0$，反应处于平衡状态，净通量为零，$v_r = 0$。\n\n该问题指定了一个 $\\Delta_r G^\\prime \\ll 0$ 的场景。这表明一个大的负吉布斯能变化，意味着正向反应非常有利且在热力学上是不可逆的。在这种条件下，逆向反应是不可能发生的。因此，通量 $v_r$ 必须是非负的。在 FBA 的基于约束的建模框架中，这被表述为一个不等式，为通量设置了一个下界：\n$$\nv_r \\ge 0\n$$\n这是在 FBA 中强制反应不可逆性的标准方法。一个典型的完整约束将是 $0 \\le v_r \\le v_{max}$，其中 $v_{max}$ 是通量容量的上限。\n\n**数值计算**\n\n首先，我们计算标准反应吉布斯能 $\\Delta_r G^\\circ$：\n$$\n\\Delta_r G^\\circ = \\nu_A \\Delta_f G_A^\\circ + \\nu_B \\Delta_f G_B^\\circ + \\nu_C \\Delta_f G_C^\\circ + \\nu_D \\Delta_f G_D^\\circ\n$$\n$$\n\\Delta_r G^\\circ = (-2)(-120 \\text{ kJ/mol}) + (-1)(-80 \\text{ kJ/mol}) + (1)(-220 \\text{ kJ/mol}) + (1)(-90 \\text{ kJ/mol})\n$$\n$$\n\\Delta_r G^\\circ = (240 + 80 - 220 - 90) \\text{ kJ/mol} = (320 - 310) \\text{ kJ/mol} = 10 \\text{ kJ/mol}\n$$\n接下来，我们使用给定的活度计算反应商 $Q$：\n$$\nQ = \\frac{a_C a_D}{a_A^2 a_B} = \\frac{(1.0 \\times 10^{-6})(1.0 \\times 10^{-4})}{(0.2)^2 (0.1)} = \\frac{1.0 \\times 10^{-10}}{(0.04)(0.1)} = \\frac{1.0 \\times 10^{-10}}{0.004} = \\frac{1.0 \\times 10^{-10}}{4 \\times 10^{-3}} = 2.5 \\times 10^{-8}\n$$\n现在，我们计算项 $RT \\ln Q$：\n$$\nR = 8.314462618 \\times 10^{-3} \\text{ kJ mol}^{-1} \\text{ K}^{-1}\n$$\n$$\nT = 310 \\text{ K}\n$$\n$$\nRT = (8.314462618 \\times 10^{-3})(310) \\text{ kJ/mol} \\approx 2.57748 \\text{ kJ/mol}\n$$\n$$\n\\ln Q = \\ln(2.5 \\times 10^{-8}) \\approx -17.504397\n$$\n$$\nRT \\ln Q \\approx (2.57748)( -17.504397) \\text{ kJ/mol} \\approx -45.12028 \\text{ kJ/mol}\n$$\n最后，我们计算变换反应吉布斯能 $\\Delta_r G^\\prime$：\n$$\n\\Delta_r G^\\prime = \\Delta_r G^\\circ + RT \\ln Q\n$$\n$$\n\\Delta_r G^\\prime \\approx 10 \\text{ kJ/mol} - 45.12028 \\text{ kJ/mol} = -35.12028 \\text{ kJ/mol}\n$$\n按要求将最终答案四舍五入到四位有效数字：\n$$\n\\Delta_r G^\\prime = -35.12 \\text{ kJ/mol}\n$$\n这个很大的负值证实了在指定的胞质条件下，该反应确实在正向方向上非常有利，并且实际上是不可逆的，从而证明了约束 $v_r \\ge 0$ 的合理性。", "answer": "$$\n\\boxed{-35.12}\n$$", "id": "3316719"}, {"introduction": "基因-蛋白质-反应（GPR）关联规则是连接基因组与代谢网络的桥梁。本练习将演示一项核心技能：如何将这些复杂的布尔逻辑规则（用于表示同工酶和蛋白质复合物）精确地转化为适用于计算模型的数学约束。通过这种转化，我们能够预测基因敲除后代谢网络的行为，这是基因工程和表型预测的基础。[@problem_id:3316802]", "problem": "您正在重建一个最小代谢模块，以说明基因-蛋白质-反应 (GPR) 规则如何在流通平衡分析 (FBA) 中约束反应通量。考虑一个包含两种内部代谢物 $A$ 和 $B$ 以及三个不可逆反应的细胞内代谢网络：一个摄取反应 $v_{u}$，将 $A$ 从外部池输入细胞；一个转化反应 $v_{R}$，将 $A$ 转化为 $B$；以及一个排出反应 $v_{d}$，将 $B$ 移至外部汇。细胞内代谢物的稳态假设由化学计量矩阵 $S$ 和约束 $S \\, v = 0$ 表示，根据网络拓扑，这在此处意味着在稳态下 $v_{u} = v_{R} = v_{d}$。每个反应 $v_{i}$ 遵循边界 $0 \\le v_{i} \\le u_{i}$。\n\n转化反应 $v_{R}$ 由一种酶催化，该酶遵循基因-蛋白质-反应 (GPR) 规则 $((g_{1} \\land g_{2}) \\lor g_{3})$，其中基因 $g_{1}$ 和 $g_{2}$ 编码一个蛋白质复合物的亚基（逻辑与），而基因 $g_{3}$ 编码一个同工酶（逻辑或）。令 $x_{1}, x_{2}, x_{3} \\in \\{0,1\\}$ 表示二元基因存在指示符，其中 $x_{i} = 1$ 表示基因 $g_{i}$ 存在（未被敲除），$x_{i} = 0$ 表示它被敲除。为 $v_{R}$ 引入一个二元反应活性指示符 $y \\in \\{0,1\\}$。假设边界如下：相对于 $v_{R}$ 的催化能力，摄取是非限制性的，即 $0 \\le v_{u} \\le U$ 且 $U \\ge V$；排出也是非限制性的，即 $0 \\le v_{d} \\le \\bar{U}$，其中 $\\bar{U}$ 足够大。当该酶催化反应处于活性状态时，其催化上限为 $0 \\le v_{R} \\le V$。您可以假设所有三个反应都是不可逆的。\n\n任务：\n- 仅使用化学计量稳态 ($S \\, v = 0$) 的核心定义、反应边界和 GPR 规则的布尔逻辑（同工酶为逻辑或，蛋白质复合物为逻辑与），将布尔规则 $((g_{1} \\land g_{2}) \\lor g_{3})$ 转化为一组混合整数线性约束，这些约束关联基因指示符 $x_{1}, x_{2}, x_{3}$、反应活性指示符 $y$ 以及 $v_{R}$ 的催化边界，使得当规则不满足时 $v_{R} = 0$，而当规则满足时 $v_{R} \\le V$。不要先验地假设任何特定的线性化方法；请从布尔语义中推导出来。\n\n- 现在假设基因存在事件在基因间是随机且独立的，对于 $i \\in \\{1,2,3\\}$，有 $\\mathbb{P}(x_{i} = 1) = p_{i}$ 和 $\\mathbb{P}(x_{i} = 0) = 1 - p_{i}$。在一个以最大化 $v_{R}$ 为目标的 FBA 问题中，受限于 $S \\, v = 0$ 和上述推导出的边界，计算最优目标的期望值 $\\mathbb{E}[\\max v_{R}]$，并将其表示为关于 $p_{1}$、$p_{2}$、$p_{3}$ 和 $V$ 的闭式解析表达式。\n\n将您的最终答案表示为单个闭式表达式。如果包含物理单位，请将期望通量表示为 $\\mathrm{mmol\\ gDW^{-1}\\ h^{-1}}$。无需四舍五入。", "solution": "这个问题包含两部分。首先，我们必须将给定的基因-蛋白质-反应 (GPR) 布尔规则转化为一组混合整数线性约束。其次，我们必须在一个基因存在的概率模型下，计算通过与 GPR 关联的反应的最大通量的期望值。\n\n首先，我们分析代谢网络的结构。该网络涉及两种内部代谢物 $A$ 和 $B$，以及三个不可逆反应：摄取反应 $v_{u}$、转化反应 $v_{R}$ 和排出反应 $v_{d}$。\n这些反应是：\n$v_{u}: \\text{ext} \\rightarrow A$\n$v_{R}: A \\rightarrow B$\n$v_{d}: B \\rightarrow \\text{ext}$\n针对内部代谢物 $A$ 和 $B$ 的化学计量矩阵 $S$ 构建如下：\n$$ S = \\begin{pmatrix} 1  -1  0 \\\\ 0  1  -1 \\end{pmatrix} $$\n列分别对应于通量 $v_u$、$v_R$ 和 $v_d$，行分别对应于代谢物 $A$ 和 $B$。稳态假设由方程 $S v = 0$ 给出，其中 $v = [v_u, v_R, v_d]^T$。\n$$ \\begin{pmatrix} 1  -1  0 \\\\ 0  1  -1 \\end{pmatrix} \\begin{pmatrix} v_u \\\\ v_R \\\\ v_d \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} $$\n该线性方程组得出 $v_u - v_R = 0$ 和 $v_R - v_d = 0$。因此，在稳态下，所有通量必须相等：$v_u = v_R = v_d$。\n\n第一个任务是将 GPR 规则 $((g_1 \\land g_2) \\lor g_3)$ 形式化为一组线性约束，这些约束将基因存在指示符 $x_1, x_2, x_3 \\in \\{0, 1\\}$ 与反应 $v_R$ 的反应活性指示符 $y \\in \\{0, 1\\}$ 联系起来。如果布尔表达式为真，则反应是活性的 ($y=1$)，否则为非活性的 ($y=0$)。\n$y$ 的逻辑表达式是 $y = (x_1 \\land x_2) \\lor x_3$。这意味着当且仅当 $(x_1=1 \\text{ 且 } x_2=1)$ 或 $x_3=1$ 时，$y=1$。\n为了将其转化为线性不等式，我们可以分析 $y$ 取值为 $0$ 或 $1$ 的条件。\n如果 $x_3=1$，则指示符 $y$ 必须为 $1$。这可以通过不等式捕获：\n$$ y \\ge x_3 $$\n如果 $x_1=1$ 且 $x_2=1$，指示符 $y$ 也必须为 $1$。这个条件等同于说，如果 $y=0$，则 $(x_1=1 \\text{ 且 } x_2=1)$ 的情况不成立。表示“与”条件的一个标准方法是对于一个中间变量 $z$ 使用不等式 $z \\ge x_1+x_2-1$。我们可以直接结合这个逻辑。\n当且仅当 GPR 规则为假时，反应是非活性的 ($y=0$)。根据德摩根定律，这对应于 $\\neg((x_1 \\land x_2) \\lor x_3) = (\\neg(x_1 \\land x_2)) \\land (\\neg x_3) = ((\\neg x_1) \\lor (\\neg x_2)) \\land (\\neg x_3)$。用我们的变量来说，这意味着当且仅当 $((1-x_1)=1 \\text{ 或 } (1-x_2)=1) \\text{ 且 } (1-x_3)=1$ 时，$y=0$，这等价于 $(x_1=0 \\text{ 或 } x_2=0) \\text{ 且 } x_3=0$。\n对于二元变量，正确建模 $y = (x_1 \\land x_2) \\lor x_3$ 的完整线性不等式集合是：\n$$ y \\ge x_3 $$\n$$ y \\ge x_1 + x_2 - 1 $$\n$$ y \\le x_1 + x_3 $$\n$$ y \\le x_2 + x_3 $$\n这四个不等式确保了 $y$ 的行为符合要求。例如，如果 $x_3=1$，第一个不等式强制 $y=1$。如果 $x_3=0$，系统简化为 $y \\ge x_1+x_2-1$、$y \\le x_1$ 和 $y \\le x_2$，这是 $y=x_1 \\land x_2$ 的标准线性化形式。\n接下来，我们必须将反应活性指示符 $y$ 与通量 $v_R$ 联系起来。条件是当 GPR 规则不满足时 ($y=0$)，$v_R=0$；当规则满足时 ($y=1$)，$0 \\le v_R \\le V$，其中 $V$ 是催化上限。这可以通过“大M”类型的约束来实现：\n$$ v_R \\le V \\cdot y $$\n鉴于反应是不可逆的 ($v_R \\ge 0$)，如果 $y=0$，此约束变为 $v_R \\le 0$，从而强制 $v_R=0$。如果 $y=1$，此约束变为 $v_R \\le V$，符合要求。\n\n第二个任务是计算最优目标的期望值 $\\mathbb{E}[\\max v_R]$。FBA 问题是在网络约束下最大化 $v_R$。\n对 $v_R$ 的约束是：\n1. 来自 $v_u=v_R$：$v_R \\le U$\n2. 来自 $v_d=v_R$：$v_R \\le \\bar{U}$\n3. 来自 GPR 活性：$v_R \\le V \\cdot y$\n4. 来自不可逆性：$v_R \\ge 0$\n我们已知 $U \\ge V$ 且 $\\bar{U}$ 足够大（意味着 $\\bar{U} \\ge V$）。因此，$v_R$ 的有效上界由依赖于 GPR 的约束决定。对于给定的基因状态集合 $\\{x_1, x_2, x_3\\}$，优化问题简化为：\n$$ \\max v_R \\quad \\text{s.t.} \\quad 0 \\le v_R \\le V \\cdot y $$\n这个问题的解是 $\\max v_R = V \\cdot y$。\n$y$ 的值由随机变量 $x_1, x_2, x_3$ 决定。因此，最优通量是一个随机变量。我们需要计算其期望：\n$$ \\mathbb{E}[\\max v_R] = \\mathbb{E}[V \\cdot y] = V \\cdot \\mathbb{E}[y] $$\n对于一个二元变量 $y$，其期望是它取值为 $1$ 的概率：\n$$ \\mathbb{E}[y] = 1 \\cdot \\mathbb{P}(y=1) + 0 \\cdot \\mathbb{P}(y=0) = \\mathbb{P}(y=1) $$\n所以，我们需要计算 GPR 规则被满足的概率，即 $\\mathbb{P}(y=1)$。这是事件 $(x_1=1 \\land x_2=1) \\lor x_3=1$ 的概率。\n计算互补事件的概率 $\\mathbb{P}(y=0)$，然后使用 $\\mathbb{P}(y=1) = 1 - \\mathbb{P}(y=0)$ 通常更简单。\n事件 $y=0$ 发生当且仅当 GPR 规则为假，即 $((x_1=0 \\lor x_2=0) \\land x_3=0)$。\n基因存在事件是独立的。令 $E_{i}$ 为事件 $x_i=1$。我们有 $\\mathbb{P}(E_i) = p_i$，因此 $\\mathbb{P}(\\neg E_i) = \\mathbb{P}(x_i=0) = 1-p_i$。\n$$ \\mathbb{P}(y=0) = \\mathbb{P}((x_1=0 \\lor x_2=0) \\land x_3=0) $$\n由于基因的独立性，我们可以分离概率：\n$$ \\mathbb{P}(y=0) = \\mathbb{P}(x_1=0 \\lor x_2=0) \\cdot \\mathbb{P}(x_3=0) $$\n概率 $\\mathbb{P}(x_3=0)$ 是 $1-p_3$。\n对于项 $\\mathbb{P}(x_1=0 \\lor x_2=0)$，我们使用补集规则：\n$$ \\mathbb{P}(x_1=0 \\lor x_2=0) = 1 - \\mathbb{P}(\\neg(x_1=0 \\lor x_2=0)) = 1 - \\mathbb{P}(x_1=1 \\land x_2=1) $$\n由于 $x_1$ 和 $x_2$ 的独立性：\n$$ \\mathbb{P}(x_1=1 \\land x_2=1) = \\mathbb{P}(x_1=1) \\cdot \\mathbb{P}(x_2=1) = p_1 p_2 $$\n所以，$\\mathbb{P}(x_1=0 \\lor x_2=0) = 1 - p_1 p_2$。\n代入回去，我们得到反应非活性的概率：\n$$ \\mathbb{P}(y=0) = (1 - p_1 p_2)(1 - p_3) $$\n因此，反应活性的概率 $\\mathbb{P}(y=1)$ 是：\n$$ \\mathbb{P}(y=1) = 1 - \\mathbb{P}(y=0) = 1 - (1 - p_1 p_2)(1 - p_3) $$\n展开这个表达式：\n$$ \\mathbb{P}(y=1) = 1 - (1 - p_3 - p_1 p_2 + p_1 p_2 p_3) = p_1 p_2 + p_3 - p_1 p_2 p_3 $$\n最后，最大通量的期望值是：\n$$ \\mathbb{E}[\\max v_R] = V \\cdot \\mathbb{P}(y=1) = V (p_1 p_2 + p_3 - p_1 p_2 p_3) $$\n这个表达式给出了以催化能力 $V$ 和基因存在概率 $p_1, p_2, p_3$ 表示的期望最优通量。该量的单位将与 $V$ 的单位相同，例如 $\\mathrm{mmol\\ gDW^{-1}\\ h^{-1}}$。", "answer": "$$ \\boxed{V (p_1 p_2 + p_3 - p_1 p_2 p_3)} $$", "id": "3316802"}, {"introduction": "我们将转向一个更高级的实际挑战：自动重建的代谢网络草图通常是不完整的，存在“缺口”（gaps）。本练习将实现一个原则性的缺口填补算法，这在系统生物学中是一个常见的工作流程。该算法通过系统地从候选库中添加反应来恢复网络功能（如生物质合成），同时通过排除不现实的能量生成循环来确保模型的热力学一致性。[@problem_id:3316760]", "problem": "使用化学计量矩阵形式，为小型代谢网络构建一个有原则的补缺算法。目标是通过从一个给定的候选反应集合中添加最少数量的反应来恢复生物质合成的可行性，同时严格排除产​​能循环。您的程序必须实现以下数学框架，并将其应用于指定的测试套件。\n\n定义和基本原理：\n- 一个代谢网络由一个化学计量矩阵 $S \\in \\mathbb{R}^{m \\times n}$（涵盖 $m$ 种代谢物和 $n$ 个反应）和一个通量向量 $v \\in \\mathbb{R}^{n}$ 表示。稳态要求 $S v = 0$。\n- 每个反应 $j$ 都有一个下界和上界 $l_j \\le v_j \\le u_j$。界限可以编码不可逆性（例如，$l_j = 0$）或吸收限制（例如，$l_j = -10$，$u_j = 1000$）。\n- 通量平衡分析 (Flux Balance Analysis, FBA) 是一个线性规划 (Linear Programming, LP) 问题，其目标是在满足 $S v = 0$ 和界限 $l \\le v \\le u$ 的约束条件下，最大化一个目标函数（此处为生物质反应通量）。\n- 一组交换反应 $E \\subset \\{0,\\dots,n-1\\}$ 代表与环境的物质交换。为了排除产能循环，我们将通过关闭环境来测试其是否存在，即对所有 $j \\in E$ 强制施加 $v_j = 0$。\n- 在操作上，通过测试在所有交换反应关闭的情况下，一个最大化三磷酸腺苷 (Adenosine Triphosphate, ATP) 水解流失反应的线性规划是否允许一个严格为正的最优通量，来检测产能循环。形式上，令 $a$ 为 ATP 流失反应的索引。求解\n  $$\\max_{v \\in \\mathbb{R}^n} \\ v_a \\quad \\text{subject to} \\quad S v = 0, \\quad l' \\le v \\le u',$$\n  其中，对于所有 $j \\in E$（关闭的交换反应），$l'_j = u'_j = 0$；对于其他反应，$l'_j = l_j$，$u'_j = u_j$。如果最优值严格大于 $0$（在数值上，大于一个小的容差），则网络存在产能循环，是无效的。\n- 补缺问题是：给定一个基础网络 $(S_{\\text{base}}, l_{\\text{base}}, u_{\\text{base}})$（具有指定的生物质反应索引 $b$ 和 ATP 流失索引 $a$），以及一组候选反应 $\\{(s^{(k)}, \\ell^{(k)}, u^{(k)})\\}_{k=0}^{K-1}$，选择一个基数最小的候选子集，使得：\n  1. 在求解以下问题时，增广网络允许一个具有严格为正的生物质通量的可行稳态\n     $$\\max_{v} \\ v_b \\quad \\text{subject to} \\quad S_{\\text{aug}} v = 0, \\quad l_{\\text{aug}} \\le v \\le u_{\\text{aug}},$$\n     其中 $S_{\\text{aug}}$ 和界限包括附加到基础网络上的所选候选反应。\n  2. 根据上述关闭所有交换反应的线性规划，增广网络不存在产能循环。\n  如果多个基数最小的子集满足这些标准，则选择候选索引字典序最小的集合。\n\n测试套件：\n对于所有测试，代谢物顺序为 $(A, B, ATP, ADP, Pi)$，所有未另外指定的通量界限均采用一致的任意单位。以下所有数字均为精确常数。索引是从零开始的。\n\n- 测试 1：\n  - 基础反应（索引为 $0$ 到 $2$ 的列）：\n    - 索引 $0$（$A$ 的交换反应）：化学计量向量 $( -1, 0, 0, 0, 0 )$，界限 $l_0 = -10$，$u_0 = 1000$。\n    - 索引 $1$（生物质）：化学计量向量 $( 0, -1, -1, +1, +1 )$，界限 $l_1 = 0$，$u_1 = 1000$。\n    - 索引 $2$（ATP 流失）：化学计量向量 $( 0, 0, -1, +1, +1 )$，界限 $l_2 = 0$，$u_2 = 1000$。\n  - 候选反应（索引 $c0$ 到 $c2$）：\n    - $c0$：$( -1, +1, 0, 0, 0 )$，界限 $0 \\le v \\le 1000$。\n    - $c1$：$( 0, 0, +1, -1, -1 )$，界限 $0 \\le v \\le 1000$。\n    - $c2$：$( -1, +1, +1, -1, -1 )$，界限 $0 \\le v \\le 1000$。\n  - 交换反应索引：$E = \\{ 0 \\}$。\n  - 生物质索引：$b = 1$。\n  - ATP 流失索引：$a = 2$。\n\n- 测试 2：\n  - 基础反应（索引为 $0$ 到 $3$ 的列）：\n    - 索引 $0$（$A$ 的交换反应）：$( -1, 0, 0, 0, 0 )$，界限 $l_0 = -10$，$u_0 = 1000$。\n    - 索引 $1$（存在的 $A \\to B$）：$( -1, +1, 0, 0, 0 )$，界限 $l_1 = 0$，$u_1 = 1000$。\n    - 索引 $2$（生物质）：$( 0, -1, -1, +1, +1 )$，界限 $l_2 = 0$，$u_2 = 1000$。\n    - 索引 $3$（ATP 流失）：$( 0, 0, -1, +1, +1 )$，界限 $l_3 = 0$，$u_3 = 1000$。\n  - 候选反应（索引 $c0$ 到 $c2$）：\n    - $c0$：$( 0, 0, +1, -1, -1 )$，界限 $0 \\le v \\le 1000$。\n    - $c1$：$( -1, 0, +1, -1, -1 )$，界限 $0 \\le v \\le 1000$。\n    - $c2$：$( -1, +1, +1, -1, -1 )$，界限 $0 \\le v \\le 1000$。\n  - 交换反应索引：$E = \\{ 0 \\}$。\n  - 生物质索引：$b = 2$。\n  - ATP 流失索引：$a = 3$。\n\n- 测试 3：\n  - 基础反应（索引为 $0$ 到 $3$ 的列）：\n    - 索引 $0$（$A$ 的交换反应）：$( -1, 0, 0, 0, 0 )$，界限 $l_0 = -2$，$u_0 = 1000$。\n    - 索引 $1$（ATP 耦合到 $A$）：$( -1, 0, +1, -1, -1 )$，界限 $l_1 = 0$，$u_1 = 1000$。\n    - 索引 $2$（生物质）：$( 0, -1, -1, +1, +1 )$，界限 $l_2 = 0$，$u_2 = 1000$。\n    - 索引 $3$（ATP 流失）：$( 0, 0, -1, +1, +1 )$，界限 $l_3 = 0$，$u_3 = 1000$。\n  - 候选反应（索引 $c0$ 到 $c2$）：\n    - $c0$：$( -1, +1, 0, 0, 0 )$，界限 $0 \\le v \\le 1000$。\n    - $c1$：$( -2, +1, 0, 0, 0 )$，界限 $0 \\le v \\le 1000$。\n    - $c2$：$( 0, 0, +1, -1, -1 )$，界限 $0 \\le v \\le 1000$。\n  - 交换反应索引：$E = \\{ 0 \\}$。\n  - 生物质索引：$b = 2$。\n  - ATP 流失索引：$a = 3$。\n\n程序要求：\n- 对于每个测试，按基数递增的顺序枚举候选子集，在相同基数内，按候选索引的字典序枚举。\n- 对于一个给定的子集，构建增广网络并：\n  1. 通过求解在交换反应关闭时最大化 $v_a$ 的线性规划来验证不存在产能循环（如上定义）。如果最优的 $v_a$ 严格大于 $0$，则拒绝该子集。\n  2. 如果通过测试，则使用原始交换界限求解 FBA 以最大化生物质通量 $v_b$。如果最优的 $v_b$ 严格大于 $0$，则接受该子集。\n- 选择第一个同时满足两个标准的子集。如果没有子集能同时满足，则为该测试返回空列表。\n- 数值容差：将任何 $\\le 10^{-9}$ 的通量视为零。\n- 最终输出格式：您的程序应生成单行，其中包含一个整数列表的列表，第 $i$ 个内部列表包含为测试 $i$ 选择的候选反应的从零开始的索引（按升序排列）。例如，像 $[[2],[1],[0]]$ 这样的输出表示为测试 1 选择候选反应 2，为测试 2 选择候选反应 1，为测试 3 选择候选反应 0。\n\n您的程序必须是一个完整的、可运行的实现，它硬编码了上述测试套件，并仅以指定格式打印最终结果行。输出中不需要单位。", "solution": "用户提出了一个计算系统生物学中的问题，具体涉及代谢网络的算法补缺。我已经验证了问题陈述，并发现其具有科学依据、问题明确且客观。所提供的定义、数据和程序要求是完整的，并且在数学上是一致的。因此，我将提供一个完整的解决方案。\n\n该问题要求实现一个算法，从候选池中识别出一个最小的反应集合，以恢复一个有缺口的代谢网络的功能。功能性由两个标准定义：能以非零速率产生生物质，以及不存在热力学上不可行的产能循环。\n\n解决方案的核心是系统地搜索候选反应的所有可能子集。为确保最小性和唯一性，此搜索首先按子集的大小（基数）构建，从 $0$ 到候选反应总数 $K$，其次，对于相同大小的子集，按候选索引的字典序进行。第一个满足两个所需标准的子集即为解。\n\n对于每个候选子集，我们通过将选定的反应添加到基础网络来构建一个增广代谢网络。增广网络由其化学计量矩阵 $S_{\\text{aug}} \\in \\mathbb{R}^{m \\times n_{\\text{aug}}}$ 和反应通量界限 $l_{\\text{aug}} \\le v \\le u_{\\text{aug}}$ 描述。然后，此增广网络将接受两个验证测试，这两个测试都公式化为线性规划 (LP) 问题。\n\n**1. 产能循环测试：**\n产能循环在模型中代表“免费午餐”，即能量（通常以三磷酸腺苷 (ATP) 的形式）可以无中生有。这在生物学上是不现实的，并表明网络定义中存在错误。问题为此类循环提供了一个特定的基于 LP 的操作测试。我们通过将所有交换反应的通量界限设置为零（对于所有 $j \\in E$，$v_j=0$）来关闭网络与环境的任何物质交换。然后，我们尝试最大化通过一个模拟 ATP 消耗的合成 ATP 流失反应的通量 $v_a$。\n\nLP 公式为：\n$$ \\max_{v} v_a \\quad \\text{subject to} \\quad \\begin{cases} S_{\\text{aug}} v = 0 \\\\ l'_{\\text{aug}} \\le v \\le u'_{\\text{aug}} \\end{cases} $$\n其中，界限 $l'_{\\text{aug}}$ 和 $u'_{\\text{aug}}$ 与 $l_{\\text{aug}}$ 和 $u_{\\text{aug}}$ 相同，只是对于每个交换反应索引 $j \\in E$，$l'_{j} = u'_{j} = 0$。如果得到的 $v_a$ 最优值严格大于一个小的数值容差（给定为 $10^{-9}$），则意味着网络可以自发产生 ATP。这样的网络是无效的，相应的候选子集被拒绝。\n\n**2. 生物质生产测试：**\n如果网络通过了循环测试，我们接着检查它是否已被“修复”，即是否能够产生生物质。这是一个标准的通量平衡分析 (FBA) 问题。我们使用原始的通量界限，包括交换反应的非零吸收速率，并最大化生物质反应的通量 $v_b$。\n\nLP 公式为：\n$$ \\max_{v} v_b \\quad \\text{subject to} \\quad \\begin{cases} S_{\\text{aug}} v = 0 \\\\ l_{\\text{aug}} \\le v \\le u_{\\text{aug}} \\end{cases} $$\n如果 $v_b$ 的最优值严格大于容差 $10^{-9}$，则网络是功能性的。因此，当前的候选子集是一个有效的解决方案。由于我们是按照最小性和字典序的顺序进行迭代，这个第一个有效的子集就是所期望的答案。\n\n整个算法通过迭代由 `itertools.combinations` 生成的候选子集来实现。对于每个子集，使用 `scipy.optimize.linprog` 构建并求解两个 LP。如果为某个测试用例找到了解，则该测试用例的搜索终止，算法继续处理下一个。如果某个测试用例的搜索完成而没有找到任何有效的子集，则解为空集。此过程独立应用于所提供套件中的每个测试用例。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\nimport itertools\n\ndef solve():\n    \"\"\"\n    Solves the metabolic gap-filling problem for a suite of test cases.\n    \"\"\"\n    TOL = 1e-9\n\n    # Metabolite order for all tests: (A, B, ATP, ADP, Pi)\n    # m = 5\n    m = 5\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test 1\n        {\n            \"s_base\": np.array([\n                [-1, 0, 0],   # A\n                [0, -1, 0],   # B\n                [0, -1, -1],  # ATP\n                [0, 1, 1],    # ADP\n                [0, 1, 1]     # Pi\n            ]),\n            \"l_base\": np.array([-10, 0, 0]),\n            \"u_base\": np.array([1000, 1000, 1000]),\n            \"candidates\": [\n                {\"s\": np.array([-1, 1, 0, 0, 0]), \"l\": 0, \"u\": 1000},  # c0\n                {\"s\": np.array([0, 0, 1, -1, -1]), \"l\": 0, \"u\": 1000},  # c1\n                {\"s\": np.array([-1, 1, 1, -1, -1]), \"l\": 0, \"u\": 1000}    # c2\n            ],\n            \"exchange_indices\": {0},\n            \"biomass_idx\": 1,\n            \"atp_drain_idx\": 2\n        },\n        # Test 2\n        {\n            \"s_base\": np.array([\n                [-1, -1, 0, 0],  # A\n                [0, 1, -1, 0],   # B\n                [0, 0, -1, -1],  # ATP\n                [0, 0, 1, 1],    # ADP\n                [0, 0, 1, 1]     # Pi\n            ]),\n            \"l_base\": np.array([-10, 0, 0, 0]),\n            \"u_base\": np.array([1000, 1000, 1000, 1000]),\n            \"candidates\": [\n                {\"s\": np.array([0, 0, 1, -1, -1]), \"l\": 0, \"u\": 1000},  # c0\n                {\"s\": np.array([-1, 0, 1, -1, -1]), \"l\": 0, \"u\": 1000},  # c1\n                {\"s\": np.array([-1, 1, 1, -1, -1]), \"l\": 0, \"u\": 1000}    # c2\n            ],\n            \"exchange_indices\": {0},\n            \"biomass_idx\": 2,\n            \"atp_drain_idx\": 3\n        },\n        # Test 3\n        {\n            \"s_base\": np.array([\n                [-1, -1, 0, 0],  # A\n                [0, 0, -1, 0],   # B\n                [0, 1, -1, -1],  # ATP\n                [0, -1, 1, 1],   # ADP\n                [0, -1, 1, 1]    # Pi\n            ]),\n            \"l_base\": np.array([-2, 0, 0, 0]),\n            \"u_base\": np.array([1000, 1000, 1000, 1000]),\n            \"candidates\": [\n                {\"s\": np.array([-1, 1, 0, 0, 0]), \"l\": 0, \"u\": 1000},  # c0\n                {\"s\": np.array([-2, 1, 0, 0, 0]), \"l\": 0, \"u\": 1000},  # c1\n                {\"s\": np.array([0, 0, 1, -1, -1]), \"l\": 0, \"u\": 1000}    # c2\n            ],\n            \"exchange_indices\": {0},\n            \"biomass_idx\": 2,\n            \"atp_drain_idx\": 3\n        }\n    ]\n\n    final_results = []\n    \n    for case in test_cases:\n        s_base = case[\"s_base\"]\n        l_base = case[\"l_base\"]\n        u_base = case[\"u_base\"]\n        candidates = case[\"candidates\"]\n        exchange_indices = case[\"exchange_indices\"]\n        biomass_idx = case[\"biomass_idx\"]\n        atp_drain_idx = case[\"atp_drain_idx\"]\n\n        n_base = s_base.shape[1]\n        n_candidates = len(candidates)\n        b_eq = np.zeros(m)\n        solution_found = False\n        \n        for k in range(n_candidates + 1):\n            if solution_found:\n                break\n            # Iterate through subsets of size k in lexicographical order\n            for subset_indices in itertools.combinations(range(n_candidates), k):\n                # 1. Construct the augmented network\n                s_aug = s_base\n                l_aug = list(l_base)\n                u_aug = list(u_base)\n\n                if subset_indices:\n                    s_to_add = np.array([candidates[i][\"s\"] for i in subset_indices]).T\n                    s_aug = np.hstack((s_base, s_to_add))\n                    l_to_add = [candidates[i][\"l\"] for i in subset_indices]\n                    u_to_add = [candidates[i][\"u\"] for i in subset_indices]\n                    l_aug.extend(l_to_add)\n                    u_aug.extend(u_to_add)\n                \n                n_aug = s_aug.shape[1]\n                \n                # 2. Test for energy-generating cycles\n                c_atp = np.zeros(n_aug)\n                c_atp[atp_drain_idx] = -1  # Maximize ATP drain flux\n                \n                # Close exchanges for cycle test\n                bounds_cycle_test = list(zip(l_aug, u_aug))\n                for ex_idx in exchange_indices:\n                    bounds_cycle_test[ex_idx] = (0, 0)\n                \n                res_cycle = linprog(c=c_atp, A_eq=s_aug, b_eq=b_eq, bounds=bounds_cycle_test, method='highs')\n                \n                max_atp_flux = -res_cycle.fun if res_cycle.success else 0\n                \n                if max_atp_flux > TOL:\n                    continue  # Cycle detected, this subset is invalid\n\n                # 3. Test for biomass production\n                c_biomass = np.zeros(n_aug)\n                c_biomass[biomass_idx] = -1 # Maximize biomass flux\n\n                bounds_biomass_test = list(zip(l_aug, u_aug))\n\n                res_biomass = linprog(c=c_biomass, A_eq=s_aug, b_eq=b_eq, bounds=bounds_biomass_test, method='highs')\n\n                max_biomass_flux = -res_biomass.fun if res_biomass.success else 0\n\n                if max_biomass_flux > TOL:\n                    final_results.append(list(subset_indices))\n                    solution_found = True\n                    break\n\n        if not solution_found:\n            final_results.append([])\n\n    # Final print statement in the exact required format.\n    # The str(final_results).replace(\" \", \"\") format ensures compliance with the\n    # example structure specified in the problem `[[2],[1],[0]]`.\n    print(str(final_results).replace(\" \", \"\"))\n\nsolve()\n```", "id": "3316760"}]}