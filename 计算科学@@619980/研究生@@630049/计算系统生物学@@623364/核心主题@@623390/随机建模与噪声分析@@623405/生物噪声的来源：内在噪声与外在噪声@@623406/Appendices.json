{"hands_on_practices": [{"introduction": "要对噪声进行量化分析，一个关键的步骤是建立数学模型。本练习将探讨“泊松-伽马”混合模型，这是描述转录爆发（transcriptional bursting）的基石。通过这个练习，你将推导出总噪声（以变异系数的平方 $\\text{CV}^2$ 衡量）如何从数学上分解为代表内在随机性（类泊松过程）和外在变异性（源于爆发）的不同部分，从而为噪声分析奠定理论基础。[@problem_id:3348983]", "problem": "考虑在一个等基因细胞群体中，于稳态下测得的单基因信使核糖核酸 (mRNA) 计数 $X$。假设 $X$ 服从一个由转录爆发产生的负二项分布 $\\mathrm{NB}(r,p)$，其参数为 $r>0$ 和 $0", "solution": "该问题陈述被认为是有效的，因为它以已建立的随机基因表达理论为科学基础，问题提法适定且提供了所有必要信息，并以客观、正式的语言表达。它代表了计算系统生物学领域内一个标准的、可验证的推导过程。\n\n主要目标是推导 mRNA 计数 $X$ 的平方变异系数 $\\mathrm{CV}^{2} = \\mathrm{Var}(X)/(\\mathbb{E}[X])^{2}$，并用其均值 $m$ 和伽马分布的形状参数 $r$ 来表示。$X$ 的模型是一个代表转录爆发的泊松-伽马混合模型。推导过程将完全依赖于全期望定律和全方差定律，以及泊松分布和伽马分布的基本性质。\n\n首先，我们回顾一下相关分布的必要性质和概率定律。\n对于服从泊松分布的随机变量 $Y \\sim \\mathrm{Poisson}(\\lambda)$，其期望和方差为：\n$\\mathbb{E}[Y] = \\lambda$\n$\\mathrm{Var}(Y) = \\lambda$\n\n对于服从伽马分布的随机变量 $\\Lambda \\sim \\mathrm{Gamma}(r, \\theta)$，其形状参数为 $r$，尺度参数为 $\\theta$，其期望和方差为：\n$\\mathbb{E}[\\Lambda] = r\\theta$\n$\\mathrm{Var}(\\Lambda) = r\\theta^{2}$\n\n对于以另一个随机变量 $\\Lambda$ 为条件的随机变量 $X$，其全期望定律和全方差定律为：\n全期望定律：$\\mathbb{E}[X] = \\mathbb{E}[\\mathbb{E}[X \\mid \\Lambda]]$\n全方差定律：$\\mathrm{Var}(X) = \\mathbb{E}[\\mathrm{Var}(X \\mid \\Lambda)] + \\mathrm{Var}(\\mathbb{E}[X \\mid \\Lambda])$\n\n问题陈述 $X \\mid \\Lambda \\sim \\mathrm{Poisson}(\\Lambda)$ 且 $\\Lambda \\sim \\mathrm{Gamma}(r, \\theta)$。\n\n步骤 1：计算 $X$ 的均值 $\\mathbb{E}[X]$。\n使用全期望定律：\n$$\n\\mathbb{E}[X] = \\mathbb{E}[\\mathbb{E}[X \\mid \\Lambda]]\n$$\n由于 $X \\mid \\Lambda \\sim \\mathrm{Poisson}(\\Lambda)$，内部期望为 $\\mathbb{E}[X \\mid \\Lambda] = \\Lambda$。将其代入方程得到：\n$$\n\\mathbb{E}[X] = \\mathbb{E}[\\Lambda]\n$$\n由于 $\\Lambda \\sim \\mathrm{Gamma}(r, \\theta)$，其期望为 $\\mathbb{E}[\\Lambda] = r\\theta$。因此，$X$ 的均值为：\n$$\n\\mathbb{E}[X] = r\\theta\n$$\n问题将 $X$ 的均值定义为 $m$。因此，我们有关系式 $m = r\\theta$。这使我们能够用给定的参数 $m$ 和 $r$ 来表示尺度参数 $\\theta$：\n$$\n\\theta = \\frac{m}{r}\n$$\n\n步骤 2：计算 $X$ 的方差 $\\mathrm{Var}(X)$。\n使用全方差定律：\n$$\n\\mathrm{Var}(X) = \\mathbb{E}[\\mathrm{Var}(X \\mid \\Lambda)] + \\mathrm{Var}(\\mathbb{E}[X \\mid \\Lambda])\n$$\n我们分别计算每一项。\n\n对于第一项 $\\mathbb{E}[\\mathrm{Var}(X \\mid \\Lambda)]$：\n由于 $X \\mid \\Lambda \\sim \\mathrm{Poisson}(\\Lambda)$，条件方差为 $\\mathrm{Var}(X \\mid \\Lambda) = \\Lambda$。对 $\\Lambda$ 取期望得到：\n$$\n\\mathbb{E}[\\mathrm{Var}(X \\mid \\Lambda)] = \\mathbb{E}[\\Lambda]\n$$\n我们已经确定 $\\mathbb{E}[\\Lambda] = m$。所以，第一项是：\n$$\n\\mathbb{E}[\\mathrm{Var}(X \\mid \\Lambda)] = m\n$$\n\n对于第二项 $\\mathrm{Var}(\\mathbb{E}[X \\mid \\Lambda)]$：\n条件期望为 $\\mathbb{E}[X \\mid \\Lambda] = \\Lambda$。因此，我们需要计算 $\\Lambda$ 的方差：\n$$\n\\mathrm{Var}(\\mathbb{E}[X \\mid \\Lambda]) = \\mathrm{Var}(\\Lambda)\n$$\n由于 $\\Lambda \\sim \\mathrm{Gamma}(r, \\theta)$，其方差为 $\\mathrm{Var}(\\Lambda) = r\\theta^{2}$。我们现在代入 $\\theta = m/r$，用 $m$ 和 $r$ 来表示此项：\n$$\n\\mathrm{Var}(\\Lambda) = r \\left(\\frac{m}{r}\\right)^2 = r \\frac{m^2}{r^2} = \\frac{m^2}{r}\n$$\n\n结合这两项，$X$ 的总方差为：\n$$\n\\mathrm{Var}(X) = m + \\frac{m^2}{r}\n$$\n\n步骤 3：计算平方变异系数 $\\mathrm{CV}^2$。\n定义为 $\\mathrm{CV}^{2} = \\mathrm{Var(X)} / (\\mathbb{E}[X])^{2}$。我们有 $\\mathbb{E}[X]=m$ 和 $\\mathrm{Var}(X) = m + m^2/r$。\n$$\n\\mathrm{CV}^{2} = \\frac{m + \\frac{m^2}{r}}{m^2}\n$$\n我们可以将其分为两个分数：\n$$\n\\mathrm{CV}^{2} = \\frac{m}{m^2} + \\frac{\\frac{m^2}{r}}{m^2} = \\frac{1}{m} + \\frac{1}{r}\n$$\n这就是用 $m$ 和 $r$ 表示的平方变异系数的最终表达式。\n\n额外方差的识别与论证：\n$X$ 的方差由 $\\mathrm{Var}(X) = m + m^{2}/r$ 给出。如果 mRNA 的产生是一个简单的、非爆发式的生灭过程，那么其稳态分子数将服从泊松分布。对于均值为 $m$ 的泊松过程，其方差恰好为 $m$。这对应于我们推导出的方差中的第一项。项 $m = \\mathbb{E}[\\Lambda] = \\mathbb{E}[\\mathrm{Var}(X|\\Lambda)]$ 代表“内在噪声”，它源于单个 mRNA 产生和降解事件的内在随机性，并在所有可能的有效转录速率上进行了平均。\n\n第二项 $m^{2}/r = \\mathrm{Var}(\\Lambda) = \\mathrm{Var}(\\mathbb{E}[X|\\Lambda])$ 代表超出简单泊松过程预期的“额外方差”。该项是转录速率 $\\Lambda$ 本身变异性的直接结果。在转录爆发的机制性图像中，基因启动子在活性状态（以爆发形式产生 mRNA）和非活性状态之间随机切换。随机变量 $\\Lambda$ 模拟了这个在细胞间（以及随时间）波动的有效速率。因此，$\\Lambda$ 的方差量化了来自这些上游启动子动力学的噪声贡献。相对于合成/降解过程本身，这通常被称为“外在噪声”。参数 $r$ 与此过程的噪声水平成反比；一个小的 $r$ 值意味着不频繁但规模大的爆发，这增加了 $\\Lambda$ 的变异性，从而增加了 mRNA 计数的整体细胞间变异性，这与 $1/r$ 的依赖关系相一致。因此，该项是基因表达爆发式特性的一个标志。", "answer": "$$\n\\boxed{\\frac{1}{m} + \\frac{1}{r}}\n$$", "id": "3348983"}, {"introduction": "在建立了理论模型之后，一个关键的实践问题随之而来：我们如何设计实验来实际测量这些不同的噪声成分？这个思想实验旨在挑战你思考不同实验设计（如著名的双报告基因系统）所包含的信息量。你需要判断哪种设计足以分离内在噪声、外在噪声乃至测量噪声，这对于培养严谨的实验设计思维至关重要。[@problem_id:3348928]", "problem": "在单细胞基因表达分析中，设每个细胞的测量值为标量随机变量 $X$，模型为 $X=\\tilde{X}+\\epsilon$，其中 $\\tilde{X}$ 表示真实的细胞表达水平，$\\epsilon$ 表示测量噪声。假设 $\\epsilon$ 独立于 $\\tilde{X}$ 且均值为零。$\\tilde{X}$ 中的生物学变异来自两个来源：由细胞内分子反应的随机性引起的内在噪声，以及由缓慢变化的全局状态的细胞间变异引起的外在噪声。将此形式化的标准方法是为每个细胞设定一个潜在的外在状态 $Z$，并通过相对于 $Z$ 的条件矩来定义内在和外在贡献，因此内在贡献取决于给定 $Z$ 时 $\\tilde{X}$ 的条件分布的离散程度，而外在贡献则取决于不同细胞间给定 $Z$ 时 $\\tilde{X}$ 的条件均值的变异性。根据这些定义，总生物学方差 $\\mathrm{Var}(\\tilde{X})$ 分解为内在分量 $\\mathrm{Var}_{\\mathrm{int}}(\\tilde{X})$ 和外在分量 $\\mathrm{Var}_{\\mathrm{ext}}(\\tilde{X})$。测量噪声方差为 $\\mathrm{Var}(\\epsilon)$。\n\n现给定在不同实验设计下的单细胞数据，这些设计中，每个细胞测量1个或2个报告基因，可能随时间重复测量，并且可能带有或不带有对测量噪声的外部校准。在上述模型假设（包括 $\\epsilon$ 独立于 $\\tilde{X}$）下，下列哪个选项正确地指定了一种实验设计及其附带的假设，这些设计和假设足以从观测数据中识别出 $\\mathrm{Var}_{\\mathrm{int}}(\\tilde{X})$、$\\mathrm{Var}_{\\mathrm{ext}}(\\tilde{X})$ 和 $\\mathrm{Var}(\\epsilon)$ 中的每一个？选择所有适用项。\n\nA. 单一快照，每个细胞单个报告基因，无外部校准。对 $X$ 的跨细胞分布拟合一个灵活的参数族；利用 $\\epsilon$ 与 $\\tilde{X}$ 的独立性，使用 $X$ 的经验均值和方差来唯一地恢复 $\\mathrm{Var}_{\\mathrm{int}}(\\tilde{X})$、$\\mathrm{Var}_{\\mathrm{ext}}(\\tilde{X})$ 和 $\\mathrm{Var}(\\epsilon)$。\n\nB. 双报告基因快照：在每个细胞中，测量由相同启动子驱动的2个独立同分布的报告基因，得到 $X_1=\\tilde{X}_1+\\epsilon_1$ 和 $X_2=\\tilde{X}_2+\\epsilon_2$，其中 $\\epsilon_1,\\epsilon_2$ 独立于 $\\tilde{X}_1,\\tilde{X}_2$ 且彼此独立，并且 $\\mathrm{Var}(\\epsilon_1)=\\mathrm{Var}(\\epsilon_2)$ 通过外部校准已知。假设在潜在外在状态 $Z$ 条件下，两个报告基因的内在波动是独立同分布的，并且在同一个细胞中，两个报告基因的 $Z$ 是恒定的。在这些条件下，这三个方差可以从 $(X_1,X_2)$ 的联合分布中识别出来。\n\nC. 双报告基因快照，如选项B，但没有任何对测量噪声的外部校准。通过结合 $X_1$ 和 $X_2$ 的跨细胞协方差和跨细胞方差，这三个方差仍然可以从 $(X_1,X_2)$ 的联合分布中识别出来。\n\nD. 每个细胞单报告基因的时间序列：在每个细胞中，于2个时间点测量同一个报告基因，得到 $X^{(1)}=\\tilde{X}^{(1)}+\\epsilon^{(1)}$ 和 $X^{(2)}=\\tilde{X}^{(2)}+\\epsilon^{(2)}$，其中 $\\epsilon^{(1)},\\epsilon^{(2)}$ 独立于 $\\tilde{X}^{(1)},\\tilde{X}^{(2)}$ 且彼此独立，并且 $\\mathrm{Var}(\\epsilon^{(1)})=\\mathrm{Var}(\\epsilon^{(2)})$ 通过外部校准已知。假设时间间隔与内在相关时间相比足够长，因此在相同的潜在外在状态 $Z$（在时间间隔内不变）条件下，两个时间点的内在分量是独立同分布的。在这些条件下，这三个方差可以从 $(X^{(1)},X^{(2)})$ 的联合分布中识别出来。\n\nE. 单一快照，每个细胞单个报告基因，但对每个细胞的同一样品进行2次独立的技术重复测量，因此对每个细胞观察到 $X^{(a)}=\\tilde{X}+\\epsilon^{(a)}$ 和 $X^{(b)}=\\tilde{X}+\\epsilon^{(b)}$，其中 $\\epsilon^{(a)},\\epsilon^{(b)}$ 独立同分布且独立于 $\\tilde{X}$。从这些数据中，通过细胞内重复测量的差异来估计 $\\mathrm{Var}(\\epsilon)$，然后将其从 $X$ 的跨细胞方差中减去以获得 $\\mathrm{Var}_{\\mathrm{ext}}(\\tilde{X})$，最后通过从 $\\mathrm{Var}(\\tilde{X})$ 中减去 $\\mathrm{Var}_{\\mathrm{ext}}(\\tilde{X})$ 来恢复 $\\mathrm{Var}_{\\mathrm{int}}(\\tilde{X})$。", "solution": "问题要求确定哪些实验设计及相关假设，能够唯一地识别出基因表达的三个方差分量：内在方差 ($\\mathrm{Var}_{\\mathrm{int}}(\\tilde{X})$)、外在方差 ($\\mathrm{Var}_{\\mathrm{ext}}(\\tilde{X})$) 和测量噪声方差 ($\\mathrm{Var}(\\epsilon)$)。\n\n首先，验证核心模型和定义。\n**已知条件：**\n1.  测量表达量：$X = \\tilde{X} + \\epsilon$。\n2.  $\\tilde{X}$ 是真实表达水平；$\\epsilon$ 是测量噪声。\n3.  假设：$\\epsilon$ 独立于 $\\tilde{X}$，且 $\\mathrm{E}[\\epsilon] = 0$。\n4.  设定了一个潜在的外在状态 $Z$。\n5.  内在方差根据给定 $Z$ 时 $\\tilde{X}$ 的条件分布的离散程度定义。外在方差根据给定 $Z$ 时 $\\tilde{X}$ 的条件均值的变异性定义。\n6.  总生物学方差分解为 $\\mathrm{Var}(\\tilde{X}) = \\mathrm{Var}_{\\mathrm{int}}(\\tilde{X}) + \\mathrm{Var}_{\\mathrm{ext}}(\\tilde{X})$。\n7.  测量噪声方差为 $\\mathrm{Var}(\\epsilon)$。\n\n**验证：**\n- 所给模型是计算系统生物学中分析单细胞表达数据的标准表示方法。\n- 将噪声分解为内在和外在分量，并使用潜在变量 $Z$ 和全方差公式进行形式化，是由 Elowitz et al. (2002) 建立的经典框架。具体来说，全方差公式表明 $\\mathrm{Var}(\\tilde{X}) = \\mathrm{E}[\\mathrm{Var}(\\tilde{X}|Z)] + \\mathrm{Var}(\\mathrm{E}[\\tilde{X}|Z])$。问题正确地将这些项分别映射到内在和外在方差的定义上：\n    $$ \\mathrm{Var}_{\\mathrm{int}}(\\tilde{X}) = \\mathrm{E}[\\mathrm{Var}(\\tilde{X}|Z)] $$\n    $$ \\mathrm{Var}_{\\mathrm{ext}}(\\tilde{X}) = \\mathrm{Var}(\\mathrm{E}[\\tilde{X}|Z]) $$\n- 测量噪声 $\\epsilon$ 独立于真实生物学状态 $\\tilde{X}$ 是此类分析中的一个标准且必要的假设。\n- 由于其独立性，总观测方差由 $\\mathrm{Var}(X) = \\mathrm{Var}(\\tilde{X} + \\epsilon) = \\mathrm{Var}(\\tilde{X}) + \\mathrm{Var}(\\epsilon)$ 给出。代入生物学方差分解，我们得到：\n    $$ \\mathrm{Var}(X) = \\mathrm{Var}_{\\mathrm{int}}(\\tilde{X}) + \\mathrm{Var}_{\\mathrm{ext}}(\\tilde{X}) + \\mathrm{Var}(\\epsilon) $$\n- 这个问题具有科学依据，提法明确且客观。它提出了一个关于在不同实验情景下参数可识别性的清晰问题，这是该领域一个重要且根本性的挑战。问题陈述是有效的。\n\n让我们将三个未知量表示为 $V_{int} = \\mathrm{Var}_{\\mathrm{int}}(\\tilde{X})$、$V_{ext} = \\mathrm{Var}_{\\mathrm{ext}}(\\tilde{X})$ 和 $V_{meas} = \\mathrm{Var}(\\epsilon)$。目标是找到一个实验设计，能够从可观测的数据矩（方差、协方差）中提供足够多的独立方程，以唯一地解出这三个未知数。\n\n**A. 单一快照，每个细胞单个报告基因，无外部校准。**\n- 该设计对每个细胞产生一个随机变量 $X$。从一个细胞群体中，我们可以估计 $X$ 的矩，最重要的是其方差 $\\mathrm{Var}(X)$。\n- 我们从二阶矩得到一个方程：$\\mathrm{Var}(X) = V_{int} + V_{ext} + V_{meas}$。\n- 有三个未知数（$V_{int}$, $V_{ext}$, $V_{meas}$）但只有一个方程。该系统是欠定的。\n- 该选项建议拟合一个参数族可以解决这个问题。这通常是错误的。例如，如果 $\\tilde{X}$ 和 $\\epsilon$ 都是高斯分布，那么 $X$ 也将是高斯分布。$X$ 的分布由其均值和方差描述。方差只提供了三个分量的和，而不是分量本身。如果没有关于分布具体函数形式的强有力的（且很可能是不合理的）假设，唯一的分解是不可能的。\n- **结论：错误。**\n\n**B. 双报告基因快照，有外部校准。**\n- 该设计对每个细胞提供两个测量值 $(X_1, X_2)$。\n- 模型为 $X_1 = \\tilde{X}_1 + \\epsilon_1$ 和 $X_2 = \\tilde{X}_2 + \\epsilon_2$。\n- 关键假设：\n    - $\\epsilon_1, \\epsilon_2$ 相互独立，且与真实信号独立，其方差 $\\mathrm{Var}(\\epsilon_1) = \\mathrm{Var}(\\epsilon_2) = V_{meas}$，其中 $V_{meas}$ 已知。\n    - 在潜在状态 $Z$ 的条件下，$\\tilde{X}_1$ 和 $\\tilde{X}_2$ 是独立同分布 (i.i.d.) 的。\n- 让我们计算可观测的矩。由于报告基因是独立同分布的，所以 $\\mathrm{Var}(X_1) = \\mathrm{Var}(X_2)$。\n    $$ \\mathrm{Var}(X_1) = \\mathrm{Var}(\\tilde{X}_1) + \\mathrm{Var}(\\epsilon_1) = (V_{int} + V_{ext}) + V_{meas} $$\n- 这提供了一个方程。现在我们计算协方差，这是关键的新信息：\n    $$ \\mathrm{Cov}(X_1, X_2) = \\mathrm{Cov}(\\tilde{X}_1 + \\epsilon_1, \\tilde{X}_2 + \\epsilon_2) = \\mathrm{Cov}(\\tilde{X}_1, \\tilde{X}_2) $$\n    其他协方差项由于测量误差的独立性而为零。\n- 我们使用全协方差公式：\n    $$ \\mathrm{Cov}(\\tilde{X}_1, \\tilde{X}_2) = \\mathrm{E}[\\mathrm{Cov}(\\tilde{X}_1, \\tilde{X}_2 | Z)] + \\mathrm{Cov}(\\mathrm{E}[\\tilde{X}_1 | Z], \\mathrm{E}[\\tilde{X}_2 | Z]) $$\n    - 根据在给定 $Z$ 的条件下 $\\tilde{X}_1$ 和 $\\tilde{X}_2$ 条件独立的假设，项 $\\mathrm{Cov}(\\tilde{X}_1, \\tilde{X}_2 | Z) = 0$，因此 $\\mathrm{E}[\\mathrm{Cov}(\\tilde{X}_1, \\tilde{X}_2 | Z)] = 0$。这反映了两个报告基因的内在噪声是独立的。\n    - 由于 $\\tilde{X}_1$ 和 $\\tilde{X}_2$ 是独立同分布的，它们有相同的条件均值，我们称之为 $\\mu(Z) = \\mathrm{E}[\\tilde{X}_1 | Z] = \\mathrm{E}[\\tilde{X}_2 | Z]$。第二项变为 $\\mathrm{Cov}(\\mu(Z), \\mu(Z)) = \\mathrm{Var}(\\mu(Z)) = \\mathrm{Var}(\\mathrm{E}[\\tilde{X}|Z])$。根据定义，这就是外在方差 $V_{ext}$。\n- 因此，我们得到了关键结果：$\\mathrm{Cov}(X_1, X_2) = V_{ext}$。\n- 现在我们有一个由两个可测量量（$\\mathrm{Var}(X_1)$ 和 $\\mathrm{Cov}(X_1, X_2)$）和一个已知量（$V_{meas}$）组成的方程组：\n    1.  $\\mathrm{Var}(X_1) = V_{int} + V_{ext} + V_{meas}$\n    2.  $\\mathrm{Cov}(X_1, X_2) = V_{ext}$\n- 从经验数据中，我们估计 $\\widehat{\\mathrm{Var}}(X_1)$ 和 $\\widehat{\\mathrm{Cov}}(X_1, X_2)$。我们可以解出未知数：\n    - $\\hat{V}_{ext} = \\widehat{\\mathrm{Cov}}(X_1, X_2)$\n    - $\\hat{V}_{int} = \\widehat{\\mathrm{Var}}(X_1) - \\widehat{\\mathrm{Cov}}(X_1, X_2) - V_{meas}$ (因为 $V_{meas}$ 已知)\n- 所有三个方差分量都是可识别的。\n- **结论：正确。**\n\n**C. 双报告基因快照，无外部校准。**\n- 这与 B 中的设置相同，但现在 $V_{meas}$ 是一个未知数。\n- 我们从可测量的矩得到相同的两个方程：\n    1.  $\\mathrm{Var}(X_1) = V_{int} + V_{ext} + V_{meas}$\n    2.  $\\mathrm{Cov}(X_1, X_2) = V_{ext}$\n- 我们有两个方程但有三个未知数（$V_{int}, V_{ext}, V_{meas}$）。我们可以从协方差中识别出 $V_{ext}$。将其代入第一个方程得到 $\\mathrm{Var}(X_1) - \\mathrm{Cov}(X_1, X_2) = V_{int} + V_{meas}$。我们可以确定内在方差和测量方差的和，但无法将它们分开。该系统是欠定的。\n- **结论：错误。**\n\n**D. 单报告基因的时间序列，有外部校准。**\n- 该设计在两个足够分离的时间点测量同一个报告基因，得到 $(X^{(1)}, X^{(2)})$。\n- 其假设在数学上与双报告基因情况类似：\n    - $V_{meas} = \\mathrm{Var}(\\epsilon^{(1)}) = \\mathrm{Var}(\\epsilon^{(2)})$ 是已知的。\n    - 在两个时间点之间，细胞的外在状态 $Z$ 是恒定的。\n    - 时间间隔足够长，以至于内在波动是独立的，即在给定 $Z$ 的条件下，$\\tilde{X}^{(1)}$ 和 $\\tilde{X}^{(2)}$ 是独立的。由于平稳性，它们也被假定为独立同分布。\n- 推导过程与选项 B 中的相同，只是用时间点代替了报告基因的索引。\n- $\\mathrm{Var}(X^{(1)}) = V_{int} + V_{ext} + V_{meas}$。\n- $\\mathrm{Cov}(X^{(1)}, X^{(2)}) = V_{ext}$。\n- 由于 $V_{meas}$ 已知，该系统对于 $V_{int}$ 和 $V_{ext}$ 是可解的，就像选项 B 一样。所有三个方差分量都是可识别的。\n- **结论：正确。**\n\n**E. 单一快照，带技术重复。**\n- 该设计对每个细胞的*同一个*固定样本提供两个技术重复测量值，$(X^{(a)}, X^{(b)})$。\n- 模型是 $X^{(a)} = \\tilde{X} + \\epsilon^{(a)}$ 和 $X^{(b)} = \\tilde{X} + \\epsilon^{(b)}$。与双报告基因情况的关键区别在于，两次测量的真实生物学量 $\\tilde{X}$ 是相同的，而不是一个新的随机抽取。$\\tilde{X}$ 是一个跨细胞的随机变量，但对于单个细胞的两次重复测量是固定的。\n- 所描述的程序是首先通过细胞内差异来估计 $V_{meas}$。差异为 $D = X^{(a)} - X^{(b)} = \\epsilon^{(a)} - \\epsilon^{(b)}$。其方差为 $\\mathrm{Var}(D) = \\mathrm{Var}(\\epsilon^{(a)}) + \\mathrm{Var}(\\epsilon^{(b)}) = 2V_{meas}$（假设误差独立同分布）。因此，确实可以从这些差异的样本方差中估计出 $V_{meas}$。\n- 选项描述中的下一步是从“$X$ 的跨细胞方差”中减去这个估计的 $V_{meas}$ 以获得 $\\mathrm{Var}_{\\mathrm{ext}}(\\tilde{X})$。让我们分析一下 $X^{(a)}$ 的跨细胞方差：\n    $$ \\mathrm{Var}(X^{(a)}) = \\mathrm{Var}(\\tilde{X} + \\epsilon^{(a)}) = \\mathrm{Var}(\\tilde{X}) + \\mathrm{Var}(\\epsilon^{(a)}) = (V_{int} + V_{ext}) + V_{meas} $$\n    减去 $V_{meas}$ 得到 $\\mathrm{Var}(X^{(a)}) - V_{meas} = V_{int} + V_{ext}$。这给出的是总生物学方差 $\\mathrm{Var}(\\tilde{X})$，而不是声称的外在方差 $V_{ext}$。选项中的陈述在事实上是错误的。\n- 让我们检查一下，抛开这个有缺陷的描述，我们是否能用这种设计分离 $V_{int}$ 和 $V_{ext}$。我们需要另一个方程。让我们使用协方差：\n    $$ \\mathrm{Cov}(X^{(a)}, X^{(b)}) = \\mathrm{Cov}(\\tilde{X} + \\epsilon^{(a)}, \\tilde{X} + \\epsilon^{(b)}) = \\mathrm{Cov}(\\tilde{X}, \\tilde{X}) = \\mathrm{Var}(\\tilde{X}) $$\n    这得到 $\\mathrm{Cov}(X^{(a)}, X^{(b)}) = V_{int} + V_{ext}$。这与我们从 $\\mathrm{Var}(X^{(a)}) - V_{meas}$ 中得到的信息相同。没有新的独立方程来分离 $V_{int}$ 和 $V_{ext}$。这种设计允许将测量噪声与总生物学噪声分开，但不能将生物学噪声分解为其内在和外在分量。\n- **结论：错误。**", "answer": "$$\\boxed{BD}$$", "id": "3348928"}, {"introduction": "这是我们将理论付诸实践的最后一步。我们已经掌握了理论基础和实验设计概念，现在是时候分析具体数据了。本练习将运用双报告基因系统，并提供一个框架，通过矩量法（method of moments）直接从汇总统计数据（均值、方差、协方差）中估计噪声模型的参数。它将巩固你对如何利用两个报告基因之间的协方差来量化共享外在噪声的理解。[@problem_id:3348950]", "problem": "考虑一个最简双基因单细胞表达模型，其中内在噪声源于条件泊松计数，而外在噪声源于一个共享乘法因子的细胞间差异。对于基因 $i \\in \\{1,2\\}$，令其 mRNA 计数为一个随机变量 $X_i$。假设在外在因子 $Z$ 的条件下，$X_i \\mid Z \\sim \\mathrm{Poisson}(c_i Z)$，其中 $c_i > 0$ 是一个基因特异性的基础转录标度。假设 $Z$ 严格为正且为两个基因所共享，并且 $Z \\sim \\mathrm{LogNormal}(\\mu, \\sigma^2)$，即 $\\ln Z \\sim \\mathcal{N}(\\mu, \\sigma^2)$。同时假设在给定 $Z$ 的情况下，$X_1$ 和 $X_2$ 条件独立，并且外在因子 $Z$ 独立于所有内在波动。\n\n现有从一个大群体中估计得到的单细胞汇总统计量：样本均值 $\\bar{x}_1, \\bar{x}_2$，样本方差 $s_1^2, s_2^2$，以及样本协方差 $s_{12}$。假设法诺因子 $F_i = s_i^2 / \\bar{x}_i$ 满足 $F_i > 1$ 且 $s_{12} > 0$。请仅使用全期望定律、全方差定律、全协方差定律以及泊松随机变量的条件方差，为外在分布的参数和基因特异性标度推导一个矩匹配估计量。由于乘积 $(c_i, Z)$ 仅在相差一个乘法常数的情况下才是可辨识的，因此在报告对数正态分布的参数时，请施加可辨识性约束 $\\mathbb{E}[Z] = 1$。在此约束下，报告推断出的 $Z$ 的参数 $(\\sigma^2, \\mu)$ 以及 $(c_1, c_2)$。\n\n您的程序必须：\n- 仅从上述定义以及全期望、全方差和全协方差定律出发，实现推导过程，并计算在约束 $\\mathbb{E}[Z] = 1$ 下 $(\\sigma^2, \\mu, c_1, c_2)$ 的矩匹配估计值。\n- 将该估计量应用于以下每个测试用例，其中每个用例以 5 元组 $(\\bar{x}_1, s_1^2, \\bar{x}_2, s_2^2, s_{12})$ 的形式给出：\n  - 情况 A：$(5.0, 21.218031767503205, 8.0, 49.518161324808206, 25.948850828005126)$。\n  - 情况 B：$(2.0, 2.040200668336672, 3.0, 3.090451503757512, 0.060301002505008)$。\n  - 情况 C：$(1.5, 6.720263076157231, 0.8, 2.2848748305513904, 2.7841403072838565)$。\n  - 情况 D：$(30.0, 229.26248234415295, 60.0, 857.0499293766118, 398.52496468830597)$。\n- 对于每个用例，输出列表 $[\\sigma^2, \\mu, c_1, c_2]$，其中每个实数都四舍五入到恰好 6 位小数。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含按 A、B、C、D 顺序排列的各用例的四元组结果，以逗号分隔，并用方括号括起来。具体来说，输出必须看起来像一个列表的顶层列表，例如 $[[\\dots],[\\dots],[\\dots],[\\dots]]$，其中每个浮点数都四舍五入到恰好 6 位小数。", "solution": "该问题是有效的，因为它具有科学依据、是良定的且客观的。它代表了计算系统生物学中一个标准问题，即从双报告基因单细胞数据中分解噪声来源。我们接下来推导矩匹配估计量。\n\n该模型由以下几点定义：\n1.  基因 $i \\in \\{1,2\\}$ 的 mRNA 计数：一个随机变量 $X_i$。\n2.  条件分布（内在噪声）：$X_i \\mid Z \\sim \\mathrm{Poisson}(c_i Z)$，其中 $c_i > 0$。\n3.  外在因子分布：$Z \\sim \\mathrm{LogNormal}(\\mu, \\sigma^2)$，其中 $Z > 0$。\n4.  条件独立性：在给定 $Z$ 的情况下，$X_1$ 和 $X_2$ 相互独立。\n5.  可辨识性约束：$\\mathbb{E}[Z] = 1$。\n\n我们将使用泊松分布和对数正态分布的性质，以及全期望、全方差和全协方差定律。对于一个随机变量 $W \\sim \\mathrm{Poisson}(\\lambda)$，其均值和方差分别为 $\\mathbb{E}[W] = \\lambda$ 和 $\\mathrm{Var}(W) = \\lambda$。\n\n步骤 $1$：推导 $X_i$ 均值的表达式。\n使用全期望定律 $\\mathbb{E}[X] = \\mathbb{E}[\\mathbb{E}[X \\mid Y]]$：\n$$ \\mathbb{E}[X_i] = \\mathbb{E}[\\mathbb{E}[X_i \\mid Z]] $$\n给定 $X_i \\mid Z \\sim \\mathrm{Poisson}(c_i Z)$，条件均值为 $\\mathbb{E}[X_i \\mid Z] = c_i Z$。\n$$ \\mathbb{E}[X_i] = \\mathbb{E}[c_i Z] = c_i \\mathbb{E}[Z] $$\n应用可辨识性约束 $\\mathbb{E}[Z] = 1$，我们得到均值的简单表达式：\n$$ \\mathbb{E}[X_i] = c_i $$\n\n步骤 $2$：推导 $X_i$ 方差的表达式。\n使用全方差定律 $\\mathrm{Var}(X) = \\mathbb{E}[\\mathrm{Var}(X \\mid Y)] + \\mathrm{Var}(\\mathbb{E}[X \\mid Y])$：\n$$ \\mathrm{Var}(X_i) = \\mathbb{E}[\\mathrm{Var}(X_i \\mid Z)] + \\mathrm{Var}(\\mathbb{E}[X_i \\mid Z]) $$\n第一项，即条件方差的均值，对应于内在噪声。对于一个服从泊松分布的变量，$\\mathrm{Var}(X_i \\mid Z) = \\mathbb{E}[X_i \\mid Z] = c_i Z$。\n$$ \\mathbb{E}[\\mathrm{Var}(X_i \\mid Z)] = \\mathbb{E}[c_i Z] = c_i \\mathbb{E}[Z] = c_i $$\n第二项，即条件均值的方差，对应于外在噪声。我们有 $\\mathbb{E}[X_i \\mid Z] = c_i Z$。\n$$ \\mathrm{Var}(\\mathbb{E}[X_i \\mid Z]) = \\mathrm{Var}(c_i Z) = c_i^2 \\mathrm{Var}(Z) $$\n将这些结合起来，总方差是内在和外在分量的总和：\n$$ \\mathrm{Var}(X_i) = c_i + c_i^2 \\mathrm{Var}(Z) = \\mathbb{E}[X_i] + (\\mathbb{E}[X_i])^2 \\mathrm{Var}(Z) $$\n\n步骤 $3$：推导 $X_1$ 和 $X_2$ 协方差的表达式。\n使用全协方差定律 $\\mathrm{Cov}(X, Y) = \\mathbb{E}[\\mathrm{Cov}(X, Y \\mid Z)] + \\mathrm{Cov}(\\mathbb{E}[X \\mid Z], \\mathbb{E}[Y \\mid Z])$：\n$$ \\mathrm{Cov}(X_1, X_2) = \\mathbb{E}[\\mathrm{Cov}(X_1, X_2 \\mid Z)] + \\mathrm{Cov}(\\mathbb{E}[X_1 \\mid Z], \\mathbb{E}[X_2 \\mid Z]) $$\n问题陈述中指出，在给定 $Z$ 的情况下，$X_1$ 和 $X_2$ 是条件独立的，所以 $\\mathrm{Cov}(X_1, X_2 \\mid Z) = 0$。因此第一项为 $\\mathbb{E}[0] = 0$。协方差仅源于共享的外在因子 $Z$：\n$$ \\mathrm{Cov}(X_1, X_2) = \\mathrm{Cov}(c_1 Z, c_2 Z) = c_1 c_2 \\mathrm{Var}(Z) $$\n\n步骤 $4$：构建矩匹配估计量。\n我们将推导出的理论矩与给定的样本矩 $(\\bar{x}_1, \\bar{x}_2, s_1^2, s_2^2, s_{12})$ 相等。\n根据步骤 $1$，我们估计基因特异性标度 $c_i$：\n$$ \\hat{c}_1 = \\bar{x}_1 $$\n$$ \\hat{c}_2 = \\bar{x}_2 $$\n根据步骤 $3$，我们可以使用样本协方差 $s_{12}$ 以及我们对 $c_1$ 和 $c_2$ 的估计来估计 $\\mathrm{Var}(Z)$：\n$$ s_{12} = \\hat{c}_1 \\hat{c}_2 \\widehat{\\mathrm{Var}(Z)} = \\bar{x}_1 \\bar{x}_2 \\widehat{\\mathrm{Var}(Z)} $$\n$$ \\widehat{\\mathrm{Var}(Z)} = \\frac{s_{12}}{\\bar{x}_1 \\bar{x}_2} $$\n该估计量分离了共享因子 $Z$ 对协方差的贡献，从而提供了对外在噪声方差的直接度量。\n\n步骤 $5$：确定对数正态分布的参数。\n对于 $Z \\sim \\mathrm{LogNormal}(\\mu, \\sigma^2)$，其均值和方差分别为 $\\mathbb{E}[Z] = e^{\\mu + \\sigma^2/2}$ 和 $\\mathrm{Var}(Z) = (e^{\\sigma^2} - 1)e^{2\\mu + \\sigma^2}$。\n使用约束 $\\mathbb{E}[Z] = 1$：\n$$ e^{\\mu + \\sigma^2/2} = 1 \\implies \\mu + \\frac{\\sigma^2}{2} = 0 \\implies \\mu = -\\frac{\\sigma^2}{2} $$\n将此 $\\mu$ 的结果代入方差公式，可以显著简化该公式：\n$$ \\mathrm{Var}(Z) = (e^{\\sigma^2} - 1)e^{2(-\\sigma^2/2) + \\sigma^2} = (e^{\\sigma^2} - 1)e^{-\\sigma^2 + \\sigma^2} = (e^{\\sigma^2} - 1)e^0 = e^{\\sigma^2} - 1 $$\n现在，我们使其等于我们对 $\\mathrm{Var}(Z)$ 的估计量：\n$$ e^{\\hat{\\sigma}^2} - 1 = \\widehat{\\mathrm{Var}(Z)} = \\frac{s_{12}}{\\bar{x}_1 \\bar{x}_2} $$\n解出 $\\hat{\\sigma}^2$：\n$$ e^{\\hat{\\sigma}^2} = 1 + \\frac{s_{12}}{\\bar{x}_1 \\bar{x}_2} $$\n$$ \\hat{\\sigma}^2 = \\ln\\left(1 + \\frac{s_{12}}{\\bar{x}_1 \\bar{x}_2}\\right) $$\n随后解出 $\\hat{\\mu}$：\n$$ \\hat{\\mu} = -0.5 \\times \\hat{\\sigma}^2 $$\n\n估计量总结：\n1.  $\\hat{c}_1 = \\bar{x}_1$\n2.  $\\hat{c}_2 = \\bar{x}_2$\n3.  $\\hat{\\sigma}^2 = \\ln(1 + s_{12} / (\\bar{x}_1 \\bar{x}_2))$\n4.  $\\hat{\\mu} = -0.5 \\times \\hat{\\sigma}^2$\n\n这些公式在以下程序中被实现，用以计算每个测试用例的参数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and applies moment-matching estimators for a two-gene expression model\n    with intrinsic and extrinsic noise.\n    \"\"\"\n    # Define the test cases from the problem statement as a list of tuples.\n    # Each tuple is (x1_bar, s1_sq, x2_bar, s2_sq, s12).\n    test_cases = [\n        # Case A\n        (5.0, 21.218031767503205, 8.0, 49.518161324808206, 25.948850828005126),\n        # Case B\n        (2.0, 2.040200668336672, 3.0, 3.090451503757512, 0.060301002505008),\n        # Case C\n        (1.5, 6.720263076157231, 0.8, 2.2848748305513904, 2.7841403072838565),\n        # Case D\n        (30.0, 229.26248234415295, 60.0, 857.0499293766118, 398.52496468830597),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        x1_bar, _, x2_bar, _, s12 = case\n\n        # Step 1: Estimate c1 and c2 using the law of total expectation\n        # Under the constraint E[Z]=1, we have E[X_i] = c_i.\n        # We use the sample mean as the estimator for the expectation.\n        c1_hat = x1_bar\n        c2_hat = x2_bar\n\n        # Step 2: Estimate Var(Z) using the law of total covariance\n        # Cov(X1, X2) = c1 * c2 * Var(Z) => Var(Z) = Cov(X1, X2) / (c1 * c2)\n        # Using sample moments as estimators: Var(Z)_hat = s12 / (x1_bar * x2_bar)\n        # The problem constraints (c_i > 0, s12 > 0) ensure the denominator is non-zero\n        # and the argument to log will be > 1.\n        var_z_hat = s12 / (x1_bar * x2_bar)\n\n        # Step 3: Estimate sigma^2 for the LogNormal distribution of Z\n        # For a LogNormal Z ~ LogNormal(mu, sigma^2) with E[Z]=1, we have Var(Z) = exp(sigma^2) - 1.\n        # So, exp(sigma^2) - 1 = Var(Z)_hat\n        # => sigma^2 = log(1 + Var(Z)_hat)\n        sigma2_hat = np.log(1.0 + var_z_hat)\n\n        # Step 4: Estimate mu for the LogNormal distribution of Z\n        # The constraint E[Z] = exp(mu + sigma^2 / 2) = 1 implies mu + sigma^2 / 2 = 0.\n        # => mu = -sigma^2 / 2\n        mu_hat = -sigma2_hat / 2.0\n\n        # Collect the estimated parameters for the current case.\n        case_results = [sigma2_hat, mu_hat, c1_hat, c2_hat]\n        all_results.append(case_results)\n\n    # Format the final output string as a list of lists, with each number\n    # rounded to exactly 6 decimal places, as specified in the problem.\n    final_output_parts = []\n    for result_list in all_results:\n        # Format each number to 6 decimal places.\n        formatted_numbers = [f\"{num:.6f}\" for num in result_list]\n        # Create the string for the inner list, e.g., \"[num1,num2,num3,num4]\".\n        inner_list_str = f\"[{','.join(formatted_numbers)}]\"\n        final_output_parts.append(inner_list_str)\n    \n    # Join the parts for each case with commas and wrap in outer brackets.\n    final_output_str = f\"[{','.join(final_output_parts)}]\"\n\n    print(final_output_str)\n\nsolve()\n```", "id": "3348950"}]}