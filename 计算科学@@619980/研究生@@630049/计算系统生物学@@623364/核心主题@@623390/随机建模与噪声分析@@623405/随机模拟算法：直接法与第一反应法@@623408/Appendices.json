{"hands_on_practices": [{"introduction": "第一反应法是随机模拟算法中的一个基本方法，它通过为每个可能的反应生成一个潜在的发生时间，然后选择最快发生的那个反应来推进系统。本练习将引导您亲手完成这一计算过程。通过手动执行这些步骤，您将具体地理解算法如何将随机数转化为一个模拟的化学事件，从而加深对倾向函数和指数分布等待时间之间联系的理解 [@problem_id:3351938]。", "problem": "考虑一个处于固定离散状态 $x$ 的充分混合反应体系，该体系包含 $M=3$ 个反应通道。在此状态下，（时齐的）反应倾向分别为 $a_1(x)=2$、$a_2(x)=5$ 和 $a_3(x)=3$，单位为 $\\mathrm{s}^{-1}$。在 Gillespie 随机模拟算法（SSA）的“第一反应”法中，我们为每个通道抽取一个独立的均匀分布随机变量 $r_i \\sim \\mathrm{Uniform}(0,1)$，并将其映射为该通道的候选反应发生时间。假设抽取的独立随机数分别为 $r_1=0.2$、$r_2=0.7$ 和 $r_3=0.9$。\n\n从化学主方程（CME）下反应 $i$ 的倾向 $a_i(x)$ 定义为瞬时风险率出发，仅利用指数等待时间的基本性质和逆变换采样法，推导从每个 $r_i$ 到其对应候选等待时间的映射关系。然后，明确确定“第一反应”法的结果 $(\\tau,J)$，其中 $\\tau$ 是到下一次反应发生的时间，$J$ 是发生反应的索引。\n\n请以自然对数形式给出 $\\tau$ 的精确表达式，并以整数形式给出 $J$。时间单位为秒。如果您选择报告 $\\tau$ 的数值近似值，请四舍五入到六位有效数字。", "solution": "此问题经核实具有科学依据、提法明确且客观。所有必要信息均已提供，所要求解的任务是计算系统生物学中随机模拟算法背后理论的一个标准应用。\n\n解答过程分为两部分。首先，我们推导将均匀分布随机数映射到候选反应时间的通用公式。其次，我们将此公式应用于所提供的具体数据，以确定“第一反应”法的结果。\n\n**第一部分：候选等待时间公式的推导**\n\n随机模拟算法（SSA）的基本前提是，对于一个处于给定状态 $x$ 的充分混合系统，每个反应通道 $i$ 的行为都像一个独立的泊松过程。该过程的参数是反应倾向 $a_i(x)$。反应倾向 $a_i(x)$ 的定义为：在系统于时间 $t$ 处于状态 $x$ 的条件下，反应 $i$ 在无穷小时间间隔 $[t, t+dt)$ 内发生的概率为 $a_i(x)dt$。这使得 $a_i(x)$ 成为反应 $i$ 的瞬时风险率。\n\n设 $\\tau_i$ 是表示在没有其他反应发生的情况下，等待下一次反应 $i$ 发生的时间的随机变量。设 $P_i(t')$ 是反应 $i$ 在时间 $t'$ 之前*未*发生的概率。该生存概率的下降速率与该概率本身成正比，比例常数即为风险率 $a_i(x)$。这给出了微分方程：\n$$\n\\frac{dP_i(t')}{dt'} = -a_i(x) P_i(t')\n$$\n这是一个一阶线性常微分方程。在初始条件 $P_i(0)=1$（即在时间 $t'=0$ 时，反应肯定尚未发生）下，其解为：\n$$\nP_i(t') = \\exp(-a_i(x) t')\n$$\n这是随机变量 $\\tau_i$ 的生存函数。累积分布函数（CDF）$F_i(t')$ 给出反应 $i$ 在时间 $t'$ 之前*已经*发生的概率，其表达式为：\n$$\nF_i(t') = 1 - P_i(t') = 1 - \\exp(-a_i(x) t')\n$$\n这是速率参数为 $a_i(x)$ 的指数分布的累积分布函数。\n\n为了从该分布中生成一个样本变量 $\\tau_i$，我们使用逆变换采样法。我们从区间 $(0,1)$ 上的均匀分布中抽取一个随机数 $r_i$，即 $r_i \\sim \\mathrm{Uniform}(0,1)$，并令其等于在所需时间 $\\tau_i$ 处计算的累积分布函数值：\n$$\nr_i = F_i(\\tau_i) = 1 - \\exp(-a_i(x) \\tau_i)\n$$\n我们现在求解这个方程以得到 $\\tau_i$：\n$$\n\\exp(-a_i(x) \\tau_i) = 1 - r_i\n$$\n对两边取自然对数：\n$$\n-a_i(x) \\tau_i = \\ln(1 - r_i)\n$$\n$$\n\\tau_i = -\\frac{1}{a_i(x)} \\ln(1 - r_i)\n$$\n由于 $r_i$ 是 $(0,1)$ 上的均匀分布随机变量，量 $(1 - r_i)$ 也是 $(0,1)$ 上的均匀分布随机变量。因此，为了简化和提高计算效率，我们可以用另一个均匀分布随机变量（不失一般性地，我们也可以称之为 $r_i$）来代替 $(1 - r_i)$。这就得到了标准公式：\n$$\n\\tau_i = -\\frac{1}{a_i(x)} \\ln(r_i) = \\frac{1}{a_i(x)} \\ln\\left(\\frac{1}{r_i}\\right)\n$$\n这就是从一个均匀分布随机数 $r_i$ 到反应通道 $i$ 的候选等待时间 $\\tau_i$ 所需的映射关系。\n\n**第二部分：确定“第一反应”法的结果 $(\\tau, J)$**\n\n“第一反应”法涉及为 $M$ 个反应通道中的每一个计算一个候选时间 $\\tau_i$，然后选择具有最小候选时间的反应作为下一个发生的反应。到下一次反应发生的时间 $\\tau$ 是这些候选时间的最小值，而反应的索引 $J$ 是对应于这个最小时间的索引。\n$$\n\\tau = \\min_{i=1,..,M} \\{\\tau_i\\}\n$$\n$$\nJ = \\arg\\min_{i=1,..,M} \\{\\tau_i\\}\n$$\n我们已知以下数值：\n反应通道数：$M=3$。\n反应倾向：$a_1(x) = 2 \\, \\mathrm{s}^{-1}$、$a_2(x) = 5 \\, \\mathrm{s}^{-1}$ 和 $a_3(x) = 3 \\, \\mathrm{s}^{-1}$。\n随机数：$r_1=0.2$、$r_2=0.7$ 和 $r_3=0.9$。\n\n使用推导出的公式 $\\tau_i = \\frac{1}{a_i(x)} \\ln\\left(\\frac{1}{r_i}\\right)$，我们计算每个通道的候选时间：\n对于通道 1：\n$$\n\\tau_1 = \\frac{1}{a_1(x)} \\ln\\left(\\frac{1}{r_1}\\right) = \\frac{1}{2} \\ln\\left(\\frac{1}{0.2}\\right) = \\frac{1}{2} \\ln(5)\n$$\n对于通道 2：\n$$\n\\tau_2 = \\frac{1}{a_2(x)} \\ln\\left(\\frac{1}{r_2}\\right) = \\frac{1}{5} \\ln\\left(\\frac{1}{0.7}\\right) = \\frac{1}{5} \\ln\\left(\\frac{10}{7}\\right)\n$$\n对于通道 3：\n$$\n\\tau_3 = \\frac{1}{a_3(x)} \\ln\\left(\\frac{1}{r_3}\\right) = \\frac{1}{3} \\ln\\left(\\frac{1}{0.9}\\right) = \\frac{1}{3} \\ln\\left(\\frac{10}{9}\\right)\n$$\n现在我们必须找出 $\\{\\tau_1, \\tau_2, \\tau_3\\}$ 中的最小值。由于 $\\ln(z)$ 是一个单调递增函数，比较 $\\tau_i = \\frac{1}{k_i} \\ln(z_i)$ 等价于比较 $\\ln(z_i^{1/k_i})$。因此，我们需要比较以下参数：\n$z_1^{1/a_1} = 5^{1/2} = \\sqrt{5}$\n$z_2^{1/a_2} = \\left(\\frac{10}{7}\\right)^{1/5}$\n$z_3^{1/a_3} = \\left(\\frac{10}{9}\\right)^{1/3}$\n\n我们来计算这些参数的值：\n$\\sqrt{5} \\approx 2.236$\n$\\left(\\frac{10}{7}\\right)^{1/5} \\approx (1.42857)^{0.2} \\approx 1.0738$\n$\\left(\\frac{10}{9}\\right)^{1/3} \\approx (1.11111)^{0.333...} \\approx 1.0358$\n\n比较这些值，我们发现 $\\left(\\frac{10}{9}\\right)^{1/3}$ 是最小的。\n$$\n\\left(\\frac{10}{9}\\right)^{1/3}  \\left(\\frac{10}{7}\\right)^{1/5}  5^{1/2}\n$$\n因此，根据自然对数的单调性：\n$$\n\\ln\\left(\\left(\\frac{10}{9}\\right)^{1/3}\\right)  \\ln\\left(\\left(\\frac{10}{7}\\right)^{1/5}\\right)  \\ln\\left(5^{1/2}\\right)\n$$\n化简后得到：\n$$\n\\frac{1}{3} \\ln\\left(\\frac{10}{9}\\right)  \\frac{1}{5} \\ln\\left(\\frac{10}{7}\\right)  \\frac{1}{2} \\ln(5)\n$$\n这表明 $\\tau_3  \\tau_2  \\tau_1$。\n\n到下一次反应发生的时间 $\\tau$ 是这些时间中的最小值，而发生反应的索引 $J$ 是该最小时间所对应的索引。\n$$\n\\tau = \\min\\{\\tau_1, \\tau_2, \\tau_3\\} = \\tau_3 = \\frac{1}{3} \\ln\\left(\\frac{10}{9}\\right) \\text{ 秒}\n$$\n$$\nJ = \\arg\\min\\{\\tau_1, \\tau_2, \\tau_3\\} = 3\n$$\n题目要求给出 $\\tau$ 的精确表达式。$\\tau$ 的数值近似值（四舍五入到六位有效数字）约为 $0.0351202 \\, \\mathrm{s}$。要求的输出是精确的解析表达式和整数索引。\n\n“第一反应”法的结果是 $(\\tau, J) = \\left(\\frac{1}{3} \\ln\\left(\\frac{10}{9}\\right), 3\\right)$。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{3}\\ln\\left(\\frac{10}{9}\\right)  3 \\end{pmatrix}}\n$$", "id": "3351938"}, {"introduction": "虽然直接法和下一反应法在数学上是等价的，但它们的计算性能可能存在显著差异，尤其是在处理大型反应网络时。本练习旨在探讨它们之间的一个关键区别：每一步事件所需的随机数数量，以及随着反应通道数量 $M$ 的增加，算法的整体计算复杂度。分析这些性能权衡对于为给定的生物系统选择合适的模拟算法至关重要 [@problem_id:3351967]。", "problem": "考虑一个均匀混合的化学反应网络，该网络被建模为一个连续时间跳跃过程，包含 $M$ 个反应通道 $\\{R_{i}\\}_{i=1}^{M}$ 和状态依赖的倾向函数 $\\{a_{i}(\\boldsymbol{x})\\}_{i=1}^{M}$。令 $a_{0}(\\boldsymbol{x}) = \\sum_{i=1}^{M} a_{i}(\\boldsymbol{x})$ 表示总倾向。始终假设系统在状态空间中演化，其中所有倾向都保持严格为正，即对于所有 $i$ 和轨迹上的所有时间 $t$，都有 $a_{i}(\\boldsymbol{x}(t))  0$，因此没有任何反应通道被禁用。该演化过程使用随机模拟算法 (SSA) 进行模拟，该算法在每次事件中将时间推进一个随机增量，并选择一个通道发生反应。\n\n从以下基本原理出发：\n- 随机时间变换表示：每个反应通道 $R_{i}$ 可以表示为一个单位速率泊松过程，该过程由积分风险率 $\\int_{0}^{t} a_{i}(\\boldsymbol{x}(s)) \\,\\mathrm{d}s$ 进行时间变换。\n- 逆变换采样原理：速率为 $a$ 的指数等待时间可以通过单个均匀分布 $U(0,1)$ 的随机变量 $r$ 经由 $\\tau = -\\frac{1}{a} \\ln(r)$ 获得；对具有概率 $\\{p_{i}\\}_{i=1}^{M}$ 的 $M$ 个结果进行分类选择，可以使用单个 $U(0,1)$ 随机变量和累积阈值来完成。\n\n对于两种 SSA 变体：\n1. 直接法，该方法首先采样下一次反应时间，然后根据当前状态下的瞬时概率 $a_{i}(\\boldsymbol{x})/a_{0}(\\boldsymbol{x})$ 选择反应索引。\n2. 下一反应法 (Gibson–Bruck)，该方法为每个通道 $i$ 维护一个由指数分布的内部时间派生出的预定发生时间，并在倾向发生变化时确定性地更新预定时间，仅当一个通道发生反应时才抽取一个新的随机变量。\n\n请从第一性原理出发，推导在所述假设下，直接法和下一反应法每次执行的反应事件所消耗的独立 $U(0,1)$ 随机变量的期望数量。然后，基于你的推导，讨论当 $M$ 变得很大时对计算性能的渐近影响，特别关注随机数生成在每事件成本中的作用，并将其与每种方法固有的其他算法成本进行对比。以一个行矩阵的形式报告你的最终答案，该矩阵按顺序包含直接法和下一反应法的期望数量。无需四舍五入，最终答案中不包含单位。", "solution": "该问题是有效的，因为它科学地基于已建立的随机化学动力学理论，问题设定良好，目标明确，并且使用了客观、无歧义的语言表述。它提出了对计算系统生物学中两种基石算法的标准、非平凡的比较。\n\n该问题要求推导两种不同的随机模拟算法 (SSA)——直接法 (DM) 和下一反应法 (NRM)——每次反应事件所消耗的随机变量的期望数量。该分析基于使用逆变换采样原理从指定分布生成随机变量的原则。\n\n设系统在时间 $t$ 的状态由物种种群数量向量 $\\boldsymbol{x}(t)$ 描述。系统有 $M$ 个反应通道，反应 $R_i$ 的倾向由 $a_i(\\boldsymbol{x})$ 给出。总倾向为 $a_0(\\boldsymbol{x}) = \\sum_{i=1}^{M} a_i(\\boldsymbol{x})$。我们已知对于所有 $i$ 和 $t$，$a_i(\\boldsymbol{x}(t))  0$。\n\n**1. 直接法 (DM)**\n\n由 Gillespie 发展的直接法通过在每一步重复回答两个问题来模拟系统的轨迹：(1) 下一次反应将在何时发生？(2) 它将是哪个反应？\n\n*   **步骤 1：采样到下一个事件的时间。**\n    到下一次反应事件（任何类型）发生的时间 $\\tau$ 是一个随机变量，服从速率参数等于总倾向 $a_0(\\boldsymbol{x})$ 的指数分布。使用所提供的逆变换采样原理，我们可以从一个均匀分布的随机变量 $r_1 \\sim U(0,1)$ 生成 $\\tau$ 的值。\n    $$ \\tau = -\\frac{1}{a_0(\\boldsymbol{x})} \\ln(r_1) $$\n    此步骤恰好消耗**一个**独立的随机变量 $r_1$。\n\n*   **步骤 2：采样下一次反应的索引。**\n    假定一个反应在时间 $t+\\tau$ 发生，该反应是 $R_i$ 的概率由其倾向与总倾向之比给出，$p_i = a_i(\\boldsymbol{x})/a_0(\\boldsymbol{x})$。因此，选择反应索引 $\\mu \\in \\{1, \\dots, M\\}$ 是从具有概率 $\\{p_i\\}_{i=1}^{M}$ 的分类分布中进行一次抽样。这可以通过使用第二个独立的均匀随机变量 $r_2 \\sim U(0,1)$ 来完成。我们寻找满足以下条件的索引 $\\mu$：\n    $$ \\sum_{i=1}^{\\mu-1} a_i(\\boldsymbol{x})  r_2 \\cdot a_0(\\boldsymbol{x}) \\le \\sum_{i=1}^{\\mu} a_i(\\boldsymbol{x}) $$\n    此步骤恰好消耗**一个**独立的随机变量 $r_2$。\n\n在这两个采样步骤之后，算法根据反应 $R_\\mu$ 的化学计量将时间更新为 $t+\\tau$，并将状态向量 $\\boldsymbol{x}$ 进行更新。这些更新是确定性的。\n\n由于直接法中的每个反应事件都需要执行步骤 1 和步骤 2，因此每次事件消耗的独立 $U(0,1)$ 随机变量总数是恒定的。\nDM 的期望数量 = $1$ (用于时间) + $1$ (用于反应索引) = $2$。\n\n**2. 下一反应法 (NRM)**\n\n下一反应法（也称为 Gibson-Bruck 算法）重新构建了模拟过程以避免冗余计算。它为 $M$ 个反应通道中的每一个维护一个预定的绝对发生时间 $T_i$。这些时间存储在一个数据结构中，通常是一个优先队列，以便高效地检索最小时间。\n\n设系统在时间 $t$ 处于状态 $\\boldsymbol{x}$，预定的发生时间集合为 $\\{T_i\\}_{i=1}^{M}$。单个事件的流程如下：\n\n*   **步骤 1：确定下一个事件。**\n    下一个将要发生的反应 $R_\\mu$ 是具有最小预定发生时间的那个。算法找到索引 $\\mu$ 使得 $T_\\mu = \\min_{j \\in \\{1, \\dots, M\\}} \\{T_j\\}$。事件的时间是 $t_{event} = T_\\mu$。此步骤是确定性搜索，消耗**零个**随机变量。\n\n*   **步骤 2：更新状态和时间。**\n    模拟时间推进到 $t_{event}$，状态向量 $\\boldsymbol{x}$ 根据反应 $R_\\mu$ 的化学计量更新为 $\\boldsymbol{x}'$。这是一个确定性更新。\n\n*   **步骤 3：更新预定的发生时间。**\n    此步骤是 NRM 效率的核心。\n    *   **对于刚刚发生的通道 ($R_\\mu$)：** 必须安排一个新的发生时间。这需要从速率为新倾向 $a_\\mu(\\boldsymbol{x}')$ 的指数分布中生成一个新的随机等待时间 $\\Delta T_\\mu$。使用逆变换采样和一个新的随机变量 $r' \\sim U(0,1)$：\n        $$ \\Delta T_\\mu = -\\frac{1}{a_\\mu(\\boldsymbol{x}')} \\ln(r') $$\n        通道 $\\mu$ 的新绝对预定时间是 $T_\\mu^{\\text{new}} = t_{event} + \\Delta T_\\mu$。这个子步骤恰好消耗**一个**随机变量。\n    *   **对于所有其他通道 ($R_i$，其中 $i \\neq \\mu$)：** 由于状态从 $\\boldsymbol{x}$ 变为 $\\boldsymbol{x}'$，倾向 $a_i$ 可能会改变。NRM 利用随机时间变换表示来确定性地更新它们的预定时间，而无需新的随机数。关键的见解是，底层的“随机性”（先前抽取的随机数未实现的部分）被保留了下来。剩余的发生时间 $(T_i - t_{event})$，它隐含地由旧倾向 $a_i(\\boldsymbol{x})$ 缩放，现在由新倾向 $a_i(\\boldsymbol{x}')$ 重新缩放。新的预定时间 $T_i^{\\text{new}}$ 计算如下：\n        $$ T_i^{\\text{new}} = t_{event} + \\frac{a_i(\\boldsymbol{x})}{a_i(\\boldsymbol{x}')} (T_i - t_{event}) $$\n        此更新完全是确定性的，消耗**零个**随机变量。假设 $a_i  0$ 确保了分母非零。\n\n因此，对于每次执行的反应事件，NRM 恰好抽取一个新的随机数，该随机数用于安排刚刚发生的通道的下一次发生时间。\nNRM 的期望数量 = $1$。\n\n**3. 对计算性能的渐近影响**\n\n以上分析表明，直接法每次事件消耗 2 个随机变量，而下一反应法消耗 1 个。仅从随机数生成 (RNG) 的成本来看，NRM 的效率是前者的两倍。然而，对于大的 $M$，RNG 成本的作用与其他算法成本相比变得微不足道。\n\n*   **随机数生成的作用：** 生成随机数的成本是每次调用 $O(1)$。因此，对于 DM 和 NRM，专门用于 RNG 的每事件总成本相对于 $M$ 都是 $O(1)$。虽然 NRM 有一个更好的常数因子（1 vs 2），但这种差异不影响算法的渐近伸缩性。在现代计算机体系结构中，高质量的伪随机数生成器非常快，使得这种常数因子的差异在总执行时间中只占很小一部分。\n\n*   **其他内在算法成本：** 对于大的 $M$，性能的主导因素是算法非 RNG 部分的伸缩性。\n    *   **直接法：** 在每一步，DM 必须计算所有 $M$ 个倾向以求得它们的和 $a_0$，这是一个 $O(M)$ 操作。随后，它执行线性搜索来选择反应通道，这也是一个 $O(M)$ 操作。因此，DM 的每事件总复杂度为 $O(M)$。\n    *   **下一反应法：** NRM 的性能在很大程度上取决于用于优先队列的数据结构以及反应网络的依赖结构。\n        *   使用二叉堆查找最小时间是 $O(1)$。\n        *   更新时间是主要成本。对于已发生的反应，更新堆的成本是 $O(\\log M)$。对于其他倾向发生变化的反应（假设有 $N_{dep}$ 个这样的反应），每次更新也需要 $O(\\log M)$ 的成本。因此，总成本为 $O((1+N_{dep})\\log M)$。\n        *   在**稀疏网络**中，每个反应只影响少量、恒定数量的其他倾向，$N_{dep}$ 很小，每事件成本为 $O(\\log M)$。这种对数伸缩性是 NRM 的标志性优势，使其在大型稀疏系统中远优于 DM。\n        *   在**密集网络**中，单个反应可能影响几乎所有其他倾向，$N_{dep}$ 接近 $M$，每事件成本变为 $O(M \\log M)$。在这种情况下，NRM 的渐近速度比 $O(M)$ 的直接法要慢。\n\n*   **性能结论：** 渐近性能不是由随机数生成的 $O(1)$ 成本决定的，而是由事件后更新系统状态的算法复杂度决定的。NRM 的真正优势在于其对稀疏网络的 $O(\\log M)$ 伸缩性，这源于它能够避免在每一步都重新评估每个通道。每次事件节省一个随机数是一个次要的好处，在渐近意义上是微不足道的。\n\n推导出的每次事件消耗的随机变量期望数量对于直接法是 $2$，对于下一反应法是 $1$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2  1\n\\end{pmatrix}\n}\n$$", "id": "3351967"}, {"introduction": "对于包含大量反应通道的系统，Gillespie 直接法中的线性搜索步骤可能成为主要的性能瓶颈。本练习将探讨如何使用一种专门的数据结构——芬威克树（Fenwick tree）——来优化这一关键步骤。通过这种方法，更新倾向函数和选择下一个反应的操作都可以在对数时间内完成，从而显著提升模拟效率。理解这类优化策略是开发高效模拟软件和解决大规模系统问题的关键 [@problem_id:3351942]。", "problem": "考虑一个充分混合的生化反应网络，该网络有 $M$ 个反应通道，索引为 $j \\in \\{1,\\dots,M\\}$，系统状态为 $x \\in \\mathbb{N}^N$，化学计量向量为 $v_j \\in \\mathbb{Z}^N$，倾向函数为 $a_j(x) \\ge 0$。随机模拟算法 (SSA) 的直接法形式通过从速率为 $a_0(x) = \\sum_{j=1}^M a_j(x)$ 的指数分布中采样一个等待时间 $\\tau$，然后以概率 $\\mathbb{P}(J=j \\mid x) = a_j(x)/a_0(x)$ 选择一个反应索引 $J$ 来推进系统。在反应 $J$ 发生后，状态更新为 $x \\leftarrow x + v_J$，并且对于那些速率依赖于更新后状态的通道，其倾向函数 $a_j(x)$ 会被重新计算。\n\n为了在动态变化的倾向函数下降低反应选择的计算成本，考虑在倾向函数数组 $\\{a_j(x)\\}_{j=1}^M$ 上维护一个二叉索引树 (BIT)，也称为 Fenwick 树。Fenwick 树通过在一个按二进制低位划分进行索引的结构化数组中存储部分和，从而支持在对数时间内对条目进行点更新和计算数组的前缀和。\n\n仅使用上述基本定义以及直接法选择必须抽取 $J$ 使得 $\\mathbb{P}(J=j \\mid x) = a_j(x)/a_0(x)$ 的要求，评估以下关于为具有动态倾向函数的 SSA 使用 Fenwick 树的陈述。选择所有正确的陈述。\n\nA. 在 $\\{a_j(x)\\}$ 上维护一个 Fenwick 树，能够通过定位最小的索引 $j$（其前缀和满足 $\\sum_{k=1}^j a_{k}(x) \\ge u \\, a_0(x)$，其中 $u \\sim \\mathrm{Uniform}(0,1)$ 是一个均匀分布的随机变量），在 $O(\\log M)$ 时间内对 $J$ 进行逆变换采样，并支持在 $O(\\log M)$ 时间内进行点更新 $a_k(x) \\leftarrow a_k(x) + \\Delta$。\n\nB. Fenwick 树方法会引入选择偏差，除非所有条目都满足 $a_j(x)  0$，因为零倾向函数会破坏执行基于累积和的逆变换采样所需的单调性。\n\nC. 如果倾向 $\\{a_j(x)\\}$ 是独立同分布的随机变量，则在选择过程中访问的 Fenwick 树节点的期望数量为 $O(1)$，这意味着每次选择的平均时间复杂度为 $O(1)$。\n\nD. 将 $a_0(x)$ 维护在一个单独的标量变量中，并用应用于单个变化的倾向 $a_k(x)$ 的相同增量 $\\Delta$ 来更新它，这确保了采样 $\\tau \\sim \\mathrm{Exp}(a_0(x))$ 需要 $O(1)$ 时间，而通过 Fenwick 树选择 $J$ 每个事件需要 $O(\\log M)$ 时间。\n\nE. 对于第一反应法，将每个反应的指数时钟替换为在 $\\{a_j(x)\\}$ 上构建的 Fenwick 树，会产生 $O(\\log M)$ 的更新，并在速率变化后无需重采样即可保持精确的最小时间选择，因为指数随机变量的最小值仅取决于 $a_0(x)$。", "solution": "在进行求解之前，需要对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n- 一个充分混合的生化反应网络。\n- 反应通道数：$M$。\n- 反应通道索引：$j \\in \\{1, \\dots, M\\}$。\n- 系统状态：$x \\in \\mathbb{N}^N$。\n- 化学计量向量：$v_j \\in \\mathbb{Z}^N$。\n- 倾向函数：$a_j(x) \\ge 0$。\n- 总倾向：$a_0(x) = \\sum_{j=1}^M a_j(x)$。\n- 随机模拟算法 (SSA)，直接法：\n    1. 采样等待时间 $\\tau \\sim \\mathrm{Exp}(a_0(x))$。\n    2. 以概率 $\\mathbb{P}(J=j \\mid x) = a_j(x)/a_0(x)$ 选择反应索引 $J$。\n    3. 更新状态：$x \\leftarrow x + v_J$。\n    4. 为受影响的通道重新计算倾向函数 $a_j(x)$。\n- 提议的数据结构：基于倾向函数数组 $\\{a_j(x)\\}_{j=1}^M$ 的二叉索引树 (Fenwick 树)。\n- Fenwick 树属性：支持在对数时间内进行点更新和前缀和计算。\n\n### 步骤 2：使用提取的已知条件进行验证\n1.  **科学依据：** 该问题描述了用于随机模拟的 Gillespie 直接法以及用于其优化的标准计算数据结构 (Fenwick 树)。这是计算系统生物学中一个成熟的课题，并基于可靠的数学和算法原理。\n2.  **适定性：** 该问题提供了清晰的背景，并要求对有关算法选择性能和正确性的具体、形式化的陈述进行评估。每个陈述都可以确定唯一的答案。\n3.  **客观性：** 该问题用精确、客观的语言陈述，没有主观或模棱两可的术语。\n4.  **缺陷检查表：**\n    - 问题没有违反任何科学原理。对 SSA 和 Fenwick 树的描述是准确的。\n    - 它与随机模拟算法的主题直接相关。\n    - 设置是自洽且一致的。\n    - 提议的算法组合是实用且现实的。\n    - 问题结构良好，其问题并非非良构的。\n    - 问题并非无足轻重，需要对 SSA 和数据结构复杂性都有所了解。\n    - 所有论断都可以通过算法分析来验证。\n\n### 步骤 3：结论与行动\n问题陈述有效。将推导完整的解决方案。\n\n### 推导与逐项分析\n\n直接法选择步骤的核心任务是从一个离散概率分布中抽取一个反应索引 $J$，其中 $\\mathbb{P}(J=j) = p_j = a_j(x) / a_0(x)$。一种标准且精确的方法是逆变换采样。这涉及到生成一个均匀分布的随机变量 $u \\sim \\mathrm{Uniform}(0,1)$，并找到满足以下条件的唯一索引 $j$：\n$$\n\\sum_{k=1}^{j-1} p_k  u \\le \\sum_{k=1}^{j} p_k\n$$\n乘以 $a_0(x)$，这等价于找到满足以下条件的最小索引 $j$：\n$$\n\\sum_{k=1}^{j} a_k(x) \\ge u \\cdot a_0(x)\n$$\nFenwick 树是非常适合这项任务的数据结构。它可以在 $O(\\log M)$ 时间内计算任意前缀和 $\\sum_{k=1}^j a_k(x)$，并在 $O(\\log M)$ 时间内更新任意单个倾向 $a_k(x)$。\n\n**A. 在 $\\{a_j(x)\\}$ 上维护一个 Fenwick 树，能够通过定位最小的索引 $j$（其前缀和满足 $\\sum_{k=1}^j a_{k}(x) \\ge u \\, a_0(x)$，其中 $u \\sim \\mathrm{Uniform}(0,1)$ 是一个均匀分布的随机变量），在 $O(\\log M)$ 时间内对 $J$ 进行逆变换采样，并支持在 $O(\\log M)$ 时间内进行点更新 $a_k(x) \\leftarrow a_k(x) + \\Delta$。**\n\n所描述的过程是反应选择步骤中逆变换采样的正确实现。为了找到索引 $j$，我们需要搜索最小的 $j$，使其前缀和大于或等于目标值 $T = u \\cdot a_0(x)$。虽然在索引上进行朴素的二分搜索并结合前缀和查询需要 $O((\\log M)^2)$ 时间，但在 Fenwick 树结构本身上进行专门的搜索（类似于二分提升）可以在 $O(\\log M)$ 时间内找到这个索引。问题陈述给出了 Fenwick 树支持在对数时间内进行点更新的属性。当一个倾向 $a_k(x)$ 更新一个量 $\\Delta$ 时，这对应于树上的一个点更新，这确实需要 $O(\\log M)$ 时间。该陈述准确地描述了为此目的使用 Fenwick 树时关键操作的时间复杂度。\n\n因此，陈述 A 是**正确的**。\n\n**B. Fenwick 树方法会引入选择偏差，除非所有条目都满足 $a_j(x)  0$，因为零倾向函数会破坏执行基于累积和的逆变换采样所需的单调性。**\n\n这个陈述是错误的。累积和函数 $S(j) = \\sum_{k=1}^j a_k(x)$ 是为非负倾向 $a_k(x) \\ge 0$ 定义的。一个或多个 $a_k(x) = 0$ 的存在不会破坏 $S(j)$ 的定义属性，即它是单调不减的（即，对于所有 $j  1$，$S(j) \\ge S(j-1)$）。如果 $a_k(x) = 0$，则 $S(k) = S(k-1)$。在逆变换采样方案中，对应于反应 $k$ 的累积和区间是 $[\\sum_{i=1}^{k-1} a_i(x), \\sum_{i=1}^{k} a_i(x))$。如果 $a_k(x) = 0$，这个区间的宽度为零。随机目标值 $u \\cdot a_0(x)$ 落入此区间的概率为 $0$，这正确地反映了选择反应 $k$ 的概率是 $a_k(x)/a_0(x) = 0$。对于任何满足 $a_j(x) \\ge 0$ 的倾向集合，该方法都保持无偏和精确。\n\n因此，陈述 B 是**错误的**。\n\n**C. 如果倾向 $\\{a_j(x)\\}$ 是独立同分布的随机变量，则在选择过程中访问的 Fenwick 树节点的期望数量为 $O(1)$，这意味着每次选择的平均时间复杂度为 $O(1)$。**\n\nFenwick 树上操作的时间复杂度取决于元素的数量 $M$，而不是存储在其中的值的统计分布。对索引 $k$ 的更新或对截至索引 $k$ 的前缀和的查询所遍历的节点数由 $k$ 的二进制表示决定，其上界为 $O(\\log M)$。类似地，用于选择索引的高效 $O(\\log M)$ 搜索涉及的步数与 $\\log M$ 成正比（基本上是 $M$ 的二进制表示中的每一位对应一步）。这个搜索的路径是基于目标值的确定性路径，但其长度始终是 $O(\\log M)$。没有已知的 Fenwick 树的属性可以根据存储值的分布将此复杂度降低到平均情况下的 $O(1)$。\n\n因此，陈述 C 是**错误的**。\n\n**D. 将 $a_0(x)$ 维护在一个单独的标量变量中，并用应用于单个变化的倾向 $a_k(x)$ 的相同增量 $\\Delta$ 来更新它，这确保了采样 $\\tau \\sim \\mathrm{Exp}(a_0(x))$ 需要 $O(1)$ 时间，而通过 Fenwick 树选择 $J$ 每个事件需要 $O(\\log M)$ 时间。**\n\n这个陈述准确地分解了 SSA 步骤并正确地分析了其复杂度。\n1.  **更新 $a_0(x)$：** 总倾向是 $a_0(x) = \\sum_{j=1}^M a_j(x)$。如果单个倾向 $a_k(x)$ 改变了 $\\Delta$，新的总倾向是 $a_0'(x) = a_0(x) + \\Delta$。将 $a_0(x)$ 存储在一个标量变量中并执行这个单一的加法是一个 $O(1)$ 操作。\n2.  **采样 $\\tau$：** 等待时间 $\\tau$ 是通过公式 $\\tau = -\\ln(u)/a_0(x)$ 采样的，其中 $u \\sim \\mathrm{Uniform}(0,1)$。这涉及到生成一个随机数、一个对数和一个除法。这些被认为是常数时间，即 $O(1)$ 的浮点运算。\n3.  **选择 $J$：** 正如在对 A 的分析中所确立的，使用 Fenwick 树选择反应索引 $J$ 需要 $O(\\log M)$ 时间。\n该陈述正确地指出了算法这些不同部分的复杂度。\n\n因此，陈述 D 是**正确的**。\n\n**E. 对于第一反应法，将每个反应的指数时钟替换为在 $\\{a_j(x)\\}$ 上构建的 Fenwick 树，会产生 $O(\\log M)$ 的更新，并在速率变化后无需重采样即可保持精确的最小时间选择，因为指数随机变量的最小值仅取决于 $a_0(x)$。**\n\n这个陈述从根本上误解并混淆了直接法和第一反应法 (FRM)。\n- **直接法：** 每步生成两个随机数：一个用于 $\\tau \\sim \\mathrm{Exp}(a_0(x))$，另一个用于选择 $J$。在 $\\{a_j(x)\\}$ 上的 Fenwick 树是对选择 $J$ 的一种优化。\n- **第一反应法 (FRM)：** 生成 $M$ 个随机数，$\\tau_j \\sim \\mathrm{Exp}(a_j(x))$，每个反应一个。然后找到最小值，$J = \\arg\\min_j\\{\\tau_j\\}$。通常用于管理 $(\\tau_j, j)$ 对的数据结构是最小优先队列，而不是基于倾向函数的 Fenwick 树。\n不可能简单地“用 Fenwick 树替换每个反应的指数时钟”。这些是两种不同算法哲学的组成部分。“因为”子句也具有误导性：虽然最小时间 $\\min_j\\{\\tau_j\\}$ 的*分布*确实是 $\\mathrm{Exp}(a_0(x))$，但正是这个事实使得直接法能够工作。FRM 的工作原理是显式地找到这个最小值。在一个反应发生并且倾向函数改变后，如何处理其他 $M-1$ 个生成的时间是 FRM 的核心挑战，这导致了重采样或时间缩放策略。在 FRM 框架内，Fenwick 树不能解决这个问题。\n\n因此，陈述 E 是**错误的**。", "answer": "$$\\boxed{AD}$$", "id": "3351942"}]}