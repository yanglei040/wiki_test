{"hands_on_practices": [{"introduction": "数值相对论波形目录的一个核心优势在于其普适性。由于真空广义相对论方程的标度无关性，一次数值模拟可以描述具有不同总质量的一整族物理系统。这个练习将通过一个基础推导来巩固这一理解，它将揭示在引力波数据分析中至关重要的啁啾质量 $\\mathcal{M}$ 如何与系统的内在参数（如对称质量比 $\\eta$）和外在标度（总质量 $M$）联系起来。完成这个练习有助于阐明为何以及如何对波形进行标度变换，这是有效使用波形目录的一项基本功。[@problem_id:3481818]", "problem": "考虑一个用于构建数值相对论（NR）波形目录条目的准圆形双黑洞系统。设成员质量为 $m_1$ 和 $m_2$，总质量 $M$ 和对称质量比 $\\eta$ 定义为 $M = m_1 + m_2$ 和 $\\eta = \\frac{m_1 m_2}{M^2}$。在引力波数据分析中广泛使用的啁啾质量定义为 $\\mathcal{M} = \\frac{(m_1 m_2)^{3/5}}{(m_1 + m_2)^{1/5}}$。仅使用这些定义以及在几何化单位（$G = c = 1$）下真空广义相对论（GR）的标度无关特性，推导 $\\mathcal{M}$ 关于 $\\eta$ 和 $M$ 的显式表达式。然后，解释为什么当波形用无量纲时间 $\\hat{t} = t/M$ 表示时，对于任意正常数 $\\alpha$ 进行标度变换 $M \\to \\alpha M$ 会使无量纲数值相对论波形 $h$ 保持不变（除了时间坐标的重新标度和相位原点的平移之外）。对于最终答案，仅提供 $\\mathcal{M}$ 关于 $\\eta$ 和 $M$ 的显式解析表达式。", "solution": "该问题要求完成两个主要任务：第一，推导啁啾质量 $\\mathcal{M}$ 关于总质量 $M$ 和对称质量比 $\\eta$ 的表达式；第二，基于真空广义相对论的标度无关性质，解释来自双黑洞的引力波形的标度性质。\n\n首先，我们来推导 $\\mathcal{M}$、$M$ 和 $\\eta$ 之间的关系。给定的定义是：\n总质量：\n$$M = m_1 + m_2$$\n对称质量比：\n$$\\eta = \\frac{m_1 m_2}{M^2}$$\n啁啾质量：\n$$\\mathcal{M} = \\frac{(m_1 m_2)^{3/5}}{(m_1 + m_2)^{1/5}}$$\n\n我们可以通过将总质量 $M$ 的定义代入啁啾质量 $\\mathcal{M}$ 表达式的分母来开始推导：\n$$\\mathcal{M} = \\frac{(m_1 m_2)^{3/5}}{M^{1/5}}$$\n接下来，我们重新整理对称质量比 $\\eta$ 的定义，用 $\\eta$ 和 $M$ 来表示成员质量的乘积 $m_1 m_2$：\n$$m_1 m_2 = \\eta M^2$$\n现在，我们将这个关于乘积 $m_1 m_2$ 的表达式代入我们关于 $\\mathcal{M}$ 的方程的分子中：\n$$\\mathcal{M} = \\frac{(\\eta M^2)^{3/5}}{M^{1/5}}$$\n利用指数的性质，我们可以简化这个表达式。分子中的项变为 $(\\eta M^2)^{3/5} = \\eta^{3/5} (M^2)^{3/5} = \\eta^{3/5} M^{6/5}$。将其代回得到：\n$$\\mathcal{M} = \\frac{\\eta^{3/5} M^{6/5}}{M^{1/5}}$$\n最后，我们将包含 $M$ 的项合并，方法是用分子中的指数减去分母中的指数：\n$$\\mathcal{M} = \\eta^{3/5} M^{(6/5 - 1/5)} = \\eta^{3/5} M^{5/5} = \\eta^{3/5} M$$\n这就给出了啁啾质量 $\\mathcal{M}$ 关于对称质量比 $\\eta$ 和总质量 $M$ 的显式表达式。\n\n其次，我们解释数值相对论（NR）波形的标度性质。该问题设定在几何化单位（$G=c=1$）的真空广义相对论（GR）框架下。其控制方程是真空爱因斯坦场方程（EFE）：\n$$R_{\\mu\\nu} = 0$$\n其中 $R_{\\mu\\nu}$ 是里奇曲率张量，它依赖于时空度规 $g_{\\mu\\nu}$ 及其导数。真空EFE的一个关键特性是它们是标度无关的。这意味着，如果一个度规 $g_{\\mu\\nu}(x^\\alpha)$ 是描述一个具有特征质量（因而具有特征长度）标度 $M$ 的系统的解，那么对于任意正常数 $\\alpha$，度规 $\\tilde{g}_{\\mu\\nu}(x^\\alpha) = g_{\\mu\\nu}(x^\\alpha / \\alpha)$ 也是EFE的一个解。这个新解 $\\tilde{g}_{\\mu\\nu}$ 描述了一个物理上与原始系统相同，但其所有特征长度和时间标度都被因子 $\\alpha$ 拉伸的系统。因此，它对应于一个总质量为 $\\alpha M$ 的系统。\n\n引力波形 $h$ 代表了远离源的时空度规的微扰。对于一个位于光度距离 $r$ 处的源，物理应变 $h_{\\text{phys}}$ 的振幅正比于总质量 $M$，反比于距离 $r$。波形的时间演化（例如，轨道频率及其变化率）由系统的特征时间标度决定，该时间标度与总质量 $M$ 成正比。\n因此，对于一个由总质量 $M$ 和一个像对称质量比 $\\eta$ 这样的内禀参数所表征的双黑洞系统，其物理波形必须具有以下结构形式：\n$$h_{\\text{phys}}(t, r; M, \\eta) = \\frac{M}{r} \\mathcal{F}\\left(\\frac{t}{M}, \\eta\\right)$$\n在这里，$\\mathcal{F}$ 是一个无量纲函数，它捕捉了旋进、并合和铃振的复杂动力学过程。它的形式仅依赖于质量比 $\\eta$（如果包含自旋，也依赖于自旋）和无量纲时间 $\\hat{t} = t/M$。\n\n现在，考虑在保持 $\\eta$ 不变的情况下重新标度总质量 $M \\to M' = \\alpha M$ 的影响。新的物理波形 $h'_{\\text{phys}}$ 将由下式给出：\n$$h'_{\\text{phys}}(t', r; M', \\eta) = \\frac{M'}{r} \\mathcal{F}\\left(\\frac{t'}{M'}, \\eta\\right) = \\frac{\\alpha M}{r} \\mathcal{F}\\left(\\frac{t'}{\\alpha M}, \\eta\\right)$$\n这表明新的波形仅仅是原始波形的一个放大且时间拉伸的版本。\n\n数值相对论目录的设计正是为了利用这一性质。它们通过剔除对 $M$ 和 $r$ 的显式依赖，提供了一个我们可记为 $h_{\\text{NR}}$ 的“无量纲数值相对论波形”。这通常定义为：\n$$h_{\\text{NR}} = \\frac{r}{M} h_{\\text{phys}}$$\n将此定义应用于我们关于 $h_{\\text{phys}}$ 的表达式，得到：\n$$h_{\\text{NR}}(t; M, \\eta) = \\frac{r}{M} \\left( \\frac{M}{r} \\mathcal{F}\\left(\\frac{t}{M}, \\eta\\right) \\right) = \\mathcal{F}\\left(\\frac{t}{M}, \\eta\\right) = \\mathcal{F}(\\hat{t}, \\eta)$$\n最终的表达式表明，无量纲数值相对论波形，当表示为无量纲时间 $\\hat{t} = t/M$ 的函数时，是一个普适函数 $\\mathcal{F}$，它仅依赖于双星系统的内禀参数（如 $\\eta$），而完全独立于整体质量标度 $M$。这就是为什么重新标度 $M \\to \\alpha M$ 会使这个无量纲表示保持不变。问题陈述中“除了时间坐标的重新标度之外”这句话指的是这样一个事实：对于一个质量为 $M$ 的系统，其物理时间 $t$ 对应于一个质量为 $\\alpha M$ 的系统达到相同演化状态所需的物理时间 $t'=\\alpha t$。一旦两者都被映射到各自的无量纲时间 $\\hat{t}=t/M$ 和 $\\hat{t}'=t'/(\\alpha M)$，波形就是相同的。“平移相位原点”的自由度是一个与双星系统初始轨道相位相关的额外自由度，它是任意的，在比较任何两个波形时都必须考虑到，这与质量标度无关。", "answer": "$$\\boxed{\\eta^{3/5} M}$$", "id": "3481818"}, {"introduction": "在理解了单个波形的基本属性之后，下一步便是如何对它们进行比较，例如将一个数值模拟结果与解析模型或其他模拟进行对比。由于波形的时间零点和初始相位具有任意性，直接比较它们的差异是没有意义的。因此，一个稳健的对齐程序是必不可少的，该程序通过优化时间平移和相位旋转来最小化两个波形之间的差异。本练习将从第一性原理出发，推导这一对齐过程背后的数学机制，这是计算失配度（mismatch）和构建代理模型的关键技术。[@problem_id:3481813]", "problem": "考虑两个复数的数值相对论（NR）引力波模式，表示为在共同区间 $[t_{0}, t_{1}]$ 上的时间序列 $h_{A}(t)$ 和 $h_{B}(t)$。假设两者在 $[t_{0}, t_{1}]$ 上都是平方可积的、带限的，并用一个在边界处为零的非负窗函数 $w(t)$ 进行了锥削。定义加权复内积和诱导的加权 $L^{2}$ 范数如下\n$$\\langle x, y \\rangle_{w} \\equiv \\int_{t_{0}}^{t_{1}} w(t)\\, x(t)\\, y^{*}(t)\\, dt, \\quad \\|x\\|_{w}^{2} \\equiv \\langle x, x \\rangle_{w},$$\n其中 ${}^{*}$ 表示复共轭。为进行时间对齐，令时间平移序列为 $h_{B,\\Delta t}(t) \\equiv h_{B}(t+\\Delta t)$，其中 $\\Delta t$ 以秒为单位表示。为进行相位对齐，应用一个恒定的相位旋转 $e^{i \\Delta \\phi}$，其中 $\\Delta \\phi$ 以弧度为单位表示。考虑对齐代价泛函\n$$J(\\Delta t, \\Delta \\phi) \\equiv \\left\\| h_{A} - e^{i \\Delta \\phi}\\, h_{B,\\Delta t} \\right\\|_{w}^{2}。$$\n在构建和比较数值相对论波形目录条目的背景下，对齐过程旨在寻找 $(\\Delta t, \\Delta \\phi)$，以在物理上合理的平移范围内最小化 $J(\\Delta t, \\Delta \\phi)$。从上述定义以及复内积和最小二乘法最小化的第一性原理出发，推导：\n\n1. 对于固定的 $\\Delta t$，最小化 $J(\\Delta t, \\Delta \\phi)$ 的相移 $\\Delta \\phi^{\\star}(\\Delta t)$ 的闭式表达式。\n2. 相应的最小化代价 $J_{\\min}(\\Delta t)$，作为 $\\Delta t$ 的函数。\n3. 一个关于时间平移 $\\Delta t^{\\star}$ 的闭式方案，该方案在全局上最小化 $J(\\Delta t, \\Delta \\phi)$，并用复内积表示。\n\n您的推导必须是完全符号化的，并基于所提供的定义进行论证，而不假设 $h_{A}$ 或 $h_{B}$ 具有超出所述的特殊性质。最终结果必须用 $\\langle \\cdot, \\cdot \\rangle_{w}$ 和 $\\|\\cdot\\|_{w}$ 表示。最终答案必须是包含三个推导结果的单一解析表达式，无任何数值计算或舍入。$\\Delta t$ 必须以秒表示，$\\Delta \\phi$ 必须以弧度表示。", "solution": "该问题陈述经确认为具有科学依据、良构、客观且自洽，允许进行形式化求解。任务是推导最优相移 $\\Delta \\phi^{\\star}(\\Delta t)$、相应的最小化代价 $J_{\\min}(\\Delta t)$，以及全局最优时间平移 $\\Delta t^{\\star}$，以最小化代价泛函 $J(\\Delta t, \\Delta \\phi) \\equiv \\left\\| h_{A} - e^{i \\Delta \\phi}\\, h_{B,\\Delta t} \\right\\|_{w}^{2}$。\n\n我们首先使用诱导范数的定义 $\\|x\\|_{w}^{2} \\equiv \\langle x, x \\rangle_{w}$ 展开代价泛函。\n$$J(\\Delta t, \\Delta \\phi) = \\langle h_{A} - e^{i \\Delta \\phi}\\, h_{B,\\Delta t}, h_{A} - e^{i \\Delta \\phi}\\, h_{B,\\Delta t} \\rangle_{w}$$\n利用复内积的性质（在第一个参数上是线性的，在第二个参数上是共轭线性的），我们展开该表达式：\n$$J(\\Delta t, \\Delta \\phi) = \\langle h_{A}, h_{A} \\rangle_{w} - \\langle h_{A}, e^{i \\Delta \\phi}\\, h_{B,\\Delta t} \\rangle_{w} - \\langle e^{i \\Delta \\phi}\\, h_{B,\\Delta t}, h_{A} \\rangle_{w} + \\langle e^{i \\Delta \\phi}\\, h_{B,\\Delta t}, e^{i \\Delta \\phi}\\, h_{B,\\Delta t} \\rangle_{w}$$\n我们可以提出标量因子。对于第二项，标量 $e^{i \\Delta \\phi}$ 在第二个参数中，因此其复共轭 $e^{-i \\Delta \\phi}$ 被提出来。对于第三项，标量在第一个参数中，直接提出来。对于第四项，我们从第一个参数中得到 $e^{i \\Delta \\phi}$，从第二个参数中得到 $e^{-i \\Delta \\phi}$。\n$$J(\\Delta t, \\Delta \\phi) = \\|h_{A}\\|_{w}^{2} - e^{-i \\Delta \\phi} \\langle h_{A}, h_{B,\\Delta t} \\rangle_{w} - e^{i \\Delta \\phi} \\langle h_{B,\\Delta t}, h_{A} \\rangle_{w} + e^{i \\Delta \\phi}e^{-i \\Delta \\phi} \\|h_{B,\\Delta t}\\|_{w}^{2}$$\n利用性质 $\\langle y, x \\rangle_{w} = \\langle x, y \\rangle_{w}^{*}$ 以及 $e^{i \\Delta \\phi}e^{-i \\Delta \\phi} = 1$，表达式简化为：\n$$J(\\Delta t, \\Delta \\phi) = \\|h_{A}\\|_{w}^{2} + \\|h_{B,\\Delta t}\\|_{w}^{2} - \\left( e^{-i \\Delta \\phi} \\langle h_{A}, h_{B,\\Delta t} \\rangle_{w} + e^{i \\Delta \\phi} \\langle h_{A}, h_{B,\\Delta t} \\rangle_{w}^{*} \\right)$$\n认识到对于任何复数 $z$，有 $z+z^{*} = 2 \\text{Re}(z)$，我们可以重写括号中的项。令 $z = e^{i \\Delta \\phi} \\langle h_{A}, h_{B,\\Delta t} \\rangle_{w}^{*}$。那么 $z^{*} = e^{-i \\Delta \\phi} \\langle h_{A}, h_{B,\\Delta t} \\rangle_{w}$。所以该项是 $2 \\text{Re}(e^{-i \\Delta \\phi} \\langle h_{A}, h_{B,\\Delta t} \\rangle_{w})$。\n$$J(\\Delta t, \\Delta \\phi) = \\|h_{A}\\|_{w}^{2} + \\|h_{B,\\Delta t}\\|_{w}^{2} - 2 \\text{Re}\\left( e^{-i \\Delta \\phi} \\langle h_{A}, h_{B,\\Delta t} \\rangle_{w} \\right)$$\n\n1. 推导最优相移 $\\Delta \\phi^{\\star}(\\Delta t)$：\n对于一个固定的时间平移 $\\Delta t$，项 $\\|h_{A}\\|_{w}^{2}$ 和 $\\|h_{B,\\Delta t}\\|_{w}^{2}$ 是固定的。为了关于 $\\Delta \\phi$ 最小化 $J(\\Delta t, \\Delta \\phi)$，我们必须最大化被减去的项：$\\text{Re}\\left( e^{-i \\Delta \\phi} \\langle h_{A}, h_{B,\\Delta t} \\rangle_{w} \\right)$。\n令这个固定的 $\\Delta t$ 的复数先验未知内积表示为 $C(\\Delta t) = \\langle h_{A}, h_{B,\\Delta t} \\rangle_{w}$。我们可以将 $C(\\Delta t)$ 写成极坐标形式 $|C(\\Delta t)| e^{i \\theta_C}$，其中 $\\theta_C = \\arg(C(\\Delta t))$。需要最大化的项是：\n$$\\text{Re}\\left( e^{-i \\Delta \\phi} |C(\\Delta t)| e^{i \\theta_C} \\right) = \\text{Re}\\left( |C(\\Delta t)| e^{i(\\theta_C - \\Delta \\phi)} \\right) = |C(\\Delta t)| \\cos(\\theta_C - \\Delta \\phi)$$\n余弦函数的最大值为 $1$，当其参数是 $2\\pi$ 的整数倍时取到。因此，为了最大化，我们设置 $\\theta_C - \\Delta \\phi = 0$，得到 $\\Delta \\phi = \\theta_C$。\n因此，对于给定的 $\\Delta t$，最小化代价的最优相移 $\\Delta \\phi^{\\star}$ 是复内积的辐角：\n$$\\Delta \\phi^{\\star}(\\Delta t) = \\arg\\left( \\langle h_{A}, h_{B,\\Delta t} \\rangle_{w} \\right)$$\n\n2. 推导最小化代价 $J_{\\min}(\\Delta t)$：\n我们将 $\\Delta \\phi^{\\star}(\\Delta t)$ 代入 $J$ 的表达式，得到作为 $\\Delta t$ 函数的后验最小化代价。在最优相位处，$\\cos(\\theta_C - \\Delta \\phi^{\\star}) = \\cos(0) = 1$。最大化的实部变为：\n$$\\text{Re}\\left( e^{-i \\Delta \\phi^{\\star}} \\langle h_{A}, h_{B,\\Delta t} \\rangle_{w} \\right) = |C(\\Delta t)| \\cos(0) = |C(\\Delta t)| = |\\langle h_{A}, h_{B,\\Delta t} \\rangle_{w}|$$\n将此代入 $J$ 的表达式，得到固定 $\\Delta t$ 的最小化代价：\n$$J_{\\min}(\\Delta t) = J(\\Delta t, \\Delta \\phi^{\\star}) = \\|h_{A}\\|_{w}^{2} + \\|h_{B,\\Delta t}\\|_{w}^{2} - 2 |\\langle h_{A}, h_{B,\\Delta t} \\rangle_{w}|$$\n\n3. 推导全局最优时间平移 $\\Delta t^{\\star}$：\n为了找到在所有参数上最小化代价泛函的全局最优时间平移 $\\Delta t^{\\star}$，我们现在必须关于 $\\Delta t$ 最小化 $J_{\\min}(\\Delta t)$。\n$$\\Delta t^{\\star} = \\arg \\min_{\\Delta t} J_{\\min}(\\Delta t) = \\arg \\min_{\\Delta t} \\left( \\|h_{A}\\|_{w}^{2} + \\|h_{B,\\Delta t}\\|_{w}^{2} - 2 |\\langle h_{A}, h_{B,\\Delta t} \\rangle_{w}| \\right)$$\n项 $\\|h_{A}\\|_{w}^{2}$ 相对于 $\\Delta t$ 是一个常数，在最小化过程中可以忽略。然而，$\\|h_{B,\\Delta t}\\|_{w}^{2}$ 和 $|\\langle h_{A}, h_{B,\\Delta t} \\rangle_{w}|$ 都是 $\\Delta t$ 的函数。我们不能假设 $\\|h_{B,\\Delta t}\\|_{w}^{2}$ 是常数，因为定义 $\\|h_{B,\\Delta t}\\|_{w}^{2} \\equiv \\int_{t_{0}}^{t_{1}} w(t)\\, |h_{B}(t+\\Delta t)|^{2}\\, dt$ 清楚地显示了通过 $h_B$ 的参数对 $\\Delta t$ 的依赖性。因此，找到最优时间平移 $\\Delta t^{\\star}$ 的方案是找到最小化完整表达式的 $\\Delta t$ 值。这等价于最大化其负值。通常方便地将其表述为最小化依赖于 $\\Delta t$ 的项：\n$$\\Delta t^{\\star} = \\arg \\min_{\\Delta t} \\left( \\|h_{B,\\Delta t}\\|_{w}^{2} - 2 |\\langle h_{A}, h_{B, \\Delta t} \\rangle_{w}| \\right)$$\n这是一个闭式方案，因为它通过定义的内积，将 $\\Delta t^{\\star}$ 正式定义为一个由问题给定条件构造的函数的最小化者。在实践中，评估这将涉及计算随时间变化的范数和互相关幅度，并在可能的 $\\Delta t$ 搜索范围内找到它们组合的全局最小值。\n\n将这三个结果汇总为解。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\arg(\\langle h_{A}, h_{B, \\Delta t} \\rangle_{w}) \\\\\n\\|h_{A}\\|_{w}^{2} + \\|h_{B, \\Delta t}\\|_{w}^{2} - 2 |\\langle h_{A}, h_{B, \\Delta t} \\rangle_{w}| \\\\\n\\arg \\min_{\\Delta t} \\left( \\|h_{B, \\Delta t}\\|_{w}^{2} - 2 |\\langle h_{A}, h_{B, \\Delta t} \\rangle_{w}| \\right)\n\\end{pmatrix}\n}\n$$", "id": "3481813"}, {"introduction": "数值相对论模拟的原始输出通常不是无穷远处的引力波应变 $h(t)$，而是曲率标量，如魏尔（Weyl）标量 $\\Psi_4$。要获得物理应变，必须对 $\\Psi_4$ 进行两次时间积分，而这一过程充满了数值挑战，例如会引入长期漂移等非物理效应。这个动手编程练习将指导你实现一个稳健的数据处理流程，从给定的 $\\Psi_4(t)$ 数据中恢复出应变 $h(t)$。通过解决这个问题，你将获得处理数值相对论数据的宝贵实践经验，并掌握如加窗、去趋势和滤波等关键信号处理技术。[@problem_id:3481826]", "problem": "给定一个复数时间序列，表示来自数值相对论（NR）波形的纽曼-彭罗斯标量 $\\Psi_4(t)$，其中复数应变为 $h(t) = h_+(t) - i h_\\times(t)$。连接这些量的基本关系是 $\\Psi_4(t) = \\ddot{h}(t)$，其中上方的点表示对时间求导。在时域处理流程中，从 $\\Psi_4(t)$ 恢复 $h(t)$ 需要两次数值积分以及对积分常数的原则性选择，以抑制长期漂移。你的任务是实现并测试一个稳健的时域方法，该方法：\n- 对 $\\Psi_4(t)$ 应用边缘加窗，以减少后续处理中的频谱泄漏。\n- 使用梯形法则执行两次时域积分，以获得初步的应变 $h_0(t)$。\n- 在最小二乘意义上，通过从 $h_0(t)$ 中最优地移除线性趋势来选择积分常数，以最小化长期漂移。\n- 对去趋势后的 $h_0(t)$ 应用一个零相位高通滤波器，以抑制残留的低频污染，而不扭曲感兴趣的物理频带。\n\n起点和约束条件：\n- 复数应变定义为 $h(t) = h_+(t) - i h_\\times(t)$，并且 $\\Psi_4(t) = \\ddot{h}(t)$。输出的应变必须是无量纲的。\n- 时间 $t$ 的单位是秒，频率 $f$ 的单位是赫兹，角相位 $\\phi(t)$ 的单位是弧度。所有角度都必须按弧度处理。\n- 数值积分必须在时域中使用累积梯形法则执行。\n- 边缘窗口必须是一个平滑的锥形窗（例如，Tukey 窗），其特征是一个分数锥度参数 $\\alpha \\in [0,1]$，该参数控制两端的余弦锥形部分的比例。\n- 高通滤波器必须是巴特沃斯（Butterworth）设计，具有指定的阶数和截止频率 $f_c$（单位为赫兹），并使用零相位滤波技术应用。\n- 积分常数的选择必须旨在通过从 $h_0(t)$ 中移除最佳拟合直线 $a t + b$ 来最小化两次积分后信号线性趋势的 $L^2$ 范数，该操作对实部和虚部分别执行。\n\n用于测试的合成数据生成：\n- 对于每个测试用例，构造一个物理上合理的复数应变 $h_{\\text{true}}(t)$，然后通过两次解析时间求导从 $h_{\\text{true}}(t)$ 计算出 $\\Psi_4(t)$。用低频伪影（一个常数偏移、一个线性趋势和一个低频正弦波）污染 $\\Psi_4(t)$，以模拟 NR 目录中典型的提取误差和数值误差。然后应用你的方法从被污染的 $\\Psi_4(t)$ 中恢复 $h(t)$。\n\n$h_{\\text{true}}(t)$ 的模型族：\n1. 线性频率啁啾（chirp）：$A(t) = A_0\\,(1 + \\beta t)$ 和 $f(t) = f_0 + \\alpha t$，相位为 $\\phi(t) = 2\\pi \\left(f_0 t + \\tfrac{1}{2}\\alpha t^2\\right)$。定义 $h_+(t) = A(t)\\cos\\phi(t)$ 和 $h_\\times(t) = A(t)\\sin\\phi(t)$，使得 $h(t) = A(t)e^{-i \\phi(t)}$。\n2. 阻尼正弦波（类铃振（ringdown））：$A(t) = A_0 e^{-t/\\tau}$ 和 $\\phi(t) = 2\\pi f t$，极化约定同上。\n\n$\\Psi_4(t)$ 的解析计算：\n- 对于 $h(t) = A(t)e^{-i\\phi(t)}$，其二阶导数为\n$$\n\\ddot{h}(t) = \\left[A''(t) - 2 i A'(t)\\,\\phi'(t) - i A(t)\\,\\phi''(t) - A(t)\\,(\\phi'(t))^2\\right] e^{-i\\phi(t)},\n$$\n其中撇号表示时间导数。使用此表达式从 $h_{\\text{true}}(t)$ 生成未受污染的 $\\Psi_4(t)$。\n\n$\\Psi_4(t)$ 的污染模型：\n- 向复数 $\\Psi_4(t)$ 中添加一个常数偏移 $c_0$、一个线性趋势 $c_1 t$ 和一个低频正弦波 $s_A \\sin(2\\pi f_{\\text{low}} t)$，以模拟真实的低频污染。\n\n质量度量：\n- 对于每个测试用例，分别针对加号（plus）和交叉（cross）极化，计算恢复出的 $h(t)$ 的相对均方根（RMS）误差，并报告两者的平均值：\n$$\n\\varepsilon_+(t) = \\frac{\\sqrt{\\tfrac{1}{N}\\sum_{k=1}^N \\left(h_{+,k}^{\\text{rec}} - h_{+,k}^{\\text{true}}\\right)^2}}{\\sqrt{\\tfrac{1}{N}\\sum_{k=1}^N \\left(h_{+,k}^{\\text{true}}\\right)^2}}, \\quad\n\\varepsilon_\\times(t) = \\frac{\\sqrt{\\tfrac{1}{N}\\sum_{k=1}^N \\left(h_{\\times,k}^{\\text{rec}} - h_{\\times,k}^{\\text{true}}\\right)^2}}{\\sqrt{\\tfrac{1}{N}\\sum_{k=1}^N \\left(h_{\\times,k}^{\\text{true}}\\right)^2}},\n$$\n并返回 $\\varepsilon = \\tfrac{1}{2}\\left(\\varepsilon_+ + \\varepsilon_\\times\\right)$，作为每个测试用例的单个浮点数。\n\n测试套件：\n- 实现以下参数集。所有量均使用所述单位，振幅无量纲。\n1. 啁啾情况：时长 $T = 4.0$，采样率 $f_s = 2048$，$f_0 = 30$，$\\alpha = 40$，$A_0 = 1\\times 10^{-22}$，$\\beta = 0.2$，污染 $(c_0 = 5\\times 10^{-24}, c_1 = 1\\times 10^{-24}, s_A = 1\\times 10^{-23}, f_{\\text{low}} = 2)$，窗口参数 $\\alpha_{\\text{win}} = 0.1$，高通截止频率 $f_c = 10$，滤波器阶数 $n = 4$。\n2. 阻尼正弦波：时长 $T = 2.0$，采样率 $f_s = 4096$，$f = 150$，$\\tau = 0.5$，$A_0 = 1\\times 10^{-22}$，污染 $(c_0 = 1\\times 10^{-24}, c_1 = -2\\times 10^{-24}, s_A = 5\\times 10^{-25}, f_{\\text{low}} = 1)$，窗口参数 $\\alpha_{\\text{win}} = 0.05$，高通截止频率 $f_c = 10$，滤波器阶数 $n = 4$。\n3. 低频边界：时长 $T = 3.0$，采样率 $f_s = 1024$，$f_0 = 5$，$\\alpha = 0$，$A_0 = 5\\times 10^{-22}$，$\\beta = 0.0$，污染 $(c_0 = 5\\times 10^{-24}, c_1 = 2\\times 10^{-24}, s_A = 2\\times 10^{-23}, f_{\\text{low}} = 0.5)$，窗口参数 $\\alpha_{\\text{win}} = 0.1$，高通截止频率 $f_c = 2$，滤波器阶数 $n = 4$。\n4. 短时段：时长 $T = 0.5$，采样率 $f_s = 1024$，$f_0 = 50$，$\\alpha = 0$，$A_0 = 2\\times 10^{-22}$，$\\beta = 0.0$，污染 $(c_0 = 1\\times 10^{-24}, c_1 = 1\\times 10^{-24}, s_A = 1\\times 10^{-23}, f_{\\text{low}} = 1)$，窗口参数 $\\alpha_{\\text{win}} = 0.2$，高通截止频率 $f_c = 5$，滤波器阶数 $n = 4$。\n\n程序要求：\n- 对于每个测试用例，根据指定模型构造 $h_{\\text{true}}(t)$，解析计算未受污染的 $\\Psi_4(t)$，添加污染，并应用上述稳健的恢复流程以获得 $h^{\\text{rec}}(t)$。\n- 按定义为每个测试用例计算平均相对 RMS 误差 $\\varepsilon$。\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果（例如，$[\\varepsilon_1,\\varepsilon_2,\\varepsilon_3,\\varepsilon_4]$），每个值都以浮点数形式打印。\n\n所有量的单位均按规定：时间为秒，频率为赫兹，应变为无量纲，角度为弧度。将最终数值输出表示为浮点数。", "solution": "所述问题具有科学依据、提法恰当且客观。它提出了一个标准的、尽管不平凡的信号处理任务，该任务来自引力波数据分析领域，具体涉及从数值相对论模拟中获得的纽曼-彭罗斯标量 $\\Psi_4(t)$ 恢复复数应变 $h(t)$。所有参数、模型和过程的规定都足够清晰和精确，可以得到一个唯一且可验证的解。\n\n问题的核心是微分方程 $\\ddot{h}(t) = \\Psi_4(t)$ 的数值积分，其中上方的点表示对时间 $t$ 求导。对含噪数据的朴素双重积分在数值上是不稳定的，会导致巨大的长期漂移。该问题指定了一个稳健的处理流程来缓解这些问题，我们将实现该流程。该过程涉及生成合成测试数据、应用恢复流程并评估结果的准确性。\n\n**1. 合成数据生成**\n\n为了测试恢复算法，我们首先生成一个基准真相（ground-truth）复数应变 $h_{\\text{true}}(t)$，并由此生成相应的 $\\Psi_4(t)$。\n\n**1.1. 真实波形模型 ($h_{\\text{true}}(t)$)**\n复数应变定义为 $h(t) = h_+(t) - i h_\\times(t)$，并通过振幅 $A(t)$ 和相位 $\\phi(t)$ 建模为 $h(t) = A(t)e^{-i\\phi(t)}$。指定了两种模型：\n- 线性频率啁啾，代表双星系统的旋进（inspiral）阶段：\n  - 振幅：$A(t) = A_0(1 + \\beta t)$\n  - 瞬时频率：$f(t) = f_0 + \\alpha t$\n  - 相位：$\\phi(t) = \\int_0^t 2\\pi f(\\tau) d\\tau = 2\\pi \\left(f_0 t + \\frac{1}{2}\\alpha t^2\\right)$\n- 阻尼正弦波，代表铃振（ringdown）阶段：\n  - 振幅：$A(t) = A_0 e^{-t/\\tau}$\n  - 相位：$\\phi(t) = 2\\pi f t$\n\n**1.2. $\\Psi_4(t)$ 的解析计算**\n未受污染的纽曼-彭罗斯标量是 $h(t)$ 的二阶时间导数，由下式给出：\n$$\n\\Psi_4(t) = \\ddot{h}(t) = \\left[ A''(t) - A(t)(\\phi'(t))^2 - i \\left( 2A'(t)\\phi'(t) + A(t)\\phi''(t) \\right) \\right] e^{-i\\phi(t)}\n$$\n其中撇号表示对时间的导数。我们对每个模型解析地计算这些导数：\n- 对于啁啾模型：\n  - $A'(t) = A_0\\beta$\n  - $A''(t) = 0$\n  - $\\phi'(t) = 2\\pi(f_0 + \\alpha t)$\n  - $\\phi''(t) = 2\\pi\\alpha$\n- 对于阻尼正弦波模型：\n  - $A'(t) = -A(t)/\\tau$\n  - $A''(t) = A(t)/\\tau^2$\n  - $\\phi'(t) = 2\\pi f$\n  - $\\phi''(t) = 0$\n\n**1.3. 污染**\n数值相对论波形通常包含来自提取过程的低频误差和数值伪影。我们通过向真实的 $\\Psi_4(t)$ 添加一个实值污染信号 $C(t)$ 来模拟这种情况：\n$$\nC(t) = c_0 + c_1 t + s_A \\sin(2\\pi f_{\\text{low}} t)\n$$\n于是，受污染的信号为 $\\Psi_{4, \\text{cont}}(t) = \\Psi_{4, \\text{true}}(t) + C(t)$。这将污染项加到 $\\Psi_4(t)$ 的实部，而虚部保持不变。\n\n**2. 波形恢复流程**\n\n核心任务是从受污染的 $\\Psi_{4, \\text{cont}}(t)$ 中恢复 $h(t)$。\n\n**2.1. 加窗**\n第一步是向数据应用 Tukey 窗 $w(t)$。这是一个平滑的锥形函数，它将信号振幅在其边界处平缓地降至零。其目的是减少因基于傅里叶的方法所假定的隐式周期性而可能产生的光谱泄漏，并抑制后续积分和滤波步骤产生的边界伪影。加窗后的信号为 $\\Psi_{4, \\text{win}}(t) = \\Psi_{4, \\text{cont}}(t) \\cdot w(t)$。该窗口由一个分数锥度参数 $\\alpha_{\\text{win}}$ 来表征。\n\n**2.2. 数值积分**\n我们使用累积梯形法则执行两次连续的时域积分。这将函数 $y(t)$ 的积分 $\\int_0^t y(\\tau) d\\tau$ 近似计算。\n$$\n\\dot{h}_0(t) = \\int_0^t \\Psi_{4, \\text{win}}(\\tau) d\\tau\n$$\n$$\nh_0(t) = \\int_0^t \\dot{h}_0(\\tau) d\\tau\n$$\n这些数值积分在假定零初始条件的情况下执行，从而得到一个初步的应变 $h_0(t)$。\n\n**2.3. 通过去趋势移除漂移**\n从 $\\ddot{h}(t) = \\Psi_4(t)$ 得到的 $h(t)$ 的精确解仅在两个积分常数 $C_1$ 和 $C_2$ 的意义上确定，这两个常数会引入一个形式为 $C_1 t + C_2$ 的任意线性漂移。目标是确定这些常数，使得恢复出的波形具有物理意义（即无漂移）。指定的方法是从初步应变 $h_0(t)$ 中移除最佳拟合的线性趋势。这等效于找到系数 $a$ 和 $b$ 以最小化 $L^2$ 范数 $\\|h_0(t) - (at+b)\\|^2$。此过程分别应用于 $h_0(t)$ 的实部和虚部。去趋势后的信号是 $h_{\\text{detrend}}(t) = h_0(t) - (a_{\\text{Re}}t + b_{\\text{Re}}) - i(a_{\\text{Im}}t + b_{\\text{Im}})$。\n\n**2.4. 高通滤波**\n即使在去趋势之后，低频伪影仍然存在。这些伪影源于所添加污染 $C(t)$ 的积分（例如，$c_0$ 积分成二次项，$c_1 t$ 积分成三次项）以及低频正弦波。应用一个高通滤波器来移除这种残留污染。指定了一个阶数为 $n$、截止频率为 $f_c$ 的巴特沃斯滤波器。为防止向波形中引入相位失真，使用了零相位滤波技术（`filtfilt`）。这是通过向前应用一次滤波器，然后向后应用一次来实现的，从而抵消了相移。这产生了最终恢复的复数应变 $h^{\\text{rec}}(t)$。\n\n**3. 质量度量**\n\n为了评估恢复的保真度，我们计算平均相对均方根（RMS）误差。首先，我们使用指定的约定 $h(t) = h_+(t) - i h_\\times(t)$ 从真实和恢复的复数应变中提取加号（$h_+$）和交叉（$h_\\times$）极化，这意味着 $h_+(t) = \\text{Re}\\{h(t)\\}$ 和 $h_\\times(t) = -\\text{Im}\\{h(t)\\}$。相对 RMS 误差为：\n$$\n\\varepsilon_+ = \\frac{\\text{RMS}(h_{+}^{\\text{rec}} - h_{+}^{\\text{true}})}{\\text{RMS}(h_{+}^{\\text{true}})} \\quad \\text{and} \\quad \\varepsilon_\\times = \\frac{\\text{RMS}(h_{\\times}^{\\text{rec}} - h_{\\times}^{\\text{true}})}{\\text{RMS}(h_{\\times}^{\\text{true}})}\n$$\n其中 $\\text{RMS}(x) = \\sqrt{\\frac{1}{N}\\sum_{k=1}^N x_k^2}$。最终报告的度量是这两个误差的平均值，$\\varepsilon = \\frac{1}{2}(\\varepsilon_+ + \\varepsilon_\\times)$。\n\n这个综合过程构成了一个从数值相对论数据中恢复引力波波形的稳健算法，该算法在提供的代码中得以实现。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\nfrom scipy.signal import windows, detrend, butter, filtfilt\n\ndef process_case(params):\n    \"\"\"\n    Processes a single test case for waveform recovery.\n    - Generates true waveform and Psi4.\n    - Adds contamination.\n    - Applies the recovery pipeline.\n    - Computes and returns the error metric.\n    \"\"\"\n    T = params['T']\n    fs = params['fs']\n    N = int(T * fs)\n    t = np.linspace(0.0, T, N, endpoint=False)\n\n    # 1. Generate true waveform h_true and its derivatives\n    if params['model'] == 'chirp':\n        f0, alpha_f, A0, beta = params['model_params']\n        \n        # Amplitude and its derivatives\n        A = A0 * (1.0 + beta * t)\n        A_d = A0 * beta * np.ones_like(t)\n        A_dd = np.zeros_like(t)\n\n        # Phase and its derivatives\n        phi = 2.0 * np.pi * (f0 * t + 0.5 * alpha_f * t**2)\n        phi_d = 2.0 * np.pi * (f0 + alpha_f * t)\n        phi_dd = 2.0 * np.pi * alpha_f * np.ones_like(t)\n\n    elif params['model'] == 'damped_sinusoid':\n        f, tau, A0 = params['model_params']\n        \n        # Amplitude and its derivatives\n        A = A0 * np.exp(-t / tau)\n        A_d = -A / tau\n        A_dd = A / (tau**2)\n\n        # Phase and its derivatives\n        phi = 2.0 * np.pi * f * t\n        phi_d = 2.0 * np.pi * f * np.ones_like(t)\n        phi_dd = np.zeros_like(t)\n\n    h_true = A * np.exp(-1j * phi)\n\n    # 2. Compute true Psi4 from analytic derivatives\n    psi4_true = (A_dd - A * (phi_d**2) - 1j * (2 * A_d * phi_d + A * phi_dd)) * np.exp(-1j * phi)\n\n    # 3. Add contamination\n    c0, c1, sA, f_low = params['cont']\n    contamination = c0 + c1 * t + sA * np.sin(2 * np.pi * f_low * t)\n    \n    # As per interpretation, the real-valued contamination is added to the complex signal.\n    # This effectively adds it to the real part: Re(z+r) = Re(z)+r, Im(z+r) = Im(z).\n    psi4_cont = psi4_true + contamination\n\n    # 4. Recovery Pipeline\n    # 4a. Windowing\n    win = windows.tukey(N, alpha=params['alpha_win'])\n    psi4_win = psi4_cont * win\n\n    # 4b. Integration (twice)\n    # The 'initial=0' argument ensures the output array has the same length N.\n    h_dot_0 = cumulative_trapezoid(psi4_win, x=t, initial=0)\n    h0 = cumulative_trapezoid(h_dot_0, x=t, initial=0)\n\n    # 4c. Detrending (removes linear trend from real and imag parts)\n    h0_detrend_real = detrend(h0.real, type='linear')\n    h0_detrend_imag = detrend(h0.imag, type='linear')\n    h0_detrend = h0_detrend_real + 1j * h0_detrend_imag\n\n    # 4d. High-pass filtering (zero-phase)\n    nyquist = 0.5 * fs\n    Wn = params['fc'] / nyquist\n    b, a = butter(params['n_order'], Wn, btype='highpass')\n    h_rec_real = filtfilt(b, a, h0_detrend.real)\n    h_rec_imag = filtfilt(b, a, h0_detrend.imag)\n    h_rec = h_rec_real + 1j * h_rec_imag\n\n    # 5. Calculate Quality Metric\n    # Extract polarizations: h = h_plus - i*h_cross\n    h_plus_true = h_true.real\n    h_cross_true = -h_true.imag\n    h_plus_rec = h_rec.real\n    h_cross_rec = -h_rec.imag\n\n    # RMS of true signals\n    rms_plus_true = np.sqrt(np.mean(h_plus_true**2))\n    rms_cross_true = np.sqrt(np.mean(h_cross_true**2))\n\n    # Relative RMS errors\n    if rms_plus_true > 0:\n        err_plus = np.sqrt(np.mean((h_plus_rec - h_plus_true)**2)) / rms_plus_true\n    else:\n        err_plus = 0.0\n\n    if rms_cross_true > 0:\n        err_cross = np.sqrt(np.mean((h_cross_rec - h_cross_true)**2)) / rms_cross_true\n    else:\n        err_cross = 0.0\n\n    return 0.5 * (err_plus + err_cross)\n\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Chirp\n        {\n            'T': 4.0, 'fs': 2048,\n            'model': 'chirp',\n            'model_params': (30, 40, 1e-22, 0.2), # f0, alpha, A0, beta\n            'cont': (5e-24, 1e-24, 1e-23, 2), # c0, c1, sA, f_low\n            'alpha_win': 0.1, 'fc': 10, 'n_order': 4\n        },\n        # Case 2: Damped sinusoid\n        {\n            'T': 2.0, 'fs': 4096,\n            'model': 'damped_sinusoid',\n            'model_params': (150, 0.5, 1e-22), # f, tau, A0\n            'cont': (1e-24, -2e-24, 5e-25, 1), # c0, c1, sA, f_low\n            'alpha_win': 0.05, 'fc': 10, 'n_order': 4\n        },\n        # Case 3: Low-frequency boundary (chirp model with alpha=0, beta=0)\n        {\n            'T': 3.0, 'fs': 1024,\n            'model': 'chirp',\n            'model_params': (5, 0.0, 5e-22, 0.0), # f0, alpha, A0, beta\n            'cont': (5e-24, 2e-24, 2e-23, 0.5), # c0, c1, sA, f_low\n            'alpha_win': 0.1, 'fc': 2, 'n_order': 4\n        },\n        # Case 4: Short-duration segment (chirp model with alpha=0, beta=0)\n        {\n            'T': 0.5, 'fs': 1024,\n            'model': 'chirp',\n            'model_params': (50, 0.0, 2e-22, 0.0), # f0, alpha, A0, beta\n            'cont': (1e-24, 1e-24, 1e-23, 1), # c0, c1, sA, f_low\n            'alpha_win': 0.2, 'fc': 5, 'n_order': 4\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        error = process_case(case)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3481826"}]}