{"hands_on_practices": [{"introduction": "1+log 切片条件在数值相对论中至关重要，因为它巧妙地将时计函数 $\\alpha$ 的演化与空间体积元的膨胀或收缩联系起来。这个练习旨在揭示这一联系的核心数学结构。通过从 Arnowitt-Deser-Misner (ADM) 演化方程出发，你将推导出一个由时计函数和空间度规行列式构成的时间不变量，从而加深对该规范选择如何动态调整时间流逝以响应空间几何变化的理解 [@problem_id:3462440]。", "problem": "考虑一个由广义相对论（GR）的 $3+1$ 分解所描述的时空真空区域，其空间度规为 $g_{ij}$，空间度规行列式为 $\\gamma \\equiv \\det(g_{ij})$，时计函数为 $\\alpha$，外曲率为 $K_{ij}$，其迹为 $K \\equiv g^{ij} K_{ij}$。在移动矢量 $\\beta^{i} = 0$ 的坐标系中进行计算，使得观察者与超曲面法向量共动。在此规范下，空间度规的 Arnowitt-Deser-Misner (ADM) 演化方程为 $ \\partial_{t} g_{ij} = - 2 \\alpha K_{ij} $，计算中采用的规范条件是所谓的 $1+\\log$ 切片，其定义为 $ \\partial_{t} \\alpha = - 2 \\alpha K $。假设初始数据是光滑的，使得在 $t=0$ 时，时计函数为 $\\alpha(t=0) = 1$，空间度规行列式为一个正值 $\\gamma(t=0) \\equiv \\gamma_{0} > 0$。一个小振幅、紧支撑的微扰在计算域中传播，你可以假设该微扰始终很弱，因此不会发生非线性爆破效应，并且规范条件在整个演化过程中保持有效。\n\n从上述基本关系出发，推导一个由耦合的规范和 ADM 演化所蕴含的、由时计函数和空间度规行列式构成的时间不变量组合。使用此不变量来确定由初始数据固定的常数。最后，使用此不变量来预测弥散的小微扰的时计函数的渐近形式，并用瞬时行列式 $\\gamma(t)$ 和初始行列式 $\\gamma_{0}$ 直接表示。\n\n你的最终答案必须是一个关于时计函数 $\\alpha(t)$ 的单一闭式解析表达式，用 $\\gamma(t)$ 和 $\\gamma_{0}$ 表示。不需要进行数值计算或四舍五入。", "solution": "该问题是有效的。这是一个基于标准 Arnowitt-Deser-Misner (ADM) 形式和常见规范选择的、在数值相对论领域中的适定问题。所有给定的信息都具有科学依据，并且足以进行唯一的推导。\n\n目标是从给定的演化方程中找到一个时间不变量，然后用它来表示时计函数 $\\alpha(t)$，使其以空间度规行列式 $\\gamma(t)$ 及其初始值 $\\gamma_0$ 的形式表达。\n\n该问题在时空的 $3+1$ 分解框架下提供了两个基本的演化方程。第一个是规范条件，称为 $1+\\log$ 切片条件，它控制着时计函数 $\\alpha$ 的演化：\n$$\n\\partial_{t} \\alpha = - 2 \\alpha K\n$$\n此处，$K \\equiv g^{ij} K_{ij}$ 是外曲率 $K_{ij}$ 的迹，并且我们在移动矢量为零（$\\beta^i=0$）的规范下工作。\n\n第二个方程描述了空间度规 $g_{ij}$ 的时间演化：\n$$\n\\partial_{t} g_{ij} = - 2 \\alpha K_{ij}\n$$\n\n为了找到 $\\alpha$ 与空间度规行列式 $\\gamma \\equiv \\det(g_{ij})$ 之间的关系，我们必须首先找到 $\\gamma$ 的演化方程。我们使用雅可比公式来求行列式的导数：对于一个随时间变化的矩阵 $M(t)$，其行列式 $\\det(M)$ 的演化遵循以下公式：\n$$\n\\frac{d}{dt} \\det(M) = \\det(M) \\text{Tr}\\left(M^{-1} \\frac{dM}{dt}\\right)\n$$\n将此公式应用于空间度规 $g_{ij}$，我们有 $M = g_{ij}$，$\\det(M) = \\gamma$，以及 $M^{-1} = g^{ij}$。求迹运算涉及矩阵乘积的缩并。因此，$\\gamma$ 的演化由以下公式给出：\n$$\n\\partial_{t} \\gamma = \\gamma g^{ij} (\\partial_{t} g_{ij})\n$$\n现在我们可以代入给定的 ADM 演化方程中的 $\\partial_{t} g_{ij}$：\n$$\n\\partial_{t} \\gamma = \\gamma g^{ij} (- 2 \\alpha K_{ij})\n$$\n从缩并中提出标量 $-2\\alpha$ 可得：\n$$\n\\partial_{t} \\gamma = - 2 \\alpha \\gamma (g^{ij} K_{ij})\n$$\n根据定义，外曲率的迹为 $K = g^{ij} K_{ij}$。将此代入 $\\partial_t \\gamma$ 的方程中可得：\n$$\n\\partial_{t} \\gamma = - 2 \\alpha \\gamma K\n$$\n这个方程描述了空间体积元的演化。通过考虑 $\\gamma$ 的自然对数的演化，可以得到一个等价且更方便的形式：\n$$\n\\partial_{t} (\\ln \\gamma) = \\frac{1}{\\gamma} \\partial_{t} \\gamma = \\frac{1}{\\gamma} (- 2 \\alpha \\gamma K) = -2 \\alpha K\n$$\n因此，对于任意空间点，我们推导出了以下关于 $\\alpha(t)$ 和 $\\gamma(t)$ 的耦合常微分方程组：\n1.  $\\partial_{t} \\alpha = - 2 \\alpha K$ (规范条件)\n2.  $\\partial_{t} (\\ln \\gamma) = - 2 \\alpha K$ (从 ADM 演化推导)\n\n通过比较这两个方程，我们立即发现它们的右侧是相同的：\n$$\n\\partial_{t} \\alpha = \\partial_{t} (\\ln \\gamma)\n$$\n这意味着它们差值的时间导数为零：\n$$\n\\partial_{t} (\\alpha - \\ln \\gamma) = 0\n$$\n这意味着量 $(\\alpha - \\ln \\gamma)$ 是一个不随时间变化的常数，即它是一个由时计函数和度规行列式组成的时间不变量组合。\n$$\n\\alpha(t) - \\ln(\\gamma(t)) = C\n$$\n其中 $C$ 是一个积分常数。\n\n问题要求使用提供的初始数据来确定这个常数。在时间 $t=0$ 时，给定 $\\alpha(t=0) = 1$ 和 $\\gamma(t=0) = \\gamma_0$。我们可以在 $t=0$ 时计算常数 $C$：\n$$\nC = \\alpha(0) - \\ln(\\gamma(0)) = 1 - \\ln(\\gamma_0)\n$$\n现在我们得到了完整的时间不变量关系：\n$$\n\\alpha(t) - \\ln(\\gamma(t)) = 1 - \\ln(\\gamma_0)\n$$\n最后一步是解出此方程中的时计函数 $\\alpha(t)$，用瞬时行列式 $\\gamma(t)$ 和初始行列式 $\\gamma_0$ 来表示。整理方程，我们得到：\n$$\n\\alpha(t) = 1 + \\ln(\\gamma(t)) - \\ln(\\gamma_0)\n$$\n使用对数性质 $\\ln(a) - \\ln(b) = \\ln(a/b)$，我们可以将最终表达式写成更紧凑的形式：\n$$\n\\alpha(t) = 1 + \\ln\\left(\\frac{\\gamma(t)}{\\gamma_0}\\right)\n$$\n该表达式给出了任意时刻 $t$ 的时计函数值，它是同一时刻空间度规行列式和行列式初始值的函数。微扰小且弥散的假设确保了时空演化是良态的，并且规范条件保持有效，从而保证了此关系在整个演化过程中的有效性。", "answer": "$$\n\\boxed{\\alpha(t) = 1 + \\ln\\left(\\frac{\\gamma(t)}{\\gamma_0}\\right)}\n$$", "id": "3462440"}, {"introduction": "1+log 切片最著名的特性之一是其强大的奇点回避能力，这使得长时间稳定的黑洞模拟成为可能。本练习通过一个简化的尘埃塌缩模型，将 1+log 切片与更传统的谐和切片 (Harmonic Slicing) 进行直接比较。通过计算和对比两种规范下坐标时到达奇点（或时计函数归零）的行为，你将亲身体会到 1+log 切片如何通过“冻结”坐标时来有效“切除”物理奇点，这是理解其在强引力场模拟中稳定性的关键 [@problem_id:3462400]。", "problem": "考虑一个空间均匀、各向同性的坍缩区域，其由一个空间平坦的弗里德曼-勒梅特-罗伯逊-沃克几何建模，该几何写成漂移为零的阿诺维特-德塞-米斯纳 (ADM) 分解形式。令空间度规为 $\\,\\gamma_{ij}(t) = a^{2}(\\tau)\\,\\delta_{ij}\\,$，其中沿法向观测者的固有时 $\\tau$ 通过 $\\,\\mathrm{d}\\tau = \\alpha(t)\\,\\mathrm{d}t\\,$ 与坐标时 $t$ 相关联，其中时计函数 $\\,\\alpha(t) > 0\\,$。假设物质内容是无压强尘埃，因此在固有时 $\\,\\tau_{s}\\,$ 到达的曲率奇点附近，标度因子的行为符合经过充分检验的领头阶定律 $\\,a(\\tau) \\propto (\\tau_{s} - \\tau)^{2/3}\\,$。使用 $\\,3{+}1\\,$ 定义 $\\,K_{ij} = -\\tfrac{1}{2\\alpha}\\,\\partial_{t}\\gamma_{ij}\\,$ 和 $\\,K = \\gamma^{ij}K_{ij}\\,$，以及零漂移下的 Bona–Massó 切片族，\n$$\\partial_{t}\\alpha = -\\,\\alpha^{2}\\,f(\\alpha)\\,\\bigl(K - K_{0}\\bigr),$$\n且 $\\,K_{0} = 0\\,$。取谐和切片对应于 $\\,f(\\alpha) = 1\\,$，标准 $\\,1{+}\\log\\,$ 切片对应于 $\\,f(\\alpha) = 2/\\alpha\\,$。\n\n对于某个固有时 $\\,\\tau_{0}  \\tau_{s}\\,$，施加初始条件 $\\,\\alpha(\\tau_{0}) = \\alpha_{0}  0\\,$ 和 $\\,t(\\tau_{0}) = 0\\,$。在均匀部分进行计算，因此 $\\,K\\,$ 仅依赖于 $\\,\\tau\\,$。\n\n任务：\n- 推导 $\\,K(\\tau)\\,$，用固有时哈勃率 $\\,H(\\tau) = a'(\\tau)/a(\\tau)\\,$ 表示，其中 $\\,{}' = \\mathrm{d}/\\mathrm{d}\\tau\\,$，并利用尘埃行为找到在 $\\,\\tau_{s}\\,$ 附近 $\\,K(\\tau)\\,$ 的领头阶 $\\,\\tau\\,$ 依赖关系。\n- 使用谐和切片，对时计演化方程积分，以获得满足 $\\,\\alpha_{\\mathrm{harm}}(\\tau_{0}) = \\alpha_{0}\\,$ 的显式表达式 $\\,\\alpha_{\\mathrm{harm}}(\\tau)\\,$。\n- 通过 $\\,\\mathrm{d}t/\\mathrm{d}\\tau = 1/\\alpha\\,$ 定义坐标时。对于谐和切片，当 $\\,\\tau \\to \\tau_{s}^{-}\\,$ 时，通过以下公式确定 $\\,t(\\tau)\\,$ 领头发散项的系数 $\\,C_{\\mathrm{harm}}\\,$：\n$$C_{\\mathrm{harm}} \\equiv \\lim_{\\tau \\to \\tau_{s}^{-}} (\\tau_{s} - \\tau)\\,\\bigl[t_{\\mathrm{harm}}(\\tau) - t_{\\mathrm{harm}}(\\tau_{0})\\bigr].$$\n- 对于 $\\,1{+}\\log\\,$ 切片，对时计演化方程积分，以获得时计函数值为零时的固有时 $\\,\\tau_{\\mathrm{zero}} \\in (\\tau_{0},\\tau_{s})\\,$，并当 $\\,\\tau \\to \\tau_{\\mathrm{zero}}^{-}\\,$ 时，通过以下公式定义 $\\,t(\\tau)\\,$ 领头发散项的系数 $\\,C_{1+\\log}\\,$：\n$$C_{1+\\log} \\equiv \\lim_{\\tau \\to \\tau_{\\mathrm{zero}}^{-}} \\frac{t_{1+\\log}(\\tau)}{\\ln\\!\\bigl[1/(\\tau_{\\mathrm{zero}} - \\tau)\\bigr]}.$$\n\n将你的最终答案表示为一个单行矩阵，其条目按顺序为：$\\,\\alpha_{\\mathrm{harm}}(\\tau)\\,$、$\\,C_{\\mathrm{harm}}\\,$ 和 $\\,C_{1+\\log}\\,$，均以 $\\,\\alpha_{0}\\,$、$\\,\\tau_{0}\\,$ 和 $\\,\\tau_{s}\\,$ 的闭合形式表示。不需要数值计算，最终答案中也不需要单位。", "solution": "该问题要求在坍缩、空间平坦的弗里德曼-勒梅特-罗伯逊-沃克 (FLRW) 时空背景下，推导与不同时间切片条件相关的公式。我们将依次处理每个任务。\n\n首先，我们推导外曲率的迹 $K$ 与固有时哈勃率 $H(\\tau)$ 之间的关系。空间度规由 $\\gamma_{ij}(t) = a^{2}(\\tau)\\delta_{ij}$ 给出，其中 $\\tau$ 是沿法向于空间切片的观测者的固有时。时计函数 $\\alpha(t)$ 通过 $\\mathrm{d}\\tau = \\alpha(t)\\,\\mathrm{d}t$ 关联坐标时 $t$ 和固有时 $\\tau$，这意味着 $\\frac{\\mathrm{d}t}{\\mathrm{d}\\tau} = \\frac{1}{\\alpha(t)}$。对坐标时 $t$ 的时间导数 $\\partial_t$ 可以通过链式法则与对固有时 $\\tau$ 的导数（用撇号表示，$ ' = \\mathrm{d}/\\mathrm{d}\\tau$）关联起来：\n$$ \\partial_{t} = \\frac{\\mathrm{d}\\tau}{\\mathrm{d}t}\\frac{\\mathrm{d}}{\\mathrm{d}\\tau} = \\alpha \\frac{\\mathrm{d}}{\\mathrm{d}\\tau} $$\n外曲率定义为 $K_{ij} = -\\frac{1}{2\\alpha}\\partial_{t}\\gamma_{ij}$。当漂移矢量为零时，这是正确的定义。我们计算空间度规的时间导数：\n$$ \\partial_{t}\\gamma_{ij} = \\alpha \\frac{\\mathrm{d}}{\\mathrm{d}\\tau} (a^{2}(\\tau)\\delta_{ij}) = \\alpha (2 a(\\tau) a'(\\tau)) \\delta_{ij} $$\n将此代入 $K_{ij}$ 的定义中：\n$$ K_{ij} = -\\frac{1}{2\\alpha} \\left( \\alpha (2 a a') \\delta_{ij} \\right) = - a a' \\delta_{ij} $$\n外曲率的迹为 $K = \\gamma^{ij}K_{ij}$。逆空间度规为 $\\gamma^{ij} = a^{-2}\\delta^{ij}$。因此，\n$$ K = (a^{-2}\\delta^{ij})(-a a' \\delta_{ij}) = -a^{-1}a' (\\delta^{ij}\\delta_{ij}) $$\n在 $3$ 维空间中，克罗内克 δ 的迹为 $\\delta^{ij}\\delta_{ij} = \\delta^{i}_{i} = 3$。因此，\n$$ K(\\tau) = -3 \\frac{a'(\\tau)}{a(\\tau)} = -3 H(\\tau) $$\n其中 $H(\\tau) = a'(\\tau)/a(\\tau)$ 是固有时哈勃率。\n\n接下来，我们求出在奇点 $\\tau = \\tau_{s}$ 附近 $K(\\tau)$ 的领头阶行为。对于一个无压强尘埃主导的宇宙，标度因子的行为如同 $a(\\tau) = C(\\tau_{s} - \\tau)^{2/3}$，其中 C 为某个常数。哈勃率为：\n$$ H(\\tau) = \\frac{a'(\\tau)}{a(\\tau)} = \\frac{\\mathrm{d}}{\\mathrm{d}\\tau} \\ln(a(\\tau)) = \\frac{\\mathrm{d}}{\\mathrm{d}\\tau} \\left( \\ln(C) + \\frac{2}{3}\\ln(\\tau_s - \\tau) \\right) = \\frac{2}{3} \\frac{-1}{\\tau_s - \\tau} = -\\frac{2}{3(\\tau_s - \\tau)} $$\n因此，奇点附近外曲率的迹为：\n$$ K(\\tau) = -3 H(\\tau) = -3 \\left(-\\frac{2}{3(\\tau_s - \\tau)}\\right) = \\frac{2}{\\tau_s - \\tau} $$\n\n现在，我们在谐和切片条件下求解时计函数 $\\alpha(\\tau)$。当 $K_0=0$ 时，时计的 Bona–Massó 演化方程为 $\\partial_{t}\\alpha = -\\alpha^{2}f(\\alpha)K$。对于谐和切片，$f(\\alpha) = 1$，因此 $\\partial_{t}\\alpha = -\\alpha^2 K$。我们将时间导数转换为对 $\\tau$ 的导数：\n$$ \\alpha \\frac{\\mathrm{d}\\alpha}{\\mathrm{d}\\tau} = -\\alpha^{2}K \\implies \\frac{\\mathrm{d}\\alpha}{\\mathrm{d}\\tau} = -\\alpha K $$\n代入 $K(\\tau) = -3 a'(\\tau)/a(\\tau)$：\n$$ \\frac{\\mathrm{d}\\alpha}{\\mathrm{d}\\tau} = -\\alpha \\left(-3 \\frac{a'}{a}\\right) = 3\\alpha \\frac{a'}{a} $$\n这是一个可分离微分方程：\n$$ \\frac{1}{\\alpha}\\mathrm{d}\\alpha = 3\\frac{1}{a}\\mathrm{d}a \\implies \\int \\frac{\\mathrm{d}\\alpha}{\\alpha} = \\int 3\\frac{\\mathrm{d}a}{a} \\implies \\ln(\\alpha) = 3\\ln(a) + \\text{const} $$\n这给出 $\\alpha(\\tau) = C_1 a^3(\\tau)$，其中 $C_1$ 为某个常数。使用初始条件 $\\alpha(\\tau_0) = \\alpha_0$，我们得到 $\\alpha_0 = C_1 a^3(\\tau_0)$，因此 $C_1 = \\alpha_0/a^3(\\tau_0)$。时计函数为：\n$$ \\alpha_{\\mathrm{harm}}(\\tau) = \\alpha_0 \\left(\\frac{a(\\tau)}{a(\\tau_0)}\\right)^3 $$\n利用 $a(\\tau) \\propto (\\tau_s-\\tau)^{2/3}$ 的行为，该比值为 $a(\\tau)/a(\\tau_0) = \\left(\\frac{\\tau_s-\\tau}{\\tau_s-\\tau_0}\\right)^{2/3}$。所以，\n$$ \\alpha_{\\mathrm{harm}}(\\tau) = \\alpha_0 \\left[ \\left(\\frac{\\tau_s-\\tau}{\\tau_s-\\tau_0}\\right)^{2/3} \\right]^3 = \\alpha_0 \\left(\\frac{\\tau_s-\\tau}{\\tau_s-\\tau_0}\\right)^2 $$\n这是第一个所求的表达式。\n\n接下来，我们计算系数 $C_{\\mathrm{harm}}$。坐标时 $t(\\tau)$ 通过对 $\\mathrm{d}t/\\mathrm{d}\\tau = 1/\\alpha(\\tau)$ 积分得到。使用初始条件 $t(\\tau_0) = 0$：\n$$ t_{\\mathrm{harm}}(\\tau) = \\int_{\\tau_0}^{\\tau} \\frac{\\mathrm{d}s}{\\alpha_{\\mathrm{harm}}(s)} = \\int_{\\tau_0}^{\\tau} \\frac{1}{\\alpha_0} \\left(\\frac{\\tau_s-\\tau_0}{\\tau_s-s}\\right)^2 \\mathrm{d}s = \\frac{(\\tau_s-\\tau_0)^2}{\\alpha_0} \\int_{\\tau_0}^{\\tau} \\frac{\\mathrm{d}s}{(\\tau_s-s)^2} $$\n该积分计算结果为：\n$$ \\int_{\\tau_0}^{\\tau} (\\tau_s-s)^{-2} \\mathrm{d}s = \\left[\\frac{1}{\\tau_s-s}\\right]_{\\tau_0}^{\\tau} = \\frac{1}{\\tau_s-\\tau} - \\frac{1}{\\tau_s-\\tau_0} $$\n所以，$t_{\\mathrm{harm}}(\\tau) = \\frac{(\\tau_s-\\tau_0)^2}{\\alpha_0} \\left(\\frac{1}{\\tau_s-\\tau} - \\frac{1}{\\tau_s-\\tau_0}\\right)$。系数 $C_{\\mathrm{harm}}$ 定义为：\n$$ C_{\\mathrm{harm}} = \\lim_{\\tau \\to \\tau_s^{-}} (\\tau_s - \\tau) [t_{\\mathrm{harm}}(\\tau) - t_{\\mathrm{harm}}(\\tau_0)] = \\lim_{\\tau \\to \\tau_s^{-}} (\\tau_s - \\tau) t_{\\mathrm{harm}}(\\tau) $$\n$$ C_{\\mathrm{harm}} = \\lim_{\\tau \\to \\tau_s^{-}} (\\tau_s - \\tau) \\frac{(\\tau_s-\\tau_0)^2}{\\alpha_0} \\left(\\frac{1}{\\tau_s-\\tau} - \\frac{1}{\\tau_s-\\tau_0}\\right) = \\lim_{\\tau \\to \\tau_s^{-}} \\frac{(\\tau_s-\\tau_0)^2}{\\alpha_0} \\left(1 - \\frac{\\tau_s-\\tau}{\\tau_s-\\tau_0}\\right) $$\n当 $\\tau \\to \\tau_s^{-}$ 时，项 $(\\tau_s-\\tau)/(\\tau_s-\\tau_0)$ 趋于零。因此，\n$$ C_{\\mathrm{harm}} = \\frac{(\\tau_s-\\tau_0)^2}{\\alpha_0} $$\n这是第二个所求的表达式。\n\n最后，我们分析 $1+\\log$ 切片的情况，其中 $f(\\alpha) = 2/\\alpha$。时计演化方程为 $\\partial_t \\alpha = -\\alpha^2(2/\\alpha)K = -2\\alpha K$。转换为对 $\\tau$ 的导数：\n$$ \\alpha \\frac{\\mathrm{d}\\alpha}{\\mathrm{d}\\tau} = -2\\alpha K \\implies \\frac{\\mathrm{d}\\alpha}{\\mathrm{d}\\tau} = -2K $$\n使用 $K(\\tau) = 2/(\\tau_s-\\tau)$，我们有：\n$$ \\frac{\\mathrm{d}\\alpha}{\\mathrm{d}\\tau} = -2\\left(\\frac{2}{\\tau_s-\\tau}\\right) = -\\frac{4}{\\tau_s-\\tau} $$\n从 $\\tau_0$ 积分到 $\\tau$：\n$$ \\alpha(\\tau) - \\alpha(\\tau_0) = \\int_{\\tau_0}^{\\tau} \\frac{-4}{\\tau_s-s}\\mathrm{d}s = 4[\\ln(\\tau_s-s)]_{\\tau_0}^{\\tau} = 4\\ln\\left(\\frac{\\tau_s-\\tau}{\\tau_s-\\tau_0}\\right) $$\n所以，$\\alpha_{1+\\log}(\\tau) = \\alpha_0 + 4\\ln\\left(\\frac{\\tau_s-\\tau}{\\tau_s-\\tau_0}\\right)$。当时计函数在 $\\tau_{\\mathrm{zero}}$ 处为零时，$\\alpha_{1+\\log}(\\tau_{\\mathrm{zero}}) = 0$：\n$$ 0 = \\alpha_0 + 4\\ln\\left(\\frac{\\tau_s-\\tau_{\\mathrm{zero}}}{\\tau_s-\\tau_0}\\right) \\implies -\\frac{\\alpha_0}{4} = \\ln\\left(\\frac{\\tau_s-\\tau_{\\mathrm{zero}}}{\\tau_s-\\tau_0}\\right) $$\n对两边取指数，得到 $\\exp(-\\alpha_0/4) = \\frac{\\tau_s-\\tau_{\\mathrm{zero}}}{\\tau_s-\\tau_0}$，所以 $\\tau_s - \\tau_{\\mathrm{zero}} = (\\tau_s-\\tau_0)\\exp(-\\alpha_0/4)$。\n\n现在我们求系数 $C_{1+\\log}$，其定义为 $C_{1+\\log} = \\lim_{\\tau \\to \\tau_{\\mathrm{zero}}^{-}} \\frac{t_{1+\\log}(\\tau)}{\\ln[1/(\\tau_{\\mathrm{zero}}-\\tau)]}$。由于当 $\\tau \\to \\tau_{\\mathrm{zero}}^{-}$ 时 $t_{1+\\log}(\\tau) = \\int_{\\tau_0}^{\\tau} \\frac{\\mathrm{d}s}{\\alpha_{1+\\log}(s)}$ 发散，该极限是 $\\infty/\\infty$ 的形式。我们应用洛必达法则：\n$$ C_{1+\\log} = \\lim_{\\tau \\to \\tau_{\\mathrm{zero}}^{-}} \\frac{\\mathrm{d}t_{1+\\log}(\\tau)/\\mathrm{d}\\tau}{\\mathrm{d}(\\ln[1/(\\tau_{\\mathrm{zero}}-\\tau)])/\\mathrm{d}\\tau} = \\lim_{\\tau \\to \\tau_{\\mathrm{zero}}^{-}} \\frac{1/\\alpha_{1+\\log}(\\tau)}{1/(\\tau_{\\mathrm{zero}}-\\tau)} = \\lim_{\\tau \\to \\tau_{\\mathrm{zero}}^{-}} \\frac{\\tau_{\\mathrm{zero}}-\\tau}{\\alpha_{1+\\log}(\\tau)} $$\n这是 $0/0$ 的形式。再次应用洛必达法则：\n$$ C_{1+\\log} = \\lim_{\\tau \\to \\tau_{\\mathrm{zero}}^{-}} \\frac{\\mathrm{d}(\\tau_{\\mathrm{zero}}-\\tau)/\\mathrm{d}\\tau}{\\mathrm{d}\\alpha_{1+\\log}(\\tau)/\\mathrm{d}\\tau} = \\lim_{\\tau \\to \\tau_{\\mathrm{zero}}^{-}} \\frac{-1}{\\alpha'_{1+\\log}(\\tau)} $$\n我们有 $\\alpha'_{1+\\log}(\\tau) = -4/(\\tau_s-\\tau)$。在 $\\tau_{\\mathrm{zero}}$ 处求值：\n$$ C_{1+\\log} = \\frac{-1}{-4/(\\tau_s-\\tau_{\\mathrm{zero}})} = \\frac{\\tau_s-\\tau_{\\mathrm{zero}}}{4} $$\n代入 $\\tau_s - \\tau_{\\mathrm{zero}}$ 的表达式：\n$$ C_{1+\\log} = \\frac{(\\tau_s-\\tau_0)\\exp(-\\alpha_0/4)}{4} $$\n这是第三个也是最后一个所求的表达式。", "answer": "$$\n\\boxed{ \\begin{pmatrix} \\alpha_{0} \\left( \\frac{\\tau_{s} - \\tau}{\\tau_{s} - \\tau_{0}} \\right)^{2}  \\frac{(\\tau_{s} - \\tau_{0})^{2}}{\\alpha_{0}}  \\frac{(\\tau_{s} - \\tau_{0})\\exp(-\\alpha_{0}/4)}{4} \\end{pmatrix} }\n$$", "id": "3462400"}, {"introduction": "理论上的优良性质在转化为数值算法时，往往会面临新的挑战，例如由非线性导致的“规范激波” (gauge shocks)。这个编程练习将引导你从理论走向实践，直面这一问题。你将实现一个一维求解器，并通过引入人工粘性项来抑制解中出现的陡峭梯度，同时通过量化分析，探索如何在不污染物理结果的前提下，找到所需的最小粘性，这对于任何计算科学家来说都是一项核心技能 [@problem_id:3462413]。", "problem": "要求您设计并实现一个数值实验，以量化在数值相对论的 1+log 对数切片条件下，为避免规范激波形成所需的最小人工粘性，同时保持时计函数的物理内容。背景设定为时空的 $3+1$ 分解，其中包含时计函数 $\\alpha$、移动矢量 $\\beta^i$ 和外曲率 $K$。1+log 对数切片条件通过以下平流-反应偏微分方程指定了时计函数的演化：\n$$\n\\partial_t \\alpha - \\beta^i \\partial_i \\alpha = -2\\,\\alpha\\,K.\n$$\n为了对避免规范激波进行建模，考虑带有附加人工粘性项的增广方程：\n$$\n\\partial_t \\alpha - \\beta^i \\partial_i \\alpha = -2\\,\\alpha\\,K + \\nu\\,\\Delta \\alpha,\n$$\n其中 $\\nu \\ge 0$ 是人工粘性系数。工作环境为一维空间，坐标为 $x \\in [0,1]$，移动速度 $\\beta \\ge 0$，以及空间变化的外曲率 $K(x)$。所有变量均为无量纲。\n\n您的程序必须实现一个基于第一性原理的数值求解器，该求解器基于线法 (Method of Lines)，采用显式时间步进和单调空间离散化，并遵守以下要求：\n\n- 空间离散化：\n  - 在 $[0,1]$ 上使用一个包含 $N$ 个点的均匀网格，间距为 $\\Delta x = 1/(N-1)$。\n  - 假设 $\\beta \\ge 0$，使用一阶迎风差分对 $\\partial_x \\alpha$ 进行离散化：\n    $$\n    \\left(\\partial_x \\alpha\\right)_i \\approx \\frac{\\alpha_i - \\alpha_{i-1}}{\\Delta x}.\n    $$\n  - 使用标准二阶中心差分对 $\\Delta \\alpha$ 进行离散化：\n    $$ \n    \\left(\\Delta \\alpha\\right)_i \\approx \\frac{\\alpha_{i+1} - 2\\alpha_i + \\alpha_{i-1}}{\\Delta x^2}.\n    $$\n  - 每次更新后，通过设置 $\\alpha_0 = \\alpha_1$ 和 $\\alpha_{N-1} = \\alpha_{N-2}$，在两端施加齐次 Neumann 边界条件（零梯度）。\n- 时间步进：\n  - 使用显式前向欧拉法：\n    $$\n    \\alpha^{n+1}_i = \\alpha^n_i + \\Delta t\\left(-\\beta\\,\\frac{\\alpha^n_i - \\alpha^n_{i-1}}{\\Delta x} - 2\\,\\alpha^n_i\\,K_i + \\nu\\,\\frac{\\alpha^n_{i+1} - 2\\alpha^n_i + \\alpha^n_{i-1}}{\\Delta x^2}\\right).\n    $$\n  - 自适应地选择时间步长 $\\Delta t$ 以满足稳定性和单调性约束：\n    $$\n    \\frac{\\beta\\,\\Delta t}{\\Delta x} \\le 0.8,\\quad \\frac{\\nu\\,\\Delta t}{\\Delta x^2} \\le 0.45,\\quad \\Delta t \\le 0.9 \\min_i \\frac{1}{2\\,K_i + \\epsilon},\n    $$\n    其中 $\\epsilon = 10^{-12}$ 以避免除以零。\n  - 为了保持物理合理性，每次更新后将时计函数限制在区间 $[0,1.5]$ 内；即，设置 $\\alpha^{n+1}_i \\leftarrow \\min\\left(1.5,\\max(0,\\alpha^{n+1}_i)\\right)$。\n\n初始数据和外曲率轮廓定义如下。使用陡峭轮廓的初始时计函数：\n$$\n\\alpha(x,0) = 1 - A\\,\\tanh\\!\\left(\\frac{x - x_c}{\\sigma}\\right),\n$$\n其中振幅 $A \\in (0,1)$，中心 $x_c \\in (0,1)$，陡峭度参数 $\\sigma  0$。对于 $K(x)$，使用两种类型的空间轮廓：\n\n- 在 $x = x_{\\mathrm{int}}$ 处有界面的分段常数轮廓：\n  $$\n  K(x) = \\begin{cases}\n  k_{\\mathrm{left}},  x  x_{\\mathrm{int}},\\\\\n  k_{\\mathrm{right}},  x \\ge x_{\\mathrm{int}}.\n  \\end{cases}\n  $$\n- 高斯尖峰轮廓：\n  $$\n  K(x) = k_0 + k_{\\mathrm{spike}} \\exp\\!\\left(-\\frac{(x - x_s)^2}{\\sigma_K^2}\\right).\n  $$\n\n定义在固定的最终时间 $T$ 评估的以下定量指标：\n\n- 最大离散梯度大小\n  $$\n  G(\\nu) = \\max_{0 \\le i  N-1} \\left|\\frac{\\alpha_\\nu(x_{i+1},T) - \\alpha_\\nu(x_i,T)}{\\Delta x}\\right|.\n  $$\n- 相对于 $\\nu = 0$ 时基准解的相对 $\\ell^2$ 偏差：\n  $$\n  \\mathcal{D}(\\nu) = \\frac{\\left\\|\\alpha_\\nu(\\cdot,T) - \\alpha_0(\\cdot,T)\\right\\|_2}{\\left\\|\\alpha_0(\\cdot,T)\\right\\|_2},\n  $$\n  其中离散 $\\ell^2$ 范数为 $\\|u\\|_2 = \\left(\\sum_{i=0}^{N-1} u_i^2 \\,\\Delta x\\right)^{1/2}$。\n\n您的任务是为每个测试案例确定最小人工粘性 $\\nu_{\\min}$，该值需同时满足：\n$$\nG(\\nu_{\\min}) \\le G_{\\mathrm{target}} \\quad \\text{and} \\quad \\mathcal{D}(\\nu_{\\min}) \\le \\delta_{\\max}.\n$$\n\n使用在 $\\nu \\in [0,\\nu_{\\max}]$ 上的自适应区间套和二分策略来实现对 $\\nu_{\\min}$ 的搜索，$\\nu$ 的容差为 $10^{-6}$。如果在 $[0,\\nu_{\\max}]$ 区间内没有 $\\nu$ 满足标准，则返回 $\\nu_{\\min} = \\nu_{\\max}$。\n\n测试套件：\n提供四个涵盖典型和边缘场景的测试案例。对于每个案例，指定 $(N,\\beta,A,\\sigma,x_c,T)$、$K(x)$ 的形式和参数，以及接受阈值 $(G_{\\mathrm{target}},\\delta_{\\max})$ 和搜索上限 $\\nu_{\\max}$。\n\n- 案例 1（一般情况，分段 $K$）：\n  - $N = 128$，$\\beta = 0.3$， $A = 0.8$， $\\sigma = 0.02$， $x_c = 0.5$， $T = 0.2$。\n  - $K(x)$ 为分段函数，其中 $x_{\\mathrm{int}} = 0.5$，$k_{\\mathrm{left}} = 0.2$，$k_{\\mathrm{right}} = 0.8$。\n  - $G_{\\mathrm{target}} = 30$，$\\delta_{\\max} = 0.1$，$\\nu_{\\max} = 0.02$。\n- 案例 2（高平流，分段 $K$）：\n  - $N = 128$，$\\beta = 0.9$， $A = 0.7$， $\\sigma = 0.015$， $x_c = 0.5$， $T = 0.15$。\n  - $K(x)$ 为分段函数，其中 $x_{\\mathrm{int}} = 0.4$，$k_{\\mathrm{left}} = 0.1$，$k_{\\mathrm{right}} = 0.5$。\n  - $G_{\\mathrm{target}} = 50$，$\\delta_{\\max} = 0.12$，$\\nu_{\\max} = 0.02$。\n- 案例 3（无平流，分段 $K$）：\n  - $N = 128$，$\\beta = 0.0$， $A = 0.85$， $\\sigma = 0.01$， $x_c = 0.5$， $T = 0.2$。\n  - $K(x)$ 为分段函数，其中 $x_{\\mathrm{int}} = 0.6$，$k_{\\mathrm{left}} = 0.3$，$k_{\\mathrm{right}} = 1.0$。\n  - $G_{\\mathrm{target}} = 25$，$\\delta_{\\max} = 0.08$，$\\nu_{\\max} = 0.02$。\n- 案例 4（$K$ 中的高斯尖峰）：\n  - $N = 128$，$\\beta = 0.4$， $A = 0.9$， $\\sigma = 0.008$， $x_c = 0.5$， $T = 0.1$。\n  - $K(x)$ 为高斯函数，其中 $k_0 = 0.2$，$k_{\\mathrm{spike}} = 1.2$，$x_s = 0.6$，$\\sigma_K = 0.03$。\n  - $G_{\\mathrm{target}} = 60$，$\\delta_{\\max} = 0.15$，$\\nu_{\\max} = 0.02$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表内容为四个测试案例的最小粘性值，按上述案例顺序排列，并四舍五入到六位小数。例如，输出格式为：\n$$\n[\\nu_1,\\nu_2,\\nu_3,\\nu_4].\n$$", "solution": "该问题要求设计并实现一个数值实验，以确定在数值相对论中对 1+log 切片条件进行正则化所需的最小人工粘性 $\\nu_{\\min}$。这通过求解时计函数 $\\alpha(x,t)$ 的一维平流-反应-扩散偏微分方程（PDE）来完成。该解必须满足对解的梯度及其与无粘性基准解的偏差所设定的约束条件。\n\n带有附加人工粘性项的控制性偏微分方程为：\n$$\n\\partial_t \\alpha - \\beta \\partial_x \\alpha = -2\\,\\alpha\\,K(x) + \\nu\\,\\partial^2_x \\alpha\n$$\n该方程定义在空间域 $x \\in [0,1]$ 上，具有移动速度 $\\beta \\ge 0$、空间变化的外曲率 $K(x)$ 和人工粘性系数 $\\nu \\ge 0$。任务包括实现一个数值求解器，并将其用于二分搜索算法中，为几个测试案例找到 $\\nu_{\\min}$。\n\n数值解基于线法（Method of Lines, MoL）构建，首先对空间导数进行离散化，将偏微分方程（PDE）转换为关于时间的常微分方程（ODE）组，然后使用显式时间步进方案求解。\n\n**1. 空间离散化**\n\n空间域 $x \\in [0,1]$ 使用包含 $N$ 个点的均匀网格 $x_i = i\\,\\Delta x$（$i=0, 1, \\dots, N-1$）进行离散化，其中网格间距为 $\\Delta x = 1/(N-1)$。在每个内部网格点 $x_i$（$i=1, \\dots, N-2$），空间导数按规定使用有限差分进行近似：\n\n- 平流项 $\\beta\\,\\partial_x \\alpha$ 使用一阶迎风格式进行离散化，对于 $\\beta \\ge 0$，这是一个后向差分：\n$$\n\\beta \\left(\\partial_x \\alpha\\right)_i \\approx \\beta\\,\\frac{\\alpha_i - \\alpha_{i-1}}{\\Delta x}\n$$\n- 扩散项 $\\nu\\,\\Delta \\alpha = \\nu\\,\\partial^2_x \\alpha$ 使用标准的二阶中心差分模板进行离散化：\n$$\n\\nu \\left(\\Delta \\alpha\\right)_i \\approx \\nu\\,\\frac{\\alpha_{i+1} - 2\\alpha_i + \\alpha_{i-1}}{\\Delta x^2}\n$$\n- 反应项 $-2\\,\\alpha\\,K$ 是一个局部源项，直接在网格点上计算为 $-2\\,\\alpha_i\\,K_i$。\n\n将这些离散化代入偏微分方程，得到关于内部网格点上时计函数值 $\\alpha_i(t)$ 的常微分方程组：\n$$\n\\frac{d\\alpha_i}{dt} = -\\beta\\,\\frac{\\alpha_i - \\alpha_{i-1}}{\\Delta x} - 2\\,\\alpha_i\\,K_i + \\nu\\,\\frac{\\alpha_{i+1} - 2\\alpha_i + \\alpha_{i-1}}{\\Delta x^2} \\quad \\text{for } i=1, \\dots, N-2\n$$\n\n在 $x=0$ 和 $x=1$ 处施加齐次 Neumann 边界条件（$\\partial_x \\alpha = 0$）。这是通过在每个时间步之后，将边界点上的时计函数值设置为其内部相邻点的值来实现的：$\\alpha_0 = \\alpha_1$ 和 $\\alpha_{N-1} = \\alpha_{N-2}$。\n\n**2. 时间积分**\n\n该常微分方程组使用显式前向欧拉法进行时间积分。对于一个时间步长 $\\Delta t$，下一个时间层级的时计函数值 $\\alpha^{n+1}$ 由当前层级 $\\alpha^n$ 计算得出：\n$$\n\\alpha^{n+1}_i = \\alpha^n_i + \\Delta t \\left( -\\beta\\,\\frac{\\alpha^n_i - \\alpha^n_{i-1}}{\\Delta x} - 2\\,\\alpha^n_i\\,K_i + \\nu\\,\\frac{\\alpha^n_{i+1} - 2\\alpha^n_i + \\alpha^n_{i-1}}{\\Delta x^2} \\right)\n$$\n此更新对所有内部点 $i=1, \\dots, N-2$ 执行。\n\n这种显式格式的稳定性要求时间步长 $\\Delta t$ 足够小。每次迭代时会自适应地选择时间步长，以满足平流和扩散部分的 Courant-Friedrichs-Lewy (CFL) 条件，以及反应部分的稳定性约束：\n$$\n\\Delta t \\le \\min\\left( \\frac{0.8\\,\\Delta x}{\\beta}, \\frac{0.45\\,\\Delta x^2}{\\nu}, \\frac{0.9}{\\max_i(2\\,K_i) + \\epsilon} \\right)\n$$\n其中 $\\epsilon=10^{-12}$ 是一个小数，用于防止除以零。如果 $\\beta=0$ 或 $\\nu=0$，则对应的 $\\Delta t$ 上限取为无穷大。为确保精确达到最终时间 $T$，必要时会调整最后一个时间步长。\n\n每次时间更新后，通过操作 $\\alpha^{n+1}_i \\leftarrow \\min(1.5, \\max(0, \\alpha^{n+1}_i))$ 将时计函数限制在物理上合理的范围 $[0, 1.5]$ 内。\n\n**3. 搜索最小粘性 $\\nu_{\\min}$**\n\n核心任务是在搜索范围 $[0, \\nu_{\\max}]$ 内找到最小的 $\\nu \\ge 0$，使得解 $\\alpha_\\nu(x,T)$ 同时满足两个条件：\n1.  最大离散梯度大小有界：$G(\\nu) = \\max_{i} \\left|\\frac{\\alpha_\\nu(x_{i+1},T) - \\alpha_\\nu(x_i,T)}{\\Delta x}\\right| \\le G_{\\mathrm{target}}$。\n2.  相对于无粘性基准解（$\\nu=0$）的相对 $\\ell^2$ 偏差有界：$\\mathcal{D}(\\nu) = \\frac{\\|\\alpha_\\nu(\\cdot,T) - \\alpha_0(\\cdot,T)\\|_2}{\\|\\alpha_0(\\cdot,T)\\|_2} \\le \\delta_{\\max}$。\n\n对 $\\nu_{\\min}$ 的搜索使用二分算法执行。每个测试案例的程序如下：\n1.  首先，通过运行 $\\nu=0$ 的模拟来计算基准解 $\\alpha_0(\\cdot,T)$。\n2.  检查 $\\nu=0$ 时的情况。由于 $\\mathcal{D}(0)=0$，这只需要检查是否 $G(0) \\le G_{\\mathrm{target}}$。如果为真，则 $\\nu_{\\min}=0$。\n3.  如果 $\\nu=0$ 不是解，则检查 $\\nu=\\nu_{\\max}$ 的情况。如果不满足条件，则在给定范围内不存在解，并将 $\\nu_{\\min}$ 报告为 $\\nu_{\\max}$。\n4.  如果在 $(0, \\nu_{\\max}]$ 中存在解，则在区间 $[0, \\nu_{\\max}]$ 上启动二分搜索。设此区间为 $[L, H]$。\n5.  在每次迭代中，评估中点 $\\nu_{\\text{mid}} = (L+H)/2$。运行 $\\nu=\\nu_{\\text{mid}}$ 的模拟以获得 $\\alpha_{\\text{mid}}(\\cdot,T)$，并计算指标 $G(\\nu_{\\text{mid}})$ 和 $\\mathcal{D}(\\nu_{\\text{mid}})$。\n6.  如果 $\\nu_{\\text{mid}}$ 满足两个标准，则意味着找到了一个有效解。为了找到这样的*最小*值，通过设置 $H = \\nu_{\\text{mid}}$ 在区间的下半部分继续搜索。\n7.  如果标准未被满足，则 $\\nu_{\\text{mid}}$ 太小，需要更大的粘性。通过设置 $L = \\nu_{\\text{mid}}$ 在区间的上半部分继续搜索。\n8.  该过程重复进行，直到搜索区间宽度 $H-L$ 小于指定的容差 $10^{-6}$。最终结果是上界 $H$，它代表找到的 $\\nu_{\\min}$ 的最佳近似值。\n\n这种系统化的方法保证了在问题约束下对所需最小人工粘性的稳健而精确的确定。实现中对空间导数计算进行了矢量化以提高效率。", "answer": "```python\nimport numpy as np\n\ndef setup_K_profile(x, k_type, k_params):\n    \"\"\"\n    Sets up the extrinsic curvature K(x) profile.\n    \n    Args:\n        x (np.ndarray): The spatial grid.\n        k_type (str): Type of profile ('piecewise' or 'gaussian').\n        k_params (tuple): Parameters for the K profile.\n\n    Returns:\n        np.ndarray: The array K(x).\n    \"\"\"\n    if k_type == 'piecewise':\n        x_int, k_left, k_right = k_params\n        K = np.full_like(x, k_right)\n        K[x  x_int] = k_left\n        return K\n    elif k_type == 'gaussian':\n        k0, k_spike, x_s, sigma_K = k_params\n        return k0 + k_spike * np.exp(-((x - x_s)**2) / sigma_K**2)\n    else:\n        raise ValueError(\"Unknown K profile type\")\n\ndef setup_initial_alpha(x, A, xc, sigma):\n    \"\"\"\n    Sets up the initial lapse profile alpha(x, 0).\n    \n    Args:\n        x (np.ndarray): The spatial grid.\n        A (float): Amplitude parameter.\n        xc (float): Center parameter.\n        sigma (float): Steepness parameter.\n\n    Returns:\n        np.ndarray: The initial alpha profile.\n    \"\"\"\n    return 1.0 - A * np.tanh((x - xc) / sigma)\n\ndef run_simulation(case_params, nu):\n    \"\"\"\n    Solves the lapse evolution equation up to time T.\n\n    Args:\n        case_params (dict): Dictionary of parameters for the simulation case.\n        nu (float): The artificial viscosity coefficient.\n\n    Returns:\n        np.ndarray: The lapse profile alpha at the final time T.\n    \"\"\"\n    N, beta, T = case_params['N'], case_params['beta'], case_params['T']\n    A, xc, sigma = case_params['A'], case_params['xc'], case_params['sigma']\n    k_type, k_params = case_params['k_type'], case_params['k_params']\n    \n    x = np.linspace(0, 1, N)\n    dx = 1.0 / (N - 1)\n\n    alpha = setup_initial_alpha(x, A, xc, sigma)\n    K = setup_K_profile(x, k_type, k_params)\n    \n    t = 0.0\n    epsilon = 1e-12\n\n    dt_react_bound = 0.9 / (2 * np.max(K) + epsilon)\n    dt_adv_bound = 0.8 * dx / beta if beta > 0 else np.inf\n    K_interior = K[1:-1]\n    \n    while t  T:\n        dt_diff_bound = 0.45 * dx**2 / nu if nu > 0 else np.inf\n        \n        dt = min(dt_adv_bound, dt_diff_bound, dt_react_bound)\n        if t + dt > T:\n            dt = T - t\n        \n        alpha_n = alpha.copy()\n        \n        # Vectorized update for interior points\n        alpha_c = alpha_n[1:-1]  # i\n        alpha_l = alpha_n[0:-2]  # i-1\n        alpha_r = alpha_n[2:]    # i+1\n\n        adv_term = -beta * (alpha_c - alpha_l) / dx\n        react_term = -2 * alpha_c * K_interior\n        diff_term = nu * (alpha_r - 2 * alpha_c + alpha_l) / (dx**2)\n        \n        alpha[1:-1] = alpha_c + dt * (adv_term + react_term + diff_term)\n\n        # Homogeneous Neumann boundary conditions\n        alpha[0] = alpha[1]\n        alpha[N-1] = alpha[N-2]\n        \n        # Clamping\n        np.clip(alpha, 0, 1.5, out=alpha)\n\n        t += dt\n            \n    return alpha\n\ndef check_criteria(alpha_nu, alpha_0, dx, G_target, delta_max):\n    \"\"\"\n    Checks if the solution alpha_nu satisfies the given criteria.\n\n    Args:\n        alpha_nu (np.ndarray): The solution with viscosity nu.\n        alpha_0 (np.ndarray): The baseline solution (nu=0).\n        dx (float): Grid spacing.\n        G_target (float): Target for max gradient.\n        delta_max (float): Target for relative L2 deviation.\n\n    Returns:\n        bool: True if criteria are satisfied, False otherwise.\n    \"\"\"\n    # Max gradient metric G(nu)\n    grad = np.abs(np.diff(alpha_nu) / dx)\n    G = np.max(grad)\n\n    # Relative L2 deviation D(nu)\n    norm_diff_sq = np.sum((alpha_nu - alpha_0)**2 * dx)\n    norm_base_sq = np.sum(alpha_0**2 * dx)\n    \n    D = np.sqrt(norm_diff_sq / norm_base_sq) if norm_base_sq > 1e-20 else np.inf\n\n    return G = G_target and D = delta_max\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and find minimal viscosity.\n    \"\"\"\n    test_cases = [\n        # Case 1 (general, piecewise K)\n        {'N': 128, 'beta': 0.3, 'A': 0.8, 'sigma': 0.02, 'xc': 0.5, 'T': 0.2, \n         'k_type': 'piecewise', 'k_params': (0.5, 0.2, 0.8), \n         'G_target': 30, 'delta_max': 0.1, 'nu_max': 0.02},\n        # Case 2 (high advection, piecewise K)\n        {'N': 128, 'beta': 0.9, 'A': 0.7, 'sigma': 0.015, 'xc': 0.5, 'T': 0.15,\n         'k_type': 'piecewise', 'k_params': (0.4, 0.1, 0.5),\n         'G_target': 50, 'delta_max': 0.12, 'nu_max': 0.02},\n        # Case 3 (no advection, piecewise K)\n        {'N': 128, 'beta': 0.0, 'A': 0.85, 'sigma': 0.01, 'xc': 0.5, 'T': 0.2,\n         'k_type': 'piecewise', 'k_params': (0.6, 0.3, 1.0),\n         'G_target': 25, 'delta_max': 0.08, 'nu_max': 0.02},\n        # Case 4 (Gaussian spike in K)\n        {'N': 128, 'beta': 0.4, 'A': 0.9, 'sigma': 0.008, 'xc': 0.5, 'T': 0.1,\n         'k_type': 'gaussian', 'k_params': (0.2, 1.2, 0.6, 0.03),\n         'G_target': 60, 'delta_max': 0.15, 'nu_max': 0.02}\n    ]\n\n    results = []\n    tol = 1e-6\n    \n    for case in test_cases:\n        dx = 1.0 / (case['N'] - 1)\n        G_target, delta_max, nu_max = case['G_target'], case['delta_max'], case['nu_max']\n        \n        alpha_0 = run_simulation(case, 0.0)\n        \n        if check_criteria(alpha_0, alpha_0, dx, G_target, delta_max):\n            results.append(0.0)\n            continue\n            \n        alpha_nu_max = run_simulation(case, nu_max)\n        if not check_criteria(alpha_nu_max, alpha_0, dx, G_target, delta_max):\n            results.append(nu_max)\n            continue\n        \n        low, high = 0.0, nu_max\n        while high - low > tol:\n            mid = low + (high - low) / 2\n            if mid == low or mid == high:\n                break\n            \n            alpha_mid = run_simulation(case, mid)\n            if check_criteria(alpha_mid, alpha_0, dx, G_target, delta_max):\n                high = mid\n            else:\n                low = mid\n        \n        results.append(high)\n\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```", "id": "3462413"}]}