{"hands_on_practices": [{"introduction": "在间断Galerkin (DG) 方法中，解通常用一组基函数（如勒让德多项式）的模态系数来表示。限制器的作用便是通过修改这些系数来控制解的形态并抑制伪振荡。本练习将引导你推导一个基础但至关重要的关系：单元内解的直观“物理斜率”与其一阶模态系数之间的数学联系。理解此关系是掌握DG方法中限制器工作原理的第一步 [@problem_id:3424008]。", "problem": "考虑一个用于标量守恒律的一维间断 Galerkin (DG) 方法，其多项式次数为 $p=1$，建立在均匀网格上。我们关注单个单元 $I_j=[x_{j-\\frac{1}{2}},x_{j+\\frac{1}{2}}]$，其长度为 $h_j=x_{j+\\frac{1}{2}}-x_{j-\\frac{1}{2}}$，中心为 $x_j=\\frac{1}{2}\\left(x_{j-\\frac{1}{2}}+x_{j+\\frac{1}{2}}\\right)$。限制在单元 $I_j$ 上的 DG 解以守恒线性形式表示为 $u_h|_{I_j}(x)=\\bar{u}_j+\\sigma_j\\,(x-x_j)$，其中 $\\bar{u}_j$ 是单元平均值，$\\sigma_j$ 是单元斜率。设该单元通过仿射变换 $x=x_j+\\frac{h_j}{2}\\,\\xi$（其中 $\\xi\\in[-1,1]$）映射到参考单元。在参考单元上，考虑 Legendre 多项式基 $\\{P_0(\\xi),P_1(\\xi)\\}$，其中 $P_0(\\xi)=1$ 且 $P_1(\\xi)=\\xi$。通过在 $[-1,1]$ 上关于标准内积的 $L^2$ 投影来定义模式系数。也就是说，写成\n$$\nu_h(x(\\xi))=\\hat{u}_{j,0}\\,P_0(\\xi)+\\hat{u}_{j,1}\\,P_1(\\xi),\n$$\n其中系数 $\\hat{u}_{j,0}$ 和 $\\hat{u}_{j,1}$ 是 Legendre 模式系数。利用 Legendre 多项式的正交性，即 $\\int_{-1}^{1}P_m(\\xi)\\,P_n(\\xi)\\,d\\xi=\\frac{2}{2n+1}\\,\\delta_{mn}$，以及参考映射，从第一性原理推导出一个将物理斜率 $\\sigma_j$ 映射到第一个模式系数 $\\hat{u}_{j,1}$ 的闭式表达式。你的最终答案必须是关于 $\\sigma_j$ 和 $h_j$ 的单个解析表达式。不需要四舍五入，也不涉及物理单位。同时简要解释为什么在次数 $p=1$ 的 DG 格式中，这个映射是总变差有界 (TVB) 限制器的目标。", "solution": "该问题是有效的。这是一个在偏微分方程数值分析领域中适定的、有科学依据的问题。所有必要信息都已提供，目标是基于间断 Galerkin (DG) 方法的标准原理进行形式推导。\n\n主要目标是为一个在单元 $I_j$ 内多项式次数为 $p=1$ 的 DG 解，推导物理斜率 $\\sigma_j$ 与第一个 Legendre 模式系数 $\\hat{u}_{j,1}$ 之间的关系。\n\n单元 $I_j$ 内的解 $u_h$ 有两种等价的表示形式。在物理坐标 $x \\in I_j = [x_{j-\\frac{1}{2}}, x_{j+\\frac{1}{2}}]$ 中，其表示为：\n$$\nu_h(x) = \\bar{u}_j + \\sigma_j (x - x_j)\n$$\n其中 $\\bar{u}_j$ 是单元平均值，$\\sigma_j$ 是单元斜率， $x_j$ 是单元中心。\n\n单元 $I_j$ 通过仿射变换映射到参考单元 $\\xi \\in [-1, 1]$：\n$$\nx(\\xi) = x_j + \\frac{h_j}{2} \\xi\n$$\n其中 $h_j$ 是单元 $I_j$ 的长度。通过将此映射代入物理表示中，我们可以将解表示为参考坐标 $\\xi$ 的函数：\n$$\nu_h(x(\\xi)) = \\bar{u}_j + \\sigma_j \\left( \\left(x_j + \\frac{h_j}{2} \\xi\\right) - x_j \\right) = \\bar{u}_j + \\sigma_j \\frac{h_j}{2} \\xi\n$$\n\n在参考单元中，解也可以用 Legendre 多项式基 $\\{P_0(\\xi), P_1(\\xi)\\}$ 以模式形式表示，其中 $P_0(\\xi) = 1$ 且 $P_1(\\xi) = \\xi$：\n$$\nu_h(x(\\xi)) = \\hat{u}_{j,0} P_0(\\xi) + \\hat{u}_{j,1} P_1(\\xi) = \\hat{u}_{j,0} + \\hat{u}_{j,1} \\xi\n$$\n其中 $\\hat{u}_{j,0}$ 和 $\\hat{u}_{j,1}$ 是模式系数。\n\n问题陈述，模式系数是通过将解在基函数上进行 $L^2$ 投影来确定的。将函数 $f(\\xi)$ 投影到区间 $[-1, 1]$ 上的正交基函数 $P_n(\\xi)$ 的公式为：\n$$\n\\hat{f}_n = \\frac{\\langle f, P_n \\rangle}{\\langle P_n, P_n \\rangle} = \\frac{\\int_{-1}^{1} f(\\xi) P_n(\\xi) d\\xi}{\\int_{-1}^{1} P_n(\\xi)^2 d\\xi}\n$$\n\n我们应用此公式来求解系数 $\\hat{u}_{j,1}$：\n$$\n\\hat{u}_{j,1} = \\frac{\\int_{-1}^{1} u_h(x(\\xi)) P_1(\\xi) d\\xi}{\\int_{-1}^{1} P_1(\\xi)^2 d\\xi}\n$$\n\n分母由问题陈述中给出的 Legendre 多项式的正交性性质给出：$\\int_{-1}^{1}P_m(\\xi)P_n(\\xi)d\\xi = \\frac{2}{2n+1}\\delta_{mn}$。对于 $n=1$，这得到：\n$$\n\\int_{-1}^{1} P_1(\\xi)^2 d\\xi = \\frac{2}{2(1)+1} = \\frac{2}{3}\n$$\n因此，$\\hat{u}_{j,1}$ 的表达式简化为：\n$$\n\\hat{u}_{j,1} = \\frac{3}{2} \\int_{-1}^{1} u_h(x(\\xi)) P_1(\\xi) d\\xi\n$$\n\n现在，我们将 $u_h(x(\\xi))$ 和 $P_1(\\xi) = \\xi$ 的表达式代入积分中：\n$$\n\\hat{u}_{j,1} = \\frac{3}{2} \\int_{-1}^{1} \\left(\\bar{u}_j + \\sigma_j \\frac{h_j}{2} \\xi\\right) \\xi \\,d\\xi\n$$\n我们展开被积函数：\n$$\n\\hat{u}_{j,1} = \\frac{3}{2} \\int_{-1}^{1} \\left(\\bar{u}_j \\xi + \\sigma_j \\frac{h_j}{2} \\xi^2\\right) d\\xi\n$$\n利用积分的线性性质，我们可以将其分成两部分：\n$$\n\\hat{u}_{j,1} = \\frac{3}{2} \\left( \\int_{-1}^{1} \\bar{u}_j \\xi \\,d\\xi + \\int_{-1}^{1} \\sigma_j \\frac{h_j}{2} \\xi^2 \\,d\\xi \\right)\n$$\n第一个积分 $\\int_{-1}^{1} \\bar{u}_j \\xi \\,d\\xi$ 是一个奇函数 ($\\xi$) 在对称区间上的积分，其值为零。\n$$\n\\int_{-1}^{1} \\bar{u}_j \\xi \\,d\\xi = \\bar{u}_j \\left[ \\frac{\\xi^2}{2} \\right]_{-1}^{1} = \\bar{u}_j \\left(\\frac{1}{2} - \\frac{1}{2}\\right) = 0\n$$\n第二个积分是：\n$$\n\\int_{-1}^{1} \\sigma_j \\frac{h_j}{2} \\xi^2 \\,d\\xi = \\sigma_j \\frac{h_j}{2} \\int_{-1}^{1} \\xi^2 \\,d\\xi = \\sigma_j \\frac{h_j}{2} \\left[ \\frac{\\xi^3}{3} \\right]_{-1}^{1} = \\sigma_j \\frac{h_j}{2} \\left(\\frac{1}{3} - \\frac{-1}{3}\\right) = \\sigma_j \\frac{h_j}{2} \\left(\\frac{2}{3}\\right) = \\sigma_j \\frac{h_j}{3}\n$$\n将此结果代回 $\\hat{u}_{j,1}$ 的表达式中：\n$$\n\\hat{u}_{j,1} = \\frac{3}{2} \\left( 0 + \\sigma_j \\frac{h_j}{3} \\right) = \\frac{3}{2} \\left( \\frac{\\sigma_j h_j}{3} \\right)\n$$\n简化此表达式即可得到从物理斜率 $\\sigma_j$到模式系数 $\\hat{u}_{j,1}$ 的最终映射：\n$$\n\\hat{u}_{j,1} = \\frac{1}{2} \\sigma_j h_j\n$$\n\n关于与总变差有界 (TVB) 限制器的联系：\n对于双曲守恒律的间断解，像 DG 这样的高阶数值方法会在激波或陡峭梯度附近产生伪振荡 (Gibbs 现象)。限制器旨在抑制这些振荡，以保持物理真实性和数值稳定性。对于一个标量守恒律，精确解的总变差 (TV) 随时间不增。TVD (总变差递减) 和 TVB (总变差有界) 格式旨在对数值解强制施加一个类似的性质。\n在 $p=1$ 的 DG 格式中，单元 $I_j$ 内的解由单元平均值 $\\bar{u}_j$ 和一个由斜率 $\\sigma_j$ 表征的线性部分组成。单元平均值 $\\bar{u}_j$ 代表守恒量，是该格式守恒性的基础；它通常不被限制器修改。斜率 $\\sigma_j$ 代表解的高阶分量，是产生潜在过冲和下冲的原因。因此，用于 $p=1$ DG 的限制器专注于修改或“限制”这个斜率。\n推导出的关系 $\\hat{u}_{j,1} = \\frac{1}{2} \\sigma_j h_j$ 表明，第一个模式系数 $\\hat{u}_{j,1}$ 与物理斜率 $\\sigma_j$（按单元尺寸 $h_j$ 缩放）成正比。这种正比关系至关重要。它意味着限制模式系数 $\\hat{u}_{j,1}$ 的大小在数学上等价于限制物理斜率 $\\sigma_j$ 的大小。TVB 限制器，例如广泛使用的基于 minmod 的限制器，其工作原理是将当前的模式系数 $\\hat{u}_{j,1}$ 与根据相邻单元的平均值差异导出的量进行比较。这种比较可以确定斜率是否“太陡”并有引起振荡的风险。如果是，$\\hat{u}_{j,1}$ 将被一个“受限”值取代，这反过来又会减小物理斜率 $\\sigma_j$，从而在局部上将格式驱动到单元内的一个非振荡的、一阶精确的常数状态。因此，所推导的映射是基本联系，它使得斜率限制这一物理概念能够在 DG 方法的模式空间中进行计算实现。", "answer": "$$\n\\boxed{\\frac{1}{2}\\sigma_j h_j}\n$$", "id": "3424008"}, {"introduction": "总变差有界 (TVB) 限制器的核心设计哲学，是避免在解的光滑区域进行不必要的修正，从而保持算法的高阶精度，这与更严格的总变差递减 (TVD) 限制器形成对比。此特性通过引入一个依赖于网格尺度的阈值 $M h^2$ 来实现。本练习要求你基于一个已知的解析解，推导出如何校准关键参数 $M$ 以保证限制器在光滑区域“保持沉默”，从而深入理解TVB方法在精度保持方面的优势 [@problem_id:3424065]。", "problem": "考虑一维标量守恒律 $u_{t} + (f(u))_{x} = s(x)$，定义在具有均匀网格间距 $h>0$ 的周期性区域上。其数值方法为采用总变差有界 (TVB) 斜率限制器的分片线性间断Galerkin (DG) 格式。\n\n设通量为 $f(u) = \\frac{1}{2}u^{2}$，并考虑制造的稳态解 $u(x) = A \\sin(k x)$（其中振幅 $A>0$ 且波数 $k>0$），以及源项 $s(x) = (f(u(x)))_{x}$。因此，对于所有 $x$，都有 $(f(u))_{x} - s(x) = 0$，即通量梯度与源项精确平衡。\n\n在TVB限制器中，修正的minmod函数使用一个基于单元平均值二阶差分的光滑度传感器。将单元 $I_{i}$ 中的单元平均值记为 $\\bar{u}_{i}$。如果光滑度条件\n$$\n|\\bar{u}_{i+1} - 2\\bar{u}_{i} + \\bar{u}_{i-1}| \\le M h^{2}\n$$\n成立，则单元 $I_{i}$ 中的限制器被视为非激活状态。其中 $M>0$ 是用户选择的TVB参数。否则，限制器将激活并减小斜率。假设网格足够细，使得 $u(x)$ 得到良好解析，并且不带限制的DG重构能够在光滑区域恢复正确的局部斜率。\n\n从光滑解的泰勒展开和上述TVB光滑度传感器的定义出发，对于足够小的 $h$，推导出一个关于 $A$ 和 $k$ 的最小 $M$ 值的解析表达式。该表达式需保证在制造的稳态解的所有光滑区域（即处处，因为 $(f(u))_{x} - s(x) = 0$ 恒成立），限制器都保持非激活状态。您的最终答案必须是关于 $A$ 和 $k$ 的单个闭式表达式，不含任何数值近似或舍入。", "solution": "用户提出了一个关于确定间断Galerkin (DG) 数值格式中总变差有界 (TVB) 限制器参数的问题。目标是找到TVB参数 $M$ 的最小值，以防止限制器在已知的、光滑的稳态解上被激活。\n\n问题陈述已经过验证，被认为是具有科学依据、适定且客观的。它代表了偏微分方程数值方法领域的一项标准分析。\n\n问题的核心在于TVB光滑度传感器条件，该条件规定：如果以下不等式成立，则单元 $I_i$ 中的斜率限制器处于非激活状态：\n$$\n|\\bar{u}_{i+1} - 2\\bar{u}_{i} + \\bar{u}_{i-1}| \\le M h^{2}\n$$\n此处，$\\bar{u}_i$ 是解 $u(x)$ 在单元 $I_i = [x_{i-1/2}, x_{i+1/2}]$ 上的平均值，$h = x_{i+1/2} - x_{i-1/2}$ 是均匀的网格间距，$M$ 是TVB参数。我们需要找到最小的 $M > 0$，以确保对于给定的光滑制造解 $u(x) = A \\sin(k x)$，此条件对所有单元 $i$ 都成立。\n\n设 $x_i$ 为单元 $I_i$ 的中心。单元平均值 $\\bar{u}_i$ 定义为：\n$$\n\\bar{u}_i = \\frac{1}{h} \\int_{x_i - h/2}^{x_i + h/2} u(x) \\, dx\n$$\n对于一个光滑函数 $u(x)$ 和一个小的网格尺寸 $h$，我们可以将 $u(x)$ 在 $x_i$ 附近进行泰勒级数展开：\n$$\nu(x) = u(x_i) + u'(x_i)(x-x_i) + \\frac{u''(x_i)}{2!}(x-x_i)^2 + \\frac{u'''(x_i)}{3!}(x-x_i)^3 + \\dots\n$$\n将此展开式代入单元平均值的积分中可得：\n$$\n\\bar{u}_i = \\frac{1}{h} \\int_{x_i - h/2}^{x_i + h/2} \\left( u(x_i) + u'(x_i)(x-x_i) + \\frac{u''(x_i)}{2}(x-x_i)^2 + \\dots \\right) dx\n$$\n积分后，由于积分区间 $[-h/2, h/2]$ 的对称性，$(x-x_i)$ 的奇次幂项会消失。\n$$\n\\bar{u}_i = \\frac{1}{h} \\left[ u(x_i)h + u'(x_i) \\cdot 0 + \\frac{u''(x_i)}{2} \\frac{h^3}{12} + \\frac{u^{(4)}(x_i)}{24} \\frac{h^5}{80} + \\dots \\right]\n$$\n这就得到了著名的单元平均值展开式：\n$$\n\\bar{u}_i = u(x_i) + \\frac{h^2}{24} u''(x_i) + O(h^4)\n$$\n现在，我们必须分析中心差分项 $|\\bar{u}_{i+1} - 2\\bar{u}_{i} + \\bar{u}_{i-1}|$。让我们代入每个平均值的展开式。单元中心分别位于 $x_{i-1} = x_i - h$，$x_i$ 和 $x_{i+1} = x_i + h$。\n\\begin{align*}\n\\bar{u}_{i+1} - 2\\bar{u}_{i} + \\bar{u}_{i-1} = \\left( u(x_{i+1}) + \\frac{h^2}{24} u''(x_{i+1}) + O(h^4) \\right) \\\\\n\\quad - 2 \\left( u(x_i) + \\frac{h^2}{24} u''(x_i) + O(h^4) \\right) \\\\\n\\quad + \\left( u(x_{i-1}) + \\frac{h^2}{24} u''(x_{i-1}) + O(h^4) \\right)\n\\end{align*}\n按被差分的函数对各项进行分组：\n$$\n\\bar{u}_{i+1} - 2\\bar{u}_{i} + \\bar{u}_{i-1} = (u(x_{i+1}) - 2u(x_i) + u(x_{i-1})) + \\frac{h^2}{24}(u''(x_{i+1}) - 2u''(x_i) + u''(x_{i-1})) + O(h^6)\n$$\n括号中的表达式是标准的二阶中心差分近似。它们的泰勒级数展开式为：\n$$\nu(x_{i+1}) - 2u(x_i) + u(x_{i-1}) = h^2 u''(x_i) + \\frac{h^4}{12} u^{(4)}(x_i) + O(h^6)\n$$\n$$\nu''(x_{i+1}) - 2u''(x_i) + u''(x_{i-1}) = h^2 (u'')''(x_i) + O(h^4) = h^2 u^{(4)}(x_i) + O(h^4)\n$$\n将这些展开式代回平均值的差分表达式中：\n$$\n\\bar{u}_{i+1} - 2\\bar{u}_{i} + \\bar{u}_{i-1} = \\left( h^2 u''(x_i) + \\frac{h^4}{12} u^{(4)}(x_i) \\right) + \\frac{h^2}{24} \\left( h^2 u^{(4)}(x_i) \\right) + O(h^6)\n$$\n$$\n\\bar{u}_{i+1} - 2\\bar{u}_{i} + \\bar{u}_{i-1} = h^2 u''(x_i) + \\left( \\frac{1}{12} + \\frac{1}{24} \\right) h^4 u^{(4)}(x_i) + O(h^6) = h^2 u''(x_i) + O(h^4)\n$$\n问题陈述该分析适用于“足够小的 $h$”，这意味着我们关心的是主阶行为。光滑度条件变为：\n$$\n|h^2 u''(x_i) + O(h^4)| \\le M h^2\n$$\n两边同除以 $h^2$：\n$$\n|u''(x_i) + O(h^2)| \\le M\n$$\n为使此不等式在 $h \\to 0$ 时对任意给定的 $x_i$ 都成立，我们必须有：\n$$\n|u''(x_i)| \\le M\n$$\n为确保限制器在整个光滑解上保持非激活状态，此条件必须对所有可能的单元位置 $x_i$ 都满足。随着网格的细化，单元中心集合 $\\{x_i\\}$ 在定义域中变得稠密。因此，参数 $M$ 的选择必须满足：\n$$\nM \\ge \\sup_{x} |u''(x)|\n$$\n因此，保证限制器在光滑解上永不激活的 $M$ 的最小值是解的二阶导数绝对值的上确界（或最大值，因为在周期性设置中隐含了函数在紧集上的连续性）。\n$$\nM_{min} = \\max_x |u''(x)|\n$$\n给定的制造解为 $u(x) = A \\sin(k x)$。我们计算它的一阶和二阶导数：\n一阶导数：\n$$\nu'(x) = \\frac{d}{dx} (A \\sin(k x)) = A k \\cos(k x)\n$$\n二阶导数：\n$$\nu''(x) = \\frac{d}{dx} (A k \\cos(k x)) = -A k^2 \\sin(k x)\n$$\n现在，我们求 $u''(x)$ 的最大绝对值：\n$$\n|u''(x)| = |-A k^2 \\sin(k x)|\n$$\n鉴于 $A > 0$ 且 $k > 0$，项 $A k^2$ 是一个正常数。\n$$\n|u''(x)| = A k^2 |\\sin(k x)|\n$$\n函数 $|\\sin(\\theta)|$ 的最大值为 $1$。因此，$|u''(x)|$ 的最大值为：\n$$\n\\max_x |u''(x)| = A k^2 \\cdot \\max_x |\\sin(k x)| = A k^2 \\cdot 1 = A k^2\n$$\n确保限制器对给定的光滑解保持非激活状态的TVB参数 $M$ 的最小值为 $A k^2$。关于具体通量函数 $f(u)$ 和源项 $s(x)$ 的信息，其作用是证明 $u(x) = A \\sin(k x)$ 是基础守恒律的一个有效稳态解，但这些信息本身不进入 $M$ 的计算，因为限制器条件仅依赖于解变量 $u$。", "answer": "$$\n\\boxed{A k^{2}}\n$$", "id": "3424065"}, {"introduction": "在解决了光滑区域的精度问题后，我们必须转向一个更深刻的挑战：确保解的物理可容许性。虽然较大的 $M$ 值有助于保持精度，但在不连续（如激波）附近，它可能允许产生非物理的数值现象。本节的高级实践将通过代码构造一个具体的反例，展示不当的 $M$ 值如何导致数值解违反熵条件。此练习不仅揭示了精度与稳定性之间的微妙权衡，还探讨了如何检测并修正这类关键问题，这对于开发可靠的数值格式至关重要 [@problem_id:3424004]。", "problem": "考虑一维标量守恒律 $u_t + f(u)_x = 0$，其无粘伯格斯通量为 $f(u) = \\tfrac{1}{2}u^2$，凸数学熵为 $U(u) = \\tfrac{1}{2}u^2$。在周期性域 $[0,1]$ 上进行计算，该域被划分为 $N$ 个均匀网格，其中 $N = 20$，网格尺寸 $\\Delta x = 1/N$。使用 $p=1$ 阶（每个网格上分段线性）的间断伽辽金(DG)表示，因此在每个以 $x_i$ 为中心的网格 $K_i = [x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}]$ 上，多项式表示为 $u_i(x) = \\bar{u}_i + s_i (x - x_i)$，其中 $\\bar{u}_i$ 是网格平均值，$s_i$ 是通过将初始条件 $L^2$ 投影到 $K_i$ 上的一阶多项式而获得的（未限制的）斜率。使用一个欠解析的阶跃函数进行初始化：\n- 当 $x  x_0$ 时，$u_0(x) = 1$；当 $x \\ge x_0$ 时，$u_0(x) = 0$\n- 阶跃位于 $x_0 = \\tfrac{1}{3} + \\tfrac{1}{4}\\Delta x$，以使间断严格位于单个网格内部（不与界面对齐）。\n\n将全变差有界(TVB) minmod限制器（TVB代表Total Variation Bounded）应用于斜率 $s_i$，具体如下。令 $\\Delta^+ \\bar{u}_i = \\bar{u}_{i+1} - \\bar{u}_i$ 和 $\\Delta^- \\bar{u}_i = \\bar{u}_i - \\bar{u}_{i-1}$，并采用周期性索引。定义TVB阈值参数 $M  0$ 和基于网格的阈值 $\\tau_i = M (\\Delta x)^2$。经TVB修正的minmod斜率为：\n- 如果 $(\\Delta x)^2 |s_i| \\le M$，则 $s_i^{\\text{TVB}} = s_i$（不限制），\n- 否则 $s_i^{\\text{TVB}} = \\operatorname{minmod}\\!\\big(s_i, \\tfrac{\\Delta^+ \\bar{u}_i}{\\Delta x}, \\tfrac{\\Delta^- \\bar{u}_i}{\\Delta x}\\big)$，\n其中，如果 $\\operatorname{sign}(a)=\\operatorname{sign}(b)=\\operatorname{sign}(c)$，则 $\\operatorname{minmod}(a,b,c)$ 返回 $\\operatorname{sign}(a)\\min(|a|,|b|,|c|)$，否则返回 $0$。\n\n将每个网格的离散熵定义为 $U(u_i(x))$ 在每个 $K_i$ 上的积分：\n$$\nE_i(s) = \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} U\\big(\\bar{u}_i + s(x - x_i)\\big)\\,dx,\n$$\n其中 $s$ 可取基准限制斜率 $s_i^{\\text{base}}$ 或 $M$-TVB-限制斜率 $s_i^{\\text{TVB}}$。使用以下基准进行比较：严格的全变差递减(TVD) minmod限制器，它对应于TVB参数 $M=0$，得到 $s_i^{\\text{base}} = \\operatorname{minmod}\\!\\big(s_i, \\tfrac{\\Delta^+ \\bar{u}_i}{\\Delta x}, \\tfrac{\\Delta^- \\bar{u}_i}{\\Delta x}\\big)$。\n\n你的任务：\n1. 在上述设置中构造一个具体的反例，证明不当缩放的 $M$ 会导致欠解析梯度附近的熵增。具体来说，确定包含间断的单个“问题最严重”的网格 $K_j$（即 $|s_i|$ 最大的那个网格），并计算 $E_j(s_j^{\\text{TVB}})$ 和 $E_j(s_j^{\\text{base}})$。如果 $E_j(s_j^{\\text{TVB}})  E_j(s_j^{\\text{base}}) + \\varepsilon$（其中 $\\varepsilon = 10^{-12}$），则宣告发生了熵增。\n2. 检测规则：对于给定的 $M$，计算布尔检测器 $\\mathcal{D}(M)$。如果根据上述标准在 $K_j$ 中发生熵增，则其值为 $1$（真），否则为 $0$（假）。\n3. 修正策略：如果 $\\mathcal{D}(M)=1$，则在 $K_j$ 中使用基准TVD限制器进行后验修复（即，设置 $s_j^{\\text{mit}} = s_j^{\\text{base}}$）并重新计算熵。报告经过此修正后，根据相同标准判断熵增是否仍然存在。\n\n测试套件：\n- 情况1（正常路径）：$M = 10^{-3}$，不应用修正。输出指示熵增是否仍然存在的布尔值。\n- 情况2（反例）：$M = 1$，不应用修正。输出指示熵增是否仍然存在的布尔值。\n- 情况3（已修正）：$M = 1$，如果检测器触发则应用修正。输出修正后熵增是否仍然存在的布尔值。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按上述情况的顺序排列结果。例如，如果布尔值为false、true、false，则输出必须精确打印为：“[False,True,False]”。\n- 所有输出均为布尔值。此任务不涉及物理单位或角度单位。\n\n解决方案必须从间断伽辽金方法与分段线性基函数的基本定义、TVB限制器定义、凸熵积分以及凸函数的性质中推导得出。除了这些定义之外，不要假设任何快捷公式；所有必需的表达式都必须在你的推理中从第一性原理推导。所构造的示例必须能由提供的程序在没有任何用户输入的情况下复现，仅使用指定的测试套件参数。", "solution": "该问题要求我们构造一个特定的数值反例，以证明全变差有界(TVB)限制器在某些条件下会导致离散数学熵的局部增加，而严格的全变差递减(TVD)限制器旨在防止这种行为。我们将遵循一种系统的、基于原理的方法来推导必要的量并评估测试用例。\n\n### 步骤1：间断伽辽金方法的初始数据投影\n\n该问题设置在周期性域 $[0,1]$ 上，有 $N=20$ 个网格，因此网格宽度为 $\\Delta x = 1/N = 0.05$。网格为 $K_i = [x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}]$，其中 $i=0, \\dots, N-1$，网格界面为 $x_{i-\\frac{1}{2}} = i\\Delta x$，网格中心为 $x_i = (i+0.5)\\Delta x$。\n\n每个网格内的解由一个 $p=1$ 阶多项式表示：$u_i(x) = \\bar{u}_i + s_i(x-x_i)$。系数 $\\bar{u}_i$（网格平均值）和 $s_i$（斜率）是通过将初始条件 $u_0(x)$ $L^2$ 投影到 $K_i$ 上的多项式基函数上确定的。与此表示相对应的基函数是 $\\{1, x-x_i\\}$，它们在对称的网格区间 $[x_i-\\Delta x/2, x_i+\\Delta x/2]$ 上是正交的。\n\n网格平均值 $\\bar{u}_i$ 是通过将 $u_0(x)$ 投影到常数基函数上来确定的：\n$$\n\\bar{u}_i = \\frac{1}{\\Delta x} \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u_0(x) \\, dx\n$$\n\n斜率 $s_i$ 是通过将 $u_0(x)$ 投影到线性基函数 $(x-x_i)$ 上来确定的：\n$$\ns_i \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} (x - x_i)^2 \\, dx = \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u_0(x) (x - x_i) \\, dx\n$$\n左侧的归一化积分为 $\\int_{-\\Delta x/2}^{\\Delta x/2} \\xi^2 \\, d\\xi = [\\xi^3/3]_{-\\Delta x/2}^{\\Delta x/2} = \\Delta x^3/12$。由此可得斜率的公式：\n$$\ns_i = \\frac{12}{\\Delta x^3} \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u_0(x) (x - x_i) \\, dx\n$$\n\n初始条件是一个阶跃函数：当 $x  x_0$ 时 $u_0(x) = 1$，当 $x \\ge x_0$ 时 $u_0(x) = 0$，间断点位于 $x_0 = \\frac{1}{3} + \\frac{1}{4}\\Delta x = \\frac{1}{3} + \\frac{1}{4}(\\frac{1}{20}) = \\frac{1}{3} + \\frac{1}{80} = \\frac{83}{240}$。数值上，$x_0 \\approx 0.34583$。由于 $\\Delta x = 0.05$，包含 $x_0$ 的网格索引 $j$ 可通过 $j = \\lfloor x_0 / \\Delta x \\rfloor = \\lfloor 0.34583 / 0.05 \\rfloor = \\lfloor 6.9166 \\rfloor = 6$ 找到。该网格为 $K_6 = [6\\Delta x, 7\\Delta x] = [0.3, 0.35]$。这是“问题最严重”的网格，因为它是唯一一个斜率不为零的网格。\n\n对于任何 $i  6$ 的网格 $K_i$，$u_0(x)=1$ 在整个网格内成立。因此，$\\bar{u}_i = 1$ 且 $s_i=0$。对于任何 $i > 6$ 的网格 $K_i$，$u_0(x)=0$ 在整个网格内成立。因此，$\\bar{u}_i = 0$ 且 $s_i=0$。\n\n对于网格 $K_6$，其中 $j=6$：$x_{6-\\frac{1}{2}} = 0.3$，$x_{6+\\frac{1}{2}} = 0.35$，以及 $x_6 = 0.325$。\n$$\n\\bar{u}_6 = \\frac{1}{\\Delta x} \\int_{0.3}^{0.35} u_0(x) \\, dx = \\frac{1}{\\Delta x} \\int_{0.3}^{x_0} 1 \\, dx = \\frac{x_0 - 0.3}{\\Delta x} = \\frac{83/240 - 72/240}{12/240} = \\frac{11}{12}\n$$\n$$\ns_6 = \\frac{12}{\\Delta x^3} \\int_{0.3}^{x_0} (x - x_6) \\, dx = \\frac{12}{\\Delta x^3} \\left[ \\frac{(x-x_6)^2}{2} \\right]_{0.3}^{x_0} = \\frac{6}{\\Delta x^3} \\left( (x_0 - x_6)^2 - (0.3 - x_6)^2 \\right)\n$$\n已知 $x_0 = 83/240$，$x_6 = 0.325 = 78/240$，以及 $0.3 = 72/240$，我们有：$x_0 - x_6 = 5/240$。以及 $0.3 - x_6 = -6/240 = -\\Delta x/2$。\n$$\ns_6 = \\frac{6}{\\Delta x^3} \\left( (\\frac{5}{240})^2 - (-\\frac{6}{240})^2 \\right) = \\frac{6}{(\\frac{12}{240})^3} \\frac{25-36}{240^2} = \\frac{6 \\cdot 240^3}{12^3} \\frac{-11}{240^2} = \\frac{6 \\cdot 240 \\cdot (-11)}{1728} = \\frac{-15840}{1728} = -\\frac{55}{6}\n$$\n所以，问题网格中的初始未限制斜率为 $s_j = s_6 = -55/6 \\approx -9.167$。\n\n### 步骤2：限制器应用\n\n我们需要基准TVD限制斜率 $s_j^{\\text{base}}$ 和TVB限制斜率 $s_j^{\\text{TVB}}$。基准斜率为 $s_j^{\\text{base}} = \\operatorname{minmod}(s_j, \\frac{\\Delta^+ \\bar{u}_j}{\\Delta x}, \\frac{\\Delta^- \\bar{u}_j}{\\Delta x})$。对于网格 $j=6$：\n$\\bar{u}_{j+1} = \\bar{u}_7 = 0$。\n$\\bar{u}_j = \\bar{u}_6 = 11/12$。\n$\\bar{u}_{j-1} = \\bar{u}_5 = 1$。\n差分值为 $\\Delta^+ \\bar{u}_j = 0 - 11/12 = -11/12$ 和 $\\Delta^- \\bar{u}_j = 11/12 - 1 = -1/12$。\nminmod函数的候选斜率是：\n1.  $s_j = -55/6$\n2.  $\\frac{\\Delta^+ \\bar{u}_j}{\\Delta x} = \\frac{-11/12}{1/20} = -220/12 = -55/3$\n3.  $\\frac{\\Delta^- \\bar{u}_j}{\\Delta x} = \\frac{-1/12}{1/20} = -20/12 = -5/3$\n\n三个参数均为负。minmod函数将返回绝对值最小的那个：$\\operatorname{minmod}(-55/6, -55/3, -5/3) = \\operatorname{minmod}(-9.167, -18.333, -1.667) = -5/3$。\n因此，基准TVD限制斜率为 $s_j^{\\text{base}} = -5/3$。\n\nTVB限制器仅在 $(\\Delta x)^2 |s_j| > M$ 时应用TVD minmod限制器。\n我们来计算阈值量：$(\\Delta x)^2 |s_j| = (1/20)^2 |-55/6| = \\frac{1}{400} \\frac{55}{6} = \\frac{55}{2400} = \\frac{11}{480} \\approx 0.0229167$。\nTVB限制斜率为：\n$$\ns_j^{\\text{TVB}} =\n\\begin{cases}\ns_j = -55/6  \\text{如果 } M \\ge 11/480 \\\\\ns_j^{\\text{base}} = -5/3  \\text{如果 } M  11/480\n\\end{cases}\n$$\n\n### 步骤3：离散熵分析\n\n网格 $K_j$ 中的离散熵定义为 $E_j(s) = \\int_{K_j} U(u_j(x)) \\, dx$，其中 $U(u)=\\frac{1}{2}u^2$ 且 $u_j(x) = \\bar{u}_j + s(x-x_j)$。\n$$\nE_j(s) = \\int_{x_j-\\Delta x/2}^{x_j+\\Delta x/2} \\frac{1}{2} (\\bar{u}_j + s(x-x_j))^2 \\, dx\n$$\n令 $\\xi = x-x_j$。\n$$\nE_j(s) = \\frac{1}{2} \\int_{-\\Delta x/2}^{\\Delta x/2} (\\bar{u}_j^2 + 2s\\bar{u}_j\\xi + s^2\\xi^2) \\, d\\xi\n$$\n在对称区间上，关于 $\\xi$ 的线性项积分为零。\n$$\nE_j(s) = \\frac{1}{2} \\left[ \\bar{u}_j^2 \\xi + s^2 \\frac{\\xi^3}{3} \\right]_{-\\Delta x/2}^{\\Delta x/2} = \\frac{1}{2} \\left( \\bar{u}_j^2 \\Delta x + s^2 \\frac{\\Delta x^3}{12} \\right) = \\Delta x \\left( \\frac{1}{2}\\bar{u}_j^2 + \\frac{1}{24} s^2 (\\Delta x)^2 \\right)\n$$\n如果 $E_j(s_j^{\\text{TVB}})  E_j(s_j^{\\text{base}}) + \\varepsilon$，则宣告熵增。这等价于：\n$$\n\\frac{\\Delta x^3}{24} \\left( (s_j^{\\text{TVB}})^2 - (s_j^{\\text{base}})^2 \\right)  \\varepsilon\n$$\n当且仅当 $|s_j^{\\text{TVB}}|  |s_j^{\\text{base}}|$，且差值的量级足够大以超过容差 $\\varepsilon$ 时，熵才会增加。\n\n### 步骤4：评估测试用例\n\n我们对每种情况评估布尔条件。问题网格的索引是 $j=6$。所用值为：$\\varepsilon = 10^{-12}$，$\\Delta x = 0.05$，$s_j = -55/6$，$s_j^{\\text{base}} = -5/3$，以及TVB缩放因子为 $11/480$。\n\n**情况1：$M = 10^{-3} = 0.001$。**\n我们检查TVB条件：$M = 0.001$ 与阈值 $11/480 \\approx 0.0229$ 进行比较。\n由于 $M  11/480$，限制器被激活。\n$s_j^{\\text{TVB}} = s_j^{\\text{base}} = -5/3$。\n熵增检查为 $\\frac{\\Delta x^3}{24} \\left( (s_j^{\\text{base}})^2 - (s_j^{\\text{base}})^2 \\right)  \\varepsilon$，可简化为 $0  \\varepsilon$。这是假的。\n**情况1的结果：False。**\n\n**情况2：$M = 1$。**\n我们检查TVB条件：$M = 1$ 与阈值 $11/480 \\approx 0.0229$ 进行比较。\n由于 $M > 11/480$，限制器未被激活。\n$s_j^{\\text{TVB}} = s_j = -55/6$。\n熵增检查为 $\\frac{\\Delta x^3}{24} \\left( (-55/6)^2 - (-5/3)^2 \\right)  \\varepsilon$。\n左侧为 $\\frac{(0.05)^3}{24} \\left( \\frac{3025}{36} - \\frac{25}{9} \\right) = \\frac{0.000125}{24} \\left( \\frac{3025-100}{36} \\right) = \\frac{0.000125}{24} \\frac{2925}{36} \\approx 4.23 \\times 10^{-4}$。\n由于 $4.23 \\times 10^{-4}  10^{-12}$，该条件为真。发生熵增。\n**情况2的结果：True。**\n\n**情况3：$M = 1$，带修正。**\n对于 $M=1$，如情况2所示，检测器 $\\mathcal{D}(M)$ 会触发。修正规则是在网格 $j$ 中重新限制斜率，设置 $s_j^{\\text{mit}} = s_j^{\\text{base}}$。\n因此，用于最终检查的斜率为 $s_j^{\\text{mit}} = -5/3$。\n问题要求使用相同的标准，判断修正后熵增是否仍然存在。该标准是将当前状态的熵与基准熵进行比较。在这里，当前状态是修正后的状态。\n检查为 $E_j(s_j^{\\text{mit}})  E_j(s_j^{\\text{base}}) + \\varepsilon$。\n由于 $s_j^{\\text{mit}} = s_j^{\\text{base}}$，这等价于 $E_j(s_j^{\\text{base}})  E_j(s_j^{\\text{base}}) + \\varepsilon$，可简化为 $0  \\varepsilon$。这是假的。修正成功地防止了熵增。\n**情况3的结果：False。**\n\n最终的布尔值序列是 [False, True, False]。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the DG-TVB limiter problem by constructing the counterexample.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    N = 20\n    dx = 1.0 / N\n    x0 = 1.0 / 3.0 + 0.25 * dx\n    epsilon = 1e-12\n    test_suite = [\n        # Case 1: M, apply_mitigation\n        (1e-3, False),\n        # Case 2: M, apply_mitigation\n        (1.0, False),\n        # Case 3: M, apply_mitigation\n        (1.0, True)\n    ]\n\n    # --- Step 1: Compute Initial State (L2 Projection) ---\n    bar_u = np.zeros(N)\n    s = np.zeros(N)\n    j_troubled = -1\n\n    for i in range(N):\n        x_imhalf = i * dx\n        x_iphalf = (i + 1) * dx\n        x_i = (i + 0.5) * dx\n\n        if x_iphalf = x0:\n            # Cell is entirely to the left of the discontinuity\n            bar_u[i] = 1.0\n            s[i] = 0.0\n        elif x_imhalf >= x0:\n            # Cell is entirely to the right of the discontinuity\n            bar_u[i] = 0.0\n            s[i] = 0.0\n        else:\n            # Cell contains the discontinuity\n            j_troubled = i\n            # Integral for the cell average\n            bar_u[i] = (x0 - x_imhalf) / dx\n            # Integral for the slope\n            # Using formula: integral = (b-a) * ((a+b)/2 - xc)\n            # where a=x_imhalf, b=x0, xc=x_i\n            integral_val = (x0 - x_imhalf) * (0.5 * (x_imhalf + x0) - x_i)\n            s[i] = 12.0 / (dx**3) * integral_val\n\n    # Ensure the troubled cell was found\n    if j_troubled == -1:\n        raise ValueError(\"Discontinuity location x0 was not found in any cell.\")\n\n    s_j_unlimited = s[j_troubled]\n    bar_u_j = bar_u[j_troubled]\n\n    # --- Step 2: Compute Baseline (TVD) Limited Slope ---\n    \n    # Periodic indexing\n    j_plus_1 = (j_troubled + 1) % N\n    j_minus_1 = (j_troubled - 1 + N) % N\n\n    delta_plus_bar_u = bar_u[j_plus_1] - bar_u_j\n    delta_minus_bar_u = bar_u_j - bar_u[j_minus_1]\n\n    s_cand_1 = s_j_unlimited\n    s_cand_2 = delta_plus_bar_u / dx\n    s_cand_3 = delta_minus_bar_u / dx\n\n    def minmod(a, b, c):\n        \"\"\"Standard minmod function for three arguments.\"\"\"\n        if a > 0 and b > 0 and c > 0:\n            return min(a, b, c)\n        elif a  0 and b  0 and c  0:\n            return max(a, b, c)\n        else:\n            return 0.0\n            \n    s_j_base = minmod(s_cand_1, s_cand_2, s_cand_3)\n\n    # --- Step 3: Function for Entropy Difference ---\n    def compute_entropy_difference(s_test, s_ref, dx_val):\n        \"\"\"\n        Computes E(s_test) - E(s_ref).\n        Formula derived in solution: dx^3/24 * (s_test^2 - s_ref^2)\n        \"\"\"\n        return (dx_val**3 / 24.0) * (s_test**2 - s_ref**2)\n\n    # --- Step 4: Evaluate Test Cases ---\n    results = []\n    \n    tvb_threshold_quantity = (dx**2) * abs(s_j_unlimited)\n\n    for M, apply_mitigation in test_suite:\n        \n        # Determine the TVB-limited slope\n        if tvb_threshold_quantity = M:\n            s_j_tvb = s_j_unlimited  # No limiting\n        else:\n            s_j_tvb = s_j_base      # Limit\n\n        # Run the detector: does an entropy increase occur with s_j_tvb?\n        entropy_diff_unmitigated = compute_entropy_difference(s_j_tvb, s_j_base, dx)\n        detector_triggered = entropy_diff_unmitigated > epsilon\n        \n        # Determine the final slope after potential mitigation\n        s_j_final = s_j_tvb\n        if apply_mitigation and detector_triggered:\n            s_j_final = s_j_base # Apply fix\n\n        # Check if entropy increase remains with the final slope\n        final_entropy_diff = compute_entropy_difference(s_j_final, s_j_base, dx)\n        increase_remains = final_entropy_diff > epsilon\n        \n        results.append(increase_remains)\n\n    # --- Final Output ---\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3424004"}]}