{"hands_on_practices": [{"introduction": "大涡模拟（LES）的核心挑战在于如何准确地模拟亚格子尺度对已解析尺度的影响，其主要作用是在截断尺度附近耗散能量。本练习将理论与实践联系起来，引导您从著名的Kolmogorov能量串级理论出发，推导出维持湍流惯性子区谱所需的涡粘性系数。通过这个练习，您将掌握如何将抽象的湍流物理概念（能量耗散率 $\\epsilon$）与具体的LES模型参数（涡粘性系数 $\\nu_m$）联系起来 [@problem_id:3394660]。", "problem": "考虑一个边长为 $L$ 的周期性立方体中的三维、均匀、各向同性湍流，该湍流通过大涡模拟（LES）并使用间断伽辽金（DG）离散化方法进行模拟。LES 滤波器以谱截断的方式实现：在傅里叶空间中，所有波数大小 $k$ 大于截断波数 $k_c$ 的模态都被设为零，而 $k \\leq k_c$ 的模态则被保留。令 $E(k)$ 表示未滤波湍流的动能谱，其定义使得单位质量的已解析动能为 $\\int_{0}^{\\infty} E(k)\\,\\mathrm{d}k$。滤波后的（已解析）谱记为 $E_r(k)$。\n\n假设流动处于一个统计定常态，能量在低波数处输入，并存在一个惯性区，该惯性区由 Kolmogorov 谱 $E(k) = C_K\\,\\epsilon^{2/3}\\,k^{-5/3}$（对于 $0<k<k_c$）描述，其中 $\\epsilon$ 是能量级串率（等于惯性区中跨波数的能量通量），$C_K$ 是 Kolmogorov 常数。DG 离散化提供了一个有效分辨率，其特征是一个由单元尺寸和多项式次数决定的已知截断波数 $k_c$。\n\n为了防止能量在 $k_c$ 附近堆积，并为已解析尺度维持 $k^{-5/3}$ 惯性区，一个模型化的耗散项以 $-\\nu_m\\,\\Delta \\mathbf{u}$ 的形式被添加到滤波后的动量方程中，其中 $\\nu_m$ 是一个待定的常数涡黏性系数。\n\n任务：\n- 从谱截断滤波器的定义出发，使用 Heaviside 函数将 $E_r(k)$ 表示为 $E(k)$ 和 $k_c$ 的函数。然后，利用 $\\Delta$ 的傅里叶表示，确定模型化的已解析动能移除率（单位质量），并将其表示为关于波数的积分，形式为 $\\nu_m$ 和 $E_r(k)$ 的函数。\n- 假设对于 $0<k<k_c$ 惯性区谱形式为 $E(k) = C_K\\,\\epsilon^{2/3}\\,k^{-5/3}$，施加定常条件，即已解析尺度的总模型耗散等于惯性区能量通量 $\\epsilon$。推导出一个关于 $\\epsilon$、$C_K$ 和 $k_c$ 的 $\\nu_m$ 的封闭形式解析表达式。\n\n你的最终答案必须是系数 $\\nu_m$ 的一个单一封闭形式解析表达式。不需要进行数值计算。", "solution": "该问题被验证为具有科学依据、提法恰当、客观且自洽。它描述了大涡模拟（LES）湍流模型领域中的一个标准理论问题。所有必要的信息都已提供，且在理论湍流的背景下，这些假设在物理上和数学上都是一致的。\n\n解答过程根据任务要求分为两部分。\n\n首先，我们处理滤波后的能谱表达式和模型化的能量移除率。\nLES 滤波器是在波数大小 $k_c$ 处的一个急剧谱截断。这意味着速度场的傅里叶模态在波数大小 $k \\leq k_c$ 时被保留，而在 $k > k_c$ 时被设为零。未滤波流的动能谱是 $E(k)$，滤波后的（已解析）谱是 $E_r(k)$。根据滤波器的定义，已解析谱在截断波数之前与未滤波谱相同，在截断波数之后为零。这种关系可以用 Heaviside 阶跃函数 $H(x)$ 来表示，其定义为当 $x \\geq 0$ 时 $H(x) = 1$，当 $x < 0$ 时 $H(x) = 0$。因此，已解析谱为：\n$$E_r(k) = E(k) H(k_c - k)$$\n\n接下来，我们确定由模型化耗散项引起的动能移除率。问题陈述在滤波后的动量方程中增加了一个项 $-\\nu_m\\,\\Delta \\mathbf{u}$，其中 $\\mathbf{u}$ 是已解析速度场，$\\nu_m$ 是一个常数涡黏性。该项的目的是模拟从已解析尺度到未解析（亚格子）尺度的能量耗散。由该项引起的单位质量已解析动能的变化率由其在速度场上的投影的平均值给出，即 $\\langle \\mathbf{u} \\cdot (-\\nu_m\\,\\Delta \\mathbf{u}) \\rangle$。模型化的耗散率 $\\epsilon_m$ 是该量的负值，表示能量的正向移除：\n$$\\epsilon_m = - \\langle \\mathbf{u} \\cdot (-\\nu_m\\,\\Delta \\mathbf{u}) \\rangle = \\nu_m \\langle \\mathbf{u} \\cdot \\Delta \\mathbf{u} \\rangle$$\n在周期性域上使用分部积分（或格林第一恒等式），我们有 $\\langle \\mathbf{u} \\cdot \\Delta \\mathbf{u} \\rangle = - \\langle |\\nabla \\mathbf{u}|^2 \\rangle$。这得到 $\\epsilon_m = -\\nu_m \\langle |\\nabla \\mathbf{u}|^2 \\rangle$。一个正定的耗散需要在动量方程中使用不同的符号约定，即添加 $+\\nu_m \\Delta \\mathbf{u}$。湍流理论中的一个标准结果是，总黏性耗散率由 $\\epsilon_{\\nu} = 2\\nu \\int_0^\\infty k^2 E(k) \\, \\mathrm{d}k$ 给出。我们对模型化耗散采用这种形式。符号上的差异是在动量方程中放置该项的约定问题；其物理效应必须是耗散。因此，从已解析尺度上模型化的单位质量动能移除率为：\n$$\\epsilon_m = 2 \\nu_m \\int_{0}^{\\infty} k^2 E_r(k)\\,\\mathrm{d}k$$\n代入 $E_r(k)$ 的表达式，积分的上限变为 $k_c$：\n$$\\epsilon_m = 2 \\nu_m \\int_{0}^{k_c} k^2 E(k)\\,\\mathrm{d}k$$\n\n第二，我们推导 $\\nu_m$ 的表达式。\n问题假设在一个统计定常态下，模型化的耗散率正好平衡了通过惯性区级串的能量通量 $\\epsilon$。这提供了封闭条件：\n$$\\epsilon_m = \\epsilon$$\n我们已知对于 $0 < k < k_c$，未滤波流的 Kolmogorov 惯性区谱为：\n$$E(k) = C_K\\,\\epsilon^{2/3}\\,k^{-5/3}$$\n其中 $C_K$ 是 Kolmogorov 常数。\n\n我们将此谱形式代入 $\\epsilon_m$ 的积分中：\n$$\\epsilon = 2 \\nu_m \\int_{0}^{k_c} k^2 \\left( C_K\\,\\epsilon^{2/3}\\,k^{-5/3} \\right)\\,\\mathrm{d}k$$\n项 $C_K$ 和 $\\epsilon^{2/3}$ 相对于积分变量 $k$ 是常数，可以移到积分符号外面：\n$$\\epsilon = 2 \\nu_m C_K \\epsilon^{2/3} \\int_{0}^{k_c} k^2 k^{-5/3}\\,\\mathrm{d}k$$\n被积函数简化为 $k^{2 - 5/3} = k^{6/3 - 5/3} = k^{1/3}$。方程变为：\n$$\\epsilon = 2 \\nu_m C_K \\epsilon^{2/3} \\int_{0}^{k_c} k^{1/3}\\,\\mathrm{d}k$$\n我们现在计算这个定积分：\n$$\\int_{0}^{k_c} k^{1/3}\\,\\mathrm{d}k = \\left[ \\frac{k^{1/3+1}}{1/3+1} \\right]_{0}^{k_c} = \\left[ \\frac{k^{4/3}}{4/3} \\right]_{0}^{k_c} = \\frac{3}{4} \\left( k_c^{4/3} - 0^{4/3} \\right) = \\frac{3}{4} k_c^{4/3}$$\n将此结果代回关于 $\\epsilon$ 的方程中：\n$$\\epsilon = 2 \\nu_m C_K \\epsilon^{2/3} \\left( \\frac{3}{4} k_c^{4/3} \\right)$$\n$$\\epsilon = \\frac{3}{2} \\nu_m C_K \\epsilon^{2/3} k_c^{4/3}$$\n最后，我们求解这个代数方程以得到涡黏性系数 $\\nu_m$：\n$$\\nu_m = \\epsilon \\left( \\frac{2}{3 C_K \\epsilon^{2/3} k_c^{4/3}} \\right)$$\n简化涉及 $\\epsilon$ 的项：\n$$\\nu_m = \\frac{2}{3 C_K} \\frac{\\epsilon}{\\epsilon^{2/3}} k_c^{-4/3} = \\frac{2}{3 C_K} \\epsilon^{1 - 2/3} k_c^{-4/3}$$\n$$\\nu_m = \\frac{2}{3 C_K} \\epsilon^{1/3} k_c^{-4/3}$$\n这就是系数 $\\nu_m$ 的封闭形式解析表达式。", "answer": "$$ \\boxed{\\frac{2}{3 C_K} \\epsilon^{\\frac{1}{3}} k_c^{-\\frac{4}{3}}} $$", "id": "3394660"}, {"introduction": "与依赖显式亚格子模型的传统LES方法不同，非连续伽辽金（DG）方法因其内在的数值耗散特性，天然地适用于隐式大涡模拟（ILES）。这种“隐式”的耗散并非来自模型，而是源于数值格式本身，特别是单元界面处的数值通量。本练习提供了一个计算模型，让您动手探索DG方法的关键参数——多项式阶数 $p$ 和数值通量参数 $\\alpha$——是如何调节这种隐式耗散，并最终塑造已解析能量谱的形态 [@problem_id:3394693]。", "problem": "考虑在边长为 $L$ 的周期性立方体域中的速度场 $u(x,t)$ 的不可压缩纳维-斯托克斯方程，\n$$\n\\frac{\\partial u}{\\partial t} + (u\\cdot\\nabla)u = -\\nabla p + \\nu \\nabla^2 u,\\quad \\nabla\\cdot u = 0,\n$$\n以及均匀各向同性湍流的动能谱 $E(k,t)$，其定义使得单位质量的总动能为\n$$\n\\mathcal{E}(t) = \\int_{0}^{\\infty} E(k,t)\\,dk.\n$$\n在大涡模拟（LES）中，亚网格效应通过一个建模的耗散项出现。在使用间断伽辽金（DG）方法的隐式大涡模拟（ILES）中，由单元间通量引入的数值稳定化在没有显式亚网格尺度模型的情况下，充当了一种尺度选择性耗散。对于每个单元内次数为 $p$ 的多项式表示，以及由无量纲强度参数 $\\alpha$（例如，与 Lax–Friedrichs 或 Rusanov 通量相关的参数）表征的单调数值通量，已知 ILES 机制会将耗散集中在高波数处，而相对不影响大尺度。\n\n从无外力作用下衰减的均匀各向同性湍流的能量平衡出发，谱能量满足\n$$\n\\frac{\\partial E(k,t)}{\\partial t} = -2\\,\\nu_{\\mathrm{eff}}(k)\\,k^2\\,E(k,t),\n$$\n其中 $\\nu_{\\mathrm{eff}}(k)$ 是一个聚合了物理粘度和数值耗散的有效粘度。在 ILES 中，主要贡献来自于 DG 通量和单元间跳跃产生的数值分量，这是尺度相关的。您的任务是通过量化衰减的均匀各向同性湍流中已解析谱和耗散的变化，来分析 ILES 行为对多项式阶数 $p$ 和通量强度参数 $\\alpha$ 的敏感性。请使用以下建模和数值协议：\n\n- 使用边长为 $L = 2\\pi$ 的无量纲域，并将所有量视为无量纲。\n- 在整数波数 $k \\in \\{1,2,\\dots,K_{\\max}\\}$ 上表示谱，其中 $K_{\\max} = 64$。\n- 选择 von Kármán 形式的初始谱\n$$\nE(k,0) = C\\,k^4 \\exp\\!\\left(-2\\left(\\frac{k}{k_p}\\right)^2\\right),\n$$\n其中 $k_p = K_{\\max}/4$，并且 $C$ 的选择使得 $\\sum_{k=1}^{K_{\\max}} E(k,0) = 1$。\n- 考虑一个具有 $N_e = 32$ 个等尺寸单元的固定网格，因此单元尺寸为 $h = L/N_e$。\n- 将由 DG 稳定化引起的 ILES 有效粘度建模为一个尺度选择性函数，该函数随波数和通量强度的增加而增加，随多项式阶数的增加而减小。具体来说，取\n$$\n\\nu_{\\mathrm{eff}}(k;p,\\alpha) = \\alpha\\,\\frac{h}{L}\\,\\frac{1}{p+1}\\left(\\frac{k}{K_{\\max}}\\right)^{2p+1}.\n$$\n- 使用线性衰减模型的精确解将谱演化到最终时间 $T = 1$：\n$$\nE(k,T) = E(k,0)\\,\\exp\\!\\left(-2\\,\\nu_{\\mathrm{eff}}(k;p,\\alpha)\\,k^2\\,T\\right).\n$$\n\n为每个参数集 $(p,\\alpha)$ 计算的指标：\n1. 已解析谱斜率 $m$，通过在波数区间 $k \\in [\\lfloor 0.2K_{\\max}\\rfloor, \\lfloor 0.5K_{\\max}\\rfloor]$ 上对 $\\log E(k,T)$ 与 $\\log k$ 进行最小二乘线性拟合来估计。将 $m$ 报告为实数（无单位）。\n2. 总耗散能量分数 $d$，定义为\n$$\nd = 1 - \\sum_{k=1}^{K_{\\max}} E(k,T),\n$$\n报告为十进制形式的实数。\n\n测试套件：\n- 案例 $1$：$(p,\\alpha) = (0, 0.3)$。\n- 案例 $2$：$(p,\\alpha) = (1, 0.3)$。\n- 案例 $3$：$(p,\\alpha) = (3, 0.3)$。\n- 案例 $4$：$(p,\\alpha) = (5, 0.3)$。\n- 案例 $5$：$(p,\\alpha) = (3, 0.9)$。\n\n您的程序必须：\n- 实现上述谱模型，并为每个测试案例计算指标 $m$ 和 $d$。\n- 生成单行输出，其中包含用方括号括起来的逗号分隔列表的结果。该列表必须按以下顺序包含指标：\n$$\n[m_1, d_1, m_2, d_2, m_3, d_3, m_4, d_4, m_5, d_5],\n$$\n其中 $(m_i, d_i)$ 对应于案例 $i$，$i=1,\\dots,5$。\n\n不涉及角度。所有量均为无量纲。输出数字必须格式化为实数（浮点数）。最终时间为 $T=1$，必须严格按照规定使用。", "solution": "我们从周期域中速度场 $u(x,t)$ 和压力 $p(x,t)$ 的不可压缩纳维-斯托克斯方程开始，\n$$\n\\frac{\\partial u}{\\partial t} + (u\\cdot\\nabla)u = -\\nabla p + \\nu \\nabla^2 u,\\quad \\nabla\\cdot u=0.\n$$\n对于均匀各向同性湍流，单位质量的动能可以用谱能量密度 $E(k,t)$ 表示，其中\n$$\n\\mathcal{E}(t) = \\int_{0}^{\\infty} E(k,t)\\,dk,\n$$\n谱通常是在波数大小为 $k$ 的球壳上聚合的。在大涡模拟（LES）中，未解析的尺度贡献了有效耗散；在采用间断伽辽金（DG）方法的隐式大涡模拟（ILES）中，这种效应源于数值稳定化（例如，单调通量和界面惩罚），产生了一个额外的尺度选择性耗散机制。\n\n基于原理的 ILES 效应建模：我们寻求一个与 DG 稳定化的能量行为一致的降阶谱模型。在 DG 格式中，界面处的数值通量引入了与单元间跳跃成正比的耗散。对于次数为 $p$ 的多项式，波数为 $k$ 的傅里叶模的主截断误差和界面跳跃振幅与 $(kh)^{p+1}$ 成比例，其中 $h$ 是单元尺寸。来自单调通量（例如 Rusanov/Lax–Friedrichs 通量）的耗散项与强度参数 $\\alpha$ 乘以跳跃振幅的平方成比例，产生一个随 $k$ 迅速增长的能量汇。将此映射到谱涡粘度概念中，我们构建一个依赖于波数的有效粘度 $\\nu_{\\mathrm{eff}}(k)$，它捕捉了数值格式在尺度 $k$ 上消耗能量的净速率。\n\n与这些原则一致的尺度选择性形式是\n$$\n\\nu_{\\mathrm{eff}}(k;p,\\alpha) = \\alpha\\,\\frac{h}{L}\\,\\frac{1}{p+1}\\left(\\frac{k}{K_{\\max}}\\right)^{2p+1},\n$$\n其中 $L$ 是域尺寸，$h$ 是单元尺寸，$K_{\\max}$ 是最大解析波数，$\\alpha$ 是一个无量纲通量强度参数（控制通量对单元间跳跃的阻尼强度），$p$ 是多项式阶数。因子 $\\left(\\frac{k}{K_{\\max}}\\right)^{2p+1}$ 反映了高阶 DG 方法将耗散集中在最高波数处：对于固定的 $k/K_{\\max}<1$，增加 $p$ 会减少中等波数处的 $\\nu_{\\mathrm{eff}}$，但保持在非常接近 $K_{\\max}$ 处的强耗散。前置因子 $\\frac{1}{p+1}$ 模拟了一个公认的趋势，即较高的多项式阶数会减少在已解析尺度上的总体数值耗散。因子 $\\frac{h}{L}$ 确保了在周期域内网格细化时的一致无量纲标度。\n\n能量衰减模型：对于无外力作用的衰减均匀各向同性湍流，在一个未显式计算非线性传递的降阶模型中，由粘度引起的每个波数处的能量衰减的一阶近似为\n$$\n\\frac{\\partial E(k,t)}{\\partial t} = -2\\,\\nu_{\\mathrm{eff}}(k)\\,k^2\\,E(k,t).\n$$\n这个关于时间的线性常微分方程有精确解\n$$\nE(k,T) = E(k,0)\\,\\exp\\!\\left(-2\\,\\nu_{\\mathrm{eff}}(k)\\,k^2\\,T\\right),\n$$\n对于任何最终时间 $T$。尽管这忽略了波数间的能量传递，但它隔离了数值耗散机制对 $p$ 和 $\\alpha$ 的敏感性，而这正是 ILES 敏感性分析的目标。\n\n初始谱：我们选择一个 von Kármán 谱\n$$\nE(k,0) = C\\,k^4 \\exp\\!\\left(-2\\left(\\frac{k}{k_p}\\right)^2\\right),\n$$\n其中 $k_p$ 是峰值波数，$C$ 将离散和归一化为1：\n$$\n\\sum_{k=1}^{K_{\\max}} E(k,0) = 1.\n$$\n该谱被广泛用于表示一个物理上合理的能量跨尺度分布，其特点是在低 $k$ 处上升，在 $k_p$ 处达到峰值，并在高 $k$ 处迅速下降。\n\n指标：为量化已解析谱和耗散的变化：\n1. 已解析谱斜率 $m$ 是通过在中间范围 $k \\in [\\lfloor 0.2K_{\\max}\\rfloor, \\lfloor 0.5K_{\\max}\\rfloor]$ 内使用最小二乘法拟合 $\\log E(k,T)$ 对 $\\log k$ 计算得出。该区间避免了有限尺寸效应占主导的极低 $k$ 值，以及截断和极端阻尼占主导的极高 $k$ 值。斜率 $m$ 反映了已解析谱的陡峭程度。\n2. 总耗散能量分数 $d$ 为\n$$\nd = 1 - \\sum_{k=1}^{K_{\\max}} E(k,T),\n$$\n考虑到归一化 $\\sum_{k=1}^{K_{\\max}} E(k,0) = 1$，它衡量了到时间 $T$ 为止，因数值耗散而被移除的初始能量的分数。\n\n算法设计：\n- 设置 $L=2\\pi$、$K_{\\max}=64$、$k_p=K_{\\max}/4$、$N_e=32$ 以及 $h=L/N_e$。\n- 构建离散数组 $k=1,2,\\dots,K_{\\max}$。\n- 形成未归一化的 $E(k,0)$，并通过除以离散和来计算 $C$，以使总能量为1。\n- 对于每个测试案例 $(p,\\alpha)$，计算 $\\nu_{\\mathrm{eff}}(k;p,\\alpha)$，然后使用精确衰减公式（$T=1$）计算 $E(k,T)$。\n- 在指定的 $k$ 区间上，通过对 $\\log E$ 与 $\\log k$ 进行最小二乘线性回归来计算 $m$。\n- 通过离散和计算 $d$。\n- 按指定顺序汇总输出：\n$$\n[m_1, d_1, m_2, d_2, m_3, d_3, m_4, d_4, m_5, d_5].\n$$\n\n解释：增加 $\\alpha$ 应该会增加所有尺度上的 $\\nu_{\\mathrm{eff}}$，使谱变得更陡峭并增加 $d$。增加 $p$ 通常会减少中等波数处的耗散（由于 $(p+1)^{-1}$ 前置因子和更强的尺度选择性），可能使已解析谱变平（在所选范围内 $m$ 不那么陡峭）并减少 $d$，同时仍然将阻尼集中在 $K_{\\max}$ 附近。所选的测试套件涵盖了边界行为（$p=0$）、多项式阶数的影响（$p=1,3,5$），以及在 $p=3$ 时的高通量边缘情况（$\\alpha=0.9$）。\n\n所有量都是无量纲的，不涉及角度。最终时间为 $T=1$，并直接使用。程序打印一行，包含按指定顺序排列的五个案例的指标。", "answer": "```python\nimport numpy as np\n\ndef initial_spectrum(Kmax, kp):\n    k = np.arange(1, Kmax + 1, dtype=float)\n    E0 = (k**4) * np.exp(-2.0 * (k / kp) ** 2)\n    E0 /= E0.sum()  # Normalize total energy to 1\n    return k, E0\n\ndef nu_eff(k, Kmax, p, alpha, h, L):\n    # Effective viscosity model for ILES-DG:\n    # nu_eff(k; p, alpha) = alpha * (h/L) * 1/(p+1) * (k/Kmax)^(2p+1)\n    scale_selective = (k / Kmax) ** (2 * p + 1)\n    nu = alpha * (h / L) * (scale_selective) / (p + 1)\n    return nu\n\ndef evolve_spectrum(E0, k, nu, T):\n    # Exact solution of dE/dt = -2 * nu(k) * k^2 * E\n    decay = np.exp(-2.0 * nu * (k ** 2) * T)\n    return E0 * decay\n\ndef resolved_slope(E, k, Kmax):\n    # Fit log E vs log k over [floor(0.2*Kmax), floor(0.5*Kmax)]\n    k_min = int(np.floor(0.2 * Kmax))\n    k_max = int(np.floor(0.5 * Kmax))\n    # indices in 1-based k; Python uses 0-based\n    k_slice = np.arange(k_min, k_max + 1)\n    Ek = E[k_slice - 1]\n    kk = k_slice.astype(float)\n    # Guard against numerical underflow: ensure positivity\n    Ek = np.maximum(Ek, np.finfo(float).tiny)\n    x = np.log(kk)\n    y = np.log(Ek)\n    # Least squares fit y = m x + b\n    A = np.vstack([x, np.ones_like(x)]).T\n    m, b = np.linalg.lstsq(A, y, rcond=None)[0]\n    return m\n\ndef total_dissipation_fraction(E):\n    # Initial energy sum is 1 by construction\n    return 1.0 - E.sum()\n\ndef run_case(p, alpha, params):\n    L = params['L']\n    Kmax = params['Kmax']\n    kp = params['kp']\n    Ne = params['Ne']\n    T = params['T']\n    h = L / Ne\n\n    k, E0 = initial_spectrum(Kmax, kp)\n    nu = nu_eff(k, Kmax, p, alpha, h, L)\n    ET = evolve_spectrum(E0, k, nu, T)\n    m = resolved_slope(ET, k, Kmax)\n    d = total_dissipation_fraction(ET)\n    return m, d\n\ndef solve():\n    params = {\n        'L': 2.0 * np.pi,\n        'Kmax': 64,\n        'kp': 64 / 4,\n        'Ne': 32,\n        'T': 1.0,\n    }\n    # Test suite: (p, alpha)\n    test_cases = [\n        (0, 0.3),  # Case 1: boundary polynomial order\n        (1, 0.3),  # Case 2: low order\n        (3, 0.3),  # Case 3: moderate order\n        (5, 0.3),  # Case 4: high order\n        (3, 0.9),  # Case 5: high flux parameter\n    ]\n\n    results = []\n    for p, alpha in test_cases:\n        m, d = run_case(p, alpha, params)\n        results.append(f\"{m:.6f}\")\n        results.append(f\"{d:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3394693"}, {"introduction": "虽然DG方法的数值特性可用于构建有效的ILES，但若处理不当，也可能引发问题。本练习聚焦于一个关键的实践陷阱：由非线性项积分不准确（即“欠积分”）导致的非物理性能量生成，也称为“能量反馈”。这个练习将指导您使用一维Burgers方程作为模型，设计一个诊断工具，通过监测已解析能量的增量来识别这种危险的数值不稳定现象 [@problem_id:3394720]。", "problem": "考虑一个一维周期性域，其坐标 $x \\in [0, 2\\pi]$ 以弧度为单位。设可解场由一个包含 $N$ 个单元的均匀网格上的间断伽辽金 (DG) 多项式近似，每个单元的多项式阶数为 $p$。为了替代大涡模拟 (LES) 中间断伽辽金方法的非线性对流机制，我们使用无粘性伯格斯方程\n$$\nu_t + \\left( \\frac{u^2}{2} \\right)_x = 0,\n$$\n该方程具有周期性边界条件和光滑初始条件\n$$\nu(x,0) = \\sin(x) + 0.25\\sin(3x) + 0.1\\sin(5x).\n$$\n假设每个单元上的 DG 近似通过参考区间 $r \\in [-1, 1]$ 上的勒让德多项式基表示为\n$$\nu_h(x) \\big|_K = \\sum_{n=0}^{p} \\hat{u}_n^{(K)} L_n\\!\\left( r(x) \\right),\n$$\n其中 $L_n(r)$ 是 $n$ 阶勒让德多项式，$K$ 为单元索引，$r(x)$ 是从物理单元到参考区间的仿射映射。单元长度为 $h = \\frac{2\\pi}{N}$，雅可比关系满足 $\\mathrm{d}x = \\frac{h}{2}\\,\\mathrm{d}r$ 和 $\\frac{\\mathrm{d}}{\\mathrm{d}x} = \\frac{2}{h}\\frac{\\mathrm{d}}{\\mathrm{d}r}$。\n\n从光滑周期解的守恒律能量恒等式出发：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\int_{0}^{2\\pi} \\frac{u^2}{2}\\,\\mathrm{d}x = \\int_{0}^{2\\pi} \\frac{u^2}{2}\\,u_x\\,\\mathrm{d}x = \\frac{1}{6}\\int_{0}^{2\\pi} (u^3)_x\\,\\mathrm{d}x = 0.\n$$\n在 DG 离散化中，取检验函数 $v = u_h$，则半离散的单元能量变化率的弱形式可以写为\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\int_{K} \\frac{u_h^2}{2}\\,\\mathrm{d}x = \\int_{K} \\frac{u_h^2}{2}\\, (u_h)_x\\,\\mathrm{d}x \\;-\\; \\Big[ f^*(u_h)\\,u_h \\Big]_{\\partial K},\n$$\n其中 $f(u)=\\frac{u^2}{2}$，$f^*(u_h)$ 是一个相容的数值通量。如果近似解在单元界面上是全局连续的（如通过在共享节点上对光滑初始条件进行逐点插值得到），并且域是周期的，那么对所有单元求和时，边界项会相互对消，使得全局可解能量变化率仅由体积积分控制，\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\int_{0}^{2\\pi} \\frac{u_h^2}{2}\\,\\mathrm{d}x = \\sum_{K} \\int_{K} \\frac{u_h^2}{2}\\, (u_h)_x\\,\\mathrm{d}x.\n$$\n当体积积分被精确计算时，光滑周期解的可解能量变化为零。然而，在实际的 DG-LES 中，体积积分是使用数值求积计算的。非线性体积项的欠积分会引入求积混叠和非物理的能量传递（反向散射），这表现为一个时间步长内出现正的可解能量增量 $\\Delta E > 0$。\n\n对于一个阶数为 $p$ 的 DG 多项式，被积函数 $\\frac{u_h^2}{2} (u_h)_x$ 在参考坐标中是一个 $3p-1$ 阶的多项式。一个 $n$ 点的勒让德-高斯求积法可以精确积分最高为 $2n-1$ 阶的多项式。因此，精确计算体积积分需要满足 $2n-1 \\geq 3p-1$，即 $n \\geq \\frac{3p}{2}$，而选择 $n  \\frac{3p}{2}$ 会导致欠积分和可能出现的反向散射。\n\n您的任务是：\n1. 从第一性原理出发，推导上述 DG 近似的离散可解能量变化率，并说明求积阶数如何决定体积积分是精确的还是欠积分的。\n2. 设计一个诊断工具，该工具基于可解能量增量\n$$\n\\Delta E = \\Delta t \\sum_{K} \\int_{K} \\frac{u_h^2}{2}\\,(u_h)_x\\,\\mathrm{d}x,\n$$\n来标记非物理能量传递。该增量使用一个指定的阶数 $q_{\\mathrm{vol}}$ 的求积法计算。使用一个小的无量纲时间步长 $\\Delta t$，并将检测规则定义为：当且仅当 $\\Delta E  0$ 时，“检测到反向散射”。以无量纲单位表示可解能量和能量增量。\n\n实现一个程序，该程序：\n- 通过在每个单元上使用足够高阶的求积法进行投影，将给定的初始条件 $L^2$ 投影到勒让德基上，从而构建多项式 DG 近似。\n- 使用足够高阶的求积法计算初始可解能量\n$$\nE_0 = \\int_{0}^{2\\pi} \\frac{u_h^2}{2}\\,\\mathrm{d}x\n$$\n以表示多项式近似的“真实”可解能量。\n- 使用一个 $q_{\\mathrm{vol}}$ 点的勒让德-高斯求积法计算离散可解能量产生率\n$$\nR(q_{\\mathrm{vol}}) = \\sum_{K} \\int_{K} \\frac{u_h^2}{2}\\,(u_h)_x\\,\\mathrm{d}x\n$$\n- 构建 $\\Delta E = \\Delta t \\, R(q_{\\mathrm{vol}})$ 和诊断标志 $d$，$d=1$ 如果 $\\Delta E  0$，否则 $d=0$。\n\n使用以下参数集测试套件 $(p, N, q_{\\mathrm{vol}}, \\Delta t)$：\n- 情况 A (典型欠积分)：$(3, 8, 4, 10^{-3})$。\n- 情况 B (过积分)：$(3, 8, 8, 10^{-3})$。\n- 情况 C (较高阶数下的中度欠积分)：$(4, 8, 5, 10^{-3})$。\n- 情况 D (低阶近乎精确积分)：$(1, 4, 2, 10^{-3})$。\n- 情况 E (严重欠积分)：$(5, 16, 3, 10^{-3})$。\n\n您的程序应该生成单行输出，其中包含这五个情况的结果，以逗号分隔。对于每种情况，以列表形式输出有序对 $[\\Delta E, d]$，其中 $\\Delta E$ 为浮点数，$d$ 为整数 $0$ 或 $1$。最终输出格式必须是\n$$\n\\texttt{[[}\\Delta E_A\\texttt{,}d_A\\texttt{],[}\\Delta E_B\\texttt{,}d_B\\texttt{],[}\\Delta E_C\\texttt{,}d_C\\texttt{],[}\\Delta E_D\\texttt{,}d_D\\texttt{],[}\\Delta E_E\\texttt{,}d_E\\texttt{]]}\n$$\n形式的单行文本，不含任何多余的文本或空格。", "solution": "该问题要求验证一个用于诊断无粘性伯g斯方程的间断伽辽金 (DG) 近似中非物理能量产生（反向散射）的工具。该诊断工具基于求积阶数对半离散能量守恒性质的影响。\n\n### 第一部分：离散可解能量变化率的推导\n\n该问题设定在一个周期性域 $x \\in [0, 2\\pi]$ 上，使用无粘性伯格斯方程，这是一个非线性对流的标准模型：\n$$\nu_t + \\left( \\frac{u^2}{2} \\right)_x = 0\n$$\n对于光滑的周期解，总动能 $E = \\int_{0}^{2\\pi} \\frac{u^2}{2} dx$ 是守恒的。这可以通过将偏微分方程 (PDE) 乘以 $u$ 并在整个域上积分来证明：\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}t} = \\int_{0}^{2\\pi} u u_t dx = -\\int_{0}^{2\\pi} u \\left( \\frac{u^2}{2} \\right)_x dx = -\\int_{0}^{2\\pi} \\left( \\frac{u^3}{3} \\right)_x dx = -\\frac{1}{3} \\left[ u^3 \\right]_{0}^{2\\pi} = 0\n$$\n另一种组合方式可以得到问题中使用的形式：\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}t} = \\int_{0}^{2\\pi} u u_t dx = \\int_{0}^{2\\pi} \\frac{(u^2)_t}{2} dx = \\int_{0}^{2\\pi} \\frac{u^2}{2} u_x dx = \\int_{0}^{2\\pi} \\left(\\frac{u^3}{6}\\right)_x dx = \\frac{1}{6} [u^3]_0^{2\\pi} = 0.\n$$\n\n在 DG 方法中，解 $u$ 由分片多项式函数 $u_h$ 近似。为了推导半离散能量变化率，我们从弱形式出发。我们将偏微分方程乘以一个检验函数 $v_h$（该函数与 $u_h$ 属于同一多项式空间），并在单个单元 $K$ 上进行分部积分：\n$$\n\\int_K v_h (u_h)_t dx + \\int_K v_h \\left( \\frac{u_h^2}{2} \\right)_x dx = 0\n$$\n$$\n\\int_K v_h (u_h)_t dx = - \\left[ v_h f^*(u_h) \\right]_{\\partial K} + \\int_K (v_h)_x f(u_h) dx\n$$\n其中 $f(u_h) = \\frac{u_h^2}{2}$，$f^*(u_h)$ 是一个耦合相邻单元的数值通量函数。为了分析能量演化，我们选择解本身作为检验函数，即 $v_h = u_h$：\n$$\n\\int_K u_h (u_h)_t dx = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_K \\frac{u_h^2}{2} dx = \\int_K (u_h)_x \\frac{u_h^2}{2} dx - \\left[ u_h f^*(u_h) \\right]_{\\partial K}\n$$\n这就是单个单元的半离散能量变化率，与问题中给出的形式相符。问题接着假设了一种特殊情况，即在对所有单元求和时，边界通量项相互对消，从而将体积积分项分离出来，作为全局能量变化的唯一贡献者：\n$$\n\\frac{\\mathrm{d}E_h}{\\mathrm{d}t} = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{0}^{2\\pi} \\frac{u_h^2}{2} dx = \\sum_K \\int_K \\frac{u_h^2}{2} (u_h)_x dx\n$$\n该量被定义为离散可解能量产生率，$R = \\sum_K \\int_K \\frac{u_h^2}{2} (u_h)_x dx$。\n\n此时，求积法的影响变得至关重要。在每个单元上，$u_h$ 是一个阶数为 $p$ 的多项式。空间导数 $(u_h)_x$ 是一个阶数为 $p-1$ 的多项式。因此，被积函数 $\\frac{u_h^2}{2} (u_h)_x$ 是一个阶数为 $2p + (p-1) = 3p-1$ 的多项式。一个 $q$ 点的勒让德-高斯求积法则可以精确积分最高为 $2q-1$ 阶的多项式。为了精确计算体积积分，我们需要满足：\n$$\n2q - 1 \\geq 3p - 1 \\implies q \\geq \\frac{3p}{2}\n$$\n如果不满足此条件，即 $q  \\frac{3p}{2}$，则该积分为欠积分。此时可能会发生混叠误差，即被积函数中高波数模态的能量（其积分值应为零或一个很小的值）被错误地加到低波数模态上，通常表现为净正能量产生，即 $\\Delta E > 0$。\n\n### 第二部分：诊断工具的设计与实现\n\n该诊断工具旨在量化这种效应。实现过程如下：\n\n1.  **离散化设置**：将域 $[0, 2\\pi]$ 分为 $N$ 个长度为 $h = \\frac{2\\pi}{N}$ 的单元 $K_k$。对于每个测试用例 $(p, N, q_{\\mathrm{vol}}, \\Delta t)$，多项式阶数为 $p$。\n\n2.  **$L^2$ 投影**：通过在每个单元 $K_k$ 上将给定的初始条件 $u(x,0) = \\sin(x) + 0.25\\sin(3x) + 0.1\\sin(5x)$ $L^2$ 投影到勒让德多项式基上，来构造初始 DG 近似 $u_h(x,0)$。单元 $k$ 的勒让德系数 $\\{\\hat{u}_n^{(k)}\\}_{n=0}^p$ 计算如下：\n    $$\n    \\hat{u}_n^{(k)} = \\frac{\\langle u(x,0), L_n(r(x)) \\rangle}{\\langle L_n(r(x)), L_n(r(x)) \\rangle} = \\frac{\\int_{K_k} u(x,0) L_n(r(x)) dx}{\\int_{K_k} L_n(r(x))^2 dx}\n    $$\n    变换到参考区间 $r \\in [-1, 1]$ 并利用正交性质 $\\int_{-1}^1 L_n(r)^2 dr = \\frac{2}{2n+1}$，上式变为：\n    $$\n    \\hat{u}_n^{(k)} = \\frac{2n+1}{2} \\int_{-1}^1 u(x(r), 0) L_n(r) dr\n    $$\n    该积分使用高阶高斯-勒让德求积法（使用 $q_{proj} > p$ 个点）进行数值计算，以确保投影的准确性。\n\n3.  **能量变化率计算**：离散可解能量产生率 $R(q_{\\mathrm{vol}})$ 通过对所有单元的体积积分求和得到，其中每个积分都使用 $q_{\\mathrm{vol}}$ 点的高斯-勒让德求积法进行近似。对于每个单元 $k$，积分为：\n    $$\n    \\int_{K_k} \\frac{u_h^2}{2} (u_h)_x dx = \\int_{-1}^1 \\frac{u_h^{(k)}(r)^2}{2} \\left( \\frac{2}{h} \\frac{d u_h^{(k)}}{dr} \\right) \\frac{h}{2} dr = \\int_{-1}^1 \\frac{u_h^{(k)}(r)^2}{2} \\frac{d u_h^{(k)}}{dr} dr\n    $$\n    其中 $u_h^{(k)}(r) = \\sum_{n=0}^p \\hat{u}_n^{(k)} L_n(r)$。求积近似为：\n    $$\n    R_k(q_{\\mathrm{vol}}) \\approx \\sum_{j=1}^{q_{\\mathrm{vol}}} w_j \\left( \\frac{u_h^{(k)}(r_j)^2}{2} \\frac{d u_h^{(k)}}{dr}(r_j) \\right)\n    $$\n    其中 $(r_j, w_j)$ 是 $q_{\\mathrm{vol}}$ 个求积点和权重。总变化率为 $R(q_{\\mathrm{vol}}) = \\sum_{k=0}^{N-1} R_k(q_{\\mathrm{vol}})$。\n\n4.  **诊断评估**：可解能量增量计算为 $\\Delta E = \\Delta t \\cdot R(q_{\\mathrm{vol}})$。如果 $\\Delta E > 0$，则诊断标志 $d$ 设为 $1$，否则设为 $0$。此标志表示检测到反向散射。\n\n以下 Python 程序为给定的测试用例实现了此过程。对于欠积分的情况（A, C, E），我们预期会发现 $\\Delta E > 0$ 和 $d=1$。对于精确积分或过积分的情况（B, D），$\\Delta E$ 应该很小，其符号将取决于 $L^2$ 投影不连续性所带来的离散误差，但预期不会显示由混叠引起的反向散射所具有的系统性正号。", "answer": "```python\nimport numpy as np\nfrom numpy.polynomial.legendre import Legendre, leggauss\n\ndef solve():\n    \"\"\"\n    Computes the resolved energy increment and backscatter flag for a DG\n    discretization of the Burgers' equation for several test cases.\n    \"\"\"\n    test_cases = [\n        # (p, N, q_vol, dt)\n        (3, 8, 4, 1.0e-3),   # Case A: p=3, 3p/2=4.5. q=4  4.5 -> under-integration\n        (3, 8, 8, 1.0e-3),   # Case B: p=3, 3p/2=4.5. q=8 > 4.5 -> over-integration\n        (4, 8, 5, 1.0e-3),   # Case C: p=4, 3p/2=6.0. q=5  6.0 -> under-integration\n        (1, 4, 2, 1.0e-3),   # Case D: p=1, 3p/2=1.5. q=2 > 1.5 -> exact integration\n        (5, 16, 3, 1.0e-3),  # Case E: p=5, 3p/2=7.5. q=3  7.5 -> severe under-integration\n    ]\n\n    results = []\n\n    def u0_func(x):\n        \"\"\"The smooth initial condition u(x,0).\"\"\"\n        return np.sin(x) + 0.25 * np.sin(3 * x) + 0.1 * np.sin(5 * x)\n\n    for p, N, q_vol, dt in test_cases:\n        h = 2.0 * np.pi / N\n        q_proj = 2 * p + 2  # High-order quadrature for accurate L2 projection\n        r_proj, w_proj = leggauss(q_proj)\n        \n        L_basis_proj = np.array([Legendre.basis(n)(r_proj) for n in range(p + 1)])\n        u_coeffs_all_elements = np.zeros((N, p + 1))\n\n        # 1. Construct the DG approximation via L^2 projection\n        for k in range(N):\n            x_k = k * h\n            x_proj_pts = x_k + (h / 2.0) * (r_proj + 1.0)\n            u0_at_pts = u0_func(x_proj_pts)\n            for n in range(p + 1):\n                numerator = np.sum(w_proj * u0_at_pts * L_basis_proj[n])\n                u_coeffs_all_elements[k, n] = (2.0 * n + 1.0) / 2.0 * numerator\n\n        # 2. Compute the discrete energy production rate R(q_vol)\n        r_vol, w_vol = leggauss(q_vol)\n        L_basis_vol = np.array([Legendre.basis(n)(r_vol) for n in range(p + 1)])\n        L_deriv_basis_vol = np.array([Legendre.basis(n).deriv()(r_vol) for n in range(p + 1)])\n\n        total_R = 0.0\n        for k in range(N):\n            u_coeffs_k = u_coeffs_all_elements[k, :]\n            \n            u_h_at_vol_pts = np.dot(u_coeffs_k, L_basis_vol)\n            u_h_deriv_at_vol_pts = np.dot(u_coeffs_k, L_deriv_basis_vol)\n            \n            integrand = 0.5 * (u_h_at_vol_pts ** 2) * u_h_deriv_at_vol_pts\n            element_R = np.sum(w_vol * integrand)\n            total_R += element_R\n\n        # 3. Compute Delta E and the diagnostic flag\n        delta_E = dt * total_R\n        d = 1 if delta_E > 1e-14 else 0\n        results.append([float(f\"{delta_E:.7e}\"), d])\n\n    # Format the final output as a single string per problem spec\n    output_str = str(results).replace(\" \", \"\")\n    print(output_str)\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3394720"}]}