{"hands_on_practices": [{"introduction": "高阶数值方法在求解双曲守恒律时，其解可能发展出间断（激波），这带来了严峻的挑战。本练习将引导您完成一个现代人工粘性模型从头到尾的计算，该模型通过引入局部的数值耗散来稳定激波。通过亲手计算一个基于模态能量的激波传感器、确定最终的粘性系数并量化其产生的熵耗散，您将清晰地理解激波捕捉机制的运作原理。[@problem_id:3380709]", "problem": "考虑在区域 $[0,1]$ 上的无粘伯格斯方程 $u_{t} + \\partial_{x}\\!\\left(\\frac{1}{2}u^{2}\\right) = 0$，该区域使用大小为 $h=1/10$ 的 $K=10$ 个单元组成的均匀网格，通过多项式次数为 $p=1$ 的间断伽辽金（DG）方法进行离散。关注包含一个定常间断（激波）的单个单元，该激波位于参考坐标 $r \\in [-1,1]$ 下的单元中心。在这个含有激波的单元上，将分段常数函数\n$$\nu(r) = \\begin{cases}\n1, & r \\in [-1,0),\\\\\n0, & r \\in (0,1].\n\\end{cases}\n$$\n到 $[-1,1]$ 上的勒让德多项式基 $\\{P_{0}(r), P_{1}(r)\\}$（其中 $P_{0}(r)=1$ 且 $P_{1}(r)=r$）上的精确 $L^{2}$ 投影来近似解。设模态展开为 $u_{h}(r)=c_{0}P_{0}(r)+c_{1}P_{1}(r)$，其中模态系数由 $L^{2}$ 投影公式定义\n$$\nc_{n} = \\frac{2n+1}{2}\\int_{-1}^{1}u(r)\\,P_{n}(r)\\,dr,\\quad n=0,1.\n$$\n根据 Persson–Peraire 模态能量比定义单元激波传感器\n$$\ns_{k} = \\log_{10}\\!\\left(\\frac{E_{p}}{E_{\\mathrm{tot}}}\\right),\\quad E_{p} = c_{p}^{2}\\int_{-1}^{1}P_{p}(r)^{2}\\,dr,\\quad E_{\\mathrm{tot}} = \\sum_{n=0}^{p} c_{n}^{2}\\int_{-1}^{1}P_{n}(r)^{2}\\,dr,\n$$\n并使用标准勒让德正交性 $\\int_{-1}^{1}P_{n}(r)^{2}\\,dr = \\frac{2}{2n+1}$。通过线性截断映射将传感器映射为粘性系数\n$$\n\\widetilde{s} = \\max\\!\\left(0,\\min\\!\\left(1,\\frac{s_{k}-s_{0}}{s_{1}-s_{0}}\\right)\\right),\\qquad s_{0}=-3,\\quad s_{1}=-1,\n$$\n并将粘性设置为\n$$\n\\epsilon_{k} = \\epsilon_{\\max}\\,\\widetilde{s},\\qquad \\epsilon_{\\max} = C_{\\mathrm{vis}}\\,h\\,\\lambda_{\\max},\\qquad C_{\\mathrm{vis}}=\\frac{1}{2},\\quad \\lambda_{\\max}=\\max|u|=1.\n$$\n假设伯格斯方程的熵对 $(U,F)$ 由 $U(u)=\\frac{1}{2}u^{2}$ 和 $F(u)=\\frac{1}{3}u^{3}$ 给出，并考虑在含有激波的单元上的半离散人工粘性贡献项 $\\partial_{x}(\\epsilon_{k}\\partial_{x}u_{h})$。在一个由 Courant–Friedrichs–Lewy (CFL) 条件\n$$\n\\Delta t = C_{\\mathrm{CFL}}\\,\\frac{h}{(2p+1)\\lambda_{\\max}},\\qquad C_{\\mathrm{CFL}}=0.3,\n$$\n选定的显式时间步长 $\\Delta t$ 内，粘性项在含有激波的单元上贡献的熵耗散为\n$$\n\\Delta E_{k} = -\\Delta t\\,\\epsilon_{k}\\int_{\\text{elem}}|\\partial_{x}u_{h}(x)|^{2}\\,dx.\n$$\n使用从参考坐标 $r$ 到单元上物理坐标 $x$ 的仿射映射 $x(r)=x_{c} + \\frac{h}{2}r$，其中 $x_{c}$ 是单元中心，因此有 $\\partial_{x}=\\frac{2}{h}\\partial_{r}$ 和 $dx=\\frac{h}{2}\\,dr$。计算：\n- 传感器值 $s_{k}$，\n- 粘性系数 $\\epsilon_{k}$，\n- 以及在含有激波的单元上每个时间步长的熵耗散 $\\Delta E_{k}$。\n\n在最终答案中，将这三个量按顺序 $(s_{k},\\,\\epsilon_{k},\\,\\Delta E_{k})$ 作为单个行矩阵报告。不包含任何单位。无需四舍五入；提供精确值或闭式表达式。", "solution": "### 步骤 1：问题验证\n\n问题陈述是偏微分方程数值方法领域内一个定义明确的计算练习，特别关注应用于无粘伯格斯方程的间断伽辽金（DG）方法。\n\n#### 提取的已知条件：\n- **方程**：无粘伯格斯方程，$u_{t} + \\partial_{x}\\!\\left(\\frac{1}{2}u^{2}\\right) = 0$。\n- **区域和离散化**：$[0,1]$，均匀网格，包含 $K=10$ 个单元，单元大小 $h=1/10$，多项式次数 $p=1$。\n- **含有激波的单元上的解**：参考单元解 $u_{h}(r)$ 是分段函数 $u(r) = \\begin{cases} 1, & r \\in [-1,0) \\\\ 0, & r \\in (0,1] \\end{cases}$ 在勒让德基 $\\{P_{0}(r), P_{1}(r)\\}$ 上的 $L^{2}$ 投影。\n- **基多项式**：$P_{0}(r)=1$, $P_{1}(r)=r$。\n- **模态展开**：$u_{h}(r)=c_{0}P_{0}(r)+c_{1}P_{1}(r)$。\n- **模态系数公式**：$c_{n} = \\frac{2n+1}{2}\\int_{-1}^{1}u(r)\\,P_{n}(r)\\,dr$ for $n=0,1$。\n- **勒让德多项式正交性**：$\\int_{-1}^{1}P_{n}(r)^{2}\\,dr = \\frac{2}{2n+1}$。\n- **激波传感器定义**：$s_{k} = \\log_{10}\\!\\left(\\frac{E_{p}}{E_{\\mathrm{tot}}}\\right)$，其中 $p=1$。\n- **能量定义**：$E_{p} = c_{p}^{2}\\int_{-1}^{1}P_{p}(r)^{2}\\,dr$ 和 $E_{\\mathrm{tot}} = \\sum_{n=0}^{p} c_{n}^{2}\\int_{-1}^{1}P_{n}(r)^{2}\\,dr$。\n- **映射后的传感器**：$\\widetilde{s} = \\max\\!\\left(0,\\min\\!\\left(1,\\frac{s_{k}-s_{0}}{s_{1}-s_{0}}\\right)\\right)$，常数 $s_{0}=-3$ 和 $s_{1}=-1$。\n- **人工粘性**：$\\epsilon_{k} = \\epsilon_{\\max}\\,\\widetilde{s}$，其中 $\\epsilon_{\\max} = C_{\\mathrm{vis}}\\,h\\,\\lambda_{\\max}$。\n- **粘性常数**：$C_{\\mathrm{vis}}=\\frac{1}{2}$，$\\lambda_{\\max}=\\max|u|=1$。\n- **时间步长（CFL 条件）**：$\\Delta t = C_{\\mathrm{CFL}}\\,\\frac{h}{(2p+1)\\lambda_{\\max}}$，常数 $C_{\\mathrm{CFL}}=0.3$。\n- **熵耗散**：$\\Delta E_{k} = -\\Delta t\\,\\epsilon_{k}\\int_{\\text{elem}}|\\partial_{x}u_{h}(x)|^{2}\\,dx$。\n- **坐标映射**：$x(r)=x_{c} + \\frac{h}{2}r$，这意味着 $\\partial_{x}=\\frac{2}{h}\\partial_{r}$ 和 $dx=\\frac{h}{2}\\,dr$。\n- **待计算的量**：$(s_{k},\\,\\epsilon_{k},\\,\\Delta E_{k})$。\n\n#### 验证结论：\n该问题具有科学依据，适定且客观。它展示了在DG框架中应用人工粘性以进行激波捕捉的标准程序。所有术语、常数和公式都已明确定义，构成了一个自洽且逻辑一致的问题。不存在矛盾、歧义或事实错误。该问题要求基于所提供的框架进行一系列计算，这是计算科学中的一项标准任务。因此，该问题被认为是 **有效的**。\n\n### 步骤 2：求解\n\n该问题要求依次计算三个量：激波传感器值 $s_k$、人工粘性系数 $\\epsilon_k$ 和每个时间步长的熵耗散 $\\Delta E_k$。\n\n#### 模态系数的计算 ($c_0, c_1$)\n模态系数使用 $L^{2}$ 投影公式计算。待投影的函数是 $u(r)$，它在 $[-1,0)$ 上为 $1$，在 $(0,1]$ 上为 $0$。\n对于系数 $c_0$（$n=0$ 时）：\n$$\nc_{0} = \\frac{2(0)+1}{2}\\int_{-1}^{1}u(r)P_{0}(r)\\,dr = \\frac{1}{2}\\int_{-1}^{1}u(r)(1)\\,dr\n$$\n根据 $u(r)$ 的定义拆分积分：\n$$\nc_{0} = \\frac{1}{2}\\left(\\int_{-1}^{0}1\\,dr + \\int_{0}^{1}0\\,dr\\right) = \\frac{1}{2}[r]_{-1}^{0} = \\frac{1}{2}(0 - (-1)) = \\frac{1}{2}.\n$$\n对于系数 $c_1$（$n=1$ 时）：\n$$\nc_{1} = \\frac{2(1)+1}{2}\\int_{-1}^{1}u(r)P_{1}(r)\\,dr = \\frac{3}{2}\\int_{-1}^{1}u(r)(r)\\,dr\n$$\n$$\nc_{1} = \\frac{3}{2}\\left(\\int_{-1}^{0}(1)(r)\\,dr + \\int_{0}^{1}(0)(r)\\,dr\\right) = \\frac{3}{2}\\left[\\frac{r^{2}}{2}\\right]_{-1}^{0} = \\frac{3}{2}\\left(0 - \\frac{(-1)^{2}}{2}\\right) = -\\frac{3}{4}.\n$$\n参考单元上的近似解为 $u_{h}(r) = \\frac{1}{2} - \\frac{3}{4}r$。\n\n#### 激波传感器的计算 ($s_k$)\n传感器值 $s_k$ 取决于最高次模态（$p=1$）的能量与总能量的比值。\n首先，我们使用正交性 $\\int_{-1}^{1}P_{n}(r)^{2}\\,dr = \\frac{2}{2n+1}$ 求能量积分：\n$$\n\\int_{-1}^{1}P_{0}(r)^{2}\\,dr = \\frac{2}{2(0)+1} = 2\n$$\n$$\n\\int_{-1}^{1}P_{1}(r)^{2}\\,dr = \\frac{2}{2(1)+1} = \\frac{2}{3}\n$$\n最高模态的能量 $E_p=E_1$ 为：\n$$\nE_{1} = c_{1}^{2}\\int_{-1}^{1}P_{1}(r)^{2}\\,dr = \\left(-\\frac{3}{4}\\right)^{2} \\cdot \\frac{2}{3} = \\frac{9}{16} \\cdot \\frac{2}{3} = \\frac{3}{8}.\n$$\n总能量 $E_{\\mathrm{tot}}$ 是从 $n=0$ 到 $p=1$ 所有模态能量的总和：\n$$\nE_{\\mathrm{tot}} = c_{0}^{2}\\int_{-1}^{1}P_{0}(r)^{2}\\,dr + c_{1}^{2}\\int_{-1}^{1}P_{1}(r)^{2}\\,dr = \\left(\\frac{1}{2}\\right)^{2} \\cdot 2 + E_{1} = \\frac{1}{4} \\cdot 2 + \\frac{3}{8} = \\frac{1}{2} + \\frac{3}{8} = \\frac{7}{8}.\n$$\n传感器值 $s_k$ 是能量比值的以 10 为底的对数：\n$$\ns_{k} = \\log_{10}\\!\\left(\\frac{E_{p}}{E_{\\mathrm{tot}}}\\right) = \\log_{10}\\!\\left(\\frac{3/8}{7/8}\\right) = \\log_{10}\\!\\left(\\frac{3}{7}\\right).\n$$\n\n#### 粘性系数的计算 ($\\epsilon_k$)\n粘性 $\\epsilon_k$ 通过首先计算映射后的传感器值 $\\widetilde{s}$ 来求得。\n$$\n\\widetilde{s} = \\max\\!\\left(0,\\min\\!\\left(1,\\frac{s_{k}-s_{0}}{s_{1}-s_{0}}\\right)\\right)\n$$\n使用给定的常数 $s_0=-3$ 和 $s_1=-1$，以及我们计算出的 $s_k$：\n$$\n\\frac{s_{k}-s_{0}}{s_{1}-s_{0}} = \\frac{\\log_{10}(3/7) - (-3)}{-1 - (-3)} = \\frac{3 + \\log_{10}(3/7)}{2}.\n$$\n为了评估 $\\min$ 函数，我们必须检查该量是否大于 $1$：\n$$\n\\frac{3 + \\log_{10}(3/7)}{2} > 1 \\iff 3 + \\log_{10}(3/7) > 2 \\iff \\log_{10}(3/7) > -1.\n$$\n这等价于 $3/7 > 10^{-1}$，或 $3/7 > 1/10$，简化为 $30 > 7$。这是成立的。\n由于 $\\min$ 函数的参数大于 $1$，所以 $\\min$ 的计算结果为 $1$：\n$$\n\\widetilde{s} = \\max(0, 1) = 1.\n$$\n现在，我们计算 $\\epsilon_{\\max}$：\n$$\n\\epsilon_{\\max} = C_{\\mathrm{vis}}\\,h\\,\\lambda_{\\max} = \\frac{1}{2} \\cdot \\frac{1}{10} \\cdot 1 = \\frac{1}{20}.\n$$\n因此，粘性系数为：\n$$\n\\epsilon_{k} = \\epsilon_{\\max}\\,\\widetilde{s} = \\frac{1}{20} \\cdot 1 = \\frac{1}{20}.\n$$\n\n#### 熵耗散的计算 ($\\Delta E_k$)\n每个时间步长的熵耗散由 $\\Delta E_{k} = -\\Delta t\\,\\epsilon_{k}\\int_{\\text{elem}}|\\partial_{x}u_{h}(x)|^{2}\\,dx$ 给出。我们分部分计算。\n首先，时间步长 $\\Delta t$：\n$$\n\\Delta t = C_{\\mathrm{CFL}}\\frac{h}{(2p+1)\\lambda_{\\max}} = 0.3 \\cdot \\frac{1/10}{(2(1)+1)(1)} = \\frac{3}{10} \\cdot \\frac{1/10}{3} = \\frac{1}{100}.\n$$\n接下来是积分项。我们使用坐标映射将积分转换到参考单元 $[-1,1]$ 上：\n$$\n\\int_{\\text{elem}}|\\partial_{x}u_{h}(x)|^{2}\\,dx = \\int_{-1}^{1}\\left|\\frac{2}{h}\\partial_{r}u_{h}(r)\\right|^{2}\\left(\\frac{h}{2}\\,dr\\right) = \\frac{2}{h}\\int_{-1}^{1}(\\partial_{r}u_{h}(r))^{2}\\,dr.\n$$\n解的近似值的导数为 $\\partial_{r}u_{h}(r) = \\partial_{r}(\\frac{1}{2} - \\frac{3}{4}r) = -\\frac{3}{4}$。注意，由于 $\\partial_r P_0 = 0$ 和 $\\partial_r P_1 = 1$，这等于 $c_1$。\n积分变为：\n$$\n\\frac{2}{h}\\int_{-1}^{1}\\left(-\\frac{3}{4}\\right)^{2}\\,dr = \\frac{2}{h} \\cdot \\frac{9}{16} \\int_{-1}^{1}dr = \\frac{9}{8h}[r]_{-1}^{1} = \\frac{9}{8h}(1 - (-1)) = \\frac{18}{8h} = \\frac{9}{4h}.\n$$\n代入 $h=1/10$：\n$$\n\\int_{\\text{elem}}|\\partial_{x}u_{h}(x)|^{2}\\,dx = \\frac{9}{4(1/10)} = \\frac{90}{4} = \\frac{45}{2}.\n$$\n最后，我们组合计算 $\\Delta E_k$：\n$$\n\\Delta E_{k} = -\\Delta t \\cdot \\epsilon_{k} \\cdot \\left(\\frac{45}{2}\\right) = -\\left(\\frac{1}{100}\\right) \\cdot \\left(\\frac{1}{20}\\right) \\cdot \\left(\\frac{45}{2}\\right) = -\\frac{45}{4000}.\n$$\n化简分数：\n$$\n\\Delta E_{k} = -\\frac{9 \\times 5}{800 \\times 5} = -\\frac{9}{800}.\n$$\n\n计算出的三个量是 $s_k = \\log_{10}(3/7)$，$\\epsilon_k = 1/20$ 和 $\\Delta E_k = -9/800$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\log_{10}(\\frac{3}{7}) & \\frac{1}{20} & -\\frac{9}{800}\n\\end{pmatrix}\n}\n$$", "id": "3380709"}, {"introduction": "尽管守恒律齐次部分的熵稳定性至关重要，但源项的离散化同样会影响整体的熵平衡。本练习将揭示精心设计源项离散格式以使其与熵分析兼容的重要性。通过对比简单的逐点计算方法和专门构造的熵平衡方法，您将亲眼见证后者如何被设计为精确地维持离散熵等式，这是证明非线性稳定性的一个关键属性。[@problem_id:3380676]", "problem": "考虑一维非线性标量守恒律\n$$\nu_{t} + f(u)_{x} = s(u,x),\n$$\n在参考单元 $x \\in [-1,1]$上，带有周期性边界条件，并假设平流项贡献恒为零，$f(u)_{x} \\equiv 0$，从而只有源项对熵守恒有贡献。设熵/熵通量对由 $U(u) = \\frac{1}{2} u^{2}$ 和 $F(u) = \\frac{1}{3} u^{3}$ 给出，熵变量为 $v(u) = U'(u) = u$。\n\n在 $[-1,1]$ 上总多项式次数为 $N=2$ 的谱Galerkin半离散化中，离散内积使用Gauss–Lobatto–Legendre (GLL) 求积计算，其节点为 $x_{1}=-1$，$x_{2}=0$，$x_{3}=1$，权重为 $w_{1}=\\frac{1}{3}$，$w_{2}=\\frac{4}{3}$，$w_{3}=\\frac{1}{3}$。假设在某个固定时刻的近似解为多项式\n$$\nu(x) = 1 + x + x^{2}.\n$$\n考虑非线性源 $s(u,x) = u(x)^{3}$。\n\n对于一个源项离散化 $s^{d}$，将离散熵残差定义为\n$$\nR[s^{d}] = v^{T} W \\,\\dot{u} - v^{T} W \\, s^{d},\n$$\n其中 $v$ 是在 GLL 节点处求值的熵变量向量，$W = \\mathrm{diag}(w_{1}, w_{2}, w_{3})$ 是对角求积权重矩阵，$\\dot{u}$ 是由谱Galerkin方法提供的半离散时间导数。在没有平流的情况下，谱Galerkin方法生成的 $\\dot{u}$ 是 $s(u,x)$ 在次数至多为2的多项式子空间上的 $L^{2}$ 投影。\n\n您将比较两种源项离散化：\n- 一种是使用节点求值的点态（配置）源项离散化 $s^{\\mathrm{pw}}$，即 $s^{\\mathrm{pw}}(x_{i}) = s(u(x_{i}),x_{i})$。\n- 另一种是使用熵变量 $v$ 并强制离散熵相容性的熵守恒源项离散化 $s^{\\mathrm{bal}}$。该方法通过将 $\\dot{u}$ 取为 $s(u,x)$ 在次数 $\\leq 2$ 的多项式空间上的 $L^{2}$ 投影，并将离散熵方程中的右端项取为将 $v^{T} W$ 应用于同一 $L^{2}$ 投影的结果来实现。\n\n计算这两个离散熵残差\n$$\nR[s^{\\mathrm{pw}}] \\quad \\text{和} \\quad R[s^{\\mathrm{bal}}],\n$$\n对于给定的 $u(x)$ 和求积方法，使用最高2次的勒让德多项式在 $[-1,1]$ 上构造 $L^{2}$ 投影。具体来说，使用 $P_{0}(x)=1$，$P_{1}(x)=x$ 和 $P_{2}(x)=\\frac{1}{2}(3x^{2}-1)$，其中 $\\int_{-1}^{1} P_{m}(x) P_{n}(x) \\,\\mathrm{d}x = \\frac{2}{2n+1} \\delta_{mn}$。以精确形式表示您的最终答案。无需四舍五入。最终输出必须是这两个残差，以 $\\big(R[s^{\\mathrm{pw}}] \\;\\; R[s^{\\mathrm{bal}}]\\big)$ 的顺序排列成一个单行矩阵。", "solution": "该问题要求计算一个特定的一维非线性标量守恒律的两个离散熵残差，$R[s^{\\mathrm{pw}}]$ 和 $R[s^{\\mathrm{bal}}]$。分析在谱Galerkin半离散化框架内进行。\n\n对于给定的源项离散化 $s^d$，离散熵残差定义为\n$$\nR[s^{d}] = v^{T} W \\dot{u} - v^{T} W s^{d}\n$$\n其中 $v$ 是在Gauss–Lobatto–Legendre (GLL) 求积节点上求值的熵变量向量，$W$ 是GLL求积权重的对角矩阵，$\\dot{u}$ 是在GLL节点上求值的半离散时间导数向量。\n\n首先，我们确定计算所需的各个组成部分。\n\n**1. GLL 节点、权重和解的求值**\n\n多项式次数 $N=2$ 的 GLL 节点为 $x_1 = -1$，$x_2 = 0$ 和 $x_3 = 1$。\n相应的GLL权重为 $w_1 = \\frac{1}{3}$，$w_2 = \\frac{4}{3}$ 和 $w_3 = \\frac{1}{3}$。权重矩阵为 $W = \\mathrm{diag}(\\frac{1}{3}, \\frac{4}{3}, \\frac{1}{3})$。\n\n近似解由多项式 $u(x) = 1 + x + x^2$ 给出。我们在GLL节点上计算该解的值：\n$u_1 = u(x_1) = u(-1) = 1 + (-1) + (-1)^2 = 1$。\n$u_2 = u(x_2) = u(0) = 1 + 0 + 0^2 = 1$。\n$u_3 = u(x_3) = u(1) = 1 + 1 + 1^2 = 3$。\n\n熵变量为 $v(u) = U'(u)$，其中 $U(u) = \\frac{1}{2}u^2$，因此 $v(u) = u$。因此，在节点处的熵变量向量（记为 $v$）与在节点处的解值向量相同：\n$$\nv = \\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{pmatrix} = \\begin{pmatrix} u_1 \\\\ u_2 \\\\ u_3 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 1 \\\\ 3 \\end{pmatrix}.\n$$\n\n**2. 点态源项离散化 ($s^{\\mathrm{pw}}$)**\n\n非线性源项为 $s(u,x) = u(x)^3$。\n点态（配置）源项离散化 $s^{\\mathrm{pw}}$ 包括使用解的节点值来计算源函数的值：$s^{\\mathrm{pw}}_i = s(u(x_i), x_i) = (u_i)^3$。\n$s^{\\mathrm{pw}}_1 = (u_1)^3 = 1^3 = 1$。\n$s^{\\mathrm{pw}}_2 = (u_2)^3 = 1^3 = 1$。\n$s^{\\mathrm{pw}}_3 = (u_3)^3 = 3^3 = 27$。\n向量 $s^{\\mathrm{pw}}$ 为：\n$$\ns^{\\mathrm{pw}} = \\begin{pmatrix} 1 \\\\ 1 \\\\ 27 \\end{pmatrix}.\n$$\n\n**3. 半离散时间导数 ($\\dot{u}$)**\n\n由于平流项 $f(u)_x$ 为零，方程为 $u_t = s(u,x)$。在谱Galerkin方法中，多项式近似的半离散时间导数（我们可称之为 $\\dot{u}_{\\mathrm{poly}}(t,x)$）是通过将源项 $s(u,x)$ 在次数至多为 $N=2$ 的多项式空间上进行 $L^2$ 投影得到的。残差公式中的向量 $\\dot{u}$ 是此多项式在GLL节点处的值。\n\n设 $\\dot{u}_{\\mathrm{proj}}(x)$ 是 $s(u(x),x)$ 在 $\\mathcal{P}_2 = \\mathrm{span}\\{P_0(x), P_1(x), P_2(x)\\}$ 上的 $L^2$ 投影，其中 $P_k(x)$ 是勒让德多项式。\n$$\n\\dot{u}_{\\mathrm{proj}}(x) = c_0 P_0(x) + c_1 P_1(x) + c_2 P_2(x).\n$$\n作为 $x$ 的函数的源项是 $s(x) = s(u(x),x) = (1+x+x^2)^3$。展开此多项式得到：\n$$\ns(x) = 1 + 3x + 6x^2 + 7x^3 + 6x^4 + 3x^5 + x^6.\n$$\n系数 $c_k$ 使用公式 $c_k = \\frac{\\langle s, P_k \\rangle}{\\langle P_k, P_k \\rangle} = \\frac{\\int_{-1}^{1} s(x) P_k(x) dx}{\\int_{-1}^{1} P_k(x)^2 dx}$ 计算。分母由 $\\frac{2}{2k+1}$ 给出。\n\n计算积分后，我们发现系数为：\n$c_0 = \\frac{152}{35}$，$c_1 = \\frac{297}{35}$，$c_2 = \\frac{166}{21}$。\n\n因此，投影多项式为：\n$$\n\\dot{u}_{\\mathrm{proj}}(x) = \\frac{152}{35}P_0(x) + \\frac{297}{35}P_1(x) + \\frac{166}{21}P_2(x).\n$$\n代入勒让德多项式 $P_0(x)=1, P_1(x)=x, P_2(x)=\\frac{1}{2}(3x^2-1)$:\n$$\n\\dot{u}_{\\mathrm{proj}}(x) = \\frac{152}{35} + \\frac{297}{35}x + \\frac{166}{21}\\left(\\frac{3x^2-1}{2}\\right) = \\left(\\frac{152}{35} - \\frac{83}{21}\\right) + \\frac{297}{35}x + \\frac{83}{7}x^2 = \\frac{41}{105} + \\frac{297}{35}x + \\frac{83}{7}x^2.\n$$\n现在，我们在GLL节点上计算该多项式的值以求得向量 $\\dot{u}$：\n$\\dot{u}_1 = \\dot{u}_{\\mathrm{proj}}(-1) = \\frac{41}{105} - \\frac{297}{35} + \\frac{83}{7} = \\frac{41 - 891 + 1245}{105} = \\frac{395}{105} = \\frac{79}{21}$。\n$\\dot{u}_2 = \\dot{u}_{\\mathrm{proj}}(0) = \\frac{41}{105}$。\n$\\dot{u}_3 = \\dot{u}_{\\mathrm{proj}}(1) = \\frac{41}{105} + \\frac{297}{35} + \\frac{83}{7} = \\frac{41 + 891 + 1245}{105} = \\frac{2177}{105}$。\n向量 $\\dot{u}$ 为：\n$$\n\\dot{u} = \\begin{pmatrix} 79/21 \\\\ 41/105 \\\\ 2177/105 \\end{pmatrix}.\n$$\n\n**4. $R[s^{\\mathrm{pw}}]$ 的计算**\n\n我们现在计算点态源项的残差：\n$$\nR[s^{\\mathrm{pw}}] = v^T W (\\dot{u} - s^{\\mathrm{pw}}).\n$$\n首先，计算差分向量 $\\dot{u} - s^{\\mathrm{pw}}$：\n$\\dot{u}_1 - s^{\\mathrm{pw}}_1 = \\frac{79}{21} - 1 = \\frac{58}{21}$。\n$\\dot{u}_2 - s^{\\mathrm{pw}}_2 = \\frac{41}{105} - 1 = -\\frac{64}{105}$。\n$\\dot{u}_3 - s^{\\mathrm{pw}}_3 = \\frac{2177}{105} - 27 = \\frac{2177 - 27 \\cdot 105}{105} = \\frac{2177 - 2835}{105} = -\\frac{658}{105}$。\n\n现在计算三重积：\n$R[s^{\\mathrm{pw}}] = \\sum_{i=1}^3 v_i w_i (\\dot{u}_i - s^{\\mathrm{pw}}_i) = v_1 w_1 (\\dot{u}_1 - s^{\\mathrm{pw}}_1) + v_2 w_2 (\\dot{u}_2 - s^{\\mathrm{pw}}_2) + v_3 w_3 (\\dot{u}_3 - s^{\\mathrm{pw}}_3)$。\n$R[s^{\\mathrm{pw}}] = (1)(\\frac{1}{3})(\\frac{58}{21}) + (1)(\\frac{4}{3})(-\\frac{64}{105}) + (3)(\\frac{1}{3})(-\\frac{658}{105})$。\n$R[s^{\\mathrm{pw}}] = \\frac{58}{63} - \\frac{256}{315} - \\frac{658}{105} = \\frac{290 - 256 - 1974}{315} = \\frac{34 - 1974}{315} = \\frac{-1940}{315}$。\n将分子和分母除以它们的最大公约数5来简化分数：\n$$\nR[s^{\\mathrm{pw}}] = -\\frac{388}{63}.\n$$\n\n**5. $R[s^{\\mathrm{bal}}]$ 的计算**\n\n对于熵守恒源项离散化 $s^{\\mathrm{bal}}$，题目指出，它强制实现离散熵相容性的方法是：使离散熵方程的右端项等于将 $v^{T} W$ 应用于同一 $L^{2}$ 投影的结果。\n源项贡献的离散熵方程为 $\\frac{dU_{total}}{dt} = v^T W s^d$。右端项是 $v^T W s^d$。\n对于守恒离散化，该项 $v^T W s^{\\mathrm{bal}}$ 被设为等于“应用于同一 $L^2$ 投影的 $v^T W$”，也就是 $v^T W \\dot{u}$。因此，根据熵守恒格式在此情境下的定义：\n$$\nv^{T} W s^{\\mathrm{bal}} \\equiv v^{T} W \\dot{u}.\n$$\n将此代入残差 $R[s^{\\mathrm{bal}}]$ 的定义中：\n$$\nR[s^{\\mathrm{bal}}] = v^{T} W \\dot{u} - v^{T} W s^{\\mathrm{bal}} = v^{T} W \\dot{u} - v^{T} W \\dot{u} = 0.\n$$\n熵守恒源项是专门构造的，以使该残差为零，从而满足离散熵定律。\n\n**结论**\n\n两个离散熵残差为：\n$R[s^{\\mathrm{pw}}] = -\\frac{388}{63}$。\n$R[s^{\\mathrm{bal}}] = 0$。\n\n最终答案按要求以行矩阵形式呈现。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-\\frac{388}{63} & 0\n\\end{pmatrix}\n}\n$$", "id": "3380676"}, {"introduction": "对于像可压缩欧拉方程这样的复杂系统，一个稳健的数值格式不仅需要保证熵稳定，还必须维持密度和压力等物理量的正性。本高阶练习将带您探索熵稳定性与正性保持之间复杂的相互作用。通过为欧拉方程编写一个模拟程序，您将发现，施加对于物理可容许性而言必不可少的正性保持限制器，有时会抵消数值通量的熵耗散特性，从而导致总熵的净增加。[@problem_id:3380723]", "problem": "考虑单组分理想气体的一维可压缩欧拉方程，其比热比为 $\\gamma \\in \\mathbb{R}$，$\\gamma > 1$。设守恒变量为 $u = [\\rho, m, E]^T$，其中 $\\rho$ 是质量密度，$m = \\rho u$ 是动量（$u$ 为速度），$E$ 是总能量。热力学压力由状态方程 $p = (\\gamma - 1)\\left(E - \\frac{1}{2}\\frac{m^2}{\\rho}\\right)$ 给出。物理可容许性约束要求 $\\rho > 0$ 和 $p > 0$。无粘通量为 $f(u) = [m,\\; \\frac{m^2}{\\rho} + p,\\; (E + p)\\frac{m}{\\rho}]^T$。\n\n对于离散熵分析，将欧拉系统的数学熵（一个凸熵函数）定义为 $\\eta(u) = -\\frac{\\rho s}{\\gamma - 1}$，其中 $s = \\ln(p) - \\gamma \\ln(\\rho)$ 是物理比熵。在半离散熵稳定格式中，由熵稳定通量驱动的更新下，总离散熵应为非增的。局部Lax-Friedrichs (LLF) 数值通量（也称为 Rusanov 通量）由下式给出\n$$\nF_{\\mathrm{LLF}}(u_L, u_R) = \\frac{1}{2}\\left(f(u_L) + f(u_R)\\right) - \\frac{1}{2}\\alpha(u_L, u_R)\\left(u_R - u_L\\right),\n$$\n其中 $\\alpha(u_L, u_R)$ 是最大特征速度的一个界，例如 $\\alpha(u_L,u_R) = \\max\\left(|u_L| + c_L,\\; |u_R| + c_R\\right)$，其中 $c = \\sqrt{\\gamma p / \\rho}$ 是根据与 $u_L$ 和 $u_R$ 相关的原始变量计算出的声速。当 $\\alpha$ 如上选择时，此通量对于欧拉方程是熵稳定的。\n\n在一个代表性的双单元周期性离散化中（这种离散化源于对称节点谱方法或简化为单个界面耦合的最低阶间断Galerkin方法），考虑两个相邻的单元，其状态分别为 $u_L$ 和 $u_R$。设在均匀网格间距 $\\Delta x$ 上，单个大小为 $\\Delta t$ 的前向欧拉步的更新，在共享界面上使用两个参数反向的数值通量计算：\n$$\nF_{LR} = F_{\\mathrm{LLF}}(u_L, u_R), \\quad F_{RL} = F_{\\mathrm{LLF}}(u_R, u_L).\n$$\n双单元的周期性更新为\n$$\nu_L^{\\mathrm{new}} = u_L - \\frac{\\Delta t}{\\Delta x}\\left(F_{LR} - F_{RL}\\right), \\quad\nu_R^{\\mathrm{new}} = u_R - \\frac{\\Delta t}{\\Delta x}\\left(F_{RL} - F_{LR}\\right).\n$$\n\n为了在更新后强制密度和压力的正性，应用一个保正限制器，通过将每个候选更新状态 $u^{\\mathrm{new}}$ 与其原始可容许状态 $u^{\\mathrm{safe}}$（更新前状态）进行凸混合\n$$\nu^{\\mathrm{lim}}(\\theta) = \\theta\\, u^{\\mathrm{new}} + (1 - \\theta)\\, u^{\\mathrm{safe}}, \\quad \\theta \\in [0,1],\n$$\n并选择满足 $\\rho^{\\mathrm{lim}}(\\theta) \\ge \\rho_{\\min}$ 和 $p^{\\mathrm{lim}}(\\theta) \\ge p_{\\min}$ 的最大 $\\theta$，其中 $\\rho_{\\min} > 0$ 和 $p_{\\min} > 0$ 是给定的下限值。两个单元中的受限状态是通过此过程获得的 $u_L^{\\mathrm{lim}}$ 和 $u_R^{\\mathrm{lim}}$。\n\n将“熵增违例”定义为在应用保正限制器后，两个单元的数学熵之和增加的事件，即\n$$\n\\eta(u_L^{\\mathrm{lim}}) + \\eta(u_R^{\\mathrm{lim}}) > \\eta(u_L) + \\eta(u_R).\n$$\n在此背景下，研究保正限制器与熵稳定LLF通量的相容性，并识别限制器引起的过冲导致总数学熵增加的场景。\n\n你的任务是实现一个程序，对下面提供的每个测试用例执行以下步骤：\n- 将给定的原始变量 $(\\rho, u, p)$ 转换为守恒变量 $u$。\n- 在共享界面上计算两种参数顺序的LLF通量，并使用上述双单元周期性格式更新两个单元。\n- 使用给定的下限值 $\\rho_{\\min}$ 和 $p_{\\min}$ 应用保正限制器，方法是选择使每个单元中的约束得以强制执行的最大 $\\theta \\in [0,1]$。\n- 计算受限更新前后数学熵的总和。\n- 返回一个布尔值，指示总数学熵是否因受限更新而增加。\n\n所有量均为无量纲。使用以下测试套件；每个测试用例由 $(\\gamma,\\; \\Delta t,\\; \\Delta x,\\; \\rho_L,\\; u_L,\\; p_L,\\; \\rho_R,\\; u_R,\\; p_R,\\; \\rho_{\\min},\\; p_{\\min})$ 指定：\n- 情况1（基准平滑状态）：$(1.4,\\; 0.1,\\; 1.0,\\; 1.0,\\; 0.0,\\; 1.0,\\; 0.9,\\; 0.1,\\; 1.1,\\; 10^{-10},\\; 10^{-10})$。\n- 情况2（可能产生过冲的强跳跃）：$(1.4,\\; 1.0,\\; 1.0,\\; 0.2,\\; 5.0,\\; 0.01,\\; 1.0,\\; -2.0,\\; 2.0,\\; 10^{-12},\\; 10^{-12})$。\n- 情况3（类激波对比）：$(1.4,\\; 0.5,\\; 1.0,\\; 1.0,\\; 3.0,\\; 0.5,\\; 4.0,\\; 0.0,\\; 2.0,\\; 10^{-12},\\; 10^{-12})$。\n- 情况4（一侧接近真空）：$(1.4,\\; 0.7,\\; 1.0,\\; 10^{-3},\\; 0.0,\\; 10^{-5},\\; 1.0,\\; 0.0,\\; 1.0,\\; 10^{-12},\\; 10^{-12})$。\n- 情况5（反向传播的高马赫数）：$(1.4,\\; 0.3,\\; 1.0,\\; 0.5,\\; 10.0,\\; 0.1,\\; 0.5,\\; -10.0,\\; 0.1,\\; 10^{-12},\\; 10^{-12})$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，\"[result1,result2,result3,result4,result5]\"），其中每个结果都是一个布尔值（True 或 False），指示对于该测试用例，应用保正限制器后总数学熵是否增加。", "solution": "该问题已经过验证，被认为是有效的。它在科学上基于双曲守恒律的计算流体力学原理，特别是可压缩欧拉方程。该问题是适定的，提供了所有必要的定义、方程和参数来构建一个唯一的、确定性的计算解决方案。语言是客观的，设置是一致的。\n\n任务是确定当保正限制器应用于熵稳定数值格式时，是否会导致一个简单的双单元周期性系统的总数学熵增加。解决方案涉及对一组测试用例直接模拟所述过程。分析的核心在于局部的、逐状态的正性强制执行与全局的、系统范围的熵耗散属性之间潜在的不相容性。熵函数是凸的，虽然通量是熵稳定的且限制器是凸组合，但限制器系数 $\\theta$ 在不同单元间可能不同（$\\theta_L \\ne \\theta_R$）这一事实，破坏了保证组合格式熵稳定性的简单论证。\n\n计算过程实现如下：\n\n1.  **状态转换**：初始状态以原始变量 $(\\rho, u, p)$ 的形式提供，其中 $\\rho$ 是密度，$u$ 是速度，$p$ 是压力。这些变量被转换为守恒变量向量 $u = [\\rho, m, E]^T$，其中 $m = \\rho u$ 是动量，$E$ 是单位体积的总能量。总能量的转换基于理想气体状态方程：\n    $$E = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho u^2 = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\frac{m^2}{\\rho}$$\n\n2.  **半离散更新**：问题描述了一个双单元周期性系统，它作为分析单个单元界面相互作用的最小模型。状态 $u_L$ 和 $u_R$ 的前向欧拉时间更新由下式给出：\n    $$\n    u_L^{\\mathrm{new}} = u_L - \\frac{\\Delta t}{\\Delta x}\\left(F_{LR} - F_{RL}\\right) \\\\\n    u_R^{\\mathrm{new}} = u_R - \\frac{\\Delta t}{\\Delta x}\\left(F_{RL} - F_{LR}\\right)\n    $$\n    其中 $F_{LR} = F_{\\mathrm{LLF}}(u_L, u_R)$ 和 $F_{RL} = F_{\\mathrm{LLF}}(u_R, u_L)$ 是局部Lax-Friedrichs (LLF) 数值通量。LLF通量定义为：\n    $$\n    F_{\\mathrm{LLF}}(u_L, u_R) = \\frac{1}{2}\\left(f(u_L) + f(u_R)\\right) - \\frac{1}{2}\\alpha(u_L, u_R)\\left(u_R - u_L\\right)\n    $$\n    稳定化参数 $\\alpha(u_L, u_R)$ 是对称的，即 $\\alpha(u_L, u_R) = \\alpha(u_R, u_L)$。这导致更新项的显著简化：\n    $$\n    F_{LR} - F_{RL} = -\\alpha(u_L, u_R)(u_R - u_L)\n    $$\n    因此，候选状态 $u_L^{\\mathrm{new}}$ 和 $u_R^{\\mathrm{new}}$ 的更新变为：\n    $$\n    u_L^{\\mathrm{new}} = u_L + \\frac{\\Delta t}{\\Delta x}\\alpha(u_L, u_R)(u_R - u_L) \\\\\n    u_R^{\\mathrm{new}} = u_R - \\frac{\\Delta t}{\\Delta x}\\alpha(u_L, u_R)(u_R - u_L)\n    $$\n    波速 $\\alpha$ 计算为 $\\alpha(u_L, u_R) = \\max(|u_L| + c_L, |u_R| + c_R)$，其中 $u$ 是流体速度，$c = \\sqrt{\\gamma p / \\rho}$ 是声速，所有这些都从对应于状态 $u_L$ 和 $u_R$ 的原始变量导出。\n\n3.  **保正限制器**：候选状态 $u^{\\mathrm{new}}$ 可能会违反物理可容许性约束 $\\rho > 0$ 和 $p > 0$。为了强制执行这些约束，应用了保正限制器。对于每个单元，我们找到最大的混合因子 $\\theta \\in [0, 1]$，使得受限状态 $u^{\\mathrm{lim}}(\\theta) = \\theta u^{\\mathrm{new}} + (1 - \\theta) u^{\\mathrm{safe}}$ 是可容许的。这里，$u^{\\mathrm{safe}}$ 是更新前的状态，假定为可容许的。\n    约束条件是 $\\rho^{\\mathrm{lim}}(\\theta) \\ge \\rho_{\\min}$ 和 $p^{\\mathrm{lim}}(\\theta) \\ge p_{\\min}$，其中 $\\rho_{\\min}$ 和 $p_{\\min}$ 是小的正下限值。\n\n    *   **密度约束**：$\\rho^{\\mathrm{lim}}(\\theta) = \\theta \\rho^{\\mathrm{new}} + (1 - \\theta) \\rho^{\\mathrm{safe}} \\ge \\rho_{\\min}$。这是一个关于 $\\theta$ 的线性不等式。如果 $\\rho^{\\mathrm{new}} < \\rho_{\\min}$，它会产生一个上界 $\\theta \\le \\theta_{\\rho} = (\\rho_{\\min} - \\rho^{\\mathrm{safe}})/(\\rho^{\\mathrm{new}} - \\rho^{\\mathrm{safe}})$。否则，任何 $\\theta \\in [0,1]$ 对于密度约束都是有效的。\n\n    *   **压力约束**：$p^{\\mathrm{lim}}(\\theta) = (\\gamma-1)(E^{\\mathrm{lim}}(\\theta) - \\frac{1}{2}\\frac{(m^{\\mathrm{lim}}(\\theta))^2}{\\rho^{\\mathrm{lim}}(\\theta)}) \\ge p_{\\min}$。代入 $\\rho^{\\mathrm{lim}}$, $m^{\\mathrm{lim}}$ 和 $E^{\\mathrm{lim}}$ 的线性表达式，会得到一个关于 $\\theta$ 的形式为 $A\\theta^2 + B\\theta + C \\ge 0$ 的二次不等式。系数 $A, B, C$ 是安全状态和新状态以及 $\\gamma$ 和 $p_{\\min}$ 的函数。如果新状态 $u^{\\mathrm{new}}$ 已经是压力正的，则此约束不需要混合。否则，我们求解二次方程 $A\\theta^2 + B\\theta + C = 0$ 的根。由于安全状态是可容许的（$p^{\\mathrm{safe}} > p_{\\min}$）而新状态不是（$p^{\\mathrm{new}} < p_{\\min}$），在区间 $(0, 1)$ 内必定存在一个根，它提供了上界 $\\theta_p$。使用 `numpy.roots` 函数来稳健地找到这些根。\n\n    每个单元的最终混合因子是 $\\theta = \\min(1.0, \\theta_{\\rho}, \\theta_{p})$。此过程独立地对单元 $L$ 和单元 $R$ 执行以找到 $\\theta_L$ 和 $\\theta_R$，然后得到相应的受限状态 $u_L^{\\mathrm{lim}}$ 和 $u_R^{\\mathrm{lim}}$。\n\n4.  **熵违例检查**：状态 $u$ 的数学熵为 $\\eta(u) = -\\frac{\\rho s}{\\gamma - 1}$，其中物理比熵 $s = \\ln(p) - \\gamma \\ln(\\rho)$。总初始熵为 $\\Sigma \\eta_{\\mathrm{initial}} = \\eta(u_L) + \\eta(u_R)$。受限更新后的总最终熵为 $\\Sigma \\eta_{\\mathrm{final}} = \\eta(u_L^{\\mathrm{lim}}) + \\eta(u_R^{\\mathrm{lim}})$。如果 $\\Sigma \\eta_{\\mathrm{final}} > \\Sigma \\eta_{\\mathrm{initial}}$，则发生“熵增违例”。对每个测试用例返回一个布尔值，指示是否观察到此违例。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function that processes all test cases.\n    \"\"\"\n    test_cases = [\n        # (gamma, dt, dx, rho_L, u_L, p_L, rho_R, u_R, p_R, rho_min, p_min)\n        (1.4, 0.1, 1.0, 1.0, 0.0, 1.0, 0.9, 0.1, 1.1, 1e-10, 1e-10),\n        (1.4, 1.0, 1.0, 0.2, 5.0, 0.01, 1.0, -2.0, 2.0, 1e-12, 1e-12),\n        (1.4, 0.5, 1.0, 1.0, 3.0, 0.5, 4.0, 0.0, 2.0, 1e-12, 1e-12),\n        (1.4, 0.7, 1.0, 1e-3, 0.0, 1e-5, 1.0, 0.0, 1.0, 1e-12, 1e-12),\n        (1.4, 0.3, 1.0, 0.5, 10.0, 0.1, 0.5, -10.0, 0.1, 1e-12, 1e-12),\n    ]\n\n    results = []\n    for case in test_cases:\n        violation = run_simulation(*case)\n        results.append(violation)\n\n    # Capitalize boolean for correct output format\n    print(f\"[{','.join(map(lambda x: str(x).capitalize(), results))}]\")\n\ndef run_simulation(gamma, dt, dx, rho_L, v_L, p_L, rho_R, v_R, p_R, rho_min, p_min):\n    \"\"\"\n    Runs the simulation for a single test case.\n    \"\"\"\n    # 1. Convert primitive to conservative variables\n    uL_safe = prim_to_cons(rho_L, v_L, p_L, gamma)\n    uR_safe = prim_to_cons(rho_R, v_R, p_R, gamma)\n\n    # 2. Calculate initial total entropy\n    eta_initial = entropy_function(uL_safe, gamma) + entropy_function(uR_safe, gamma)\n\n    # 3. Compute LLF wave speed\n    cL = np.sqrt(gamma * p_L / rho_L)\n    cR = np.sqrt(gamma * p_R / rho_R)\n    alpha = max(abs(v_L) + cL, abs(v_R) + cR)\n    \n    # 4. Compute candidate updated states\n    diff_u = uR_safe - uL_safe\n    uL_new = uL_safe + (dt / dx) * alpha * diff_u\n    uR_new = uR_safe - (dt / dx) * alpha * diff_u\n\n    # 5. Apply positivity-preserving limiter\n    theta_L = find_limiter_theta(uL_new, uL_safe, gamma, rho_min, p_min)\n    uL_lim = theta_L * uL_new + (1 - theta_L) * uL_safe\n\n    theta_R = find_limiter_theta(uR_new, uR_safe, gamma, rho_min, p_min)\n    uR_lim = theta_R * uR_new + (1 - theta_R) * uR_safe\n    \n    # 6. Calculate final total entropy\n    eta_final = entropy_function(uL_lim, gamma) + entropy_function(uR_lim, gamma)\n    \n    # 7. Check for entropy violation\n    return eta_final > eta_initial\n\ndef prim_to_cons(rho, v, p, gamma):\n    \"\"\"Converts primitive variables (rho, v, p) to conservative vector u.\"\"\"\n    m = rho * v\n    E = p / (gamma - 1) + 0.5 * rho * v**2\n    return np.array([rho, m, E])\n\ndef get_pressure(u, gamma):\n    \"\"\"Computes pressure from the conservative state vector.\"\"\"\n    rho, m, E = u\n    if rho <= 0:\n        return -1.0\n    p = (gamma - 1) * (E - 0.5 * m**2 / rho)\n    return p\n\ndef entropy_function(u, gamma):\n    \"\"\"Computes the mathematical entropy eta(u).\"\"\"\n    rho, m, E = u\n    p = get_pressure(u, gamma)\n    if rho <= 0 or p <= 0:\n        # Invalid state, return a large number to signify error\n        return np.inf\n    s = np.log(p) - gamma * np.log(rho)\n    eta = -rho * s / (gamma - 1)\n    return eta\n\ndef find_limiter_theta(u_new, u_safe, gamma, rho_min, p_min):\n    \"\"\"\n    Finds the largest theta in [0, 1] for the positivity-preserving limiter.\n    \"\"\"\n    rho_new, m_new, E_new = u_new\n    rho_safe, m_safe, E_safe = u_safe\n    \n    # --- Density constraint ---\n    theta_rho = 1.0\n    if rho_new < rho_min:\n        if rho_new - rho_safe < -1e-14:\n            theta_rho = (rho_min - rho_safe) / (rho_new - rho_safe)\n        else:\n            return 0.0\n\n    # --- Pressure constraint ---\n    p_new = get_pressure(u_new, gamma)\n    theta_p = 1.0\n    if p_new < p_min:\n        d_rho = rho_new - rho_safe\n        d_m = m_new - m_safe\n        d_E = E_new - E_safe\n        \n        A = 2 * d_rho * d_E - d_m**2\n        B = 2 * (rho_safe * d_E + E_safe * d_rho) - 2 * m_safe * d_m - (2 * p_min / (gamma - 1)) * d_rho\n        C = 2 * rho_safe * E_safe - m_safe**2 - (2 * p_min / (gamma - 1)) * rho_safe\n\n        if C < 0: C = 0\n\n        if abs(A) < 1e-14:\n            if abs(B) > 1e-14:\n                root = -C / B\n                theta_p = root if root > 1e-14 else 0.0\n            else:\n                theta_p = 1.0 if C >= 0 else 0.0\n        else:\n            roots = np.roots([A, B, C])\n            pos_real_roots = sorted([r.real for r in roots if abs(r.imag) < 1e-14 and r.real > 1e-14])\n            if pos_real_roots:\n                theta_p = pos_real_roots[0]\n            else:\n                theta_p = 0.0\n\n    return min(1.0, max(0.0, theta_rho), max(0.0, theta_p))\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3380723"}]}