{"hands_on_practices": [{"introduction": "在谱元法中，函数通常使用两种不同的基来表示：一种是因其数学优雅性而选择的模态基（如勒让德多项式），另一种是因其实用性而选择的插值节点基（如拉格朗日多项式）。本练习将引导您完成推导这两种表示之间转换的基本过程，让您具体理解抽象的模态系数如何与单元上的物理节点值相关联。[@problem_id:3417899]", "problem": "考虑在参考区间 $[-1,1]$ 上、多项式次数为 $p$ 的一维谱元表示。令 $\\{P_{k}(x)\\}_{k=0}^{p}$ 表示经典的勒让德多项式，它们由递推关系和在 $[-1,1]$ 上关于单位权重的正交性定义，并被归一化以使得 $P_{0}(x)=1$，$P_{1}(x)=x$，$P_{2}(x)=\\frac{1}{2}(3x^{2}-1)$，以及 $P_{3}(x)=\\frac{1}{2}(5x^{3}-3x)$。令 $\\{x_{i}\\}_{i=0}^{p}$ 表示高斯-洛巴托-勒让德 (GLL) 点，其定义为端点 $x_{0}=-1$ 和 $x_{p}=1$ 以及作为 $P_{p}'(x)$ 的不同根的 $p-1$ 个内部点。令 $\\{\\ell_{i}(x)\\}_{i=0}^{p}$ 表示在 GLL 点上的拉格朗日基数多项式，即对所有 $i,j$ 都有 $\\ell_{i}(x_{j})=\\delta_{ij}$。\n\n一个次数至多为 $p$ 的多项式 $u(x)$ 可以表示为带有模态系数 $\\{a_{k}\\}$ 的模态勒让德展开 $u(x)=\\sum_{k=0}^{p} a_{k} P_{k}(x)$，或者表示为节点拉格朗日形式 $u(x)=\\sum_{i=0}^{p} u_{i} \\ell_{i}(x)$，其中 $u_{i}=u(x_{i})$ 是在 GLL 点上的节点值。从勒让德多项式和拉格朗日插值的基本定义出发，推导将模态勒让德系数 $\\{a_{k}\\}_{k=0}^{p}$ 映射到 GLL 点上的节点拉格朗日值 $\\{u_{i}\\}_{i=0}^{p}$ 的线性变换。然后，对于在 $[-1,1]$ 上 $p=3$ 的情况，通过确定其每个元素的精确形式来显式计算此变换矩阵。\n\n您的最终答案必须是 $p=3$ 时的 $4\\times 4$ 变换矩阵，以带有精确有理数和根式值的闭合形式写出。不需要也不允许进行四舍五入。", "solution": "用户提供的问题陈述已经过分析，并被认为是有效的。它在科学上基于正交多项式和数值分析的数学理论，问题设定良好，具有唯一且有意义的解，并以客观、正式的语言表达。该问题是自洽的，没有矛盾或歧义。\n\n目标是推导将多项式 $u(x)$ 的模态勒让德系数 $\\{a_{k}\\}_{k=0}^{p}$ 映射到其在高斯-洛巴托-勒让德 (GLL) 点上的节点值 $\\{u_{i}\\}_{i=0}^{p}$ 的线性变换。然后，我们必须为多项式次数为 $p=3$ 的情况显式计算这个变换矩阵。\n\n设 $u(x)$ 为一个次数至多为 $p$ 的多项式。其在勒让德基下的模态表示为\n$$u(x) = \\sum_{k=0}^{p} a_{k} P_{k}(x)$$\n其中 $\\{a_{k}\\}_{k=0}^{p}$ 是模态系数，$\\{P_{k}(x)\\}_{k=0}^{p}$ 是勒让德多项式。\n\n同一多项式的节点表示为\n$$u(x) = \\sum_{j=0}^{p} u_{j} \\ell_{j}(x)$$\n其中 $\\{u_{j}\\}_{j=0}^{p}$ 是 GLL 点 $\\{x_{j}\\}_{j=0}^{p}$ 上的节点值，即 $u_{j} = u(x_{j})$，而 $\\{\\ell_{j}(x)\\}_{j=0}^{p}$ 是满足 $\\ell_{j}(x_{i}) = \\delta_{ij}$ 的拉格朗日基数多项式。\n\n为了找到模态系数 $\\{a_{k}\\}$ 和节点值 $\\{u_{i}\\}$ 之间的关系，我们在每个 GLL 点 $x_{i}$（其中 $i=0, 1, \\dots, p$）上评估模态表示：\n$$u_{i} = u(x_{i}) = \\sum_{k=0}^{p} a_{k} P_{k}(x_{i})$$\n这个方程提供了一个包含 $p+1$ 个线性方程的系统，关联了节点值与模态系数。我们可以用矩阵形式表示这个系统。令 $\\mathbf{u}$ 为节点值的列向量，$\\mathbf{a}$ 为模态系数的列向量：\n$$\\mathbf{u} = \\begin{pmatrix} u_0 \\\\ u_1 \\\\ \\vdots \\\\ u_p \\end{pmatrix}, \\quad \\mathbf{a} = \\begin{pmatrix} a_0 \\\\ a_1 \\\\ \\vdots \\\\ a_p \\end{pmatrix}$$\n线性变换由 $\\mathbf{u} = T \\mathbf{a}$ 给出，其中 $T$ 是 $(p+1) \\times (p+1)$ 的变换矩阵。从求和式中，我们可以确定该矩阵的元素。第 $i$ 个节点值的方程是：\n$$u_i = P_{0}(x_i)a_0 + P_{1}(x_i)a_1 + \\dots + P_{p}(x_i)a_p$$\n因此，矩阵 $T$ 的第 $i$ 行、第 $k$ 列的元素（行和列均使用从0开始的索引）由下式给出：\n$$T_{ik} = P_{k}(x_{i})$$\n\n现在，我们将为 $p=3$ 的情况显式计算这个矩阵。该矩阵将是一个 $4 \\times 4$ 矩阵，其索引 $i, k$ 的范围是从 $0$ 到 $3$。\n\n首先，我们必须确定 GLL 点 $\\{x_i\\}_{i=0}^3$。根据定义，这些点是区间 $[-1, 1]$ 的端点以及 $P_3(x)$ 导数的根。\n勒让德多项式如下：\n$P_0(x) = 1$\n$P_1(x) = x$\n$P_2(x) = \\frac{1}{2}(3x^2 - 1)$\n$P_3(x) = \\frac{1}{2}(5x^3 - 3x)$\n\n$P_3(x)$ 的导数是：\n$$P_3'(x) = \\frac{d}{dx}\\left(\\frac{1}{2}(5x^3 - 3x)\\right) = \\frac{1}{2}(15x^2 - 3)$$\n令 $P_3'(x) = 0$ 来求解内部 GLL 点：\n$$\\frac{1}{2}(15x^2 - 3) = 0 \\implies 15x^2 = 3 \\implies x^2 = \\frac{3}{15} = \\frac{1}{5}$$\n根是 $x = \\pm \\frac{1}{\\sqrt{5}} = \\pm \\frac{\\sqrt{5}}{5}$。\nGLL 点集按从小到大的顺序排列是：\n$x_0 = -1$\n$x_1 = -\\frac{\\sqrt{5}}{5}$\n$x_2 = \\frac{\\sqrt{5}}{5}$\n$x_3 = 1$\n\n接下来，我们通过计算 $k, i \\in \\{0, 1, 2, 3\\}$ 时的 $P_k(x_i)$ 来构造变换矩阵 $T$。\n$$\nT = \\begin{pmatrix}\nP_0(x_0) & P_1(x_0) & P_2(x_0) & P_3(x_0) \\\\\nP_0(x_1) & P_1(x_1) & P_2(x_1) & P_3(x_1) \\\\\nP_0(x_2) & P_1(x_2) & P_2(x_2) & P_3(x_2) \\\\\nP_0(x_3) & P_1(x_3) & P_2(x_3) & P_3(x_3)\n\\end{pmatrix}\n$$\n\n我们来计算每一行的元素：\n\n第1行：$x_0 = -1$。使用一般性质 $P_k(-1) = (-1)^k$：\n$T_{00} = P_0(-1) = 1$\n$T_{01} = P_1(-1) = -1$\n$T_{02} = P_2(-1) = 1$\n$T_{03} = P_3(-1) = -1$\n\n第2行：$x_1 = -\\frac{\\sqrt{5}}{5}$。\n$T_{10} = P_0(-\\frac{\\sqrt{5}}{5}) = 1$\n$T_{11} = P_1(-\\frac{\\sqrt{5}}{5}) = -\\frac{\\sqrt{5}}{5}$\n$T_{12} = P_2(-\\frac{\\sqrt{5}}{5}) = \\frac{1}{2}\\left(3\\left(-\\frac{\\sqrt{5}}{5}\\right)^2 - 1\\right) = \\frac{1}{2}\\left(3\\left(\\frac{5}{25}\\right) - 1\\right) = \\frac{1}{2}\\left(\\frac{3}{5} - 1\\right) = \\frac{1}{2}\\left(-\\frac{2}{5}\\right) = -\\frac{1}{5}$\n$T_{13} = P_3(-\\frac{\\sqrt{5}}{5}) = \\frac{1}{2}\\left(5\\left(-\\frac{\\sqrt{5}}{5}\\right)^3 - 3\\left(-\\frac{\\sqrt{5}}{5}\\right)\\right) = \\frac{1}{2}\\left(5\\left(-\\frac{5\\sqrt{5}}{125}\\right) + \\frac{3\\sqrt{5}}{5}\\right) = \\frac{1}{2}\\left(-\\frac{\\sqrt{5}}{5} + \\frac{3\\sqrt{5}}{5}\\right) = \\frac{1}{2}\\left(\\frac{2\\sqrt{5}}{5}\\right) = \\frac{\\sqrt{5}}{5}$\n\n第3行：$x_2 = \\frac{\\sqrt{5}}{5}$。我们可以使用勒让德多项式的对称性：$P_k(-x) = (-1)^k P_k(x)$。\n$T_{20} = P_0(\\frac{\\sqrt{5}}{5}) = P_0(-\\frac{\\sqrt{5}}{5}) = 1$\n$T_{21} = P_1(\\frac{\\sqrt{5}}{5}) = -P_1(-\\frac{\\sqrt{5}}{5}) = -(-\\frac{\\sqrt{5}}{5}) = \\frac{\\sqrt{5}}{5}$\n$T_{22} = P_2(\\frac{\\sqrt{5}}{5}) = P_2(-\\frac{\\sqrt{5}}{5}) = -\\frac{1}{5}$\n$T_{23} = P_3(\\frac{\\sqrt{5}}{5}) = -P_3(-\\frac{\\sqrt{5}}{5}) = -\\frac{\\sqrt{5}}{5}$\n\n第4行：$x_3 = 1$。使用一般性质 $P_k(1) = 1$：\n$T_{30} = P_0(1) = 1$\n$T_{31} = P_1(1) = 1$\n$T_{32} = P_2(1) = 1$\n$T_{33} = P_3(1) = 1$\n\n将这些计算出的元素组装成矩阵 $T$，得到最终结果：\n$$\nT = \\begin{pmatrix}\n1 & -1 & 1 & -1 \\\\\n1 & -\\frac{\\sqrt{5}}{5} & -\\frac{1}{5} & \\frac{\\sqrt{5}}{5} \\\\\n1 & \\frac{\\sqrt{5}}{5} & -\\frac{1}{5} & -\\frac{\\sqrt{5}}{5} \\\\\n1 & 1 & 1 & 1\n\\end{pmatrix}\n$$\n这就是所求的、用于将 $p=3$ 时的模态勒让德系数映射到节点拉格朗日值的 $4 \\times 4$ 变换矩阵。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 & -1 & 1 & -1 \\\\\n1 & -\\frac{\\sqrt{5}}{5} & -\\frac{1}{5} & \\frac{\\sqrt{5}}{5} \\\\\n1 & \\frac{\\sqrt{5}}{5} & -\\frac{1}{5} & -\\frac{\\sqrt{5}}{5} \\\\\n1 & 1 & 1 & 1\n\\end{pmatrix}\n}\n$$", "id": "3417899"}, {"introduction": "像间断伽辽金谱元法（DG-SEM）这类局部逼近方法的一个显著优势是，它们能够处理具有尖锐特征（如跳跃不连续点）的函数，而不会产生广泛的吉布斯振荡污染。本练习将让您为一个不连续函数构建分段多项式逼近，从而展示这一能力，并说明如何通过将单元边界与跳跃点对齐来控制逼近误差。[@problem_id:3417901]", "problem": "考虑一维域 $[0,1]$ 和在 $x=0.5$ 处有跳跃间断的函数 $f:[0,1]\\to\\mathbb{R}$，定义为\n$$\nf(x)=\\begin{cases}\nx, & 0 \\le x  0.5, \\\\\nx+1,  0.5 \\le x \\le 1.\n\\end{cases}\n$$\n您将构建一个间断伽辽金谱元法（DG-SEM）近似解，该方法使用一个双单元网格将 $[0,1]$ 划分成 $E_{1}=[0,0.5]$ 和 $E_{2}=[0.5,1]$。在每个单元 $E$ 上，使用高斯-洛巴托-勒让德（GLL）节点基底中次数为 $p=3$ 的多项式。参考单元 $[-1,1]$ 上的GLL节点为 $\\xi_{0}=-1$、$\\xi_{1}=-1/\\sqrt{5}$、$\\xi_{2}=1/\\sqrt{5}$ 和 $\\xi_{3}=1$。令 $\\ell_{j}(\\xi)$，$j=0,1,2,3$ 表示相应的拉格朗日基多项式，满足 $\\ell_{j}(\\xi_{i})=\\delta_{ij}$，并通过仿射映射将参考坐标 $\\xi\\in[-1,1]$ 映射到物理坐标 $x\\in E=[x_{L},x_{R}]$\n$$\nx=\\frac{x_{L}+x_{R}}{2}+\\frac{x_{R}-x_{L}}{2}\\,\\xi.\n$$\n在每个单元 $E$ 上，通过以下方式定义局部节点DG-SEM插值：\n$$\nu_{h}^{(E)}(x)=\\sum_{j=0}^{3} f\\!\\left(x(\\xi_{j})\\right)\\,\\ell_{j}\\!\\left(\\xi(x)\\right).\n$$\n任务：\n1. 通过组合在 $[0,0.5]$ 上的局部插值 $u_{h}^{(E_{1})}(x)$ 和在 $[0.5,1]$ 上的局部插值 $u_{h}^{(E_{2})}(x)$，构建在 $[0,1]$ 上的全局DG-SEM近似 $u_{h}(x)$，并将 $u_{h}(x)$ 写成关于 $x$ 的单一显式分段多项式表达式。\n2. 从多项式插值和基函数局部性的第一性原理出发，严格论证为何将间断点与单元界面对齐并使用局部高阶多项式可以减轻吉布斯振荡。\n\n您的最终答案必须是 $u_{h}(x)$ 的显式分段多项式表达式，不带单位。不需要四舍五入。", "solution": "该问题是有效的。这是一个数值分析中适定的问题，具体涉及间断伽辽金谱元法（DG-SEM）。所有提供的数据、定义和条件都是标准的、自洽的且科学上合理的。\n\n该问题包含两部分。首先，我们必须在双单元网格上为给定函数 $f(x)$ 构建分段多项式DG-SEM近似 $u_h(x)$。其次，我们必须为该方法为何能减轻吉布斯振荡提供严格的论证。\n\n### 第1部分：构建DG-SEM近似 $u_h(x)$\n\n全局近似 $u_h(x)$ 是通过将每个单元上的局部多项式插值 $u_h^{(E_1)}(x)$ 和 $u_h^{(E_2)}(x)$ 拼接在一起构建的。\n\n**1. 单元 $E_1 = [0, 0.5]$ 上的近似**\n\n对于第一个单元 $E_1 = [0, 0.5]$，左右边界分别为 $x_L=0$ 和 $x_R=0.5$。从参考坐标 $\\xi \\in [-1,1]$ 到物理坐标 $x \\in E_1$ 的仿射映射为：\n$$\nx(\\xi) = \\frac{0+0.5}{2} + \\frac{0.5-0}{2}\\,\\xi = 0.25 + 0.25\\xi = \\frac{1+\\xi}{4}\n$$\n逆映射为 $\\xi(x) = 4x - 1$。\n\n参考单元上的 $p=3$ GLL节点为 $\\xi_0 = -1$、$\\xi_1 = -1/\\sqrt{5}$、$\\xi_2 = 1/\\sqrt{5}$ 和 $\\xi_3 = 1$。我们将这些节点映射到 $E_1$ 中的物理坐标：\n- $x_0 = x(\\xi_0) = \\frac{1-1}{4} = 0$\n- $x_1 = x(\\xi_1) = \\frac{1 - 1/\\sqrt{5}}{4} \\approx 0.138$\n- $x_2 = x(\\xi_2) = \\frac{1 + 1/\\sqrt{5}}{4} \\approx 0.362$\n- $x_3 = x(\\xi_3) = \\frac{1+1}{4} = 0.5$\n\n接下来，我们在这些节点上计算函数 $f(x)$ 的值。该函数定义为：\n$$\nf(x)=\\begin{cases}\nx,  0 \\le x  0.5 \\\\\nx+1,  0.5 \\le x \\le 1\n\\end{cases}\n$$\n- $f(x_0) = f(0) = 0$\n- $f(x_1) = x_1 = \\frac{1 - 1/\\sqrt{5}}{4}$，因为 $x_1  0.5$。\n- $f(x_2) = x_2 = \\frac{1 + 1/\\sqrt{5}}{4}$，因为 $x_2  0.5$。\n- $f(x_3) = f(0.5) = 0.5 + 1 = 1.5$。\n\n在 $E_1$ 上的局部DG-SEM插值为 $u_h^{(E_1)}(x) = \\sum_{j=0}^{3} f(x_j)\\,\\ell_j(\\xi(x))$，其中 $\\ell_j(\\xi)$ 是GLL节点的拉格朗日多项式。我们可以在参考坐标 $\\xi$ 中表示它：\n$$\nu_h^{(E_1)}(\\xi) = \\sum_{j=0}^{3} f(x_j)\\,\\ell_j(\\xi)\n$$\n我们可以通过注意到对于 $j=0,1,2$，我们有 $f(x_j)=x_j$ 来简化计算。函数 $g(x)=x$ 在参考坐标中对应于 $g(\\xi) = (1+\\xi)/4$。一个1次多项式的3次插值是该多项式本身。让我们分离出在 $x_3=0.5$ 处间断点的贡献。\n$$\nu_h^{(E_1)}(\\xi) = \\left( \\sum_{j=0}^{3} x_j \\ell_j(\\xi) \\right) - x_3 \\ell_3(\\xi) + f(x_3) \\ell_3(\\xi)\n$$\n括号中的和是 $x(\\xi)$ 的精确插值，即 $x(\\xi)$ 本身。\n$$\n\\sum_{j=0}^{3} x_j \\ell_j(\\xi) = x(\\xi) = \\frac{1+\\xi}{4}\n$$\n所以，插值变为：\n$$\nu_h^{(E_1)}(\\xi) = \\frac{1+\\xi}{4} - x_3\\ell_3(\\xi) + f(x_3)\\ell_3(\\xi) = \\frac{1+\\xi}{4} + (f(x_3)-x_3)\\ell_3(\\xi)\n$$\n代入 $x_3 = 0.5$ 和 $f(x_3)=1.5$：\n$$\nu_h^{(E_1)}(\\xi) = \\frac{1+\\xi}{4} + (1.5-0.5)\\ell_3(\\xi) = \\frac{1+\\xi}{4} + \\ell_3(\\xi)\n$$\n对应于节点 $\\xi_3=1$ 的拉格朗日多项式 $\\ell_3(\\xi)$ 是：\n$$\n\\ell_3(\\xi) = \\frac{(\\xi - \\xi_0)(\\xi - \\xi_1)(\\xi - \\xi_2)}{(\\xi_3 - \\xi_0)(\\xi_3 - \\xi_1)(\\xi_3 - \\xi_2)} = \\frac{(\\xi + 1)(\\xi + 1/\\sqrt{5})(\\xi - 1/\\sqrt{5})}{(1 + 1)(1 + 1/\\sqrt{5})(1 - 1/\\sqrt{5})} = \\frac{(\\xi+1)(\\xi^2 - 1/5)}{2(1-1/5)} = \\frac{5}{8}(\\xi^3+\\xi^2-\\frac{1}{5}\\xi-\\frac{1}{5})\n$$\n$$\n\\ell_3(\\xi) = \\frac{1}{8}(5\\xi^3 + 5\\xi^2 - \\xi - 1)\n$$\n将此代入 $u_h^{(E_1)}(\\xi)$ 的表达式中：\n$$\nu_h^{(E_1)}(\\xi) = \\frac{2}{8}(1+\\xi) + \\frac{1}{8}(5\\xi^3 + 5\\xi^2 - \\xi - 1) = \\frac{1}{8}(5\\xi^3 + 5\\xi^2 + \\xi + 1)\n$$\n最后，我们使用 $\\xi = 4x-1$ 转换回物理坐标 $x$：\n$$\nu_h^{(E_1)}(x) = \\frac{1}{8}(5(4x-1)^3 + 5(4x-1)^2 + (4x-1) + 1)\n$$\n$$\nu_h^{(E_1)}(x) = \\frac{1}{8}(5(64x^3 - 48x^2 + 12x - 1) + 5(16x^2 - 8x + 1) + 4x)\n$$\n$$\nu_h^{(E_1)}(x) = \\frac{1}{8}(320x^3 - 240x^2 + 60x - 5 + 80x^2 - 40x + 5 + 4x)\n$$\n$$\nu_h^{(E_1)}(x) = \\frac{1}{8}(320x^3 - 160x^2 + 24x) = 40x^3 - 20x^2 + 3x\n$$\n此表达式在 $x \\in E_1 = [0, 0.5]$ 上有效。\n\n**2. 单元 $E_2 = [0.5, 1]$ 上的近似**\n\n对于第二个单元 $E_2 = [0.5, 1]$，我们有 $x_L=0.5$ 和 $x_R=1$。仿射映射为：\n$$\nx(\\xi) = \\frac{0.5+1}{2} + \\frac{1-0.5}{2}\\,\\xi = 0.75 + 0.25\\xi = \\frac{3+\\xi}{4}\n$$\n逆映射为 $\\xi(x) = 4x - 3$。\n物理GLL节点为 $x_j = x(\\xi_j)$。对于任意点 $x \\in [0.5, 1]$，函数为 $f(x)=x+1$。因此，对于此单元中的所有节点 $x_j$，我们有 $f(x_j)=x_j+1$。\n局部插值为 $u_h^{(E_2)}(x) = \\sum_{j=0}^{3} f(x_j)\\,\\ell_j(\\xi(x))$。在参考坐标中：\n$$\nu_h^{(E_2)}(\\xi) = \\sum_{j=0}^{3} (x_j+1)\\,\\ell_j(\\xi)\n$$\n根据插值的线性性质，这是 $x(\\xi)$ 的插值和 $1$ 的插值的和：\n$$\nu_h^{(E_2)}(\\xi) = \\left(\\sum_{j=0}^{3} x_j \\ell_j(\\xi)\\right) + \\left(\\sum_{j=0}^{3} 1 \\cdot \\ell_j(\\xi)\\right)\n$$\n由于 $x(\\xi)=\\frac{3+\\xi}{4}$ 和 $1$ 都是次数 $\\le 3$ 的多项式，它们的插值是精确的。\n$$\nu_h^{(E_2)}(\\xi) = x(\\xi) + 1 = \\frac{3+\\xi}{4} + 1 = \\frac{7+\\xi}{4}\n$$\n使用 $\\xi = 4x-3$ 转换回物理坐标 $x$：\n$$\nu_h^{(E_2)}(x) = \\frac{7+(4x-3)}{4} = \\frac{4x+4}{4} = x+1\n$$\n此表达式在 $x \\in E_2 = [0.5, 1]$ 上有效。\n\n**3. 全局近似 $u_h(x)$**\n\n全局DG-SEM近似 $u_h(x)$ 是由局部插值定义的分段函数：\n$$\nu_h(x) = \\begin{cases}\nu_h^{(E_1)}(x),  x \\in [0, 0.5] \\\\\nu_h^{(E_2)}(x),  x \\in (0.5, 1]\n\\end{cases}\n$$\n在界面 $x=0.5$ 处，我们检查两边的值：\n- $u_h^{(E_1)}(0.5) = 40(0.5)^3 - 20(0.5)^2 + 3(0.5) = 40(1/8) - 20(1/4) + 1.5 = 5 - 5 + 1.5 = 1.5$。\n- $u_h^{(E_2)}(0.5) = 0.5+1 = 1.5$。\n由于数值匹配，得到的全局近似 $u_h(x)$ 是连续的。我们可以根据 $f(x)$ 定义中的域划分写出最终表达式。\n\n### 第2部分：减轻吉布斯振荡的论证\n\n在DG-SEM框架中，吉布斯振荡的减轻，特别是当网格与间断点对齐时，源于近似基的局部性原理。\n\n1.  **全局近似中的吉布斯现象：** 当一个带有跳跃间断的函数被一个由光滑、全局支撑的基函数（如傅里叶级数或单个高次多项式）组成的截断级数近似时，就会出现吉布斯现象。用光滑函数表示急剧跳跃的尝试迫使近似解在间断点附近产生伪振荡。这些振荡的幅度不会随着基函数数量的增加而衰减；它们只是在空间上向跳跃点压缩。\n\n2.  **DG-SEM的局部性：** DG-SEM方法从根本上采用了“分而治之”的策略。区域被划分为不重叠单元的网格。在每个单元上，解由一个局部多项式近似，该多项式由支撑域仅限于该单个单元的基函数（例如，拉格朗日多项式）构建。全局解是这些局部多项式的分段集合。\n\n3.  **利用网格对齐：** 这个问题的关键步骤是，在 $x=0.5$ 处的单元界面与函数 $f(x)$ 的跳跃间断点特意对齐。这确保了*在每个单元的内部*，函数 $f(x)$ 是解析的（无限可微）。\n    -   在单元 $E_1=[0, 0.5]$ 上，函数是 $f(x)=x$（暂时忽略端点）。\n    -   在单元 $E_2=[0.5, 1]$ 上，函数是 $f(x)=x+1$。\n\n4.  **振荡的遏制：** 让我们分别分析每个单元上的近似。\n    -   在 $E_2=[0.5, 1]$ 上，要插值的函数是 $f(x)=x+1$，一个1次多项式。次数 $p=3$ 的多项式插值是精确的：$u_h^{(E_2)}(x) = x+1$。在这个单元上，误差为零，因此没有振荡。\n    -   在 $E_1=[0, 0.5]$ 上，情况更为微妙。当 $x \\in [0, 0.5)$ 时，函数为 $f(x)=x$，但插值是使用右端点的节点值 $f(0.5)=1.5$ 构建的。这个值属于跳跃的另一边。因此，在 $E_1$ 上的插值是在一组并非来自单个光滑函数的采样点上进行的。这种不匹配迫使所得多项式 $u_h^{(E_1)}(x) = 40x^3 - 20x^2 + 3x$ 偏离了底层的光滑函数 $g(x)=x$。单元上的误差 $E(x) = u_h^{(E_1)}(x) - x$ 表现出振荡。这是一种局部的吉布斯现象。\n    -   然而，关键在于**遏制**。因为与单元 $E_1$ 相关联的拉格朗日基函数对于所有 $x \\notin E_1$ 均为零，所以 $u_h^{(E_1)}(x)$ 的振荡行为被严格限制在区间 $[0, 0.5]$ 内。它不会传播到或“污染”单元 $E_2$ 上的近似解。\n\n5.  **结论：** 通过将网格与间断点对齐，DG-SEM并没有消除吉布斯现象的根本原因（用光滑多项式逼近非光滑特征），但它严格地将其影响局部化。振荡被遏制在与跳跃相邻的单个单元内。在函数光滑的单元中，近似可以达到高（谱）精度。这种遏制是DG-SEM如何减轻吉布斯振荡的精髓：它防止振荡污染整个域的解，而这个问题困扰着基于全局基函数的方法。", "answer": "$$\n\\boxed{\nu_{h}(x) = \\begin{cases} 40x^3 - 20x^2 + 3x,  0 \\le x  0.5 \\\\ x+1,  0.5 \\le x \\le 1 \\end{cases}\n}\n$$", "id": "3417901"}, {"introduction": "高效地计算导数是用谱元法求解偏微分方程的核心。本练习将理论与高性能计算相结合，引导您构建一维微分矩阵，并将其应用于三维问题中，采用一种无矩阵的张量积策略，这是现代谱元法代码的基石。[@problem_id:3417928]", "problem": "考虑一维参考区间 $[-1,1]$ 上使用 Gauss–Lobatto–Legendre 点的谱元法。令 $p$ 表示多项式阶数，令 $N=p+1$ 表示插值点（包括端点）的数量。一维插值基由相对于 Gauss–Lobatto–Legendre 点 $x_i\\in[-1,1]$ 定义的 Lagrange 多项式 $L_i(x)$（$i=0,\\dots,N-1$）组成。Gauss–Lobatto–Legendre 点由端点 $x_0=-1$、$x_{N-1}=1$ 给出，内部节点是 $p$ 阶 Legendre 多项式导数的零点，记为 $P_p'(x)=0$。Gauss–Lobatto–Legendre 求积权重 $w_i$ 满足恒等式 $w_i0$（$i=0,\\dots,N-1$），且该求积对于最高为 $2p-1$ 阶的多项式是精确的。\n\n从建立在不同节点集 $\\{x_0,\\dots,x_{N-1}\\}$ 上的 Lagrange 插值多项式 $L_i(x)$ 的定义出发，一维微分矩阵 $D\\in\\mathbb{R}^{N\\times N}$ 定义为 $D_{ij}=L_j'(x_i)$，其中 $L_j'(x)$ 表示 $L_j(x)$ 相对于 $x$ 的导数。在具有坐标 $(\\xi,\\eta,\\zeta)$ 的三维参考六面体 $[-1,1]^3$ 中，谱元张量积基为 $L_i(\\xi) L_j(\\eta) L_k(\\zeta)$。在三维 Gauss–Lobatto–Legendre 网格 $\\{(\\xi_i,\\eta_j,\\zeta_k)\\}_{i,j,k=0}^{N-1}$ 上采样的任何节点场 $u(\\xi,\\eta,\\zeta)$ 都可以通过沿每个坐标方向张量積应用一维微分矩阵来求导，以获得梯度分量 $\\partial u/\\partial \\xi$、$\\partial u/\\partial \\eta$ 和 $\\partial u/\\partial \\zeta$。\n\n你的任务是：\n\n1. 从涉及 Legendre 多项式 $P_p(x)$ 及其导数 $P_p'(x)$ 的定义出发，在 $[-1,1]$ 上为 $p=4$ 构建 Gauss–Lobatto–Legendre 节点 $\\{x_i\\}_{i=0}^{N-1}$ 和求积权重 $\\{w_i\\}_{i=0}^{N-1}$。\n2. 仅使用不同节点集上 Lagrange 插值多项式的定义，推导并组装一维微分矩阵 $D\\in\\mathbb{R}^{N\\times N}$，使得对于 $i,j=0,\\dots,N-1$，有 $D_{ij}=L_j'(x_i)$。\n3. 展示一维微分矩阵的张量积如何在参考六面体 $[-1,1]^3$ 上形成三维梯度，并实现一个无矩阵（matrix-free）的计算策略（即，沿每个轴应用一维矩阵，而不组装全局三维微分算子），以在所有 Gauss–Lobatto–Legendre 网格点上为一个 $p=4$（因此每个轴向 $N=5$）的六面体单元计算 $\\nabla u=(\\partial u/\\partial \\xi,\\partial u/\\partial \\eta,\\partial u/\\partial \\zeta)$。\n\n角度必须以弧度解释。不需要物理单位。\n\n为进行验证，对定义在参考单元上的以下四个测试场 $u(\\xi,\\eta,\\zeta)$ 计算无矩阵梯度：\n\n- 测试 A（常数场）：$u(\\xi,\\eta,\\zeta)=3.14$。\n- 测试 B（每个坐标最高 $p$ 阶的多项式场）：$u(\\xi,\\eta,\\zeta)=\\xi^4+\\eta^3+\\zeta^2$。\n- 测试 C（光滑非多项式场）：$u(\\xi,\\eta,\\zeta)=\\sin(\\xi)\\cos(\\eta)e^{\\zeta}$。\n- 测试 D（各向异性混合场）：$u(\\xi,\\eta,\\zeta)=\\xi\\eta+\\eta\\zeta^4+\\cos(\\xi+\\eta+\\zeta)$。\n\n对于每个测试，在参考单元上解析计算精确梯度，并将其与通过无矩阵张量积计算得到的数值梯度进行比较。对于每个测试，报告一个浮点数，该数等于所有网格点和所有三个梯度分量上的最大绝对误差，即\n$$\nE=\\max_{i,j,k\\in\\{0,\\dots,N-1\\}} \\max\\left( \\left|\\frac{\\partial u}{\\partial \\xi}(\\xi_i,\\eta_j,\\zeta_k) - \\left(\\frac{\\partial u}{\\partial \\xi}\\right)_{\\text{num}}(\\xi_i,\\eta_j,\\zeta_k)\\right|, \\left|\\frac{\\partial u}{\\partial \\eta}(\\xi_i,\\eta_j,\\zeta_k) - \\left(\\frac{\\partial u}{\\partial \\eta}\\right)_{\\text{num}}(\\xi_i,\\eta_j,\\zeta_k)\\right|, \\left|\\frac{\\partial u}{\\partial \\zeta}(\\xi_i,\\eta_j,\\zeta_k) - \\left(\\frac{\\partial u}{\\partial \\zeta}\\right)_{\\text{num}}(\\xi_i,\\eta_j,\\zeta_k)\\right| \\right).\n$$\n\n你的程序应生成单行输出，其中包含四个结果 $[E_A,E_B,E_C,E_D]$，以逗号分隔列表的形式置于方括号内，顺序分别为测试 A、B、C 和 D。", "solution": "该问题要求在三维参考六面体 $[-1,1]^3$ 上，针对 $p=4$ 的多项式阶数，实现并验证一种用于谱元法的无矩阵梯度算子。这涉及三个主要任务：(1) 确定 Gauss–Lobatto–Legendre (GLL) 节点和求积权重，(2) 构造一维微分矩阵，(3) 实现基于张量积的梯度计算并与解析解进行测试。\n\n**第一部分：$p=4$ 时的 Gauss–Lobatto–Legendre 节点和权重**\n\n对于多项式阶数 $p$，谱元法在参考区间 $[-1,1]$ 上使用 $N=p+1$ 个插值点。对于 $p=4$，我们有 $N=5$ 个点。这些点是 Gauss–Lobatto–Legendre (GLL) 节点。它们由区间的端点 $x_0=-1$ 和 $x_{N-1}=1$ 以及 $p$ 阶 Legendre 多项式导数的根组成。\n\n$p=4$ 阶的 Legendre 多项式由 Rodrigues 公式给出：\n$$ P_4(x) = \\frac{1}{2^4 4!} \\frac{d^4}{dx^4}(x^2-1)^4 = \\frac{1}{8}(35x^4 - 30x^2 + 3) $$\n其导数 $P_4'(x)$ 为：\n$$ P_4'(x) = \\frac{d}{dx} \\left( \\frac{1}{8}(35x^4 - 30x^2 + 3) \\right) = \\frac{1}{8}(140x^3 - 60x) = \\frac{5}{2}x(7x^2-3) $$\n内部 GLL 节点是 $P_4'(x)=0$ 的根，即：\n$$ x(7x^2-3)=0 \\implies x=0, \\quad x = \\pm\\sqrt{\\frac{3}{7}} $$\n将这些内部节点与端点 $\\{-1, 1\\}$ 合并并排序，我们得到 $p=4$ 时的五个 GLL 节点，记为 $\\{\\xi_i\\}_{i=0}^4$：\n$$ \\xi_0 = -1, \\quad \\xi_1 = -\\sqrt{\\frac{3}{7}}, \\quad \\xi_2 = 0, \\quad \\xi_3 = \\sqrt{\\frac{3}{7}}, \\quad \\xi_4 = 1 $$\n\n相应的 GLL 求积权重 $w_i$ 由以下公式给出：\n$$ w_i = \\frac{2}{p(p+1)[P_p(\\xi_i)]^2} $$\n对于 $p=4$，这变为 $w_i = \\frac{2}{4(5)[P_4(\\xi_i)]^2} = \\frac{1}{10[P_4(\\xi_i)]^2}$。我们在每个节点 $\\xi_i$ 上计算 $P_4(x)$ 的值：\n- $P_4(\\pm 1) = \\frac{1}{8}(35-30+3) = \\frac{8}{8} = 1$\n- $P_4(\\pm\\sqrt{3/7}) = \\frac{1}{8}\\left(35\\left(\\frac{3}{7}\\right)^2 - 30\\left(\\frac{3}{7}\\right) + 3\\right) = \\frac{1}{8}\\left(\\frac{35 \\cdot 9}{49} - \\frac{90}{7} + 3\\right) = \\frac{1}{8}\\left(\\frac{45}{7} - \\frac{90}{7} + \\frac{21}{7}\\right) = \\frac{-24}{56} = -\\frac{3}{7}$\n- $P_4(0) = \\frac{3}{8}$\n\n现在，我们计算权重：\n- $w_0 = w_4 = \\frac{1}{10[P_4(\\pm 1)]^2} = \\frac{1}{10(1)^2} = \\frac{1}{10}$\n- $w_1 = w_3 = \\frac{1}{10[P_4(\\pm\\sqrt{3/7})]^2} = \\frac{1}{10(-3/7)^2} = \\frac{1}{10(9/49)} = \\frac{49}{90}$\n- $w_2 = \\frac{1}{10[P_4(0)]^2} = \\frac{1}{10(3/8)^2} = \\frac{1}{10(9/64)} = \\frac{64}{90} = \\frac{32}{45}$\n\n权重之和为 $\\sum w_i = 2 \\cdot \\frac{1}{10} + 2 \\cdot \\frac{49}{90} + \\frac{64}{90} = \\frac{18}{90} + \\frac{98}{90} + \\frac{64}{90} = \\frac{180}{90} = 2$，这等于 $\\int_{-1}^1 1 \\, dx$，与预期相符。\n\n**第二部分：一维微分矩阵**\n\n一维微分矩阵 $D \\in \\mathbb{R}^{N \\times N}$ 的元素为 $D_{ij} = L_j'(\\xi_i)$，其中 $L_j(x)$ 是与节点 $\\xi_j$ 相关的 Lagrange 插值多项式。对于 GLL 节点的特定情况，$D$ 的元素有众所周知的解析公式。对于在 $N=p+1$ 个节点 $\\{\\xi_i\\}_{i=0}^p$ 上的 $p$ 阶多项式基：\n$$\nD_{ij} =\n\\begin{cases}\n\\frac{P_p(\\xi_i)}{P_p(\\xi_j)(\\xi_i - \\xi_j)}  i \\neq j \\\\\n-\\frac{p(p+1)}{4}  i=j=0 \\\\\n\\frac{p(p+1)}{4}  i=j=p \\\\\n0  \\text{otherwise for } i=j\n\\end{cases}\n$$\n对于 $p=4$，我们有 $N=5$，索引 $i,j$ 的范围为 $\\{0, 1, 2, 3, 4\\}$。对角线元素为：\n- $D_{00} = -\\frac{4(5)}{4} = -5$\n- $D_{44} = \\frac{4(5)}{4} = 5$\n- $D_{11} = D_{22} = D_{33} = 0$\n\n非对角线元素 $D_{ij}$ 使用上述公式以及先前计算的 $\\xi_i$ 和 $P_4(\\xi_i)$ 值来计算。例如：\n- $D_{01} = \\frac{P_4(\\xi_0)}{P_4(\\xi_1)(\\xi_0 - \\xi_1)} = \\frac{1}{(-3/7)(-1 - (-\\sqrt{3/7}))} = \\frac{7}{3(1-\\sqrt{3/7})}$\n- $D_{10} = \\frac{P_4(\\xi_1)}{P_4(\\xi_0)(\\xi_1 - \\xi_0)} = \\frac{-3/7}{1(-\\sqrt{3/7} - (-1))} = \\frac{-3}{7(1-\\sqrt{3/7})}$\n完整的 $5 \\times 5$ 矩阵 $D$ 将在附带的代码中进行数值组装。该矩阵的一个关键特性是每行之和为零，即对于所有 $i$，$\\sum_{j=0}^{N-1} D_{ij} = 0$，因为常数函数（由全为1的向量表示）的导数为零。\n\n**第三部分：无矩阵三维梯度计算**\n\n在三维空间中，参考六面体 $[-1,1]^3$ 上的函数 $u(\\xi, \\eta, \\zeta)$ 使用张量积基进行近似：\n$$ u^h(\\xi, \\eta, \\zeta) = \\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1}\\sum_{k=0}^{N-1} U_{ijk} L_i(\\xi) L_j(\\eta) L_k(\\zeta) $$\n其中 $U_{ijk} = u(\\xi_i, \\eta_j, \\zeta_k)$ 是函数在 GLL 点的 $N \\times N \\times N$ 网格上的值。\n\n为了计算在网格点 $(\\xi_a, \\eta_b, \\zeta_c)$ 处关于 $\\xi$ 的偏导数，我们有：\n$$ \\frac{\\partial u^h}{\\partial \\xi}(\\xi_a, \\eta_b, \\zeta_c) = \\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1}\\sum_{k=0}^{N-1} U_{ijk} L_i'(\\xi_a) L_j(\\eta_b) L_k(\\zeta_c) $$\n利用 Lagrange 多项式的性质 $L_j(x_b) = \\delta_{jb}$，表达式简化为：\n$$ \\frac{\\partial u^h}{\\partial \\xi}(\\xi_a, \\eta_b, \\zeta_c) = \\sum_{i=0}^{N-1} U_{ibc} L_i'(\\xi_a) = \\sum_{i=0}^{N-1} D_{ai} U_{ibc} $$\n这表明，通过将一维微分矩阵 $D$ 应用于三维数据数组 $U$ 的第一维（$\\xi$ 轴），可以找到所有网格点上关于 $\\xi$ 的导数。令 $(G_\\xi)_{abc}$ 表示在点 $(\\xi_a, \\eta_b, \\zeta_c)$ 处关于 $\\xi$ 的数值导数。所有三个梯度分量的操作如下：\n- $\\displaystyle (G_\\xi)_{abc} = \\sum_{i=0}^{N-1} D_{ai} U_{ibc}$\n- $\\displaystyle (G_\\eta)_{abc} = \\sum_{j=0}^{N-1} D_{bj} U_{ajc}$\n- $\\displaystyle (G_\\zeta)_{abc} = \\sum_{k=0}^{N-1} D_{ck} U_{abk}$\n\n“无矩阵”策略避免了组装全局 $N^3 \\times N^3$ 微分算子。取而代之的是，我们将 $U$ 存储为一个 $N \\times N \\times N$ 数组，并沿每个维度相继应用小的 $N \\times N$ 矩阵 $D$。这在计算上是高效的，并且需要的内存要少得多。在 NumPy 中，这些张量缩并可以使用 `np.einsum` 优雅地实现。\n\n最后，对于每个测试用例，我们使用此方法计算数值梯度数组 $G_\\xi$、$G_\\eta$、$G_\\zeta$。然后，我们在 GLL 网格上计算解析梯度，以获得精确梯度数组 $G_{\\xi, \\text{exact}}$、$G_{\\eta, \\text{exact}}$、$G_{\\zeta, \\text{exact}}$。误差 $E$ 是数值和精确值在所有网格点和所有三个分量上的最大绝对差，如问题陈述中所定义。对于测试 A（常数）和测试 B（阶数 $\\le p$ 的多项式），谱微分是精确的，因此误差预计处于机器浮点精度的水平。对于包含非多项式项的测试 C 和 D，误差反映了谱元法的插值误差。\n\n```python\nimport numpy as np\nfrom scipy.special import legendre, eval_legendre\n\ndef solve():\n    \"\"\"\n    Solves the spectral element problem for p=4.\n    1. Computes GLL nodes and the 1D differentiation matrix.\n    2. Implements a matrix-free 3D gradient operator.\n    3. Evaluates the maximum error for four test cases.\n    \"\"\"\n    p = 4\n    N = p + 1\n\n    def gll_nodes_and_weights(p_deg):\n        \"\"\"\n        Computes Gauss-Lobatto-Legendre nodes and weights for a given polynomial degree p.\n        \"\"\"\n        N_pts = p_deg + 1\n        # Internal nodes are roots of P_p'(x)\n        P_p = legendre(p_deg)\n        P_p_prime = P_p.deriv()\n        internal_nodes = np.sort(P_p_prime.roots)\n\n        # Full set of nodes including endpoints\n        nodes = np.zeros(N_pts)\n        nodes[0] = -1.0\n        nodes[N_pts-1] = 1.0\n        nodes[1:-1] = internal_nodes\n        \n        # Weights\n        weights = 2.0 / (p_deg * (p_deg + 1) * (eval_legendre(p_deg, nodes))**2)\n        \n        return nodes, weights\n\n    def differentiation_matrix(p_deg, nodes):\n        \"\"\"\n        Computes the 1D differentiation matrix for GLL nodes.\n        \"\"\"\n        N_pts = p_deg + 1\n        D = np.zeros((N_pts, N_pts))\n        p_vals = eval_legendre(p_deg, nodes)\n\n        for i in range(N_pts):\n            for j in range(N_pts):\n                if i != j:\n                    D[i, j] = p_vals[i] / (p_vals[j] * (nodes[i] - nodes[j]))\n                else:\n                    if i == 0:\n                        D[i, j] = -p_deg * (p_deg + 1) / 4.0\n                    elif i == N_pts - 1:\n                        D[i, j] = p_deg * (p_deg + 1) / 4.0\n                    else:\n                        D[i, j] = 0.0\n        return D\n\n    # 1. Construct GLL nodes and differentiation matrix for p=4\n    gll_nodes, _ = gll_nodes_and_weights(p)\n    D = differentiation_matrix(p, gll_nodes)\n\n    # 2. Set up the 3D grid\n    xi_grid, eta_grid, zeta_grid = np.meshgrid(gll_nodes, gll_nodes, gll_nodes, indexing='ij')\n\n    # 3. Define test cases\n    test_cases = [\n        {\n            \"name\": \"A\",\n            \"u_func\": lambda xi, eta, zeta: 3.14 + 0*xi,\n            \"grad_u_exact\": lambda xi, eta, zeta: (0*xi, 0*eta, 0*zeta),\n        },\n        {\n            \"name\": \"B\",\n            \"u_func\": lambda xi, eta, zeta: xi**4 + eta**3 + zeta**2,\n            \"grad_u_exact\": lambda xi, eta, zeta: (4*xi**3, 3*eta**2, 2*zeta),\n        },\n        {\n            \"name\": \"C\",\n            \"u_func\": lambda xi, eta, zeta: np.sin(xi) * np.cos(eta) * np.exp(zeta),\n            \"grad_u_exact\": lambda xi, eta, zeta: (\n                np.cos(xi) * np.cos(eta) * np.exp(zeta),\n                -np.sin(xi) * np.sin(eta) * np.exp(zeta),\n                np.sin(xi) * np.cos(eta) * np.exp(zeta),\n            ),\n        },\n        {\n            \"name\": \"D\",\n            \"u_func\": lambda xi, eta, zeta: xi*eta + eta*zeta**4 + np.cos(xi+eta+zeta),\n            \"grad_u_exact\": lambda xi, eta, zeta: (\n                eta - np.sin(xi+eta+zeta),\n                xi + zeta**4 - np.sin(xi+eta+zeta),\n                4*eta*zeta**3 - np.sin(xi+eta+zeta),\n            ),\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # Evaluate function on the grid\n        U = case[\"u_func\"](xi_grid, eta_grid, zeta_grid)\n\n        # Compute numerical gradient using matrix-free tensor products (einsum)\n        G_xi_num = np.einsum('ai,ijk-ajk', D, U)\n        G_eta_num = np.einsum('bj,ijk-ibk', D, U)\n        G_zeta_num = np.einsum('ck,ijk-ijc', D, U)\n\n        # Evaluate exact analytical gradient on the grid\n        G_xi_exact, G_eta_exact, G_zeta_exact = case[\"grad_u_exact\"](xi_grid, eta_grid, zeta_grid)\n\n        # Calculate errors\n        err_xi = np.abs(G_xi_num - G_xi_exact)\n        err_eta = np.abs(G_eta_num - G_eta_exact)\n        err_zeta = np.abs(G_zeta_num - G_zeta_exact)\n\n        # Find the maximum error over all components and all grid points\n        max_error = np.max([np.max(err_xi), np.max(err_eta), np.max(err_zeta)])\n        results.append(max_error)\n\n    # Final print statement in the exact required format.\n    # print(f\"[{','.join(map(str, results))}]\") # This line is for local execution\n    return results\n\n# results = solve() # This would be called to generate the answer\n```", "answer": "[0.0,3.552713678800501e-15,0.0001047683955610816,0.0004944883489814466]", "id": "3417928"}]}