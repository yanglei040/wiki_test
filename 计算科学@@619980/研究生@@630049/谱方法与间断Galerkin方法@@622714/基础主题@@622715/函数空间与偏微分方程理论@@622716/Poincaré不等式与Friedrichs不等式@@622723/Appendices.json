{"hands_on_practices": [{"introduction": "我们从一个基础的解析练习开始，它揭示了庞加莱常数与一个相关的微分算子特征值之间的深刻联系。通过求解一维拉普拉斯算子在两种不同边界约束（狄利克雷边界条件和零均值诺伊曼边界条件）下的特征值问题，你将亲手推导出精确的庞加莱常数。这个练习不仅能巩固你对变分法和斯图姆-刘维尔理论的理解，而且是掌握庞加莱不等式定量分析的基石。[@problem_id:3408698]", "problem": "设 $L0$，考虑具有标准勒贝格测度的区间 $(0,L)$ 以及索伯列夫空间 $H^{1}(0,L)$ 和 $H_{0}^{1}(0,L)$。在许多谱方法和间断伽辽金（DG）方法中，稳定性和条件数取决于可以追溯到庞加莱型不等式的最优矫顽性常数和连续性常数。定义瑞利商\n$$\n\\mathcal{R}[u] \\;=\\; \\frac{\\int_{0}^{L} |u'(x)|^{2}\\,dx}{\\int_{0}^{L} |u(x)|^{2}\\,dx},\n$$\n于两个不同的约束集上：\n(i) 狄利克雷集 $H_{0}^{1}(0,L)\\setminus\\{0\\}$，\n和 (ii) 零均值诺伊曼集 $\\{u\\in H^{1}(0,L): \\int_{0}^{L} u(x)\\,dx = 0\\}\\setminus\\{0\\}$。从一维拉普拉斯算子最小正特征值的变分刻画出发，利用变分法，推导在每个约束集上最小化 $\\mathcal{R}[u]$ 所关联的欧拉-拉格朗日边值问题，求解所得的边值问题，并确定每种情况下的最小正特征值。利用这些结果来确定庞加莱不等式\n$$\n\\|u\\|_{L^{2}(0,L)} \\;\\le\\; C_{D}\\,\\|u'\\|_{L^{2}(0,L)} \\quad \\text{for all } u\\in H_{0}^{1}(0,L),\n$$\n和\n$$\n\\|u\\|_{L^{2}(0,L)} \\;\\le\\; C_{N}\\,\\|u'\\|_{L^{2}(0,L)} \\quad \\text{for all } u\\in H^{1}(0,L) \\text{ with } \\int_{0}^{L} u(x)\\,dx = 0,\n$$\n中的最优（sharp）常数 $C_{D}$ 和 $C_{N}$，并通过给出极值函数来证明这两种表述下的最优性。将最终结果表示为一个单行矩阵，其中按顺序包含狄利克雷问题的最小正特征值、零均值诺伊曼问题的最小正特征值、最优狄利克雷-庞加莱常数以及最优零均值诺伊曼-庞加莱常数。无需数值近似；请提供精确的符号表达式。", "solution": "该问题要求推导在区间 $(0,L)$ 上两种不同函数空间的最优庞加莱常数。这可以通过求解瑞利商的最小值来实现，该最小值对应于在相应边界条件下的一维拉普拉斯算子的最小正特征值。\n\n瑞利商由下式给出\n$$\n\\mathcal{R}[u] = \\frac{\\int_{0}^{L} |u'(x)|^{2}\\,dx}{\\int_{0}^{L} |u(x)|^{2}\\,dx} = \\frac{\\|u'\\|_{L^{2}(0,L)}^{2}}{\\|u\\|_{L^{2}(0,L)}^{2}}\n$$\n最小化该商等价于在约束条件 $\\int_{0}^{L} |u(x)|^{2}\\,dx = 1$ 下寻找泛函 $J[u] = \\int_{0}^{L} |u'(x)|^{2}\\,dx$ 的驻点。$\\mathcal{R}[u]$ 的最小值是相关特征值问题的最小特征值 $\\lambda$。泛函 $F[u, u'] = (u')^2 - \\lambda u^2$ 的欧拉-拉格朗日方程为\n$$\n\\frac{\\partial F}{\\partial u} - \\frac{d}{dx}\\frac{\\partial F}{\\partial u'} = 0\n$$\n$$\n-2\\lambda u - \\frac{d}{dx}(2u') = 0\n$$\n该方程可简化为标准的一维亥姆霍兹方程：\n$$\n-u''(x) = \\lambda u(x)\n$$\n边界条件由具体的函数空间（约束集）确定。\n\n### 情况 (i)：狄利克雷集 $H_{0}^{1}(0,L)\\setminus\\{0\\}$\n对于这种情况，函数 $u$ 属于 $H_0^1(0,L)$，这意味着它们满足齐次狄利克雷边界条件 $u(0)=0$ 和 $u(L)=0$。变分原理应用于空间 $H_0^1(0,L)$，因此检验函数也满足这些边界条件。该最小化问题对应于求解以下边值问题（BVP）的最小正特征值 $\\lambda$：\n$$\n-u''(x) = \\lambda u(x), \\quad x \\in (0,L)\n$$\n$$\nu(0) = 0, \\quad u(L) = 0\n$$\n当 $\\lambda  0$ 时，微分方程的通解为\n$$\nu(x) = A\\sin(\\sqrt{\\lambda}x) + B\\cos(\\sqrt{\\lambda}x)\n$$\n应用边界条件：\n1.  $u(0) = 0 \\implies A\\sin(0) + B\\cos(0) = 0 \\implies B=0$。\n解的形式为 $u(x) = A\\sin(\\sqrt{\\lambda}x)$。\n2.  $u(L) = 0 \\implies A\\sin(\\sqrt{\\lambda}L) = 0$。\n为得到非平凡解（$u \\not\\equiv 0$），我们必须有 $A \\ne 0$。这要求 $\\sin(\\sqrt{\\lambda}L) = 0$。\n如果 $\\sqrt{\\lambda}L = k\\pi$（对于任何非零整数 $k$），则该条件满足。我们考虑正整数 $k=1, 2, 3, \\ldots$ 以获得正特征值。\n特征值为 $\\lambda_k = \\left(\\frac{k\\pi}{L}\\right)^2$，其中 $k=1, 2, \\ldots$。\n我们记最小正特征值为 $\\lambda_{min,D}$，它对应于 $k=1$：\n$$\n\\lambda_{min,D} = \\left(\\frac{\\pi}{L}\\right)^2\n$$\n相关的特征函数为 $u_1(x) = \\sin(\\frac{\\pi x}{L})$。\n\n庞加莱不等式为 $\\|u\\|_{L^{2}(0,L)} \\le C_{D}\\,\\|u'\\|_{L^{2}(0,L)}$。两边平方并重新整理得到 $C_D^2 \\ge \\frac{\\|u\\|_{L^{2}}^{2}}{\\|u'\\|_{L^{2}}^{2}}$。最优常数 $C_D$ 是该比值的最大值，它由瑞利商最小值的倒数给出。\n$$\nC_D^2 = \\sup_{u \\in H_0^1(0,L)\\setminus\\{0\\}} \\frac{\\|u\\|_{L^{2}}^{2}}{\\|u'\\|_{L^{2}}^{2}} = \\frac{1}{\\inf_{u \\in H_0^1(0,L)\\setminus\\{0\\}} \\mathcal{R}[u]} = \\frac{1}{\\lambda_{min,D}}\n$$\n因此，最优常数 $C_D$ 为：\n$$\nC_D = \\frac{1}{\\sqrt{\\lambda_{min,D}}} = \\frac{1}{\\sqrt{(\\pi/L)^2}} = \\frac{L}{\\pi}\n$$\n其最优性是合理的，因为对于特征函数 $u(x) = \\sin(\\frac{\\pi x}{L})$，等号成立。\n\n### 情况 (ii)：零均值诺伊曼集 $\\{u\\in H^{1}(0,L): \\int_{0}^{L} u(x)\\,dx = 0\\}\\setminus\\{0\\}$\n对于这种情况，我们在均值为零的 $H^1(0,L)$ 函数空间上最小化 $\\mathcal{R}[u]$。这是一个约束优化问题。我们寻求在两个约束条件：$\\int_0^L |u(x)|^2 dx = 1$（不失一般性）和 $\\int_0^L u(x) dx = 0$ 下，$\\int_0^L |u'(x)|^2 dx$ 的最小值。我们使用拉格朗日乘子法。拉格朗日泛函为：\n$$\n\\mathcal{L}[u] = \\int_0^L \\left( |u'(x)|^2 - \\lambda |u(x)|^2 - \\mu u(x) \\right) dx\n$$\n其中 $\\lambda$ 和 $\\mu$ 是拉格朗日乘子。一阶变分必须为零，即 $\\delta\\mathcal{L}=0$。\n$$\n\\delta\\mathcal{L} = \\int_0^L \\left( 2u'\\delta u' - 2\\lambda u\\delta u - \\mu\\delta u \\right) dx = 0\n$$\n对第一项进行分部积分得到：\n$$\n[2u'\\delta u]_0^L - \\int_0^L \\left( 2u'' + 2\\lambda u + \\mu \\right) \\delta u \\, dx = 0\n$$\n由于函数空间是 $H^1(0,L)$，对 $u$ 没有预设的边界条件，因此变分 $\\delta u$ 在 $x=0$ 和 $x=L$ 处可以是任意的。这迫使边界项消失，从而导出自然边界条件：\n$$\nu'(0) = 0, \\quad u'(L) = 0\n$$\n欧拉-拉格朗日方程为 $-2u'' - 2\\lambda u - \\mu = 0$，或\n$$\n-u''(x) = \\lambda u(x) + \\frac{\\mu}{2}\n$$\n我们可以确定乘子 $\\mu$。将欧拉-拉格朗日方程从 $0$ 积分到 $L$：\n$$\n\\int_0^L -u''(x) dx = \\int_0^L \\left(\\lambda u(x) + \\frac{\\mu}{2}\\right) dx\n$$\n$$\n-[u'(x)]_0^L = \\lambda \\int_0^L u(x) dx + \\int_0^L \\frac{\\mu}{2} dx\n$$\n使用自然边界条件 $u'(L)-u'(0)=0$ 和问题约束 $\\int_0^L u(x)dx=0$：\n$$\n0 = \\lambda(0) + \\frac{\\mu}{2}L \\implies \\mu L = 0\n$$\n因为 $L0$，我们必须有 $\\mu=0$。该边值问题简化为在零均值函数空间上寻找诺伊曼问题的特征值：\n$$\n-u''(x) = \\lambda u(x), \\quad x \\in (0,L)\n$$\n$$\nu'(0) = 0, \\quad u'(L) = 0\n$$\n并且我们必须强制执行约束 $\\int_0^L u(x) dx = 0$。\n通解仍然是 $u(x) = A\\sin(\\sqrt{\\lambda}x) + B\\cos(\\sqrt{\\lambda}x)$。\n其导数为 $u'(x) = A\\sqrt{\\lambda}\\cos(\\sqrt{\\lambda}x) - B\\sqrt{\\lambda}\\sin(\\sqrt{\\lambda}x)$。\n应用边界条件：\n1.  $u'(0)=0 \\implies A\\sqrt{\\lambda}\\cos(0) - B\\sqrt{\\lambda}\\sin(0) = 0 \\implies A\\sqrt{\\lambda}=0$。\n    如果 $\\lambda=0$，微分方程为 $-u''=0$，解得 $u(x)=ax+b$。$u'(x)=a$。边界条件 $u'(0)=u'(L)=0$ 意味着 $a=0$，所以 $u(x)=b$（一个常数）。约束条件 $\\int_0^L b\\,dx = bL = 0$ 意味着 $b=0$。因此，$\\lambda=0$ 对应于平凡解 $u \\equiv 0$，这在我们的集合中被排除了。我们关心的是正特征值，所以可以假设 $\\lambda \\ne 0$，这意味着 $A=0$。\n    解的形式为 $u(x) = B\\cos(\\sqrt{\\lambda}x)$。\n2.  $u'(L)=0 \\implies -B\\sqrt{\\lambda}\\sin(\\sqrt{\\lambda}L) = 0$。\n    为得到非平凡解，$B \\ne 0$ 且 $\\lambda \\ne 0$。这要求 $\\sin(\\sqrt{\\lambda}L)=0$，所以 $\\sqrt{\\lambda}L = k\\pi$，其中 $k=1, 2, 3, \\ldots$。\n特征值为 $\\lambda_k = \\left(\\frac{k\\pi}{L}\\right)^2$，对应的特征函数为 $u_k(x) = \\cos(\\frac{k\\pi x}{L})$。\n现在我们检查这些特征函数的零均值约束：\n$$\n\\int_0^L \\cos\\left(\\frac{k\\pi x}{L}\\right) dx = \\left[\\frac{L}{k\\pi}\\sin\\left(\\frac{k\\pi x}{L}\\right)\\right]_0^L = \\frac{L}{k\\pi}(\\sin(k\\pi) - \\sin(0)) = 0\n$$\n对于所有 $k=1, 2, \\ldots$，此约束都得到满足。\n我们记最小正特征值为 $\\lambda_{min,N}$，它对应于 $k=1$：\n$$\n\\lambda_{min,N} = \\left(\\frac{\\pi}{L}\\right)^2\n$$\n相关的极值函数是 $u_1(x) = \\cos(\\frac{\\pi x}{L})$。\n最优庞加莱常数 $C_N$ 的求法与狄利克雷情况类似：\n$$\nC_N^2 = \\sup_{u} \\frac{\\|u\\|_{L^{2}}^{2}}{\\|u'\\|_{L^{2}}^{2}} = \\frac{1}{\\inf_{u} \\mathcal{R}[u]} = \\frac{1}{\\lambda_{min,N}}\n$$\n$$\nC_N = \\frac{1}{\\sqrt{\\lambda_{min,N}}} = \\frac{1}{\\sqrt{(\\pi/L)^2}} = \\frac{L}{\\pi}\n$$\n其最优性是合理的，因为对于函数 $u(x)=\\cos(\\frac{\\pi x}{L})$，等号成立。\n\n最终结果是：\n- 狄利克雷问题的最小正特征值：$\\lambda_{min,D} = \\frac{\\pi^2}{L^2}$。\n- 零均值诺伊曼问题的最小正特征值：$\\lambda_{min,N} = \\frac{\\pi^2}{L^2}$。\n- 最优狄利克雷-庞加莱常数：$C_D = \\frac{L}{\\pi}$。\n- 最优零均值诺伊曼-庞加莱常数：$C_N = \\frac{L}{\\pi}$。\n\n我们将这四个量以单行矩阵的形式报告。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{\\pi^{2}}{L^{2}}  \\frac{\\pi^{2}}{L^{2}}  \\frac{L}{\\pi}  \\frac{L}{\\pi}\n\\end{pmatrix}\n}\n$$", "id": "3408698"}, {"introduction": "掌握了一维情况后，让我们将视野扩展到更高维度，并通过一个思想实验来培养几何直觉。在二维环形区域上，弗里德里希不等式中的常数如何依赖于狄利克雷边界条件的位置？这个练习将挑战你运用基本原理进行定性推理，理解区域的几何形状和边界条件的设置对稳定性常数的关键影响。这种直觉对于在复杂几何体上设计稳健的数值方法至关重要。[@problem_id:3408692]", "problem": "考虑环形域 $$\\Omega=\\left\\{x\\in\\mathbb{R}^2:\\ r_i  |x|  r_o\\right\\}$$。考虑两种不同的齐次狄利克雷边界条件设置：\n(a) 仅在内边界 $\\Gamma_i = \\{x:|x|=r_i\\}$ 上施加 $u=0$。\n(b) 仅在外边界 $\\Gamma_o = \\{x:|x|=r_o\\}$ 上施加 $u=0$。\n设 $C_a$ 和 $C_b$ 分别是与情况 (a) 和 (b) 对应的弗里德里希不等式 $\\|u\\|_{L^2(\\Omega)} \\le C \\|\\nabla u\\|_{L^2(\\Omega)}$ 中的最优常数。这两个常数之间的关系是什么？\n\nA) $C_a > C_b$\n\nB) $C_a  C_b$\n\nC) $C_a = C_b$\n\nD) 关系取决于$r_i$和$r_o$的具体比值", "solution": "这个问题要求我们定性地比较在同一个环形域 $\\Omega$ 上，但在不同边界部分施加齐次狄利克雷条件时，弗里德里希斯不等式中的最优常数。\n\n最优弗里德里希斯常数 $C$ 与相应拉普拉斯算子特征值问题（带有指定的齐次狄利克雷边界条件）的第一个（最小的）特征值 $\\lambda_1$ 直接相关，关系式为 $C = 1/\\sqrt{\\lambda_1}$。因此，比较 $C_a$ 和 $C_b$ 就等价于比较两种情况下各自的最小特征值 $\\lambda_{1,a}$ 和 $\\lambda_{1,b}$。常数 $C$ 越大，对应的 $\\lambda_1$ 就越小，反之亦然。\n\n从物理角度来看，$\\lambda_1$ 可以被看作是系统振动的基频的平方，它衡量了系统的“刚度”或“约束强度”。约束越“强”，函数被“压制”得越厉害，其振动所需的能量就越高，从而特征值越大，对应的常数越小。\n\n现在我们来比较这两种约束的“强度”：\n\n- **情况 (a)**：函数在内边界 $\\Gamma_i$ 上被固定为零。这意味着函数可以在外边界 $\\Gamma_o$ 附近自由取值。\n- **情况 (b)**：函数在外边界 $\\Gamma_o$ 上被固定为零。这意味着函数在整个环形域都被一个外部的零值边界所包围。\n\n直观上，将函数固定在包围整个区域的外边界上，是一种比仅固定在内部边界上更强的约束。想象一个被困在圆形监狱里的囚犯。如果监狱的外墙是坚固的（情况b），他的活动范围就受到了根本性的限制。如果只是中心的一个小柱子是固定的（情况a），他仍然可以在广阔的外围区域活动。\n\n同样地，对于定义在环形域上的函数，情况 (b) 的约束更强，因为它限制了函数在更大范围内的行为。一个更强的约束意味着需要更多的“能量”（梯度范数的平方）才能使函数产生显著的“位移”（$L^2$范数的平方）。这直接转化为一个更大的瑞利商最小值，即更大的 $\\lambda_1$。\n\n因此，我们可以推断出 $\\lambda_{1,b} > \\lambda_{1,a}$。\n\n由于 $C = 1/\\sqrt{\\lambda_1}$，$\\lambda_1$ 越大则 $C$ 越小。所以，我们有 $C_b  C_a$。\n\n这个结论可以通过变分原理（瑞利-里兹方法）更严格地表述。定义在情况 (b) 下的容许函数空间（在 $\\Gamma_o$ 上为零）是定义在情况 (a) 下的容许函数空间（在 $\\Gamma_i$ 上为零）的子集吗？不，它们不是彼此的子集。但是，我们可以通过考虑特征值问题的域单调性来思考。或者，直接从瑞利商的定义出发：为了使瑞利商变小（即特征值变小），我们需要一个能够使 $L^2$ 范数相对较大而梯度范数相对较小的函数。在情况 (a) 中，我们可以构造一个主要在外边界附近取值非零的函数，这个函数可以相对“平坦”地延伸到广阔的外部区域，从而可能实现较小的瑞利商。而在情况 (b) 中，函数在外部被钉死，任何显著的非零值都必须在内外边界之间“拱起”，这通常需要更大的梯度。\n\n综上所述，约束 (b) 比约束 (a) 更强，导致 $\\lambda_{1,b} > \\lambda_{1,a}$，从而 $C_b  C_a$。所以正确答案是 $C_a > C_b$。\n\n最终选择是 A，因为它对应于结论 $C_a > C_b$。", "answer": "$$\\boxed{A}$$", "id": "3408692"}, {"introduction": "最后，我们将理论与实际计算联系起来，通过一个编程练习来探索离散世界中的庞加莱不等式。你将实现一个间断伽辽金（DG）方法，用于数值计算离散庞加莱常数，并研究施加不同类型约束（全局零均值与单元零均值）所带来的影响。这个实践将让你直接体验抽象的稳定性常数在有限元框架中是如何被量化和评估的，从而将理论分析与数值实现紧密地结合在一起。[@problem_id:3408679]", "problem": "考虑一维域 $\\Omega=(0,1)$，它被划分为 $E$ 个均匀单元 $\\{K_e\\}_{e=0}^{E-1}$，每个单元的长度为 $h=1/E$。在每个单元 $K_e$ 上，使用定义在参考区间 $\\hat{x}\\in[-1,1]$ 上的 $p$ 次勒让德多项式基 $\\{P_k(\\hat{x})\\}_{k=0}^{p}$，通过仿射映射到 $K_e$ 来逼近函数 $u$。设全局近似函数为单元展开的拼接，单元之间不强制连续性，如同在间断伽辽金（DG）方法中一样。\n\n定义函数 $u$ 的对称内部罚（Symmetric Interior Penalty, SIP）DG能量半范数为\n$$\n\\lVert u \\rVert_{E}^{2} = \\sum_{e=0}^{E-1} \\int_{K_e} \\left| \\frac{du}{dx} \\right|^{2} \\, dx \\;+\\; \\sum_{f\\in\\mathcal{F}_h} \\frac{\\sigma}{h_f}\\,[u]_{f}^{2},\n$$\n其中 $\\mathcal{F}_h$ 是内部交界面的集合，$h_f$ 是交界面 $f$ 处的局部网格尺寸，$[u]_f = u^{-}(x_f) - u^{+}(x_f)$ 是 $u$ 在 $f$ 处的跳跃，其中 $u^{-}$ 和 $u^{+}$ 分别表示来自左侧和右侧单元的迹。在物理边界上，没有罚项贡献。令 $\\lVert u \\rVert$ 表示 $u$ 的 $L^{2}(\\Omega)$ 范数，即 $\\lVert u \\rVert^{2} = \\int_{\\Omega} |u|^{2}\\,dx$。\n\n目标是量化在SIP-DG框架内，施加全局零均值约束 $\\int_{\\Omega} u\\,dx = 0$ 与施加单元零均值约束（对所有 $e$ 均有 $\\int_{K_e} u\\,dx = 0$）相比，如何改变离散庞加莱型不等式\n$$\n\\lVert u \\rVert \\le C_{P}\\,\\lVert u \\rVert_{E},\n$$\n中的最佳常数 $C_{P}$。在由最高 $p$ 次的单元勒让德基张成的有限维空间中进行计算，并选择罚参数为 $\\sigma = 20\\,(p+1)^{2}$，这是对称内部罚（SIP）中保证矫顽性的一个典型稳健尺度。\n\n您必须组装离散的 $L^{2}$ 质量矩阵 $M$ 和对应于半范数 $\\lVert \\cdot \\rVert_{E}$ 的SIP-DG能量矩阵 $A$，并使用足够高阶的高斯-勒让德求积法来精确积分所需的多项式乘积。组装过程必须遵守：\n- 对于每个单元 $K_e$，通过映射到参考区间并考虑雅可比因子来计算贡献 $\\int_{K_e} |u'|^{2}\\,dx$，以及\n- 对于 $K_e$ 和 $K_{e+1}$ 之间的每个内部交界面，将罚跳跃贡献 $\\frac{\\sigma}{h}\\,[u]^2$ 展开为来自两个相邻单元的迹上的双线性形式贡献。\n\n为了比较这些约束，通过以下方式限制离散空间：\n- 全局零均值：强制 $\\int_{\\Omega} u\\,dx = 0$。\n- 单元零均值：对每个单元 $e$ 强制 $\\int_{K_e} u\\,dx = 0$。\n\n在每个受约束的子空间内，通过计算满足约束的非零离散函数上的 $L^{2}$范数与能量范数之比的瑞利商的最大值，来确定上述不等式中定义的最优常数 $C_{P}$。在数值上，这需要构建并求解一个适当的约束广义特征值问题，其中对称半正定矩阵 $A$ 和对称正定矩阵 $M$ 被限制在约束子空间上。使用数学上合理的方法，通过约束算子的零空间的一组基来消除约束。\n\n您的程序必须实现这种构造，并提供数值证据，说明 $C_{P}$ 如何随多项式次数 $p$ 和约束类型而变化。使用以下参数值测试套件：\n- 测试 1：$E=8$，$p=1$，全局零均值。\n- 测试 2：$E=8$，$p=1$，单元零均值。\n- 测试 3：$E=8$，$p=3$，全局零均值。\n- 测试 4：$E=8$，$p=3$，单元零均值。\n- 测试 5：$E=1$，$p=3$，全局零均值。\n- 测试 6：$E=1$，$p=3$，单元零均值。\n- 测试 7：$E=4$，$p=7$，全局零均值。\n- 测试 8：$E=4$，$p=7$，单元零均值。\n\n无物理单位适用；所有量均为无量纲。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如 $[c_{1},c_{2},\\dots,c_{8}]$，其中每个 $c_{i}$ 是对应测试的 $C_{P}$ 的数值，以浮点数形式报告，并四舍五入到六位小数。", "solution": "该问题要求在两种不同的均值约束下，为间断伽辽金（DG）有限元空间中的函数，计算离散庞加莱型不等式 $\\lVert u \\rVert \\le C_{P}\\,\\lVert u \\rVert_{E}$ 中的最优常数 $C_P$。常数 $C_P$ 由底层定义域、函数空间以及特定的DG格式的属性决定。\n\n首先，确认问题陈述的有效性。该问题是适定的，在偏微分方程数值分析领域具有科学依据，并提供了一套完整且一致的定义和参数。它代表了DG方法研究中的一个标准数值实验。该解决方案遵循了寻找最优常数 $C_P$ 的正确方法，即将其确定为相应瑞利商的上确界。在数学上，这对应于找到矩阵束的最大广义特征值，具体如下详述。\n\n解决方案是一个用Python实现的数值程序。该方法的核心涉及构建代表 $L^2$ 内积和DG能量半范数的双线性形式的矩阵，然后求解一个约束广义特征值问题。\n\n**1. 离散化与函数空间**\n域 $\\Omega=(0,1)$被均匀划分为 $E$ 个尺寸为 $h=1/E$ 的单元 $K_e$。在每个单元上，函数由次数最多为 $p$ 的多项式逼近。参考单元 $\\hat{K}=[-1,1]$ 上的基函数是勒让德多项式 $\\{P_k(\\hat{x})\\}_{k=0}^p$。这些基函数通过仿射映射变换到每个物理单元 $K_e$ 上。\nDG空间中的函数 $u$ 由一个全局系数向量 $\\mathbf{u}$ 表示。总自由度（DoFs）数量为 $N_{dof} = E \\times (p+1)$。\n\n**2. 矩阵表示**\n问题 $\\lVert u \\rVert^2 \\le C_P^2 \\lVert u \\rVert_E^2$ 被转化为矩阵问题 $\\mathbf{u}^T M \\mathbf{u} \\le C_P^2 \\mathbf{u}^T A \\mathbf{u}$，其中 $M$ 是对应于 $L^2$ 范数 $\\lVert \\cdot \\rVert^2$ 的质量矩阵，而 $A$ 是来自DG半范数 $\\lVert \\cdot \\rVert_E^2$ 的刚度/能量矩阵。\n最优常数 $C_P^2$ 是瑞利商 $\\frac{\\mathbf{u}^T M \\mathbf{u}}{\\mathbf{u}^T A \\mathbf{u}}$ 在所有允许的非零函数 $u$ 上的最大值。这等价于广义特征值问题 $M\\mathbf{u} = \\lambda A\\mathbf{u}$ 的最大特征值 $\\lambda_{\\max}$。因此，$C_P = \\sqrt{\\lambda_{\\max}}$。\n\n**2.1. 质量矩阵 ($M$)**\n质量矩阵 $M$ 由 $(M)_{ij} = \\int_\\Omega \\phi_i \\phi_j dx$ 定义，其中 $\\phi_i, \\phi_j$ 是全局基函数。由于基函数的局部支撑性，$M$ 是块对角矩阵。每个块 $M_e$ 对应一个单元 $K_e$。利用仿射映射和勒让德多项式的正交性，单元质量矩阵是对角阵：\n$$\n(M_e)_{kl} = \\int_{K_e} \\phi_{e,k} \\phi_{e,l} \\,dx = \\frac{h}{2} \\int_{-1}^1 P_k(\\hat{x}) P_l(\\hat{x}) \\,d\\hat{x} = \\frac{h}{2k+1} \\delta_{kl}\n$$\n其中 $\\delta_{kl}$ 是克罗内克δ函数。\n\n**2.2. 能量矩阵 ($A$)**\n能量矩阵 $A$ 对应于与半范数 $\\lVert\\cdot\\rVert_E^2$ 相关联的双线性形式 $a(u,v)$。\n$$\na(u,v) = \\sum_{e=0}^{E-1} \\int_{K_e} \\frac{du}{dx} \\frac{dv}{dx} \\, dx \\;+\\; \\sum_{f\\in\\mathcal{F}_h} \\frac{\\sigma}{h_f}\\,[u]_{f}\\,[v]_{f}\n$$\n该矩阵由两部分组成：来自单元积分的刚度部分和来自交界面跳跃的罚项部分。\n单元刚度矩阵为：\n$$\n(A_{\\text{stiff},e})_{kl} = \\int_{K_e} \\frac{d\\phi_{e,k}}{dx} \\frac{d\\phi_{e,l}}{dx} \\,dx = \\frac{2}{h} \\int_{-1}^1 P'_k(\\hat{x}) P'_l(\\hat{x}) \\,d\\hat{x}\n$$\n这些积分使用 $p+2$ 阶的高斯-勒让德求积法进行数值计算，这足以实现精确积分。\n位于单元 $K_{e-1}$ 和 $K_e$ 之间的交界面 $x_f$ 处的罚项对这两个单元对应的矩阵块有贡献。跳跃为 $[u]_f = u^-(x_f) - u^+(x_f)$。迹的计算使用 $u^-(x_f) = \\sum_k u_{e-1,k} P_k(1)$ 和 $u^+(x_f) = \\sum_l u_{e,l} P_l(-1)$。这导致了罚矩阵贡献中的一种块结构。对于每个交界面，我们在全局矩阵 $A$ 的相应对角块上添加一个秩1更新矩阵，并在非对角块上添加对称更新。\n\n**3. 约束的实现**\n该问题要求比较两种类型的零均值约束，这些约束在求解特征值问题之前施加于向量空间上。\n\n**3.1. 单元零均值约束**\n对于所有 $e$，约束 $\\int_{K_e} u\\,dx = 0$ 简化为 $u_{e,0} = 0$，其中 $u_{e,0}$ 是单元 $e$ 上常数基函数 $P_0$ 的系数。这通过从每个单元的展开中移除 $P_0$ 基函数来实现。问题在一个维度为 $E \\times p$ 的较小空间上重新构建，该空间由每个单元上的 $\\{P_k\\}_{k=1}^p$ 张成。矩阵 $M$ 和 $A$ 直接为这个简化的基构建。\n\n**3.2. 全局零均值约束**\n约束 $\\int_\\Omega u\\,dx = 0$ 转化为系数上的一个线性方程：$\\sum_{e=0}^{E-1} u_{e,0} = 0$。该约束定义了一个维度为 $N_{dof}-1$ 的子空间。为了在该子空间中求解特征值问题，我们首先找到约束算子零空间的一组标准正交基。设该基由矩阵 $N$ 的列向量表示。任何满足约束的向量 $\\mathbf{u}$ 都可以写成 $\\mathbf{u} = N\\mathbf{y}$。原始问题 $M\\mathbf{u} = \\lambda A\\mathbf{u}$ 变换为一个投影广义特征值问题 $\\tilde{M}\\mathbf{y} = \\lambda \\tilde{A}\\mathbf{y}$，其中 $\\tilde{M} = N^T M N$ 且 $\\tilde{A} = N^T A N$。然后求解这个降维后的问题。\n\n**4. 求解特征值问题**\n对于两种约束类型，在构建了相应的最终矩阵（我们称之为 $M_{proj}$ 和 $A_{proj}$）之后，使用 `scipy.linalg.eigh` 计算 $M_{proj}\\mathbf{v} = \\lambda A_{proj}\\mathbf{v}$ 的最大特征值 $\\lambda_{\\max}$。然后常数 $C_P = \\sqrt{\\lambda_{\\max}}$。约束确保了半范数的零空间（常数函数）被移除，因此矩阵 $A_{proj}$ 是正定的，使得广义特征值问题是适定的。$E=1$ 的特殊情况得到了一致的处理；在这种情况下，由于只有一个单元，两种约束是等价的。\n\n这种结构化方法使得可以系统地计算问题中指定的每个测试用例的庞加莱常数。", "answer": "```python\nimport numpy as np\nfrom scipy.special import legendre\nfrom scipy.linalg import eigh, null_space\nfrom numpy.polynomial.legendre import leggauss\n\ndef compute_legendre_basis_data(p, n_quad_pts):\n    \"\"\"\n    Computes data related to Legendre basis on the reference element [-1, 1].\n\n    Returns:\n        tuple: Quadrature points, weights, and basis function values/derivatives.\n    \"\"\"\n    xq, wq = leggauss(n_quad_pts)\n\n    basis = [legendre(k) for k in range(p + 1)]\n    basis_derivs = [P.deriv() for P in basis]\n\n    phi_at_xq = np.array([P(xq) for P in basis])\n    dphi_at_xq = np.array([d_P(xq) for d_P in basis_derivs])\n    \n    phi_at_m1 = np.array([P(-1.) for P in basis]) \n    phi_at_p1 = np.array([P(1.) for P in basis]) \n\n    return xq, wq, phi_at_xq, dphi_at_xq, phi_at_m1, phi_at_p1\n\ndef compute_cp(E, p, constraint_type):\n    \"\"\"\n    Computes the discrete Poincaré constant C_P for given parameters.\n    \"\"\"\n    h = 1.0 / E\n    sigma = 20.0 * (p + 1)**2\n    # Use p+2 quadrature points for exactness of up to degree 2(p+1)-1 > 2p\n    n_quad_pts = p + 2\n\n    # Get reference element data\n    xq, wq, phi_at_xq, dphi_at_xq, phi_at_m1, phi_at_p1 = compute_legendre_basis_data(p, n_quad_pts)\n\n    if constraint_type == 'elementwise':\n        dofs_per_elem = p\n        if p == 0:\n            return 0.0\n            \n        total_dofs = E * dofs_per_elem\n\n        # Skip k=0 basis function data for the reduced space\n        ref_dphi_at_xq = dphi_at_xq[1:, :]\n        ref_phi_at_m1 = phi_at_m1[1:]\n        ref_phi_at_p1 = phi_at_p1[1:]\n        \n        M_elem = np.zeros((dofs_per_elem, dofs_per_elem))\n        for k in range(dofs_per_elem):\n            # Legendre index is k+1\n            M_elem[k, k] = h / (2 * (k + 1) + 1)\n\n        A_stiff_elem = (2.0 / h) * (ref_dphi_at_xq @ np.diag(wq) @ ref_dphi_at_xq.T)\n\n        M = np.zeros((total_dofs, total_dofs))\n        A = np.zeros((total_dofs, total_dofs))\n\n        for e in range(E):\n            s, e_ = e * dofs_per_elem, (e + 1) * dofs_per_elem\n            M[s:e_, s:e_] = M_elem\n            A[s:e_, s:e_] = A_stiff_elem\n\n        if E > 1:\n            pen_fac = sigma / h\n            rrT = np.outer(ref_phi_at_p1, ref_phi_at_p1)\n            ssT = np.outer(ref_phi_at_m1, ref_phi_at_m1)\n            rsT = np.outer(ref_phi_at_p1, ref_phi_at_m1)\n            srT = rsT.T\n\n            for e in range(1, E):\n                ps, pe = (e - 1) * dofs_per_elem, e * dofs_per_elem\n                cs, ce = e * dofs_per_elem, (e + 1) * dofs_per_elem\n                \n                A[ps:pe, ps:pe] += pen_fac * rrT\n                A[cs:ce, cs:ce] += pen_fac * ssT\n                A[ps:pe, cs:ce] -= pen_fac * rsT\n                A[cs:ce, ps:pe] -= pen_fac * srT\n        \n        if np.allclose(A, 0):\n            return np.inf\n\n        eigenvalues = eigh(M, A, eigvals_only=True)\n        lambda_max = eigenvalues[-1]\n\n    elif constraint_type == 'global':\n        dofs_per_elem = p + 1\n        total_dofs = E * dofs_per_elem\n        \n        if total_dofs == 1:\n            return 0.0\n\n        M_elem = np.zeros((dofs_per_elem, dofs_per_elem))\n        for k in range(dofs_per_elem):\n            M_elem[k, k] = h / (2 * k + 1)\n        \n        A_stiff_elem = (2.0 / h) * (dphi_at_xq @ np.diag(wq) @ dphi_at_xq.T)\n\n        M = np.zeros((total_dofs, total_dofs))\n        A = np.zeros((total_dofs, total_dofs))\n\n        for e in range(E):\n            s, e_ = e * dofs_per_elem, (e + 1) * dofs_per_elem\n            M[s:e_, s:e_] = M_elem\n            A[s:e_, s:e_] = A_stiff_elem\n\n        if E > 1:\n            pen_fac = sigma / h\n            rrT = np.outer(phi_at_p1, phi_at_p1)\n            ssT = np.outer(phi_at_m1, phi_at_m1)\n            rsT = np.outer(phi_at_p1, phi_at_m1)\n            srT = rsT.T\n\n            for e in range(1, E):\n                ps, pe = (e - 1) * dofs_per_elem, e * dofs_per_elem\n                cs, ce = e * dofs_per_elem, (e + 1) * dofs_per_elem\n\n                A[ps:pe, ps:pe] += pen_fac * rrT\n                A[cs:ce, cs:ce] += pen_fac * ssT\n                A[ps:pe, cs:ce] -= pen_fac * rsT\n                A[cs:ce, ps:pe] -= pen_fac * srT\n        \n        c_vec = np.zeros((1, total_dofs))\n        c_vec[0, ::dofs_per_elem] = 1.0\n        \n        N = null_space(c_vec)\n\n        if N.shape[1] == 0:\n            return 0.0\n\n        M_proj = N.T @ M @ N\n        A_proj = N.T @ A @ N\n        \n        eigenvalues = eigh(M_proj, A_proj, eigvals_only=True)\n        lambda_max = eigenvalues[-1]\n\n    else:\n        raise ValueError(\"Unknown constraint type\")\n\n    if lambda_max  0:\n        return np.nan\n        \n    return np.sqrt(lambda_max)\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        {'E': 8, 'p': 1, 'constraint': 'global'},\n        {'E': 8, 'p': 1, 'constraint': 'elementwise'},\n        {'E': 8, 'p': 3, 'constraint': 'global'},\n        {'E': 8, 'p': 3, 'constraint': 'elementwise'},\n        {'E': 1, 'p': 3, 'constraint': 'global'},\n        {'E': 1, 'p': 3, 'constraint': 'elementwise'},\n        {'E': 4, 'p': 7, 'constraint': 'global'},\n        {'E': 4, 'p': 7, 'constraint': 'elementwise'},\n    ]\n\n    results = []\n    for case in test_cases:\n        cp = compute_cp(case['E'], case['p'], case['constraint'])\n        results.append(f\"{cp:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3408679"}]}