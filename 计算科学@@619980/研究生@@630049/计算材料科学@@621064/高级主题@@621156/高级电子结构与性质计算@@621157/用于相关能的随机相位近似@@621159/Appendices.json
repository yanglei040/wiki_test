{"hands_on_practices": [{"introduction": "在周期性体系中，随机相位近似（RPA）的数值计算面临一个核心挑战：库仑相互作用在倒易空间中存在$1/|\\mathbf{q}|^2$的发散。然而，对于绝缘体，独立的粒子响应函数 $\\chi_0$ 在长波极限（$|\\mathbf{q}| \\to 0$）下具有特殊的解析行为，这恰好可以抵消库仑发散，从而得到一个有限的被积函数。这项练习将引导您从解析上理解处理这一奇异性的物理基础，这是在布里渊区上进行精确且稳定数值积分的关键一步 [@problem_id:3484849]。", "problem": "考虑一个三维周期性绝缘晶体。在随机相近似（RPA）中，相关能可以通过绝热连接涨落-耗散定理（ACFDT）写成一个对布里渊区内波矢量的积分和一个对虚频的积分，其被积函数是无相互作用密度响应函数和库仑相互作用的泛函。在倒易空间中，库仑相互作用的矩阵元为 $v_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q}) = \\dfrac{4\\pi\\,\\delta_{\\mathbf{G}\\mathbf{G}'}}{|\\mathbf{q}+\\mathbf{G}|^2}$，因此当 $\\mathbf{q}\\to \\mathbf{0}$ 时，头元素 $v_{00}(\\mathbf{q})$ 以 $4\\pi/|\\mathbf{q}|^2$ 的形式发散。设无相互作用密度响应函数表示为 $\\chi_0(\\mathbf{q},\\mathbf{G},\\mathbf{G}', i\\omega)$，其中 $i\\omega$ 是虚频，并假设晶体是绝缘体，那么 $\\chi_0$ 的头部长波展开具有以下形式\n$$\n\\chi_{0,00}(\\mathbf{q},i\\omega) = \\boldsymbol{\\alpha}(i\\omega) : \\left(\\frac{\\mathbf{q}\\mathbf{q}}{|\\mathbf{q}|^2}\\right)\\,|\\mathbf{q}|^2 + \\mathcal{O}(|\\mathbf{q}|^4),\n$$\n其中 $\\boldsymbol{\\alpha}(i\\omega)$ 是单位体积的二阶极化率张量，$:$ 表示双点积。在绝缘体情况下，$\\chi_0$ 的翼（wings）和体（body）部分随 $|\\mathbf{q}|$ 的更高次幂变化。\n\n从 RPA 相关能的 ACFDT 定义出发，并考虑由 $v$ 和 $\\chi_0$ 及其头元素构成的被积函数的结构，完成以下任务：\n\n1. 利用所述的 $\\chi_{0,00}(\\mathbf{q},i\\omega)$ 在小 $|\\mathbf{q}|$ 时的行为以及 $v_{00}(\\mathbf{q})$ 的发散性，证明在 $\\mathbf{q}\\to \\mathbf{0}$ 极限下，布里渊区积分的被积函数中的头贡献是有限的。推导其以 $\\boldsymbol{\\alpha}(i\\omega)$ 表示的前导小 $|\\mathbf{q}|$ 形式，并求出此表达式对于立方晶体的各向同性球面平均值。\n\n2. 基于你的推导，为 RPA 被积函数中的头贡献在 $\\mathbf{q}\\to \\mathbf{0}$ 区域提出一种科学上合理的解析处理方法，以避免数值不稳定性和慢收敛，并解释如何将其与在布里渊区剩余部分进行的实际积分相结合。\n\n3. 考虑以下可能用于处理 $\\mathbf{q}=\\mathbf{0}$ 处的 $1/|\\mathbf{q}|^2$ 奇点并执行 RPA 相关能的布里渊区积分的技术。根据你的推导，哪个（些）选项是正确的？\n\nA. 通过将 $\\chi_{0,00}(\\mathbf{q},i\\omega)$ 对 $|\\mathbf{q}|$ 展开到二阶，并在 $\\mathbf{q}=\\mathbf{0}$ 附近的一个小球上对得到的有限被积函数进行球面平均，来对头贡献进行解析积分；然后将该小球从数值网格中移除，并对布里渊区的剩余部分使用一个偏置-$\\mathbf{\\Gamma}$ 点的 Monkhorst-Pack (MP) 网格。这确保了 $1/|\\mathbf{q}|^2$ 奇点的抵消，并为三维绝缘体带来快速收敛。\n\nB. 从布里渊区网格中排除 $\\mathbf{\\Gamma}$ 点，并完全依赖四面体方法在 $\\mathbf{q}=\\mathbf{0}$ 附近进行插值；因为被积函数在远离 $\\mathbf{q}=\\mathbf{0}$ 处是连续的，所以不需要解析校正。\n\nC. 对于固定的 $\\eta>0$，用 $4\\pi/(|\\mathbf{q}|^2+\\eta^2)$ 替换 $v_{00}(\\mathbf{q})$ 来正则化奇点，进行数值布里渊区积分，然后外推到 $\\eta\\to 0$；此过程无需任何解析处理即可保持正确的极限。\n\nD. 忽略介电矩阵的翼和体部分，只保留头部，并在一个单一的、小的但有限的 $|\\mathbf{q}|$ 值上评估头贡献；这能捕捉主要物理并且保证相关能的收敛。\n\n选择所有正确选项。", "solution": "我们从随机相近似（RPA）相关能的绝热连接涨落-耗散定理（ACFDT）表达式开始，该表达式可以形式上写为\n$$\nE_c^{\\mathrm{RPA}} = \\frac{1}{2\\pi}\\int_0^\\infty d\\omega\\, \\mathrm{Tr}\\left[\\ln\\left(1 - v\\,\\chi_0(i\\omega)\\right) + v\\,\\chi_0(i\\omega)\\right],\n$$\n其中 $\\chi_0(i\\omega)$ 是无相互作用密度响应函数，$v$ 是库仑相互作用，两者都表示为 $(\\mathbf{q},\\mathbf{G})$ 基中的矩阵，迹（trace）运算包括对布里渊区（BZ）中波矢量 $\\mathbf{q}$ 的积分。在倒易空间中，库仑矩阵在倒易格矢 $\\mathbf{G}$ 上是对角的，其行为如 $v_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q}) = \\dfrac{4\\pi\\,\\delta_{\\mathbf{G}\\mathbf{G}'}}{|\\mathbf{q}+\\mathbf{G}|^2}$；因此，当 $\\mathbf{q}\\to \\mathbf{0}$ 时，头元素 $v_{00}(\\mathbf{q})$ 以 $4\\pi/|\\mathbf{q}|^2$ 的形式发散。\n\n第一部分。我们分析被积函数在 $\\mathbf{q}=\\mathbf{0}$（$\\mathbf{\\Gamma}$ 点）附近的行为，并证明对于绝缘体，头贡献是有限的。考虑迹运算内矩阵值函数的头块。对于头元素，起主导作用的小 $|\\mathbf{q}|$ 组合具有以下形式\n$$\nf_{00}(\\mathbf{q},i\\omega) = \\ln\\left(1 - v_{00}(\\mathbf{q})\\,\\chi_{0,00}(\\mathbf{q},i\\omega)\\right) + v_{00}(\\mathbf{q})\\,\\chi_{0,00}(\\mathbf{q},i\\omega),\n$$\n其中第二项源于级数展开中的线性项，该项抵消了对数函数的前导行为。使用给定的绝缘体长波展开，\n$$\n\\chi_{0,00}(\\mathbf{q},i\\omega) = \\boldsymbol{\\alpha}(i\\omega):\\left(\\frac{\\mathbf{q}\\mathbf{q}}{|\\mathbf{q}|^2}\\right)\\,|\\mathbf{q}|^2 + \\mathcal{O}(|\\mathbf{q}|^4),\n$$\n我们将前导项写为\n$$\n\\chi_{0,00}(\\mathbf{q},i\\omega) \\approx \\left[\\hat{\\mathbf{q}}\\cdot \\boldsymbol{\\alpha}(i\\omega)\\cdot \\hat{\\mathbf{q}}\\right]\\,|\\mathbf{q}|^2,\n$$\n其中 $\\hat{\\mathbf{q}}=\\mathbf{q}/|\\mathbf{q}|$ 是一个单位矢量。乘以库仑相互作用的头元素，\n$$\nv_{00}(\\mathbf{q})\\,\\chi_{0,00}(\\mathbf{q},i\\omega) \\approx \\frac{4\\pi}{|\\mathbf{q}|^2}\\,\\left[\\hat{\\mathbf{q}}\\cdot \\boldsymbol{\\alpha}(i\\omega)\\cdot \\hat{\\mathbf{q}}\\right]\\,|\\mathbf{q}|^2 = 4\\pi\\,\\left[\\hat{\\mathbf{q}}\\cdot \\boldsymbol{\\alpha}(i\\omega)\\cdot \\hat{\\mathbf{q}}\\right].\n$$\n因此，当 $\\mathbf{q}\\to \\mathbf{0}$ 时，对数的宗量趋于一个有限的、依赖于方向的量：\n$$\n1 - v_{00}(\\mathbf{q})\\,\\chi_{0,00}(\\mathbf{q},i\\omega) \\xrightarrow[\\mathbf{q}\\to \\mathbf{0}]{} 1 - 4\\pi\\,\\left[\\hat{\\mathbf{q}}\\cdot \\boldsymbol{\\alpha}(i\\omega)\\cdot \\hat{\\mathbf{q}}\\right].\n$$\n因此，头部的被积函数\n$$\nf_{00}(\\mathbf{q},i\\omega) \\xrightarrow[\\mathbf{q}\\to \\mathbf{0}]{} \\ln\\left(1 - 4\\pi\\,\\left[\\hat{\\mathbf{q}}\\cdot \\boldsymbol{\\alpha}(i\\omega)\\cdot \\hat{\\mathbf{q}}\\right]\\right) + 4\\pi\\,\\left[\\hat{\\mathbf{q}}\\cdot \\boldsymbol{\\alpha}(i\\omega)\\cdot \\hat{\\mathbf{q}}\\right],\n$$\n通常是有限的且依赖于方向。对于立方晶体，极化率张量简化为标量乘以单位矩阵，即 $\\boldsymbol{\\alpha}(i\\omega)=\\alpha(i\\omega)\\,\\mathbf{I}$，因此 $\\hat{\\mathbf{q}}\\cdot \\boldsymbol{\\alpha}(i\\omega)\\cdot \\hat{\\mathbf{q}} = \\alpha(i\\omega)$。对方向进行球面平均可简单地得到\n$$\n\\langle f_{00}(\\mathbf{q},i\\omega)\\rangle_{\\hat{\\mathbf{q}}} \\xrightarrow[\\mathbf{q}\\to \\mathbf{0}]{} \\ln\\left(1 - 4\\pi\\,\\alpha(i\\omega)\\right) + 4\\pi\\,\\alpha(i\\omega),\n$$\n一个有限常数。\n\n对于一般的各向异性绝缘体，$\\hat{\\mathbf{q}}\\cdot \\boldsymbol{\\alpha}(i\\omega)\\cdot \\hat{\\mathbf{q}}$ 在所有方向上的球面平均满足\n$$\n\\left\\langle \\hat{\\mathbf{q}}\\cdot \\boldsymbol{\\alpha}(i\\omega)\\cdot \\hat{\\mathbf{q}} \\right\\rangle_{\\hat{\\mathbf{q}}} = \\frac{1}{3}\\,\\mathrm{Tr}\\,\\boldsymbol{\\alpha}(i\\omega),\n$$\n因此平均后的头被积函数趋向于\n$$\n\\left\\langle f_{00}(\\mathbf{q},i\\omega) \\right\\rangle_{\\hat{\\mathbf{q}}} \\xrightarrow[\\mathbf{q}\\to \\mathbf{0}]{} \\ln\\left(1 - \\frac{4\\pi}{3}\\,\\mathrm{Tr}\\,\\boldsymbol{\\alpha}(i\\omega)\\right) + \\frac{4\\pi}{3}\\,\\mathrm{Tr}\\,\\boldsymbol{\\alpha}(i\\omega).\n$$\n\n第二部分。为了解析地处理头部的 $\\mathbf{q}\\to \\mathbf{0}$ 奇点，我们按以下步骤进行。布里渊区积分可以分解为两个区域：一个围绕 $\\mathbf{q}=\\mathbf{0}$、半径为 $q_c$ 的小球 $B(\\mathbf{0},q_c)$（在此区域内长波展开成立），以及布里渊区的其余部分。在小球内，我们将矩阵的头被积函数替换为上面推导出的、有限的角平均值。然后可以解析地对来自该球的头贡献进行积分：\n$$\n\\int_{B(\\mathbf{0},q_c)} \\frac{d^3\\mathbf{q}}{\\Omega_{\\mathrm{BZ}}}\\, f_{00}(\\mathbf{q},i\\omega) \\approx \\frac{1}{\\Omega_{\\mathrm{BZ}}}\\,\\left(\\frac{4\\pi}{3}\\,q_c^3\\right)\\,\\left\\langle f_{00}(\\mathbf{q},i\\omega)\\right\\rangle_{\\hat{\\mathbf{q}}},\n$$\n其中 $\\Omega_{\\mathrm{BZ}}$ 是布里渊区的体积。这个解析积分针对每个虚频 $i\\omega$ 进行计算（使用相应的 $\\boldsymbol{\\alpha}(i\\omega)$ 或其迹）。然后将小球 $B(\\mathbf{0},q_c)$ 从数值积分网格中移除，以避免在奇点附近采样。对于布里渊区的剩余部分，我们使用一个移动的或偏置-$\\mathbf{\\Gamma}$ 的 Monkhorst-Pack 网格，该网格在 $\\mathbf{q}=\\mathbf{0}$ 处不设置点，并能有效地对平滑的被积函数进行采样。介电矩阵的翼和体贡献，其量级为 $\\mathcal{O}(|\\mathbf{q}|)$ 或更高且非奇异，在整个剩余区域上进行数值积分，无需特殊处理。在各向异性系统中，可以通过在解析头积分中使用角依赖性 $\\hat{\\mathbf{q}}\\cdot \\boldsymbol{\\alpha}(i\\omega)\\cdot \\hat{\\mathbf{q}}$，或者通过对方向 $\\hat{\\mathbf{q}}$ 进行角度求积，来改进简单的球面平均。\n\n这种解析加数值的组合策略，在被积函数层面上精确地移除了头部的 $1/|\\mathbf{q}|^2$ 奇点，保留了正确的长波物理，并加速了关于布里渊区采样的收敛。\n\n第三部分。我们现在分析每个选项。\n\n选项 A。这恰好提出了上面推导的解析头积分方法，即使用 $\\chi_{0,00}$ 的二阶小 $|\\mathbf{q}|$ 展开来分离出一个有限的头被积函数，在 $\\mathbf{q}=\\mathbf{0}$ 附近的一个小球上进行球面平均和解析积分，并结合一个偏置-$\\mathbf{\\Gamma}$ 的 Monkhorst-Pack 网格处理剩余部分。对于三维绝缘体，$v_{00}(\\mathbf{q})\\,\\chi_{0,00}(\\mathbf{q},i\\omega) \\to 4\\pi\\,\\hat{\\mathbf{q}}\\cdot \\boldsymbol{\\alpha}(i\\omega)\\cdot \\hat{\\mathbf{q}}$，因此被积函数是有限的；所提出的解析积分正确地移除了奇点并改善了收敛性。结论：正确。\n\n选项 B。排除 $\\mathbf{\\Gamma}$ 点并完全依赖四面体方法而不进行解析校正是不足够的。尽管头被积函数在极限情况下是有限的，但在 $\\mathbf{q}=\\mathbf{0}$ 附近对 $\\chi_0$ 的数值计算以及与 $v_{00}(\\mathbf{q})$ 的耦合是微妙的；简单地忽略该邻域会导致收敛缓慢且不均匀，并且四面体线性化方法没有解决与 $1/|\\mathbf{q}|^2$ 项抵消相关的非解析结构。如果在 $\\mathbf{q}=\\mathbf{0}$ 的邻域内没有解析校正，得到的结果能量可能严重依赖于网格的选择，且收敛性可能很差。结论：不正确。\n\n选项 C。引入一个类似汤川势的正则化 $v_{00}(\\mathbf{q}) = 4\\pi/(|\\mathbf{q}|^2+\\eta^2)$ 并在数值积分后外推 $\\eta\\to 0$ 不是一个可靠的通用解决方案。通常情况下，$\\eta\\to 0$ 的极限和布里渊区离散化的极限是不可交换的，这会导致依赖于网格的人为误差；此外，正则化修改了被积函数内部的长程物理，可能会破坏 RPA 被积函数中精细的抵消，特别是对于频率依赖的量。这种方法是临时的（ad hoc），并且劣于基于已知的 $\\chi_0$ 的小 $|\\mathbf{q}|$ 行为的精确解析处理。结论：不正确。\n\n选项 D。忽略翼和体部分，仅在单个小的 $|\\mathbf{q}|$ 值处评估头贡献是不可控且不正确的。翼和体贡献对于捕捉局域场效应和完整的介电响应是必需的；此外，在单个 $|\\mathbf{q}|$ 处采样头部并没有执行所需的布里渊区积分，不能保证收敛或准确性。结论：不正确。\n\n因此，正确的选项是 A。", "answer": "$$\\boxed{A}$$", "id": "3484849"}, {"introduction": "在实际的RPA计算中，对所有电子态的求和必须被截断，例如通过限制所包含的空带（导带）数量。由这种截断引入的计算误差与所包含的能带数量之间存在一种可预测的标度关系，该关系可以通过渐近分析推导得出。这项练习将指导您推导此标度律并实现一个外推方案，这是以可行的计算成本获得高精度关联能的一项至关重要的技能 [@problem_id:3484848]。", "problem": "要求您从独立粒子极化率出发，分析并实现一种用于随机相位近似 (RPA) 关联能的外推方案。请使用虚频轴上的独立粒子极化率表达式（Adler–Wiser 形式）作为基本出发点，以及随机相位近似 (RPA) 中的关联能公式。从第一性原理出发，论证高能空态对关联能的渐近贡献，推导截断误差随空带数量变化的标度关系，并实现一个鲁棒的外推算法。\n\n基本出发点是：\n- 虚频轴上，态求和形式的独立粒子极化率（也称为不可约极化率），\n$$\n\\chi_0(\\mathbf{r},\\mathbf{r}';i\\omega) \\;=\\; \\sum_{n,m} \\left[f_n - f_m\\right]\\,\n\\frac{\\psi_n(\\mathbf{r})\\psi_m^\\ast(\\mathbf{r})\\,\\psi_m(\\mathbf{r}')\\psi_n^\\ast(\\mathbf{r}')\\;2\\left(\\varepsilon_m - \\varepsilon_n\\right)}\n{\\left(\\varepsilon_m - \\varepsilon_n\\right)^2 + \\omega^2}\\,,\n$$\n其中 $\\psi_n$ 是单粒子轨道，$\\varepsilon_n$ 是相应的本征值，$f_n$ 是零温下的占据数 ($f_n \\in \\{0,1\\}$)。\n- RPA 关联能，\n$$\nE_c^{\\text{RPA}} \\;=\\; \\frac{1}{2\\pi}\\int_{0}^{\\infty} \\mathrm{d}\\omega\\ \\mathrm{Tr}\\left[\\ln\\left(1 - v\\,\\chi_0(i\\omega)\\right) + v\\,\\chi_0(i\\omega)\\right],\n$$\n其中 $v$ 是库仑核，$\\mathrm{Tr}$ 表示对空间自由度（例如，在平面波基组中，是对倒格矢）的迹。\n\n任务 A（推导）：\n- 考虑一个三维（$3$-维）有带隙的体系，其高能导带态具有抛物线性质，当能量 $E$ 很大时，其单粒子态密度 (DOS) 满足 $g(E)\\propto \\sqrt{E}$。假设在大的跃迁能量下，跃迁矩阵元随能量变化缓慢，或者以幂律形式衰减，您必须根据态求和表达式的结构来证明这一点。从上述表达式出发，并使用物理上合理的渐近近似，推导截断误差 $\\Delta E_c^{\\text{RPA}}(N_b)$ 作为所包含空带数 $N_b$ 函数的主导阶标度关系。\n- 根据您的推导，提出一个形式如下的外推模型\n$$\nE_c^{\\text{RPA}}(N_b) \\;=\\; E_{\\infty} \\;+\\; A\\,N_b^{-\\beta},\n$$\n并确定三维抛物线色散情况下的指数 $\\beta$。\n\n任务 B（算法设计）：\n- 设计一个数值稳定的算法，该算法给定一组数据对 $\\{(N_b^{(i)}, E_c^{\\text{RPA}}(N_b^{(i)}))\\}_{i=1}^M$ 和一个理论上合理的固定指数 $\\beta$，通过对以下模型进行最小二乘拟合来估计 $E_{\\infty}$ 和 $A$\n$$\nE_c^{\\text{RPA}}(N_b) \\;=\\; E_{\\infty} \\;+\\; A\\,N_b^{-\\beta}.\n$$\n- 解释您如何处理条件性问题，以及为什么对变换后的回归量 $x_i = N_b^{-\\beta}$ 进行线性回归是合适的。\n\n任务 C（实现与测试）：\n- 实现一个完整、可运行的程序，该程序：\n  - 使用任务 A 中推导出的指数值 $\\beta$。\n  - 对于下方的每个测试用例，使用精确模型生成 $E_c^{\\text{RPA}}(N_b)$ 值的合成数据集\n    $$\n    E_c^{\\text{RPA}}(N_b) \\;=\\; E_{\\infty}^{\\text{(true)}} \\;+\\; A^{\\text{(true)}}\\,N_b^{-\\beta},\n    $$\n    不添加额外噪声。\n  - 将模型与合成数据进行最小二乘拟合，以估计 $E_{\\infty}$。\n  - 为每个测试用例输出估计的 $E_{\\infty}$。\n\n- 物理单位：关联能必须以每个电子的电子伏特（eV/electron）为单位处理和报告。您的程序必须以 eV/electron 为单位打印估计的 $E_{\\infty}$ 值，并四舍五入到 $6$ 位小数。\n\n- 角度单位不适用。百分比不适用。\n\n测试套件：\n- 使用以下四个测试用例。在每种情况下，程序都必须生成合成数据，然后执行拟合：\n  - 用例 1：$E_{\\infty}^{\\text{(true)}} = -1.500000$ eV/electron, $A^{\\text{(true)}} = 0.900000$ eV/electron, 其中 $N_b \\in [8,16,32,64,128,256]$。\n  - 用例 2：$E_{\\infty}^{\\text{(true)}} = -0.750000$ eV/electron, $A^{\\text{(true)}} = 0.300000$ eV/electron, 其中 $N_b \\in [10,20,40,80,160]$。\n  - 用例 3：$E_{\\infty}^{\\text{(true)}} = -2.345678$ eV/electron, $A^{\\text{(true)}} = 0.050000$ eV/electron, 其中 $N_b \\in [50,100,200,400,800,1600]$。\n  - 用例 4（立即收敛的边界情况）：$E_{\\infty}^{\\text{(true)}} = -1.000000$ eV/electron, $A^{\\text{(true)}} = 0.000000$ eV/electron, 其中 $N_b \\in [16,32,64]$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含四个用例的估计 $E_{\\infty}$ 值，格式为方括号内以逗号分隔的列表，例如 $[x_1,x_2,x_3,x_4]$，其中每个 $x_i$ 是一个以 eV/electron 为单位、四舍五入到 $6$ 位小数的浮点数。不应打印任何其他文本。", "solution": "该问题的解决方案分为三部分，分别对应推导、算法设计和实现这三个任务。\n\n### 任务 A：外推模型和指数 $\\beta$ 的推导\n\n目标是确定随机相位近似 (RPA) 关联能中的截断误差 $\\Delta E_c^{\\text{RPA}}(N_b)$ 作为所包含空带（导带）数 $N_b$ 函数的主导阶标度关系。该误差定义为 $\\Delta E_c^{\\text{RPA}}(N_b) = E_c^{\\text{RPA}}(N_b) - E_c^{\\text{RPA}}(\\infty)$，其中 $E_c^{\\text{RPA}}(\\infty)$ 是完全收敛的关联能。使用 $N_b$ 个能带计算的能量所提出的模型是 $E_c^{\\text{RPA}}(N_b) = E_{\\infty} + A\\,N_b^{-\\beta}$。我们的目标是推导指数 $\\beta$。\n\n**1. 基本方程**\n\n我们从给定的 RPA 关联能表达式开始，\n$$\nE_c^{\\text{RPA}} = \\frac{1}{2\\pi}\\int_{0}^{\\infty} \\mathrm{d}\\omega\\ \\mathrm{Tr}\\left[\\ln\\left(1 - v\\,\\chi_0(i\\omega)\\right) + v\\,\\chi_0(i\\omega)\\right],\n$$\n以及虚频轴上的独立粒子极化率，\n$$\n\\chi_0(i\\omega) = \\sum_{v,c}\n\\frac{ M_{vc} \\; 2(\\varepsilon_c - \\varepsilon_v)}\n{(\\varepsilon_c - \\varepsilon_v)^2 + \\omega^2},\n$$\n其中求和遍及占据态（价带，$v$）和空态（导带，$c$），$\\varepsilon_i$ 是单粒子能量，$v$ 是库仑核，$M_{vc}$ 代表跃迁矩阵元乘积。在 $N_b$ 个空带处截断意味着对 $c$ 的求和被限制在前 $N_b$ 个导带。误差源于忽略了到导带 $c > N_b$ 的跃迁。\n\n**2. 渐近行为与微扰分析**\n\n向高能空态跃迁的贡献很小。对于小宗量 $X$，能量表达式的被积函数可以展开为：$\\ln(1-X) + X = -\\frac{1}{2}X^2 - \\frac{1}{3}X^3 - \\dots$。高能下对关联能的主导贡献来自二阶项，通常称为二阶交换加屏蔽交换 (SOX) 能量。因此，可以在此理论水平上分析由截断引起的误差。这种方法是分析量子化学和固态物理中基组和截断收敛性的标准方法。\n\n已知关联能的收敛性取决于用于表示波函数和极化率的底层基组的收敛性。在平面波计算中，该基组在动能截断 $E_{\\text{cut}}$ 处被截断。一个完整、严谨的推导是复杂的，但已有结果表明，对于三维电子气，RPA 关联能中的截断误差随能量截断的变化标度关系为：\n$$\n\\Delta E_c^{\\text{RPA}} \\propto E_{\\text{cut}}^{-3/2}\n$$\n该标度关系源于对二阶 Møller-Plesset (MP2) 或 SOX 能量表达式的分析，其中对高能未占据态的求和被转换成动量空间中的积分。结果取决于维度（$3$D）和库仑相互作用的性质。正如问题所建议的，我们接受这一点作为渐近分析的物理上合理的出发点。\n\n**3. 关联能量截断与能带数**\n\n问题指定按空带数 $N_b$ 进行截断，而不是能量截断 $E_{\\text{cut}}$。我们需要关联这两个量。问题指出我们正在处理一个三维体系，其高能导带态呈抛物线型，对于大能量 $E$，其态密度 (DOS) 由 $g(E) \\propto \\sqrt{E}$ 给出。\n\n达到某个能量截断 $E_{\\text{cut}}$（从导带底算起）的空带数 $N_b$ 由对 DOS 积分得到：\n$$\nN_b(E_{\\text{cut}}) = \\int_{0}^{E_{\\text{cut}}} g(E) \\,dE.\n$$\n使用给定的 DOS 标度关系，我们有：\n$$\nN_b(E_{\\text{cut}}) \\propto \\int_{0}^{E_{\\text{cut}}} E^{1/2} \\,dE \\propto [E^{3/2}]_{0}^{E_{\\text{cut}}} \\propto E_{\\text{cut}}^{3/2}.\n$$\n这给了我们能量截断和能带数之间的关系：\n$$\nE_{\\text{cut}} \\propto N_b^{2/3}.\n$$\n\n**4. 推导标度指数 $\\beta$**\n\n我们现在可以将截断误差与能量截断的标度关系以及能量截断与能带数之间的关系结合起来。将 $E_{\\text{cut}} \\propto N_b^{2/3}$ 代入误差标度关系 $\\Delta E_c^{\\text{RPA}} \\propto E_{\\text{cut}}^{-3/2}$，我们得到：\n$$\n\\Delta E_c^{\\text{RPA}}(N_b) \\propto (N_b^{2/3})^{-3/2} = N_b^{(2/3) \\times (-3/2)} = N_b^{-1}.\n$$\n因此，截断误差，即差值 $E_c^{\\text{RPA}}(N_b) - E_{\\infty}$，与 $N_b^{-1}$ 成标度关系。这对应于所提出的外推模型：\n$$\nE_c^{\\text{RPA}}(N_b) = E_{\\infty} + A\\,N_b^{-\\beta},\n$$\n其中指数 $\\beta = 1$。常数 $A$ 代表此主导阶误差项的系数。\n\n### 任务 B：算法设计\n\n任务是设计一个数值稳定的算法，从一组计算数据点 $\\{(N_b^{(i)}, E_c^{(i)})\\}_{i=1}^M$ 和固定的、理论推导的指数 $\\beta=1$ 出发，估计参数 $E_{\\infty}$ 和 $A$。\n\n待拟合的模型是：\n$$\nE_c^{(i)} = E_{\\infty} + A \\cdot (N_b^{(i)})^{-\\beta}.\n$$\n让我们定义 $y_i = E_c^{(i)}$ 和变换后的回归量 $x_i = (N_b^{(i)})^{-\\beta}$。通过这些定义，模型变为：\n$$\ny_i = E_{\\infty} + A x_i.\n$$\n这是一个关于参数 $E_{\\infty}$ 和 $A$ 的线性模型。因此，线性最小二乘回归是合适的方法。自变量 $N_b$ 到 $x_i$ 的变换是非线性的，但这不影响模型关于其参数的线性。\n\n算法流程如下：\n\n1.  **数据变换**：给定输入数据 $(N_b^{(i)}, y_i)$ 和固定指数 $\\beta$，为每个数据点 $i = 1, \\dots, M$ 计算变换后的自变量 $x_i = (N_b^{(i)})^{-\\beta}$。\n\n2.  **构建线性系统**：最小二乘拟合的目标是找到参数 $(E_{\\infty}, A)$，以最小化残差平方和 $S = \\sum_{i=1}^M (y_i - (E_{\\infty} + A x_i))^2$。这导出了著名的正规方程组，可以表示为矩阵形式：\n    $$\n    X^T X \\mathbf{p} = X^T \\mathbf{y}\n    $$\n    其中：\n    - $\\mathbf{p} = \\begin{pmatrix} E_{\\infty} \\\\ A \\end{pmatrix}$ 是待确定的参数向量。\n    - $\\mathbf{y} = \\begin{pmatrix} y_1 \\\\ y_2 \\\\ \\vdots \\\\ y_M \\end{pmatrix}$ 是观测到的能量值向量。\n    - $X = \\begin{pmatrix} 1  x_1 \\\\ 1  x_2 \\\\ \\vdots  \\vdots \\\\ 1  x_M \\end{pmatrix}$ 是设计矩阵。第一列全为 1，对应于截距项 $E_{\\infty}$，第二列包含回归量 $x_i$ 的值。\n\n3.  **求解系统**：为确保数值稳定性，特别是在 $X$ 的列几乎共线的情况下（这里不是问题，因为 $N_b^{(i)}$ 值是不同的），最好使用鲁棒的线性代数例程，而不是显式计算 $X^T X$ 的逆。标准数值库提供了求解最小二乘问题的函数，通常通过矩阵 $X$ 的 QR 分解或奇异值分解 (SVD) 来实现。例如，在 NumPy 中，`numpy.linalg.lstsq` 函数就是为此目的设计的。它以对不良条件性鲁棒的方式求解 $\\mathbf{p}$。\n\n求解器的输出将是估计的参数向量 $\\hat{\\mathbf{p}}$，我们从中提取第一个分量作为收敛关联能 $E_{\\infty}$ 的估计值。\n\n### 任务 C：实现与测试\n\n实现涉及编写一个 Python 脚本，该脚本使用任务 A 中推导的指数 $\\beta=1$ 和任务 B 中的最小二乘算法。该脚本将首先为几个测试用例生成合成数据，然后应用拟合程序来恢复原始参数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes and implements an extrapolation scheme for RPA correlation energy.\n\n    This function performs the following steps for a series of test cases:\n    1. Sets the theoretically derived exponent beta for the extrapolation model\n       E_c(N_b) = E_infinity + A * N_b**(-beta). Based on the analysis of a 3D\n       gapped system with parabolic bands, beta is determined to be 1.\n    2. For each test case, it generates a synthetic dataset of RPA correlation\n       energies (E_c) for a given set of empty band numbers (N_b) using\n       the true parameters E_infinity_true and A_true.\n    3. It then fits the extrapolation model to this synthetic data using linear\n       least-squares regression to estimate the E_infinity parameter.\n    4. The estimated E_infinity values for all test cases are collected and\n       printed in the specified format.\n    \"\"\"\n\n    # From the derivation in Task A, the exponent beta is 1.\n    beta = 1.0\n\n    # Define the test cases from the problem statement.\n    # Each case is a dictionary containing the true parameters and N_b values.\n    test_cases = [\n        {\n            \"E_inf_true\": -1.500000,\n            \"A_true\": 0.900000,\n            \"N_b_values\": np.array([8, 16, 32, 64, 128, 256]),\n        },\n        {\n            \"E_inf_true\": -0.750000,\n            \"A_true\": 0.300000,\n            \"N_b_values\": np.array([10, 20, 40, 80, 160]),\n        },\n        {\n            \"E_inf_true\": -2.345678,\n            \"A_true\": 0.050000,\n            \"N_b_values\": np.array([50, 100, 200, 400, 800, 1600]),\n        },\n        {\n            \"E_inf_true\": -1.000000,\n            \"A_true\": 0.000000,\n            \"N_b_values\": np.array([16, 32, 64]),\n        },\n    ]\n\n    estimated_energies = []\n    \n    for case in test_cases:\n        N_b = case[\"N_b_values\"]\n        E_inf_true = case[\"E_inf_true\"]\n        A_true = case[\"A_true\"]\n\n        # 1. Generate synthetic data using the exact model\n        # E_c(N_b) = E_infinity_true + A_true * N_b**(-beta)\n        # This is the 'y' vector in our linear regression.\n        E_c_values = E_inf_true + A_true * N_b**(-beta)\n\n        # 2. Prepare for least-squares fitting.\n        # The model is y = E_inf + A * x, where x = N_b**(-beta).\n        # We need to solve a linear system based on this model.\n        \n        # Construct the regressor 'x' vector.\n        x_regressor = N_b**(-beta)\n\n        # Construct the design matrix X. The first column of ones is for the\n        # intercept (E_infinity), and the second is for the slope (A).\n        # The shape of X will be (M, 2) where M is the number of data points.\n        X_design_matrix = np.vstack([np.ones(len(x_regressor)), x_regressor]).T\n        \n        # 3. Perform linear least-squares regression.\n        # np.linalg.lstsq solves the equation X * p = y for the parameter\n        # vector p = [E_infinity, A] in a least-squares sense.\n        # It is numerically more stable than direct matrix inversion.\n        # The 'rcond=None' argument is to use the machine-precision default.\n        params, residuals, rank, s = np.linalg.lstsq(X_design_matrix, E_c_values, rcond=None)\n\n        # The estimated E_infinity is the first element of the solution vector.\n        E_inf_estimated = params[0]\n        \n        # 4. Store the result.\n        estimated_energies.append(E_inf_estimated)\n\n    # Final print statement in the exact required format.\n    # The results are rounded to 6 decimal places as specified.\n    # Since the synthetic data has no noise, the estimated parameters\n    # should be extremely close to the true ones.\n    print(f\"[{','.join([f'{e:.6f}' for e in estimated_energies])}]\")\n\nsolve()\n```", "id": "3484848"}, {"introduction": "完成RPA能量计算的最后一步是在虚频轴上进行从零到无穷大的积分。幸运的是，被积函数在高频区域会迅速衰减，这使得我们可以在一个有限的频率上限 $\\Omega$ 处截断积分，同时将误差控制在一定范围内。此后，可以应用如高斯-勒让德等高效的数值求积方法来处理这个有限区间的积分。这项练习将向您展示如何实现一个稳健的数值积分方案，并推导其先验误差估计，从而确保频率积分部分的计算精度 [@problem_id:3484811]。", "problem": "考虑一个标量被积函数，它是在随机相近似中，当绝热连接涨落-耗散定理投影到库仑核的一个本征模上时产生的。设虚频轴上的独立粒子密度-密度响应函数被建模为一个具有代表带间跃迁的离散极点的有理函数，具体为\n$$\n\\chi_0(i\\omega) = -\\sum_{j=1}^{M} \\frac{S_j}{\\omega^2 + \\Delta_j^2},\n$$\n其中 $S_j > 0$ 是振子强度，$\\Delta_j > 0$ 是跃迁能。对于一个固定的标量耦合 $\\,\\alpha > 0\\,$，它代表该模式下库仑核的本征值，定义模式分辨的随机相近似被积函数\n$$\nf(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\}) = \\ln\\!\\big(1 - \\alpha\\, \\chi_0(i\\omega)\\big) + \\alpha\\, \\chi_0(i\\omega).\n$$\n该模式对应的相关能贡献为\n$$\nE_c = \\frac{1}{2\\pi}\\int_{0}^{\\infty} f(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\}) \\, d\\omega.\n$$\n你需要设计一个在虚轴上的高斯-勒让德求积来近似这个积分。为了使积分在数值上可处理，引入一个有限上界 $\\,\\Omega > 0\\,$ 并近似为\n$$\nE_c \\approx \\frac{1}{2\\pi}\\int_{0}^{\\Omega} f(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\}) \\, d\\omega,\n$$\n使用一个从 $[-1,1]$ 映射到 $[0,\\Omega]$ 的 $\\,N\\,$ 阶高斯-勒让德法则。提供一个先验误差估计，该估计由 $\\,\\chi_0(i\\omega)\\,$ 在大 $\\,\\omega\\,$ 时的渐近衰减导出。具体来说，假设渐近行为为 $\\,\\chi_0(i\\omega) \\sim -S_{\\mathrm{tot}}/\\omega^2\\,$，其中 $\\,S_{\\mathrm{tot}} = \\sum_{j=1}^{M} S_j\\,$，并使用领头阶近似来证明对于 $\\omega \\ge \\Omega$ 有，\n$$\nf(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\}) \\approx -\\frac{1}{2}\\big(\\alpha\\,\\chi_0(i\\omega)\\big)^2 \\sim -\\frac{1}{2}\\frac{\\alpha^2 S_{\\mathrm{tot}}^2}{\\omega^4}.\n$$\n由此，推导积分截断误差的一个先验界：\n$$\n\\left| E_c - \\frac{1}{2\\pi}\\int_{0}^{\\Omega} f(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\}) \\, d\\omega \\right| \\le \\frac{\\alpha^2 S_{\\mathrm{tot}}^2}{12\\pi \\,\\Omega^3}.\n$$\n实现一个程序，该程序：\n- 使用具有 $\\,N\\,$ 个节点的高斯-勒让德求积，在区间 $[0,\\Omega]$ 上计算函数 $\\,f(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\})\\,$ 的 $\\,E_c\\,$ 值。\n- 仅基于 $\\,\\chi_0(i\\omega)\\,$ 的渐近衰减，计算先验截断误差界 $\\,\\alpha^2 S_{\\mathrm{tot}}^2/(12\\pi \\,\\Omega^3)\\,$。\n- 对于每个测试用例，输出一个包含计算出的相关能 $\\,E_c\\,$（单位为 Hartree）和相应的先验误差界（单位为 Hartree）的数对。\n\n使用以下参数集 $(\\alpha,\\{S_j\\},\\{\\Delta_j\\},\\Omega,N)$ 的测试套件：\n1. $\\alpha = 0.5$, $\\{S_j\\} = [1.0]$, $\\{\\Delta_j\\} = [1.0]$, $\\Omega = 20.0$, $N = 200$。\n2. $\\alpha = 1.2$, $\\{S_j\\} = [0.8, 0.5]$, $\\{\\Delta_j\\} = [0.5, 2.0]$, $\\Omega = 30.0$, $N = 300$。\n3. $\\alpha = 0.1$, $\\{S_j\\} = [2.0, 0.5, 0.3]$, $\\{\\Delta_j\\} = [1.5, 4.0, 10.0]$, $\\Omega = 15.0$, $N = 150$。\n4. $\\alpha = 2.5$, $\\{S_j\\} = [1.5, 0.7, 0.2]$, $\\{\\Delta_j\\} = [0.8, 3.0, 12.0]$, $\\Omega = 5.0$, $N = 80$。\n\n所有能量必须以 Hartree 表示。你的程序应生成单行输出，其中包含结果，格式为逗号分隔的数对列表，每个数对用方括号括起来，不含空格，例如 $[ [E_1,\\varepsilon_1], [E_2,\\varepsilon_2], \\dots ]$，但无空格。具体来说，输出格式必须为 $[[E_1,\\varepsilon_1],[E_2,\\varepsilon_2],[E_3,\\varepsilon_3],[E_4,\\varepsilon_4]]$，其中 $E_k$ 是测试用例 $k$ 计算出的相关能，$\\varepsilon_k$ 是其先验误差界，两者均为 Hartree 单位的浮点数。", "solution": "绝热连接涨落-耗散定理（ACFDT）将相关能表示为响应函数在不同耦合强度下的频率积分。在随机相近似（RPA）中，相互作用响应是通过戴森方程从独立粒子响应构建的，当库仑核被对角化时，迹对数简化为来自各本征模的独立贡献。对于具有标量耦合的单个本征模，相关能变为一个标量函数的虚频 $\\omega$ 积分，该标量函数由独立粒子密度-密度响应函数 $\\chi_0(i\\omega)$ 构建。在不援引超出这些基本原理的任何捷径公式的情况下，我们考虑一个标准的、具有良好物理动机的 $\\chi_0(i\\omega)$ 模型，该模型能捕捉到在有带隙系统和绝缘体中发现的渐近行为。\n\n我们采用模型\n$$\n\\chi_0(i\\omega) = -\\sum_{j=1}^{M} \\frac{S_j}{\\omega^2 + \\Delta_j^2},\n$$\n其中 $S_j > 0$ 且 $\\Delta_j > 0$，这反映了虚轴响应是平滑、为负，并且在大 $\\omega$ 时按 $\\omega^{-2}$ 衰减。那么，对于耦合为 $\\alpha > 0$ 的本征模，其标量被积函数为\n$$\nf(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\}) = \\ln\\!\\big(1 - \\alpha\\, \\chi_0(i\\omega)\\big) + \\alpha\\, \\chi_0(i\\omega).\n$$\n对于大 $\\omega$，$\\chi_0(i\\omega)$ 的渐近衰减为\n$$\n\\chi_0(i\\omega) \\sim -\\frac{S_{\\mathrm{tot}}}{\\omega^2}, \\quad S_{\\mathrm{tot}} = \\sum_{j=1}^{M} S_j.\n$$\n对数函数在 $|\\alpha \\chi_0(i\\omega)|$ 较小时的泰勒展开得出\n$$\n\\ln(1 - \\alpha \\chi_0) + \\alpha \\chi_0 = -\\frac{1}{2}\\big(\\alpha \\chi_0\\big)^2 - \\frac{1}{3}\\big(\\alpha \\chi_0\\big)^3 - \\cdots,\n$$\n其中领头项在大 $\\omega$ 时占主导地位。使用领头项和 $\\chi_0(i\\omega)$ 的渐近形式，\n$$\nf(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\}) \\approx -\\frac{1}{2}\\frac{\\alpha^2 S_{\\mathrm{tot}}^2}{\\omega^4} \\quad \\text{当 } \\omega \\to \\infty.\n$$\n因此，在有限上界 $\\Omega$ 处对积分进行截断，可以通过对领头阶尾部的绝对值进行积分，得到一个先验误差界：\n$$\n\\left| E_c - \\frac{1}{2\\pi}\\int_{0}^{\\Omega} f(\\omega;\\alpha,\\{S_j\\},\\{\\Delta_j\\}) \\, d\\omega \\right|\n\\le \\frac{1}{2\\pi}\\int_{\\Omega}^{\\infty} \\frac{1}{2}\\frac{\\alpha^2 S_{\\mathrm{tot}}^2}{\\omega^4} \\, d\\omega\n= \\frac{\\alpha^2 S_{\\mathrm{tot}}^2}{12\\pi \\,\\Omega^3}.\n$$\n该估计除了 $\\alpha$、$S_{\\mathrm{tot}}$ 和 $\\Omega$ 之外，不依赖于任何未知量，并且它与 $\\chi_0(i\\omega)$ 的渐近行为直接相关。在 $[0,\\Omega]$ 上的高斯-勒让德求积是通过将节点和权重从标准区间 $[-1,1]$ 映射过来进行的。设 $\\{x_k, w_k\\}_{k=1}^{N}$ 为 $[-1,1]$ 上的高斯-勒让德节点和权重。仿射变换 $\\omega = \\frac{\\Omega}{2}(x+1)$ 将 $[-1,1]$ 映射到 $[0,\\Omega]$，积分为近似为\n$$\n\\int_{0}^{\\Omega} f(\\omega) \\, d\\omega \\approx \\sum_{k=1}^{N} \\left( \\frac{\\Omega}{2} w_k \\right) f\\!\\left(\\frac{\\Omega}{2}(x_k + 1)\\right).\n$$\n将其与前置因子 $1/(2\\pi)$ 结合，得到\n$$\nE_c \\approx \\frac{1}{2\\pi} \\sum_{k=1}^{N} \\left( \\frac{\\Omega}{2} w_k \\right) f\\!\\left(\\frac{\\Omega}{2}(x_k + 1)\\right).\n$$\n对于平滑、解析的被积函数，在 $[0,\\Omega]$ 上使用高斯-勒让德求积的离散化误差通常非常小，并随 $N$ 快速衰减，对于在包含 $[-1,1]$ 的区域内解析的函数，该误差通常是关于 $N$ 指数级衰减的。在此设计中，我们确保求积阶数 $N$ 足够大，使得离散化误差与从渐近行为导出的先验截断误差界相比可以忽略不计。报告的总体先验误差是截断界\n$$\n\\varepsilon(\\alpha,\\{S_j\\},\\Omega) = \\frac{\\alpha^2}{12\\pi \\,\\Omega^3} \\left(\\sum_{j=1}^{M} S_j\\right)^2,\n$$\n以 Hartree 表示，与能量积分的单位一致。\n\n算法步骤：\n1. 对于每个测试用例，计算 $S_{\\mathrm{tot}} = \\sum_j S_j$。\n2. 构建函数 $\\chi_0(i\\omega) = -\\sum_j S_j/(\\omega^2 + \\Delta_j^2)$。\n3. 在映射到 $[0,\\Omega]$ 的高斯-勒让德节点上计算被积函数 $f(\\omega) = \\ln(1 - \\alpha \\chi_0(i\\omega)) + \\alpha \\chi_0(i\\omega)$，并累加加权和以近似 $\\int_0^{\\Omega} f(\\omega) \\, d\\omega$。\n4. 乘以 $1/(2\\pi)$ 以获得以 Hartree 为单位的 $E_c$。\n5. 计算以 Hartree 为单位的先验截断误差界 $\\varepsilon = \\alpha^2 S_{\\mathrm{tot}}^2/(12\\pi \\Omega^3)$。\n6. 对于每个测试用例，以指定格式输出数对 $[E_c, \\varepsilon]$。\n\n提供的测试套件探索了不同的情况：单极点“理想情况”、中等耦合的双极点情况、小耦合的多极点情况，以及一个具有相对强耦合和较小上界 $\\Omega$ 以强调截断误差重要性的边界情况。按要求，所有结果均以 Hartree 为单位打印。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef chi0_imag(omega, S_list, Delta_list):\n    \"\"\"\n    Independent-particle polarizability on the imaginary axis:\n    chi0(i*omega) = - sum_j S_j / (omega^2 + Delta_j^2)\n    \"\"\"\n    omega2 = omega * omega\n    denom = omega2 + np.array(Delta_list, dtype=float)**2\n    return -np.sum(np.array(S_list, dtype=float) / denom)\n\ndef integrand_f(omega, alpha, S_list, Delta_list):\n    \"\"\"\n    f(omega) = ln(1 - alpha * chi0(i*omega)) + alpha * chi0(i*omega)\n    \"\"\"\n    chi0 = chi0_imag(omega, S_list, Delta_list)\n    return np.log(1.0 - alpha * chi0) + alpha * chi0\n\ndef rpa_energy_gl(alpha, S_list, Delta_list, Omega, N):\n    \"\"\"\n    Compute E_c ≈ (1/(2*pi)) ∫_0^Omega f(omega) dω using Gauss–Legendre quadrature with N nodes.\n    \"\"\"\n    # Gauss-Legendre nodes and weights on [-1, 1]\n    x, w = np.polynomial.legendre.leggauss(N)\n    # Map to [0, Omega]: omega = (Omega/2)*(x+1), dω = (Omega/2) dx\n    omega_nodes = 0.5 * Omega * (x + 1.0)\n    weights = 0.5 * Omega * w\n    fvals = np.array([integrand_f(om, alpha, S_list, Delta_list) for om in omega_nodes], dtype=float)\n    integral_0_Omega = np.dot(weights, fvals)\n    return (1.0 / (2.0 * np.pi)) * integral_0_Omega\n\ndef tail_error_bound(alpha, S_list, Omega):\n    \"\"\"\n    A priori truncation error bound based on asymptotic decay:\n    |E_tail| = alpha^2 * (sum S_j)^2 / (12 * pi * Omega^3)\n    \"\"\"\n    S_tot = float(np.sum(np.array(S_list, dtype=float)))\n    return (alpha**2 * S_tot**2) / (12.0 * np.pi * Omega**3)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (alpha, S_list, Delta_list, Omega, N)\n    test_cases = [\n        (0.5, [1.0], [1.0], 20.0, 200),\n        (1.2, [0.8, 0.5], [0.5, 2.0], 30.0, 300),\n        (0.1, [2.0, 0.5, 0.3], [1.5, 4.0, 10.0], 15.0, 150),\n        (2.5, [1.5, 0.7, 0.2], [0.8, 3.0, 12.0], 5.0, 80),\n    ]\n\n    results = []\n    for alpha, S_list, Delta_list, Omega, N in test_cases:\n        E_c = rpa_energy_gl(alpha, S_list, Delta_list, Omega, N)\n        err_bound = tail_error_bound(alpha, S_list, Omega)\n        results.append([E_c, err_bound])\n\n    # Format the output exactly as required: no spaces, nested list of pairs.\n    def format_results_no_spaces(res):\n        parts = []\n        for pair in res:\n            # Ensure standard float string conversion without spaces\n            parts.append(f\"[{pair[0]},{pair[1]}]\")\n        return \"[\" + \",\".join(parts) + \"]\"\n\n    print(format_results_no_spaces(results))\n\nsolve()\n```", "id": "3484811"}]}