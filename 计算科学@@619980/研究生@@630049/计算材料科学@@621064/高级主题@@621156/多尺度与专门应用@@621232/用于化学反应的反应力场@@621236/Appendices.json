{"hands_on_practices": [{"introduction": "本次实践是我们理解反应力场的基础。我们将为一个经典的化学反应——氢提取反应——构建一个简化的一维势能面。通过将简单的键能模型（莫尔斯势）与不同的静电荷模型相结合，您将直接观察到电荷动力学的描述如何关键地影响计算出的反应能垒。[@problem_id:3485011]", "problem": "设计并实现一个完整、可运行的程序，该程序使用简化的、受约束的密度泛函理论 (DFT) 参考和具有不同电荷分配策略的反应力场 (FF) 模型，构建并比较氢提取反应的一维内禀反应势垒。目标是从计算材料科学的第一性原理出发，演示内禀势垒如何由键的形成和断裂产生，以及偏差如何依赖于反应力场中电荷模型的选择。\n\n您必须使用基于物理的组分沿着单一反应坐标构建能量，并将势垒计算为过渡态和反应物最小值之间的能量差。然后，您必须针对一个小型的验证套件，报告每个 FF 势垒相对于受约束 DFT 势垒的偏差（单位为电子伏特 eV）。最终输出必须是单行文本，其中包含一个方括号括起来的、以逗号分隔的偏差列表。\n\n基础出发点：\n- 牛顿势能可加性：总势能是独立贡献项的总和。\n- 用于键拉伸的莫尔斯势是经过充分检验的键能学表示。\n- 库仑相互作用由静电学支配，其中一个成熟的常数将电荷和距离联系起来。\n\n场景和定义：\n- 此处使用受约束的密度泛函理论 (DFT) 作为内禀势垒的参考，内禀势垒定义为在隔离了电荷转移路径（无显式动力学）的约束条件下，沿反应坐标的能量剖面。\n- 反应力场 (FF) 模型通过参数化函数近似键能和电荷能；此处，FF 相对于受约束 DFT 势垒的偏差将作为电荷模型选择的函数来计算。\n- 电荷均衡 (QEq) 由沿坐标的线性响应电荷模型表示。\n- 电负性均衡方法 (EEM) 由一个饱和非线性电荷模型表示。\n\n反应坐标和几何结构：\n- 考虑羟基从甲烷中提取氢的反应，简化为一维进程变量 $x \\in [0,1]$。\n- 碳-氢键距模型为 $r_{\\mathrm{CH}}(x) = r_{\\mathrm{CH}}^{\\mathrm{eq}} + s_{\\mathrm{CH}} x$。\n- 氧-氢键距模型为 $r_{\\mathrm{OH}}(x) = r_{\\mathrm{OH}}^{\\mathrm{eq}} + s_{\\mathrm{OH}} (1 - x)$。\n- 使用 $r_{\\mathrm{CH}}^{\\mathrm{eq}} = 1.09$ $\\text{\\AA}$，$r_{\\mathrm{OH}}^{\\mathrm{eq}} = 0.97$ $\\text{\\AA}$，$s_{\\mathrm{CH}} = 1.60$ $\\text{\\AA}$ 以及 $s_{\\mathrm{OH}} = 1.60$ $\\text{\\AA}$。\n\n键能学：\n- 平衡距离为 $r_e$、解离能为 $D_e$、范围参数为 $a$ 的键的莫尔斯势为\n$$\nE_{\\mathrm{Morse}}(r; D_e, a, r_e) = D_e \\left(1 - e^{-a (r - r_e)}\\right)^2 - D_e,\n$$\n这使得 $E_{\\mathrm{Morse}}(r_e) = -D_e$，并且当 $r \\to \\infty$ 时趋近于 $0$。\n- 使用 $D_e^{\\mathrm{CH}} = 4.30$ $\\mathrm{eV}$，$a^{\\mathrm{CH}} = 1.70$ $\\text{\\AA}^{-1}$，$D_e^{\\mathrm{OH}} = 4.80$ $\\mathrm{eV}$，$a^{\\mathrm{OH}} = 1.80$ $\\text{\\AA}^{-1}$。\n\n静电学：\n- 库仑相互作用为\n$$\nE_{\\mathrm{C}}(x) = k_e\\left(\\frac{q_{\\mathrm{O}}(x) q_{\\mathrm{H}}(x)}{r_{\\mathrm{OH}}(x)} + \\frac{q_{\\mathrm{C}}(x) q_{\\mathrm{H}}(x)}{r_{\\mathrm{CH}}(x)}\\right),\n$$\n其中 $k_e = 14.3996$ $\\mathrm{eV}\\cdot\\text{\\AA}/e^2$。\n\n沿坐标的总能量：\n- 受约束的 DFT 参考能量为\n$$\nE_{\\mathrm{DFT}}(x) = E_{\\mathrm{Morse}}(r_{\\mathrm{CH}}(x); D_e^{\\mathrm{CH}}, a^{\\mathrm{CH}}, r_{\\mathrm{CH}}^{\\mathrm{eq}}) + E_{\\mathrm{Morse}}(r_{\\mathrm{OH}}(x); D_e^{\\mathrm{OH}}, a^{\\mathrm{OH}}, r_{\\mathrm{OH}}^{\\mathrm{eq}}) + E_{\\mathrm{C}}^{\\mathrm{DFT}}(x).\n$$\n- 一个反应力场能量使用相同的键莫尔斯项，但将 $E_{\\mathrm{C}}^{\\mathrm{DFT}}(x)$ 替换为由指定电荷模型构建的 $E_{\\mathrm{C}}^{\\mathrm{FF}}(x)$。\n\n电荷模型：\n- 受约束的 DFT 参考电荷定义为围绕过渡态位置 $x_{\\mathrm{TS}}$ 的两个饱和转移分量的电中性叠加：\n$$\nq_{\\mathrm{H}}^{\\mathrm{DFT}}(x) = q_{\\mathrm{H,OH}}^{\\mathrm{DFT}}(x) + q_{\\mathrm{H,CH}}^{\\mathrm{DFT}}(x),\n$$\n$$\nq_{\\mathrm{H,OH}}^{\\mathrm{DFT}}(x) = q_{\\max}^{\\mathrm{OH}} \\tanh\\left(\\gamma_{\\mathrm{OH}}(x - x_{\\mathrm{TS}})\\right), \\quad q_{\\mathrm{O}}^{\\mathrm{DFT}}(x) = - q_{\\mathrm{H,OH}}^{\\mathrm{DFT}}(x),\n$$\n$$\nq_{\\mathrm{H,CH}}^{\\mathrm{DFT}}(x) = q_{\\max}^{\\mathrm{CH}} \\tanh\\left(\\gamma_{\\mathrm{CH}}(x_{\\mathrm{TS}} - x)\\right), \\quad q_{\\mathrm{C}}^{\\mathrm{DFT}}(x) = - q_{\\mathrm{H,CH}}^{\\mathrm{DFT}}(x),\n$$\n其中 $x_{\\mathrm{TS}} = 0.50$，$q_{\\max}^{\\mathrm{OH}} = 0.25$ $e$，$q_{\\max}^{\\mathrm{CH}} = 0.20$ $e$，$\\gamma_{\\mathrm{OH}} = 6.00$，$\\gamma_{\\mathrm{CH}} = 6.00$。\n- 将要测试三个反应力场电荷模型：\n    1. 固定电荷 (零电荷): $q_{\\mathrm{O}}^{\\mathrm{FF}}(x) = 0$, $q_{\\mathrm{H}}^{\\mathrm{FF}}(x) = 0$, $q_{\\mathrm{C}}^{\\mathrm{FF}}(x) = 0$。\n    2. 类 QEq 线性响应: $q_{\\mathrm{H}}^{\\mathrm{FF}}(x) = \\beta (x - x_{\\mathrm{TS}})$，$q_{\\mathrm{O}}^{\\mathrm{FF}}(x) = - q_{\\mathrm{H}}^{\\mathrm{FF}}(x)$，$q_{\\mathrm{C}}^{\\mathrm{FF}}(x) = 0$，其中 $\\beta$ 在每个测试案例中指定。\n    3. 类 EEM 饱和模型：与受约束的 DFT 中一样进行电中性叠加，\n$$\nq_{\\mathrm{H}}^{\\mathrm{FF}}(x) = q_{\\mathrm{H,OH}}^{\\mathrm{FF}}(x) + q_{\\mathrm{H,CH}}^{\\mathrm{FF}}(x),\n$$\n$$\nq_{\\mathrm{H,OH}}^{\\mathrm{FF}}(x) = q_{\\max}^{\\mathrm{OH,FF}} \\tanh\\left(\\gamma^{\\mathrm{FF}}(x - x_{\\mathrm{TS}})\\right), \\quad q_{\\mathrm{O}}^{\\mathrm{FF}}(x) = - q_{\\mathrm{H,OH}}^{\\mathrm{FF}}(x),\n$$\n$$\nq_{\\mathrm{H,CH}}^{\\mathrm{FF}}(x) = q_{\\max}^{\\mathrm{CH,FF}} \\tanh\\left(\\gamma^{\\mathrm{FF}}(x_{\\mathrm{TS}} - x)\\right), \\quad q_{\\mathrm{C}}^{\\mathrm{FF}}(x) = - q_{\\mathrm{H,CH}}^{\\mathrm{FF}}(x).\n$$\n\n势垒定义和计算：\n- 对于给定的能量剖面 $E(x)$，内禀势垒定义为\n$$\n\\Delta E^\\ddagger = E(x_{\\mathrm{TS}}^{*}) - E(x_{\\mathrm{R}}^{*}),\n$$\n其中 $x_{\\mathrm{TS}}^{*}$ 是内部窗口 $x \\in [0.30, 0.70]$ 内最大值的坐标，而 $x_{\\mathrm{R}}^{*}$ 是反应物窗口 $x \\in [0.00, 0.20]$ 内最小值的坐标。这模拟了在固定 $x$ 时对其他自由度的约束优化。\n- 计算 $E_{\\mathrm{DFT}}(x)$ 并获得 $\\Delta E_{\\mathrm{DFT}}^\\ddagger$。\n- 对每个 FF 电荷模型，计算 $E_{\\mathrm{FF}}(x)$ 和相应的 $\\Delta E_{\\mathrm{FF}}^\\ddagger$。\n- 报告偏差为\n$$\n\\delta = \\Delta E_{\\mathrm{FF}}^\\ddagger - \\Delta E_{\\mathrm{DFT}}^\\ddagger,\n$$\n单位为 $\\mathrm{eV}$。\n\n数值计算说明：\n- 将 $x$ 在 $[0,1]$ 区间上均匀离散为 $2001$ 个点，以确保极值检测的数值稳定性。\n- 能量必须以 $\\mathrm{eV}$ 计算，距离以 $\\text{\\AA}$ 计算。库仑常数 $k_e$ 必须使用 $\\mathrm{eV}\\cdot\\text{\\AA}/e^2$ 单位。\n- 不使用角度；不需要角度单位。\n- 将每个报告的偏差表示为四舍五入到六位小数的十进制浮点数。\n\n测试套件：\n- 对反应力场电荷模型使用以下四个测试案例：\n    1. 案例 1 (类 QEq): $\\beta = 0.30$ $e$。\n    2. 案例 2 (零电荷): 无参数。\n    3. 案例 3 (类 EEM, 接近 DFT): $q_{\\max}^{\\mathrm{OH,FF}} = 0.23$ $e$，$q_{\\max}^{\\mathrm{CH,FF}} = 0.18$ $e$，$\\gamma^{\\mathrm{FF}} = 4.00$。\n    4. 案例 4 (类 EEM, 过极化): $q_{\\max}^{\\mathrm{OH,FF}} = 0.50$ $e$，$q_{\\max}^{\\mathrm{CH,FF}} = 0.40$ $e$，$\\gamma^{\\mathrm{FF}} = 8.00$。\n\n最终输出规范：\n- 您的程序应生成单行输出，其中包含四个测试案例的偏差（单位为 $\\mathrm{eV}$），四舍五入到六位小数，形式为方括号括起来的逗号分隔列表，例如 $[d_1,d_2,d_3,d_4]$，其中每个 $d_i$ 是案例 $i$ 的偏差。", "solution": "该问题是有效的，因为它在科学上基于计算化学的原理，具有一套完整且一致的数学定义和参数，问题提法适定，并且是可通过计算验证的。它提出了一个定义明确的任务：在一个反应力场框架内，探索不同电荷模型对一个关键化学性质——内禀反应势垒的影响。\n\n解决方案按如下方式从第一性原理构建。系统的总势能 $E(x)$ 被建模为一维反应进程变量 $x \\in [0, 1]$ 的函数。该能量是来自键拉伸和静电相互作用的贡献之和，这与牛顿势能可加性原理一致。\n\n反应体系 C-H-O 的几何结构被简化并映射到反应坐标 $x$ 上。碳-氢键距 $r_{\\mathrm{CH}}(x)$ 和氧-氢键距 $r_{\\mathrm{OH}}(x)$ 随 $x$ 线性变化：\n$$\nr_{\\mathrm{CH}}(x) = r_{\\mathrm{CH}}^{\\mathrm{eq}} + s_{\\mathrm{CH}} x\n$$\n$$\nr_{\\mathrm{OH}}(x) = r_{\\mathrm{OH}}^{\\mathrm{eq}} + s_{\\mathrm{OH}} (1 - x)\n$$\n其中 $r_{\\mathrm{CH}}^{\\mathrm{eq}} = 1.09$ $\\text{\\AA}$，$r_{\\mathrm{OH}}^{\\mathrm{eq}} = 0.97$ $\\text{\\AA}$，以及 $s_{\\mathrm{CH}} = s_{\\mathrm{OH}} = 1.60$ $\\text{\\AA}$。在 $x=0$ 时，系统代表反应物（C-H 键处于平衡状态，O-H 键被拉伸），在 $x=1$ 时，它代表产物（O-H 键处于平衡状态，C-H 键被拉伸）。\n\n每个键的能量由莫尔斯势描述，这是一个物理上精确的键解离模型：\n$$\nE_{\\mathrm{Morse}}(r; D_e, a, r_e) = D_e \\left(1 - e^{-a (r - r_e)}\\right)^2 - D_e\n$$\n该函数在平衡键距 $r=r_e$ 处有最小值 $-D_e$，并在键解离时 ($r \\to \\infty$) 趋近于 $0$。C-H 键的参数为 $D_e^{\\mathrm{CH}} = 4.30$ $\\mathrm{eV}$ 和 $a^{\\mathrm{CH}} = 1.70$ $\\text{\\AA}^{-1}$。对于 O-H 键，参数为 $D_e^{\\mathrm{OH}} = 4.80$ $\\mathrm{eV}$ 和 $a^{\\mathrm{OH}} = 1.80$ $\\text{\\AA}^{-1}$。总键能是这两个键的势能之和：$E_{\\mathrm{bond}}(x) = E_{\\mathrm{Morse}}(r_{\\mathrm{CH}}(x)) + E_{\\mathrm{Morse}}(r_{\\mathrm{OH}}(x))$。\n\n静电能 $E_{\\mathrm{C}}(x)$ 源于 C、H 和 O 原子上部分电荷之间的库仑相互作用。它由以下公式给出：\n$$\nE_{\\mathrm{C}}(x) = k_e\\left(\\frac{q_{\\mathrm{O}}(x) q_{\\mathrm{H}}(x)}{r_{\\mathrm{OH}}(x)} + \\frac{q_{\\mathrm{C}}(x) q_{\\mathrm{H}}(x)}{r_{\\mathrm{CH}}(x)}\\right)\n$$\n其中库仑常数 $k_e = 14.3996$ $\\mathrm{eV}\\cdot\\text{\\AA}/e^2$。部分电荷 $q_i(x)$ 的具体形式取决于所选的能量模型。\n\n总势能为 $E(x) = E_{\\mathrm{bond}}(x) + E_{\\mathrm{C}}(x)$。我们将对一个参考模型和几个力场 (FF) 模型评估此能量。\n\n受约束的密度泛函理论 (DFT) 参考模型的总能量为：\n$$\nE_{\\mathrm{DFT}}(x) = E_{\\mathrm{bond}}(x) + E_{\\mathrm{C}}^{\\mathrm{DFT}}(x)\n$$\n参考电荷被建模为以过渡态 $x_{\\mathrm{TS}} = 0.50$ 为中心的两个饱和电荷转移过程的叠加：\n$$\nq_{\\mathrm{H}}^{\\mathrm{DFT}}(x) = q_{\\mathrm{H,OH}}^{\\mathrm{DFT}}(x) + q_{\\mathrm{H,CH}}^{\\mathrm{DFT}}(x)\n$$\n$$\nq_{\\mathrm{H,OH}}^{\\mathrm{DFT}}(x) = q_{\\max}^{\\mathrm{OH}} \\tanh\\left(\\gamma_{\\mathrm{OH}}(x - x_{\\mathrm{TS}})\\right), \\quad q_{\\mathrm{O}}^{\\mathrm{DFT}}(x) = - q_{\\mathrm{H,OH}}^{\\mathrm{DFT}}(x)\n$$\n$$\nq_{\\mathrm{H,CH}}^{\\mathrm{DFT}}(x) = q_{\\max}^{\\mathrm{CH}} \\tanh\\left(\\gamma_{\\mathrm{CH}}(x_{\\mathrm{TS}} - x)\\right), \\quad q_{\\mathrm{C}}^{\\mathrm{DFT}}(x) = - q_{\\mathrm{H,CH}}^{\\mathrm{DFT}}(x)\n$$\n使用参数 $q_{\\max}^{\\mathrm{OH}} = 0.25$ $e$，$q_{\\max}^{\\mathrm{CH}} = 0.20$ $e$ 和 $\\gamma_{\\mathrm{OH}} = \\gamma_{\\mathrm{CH}} = 6.00$。\n\n反应力场 (FF) 模型使用相同的键能项，但其静电分量 $E_{\\mathrm{C}}^{\\mathrm{FF}}(x)$ 不同，该分量由特定的电荷模型确定：\n1.  **零电荷 FF:** $q_{\\mathrm{O}}^{\\mathrm{FF}}(x) = q_{\\mathrm{H}}^{\\mathrm{FF}}(x) = q_{\\mathrm{C}}^{\\mathrm{FF}}(x) = 0$。\n2.  **类 QEq FF:** 一个线性响应模型，$q_{\\mathrm{H}}^{\\mathrm{FF}}(x) = \\beta (x - x_{\\mathrm{TS}})$，$q_{\\mathrm{O}}^{\\mathrm{FF}}(x) = - q_{\\mathrm{H}}^{\\mathrm{FF}}(x)$，以及 $q_{\\mathrm{C}}^{\\mathrm{FF}}(x) = 0$，其中 $\\beta$ 已指定。\n3.  **类 EEM FF:** 一个饱和模型，其函数形式与 DFT 参考相同，但参数不同：$q_{\\max}^{\\mathrm{OH,FF}}$，$q_{\\max}^{\\mathrm{CH,FF}}$ 和 $\\gamma^{\\mathrm{FF}}$。\n\n内禀反应势垒 $\\Delta E^\\ddagger$ 是过渡态和反应物态之间的能量差：$\\Delta E^\\ddagger = E(x_{\\mathrm{TS}}^{*}) - E(x_{\\mathrm{R}}^{*})$。为了找到这个值，我们首先将反应坐标 $x$ 空间离散为 2001 个点。然后，对于每个能量剖面 $E(x)$，我们在反应物窗口 $x \\in [0.00, 0.20]$ 内定位最小值的坐标 $x_{\\mathrm{R}}^{*}$，并在过渡态窗口 $x \\in [0.30, 0.70]$ 内定位最大值的坐标 $x_{\\mathrm{TS}}^{*}$。\n\n最后一步是计算参考势垒 $\\Delta E_{\\mathrm{DFT}}^\\ddagger$ 以及四个指定的 FF 测试案例中每个案例的势垒 $\\Delta E_{\\mathrm{FF}}^\\ddagger$。然后，每个 FF 模型相对于参考的偏差计算为 $\\delta = \\Delta E_{\\mathrm{FF}}^\\ddagger - \\Delta E_{\\mathrm{DFT}}^\\ddagger$。这些偏差量化了因在反应力场中选择不同电荷模型而引入的误差。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs and compares 1D intrinsic reaction barriers for hydrogen\n    abstraction using a simplified DFT reference and reactive force field models.\n    \"\"\"\n\n    # --- Constants and Parameters ---\n    # Geometry\n    R_CH_EQ = 1.09  # Angstrom\n    R_OH_EQ = 0.97  # Angstrom\n    S_CH = 1.60     # Angstrom\n    S_OH = 1.60     # Angstrom\n\n    # Morse Potential Parameters\n    D_E_CH = 4.30  # eV\n    A_CH = 1.70    # Angstrom^-1\n    D_E_OH = 4.80  # eV\n    A_OH = 1.80    # Angstrom^-1\n\n    # Electrostatics\n    K_E = 14.3996  # eV * Angstrom / e^2\n\n    # DFT Charge Model Parameters\n    X_TS = 0.50\n    Q_MAX_OH_DFT = 0.25  # e\n    Q_MAX_CH_DFT = 0.20  # e\n    GAMMA_OH_DFT = 6.00\n    GAMMA_CH_DFT = 6.00\n\n    # Numerical Parameters\n    N_POINTS = 2001\n    \n    # --- Test Case Definitions ---\n    test_cases = [\n        {'type': 'QEq', 'params': {'beta': 0.30}},\n        {'type': 'Zero', 'params': {}},\n        {'type': 'EEM', 'params': {'q_max_OH_ff': 0.23, 'q_max_CH_ff': 0.18, 'gamma_ff': 4.00}},\n        {'type': 'EEM', 'params': {'q_max_OH_ff': 0.50, 'q_max_CH_ff': 0.40, 'gamma_ff': 8.00}},\n    ]\n\n    # --- Helper Functions ---\n    def morse_potential(r, d_e, a, r_e):\n        return d_e * (1 - np.exp(-a * (r - r_e)))**2 - d_e\n\n    def coulomb_energy(q_O, q_H, q_C, r_OH, r_CH):\n        return K_E * ((q_O * q_H) / r_OH + (q_C * q_H) / r_CH)\n\n    def get_dft_charges(x):\n        q_H_OH = Q_MAX_OH_DFT * np.tanh(GAMMA_OH_DFT * (x - X_TS))\n        q_O = -q_H_OH\n        q_H_CH = Q_MAX_CH_DFT * np.tanh(GAMMA_CH_DFT * (X_TS - x))\n        q_C = -q_H_CH\n        q_H = q_H_OH + q_H_CH\n        return q_O, q_H, q_C\n\n    def get_ff_zero_charges(x):\n        zeros = np.zeros_like(x)\n        return zeros, zeros, zeros\n\n    def get_ff_qeq_charges(x, beta):\n        q_H = beta * (x - X_TS)\n        q_O = -q_H\n        q_C = np.zeros_like(x)\n        return q_O, q_H, q_C\n\n    def get_ff_eem_charges(x, q_max_OH_ff, q_max_CH_ff, gamma_ff):\n        q_H_OH = q_max_OH_ff * np.tanh(gamma_ff * (x - X_TS))\n        q_O = -q_H_OH\n        q_H_CH = q_max_CH_ff * np.tanh(gamma_ff * (X_TS - x))\n        q_C = -q_H_CH\n        q_H = q_H_OH + q_H_CH\n        return q_O, q_H, q_C\n\n    def calculate_barrier(energy_profile, x_coords):\n        # Define search windows based on problem spec\n        # Reactant window: x in [0.00, 0.20]\n        # TS window: x in [0.30, 0.70]\n        reactant_mask = (x_coords >= 0.00)  (x_coords = 0.20)\n        ts_mask = (x_coords >= 0.30)  (x_coords = 0.70)\n        \n        # Find indices within the full array\n        reactant_indices = np.where(reactant_mask)[0]\n        ts_indices = np.where(ts_mask)[0]\n\n        # Find min energy in reactant window\n        min_reactant_idx_local = np.argmin(energy_profile[reactant_mask])\n        min_reactant_idx_global = reactant_indices[min_reactant_idx_local]\n        e_reactant = energy_profile[min_reactant_idx_global]\n        \n        # Find max energy in TS window\n        max_ts_idx_local = np.argmax(energy_profile[ts_mask])\n        max_ts_idx_global = ts_indices[max_ts_idx_local]\n        e_ts = energy_profile[max_ts_idx_global]\n        \n        return e_ts - e_reactant\n\n    # --- Main Calculation ---\n    x = np.linspace(0, 1, N_POINTS)\n    \n    # Calculate geometric and bond energy terms (common to all models)\n    r_ch = R_CH_EQ + S_CH * x\n    r_oh = R_OH_EQ + S_OH * (1 - x)\n    e_bond = morse_potential(r_ch, D_E_CH, A_CH, R_CH_EQ) + \\\n             morse_potential(r_oh, D_E_OH, A_OH, R_OH_EQ)\n\n    # 1. Calculate DFT reference barrier\n    q_O_dft, q_H_dft, q_C_dft = get_dft_charges(x)\n    e_coulomb_dft = coulomb_energy(q_O_dft, q_H_dft, q_C_dft, r_oh, r_ch)\n    e_total_dft = e_bond + e_coulomb_dft\n    barrier_dft = calculate_barrier(e_total_dft, x)\n    \n    deviations = []\n    \n    # 2. Loop through FF test cases and calculate deviations\n    for case in test_cases:\n        model_type = case['type']\n        params = case['params']\n        \n        if model_type == 'QEq':\n            q_O_ff, q_H_ff, q_C_ff = get_ff_qeq_charges(x, params['beta'])\n        elif model_type == 'Zero':\n            q_O_ff, q_H_ff, q_C_ff = get_ff_zero_charges(x)\n        elif model_type == 'EEM':\n            q_O_ff, q_H_ff, q_C_ff = get_ff_eem_charges(x, **params)\n        \n        e_coulomb_ff = coulomb_energy(q_O_ff, q_H_ff, q_C_ff, r_oh, r_ch)\n        e_total_ff = e_bond + e_coulomb_ff\n        barrier_ff = calculate_barrier(e_total_ff, x)\n        \n        deviation = barrier_ff - barrier_dft\n        deviations.append(round(deviation, 6))\n\n    # --- Final Output ---\n    # The order of test cases is: QEq, Zero, EEM-close, EEM-overpolarized\n    # The order in the problem statement is Case 1 (QEq), Case 2 (Zero), Case 3 (EEM-close), Case 4 (EEM-overpolarized)\n    # The code processes them in this order.\n    print(f\"[{','.join(map(str, deviations))}]\")\n\nsolve()\n```", "id": "3485011"}, {"introduction": "在上一练习的基础上，我们现在来改进静电模型。本次实践重点关注库仑阻尼函数在电荷平衡方案中的关键作用，这对于防止在短原子间距下出现非物理行为和正确建模电荷转移至关重要。您将研究不同的阻尼策略——从无阻尼到屏蔽——如何改变势能面的形状和质子转移能垒的高度。[@problem_id:3485014]", "problem": "考虑一个氢键二聚体的一维、共线、三原子模型，其中氧原子一位于坐标 $x=0$ 处，氢原子位于坐标 $x$ 处，氧原子二位于坐标 $x=R$ 处。沿质子转移坐标 $x$ 的总势能被建模为短程键能与通过电荷均衡获得的长程静电能之和。键能由两个独立的、分别对应两个氧-氢间距的莫尔斯势之和给出，\n$$\nE_{\\mathrm{bond}}(x) \\;=\\; \\sum_{b \\in \\{ \\mathrm{O}_1\\text{-}\\mathrm{H},\\, \\mathrm{H}\\text{-}\\mathrm{O}_2 \\}} D_e \\left[1 - e^{-a\\,(r_b(x) - r_e)}\\right]^2,\n$$\n其中 $r_{\\mathrm{O}_1\\text{-}\\mathrm{H}}(x)=x$ 且 $r_{\\mathrm{H}\\text{-}\\mathrm{O}_2}(x)=R-x$。使用以下单位为电子伏特 (eV) 和埃 (Å) 的参数：$D_e = 5.0$ eV, $a=2.2$ Å$^{-1}$ 以及 $r_e = 0.97$ Å。\n\n对于静电能，使用电荷均衡原理：通过最小化二次能量泛函，为原子 $i \\in \\{\\mathrm{O}_1, \\mathrm{H}, \\mathrm{O}_2\\}$ 分配部分电荷 $q_i$\n$$\nE_{\\mathrm{QEq}}(q; x) \\;=\\; \\sum_{i} \\left(\\chi_i\\, q_i + \\tfrac{1}{2} J_i\\, q_i^2\\right) \\;+\\; \\tfrac{1}{2} \\sum_{i \\neq j} k_e\\, \\frac{f(r_{ij}(x))}{r_{ij}(x)}\\, q_i q_j,\n$$\n并服从电中性约束 $\\sum_i q_i = 0$。这里，$r_{ij}(x)$ 是原子间距，$k_e = 14.399645478$ eV·Å，原子特异性参数（单位为 eV）为 $\\chi_{\\mathrm{O}} = 6.6$, $J_{\\mathrm{O}} = 13.364$, $\\chi_{\\mathrm{H}} = 4.528$, 以及 $J_{\\mathrm{H}} = 13.890$。对于两个氧原子，使用相同的参数。原子间距为 $r_{\\mathrm{O}_1\\mathrm{H}}(x)=x$，$r_{\\mathrm{HO}_2}(x)=R-x$ 以及 $r_{\\mathrm{O}_1\\mathrm{O}_2}(x)=R$。阻尼函数 $f(r)$ 修改长程库仑相互作用，且必须从以下三个族中选择：\n- 无阻尼：$f_{\\mathrm{U}}(r) = 1$。\n- 指数趋近于1：$f_{\\mathrm{E}}(r) = 1 - e^{-\\alpha r}$，参数 $\\alpha$ 单位为 Å$^{-1}$。\n- 屏蔽（类ReaxFF）：$f_{\\mathrm{S}}(r) = \\dfrac{r}{\\sqrt{r^2 + \\gamma^2}}$，参数 $\\gamma$ 单位为 Å。\n\n对于每一种 $f(r)$ 的选择，坐标 $x$ 处的总能量为 $E_{\\mathrm{tot}}(x) = E_{\\mathrm{bond}}(x) + E_{\\mathrm{QEq}}(q^*(x); x)$，其中 $q^*(x)$ 是在电中性约束下 $E_{\\mathrm{QEq}}$ 的唯一最小化子。质子转移势垒高度定义为\n$$\n\\Delta E^\\ddagger \\;=\\; \\max_{x \\in [x_{\\min},\\, R - x_{\\min}]} E_{\\mathrm{tot}}(x) \\;-\\; \\min\\left(E_{\\mathrm{tot}}(x_i),\\, E_{\\mathrm{tot}}(x_f)\\right),\n$$\n其中 $x_{\\min} = 0.35$ Å 以避免奇异构型，$x_i = \\max(r_e, x_{\\min})$，以及 $x_f = \\min(R - r_e, R - x_{\\min})$。所有能量必须以 eV 表示。\n\n实现一个程序，该程序：\n- 构建并求解由拉格朗日乘子法在每个格点 $x$ 上强制执行 $\\sum_i q_i = 0$ 约束而产生的电荷均衡线性系统。\n- 将坐标 $x$ 在闭区间 $[x_{\\min},\\, R - x_{\\min}]$ 上使用 $N$ 个点进行均匀离散化，其中 $N = 2001$。\n- 计算每个格点的 $E_{\\mathrm{tot}}(x)$ 并返回如上定义的势垒高度 $\\Delta E^\\ddagger$。\n\n测试组。对于以下每组参数，计算并返回 $\\Delta E^\\ddagger$：\n- 情况 A：$R = 2.6$ Å, $f_{\\mathrm{U}}$。\n- 情况 B：$R = 2.6$ Å, $f_{\\mathrm{E}}$，其中 $\\alpha = 2.0$ Å$^{-1}$。\n- 情况 C：$R = 2.6$ Å, $f_{\\mathrm{S}}$，其中 $\\gamma = 0.6$ Å。\n- 情况 D：$R = 3.0$ Å, $f_{\\mathrm{E}}$，其中 $\\alpha = 2.0$ Å$^{-1}$。\n- 情况 E：$R = 2.4$ Å, $f_{\\mathrm{S}}$，其中 $\\gamma = 0.6$ Å。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[resultA,resultB,resultC,resultD,resultE]”），列表中的每个条目是对应案例（按上述顺序）的浮点数势垒高度（单位为 eV）。不使用角度。所有输出都必须以 eV 为单位，不附带单位符号。", "solution": "该问题要求计算一维共线 O-H-O 模型中的质子转移活化能垒 $\\Delta E^\\ddagger$。沿质子转移坐标 $x$ 的总势能 $E_{\\mathrm{tot}}(x)$ 由两项组成：短程共价键能 $E_{\\mathrm{bond}}(x)$ 和通过电荷均衡方法确定的长程静电能 $E_{\\mathrm{QEq}}(x)$。\n\n首先，核实给定的数据和模型参数在科学上是合理的、自洽的，并且足以得到唯一解。该模型结合了计算化学和材料科学中常用的标准经验势（莫尔斯势）和电荷分配方案（电荷均衡，QEq），尤其是在像 ReaxFF 这样的反应力场中。所有参数都以一致的单位（电子伏特，eV，和埃，Å）提供，并且该问题是适定的（well-posed）。\n\n势能 $E_{\\mathrm{tot}}(x)$ 由下式给出：\n$$\nE_{\\mathrm{tot}}(x) = E_{\\mathrm{bond}}(x) + E_{\\mathrm{QEq}}(q^*(x); x)\n$$\n其中 $x$ 是氢原子的坐标，第一个氧原子 $\\mathrm{O}_1$ 位于 $x=0$，第二个氧原子 $\\mathrm{O}_2$ 位于 $x=R$。$q^*(x)$ 代表在每个坐标 $x$ 处使静电能最小化的原子部分电荷向量。\n\n键能 $E_{\\mathrm{bond}}(x)$ 被建模为两个莫尔斯势之和，一个用于 $\\mathrm{O}_1$-H 键，另一个用于 H-$\\mathrm{O}_2$ 键：\n$$\nE_{\\mathrm{bond}}(x) = D_e \\left[1 - e^{-a\\,(r_{\\mathrm{O}_1\\text{-}\\mathrm{H}}(x) - r_e)}\\right]^2 + D_e \\left[1 - e^{-a\\,(r_{\\mathrm{H}\\text{-}\\mathrm{O}_2}(x) - r_e)}\\right]^2\n$$\n原子间距是质子坐标的函数：$r_{\\mathrm{O}_1\\text{-}\\mathrm{H}}(x) = x$ 和 $r_{\\mathrm{H}\\text{-}\\mathrm{O}_2}(x) = R - x$。给定的参数为 $D_e = 5.0$\\,eV，$a = 2.2$\\,Å$^{-1}$ 和 $r_e = 0.97$\\,Å。\n\n静电能 $E_{\\mathrm{QEq}}(q; x)$ 通过找到原子 $\\{\\mathrm{O}_1, \\mathrm{H}, \\mathrm{O}_2\\}$ 的部分电荷集 $\\{q_1, q_2, q_3\\}$ 来确定，该电荷集最小化能量泛函：\n$$\nE_{\\mathrm{QEq}}(q; x) = \\sum_{i=1}^{3} \\left(\\chi_i q_i + \\tfrac{1}{2} J_i q_i^2\\right) + \\tfrac{1}{2} \\sum_{i \\neq j} k_e \\frac{f(r_{ij}(x))}{r_{ij}(x)} q_i q_j\n$$\n并服从电中性约束 $\\sum_i q_i = 0$。参数是原子电负性 $\\chi_i$ 和硬度 $J_i$。我们已知 $\\chi_{\\mathrm{O}} = 6.6$\\,eV，$J_{\\mathrm{O}} = 13.364$\\,eV，$\\chi_{\\mathrm{H}} = 4.528$\\,eV 以及 $J_{\\mathrm{H}} = 13.890$\\,eV。库仑常数为 $k_e = 14.399645478$\\,eV·Å。函数 $f(r)$ 是一个处理短程相互作用的阻尼函数。\n\n为了找到在约束条件下最小化 $E_{\\mathrm{QEq}}$ 的电荷向量 $q^*(x)$，我们采用拉格朗日乘子法。拉格朗日量 $\\mathcal{L}$ 为：\n$$\n\\mathcal{L}(q_1, q_2, q_3, \\lambda) = E_{\\mathrm{QEq}}(q_1, q_2, q_3; x) - \\lambda \\left(\\sum_{i=1}^{3} q_i\\right)\n$$\n将关于每个 $q_k$ 和 $\\lambda$ 的偏导数设为零，得到一个线性方程组。\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial q_k} = \\chi_k + J_k q_k + \\sum_{j \\neq k} k_e \\frac{f(r_{kj})}{r_{kj}} q_j - \\lambda = 0 \\quad \\text{for } k=1,2,3\n$$\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\lambda} = -\\sum_{i=1}^{3} q_i = 0\n$$\n该系统可以表示为矩阵形式 $M \\mathbf{u} = \\mathbf{b}$，其中 $\\mathbf{u} = [q_1, q_2, q_3, -\\lambda]^T$。\n$$\n\\begin{pmatrix}\nJ_{\\mathrm{O}}  V_{12}  V_{13}  1 \\\\\nV_{21}  J_{\\mathrm{H}}  V_{23}  1 \\\\\nV_{31}  V_{32}  J_{\\mathrm{O}}  1 \\\\\n1  1  1  0\n\\end{pmatrix}\n\\begin{pmatrix}\nq_1 \\\\ q_2 \\\\ q_3 \\\\ -\\lambda\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-\\chi_{\\mathrm{O}} \\\\ -\\chi_{\\mathrm{H}} \\\\ -\\chi_{\\mathrm{O}} \\\\ 0\n\\end{pmatrix}\n$$\n其中 $V_{ij}(x) = k_e f(r_{ij}(x))/r_{ij}(x)$。距离为 $r_{12}=x$, $r_{23}=R-x$, 以及 $r_{13}=R$。该矩阵是对称的，即 $V_{ij} = V_{ji}$。对于每个 $x$ 值，求解这个 $4 \\times 4$ 系统以找到平衡电荷 $q^*(x) = \\{q_1, q_2, q_3\\}$。然后使用这些电荷，通过其定义公式计算 $E_{\\mathrm{QEq}}$。\n\n数值算法如下：\n1. 将质子坐标 $x$ 在闭区间 $[x_{\\min}, R - x_{\\min}]$ 上离散化为 $N=2001$ 个等距点，其中 $x_{\\min}=0.35$\\,Å。\n2. 对于格点上的每个点 $x$，计算总能量 $E_{\\mathrm{tot}}(x)$。这包括：\n    a. 计算 $E_{\\mathrm{bond}}(x)$。\n    b. 构建并求解关于电荷 $q^*(x)$ 的 $4 \\times 4$ 线性系统。\n    c. 计算 $E_{\\mathrm{QEq}}(q^*(x); x)$。\n    d. 将两个能量分量相加。\n3. 确定整个格点上的最大能量值 $\\max_{x} E_{\\mathrm{tot}}(x)$。\n4. 参考能量由反应物和产物态确定。反应物坐标为 $x_i = \\max(r_e, x_{\\min}) = \\max(0.97, 0.35) = 0.97$\\,Å。产物坐标为 $x_f = \\min(R - r_e, R - x_{\\min})$。由于势的对称性（$E_{\\mathrm{tot}}(x) = E_{\\mathrm{tot}}(R-x)$），反应物和产物极小值处的能量相等：$E_{\\mathrm{tot}}(x_i) = E_{\\mathrm{tot}}(x_f)$。因此，参考能量为 $E_{\\mathrm{ref}} = E_{\\mathrm{tot}}(x_i)$。该能量通过在 $x=x_i$ 处进行最终的单独评估来计算。\n5. 质子转移势垒计算为 $\\Delta E^\\ddagger = \\max_{x} E_{\\mathrm{tot}}(x) - E_{\\mathrm{ref}}$。\n\n对五个测试案例中的每一个重复此过程，这些案例的 O-O 距离 $R$ 以及阻尼函数 $f(r)$ 及其参数各不相同。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the proton transfer energy barrier for a 1D O-H-O model.\n    The total energy is the sum of a Morse potential for bonding and a\n    charge-equilibration potential for electrostatics. The barrier is found\n    by scanning the potential energy surface along the proton coordinate.\n    \"\"\"\n\n    # --- Problem Constants ---\n    DE = 5.0  # eV, Morse potential depth\n    A_MORSE = 2.2  # Angstrom^-1, Morse potential width parameter\n    RE = 0.97  # Angstrom, equilibrium O-H bond length\n    KE = 14.399645478  # eV * Angstrom, Coulomb constant\n    CHI_O, J_O = 6.6, 13.364  # eV, O electronegativity and hardness\n    CHI_H, J_H = 4.528, 13.890  # eV, H electronegativity and hardness\n    X_MIN = 0.35  # Angstrom, minimum H coordinate to avoid singularity\n    N_POINTS = 2001  # Number of grid points for discretization\n\n    # --- Damping Functions ---\n    def f_U(r, param):\n        \"\"\"Undamped Coulomb interaction.\"\"\"\n        return 1.0\n\n    def f_E(r, param_alpha):\n        \"\"\"Exponentially damped Coulomb interaction.\"\"\"\n        return 1.0 - np.exp(-param_alpha * r)\n\n    def f_S(r, param_gamma):\n        \"\"\"Shielded (ReaxFF-like) Coulomb interaction.\"\"\"\n        return r / np.sqrt(r**2 + param_gamma**2)\n    \n    # --- Test Cases ---\n    test_cases = [\n        {'R': 2.6, 'func': f_U, 'param': None, 'name': 'A'},\n        {'R': 2.6, 'func': f_E, 'param': 2.0, 'name': 'B'},\n        {'R': 2.6, 'func': f_S, 'param': 0.6, 'name': 'C'},\n        {'R': 3.0, 'func': f_E, 'param': 2.0, 'name': 'D'},\n        {'R': 2.4, 'func': f_S, 'param': 0.6, 'name': 'E'},\n    ]\n    \n    # --- Helper function for total energy calculation ---\n    def get_total_energy_at_x(x, R, f_damping, f_param):\n        \"\"\"\n        Calculates the total potential energy at a given proton coordinate x.\n        \"\"\"\n        # 1. Bond Energy (Morse Potential)\n        r_oh1 = x\n        r_oh2 = R - x\n        morse1 = (1.0 - np.exp(-A_MORSE * (r_oh1 - RE)))**2\n        morse2 = (1.0 - np.exp(-A_MORSE * (r_oh2 - RE)))**2\n        e_bond = DE * (morse1 + morse2)\n\n        # 2. Electrostatic Energy (Charge Equilibration)\n        # Distances for QEq\n        r_o1h, r_ho2, r_o1o2 = x, R - x, R\n\n        # Off-diagonal matrix elements V_ij = k_e * f(r_ij) / r_ij\n        J12 = KE * f_damping(r_o1h, f_param) / r_o1h\n        J23 = KE * f_damping(r_ho2, f_param) / r_ho2\n        J13 = KE * f_damping(r_o1o2, f_param) / r_o1o2\n        \n        # QEq energy matrix A (3x3)\n        A_qeq = np.array([\n            [J_O, J12, J13],\n            [J12, J_H, J23],\n            [J13, J23, J_O]\n        ])\n        \n        # Bordered matrix M for solving the linear system (4x4)\n        M = np.zeros((4, 4))\n        M[:3, :3] = A_qeq\n        M[:3, 3] = 1.0\n        M[3, :3] = 1.0\n        \n        # Right-hand side vector b\n        chi_vec_neg = np.array([-CHI_O, -CHI_H, -CHI_O])\n        b = np.zeros(4)\n        b[:3] = chi_vec_neg\n\n        # Solve for charges q and Lagrange multiplier\n        try:\n            sol = np.linalg.solve(M, b)\n        except np.linalg.LinAlgError:\n            return np.inf # Return infinity if matrix is singular\n        \n        q = sol[:3] # Charges are the first 3 elements\n\n        # Calculate QEq energy using E = chi^T*q + 0.5*q^T*A*q\n        chi_vec_pos = np.array([CHI_O, CHI_H, CHI_O])\n        e_qeq = np.dot(chi_vec_pos, q) + 0.5 * np.dot(q, np.dot(A_qeq, q))\n\n        return e_bond + e_qeq\n\n    results = []\n    for case in test_cases:\n        R = case['R']\n        f_damping = case['func']\n        f_param = case['param']\n\n        # Discretize the proton coordinate x\n        x_grid = np.linspace(X_MIN, R - X_MIN, N_POINTS)\n        \n        # Calculate total energy across the grid\n        energy_profile = np.array([get_total_energy_at_x(x, R, f_damping, f_param) for x in x_grid])\n        \n        # Find the maximum energy on the profile\n        e_max = np.max(energy_profile)\n        \n        # Define reactant/product coordinates\n        x_i = max(RE, X_MIN)\n        # x_f = min(R - RE, R - X_MIN) # Not needed due to symmetry\n        \n        # By symmetry, E_tot(x_i) == E_tot(x_f), so we only need one\n        e_ref = get_total_energy_at_x(x_i, R, f_damping, f_param)\n        \n        # Calculate barrier height\n        barrier_height = e_max - e_ref\n        results.append(barrier_height)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3485014"}, {"introduction": "一个力场的优劣取决于其参数。这最后的实践将从使用力场转向创建力场的根本过程：参数化。您将实现一个复杂的多目标函数，通过最小化该函数来将力场参数拟合到量子力学参考数据。这个练习阐明了如何平衡对能量、力甚至势能面曲率的拟合，从而不仅再现热力学，还能再现反应动力学。[@problem_id:3485001]", "problem": "你的任务是为一个简化的反应力场设计并实现一个组合参数优化目标函数，该力场捕捉了沿单一有效反应坐标的化学反应性。目标是整合来自力、能量和过渡态曲率的信息，以更好地匹配能垒形状和动力学指前因子。你的程序必须为几个候选参数集计算此标量目标函数，并将结果输出在一行中。\n\n使用的基础理论：\n- 牛顿第二定律：$F = m \\, a$ 以及对于势能 $U(x)$ 的保守力定义 $F(x) = -\\frac{\\partial U(x)}{\\partial x}$。\n- 一维坐标的Hessian曲率：$\\lambda(x) = \\frac{\\partial^2 U(x)}{\\partial x^2}$。\n- 过渡态理论（TST）中过渡态的谐振近似：不稳定模式角频率的量值为 $|\\omega_b| = \\sqrt{\\frac{|k|}{m}}$，其中 $k$ 是以 $\\mathrm{N/m}$ 为单位的曲率，$m$ 是以 $\\mathrm{kg}$ 为单位的质量。尝试频率为 $\\nu = \\frac{|\\omega_b|}{2\\pi}$。\n- 使用电子伏特（eV）表示能量 $U$ 和埃（ångström）表示位置所需的单位转换：$1\\,\\mathrm{eV} = 1.602176634\\times 10^{-19}\\,\\mathrm{J}$，$1\\,\\text{\\AA} = 1.0\\times 10^{-10}\\,\\mathrm{m}$，以及 $1\\,\\mathrm{amu} = 1.66053906660\\times 10^{-27}\\,\\mathrm{kg}$。以 $\\mathrm{eV/\\text{\\AA}^2}$ 为单位的曲率通过乘以 $1.602176634\\times 10^{-19} / (1.0\\times 10^{-10})^2$ 转换为 $\\mathrm{N/m}$。\n\n模型和场景：\n- 考虑一个具有双阱势的有效一维反应坐标 $x$，该势可以表示一个反应能垒。势能定义为 $U(x; \\boldsymbol{\\theta}) = \\theta_a \\left(x^2 - \\theta_b^2\\right)^2 + \\theta_c \\, x + \\theta_d$，其中 $\\boldsymbol{\\theta} = (\\theta_a, \\theta_b, \\theta_c, \\theta_d)$ 是参数。\n- 力为 $F(x; \\boldsymbol{\\theta}) = -\\frac{\\partial U(x; \\boldsymbol{\\theta})}{\\partial x}$，曲率（一维Hessian）为 $\\lambda(x; \\boldsymbol{\\theta}) = \\frac{\\partial^2 U(x; \\boldsymbol{\\theta})}{\\partial x^2}$。\n- 假设过渡态（TS）位于 $x_{\\mathrm{ts}} = 0$ 附近，对于给定的形式，当 $\\theta_a  0$ 且 $\\theta_b \\neq 0$ 时，过渡态曲率为负。不稳定模式频率的量值由过渡态处的曲率绝对值计算得出，动力学指前因子为 $\\nu = \\frac{|\\omega_b|}{2\\pi}$。\n\n需要计算的目标函数：\n- 构建一个标量目标函数，该函数聚合了能量匹配、力匹配、过渡态曲率匹配和动力学指前因子匹配的贡献。每个贡献是模型值与参考值之间的残差平方，通过特征尺度进行归一化以使各项无量纲，并乘以一个权重以平衡其影响。能量和力的残差是在一组位置上累积的。对于给定的 $\\boldsymbol{\\theta}$，此目标函数应该是一个实数。\n- 目标函数必须在物理上一致且量纲上协调。归一化由以下尺度提供：$E_{\\mathrm{scale}}$（单位 $\\mathrm{eV}$），$F_{\\mathrm{scale}}$（单位 $\\mathrm{eV/\\text{\\AA}}$），$\\lambda_{\\mathrm{scale}}$（单位 $\\mathrm{eV/\\text{\\AA}^2}$），以及 $\\nu_{\\mathrm{scale}}$（单位 $\\mathrm{s^{-1}}$）。权重是用于力、曲率和指前因子贡献的非负无量纲乘数。\n\n单位：\n- 能量单位必须是 $\\mathrm{eV}$。\n- 位置单位必须是 $\\text{\\AA}$。\n- 力单位必须是 $\\mathrm{eV/\\text{\\AA}}$。\n- 曲率单位必须是 $\\mathrm{eV/\\text{\\AA}^2}$。\n- 指前因子单位必须是 $\\mathrm{s^{-1}}$。\n- 最终目标函数值是无量纲的，并且应该是一个实数。\n\n给定数据：\n- 用于生成参考值（不用于评估）的参考参数：$\\boldsymbol{\\theta}^{\\mathrm{ref}} = (\\theta_a^{\\mathrm{ref}}, \\theta_b^{\\mathrm{ref}}, \\theta_c^{\\mathrm{ref}}, \\theta_d^{\\mathrm{ref}}) = (\\,0.4,\\, 1.0,\\, 0.05,\\, 0.0\\,)$。\n- 反应坐标的质量：$m = 12.0\\,\\mathrm{amu}$。\n- 过渡态坐标：$x_{\\mathrm{ts}} = 0.0\\,\\text{\\AA}$。\n- 用于能量和力评估的位置：$x \\in \\{ -1.5,\\, -1.0,\\, -0.5,\\, 0.0,\\, 0.5,\\, 1.0,\\, 1.5 \\}\\,\\text{\\AA}$。\n- 特征尺度：$E_{\\mathrm{scale}} = 1.0\\,\\mathrm{eV}$，$F_{\\mathrm{scale}} = 1.0\\,\\mathrm{eV/\\text{\\AA}}$，$\\lambda_{\\mathrm{scale}} = 1.0\\,\\mathrm{eV/\\text{\\AA}^2}$，$\\nu_{\\mathrm{scale}} = 1.0\\times 10^{13}\\,\\mathrm{s^{-1}}$。\n- 权重：力的权重 $\\alpha = 1.0$，过渡态曲率的权重 $\\beta = 0.5$，动力学指前因子的权重 $\\gamma = 0.5$。\n\n需要匹配的参考值由 $\\boldsymbol{\\theta}^{\\mathrm{ref}}$ 生成：\n- 对于每个列出的位置 $x$，计算 $U(x;\\boldsymbol{\\theta}^{\\mathrm{ref}})$ 和 $F(x;\\boldsymbol{\\theta}^{\\mathrm{ref}})$。\n- 在 $x_{\\mathrm{ts}}$ 处，计算 $\\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta}^{\\mathrm{ref}})$。将此曲率转换为 $\\mathrm{N/m}$ 来计算 $|\\omega_b|$，然后计算 $\\nu^{\\mathrm{ref}} = \\frac{|\\omega_b|}{2\\pi}$，最终以 $\\mathrm{s^{-1}}$ 为单位表示。\n\n测试集：\n- 为以下候选参数集 $\\boldsymbol{\\theta}$ 评估目标函数：\n  1. $\\boldsymbol{\\theta}^{(1)} = (\\,0.4,\\, 1.0,\\, 0.05,\\, 0.0\\,)$。\n  2. $\\boldsymbol{\\theta}^{(2)} = (\\,0.35,\\, 0.9,\\, 0.04,\\, 0.02\\,)$。\n  3. $\\boldsymbol{\\theta}^{(3)} = (\\,0.2,\\, 0.5,\\, 0.01,\\, -0.01\\,)$。\n  4. $\\boldsymbol{\\theta}^{(4)} = (\\,0.0,\\, 1.0,\\, 0.0,\\, 0.0\\,)$。\n\n你的任务：\n- 从第一性原理出发，使用提供的势能形式推导出计算力、曲率和动力学指前因子所需的表达式，并密切注意单位和转换。\n- 实现一个程序，该程序：\n  - 从 $\\boldsymbol{\\theta}^{\\mathrm{ref}}$ 生成参考能量、力、过渡态曲率和指前因子。\n  - 对于测试集中的每个候选 $\\boldsymbol{\\theta}^{(j)}$，按上述方法计算标量目标函数。\n  - 按照测试集的顺序，生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果：$[J(\\boldsymbol{\\theta}^{(1)}), J(\\boldsymbol{\\theta}^{(2)}), J(\\boldsymbol{\\theta}^{(3)}), J(\\boldsymbol{\\theta}^{(4)})]$。\n\n最终输出格式：\n- 你的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[r_1,r_2,r_3,r_4]$）。", "solution": "我们首先构建一个有效的一维模型，该模型使用解析双阱势来捕捉过渡态附近化学反应性的关键特征。沿反应坐标的势能定义为 $U(x; \\boldsymbol{\\theta}) = \\theta_a \\left(x^2 - \\theta_b^2\\right)^2 + \\theta_c \\, x + \\theta_d$。当 $\\theta_a  0$ 时，该函数形式在 $x \\approx \\pm \\theta_b$ 附近提供两个极小值，由 $x \\approx 0$ 附近的能垒隔开；一个线性项倾斜了势能面以打破对称性。\n\n根据基本原理，保守力定义为 $F(x; \\boldsymbol{\\theta}) = -\\frac{\\partial U(x; \\boldsymbol{\\theta})}{\\partial x}$。对 $U(x; \\boldsymbol{\\theta})$ 求导，我们得到\n$$\n\\frac{\\partial U(x; \\boldsymbol{\\theta})}{\\partial x} = \\theta_a \\, \\frac{\\partial}{\\partial x}\\left(x^2 - \\theta_b^2\\right)^2 + \\theta_c = \\theta_a \\cdot 4x\\left(x^2 - \\theta_b^2\\right) + \\theta_c,\n$$\n因此\n$$\nF(x; \\boldsymbol{\\theta}) = -\\left(4\\theta_a\\, x \\left(x^2 - \\theta_b^2\\right) + \\theta_c \\right).\n$$\n\n一维Hessian曲率是势能对位置的二阶导数，\n$$\n\\lambda(x; \\boldsymbol{\\theta}) = \\frac{\\partial^2 U(x; \\boldsymbol{\\theta})}{\\partial x^2} = \\frac{\\partial}{\\partial x}\\left(4\\theta_a\\, x \\left(x^2 - \\theta_b^2\\right) + \\theta_c\\right) = 4\\theta_a\\left(3x^2 - \\theta_b^2\\right).\n$$\n在过渡态坐标 $x_{\\mathrm{ts}} = 0$ 处，曲率简化为 $\\lambda(x_{\\mathrm{ts}}; \\boldsymbol{\\theta}) = -4 \\theta_a \\theta_b^2$。只要 $\\theta_a  0$ 且 $\\theta_b \\neq 0$，该曲率为负，表明势能沿反应坐标存在一个局域极大值。\n\n为了在谐振近似下根据过渡态理论（TST）计算动力学指前因子，我们使用关系式 $|\\omega_b| = \\sqrt{\\frac{|k|}{m}}$，其中 $k$ 是以 $\\mathrm{N/m}$ 为单位的曲率，$m$ 是以 $\\mathrm{kg}$ 为单位的有效质量。由于我们的曲率以 $\\mathrm{eV/\\text{\\AA}^2}$ 给出，因此需要进行单位转换：\n- $1\\,\\mathrm{eV} = 1.602176634\\times 10^{-19}\\,\\mathrm{J}$,\n- $1\\,\\text{\\AA} = 1.0\\times 10^{-10}\\,\\mathrm{m}$,\n- $1\\,\\mathrm{amu} = 1.66053906660\\times 10^{-27}\\,\\mathrm{kg}$,\n因此\n$$\nk \\;[\\mathrm{N/m}] = \\lambda \\;[\\mathrm{eV/\\text{\\AA}^2}] \\cdot \\frac{1.602176634\\times 10^{-19}\\,\\mathrm{J}}{(1.0\\times 10^{-10}\\,\\mathrm{m})^2}.\n$$\n给定以 $\\mathrm{kg}$ 为单位的质量 $m$，不稳定模式角频率的量值为\n$$\n|\\omega_b| = \\sqrt{\\frac{|k|}{m}},\n$$\n动力学指前因子为\n$$\n\\nu = \\frac{|\\omega_b|}{2\\pi},\n$$\n单位为 $\\mathrm{s^{-1}}$。\n\n我们使用 $\\boldsymbol{\\theta}^{\\mathrm{ref}} = (\\,0.4,\\, 1.0,\\, 0.05,\\, 0.0\\,)$ 生成参考值：\n- 对于每个列出的位置 $x \\in \\{ -1.5,\\, -1.0,\\, -0.5,\\, 0.0,\\, 0.5,\\, 1.0,\\, 1.5 \\}\\,\\text{\\AA}$，使用上面推导的公式计算以 $\\mathrm{eV}$ 为单位的 $U(x;\\boldsymbol{\\theta}^{\\mathrm{ref}})$ 和以 $\\mathrm{eV/\\text{\\AA}}$ 为单位的 $F(x;\\boldsymbol{\\theta}^{\\mathrm{ref}})$。\n- 在 $x_{\\mathrm{ts}} = 0.0\\,\\text{\\AA}$ 处，计算以 $\\mathrm{eV/\\text{\\AA}^2}$ 为单位的 $\\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta}^{\\mathrm{ref}})$，将其转换为以 $\\mathrm{N/m}$ 为单位的 $k$，并使用转换为 $\\mathrm{kg}$ 的质量 $m = 12.0\\,\\mathrm{amu}$，计算以 $\\mathrm{s^{-1}}$ 为单位的 $\\nu^{\\mathrm{ref}}$。\n\n为了获得候选参数集 $\\boldsymbol{\\theta}$ 的标量目标函数，我们聚合四个贡献：\n- 在一组位置上的能量匹配，使用由 $E_{\\mathrm{scale}}^2$ 归一化的残差平方 $(U(x;\\boldsymbol{\\theta}) - U(x;\\boldsymbol{\\theta}^{\\mathrm{ref}}))^2$，\n- 在一组位置上的力匹配，使用由 $F_{\\mathrm{scale}}^2$ 归一化并由 $\\alpha$ 加权的残差平方 $(F(x;\\boldsymbol{\\theta}) - F(x;\\boldsymbol{\\theta}^{\\mathrm{ref}}))^2$，\n- 在 $x_{\\mathrm{ts}}$ 处的过渡态曲率匹配，使用由 $\\lambda_{\\mathrm{scale}}^2$ 归一化并由 $\\beta$ 加权的 $(\\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta}) - \\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta}^{\\mathrm{ref}}))^2$，\n- 动力学指前因子匹配，使用由 $\\nu_{\\mathrm{scale}}^2$ 归一化并由 $\\gamma$ 加权的 $(\\nu(\\boldsymbol{\\theta}) - \\nu^{\\mathrm{ref}})^2$，其中 $\\nu(\\boldsymbol{\\theta})$ 是通过将 $\\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta})$ 转换为以 $\\mathrm{N/m}$ 为单位的 $k$ 并使用质量 $m$ 计算得出的。\n\n特征尺度被设置为 $E_{\\mathrm{scale}} = 1.0\\,\\mathrm{eV}$，$F_{\\mathrm{scale}} = 1.0\\,\\mathrm{eV/\\text{\\AA}}$，$\\lambda_{\\mathrm{scale}} = 1.0\\,\\mathrm{eV/\\text{\\AA}^2}$，以及 $\\nu_{\\mathrm{scale}} = 1.0\\times 10^{13}\\,\\mathrm{s^{-1}}$，以确保量级可比的无量纲贡献。权重选择为 $\\alpha = 1.0$，$\\beta = 0.5$ 和 $\\gamma = 0.5$，以在各项之间平衡重点，同时保留物理尺度。\n\n算法步骤：\n1. 定义用于单位转换的常数以及基于 $\\boldsymbol{\\theta}$ 的势能、力和曲率函数。\n2. 在指定位置上生成参考数组 $U(x;\\boldsymbol{\\theta}^{\\mathrm{ref}})$ 和 $F(x;\\boldsymbol{\\theta}^{\\mathrm{ref}})$，并计算 $\\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta}^{\\mathrm{ref}})$ 和 $\\nu^{\\mathrm{ref}}$。\n3. 对于测试集中的每个候选 $\\boldsymbol{\\theta}$，计算 $U(x;\\boldsymbol{\\theta})$、$F(x;\\boldsymbol{\\theta})$、$\\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta})$ 和 $\\nu(\\boldsymbol{\\theta})$。\n4. 如上所述聚合归一化的残差平方，以获得标量目标函数 $J(\\boldsymbol{\\theta})$。\n5. 将列表 $[J(\\boldsymbol{\\theta}^{(1)}), J(\\boldsymbol{\\theta}^{(2)}), J(\\boldsymbol{\\theta}^{(3)}), J(\\boldsymbol{\\theta}^{(4)})]$ 作为用方括号括起来的单个逗号分隔行输出。\n\n边缘情况：\n- 如果 $\\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta})$ 为零，则不稳定模式频率的量值为零，指前因子 $\\nu$ 也为零，目标函数应能自然处理这种情况。\n- 如果 $\\lambda(x_{\\mathrm{ts}};\\boldsymbol{\\theta})$ 为正，表示在过渡态坐标处没有能垒，计算将使用曲率的绝对值来定义 $|\\omega_b|$ 的量值；曲率和指前因子的不匹配将反映在目标函数中，从而惩罚此类参数集。\n\n此过程提供了一个有物理基础的、无量纲的标量目标函数，它同时拟合能量、力、过渡态曲率和尝试频率指前因子，适用于根据高保真度参考数据校准反应力场，同时保持科学真实性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Unit conversions\nEV_TO_J = 1.602176634e-19         # J/eV\nANGSTROM_TO_M = 1.0e-10           # m/Angstrom\nAMU_TO_KG = 1.66053906660e-27     # kg/amu\n\n# Characteristic scales for normalization (dimensionless objective)\nE_SCALE = 1.0            # eV\nF_SCALE = 1.0            # eV/Angstrom\nLAMBDA_SCALE = 1.0       # eV/Angstrom^2\nNU_SCALE = 1.0e13        # s^-1\n\n# Weights for contributions\nALPHA = 1.0  # force weight\nBETA = 0.5   # curvature weight\nGAMMA = 0.5  # prefactor weight\n\n# Mass and TS coordinate\nMASS_AMU = 12.0          # amu\nX_TS = 0.0               # Angstrom\n\n# Reference parameters to generate reference data\nTHETA_REF = np.array([0.4, 1.0, 0.05, 0.0])  # (theta_a, theta_b, theta_c, theta_d)\n\n# Positions for energy/force evaluation\nX_POINTS = np.array([-1.5, -1.0, -0.5, 0.0, 0.5, 1.0, 1.5])  # Angstrom\n\n\ndef potential_U(x, theta):\n    \"\"\"\n    Potential energy U(x; theta) = theta_a * (x^2 - theta_b^2)^2 + theta_c * x + theta_d\n    Units: U in eV when x in Angstrom and parameters carry corresponding units.\n    \"\"\"\n    a, b, c, d = theta\n    return a * (x**2 - b**2)**2 + c * x + d\n\n\ndef force_F(x, theta):\n    \"\"\"\n    Conservative force F(x; theta) = -dU/dx\n    dU/dx = 4 * theta_a * x * (x^2 - theta_b^2) + theta_c\n    Units: F in eV/Angstrom\n    \"\"\"\n    a, b, c, d = theta\n    return -(4.0 * a * x * (x**2 - b**2) + c)\n\n\ndef hessian_lambda(x, theta):\n    \"\"\"\n    One-dimensional curvature (Hessian) lambda(x; theta) = d^2U/dx^2\n    d^2U/dx^2 = 4 * theta_a * (3*x^2 - theta_b^2)\n    Units: eV/Angstrom^2\n    \"\"\"\n    a, b, c, d = theta\n    return 4.0 * a * (3.0 * x**2 - b**2)\n\n\ndef prefactor_nu_from_lambda(lambda_eVA2, mass_amu):\n    \"\"\"\n    Compute attempt frequency prefactor nu from curvature (lambda) at TS.\n    Uses harmonic TST approximation: |omega_b| = sqrt(|k| / m), nu = |omega_b| / (2*pi).\n    lambda is in eV/Angstrom^2, convert to k (N/m). Mass in amu -> kg.\n    Returns nu in s^-1.\n    \"\"\"\n    # Convert curvature from eV/Angstrom^2 to N/m\n    k_N_per_m = lambda_eVA2 * (EV_TO_J / (ANGSTROM_TO_M**2))\n    # Convert mass to kg\n    mass_kg = mass_amu * AMU_TO_KG\n    # Handle non-positive mass (should not happen here)\n    if mass_kg = 0.0:\n        raise ValueError(\"Mass must be positive.\")\n    # Angular frequency magnitude from absolute curvature\n    omega = np.sqrt(np.abs(k_N_per_m) / mass_kg)\n    nu = omega / (2.0 * np.pi)\n    return nu\n\n\ndef compute_reference_data(theta_ref, x_points, x_ts, mass_amu):\n    \"\"\"\n    Generate reference energies, forces, curvature at TS, and prefactor using theta_ref.\n    \"\"\"\n    E_ref = potential_U(x_points, theta_ref)\n    F_ref = force_F(x_points, theta_ref)\n    lambda_ref = hessian_lambda(x_ts, theta_ref)\n    nu_ref = prefactor_nu_from_lambda(lambda_ref, mass_amu)\n    return E_ref, F_ref, lambda_ref, nu_ref\n\n\ndef objective(theta, x_points, E_ref, F_ref, lambda_ref, nu_ref, x_ts, mass_amu):\n    \"\"\"\n    Compute scalar objective combining normalized squared residuals for:\n      - Energies across x_points\n      - Forces across x_points (weighted by ALPHA)\n      - Curvature at TS (weighted by BETA)\n      - Prefactor (weighted by GAMMA)\n    \"\"\"\n    # Model predictions\n    E_model = potential_U(x_points, theta)\n    F_model = force_F(x_points, theta)\n    lambda_model = hessian_lambda(x_ts, theta)\n    nu_model = prefactor_nu_from_lambda(lambda_model, mass_amu)\n\n    # Residuals normalized by scales\n    energy_residuals = (E_model - E_ref) / E_SCALE\n    force_residuals = (F_model - F_ref) / F_SCALE\n    lambda_residual = (lambda_model - lambda_ref) / LAMBDA_SCALE\n    nu_residual = (nu_model - nu_ref) / NU_SCALE\n\n    # Aggregate squared residuals\n    J_energy = np.sum(energy_residuals**2)\n    J_force = ALPHA * np.sum(force_residuals**2)\n    J_lambda = BETA * (lambda_residual**2)\n    J_nu = GAMMA * (nu_residual**2)\n\n    J_total = float(J_energy + J_force + J_lambda + J_nu)\n    return J_total\n\n\ndef solve():\n    # Build reference data\n    E_ref, F_ref, lambda_ref, nu_ref = compute_reference_data(THETA_REF, X_POINTS, X_TS, MASS_AMU)\n\n    # Define the test cases (candidate parameter sets)\n    test_cases = [\n        np.array([0.4, 1.0, 0.05, 0.0]),   # Case 1: exact match\n        np.array([0.35, 0.9, 0.04, 0.02]), # Case 2: moderate mismatch\n        np.array([0.2, 0.5, 0.01, -0.01]), # Case 3: flatter barrier\n        np.array([0.0, 1.0, 0.0, 0.0]),    # Case 4: no quartic term (edge case)\n    ]\n\n    results = []\n    for theta in test_cases:\n        J = objective(theta, X_POINTS, E_ref, F_ref, lambda_ref, nu_ref, X_TS, MASS_AMU)\n        results.append(J)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3485001"}]}