{"hands_on_practices": [{"introduction": "Car-Parrinello分子动力学（CPMD）模拟的一个核心挑战在于选择合适的虚拟电子质量 $\\mu$。这个参数的设定是一个关键的平衡：它必须足够小，以保证电子自由度能够绝热地跟随离子运动，但又要足够大，以允许使用合理的积分时间步长来提高计算效率。\n\n这项练习将指导你通过一个绝缘体系统的理想化场景，来推导并计算 $\\mu$ 的上限 [@problem_id:3436526]。通过这个实践，你将掌握如何将绝热分离原理与材料的电子能隙和最高离子振动频率等物理量直接联系起来，这是成功设置CPMD模拟的基础。", "problem": "考虑一个绝缘固体的Car-Parrinello分子动力学（CPMD）模拟。虚电子质量参数，记为 $\\mu$，控制着Car-Parrinello拉格朗日量中电子自由度的惯性。为确保快速的电子振荡与较慢的离子运动之间的绝热解耦，要求电子角频率与最高离子角频率的分离因子满足 $\\omega_{e}/\\omega_{\\mathrm{ion}} \\ge 10$。假设该材料的电子能隙为 $\\Delta = 3\\,\\mathrm{eV}$，最高离子振动波数为 $\\tilde{\\nu}_{\\mathrm{ion}} = 1500\\,\\mathrm{cm}^{-1}$。在一致的单位制下进行计算，并将离子频率视为角频率。\n\n利用基本原理推导由该解耦准则所隐含的 $\\mu$ 的上限。然后使用以下常数对该上限进行数值计算：光速 $c = 2.99792458 \\times 10^{8}\\,\\mathrm{m\\,s^{-1}}$ 和电子伏特与焦耳的转换关系 $1\\,\\mathrm{eV} = 1.602176634 \\times 10^{-19}\\,\\mathrm{J}$。将 $\\mu$ 的最终上限以 $\\mathrm{J\\,s^{2}}$ 为单位表示。将你的答案四舍五入到三位有效数字。", "solution": "问题陈述已经过验证，被认为是可靠、适定且具有科学依据的。它展示了计算材料科学中一个关于在Car-Parrinello分子动力学（CPMD）模拟中选择参数的标准情景。所有必要的数据都已提供，目标明确。在给出波数后，“将离子频率视为角频率”这一措辞存在轻微的模糊性。我们将以物理上正确的方式来解释这一点，即使用基本关系 $\\omega = 2\\pi c \\tilde{\\nu}$ 从给定的波数 $\\tilde{\\nu}_{\\mathrm{ion}}$ 计算角频率 $\\omega_{\\mathrm{ion}}$。直接的数值等价在物理上是无意义的，因为它将对应于一个极低的振动频率，与所给的波数不符。经过这一澄清，该问题是完全有效的。\n\nCar-Parrinello分子动力学方法通过为电子自由度引入一个虚构的动能，来同时演化离子位置和电子轨道。这种虚构的动力学由一个用户定义的参数——虚电子质量 $\\mu$ 所控制。总拉格朗日量的形式为：\n$$L_{CP} = \\frac{1}{2}\\mu \\sum_i \\int |\\dot{\\psi}_i(\\mathbf{r},t)|^2 d\\mathbf{r} + \\frac{1}{2}\\sum_I M_I |\\dot{\\mathbf{R}}_I(t)|^2 - E[\\{\\psi_i\\}, \\{\\mathbf{R}_I\\}]$$\n其中 $\\psi_i$ 是电子轨道，$\\mathbf{R}_I$ 是离子位置，$E[\\{\\psi_i\\}, \\{\\mathbf{R}_I\\}]$ 是来自密度泛函理论的总势能。\n\n为使CPMD方案有效，对于任何给定的离子构型，电子子系统必须保持在其基态附近。这就是绝热解耦原理。它要求虚电子运动的特征频率 $\\omega_e$ 远高于物理离子运动的最高频率 $\\omega_{\\mathrm{ion}}$。问题用准则 $\\omega_e / \\omega_{\\mathrm{ion}} \\geq 10$ 指定了这种分离。\n\n对于一个在最高占据分子轨道和最低未占分子轨道（或价带和导带）之间存在电子能隙 $\\Delta$ 的绝缘系统，可以证明虚电子动力学的最低频率与 $\\Delta$ 和 $\\mu$ 的关系如下：\n$$\\omega_e = \\sqrt{\\frac{2\\Delta}{\\mu}}$$\n虚电子质量 $\\mu$ 的单位是能量 $\\times$ 时间$^2$，在国际单位制（SI）中为 $\\mathrm{J\\,s^2}$，这确保了量纲的一致性。\n\n最高的物理离子振动角频率 $\\omega_{\\mathrm{ion}}$，是根据给定的最高离子振动波数 $\\tilde{\\nu}_{\\mathrm{ion}}$，使用以下关系式计算得出的：\n$$\\omega_{\\mathrm{ion}} = 2\\pi c \\tilde{\\nu}_{\\mathrm{ion}}$$\n其中 $c$ 是光速。\n\n现在我们可以结合这些关系来求出 $\\mu$ 的上限。绝热条件是：\n$$\\frac{\\omega_e}{\\omega_{\\mathrm{ion}}} \\geq 10$$\n代入 $\\omega_e$ 的表达式：\n$$\\frac{\\sqrt{\\frac{2\\Delta}{\\mu}}}{\\omega_{\\mathrm{ion}}} \\geq 10$$\n为了找到对 $\\mu$ 的约束，我们整理该不等式：\n$$\\sqrt{\\frac{2\\Delta}{\\mu}} \\geq 10\\,\\omega_{\\mathrm{ion}}$$\n两边平方得到：\n$$\\frac{2\\Delta}{\\mu} \\geq 100\\,\\omega_{\\mathrm{ion}}^2$$\n最后，解出 $\\mu$ 得到其上限：\n$$\\mu \\leq \\frac{2\\Delta}{100\\,\\omega_{\\mathrm{ion}}^2} = \\frac{\\Delta}{50\\,\\omega_{\\mathrm{ion}}^2}$$\n因此，虚电子质量所允许的最大值为 $\\mu_{\\mathrm{max}} = \\frac{\\Delta}{50\\,\\omega_{\\mathrm{ion}}^2}$。\n\n接下来，我们代入 $\\omega_{\\mathrm{ion}}$ 的表达式：\n$$\\mu_{\\mathrm{max}} = \\frac{\\Delta}{50\\,(2\\pi c \\tilde{\\nu}_{\\mathrm{ion}})^2}$$\n\n现在我们使用所给的常数对此表达式进行数值计算，确保所有量都采用国际单位制（SI）的基本单位。\n给定的值为：\n- 电子能隙：$\\Delta = 3\\,\\mathrm{eV}$\n- 最高离子振动波数：$\\tilde{\\nu}_{\\mathrm{ion}} = 1500\\,\\mathrm{cm}^{-1}$\n- 光速：$c = 2.99792458 \\times 10^{8}\\,\\mathrm{m\\,s^{-1}}$\n- 转换因子：$1\\,\\mathrm{eV} = 1.602176634 \\times 10^{-19}\\,\\mathrm{J}$\n\n首先，我们将给定值转换为国际单位制（SI）单位：\n$$\\Delta = 3\\,\\mathrm{eV} \\times 1.602176634 \\times 10^{-19}\\,\\frac{\\mathrm{J}}{\\mathrm{eV}} = 4.806529902 \\times 10^{-19}\\,\\mathrm{J}$$\n$$\\tilde{\\nu}_{\\mathrm{ion}} = 1500\\,\\mathrm{cm}^{-1} \\times \\frac{100\\,\\mathrm{cm}}{1\\,\\mathrm{m}} = 1.5 \\times 10^{5}\\,\\mathrm{m}^{-1}$$\n\n现在，我们计算最高离子角频率 $\\omega_{\\mathrm{ion}}$：\n$$\\omega_{\\mathrm{ion}} = 2\\pi (2.99792458 \\times 10^{8}\\,\\mathrm{m\\,s^{-1}})(1.5 \\times 10^{5}\\,\\mathrm{m}^{-1})$$\n$$\\omega_{\\mathrm{ion}} \\approx 2.82539066 \\times 10^{14}\\,\\mathrm{s}^{-1}$$\n\n有了 $\\omega_{\\mathrm{ion}}$，我们可以计算它的平方：\n$$\\omega_{\\mathrm{ion}}^2 \\approx (2.82539066 \\times 10^{14}\\,\\mathrm{s}^{-1})^2 \\approx 7.9828333 \\times 10^{28}\\,\\mathrm{s}^{-2}$$\n\n最后，我们计算 $\\mu$ 的上限：\n$$\\mu_{\\mathrm{max}} = \\frac{\\Delta}{50\\,\\omega_{\\mathrm{ion}}^2} = \\frac{4.806529902 \\times 10^{-19}\\,\\mathrm{J}}{50 \\times (7.9828333 \\times 10^{28}\\,\\mathrm{s}^{-2})}$$\n$$\\mu_{\\mathrm{max}} = \\frac{4.806529902 \\times 10^{-19}}{3.99141665 \\times 10^{30}}\\,\\mathrm{J\\,s^2}$$\n$$\\mu_{\\mathrm{max}} \\approx 1.204207 \\times 10^{-49}\\,\\mathrm{J\\,s^2}$$\n将结果四舍五入到三位有效数字，我们得到：\n$$\\mu_{\\mathrm{max}} \\approx 1.20 \\times 10^{-49}\\,\\mathrm{J\\,s^2}$$\n该值代表了在满足指定的绝热解耦准则的情况下，模拟中可以使用的最大虚电子质量。一个更大的 $\\mu$ 值会导致较慢的虚电子动力学，从而有能量从电子子系统伪性地转移到离子子系统的风险，并可能导致玻恩-奥本海默近似的失效。", "answer": "$$\\boxed{1.20 \\times 10^{-49}}$$", "id": "3436526"}, {"introduction": "虽然CPMD在绝缘体和宽带隙半导体中非常成功，但其在金属体系中的应用却面临着根本性的挑战。当电子能隙趋近于零时，虚拟电子动力学的频率可能与离子的物理振动频率发生共振，导致能量从离子“泄漏”到电子子系统，从而破坏绝热近似。\n\n本练习要求你构建一个计算模型，用一个耦合谐振子系统来模拟这一关键的失效机制 [@problem_id:3436495]。通过编写代码来复现这种共振现象，你将获得关于CPMD在金属中失效机理的直观物理图像，并能动手验证减小虚拟质量或引入电子温度展宽等常见解决方案的有效性。", "problem": "您需要设计并实现一个最小化的、完全指定的计算实验，该实验需捕捉卡尔-帕里内洛分子动力学 (CPMD) 在金属体系中失效的本质，即能隙趋近于零时的情况。目标现象是离子自由度与电子自由度之间的共振能量转移，此时赝电子固有频率约等于离子振动频率，并评估诸如分数占据涂抹和减小赝电子质量等修正方法的效果。该实验必须被构建为一个纯粹的数学模型，它源自经典拉格朗日力学和线性响应的第一性原理，并实现为一个单一的可运行程序。\n\n请从以下符合背景的基础概念出发：\n- 卡尔-帕里内洛方法引入了一个赝电子质量，记为 $\\mu$，并将电子自由度与离子坐标一同进行动力学处理，以近似绝热分离。当体系是金属性时，即电子能隙 $E_g$ 趋近于零时，绝热分离会失效，从而导致伪能流从离子运动传递到电子模式。\n- 从带有双线性耦合的二次拉格朗日量推导出的欧拉-拉格朗日方程，会得到耦合谐振子方程，这些方程描述了线性响应近似下的离子坐标和有效电子坐标。\n- 质量为 $m$、刚度为 $k$ 的谐振子的固有频率为 $\\omega = \\sqrt{k/m}$。\n\n构建以下无量纲代理模型，以捕捉共振机制和修正方法：\n1. 考虑一个质量为 $M$、振动角频率为 $\\omega_i$ 的单一离子坐标 $x(t)$，它与一个赝质量为 $\\mu$、固有刚度与能隙 $E_g$ 成正比的单一有效电子坐标 $y(t)$ 耦合。在能量对微小位移的二次展开中，势能取为\n$$\nV(x,y) = \\frac{1}{2} M \\omega_i^2 x^2 + \\frac{1}{2} k_{\\mathrm{el}} y^2 + \\kappa x y,\n$$\n其中耦合常数为 $\\kappa$，$k_{\\mathrm{el}} \\propto E_g$。\n2. 在无量纲单位下，令电子刚度为 $k_{\\mathrm{el}} = E_g$，因此赝电子角频率为\n$$\n\\omega_{\\mathrm{el}} = \\sqrt{\\frac{k_{\\mathrm{el}}}{\\mu}} = \\sqrt{\\frac{E_g}{\\mu}}.\n$$\n3. 为了表示有限电子温度下分数占据涂抹 $f(\\epsilon)$ 的效应，为电子模式引入一个唯象的瑞利耗散函数，\n$$\n\\mathcal{R} = \\frac{1}{2} \\eta \\dot{y}^2,\n$$\n其中 $\\eta$ 是一个有效阻尼系数，它随涂抹宽度（或电子温度）单调增加。这会在电子的运动方程中产生一个线性摩擦项 $\\eta \\dot{y}$。\n\n在这些假设下，并设 $M = 1$（无量纲化），耦合运动方程变为\n$$\n\\ddot{x} + \\omega_i^2 x + \\frac{\\kappa}{M} y = 0, \\quad \\ddot{y} + \\frac{\\eta}{\\mu} \\dot{y} + \\omega_{\\mathrm{el}}^2 y + \\frac{\\kappa}{\\mu} x = 0,\n$$\n初始条件为\n$$\nx(0) = x_0, \\quad \\dot{x}(0) = v_{x,0}, \\quad y(0) = y_0, \\quad \\dot{y}(0) = v_{y,0}.\n$$\n定义瞬时离子能量（不包括耦合项）为\n$$\nE_i(t) = \\frac{1}{2} M \\dot{x}(t)^2 + \\frac{1}{2} M \\omega_i^2 x(t)^2,\n$$\n并相应地定义初始离子能量 $E_i(0)$。定义用于诊断CP失效的量，即分数离子能量转移\n$$\n\\Phi = \\frac{E_i(0) - \\min_{t \\in [0,T]} E_i(t)}{E_i(0)},\n$$\n在一个有限的模拟时域 $[0,T]$ 内。大的 $\\Phi$ 值表示有显著的能量从离子模式流向电子模式（CP失效），而修正方法应能减小 $\\Phi$。\n\n实现一个四阶龙格-库塔时间积分方法来求解上述系统，并为一组测试算例计算 $\\Phi$。整个过程使用无量纲单位，其中 $M = 1$ 且 $x_0 = 1, v_{x,0} = 0, y_0 = 0, v_{y,0} = 0$。在所有算例中，使用统一的时间步长 $\\Delta t$ 和总时间 $T$。如果在 $E_g \\to 0$ 的边界情况下振幅出现数值不稳定性增长，当 $|x|$ 或 $|y|$ 超过一个大阈值时提前终止，并报告截至该点计算出的 $\\Phi$。\n\n您的程序必须为以下测试套件计算 $\\Phi$，该套件用于探究共振、修正方法和边界情况：\n- 算例A（共振基线）：$\\omega_i = 0.2$, $E_g = 0.2$, $\\mu = 5.0$, $\\kappa = 0.05$, $\\eta = 0.0$, $T = 50.0$, $\\Delta t = 0.01$。该设置使得 $\\omega_{\\mathrm{el}} \\approx \\omega_i$，应表现出强烈的共振转移。\n- 算例B（减小$\\mu$的修正）：$\\omega_i = 0.2$, $E_g = 0.2$, $\\mu = 0.5$, $\\kappa = 0.05$, $\\eta = 0.0$, $T = 50.0$, $\\Delta t = 0.01$。减小 $\\mu$ 会增大 $\\omega_{\\mathrm{el}}$，从而产生失谐。\n- 算例C（涂抹修正）：$\\omega_i = 0.2$, $E_g = 0.2$, $\\mu = 5.0$, $\\kappa = 0.05$, $\\eta = 0.1$, $T = 50.0$, $\\Delta t = 0.01$。有限的 $\\eta$ 模拟了来自小数占据涂抹 $f(\\epsilon)$ 的阻尼，从而减少共振转移。\n- 算例D（无能隙边界）：$\\omega_i = 0.2$, $E_g = 0.0$, $\\mu = 5.0$, $\\kappa = 0.05$, $\\eta = 0.0$, $T = 50.0$, $\\Delta t = 0.01$。该算例探索 $E_g \\to 0$ 的极限情况；可能会发生不稳定性。\n- 算例E（弱耦合）：$\\omega_i = 0.2$, $E_g = 0.2$, $\\mu = 5.0$, $\\kappa = 0.001$, $\\eta = 0.0$, $T = 50.0$, $\\Delta t = 0.01$。该算例测试即使在共振附近，趋于零的耦合也会抑制能量转移。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[resultA,resultB,resultC,resultD,resultE]”），其中每个条目是对应算例计算出的 $\\Phi$ 值，表示为浮点数。不应打印任何其他文本。所有量均为无量纲；无需物理单位。", "solution": "该问题提出了一个有效且适定的计算实验，用以模拟卡尔-帕里内洛分子动力学（CPMD）在金属体系中的失效现象。它在科学上基于经典力学和线性响应理论的原理，为一个复杂的量子现象提供了一个简化但在机理上正确的代理模型。该问题是自洽的，所有必要的参数、方程和初始条件都已明确指定。我将开始进行求解。\n\n问题的核心是求解一个耦合线性二阶常微分方程（ODE）组，并分析模式间的能量转移。求解方法包括四个主要步骤：将运动方程形式化为状态空间表示，随时间对这些方程进行数值积分，计算代表能量转移的诊断量，以及将此过程应用于指定的测试算例。\n\n### 1. 运动方程的状态空间表述\n\n给定的动力学系统包含两个耦合的二阶常微分方程，分别描述离子坐标 $x(t)$ 和赝电子坐标 $y(t)$：\n$$\n\\ddot{x} + \\omega_i^2 x + \\frac{\\kappa}{M} y = 0\n$$\n$$\n\\ddot{y} + \\frac{\\eta}{\\mu} \\dot{y} + \\omega_{\\mathrm{el}}^2 y + \\frac{\\kappa}{\\mu} x = 0\n$$\n其中 $\\omega_{\\mathrm{el}} = \\sqrt{E_g/\\mu}$。\n为了进行数值积分，标准做法是将该系统转换为一组一阶常微分方程。我们定义一个状态向量 $S(t)$，它包含两个坐标的位置和速度：\n$$\nS(t) = \\begin{bmatrix} s_0(t) \\\\ s_1(t) \\\\ s_2(t) \\\\ s_3(t) \\end{bmatrix} = \\begin{bmatrix} x(t) \\\\ \\dot{x}(t) \\\\ y(t) \\\\ \\dot{y}(t) \\end{bmatrix}\n$$\n系统的随时间演化可由矩阵方程 $\\dot{S}(t) = f(t, S(t))$ 描述，其中 $f$ 是一个返回状态向量时间导数的函数。根据定义，$\\dot{s}_0 = \\dot{x} = s_1$ 且 $\\dot{s}_2 = \\dot{y} = s_3$。二阶导数由运动方程给出：\n$$\n\\dot{s}_1 = \\ddot{x} = -\\omega_i^2 s_0 - \\frac{\\kappa}{M} s_2\n$$\n$$\n\\dot{s}_3 = \\ddot{y} = -\\frac{\\kappa}{\\mu} s_0 - \\omega_{\\mathrm{el}}^2 s_2 - \\frac{\\eta}{\\mu} s_3\n$$\n这就给出了待求解的完整一阶系统，其初始条件向量为 $S(0) = [x_0, v_{x,0}, y_0, v_{y,0}]^T = [1, 0, 0, 0]^T$ 且 $M=1$。\n\n### 2. 通过四阶龙格-库塔（RK4）方法进行数值积分\n\n状态向量 $S(t)$ 从初始时间 $t_n$ 到 $t_{n+1} = t_n + \\Delta t$ 的时间演化使用四阶龙格-库塔（RK4）方法计算。这是一种鲁棒且广泛使用的数值方案，对于给定的时间步长 $\\Delta t$ 能提供高精度。对于一个泛型常微分方程 $\\dot{S} = f(S)$，单步RK4计算如下：\n$$\n\\begin{align*}\nk_1 = \\Delta t \\cdot f(S_n) \\\\\nk_2 = \\Delta t \\cdot f(S_n + k_1/2) \\\\\nk_3 = \\Delta t \\cdot f(S_n + k_2/2) \\\\\nk_4 = \\Delta t \\cdot f(S_n + k_3) \\\\\nS_{n+1} = S_n + \\frac{1}{6}(k_1 + 2k_2 + 2k_3 + k_4)\n\\end{align*}\n$$\n该算法被实现用于以 $\\Delta t$ 为离散步长，将状态向量 $S(t)$ 从 $t=0$ 传播到最终时间 $T$。程序中包含一个检查，如果任一坐标的振幅 $|x(t)|$ 或 $|y(t)|$ 超过一个大阈值（例如 $100$），则终止模拟，这表明出现了数值不稳定性，尤其与无能隙情况（$E_g=0$）相关。\n\n### 3. 诊断量 $\\Phi$ 的计算\n\n主要诊断量 $\\Phi$ 衡量从离子振子转移出去的能量分数。离子模式的瞬时能量定义为：\n$$\nE_i(t) = \\frac{1}{2} M \\dot{x}(t)^2 + \\frac{1}{2} M \\omega_i^2 x(t)^2\n$$\n$\\Phi$ 的值在模拟时间 $[0, T]$ 内计算：\n$$\n\\Phi = \\frac{E_i(0) - \\min_{t \\in [0,T]} E_i(t)}{E_i(0)}\n$$\n算法流程如下：\n1.  使用初始条件 $x(0)=1, \\dot{x}(0)=0$ 计算初始离子能量 $E_i(0)$。可得 $E_i(0) = \\frac{1}{2} M \\omega_i^2$。\n2.  将变量 $\\min E_i$ 初始化为 $E_i(0)$。\n3.  在RK4时间步进循环中，每一步之后，使用新计算出的状态分量 $x(t)$ 和 $\\dot{x}(t)$ 计算当前离子能量 $E_i(t)$。\n4.  更新 $\\min E_i = \\min(\\min E_i, E_i(t))$。\n5.  模拟完成（或因不稳定性而终止）后，使用记录的初始和最小离子能量计算 $\\Phi$ 的最终值。如果 $E_i(0)=0$（此处情况并非如此），则 $\\Phi$ 为 $0$。\n\n### 4. 测试套件的实现\n\n上述过程被封装到一个函数中，该函数接受物理参数（$\\omega_i, E_g, \\mu, \\kappa, \\eta$）和模拟参数（$T, \\Delta t$）作为输入。然后为问题陈述中指定的五个测试算例（A-E）中的每一个调用该函数。每个算例得到的 $\\Phi$ 值被存储起来。最后，将收集到的结果格式化为最终输出所要求的、包含在方括号内的单一逗号分隔字符串。该实现使用 `numpy` 库进行高效的向量和矩阵运算，这对于状态空间表示和RK4计算是理想的选择。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the coupled oscillator model for Car-Parrinello breakdown\n    and computes the fractional ionic energy transfer for a suite of test cases.\n    \"\"\"\n\n    def run_simulation(params):\n        \"\"\"\n        Runs a single simulation for a given set of parameters.\n\n        Args:\n            params (tuple): A tuple containing the parameters\n                            (wi, Eg, mu, kappa, eta, T, dt).\n\n        Returns:\n            float: The computed value of the fractional energy transfer Phi.\n        \"\"\"\n        # Unpack parameters from the input tuple\n        wi, Eg, mu, kappa, eta, T, dt = params\n\n        # Fixed physical and initial conditions from the problem statement\n        M = 1.0\n        x0, vx0, y0, vy0 = 1.0, 0.0, 0.0, 0.0\n\n        # Derived parameters for the equations of motion\n        if mu = 0:\n            raise ValueError(\"Fictitious mass mu must be positive.\")\n        wel_sq = Eg / mu\n\n        # Define the system of first-order ODEs: S' = f(S)\n        # where S = [x, vx, y, vy]\n        def f(S):\n            x, vx, y, vy = S\n            x_dot = vx\n            vx_dot = -wi**2 * x - (kappa / M) * y\n            y_dot = vy\n            vy_dot = -(kappa / mu) * x - wel_sq * y - (eta / mu) * vy\n            return np.array([x_dot, vx_dot, y_dot, vy_dot])\n\n        # Initial state vector\n        S = np.array([x0, vx0, y0, vy0], dtype=float)\n\n        # Simulation time steps\n        num_steps = int(T / dt)\n\n        # Calculate initial ionic energy\n        E_i_initial = 0.5 * M * vx0**2 + 0.5 * M * wi**2 * x0**2\n        \n        # If initial energy is zero, no transfer can be measured.\n        if E_i_initial == 0:\n            return 0.0\n            \n        min_E_i = E_i_initial\n\n        # Define a large threshold for numerical instability\n        instability_threshold = 100.0\n\n        # Main RK4 integration loop\n        for _ in range(num_steps):\n            # Check for numerical instability before the next step\n            x, _, y, _ = S\n            if abs(x) > instability_threshold or abs(y) > instability_threshold:\n                break\n\n            # Fourth-Order Runge-Kutta (RK4) step\n            k1 = dt * f(S)\n            k2 = dt * f(S + 0.5 * k1)\n            k3 = dt * f(S + 0.5 * k2)\n            k4 = dt * f(S + k3)\n            S += (k1 + 2 * k2 + 2 * k3 + k4) / 6.0\n            \n            # Extract current ionic position and velocity from state vector\n            x_current, vx_current = S[0], S[1]\n            \n            # Calculate current ionic energy\n            E_i_current = 0.5 * M * vx_current**2 + 0.5 * M * wi**2 * x_current**2\n            \n            # Update the minimum ionic energy observed\n            if E_i_current  min_E_i:\n                min_E_i = E_i_current\n                \n        # Calculate the final diagnostic quantity Phi\n        phi = (E_i_initial - min_E_i) / E_i_initial\n        return phi\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (omega_i, E_g, mu, kappa, eta, T, dt)\n    test_cases = [\n        (0.2, 0.2, 5.0, 0.05, 0.0, 50.0, 0.01),   # Case A: Resonant baseline\n        (0.2, 0.2, 0.5, 0.05, 0.0, 50.0, 0.01),   # Case B: Reduced mu remedy\n        (0.2, 0.2, 5.0, 0.05, 0.1, 50.0, 0.01),   # Case C: Smearing remedy\n        (0.2, 0.0, 5.0, 0.05, 0.0, 50.0, 0.01),   # Case D: Gapless boundary\n        (0.2, 0.2, 5.0, 0.001, 0.0, 50.0, 0.01),  # Case E: Weak coupling\n    ]\n\n    results = []\n    for case_params in test_cases:\n        phi_value = run_simulation(case_params)\n        results.append(phi_value)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3436495"}, {"introduction": "在设置了初始参数并了解了潜在的失效模式之后，一个自然而然的问题是：在漫长的模拟过程中，我们如何确信电子系统始终保持在瞬时基态上？为此，我们需要一个能够实时监控绝热性的“诊断工具”。\n\n这项实践将引导你从第一性原理出发，推导并实现一个用于评估绝热跟随程度的量化指标 [@problem_id:3436517]。通过计算瞬时本征态在时间演化中的交叠，并将其与能隙相关联，你将构建一个可以在模拟过程中实时使用的诊断工具，这对于确保CPMD模拟结果的有效性和物理意义至关重要。", "problem": "考虑卡尔-帕里内洛分子动力学（Car-Parrinello molecular dynamics, CPMD），其中电子自由度被赋予一个虚拟质量进行演化，从而随着离子构型的演变而绝热地停留在瞬时基态流形上。一个核心要求是绝热跟随：已占据电子态 $\\psi_i(t)$ 应保持在瞬时基态子空间内，泄漏到激发态的振幅可以忽略不计。从含时薛定谔方程和绝热定理出发，可以构建一个无量纲的、在线诊断量 $P_{\\text{exc}}(t)$，它利用相邻时刻的瞬时本征态之间的交叠和瞬时能隙来量化在时间 $t$ 的瞬时激发倾向。\n\n请仅从适用于计算材料科学和含时量子力学的第一性原理出发，并且不使用本问题陈述中的任何捷径公式，推导一个 $P_{\\text{exc}}(t)$ 的离散时间估计量，该估计量使用：\n- 在每个时间步从瞬时标准正交集 $\\{\\psi_n(t)\\}$ 构建的跨时交叠矩阵元 $C_{mn}(t) = \\langle \\psi_m(t) | \\psi_n(t+\\Delta t)\\rangle$，\n- 一种平行输运规范选择，使得已占据态的自交叠最大限度地平滑，\n- 在时间 $t$ 时，激发态 $n$ 和已占据态 $i$ 之间的瞬时角频率差 $\\omega_{ni}(t)$。\n\n假设 $P_{\\text{exc}}(t)$ 是无量纲的。您的估计量必须依赖于 $\\psi_i(t)$ 的离散时间导数在激发子空间上的投影的绝对值平方，除以相应角频率差的平方，并对用户指定的激发态指标集进行求和。时间步长 $\\Delta t$ 的使用必须与角频率差的单位保持一致：如果 $\\Delta t$ 的单位是飞秒，则 $\\omega_{ni}(t)$ 的单位必须是弧度/飞秒。为解决简并附近的潜在数值不稳定性，通过在估计量中将任何小于 $\\omega_{\\min}$ 的 $\\omega_{ni}(t)$ 替换为 $\\omega_{\\min}$，来施加一个最小有效频率差 $\\omega_{\\min}$。\n\n为可接受的绝热跟随设置一个判定阈值 $P_{\\text{thr}}$：如果 $P_{\\text{exc}}(t) \\le P_{\\text{thr}}$，则绝热性是可接受的，否则是不可接受的。对于以下所有测试用例，使用 $P_{\\text{thr}} = 10^{-3}$ 和 $\\omega_{\\min} = 10^{-3}$ 弧度/飞秒。所有计算都应正确处理复数交叠（使用绝对值平方），并且所有求和都应限制在指定的激发态指标内。\n\n实现一个完整的程序，该程序：\n1. 构建一组测试用例，每个用例提供 $C(t)$、$\\Delta t$、一个已占据态指标 $i$、一个激发态指标列表，以及这些激发态指标对应的角频率差 $\\omega_{ni}(t)$ 的映射。\n2. 对每个用例，使用您推导的估计量计算诊断量 $P_{\\text{exc}}(t)$，并通过与 $P_{\\text{thr}}$ 比较，将其分类为可接受或不可接受。\n3. 生成单行输出，其中包含所有用例的布尔结果，格式为方括号内以逗号分隔的列表（例如，$\\texttt{[True,False,...]}$）。\n\n使用以下测试套件，其中时间单位为飞秒，角频率单位为弧度/飞秒。每个测试用例都是独立的，并且应在单个时间点 $t$ 进行评估。\n\n- 测试用例 1（理想情况，多能级，小耦合）：\n  - $\\Delta t = 0.1$ 飞秒，\n  - 已占据态指标 $i = 0$，\n  - 激发态指标 $\\{1,2\\}$，\n  - 跨时交叠矩阵\n    $$\n    C(t) = \\begin{pmatrix}\n    0.99999  0.00010  -0.00005 \\\\\n    0.00200 + 0.00050\\,\\mathrm{i}  0.99990  0.00000 \\\\\n    0.00150 - 0.00020\\,\\mathrm{i}  -0.00030  0.99995\n    \\end{pmatrix},\n    $$\n  - 频率差 $\\omega_{10}(t) = 8.0$, $\\omega_{20}(t) = 12.0$。\n\n- 测试用例 2（临界绝热性，双能级，复数交叠精确阈值）：\n  - $\\Delta t = 0.1$ 飞秒，\n  - 已占据态指标 $i = 0$，\n  - 激发态指标 $\\{1\\}$，\n  - 跨时交叠矩阵\n    $$\n    C(t) = \\begin{pmatrix}\n    0.99900  0.00000 \\\\\n    0.0316227766\\,\\mathrm{i}  1.00000\n    \\end{pmatrix},\n    $$\n  - 频率差 $\\omega_{10}(t) = 10.0$。\n\n- 测试用例 3（违例，双能级，较大耦合）：\n  - $\\Delta t = 0.1$ 飞秒，\n  - 已占据态指标 $i = 0$，\n  - 激发态指标 $\\{1\\}$，\n  - 跨时交叠矩阵\n    $$\n    C(t) = \\begin{pmatrix}\n    0.99900  0.00000 \\\\\n    0.05000  1.00000\n    \\end{pmatrix},\n    $$\n  - 频率差 $\\omega_{10}(t) = 10.0$。\n\n- 测试用例 4（近简并激发态，截断生效）：\n  - $\\Delta t = 0.1$ 飞秒，\n  - 已占据态指标 $i = 0$，\n  - 激发态指标 $\\{1\\}$，\n  - 跨时交叠矩阵\n    $$\n    C(t) = \\begin{pmatrix}\n    1.00000  0.00000  0.00000 \\\\\n    0.00010  1.00000  0.00000 \\\\\n    0.00000  0.00000  1.00000\n    \\end{pmatrix},\n    $$\n  - 频率差 $\\omega_{10}(t) = 10^{-5}$。\n\n- 测试用例 5（边界条件，零耦合）：\n  - $\\Delta t = 0.1$ 飞秒，\n  - 已占据态指标 $i = 0$，\n  - 激发态指标 $\\{1\\}$，\n  - 跨时交叠矩阵\n    $$\n    C(t) = \\begin{pmatrix}\n    1.00000  0.00000 \\\\\n    0.00000  1.00000\n    \\end{pmatrix},\n    $$\n  - 频率差 $\\omega_{10}(t) = 5.0$。\n\n您的程序应生成单行输出，其中包含方括号内的逗号分隔列表形式的结果（例如，$\\texttt{[result1,result2,result3,result4,result5]}$）。每个条目必须是一个布尔值，如果用例是可接受的（$P_{\\text{exc}}(t) \\le P_{\\text{thr}}$），则为 $\\texttt{True}$，否则为 $\\texttt{False}$。", "solution": "该问题要求在卡尔-帕里内洛分子动力学（CPMD）框架内，为瞬时激发倾向 $P_{\\text{exc}}(t)$ 推导一个离散时间估计量。该估计量用作绝热性的诊断工具。推导必须从第一性原理出发，并使用所提供的量：瞬时标准正交本征态之间的跨时交叠矩阵 $C_{mn}(t) = \\langle \\psi_m(t) | \\psi_n(t+\\Delta t)\\rangle$、时间步长 $\\Delta t$ 以及瞬时角频率差 $\\omega_{ni}(t)$。\n\n设 $\\{\\psi_k(t)\\}$ 是系统在时间 $t$ 的哈密顿量 $\\hat{H}(t)$ 的一组瞬时标准正交本征态，其对应的本征能量为 $E_k(t)$。\n$$\n\\hat{H}(t) |\\psi_k(t)\\rangle = E_k(t) |\\psi_k(t)\\rangle\n$$\n问题要求一个依赖于已占据态 $|\\psi_i(t)\\rangle$ 的离散时间导数在激发态子空间上的投影的估计量。\n\n瞬时本征态 $|\\psi_i(t)\\rangle$ 的离散时间导数可以通过在时间步长 $\\Delta t$ 上的向前差分格式来近似：\n$$\n|\\dot{\\psi}_i(t)\\rangle \\approx \\frac{|\\psi_i(t+\\Delta t)\\rangle - |\\psi_i(t)\\rangle}{\\Delta t}\n$$\n态 $|\\psi_i(t+\\Delta t)\\rangle$ 是 $\\hat{H}(t+\\Delta t)$ 的一个本征态。它可以在时间 $t$ 的本征态完备基 $\\{|\\psi_m(t)\\rangle\\}$ 中展开：\n$$\n|\\psi_i(t+\\Delta t)\\rangle = \\sum_m |\\psi_m(t)\\rangle \\langle \\psi_m(t) | \\psi_i(t+\\Delta t) \\rangle\n$$\n根据定义，跨时交叠矩阵元为 $C_{mi}(t) = \\langle \\psi_m(t) | \\psi_i(t+\\Delta t) \\rangle$。因此，我们可以写出：\n$$\n|\\psi_i(t+\\Delta t)\\rangle = \\sum_m C_{mi}(t) |\\psi_m(t)\\rangle\n$$\n将此展开式代入离散时间导数中，得到：\n$$\n|\\dot{\\psi}_i(t)\\rangle \\approx \\frac{1}{\\Delta t} \\left( \\sum_m C_{mi}(t) |\\psi_m(t)\\rangle - |\\psi_i(t)\\rangle \\right)\n$$\n利用 $|\\psi_i(t)\\rangle = \\sum_m \\delta_{mi} |\\psi_m(t)\\rangle$ 这一事实，我们可以合并这些项：\n$$\n|\\dot{\\psi}_i(t)\\rangle \\approx \\frac{1}{\\Delta t} \\sum_m (C_{mi}(t) - \\delta_{mi}) |\\psi_m(t)\\rangle\n$$\n这个表达式可以分解为沿 $|\\psi_i(t)\\rangle$ 的分量和在与其正交的子空间（相对于态 $i$ 的激发子空间）中的分量：\n$$\n|\\dot{\\psi}_i(t)\\rangle \\approx \\frac{1}{\\Delta t} \\left( (C_{ii}(t) - 1) |\\psi_i(t)\\rangle + \\sum_{n \\neq i} C_{ni}(t) |\\psi_n(t)\\rangle \\right)\n$$\n问题指定估计量应使用此时间导数在激发子空间上的投影。到该子空间的投影算符为 $\\hat{P}_{\\text{exc}} = \\sum_{n \\neq i} |\\psi_n(t)\\rangle\\langle\\psi_n(t)|$。将此算符应用于我们对 $|\\dot{\\psi}_i(t)\\rangle$ 的近似，得到投影矢量：\n$$\n\\hat{P}_{\\text{exc}} |\\dot{\\psi}_i(t)\\rangle \\approx \\frac{1}{\\Delta t} \\sum_{n \\neq i} C_{ni}(t) |\\psi_n(t)\\rangle\n$$\n问题要求使用一个与“投影的绝对值平方”相关的量，我们将其解释为来自每个激发态 $|\\psi_n(t)\\rangle$ 对该投影矢量的贡献。该投影矢量沿特定激发态 $|\\psi_n(t)\\rangle$（对于 $n \\neq i$）的分量是：\n$$\n\\frac{1}{\\Delta t} C_{ni}(t) |\\psi_n(t)\\rangle\n$$\n该分量矢量的模方（绝对值平方）是：\n$$\n\\left\\| \\frac{1}{\\Delta t} C_{ni}(t) |\\psi_n(t)\\rangle \\right\\|^2 = \\left( \\frac{1}{\\Delta t} \\right)^2 |C_{ni}(t)|^2 \\langle \\psi_n(t)|\\psi_n(t)\\rangle = \\frac{|C_{ni}(t)|^2}{(\\Delta t)^2}\n$$\n该项表示瞬时本征态 $|\\psi_i(t)\\rangle$ 向激发态 $|\\psi_n(t)\\rangle$ 方向旋转的速率的平方。在含时微扰理论的背景下，非绝热跃迁的概率与此类耦合项成正比，但与态间能隙的平方成反比。\n\n问题要求构建一个无量纲估计量 $P_{\\text{exc}}(t)$，方法是将上述项除以角频率差的平方 $\\omega_{ni}(t)^2$，其中 $\\omega_{ni}(t) = E_n(t) - E_i(t)$（假设在原子单位中 $\\hbar=1$）。然后我们对指定的激发态指标集将这些贡献求和。\n\n为了处理近简并（小的 $\\omega_{ni}$）带来的潜在数值不稳定性，我们引入一个截断值 $\\omega_{\\min}$，定义有效频率差 $\\omega_{ni, \\text{eff}}(t) = \\max(\\omega_{ni}(t), \\omega_{\\min})$。\n\n综合这些要素，估计量的最终公式为：\n$$\nP_{\\text{exc}}(t) = \\sum_{n \\in \\{\\text{exc. indices}\\}} \\frac{|C_{ni}(t)|^2}{(\\Delta t)^2 \\cdot \\omega_{ni, \\text{eff}}(t)^2}\n$$\n让我们验证一下单位。问题陈述 $\\Delta t$ 的单位是飞秒（$\\text{fs}$），$\\omega_{ni}(t)$ 的单位是弧度/飞秒（$\\text{rad/fs}$）。交叠 $C_{ni}(t)$ 是无量纲的。分母的单位是 $(\\text{fs})^2 \\cdot (\\text{rad/fs})^2 = \\text{fs}^2 \\cdot \\text{fs}^{-2}$，这是无量纲的。因此，$P_{\\text{exc}}(t)$ 是无量纲的，符合要求。\n\n最终推导出的公式是：\n$$\nP_{\\text{exc}}(t) = \\sum_{n \\in \\{\\text{exc. indices}\\}} \\left( \\frac{|C_{ni}(t)|}{\\Delta t \\cdot \\max(\\omega_{ni}(t), \\omega_{\\min})} \\right)^2\n$$\n如果 $P_{\\text{exc}}(t) \\leq P_{\\text{thr}}$，则认为绝热性是可接受的。我们现在将此公式应用于给定的测试用例，并使用指定的参数 $P_{\\text{thr}} = 10^{-3}$ 和 $\\omega_{\\min} = 10^{-3} \\text{ rad/fs}$。\n\n对于每个测试用例，我们执行以下计算：\n1.  **测试用例 1：** $i=0$，激发态指标 $\\{1, 2\\}$，$\\Delta t=0.1$。\n    $P_{\\text{exc}} = \\frac{|0.002 + 0.0005i|^2}{(0.1 \\cdot \\max(8.0, 0.001))^2} + \\frac{|0.0015 - 0.0002i|^2}{(0.1 \\cdot \\max(12.0, 0.001))^2}$\n    $P_{\\text{exc}} = \\frac{4.25 \\times 10^{-6}}{(0.8)^2} + \\frac{2.29 \\times 10^{-6}}{(1.2)^2} = 6.6406 \\times 10^{-6} + 1.5903 \\times 10^{-6} = 8.2309 \\times 10^{-6}$。\n    $8.2309 \\times 10^{-6} \\le 10^{-3}$，因此结果为 $\\texttt{True}$。\n\n2.  **测试用例 2：** $i=0$，激发态指标 $\\{1\\}$，$\\Delta t=0.1$。\n    $P_{\\text{exc}} = \\frac{|0.0316227766i|^2}{(0.1 \\cdot \\max(10.0, 0.001))^2} = \\frac{0.001}{(0.1 \\cdot 10.0)^2} = \\frac{0.001}{1.0^2} = 0.001$。\n    $0.001 \\le 10^{-3}$，因此结果为 $\\texttt{True}$。\n\n3.  **测试用例 3：** $i=0$，激发态指标 $\\{1\\}$，$\\Delta t=0.1$。\n    $P_{\\text{exc}} = \\frac{|0.05|^2}{(0.1 \\cdot \\max(10.0, 0.001))^2} = \\frac{0.0025}{(0.1 \\cdot 10.0)^2} = \\frac{0.0025}{1.0^2} = 0.0025$。\n    $0.0025 > 10^{-3}$，因此结果为 $\\texttt{False}$。\n\n4.  **测试用例 4：** $i=0$，激发态指标 $\\{1\\}$，$\\Delta t=0.1$。\n    频率差为 $\\omega_{10} = 10^{-5}$，小于 $\\omega_{\\min} = 10^{-3}$。我们使用 $\\omega_{\\min}$。\n    $P_{\\text{exc}} = \\frac{|0.0001|^2}{(0.1 \\cdot \\max(10^{-5}, 10^{-3}))^2} = \\frac{10^{-8}}{(0.1 \\cdot 10^{-3})^2} = \\frac{10^{-8}}{(10^{-4})^2} = \\frac{10^{-8}}{10^{-8}} = 1$。\n    $1 > 10^{-3}$，因此结果为 $\\texttt{False}$。\n\n5.  **测试用例 5：** $i=0$，激发态指标 $\\{1\\}$，$\\Delta t=0.1$。\n    $P_{\\text{exc}} = \\frac{|0.0|^2}{(0.1 \\cdot \\max(5.0, 0.001))^2} = 0$。\n    $0 \\le 10^{-3}$，因此结果为 $\\texttt{True}$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the adiabaticity diagnostic problem for a suite of test cases.\n    \"\"\"\n    \n    # Define problem-wide constants\n    p_thr = 1e-3\n    omega_min = 1e-3\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1 (happy path, multi-level, small couplings)\n        {\n            \"dt\": 0.1,\n            \"i\": 0,\n            \"exc_indices\": [1, 2],\n            \"C\": np.array([\n                [0.99999 + 0j, 0.00010 + 0j, -0.00005 + 0j],\n                [0.00200 + 0.00050j, 0.99990 + 0j, 0.00000 + 0j],\n                [0.00150 - 0.00020j, -0.00030 + 0j, 0.99995 + 0j]\n            ], dtype=complex),\n            \"gaps\": {1: 8.0, 2: 12.0}\n        },\n        # Test case 2 (borderline adiabaticity, two-level, complex overlap exact threshold)\n        {\n            \"dt\": 0.1,\n            \"i\": 0,\n            \"exc_indices\": [1],\n            \"C\": np.array([\n                [0.99900 + 0j, 0.00000 + 0j],\n                [0.0 + 0.0316227766j, 1.00000 + 0j]\n            ], dtype=complex),\n            \"gaps\": {1: 10.0}\n        },\n        # Test case 3 (violation, two-level, larger coupling)\n        {\n            \"dt\": 0.1,\n            \"i\": 0,\n            \"exc_indices\": [1],\n            \"C\": np.array([\n                [0.99900 + 0j, 0.00000 + 0j],\n                [0.05000 + 0j, 1.00000 + 0j]\n            ], dtype=complex),\n            \"gaps\": {1: 10.0}\n        },\n        # Test case 4 (near-degenerate excited state, clamp applies)\n        {\n            \"dt\": 0.1,\n            \"i\": 0,\n            \"exc_indices\": [1],\n            \"C\": np.array([\n                [1.00000 + 0j, 0.00000 + 0j, 0.00000 + 0j],\n                [0.00010 + 0j, 1.00000 + 0j, 0.00000 + 0j],\n                [0.00000 + 0j, 0.00000 + 0j, 1.00000 + 0j]\n            ], dtype=complex),\n            \"gaps\": {1: 1e-5}\n        },\n        # Test case 5 (boundary condition, zero coupling)\n        {\n            \"dt\": 0.1,\n            \"i\": 0,\n            \"exc_indices\": [1],\n            \"C\": np.array([\n                [1.00000 + 0j, 0.00000 + 0j],\n                [0.00000 + 0j, 1.00000 + 0j]\n            ], dtype=complex),\n            \"gaps\": {1: 5.0}\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        p_exc = 0.0\n        dt = case[\"dt\"]\n        i = case[\"i\"]\n        \n        # Sum contributions from all specified excited states\n        for n in case[\"exc_indices\"]:\n            # Extract relevant overlap element C_ni\n            c_ni = case[\"C\"][n, i]\n            \n            # Extract gap omega_ni and apply clamping\n            omega_ni = case[\"gaps\"][n]\n            omega_eff = max(omega_ni, omega_min)\n            \n            # Calculate the contribution to P_exc from this excited state\n            term = (np.abs(c_ni) / (dt * omega_eff))**2\n            p_exc += term\n            \n        # Compare to threshold to determine if adiabaticity is acceptable\n        is_acceptable = (p_exc = p_thr)\n        results.append(is_acceptable)\n\n    # Final print statement in the exact required format.\n    # The boolean values need to be capitalized as True/False for Python,\n    # then converted to string. f-string does this automatically.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3436517"}]}