{"hands_on_practices": [{"introduction": "几何优化的核心是找到使系统总能量最小的原子构型。本练习将通过一个理想化的一维原子链模型，阐明这一基本原理。您将通过一个解析上可解的模型，即Lennard-Jones势，建立微观原子间相互作用与宏观结构属性（如晶格常数）之间的直接联系，从而亲身体验能量最小化是如何确定材料的平衡结构的。[@problem_id:3454299]", "problem": "考虑一个由质量为 $M$ 的相同原子组成的无限一维Bravais晶格，晶格参数为 $a$。原子通过仅限于最近邻的对势 $V(r)$相互作用。在几何优化和结构弛豫的背景下，假设外部应力为零，并且弛豫通过最小化每个原子的能量（相对于晶格参数 $a$）来进行。设对势为Lennard-Jones势 $V(r)=4\\varepsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$，其中 $\\varepsilon$ 和 $\\sigma$ 是正常数。\n\n任务：\n1. 从晶格中势能的定义和平衡结构使能量最小化的原理出发，在最近邻近似下，构建每个原子的能量 $E(a)$，并通过最小化 $E(a)$ 求得平衡晶格参数 $a^{\\star}$。\n2. 在平衡构型附近线性化运动方程，导出作为曲率 $k=V''(a^{\\star})$ 的谐波力常数 $k$，并获得最近邻近似下纵向模式的声子色散关系 $\\omega(q)$。解释结果以说明曲率 $k$ 如何决定长波行为。\n3. 提供平衡晶格参数 $a^{\\star}$ 关于 $\\sigma$ 的最终解析表达式。\n\n您最终报告的量必须是 $a^{\\star}$ 关于 $\\sigma$ 的单个闭式解析表达式。无需四舍五入。", "solution": "根据既定的有效性标准对问题陈述进行评估。\n\n### 步骤1：提取已知条件\n- 系统：一个无限一维Bravais晶格。\n- 组成：质量为 $M$ 的相同原子。\n- 几何：晶格参数为 $a$。\n- 相互作用：对势 $V(r)$。\n- 近似：相互作用仅限于最近邻。\n- 条件：外部应力为零；弛豫通过最小化每个原子的能量 $E(a)$（相对于晶格参数 $a$）进行。\n- 势能形式：Lennard-Jones势，$V(r)=4\\varepsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$，其中 $\\varepsilon$ 和 $\\sigma$ 是正常数。\n- 任务1：构建 $E(a)$ 并通过最小化 $E(a)$ 求得平衡晶格参数 $a^{\\star}$。\n- 任务2：线性化运动方程以求出谐波力常数 $k=V''(a^{\\star})$ 和纵向模式的声子色散关系 $\\omega(q)$。解释长波行为。\n- 任务3：提供 $a^{\\star}$ 关于 $\\sigma$ 的解析表达式。\n\n### 步骤2：使用提取的已知条件进行验证\n从科学基础、适定性和客观性方面对问题进行评估。\n\n- **科学基础**：该问题是固态物理和计算材料科学中的一个标准的、基础的练习。它采用公认的Lennard-Jones势来模拟原子间相互作用，并探讨了晶格能量最小化、平衡结构和晶格动力学（声子）等核心概念。所涉及的所有原理在科学上都是合理的。\n- **适定性**：该问题定义清晰，在数学上是可解的。最近邻近似简化了计算，使其成为一个适定问题，能够导出平衡晶格参数 $a^{\\star}$ 和色散关系 $\\omega(q)$ 的唯一、稳定且有意义的解。\n- **客观性**：问题陈述使用精确、无歧义的科学语言，不含任何主观或偏见的成分。\n- **完整性与一致性**：该问题提供了执行所要求的推导所需的所有必要信息（势能形式、物理模型）。各项任务逻辑上前后衔接，彼此一致。\n- **相关性**：该问题与指定的*几何优化和结构弛豫*主题直接且根本相关。能量最小化是结构弛豫的核心原理，而振动模式（声子）分析是表征预测结构稳定性的标准方法。\n\n### 步骤3：结论与行动\n该问题在科学上是合理的、适定的，并且直接相关。它不包含任何矛盾、歧义或事实错误。\n**结论：该问题有效。**\n现在开始推导解答。\n\n### 解答推导\n\n**任务1：每个原子的能量与平衡晶格参数**\n\n在一个具有最近邻相互作用的一维无限晶格中，总势能 $U$ 可以通过对所有原子对的相互作用能求和得到。为了获得每个原子的能量 $E(a)$，我们可以将每个键的能量的一半分配给参与该键的两个原子。链中的任意一个原子有两个最近邻，一个在左边，一个在右边，距离均为 $a$。因此，该原子参与两个键。每个原子的能量是这两个半键能量的总和：\n$$E(a) = \\frac{1}{2}V(a) + \\frac{1}{2}V(a) = V(a)$$\n或者，对于一个具有周期性边界条件的 $N$ 个原子的晶格，存在 $N$ 个最近邻键。总能量为 $U = N V(a)$，每个原子的能量为 $E(a) = U/N = V(a)$。\n\n代入Lennard-Jones势的形式：\n$$E(a) = 4\\varepsilon\\left[\\left(\\frac{\\sigma}{a}\\right)^{12}-\\left(\\frac{\\sigma}{a}\\right)^{6}\\right] = 4\\varepsilon\\left(\\sigma^{12}a^{-12} - \\sigma^{6}a^{-6}\\right)$$\n平衡晶格参数 $a^{\\star}$ 对应于使每个原子能量最小化的 $a$ 值。此条件通过将 $E(a)$ 对 $a$ 的一阶导数设为零来找到：\n$$\\frac{dE(a)}{da} = 0$$\n$$\\frac{d}{da}\\left[4\\varepsilon\\left(\\sigma^{12}a^{-12} - \\sigma^{6}a^{-6}\\right)\\right] = 4\\varepsilon\\left(-12\\sigma^{12}a^{-13} + 6\\sigma^{6}a^{-7}\\right) = 0$$\n由于 $4\\varepsilon \\neq 0$，我们必有：\n$$-12\\sigma^{12}a^{-13} + 6\\sigma^{6}a^{-7} = 0$$\n$$6\\sigma^{6}a^{-7} = 12\\sigma^{12}a^{-13}$$\n假设 $a \\neq 0$ 且 $\\sigma \\neq 0$，我们可以重排方程以求解 $a$：\n$$a^{-7}a^{13} = \\frac{12\\sigma^{12}}{6\\sigma^{6}}$$\n$$a^{6} = 2\\sigma^{6}$$\n$$a^{\\star} = (2\\sigma^{6})^{1/6} = 2^{1/6}\\sigma$$\n为了确认这对应一个最小值，我们在 $a = a^{\\star}$ 处计算能量的二阶导数 $\\frac{d^{2}E(a)}{da^{2}}$。\n$$\\frac{d^{2}E(a)}{da^{2}} = \\frac{d}{da}\\left[4\\varepsilon\\left(-12\\sigma^{12}a^{-13} + 6\\sigma^{6}a^{-7}\\right)\\right]$$\n$$\\frac{d^{2}E(a)}{da^{2}} = 4\\varepsilon\\left((-12)(-13)\\sigma^{12}a^{-14} + (6)(-7)\\sigma^{6}a^{-8}\\right) = 4\\varepsilon\\left(156\\sigma^{12}a^{-14} - 42\\sigma^{6}a^{-8}\\right)$$\n在 $a=a^{\\star}$ 处求值，其中 $(a^{\\star})^6 = 2\\sigma^6$：\n$$\\frac{d^{2}E}{da^{2}}\\bigg|_{a=a^{\\star}} = 4\\varepsilon\\left(156\\sigma^{12}(a^{\\star})^{-14} - 42\\sigma^{6}(a^{\\star})^{-8}\\right) = 4\\varepsilon(a^{\\star})^{-14}\\left(156\\sigma^{12} - 42\\sigma^{6}(a^{\\star})^{6}\\right)$$\n$$= 4\\varepsilon(a^{\\star})^{-14}\\left(156\\sigma^{12} - 42\\sigma^{6}(2\\sigma^{6})\\right) = 4\\varepsilon(a^{\\star})^{-14}\\left(156\\sigma^{12} - 84\\sigma^{12}\\right)$$\n$$= 4\\varepsilon(a^{\\star})^{-14}(72\\sigma^{12}) = \\frac{288\\varepsilon\\sigma^{12}}{(a^{\\star})^{14}}$$\n因为 $\\varepsilon > 0$，$\\sigma > 0$，且 $a^{\\star} > 0$，二阶导数为正。因此，$a^{\\star} = 2^{1/6}\\sigma$ 确实是使能量最小化的晶格参数。\n\n**任务2：力常数与声子色散**\n\n谐波力常数 $k$ 定义为对势在平衡距离处的曲率，即 $k = V''(a^{\\star})$。根据任务1，由于 $E(a)=V(a)$，我们有 $k = E''(a^{\\star})$。\n$$k = \\frac{288\\varepsilon\\sigma^{12}}{(a^{\\star})^{14}} = \\frac{288\\varepsilon\\sigma^{12}}{(2^{1/6}\\sigma)^{14}} = \\frac{288\\varepsilon\\sigma^{12}}{2^{14/6}\\sigma^{14}} = \\frac{288\\varepsilon}{2^{7/3}\\sigma^{2}} = \\frac{2^5 \\cdot 9 \\cdot \\varepsilon}{2^{7/3}\\sigma^{2}} = 72 \\cdot 2^{-1/3} \\frac{\\varepsilon}{\\sigma^2}$$\n现在，我们推导声子色散关系。设 $u_n$ 是第 $n$ 个原子偏离其平衡位置 $na^{\\star}$ 的纵向位移。第 $n$ 个原子的运动方程由Newton第二定律给出，$M\\ddot{u}_n = F_n$。力 $F_n$ 是来自其最近邻原子 $n-1$ 和 $n+1$ 的力的总和。\n$$F_n = F_{n \\leftarrow n-1} + F_{n \\leftarrow n+1}$$\n在谐波近似下，两个原子之间的力与它们偏离平衡距离的位移成线性关系：$F = -k \\times (\\text{位移})$。\n原子 $n+1$ 对原子 $n$ 的力是 $k(u_{n+1}-u_n)$。\n原子 $n-1$ 对原子 $n$ 的力是 $k(u_{n-1}-u_n)$。\n原子 $n$ 上的净力是：\n$$F_n = k(u_{n+1}-u_n) + k(u_{n-1}-u_n) = k(u_{n+1} + u_{n-1} - 2u_n)$$\n运动方程是：\n$$M\\frac{d^{2}u_n}{dt^{2}} = k(u_{n+1} + u_{n-1} - 2u_n)$$\n我们寻找形式为 $u_n(t) = A\\exp(i(qna^{\\star} - \\omega t))$ 的平面波解，其中 $q$ 是波矢，$\\omega$ 是角频率。将此假设代入运动方程：\n$$u_{n\\pm1}(t) = u_n(t) \\exp(\\pm iqa^{\\star})$$\n$$M(-\\omega^{2})u_n = k(u_n\\exp(iqa^{\\star}) + u_n\\exp(-iqa^{\\star}) - 2u_n)$$\n两边同除以 $u_n$（非零）：\n$$-M\\omega^{2} = k(\\exp(iqa^{\\star}) + \\exp(-iqa^{\\star}) - 2)$$\n使用恒等式 $2\\cos\\theta = \\exp(i\\theta) + \\exp(-i\\theta)$：\n$$-M\\omega^{2} = k(2\\cos(qa^{\\star}) - 2) = -2k(1 - \\cos(qa^{\\star}))$$\n使用恒等式 $1 - \\cos\\theta = 2\\sin^{2}(\\theta/2)$：\n$$M\\omega^{2} = 4k\\sin^{2}\\left(\\frac{qa^{\\star}}{2}\\right)$$\n因此，声子色散关系为：\n$$\\omega(q) = \\sqrt{\\frac{4k}{M}}\\left|\\sin\\left(\\frac{qa^{\\star}}{2}\\right)\\right|$$\n在长波极限下（$q \\to 0$），我们有 $\\sin(x) \\approx x$。因此：\n$$\\omega(q) \\approx \\sqrt{\\frac{4k}{M}}\\left|\\frac{qa^{\\star}}{2}\\right| = \\left(a^{\\star}\\sqrt{\\frac{k}{M}}\\right)|q|$$\n这显示了一个线性关系 $\\omega(q) = v_s|q|$，这是声学波的特征。声速为 $v_s = a^{\\star}\\sqrt{k/M}$。\n势的曲率 $k=V''(a^{\\star})$ 直接决定了这种长波行为。更大的曲率意味着连接原子的“弹簧”更硬。这种增加的刚度导致更高的声速 $v_s$，意味着机械波在晶格中传播得更快。因此，曲率 $k$ 决定了材料的声学性质的尺度。\n\n**任务3：平衡晶格参数的最终解析表达式**\n\n如任务1中所推导，对于给定的具有最近邻Lennard-Jones相互作用的一维链，使每个原子能量最小化的平衡晶格参数 $a^{\\star}$ 是：\n$$a^{\\star} = 2^{1/6}\\sigma$$\n此表达式以Lennard-Jones参数 $\\sigma$ 给出了最佳原子间距，$\\sigma$ 代表粒子间势能为零时的有限距离。正如预期的那样，平衡距离略大于 $\\sigma$，因为势能的排斥部分比吸引部分陡峭得多。", "answer": "$$\\boxed{2^{1/6}\\sigma}$$", "id": "3454299"}, {"introduction": "将能量最小化原理付诸实践需要依赖数值优化算法。这些算法不仅要确定能量下降最快的方向（通常是沿负梯度方向），还必须决定沿该方向前进的“步长”。本练习将通过一个编程任务，让您实现回溯线搜索算法，这是一种在现代优化程序中广泛用于确定合适步长的稳健方法。[@problem_id:3454266]", "problem": "考虑计算材料科学中的一个一维势能函数，该函数表示沿单一结构自由度的能量。假设能量函数 $E(x)$ 是连续可微的，其导数为 $E'(x)$，并且结构弛豫通过形式为 $x_{k+1} = x_k + t_k d_k$ 的迭代更新进行，其中 $d_k$ 是下降方向，$t_k$ 是步长。请实现带有 Armijo 充分下降条件的回溯线搜索 (Backtracking Line Search, BLS)，以选择每个 $t_k$，从初始步长 $t_{\\mathrm{init}}$ 开始。下降方向必须选择为 $d_k = -E'(x_k)$，并且必须使用参数 $c \\in (0,1)$ 和用于回溯的收缩因子 $\\tau \\in (0,1)$ 来强制执行 Armijo 充分下降条件。每次迭代从 $t = t_{\\mathrm{init}}$ 开始，并不断缩减 $t \\leftarrow \\tau t$，直到满足充分下降条件或达到最小允许步长 $t_{\\min}$ 为止。如果对于指定的容差 $\\varepsilon$，有 $|E'(x_k)| \\le \\varepsilon$，则终止该次迭代而不执行步进。如果在满足充分下降条件之前 $t$ 小于 $t_{\\min}$，则终止更新。最多执行 $N_{\\max}$ 次几何迭代。对于每个测试用例，返回所接受的步长序列 $\\{t_k\\}$。\n\n您的程序必须实现上述过程，并为以下四个科学上合理的、以纯数学术语编写的测试用例生成所接受的步长序列：\n\n- 测试用例 $1$ (强凸二次型):\n  - 能量 $E_1(x) = \\tfrac{1}{2}(x - a)^2$，其中 $a = 2$。\n  - 导数 $E_1'(x) = x - a$。\n  - 初始点 $x_0 = -3$。\n  - 参数 $t_{\\mathrm{init}} = 1$, $\\tau = \\tfrac{1}{2}$, $c = 10^{-4}$, $\\varepsilon = 10^{-10}$, $t_{\\min} = 10^{-14}$, $N_{\\max} = 5$。\n\n- 测试用例 $2$ (带倾斜的非凸双势阱):\n  - 能量 $E_2(x) = (x^2 - 1)^2 + \\gamma x$，其中 $\\gamma = 0.05$。\n  - 导数 $E_2'(x) = 4x(x^2 - 1) + \\gamma$。\n  - 初始点 $x_0 = 0$。\n  - 参数 $t_{\\mathrm{init}} = 1$, $\\tau = 0.7$, $c = 10^{-3}$, $\\varepsilon = 10^{-10}$, $t_{\\min} = 10^{-14}$, $N_{\\max} = 8$。\n\n- 测试用例 $3$ (对数型，原点附近平坦):\n  - 能量 $E_3(x) = \\ln(1 + x^2)$。\n  - 导数 $E_3'(x) = \\dfrac{2x}{1 + x^2}$。\n  - 初始点 $x_0 = 0.1$。\n  - 参数 $t_{\\mathrm{init}} = 10$, $\\tau = \\tfrac{1}{2}$, $c = 10^{-4}$, $\\varepsilon = 10^{-12}$, $t_{\\min} = 10^{-14}$, $N_{\\max} = 6$。\n\n- 测试用例 $4$ (起始点为平坦最小值):\n  - 能量 $E_4(x) = (x - 1)^4$。\n  - 导数 $E_4'(x) = 4(x - 1)^3$。\n  - 初始点 $x_0 = 1$。\n  - 参数 $t_{\\mathrm{init}} = 1$, $\\tau = \\tfrac{1}{2}$, $c = 10^{-4}$, $\\varepsilon = 10^{-12}$, $t_{\\min} = 10^{-14}$, $N_{\\max} = 5$。\n\n使用无量纲量；不需要物理单位。不涉及角度。对于每个测试用例，计算由带有 Armijo 条件的回溯线搜索产生的所接受步长序列 $\\{t_k\\}$，直到因梯度容差、最小步长阈值或最大迭代次数而终止。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，其中每个元素是对应一个测试用例的浮点数列表（例如，$[ [t_{1,0}, t_{1,1}, \\dots], [t_{2,0}, \\dots], [\\dots], [\\dots] ]$）。每个测试用例的答案必须是一个浮点数列表。设计您的实现时应确保其数值稳定并严格遵循所述过程。", "solution": "所提出的问题是数值优化中的一个明确定义的任务，特别是在计算材料科学的背景下，它被称为结构弛豫或几何优化。其目标是确定由最速下降算法所生成的已接受步长序列 $\\{t_k\\}$，该算法配备了强制执行 Armijo 充分下降条件的回溯线搜索。该过程将应用于四个不同的一维势能函数 $E(x)$，每个函数代表一种不同的物理情景。\n\n对问题陈述的验证证实了其在科学上是合理的、自洽的，并且在算法上是明确的。它牢固地建立在无约束数值优化的基本原则之上。所有函数、参数和终止标准都已明确定义，确保每个测试用例都存在唯一且可验证的解。因此，可以构建一个合理的解决方案。\n\n结构弛豫的核心在于寻找势能面 $E(\\mathbf{r})$ 的一个局部最小值，其中 $\\mathbf{r}$ 代表组分原子的坐标。对于一维情况，这简化为找到一个使 $E(x)$ 最小化的 $x$。这被表述为一个无约束优化问题。基于梯度的方法通过将当前位置 $x_k$ 迭代更新到一个能量更低的新位置 $x_{k+1}$ 来解决此问题。这种更新的一般形式是：\n$$x_{k+1} = x_k + t_k d_k$$\n其中 $k$ 是迭代索引，$d_k$ 是搜索方向，$t_k > 0$ 是步长或步长长度。\n\n收敛的一个关键要求是 $d_k$ 必须是一个下降方向，这意味着它必须与负梯度形成一个锐角，以确保沿此方向的一小步将降低能量。这被正式表述为 $E'(x_k) d_k  0$。问题指定使用最速下降法，其中搜索方向被选择为与能量函数的梯度反平行：\n$$d_k = -E'(x_k)$$\n这种选择保证了下降方向，因为 $E'(x_k) d_k = E'(x_k) (-E'(x_k)) = -(E'(x_k))^2 \\le 0$。除非梯度为零，即 $E'(x_k)=0$（这是驻点——最小值、最大值或鞍点的条件），否则下降是严格的。\n\n一旦确定了下降方向 $d_k$，就必须找到一个合适的步长 $t_k$。过小的步长会导致收敛缓慢，而过大的步长可能会“过冲”最小值并增加能量。线搜索是一种用于寻找合适 $t_k$ 的算法。问题要求使用强制执行 Armijo 充分下降条件的回溯线搜索 (BLS) 算法。\n\nArmijo 条件确保步长 $t$ 能够产生能量的充分下降，而不仅仅是无穷小的下降。其表述为：\n$$E(x_k + t d_k) \\le E(x_k) + c t E'(x_k) d_k$$\n其中 $c$ 是区间 $(0, 1)$ 内的一个小常数，通常约为 $10^{-4}$。右侧的项定义了一条斜率比初始方向导数 $E'(x_k) d_k$ 更平缓的线，为所需的能量下降提供了一个“缓冲”。代入最速下降方向 $d_k = -E'(x_k)$，我们问题的条件变为：\n$$E(x_k - t E'(x_k)) \\le E(x_k) - c t (E'(x_k))^2$$\n\nBLS 算法在每次迭代 $k$ 中按以下方式运行：\n$1$. 将试验步长 $t$ 初始化为一个预定义的初始值，$t \\leftarrow t_{\\mathrm{init}}$。\n$2$. 检查当前 $t$ 是否满足 Armijo 条件。\n$3$. 如果满足，则接受此 $t$ 作为当前迭代的步长 $t_k$ 并终止线搜索。\n$4$. 如果不满足，则将步长乘以一个收缩因子 $\\tau \\in (0, 1)$ 进行缩减，即 $t \\leftarrow \\tau t$，然后返回步骤 $2$。\n$5$. 重复此过程，直到找到一个合适的 $t$ 或直到 $t$ 小于最小阈值 $t_{\\min}$，此时认为优化未能取得进展并终止。\n\n整个几何优化过程将最速下降方向与 BLS 相结合。指定的完整算法如下：\n对于 $k = 0, 1, 2, \\dots, N_{\\max}-1$：\n$1$. 计算梯度（力）$g_k = E'(x_k)$。\n$2$. 检查收敛性：如果 $|g_k| \\le \\varepsilon$，其中 $\\varepsilon$ 是一个很小的容差，则认为系统处于局部最小值。优化终止。这将产生一个包含 $k$ 个已接受步长的序列 $\\{t_0, t_1, \\dots, t_{k-1}\\}$。\n$3$. 如果未收敛，执行回溯线搜索以找到满足 Armijo 条件的步长 $t_k$。搜索从 $t=t_{\\mathrm{init}}$ 开始，并以因子 $\\tau$ 进行收缩。\n$4$. 如果线搜索循环导致 $t$ 小于 $t_{\\min}$，则立即终止优化而不更新位置。已接受的步长序列为 $\\{t_0, t_1, \\dots, t_{k-1}\\}$。\n$5$. 如果找到一个有效的步长 $t_k \\ge t_{\\min}$，则更新位置：$x_{k+1} = x_k - t_k g_k$。\n$6$. 记录已接受的步长 $t_k$。\n$7$. 如果循环完成 $N_{\\max}$ 次迭代，过程终止。\n\n此结构化过程将为四个指定的测试用例中的每一个实现。每个用例的函数和参数如下：\n- 用例 $1$：一个简单的凸二次势，$E_1(x) = \\tfrac{1}{2}(x - a)^2$，其中 $a = 2$。对于此函数，使用精确线搜索的最速下降法将在一步内收敛。使用 $t_{\\mathrm{init}}=1$ 的回溯线搜索也恰好在第一次尝试时就找到了最优步长。\n- 用例 $2$：一个非凸双势阱势，$E_2(x) = (x^2 - 1)^2 + \\gamma x$，其中 $\\gamma = 0.05$。这测试了算法在更复杂的能量景观中导航的能力。\n- 用例 $3$：一个对数势，$E_3(x) = \\ln(1 + x^2)$，它在其最小值 $x=0$ 附近有一个非常平坦的区域，用于测试梯度很小时的收敛行为。\n- 用例 $4$：一个四次势，$E_4(x) = (x - 1)^4$。这个用例很特殊，因为初始位置 $x_0=1$ 已经处于最小值，其导数恰好为零。预计算法会识别到这一点并立即终止，不执行任何步进。\n\n该实现将包括一个协调此迭代过程的主优化函数，以及一组能量函数及其导数的定义。最终输出将是为四个用例收集的已接受步长序列，并按指定格式化。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_optimization(E, E_prime, x0, t_init, tau, c, epsilon, t_min, N_max):\n    \"\"\"\n    Performs geometry optimization using steepest descent with backtracking line search.\n\n    Args:\n        E (callable): The energy function E(x).\n        E_prime (callable): The derivative of the energy function E'(x).\n        x0 (float): The initial position.\n        t_init (float): The initial step size for backtracking.\n        tau (float): The contraction factor for backtracking.\n        c (float): The Armijo condition parameter.\n        epsilon (float): The gradient tolerance for convergence.\n        t_min (float): The minimum allowable step size.\n        N_max (int): The maximum number of iterations.\n\n    Returns:\n        list[float]: The sequence of accepted step sizes.\n    \"\"\"\n    x = x0\n    accepted_steps = []\n\n    for k in range(N_max):\n        # 1. Calculate gradient (force)\n        grad = E_prime(x)\n\n        # 2. Check for convergence based on gradient magnitude\n        if abs(grad) = epsilon:\n            break\n\n        # 3. Perform Backtracking Line Search (BLS)\n        t = t_init\n        current_energy = E(x)\n        grad_sq = grad**2\n        \n        while True:\n            # Check if step size has fallen below the minimum threshold\n            if t  t_min:\n                # If t is too small, terminate the entire optimization process as per problem spec\n                return accepted_steps\n\n            # Proposed new position\n            x_new = x - t * grad\n            new_energy = E(x_new)\n            \n            # Armijo sufficient decrease condition\n            if new_energy = current_energy - c * t * grad_sq:\n                accepted_t = t\n                break\n            else:\n                # Backtrack: contract the step size\n                t *= tau\n        \n        # 4. Update position and record the accepted step size\n        x = x - accepted_t * grad\n        accepted_steps.append(accepted_t)\n\n    return accepted_steps\n\ndef solve():\n    \"\"\"\n    Defines and runs the four test cases for the optimization problem.\n    \"\"\"\n    test_cases = [\n        # Test case 1 (strongly convex quadratic)\n        {\n            \"E\": lambda x: 0.5 * (x - 2.0)**2,\n            \"E_prime\": lambda x: x - 2.0,\n            \"x0\": -3.0,\n            \"params\": {\n                \"t_init\": 1.0, \"tau\": 0.5, \"c\": 1e-4, \n                \"epsilon\": 1e-10, \"t_min\": 1e-14, \"N_max\": 5\n            }\n        },\n        # Test case 2 (nonconvex double-well with tilt)\n        {\n            \"E\": lambda x: (x**2 - 1.0)**2 + 0.05 * x,\n            \"E_prime\": lambda x: 4.0 * x * (x**2 - 1.0) + 0.05,\n            \"x0\": 0.0,\n            \"params\": {\n                \"t_init\": 1.0, \"tau\": 0.7, \"c\": 1e-3, \n                \"epsilon\": 1e-10, \"t_min\": 1e-14, \"N_max\": 8\n            }\n        },\n        # Test case 3 (logarithmic, flat near origin)\n        {\n            \"E\": lambda x: np.log(1.0 + x**2),\n            \"E_prime\": lambda x: (2.0 * x) / (1.0 + x**2),\n            \"x0\": 0.1,\n            \"params\": {\n                \"t_init\": 10.0, \"tau\": 0.5, \"c\": 1e-4, \n                \"epsilon\": 1e-12, \"t_min\": 1e-14, \"N_max\": 6\n            }\n        },\n        # Test case 4 (flat minimum at start point)\n        {\n            \"E\": lambda x: (x - 1.0)**4,\n            \"E_prime\": lambda x: 4.0 * (x - 1.0)**3,\n            \"x0\": 1.0,\n            \"params\": {\n                \"t_init\": 1.0, \"tau\": 0.5, \"c\": 1e-4, \n                \"epsilon\": 1e-12, \"t_min\": 1e-14, \"N_max\": 5\n            }\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        steps = run_optimization(case[\"E\"], case[\"E_prime\"], case[\"x0\"], **case[\"params\"])\n        results.append(steps)\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3454266"}, {"introduction": "完整的结构弛豫不仅涉及优化原子在晶胞内的相对位置，还常常需要优化晶胞本身的尺寸和形状。本练习将演示这一过程，您将使用计算出的应力张量（能量对晶格应变的导数）来驱动晶格矢量的更新。通过这个实践，您将具体了解在给定内部应力和外部压力的情况下，如何执行一步晶胞优化，这是材料模拟中一个至关重要的环节。[@problem_id:3454268]", "problem": "考虑一个三维周期性固体，其由晶胞矩阵 $\\mathbf{h}^{(0)}$ 表示，该矩阵的列是笛卡尔坐标系下的晶格矢量。设柯西应力张量 $\\boldsymbol{\\sigma}$ 是在固定分数原子坐标下通过量子力学总能计算得到的，且系统受到静水外压 $p$ 的作用。焓为 $H = E + p V$，其中 $E$ 是内能，$V=\\det(\\mathbf{h})$ 是晶胞体积。在保持分数原子坐标固定的同时，通过沿 $H$ 相对于无穷小应变张量 $\\boldsymbol{\\varepsilon}$ 的负梯度方向迈出一步，来对晶胞进行最速下降法更新。假设晶胞更新采用小应变线性化，并使用应力与应变之间的标准虚功关系。\n\n给定：\n$$\n\\mathbf{h}^{(0)} = \\begin{pmatrix}\n3.000  0.200  0.100\\\\\n0.000  4.000  0.300\\\\\n0.000  0.000  5.000\n\\end{pmatrix}\\ \\text{Å},\n\\quad\n\\boldsymbol{\\sigma} = \\begin{pmatrix}\n1.5  0.2  -0.1\\\\\n0.2  -0.5  0.0\\\\\n-0.1  0.0  2.0\n\\end{pmatrix}\\ \\text{GPa},\n\\quad\np = 1.0\\ \\text{GPa}.\n$$\n设最速下降法的步长由标量 $\\kappa$ 表征，其单位为 $\\text{GPa}^{-1}$，定义为 $\\delta \\boldsymbol{\\varepsilon} = \\kappa \\left( \\boldsymbol{\\sigma} - p \\mathbf{I} \\right)$，其中 $\\kappa = 2.0 \\times 10^{-2}\\ \\text{GPa}^{-1}$。采用形变梯度 $\\mathbf{F} \\approx \\mathbf{I} + \\delta \\boldsymbol{\\varepsilon}$ 下的线性化晶胞矩阵更新法则，即 $\\mathbf{h}^{(1)} = \\left( \\mathbf{I} + \\delta \\boldsymbol{\\varepsilon} \\right) \\mathbf{h}^{(0)}$，其中 $\\mathbf{I}$ 是单位矩阵。使用双点积约定 $A : B = \\sum_{i,j} A_{ij} B_{ij}$。\n\n计算更新后的晶胞矩阵 $\\mathbf{h}^{(1)}$。将你的最终答案表示为一个行矩阵，其中包含 $\\mathbf{h}^{(1)}$ 的九个分量，按列主序（即逐列、从上到下、从左到右）排列，单位为 Å。将答案的每个分量四舍五入到四位有效数字。", "solution": "用户要求我计算经过单步最速下降法更新后的晶胞矩阵 `\\mathbf{h}^{(1)}`。\n\n### 步骤 1：提取已知条件\n- 初始晶胞矩阵：\n$$\n\\mathbf{h}^{(0)} = \\begin{pmatrix}\n3.000  0.200  0.100\\\\\n0.000  4.000  0.300\\\\\n0.000  0.000  5.000\n\\end{pmatrix}\\ \\text{Å}\n$$\n- 柯西应力张量：\n$$\n\\boldsymbol{\\sigma} = \\begin{pmatrix}\n1.5  0.2  -0.1\\\\\n0.2  -0.5  0.0\\\\\n-0.1  0.0  2.0\n\\end{pmatrix}\\ \\text{GPa}\n$$\n- 静水外压：$p = 1.0\\ \\text{GPa}$。\n- 最速下降法步长参数：$\\kappa = 2.0 \\times 10^{-2}\\ \\text{GPa}^{-1}$。\n- 应变更新法则：$\\delta \\boldsymbol{\\varepsilon} = \\kappa \\left( \\boldsymbol{\\sigma} - p \\mathbf{I} \\right)$。\n- 线性化晶胞更新法则：$\\mathbf{h}^{(1)} = \\left( \\mathbf{I} + \\delta \\boldsymbol{\\varepsilon} \\right) \\mathbf{h}^{(0)}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，是适定且客观的。它描述了材料科学中结构弛豫的一个标准的（尽管是简化的）计算过程。所提供的更新法则 $\\delta \\boldsymbol{\\varepsilon} = \\kappa \\left( \\boldsymbol{\\sigma} - p \\mathbf{I} \\right)$ 代表了一种有物理动机的算法，用于将内应力 $\\boldsymbol{\\sigma}$ 弛豫到目标外压张量 $p \\mathbf{I}$。所有必要的数据都已提供，各物理量在量纲上是一致的，并且所需的运算是明确定义的数学过程。因此，可以确定一个唯一的解。该问题是有效的。\n\n### 步骤 3：结论与行动\n该问题是有效的。我将继续进行完整求解。\n\n求解过程首先根据给定的应力、压力和步长计算无穷小应变张量 $\\delta \\boldsymbol{\\varepsilon}$。然后，用该应变构建线性化的形变梯度 $\\mathbf{F} \\approx \\mathbf{I} + \\delta \\boldsymbol{\\varepsilon}$。最后，通过将此形变应用于初始晶胞矩阵 $\\mathbf{h}^{(0)}$，计算出更新后的晶胞矩阵 $\\mathbf{h}^{(1)}$。\n\n首先，我们计算内应力张量 $\\boldsymbol{\\sigma}$ 与对应于外压的目标应力张量 $p \\mathbf{I}$ 之间的差值。\n$$\np \\mathbf{I} = (1.0) \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix} \\text{GPa} = \\begin{pmatrix} 1.0  0.0  0.0 \\\\ 0.0  1.0  0.0 \\\\ 0.0  0.0  1.0 \\end{pmatrix} \\text{GPa}\n$$\n$$\n\\boldsymbol{\\sigma} - p \\mathbf{I} = \\begin{pmatrix}\n1.5  0.2  -0.1\\\\\n0.2  -0.5  0.0\\\\\n-0.1  0.0  2.0\n\\end{pmatrix} - \\begin{pmatrix}\n1.0  0.0  0.0 \\\\\n0.0  1.0  0.0 \\\\\n0.0  0.0  1.0\n\\end{pmatrix} = \\begin{pmatrix}\n0.5  0.2  -0.1\\\\\n0.2  -1.5  0.0\\\\\n-0.1  0.0  1.0\n\\end{pmatrix} \\text{GPa}\n$$\n接下来，我们使用给定的更新法则 $\\delta \\boldsymbol{\\varepsilon} = \\kappa ( \\boldsymbol{\\sigma} - p \\mathbf{I} )$ 来计算无穷小应变张量 $\\delta \\boldsymbol{\\varepsilon}$。\n$$\n\\delta \\boldsymbol{\\varepsilon} = (2.0 \\times 10^{-2}\\ \\text{GPa}^{-1}) \\begin{pmatrix}\n0.5  0.2  -0.1\\\\\n0.2  -1.5  0.0\\\\\n-0.1  0.0  1.0\n\\end{pmatrix} \\text{GPa}\n$$\n$$\n\\delta \\boldsymbol{\\varepsilon} = \\begin{pmatrix}\n0.02 \\times 0.5  0.02 \\times 0.2  0.02 \\times (-0.1)\\\\\n0.02 \\times 0.2  0.02 \\times (-1.5)  0.02 \\times 0.0\\\\\n0.02 \\times (-0.1)  0.02 \\times 0.0  0.02 \\times 1.0\n\\end{pmatrix} = \\begin{pmatrix}\n0.010  0.004  -0.002\\\\\n0.004  -0.030  0.000\\\\\n-0.002  0.000  0.020\n\\end{pmatrix}\n$$\n正如预期的那样，该应变张量是无量纲的。现在我们构造矩阵 $\\mathbf{I} + \\delta \\boldsymbol{\\varepsilon}$，它代表了线性化的形变梯度。\n$$\n\\mathbf{I} + \\delta \\boldsymbol{\\varepsilon} = \\begin{pmatrix}\n1  0  0\\\\\n0  1  0\\\\\n0  0  1\n\\end{pmatrix} + \\begin{pmatrix}\n0.010  0.004  -0.002\\\\\n0.004  -0.030  0.000\\\\\n-0.002  0.000  0.020\n\\end{pmatrix} = \\begin{pmatrix}\n1.010  0.004  -0.002\\\\\n0.004  0.970  0.000\\\\\n-0.002  0.000  1.020\n\\end{pmatrix}\n$$\n最后，我们通过将此形变应用于初始晶胞矩阵 $\\mathbf{h}^{(0)}$ 来计算更新后的晶胞矩阵 $\\mathbf{h}^{(1)}$。\n$$\n\\mathbf{h}^{(1)} = (\\mathbf{I} + \\delta \\boldsymbol{\\varepsilon}) \\mathbf{h}^{(0)} = \\begin{pmatrix}\n1.010  0.004  -0.002\\\\\n0.004  0.970  0.000\\\\\n-0.002  0.000  1.020\n\\end{pmatrix} \\begin{pmatrix}\n3.000  0.200  0.100\\\\\n0.000  4.000  0.300\\\\\n0.000  0.000  5.000\n\\end{pmatrix}\n$$\n执行矩阵乘法：\n$h^{(1)}_{11} = (1.010)(3.000) + (0.004)(0.000) + (-0.002)(0.000) = 3.030$\n$h^{(1)}_{21} = (0.004)(3.000) + (0.970)(0.000) + (0.000)(0.000) = 0.012$\n$h^{(1)}_{31} = (-0.002)(3.000) + (0.000)(0.000) + (1.020)(0.000) = -0.006$\n\n$h^{(1)}_{12} = (1.010)(0.200) + (0.004)(4.000) + (-0.002)(0.000) = 0.202 + 0.016 = 0.218$\n$h^{(1)}_{22} = (0.004)(0.200) + (0.970)(4.000) + (0.000)(0.000) = 0.0008 + 3.88 = 3.8808$\n$h^{(1)}_{32} = (-0.002)(0.200) + (0.000)(4.000) + (1.020)(0.000) = -0.0004$\n\n$h^{(1)}_{13} = (1.010)(0.100) + (0.004)(0.300) + (-0.002)(5.000) = 0.101 + 0.0012 - 0.01 = 0.0922$\n$h^{(1)}_{23} = (0.004)(0.100) + (0.970)(0.300) + (0.000)(5.000) = 0.0004 + 0.291 = 0.2914$\n$h^{(1)}_{33} = (-0.002)(0.100) + (0.000)(0.300) + (1.020)(5.000) = -0.0002 + 5.1 = 5.0998$\n\n所以，更新后的晶胞矩阵是：\n$$\n\\mathbf{h}^{(1)} = \\begin{pmatrix}\n3.030  0.218  0.0922 \\\\\n0.012  3.8808  0.2914 \\\\\n-0.006  -0.0004  5.0998\n\\end{pmatrix}\\ \\text{Å}\n$$\n问题要求将每个分量四舍五入到四位有效数字。\n$h^{(1)}_{11} = 3.030 \\rightarrow 3.030$\n$h^{(1)}_{21} = 0.012 \\rightarrow 0.01200$\n$h^{(1)}_{31} = -0.006 \\rightarrow -0.006000$\n\n$h^{(1)}_{12} = 0.218 \\rightarrow 0.2180$\n$h^{(1)}_{22} = 3.8808 \\rightarrow 3.881$\n$h^{(1)}_{32} = -0.0004 \\rightarrow -0.0004000$\n\n$h^{(1)}_{13} = 0.0922 \\rightarrow 0.09220$\n$h^{(1)}_{23} = 0.2914 \\rightarrow 0.2914$\n$h^{(1)}_{33} = 5.0998 \\rightarrow 5.100$\n\n最终分量按要求的列主序排列如下：\n第 1 列：$3.030$，$0.01200$，$-0.006000$\n第 2 列：$0.2180$，$3.881$，$-0.0004000$\n第 3 列：$0.09220$，$0.2914$，$5.100$", "answer": "$$\n\\boxed{\\begin{pmatrix} 3.030  0.01200  -0.006000  0.2180  3.881  -0.0004000  0.09220  0.2914  5.100 \\end{pmatrix}}\n$$", "id": "3454268"}]}