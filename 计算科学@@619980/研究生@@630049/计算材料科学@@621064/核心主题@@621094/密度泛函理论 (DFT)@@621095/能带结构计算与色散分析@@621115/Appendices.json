{"hands_on_practices": [{"introduction": "现代能带结构计算大多基于平面波密度泛函理论（DFT），而赝势是其中一项关键的近似。本练习将引导你亲手构建一个简化的平面波计算模型，通过对比两种不同类型的赝势（模守恒赝势与一种更“软”的赝势），来探索它们对计算结果收敛性的影响。[@problem_id:3433862] 这项实践将帮助你深刻理解在实际计算中选择不同赝势的权衡，这是精确高效地进行材料计算的一项基本技能。", "problem": "你的任务是设计并实现一个计算测试，用于在固定的平面波动能截断下，比较使用两种不同赝势模型计算出的晶体硅的能带结构。这两种模型分别是“模守恒”赝势和一种“投影缀加波 (PAW)”类赝势替代模型。你的程序必须使用周期势场中单粒子薛定谔方程的平面波展开，沿着指定的高对称路径构建能带结构，量化价带宽度，并通过将每种情况与高截断能的参考结果进行比较来评估其收敛行为。所有结果必须以电子伏特 (eV) 为单位表示。\n\n理论基础是周期势中的单粒子薛定谔方程、布洛赫定理和平面波方法：\n- 单粒子薛定谔方程为 $H\\psi = E\\psi$，适用于周期势 $V(\\mathbf{r})$，其中 $H = -\\frac{\\hbar^2}{2m}\\nabla^2 + V(\\mathbf{r})$。\n- 根据布洛赫定理，解可以在平面波基中展开，其波矢为 $\\mathbf{k} + \\mathbf{G}$，其中 $\\mathbf{k}$ 位于第一布里渊区，$\\mathbf{G}$ 遍历所有倒格矢。\n- 在由动能截断 $E_{\\mathrm{cut}}$ 定义的截断平面波基中，只包含满足 $\\frac{\\hbar^2}{2m}|\\mathbf{G}|^2 \\le E_{\\mathrm{cut}}$ 条件的倒格矢 $\\mathbf{G}$，并建立哈密顿矩阵\n$$\nH_{\\mathbf{G},\\mathbf{G}'}(\\mathbf{k}) = \\delta_{\\mathbf{G},\\mathbf{G}'}\\frac{\\hbar^2}{2m}|\\mathbf{k}+\\mathbf{G}|^2 + V(\\mathbf{G}-\\mathbf{G}'),\n$$\n其中 $V(\\mathbf{q})$ 是周期势的傅里叶变换。\n- 对于硅的金刚石结构，其常规立方晶胞的晶格常数为 $a$，每个晶胞包含两个原子，结构因子以下列形式进入局域势的傅里叶分量\n$$\nV(\\mathbf{q}) = S(\\mathbf{q})\\,v(|\\mathbf{q}|), \\quad S(\\mathbf{q}) = 1 + e^{i\\mathbf{q}\\cdot\\boldsymbol{\\tau}},\n$$\n其中基矢为 $\\boldsymbol{\\tau} = \\frac{a}{4}(1,1,1)$，$v(|\\mathbf{q}|)$ 是一个模拟赝势的球对称形状因子。\n\n你必须实现两种赝势形状因子，它们仅在傅里叶空间的衰减率上有所不同，这反映了一个公认的观念：模守恒模型“更硬”（需要更多平面波才能收敛），而 PAW 类模型“更软”（使用较少平面波就能更快收敛）。使用以下物理上合理的模型：\n- 对于 PAW 类模型，令 $v_{\\mathrm{PAW}}(q) = -V_0\\exp\\left[-\\left(\\frac{q}{q_0^{\\mathrm{PAW}}}\\right)^2\\right]$。\n- 对于模守恒模型，令 $v_{\\mathrm{NC}}(q) = -V_0\\exp\\left[-\\left(\\frac{q}{q_0^{\\mathrm{NC}}}\\right)^2\\right]$。\n选择参数 $V_0$、$q_0^{\\mathrm{PAW}}$ 和 $q_0^{\\mathrm{NC}}$，使得 $q_0^{\\mathrm{NC}} > q_0^{\\mathrm{PAW}}$，从而使模守恒势在倒易空间中更硬。周期势随后由 $V(\\mathbf{q}) = S(\\mathbf{q})\\,v(q)$ 完全确定。\n\n对于硅，使用金刚石结构的常规立方晶格常数 $a = 5.431~\\mathrm{\\AA}$。构建倒格矢 $\\mathbf{G} = \\frac{2\\pi}{a}(h,k,l)$，并将其限制在面心立方布拉菲格子的倒格子上（其在倒易空间中是体心立方）。在常规立方指数中，这意味着只包含奇偶性全部相同（全为偶数或全为奇数）的三元组 $(h,k,l)$。为进行基矢选择，强制执行动能截断条件 $\\frac{\\hbar^2}{2m}|\\mathbf{G}|^2 \\le E_{\\mathrm{cut}}$，其中 $\\frac{\\hbar^2}{2m} = 3.80998212$ $\\mathrm{eV}\\cdot\\mathrm{\\AA}^2$。\n\n沿着分段线性高对称路径 $\\Gamma \\rightarrow X \\rightarrow L$ 构建能带结构，其中\n- $\\Gamma = (0,0,0)$,\n- $X = \\left(\\frac{\\pi}{a},0,0\\right)$,\n- $L = \\left(\\frac{\\pi}{a},\\frac{\\pi}{a},\\frac{\\pi}{a}\\right)$,\n每个线段分别采样 $N_\\Gamma$ 和 $N_X$ 个等距点，其中 $N_\\Gamma = N_X = 20$。\n\n对于每种赝势模型和截断能，对路径上采样的每个 $\\mathbf{k}$ 点的哈密顿量进行对角化，对本征值进行排序，并将“价带宽度”定义为最低能带沿路径的能量展宽，\n$$\nW_{\\mathrm{val}} = \\max_{\\mathbf{k}\\in\\mathrm{path}} E_{1}(\\mathbf{k}) - \\min_{\\mathbf{k}\\in\\mathrm{path}} E_{1}(\\mathbf{k}),\n$$\n单位为电子伏特。将给定情况的“收敛误差”定义为\n$$\n\\Delta W = \\left|W_{\\mathrm{val}}(E_{\\mathrm{cut}}) - W_{\\mathrm{val}}(E_{\\mathrm{cut}}^{\\mathrm{ref}})\\right|,\n$$\n其中 $E_{\\mathrm{cut}}^{\\mathrm{ref}}$ 是一个用作同一赝势模型的固定参考的更高截断能。\n\n测试套件：\n- 在你的实现中使用以下赝势参数：$V_0 = 10.0$ $\\mathrm{eV}$，$q_0^{\\mathrm{PAW}} = 2.0$ $\\mathrm{\\AA}^{-1}$，$q_0^{\\mathrm{NC}} = 3.5$ $\\mathrm{\\AA}^{-1}$。\n- 使用 $E_{\\mathrm{cut}}^{\\mathrm{ref}} = 60.0$ $\\mathrm{eV}$ 作为参考截断能。\n- 评估以下六种情况：\n    1. PAW 类模型，截断能 $E_{\\mathrm{cut}} = 10.0$ $\\mathrm{eV}$。\n    2. 模守恒模型，截断能 $E_{\\mathrm{cut}} = 10.0$ $\\mathrm{eV}$。\n    3. PAW 类模型，截断能 $E_{\\mathrm{cut}} = 20.0$ $\\mathrm{eV}$。\n    4. 模守恒模型，截断能 $E_{\\mathrm{cut}} = 20.0$ $\\mathrm{eV}$。\n    5. PAW 类模型，截断能 $E_{\\mathrm{cut}} = 40.0$ $\\mathrm{eV}$。\n    6. 模守恒模型，截断能 $E_{\\mathrm{cut}} = 40.0$ $\\mathrm{eV}$。\n\n要求的输出和单位：\n- 对于每种情况，计算以电子伏特为单位的价带宽度 $W_{\\mathrm{val}}$ 和以电子伏特为单位的收敛误差 $\\Delta W$，两者都应为浮点数。\n- 你的程序应生成单行输出，其中包含结果，形式为用方括号括起来的、以逗号分隔的数对列表，每种情况对应一个数对，每个数对本身是一个二元列表 $[W_{\\mathrm{val}},\\Delta W]$。例如：“[[w1,err1],[w2,err2],...]”，其中每个 $w_i$ 和 $err_i$ 都以电子伏特为单位。\n\n科学真实性约束：\n- 模型必须遵守所述的物理假设和单位。\n- 不要包含任何外部数据或捷径。哈密顿量必须按照描述从第一性原理构建。\n- 所有能量必须以电子伏特报告。\n- 不需要角度。\n- 不需要百分比。\n\n你的实现必须是一个完整、可运行的 Python 程序，能够执行上述计算，并以确切指定的格式在单行上打印结果。", "solution": "我们从周期势中的单粒子薛定谔方程开始，\n$$\n\\left(-\\frac{\\hbar^2}{2m}\\nabla^2 + V(\\mathbf{r})\\right)\\psi(\\mathbf{r}) = E\\psi(\\mathbf{r}).\n$$\n对于具有晶格周期性的晶体，根据布洛赫定理，在晶体动量 $\\mathbf{k}$ 处的本征态可以展开为平面波级数，\n$$\n\\psi_{\\mathbf{k}}(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{\\mathbf{k}}(\\mathbf{G}) e^{i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}},\n$$\n其中求和遍历所有倒格矢 $\\mathbf{G}$。将平面波展开式代入薛定谔方程，并投影到一个平面波上，得到矩阵元\n$$\nH_{\\mathbf{G},\\mathbf{G}'}(\\mathbf{k}) = \\delta_{\\mathbf{G},\\mathbf{G}'}\\frac{\\hbar^2}{2m}|\\mathbf{k}+\\mathbf{G}|^2 + V(\\mathbf{G}-\\mathbf{G}').\n$$\n动能项是对角的，而势能项通过傅里叶变换 $V(\\mathbf{q})$ 耦合了相隔 $\\mathbf{q} = \\mathbf{G}-\\mathbf{G}'$ 的平面波。对于每个常规立方晶胞有两个原子的金刚石结构硅，周期性局域势的傅里叶系数可以表示为\n$$\nV(\\mathbf{q}) = S(\\mathbf{q})\\,v(|\\mathbf{q}|), \\quad S(\\mathbf{q}) = 1 + e^{i\\mathbf{q}\\cdot\\boldsymbol{\\tau}},\n$$\n其中 $\\boldsymbol{\\tau} = \\frac{a}{4}(1,1,1)$ 是常规立方晶胞中第二个原子的基矢，$v(|\\mathbf{q}|)$ 是一个体现赝势的球对称形状因子。\n\n我们选择两种有充分理由的倒易空间形状因子：\n- 一种 PAW 类（投影缀加波）替代模型\n$$\nv_{\\mathrm{PAW}}(q) = -V_0 \\exp\\left[-\\left(\\frac{q}{q_0^{\\mathrm{PAW}}}\\right)^2\\right],\n$$\n- 一种模守恒模型\n$$\nv_{\\mathrm{NC}}(q) = -V_0 \\exp\\left[-\\left(\\frac{q}{q_0^{\\mathrm{NC}}}\\right)^2\\right],\n$$\n其中 $q_0^{\\mathrm{NC}} > q_0^{\\mathrm{PAW}}$，以确保模守恒形状因子随 $q$ 衰减得更慢，因而更“硬”，这与模守恒赝势需要更多平面波才能收敛这一公认的观察结果一致。\n\n我们从硅的面心立方 (FCC) 常规立方晶胞构建倒格子 $\\mathbf{G}$，其晶格常数 $a = 5.431$ $\\mathrm{\\AA}$。常规立方倒易基矢为 $\\frac{2\\pi}{a}\\hat{\\mathbf{x}}$、$\\frac{2\\pi}{a}\\hat{\\mathbf{y}}$ 和 $\\frac{2\\pi}{a}\\hat{\\mathbf{z}}$，但只有全为偶数或全为奇数的整数三元组 $(h,k,l)$ 才对应于 FCC 正格子的体心立方 (BCC) 倒格子；因此我们将指数 $(h,k,l)$ 限制为奇偶性相同。我们使用动能截断 $E_{\\mathrm{cut}}$ 来截断平面波基，具体条件为\n$$\n\\frac{\\hbar^2}{2m}|\\mathbf{G}|^2 \\le E_{\\mathrm{cut}},\n$$\n并使用 $\\frac{\\hbar^2}{2m} = 3.80998212$ $\\mathrm{eV}\\cdot\\mathrm{\\AA}^2$。\n\n为了得到能带色散关系，我们在倒易空间中扫描一条高对称路径：\n- $\\Gamma = (0,0,0)$,\n- $X = \\left(\\frac{\\pi}{a},0,0\\right)$,\n- $L = \\left(\\frac{\\pi}{a},\\frac{\\pi}{a},\\frac{\\pi}{a}\\right)$.\n我们从 $\\Gamma$ 到 $X$ 采样 $N_\\Gamma = 20$ 个点，从 $X$ 到 $L$ 采样 $N_X = 20$ 个点，从而生成沿路径的一组 $\\mathbf{k}$ 点。\n\n对于每个 $\\mathbf{k}$，我们组装哈密顿量 $H(\\mathbf{k})$，其维度 $M$ 等于所包含的 $\\mathbf{G}$ 矢量的数量。对角元为 $\\frac{\\hbar^2}{2m}|\\mathbf{k}+\\mathbf{G}|^2$。非对角耦合元 $V(\\mathbf{G}-\\mathbf{G}')$ 仅取决于 $\\mathbf{G}-\\mathbf{G}'$，并且可以预先计算在一个矩阵 $V_{\\mathbf{G},\\mathbf{G}'}$ 中。完整的哈密顿量为\n$$\nH_{\\mathbf{G},\\mathbf{G}'}(\\mathbf{k}) = \\delta_{\\mathbf{G},\\mathbf{G}'}\\frac{\\hbar^2}{2m}|\\mathbf{k}+\\mathbf{G}|^2 + V_{\\mathbf{G},\\mathbf{G}'}.\n$$\n由于 $V(\\mathbf{q})$ 在 $v(q)$ 为实数、结构因子 $S(\\mathbf{q})$ 为复数的情况下满足 $V(-\\mathbf{q}) = V(\\mathbf{q})^*$，因此哈密顿量是厄米的，可以使用标准算法进行对角化。将本征值按升序排列，得到能带 $E_n(\\mathbf{k})$，$n=1,\\dots,M$。\n\n我们将价带宽度定义为最低能带沿路径的能量展宽，\n$$\nW_{\\mathrm{val}} = \\max_{\\mathbf{k}} E_1(\\mathbf{k}) - \\min_{\\mathbf{k}} E_1(\\mathbf{k}).\n$$\n在单粒子图像中，最低能带对应于局域势模型中束缚最紧的类价带，此定义与之相符。尽管对价带占据的完整描述需要进行电子计数，但我们在这里关注的是相对色散和收敛行为。为评估收敛性，我们将误差定义为相对于更高截断能参考值的差，\n$$\n\\Delta W = \\left|W_{\\mathrm{val}}(E_{\\mathrm{cut}}) - W_{\\mathrm{val}}(E_{\\mathrm{cut}}^{\\mathrm{ref}})\\right|.\n$$\n\n算法步骤：\n1. 设置 $a = 5.431$ $\\mathrm{\\AA}$，计算 $b = \\frac{2\\pi}{a}$ 和 $\\alpha = \\frac{\\hbar^2}{2m} = 3.80998212$ $\\mathrm{eV}\\cdot\\mathrm{\\AA}^2$。\n2. 生成倒格矢 $\\mathbf{G} = b(h,k,l)$，其整数边界由 $E_{\\mathrm{cut}}$ 决定：要求 $\\alpha|\\mathbf{G}|^2 \\le E_{\\mathrm{cut}}$ 且 $(h,k,l)$ 的奇偶性相同。\n3. 使用 $\\boldsymbol{\\tau} = \\frac{a}{4}(1,1,1)$ 构建金刚石结构因子 $S(\\mathbf{q}) = 1 + e^{i\\mathbf{q}\\cdot\\boldsymbol{\\tau}}$。\n4. 使用 $V_0 = 10.0$ $\\mathrm{eV}$、$q_0^{\\mathrm{PAW}} = 2.0$ $\\mathrm{\\AA}^{-1}$ 和 $q_0^{\\mathrm{NC}} = 3.5$ $\\mathrm{\\AA}^{-1}$ 定义赝势形状因子 $v(q)$。\n5. 为所选赝势预先计算势能矩阵 $V_{\\mathbf{G},\\mathbf{G}'} = S(\\mathbf{G}-\\mathbf{G}')\\,v(|\\mathbf{G}-\\mathbf{G}'|)$。\n6. 通过在 $\\Gamma$ 到 $X$ 之间插值 20 个点以及在 $X$ 到 $L$ 之间插值 20 个点来构建 $\\mathbf{k}$ 路径。\n7. 对于每个 $\\mathbf{k}$，通过将动能对角项与 $V$ 矩阵相加来组装 $H(\\mathbf{k})$，对其进行对角化以获得本征值，并收集最低的本征值 $E_1(\\mathbf{k})$。\n8. 计算 $W_{\\mathrm{val}}$ 作为 $E_1$ 在整个路径上的展宽。\n9. 对于每种赝势模型，在 $E_{\\mathrm{cut}}^{\\mathrm{ref}} = 60.0$ $\\mathrm{eV}$ 处计算一个参考 $W_{\\mathrm{val}}$，并计算每个目标 $E_{\\mathrm{cut}}$ 的 $\\Delta W$ 作为绝对差值。\n10. 以电子伏特为单位，将结果报告为数对 $[W_{\\mathrm{val}}, \\Delta W]$。\n\n基于第一性原理的预期行为：\n- PAW 类模型的 $v(q)$ 衰减更快，因此强调低 $q$ 分量，从而在使用截断平面波基时收敛得更快；在低 $E_{\\mathrm{cut}}$ 时，PAW 类模型的 $W_{\\mathrm{val}}$ 将更接近其高截断能参考值，从而产生更小的 $\\Delta W$。\n- 模守恒模型的衰减较慢，需要更高的 $E_{\\mathrm{cut}}$ 才能精确表示波函数；在相同的低 $E_{\\mathrm{cut}}$ 下，$W_{\\mathrm{val}}$ 将与参考值有更大的偏差，从而产生更大的 $\\Delta W$。\n- 随着 $E_{\\mathrm{cut}}$ 的增加，两种模型都应显示出 $\\Delta W$ 的减小，这反映了收敛性的改善。\n\n该实现严格遵守所述的物理原理，仅使用指定的库，以电子伏特计算所有能量，并以规定的格式返回单行输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Physical constants and lattice parameter\nHBAR2_OVER_2M = 3.80998212  # eV*Angstrom^2\nA_SI = 5.431  # Angstrom\nB_RECIP = 2.0 * np.pi / A_SI  # 1/Angstrom\n\n# High-symmetry k-path points in 1/Angstrom\nK_GAMMA = np.array([0.0, 0.0, 0.0])\nK_X = np.array([np.pi / A_SI, 0.0, 0.0])\nK_L = np.array([np.pi / A_SI, np.pi / A_SI, np.pi / A_SI])\n\n# Diamond basis vector tau in Angstrom\nTAU = (A_SI / 4.0) * np.array([1.0, 1.0, 1.0])\n\ndef generate_bcc_reciprocal_vectors(E_cut):\n    \"\"\"\n    Generate reciprocal lattice vectors G = B_RECIP * (h,k,l) (in 1/Angstrom)\n    for FCC direct lattice (BCC reciprocal), restricted to indices of equal parity,\n    and satisfying the kinetic energy cutoff condition HBAR2_OVER_2M * |G|^2 = E_cut.\n    \"\"\"\n    # Determine bounds for h,k,l using maximum integer such that alpha * (b^2) * n^2 = E_cut\n    # alpha*b^2 ~ scaling per integer squared\n    alpha_b2 = HBAR2_OVER_2M * (B_RECIP ** 2)\n    # max integer in one direction assuming other components are zero\n    n_max = int(np.floor(np.sqrt(E_cut / alpha_b2))) + 1\n    G_list = []\n    for h in range(-n_max, n_max + 1):\n        for k in range(-n_max, n_max + 1):\n            for l in range(-n_max, n_max + 1):\n                # Enforce equal parity (all even or all odd) for BCC reciprocal lattice\n                if (h % 2) == (k % 2) and (k % 2) == (l % 2):\n                    G = B_RECIP * np.array([h, k, l], dtype=float)\n                    E_g = HBAR2_OVER_2M * np.dot(G, G)\n                    if E_g = E_cut + 1e-12:\n                        G_list.append(G)\n    # Sort by |G| to have a consistent order\n    G_arr = np.array(G_list)\n    norms = np.linalg.norm(G_arr, axis=1)\n    order = np.argsort(norms)\n    G_sorted = G_arr[order]\n    return G_sorted\n\ndef k_path(num_gamma_to_x=20, num_x_to_l=20):\n    \"\"\"\n    Generate the k-point path Gamma -> X -> L with specified points per segment.\n    Returns an array of shape (num_points, 3).\n    \"\"\"\n    # Linear interpolation including endpoints, but avoid double-counting X\n    ks1 = np.linspace(0.0, 1.0, num_gamma_to_x, endpoint=True)\n    seg1 = (1.0 - ks1)[:, None] * K_GAMMA[None, :] + ks1[:, None] * K_X[None, :]\n    ks2 = np.linspace(0.0, 1.0, num_x_to_l, endpoint=True)\n    seg2 = (1.0 - ks2)[:, None] * K_X[None, :] + ks2[:, None] * K_L[None, :]\n    # Concatenate; since seg1 includes X and seg2 includes X, we can include both for simplicity\n    path = np.vstack([seg1, seg2])\n    return path\n\ndef structure_factor(q_vec):\n    \"\"\"\n    Diamond structure factor S(q) = 1 + exp(i q . tau).\n    q_vec is in 1/Angstrom, tau in Angstrom.\n    Returns complex scalar.\n    \"\"\"\n    phase = np.dot(q_vec, TAU)\n    return 1.0 + np.exp(1j * phase)\n\ndef v_form_factor(q_mag, model_params):\n    \"\"\"\n    Spherically symmetric pseudopotential form factor v(q) for given magnitude q (1/Angstrom).\n    model_params: dict with keys 'V0' (eV), 'q0' (1/Angstrom).\n    v(q) = -V0 * exp(-(q/q0)^2)\n    \"\"\"\n    V0 = model_params['V0']\n    q0 = model_params['q0']\n    return -V0 * np.exp(- (q_mag / q0) ** 2)\n\ndef precompute_V_matrix(G_vectors, model_params):\n    \"\"\"\n    Precompute the potential coupling matrix V_{G,G'} = S(G - G') * v(|G - G'|)\n    for all pairs of G. Returns a complex matrix of shape (M,M).\n    \"\"\"\n    M = len(G_vectors)\n    V_mat = np.zeros((M, M), dtype=np.complex128)\n    # Precompute differences and their v(q) * S(q)\n    for i in range(M):\n        Gi = G_vectors[i]\n        for j in range(M):\n            Gj = G_vectors[j]\n            q = Gi - Gj\n            q_mag = np.linalg.norm(q)\n            S_q = structure_factor(q)\n            v_q = v_form_factor(q_mag, model_params)\n            V_mat[i, j] = S_q * v_q\n    # Enforce Hermiticity numerically by symmetrizing\n    V_mat = 0.5 * (V_mat + V_mat.conj().T)\n    return V_mat\n\ndef assemble_H_and_lowest_e(G_vectors, V_mat, k_vec):\n    \"\"\"\n    Assemble Hamiltonian H(k) = diag( alpha * |k + G|^2 ) + V_mat, and return lowest eigenvalue.\n    \"\"\"\n    # Kinetic diagonal\n    KG = G_vectors + k_vec[None, :]\n    kinetic = HBAR2_OVER_2M * np.einsum('ij,ij->i', KG, KG)  # alpha * |k+G|^2\n    H = V_mat.copy()\n    # Add kinetic to the diagonal\n    for i in range(len(kinetic)):\n        H[i, i] += kinetic[i]\n    # Diagonalize Hermitian matrix\n    evals = np.linalg.eigvalsh(H)\n    return evals[0].real  # lowest eigenvalue (real)\n\ndef compute_valence_bandwidth(E_cut, model_params, num_k_seg=20):\n    \"\"\"\n    Compute the valence bandwidth W_val for the given cutoff and pseudopotential model.\n    \"\"\"\n    Gs = generate_bcc_reciprocal_vectors(E_cut)\n    if len(Gs) == 0:\n        # If no G vectors satisfy the cutoff, bandwidth is zero by construction\n        return 0.0\n    V_mat = precompute_V_matrix(Gs, model_params)\n    kpts = k_path(num_gamma_to_x=num_k_seg, num_x_to_l=num_k_seg)\n    # Compute lowest eigenvalue at each k-point\n    lowest_e = []\n    for k in kpts:\n        e0 = assemble_H_and_lowest_e(Gs, V_mat, k)\n        lowest_e.append(e0)\n    lowest_e = np.array(lowest_e)\n    # Valence bandwidth is max-min of the lowest band energies\n    W_val = float(np.max(lowest_e) - np.min(lowest_e))\n    return W_val\n\ndef solve():\n    # Define pseudopotential parameters\n    paw_params = {'V0': 10.0, 'q0': 2.0}  # eV, 1/Angstrom\n    nc_params = {'V0': 10.0, 'q0': 3.5}   # eV, 1/Angstrom\n\n    # Reference cutoff for convergence assessment\n    E_cut_ref = 60.0  # eV\n\n    # Test cases: (label, model_params, E_cut)\n    test_cases = [\n        (\"PAW\", paw_params, 10.0),\n        (\"NC\",  nc_params, 10.0),\n        (\"PAW\", paw_params, 20.0),\n        (\"NC\",  nc_params, 20.0),\n        (\"PAW\", paw_params, 40.0),\n        (\"NC\",  nc_params, 40.0),\n    ]\n\n    # Precompute references for each model\n    W_ref = {}\n    # Compute once for PAW and NC\n    W_ref[\"PAW\"] = compute_valence_bandwidth(E_cut_ref, paw_params, num_k_seg=20)\n    W_ref[\"NC\"] = compute_valence_bandwidth(E_cut_ref, nc_params, num_k_seg=20)\n\n    results_pairs = []\n    for label, params, E_cut in test_cases:\n        W_val = compute_valence_bandwidth(E_cut, params, num_k_seg=20)\n        dW = abs(W_val - W_ref[label])\n        results_pairs.append([W_val, dW])\n\n    # Format output as a single line: list of [W_val, dW] pairs\n    # Ensure pure Python-list string formatting with numeric entries\n    def pair_to_str(pair):\n        return f\"[{pair[0]},{pair[1]}]\"\n    out = \"[\" + \",\".join(pair_to_str(p) for p in results_pairs) + \"]\"\n    print(out)\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3433862"}, {"introduction": "在获得基本的电子能带结构后，下一步是考虑更精细的物理效应，其中自旋轨道耦合（SOC）对于含有重元素的材料至关重要。本练习将通过一个 $k \\cdot p$ 微扰理论模型，让你具体分析SOC如何解除价带顶的简并，并改变有效质量等关键参数。[@problem_id:3433817] 通过这项实践，你不仅能掌握SOC的核心物理，还能熟悉 $k \\cdot p$ 方法这一分析能带边缘特性的强大理论工具。", "problem": "要求您实现并分析一个基本的、有原理支持的能带结构模型，该模型针对重元素半导体布里渊区 (BZ) 中心，即称为 Gamma ($\\Gamma$) 的高对称点附近。目标是比较有自旋轨道耦合 (SOC) 和没有自旋轨道耦合的能带结构，量化 $\\Gamma$ 点处类 p 价态的能量分裂，并分析有效质量和能带排序的变化。您的解决方案必须是一个完整的、可运行的程序，该程序为定义的测试套件执行指定的计算，并按如下所述的格式单行输出结果。\n\n从以下基本且经过充分测试的公式开始：\n\n- 在有效质量近似中，能带极值点附近的非相对论单粒子能带能量是抛物线型的，其色散关系为 $E(\\mathbf{k}) = E_0 \\pm \\frac{\\hbar^2 |\\mathbf{k}|^2}{2 m_{\\mathrm{eff}}}$，其中 $\\hbar$ 是约化普朗克常数，$m_{\\mathrm{eff}}$ 是能带有效质量，+ 适用于导带，- 适用于价带，$E_0$ 是 $\\mathbf{k}=\\mathbf{0}$ 处的能带边能量。\n- 对于轨道角动量 $\\mathbf{L}$ 和自旋 $\\mathbf{S}$，原子自旋轨道耦合 (SOC) 相互作用为 $H_{\\mathrm{SO}} = \\lambda \\, \\mathbf{L} \\cdot \\mathbf{S}$，其中 $\\lambda$ 是 SOC 强度参数。\n- 对于类 p 流形（$l=1$, $s=\\tfrac{1}{2}$），SOC 将类 p 态分裂为一个总角动量为 $j=\\tfrac{3}{2}$ 的四重态和一个总角动量为 $j=\\tfrac{1}{2}$ 的二重态。能级为\n$$\nE_j = \\frac{\\lambda}{2} \\left[ j(j+1) - l(l+1) - s(s+1) \\right] ,\n$$\n其中 $l=1$ 且 $s=\\tfrac{1}{2}$。$j=\\tfrac{3}{2}$ 流形和 $j=\\tfrac{1}{2}$ 流形之间的能量间隔，称为分裂能，为\n$$\n\\Delta_{\\mathrm{so}} = E_{3/2} - E_{1/2} = \\frac{3}{2}\\lambda .\n$$\n- 在 $k \\cdot p$ 理论对 $j=\\tfrac{3}{2}$ 价带流形的球形近似（Luttinger-Kohn 模型）中，重空穴和轻空穴的有效质量为\n$$\nm_{\\mathrm{hh}} = \\frac{m_0}{\\gamma_1 - 2\\gamma} , \\quad\nm_{\\mathrm{lh}} = \\frac{m_0}{\\gamma_1 + 2\\gamma} ,\n$$\n其中 $m_0$ 是电子静止质量，$\\gamma_1$、$\\gamma$ 是 Luttinger 参数，在球形近似中 $\\gamma \\equiv \\gamma_2 \\approx \\gamma_3$。分裂能带 ($j=\\tfrac{1}{2}$) 在 $\\Gamma$ 点有 $-\\Delta_{\\mathrm{so}}$ 的能量偏移，其抛物线曲率由一个有效质量 $m_{\\mathrm{so}}$ 表征，此处视为给定参数。\n\n定义两个模型进行比较：\n1. 无自旋轨道耦合的模型，其中类 p 价带流形在 $\\Gamma$ 点是三重简并的，具有单一的各向同性有效质量 $m_p$ 和色散关系 $E_v(\\mathbf{k}) = E_v(0) - \\frac{\\hbar^2 |\\mathbf{k}|^2}{2 m_p}$。\n2. 有自旋轨道耦合的模型，其中类 p 价带流形由重空穴（$j=\\tfrac{3}{2}$, $m_{\\mathrm{hh}}$）、轻空穴（$j=\\tfrac{3}{2}$, $m_{\\mathrm{lh}}$）和分裂（$j=\\tfrac{1}{2}$, $m_{\\mathrm{so}}$）抛物线能带组成。$\\Gamma$ 点附近的相应色散关系为\n$$\nE_{\\mathrm{hh}}(\\mathbf{k}) = E_v(0) - \\frac{\\hbar^2 |\\mathbf{k}|^2}{2 m_{\\mathrm{hh}}},\\quad\nE_{\\mathrm{lh}}(\\mathbf{k}) = E_v(0) - \\frac{\\hbar^2 |\\mathbf{k}|^2}{2 m_{\\mathrm{lh}}},\\quad\nE_{\\mathrm{so}}(\\mathbf{k}) = E_v(0) - \\Delta_{\\mathrm{so}} - \\frac{\\hbar^2 |\\mathbf{k}|^2}{2 m_{\\mathrm{so}}}.\n$$\n\n假设导带底是抛物线型的，位于 $E_c(0) = E_g$，有效质量为 $m_c$，色散关系为 $E_c(\\mathbf{k}) = E_g + \\frac{\\hbar^2 |\\mathbf{k}|^2}{2 m_c}$。\n\n您的程序必须：\n- 通过计算一维网格 $k \\in [0, k_{\\max}]$ 上均匀间隔的点来采样 $\\Gamma \\rightarrow X$ 方向上的波矢大小 $k = |\\mathbf{k}|$。对 $k$ 使用单位 $\\mathrm{\\AA}^{-1}$。\n- 对每个测试用例，在 $k$ 网格上计算两个模型的能带能量。\n- 将 SOC 模型中类 p 价态的 $\\Gamma$ 点分裂量化为 $\\Delta_{\\mathrm{so}}$，以 $\\mathrm{eV}$ 表示。\n- 通过将小 $k$ 色散拟合到抛物线形式 $E(k) \\approx E_0 + s k^2$ 来数值估算每个相关价带的有效质量，并使用关系式\n$$\nm_{\\mathrm{eff}} = \\frac{\\hbar^2 (10^{10})^2}{2 \\, |s| \\, (1.602176634 \\times 10^{-19})} ,\n$$\n这将拟合的斜率 $s$ 从 $\\mathrm{eV}\\,\\mathrm{\\AA}^2$ 转换为以 $\\mathrm{kg}$ 为单位的质量；然后报告 $m_{\\mathrm{eff}}/m_0$ 作为无量纲比率。这里，$\\hbar$ 的单位是 $\\mathrm{J}\\cdot\\mathrm{s}$，$1\\,\\mathrm{\\AA} = 10^{-10}\\,\\mathrm{m}$，$1\\,\\mathrm{eV} = 1.602176634 \\times 10^{-19}\\,\\mathrm{J}$。对价带使用 $s$ 的绝对值，价带在 $\\Gamma$ 附近是向下弯曲的。\n- 通过比较价带子带和导带的能带边能量来确定 $\\Gamma$ 点的能带排序。将排序编码为整数代码：\n  - $0$ 如果 SOC 模型在 $\\Gamma$ 点显示正常排序：重空穴和轻空穴在 $E_v(0)$ 处简并，分裂能带在 $E_v(0) - \\Delta_{\\mathrm{so}}$，导带在 $E_c(0) = E_g  E_v(0)$。\n  - $3$ 如果无 SOC 模型显示类 p 三重简并价带顶在 $E_v(0)$，导带在 $E_g  E_v(0)$。\n  - $1$ 对于您的代码检测到的任何其他排序。\n- 能量以 $\\mathrm{eV}$ 表示，有效质量表示为相对于 $m_0$ 的比率，波矢以 $\\mathrm{\\AA}^{-1}$ 表示。不出现角度。不要使用百分比。\n\n使用以下参数集测试套件，每个参数集是一个元组，包含 $(a, E_g, m_c, m_p, \\gamma_1, \\gamma, \\Delta_{\\mathrm{so}}, m_{\\mathrm{so}}, k_{\\max}, N)$，其中 $a$ 是晶格参数，单位为 $\\mathrm{\\AA}$（仅用于将 $\\Gamma \\rightarrow X$ 方向情境化），$E_g$ 是带隙，单位为 $\\mathrm{eV}$，$m_c$ 是导带有效质量比 $m_c/m_0$，$m_p$ 是无 SOC 时的价带 p-流形有效质量比，$\\gamma_1$ 和 $\\gamma$ 是 Luttinger 参数，$\\Delta_{\\mathrm{so}}$ 是分裂能，单位为 $\\mathrm{eV}$，$m_{\\mathrm{so}}$ 是分裂有效质量比 $m_{\\mathrm{so}}/m_0$，$k_{\\max}$ 是采样的最大波矢，单位为 $\\mathrm{\\AA}^{-1}$，$N$ 是点数：\n- 测试用例 1（强 SOC，类 InSb）：$(6.48, 0.23, 0.013, 0.35, 5.0, 1.4, 0.80, 0.25, 0.05, 51)$。\n- 测试用例 2（边界情况，无 SOC）：$(6.48, 0.23, 0.013, 0.35, 5.0, 1.4, 0.00, 0.25, 0.05, 51)$。\n- 测试用例 3（更强的 SOC，改变了价带参数）：$(6.48, 0.20, 0.015, 0.40, 4.5, 1.8, 1.20, 0.20, 0.05, 51)$。\n\n对于每个测试用例，您的程序必须生成一个包含以下条目的列表：\n- $[\\Delta_{\\mathrm{so}}, m_{\\mathrm{hh}}/m_0, m_{\\mathrm{lh}}/m_0, m_{\\mathrm{so}}/m_0, m_p/m_0, \\text{order\\_code}]$，\n其中 $\\Delta_{\\mathrm{so}}$ 的单位是 $\\mathrm{eV}$，所有质量都是无量纲比率，$\\text{order\\_code}$ 是上面定义的整数。有效质量必须如上所述从色散拟合中数值获得，而不是直接代入参数公式。\n\n您的程序应生成单行输出，其中包含三个测试用例的结果，格式为用方括号括起来的逗号分隔列表，例如：\n$[[\\Delta_1,m_{\\mathrm{hh},1},m_{\\mathrm{lh},1},m_{\\mathrm{so},1},m_{p,1},\\text{ord}_1],[\\Delta_2,\\dots],[\\Delta_3,\\dots]]$，\n所有浮点数四舍五入到六位小数。不允许有其他输出。代码不得要求任何用户输入、外部文件或网络访问。", "solution": "经评估，问题陈述有效。它科学地基于固态物理学的既定原理，即半导体能带结构的有效质量近似和 $k \\cdot p$ 理论。问题是适定的，提供了一套完整且一致的参数、定义和计算任务，这些任务导向一个唯一的、可验证的解决方案。术语是客观和精确的。因此，将提供一个解决方案。\n\n这个问题的核心是建模并比较半导体在布里渊区中心（$\\Gamma$ 点）附近的电子能带结构，使用两种形式：一种没有自旋轨道耦合（SOC），另一种有。解决方案涉及计算几个能带的能量色散 $E(k)$，并从这些色散中提取关键物理参数，如有效质量，并表征能带排序。\n\n首先，我们建立必要的物理常数和一个关键的预因子，以简化能量色散方程。抛物线色散关系由 $E(\\mathbf{k}) = E_0 \\pm \\frac{\\hbar^2 |\\mathbf{k}|^2}{2 m_{\\mathrm{eff}}}$ 给出。为了使用指定的单位——能量以电子伏特（$eV$）计，波矢 $k = |\\mathbf{k}|$ 以埃分之一（$\\mathrm{\\AA}^{-1}$）计，有效质量 $m_{\\mathrm{eff}}$ 作为相对于电子静止质量 $m_0$ 的无量纲比率——我们必须推导出一个方便的数值因子。\n\n设 $m_{\\mathrm{eff,ratio}} = m_{\\mathrm{eff}}/m_0$。在 SI 单位中，色散为 $E_{\\mathrm{J}} = E_{0,\\mathrm{J}} \\pm \\frac{\\hbar^2}{2 m_0 m_{\\mathrm{eff,ratio}}} k_{\\mathrm{SI}}^2$，其中 $k_{\\mathrm{SI}}$ 的单位是 $m^{-1}$。鉴于 $1 \\mathrm{\\AA} = 10^{-10} m$，一个以 $\\mathrm{\\AA}^{-1}$ 为单位的波矢 $k$ 对应于 $k_{\\mathrm{SI}} = k \\times 10^{10} m^{-1}$。代入此式，我们得到 $E_{\\mathrm{J}} = E_{0,\\mathrm{J}} \\pm \\frac{\\hbar^2 (10^{20})}{2 m_0 m_{\\mathrm{eff,ratio}}} k^2$。为了将能量转换为 $eV$，我们除以基本电荷 $e$。\n$$\nE_{\\mathrm{eV}} = E_{0,\\mathrm{eV}} \\pm \\left( \\frac{\\hbar^2 10^{20}}{2 m_0 e} \\right) \\frac{1}{m_{\\mathrm{eff,ratio}}} k^2.\n$$\n括号中的项是一个常数，单位为 $eV \\cdot \\mathrm{\\AA}^2$。使用约化普朗克常数 $\\hbar$、电子静止质量 $m_0$ 和基本电荷 $e$ 的标准值，计算此因子：\n$$\nC = \\frac{\\hbar^2 (10^{10})^2}{2 m_0 e} \\approx 3.80998 \\, \\mathrm{eV \\cdot \\AA^2}.\n$$\n有了这个常数，问题中定义的各种能带的色散关系可以写成一种计算上友好的形式。我们将 $\\Gamma$ 点的价带流形顶部 $E_v(0)$ 设置为能量参考点，即 $E_v(0) = 0 \\, eV$。\n\n问题要求为每组给定的参数分析两个模型。\n\n模型 1：无自旋轨道耦合 (No-SOC)\n- 一个单一的三重简并类 p 价带，色散关系为 $E_p(k) = -\\frac{C}{m_p/m_0} k^2$。\n- 导带，色散关系为 $E_c(k) = E_g + \\frac{C}{m_c/m_0} k^2$。\n\n模型 2：有自旋轨道耦合 (SOC)\n在这里，$\\Gamma$ 点的类 p 价带简并被解除。六个态（3个轨道 $\\times$ 2个自旋）分裂成一个 $j=3/2$ 四重态和一个 $j=1/2$ 二重态。在 $\\Gamma$ 点附近，$j=3/2$ 态由于晶体势效应进一步分裂成重空穴 (hh) 和轻空穴 (lh) 能带，这由 Luttinger 参数 $\\gamma_1$ 和 $\\gamma$ 描述。\n- 重空穴能带：$E_{\\mathrm{hh}}(k) = -\\frac{C}{m_{\\mathrm{hh}}/m_0} k^2$。\n- 轻空穴能带：$E_{\\mathrm{lh}}(k) = -\\frac{C}{m_{\\mathrm{lh}}/m_0} k^2$。\n- 分裂能带 ($j=1/2$)：$E_{\\mathrm{so}}(k) = -\\Delta_{\\mathrm{so}} - \\frac{C}{m_{\\mathrm{so}}/m_0} k^2$。\n- 导带与无 SOC 模型中的相同：$E_c(k) = E_g + \\frac{C}{m_c/m_0} k^2$。\n重空穴和轻空穴的有效质量比由 Luttinger 参数确定：\n$$\n\\frac{m_{\\mathrm{hh}}}{m_0} = \\frac{1}{\\gamma_1 - 2\\gamma}, \\quad \\frac{m_{\\mathrm{lh}}}{m_0} = \\frac{1}{\\gamma_1 + 2\\gamma}.\n$$\n分裂能 $\\Delta_{\\mathrm{so}}$ 和分裂能带有效质量比 $m_{\\mathrm{so}}/m_0$ 是直接给出的。\n\n对于每个测试用例，算法按以下步骤进行：\n1.  将波矢网格 $k$ 定义为一个从 $0$ 到 $k_{\\max}$ 的 $N$ 个点的线性间隔数组。\n2.  使用提供的 Luttinger 参数计算理论有效质量比 $m_{\\mathrm{hh}}/m_0$ 和 $m_{\\mathrm{lh}}/m_0$。\n3.  使用上面推导的公式，在 $k$ 网格上计算所有相关能带（无 SOC 模型的 p 能带；SOC 模型的 hh、lh、so 能带）的能量色散 $E(k)$。\n4.  数值估算每个能带的有效质量。根据问题描述，这是通过将 $k=0$ 附近的计算色散拟合到抛物线 $E(k) \\approx E_0 + s k^2$ 来完成的。这等同于对 $E$ 与 $k^2$ 进行线性拟合，其中斜率为 $s$。拟合使用 $k=0$ 附近少量点（例如，前5个非零 $k$ 点）来准确捕捉能带极值点的曲率。为此使用标准的线性回归算法。\n5.  然后，使用前面推导的关系的逆关系，从拟合的斜率 $s$（单位 $eV \\cdot \\mathrm{\\AA}^2$）中恢复有效质量比：\n$$\n\\frac{m_{\\mathrm{eff}}}{m_0} = \\frac{C}{|s|}\n$$\n这种数值估算可作为模型实现的验证，因为恢复的质量应与输入参数或从 Luttinger 参数计算的值相匹配。\n6.  能带排序代码根据物理参数确定。一个关键的观察是，输出列表包含来自 SOC 和无 SOC 模型的参数，这意味着进行比较分析。最合乎逻辑的解释是根据参数所描述的物理情况来分配代码。\n    - 如果 $\\Delta_{\\mathrm{so}}  0$，系统具有自旋轨道耦合。如果带隙 $E_g$ 为正，能带表现出正常排序，因此代码为 $0$。\n    - 如果 $\\Delta_{\\mathrm{so}} = 0$，系统没有自旋轨道耦合。如果 $E_g  0$，则无 SOC 模型是相关的描述，其特征是在 $\\Gamma$ 点有一个三重简并的价带顶，对应于代码 $3$。\n    - 代码 $1$ 保留给其他非物理排序（例如，负带隙或负分裂能），在提供的测试用例中不会遇到。\n7.  最后，对于每个测试用例，组装所需的输出列表——$[\\Delta_{\\mathrm{so}}, m_{\\mathrm{hh}}/m_0, m_{\\mathrm{lh}}/m_0, m_{\\mathrm{so}}/m_0, m_p/m_0, \\text{order\\_code}]$——其中质量是数值估算值，所有浮点数格式化为六位小数。然后，将所有测试用例收集的结果格式化为最终的单行输出字符串。\n\n这个系统化的步骤确保了问题的所有要求都得到满足，为指定的能带结构模型提供了严谨且可复现的分析。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import linregress\nfrom scipy.constants import hbar, m_e, e\n\ndef solve():\n    \"\"\"\n    Implements and analyzes a k.p band-structure model with and without SOC.\n    \"\"\"\n    # Define physical constants and the conversion factor.\n    # The factor C converts 1/(mass_ratio) into a dispersion coefficient in eV*A^2.\n    # C = hbar^2 / (2 * m_0) in J*m^2, converted to eV*A^2.\n    # 1 A = 1e-10 m, so 1 A^-2 = 1e20 m^-2.\n    # Energy is converted from J to eV by dividing by e.\n    C_FACTOR = (hbar**2 * (1e10)**2) / (2 * m_e * e) # eV * Angstrom^2\n\n    # Define the test cases from the problem statement.\n    # (a, E_g, m_c/m_0, m_p/m_0, gamma_1, gamma, Delta_so, m_so/m_0, k_max, N)\n    test_cases = [\n        (6.48, 0.23, 0.013, 0.35, 5.0, 1.4, 0.80, 0.25, 0.05, 51),\n        (6.48, 0.23, 0.013, 0.35, 5.0, 1.4, 0.00, 0.25, 0.05, 51),\n        (6.48, 0.20, 0.015, 0.40, 4.5, 1.8, 1.20, 0.20, 0.05, 51),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        a, E_g, mc_r, mp_r, g1, g, D_so, mso_r, k_max, N = case\n\n        # 1. Theoretical mass ratios for the SOC model\n        # Check for positivity of denominators, though test cases are valid.\n        if g1 - 2 * g = 0 or g1 + 2 * g = 0:\n            raise ValueError(\"Luttinger parameters result in non-positive mass.\")\n        mhh_r_theory = 1.0 / (g1 - 2 * g)\n        mlh_r_theory = 1.0 / (g1 + 2 * g)\n\n        # 2. k-vector grid\n        k_grid = np.linspace(0, k_max, N)\n        k2_grid = k_grid**2\n\n        # 3. Calculate band dispersions\n        # E_v(0) is the reference energy 0 eV.\n        # Conduction band (analytic, not needed for fitting valence bands)\n        # E_c = E_g + C_FACTOR / mc_r * k2_grid\n\n        # No-SOC model valence band\n        E_p = -C_FACTOR / mp_r * k2_grid\n\n        # SOC model valence bands\n        E_hh = -C_FACTOR / mhh_r_theory * k2_grid\n        E_lh = -C_FACTOR / mlh_r_theory * k2_grid\n        E_so = -D_so - C_FACTOR / mso_r * k2_grid\n        \n        # 4. Numerically estimate effective masses via linear regression\n        # Use first 5 non-zero k-points for fitting small-k dispersion.\n        # This captures curvature at Gamma.\n        fit_slice = slice(1, 6)\n        k2_fit = k2_grid[fit_slice]\n\n        def get_mass_ratio_from_fit(energy_band, k2_points_to_fit):\n            # Fit E vs k^2 to a line E = s*k^2 + E_0. The slope is s.\n            # For bands originating at E=0, we fit E vs k^2.\n            # For the split-off band, we fit E vs k^2 to find the slope\n            # and the intercept will be -Delta_so.\n            slope = linregress(k2_points_to_fit, energy_band[fit_slice]).slope\n            \n            # The problem defines mass from |s|. Valence bands have s0.\n            if abs(slope)  1e-9: # Avoid division by zero for flat bands\n                return np.inf\n            \n            mass_ratio = C_FACTOR / abs(slope)\n            return mass_ratio\n\n        mhh_r_num = get_mass_ratio_from_fit(E_hh, k2_fit)\n        mlh_r_num = get_mass_ratio_from_fit(E_lh, k2_fit)\n        mso_r_num = get_mass_ratio_from_fit(E_so, k2_fit)\n        mp_r_num = get_mass_ratio_from_fit(E_p, k2_fit)\n\n        # 5. Determine the band ordering code\n        order_code = 1 # Default to 'other'\n        # The primary physical model is chosen based on Delta_so.\n        if D_so > 0:\n            # System has SOC. Check for normal ordering in SOC model.\n            if E_g > 0:\n                order_code = 0\n        elif D_so == 0:\n            # System has no SOC. Check for normal ordering in no-SOC model.\n            if E_g > 0:\n                order_code = 3\n        # If D_so  0 or E_g = 0, code remains 1 (unphysical/inverted).\n        \n        # 6. Assemble the results for this test case\n        case_result = [D_so, mhh_r_num, mlh_r_num, mso_r_num, mp_r_num, order_code]\n        all_results.append(case_result)\n\n    # 7. Final print statement in the exact required format.\n    def format_case(res):\n        # Format floats to 6 decimal places, integers as is.\n        formatted_parts = [f\"{x:.6f}\" if isinstance(x, float) else str(x) for x in res]\n        return f\"[{','.join(formatted_parts)}]\"\n\n    output_str = f\"[{','.join([format_case(res) for res in all_results])}]\"\n    print(output_str)\n\nsolve()\n```", "id": "3433817"}, {"introduction": "虽然DFT是计算材料科学的基石，但其系统性地低估带隙是一个众所周知的缺陷。本练习将向你介绍一种解决此问题的实用方法——“剪刀修正”，通过将DFT能带与更精确的 $G_0W_0$ 理论结果对齐来校正带隙。[@problem_id:3433858] 通过这个过程，你将学会如何评估并修正理论计算的系统误差，并批判性地分析这种简化修正方法所带来的残余误差，从而更深入地理解不同理论方法的适用范围与局限性。", "problem": "给定一个模型，用于描述立方晶体中布里渊区（BZ）中心与某个区边界方向之间路径上的能带色散。该路径是从 $\\Gamma$ 点到 $X$ 点的连线，由标量波矢 $k \\in [0,\\pi/a]$ 参数化，其中 $a$ 是晶格常数，单位为埃（$\\text{\\AA}$），$k$ 的单位为逆埃（$\\text{\\AA}^{-1}$）。能量参考点为 $\\Gamma$ 点的价带顶，其能量设为 0 电子伏特（eV）。您的任务是提出、实现并测试一个剪刀修正（scissor correction），该修正根据多体微扰理论在 $G_0W_0$ 近似（G0W0）下 $\\Gamma$ 点的基本带隙进行校准。然后，分析该修正在有效质量以及沿 $\\Gamma$–$X$ 路径的高阶导带中引入的残余误差。\n\n从以下经过充分测试的基础模型开始。对于第 $n$ 个导带（其中 $n \\in \\{1,2,3\\}$），其色散由一个非抛物线 Kane 型关系描述其色散部分 $E_{d,n}(k)$，\n$$\nE_{d,n}(k)\\bigl(1+\\alpha_n E_{d,n}(k)\\bigr) = A_n k^2,\n$$\n其中\n$$\nA_n = \\frac{\\hbar^2}{2 m_n} \\times 10^{20},\n$$\n因此，当 $k$ 的单位为 $\\text{\\AA}^{-1}$ 时，$A_n$ 的单位为 $\\text{eV}\\cdot\\text{\\AA}^2$。此处 $\\hbar$ 是普朗克约化常数，单位为 $\\text{eV}\\cdot \\text{s}$，$m_n$ 是能带有效质量，单位为千克。总能带能量为\n$$\nE_n(k) = E_{0,n} + E_{d,n}(k),\n$$\n其中 $E_{0,1} = E_g$ 是基本带隙，对于 $n \\ge 2$，$E_{0,n} = E_g + \\Delta_n$。非抛物线性参数 $\\alpha_n$ 的单位是 $\\text{eV}^{-1}$。带边的有效质量通过有效质量定理与曲率相关，对于小的 $k$ 值，其二阶导数为\n$$\n\\left.\\frac{d^2 E_n}{dk^2}\\right|_{k=0} = \\frac{\\hbar^2}{m_n} \\times 10^{20}.\n$$\n\n使用密度泛函理论（DFT）和 $G_0W_0$ 在 $\\Gamma$ 点的带边带隙来校准剪刀修正。定义\n$$\n\\Delta^{\\text{sc}} = E_g^{G_0W_0} - E_g^{\\text{DFT}}.\n$$\n将剪刀修正统一应用于所有 DFT 导带，如下所示：\n$$\nE^{\\text{sc}}_n(k) = E^{\\text{DFT}}_n(k) + \\Delta^{\\text{sc}},\n$$\n这种操作保持曲率不变，因此不改变 DFT 的有效质量。通过将剪刀修正后的量与目标 $G_0W_0$ 的量进行比较，来量化此近似引起的残余差异。\n\n您的程序必须：\n- 为 DFT 和 $G_0W_0$ 两套参数集实现上述色散模型。\n- 对于 $k$ 从 $0$ 到 $\\pi/a$（包含端点）的范围，使用一个包含 $N_k$ 个点的均匀网格，其中 $N_k \\ge 3$。\n- 通过在 $k=0$ 处使用前向三点二阶有限差分公式估算曲率，计算剪刀修正后的第一导带（CB1）和 $G_0W_0$ 的第一导带（CB1）在 $\\Gamma$ 点的有效质量：\n$$\n\\left.\\frac{d^2E}{dk^2}\\right|_{k=0} \\approx \\frac{E(2h) - 2E(h) + E(0)}{h^2}, \\quad h = \\frac{\\pi/a}{N_k-1}.\n$$\n然后使用以下公式将曲率转换为质量：\n$$\nm^* = \\frac{\\hbar^2 \\times 10^{20}}{\\left.\\frac{d^2E}{dk^2}\\right|_{k=0}},\n$$\n并报告有效质量的分数误差\n$$\n\\varepsilon_m = \\frac{m^*_{\\text{sc}} - m^*_{G_0W_0}}{m^*_{G_0W_0}},\n$$\n以无量纲小数形式表示。\n- 计算第二和第三导带（CB2 和 CB3）沿 $\\Gamma$–$X$ 路径的均方根（RMS）能量误差，\n$$\n\\mathrm{RMS}_n = \\sqrt{\\frac{1}{M}\\sum_{i=0}^{M-1}\\left(E^{\\text{sc}}_n(k_i)-E^{G_0W_0}_n(k_i)\\right)^2},\n$$\n其中 $M=N_k$，并以电子伏特（eV）为单位报告每个 RMS 值。\n\n在计算中使用以下物理常数：\n- $\\hbar = 6.582119569\\times 10^{-16}\\,\\text{eV}\\cdot \\text{s}$,\n- $m_e = 9.10938356\\times 10^{-31}\\,\\text{kg}$.\n程序内部以千克为单位报告有效质量值，但将误差表示为无量纲小数。\n\n测试套件。在以下三个参数集上运行您的实现，每个参数集都是一个包含用于某个假设立方材料的 DFT 和 $G_0W_0$ 参数的元组：\n- 案例1（典型情况）：\n  - $a = 5.65\\,\\text{\\AA}$，$N_k=101$，$E_g^{\\text{DFT}}=0.90\\,\\text{eV}$，$E_g^{G_0W_0}=1.20\\,\\text{eV}$。\n  - CB1：$m^{\\text{DFT}}/m_e = 0.25$，$\\alpha^{\\text{DFT}}=0.8\\,\\text{eV}^{-1}$，$\\Delta_1^{\\text{DFT}}=0.0\\,\\text{eV}$；$m^{G_0W_0}/m_e = 0.20$，$\\alpha^{G_0W_0}=1.0\\,\\text{eV}^{-1}$，$\\Delta_1^{G_0W_0}=0.0\\,\\text{eV}$。\n  - CB2：$\\Delta_2^{\\text{DFT}}=1.00\\,\\text{eV}$，$m^{\\text{DFT}}/m_e=0.60$，$\\alpha^{\\text{DFT}}=0.3\\,\\text{eV}^{-1}$；$\\Delta_2^{G_0W_0}=0.90\\,\\text{eV}$，$m^{G_0W_0}/m_e=0.50$，$\\alpha^{G_0W_0}=0.4\\,\\text{eV}^{-1}$。\n  - CB3：$\\Delta_3^{\\text{DFT}}=2.00\\,\\text{eV}$，$m^{\\text{DFT}}/m_e=1.20$，$\\alpha^{\\text{DFT}}=0.2\\,\\text{eV}^{-1}$；$\\Delta_3^{G_0W_0}=1.80\\,\\text{eV}$，$m^{G_0W_0}/m_e=1.00$，$\\alpha^{G_0W_0}=0.25\\,\\text{eV}^{-1}$。\n- 案例2（边界情况，零剪刀修正）：\n  - $a = 3.57\\,\\text{\\AA}$，$N_k=101$，$E_g^{\\text{DFT}}=1.50\\,\\text{eV}$，$E_g^{G_0W_0}=1.50\\,\\text{eV}$。\n  - CB1：$m^{\\text{DFT}}/m_e = 0.35$，$\\alpha^{\\text{DFT}}=0.9\\,\\text{eV}^{-1}$，$\\Delta_1^{\\text{DFT}}=0.0\\,\\text{eV}$；$m^{G_0W_0}/m_e = 0.30$，$\\alpha^{G_0W_0}=1.1\\,\\text{eV}^{-1}$，$\\Delta_1^{G_0W_0}=0.0\\,\\text{eV}$。\n  - CB2：$\\Delta_2^{\\text{DFT}}=0.80\\,\\text{eV}$，$m^{\\text{DFT}}/m_e=0.55$，$\\alpha^{\\text{DFT}}=0.4\\,\\text{eV}^{-1}$；$\\Delta_2^{G_0W_0}=0.75\\,\\text{eV}$，$m^{G_0W_0}/m_e=0.45$，$\\alpha^{G_0W_0}=0.5\\,\\text{eV}^{-1}$。\n  - CB3：$\\Delta_3^{\\text{DFT}}=1.50\\,\\text{eV}$，$m^{\\text{DFT}}/m_e=0.90$，$\\alpha^{\\text{DFT}}=0.3\\,\\text{eV}^{-1}$；$\\Delta_3^{G_0W_0}=1.40\\,\\text{eV}$，$m^{G_0W_0}/m_e=0.80$，$\\alpha^{G_0W_0}=0.35\\,\\text{eV}^{-1}$。\n- 案例3（负剪刀修正）：\n  - $a = 4.00\\,\\text{\\AA}$，$N_k=101$，$E_g^{\\text{DFT}}=1.80\\,\\text{eV}$，$E_g^{G_0W_0}=1.50\\,\\text{eV}$。\n  - CB1：$m^{\\text{DFT}}/m_e = 0.18$，$\\alpha^{\\text{DFT}}=1.1\\,\\text{eV}^{-1}$，$\\Delta_1^{\\text{DFT}}=0.0\\,\\text{eV}$；$m^{G_0W_0}/m_e = 0.22$，$\\alpha^{G_0W_0}=0.9\\,\\text{eV}^{-1}$，$\\Delta_1^{G_0W_0}=0.0\\,\\text{eV}$。\n  - CB2：$\\Delta_2^{\\text{DFT}}=1.20\\,\\text{eV}$，$m^{\\text{DFT}}/m_e=0.40$，$\\alpha^{\\text{DFT}}=0.5\\,\\text{eV}^{-1}$；$\\Delta_2^{G_0W_0}=1.10\\,\\text{eV}$，$m^{G_0W_0}/m_e=0.45$，$\\alpha^{G_0W_0}=0.45\\,\\text{eV}^{-1}$。\n  - CB3：$\\Delta_3^{\\text{DFT}}=2.50\\,\\text{eV}$，$m^{\\text{DFT}}/m_e=0.85$，$\\alpha^{\\text{DFT}}=0.3\\,\\text{eV}^{-1}$；$\\Delta_3^{G_0W_0}=2.30\\,\\text{eV}$，$m^{G_0W_0}/m_e=0.75$，$\\alpha^{G_0W_0}=0.35\\,\\text{eV}^{-1}$。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试案例对应一个三元组，顺序为：$[\\varepsilon_m,\\mathrm{RMS}_2,\\mathrm{RMS}_3]$。对于所有三个案例，将这些三元组汇总成一个列表的列表，例如\n$$\n[[\\varepsilon_{m,1},\\mathrm{RMS}_{2,1},\\mathrm{RMS}_{3,1}],[\\varepsilon_{m,2},\\mathrm{RMS}_{2,2},\\mathrm{RMS}_{3,2}],[\\varepsilon_{m,3},\\mathrm{RMS}_{2,3},\\mathrm{RMS}_{3,3}]].\n$$\n每个 $\\varepsilon_m$ 必须是无量纲小数，每个 $\\mathrm{RMS}_n$ 的单位必须是电子伏特（eV）。", "solution": "用户提供了一个有效的计算材料科学问题。任务是为一个模型能带结构实现剪刀修正，然后与更高级别的理论（$G_0W_0$）基准进行比较，量化该修正引入的残余误差。该问题具有科学依据，定义明确，并包含得出唯一解所需的所有信息。\n\n求解过程包括以下步骤：\n1.  **模型实现**：首先，我们实现所提供的 Kane 型非抛物线色散模型。\n2.  **能带结构计算**：对于每个测试案例，我们使用密度泛函理论（DFT）和 $G_0W_0$ 两套参数集计算三个导带（$n \\in \\{1, 2, 3\\}$）的能带结构。\n3.  **剪刀修正**：我们计算剪刀修正量 $\\Delta^{\\text{sc}}$，并将其刚性地应用于 DFT 导带。\n4.  **误差量化**：我们计算所要求的误差指标：第一导带的有效质量分数误差（$\\varepsilon_m$），以及第二和第三导带的均方根（RMS）能量误差。\n\n### 步骤1：色散模型\n第 $n$ 个能带的总能量由 $E_n(k) = E_{0,n} + E_{d,n}(k)$ 给出，其中 $k$ 是波矢大小，$E_{0,n}$ 是 $\\Gamma$ 点（$k=0$）的带边能量，$E_{d,n}(k)$ 是能量的色散部分。带边能量为 $E_{0,n} = E_g + \\Delta_n$，其中 $E_g$ 是基本带隙，$\\Delta_n$ 是分裂能（$\\Delta_1$ 隐式为 $0$）。\n\n色散部分 $E_{d,n}(k)$ 由 Kane 型关系定义：\n$$\nE_{d,n}(k)\\bigl(1+\\alpha_n E_{d,n}(k)\\bigr) = A_n k^2\n$$\n这是一个关于 $E_{d,n}(k)$ 的二次方程：\n$$\n\\alpha_n E_{d,n}(k)^2 + E_{d,n}(k) - A_n k^2 = 0\n$$\n假设 $\\alpha_n  0$，通过取二次公式的正根，可以得到物理上有意义的解（即能量从 $E_{d,n}(0)=0$ 开始增加）：\n$$\nE_{d,n}(k) = \\frac{-1 + \\sqrt{1 + 4\\alpha_n A_n k^2}}{2\\alpha_n}\n$$\n参数 $A_n$ 与能带有效质量 $m_n$ 的关系为：\n$$\nA_n = \\frac{\\hbar^2}{2 m_n} \\times 10^{20}\n$$\n其中因子 $10^{20}$ 确保了当 $\\hbar$ 单位为 $\\text{eV}\\cdot \\text{s}$，$m_n$ 单位为 $\\text{kg}$，$k$ 单位为 $\\text{\\AA}^{-1}$ 时，$A_n$ 的单位是 $\\text{eV}\\cdot\\text{\\AA}^2$。虽然从基本物理学角度来看，这个关于 $\\hbar$ 单位的公式是非标准的，但在问题的定义范围内，它内部是一致的，因为从曲率提取有效质量的公式使用了相同的常数。将实现一个函数，用于在给定的 k 点网格上，根据一组给定的参数（$E_g$, $\\Delta_n$, $m_n$, $\\alpha_n$）计算 $E_n(k)$。\n\n### 步骤2：K 点网格和参数设置\n对于每个测试案例，都会为沿 $\\Gamma-X$ 路径的波矢 $k$ 生成一个均匀的 $N_k$ 点网格，范围从 $k=0$ 到 $k=\\pi/a$。步长为 $h = \\frac{\\pi/a}{N_k-1}$。我们将使用提供的物理常数 $\\hbar = 6.582119569\\times 10^{-16}\\,\\text{eV}\\cdot \\text{s}$ 和 $m_e = 9.10938356\\times 10^{-31}\\,\\text{kg}$。给定的有效质量参数为比值 $m_n/m_e$，将转换为千克。\n\n### 步骤3：剪刀修正\n剪刀修正是在 DFT 水平上计算的所有导带的刚性向上平移。平移量 $\\Delta^{\\text{sc}}$ 是 $G_0W_0$ 和 DFT 在 $\\Gamma$ 点的基本带隙之差：\n$$\n\\Delta^{\\text{sc}} = E_g^{G_0W_0} - E_g^{\\text{DFT}}\n$$\n经过剪刀修正后的能量为：\n$$\nE^{\\text{sc}}_n(k) = E^{\\text{DFT}}_n(k) + \\Delta^{\\text{sc}}\n$$\n对每个导带 $n$ 都适用。\n\n### 步骤4：误差分析\n任务的核心是量化源于剪刀修正近似的两种误差。\n\n**a) 有效质量误差：**\n剪刀修正是一个恒定的能量平移，因此保留了能带的形状（以及曲率）。因此，剪刀修正后能带的有效质量 $m^*_{\\text{sc}}$ 将与 DFT 的有效质量 $m^{\\text{DFT}}_1$ 相同。分析将此值与目标 $G_0W_0$ 有效质量 $m^*_{G_0W_0}$ 进行比较。我们将通过使用三点前向有限差分公式计算在 $k=0$ 处的曲率来数值验证这一点：\n$$\n\\left.\\frac{d^2E}{dk^2}\\right|_{k=0} \\approx \\frac{E(2h) - 2E(h) + E(0)}{h^2}\n$$\n然后使用给定的关系恢复有效质量 $m^*$：\n$$\nm^* = \\frac{\\hbar^2 \\times 10^{20}}{\\left.\\frac{d^2E}{dk^2}\\right|_{k=0}}\n$$\n我们从 $E^{\\text{sc}}_1(k)$ 能带计算 $m^*_{\\text{sc}}$，从 $E^{G_0W_0}_1(k)$ 能带计算 $m^*_{G_0W_0}$。分数误差则为：\n$$\n\\varepsilon_m = \\frac{m^*_{\\text{sc}} - m^*_{G_0W_0}}{m^*_{G_0W_0}}\n$$\n\n**b) 高阶能带的 RMS 能量误差：**\n对于更高阶的导带（$n=2, 3$），剪刀修正通常不太准确，因为它没有考虑 DFT 和 $G_0W_0$ 理论水平之间能带分裂（$\\Delta_n$）或能带形状（由 $m_n$ 和 $\\alpha_n$ 决定）的变化。我们通过计算整个 $\\Gamma-X$ 路径上的均方根（RMS）误差来量化这种差异：\n$$\n\\mathrm{RMS}_n = \\sqrt{\\frac{1}{N_k}\\sum_{i=0}^{N_k-1}\\left(E^{\\text{sc}}_n(k_i)-E^{G_0W_0}_n(k_i)\\right)^2}\n$$\n将为每个测试案例的能带 $n=2$ 和 $n=3$ 执行此计算。\n\n整个过程被封装在一个 Python 脚本中，该脚本会遍历三个给定的测试案例，并为每个案例计算结果三元组 $(\\varepsilon_m, \\mathrm{RMS}_2, \\mathrm{RMS}_3)$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the band structure problem for all test cases.\n    \"\"\"\n\n    # Physical constants\n    HBAR = 6.582119569e-16  # eV*s\n    M_E = 9.10938356e-31    # kg\n    HBAR_SQ_FACTOR = HBAR**2 * 1e20\n\n    # Test suite: a list of tuples, each containing parameters for one case.\n    # Format: (a, Nk, dft_params, gw_params)\n    # _params are dicts: {'Eg': ..., 'bands': {1: {'m_ratio':.., 'alpha':.., 'Delta':..}, ...}}\n    test_cases = [\n        # Case 1 (typical)\n        (\n            5.65, 101,  # a, Nk\n            {\n                \"Eg\": 0.90,\n                \"bands\": {\n                    1: {\"m_ratio\": 0.25, \"alpha\": 0.8, \"Delta\": 0.0},\n                    2: {\"m_ratio\": 0.60, \"alpha\": 0.3, \"Delta\": 1.00},\n                    3: {\"m_ratio\": 1.20, \"alpha\": 0.2, \"Delta\": 2.00},\n                }\n            },\n            {\n                \"Eg\": 1.20,\n                \"bands\": {\n                    1: {\"m_ratio\": 0.20, \"alpha\": 1.0, \"Delta\": 0.0},\n                    2: {\"m_ratio\": 0.50, \"alpha\": 0.4, \"Delta\": 0.90},\n                    3: {\"m_ratio\": 1.00, \"alpha\": 0.25, \"Delta\": 1.80},\n                }\n            }\n        ),\n        # Case 2 (boundary, zero scissor)\n        (\n            3.57, 101,  # a, Nk\n            {\n                \"Eg\": 1.50,\n                \"bands\": {\n                    1: {\"m_ratio\": 0.35, \"alpha\": 0.9, \"Delta\": 0.0},\n                    2: {\"m_ratio\": 0.55, \"alpha\": 0.4, \"Delta\": 0.80},\n                    3: {\"m_ratio\": 0.90, \"alpha\": 0.3, \"Delta\": 1.50},\n                }\n            },\n            {\n                \"Eg\": 1.50,\n                \"bands\": {\n                    1: {\"m_ratio\": 0.30, \"alpha\": 1.1, \"Delta\": 0.0},\n                    2: {\"m_ratio\": 0.45, \"alpha\": 0.5, \"Delta\": 0.75},\n                    3: {\"m_ratio\": 0.80, \"alpha\": 0.35, \"Delta\": 1.40},\n                }\n            }\n        ),\n        # Case 3 (negative scissor)\n        (\n            4.00, 101,  # a, Nk\n            {\n                \"Eg\": 1.80,\n                \"bands\": {\n                    1: {\"m_ratio\": 0.18, \"alpha\": 1.1, \"Delta\": 0.0},\n                    2: {\"m_ratio\": 0.40, \"alpha\": 0.5, \"Delta\": 1.20},\n                    3: {\"m_ratio\": 0.85, \"alpha\": 0.3, \"Delta\": 2.50},\n                }\n            },\n            {\n                \"Eg\": 1.50,\n                \"bands\": {\n                    1: {\"m_ratio\": 0.22, \"alpha\": 0.9, \"Delta\": 0.0},\n                    2: {\"m_ratio\": 0.45, \"alpha\": 0.45, \"Delta\": 1.10},\n                    3: {\"m_ratio\": 0.75, \"alpha\": 0.35, \"Delta\": 2.30},\n                }\n            }\n        ),\n    ]\n\n    all_results = []\n    for case_data in test_cases:\n        all_results.append(process_case(case_data, HBAR_SQ_FACTOR, M_E))\n\n    # Format the final output string as a list of lists.\n    list_of_lists_str = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    final_output = f\"[{','.join(list_of_lists_str)}]\"\n    print(final_output)\n\ndef compute_bands(k_mesh, params, hbar_sq_factor, m_e):\n    \"\"\"\n    Computes band energies for all bands in a parameter set.\n    \"\"\"\n    bands = {}\n    k2 = k_mesh**2\n    for n in [1, 2, 3]:\n        p = params['bands'][n]\n        m_kg = p['m_ratio'] * m_e\n        alpha = p['alpha']\n        E0 = params['Eg'] + p['Delta']\n        A = hbar_sq_factor / (2 * m_kg)\n\n        # Solve for the dispersive part of the energy\n        if alpha == 0:\n            E_d = A * k2\n        else:\n            # Quadratic formula: alpha*E_d^2 + E_d - A*k^2 = 0\n            # We take the positive root for energy increasing from k=0\n            sqrt_term = np.sqrt(1 + 4 * alpha * A * k2)\n            E_d = (-1 + sqrt_term) / (2 * alpha)\n\n        bands[n] = E0 + E_d\n    return bands\n\ndef process_case(case_data, hbar_sq_factor, m_e):\n    \"\"\"\n    Processes a single test case to compute the required error metrics.\n    \"\"\"\n    a, Nk, dft_params, gw_params = case_data\n\n    # 1. Setup k-mesh\n    k_max = np.pi / a\n    k_mesh = np.linspace(0, k_max, Nk, dtype=np.float64)\n    h = k_mesh[1] - k_mesh[0]\n\n    # 2. Compute DFT and G0W0 bands\n    dft_bands = compute_bands(k_mesh, dft_params, hbar_sq_factor, m_e)\n    gw_bands = compute_bands(k_mesh, gw_params, hbar_sq_factor, m_e)\n\n    # 3. Apply scissor correction\n    delta_sc = gw_params['Eg'] - dft_params['Eg']\n    sc_bands = {n: dft_bands[n] + delta_sc for n in dft_bands}\n\n    # 4. Compute fractional effective mass error for CB1\n    # Curvature of scissor-corrected band from 3-point finite difference formula\n    curv_sc = (sc_bands[1][2] - 2 * sc_bands[1][1] + sc_bands[1][0]) / h**2\n    m_star_sc = hbar_sq_factor / curv_sc\n\n    # Curvature of G0W0 band\n    curv_gw = (gw_bands[1][2] - 2 * gw_bands[1][1] + gw_bands[1][0]) / h**2\n    m_star_gw = hbar_sq_factor / curv_gw\n    \n    eps_m = (m_star_sc - m_star_gw) / m_star_gw\n\n    # 5. Compute RMS energy error for CB2 and CB3\n    rms_2 = np.sqrt(np.mean((sc_bands[2] - gw_bands[2])**2))\n    rms_3 = np.sqrt(np.mean((sc_bands[3] - gw_bands[3])**2))\n\n    return [eps_m, rms_2, rms_3]\n\nsolve()\n```", "id": "3433858"}]}