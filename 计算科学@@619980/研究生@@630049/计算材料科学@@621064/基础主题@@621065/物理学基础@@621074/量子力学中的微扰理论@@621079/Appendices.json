{"hands_on_practices": [{"introduction": "在材料科学中，晶体和分子的高度对称性常常导致电子能级的简并。当引入一个降低对称性的微扰（例如应变、电场或磁场）时，这些简并的能级会发生分裂。简并微扰理论为我们精确计算这种分裂提供了核心的理论工具。本练习 ([@problem_id:3474534]) 将通过一个高对称性分子晶体的紧束缚模型，让你亲手实践如何构建并求解简并子空间中的有效哈密顿量，从而预测能级分裂。通过将其结果与直接对角化得到的精确解进行比较，你将能更深刻地理解简并微扰理论的适用范围和精度。", "problem": "考虑一个用于模拟密度泛函理论 (DFT) 中单粒子 Kohn-Sham 算符的高度对称分子晶体的紧束缚代理模型。未扰哈密顿量是一个具有精确二重简并的厄米矩阵 $H_0 \\in \\mathbb{R}^{4 \\times 4}$，并引入一个降低对称性的微扰 $V \\in \\mathbb{R}^{4 \\times 4}$。总哈密顿量定义为 $H(\\lambda) = H_0 + \\lambda V$，其中 $\\lambda \\in \\mathbb{R}$ 是一个控制微扰强度的无量纲参数。所有能量均以电子伏特 (eV) 为单位。\n\n矩阵具体规定如下。未扰哈密顿量 $H_0$ 是一个对角矩阵：\n$$\nH_0 = \\mathrm{diag}(0.8,\\, 1.0,\\, 1.0,\\, 1.6)\\,,\n$$\n该矩阵在能量 $E_0 = 1.0\\,\\mathrm{eV}$ 处存在一个精确的二重简并，位于由索引 1 和 2（使用从零开始的索引）对应的标准基矢所张成的子空间中。微扰 $V$ 是一个厄米矩阵，它通过耦合简并态并使之与非简并态混合来降低对称性：\n$$\nV =\n\\begin{pmatrix}\n0  0.1  -0.1  0.02 \\\\\n0.1  0.05  0.2  0.05 \\\\\n-0.1  0.2  -0.05  0.07 \\\\\n0.02  0.05  0.07  0\n\\end{pmatrix}\\,.\n$$\n\n从定态薛定谔方程 $H(\\lambda)\\ket{\\psi} = E(\\lambda)\\ket{\\psi}$ 和量子力学关于厄米算符的基本假设出发，在 $H_0$ 的简并子空间内实现直至二阶的简并微扰理论，以预测先前简并能级的分裂，然后将其与基准“对称性适配DFT”结果进行比较，此处的基准结果取为通过直接对角化 $H(\\lambda)$ 得到的精确本征值分裂。\n\n您的程序必须对每个给定的 $\\lambda$ 执行以下任务：\n1. 识别 $H_0$ 在能量 $E_0 = 1.0\\,\\mathrm{eV}$ 处的二重简并子空间，并构造到该子空间上的投影算符 $P$ 以及互补投影算符 $Q = I - P$。\n2. 计算限制在简并子空间内的一阶有效哈密顿量 $H_{\\mathrm{eff}}^{(1)}(\\lambda) = \\lambda\\,PVP$，并求其本征值，以获得简并子空间内的一阶能量修正。\n3. 使用限制在互补子空间上的 $H_0$ 的预解式，计算有效哈密顿量在简并子空间内的二阶贡献：\n$$\nH_{\\mathrm{eff}}^{(2)}(\\lambda) = \\lambda^2\\,PVQ\\,(E_0 I_Q - QH_0Q)^{-1}\\,QVP\\,,\n$$\n并构成总有效哈密顿量 $H_{\\mathrm{eff}}(\\lambda) = H_{\\mathrm{eff}}^{(1)}(\\lambda) + H_{\\mathrm{eff}}^{(2)}(\\lambda)$。对角化 $H_{\\mathrm{eff}}(\\lambda)$ 以获得简并子空间内直至二阶的两个能量，并将这两个能量的绝对差定义为预测的分裂值 $\\Delta_{\\mathrm{PT}}(\\lambda)$。\n4. 通过直接对角化 $H(\\lambda)$ 来获得精确的基准分裂值 $\\Delta_{\\mathrm{exact}}(\\lambda)$，并选择其本征向量在简并子空间内（索引1和2上的分量平方模之和）具有最大总权重的两个本征值。将这两个选定本征值的绝对差定义为 $\\Delta_{\\mathrm{exact}}(\\lambda)$。\n5. 计算相对误差，结果为无量纲小数：\n$$\n\\varepsilon(\\lambda) =\n\\begin{cases}\n0.0  \\text{if } \\Delta_{\\mathrm{exact}}(\\lambda) = 0,\\\\\n\\left|\\Delta_{\\mathrm{PT}}(\\lambda) - \\Delta_{\\mathrm{exact}}(\\lambda)\\right| \\big/ \\Delta_{\\mathrm{exact}}(\\lambda)  \\text{otherwise.}\n\\end{cases}\n$$\n\n使用以下微扰强度测试集：\n$$\n\\lambda \\in \\{0.0,\\, 0.1,\\, 0.5,\\, 1.0\\}\\,.\n$$\n\n所有能量必须以 $\\mathrm{eV}$ 为单位处理，而最终报告的量是无量纲小数。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，其顺序与测试集值的顺序相同。例如：“[result\\_for\\_0.0,result\\_for\\_0.1,result\\_for\\_0.5,result\\_for\\_1.0]”。", "solution": "用户提供的问题已经过评估，并被确定为 **有效**。这是一个量子力学中提法恰当、有科学依据的问题，具体是定态简并微扰理论在紧束缚模型中的应用，这是计算材料科学中的一个常见任务。所有必需的数据和定义均已提供，问题没有矛盾或歧义。\n\n在此，给出一个完整的解决方案。\n\n### 1. 理论框架\n\n问题的核心是使用两种不同的方法——简并微扰理论和直接对角化——来计算简并能级在小微扰下的分裂。\n\n**a. 未扰系统与简并**\n未扰哈密顿量 $H_0$ 以对角矩阵形式给出：\n$$\nH_0 = \\mathrm{diag}(0.8,\\, 1.0,\\, 1.0,\\, 1.6)\n$$\n其本征值为对角元。在能量 $E_0 = 1.0 \\, \\mathrm{eV}$ 处存在一个二重简并，对应于基态 $\\ket{1}$ 和 $\\ket{2}$（使用从零开始的索引）。简并子空间 $D$ 由 $\\{\\ket{1}, \\ket{2}\\}$ 张成。互补子空间 $D_{\\perp}$ 由 $\\{\\ket{0}, \\ket{3}\\}$ 张成。\n\n我们将到简并子空间 $D$ 的投影算符定义为 $P$，到互补子空间 $D_{\\perp}$ 的投影算符定义为 $Q$。在标准基中，它们是：\n$$\nP = \\begin{pmatrix} 0  0  0  0 \\\\ 0  1  0  0 \\\\ 0  0  1  0 \\\\ 0  0  0  0 \\end{pmatrix}, \\quad Q = I - P = \\begin{pmatrix} 1  0  0  0 \\\\ 0  0  0  0 \\\\ 0  0  0  0 \\\\ 0  0  0  1 \\end{pmatrix}\n$$\n\n**b. 简并微扰理论**\n总哈密顿量为 $H(\\lambda) = H_0 + \\lambda V$。我们通过构造一个仅在简并子空间 $D$ 内作用的有效哈密顿量 $H_{\\mathrm{eff}}$，来寻求对简并能级 $E_0$ 的修正。问题要求计算到 $\\lambda$ 的二阶。$H_{\\mathrm{eff}}$ 的本征值将是能量修正 $\\Delta E$。\n\n有效哈密顿量由 $H_{\\mathrm{eff}}(\\lambda) = H_{\\mathrm{eff}}^{(1)}(\\lambda) + H_{\\mathrm{eff}}^{(2)}(\\lambda)$ 给出。\n\n**一阶贡献：**\n一阶项为 $H_{\\mathrm{eff}}^{(1)}(\\lambda) = \\lambda\\,PVP$。该算符在限制于简并子空间 $D$ 时，由一个 $2 \\times 2$ 矩阵 $W_1$ 表示，其矩阵元为 $(\\boldsymbol{W}_1)_{ij} = \\bra{i}V\\ket{j}$，其中 $i, j \\in \\{1, 2\\}$。\n$$\n\\boldsymbol{W}_1 = \\begin{pmatrix} V_{11}  V_{12} \\\\ V_{21}  V_{22} \\end{pmatrix} = \\begin{pmatrix} 0.05  0.2 \\\\ 0.2  -0.05 \\end{pmatrix}\n$$\n\n**二阶贡献：**\n二阶项为 $H_{\\mathrm{eff}}^{(2)}(\\lambda) = \\lambda^2\\,PVQ\\,(E_0 I_Q - QH_0Q)^{-1}\\,QVP$。该算符也作用在 $D$ 内。其 $2 \\times 2$ 矩阵表示 $\\boldsymbol{W}_2$ 可以通过对互补子空间 $D_{\\perp}$ 中的中间态 $\\ket{k}$ 求和来计算：\n$$\n(\\boldsymbol{W}_2)_{ij} = \\sum_{k \\in D_{\\perp}} \\frac{\\bra{i}V\\ket{k}\\bra{k}V\\ket{j}}{E_0 - E_k} \\quad \\text{for } i, j \\in D\n$$\n$D_{\\perp}$ 中的态是 $\\ket{0}$ 和 $\\ket{3}$，其未扰能量分别为 $E_0^{(0)} = 0.8 \\, \\mathrm{eV}$ 和 $E_3^{(0)} = 1.6 \\, \\mathrm{eV}$。\n$\\boldsymbol{W}_2$ 的分量是：\n$$\n(\\boldsymbol{W}_2)_{ij} = \\frac{V_{i0}V_{0j}}{E_0-E_0^{(0)}} + \\frac{V_{i3}V_{3j}}{E_0-E_3^{(0)}}\n$$\n对于 $i, j \\in \\{1, 2\\}$ 并使用 $E_0=1.0$，得到：\n$$\n(\\boldsymbol{W}_2)_{11} = \\frac{V_{10}^2}{1.0-0.8} + \\frac{V_{13}^2}{1.0-1.6} = \\frac{0.1^2}{0.2} + \\frac{0.05^2}{-0.6} \\approx 0.045833\n$$\n$$\n(\\boldsymbol{W}_2)_{12} = \\frac{V_{10}V_{02}}{0.2} + \\frac{V_{13}V_{32}}{-0.6} = \\frac{(0.1)(-0.1)}{0.2} + \\frac{(0.05)(0.07)}{-0.6} \\approx -0.055833\n$$\n$$\n(\\boldsymbol{W}_2)_{21} = (\\boldsymbol{W}_2)_{12} \\quad (\\text{因为 } V \\text{ 是厄米矩阵})\n$$\n$$\n(\\boldsymbol{W}_2)_{22} = \\frac{V_{20}^2}{0.2} + \\frac{V_{23}^2}{-0.6} = \\frac{(-0.1)^2}{0.2} + \\frac{0.07^2}{-0.6} \\approx 0.041833\n$$\n\n**总有效哈密顿量：**\n简并子空间 $D$ 上的总 $2 \\times 2$ 有效哈密顿矩阵是：\n$$\n\\boldsymbol{H}_{\\mathrm{eff,2\\times2}}(\\lambda) = \\lambda \\boldsymbol{W}_1 + \\lambda^2 \\boldsymbol{W}_2\n$$\n我们求出该矩阵的本征值 $\\Delta E_1(\\lambda)$ 和 $\\Delta E_2(\\lambda)$。预测的能级分裂则为：\n$$\n\\Delta_{\\mathrm{PT}}(\\lambda) = |\\Delta E_1(\\lambda) - \\Delta E_2(\\lambda)|\n$$\n\n**c. 直接对角化**\n基准分裂值通过对完整哈密顿量 $H(\\lambda) = H_0 + \\lambda V$ 进行直接数值对角化获得。这将产生四个本征值 $E_i(\\lambda)$ 和相应的本征向量 $\\ket{\\psi_i(\\lambda)}$。\n为了识别从原始简并能级演化而来的两个能量，我们计算每个本征向量 $\\ket{\\psi_i}$ 在原始简并子空间 $D$ 内的“权重”：\n$$\nw_i = |\\braket{1|\\psi_i}|^2 + |\\braket{2|\\psi_i}|^2 = |\\psi_{i,1}|^2 + |\\psi_{i,2}|^2\n$$\n其中 $\\psi_{i,j}$ 是本征向量 $\\ket{\\psi_i}$ 的第 $j$ 个分量。我们选择其本征向量具有两个最大权重的两个本征值。设这两个本征值为 $E_a(\\lambda)$ 和 $E_b(\\lambda)$。精确分裂值为：\n$$\n\\Delta_{\\mathrm{exact}}(\\lambda) = |E_a(\\lambda) - E_b(\\lambda)|\n$$\n\n**d. 相对误差**\n最后，微扰理论结果与精确结果之间的相对误差计算如下：\n$$\n\\varepsilon(\\lambda) = \\left|\\Delta_{\\mathrm{PT}}(\\lambda) - \\Delta_{\\mathrm{exact}}(\\lambda)\\right| \\big/ \\Delta_{\\mathrm{exact}}(\\lambda)\n$$\n其中包含 $\\Delta_{\\mathrm{exact}}(\\lambda) = 0$ 的特殊情况。\n\n### 2. 算法实现\n\n对于每个给定的 $\\lambda$ 值，Python 实现将遵循以下步骤：\n\n1.  **初始化**：使用 `numpy` 数组定义矩阵 $H_0$ 和 $V$。定义简并能量 $E_0$ 以及简并子空间（$P_{idx}$）和互补子空间（$Q_{idx}$）的索引。\n2.  **微扰理论计算**：\n    a. 使用 $V$ 的子块和如上推导的能量分母来构造 $2 \\times 2$ 矩阵 $\\boldsymbol{W}_1$ 和 $\\boldsymbol{W}_2$。\n    b. 构成 $2 \\times 2$ 有效哈密顿矩阵 $\\boldsymbol{H}_{\\mathrm{eff,2\\times2}}(\\lambda) = \\lambda \\boldsymbol{W}_1 + \\lambda^2 \\boldsymbol{W}_2$。\n    c. 使用 `numpy.linalg.eigh` 计算其本征值。分裂值 $\\Delta_{\\mathrm{PT}}(\\lambda)$ 是这些本征值的绝对差。\n3.  **直接对角化**：\n    a. 构造完整的 $4 \\times 4$ 哈密顿矩阵 $H(\\lambda) = H_0 + \\lambda V$。\n    b. 使用 `numpy.linalg.eigh` 计算其本征值和本征向量。\n    c. 对于每个本征向量，计算其在简并子空间中的权重。\n    d. 识别出具有最大权重的两个本征向量的索引。\n    e. 相应的本征值就是我们关注的。分裂值 $\\Delta_{\\mathrm{exact}}(\\lambda)$ 是它们的绝对差。\n4.  **误差计算**：根据给定公式计算相对误差 $\\varepsilon(\\lambda)$。\n5.  **迭代**：对 $\\lambda$ 测试集中的所有值重复上述步骤，并存储结果。\n6.  **输出**：将收集到的结果格式化为指定的字符串格式。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the degenerate perturbation theory problem for a given set of parameters.\n    \"\"\"\n    # Define the unperturbed Hamiltonian H_0 as a diagonal matrix.\n    # Eigenenergies are in eV.\n    H0 = np.diag([0.8, 1.0, 1.0, 1.6])\n\n    # Define the perturbation matrix V.\n    V = np.array([\n        [0.0,  0.1, -0.1,  0.02],\n        [0.1,  0.05,  0.2,  0.05],\n        [-0.1,  0.2, -0.05,  0.07],\n        [0.02, 0.05,  0.07,  0.0]\n    ])\n\n    # Parameters for the degenerate-subspace calculation.\n    E0 = 1.0  # Degenerate energy level in eV.\n    p_indices = [1, 2]  # Indices of the degenerate subspace (P-space).\n    q_indices = [0, 3]  # Indices of the complementary subspace (Q-space).\n\n    # Test suite for the perturbation strength lambda.\n    test_cases = [0.0, 0.1, 0.5, 1.0]\n\n    results = []\n    for lam in test_cases:\n        # --- Degenerate Perturbation Theory Calculation ---\n\n        # W1 is the 2x2 matrix of the perturbation V restricted to the P-space.\n        # This corresponds to the first-order correction.\n        W1 = V[np.ix_(p_indices, p_indices)]\n\n        # W2 is the 2x2 matrix for the second-order correction.\n        # It is calculated using the formula derived from perturbation theory.\n        \n        # V_PQ block connects P-space to Q-space.\n        V_PQ = V[np.ix_(p_indices, q_indices)] \n        # V_QP block connects Q-space to P-space.\n        V_QP = V[np.ix_(q_indices, p_indices)]\n\n        # Energy denominators for the states in the Q-space.\n        E_q = H0.diagonal()[q_indices]\n        energy_denominators = E0 - E_q\n        \n        # The resolvent matrix (diagonal in this basis).\n        # We must handle the case of zero denominators, though not expected here.\n        with np.errstate(divide='raise'):\n            resolvent_diag = 1.0 / energy_denominators\n        \n        # Calculate W2 = V_PQ @ Resolvent @ V_QP\n        W2 = V_PQ @ np.diag(resolvent_diag) @ V_QP\n\n        # Form the 2x2 effective Hamiltonian matrix up to second order.\n        H_eff_2x2 = lam * W1 + lam**2 * W2\n\n        # Eigenvalues of the effective Hamiltonian are the energy shifts.\n        energy_shifts_pt = np.linalg.eigvalsh(H_eff_2x2)\n\n        # The predicted splitting is the difference between these energy shifts.\n        delta_pt = np.abs(energy_shifts_pt[1] - energy_shifts_pt[0])\n\n        # --- Exact Diagonalization Calculation ---\n        \n        # Construct the full Hamiltonian H(lambda) = H0 + lambda * V.\n        H_lam = H0 + lam * V\n\n        # Diagonalize the full Hamiltonian. eigh is used for Hermitian matrices.\n        exact_energies, exact_evecs = np.linalg.eigh(H_lam)\n\n        # Identify the two states that evolved from the degenerate subspace.\n        # These are the states whose eigenvectors have the largest weight in the P-space.\n        weights = np.sum(np.abs(exact_evecs[p_indices, :])**2, axis=0)\n        \n        # Get the indices of the two largest weights.\n        top_two_indices = np.argsort(weights)[-2:]\n        \n        # Select the corresponding exact energies.\n        relevant_energies = exact_energies[top_two_indices]\n\n        # The exact splitting is the difference between these two energies.\n        delta_exact = np.abs(relevant_energies[1] - relevant_energies[0])\n\n        # --- Relative Error Calculation ---\n\n        if delta_exact == 0.0:\n            # If there is no splitting, the perturbation theory should also predict none.\n            # In this case, relative error is 0.\n            relative_error = 0.0\n        else:\n            relative_error = np.abs(delta_pt - delta_exact) / delta_exact\n            \n        results.append(relative_error)\n\n    # Format the final output as a comma-separated list in brackets.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```", "id": "3474534"}, {"introduction": "在理论和计算材料科学中，有效哈密顿量（如 $k \\cdot p$ 模型）是理解和预测材料物理性质的基石。微扰理论是构建这些模型的关键方法，它能够系统地将外部场（如应变）的影响纳入理论框架。本练习 ([@problem_id:3474565]) 要求你运用 $k \\cdot p$ 微扰理论，为一种受应变作用的二维狄拉克材料构建一阶和二阶有效哈密顿量。通过将微扰模型的结果与一个更完备的“代理”第一性原理计算结果进行比较，你将学会评估有效理论的适用范围，这是计算材料学家必备的一项核心技能。", "problem": "考虑一种二维晶体材料，该材料在高对称性波矢处表现出线性能带交叉（一个狄拉克点）。在交叉点附近，导带和价带可以通过 $k\\cdot p$ 方法构建的双能带有效哈密顿量来描述。设 $\\boldsymbol{k}=(k_x,k_y)$ 是相对于狄拉克点测量的晶体动量，并设均匀微应变张量为 $\\boldsymbol{\\varepsilon}=\\begin{pmatrix}\\varepsilon_{xx}  \\varepsilon_{xy} \\\\ \\varepsilon_{xy}  \\varepsilon_{yy}\\end{pmatrix}$。运用量子力学中的微扰理论，构建在 $\\boldsymbol{\\varepsilon}$ 中达到指定阶数的对称性允许项，并通过与第一性原理应变能带能量的替代模型进行比较，评估高阶项在何种情况下是必不可少的。\n\n基本原理：\n- 不含时薛定谔方程为 $H\\psi=E\\psi$。对于简并点附近的布洛赫电子，$k\\cdot p$ 方法断言，在晶体对称性的约束下，布洛赫哈密顿量可以围绕简并点对小 $\\boldsymbol{k}$ 进行类泰勒展开。其主导项产生一个在 $\\boldsymbol{k}$ 中线性的狄拉克型哈密顿量，其中泡利矩阵 $\\sigma_x,\\sigma_y,\\sigma_z$ 作用于双能带子空间。\n- 应变通过对称性允许的标量、矢量和类质量项与电子结构耦合。在 $\\boldsymbol{\\varepsilon}$ 的最低阶中，这些微扰可以重整化速度、产生与 $\\boldsymbol{k}$ 成正比的倾斜项、通过质量项打开带隙，并产生作为不依赖于 $\\boldsymbol{k}$ 的 $\\sigma_x$ 和 $\\sigma_y$ 项引入的赝规范场移动。\n\n应变的定义和不变量：\n- 定义迹 $t=\\mathrm{Tr}\\,\\boldsymbol{\\varepsilon}=\\varepsilon_{xx}+\\varepsilon_{yy}$。\n- 定义偏应变分量 $d=\\varepsilon_{xx}-\\varepsilon_{yy}$ 和剪切应变 $\\varepsilon_{xy}$。\n- 定义矢量 $\\boldsymbol{g}(\\boldsymbol{\\varepsilon})=(d,\\,-2\\varepsilon_{xy})$。\n- 定义二范数平方 $n=\\varepsilon_{xx}^2+\\varepsilon_{yy}^2+2\\varepsilon_{xy}^2$。\n\n待实现的有效哈密顿量：\n- 无应变的狄拉克哈密顿量为 $H_0(\\boldsymbol{k})=\\hbar v_0\\,(\\sigma_x k_x+\\sigma_y k_y)$，其中 $\\hbar v_0$ 被视为一个以电子伏特-埃（electronvolt–angstrom）为单位的常数前因子，这样当 $\\boldsymbol{k}$ 以埃的倒数（inverse angstroms）为单位时，能量的单位是电子伏特（electronvolts）。\n- 应变一阶有效哈密顿量 $H^{(1)}(\\boldsymbol{k},\\boldsymbol{\\varepsilon})$ 仅包含 $\\boldsymbol{\\varepsilon}$ 的线性项：\n  1) 具有各向同性和各向异性贡献的速度重整化：$\\hbar v_x^{(1)}=\\hbar v_0\\left(1+\\alpha_1 t+\\alpha_a d\\right)$，$\\hbar v_y^{(1)}=\\hbar v_0\\left(1+\\alpha_1 t-\\alpha_a d\\right)$。\n  2) 作为 $G_x=\\gamma_g\\,g_x$，$G_y=\\gamma_g\\,g_y$ 引入的赝规范场移动，通过 $\\sigma_x G_x+\\sigma_y G_y$ 耦合。\n  3) 通过 $\\sigma_z m^{(1)}$ 耦合的质量项 $m^{(1)}=\\beta_1 t$。\n  4) 通过单位矩阵 $\\sigma_0$ 耦合的标量形变势 $U^{(1)}=\\delta_1 t$。\n  5) 通过单位矩阵引入的、在 $\\boldsymbol{k}$ 中线性的倾斜项：$T^{(1)}(\\boldsymbol{k})=\\tau_1\\,(g_x k_x+g_y k_y)$。\n  由此产生的哈密顿量为\n  $$H^{(1)}=\\sigma_0\\,U^{(1)}+\\sigma_0\\,T^{(1)}+\\sigma_x\\left(\\hbar v_x^{(1)}k_x+G_x\\right)+\\sigma_y\\left(\\hbar v_y^{(1)}k_y+G_y\\right)+\\sigma_z m^{(1)}.$$\n- 应变二阶有效哈密顿量 $H^{(2)}(\\boldsymbol{k},\\boldsymbol{\\varepsilon})$ 通过包含应变的二次修正来扩展 $H^{(1)}$：\n  1) 具有二次各向同性修正的速度重整化：$\\hbar v_x^{(2)}=\\hbar v_0\\left(1+\\alpha_1 t+\\alpha_2 n+\\alpha_a d\\right)$，$\\hbar v_y^{(2)}=\\hbar v_0\\left(1+\\alpha_1 t+\\alpha_2 n-\\alpha_a d\\right)$。\n  2) 质量项 $m^{(2)}=\\beta_1 t+\\beta_2 t^2$。\n  3) 标量形变势 $U^{(2)}=\\delta_1 t+\\delta_2 t^2$。\n  4) 保持 $\\gamma_g$ 和 $\\tau_1$ 与一阶模型相同（没有新的二次赝规范场项）。\n  二阶哈密顿量为\n  $$H^{(2)}=\\sigma_0\\,U^{(2)}+\\sigma_0\\,T^{(1)}+\\sigma_x\\left(\\hbar v_x^{(2)}k_x+G_x\\right)+\\sigma_y\\left(\\hbar v_y^{(2)}k_y+G_y\\right)+\\sigma_z m^{(2)}.$$\n\n第一性原理应变导带的替代模型：\n- 为模拟第一性原理计算中发现的非线性行为，使用一个增强模型，该模型包括应变三阶速度修正、应变二次倾斜增强，以及对导带能量的一个弱的 $\\boldsymbol{k}$ 三次翘曲贡献。定义\n  $$\\hbar v_x^{\\mathrm{ref}}=\\hbar v_0\\left(1+\\alpha_1 t+\\alpha_2 n+\\alpha_3 t^3+\\alpha_a d\\right),\\quad \\hbar v_y^{\\mathrm{ref}}=\\hbar v_0\\left(1+\\alpha_1 t+\\alpha_2 n+\\alpha_3 t^3-\\alpha_a d\\right),$$\n  $$m^{\\mathrm{ref}}=\\beta_1 t+\\beta_2 t^2+\\beta_3 t\\,n,\\quad U^{\\mathrm{ref}}=\\delta_1 t+\\delta_2 t^2,$$\n  $$T^{\\mathrm{ref}}(\\boldsymbol{k})=(\\tau_1+\\tau_2 n)\\,(g_x k_x+g_y k_y),\\quad G_x=\\gamma_g g_x,\\quad G_y=\\gamma_g g_y.$$\n  构建\n  $$H^{\\mathrm{ref}}=\\sigma_0\\,U^{\\mathrm{ref}}+\\sigma_0\\,T^{\\mathrm{ref}}+\\sigma_x\\left(\\hbar v_x^{\\mathrm{ref}}k_x+G_x\\right)+\\sigma_y\\left(\\hbar v_y^{\\mathrm{ref}}k_y+G_y\\right)+\\sigma_z m^{\\mathrm{ref}}.$$\n  设导带能量为 $H^{\\mathrm{ref}}$ 的较大本征值 $E_+^{\\mathrm{ref}}(\\boldsymbol{k},\\boldsymbol{\\varepsilon})$，并增加一个翘曲位移\n  $$\\Delta E_{\\mathrm{warp}}=w\\,n\\,(k_x^3-3k_x k_y^2),$$\n  因此最终的替代导带能量为 $E_+^{\\mathrm{ref}}+\\Delta E_{\\mathrm{warp}}$。\n\n数值常数和单位：\n- 使用 $\\hbar v_0=6.5$ 电子伏特-埃 ($\\mathrm{eV\\cdot \\mathring{A}}$)，这样当 $k$ 的单位是埃的倒数 ($\\mathrm{\\mathring{A}^{-1}}$) 时，$\\hbar v_0 k$ 的单位是电子伏特。所有能量必须以电子伏特计算和报告。波矢必须以埃的倒数为单位。\n- 耦合常数：$\\alpha_1=1.0$, $\\alpha_2=100.0$, $\\alpha_3=800.0$, $\\alpha_a=3.0$, $\\gamma_g=0.15$ 电子伏特, $\\beta_1=0.25$ 电子伏特, $\\beta_2=4.0$ 电子伏特, $\\beta_3=8.0$ 电子伏特, $\\delta_1=0.05$ 电子伏特, $\\delta_2=1.0$ 电子伏特, $\\tau_1=1.5$ 电子伏特-埃, $\\tau_2=4.0$ 电子伏特-埃, $w=1.0$ 电子伏特-埃$^3$。\n- $\\boldsymbol{k}$ 的采样：限制在一维切线 $k_y=0$ 上，并在 $[-k_{\\max},k_{\\max}]$ 范围内均匀采样 $k_x$，其中 $k_{\\max}=0.1\\,\\mathrm{\\mathring{A}^{-1}}$。使用 $N=101$ 个等间距点。\n\n评估标准：\n- 对于给定的 $\\boldsymbol{\\varepsilon}$，定义一阶有效导带 $E_+^{(1)}$ 与替代模型 $E_+^{\\mathrm{ref}}$ 在采样 $\\boldsymbol{k}$ 上的最大绝对偏差为 $\\Delta_1=\\max_{\\boldsymbol{k}}|E_+^{(1)}-E_+^{\\mathrm{ref}}|$，类似地，定义二阶偏差为 $\\Delta_2=\\max_{\\boldsymbol{k}}|E_+^{(2)}-E_+^{\\mathrm{ref}}|$。\n- 设定容差 $\\Theta=0.01$ 电子伏特（即 $10$ 毫电子伏特），通过以下整数对每个测试用例的适用范围进行分类\n  $$C=\\begin{cases}\n  0,  \\Delta_1\\le \\Theta\\quad \\text{(一阶模型足够)},\\\\\n  1,  \\Delta_1>\\Theta\\ \\text{and}\\ \\Delta_2\\le \\Theta\\quad \\text{(二阶模型必要且足够)},\\\\\n  2,  \\Delta_2>\\Theta\\quad \\text{(即使二阶模型也不足)}.\n  \\end{cases}$$\n\n测试集：\n- 四个应变张量，每个都以 $\\begin{pmatrix}\\varepsilon_{xx}\\varepsilon_{xy}\\\\\\varepsilon_{xy}\\varepsilon_{yy}\\end{pmatrix}$ 顺序的列表的列表形式给出，应变分量为无量纲：\n  1) 小静水应变: $\\boldsymbol{\\varepsilon}_\\mathrm{H}=\\begin{pmatrix}0.0020.0\\\\0.00.002\\end{pmatrix}$。\n  2) 迹为零的剪切主导应变: $\\boldsymbol{\\varepsilon}_\\mathrm{S}=\\begin{pmatrix}0.010.005\\\\0.005-0.01\\end{pmatrix}$。\n  3) 较大双轴应变: $\\boldsymbol{\\varepsilon}_\\mathrm{B}=\\begin{pmatrix}0.020.0\\\\0.00.02\\end{pmatrix}$。\n  4) 零应变边界情况: $\\boldsymbol{\\varepsilon}_\\mathrm{Z}=\\begin{pmatrix}0.00.0\\\\0.00.0\\end{pmatrix}$。\n\n要求输出：\n- 您的程序必须按指定顺序为四个测试用例中的每一个计算 $C$，并生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，\"[0,1,2,0]\"）。输出为不带任何附加文本的整数。能量和容差必须以电子伏特处理，波矢以埃的倒数为单位。", "solution": "用户提供了一个有效的、适定的计算材料科学问题，该问题基于量子力学和微扰理论的原理。任务是针对一个更完整的应变二维狄拉克材料替代模型，评估一系列复杂度递增的有效哈密顿量的有效性。\n\n问题的核心是计算一个通用的 $2 \\times 2$ 矩阵哈密顿量的本征值。任何此类哈密顿量都可以在单位矩阵 $\\sigma_0$ 和三个泡利矩阵 $\\boldsymbol{\\sigma} = (\\sigma_x, \\sigma_y, \\sigma_z)$ 的基底下表示为：\n$$H = h_0\\sigma_0 + h_x\\sigma_x + h_y\\sigma_y + h_z\\sigma_z = \\begin{pmatrix} h_0 + h_z  h_x - ih_y \\\\ h_x + ih_y  h_0 - h_z \\end{pmatrix}$$\n该哈密顿量的本征值为 $E_\\pm(\\boldsymbol{k}, \\boldsymbol{\\varepsilon}) = h_0 \\pm \\sqrt{h_x^2 + h_y^2 + h_z^2}$。问题关注的是导带，它对应于较大的本征值 $E_+ = h_0 + \\sqrt{h_x^2 + h_y^2 + h_z^2}$。\n\n解决方案通过执行一个计算过程来进行，对于每个给定的应变张量 $\\boldsymbol{\\varepsilon}$，该过程执行以下步骤：\n\n1.  **计算应变导出的不变量**：从给定的应变张量 $\\boldsymbol{\\varepsilon}=\\begin{pmatrix}\\varepsilon_{xx}  \\varepsilon_{xy} \\\\ \\varepsilon_{xy}  \\varepsilon_{yy}\\end{pmatrix}$ 的分量，我们首先计算出现在哈密顿量中的必要标量和矢量。这些量是迹 $t=\\varepsilon_{xx}+\\varepsilon_{yy}$、偏应变分量 $d=\\varepsilon_{xx}-\\varepsilon_{yy}$、矢量 $\\boldsymbol{g}=(d, -2\\varepsilon_{xy})$（其分量为 $g_x=d$ 和 $g_y=-2\\varepsilon_{xy}$），以及二范数平方 $n=\\varepsilon_{xx}^2+\\varepsilon_{yy}^2+2\\varepsilon_{xy}^2$。这些量在晶格的对称性下是不变的，并构成了构建微扰项的基础。\n\n2.  **构建哈密顿量分量**：对于三个模型中的每一个——一阶模型 $H^{(1)}$、二阶模型 $H^{(2)}$ 和参考替代模型 $H^{\\text{ref}}$——我们构建系数 $h_0$、$h_x$、$h_y$ 和 $h_z$ 作为应变不变量和波矢 $\\boldsymbol{k}$ 的函数。问题指定了一个一维采样路径，其中 $k_y=0$ 且 $k_x$ 变化。\n\n    -   **一阶模型 ($H^{(1)}$)**：\n        $h_0 = U^{(1)} + T^{(1)}(\\boldsymbol{k}) = \\delta_1 t + \\tau_1(g_x k_x)$\n        $h_x = \\hbar v_x^{(1)}k_x + G_x = \\hbar v_0(1+\\alpha_1 t+\\alpha_a d)k_x + \\gamma_g g_x$\n        $h_y = \\hbar v_y^{(1)}k_y + G_y = \\gamma_g g_y$ (因为 $k_y=0$)\n        $h_z = m^{(1)} = \\beta_1 t$\n\n    -   **二阶模型 ($H^{(2)}$)**：该模型通过增加应变的二次项来扩展 $H^{(1)}$。\n        $h_0 = U^{(2)} + T^{(1)}(\\boldsymbol{k}) = (\\delta_1 t + \\delta_2 t^2) + \\tau_1(g_x k_x)$\n        $h_x = \\hbar v_x^{(2)}k_x + G_x = \\hbar v_0(1+\\alpha_1 t+\\alpha_2 n+\\alpha_a d)k_x + \\gamma_g g_x$\n        $h_y = \\gamma_g g_y$\n        $h_z = m^{(2)} = \\beta_1 t + \\beta_2 t^2$\n\n    -   **带翘曲的参考替代模型 ($H^{\\text{ref}}$)**：该模型包含更高阶的项以模拟更真实的能带结构。\n        $h_0^{\\text{ref}} = U^{\\text{ref}} + T^{\\text{ref}}(\\boldsymbol{k}) = (\\delta_1 t+\\delta_2 t^2) + (\\tau_1+\\tau_2 n)(g_x k_x)$\n        $h_x^{\\text{ref}} = \\hbar v_x^{\\text{ref}}k_x + G_x = \\hbar v_0(1+\\alpha_1 t+\\alpha_2 n+\\alpha_3 t^3+\\alpha_a d)k_x + \\gamma_g g_x$\n        $h_y^{\\text{ref}} = \\gamma_g g_y$\n        $h_z^{\\text{ref}} = m^{\\text{ref}} = \\beta_1 t+\\beta_2 t^2+\\beta_3 t n$\n        最终的替代能量还包括一个翘曲项：$E_{+, \\text{surrogate}} = E_+^{\\text{ref}} + \\Delta E_{\\text{warp}}$，其中 $\\Delta E_{\\text{warp}} = w\\,n\\,k_x^3$。\n\n3.  **计算能带**：波矢 $k_x$ 在区间 $[-0.1, 0.1]\\, \\mathrm{\\mathring{A}^{-1}}$ 内采样 $N=101$ 个点。对于每个模型，我们在每个采样点 $k_x$ 处计算导带能量 $E_+$，从而得到三个能带：$E_+^{(1)}(k_x)$、$E_+^{(2)}(k_x)$ 和 $E_{+, \\text{surrogate}}(k_x)$。\n\n4.  **评估偏差**：一阶和二阶模型的准确性通过与替代模型在采样 $k_x$ 点上的最大绝对偏差来量化。\n    $\\Delta_1 = \\max_{k_x} |E_+^{(1)}(k_x) - E_{+, \\text{surrogate}}(k_x)|$\n    $\\Delta_2 = \\max_{k_x} |E_+^{(2)}(k_x) - E_{+, \\text{surrogate}}(k_x)|$\n\n5.  **划分适用范围**：根据计算出的偏差和给定的容差 $\\Theta=0.01\\,\\mathrm{eV}$，我们根据整数值函数 $C$ 对给定应变下模型的适用性进行分类：\n    $$C=\\begin{cases}\n    0,  \\Delta_1\\le \\Theta\\quad \\text{(一阶模型足够)},\\\\\n    1,  \\Delta_1>\\Theta\\ \\text{and}\\ \\Delta_2\\le \\Theta\\quad \\text{(二阶模型必要且足够)},\\\\\n    2,  \\Delta_2>\\Theta\\quad \\text{(即使二阶模型也不足)}.\n    \\end{cases}$$\n\n对四个指定的应变张量中的每一个重复此过程，并将得到的分类整数收集起来形成最终输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It orchestrates the calculation of the classification integer C for each strain.\n    \"\"\"\n    \n    # Numerical constants and parameters\n    hbar_v0 = 6.5  # eV*A\n    alpha1 = 1.0\n    alpha2 = 100.0\n    alpha3 = 800.0\n    alpha_a = 3.0\n    gamma_g = 0.15  # eV\n    beta1 = 0.25   # eV\n    beta2 = 4.0    # eV\n    beta3 = 8.0    # eV\n    delta1 = 0.05   # eV\n    delta2 = 1.0    # eV\n    tau1 = 1.5     # eV*A\n    tau2 = 4.0     # eV*A\n    w = 1.0      # eV*A^3\n    \n    k_max = 0.1    # A^-1\n    N = 101\n    Theta = 0.01   # eV\n\n    # Test suite of strain tensors\n    test_cases = [\n        np.array([[0.002, 0.0], [0.0, 0.002]]),  # Small hydrostatic strain\n        np.array([[0.01, 0.005], [0.005, -0.01]]), # Shear-dominant strain\n        np.array([[0.02, 0.0], [0.0, 0.02]]),   # Larger biaxial strain\n        np.array([[0.0, 0.0], [0.0, 0.0]])      # Zero strain\n    ]\n\n    results = []\n    \n    # k-space sampling grid\n    k_x = np.linspace(-k_max, k_max, num=N)\n    k_y = 0.0\n\n    for eps_tensor in test_cases:\n        # 1. Calculate strain-derived quantities\n        exx = eps_tensor[0, 0]\n        exy = eps_tensor[0, 1]\n        eyy = eps_tensor[1, 1]\n\n        t = exx + eyy\n        d = exx - eyy\n        gx = d\n        gy = -2 * exy\n        n = exx**2 + eyy**2 + 2 * exy**2\n\n        # 2. Calculate conduction band energies for each model\n        \n        # Model 1: First-order in strain\n        vx1 = hbar_v0 * (1.0 + alpha1 * t + alpha_a * d)\n        Gx = gamma_g * gx\n        Gy = gamma_g * gy\n        m1 = beta1 * t\n        U1 = delta1 * t\n        T1_k = tau1 * (gx * k_x + gy * k_y)\n        \n        h0_1 = U1 + T1_k\n        hx_1 = vx1 * k_x + Gx\n        hy_1 = np.full_like(k_x, Gy)\n        hz_1 = np.full_like(k_x, m1)\n        E_plus_1 = h0_1 + np.sqrt(hx_1**2 + hy_1**2 + hz_1**2)\n\n        # Model 2: Second-order in strain\n        vx2 = hbar_v0 * (1.0 + alpha1 * t + alpha2 * n + alpha_a * d)\n        m2 = beta1 * t + beta2 * t**2\n        U2 = delta1 * t + delta2 * t**2\n        \n        h0_2 = U2 + T1_k  # NOTE: uses T1, not a higher-order T\n        hx_2 = vx2 * k_x + Gx\n        hy_2 = np.full_like(k_x, Gy)\n        hz_2 = np.full_like(k_x, m2)\n        E_plus_2 = h0_2 + np.sqrt(hx_2**2 + hy_2**2 + hz_2**2)\n\n        # Reference Surrogate Model\n        vx_ref = hbar_v0 * (1.0 + alpha1 * t + alpha2 * n + alpha3 * t**3 + alpha_a d)\n        m_ref = beta1 * t + beta2 * t**2 + beta3 * t * n\n        U_ref = delta1 * t + delta2 * t**2 # Same as U2\n        T_ref_k = (tau1 + tau2 * n) * (gx * k_x + gy * k_y)\n\n        h0_ref = U_ref + T_ref_k\n        hx_ref = vx_ref * k_x + Gx\n        hy_ref = np.full_like(k_x, Gy)\n        hz_ref = np.full_like(k_x, m_ref)\n        \n        E_plus_ref_no_warp = h0_ref + np.sqrt(hx_ref**2 + hy_ref**2 + hz_ref**2)\n        delta_E_warp = w * n * (k_x**3 - 3 * k_x * k_y**2)\n        E_plus_surrogate = E_plus_ref_no_warp + delta_E_warp\n        \n        # 3. Assess deviations\n        delta1 = np.max(np.abs(E_plus_1 - E_plus_surrogate))\n        delta2 = np.max(np.abs(E_plus_2 - E_plus_surrogate))\n        \n        # 4. Classify the regime\n        if delta1 = Theta:\n            C = 0\n        elif delta2 = Theta:\n            C = 1\n        else:\n            C = 2\n        \n        results.append(C)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3474565"}, {"introduction": "除了基于波函数的传统方法，格林函数方法为研究量子多体系统提供了另一种强大的途径，尤其在计算局域性质（如局域态密度）和输运性质时显示出巨大优势。戴森方程 (Dyson equation) 为格林函数方法提供了系统的微扰展开框架。在本练习 ([@problem_id:3474571]) 中，你将运用戴森级数，通过微扰方法计算表面吸附对材料表面局域态密度的影响。通过将微扰级数的结果与精确的递推格林函数计算结果进行对比，你将对微扰级数的收敛性以及自能 (self-energy) 这一核心概念获得直观而深刻的物理理解。", "problem": "考虑一个晶体薄片的沿表面法线方向的一维紧束缚表示，该薄片由 $N$ 个原子层组成，采用开放边界条件。每个原子层由一个具有在位能 $\\,\\epsilon\\,$ 的单轨道和相邻层之间的最近邻跃迁 $\\,t\\,$ 来建模。一个弱的表面微扰以附加在位能 $\\,v\\,$ 的形式存在，且仅施加于顶层表面层（层索引为 $\\,0\\,$）。在量子力学中的不含时微扰理论以及计算材料科学中使用的推迟格林函数形式体系的框架内进行研究。\n\n将推迟格林函数算符定义为 $\\,G(z)=(z-H)^{-1}\\,$，其中复能量 $\\,z=E+i\\eta\\,$ 且 $\\,\\eta0\\,$ 为一个小的正数。未微扰的哈密顿量 $\\,H_0\\,$ 对应于没有表面微扰的薄片，而微扰 $\\,V\\,$ 仅作用于表面层 $\\,0\\,$。重点关注表面局域格林函数元 $\\,G_{00}(E)\\,$ 以及在表面处的相关局域态密度，\n$$\\rho_0(E)=-\\frac{1}{\\pi}\\,\\mathrm{Im}\\,G_{00}(E).$$\n\n您的任务是：\n- 从微扰理论和格林函数的基本算符恒等式出发，为表面局域格林函数元 $\\,G_{00}(E)\\,$ 得到一个按表面势 $\\,v\\,$ 的幂次展开的系统级数。该级数由未微扰的预解式 $\\,G_0(z)=(z-H_0)^{-1}\\,$ 构建。将此级数在 $\\,M=0,1,2,3\\,$ 阶截断，以获得近似值 $\\,G^{(M)}_{00}(E)\\,$。\n- 使用适用于块三对角哈密顿量的递归格林函数方法，独立地计算有限薄片的精确 $\\,G_{00}(E)\\,$，并由此计算包含表面微扰的薄片的精确局域态密度 $\\,\\rho^{\\mathrm{exact}}_0(E)$。\n- 对于每个截断阶数 $\\,M\\in\\{0,1,2,3\\}\\,$，计算近似的局域态密度 $\\,\\rho^{(M)}_0(E)=-\\frac{1}{\\pi}\\,\\mathrm{Im}\\,G^{(M)}_{00}(E)\\,$，并将截断误差量化为相对误差\n$$\\delta^{(M)}=\\frac{\\left|\\rho^{(M)}_0(E)-\\rho^{\\mathrm{exact}}_0(E)\\right|}{\\max\\left(\\left|\\rho^{\\mathrm{exact}}_0(E)\\right|,\\varepsilon_{\\mathrm{ref}}\\right)},$$\n其中 $\\,\\varepsilon_{\\mathrm{ref}}\\,$ 是一个小的正参考值以避免除以零。取 $\\,\\varepsilon_{\\mathrm{ref}}=10^{-15}\\,$。所有能量 $\\,E,\\,\\epsilon,\\,t,\\,v,\\,\\eta\\,$ 的单位均为电子伏特 (eV)。最终误差 $\\,\\delta^{(M)}\\,$ 是无量纲的，并且必须以小数（而非百分比）报告。\n\n在单个程序中实现这两种计算：\n- 微扰级数的构建必须从薄片的未微扰预解式 $\\,G_0(z)\\,$ 开始。\n- 精确计算必须通过适用于具有开放边界的有限三对角链的逐层递归格林函数方法来执行，而不是通过直接的完全矩阵求逆。\n\n使用以下测试套件（每个元组为 $(N,t,\\epsilon,v,E,\\eta)$，能量单位为 eV）：\n1. $(200,\\,1.0,\\,0.0,\\,0.05,\\,0.0,\\,10^{-3})$ 一个具有弱微扰的代表性能带中情况。\n2. $(200,\\,1.0,\\,0.0,\\,0.0,\\,0.5,\\,10^{-4})$ 一个零微扰的一致性检验情况。\n3. $(200,\\,1.0,\\,0.0,\\,0.2,\\,1.95,\\,10^{-3})$ 一个靠近能带上边缘的能量，用以探究级数收敛的压力情况。\n4. $(10,\\,1.0,\\,0.2,\\,0.1,\\,0.2,\\,10^{-3})$ 一个具有非零基准在位能的短薄片。\n\n对于每个测试用例，计算 $\\,M=0,1,2,3\\,$ 的四个相对误差 $\\,\\delta^{(M)}\\,$。您的程序应生成单行输出，其中包含整个测试套件的所有结果，形式为用方括号括起来的逗号分隔列表，按测试用例排序，并在每个测试用例内按 $\\,M\\,$ 的递增顺序排列，即\n$$[\\delta^{(0)}_{\\text{case 1}},\\delta^{(1)}_{\\text{case 1}},\\delta^{(2)}_{\\text{case 1}},\\delta^{(3)}_{\\text{case 1}},\\ldots,\\delta^{(0)}_{\\text{case 4}},\\delta^{(1)}_{\\text{case 4}},\\delta^{(2)}_{\\text{case 4}},\\delta^{(3)}_{\\text{case 4}}].$$\n不允许有其他输出。不涉及角度。确保在使用指定的小 $\\,\\eta\\,$ 和 $\\,\\varepsilon_{\\mathrm{ref}}\\,$ 时数值的稳定性。最终的数值输出是浮点数，不带单位。", "solution": "该问题要求对一维紧束缚薄片的表面局域格林函数及其对应的局域态密度（LDOS）进行微扰展开和精确计算之间的比较。分析将在推迟格林函数和不含时微扰理论的框架内进行。\n\n首先，我们定义系统及其哈密顿量。该系统是一个由 $N$ 个格点（层）组成的具有开放边界条件的线性链。哈密顿量 $H$ 可以分为未微扰部分 $H_0$ 和微扰部分 $V$。\n未微扰的哈密顿量 $H_0$ 描述了具有均匀在位能 $\\epsilon$ 和最近邻跃迁 $t$ 的薄片。在格点基 $\\{|0\\rangle, |1\\rangle, \\ldots, |N-1\\rangle\\}$ 中，其矩阵元为：\n$$ (H_0)_{ij} = \\epsilon \\delta_{ij} + t (\\delta_{i,j+1} + \\delta_{i,j-1}) $$\n这是一个对称三对角矩阵。\n微扰 $V$ 是一个纯局域势 $v$，仅施加于表面层，即格点 $|0\\rangle$。因此，$V$ 只有一个非零矩阵元：\n$$ V_{ij} = v \\delta_{i0} \\delta_{j0} \\implies V = v |0\\rangle\\langle0| $$\n完整的哈密顿量是 $H = H_0 + V$。\n\n推迟格林函数算符定义为 $G(z) = (z-H)^{-1}$，其中 $z = E+i\\eta$ 是一个复能量，其虚部 $\\eta  0$ 是一个小的正数。未微扰格林函数是 $G_0(z) = (z-H_0)^{-1}$。表面局域格林函数是矩阵元 $G_{00}(z) = \\langle 0 | G(z) | 0 \\rangle$，表面局域态密度是 $\\rho_0(E) = -\\frac{1}{\\pi}\\mathrm{Im}[G_{00}(E+i\\eta)]$。\n\n**微扰展开**\n格林函数的微扰级数由戴森方程（一个基本的算符恒等式）导出：\n$$ G = G_0 + G_0 V G $$\n为了找到特定的矩阵元 $G_{00}$，我们将此方程投影到基态上：\n$$ G_{00} = \\langle 0 | G | 0 \\rangle = \\langle 0 | G_0 | 0 \\rangle + \\langle 0 | G_0 V G | 0 \\rangle $$\n$$ G_{00} = (G_0)_{00} + \\sum_{k,l} \\langle 0 | G_0 | k \\rangle \\langle k | V | l \\rangle \\langle l | G | 0 \\rangle $$\n代入 $V_{kl} = v \\delta_{k0} \\delta_{l0}$：\n$$ G_{00} = (G_0)_{00} + \\sum_{k,l} (G_0)_{0k} (v \\delta_{k0} \\delta_{l0}) G_{l0} $$\n$$ G_{00} = (G_0)_{00} + v (G_0)_{00} G_{00} $$\n这个代数方程可以精确求解 $G_{00}$：\n$$ G_{00}(1 - v(G_0)_{00}) = (G_0)_{00} \\implies G_{00} = \\frac{(G_0)_{00}}{1 - v(G_0)_{00}} $$\n假设微扰很弱，使得 $|v(G_0)_{00}|  1$，我们可以将分母展开为几何级数：\n$$ G_{00} = (G_0)_{00} \\sum_{n=0}^{\\infty} [v(G_0)_{00}]^n = \\sum_{n=0}^{\\infty} v^n ((G_0)_{00})^{n+1} $$\n问题要求将此级数在 $M$ 阶截断。第 $M$ 阶近似 $G_{00}^{(M)}$ 是求和到 $v^M$ 项：\n$$ G_{00}^{(M)} = \\sum_{n=0}^{M} v^n ((G_0)_{00})^{n+1} $$\n具体来说，对于 $M \\in \\{0, 1, 2, 3\\}$：\n- $G_{00}^{(0)} = (G_0)_{00}$\n- $G_{00}^{(1)} = (G_0)_{00} + v((G_0)_{00})^2$\n- $G_{00}^{(2)} = (G_0)_{00} + v((G_0)_{00})^2 + v^2((G_0)_{00})^3$\n- $G_{00}^{(3)} = (G_0)_{00} + v((G_0)_{00})^2 + v^2((G_0)_{00})^3 + v^3((G_0)_{00})^4$\n\n要使用此展开，我们首先需要计算未微扰的表面局域格林函数 $(G_0)_{00}$。\n\n**递归格林函数方法**\n问题要求使用一种逐层递归的方法来计算格林函数，该方法避免了对整个矩阵求逆。这是计算物理学中的一种标准技术。某个格点上的局域格林函数可以用该格点的能量和自能来表示，自能概括了与之耦合的系统其余部分的影响。\n\n整个系统的表面格林函数 $G_{00}$ 是针对格点 $0$ 的，该格点的在位能为 $\\epsilon+v$，并与链的其余部分（格点 $1, \\ldots, N-1$）耦合。其格林函数为：\n$$ G_{00}(z) = \\frac{1}{z - (\\epsilon+v) - \\Sigma(z)} $$\n这里，$\\Sigma(z)$ 是由于格点 $0$ 与格点 $1$ 耦合而在格点 $0$ 处的自能。它由 $\\Sigma(z) = t \\cdot g_{\\text{rest}} \\cdot t = t^2 g_{\\text{rest}}$ 给出，其中 $g_{\\text{rest}}$ 是由格点 $1, \\ldots, N-1$ 组成的孤立子系统的表面格林函数。该子系统是一个长度为 $N-1$ 的未微扰链。\n\n未微扰的表面格林函数 $(G_0)_{00}$ 的计算方式类似，但使用的是未微扰的在位能 $\\epsilon$：\n$$ (G_0)_{00}(z) = \\frac{1}{z - \\epsilon - \\Sigma(z)} $$\n两种计算都需要相同的自能 $\\Sigma(z)$。\n\n自能 $\\Sigma(z)$ 是通过求解长度为 $N-1$ 的剩余链的表面格林函数来计算的。这可以通过递归方式完成。设 $g_k(z)$ 为长度为 $k$ 的未微扰孤立链的表面格林函数。\n对于 $k=1$，链是一个单格点，所以 $g_1(z) = (z-\\epsilon)^{-1}$。\n对于长度为 $k$ 的链，其表面格点与一个长度为 $k-1$ 的子链耦合。表面格林函数遵循以下递推关系：\n$$ g_k(z) = \\frac{1}{z - \\epsilon - t^2 g_{k-1}(z)} $$\n这是一个连分式展开。为了求得 $\\Sigma(z) = t^2 g_{N-1}(z)$，我们从 $g_1(z)$ 开始，迭代此关系 $N-2$ 次。对于 $N=1$ 的特殊情况，没有剩余的链，所以 $\\Sigma(z)=0$。\n\n**计算算法**\n对于每个测试用例 $(N, t, \\epsilon, v, E, \\eta)$：\n1. 定义复能量 $z = E + i\\eta$。\n2. 计算自能 $\\Sigma(z)$。如果 $N=1$，则 $\\Sigma = 0$。如果 $N  1$，通过递推关系计算 $g_{N-1}(z)$：\n    a. 初始化 $g_{\\text{chain}} = (z-\\epsilon)^{-1}$（这是 $g_1$）。\n    b. 迭代 $N-2$ 次：$g_{\\text{chain}} = (z - \\epsilon - t^2 g_{\\text{chain}})^{-1}$。结果即为 $g_{N-1}$。\n    c. $\\Sigma = t^2 g_{\\text{chain}}$。\n3. 计算精确的表面局域格林函数 $G_{00} = (z - (\\epsilon+v) - \\Sigma)^{-1}$ 和相应的精确局域态密度 $\\rho^{\\mathrm{exact}}_0(E) = -\\frac{1}{\\pi}\\mathrm{Im}[G_{00}]$。\n4. 计算未微扰的表面局域格林函数 $(G_0)_{00} = (z - \\epsilon - \\Sigma)^{-1}$。\n5. 通过对级数项求和，生成 $M=0,1,2,3$ 的微扰级数近似 $G_{00}^{(M)}$。\n    - 对于 $M \\geq 1$，$G_{00}^{(M)} = G_{00}^{(M-1)} + v^M ((G_0)_{00})^{M+1}$。\n6. 对于每个 $M$，计算近似的局域态密度 $\\rho_0^{(M)}(E) = -\\frac{1}{\\pi}\\mathrm{Im}[G_{00}^{(M)}]$。\n7. 使用以下公式计算相对误差 $\\delta^{(M)}$：\n    $$ \\delta^{(M)} = \\frac{\\left|\\rho^{(M)}_0(E)-\\rho^{\\mathrm{exact}}_0(E)\\right|}{\\max\\left(\\left|\\rho^{\\mathrm{exact}}_0(E)\\right|,\\varepsilon_{\\mathrm{ref}}\\right)}, \\quad \\text{with } \\varepsilon_{\\mathrm{ref}} = 10^{-15} $$\n8. 收集当前测试用例的四个误差 $\\delta^{(0)}, \\delta^{(1)}, \\delta^{(2)}, \\delta^{(3)}$。\n处理完所有测试用例后，将收集到的误差按规定格式化为单行输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test cases.\n    It compares a perturbative expansion with an exact recursive Green's function\n    calculation for the surface local density of states (LDOS) of a 1D tight-binding chain.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each tuple is (N, t, epsilon, v, E, eta)\n    test_cases = [\n        (200, 1.0, 0.0, 0.05, 0.0, 1e-3),\n        (200, 1.0, 0.0, 0.0, 0.5, 1e-4),\n        (200, 1.0, 0.0, 0.2, 1.95, 1e-3),\n        (10, 1.0, 0.2, 0.1, 0.2, 1e-3),\n    ]\n\n    all_results = []\n    e_ref = 1e-15\n\n    for case in test_cases:\n        N, t, epsilon, v, E, eta = case\n        z = complex(E, eta)\n        t2 = t**2\n\n        # 1. Compute the self-energy Sigma from the rest of the chain (sites 1 to N-1)\n        # This subsystem is an unperturbed chain of length N-1.\n        self_energy = 0.0 + 0.0j\n        if N > 1:\n            # We need the surface Green's function of a chain of length (N-1).\n            # Start with a chain of length 1 (site N-1)\n            g_chain = 1.0 / (z - epsilon)\n            \n            # Recursively add N-2 more sites (N-2, N-3, ..., 1)\n            # This loop repeats (N-2) times.\n            for _ in range(N - 2):\n                g_chain = 1.0 / (z - epsilon - t2 * g_chain)\n            \n            # The final g_chain is the surface GF of the chain from 1..N-1\n            # The self-energy at site 0 is t^2 * g_chain\n            self_energy = t2 * g_chain\n\n        # 2. Compute exact Green's function for the full perturbed system\n        g00_exact = 1.0 / (z - (epsilon + v) - self_energy)\n        ldos_exact = -1.0 / np.pi * np.imag(g00_exact)\n\n        # 3. Compute unperturbed Green's function for the perturbative expansion\n        g00_unperturbed = 1.0 / (z - epsilon - self_energy)\n\n        # 4. Compute perturbative approximations and their errors\n        case_errors = []\n        \n        # The M-th order series is sum_{n=0 to M} v^n * (g00_unperturbed)^(n+1)\n        current_g_series = 0.0 + 0.0j\n        # This term will hold v^n * (g00_unperturbed)^(n+1)\n        term = g00_unperturbed \n\n        for M in range(4): # Loop for M = 0, 1, 2, 3\n            current_g_series += term\n            \n            ldos_M = -1.0 / np.pi * np.imag(current_g_series)\n            \n            # Calculate relative error\n            numerator = np.abs(ldos_M - ldos_exact)\n            denominator = np.maximum(np.abs(ldos_exact), e_ref)\n            error = numerator / denominator\n            case_errors.append(error)\n            \n            # Prepare the next term for the series\n            # The next term is v^(M+1) * g_0^(M+2)\n            # which is the current term (v^M * g_0^(M+1)) times v*g_0\n            term *= v * g00_unperturbed\n        \n        all_results.extend(case_errors)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "3474571"}]}