{"hands_on_practices": [{"introduction": "该实践将引导您探索约束等离子体与周围真空区域边界处的基本力平衡条件。通过推导总压力（即热压力与磁压力之和 $p + \\frac{B^2}{2\\mu_0}$）的连续性，您将具体理解如何通过外部磁场来约束具有特定压力的等离子体，这是磁约束聚变设计中的核心问题。[@problem_id:3721291]", "problem": "考虑一个处于静态理想磁流体动力学 (MHD) 平衡中的大环径比、轴对称环形等离子体，其最后闭合磁面由 $\\psi=\\psi_{a}$ 表示。在等离子体内部，静态理想 MHD 动量平衡成立，且压强是磁通函数 $p=p(\\psi)$。在等离子体外部，存在一个真空区域，其中磁场是无电流的，极向磁通 $\\psi$ 满足齐次 Grad–Shafranov 方程。假设边界 $\\psi=\\psi_{a}$ 是一个磁面，因此磁场与之相切，即在边界两侧都有 $\\boldsymbol{B}\\cdot\\boldsymbol{n}=0$，其中 $\\boldsymbol{n}$ 是指向外部的单位法向量。\n\n设边界上的等离子体压强为一个正常数 $p_{a}=p(\\psi_{a})$。边界等离子体一侧的磁场大小具有大环径比平衡典型的已知极向变化，\n$$\nB_{\\text{in}}(\\theta)=B_{0}\\bigl(1-\\epsilon\\cos\\theta\\bigr),\n$$\n其中 $0  \\epsilon \\ll 1$ 是一个小的逆环径比参数，$B_{0}0$ 是一个常数，$\\theta$ 是极向角。真空区域的流体压强为零，且不携带体电流。\n\n仅从静态理想 MHD 动量平衡、麦克斯韦方程组和麦克斯韦应力的定义出发，推导跨越边界的法向应力连续性条件，并使用 $\\boldsymbol{B}\\cdot\\boldsymbol{n}=0$ 来展示真空解如何实现边界上的逐点力平衡。然后，计算比值\n$$\nR(\\theta)\\equiv \\frac{B_{\\text{out}}(\\theta)}{B_{\\text{in}}(\\theta)},\n$$\n其中 $B_{\\text{out}}(\\theta)$ 是刚好在边界外侧的真空磁场的大小。您的最终答案必须是关于 $p_{a}$、$\\mu_{0}$、$B_{0}$、$\\epsilon$ 和 $\\theta$ 的 $R(\\theta)$ 的单一闭式解析表达式。无需进行数值计算。", "solution": "该问题是有效的，因为它在科学上基于理想磁流体动力学 (MHD)，是适定的，具有充分且一致的信息，并且是客观陈述的。因此，我们可以进行推导和求解。\n\n控制静态理想 MHD 平衡的基本方程是动量平衡方程，该方程指出压强梯度力与洛伦兹力相平衡：\n$$\n\\nabla p = \\boldsymbol{j} \\times \\boldsymbol{B}\n$$\n其中 $p$ 是等离子体压强，$\\boldsymbol{j}$ 是电流密度，$\\boldsymbol{B}$ 是磁场。在静态系统中，安培定律将电流密度与磁场联系起来：\n$$\n\\nabla \\times \\boldsymbol{B} = \\mu_{0}\\boldsymbol{j}\n$$\n其中 $\\mu_{0}$ 是自由空间的磁导率。我们可以将 $\\boldsymbol{j} = \\frac{1}{\\mu_{0}}\\nabla \\times \\boldsymbol{B}$ 代入动量平衡方程：\n$$\n\\nabla p = \\frac{1}{\\mu_{0}}(\\nabla \\times \\boldsymbol{B}) \\times \\boldsymbol{B}\n$$\n使用矢量恒等式 $(\\nabla \\times \\boldsymbol{A}) \\times \\boldsymbol{A} = (\\boldsymbol{A} \\cdot \\nabla)\\boldsymbol{A} - \\frac{1}{2}\\nabla(A^{2})$，其中 $A=|\\boldsymbol{A}|$，我们可以重写右侧：\n$$\n\\nabla p = \\frac{1}{\\mu_{0}}\\left( (\\boldsymbol{B} \\cdot \\nabla)\\boldsymbol{B} - \\nabla\\left(\\frac{B^{2}}{2}\\right) \\right)\n$$\n这个方程可以重新整理成散度形式。我们可以写成 $\\nabla p = \\nabla \\cdot (p\\boldsymbol{I})$，其中 $\\boldsymbol{I}$ 是单位张量。方程变为：\n$$\n\\nabla \\cdot (p\\boldsymbol{I}) - \\frac{1}{\\mu_{0}}\\left( (\\boldsymbol{B} \\cdot \\nabla)\\boldsymbol{B} - \\nabla\\left(\\frac{B^{2}}{2}\\right) \\right) = 0\n$$\n认识到项 $\\frac{1}{\\mu_{0}}\\left( (\\boldsymbol{B} \\cdot \\nabla)\\boldsymbol{B} - \\nabla\\left(\\frac{B^{2}}{2}\\right) \\right)$ 是磁应力张量 $-\\nabla \\cdot \\boldsymbol{\\sigma}_{M}$ 的散度，其中 $\\boldsymbol{\\sigma}_{M} = \\frac{1}{\\mu_{0}}\\left(\\frac{B^{2}}{2}\\boldsymbol{I} - \\boldsymbol{B}\\boldsymbol{B}\\right)$，动量方程可以表示为总应力张量 $\\boldsymbol{T}$ 的散度为零：\n$$\n\\nabla \\cdot \\boldsymbol{T} = 0\n$$\n其中 $\\boldsymbol{T}$ 是流体压强张量 $p\\boldsymbol{I}$ 和麦克斯韦应力张量 $\\boldsymbol{\\sigma}_{M}$ 的和（使用压强为正的物理学惯例）：\n$$\n\\boldsymbol{T} = \\left(p + \\frac{B^{2}}{2\\mu_{0}}\\right)\\boldsymbol{I} - \\frac{1}{\\mu_{0}}\\boldsymbol{B}\\boldsymbol{B}\n$$\n为了找到等离子体和真空之间边界上的条件，我们将 $\\nabla \\cdot \\boldsymbol{T} = 0$ 在一个跨越界面的无穷小“药丸盒”体积 $V$ 上积分。应用散度定理，我们得到：\n$$\n\\int_{V} (\\nabla \\cdot \\boldsymbol{T}) dV = \\oint_{S} (\\boldsymbol{T} \\cdot \\boldsymbol{n}) dS = 0\n$$\n其中 $S$ 是药丸盒的表面，$\\boldsymbol{n}$ 是从等离子体指向真空的向外法向量。当药丸盒的高度收缩到零时，侧面上的积分消失。顶面（真空侧，面积 $\\Delta A$）和底面（等离子体侧，面积 $\\Delta A$）上的积分仍然存在，从而得到跳跃条件：\n$$\n[[\\boldsymbol{T} \\cdot \\boldsymbol{n}]] = 0\n$$\n其中 $[[X]] \\equiv X_{\\text{out}} - X_{\\text{in}}$ 表示量 $X$ 跨越界面的跳跃。代入 $\\boldsymbol{T}$ 的表达式：\n$$\n\\left[\\left[\\left(p + \\frac{B^{2}}{2\\mu_{0}}\\right)\\boldsymbol{n} - \\frac{1}{\\mu_{0}}\\boldsymbol{B}(\\boldsymbol{B} \\cdot \\boldsymbol{n})\\right]\\right] = 0\n$$\n问题陈述边界是一个磁面，所以磁场处处与之相切。这意味着在界面两侧磁场的法向分量均为零：$\\boldsymbol{B}_{\\text{in}} \\cdot \\boldsymbol{n} = 0$ 且 $\\boldsymbol{B}_{\\text{out}} \\cdot \\boldsymbol{n} = 0$。因此，项 $\\frac{1}{\\mu_{0}}\\boldsymbol{B}(\\boldsymbol{B} \\cdot \\boldsymbol{n})$ 在两侧都为零。跳跃条件简化为：\n$$\n\\left[\\left[\\left(p + \\frac{B^{2}}{2\\mu_{0}}\\right)\\boldsymbol{n}\\right]\\right] = \\left( \\left(p_{\\text{out}} + \\frac{B_{\\text{out}}^{2}}{2\\mu_{0}}\\right) - \\left(p_{\\text{in}} + \\frac{B_{\\text{in}}^{2}}{2\\mu_{0}}\\right) \\right) \\boldsymbol{n} = 0\n$$\n由于 $\\boldsymbol{n}$ 是一个非零法向量，所以标量系数必须为零。这给出了跨越边界的法向应力连续性条件：\n$$\np_{\\text{out}} + \\frac{B_{\\text{out}}^{2}}{2\\mu_{0}} = p_{\\text{in}} + \\frac{B_{\\text{in}}^{2}}{2\\mu_{0}}\n$$\n这个方程表示了在等离子体-真空界面上的逐点力平衡。总压强，即热力学压强 $p$ 和磁压强 $B^{2}/(2\\mu_{0})$ 的和，必须跨越边界是连续的。\n\n现在，我们应用问题中给出的具体条件。边界等离子体一侧的压强为 $p_{\\text{in}} = p_{a}$。外部区域是真空，所以那里的压强是 $p_{\\text{out}} = 0$。边界内外表面的磁场大小分别为 $B_{\\text{in}}(\\theta)$ 和 $B_{\\text{out}}(\\theta)$。平衡方程变为：\n$$\n0 + \\frac{B_{\\text{out}}^{2}(\\theta)}{2\\mu_{0}} = p_{a} + \\frac{B_{\\text{in}}^{2}(\\theta)}{2\\mu_{0}}\n$$\n我们需要求出比值 $R(\\theta) \\equiv \\frac{B_{\\text{out}}(\\theta)}{B_{\\text{in}}(\\theta)}$。从压强平衡方程中，我们解出 $B_{\\text{out}}^{2}(\\theta)$：\n$$\nB_{\\text{out}}^{2}(\\theta) = 2\\mu_{0} p_{a} + B_{\\text{in}}^{2}(\\theta)\n$$\n现在，我们可以计算比值 $R(\\theta)$ 的平方：\n$$\nR^{2}(\\theta) = \\frac{B_{\\text{out}}^{2}(\\theta)}{B_{\\text{in}}^{2}(\\theta)} = \\frac{2\\mu_{0} p_{a} + B_{\\text{in}}^{2}(\\theta)}{B_{\\text{in}}^{2}(\\theta)} = 1 + \\frac{2\\mu_{0} p_{a}}{B_{\\text{in}}^{2}(\\theta)}\n$$\n由于磁场大小必须为正，我们取正平方根：\n$$\nR(\\theta) = \\sqrt{1 + \\frac{2\\mu_{0} p_{a}}{B_{\\text{in}}^{2}(\\theta)}}\n$$\n最后，我们代入边界等离子体一侧磁场的给定表达式 $B_{\\text{in}}(\\theta)=B_{0}(1-\\epsilon\\cos\\theta)$：\n$$\nR(\\theta) = \\sqrt{1 + \\frac{2\\mu_{0} p_{a}}{\\left[B_{0}(1-\\epsilon\\cos\\theta)\\right]^{2}}} = \\sqrt{1 + \\frac{2\\mu_{0} p_{a}}{B_{0}^{2}(1-\\epsilon\\cos\\theta)^{2}}}\n$$\n这就是比值 $R(\\theta)$ 的最终闭式解析表达式。", "answer": "$$\n\\boxed{\\sqrt{1 + \\frac{2\\mu_{0} p_{a}}{B_{0}^{2}(1-\\epsilon\\cos\\theta)^{2}}}}\n$$", "id": "3721291"}, {"introduction": "在了解了边界条件之后，我们将深入等离子体内部，研究一个决定磁流体动力学（MHD）稳定性的关键参数——安全因子 $q$。您将为简化的托卡马克几何（大环径比、圆形截面）推导安全因子剖面，并对比电流驱动和压力驱动两种不同平衡状态下的情况。这项实践将阐明等离子体内部的压力和电流分布如何塑造磁场位形及其稳定性特征。[@problem_id:3721307]", "problem": "考虑一个大环径比、轴对称的托卡马克，其大半径为 $R_{0}$，小半径为 $a$ 的圆形截面。假设理想磁流体动力学（MHD）平衡、轴对称，并且在等离子体柱 $0 \\leq r \\leq a$ 内，极向磁通函数 $\\psi$ 仅依赖于小半径坐标 $r$。设环向磁场由函数 $F(\\psi)$ 描述，定义为 $F(\\psi) = R B_{\\phi}$，并假设平衡族由下式指定：\n$$F^{2}(\\psi) = F_{0}^{2} - 2 \\lambda \\psi,$$\n其中 $F_{0}  0$ 是一个常数，$\\lambda  0$ 是一个给定参数，并且在整个等离子体中 $F^{2}(\\psi) \\geq 0$。考虑两种压强分布情况：\n1. 纯电流驱动平衡，其中 $p'(\\psi) = 0$。\n2. 压强驱动平衡，其中压强梯度为向外减小的常数 $p'(\\psi) = -\\alpha$，$\\alpha  0$ 是一个常数。\n\n从理想MHD力平衡方程 $\\nabla p = \\mathbf{J} \\times \\mathbf{B}$ 和安培定律 $\\mu_{0} \\mathbf{J} = \\nabla \\times \\mathbf{B}$（其中 $\\mu_{0}$ 是真空磁导率）出发，在大环径比近似 $R \\approx R_{0}$ 和圆形嵌套磁面假设下，推导出一维轴对称平衡的简化方程 $\\psi(r)$。在磁轴 $r=0$ 处施加正则性条件，并在 $r=a$ 处要求磁通有限。使用这些假设，计算两种情况下的安全因子分布 $q(\\psi)$。对于安全因子，使用大环径比的定义：\n$$q(r) \\approx \\frac{r B_{\\phi}}{R_{0} B_{\\theta}},$$\n其中在圆形磁面上，$B_{\\phi} = F(\\psi)/R$，$R \\approx R_{0}$，以及 $B_{\\theta} \\approx B_{p} \\approx \\frac{1}{R_{0}} \\frac{d\\psi}{dr}$。将两种情况下 $q(\\psi)$ 的最终结果表示为包含 $F_{0}$、$R_{0}$、$\\lambda$、$\\alpha$ 和 $\\psi$ 的闭合解析表达式。将最终答案以一个二元行矩阵 $\\big(q_{\\mathrm{current}}(\\psi),\\,q_{\\mathrm{pressure}}(\\psi)\\big)$ 的形式给出，并假设 $0 \\leq \\psi \\leq \\psi_{a}$ 且 $F^{2}(\\psi) \\geq 0$。无需取整，安全因子 $q$ 是无量纲的。", "solution": "该问题要求计算在一个大环径比、轴对称、圆形截面的托卡马克中，两种不同平衡位形下的安全因子分布 $q(\\psi)$。推导将从 Grad-Shafranov (GS) 方程开始，这是轴对称位形下理想MHD平衡的基本方程。\n\n### 步骤1：建立简化平衡方程\n\n理想MHD力平衡由 $\\nabla p = \\mathbf{J} \\times \\mathbf{B}$ 给出，其中 $p$ 是等离子体压强，$\\mathbf{J}$ 是电流密度，$\\mathbf{B}$ 是磁场。结合安培定律 $\\mu_{0} \\mathbf{J} = \\nabla \\times \\mathbf{B}$，可得到平衡条件 $\\nabla p = \\frac{1}{\\mu_{0}} (\\nabla \\times \\mathbf{B}) \\times \\mathbf{B}$。\n\n对于一个轴对称系统（以 $\\phi$ 为环向角），磁场可以表示为极向磁通函数 $\\psi(R, Z)$ 和环向场函数 $F(\\psi)$ 的形式：\n$$ \\mathbf{B} = \\frac{F(\\psi)}{R} \\hat{\\phi} + \\frac{1}{R} \\nabla \\psi \\times \\hat{\\phi} $$\n其中 $R$ 是大半径坐标。量 $\\psi$ 在磁通面上是常数。压强 $p$ 也是一个磁通函数，$p=p(\\psi)$。\n\n将此形式的 $\\mathbf{B}$ 代入平衡条件，得到 Grad-Shafranov 方程：\n$$ \\Delta^* \\psi = -\\mu_{0} R^{2} \\frac{dp}{d\\psi} - F \\frac{dF}{d\\psi} $$\n其中 $\\Delta^* = R \\frac{\\partial}{\\partial R}\\left( \\frac{1}{R} \\frac{\\partial}{\\partial R} \\right) + \\frac{\\partial^2}{\\partial Z^2}$ 是柱坐标系 $(R, \\phi, Z)$ 下的 Grad-Shafranov 算子。\n该方程也可以写成：\n$$ \\Delta^* \\psi = -\\mu_{0} R^{2} p'(\\psi) - \\frac{1}{2} \\frac{dF^{2}(\\psi)}{d\\psi} $$\n\n我们已知以下特定于问题的信息和近似：\n1.  **大环径比托卡马克**：等离子体内部任意位置的大半径 $R$ 都可以用磁轴处的常数大半径 $R_{0}$ 来近似，即 $R \\approx R_{0}$。\n2.  **圆形嵌套磁面**：极向磁通 $\\psi$ 仅是小半径 $r$ 的函数，即 $\\psi = \\psi(r)$。\n3.  **函数形式**：\n    - $F^{2}(\\psi) = F_{0}^{2} - 2 \\lambda \\psi$\n    - $p'(\\psi)$ 对两种情况有具体规定。\n\n在这些近似下，使用一个以磁轴为中心，满足 $R = R_{0} + r \\cos\\theta$ 和 $Z = r \\sin\\theta$ 的局域坐标系 $(r, \\theta)$。对于 $r \\ll R_{0}$，算子 $\\Delta^*$ 简化为极坐标中的标准拉普拉斯算子：\n$$ \\Delta^* \\psi \\approx \\frac{1}{r} \\frac{\\partial}{\\partial r}\\left( r \\frac{\\partial \\psi}{\\partial r} \\right) + \\frac{1}{r^{2}} \\frac{\\partial^2 \\psi}{\\partial \\theta^2} $$\n由于我们假设 $\\psi = \\psi(r)$，关于 $\\theta$ 的导数消失，算子变为：\n$$ \\Delta^* \\psi \\approx \\frac{1}{r} \\frac{d}{dr}\\left( r \\frac{d\\psi}{dr} \\right) $$\n从给定的 $F^{2}(\\psi)$ 形式，我们计算其导数：\n$$ \\frac{dF^{2}}{d\\psi} = \\frac{d}{d\\psi}(F_{0}^{2} - 2 \\lambda \\psi) = -2 \\lambda $$\n将这些表达式代入 Grad-Shafranov 方程并使用 $R \\approx R_{0}$：\n$$ \\frac{1}{r} \\frac{d}{dr}\\left( r \\frac{d\\psi}{dr} \\right) = -\\mu_{0} R_{0}^{2} p'(\\psi) - \\frac{1}{2} (-2 \\lambda) $$\n$$ \\frac{1}{r} \\frac{d}{dr}\\left( r \\frac{d\\psi}{dr} \\right) = -\\mu_{0} R_{0}^{2} p'(\\psi) + \\lambda $$\n这就是 $\\psi(r)$ 的一维轴对称简化平衡方程。\n\n### 步骤2：求解两种情况并计算安全因子\n\n对于大环径比和圆形磁面，安全因子 $q$ 定义为：\n$$ q(r) \\approx \\frac{r B_{\\phi}}{R_{0} B_{\\theta}} $$\n我们已知表达式 $B_{\\phi} = F(\\psi)/R \\approx F(\\psi)/R_{0}$ 和极向场 $B_{\\theta} \\approx B_{p} \\approx \\frac{1}{R_{0}} \\frac{d\\psi}{dr}$。将这些代入 $q$ 的公式：\n$$ q(r) \\approx \\frac{r (F(\\psi)/R_{0})}{R_{0} (\\frac{1}{R_{0}} \\frac{d\\psi}{dr})} = \\frac{r F(\\psi)}{R_{0} \\frac{d\\psi}{dr}} $$\n为了找到 $q(\\psi)$，我们首先需要通过求解每种情况下的简化平衡方程来确定 $\\frac{d\\psi}{dr}$。\n\n我们对简化方程关于 $r$ 进行积分：\n$$ \\int_{0}^{r} \\frac{d}{ds}\\left( s \\frac{d\\psi}{ds} \\right) ds = \\int_{0}^{r} s \\big( -\\mu_{0} R_{0}^{2} p'(\\psi(s)) + \\lambda \\big) ds $$\n$$ r \\frac{d\\psi}{dr} = \\int_{0}^{r} s \\big( -\\mu_{0} R_{0}^{2} p'(\\psi(s)) + \\lambda \\big) ds $$\n由于磁轴 ($r=0$) 处的正则性条件，积分常数为零。该条件要求极向场 $B_{\\theta}$ 为零，因此 $\\frac{d\\psi}{dr}(0)=0$。\n\n**情况1：电流驱动平衡，$p'(\\psi) = 0$。**\n\n简化方程变为：\n$$ \\frac{1}{r} \\frac{d}{dr}\\left( r \\frac{d\\psi}{dr} \\right) = \\lambda $$\n从 $0$ 到 $r$ 积分一次：\n$$ r \\frac{d\\psi}{dr} = \\int_{0}^{r} \\lambda s \\, ds = \\frac{\\lambda r^{2}}{2} $$\n解出 $\\frac{d\\psi}{dr}$：\n$$ \\frac{d\\psi}{dr} = \\frac{\\lambda r}{2} $$\n现在，我们将其代入安全因子的表达式：\n$$ q_{\\mathrm{current}}(r) = \\frac{r F(\\psi)}{R_{0} (\\frac{\\lambda r}{2})} = \\frac{2 F(\\psi)}{R_{0} \\lambda} $$\n由于 $F(\\psi) = \\sqrt{F_{0}^{2} - 2\\lambda\\psi}$，安全因子分布作为 $\\psi$ 的函数是：\n$$ q_{\\mathrm{current}}(\\psi) = \\frac{2 \\sqrt{F_{0}^{2} - 2 \\lambda \\psi}}{\\lambda R_{0}} $$\n\n**情况2：压强驱动平衡，$p'(\\psi) = -\\alpha$。**\n\n简化方程变为：\n$$ \\frac{1}{r} \\frac{d}{dr}\\left( r \\frac{d\\psi}{dr} \\right) = -\\mu_{0} R_{0}^{2} (-\\alpha) + \\lambda = \\mu_{0} R_{0}^{2} \\alpha + \\lambda $$\n右边是一个常数。我们定义 $C = \\lambda + \\mu_{0} R_{0}^{2} \\alpha$。\n$$ \\frac{1}{r} \\frac{d}{dr}\\left( r \\frac{d\\psi}{dr} \\right) = C $$\n这个方程的形式与情况1相同，只是用 $C$ 替换了 $\\lambda$。从 $0$ 到 $r$ 积分：\n$$ r \\frac{d\\psi}{dr} = \\int_{0}^{r} C s \\, ds = \\frac{C r^{2}}{2} $$\n解出 $\\frac{d\\psi}{dr}$：\n$$ \\frac{d\\psi}{dr} = \\frac{C r}{2} = \\frac{(\\lambda + \\mu_{0} R_{0}^{2} \\alpha) r}{2} $$\n将此代入安全因子的表达式：\n$$ q_{\\mathrm{pressure}}(r) = \\frac{r F(\\psi)}{R_{0} \\frac{(\\lambda + \\mu_{0} R_{0}^{2} \\alpha) r}{2}} = \\frac{2 F(\\psi)}{R_{0} (\\lambda + \\mu_{0} R_{0}^{2} \\alpha)} $$\n用 $\\psi$ 表示：\n$$ q_{\\mathrm{pressure}}(\\psi) = \\frac{2 \\sqrt{F_{0}^{2} - 2 \\lambda \\psi}}{R_{0} (\\lambda + \\mu_{0} R_{0}^{2} \\alpha)} $$\n\n### 步骤3：最终答案的构建\n\n最终答案要求一个包含 $q_{\\mathrm{current}}(\\psi)$ 和 $q_{\\mathrm{pressure}}(\\psi)$ 表达式的二元行矩阵。\n\n第一个元素是电流驱动情况（$p'(\\psi)=0$）：\n$$ q_{\\mathrm{current}}(\\psi) = \\frac{2 \\sqrt{F_{0}^{2} - 2 \\lambda \\psi}}{\\lambda R_{0}} $$\n第二个元素是压强驱动情况（$p'(\\psi)=-\\alpha$）：\n$$ q_{\\mathrm{pressure}}(\\psi) = \\frac{2 \\sqrt{F_{0}^{2} - 2 \\lambda \\psi}}{R_{0} (\\lambda + \\mu_{0} R_{0}^{2} \\alpha)} $$\n\n这两个表达式构成了最终答案。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{2 \\sqrt{F_{0}^{2} - 2 \\lambda \\psi}}{\\lambda R_{0}}  \\frac{2 \\sqrt{F_{0}^{2} - 2 \\lambda \\psi}}{R_{0} (\\lambda + \\mu_{0} R_{0}^{2} \\alpha)}\n\\end{pmatrix}\n}\n$$", "id": "3721307"}, {"introduction": "现代托卡马克装置通常采用包含“X点”的磁位形来形成偏滤器，以有效管理热量和粒子排出。这项高阶实践旨在探究这种复杂几何结构对等离子体边界附近安全因子的深刻影响。通过分析安全因子 $q$ 在趋近磁分界面时的行为，您将揭示其对数发散的特性，这是一个具有重要理论和实际意义的结果，直接关系到等离子体的稳定性和输运模拟。[@problem_id:3721299]", "problem": "考虑在环形几何中的一个轴对称磁流体动力学平衡，该平衡由静态理想磁流体动力学（MHD）力平衡方程 $ \\nabla p = \\mathbf{J} \\times \\mathbf{B} $ 和安培定律 $ \\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J} $ 控制。在以环向角 $ \\phi $ 为坐标的柱坐标系中，轴对称性意味着极向磁通函数 $ \\psi(r,z) $ 和环向场函数 $ F(\\psi) $ 将磁场组织成嵌套的磁通量面。令 $ \\mathbf{B} $ 分解为 $ \\mathbf{B} = \\mathbf{B}_p + \\mathbf{B}_\\phi $，其中 $ \\mathbf{B}_p $ 是极向分量，$ \\mathbf{B}_\\phi $ 是环向分量。Grad-Shafranov方程为 $ \\psi(r,z) $ 和 $ F(\\psi) $ 提供了平衡条件，但在本任务中不应直接使用其显式形式作为捷径。此处，X点定义为分界面上 $ \\psi(r,z) $ 的一个鞍点，在该点 $ \\nabla \\psi = \\mathbf{0} $ 且 $ \\psi $ 的Hessian矩阵有一个正特征值和一个负特征值。\n\n安全因子 $ q(\\psi) $ 定义为在 $ \\psi = \\text{constant} $ 磁通量面上，一条磁力线完成一次极向回路所对应的环向圈数。您的任务是：\n\n1. 仅从上述基本定律和轴对称分解出发，推导出一个关于 $ q(\\psi) $ 的数学显式表达式，该表达式为绕由 $ \\psi(r,z) = \\text{constant} $ 定义的闭合曲线 $ C_\\psi $ 的围道积分。推导必须与第一性原理一致，并使用磁场表示法来表达 $ q(\\psi) $，清楚地说明 $ \\mathbf{B}_p $、$ \\mathbf{B}_\\phi $、$ \\psi $ 和 $ F(\\psi) $ 如何进入结果。不要凭记忆假设或陈述最终公式；请进行推导。\n\n2. 在分界面上靠近X点的位置，当 $ \\psi = \\psi_{\\text{sep}} $ 时，假设极向磁通在与Hessian矩阵主轴对齐的标准正交笛卡尔坐标 $ (x,y) $ 中有一个局部二次展开：\n$$\n\\psi(x,y) \\approx \\psi_{\\text{sep}} + \\frac{1}{2}\\left(\\alpha x^2 - \\beta y^2\\right),\n$$\n其中 $ \\alpha  0 $ 且 $ \\beta  0 $。展示当 $ \\psi \\to \\psi_{\\text{sep}}^- $（从最后一个闭合磁通量面内部逼近）时，第1部分中获得的围道积分的行为，并用 $ \\alpha $、$ \\beta $ 以及在X点处计算的环向磁场 $ B_\\phi $ 来解析地确定 $ q(\\psi) $ 的主阶发散项。您的分析必须是渐近的，明确展示发散是由X点附近 $ \\psi $ 的局部几何形状引起的机制。\n\n3. 构建一个计算算法，用于评估在两种不同构型下逼近分界面时的 $ q(\\psi) $：\n   - 有X点：通过对上述局部二次模型使用相应的围道积分进行数值积分，评估 $ q(\\psi) $ 的主要近X点贡献。对 $ \\psi(x,y) = \\psi_0 $（其中 $ \\psi_0 = \\psi_{\\text{sep}} - \\delta $，$ \\delta  0 $ 且为小量）的等值线的双曲线分支进行参数化，并从由 $ \\delta $ 确定的下限截断值 $ x_{\\min} $ 积分到一个有限的匹配尺度 $ L_x $，该尺度代表局部二次模型的有效性终点。包括两个对称分支以获得总的近X点贡献。假设在此局部区域内 $ B_\\phi $ 近似恒定，等于其在X点处的值。该算法应返回根据此近X点贡献计算出的 $ q(\\psi_0) $ 值。\n   - 无X点：考虑一个具有正定Hessian矩阵的光滑边界的局部模型：\n     $$\n     \\psi(x,y) \\approx \\psi_{\\text{sep}} + \\frac{1}{2}\\left(\\alpha x^2 + \\beta y^2\\right),\n     $$\n     其中 $ \\alpha  0 $ 且 $ \\beta  0 $。对于等值线 $ \\psi(x,y) = \\psi_0 = \\psi_{\\text{sep}} - \\delta $，对椭圆进行参数化，并数值评估 $ q(\\psi_0) $ 的完整围道积分。证明在 $ \\delta \\to 0^+ $ 的极限下，该积分是有限的且与 $ \\delta $ 无关。\n\n在计算中使用以下建模假设：在近X点区域，取环向磁场为常数 $ B_\\phi = \\text{constant} $，等于其在X点处的值；在无X点情况的局部边界模型中的其他地方，也取 $ B_\\phi = \\text{constant} $ 在等值线上。您可以假设 $ F(\\psi) = R B_\\phi $，其中 $ R $ 变化缓慢，并在合理时用其局部值替换，但您必须在推导中明确说明此理由。\n\n您必须实现一个完整的、可运行的程序，该程序：\n- 为下面列出的每个测试用例计算 $ q(\\psi_0) $。\n- 生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表，例如 $ [q_1,q_2,\\dots] $。\n- 每个 $ q(\\psi_0) $ 必须报告为四舍五入到六位小数的浮点数。\n- 由于 $ q $ 是无量纲的，输出中不应包含任何物理单位。\n\n测试套件（所有常数在科学上都是合理的且自洽的）：\n- 有X点（鞍点）：\n  - 情况1：$ \\alpha = 3.0 $，$ \\beta = 2.0 $，$ B_\\phi = 2.5 \\, \\text{Tesla} $，$ \\delta = 10^{-3} $，$ L_x = 0.3 \\, \\text{meter} $。\n  - 情况2：$ \\alpha = 3.0 $，$ \\beta = 2.0 $，$ B_\\phi = 2.5 \\, \\text{Tesla} $，$ \\delta = 10^{-5} $，$ L_x = 0.3 \\, \\text{meter} $。\n  - 情况3：$ \\alpha = 3.0 $，$ \\beta = 2.0 $，$ B_\\phi = 2.5 \\, \\text{Tesla} $，$ \\delta = 10^{-7} $，$ L_x = 0.3 \\, \\text{meter} $。\n- 无X点（椭圆点）：\n  - 情况4：$ \\alpha = 3.0 $，$ \\beta = 2.0 $，$ B_\\phi = 2.5 \\, \\text{Tesla} $，$ \\delta = 10^{-3} $。\n  - 情况5：$ \\alpha = 0.8 $，$ \\beta = 5.0 $，$ B_\\phi = 2.5 \\, \\text{Tesla} $，$ \\delta = 10^{-3} $。\n\n算法要求：\n- 对于有X点的情况，参数化水平集 $ \\beta y^2 - \\alpha x^2 = 2\\delta $ 的双曲线分支，并沿两个分支上的 $ x \\in [x_{\\min}, L_x] $ 积分近X点贡献，其中 $ x_{\\min} = \\sqrt{2\\delta/\\alpha} $，\n  使用二次模型所蕴含的 $ y(x) $、$ \\mathrm{d}l $ 和 $ |\\nabla \\psi| $ 的局部表达式。\n- 对于椭圆点情况，使用 $ x(t) = a\\cos t $、$ y(t) = b\\sin t $、$ t \\in [0,2\\pi] $ 参数化椭圆 $ \\alpha x^2 + \\beta y^2 = 2\\delta $，其中 $ a = \\sqrt{2\\delta/\\alpha} $ 和 $ b = \\sqrt{2\\delta/\\beta} $，并评估完整的围道积分。\n- 如果参数化中出现任何角度，必须以弧度为单位。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表，顺序为 $ [q_1,q_2,q_3,q_4,q_5] $，对应于情况1到情况5。\n\n您的推导和算法必须首先呈现，然后是程序。最终的程序必须是完全自包含的，无需用户交互即可运行，并且只使用Python标准库和指定的科学库。", "solution": "该问题被评估为有效。它在磁流体动力学方面有科学依据，问题陈述清晰（适定）且信息充分，足以得到唯一解，并且表述客观。尽管在局部边界模型的设置上存在轻微的不一致，但所提供的算法要求是清晰、自洽的，足以继续进行一个明确定义的计算任务。我们将遵循明确的计算指令进行操作，并注明为协调问题陈述所做的假设。\n\n### 第1部分：安全因子 $q(\\psi)$ 的推导\n\n安全因子 $q$ 定义为一条磁力线每完成一次极向回路所环绕的环向圈数。磁力线是空间中的一条曲线 $\\mathbf{l}$，它处处与磁场矢量 $\\mathbf{B}$ 相切。在柱坐标系 $(r, \\phi, z)$ 中，路径元为 $d\\mathbf{l} = dr\\,\\hat{r} + r\\,d\\phi\\,\\hat{\\phi} + dz\\,\\hat{z}$。相切条件意味着 $d\\mathbf{l}$ 的分量与 $\\mathbf{B} = B_r\\,\\hat{r} + B_\\phi\\,\\hat{\\phi} + B_z\\,\\hat{z}$ 的分量成比例：\n$$\n\\frac{dr}{B_r} = \\frac{dz}{B_z} = \\frac{r\\,d\\phi}{B_\\phi}\n$$\n由此，我们可以用极向平面上的微分弧长 $dl_p = \\sqrt{dr^2 + dz^2}$ 和极向磁场的大小 $B_p = \\sqrt{B_r^2 + B_z^2}$ 来表示环向角的微分变化 $d\\phi$：\n$$\nd\\phi = \\frac{B_\\phi}{r} \\frac{dl_p}{B_p}\n$$\n将 $d\\phi$ 沿一条场线的一个完整极向回路上积分，得到总的环向角变化量 $\\Delta\\phi$。安全因子 $q$ 是这个总角度除以 $2\\pi$：\n$$\nq = \\frac{\\Delta\\phi}{2\\pi} = \\frac{1}{2\\pi} \\oint_{C_p} d\\phi = \\frac{1}{2\\pi} \\oint_{C_p} \\frac{B_\\phi}{r B_p} dl_p\n$$\n在轴对称平衡中，磁力线位于嵌套的磁通量面上，这些面是极向磁通函数 $\\psi(r,z)$ 的等值面。因此，积分路径 $C_p$ 是极向平面中一个 $\\psi$ 为常数的等值线，我们将其表示为 $C_\\psi$。\n\n磁场分量可以用 $\\psi$ 和第二个磁通函数 $F(\\psi)$ 来表示。\n根据无散条件 $\\nabla \\cdot \\mathbf{B} = 0$，对于轴对称场，极向场 $\\mathbf{B}_p$ 可以写成一个只有环向分量的矢势 $\\mathbf{A} = A_\\phi(r,z)\\hat{\\phi}$ 的旋度。通常将极向磁通函数 $\\psi$ 定义为 $\\psi = r A_\\phi$。于是，极向场由下式给出：\n$$\n\\mathbf{B}_p = \\nabla \\times (A_\\phi \\hat{\\phi}) = \\nabla \\times \\left(\\frac{\\psi}{r}\\hat{\\phi}\\right) = \\frac{1}{r} \\nabla\\psi \\times \\hat{\\phi}\n$$\n因此，极向场的大小为：\n$$\nB_p = |\\mathbf{B}_p| = \\left| \\frac{1}{r} \\nabla\\psi \\times \\hat{\\phi} \\right| = \\frac{1}{r} |\\nabla\\psi|\n$$\n理想MHD力平衡方程 $\\nabla p = \\mathbf{J} \\times \\mathbf{B}$ 意味着 $\\mathbf{B} \\cdot \\nabla p = 0$。由于根据构造 $\\mathbf{B}_p \\cdot \\nabla \\psi = 0$，因此 $p$ 必须仅是 $\\psi$ 的函数，即 $p=p(\\psi)$。力平衡和安培定律的进一步推论是 $\\mathbf{B} \\cdot \\nabla(rB_\\phi) = 0$，这表明量 $rB_\\phi$ 也是一个磁通函数。我们将此函数定义为 $F(\\psi) = r B_\\phi$。因此，环向场为 $B_\\phi = F(\\psi)/r$。请注意，问题陈述中使用符号 $R$ 表示大半径坐标，这在我们的柱坐标系中与 $r$ 相同。\n\n将 $B_p$ 和 $B_\\phi$ 的表达式代入 $q(\\psi)$ 的积分中：\n$$\nq(\\psi) = \\frac{1}{2\\pi} \\oint_{C_\\psi} \\frac{F(\\psi)/r}{r (|\\nabla\\psi|/r)} dl_p = \\frac{F(\\psi)}{2\\pi} \\oint_{C_\\psi} \\frac{1}{r |\\nabla\\psi|} dl_p\n$$\n这是从第一性原理推导出的安全因子的期望表达式。它表明 $q$ 依赖于磁通函数 $F(\\psi)$ 和 $\\psi$，以及通过沿极向等值线积分 $1/(r|\\nabla\\psi|)$ 体现的磁通量面几何。\n\n### 第2部分：$q(\\psi)$ 在X点附近的渐近行为\n\n在X点附近，由于 $\\nabla\\psi = \\mathbf{0}$，被积函数的分母趋于零，可能导致发散。我们使用X点 $(x,y)=(0,0)$ 附近的 $\\psi(x,y)$ 的局部二次模型来分析积分的行为：\n$$\n\\psi(x,y) \\approx \\psi_{\\text{sep}} + \\frac{1}{2}\\left(\\alpha x^2 - \\beta y^2\\right)\n$$\n我们考虑分界面内侧的一个磁通量面，$\\psi_0 = \\psi_{\\text{sep}} - \\delta$，其中 $\\delta  0$ 是一个小量。这给出了等值线方程：\n$$\n\\frac{1}{2}(\\alpha x^2 - \\beta y^2) = -\\delta \\quad \\implies \\quad \\beta y^2 - \\alpha x^2 = 2\\delta\n$$\n该方程描述了一个沿 $y$ 轴开口的双曲线。$q(\\psi)$ 的局部贡献主要来自靠近X点的等值线部分。在这个局部笛卡尔坐标系中，我们假设 $r \\approx R_X$（X点处的大半径）和 $B_\\phi \\approx B_{\\phi,X}$ 是常数。函数 $F(\\psi) = rB_\\phi$ 也近似为常数 $F_0 = R_X B_{\\phi,X}$。$q$ 的局部贡献变为：\n$$\n\\Delta q_X \\approx \\frac{F_0}{2\\pi} \\oint_{C_{\\text{local}}} \\frac{dl}{R_X |\\nabla\\psi|} = \\frac{B_{\\phi,X}}{2\\pi} \\oint_{C_{\\text{local}}} \\frac{dl}{|\\nabla\\psi|}\n$$\n在这些坐标中，$\\psi$ 的梯度是 $\\nabla\\psi = (\\alpha x, -\\beta y)$，因此其大小为 $|\\nabla\\psi| = \\sqrt{\\alpha^2 x^2 + \\beta^2 y^2}$。使用等值线方程来表示 $y^2$：\n$$\n|\\nabla\\psi| = \\sqrt{\\alpha^2 x^2 + \\beta^2 \\frac{\\alpha x^2 + 2\\delta}{\\beta}} = \\sqrt{(\\alpha^2 + \\alpha\\beta)x^2 + 2\\beta\\delta}\n$$\n极向弧长元是 $dl = \\sqrt{1+(dy/dx)^2}dx$。对 $y = \\sqrt{(\\alpha x^2 + 2\\delta)/\\beta}$ 求导得到 $dy/dx = \\alpha x / \\sqrt{\\beta(\\alpha x^2 + 2\\delta)}$。\n$$\ndl = \\sqrt{1 + \\frac{\\alpha^2 x^2}{\\beta(\\alpha x^2 + 2\\delta)}} dx = \\sqrt{\\frac{\\beta(\\alpha x^2+2\\delta)+\\alpha^2 x^2}{\\beta(\\alpha x^2+2\\delta)}} dx = \\frac{\\sqrt{(\\alpha^2+\\alpha\\beta)x^2+2\\beta\\delta}}{\\sqrt{\\beta(\\alpha x^2+2\\delta)}} dx\n$$\n被积函数 $\\frac{dl}{|\\nabla\\psi|}$ 惊人地简化为：\n$$\n\\frac{dl}{|\\nabla\\psi|} = \\frac{1}{\\sqrt{\\beta(\\alpha x^2 + 2\\delta)}} dx\n$$\n积分是在局部模型有效性范围内的等值线部分进行的，从某个截断值 $-L_x$ 到 $L_x$。来自两个对称分支的总贡献是：\n$$\n\\oint_{C_{\\text{local}}} \\frac{dl}{|\\nabla\\psi|} = 2 \\int_0^{L_x} \\frac{dx}{\\sqrt{\\beta(\\alpha x^2 + 2\\delta)}} = \\frac{2}{\\sqrt{\\alpha\\beta}} \\int_0^{L_x} \\frac{dx}{\\sqrt{x^2 + 2\\delta/\\alpha}}\n$$\n计算该积分得到：\n$$\n\\frac{2}{\\sqrt{\\alpha\\beta}} \\left[ \\ln\\left(x + \\sqrt{x^2 + \\frac{2\\delta}{\\alpha}}\\right) \\right]_0^{L_x} = \\frac{2}{\\sqrt{\\alpha\\beta}} \\left( \\ln\\left(L_x + \\sqrt{L_x^2+\\frac{2\\delta}{\\alpha}}\\right) - \\ln\\sqrt{\\frac{2\\delta}{\\alpha}} \\right)\n$$\n当 $\\delta \\to 0$ 时，该表达式由对数项主导：\n$$\n\\oint \\approx \\frac{2}{\\sqrt{\\alpha\\beta}} \\left( \\ln(2L_x) - \\frac{1}{2}\\ln\\left(\\frac{2\\delta}{\\alpha}\\right) \\right) = \\frac{2}{\\sqrt{\\alpha\\beta}} \\left( \\text{const} - \\frac{1}{2}\\ln\\delta \\right)\n$$\n因此，当接近分界面时，安全因子具有主阶对数发散：\n$$\n\\Delta q_X \\approx \\frac{B_{\\phi,X}}{2\\pi} \\left( \\frac{-\\ln\\delta}{\\sqrt{\\alpha\\beta}} + \\text{const} \\right) \\propto -\\ln\\delta\n$$\n\n### 第3部分：计算算法\n\n#### 有X点（鞍点）\n算法遵循明确的指令。对于 $\\psi_0 = \\psi_{\\text{sep}} - \\delta$，$q(\\psi_0)$ 的贡献是通过沿双曲线等值线 $\\beta y^2 - \\alpha x^2 = 2\\delta$ 积分来计算的。问题指定从下限截断值 $x_{\\min} = \\sqrt{2\\delta/\\alpha}$ 到匹配尺度 $L_x$ 在两个对称分支上进行积分。总积分是正分支上积分的两倍。\n$$\nq(\\psi_0, \\delta) = \\frac{B_\\phi}{2\\pi} \\times \\left(2 \\int_{x_{\\min}}^{L_x} \\frac{dl}{|\\nabla\\psi|}\\right) = \\frac{B_\\phi}{\\pi} \\int_{\\sqrt{2\\delta/\\alpha}}^{L_x} \\frac{dx}{\\sqrt{\\beta(\\alpha x^2 + 2\\delta)}}\n$$\n这个定积分可以使用标准的求积方法（如`scipy.integrate.quad`）进行数值计算。\n\n#### 无X点（椭圆点）\n对于没有X点的情况，局部模型为 $\\psi(x,y) \\approx \\psi_{\\text{sep}} + \\frac{1}{2}(\\alpha x^2 + \\beta y^2)$。等值线 $\\psi_0 = \\psi_{\\text{sep}} - \\delta$ 将是 $\\alpha x^2 + \\beta y^2 = -2\\delta$，这没有实数解。这似乎是问题描述中的一个符号错误。对于嵌套在边界 $\\psi_b$ 内的闭合磁通量面，一个物理上合理的模型应为 $\\psi(x,y) \\approx \\psi_b - \\frac{1}{2}(\\alpha x^2 + \\beta y^2)$，对于 $\\psi_0 = \\psi_b - \\delta$，这导致等值线为 $\\alpha x^2 + \\beta y^2 = 2\\delta$。我们假设预期的等值线是这个椭圆，因为它能导出一个有意义的结果，并允许进行问题所要求的证明。\n\n等值线是椭圆 $\\alpha x^2 + \\beta y^2 = 2\\delta$。我们将其参数化为 $x(t) = a\\cos t$，$y(t) = b\\sin t$，其中 $t \\in [0, 2\\pi]$，半轴为 $a=\\sqrt{2\\delta/\\alpha}$ 和 $b=\\sqrt{2\\delta/\\beta}$。\n和之前一样，我们使用局部公式 $q \\approx \\frac{B_\\phi}{2\\pi} \\oint \\frac{dl}{|\\nabla\\psi|}$ 来计算 $q(\\psi_0)$。\n对于 $\\psi \\approx \\psi_{\\text{const}} - \\frac{1}{2}(\\alpha x^2 + \\beta y^2)$，梯度为 $\\nabla\\psi = (-\\alpha x, -\\beta y)$。\n$|\\nabla\\psi| = \\sqrt{\\alpha^2 x^2 + \\beta^2 y^2} = \\sqrt{\\alpha^2 a^2 \\cos^2 t + \\beta^2 b^2 \\sin^2 t} = \\sqrt{2\\delta(\\alpha\\cos^2 t + \\beta\\sin^2 t)}$。\n弧长元为 $dl = \\sqrt{(x')^2 + (y')^2}dt = \\sqrt{a^2\\sin^2 t + b^2\\cos^2 t}dt = \\sqrt{\\frac{2\\delta}{\\alpha}\\sin^2 t + \\frac{2\\delta}{\\beta}\\cos^2 t}dt$。\n被积函数变为：\n$$\n\\frac{dl}{|\\nabla\\psi|} = \\frac{\\sqrt{\\frac{2\\delta}{\\alpha}\\sin^2 t + \\frac{2\\delta}{\\beta}\\cos^2 t}}{\\sqrt{2\\delta(\\alpha\\cos^2 t + \\beta\\sin^2 t)}} dt = \\frac{\\sqrt{2\\delta}\\sqrt{\\frac{\\beta\\sin^2 t + \\alpha\\cos^2 t}{\\alpha\\beta}}}{\\sqrt{2\\delta}\\sqrt{\\alpha\\cos^2 t + \\beta\\sin^2 t}} dt = \\frac{1}{\\sqrt{\\alpha\\beta}} dt\n$$\n被积函数是常数，与 $t$ 和 $\\delta$ 都无关。积分是平凡的：\n$$\n\\oint_{C_\\psi} \\frac{dl}{|\\nabla\\psi|} = \\int_0^{2\\pi} \\frac{1}{\\sqrt{\\alpha\\beta}} dt = \\frac{2\\pi}{\\sqrt{\\alpha\\beta}}\n$$\n将此结果代回 $q$ 的公式：\n$$\nq(\\psi_0) = \\frac{B_\\phi}{2\\pi} \\left( \\frac{2\\pi}{\\sqrt{\\alpha\\beta}} \\right) = \\frac{B_\\phi}{\\sqrt{\\alpha\\beta}}\n$$\n这表明对于椭圆边界，$q(\\psi_0)$ 是有限的，并且在这个局部模型中与 $\\delta$ 无关。因此，这些情况的计算是直接的解析评估。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Computes the safety factor q for several test cases, modeling its behavior\n    near an X-point (saddle) and a regular boundary (elliptic).\n    \"\"\"\n\n    # Test suite format: (case_type, alpha, beta, B_phi, delta, L_x)\n    # For elliptic cases, L_x is not used and can be None.\n    test_cases = [\n        # With X-point (saddle)\n        # Case 1\n        ('x-point', 3.0, 2.0, 2.5, 1e-3, 0.3),\n        # Case 2\n        ('x-point', 3.0, 2.0, 2.5, 1e-5, 0.3),\n        # Case 3\n        ('x-point', 3.0, 2.0, 2.5, 1e-7, 0.3),\n        # Without X-point (elliptic)\n        # Case 4\n        ('elliptic', 3.0, 2.0, 2.5, 1e-3, None),\n        # Case 5\n        ('elliptic', 0.8, 5.0, 2.5, 1e-3, None),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        case_type, alpha, beta, B_phi, delta, L_x = case\n        \n        if case_type == 'x-point':\n            # This case corresponds to a saddle point (X-point).\n            # The contour is a hyperbola: beta*y^2 - alpha*x^2 = 2*delta\n            # The formula for the near-X-point contribution to q is derived in the solution:\n            # q = (B_phi / pi) * integral from x_min to L_x of the integrand.\n            # The integration is over two symmetric branches, from x_min to L_x\n            # and from -L_x to -x_min. Due to symmetry, this is 2 * integral(x_min, L_x).\n            # q = (B_phi / 2pi) * (integral over two branches)\n            #   = (B_phi / 2pi) * 2 * integral(x_min, L_x)\n            #   = (B_phi / pi) * integral(x_min, L_x)\n            # This is correct.\n            \n            # The integrand is dl/|nabla_psi| = 1 / sqrt(beta * (alpha*x^2 + 2*delta))\n            integrand = lambda x: 1.0 / np.sqrt(beta * (alpha * x**2 + 2 * delta))\n            \n            # Lower integration limit as specified in the problem\n            x_min = np.sqrt(2 * delta / alpha)\n            \n            # Upper integration limit\n            x_max = L_x\n            \n            # Perform numerical integration using SciPy quad\n            integral_val, _ = integrate.quad(integrand, x_min, x_max)\n\n            # Calculate q\n            q_val = (B_phi / np.pi) * integral_val\n            \n            results.append(f\"{q_val:.6f}\")\n\n        elif case_type == 'elliptic':\n            # This case corresponds to a smooth, elliptic boundary.\n            # As derived in the solution, the integral for q simplifies to an\n            # analytical expression independent of delta.\n            # q = B_phi / sqrt(alpha * beta)\n            \n            q_val = B_phi / np.sqrt(alpha * beta)\n            \n            results.append(f\"{q_val:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3721299"}]}