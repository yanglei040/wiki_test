{"hands_on_practices": [{"introduction": "本练习从基本概念入手，旨在区分源于统计涨落的偶然不确定性（aleatoric uncertainty）和源于校准效应的认知不确定性（epistemic uncertainty），在粒子物理中我们通常称之为统计不确定性和系统不确定性。通过应用一阶误差传播，你将掌握一种估算各种不确定性来源对最终测量结果贡献的基础方法。这项技能是进行任何严谨实验分析的关键第一步。[@problem_id:3540032]", "problem": "在计算高能物理（HEP）中，一个过程的总截面 $\\sigma$ 通常根据观测到的事件数和探测器接受度来估计。考虑一次测量，其中观测到的信号事件数 $N$ 因计数统计而遵循泊松分布，探测效率 $\\epsilon$ 通过校准已知，但受到一个未知的微小分数校准偏移的影响。积分亮度 $L$ 是精确已知的。用于截面的点估计量是观测产额与曝光量之比，其中曝光量由积分亮度与名义效率的乘积给出。\n\n假设以下测量模型和输入：\n- 观测到的计数为 $N = 1692$。\n- 积分亮度为 $L = 140\\,\\mathrm{fb}^{-1}$。\n- 名义效率为 $\\epsilon_{0} = 0.60$。\n- 真实效率通过一个校准偏移与名义效率相关联：$\\epsilon = \\epsilon_{0}\\left(1 + \\delta\\right)$，其中校准讨厌参数 $\\delta$ 是一个均值为零、标准差为 $s_{\\delta} = 0.035$ 的高斯分布。计数 $N$ 与校准偏移 $\\delta$ 是独立的。\n\n使用一阶误差传播方法，从计数的泊松模型定义和不确定性传播的线性化出发，计算截面估计量 $\\hat{\\sigma}$ 的标准差的两个独立贡献，分别来自于：\n1. 泊松计数带来的偶然不确定性。\n2. 效率校准偏移带来的认知不确定性。\n\n将这两个贡献以飞靶（fb）为单位表示为数值，并各自四舍五入到三位有效数字。", "solution": "该问题是有效的，因为它呈现了一个在实验高能物理中常见的、自洽的、有科学依据且定义明确的场景。所有必要的数据均已提供，任务是应用一种标准的不确定性传播方法。\n\n真实截面 $\\sigma$ 与信号事件的真实平均数 $\\mu$、积分亮度 $L$以及真实探测效率 $\\epsilon$ 通过方程 $\\mu = \\sigma L \\epsilon$ 相关联。我们给定一个观测计数 $N$，它是平均值为 $\\mu$ 的泊松随机变量的单次实现。真实效率被建模为 $\\epsilon = \\epsilon_0(1+\\delta)$，其中 $\\epsilon_0$ 是名义效率，$\\delta$ 是一个代表未知校准偏移的讨厌参数。\n\n我们可以将截面表示为我们测量或拥有其概率信息的量（即 $N$ 和 $\\delta$）的函数。通过使用 $N$ 作为 $\\mu$ 的估计量，我们得到：\n$$ \\sigma(N, \\delta) = \\frac{N}{L \\epsilon} = \\frac{N}{L \\epsilon_0 (1 + \\delta)} $$\n截面的中心值 $\\hat{\\sigma}$ 是通过在观测值 $N=1692$ 和 $\\delta$ 的平均值 $\\langle\\delta\\rangle = 0$ 处对该函数求值得到的：\n$$ \\hat{\\sigma} = \\sigma(1692, 0) = \\frac{1692}{L \\epsilon_0} $$\n为了找到 $\\sigma$ 的不确定性，我们使用一阶误差传播。由于问题指出计数统计量 $N$ 和校准偏移 $\\delta$ 是独立的，总方差 $V[\\sigma]$ 可以近似为各项贡献之和：\n$$ V[\\sigma] \\approx \\left(\\frac{\\partial\\sigma}{\\partial N}\\right)^2 V[N] + \\left(\\frac{\\partial\\sigma}{\\partial \\delta}\\right)^2 V[\\delta] $$\n问题要求计算对标准差的各个独立贡献，我们将其表示为 $\\Delta\\sigma_N$ 和 $\\Delta\\sigma_\\delta$。它们的计算方法如下：\n$$ \\Delta\\sigma_N = \\left| \\frac{\\partial\\sigma}{\\partial N} \\right| \\sqrt{V[N]} \\quad \\text{and} \\quad \\Delta\\sigma_\\delta = \\left| \\frac{\\partial\\sigma}{\\partial \\delta} \\right| \\sqrt{V[\\delta]} $$\n偏导数在参数的中心值处求值，即在 $N=1692$ 和 $\\delta=0$ 处。\n\n1. 来自偶然不确定性（$N$ 的泊松计数）的贡献\n观测计数 $N$ 遵循泊松分布。对于泊松过程，方差等于均值，即 $V[N] = E[N]$。均值 $E[N]$ 的最佳可用估计是观测到的计数 $N$ 本身。因此，我们将方差近似为 $V[N] \\approx N$，标准差近似为 $\\sqrt{V[N]} \\approx \\sqrt{N}$。\n$\\sigma$ 对 $N$ 的偏导数为：\n$$ \\frac{\\partial\\sigma}{\\partial N} = \\frac{\\partial}{\\partial N} \\left[ \\frac{N}{L \\epsilon_0 (1 + \\delta)} \\right] = \\frac{1}{L \\epsilon_0 (1 + \\delta)} $$\n在 $\\delta=0$ 处对该导数求值：\n$$ \\left.\\frac{\\partial\\sigma}{\\partial N}\\right|_{\\delta=0} = \\frac{1}{L \\epsilon_0} $$\n来自计数不确定性的标准差贡献为：\n$$ \\Delta\\sigma_N = \\left| \\frac{1}{L \\epsilon_0} \\right| \\sqrt{N} = \\frac{\\sqrt{N}}{L \\epsilon_0} $$\n代入给定值，$N = 1692$，$L = 140\\,\\mathrm{fb}^{-1}$，以及 $\\epsilon_0 = 0.60$：\n$$ \\Delta\\sigma_N = \\frac{\\sqrt{1692}}{140 \\times 0.60}\\,\\mathrm{fb} = \\frac{\\sqrt{1692}}{84}\\,\\mathrm{fb} \\approx \\frac{41.133928...}{84}\\,\\mathrm{fb} \\approx 0.4896896... \\,\\mathrm{fb} $$\n四舍五入到三位有效数字，偶然不确定性贡献为 $0.490\\,\\mathrm{fb}$。\n\n2. 来自认知不确定性（效率校准偏移 $\\delta$）的贡献\n校准偏移 $\\delta$ 被描述为一个均值为 0、标准差为 $s_\\delta = 0.035$ 的高斯随机变量。因此，$\\delta$ 的标准差为 $\\sqrt{V[\\delta]} = s_\\delta$。\n$\\sigma$ 对 $\\delta$ 的偏导数为：\n$$ \\frac{\\partial\\sigma}{\\partial \\delta} = \\frac{\\partial}{\\partial \\delta} \\left[ \\frac{N}{L \\epsilon_0} (1+\\delta)^{-1} \\right] = \\frac{N}{L \\epsilon_0} \\left[ -1 \\cdot (1+\\delta)^{-2} \\right] = -\\frac{N}{L \\epsilon_0 (1+\\delta)^2} $$\n在中心值 $N=1692$ 和 $\\delta=0$ 处对该导数求值：\n$$ \\left.\\frac{\\partial\\sigma}{\\partial \\delta}\\right|_{N=1692, \\delta=0} = -\\frac{1692}{L \\epsilon_0 (1+0)^2} = -\\frac{N}{L \\epsilon_0} = -\\hat{\\sigma} $$\n来自效率不确定性的标准差贡献为：\n$$ \\Delta\\sigma_\\delta = \\left| -\\frac{N}{L \\epsilon_0} \\right| s_\\delta = \\hat{\\sigma} \\cdot s_\\delta $$\n首先，我们计算估计的截面 $\\hat{\\sigma}$：\n$$ \\hat{\\sigma} = \\frac{1692}{140 \\times 0.60}\\,\\mathrm{fb} = \\frac{1692}{84}\\,\\mathrm{fb} = 20.142857... \\,\\mathrm{fb} $$\n现在我们可以计算不确定性贡献：\n$$ \\Delta\\sigma_\\delta = (20.142857... \\,\\mathrm{fb}) \\times 0.035 \\approx 0.704999... \\,\\mathrm{fb} $$\n四舍五入到三位有效数字，认知不确定性贡献为 $0.705\\,\\mathrm{fb}$。\n\n所要求的两个不确定性贡献是：\n- 偶然不确定性：$0.490\\,\\mathrm{fb}$\n- 认知不确定性：$0.705\\,\\mathrm{fb}$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.490  0.705\n\\end{pmatrix}\n}\n$$", "id": "3540032"}, {"introduction": "在理解了系统效应的概念之后，本实践将探讨如何对改变分布形状的不确定性进行建模。你将实现“垂直插值”（vertical morphing），这是一种根据离散的“向上”和“向下”系统性变化直方图来创建连续模型的标准技术。这项练习将让你通过编码实践，深入理解在许多现代高能物理分析中，形状系统误差是如何被参数化的。[@problem_id:3540041]", "problem": "给定三个代表高能物理（HEP）中在单一系统不确定度来源下的微分事例产额分布的分箱模板：一个在参数值 $\\theta=0$ 处的名义模板，一个在 $\\theta=+1$ 处的“up”模板，以及一个在 $\\theta=-1$ 处的“down”模板。参数 $\\theta$ 是一个控制系统性偏移的无量纲讨厌参数。目标是实现对箱元内容的垂直形变，并计算在中间参数值 $\\theta=0.3$ 时每个箱元中的预期事例产额。在垂直形变中，形变是在箱元内容上“垂直”执行的，这意味着对于每个箱元 $i$，定义一个平滑函数 $y_i(\\theta)$，该函数对三个控制点 $\\{(-1,y_i^{-}), (0,y_i^{0}), (1,y_i^{+})\\}$进行插值，其中 $y_i^{-}$、$y_i^{0}$ 和 $y_i^{+}$ 分别是“down”、名义和“up”模板的箱元内容。假设 $\\theta$ 位于区间 $[-1,1]$ 内。预期事例产额是所有箱元内容的总和，且事例计数是无量纲的。\n\n此问题的基本原理：在基于分箱模板的事例产额预测中，箱元 $i$ 中的预期产额是微分期望在该箱元范围内的积分，当使用离散直方图时，这在计算上简化为箱元内容 $y_i$。当不确定度仅影响形状时，总预期产额（所有箱元的总和）在系统性变化中保持不变。一个模板形变方案必须在每个箱元中都满足边界条件 $y_i(-1)=y_i^{-}$、$y_i(0)=y_i^{0}$ 和 $y_i(1)=y_i^{+}$，以便与“up”/“down”变化和名义预测保持一致。在不指定任何特定简化公式的情况下，为每个箱元实现与这三个边界条件一致的唯一最低阶多项式，并用它来插值到 $\\theta=0.3$。然后，当“up”和“down”模板被预先归一化到与名义模板相同的总和时，验证插值是否保持总产额不变。\n\n实现以下测试套件。对于每个测试用例，计算在 $\\theta=0.3$ 处的插值箱元产额，并计算两个布尔值：一个表示插值后的总产额是否在 $10^{-12}$ 的绝对容差内等于名义总产额，另一个表示是否意图保持总产额（即，$\\sum_i y_i^{+} = \\sum_i y_i^{0} = \\sum_i y_i^{-}$ 是否成立）。程序必须为每个测试用例返回一个列表，其中包含：在 $\\theta=0.3$ 处的各箱元插值产额列表、“总产额是否保持”的布尔值，以及“是否意图保持”的布尔值。\n\n测试套件：\n- 用例 A (仅形状，预归一化的 up/down)：$y^{0}=[100.0, 150.0, 80.0, 70.0]$，$y^{+}=[110.0, 140.0, 85.0, 65.0]$，$y^{-}=[90.0, 160.0, 75.0, 75.0]$。\n- 用例 B (未预归一化)：$y^{0}=[50.0, 50.0, 50.0]$，$y^{+}=[60.0, 55.0, 50.0]$，$y^{-}=[45.0, 45.0, 45.0]$。\n- 用例 C (包含零内容箱元的边缘情况，仅形状且预归一化)：$y^{0}=[0.0, 100.0, 0.0, 50.0]$，$y^{+}=[0.0, 110.0, 0.0, 40.0]$，$y^{-}=[0.0, 90.0, 0.0, 60.0]$。\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果。此顶层列表的每个元素对应一个测试用例，并且其本身也是一个形式为 `[在 $\\theta=0.3$ 处的箱元产额列表, 是否保持的布尔值, 是否意图保持的布尔值]` 的列表。输出中不得包含任何空格。例如，语法结构必须与 “[[...,...,...],[...,...,...],[...,...,...]]” 完全一样，所有数字和布尔值均以纯文本表示。不涉及任何物理单位；所有量都是无量纲的计数。此问题中不出现角度或角度单位。\n\n解决问题的精确步骤：\n- 对于测试用例中的每个箱元 $i$，构建与 $\\theta=-1,0,1$ 处的三个给定边界条件一致的唯一最低阶多项式 $y_i(\\theta)$。\n- 对所有箱元计算 $y_i(0.3)$。\n- 计算总产额 $\\sum_i y_i(0.3)$，并使用 $10^{-12}$ 的绝对容差与 $\\sum_i y_i^{0}$ 进行比较，以形成“是否保持”的布尔值。\n- 通过检查 $\\sum_i y_i^{+}$、$\\sum_i y_i^{0}$ 和 $\\sum_i y_i^{-}$ 在相同容差内是否相等来确定“是否意图保持”的布尔值。\n- 聚合结果并以指定的无空格单行格式精确打印最终结果。", "solution": "该问题要求为分箱的事例产额模板实现一个垂直形变算法，这是一种在高能物理中用于模拟系统不确定度影响的标准技术。任务的核心是根据三个输入模板：在 $\\theta=0$ 处的一个名义模板 ($y^0$)，在 $\\theta=+1$ 处的一个“up”变化模板 ($y^+$)，以及在 $\\theta=-1$ 处的一个“down”变化模板 ($y^-$)，为讨厌参数值 $\\theta=0.3$ 找到一个插值模板。我们还必须验证一个与总事例产额守恒相关的属性。\n\n该问题是有效的，因为它在科学上基于通用的物理分析实践，在数学上是良定的，并提供了完整且明确的规范。\n\n第一步是确定每个箱元 $i$ 内容的插值函数。问题指定使用通过三个给定控制点 $(-1, y_i^{-})$、$(0, y_i^{0})$ 和 $(1, y_i^{+})$ 的唯一最低阶多项式。一个能拟合三个点的多项式通常是以下形式的二次多项式：\n$$y_i(\\theta) = a_i \\theta^2 + b_i \\theta + c_i$$\n\n每个箱元 $i$ 的系数 $a_i$、$b_i$ 和 $c_i$ 通过施加边界条件来确定：\n1. 在 $\\theta=0$ 处：\n$$y_i(0) = a_i(0)^2 + b_i(0) + c_i = y_i^0 \\implies c_i = y_i^0$$\n2. 在 $\\theta=1$ 处：\n$$y_i(1) = a_i(1)^2 + b_i(1) + c_i = a_i + b_i + c_i = y_i^+$$\n代入 $c_i=y_i^0$，我们得到：\n$$a_i + b_i = y_i^+ - y_i^0 \\quad (\\text{方程 1})$$\n3. 在 $\\theta=-1$ 处：\n$$y_i(-1) = a_i(-1)^2 + b_i(-1) + c_i = a_i - b_i + c_i = y_i^-$$\n代入 $c_i=y_i^0$，我们得到：\n$$a_i - b_i = y_i^- - y_i^0 \\quad (\\text{方程 2})$$\n\n我们现在有一个关于 $a_i$ 和 $b_i$ 的二元一次方程组。将方程 1 和方程 2 相加得到：\n$$2a_i = (y_i^+ - y_i^0) + (y_i^- - y_i^0) = y_i^+ + y_i^- - 2y_i^0$$\n$$a_i = \\frac{y_i^+ + y_i^- - 2y_i^0}{2}$$\n从方程 1 中减去方程 2 得到：\n$$2b_i = (y_i^+ - y_i^0) - (y_i^- - y_i^0) = y_i^+ - y_i^-$$\n$$b_i = \\frac{y_i^+ - y_i^-}{2}$$\n\n因此，在任意参数值 $\\theta$ 下，插值后箱元内容 $y_i$ 的显式公式为：\n$$y_i(\\theta) = \\left( \\frac{y_i^+ + y_i^- - 2y_i^0}{2} \\right) \\theta^2 + \\left( \\frac{y_i^+ - y_i^-}{2} \\right) \\theta + y_i^0$$\n对每个箱元，在 $\\theta=0.3$ 处对此公式求值，以找到插值模板。\n\n接下来，我们分析总事例产额的守恒性。在给定 $\\theta$ 下的总产额是所有箱元内容的总和，$S(\\theta) = \\sum_i y_i(\\theta)$。使用插值公式和求和算子的线性性：\n$$S(\\theta) = \\sum_i \\left[ \\left( \\frac{y_i^+ + y_i^- - 2y_i^0}{2} \\right) \\theta^2 + \\left( \\frac{y_i^+ - y_i^-}{2} \\right) \\theta + y_i^0 \\right]$$\n$$S(\\theta) = \\left( \\frac{\\sum_i y_i^+ + \\sum_i y_i^- - 2\\sum_i y_i^0}{2} \\right) \\theta^2 + \\left( \\frac{\\sum_i y_i^+ - \\sum_i y_i^-}{2} \\right) \\theta + \\sum_i y_i^0$$\n令 $S_0 = \\sum_i y_i^0$、$S_+ = \\sum_i y_i^+$ 和 $S_- = \\sum_i y_i^-$ 分别为名义、up 和 down 模板的总产额。总插值产额的表达式简化为：\n$$S(\\theta) = \\left( \\frac{S_+ + S_- - 2S_0}{2} \\right) \\theta^2 + \\left( \\frac{S_+ - S_-}{2} \\right) \\theta + S_0$$\n问题将“意图保持”定义为输入模板被预归一化的情况，即 $S_+ = S_0$ 且 $S_- = S_0$。这对应于“仅形状”的不确定度。如果这些条件成立，$S(\\theta)$ 表达式中 $\\theta^2$ 和 $\\theta$ 项的系数将变为零：\n$\\theta^2$ 系数：$\\frac{S_0 + S_0 - 2S_0}{2} = 0$。\n$\\theta$ 系数：$\\frac{S_0 - S_0}{2} = 0$。\n因此，如果意图保持的条件成立，则对于所有 $\\theta \\in [-1, 1]$ 都有 $S(\\theta) = S_0$。这证明了二次垂直形变当且仅当输入的“up”和“down”模板与名义模板具有相同的总产额时，才会保持总事例产额不变。\n\n将要实现的算法将对每个测试用例执行以下步骤：\n1. 对于给定的测试用例及其模板 $y^0$、$y^+$ 和 $y^-$，计算它们的总和 $S_0$、$S_+$ 和 $S_-$。\n2. 通过检查 $|S_+ - S_0| < 10^{-12}$ 和 $|S_- - S_0| < 10^{-12}$ 来确定 `intended_preservation` 布尔值。\n3. 对于每个箱元 $i$，使用派生的公式计算系数 $a_i, b_i, c_i$。这可以通过对模板数组使用向量化操作来高效完成。\n4. 对所有箱元，计算 $y_i(0.3) = a_i(0.3)^2 + b_i(0.3) + c_i$ 以获得插值模板。\n5. 计算插值模板的总产额 $S_{0.3} = \\sum_i y_i(0.3)$。\n6. 通过检查 $|S_{0.3} - S_0| < 10^{-12}$ 来确定 `preserved_total` 布尔值。\n7. 收集插值产额列表、`preserved_total` 布尔值和 `intended_preservation` 布尔值。\n8. 按照规定，将所有测试用例收集的结果格式化为无空格的单行字符串。", "answer": "[[[102.505,145.455,82.725,69.315],true,true],[[53.285,51.785,50.285],false,false],[[0,102.505,0,44.495],true,true]]", "id": "3540041"}, {"introduction": "最后的这项实践将所有概念整合到一个综合的统计模型中。你将学习使用“Asimov 数据集”来计算一项实验的预期发现显著性，并通过在剖析似然拟合中使用讨厌参数（nuisance parameters）来全面地考虑归一化和形状不确定性的影响。这种强大的技术是实验设计和评估分析发现新现象潜力的核心方法。[@problem_id:3540042]", "problem": "考虑一个在计算高能物理中的分箱计数实验，其中预期信号和背景产额按箱进行建模，并使用 Asimov 数据集的概念来分析数据。核心目标是通过构建和剖析一个包含带高斯约束的讨厌参数的似然函数，来量化系统不确定性对预期发现显著性的影响。计算必须纯粹以数学方式进行，并且不得依赖任何外部数据源。\n\n假设有 $N$ 个箱，索引为 $i \\in \\{0,1,\\dots,N-1\\}$。令 $s_i \\ge 0$ 表示箱 $i$ 中的预期信号产额， $b_i > 0$ 表示箱 $i$ 中的预期背景产额。定义 Asimov 数据集（在标称讨厌参数下，与信号加背景假设的期望值一致的确定性数据集），其计数为\n$$\nn_i^{A} = \\mu_{\\text{true}} s_i + b_i,\n$$\n其中 $\\mu_{\\text{true}}$ 是构建 Asimov 数据集时所用的真实信号强度。在本问题中，取 $\\mu_{\\text{true}} = 1$。\n\n在假设的信号强度 $\\mu \\ge 0$ 和两个讨厌参数下，箱 $i$ 中预期计数的统计模型为：\n$$\n\\lambda_i(\\mu,\\theta_n,\\theta_s) = \\mu s_i + b_i \\exp(\\theta_n) \\exp(\\theta_s k_i),\n$$\n其中：\n- $\\theta_n$ 是背景归一化讨厌参数，其高斯先验以 $0$ 为中心，相对标准差为 $\\sigma_n$（以小数表示）。\n- $\\theta_s$ 是形状讨厌参数，其高斯先验以 $0$ 为中心，标准差为 $\\sigma_s$。\n- $k_i$ 编码了一个跨箱的线性倾斜形状模式，定义为\n$$\nk_i = r_i - \\frac{1}{N} \\sum_{j=0}^{N-1} r_j, \\quad \\text{其中} \\quad r_i = -1 + \\frac{2i}{N-1},\n$$\n因此 $\\sum_i k_i = 0$，确保在一阶上是纯粹的倾斜而不改变整体归一化。\n\n在每个计数箱中的泊松涨落独立以及讨厌参数的高斯约束也独立的假设下，对于 Asimov 数据的负对数似然（NLL）（不含与参数无关的加法常数）为：\n$$\n\\text{NLL}(\\mu,\\theta_n,\\theta_s) = \\sum_{i=0}^{N-1} \\left[ \\lambda_i(\\mu,\\theta_n,\\theta_s) - n_i^{A} \\ln \\lambda_i(\\mu,\\theta_n,\\theta_s) \\right]\n+ \\frac{1}{2}\\left(\\frac{\\theta_n}{\\sigma_n}\\right)^2 \\mathbb{I}[\\sigma_n > 0]\n+ \\frac{1}{2}\\left(\\frac{\\theta_s}{\\sigma_s}\\right)^2 \\mathbb{I}[\\sigma_s > 0],\n$$\n其中 $\\mathbb{I}[\\cdot]$ 是指示函数，仅在相应标准差严格为正时才包含高斯惩罚项。当标准差为零时，相关的讨厌参数固定为其标称值 $0$。\n\n定义用于检验纯背景假设 $\\mu=0$ 的剖面似然比为：\n$$\n\\lambda(0) = \\frac{L(0,\\hat{\\hat{\\theta}})}{L(\\hat{\\mu},\\hat{\\theta})},\n$$\n其中 $L$ 是与上述负对数似然 $\\text{NLL}$ 对应的似然函数，$\\hat{\\hat{\\theta}}$ 表示在 $\\mu$ 固定为 $0$ 时最小化 $\\text{NLL}$ 的讨厌参数，而 $(\\hat{\\mu},\\hat{\\theta})$ 是在 $\\mu \\ge 0$ 和讨厌参数上联合最小化 $\\text{NLL}$ 的参数。基于似然比的发现检验统计量为\n$$\nq_0 = -2 \\ln \\lambda(0),\n$$\nAsimov 预期发现显著性为\n$$\nZ_A = \\sqrt{q_0}.\n$$\n此 $Z_A$ 是无量纲的，应以浮点数形式报告。\n\n实现一个程序，对于下面定义的每个测试用例，构建 Asimov 数据集 $n_i^{A}$，剖析负对数似然以获得在 $\\mu=0$ 时的 $\\hat{\\hat{\\theta}}$ 和在自由 $\\mu \\ge 0$ 时的 $(\\hat{\\mu},\\hat{\\theta})$，计算 $q_0$，并返回 $Z_A$。上述建模选择，包括系统效应的指数参数化，强制了期望值 $\\lambda_i(\\mu,\\theta_n,\\theta_s)$ 的正性。\n\n您的程序必须将所有测试用例的结果作为单行输出，该行包含一个用方括号括起来的逗号分隔列表，每个条目四舍五入到六位小数，例如，“[0.123456,1.234568]”。不得打印任何其他文本。\n\n测试套件：\n- 案例1（同时包含归一化和形状不确定性的一般情况）：\n  - $N=6$\n  - $b = [120, 100, 90, 80, 70, 60]$\n  - $s = [10, 12, 15, 18, 20, 22]$\n  - $\\sigma_n = 0.05$\n  - $\\sigma_s = 1.0$\n- 案例2（仅归一化不确定性；形状不确定性禁用）：\n  - $N=6$\n  - $b = [120, 100, 90, 80, 70, 60]$\n  - $s = [10, 12, 15, 18, 20, 22]$\n  - $\\sigma_n = 0.05$\n  - $\\sigma_s = 0.0$\n- 案例3（仅形状不确定性；归一化不确定性禁用）：\n  - $N=6$\n  - $b = [120, 100, 90, 80, 70, 60]$\n  - $s = [10, 12, 15, 18, 20, 22]$\n  - $\\sigma_n = 0.0$\n  - $\\sigma_s = 1.0$\n- 案例4（弱信号；两种不确定性均激活）：\n  - $N=6$\n  - $b = [120, 100, 90, 80, 70, 60]$\n  - $s = [1, 1.2, 1.5, 1.8, 2.0, 2.2]$\n  - $\\sigma_n = 0.05$\n  - $\\sigma_s = 1.0$\n- 案例5（强信号；两种不确定性均激活）：\n  - $N=6$\n  - $b = [120, 100, 90, 80, 70, 60]$\n  - $s = [50, 60, 75, 90, 100, 110]$\n  - $\\sigma_n = 0.05$\n  - $\\sigma_s = 1.0$\n- 案例6（某些箱中背景较低的边缘情况；两种不确定性均激活）：\n  - $N=6$\n  - $b = [5, 10, 15, 5, 3, 1]$\n  - $s = [2, 2, 3, 3, 4, 5]$\n  - $\\sigma_n = 0.05$\n  - $\\sigma_s = 1.0$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，顺序与上面列出的案例完全相同。每个数字必须是四舍五入到六位小数的浮点数，并且方括号内不得有额外的空格。", "solution": "该问题要求在各种系统不确定性场景下，计算分箱计数实验的 Asimov 发现显著性 $Z_A$。此计算依赖于剖面似然比方法，这是高能物理中统计推断的基石。\n\n### 科学原理与方法论\n\n问题的核心是使用从似然函数派生的检验统计量，来量化信号加背景假设（$\\mu=1$）与纯背景假设（$\\mu=0$）之间的预期分离程度。\n\n1.  **似然函数**：该统计模型假设每个箱 $i$ 中观测到的事件数遵循独立的泊松分布，其均值为 $\\lambda_i$。总似然是这些泊松概率的乘积，并增加了用于系统不确定性的惩罚项，这些不确定性由讨厌参数建模。讨厌参数 $\\theta_n$ 和 $\\theta_s$ 受高斯先验约束，反映了关于它们期望值（零）和不确定性（$\\sigma_n$ 和 $\\sigma_s$）的先验知识。为计算方便，我们使用负对数似然（$\\text{NLL}$），它是一个各项之和而非乘积：\n    $$\n    \\text{NLL}(\\mu,\\theta_n,\\theta_s) = \\sum_{i=0}^{N-1} \\left[ \\lambda_i(\\mu,\\theta_n,\\theta_s) - n_i \\ln \\lambda_i(\\mu,\\theta_n,\\theta_s) \\right] + \\text{Penalty}(\\theta_n, \\theta_s)\n    $$\n    其中惩罚项是二次的，对应于高斯先验。\n\n2.  **Asimov 数据集**：为了计算*预期*显著性而无需借助计算成本高昂的蒙特卡洛模拟，我们使用 Asimov 数据集。这是一个确定性的、有代表性的数据集，其中“观测”计数 $n_i^A$ 被设定为等于特定假设下的预期计数。这里，该假设是信号加背景假设，信号强度 $\\mu_{\\text{true}}=1$，讨厌参数为标称值（$\\theta_n=0, \\theta_s=0$）。因此，$n_i^A = s_i + b_i$。\n\n3.  **剖面似然比与检验统计量 $q_0$**：假设之间的分离程度由剖面似然比检验统计量 $q_0$ 量化。\n    $$\n    q_0 = -2 \\ln \\frac{ L(\\mu=0, \\hat{\\hat{\\theta}}) }{ L(\\hat{\\mu}, \\hat{\\theta}) } = 2 \\left[ \\text{NLL}(0, \\hat{\\hat{\\theta}}) - \\text{NLL}(\\hat{\\mu}, \\hat{\\theta}) \\right]\n    $$\n    这要求在两种情况下找到最小化 NLL 的参数：\n    -   **全局最小值**：$(\\hat{\\mu}, \\hat{\\theta})$ 是给出数据最佳拟合的参数，代表 NLL 的全局最小值。Asimov 数据集的一个关键特性是，NLL 的全局最小值恰好出现在生成该数据集所依据的真实参数值处。在我们的案例中，即 $(\\hat{\\mu}, \\hat{\\theta}_n, \\hat{\\theta}_s) = (1, 0, 0)$。\n    -   **约束下最小值**：$\\hat{\\hat{\\theta}}$ 是在纯背景假设（$\\mu=0$）约束下给出数据最佳拟合的讨厌参数。这给出了在 $\\mu=0$ 子空间上 NLL 的最小值。\n\n4.  **Asimov 显著性 $Z_A$**：对于 Asimov 数据集，显著性就是 $Z_A = \\sqrt{q_0}$。该值代表实验的中位数预期发现显著性。\n\n### 算法实现\n\n解决方案通过为每个测试用例执行以下步骤来实现：\n\n1.  **初始化**：定义输入参数：箱数 $N$、信号产额 $s_i$、背景产额 $b_i$ 以及系统不确定性 $\\sigma_n$ 和 $\\sigma_s$。\n\n2.  **预计算**：\n    -   根据定义计算形状因子 $k_i$。对于给定的 $r_i$ 线性形式，这简化为 $k_i = r_i$。\n    -   构建 Asimov 数据集计数为 $n_i^A = s_i + b_i$。\n\n3.  **计算全局最小值处的 NLL**：\n    -   NLL 的全局最小值出现在 $(\\mu, \\theta_n, \\theta_s) = (1, 0, 0)$。\n    -   通过将这些值代入 NLL 公式，计算出 $\\text{NLL}(\\hat{\\mu}, \\hat{\\theta}) = \\text{NLL}(1, 0, 0)$ 的值，该公式简化为 $\\sum_i [n_i^A - n_i^A \\ln(n_i^A)]$。\n\n4.  **计算约束下最小值处的 NLL**：\n    -   找到 $\\text{NLL}(0, \\hat{\\hat{\\theta}})$ 需要在将 $\\mu$ 固定为 $0$ 的同时，关于讨厌参数 $(\\theta_n, \\theta_s)$ 最小化 NLL 函数。\n    -   这是一个数值优化问题。我们定义一个目标函数 `nll_mu0(thetas)`，用于计算 $\\text{NLL}(0, \\theta_n, \\theta_s)$。\n    -   使用 `scipy.optimize.minimize` 函数和 `L-BFGS-B` 方法来找到该目标函数的最小值。讨厌参数的初始猜测值为 $(0, 0)$。\n    -   $\\sigma_n=0$ 或 $\\sigma_s=0$ 的情况对应于固定的讨厌参数。这通过在优化器中将相应参数的界限设置为 $(0, 0)$ 来处理。\n\n5.  **计算显著性 $Z_A$**：\n    -   检验统计量 $q_0$ 计算为 $q_0 = 2 \\left[ \\text{NLL}(0, \\hat{\\hat{\\theta}}) - \\text{NLL}(1, 0, 0) \\right]$。为防止微小的数值浮点不准确性导致问题，将 $q_0$ 的下限设为 $0$。\n    -   然后，Asimov 显著性为 $Z_A = \\sqrt{q_0}$。\n\n最终结果是为所有测试用例计算出的 $Z_A$ 值的列表，并按要求格式化。", "answer": "[4.836881,4.954705,5.132331,0.505374,19.387190,5.656844]", "id": "3540042"}]}