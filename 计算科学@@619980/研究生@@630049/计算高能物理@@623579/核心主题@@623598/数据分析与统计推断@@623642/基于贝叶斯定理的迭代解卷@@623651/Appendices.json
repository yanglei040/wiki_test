{"hands_on_practices": [{"introduction": "要深刻理解一种迭代算法，最好的方法莫过于剖析其第一步的运作机制。本练习将从基本原理出发，推导贝叶斯迭代更新的第一步，并揭示其与一种直观的数据“归一化反向投影”之间的深刻联系。通过将此迭代结果与经典的矩阵求逆方法进行比较，我们可以清晰地看到贝叶斯方法即使在初次迭代中也体现出的正则化效应 [@problem_id:3518211]。", "problem": "考虑一个计算高能物理中的简化探测器模型，该模型有三个真实分箱（truth bin），索引为 $i \\in \\{1,2,3\\}$，以及三个测量分箱（measured bin），索引为 $j \\in \\{1,2,3\\}$。探测器响应由一个响应矩阵 $A_{ji}$ 描述，其中 $A_{ji}$ 是条件概率 $P(j \\mid i)$，表示一个源于真实分箱 $i$ 的事例在测量分箱 $j$ 中被重建的概率。设测量到的计数为向量 $m = (m_{1}, m_{2}, m_{3})$，未知的真实计数为 $n = (n_{1}, n_{2}, n_{3})$。假设接收度效应已编码在 $A_{ji}$ 的列中（因此列和可以小于1），并忽略任何超出接收度的分箱。\n\n仅从贝叶斯定理和定义 $A_{ji} = P(j \\mid i)$ 出发，推导在平坦先验 $n_{i}^{(0)} = c$（其中 $c > 0$ 对所有 $i$ 均为常数）下的第一次贝叶斯迭代展开估计 $n_{i}^{(1)}$ 的表达式。证明这第一次迭代可以解释为测量计数通过 $A_{ji}$ 的归一化反向投影。\n\n然后，对于具有以下参数的三分箱具体情况：\n$$\nA \\;=\\;\n\\begin{pmatrix}\n0.70  0.10  0.05 \\\\\n0.20  0.70  0.20 \\\\\n0.05  0.15  0.60\n\\end{pmatrix}\n\\quad\\text{和}\\quad\nm \\;=\\; \\begin{pmatrix} 1200 \\\\ 800 \\\\ 500 \\end{pmatrix},\n$$\n计算：\n1. 使用平坦先验 $n_{i}^{(0)} = c$ 时，通过您基于贝叶斯定理的推导得到的一次迭代估计 $n^{(1)}$。\n2. 通过求解 $A\\,n^{\\mathrm{MI}} = m$ 定义的矩阵求逆展开估计 $n^{\\mathrm{MI}}$。\n\n最后，使用相对欧几里得范数\n$$\nr \\;=\\; \\frac{\\|\\,n^{(1)} - n^{\\mathrm{MI}}\\,\\|_{2}}{\\|\\,n^{\\mathrm{MI}}\\,\\|_{2}}.\n$$\n来量化一次迭代结果与矩阵求逆结果之间的偏差。\n将您计算出的 $r$ 的最终答案表示为无单位的小数，并四舍五入到四位有效数字。", "solution": "该问题陈述已经过验证，被认为是合理、适定且具有科学依据的。它提出了一个计算高能物理学中的标准（尽管是简化的）问题，可以使用已建立的数学方法进行严格求解。\n\n该问题要求三个主要部分：一个推导，两个估计量的数值计算，以及它们之间的比较。\n\n**第1部分：一次迭代公式的推导**\n\n目标是仅从贝叶斯定理和给定定义出发，推导第一次迭代展开估计 $n_i^{(1)}$ 的表达式。\n\n贝叶斯定理将给定一个效应（在测量分箱 $j$ 中的事例）后一个原因（在真实分箱 $i$ 中的事例）的后验概率，与给定原因的效应的条件概率以及原因的先验概率联系起来。形式上，\n$$P(i \\mid j) = \\frac{P(j \\mid i) P(i)}{P(j)}$$\n其中：\n- $P(i \\mid j)$ 是在测量分箱 $j$ 中测得的事例起源于真实分箱 $i$ 的后验概率。\n- $P(j \\mid i)$ 是给定一个事例起源于真实分箱 $i$，在测量分箱 $j$ 中测得该事例的条件概率。这由响应矩阵元素 $A_{ji}$ 给出。\n- $P(i)$ 是一个事例起源于真实分箱 $i$ 的先验概率。\n- $P(j)$ 是在测量分箱 $j$ 中测得一个事例的总概率，它作为一个归一化常数。它是通过对所有可能的原因进行边缘化得到的：$P(j) = \\sum_k P(j \\mid k) P(k)$。\n\n真实分箱 $i$ 中的展开事例数，我们记为 $n_i'$，可以通过考虑测量计数 $m_j$ 来估计。对于每个测量分箱 $j$，计数为 $m_j$。我们可以根据后验概率 $P(i \\mid j)$ 将这些计数重新分配回真实分箱。对所有测量分箱的贡献求和，得到 $n_i'$ 的估计值：\n$$n_i' = \\sum_j m_j P(i \\mid j)$$\n该公式假设展开事例的总数等于测量事例的总数，这是当效率没有在单独的步骤中明确校正时，此特定贝叶斯更新步骤的一个特点。\n\n在迭代贝叶斯展开方案中，给定迭代的先验 $P(i)$ 由前一次迭代的结果确定。对于第一次迭代 $n_i^{(1)}$，先验 $P_0(i)$ 基于初始猜测 $n_i^{(0)}$。问题指定了一个平坦先验，$n_i^{(0)} = c$ (对于某个常数 $c>0$) 对所有 $i \\in \\{1, 2, 3\\}$ 成立。这意味着一个均匀的先验概率分布：\n$$P_0(i) = \\frac{n_i^{(0)}}{\\sum_k n_k^{(0)}} = \\frac{c}{3c} = \\frac{1}{3}$$\n先验概率 $P_0(i)$ 对所有 $i$ 都是常数。我们用 $K$ 来表示这个常数。\n\n现在，我们可以计算这次迭代中贝叶斯定理的各项：\n$P(j \\mid i) = A_{ji}$\n$P_0(i) = K$\n$P(j) = \\sum_k P(j \\mid k) P_0(k) = \\sum_k A_{jk} K = K \\sum_k A_{jk}$\n\n将这些代入后验概率 $P(i \\mid j)$ 的表达式中：\n$$P(i \\mid j) = \\frac{A_{ji} K}{K \\sum_k A_{jk}} = \\frac{A_{ji}}{\\sum_k A_{jk}}$$\n然后通过将此后验概率代回重新分配公式中，找到第一次迭代的估计值 $n_i^{(1)}$：\n$$n_i^{(1)} = \\sum_j m_j \\frac{A_{ji}}{\\sum_k A_{jk}}$$\n这个 $n_i^{(1)}$ 的表达式与平坦先验中的常数 $c$ 无关，这是一个适定过程所要求的。\n\n**解释为归一化反向投影**\n\n推导出的公式 $n_i^{(1)} = \\sum_j m_j \\frac{A_{ji}}{\\sum_k A_{jk}}$ 可以解释为归一化反向投影。\n- 项 $A_{ji}$ 对应于转置响应矩阵 $(A^T)_{ij}$ 的一个元素。将测量计数向量 $m$ 乘以 $A^T$ 被称为“反向投影”。项 $m_j A_{ji}$ 表示在分箱 $j$ 中的测量值反向投影到真实分箱 $i$ 的贡献。\n- 分母 $\\sum_k A_{jk}$ 是矩阵 $A$ 的第 $j$ 行的和。如推导所示，在平坦先验 $P_0(i)$ 的特定假设下，此项作为将正向条件概率 $P(j \\mid i) = A_{ji}$ 转换为反向条件概率 $P(i \\mid j)$ 所需的归一化因子。\n- 因此，求和中的每一项 $m_j \\frac{A_{ji}}{\\sum_k A_{jk}}$，表示将在分箱 $j$ 中测量的计数，根据在 $j$ 中看到的事例起源于 $i$ 的归一化概率，重新分配给真实分箱 $i$。对所有测量分箱 $j$ 求和，就得到了真实分箱 $i$ 的总估计计数。\n\n**第2部分：数值计算**\n\n给定的数据是：\n$$\nA \\;=\\;\n\\begin{pmatrix}\n0.70  0.10  0.05 \\\\\n0.20  0.70  0.20 \\\\\n0.05  0.15  0.60\n\\end{pmatrix}\n\\quad\\text{和}\\quad\nm \\;=\\; \\begin{pmatrix} 1200 \\\\ 800 \\\\ 500 \\end{pmatrix}\n$$\n\n**1. 计算一次迭代估计 $n^{(1)}$**\n\n首先，我们计算 $A$ 的行和 $R_j = \\sum_k A_{jk}$：\n$R_1 = 0.70 + 0.10 + 0.05 = 0.85$\n$R_2 = 0.20 + 0.70 + 0.20 = 1.10$\n$R_3 = 0.05 + 0.15 + 0.60 = 0.80$\n\n现在，我们应用 $n_i^{(1)}$ 的公式：\n$n_1^{(1)} = \\sum_j m_j \\frac{A_{j1}}{R_j} = m_1 \\frac{A_{11}}{R_1} + m_2 \\frac{A_{21}}{R_2} + m_3 \\frac{A_{31}}{R_3}$\n$n_1^{(1)} = (1200) \\frac{0.70}{0.85} + (800) \\frac{0.20}{1.10} + (500) \\frac{0.05}{0.80} \\approx 988.2353 + 145.4545 + 31.25 = 1164.9398$\n\n$n_2^{(1)} = \\sum_j m_j \\frac{A_{j2}}{R_j} = m_1 \\frac{A_{12}}{R_1} + m_2 \\frac{A_{22}}{R_2} + m_3 \\frac{A_{32}}{R_3}$\n$n_2^{(1)} = (1200) \\frac{0.10}{0.85} + (800) \\frac{0.70}{1.10} + (500) \\frac{0.15}{0.80} \\approx 141.1765 + 509.0909 + 93.75 = 744.0174$\n\n$n_3^{(1)} = \\sum_j m_j \\frac{A_{j3}}{R_j} = m_1 \\frac{A_{13}}{R_1} + m_2 \\frac{A_{23}}{R_2} + m_3 \\frac{A_{33}}{R_3}$\n$n_3^{(1)} = (1200) \\frac{0.05}{0.85} + (800) \\frac{0.20}{1.10} + (500) \\frac{0.60}{0.80} \\approx 70.5882 + 145.4545 + 375 = 591.0427$\n\n所以，一次迭代的估计值为 $n^{(1)} \\approx (1164.94, 744.02, 591.04)$。\n\n**2. 计算矩阵求逆估计 $n^{\\mathrm{MI}}$**\n\n矩阵求逆估计是线性系统 $A n^{\\mathrm{MI}} = m$ 的解，即 $n^{\\mathrm{MI}} = A^{-1} m$。\n首先，我们求 $A$ 的行列式：\n$\\det(A) = 0.70(0.70 \\cdot 0.60 - 0.20 \\cdot 0.15) - 0.10(0.20 \\cdot 0.60 - 0.20 \\cdot 0.05) + 0.05(0.20 \\cdot 0.15 - 0.70 \\cdot 0.05)$\n$\\det(A) = 0.70(0.39) - 0.10(0.11) + 0.05(-0.005) = 0.273 - 0.011 - 0.00025 = 0.26175$。\n由于 $\\det(A) \\neq 0$，该矩阵是可逆的。其逆矩阵为 $A^{-1} = \\frac{1}{\\det(A)}\\text{adj}(A)$，其中 $\\text{adj}(A)$ 是 $A$ 的伴随矩阵。\n$A$ 的伴随矩阵是其代数余子式矩阵的转置：\n$\\text{adj}(A) = \n\\begin{pmatrix}\n0.39  -0.0525  -0.015 \\\\\n-0.11  0.4175  -0.13 \\\\\n-0.005  -0.10  0.47\n\\end{pmatrix}$\n\n现在我们计算 $n^{\\mathrm{MI}} = A^{-1}m$：\n$n^{\\mathrm{MI}} = \\frac{1}{0.26175}\n\\begin{pmatrix}\n0.39  -0.0525  -0.015 \\\\\n-0.11  0.4175  -0.13 \\\\\n-0.005  -0.10  0.47\n\\end{pmatrix}\n\\begin{pmatrix}\n1200 \\\\\n800 \\\\\n500\n\\end{pmatrix}$\n$n^{\\mathrm{MI}} = \\frac{1}{0.26175}\n\\begin{pmatrix}\n0.39(1200) - 0.0525(800) - 0.015(500) \\\\\n-0.11(1200) + 0.4175(800) - 0.13(500) \\\\\n-0.005(1200) - 0.10(800) + 0.47(500)\n\\end{pmatrix}\n= \\frac{1}{0.26175}\n\\begin{pmatrix}\n468 - 42 - 7.5 \\\\\n-132 + 334 - 65 \\\\\n-6 - 80 + 235\n\\end{pmatrix}\n= \\frac{1}{0.26175}\n\\begin{pmatrix}\n418.5 \\\\\n137 \\\\\n149\n\\end{pmatrix}$\n$n^{\\mathrm{MI}} \\approx \n\\begin{pmatrix}\n1598.8548 \\\\\n523.4986 \\\\\n569.2593\n\\end{pmatrix}$\n\n**第3部分：量化偏差**\n\n最后，我们计算相对欧几里得范数 $r = \\frac{\\|\\,n^{(1)} - n^{\\mathrm{MI}}\\,\\|_{2}}{\\|\\,n^{\\mathrm{MI}}\\,\\|_{2}}$。\n首先，差向量 $d = n^{(1)} - n^{\\mathrm{MI}}$：\n$d \\approx (1164.9398 - 1598.8548, 744.0174 - 523.4986, 591.0427 - 569.2593)$\n$d \\approx (-433.9150, 220.5188, 21.7834)$\n\n接下来，计算欧几里得范数：\n$\\|\\,d\\,\\|_{2} = \\sqrt{(-433.9150)^2 + (220.5188)^2 + (21.7834)^2} \\approx \\sqrt{188282.1 + 48628.5 + 474.5} = \\sqrt{237385.1} \\approx 487.2218$\n$\\|\\,n^{\\mathrm{MI}}\\,\\|_{2} = \\sqrt{(1598.8548)^2 + (523.4986)^2 + (569.2593)^2} \\approx \\sqrt{2556336.8 + 274050.8 + 324056.2} = \\sqrt{3154443.8} \\approx 1776.0754$\n\n相对范数 $r$ 为：\n$r = \\frac{487.2218}{1776.0754} \\approx 0.2743256$\n\n四舍五入到四位有效数字，我们得到 $r \\approx 0.2743$。", "answer": "$$\\boxed{0.2743}$$", "id": "3518211"}, {"introduction": "任何迭代过程都需要一个起点，在贝叶斯解卷积中，这个起点就是先验分布。在处理低统计量或存在零计数的区间时，一个草率的先验选择可能会导致严重的偏差，甚至使算法失效。本练习旨在探讨如何通过第一性原理做出明智的先验选择，我们将从费雪信息中推导出杰弗里斯先验，并理解其作为“伪计数”在正则化问题中的关键作用 [@problem_id:3518183]。", "problem": "在计算高能物理 (HEP) 中，展开（unfolding）旨在从记录在重建区间（记为 $R_j$）中的测量值，推断一个离散化到真实区间（记为 $T_i$，其中 $i$ 属于一个有限的区间索引集）中的真实量的分布。在迭代贝叶斯展开 (IBU) 中，使用贝叶斯定理和探测器响应来更新关于真实区间均值的初始先验。考虑一个双区间（$i \\in \\{1,2\\}$）的真实分布和一个双区间（$j \\in \\{1,2\\}$）的重建分布。探测器响应概率为 $A_{j i} \\equiv P(R_j \\mid T_i)$，假设已知并由 $A_{11} = 0.8$, $A_{12} = 0.2$, $A_{21} = 0.2$, $A_{22} = 0.8$ 给出。观测到的重建计数为 $m_1 = 0$ 和 $m_2 = 3$。\n\n(a) 从第一性原理出发，使用 Jeffreys 先验的定义 $\\pi(\\theta) \\propto \\sqrt{I(\\theta)}$（其中 $I(\\theta)$ 是 Fisher 信息）以及给定均值 $\\mu$ 时观测计数为 $k$ 的泊松似然，推导区间 $i$ 中泊松均值 $\\mu_i$ 的 Jeffreys 先验，证明 $\\pi(\\mu_i) \\propto \\mu_i^{-1/2}$。\n\n(b) 基于 (a) 部分，解释在初始化 IBU 时，如何将此先验信息编码为每个真实区间的初始伪计数 $n_i^{(0)}$，并分析此选择在低统计量情况下的影响（例如，当某个 $j$ 的 $m_j = 0$ 时）。你的解释应依赖于 Jeffreys 先验与泊松模型的共轭贝叶斯更新之间的联系，以及贝oys 定理和全概率定律，而不是启发式规则。\n\n(c) 在没有额外形状信息（因此真实区间成员的初始先验是对称的）的两个真实区间的情况下，使用 (b) 部分的结论，执行第一次 IBU 更新，以计算真实区间 $i=1$ 的展开估计值 $n_1^{(1)}$。你可以将真实区间的初始先验概率视为与来自 Jeffreys 先验的初始伪计数 $n_i^{(0)}$ 成正比，并在所有区间上对其进行归一化。报告 $n_1^{(1)}$ 的精确值，不进行四舍五入，不带单位。", "solution": "此问题是有效的，因为它在科学上基于贝叶斯统计的原理及其在高能物理数据分析中的应用，具有完整且一致的给定条件，问题是适定的，并且使用客观、正式的语言表达。我们可以开始求解。\n\n该问题分为三个部分。我们将按顺序解决它们，并以前一部分的结果为基础。\n\n**(a) 泊松均值的 Jeffreys 先验的推导**\n\n我们的任务是推导泊松分布均值 $\\mu_i$ 的 Jeffreys 先验。参数 $\\theta$ 的 Jeffreys 先验定义为 $\\pi(\\theta) \\propto \\sqrt{I(\\theta)}$，其中 $I(\\theta)$ 是 Fisher 信息。\n\n让我们考虑单个区间 $i$，为简单起见，将其均值记为 $\\mu$。给定均值 $\\mu$ 时，在此区间中观测到 $k$ 个计数的概率遵循泊松分布。其似然函数为：\n$$L(\\mu \\mid k) = P(k \\mid \\mu) = \\frac{\\mu^k \\exp(-\\mu)}{k!}$$\n似然的自然对数，即对数似然，为：\n$$\\ln L(\\mu \\mid k) = k \\ln \\mu - \\mu - \\ln(k!)$$\nFisher 信息 $I(\\mu)$ 定义为对数似然函数关于参数 $\\mu$ 的二阶导数的期望值的负数。首先，我们计算一阶和二阶导数：\n$$\\frac{\\partial}{\\partial \\mu} \\ln L(\\mu \\mid k) = \\frac{k}{\\mu} - 1$$\n$$\\frac{\\partial^2}{\\partial \\mu^2} \\ln L(\\mu \\mid k) = -\\frac{k}{\\mu^2}$$\n那么 Fisher 信息为：\n$$I(\\mu) = -E\\left[\\frac{\\partial^2}{\\partial \\mu^2} \\ln L(\\mu \\mid k)\\right]$$\n期望是关于数据 $k$ 的分布计算的，即均值为 $\\mu$ 的泊松分布。因此，$E[k] = \\mu$。将此代入 $I(\\mu)$ 的表达式中：\n$$I(\\mu) = -E\\left[-\\frac{k}{\\mu^2}\\right] = \\frac{E[k]}{\\mu^2} = \\frac{\\mu}{\\mu^2} = \\frac{1}{\\mu}$$\nJeffreys 先验 $\\pi(\\mu)$ 与 Fisher 信息的平方根成正比：\n$$\\pi(\\mu) \\propto \\sqrt{I(\\mu)} = \\sqrt{\\frac{1}{\\mu}} = \\mu^{-1/2}$$\n此推导对任何区间 $i$ 的均值 $\\mu_i$ 都成立。因此，我们证明了 $\\pi(\\mu_i) \\propto \\mu_i^{-1/2}$。\n\n**(b) 将 Jeffreys 先验解释为初始伪计数**\n\n为理解此先验信息如何编码，我们考察泊松模型的共轭贝叶斯更新框架。泊松似然的共轭先验是 Gamma 分布。一个形状参数为 $\\alpha$、率参数为 $\\beta$ 的均值 $\\mu$ 的 Gamma 分布由下式给出：\n$$\\pi(\\mu \\mid \\alpha, \\beta) \\propto \\mu^{\\alpha-1} \\exp(-\\beta\\mu)$$\n在 (a) 部分推导出的 Jeffreys 先验 $\\pi(\\mu) \\propto \\mu^{-1/2}$，可以看作是参数为 $\\alpha = 1/2$ 和 $\\beta=0$ 的 Gamma 分布。这是一个非正常先验，因为它在 $\\mu \\in [0, \\infty)$ 上的积分是发散的。\n\n当我们用一个泊松过程的 $k$ 个计数的观测值来更新此先验时，$\\mu$ 的后验分布也是一个 Gamma 分布。后验分布与似然和先验的乘积成正比：\n$$P(\\mu \\mid k) \\propto L(k \\mid \\mu) \\pi(\\mu) \\propto \\left(\\mu^k \\exp(-\\mu)\\right) \\left(\\mu^{\\alpha-1} \\exp(-\\beta\\mu)\\right) = \\mu^{k+\\alpha-1} \\exp(-(\\beta+1)\\mu)$$\n对于 Jeffreys 先验（$\\alpha=1/2, \\beta=0$），后验分布为：\n$$P(\\mu \\mid k) \\propto \\mu^{k+1/2-1} \\exp(-\\mu)$$\n这是一个正常的 Gamma 分布，具体为 $\\text{Gamma}(k+1/2, 1)$。该后验分布的均值为 $E[\\mu \\mid k] = \\frac{k+1/2}{1} = k + 1/2$。\n\n这一结果提供了一个清晰的解释：从 Jeffreys 先验开始，等价于通过将观测到的计数 $k$ 加上 $1/2$ 来获得均值的后验估计。这表明 Jeffreys 先验可以被编码为每个真实区间 $i$ 的初始“伪计数” $n_i^{(0)} = 1/2$。这在考虑任何数据之前，作为迭代展开过程的起点。\n\n这对低统计量情况有重要影响。迭代贝叶斯展开 (IBU) 算法在每次迭代 $k$ 时更新真实区间计数的估计值 $n_i^{(k)}$。一个常见的更新规则是 $n_i^{(k+1)} = \\sum_j m_j P^{(k)}(T_i \\mid R_j)$，其中 $P^{(k)}(T_i \\mid R_j)$ 依赖于上一步的先验概率，$P^{(k)}(T_i) \\propto n_i^{(k)}$。如果我们对某个区间 $i$ 初始化为 $n_i^{(0)} = 0$，其先验概率 $P^{(0)}(T_i)$ 将为零，因此，无论观测数据如何，其展开估计值 $n_i^{(k)}$ 在所有后续迭代中都将保持为零。这是一个不良性质，因为它过早地排除了一个真实区间作为观测效应可能原因的可能性。\n\n通过为所有 $i$ 选择 $n_i^{(0)} = 1/2$，我们确保每个真实区间都以一个非零计数开始。这对问题进行了正则化，防止任何区间的估计值被永久固定为零。即使一个重建区间 $j$ 的观测计数为零（$m_j = 0$），可能对其有贡献的真实区间也不会被排除在对其他观测区间的贡献考虑之外。这种初始化保证了初始先验 $P^{(0)}(T_i)$ 是良定义且非零的，从而允许算法根据响应概率将观测到的计数 $m_j$ 分配给所有可能的真实原因。\n\n**(c) 第一次展开迭代**\n\n我们被要求执行第一次 IBU 更新，以计算真实区间 $i=1$ 的展开估计值 $n_1^{(1)}$。根据 (b) 部分以及没有额外形状信息（意味着对称性）的条件，我们将两个真实区间的伪计数初始化为：\n$$n_1^{(0)} = \\frac{1}{2}, \\quad n_2^{(0)} = \\frac{1}{2}$$\n初始总伪计数为 $N^{(0)} = n_1^{(0)} + n_2^{(0)} = 1/2 + 1/2 = 1$。真实区间的初始先验概率经过归一化为：\n$$P^{(0)}(T_1) = \\frac{n_1^{(0)}}{N^{(0)}} = \\frac{1/2}{1} = \\frac{1}{2}$$\n$$P^{(0)}(T_2) = \\frac{n_2^{(0)}}{N^{(0)}} = \\frac{1/2}{1} = \\frac{1}{2}$$\n第一次迭代的 IBU 更新公式为：\n$$n_i^{(1)} = \\sum_{j=1}^{2} m_j P(T_i \\mid R_j)$$\n其中后验概率 $P(T_i \\mid R_j)$ 使用贝叶斯定理和初始先验 $P^{(0)}(T_i)$ 计算：\n$$P(T_i \\mid R_j) = \\frac{P(R_j \\mid T_i) P^{(0)}(T_i)}{\\sum_{l=1}^{2} P(R_j \\mid T_l) P^{(0)}(T_l)} = \\frac{A_{ji} P^{(0)}(T_i)}{\\sum_{l=1}^{2} A_{jl} P^{(0)}(T_l)}$$\n我们需要计算 $n_1^{(1)}$：\n$$n_1^{(1)} = m_1 P(T_1 \\mid R_1) + m_2 P(T_1 \\mid R_2)$$\n代入后验概率的公式：\n$$n_1^{(1)} = m_1 \\frac{A_{11} P^{(0)}(T_1)}{A_{11} P^{(0)}(T_1) + A_{12} P^{(0)}(T_2)} + m_2 \\frac{A_{21} P^{(0)}(T_1)}{A_{21} P^{(0)}(T_1) + A_{22} P^{(0)}(T_2)}$$\n我们有以下给定值：\n\\begin{itemize}\n    \\item 观测计数: $m_1 = 0$, $m_2 = 3$\n    \\item 响应矩阵元素: $A_{11} = 0.8$, $A_{12} = 0.2$, $A_{21} = 0.2$, $A_{22} = 0.8$\n    \\item 初始先验: $P^{(0)}(T_1) = 1/2$, $P^{(0)}(T_2) = 1/2$\n\\end{itemize}\n$n_1^{(1)}$ 表达式中的第一项为零，因为 $m_1 = 0$。我们只需要计算第二项：\n$$n_1^{(1)} = 0 + 3 \\times \\frac{(0.2) \\times (1/2)}{(0.2) \\times (1/2) + (0.8) \\times (1/2)}$$\n化简分数内的表达式：\n$$n_1^{(1)} = 3 \\times \\frac{0.1}{0.1 + 0.4} = 3 \\times \\frac{0.1}{0.5}$$\n$$n_1^{(1)} = 3 \\times \\frac{1}{5} = \\frac{3}{5}$$\n转换为小数形式为 $0.6$。问题要求的是精确值。", "answer": "$$\\boxed{\\frac{3}{5}}$$", "id": "3518183"}, {"introduction": "解卷积结果的质量在根本上取决于其核心输入——响应矩阵的准确性，这正是“输入决定输出”原则的体现。本练习提供了一套具体的质量控制方法，引导你设计统计检验，以验证从蒙特卡洛模拟中获得的响应矩阵是否与已知的探测器效率相符。此外，本练习还将演示如何对该矩阵进行重新归一化以强制满足物理约束，这是为解卷积准备模型的关键一步 [@problem_id:3518218]。", "problem": "在计算高能物理中，使用贝叶斯定理进行迭代展开时，探测器响应被概括为一个响应矩阵 $A_{ji}$，该矩阵编码了在真值区间 $i$ 中产生的粒子在探测器区间 $j$ 中被重建的概率。当从真值区间 $i$ 进行任何重建的概率小于1时，探测器效率为 $\\epsilon_i = \\sum_{j} A_{ji} \\leq 1$，缺失的概率为 $1 - \\epsilon_i$。贝叶斯迭代展开使用贝叶斯定理和响应 $A_{ji}$ 来更新先验真值分布 $p_i$，而前向模型预测的重建分布为 $r_j = \\sum_{i} A_{ji} p_i$。\n\n给定一个 $3 \\times 3$ 的响应矩阵 $A_{ji}$、一个目标效率向量 $\\epsilon_i$、用于估计 $A_{ji}$ 每一列的蒙特卡洛 (MC) 样本量 $N_i$，以及一个归一化的先验 $p_i$：\n- 列 $i=1,2,3$ 对应真值区间；行 $j=1,2,3$ 对应重建区间。\n- 矩阵元素为\n$$\nA \\equiv \\begin{pmatrix}\n0.56  0.096  0.05 \\\\\n0.16  0.416  0.125 \\\\\n0.08  0.128  0.325\n\\end{pmatrix},\n$$\n因此列和为 $S_i \\equiv \\sum_{j} A_{ji} = \\{0.80,\\,0.64,\\,0.50\\}$。\n- 目标效率为 $\\epsilon_i = \\{0.78,\\,0.65,\\,0.52\\}$。\n- 每个真值区间的 MC 样本量为 $N_i = \\{5000,\\,4000,\\,4500\\}$。\n- 先验真值分布为 $p_i = \\{0.5,\\,0.3,\\,0.2\\}$。\n\n仅从响应矩阵和贝叶斯定理的基本概率定义出发，完成以下任务：\n1. 推导为什么物理有效响应的一致性条件是 $\\sum_{j} A_{ji} = \\epsilon_i$，以及为什么前向模型的重建分布是 $r_j = \\sum_{i} A_{ji} p_i$。解释为什么总和 $\\sum_{j} r_j$ 等于 $\\sum_{i} \\epsilon_i p_i$。\n2. 设计一个高斯大样本检验统计量，用于检验列和与目标效率的一致性。对于每个 $i$，使用从 $N_i$ 个真值水平试验中估计二项效率时适用的 MC 抽样方差。明确写出你的检验统计量 $T$（用 $S_i$、$\\epsilon_i$ 和 $N_i$ 表示）。\n3. 使用给定的 $A_{ji}$ 和 $p_i$ 计算前向模型的重建分布 $r_j = \\sum_{i} A_{ji} p_i$，并将其总和与 $\\sum_{i} S_i p_i$ 以及 $\\sum_{i} \\epsilon_i p_i$ 进行验证。\n4. 提出一种逐列归一化方法 $A'_{ji}$，使得 $\\sum_{j} A'_{ji} = \\epsilon_i$ 精确成立，同时保持所有列内迁移比例 $A_{ji}/\\sum_{j} A_{ji}$ 不变。用 $A_{ji}$、$S_i$ 和 $\\epsilon_i$ 给出明确的乘法因子。\n5. 使用第2部分的检验统计量，用给定的数据对 $T$ 进行数值计算。\n\n报告 $T$ 的数值作为你的最终答案，四舍五入到四位有效数字，不带单位。[@problem_id:153]", "solution": "**1. 推导**\n\n设 $T_i$ 为粒子在真值区间 $i$ 中产生的事件， $R_j$ 为其在探测器区间 $j$ 中被重建的事件。根据题意，响应矩阵定义为 $A_{ji} = P(R_j | T_i)$，先验真值分布为 $p_i = P(T_i)$。\n\n真值区间 $i$ 的探测器效率 $\\epsilon_i$ 是来自区间 $i$ 的粒子在*任何*探测器区间被重建的概率。由于重建区间 $R_j$ 是互斥的结果，总概率是各个概率之和：\n$$ \\epsilon_i = P(R_1 \\cup R_2 \\cup \\dots | T_i) = \\sum_{j} P(R_j | T_i) = \\sum_{j} A_{ji} $$\n这确认了第一个恒等式。\n\n前向模型的重建分布 $r_j$ 描述了在探测器区间 $j$ 中重建的无条件概率。使用全概率公式，我们对所有可能的真实来源 $T_i$ 求和：\n$$ r_j = P(R_j) = \\sum_{i} P(R_j \\cap T_i) $$\n使用条件概率的定义，$P(R_j \\cap T_i) = P(R_j | T_i) P(T_i) = A_{ji} p_i$。代入此式可得前向模型：\n$$ r_j = \\sum_{i} A_{ji} p_i $$\n这确认了第二个恒等式。\n\n为了求重建分布的总和，我们将 $r_j$ 对所有 $j$ 求和，并代入其定义：\n$$ \\sum_{j} r_j = \\sum_{j} \\left( \\sum_{i} A_{ji} p_i \\right) $$\n由于和是有限的，我们可以交换求和顺序：\n$$ \\sum_{j} r_j = \\sum_{i} \\sum_{j} A_{ji} p_i = \\sum_{i} p_i \\left( \\sum_{j} A_{ji} \\right) $$\n从我们的第一个推导可知，$\\sum_{j} A_{ji} = \\epsilon_i$。因此，\n$$ \\sum_{j} r_j = \\sum_{i} \\epsilon_i p_i $$\n这表明总重建概率是每个真值区间的效率 $\\epsilon_i$ 按该真值区间的概率 $p_i$ 加权的总和。\n\n**2. 检验统计量设计**\n\n列和 $S_i = \\sum_j A_{ji}$ 是真实效率的估计值，我们假设真实效率为 $\\epsilon_i$。这些估计值来自对每个真值区间 $i$ 进行的大小为 $N_i$ 的蒙特卡洛模拟。对于给定的真值区间 $i$， $N_i$ 个事件中的每一个要么被重建（成功），要么未被重建。这是一个二项过程。在原假设下，成功次数 $K_i$ 服从二项分布 $B(N_i, \\epsilon_i)$。估计的效率为 $S_i = K_i / N_i$。\n\n对于大样本量 $N_i$，二项分布可以很好地用高斯分布来近似。估计量 $S_i$ 的均值为 $E[S_i] = \\epsilon_i$，其方差为 $\\text{Var}(S_i) = \\frac{\\epsilon_i(1-\\epsilon_i)}{N_i}$。\n\n我们可以为每个真值区间 $i$ 定义一个标准化变量（或称拉变量），在原假设下，它将服从标准正态分布 $N(0,1)$：\n$$ z_i = \\frac{S_i - E[S_i]}{\\sqrt{\\text{Var}(S_i)}} = \\frac{S_i - \\epsilon_i}{\\sqrt{\\epsilon_i(1-\\epsilon_i)/N_i}} $$\n假设每个真值区间的蒙特卡洛模拟在统计上是独立的，则拉变量 $z_i$ 是独立的。可以通过将这些拉变量的平方相加来构成一个用于检验整体一致性的检验统计量 $T$。得到的统计量服从卡方 ($\\chi^2$) 分布，其自由度等于项数（这里是 $3$）。\n$$ T = \\sum_{i=1}^{3} z_i^2 = \\sum_{i=1}^{3} \\frac{(S_i - \\epsilon_i)^2}{\\epsilon_i(1-\\epsilon_i)/N_i} = \\sum_{i=1}^{3} \\frac{N_i (S_i - \\epsilon_i)^2}{\\epsilon_i(1-\\epsilon_i)} $$\n这就提供了所需的高斯大样本检验统计量。\n\n**3. 前向模型重建分布的计算**\n\n我们使用矩阵乘法 $r = Ap$ 计算重建分布 $r_j = \\sum_{i} A_{ji} p_i$：\n$$\n\\begin{pmatrix} r_1 \\\\ r_2 \\\\ r_3 \\end{pmatrix}\n=\n\\begin{pmatrix}\n0.56  0.096  0.05 \\\\\n0.16  0.416  0.125 \\\\\n0.08  0.128  0.325\n\\end{pmatrix}\n\\begin{pmatrix} 0.5 \\\\ 0.3 \\\\ 0.2 \\end{pmatrix}\n$$\n$r_1 = (0.56)(0.5) + (0.096)(0.3) + (0.05)(0.2) = 0.28 + 0.0288 + 0.01 = 0.3188$\n$r_2 = (0.16)(0.5) + (0.416)(0.3) + (0.125)(0.2) = 0.08 + 0.1248 + 0.025 = 0.2298$\n$r_3 = (0.08)(0.5) + (0.128)(0.3) + (0.325)(0.2) = 0.04 + 0.0384 + 0.065 = 0.1434$\n重建分布为 $r_j = \\{0.3188, 0.2298, 0.1434\\}$。\n\n其总和为 $\\sum_{j} r_j = 0.3188 + 0.2298 + 0.1434 = 0.692$。\n\n我们用 $\\sum_i S_i p_i$ 来验证这个结果。列和 $S_i$ 是给定矩阵 $A$ 的效率。根据第1部分的推导，$\\sum_j r_j$ 必须等于 $\\sum_i S_i p_i$。\n$\\sum_i S_i p_i = S_1 p_1 + S_2 p_2 + S_3 p_3 = (0.80)(0.5) + (0.64)(0.3) + (0.50)(0.2) = 0.4 + 0.192 + 0.1 = 0.692$。\n验证成立：$\\sum_j r_j = \\sum_i S_i p_i = 0.692$。\n\n现在我们使用目标效率将其与 $\\sum_i \\epsilon_i p_i$ 进行比较：\n$\\sum_i \\epsilon_i p_i = \\epsilon_1 p_1 + \\epsilon_2 p_2 + \\epsilon_3 p_3 = (0.78)(0.5) + (0.65)(0.3) + (0.52)(0.2) = 0.39 + 0.195 + 0.104 = 0.689$。\n正如预期的那样，$\\sum_j r_j \\neq \\sum_i \\epsilon_i p_i$，因为给定矩阵 $A$ 的列和是 $S_i$，而不是 $\\epsilon_i$。这种差异（$0.692$ vs. $0.689$）反映了MC估计的效率与目标效率之间的差别。\n\n**4. 逐列归一化**\n\n我们寻求一个新的矩阵 $A'_{ji}$，使其列和为 $\\sum_j A'_{ji} = \\epsilon_i$，同时保持列内迁移比例不变。第 $i$ 列的迁移比例是在发生重建的情况下，被重建到区间 $j$ 的相对概率，即 $f_{ji} = A_{ji} / (\\sum_k A_{ki}) = A_{ji}/S_i$。\n\n我们将此条件施加于新矩阵：\n$$ \\frac{A'_{ji}}{ \\sum_k A'_{ki} } = \\frac{A_{ji}}{S_i} $$\n因为我们要求 $\\sum_k A'_{ki} = \\epsilon_i$，所以有：\n$$ \\frac{A'_{ji}}{\\epsilon_i} = \\frac{A_{ji}}{S_i} $$\n求解 $A'_{ji}$ 得到重归一化的矩阵元：\n$$ A'_{ji} = A_{ji} \\left( \\frac{\\epsilon_i}{S_i} \\right) $$\n第 $i$ 列中每个元素的乘法因子是 $\\frac{\\epsilon_i}{S_i}$，或者完整地写为 $\\frac{\\epsilon_i}{\\sum_{j} A_{ji}}$。\n\n**5. 检验统计量 $T$ 的数值计算**\n\n我们使用第2部分的公式计算检验统计量 $T$ 的值：\n$$ T = \\sum_{i=1}^{3} \\frac{N_i (S_i - \\epsilon_i)^2}{\\epsilon_i(1-\\epsilon_i)} $$\n给定数据：\n$S = \\{0.80, 0.64, 0.50\\}$\n$\\epsilon = \\{0.78, 0.65, 0.52\\}$\n$N = \\{5000, 4000, 4500\\}$\n\n对于 $i=1$:\n$$ T_1 = \\frac{5000 (0.80-0.78)^2}{0.78(1-0.78)} = \\frac{5000 (0.02)^2}{0.78(0.22)} = \\frac{5000(0.0004)}{0.1716} = \\frac{2}{0.1716} \\approx 11.6550 $$\n对于 $i=2$:\n$$ T_2 = \\frac{4000 (0.64-0.65)^2}{0.65(1-0.65)} = \\frac{4000 (-0.01)^2}{0.65(0.35)} = \\frac{4000(0.0001)}{0.2275} = \\frac{0.4}{0.2275} \\approx 1.7582 $$\n对于 $i=3$:\n$$ T_3 = \\frac{4500 (0.50-0.52)^2}{0.52(1-0.52)} = \\frac{4500 (-0.02)^2}{0.52(0.48)} = \\frac{4500(0.0004)}{0.2496} = \\frac{1.8}{0.2496} \\approx 7.2115 $$\n总检验统计量是这些项的和：\n$$ T = T_1 + T_2 + T_3 \\approx 11.6550 + 1.7582 + 7.2115 = 20.6247 $$\n四舍五入到四位有效数字，$T = 20.62$。", "answer": "$$\\boxed{20.62}$$", "id": "3518218"}]}