{"hands_on_practices": [{"introduction": "在高亮度对撞机环境中，例如大型强子对撞机（LHC），同时发生的多次碰撞（称为堆积效应）会污染喷注的测量。本练习介绍了最常见的一级修正：减去平均背景能量密度，这是一种通过喷注的活动区域来量化的技术。这个练习为喷注标定提供了一个具体的起点，也是误差传播理论的一个实际应用 [@problem_id:3519002]。", "problem": "在高亮度的质子-质子对撞环境中，来自多重相互作用的弥散软背景在快度-方位角平面上贡献了一个近似均匀的单位面积横向动量密度，记为 $\\rho$，单位为 $\\mathrm{GeV}$ 每 $(y,\\phi)$ 平面单位面积。考虑一个使用半径参数 $R=0.4$ 的 anti-$k_{T}$ 算法聚类的重建喷注，其原始横向动量（在任何背景抑制之前）测量值为 $p_{T}^{\\mathrm{raw}}$。喷注对均匀弥散背景的敏感性由其活性面积 $A$（无量纲，以 $(\\Delta y)(\\Delta \\phi)$ 为单位）来量化，该面积表征了在均匀密度假设下，平均有多少背景进入该喷注。\n\n假设均匀背景线性地叠加到喷注的横向动量上，使得其预期贡献与喷注面积和背景密度成正比。在这些假设下：\n- 从 $\\rho$ 作为单位面积平均横向动量密度的定义，以及背景和信号对 $p_{T}^{\\mathrm{raw}}$ 的线性叠加贡献出发。\n- 推导一个真实喷注横向动量（无弥散背景影响）的估计量，记为 $p_{T}^{\\mathrm{corr}}$，用 $p_{T}^{\\mathrm{raw}}$、$\\rho$ 和 $A$ 表示。\n- 假设 $\\rho$ 的统计不确定度服从标准差为 $\\sigma_{\\rho}$ 的高斯分布，且独立于喷注测量和 $A$，传播此不确定度以获得仅由 $\\rho$ 的不确定度引起的 $p_{T}^{\\mathrm{corr}}$ 的标准差。\n\n给定单个喷注的以下事件层面和喷注层面的量：\n- $p_{T}^{\\mathrm{raw}} = 247.8~\\mathrm{GeV}$，\n- $A = 0.503$，\n- $\\rho = 18.7~\\mathrm{GeV}$ 每单位面积，\n- $\\sigma_{\\rho} = 1.6~\\mathrm{GeV}$ 每单位面积。\n\n计算 $p_{T}^{\\mathrm{corr}}$ 的数值以及仅由 $\\sigma_{\\rho}$ 传播产生的不确定度的标准差。将修正后的横向动量和传播的标准差都以 $\\mathrm{GeV}$ 为单位表示。将你的答案四舍五入到四位有效数字。", "solution": "用户提供了一个计算高能物理领域的问题，具体涉及针对来自堆积效应的背景贡献对喷注横向动量进行修正。\n\n### 问题验证\n\n**步骤1：提取给定条件**\n-   弥散软背景横向动量密度：$\\rho$（$\\mathrm{GeV}$ 每 $(y,\\phi)$ 平面单位面积）。\n-   喷注聚类算法：anti-$k_{T}$，半径参数 $R=0.4$。\n-   原始喷注横向动量：$p_{T}^{\\mathrm{raw}}$。\n-   喷注活性面积：$A$（无量纲，以 $(\\Delta y)(\\Delta \\phi)$ 为单位）。\n-   物理模型：背景线性地叠加到喷注的横向动量上，其贡献是密度和面积的乘积。原始动量是线性叠加：$p_{T}^{\\mathrm{raw}} = p_{T}^{\\mathrm{corr}} + p_{T}^{\\mathrm{bkgd}}$。\n-   $\\rho$ 的不确定度：服从标准差为 $\\sigma_{\\rho}$ 的高斯分布，且独立于其他变量。\n-   数值：\n    -   $p_{T}^{\\mathrm{raw}} = 247.8~\\mathrm{GeV}$\n    -   $A = 0.503$\n    -   $\\rho = 18.7~\\mathrm{GeV}$ 每单位面积\n    -   $\\sigma_{\\rho} = 1.6~\\mathrm{GeV}$ 每单位面积\n-   要求输出：\n    1.  修正后的喷注横向动量 $p_{T}^{\\mathrm{corr}}$ 的解析表达式。\n    2.  由 $\\rho$ 的不确定度引起的 $p_{T}^{\\mathrm{corr}}$ 的标准差的解析表达式。\n    3.  $p_{T}^{\\mathrm{corr}}$ 及其不确定度的数值，四舍五入到四位有效数字。\n\n**步骤2：使用提取的给定条件进行验证**\n-   **科学依据：**该问题描述了实验粒子物理学中一种标准的、成熟的技术，用于减轻堆积效应（同时发生的多个质子-质子相互作用）对重建喷注的影响。横向动量密度 $\\rho$、喷注活性面积 $A$ 以及线性减除模型的概念是此过程的基础，被大型强子对撞机（LHC）的实验广泛使用。所提供的值对于高亮度环境下产生的喷注是物理上现实的。\n-   **良态问题：**该问题提供了一个清晰的物理模型和所有必要的数据来推导所要求的表达式并计算数值结果。它要求一个唯一、稳定且有意义的解。\n-   **客观性：**语言正式、精确，没有任何主观或基于观点的陈述。\n\n**步骤3：结论与行动**\n该问题在科学上是合理的、良态的、客观的和完整的。这是一个有效的问题陈述。我将继续进行完整解答。\n\n### 推导与计算\n\n**第1部分：修正后横向动量估计量的推导**\n\n问题陈述指出，测得的原始横向动量 $p_{T}^{\\mathrm{raw}}$ 是真实喷注横向动量 $p_{T}^{\\mathrm{corr}}$ 和来自均匀背景的贡献 $p_{T}^{\\mathrm{bkgd}}$ 的线性和。\n$$p_{T}^{\\mathrm{raw}} = p_{T}^{\\mathrm{corr}} + p_{T}^{\\mathrm{bkgd}}$$\n背景贡献被建模为横向动量密度 $\\rho$ 和喷注活性面积 $A$ 的乘积。单位是一致的：$[\\rho] \\times [A] = (\\mathrm{GeV}/\\text{面积}) \\times \\text{面积} = \\mathrm{GeV}$。\n$$p_{T}^{\\mathrm{bkgd}} = \\rho \\cdot A$$\n将此代入第一个方程，得到原始动量和修正后动量之间的关系：\n$$p_{T}^{\\mathrm{raw}} = p_{T}^{\\mathrm{corr}} + \\rho \\cdot A$$\n解出修正后的横向动量 $p_{T}^{\\mathrm{corr}}$，得到所需的估计量：\n$$p_{T}^{\\mathrm{corr}} = p_{T}^{\\mathrm{raw}} - \\rho \\cdot A$$\n\n**第2部分：不确定度的传播**\n\n我们需要求出 $p_{T}^{\\mathrm{corr}}$ 的标准差，记为 $\\sigma_{p_{T}^{\\mathrm{corr}}}$，它仅由背景密度 $\\sigma_{\\rho}$ 的不确定度引起。在此计算中，$p_{T}^{\\mathrm{raw}}$ 和 $A$ 被视为不确定度为零的常数。\n\n对于一个函数 $f(x_1, x_2, \\ldots, x_n)$，其中变量 $x_i$ 不相关且标准差为 $\\sigma_{x_i}$，不确定度传播的一般公式为：\n$$\\sigma_{f}^{2} = \\sum_{i=1}^{n} \\left(\\frac{\\partial f}{\\partial x_i}\\right)^2 \\sigma_{x_i}^2$$\n在我们的例子中，函数是 $p_{T}^{\\mathrm{corr}} = p_{T}^{\\mathrm{corr}}(p_{T}^{\\mathrm{raw}}, \\rho, A)$，我们只考虑 $\\rho$ 的不确定度。因此，$p_{T}^{\\mathrm{corr}}$ 的方差为：\n$$\\sigma_{p_{T}^{\\mathrm{corr}}}^{2} = \\left(\\frac{\\partial p_{T}^{\\mathrm{corr}}}{\\partial \\rho}\\right)^2 \\sigma_{\\rho}^2$$\n我们计算 $p_{T}^{\\mathrm{corr}}$ 对 $\\rho$ 的偏导数：\n$$\\frac{\\partial p_{T}^{\\mathrm{corr}}}{\\partial \\rho} = \\frac{\\partial}{\\partial \\rho} \\left( p_{T}^{\\mathrm{raw}} - \\rho \\cdot A \\right) = -A$$\n将此代回方差方程：\n$$\\sigma_{p_{T}^{\\mathrm{corr}}}^{2} = (-A)^2 \\sigma_{\\rho}^2 = A^2 \\sigma_{\\rho}^2$$\n取平方根得到标准差。由于活性面积 $A$ 是一个物理量，必须为非负值，我们有 $|A|=A$。\n$$\\sigma_{p_{T}^{\\mathrm{corr}}} = \\sqrt{A^2 \\sigma_{\\rho}^2} = A \\cdot \\sigma_{\\rho}$$\n\n**第3部分：数值计算**\n\n现在我们将给定的数值代入推导出的表达式中。\n给定：\n-   $p_{T}^{\\mathrm{raw}} = 247.8~\\mathrm{GeV}$\n-   $A = 0.503$\n-   $\\rho = 18.7~\\mathrm{GeV}$\n-   $\\sigma_{\\rho} = 1.6~\\mathrm{GeV}$\n\n首先，我们计算修正后的横向动量 $p_{T}^{\\mathrm{corr}}$：\n$$p_{T}^{\\mathrm{corr}} = p_{T}^{\\mathrm{raw}} - \\rho \\cdot A = 247.8 - (18.7 \\cdot 0.503)$$\n$$p_{T}^{\\mathrm{corr}} = 247.8 - 9.4061 = 238.3939$$\n四舍五入到四位有效数字，我们得到：\n$$p_{T}^{\\mathrm{corr}} \\approx 238.4~\\mathrm{GeV}$$\n\n接下来，我们计算传播的不确定度 $\\sigma_{p_{T}^{\\mathrm{corr}}}$：\n$$\\sigma_{p_{T}^{\\mathrm{corr}}} = A \\cdot \\sigma_{\\rho} = 0.503 \\cdot 1.6$$\n$$\\sigma_{p_{T}^{\\mathrm{corr}}} = 0.8048$$\n这个值已经有四位有效数字。单位是 $\\mathrm{GeV}$。\n$$\\sigma_{p_{T}^{\\mathrm{corr}}} = 0.8048~\\mathrm{GeV}$$\n\n因此，修正后的横向动量及其仅由 $\\rho$ 的不确定度引起的标准差的最终数值结果分别为 $238.4~\\mathrm{GeV}$ 和 $0.8048~\\mathrm{GeV}$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n238.4  0.8048\n\\end{pmatrix}\n}\n$$", "id": "3519002"}, {"introduction": "在处理了诸如堆积效应之类的加性效应之后，我们常常需要确定乘性的刻度因子。本练习深入探讨了标定的统计学核心，要求您从第一性原理出发，推导出一个全局标定常数的最佳估计量。这个实践将加深您对高斯-马尔可夫定理和德尔塔方法等基本统计工具的理解，这些工具对于任何精确测量都至关重要 [@problem_id:3519000]。", "problem": "考虑一个计算高能物理中的喷注能量刻度场景，其中原始喷注能量测量值 $E_{\\mathrm{raw}}$ 被建模为 $E_{\\mathrm{raw}} = E_{\\mathrm{true}}/C + \\epsilon$，其中 $E_{\\mathrm{true}}$ 是来自刻度样本的已知真实喷注能量，$C0$ 是待估计的未知全局刻度因子，$\\epsilon$ 是一个零均值随机误差项。您有 $N$ 个独立的刻度事例 $\\{(E_i, E_{\\mathrm{raw},i})\\}_{i=1}^{N}$，其中 $E_i = E_{\\mathrm{true},i}$ 且 $E_{\\mathrm{raw},i}$ 是相应的测量值。假设误差 $\\epsilon_i$ 是独立的，服从高斯分布，且具有异方差方差 $\\operatorname{Var}(\\epsilon_i) = \\sigma_i^{2}0$，该方差对每个事例都是已知的（例如，来自与量能器性能一致的分辨率模型）。令 $\\theta = 1/C$，模型即为通过原点的异方差线性回归 $E_{\\mathrm{raw},i} = \\theta E_i + \\epsilon_i$。\n\n从高斯似然和高斯-马尔可夫定理的第一性原理出发，在所述假设下，推导出一个解析估计量 $\\widehat{C}$，它在所有由样本 $\\{(E_i, E_{\\mathrm{raw},i})\\}_{i=1}^{N}$ 构建的无偏估计量中方差最小。证明它在高斯异方差模型下等价于 $\\theta$ 的最大似然 (ML) 估计量，然后将其映射为 $C$ 的估计量。使用 delta 方法，计算 $\\widehat{C}$ 的领头阶均值和方差，用 $C$ 和 $\\{E_i,\\sigma_i^{2}\\}$ 表示，并将其与忽略异方差性的 $\\theta$ 的未加权普通最小二乘估计量的相应结果进行对比。\n\n最后，定义应用全局修正 $\\widehat{C}$ 后的能量依赖响应函数 $R_{\\mathrm{corr}}(E)$ 为 $R_{\\mathrm{corr}}(E) = \\mathbb{E}[\\widehat{C}\\,E_{\\mathrm{raw}}/E_{\\mathrm{true}} \\mid E_{\\mathrm{true}}=E]$。以 $1/N$ 的领头阶量化偏差 $b(E) = R_{\\mathrm{corr}}(E) - 1$，用 $C$ 和 $\\{E_i,\\sigma_i^{2}\\}$ 表示，并解释在所述模型下它对 $E$ 的依赖关系。\n\n将最终估计量 $\\widehat{C}$ 表示为关于 $\\{E_i, E_{\\mathrm{raw},i}, \\sigma_i^{2}\\}$ 的闭式解析表达式。不需要进行数值计算。", "solution": "该问题要求推导和分析喷注能量刻度因子 $C$ 的最优估计量。分析分几步进行：推导估计量，证明其与最大似然估计量 (MLE) 的等价性，使用 delta 方法分析其统计特性，将其与一个更简单的估计量进行比较，最后量化修正后能量响应中的偏差。\n\n提供的模型是 $E_{\\mathrm{raw},i} = \\theta E_i + \\epsilon_i$，其中 $E_{\\mathrm{raw},i}$ 是测量得到的能量，$E_i$ 是真实能量，$\\theta = 1/C$ 是待估计的参数，$\\epsilon_i$ 是独立的误差项，满足 $\\mathbb{E}[\\epsilon_i] = 0$ 和已知的异方差方差 $\\operatorname{Var}(\\epsilon_i) = \\sigma_i^2$。\n\n**1. 最佳线性无偏估计量 (BLUE) 的推导**\n\n根据高斯-马尔可夫定理，对观测值 ($E_{\\mathrm{raw},i}$) 而言是线性的、无偏的且方差最小的估计量 (BLUE) 是广义最小二乘 (GLS) 估计量。对于误差不相关的异方差模型，这等价于加权最小二乘 (WLS) 估计量，它最小化加权残差平方和 $\\chi^2(\\theta)$：\n$$\n\\chi^2(\\theta) = \\sum_{i=1}^{N} w_i (E_{\\mathrm{raw},i} - \\theta E_i)^2\n$$\n产生最小方差估计量的最优权重 $w_i$ 是观测值方差的倒数，即 $w_i = 1/\\operatorname{Var}(E_{\\mathrm{raw},i})$。由于在此情景下 $E_i$ 和 $\\theta$ 是非随机的，$\\operatorname{Var}(E_{\\mathrm{raw},i}) = \\operatorname{Var}(\\theta E_i + \\epsilon_i) = \\operatorname{Var}(\\epsilon_i) = \\sigma_i^2$。因此，最优权重为 $w_i = 1/\\sigma_i^2$。\n\n我们通过最小化 $\\chi^2(\\theta)$ 关于 $\\theta$ 来找到估计量 $\\widehat{\\theta}$：\n$$\n\\frac{d\\chi^2}{d\\theta} = \\frac{d}{d\\theta} \\sum_{i=1}^{N} \\frac{(E_{\\mathrm{raw},i} - \\theta E_i)^2}{\\sigma_i^2} = \\sum_{i=1}^{N} \\frac{2(E_{\\mathrm{raw},i} - \\theta E_i)(-E_i)}{\\sigma_i^2} = 0\n$$\n$$\n\\sum_{i=1}^{N} \\frac{E_i E_{\\mathrm{raw},i}}{\\sigma_i^2} - \\theta \\sum_{i=1}^{N} \\frac{E_i^2}{\\sigma_i^2} = 0\n$$\n求解 $\\theta$ 得到 $\\theta$ 的 BLUE：\n$$\n\\widehat{\\theta} = \\frac{\\sum_{i=1}^{N} (E_i E_{\\mathrm{raw},i} / \\sigma_i^2)}{\\sum_{j=1}^{N} (E_j^2 / \\sigma_j^2)}\n$$\n\n**2. 与最大似然估计量 (MLE) 的等价性**\n\n问题陈述误差 $\\epsilon_i$ 服从高斯分布，即 $\\epsilon_i \\sim \\mathcal{N}(0, \\sigma_i^2)$。单个观测值 $(E_i, E_{\\mathrm{raw},i})$ 的似然函数为：\n$$\np(E_{\\mathrm{raw},i} | \\theta) = \\frac{1}{\\sqrt{2\\pi\\sigma_i^2}} \\exp\\left(-\\frac{(E_{\\mathrm{raw},i} - \\theta E_i)^2}{2\\sigma_i^2}\\right)\n$$\n对于包含 $N$ 个事例的完整独立样本，对数似然函数 $\\ln L(\\theta)$ 是各个对数似然之和：\n$$\n\\ln L(\\theta) = \\sum_{i=1}^{N} \\left( -\\frac{1}{2}\\ln(2\\pi\\sigma_i^2) - \\frac{(E_{\\mathrm{raw},i} - \\theta E_i)^2}{2\\sigma_i^2} \\right)\n$$\n为了找到 $\\theta$ 的 MLE，我们最大化 $\\ln L(\\theta)$。这等价于最小化依赖于 $\\theta$ 的项，即 $\\sum_{i=1}^{N} (E_{\\mathrm{raw},i} - \\theta E_i)^2 / (2\\sigma_i^2)$。这与 WLS 估计量的目标函数 $\\chi^2(\\theta)$ 最多相差一个常数因子。因此，$\\theta$ 的 MLE 与 BLUE 相同：$\\widehat{\\theta}_{\\mathrm{ML}} = \\widehat{\\theta}_{\\mathrm{BLUE}}$。\n\n**3. $C$ 的估计量及其性质**\n\n利用 MLE 的不变性（或通过简单变换），$C = 1/\\theta$ 的估计量为 $\\widehat{C} = 1/\\widehat{\\theta}$：\n$$\n\\widehat{C} = \\frac{\\sum_{j=1}^{N} (E_j^2 / \\sigma_j^2)}{\\sum_{i=1}^{N} (E_i E_{\\mathrm{raw},i} / \\sigma_i^2)}\n$$\n为分析 $\\widehat{C}$ 的性质，我们首先确定 $\\widehat{\\theta}$ 的均值和方差。\n$\\widehat{\\theta}$ 的期望值为：\n$$\n\\mathbb{E}[\\widehat{\\theta}] = \\mathbb{E}\\left[\\frac{\\sum_{i} E_i E_{\\mathrm{raw},i} / \\sigma_i^2}{\\sum_{j} E_j^2 / \\sigma_j^2}\\right] = \\frac{\\sum_{i} (E_i / \\sigma_i^2) \\mathbb{E}[E_{\\mathrm{raw},i}]}{\\sum_{j} E_j^2 / \\sigma_j^2} = \\frac{\\sum_{i} (E_i / \\sigma_i^2) (\\theta E_i)}{\\sum_{j} E_j^2 / \\sigma_j^2} = \\theta\n$$\n因此，$\\widehat{\\theta}$ 是 $\\theta$ 的无偏估计量。\n$\\widehat{\\theta}$ 的方差为：\n$$\n\\operatorname{Var}(\\widehat{\\theta}) = \\operatorname{Var}\\left(\\frac{\\sum_{i} E_i E_{\\mathrm{raw},i} / \\sigma_i^2}{\\sum_{j} E_j^2 / \\sigma_j^2}\\right) = \\frac{\\sum_{i} (E_i / \\sigma_i^2)^2 \\operatorname{Var}(E_{\\mathrm{raw},i})}{(\\sum_{j} E_j^2 / \\sigma_j^2)^2} = \\frac{\\sum_{i} E_i^2 / \\sigma_i^2}{(\\sum_{j} E_j^2 / \\sigma_j^2)^2} = \\frac{1}{\\sum_{j=1}^{N} E_j^2 / \\sigma_j^2}\n$$\n现在我们应用 delta 方法来求 $\\widehat{C} = g(\\widehat{\\theta}) = 1/\\widehat{\\theta}$ 的近似均值和方差。$g(\\theta)$ 在真值 $\\theta$ 处的导数为 $g'(\\theta) = -1/\\theta^2 = -C^2$ 和 $g''(\\theta) = 2/\\theta^3 = 2C^3$。\n$\\widehat{C}$ 的领头阶均值为：\n$$\n\\mathbb{E}[\\widehat{C}] \\approx g(\\mathbb{E}[\\widehat{\\theta}]) + \\frac{1}{2}g''(\\mathbb{E}[\\widehat{\\theta}])\\operatorname{Var}(\\widehat{\\theta}) = g(\\theta) + C^3 \\operatorname{Var}(\\widehat{\\theta}) = C + \\frac{C^3}{\\sum_{j=1}^{N} E_j^2 / \\sigma_j^2}\n$$\n这表明 $\\widehat{C}$ 是 $C$ 的一个有偏估计量，其正偏差的量级为 $1/N$。\n$\\widehat{C}$ 的领头阶方差为：\n$$\n\\operatorname{Var}(\\widehat{C}) \\approx \\left(g'(\\mathbb{E}[\\widehat{\\theta}])\\right)^2 \\operatorname{Var}(\\widehat{\\theta}) = (-C^2)^2 \\operatorname{Var}(\\widehat{\\theta}) = \\frac{C^4}{\\sum_{j=1}^{N} E_j^2 / \\sigma_j^2}\n$$\n\n**4. 与普通最小二乘 (OLS) 估计量的比较**\n\n$\\theta$ 的 OLS 估计量，记为 $\\widehat{\\theta}_{\\mathrm{OLS}}$，忽略了异方差性，实际上是设置权重 $w_i=1$。\n$$\n\\widehat{\\theta}_{\\mathrm{OLS}} = \\frac{\\sum_{i=1}^{N} E_i E_{\\mathrm{raw},i}}{\\sum_{j=1}^{N} E_j^2}\n$$\n这个估计量也是无偏的，$\\mathbb{E}[\\widehat{\\theta}_{\\mathrm{OLS}}] = \\theta$。然而，它的方差为：\n$$\n\\operatorname{Var}(\\widehat{\\theta}_{\\mathrm{OLS}}) = \\frac{\\sum_{i=1}^{N} E_i^2 \\operatorname{Var}(E_{\\mathrm{raw},i})}{(\\sum_{j=1}^{N} E_j^2)^2} = \\frac{\\sum_{i=1}^{N} E_i^2 \\sigma_i^2}{(\\sum_{j=1}^{N} E_j^2)^2}\n$$\n根据柯西-施瓦茨不等式，$(\\sum E_i^2)^2 \\le (\\sum E_i^2 \\sigma_i^2)(\\sum E_i^2/\\sigma_i^2)$，这意味着 $\\operatorname{Var}(\\widehat{\\theta}) \\le \\operatorname{Var}(\\widehat{\\theta}_{\\mathrm{OLS}})$。WLS 估计量 $\\widehat{\\theta}$ 更有效。相应的基于 OLS 的估计量 $\\widehat{C}_{\\mathrm{OLS}} = 1/\\widehat{\\theta}_{\\mathrm{OLS}}$ 的领头阶方差和偏差都将比 $\\widehat{C}$ 更大。\n\n**5. 修正后响应的偏差**\n\n修正后的响应函数定义为 $R_{\\mathrm{corr}}(E) = \\mathbb{E}[\\widehat{C}\\,E_{\\mathrm{raw}}/E_{\\mathrm{true}} \\mid E_{\\mathrm{true}}=E]$。期望是针对用于确定 $\\widehat{C}$ 的刻度样本和新的独立测量值 $E_{\\mathrm{raw}}$。由于 $\\widehat{C}$ 和 $E_{\\mathrm{raw}}$ 是独立的，我们可以分离期望：\n$$\nR_{\\mathrm{corr}}(E) = \\mathbb{E}[\\widehat{C}] \\cdot \\mathbb{E}\\left[\\frac{E_{\\mathrm{raw}}}{E_{\\mathrm{true}}} \\mid E_{\\mathrm{true}}=E\\right]\n$$\n第二项是 $\\mathbb{E}[(E/C + \\epsilon)/E] = (E/C)/E = 1/C$。\n因此，$R_{\\mathrm{corr}}(E) = \\mathbb{E}[\\widehat{C}]/C$。\n偏差为 $b(E) = R_{\\mathrm{corr}}(E) - 1 = \\mathbb{E}[\\widehat{C}]/C - 1$。\n使用 $\\mathbb{E}[\\widehat{C}]$ 的领头阶结果：\n$$\nb(E) \\approx \\frac{1}{C}\\left(C + \\frac{C^3}{\\sum_{j=1}^{N} E_j^2 / \\sigma_j^2}\\right) - 1 = 1 + \\frac{C^2}{\\sum_{j=1}^{N} E_j^2 / \\sigma_j^2} - 1 = \\frac{C^2}{\\sum_{j=1}^{N} E_j^2 / \\sigma_j^2}\n$$\n**解释：**在 $1/N$ 的领头阶上，偏差 $b(E)$ 是一个正常数，与被测喷注的能量 $E$ 无关。这意味着应用全局刻度因子 $\\widehat{C}$ 会导致对所有能量的喷注能量产生统一的分数性高估。这种偏差的来源是从无偏估计量 $\\widehat{\\theta}$到 $\\widehat{C}=1/\\widehat{\\theta}$ 的非线性变换。偏差的大小与样本对 $\\theta$ 的费雪信息（由 $\\sum E_j^2/\\sigma_j^2$ 表示）成反比。因此，更大的刻度样本容量 $N$、更高能量的噴注 $E_j$ 或更好的探测器分辨率（更小的 $\\sigma_j$）将减少这种刻度偏差。\n\n要求的最终结果是估计量 $\\widehat{C}$ 的闭式表达式。\n$$\n\\widehat{C} = \\frac{\\sum_{j=1}^{N} E_j^2 / \\sigma_j^2}{\\sum_{i=1}^{N} E_i E_{\\mathrm{raw},i} / \\sigma_i^2}\n$$", "answer": "$$\n\\boxed{\\frac{\\sum_{j=1}^{N} \\frac{E_j^2}{\\sigma_j^2}}{\\sum_{i=1}^{N} \\frac{E_i E_{\\mathrm{raw},i}}{\\sigma_i^2}}}\n$$", "id": "3519000"}, {"introduction": "最终的喷注能量修正不是一个单一的数字，而是伴随着一系列复杂的系统不确定性，这些不确定性在不同的喷注能量和位置之间常常是相关的。这个进阶练习演示了如何使用主成分分析（PCA）将一个复杂的不确定性协方差矩阵分解为一组正交、不相关的分量。掌握这项技术对于在物理分析中正确传递系统不确定性至关重要 [@problem_id:3518981]。", "problem": "考虑一个分箱的喷注能量尺度（JES）校准问题，其中，喷注响应在按赝快度和横向动量索引的分箱上的不确定度，被建模为一个均值为零、协方差矩阵为 $C$ 的多元高斯分布。目标是构建一个讨厌参数模板的正交基，该正交基能够再现 $C$ 并在高斯约束拟合中最小化相关性。使用主成分分析（PCA）处理 $C$ 以获得一组正交的特征向量和非负的特征值，并将讨厌参数模板定义为模板矩阵 $T$ 的列。\n\n从以下基本定义和事实出发：\n- 根据构造，实值随机向量的协方差矩阵 $C$ 是对称半正定的。\n- 主成分分析（PCA）通过 $C = E \\Lambda E^\\top$ 将对称半正定矩阵 $C$ 对角化，其中 $E$ 是由标准正交的特征向量组成的列矩阵，$\\Lambda$ 是按降序排列的特征值组成的对角矩阵。\n- 在具有先验协方差 $C$ 的高斯约束线性拟合中，关于由 $C^{-1}$ 导出的度量正交的讨厌参数模板可以最小化参数相关性。\n\n数学推导如何从 $C$ 的 PCA 构建模板矩阵 $T$，以满足：\n- 协方差能被模板的外积精确再现，即 $C = T T^\\top$。\n- 模板关于 $C^{-1}$ 度量是标准正交的，即 $T^\\top C^{-1} T = I$，其中 $I$ 是单位矩阵。\n\n然后，实现一个程序，对每个提供的测试协方差矩阵：\n- 执行 PCA 以获得特征值 $\\{\\lambda_i\\}$ 和相应的标准正交特征向量 $\\{e_i\\}$，并按 $\\lambda_1 \\ge \\lambda_2 \\ge \\cdots$ 的顺序排列。\n- 构建模板矩阵 $T$，其列为 $t_i = \\sqrt{\\lambda_i}\\, e_i$。\n- 计算以下三个标量诊断量：\n  1. $m_1$：$G = T^\\top C^{-1} T$ 的最大绝对非对角元素。\n  2. $m_2$：相对弗罗贝尼乌斯重构误差，$m_2 = \\dfrac{\\lVert C - T T^\\top \\rVert_F}{\\lVert C \\rVert_F}$。\n  3. $m_3$：首个主成分解释的总方差比例，$m_3 = \\dfrac{\\lambda_1}{\\operatorname{tr}(C)}$。\n\n所有量都是无量纲的，因此不需要物理单位。不涉及角度。分数必须表示为小数。\n\n测试套件：\n使用以下三个协方差矩阵作为测试套件。每个 $C^{(k)}$ 都是对称正定的，其元素已明确给出。\n\n- 测试用例 1：\n$$\nC^{(1)} =\n\\begin{pmatrix}\n0.04  0.018  0  0 \\\\\n0.018  0.09  0  0 \\\\\n0  0  0.0225  0.015 \\\\\n0  0  0.015  0.04\n\\end{pmatrix}.\n$$\n\n- 测试用例 2：\n$$\nC^{(2)} =\n\\begin{pmatrix}\n0.02001  0.016  0.012  0.008  0.004 \\\\\n0.016  0.02281  0.0096  0.0164  0.0032 \\\\\n0.012  0.0096  0.00721  0.0048  0.0024 \\\\\n0.008  0.0164  0.0048  0.01321  0.0016 \\\\\n0.004  0.0032  0.0024  0.0016  0.00081\n\\end{pmatrix}.\n$$\n\n- 测试用例 3：\n$$\nC^{(3)} =\n\\begin{pmatrix}\n0.01  0  0 \\\\\n0  0.04  0 \\\\\n0  0  0.09\n\\end{pmatrix}.\n$$\n\n答案规格：\n- 对于每个测试用例 $k \\in \\{1,2,3\\}$，计算如上定义的 $(m_1^{(k)}, m_2^{(k)}, m_3^{(k)})$。\n- 您的程序应生成单行输出，其中包含九个浮点数结果，并按以下固定顺序以逗号分隔列表的形式置于方括号内：\n$[m_1^{(1)}, m_2^{(1)}, m_3^{(1)}, m_1^{(2)}, m_2^{(2)}, m_3^{(2)}, m_1^{(3)}, m_2^{(3)}, m_3^{(3)}]$。\n- 每个浮点数应四舍五入到 $6$ 位小数。", "solution": "用户提供的问题已经过分析，并被判定为**有效**。该问题具有科学依据、问题明确、客观，并包含得出完整解所需的所有信息。\n\n问题包括两部分：数学推导和计算实现。\n\n### 第 1 部分：数学推导\n\n目标是根据协方差矩阵 $C$ 的主成分分析（PCA）构建一个模板矩阵 $T$，使得满足两个条件：\n1. 协方差被完美再现：$C = T T^\\top$。\n2. 模板关于由 $C^{-1}$ 导出的度量是标准正交的：$T^\\top C^{-1} T = I$。\n\n设 $C$ 为一个 $n \\times n$ 的实对称半正定协方差矩阵。谱定理保证 $C$ 可以被一个正交矩阵对角化。这是 PCA 的基础。其分解形式为：\n$$C = E \\Lambda E^\\top$$\n其中：\n- $E$ 是一个 $n \\times n$ 的正交矩阵，其列 $e_i$ 是 $C$ 的标准正交特征向量。正交性条件意味着 $E^\\top E = E E^\\top = I$，其中 $I$ 是 $n \\times n$ 的单位矩阵。\n- $\\Lambda$ 是一个 $n \\times n$ 的对角矩阵，包含与特征向量 $e_i$ 对应的 $C$ 的实数、非负特征值 $\\lambda_i$。我们假设它们按降序排列，$\\lambda_1 \\ge \\lambda_2 \\ge \\dots \\ge \\lambda_n \\ge 0$。\n$$\\Lambda = \\operatorname{diag}(\\lambda_1, \\lambda_2, \\dots, \\lambda_n)$$\n\n问题将讨厌参数模板 $t_i$ 定义为模板矩阵 $T$ 的列。其构造方式为 $t_i = \\sqrt{\\lambda_i} \\, e_i$。以矩阵形式可以表示为：\n$$T = E \\Lambda^{1/2}$$\n其中 $\\Lambda^{1/2}$ 是一个对角矩阵，其对角线元素为 $\\sqrt{\\lambda_i}$：\n$$\\Lambda^{1/2} = \\operatorname{diag}(\\sqrt{\\lambda_1}, \\sqrt{\\lambda_2}, \\dots, \\sqrt{\\lambda_n})$$\n\n我们现在将验证这种 $T$ 的构造方式满足两个所需条件。\n\n**条件 1：协方差再现 ($C = T T^\\top$)**\n\n我们使用 $T$ 的矩阵形式计算外积 $T T^\\top$：\n$$T T^\\top = (E \\Lambda^{1/2}) (E \\Lambda^{1/2})^\\top$$\n利用乘积转置的性质 $(AB)^\\top = B^\\top A^\\top$，我们得到：\n$$T T^\\top = (E \\Lambda^{1/2}) ((\\Lambda^{1/2})^\\top E^\\top)$$\n由于 $\\Lambda^{1/2}$ 是一个对角矩阵，它是对称的，所以 $(\\Lambda^{1/2})^\\top = \\Lambda^{1/2}$。表达式变为：\n$$T T^\\top = E \\Lambda^{1/2} \\Lambda^{1/2} E^\\top = E \\Lambda E^\\top$$\n从最初的 PCA 分解，我们知道 $E \\Lambda E^\\top = C$。因此，我们证明了：\n$$C = T T^\\top$$\n这表明协方差矩阵被精确再现。\n\n**条件 2：标准正交性 ($T^\\top C^{-1} T = I$)**\n\n为了验证这个条件，我们首先需要协方差矩阵的逆 $C^{-1}$ 的表达式。问题陈述指明测试矩阵是正定的，这意味着所有特征值 $\\lambda_i$ 都是严格为正的，因此 $C$ 是可逆的。\n从 $C = E \\Lambda E^\\top$ 出发，我们可以求其逆：\n$$C^{-1} = (E \\Lambda E^\\top)^{-1} = (E^\\top)^{-1} \\Lambda^{-1} E^{-1}$$\n因为 $E$ 是一个正交矩阵，它的逆是它的转置，$E^{-1} = E^\\top$。因此，$(E^\\top)^{-1} = (E^{-1})^{-1} = E$。对角矩阵 $\\Lambda$ 的逆是 $\\Lambda^{-1} = \\operatorname{diag}(1/\\lambda_1, 1/\\lambda_2, \\dots, 1/\\lambda_n)$。\n将这些代入 $C^{-1}$ 的表达式中，我们得到：\n$$C^{-1} = E \\Lambda^{-1} E^\\top$$\n现在，我们可以将 $T$、$T^\\top$ 和 $C^{-1}$ 的表达式代入 $T^\\top C^{-1} T$ 中：\n$$T^\\top C^{-1} T = (E \\Lambda^{1/2})^\\top (E \\Lambda^{-1} E^\\top) (E \\Lambda^{1/2})$$\n展开第一个转置并组合各项：\n$$T^\\top C^{-1} T = (\\Lambda^{1/2} E^\\top) (E \\Lambda^{-1} E^\\top) (E \\Lambda^{1/2}) = \\Lambda^{1/2} (E^\\top E) \\Lambda^{-1} (E^\\top E) \\Lambda^{1/2}$$\n利用正交性 $E^\\top E = I$：\n$$T^\\top C^{-1} T = \\Lambda^{1/2} I \\Lambda^{-1} I \\Lambda^{1/2} = \\Lambda^{1/2} \\Lambda^{-1} \\Lambda^{1/2}$$\n由于对角矩阵可交换，$\\Lambda$ 的幂的乘积为：\n$$\\Lambda^{1/2} \\Lambda^{-1} \\Lambda^{1/2} = \\Lambda^{1/2 - 1 + 1/2} = \\Lambda^0 = I$$\n因此，我们证明了：\n$$T^\\top C^{-1} T = I$$\n这证实了由 $t_i = \\sqrt{\\lambda_i} e_i$ 定义的模板关于度量 $C^{-1}$ 是标准正交的。\n\n### 第 2 部分：计算实现\n\n该实现遵循上述推导。对于每个测试协方差矩阵 $C^{(k)}$，算法如下：\n\n1.  **$C$ 的 PCA**：我们使用数值例程对对称矩阵 $C$ 进行特征分解。`numpy.linalg.eigh` 是理想的选择，因为它针对对称/厄米矩阵进行了优化，并保证了实特征值和标准正交的特征向量基。该函数返回升序排列的特征值，因此需要将它们及其对应的特征向量重新排序为降序，以符合 $\\lambda_1 \\ge \\lambda_2 \\ge \\dots$ 的约定。\n\n2.  **构造 $T$**：模板矩阵 $T$ 的列由 $t_i = \\sqrt{\\lambda_i} e_i$ 构成。在计算上，这是通过创建一个其列为排序后的特征向量 $e_i$ 的矩阵，然后将每列乘以相应的 $\\sqrt{\\lambda_i}$ 来实现的。\n\n3.  **计算诊断量**：\n    - $m_1$：计算矩阵 $G = T^\\top C^{-1} T$。理论上，$G$ 是单位矩阵 $I$。由于浮点精度限制，其非对角元素将是小的非零数。$m_1$ 是这些非对角元素的最大绝对值。\n    - $m_2$：计算重构 $T T^\\top$。理论上，它等于 $C$。相对弗罗贝尼乌斯重构误差 $m_2 = \\frac{\\lVert C - T T^\\top \\rVert_F}{\\lVert C \\rVert_F}$ 量化了数值偏差。$\\lVert A \\rVert_F = \\sqrt{\\sum_{i,j} |a_{ij}|^2}$ 是弗罗贝尼乌斯范数。\n    - $m_3$：由第一个主成分解释的总方差比例计算为 $m_3 = \\frac{\\lambda_1}{\\operatorname{tr}(C)}$。$C$ 的迹 $\\operatorname{tr}(C)$ 是其对角元素之和，也等于其特征值之和，代表系统中的总方差。\n\n代码将遍历三个提供的测试矩阵，为每个矩阵计算 $(m_1^{(k)}, m_2^{(k)}, m_3^{(k)})$，并将最终结果格式化为单个逗号分隔的列表。", "answer": "[0.000000,0.000000,0.524215,0.000000,0.000000,0.890695,0.000000,0.000000,0.642857]", "id": "3518981"}]}