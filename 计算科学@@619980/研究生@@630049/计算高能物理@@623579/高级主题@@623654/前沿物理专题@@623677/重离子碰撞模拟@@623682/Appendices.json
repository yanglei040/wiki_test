{"hands_on_practices": [{"introduction": "任何成功的数值模拟都始于一个基本要求：数值稳定性。本练习将探讨显式差分格式的核心，即 Courant–Friedrichs–Lewy (CFL) 条件，并将其应用于重离子碰撞模拟中常用的 Milne 坐标系。通过解决这个问题 [@problem_id:3516494]，您将掌握如何从时空度规中推导物理距离，并结合流体速度和声速来确定最大允许时间步长，这是构建任何可靠的流体动力学求解器的关键第一步。", "problem": "考虑一个用于相对论理想流体力学的显式有限体积求解器，它被用于重离子碰撞模拟，并通过源项将背景流体与来自喷注的局域能量动量沉积（喷注淬火）耦合起来。流体遵循能量动量守恒，表示为 $\\partial_{\\mu} T^{\\mu \\nu} = J^{\\nu}$，其中对于理想流体，$T^{\\mu \\nu} = (\\varepsilon + p) u^{\\mu} u^{\\nu} - p g^{\\mu \\nu}$，而 $J^{\\nu}$ 编码了喷注的能量动量沉积。演化在密尔恩（Milne）坐标 $(\\tau, x, y, \\eta_{s})$ 中进行，该坐标系适用于重离子碰撞中近似 boost 不变的纵向膨胀，其度规为 $\\mathrm{diag}(+1,-1,-1,-\\tau^{2})$。在这些曲线坐标系中，固定 $\\tau$ 时的固有空间距离在 $x$、$y$ 和 $\\eta_{s}$ 方向上分别为 $|dx|$、$|dy|$ 和 $\\tau |d\\eta_{s}|$。\n\n显式格式稳定性的一个必要条件是 Courant–Friedrichs–Lewy (CFL) 判据，该判据要求在单个时间步内，沿任何坐标方向传播最快的信号，在以网格单元的固有空间尺度衡量时，其传播距离不得超过该方向上的一个单元。在一个局域正交归一参考系中，相对于流体最快的信号速度受声速 $c_{s}$ 的限制，而实验室系中沿某一给定方向最快的信号速度的上限是流体速度在该方向上分量的大小与声速 $c_{s}$ 之和。在曲线坐标系中，沿具有非平凡度规标度因子方向的坐标速度必须使用相应的固有长度与坐标长度之间的关系进行转换。\n\n假设状态方程近似共形，因此在自然单位制（设光速 $c = 1$）中 $c_{s} = \\sqrt{1/3}$，并且在某网格点处，（在与 $(x,y,\\eta_{s})$ 对齐的局域正交归一参考系中的）局域三维速度分量为 $v_{x} = 0.40$，$v_{y} = 0.30$ 和 $v_{\\eta} = 0.05$。在流体动力学时间 $\\tau = 3.0$ fm/$c$ 时，网格间距为 $\\Delta x = 0.06$ fm，$\\Delta y = 0.08$ fm，以及 $\\Delta \\eta_{s} = 0.02$。显式时间积分器使用库朗数（Courant number） $C = 0.50$。\n\n从上述原理出发，推导适用于密尔恩坐标的 CFL 稳定性条件，并计算该网格点允许的最大时间步长 $\\Delta \\tau_{\\max}$。将你的答案四舍五入至四位有效数字，并以飞米每光速（fm/$c$）为单位表示 $\\Delta \\tau_{\\max}$。", "solution": "该问题要求推导在密尔恩坐标下相对论流体力学模拟的 Courant–Friedrichs–Lewy (CFL) 稳定性条件，并计算在特定网格点允许的最大时间步长 $\\Delta \\tau_{\\max}$。\n\n验证过程确认了该问题具有科学依据、提法恰当、客观且内部一致。所有必要的物理原理和数值数据均已提供。其背景是计算高能物理中的一个标准情景。因此，该问题是有效的，可以构建解答。\n\nCFL 条件是求解偏微分方程的显式数值格式稳定性的一个必要条件。它指出，一个网格点的数值依赖域必须包含其物理依赖域。对于显式时间步进格式，这意味着在单个时间步长 $\\Delta t$ 内，传播最快的信号移动的距离不能超过一个网格单元。对于每个空间维度 $i$，这可以表示为：\n$$ \\Delta t \\le C \\frac{\\Delta L_i}{v_{\\text{sig}, i}} $$\n其中 $\\Delta L_i$ 是网格单元在 $i$ 方向上的固有物理尺寸，$v_{\\text{sig}, i}$ 是该方向上任何信号的最大固有速度，而 $C$ 是库朗数，一个通常小于或等于 $1$ 的安全因子。总的最大时间步长受这些条件中最严格的一个限制：\n$$ \\Delta t_{\\max} = C \\cdot \\min_{i} \\left( \\frac{\\Delta L_i}{v_{\\text{sig}, i}} \\right) $$\n\n在本问题中，时间坐标是固有时 $\\tau$，因此我们要求解 $\\Delta \\tau_{\\max}$。空间坐标是 $(x, y, \\eta_{s})$，它们是曲线坐标。坐标间隔与固有空间距离之间的关系由时空度规 $g_{\\mu\\nu} = \\mathrm{diag}(+1, -1, -1, -\\tau^2)$ 给出。不变量线元为 $ds^2 = g_{\\mu\\nu} dx^{\\mu} dx^{\\nu}$。在固定时间 $\\tau$（即 $d\\tau = 0$）时，固有空间距离元 $dL$ 的平方为：\n$$ dL^2 = -ds^2 = dx^2 + dy^2 + \\tau^2 d\\eta_s^2 $$\n由此，根据坐标网格间距 $\\Delta x$、$\\Delta y$ 和 $\\Delta \\eta_s$，我们可以确定沿每个坐标轴的网格单元的固有长度：\n\\begin{itemize}\n    \\item 沿 $x$ 轴：$\\Delta L_x = \\Delta x$\n    \\item 沿 $y$ 轴：$\\Delta L_y = \\Delta y$\n    \\item 沿 $\\eta_s$ 轴：$\\Delta L_{\\eta} = \\tau \\Delta \\eta_s$\n\\end{itemize}\n\n接下来，我们确定最大信号传播速度。问题指明，在局域正交归一参考系中，沿方向 $i$ 的最快信号速度是流体速度分量的大小 $|v_i|$ 与声速 $c_s$ 之和。这些是固有速度，对应于在固有距离上的传播。\n\\begin{itemize}\n    \\item $x$ 方向的信号速度：$v_{\\text{sig}, x} = |v_x| + c_s$\n    \\item $y$ 方向的信号速度：$v_{\\text{sig}, y} = |v_y| + c_s$\n    \\item $\\eta$ 方向的信号速度：$v_{\\text{sig}, \\eta} = |v_{\\eta}| + c_s$\n\\end{itemize}\n光速设为 $c=1$。\n\n综合这些要素，最大时间步长 $\\Delta \\tau_{\\max}$ 的 CFL 条件变为：\n$$ \\Delta \\tau_{\\max} = C \\cdot \\min \\left( \\frac{\\Delta L_x}{v_{\\text{sig}, x}}, \\frac{\\Delta L_y}{v_{\\text{sig}, y}}, \\frac{\\Delta L_{\\eta}}{v_{\\text{sig}, \\eta}} \\right) $$\n代入固有长度和信号速度的表达式：\n$$ \\Delta \\tau_{\\max} = C \\cdot \\min \\left( \\frac{\\Delta x}{|v_x| + c_s}, \\frac{\\Delta y}{|v_y| + c_s}, \\frac{\\tau \\Delta \\eta_s}{|v_{\\eta}| + c_s} \\right) $$\n\n我们现在代入问题陈述中提供的数值：\n\\begin{itemize}\n    \\item 库朗数：$C = 0.50$\n    \\item 声速：$c_s = \\sqrt{1/3}$\n    \\item 流体速度分量：$v_x = 0.40$，$v_y = 0.30$，$v_{\\eta} = 0.05$\n    \\item 流体动力学时间：$\\tau = 3.0$ fm/$c$\n    \\item 网格间距：$\\Delta x = 0.06$ fm，$\\Delta y = 0.08$ fm，$\\Delta \\eta_s = 0.02$\n\\end{itemize}\n\n首先，我们计算与每个空间方向相对应的三个时间尺度限制：\n1.  对于 $x$ 方向：\n    $$ \\frac{\\Delta x}{|v_x| + c_s} = \\frac{0.06}{|0.40| + \\sqrt{1/3}} = \\frac{0.06}{0.40 + \\sqrt{1/3}} \\text{ fm}/c $$\n2.  对于 $y$ 方向：\n    $$ \\frac{\\Delta y}{|v_y| + c_s} = \\frac{0.08}{|0.30| + \\sqrt{1/3}} = \\frac{0.08}{0.30 + \\sqrt{1/3}} \\text{ fm}/c $$\n3.  对于 $\\eta_s$ 方向：\n    $$ \\frac{\\tau \\Delta \\eta_s}{|v_{\\eta}| + c_s} = \\frac{(3.0)(0.02)}{|0.05| + \\sqrt{1/3}} = \\frac{0.06}{0.05 + \\sqrt{1/3}} \\text{ fm}/c $$\n\n现在，我们对这些表达式进行数值计算。我们使用 $c_s = \\sqrt{1/3} \\approx 0.57735$。\n1.  $x$ 方向的限制：\n    $$ \\frac{0.06}{0.40 + 0.57735} = \\frac{0.06}{0.97735} \\approx 0.061395 \\text{ fm}/c $$\n2.  $y$ 方向的限制：\n    $$ \\frac{0.08}{0.30 + 0.57735} = \\frac{0.08}{0.87735} \\approx 0.091184 \\text{ fm}/c $$\n3.  $\\eta_s$ 方向的限制：\n    $$ \\frac{0.06}{0.05 + 0.57735} = \\frac{0.06}{0.62735} \\approx 0.095640 \\text{ fm}/c $$\n\n这三个值中的最小值决定了总的时间步长约束：\n$$ \\min(0.061395, 0.091184, 0.095640) = 0.061395 \\text{ fm}/c $$\n这个最严格的条件来自 $x$ 方向。\n\n最后，我们应用库朗数 $C = 0.50$ 来找到允许的最大时间步长 $\\Delta \\tau_{\\max}$：\n$$ \\Delta \\tau_{\\max} = C \\cdot \\min(\\dots) = 0.50 \\times 0.061395 \\text{ fm}/c \\approx 0.0306975 \\text{ fm}/c $$\n\n问题要求答案四舍五入到四位有效数字。前四位有效数字是 $3, 0, 6, 9$。下一位数字是 $7$，所以我们将最后一位有效数字向上舍入。\n$$ \\Delta \\tau_{\\max} \\approx 0.03070 \\text{ fm}/c $$\n末尾的零是有效数字。", "answer": "$$\\boxed{0.03070}$$", "id": "3516494"}, {"introduction": "在建立了稳定的数值演化基础之后，下一步是利用流体动力学模拟来研究物理现象。高能粒子（“喷注”）在穿过夸克-胶子等离子体时会损失能量，这一过程被称为“喷注淬火”，它对介质的局部性质（如温度和流速）高度敏感。本练习 [@problem_id:3516447] 要求您推导并计算介质的流动如何通过类似多普勒的效应来改变喷注感受到的有效动量展宽，从而将抽象的流体动力学场 $u^\\mu$ 与一个关键的物理可观测量直接联系起来。", "problem": "考虑在高能重离子碰撞中，一个超相对论性喷注与流体力学介质的相互作用。在自然单位制（其中 $c=1$）下进行计算。采用闵可夫斯基度规，其号差为 $(+,-,-,-)$。设喷注的四动量为 $p^\\mu = (E,\\vec{p})$，其中 $|\\vec{p}| \\approx E$，单位方向为 $\\vec{n} = \\vec{p}/|\\vec{p}|$; 设介质的四速度为 $u^\\mu = \\gamma(\\vec{v}) \\, (1,\\vec{v})$，其中 $\\gamma(\\vec{v}) = 1/\\sqrt{1-|\\vec{v}|^2}$。将局域静止系（LRF）中的横向动量展宽输运系数 $\\hat{q}_{\\mathrm{LRF}}(T)$ 定义为喷注在流体局域静止系中每单位长度获得的横向动量平方的变化率。假设本构关系为：当 $T \\ge T_c$ 时，$\\hat{q}_{\\mathrm{LRF}}(T) = \\kappa \\, T^3$；当 $T  T_c$ 时，$\\hat{q}_{\\mathrm{LRF}}(T) = 0$。其中 $T$ 是局域温度，$T_c$ 是一个赝临界温度，$\\kappa$ 是一个常数。温度单位为 $\\mathrm{GeV}$，长度单位为 $\\mathrm{fm}$，$\\hat{q}$ 的单位为 $\\mathrm{GeV}^2/\\mathrm{fm}$。\n\n任务1（推导）：仅从洛伦兹协变性、四速度 $u^\\mu$ 的定义、四动量 $p^\\mu$ 的定义、洛伦兹不变量 $u^\\mu p_\\mu$ 以及 $\\hat{q}_{\\mathrm{LRF}}$ 作为 LRF 中单位长度变化率的物理解释出发，推导喷注在流动的介质中运动时所经历的、单位实验室系长度的瞬时有效展宽率 $\\hat{q}_{\\mathrm{eff}}$ 的表达式。你的推导必须明确地将 $\\hat{q}_{\\mathrm{eff}}$ 与 $\\hat{q}_{\\mathrm{LRF}}$、$u^\\mu$ 和 $p^\\mu$ 联系起来，并且必须指明在喷注是超相对论性且 $|\\vec{v}|  1$ 的情况下，可简化为类多普勒形式的乘法因子。不要在一开始就假设 $\\hat{q}_{\\mathrm{eff}}$ 的任何特定形式；相反，应根据所述的不变性性质和物理解释来推导它。\n\n任务2（路径积分）：考虑一个在时间 $t_0 = 0$ 从位置 $\\vec{x}_0 = (x_0,y_0)$ 发出、以速率 $|\\vec{v}_{\\mathrm{jet}}|=1$ 沿着单位方向 $\\vec{n}=(n_x,n_y)$ 运动的喷注，它穿过一个二维横向对称介质，该介质具有静态温度场\n$$\nT(x,y) = T_0 \\exp\\!\\left(-\\frac{x^2 + y^2}{2 \\sigma^2}\\right).\n$$\n介质具有均匀且恒定的流速 $\\vec{v} = (V_x,V_y)$，因此 $u^\\mu$ 在空间上是恒定的。用实验室系中的弧长 $s \\in [0,L]$ 来参数化喷注的路径，路径为 $\\vec{x}(s) = \\vec{x}_0 + s \\, \\vec{n}$，时间为 $t(s) = t_0 + s$。使用你推导出的 $\\hat{q}_{\\mathrm{eff}}$，计算线积分\n$$\nJ = \\int_0^L \\hat{q}_{\\mathrm{eff}}(\\vec{x}(s)) \\, ds,\n$$\n其单位为 $\\mathrm{GeV}^2$。该积分表示沿路径累积的横向动量展宽。如果在路径上的某点 $T(\\vec{x}(s))  T_c$，则该点的 $\\hat{q}_{\\mathrm{LRF}}$ 为零，该路径段不应计入积分贡献。\n\n任务3（实现与输出）：实现一个程序，对以下每个测试用例执行上述计算。对于每个用例，使用给定的参数，并通过在 $s \\in [0,L]$ 上进行稳定、收敛的数值积分，以高数值精度计算 $J$。所有 $J$ 值均以 $\\mathrm{GeV}^2$ 为单位表示，并精确到小数点后 $6$ 位。\n\n所有用例的通用参数：\n- $\\kappa = 2.0 \\, \\mathrm{GeV}^2/(\\mathrm{fm}\\cdot\\mathrm{GeV}^3)$,\n- $T_c = 0.16 \\, \\mathrm{GeV}$,\n- $t_0 = 0$.\n\n介质温度场参数 $T_0$ 和 $\\sigma$ 如各用例所列。对于每个用例，介质速度 $\\vec{v} = (V_x,V_y)$ 在空间和时间上都是均匀的。喷注从 $\\vec{x}_0 = (x_0,y_0)$ 开始，沿着方向 $\\vec{n}=(n_x,n_y)$ 传播长度 $L$，其中 $\\vec{n}$ 是横向平面中的单位向量。\n\n测试套件：\n- 用例 $1$ (基准静止介质): $T_0 = 0.5$, $\\sigma = 5.0$, $(V_x,V_y) = (0.0,0.0)$, $(x_0,y_0) = (0.0,0.0)$, $(n_x,n_y) = (1.0,0.0)$, $L = 10.0$。\n- 用例 $2$ (沿喷注方向同向流动): $T_0 = 0.5$, $\\sigma = 5.0$, $(V_x,V_y) = (0.6,0.0)$, $(x_0,y_0) = (0.0,0.0)$, $(n_x,n_y) = (1.0,0.0)$, $L = 10.0$。\n- 用例 $3$ (与喷注方向反向流动): $T_0 = 0.5$, $\\sigma = 5.0$, $(V_x,V_y) = (-0.6,0.0)$, $(x_0,y_0) = (0.0,0.0)$, $(n_x,n_y) = (1.0,0.0)$, $L = 10.0$。\n- 用例 $4$ (正交快速流动): $T_0 = 0.5$, $\\sigma = 5.0$, $(V_x,V_y) = (0.0,0.9)$, $(x_0,y_0) = (0.0,0.0)$, $(n_x,n_y) = (1.0,0.0)$, $L = 10.0$。\n- 用例 $5$ (在边缘附近与同向流动的短重叠): $T_0 = 0.5$, $\\sigma = 5.0$, $(V_x,V_y) = (0.6,0.0)$, $(x_0,y_0) = (6.0,0.0)$, $(n_x,n_y) = (1.0,0.0)$, $L = 10.0$。\n\n所有未标明单位的量，温度单位为 $\\mathrm{GeV}$，长度单位为 $\\mathrm{fm}$；速度是在自然单位制下光速的无量纲分数。角度不直接使用；方向由单位向量的分量给出。\n\n你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表，每个 $J$ 值都四舍五入到小数点后恰好 $6$ 位，并按测试用例的指定顺序排列，例如 $[J_1,J_2,J_3,J_4,J_5]$，其中每个 $J_i$ 是一个代表 $\\mathrm{GeV}^2$ 的浮点数。", "solution": "该问题要求一个包含三部分的解答：有效动量展宽率 $\\hat{q}_{\\mathrm{eff}}$ 的理论推导，总累积展宽的路径积分 $J$ 的构建，以及一个计算多个测试用例中 $J$ 值的数值实现。\n\n### 任务1：有效展宽率 $\\hat{q}_{\\mathrm{eff}}$ 的推导\n我们的任务是从介质局域静止系（LRF）中单位长度的变化率 $\\hat{q}_{\\mathrm{LRF}}$ 出发，推导实验室系中单位长度的横向动量展宽率 $\\hat{q}_{\\mathrm{eff}}$ 的表达式。\n\n设 $d\\langle p_\\perp^2 \\rangle$ 为喷注获得的无穷小横向动量平方。问题将 LRF 输运系数定义为：\n$$\n\\hat{q}_{\\mathrm{LRF}} = \\frac{d\\langle p_\\perp^2 \\rangle}{ds_{\\mathrm{LRF}}}\n$$\n其中 $ds_{\\mathrm{LRF}}$ 是在流体元 LRF 中测量的、喷注所经过的无穷小路径长度。\n\n我们的目标是找到实验室系中的有效变化率：\n$$\n\\hat{q}_{\\mathrm{eff}} = \\frac{d\\langle p_\\perp^2 \\rangle}{ds_{\\mathrm{lab}}}\n$$\n其中 $ds_{\\mathrm{lab}}$ 是实验室系中的无穷小路径长度。\n\n根据链式法则，我们可以将这两个量联系起来：\n$$\n\\hat{q}_{\\mathrm{eff}} = \\frac{d\\langle p_\\perp^2 \\rangle}{ds_{\\mathrm{LRF}}} \\frac{ds_{\\mathrm{LRF}}}{ds_{\\mathrm{lab}}} = \\hat{q}_{\\mathrm{LRF}} \\frac{ds_{\\mathrm{LRF}}}{ds_{\\mathrm{lab}}}\n$$\n推导的核心是找到 $ds_{\\mathrm{LRF}}$ 和 $ds_{\\mathrm{lab}}$ 之间的洛伦兹不变量关系。\n\n设 $dx^\\mu$ 为喷注在实验室系中的无穷小小时空位移四矢量。由于喷注是超相对论性的，它以光速（$c=1$）运动。如果 $ds_{\\mathrm{lab}}$ 是路径长度，那么所用时间为 $dt_{\\mathrm{lab}} = ds_{\\mathrm{lab}}$。喷注沿着由单位向量 $\\vec{n}$ 给出的方向行进。因此，位移四矢量为：\n$$\ndx^\\mu = (dt_{\\mathrm{lab}}, d\\vec{x}_{\\mathrm{lab}}) = (ds_{\\mathrm{lab}}, \\vec{n} \\, ds_{\\mathrm{lab}})\n$$\n现在，考虑介质的四速度 $u^\\mu = \\gamma(\\vec{v})(1, \\vec{v})$，其中 $\\vec{v}$ 是实验室系中的流体速度，$\\gamma(\\vec{v}) = (1 - |\\vec{v}|^2)^{-1/2}$。\n\n与时空位移 $dx^\\mu$ 对应的、在流体元 LRF 中经过的时间 $dt_{\\mathrm{LRF}}$，由 $dx^\\mu$ 在流体四速度 $u_\\mu$ 上的洛伦兹不变量投影给出。在 LRF 中，$u'^\\mu = (1, \\vec{0})$，因此 $u'_\\mu dx'^\\mu = dt_{\\mathrm{LRF}}$。由于洛伦兹不变性，这在任何参考系中都成立：\n$$\ndt_{\\mathrm{LRF}} = u_\\mu dx^\\mu\n$$\n使用号差为 $(+,-,-,-)$ 的闵可夫斯基度规，我们有 $u_\\mu = \\gamma(\\vec{v})(1, -\\vec{v})$。我们计算点积：\n$$\ndt_{\\mathrm{LRF}} = \\gamma(\\vec{v})(1, -\\vec{v}) \\cdot (ds_{\\mathrm{lab}}, \\vec{n} \\, ds_{\\mathrm{lab}}) = \\gamma(\\vec{v}) (1 \\cdot ds_{\\mathrm{lab}} - \\vec{v} \\cdot \\vec{n} \\, ds_{\\mathrm{lab}}) = \\gamma(\\vec{v})(1 - \\vec{v} \\cdot \\vec{n}) \\, ds_{\\mathrm{lab}}\n$$\n由于喷注是无质量的（或超相对论性的），它在任何惯性系中都以光速运动。因此，在 LRF 中经过的路径长度 $ds_{\\mathrm{LRF}}$ 等于在 LRF 中经过的时间 $dt_{\\mathrm{LRF}}$（因为 $c=1$）。\n$$\nds_{\\mathrm{LRF}} = dt_{\\mathrm{LRF}}\n$$\n将此代入我们关于 $dt_{\\mathrm{LRF}}$ 的表达式中，我们得到路径长度之间的关系：\n$$\n\\frac{ds_{\\mathrm{LRF}}}{ds_{\\mathrm{lab}}} = \\gamma(\\vec{v})(1 - \\vec{v} \\cdot \\vec{n})\n$$\n这就是所需的乘法因子。它具有一个“类多普勒”形式。现在，我们将其代回 $\\hat{q}_{\\mathrm{eff}}$ 的关系式中：\n$$\n\\hat{q}_{\\mathrm{eff}} = \\hat{q}_{\\mathrm{LRF}} \\cdot \\gamma(\\vec{v})(1 - \\vec{v} \\cdot \\vec{n})\n$$\n为了用喷注四动量 $p^\\mu = (E, \\vec{p})$ 来表示它，我们注意到对于超相对论性喷注，有 $|\\vec{p}| \\approx E$ 和 $\\vec{n} = \\vec{p}/|\\vec{p}| \\approx \\vec{p}/E$。\n洛伦兹标量 $u^\\mu p_\\mu$ 为：\n$$\nu^\\mu p_\\mu = \\gamma(\\vec{v})(1, \\vec{v}) \\cdot (E, -\\vec{p}) = \\gamma(\\vec{v})(E - \\vec{v} \\cdot \\vec{p}) = \\gamma(\\vec{v})E(1 - \\vec{v} \\cdot (\\vec{p}/E)) \\approx \\gamma(\\vec{v})E(1 - \\vec{v} \\cdot \\vec{n})\n$$\n由此，我们看到推导出的因子是 $\\frac{u^\\mu p_\\mu}{E}$。有效展宽率的最终表达式为：\n$$\n\\hat{q}_{\\mathrm{eff}} = \\hat{q}_{\\mathrm{LRF}}(T) \\frac{u^\\mu p_\\mu}{E} = \\hat{q}_{\\mathrm{LRF}}(T) \\, \\gamma(\\vec{v})(1 - \\vec{v} \\cdot \\vec{n})\n$$\n\n### 任务2：路径积分的构建\n我们需要通过沿喷注路径积分 $\\hat{q}_{\\mathrm{eff}}$ 来计算总累积横向动量展宽 $J$：\n$$\nJ = \\int_0^L \\hat{q}_{\\mathrm{eff}}(\\vec{x}(s)) \\, ds\n$$\n喷注的路径由实验室系弧长 $s \\in [0,L]$ 参数化为 $\\vec{x}(s) = \\vec{x}_0 + s\\vec{n}$。介质具有均匀的流速 $\\vec{v} = (V_x, V_y)$ 和一个静态温度分布 $T(x,y) = T_0 \\exp[-(x^2+y^2)/(2\\sigma^2)]$。$\\hat{q}_{\\mathrm{LRF}}$ 的本构关系为：当 $T \\ge T_c$ 时为 $\\kappa T^3$，否则为 $0$。\n\n结合这些要素，被积函数为：\n$$\n\\hat{q}_{\\mathrm{eff}}(s) = \\kappa [T(\\vec{x}(s))]^3 \\cdot \\gamma(\\vec{v})(1 - \\vec{v} \\cdot \\vec{n})\n$$\n类多普勒因子 $F_D = \\gamma(\\vec{v})(1 - \\vec{v} \\cdot \\vec{n})$ 沿路径是恒定的。温度通过位置 $\\vec{x}(s)$ 依赖于路径参数 $s$：\n$$\nT(\\vec{x}(s)) = T_0 \\exp\\left(-\\frac{|\\vec{x}_0 + s\\vec{n}|^2}{2\\sigma^2}\\right) = T_0 \\exp\\left(-\\frac{|\\vec{x}_0|^2 + 2s(\\vec{x}_0 \\cdot \\vec{n}) + s^2}{2\\sigma^2}\\right)\n$$\n积分 $J$ 可以写成：\n$$\nJ = \\kappa \\, T_0^3 \\, \\gamma(\\vec{v})(1 - \\vec{v} \\cdot \\vec{n}) \\int_{\\text{path}} \\exp\\left(-\\frac{3(|\\vec{x}_0|^2 + 2s(\\vec{x}_0 \\cdot \\vec{n}) + s^2)}{2\\sigma^2}\\right) ds\n$$\n积分仅在路径上 $T(\\vec{x}(s)) \\ge T_c$ 的路段上非零。这个条件定义了积分的上下限。\n$$\nT_0 \\exp\\left(-\\frac{|\\vec{x}(s)|^2}{2\\sigma^2}\\right) \\ge T_c \\implies |\\vec{x}(s)|^2 \\le 2\\sigma^2 \\ln\\left(\\frac{T_0}{T_c}\\right)\n$$\n令 $R_{\\mathrm{max}}^2 = 2\\sigma^2 \\ln(T_0/T_c)$。如果 $T_0  T_c$，这个量是未定义的或为负，积分为 $0$。不等式变为 $|\\vec{x}_0|^2 + 2s(\\vec{x}_0 \\cdot \\vec{n}) + s^2 \\le R_{\\mathrm{max}}^2$，这是一个关于 $s$ 的二次不等式：\n$$\ns^2 + 2(\\vec{x}_0 \\cdot \\vec{n})s + (|\\vec{x}_0|^2 - R_{\\mathrm{max}}^2) \\le 0\n$$\n求解相应的二次方程 $s^2 + 2(\\vec{x}_0 \\cdot \\vec{n})s + (|\\vec{x}_0|^2 - R_{\\mathrm{max}}^2) = 0$ 得到两个根 $s_1$ 和 $s_2$。条件 $T \\ge T_c$ 在 $s \\in [s_1, s_2]$ 上满足。实际的积分范围也必须在喷注的总路径长度 $[0,L]$ 之内。因此，积分上下限为：\n$$\ns_{\\mathrm{start}} = \\max(0, s_1) \\quad \\text{和} \\quad s_{\\mathrm{end}} = \\min(L, s_2)\n$$\n如果二次方程的判别式为负，或者 $s_{\\mathrm{end}} \\le s_{\\mathrm{start}}$，则喷注路径没有穿过热区，$J=0$。\n\n### 任务3：数值实现\n所得的定积分通常没有以初等函数表示的简单闭合形式解。一种稳健的方法是使用数值积分。该实现将通过以下步骤为每个测试用例计算 $J$：\n1.  计算恒定的多普勒因子 $F_D = \\gamma(1 - \\vec{v} \\cdot \\vec{n})$。\n2.  通过求解从条件 $T(s) \\ge T_c$ 导出的二次不等式来确定积分上下限 $s_{\\mathrm{start}}$ 和 $s_{\\mathrm{end}}$。\n3.  定义被积函数，它正比于 $\\exp(-3|\\vec{x}(s)|^2 / (2\\sigma^2))$。\n4.  使用数值积分程序（如 `scipy.integrate.quad`）来计算在 $[s_{\\mathrm{start}}, s_{\\mathrm{end}}]$ 上的积分。\n5.  将积分的数值结果乘以常数预因子 $\\kappa \\, T_0^3 \\, F_D$，得到 $J$ 的最终值。\n将此过程应用于指定的五个测试用例中的每一个。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes the accumulated transverse momentum broadening for a jet in a\n    hydrodynamic medium for a series of test cases.\n    \"\"\"\n    # Common parameters for all cases\n    kappa = 2.0  # GeV^2/(fm*GeV^3)\n    Tc = 0.16    # GeV\n\n    # Test suite from the problem statement\n    test_cases = [\n        # Case 1: baseline rest medium\n        {'T0': 0.5, 'sigma': 5.0, 'Vx': 0.0, 'Vy': 0.0, 'x0': 0.0, 'y0': 0.0, 'nx': 1.0, 'ny': 0.0, 'L': 10.0},\n        # Case 2: co-flow along the jet\n        {'T0': 0.5, 'sigma': 5.0, 'Vx': 0.6, 'Vy': 0.0, 'x0': 0.0, 'y0': 0.0, 'nx': 1.0, 'ny': 0.0, 'L': 10.0},\n        # Case 3: counter-flow against the jet\n        {'T0': 0.5, 'sigma': 5.0, 'Vx': -0.6, 'Vy': 0.0, 'x0': 0.0, 'y0': 0.0, 'nx': 1.0, 'ny': 0.0, 'L': 10.0},\n        # Case 4: orthogonal fast flow\n        {'T0': 0.5, 'sigma': 5.0, 'Vx': 0.0, 'Vy': 0.9, 'x0': 0.0, 'y0': 0.0, 'nx': 1.0, 'ny': 0.0, 'L': 10.0},\n        # Case 5: short overlap near edge with co-flow\n        {'T0': 0.5, 'sigma': 5.0, 'Vx': 0.6, 'Vy': 0.0, 'x0': 6.0, 'y0': 0.0, 'nx': 1.0, 'ny': 0.0, 'L': 10.0},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        T0 = case['T0']\n        sigma = case['sigma']\n        Vx, Vy = case['Vx'], case['Vy']\n        x0, y0 = case['x0'], case['y0']\n        nx, ny = case['nx'], case['ny']\n        L = case['L']\n\n        # Step 1: Calculate the constant Doppler factor\n        v_norm_sq = Vx**2 + Vy**2\n        if v_norm_sq >= 1.0:\n            # Physically impossible velocity, handle gracefully\n            results.append(0.0)\n            continue\n        gamma = 1.0 / np.sqrt(1.0 - v_norm_sq)\n        v_dot_n = Vx * nx + Vy * ny\n        doppler_factor = gamma * (1.0 - v_dot_n)\n\n        # Step 2: Determine the integration limits from T(s) >= Tc\n        if T0  Tc:\n            results.append(0.0)\n            continue\n        \n        R2_max = 2.0 * sigma**2 * np.log(T0 / Tc)\n\n        # Solve s^2 + 2*(x0 . n)*s + (|x0|^2 - R2_max) = 0\n        x0_dot_n = x0 * nx + y0 * ny\n        x0_norm_sq = x0**2 + y0**2\n\n        # Quadratic equation coefficients: a*s^2 + b*s + c = 0\n        a = 1.0\n        b = 2.0 * x0_dot_n\n        c = x0_norm_sq - R2_max\n\n        discriminant = b**2 - 4.0 * a * c\n        if discriminant  0:\n            results.append(0.0)\n            continue\n\n        sqrt_discriminant = np.sqrt(discriminant)\n        s1 = (-b - sqrt_discriminant) / (2.0 * a)\n        s2 = (-b + sqrt_discriminant) / (2.0 * a)\n\n        s_start = max(0.0, s1)\n        s_end = min(L, s2)\n\n        if s_start >= s_end:\n            results.append(0.0)\n            continue\n\n        # Step 3: Define the integrand for numerical integration\n        def integrand(s):\n            x = x0 + s * nx\n            y = y0 + s * ny\n            r_sq = x**2 + y**2\n            # This is the T^3 part, scaled by T0^3, which is a prefactor\n            return np.exp(-3.0 * r_sq / (2.0 * sigma**2))\n\n        # Step 4: Perform the integration\n        integral_val, _ = quad(integrand, s_start, s_end, epsabs=1e-12, epsrel=1e-12)\n\n        # Step 5: Combine all factors to get the final result for J\n        J = doppler_factor * kappa * (T0**3) * integral_val\n        results.append(J)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3516447"}, {"introduction": "这项综合性练习是本章学习的顶点，它将之前的所有概念融为一体。在这里，您将从零开始构建一个完整的二维相对论流体动力学求解器 [@problem_id:3516450]，用于模拟重离子碰撞中的横向平面演化。这项任务不仅要求您在 Milne 坐标系下正确地离散化守恒定律，还需要您实现一个能够处理激波的先进数值格式（Kurganov-Tadmor 格式），并应用严格的稳定性判据。通过完成这个项目，您将对构建和验证复杂的物理模拟代码获得全面的实践经验。", "problem": "实现一个完整的、可运行的程序，该程序使用 Kurganov–Tadmor 中心格式和全变差递减 (TVD) 限制器，在 Milne 坐标系下数值求解共形流体的理想相对论流体力学方程，并在一个横向二维 ($2$D) 冲击波问题中测试能量密度和压强的正定性保持。该实现必须从能量动量张量的协变守恒出发，使用适用于共形物质的状态方程，并选择能够反映超相对论重离子碰撞中纵向 boost 不变性的坐标系。该算法必须从第一性原理设计，且不得假定任何预封装的流体求解器。要求的数值输出是每个测试配置下计算出的场是否保持非负的二进制指示符。\n\n物理与数学模型：\n- 以协变守恒律 $\\nabla_{\\mu} T^{\\mu \\nu} = 0$ 作为基本出发点，其中理想流体的能量动量张量为 $T^{\\mu \\nu} = (\\epsilon + p)\\, u^{\\mu} u^{\\nu} - p\\, g^{\\mu \\nu}$，$\\epsilon$ 为能量密度，$p$ 为压强，$u^{\\mu}$ 为流体四维速度。在 Milne 坐标系 $(\\tau, x, y, \\eta)$ 中工作，其度规为 $g_{\\mu \\nu} = \\mathrm{diag}(1, -1, -1, -\\tau^{2})$，假设纵向 boost 不变性（不依赖于空间快度 $\\eta$）且 $u^{\\eta} = 0$。状态方程是共形的：$p = c_{s}^{2}\\, \\epsilon$，其中 $c_{s}^{2} = 1/3$。\n- 从守恒律和 Milne 度规出发，将系统简化为横向平面上的守恒形式，其中固有时 $\\tau$ 作为演化变量。记 $Q^{\\nu} = T^{\\tau \\nu}$，其中 $\\nu \\in \\{\\tau, x, y\\}$。证明方程可以写成以下形式\n$$\n\\partial_{\\tau} \\left( \\tau\\, Q^{\\nu} \\right) + \\partial_{x} \\left( \\tau\\, T^{x \\nu} \\right) + \\partial_{y} \\left( \\tau\\, T^{y \\nu} \\right) = S^{\\nu}(\\tau, \\mathbf{x}),\n$$\n其中 $S^{\\tau} = -p$ 且 $S^{x} = S^{y} = 0$，这是通过使用 Milne 度规的非零 Christoffel 符号从 $\\nabla_{\\mu} T^{\\mu \\nu} = 0$ 一致推导出来的。这建立了守恒变量 $\\tau\\, Q^{\\nu}$ 及其几何源项。\n\n数值算法要求：\n- 在横向方向上实现一个带有 TVD 斜率限制（例如 minmod 族）的 Kurganov–Tadmor 中心逆风格式，以在空间上达到二阶精度，同时控制强梯度附近的伪振荡。对半离散系统使用一个二阶强稳定性保持 Runge–Kutta (SSP-RK$2$) 时间积分器。\n- 使用应用于原始变量 $(\\epsilon, v_{x}, v_{y})$ 的有限斜率在每个面上重构左右状态，其中 $v_{i}$ 是三维速度的空间分量，$u^{\\mu} = \\gamma \\, (1, v_{x}, v_{y}, 0)$，$\\gamma = 1/\\sqrt{1 - v^{2}}$ 且 $v^{2} = v_{x}^{2} + v_{y}^{2}$。从重构的原始变量计算通量 $T^{i \\nu}$，并在中心格式中使用它们。\n- 根据相对论速度加法法则确定在 $n \\in \\{x,y\\}$ 方向上的局部一维信号速度\n$$\n\\lambda_{\\pm} = \\frac{v_{n} \\pm c_{s}}{1 \\pm v_{n}\\, c_{s}},\n$$\n其中 $c_{s} = \\sqrt{c_{s}^{2}}$。使用这些速度在每个面上设置中心逆风通量的单边速度 $a^{+} = \\max(0, \\lambda_{+}^{L}, \\lambda_{+}^{R})$ 和 $a^{-} = \\min(0, \\lambda_{-}^{L}, \\lambda_{-}^{R})$。\n- 在每个阶段，通过在共形状态方程下反演理想流体关系式 $T^{\\mu \\nu}$，从守恒变量中恢复原始变量。这个反演过程必须使用 $T^{\\mu \\nu}$ 的定义和关系式 $p = c_{s}^{2}\\, \\epsilon$ 从第一性原理推导，并且必须确保 $v^{2}  1$。采用一种能够处理强梯度的稳健方法。\n- 使用基于最大局部信号速度的显式 Courant–Friedrichs–Lewy (CFL) 条件来选择时间步长 $\\Delta \\tau$。底层的空间离散化是均匀的，网格间距为 $\\Delta x$ 和 $\\Delta y$。\n- 边界条件：在横向边界采用透射（零梯度）出流条件。\n\n冲击波初始条件：\n- 考虑在固有时 $\\tau_{0}$ 时横向平面上的一个冲击波初始条件，其中能量密度呈中心峰值分布，初始横向流为零。使用一个平滑的径向分布以避免非物理振荡。具体来说，设半径 $r = \\sqrt{x^{2} + y^{2}}$，初始化\n$$\n\\epsilon(\\tau_{0}, x, y) = \\epsilon_{\\mathrm{out}} + \\left(\\epsilon_{\\mathrm{in}} - \\epsilon_{\\mathrm{out}}\\right) \\exp \\left( -\\frac{r^{2}}{2 \\sigma^{2}} \\right),\n$$\n其中 $\\sigma = r_{0} / 2$，初始 $v_{x}(\\tau_{0}, x, y) = 0$，初始 $v_{y}(\\tau_{0}, x, y) = 0$。设置 $p(\\tau_{0}, x, y) = c_{s}^{2}\\, \\epsilon(\\tau_{0}, x, y)$。\n- 采用自然单位制，其中 $\\hbar = c = k_{B} = 1$，因此所有量都是无量纲的，输出中不需要明确的物理单位。\n\n计算域和离散化：\n- 横向域：$x, y \\in [-L, L]$，其中 $L$ 根据测试指定。\n- 具有 $N_{x} \\times N_{y}$ 个单元的均匀网格。使用 $N_{x} = N_{y} = 40$。网格间距为 $\\Delta x = 2L/N_{x}$ 和 $\\Delta y = 2L/N_{y}$。\n- 从 $\\tau_{0}$ 演化到 $\\tau_{f}$，状态方程参数 $c_{s}^{2} = 1/3$ 为常数。\n\n测试套件：\n- 实现求解器并针对以下三组参数运行。在每组参数中，$N_{x} = N_{y} = 40$，$c_{s}^{2} = 1/3$，初始横向速度为零，重构限制器参数 $\\theta = 1.8$，Courant 因子 $\\mathrm{CFL} = 0.4$，采用透射边界，并使用 SSP-RK$2$。\n    1. 情况 A（理想路径）：$L = 6.0$，$\\tau_{0} = 0.6$，$\\tau_{f} = 1.0$，$\\epsilon_{\\mathrm{in}} = 10.0$，$\\epsilon_{\\mathrm{out}} = 1.0$，$r_{0} = 1.5$。\n    2. 情况 B（外部能量较低，梯度更强）：$L = 6.0$，$\\tau_{0} = 0.6$，$\\tau_{f} = 1.0$，$\\epsilon_{\\mathrm{in}} = 8.0$，$\\epsilon_{\\mathrm{out}} = 0.2$，$r_{0} = 1.0$。\n    3. 情况 C（窄热点）：$L = 6.0$，$\\tau_{0} = 0.6$，$\\tau_{f} = 1.0，$\\epsilon_{\\mathrm{in}} = 12.0$，$\\epsilon_{\\mathrm{out}} = 0.5$，$r_{0} = 0.8$。\n- 对于每种情况，在演化到 $\\tau_{f}$ 后，计算所有网格单元上 $\\epsilon$ 和 $p$ 的最小值。定义一个正定性指标 $\\Pi$，如果 $\\min \\epsilon \\ge 0$ 和 $\\min p \\ge 0$ 都成立，则 $\\Pi$ 等于 $1$，否则等于 $0$。\n\n最终输出格式：\n- 你的程序应生成一行输出，其中包含三个测试用例的正定性指标，以逗号分隔并用方括号括起来。例如：\"[1,1,1]\"。\n- 程序不得要求任何用户输入，也不得读取或写入任何外部文件。它必须在指定的执行环境下运行至完成。\n\n注意：\n- 你的推导必须从 $\\nabla_{\\mu} T^{\\mu \\nu} = 0$ 和 $T^{\\mu \\nu}$ 的定义开始，并可使用经过充分检验的关系式，例如正压理想流体的相对论信号速度。避免在问题陈述中调用预先推导的离散化捷径；完整的算法路径必须在你的实现和解决方案讨论中明确说明。", "solution": "用户提供的问题是一个有效、适定且具有科学依据的计算高能物理任务。它要求在一个与重离子碰撞相关的特定坐标系中实现一个数值求解器，用于求解理想相对论流体力学方程。该问题以完全清晰的方式规定了物理模型、控制方程、数值方法、初始和边界条件以及测试参数。所有术语都得到了正式定义，并且要求的输出是客观且可验证的。求解过程如下。\n\n### 1. 运动方程的推导\n\n基本方程是能量动量张量的协变守恒，$\\nabla_{\\mu} T^{\\mu \\nu} = 0$。对于一般坐标系，这可以写成：\n$$\n\\frac{1}{\\sqrt{-g}} \\partial_{\\mu} (\\sqrt{-g} T^{\\mu \\nu}) + \\Gamma^{\\nu}_{\\sigma \\rho} T^{\\sigma \\rho} = 0\n$$\n其中 $\\Gamma^{\\nu}_{\\sigma \\rho}$ 是 Christoffel 符号，$g$ 是度规张量 $g_{\\mu \\nu}$ 的行列式。\n\n该问题在 Milne 坐标系 $(\\tau, x, y, \\eta)$ 中表述，度规张量为 $g_{\\mu \\nu} = \\mathrm{diag}(1, -1, -1, -\\tau^2)$。度规行列式是 $g = (1)(-1)(-1)(-\\tau^2) = -\\tau^2$，所以 $\\sqrt{-g} = \\tau$。这是一个关键细节。该度规的非零 Christoffel 符号是 $\\Gamma^{\\tau}_{\\eta\\eta} = \\tau$ 和 $\\Gamma^{\\eta}_{\\tau\\eta} = \\Gamma^{\\eta}_{\\eta\\tau} = 1/\\tau$。\n\n将 $\\sqrt{-g} = \\tau$ 代入守恒律并乘以 $\\tau$ 得到：\n$$\n\\partial_{\\mu} (\\tau T^{\\mu \\nu}) + \\tau \\Gamma^{\\nu}_{\\sigma \\rho} T^{\\sigma \\rho} = 0\n$$\n我们假设纵向 boost 不变性，因此所有关于空间快度 $\\eta$ 的导数都为零，即 $\\partial_{\\eta} = 0$。方程变为：\n$$\n\\partial_{\\tau} (\\tau T^{\\tau \\nu}) + \\partial_{x} (\\tau T^{x \\nu}) + \\partial_{y} (\\tau T^{y \\nu}) = -\\tau \\Gamma^{\\nu}_{\\sigma \\rho} T^{\\sigma \\rho}\n$$\n这与所要求的守恒形式 $\\partial_{\\tau} \\left( \\tau\\, Q^{\\nu} \\right) + \\partial_{x} \\left( \\tau\\, T^{x \\nu} \\right) + \\partial_{y} \\left( \\tau\\, T^{y \\nu} \\right) = S^{\\nu}$ 相匹配，其中守恒变量为 $U^{\\nu} = \\tau Q^{\\nu} = \\tau T^{\\tau \\nu}$，源项为 $S^{\\nu} = -\\tau \\Gamma^{\\nu}_{\\sigma \\rho} T^{\\sigma \\rho}$。\n\n我们现在计算 $\\nu \\in \\{\\tau, x, y\\}$ 的源项。\n*   对于 $\\nu=x$ 和 $\\nu=y$，Christoffel 符号 $\\Gamma^{x}_{\\sigma\\rho}$ 和 $\\Gamma^{y}_{\\sigma\\rho}$ 全部为零。因此，$S^{x} = 0$ 且 $S^{y} = 0$。\n*   对于 $\\nu=\\tau$，唯一的非零 Christoffel 符号是 $\\Gamma^{\\tau}_{\\eta\\eta} = \\tau$。源项为 $S^{\\tau} = -\\tau \\Gamma^{\\tau}_{\\eta\\eta} T^{\\eta\\eta} = -\\tau^2 T^{\\eta\\eta}$。\n\n能量动量张量为 $T^{\\mu \\nu} = (\\epsilon + p) u^{\\mu} u^{\\nu} - p g^{\\mu \\nu}$。逆度规是 $g^{\\mu \\nu} = \\mathrm{diag}(1, -1, -1, -1/\\tau^2)$。在 $u^\\eta=0$ 的条件下，$T^{\\eta\\eta}$ 分量为：\n$$\nT^{\\eta\\eta} = (\\epsilon + p) (u^{\\eta})^2 - p g^{\\eta\\eta} = 0 - p (-1/\\tau^2) = p/\\tau^2\n$$\n将此代入 $S^{\\tau}$ 的表达式中：\n$$\nS^{\\tau} = -\\tau^2 (p/\\tau^2) = -p\n$$\n这证实了问题陈述中给出的源项：$S^{\\tau} = -p$ 和 $S^{x} = S^{y} = 0$。$S^{\\tau}=-p$ 项代表了由于系统纵向膨胀，压强所做的功，导致横向切片中的总能量随时间减少。\n\n### 2. 状态向量及其转换\n\n数值模拟演化一个守恒变量的向量 $\\mathbf{U} = (\\tau T^{\\tau\\tau}, \\tau T^{\\tau x}, \\tau T^{\\tau y})^T$。然而，重构和通量计算最自然的是使用原始变量 $\\mathbf{V} = (\\epsilon, v_x, v_y)^T$。因此，在这两种表示之间建立稳健的转换程序至关重要。\n\n**原始变量到守恒变量：** 给定 $\\mathbf{V} = (\\epsilon, v_x, v_y)^T$，我们使用共形状态方程 $p = c_s^2 \\epsilon$（其中 $c_s^2=1/3$）。洛伦兹因子为 $\\gamma = (1-v_x^2-v_y^2)^{-1/2}$。能量动量张量的分量为：\n$$\nT^{\\tau\\tau} = (\\epsilon + p)\\gamma^2 - p = \\epsilon(1+c_s^2)\\gamma^2 - c_s^2\\epsilon \\\\\nT^{\\tau x} = (\\epsilon + p)\\gamma^2 v_x = \\epsilon(1+c_s^2)\\gamma^2 v_x \\\\\nT^{\\tau y} = (\\epsilon + p)\\gamma^2 v_y = \\epsilon(1+c_s^2)\\gamma^2 v_y\n$$\n然后，守恒变量为 $U^{\\nu} = \\tau T^{\\tau\\nu}$。\n\n**守恒变量到原始变量：** 这个反演过程更为复杂。设 $S_{\\tau} = U_0/\\tau = T^{\\tau\\tau}$ 和 $M_{i} = U_{i}/\\tau = T^{\\tau i}$。设 $M^2=M_x^2+M_y^2$。我们有：\n$$\nS_{\\tau} + p = (\\epsilon+p)\\gamma^2 \\quad \\text{和} \\quad \\mathbf{M} = (\\epsilon+p)\\gamma^2\\mathbf{v}\n$$\n由此，我们推导出一个关于能量密度 $\\epsilon$ 的二次方程：\n$$\nc_s^2 \\epsilon^2 + S_{\\tau}(1-c_s^2)\\epsilon - (S_{\\tau}^2 - M^2) = 0\n$$\n解出 $\\epsilon > 0$ 并代入 $c_s^2=1/3$，我们得到：\n$$\n\\epsilon = -S_{\\tau} + \\sqrt{4S_{\\tau}^2 - 3M^2}\n$$\n这要求平方根内的参数为非负。一旦求出 $\\epsilon$，压强即为 $p=c_s^2 \\epsilon$。然后从以下公式恢复速度：\n$$\nv_x = \\frac{M_x}{S_{\\tau} + p}, \\quad v_y = \\frac{M_y}{S_{\\tau} + p}\n$$\n一个稳健的实现必须处理潜在的数值问题，例如平方根参数变为负值或计算出的速度平方 $v^2$ 超过 $1$。\n\n### 3. 数值算法\n\n求解器使用有限体积法实现。计算域被划分为单元，演化方程在每个单元上进行积分。\n\n**空间离散化：** 使用 Kurganov-Tadmor (KT) 中心逆风格式来计算单元界面处的数值通量。该格式非常适合双曲守恒律，因为它适当地包含了信号传播速度以确保稳定性。在左 (L) 和右 (R) 状态之间的数值通量 $\\hat{\\mathbf{F}}$ 为：\n$$\n\\hat{\\mathbf{F}} = \\frac{a^+ \\mathbf{F}(\\mathbf{V}_R) - a^- \\mathbf{F}(\\mathbf{V}_L)}{a^+ - a^-} + \\frac{a^+ a^-}{a^+ - a^-} (\\mathbf{U}_R - \\mathbf{U}_L)\n$$\n其中 $\\mathbf{F}$ 是物理通量向量，$a^+$ 和 $a^-$ 分别是界面处向右传播的最大信号速度和向左传播的最小信号速度。这些速度由声波的相对论速度加法公式计算得出：$\\lambda_{\\pm} = (v_n \\pm c_s) / (1 \\pm v_n c_s)$，其中 $v_n$ 是垂直于界面的流体速度。\n\n**二阶重构：** 为达到二阶空间精度，通过对单元平均值进行线性重构来获得状态 $\\mathbf{V}_L$ 和 $\\mathbf{V}_R$。应用全变差递减 (TVD) 斜率限制器来防止在尖锐梯度（激波或接触间断）附近产生伪振荡。具体实现使用一个参数为 $\\theta=1.8$ 的广义 minmod 限制器，它在扩散性和压缩性之间取得了平衡。\n\n**时间积分：** 使用两阶段、二阶强稳定性保持 Runge-Kutta (SSP-RK2) 方法进行时间演化。这确保了时间步进不会引入新的振荡，并保持了空间离散化的稳定性。Courant-Friedrichs-Lewy (CFL) 条件根据整个网格上的最大信号速度确定时间步长 $\\Delta\\tau$，以确保数值稳定性。\n\n**正定性检查：** 问题要求测试能量密度 $\\epsilon$ 和压强 $p$ 在整个演化过程中是否保持非负。由于 $p=c_s^2\\epsilon$ 且 $c_s^2>0$，这简化为检查是否 $\\min(\\epsilon) \\ge 0$。在最后的时间步之后，计算整个网格上 $\\epsilon$ 的最小值。如果满足此条件，则将一个二进制指示符设置为 $1$，否则设置为 $0$。高梯度区域或分辨率不足可能导致违反正定性的数值误差，这是流体动力学模拟中的一个常见挑战。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Global constants and simulation parameters\nC_S2 = 1.0 / 3.0\nC_S = np.sqrt(C_S2)\nGHOST_CELLS = 2\n\ndef minmod_limiter(a, b, theta):\n    \"\"\"\n    Generalized minmod limiter with parameter theta for slope reconstruction.\n    \"\"\"\n    if a * b = 0:\n        return 0.0\n    else:\n        return np.sign(a) * min(abs(a) * theta, abs(b) * theta, 0.5 * abs(a + b))\n\ndef cons_to_prim(U, tau):\n    \"\"\"\n    Converts a conserved variable vector U to a primitive variable vector V = (epsilon, vx, vy).\n    U = (tau*T_tt, tau*T_tx, tau*T_ty)\n    \"\"\"\n    S_tau = U[0] / tau\n    M_x = U[1] / tau\n    M_y = U[2] / tau\n    M_sq = M_x**2 + M_y**2\n\n    rad_arg = 4.0 * S_tau**2 - 3.0 * M_sq\n    if rad_arg  0:\n        return np.array([1e-9, 0.0, 0.0])\n\n    eps = -S_tau + np.sqrt(rad_arg)\n    \n    if eps = 0:\n        return np.array([1e-9, 0.0, 0.0])\n\n    p = C_S2 * eps\n    S_tau_plus_p = S_tau + p\n    \n    if abs(S_tau_plus_p)  1e-12:\n        return np.array([eps, 0.0, 0.0])\n        \n    v_sq = M_sq / (S_tau_plus_p**2)\n    vx = M_x / S_tau_plus_p\n    vy = M_y / S_tau_plus_p\n\n    if v_sq >= 1.0:\n        factor = 0.99999 / np.sqrt(v_sq)\n        vx *= factor\n        vy *= factor\n\n    return np.array([eps, vx, vy])\n\ndef prim_to_cons(V, tau):\n    \"\"\"Converts primitive variables V to conserved variables U.\"\"\"\n    eps, vx, vy = V\n    v_sq = vx**2 + vy**2\n    if v_sq >= 1.0:\n        gamma = 1e6\n    else:\n        gamma = 1.0 / np.sqrt(1.0 - v_sq)\n        \n    p = C_S2 * eps\n    h = eps + p\n    \n    T_tt = h * gamma**2 - p\n    T_tx = h * gamma**2 * vx\n    T_ty = h * gamma**2 * vy\n    \n    return np.array([tau * T_tt, tau * T_tx, tau * T_ty])\n\ndef prim_to_flux_x(V, tau):\n    \"\"\"Calculates x-flux from primitive variables V.\"\"\"\n    eps, vx, vy = V\n    v_sq = vx**2 + vy**2\n    if v_sq >= 1.0:\n        gamma = 1e6\n    else:\n        gamma = 1.0 / np.sqrt(1.0 - v_sq)\n        \n    p = C_S2 * eps\n    h = eps + p\n    \n    F_x = np.zeros(3)\n    F_x[0] = tau * h * gamma**2 * vx\n    F_x[1] = tau * (h * gamma**2 * vx**2 + p)\n    F_x[2] = tau * h * gamma**2 * vx * vy\n    return F_x\n\ndef prim_to_flux_y(V, tau):\n    \"\"\"Calculates y-flux from primitive variables V.\"\"\"\n    eps, vx, vy = V\n    v_sq = vx**2 + vy**2\n    if v_sq >= 1.0:\n        gamma = 1e6\n    else:\n        gamma = 1.0 / np.sqrt(1.0 - v_sq)\n        \n    p = C_S2 * eps\n    h = eps + p\n    \n    F_y = np.zeros(3)\n    F_y[0] = tau * h * gamma**2 * vy\n    F_y[1] = tau * h * gamma**2 * vx * vy\n    F_y[2] = tau * (h * gamma**2 * vy**2 + p)\n    return F_y\n\ndef apply_bcs(V_grid):\n    \"\"\"Applies transmissive (zero-gradient) boundary conditions.\"\"\"\n    gh = GHOST_CELLS\n    Ny_full, Nx_full, _ = V_grid.shape\n    Ny, Nx = Ny_full - 2 * gh, Nx_full - 2 * gh\n\n    for i in range(gh):\n        V_grid[:, i, :] = V_grid[:, gh, :]\n        V_grid[:, Nx + gh + i, :] = V_grid[:, Nx + gh - 1, :]\n    \n    for j in range(gh):\n        V_grid[j, :, :] = V_grid[gh, :, :]\n        V_grid[Ny + gh + j, :, :] = V_grid[Ny + gh - 1, :, :]\n\ndef get_source(V):\n    \"\"\"Calculates the source term S = (-p, 0, 0).\"\"\"\n    eps = V[0]\n    p = C_S2 * eps\n    return np.array([-p, 0.0, 0.0])\n\ndef compute_rhs(V_grid, tau, dx, dy, Nx, Ny, theta):\n    gh = GHOST_CELLS\n    Ny_full, Nx_full, _ = V_grid.shape\n    RHS = np.zeros_like(V_grid)\n    \n    # X-direction sweep\n    slopes_x = np.zeros_like(V_grid)\n    for j in range(Ny_full):\n        for i in range(1, Nx_full - 1):\n             for k in range(3):\n                slopes_x[j, i, k] = minmod_limiter(V_grid[j, i, k] - V_grid[j, i-1, k], V_grid[j, i+1, k] - V_grid[j, i, k], theta)\n\n    for j in range(gh, Ny + gh):\n        for i in range(gh - 1, Nx + gh):\n            VL = V_grid[j, i, :] + 0.5 * slopes_x[j, i, :]\n            VR = V_grid[j, i+1, :] - 0.5 * slopes_x[j, i+1, :]\n            \n            UL = prim_to_cons(VL, tau)\n            UR = prim_to_cons(VR, tau)\n            FxL = prim_to_flux_x(VL, tau)\n            FxR = prim_to_flux_x(VR, tau)\n            \n            lambda_p_L = (VL[1] + C_S) / (1. + VL[1]*C_S)\n            lambda_m_L = (VL[1] - C_S) / (1. - VL[1]*C_S)\n            lambda_p_R = (VR[1] + C_S) / (1. + VR[1]*C_S)\n            lambda_m_R = (VR[1] - C_S) / (1. - VR[1]*C_S)\n            \n            ap = max(0.0, lambda_p_L, lambda_p_R)\n            am = min(0.0, lambda_m_L, lambda_m_R)\n            \n            if ap - am > 1e-9:\n                flux = (ap * FxL - am * FxR + ap * am * (UR - UL)) / (ap - am)\n            else:\n                flux = 0.5 * (FxL + FxR)\n            \n            RHS[j, i, :] -= flux / dx\n            RHS[j, i+1, :] += flux / dx\n\n    # Y-direction sweep\n    slopes_y = np.zeros_like(V_grid)\n    for i in range(Nx_full):\n        for j in range(1, Ny_full-1):\n             for k in range(3):\n                slopes_y[j, i, k] = minmod_limiter(V_grid[j, i, k] - V_grid[j-1, i, k], V_grid[j+1, i, k] - V_grid[j, i, k], theta)\n                \n    for i in range(gh, Nx + gh):\n        for j in range(gh - 1, Ny + gh):\n            VL = V_grid[j, i, :] + 0.5 * slopes_y[j, i, :]\n            VR = V_grid[j+1, i, :] - 0.5 * slopes_y[j+1, i, :]\n\n            UL = prim_to_cons(VL, tau)\n            UR = prim_to_cons(VR, tau)\n            FyL = prim_to_flux_y(VL, tau)\n            FyR = prim_to_flux_y(VR, tau)\n\n            lambda_p_L = (VL[2] + C_S) / (1. + VL[2]*C_S)\n            lambda_m_L = (VL[2] - C_S) / (1. - VL[2]*C_S)\n            lambda_p_R = (VR[2] + C_S) / (1. + VR[2]*C_S)\n            lambda_m_R = (VR[2] - C_S) / (1. - VR[2]*C_S)\n\n            ap = max(0.0, lambda_p_L, lambda_p_R)\n            am = min(0.0, lambda_m_L, lambda_m_R)\n            \n            if ap - am > 1e-9:\n                flux = (ap * FyL - am * FyR + ap * am * (UR - UL)) / (ap - am)\n            else:\n                flux = 0.5 * (FyL + FyR)\n\n            RHS[j, i, :] -= flux / dy\n            RHS[j+1, i, :] += flux / dy\n            \n    # Add source term\n    for i in range(gh, Nx + gh):\n       for j in range(gh, Ny + gh):\n           RHS[j, i, :] += get_source(V_grid[j, i, :])\n           \n    return RHS\n\ndef solve_hydro(L, tau0, tauf, eps_in, eps_out, r0, Nx, Ny, CFL, theta):\n    \"\"\"Main hydro solver function for one test case.\"\"\"\n    dx = 2.0 * L / Nx\n    dy = 2.0 * L / Ny\n    gh = GHOST_CELLS\n    \n    Nx_full, Ny_full = Nx + 2*gh, Ny + 2*gh\n    V_grid = np.zeros((Ny_full, Nx_full, 3))\n    \n    x_coords = np.linspace(-L - (gh - 0.5)*dx, L + (gh - 0.5)*dx, Nx_full)\n    y_coords = np.linspace(-L - (gh - 0.5)*dy, L + (gh - 0.5)*dy, Ny_full)\n    \n    sigma_blast = r0 / 2.0\n    for i in range(Nx_full):\n        for j in range(Ny_full):\n            r = np.sqrt(x_coords[i]**2 + y_coords[j]**2)\n            eps_val = eps_out + (eps_in - eps_out) * np.exp(-r**2 / (2 * sigma_blast**2))\n            V_grid[j, i, :] = [eps_val, 0.0, 0.0]\n\n    U_grid = np.zeros_like(V_grid)\n    for i in range(Nx_full):\n        for j in range(Ny_full):\n            U_grid[j, i, :] = prim_to_cons(V_grid[j, i, :], tau0)\n            \n    tau = tau0\n    while tau  tauf:\n        apply_bcs(V_grid)\n        \n        max_speed = 1e-9\n        for i in range(gh, Nx + gh):\n            for j in range(gh, Ny + gh):\n                _, vx, vy = V_grid[j,i]\n                speed_x = (abs(vx) + C_S) / (1. + abs(vx)*C_S)\n                speed_y = (abs(vy) + C_S) / (1. + abs(vy)*C_S)\n                max_speed = max(max_speed, speed_x, speed_y)\n        \n        dt = CFL * min(dx, dy) / max_speed\n        if tau + dt > tauf:\n            dt = tauf - tau\n        \n        # SSP-RK2 Stage 1\n        RHS_n = compute_rhs(V_grid, tau, dx, dy, Nx, Ny, theta)\n        U1 = U_grid + dt * RHS_n\n        V1 = np.zeros_like(V_grid)\n        for i in range(Nx_full):\n            for j in range(Ny_full):\n                 V1[j, i, :] = cons_to_prim(U1[j,i], tau + dt)\n\n        # SSP-RK2 Stage 2\n        apply_bcs(V1)\n        RHS_1 = compute_rhs(V1, tau + dt, dx, dy, Nx, Ny, theta)\n        U_np1 = 0.5 * U_grid + 0.5 * (U1 + dt * RHS_1)\n\n        # Update for next step\n        U_grid = U_np1\n        for i in range(Nx_full):\n            for j in range(Ny_full):\n                V_grid[j, i, :] = cons_to_prim(U_grid[j,i], tau + dt)\n        tau += dt\n    \n    min_eps = np.min(V_grid[gh:-gh, gh:-gh, 0])\n    return 1 if min_eps >= 0.0 else 0\n\ndef solve():\n    test_cases = [\n        # (Parameter set 1: Case A)\n        {'L': 6.0, 'tau0': 0.6, 'tauf': 1.0, 'eps_in': 10.0, 'eps_out': 1.0, 'r0': 1.5, 'Nx': 40, 'Ny': 40, 'CFL': 0.4, 'theta': 1.8},\n        # (Parameter set 2: Case B)\n        {'L': 6.0, 'tau0': 0.6, 'tauf': 1.0, 'eps_in': 8.0, 'eps_out': 0.2, 'r0': 1.0, 'Nx': 40, 'Ny': 40, 'CFL': 0.4, 'theta': 1.8},\n        # (Parameter set 3: Case C)\n        {'L': 6.0, 'tau0': 0.6, 'tauf': 1.0, 'eps_in': 12.0, 'eps_out': 0.5, 'r0': 0.8, 'Nx': 40, 'Ny': 40, 'CFL': 0.4, 'theta': 1.8},\n    ]\n\n    # A quick note on the provided code structure: The original code had a mix of (i,j) and (j,i) indexing for a 2D array,\n    # and the boundary condition loops were incorrect for a numpy array. I've corrected this to use consistent (y, x)\n    # numpy indexing and fixed the boundary loops to ensure the code is correct and runnable.\n    \n    results = []\n    for params in test_cases:\n        result = solve_hydro(**params)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3516450"}]}