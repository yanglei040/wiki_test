{"hands_on_practices": [{"introduction": "本次练习将帮助您巩固洛伦兹不变相空间的基本概念。我们将从笛卡尔动量坐标系转换到更具实验意义的横动量（$p_T$）和快度（$y$）坐标系。这项练习 [@problem_id:3532974] 对于连接理论计算与实际探测器测量至关重要，因为它演示了如何计算在特定探测器接收度下能够被实际观测到的粒子所占的比例。", "problem": "您的任务是推导并计算验证洛伦兹不变相空间测度的一个变换，并用它来计算具有运动学截断的真实探测器的接收度分数。背景是高能物理（HEP）中的一个热源，在源的静止坐标系中进行建模。\n\n从以下基本依据开始：\n- 质量为 $m$ 的粒子的在壳关系：$E = \\sqrt{m^2 + \\mathbf{p}^2}$，其中 $\\mathbf{p} = (p_x,p_y,p_z)$ 是三维动量。\n- 洛伦兹不变相空间测度：$d^3p/E$。\n- 快度 $y$ 的定义：$y = \\frac{1}{2}\\ln\\left(\\frac{E + p_z}{E - p_z}\\right)$。\n- 横向平面的柱坐标：$p_T = \\sqrt{p_x^2 + p_y^2}$ 和方位角 $\\phi$。\n\n您的任务是：\n1. 推导变量变换 $(p_x,p_y,p_z) \\mapsto (p_T,\\phi,y)$ 的雅可比行列式，并证明用这些变量表示的洛伦兹不变测度 $d^3p/E$ 的形式等于一个简单的微分乘积。不要跳过中间步骤；明确论证每次变量变换，并确保推导过程只使用上述基本定律和核心定义。\n2. 考虑一个在其静止坐标系中的热源，其不变动量谱为 $E\\, d^3N/d^3p \\propto \\exp(-E/T)$，其中 $T$ 是温度。使用第1部分的结果：\n   - 在实际探测器接收度截断 $|y|  y_{\\max}$ 和 $p_T > p_{T,\\min}$ 下，将被接收率 $N_{\\text{acc}}$ 写成关于 $p_T$、$y$ 和 $\\phi$ 的积分。\n   - 将总率 $N_{\\text{tot}}$ 定义为在整个相空间 $(p_T \\in [0,\\infty),\\, y \\in (-\\infty,\\infty),\\, \\phi \\in [0,2\\pi))$ 上的积分。\n   - 将接收度分数 $F$ 定义为 $F = N_{\\text{acc}}/N_{\\text{tot}}$。基于所提供的基础，使用纯数学变换尽可能地简化积分，并在适用的地方利用对称性。角度必须以弧度为单位。所有物理量 $m$、$T$ 和 $p_T$ 必须以吉电子伏特（$\\text{GeV}$）表示。接收度分数 $F$ 是无量纲的；请以小数形式提供。\n3. 实现一个完整、可运行的程序，使用稳健的数值积分方法为一组测试用例数值计算 $F$。您的实现必须：\n   - 使用第1部分的结果来建立积分。\n   - 如果可能，对方位角 $\\phi$ 的积分进行解析处理。对于快度积分，利用 $y$ 的偶函数性质来降低计算成本。\n   - 以足够的数值精度和稳定性执行剩余的积分。\n   - 所有输入以 $\\text{GeV}$ 表示，角度以弧度表示。\n   - 最终输出为一行，包含所有测试用例的接收度分数，以逗号分隔并用方括号括起来。\n\n测试套件：\n为以下参数集 $(m, T, y_{\\max}, p_{T,\\min})$ 计算 $F$，其中 $m$ 以 $\\text{GeV}$ 为单位，$T$ 以 $\\text{GeV}$ 为单位，$y_{\\max}$ 无量纲，$p_{T,\\min}$ 以 $\\text{GeV}$ 为单位：\n- 情况 1：$(0.139, 0.170, 1.0, 0.30)$\n- 情况 2：$(0.939, 0.170, 2.0, 0.00)$\n- 情况 3：$(0.000, 0.170, 0.0, 0.00)$\n- 情况 4：$(0.500, 0.200, 10.0, 5.00)$\n- 情况 5：$(3.000, 0.250, 1.0, 0.00)$\n\n覆盖性设计：\n- 该集合涵盖了具有中等截断的轻强子、具有宽快度接收度和无 $p_T$ 阈值的类核子质量、具有零快度窗口的无质量极限、具有宽快度接收度的严格高 $p_T$ 截断，以及一个重质量情景。\n- 预期输出是代表接收度分数的小数浮点数。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用逗号分隔并用方括号括起来的结果（例如，$[0.12345678,0.23456789,0.34567890,0.45678901,0.56789012]$）。不应打印任何其他文本。", "solution": "该问题要求推导和应用一个变换后的洛伦兹不变相空间测度，以计算热源的探测器接收度分数。对问题陈述的验证证实了其科学性、适定性和客观性。所提供的定义和物理模型是高能物理中的标准模型。我们按步骤进行解答。\n\n### 第1部分：相空间测度的变换\n\n目标是将洛伦兹不变相空间测度 $d^3p/E$ 从笛卡尔动量坐标 $(p_x, p_y, p_z)$ 变换为一组新变量：横向动量 $p_T$、方位角 $\\phi$ 和快度 $y$。\n\n在笛卡尔坐标中，相空间体积元为 $d^3p = dp_x dp_y dp_z$。\n\n**步骤1：变换到柱坐标**\n首先，我们从笛卡尔坐标 $(p_x, p_y, p_z)$ 变换到柱坐标 $(p_T, \\phi, p_z)$。关系如下：\n$$ p_x = p_T \\cos\\phi $$\n$$ p_y = p_T \\sin\\phi $$\n$$ p_z = p_z $$\n其中 $p_T = \\sqrt{p_x^2 + p_y^2}$ 是横向动量，$\\phi$ 是方位角。这个变换的雅可比行列式 $J_1$ 是：\n$$ J_1 = \\left| \\det \\begin{pmatrix} \\frac{\\partial p_x}{\\partial p_T}  \\frac{\\partial p_x}{\\partial \\phi}  \\frac{\\partial p_x}{\\partial p_z} \\\\ \\frac{\\partial p_y}{\\partial p_T}  \\frac{\\partial p_y}{\\partial \\phi}  \\frac{\\partial p_y}{\\partial p_z} \\\\ \\frac{\\partial p_z}{\\partial p_T}  \\frac{\\partial p_z}{\\partial \\phi}  \\frac{\\partial p_z}{\\partial p_z} \\end{pmatrix} \\right| = \\left| \\det \\begin{pmatrix} \\cos\\phi  -p_T \\sin\\phi  0 \\\\ \\sin\\phi  p_T \\cos\\phi  0 \\\\ 0  0  1 \\end{pmatrix} \\right| $$\n$$ J_1 = | p_T \\cos^2\\phi - (-p_T \\sin^2\\phi) | = | p_T(\\cos^2\\phi + \\sin^2\\phi) | = p_T $$\n由于 $p_T \\ge 0$，绝对值是多余的。体积元变为 $d^3p = p_T dp_T d\\phi dp_z$。现在，相空间测度为：\n$$ \\frac{d^3p}{E} = \\frac{p_T dp_T d\\phi dp_z}{E} $$\n\n**步骤2：从纵向动量变换到快度**\n接下来，我们执行从纵向动量 $p_z$ 到快度 $y$ 的变量变换。快度的定义是：\n$$ y = \\frac{1}{2}\\ln\\left(\\frac{E + p_z}{E - p_z}\\right) $$\n为了找到 $dp_z$ 和 $dy$ 之间的微分关系，我们首先用 $y$ 和横向质量 $m_T = \\sqrt{m^2 + p_T^2}$ 来表示 $p_z$ 和 $E$。\n从 $y$ 的定义出发：\n$$ e^{2y} = \\frac{E+p_z}{E-p_z} \\implies e^{2y}(E-p_z) = E+p_z \\implies p_z = E \\frac{e^{2y}-1}{e^{2y}+1} = E \\tanh(y) $$\n在壳能量-动量关系为 $E^2 = m^2 + \\mathbf{p}^2 = m^2 + p_T^2 + p_z^2 = m_T^2 + p_z^2$。代入 $p_z = E \\tanh(y)$：\n$$ E^2 = m_T^2 + E^2 \\tanh^2(y) \\implies E^2(1-\\tanh^2(y)) = m_T^2 $$\n使用恒等式 $1-\\tanh^2(y) = \\text{sech}^2(y) = 1/\\cosh^2(y)$，我们得到：\n$$ \\frac{E^2}{\\cosh^2(y)} = m_T^2 \\implies E = m_T \\cosh(y) $$\n由于能量 $E$ 是正的，我们取正根。现在将此代回 $p_z$ 的表达式中：\n$$ p_z = (m_T \\cosh(y)) \\tanh(y) = m_T \\sinh(y) $$\n为了求得 $dp_z$，我们将 $p_z$ 对 $y$ 求导，同时保持 $p_T$（以及 $m_T$）不变：\n$$ \\frac{\\partial p_z}{\\partial y} = \\frac{\\partial}{\\partial y}(m_T \\sinh y) = m_T \\cosh y $$\n由于我们已求得 $E = m_T \\cosh y$，我们得到了一个非常简单的关系：\n$$ \\frac{\\partial p_z}{\\partial y} = E \\implies dp_z = E \\, dy $$\n\n**步骤3：测度的最终形式**\n将 $dp_z = E \\, dy$ 代入我们测度的中间表达式中：\n$$ \\frac{d^3p}{E} = \\frac{p_T dp_T d\\phi (E \\, dy)}{E} $$\n能量 $E$ 被约去，得到最终变换后的测度：\n$$ \\frac{d^3p}{E} = p_T dp_T d\\phi dy $$\n这表明在 $(p_T, \\phi, y)$ 坐标系中，洛伦兹不变相空间测度是微分的简单乘积。\n\n### 第2部分：接收度分数的公式化\n\n不变动量谱由 $E \\, d^3N/d^3p \\propto \\exp(-E/T)$ 给出。这意味着在相空间元 $d^3p$ 中的粒子数 $dN$ 为 $dN \\propto \\exp(-E/T) \\frac{d^3p}{E}$。设 $C$ 为比例常数：\n$$ dN = C \\exp(-E/T) \\frac{d^3p}{E} = C \\exp\\left(-\\frac{m_T \\cosh y}{T}\\right) p_T dp_T d\\phi dy $$\n其中 $E = m_T \\cosh y = \\sqrt{m^2 + p_T^2} \\cosh y$。\n\n总粒子率 $N_{\\text{tot}}$ 是在整个相空间上的积分：$p_T \\in [0, \\infty)$，$\\phi \\in [0, 2\\pi)$，$y \\in (-\\infty, \\infty)$。\n被接收的粒子率 $N_{\\text{acc}}$ 是在探测器接收度范围内的积分：$p_T > p_{T,\\min}$， $|y|  y_{\\max}$。\n\n接收度分数是 $F = N_{\\text{acc}} / N_{\\text{tot}}$。常数 $C$ 和对 $\\phi$ 的积分（由于被积函数不依赖于 $\\phi$，这在分子和分母中都给出一个因子 $2\\pi$）相互抵消。\n$$ F = \\frac{\\int_{-y_{\\max}}^{y_{\\max}} dy \\int_{p_{T,\\min}}^{\\infty} dp_T \\, p_T \\exp\\left(-\\frac{\\sqrt{m^2+p_T^2}\\cosh y}{T}\\right)}{\\int_{-\\infty}^{\\infty} dy \\int_0^{\\infty} dp_T \\, p_T \\exp\\left(-\\frac{\\sqrt{m^2+p_T^2}\\cosh y}{T}\\right)} $$\n被积函数是 $y$ 的偶函数，因为 $\\cosh(-y) = \\cosh(y)$。我们可以简化 $y$ 的积分限：\n$$ F = \\frac{\\int_0^{y_{\\max}} dy \\int_{p_{T,\\min}}^{\\infty} dp_T \\, p_T \\exp\\left(-\\frac{\\sqrt{m^2+p_T^2}\\cosh y}{T}\\right)}{\\int_0^{\\infty} dy \\int_0^{\\infty} dp_T \\, p_T \\exp\\left(-\\frac{\\sqrt{m^2+p_T^2}\\cosh y}{T}\\right)} $$\n我们来计算内部关于 $p_T$ 的积分。我们使用换元法 $u = \\sqrt{m^2+p_T^2}$，这意味着 $u^2 = m^2+p_T^2$ 且 $u\\,du = p_T\\,dp_T$。积分 $\\int_{p_{T, \\text{start}}}^\\infty$ 变为 $\\int_{u_{\\text{start}}}^\\infty$，其中 $u_{\\text{start}} = \\sqrt{m^2 + p_{T, \\text{start}}^2}$。\n内部积分的形式为 $\\int_{u_{\\text{start}}}^\\infty u \\exp(-au) du$，其中 $a = (\\cosh y)/T$。使用分部积分法，其计算结果为：\n$$ \\left[ -e^{-au}\\left(\\frac{u}{a} + \\frac{1}{a^2}\\right) \\right]_{u_{\\text{start}}}^{\\infty} = e^{-au_{\\text{start}}}\\left(\\frac{u_{\\text{start}}}{a} + \\frac{1}{a^2}\\right) = e^{-\\frac{u_{\\text{start}}\\cosh y}{T}}\\left(\\frac{u_{\\text{start}} T}{\\cosh y} + \\frac{T^2}{\\cosh^2 y}\\right) $$\n分子积分 $I_{\\text{num}}$ 变为一个需要数值计算的关于 $y$ 的单变量积分：\n$$ I_{\\text{num}} = \\int_0^{y_{\\max}} e^{-\\frac{u_{\\min}\\cosh y}{T}}\\left(\\frac{u_{\\min} T}{\\cosh y} + \\frac{T^2}{\\cosh^2 y}\\right) dy \\quad \\text{其中 } u_{\\min} = \\sqrt{m^2 + p_{T,\\min}^2} $$\n分母积分 $I_{\\text{den}}$ 的 $p_{T,\\min}=0$，因此 $u_{\\text{start}} = \\sqrt{m^2+0^2} = m$。它对 $y$ 的积分延伸到无穷大。这个积分有已知的解析解。首先，交换 $I_{\\text{den}}$ 的二重积分的积分顺序：\n$$ I_{\\text{den}} = \\int_0^\\infty dp_T \\, p_T \\int_0^\\infty dy \\, \\exp\\left(-\\frac{\\sqrt{m^2+p_T^2}\\cosh y}{T}\\right) $$\n内部积分是 $\\int_0^\\infty e^{-z \\cosh y} dy = K_0(z)$，其中 $K_0$ 是第二类修正贝塞尔函数的0阶函数，且 $z = \\sqrt{m^2+p_T^2}/T$。\n$$ I_{\\text{den}} = \\int_0^\\infty p_T K_0\\left(\\frac{\\sqrt{m^2+p_T^2}}{T}\\right) dp_T $$\n通过换元 $x = \\sqrt{m^2+p_T^2}/T$，有 $x^2 T^2 = m^2+p_T^2$ 且 $2xT^2 dx = 2p_T dp_T$：\n$$ I_{\\text{den}} = \\int_{m/T}^\\infty (xT^2) K_0(x) dx = T^2 \\int_{m/T}^\\infty x K_0(x) dx $$\n使用恒等式 $\\frac{d}{dx}(x K_1(x)) = -x K_0(x)$，我们有 $\\int x K_0(x) dx = -x K_1(x)$。\n$$ I_{\\text{den}} = T^2 [-x K_1(x)]_{m/T}^\\infty = T^2 \\left(0 - \\left(-\\frac{m}{T} K_1\\left(\\frac{m}{T}\\right)\\right)\\right) = m T K_1\\left(\\frac{m}{T}\\right) $$\n对于 $m=0$ 的特殊情况，分母可以直接计算：$I_{\\text{den}} = \\int_0^\\infty dy \\int_0^\\infty dp_T p_T e^{-p_T \\cosh y / T}$。内部积分是 $T^2/\\cosh^2 y$，且 $\\int_0^\\infty (T^2/\\cosh^2 y) dy = T^2[\\tanh y]_0^\\infty = T^2$。这与贝塞尔函数表达式在 $m \\to 0$ 时的极限一致，因为当 $z \\to 0$ 时 $zK_1(z) \\to 1$。\n\n### 第3部分：数值实现策略\n\n接收度分数 $F = I_{\\text{num}}/I_{\\text{den}}$ 的计算方法如下：\n1.  分母 $I_{\\text{den}}$ 通过解析方法计算：\n    - 如果 $m  0$，$I_{\\text{den}} = m T K_1(m/T)$。我们使用 `scipy.special.k1`。\n    - 如果 $m = 0$，$I_{\\text{den}} = T^2$。\n2.  分子 $I_{\\text{num}}$ 通过对上述推导出的单变量函数从 $y=0$ 到 $y=y_{\\max}$ 进行数值积分来计算。这可以通过使用 `scipy.integrate.quad` 完成。被积函数是：\n    $$ f(y) = e^{-\\frac{u_{\\min}\\cosh y}{T}}\\left(\\frac{u_{\\min} T}{\\cosh y} + \\frac{T^2}{\\cosh^2 y}\\right), \\quad \\text{其中 } u_{\\min} = \\sqrt{m^2 + p_{T,\\min}^2} $$\n3.  处理边界情况：如果 $y_{\\max}=0$，积分 $I_{\\text{num}}$ 为 $0$，因此 $F=0$。\n对每个测试用例执行计算，并按指定格式化结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\nfrom scipy.special import k1\n\ndef solve():\n    \"\"\"\n    Computes the acceptance fraction F for a set of physical parameters.\n\n    The acceptance fraction F is the ratio of the accepted particle rate to the\n    total particle rate from a thermal source, under specified kinematic cuts.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (m, T, y_max, pT_min)\n    # m: mass (GeV), T: temperature (GeV), y_max: max rapidity (dimensionless),\n    # pT_min: min transverse momentum (GeV)\n    test_cases = [\n        (0.139, 0.170, 1.0, 0.30),\n        (0.939, 0.170, 2.0, 0.00),\n        (0.000, 0.170, 0.0, 0.00),\n        (0.500, 0.200, 10.0, 5.00),\n        (3.000, 0.250, 1.0, 0.00)\n    ]\n\n    results = []\n    for m, T, y_max, pT_min in test_cases:\n        # Handle the trivial case where the rapidity acceptance window is zero.\n        if y_max == 0.0:\n            results.append(0.0)\n            continue\n\n        # Calculate the denominator (total rate integral I_den).\n        # This has an analytical solution.\n        if m == 0.0:\n            # For a massless particle, the integral evaluates to T^2.\n            I_den = T**2\n        else:\n            # For a massive particle, the integral is expressed using the\n            # modified Bessel function of the second kind, K_1.\n            # I_den = m * T * K1(m/T)\n            # scipy.special.k1 computes K_1.\n            I_den = m * T * k1(m / T)\n        \n        # Guard against a non-physical case of zero denominator, though\n        # with T  0, this will not happen.\n        if I_den == 0:\n            # This case shouldn't be reached with valid physical inputs.\n            results.append(float('nan'))\n            continue\n\n        # Define the integrand for the numerator (accepted rate integral I_num).\n        # The integral is over rapidity y from 0 to y_max.\n        u_min = np.sqrt(m**2 + pT_min**2)\n        \n        def numerator_integrand(y):\n            \"\"\"\n            The integrand for the numerator integral I_num, as a function of y.\n            This function resulted from analytically integrating over pT first.\n            \"\"\"\n            cosh_y = np.cosh(y)\n            \n            # The exponential term dominates and ensures rapid convergence.\n            exp_term = np.exp(-(u_min * cosh_y) / T)\n            \n            # The term in parentheses.\n            bracket_term = (u_min * T) / cosh_y + T**2 / cosh_y**2\n            \n            return exp_term * bracket_term\n\n        # Numerically calculate the numerator integral I_num using quad.\n        # quad returns the integral result and an error estimate.\n        I_num, _ = quad(numerator_integrand, 0, y_max, epsabs=1e-12, epsrel=1e-12)\n        \n        # The acceptance fraction F is the ratio of the two integrals.\n        F = I_num / I_den\n        results.append(F)\n\n    # Final print statement in the exact required format.\n    # Results are formatted to 8 decimal places as floats.\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```", "id": "3532974"}, {"introduction": "在对相空间进行积分或生成事件之前，我们必须首先确定其物理边界。本次练习 [@problem_id:3532984] 深入探讨了三体衰变的运动学，教您如何运用能量-动量守恒等基本原理来判断一个给定的运动学构型是否物理上允许。掌握这些约束条件是构建真实事件生成器的第一步。", "problem": "实现一个程序，对于给定的母粒子静止系中的三体衰变，通过实施从第一性原理推导出的运动学约束，判断指定的成对不变质量是否对应于一个物理上允许的运动学构型。您必须检查三个独立的物理性充要条件：成对不变质量的三角不等式、各粒子能量的正定性，以及三动量格拉姆行列式的非负性。所有输入量都应在母粒子静止系中进行解释。\n\n给定一个质量为 $M$ 的母粒子，衰变为三个质量分别为 $m_1$、$m_2$ 和 $m_3$ 的子粒子。定义成对不变质量的平方为 $s_{ij} \\equiv m_{ij}^2 = (p_i + p_j)^2$，其中 $p_i$ 是满足在壳条件 $p_i^2 = m_i^2$ 的子粒子四动量，总四动量为 $P = p_1 + p_2 + p_3$ 且 $P^2 = M^2$。在母粒子静止系中，$P = (M,\\mathbf{0})$。对于任意选定的两个不变量 $s_{12}$ 和 $s_{23}$，第三个不变量 $s_{13}$ 由守恒定律确定：\n$$\ns_{13} = M^2 + m_1^2 + m_2^2 + m_3^2 - s_{12} - s_{23}.\n$$\n一个点 $(s_{12}, s_{23})$ 是物理上允许的，当且仅当以下所有条件都成立：\n- 对每一对 $(i,j)$ 的三角不等式：\n$$\ns_{ij} \\ge (m_i + m_j)^2.\n$$\n- 在母粒子静止系中，每个子粒子 $i$ 的能量和实三动量的正定性，其中\n$$\nE_i = \\frac{M^2 + m_i^2 - s_{jk}}{2 M}, \\quad \\text{其中 } \\{i,j,k\\} = \\{1,2,3\\},\n$$\n必须满足 $E_i \\ge m_i$，这意味着 $E_i \\ge 0$ 且 $E_i^2 - m_i^2 \\ge 0$。\n- 三动量格拉姆行列式非负，$G \\ge 0$，其中 $G$ 是母粒子质心（COM）系中子粒子三动量的 $3 \\times 3$ 欧几里得格拉姆矩阵 $\\mathcal{G}$ 的行列式。令 $\\mathbf{p}_i$ 为粒子 $i$ 的三动量，其大小为 $|\\mathbf{p}_i|^2 = E_i^2 - m_i^2$。$\\mathcal{G}$ 的非对角元完全由不变量和能量确定，无需显式角度，通过\n$$\n\\mathcal{G}_{ii} = |\\mathbf{p}_i|^2, \\quad \\mathcal{G}_{ij} = E_i E_j - \\frac{s_{ij} - m_i^2 - m_j^2}{2} \\quad \\text{对于 } i \\ne j,\n$$\n这样 $G = \\det \\mathcal{G} \\ge 0$ 保证了在三维空间中存在具有这些相互标量积和大小的三个实向量。数值检查必须容忍浮点数舍入误差；将与边界相差一个很小容差 $\\varepsilon$ 内的值视为满足该边界条件。\n\n您的任务是编写一个完整的程序，将这些检查应用于一个固定的测试套件。所有质量必须以吉电子伏特（$\\mathrm{GeV}$）为单位指定。所有不变质量的平方必须以 $\\mathrm{GeV}^2$ 为单位指定。每个测试用例的输出是一个布尔值，指示输入是否在这些标准下对应于一个物理的运动学构型。\n\n测试套件（每个案例格式为 ($M$, [$m_1,m_2,m_3$], $s_{12}$, $s_{23}$)）：\n- 案例1（正常路径，内部点）：$(3.0, [0.5, 0.4, 0.3], 1.01, 4.0)$。\n- 案例2（边界情况，一个子粒子静止；格拉姆行列式为零）：$(3.0, [0.5, 0.4, 0.3], 7.29, 1.05)$，注意 $7.29 = (3.0 - 0.3)^2$，且根据守恒定律，此选择意味着 $s_{13} = 1.16$。\n- 案例3（违反三角不等式）：$(3.0, [0.5, 0.4, 0.3], 0.80, 4.0)$。\n- 案例4（粒子1的能量正定性被违反）：$(3.0, [0.5, 0.4, 0.3], 1.01, 6.3)$。\n- 案例5（在三角不等式边界成立的情况下违反格拉姆行列式）：$(3.0, [0.5, 0.4, 0.3], 1.01, 6.0)$。\n- 案例6（无质量子粒子，边界点）：$(1.0, [0.0, 0.0, 0.0], 0.2, 0.3)$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表（例如，\"[result1,result2,...]\"）。对于给定的测试套件，输出应是一个包含六个布尔值的列表，其顺序与上述案例相同。不需要也不得使用角度；所有计算必须根据不变量、质量和母粒子质量进行，并使用给定的质心系定义。在与边界进行比较时，使用数值容差 $\\varepsilon = 10^{-10}$ 来考虑浮点误差。所有值都必须被视为具有上述指定的单位，不应使用其他单位。输出的布尔值必须是编程语言生成的原生布尔值，而不是字符串。", "solution": "确定三体衰变的物理区域问题是相对论运动学中的一个经典练习。解决方案的关键在于四动量守恒原理以及三维欧几里得空间中向量的几何特性。我们给定一个质量为 $M$ 的母粒子，衰变为三个质量分别为 $m_1, m_2, m_3$ 的子粒子。整个分析在母粒子的静止系中进行，其中其四动量为 $P = (M, \\mathbf{0})$。子粒子的四动量表示为 $p_i = (E_i, \\mathbf{p}_i)$，其中 $E_i$ 和 $\\mathbf{p}_i$ 分别是它们的能量和三动量。\n\n四动量守恒要求 $P = p_1 + p_2 + p_3$。一个关键的推论是，衰变的运动学构型不是任意的。可能结果的相空间是受约束的。对于三体衰变，这个相空间可以用两个独立变量来描述。一个方便的选择是三个可能的成对不变质量平方中的两个，记为 $s_{ij} = (p_i + p_j)^2$。问题将 $s_{12}$ 和 $s_{23}$ 指定为独立变量。\n\n第三个不变质量平方 $s_{13}$ 则由守恒定律确定。这可以通过对所有三个成对不变量求和来推导：\n$$\ns_{12} + s_{13} + s_{23} = (p_1+p_2)^2 + (p_1+p_3)^2 + (p_2+p_3)^2\n$$\n展开平方并使用在壳条件 $p_i^2=m_i^2$，我们得到：\n$$\ns_{12} + s_{13} + s_{23} = 2(m_1^2+m_2^2+m_3^2) + 2(p_1\\cdot p_2 + p_1\\cdot p_3 + p_2\\cdot p_3)\n$$\n根据总动量守恒，$P^2 = (p_1+p_2+p_3)^2$，我们有：\n$$\nM^2 = m_1^2+m_2^2+m_3^2 + 2(p_1\\cdot p_2 + p_1\\cdot p_3 + p_2\\cdot p_3)\n$$\n结合这两个结果，得到关系式 $s_{12} + s_{13} + s_{23} = M^2 + m_1^2 + m_2^2 + m_3^2$。解出 $s_{13}$ 就得到了问题陈述中提供的公式：\n$$\ns_{13} = M^2 + m_1^2 + m_2^2 + m_3^2 - s_{12} - s_{23}\n$$\n一个给定的点 $(s_{12}, s_{23})$ 是物理上允许的，当且仅当它满足三组独立的充要条件。我们的算法将依次检查这些条件中的每一个。\n\n首先，我们检查**三角不等式**。量 $\\sqrt{s_{ij}}$ 代表子粒子对 $(i, j)$ 在其组合质心系中的总能量。要生成这些粒子，该能量必须至少是它们静止质量的总和。因此，对于每一对 $(i,j)$，我们必须有 $\\sqrt{s_{ij}} \\ge m_i + m_j$。两边平方给出所述条件：\n$$\ns_{ij} \\ge (m_i + m_j)^2\n$$\n我们必须对所有三对进行验证：$(1,2)$、$(2,3)$ 和 $(1,3)$。\n\n其次，我们检查**能量的正定性**。在母粒子静止系中，每个子粒子的能量 $E_i$ 必须至少是其静止质量 $m_i$，即 $E_i \\ge m_i$。这确保了其动能为非负，并且其三动量大小 $|\\mathbf{p}_i| = \\sqrt{E_i^2 - m_i^2}$ 是一个实数。$E_i$ 的公式由 $s_{jk}$ 的定义推导而来：\n$$\ns_{jk} = (p_j+p_k)^2 = (P-p_i)^2 = P^2 - 2P \\cdot p_i + p_i^2\n$$\n在母粒子静止系中，$P=(M, \\mathbf{0})$ 且 $p_i=(E_i, \\mathbf{p}_i)$，所以 $P \\cdot p_i = M E_i$。代入此式以及在壳条件 $P^2=M^2$ 和 $p_i^2 = m_i^2$，得到 $s_{jk} = M^2 - 2ME_i + m_i^2$。解出 $E_i$ 得到所提供的公式，必须对每个子粒子 $i=1,2,3$ 进行检查：\n$$\nE_i = \\frac{M^2 + m_i^2 - s_{jk}}{2M} \\ge m_i\n$$\n\n第三，我们检查**三动量格拉姆行列式的非负性**。在母粒子静止系中，三个子粒子的动量之和必须为零：$\\mathbf{p}_1 + \\mathbf{p}_2 + \\mathbf{p}_3 = \\mathbf{0}$。这意味着这三个向量是线性相关的，因此必须共面。线性代数的一个基本结果表明，一组向量可以嵌入到 $n$ 维欧几里得空间中，当且仅当它们的格拉姆行列式为非负。对于我们在三维空间中的三个向量 $\\mathbf{p}_1, \\mathbf{p}_2, \\mathbf{p}_3$，格拉姆矩阵 $\\mathcal{G}$ 的元素为 $\\mathcal{G}_{ij} = \\mathbf{p}_i \\cdot \\mathbf{p}_j$。其行列式 $G = \\det(\\mathcal{G})$ 必须大于或等于零。由于这三个向量是共面的，对于任何物理构型，行列式必须恰好为零。负的行列式意味着在三维空间中不存在任何一组实向量 $\\mathbf{p}_i$ 能够满足指定的模长和相互点积，从而使得该构型非物理。$\\mathcal{G}$ 的元素是根据指定的不变量和能量计算的。对角元素是模长的平方 $|\\mathbf{p}_i|^2 = E_i^2 - m_i^2$。非对角元素由四维向量点积 $p_i \\cdot p_j = E_i E_j - \\mathbf{p}_i \\cdot \\mathbf{p}_j$ 和不变质量定义 $s_{ij} = m_i^2 + m_j^2 + 2p_i \\cdot p_j$ 推导得出：\n$$\n\\mathcal{G}_{ij} = \\mathbf{p}_i \\cdot \\mathbf{p}_j = E_i E_j - \\frac{s_{ij} - m_i^2 - m_j^2}{2}\n$$\n我们构建 $3 \\times 3$ 矩阵 $\\mathcal{G}$ 并计算其行列式 $G$。仅当 $G \\ge 0$ 时，该构型才是物理的。由于浮点运算，我们检查 $G \\ge -\\varepsilon$，其中 $\\varepsilon$ 是一个很小的容差。\n\n整体算法是取输入 $(M, [m_1,m_2,m_3], s_{12}, s_{23})$，计算 $s_{13}$，然后依次应用这三组检查。如果任何一项检查失败，该运动学点就是非物理的，我们立即得出结论。如果所有检查都通过，该点就是物理的。\n对所有不等式比较都使用数值容差 $\\varepsilon = 10^{-10}$，以稳健地处理浮点不精确性，尤其是在物理区域的边界上。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef is_physical(M, masses, s12, s23, tol=1e-10):\n    \"\"\"\n    Checks if a given kinematic configuration for a three-body decay is physical.\n\n    Args:\n        M (float): Mass of the parent particle.\n        masses (list[float]): List of the three daughter masses [m1, m2, m3].\n        s12 (float): Invariant mass squared of the pair (1, 2).\n        s23 (float): Invariant mass squared of the pair (2, 3).\n        tol (float): Numerical tolerance for floating-point comparisons.\n\n    Returns:\n        bool: True if the configuration is physical, False otherwise.\n    \"\"\"\n    m1, m2, m3 = masses\n    m1_sq, m2_sq, m3_sq = m1**2, m2**2, m3**2\n    M_sq = M**2\n\n    # Step 1: Calculate the dependent invariant mass squared, s13, from conservation.\n    s13 = M_sq + m1_sq + m2_sq + m3_sq - s12 - s23\n\n    # Step 2: Check the triangle inequalities for all three pairs.\n    # The condition is s_ij = (m_i + m_j)^2.\n    if s12  (m1 + m2)**2 - tol:\n        return False\n    if s23  (m2 + m3)**2 - tol:\n        return False\n    if s13  (m1 + m3)**2 - tol:\n        return False\n\n    # Step 3: Calculate daughter energies and check the energy positivity condition.\n    # The condition is E_i = m_i, which ensures a real-valued three-momentum.\n    # This also implicitly enforces the upper bounds on s_ij, e.g., s23 = (M-m1)^2.\n    \n    # Division by zero check for M\n    if M = 0:\n        return False\n        \n    E1 = (M_sq + m1_sq - s23) / (2 * M)\n    if E1  m1 - tol:\n        return False\n\n    E2 = (M_sq + m2_sq - s13) / (2 * M)\n    if E2  m2 - tol:\n        return False\n\n    E3 = (M_sq + m3_sq - s12) / (2 * M)\n    if E3  m3 - tol:\n        return False\n\n    # Step 4: Check if the three-momentum Gram determinant is non-negative.\n    # Calculate diagonal elements of the Gram matrix: G_ii = |p_i|^2 = E_i^2 - m_i^2\n    # The energy checks above ensure these are non-negative.\n    p1_sq = E1**2 - m1_sq\n    p2_sq = E2**2 - m2_sq\n    p3_sq = E3**2 - m3_sq\n\n    # Calculate off-diagonal elements: G_ij = p_i . p_j\n    p1_dot_p2 = E1 * E2 - (s12 - m1_sq - m2_sq) / 2\n    p1_dot_p3 = E1 * E3 - (s13 - m1_sq - m3_sq) / 2\n    p2_dot_p3 = E2 * E3 - (s23 - m2_sq - m3_sq) / 2\n\n    # Construct the Gram matrix and calculate its determinant.\n    gram_matrix = np.array([\n        [p1_sq,     p1_dot_p2, p1_dot_p3],\n        [p1_dot_p2, p2_sq,     p2_dot_p3],\n        [p1_dot_p3, p2_dot_p3, p3_sq]\n    ])\n    \n    det_G = np.linalg.det(gram_matrix)\n\n    # A negative determinant is unphysical.\n    if det_G  -tol:\n        return False\n\n    # If all checks pass, the configuration is physical.\n    return True\n\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Format: (M, [m1, m2, m3], s12, s23)\n    test_cases = [\n        (3.0, [0.5, 0.4, 0.3], 1.01, 4.0),\n        (3.0, [0.5, 0.4, 0.3], 7.29, 1.05),\n        (3.0, [0.5, 0.4, 0.3], 0.80, 4.0),\n        (3.0, [0.5, 0.4, 0.3], 1.01, 6.3),\n        (3.0, [0.5, 0.4, 0.3], 1.01, 6.0),\n        (1.0, [0.0, 0.0, 0.0], 0.2, 0.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        M, masses, s12, s23 = case\n        result = is_physical(M, masses, s12, s23)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The map(str, ...) converts boolean True/False to \"True\"/\"False\" string representation.\n    # The prompt requests native boolean values, which json.dumps would produce.\n    # To match the string format \"[True,False,...]\" `str.lower()` is needed for python's `True`.\n    print(f\"[{','.join(str(r).lower() for r in results)}]\")\n\nsolve()\n```", "id": "3532984"}, {"introduction": "物理过程在相空间中的分布很少是均匀的，它们常常由共振态等结构主导。本次练习 [@problem_id:3532946] 介绍了重要性抽样这一强大的蒙特卡洛技术，它是高效模拟此类过程的关键。您将学习如何生成遵循布莱特-维格纳（Breit-Wigner）分布的事件，并理解如何正确地为这些事件赋予权重以获得无偏的物理结果，这是粒子物理模拟的基石。", "problem": "你的任务是为中间不变质量平方变量 $m_{12}^2$ 设计并实现一个重要性采样方案，该变量的分布由一个共振传播子决定。目标是积分以下形式的函数\n$$\nI = \\int_{s_{\\min}}^{s_{\\max}} \\mathrm{d}x \\;\\frac{R(x)}{(x - M^2)^2 + (M\\Gamma)^2},\n$$\n其中 $x \\equiv m_{12}^2$，$M$ 是一个共振质量参数，$\\Gamma$ 是一个宽度参数，$R(x)$ 是一个在 $[s_{\\min}, s_{\\max}]$ 上可能变化的有界非负函数。所有量都应被视为无量纲。\n\n仅基于以下基本原则进行推导和算法设计：\n- 蒙特卡洛积分和重要性采样：对于目标积分 $I = \\int \\mathrm{d}x \\, H(x)$ 和一个支撑集覆盖积分域的归一化提议密度 $g(x)$，无偏估计量为 $\\hat{I} = \\frac{1}{N} \\sum_{i=1}^{N} \\frac{H(x_i)}{g(x_i)}$，其中 $x_i \\sim g$ 是独立同分布的。\n- 柯西分布：一个位置为 $a$、尺度为 $b$ 的标准柯西概率密度函数，其密度为 $f(x; a, b) = \\frac{1}{\\pi}\\frac{b}{(x-a)^2 + b^2}$，累积分布函数为 $F(x; a, b) = \\frac{1}{\\pi}\\arctan\\!\\left(\\frac{x-a}{b}\\right) + \\frac{1}{2}$。\n\n你必须完成的任务：\n1. 在有限区间 $[s_{\\min}, s_{\\max}]$ 上，构建一个与柯西（Breit-Wigner）函数成正比的归一化提议密度 $g(x)$，其位置为 $a = M^2$，尺度为 $b = M\\Gamma$。构建过程必须使用柯西分布到 $[s_{\\min}, s_{\\max}]$ 的截断。你的实现必须使用逆变换采样方案从这个截断的提议分布中生成样本 $x$。\n2. 从第一性原理出发，推导出相应的事件权重 $w(x)$，使得在从 $g(x)$ 采样的条件下，对 $I$ 的蒙特卡洛估计量保持无偏。你的推导必须从上述基本原则开始，不得使用任何专门的快捷公式。\n3. 实现一个程序，该程序：\n   - 对每个测试用例，使用逆变换采样从提议分布 $g(x)$ 中生成 $N$ 个独立样本。\n   - 对每个测试用例，使用推导出的事件权重计算 $I$ 的蒙特卡洛估计值。\n   - 在 $[s_{\\min}, s_{\\max}]$ 上使用数值积分计算 $I$ 的高精度参考值。\n   - 使用固定的随机种子，以确保结果是确定性和可重复的。\n\n角度单位约定：如果你的推导或实现中出现任何反三角函数，其结果必须以弧度为单位。\n\n测试套件：\n- 情况 1（正常路径，中等宽度，在范围内居中）：\n  - $M = 1.0$, $\\Gamma = 0.05$，所以 $a = M^2 = 1.0$, $b = M\\Gamma = 0.05$。\n  - $s_{\\min} = 0.5$, $s_{\\max} = 1.5$。\n  - $R(x) = 1$。\n  - $N = 200000$ 个样本。\n- 情况 2（变化的分子）：\n  - $M =  \\sqrt{2.0}$, $\\Gamma = 0.1414213562373095$，所以 $a = M^2 = 2.0$, $b = M\\Gamma = 0.2$。\n  - $s_{\\min} = 1.0$, $s_{\\max} = 3.0$。\n  - $R(x) = x$。\n  - $N = 200000$ 个样本。\n- 情况 3（共振中心在积分范围之外）：\n  - $M = \\sqrt{1.5}$, $\\Gamma = 0.08164965809277261$，所以 $a = M^2 = 1.5$, $b = M\\Gamma = 0.1224744871391589$；对于此测试，精确使用 $b = 0.1$。\n  - $s_{\\min} = 1.7$, $s_{\\max} = 2.0$。\n  - $R(x) = 1 + x^2$。\n  - $N = 200000$ 个样本。\n- 情况 4（宽区间上的窄宽度边缘情况）：\n  - $M = 3.0$, $\\Gamma = 0.005$，所以 $a = M^2 = 9.0$, $b = M\\Gamma = 0.015$。\n  - $s_{\\min} = 0.0$, $s_{\\max} = 20.0$。\n  - $R(x) = \\exp(-0.1 x)$。\n  - $N = 200000$ 个样本。\n\n实现细节：\n- 对所有伪随机数生成使用单一的固定随机种子 $12345$。\n- 对于 $[s_{\\min}, s_{\\max}]$ 上的截断柯西分布的逆变换采样器，使用标准柯西累积分布函数 $F(x; a, b)$ 及其逆函数。通过避免正切函数发散的精确端点来确保数值稳定性。\n- 高精度参考积分必须在 $[s_{\\min}, s_{\\max}]$ 上进行数值计算。\n\n要求的输出：\n- 对于每个测试用例，计算两个浮点数：\n  - 使用你的重要性采样权重计算的 $I$ 的蒙特卡洛估计值。\n  - 蒙特卡洛估计值与高精度数值积分参考值之间的绝对误差。\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。顺序必须是\n  $[\\hat{I}_1, \\Delta_1, \\hat{I}_2, \\Delta_2, \\hat{I}_3, \\Delta_3, \\hat{I}_4, \\Delta_4]$，\n  其中 $\\hat{I}_k$ 是情况 $k$ 的蒙特卡洛估计值，$\\Delta_k$ 是情况 $k$ 的绝对误差。\n- 所有输出都是无量纲的实数。不应包含任何单位。在内部适用的情况下，角度单位为弧度。", "solution": "问题要求设计并实现一个重要性采样方案，用于计算以下形式的积分\n$$\nI = \\int_{s_{\\min}}^{s_{\\max}} \\mathrm{d}x \\;\\frac{R(x)}{(x - M^2)^2 + (M\\Gamma)^2}\n$$\n其中被积函数由一个共振（Breit-Wigner）传播子主导。设位置参数为 $a = M^2$，尺度参数为 $b = M\\Gamma$。该积分可以写为 $I = \\int_{s_{\\min}}^{s_{\\max}} H(x) \\, \\mathrm{d}x$，被积函数为 $H(x) = \\frac{R(x)}{(x-a)^2 + b^2}$。\n\n重要性采样的核心原理是从一个与被积函数 $H(x)$ 形状相似的提议概率密度函数（PDF）$g(x)$ 中抽取样本 $x_i$，然后将积分估计值计算为加权样本的平均值：\n$$\n\\hat{I} = \\frac{1}{N} \\sum_{i=1}^{N} w(x_i) \\quad \\text{其中} \\quad w(x_i) = \\frac{H(x_i)}{g(x_i)}\n$$\n\n**1. 提议密度 $g(x)$ 的推导**\n\n一个合适的提议密度 $g(x)$ 应与被积函数 $H(x)$ 中引起较大变化的部分成正比，即 Breit-Wigner 项。我们为 $x \\in [s_{\\min}, s_{\\max}]$ 定义一个未归一化的提议函数 $p(x)$：\n$$\np(x) = \\frac{1}{(x-a)^2 + b^2}\n$$\n为了得到归一化的 PDF $g(x)$，我们必须将 $p(x)$ 除以它在定义域 $[s_{\\min}, s_{\\max}]$ 上的积分。设此归一化常数为 $\\mathcal{N}_p$。\n$$\n\\mathcal{N}_p = \\int_{s_{\\min}}^{s_{\\max}} p(x) \\, \\mathrm{d}x = \\int_{s_{\\min}}^{s_{\\max}} \\frac{1}{(x-a)^2 + b^2} \\, \\mathrm{d}x\n$$\n该积分为标准形式：\n$$\n\\int \\frac{1}{(x-a)^2 + b^2} \\, \\mathrm{d}x = \\frac{1}{b} \\arctan\\left(\\frac{x-a}{b}\\right) + C\n$$\n在积分上下限处求值，得到归一化常数：\n$$\n\\mathcal{N}_p = \\frac{1}{b} \\left[ \\arctan\\left(\\frac{s_{\\max}-a}{b}\\right) - \\arctan\\left(\\frac{s_{\\min}-a}{b}\\right) \\right]\n$$\n因此，归一化的提议 PDF $g(x)$ 定义为：\n$$\ng(x) = \\frac{p(x)}{\\mathcal{N}_p} = \\frac{1}{\\mathcal{N}_p} \\frac{1}{(x-a)^2 + b^2} \\quad \\text{对于 } x \\in [s_{\\min}, s_{\\max}]\n$$\n其他情况下 $g(x)=0$。\n\n**2. 逆变换采样器的推导**\n\n为了从 $g(x)$ 生成随机变量，我们使用逆变换采样方法。这需要找到 $g(x)$ 的累积分布函数（CDF）的反函数，我们将其表示为 $G(x)$。对于 $x \\in [s_{\\min}, s_{\\max}]$，CDF 为：\n$$\nG(x) = \\int_{s_{\\min}}^x g(t) \\, \\mathrm{d}t = \\frac{1}{\\mathcal{N}_p} \\int_{s_{\\min}}^x \\frac{1}{(t-a)^2 + b^2} \\, \\mathrm{d}t\n$$\n使用上一步中的原函数：\n$$\nG(x) = \\frac{1}{\\mathcal{N}_p b} \\left[ \\arctan\\left(\\frac{x-a}{b}\\right) - \\arctan\\left(\\frac{s_{\\min}-a}{b}\\right) \\right]\n$$\n代入 $\\mathcal{N}_p$ 的表达式：\n$$\nG(x) = \\frac{\\arctan\\left(\\frac{x-a}{b}\\right) - \\arctan\\left(\\frac{s_{\\min}-a}{b}\\right)}{\\arctan\\left(\\frac{s_{\\max}-a}{b}\\right) - \\arctan\\left(\\frac{s_{\\min}-a}{b}\\right)}\n$$\n为了找到反函数 $x=G^{-1}(u)$，我们设 $G(x) = u$，其中 $u$ 是从均匀分布 $\\mathcal{U}(0, 1)$ 中采样的随机变量。然后我们求解 $x$。令 $\\theta_y = \\arctan\\left(\\frac{y-a}{b}\\right)$。方程变为：\n$$\nu = \\frac{\\theta_x - \\theta_{s_{\\min}}}{\\theta_{s_{\\max}} - \\theta_{s_{\\min}}}\n$$\n求解 $\\theta_x$：\n$$\n\\theta_x = \\theta_{s_{\\min}} + u (\\theta_{s_{\\max}} - \\theta_{s_{\\min}})\n$$\n将 $\\theta_x = \\arctan\\left(\\frac{x-a}{b}\\right)$ 代回：\n$$\n\\arctan\\left(\\frac{x-a}{b}\\right) = \\theta_{s_{\\min}} + u (\\theta_{s_{\\max}} - \\theta_{s_{\\min}})\n$$\n最后，求解 $x$ 得到采样公式：\n$$\nx(u) = a + b \\tan\\left( \\theta_{s_{\\min}} + u (\\theta_{s_{\\max}} - \\theta_{s_{\\min}}) \\right)\n$$\n这个公式允许我们从一个均匀随机数 $u$ 生成一个根据 $g(x)$ 分布的样本 $x$。\n\n**3. 事件权重 $w(x)$ 的推导**\n\n事件权重 $w(x)$ 定义为原始被积函数 $H(x)$ 与提议 PDF $g(x)$ 的比值。\n$$\nw(x) = \\frac{H(x)}{g(x)} = \\frac{\\frac{R(x)}{(x-a)^2 + b^2}}{\\frac{1}{\\mathcal{N}_p} \\frac{1}{(x-a)^2 + b^2}}\n$$\n分母项 $(x-a)^2 + b^2$ 被消去，这是选择此重要性采样的主要好处。这一消去移除了方差的主要来源，留下一个更平滑的函数进行积分。权重简化为：\n$$\nw(x) = R(x) \\cdot \\mathcal{N}_p\n$$\n代入 $\\mathcal{N}_p$ 的表达式：\n$$\nw(x) = R(x) \\cdot \\frac{1}{b} \\left[ \\arctan\\left(\\frac{s_{\\max}-a}{b}\\right) - \\arctan\\left(\\frac{s_{\\min}-a}{b}\\right) \\right]\n$$\n积分 $I$ 的蒙特卡洛估计量是这些权重在 $N$ 个样本上的平均值：\n$$\n\\hat{I}_N = \\frac{1}{N} \\sum_{i=1}^N w(x_i)\n$$\n由于权重中涉及 `arctan` 函数和 $b$ 的部分是一个常数，我们称之为 $W_{const} = \\mathcal{N}_p$，因此估计量可以高效地写为：\n$$\n\\hat{I}_N = W_{const} \\cdot \\left( \\frac{1}{N} \\sum_{i=1}^N R(x_i) \\right) = W_{const} \\cdot \\langle R(x) \\rangle\n$$\n该表达式被实现用来寻找蒙特卡洛估计值。积分的参考值使用高精度数值积分计算，绝对误差是蒙特卡洛估计值与参考值之间的绝对差。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Solves the importance sampling problem for the given test cases.\n    \"\"\"\n\n    # Fixed random seed for reproducibility\n    SEED = 12345\n    rng = np.random.default_rng(SEED)\n\n    # Test cases defined in the problem statement.\n    # Structure: (M, Gamma, s_min, s_max, R_func, N, (optional_a, optional_b))\n    test_cases = [\n        (1.0, 0.05, 0.5, 1.5, lambda x: np.ones_like(x), 200000, None),\n        (np.sqrt(2.0), 0.1414213562373095, 1.0, 3.0, lambda x: x, 200000, None),\n        # For Case 3, a and b are specified explicitly in the problem.\n        # M and Gamma are for context. a=M^2=1.5, b=0.1\n        (np.sqrt(1.5), 0.08164965809277261, 1.7, 2.0, lambda x: 1 + x**2, 200000, (1.5, 0.1)),\n        (3.0, 0.005, 0.0, 20.0, lambda x: np.exp(-0.1 * x), 200000, None),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        M, Gamma, s_min, s_max, R_func, N, overrides = case\n\n        # Set resonance parameters a and b\n        if overrides:\n            a, b = overrides\n        else:\n            a = M**2\n            b = M * Gamma\n\n        # --- Importance Sampling ---\n\n        # 1. Calculate constants for sampling and weighting\n        theta_min = np.arctan((s_min - a) / b)\n        theta_max = np.arctan((s_max - a) / b)\n        \n        # 2. Generate N samples using inverse transform sampling\n        u = rng.uniform(size=N)\n        theta_samples = theta_min + u * (theta_max - theta_min)\n        x_samples = a + b * np.tan(theta_samples)\n        \n        # 3. Calculate constant part of the weight (the normalization constant N_p)\n        W_const = (theta_max - theta_min) / b\n\n        # 4. Compute the Monte Carlo estimate\n        R_values = R_func(x_samples)\n        I_hat = W_const * np.mean(R_values)\n        \n        # --- High-Accuracy Reference Calculation ---\n        \n        # Define the full integrand for numerical quadrature\n        integrand = lambda x: R_func(x) / ((x - a)**2 + b**2)\n        \n        # 5. Compute the reference integral using scipy.integrate.quad\n        I_ref, _ = integrate.quad(integrand, s_min, s_max, epsabs=1e-12, limit=200)\n\n        # 6. Calculate the absolute error\n        delta = abs(I_hat - I_ref)\n        \n        results.extend([I_hat, delta])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.8e}' for r in results)}]\")\n\nsolve()\n```", "id": "3532946"}]}