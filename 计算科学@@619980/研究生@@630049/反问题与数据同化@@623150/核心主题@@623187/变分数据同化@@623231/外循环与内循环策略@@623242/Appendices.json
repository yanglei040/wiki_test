{"hands_on_practices": [{"introduction": "此实践练习将聚焦于内循环的核心：求解线性化的优化问题。通过为给定的二次代价函数计算梯度和高斯-牛顿步长，您将掌握在变分资料同化设置中寻找最优增量的基本机制。这项练习巩固了构成更复杂同化方案基础的核心矩阵代数运算 [@problem_id:3409171]。", "problem": "考虑一个在外循环/内循环策略中出现的单观测增量变分资料同化内循环。设观测算子是线性的，由行向量 $\\,\\mathbf{H} = [\\,1,\\,2\\,]\\,$ 给出，其映射关系为 $\\mathbb{R}^{2}\\rightarrow\\mathbb{R}$。背景误差协方差为 $\\,\\mathbf{B}=\\mathrm{diag}(1,4)\\,$，观测误差方差为 $\\,\\mathbf{R}=0.5\\,$（一个标量）。假设当前外循环的线性化点为 $\\,\\mathbf{x}_{k}=\\begin{pmatrix}1\\\\-1\\end{pmatrix}\\,$，背景态为 $\\,\\mathbf{x}_{b}=\\begin{pmatrix}0\\\\0\\end{pmatrix}\\,$，观测值为 $\\,y=1\\,$。\n\n定义增量内循环代价函数（在三维变分（3D-Var）设置中，对一个可能非线性的观测算子进行线性化后使用）如下\n$$\nJ(\\delta \\mathbf{x}) \\;=\\; \\tfrac{1}{2}\\,(\\delta \\mathbf{x}-\\delta \\mathbf{x}_{b})^{\\top}\\,\\mathbf{B}^{-1}\\,(\\delta \\mathbf{x}-\\delta \\mathbf{x}_{b})\n\\;+\\;\\tfrac{1}{2}\\,\\bigl(\\mathbf{H}\\,\\delta \\mathbf{x}-\\mathbf{d}\\bigr)^{\\top}\\,\\mathbf{R}^{-1}\\,\\bigl(\\mathbf{H}\\,\\delta \\mathbf{x}-\\mathbf{d}\\bigr),\n$$\n其中 $\\,\\delta \\mathbf{x}=\\mathbf{x}-\\mathbf{x}_{k}\\,$，$\\,\\delta \\mathbf{x}_{b}=\\mathbf{x}_{b}-\\mathbf{x}_{k}\\,$，以及在线性化点的新息为 $\\,\\mathbf{d} = y - \\mathbf{H}\\,\\mathbf{x}_{k}\\,$。\n\n- 计算在初始内循环迭代点 $\\,\\delta \\mathbf{x}=\\mathbf{0}\\,$ 处的内循环梯度 $\\,\\nabla J(\\delta \\mathbf{x})\\,$。\n- 计算最小化 $\\,J(\\delta \\mathbf{x})\\,$ 的高斯-牛顿步 $\\,\\delta \\mathbf{x}^{\\star}\\,$。\n\n将最终答案以单个行矩阵 $\\,\\begin{pmatrix} g_{1} & g_{2} & \\delta x_{1}^{\\star} & \\delta x_{2}^{\\star}\\end{pmatrix}\\,$ 的形式给出，其中包含在 $\\,\\delta \\mathbf{x}=\\mathbf{0}\\,$ 处的梯度的两个分量，以及最小化步长的两个分量。所有值均需精确表示，无需四舍五入。", "solution": "该问题要求计算与增量变分资料同化代价函数 $J(\\delta \\mathbf{x})$ 相关的两个量。首先是在初始内循环迭代点 $\\delta \\mathbf{x} = \\mathbf{0}$ 处计算的代价函数梯度。其次是最小化 $J(\\delta \\mathbf{x})$ 的高斯-牛顿步 $\\delta \\mathbf{x}^{\\star}$。\n\n代价函数由下式给出\n$$\nJ(\\delta \\mathbf{x}) = \\frac{1}{2}(\\delta \\mathbf{x}-\\delta \\mathbf{x}_{b})^{\\top}\\mathbf{B}^{-1}(\\delta \\mathbf{x}-\\delta \\mathbf{x}_{b}) + \\frac{1}{2}(\\mathbf{H}\\delta \\mathbf{x}-\\mathbf{d})^{\\top}\\mathbf{R}^{-1}(\\mathbf{H}\\delta \\mathbf{x}-\\mathbf{d})\n$$\n给定的数据如下：\n- 观测算子：$\\mathbf{H} = \\begin{pmatrix} 1 & 2 \\end{pmatrix}$\n- 背景误差协方差：$\\mathbf{B} = \\begin{pmatrix} 1 & 0 \\\\ 0 & 4 \\end{pmatrix}$\n- 观测误差方差：$R = 0.5$\n- 外循环线性化点：$\\mathbf{x}_{k} = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$\n- 背景态：$\\mathbf{x}_{b} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$\n- 观测值：$y = 1$\n\n首先，我们必须计算定义的增量 $\\delta \\mathbf{x}_{b}$ 和 $\\mathbf{d}$。\n背景增量为 $\\delta \\mathbf{x}_{b} = \\mathbf{x}_{b} - \\mathbf{x}_{k}$：\n$$\n\\delta \\mathbf{x}_{b} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}\n$$\n线性化点上的新息 $\\mathbf{d}$ 定义为 $\\mathbf{d} = y - \\mathbf{H}\\mathbf{x}_{k}$。由于 $y$ 是一个标量，且 $\\mathbf{H}\\mathbf{x}_k$ 的结果也是一个标量，因此 $\\mathbf{d}$ 是一个标量。\n$$\n\\mathbf{H}\\mathbf{x}_{k} = \\begin{pmatrix} 1 & 2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = (1)(1) + (2)(-1) = 1 - 2 = -1\n$$\n$$\n\\mathbf{d} = 1 - (-1) = 2\n$$\n\n接下来，我们计算代价函数的梯度 $\\nabla J(\\delta \\mathbf{x})$。根据二次型的标准矩阵微积分法则，梯度为：\n$$\n\\nabla J(\\delta \\mathbf{x}) = \\mathbf{B}^{-1}(\\delta \\mathbf{x} - \\delta \\mathbf{x}_{b}) + \\mathbf{H}^{\\top}\\mathbf{R}^{-1}(\\mathbf{H}\\delta \\mathbf{x} - \\mathbf{d})\n$$\n我们需要在 $\\delta \\mathbf{x} = \\mathbf{0}$ 处计算该梯度：\n$$\n\\nabla J(\\mathbf{0}) = \\mathbf{B}^{-1}(\\mathbf{0} - \\delta \\mathbf{x}_{b}) + \\mathbf{H}^{\\top}\\mathbf{R}^{-1}(\\mathbf{H}\\mathbf{0} - \\mathbf{d}) = -\\mathbf{B}^{-1}\\delta \\mathbf{x}_{b} - \\mathbf{H}^{\\top}\\mathbf{R}^{-1}\\mathbf{d}\n$$\n我们需要逆矩阵 $\\mathbf{B}^{-1}$ 和 $\\mathbf{R}^{-1}$。\n$$\n\\mathbf{B} = \\begin{pmatrix} 1 & 0 \\\\ 0 & 4 \\end{pmatrix} \\implies \\mathbf{B}^{-1} = \\begin{pmatrix} 1^{-1} & 0 \\\\ 0 & 4^{-1} \\end{pmatrix} = \\begin{pmatrix} 1 & 0 \\\\ 0 & \\frac{1}{4} \\end{pmatrix}\n$$\n$$\nR = 0.5 = \\frac{1}{2} \\implies R^{-1} = 2\n$$\n现在，我们可以将这些值代入 $\\nabla J(\\mathbf{0})$ 的表达式中：\n$$\n\\nabla J(\\mathbf{0}) = - \\begin{pmatrix} 1 & 0 \\\\ 0 & \\frac{1}{4} \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix} - \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} (2) (2)\n= - \\begin{pmatrix} -1 \\\\ \\frac{1}{4} \\end{pmatrix} - 4 \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ -\\frac{1}{4} \\end{pmatrix} - \\begin{pmatrix} 4 \\\\ 8 \\end{pmatrix}\n$$\n$$\n\\nabla J(\\mathbf{0}) = \\begin{pmatrix} 1 - 4 \\\\ -\\frac{1}{4} - 8 \\end{pmatrix} = \\begin{pmatrix} -3 \\\\ -\\frac{1}{4} - \\frac{32}{4} \\end{pmatrix} = \\begin{pmatrix} -3 \\\\ -\\frac{33}{4} \\end{pmatrix}\n$$\n在 $\\delta \\mathbf{x}=\\mathbf{0}$ 处梯度的分量为 $g_1 = -3$ 和 $g_2 = -\\frac{33}{4}$。\n\n为了找到最小值点 $\\delta \\mathbf{x}^{\\star}$，我们将梯度 $\\nabla J(\\delta \\mathbf{x})$ 设为零。\n$$\n\\nabla J(\\delta \\mathbf{x}^{\\star}) = \\mathbf{B}^{-1}(\\delta \\mathbf{x}^{\\star} - \\delta \\mathbf{x}_{b}) + \\mathbf{H}^{\\top}\\mathbf{R}^{-1}(\\mathbf{H}\\delta \\mathbf{x}^{\\star} - \\mathbf{d}) = \\mathbf{0}\n$$\n整理各项，得到关于 $\\delta \\mathbf{x}^{\\star}$ 的一个线性方程组，其海森矩阵为 $\\nabla^2 J = (\\mathbf{B}^{-1} + \\mathbf{H}^{\\top}\\mathbf{R}^{-1}\\mathbf{H})$：\n$$\n(\\mathbf{B}^{-1} + \\mathbf{H}^{\\top}\\mathbf{R}^{-1}\\mathbf{H})\\delta \\mathbf{x}^{\\star} = \\mathbf{B}^{-1}\\delta \\mathbf{x}_{b} + \\mathbf{H}^{\\top}\\mathbf{R}^{-1}\\mathbf{d} = -\\nabla J(\\mathbf{0})\n$$\n我们来计算海森矩阵：\n$$\n\\mathbf{H}^{\\top}\\mathbf{R}^{-1}\\mathbf{H} = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} (2) \\begin{pmatrix} 1 & 2 \\end{pmatrix} = 2 \\begin{pmatrix} (1)(1) & (1)(2) \\\\ (2)(1) & (2)(2) \\end{pmatrix} = 2 \\begin{pmatrix} 1 & 2 \\\\ 2 & 4 \\end{pmatrix} = \\begin{pmatrix} 2 & 4 \\\\ 4 & 8 \\end{pmatrix}\n$$\n$$\n\\nabla^2 J = \\mathbf{B}^{-1} + \\mathbf{H}^{\\top}\\mathbf{R}^{-1}\\mathbf{H} = \\begin{pmatrix} 1 & 0 \\\\ 0 & \\frac{1}{4} \\end{pmatrix} + \\begin{pmatrix} 2 & 4 \\\\ 4 & 8 \\end{pmatrix} = \\begin{pmatrix} 3 & 4 \\\\ 4 & 8+\\frac{1}{4} \\end{pmatrix} = \\begin{pmatrix} 3 & 4 \\\\ 4 & \\frac{33}{4} \\end{pmatrix}\n$$\n右侧为 $-\\nabla J(\\mathbf{0}) = -\\begin{pmatrix} -3 \\\\ -\\frac{33}{4} \\end{pmatrix} = \\begin{pmatrix} 3 \\\\ \\frac{33}{4} \\end{pmatrix}$。\n求解 $\\delta \\mathbf{x}^{\\star} = \\begin{pmatrix} \\delta x_1^{\\star} \\\\ \\delta x_2^{\\star} \\end{pmatrix}$ 的线性方程组为：\n$$\n\\begin{pmatrix} 3 & 4 \\\\ 4 & \\frac{33}{4} \\end{pmatrix} \\begin{pmatrix} \\delta x_1^{\\star} \\\\ \\delta x_2^{\\star} \\end{pmatrix} = \\begin{pmatrix} 3 \\\\ \\frac{33}{4} \\end{pmatrix}\n$$\n这代表了两个联立方程：\n1) $3\\delta x_1^{\\star} + 4\\delta x_2^{\\star} = 3$\n2) $4\\delta x_1^{\\star} + \\frac{33}{4}\\delta x_2^{\\star} = \\frac{33}{4}$\n\n从方程（1），我们表示出 $\\delta x_1^{\\star}$：\n$$\n\\delta x_1^{\\star} = \\frac{3 - 4\\delta x_2^{\\star}}{3} = 1 - \\frac{4}{3}\\delta x_2^{\\star}\n$$\n将此代入方程（2）：\n$$\n4\\left(1 - \\frac{4}{3}\\delta x_2^{\\star}\\right) + \\frac{33}{4}\\delta x_2^{\\star} = \\frac{33}{4}\n$$\n$$\n4 - \\frac{16}{3}\\delta x_2^{\\star} + \\frac{33}{4}\\delta x_2^{\\star} = \\frac{33}{4}\n$$\n$$\n\\left(\\frac{33}{4} - \\frac{16}{3}\\right)\\delta x_2^{\\star} = \\frac{33}{4} - 4\n$$\n$$\n\\left(\\frac{99 - 64}{12}\\right)\\delta x_2^{\\star} = \\frac{33 - 16}{4}\n$$\n$$\n\\frac{35}{12}\\delta x_2^{\\star} = \\frac{17}{4}\n$$\n$$\n\\delta x_2^{\\star} = \\frac{17}{4} \\cdot \\frac{12}{35} = \\frac{17 \\cdot 3}{35} = \\frac{51}{35}\n$$\n现在，将 $\\delta x_2^{\\star}$ 代回以求得 $\\delta x_1^{\\star}$：\n$$\n\\delta x_1^{\\star} = 1 - \\frac{4}{3}\\left(\\frac{51}{35}\\right) = 1 - \\frac{4 \\cdot 17}{35} = 1 - \\frac{68}{35} = \\frac{35-68}{35} = -\\frac{33}{35}\n$$\n因此最小值点为 $\\delta \\mathbf{x}^{\\star} = \\begin{pmatrix} -\\frac{33}{35} \\\\ \\frac{51}{35} \\end{pmatrix}$。\n\n最终答案要求一个行矩阵，包含梯度的两个分量，后跟最小化步长的两个分量：$\\begin{pmatrix} g_1 & g_2 & \\delta x_1^{\\star} & \\delta x_2^{\\star} \\end{pmatrix}$。\n$$\n\\begin{pmatrix} -3 & -\\frac{33}{4} & -\\frac{33}{35} & \\frac{51}{35} \\end{pmatrix}\n$$", "answer": "$$\n\\boxed{\\begin{pmatrix} -3 & -\\frac{33}{4} & -\\frac{33}{35} & \\frac{51}{35} \\end{pmatrix}}\n$$", "id": "3409171"}, {"introduction": "在练习了内循环的力学原理之后，我们现在将其置于外循环迭代的完整背景中。本练习处理一个带有非线性观测算子的问题，展示了为何需要迭代式的外循环。您将执行一个完整的循环：将算子线性化，求解由此产生的内循环问题以获得增量，并更新状态估计，从而了解两个循环如何协同工作 [@problem_id:3409194]。", "problem": "考虑一个标量变分数据同化问题，其中状态变量为 $x \\in \\mathbb{R}$，观测算子为非线性的，由 $\\mathcal{H}(x)=\\sin(x)$ 给出。标准的变分数据同化代价泛函为\n$$\nJ(x) = \\frac{1}{2} (x - x_{b})^{\\top} B^{-1} (x - x_{b}) + \\frac{1}{2} \\big(y - \\mathcal{H}(x)\\big)^{\\top} R^{-1} \\big(y - \\mathcal{H}(x)\\big),\n$$\n其中 $x_{b}$ 是背景（先验）状态，$B$ 是背景误差协方差，$y$ 是观测值，$R$ 是观测误差协方差。在增量外循环和内循环策略中，我们在当前的外循环线性化点 $x_{0}$ 处对观测算子进行线性化，记 $x = x_{0} + \\delta x$，并在更新 $x$ 和重新线性化之前，求解关于增量 $\\delta x$ 的内循环二次问题。\n\n给定标量数据 $x_{b} = 0$，$B = 1$，$R = 0.1$，$y = 0.5$，从 $x_{0} = x_{b}$ 开始执行一步外循环，如下所示：\n- 在 $x_{0}$ 处使用 $\\mathcal{H}(x)$ 的一阶泰勒线性化，构建关于增量 $\\delta x$ 的相应内循环二次代价函数，并通过解析最小化求得内循环解 $\\delta x$。\n- 应用外循环更新 $x_{1} = x_{0} + \\delta x$。\n\n如果可能，请将最终数值精确表示为分数。无需四舍五入。最终答案必须是包含 $\\delta x$ 和 $x_{1}$ 的数对，写成一个单行矩阵。", "solution": "本问题要求使用增量外循环/内循环策略，对一个非线性数据同化问题执行一步更新。\n\n首先，我们设置内循环问题。这需要将非线性观测算子 $\\mathcal{H}(x)$ 在当前的外循环点 $x_0$ 处进行线性化。对于这个标量问题，代价泛函是：\n$$\nJ(x) = \\frac{1}{2} \\frac{(x - x_{b})^{2}}{B} + \\frac{1}{2} \\frac{(y - \\mathcal{H}(x))^{2}}{R}\n$$\n增量方法寻求一个解 $x$ 作为对当前猜测 $x_{0}$ 的更新，即 $x = x_{0} + \\delta x$。代价函数通过在线性化点 $x_{0}$ 处对非线性算子 $\\mathcal{H}(x)$ 进行泰勒展开，近似为关于增量 $\\delta x$ 的二次函数。\n\n$\\mathcal{H}(x)$ 在 $x_{0}$ 处的一阶泰勒展开为：\n$$\n\\mathcal{H}(x) = \\mathcal{H}(x_{0} + \\delta x) \\approx \\mathcal{H}(x_{0}) + H \\delta x\n$$\n其中 $H$ 是 $\\mathcal{H}(x)$ 关于 $x$ 的导数在 $x_{0}$ 处的值。给定 $\\mathcal{H}(x) = \\sin(x)$，其导数为 $\\mathcal{H}'(x) = \\cos(x)$。\n线性化在 $x_{0} = x_{b} = 0$ 处进行。因此，线性化算子（雅可比矩阵）为 $H = \\mathcal{H}'(x_{0}) = \\cos(0) = 1$。观测算子在线性化点的值为 $\\mathcal{H}(x_{0}) = \\sin(0) = 0$。\n\n将线性化结果代入完整的代价泛函 $J(x)$，得到内循环代价函数 $J_{\\text{inner}}(\\delta x)$：\n$$\nJ_{\\text{inner}}(\\delta x) = \\frac{1}{2} \\frac{(x_{0} + \\delta x - x_{b})^{2}}{B} + \\frac{1}{2} \\frac{(y - (\\mathcal{H}(x_{0}) + H \\delta x))^{2}}{R}\n$$\n现在，我们代入给定的数值：$x_{b} = 0$, $B = 1$, $y = 0.5 = \\frac{1}{2}$, $R = 0.1 = \\frac{1}{10}$, $x_{0} = 0$, $\\mathcal{H}(x_{0}) = 0$, $H = 1$。\n内循环代价函数变为：\n$$\nJ_{\\text{inner}}(\\delta x) = \\frac{1}{2} \\frac{(0 + \\delta x - 0)^{2}}{1} + \\frac{1}{2} \\frac{(\\frac{1}{2} - (0 + 1 \\cdot \\delta x))^{2}}{\\frac{1}{10}}\n$$\n$$\nJ_{\\text{inner}}(\\delta x) = \\frac{1}{2} (\\delta x)^{2} + 5 \\left(\\frac{1}{2} - \\delta x\\right)^{2}\n$$\n为了找到使该二次代价函数最小化的增量 $\\delta x$，我们计算其关于 $\\delta x$ 的导数并将其设为零。\n$$\n\\frac{d J_{\\text{inner}}}{d (\\delta x)} = \\delta x + 5 \\cdot 2 \\left(\\frac{1}{2} - \\delta x\\right) \\cdot (-1) = \\delta x - 5 + 10 \\delta x = 11 \\delta x - 5\n$$\n将导数设为零以求最小值：\n$$\n11 \\delta x - 5 = 0 \\implies \\delta x = \\frac{5}{11}\n$$\n由于二阶导数 $\\frac{d^{2} J_{\\text{inner}}}{d (\\delta x)^{2}} = 11 > 0$，这证实了该 $\\delta x$ 值对应于一个最小值。\n\n最后一步是外循环更新，以获得新的状态估计值 $x_{1}$：\n$$\nx_{1} = x_{0} + \\delta x\n$$\n由于 $x_{0} = 0$ 且 $\\delta x = \\frac{5}{11}$，我们有：\n$$\nx_{1} = 0 + \\frac{5}{11} = \\frac{5}{11}\n$$\n问题要求得到数对 $\\delta x$ 和 $x_{1}$。解为 $\\delta x = \\frac{5}{11}$ 和 $x_{1} = \\frac{5}{11}$。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{5}{11} & \\frac{5}{11} \\end{pmatrix}}\n$$", "id": "3409194"}, {"introduction": "变分方法的威力不仅限于估计系统状态。这个高级实践练习展示了外循环/内循环策略如何应用于联合状态和参数估计这一重要问题。通过处理一个增广的状态向量，您将学习如何与状态变量一起同时改进模型的参数，这是提高预测模型的关键技能 [@problem_id:3409148]。", "problem": "考虑一个单一标量观测的联合状态-参数变分数据同化问题，其观测算子定义为 $h(x,p)=p\\,x$。设增广控制向量为 $z=\\begin{pmatrix}x & p\\end{pmatrix}^{\\top}$。假设高斯先验为 $z\\sim\\mathcal{N}(z_{b},B)$，其中 $z_{b}=\\begin{pmatrix}x_{b} & p_{b}\\end{pmatrix}^{\\top}$ 且 $B=\\mathrm{diag}(1,1)$；并假设高斯似然为 $y\\mid z\\sim\\mathcal{N}(h(x,p),R)$，其中 $R=0.1$。最大后验 (MAP) 估计通过最小化以下二次贝叶斯目标函数得到\n$$\nJ(z)=\\frac{1}{2}\\,(z-z_{b})^{\\top}B^{-1}(z-z_{b})+\\frac{1}{2}\\,\\big(y-h(x,p)\\big)^{\\top}R^{-1}\\big(y-h(x,p)\\big).\n$$\n采用外循环和内循环策略：在外循环索引为 $k$ 时，在当前迭代点 $z^{k}$ 处对观测算子进行线性化，然后在内循环中精确求解关于增量 $\\delta z=z-z^{k}$ 的线性化高斯最小二乘问题（这等价于求解与线性化的 Karush–Kuhn–Tucker 条件相关的内对称块系统）。从背景场 $x_{b}=1$ 和 $p_{b}=2$ 以及标量观测 $y=3$ 开始，通过在 $z^{0}=z_{b}$ 处进行线性化并精确求解内问题来执行一次外循环更新，以获得 $z^{1}=z^{0}+\\delta z$。使用行矩阵表示法，将最终答案表示为精确的数对 $\\begin{pmatrix}x^{1} & p^{1}\\end{pmatrix}$。无需四舍五入，且不涉及物理单位。", "solution": "该问题要求在一个联合状态-参数估计的设定下，执行一步外循环/内循环更新。其基础是在高斯先验和高斯似然假设下的贝叶斯推断，其最大后验 (MAP) 估计通过最小化代价函数 $J(z)$ 得到。\n\n我们采用外循环和内循环策略。在外循环的第 $k$ 次迭代，我们在当前点 $z^{k}$ 处对非线性观测算子 $h(x,p)$进行线性化，然后为增量 $\\delta z = z - z^{k}$ 求解一个二次代价函数。$h$ 在 $z^{k}$ 处的线性化为：\n$$\nh(x,p) \\approx h(x^{k},p^{k}) + G^{k}\\,\\delta z\n$$\n其中 $G^{k}$ 是 $h$ 关于 $(x,p)$ 在 $z^{k}$ 处的雅可比矩阵：\n$$\nG^{k} = \\begin{pmatrix}\\frac{\\partial h}{\\partial x} & \\frac{\\partial h}{\\partial p}\\end{pmatrix}\\bigg|_{(x^{k},p^{k})} = \\begin{pmatrix}p^{k} & x^{k}\\end{pmatrix}\n$$\n线性化的新息（innovation）为 $d^{k} = y - h(x^{k},p^{k})$。由于我们从 $z^0 = z_b$ 开始，背景项 $(z^0 + \\delta z - z_b)$ 简化为 $\\delta z$。内循环的增量代价函数变为：\n$$\nJ_{k}(\\delta z) = \\frac{1}{2}\\,\\delta z^{\\top}B^{-1}\\delta z + \\frac{1}{2}\\,\\big(d^{k}-G^{k}\\delta z\\big)^{\\top}R^{-1}\\big(d^{k}-G^{k}\\delta z\\big)\n$$\n将关于 $\\delta z$ 的梯度设为零，得到正规方程：\n$$\n\\big(B^{-1}+(G^{k})^{\\top}R^{-1}G^{k}\\big)\\,\\delta z = (G^{k})^{\\top}R^{-1}d^{k}\n$$\n我们现在代入 $k=0$ 时的数据，以初始迭代点 $z^{0} = z_{b}$ 开始：\n$$\nx^{0} = x_{b} = 1, \\quad p^{0} = p_{b} = 2, \\quad B = \\mathrm{diag}(1,1), \\quad R=0.1, \\quad y=3\n$$\n首先计算在 $z^{0}$ 处的雅可比矩阵：\n$$\nG^{0} = \\begin{pmatrix}p^{0} & x^{0}\\end{pmatrix} = \\begin{pmatrix}2 & 1\\end{pmatrix}\n$$\n计算新息：\n$$\nd^{0} = y - h(x^{0},p^{0}) = 3 - (p^{0}x^{0}) = 3 - (2 \\cdot 1) = 1\n$$\n接下来，构建正规方程中的矩阵。我们有 $B^{-1}=\\mathrm{diag}(1,1)$ 和 $R^{-1}=\\frac{1}{0.1}=10$。海森矩阵的观测部分为：\n$$\n(G^{0})^{\\top}R^{-1}G^{0} = 10\\,(G^{0})^{\\top}G^{0} = 10\\begin{pmatrix}2 \\\\ 1\\end{pmatrix}\\begin{pmatrix}2 & 1\\end{pmatrix} = 10\\begin{pmatrix}4 & 2 \\\\ 2 & 1\\end{pmatrix} = \\begin{pmatrix}40 & 20 \\\\ 20 & 10\\end{pmatrix}\n$$\n完整的（近似）海森矩阵为：\n$$\nM := B^{-1}+(G^{0})^{\\top}R^{-1}G^{0} = \\begin{pmatrix}1 & 0 \\\\ 0 & 1\\end{pmatrix} + \\begin{pmatrix}40 & 20 \\\\ 20 & 10\\end{pmatrix} = \\begin{pmatrix}41 & 20 \\\\ 20 & 11\\end{pmatrix}\n$$\n方程的右侧为：\n$$\nb := (G^{0})^{\\top}R^{-1}d^{0} = 10 \\cdot d^{0} \\cdot (G^{0})^{\\top} = 10 \\cdot 1 \\cdot \\begin{pmatrix}2 \\\\ 1\\end{pmatrix} = \\begin{pmatrix}20 \\\\ 10\\end{pmatrix}\n$$\n我们需要求解线性系统 $M\\,\\delta z=b$。首先计算 $M$ 的逆矩阵。其行列式为：\n$$\n\\det(M) = 41 \\cdot 11 - 20 \\cdot 20 = 451 - 400 = 51\n$$\n因此，逆矩阵为：\n$$\nM^{-1} = \\frac{1}{\\det(M)}\\begin{pmatrix}11 & -20 \\\\ -20 & 41\\end{pmatrix} = \\frac{1}{51}\\begin{pmatrix}11 & -20 \\\\ -20 & 41\\end{pmatrix}\n$$\n解 $\\delta z$ 为：\n$$\n\\delta z = M^{-1}b = \\frac{1}{51}\\begin{pmatrix}11 & -20 \\\\ -20 & 41\\end{pmatrix}\\begin{pmatrix}20 \\\\ 10\\end{pmatrix} = \\frac{1}{51}\\begin{pmatrix}11 \\cdot 20 - 20 \\cdot 10 \\\\ -20 \\cdot 20 + 41 \\cdot 10\\end{pmatrix} = \\frac{1}{51}\\begin{pmatrix}220-200 \\\\ -400+410\\end{pmatrix} = \\frac{1}{51}\\begin{pmatrix}20 \\\\ 10\\end{pmatrix}\n$$\n因此，增量为 $\\delta x=\\frac{20}{51}$ 和 $\\delta p=\\frac{10}{51}$。\n\n最后，执行外循环更新：\n$$\nz^{1} = z^{0}+\\delta z = \\begin{pmatrix}x^{0} \\\\ p^{0}\\end{pmatrix} + \\begin{pmatrix}\\delta x \\\\ \\delta p\\end{pmatrix} = \\begin{pmatrix}1 \\\\ 2\\end{pmatrix} + \\begin{pmatrix}\\frac{20}{51} \\\\ \\frac{10}{51}\\end{pmatrix} = \\begin{pmatrix}\\frac{71}{51} \\\\ \\frac{112}{51}\\end{pmatrix}\n$$\n所求的数对 $\\begin{pmatrix}x^{1} & p^{1}\\end{pmatrix}$ 为 $\\begin{pmatrix}\\frac{71}{51} & \\frac{112}{51}\\end{pmatrix}$。", "answer": "$$\\boxed{\\begin{pmatrix}\\frac{71}{51} & \\frac{112}{51}\\end{pmatrix}}$$", "id": "3409148"}]}