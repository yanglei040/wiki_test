{"hands_on_practices": [{"introduction": "为了真正理解单元锁定现象，我们必须回归到本构方程和有限元离散化的基本原理。这个练习将引导你通过分析一个简单的四节点四边形（Q4）单元，在材料接近不可压缩极限（即泊松比 $\\nu \\to 0.5$）时，从第一性原理推导出其刚度矩阵的病态行为。通过这种方式，你将亲手揭示体积锁定问题的数学根源，为后续学习如何解决这一问题奠定坚实的理论基础 [@problem_id:3522660]。", "problem": "考虑一个处于平面应变状态的单位正方形区域 $\\Omega=[0,1]\\times[0,1]$，该区域由杨氏模量为 $E$、泊松比为 $\\nu$ 的均匀、各向同性、线弹性材料占据。边界 $\\partial\\Omega$ 承受均匀的静水压力 $\\mathbf{t}=-p\\,\\mathbf{n}$，其中 $p>0$ 是常数，$\\mathbf{n}$ 是外单位法向量。使用单个具有完全 $2\\times 2$ Gauss 积分的双线性四节点四边形单元 (Q4) 对 $\\Omega$ 进行离散化。采用完全积分的四节点四边形 (Q4) 单元能精确再现常数应变场。\n\n从平面应变下各向同性线弹性的基本本构律和 Lamé 参数的定义出发，分析在均匀静水加载下，与 Q4 单元能精确再现的常数应变子空间相关联的刚度算子。设 Voigt 形式的材料刚度矩阵表示为 $\\mathbf{D}$，单元刚度为 $\\mathbf{K}_e = \\int_{\\Omega} \\mathbf{B}^{\\top} \\mathbf{D} \\mathbf{B} \\, \\mathrm{d}\\Omega$，其中 $\\mathbf{B}$ 是应变-位移矩阵。重点分析 $\\mathbf{K}_e$ 在由均匀体积应变模式、偏应变模式和均匀剪切模式所张成的三维常数应变子空间上的限制。\n\n从第一性原理推导各向同性平面应变材料刚度 $\\mathbf{D}$ 在此常数应变子空间上的特征结构，并通过计算其最大正特征值与最小正特征值的比值，推导出 $\\mathbf{K}_e$ 以 $\\nu$ 表示的条件数。使用适用于平面应变情况的 $E$、$\\nu$ 与 Lamé 参数 $\\lambda$ 和 $\\mu$ 之间的关系。你的最终答案必须是关于 $\\nu$ 的单个封闭形式解析表达式，该表达式能捕捉当 $\\nu \\to 0.5$ 时条件数的变化，从而量化在静水加载下与体积锁定相关的表观体积刚度的增加。无需进行数值计算。", "solution": "该问题要求分析在平面应变条件下，当材料接近不可压缩极限 ($\\nu \\to 0.5$) 时，单个四节点四边形 (Q4) 单元的刚度算子的条件数。分析被限制在常数应变子空间内，问题陈述指出，采用完全积分的 Q4 单元能精确再现该子空间。这一关键事实意味着，单元在这些模式下的刚度行为是其基础材料本构响应的直接反映。因此，问题简化为分析平面应变材料刚度矩阵 $\\mathbf{D}$ 的特征结构。条件数被定义为该算子的最大正特征值与最小正特征值的比值。\n\n首先，我们建立在平面应变条件下，均匀、各向同性、线弹性材料的刚度矩阵 $\\mathbf{D}$。通用的三维本构律 (Hooke's Law) 由下式给出：\n$$ \\boldsymbol{\\sigma} = \\lambda \\text{tr}(\\boldsymbol{\\varepsilon}) \\mathbf{I} + 2\\mu \\boldsymbol{\\varepsilon} $$\n其中 $\\boldsymbol{\\sigma}$ 是应力张量，$\\boldsymbol{\\varepsilon}$ 是应变张量，$\\mathbf{I}$ 是二阶单位张量，$\\lambda$ 和 $\\mu$ 是 Lamé 参数。参数 $\\mu$ 是剪切模量，也记作 $G$。\n\n在平面应变中，垂直于平面的应变分量为零：$\\varepsilon_{zz} = \\varepsilon_{xz} = \\varepsilon_{yz} = 0$。应变张量的迹（体积应变）简化为 $\\text{tr}(\\boldsymbol{\\varepsilon}) = \\varepsilon_{xx} + \\varepsilon_{yy}$。平面内应力分量为：\n$$ \\sigma_{xx} = \\lambda(\\varepsilon_{xx} + \\varepsilon_{yy}) + 2\\mu \\varepsilon_{xx} = (\\lambda + 2\\mu)\\varepsilon_{xx} + \\lambda\\varepsilon_{yy} $$\n$$ \\sigma_{yy} = \\lambda(\\varepsilon_{xx} + \\varepsilon_{yy}) + 2\\mu \\varepsilon_{yy} = \\lambda\\varepsilon_{xx} + (\\lambda + 2\\mu)\\varepsilon_{yy} $$\n$$ \\sigma_{xy} = 2\\mu \\varepsilon_{xy} $$\n使用 Voigt 记法，并采用工程剪切应变 $\\gamma_{xy} = 2\\varepsilon_{xy}$，应力向量和应变向量分别为 $\\boldsymbol{\\sigma} = [\\sigma_{xx}, \\sigma_{yy}, \\tau_{xy}]^\\top$ 和 $\\boldsymbol{\\varepsilon} = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^\\top$。应力-应变关系 $\\boldsymbol{\\sigma} = \\mathbf{D}\\boldsymbol{\\varepsilon}$ 由下式给出：\n$$ \\begin{pmatrix} \\sigma_{xx} \\\\ \\sigma_{yy} \\\\ \\tau_{xy} \\end{pmatrix} = \\begin{pmatrix} \\lambda + 2\\mu  \\lambda  0 \\\\ \\lambda  \\lambda + 2\\mu  0 \\\\ 0  0  \\mu \\end{pmatrix} \\begin{pmatrix} \\varepsilon_{xx} \\\\ \\varepsilon_{yy} \\\\ \\gamma_{xy} \\end{pmatrix} $$\n因此，材料刚度矩阵为：\n$$ \\mathbf{D} = \\begin{pmatrix} \\lambda + 2\\mu  \\lambda  0 \\\\ \\lambda  \\lambda + 2\\mu  0 \\\\ 0  0  \\mu \\end{pmatrix} $$\nLamé 参数与杨氏模量 $E$ 和泊松比 $\\nu$ 的关系如下：\n$$ \\mu = \\frac{E}{2(1+\\nu)} $$\n$$ \\lambda = \\frac{\\nu E}{(1+\\nu)(1-2\\nu)} $$\n接下来，我们求解 $\\mathbf{D}$ 的特征值，以理解其沿主应变方向的刚度特性。矩阵 $\\mathbf{D}$ 是块对角矩阵。一个特征值可以直接从剪切分量中读出：\n$$ k_1 = \\mu $$\n对应的特征向量是 $[0, 0, 1]^\\top$，代表纯剪切应变模式。\n\n另外两个特征值可以从左上角的 $2 \\times 2$ 子块中求得：\n$$ \\mathbf{D}_{11,22} = \\begin{pmatrix} \\lambda + 2\\mu  \\lambda \\\\ \\lambda  \\lambda + 2\\mu \\end{pmatrix} $$\n特征方程为 $\\det(\\mathbf{D}_{11,22} - k\\mathbf{I}) = 0$：\n$$ (\\lambda + 2\\mu - k)^2 - \\lambda^2 = 0 $$\n$$ ((\\lambda + 2\\mu - k) - \\lambda)((\\lambda + 2\\mu - k) + \\lambda) = 0 $$\n$$ (2\\mu - k)(2\\lambda + 2\\mu - k) = 0 $$\n这便得出了剩下的两个特征值：\n$$ k_2 = 2\\mu $$\n$$ k_3 = 2\\lambda + 2\\mu $$\n$k_2 = 2\\mu$ 对应的特征向量与 $[1, -1, 0]^\\top$ 成正比，代表纯偏（体积保持）应变模式。$k_3 = 2\\lambda+2\\mu$ 对应的特征向量与 $[1, 1, 0]^\\top$ 成正比，代表纯体积（膨胀）应变模式。\n因此，$\\mathbf{D}$ 的特征值集合为 $\\{ \\mu, 2\\mu, 2\\lambda+2\\mu \\}$。\n\n问题陈述指出，静水加载会激发体积模式。这对应于特征值 $k_{\\text{vol}} = 2\\lambda + 2\\mu$，它决定了材料抵抗体积变形的刚度。其他特征值 $k_{\\text{dev}} = 2\\mu$ 和 $k_{\\text{shear}} = \\mu$ 与剪切变形有关。\n\n对于物理上真实的材料，$E>0$ 且 $\\nu \\in [0, 0.5)$，这意味着 $\\lambda>0$ 且 $\\mu>0$。因此，特征值排序如下：\n$k_{\\text{max}} = 2\\lambda + 2\\mu$\n$k_{\\min} = \\mu$\n\n刚度算子 $\\mathbf{D}$ 的条件数 $\\kappa$ 是其最大正特征值与最小正特征值的比值：\n$$ \\kappa(\\mathbf{D}) = \\frac{k_{\\text{max}}}{k_{\\text{min}}} = \\frac{2\\lambda + 2\\mu}{\\mu} = 2\\frac{\\lambda}{\\mu} + 2 $$\n为了分析当 $\\nu \\to 0.5$ 时的行为，我们将该比值用 $\\nu$ 表示。Lamé 参数的比值为：\n$$ \\frac{\\lambda}{\\mu} = \\frac{\\frac{\\nu E}{(1+\\nu)(1-2\\nu)}}{\\frac{E}{2(1+\\nu)}} = \\frac{\\nu E}{(1+\\nu)(1-2\\nu)} \\cdot \\frac{2(1+\\nu)}{E} = \\frac{2\\nu}{1-2\\nu} $$\n将此代入条件数的表达式中：\n$$ \\kappa = 2\\left(\\frac{2\\nu}{1-2\\nu}\\right) + 2 = \\frac{4\\nu + 2(1-2\\nu)}{1-2\\nu} = \\frac{4\\nu + 2 - 4\\nu}{1-2\\nu} = \\frac{2}{1-2\\nu} $$\n这个表达式量化了材料刚度的条件数。随着泊松比 $\\nu$ 接近不可压缩极限 0.5，分母 $(1-2\\nu)$ 接近 0，条件数 $\\kappa$ 发散至无穷大。\n$$ \\lim_{\\nu \\to 0.5} \\kappa = \\lim_{\\nu \\to 0.5} \\frac{2}{1-2\\nu} = \\infty $$\n这种病态条件是采用完全积分的低阶有限元中体积锁定的根本原因。与体积应变模式相关的刚度 ($k_{\\text{vol}} \\propto \\lambda$) 相对于剪切模式的刚度 ($k_{\\text{shear}} = \\mu$，其保持有限) 变得无限大。一种在运动学上无法适应近零体积应变约束的单元格式将表现出人为的过刚或“锁定”响应。推导出的表达式精确地捕捉了这种刚度差异的病态增长。\n单元刚度矩阵 $\\mathbf{K}_e$ 在常数应变子空间上的条件数直接由 $\\mathbf{D}$ 的条件数决定，因为单元运动学精确地表示了这些常数应变场。因此，受限的 $\\mathbf{K}_e$ 的条件数也表现为 $\\frac{2}{1-2\\nu}$。", "answer": "$$\\boxed{\\frac{2}{1-2\\nu}}$$", "id": "3522660"}, {"introduction": "在理解了体积锁定的成因之后，我们自然会问：如何克服它？本练习将介绍一种经典而高效的解决方案——$\\bar{B}$ 方法，该方法通过修正单元应变的计算方式来缓解锁定。你将通过分析证明该方法能够通过体积补丁测试（volumetric patch test），并展示其在不可压缩极限下的收敛率优于标准单元，从而深刻理解其为何是解决锁定问题的有效手段 [@problem_id:3522668]。", "problem": "考虑在单连通域 $\\Omega \\subset \\mathbb{R}^{2}$ 上的小应变、平面应变、各向同性线性弹性问题，其边界为 $\\partial \\Omega$，Lamé 参数为 $\\lambda>0$ 和 $\\mu>0$，单位体积的体力为 $\\mathbf{b}$。令 $\\mathbf{u}:\\Omega\\to\\mathbb{R}^{2}$ 表示位移场，$\\boldsymbol{\\epsilon}(\\mathbf{u})=\\tfrac{1}{2}\\left(\\nabla \\mathbf{u}+\\nabla \\mathbf{u}^{\\top}\\right)$ 为应变张量，其体积部分为 $\\epsilon_{v}(\\mathbf{u})=\\operatorname{tr}(\\boldsymbol{\\epsilon}(\\mathbf{u}))=\\nabla\\cdot\\mathbf{u}$，其偏量部分为 $\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u})=\\boldsymbol{\\epsilon}(\\mathbf{u})-\\tfrac{1}{2}\\epsilon_{v}(\\mathbf{u})\\mathbf{I}$。本构关系为 $\\boldsymbol{\\sigma}(\\mathbf{u})=2\\mu\\,\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u})+\\lambda\\,\\epsilon_{v}(\\mathbf{u})\\,\\mathbf{I}$。其弱形式为：求 $\\mathbf{u}\\in\\mathcal{V}$，使得对于所有试探函数 $\\mathbf{w}\\in\\mathcal{V}_{0}$，\n$$\na(\\mathbf{u},\\mathbf{w})=\\ell(\\mathbf{w}),\n$$\n其中\n$$\na(\\mathbf{u},\\mathbf{w})=\\int_{\\Omega}\\left(2\\mu\\,\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}):\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{w})+\\lambda\\,\\epsilon_{v}(\\mathbf{u})\\,\\epsilon_{v}(\\mathbf{w})\\right)\\,d\\Omega,\\qquad \\ell(\\mathbf{w})=\\int_{\\Omega}\\mathbf{b}\\cdot\\mathbf{w}\\,d\\Omega+\\int_{\\partial\\Omega_{t}}\\mathbf{t}\\cdot\\mathbf{w}\\,ds.\n$$\n使用特征尺寸为 $h$ 的形状规则、拟一致的双线性四边形（等参 $Q4$ 单元）网格对 $\\Omega$ 进行离散化，并使用标准 $Q4$ 位移有限元空间 $\\mathcal{V}_{h}\\subset\\mathcal{V}$ 和完全积分。定义 $\\bar{B}$ (B-bar) 修正如下：对于每个单元 $\\Omega_{e}$，令单元上的体积应变投影为\n$$\n\\bar{\\epsilon}_{v}^{h}\\big|_{\\Omega_{e}}=\\frac{1}{|\\Omega_{e}|}\\int_{\\Omega_{e}}\\epsilon_{v}^{h}\\,d\\Omega,\n$$\n其中 $\\epsilon_{v}^{h}=\\nabla\\cdot\\mathbf{u}_{h}$，$|\\Omega_{e}|$ 为单元面积。$\\bar{B}$ 单元在应力计算中用 $\\lambda\\,\\bar{\\epsilon}_{v}^{h}$ 替换体积项 $\\lambda\\,\\epsilon_{v}^{h}$，同时保持偏量项 $2\\mu\\,\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}_{h})$ 不变。考虑以下两个任务：\n\n1. 体积分片检验 (Volumetric patch test)。令 $\\Omega$ 被划分为一个由平行四边形 $Q4$ 单元组成的网格（即单元映射是仿射的）。指定与均匀膨胀精确解 $\\mathbf{u}^{\\ast}(x,y)=\\tfrac{\\epsilon_{0}}{2}[x\\;\\;y]^{\\top}$ 一致的边界位移，该解具有恒定的体积应变 $\\epsilon_{v}(\\mathbf{u}^{\\ast})=\\epsilon_{0}\\neq 0$ 和零偏应变。证明在此条件下，$\\bar{B}$ 单元在每个单元内产生一个完全均匀的静水应力场 $\\boldsymbol{\\sigma}^{h}= \\lambda\\,\\epsilon_{0}\\,\\mathbf{I}$，即它通过了体积分片检验。\n\n2. 不可压缩极限下的收敛率。考虑一个光滑问题，其精确不可压缩解 $\\mathbf{u}$ 在 $\\Omega$ 中满足 $\\epsilon_{v}(\\mathbf{u})=0$，并采用相同的本构关系，其中 $\\mu$ 固定。将不可压缩极限定义为 $\\lambda\\to\\infty$ 且 $\\mu$ 保持固定。对于标准 $Q4$ 单元和 $\\bar{B}$ 单元，推导在界\n$$\n\\|\\mathbf{u}-\\mathbf{u}_{h}\\|_{H^{1}(\\Omega)}\\leq C\\,h^{p},\n$$\n中的渐近率 $p$，其中 $C$ 在不可压缩极限下与 $\\lambda$ 无关。报告关于 Sobolev $H^{1}$-半范数定义的有序速率对 $\\left(p_{\\text{Q4}},\\,p_{\\bar{B}}\\right)$。将最终的数对表示为一个包含两个无单位解析数的行矩阵。\n\n不允许使用任何快捷公式；您必须从弱形式、应变分解的定义和投影算子出发，并对一致性和稳定性进行推理。场景参数在物理上是一致的。最终答案必须是如上所述的单个行矩阵；无需四舍五入。", "solution": "该问题包含两部分。第一部分要求证明 $\\bar{B}$ 单元通过了体积分片检验。第二部分要求解标准 $Q4$ 单元和 $\\bar{B}$ 单元在不可压缩极限下的收敛率。\n\n**第一部分：体积分片检验**\n\n分片检验验证了有限元格式的一致性。给定一个由平行四边形 $Q4$ 单元组成的网格，并指定了与均匀膨胀位移场 $\\mathbf{u}^{\\ast}(x,y)=\\tfrac{\\epsilon_{0}}{2}[x\\;\\;y]^{\\top}$ 相对应的边界位移，其中 $\\epsilon_{0}$ 是一个非零常数。\n\n首先，我们计算与 $\\mathbf{u}^{\\ast}$ 相关的精确应变张量。位移场的梯度为\n$$\n\\nabla\\mathbf{u}^{\\ast} = \\begin{pmatrix} \\frac{\\partial u_x^{\\ast}}{\\partial x}  \\frac{\\partial u_x^{\\ast}}{\\partial y} \\\\ \\frac{\\partial u_y^{\\ast}}{\\partial x}  \\frac{\\partial u_y^{\\ast}}{\\partial y} \\end{pmatrix} = \\begin{pmatrix} \\frac{\\epsilon_{0}}{2}  0 \\\\ 0  \\frac{\\epsilon_{0}}{2} \\end{pmatrix} = \\frac{\\epsilon_{0}}{2}\\mathbf{I}.\n$$\n精确应变张量 $\\boldsymbol{\\epsilon}(\\mathbf{u}^{\\ast})$ 是梯度的对称部分：\n$$\n\\boldsymbol{\\epsilon}(\\mathbf{u}^{\\ast}) = \\frac{1}{2}\\left(\\nabla\\mathbf{u}^{\\ast} + (\\nabla\\mathbf{u}^{\\ast})^{\\top}\\right) = \\frac{1}{2}\\left(\\frac{\\epsilon_{0}}{2}\\mathbf{I} + \\frac{\\epsilon_{0}}{2}\\mathbf{I}\\right) = \\frac{\\epsilon_{0}}{2}\\mathbf{I}.\n$$\n精确体积应变 $\\epsilon_{v}(\\mathbf{u}^{\\ast})$ 是应变张量的迹：\n$$\n\\epsilon_{v}(\\mathbf{u}^{\\ast}) = \\operatorname{tr}(\\boldsymbol{\\epsilon}(\\mathbf{u}^{\\ast})) = \\operatorname{tr}\\left(\\frac{\\epsilon_{0}}{2}\\mathbf{I}\\right) = \\frac{\\epsilon_{0}}{2}\\operatorname{tr}(\\mathbf{I}) = \\frac{\\epsilon_{0}}{2}(2) = \\epsilon_{0}.\n$$\n精确偏应变 $\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}^{\\ast})$ 由下式给出：\n$$\n\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}^{\\ast}) = \\boldsymbol{\\epsilon}(\\mathbf{u}^{\\ast}) - \\frac{1}{2}\\epsilon_{v}(\\mathbf{u}^{\\ast})\\mathbf{I} = \\frac{\\epsilon_{0}}{2}\\mathbf{I} - \\frac{1}{2}(\\epsilon_{0})\\mathbf{I} = \\mathbf{0}.\n$$\n位移场 $\\mathbf{u}^{\\ast}(x,y)$ 在 $x$ 和 $y$ 上是线性的。标准的双线性四边形 ($Q4$) 单元可以精确表示在其局部坐标中为线性多项式的任何函数。由于平行四边形网格的单元映射是仿射的，全局坐标 $(x,y)$ 中的线性场在单元的局部坐标中仍然是线性的。有限元方法的一个关键特性是，如果精确解属于有限元空间 $\\mathcal{V}_{h}$，并且边界条件是由精确解插值得到的，那么有限元解 $\\mathbf{u}_{h}$ 将与精确解完全相同，即 $\\mathbf{u}_{h} = \\mathbf{u}^{\\ast}$。\n\n因此，在每个单元 $\\Omega_{e}$ 内，有限元位移场为 $\\mathbf{u}_{h} = \\mathbf{u}^{\\ast}$。因此，从有限元解计算出的应变张量 $\\boldsymbol{\\epsilon}^{h} = \\boldsymbol{\\epsilon}(\\mathbf{u}_{h})$ 在每个单元内是常数，并且等于精确应变：\n$$\n\\boldsymbol{\\epsilon}^{h}\\big|_{\\Omega_{e}} = \\boldsymbol{\\epsilon}(\\mathbf{u}^{\\ast}) = \\frac{\\epsilon_{0}}{2}\\mathbf{I}.\n$$\n这意味着离散体积应变 $\\epsilon_{v}^{h} = \\nabla\\cdot\\mathbf{u}_{h}$ 在每个单元内也是常数：\n$$\n\\epsilon_{v}^{h}\\big|_{\\Omega_{e}} = \\epsilon_{v}(\\mathbf{u}^{\\ast}) = \\epsilon_{0}.\n$$\n现在我们将 $\\bar{B}$ 投影应用于体积应变。对于每个单元 $\\Omega_{e}$，投影后的体积应变 $\\bar{\\epsilon}_{v}^{h}$ 定义为 $\\epsilon_{v}^{h}$ 的单元平均值：\n$$\n\\bar{\\epsilon}_{v}^{h}\\big|_{\\Omega_{e}} = \\frac{1}{|\\Omega_{e}|}\\int_{\\Omega_{e}}\\epsilon_{v}^{h}\\,d\\Omega.\n$$\n由于 $\\epsilon_{v}^{h}$ 在单元 $\\Omega_e$ 上是常数且等于 $\\epsilon_{0}$，该积分简化为：\n$$\n\\bar{\\epsilon}_{v}^{h}\\big|_{\\Omega_{e}} = \\frac{1}{|\\Omega_{e}|}\\int_{\\Omega_{e}}\\epsilon_{0}\\,d\\Omega = \\frac{1}{|\\Omega_{e}|}\\epsilon_{0}|\\Omega_{e}| = \\epsilon_{0}.\n$$\n因此，投影后的体积应变与恒定的精确体积应变完全相等。\n\n$\\bar{B}$ 单元的应力张量 $\\boldsymbol{\\sigma}^{h}$ 是使用修正后的体积应变计算的：\n$$\n\\boldsymbol{\\sigma}^{h} = 2\\mu\\,\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}_{h}) + \\lambda\\,\\bar{\\epsilon}_{v}^{h}\\,\\mathbf{I}.\n$$\n有限元解的偏应变是 $\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}_{h}) = \\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}^{\\ast}) = \\mathbf{0}$。将此值和 $\\bar{\\epsilon}_{v}^{h}$ 的值代入应力公式，我们得到：\n$$\n\\boldsymbol{\\sigma}^{h}\\big|_{\\Omega_{e}} = 2\\mu(\\mathbf{0}) + \\lambda\\,\\epsilon_{0}\\,\\mathbf{I} = \\lambda\\,\\epsilon_{0}\\,\\mathbf{I}.\n$$\n这个结果表明，计算出的应力在每个单元内是一个均匀的静水应力场，并且与精确应力 $\\boldsymbol{\\sigma}(\\mathbf{u}^{\\ast}) = \\lambda\\epsilon_{v}(\\mathbf{u}^{\\ast})\\mathbf{I} = \\lambda\\epsilon_{0}\\mathbf{I}$（因为 $\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}^\\ast)=\\mathbf{0}$）完全相同。这证实了 $\\bar{B}$ 单元通过了体积分片检验。\n\n**第二部分：不可压缩极限下的收敛率**\n\n在不可压缩极限 ($\\lambda \\to \\infty$) 下的线性弹性问题最好在混合有限元法的框架内进行分析。不可压缩性约束 $\\epsilon_{v}(\\mathbf{u}) = \\nabla\\cdot\\mathbf{u} = 0$ 是通过一个拉格朗日乘子来施加的，该乘子可视为压力 $p$。数值方法的稳定性和收敛性取决于离散位移和压力空间是否满足 Ladyzhenskaya-Babuška-Brezzi (LBB) 条件或 inf-sup 条件。不满足此条件会导致“闭锁”现象，这是一种数值假象，即解变得过度刚硬，并且当网格加密时不会收敛到正确解。\n\n误差估计 $\\|\\mathbf{u}-\\mathbf{u}_{h}\\|_{H^{1}(\\Omega)}\\leq C\\,h^{p}$ 中的收敛率 $p$ 是由有限元空间 $\\mathcal{V}_h$ 的逼近性质决定的，前提是该方法是稳定的（即无闭锁的）。对于一个会发生闭锁的方法，常数 $C$ 依赖于 $\\lambda$，并且当 $\\lambda \\to \\infty$ 时，误差不收敛，这意味着有效收敛率 $p$ 为 $0$。\n\n**标准 $Q4$ 单元：**\n在使用 $Q4$ 单元的标准基于位移的格式中，有限元空间 $\\mathcal{V}_h$ 由连续的分片双线性函数组成。不可压缩性约束通过罚项 $\\lambda\\int_{\\Omega}(\\nabla\\cdot\\mathbf{u}_h)(\\nabla\\cdot\\mathbf{w}_h)d\\Omega$ 被隐式地施加。该格式等价于一个混合方法，其中离散压力空间 $\\mathcal{Q}_h$ 是体积应变空间 $\\{\\nabla\\cdot\\mathbf{w}_h \\mid \\mathbf{w}_h \\in \\mathcal{V}_h\\}$。对于 $Q4$ 单元，$\\nabla\\mathbf{u}_h$ 的分量在每个单元内是线性的（但不是双线性的）。这导致离散压力空间相对于离散位移空间过大且约束过多。具体来说，对于四个单元在一个顶点处相交的网格，存在一个不受位移场控制的“棋盘”压力模式。\n这种不匹配意味着标准 $Q4$ 单元的空间对 $(\\mathcal{V}_h, \\mathcal{Q}_h)$ 不满足 LBB 条件。因此，该单元在不可压缩极限下表现出严重的体积闭锁。刚度矩阵变得病态，并且当 $h\\to 0$ 时，位移的数值解不收敛到精确解。误差界中的常数 $C$ 与 $\\lambda$ 相关。因此失去了渐近收敛率。\n$$\np_{\\text{Q4}} = 0.\n$$\n\n**$\\bar{B}$ 单元：**\n$\\bar{B}$ 修正将能量泛函中的真实体积应变 $\\epsilon_{v}^{h}$ 替换为其单元平均值 $\\bar{\\epsilon}_{v}^{h}$。这相当于选择一个不同的、更合适的离散压力空间。格式变为：\n$$\na_h(\\mathbf{u}_h, \\mathbf{w}_h) = \\int_{\\Omega} 2\\mu\\,\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}_{h}):\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{w}_h)\\,d\\Omega + \\sum_{e} \\int_{\\Omega_e} \\lambda\\,\\bar{\\epsilon}_{v}(\\mathbf{u}_{h})\\,\\bar{\\epsilon}_{v}(\\mathbf{w}_{h})\\,d\\Omega.\n$$\n这个修正对应于一个混合方法，其中压力被近似为在每个单元上是分片常数。所得到的空间对，即双线性连续位移（来自 $Q4$ 的 $\\mathcal{V}_h$）和分片常数压力（来自 $P0$ 的 $\\mathcal{Q}_h$），被称为 $Q4-P0$ 单元。这个空间对被证明满足 LBB 条件。\n由于 $\\bar{B}$ 格式是 LBB 稳定的，它没有体积闭锁。当 $\\lambda\\to\\infty$ 时，误差常数 $C$ 与 $\\lambda$ 无关。因此，收敛率 $p$ 由有限元空间的逼近性质决定。对于一个足够光滑的精确解 $\\mathbf{u} \\in [H^{k+1}(\\Omega)]^2$，使用 $k$ 次多项式对 $H^1$-范数的标准插值误差估计为 $O(h^k)$。$Q4$ 单元的双线性函数对应于 $k=1$。因此，位移的 $H^1$-范数（和半范数）误差表现为：\n$$\n\\|\\mathbf{u}-\\mathbf{u}_{h}\\|_{H^{1}(\\Omega)} \\leq C h |\\mathbf{u}|_{H^{2}(\\Omega)}.\n$$\n因此，对于线性单元，其渐近收敛率是最优的。\n$$\np_{\\bar{B}} = 1.\n$$\n有序速率对 $(p_{\\text{Q4}},\\,p_{\\bar{B}})$ 是 $(0, 1)$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  1\n\\end{pmatrix}\n}\n$$", "id": "3522668"}, {"introduction": "理论分析固然深刻，但在实际的工程软件开发中，我们需要一种可靠的计算方法来检验单元的稳定性。本练习将指导你从理论走向实践，设计并实现一个三维“不排水补丁测试”（undrained patch test），这是一种诊断体积锁定的强大数值工具。通过构建舒尔补（Schur complement）矩阵并分析其特征值，你将学习如何基于离散LBB（Ladyzhenskaya–Babuška–Brezzi）稳定条件，客观地判断一个混合单元配方是否能够避免虚假压力模式和体积锁定 [@problem_id:3522635]。", "problem": "设计一个三维不排水斑块测试，用于检测计算岩土力学中与体积不可压缩性相关的单元锁定现象。从混合小应变不可压缩弹性公式入手，该公式是线性多孔弹性理论的不排水极限，其中孔隙水压力充当强制体积应变为零的拉格朗日乘子。其基本基础是虚功原理以及偏应变和体积应变的定义。在不排水状态下，运动学约束为 $\\epsilon_v = 0$，孔隙水压力 $p_{\\mathrm{w}}$ 强制执行此约束。考虑弱形式：寻找位移 $\\boldsymbol{u}$ 和孔隙水压力 $p_{\\mathrm{w}}$，使得对于所有运动学容许的虚位移 $\\boldsymbol{v}$ 和虚压力 $q$，\n$$\n\\int_{\\Omega} 2\\mu\\,\\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{u}) : \\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{v}) \\, \\mathrm{d}\\Omega\n\\;+\\;\n\\int_{\\Omega} p_{\\mathrm{w}}\\,\\nabla\\cdot \\boldsymbol{v}\\, \\mathrm{d}\\Omega\n\\;+\\;\n\\int_{\\Omega} q\\,\\nabla\\cdot \\boldsymbol{u}\\, \\mathrm{d}\\Omega\n\\;=\\; 0,\n$$\n其中 $\\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{u}) = \\boldsymbol{\\varepsilon}(\\boldsymbol{u}) - \\tfrac{1}{3}\\operatorname{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}))\\mathbf{I}$ 且 $\\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = \\tfrac{1}{2}(\\nabla \\boldsymbol{u} + \\nabla \\boldsymbol{u}^{\\mathsf{T}})$。剪切模量为 $\\mu>0$。不排水约束由 $p_{\\mathrm{w}}$ 强制执行；偏刚度项中没有独立的体积罚。\n\n为了揭示离散体积锁定和伪压力模式，您的任务是在单位立方体 $\\Omega = [0,1]^3$ 的简单网格上开发一个可计算的有限元（FE）斑块测试，该立方体被划分为一个 $2\\times 2\\times 2$ 的规则三线性六面体网格。使用以下离散混合公式：设 $V_h$ 为协调三线性位移空间（$Q_1$），具有三个分量；设 $Q_h$ 为以下压力空间之一：\n- $Q_h = P_0$（每个单元上分片常数），记为 $Q_1{-}P_0$。\n- $Q_h = Q_1$（每个节点上连续三线性），记为 $Q_1{-}Q_1$。\n\n定义离散矩阵：\n- 偏刚度矩阵 $K \\in \\mathbb{R}^{n_u \\times n_u}$，其元素为\n$$\nK_{ij} \\;=\\; \\int_{\\Omega} 2\\mu\\,\\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{\\phi}_j) : \\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{\\phi}_i) \\,\\mathrm{d}\\Omega,\n$$\n其中 $\\boldsymbol{\\phi}_j$ 是 $V_h$ 中第 $j$ 个向量值位移基函数。\n- 离散散度耦合矩阵 $G \\in \\mathbb{R}^{n_p \\times n_u}$，其元素为\n$$\nG_{\\alpha j} \\;=\\; \\int_{\\Omega} \\psi_\\alpha \\,\\nabla\\cdot \\boldsymbol{\\phi}_j \\,\\mathrm{d}\\Omega,\n$$\n其中 $\\psi_\\alpha$ 是 $Q_h$ 中第 $\\alpha$ 个标量压力基函数。\n\n在不排水混合鞍点系统中，压力空间上的舒尔补为 $S = G K^{-1} G^{\\mathsf{T}}$。不可压缩性的离散Ladyzhenskaya–Babuška–Brezzi（LBB）inf-sup稳定性要求 $S$ 是半正定的，并具有一个由常数压力场张成的一维零空间。任何额外的近零特征值都对应于伪压力模式，这些模式在 $p_{\\mathrm{w}}$ 约束下表现为体积锁定或压力棋盘格现象。\n\n您的程序必须：\n1. 仅使用应变能的偏量部分（在 $K$ 中无体积罚）组装 $K$，使用 $Q_1$ 六面体单元和精确的 $2{\\times}2{\\times}2$ 高斯积分。\n2. 对 $Q_1{-}P_0$ 和 $Q_1{-}Q_1$ 两种配对，使用相同的求积方法组装 $G$。\n3. 对 $K$ 进行最小正则化以数值计算 $K^{-1}$（例如，添加一个极小的单位矩阵倍数），同时确保在极限情况下保持其偏应力特性。\n4. 计算对称舒尔补 $S = G K^{-1} G^{\\mathsf{T}}$ 及其特征值。\n5. 当且仅当 $S$ 恰好有一个近零特征值（常数压力模式），且所有其他特征值相对于谱半径都严格为正时，声明“通过”（pass）；否则声明“失败”（fail）。\n\n为测试代表实际岩土力学网格的网格敏感性，还需包括一个坐标的平滑内部扭曲，该扭曲保持边界不变但扭曲内部节点。使用平滑的泡状扭曲函数\n$$\n\\mathbf{x}' = \\mathbf{x} + s\\,\\beta(\\mathbf{x})\\,\\mathbf{1}, \n\\quad\n\\beta(\\mathbf{x}) = x(1-x)\\,y(1-y)\\,z(1-z),\n$$\n其中 $s$ 是一个无量纲振幅，$\\mathbf{1}$ 是所有分量均为1的向量。这种扭曲使边界固定，仅扰动内部节点。\n\n测试套件和输出：\n- 使用三个测试用例：\n  1. 在规则网格（$s=0$）上的 $Q_1{-}P_0$。\n  2. 在规则网格（$s=0$）上的 $Q_1{-}Q_1$。\n  3. 在扭曲网格（$s=0.3$）上的 $Q_1{-}P_0$。\n- 对于每个用例，计算 $S$ 的近零特征值的数量。将“近零”定义为小于 $\\tau = \\max(10^{-8}\\lambda_{\\max}, 10^{-12})$ 的特征值，其中 $\\lambda_{\\max}$ 是 $S$ 的最大特征值。\n- 为每个用例报告一个布尔值：如果恰好找到一个近零特征值，则为 $\\mathrm{True}$，否则为 $\\mathrm{False}$。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的、逗号分隔的布尔值列表（例如，“[True,False,True]”）。不应打印任何其他文本。\n\n所有量均为无量纲；无需物理单位。不涉及角度。不涉及百分比。所需的输出类型是布尔值。计算必须是自包含的，并能通过指定的求积和单元定义进行复现。", "solution": "用户希望设计一个数值斑块测试，用于在三维有限元分析中检测体积锁定。这是计算力学中验证混合有限元公式的标准程序。该问题在科学上是合理的、适定的，并提供了实现所需的所有必要细节。\n\n### 基于原理的设计\n\n该斑块测试基于不可压缩弹性的混合公式和Ladyzhenskaya–Babuška–Brezzi（LBB）稳定性条件。\n\n#### 1. 不可压缩性的混合公式\n控制方程源自近不可压缩材料的虚功原理，并取其完全不可压缩的极限。在此极限下，材料不能发生体积应变（$\\epsilon_v = \\nabla \\cdot \\boldsymbol{u} = 0$），压力场（$p$）作为拉格朗日乘子强制执行此运动学约束。平衡方程的弱形式是一个鞍点问题：寻找位移 $\\boldsymbol{u}$ 和压力 $p$，使其对所有运动学容许的虚场都满足给定的变分方程。\n\n问题陈述提供了特定于应变能偏量部分的弱形式，这适用于不可压缩极限：\n$$\n\\int_{\\Omega} 2\\mu\\,\\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{u}) : \\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{v}) \\, \\mathrm{d}\\Omega\n\\;+\\;\n\\int_{\\Omega} p\\,\\nabla\\cdot \\boldsymbol{v}\\, \\mathrm{d}\\Omega\n\\;+\\;\n\\int_{\\Omega} q\\,\\nabla\\cdot \\boldsymbol{u}\\, \\mathrm{d}\\Omega\n\\;=\\; 0\n$$\n其中 $\\boldsymbol{v}$ 是虚位移， $q$ 是虚压力。\n\n#### 2. 有限元离散化\n我们使用有限元基函数对连续场 $\\boldsymbol{u}$ 和 $p$ 进行离散化。位移场 $\\boldsymbol{u}$ 使用三线性（$Q_1$）向量基函数（$\\boldsymbol{\\phi}_i$）进行近似，压力场 $p$ 使用分片常数（$P_0$）或连续三线性（$Q_1$）标量基函数（$\\psi_\\alpha$）进行近似。这导出一个线性方程组：\n$$\n\\begin{pmatrix} \\mathbf{K}  \\mathbf{G}^{\\mathsf{T}} \\\\ \\mathbf{G}  \\mathbf{0} \\end{pmatrix}\n\\begin{pmatrix} \\mathbf{d} \\\\ \\mathbf{p} \\end{pmatrix}\n=\n\\begin{pmatrix} \\mathbf{f} \\\\ \\mathbf{0} \\end{pmatrix}\n$$\n其中 $\\mathbf{d}$ 和 $\\mathbf{p}$ 是未知位移和压力自由度（DOFs）的向量。矩阵为：\n- $\\mathbf{K}$：偏刚度矩阵， $K_{ij} = \\int_{\\Omega} 2\\mu\\,\\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{\\phi}_j) : \\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{\\phi}_i) \\,\\mathrm{d}\\Omega$。该矩阵严格从偏应变能导出，并且由于未约束的刚体运动而是奇异的。\n- $\\mathbf{G}$：离散散度（或耦合）矩阵， $G_{\\alpha j} = \\int_{\\Omega} \\psi_\\alpha \\,\\nabla\\cdot \\boldsymbol{\\phi}_j \\,\\mathrm{d}\\Omega$。\n\n#### 3. LBB稳定性与舒尔补\n离散系统的稳定性和适定性取决于位移和压力有限元空间的选择，这由LBB（或inf-sup）条件概括。不稳定的单元配对可能导致数值伪影，如体积锁定（一种过刚的响应）或伪压力振荡（棋盘格现象）。\n\n分析LBB稳定性的一种标准方法是检查压力空间舒尔补矩阵 $\\mathbf{S} = \\mathbf{G} \\mathbf{K}^{-1} \\mathbf{G}^{\\mathsf{T}}$ 的谱。\n- 矩阵 $\\mathbf{K}$ 本身是奇异的，因为问题公式没有包含防止刚体运动的边界条件。为了计算其逆以形成舒尔补，$\\mathbf{K}$ 必须被正则化。一种常用技术是添加一个小的对角扰动，$\\mathbf{K}_{\\text{reg}} = \\mathbf{K} + \\alpha \\mathbf{I}$，这在物理上对应于对物体进行弱接地，从而消除了由刚体模式引起的零度。\n- 对于一个稳定的单元，舒尔补矩阵 $\\mathbf{S}$ 应该是半正定的，并具有一个维度为一的零空间。这个单一的零特征值对应于物理上有意义的、不做功的常数压力模式。\n- 任何额外的零或近零特征值表明存在伪的、非物理的压力模式。这些模式是离散化产生的伪影，是锁定和不稳定的原因。\n\n#### 4. 斑块测试的算法实现\n斑块测试的实现如下：\n1.  **网格生成**：在单位立方体 $\\Omega = [0,1]^3$ 上定义一个 $2 \\times 2 \\times 2$ 的三线性六面体单元网格。为了测试鲁棒性，在一个测试用例中应用了坐标扭曲，它扰动内部节点，同时保持边界固定。\n2.  **矩阵组装**：使用 $2 \\times 2 \\times 2$ 高斯积分，逐个单元地组装矩阵 $\\mathbf{K}$ 和 $\\mathbf{G}$。\n    - 对于单元刚度 $\\mathbf{K}^e$，被积函数使用应变-位移矩阵 $\\mathbf{B}$ 和偏本构矩阵 $\\mathbf{D}_{\\text{dev}}$ 计算。$k^e = \\int_{V^e} \\mathbf{B}^{\\mathsf{T}} \\mathbf{D}_{\\text{dev}} \\mathbf{B} \\, \\mathrm{d}V$。\n    - 对于耦合矩阵 $\\mathbf{G}^e$，被积函数为 $\\psi_\\alpha (\\nabla \\cdot \\boldsymbol{\\phi}_j)$。\n3.  **舒尔补与特征分析**：对全局矩阵 $\\mathbf{K}$ 进行正则化。形成舒尔补 $\\mathbf{S} = \\mathbf{G} \\mathbf{K}_{\\text{reg}}^{-1} \\mathbf{G}^{\\mathsf{T}}$。然后计算其特征值。\n4.  **判定**：计算“近零”（相对于最大特征值和一个绝对容差）的特征值的数量。如果此计数恰好为一，则单元通过斑块测试；否则，失败。\n\n此过程针对三个指定的用例执行：在规则网格上的稳定（$Q_1{-}P_0$）和不稳定（$Q_1{-}Q_1$）单元，以及在扭曲网格上的稳定单元。预期结果分别为 `pass`、`fail`、`pass`，这表明该方法能够检测不稳定性并确认稳定公式的鲁棒性。", "answer": "```python\n# The final runnable code for the volumetric locking patch test.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef get_q1_hex_shape_functions_and_derivs(xi, eta, zeta):\n    \"\"\"\n    Computes Q1 (trilinear) shape functions and their derivatives in the reference element.\n    The reference element is the cube [-1, 1]^3.\n\n    Args:\n        xi, eta, zeta (float): Coordinates of a point within the reference element.\n\n    Returns:\n        tuple[np.ndarray, np.ndarray]:\n            - N: An array of 8 shape function values.\n            - dN_dxi: A (8, 3) array of shape function derivatives w.r.t. (xi, eta, zeta).\n    \"\"\"\n    N = np.zeros(8)\n    dN_dxi = np.zeros((8, 3))\n\n    # Nodal coordinates in the reference element [-1, 1]^3\n    # Ordered CCW from bottom-left-front for bottom face, then top face.\n    xi_coords = np.array([-1, 1, 1, -1, -1, 1, 1, -1])\n    eta_coords = np.array([-1, -1, 1, 1, -1, -1, 1, 1])\n    zeta_coords = np.array([-1, -1, -1, -1, 1, 1, 1, 1])\n\n    for i in range(8):\n        xi_i, eta_i, zeta_i = xi_coords[i], eta_coords[i], zeta_coords[i]\n        \n        term_xi = (1 + xi_i * xi)\n        term_eta = (1 + eta_i * eta)\n        term_zeta = (1 + zeta_i * zeta)\n        \n        N[i] = 0.125 * term_xi * term_eta * term_zeta\n        \n        dN_dxi[i, 0] = 0.125 * xi_i * term_eta * term_zeta\n        dN_dxi[i, 1] = 0.125 * term_xi * eta_i * term_zeta\n        dN_dxi[i, 2] = 0.125 * term_xi * term_eta * zeta_i\n\n    return N, dN_dxi\n\ndef run_patch_test(pressure_space, distortion_s):\n    \"\"\"\n    Performs the 3D undrained patch test for a given element formulation.\n    \"\"\"\n    mu = 1.0  # Shear modulus, can be 1.0 without loss of generality\n\n    # 1. Mesh Generation: 2x2x2 grid on the unit cube [0,1]^3\n    nx, ny, nz = 3, 3, 3  # Number of nodes in each direction\n    num_nodes = nx * ny * nz\n    elem_nx, elem_ny, elem_nz = nx - 1, ny - 1, nz - 1\n    num_elements = elem_nx * elem_ny * elem_nz\n    \n    # Generate node coordinates\n    node_coords = np.mgrid[0:1:nx*1j, 0:1:ny*1j, 0:1:nz*1j].reshape(3, -1).T\n    \n    # Apply smooth interior distortion if specified\n    if distortion_s > 0:\n        s = distortion_s\n        x, y, z = node_coords[:, 0], node_coords[:, 1], node_coords[:, 2]\n        beta = x * (1 - x) * y * (1 - y) * z * (1 - z)\n        node_coords += s * beta[:, np.newaxis] * np.array([1.0, 1.0, 1.0])\n\n    # Define element connectivity\n    elements = []\n    for k in range(elem_nz):\n        for j in range(elem_ny):\n            for i in range(elem_nx):\n                n0 = k * (nx * ny) + j * nx + i\n                elements.append([\n                    n0, n0 + 1, n0 + 1 + nx, n0 + nx,\n                    n0 + nx * ny, n0 + nx * ny + 1, n0 + nx * ny + 1 + nx, n0 + nx * ny + nx\n                ])\n    elements = np.array(elements)\n\n    # 2. Quadrature: 2x2x2 Gaussian quadrature for hexahedra\n    gp_loc, gp_w = np.polynomial.legendre.leggauss(2)\n    \n    # 3. Matrix Assembly\n    num_disp_dofs = num_nodes * 3\n    if pressure_space == 'P0':\n        num_pressure_dofs = num_elements\n    else:  # 'Q1'\n        num_pressure_dofs = num_nodes\n\n    K = np.zeros((num_disp_dofs, num_disp_dofs))\n    G = np.zeros((num_pressure_dofs, num_disp_dofs))\n\n    # Deviatoric constitutive matrix in Voigt notation for engineering strain\n    D_dev = 2 * mu * np.array([\n        [2./3., -1./3., -1./3., 0, 0, 0],\n        [-1./3., 2./3., -1./3., 0, 0, 0],\n        [-1./3., -1./3., 2./3., 0, 0, 0],\n        [0, 0, 0, 0.5, 0, 0],\n        [0, 0, 0, 0, 0.5, 0],\n        [0, 0, 0, 0, 0, 0.5]\n    ])\n\n    for elem_idx, el_nodes in enumerate(elements):\n        coords_el = node_coords[el_nodes]\n        K_el = np.zeros((24, 24))\n        \n        G_el_size = (1, 24) if pressure_space == 'P0' else (8, 24)\n        G_el = np.zeros(G_el_size)\n\n        for z_loc, z_w in zip(gp_loc, gp_w):\n            for y_loc, y_w in zip(gp_loc, gp_w):\n                for x_loc, x_w in zip(gp_loc, gp_w):\n                    w = x_w * y_w * z_w\n                    \n                    N, dN_dxi = get_q1_hex_shape_functions_and_derivs(x_loc, y_loc, z_loc)\n                    J = dN_dxi.T @ coords_el\n                    detJ = np.linalg.det(J)\n                    \n                    if detJ <= 1e-12: continue  # Skip distorted elements with zero/negative volume\n                    J_inv = np.linalg.inv(J)\n                    dN_dX = dN_dxi @ J_inv\n\n                    # Strain-displacement matrix B(6x24) for the element\n                    B = np.zeros((6, 24))\n                    for i in range(8):\n                        dN_dx, dN_dy, dN_dz = dN_dX[i]\n                        B[0, i*3] = dN_dx\n                        B[1, i*3+1] = dN_dy\n                        B[2, i*3+2] = dN_dz\n                        B[3, i*3] = dN_dy; B[3, i*3+1] = dN_dx\n                        B[4, i*3+1] = dN_dz; B[4, i*3+2] = dN_dy\n                        B[5, i*3] = dN_dz; B[5, i*3+2] = dN_dx\n                    \n                    K_el += B.T @ D_dev @ B * detJ * w\n                    \n                    # Divergence of vector basis functions\n                    div_phi = np.zeros(24)\n                    for i in range(8):\n                        div_phi[i*3] = dN_dX[i,0]\n                        div_phi[i*3+1] = dN_dX[i,1]\n                        div_phi[i*3+2] = dN_dX[i,2]\n                        \n                    if pressure_space == 'P0':\n                        psi = 1.0  # Piecewise-constant basis function\n                        G_el[0, :] += psi * div_phi * detJ * w\n                    else:  # Q1\n                        psi = N  # Trilinear basis functions\n                        G_el += np.outer(psi, div_phi) * detJ * w\n\n        # Assemble element matrices into global matrices\n        dof_map = np.array([[3*n, 3*n+1, 3*n+2] for n in el_nodes]).flatten()\n        K[np.ix_(dof_map, dof_map)] += K_el\n\n        if pressure_space == 'P0':\n            G[elem_idx, dof_map] += G_el[0,:]\n        else:  # Q1\n            pressure_dof_map = el_nodes\n            G[np.ix_(pressure_dof_map, dof_map)] += G_el\n\n    # 4. Schur Complement Computation\n    # Regularize K to handle rigid body modes, making it invertible\n    trace_K = np.trace(K)\n    reg_alpha = 1e-10 * trace_K / num_disp_dofs if trace_K > 0 else 1e-10\n    K_reg = K + reg_alpha * np.identity(num_disp_dofs)\n    \n    try:\n        K_inv = np.linalg.inv(K_reg)\n    except np.linalg.LinAlgError:\n        return False  # Singular K, should not occur with regularization\n\n    S = G @ K_inv @ G.T\n    \n    # 5. Eigenvalue Analysis of Schur Complement\n    try:\n        # Use eigh for symmetric matrices\n        eigenvalues = eigh(S, eigvals_only=True)\n    except np.linalg.LinAlgError:\n        return False\n        \n    eigenvalues = np.sort(np.abs(eigenvalues))\n    \n    if len(eigenvalues) == 0 or eigenvalues[-1] < 1e-15:\n        return False  # All eigenvalues are zero, indicates a problem\n\n    lambda_max = eigenvalues[-1]\n    tau = max(1e-8 * lambda_max, 1e-12)\n    near_zero_count = np.sum(eigenvalues < tau)\n    \n    return near_zero_count == 1\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        ('P0', 0.0),    # Case 1: Q1-P0 on a regular mesh\n        ('Q1', 0.0),    # Case 2: Q1-Q1 on a regular mesh\n        ('P0', 0.3),    # Case 3: Q1-P0 on a distorted mesh\n    ]\n\n    results = []\n    for p_space, s_distort in test_cases:\n        result = run_patch_test(pressure_space=p_space, distortion_s=s_distort)\n        results.append(result)\n        \n    # Format the output as specified: a list of booleans\n    # str(True) -> \"True\", str(False) -> \"False\"\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3522635"}]}