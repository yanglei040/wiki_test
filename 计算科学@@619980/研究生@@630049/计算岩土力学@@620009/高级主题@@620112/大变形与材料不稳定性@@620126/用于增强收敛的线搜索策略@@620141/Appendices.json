{"hands_on_practices": [{"introduction": "本练习通过探索一个理想化场景来建立一个基本基准。你将首先推导出一个在目标函数是完美二次型情况下的最优线搜索步长，在这种情况下可以得到精确解。然后，通过分析为什么这种“精确”搜索在非光滑弹塑性本构的背景下会失效，本练习阐明了在真实岩土力学模拟中为何必须采用更复杂的非精确线搜索方法。[@problem_id:3538517]", "problem": "考虑一个通过有限元法离散化的准静态、小应变、弹塑性边值问题。全局平衡写为非线性代数方程 $\\boldsymbol{r}(\\boldsymbol{u})=\\boldsymbol{0}$，其中 $\\boldsymbol{r}(\\boldsymbol{u})=\\boldsymbol{f}_{\\mathrm{int}}(\\boldsymbol{u})-\\boldsymbol{f}_{\\mathrm{ext}}$ 是残差向量，$\\boldsymbol{u}$ 是节点位移，$\\boldsymbol{f}_{\\mathrm{int}}(\\boldsymbol{u})$ 是由本构模型引起的内力向量，$\\boldsymbol{f}_{\\mathrm{ext}}$ 是外力向量。在牛顿-拉夫逊（NR）方法的第 $k$ 次牛顿迭代中，搜索方向 $\\boldsymbol{p}_{k}$ 求解 $\\boldsymbol{K}_{k}\\,\\boldsymbol{p}_{k}=-\\boldsymbol{r}_{k}$，其中 $\\boldsymbol{K}_{k}=\\partial \\boldsymbol{r}/\\partial \\boldsymbol{u}$ 是一致切线矩阵，$\\boldsymbol{r}_{k}=\\boldsymbol{r}(\\boldsymbol{u}_{k})$。\n\n沿 $\\boldsymbol{p}_{k}$ 应用线搜索，通过最小化标量评价函数来改善收敛性\n$$\n\\phi(\\alpha)=\\tfrac{1}{2}\\,\\boldsymbol{r}\\big(\\boldsymbol{u}_{k}+\\alpha\\,\\boldsymbol{p}_{k}\\big)^{\\mathsf{T}}\\boldsymbol{W}\\,\\boldsymbol{r}\\big(\\boldsymbol{u}_{k}+\\alpha\\,\\boldsymbol{p}_{k}\\big),\n$$\n其中 $\\boldsymbol{W}$ 是一个固定的对称正定加权矩阵。假设对于当前迭代，$\\phi(\\alpha)$ 在射线 $\\boldsymbol{u}_{k}+\\alpha\\,\\boldsymbol{p}_{k}$ 上的限制恰好是 $\\alpha$ 的一个二次函数，其形式为\n$$\n\\phi(\\alpha)=\\phi_{0}+g\\,\\alpha+\\tfrac{1}{2}\\,H\\,\\alpha^{2},\n$$\n其中 $\\phi_{0}=\\phi(0)$，$\\,g=\\left.\\dfrac{\\mathrm{d}\\phi}{\\mathrm{d}\\alpha}\\right|_{\\alpha=0}$，且 $H=\\left.\\dfrac{\\mathrm{d}^{2}\\phi}{\\mathrm{d}\\alpha^{2}}\\right|_{\\alpha=0}$。\n\n任务：\n1) 从 $\\phi(\\alpha)$、$g$ 和 $H$ 的定义出发，推导沿 $\\boldsymbol{p}_{k}$ 最小化 $\\phi(\\alpha)$ 的精确线搜索步长 $\\alpha^{\\star}$。你的结果应仅用 $g$ 和 $H$ 表示。\n2) 在具有非光滑屈服面（例如 Mohr–Coulomb 或 Drucker–Prager 族中的角点或顶点过渡）的弹塑性岩土力学背景下，从理论上讨论当本构响应沿 $\\boldsymbol{p}_{k}$ 切换分支时，为何精确的二次线搜索可能无法增强收敛性。你的讨论必须指出使二次最小化失效的关于 $g$ 和 $H$ 的条件，并解释屈服面的不可微性如何影响 $\\phi(\\alpha)$ 的曲率。\n\n仅报告 $\\alpha^{\\star}$ 的闭式表达式作为最终答案。不需要进行数值计算，也不涉及单位。", "solution": "该问题是有效的。它在科学上基于连续介质力学和非线性固体力学的数值方法原理。该问题是适定的、客观的，并包含足够的信息来推导所要求的表达式并支持所需的理论讨论。\n\n根据问题陈述的要求，解答分为两部分。\n\n**第一部分：最优线搜索步长 $\\alpha^{\\star}$ 的推导**\n\n线搜索旨在找到最小化标量评价函数 $\\phi(\\alpha)$ 的步长 $\\alpha$。问题假设对于当前迭代，$\\phi(\\alpha)$ 恰好是 $\\alpha$ 的一个二次函数：\n$$\n\\phi(\\alpha)=\\phi_{0}+g\\,\\alpha+\\tfrac{1}{2}\\,H\\,\\alpha^{2}\n$$\n其中 $\\phi_{0}$、$g$ 和 $H$ 是当前线搜索的常数，由 $\\alpha=0$ 时的状态定义。\n\n为了找到最小化 $\\phi(\\alpha)$ 的 $\\alpha$ 值，我们应用极值的一阶必要条件，即函数对变量的一阶导数必须为零。我们将 $\\phi(\\alpha)$ 对 $\\alpha$ 求导：\n$$\n\\frac{\\mathrm{d}\\phi}{\\mathrm{d}\\alpha} = \\frac{\\mathrm{d}}{\\mathrm{d}\\alpha}\\left(\\phi_{0}+g\\,\\alpha+\\tfrac{1}{2}\\,H\\,\\alpha^{2}\\right) = g+H\\,\\alpha\n$$\n将此导数设为零，得到最优步长，记为 $\\alpha^{\\star}$：\n$$\ng+H\\,\\alpha^{\\star} = 0\n$$\n求解 $\\alpha^{\\star}$，我们得到：\n$$\n\\alpha^{\\star} = -\\frac{g}{H}\n$$\n此表达式在 $H \\neq 0$ 的条件下有效。\n\n为使此极值为最小值，必须满足二阶充分条件，即函数的二阶导数必须为正。我们计算 $\\phi(\\alpha)$ 的二阶导数：\n$$\n\\frac{\\mathrm{d}^{2}\\phi}{\\mathrm{d}\\alpha^{2}} = \\frac{\\mathrm{d}}{\\mathrm{d}\\alpha}\\left(g+H\\,\\alpha\\right) = H\n$$\n因此，当且仅当曲率 $H > 0$ 时，$\\alpha^{\\star} = -g/H$ 对应于唯一的最小值。\n\n**第二部分：关于二次线搜索在弹塑性中失效的理论讨论**\n\n评价函数 $\\phi(\\alpha)$ 精确为二次函数的假设是一种强理想化。在具有非光滑屈服面的弹塑性岩土力学背景下，这一假设常常不成立，可能导致线搜索失效或表现不佳。\n\n首先，我们来分析系数 $g$ 和 $H$。$\\phi(\\alpha)$ 对 $\\alpha$ 的导数可使用链式法则求得：\n$$\n\\frac{\\mathrm{d}\\phi}{\\mathrm{d}\\alpha} = \\frac{\\mathrm{d}}{\\mathrm{d}\\alpha}\\left(\\tfrac{1}{2}\\,\\boldsymbol{r}(\\alpha)^{\\mathsf{T}}\\boldsymbol{W}\\,\\boldsymbol{r}(\\alpha)\\right) = \\boldsymbol{r}(\\alpha)^{\\mathsf{T}}\\boldsymbol{W}\\,\\frac{\\mathrm{d}\\boldsymbol{r}}{\\mathrm{d}\\alpha}\n$$\n其中 $\\boldsymbol{r}(\\alpha) = \\boldsymbol{r}(\\boldsymbol{u}_{k}+\\alpha\\,\\boldsymbol{p}_{k})$。残差向量对 $\\alpha$ 的导数为：\n$$\n\\frac{\\mathrm{d}\\boldsymbol{r}}{\\mathrm{d}\\alpha} = \\frac{\\partial\\boldsymbol{r}}{\\partial\\boldsymbol{u}}\\frac{\\mathrm{d}\\boldsymbol{u}(\\alpha)}{\\mathrm{d}\\alpha} = \\boldsymbol{K}(\\alpha)\\,\\boldsymbol{p}_{k}\n$$\n其中 $\\boldsymbol{K}(\\alpha)$ 是在状态 $\\boldsymbol{u}_{k}+\\alpha\\,\\boldsymbol{p}_{k}$ 处的一致切线矩阵。因此，$\\phi$ 的方向导数为 $\\frac{\\mathrm{d}\\phi}{\\mathrm{d}\\alpha} = \\boldsymbol{r}(\\alpha)^{\\mathsf{T}}\\boldsymbol{W}\\,\\boldsymbol{K}(\\alpha)\\,\\boldsymbol{p}_{k}$。\n\n系数 $g$ 是此导数在 $\\alpha=0$ 处的值：\n$$\ng = \\left.\\frac{\\mathrm{d}\\phi}{\\mathrm{d}\\alpha}\\right|_{\\alpha=0} = \\boldsymbol{r}(\\boldsymbol{u}_k)^{\\mathsf{T}}\\boldsymbol{W}\\,\\boldsymbol{K}(\\boldsymbol{u}_k)\\,\\boldsymbol{p}_{k} = \\boldsymbol{r}_{k}^{\\mathsf{T}}\\boldsymbol{W}\\,\\boldsymbol{K}_{k}\\,\\boldsymbol{p}_{k}\n$$\n根据牛顿搜索方向的定义，$\\boldsymbol{K}_{k}\\,\\boldsymbol{p}_{k} = -\\boldsymbol{r}_{k}$。代入可得：\n$$\ng = -\\boldsymbol{r}_{k}^{\\mathsf{T}}\\boldsymbol{W}\\,\\boldsymbol{r}_{k}\n$$\n由于 $\\boldsymbol{W}$ 是对称正定矩阵，对于任何非零残差 $\\boldsymbol{r}_k \\neq \\boldsymbol{0}$，都有 $g  0$。这证实了 $\\boldsymbol{p}_k$ 是 $\\phi(\\alpha)$ 在 $\\alpha=0$ 处的一个下降方向。\n\n二次最小化在两个主要条件下会失效：\n\n1.  **二次模型的无效性**：公式 $\\alpha^{\\star} = -g/H$ 基于函数 $\\phi(\\alpha)$ 具有恒定正曲率 $H$ 的假设。评价函数的实际曲率是其二阶导数：\n    $$\n    \\frac{\\mathrm{d}^{2}\\phi}{\\mathrm{d}\\alpha^{2}} = H(\\alpha) = \\left(\\boldsymbol{K}(\\alpha)\\boldsymbol{p}_{k}\\right)^{\\mathsf{T}} \\boldsymbol{W} \\left(\\boldsymbol{K}(\\alpha)\\boldsymbol{p}_{k}\\right) + \\boldsymbol{r}(\\alpha)^{\\mathsf{T}} \\boldsymbol{W} \\frac{\\mathrm{d}\\boldsymbol{K}(\\alpha)}{\\mathrm{d}\\alpha}\\boldsymbol{p}_{k}\n    $$\n    一般来说，这个表达式不是常数。项 $\\frac{\\mathrm{d}\\boldsymbol{K}(\\alpha)}{\\mathrm{d}\\alpha}$ 反映了材料刚度沿搜索方向的变化。在具有非光滑屈服面（例如 Mohr-Coulomb）的弹塑性中，如果对于某个 $\\alpha_c > 0$，材料点的应力状态从屈服面的光滑面移动到角点或顶点，本构律会发生突变。应力率和应变率之间的关系变得非唯一或遵循不同的法则。这导致一致切线模量在 $\\alpha_c$ 处不连续。因此，全局切线矩阵 $\\boldsymbol{K}(\\alpha)$ 对 $\\alpha$ 是不可微的，甚至是不连续的。\n    这意味着真实评价函数的曲率 $H(\\alpha)$ 不是常数；它是分段定义的，并且可以有跳跃。函数 $\\phi(\\alpha)$ 不是一个单一的二次函数，而是一个由多段组成的更复杂的函数。使用初始曲率 $H = H(0)$ 通过 $\\alpha^{\\star} = -g/H$ 来预测最小值是有缺陷的，因为它忽略了系统响应沿路径的变化。对一个不正确的模型进行这种“精确”最小化，可能会计算出一个被严重高估或低估的步长，可能导致残差增加和收敛失败。\n\n2.  **使最小化失效的关于 $g$ 和 $H$ 的条件**：表达式 $\\alpha^{\\star} = -g/H$ 仅在 $H>0$ 时才能找到最小值。虽然通常可以保证 $g0$，但初始曲率 $H=\\left.\\frac{\\mathrm{d}^2\\phi}{\\mathrm{d}\\alpha^2}\\right|_{\\alpha=0}$ 可能不为正。\n    *   如果 $H=0$，二次模型变成一条直线 $\\phi(\\alpha) = \\phi_0 + g\\alpha$。由于 $g0$，这条直线斜率为负，对于 $\\alpha \\ge 0$ 没有最小值。$\\alpha^{\\star}$ 的公式涉及除以零，因此是未定义的。\n    *   如果 $H0$，二次模型描述了一个开口向下的抛物线。$\\alpha^{\\star}=-g/H$ 的值对应一个最大值（因为 $g0$，所以 $\\alpha^{\\star}0$，这不是一个前进的步长）。对于 $\\alpha \\ge 0$，函数无界递减，不存在最小值。\n    因此，在线搜索开始时 $H \\le 0$ 的条件从形式上使得二次最小化过程无效，因为它意味着所假设的目标函数对于正步长不存在最小值。这种情况在实践中可能出现，例如，当切线矩阵 $\\boldsymbol{K}_k$ 不是正定的时候，这可能发生在涉及材料软化或结构失稳的问题中。\n\n总之，岩土力学模型中屈服面的不可微性破坏了评价函数是光滑二次函数的基本假设。真实评价函数的曲率变得不连续，使得初始二次近似的最小值点成为一个不可靠且可能有害的步长选择。此外，如果初始曲率 $H$ 非正，二次最小化模型本身就无法产生有效的步长。", "answer": "$$\n\\boxed{-\\frac{g}{H}}\n$$", "id": "3538517"}, {"introduction": "本练习探讨了一个微妙但至关重要的实现细节：用于衡量收敛性的价值函数的选择。通过一个模拟岩土力学中常见的挑战——粘滑摩擦的假设情景，本练习揭示了不同的数学范数（特别是 $\\ell_2$ 和 $\\ell_\\infty$ 范数）如何导致对是否接受一个试探步长做出截然不同的决定。这个练习强调了选择一个对所模拟物理行为具有鲁棒性的价值函数的重要性，特别是对于处理接触状态变化时局部残差峰值等现象。[@problem_id:3538494]", "problem": "一个刚性块被压在一个粗糙平面上，并沿 $x$ 方向进行准静态驱动。该界面采用带有接触约束的库仑摩擦模型，并通过有限元法（FEM）进行离散化。离散非线性代数系统以残差形式写为 $r(u) = 0$，其中 $u$ 集合了节点位移和接触变量。在牛顿类迭代中，对试探更新量 $u_{k+1} = u_k + \\alpha p_k$ 使用线搜索，以在粘滑转换过程中强制收敛。如果选定的评价函数 $\\varphi(r(u))$ 表现出严格减小，即 $\\varphi(r(u_{k+1}))  \\varphi(r(u_k))$，则线搜索接受该试探步。考虑了两种评价函数：$\\ell_2$ 范数 $\\varphi_2(r) = \\lVert r \\rVert_2$ 和 $\\ell_\\infty$ 范数 $\\varphi_\\infty(r) = \\lVert r \\rVert_\\infty$。\n\n在一次粘滑事件中，一个局部的活动集变化导致某个接触残差分量产生一个尖峰。在第 $k$ 次迭代时，残差为\n$$\nr(u_k) = \\big[\\,0.10,\\;0.08,\\;0.12,\\;0.09,\\;0.11,\\;0.07,\\;0.09,\\;1.20\\,\\big]^\\mathsf{T},\n$$\n其中最后一个分量对应于一个正在经历瞬态尖峰的接触节点。计算出的牛顿方向 $p_k$ 会急剧减小七个较小的分量，但会略微增加最后一个（尖峰）分量。当试探步长为单位步长 $\\alpha = 1$ 时，在试探状态下评估的残差为\n$$\nr(u_{k+1}) = \\big[\\,0.02,\\;0.02,\\;0.03,\\;0.02,\\;0.02,\\;0.02,\\;0.02,\\;1.22\\,\\big]^\\mathsf{T}.\n$$\n\n假设采用一个单调接受准则，当且仅当所选范数严格减小时才接受试探步。在此接触摩擦设置中，哪个陈述最能描述接受结果以及范数选择对局部残差尖峰的鲁棒性？\n\nA. 在 $\\ell_2$ 准则下该步被接受，在 $\\ell_\\infty$ 准则下被拒绝；$\\ell_2$ 范数对局部尖峰更具鲁棒性，因为它聚合了所有分量的残差，使得即使某个分量略有恶化，也能在粘滑转换中取得进展。\n\nB. 在 $\\ell_2$ 准则下该步被拒绝，在 $\\ell_\\infty$ 准则下被接受；$\\ell_\\infty$ 范数更具鲁棒性，因为它强调最差的分量，从而防止隐藏的发散。\n\nC. 在两种准则下该步都被接受，因为残差总和的总体减少量超过了尖峰分量的轻微增加，所以任何合理的范数都必须严格减小。\n\nD. 在两种准则下该步都被拒绝，因为任何残差分量的任何增加都违反了单调线搜索的要求，而不管其他分量的行为如何。", "solution": "用户希望我解决这个问题。我必须首先验证问题陈述。\n\n**问题陈述验证**\n\n步骤 1：提取已知条件\n\n-   **系统**：一个刚性块在粗糙平面上，沿 $x$ 方向受到准静态加载。\n-   **模型**：库仑摩擦和接触约束，通过有限元法（FEM）进行离散化。\n-   **控制方程**：一个以残差形式表示的离散非线性代数系统，$r(u) = 0$。\n-   **求解方法**：一个牛顿类迭代方案。\n-   **全局化策略**：对更新步 $u_{k+1} = u_k + \\alpha p_k$ 进行线搜索。\n-   **线搜索接受准则**：评价函数 $\\varphi(r(u))$ 严格减小，即 $\\varphi(r(u_{k+1}))  \\varphi(r(u_k))$。\n-   **评价函数**：\n    1.  $\\ell_2$ 范数：$\\varphi_2(r) = \\lVert r \\rVert_2 = \\sqrt{\\sum_i r_i^2}$。\n    2.  $\\ell_\\infty$ 范数：$\\varphi_\\infty(r) = \\lVert r \\rVert_\\infty = \\max_i |r_i|$。\n-   **第 $k$ 次迭代的数据**：残差向量为 $r(u_k) = \\big[\\,0.10,\\;0.08,\\;0.12,\\;0.09,\\;0.11,\\;0.07,\\;0.09,\\;1.20\\,\\big]^\\mathsf{T}$。\n-   **试探步的数据**：当步长 $\\alpha = 1$ 时，残差向量为 $r(u_{k+1}) = \\big[\\,0.02,\\;0.02,\\;0.03,\\;0.02,\\;0.02,\\;0.02,\\;0.02,\\;1.22\\,\\big]^\\mathsf{T}$。\n-   **准则**：当且仅当所选范数严格减小时，试探步才被接受。\n\n步骤 2：使用提取的已知条件进行验证\n\n-   **科学基础**：该问题在计算固体力学领域，特别是在接触问题的非线性有限元分析中，具有坚实的理论基础。牛顿法、线搜索、评价函数（使用 $\\ell_2$ 和 $\\ell_\\infty$ 范数）、残差向量和粘滑现象等概念都是标准的、技术上准确的。\n-   **适定性**：问题是适定的。它提供了计算所需范数和应用接受准则所必需的所有数值数据。问题要求进行直接比较和解释，可以确定唯一答案。\n-   **客观性**：问题以客观、正式的语言陈述，没有主观或模糊的术语。\n\n-   **缺陷清单**：\n    1.  **科学或事实不健全**：前提是健全的。在粘滑转换期间出现残差尖峰是接触模拟中一个已知的挑战。\n    2.  **不可形式化或不相关**：问题是直接相关且可形式化的。\n    3.  **不完整或矛盾的设置**：设置是完整的且自洽的。\n    4.  **不切实际或不可行**：数值是抽象的，但用于说明一个有效的数值行为。没有物理上的不一致之处。\n    5.  **不适定或结构不良**：问题结构清晰，能导出一个唯一的结论。\n    6.  **伪深刻、琐碎或同义反复**：问题并非琐碎；它需要计算和理解在数值优化背景下向量范数的不同性质。\n    7.  **超出科学可验证性**：所述主张可通过直接计算进行验证。\n\n步骤 3：结论与行动\n\n问题陈述是有效的。我将继续进行解答。\n\n**解题推导**\n\n本题要求使用两种不同的评价函数（$\\ell_2$ 范数和 $\\ell_\\infty$ 范数）来评估一个试探步的线搜索接受情况。接受规则是评价函数的值严格减小。\n\n令 $r_k = r(u_k)$ 和 $r_{k+1} = r(u_{k+1})$ 分别为第 $k$ 次迭代和试探状态 $k+1$ 的残差向量。\n给定的向量是：\n$$\nr_k = \\big[\\,0.10,\\;0.08,\\;0.12,\\;0.09,\\;0.11,\\;0.07,\\;0.09,\\;1.20\\,\\big]^\\mathsf{T}\n$$\n$$\nr_{k+1} = \\big[\\,0.02,\\;0.02,\\;0.03,\\;0.02,\\;0.02,\\;0.02,\\;0.02,\\;1.22\\,\\big]^\\mathsf{T}\n$$\n残差向量的分量均为非负，因此在计算 $\\ell_\\infty$ 范数时无需取绝对值。\n\n**1. 使用 $\\ell_2$ 范数准则进行评估**\n\n评价函数为 $\\varphi_2(r) = \\lVert r \\rVert_2$。如果 $\\lVert r_{k+1} \\rVert_2  \\lVert r_k \\rVert_2$，则接受该步。这个不等式等价于 $\\lVert r_{k+1} \\rVert_2^2  \\lVert r_k \\rVert_2^2$，后者在计算上更简单。\n\n我们来计算 $r_k$ 的 $\\ell_2$ 范数的平方：\n$$\n\\begin{align*}\n\\varphi_2(r_k)^2 = \\lVert r_k \\rVert_2^2 = 0.10^2 + 0.08^2 + 0.12^2 + 0.09^2 + 0.11^2 + 0.07^2 + 0.09^2 + 1.20^2 \\\\\n= 0.0100 + 0.0064 + 0.0144 + 0.0081 + 0.0121 + 0.0049 + 0.0081 + 1.4400 \\\\\n= 0.0640 + 1.4400 \\\\\n= 1.5040\n\\end{align*}\n$$\n\n现在，我们计算 $r_{k+1}$ 的 $\\ell_2$ 范数的平方：\n$$\n\\begin{align*}\n\\varphi_2(r_{k+1})^2 = \\lVert r_{k+1} \\rVert_2^2 = 6 \\times (0.02)^2 + 0.03^2 + 1.22^2 \\\\\n= 6 \\times (0.0004) + 0.0009 + 1.4884 \\\\\n= 0.0024 + 0.0009 + 1.4884 \\\\\n= 1.4917\n\\end{align*}\n$$\n\n比较范数的平方：\n$$\n1.4917  1.5040 \\implies \\lVert r_{k+1} \\rVert_2^2  \\lVert r_k \\rVert_2^2\n$$\n由于 $\\ell_2$ 范数的平方严格减小，线搜索准则得到满足。在 $\\ell_2$ 准则下，该步被**接受**。\n\n**2. 使用 $\\ell_\\infty$ 范数准则进行评估**\n\n评价函数为 $\\varphi_\\infty(r) = \\lVert r \\rVert_\\infty = \\max_i |r_i|$。如果 $\\lVert r_{k+1} \\rVert_\\infty  \\lVert r_k \\rVert_\\infty$，则接受该步。\n\n我们来计算 $r_k$ 的 $\\ell_\\infty$ 范数：\n$$\n\\varphi_\\infty(r_k) = \\lVert r_k \\rVert_\\infty = \\max\\{0.10,\\;0.08,\\;0.12,\\;0.09,\\;0.11,\\;0.07,\\;0.09,\\;1.20\\} = 1.20\n$$\n\n现在，我们计算 $r_{k+1}$ 的 $\\ell_\\infty$ 范数：\n$$\n\\varphi_\\infty(r_{k+1}) = \\lVert r_{k+1} \\rVert_\\infty = \\max\\{0.02,\\;0.02,\\;0.03,\\;0.02,\\;0.02,\\;0.02,\\;0.02,\\;1.22\\} = 1.22\n$$\n\n比较范数：\n$$\n1.22 \\not 1.20\n$$\n由于 $\\ell_\\infty$ 范数没有严格减小（实际上它增加了），线搜索准则未得到满足。在 $\\ell_\\infty$ 准则下，该步被**拒绝**。\n\n**总结与解释**\n\n-   试探步被 $\\ell_2$ 准则接受。\n-   试探步被 $\\ell_\\infty$ 准则拒绝。\n\n物理上的解释与问题的非光滑性有关。粘滑转换在材料点层面是一个不连续点，导致系统势能中出现一个不可微点。基于局部线性（或二次）模型的牛顿-拉夫逊方法可能会遇到困难。一个试探步可能在“平均意义上”改善解，但同时会使直接参与活动集变化的单个分量恶化。\n\n$\\ell_2$ 范数通过对所有残差分量的平方求和，聚合了总体的进展。在这种情况下，七个较小分量的大幅减少超过了单个大分量的轻微增加，导致范数的净减少。这种行为通常被认为对此类问题是鲁棒的，因为它防止了求解器因局部、瞬态的尖峰而停滞，而这些尖峰是所模拟物理过程的自然组成部分。\n\n$\\ell_\\infty$ 范数只关注表现最差的分量。由于尖峰分量的残差增加了，该范数也随之增加，导致该步被拒绝。这使得 $\\ell_\\infty$ 范数非常保守，对局部尖峰很敏感。虽然这对于确保解的任何部分都不会在不被注意的情况下发散可能很有用，但在像接触这样的非光滑问题中，它可能过于严格，会因拒绝那些在全局上有益的步而阻碍收敛。\n\n**逐项分析选项**\n\nA. 在 $\\ell_2$ 准则下该步被接受，在 $\\ell_\\infty$ 准则下被拒绝；$\\ell_2$ 范数对局部尖峰更具鲁棒性，因为它聚合了所有分量的残差，使得即使某个分量略有恶化，也能在粘滑转换中取得进展。\n-   第一部分，“在 $\\ell_2$ 准则下被接受，在 $\\ell_\\infty$ 准则下被拒绝”，与我们的计算一致。\n-   第二部分，关于鲁棒性，正确地指出了 $\\ell_2$ 范数的聚合性质使其能够容忍残差的局部增加，这对于在具有活动集变化的非光滑问题中取得进展是一个理想的特性。\n-   **结论：正确。**\n\nB. 在 $\\ell_2$ 准则下该步被拒绝，在 $\\ell_\\infty$ 准则下被接受；$\\ell_\\infty$ 范数更具鲁棒性，因为它强调最差的分量，从而防止隐藏的发散。\n-   根据计算，该陈述的第一部分在事实上是不正确的。接受/拒绝的结果是相反的。\n-   在这种情况下，关于鲁棒性的论证很薄弱；对于非光滑问题，$\\ell_\\infty$ 范数的过度敏感性通常是一个缺点，而不是鲁棒性的标志。\n-   **结论：不正确。**\n\nC. 在两种准则下该步都被接受，因为残差总和的总体减少量超过了尖峰分量的轻微增加，所以任何合理的范数都必须严格减小。\n-   前提“在两种准则下都被接受”是错误的。在 $\\ell_\\infty$ 准则下该步被拒绝。\n-   “任何合理的范数都必须严格减小”的说法是一个错误的概括。不同的范数以不同的方式衡量向量的大小，而 $\\ell_\\infty$ 范数作为一个标准的、合理的选择，并没有减小。\n-   **结论：不正确。**\n\nD. 在两种准则下该步都被拒绝，因为任何残差分量的任何增加都违反了单调线搜索的要求，而不管其他分量的行为如何。\n-   前提“在两种准则下都被拒绝”是错误的。在 $\\ell_2$ 准则下该步被接受。\n-   所提供的理由（“任何残差分量的任何增加都违反了单调线搜索的要求”）是对线搜索规则的错误陈述。该规则适用于*向量的范数*，而不是其每个单独的分量。\n-   **结论：不正确。**", "answer": "$$\\boxed{A}$$", "id": "3538494"}, {"introduction": "最后的这个练习将带你进入先进的、基于物理的算法设计领域。你的任务是实现一种通过监控系统曲率来结合其力学稳定性知识的线搜索算法。这种“曲率感知”策略可以防止求解器进入材料不稳定的区域，这对于分析如边坡失稳等问题至关重要。本练习让你亲手实践如何定制全局化策略，从而不仅改善数值收敛性，也提升模拟结果的物理保真度。[@problem_id:3538511]", "problem": "您的任务是设计并实现一个考虑曲率的回溯线搜索方法，以增强牛顿法在求解计算岩土力学中出现的非线性平衡方程时的收敛性。该场景模拟了一个具有两个广义自由度的边坡稳定有限元系统的降阶表示。在状态向量 $u \\in \\mathbb{R}^2$ 处的控制离散平衡方程为 $R(u) = f_{\\mathrm{int}}(u) - f_{\\mathrm{ext}} = 0$，其中 $f_{\\mathrm{ext}} \\in \\mathbb{R}^2$ 是一个固定的外荷载，$f_{\\mathrm{int}}(u)$ 是由具有稳定和失稳贡献的势能派生出的内力向量。\n\n基本原理：\n- 力学平衡要求 $R(u) = 0$。\n- 用于求解 $u$ 的牛顿法更新规则为 $u^{k+1} = u^k + \\alpha^k p^k$，其中搜索方向 $p^k$ 通过求解 $K_t(u^k)p^k = -R(u^k)$ 得到，$K_t(u)$ 是切向刚度矩阵（$R(u)$ 的雅可比矩阵）。\n- 评价函数为 $\\phi(u) = \\tfrac{1}{2}\\lVert R(u)\\rVert_2^2$。在 $u^k$ 处沿牛顿方向 $p^k$ 的方向导数满足 $\\left.\\dfrac{d}{d\\alpha}\\phi(u^k+\\alpha p^k)\\right|_{\\alpha=0} = -\\lVert R(u^k)\\rVert_2^2$，前提是 $K_t(u^k)p^k = -R(u^k)$。\n- 曲率通过最小特征值 $\\lambda_{\\min}(K_t(u))$ 来诊断：负的 $\\lambda_{\\min}$ 表示负曲率（失去正定性），这与边坡稳定问题中的失稳机制有关。\n\n模型设定：\n- 内力定义为 $f_{\\mathrm{int}}(u) = (K_0 + C - \\gamma I)u + \\beta\\,[u_1^3,\\,u_2^3]^\\top$，其中 $K_0 \\in \\mathbb{R}^{2 \\times 2}$ 是一个对称的基准刚度，$C \\in \\mathbb{R}^{2 \\times 2}$ 是一个对称的耦合矩阵，$\\gamma \\in \\mathbb{R}$ 控制失稳（例如，软化），$\\beta \\in \\mathbb{R}$ 控制稳定的高阶刚度，$I$ 是单位矩阵。切向刚度为 $K_t(u) = K_0 + C - \\gamma I + \\operatorname{diag}(3\\beta u_1^2,\\,3\\beta u_2^2)$。\n- 在本练习中，所有量均被视为无量纲。\n\n线搜索要求：\n- 给定 $u^k$ 和 $p^k$ 满足 $K_t(u^k)p^k = -R(u^k)$，通过从 $\\alpha^k = 1$ 开始以一个恒定的收缩因子 $\\rho \\in (0,1)$ 进行回溯来选择 $\\alpha^k$，直到同时满足以下两个条件：\n  1. 曲率接受条件：$\\lambda_{\\min}(K_t(u^k + \\alpha^k p^k)) \\geq 0$。\n  2. 充分下降条件 (Armijo condition)：$\\phi(u^k + \\alpha^k p^k) \\leq \\phi(u^k) - c\\,\\alpha^k\\,\\lVert R(u^k)\\rVert_2^2$，其中 $c \\in (0,1)$。\n- 如果回溯导致 $\\alpha^k  \\alpha_{\\min}$，则宣布当前测试用例失败并停止。\n\n牛顿法终止条件：\n- 当 $\\lVert R(u^k)\\rVert_2 \\leq \\varepsilon$ 或迭代次数达到 $k_{\\max}$ 时停止，在后一种情况下宣布失败。\n\n实现细节：\n- 使用 $K_0 = \\begin{bmatrix}60  -15\\\\ -15  40\\end{bmatrix}$。\n- 使用 $C = \\begin{bmatrix}0  \\kappa\\\\ \\kappa  0\\end{bmatrix}$，其中 $\\kappa = -10$。\n- 使用下面列出的参数集。对于每一组，初始化 $u^0 = [0,\\,0]^\\top$，使用 $\\rho = 0.5$，$c = 10^{-4}$，$\\alpha_{\\min} = 10^{-6}$，$\\varepsilon = 10^{-10}$ 以及 $k_{\\max} = 50$。\n\n测试套件：\n- 情况 A：$\\gamma = 20$, $\\beta = 3$, $f_{\\mathrm{ext}} = [50,\\,20]^\\top$。\n- 情况 B：$\\gamma = 30$, $\\beta = 4$, $f_{\\mathrm{ext}} = [80,\\,50]^\\top$。\n- 情况 C：$\\gamma = 23.05$, $\\beta = 3$, $f_{\\mathrm{ext}} = [40,\\,15]^\\top$。\n- 情况 D：$\\gamma = 60$, $\\beta = 0.05$, $f_{\\mathrm{ext}} = [70,\\,40]^\\top$。\n\n输出规格：\n- 对于每种情况，报告收敛到容差 $\\varepsilon$ 所需的牛顿迭代次数（整数）。如果算法失败（因超过 $k_{\\max}$ 未能收敛或在线搜索中遇到 $\\alpha^k  \\alpha_{\\min}$），则对该情况输出整数 $-1$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[n_A,n_B,n_C,n_D]$），其中每个 $n$ 是对应情况 $A,B,C,D$ 的整数结果。\n\n注意：角度单位不适用。在此降阶测试中没有物理单位，为此计算任务，所有量都应被视为无量纲。", "solution": "用户提供了一个有效的问题陈述。任务是实现一个带有自定义回溯线搜索的 Newton-Raphson 算法，以求解代表计算岩土力学问题的非线性方程组。该算法的性能将在四个不同的参数集上进行评估。\n\n问题的核心是找到满足平衡条件 $R(u) = 0$ 的状态向量 $u \\in \\mathbb{R}^2$，$R(u)$ 是残差向量。残差是内力 $f_{\\mathrm{int}}(u)$ 与恒定外荷载 $f_{\\mathrm{ext}}$ 之间的差值。\n\n控制方程定义如下：\n- 内力向量：$f_{\\mathrm{int}}(u) = (K_0 + C - \\gamma I)u + \\beta\\,[u_1^3,\\,u_2^3]^\\top$。\n- 残差向量：$R(u) = f_{\\mathrm{int}}(u) - f_{\\mathrm{ext}}$。\n- 切向刚度矩阵（$R(u)$ 的雅可比矩阵）：$K_t(u) = \\frac{\\partial R}{\\partial u} = K_0 + C - \\gamma I + \\operatorname{diag}(3\\beta u_1^2,\\,3\\beta u_2^2)$。\n\nNewton-Raphson 方法使用以下更新规则迭代地优化解的估计值 $u^k$：\n$$\nu^{k+1} = u^k + \\alpha^k p^k\n$$\n此处，$k$ 是迭代次数，$p^k$ 是搜索方向，$\\alpha^k$ 是由线搜索过程确定的步长。\n\n搜索方向 $p^k$ 是经典的牛顿方向，通过求解由 $R(u^{k+1}) = 0$ 在 $u^k$ 附近的一阶泰勒展开式所产生的线性系统获得：\n$$\nK_t(u^k) p^k = -R(u^k)\n$$\n\n此问题的关键特征是用于确定步长 $\\alpha^k$ 的专门回溯线搜索。从一个完整步长 $\\alpha = 1$ 开始，步长被一个因子 $\\rho \\in (0,1)$ 反复收缩，直到同时满足两个条件：\n\n1.  **曲率接受条件**：在试探状态 $u^k + \\alpha p^k$ 下的材料响应必须是稳定的。这通过要求试探状态下的切向刚度矩阵是半正定的来强制实现。在数学上，最小特征值 $\\lambda_{\\min}$ 必须为非负：\n    $$\n    \\lambda_{\\min}(K_t(u^k + \\alpha p^k)) \\geq 0\n    $$\n    这个条件防止算法进入材料不稳定的区域（其中 $K_t$ 不是正定的），这是岩土力学建模中的一个关键考虑因素。\n\n2.  **充分下降 (Armijo) 条件**：该步必须在目标函数上提供足够的减少量。评价函数定义为 $\\phi(u) = \\frac{1}{2}\\lVert R(u)\\rVert_2^2$。Armijo 条件确保新点不仅更好，而且足够好：\n    $$\n    \\phi(u^k + \\alpha p^k) \\leq \\phi(u^k) - c\\,\\alpha\\,\\lVert R(u^k)\\rVert_2^2\n    $$\n    其中 $c \\in (0,1)$ 是一个小常数（给定为 $10^{-4}$）。项 $-\\lVert R(u^k)\\rVert_2^2$ 是 $\\phi$ 在 $u^k$ 处沿牛顿方向 $p^k$ 的方向导数，保证了 $p^k$ 是 $\\phi$ 的一个下降方向。\n\n每个测试用例的总体算法如下：\n\n1.  初始化迭代计数器 $k=0$ 和解向量 $u^0 = [0, 0]^\\top$。设置常数参数：$K_0 = \\begin{bmatrix}60  -15\\\\ -15  40\\end{bmatrix}$，$C = \\begin{bmatrix}0  -10\\\\ -10  0\\end{bmatrix}$，$\\rho=0.5$，$c=10^{-4}$，$\\alpha_{\\min}=10^{-6}$，$\\varepsilon=10^{-10}$ 以及 $k_{\\max}=50$。\n\n2.  进入主循环，只要 $k  k_{\\max}$ 就继续：\n    a. 计算残差向量 $R(u^k)$ 及其 L2 范数的平方 $\\lVert R(u^k)\\rVert_2^2$。\n    b. 检查收敛性：如果 $\\lVert R(u^k)\\rVert_2 \\leq \\varepsilon$，则找到解。终止并返回当前迭代次数 $k$。\n    c. 计算切向刚度矩阵 $K_t(u^k)$。\n    d. 求解线性系统 $K_t(u^k)p^k = -R(u^k)$ 以获得搜索方向 $p^k$。\n    e. 执行回溯线搜索：\n        i. 初始化 $\\alpha = 1$。\n        ii. 当 $\\alpha \\geq \\alpha_{\\min}$ 时：\n            - 计算试探状态 $u_{\\text{trial}} = u^k + \\alpha p^k$。\n            - 评估曲率条件：计算 $\\lambda_{\\min}(K_t(u_{\\text{trial}}))$。\n            - 评估 Armijo 条件：计算 $\\phi(u_{\\text{trial}})$ 并检查它是否满足充分下降不等式。\n            - 如果两个条件都满足，则接受该步长并跳出内循环。\n            - 如果任一条件失败，则收缩步长 $\\alpha \\leftarrow \\rho \\alpha$。\n    f. 检查线搜索失败：如果内循环因 $\\alpha  \\alpha_{\\min}$ 而终止，则宣布整个案例失败并返回 $-1$。\n    g. 更新解：$u^{k+1} = u^k + \\alpha p^k$。\n    h. 增加迭代计数器：$k \\leftarrow k+1$。\n\n3.  如果主循环完成但未收敛（即 $k$ 达到 $k_{\\max}$），则宣布失败并返回 $-1$。\n\n此过程将为四个指定的测试用例中的每一个实施，以确定收敛所需的迭代次数或检测失败。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the Newton-Raphson solver for all test cases.\n    \"\"\"\n\n    def solve_one_case(gamma, beta, f_ext, K0, C, u0, rho, c_armijo, alpha_min, tol, k_max):\n        \"\"\"\n        Solves a single case using a Newton-Raphson method with a curvature-aware\n        backtracking line search.\n        \"\"\"\n        # --- Pre-calculate constant matrices for efficiency ---\n        I = np.identity(2)\n        # This is the linear part of the internal force and tangent stiffness\n        K_lin_part = K0 + C - gamma * I\n\n        u = u0.copy().astype(float)\n\n        for k in range(k_max):\n            # --- 1. Calculate Residual and Check for Convergence ---\n            u_cubed = np.array([u[0]**3, u[1]**3])\n            f_int = K_lin_part @ u + beta * u_cubed\n            R_k = f_int - f_ext\n\n            norm_Rk = np.linalg.norm(R_k)\n\n            if norm_Rk = tol:\n                return k  # Success: Converged\n\n            phi_k = 0.5 * norm_Rk**2\n            armijo_check_term = c_armijo * norm_Rk**2\n\n            # --- 2. Compute Tangent Stiffness and Search Direction ---\n            K_t_k = K_lin_part + np.diag([3.0 * beta * u[0]**2, 3.0 * beta * u[1]**2])\n\n            try:\n                p_k = np.linalg.solve(K_t_k, -R_k)\n            except np.linalg.LinAlgError:\n                return -1  # Failure: Singular matrix\n\n            # --- 3. Curvature-Aware Backtracking Line Search ---\n            alpha = 1.0\n            step_accepted = False\n            while alpha = alpha_min:\n                u_trial = u + alpha * p_k\n\n                # 3a. Curvature-Acceptance Condition\n                K_t_trial = K_lin_part + np.diag([3.0 * beta * u_trial[0]**2, 3.0 * beta * u_trial[1]**2])\n                \n                # eigvalsh is for symmetric matrices and is more efficient\n                min_eig = np.min(np.linalg.eigvalsh(K_t_trial))\n                \n                if min_eig  0.0:\n                    alpha *= rho\n                    continue  # Reduce alpha and re-check\n\n                # 3b. Sufficient Decrease (Armijo) Condition\n                u_trial_cubed = np.array([u_trial[0]**3, u_trial[1]**3])\n                f_int_trial = K_lin_part @ u_trial + beta * u_trial_cubed\n                R_trial = f_int_trial - f_ext\n                phi_trial = 0.5 * np.linalg.norm(R_trial)**2\n\n                if phi_trial = phi_k - alpha * armijo_check_term:\n                    step_accepted = True\n                    break  # Both conditions met, exit line search\n\n                alpha *= rho\n\n            # --- 4. Update State or Handle Failure ---\n            if not step_accepted:\n                return -1  # Failure: Line search failed (alpha became too small)\n            \n            u = u + alpha * p_k\n\n        return -1  # Failure: Max iterations reached\n\n    # --- Problem Setup ---\n    # Global constants\n    K0 = np.array([[60.0, -15.0], [-15.0, 40.0]])\n    kappa = -10.0\n    C = np.array([[0.0, kappa], [kappa, 0.0]])\n    \n    # Algorithmic parameters\n    u0 = np.array([0.0, 0.0])\n    rho = 0.5\n    c_armijo = 1e-4\n    alpha_min = 1e-6\n    tol = 1e-10\n    k_max = 50\n\n    # Test suite from the problem statement\n    test_cases = [\n        # Case A\n        {'gamma': 20.0, 'beta': 3.0, 'f_ext': np.array([50.0, 20.0])},\n        # Case B\n        {'gamma': 30.0, 'beta': 4.0, 'f_ext': np.array([80.0, 50.0])},\n        # Case C\n        {'gamma': 23.05, 'beta': 3.0, 'f_ext': np.array([40.0, 15.0])},\n        # Case D\n        {'gamma': 60.0, 'beta': 0.05, 'f_ext': np.array([70.0, 40.0])},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = solve_one_case(\n            gamma=case['gamma'],\n            beta=case['beta'],\n            f_ext=case['f_ext'],\n            K0=K0, C=C, u0=u0, rho=rho, c_armijo=c_armijo,\n            alpha_min=alpha_min, tol=tol, k_max=k_max\n        )\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3538511"}]}