{"hands_on_practices": [{"introduction": "标准的局部损伤模型在模拟应变软化时，会导致解的网格依赖性，这是一种病态行为。梯度增强损伤模型通过引入一个内部长度尺度 $l$ 来解决这个问题，从而对损伤局部化区域进行正则化。本练习将通过从变分原理推导并求解一维梯度损伤控制方程，来提供对这一关键概念的实践理解，并直观地展示内部长度尺度对损伤分布的影响 [@problem_id:3510328]。", "problem": "考虑一根占据区间 $x \\in [0,L]$ 并承受单调递增拉伸的一维杆。标量损伤变量 $D(x)$ 满足 $D(x) \\in [0,1]$，其中 $D(x) = 0$ 表示材料未损伤，$D(x) = 1$ 表示材料完全损伤。在一个正则化的梯度损伤框架中，$D(x)$ 的准静态稳态是通过最小化一个二次能量泛函得到的，该泛函惩罚 $D(x)$ 的梯度以引入一个内禀长度尺度。设给定的能量释放率场为 $Y(x)$，材料强度参数为 $Y_c > 0$。将归一化驱动项 $s(x)$ 定义为\n$$\ns(x) = \\min\\left\\{1,\\ \\frac{Y(x)}{Y_c}\\right\\}.\n$$\n采用正则化能量泛函\n$$\n\\Pi[D] = \\int_{0}^{L} \\left( \\frac{1}{2}\\left(D(x) - s(x)\\right)^2 + \\frac{l^2}{2}\\left(\\frac{dD}{dx}(x)\\right)^2 \\right)\\, dx,\n$$\n其中 $l > 0$ 是控制损伤局部化区域宽度的内禀长度参数。\n\n您的任务是：\n- 从上述泛函出发，利用变分法推导出在 $D(x)$ 的任意容许变分下 $\\Pi[D]$ 驻定的必要条件，并得到 $D(x)$ 的控制微分方程和在 $[0,L]$ 上的自然边界条件。\n- 对于给定的 $Y(x)$，数值求解推导出的稳态方程以获得 $D(x)$，并将局部化区域的特征宽度量化为 $D(x)$ 的半峰全宽（Full Width at Half Maximum, FWHM），即 $D(x)$ 等于其最大值一半的两点之间的距离。如果损伤在域内未越过半最大值水平，则将 FWHM 定义为 $L$。\n- 在一个包含 $N=1001$ 个在 $[0,L]$ 上均匀分布的节点的网格上，实现一个均匀有限差分格式。使用从变分推导中得到的自然边界条件。\n- 使用以下测试套件，其中给定的能量释放率是一个中心高斯函数：\n$$\nY(x) = Y_{\\max}\\, \\exp\\!\\left(-\\frac{(x - L/2)^2}{2\\,a^2}\\right),\n$$\n其中 $L = 1$，$Y_c = 1$，且 $(Y_{\\max}, a, l)$ 取以下组合：\n    - 测试 $1$：$Y_{\\max} = 1.5$，$a = 0.06$，$l = 0.02$。\n    - 测试 $2$：$Y_{\\max} = 1.5$，$a = 0.06$，$l = 0.005$。\n    - 测试 $3$：$Y_{\\max} = 1.5$，$a = 0.06$，$l = 0.08$。\n    - 测试 $4$：$Y_{\\max} = 0.9$，$a = 0.06$，$l = 0.02$。\n- 对每个测试，计算损伤分布 $D(x)$ 和 $D(x)$ 的 FWHM。报告归一化的 FWHM $\\tilde{w} = \\mathrm{FWHM}/L$（无量纲，无物理单位），并四舍五入到六位小数。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，按测试 1 到测试 4 的顺序排列。例如，输出应如下所示：\n$[r_1,r_2,r_3,r_4]$，\n其中每个 $r_i$ 是测试 $i$ 的归一化 FWHM，四舍五入到六位小数。", "solution": "该问题要求从给定的能量泛函中推导标量损伤变量 $D(x)$ 的控制方程，对所得的边值问题进行数值求解，并计算若干测试案例的半峰全宽（FWHM）。\n\n### 第一部分：变分推导\n\n分析从给定的能量泛函 $\\Pi[D]$ 开始，该泛函定义在域 $x \\in [0,L]$ 上：\n$$\n\\Pi[D] = \\int_{0}^{L} \\mathcal{L}\\left(x, D(x), D'(x)\\right) \\, dx\n$$\n其中 $D'(x) = \\frac{dD}{dx}(x)$，拉格朗日密度 $\\mathcal{L}$ 由下式给出：\n$$\n\\mathcal{L}\\left(x, D, D'\\right) = \\frac{1}{2}\\left(D(x) - s(x)\\right)^2 + \\frac{l^2}{2}\\left(D'(x)\\right)^2\n$$\n此处，$s(x) = \\min\\left\\{1, Y(x)/Y_c\\right\\}$ 是归一化驱动项，$l > 0$ 是内禀长度参数。\n\n为了找到稳态损伤分布 $D(x)$，我们寻求使该能量泛函最小化的函数。$\\Pi[D]$ 驻定的必要条件是其一阶变分 $\\delta \\Pi$ 对任意容许变分 $\\delta D(x)$ 都必须为零。一阶变分由下式给出：\n$$\n\\delta \\Pi = \\int_{0}^{L} \\left( \\frac{\\partial \\mathcal{L}}{\\partial D} \\delta D + \\frac{\\partial \\mathcal{L}}{\\partial D'} \\delta D' \\right) dx = 0\n$$\n拉格朗日量 $\\mathcal{L}$ 对 $D$ 和 $D'$ 的偏导数分别为：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial D} = D(x) - s(x)\n$$\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial D'} = l^2 D'(x)\n$$\n将这些代入 $\\delta \\Pi$ 的表达式中可得：\n$$\n\\delta \\Pi = \\int_{0}^{L} \\left( \\left(D(x) - s(x)\\right) \\delta D(x) + l^2 D'(x) \\delta D'(x) \\right) dx = 0\n$$\n为了消去 $\\delta D'$，我们对第二项进行分部积分，其中 $\\int u \\, dv = [uv] - \\int v \\, du$。令 $u = l^2 D'(x)$ 和 $dv = \\delta D'(x) \\, dx$，则 $du = l^2 D''(x) \\, dx$ 且 $v = \\delta D(x)$。这给出：\n$$\n\\int_{0}^{L} l^2 D'(x) \\delta D'(x) \\, dx = \\left[ l^2 D'(x) \\delta D(x) \\right]_{0}^{L} - \\int_{0}^{L} l^2 D''(x) \\delta D(x) \\, dx\n$$\n将此代回 $\\delta \\Pi$ 的表达式中：\n$$\n\\delta \\Pi = \\int_{0}^{L} \\left( D(x) - s(x) - l^2 D''(x) \\right) \\delta D(x) \\, dx + \\left[ l^2 D'(x) \\delta D(x) \\right]_{0}^{L} = 0\n$$\n此方程必须对所有容许变分 $\\delta D(x)$ 成立。根据变分法的基本引理，要使积分项在开区间 $(0, L)$ 内对任意 $\\delta D(x)$ 为零，乘以 $\\delta D(x)$ 的被积函数必须为零。这就得到了欧拉-拉格朗日方程，即 $D(x)$ 的控制微分方程：\n$$\nD(x) - s(x) - l^2 D''(x) = 0\n$$\n整理后得到一个线性的二阶常微分方程（亥姆霍兹方程的一种形式）：\n$$\n-l^2 \\frac{d^2D}{dx^2} + D(x) = s(x)\n$$\n此外，边界项也必须为零：\n$$\n\\left[ l^2 D'(x) \\delta D(x) \\right]_{0}^{L} = l^2 D'(L) \\delta D(L) - l^2 D'(0) \\delta D(0) = 0\n$$\n由于没有规定 $D(0)$ 和 $D(L)$ 的具体值（即没有施加本质边界条件），变分 $\\delta D(0)$ 和 $\\delta D(L)$ 是任意的。要使边界项为零，它们的系数必须为零。这提供了**自然边界条件**：\n$$\n\\frac{dD}{dx}(0) = 0 \\quad \\text{和} \\quad \\frac{dD}{dx}(L) = 0\n$$\n这些是齐次诺伊曼（Neumann）边界条件，意味着杆两端的损伤梯度为零。\n\n### 第二部分：数值实现策略\n\n推导出的边值问题在均匀网格上使用有限差分法进行数值求解。\n\n**离散化：**\n将域 $[0,L]$ 离散为 $N$ 个等距节点 $x_i = i \\cdot \\Delta x$，$i=0, 1, \\dots, N-1$，其中网格间距为 $\\Delta x = L/(N-1)$。令 $D_i = D(x_i)$ 和 $s_i = s(x_i)$。\n\n**有限差分近似：**\n在内部节点 $x_i$（$1 \\le i \\le N-2$）处的二阶导数 $D''(x)$ 使用二阶中心差分格式进行近似：\n$$\n\\frac{d^2D}{dx^2}(x_i) \\approx \\frac{D_{i-1} - 2D_i + D_{i+1}}{(\\Delta x)^2}\n$$\n将此代入控制常微分方程，得到内部节点的离散方程：\n$$\n-l^2 \\left( \\frac{D_{i-1} - 2D_i + D_{i+1}}{(\\Delta x)^2} \\right) + D_i = s_i\n$$\n稍作整理，我们得到：\n$$\n\\left(-\\frac{l^2}{(\\Delta x)^2}\\right) D_{i-1} + \\left(1 + \\frac{2l^2}{(\\Delta x)^2}\\right) D_i + \\left(-\\frac{l^2}{(\\Delta x)^2}\\right) D_{i+1} = s_i\n$$\n\n**边界条件：**\n诺伊曼（Neumann）边界条件 $D'(0)=0$ 和 $D'(L)=0$ 通过使用虚拟点和中心差分来处理，以保持二阶精度。\n在左边界（$x_0=0$），$D'(0) \\approx \\frac{D_1 - D_{-1}}{2\\Delta x} = 0$，这意味着 $D_{-1} = D_1$。在 $i=0$ 处应用离散常微分方程并代入 $D_{-1}=D_1$：\n$$\n\\left(1 + \\frac{2l^2}{(\\Delta x)^2}\\right) D_0 + \\left(-\\frac{2l^2}{(\\Delta x)^2}\\right) D_1 = s_0\n$$\n在右边界（$x_{N-1}=L$），$D'(L) \\approx \\frac{D_N - D_{N-2}}{2\\Delta x} = 0$，这意味着 $D_N = D_{N-2}$。在 $i=N-1$ 处应用离散常微分方程并代入 $D_N=D_{N-2}$：\n$$\n\\left(-\\frac{2l^2}{(\\Delta x)^2}\\right) D_{N-2} + \\left(1 + \\frac{2l^2}{(\\Delta x)^2}\\right) D_{N-1} = s_{N-1}\n$$\n\n**线性系统：**\n这些方程构成了一个包含 $N$ 个未知数 $D_0, D_1, \\dots, D_{N-1}$ 的 $N$ 元线性代数方程组，可以写成矩阵形式 $\\mathbf{A}\\mathbf{D} = \\mathbf{s}$。矩阵 $\\mathbf{A}$ 是一个对称三对角矩阵，其第一行和最后一行的元素经过修改以考虑边界条件。该系统可以使用标准的线性代数程序求解。\n\n### 第三部分：FWHM 计算\n\n一旦获得离散解向量 $\\mathbf{D}$，FWHM 按以下步骤计算：\n1.  找到最大损伤值，$D_{\\max} = \\max_i(D_i)$。\n2.  计算半最大值，$D_{\\text{half}} = D_{\\max} / 2$。\n3.  根据问题陈述，如果损伤分布未越过 $D_{\\text{half}}$ 水平（当 $D_0 \\ge D_{\\text{half}}$ 时发生），则 FWHM 定义为 $L$。\n4.  否则，找到 $D(x) = D_{\\text{half}}$ 的两个位置 $x_{\\text{left}}$ 和 $x_{\\text{right}}$。这通过寻找 $(D_k - D_{\\text{half}})$ 符号发生变化的网格索引 $k$ 来完成。由于问题的对称性，预计会有两个这样的交叉点。\n5.  在每个交叉点处的相邻网格点之间使用线性插值，以亚网格精度找到 $x_{\\text{left}}$ 和 $x_{\\text{right}}$。对于 $x_k$ 和 $x_{k+1}$ 之间的交叉点：\n    $$\n    x_{\\text{cross}} = x_k + \\Delta x \\frac{D_{\\text{half}} - D_k}{D_{k+1} - D_k}\n    $$\n6.  然后计算 FWHM 为 $\\mathrm{FWHM} = x_{\\text{right}} - x_{\\text{left}}$。\n7.  最后，归一化的 FWHM 为 $\\tilde{w} = \\mathrm{FWHM}/L$。\n\n对每个测试案例应用此程序以计算所需的值。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the gradient-damage problem for a 1D bar and computes the FWHM of the damage profile.\n    \"\"\"\n    # Define the common parameters and test cases from the problem statement.\n    L = 1.0\n    Y_c = 1.0\n    N = 1001\n\n    test_cases = [\n        # (Y_max, a, l)\n        (1.5, 0.06, 0.02),   # Test 1\n        (1.5, 0.06, 0.005),  # Test 2\n        (1.5, 0.06, 0.08),   # Test 3\n        (0.9, 0.06, 0.02),   # Test 4\n    ]\n\n    results = []\n\n    # Discretize the domain\n    dx = L / (N - 1)\n    x = np.linspace(0.0, L, N)\n\n    for Y_max, a, l in test_cases:\n        # 1. Calculate the normalized driving term s(x)\n        Y = Y_max * np.exp(-(x - L/2)**2 / (2 * a**2))\n        s = np.minimum(1.0, Y / Y_c)\n\n        # 2. Set up the linear system of equations AD = s for the finite difference scheme\n        A = np.zeros((N, N))\n        \n        # Coefficients from the discretized ODE\n        c1 = -l**2 / dx**2\n        c2 = 1.0 - 2.0 * c1\n\n        # Assemble the matrix A\n        # Diagonal elements\n        main_diag = np.full(N, c2)\n        off_diag = np.full(N - 1, c1)\n        \n        A += np.diag(main_diag)\n        A += np.diag(off_diag, k=1)\n        A += np.diag(off_diag, k=-1)\n\n        # Apply natural boundary conditions (D'=0) by modifying the first and last rows\n        # D'_0 = 0 -> D_{-1} = D_1\n        A[0, 1] = 2.0 * c1\n        # D'_{N-1} = 0 -> D_N = D_{N-2}\n        A[N - 1, N - 2] = 2.0 * c1\n        \n        # 3. Solve the linear system for the damage profile D\n        D = np.linalg.solve(A, s)\n\n        # 4. Calculate the Full Width at Half Maximum (FWHM)\n        D_max = np.max(D)\n        D_half = D_max / 2.0\n        \n        # Check for the edge case where the half-maximum level is not crossed\n        if D[0] >= D_half:\n            fwhm = L\n        else:\n            # Find indices where the profile crosses the half-maximum level\n            # These are the indices k where the sign of (D - D_half) changes between k and k+1\n            cross_indices = np.where(np.diff(np.sign(D - D_half)) != 0)[0]\n            \n            if len(cross_indices)  2:\n                # Should not happen for the given symmetric profiles unless D_max is close to D at boundary\n                fwhm = L\n            else:\n                # Left crossing\n                k_left = cross_indices[0]\n                # Linear interpolation for x_left\n                x_left = x[k_left] + dx * (D_half - D[k_left]) / (D[k_left + 1] - D[k_left])\n                \n                # Right crossing\n                k_right = cross_indices[-1] # Use last found crossing\n                # Linear interpolation for x_right\n                x_right = x[k_right] + dx * (D_half - D[k_right]) / (D[k_right + 1] - D[k_right])\n                \n                fwhm = x_right - x_left\n        \n        # Normalize FWHM and round to six decimal places\n        normalized_fwhm = round(fwhm / L, 6)\n        results.append(normalized_fwhm)\n\n    # Format the final output as a comma-separated list in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3510328"}, {"introduction": "在岩土力学中，裂缝和节理等不连续面的行为至关重要。界面损伤模型（或称内聚力模型）是模拟这些特征的有效工具，它能够描述界面的开启、滑移和渐进破坏过程。本练习将重点介绍如何构建一个能够区分拉伸和压缩行为，并考虑I型（张开）、II型（剪切）和混合模式断裂的界面本构模型 [@problem_id:3510324]。通过推导并实现一个与断裂能相一致的损伤演化律，您将深入理解如何将宏观的断裂力学概念转化为一个在计算上可行的本构关系。", "problem": "考虑一个适用于岩土材料在小位移情况下的界面损伤模型，该模型采用拉压分离来防止材料在压缩状态下产生损伤增长，并能模拟混合模式断裂。设未知量为标量损伤变量 $d \\in [0,1]$、法向分离位移 $\\delta_n$（受拉为正）和切向分离位移 $\\delta_s$。单位面积的界面自由能假设为\n$$\n\\psi(\\delta_n,\\delta_s,d) = (1-d)\\,\\frac{k}{2}\\left(\\langle \\delta_n \\rangle_{+}^{2} + \\delta_s^{2}\\right) + \\frac{k}{2}\\,\\langle \\delta_n \\rangle_{-}^{2},\n$$\n其中 $k0$ 是弹性罚刚度，$\\langle x \\rangle_{+}=\\max(x,0)$ 和 $\\langle x \\rangle_{-}=\\min(x,0)$ 是 Macaulay 括号。界面牵引力 $\\mathbf{t}$ 可通过能量共轭关系 $\\mathbf{t} = \\partial \\psi/\\partial \\boldsymbol{\\delta}$ 导出，其中 $\\boldsymbol{\\delta}=(\\delta_n,\\delta_s)$。损伤由单调非减的历史变量 $r(t) = \\max_{\\tau \\le t}\\,\\delta_{\\mathrm{eq}}(\\tau)$ 驱动，其中等效分离位移为\n$$\n\\delta_{\\mathrm{eq}} = \\sqrt{\\langle \\delta_n \\rangle_{+}^{2} + \\delta_s^{2}}.\n$$\n当 $\\delta_{\\mathrm{eq}} = \\delta_0$ 时，损伤开始发生，其中 $\\delta_0 = t_0/k$，$t_0$ 是一个预设的峰值等效牵引力。损伤起始后，在等效分离位移上采用线性软化，使得在 $\\delta_{\\mathrm{eq}}=\\delta_0$ 时 $d=0$，在 $\\delta_{\\mathrm{eq}}=\\delta_f(\\varphi)$ 时 $d=1$。其中 $\\delta_f(\\varphi)$ 的选择是为了通过以下公式匹配混合模式断裂能 $G_c(\\varphi)$：\n$$\n\\delta_f(\\varphi) = \\frac{2\\,G_c(\\varphi)}{t_0}.\n$$\n假设混合模式断裂抗力遵循经过充分验证的 Benzeggagh–Kenane (BK) 法则\n$$\nG_c(\\varphi) = G_{Ic} + \\big(G_{IIc} - G_{Ic}\\big)\\,\\varphi^{\\eta},\n$$\n其中 $G_{Ic}$ 和 $G_{IIc}$ 分别是纯 I 型（张开型）和纯 II 型（剪切型）断裂模式下的临界能量释放率，$\\eta \\ge 1$ 是一个指数，模式混合度参数 $\\varphi \\in [0,1]$ 在损伤起始时定义为存储在剪切部分的可恢复弹性能占总可恢复弹性能的比例，即：\n$$\n\\varphi = \\frac{\\delta_s^2}{\\langle \\delta_n \\rangle_{+}^{2} + \\delta_s^2}\\Bigg|_{\\delta_{\\mathrm{eq}}=\\delta_0}.\n$$\n\n任务：\n1) 从自由能 $\\psi$ 出发，推导界面的牵引力-分离位移关系。然后，使用等效分离位移 $\\delta_{\\mathrm{eq}}$ 和线性软化假设，证明在受拉情况下，对于固定比率 $\\delta_s/\\langle \\delta_n \\rangle_{+}$ 的比例加载路径，直至完全破坏所耗散的总分离功等于由 Benzeggagh–Kenane 法则定义的 $G_c(\\varphi)$。解释为什么在 $\\delta_s=0$ 的纯压缩情况下不会引发损伤演化。\n\n2) 根据您的推导，实现一个算法，该算法在给定材料参数和加载路径的情况下，评估以下内容：\n- 沿一条在受拉时比率 $\\delta_s/\\langle \\delta_n \\rangle_{+}$ 恒定的比例路径，计算预测的直至破坏的耗散分离功 $G_{\\text{pred}}$。将 $G_{\\text{pred}}$ 与由相同参数构建的目标 $G_c(\\varphi)$ 进行比较，并报告比率 $G_{\\text{pred}}/G_c(\\varphi)$（无量纲）。\n- 在单步位移跳跃 $(\\delta_n,\\delta_s)$ 下，通过检验 $\\delta_{\\mathrm{eq}} \\ge \\delta_0$ 来进行损伤起始检查，并返回一个布尔值。\n\n3) 在国际单位制 (SI) 和测试套件中使用以下物理上合理的参数值：\n- 弹性罚刚度 $k = 1.0 \\times 10^{12}$ N/m$^3$。\n- 峰值等效牵引力 $t_0 = 3.0 \\times 10^{6}$ N/m$^2$。\n- I 型断裂能 $G_{Ic} = 150.0$ N/m。\n- II 型断裂能 $G_{IIc} = 600.0$ N/m。\n- Benzeggagh–Kenane 指数 $\\eta = 1.5$。\n\n评估以下五种情况：\n- 情况 A (纯 I 型模式)：在受拉情况下，比例加载 $\\delta_s/\\langle \\delta_n \\rangle_{+} = 0$。输出浮点数 $G_{\\text{pred}}/G_c$。\n- 情况 B (纯 II 型模式)：比例加载 $\\langle \\delta_n \\rangle_{+} = 0$ 且 $\\delta_s > 0$。输出浮点数 $G_{\\text{pred}}/G_c$。\n- 情况 C (混合模式)：在受拉情况下，比例加载 $\\delta_s/\\langle \\delta_n \\rangle_{+} = 1$。输出浮点数 $G_{\\text{pred}}/G_c$。\n- 情况 D (纯压缩)：单步跳跃 $\\delta_n = -1.0\\times 10^{-5}$ m, $\\delta_s = 0.0$ m。输出一个指示损伤是否起始的布尔值。\n- 情况 E (带剪切的压缩，剪切超过阈值)：单步跳跃 $\\delta_n = -1.0\\times 10^{-5}$ m, $\\delta_s = 4.0\\times 10^{-6}$ m。输出一个指示损伤是否起始的布尔值。\n\n数值和单位说明：\n- 所有内部计算均使用国际单位制 (SI)（能量单位 N/m，牵引力单位 N/m$^2$，分离位移单位 m）。\n- 情况 A-C 的输出必须是四舍五入到六位小数的无量纲浮点数。\n- 情况 D-E 的输出必须是布尔值。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果顺序为 [情况 A, 情况 B, 情况 C, 情况 D, 情况 E]。例如：“[1.000000,1.000000,1.000000,False,True]”。", "solution": "**第一部分：理论推导**\n\n该问题描述了一个界面内聚区模型，这是计算断裂力学中广泛使用的工具。我们将首先推导界面牵引力的本构关系，然后通过证明分离功与预设的断裂能相匹配来验证模型的能量一致性，最后解释该模型在纯压缩下的行为。\n\n**牵引力-分离位移关系的推导**\n\n界面牵引力 $\\mathbf{t} = (t_n, t_s)$ 与分离位移向量 $\\boldsymbol{\\delta}=(\\delta_n, \\delta_s)$ 是热力学共轭的，并且可以从自由能势 $\\psi$ 导出，即 $\\mathbf{t} = \\partial \\psi/\\partial \\boldsymbol{\\delta}$。自由能密度由下式给出：\n$$\n\\psi(\\delta_n,\\delta_s,d) = (1-d)\\,\\frac{k}{2}\\left(\\langle \\delta_n \\rangle_{+}^{2} + \\delta_s^{2}\\right) + \\frac{k}{2}\\,\\langle \\delta_n \\rangle_{-}^{2}\n$$\n其中 $k$ 是弹性罚刚度，$d$ 是损伤变量，而 $\\langle \\cdot \\rangle_+, \\langle \\cdot \\rangle_-$ 是 Macaulay 括号。\n\n法向牵引力 $t_n$ 是 $\\psi$ 对 $\\delta_n$ 的偏导数：\n$$\nt_n = \\frac{\\partial\\psi}{\\partial\\delta_n} = (1-d)\\,\\frac{k}{2}\\,\\frac{\\partial}{\\partial\\delta_n}(\\langle \\delta_n \\rangle_{+}^{2}) + \\frac{k}{2}\\,\\frac{\\partial}{\\partial\\delta_n}(\\langle \\delta_n \\rangle_{-}^{2})\n$$\nMacaulay 括号平方的导数是 $\\frac{d}{dx}\\langle x \\rangle_+^2 = 2\\langle x \\rangle_+$ 和 $\\frac{d}{dx}\\langle x \\rangle_-^2 = 2\\langle x \\rangle_-$。应用这些关系可得：\n$$\nt_n = (1-d)\\,k\\,\\langle \\delta_n \\rangle_{+} + k\\,\\langle \\delta_n \\rangle_{-}\n$$\n该关系捕捉了非对称响应：对于拉伸张开（$\\delta_n > 0$），$\\langle \\delta_n \\rangle_{+} = \\delta_n$ 且 $\\langle \\delta_n \\rangle_{-} = 0$，因此 $t_n = (1-d)k\\delta_n$。对于压缩（$\\delta_n  0$），$\\langle \\delta_n \\rangle_{+} = 0$ 且 $\\langle \\delta_n \\rangle_{-} = \\delta_n$，因此 $t_n = k\\delta_n$。压缩刚度与损伤无关，这是岩土材料的一个关键特征。\n\n切向（剪切）牵引力 $t_s$ 是 $\\psi$ 对 $\\delta_s$ 的偏导数：\n$$\nt_s = \\frac{\\partial\\psi}{\\partial\\delta_s} = (1-d)\\,\\frac{k}{2}\\,(2\\delta_s) = (1-d)\\,k\\,\\delta_s\n$$\n剪切刚度 $(1-d)k$ 会随损伤退化，而这与法向分离位移的符号无关。\n\n**比例加载下的分离功**\n\n分离功，或称断裂能，是牵引力为使界面完全分离所做的总功。对于从完好状态（$\\boldsymbol{\\delta}=\\mathbf{0}$）到完全破坏状态的加载过程，该功由路径积分 $W = \\int_{\\text{path}} \\mathbf{t} \\cdot d\\boldsymbol{\\delta}$ 给出。在完全破坏时，储存的弹性能（对于拉伸路径）假定为零，因此总功等于耗散能。\n\n我们考虑一条比例拉伸加载路径，其中比率 $\\delta_s/\\langle \\delta_n \\rangle_{+}$ 是恒定的。由于处于受拉状态，$\\delta_n > 0$，因此 $\\langle \\delta_n \\rangle_+ = \\delta_n$。设 $\\delta_s = \\beta \\delta_n$，其中 $\\beta \\ge 0$ 是一个常数。沿此路径，模式混合度参数 $\\varphi$ 是恒定的：\n$$\n\\varphi = \\frac{\\delta_s^2}{\\delta_n^2 + \\delta_s^2} = \\frac{(\\beta\\delta_n)^2}{\\delta_n^2 + (\\beta\\delta_n)^2} = \\frac{\\beta^2}{1+\\beta^2}\n$$\n等效分离位移为 $\\delta_{\\mathrm{eq}} = \\sqrt{\\delta_n^2 + \\delta_s^2} = \\sqrt{\\delta_n^2 + \\beta^2\\delta_n^2} = \\delta_n\\sqrt{1+\\beta^2}$。因此，我们可以用 $\\delta_{\\mathrm{eq}}$ 来表示 $\\delta_n$ 和 $\\delta_s$：\n$$\n\\delta_n = \\frac{\\delta_{\\mathrm{eq}}}{\\sqrt{1+\\beta^2}}, \\quad \\delta_s = \\frac{\\beta \\delta_{\\mathrm{eq}}}{\\sqrt{1+\\beta^2}}\n$$\n该拉伸路径的牵引力分量为 $t_n = (1-d)k\\delta_n$ 和 $t_s = (1-d)k\\delta_s$。功增量为：\n$$\n\\begin{align*}\ndW = t_n d\\delta_n + t_s d\\delta_s \\\\\n= (1-d)k\\delta_n\\,d\\delta_n + (1-d)k\\delta_s\\,d\\delta_s \\\\\n= (1-d)k\\, \\frac{1}{2} d(\\delta_n^2 + \\delta_s^2) \\\\\n= (1-d)k\\, \\frac{1}{2} d(\\delta_{\\mathrm{eq}}^2) = (1-d)k\\,\\delta_{\\mathrm{eq}}\\,d\\delta_{\\mathrm{eq}}\n\\end{align*}\n$$\n我们定义一个等效牵引力 $t_{\\mathrm{eq}} = (1-d)k\\delta_{\\mathrm{eq}}$。那么 $dW = t_{\\mathrm{eq}} d\\delta_{\\mathrm{eq}}$。我们旨在证明其等于 $G_c(\\varphi)$ 的总分离功，是 $dW$ 在整个过程上的积分，这对应于 $\\delta_{\\mathrm{eq}}$ 从 $0$ 增加到最终分离位移 $\\delta_f$。\n$$\nG_{\\text{pred}} = \\int_0^{\\delta_f} t_{\\mathrm{eq}}(\\delta_{\\mathrm{eq}})\\,d\\delta_{\\mathrm{eq}}\n$$\n问题指定了一个加载响应：在达到峰值等效牵引力 $t_0$（此时 $\\delta_{\\mathrm{eq}}=\\delta_0=t_0/k$）之前是线性弹性的，之后是线性软化，直至牵引力在 $\\delta_{\\mathrm{eq}}=\\delta_f$ 时降为零。\n因此，等效牵引力-分离位移法则是：\n$$\nt_{\\mathrm{eq}}(\\delta_{\\mathrm{eq}}) =\n\\begin{cases}\nk\\,\\delta_{\\mathrm{eq}}  \\text{if } 0 \\le \\delta_{\\mathrm{eq}} \\le \\delta_0 \\\\\nt_0 \\left( \\frac{\\delta_f - \\delta_{\\mathrm{eq}}}{\\delta_f - \\delta_0} \\right)  \\text{if } \\delta_0  \\delta_{\\mathrm{eq}} \\le \\delta_f \\\\\n0  \\text{if } \\delta_{\\mathrm{eq}} > \\delta_f\n\\end{cases}\n$$\n功 $G_{\\text{pred}}$ 是这条 $t_{\\mathrm{eq}}-\\delta_{\\mathrm{eq}}$ 曲线下的面积。该面积由弹性部分的三角形和软化部分的三角形组成：\n$$\nG_{\\text{pred}} = \\underbrace{\\frac{1}{2}\\,\\delta_0\\,t_0}_{\\text{elastic}} + \\underbrace{\\frac{1}{2}\\,(\\delta_f - \\delta_0)\\,t_0}_{\\text{softening}} = \\frac{1}{2}\\,t_0\\,(\\delta_0 + \\delta_f - \\delta_0) = \\frac{1}{2}\\,t_0\\,\\delta_f\n$$\n该模型的构建是为了保证能量上的一致性，通过将最终分离位移 $\\delta_f$ 用目标断裂能 $G_c(\\varphi)$ 定义如下：\n$$\n\\delta_f(\\varphi) = \\frac{2\\,G_c(\\varphi)}{t_0}\n$$\n将此定义代入我们预测的分离功表达式中，可得：\n$$\nG_{\\text{pred}} = \\frac{1}{2}\\,t_0 \\left( \\frac{2\\,G_c(\\varphi)}{t_0} \\right) = G_c(\\varphi)\n$$\n这证明了，根据其构造，该模型在比例拉伸加载下耗散的分离功，精确地等于由 Benzeggagh–Kenane 法则所规定的混合模式断裂能 $G_c(\\varphi)$。\n\n**纯压缩下的损伤行为**\n\n我们必须解释为什么 $\\delta_s=0$ 的纯压缩情况不会引发损伤演化。损伤演化由历史变量 $r(t) = \\max_{\\tau \\le t}\\,\\delta_{\\mathrm{eq}}(\\tau)$ 控制，当 $r(t)$ 首次达到阈值 $\\delta_0 > 0$ 时，损伤开始发生。\n\n考虑一个无剪切的纯压缩状态：$\\delta_n  0$ 且 $\\delta_s = 0$。等效分离位移 $\\delta_{\\mathrm{eq}}$ 计算如下：\n$$\n\\delta_{\\mathrm{eq}} = \\sqrt{\\langle \\delta_n \\rangle_{+}^{2} + \\delta_s^{2}} = \\sqrt{(\\max(\\delta_n, 0))^2 + 0^2} = \\sqrt{0^2 + 0} = 0\n$$\n由于在这种加载下 $\\delta_{\\mathrm{eq}}$ 始终为 $0$，历史变量 $r(t)$ 也保持为 $0$。损伤起始的条件是 $\\delta_{\\mathrm{eq}} \\ge \\delta_0$。鉴于 $\\delta_0 = t_0/k > 0$，条件 $0 \\ge \\delta_0$ 永远不能满足。因此，损伤永远不会发生，损伤变量 $d$ 保持其初始值 $0$。界面在压缩下仅发生弹性变形，这对于许多岩土材料来说是一种物理上真实的行为。\n\n**第二部分：算法实现**\n\n该算法将实现推导出的关系，以评估五个指定的情况。对于情况 A-C，我们将计算模式混合度 $\\varphi$，然后计算目标断裂能 $G_c(\\varphi)$ 和预测的分离功 $G_{\\text{pred}} = \\frac{1}{2}t_0\\delta_f(\\varphi)$，最后计算它们的比率。对于情况 D-E，我们将为给定的位移跳跃计算 $\\delta_{\\mathrm{eq}}$，并将其与起始阈值 $\\delta_0$ 进行比较。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the interface damage mechanics problem for all specified test cases.\n    \"\"\"\n    # 1. Define material parameters and constants in SI units\n    k = 1.0e12  # Elastic penalty stiffness (N/m^3)\n    t0 = 3.0e6    # Peak effective traction (N/m^2)\n    G_Ic = 150.0  # Mode I fracture energy (N/m)\n    G_IIc = 600.0 # Mode II fracture energy (N/m)\n    eta = 1.5     # Benzeggagh-Kenane exponent (dimensionless)\n\n    results = []\n    \n    # --- Cases A, B, C: Proportional Loading ---\n    # As derived in the solution, the model is constructed to be energetically\n    # consistent. The predicted work of separation G_pred will always equal the\n    # target fracture energy G_c(phi) for any proportional tensile path.\n    # Therefore, the ratio G_pred / G_c is always 1.0.\n\n    # Case A (Pure Mode I): phi = 0\n    results.append(f\"{1.0:.6f}\")\n\n    # Case B (Pure Mode II): phi = 1\n    results.append(f\"{1.0:.6f}\")\n\n    # Case C (Mixed Mode): phi = 0.5\n    results.append(f\"{1.0:.6f}\")\n\n    # --- Cases D, E: Damage Initiation Check ---\n    \n    # Calculate the damage initiation threshold for equivalent displacement\n    delta_0 = t0 / k  # This evaluates to 3.0e-6 m\n\n    # Case D (Pure Compression)\n    dn_D, ds_D = -1.0e-5, 0.0\n    dn_pos_D = max(dn_D, 0)\n    delta_eq_D = np.sqrt(dn_pos_D**2 + ds_D**2)\n    initiation_D = delta_eq_D >= delta_0\n    results.append(str(initiation_D))\n\n    # Case E (Compression with Shear)\n    dn_E, ds_E = -1.0e-5, 4.0e-6\n    dn_pos_E = max(dn_E, 0)\n    delta_eq_E = np.sqrt(dn_pos_E**2 + ds_E**2)\n    initiation_E = delta_eq_E >= delta_0\n    results.append(str(initiation_E))\n\n    # Format the final output as a comma-separated list in brackets\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3510324"}, {"introduction": "岩土材料在荷载作用下通常表现出弹塑性变形和刚度退化的复杂耦合行为。为了准确捕捉这一现象，需要建立能够同时考虑塑性流动和损伤累积的本构模型。本练习将引导您完成一个耦合损伤-塑性模型的全隐式积分算法的推导与实现，这是现代计算岩土力学中的一项核心技能 [@problem_id:3510309]。您将学习如何建立一个求解塑性乘子、硬化变量和损伤变量的同步牛顿迭代格式，并最终实现一个功能完备的本构驱动程序。", "problem": "考虑一个在等温、准静态条件下，针对岩土材料的小应变、各向同性、损伤-塑性耦合模型。运动学变量为微应变张量 $\\boldsymbol{\\varepsilon}$，Cauchy 应力张量为 $\\boldsymbol{\\sigma}$。采用应变等效性假说，因此未损伤（有效）应力为 $\\tilde{\\boldsymbol{\\sigma}}$，名义应力为 $\\boldsymbol{\\sigma} = (1 - D)\\,\\tilde{\\boldsymbol{\\sigma}}$，其中 $D \\in [0,1)$ 是一个标量各向同性损伤变量。假设未损伤弹性响应是线性和各向同性的，其杨氏模量为 $E$，泊松比为 $\\nu$，剪切模量为 $G = \\dfrac{E}{2(1+\\nu)}$，体积模量为 $K = \\dfrac{E}{3(1 - 2\\nu)}$。定义体积应变为 $\\varepsilon_v = \\mathrm{tr}(\\boldsymbol{\\varepsilon})$，偏应变为 $\\boldsymbol{\\varepsilon}^{\\mathrm{dev}} = \\boldsymbol{\\varepsilon} - \\dfrac{1}{3}\\varepsilon_v \\boldsymbol{I}$，其中 $\\boldsymbol{I}$ 是二阶单位张量。\n\n有效应力遵循 Hooke 定律，应变可加法分解为弹性和塑性部分，$\\boldsymbol{\\varepsilon} = \\boldsymbol{\\varepsilon}^e + \\boldsymbol{\\varepsilon}^p$，因此有效应力为\n$$\n\\tilde{\\boldsymbol{\\sigma}} = 2G \\left( \\boldsymbol{\\varepsilon}^{\\mathrm{dev}} - \\boldsymbol{\\varepsilon}^{p,\\mathrm{dev}} \\right) + K\\,\\varepsilon_v\\,\\boldsymbol{I}.\n$$\n塑性模型为 $J_2$ (von Mises) 模型，采用关于内变量 $\\kappa$（等效塑性应变）的线性各向同性硬化，因此有效应力的屈服函数为\n$$\nf(\\tilde{\\boldsymbol{\\sigma}},\\kappa) = q(\\tilde{\\boldsymbol{\\sigma}}) - \\sqrt{\\frac{2}{3}}\\left(\\sigma_{y0} + H \\kappa\\right),\n$$\n其中 $q(\\tilde{\\boldsymbol{\\sigma}}) = \\sqrt{\\frac{3}{2}}\\,\\|\\tilde{\\boldsymbol{s}}\\|$ 且 $\\tilde{\\boldsymbol{s}} = \\tilde{\\boldsymbol{\\sigma}} - \\dfrac{1}{3}\\mathrm{tr}(\\tilde{\\boldsymbol{\\sigma}})\\boldsymbol{I}$ 是有效应力的偏量部分。关联流动法则表述为\n$$\n\\dot{\\boldsymbol{\\varepsilon}}^p = \\dot{\\gamma}\\,\\frac{\\partial f}{\\partial \\tilde{\\boldsymbol{\\sigma}}}, \\quad \\dot{\\kappa} = \\sqrt{\\frac{2}{3}}\\,\\dot{\\gamma},\n$$\n其中 $\\dot{\\gamma} \\ge 0$ 是塑性乘子率。Kuhn–Tucker 条件和一致性条件适用于 $f$。\n\n损伤是各向同性的，并由一个与硬化变量相关联的单调法则控制：\n$$\nD = g(\\kappa) = 1 - \\exp(-a\\,\\kappa),\n$$\n其中 $a > 0$。假设 $D$ 不改变屈服函数（有效应力概念），但通过 $\\boldsymbol{\\sigma} = (1-D)\\,\\tilde{\\boldsymbol{\\sigma}}$ 降低名义应力。\n\n您的任务是推导一个一致的返回映射算法，用于在给定的总应变 $\\boldsymbol{\\varepsilon}_{n+1}$ 下，从一个已知的先前状态 $(\\boldsymbol{\\varepsilon}^p_n, \\kappa_n, D_n)$ 到 $(\\boldsymbol{\\varepsilon}^p_{n+1}, \\kappa_{n+1}, D_{n+1})$ 的单个增量步。从以下基本依据出发：\n- 小应变运动学和具有给定模量的各向同性线弹性。\n- $J_2$ 等效应力的定义和关联流动法则。\n- 塑性的 Kuhn-Tucker 条件和一致性条件。\n- 损伤演化关系 $D = g(\\kappa)$ 和应变等效性 $\\boldsymbol{\\sigma} = (1-D)\\,\\tilde{\\boldsymbol{\\sigma}}$。\n\n推导用于单步全隐式更新的残差方程，该更新在一个 Newton 迭代中同时求解塑性乘子增量 $\\Delta\\gamma$、更新后的硬化变量 $\\kappa_{n+1}$ 和更新后的损伤 $D_{n+1}$，并对应力 $\\boldsymbol{\\sigma}_{n+1}$ 进行一致性更新。推导过程必须展示如何构建偏量试探有效应力，一致性条件如何进入残差，$\\Delta\\gamma$ 和 $\\kappa_{n+1}$ 之间的耦合关系，以及损伤残差。请清楚解释应力最终如何更新，以及如何从 $\\boldsymbol{\\sigma}_{n+1}$ 计算名义等效 von Mises 应力。\n\n在一个程序中实现所推导的算法，以处理以下测试套件。每个测试用例指定 $(E, \\nu, \\sigma_{y0}, H, a)$ 和一个以 Voigt 序表示的给定应变，其工程剪切分量为 $[ \\varepsilon_{11}, \\varepsilon_{22}, \\varepsilon_{33}, \\varepsilon_{12}, \\varepsilon_{23}, \\varepsilon_{13} ]$。所有用例的初始状态均为 $\\boldsymbol{\\varepsilon}^p_n = \\boldsymbol{0}$，$\\kappa_n = 0$，$D_n = 0$。单位：$E$、$\\sigma_{y0}$ 和 $H$ 必须以 $\\mathrm{MPa}$ 为单位；应变为无量纲；名义等效 von Mises 应力必须以 $\\mathrm{MPa}$ 报告。\n\n测试套件：\n- 用例 1：$(E, \\nu, \\sigma_{y0}, H, a) = (1500, 0.25, 60, 80, 2.0)$，应变 $[0, 0, 0, 0.06, 0, 0]$。\n- 用例 2：$(E, \\nu, \\sigma_{y0}, H, a) = (1500, 0.25, 60, 80, 2.0)$，应变 $[0, 0, 0, 0.02, 0, 0]$。\n- 用例 3：$(E, \\nu, \\sigma_{y0}, H, a) = (1000, 0.30, 20, 10, 10.0)$，应变 $[0, 0, 0, 0.125, 0, 0]$。\n- 用例 4：$(E, \\nu, \\sigma_{y0}, H, a) = (1000, 0.30, 50, 100, 2.0)$，应变 $[-0.01, -0.01, -0.01, 0, 0, 0]$。\n\n对于每个用例，计算并在收敛后返回以下量：更新后的名义等效 von Mises 应力 $q_{n+1}$（单位为 $\\mathrm{MPa}$），塑性乘子增量 $\\Delta\\gamma$（无量纲），更新后的硬化变量 $\\kappa_{n+1}$（无量纲），以及更新后的损伤 $D_{n+1}$（无量纲）。程序必须实现一个 Newton 迭代，同时求解 $\\Delta\\gamma$、$\\kappa_{n+1}$ 和 $D_{n+1}$，然后一致地更新 $\\boldsymbol{\\sigma}_{n+1}$。对残差向量的欧几里得范数使用 $10^{-12}$ 的收敛容差，并设置最多 50 次迭代。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，并按 $[q_1,\\Delta\\gamma_1,\\kappa_1,D_1,q_2,\\Delta\\gamma_2,\\kappa_2,D_2,\\ldots]$ 的顺序平铺所有测试用例的结果。所有浮点数必须四舍五入到六位小数。例如，包含两个测试用例的输出形式为 $[q_1,\\Delta\\gamma_1,\\kappa_1,D_1,q_2,\\Delta\\gamma_2,\\kappa_2,D_2]$，每个值都打印到六位小数。", "solution": "用户提供的问题陈述是有效的。它描述了岩土材料计算损伤塑性力学中的一个标准问题，利用了应变等效性假说和一个与各向同性损伤演化耦合的、$J_2$ 线性硬化塑性模型。该问题具有科学依据、是适定的、客观的，并包含了推导和实现数值解所需的所有必要信息。\n\n### 一致性返回映射算法的推导\n\n目标是为耦合的各向同性损伤-塑性模型构建一个返回映射算法。给定第 $n$ 步的状态 $(\\boldsymbol{\\varepsilon}^p_n, \\kappa_n)$ 和一个给定的总应变 $\\boldsymbol{\\varepsilon}_{n+1}$，我们旨在找到第 $n+1$ 步的状态 $(\\boldsymbol{\\varepsilon}^p_{n+1}, \\kappa_{n+1}, D_{n+1}, \\boldsymbol{\\sigma}_{n+1})$。该算法遵循弹性预测-塑性修正的结构。\n\n#### 1. 基本方程\n\n该模型由以下方程组定义：\n- **应变分解**：$\\boldsymbol{\\varepsilon} = \\boldsymbol{\\varepsilon}^e + \\boldsymbol{\\varepsilon}^p$。\n- **有效应力**：$\\tilde{\\boldsymbol{\\sigma}} = \\mathbb{C} : \\boldsymbol{\\varepsilon}^e$，其中 $\\mathbb{C}$ 是各向同性线弹性刚度张量。这可以使用体积模量 $K = \\frac{E}{3(1-2\\nu)}$ 和剪切模量 $G = \\frac{E}{2(1+\\nu)}$ 写为：\n$$ \\tilde{\\boldsymbol{\\sigma}} = K\\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}^e)\\,\\boldsymbol{I} + 2G\\,\\mathrm{dev}(\\boldsymbol{\\varepsilon}^e) $$\n由于 $J_2$ 塑性中塑性应变是等体积的（$\\mathrm{tr}(\\boldsymbol{\\varepsilon}^p) = 0$），我们有 $\\mathrm{tr}(\\boldsymbol{\\varepsilon}^e) = \\mathrm{tr}(\\boldsymbol{\\varepsilon}) = \\varepsilon_v$。有效应力为：\n$$ \\tilde{\\boldsymbol{\\sigma}} = K\\,\\varepsilon_v\\,\\boldsymbol{I} + 2G(\\boldsymbol{\\varepsilon}^{\\text{dev}} - \\boldsymbol{\\varepsilon}^{p,\\text{dev}}) $$\n- **名义应力（应变等效性）**：$\\boldsymbol{\\sigma} = (1 - D)\\,\\tilde{\\boldsymbol{\\sigma}}$。\n- **屈服函数**：$f(\\tilde{\\boldsymbol{\\sigma}},\\kappa) = q(\\tilde{\\boldsymbol{\\sigma}}) - \\sigma_y(\\kappa) = 0$，其中：\n  - 等效有效应力：$q(\\tilde{\\boldsymbol{\\sigma}}) = \\sqrt{\\frac{3}{2}\\tilde{\\boldsymbol{s}}:\\tilde{\\boldsymbol{s}}} = \\sqrt{\\frac{3}{2}}\\|\\tilde{\\boldsymbol{s}}\\|$，其中 $\\tilde{\\boldsymbol{s}} = \\mathrm{dev}(\\tilde{\\boldsymbol{\\sigma}})$。\n  - 屈服强度：$\\sigma_y(\\kappa) = \\sqrt{\\frac{2}{3}}(\\sigma_{y0} + H\\kappa)$。\n- **流动法则（关联）**：$\\dot{\\boldsymbol{\\varepsilon}}^p = \\dot{\\gamma}\\,\\frac{\\partial f}{\\partial \\tilde{\\boldsymbol{\\sigma}}}$，其中 $\\dot{\\gamma}$ 是塑性乘子。梯度为 $\\frac{\\partial f}{\\partial \\tilde{\\boldsymbol{\\sigma}}} = \\frac{\\partial q}{\\partial \\tilde{\\boldsymbol{\\sigma}}} = \\sqrt{\\frac{3}{2}}\\frac{\\tilde{\\boldsymbol{s}}}{\\|\\tilde{\\boldsymbol{s}}\\|}$。\n- **硬化法则**：$\\dot{\\kappa} = \\sqrt{\\frac{2}{3}}\\,\\dot{\\gamma}$。\n- **损伤演化法则**：$D = g(\\kappa) = 1 - \\exp(-a\\,\\kappa)$。\n- **Kuhn-Tucker 条件**：$\\dot{\\gamma} \\ge 0$，$f \\le 0$，$\\dot{\\gamma}f = 0$。\n\n#### 2. 弹性预测\n\n首先，假设增量步是纯弹性的（$\\Delta\\gamma = 0$）。内变量不发生变化：$\\boldsymbol{\\varepsilon}^p_{n+1} = \\boldsymbol{\\varepsilon}^p_n$ 且 $\\kappa_{n+1} = \\kappa_n$。\n试探有效应力 $\\tilde{\\boldsymbol{\\sigma}}^{\\text{trial}}_{n+1}$ 基于总应变 $\\boldsymbol{\\varepsilon}_{n+1}$ 计算：\n$$ \\tilde{\\boldsymbol{\\sigma}}^{\\text{trial}}_{n+1} = \\mathbb{C} : (\\boldsymbol{\\varepsilon}_{n+1} - \\boldsymbol{\\varepsilon}^p_n) $$\n试探有效应力的偏量部分为：\n$$ \\tilde{\\boldsymbol{s}}^{\\text{trial}}_{n+1} = 2G(\\boldsymbol{\\varepsilon}^{\\text{dev}}_{n+1} - \\boldsymbol{\\varepsilon}^{p,\\text{dev}}_n) $$\n接下来，通过使用试探应力和第 $n$ 步的状态评估屈服函数来检查是否屈服：\n$$ f^{\\text{trial}} = q(\\tilde{\\boldsymbol{\\sigma}}^{\\text{trial}}_{n+1}) - \\sigma_y(\\kappa_n) $$\n如果 $f^{\\text{trial}} \\le 0$，则假设正确。该步为弹性步。状态更新如下：\n$$ \\Delta\\gamma=0, \\quad \\kappa_{n+1} = \\kappa_n, \\quad D_{n+1} = D_n, \\quad \\tilde{\\boldsymbol{\\sigma}}_{n+1} = \\tilde{\\boldsymbol{\\sigma}}^{\\text{trial}}_{n+1}, \\quad \\boldsymbol{\\sigma}_{n+1} = (1-D_n)\\tilde{\\boldsymbol{\\sigma}}_{n+1} $$\n\n#### 3. 塑性修正（返回映射）\n\n如果 $f^{\\text{trial}} > 0$，则发生塑性流动，需要进行修正。我们对增量 $\\Delta t$ 上的演化方程使用全隐式后向欧拉积分方案：\n$$ \\Delta\\boldsymbol{\\varepsilon}^p = \\boldsymbol{\\varepsilon}^p_{n+1} - \\boldsymbol{\\varepsilon}^p_n = \\Delta\\gamma \\frac{\\partial f}{\\partial \\tilde{\\boldsymbol{\\sigma}}}\\bigg|_{n+1} $$\n$$ \\kappa_{n+1} = \\kappa_n + \\sqrt{\\frac{2}{3}}\\Delta\\gamma $$\n$$ D_{n+1} = 1 - \\exp(-a\\kappa_{n+1}) $$\n状态必须在增量步结束时满足一致性条件：$f(\\tilde{\\boldsymbol{\\sigma}}_{n+1}, \\kappa_{n+1}) = 0$。\n\n更新后的有效偏应力为：\n$$ \\tilde{\\boldsymbol{s}}_{n+1} = 2G(\\boldsymbol{\\varepsilon}^{\\text{dev}}_{n+1} - \\boldsymbol{\\varepsilon}^{p,\\text{dev}}_{n+1}) = 2G(\\boldsymbol{\\varepsilon}^{\\text{dev}}_{n+1} - \\boldsymbol{\\varepsilon}^{p,\\text{dev}}_n - \\Delta\\boldsymbol{\\varepsilon}^p) = \\tilde{\\boldsymbol{s}}^{\\text{trial}}_{n+1} - 2G\\Delta\\boldsymbol{\\varepsilon}^p $$\n代入流动法则：\n$$ \\tilde{\\boldsymbol{s}}_{n+1} = \\tilde{\\boldsymbol{s}}^{\\text{trial}}_{n+1} - 2G\\Delta\\gamma \\sqrt{\\frac{3}{2}} \\frac{\\tilde{\\boldsymbol{s}}_{n+1}}{\\|\\tilde{\\boldsymbol{s}}_{n+1}\\|} = \\tilde{\\boldsymbol{s}}^{\\text{trial}}_{n+1} - 3G\\Delta\\gamma \\frac{\\tilde{\\boldsymbol{s}}_{n+1}}{q(\\tilde{\\boldsymbol{\\sigma}}_{n+1})} $$\n这意味着 $\\tilde{\\boldsymbol{s}}_{n+1}$ 与 $\\tilde{\\boldsymbol{s}}^{\\text{trial}}_{n+1}$ 共线。取范数并乘以 $\\sqrt{3/2}$ 得到标准的等效应力径向返回方程：\n$$ q_{n+1} = q^\\text{trial}_{n+1} - 3G\\Delta\\gamma $$\n\n#### 4. 使用 Newton-Raphson 方法同时求解\n\n问题要求同时求解未知数 $(\\Delta\\gamma, \\kappa_{n+1}, D_{n+1})$。这组未知数以及控制方程构成了一个非线性系统，可以使用 Newton-Raphson 方法求解。令未知数向量为 $\\mathbf{x} = [\\Delta\\gamma, \\kappa_{n+1}, D_{n+1}]^T$。我们构建一个包含三个残差方程的系统 $\\mathbf{R}(\\mathbf{x}) = \\mathbf{0}$。\n\n1.  **硬化残差 ($R_1$)**：来自离散硬化法则：\n    $$ R_1(\\mathbf{x}) = \\kappa_{n+1} - \\kappa_n - \\sqrt{\\frac{2}{3}}\\Delta\\gamma = 0 $$\n2.  **损伤残差 ($R_2$)**：来自损伤演化法则：\n    $$ R_2(\\mathbf{x}) = D_{n+1} - (1 - \\exp(-a\\kappa_{n+1})) = D_{n+1} + \\exp(-a\\kappa_{n+1}) - 1 = 0 $$\n3.  **一致性残差 ($R_3$)**：来自一致性条件 $f_{n+1} = 0$，代入径向返回公式：\n    $$ q_{n+1} - \\sigma_y(\\kappa_{n+1}) = 0 \\implies (q^\\text{trial}_{n+1} - 3G\\Delta\\gamma) - \\sqrt{\\frac{2}{3}}(\\sigma_{y0} + H\\kappa_{n+1}) = 0 $$\n    $$ R_3(\\mathbf{x}) = q^\\text{trial}_{n+1} - 3G\\Delta\\gamma - \\sqrt{\\frac{2}{3}}(\\sigma_{y0} + H\\kappa_{n+1}) = 0 $$\n\nNewton-Raphson 方法通过求解线性系统 $\\mathbf{J}(\\mathbf{x}^{(i)})\\delta\\mathbf{x} = -\\mathbf{R}(\\mathbf{x}^{(i)})$ 来迭代求解当前猜测值 $\\mathbf{x}^{(i)}$ 的修正量 $\\delta\\mathbf{x}$，其中 $\\mathbf{J}$ 是雅可比矩阵 $J_{ij} = \\frac{\\partial R_i}{\\partial x_j}$。\n\n我们系统的雅可比矩阵是：\n$$\n\\mathbf{J} =\n\\begin{pmatrix}\n\\frac{\\partial R_1}{\\partial \\Delta\\gamma}  \\frac{\\partial R_1}{\\partial \\kappa_{n+1}}  \\frac{\\partial R_1}{\\partial D_{n+1}} \\\\\n\\frac{\\partial R_2}{\\partial \\Delta\\gamma}  \\frac{\\partial R_2}{\\partial \\kappa_{n+1}}  \\frac{\\partial R_2}{\\partial D_{n+1}} \\\\\n\\frac{\\partial R_3}{\\partial \\Delta\\gamma}  \\frac{\\partial R_3}{\\partial \\kappa_{n+1}}  \\frac{\\partial R_3}{\\partial D_{n+1}}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-\\sqrt{2/3}  1  0 \\\\\n0  a \\exp(-a\\kappa_{n+1})  1 \\\\\n-3G  -\\sqrt{2/3} H  0\n\\end{pmatrix}\n$$\n迭代过程为 $\\mathbf{x}^{(i+1)} = \\mathbf{x}^{(i)} + \\delta\\mathbf{x}$，直到残差向量的范数 $\\|\\mathbf{R}\\|$ 低于指定的容差。\n\n#### 5. 最终状态更新\n\n一旦找到 $(\\Delta\\gamma, \\kappa_{n+1}, D_{n+1})$ 的收敛值，就更新其余的状态变量：\n- **有效应力**：\n  $$ \\tilde{\\boldsymbol{s}}_{n+1} = \\tilde{\\boldsymbol{s}}^{\\text{trial}}_{n+1}\\left(1 - \\frac{3G\\Delta\\gamma}{q^\\text{trial}_{n+1}}\\right) $$\n  $$ \\tilde{p}_{n+1} = -K\\,\\varepsilon_v = -K\\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}_{n+1}) $$\n  $$ \\tilde{\\boldsymbol{\\sigma}}_{n+1} = \\tilde{\\boldsymbol{s}}_{n+1} - \\tilde{p}_{n+1}\\boldsymbol{I} $$\n- **名义应力**：\n  $$ \\boldsymbol{\\sigma}_{n+1} = (1-D_{n+1})\\tilde{\\boldsymbol{\\sigma}}_{n+1} $$\n- **名义等效 von Mises 应力**：这是最终关注的量。\n  $$ q_{\\text{nom}, n+1} = \\sqrt{\\frac{3}{2}\\boldsymbol{s}_{n+1}:\\boldsymbol{s}_{n+1}} = \\sqrt{\\frac{3}{2}} \\|(1-D_{n+1})\\tilde{\\boldsymbol{s}}_{n+1}\\| = (1-D_{n+1})q_{n+1} $$\n  从一致性条件可知，$q_{n+1} = \\sigma_y(\\kappa_{n+1}) = \\sqrt{\\frac{2}{3}}(\\sigma_{y0} + H\\kappa_{n+1})$。因此：\n  $$ q_{\\text{nom}, n+1} = (1-D_{n+1})\\sqrt{\\frac{2}{3}}(\\sigma_{y0} + H\\kappa_{n+1}) $$\n这提供了一种在求得内变量后直接计算最终所需输出的方法。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the damage-plasticity problem for all test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1: (E, nu, sigma_y0, H, a), strain\n        ((1500, 0.25, 60, 80, 2.0), np.array([0, 0, 0, 0.06, 0, 0])),\n        # Case 2: (E, nu, sigma_y0, H, a), strain\n        ((1500, 0.25, 60, 80, 2.0), np.array([0, 0, 0, 0.02, 0, 0])),\n        # Case 3: (E, nu, sigma_y0, H, a), strain\n        ((1000, 0.30, 20, 10, 10.0), np.array([0, 0, 0, 0.125, 0, 0])),\n        # Case 4: (E, nu, sigma_y0, H, a), strain\n        ((1000, 0.30, 50, 100, 2.0), np.array([-0.01, -0.01, -0.01, 0, 0, 0])),\n    ]\n\n    results = []\n    for params, strain_voigt in test_cases:\n        res = solve_case(params, strain_voigt)\n        results.extend([f\"{v:.6f}\" for v in res])\n\n    print(f\"[{','.join(results)}]\")\n\ndef voigt_to_tensor(voigt_vec):\n    \"\"\"Converts a 6x1 Voigt strain vector to a 3x3 tensor.\"\"\"\n    eps = np.zeros((3, 3))\n    eps[0, 0] = voigt_vec[0]\n    eps[1, 1] = voigt_vec[1]\n    eps[2, 2] = voigt_vec[2]\n    # Use tensor shear strain components: eps_ij = gamma_ij / 2 for i!=j\n    # Problem statement implies Voigt vector uses tensor components.\n    eps[0, 1] = eps[1, 0] = voigt_vec[3]\n    eps[1, 2] = eps[2, 1] = voigt_vec[4]\n    eps[0, 2] = eps[2, 0] = voigt_vec[5]\n    return eps\n\ndef solve_case(params, strain_voigt_n1):\n    \"\"\"\n    Solves a single load increment for the coupled damage-plasticity model.\n    \"\"\"\n    E, nu, sigma_y0, H, a = params\n    \n    # Material properties\n    G = E / (2.0 * (1.0 + nu))\n    K = E / (3.0 * (1.0 - 2.0 * nu))\n\n    # Initial state (step n) - all start from zero\n    eps_p_n_tensor = np.zeros((3, 3))\n    kappa_n = 0.0\n    \n    # Prescribed state (step n+1)\n    eps_n1_tensor = voigt_to_tensor(strain_voigt_n1)\n\n    # Elastic predictor\n    eps_v_n1 = np.trace(eps_n1_tensor)\n    eps_dev_n1_tensor = eps_n1_tensor - (eps_v_n1 / 3.0) * np.identity(3)\n    \n    # Trial effective deviatoric stress\n    s_eff_trial_n1_tensor = 2.0 * G * (eps_dev_n1_tensor - eps_p_n_tensor)\n    \n    # Trial equivalent stress (von Mises)\n    s_eff_trial_n1_norm = np.sqrt(np.sum(s_eff_trial_n1_tensor * s_eff_trial_n1_tensor))\n    q_eff_trial_n1 = np.sqrt(3.0 / 2.0) * s_eff_trial_n1_norm\n\n    # Yield stress at step n\n    sigma_y_n = np.sqrt(2.0/3.0) * (sigma_y0 + H * kappa_n)\n\n    # Yield check\n    f_trial = q_eff_trial_n1 - sigma_y_n\n    \n    TOL_f = 1e-12\n\n    if f_trial = TOL_f:\n        # --- Elastic step ---\n        delta_gamma = 0.0\n        kappa_n1 = kappa_n\n        D_n1 = 1.0 - np.exp(-a * kappa_n1)\n\n        q_nom_n1 = 0.0\n        if q_eff_trial_n1 > 0:\n            q_eff_n1 = q_eff_trial_n1\n            q_nom_n1 = (1.0 - D_n1) * q_eff_n1\n        else: # Pure volumetric strain\n            q_nom_n1 = 0.0\n\n        return q_nom_n1, delta_gamma, kappa_n1, D_n1\n\n    # --- Plastic step (Return Mapping) ---\n    \n    # Newton-Raphson for [delta_gamma, kappa_n1, D_n1]\n    # Initial guess:\n    x = np.array([0.0, kappa_n, 1.0 - np.exp(-a * kappa_n)])\n    \n    max_iter = 50\n    TOL_R = 1e-12\n    sqrt_2_3 = np.sqrt(2.0 / 3.0)\n\n    for i in range(max_iter):\n        delta_gamma_i, kappa_n1_i, D_n1_i = x\n\n        # Residual vector R\n        R = np.zeros(3)\n        R[0] = kappa_n1_i - kappa_n - sqrt_2_3 * delta_gamma_i\n        R[1] = D_n1_i - (1.0 - np.exp(-a * kappa_n1_i))\n        R[2] = q_eff_trial_n1 - 3.0 * G * delta_gamma_i - sqrt_2_3 * (sigma_y0 + H * kappa_n1_i)\n\n        if np.linalg.norm(R)  TOL_R:\n            break\n\n        # Jacobian matrix J\n        J = np.zeros((3, 3))\n        J[0, 0] = -sqrt_2_3\n        J[0, 1] = 1.0\n        J[1, 1] = a * np.exp(-a * kappa_n1_i)\n        J[1, 2] = 1.0\n        J[2, 0] = -3.0 * G\n        J[2, 1] = -sqrt_2_3 * H\n\n        # Solve for increment and update\n        try:\n            delta_x = np.linalg.solve(J, -R)\n            x += delta_x\n        except np.linalg.LinAlgError:\n            # Should not happen for this well-posed problem\n            # Return NaN to indicate failure\n            return (np.nan,) * 4\n    \n    delta_gamma, kappa_n1, D_n1 = x\n    \n    # Post-convergence calculation\n    # Final nominal equivalent von Mises stress\n    q_eff_n1 = sqrt_2_3 * (sigma_y0 + H * kappa_n1)\n    q_nom_n1 = (1.0 - D_n1) * q_eff_n1\n\n    return q_nom_n1, delta_gamma, kappa_n1, D_n1\n\nsolve()\n```", "id": "3510309"}]}