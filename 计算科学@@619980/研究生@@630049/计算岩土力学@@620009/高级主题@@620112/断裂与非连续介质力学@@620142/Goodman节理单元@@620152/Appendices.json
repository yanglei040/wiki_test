{"hands_on_practices": [{"introduction": "在我们深入研究Goodman节理单元的复杂摩擦行为之前，理解其核心工作原理至关重要。这些单元本质上是罚单元，使用一个大的但有限的刚度$k_n$来近似模拟不可穿透的接触条件。这个练习[@problem_id:3528518]旨在通过一个简单的单轴压缩试验，帮助您从第一性原理推导出使用有限罚刚度所带来的内在误差，从而量化这种近似的影响。", "problem": "在一个长度为 $L$、横截面积均匀为 $A$ 的线性弹性岩石试样上进行一维位移控制压缩试验，该试验在有限元方法（FEM）的框架下进行建模。试样被一个完全刚性、无摩擦的压板压缩。试样与压板之间的界面在法线方向上由一个 Goodman 节理单元表示。假设应变很小且应力均匀。试样遵循线性弹性关系 $ \\sigma = E \\, \\varepsilon$，其中 $E$ 是杨氏模量，$\\sigma$ 是轴向应力，$\\varepsilon$ 是轴向应变。Goodman 节理单元仅传递法向牵引力，并在法向方向上被建模为线性弹性，其单位面积的罚刚度为 $k_n$，因此法向牵引力 $t_n$ 由 $t_n = k_n \\, \\delta_n$ 给出，其中 $\\delta_n$ 是界面处的法向相对位移（侵入量）。试样的底端是固定的（$u=0$），顶部压板向下位移一个预设量 $u_00$。\n\n在精确施加不可穿透性约束的条件下，界面条件为 $ \\delta_n^{\\mathrm{exact}} = 0$。在罚函数法施加约束的条件下，$k_n$ 是有限的，界面允许一个微小的、非零的 $ \\delta_n$。严格地从给定的本构关系以及平衡和运动协调性的要求出发，推导法向相对位移误差的闭式解析表达式，该误差定义为 $e_{\\delta}(k_n) = \\delta_n - \\delta_n^{\\mathrm{exact}}$，并表示为 $k_n$、$E$、$L$ 和 $u_0$ 的函数。\n\n最终答案以米为单位表示。答案必须是单一的闭式解析表达式。无需进行数值计算。", "solution": "该问题是一个固体力学中的一维问题，涉及一个线性弹性试样与一个线性弹性节理串联，并承受一个给定的总位移。目标是求出因使用有限罚刚度而导致的节理相对位移（侵入量）的误差。\n\n让我们建立一个坐标系，原点 $x=0$ 位于岩石试样的固定底端。试样延伸至 $x=L$，在此处通过 Goodman 节理单元与刚性压板接触。试样内任意点 $x$ 的位移用 $u(x)$ 表示，取向下方向为正。\n\n固定端的边界条件是：\n$$u(x=0) = 0$$\n\n由顶部压板施加的总位移 $u_0$ 由两个串联的变形机制承担：岩石试样的压缩量，我们记为 $\\Delta L_{\\text{specimen}}$，以及节理的法向相对位移（闭合量）$\\delta_n$。因此，运动协调性条件为：\n$$u_0 = \\Delta L_{\\text{specimen}} + \\delta_n$$\n\n现在我们将右侧的每一项表示为内部轴向应力 $\\sigma$ 的函数。\n对于岩石试样，本构关系由胡克定律给出，即 $\\sigma = E \\varepsilon$，其中 $E$ 是杨氏模量，$\\varepsilon$ 是轴向应变。问题陈述中说明应力在整个试样中是均匀的。因此，应变 $\\varepsilon$ 也必然是均匀的。应变定义为单位原始长度的长度变化量。对于压缩位移，应变为 $\\varepsilon = \\frac{\\Delta L_{\\text{specimen}}}{L}$。\n结合这些关系，可以得到用应力表示的试样压缩量：\n$$\\Delta L_{\\text{specimen}} = \\varepsilon L = \\frac{\\sigma}{E} L$$\n\n对于 Goodman 节理单元，法向牵引力 $t_n$ 与法向相对位移 $\\delta_n$ 之间的本构关系为 $t_n = k_n \\delta_n$，其中 $k_n$ 是单位面积的罚刚度。\n根据平衡要求，试样内的轴向应力 $\\sigma$ 必须等于界面上施加的法向牵引力 $t_n$。这是因为作用在试样任意横截面上的力是 $\\sigma A$，而通过界面传递的力是 $t_n A$，其中 $A$ 是横截面积。因此，$\\sigma = t_n$。\n将此代入节理的本构定律中得到：\n$$\\sigma = k_n \\delta_n$$\n由此，我们可以用应力表示节理闭合量：\n$$\\delta_n = \\frac{\\sigma}{k_n}$$\n\n现在我们将 $\\Delta L_{\\text{specimen}}$ 和 $\\delta_n$ 的表达式代回运动协调性方程：\n$$u_0 = \\frac{\\sigma L}{E} + \\frac{\\sigma}{k_n}$$\n\n这个方程可以用来求解未知的轴向应力 $\\sigma$：\n$$u_0 = \\sigma \\left( \\frac{L}{E} + \\frac{1}{k_n} \\right)$$\n$$\\sigma = \\frac{u_0}{\\frac{L}{E} + \\frac{1}{k_n}}$$\n\n问题要求的是法向相对位移的误差，即 $e_{\\delta}(k_n) = \\delta_n - \\delta_n^{\\mathrm{exact}}$。\n问题陈述将精确解条件定义为完全不可穿透性，意味着 $\\delta_n^{\\mathrm{exact}} = 0$。\n因此，误差就是计算出的侵入量，即 $e_{\\delta}(k_n) = \\delta_n$。\n为了求出 $\\delta_n$，我们使用它与应力的关系 $\\delta_n = \\sigma / k_n$，并代入我们推导出的 $\\sigma$ 的表达式：\n$$\\delta_n = \\frac{1}{k_n} \\left( \\frac{u_0}{\\frac{L}{E} + \\frac{1}{k_n}} \\right)$$\n\n简化此表达式可得到侵入量的最终形式，也就是误差：\n$$\\delta_n = \\frac{u_0}{k_n \\left( \\frac{L}{E} + \\frac{1}{k_n} \\right)} = \\frac{u_0}{\\frac{k_n L}{E} + 1}$$\n\n为了以更简洁的形式呈现结果，我们可以将分子和分母同乘以 $E$：\n$$e_{\\delta}(k_n) = \\delta_n = \\frac{u_0 E}{k_n L + E}$$\n\n这个表达式给出了界面侵入量的误差，它是给定位移 $u_0$、材料属性 $E$ 和 $k_n$ 以及几何尺寸 $L$ 的函数。按要求，该表达式的单位是长度单位。例如，如果 $u_0$ 的单位是米，而 $E$、$k_n$ 和 $L$ 采用一致的国际单位制单位（分别为 Pa、Pa/m 和 m），则结果的单位将是米。", "answer": "$$\\boxed{\\frac{u_0 E}{k_n L + E}}$$", "id": "3528518"}, {"introduction": "掌握了罚方法的概念之后，下一步是实现节理单元的主要力学行为：剪切和摩擦。这个实践练习[@problem_id:3528461]将引导您将一个带有库仑摩擦的理想弹塑性本构模型转化为可执行代码。通过构建一个简单的“面片测试”，您将验证您实现的本构律在弹性范围和屈服点是否与解析解一致，这是确保数值模型正确性的关键一步。", "problem": "在一个刚性块体沿平面岩石节理滑动的场景中，该节理通过有限元法（FEM）中的Goodman节理单元进行建模。Goodman节理单元是一个零厚度界面，在弹性范围内，其传递的牵引力与节理两侧的相对位移成正比。该节理的法向和剪切刚度分别用 $k_n$ 和 $k_s$ 表示。块体受到约束，仅沿节理发生切向滑动，且法向应力保持在预设值 $\\sigma_n$ 不变。滑动行为受剪切方向的理想弹塑性本构控制，其库仑摩擦特性由摩擦系数 $\\mu$ 和黏聚力 $c$ 描述。自由度（DOF）仅限于剪切方向，并假设节理在弹性范围内是平面的、均质的且完全黏合的。\n\n根据界面上的牵引力平衡以及Goodman节理单元的线性弹性弹簧定律的定义，弹性范围内的牵引力-位移关系按分量定义为\n$$\nt_n = k_n \\,\\delta_n, \\quad t_s = k_s \\,\\delta_s,\n$$\n其中 $t_n$ 是法向牵引力，$t_s$ 是剪切牵引力，$\\delta_n$ 是法向相对位移，$\\delta_s$ 是沿节理的剪切相对位移。在存在剪切库仑摩擦的情况下，弹性范围受屈服边界的限制\n$$\n|t_s| \\le \\tau_{\\max}, \\quad \\tau_{\\max} = c + \\mu \\,\\sigma_n,\n$$\n其中 $c$ 是以帕斯卡为单位的黏聚力，$\\mu$ 是无量纲的摩擦系数。当 $|k_s \\,\\delta_s|  \\tau_{\\max}$ 时，节理发生剪切屈服，牵引力饱和在库仑极限值，其符号与滑动方向一致：\n$$\nt_s = \\operatorname{sign}(\\delta_s) \\,\\tau_{\\max}.\n$$\n\n构建一个面片检验（patch test），其中一个刚性块体在恒定 $\\sigma_n$ 下沿节理滑动，并验证计算出的剪切牵引力 $t_s$ 在弹性范围内（包括等式仍然成立的屈服点）与解析解 $t_s = k_s \\,\\delta_s$ 相等。计算模型应实现以下用于Goodman节理单元剪切行为的本构法则：\n$$\nt_s(\\delta_s;\\sigma_n,k_s,\\mu,c) = \\operatorname{sign}(\\delta_s)\\,\\min\\!\\left(k_s\\,|\\delta_s|,\\;c+\\mu\\,\\sigma_n\\right).\n$$\n\n您的任务是编写一个程序，对于每个测试用例，使用上述本构法则计算 $t_s$，并返回一个布尔值：当状态处于弹性范围内时，该布尔值指示 $t_s$ 是否在指定的数值公差内等于解析弹性表达式 $k_s\\,\\delta_s$；否则，该布尔值指示不相等。比较应使用 $10^{-12}$ 的相对公差和 $10^{-9}$ 帕斯卡的绝对公差。所有物理量必须使用以下单位：位移（米，m），刚度（帕斯卡/米，Pa/m），牵引力和应力（帕斯卡，Pa），以及无量纲的摩擦系数。\n\n实现以下参数测试套件 $(\\sigma_n, k_s, \\mu, c, \\delta_s)$，单位如上所述：\n\n- 案例1（严格弹性，正向滑动）：$(\\sigma_n, k_s, \\mu, c, \\delta_s) = (10^6,\\,5\\times10^9,\\,0.6,\\,0,\\,10^{-4})$。\n- 案例2（屈服开始，等式成立）：$(\\sigma_n, k_s, \\mu, c, \\delta_s) = (10^6,\\,5\\times10^9,\\,0.6,\\,0,\\,1.2\\times10^{-4})$。\n- 案例3（屈服后，正向滑动）：$(\\sigma_n, k_s, \\mu, c, \\delta_s) = (10^6,\\,5\\times10^9,\\,0.6,\\,0,\\,3\\times10^{-4})$。\n- 案例4（严格弹性，零法向应力，黏性节理）：$(\\sigma_n, k_s, \\mu, c, \\delta_s) = (0,\\,10^9,\\,0.5,\\,5\\times10^4,\\,10^{-5})$。\n- 案例5（屈服后，零法向应力，黏性节理）：$(\\sigma_n, k_s, \\mu, c, \\delta_s) = (0,\\,10^9,\\,0.5,\\,5\\times10^4,\\,10^{-3})$。\n- 案例6（退化刚度，弹性产生的剪切阻力为零）：$(\\sigma_n, k_s, \\mu, c, \\delta_s) = (2\\times10^6,\\,0,\\,0.5,\\,0,\\,1)$。\n- 案例7（严格弹性，负向滑动）：$(\\sigma_n, k_s, \\mu, c, \\delta_s) = (10^6,\\,5\\times10^9,\\,0.6,\\,0,\\,-10^{-4})$。\n\n对于每个案例，使用本构法则计算 $t_s$，计算解析弹性表达式 $k_s\\,\\delta_s$，使用判据 $|k_s\\,\\delta_s| \\le c + \\mu\\,\\sigma_n$（等式成立情况视为弹性）确定状态是否为弹性，并返回一个布尔值：\n- 如果状态是弹性的，并且 $t_s$ 在指定公差内等于 $k_s \\,\\delta_s$，则返回 true。\n- 否则返回 false。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[result_1,result_2,\\dots]$）。每个案例的输出必须是布尔值。不需要用户输入，也不应使用外部文件。最终答案应使用Python语言实现，并且必须是一个完整的、可运行的程序。", "solution": "该问题在科学上和数学上是合理的、适定的，并为唯一解提供了所有必要信息。Goodman节理单元、库仑摩擦和理想弹塑性本构模型的概念是计算岩土力学的基础。该问题构成了对本构律数值实现的标准验证测试，通常称为面片检验。所有参数和测试用例都已明确定义。因此，该问题是有效的。\n\n解决方案要求实现一个给定的节理剪切牵引力 $t_s$ 的本构法则，并在特定条件下根据解析弹性解测试其行为。\n\n首先，我们分析所提供的本构关系：\n$$\nt_s(\\delta_s;\\sigma_n,k_s,\\mu,c) = \\operatorname{sign}(\\delta_s)\\,\\min\\!\\left(k_s\\,|\\delta_s|,\\;c+\\mu\\,\\sigma_n\\right)\n$$\n该方程描述了基于库仑摩擦屈服准则的理想弹塑性材料响应。让我们来剖析这个表达式。\n\n节理能够承受的最大剪切牵引力，即剪切强度 $\\tau_{\\max}$，由库仑破坏准则定义：\n$$\n\\tau_{\\max} = c + \\mu\\,\\sigma_n\n$$\n其中 $c$ 是黏聚力，$\\mu$ 是摩擦系数，$\\sigma_n$ 是恒定的法向应力。由于在许多岩土力学约定中，压应力被定义为正值，并且块体很可能在挤压节理，我们将假设 $\\sigma_n \\ge 0$。\n\n$k_s\\,\\delta_s$ 项代表节理的纯弹性响应，其中 $k_s$ 是剪切刚度，$\\delta_s$ 是相对剪切位移。这是“试探”弹性剪切牵引力。该试探牵引力的大小为 $|k_s\\,\\delta_s|$。由于剪切刚度 $k_s$ 是一个非负的物理属性（$k_s \\ge 0$），这可以写成 $k_s\\,|\\delta_s|$。\n\n节理的状态是通过比较试探弹性牵引力的大小与剪切强度来确定的：\n1.  **弹性状态**：如果 $k_s\\,|\\delta_s| \\le \\tau_{\\max}$，节理表现为弹性行为。剪切牵引力不足以引起滑移。在这种情况下，本构法则中的 `min` 函数求值为 $k_s\\,|\\delta_s|$：\n    $$\n    t_s = \\operatorname{sign}(\\delta_s) \\cdot (k_s\\,|\\delta_s|)\n    $$\n    由于 $\\operatorname{sign}(\\delta_s)\\,|\\delta_s| = \\delta_s$，这可以简化为：\n    $$\n    t_s = k_s\\,\\delta_s\n    $$\n    这证实了在弹性范围内，计算出的牵引力等于解析弹性表达式。这也适用于屈服开始时，即 $k_s\\,|\\delta_s| = \\tau_{\\max}$ 的情况。\n\n2.  **塑性（屈服）状态**：如果 $k_s\\,|\\delta_s|  \\tau_{\\max}$，节理屈服并发生塑性滑移。剪切牵引力受节理强度的限制。在这种情况下，`min` 函数求值为 $\\tau_{\\max}$：\n    $$\n    t_s = \\operatorname{sign}(\\delta_s)\\,\\tau_{\\max}\n    $$\n    剪切牵引力饱和在可能的最大值，其符号由相对位移 $\\delta_s$ 的方向决定。\n\n问题要求对每组参数进行特定的布尔测试。当且仅当满足两个条件时，测试必须返回 `True`：\n1.  状态是弹性的，由判据 $|k_s\\,\\delta_s| \\le c + \\mu\\,\\sigma_n$ 定义。请注意，使用绝对值是为了正确处理负的剪切位移 $\\delta_s$。\n2.  使用完整本构法则计算的剪切牵引力 $t_s$ 在数值上等于解析弹性表达式 $k_s\\,\\delta_s$。此比较必须使用 $10^{-12}$ 的相对公差和 $10^{-9}$ 的绝对公差。\n\n每个测试用例的算法如下：\n1.  给定输入参数 $(\\sigma_n, k_s, \\mu, c, \\delta_s)$。\n2.  计算剪切强度：$\\tau_{\\max} = c + \\mu\\,\\sigma_n$。\n3.  计算解析弹性牵引力：$t_{s, \\text{elastic}} = k_s\\,\\delta_s$。\n4.  检查弹性条件：评估布尔表达式 `is_elastic` = ($|t_{s, \\text{elastic}}| \\le \\tau_{\\max}$)。\n5.  使用完整本构模型计算剪切牵引力：$t_{s, \\text{computed}} = \\operatorname{sign}(\\delta_s)\\,\\min(|t_{s, \\text{elastic}}|, \\tau_{\\max})$。\n6.  检查数值相等性：通过将 $t_{s, \\text{computed}}$ 和 $t_{s, \\text{elastic}}$ 与指定的公差进行比较，评估布尔表达式 `are_equal`。\n7.  测试用例的最终结果是这两个布尔值的逻辑与：`result = is_elastic AND are_equal`。\n\n此过程将应用于七个测试用例中的每一个，以生成最终的布尔结果列表。例如，在案例3中：$(\\sigma_n, k_s, \\mu, c, \\delta_s) = (10^6,\\,5\\times10^9,\\,0.6,\\,0,\\,3\\times10^{-4})$，我们有：\n-   $\\tau_{\\max} = 0 + 0.6 \\times 10^6 = 6 \\times 10^5$ Pa。\n-   $t_{s, \\text{elastic}} = (5\\times10^9) \\times (3\\times10^{-4}) = 1.5 \\times 10^6$ Pa。\n-   弹性检查：$|1.5 \\times 10^6| \\le 6 \\times 10^5$ 为 `False`。\n-   此案例的最终结果为 `False`，因为第一个条件未满足。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Goodman joint element patch test problem for a series of cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (sigma_n, k_s, mu, c, delta_s)\n    # sigma_n: Normal stress in Pa\n    # k_s: Shear stiffness in Pa/m\n    # mu: Friction coefficient (dimensionless)\n    # c: Cohesion in Pa\n    # delta_s: Relative shear displacement in m\n    test_cases = [\n        # Case 1 (strictly elastic, positive sliding)\n        (1e6, 5e9, 0.6, 0, 1e-4),\n        # Case 2 (onset of yield, equality holds)\n        (1e6, 5e9, 0.6, 0, 1.2e-4),\n        # Case 3 (post-yield, positive sliding)\n        (1e6, 5e9, 0.6, 0, 3e-4),\n        # Case 4 (strictly elastic, zero normal stress, cohesive joint)\n        (0, 1e9, 0.5, 5e4, 1e-5),\n        # Case 5 (post-yield, zero normal stress, cohesive joint)\n        (0, 1e9, 0.5, 5e4, 1e-3),\n        # Case 6 (degenerate stiffness, zero shear resistance from elasticity)\n        (2e6, 0, 0.5, 0, 1),\n        # Case 7 (strictly elastic, negative sliding)\n        (1e6, 5e9, 0.6, 0, -1e-4),\n    ]\n\n    results = []\n    # Define numerical tolerances for equality check\n    rtol = 1e-12\n    atol = 1e-9\n\n    for case in test_cases:\n        sigma_n, k_s, mu, c, delta_s = case\n\n        # Calculate shear strength (yield limit) based on Coulomb friction\n        tau_max = c + mu * sigma_n\n\n        # Calculate the analytical elastic shear traction\n        ts_elastic = k_s * delta_s\n\n        # Determine if the state is elastic based on the yield criterion.\n        # The problem statement specifies that equality (onset of yield)\n        # is considered an elastic state for this test.\n        is_elastic = np.abs(ts_elastic) = tau_max\n\n        # Calculate the shear traction using the full elastic-perfectly plastic constitutive rule.\n        # t_s = sign(delta_s) * min(k_s * |delta_s|, tau_max)\n        # This is equivalent to sign(delta_s) * min(|ts_elastic|, tau_max)\n        # We must handle the case delta_s = 0, where np.sign(0) = 0.\n        ts_magnitude = min(np.abs(ts_elastic), tau_max)\n        ts_computed = np.sign(delta_s) * ts_magnitude\n        \n        # Check if the computed traction equals the analytical elastic expression\n        # within the specified tolerance. This is the second part of the patch test condition.\n        are_equal = np.isclose(ts_computed, ts_elastic, rtol=rtol, atol=atol)\n\n        # The final result is True only if the state is elastic AND the computed traction\n        # matches the elastic one. Otherwise, it is False.\n        result = is_elastic and are_equal\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # Convert boolean values to lowercase 'true' or 'false' for direct printing.\n    print(f\"[{','.join(map(str, results))}]\".lower())\n\nsolve()\n```", "id": "3528461"}, {"introduction": "为了在先进的隐式有限元模拟中高效地使用Goodman节理单元，仅仅计算应力是远远不够的。这个高级练习[@problem_id:3528471]深入到非线性计算力学的核心，要求您推导并实现残差向量$r(u)$和至关重要的一致切线刚度矩阵$K(u)$。对于像库仑摩擦这样的非关联塑性模型，正确计算一致切线刚度是确保牛顿-拉弗森迭代法实现二次收敛的关键，从而大大提高非线性分析的计算效率和稳健性。", "problem": "考虑一个二维 Goodman 节理单元，该单元连接两个连续介质有限元网格，跨越一个潜在的不连续面。该节理单元通过法向和剪切方向上的线性弹性界面弹簧进行建模，并耦合了率无关的库仑摩擦定律。设节理处的位移跳跃矢量为 $u = [u_n, u_s]^\\top$，其中 $u_n$ 是相对法向位移（张开为正），$u_s$ 是相对剪切位移。应力矢量为 $t = [\\sigma_n, \\tau]^\\top$，其中 $\\sigma_n$ 是法向应力（受压为正），$\\tau$ 是剪切应力。其力学行为由以下物理上标准的要素来表征：\n\n1. 受压和粘滞状态下的线性界面弹簧：\n   - 法向应力在受压时呈线性关系，刚度为 $k_n$，在张开时消失：$\\sigma_n$ 取决于 $u_n$，当 $u_n \\ge 0$ 时为零。\n   - 剪切应力在粘滞时呈线性关系，刚度为 $k_s$：$\\tau$ 取决于 $u_s$，在粘滞区域内与 $u_n$ 没有直接耦合。\n\n2. 法向的单边接触：\n   - 单元承受压缩但不受拉伸，与不可穿透条件一致：仅当 $u_n  0$ 时接触才被激活。\n\n3. 剪切的库仑摩擦定律：\n   - 当接触被激活时（$u_n  0$），摩擦边界为 $|\\tau| \\le \\mu\\,\\sigma_n$，其中 $\\mu$ 是摩擦系数，$\\sigma_n$ 是压缩法向应力。\n   - 假设为单调剪切加载，但算法必须能正确检测和处理粘滞与滑移。\n\n在 Newton–Raphson (NR) 迭代下，为确保二次收敛，需要使用一致切线，其定义为残差对位移跳跃的精确导数。您的任务是为具有上述行为的 Goodman 节理单元推导、实现和评估残余应力矢量 $r(u) = t(u)$ 和一致切线矩阵 $K(u) = \\partial t / \\partial u$。仅使用以下基本定律和原理：\n\n- 界面单元的虚功原理，关联应力与位移跳跃。\n- 在粘滞和受压状态下法向和剪切方向的线性弹性弹簧行为。\n- 带有回归映射更新的率无关库仑摩擦定律，以施加摩擦约束。\n- 法向的单边接触（无拉伸）。\n\n单位和约定：\n\n- 使用 $u_n$ 和 $u_s$，单位为毫米 (mm)。\n- 使用 $\\sigma_n$ 和 $\\tau$，单位为兆帕 (MPa)。\n- 使用 $k_n$ 和 $k_s$，单位为 MPa/mm。\n- 使用 $\\mu$，无量纲。\n- 最终的残差分量必须以 MPa 表示，切线矩阵的条目必须以 MPa/mm 表示。所有数值输出必须四舍五入到六位小数。\n\n算法要求：\n\n- 基于零外部应力构建残差，使得 $r(u) = t(u)$。\n- 为剪切应力实现回归映射更新，以在接触激活且试探剪切应力大小超过摩擦边界时施加库仑摩擦定律。\n- 为粘滞、滑移和张开接触状态分段计算一致切线矩阵 $K(u)$，确保它在每个状态下都是 $t$ 相对于 $u$ 的精确导数。\n\n测试套件：\n\n使用以下参数值和位移跳跃：\n\n- 材料和界面参数：\n  - $k_n = 10000$ MPa/mm\n  - $k_s = 5000$ MPa/mm\n  - $\\mu = 0.6$\n\n- 测试用例，每个用例以 $(u_n, u_s)$ 形式给出，单位为 mm：\n  1. $(-0.001, 0.0005)$: 激活压缩，预期为粘滞。\n  2. $(-0.001, 0.002)$: 激活压缩，预期在正剪切方向上滑移。\n  3. $(+0.0002, 0.005)$: 张开（无接触），两种应力都应为零。\n  4. $(-0.001, 0.0012)$: 在受压状态下的摩擦边界上，预期在正剪切方向上滑移。\n  5. $(-0.002, -0.004)$: 激活压缩，预期在负剪切方向上滑移。\n\n对于每个测试用例，计算：\n\n- 残余应力矢量分量 $[\\sigma_n, \\tau]$，单位为 MPa。\n- 一致切线矩阵条目 $\\left[K_{11}, K_{12}, K_{21}, K_{22}\\right]$，单位为 MPa/mm，其中 $K_{ij} = \\partial t_i / \\partial u_j$ 且 $t_1 = \\sigma_n$, $t_2 = \\tau$, $u_1 = u_n$, $u_2 = u_s$。\n- 一个滑移指示器，定义为整数：如果发生滑移则为 $1$，否则为 $0$。\n\n最终输出格式：\n\n您的程序应生成单行输出，其中包含一个逗号分隔的列表，列表被方括号括起来，每个测试用例对应一个包含七个值的子列表 $[\\sigma_n, \\tau, K_{11}, K_{12}, K_{21}, K_{22}, \\mathrm{sliding}]$。所有浮点数值必须四舍五入到六位小数，并使用上述指定的单位，例如：\n\"[[\\dots],[\\dots],[\\dots],[\\dots],[\\dots]]\"。", "solution": "该问题要求推导并实现一个二维 Goodman 节理单元的本构关系。这涉及确定应力矢量 $t(u)$ 和一致切线矩阵 $K(u)$ 作为相对位移跳跃矢量 $u = [u_n, u_s]^\\top$ 的函数。该单元的行为由线性弹性、单边接触以及率无关的库仑摩擦定律共同决定。提供的符号约定为：$u_n  0$ 表示张开，$\\sigma_n  0$ 表示受压。\n\n推导过程分为三个不同的力学状态：张开接触、粘滞接触和滑移接触。\n\n**1. 张开接触状态 ($u_n \\ge 0$)**\n\n当法向位移跳跃 $u_n$ 为非负时，节理被视为张开。在此状态下，表面不接触，没有应力可以跨界面传递。\n\n*   **应力矢量 ($t$)**: 法向和剪切应力均为零。\n    $$\n    t(u) = \\begin{bmatrix} \\sigma_n \\\\ \\tau \\end{bmatrix} = \\begin{bmatrix} 0 \\\\ 0 \\end{bmatrix}\n    $$\n\n*   **一致切线矩阵 ($K$)**: 切线矩阵是应力矢量对位移跳跃矢量的导数。由于在此状态下应力是常数（零），所有导数分量均为零。\n    $$\n    K(u) = \\frac{\\partial t}{\\partial u} = \\begin{bmatrix} \\frac{\\partial \\sigma_n}{\\partial u_n}  \\frac{\\partial \\sigma_n}{\\partial u_s} \\\\ \\frac{\\partial \\tau}{\\partial u_n}  \\frac{\\partial \\tau}{\\partial u_s} \\end{bmatrix} = \\begin{bmatrix} 0  0 \\\\ 0  0 \\end{bmatrix}\n    $$\n\n**2. 接触状态 ($u_n  0$)**\n\n当 $u_n  0$ 时，表面接触，允许传递法向和剪切应力。其响应通过标准的弹性预测-塑性修正（回归映射）方案确定。\n\n*   **法向响应**: 法向应力 $\\sigma_n$ 与压缩法向位移成线性比例关系。根据符号约定，此关系为：\n    $$\n    \\sigma_n = -k_n u_n\n    $$\n    这确保了对于压缩位移（$u_n  0$），会产生压缩应力（$\\sigma_n  0$）。此关系与剪切行为无关。\n\n*   **剪切响应（回归映射）**:\n    1.  **弹性预测（试探状态）**: 首先，我们假设剪切响应是纯弹性的（粘滞）。试探剪切应力 $\\tau^{\\text{trial}}$ 计算如下：\n        $$\n        \\tau^{\\text{trial}} = k_s u_s\n        $$\n    2.  **屈服条件检查**: 库仑摩擦准则定义了容许剪切应力的极限，从而建立了屈服函数 $\\Phi$。如果试探剪切应力的大小超过了与法向压缩成正比的摩擦能力，则发生滑移。摩擦能力为 $\\tau_{\\text{crit}} = \\mu \\sigma_n$。屈服函数为：\n        $$\n        \\Phi(u) = |\\tau^{\\text{trial}}| - \\mu \\sigma_n = |k_s u_s| - \\mu(-k_n u_n) = |k_s u_s| + \\mu k_n u_n\n        $$\n        根据测试用例4的问题描述，滑移条件取为 $\\Phi \\ge 0$，这对应于 $|\\tau^{\\text{trial}}| \\ge \\mu \\sigma_n$。\n\n**2.1. 粘滞接触子状态 ($u_n  0$ and $|\\tau^{\\text{trial}}|  \\mu \\sigma_n$)**\n\n如果试探剪切应力在摩擦锥内，则弹性假设成立。\n\n*   **应力矢量 ($t$)**: 最终应力即为弹性计算出的应力。\n    $$\n    t(u) = \\begin{bmatrix} \\sigma_n \\\\ \\tau \\end{bmatrix} = \\begin{bmatrix} -k_n u_n \\\\ k_s u_s \\end{bmatrix}\n    $$\n\n*   **一致切线矩阵 ($K$)**: 通过对应力矢量求导获得切线矩阵。\n    $$\n    K^{\\text{stick}} = \\frac{\\partial t}{\\partial u} = \\begin{bmatrix} \\frac{\\partial(-k_n u_n)}{\\partial u_n}  \\frac{\\partial(-k_n u_n)}{\\partial u_s} \\\\ \\frac{\\partial(k_s u_s)}{\\partial u_n}  \\frac{\\partial(k_s u_s)}{\\partial u_s} \\end{bmatrix} = \\begin{bmatrix} -k_n  0 \\\\ 0  k_s \\end{bmatrix}\n    $$\n    在此状态下，切线矩阵是对角的且为常数。$K_{11}$ 中的负号是 $\\sigma_n$ 和 $u_n$ 符号约定的直接结果。\n\n**2.2. 滑移接触子状态 ($u_n  0$ and $|\\tau^{\\text{trial}}| \\ge \\mu \\sigma_n$)**\n\n如果试探剪切应力违反了摩擦准则，则应用塑性修正（回归映射）。剪切应力被返回到摩擦锥的边界上。\n\n*   **应力矢量 ($t$)**: 法向应力不受影响。剪切应力被缩回至摩擦极限，同时保持其方向。\n    $$\n    \\tau = (\\mu \\sigma_n) \\cdot \\text{sign}(\\tau^{\\text{trial}}) = (\\mu (-k_n u_n)) \\cdot \\text{sign}(k_s u_s) = -\\mu k_n u_n \\cdot \\text{sign}(u_s)\n    $$\n    完整的应力矢量为：\n    $$\n    t(u) = \\begin{bmatrix} \\sigma_n \\\\ \\tau \\end{bmatrix} = \\begin{bmatrix} -k_n u_n \\\\ -\\mu k_n u_n \\cdot \\text{sign}(u_s) \\end{bmatrix}\n    $$\n\n*   **一致切线矩阵 ($K$)**: 切线矩阵是此更新后应力矢量的导数。对于 $u_s \\neq 0$，$\\text{sign}(u_s)$ 项的导数为零。滑移条件意味着 $\\tau^{\\text{trial}} \\neq 0$，因此 $u_s \\neq 0$。\n    $$\n    K^{\\text{slide}} = \\frac{\\partial t}{\\partial u} = \\begin{bmatrix} \\frac{\\partial(-k_n u_n)}{\\partial u_n}  \\frac{\\partial(-k_n u_n)}{\\partial u_s} \\\\ \\frac{\\partial(-\\mu k_n u_n \\cdot \\text{sign}(u_s))}{\\partial u_n}  \\frac{\\partial(-\\mu k_n u_n \\cdot \\text{sign}(u_s))}{\\partial u_s} \\end{bmatrix}\n    $$\n    $$\n    K^{\\text{slide}} = \\begin{bmatrix} -k_n  0 \\\\ -\\mu k_n \\cdot \\text{sign}(u_s)  0 \\end{bmatrix}\n    $$\n    该矩阵是非对称的（$K_{21} \\neq K_{12}$），这是像库仑摩擦这类非关联塑性模型的一致切线的一个关键特征。非对角项 $K_{21}$ 表示了耦合作用，即法向位移 $u_n$ 的变化通过改变法向应力进而改变摩擦极限，从而直接改变剪切应力 $\\tau$。\n\n**算法总结**\n对于给定的位移跳跃 $u = [u_n, u_s]^\\top$ 和参数 $k_n, k_s, \\mu$：\n1.  如果 $u_n \\ge 0$：设置 $\\sigma_n=0$, $\\tau=0$, $K=[[0,0],[0,0]]$, 且 sliding=0。\n2.  如果 $u_n  0$：\n    a. 计算 $\\sigma_n = -k_n u_n$。\n    b. 计算 $\\tau^{\\text{trial}} = k_s u_s$。\n    c. 计算 $\\tau_{\\text{crit}} = \\mu \\sigma_n$。\n    d. 如果 $|\\tau^{\\text{trial}}| \\ge \\tau_{\\text{crit}}$ (滑移)：\n        i. $\\tau = \\tau_{\\text{crit}} \\cdot \\text{sign}(u_s)$。\n        ii. $K_{11} = -k_n$, $K_{12}=0$, $K_{21} = -\\mu k_n \\cdot \\text{sign}(u_s)$, $K_{22}=0$。\n        iii. sliding=1。\n    e. 否则 (粘滞)：\n        i. $\\tau = \\tau^{\\text{trial}}$。\n        ii. $K_{11} = -k_n$, $K_{12}=0$, $K_{21}=0$, $K_{22}=k_s$。\n        iii. sliding=0。\n该算法为实现提供了基础。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the residual traction and consistent tangent matrix for a Goodman joint element\n    under various displacement jumps, based on a Coulomb friction model.\n    \"\"\"\n    # Material and interface parameters\n    k_n = 10000.0  # Normal stiffness in MPa/mm\n    k_s = 5000.0   # Shear stiffness in MPa/mm\n    mu = 0.6       # Friction coefficient (dimensionless)\n\n    # Test cases defined as (u_n, u_s) tuples in mm\n    test_cases = [\n        (-0.001, 0.0005),  # Active compression, sticking\n        (-0.001, 0.002),   # Active compression, sliding (+)\n        (0.0002, 0.005),   # Opening, no contact\n        (-0.001, 0.0012),  # Active compression, on friction boundary (sliding)\n        (-0.002, -0.004),  # Active compression, sliding (-)\n    ]\n\n    results = []\n\n    for u_n, u_s in test_cases:\n        # Initialize outputs for the open-contact case\n        sigma_n, tau = 0.0, 0.0\n        K11, K12, K21, K22 = 0.0, 0.0, 0.0, 0.0\n        sliding_indicator = 0\n\n        # Regime 1: Open Contact (u_n = 0)\n        # In this case, tractions and stiffnesses are zero, so initial values are correct.\n\n        # Regime 2: Active Contact (u_n  0)\n        if u_n  0:\n            # Normal traction (positive in compression)\n            sigma_n = -k_n * u_n\n\n            # Elastic predictor step: compute trial shear traction\n            tau_trial = k_s * u_s\n\n            # Friction capacity (critical shear traction)\n            tau_crit = mu * sigma_n\n\n            # Check yield condition to determine sticking or sliding\n            # Based on the problem statement's expectation for case 4,\n            # the boundary |tau_trial| == tau_crit is treated as sliding.\n            if np.abs(tau_trial) = tau_crit:\n                # Sliding state\n                sliding_indicator = 1\n                \n                # Return-mapping: project shear traction onto the yield surface\n                # Ensure sign of tau matches sign of shear displacement u_s\n                tau = tau_crit * np.sign(u_s)\n                \n                # Consistent tangent matrix for the sliding regime\n                K11 = -k_n\n                K12 = 0.0\n                K21 = -mu * k_n * np.sign(u_s)\n                K22 = 0.0\n            else:\n                # Sticking state\n                sliding_indicator = 0\n                \n                # Shear traction is the elastic trial value\n                tau = tau_trial\n                \n                # Consistent tangent matrix for the sticking regime\n                K11 = -k_n\n                K12 = 0.0\n                K21 = 0.0\n                K22 = k_s\n        \n        # Format the results for the current test case, rounding to 6 decimal places.\n        case_result = [\n            round(sigma_n, 6),\n            round(tau, 6),\n            round(K11, 6),\n            round(K12, 6),\n            round(K21, 6),\n            round(K22, 6),\n            sliding_indicator\n        ]\n        \n        # Convert list to string format '[v1,v2,...]' without spaces\n        results.append(str(case_result).replace(\" \", \"\"))\n\n    # Print the final output as a single-line string\n    # in the format \"[[...],[...],...]\"\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3528471"}]}