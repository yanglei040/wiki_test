{"hands_on_practices": [{"introduction": "径向返回法是许多塑性模型隐式应力积分算法的基石。本练习将指导您为经典的von Mises ($J_2$)模型推导这一基本算法，这是理解更复杂模型的理想起点。通过完整的理论推导和具体的数值算例[@problem_id:3532232]，您将牢固掌握在塑性加载过程中如何将弹性试探应力校正回屈服面的核心思想与计算步骤。", "problem": "考虑一个基于偏应力张量第二不变量（通常记为 $J_2$）的小应变、各向同性硬化、关联 von Mises 塑性模型。设弹性域由屈服函数 $f(\\boldsymbol{\\sigma}, \\bar{\\varepsilon}^{p}) = \\sigma_{\\mathrm{eq}} - \\sigma_{y}(\\bar{\\varepsilon}^{p})$ 定义，其中等效应力为 $\\sigma_{\\mathrm{eq}} = \\sqrt{\\frac{3}{2}}\\,\\|\\boldsymbol{s}\\|$，$\\boldsymbol{s} = \\boldsymbol{\\sigma} - \\frac{1}{3}\\mathrm{tr}(\\boldsymbol{\\sigma})\\,\\boldsymbol{I}$ 是偏应力，各向同性硬化遵循 $\\sigma_{y}(\\bar{\\varepsilon}^{p}) = \\sigma_{y0} + H\\,\\bar{\\varepsilon}^{p}$，其中 $\\sigma_{y0} > 0$ 且 $H \\ge 0$。弹性响应是线性的，剪切模量为 $G>0$。塑性流动是关联的，即 $d\\boldsymbol{\\varepsilon}^{p} = d\\gamma\\,\\frac{\\partial f}{\\partial \\boldsymbol{\\sigma}}$，且等效塑性应变增量满足 $d\\bar{\\varepsilon}^{p} = d\\gamma$。\n\n从这些基本定义和后向欧拉应力更新出发，推导 $J_2$ 塑性的隐式径向返回算法在主空间中的形式，证明更新后的主偏应力与试探主偏应力共线，并且可以通过一个必须从第一性原理推导出的单个标量因子来表示。然后，将你的结果应用于以下试探状态和材料参数，以计算更新后的主偏应力。\n\n给定试探主偏应力 $s_{1}^{\\mathrm{tr}} = 100~\\mathrm{MPa}$，$s_{2}^{\\mathrm{tr}} = -50~\\mathrm{MPa}$，$s_{3}^{\\mathrm{tr}} = -50~\\mathrm{MPa}$，剪切模量 $G = 300~\\mathrm{MPa}$，初始屈服应力 $\\sigma_{y0} = 80~\\mathrm{MPa}$，各向同性硬化模量 $H = 100~\\mathrm{MPa}$，以及前一步的等效塑性应变 $\\bar{\\varepsilon}^{p}_{n} = 0.2$，请使用主空间中的隐式径向返回算法计算更新后的主偏应力 $s_{1,n+1}$、$s_{2,n+1}$、$s_{3,n+1}$。最终应力以 $\\mathrm{MPa}$ 为单位表示。如果需要数值近似，请将答案四舍五入至四位有效数字。将最终答案以包含三个分量的单行矩阵形式提供。", "solution": "该问题陈述被评估为有效。这是一个在计算固体力学领域内适定的、有科学依据的、客观的问题，具体涉及弹塑性本构模型的实现。所有必需的材料参数和初始条件均已提供，所要求的推导和计算是 $J_2$ 塑性模型的标准程序。\n\n求解过程分两部分。首先，在主应力空间中推导 $J_2$ 塑性隐式径向返回算法的一般形式。其次，将此算法应用于给定的数值数据，以求得更新后的应力状态。\n\n**第一部分：隐式径向返回算法的推导**\n\n总应变增量 $\\Delta\\boldsymbol{\\varepsilon}$ 被加法分解为一个弹性部分 $\\Delta\\boldsymbol{\\varepsilon}^{e}$ 和一个塑性部分 $\\Delta\\boldsymbol{\\varepsilon}^{p}$。根据弹性预测-塑性修正框架，最终应力 $\\boldsymbol{\\sigma}_{n+1}$ 与试探应力 $\\boldsymbol{\\sigma}^{\\mathrm{tr}}$ 的关系为：\n$$\n\\boldsymbol{\\sigma}_{n+1} = \\boldsymbol{\\sigma}^{\\mathrm{tr}} - \\boldsymbol{C}:\\Delta\\boldsymbol{\\varepsilon}^{p}\n$$\n其中 $\\boldsymbol{\\sigma}^{\\mathrm{tr}} = \\boldsymbol{\\sigma}_{n} + \\boldsymbol{C}:\\Delta\\boldsymbol{\\varepsilon}$。对于线性各向同性弹性材料，该关系可以分解为体积部分和偏量部分。偏应力更新由下式给出：\n$$\n\\boldsymbol{s}_{n+1} = \\boldsymbol{s}^{\\mathrm{tr}} - 2G\\,\\Delta\\boldsymbol{\\varepsilon}^{p}\n$$\n其中 $G$ 是剪切模量。塑性应变增量 $\\Delta\\boldsymbol{\\varepsilon}^{p}$ 由关联流动法则的后向欧拉积分确定：\n$$\n\\Delta\\boldsymbol{\\varepsilon}^{p} = \\Delta\\gamma\\,\\left(\\frac{\\partial f}{\\partial\\boldsymbol{\\sigma}}\\right)_{\\boldsymbol{\\sigma}=\\boldsymbol{\\sigma}_{n+1}}\n$$\n其中 $\\Delta\\gamma \\ge 0$ 是塑性乘子增量。屈服函数为 $f = \\sigma_{\\mathrm{eq}} - \\sigma_{y}$，其梯度为：\n$$\n\\frac{\\partial f}{\\partial\\boldsymbol{\\sigma}} = \\frac{\\partial \\sigma_{\\mathrm{eq}}}{\\partial\\boldsymbol{\\sigma}} = \\sqrt{\\frac{3}{2}} \\frac{\\partial}{\\partial\\boldsymbol{\\sigma}}(\\boldsymbol{s}:\\boldsymbol{s})^{1/2} = \\sqrt{\\frac{3}{2}} \\frac{\\boldsymbol{s}}{\\|\\boldsymbol{s}\\|}\n$$\n令 $\\boldsymbol{N}_{n+1} = \\frac{\\boldsymbol{s}_{n+1}}{\\|\\boldsymbol{s}_{n+1}\\|}$ 为第 $n+1$ 步时偏应力空间中屈服面的单位法向量。那么，$\\Delta\\boldsymbol{\\varepsilon}^{p} = \\Delta\\gamma \\sqrt{\\frac{3}{2}}\\boldsymbol{N}_{n+1}$。将此代入偏应力更新方程：\n$$\n\\boldsymbol{s}_{n+1} = \\boldsymbol{s}^{\\mathrm{tr}} - 2G \\left( \\Delta\\gamma \\sqrt{\\frac{3}{2}} \\boldsymbol{N}_{n+1} \\right)\n$$\n用其定义 $\\boldsymbol{N}_{n+1} = \\boldsymbol{s}_{n+1}/\\|\\boldsymbol{s}_{n+1}\\|$ 替换 $\\boldsymbol{N}_{n+1}$，并对 $\\boldsymbol{s}_{n+1}$ 进行整理，得到：\n$$\n\\boldsymbol{s}_{n+1}\\left(1 + \\frac{2G\\Delta\\gamma\\sqrt{3/2}}{\\|\\boldsymbol{s}_{n+1}\\|}\\right) = \\boldsymbol{s}^{\\mathrm{tr}}\n$$\n该方程证明了更新后的偏应力张量 $\\boldsymbol{s}_{n+1}$ 与试探偏应力张量 $\\boldsymbol{s}^{\\mathrm{tr}}$ 共线。这导致了一个关键简化：$\\boldsymbol{N}_{n+1} = \\frac{\\boldsymbol{s}_{n+1}}{\\|\\boldsymbol{s}_{n+1}\\|} = \\frac{\\boldsymbol{s}^{\\mathrm{tr}}}{\\|\\boldsymbol{s}^{\\mathrm{tr}}\\|} \\equiv \\boldsymbol{N}^{\\mathrm{tr}}$。因此，应力更新是一个沿着由 $\\boldsymbol{s}^{\\mathrm{tr}}$ 定义的方向的返回映射：\n$$\n\\boldsymbol{s}_{n+1} = \\boldsymbol{s}^{\\mathrm{tr}} - 2G\\Delta\\gamma\\sqrt{\\frac{3}{2}}\\boldsymbol{N}^{\\mathrm{tr}}\n$$\n为了求出未知的塑性乘子 $\\Delta\\gamma$，我们强制执行塑性一致性条件 $f(\\boldsymbol{\\sigma}_{n+1}, \\bar{\\varepsilon}^{p}_{n+1}) = 0$，即 $\\sigma_{\\mathrm{eq},n+1} = \\sigma_{y,n+1}$。\n对上述 $\\boldsymbol{s}_{n+1}$ 方程两边取范数，并利用 $\\boldsymbol{N}^{\\mathrm{tr}}$ 是单位向量的事实，得到：\n$$\n\\|\\boldsymbol{s}_{n+1}\\| = \\|\\boldsymbol{s}^{\\mathrm{tr}}\\| - 2G\\Delta\\gamma\\sqrt{\\frac{3}{2}}\n$$\n将此方程两边乘以 $\\sqrt{3/2}$，得到等效应力的关系：\n$$\n\\sigma_{\\mathrm{eq},n+1} = \\sigma_{\\mathrm{eq}}^{\\mathrm{tr}} - 3G\\Delta\\gamma\n$$\n屈服应力根据硬化定律更新：$\\sigma_{y,n+1} = \\sigma_{y,n} + H\\,\\Delta\\bar{\\varepsilon}^{p}$。由于 $d\\bar{\\varepsilon}^{p} = d\\gamma$，对于后向欧拉法，$\\Delta\\bar{\\varepsilon}^{p} = \\Delta\\gamma$。因此，$\\sigma_{y,n+1} = \\sigma_{y,n} + H\\Delta\\gamma$。\n将 $\\sigma_{\\mathrm{eq},n+1}$ 和 $\\sigma_{y,n+1}$ 的表达式代入一致性条件：\n$$\n\\sigma_{\\mathrm{eq}}^{\\mathrm{tr}} - 3G\\,\\Delta\\gamma = \\sigma_{y,n} + H\\,\\Delta\\gamma\n$$\n解出 $\\Delta\\gamma$：\n$$\n\\Delta\\gamma = \\frac{\\sigma_{\\mathrm{eq}}^{\\mathrm{tr}} - \\sigma_{y,n}}{3G + H}\n$$\n这仅在发生塑性时有效，即 $f^{\\mathrm{tr}} = \\sigma_{\\mathrm{eq}}^{\\mathrm{tr}} - \\sigma_{y,n} > 0$。如果 $f^{\\mathrm{tr}} \\le 0$，则该步是弹性的，$\\Delta\\gamma=0$。所以，更一般地：\n$$\n\\Delta\\gamma = \\frac{\\max(0, f^{\\mathrm{tr}})}{3G + H}\n$$\n最后，我们推导关联 $\\boldsymbol{s}_{n+1}$ 和 $\\boldsymbol{s}^{\\mathrm{tr}}$ 的标量因子。由于共线性，$\\boldsymbol{s}_{n+1} = \\alpha \\boldsymbol{s}^{\\mathrm{tr}}$，这意味着 $\\sigma_{\\mathrm{eq},n+1} = \\alpha \\sigma_{\\mathrm{eq}}^{\\mathrm{tr}}$。因此，$\\alpha = \\sigma_{\\mathrm{eq},n+1} / \\sigma_{\\mathrm{eq}}^{\\mathrm{tr}}$。将 $\\sigma_{\\mathrm{eq},n+1} = \\sigma_{\\mathrm{eq}}^{\\mathrm{tr}} - 3G\\Delta\\gamma$ 代入，得到：\n$$\n\\alpha = \\frac{\\sigma_{\\mathrm{eq}}^{\\mathrm{tr}} - 3G\\Delta\\gamma}{\\sigma_{\\mathrm{eq}}^{\\mathrm{tr}}} = 1 - \\frac{3G\\Delta\\gamma}{\\sigma_{\\mathrm{eq}}^{\\mathrm{tr}}}\n$$\n因此，应力更新可以简洁地写为：$\\boldsymbol{s}_{n+1} = \\left(1 - \\frac{3G\\Delta\\gamma}{\\sigma_{\\mathrm{eq}}^{\\mathrm{tr}}}\\right) \\boldsymbol{s}^{\\mathrm{tr}}$。\n\n**第二部分：应用于数值数据**\n\n**给定：**\n- 试探主偏应力：$s_{1}^{\\mathrm{tr}} = 100~\\mathrm{MPa}$，$s_{2}^{\\mathrm{tr}} = -50~\\mathrm{MPa}$，$s_{3}^{\\mathrm{tr}} = -50~\\mathrm{MPa}$。\n- 材料参数：$G = 300~\\mathrm{MPa}$，$\\sigma_{y0} = 80~\\mathrm{MPa}$，$H = 100~\\mathrm{MPa}$。\n- 先前状态：$\\bar{\\varepsilon}^{p}_{n} = 0.2$。\n\n**1. 检查塑性**\n首先，计算试探等效应力 $\\sigma_{\\mathrm{eq}}^{\\mathrm{tr}}$：\n$$\n\\sigma_{\\mathrm{eq}}^{\\mathrm{tr}} = \\sqrt{\\frac{3}{2}\\left((s_{1}^{\\mathrm{tr}})^2 + (s_{2}^{\\mathrm{tr}})^2 + (s_{3}^{\\mathrm{tr}})^2\\right)} = \\sqrt{\\frac{3}{2}\\left((100)^2 + (-50)^2 + (-50)^2\\right)}\n$$\n$$\n\\sigma_{\\mathrm{eq}}^{\\mathrm{tr}} = \\sqrt{\\frac{3}{2}\\left(10000 + 2500 + 2500\\right)} = \\sqrt{\\frac{3}{2}(15000)} = \\sqrt{22500} = 150~\\mathrm{MPa}\n$$\n接下来，计算该步开始时的屈服应力 $\\sigma_{y,n}$：\n$$\n\\sigma_{y,n} = \\sigma_{y0} + H\\,\\bar{\\varepsilon}^{p}_{n} = 80 + 100 \\times 0.2 = 80 + 20 = 100~\\mathrm{MPa}\n$$\n试探屈服函数值为 $f^{\\mathrm{tr}} = \\sigma_{\\mathrm{eq}}^{\\mathrm{tr}} - \\sigma_{y,n} = 150 - 100 = 50~\\mathrm{MPa}$。由于 $f^{\\mathrm{tr}} > 0$，该状态位于弹性域之外，发生塑性变形。\n\n**2. 计算塑性乘子增量**\n使用推导出的公式：\n$$\n\\Delta\\gamma = \\frac{f^{\\mathrm{tr}}}{3G + H} = \\frac{50}{3(300) + 100} = \\frac{50}{900 + 100} = \\frac{50}{1000} = 0.05\n$$\n\n**3. 计算更新后的主偏应力**\n更新后的偏应力由 $\\boldsymbol{s}_{n+1} = \\boldsymbol{s}^{\\mathrm{tr}} \\left(1 - \\frac{3G\\,\\Delta\\gamma}{\\sigma_{\\mathrm{eq}}^{\\mathrm{tr}}} \\right)$ 给出。我们计算这个标量因子：\n$$\n\\text{Factor} = 1 - \\frac{3(300)(0.05)}{150} = 1 - \\frac{900 \\times 0.05}{150} = 1 - \\frac{45}{150} = 1 - 0.3 = 0.7\n$$\n现在，将此因子应用于试探主偏应力：\n$$\ns_{1,n+1} = 0.7 \\times s_{1}^{\\mathrm{tr}} = 0.7 \\times 100 = 70~\\mathrm{MPa}\n$$\n$$\ns_{2,n+1} = 0.7 \\times s_{2}^{\\mathrm{tr}} = 0.7 \\times (-50) = -35~\\mathrm{MPa}\n$$\n$$\ns_{3,n+1} = 0.7 \\times s_{3}^{\\mathrm{tr}} = 0.7 \\times (-50) = -35~\\mathrm{MPa}\n$$\n这些结果是精确值，无需四舍五入。最终更新后的主偏应力为 $(70, -35, -35)~\\mathrm{MPa}$。", "answer": "$$\n\\boxed{\\begin{pmatrix} 70 & -35 & -35 \\end{pmatrix}}\n$$", "id": "3532232"}, {"introduction": "在掌握了光滑屈服面的积分方法后，我们将挑战在岩土力学中更为常见的Mohr-Coulomb模型。该模型屈服面的显著特征是存在“角点”，这使得返回映射算法变得更加复杂。本练习[@problem_id:3532160]将应力更新问题构建为一个最接近点投影的优化问题，并运用Kuhn-Tucker (KT)条件等最优化理论，来制定一个能够同时处理光滑屈服面和尖锐角点的稳健算法。", "problem": "考虑应力空间中具有凸屈服面的小应变弹塑性问题。返回映射算法通过强制最终应力位于屈服面上或其内部，并且在应力空间中欧几里得范数最小化的意义上最接近弹性试探应力，来求解更新后的应力。Mohr–Coulomb 屈服面是非光滑的，在其偏平面截面上存在角点，这使得最近点投影变得复杂。在 Haigh–Westergaard 坐标系中，固定平均应力 $p$ 下的 Mohr–Coulomb 屈服面的偏平面截面（即所谓的 $\\pi$ 平面）是一个正六边形。\n\n基本原理：在凸弹塑性理论中，容许应力集 $\\mathcal{K}$ 由一个屈服函数 $f(\\boldsymbol{\\sigma}) \\le 0$ 定义，边界上的屈服条件为 $f(\\boldsymbol{\\sigma}) = 0$。通过最近点投影的隐式应力积分求解一个变分问题，即在约束 $\\boldsymbol{\\sigma}^{\\star} \\in \\mathcal{K}$ 下，寻找应力 $\\boldsymbol{\\sigma}^{\\star}$ 以最小化其与弹性试探应力 $\\boldsymbol{\\sigma}^{\\mathrm{tr}}$ 之间的距离平方。Kuhn–Tucker 条件确保在最优点，只有激活的屈服约束通过拉格朗日乘子产生作用。对于像 Mohr–Coulomb 这样的非光滑曲面，在角点处可能有多个平面同时被激活。\n\n在本问题中，您将在偏应力 $\\pi$ 平面中工作，并将固定平均应力 $p$ 下的 Mohr–Coulomb 偏应力截面建模为凸集\n$$\n\\mathcal{H}_R = \\bigcap_{i=0}^{5} \\left\\{ \\mathbf{x} \\in \\mathbb{R}^2 \\;\\middle|\\; \\mathbf{n}_i^{\\top} \\mathbf{x} \\le R \\right\\},\n$$\n其中 $R>0$ 是内切圆半径（一个由材料参数，如指定平均应力下的摩擦角和内聚力，决定的给定常数），$\\{\\mathbf{n}_i\\}_{i=0}^{5}$ 是正六边形六个面的外向单位法向量，定义为\n$$\n\\mathbf{n}_0 = \\begin{bmatrix}1 \\\\ 0\\end{bmatrix},\\quad\n\\mathbf{n}_1 = \\begin{bmatrix}\\tfrac{1}{2} \\\\ \\tfrac{\\sqrt{3}}{2}\\end{bmatrix},\\quad\n\\mathbf{n}_2 = \\begin{bmatrix}-\\tfrac{1}{2} \\\\ \\tfrac{\\sqrt{3}}{2}\\end{bmatrix},\\quad\n\\mathbf{n}_3 = \\begin{bmatrix}-1 \\\\ 0\\end{bmatrix},\\quad\n\\mathbf{n}_4 = \\begin{bmatrix}-\\tfrac{1}{2} \\\\ -\\tfrac{\\sqrt{3}}{2}\\end{bmatrix},\\quad\n\\mathbf{n}_5 = \\begin{bmatrix}\\tfrac{1}{2} \\\\ -\\tfrac{\\sqrt{3}}{2}\\end{bmatrix}.\n$$\n给定试探偏应力点 $\\mathbf{t} \\in \\mathbb{R}^2$。隐式最近点投影旨在求解\n$$\n\\mathbf{x}^{\\star} = \\arg\\min_{\\mathbf{x} \\in \\mathcal{H}_R} \\frac{1}{2} \\left\\| \\mathbf{x} - \\mathbf{t} \\right\\|_2^2.\n$$\n角点的存在使得最优解 $\\mathbf{x}^{\\star}$ 可能位于单个面的内部（一个激活平面），也可能位于一个顶点（两个相邻激活平面的交点）。您的任务是从第一性原理出发，推导出一个激活平面检测策略，以确定最近点投影是落在面的内部还是顶点上，并计算出该投影点。\n\n要求：\n1. 推导最近点投影到 $\\mathcal{H}_R$ 上时，解位于单个面内部的条件，以及解位于由两个相邻面相交形成的顶点的条件。使用最近点投影的变分特性和 Kuhn–Tucker 条件作为您推导的基本原理。\n2. 实现一个程序，对于给定的 $R$ 和一组试探点 $\\mathbf{t}$，对每个试探点执行以下操作：\n   - 如果 $\\mathbf{t} \\in \\mathcal{H}_R$，则将该情况分类为弹性，并返回分类整数 $0$、空激活集和距离 $0$。\n   - 如果 $\\mathbf{t} \\notin \\mathcal{H}_R$，则计算 $\\mathbf{x}^{\\star}$ 并按如下方式检测激活集：\n     - 如果投影位于单个面的内部，则分类为塑性-面（plastic-face），返回分类整数 $1$ 和激活平面索引 $i$。\n     - 如果投影位于一个顶点，则分类为塑性-角点（plastic-corner），返回分类整数 $2$ 和两个相邻的激活平面索引 $\\{i,j\\}$，其中 $j \\in \\{(i-1) \\bmod 6, (i+1) \\bmod 6\\}$。\n   - 报告欧几里得距离 $\\left\\|\\mathbf{x}^{\\star} - \\mathbf{t}\\right\\|_2$，四舍五入到六位小数。\n3. 数值鲁棒性：在判断可行性和激活状态时，使用 $\\varepsilon = 10^{-9}$ 的容差处理相等性检查。\n4. 使用提供的法向量 $\\mathbf{n}_i$ 和给定的 $R$；假设 $R$ 已根据指定平均应力下的材料参数计算得出并提供给您。输出不需要物理单位。\n5. 测试套件：使用 $R=1$ 和 $\\pi$ 平面中的以下五个试探点：\n   - 用例 A（外部，面主导）：$\\mathbf{t}_A = (1.5, 0.0)$。\n   - 用例 B（外部，角点主导）：$\\mathbf{t}_B = (1.2, 0.8)$。\n   - 用例 C（内部）：$\\mathbf{t}_C = (0.2, 0.1)$。\n   - 用例 D（位于面内部）：$\\mathbf{t}_D = (1.0, 0.0)$。\n   - 用例 E（位于顶点）：$\\mathbf{t}_E = \\left(1.0, \\tfrac{1}{\\sqrt{3}}\\right)$。\n6. 最终输出格式：您的程序应生成单行输出，其中包含一个含五个条目的列表，每个条目对应一个测试用例，并保持 A、B、C、D、E 的顺序。每个条目必须是 $[\\text{class}, [\\text{active\\_indices}], \\text{distance}]$ 形式的列表，其中 $\\text{class}$ 是一个整数，$[\\text{active\\_indices}]$ 是一个整数列表，$\\text{distance}$ 是一个四舍五入到六位小数的浮点数。整个输出必须是包含在方括号中的单个逗号分隔列表。例如：$[[1,[0],0.123456],[2,[1,2],0.654321],\\ldots]$。\n\n您的程序必须是完整且可运行的，并且不得要求任何用户输入。", "solution": "该问题要求推导并实现一个最近点投影算法，用于将一个试探偏应力点投影到一个正六边形域上，该域模拟了 $\\pi$ 平面中的 Mohr–Coulomb 屈服面。推导必须基于塑性力学的变分原理和约束优化的 Karush–Kuhn–Tucker (KKT) 条件。\n\n优化问题是在凸集 $\\mathcal{H}_R$ 中找到点 $\\mathbf{x}^{\\star}$，以最小化其与给定试探点 $\\mathbf{t} \\in \\mathbb{R}^2$ 之间的欧几里得距离平方。可行集 $\\mathcal{H}_R$ 由六个线性不等式约束定义：\n$$\n\\mathcal{H}_R = \\left\\{ \\mathbf{x} \\in \\mathbb{R}^2 \\;\\middle|\\; g_i(\\mathbf{x}) = \\mathbf{n}_i^{\\top} \\mathbf{x} - R \\le 0, \\quad i = 0, \\dots, 5 \\right\\}\n$$\n因此，最小化问题表述为：\n$$\n\\text{minimize} \\quad L(\\mathbf{x}) = \\frac{1}{2} \\left\\| \\mathbf{x} - \\mathbf{t} \\right\\|_2^2 \\quad \\text{subject to} \\quad \\mathbf{x} \\in \\mathcal{H}_R\n$$\n该问题的拉格朗日函数为：\n$$\n\\mathcal{L}(\\mathbf{x}, \\boldsymbol{\\lambda}) = \\frac{1}{2} \\left( \\mathbf{x} - \\mathbf{t} \\right)^{\\top} \\left( \\mathbf{x} - \\mathbf{t} \\right) + \\sum_{i=0}^{5} \\lambda_i \\left( \\mathbf{n}_i^{\\top} \\mathbf{x} - R \\right)\n$$\n其中 $\\lambda_i$ 是拉格朗日乘子。在最优解 $(\\mathbf{x}^{\\star}, \\boldsymbol{\\lambda}^{\\star})$ 处，必须满足 KKT 条件：\n$1$. **平稳性 (Stationarity)**：拉格朗日函数关于 $\\mathbf{x}$ 的梯度为零：\n$$\n\\nabla_{\\mathbf{x}} \\mathcal{L}(\\mathbf{x}^{\\star}, \\boldsymbol{\\lambda}^{\\star}) = \\mathbf{x}^{\\star} - \\mathbf{t} + \\sum_{i=0}^{5} \\lambda_i^{\\star} \\mathbf{n}_i = \\mathbf{0} \\quad \\implies \\quad \\mathbf{t} - \\mathbf{x}^{\\star} = \\sum_{i=0}^{5} \\lambda_i^{\\star} \\mathbf{n}_i\n$$\n$2$. **原始可行性 (Primal Feasibility)**：解必须在可行集内：\n$$\n\\mathbf{n}_i^{\\top} \\mathbf{x}^{\\star} - R \\le 0 \\quad \\text{for all } i \\in \\{0, \\dots, 5\\}\n$$\n$3$. **对偶可行性 (Dual Feasibility)**：拉格朗日乘子必须为非负：\n$$\n\\lambda_i^{\\star} \\ge 0 \\quad \\text{for all } i \\in \\{0, \\dots, 5\\}\n$$\n$4$. **互补松弛性 (Complementary Slackness)**：对于每个约束，要么乘子为零，要么约束被激活：\n$$\n\\lambda_i^{\\star} \\left( \\mathbf{n}_i^{\\top} \\mathbf{x}^{\\star} - R \\right) = 0 \\quad \\text{for all } i \\in \\{0, \\dots, 5\\}\n$$\n平稳性条件表明，从投影点 $\\mathbf{x}^{\\star}$ 指向试探点 $\\mathbf{t}$ 的向量必须能表示为激活约束（其中 $\\mathbf{n}_i^{\\top} \\mathbf{x}^{\\star} - R = 0$）的外法向量的非负线性组合。\n\n我们根据试探点 $\\mathbf{t}$ 的位置分析可能的情况。\n\n**情况 0：弹性 (如果 $\\mathbf{t} \\in \\mathcal{H}_R$)**\n如果试探点 $\\mathbf{t}$ 已经位于可行集 $\\mathcal{H}_R$ 的内部或边界上，那么它就是其自身的最近点。$L(\\mathbf{x})$ 的最小值在 $\\mathbf{x}^{\\star} = \\mathbf{t}$ 处取得，值为 $0$。\n平稳性条件变为 $\\mathbf{t} - \\mathbf{t} = \\sum \\lambda_i^{\\star} \\mathbf{n}_i = \\mathbf{0}$，这意味着所有 $\\lambda_i^{\\star} = 0$。\n互补松弛性条件 $\\lambda_i^{\\star}(\\mathbf{n}_i^{\\top}\\mathbf{t} - R) = 0$ 因为 $\\lambda_i^\\star = 0$ 而满足。\n原始可行性要求对所有 $i$ 都有 $\\mathbf{n}_i^{\\top}\\mathbf{t} - R \\le 0$，这正是 $\\mathbf{t} \\in \\mathcal{H}_R$ 的定义。\n因此，如果对于所有 $i$ 都有 $\\mathbf{n}_i^{\\top}\\mathbf{t} - R \\le \\varepsilon$（使用给定的数值容差），则该情况为弹性，激活集为空，距离为 $0$。\n\n**情况 1：塑性返回至一个面 (一个激活约束)**\n假设试探点 $\\mathbf{t}$ 在 $\\mathcal{H}_R$ 外部，并且其投影 $\\mathbf{x}^{\\star}$ 位于单个面 $k$ 的内部。\n根据互补松弛性，只有 $\\lambda_k^{\\star}$ 可以非零，因此对于 $i \\ne k$，有 $\\lambda_i^{\\star}=0$。\n平稳性方程简化为 $\\mathbf{t} - \\mathbf{x}^{\\star} = \\lambda_k^{\\star} \\mathbf{n}_k$。\n面 $k$ 的约束被激活：$\\mathbf{n}_k^{\\top}\\mathbf{x}^{\\star} = R$。\n从平稳性条件求解 $\\mathbf{x}^{\\star}$ 得到 $\\mathbf{x}^{\\star} = \\mathbf{t} - \\lambda_k^{\\star} \\mathbf{n}_k$。将其代入激活约束中：\n$\\mathbf{n}_k^{\\top}(\\mathbf{t} - \\lambda_k^{\\star} \\mathbf{n}_k) = R \\implies \\mathbf{n}_k^{\\top}\\mathbf{t} - \\lambda_k^{\\star} \\|\\mathbf{n}_k\\|_2^2 = R$。\n由于 $\\mathbf{n}_k$ 是单位法向量，$\\|\\mathbf{n}_k\\|_2^2 = 1$，我们得到乘子：$\\lambda_k^{\\star} = \\mathbf{n}_k^{\\top}\\mathbf{t} - R$。\n对偶可行性要求 $\\lambda_k^{\\star} > 0$，这意味着 $\\mathbf{n}_k^{\\top}\\mathbf{t} > R$，这证实了 $\\mathbf{t}$ 位于由面 $k$ 定义的半空间之外。\n因此，投影点为 $\\mathbf{x}^{\\star} = \\mathbf{t} - (\\mathbf{n}_k^{\\top}\\mathbf{t} - R)\\mathbf{n}_k$。\n为了使该解有效，$\\mathbf{x}^\\star$ 必须不违反任何其他约束，即对于所有 $i \\ne k$ 都有 $\\mathbf{n}_i^{\\top}\\mathbf{x}^\\star - R \\le 0$。这意味着投影点落在六边形的面 $k$ 对应的线段内。\n\n**情况 2：塑性返回至一个角点 (两个激活约束)**\n如果投影点 $\\mathbf{x}^{\\star}$ 是一个顶点，则它是两个相邻面（比如 $j$ 和 $k=(j+1)\\pmod 6$）的交点。\n顶点 $\\mathbf{x}^{\\star}$ 的位置通过求解以下线性系统得到：\n$$\n\\begin{bmatrix} \\mathbf{n}_j^{\\top} \\\\ \\mathbf{n}_k^{\\top} \\end{bmatrix} \\mathbf{x}^{\\star} = \\begin{bmatrix} R \\\\ R \\end{bmatrix}\n$$\n根据互补松弛性，只有 $\\lambda_j^{\\star}$ 和 $\\lambda_k^{\\star}$ 可以非零。平稳性条件为 $\\mathbf{t} - \\mathbf{x}^{\\star} = \\lambda_j^{\\star} \\mathbf{n}_j + \\lambda_k^{\\star} \\mathbf{n}_k$。\n这是一个关于乘子的线性系统：\n$$\n\\begin{bmatrix} \\mathbf{n}_j  \\mathbf{n}_k \\end{bmatrix} \\begin{bmatrix} \\lambda_j^{\\star} \\\\ \\lambda_k^{\\star} \\end{bmatrix} = \\mathbf{t} - \\mathbf{x}^{\\star}\n$$\n如果满足对偶可行性条件 $\\lambda_j^{\\star} \\ge 0$ 和 $\\lambda_k^{\\star} \\ge 0$，则该解有效。这个条件在几何上意味着向量 $\\mathbf{t} - \\mathbf{x}^{\\star}$ 必须位于由法向量 $\\mathbf{n}_j$ 和 $\\mathbf{n}_k$ 张成的锥内。\n\n**激活平面检测策略**\n基于以上分析，以下算法可用于确定给定试探点 $\\mathbf{t}$ 的激活集并计算其投影 $\\mathbf{x}^{\\star}$：\n$1$. **弹性检查**：对每个面 $i=0, \\dots, 5$，计算有向距离 $d_i = \\mathbf{n}_i^{\\top}\\mathbf{t} - R$。如果 $\\max_i(d_i) \\le \\varepsilon$，则该点位于 $\\mathcal{H}_R$ 内部或边界上。此情况为弹性，$\\mathbf{x}^{\\star}=\\mathbf{t}$，激活集为空，距离为 $0$。\n$2$. **面返回假设**：如果点在外部，找到违反最严重的约束，即 $k = \\arg\\max_i(d_i)$。假设投影点位于面 $k$ 的内部。计算候选投影点 $\\mathbf{x}_{\\text{face}} = \\mathbf{t} - d_k \\mathbf{n}_k$。通过验证两个相邻面的约束是否满足来检查该点是否位于面线段上：$\\mathbf{n}_{(k-1)\\pmod 6}^{\\top} \\mathbf{x}_{\\text{face}} \\le R+\\varepsilon$ 和 $\\mathbf{n}_{(k+1)\\pmod 6}^{\\top} \\mathbf{x}_{\\text{face}} \\le R+\\varepsilon$。如果两个条件都成立，则假设正确。此情况为塑性-面返回，激活集为 $\\{k\\}$，且 $\\mathbf{x}^{\\star} = \\mathbf{x}_{\\text{face}}$。\n$3$. **角点返回情况**：如果面返回假设失败，则试探点必定位于其投影为顶点的区域。根据凸性，$\\mathcal{H}_R$ 中的最近点必然是违反最严重的面 $k$ 的两个顶点之一。设这些顶点为 $v_k$（面 $k-1$ 和 $k$ 的交点）和 $v_{k+1}$（面 $k$ 和 $k+1$ 的交点）。计算距离 $\\|\\mathbf{t}-v_k\\|_2$ 和 $\\|\\mathbf{t}-v_{k+1}\\|_2$。较近的顶点即为解 $\\mathbf{x}^{\\star}$。如果 $v_k$ 更近，激活平面为 $\\{(k-1)\\pmod 6, k\\}$。如果 $v_{k+1}$ 更近，激活平面为 $\\{k, (k+1)\\pmod 6\\}$。此为塑性-角点返回。\n\n该策略系统地、正确地为任意试探点 $\\mathbf{t} \\in \\mathbb{R}^2$ 识别激活集并计算最近点 $\\mathbf{x}^{\\star}$。", "answer": "```python\nimport numpy as np\n\ndef setup_geometry(R):\n    \"\"\"\n    Sets up the normals and vertices for the regular hexagon with inradius R.\n\n    Args:\n        R (float): The inradius of the hexagon.\n\n    Returns:\n        tuple: A tuple containing:\n            - np.ndarray: An array of the six outward unit normals.\n            - np.ndarray: An array of the six vertices of the hexagon. \n                          vertex[i] is the intersection of faces (i-1)%6 and i.\n    \"\"\"\n    s3_2 = np.sqrt(3) / 2.0\n    normals = np.array([\n        [1.0, 0.0],\n        [0.5, s3_2],\n        [-0.5, s3_2],\n        [-1.0, 0.0],\n        [-0.5, -s3_2],\n        [0.5, -s3_2]\n    ])\n    \n    vertices = np.zeros((6, 2))\n    for i in range(6):\n        im1 = (i - 1) % 6\n        # The vertex is the solution to a 2x2 linear system\n        # [n_{i-1}^T] * x = [R]\n        # [n_i^T    ]     [R]\n        A = np.array([normals[im1], normals[i]])\n        b = np.array([R, R])\n        vertices[i] = np.linalg.solve(A, b)\n        \n    return normals, vertices\n\ndef project_to_hexagon(t, R, normals, vertices, tolerance):\n    \"\"\"\n    Projects a trial point t onto the hexagon H_R.\n\n    Args:\n        t (np.ndarray): The 2D trial point.\n        R (float): The inradius of the hexagon.\n        normals (np.ndarray): The normals of the hexagon's faces.\n        vertices (np.ndarray): The vertices of the hexagon.\n        tolerance (float): Numerical tolerance for equality checks.\n\n    Returns:\n        list: A list containing [class, [active_indices], distance].\n    \"\"\"\n    # 1. Elastic Check: Check if the point is inside or on the boundary.\n    # Calculate violations d_i = n_i^T * t - R\n    violations = normals @ t - R\n    max_violation = np.max(violations)\n    \n    if max_violation = tolerance:\n        # Point is inside or on the boundary (elastic case).\n        # Per problem statement, active set is empty and distance is 0.\n        return [0, [], 0.0]\n\n    # 2. Plastic Check: The point is outside.\n    # Identify the most violated plane (largest positive violation).\n    k = np.argmax(violations)\n    \n    # 3. Face Return Hypothesis\n    # Project t onto the infinite line containing face k.\n    d_k = violations[k]\n    n_k = normals[k]\n    x_face_proj = t - d_k * n_k\n    \n    # Check if the projection lies on the face segment by testing against adjacent planes.\n    km1 = (k - 1) % 6\n    kp1 = (k + 1) % 6\n    \n    # Check if the point is feasible with respect to adjacent constraints.\n    if (normals[km1] @ x_face_proj - R = tolerance) and \\\n       (normals[kp1] @ x_face_proj - R = tolerance):\n        # Projection is on the face interior.\n        distance = np.linalg.norm(t - x_face_proj)\n        return [1, [k], round(distance, 6)]\n        \n    # 4. Corner Return\n    # If face return fails, the projection must be to a corner.\n    # The candidate vertices are the two vertices of face k.\n    v_k = vertices[k]       # Intersection of faces (k-1, k)\n    v_kp1 = vertices[kp1]   # Intersection of faces (k, k+1)\n    \n    dist_vk = np.linalg.norm(t - v_k)\n    dist_vkp1 = np.linalg.norm(t - v_kp1)\n    \n    if dist_vk  dist_vkp1:\n        # Projection is to vertex v_k. Active planes are (k-1) and k.\n        active_indices = sorted([km1, k])\n        distance = dist_vk\n        return [2, active_indices, round(distance, 6)]\n    else:\n        # Projection is to vertex v_{k+1}. Active planes are k and (k+1).\n        active_indices = sorted([k, kp1])\n        distance = dist_vkp1\n        return [2, active_indices, round(distance, 6)]\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    R = 1.0\n    TOLERANCE = 1e-9\n    \n    test_cases = [\n        np.array([1.5, 0.0]),                            # Case A\n        np.array([1.2, 0.8]),                            # Case B\n        np.array([0.2, 0.1]),                            # Case C\n        np.array([1.0, 0.0]),                            # Case D\n        np.array([1.0, 1.0/np.sqrt(3)])                  # Case E\n    ]\n    \n    normals, vertices = setup_geometry(R)\n    \n    results = []\n    for t_point in test_cases:\n        result = project_to_hexagon(t_point, R, normals, vertices, TOLERANCE)\n        results.append(result)\n        \n    # Format the results into the exact string format specified.\n    # Using str(list).replace(\" \", \"\") achieves the required no-space format,\n    # e.g., '[1,[0],0.5]' instead of '[1, [0], 0.5]'.\n    formatted_results = [str(res).replace(\" \", \"\") for res in results]\n    \n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3532160"}, {"introduction": "最后一个练习旨在将局部本构点上的应力积分与全局有限元分析联系起来，展示理论在实践中的威力。在这个高级实践中，您将为一个更符合实际的非关联（non-associative）土体模型推导其一致性算法切线（Consistent Algorithmic Tangent, CAT）。通过数值实验[@problem_id:3532237]，您将亲眼见证使用正确的CAT如何显著提升全局Newton-Raphson求解器的收敛速度，从而深刻理解其对于保证大型工程计算效率与稳健性的关键作用。", "problem": "考虑一个在平面应变条件下，使用后向欧拉法进行隐式应力积分的各向同性、小应变、率无关弹塑性土体模型。其弹性部分遵循 Hooke’s law，体积模量为 $K$，剪切模量为 $G$；塑性部分遵循一个在三轴压缩子午线上定义且带有圆化顶点的非关联 Mohr–Coulomb 模型。所有定义、步骤和推导都必须使用岩土力学中典型的物理一致符号约定，即应力和应变均以压为正。\n\n您需要推导适用于带有圆化顶点的非关联 Mohr–Coulomb 模型下隐式返回映射的一致算法切线 $\\partial \\boldsymbol{\\sigma}_{n+1}/\\partial \\boldsymbol{\\varepsilon}_{n+1}$，然后在一个简化为土柱单自由度竖向压缩的刚性基础问题中，测试其对全局牛顿-拉夫逊法（Newton–Raphson method (NR)）收敛性的影响。\n\n将使用的基本依据与模型要素：\n- 线性各向同性弹性：柯西应力张量 $\\boldsymbol{\\sigma}$ 通过 $\\boldsymbol{\\sigma} = \\mathbb{C} : \\boldsymbol{\\varepsilon}^{e}$ 与弹性应变张量 $\\boldsymbol{\\varepsilon}^{e}$ 相关，其中 $\\mathbb{C}$ 是由体积模量 $K$ 和剪切模量 $G$ 定义的四阶弹性刚度张量。\n- 平均应力 $p$ 为 $p = \\frac{1}{3} \\mathrm{tr}(\\boldsymbol{\\sigma})$，偏应力不变量 $q$ 为 $q = \\sqrt{3 J_{2}}$，其中 $J_{2} = \\frac{1}{2} \\boldsymbol{s}:\\boldsymbol{s}$ 且 $\\boldsymbol{s} = \\boldsymbol{\\sigma} - p \\boldsymbol{I}$。\n- 对于只有轴向应变分量非零的平面应变压缩，即 $\\varepsilon_{11} = \\varepsilon$ 且 $\\varepsilon_{22} = \\varepsilon_{33} = 0$，从零应力开始的单个后向欧拉步的弹性试探不变量为 $p^{\\mathrm{tr}} = K \\varepsilon$ 和 $q^{\\mathrm{tr}} = 2 G \\varepsilon$。\n- 三轴压缩子午线上的 Mohr–Coulomb 屈服函数为 $f(p,q) = q - M_{c} \\,\\Phi(p) - k_{c}$，其中 $M_{c} = \\frac{6 \\sin \\varphi}{3 - \\sin \\varphi}$ 和 $k_{c} = \\frac{6 c \\cos \\varphi}{3 - \\sin \\varphi}$，$\\varphi$ 为摩擦角，$c$ 为粘聚力。圆化顶点通过 $\\Phi(p) = \\sqrt{p^{2} + p_{0}^{2}}$ 引入，其中 $p_{0}  0$ 为一个小的圆化参数。\n- 非关联塑性势函数为 $g(p,q) = q - M_{g} p$，其中 $M_{g} = \\frac{6 \\sin \\psi}{3 - \\sin \\psi}$，$\\psi$ 为剪胀角。\n- 塑性流动法则：$\\Delta \\boldsymbol{\\varepsilon}^{p} = \\Delta \\lambda \\,\\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}}$，其中 $\\Delta \\lambda \\ge 0$ 是塑性乘子。在子午线表示下，塑性体积应变增量为 $\\Delta \\varepsilon_{v}^{p} = - M_{g} \\Delta \\lambda$，等效偏塑性应变增量为 $\\Delta \\gamma^{p} = \\Delta \\lambda$。\n\n任务 A (推导)：从上述基本依据出发，推导单个后向欧拉步的隐式返回映射，并得到第 $n+1$ 步塑性乘子的标量非线性方程：\n$$\nR_{\\lambda}(\\Delta \\lambda,\\varepsilon) \\equiv q^{\\mathrm{tr}}(\\varepsilon) - 3 G \\Delta \\lambda - M_{c} \\,\\Phi\\Big(p^{\\mathrm{tr}}(\\varepsilon) + K M_{g} \\Delta \\lambda\\Big) - k_{c} = 0,\n$$\n然后，推导在此隐式方案下最终应力更新 $\\boldsymbol{\\sigma}_{n+1}(\\varepsilon)$ 的一致算法切线 $E_{\\mathrm{cons}} = \\frac{\\partial \\sigma_{11}}{\\partial \\varepsilon}$。使用适用于轴对称子午线状态的主应力重构：\n$$\n\\sigma_{1} = p + \\frac{2}{3} q,\\quad \\sigma_{2} = \\sigma_{3} = p - \\frac{1}{3} q,\n$$\n以及隐函数定理。圆化顶点函数的导数为 $\\Phi'(p) = \\frac{p}{\\sqrt{p^{2} + p_{0}^{2}}}$。请用 $K$、$G$、$M_{c}$、$M_{g}$、$p^{\\mathrm{tr}}$、$q^{\\mathrm{tr}}$、$p_{0}$ 和收敛后的 $\\Delta \\lambda$ 以闭合形式表示 $E_{\\mathrm{cons}}$。\n\n任务 B (算法实验)：实现一个程序，对于一个高度为 $H$ 的土柱，在给定竖向荷载 $P$ 作用下被面积为 $A$ 的刚性基础压缩，使用全局牛顿-拉夫逊法求解未知基础位移 $w$ 的标量平衡方程：\n$$\nR(w) = P - A \\,\\sigma_{11}\\Big(\\varepsilon=\\frac{w}{H}\\Big) = 0,\n$$\n比较两种全局方案：\n- 方案 1：在全局牛顿更新中使用一致算法切线 $E_{\\mathrm{cons}}$，即 $\\mathrm{d}R/\\mathrm{d}w = - A \\, E_{\\mathrm{cons}}/H$。\n- 方案 2：无论是否发生塑性，都使用名义弹性切线 $E_{\\mathrm{el}} = K + \\frac{4}{3} G$，即 $\\mathrm{d}R/\\mathrm{d}w = - A \\, E_{\\mathrm{el}}/H$。\n\n对于下方测试套件中的每个荷载工况，报告达到 $|R(w)|  \\tau$（容差 $\\tau = 10^{-3}\\,\\mathrm{N}$）所需的全局牛顿迭代次数。迭代从弹性预测值 $w_{0} = \\frac{P H}{A E_{\\mathrm{el}}}$ 开始，最大迭代次数限制为 $N_{\\max} = 50$，并在 $|R|$ 增大时应用 $1/2$ 的简单回溯因子。\n\n使用以下科学上合理的参数和单位：\n- 弹性模量 $E = 100 \\times 10^{6}\\,\\mathrm{Pa}$ 和泊松比 $\\nu = 0.3$，由此可得 $K = \\frac{E}{3(1 - 2 \\nu)}$ 和 $G = \\frac{E}{2(1 + \\nu)}$。\n- 摩擦角 $\\varphi = 20\\,\\mathrm{degrees}$，剪胀角 $\\psi = 5\\,\\mathrm{degrees}$。\n- 粘聚力 $c = 25 \\times 10^{3}\\,\\mathrm{Pa}$。\n- 顶点圆化参数 $p_{0} = 1 \\times 10^{3}\\,\\mathrm{Pa}$。\n- 基础面积 $A = 1\\,\\mathrm{m}^{2}$，土柱高度 $H = 1\\,\\mathrm{m}$。\n- 角度单位：对 $\\varphi$ 和 $\\psi$ 使用度，并在内部转换为弧度。\n- 荷载 (以力 $\\mathrm{N}$ 表示)：$P_{1} = 5 \\times 10^{3}$，$P_{2} = 200 \\times 10^{3}$，$P_{3} = 600 \\times 10^{3}$，$P_{4} = 1{,}200 \\times 10^{3}$。\n\n测试套件与最终输出规范：\n- 对每个 $P_{i}$，分别计算方案 1 和方案 2 的迭代次数 $(n_{i}^{\\mathrm{cons}}, n_{i}^{\\mathrm{nom}})$。\n- 您的程序应生成单行输出，其中包含一个由八个整数组成的逗号分隔列表，顺序为 $[n_{1}^{\\mathrm{cons}}, n_{1}^{\\mathrm{nom}}, n_{2}^{\\mathrm{cons}}, n_{2}^{\\mathrm{nom}}, n_{3}^{\\mathrm{cons}}, n_{3}^{\\mathrm{nom}}, n_{4}^{\\mathrm{cons}}, n_{4}^{\\mathrm{nom}}]$。\n- 所有答案均为纯整数 (输出中不含单位)。在内部，始终使用国际单位制 (SI 单位)，并进行指定的角度单位转换。\n\n请遵循隐式积分框架以确保科学真实性，并避免使用未从指定基础推导出的捷径公式。请提供完整的推导，然后相应地实现算法。", "solution": "用户提供了一个计算岩土力学领域中定义明确的问题。该问题具有科学依据，内部逻辑一致，并包含了完整推导和算法实现所需的所有信息。我将着手解决该问题，该解决方案按要求分为两部分：理论推导（任务A）和算法实验与实现（任务B）。\n\n### 任务 A：返回映射与一致切线的推导\n\n本任务要求在隐式后向欧拉积分方案下，针对一个非关联、带圆化顶点的 Mohr–Coulomb 模型，推导其应力更新法则和一致算法切线。分析将专门针对平面应变压缩情况，其中总应变张量由单个标量 $\\varepsilon = \\varepsilon_{11}$ 决定。\n\n**1. 准备工作与本构更新**\n\n我们从应变率加法分解为弹性和塑性部分开始，对于一个时间步长为 $\\Delta t$ 的后向欧拉格式，其离散形式为：\n$$\n\\Delta \\boldsymbol{\\varepsilon} = \\Delta \\boldsymbol{\\varepsilon}^{e} + \\Delta \\boldsymbol{\\varepsilon}^{p}\n$$\n弹性应力-应变关系由 Hooke's law 给出，$\\boldsymbol{\\sigma} = \\mathbb{C} : \\boldsymbol{\\varepsilon}^{e}$。因此，步末的应力 $\\boldsymbol{\\sigma}_{n+1}$ 为：\n$$\n\\boldsymbol{\\sigma}_{n+1} = \\mathbb{C} : \\boldsymbol{\\varepsilon}^{e}_{n+1} = \\mathbb{C} : (\\boldsymbol{\\varepsilon}_{n+1} - \\boldsymbol{\\varepsilon}^{p}_{n+1})\n$$\n假设增量步开始时的塑性应变 $\\boldsymbol{\\varepsilon}^{p}_{n}$ 已知（此处为零），则有 $\\boldsymbol{\\varepsilon}^{p}_{n+1} = \\Delta\\boldsymbol{\\varepsilon}^p$。这引出了弹性试探应力的定义：\n$$\n\\boldsymbol{\\sigma}^{\\mathrm{tr}} = \\mathbb{C} : \\boldsymbol{\\varepsilon}_{n+1}\n$$\n应力更新则表示为：\n$$\n\\boldsymbol{\\sigma}_{n+1} = \\boldsymbol{\\sigma}^{\\mathrm{tr}} - \\mathbb{C} : \\Delta\\boldsymbol{\\varepsilon}^{p}\n$$\n塑性应变增量由非关联流动法则给出，并在步末进行计算（隐式格式）：\n$$\n\\Delta \\boldsymbol{\\varepsilon}^{p} = \\Delta \\lambda \\left. \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}} \\right|_{\\boldsymbol{\\sigma}_{n+1}}\n$$\n其中 $\\Delta \\lambda \\ge 0$ 是塑性乘子，$g(p, q) = q - M_g p$ 是塑性势函数。\n\n**2. 分解为体积与偏量部分**\n\n使用弹性张量 $\\mathbb{C}$ 按体积模量 $K$ 和剪切模量 $G$ 的标准分解，应力更新可以分解为体积部分（平均应力 $p$）和偏量部分（偏应力张量 $\\boldsymbol{s}$）：\n$$\np_{n+1} = p^{\\mathrm{tr}} - K \\Delta \\varepsilon_{v}^{p}\n$$\n$$\n\\boldsymbol{s}_{n+1} = \\boldsymbol{s}^{\\mathrm{tr}} - 2G \\Delta \\boldsymbol{\\varepsilon}_{\\mathrm{dev}}^{p}\n$$\n其中 $\\Delta \\varepsilon_{v}^{p} = \\mathrm{tr}(\\Delta \\boldsymbol{\\varepsilon}^{p})$ 且 $\\Delta \\boldsymbol{\\varepsilon}_{\\mathrm{dev}}^{p} = \\mathrm{dev}(\\Delta \\boldsymbol{\\varepsilon}^{p})$。根据问题陈述（及标准推导），流动法则意味着 $\\Delta \\varepsilon_{v}^{p} = -\\Delta \\lambda M_g$，且等效塑性偏应变增量为 $\\Delta \\gamma^p = \\Delta \\lambda$。使用等效应变的偏应力更新为 $q_{n+1} = q^\\mathrm{tr} - 3G\\Delta\\gamma^p$。将这些代入更新方程，得到以应力不变量表示的返回映射：\n$$\np_{n+1} = p^{\\mathrm{tr}} - K(-\\Delta\\lambda M_g) = p^{\\mathrm{tr}} + K M_g \\Delta\\lambda\n$$\n$$\nq_{n+1} = q^{\\mathrm{tr}} - 3G \\Delta\\gamma^p = q^{\\mathrm{tr}} - 3G \\Delta\\lambda\n$$\n\n**3. 塑性乘子的标量方程**\n\n如果发生塑性加载，最终应力状态 $(\\boldsymbol{\\sigma}_{n+1})$ 必须位于屈服面上。这就是塑性一致性条件，$f(p_{n+1}, q_{n+1}) = 0$。屈服函数为 $f(p, q) = q - M_c \\Phi(p) - k_c$。代入 $p_{n+1}$ 和 $q_{n+1}$ 的表达式，可得到关于未知塑性乘子 $\\Delta\\lambda$ 的单个标量非线性方程：\n$$\n(q^{\\mathrm{tr}} - 3G \\Delta\\lambda) - M_c \\Phi(p^{\\mathrm{tr}} + K M_g \\Delta\\lambda) - k_c = 0\n$$\n根据问题陈述，我们定义关于 $\\Delta\\lambda$ 的残差函数，它通过试探状态 ($p^{\\mathrm{tr}}=K\\varepsilon$, $q^{\\mathrm{tr}}=2G\\varepsilon$) 隐式地依赖于总应变 $\\varepsilon$：\n$$\nR_{\\lambda}(\\Delta\\lambda, \\varepsilon) \\equiv q^{\\mathrm{tr}}(\\varepsilon) - 3G \\Delta\\lambda - M_c \\Phi\\Big(p^{\\mathrm{tr}}(\\varepsilon) + K M_g \\Delta\\lambda\\Big) - k_c = 0\n$$\n如果试探状态在屈服面之外，即 $f(p^{\\mathrm{tr}}, q^{\\mathrm{tr}})  0$，则求解此方程以获得 $\\Delta\\lambda \\ge 0$。如果 $f(p^{\\mathrm{tr}}, q^{\\mathrm{tr}}) \\le 0$，则该步为弹性步，且 $\\Delta\\lambda = 0$。\n\n**4. 一致算法切线的推导**\n\n对于这个一维问题，一致算法切线模量 $E_{\\mathrm{cons}}$ 定义为最终轴向应力 $\\sigma_{11}$ 相对于轴向应变 $\\varepsilon$ 的导数：\n$$\nE_{\\mathrm{cons}} = \\frac{d\\sigma_{11, n+1}}{d\\varepsilon}\n$$\n我们使用指定轴对称加载路径的主应力重构：$\\sigma_{11} = p_{n+1} + \\frac{2}{3}q_{n+1}$。对 $\\varepsilon$ 求导：\n$$\nE_{\\mathrm{cons}} = \\frac{d p_{n+1}}{d\\varepsilon} + \\frac{2}{3}\\frac{d q_{n+1}}{d\\varepsilon}\n$$\n最终应力不变量 $p_{n+1}$ 和 $q_{n+1}$ 的导数通过对其各自的返回映射方程求导得到：\n$$\n\\frac{d p_{n+1}}{d\\varepsilon} = \\frac{d p^{\\mathrm{tr}}}{d\\varepsilon} + K M_g \\frac{d(\\Delta\\lambda)}{d\\varepsilon}\n$$\n$$\n\\frac{d q_{n+1}}{d\\varepsilon} = \\frac{d q^{\\mathrm{tr}}}{d\\varepsilon} - 3G \\frac{d(\\Delta\\lambda)}{d\\varepsilon}\n$$\n由于 $p^{\\mathrm{tr}} = K\\varepsilon$ 且 $q^{\\mathrm{tr}} = 2G\\varepsilon$，我们有 $\\frac{d p^{\\mathrm{tr}}}{d\\varepsilon} = K$ 和 $\\frac{d q^{\\mathrm{tr}}}{d\\varepsilon} = 2G$。关键项是 $\\frac{d(\\Delta\\lambda)}{d\\varepsilon}$，它通过对一致性方程 $R_{\\lambda}(\\Delta\\lambda(\\varepsilon), \\varepsilon) = 0$ 应用隐函数定理得到。其全导数必须为零：\n$$\n\\frac{d R_{\\lambda}}{d\\varepsilon} = \\frac{\\partial R_{\\lambda}}{\\partial \\varepsilon} + \\frac{\\partial R_{\\lambda}}{\\partial (\\Delta\\lambda)} \\frac{d(\\Delta\\lambda)}{d\\varepsilon} = 0\n$$\n这给出：\n$$\n\\frac{d(\\Delta\\lambda)}{d\\varepsilon} = - \\left( \\frac{\\partial R_{\\lambda}}{\\partial (\\Delta\\lambda)} \\right)^{-1} \\frac{\\partial R_{\\lambda}}{\\partial \\varepsilon}\n$$\n我们计算 $R_{\\lambda}$ 的偏导数。令 $p_{f} = p^{\\mathrm{tr}} + K M_g \\Delta\\lambda$。\n$$\n\\frac{\\partial R_{\\lambda}}{\\partial (\\Delta\\lambda)} = -3G - M_c \\Phi'(p_f) \\frac{\\partial p_f}{\\partial (\\Delta\\lambda)} = -3G - M_c \\Phi'(p_f) (K M_g)\n$$\n$$\n\\frac{\\partial R_{\\lambda}}{\\partial \\varepsilon} = \\frac{\\partial q^{\\mathrm{tr}}}{\\partial \\varepsilon} - M_c \\Phi'(p_f) \\frac{\\partial p_f}{\\partial \\varepsilon} = 2G - M_c \\Phi'(p_f) \\frac{\\partial p^{\\mathrm{tr}}}{\\partial \\varepsilon} = 2G - M_c \\Phi'(p_f) K\n$$\n其中 $\\Phi'(p_f) = \\frac{p_f}{\\sqrt{p_f^2 + p_0^2}}$。\n我们定义一个标量模量 $H_{\\lambda} = -\\frac{\\partial R_{\\lambda}}{\\partial (\\Delta\\lambda)} = 3G + K M_c M_g \\Phi'(p_f)$。那么：\n$$\n\\frac{d(\\Delta\\lambda)}{d\\varepsilon} = \\frac{2G - K M_c \\Phi'(p_f)}{3G + K M_c M_g \\Phi'(p_f)} = \\frac{2G - K M_c \\Phi'(p_f)}{H_{\\lambda}}\n$$\n将此结果代回到 $\\frac{dp_{n+1}}{d\\varepsilon}$ 和 $\\frac{dq_{n+1}}{d\\varepsilon}$ 的表达式中：\n$$\n\\frac{d p_{n+1}}{d\\varepsilon} = K + K M_g \\frac{d(\\Delta\\lambda)}{d\\varepsilon}\n$$\n$$\n\\frac{d q_{n+1}}{d\\varepsilon} = 2G - 3G \\frac{d(\\Delta\\lambda)}{d\\varepsilon}\n$$\n最后，我们组合出 $E_{\\mathrm{cons}}$ 的表达式：\n$$\nE_{\\mathrm{cons}} = \\left(K + K M_g \\frac{d(\\Delta\\lambda)}{d\\varepsilon}\\right) + \\frac{2}{3}\\left(2G - 3G \\frac{d(\\Delta\\lambda)}{d\\varepsilon}\\right)\n$$\n$$\nE_{\\mathrm{cons}} = K + \\frac{4}{3}G + K M_g \\frac{d(\\Delta\\lambda)}{d\\varepsilon} - 2G \\frac{d(\\Delta\\lambda)}{d\\varepsilon} = \\left(K + \\frac{4}{3}G\\right) + (K M_g - 2G) \\frac{d(\\Delta\\lambda)}{d\\varepsilon}\n$$\n第一项是单轴弹性模量 $E_{\\mathrm{el}}$。代入 $\\frac{d(\\Delta\\lambda)}{d\\varepsilon}$ 的完整表达式，得到塑性情况下一致算法切线的最终形式：\n$$\nE_{\\mathrm{cons}} = \\left(K + \\frac{4}{3}G\\right) + (K M_g - 2G) \\frac{2G - K M_c \\Phi'(p_{f})}{3G + K M_c M_g \\Phi'(p_{f})}\n$$\n该表达式使用当前应变水平 $\\varepsilon$ 下返回映射过程得到的收敛值 $\\Delta\\lambda$ 和 $p_f = p_{n+1}$ 进行计算。对于弹性步（$\\Delta\\lambda=0$），不使用此推导，切线即为 $E_{\\mathrm{cons}} = E_{\\mathrm{el}} = K + \\frac{4}{3}G$。\n\n至此，任务 A 的推导完成。任务 B 将在牛顿-拉夫逊框架中实现此结果。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to perform the algorithmic experiment as per the problem statement.\n    \"\"\"\n\n    # --- 1. Define model parameters and constants ---\n    E = 100e6  # Pa\n    nu = 0.3\n    phi_deg = 20.0  # degrees\n    psi_deg = 5.0  # degrees\n    c = 25e3  # Pa\n    p0 = 1e3  # Pa\n    A = 1.0  # m^2\n    H = 1.0  # m\n    res_tol = 1e-3  # N\n    max_iter = 50\n    loads = [5e3, 200e3, 600e3, 1200e3]  # N\n\n    # --- 2. Calculate derived material parameters ---\n    K = E / (3 * (1 - 2 * nu))\n    G = E / (2 * (1 + nu))\n    E_el = K + 4/3 * G\n\n    phi_rad = np.deg2rad(phi_deg)\n    psi_rad = np.deg2rad(psi_deg)\n\n    sin_phi = np.sin(phi_rad)\n    cos_phi = np.cos(phi_rad)\n    sin_psi = np.sin(psi_rad)\n\n    Mc = (6 * sin_phi) / (3 - sin_phi)\n    kc = (6 * c * cos_phi) / (3 - sin_phi)\n    Mg = (6 * sin_psi) / (3 - sin_psi)\n    \n    params = {\n        'K': K, 'G': G, 'Mc': Mc, 'kc': kc, 'Mg': Mg, 'p0': p0, 'E_el': E_el\n    }\n\n    # --- 3. Core stress integration function ---\n    def get_stress_and_tangent(strain, scheme, params):\n        \"\"\"\n        Performs stress integration for a given strain and returns the axial stress\n        and the appropriate tangent modulus for the global NR scheme.\n        \"\"\"\n        K, G, Mc, kc, Mg, p0, E_el = params.values()\n\n        # Trial state\n        p_tr = K * strain\n        q_tr = 2 * G * strain\n\n        # Yield check\n        f_tr = q_tr - Mc * np.sqrt(p_tr**2 + p0**2) - kc\n\n        if f_tr = 1e-9:  # Elastic step (with a small tolerance)\n            sigma_11 = E_el * strain\n            tangent = E_el\n            return sigma_11, tangent\n\n        else:  # Plastic step: perform return mapping\n            delta_lambda = 0.0  # Initial guess for plastic multiplier\n            \n            # Local Newton-Raphson to find delta_lambda\n            for _ in range(20):\n                p_final_guess = p_tr + K * Mg * delta_lambda\n                \n                phi_p = np.sqrt(p_final_guess**2 + p0**2)\n                \n                # Residual for delta_lambda\n                R_lambda = (q_tr - 3 * G * delta_lambda) - Mc * phi_p - kc\n                \n                if abs(R_lambda)  1e-9:\n                    break\n                \n                # Derivative of residual w.r.t. delta_lambda\n                phi_prime_p = p_final_guess / phi_p\n                R_prime_lambda = -3 * G - Mc * phi_prime_p * (K * Mg)\n                \n                delta_lambda -= R_lambda / R_prime_lambda\n            \n            # Update stress invariants with converged delta_lambda\n            p_final = p_tr + K * Mg * delta_lambda\n            q_final = q_tr - 3 * G * delta_lambda\n            sigma_11 = p_final + 2/3 * q_final\n\n            # Calculate tangent modulus\n            if scheme == 'nominal':\n                tangent = E_el\n            else:  # scheme == 'consistent'\n                phi_p_final = np.sqrt(p_final**2 + p0**2)\n                phi_prime_final = p_final / phi_p_final\n                \n                num = 2*G - K*Mc*phi_prime_final\n                den = 3*G + K*Mc*Mg*phi_prime_final\n                \n                d_lambda_d_eps = num / den\n                \n                tangent = E_el + (K * Mg - 2*G) * d_lambda_d_eps\n            \n            return sigma_11, tangent\n\n    # --- 4. Main loop for algorithmic experiment ---\n    results = []\n    \n    for P in loads:\n        for scheme in ['consistent', 'nominal']:\n            # Initial guess for displacement\n            w = (P * H) / (A * E_el)\n            \n            n_iter = 0\n            while n_iter  max_iter:\n                strain = w / H\n                sigma_11, E_t = get_stress_and_tangent(strain, scheme, params)\n\n                # Global residual\n                R = P - A * sigma_11\n                if abs(R)  res_tol:\n                    break\n\n                n_iter += 1 # An iteration is one update step\n                \n                # Global tangent stiffness and displacement update\n                K_glob = -A * E_t / H\n                delta_w = -R / K_glob\n                \n                # Simple backtracking line search\n                alpha = 1.0\n                w_prev = w\n                R_prev_abs = abs(R)\n\n                while True:\n                    w = w_prev + alpha * delta_w\n                    strain_new = w / H\n                    \n                    # We only need stress for residual check, not the tangent\n                    sigma_11_new, _ = get_stress_and_tangent(strain_new, scheme, params)\n                    R_new = P - A * sigma_11_new\n\n                    if abs(R_new)  R_prev_abs:\n                        break # Step accepted\n                    \n                    alpha /= 2.0\n                    \n                    if alpha  1e-5: # Safeguard against tiny steps\n                        # If backtracking fails, accept the step and hope for the best\n                        # This may happen if the tangent is very inaccurate.\n                        break\n            \n            results.append(n_iter)\n            \n    # --- 5. Print final results ---\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3532237"}]}