{"hands_on_practices": [{"introduction": "在实现任何数值方案之前，理解其理论属性至关重要。本练习将引导您推导两种基本方案——显式中心差分法和隐式纽马克平均加速度法——的局部截断误差。通过这种分析，可以揭示它们的精度阶数，这是评估其性能的一个关键指标 ([@problem_id:3566460])。", "problem": "考虑一个无阻尼单自由度线性振子，例如，它可以模拟计算岩土力学中集总土体质量-弹簧理想化模型的基本模态。根据牛顿第二定律推导出的控制方程为\n$$\nm\\,\\ddot{u}(t) + k\\,u(t) = 0,\\quad m0,\\ k0,\n$$\n其中 $u(t)$ 是广义位移。定义圆自振频率为 $\\omega^{2} = k/m$，并将方程写成归一化形式\n$$\n\\ddot{u}(t) + \\omega^{2}\\,u(t) = 0.\n$$\n设 $t_{n} = t_{0} + n\\,\\Delta t$，其中时间步长 $\\Delta t0$ 为常数，并记 $u_{n} = u(t_{n})$，$v_{n} = \\dot{u}(t_{n})$，$a_{n} = \\ddot{u}(t_{n})$。\n\n任务 A（中心差分（CD）法，显式）。针对该振子的中心差分法可写作\n$$\n\\frac{u_{n+1} - 2\\,u_{n} + u_{n-1}}{\\Delta t^{2}} + \\omega^{2}\\,u_{n} = 0.\n$$\n将在 $t_{n}$ 处的局部截断误差定义为差项\n$$\n\\tau^{\\mathrm{CD}}_{n} := \\frac{u(t_{n+1}) - 2\\,u(t_{n}) + u(t_{n-1})}{\\Delta t^{2}} + \\omega^{2}\\,u(t_{n}),\n$$\n该差项是通过将精确解 $u(t)$ 代入数值格式得到的。仅使用关于 $t_{n}$ 的基本泰勒展开和控制微分方程，推导 $\\tau^{\\mathrm{CD}}_{n}$ 中以 $\\Delta t$ 幂次表示的首个非零项。\n\n任务 B（Newmark 平均加速度（AA）格式，隐式）。Newmark 平均加速度格式由一对更新公式定义，其平均加速度参数为 $\\beta = 1/4$ 和 $\\gamma = 1/2$：\n$$\nu_{n+1} = u_{n} + \\Delta t\\,v_{n} + \\frac{\\Delta t^{2}}{4}\\,\\big(a_{n} + a_{n+1}\\big),\\qquad\nv_{n+1} = v_{n} + \\frac{\\Delta t}{2}\\,\\big(a_{n} + a_{n+1}\\big),\n$$\n再加上线性振子关系 $a_{n} = -\\omega^{2}\\,u_{n}$ 和 $a_{n+1} = -\\omega^{2}\\,u_{n+1}$。将在 $t_{n}$ 处的局部截断误差定义为将精确解的值代入这些更新公式所得到的两个差项：\n$$\n\\tau^{\\mathrm{N}}_{u,n} := u(t_{n+1}) - u(t_{n}) - \\Delta t\\,v(t_{n}) - \\frac{\\Delta t^{2}}{4}\\,\\big(a(t_{n}) + a(t_{n+1})\\big),\n$$\n$$\n\\tau^{\\mathrm{N}}_{v,n} := v(t_{n+1}) - v(t_{n}) - \\frac{\\Delta t}{2}\\,\\big(a(t_{n}) + a(t_{n+1})\\big).\n$$\n仅使用关于 $t_{n}$ 的基本泰勒展开和控制微分方程，推导 $\\tau^{\\mathrm{N}}_{u,n}$ 和 $\\tau^{\\mathrm{N}}_{v,n}$ 中以 $\\Delta t$ 幂次表示的首个非零项。\n\n任务 C（全局精度阶）。利用局部截断误差所揭示的相容性阶，以及两种格式对线性振子已知的零点稳定性，得出中心差分法和 Newmark 平均加速度格式对 $u(t)$ 的全局精度阶。将最终答案表示为一个行矩阵，其中包含位移的两个全局精度阶，顺序为 [中心差分法, Newmark 平均加速度法]。最终答案不需要单位。如果在推导过程中需要陈述任何数值常数，请保持其精确有理数形式。最终答案必须是一个包含两个整数的单行矩阵。", "solution": "在尝试任何解答之前，需对问题进行验证。\n\n### 第 1 步：提取已知条件\n-   **控制方程**: $m\\,\\ddot{u}(t) + k\\,u(t) = 0$，其中质量 $m0$，刚度 $k0$。\n-   **归一化形式**: $\\ddot{u}(t) + \\omega^{2}\\,u(t) = 0$，其中圆自振频率为 $\\omega = \\sqrt{k/m}$。\n-   **时间离散化**: $t_{n} = t_{0} + n\\,\\Delta t$，具有恒定时间步长 $\\Delta t0$。\n-   **离散变量**: $u_{n} = u(t_{n})$，$v_{n} = \\dot{u}(t_{n})$，$a_{n} = \\ddot{u}(t_{n})$。\n-   **任务 A：中心差分（CD）法**：\n    -   格式：$\\frac{u_{n+1} - 2\\,u_{n} + u_{n-1}}{\\Delta t^{2}} + \\omega^{2}\\,u_{n} = 0$。\n    -   局部截断误差（LTE）：$\\tau^{\\mathrm{CD}}_{n} := \\frac{u(t_{n+1}) - 2\\,u(t_{n}) + u(t_{n-1})}{\\Delta t^{2}} + \\omega^{2}\\,u(t_{n})$。\n    -   目标：推导 $\\tau^{\\mathrm{CD}}_{n}$ 的首个非零项。\n-   **任务 B：Newmark 平均加速度（AA）格式**：\n    -   参数：$\\beta = 1/4$，$\\gamma = 1/2$。\n    -   更新公式：\n        $u_{n+1} = u_{n} + \\Delta t\\,v_{n} + \\frac{\\Delta t^{2}}{4}\\,\\big(a_{n} + a_{n+1}\\big)$\n        $v_{n+1} = v_{n} + \\frac{\\Delta t}{2}\\,\\big(a_{n} + a_{n+1}\\big)$\n    -   控制方程的强制执行：$a_{n} = -\\omega^{2}\\,u_{n}$ 和 $a_{n+1} = -\\omega^{2}\\,u_{n+1}$。\n    -   局部截断误差（LTEs）：\n        $\\tau^{\\mathrm{N}}_{u,n} := u(t_{n+1}) - u(t_{n}) - \\Delta t\\,v(t_{n}) - \\frac{\\Delta t^{2}}{4}\\,\\big(a(t_{n}) + a(t_{n+1})\\big)$\n        $\\tau^{\\mathrm{N}}_{v,n} := v(t_{n+1}) - v(t_{n}) - \\frac{\\Delta t}{2}\\,\\big(a(t_{n}) + a(t_{n+1})\\big)$\n    -   目标：推导 $\\tau^{\\mathrm{N}}_{u,n}$ 和 $\\tau^{\\mathrm{N}}_{v,n}$ 的首个非零项。\n-   **任务 C：全局精度阶**：\n    -   前提：已知两种格式都是零点稳定的。\n    -   目标：利用任务 A 和 B 的相容性阶，确定中心差分法和 Newmark 平均加速度格式对位移 $u(t)$ 的全局精度阶。\n\n### 第 2 步：使用提取的已知条件进行验证\n问题定义明确且科学上合理。\n-   **科学依据**：该问题涉及对线性振子（物理学和工程学中的一个基本模型）的标准、广泛使用的时间积分格式（中心差分法和 Newmark 法）的分析。这些方法和概念是计算动力学的基石。\n-   **适定性**：任务是具体和数学化的，要求基于泰勒级数展开和对标准数值分析理论的解释进行推导。问题有唯一且有意义的解。\n-   **客观性**：问题以精确的数学语言陈述，没有歧义或主观内容。\n-   **完整性和一致性**：提供了所有必要的方程、定义和条件。没有内部矛盾。\n\n### 第 3 步：结论与行动\n问题有效。将提供完整解答。\n\n### 解答推导\n\n解答需要通过将控制微分方程 $\\ddot{u}(t) + \\omega^2 u(t) = 0$ 的精确解 $u(t)$ 代入数值格式来计算局部截断误差（LTEs）。精确解的各阶导数之间存在如下关系：$\\ddot{u}(t) = -\\omega^2 u(t)$，$\\dddot{u}(t) = -\\omega^2 \\dot{u}(t)$，$u^{(4)}(t) = -\\omega^2 \\ddot{u}(t) = \\omega^4 u(t)$，依此类推。\n\n**任务 A：中心差分（CD）法的局部截断误差**\n\n中心差分法的 LTE 由下式给出：\n$$\n\\tau^{\\mathrm{CD}}_{n} = \\frac{u(t_{n+1}) - 2\\,u(t_{n}) + u(t_{n-1})}{\\Delta t^{2}} + \\omega^{2}\\,u(t_{n})\n$$\n我们对 $u(t_{n+1})$ 和 $u(t_{n-1})$ 在时间 $t_{n}$ 处进行泰勒级数展开。为简洁起见，记 $u_{n} = u(t_{n})$，$\\dot{u}_{n} = \\dot{u}(t_{n})$ 等。\n$$\nu(t_{n+1}) = u_{n} + \\Delta t\\,\\dot{u}_{n} + \\frac{\\Delta t^2}{2!}\\,\\ddot{u}_{n} + \\frac{\\Delta t^3}{3!}\\,\\dddot{u}_{n} + \\frac{\\Delta t^4}{4!}\\,u^{(4)}_{n} + O(\\Delta t^5)\n$$\n$$\nu(t_{n-1}) = u_{n} - \\Delta t\\,\\dot{u}_{n} + \\frac{\\Delta t^2}{2!}\\,\\ddot{u}_{n} - \\frac{\\Delta t^3}{3!}\\,\\dddot{u}_{n} + \\frac{\\Delta t^4}{4!}\\,u^{(4)}_{n} - O(\\Delta t^5)\n$$\n将这些代入 $\\tau^{\\mathrm{CD}}_{n}$ 第一项的分子中：\n$$\nu(t_{n+1}) - 2\\,u_{n} + u(t_{n-1}) = \\left(2\\,\\frac{\\Delta t^2}{2!}\\,\\ddot{u}_{n}\\right) + \\left(2\\,\\frac{\\Delta t^4}{4!}\\,u^{(4)}_{n}\\right) + O(\\Delta t^6)\n$$\n$$\nu(t_{n+1}) - 2\\,u_{n} + u(t_{n-1}) = \\Delta t^2\\,\\ddot{u}_{n} + \\frac{\\Delta t^4}{12}\\,u^{(4)}_{n} + O(\\Delta t^6)\n$$\n现在，将此结果代回 $\\tau^{\\mathrm{CD}}_{n}$ 的表达式中：\n$$\n\\tau^{\\mathrm{CD}}_{n} = \\frac{\\Delta t^2\\,\\ddot{u}_{n} + \\frac{\\Delta t^4}{12}\\,u^{(4)}_{n} + O(\\Delta t^6)}{\\Delta t^2} + \\omega^{2}\\,u_{n}\n$$\n$$\n\\tau^{\\mathrm{CD}}_{n} = \\left(\\ddot{u}_{n} + \\frac{\\Delta t^2}{12}\\,u^{(4)}_{n} + O(\\Delta t^4)\\right) + \\omega^{2}\\,u_{n}\n$$\n重新整理各项，将控制方程组合在一起：\n$$\n\\tau^{\\mathrm{CD}}_{n} = \\big(\\ddot{u}_{n} + \\omega^{2}\\,u_{n}\\big) + \\frac{\\Delta t^2}{12}\\,u^{(4)}_{n} + O(\\Delta t^4)\n$$\n由于 $u(t)$ 是精确解，$\\ddot{u}_{n} + \\omega^2 u_{n} = 0$。因此，表达式简化为：\n$$\n\\tau^{\\mathrm{CD}}_{n} = \\frac{\\Delta t^2}{12}\\,u^{(4)}_{n} + O(\\Delta t^4)\n$$\n局部截断误差的首个非零项是 $\\frac{\\Delta t^2}{12}\\,u^{(4)}(t_{n})$。\n\n**任务 B：Newmark 平均加速度格式的局部截断误差**\n\n我们分别推导位移和速度更新的 LTE。\n\n对于位移更新，LTE 为：\n$$\n\\tau^{\\mathrm{N}}_{u,n} = u(t_{n+1}) - u(t_{n}) - \\Delta t\\,v(t_{n}) - \\frac{\\Delta t^{2}}{4}\\,\\big(a(t_{n}) + a(t_{n+1})\\big)\n$$\n我们使用 $u(t_{n+1})$ 和 $a(t_{n+1})$ 关于 $t_{n}$ 的泰勒展开。我们回顾 $v_n=\\dot{u}_n$，$a_n=\\ddot{u}_n$，$\\dot{a}_n=\\dddot{u}_n$。\n$$\nu(t_{n+1}) = u_{n} + \\Delta t\\,\\dot{u}_{n} + \\frac{\\Delta t^2}{2}\\,\\ddot{u}_{n} + \\frac{\\Delta t^3}{6}\\,\\dddot{u}_{n} + O(\\Delta t^4)\n$$\n$$\na(t_{n+1}) = a_{n} + \\Delta t\\,\\dot{a}_{n} + O(\\Delta t^2)\n$$\n将这些代入 $\\tau^{\\mathrm{N}}_{u,n}$ 的表达式中：\n$$\n\\tau^{\\mathrm{N}}_{u,n} = \\left(u_{n} + \\Delta t\\,\\dot{u}_{n} + \\frac{\\Delta t^2}{2}\\,\\ddot{u}_{n} + \\frac{\\Delta t^3}{6}\\,\\dddot{u}_{n} + \\dots\\right) - u_{n} - \\Delta t\\,\\dot{u}_{n} - \\frac{\\Delta t^2}{4}\\,\\big(a_{n} + (a_{n} + \\Delta t\\,\\dot{a}_{n} + \\dots)\\big)\n$$\n注意到 $\\dot{u}_n=v_n$ 和 $\\ddot{u}_n=a_n$，我们简化得到：\n$$\n\\tau^{\\mathrm{N}}_{u,n} = \\left(\\frac{\\Delta t^2}{2}\\,a_{n} + \\frac{\\Delta t^3}{6}\\,\\dot{a}_{n} + \\dots\\right) - \\frac{\\Delta t^2}{4}\\,\\big(2\\,a_{n} + \\Delta t\\,\\dot{a}_{n} + \\dots\\big)\n$$\n$$\n\\tau^{\\mathrm{N}}_{u,n} = \\left(\\frac{\\Delta t^2}{2}\\,a_{n} + \\frac{\\Delta t^3}{6}\\,\\dot{a}_{n}\\right) - \\left(\\frac{\\Delta t^2}{2}\\,a_{n} + \\frac{\\Delta t^3}{4}\\,\\dot{a}_{n}\\right) + O(\\Delta t^4)\n$$\n$$\n\\tau^{\\mathrm{N}}_{u,n} = \\left(\\frac{1}{6} - \\frac{1}{4}\\right)\\Delta t^3\\,\\dot{a}_{n} + O(\\Delta t^4) = -\\frac{1}{12}\\,\\dot{a}_{n}\\,\\Delta t^3 + O(\\Delta t^4)\n$$\n首项是 $-\\frac{1}{12}\\,\\dddot{u}(t_{n})\\,\\Delta t^3$。\n\n对于速度更新，LTE 为：\n$$\n\\tau^{\\mathrm{N}}_{v,n} = v(t_{n+1}) - v(t_{n}) - \\frac{\\Delta t}{2}\\,\\big(a(t_{n}) + a(t_{n+1})\\big)\n$$\n我们使用 $v(t_{n+1})$ 和 $a(t_{n+1})$ 关于 $t_n$ 的泰勒展开。我们回顾 $\\dot{v}_n=a_n$，$\\ddot{v}_n=\\dot{a}_n$，$\\dddot{v}_n=\\ddot{a}_n$。\n$$\nv(t_{n+1}) = v_{n} + \\Delta t\\,\\dot{v}_{n} + \\frac{\\Delta t^2}{2}\\,\\ddot{v}_{n} + \\frac{\\Delta t^3}{6}\\,\\dddot{v}_{n} + O(\\Delta t^4)\n$$\n$$\na(t_{n+1}) = a_{n} + \\Delta t\\,\\dot{a}_{n} + \\frac{\\Delta t^2}{2}\\,\\ddot{a}_{n} + O(\\Delta t^3)\n$$\n将这些代入 $\\tau^{\\mathrm{N}}_{v,n}$ 的表达式中：\n$$\n\\tau^{\\mathrm{N}}_{v,n} = \\left(v_{n} + \\Delta t a_{n} + \\frac{\\Delta t^2}{2}\\,\\dot{a}_{n} + \\frac{\\Delta t^3}{6}\\,\\ddot{a}_{n} + \\dots\\right) - v_{n} - \\frac{\\Delta t}{2}\\,\\big(a_{n} + (a_{n} + \\Delta t\\,\\dot{a}_{n} + \\frac{\\Delta t^2}{2}\\,\\ddot{a}_{n} + \\dots)\\big)\n$$\n$$\n\\tau^{\\mathrm{N}}_{v,n} = \\left(\\Delta t a_{n} + \\frac{\\Delta t^2}{2}\\,\\dot{a}_{n} + \\frac{\\Delta t^3}{6}\\,\\ddot{a}_{n}\\right) - \\frac{\\Delta t}{2}\\,\\big(2\\,a_{n} + \\Delta t\\,\\dot{a}_{n} + \\frac{\\Delta t^2}{2}\\,\\ddot{a}_{n}\\big) + O(\\Delta t^4)\n$$\n$$\n\\tau^{\\mathrm{N}}_{v,n} = \\left(\\Delta t a_{n} + \\frac{\\Delta t^2}{2}\\,\\dot{a}_{n} + \\frac{\\Delta t^3}{6}\\,\\ddot{a}_{n}\\right) - \\left(\\Delta t a_{n} + \\frac{\\Delta t^2}{2}\\,\\dot{a}_{n} + \\frac{\\Delta t^3}{4}\\,\\ddot{a}_{n}\\right) + O(\\Delta t^4)\n$$\n$$\n\\tau^{\\mathrm{N}}_{v,n} = \\left(\\frac{1}{6} - \\frac{1}{4}\\right)\\Delta t^3\\,\\ddot{a}_{n} + O(\\Delta t^4) = -\\frac{1}{12}\\,\\ddot{a}_{n}\\,\\Delta t^3 + O(\\Delta t^4)\n$$\n首项是 $-\\frac{1}{12}\\,u^{(4)}(t_{n})\\,\\Delta t^3$。\n\n**任务 C：全局精度阶**\n\n数值方法的全局精度阶即其收敛阶。对于一个零点稳定的方法，其收敛阶等于其相容性阶。问题已说明两种格式都是零点稳定的。\n\n对于中心差分法，LTE 定义为将精确解代入离散化微分方程后的残差：$\\tau^{\\mathrm{CD}}_n = O(\\Delta t^p)$ 意味着相容性阶为 $p$。从任务 A 中，我们得到 $\\tau^{\\mathrm{CD}}_n = O(\\Delta t^2)$。因此，相容性阶为 $p=2$。所以中心差分法的全局精度阶为 $2$。\n\n对于 Newmark 平均加速度法，它是一个针对状态向量 $[u, v]^T$ 的单步法，其 LTEs $\\tau^{\\mathrm{N}}_{u,n}$ 和 $\\tau^{\\mathrm{N}}_{v,n}$ 代表在单步中累积的误差（单步误差）。如果一个单步法的单步误差是 $O(\\Delta t^{p+1})$ 阶，则称该方法具有 $p$ 阶相容性。从任务 B 中，我们得到位移和速度的 LTE 都是 $O(\\Delta t^3)$。这意味着 $p+1=3$，即相容性阶 $p=2$。因此，Newmark 平均加速度格式的全局精度阶为 $2$。\n\n两种方法对位移 $u(t)$ 都表现出 $2$ 阶的全局精度。最终答案是一个包含这两个阶数的行矩阵。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2  2\n\\end{pmatrix}\n}\n$$", "id": "3566460"}, {"introduction": "理论精度会直接影响实际性能，尤其是在波动传播问题中，相位和振幅误差至关重要。本练习将理论付诸实践，要求您通过编程来分析空间和时间离散化如何相互作用，从而在一维弹性杆中产生数值色散（相位误差）和数值耗散（振幅误差）。这项实践在一个具体的动力学背景下，突显了显式和隐式方案之间的权衡 ([@problem_id:3566418])。", "problem": "一根均匀、等截面的一维线弹性杆，其横截面积为 $A$，受一维线性动量平衡和胡克定律的约束，两者共同导出标量波动方程 $\\rho\\,\\partial^2 u/\\partial t^2 = E\\,\\partial^2 u/\\partial x^2$，用于描述位移 $u(x,t)$。其中 $\\rho$ 是质量密度，$E$ 是杨氏模量。考虑一个长度为 $L$ 的周期性域，该域被一个由 $N$ 个大小为 $h=L/N$ 的线性有限元组成的均匀网格离散，并采用一致质量矩阵。设半离散方程写作 $M\\,\\ddot{\\mathbf{u}}(t) + K\\,\\mathbf{u}(t) = \\mathbf{0}$。在短时冲击下，响应可以表示为空间傅里叶模态的叠加；我们关注一个整数索引为 $m$ 的单色模态，其波数为 $k = 2\\pi m/L$。假设在节点处采用模态试探解 $U_j \\propto e^{i j q}$，其中 $q = k h = 2 \\pi m / N$，以将该模态的半离散系统简化为 $\\ddot{u}_m(t) + \\omega_h^2\\,u_m(t)=0$ 形式的标量模态振子，其中 $\\omega_h$ 是由空间离散引起的半离散角频率。使用以下基本依据：波动方程、双节点线性单元的标准一致质量矩阵和刚度矩阵，以及周期性试探解。对于时间积分，考虑将中心差分格式（显式）和 Newmark 平均加速度格式（隐式）应用于该模态方程。请不要引用任何预先给出的频散或放大公式，而是从第一性原理出发，为每种时间积分格式推导无阻尼模态振子的数值角频率和单步放大因子。基于这些推导，为所选模态定义时间相速度相对误差和振幅误差如下：\n- 时间相速度相对误差为 $(\\omega_{\\text{num}}/\\omega_h)-1$，其中 $\\omega_{\\text{num}}$ 是时间积分格式对具有精确半离散角频率 $\\omega_h$ 的模态振子产生的数值角频率。\n- 振幅误差是单步放大因子的模减去 $1$，即 $|g|-1$，其中 $g$ 是应用于模态振子的格式的单步放大因子。\n\n在整个过程中，所有三角函数的参数必须以弧度为单位。所有物理参数均采用国际单位制 (SI)。误差的最终数值结果是无量纲的，并且必须以浮点数形式返回。\n\n测试套件和要求输出：\n对于以下三个测试案例中的每一个，在比较两种时间积分格式时，将空间网格和时间步长视为固定。对于每个案例，根据空间离散计算所选模态的半离散角频率 $\\omega_h$，然后计算中心差分和 Newmark 平均加速度格式的时间相速度相对误差和振幅误差。您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起，按以下顺序排列：\n[phase_error_central_difference_case1, amplitude_error_central_difference_case1, phase_error_newmark_average_acceleration_case1, amplitude_error_newmark_average_acceleration_case1, phase_error_central_difference_case2, amplitude_error_central_difference_case2, phase_error_newmark_average_acceleration_case2, amplitude_error_newmark_average_acceleration_case2, phase_error_central_difference_case3, amplitude_error_central_difference_case3, phase_error_newmark_average_acceleration_case3, amplitude_error_newmark_average_acceleration_case3]\n每个条目必须是十进制形式的浮点数。\n\n每个测试案例使用以下数据：\n- 案例 1 (常规路径): $E = 70\\times 10^9\\,\\mathrm{Pa}$，$\\rho = 2700\\,\\mathrm{kg/m^3}$，$N=100$，$h = 0.02\\,\\mathrm{m}$，$m=3$，$\\Delta t = 8.0\\times 10^{-6}\\,\\mathrm{s}$。\n- 案例 2 (接近显式稳定性边界): $E = 70\\times 10^9\\,\\mathrm{Pa}$，$\\rho = 2700\\,\\mathrm{kg/m^3}$，$N=100$，$h = 0.02\\,\\mathrm{m}$，$m=20$，$\\Delta t = 5.8336\\times 10^{-6}\\,\\mathrm{s}$。\n- 案例 3 (小时间步长边缘案例): $E = 30\\times 10^9\\,\\mathrm{Pa}$，$\\rho = 2000\\,\\mathrm{kg/m^3}$，$N=100$，$h = 0.02\\,\\mathrm{m}$，$m=1$，$\\Delta t = 1.0\\times 10^{-7}\\,\\mathrm{s}$。\n\n注意事项和要求：\n- 波速取为 $c = \\sqrt{E/\\rho}$。\n- 使用在均匀网格上通过模态约简得到的一致质量线性有限元频散关系来计算波数为 $k=2\\pi m/L$ (其中 $L = N h$) 的模态的 $\\omega_h$。不要假设任何集中质量简化。\n- 三角函数和反三角函数的角度必须以弧度为单位。\n- 最终程序不得要求任何用户输入，并且必须仅以上述确切格式打印单行结果。", "solution": "该问题是有效的。它具有科学依据，提法恰当且客观。它提供了一套完整的数据和定义，可以根据计算力学的既定原理（特别是有限元法和时间离散格式）推导出唯一的解。\n\n目标是，从第一性原理出发，为应用于半离散一维波动方程的两种时间积分格式（中心差分和 Newmark 平均加速度）推导数值角频率和放大因子。这些将被用来计算特定测试案例的时间相速度和振幅误差。\n\n### 1. 半离散模态方程和角频率 ($\\omega_h$)\n\n一维弹性杆的控制偏微分方程是波动方程：\n$$\n\\rho \\frac{\\partial^2 u}{\\partial t^2} = E \\frac{\\partial^2 u}{\\partial x^2}\n$$\n其中 $\\rho$ 是质量密度，$E$ 是杨氏模量，$u(x,t)$ 是轴向位移。\n\n我们用 $N$ 个大小为 $h = L/N$ 的线性有限元离散一个长度为 $L$ 的周期性域。对于单个双节点单元，其刚度矩阵 $K_e$ 和一致质量矩阵 $M_e$ 为：\n$$\nK_e = \\frac{AE}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}, \\quad M_e = \\frac{\\rho A h}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}\n$$\n其中 $A$ 是横截面积。\n\n半离散方程组为 $M\\ddot{\\mathbf{u}} + K\\mathbf{u} = \\mathbf{0}$。对于均匀周期性网格上的一个通用内部节点 $j$，组合来自相邻单元 $(j-1, j)$ 和 $(j, j+1)$ 的贡献，得到方程：\n$$\n\\frac{\\rho A h}{6}(\\ddot{U}_{j-1} + 4\\ddot{U}_j + \\ddot{U}_{j+1}) + \\frac{AE}{h}(-U_{j-1} + 2U_j - U_{j+1}) = 0\n$$\n其中 $U_j(t)$ 是节点 $j$ 的位移。\n\n我们代入整数索引为 $m$ 的单个傅里叶模态的试探解 $U_j(t) = u_m(t)e^{ijq}$，其中 $u_m(t)$ 是随时间变化的模态振幅，$q = kh = (2\\pi m/L)h = 2\\pi m/N$ 是无量纲波数。这得到 $\\ddot{U}_j(t) = \\ddot{u}_m(t)e^{ijq}$。代入节点方程并除以公因子 $Ae^{ijq}$ 得：\n$$\n\\frac{\\rho h}{6}\\ddot{u}_m(t)(e^{-iq} + 4 + e^{iq}) + \\frac{E}{h}u_m(t)(-e^{-iq} + 2 - e^{iq}) = 0\n$$\n使用欧拉恒等式 $e^{i\\theta} + e^{-i\\theta} = 2\\cos\\theta$：\n$$\n\\frac{\\rho h}{6}\\ddot{u}_m(t)(2\\cos q + 4) + \\frac{E}{h}u_m(t)(-2\\cos q + 2) = 0\n$$\n整理后得到标量模态振子方程 $\\ddot{u}_m(t) + \\omega_h^2 u_m(t) = 0$，其中 $\\omega_h^2$ 是半离散角频率的平方：\n$$\n\\omega_h^2 = \\frac{2E/h(1 - \\cos q)}{\\rho h/3(2 + \\cos q)} = \\frac{6E}{\\rho h^2} \\frac{1 - \\cos q}{2 + \\cos q}\n$$\n定义波速 $c = \\sqrt{E/\\rho}$，半离散角频率 $\\omega_h$ 为：\n$$\n\\omega_h = \\frac{c}{h} \\sqrt{6 \\frac{1 - \\cos(2\\pi m/N)}{2 + \\cos(2\\pi m/N)}}\n$$\n\n### 2. 中心差分格式分析\n\n应用于模态方程 $\\ddot{u} + \\omega_h^2 u = 0$ 的中心差分格式是：\n$$\n\\frac{u^{n+1} - 2u^n + u^{n-1}}{\\Delta t^2} + \\omega_h^2 u^n = 0\n$$\n其中 $u^n = u_m(n\\Delta t)$。我们寻求 $u^n = g^n u^0$ 形式的解，其中 $g$ 是单步放大因子。代入后得到关于 $g$ 的特征方程：\n$$\ng^2 - (2 - \\omega_h^2 \\Delta t^2)g + 1 = 0\n$$\n设 $\\Omega = \\omega_h \\Delta t$。方程为 $g^2 - (2-\\Omega^2)g + 1 = 0$。其根为：\n$$\ng = \\frac{(2-\\Omega^2) \\pm \\sqrt{(2-\\Omega^2)^2 - 4}}{2} = 1 - \\frac{\\Omega^2}{2} \\pm \\sqrt{\\left(1-\\frac{\\Omega^2}{2}\\right)^2 - 1}\n$$\n对于稳定的振荡响应，根必须是位于单位圆上的共轭复数。这发生在判别式非正时，即 $(2-\\Omega^2)^2 - 4 \\le 0$，简化后得到 Courant-Friedrichs-Lewy (CFL) 稳定性条件 $\\Omega \\le 2$。\n\n**振幅误差：** 对于 $\\Omega \\le 2$，根是共轭复数，它们的乘积为 $1$，所以 $|g|=1$。因此，定义为 $|g|-1$ 的振幅误差为 $0$。所有测试案例都满足此条件。\n\n**时间相速度相对误差：** 对于稳定响应，我们可以写出 $g = e^{i\\omega_{\\text{num}}\\Delta t} = \\cos(\\omega_{\\text{num}}\\Delta t) + i\\sin(\\omega_{\\text{num}}\\Delta t)$。根的和为 $g+\\bar{g} = 2\\Re(g) = 2\\cos(\\omega_{\\text{num}}\\Delta t)$。根据特征方程的 Vieta's formulas，根的和为 $2-\\Omega^2$。因此：\n$$\n2\\cos(\\omega_{\\text{num}}\\Delta t) = 2 - \\Omega^2 \\implies \\cos(\\omega_{\\text{num}}\\Delta t) = 1 - \\frac{\\Omega^2}{2}\n$$\n数值角频率为 $\\omega_{\\text{num}} = \\frac{1}{\\Delta t}\\arccos\\left(1 - \\frac{(\\omega_h\\Delta t)^2}{2}\\right)$。相速度误差为：\n$$\n\\left(\\frac{\\omega_{\\text{num}}}{\\omega_h}\\right) - 1 = \\frac{1}{\\omega_h\\Delta t}\\arccos\\left(1 - \\frac{(\\omega_h\\Delta t)^2}{2}\\right) - 1\n$$\n\n### 3. Newmark 平均加速度格式分析\n\n这种隐式格式（$\\beta=1/4, \\gamma=1/2$）应用于 $\\ddot{u} + \\omega_h^2 u = 0$ 是无条件稳定的。单步放大因子 $g$ 可以通过分析系统的放大矩阵找到。一种更直接的方法得到复放大因子：\n$$\ng = \\frac{1 - (\\omega_h\\Delta t)^2/4}{1 + (\\omega_h\\Delta t)^2/4} + i \\frac{\\omega_h\\Delta t}{1 + (\\omega_h\\Delta t)^2/4}\n$$\n\n**振幅误差：** $g$ 的模为：\n$$\n|g|^2 = \\frac{(1-\\Omega^2/4)^2 + \\Omega^2}{(1+\\Omega^2/4)^2} = \\frac{1 - \\Omega^2/2 + \\Omega^4/16 + \\Omega^2}{1 + \\Omega^2/2 + \\Omega^4/16} = \\frac{1 + \\Omega^2/2 + \\Omega^4/16}{1 + \\Omega^2/2 + \\Omega^4/16} = 1\n$$\n因此，对于所有 $\\Omega$ 值，都有 $|g|=1$，证实了其无条件稳定性。振幅误差 $|g|-1 = 0$。\n\n**时间相速度相对误差：** 我们通过 $g = e^{i\\omega_{\\text{num}}\\Delta t}$ 将 $g$ 与 $\\omega_{\\text{num}}$ 联系起来。一个方便的关系涉及半角正切：\n$$\n\\tan\\left(\\frac{\\omega_{\\text{num}}\\Delta t}{2}\\right) = \\frac{\\sin(\\omega_{\\text{num}}\\Delta t)}{1+\\cos(\\omega_{\\text{num}}\\Delta t)} = \\frac{\\Im(g)}{1+\\Re(g)}\n$$\n代入 $g$ 的实部和虚部：\n$$\n\\tan\\left(\\frac{\\omega_{\\text{num}}\\Delta t}{2}\\right) = \\frac{\\Omega/(1+\\Omega^2/4)}{1 + (1-\\Omega^2/4)/(1+\\Omega^2/4)} = \\frac{\\Omega}{1+\\Omega^2/4 + 1-\\Omega^2/4} = \\frac{\\Omega}{2}\n$$\n数值角频率为 $\\omega_{\\text{num}} = \\frac{2}{\\Delta t}\\arctan\\left(\\frac{\\omega_h\\Delta t}{2}\\right)$。相速度误差为：\n$$\n\\left(\\frac{\\omega_{\\text{num}}}{\\omega_h}\\right) - 1 = \\frac{2}{\\omega_h\\Delta t}\\arctan\\left(\\frac{\\omega_h\\Delta t}{2}\\right) - 1\n$$\n\n### 4. 测试案例计算总结\n对于每个测试案例 $(E, \\rho, N, h, m, \\Delta t)$:\n1.  计算 $c = \\sqrt{E/\\rho}$。\n2.  计算 $\\omega_h = \\frac{c}{h} \\sqrt{6 \\frac{1 - \\cos(2\\pi m/N)}{2 + \\cos(2\\pi m/N)}}$。\n3.  计算 $\\Omega = \\omega_h \\Delta t$。\n4.  中心差分误差：\n    -   振幅误差: $0.0$\n    -   相速度误差: $\\frac{1}{\\Omega}\\arccos(1 - \\Omega^2/2) - 1$\n5.  Newmark 平均加速度误差：\n    -   振幅误差: $0.0$\n    -   相速度误差: $\\frac{2}{\\Omega}\\arctan(\\Omega/2) - 1$", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the phase and amplitude errors for Central Difference and\n    Newmark Average Acceleration schemes for given test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (happy path)\n        {'E': 70e9, 'rho': 2700, 'N': 100, 'h': 0.02, 'm': 3, 'dt': 8.0e-6},\n        # Case 2 (near explicit stability boundary)\n        {'E': 70e9, 'rho': 2700, 'N': 100, 'h': 0.02, 'm': 20, 'dt': 5.8336e-6},\n        # Case 3 (small time step edge case)\n        {'E': 30e9, 'rho': 2000, 'N': 100, 'h': 0.02, 'm': 1, 'dt': 1.0e-7},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        E = case['E']\n        rho = case['rho']\n        N = case['N']\n        h = case['h']\n        m = case['m']\n        dt = case['dt']\n\n        # 1. Calculate semi-discrete angular frequency (omega_h)\n        c = np.sqrt(E / rho)\n        q = 2 * np.pi * m / N\n        \n        # This is the derived formula for omega_h squared\n        omega_h_sq = (6 * c**2 / h**2) * (1 - np.cos(q)) / (2 + np.cos(q))\n        omega_h = np.sqrt(omega_h_sq)\n\n        # Dimensionless time step\n        Omega = omega_h * dt\n\n        # 2. Central Difference (Explicit) Scheme Analysis\n        # Amplitude error is 0 for stable cases (Omega = 2)\n        # All test cases are designed to be stable.\n        amp_err_cd = 0.0\n        \n        # Phase speed relative error\n        # Formula: (arccos(1 - Omega^2/2) / Omega) - 1\n        # np.arccos expects argument in [-1, 1]. All cases satisfy this.\n        phase_err_cd = np.arccos(1 - Omega**2 / 2) / Omega - 1\n\n        # 3. Newmark Average Acceleration (Implicit) Scheme Analysis\n        # Amplitude error is 0 unconditionally\n        amp_err_naa = 0.0\n\n        # Phase speed relative error\n        # Formula: (2 * arctan(Omega/2) / Omega) - 1\n        phase_err_naa = (2 / Omega) * np.arctan(Omega / 2) - 1\n        \n        results.extend([phase_err_cd, amp_err_cd, phase_err_naa, amp_err_naa])\n\n    # Format the output as a single comma-separated list in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3566418"}, {"introduction": "现实世界中的岩土力学问题通常是非线性的。这项实践旨在解决隐式方法的核心挑战：在每个时间步求解非线性方程组。您将为一个非线性动力学系统推导并实现一个牛顿-拉夫逊求解器，包括推导对于实现快速收敛至关重要的一致切线刚度矩阵 ([@problem_id:3566474])。", "problem": "考虑一个代表集总岩土力学离散化的单自由度动力系统，该系统由线性动量平衡的强形式控制，\n$$\nm\\,\\ddot{u}(t) + c\\,\\dot{u}(t) + f_{\\mathrm{int}}(u(t)) = f_{\\mathrm{ext}}(t),\n$$\n其中 $m$ 是质量，$c$ 是粘性阻尼系数，$u(t)$ 是位移，$f_{\\mathrm{int}}(u)$ 是由材料响应产生的非线性内力，$f_{\\mathrm{ext}}(t)$ 是给定的外力。假设非线性材料响应由一个标量势表征，导出内力为\n$$\nf_{\\mathrm{int}}(u) = k\\,u + \\alpha\\,u^3,\n$$\n其中 $k  0$ 且 $\\alpha \\ge 0$。\n\n使用时间步长为 $\\Delta t$、参数为 $\\beta$ 和 $\\gamma$ 的隐式 Newmark 族对时间进行离散化。运动学更新如下\n$$\nu_{n+1} = u_n + \\Delta t\\,v_n + \\Delta t^2\\left(\\frac{1}{2} - \\beta\\right)a_n + \\beta\\,\\Delta t^2\\,a_{n+1},\n$$\n$$\nv_{n+1} = v_n + \\Delta t\\,(1 - \\gamma)\\,a_n + \\gamma\\,\\Delta t\\,a_{n+1},\n$$\n在 $t_{n+1}$ 时刻的动力平衡为\n$$\nm\\,a_{n+1} + c\\,v_{n+1} + f_{\\mathrm{int}}(u_{n+1}) = f_{\\mathrm{ext}}(t_{n+1}).\n$$\n\n任务1 (推导)：从线性动量平衡和隐式 Newmark 更新出发，通过写出以下残差，为未知向量 $\\left[u_{n+1},\\,v_{n+1},\\,a_{n+1}\\right]^\\top$ 构建 Newton–Raphson 迭代\n$$\nR_m(u_{n+1}, v_{n+1}, a_{n+1}) = m\\,a_{n+1} + c\\,v_{n+1} + f_{\\mathrm{int}}(u_{n+1}) - f_{\\mathrm{ext}}(t_{n+1}),\n$$\n$$\nR_v(u_{n+1}, v_{n+1}, a_{n+1}) = v_{n+1} - v_n - \\Delta t\\,(1 - \\gamma)\\,a_n - \\gamma\\,\\Delta t\\,a_{n+1},\n$$\n$$\nR_u(u_{n+1}, v_{n+1}, a_{n+1}) = u_{n+1} - u_n - \\Delta t\\,v_n - \\Delta t^2\\left(\\frac{1}{2} - \\beta\\right)a_n - \\beta\\,\\Delta t^2\\,a_{n+1},\n$$\n并推导关于 $\\left[u_{n+1},\\,v_{n+1},\\,a_{n+1}\\right]^\\top$ 的偏导数的 $3\\times 3$ 雅可比矩阵。明确标识出每个雅可比分块，并说明一致性线性化如何产生二次收敛。\n\n任务2 (缩聚)：说明如何通过 Newmark 约束消去 $v_{n+1}$ 和 $a_{n+1}$，以获得关于 $u_{n+1}$ 的标量 Newton 更新，其有效切线为\n$$\nK_{\\mathrm{eff}}(u_{n+1}) = K_t(u_{n+1}) + a_0\\,m + a_1\\,c,\n$$\n其中 $K_t(u) = \\dfrac{df_{\\mathrm{int}}}{du}(u)$ 且 $a_0 = \\dfrac{1}{\\beta\\,\\Delta t^2}$，$a_1 = \\dfrac{\\gamma}{\\beta\\,\\Delta t}$。通过适当的 Schur 补直接从 $3\\times 3$ 雅可比矩阵推导出此结果。\n\n任务3 (实现)：为单个隐式 Newmark 步实现一个 Newton–Raphson 求解器，该求解器使用对 $u_{n+1}$ 的缩聚标量更新，其中\n$$\na_{n+1} = \\frac{1}{\\beta\\,\\Delta t^2}\\left(u_{n+1} - u_n - \\Delta t\\,v_n - \\Delta t^2\\left(\\frac{1}{2} - \\beta\\right)a_n\\right),\n$$\n$$\nv_{n+1} = v_n + \\Delta t\\,(1 - \\gamma)\\,a_n + \\gamma\\,\\Delta t\\,a_{n+1},\n$$\n残差为\n$$\nr(u_{n+1}) = m\\,a_{n+1} + c\\,v_{n+1} + f_{\\mathrm{int}}(u_{n+1}) - f_{\\mathrm{ext}}(t_{n+1}),\n$$\n更新方式为\n$$\n\\Delta u = -\\frac{r(u_{n+1})}{K_{\\mathrm{eff}}(u_{n+1})},\\quad u_{n+1}^{(k+1)} = u_{n+1}^{(k)} + \\Delta u.\n$$\n使用停止准则 $\\lvert r(u_{n+1})\\rvert \\le \\varepsilon$，其中 $\\varepsilon = 10^{-12}$。\n\n此外，构建完整的 $3\\times 3$ 雅可比矩阵，并进行数值验证，确保其关于 $u_{n+1}$ 的 Schur 补在指定容差范围内与 $K_{\\mathrm{eff}}(u_{n+1})$ 匹配。将此验证结果以布尔值形式报告。\n\n初始化：根据 $t_n$ 时刻的平衡条件计算 $a_n$，\n$$\na_n = \\frac{f_{\\mathrm{ext}}(t_n) - c\\,v_n - f_{\\mathrm{int}}(u_n)}{m}.\n$$\n\n测试套件：对于以下各种情况，计算 $u_{n+1}$ 和雅可比一致性布尔值。将 $u_{n+1}$ 以米为单位表示为浮点数。\n\n- 情况 A (一般非线性，有阻尼)：$m = 1.0\\,\\mathrm{kg}$, $c = 0.05\\,\\mathrm{N\\,s/m}$, $k = 100.0\\,\\mathrm{N/m}$, $\\alpha = 500.0\\,\\mathrm{N/m^3}$, $\\Delta t = 0.01\\,\\mathrm{s}$, $\\beta = 0.25$, $\\gamma = 0.5$, $u_n = 0.01\\,\\mathrm{m}$, $v_n = 0.0\\,\\mathrm{m/s}$, $f_{\\mathrm{ext}}(t_n) = 0.0\\,\\mathrm{N}$, $f_{\\mathrm{ext}}(t_{n+1}) = 1.0\\,\\mathrm{N}$。\n- 情况 B (无阻尼)：$m = 2.0\\,\\mathrm{kg}$, $c = 0.0\\,\\mathrm{N\\,s/m}$, $k = 200.0\\,\\mathrm{N/m}$, $\\alpha = 1000.0\\,\\mathrm{N/m^3}$, $\\Delta t = 0.01\\,\\mathrm{s}$, $\\beta = 0.25$, $\\gamma = 0.5$, $u_n = 0.0\\,\\mathrm{m}$, $v_n = 0.0\\,\\mathrm{m/s}$, $f_{\\mathrm{ext}}(t_n) = 0.0\\,\\mathrm{N}$, $f_{\\mathrm{ext}}(t_{n+1}) = 0.5\\,\\mathrm{N}$。\n- 情况 C (小时间步长)：$m = 1.0\\,\\mathrm{kg}$, $c = 0.05\\,\\mathrm{N\\,s/m}$, $k = 100.0\\,\\mathrm{N/m}$, $\\alpha = 500.0\\,\\mathrm{N/m^3}$, $\\Delta t = 0.001\\,\\mathrm{s}$, $\\beta = 0.25$, $\\gamma = 0.5$, $u_n = 0.01\\,\\mathrm{m}$, $v_n = 0.0\\,\\mathrm{m/s}$, $f_{\\mathrm{ext}}(t_n) = 0.0\\,\\mathrm{N}$, $f_{\\mathrm{ext}}(t_{n+1}) = 1.0\\,\\mathrm{N}$。\n- 情况 D (刚性非线性，中等阻尼)：$m = 0.5\\,\\mathrm{kg}$, $c = 0.2\\,\\mathrm{N\\,s/m}$, $k = 1000.0\\,\\mathrm{N/m}$, $\\alpha = 100000.0\\,\\mathrm{N/m^3}$, $\\Delta t = 0.01\\,\\mathrm{s}$, $\\beta = 0.25$, $\\gamma = 0.5$, $u_n = 0.002\\,\\mathrm{m}$, $v_n = 0.0\\,\\mathrm{m/s}$, $f_{\\mathrm{ext}}(t_n) = 0.0\\,\\mathrm{N}$, $f_{\\mathrm{ext}}(t_{n+1}) = 2.0\\,\\mathrm{N}$。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果。对于每个测试用例，输出两个条目：首先是收敛的位移 $u_{n+1}$ (以米为单位的浮点数)，然后是一个布尔值，表示缩聚后的有效切线 $K_{\\mathrm{eff}}$ 是否在容差范围内与完整雅可比矩阵的 Schur 补匹配。例如，包含四个案例的输出应如下所示\n$$\n[ u_A, \\mathrm{bool}_A, u_B, \\mathrm{bool}_B, u_C, \\mathrm{bool}_C, u_D, \\mathrm{bool}_D ].\n$$", "solution": "该问题要求为单自由度 (SDOF) 非线性动力系统构建并实现一种数值解法。该系统的行为由运动方程描述，这是一个二阶非线性常微分方程：\n$$\nm\\,\\ddot{u}(t) + c\\,\\dot{u}(t) + f_{\\mathrm{int}}(u(t)) = f_{\\mathrm{ext}}(t)\n$$\n非线性源于内力，其由三次关系式给出：$f_{\\mathrm{int}}(u) = k\\,u + \\alpha\\,u^3$，这是 Duffing 振子的特征。参数 $m$、$c$、$k$ 和 $\\alpha$ 分别是质量、阻尼系数、线性刚度和非线性刚度，满足 $k  0$ 和 $\\alpha \\ge 0$。\n\n时间域使用隐式 Newmark 方法族进行离散化。系统在 $t_{n+1} = t_n + \\Delta t$ 时刻的状态由 $t_n$ 时刻的状态通过位移 $u_{n+1}$ 和速度 $v_{n+1}$ 的运动学更新规则确定：\n$$\nu_{n+1} = u_n + \\Delta t\\,v_n + \\Delta t^2\\left(\\frac{1}{2} - \\beta\\right)a_n + \\beta\\,\\Delta t^2\\,a_{n+1}\n$$\n$$\nv_{n+1} = v_n + \\Delta t\\,(1 - \\gamma)\\,a_n + \\gamma\\,\\Delta t\\,a_{n+1}\n$$\n以及在 $t_{n+1}$ 时刻强制执行动力平衡：\n$$\nm\\,a_{n+1} + c\\,v_{n+1} + f_{\\mathrm{int}}(u_{n+1}) = f_{\\mathrm{ext}}(t_{n+1})\n$$\n由于这些方程对于未知数 $u_{n+1}$、$v_{n+1}$ 和 $a_{n+1}$ 是隐式且非线性的，因此需要一个如 Newton-Raphson 方法之类的迭代数值方案来求解每个时间步的解。\n\n### 任务1：全系统 Newton-Raphson 公式\n\nNewton-Raphson 方法通过从线性系统 $\\mathbf{J}(\\mathbf{x}^{(k)}) \\Delta \\mathbf{x} = -\\mathbf{R}(\\mathbf{x}^{(k)})$ 中迭代求解对猜测值 $\\mathbf{x}^{(k)}$ 的修正量 $\\Delta \\mathbf{x}$ 来解决非线性方程组 $\\mathbf{R}(\\mathbf{x}) = \\mathbf{0}$，其中 $\\mathbf{J}$ 是 $\\mathbf{R}$ 的雅可比矩阵。\n\n对于我们的问题，$t_{n+1}$ 时刻的未知向量是 $\\mathbf{x}_{n+1} = \\left[u_{n+1}, v_{n+1}, a_{n+1}\\right]^\\top$。方程组由提供的三个残差函数构成：\n$$\nR_m(u_{n+1}, v_{n+1}, a_{n+1}) = m\\,a_{n+1} + c\\,v_{n+1} + f_{\\mathrm{int}}(u_{n+1}) - f_{\\mathrm{ext}}(t_{n+1}) = 0\n$$\n$$\nR_v(u_{n+1}, v_{n+1}, a_{n+1}) = v_{n+1} - v_n - \\Delta t\\,(1 - \\gamma)\\,a_n - \\gamma\\,\\Delta t\\,a_{n+1} = 0\n$$\n$$\nR_u(u_{n+1}, v_{n+1}, a_{n+1}) = u_{n+1} - u_n - \\Delta t\\,v_n - \\Delta t^2\\left(\\frac{1}{2} - \\beta\\right)a_n - \\beta\\,\\Delta t^2\\,a_{n+1} = 0\n$$\n雅可比矩阵 $\\mathbf{J}$ 是残差向量 $\\mathbf{R} = [R_m, R_v, R_u]^\\top$ 相对于未知向量 $\\mathbf{x}_{n+1}$ 的偏导数矩阵。其分量 $J_{ij}$ 由 $J_{ij} = \\partial R_i / \\partial x_j$ 给出。\n\n所需的偏导数是：\n- 对于 $R_m$：\n  - $\\frac{\\partial R_m}{\\partial u_{n+1}} = \\frac{d}{du_{n+1}}f_{\\mathrm{int}}(u_{n+1}) = K_t(u_{n+1}) = k + 3\\alpha u_{n+1}^2$\n  - $\\frac{\\partial R_m}{\\partial v_{n+1}} = c$\n  - $\\frac{\\partial R_m}{\\partial a_{n+1}} = m$\n- 对于 $R_v$：\n  - $\\frac{\\partial R_v}{\\partial u_{n+1}} = 0$\n  - $\\frac{\\partial R_v}{\\partial v_{n+1}} = 1$\n  - $\\frac{\\partial R_v}{\\partial a_{n+1}} = -\\gamma\\,\\Delta t$\n- 对于 $R_u$：\n  - $\\frac{\\partial R_u}{\\partial u_{n+1}} = 1$\n  - $\\frac{\\partial R_u}{\\partial v_{n+1}} = 0$\n  - $\\frac{\\partial R_u}{\\partial a_{n+1}} = -\\beta\\,\\Delta t^2$\n\n组合这些分量得到 $3 \\times 3$ 雅可比矩阵：\n$$\n\\mathbf{J}(u_{n+1}) = \\frac{\\partial(R_m, R_v, R_u)}{\\partial(u_{n+1}, v_{n+1}, a_{n+1})} = \n\\begin{bmatrix}\nK_t(u_{n+1})  c  m \\\\\n0  1  -\\gamma\\,\\Delta t \\\\\n1  0  -\\beta\\,\\Delta t^2\n\\end{bmatrix}\n$$\n该雅可比矩阵是残差向量的精确导数，这一特性被称为一致线性化。在 Newton-Raphson 更新中使用此矩阵可确保该方法在解附近达到其特有的二次收敛速度。\n\n### 任务2：静力缩聚与有效切线刚度\n\n$3 \\times 3$ 系统可以简化为关于主要未知量 $u_{n+1}$ 的单个标量方程。这个过程称为静力缩聚，它能产生一个更高效的求解器。推导依赖于雅可比矩阵的 Schur 补。我们对应于主要未知量 $\\Delta u$ 和次要未知量 $\\left[\\Delta v, \\Delta a\\right]^\\top$ 对线性系统 $\\mathbf{J} \\Delta \\mathbf{x} = -\\mathbf{R}$ 进行划分：\n$$\n\\begin{bmatrix}\n\\mathbf{J}_{11}  \\mathbf{J}_{12} \\\\\n\\mathbf{J}_{21}  \\mathbf{J}_{22}\n\\end{bmatrix}\n\\begin{Bmatrix}\n\\Delta u \\\\\n\\Delta \\mathbf{x}_2\n\\end{Bmatrix}\n= -\n\\begin{Bmatrix}\nR_1 \\\\\n\\mathbf{R}_2\n\\end{Bmatrix}\n$$\n其中 $\\Delta \\mathbf{x}_2 = \\left[\\Delta v, \\Delta a\\right]^\\top$，$\\mathbf{J}$ 的分块为：\n$$\n\\mathbf{J}_{11} = K_t(u_{n+1}), \\quad \\mathbf{J}_{12} = \\begin{bmatrix} c  m \\end{bmatrix}, \\quad \\mathbf{J}_{21} = \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix}, \\quad \\mathbf{J}_{22} = \\begin{bmatrix} 1  -\\gamma\\,\\Delta t \\\\ 0  -\\beta\\,\\Delta t^2 \\end{bmatrix}\n$$\n从分块系统的第二行，我们求解 $\\Delta \\mathbf{x}_2$：$\\mathbf{J}_{21} \\Delta u + \\mathbf{J}_{22} \\Delta \\mathbf{x}_2 = -\\mathbf{R}_2 \\implies \\Delta \\mathbf{x}_2 = -\\mathbf{J}_{22}^{-1}(\\mathbf{R}_2 + \\mathbf{J}_{21} \\Delta u)$。\n将此代入第一行得到：\n$$\n\\left(\\mathbf{J}_{11} - \\mathbf{J}_{12} \\mathbf{J}_{22}^{-1} \\mathbf{J}_{21}\\right) \\Delta u = -R_1 + \\mathbf{J}_{12}\\mathbf{J}_{22}^{-1}\\mathbf{R}_2\n$$\n乘以 $\\Delta u$ 的项是 $\\mathbf{J}_{11}$ 的 Schur 补，也就是有效切线刚度 $K_{\\mathrm{eff}}$。我们来计算它。首先，我们求 $\\mathbf{J}_{22}$ 的逆：\n$$\n\\mathbf{J}_{22}^{-1} = \\frac{1}{\\det(\\mathbf{J}_{22})} \\begin{bmatrix} -\\beta\\,\\Delta t^2  \\gamma\\,\\Delta t \\\\ 0  1 \\end{bmatrix} = \\frac{1}{-\\beta\\,\\Delta t^2} \\begin{bmatrix} -\\beta\\,\\Delta t^2  \\gamma\\,\\Delta t \\\\ 0  1 \\end{bmatrix} = \\begin{bmatrix} 1  -\\frac{\\gamma}{\\beta\\,\\Delta t} \\\\ 0  -\\frac{1}{\\beta\\,\\Delta t^2} \\end{bmatrix}\n$$\n现在，我们计算三乘积 $\\mathbf{J}_{12} \\mathbf{J}_{22}^{-1} \\mathbf{J}_{21}$：\n$$\n\\mathbf{J}_{12} \\mathbf{J}_{22}^{-1} = \\begin{bmatrix} c  m \\end{bmatrix} \\begin{bmatrix} 1  -\\frac{\\gamma}{\\beta\\,\\Delta t} \\\\ 0  -\\frac{1}{\\beta\\,\\Delta t^2} \\end{bmatrix} = \\begin{bmatrix} c  -c\\frac{\\gamma}{\\beta\\,\\Delta t} - \\frac{m}{\\beta\\,\\Delta t^2} \\end{bmatrix}\n$$\n$$\n(\\mathbf{J}_{12} \\mathbf{J}_{22}^{-1}) \\mathbf{J}_{21} = \\begin{bmatrix} c  -c\\frac{\\gamma}{\\beta\\,\\Delta t} - \\frac{m}{\\beta\\,\\Delta t^2} \\end{bmatrix} \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix} = -c\\frac{\\gamma}{\\beta\\,\\Delta t} - \\frac{m}{\\beta\\,\\Delta t^2}\n$$\n最后，有效切线刚度为：\n$$\nK_{\\mathrm{eff}} = \\mathbf{J}_{11} - \\mathbf{J}_{12} \\mathbf{J}_{22}^{-1} \\mathbf{J}_{21} = K_t(u_{n+1}) - \\left( -c\\frac{\\gamma}{\\beta\\,\\Delta t} - \\frac{m}{\\beta\\,\\Delta t^2} \\right)\n$$\n$$\nK_{\\mathrm{eff}}(u_{n+1}) = K_t(u_{n+1}) + \\frac{1}{\\beta\\,\\Delta t^2} m + \\frac{\\gamma}{\\beta\\,\\Delta t} c\n$$\n这与提供的表达式 $K_{\\mathrm{eff}} = K_t + a_0 m + a_1 c$ 一致，其中常数 $a_0 = \\frac{1}{\\beta\\,\\Delta t^2}$ 且 $a_1 = \\frac{\\gamma}{\\beta\\,\\Delta t}$。\n\n### 任务3：算法设计与实现原理\n\n缩聚后的公式允许我们使用标量 Newton-Raphson 迭代求解 $u_{n+1}$。该算法的核心是求解标量残差方程 $r(u_{n+1})=0$，其中：\n$$\nr(u_{n+1}) = m\\,a_{n+1} + c\\,v_{n+1} + f_{\\mathrm{int}}(u_{n+1}) - f_{\\mathrm{ext}}(t_{n+1})\n$$\n在此方程中，$a_{n+1}$ 和 $v_{n+1}$ 不是独立的未知数，而是通过 Newmark 运动学关系依赖于 $u_{n+1}$ 的函数：\n$$\na_{n+1}(u_{n+1}) = \\frac{1}{\\beta\\,\\Delta t^2}\\left(u_{n+1} - u_n - \\Delta t\\,v_n - \\Delta t^2\\left(\\frac{1}{2} - \\beta\\right)a_n\\right)\n$$\n$$\nv_{n+1}(u_{n+1}) = v_n + \\Delta t\\,(1 - \\gamma)\\,a_n + \\gamma\\,\\Delta t\\,a_{n+1}(u_{n+1})\n$$\n注意，在开始时间步之前，必须计算 $a_n$ 以满足 $t_n$ 时刻的平衡条件：$a_n = (f_{\\mathrm{ext}}(t_n) - c v_n - f_{\\mathrm{int}}(u_n)) / m$。\n\n针对 $u_{n+1}$ 的 Newton-Raphson 迭代过程如下：\n1.  初始化迭代计数器 $k=0$ 和猜测值 $u_{n+1}^{(0)} = u_n$。\n2.  对 $k=0, 1, 2, \\dots$ 进行循环，直到收敛：\n    a. 令当前猜测值为 $u_{\\text{curr}} = u_{n+1}^{(k)}$。\n    b. 使用 $u_{\\text{curr}}$ 和上述运动学表达式计算 $a_{n+1}$ 和 $v_{n+1}$。\n    c. 计算残差 $r(u_{\\text{curr}})$。\n    d. 检查收敛性：如果 $\\lvert r(u_{\\text{curr}}) \\rvert \\le \\varepsilon$ (其中 $\\varepsilon=10^{-12}$)，则循环终止。\n    e. 计算有效切线刚度 $K_{\\mathrm{eff}}(u_{\\text{curr}}) = \\frac{dr}{du_{n+1}}|_{u_{n+1}=u_{\\text{curr}}} = K_t(u_{\\text{curr}}) + a_0 m + a_1 c$。\n    f. 计算更新量：$\\Delta u = -r(u_{\\text{curr}}) / K_{\\mathrm{eff}}(u_{\\text{curr}})$。\n    g. 更新猜测值：$u_{n+1}^{(k+1)} = u_{\\text{curr}} + \\Delta u$。\n3. 收敛解即为 $u_{n+1}$ 的最终值。\n\n最后，实现部分要求进行数值验证，以证明 $K_{\\mathrm{eff}}$ 的解析表达式等价于完整 $3 \\times 3$ 雅可比矩阵的 Schur 补。这通过以下步骤实现：\n1.  在收敛解 $u_{n+1}$ 处构建数值雅可比矩阵 $\\mathbf{J}$。\n2.  将 $\\mathbf{J}$ 划分为 $\\mathbf{J}_{11}$、$\\mathbf{J}_{12}$、$\\mathbf{J}_{21}$ 和 $\\mathbf{J}_{22}$ 分块。\n3.  数值计算 Schur 补 $S = \\mathbf{J}_{11} - \\mathbf{J}_{12} (\\mathbf{J}_{22})^{-1} \\mathbf{J}_{21}$。\n4.  将此数值 $S$ 与通过解析公式计算出的 $K_{\\mathrm{eff}}(u_{n+1})$ 的值进行比较。比较在很小的数值容差内进行，得出一个布尔结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_newmark_step(params):\n    \"\"\"\n    Solves for the state at time t_{n+1} for a single time step using the\n    implicit Newmark method with a condensed Newton-Raphson scheme.\n\n    Args:\n        params (tuple): A tuple containing all problem parameters:\n                        (m, c, k, alpha, dt, beta, gamma, u_n, v_n, \n                         f_ext_n, f_ext_n1)\n\n    Returns:\n        tuple: A tuple containing the converged displacement u_{n+1} (float)\n               and a boolean indicating if the Jacobian verification passed.\n    \"\"\"\n    m, c, k, alpha, dt, beta, gamma, u_n, v_n, f_ext_n, f_ext_n1 = params\n\n    # --- Helper Functions ---\n    def f_int(u):\n        \"\"\"Internal force.\"\"\"\n        return k * u + alpha * u**3\n\n    def K_t(u):\n        \"\"\"Tangent stiffness from the internal force.\"\"\"\n        return k + 3 * alpha * u**2\n\n    # --- Initialization ---\n    # Compute acceleration at step n, assuming equilibrium.\n    a_n = (f_ext_n - c * v_n - f_int(u_n)) / m\n\n    # Newmark constants for the condensed system.\n    a0 = 1.0 / (beta * dt**2)\n    a1 = gamma / (beta * dt)\n\n    # --- Newton-Raphson Iteration for the Condensed System ---\n    u_n1 = u_n  # Initial guess for the displacement at t_{n+1}.\n    \n    epsilon = 1e-12\n    max_iter = 20\n\n    for _ in range(max_iter):\n        # Calculate kinematics (a_{n+1}, v_{n+1}) based on the current guess for u_{n+1}.\n        # The equation for a_{n+1} is derived from the Newmark displacement update:\n        # u_{n+1} = u_n + dt*v_n + dt^2*(1/2 - beta)*a_n + beta*dt^2*a_{n+1}\n        # Rearranging gives:\n        a_n1 = a0 * (u_n1 - u_n - dt * v_n) - ((1/(2*beta)) - 1) * a_n\n        \n        # The velocity v_{n+1} is updated using the computed a_{n+1}.\n        v_n1 = v_n + dt * (1 - gamma) * a_n + gamma * dt * a_n1\n\n        # Calculate the residual of the dynamic equilibrium equation at t_{n+1}.\n        residual = m * a_n1 + c * v_n1 + f_int(u_n1) - f_ext_n1\n\n        # Check for convergence.\n        if np.abs(residual) = epsilon:\n            break\n\n        # Calculate the effective tangent stiffness K_eff.\n        K_eff = K_t(u_n1) + a0 * m + a1 * c\n\n        # Compute the update to the displacement.\n        delta_u = -residual / K_eff\n        u_n1 += delta_u\n    else:\n        # This block executes if the loop completes without converging.\n        # In a real application, an error should be raised.\n        # For this problem, convergence is expected.\n        pass\n    \n    final_u_n1 = u_n1\n\n    # --- Jacobian Verification ---\n    # 1. Calculate K_eff using the analytical condensed formula at the converged solution.\n    K_eff_condensed = K_t(final_u_n1) + a0 * m + a1 * c\n\n    # 2. Build the full 3x3 Jacobian matrix at the converged solution.\n    # The order of residuals is (R_m, R_v, R_u) and variables is (u, v, a).\n    J = np.array([\n        [K_t(final_u_n1), c, m],\n        [0.0, 1.0, -gamma * dt],\n        [1.0, 0.0, -beta * dt**2]\n    ])\n    \n    # 3. Partition the Jacobian matrix.\n    J11 = J[0, 0]\n    J12 = J[0, 1:].reshape(1, 2)\n    J21 = J[1:, 0].reshape(2, 1)\n    J22 = J[1:, 1:]\n\n    # 4. Calculate the Schur complement: S = J11 - J12 @ inv(J22) @ J21\n    try:\n        J22_inv = np.linalg.inv(J22)\n        schur_complement = (J11 - J12 @ J22_inv @ J21).item()\n    except np.linalg.LinAlgError:\n        schur_complement = np.nan # In case of singular J22\n\n    # 5. Compare the analytical K_eff with the numerical Schur complement.\n    is_consistent = np.isclose(schur_complement, K_eff_condensed)\n\n    return final_u_n1, is_consistent\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (general nonlinear, damped)\n        (1.0, 0.05, 100.0, 500.0, 0.01, 0.25, 0.5, 0.01, 0.0, 0.0, 1.0),\n        # Case B (undamped)\n        (2.0, 0.0, 200.0, 1000.0, 0.01, 0.25, 0.5, 0.0, 0.0, 0.0, 0.5),\n        # Case C (small time step)\n        (1.0, 0.05, 100.0, 500.0, 0.001, 0.25, 0.5, 0.01, 0.0, 0.0, 1.0),\n        # Case D (stiff nonlinear, moderate damping)\n        (0.5, 0.2, 1000.0, 100000.0, 0.01, 0.25, 0.5, 0.002, 0.0, 0.0, 2.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        u_final, is_consistent_bool = solve_newmark_step(case)\n        results.append(u_final)\n        results.append(str(is_consistent_bool))\n\n    # The problem asks for the boolean to be represented as a string like 'bool_A'.\n    # Python's str(True) is 'True', which fits this representation.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3566474"}]}