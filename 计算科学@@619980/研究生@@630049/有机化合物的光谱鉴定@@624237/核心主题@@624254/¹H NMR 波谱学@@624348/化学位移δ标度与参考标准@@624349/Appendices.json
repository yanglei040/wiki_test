{"hands_on_practices": [{"introduction": "在常规的核磁共振分析中，直接添加像四甲基硅烷（TMS）这样的一级参比标准品并非总是可行的。一种常见且实用的替代方法是使用残留溶剂的已知信号作为二级参比。此练习[@problem_id:3726725]将指导您完成相对于溶剂峰计算待测物化学位移的全过程，同时还需考虑因实验条件（如氢键）变化而导致的溶剂位移的微小但重要的偏差。掌握这项技能对于精确解读谱图至关重要。", "problem": "一位研究人员获取了一个有机样品的质子核磁共振（NMR）谱，实验所用的静磁通密度使得四甲基硅烷（TMS）中质子在该仪器上的共振频率为 $500.000 \\times 10^{6} \\ \\mathrm{Hz}$。该谱图包含用作二级参比的残留氯仿 $\\mathrm{CHCl}_{3}$。在 $298 \\ \\mathrm{K}$ 的样品条件下，氢键作用扰动了残留溶剂峰，使其真实化学位移相对于此温度下的列表值偏离了 $+\\Delta \\delta_{s}$，其中 $\\Delta \\delta_{s} = 0.017 \\ \\text{（无量纲，通常以 ppm 表示）}$。在 $298 \\ \\mathrm{K}$ 时，$\\mathrm{CHCl}_{3}$ 残留质子的列表化学位移为 $\\delta_{s}^{\\mathrm{tab}} = 7.26 \\ \\text{（无量纲，通常以 ppm 表示）}$。观测到一个分析物质子共振峰，其绝对频率比溶剂峰高出测得的偏移量 $\\Delta \\nu = +1345.0 \\ \\mathrm{Hz}$。\n\n从第一性原理出发，利用化学位移（相对于一级参比 TMS 的无量纲归一化频率位移）的定义，以及 NMR 共振频率与磁通密度的正比关系（拉莫尔关系），推导分析物相对于 TMS 的化学位移表达式，并用给定物理量表示。然后进行数值计算。设 $\\Delta \\nu$ 的正号表示分析物共振峰相对于溶剂峰位于低场（更高频率）。将最终答案四舍五入至四位有效数字。由于化学位移是无量纲的，报告最终值时无需单位。", "solution": "对问题陈述进行验证。\n\n**步骤1：提取已知条件**\n-   仪器上四甲基硅烷（TMS）中质子的共振频率，作为参比频率：$\\nu_{\\text{TMS}} = 500.000 \\times 10^{6} \\ \\mathrm{Hz}$。\n-   样品温度：$T = 298 \\ \\mathrm{K}$。\n-   由氢键引起的溶剂化学位移扰动：$\\Delta \\delta_{s} = +0.017$（单位 ppm）。\n-   在 $298 \\ \\mathrm{K}$ 时残留 $\\mathrm{CHCl}_{3}$ 质子的列表化学位移：$\\delta_{s}^{\\mathrm{tab}} = 7.26$（单位 ppm）。\n-   分析物共振峰相对于溶剂峰的频率偏移：$\\Delta \\nu = +1345.0 \\ \\mathrm{Hz}$。正号表示低场位移（更高频率）。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题基于核磁共振（NMR）波谱学的基本原理。化学位移的定义、TMS 作为一级参比的作用、使用残留溶剂峰作为二级参比、溶剂和温度依赖性位移的概念，以及频率与磁场的正比关系，都是该领域中标准且正确的概念。所提供的数值对于现代高场核磁共振谱仪是符合实际的。\n-   **良态问题**：该问题是自洽的，并提供了计算分析物化学位移所需的所有信息。目标陈述清晰，可以确定唯一解。\n-   **客观性**：该问题以精确、定量和客观的语言陈述，没有任何主观或带偏见的措辞。\n\n**步骤3：结论与行动**\n该问题科学上合理，是良态问题且客观。因此，判定为**有效**。将提供解答。\n\n拉莫尔关系指出，原子核的共振频率 $\\nu$ 与外部静磁通密度 $B_{0}$ 的强度成正比，即 $\\nu = \\frac{\\gamma}{2\\pi} B_{0}$，其中 $\\gamma$ 是原子核的旋磁比。化学位移源于原子核周围电子云感应出的局部磁场，这些局部磁场会轻微改变该原子核所感受到的有效磁场。这导致了微小的频率位移。\n\n化学位移 $\\delta$ 定义为这个频率位移 $(\\nu - \\nu_{\\text{ref}})$ 除以参比频率 $\\nu_{\\text{ref}}$ 进行归一化，使其与谱仪的磁场强度无关。参比标准是 TMS，因此 $\\nu_{\\text{ref}} = \\nu_{\\text{TMS}}$。按照惯例，这个无量纲的比率乘以 $10^{6}$，并以百万分率（ppm）表示。\n\n$$ \\delta = \\frac{\\nu - \\nu_{\\text{TMS}}}{\\nu_{\\text{TMS}}} \\times 10^{6} $$\n\n目标是求出分析物的化学位移 $\\delta_{\\text{analyte}}$。\n\n首先，我们确定在特定实验条件下残留溶剂峰的实际化学位移 $\\delta_{s}^{\\text{actual}}$。它等于其列表值 $\\delta_{s}^{\\text{tab}}$ 与扰动量 $\\Delta \\delta_{s}$ 之和。\n$$ \\delta_{s}^{\\text{actual}} = \\delta_{s}^{\\text{tab}} + \\Delta \\delta_{s} $$\n\n接下来，我们推导分析物化学位移 $\\delta_{\\text{analyte}}$ 的表达式。根据定义：\n$$ \\delta_{\\text{analyte}} = \\frac{\\nu_{\\text{analyte}} - \\nu_{\\text{TMS}}}{\\nu_{\\text{TMS}}} \\times 10^{6} $$\n其中 $\\nu_{\\text{analyte}}$ 是分析物的绝对共振频率。\n\n已知分析物的共振频率相对于溶剂的共振频率 $\\nu_{s}$ 有一个偏移量 $\\Delta \\nu$：\n$$ \\nu_{\\text{analyte}} = \\nu_{s} + \\Delta \\nu $$\n\n将此代入 $\\delta_{\\text{analyte}}$ 的表达式中：\n$$ \\delta_{\\text{analyte}} = \\frac{(\\nu_{s} + \\Delta \\nu) - \\nu_{\\text{TMS}}}{\\nu_{\\text{TMS}}} \\times 10^{6} $$\n这可以分成两项：\n$$ \\delta_{\\text{analyte}} = \\frac{\\nu_{s} - \\nu_{\\text{TMS}}}{\\nu_{\\text{TMS}}} \\times 10^{6} + \\frac{\\Delta \\nu}{\\nu_{\\text{TMS}}} \\times 10^{6} $$\n根据定义，第一项是溶剂的化学位移 $\\delta_{s}^{\\text{actual}}$。因此，分析物化学位移的表达式变为：\n$$ \\delta_{\\text{analyte}} = \\delta_{s}^{\\text{actual}} + \\frac{\\Delta \\nu}{\\nu_{\\text{TMS}}} \\times 10^{6} $$\n\n代入 $\\delta_{s}^{\\text{actual}}$ 的表达式，我们得到用给定物理量表示的最终表达式：\n$$ \\delta_{\\text{analyte}} = (\\delta_{s}^{\\text{tab}} + \\Delta \\delta_{s}) + \\frac{\\Delta \\nu}{\\nu_{\\text{TMS}}} \\times 10^{6} $$\n\n现在，我们对此表达式进行数值计算。\n首先，计算 $\\delta_{s}^{\\text{actual}}$：\n$$ \\delta_{s}^{\\text{actual}} = 7.26 + 0.017 = 7.277 $$\n值 $7.26$ 精确到百分位，而 $0.017$ 精确到千分位。当两项都是已知测量值时，其和的精度受限于小数位数最少的那一项。然而，在这里 $\\Delta \\delta_s$ 是对列表值的扰动。我们保留精度。因此，和为 $7.277$。\n\n接下来，计算由频率偏移 $\\Delta \\nu$ 贡献的化学位移：\n$$ \\frac{\\Delta \\nu}{\\nu_{\\text{TMS}}} \\times 10^{6} = \\frac{1345.0 \\ \\mathrm{Hz}}{500.000 \\times 10^{6} \\ \\mathrm{Hz}} \\times 10^{6} $$\n$10^{6}$ 因子相消：\n$$ \\frac{1345.0}{500.000} = 2.6900 $$\n该计算涉及一个有5位有效数字（$1345.0$）的数除以一个有6位有效数字（$500.000$）的数。结果应报告为5位有效数字，即 $2.6900$。\n\n最后，通过将两个分量相加来计算 $\\delta_{\\text{analyte}}$：\n$$ \\delta_{\\text{analyte}} = 7.277 + 2.6900 $$\n当相加这些值时，结果的精度受限于小数位数最少的项。第一项 $7.277$ 有三位小数。第二项 $2.6900$ 有四位小数。和必须四舍五入到三位小数。\n$$ \\delta_{\\text{analyte}} = 9.9670 $$\n四舍五入到三位小数得到 $9.967$。\n\n题目要求将最终答案四舍五入到四位有效数字。计算出的值 $9.967$ 已经有四位有效数字。因此，无需进一步四舍五入。最终答案是代表化学位移（以 ppm 计）的无量纲值。", "answer": "$$\n\\boxed{9.967}\n$$", "id": "3726725"}, {"introduction": "我们已经了解了如何计算化学位移 $ \\delta $ 值，但为何这一标度被如此广泛地采用？答案在于其不依赖于波谱仪的磁场强度，这使得 $ \\delta $ 成为一个表征分子结构的普适参数。本练习[@problem_id:3726735]为这一核心原理提供了直接的验证，通过分析来自两台不同场强波谱仪的假设数据，您将证明在校正了实验伪影（如外标法引入的磁化率效应）后，以ppm为单位的化学位移是一个恒定的物理量。", "problem": "在质子核磁共振 (NMR) 波谱学中，δ 标度上的化学位移是相对于诸如四甲基硅烷 (TMS) 等参考标准来定义的。假设某待测物的质子共振在两台高场谱仪上进行测量，这两台谱仪对 $^{1}\\text{H}$ 的工作频率分别为 $500.00\\,\\text{MHz}$ 和 $700.00\\,\\text{MHz}$。在每台仪器上，参考物均为一个装有 TMS 的外置毛细管，相对于处于相同磁场环境中的理想内置 TMS 参考，该外置参考会产生体磁化率位移。此磁化率位移与静态磁场 $B_{0}$ 成线性关系。\n\n在 $500.00\\,\\text{MHz}$ 的仪器上，待测物共振信号出现在外置 TMS 信号下游（低场）$11{,}737.990\\,\\text{Hz}$ 的频率偏移处，并且已知在此磁场下，外置 TMS 相对于理想内置 TMS 位于上游（高场）$9.600\\,\\text{Hz}$。在 $700.00\\,\\text{MHz}$ 的仪器上，待测物共振信号出现在外置 TMS 信号下游（低场）$16{,}433.186\\,\\text{Hz}$ 的频率偏移处，并且已知在此磁场下，外置 TMS 相对于理想内置 TMS 位于上游（高场）$13.440\\,\\text{Hz}$。\n\n从拉莫尔关系式 $\\omega=\\gamma B_{0}(1-\\sigma)$（其中 $\\gamma$ 是旋磁比，$\\sigma$ 是核磁屏蔽常数）和化学位移 δ 标度的常规定义出发，推导一个表达式，证明当参考物位移与 $B_{0}$ 成正比时，δ 标度（以百万分率计）与 $B_{0}$ 无关。然后，利用所提供的测量数据，并校正至常规的内置 TMS 参考，计算待测物的化学位移 $\\delta$（以百万分率 ppm 表示）。\n\n将最终数值结果四舍五入至六位有效数字，并以 $\\text{ppm}$ 为单位表示。提供 $\\delta$ 的单个数值。", "solution": "该问题在科学上是合理的、提法明确且客观的。它基于核磁共振 (NMR) 波谱学的既定原理，并提供了一套完整且一致的数据，可得出唯一解。\n\n根据要求，解答分为两部分：推导化学位移 δ 标度的场独立性，以及根据所提供的数据计算待测物的化学位移。\n\n**第 1 部分：场独立性的推导**\n\n化学位移 $\\delta$（单位为百万分率，$\\text{ppm}$）通常是相对于一个理想的内部参考标准（如四甲基硅烷，TMS）来定义的。其公式为：\n$$ \\delta = \\frac{\\nu_{sample} - \\nu_{ref,i}}{\\nu_{0}} \\times 10^6 $$\n其中 $\\nu_{sample}$ 是待测物原子核的共振频率，$\\nu_{ref,i}$ 是理想内部参考原子核的共振频率，$\\nu_{0}$ 是谱仪的工作频率。\n\n原子核的共振频率 $\\nu$ 由拉莫尔关系式 $\\omega = 2\\pi\\nu = \\gamma B_{eff}$ 给出，其中 $\\gamma$ 是旋磁比，$B_{eff}$ 是原子核感受到的有效磁场。这个有效磁场是外加静态磁场 $B_0$ 减去由局部电子环境产生的屏蔽效应：$B_{eff} = B_0(1-\\sigma)$，其中 $\\sigma$ 是屏蔽常数。用频率表示的拉莫尔关系式为：\n$$ \\nu = \\frac{\\gamma B_{0}(1-\\sigma)}{2\\pi} $$\n谱仪的工作频率 $\\nu_0$ 与静态磁场 $B_0$ 成正比。我们可以写成 $\\nu_0 = K B_0$，其中 $K$ 是一个与所观测原子核相关的常数（对于 ${}^{1}\\text{H}$，$K \\approx \\frac{\\gamma_{{}^{1}\\text{H}}}{2\\pi}$）。\n\n使用拉莫尔关系式，$\\delta$ 表达式分子中的频率差为：\n$$ \\nu_{sample} - \\nu_{ref,i} = \\frac{\\gamma B_{0}(1-\\sigma_{sample})}{2\\pi} - \\frac{\\gamma B_{0}(1-\\sigma_{ref,i})}{2\\pi} = \\frac{\\gamma B_{0}}{2\\pi}(\\sigma_{ref,i} - \\sigma_{sample}) $$\n这个以赫兹（$\\text{Hz}$）为单位的频率差与 $B_0$ 成正比。\n\n将此式代入 $\\delta$ 的定义中：\n$$ \\delta = \\frac{\\frac{\\gamma B_{0}}{2\\pi}(\\sigma_{ref,i} - \\sigma_{sample})}{K B_0} \\times 10^6 $$\n由于 $K \\approx \\frac{\\gamma}{2\\pi}$，涉及 $B_0$ 和 $\\gamma$ 的项相互抵消，剩下：\n$$ \\delta \\approx (\\sigma_{ref,i} - \\sigma_{sample}) \\times 10^6 $$\n这表明化学位移 $\\delta$ 仅是屏蔽常数的函数，因此与外加磁场 $B_0$ 无关。\n\n现在，我们将此推广到使用外置参考且存在磁化率引起的位移的情况。\n设 $\\nu_{ref,e}$ 为外置参考的观测频率。\n问题指出，观测到待测物共振信号在外部 TMS 的低场方向有频率偏移 $\\Delta\\nu_{obs}$。“低场”意味着频率更高，因此：\n$$ \\Delta\\nu_{obs} = \\nu_{sample} - \\nu_{ref,e} > 0 $$\n问题还指出，外置 TMS 相对于理想内置 TMS 位于高场。“高场”意味着频率更低，即 $\\nu_{ref,e}  \\nu_{ref,i}$。由该位移引起的频率差为：\n$$ \\Delta\\nu_{corr} = \\nu_{ref,i} - \\nu_{ref,e} > 0 $$\n计算化学位移所需的真实频率差是 $\\nu_{sample} - \\nu_{ref,i}$。我们可以用观测到的量来表示它：\n$$ \\nu_{sample} - \\nu_{ref,i} = (\\nu_{sample} - \\nu_{ref,e}) - (\\nu_{ref,i} - \\nu_{ref,e}) = \\Delta\\nu_{obs} - \\Delta\\nu_{corr} $$\n问题指出，磁化率位移与 $B_0$ 成线性关系。这意味着频率位移 $\\Delta\\nu_{corr}$ 与 $B_0$ 成正比，因此也与谱仪频率 $\\nu_0$ 成正比。我们可以将其写为 $\\Delta\\nu_{corr} = c \\cdot \\nu_0$，其中 $c$ 是一个无量纲的比例常数。\n\n真实的化学位移 $\\delta$（一个与场无关的量）将真实的频率差与谱仪频率关联起来：\n$$ \\nu_{sample} - \\nu_{ref,i} = \\delta \\cdot \\nu_0 \\cdot 10^{-6} $$\n将我们的表达式代入此方程：\n$$ \\Delta\\nu_{obs} - \\Delta\\nu_{corr} = \\delta \\cdot \\nu_0 \\cdot 10^{-6} $$\n用 $c \\cdot \\nu_0$ 替换 $\\Delta\\nu_{corr}$：\n$$ \\Delta\\nu_{obs} - c \\cdot \\nu_0 = \\delta \\cdot \\nu_0 \\cdot 10^{-6} $$\n$$ \\Delta\\nu_{obs} = (\\delta \\cdot 10^{-6} + c) \\cdot \\nu_0 $$\n这表明观测到的频率偏移 $\\Delta\\nu_{obs}$ 也与谱仪频率 $\\nu_0$ 成正比。\n\n为了从实验测量中计算真实的化学位移 $\\delta$，我们使用以下公式：\n$$ \\delta_{calc} = \\frac{\\Delta\\nu_{obs} - \\Delta\\nu_{corr}}{\\nu_{0}} \\times 10^6 $$\n代入关系式 $\\Delta\\nu_{obs} = (\\delta \\cdot 10^{-6} + c) \\cdot \\nu_0$ 和 $\\Delta\\nu_{corr} = c \\cdot \\nu_0$：\n$$ \\delta_{calc} = \\frac{(\\delta \\cdot 10^{-6} + c) \\cdot \\nu_0 - c \\cdot \\nu_0}{\\nu_{0}} \\times 10^6 = \\frac{\\delta \\cdot 10^{-6} \\cdot \\nu_0}{\\nu_{0}} \\times 10^6 = \\delta $$\n至此，推导完成，表明通过磁化率位移（与 $B_0$ 成正比）校正观测到的频率位移后，可以得到真实的、与场无关的化学位移 $\\delta$。\n\n**第 2 部分：计算待测物的化学位移**\n\n我们有来自两台不同谱仪的两组数据。我们将分别计算化学位移以验证其一致性。\n\n对于第一台谱仪：\n- 谱仪频率：$\\nu_{0,1} = 500.00 \\, \\text{MHz} = 500.00 \\times 10^6 \\, \\text{Hz}$\n- 观测到的待测物偏移：$\\Delta\\nu_{obs,1} = 11737.990 \\, \\text{Hz}$\n- 外置 TMS 位移校正：$\\Delta\\nu_{corr,1} = 9.600 \\, \\text{Hz}$\n\n真实的频率位移 $\\Delta\\nu_{true,1}$ 是：\n$$ \\Delta\\nu_{true,1} = \\Delta\\nu_{obs,1} - \\Delta\\nu_{corr,1} = 11737.990 \\, \\text{Hz} - 9.600 \\, \\text{Hz} = 11728.390 \\, \\text{Hz} $$\n化学位移 $\\delta_1$ 是：\n$$ \\delta_1 = \\frac{\\Delta\\nu_{true,1}}{\\nu_{0,1}} \\times 10^6 = \\frac{11728.390 \\, \\text{Hz}}{500.00 \\times 10^6 \\, \\text{Hz}} \\times 10^6 = \\frac{11728.390}{500.00} = 23.45678 \\, \\text{ppm} $$\n\n对于第二台谱仪：\n- 谱仪频率：$\\nu_{0,2} = 700.00 \\, \\text{MHz} = 700.00 \\times 10^6 \\, \\text{Hz}$\n- 观测到的待测物偏移：$\\Delta\\nu_{obs,2} = 16433.186 \\, \\text{Hz}$\n- 外置 TMS 位移校正：$\\Delta\\nu_{corr,2} = 13.440 \\, \\text{Hz}$\n\n真实的频率位移 $\\Delta\\nu_{true,2}$ 是：\n$$ \\Delta\\nu_{true,2} = \\Delta\\nu_{obs,2} - \\Delta\\nu_{corr,2} = 16433.186 \\, \\text{Hz} - 13.440 \\, \\text{Hz} = 16419.746 \\, \\text{Hz} $$\n化学位移 $\\delta_2$ 是：\n$$ \\delta_2 = \\frac{\\Delta\\nu_{true,2}}{\\nu_{0,2}} \\times 10^6 = \\frac{16419.746 \\, \\text{Hz}}{700.00 \\times 10^6 \\, \\text{Hz}} \\times 10^6 = \\frac{16419.746}{700.00} = 23.45678 \\, \\text{ppm} $$\n\n两次计算都得出了相同的结果 $\\delta = 23.45678 \\, \\text{ppm}$，这证实了正确参比的化学位移具有场独立性。问题要求将最终答案四舍五入到六位有效数字。第六位有效数字是 $7$，其后一位是 $8$，所以我们向上取整。\n\n最终值：$\\delta = 23.4568 \\, \\text{ppm}$。", "answer": "$$\n\\boxed{23.4568}\n$$", "id": "3726735"}, {"introduction": "现代核磁共振是一项数字技术，我们最终看到的谱图是原始时域信号经过复杂数字处理后的产物。此过程中的选择会影响最终化学位移测量的准确性。这项高级练习[@problem_id:3726733]将带您深入了解“幕后”细节，通过模拟从自由感应衰减（FID）到最终谱图的完整流程，探究加窗函数、相位和零填充等处理步骤如何影响表观峰位，并最终导致化学位移的计算误差。这个计算练习能够让您对测量精度的来源有更深刻的理解。", "problem": "您需要实现一个完整的、可运行的程序，该程序模拟核磁共振 (NMR) 波谱法中的数字信号处理如何影响表观峰位，并因此影响在使用标准品进行参照时，在 $\\delta$ 标度上计算出的化学位移。该研究必须基于第一性原理，具体包括：$\\delta$ 标度上化学位移的定义、时域自由感应衰减 (FID) 的傅里叶分析、离散时间采样约束，以及参考标准在构建频率原点中的作用。\n\n$\\delta$ 标度上的化学位移是一个无量纲的量，定义为共振频率相对于参考标准的差异，并由所观测原子核的工作频率进行归一化。对于在相同磁场下为相同原子核测量的样品共振频率 $\\nu_{\\text{sample}}$ 和参考共振频率 $\\nu_{\\text{ref}}$，化学位移 $\\delta$（单位为百万分率）定义为\n$$\n\\delta \\equiv \\frac{\\nu_{\\text{sample}} - \\nu_{\\text{ref}}}{\\nu_0} \\times 10^6,\n$$\n其中 $\\nu_0$ 是所观测原子核的波谱仪频率（例如，$^{1}\\mathrm{H}$ 在 $\\nu_0 = 400\\ \\mathrm{MHz}$）。参考化合物通常是四甲基硅烷 (TMS)，对于 $^{1}\\mathrm{H}$ 和 $^{13}\\mathrm{C}$，其化学位移定义为 $\\delta = 0$。\n\n您将模拟一个单共振 $^{1}\\mathrm{H}$ NMR 在时域中的 FID，使用不同的窗函数和相位条件对其进行处理，计算离散傅里叶变换，检测表观峰值频率，并使用上述定义将其转换为化学位移。您的模拟和分析必须遵循以下基本原则：\n\n- 时域检测产生的 FID 可建模为一个阻尼复指数函数，其横向弛豫由衰减时间 $T_2$ 表征。该信号可通用地写为 $s(t) = e^{-t/T_2} e^{i(2\\pi f_0 t + \\phi_0)}$，其中 $f_0$ 是相对于所选参考原点的基带共振频率，$\\phi_0$ 是一个零阶相位误差。\n- 使用驻留时间 $\\Delta t$ 和 $N$ 个点进行离散时间采样，得到采集时间 $T = N \\Delta t$ 和名义上的频率点间距 $\\Delta \\nu = 1/T$。补零操作会增加频率点的数量，但不会提高真实分辨率。\n- 时域切趾通过将 $s(t)$ 乘以一个窗函数 $w(t)$（例如指数窗或高斯窗），从而通过频域中的卷积来改变线宽和线型。\n- 定标设置原点，使得 $\\nu_{\\text{ref}}$ 定义了 $\\delta = 0$。如果定标错误 $\\Delta \\nu_{\\text{ref}}$，意味着使用的参考频率为 $\\nu_{\\text{ref,used}} = \\nu_{\\text{ref,true}} + \\Delta \\nu_{\\text{ref}}$，这会影响计算出的化学位移。\n\n您的程序必须为每个测试用例实现以下步骤：\n1. 根据提供的真实化学位移 $\\delta_{\\text{true}}$ 和 $\\nu_0$，通过 $f_0 = \\nu_0 \\delta_{\\text{true}} / 10^6$ 计算出真实的基带共振频率 $f_0$（单位：赫兹），假设数字原点由 $\\nu_{\\text{ref,true}}$ 设定。\n2. 使用指定的 $T_2$、$f_0$ 和 $\\phi_0$，在 $t_k = k \\Delta t$（其中 $k = 0,1,\\dots,N-1$）上构建 FID $s(t)$。\n3. 应用指定的窗函数 $w(t)$（选项：无、带参数 $\\tau$ 的指数窗 $w(t) = e^{-t/\\tau}$，或带参数 $\\sigma$ 的高斯窗 $w(t) = e^{-(t/\\sigma)^2}$）。\n4. 通过填充零点至 $N_{\\mathrm{zf}} = \\mathrm{zf\\_factor} \\times N$ 个点来进行补零。\n5. 计算离散傅里叶变换及其频率轴（单位：赫兹），然后根据测试用例，选择谱振幅为实部或模。\n6. 检测最大峰值点，并使用对其最大值及其相邻点的简单抛物线插值来估计亚点峰位，从而精修峰值频率。如果最大值位于边缘，则跳过插值以优雅地处理边界点。\n7. 使用 $\\delta_{\\text{meas}} = [(f_{\\text{peak}} - \\Delta \\nu_{\\text{ref}})/\\nu_0] \\times 10^6$ 将测得的峰值频率 $f_{\\text{peak}}$ 转换为表观化学位移（单位：百万分率），其中 $\\Delta \\nu_{\\text{ref}}$ 是提供的定标错误（单位：赫兹）（对于正确定标的情况，使用 $\\Delta \\nu_{\\text{ref}} = 0$）。\n8. 为每个测试用例返回计算出的 $\\delta_{\\text{meas}}$，作为浮点数。\n\n物理单位：\n- 频率 $\\nu_0$、$f_0$ 和 $\\Delta \\nu_{\\text{ref}}$ 必须以赫兹（$\\mathrm{Hz}$）为单位处理。\n- 时间参数 $\\Delta t$、$T_2$、$\\tau$ 和 $\\sigma$ 必须以秒（$\\mathrm{s}$）为单位处理。\n- 所有化学位移 $\\delta$ 必须以百万分率 (ppm) 的十进制浮点数表示。\n\n角度单位：\n- 相位（如 $\\phi_0$）必须以弧度为单位。\n\n测试套件：\n在您的程序中提供以下测试用例列表。每个用例是一个参数元组 ($\\nu_0$, $\\delta_{\\text{true}}$, $N$, $\\Delta t$, $T_2$, $\\phi_0$, `window_type`, `window_param`, `zf_factor`, `amplitude_mode`, $\\Delta \\nu_{\\text{ref}}$)。请严格使用以下值：\n- 情况 A (理想情况)：$\\nu_0 = 400\\times 10^6$, $\\delta_{\\text{true}} = 4.700$, $N = 8192$, $\\Delta t = 1.25\\times 10^{-4}$, $T_2 = 0.5$, $\\phi_0 = 0.0$, 窗函数为 `none`，参数为 $0.0$, `zf_factor` = 1, 振幅模式为 `real`, $\\Delta \\nu_{\\text{ref}} = 0.0$。\n- 情况 B (指数切趾)：$\\nu_0 = 400\\times 10^6$, $\\delta_{\\text{true}} = 4.700$, $N = 8192$, $\\Delta t = 1.25\\times 10^{-4}$, $T_2 = 0.5$, $\\phi_0 = 0.0$, 窗函数为 `exponential`，参数为 $\\tau = 0.2$, `zf_factor` = 1, 振幅模式为 `real`, $\\Delta \\nu_{\\text{ref}} = 0.0$。\n- 情况 C (相位引起的线型混合)：$\\nu_0 = 400\\times 10^6$, $\\delta_{\\text{true}} = 4.700$, $N = 8192$, $\\Delta t = 1.25\\times 10^{-4}$, $T_2 = 0.5$, $\\phi_0 = \\pi/3$, 窗函数为 `none`，参数为 $0.0$, `zf_factor` = 1, 振幅模式为 `real`, $\\Delta \\nu_{\\text{ref}} = 0.0$。\n- 情况 D (补零)：$\\nu_0 = 400\\times 10^6$, $\\delta_{\\text{true}} = 4.700$, $N = 8192$, $\\Delta t = 1.25\\times 10^{-4}$, $T_2 = 0.5$, $\\phi_0 = 0.0$, 窗函数为 `none`，参数为 $0.0$, `zf_factor` = 4, 振幅模式为 `real`, $\\Delta \\nu_{\\text{ref}} = 0.0$。\n- 情况 E (10赫兹的定标错误)：$\\nu_0 = 400\\times 10^6$, $\\delta_{\\text{true}} = 4.700$, $N = 8192$, $\\Delta t = 1.25\\times 10^{-4}$, $T_2 = 0.5$, $\\phi_0 = 0.0$, 窗函数为 `none`，参数为 $0.0$, `zf_factor` = 1, 振幅模式为 `real`, $\\Delta \\nu_{\\text{ref}} = +10.0$。\n- 情况 F (靠近边界)：$\\nu_0 = 400\\times 10^6$, $\\delta_{\\text{true}} = 9.900$, $N = 8192$, $\\Delta t = 1.25\\times 10^{-4}$, $T_2 = 0.5$, $\\phi_0 = 0.0$, 窗函数为 `none`，参数为 $0.0$, `zf_factor` = 1, 振幅模式为 `real`, $\\Delta \\nu_{\\text{ref}} = 0.0$。\n\n答案规格：\n- 对于每个测试用例，计算并返回测得的化学位移 $\\delta_{\\text{meas}}$（单位：百万分率），作为十进制浮点数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的结果列表（例如，`[result1,result2,result3]`）。\n\n您的实现必须是完全自包含的，不需要任何输入，并且必须严格遵守最终答案标签中定义的执行环境。", "solution": "目标是量化核磁共振 (NMR) 波谱法中的数字信号处理操作如何影响表观峰值频率，并因此影响基于定义和傅里叶分析的 $\\delta$ 标度上的化学位移。\n\n我们从化学位移的基本定义开始。对于单个 $^{1}\\mathrm{H}$ 共振，化学位移 $\\delta$（单位为百万分率）定义为\n$$\n\\delta = \\frac{\\nu_{\\text{sample}} - \\nu_{\\text{ref}}}{\\nu_0} \\times 10^6,\n$$\n其中 $\\nu_{\\text{sample}}$ 是样品的共振频率，$\\nu_{\\text{ref}}$ 是在相同磁场下的参考标准（例如，四甲基硅烷 (TMS)）的共振频率，而 $\\nu_0$ 是该原子核的波谱仪频率。此定义是 $\\delta$ 标度的基础，并确保了跨仪器测量的无量纲归一化。\n\n在 NMR 实验中，自由感应衰减 (FID) 在时域中被记录。对于具有横向弛豫时间 $T_2$、零阶相位 $\\phi_0$ 和相对于参考原点的基带共振频率 $f_0$ 的单个共振，我们将其 FID 建模为\n$$\ns(t) = e^{-t/T_2} e^{i(2\\pi f_0 t + \\phi_0)},\n$$\n该模型源于进动的磁化强度呈指数衰减，并在正交检测中产生一个复数信号。使用驻留时间 $\\Delta t$ 在 $N$ 个点上进行离散时间采样，得到采样时间 $t_k = k \\Delta t$，其中 $k = 0,1,\\dots,N-1$。采集时间为 $T = N \\Delta t$，名义上的频率点间距为 $\\Delta \\nu = 1/T$。补零操作将离散傅里叶变换中的点数增加到 $N_{\\mathrm{zf}} = \\mathrm{zf\\_factor} \\times N$，从而在频率上提供更密集的采样点，但并不改变真实的物理分辨率。\n\n诸如切趾之类的信号处理操作通过将 FID 乘以一个窗函数 $w(t)$ 来建模。我们考虑：\n- 指数切趾：$w(t) = e^{-t/\\tau}$，通过卷积加宽频域线型，从而增加有效线宽。\n- 高斯切趾：$w(t) = e^{-(t/\\sigma)^2}$，产生近似高斯展宽。\n\n时域中的乘法对应于频域中的卷积。对于孤立的、对称的共振谱线，与对称窗函数的变换进行卷积会保留真实的中心频率。然而，由于数据点离散化、线型失真，尤其是在存在相位误差的情况下使用实部谱时（这会混合吸收和色散分量），离散谱上的峰值最大值可能不会与真实中心完全重合。具体来说，$s(t)$ 的傅里叶变换产生一个复数谱 $S(\\nu)$。一个非零的 $\\phi_0$ 会使波谱发生旋转，因此其实部成为吸收型洛伦兹分量和色散型分量的线性组合。由于色散分量关于真实共振频率是反对称的，将其混入实部会引起不对称性，并可能使实部最大值的位置偏离真实中心，即使真实共振频率未变。此现象展示了信号处理如何影响寻峰，进而影响化学位移的确定。\n\n要从模拟数据计算表观化学位移：\n1.  根据 $\\delta$ 的定义，假设数字原点等于 $\\nu_{\\text{ref,true}}$，计算 $f_0 = \\nu_0 \\delta_{\\text{true}}/10^6$。\n2.  生成离散 FID，即 $s_k = e^{-t_k/T_2} e^{i(2\\pi f_0 t_k + \\phi_0)}$。\n3.  应用所选窗函数：无、带参数 $\\tau$ 的指数窗或带参数 $\\sigma$ 的高斯窗。\n4.  通过填充零点以达到 $N_{\\mathrm{zf}}$ 个点来进行补零。\n5.  使用采样定理计算离散傅里叶变换并构建频率轴（单位：赫兹）。将其移位以使零频率居中，便于直观检查。\n6.  根据振幅模式，选择 $\\Re\\{S(\\nu)\\}$ 或 $|S(\\nu)|$ 来进行峰检测。在 $\\phi_0 \\neq 0$ 的条件下选择实部可以说明相位引起的表观位移。\n7.  找到最大峰值点的索引 $i_{\\max}$。如果 $i_{\\max}$ 不在边界处，则通过对三点邻域进行二次插值来精修峰值频率。对于均匀的频率点间距 $\\Delta f$ 和在点 $i_{\\max}-1, i_{\\max}, i_{\\max}+1$ 处的振幅 $y_{-1}, y_0, y_{+1}$，最大化拟合抛物线的亚点偏移 $\\delta i$ 满足\n$$\n\\delta i = \\frac{1}{2}\\,\\frac{y_{-1} - y_{+1}}{y_{-1} - 2y_0 + y_{+1}},\n$$\n只要分母不为零，插值后的峰值频率即为 $f_{\\text{peak}} = f_{i_{\\max}} + \\delta i \\Delta f$。\n8.  通过以下公式将 $f_{\\text{peak}}$ 转换为表观化学位移（单位：百万分率）：\n$$\n\\delta_{\\text{meas}} = \\frac{f_{\\text{peak}} - \\Delta \\nu_{\\text{ref}}}{\\nu_0} \\times 10^6,\n$$\n其中 $\\Delta \\nu_{\\text{ref}}$ 代表定标错误（正的 $\\Delta \\nu_{\\text{ref}}$ 意味着使用的参考频率高于真实参考频率，因此计算出的 $\\delta$ 会减小）。\n\n此过程将寻峰结果与化学位移的物理定义直接联系起来，并阐释了加窗、相位、补零、数据点离散化和定标如何影响 $\\delta$。测试套件涵盖：\n- 一个无窗函数且零相位的条件良好的情况（情况 A）。\n- 指数切趾，它会加宽谱线，但不应改变真实中心位置（情况 B）。\n- 非零相位下的实部寻峰，这会混合色散分量并可能移动表观最大值（情况 C）。\n- 补零以通过更密集的采样来减轻数据点离散化带来的粗糙度（情况 D）。\n- 定标偏移以展示 $\\delta$ 中的系统性偏差（情况 E）。\n- 一个靠近谱窗边界的共振，以探究数据点离散化和边缘行为（情况 F）。\n\n每个情况的输出是 $\\delta_{\\text{meas}}$（单位：百万分率），以一个用方括号括起来的逗号分隔列表的形式打印，满足规定的单位要求，并提供与化学位移 $\\delta$ 标度和参考标准在真实信号处理条件下的高等研究生水平探究相符的可量化浮点结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef simulate_fid(n_points, dt, f0_hz, T2_s, phase0_rad, window_type, window_param, zf_factor):\n    \"\"\"\n    Simulate a single-resonance complex FID:\n    s(t) = exp(-t/T2) * exp(i*(2*pi*f0*t + phase0)).\n    Apply optional windowing and zero-filling.\n    \"\"\"\n    t = np.arange(n_points, dtype=np.float64) * dt\n    fid = np.exp(-t / T2_s) * np.exp(1j * (2.0 * np.pi * f0_hz * t + phase0_rad))\n\n    # Apply window\n    if window_type == 'none':\n        pass  # no change\n    elif window_type == 'exponential':\n        tau = float(window_param)\n        if tau  0.0:\n            fid = fid * np.exp(-t / tau)\n    elif window_type == 'gaussian':\n        sigma = float(window_param)\n        if sigma  0.0:\n            fid = fid * np.exp(-(t / sigma) ** 2)\n    else:\n        # Unknown window; do nothing\n        pass\n\n    # Zero-filling\n    zf_factor = int(zf_factor)\n    if zf_factor  1:\n        pad_len = n_points * (zf_factor - 1)\n        fid = np.pad(fid, (0, pad_len), mode='constant', constant_values=0.0)\n\n    return fid\n\ndef spectrum_and_frequency(fid, dt):\n    \"\"\"\n    Compute FFT spectrum (shifted) and corresponding frequency axis in Hz.\n    \"\"\"\n    n = fid.shape[0]\n    spec = np.fft.fftshift(np.fft.fft(fid))\n    freqs = np.fft.fftshift(np.fft.fftfreq(n, d=dt))\n    return spec, freqs\n\ndef peak_pick(freqs, spectrum, mode='real'):\n    \"\"\"\n    Peak picking with optional parabolic interpolation.\n    mode: 'real' uses real part, 'magnitude' uses absolute value.\n    Returns interpolated peak frequency in Hz.\n    \"\"\"\n    if mode == 'real':\n        amp = np.real(spectrum)\n    else:\n        amp = np.abs(spectrum)\n\n    # Find maximum bin\n    i_max = int(np.argmax(amp))\n    f_peak = freqs[i_max]\n\n    # Parabolic interpolation using neighbors if available\n    if 0   i_max  (len(amp) - 1):\n        y_m1 = amp[i_max - 1]\n        y_0 = amp[i_max]\n        y_p1 = amp[i_max + 1]\n        denom = (y_m1 - 2.0 * y_0 + y_p1)\n        if denom != 0.0:\n            delta_i = 0.5 * (y_m1 - y_p1) / denom\n            # frequency step is uniform\n            df = freqs[1] - freqs[0]\n            f_peak = f_peak + delta_i * df\n\n    return f_peak\n\ndef compute_delta_meas(nu0_hz, delta_true_ppm, n_points, dt, T2_s, phase0_rad,\n                       window_type, window_param, zf_factor, amplitude_mode, ref_offset_hz):\n    \"\"\"\n    Compute apparent chemical shift delta_meas (ppm) given simulation and processing parameters.\n    \"\"\"\n    # True baseband resonance frequency relative to true reference origin\n    f0_hz = nu0_hz * (delta_true_ppm / 1.0e6)\n\n    # Simulate FID with windowing and zero-filling\n    fid = simulate_fid(n_points, dt, f0_hz, T2_s, phase0_rad, window_type, window_param, zf_factor)\n\n    # Compute spectrum and frequency axis\n    spec, freqs = spectrum_and_frequency(fid, dt)\n\n    # Peak picking\n    f_peak_hz = peak_pick(freqs, spec, mode=amplitude_mode)\n\n    # Apply misreference offset: used reference = true reference + ref_offset_hz\n    # delta_meas = ((f_peak - ref_offset_hz) / nu0) * 1e6\n    delta_meas_ppm = ((f_peak_hz - ref_offset_hz) / nu0_hz) * 1.0e6\n\n    return delta_meas_ppm\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple: (nu0_hz, delta_true_ppm, N, dt, T2, phi0, window_type, window_param, zf_factor, amplitude_mode, ref_offset_hz)\n    test_cases = [\n        (400e6, 4.700, 8192, 1.25e-4, 0.5, 0.0, 'none', 0.0, 1, 'real', 0.0),       # Case A\n        (400e6, 4.700, 8192, 1.25e-4, 0.5, 0.0, 'exponential', 0.2, 1, 'real', 0.0),# Case B\n        (400e6, 4.700, 8192, 1.25e-4, 0.5, np.pi/3, 'none', 0.0, 1, 'real', 0.0),   # Case C\n        (400e6, 4.700, 8192, 1.25e-4, 0.5, 0.0, 'none', 0.0, 4, 'real', 0.0),       # Case D\n        (400e6, 4.700, 8192, 1.25e-4, 0.5, 0.0, 'none', 0.0, 1, 'real', 10.0),      # Case E\n        (400e6, 9.900, 8192, 1.25e-4, 0.5, 0.0, 'none', 0.0, 1, 'real', 0.0),       # Case F\n    ]\n\n    results = []\n    for case in test_cases:\n        (nu0_hz, delta_true_ppm, N, dt, T2, phi0, window_type, window_param,\n         zf_factor, amplitude_mode, ref_offset_hz) = case\n\n        delta_meas = compute_delta_meas(\n            nu0_hz=nu0_hz,\n            delta_true_ppm=delta_true_ppm,\n            n_points=N,\n            dt=dt,\n            T2_s=T2,\n            phase0_rad=phi0,\n            window_type=window_type,\n            window_param=window_param,\n            zf_factor=zf_factor,\n            amplitude_mode=amplitude_mode,\n            ref_offset_hz=ref_offset_hz\n        )\n        # Format to a reasonable precision to reflect ppm reporting\n        results.append(f\"{delta_meas:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3726733"}]}