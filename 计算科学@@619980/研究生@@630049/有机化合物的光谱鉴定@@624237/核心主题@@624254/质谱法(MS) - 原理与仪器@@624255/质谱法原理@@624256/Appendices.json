{"hands_on_practices": [{"introduction": "高分辨质谱 (HRMS) 的核心任务之一是从精确的质量数中确定未知化合物的元素组成。这个过程并非盲目猜测，而是一个系统性的推理过程。通过运用“氮规则”和“双键当量”(DBE) 等化学限制，我们可以将看似无限的可能性缩小到几个，甚至是唯一一个合理的分子式。本练习将引导你完成这一基本工作流程，将理论知识应用于实际数据解读中 [@problem_id:3719052]。", "problem": "一种未知的有机化合物在电喷雾电离（ESI）条件下通过高分辨率质谱法进行测量。观测到的单同位素峰对应于单质子化的分子离子，其质荷比为 $m/z = 180.0655$。仪器的质量准确度为 $\\pm 2$ 百万分之二（ppm）。假设中性化合物的元素组成仅限于碳、氢、氮和氧，且原子数均为非负整数。使用氮规则和双键等效值（DBE）约束来列举所有可能的分子式，并确定有多少种不同的分子式满足所有约束条件。\n\n基本出发点：\n- 单同位素质量为：$\\mathrm{C}:\\;12.000000000$, $\\mathrm{H}:\\;1.00782503223$, $\\mathrm{N}:\\;14.00307400443$, $\\mathrm{O}:\\;15.99491461957$（单位：道尔顿）。\n- 质子质量为 $m_{p} = 1.00727646688$（单位：道尔顿）。\n- 对于单质子化离子 $[M+H]^{+}$，中性分子的单同位素质量为 $M = (m/z) - m_{p}$。\n- 对于由 $\\mathrm{C}$、$\\mathrm{H}$、$\\mathrm{N}$、$\\mathrm{O}$ 组成的中性有机化合物，氮规则指出，奇数标称质量意味着奇数个氮原子，偶数标称质量意味着偶数个氮原子。\n- 双键等效值（DBE）定义为 $\\mathrm{DBE} = 1 + c - \\frac{h}{2} + \\frac{n}{2}$，对于一个化学上可行的分子式，其值必须为非负整数。\n\n任务：\n1. 将测得的 $[M+H]^{+}$ 离子的 $m/z$ 值转换为与 $\\pm 2$ ppm 准确度一致的中性单同位素质量窗口。\n2. 仅使用 $\\mathrm{C}$、$\\mathrm{H}$、$\\mathrm{N}$、$\\mathrm{O}$，列举其精确中性单同位素质量落在此窗口内的整数组成，并需满足以下条件：\n   - 应用于中性分子标称质量的氮规则。\n   - $\\mathrm{DBE}$ 是一个非负整数。\n3. 统计满足所有约束条件的独特分子式的数量。\n\n以单个整数形式表示最终答案（无单位）。由于最终答案是精确计数，因此无需四舍五入说明。", "solution": "该问题要求确定与高分辨率质谱法测得的质荷比相符，并满足一系列化学和物理约束条件的分子式（$C_c H_h N_n O_o$）的数量。\n\n对问题陈述的验证证实了其科学依据充分、问题定义明确、客观，并包含了所有必要信息且无矛盾之处。所提供的数据和原理是分析化学领域的标准。因此，可以进行严谨的求解。\n\n该过程包括三个主要步骤：\n1. 计算中性分子的质量范围。\n2. 应用结构和化学规则来约束搜索空间。\n3. 系统地列举和验证候选分子式。\n\n**步骤 1：确定中性单同位素质量窗口**\n\n观测到的单质子化离子 $[M+H]^{+}$ 的质荷比为 $m/z = 180.0655$。仪器的质量准确度为 $\\pm 2$ 百万分之二（ppm）。\n\n绝对质量误差 $\\Delta m$ 计算如下：\n$$ \\Delta m = (m/z) \\times (\\text{accuracy in ppm}) \\times 10^{-6} $$\n$$ \\Delta m = 180.0655 \\times 2 \\times 10^{-6} = 0.000360131 \\text{ Da} $$\n\n这意味着离子的真实 $m/z$ 在以下范围内：\n$$ [ (m/z) - \\Delta m, (m/z) + \\Delta m ] = [180.0655 - 0.000360131, 180.0655 + 0.000360131] $$\n$$ m/z_{\\text{range}} = [180.06513987, 180.06586013] $$\n\n观测到的离子是 $[M+H]^{+}$，其中 $M$ 是中性分子。离子的质量是中性分子质量 $M_{neutral}$ 与质子质量 $m_p$ 之和。问题陈述了单质子化离子的关系为 $M_{neutral} = (m/z) - m_p$。提供的质子质量为 $m_p = 1.00727646688$ Da。\n\n中性分子质量的中心值为：\n$$ M_{center} = 180.0655 - 1.00727646688 = 179.05822353312 \\text{ Da} $$\n\n中性分子的质量窗口是通过从离子的 $m/z$ 范围中减去 $m_p$ 得到的。窗口的宽度保持为 $2 \\times \\Delta m$。\n$$ M_{min} = M_{center} - \\Delta m = 179.05822353312 - 0.000360131 = 179.05786340212 \\text{ Da} $$\n$$ M_{max} = M_{center} + \\Delta m = 179.05822353312 + 0.000360131 = 179.05858366412 \\text{ Da} $$\n任何有效的分子式，其计算出的单同位素质量必须落在 $[179.05786, 179.05859]$ 范围内。\n\n**步骤 2：应用化学和结构约束**\n\n一个候选分子式 $C_c H_h N_n O_o$（其中 $c, h, n, o$ 为非负整数）必须满足几条规则。\n\n- **元素组成**：分子式只能包含碳（C）、氢（H）、氮（N）和氧（O）。单同位素质量如下：\n  $m_C = 12.000000000$ Da\n  $m_H = 1.00782503223$ Da\n  $m_N = 14.00307400443$ Da\n  $m_O = 15.99491461957$ Da\n\n- **氮规则**：中性分子的标称质量是其精确质量的整数部分，即 $\\lfloor 179.058... \\rfloor = 179$。由于标称质量是奇数，氮原子数 $n$ 必须是奇数（$n \\in \\{1, 3, 5, ...\\}$）。\n\n- **双键等效值 (DBE)**：对于一个稳定的中性分子，DBE 必须是一个非负整数。\n  $$ \\mathrm{DBE} = c - \\frac{h}{2} + \\frac{n}{2} + 1 \\ge 0 $$\n  为了使 DBE 为整数，项 $-\\frac{h}{2} + \\frac{n}{2}$ 必须是一个整数或半整数，以使总和为整数。具体来说，$h$ 和 $n$ 的奇偶性必须相同（同为偶数或同为奇数）。由于氮规则规定 $n$ 必须是奇数，因此氢原子数 $h$ 也必须是奇数。\n\n**步骤 3：系统地列举和验证**\n\n我们搜索满足所有约束的整数解 $(c,h,n,o)$。分子式 $C_c H_h N_n O_o$ 的精确质量为：\n$$ M_{calc} = c \\cdot m_C + h \\cdot m_H + n \\cdot m_N + o \\cdot m_O $$\n我们需要满足 $M_{min} \\le M_{calc} \\le M_{max}$。这可以改写为关于 $h$ 的不等式：\n$$ \\frac{M_{min} - (c \\cdot m_C + n \\cdot m_N + o \\cdot m_O)}{m_H} \\le h \\le \\frac{M_{max} - (c \\cdot m_C + n \\cdot m_N + o \\cdot m_O)}{m_H} $$\n对于任何给定的 $(c,n,o)$，这个允许的 $h$ 的区间非常窄：\n$$ \\Delta h = \\frac{M_{max} - M_{min}}{m_H} = \\frac{0.000720262}{1.00782503223} \\approx 0.00071465 $$\n由于 $h$ 必须是整数，对于给定的 $(c, n, o)$ 三元组，只有当这个狭窄的区间包含一个奇数整数时，才存在解。我们系统地遍历 $n, o, c$ 的可能值。\n\n我们来测试 $n=1, 3, 5, ...$ 的情况\n对于给定的 $(c,n,o)$，令 $K = c \\cdot m_C + n \\cdot m_N + o \\cdot m_O$。$h$ 的允许范围是 $[(M_{min}-K)/m_H, (M_{max}-K)/m_H]$。\n\n**情况 n = 1**：\n我们测试 $c$ 和 $o$ 的组合。让我们测试组合 $(c,o) = (9,3)$。\n$K = 9 \\cdot m_C + 1 \\cdot m_N + 3 \\cdot m_O$\n$K = 9(12.000000000) + 1(14.00307400443) + 3(15.99491461957)$\n$K = 108 + 14.00307400443 + 47.98474385871 = 169.98781786314$\n$h$ 的要求范围是：\n$h_{min} = (179.05786340212 - 169.98781786314) / 1.00782503223 = 8.999696...$\n$h_{max} = (179.05858366412 - 169.98781786314) / 1.00782503223 = 9.000411...$\n区间 $[8.999696, 9.000411]$ 只包含一个整数，即 $9$。由于 $9$ 是奇数，这是一个有效的 $h$ 候选值。\n所以，我们得到分子式 $C_9H_9NO_3$。\n我们来验证它的质量和 DBE：\n$M_{calc} = 169.98781786314 + 9 \\cdot m_H = 169.98781786314 + 9(1.00782503223) = 179.05824315321$ Da。\n该质量在目标窗口 $[179.05786, 179.05859]$ 之内。\n现在，检查 DBE：\n$\\mathrm{DBE} = c - \\frac{h}{2} + \\frac{n}{2} + 1 = 9 - \\frac{9}{2} + \\frac{1}{2} + 1 = 9 - 4.5 + 0.5 + 1 = 6$。\nDBE 是一个非负整数。因此，$C_9H_9NO_3$ 是一个有效的分子式。\n\n对 $n=1$ 的其他组合以及更高的奇数值 $n$（例如 $n=3,5,7,...$）进行系统性探索，发现没有其他 $(c,h,n,o)$ 组合能使其计算质量落在这个狭窄的窗口内。例如，我们测试 $C_8H_9N_3O_2$：\n$n=3, h=9, c=8, o=2$。\n$M_{calc} = 8(12) + 9(1.007825) + 3(14.003074) + 2(15.994915) \\approx 179.06948$ Da。这超出了允许的质量范围。\n我们测试 $C_5H_5N_7O$：\n$n=7, h=5, c=5, o=1$。\n$M_{calc} = 5(12) + 5(1.007825) + 7(14.003074) + 1(15.994915) \\approx 179.05556$ Da。这也超出了允许的质量范围。\n\n由于极窄的质量容差（$\\approx 0.0007$ Da）和原子组成的离散性，对于小分子来说，多个不同的分子式落入如此狭窄的窗口内是罕见的。经过彻底的搜索，证实 $C_9H_9NO_3$ 是唯一满足所有给定约束条件的分子式。\n\n因此，满足所有约束条件的独特分子式的数量为 1。", "answer": "$$\\boxed{1}$$", "id": "3719052"}, {"introduction": "上一个练习让我们看到了精确质量的威力，但我们不禁要问：是什么使得我们能够如此精确地测量质量？本练习将揭示质谱仪的一个关键性能指标——分辨率。不同的同位素组合可能产生质量非常相近的离子（同量异位素），本练习通过计算区分这些离子的最低分辨率要求，让你亲身体会高分辨率对于明确物质组成的重要性 [@problem_id:3719039]。", "problem": "在一台高分辨率质谱仪中观测到的一个有机离子，其质荷比 (m/z) 接近 $200$ 且带单个电荷。考虑该相同元素骨架的三种不同同位素组成，它们相对于一个包含硫-32 ($^{32}\\mathrm{S}$)、氧-16 ($^{16}\\mathrm{O}$) 和碳-12 ($^{12}\\mathrm{C}$) 的基准同位素体，仅在以下一种取代上有所不同：用硫-34 ($^{34}\\mathrm{S}$) 取代 $^{32}\\mathrm{S}$，用氧-18 ($^{18}\\mathrm{O}$) 取代 $^{16}\\mathrm{O}$，或者用两个碳-13 ($^{13}\\mathrm{C}$) 原子取代两个 $^{12}\\mathrm{C}$ 原子。使用以下精确原子质量（单位为统一原子质量单位, $1\\,\\text{u}$）：\n\n$^{12}\\mathrm{C}: 12.000000000$, $^{13}\\mathrm{C}: 13.003354835$, $^{16}\\mathrm{O}: 15.994914619$, $^{18}\\mathrm{O}: 17.999159612$, $^{32}\\mathrm{S}: 31.972071174$, $^{34}\\mathrm{S}: 33.967867004$,\n\n首先，计算每次取代相对于基准同位素体所引入的三个精确质量偏移，$\\Delta m_{^{34}\\mathrm{S}}$、$\\Delta m_{^{18}\\mathrm{O}}$ 和 $\\Delta m_{2 \\times {}^{13}\\text{C}}$。然后，计算这三个偏移之间的所有两两之差，并找出最小的差值 $\\Delta m_{\\min}$。根据第一性原理和质谱学中公认的定义，确定在 $m/z = 200$ 处将所有三个同位素取代峰彼此基线分辨所需的最低分辨率。将最终的分辨率结果四舍五入至四位有效数字，并以无单位的无量纲数表示。", "solution": "该问题要求计算质谱仪为区分一个质荷比 ($m/z$) 接近 $200$ 的带单个电荷的有机离子中的三种特定同位素取代所需的最低分辨率。\n\n首先，对问题陈述进行验证。\n\n**步骤 1：提取已知条件**\n-   离子在 $m/z = 200$ 附近被观测到。\n-   离子带单个电荷，因此其电荷数 $z$ 为 $1$。这意味着离子的质量 $m$ 约为 $200\\,\\mathrm{u}$。\n-   考虑了相对于一个包含 $^{32}\\mathrm{S}$、$^{16}\\mathrm{O}$ 和 $^{12}\\mathrm{C}$ 的基准同位素体的三种取代：\n    1.  $^{32}\\mathrm{S}$ 被 $^{34}\\mathrm{S}$ 取代。\n    2.  $^{16}\\mathrm{O}$ 被 $^{18}\\mathrm{O}$ 取代。\n    3.  两个 $^{12}\\mathrm{C}$ 原子被两个 $^{13}\\mathrm{C}$ 原子取代。\n-   提供了以统一原子质量单位 ($\\text{u}$) 表示的精确原子质量：\n    -   $m(^{12}\\mathrm{C}) = 12.000000000\\,\\mathrm{u}$\n    -   $m(^{13}\\mathrm{C}) = 13.003354835\\,\\mathrm{u}$\n    -   $m(^{16}\\mathrm{O}) = 15.994914619\\,\\mathrm{u}$\n    -   $m(^{18}\\mathrm{O}) = 17.999159612\\,\\mathrm{u}$\n    -   $m(^{32}\\mathrm{S}) = 31.972071174\\,\\mathrm{u}$\n    -   $m(^{34}\\mathrm{S}) = 33.967867004\\,\\mathrm{u}$\n-   任务是：\n    1.  计算精确质量偏移：$\\Delta m_{^{34}\\mathrm{S}}$、$\\Delta m_{^{18}\\mathrm{O}}$ 和 $\\Delta m_{2 \\times {}^{13}\\text{C}}$。\n    2.  计算这些偏移之间的所有两两之差。\n    3.  找出最小的两两之差 $\\Delta m_{\\min}$。\n    4.  确定在 $m/z = 200$ 处的最低分辨率 $R$。\n    5.  将 $R$ 的最终值四舍五入至四位有效数字。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，使用了来自 IUPAC 的真实高精度原子质量数据。所描述的场景是高分辨率质谱在分析化学中的一个标准应用。问题提法恰当，提供了所有必要的数据和一组明确的目标。语言客观而精确。没有矛盾、缺失数据或不科学的前提。因此，该问题被认定为有效。\n\n**步骤 3：结论与行动**\n问题有效。将提供完整的解答。\n\n**求解推导**\n\n每次取代的质量偏移 ($\\Delta m$) 是新同位素的质量与原始同位素的质量之差。\n\n1.  **计算每次取代的质量偏移。**\n\n    -   对于用一个 $^{34}\\mathrm{S}$ 原子取代一个 $^{32}\\mathrm{S}$ 原子，质量偏移 $\\Delta m_{^{34}\\mathrm{S}}$ 为：\n        $$\n        \\Delta m_{^{34}\\mathrm{S}} = m(^{34}\\mathrm{S}) - m(^{32}\\mathrm{S}) = 33.967867004\\,\\mathrm{u} - 31.972071174\\,\\mathrm{u} = 1.995795830\\,\\mathrm{u}\n        $$\n\n    -   对于用一个 $^{18}\\mathrm{O}$ 原子取代一个 $^{16}\\mathrm{O}$ 原子，质量偏移 $\\Delta m_{^{18}\\mathrm{O}}$ 为：\n        $$\n        \\Delta m_{^{18}\\mathrm{O}} = m(^{18}\\mathrm{O}) - m(^{16}\\mathrm{O}) = 17.999159612\\,\\mathrm{u} - 15.994914619\\,\\mathrm{u} = 2.004244993\\,\\mathrm{u}\n        $$\n\n    -   对于用两个 $^{13}\\mathrm{C}$ 原子取代两个 $^{12}\\mathrm{C}$ 原子，质量偏移 $\\Delta m_{2 \\times {}^{13}\\text{C}}$ 为：\n        $$\n        \\Delta m_{2 \\times {}^{13}\\text{C}} = 2 \\times m(^{13}\\mathrm{C}) - 2 \\times m(^{12}\\mathrm{C}) = 2 \\times (13.003354835\\,\\mathrm{u} - 12.000000000\\,\\mathrm{u}) = 2 \\times 1.003354835\\,\\mathrm{u} = 2.006709670\\,\\mathrm{u}\n        $$\n\n2.  **计算质量偏移之间的两两之差。**\n    这三个质量偏移代表了相对于基准同位素体的质量增加。由此产生的三个同位素峰的质量将是 $M_{base} + \\Delta m_{^{34}\\mathrm{S}}$、$M_{base} + \\Delta m_{^{18}\\mathrm{O}}$ 和 $M_{base} + \\Delta m_{2 \\times {}^{13}\\text{C}}$。要分辨这三个峰，仪器必须能够区分它们。最具挑战性的区分是在质量最接近的两个峰之间。这些峰中任意两个峰之间的间隔是它们各自质量偏移的绝对差。\n\n    -   $^{18}\\mathrm{O}$ 取代和 $^{34}\\mathrm{S}$ 取代之间的差异：\n        $$\n        |\\Delta m_{^{18}\\mathrm{O}} - \\Delta m_{^{34}\\mathrm{S}}| = |2.004244993 - 1.995795830|\\,\\mathrm{u} = 0.008449163\\,\\mathrm{u}\n        $$\n\n    -   $2 \\times {}^{13}\\text{C}$ 取代和 $^{18}\\mathrm{O}$ 取代之间的差异：\n        $$\n        |\\Delta m_{2 \\times {}^{13}\\text{C}} - \\Delta m_{^{18}\\mathrm{O}}| = |2.006709670 - 2.004244993|\\,\\mathrm{u} = 0.002464677\\,\\mathrm{u}\n        $$\n\n    -   $2 \\times {}^{13}\\text{C}$ 取代和 $^{34}\\mathrm{S}$ 取代之间的差异：\n        $$\n        |\\Delta m_{2 \\times {}^{13}\\text{C}} - \\Delta m_{^{34}\\mathrm{S}}| = |2.006709670 - 1.995795830|\\,\\mathrm{u} = 0.010913840\\,\\mathrm{u}\n        $$\n\n3.  **找出最小的两两之差 ($\\Delta m_{\\min}$)。**\n    通过比较计算出的三个两两之差，可以找出最小值：\n    $$\n    \\Delta m_{\\min} = 0.002464677\\,\\mathrm{u}\n    $$\n    这是质谱仪必须能够分辨的最小质量间隔。\n\n4.  **确定所需的最低分辨率。**\n    质谱仪的分辨率 $R$ 定义为：\n    $$\n    R = \\frac{m}{\\Delta m}\n    $$\n    其中 $m$ 是被测离子的质荷比，$\\Delta m$ 是峰半高全宽 (FWHM)。为使质量为 $m_1$ 和 $m_2$ 的两个峰被认为已分辨（根据通用的 $10\\%$ 峰谷定义），间隔 $|m_1 - m_2|$ 必须至少等于 FWHM，即 $\\Delta m$。因此，要分辨最接近的两个峰，仪器的 $\\Delta m$ 最多必须等于它们之间的间隔 $\\Delta m_{\\min}$。\n\n    因此，通过设置 $\\Delta m = \\Delta m_{\\min}$ 来计算所需的最低分辨率。问题指明离子在 $m/z = 200$ 附近被观测到，所以我们使用 $m=200$。\n    $$\n    R_{\\min} = \\frac{m}{\\Delta m_{\\min}} = \\frac{200}{0.002464677}\n    $$\n    $$\n    R_{\\min} \\approx 81146.43105\n    $$\n\n5.  **将结果四舍五入至四位有效数字。**\n    将计算出的分辨率四舍五入至四位有效数字，得到：\n    $$\n    R_{\\min} \\approx 81150\n    $$\n    为明确表示四位有效数字，用科学记数法表示为 $8.115 \\times 10^4$。分辨率是一个无量纲量。", "answer": "$$\\boxed{8.115 \\times 10^{4}}$$", "id": "3719039"}, {"introduction": "在真实的实验中，仪器的测量并非永远完美。本练习将我们带入一个更高级且实际的场景：处理系统误差。我们将探讨空间电荷效应，它会导致质量测量误差随分析离子数量的变化而系统性地改变。你将亲手完成一项真实世界的数据分析任务：建立一个数学模型来预测并校正这些误差，从而确保我们所依赖数据的准确性 [@problem_id:3719059]。", "problem": "给定一组锁模质量偏差测量值，这些数据是在一台精确质量质谱仪上，通过改变离子负载获得的，其中总离子流（TIC）被用作离子负载的代理指标。目标是构建一个能够捕捉质量误差对离子负载依赖性的预测模型，并利用该模型校正特定分析物信号的实测质荷比。其指导物理原理是，空间电荷效应会改变离子在离子阱和静电分析器中的振荡频率，从而产生一个随离子数量增加而增大的系统性质量误差。对于较小的偏移，以百万分率（ppm）为单位的质量误差可以建模为离子负载的一个平滑函数。假设锁模质量偏差的测量噪声为异方差高斯噪声。\n\n形式上，假设以 ppm 为单位的锁模质量偏差是归一化离子负载的二次函数，\n$$\n\\delta(I) = \\theta_0 + \\theta_1 I + \\theta_2 I^2,\n$$\n其中 $I$ 是归一化的 TIC，$\\theta_0,\\theta_1,\\theta_2$ 是待估计的实系数。给定 $N$ 个观测值 $\\{(I_k,\\delta_k,\\sigma_k)\\}_{k=1}^N$，其已知标准差为 $\\sigma_k$ (ppm)，通过最小化加权残差平方和来估计 $\\boldsymbol{\\theta}=[\\theta_0,\\theta_1,\\theta_2]^\\top$，假设噪声是独立的、方差为 $\\sigma_k^2$ 的高斯噪声。即，求解以下加权最小二乘问题：\n$$\n\\min_{\\boldsymbol{\\theta}\\in\\mathbb{R}^3} \\sum_{k=1}^{N} w_k \\left(\\delta_k-\\theta_0-\\theta_1 I_k-\\theta_2 I_k^2\\right)^2, \\quad\\text{with}\\quad w_k=\\frac{1}{\\sigma_k^2}.\n$$\n一旦 $\\boldsymbol{\\theta}$ 被估计出来，即可在给定的离子负载 $I$ 下预测质量误差 $\\widehat{\\delta}(I)$，并通过应用精确的乘法校正公式来校正一个实测的质荷比值 $m^{\\mathrm{meas}}$：\n$$\nm^{\\mathrm{corr}} = \\frac{m^{\\mathrm{meas}}}{1+\\widehat{\\delta}(I)\\times 10^{-6}}.\n$$\n所有校正后的质量均以道尔顿（Da）为单位表示，并四舍五入到六位小数。\n\n使用以下训练数据 ($N=9$)，其形式为 $\\{(I_k,\\delta_k,\\sigma_k)\\}$:\n- $k=1$: $(I_1,\\delta_1,\\sigma_1)=(0.00,-0.25,0.05)$\n- $k=2$: $(I_2,\\delta_2,\\sigma_2)=(0.10,0.242,0.06)$\n- $k=3$: $(I_3,\\delta_3,\\sigma_3)=(0.25,1.025,0.075)$\n- $k=4$: $(I_4,\\delta_4,\\sigma_4)=(0.40,1.862,0.090)$\n- $k=5$: $(I_5,\\delta_5,\\sigma_5)=(0.55,2.753,0.105)$\n- $k=6$: $(I_6,\\delta_6,\\sigma_6)=(0.70,3.698,0.120)$\n- $k=7$: $(I_7,\\delta_7,\\sigma_7)=(0.85,4.697,0.135)$\n- $k=8$: $(I_8,\\delta_8,\\sigma_8)=(1.00,5.750,0.150)$\n- $k=9$: $(I_9,\\delta_9,\\sigma_9)=(1.10,6.482,0.160)$\n\n估计出 $\\boldsymbol{\\theta}$ 后，校正以下四个实测的分析物峰：\n- 情况 A: $m^{\\mathrm{meas}}=556.276394$ 在 $I=0.65$\n- 情况 B: $m^{\\mathrm{meas}}=1015.123456$ 在 $I=0.00$\n- 情况 C: $m^{\\mathrm{meas}}=152.071235$ 在 $I=1.05$\n- 情况 D: $m^{\\mathrm{meas}}=800.000000$ 在 $I=0.30$\n\n测试套件和输出规范：\n- 你的程序必须：\n  - 通过求解加权最小二乘法的正规方程组，从提供的训练数据中估计 $\\boldsymbol{\\theta}$。\n  - 对四种情况预测 $\\widehat{\\delta}(I)$，并使用精确的乘法公式计算 $m^{\\mathrm{corr}}$。\n  - 将 $\\theta_0,\\theta_1,\\theta_2$ 的每一个值四舍五入到六位小数（单位为 ppm），并将每个 $m^{\\mathrm{corr}}$ 四舍五入到六位小数（单位为 Da）。\n- 你的程序应生成单行输出，其中包含七个结果，以逗号分隔的列表形式并用方括号括起来，顺序如下：\n$$\n[\\theta_0,\\theta_1,\\theta_2,m^{\\mathrm{corr}}_{\\mathrm{A}},m^{\\mathrm{corr}}_{\\mathrm{B}},m^{\\mathrm{corr}}_{\\mathrm{C}},m^{\\mathrm{corr}}_{\\mathrm{D}}].\n$$\n例如，输出格式应类似于 $[\\ldots]$，包含七个浮点数，每个数都四舍五入到六位小数，用逗号分隔且不含空格。\n\n该规范提供了一个测试套件，其中包括一个中等范围的离子负载、一个零负载的边界情况、一个高负载的外推情况和一个中间负载的情况，从而综合评估模型的拟合、内插和近外推能力。", "solution": "用户提供了一个问题，要求为一个质谱仪校准模型估计参数，并随后应用该模型来校正实测的质荷比。\n\n### 问题验证\n\n**步骤 1：提取给定信息**\n给定信息如下：\n- 质量误差（以百万分率 ppm 为单位的偏差）作为归一化离子负载 $I$ 的函数模型：\n$$ \\delta(I) = \\theta_0 + \\theta_1 I + \\theta_2 I^2 $$\n- 待估计的参数为 $\\boldsymbol{\\theta} = [\\theta_0, \\theta_1, \\theta_2]^\\top$。\n- 优化问题是一个加权最小二乘最小化问题：\n$$ \\min_{\\boldsymbol{\\theta}\\in\\mathbb{R}^3}\\;\\sum_{k=1}^{N}\\,w_k\\left(\\delta_k-\\theta_0-\\theta_1 I_k-\\theta_2 I_k^2\\right)^2 $$\n- 权重由测量的标准差 $\\sigma_k$ 定义：$w_k = 1/\\sigma_k^2$。\n- 训练数据点的数量为 $N=9$。\n- 训练数据点 $\\{(I_k, \\delta_k, \\sigma_k)\\}$ 为：\n  - $k=1$: $(0.00, -0.25, 0.05)$\n  - $k=2$: $(0.10, 0.242, 0.06)$\n  - $k=3$: $(0.25, 1.025, 0.075)$\n  - $k=4$: $(0.40, 1.862, 0.090)$\n  - $k=5$: $(0.55, 2.753, 0.105)$\n  - $k=6$: $(0.70, 3.698, 0.120)$\n  - $k=7$: $(0.85, 4.697, 0.135)$\n  - $k=8$: $(1.00, 5.750, 0.150)$\n  - $k=9$: $(1.10, 6.482, 0.160)$\n- 用于校正实测质荷比 $m^{\\mathrm{meas}}$ 的公式为：\n$$ m^{\\mathrm{corr}} = \\frac{m^{\\mathrm{meas}}}{1+\\widehat{\\delta}(I)\\times 10^{-6}} $$\n- 用于校正的测试用例如下：\n  - 情况 A: $m^{\\mathrm{meas}}=556.276394$ Da 在 $I=0.65$\n  - 情况 B: $m^{\\mathrm{meas}}=1015.123456$ Da 在 $I=0.00$\n  - 情况 C: $m^{\\mathrm{meas}}=152.071235$ Da 在 $I=1.05$\n  - 情况 D: $m^{\\mathrm{meas}}=800.000000$ Da 在 $I=0.30$\n- 输出必须是单行，包含一个由七个值 $[\\theta_0, \\theta_1, \\theta_2, m^{\\mathrm{corr}}_{\\mathrm{A}}, m^{\\mathrm{corr}}_{\\mathrm{B}}, m^{\\mathrm{corr}}_{\\mathrm{C}}, m^{\\mathrm{corr}}_{\\mathrm{D}}]$ 组成的逗号分隔列表，每个值都四舍五入到六位小数。\n\n**步骤 2：使用提取的给定信息进行验证**\n- **科学依据：** 该问题基于仪器分析的既定原理。质谱分析中的空间电荷效应是导致系统性质量测量误差的已知原因，而将此误差建模为离子负载（以总离子流 TIC 为代理）的多项式函数是一种有效且常见的经验校准策略。对于异方差噪声（非恒定方差），使用加权最小二乘法是合适的，这通过为每个测量值提供单独的标准差 $\\sigma_k$ 得以正确指定。乘法校正公式是根据以 ppm 表示的相对误差来调整质量值的正确方法。该问题具有科学合理性。\n- **良态问题：** 该任务是一个标准的加权线性最小二乘问题。数据点数量（$N=9$）超过了待估计参数的数量（$3$），因此该系统是超定的。自变量值 $I_k$ 是不同的并且跨越一个范围，确保了设计矩阵的列是线性无关的，并且问题具有唯一、稳定的解。该问题是良态的。\n- **客观性：** 该问题使用精确、无歧义的数学和科学语言进行表述。它不包含主观或基于意见的陈述。\n\n**步骤 3：结论与行动**\n该问题是有效的，因为它具有科学依据、是良态的、客观且完整的。将推导其解法。\n\n### 求解推导\n\n问题的核心是求解一个加权最小二乘（WLS）回归问题，以找到二次模型 $\\delta(I) = \\theta_0 + \\theta_1 I + \\theta_2 I^2$ 的系数 $\\boldsymbol{\\theta} = [\\theta_0, \\theta_1, \\theta_2]^\\top$。\n\n所有 $N$ 个观测值的方程组可以写成矩阵形式：\n$$ \\mathbf{y} = \\mathbf{X}\\boldsymbol{\\theta} + \\boldsymbol{\\epsilon} $$\n其中：\n- $\\mathbf{y}$ 是观测到的质量偏差的 $N \\times 1$ 向量, $\\mathbf{y} = [\\delta_1, \\delta_2, \\ldots, \\delta_N]^\\top$。\n- $\\mathbf{X}$ 是 $N \\times 3$ 的设计矩阵，其中第 $k$ 行对应第 $k$ 个观测值，由 $[1, I_k, I_k^2]$ 给出。\n$$ \\mathbf{X} = \\begin{pmatrix} 1  I_1  I_1^2 \\\\ 1  I_2  I_2^2 \\\\ \\vdots  \\vdots  \\vdots \\\\ 1  I_N  I_N^2 \\end{pmatrix} $$\n- $\\boldsymbol{\\theta}$ 是待估计参数的 $3 \\times 1$ 向量。\n- $\\boldsymbol{\\epsilon}$ 是随机误差向量。\n\n问题指明误差是独立的，且方差为 $\\sigma_k^2$。这种异方差性通过引入一个权重矩阵 $\\mathbf{W}$ 来处理，该矩阵是一个 $N \\times N$ 的对角矩阵，其对角线上的元素为权重 $w_k = 1/\\sigma_k^2$：\n$$ \\mathbf{W} = \\text{diag}(w_1, w_2, \\ldots, w_N) = \\text{diag}(1/\\sigma_1^2, 1/\\sigma_2^2, \\ldots, 1/\\sigma_N^2) $$\nWLS 方法最小化加权残差平方和 $S(\\boldsymbol{\\theta}) = \\sum w_k (\\delta_k - f(I_k; \\boldsymbol{\\theta}))^2$，其矩阵形式为 $(\\mathbf{y} - \\mathbf{X}\\boldsymbol{\\theta})^\\top \\mathbf{W} (\\mathbf{y} - \\mathbf{X}\\boldsymbol{\\theta})$。\n\n最小化此数量的解 $\\widehat{\\boldsymbol{\\theta}}$ 通过求解 WLS 的正规方程组得到：\n$$ (\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X}) \\widehat{\\boldsymbol{\\theta}} = \\mathbf{X}^\\top \\mathbf{W} \\mathbf{y} $$\n因此，解向量为：\n$$ \\widehat{\\boldsymbol{\\theta}} = (\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X})^{-1} \\mathbf{X}^\\top \\mathbf{W} \\mathbf{y} $$\n\n**分步计算：**\n\n1.  **构建矩阵：** 使用提供的训练数据，我们构建向量 $\\mathbf{y}$ 和 $\\mathbf{I}$，以及矩阵 $\\mathbf{X}$ 和 $\\mathbf{W}$。\n    - $\\mathbf{I} = [0.00, 0.10, 0.25, 0.40, 0.55, 0.70, 0.85, 1.00, 1.10]^\\top$\n    - $\\mathbf{y} = [-0.25, 0.242, 1.025, 1.862, 2.753, 3.698, 4.697, 5.750, 6.482]^\\top$\n    - $\\boldsymbol{\\sigma} = [0.05, 0.06, 0.075, 0.090, 0.105, 0.120, 0.135, 0.150, 0.160]^\\top$\n    - $\\mathbf{X}$ 是一个 $9 \\times 3$ 矩阵，其列分别为 $1$, $\\mathbf{I}$ 和 $\\mathbf{I}^2$ (按元素平方)。\n    - $\\mathbf{W}$ 是一个 $9 \\times 9$ 的对角矩阵，其对角元素为 $1/\\sigma_k^2$。\n\n2.  **求解 $\\widehat{\\boldsymbol{\\theta}}$：** 我们计算矩阵乘积 $\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X}$ 和 $\\mathbf{X}^\\top \\mathbf{W} \\mathbf{y}$，然后求解得到的 $3 \\times 3$ 线性方程组以获得 $\\widehat{\\boldsymbol{\\theta}} = [\\widehat{\\theta}_0, \\widehat{\\theta}_1, \\widehat{\\theta}_2]^\\top$。这将得出校准曲线的估计参数。\n    - $\\widehat{\\theta}_0 \\approx -0.251457$\n    - $\\widehat{\\theta}_1 \\approx 4.020786$\n    - $\\widehat{\\theta}_2 \\approx 1.982137$\n\n3.  **预测质量误差：** 对于每个测试用例，给定一个离子负载 $I_{\\text{test}}$。我们使用拟合的模型来预测质量误差 $\\widehat{\\delta}(I_{\\text{test}})$：\n    $$ \\widehat{\\delta}(I_{\\text{test}}) = \\widehat{\\theta}_0 + \\widehat{\\theta}_1 I_{\\text{test}} + \\widehat{\\theta}_2 I_{\\text{test}}^2 $$\n\n4.  **校正实测质量：** 使用预测的误差 $\\widehat{\\delta}(I_{\\text{test}})$ (单位 ppm)，我们应用乘法校正公式来获得校正后的质量 $m^{\\mathrm{corr}}$：\n    $$ m^{\\mathrm{corr}} = \\frac{m^{\\mathrm{meas}}}{1 + \\widehat{\\delta}(I_{\\text{test}}) \\times 10^{-6}} $$\n    我们对四个测试用例中的每一个进行此计算。\n\n    - **情况 A：** $I = 0.65$。\n      $\\widehat{\\delta}(0.65) \\approx -0.251457 + 4.020786(0.65) + 1.982137(0.65)^2 \\approx 3.199603$ ppm。\n      $m^{\\mathrm{corr}}_{\\mathrm{A}} = \\frac{556.276394}{1 + 3.199603 \\times 10^{-6}} \\approx 556.274614$ Da。\n\n    - **情况 B：** $I = 0.00$。\n      $\\widehat{\\delta}(0.00) = \\widehat{\\theta}_0 \\approx -0.251457$ ppm。\n      $m^{\\mathrm{corr}}_{\\mathrm{B}} = \\frac{1015.123456}{1 - 0.251457 \\times 10^{-6}} \\approx 1015.123711$ Da。\n\n    - **情况 C：** $I = 1.05$。\n      $\\widehat{\\delta}(1.05) \\approx -0.251457 + 4.020786(1.05) + 1.982137(1.05)^2 \\approx 6.155674$ ppm。\n      $m^{\\mathrm{corr}}_{\\mathrm{C}} = \\frac{152.071235}{1 + 6.155674 \\times 10^{-6}} \\approx 152.070300$ Da。\n\n    - **情况 D：** $I = 0.30$。\n      $\\widehat{\\delta}(0.30) \\approx -0.251457 + 4.020786(0.30) + 1.982137(0.30)^2 \\approx 1.133171$ ppm。\n      $m^{\\mathrm{corr}}_{\\mathrm{D}} = \\frac{800.000000}{1 + 1.133171 \\times 10^{-6}} \\approx 799.999093$ Da。\n\n5.  **格式化输出：** 最后一步是收集估计的参数和校正后的质量，将每个值四舍五入到六位小数，并将其格式化为所需的字符串格式。\n    - $\\widehat{\\theta}_0$ 四舍五入为 $-0.251457$。\n    - $\\widehat{\\theta}_1$ 四舍五入为 $4.020786$。\n    - $\\widehat{\\theta}_2$ 四舍五入为 $1.982137$。\n    - $m^{\\mathrm{corr}}_{\\mathrm{A}}$ 四舍五入为 $556.274614$。\n    - $m^{\\mathrm{corr}}_{\\mathrm{B}}$ 四舍五入为 $1015.123711$。\n    - $m^{\\mathrm{corr}}_{\\mathrm{C}}$ 四舍五入为 $152.070300$。\n    - $m^{\\mathrm{corr}}_{\\mathrm{D}}$ 四舍五入为 $799.999093$。\n最终的输出字符串是这七个数字的逗号分隔列表，并用方括号括起来。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the weighted least-squares problem to calibrate mass error\n    and corrects measured masses.\n    \"\"\"\n    \n    # Training data from the problem statement.\n    # N=9 observations of (I_k, delta_k, sigma_k)\n    # I_k: normalized ion load (unitless)\n    # delta_k: mass error (ppm)\n    # sigma_k: standard deviation of mass error (ppm)\n    training_data = [\n        (0.00, -0.25, 0.05),\n        (0.10, 0.242, 0.06),\n        (0.25, 1.025, 0.075),\n        (0.40, 1.862, 0.090),\n        (0.55, 2.753, 0.105),\n        (0.70, 3.698, 0.120),\n        (0.85, 4.697, 0.135),\n        (1.00, 5.750, 0.150),\n        (1.10, 6.482, 0.160),\n    ]\n\n    I_k = np.array([d[0] for d in training_data])\n    delta_k = np.array([d[1] for d in training_data])\n    sigma_k = np.array([d[2] for d in training_data])\n\n    # --- Step 1: Weighted Least-Squares Estimation of theta ---\n    \n    # The model is delta(I) = theta_0 + theta_1 * I + theta_2 * I^2.\n    # This is a linear model in the parameters theta.\n    # We solve the normal equations for weighted least squares:\n    # (X^T * W * X) * theta = X^T * W * y\n    \n    # Construct the design matrix X\n    # Each row is [1, I_k, I_k^2]\n    X = np.c_[np.ones_like(I_k), I_k, I_k**2]\n    \n    # Construct the weight matrix W. It's a diagonal matrix with W_kk = 1/sigma_k^2.\n    W = np.diag(1 / sigma_k**2)\n    \n    # y is the vector of observations delta_k\n    y = delta_k\n    \n    # Solve the normal equations\n    XTWX = X.T @ W @ X\n    XTWy = X.T @ W @ y\n    \n    # theta = [theta_0, theta_1, theta_2]\n    theta = np.linalg.solve(XTWX, XTWy)\n    theta_0, theta_1, theta_2 = theta\n    \n    # --- Step 2: Predict Errors and Correct Masses for Test Cases ---\n    \n    test_cases = [\n        # (m_meas, I_test)\n        (556.276394, 0.65), # Case A\n        (1015.123456, 0.00), # Case B\n        (152.071235, 1.05), # Case C\n        (800.000000, 0.30)  # Case D\n    ]\n    \n    corrected_masses = []\n    for m_meas, I_test in test_cases:\n        # Predict mass error in ppm using the fitted model\n        # delta_pred = theta_0 + theta_1*I + theta_2*I^2\n        delta_pred = theta_0 + theta_1 * I_test + theta_2 * I_test**2\n        \n        # Apply the exact multiplicative correction\n        # m_corr = m_meas / (1 + delta_pred * 1e-6)\n        m_corr = m_meas / (1 + delta_pred * 1e-6)\n        corrected_masses.append(m_corr)\n\n    # --- Step 3: Format the Output ---\n    \n    # Collect all results: 3 theta parameters and 4 corrected masses_\n    results = [\n        theta_0,\n        theta_1,\n        theta_2,\n        *corrected_masses\n    ]\n    \n    # Format each result to six decimal places as a string\n    # Using f-string formatting handles rounding (rounds .5 up)\n    formatted_results = [f\"{val:.6f}\" for val in results]\n    \n    # Join into the final output string: [val1,val2,...,val7]\n    output_string = f\"[{','.join(formatted_results)}]\"\n    \n    print(output_string)\n\nsolve()\n```", "id": "3719059"}]}