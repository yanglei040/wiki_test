{"hands_on_practices": [{"introduction": "在蛋白质质谱分析中，肽段的同位素峰簇是其最基本的特征之一。由于$^{13}\\text{C}$、$^{15}\\text{N}$等重同位素的天然存在，一个肽段并非表现为单一质量的信号，而是呈现出一系列间隔约1 Da的同位素峰。本练习将指导您使用基本的二项式统计模型，从第一性原理出发计算给定肽段的同位素峰（$M$, $M+1$, $M+2$）的相对强度[@problem_id:3712583]，这有助于加深对肽段质谱信号构成的理解，并为后续更复杂的定量和鉴定算法打下基础。", "problem": "在肽的高分辨质谱（MS）中，前三个标称同位素峰对应于单同位素峰 $M$（所有考虑的原子均为其最丰富的同位素）、$M+1$（净增加一个中子）和 $M+2$（净增加两个中子）。考虑一个含有 $n_{C}=90$ 个碳原子、$n_{N}=18$ 个氮原子和 $n_{S}=2$ 个硫原子的肽。假设同位素为自然丰度，且各原子上同位素的出现是相互独立的。仅对相对于最丰富同位素的以下同位素取代进行建模：$^{13}\\!C$ 的概率为 $p_{C}=0.0107$，贡献 $+1$ 的标称质量漂移；$^{15}\\!N$ 的概率为 $p_{N}=0.00364$，贡献 $+1$ 的标称质量漂移；以及 $^{34}\\!S$ 的概率为 $p_{S}=0.0429$，贡献 $+2$ 的标称质量漂移。忽略所有其他同位素效应，包括 $^{33}\\!S$、$^{2}\\!H$、$^{17}\\!O$ 和 $^{18}\\!O$。将同位素组成视为一系列独立的伯努利试验，并应用二项式统计来计算产生净标称质量漂移为 $0$、$+1$ 和 $+2$ 的构型数量。\n\n仅使用这些假设和二项式模型，从第一性原理推导 $M$、$M+1$ 和 $M+2$ 相对强度的表达式，然后根据给定的肽组成和丰度对其进行数值评估。将所有强度归一化，使得单同位素峰 $M$ 的相对强度为 $1$。将最终结果表示为一个行向量 $\\bigl[I(M),\\,I(M{+}1),\\,I(M{+}2)\\bigr]$，其条目为无量纲。将您的条目四舍五入到四位有效数字。\n\n根据您的推导，简要解释与仅考虑碳的模型相比，包含 $^{15}\\!N$ 和 $^{34}\\!S$ 如何改变 $M{+}1$ 和 $M{+}2$ 的强度，而无需执行超出所要求强度计算范围的任何额外数值计算。", "solution": "该问题需经过验证。\n\n### 步骤1：提取已知条件\n- 一个肽含有 $n_{C}=90$ 个碳原子，$n_{N}=18$ 个氮原子和 $n_{S}=2$ 个硫原子。\n- 考虑的同位素取代：\n    - $^{13}\\!C$：概率 $p_{C}=0.0107$，标称质量漂移 $+1$。\n    - $^{15}\\!N$：概率 $p_{N}=0.00364$，标称质量漂移 $+1$。\n    - $^{34}\\!S$：概率 $p_{S}=0.0429$，标称质量漂移 $+2$。\n- 假设：自然同位素丰度是恒定的，各原子上同位素的出现是相互独立的，并且忽略所有其他同位素效应（$^{33}\\!S$、$^{2}\\!H$、$^{17}\\!O$、$^{18}\\!O$）。\n- 模型：将同位素组成视为一系列独立的伯努利试验，并使用二项式统计。\n- 目标：\n    1. 推导单同位素峰（$M$）、$M+1$ 峰和 $M+2$ 峰的相对强度表达式。\n    2. 根据给定的组成和丰度对这些强度进行数值评估。\n    3. 将所有强度归一化，使得 $M$ 的强度（表示为 $I(M)$）为 $1$。\n    4. 将最终结果表示为一个行向量 $[I(M), I(M+1), I(M+2)]$，其条目四舍五入到四位有效数字。\n    5. 解释与仅考虑碳的模型相比，包含 $^{15}\\!N$ 和 $^{34}\\!S$ 如何改变 $M+1$ 和 $M+2$ 的强度。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据。它提出了一个简化但标准的模型，用于计算质谱中的同位素分布，这是蛋白质组学中的一项基本技术。对于独立的同位素取代，使用二项式统计是一种有效且广泛使用的近似方法。所提供的同位素丰度与已确定的自然丰度一致。该问题提法明确，提供了所有必要的数据（$n_C, n_N, n_S, p_C, p_N, p_S$）和一个清晰的统计框架来推导唯一解。语言客观而精确。由于明确指示忽略其他同位素，该问题是自洽的。它没有违反任何无效标准。\n\n### 步骤3：结论与操作\n该问题有效。将提供完整解答。\n\n### 解题推导\n\n质谱峰的强度与产生相应质量的所有同位素组成的总概率成正比。我们将每种元素的重同位素数量建模为一个独立的二项过程。设 $k_C$、$k_N$ 和 $k_S$ 分别为 $^{13}\\!C$、$^{15}\\!N$ 和 $^{34}\\!S$ 原子的数量。相对于单同位素质量的总标称质量漂移 $\\Delta m$ 由下式给出：\n$$\n\\Delta m = k_C + k_N + 2k_S\n$$\n由于独立性假设，观察到特定组合 $(k_C, k_N, k_S)$ 的概率是它们各自二项概率的乘积：\n$$\nP(k_C, k_N, k_S) = P(k_C) P(k_N) P(k_S)\n$$\n其中\n$$\nP(k_X) = \\binom{n_X}{k_X} p_X^{k_X} (1 - p_X)^{n_X-k_X}\n$$\n对于具有 $n_X$ 个原子和重同位素概率 $p_X$ 的元素 $X$。\n\n**单同位素峰的强度, $I(M)$**\n单同位素峰 $M$ 对应于质量漂移 $\\Delta m = 0$。这要求 $k_C=0$、$k_N=0$ 和 $k_S=0$。其概率 $P(M)$ 为：\n$$\nP(M) = P(k_C=0, k_N=0, k_S=0) = \\left[\\binom{n_C}{0}p_C^0(1-p_C)^{n_C-0}\\right] \\left[\\binom{n_N}{0}p_N^0(1-p_N)^{n_N-0}\\right] \\left[\\binom{n_S}{0}p_S^0(1-p_S)^{n_S-0}\\right]\n$$\n$$\nP(M) = (1-p_C)^{n_C} (1-p_N)^{n_N} (1-p_S)^{n_S}\n$$\n根据定义，我们将强度归一化，使得单同位素峰的强度为 $1$。\n$$\nI(M) = 1\n$$\n\n**$M+1$ 峰的强度, $I(M+1)$**\n$M+1$ 峰对应于质量漂移 $\\Delta m = 1$，这要求 $k_C + k_N + 2k_S = 1$。由于 $k_C, k_N, k_S$ 是非负整数，唯一可能的组合是 $(k_C, k_N, k_S) = (1, 0, 0)$ 或 $(0, 1, 0)$。这些是互斥事件，因此我们将它们的概率相加。\n$$\nP(\\Delta m = 1) = P(1,0,0) + P(0,1,0)\n$$\n$$\nP(\\Delta m = 1) = \\left[\\binom{n_C}{1}p_C(1-p_C)^{n_C-1}\\right](1-p_N)^{n_N}(1-p_S)^{n_S} + (1-p_C)^{n_C}\\left[\\binom{n_N}{1}p_N(1-p_N)^{n_N-1}\\right](1-p_S)^{n_S}\n$$\n相对强度 $I(M+1)$ 是比率 $P(\\Delta m = 1) / P(M)$：\n$$\nI(M+1) = \\frac{P(\\Delta m = 1)}{P(M)} = \\frac{n_C p_C (1-p_C)^{n_C-1} (1-p_N)^{n_N} (1-p_S)^{n_S}}{(1-p_C)^{n_C} (1-p_N)^{n_N} (1-p_S)^{n_S}} + \\frac{n_N p_N (1-p_N)^{n_N-1} (1-p_C)^{n_C} (1-p_S)^{n_S}}{(1-p_C)^{n_C} (1-p_N)^{n_N} (1-p_S)^{n_S}}\n$$\n简化表达式可得：\n$$\nI(M+1) = \\frac{n_C p_C}{1-p_C} + \\frac{n_N p_N}{1-p_N}\n$$\n\n**$M+2$ 峰的强度, $I(M+2)$**\n$M+2$ 峰对应于质量漂移 $\\Delta m = 2$，这要求 $k_C + k_N + 2k_S = 2$。对于 $(k_C, k_N, k_S)$ 的可能的非负整数组合是：\n1.  $(2, 0, 0)$: 两个 $^{13}\\!C$ 原子。\n2.  $(0, 2, 0)$: 两个 $^{15}\\!N$ 原子。\n3.  $(1, 1, 0)$: 一个 $^{13}\\!C$ 和一个 $^{15}\\!N$ 原子。\n4.  $(0, 0, 1)$: 一个 $^{34}\\!S$ 原子。\n\n总概率 $P(\\Delta m = 2)$ 是这四个互斥事件概率的总和。相对强度 $I(M+2) = P(\\Delta m=2) / P(M)$ 是每种情况相对概率的总和。\n\n1.  情况 $(2,0,0)$: $\\frac{P(2,0,0)}{P(M)} = \\frac{\\binom{n_C}{2}p_C^2(1-p_C)^{n_C-2}}{(1-p_C)^{n_C}} = \\frac{n_C(n_C-1)}{2} \\left(\\frac{p_C}{1-p_C}\\right)^2$\n2.  情况 $(0,2,0)$: $\\frac{P(0,2,0)}{P(M)} = \\frac{\\binom{n_N}{2}p_N^2(1-p_N)^{n_N-2}}{(1-p_N)^{n_N}} = \\frac{n_N(n_N-1)}{2} \\left(\\frac{p_N}{1-p_N}\\right)^2$\n3.  情况 $(1,1,0)$: $\\frac{P(1,1,0)}{P(M)} = \\frac{\\left[n_C p_C(1-p_C)^{n_C-1}\\right]\\left[n_N p_N(1-p_N)^{n_N-1}\\right]}{(1-p_C)^{n_C}(1-p_N)^{n_N}} = \\left(\\frac{n_C p_C}{1-p_C}\\right)\\left(\\frac{n_N p_N}{1-p_N}\\right)$\n4.  情况 $(0,0,1)$: $\\frac{P(0,0,1)}{P(M)} = \\frac{\\binom{n_S}{1}p_S(1-p_S)^{n_S-1}}{(1-p_S)^{n_S}} = \\frac{n_S p_S}{1-p_S}$\n\n将这些项相加，得到 $I(M+2)$ 的表达式：\n$$\nI(M+2) = \\frac{n_C(n_C-1)}{2}\\left(\\frac{p_C}{1-p_C}\\right)^2 + \\frac{n_N(n_N-1)}{2}\\left(\\frac{p_N}{1-p_N}\\right)^2 + \\left(\\frac{n_C p_C}{1-p_C}\\right)\\left(\\frac{n_N p_N}{1-p_N}\\right) + \\frac{n_S p_S}{1-p_S}\n$$\n\n### 数值计算\n给定值：$n_C=90$, $p_C=0.0107$；$n_N=18$, $p_N=0.00364$；$n_S=2$, $p_S=0.0429$。\n\n$I(M) = 1.000$ (通过归一化)。\n\n对于 $I(M+1)$：\n$$\nI(M+1) = \\frac{90 \\times 0.0107}{1-0.0107} + \\frac{18 \\times 0.00364}{1-0.00364} = \\frac{0.963}{0.9893} + \\frac{0.06552}{0.99636}\n$$\n$$\nI(M+1) \\approx 0.97341555 + 0.06575706 = 1.03917261 \\approx 1.039\n$$\n\n对于 $I(M+2)$：\n我们计算每一项：\n设 $T_C = \\frac{n_C p_C}{1-p_C} \\approx 0.97341555$ 和 $T_N = \\frac{n_N p_N}{1-p_N} \\approx 0.06575706$。\n第1项 (C,C): $\\frac{n_C-1}{2n_C}T_C^2 = \\frac{89}{180}(0.97341555)^2 \\approx 0.49444 \\times 0.947539 \\approx 0.468494$\n第2项 (N,N): $\\frac{n_N-1}{2n_N}T_N^2 = \\frac{17}{36}(0.06575706)^2 \\approx 0.47222 \\times 0.004324 \\approx 0.002042$\n第3项 (C,N): $T_C \\times T_N \\approx 0.97341555 \\times 0.06575706 \\approx 0.063998$\n第4项 (S): $\\frac{n_S p_S}{1-p_S} = \\frac{2 \\times 0.0429}{1-0.0429} = \\frac{0.0858}{0.9571} \\approx 0.089646$\n各项求和：\n$$\nI(M+2) \\approx 0.468494 + 0.002042 + 0.063998 + 0.089646 = 0.62418 \\approx 0.6242\n$$\n得到的相对强度向量 $[I(M), I(M+1), I(M+2)]$ 是 $[1.000, 1.039, 0.6242]$。\n\n### 同位素贡献解释\n推导出的表达式阐明了每种元素对同位素峰的贡献。\n在仅考虑碳的模型中，强度将是 $I_C(M+1) = \\frac{n_C p_C}{1-p_C}$ 和 $I_C(M+2) = \\frac{n_C(n_C-1)}{2}(\\frac{p_C}{1-p_C})^2$。\n\n**对 $I(M+1)$ 的影响：**\n$I(M+1)$ 的完整表达式是 $I_C(M+1) + \\frac{n_N p_N}{1-p_N}$。包含 $^{15}\\!N$ 增加了一个独立的、为正的项。这是因为单个 $^{15}\\!N$ 取代提供了实现 $\\Delta m = +1$ 漂移的额外途径，该途径独立于单个 $^{13}\\!C$ 取代的途径并且可以与之相加。同位素 $^{34}\\!S$ 不对 $M+1$ 峰有贡献，因为它的最小质量漂移为 $+2$。\n\n**对 $I(M+2)$ 的影响：**\n$I(M+2)$ 的完整表达式包含仅考虑碳的项，外加三个额外的正项：\n1.  两个 $^{15}\\!N$ 原子的项：$\\frac{n_N(n_N-1)}{2}(\\frac{p_N}{1-p_N})^2$。\n2.  一个 $^{13}\\!C$ 和一个 $^{15}\\!N$ 的交叉项：$(\\frac{n_C p_C}{1-p_C})(\\frac{n_N p_N}{1-p_N})$。\n3.  一个 $^{34}\\!S$ 原子的项：$\\frac{n_S p_S}{1-p_S}$。\n因此，包含 $^{15}\\!N$ 和 $^{34}\\!S$ 通过引入三种新的、独立的、导致 $\\Delta m = +2$ 漂移的构型，显著增加了 $I(M+2)$ 的值。这些新途径中的每一种都将其概率加到总概率中，从而相对于仅考虑碳的模型，增加了 $M+2$ 峰的整体强度。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.000 & 1.039 & 0.6242\n\\end{pmatrix}\n}\n$$", "id": "3712583"}, {"introduction": "等量标记（isobaric tagging）定量蛋白质组学的一个核心挑战是共分离干扰导致的“比率压缩”现象，它会严重低估真实的蛋白丰度变化。本练习旨在通过构建一个数学模型，来精确描述目标肽段和干扰肽段在共碎裂过程中如何影响最终的报告离子比率[@problem_id:3712571]。通过推导观测比率与碰撞能量之间的函数关系，您将学会如何量化分析实验参数对定量准确性的影响，这是优化定量方法和准确解读数据的关键一步。", "problem": "在一台配备有高能碰撞解离（HCD）的液相色谱-串联质谱（LC-MS/MS）平台上，进行了一项使用串联质量标签（TMT）的蛋白质组学实验。一个目标肽段和一个干扰肽段被共分离和共碎裂，产生等量报告离子，其测得的强度与肽段的丰度、其电离/传输因子以及在给定碰撞能量下的报告离子形成（碎裂）效率成正比。假设以下基本前提：\n1. 由肽段贡献的报告离子强度与其丰度以及依赖于碰撞能量的报告离子形成效率呈线性关系。\n2. 一个通道中观测到的报告离子强度是该通道中所有共分离肽段贡献的总和。\n3. 碎裂效率随碰撞能量增加而增加，并遵循饱和指数形式。\n\n设目标肽段在两个通道（通道 $2$ 相对于通道 $1$）之间的真实丰度比为 $r = \\frac{a_{T,2}}{a_{T,1}}$，干扰肽段的相应比率为 $s = \\frac{a_{I,2}}{a_{I,1}}$。设 $q = \\frac{\\eta_{I} a_{I,1}}{\\eta_{T} a_{T,1}}$ 用于参数化通道1分离窗口中的相对干扰丰度，其中 $\\eta_{T}$ 和 $\\eta_{I}$ 分别是目标肽段和干扰肽段的恒定电离/传输因子。设目标肽段和干扰肽段的报告离子形成效率分别为 $\\phi_{T}(E) = 1 - \\exp(-\\beta_{T} E)$ 和 $\\phi_{I}(E) = 1 - \\exp(-\\beta_{I} E)$，其中 $E$ 是碰撞能量，$\\beta_{T}$、$\\beta_{I} > 0$ 是肽段特异性常数。\n\n仅从上述前提开始，推导观测到的报告离子比率 $R_{\\mathrm{obs}}(E)$（通道 $2$ 与通道 $1$ 之比）作为 $E$、$r$、$s$、$q$、$\\beta_{T}$ 和 $\\beta_{I}$ 的函数的符号化封闭形式表达式。然后，使用 $r = 5$、$s = 1$、$q = 0.4$、$\\beta_{T} = 0.08$ $\\mathrm{eV}^{-1}$、$\\beta_{I} = 0.12$ $\\mathrm{eV}^{-1}$，并在 $E_{0} = 30$ $\\mathrm{eV}$ 处求值，计算一阶灵敏度 $\\frac{d R_{\\mathrm{obs}}}{dE}\\big|_{E = E_{0}}$。将您的最终数值答案以每电子伏特为单位表示，并四舍五入到四位有效数字。", "solution": "首先根据指定标准对问题进行验证。\n\n### 问题验证\n**第1步：提取已知条件**\n-   **背景：** 串联质量标签（TMT）蛋白质组学实验，其中目标肽段（T）和干扰肽段（I）被共分离/共碎裂。\n-   **模型假设（前提）：**\n    1.  报告离子强度与肽段丰度和依赖于碰撞能量的报告离子形成效率成线性关系。\n    2.  观测到的报告离子强度是所有共分离肽段贡献的总和。\n    3.  碎裂效率的形式为 $\\phi(E) = 1 - \\exp(-\\beta E)$。\n-   **定义：**\n    -   目标肽段丰度比：$r = \\frac{a_{T,2}}{a_{T,1}}$\n    -   干扰肽段丰度比：$s = \\frac{a_{I,2}}{a_{I,1}}$\n    -   相对干扰参数：$q = \\frac{\\eta_{I} a_{I,1}}{\\eta_{T} a_{T,1}}$\n    -   电离/传输因子：$\\eta_{T}$, $\\eta_{I}$\n    -   目标肽段碎裂效率：$\\phi_{T}(E) = 1 - \\exp(-\\beta_{T} E)$\n    -   干扰肽段碎裂效率：$\\phi_{I}(E) = 1 - \\exp(-\\beta_{I} E)$\n-   **常数：**\n    -   $\\beta_{T} > 0$, $\\beta_{I} > 0$\n-   **任务：**\n    1.  推导观测到的报告离子比率 $R_{\\mathrm{obs}}(E)$ 的符号化封闭形式表达式。\n    2.  在 $E_0 = 30$ eV 处计算一阶灵敏度 $\\frac{d R_{\\mathrm{obs}}}{dE}$。\n-   **数值：**\n    -   $r = 5$\n    -   $s = 1$\n    -   $q = 0.4$\n    -   $\\beta_{T} = 0.08$ $\\mathrm{eV}^{-1}$\n    -   $\\beta_{I} = 0.12$ $\\mathrm{eV}^{-1}$\n    -   $E_{0} = 30$ $\\mathrm{eV}$\n\n**第2步：使用提取的已知条件进行验证**\n-   **科学依据：** 该问题基于定量蛋白质组学中一个公认的问题（共分离导致的比率失真），并使用了简化但科学上合理的模型来描述离子强度和碎裂。碎裂效率的指数饱和模型是此类过程的常规选择。\n-   **适定性：** 该问题是自洽的。它提供了推导所需表达式和计算数值所需的所有必要定义、函数形式和参数。所要求的解由给定的条件唯一确定。\n-   **客观性：** 该问题以精确的技术语言陈述，没有主观或含糊的术语。\n\n该问题没有表现出说明中列出的任何缺陷（例如，科学上不健全、不完整、不切实际）。\n\n**第3步：结论和行动**\n问题被判定为**有效**。将提供解答。\n\n### 观测比率 $R_{\\mathrm{obs}}(E)$ 的推导\n\n令 $I_{j}(E)$ 为在碰撞能量 $E$ 下，通道 $j \\in \\{1, 2\\}$ 中观测到的总报告离子强度。根据问题陈述的前提，该强度是目标（T）和干扰（I）肽段贡献的总和。每个肽段的贡献与其丰度 $a$、其电离/传输因子 $\\eta$ 及其碎裂效率 $\\phi(E)$ 成正比。我们可以将强度写为：\n$$I_{1}(E) = C \\left( \\eta_{T} a_{T,1} \\phi_{T}(E) + \\eta_{I} a_{I,1} \\phi_{I}(E) \\right)$$\n$$I_{2}(E) = C \\left( \\eta_{T} a_{T,2} \\phi_{T}(E) + \\eta_{I} a_{I,2} \\phi_{I}(E) \\right)$$\n其中 $C$ 是与仪器响应相关的比例常数，在比率中将被消去。\n\n观测到的报告离子比率 $R_{\\mathrm{obs}}(E)$ 是通道2与通道1的强度之比：\n$$R_{\\mathrm{obs}}(E) = \\frac{I_{2}(E)}{I_{1}(E)} = \\frac{\\eta_{T} a_{T,2} \\phi_{T}(E) + \\eta_{I} a_{I,2} \\phi_{I}(E)}{\\eta_{T} a_{T,1} \\phi_{T}(E) + \\eta_{I} a_{I,1} \\phi_{I}(E)}$$\n我们使用给定的定义来重新参数化该表达式：\n$a_{T,2} = r \\cdot a_{T,1}$\n$a_{I,2} = s \\cdot a_{I,1}$\n$\\eta_{I} a_{I,1} = q \\cdot \\eta_{T} a_{T,1}$\n\n根据最后两个定义，我们可以用基本量来表示 $\\eta_{I} a_{I,2}$：\n$\\eta_{I} a_{I,2} = \\eta_{I} (s \\cdot a_{I,1}) = s (\\eta_{I} a_{I,1}) = s (q \\cdot \\eta_{T} a_{T,1}) = sq \\cdot \\eta_{T} a_{T,1}$\n\n将这些代入 $R_{\\mathrm{obs}}(E)$ 的表达式中：\n$$R_{\\mathrm{obs}}(E) = \\frac{\\eta_{T} (r a_{T,1}) \\phi_{T}(E) + (sq \\cdot \\eta_{T} a_{T,1}) \\phi_{I}(E)}{\\eta_{T} a_{T,1} \\phi_{T}(E) + (q \\cdot \\eta_{T} a_{T,1}) \\phi_{I}(E)}$$\n公共因子 $\\eta_{T} a_{T,1}$ 从分子和分母中消去：\n$$R_{\\mathrm{obs}}(E) = \\frac{r \\phi_{T}(E) + sq \\phi_{I}(E)}{\\phi_{T}(E) + q \\phi_{I}(E)}$$\n代入给定的效率函数形式 $\\phi_{T}(E) = 1 - \\exp(-\\beta_{T} E)$ 和 $\\phi_{I}(E) = 1 - \\exp(-\\beta_{I} E)$，得到最终的符号表达式：\n$$R_{\\mathrm{obs}}(E) = \\frac{r [1 - \\exp(-\\beta_{T} E)] + sq [1 - \\exp(-\\beta_{I} E)]}{[1 - \\exp(-\\beta_{T} E)] + q [1 - \\exp(-\\beta_{I} E)]}$$\n\n### 一阶灵敏度 $\\frac{d R_{\\mathrm{obs}}}{dE}$ 的推导\n\n为求灵敏度，我们将 $R_{\\mathrm{obs}}(E)$ 对 $E$ 求导。设 $N(E) = r \\phi_{T}(E) + sq \\phi_{I}(E)$ 和 $D(E) = \\phi_{T}(E) + q \\phi_{I}(E)$。使用商法则，$\\frac{d}{dE}(\\frac{N}{D}) = \\frac{N'D - ND'}{D^2}$。\n\n首先，我们求效率的导数：\n$$\\phi'_{T}(E) = \\frac{d}{dE} [1 - \\exp(-\\beta_{T} E)] = \\beta_{T} \\exp(-\\beta_{T} E)$$\n$$\\phi'_{I}(E) = \\frac{d}{dE} [1 - \\exp(-\\beta_{I} E)] = \\beta_{I} \\exp(-\\beta_{I} E)$$\n分子和分母的导数是：\n$N'(E) = r \\phi'_{T}(E) + sq \\phi'_{I}(E)$\n$D'(E) = \\phi'_{T}(E) + q \\phi'_{I}(E)$\n\n$R_{\\mathrm{obs}}(E)$ 导数的分子是 $N'D - ND'$：\n$$N'D - ND' = [r \\phi'_{T} + sq \\phi'_{I}][\\phi_{T} + q \\phi_{I}] - [r \\phi_{T} + sq \\phi_{I}][\\phi'_{T} + q \\phi'_{I}]$$\n展开并合并同类项：\n$$= (r\\phi'_{T}\\phi_{T} + rq\\phi'_{T}\\phi_{I} + sq\\phi'_{I}\\phi_{T} + sq^2\\phi'_{I}\\phi_{I}) - (r\\phi_{T}\\phi'_{T} + rq\\phi_{T}\\phi'_{I} + sq\\phi_{I}\\phi'_{T} + sq^2\\phi_{I}\\phi'_{I})$$\n每个括号中的第一项和最后一项相互抵消（例如，$r\\phi'_{T}\\phi_{T} - r\\phi_{T}\\phi'_{T} = 0$）。我们剩下：\n$$= (rq\\phi'_{T}\\phi_{I} + sq\\phi'_{I}\\phi_{T}) - (rq\\phi_{T}\\phi'_{I} + sq\\phi_{I}\\phi'_{T})$$\n$$= rq(\\phi'_{T}\\phi_{I} - \\phi_{T}\\phi'_{I}) + sq(\\phi'_{I}\\phi_{T} - \\phi_{I}\\phi'_{T})$$\n$$= rq(\\phi'_{T}\\phi_{I} - \\phi_{T}\\phi'_{I}) - sq(\\phi'_{T}\\phi_{I} - \\phi_{T}\\phi'_{I})$$\n$$= q(r-s)[\\phi'_{T}(E)\\phi_{I}(E) - \\phi_{T}(E)\\phi'_{I}(E)]$$\n导数的完整表达式是：\n$$\\frac{d R_{\\mathrm{obs}}}{dE} = \\frac{q(r-s)[\\phi'_{T}(E)\\phi_{I}(E) - \\phi_{T}(E)\\phi'_{I}(E)]}{[\\phi_{T}(E) + q \\phi_{I}(E)]^2}$$\n\n### 数值计算\n\n我们使用给定的参数：$r = 5$、$s = 1$、$q = 0.4$、$\\beta_{T} = 0.08$ $\\mathrm{eV}^{-1}$、$\\beta_{I} = 0.12$ $\\mathrm{eV}^{-1}$，在 $E = E_{0} = 30$ eV 处计算导数。\n\n首先，在 $E_0=30$ 处计算指数项：\n$$\\beta_{T} E_{0} = 0.08 \\times 30 = 2.4$$\n$$\\beta_{I} E_{0} = 0.12 \\times 30 = 3.6$$\n$$\\exp(-\\beta_{T} E_{0}) = \\exp(-2.4)$$\n$$\\exp(-\\beta_{I} E_{0}) = \\exp(-3.6)$$\n\n接着，在 $E_0 = 30$ 处计算 $\\phi_T$, $\\phi_I$, $\\phi'_T$ 和 $\\phi'_I$：\n$$\\phi_{T}(E_{0}) = 1 - \\exp(-2.4) \\approx 1 - 0.090718 = 0.909282$$\n$$\\phi_{I}(E_{0}) = 1 - \\exp(-3.6) \\approx 1 - 0.027324 = 0.972676$$\n$$\\phi'_{T}(E_{0}) = \\beta_{T} \\exp(-\\beta_{T} E_{0}) = 0.08 \\exp(-2.4) \\approx 0.08 \\times 0.090718 = 0.0072574$$\n$$\\phi'_{I}(E_{0}) = \\beta_{I} \\exp(-\\beta_{I} E_{0}) = 0.12 \\exp(-3.6) \\approx 0.12 \\times 0.027324 = 0.0032789$$\n\n现在，计算导数表达式的分子：\n$$N_{\\mathrm{deriv}} = q(r-s)[\\phi'_{T}(E_{0})\\phi_{I}(E_{0}) - \\phi_{T}(E_{0})\\phi'_{I}(E_{0})]$$\n$$N_{\\mathrm{deriv}} \\approx 0.4(5-1)[(0.0072574)(0.972676) - (0.909282)(0.0032789)]$$\n$$N_{\\mathrm{deriv}} \\approx 1.6[0.0070600 - 0.0029814] = 1.6[0.0040786] \\approx 0.00652576$$\n\n接着，计算分母：\n$$D_{\\mathrm{deriv}} = [\\phi_{T}(E_{0}) + q \\phi_{I}(E_{0})]^2$$\n$$D_{\\mathrm{deriv}} \\approx [0.909282 + 0.4(0.972676)]^2$$\n$$D_{\\mathrm{deriv}} \\approx [0.909282 + 0.389070]^2 = [1.298352]^2 \\approx 1.685718$$\n\n最后，计算灵敏度：\n$$\\frac{d R_{\\mathrm{obs}}}{dE}\\bigg|_{E = E_{0}} = \\frac{N_{\\mathrm{deriv}}}{D_{\\mathrm{deriv}}} \\approx \\frac{0.00652576}{1.685718} \\approx 0.0038710$$\n\n将结果四舍五入到四位有效数字得到 $0.003871$。在中间计算中使用更高精度：\n$N_{\\mathrm{deriv}} = 1.6 \\times [0.08\\exp(-2.4)(1-\\exp(-3.6)) - 0.12\\exp(-3.6)(1-\\exp(-2.4))]$\n$= 1.6 \\times [0.08\\exp(-2.4) - 0.08\\exp(-6.0) - 0.12\\exp(-3.6) + 0.12\\exp(-6.0)]$\n$= 1.6 \\times [0.08\\exp(-2.4) - 0.12\\exp(-3.6) + 0.04\\exp(-6.0)]$\n$\\approx 1.6 \\times [0.007257436 - 0.003278847 + 0.000099150] = 1.6 \\times 0.004077739 \\approx 0.00652438$\n$D_{\\mathrm{deriv}} = [ (1-\\exp(-2.4)) + 0.4(1-\\exp(-3.6)) ]^2 \\approx [1.29835256]^2 \\approx 1.6857193$\n灵敏度 $\\approx \\frac{0.00652438}{1.6857193} \\approx 0.0038703$。\n四舍五入到四位有效数字得到 $0.003870$。\n单位是 $\\mathrm{eV}^{-1}$，因为导数是关于以 $\\mathrm{eV}$ 为单位的能量求的。", "answer": "$$\\boxed{0.003870}$$", "id": "3712571"}, {"introduction": "在海量的质谱数据中，如何可靠地从谱图（spectrum）中鉴定出肽段（peptide）是蛋白质组学数据分析的核心。本练习将引导您设计并实现一个基于贝叶斯定理的肽段-谱图匹配（PSM）概率评分模型，该模型能够整合多种独立的观测特征（如质量精度、匹配碎片离子强度和数量）[@problem_id:3712617]。通过亲手构建这个模型，您不仅能深入理解现代蛋白质鉴定软件背后的统计原理，还能掌握将理论模型转化为实用计算工具的核心技能。", "problem": "您的任务是在蛋白质组学中使用的串联质谱 (MS/MS) 领域，以及更广泛的有机化合物光谱鉴定背景下，设计并实现一个用于肽谱匹配 (PSM) 的概率评分模型。该模型必须包含候选PSM的三个独立观测特征：绝对质量测量误差、累积匹配碎片离子强度分数和匹配峰数量。仅从基础概率论和每个特征的经验驱动分布族出发，您的程序必须为一组预定义的候选PSM计算其正确鉴定的后验概率。\n\n使用以下符合上下文的基础和假设：\n\n- 基本贝叶斯定理：对于二元潜在假设 $H \\in \\{\\text{correct}, \\text{incorrect}\\}$ 和观测特征 $\\mathbf{x}$，后验概率 $P(H \\mid \\mathbf{x})$ 是先验概率 $P(H)$ 和似然 $p(\\mathbf{x} \\mid H)$ 的函数。\n- 在给定 $H$ 的条件下，特征间的独立性假设：$p(\\mathbf{x} \\mid H) = \\prod_{j} p(x_j \\mid H)$，其中 $x_j$ 是特征值。\n- 特征定义和物理上一致的测量域：\n  1. 绝对质量测量误差 $\\varepsilon$，单位为百万分率 (ppm)，定义为非负标量。以 $\\mathrm{ppm}$ 表示 $\\varepsilon$ 值。\n  2. 累积匹配碎片离子强度分数 $f \\in (0,1)$，定义为由匹配的碎片离子集解释的总离子流的分数，无量纲。\n  3. 匹配峰数量 $k \\in \\{0,1,2,\\dots\\}$，定义为匹配的碎片离子峰的非负整数数量。\n\n使用经验驱动的参数族为假设 $\\text{correct}$ 和 $\\text{incorrect}$ 下的每个特征的似然建模：\n\n- 对于质量精度，在每个假设下使用半正态分布对绝对误差 $\\varepsilon$ 进行建模。在 $\\text{correct}$ 假设下，使用尺度参数 $\\sigma_c = 5\\,\\mathrm{ppm}$；在 $\\text{incorrect}$ 假设下，使用 $\\sigma_i = 50\\,\\mathrm{ppm}$。半正态分布是为 $x \\ge 0$ 定义的，其密度函数具有尺度参数 $\\sigma$。\n- 对于强度分数 $f$，在每个假设下使用 Beta 分布。在 $\\text{correct}$ 假设下，使用 $\\alpha_c = 5$ 和 $\\beta_c = 2$；在 $\\text{incorrect}$ 假设下，使用 $\\alpha_i = 1.5$ 和 $\\beta_i = 5$。Beta 分布定义在 $(0,1)$ 上，形状参数为 $(\\alpha, \\beta)$。\n- 对于匹配峰数量 $k$，使用泊松分布。在 $\\text{correct}$ 假设下，使用率参数 $\\lambda_c = 12$；在 $\\text{incorrect}$ 假设下，使用率参数 $\\lambda_i = 3$。\n\n假设正确鉴定的全局先验概率为 $P(\\text{correct}) = 0.3$，因此 $P(\\text{incorrect}) = 0.7$。\n\n您的任务是使用上述假设，为每个候选PSM计算后验概率 $P(\\text{correct} \\mid \\varepsilon, f, k)$。您必须实现一个数值稳定的计算方法，该方法在独立性假设下结合三个特征的似然，并应用贝叶斯定理来获得后验概率。\n\n所有质量误差以 $\\mathrm{ppm}$ 表示，强度以开区间 $(0,1)$ 内的无量纲分数表示，峰数量以非负整数表示。本问题不涉及角度。输出必须是表示为无量纲区间 $(0,1)$ 内的十进制浮点数的数值概率。\n\n测试套件和参数值：\n- 通用模型参数：\n  - $P(\\text{correct}) = 0.3$。\n  - 半正态分布尺度参数：$\\sigma_c = 5\\,\\mathrm{ppm}$，$\\sigma_i = 50\\,\\mathrm{ppm}$。\n  - Beta 分布形状参数：$(\\alpha_c, \\beta_c) = (5, 2)$ 和 $(\\alpha_i, \\beta_i) = (1.5, 5)$。\n  - 泊松分布率参数：$\\lambda_c = 12$ 和 $\\lambda_i = 3$。\n- 待评估的候选PSM，每个以 $(\\varepsilon\\,\\mathrm{ppm}, f, k)$ 形式给出：\n  1. $(4, 0.65, 14)$\n  2. $(80, 0.12, 2)$\n  3. $(0, 0.90, 0)$\n  4. $(10, 0.40, 8)$\n  5. $(100, 0.60, 20)$\n  6. $(1, 0.05, 3)$\n\n您的程序应生成单行输出，其中包含六个候选PSM的结果，形式为方括号括起来的逗号分隔的后验概率列表，每个浮点数四舍五入到六位小数（例如 $[p_1,p_2,p_3,p_4,p_5,p_6]$）。不应打印任何其他文本。", "solution": "问题陈述已经过严格审查，并被确定为有效。它具有科学依据、良定且客观。所有必要信息均已提供，且所作假设与蛋白质组学中质谱数据统计分析的既定实践相符。因此，我们可以着手进行正式求解。\n\n核心任务是计算给定一个包含三个观测特征 $\\mathbf{x} = (\\varepsilon, f, k)$ 的向量时，一个正确的肽谱匹配 (PSM) 的后验概率，记为 $P(H_c \\mid \\mathbf{x})$。假设 $H_c$ 代表正确鉴定，而备择假设 $H_i$ 代表不正确鉴定。这些特征分别是绝对母离子质量误差 $\\varepsilon$、匹配碎片离子强度分数 $f$ 和匹配峰数量 $k$。\n\n分析框架由贝叶斯定理提供。对于二元假设空间 $\\{H_c, H_i\\}$，正确匹配的后验概率为：\n$$ P(H_c \\mid \\mathbf{x}) = \\frac{p(\\mathbf{x} \\mid H_c) P(H_c)}{p(\\mathbf{x})} $$\n分母 $p(\\mathbf{x})$ 是边缘似然或“证据”，通过全概率定律获得：\n$$ p(\\mathbf{x}) = p(\\mathbf{x} \\mid H_c) P(H_c) + p(\\mathbf{x} \\mid H_i) P(H_i) $$\n将此代入主方程，得到后验概率的完整表达式：\n$$ P(H_c \\mid \\mathbf{x}) = \\frac{p(\\mathbf{x} \\mid H_c) P(H_c)}{p(\\mathbf{x} \\mid H_c) P(H_c) + p(\\mathbf{x} \\mid H_i) P(H_i)} $$\n问题指定了先验概率为 $P(H_c) = 0.3$，因此 $P(H_i) = 1 - P(H_c) = 0.7$。\n\n一个核心假设是在给定假设的条件下，各特征是条件独立的。这使得联合似然 $p(\\mathbf{x} \\mid H)$ 可以分解为单个似然的乘积：\n$$ p(\\mathbf{x} \\mid H) = p(\\varepsilon \\mid H) \\cdot p(f \\mid H) \\cdot p(k \\mid H) $$\n\n每个特征的似然函数由指定的参数分布建模：\n\n1.  **绝对质量误差 ($\\varepsilon \\ge 0$)**：似然由半正态分布建模，其概率密度函数 (PDF) 为 $p(x; \\sigma) = \\frac{\\sqrt{2}}{\\sigma\\sqrt{\\pi}} \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right)$，适用于 $x \\ge 0$。\n    - 对于 $H_c$ (正确)：$p(\\varepsilon \\mid H_c)$ 使用尺度参数 $\\sigma_c = 5 \\, \\mathrm{ppm}$。\n    - 对于 $H_i$ (不正确)：$p(\\varepsilon \\mid H_i)$ 使用尺度参数 $\\sigma_i = 50 \\, \\mathrm{ppm}$。\n\n2.  **强度分数 ($f \\in (0,1)$)**：似然由 Beta 分布建模，其 PDF 为 $p(x; \\alpha, \\beta) = \\frac{x^{\\alpha-1}(1-x)^{\\beta-1}}{B(\\alpha, \\beta)}$，其中 $B(\\alpha, \\beta)$ 是 Beta 函数。\n    - 对于 $H_c$：$p(f \\mid H_c)$ 使用形状参数 $(\\alpha_c, \\beta_c) = (5, 2)$。\n    - 对于 $H_i$：$p(f \\mid H_i)$ 使用形状参数 $(\\alpha_i, \\beta_i) = (1.5, 5)$。\n\n3.  **匹配峰数量 ($k \\in \\{0, 1, 2, \\dots\\}$)**：似然由泊松分布建模，其概率质量函数 (PMF) 为 $p(k; \\lambda) = \\frac{\\lambda^k e^{-\\lambda}}{k!}$。\n    - 对于 $H_c$：$p(k \\mid H_c)$ 使用率参数 $\\lambda_c = 12$。\n    - 对于 $H_i$：$p(k \\mid H_i)$ 使用率参数 $\\lambda_i = 3$。\n\n为确保数值稳定性，计算应在对数空间中进行，以减轻因乘以多个小概率值而导致的潜在下溢或上溢。假设 $H$ 的联合对数似然是各个对数似然之和：\n$$ \\log p(\\mathbf{x} \\mid H) = \\log p(\\varepsilon \\mid H) + \\log p(f \\mid H) + \\log p(k \\mid H) $$\n令 $L_c = p(\\mathbf{x} \\mid H_c)$ 和 $L_i = p(\\mathbf{x} \\mid H_i)$。我们计算它们的对数 $\\log L_c$ 和 $\\log L_i$。\n\n后验概率的计算可以使用这些对数似然重新表述。令 $\\pi_c = P(H_c)$ 和 $\\pi_i = P(H_i)$。每个假设的未归一化对数后验为：\n$$ \\log P'_c = \\log L_c + \\log \\pi_c $$\n$$ \\log P'_i = \\log L_i + \\log \\pi_i $$\n后验概率 $P(H_c \\mid \\mathbf{x})$ 可以写为：\n$$ P(H_c \\mid \\mathbf{x}) = \\frac{\\exp(\\log P'_c)}{\\exp(\\log P'_c) + \\exp(\\log P'_i)} $$\n为了在对可能非常大或非常小的数进行指数运算时防止数值不稳定性，此表达式被转换。我们定义对数后验优势比 $\\Lambda$：\n$$ \\Lambda = \\log\\left(\\frac{P'_c}{P'_i}\\right) = \\log P'_c - \\log P'_i $$\n后验概率则等价于 $\\Lambda$ 的 logistic 函数 (sigmoid)：\n$$ P(H_c \\mid \\mathbf{x}) = \\frac{1}{1 + \\exp(-\\Lambda)} $$\n这种表述在数值上是稳健的，将用于实现。\n\n对于每个候选PSM $(\\varepsilon, f, k)$ 的算法如下：\n1.  计算正确假设 ($H_c$) 的对数似然：$\\log p(\\varepsilon \\mid H_c)$、$\\log p(f \\mid H_c)$ 和 $\\log p(k \\mid H_c)$，使用参数 $(\\sigma_c, \\alpha_c, \\beta_c, \\lambda_c)$。将它们相加得到 $\\log L_c$。\n2.  计算不正确假设 ($H_i$) 的对数似然：$\\log p(\\varepsilon \\mid H_i)$、$\\log p(f \\mid H_i)$ 和 $\\log p(k \\mid H_i)$，使用参数 $(\\sigma_i, \\alpha_i, \\beta_i, \\lambda_i)$。将它们相加得到 $\\log L_i$。\n3.  计算未归一化的对数后验：$\\log P'_c = \\log L_c + \\log(0.3)$ 和 $\\log P'_i = \\log L_i + \\log(0.7)$。\n4.  计算对数后验优势：$\\Lambda = \\log P'_c - \\log P'_i$。\n5.  计算最终后验概率：$P(H_c \\mid \\mathbf{x}) = (1 + \\exp(-\\Lambda))^{-1}$。\n\n此过程将应用于六个指定的测试用例中的每一个。", "answer": "[0.985655,0.000003,0.000000,0.485141,0.000350,0.006126]", "id": "3712617"}]}