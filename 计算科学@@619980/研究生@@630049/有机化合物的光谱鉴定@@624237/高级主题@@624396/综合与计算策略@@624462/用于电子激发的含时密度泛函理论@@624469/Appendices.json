{"hands_on_practices": [{"introduction": "理论计算通常在气相中进行，但这往往不足以解释在溶液中进行的实验。理解溶剂如何改变吸收峰的位置（即溶剂化显色效应）对于解读真实世界的光谱至关重要。本练习 [@problem_id:3727847] 将指导您推导并实现一个基本模型，该模型结合了含时密度泛函理论（TDDFT）和可极化连续介质模型（PCM），用于量化这些能量位移，从而将分子的偶极矩等微观量子力学性质与溶剂的宏观介电特性联系起来。", "problem": "您的任务是构建一个基于物理原理的定量模型，推导其控制表达式，并实现一个算法，用以评估溶剂对“推拉式”有机染料的电荷转移激发能的稳定化作用，这与紫外-可见（UV-Vis）光谱鉴定相关。该建模框架是含时密度泛函理论（TDDFT）和可极化连续介质模型（PCM）在垂直（非平衡）激发条件下的结合。您的任务是从一个有效的基础理论出发，生成一个能够得出溶剂依赖的激发能移的计算方法。\n\n请从以下经过充分检验的基础理论和核心定义开始：\n- 线性响应含时密度泛函理论（TDDFT）：真空中的电子激发能是通过电子密度对含时微扰的线性响应获得的，在绝热近似中，激发能被定义为响应核的本征值。\n- 电介质中偶极子的连续介质静电学：一个嵌入在均匀、各向同性电介质中半径为$R$的球形空腔内的分子偶极子，会受到一个与偶极矩成线性比例的反应场，其系数由介质的介电性质和线性电介质的麦克斯韦方程组所决定的边界条件确定。\n- 垂直激发下的非平衡溶剂化概念：在突发的电子激发后，只有溶剂的快速电子极化（由光学介电常数表征）会瞬时响应；而较慢的核-取向极化在跃迁的时间尺度上保持冻结。\n\n在此框架内，定义一个经历从基态$g$到激发态$e$的电荷转移（CT）激发的推拉式染料。真空激发能$E_0$是已知的。染料在基态和激发态的偶极矩$\\mu_g$和$\\mu_e$被建模为共线且已给出。溶剂由一个半径为$R$的可极化连续介质模型（PCM）球形空腔表示。\n\n基于上述原理，推导一个物理上一致的、关于垂直激发溶剂稳定化能量位移$\\Delta E$的表达式，该表达式以电子伏特（eV）为单位，是以下变量的函数：\n- 基态和激发态偶极矩$\\mu_g$和$\\mu_e$（以德拜为单位），\n- 空腔半径$R$（以埃为单位），\n- 溶剂的静态介电常数$\\varepsilon_s$和光学介电常数$\\varepsilon_\\infty$（其中$\\varepsilon_\\infty = n^2$，$n$是光频下的折射率），\n- 真空介电常数$\\varepsilon_0$。\n\n您的推导必须：\n- 清晰地指明哪些极化分量是瞬时贡献的，哪些在激发时刻保持冻结。\n- 为快速和慢速极化分量的能量计算提供合理解释，并生成一个相对于真空的垂直激发能移$\\Delta E$的最终表达式。\n- 指明单位转换方法，以确保当$\\mu$以德拜为单位、$R$以埃为单位时，计算出的$\\Delta E$以eV为单位。\n\n算法实现要求：\n- 实现推导出的表达式，为一组不同极性的溶剂计算$\\Delta E$。\n- 为每种溶剂计算溶剂依赖的激发能$E = E_0 + \\Delta E$。\n\n测试套件和参数：\n使用以下四种染料案例和五种溶剂。对于每种染料案例，计算其在所有五种溶剂中的溶剂稳定化能$\\Delta E$和溶剂致位移的激发能$E$。\n\n染料案例（所有激发能$E_0$单位为eV，偶极矩单位为德拜，空腔半径单位为埃）：\n1. $E_0 = 2.40$, $\\mu_g = 5.0$, $\\mu_e = 18.0$, $R = 6.0$.\n2. $E_0 = 3.10$, $\\mu_g = 4.0$, $\\mu_e = 10.0$, $R = 5.0$.\n3. $E_0 = 2.80$, $\\mu_g = 8.0$, $\\mu_e = 8.0$, $R = 6.0$.\n4. $E_0 = 2.10$, $\\mu_g = 3.0$, $\\mu_e = 22.0$, $R = 4.5$.\n\n溶剂（静态介电常数$\\varepsilon_s$无量纲，折射率$n$无量纲；光学介电常数$\\varepsilon_\\infty = n^2$）：\n- 正己烷 (n-Hexane): $\\varepsilon_s = 1.89$, $n = 1.375$.\n- 甲苯 (Toluene): $\\varepsilon_s = 2.38$, $n = 1.496$.\n- 二氯甲烷 (Dichloromethane): $\\varepsilon_s = 8.93$, $n = 1.424$.\n- 乙腈 (Acetonitrile): $\\varepsilon_s = 35.94$, $n = 1.344$.\n- 水 (Water): $\\varepsilon_s = 78.30$, $n = 1.333$.\n\n使用的常数和单位转换：\n- 真空介电常数: $\\varepsilon_0 = 8.854187817 \\times 10^{-12}\\ \\mathrm{F/m}$。\n- 德拜到库仑·米: $1\\ \\mathrm{D} = 3.33564 \\times 10^{-30}\\ \\mathrm{C \\cdot m}$。\n- 埃到米: $1\\ \\mathrm{\\AA} = 1.0 \\times 10^{-10}\\ \\mathrm{m}$。\n- 焦耳到电子伏特: $1\\ \\mathrm{eV} = 1.602176634 \\times 10^{-19}\\ \\mathrm{J}$。\n\n最终输出规范：\n- 对于每个染料案例，返回一个包含两个列表的列表：第一个是五种溶剂的溶剂稳定化值$\\Delta E$（单位eV），第二个是对应的五种溶剂的溶剂致位移的激发能$E$（单位eV）。\n- 将每个浮点结果四舍五入到六位小数。\n- 您的程序应生成单行输出，包含一个由方括号括起来的、以逗号分隔的结果列表。总体结构是一个按案例排列结果的列表：对于案例$i$，其元素为$[\\,[\\Delta E_1,\\Delta E_2,\\Delta E_3,\\Delta E_4,\\Delta E_5],\\,[E_1,E_2,E_3,E_4,E_5]\\,]$；顶层输出为$[\\,\\text{案例}_1,\\text{案例}_2,\\text{案例}_3,\\text{案例}_4\\,]$，且必须打印在同一行上。所有能量必须以eV报告。\n\n测试套件需覆盖的边界情况：\n- 案例3中$\\mu_e = \\mu_g$，应导致所有溶剂的$\\Delta E = 0$。\n- 案例4具有小空腔半径和大偶极矩变化，用于测试增强的稳定化效应。\n- 所选溶剂覆盖了从低到高的静态介电常数范围，用于测试对极性的敏感度。\n\n此任务不涉及角度。所有能量均以eV表示。解决方案必须实现为一个完整的、可运行的程序，并遵守给定的运行环境。", "solution": "问题陈述已经过严格评估，并被确定是有效的。它在科学上基于计算化学的既定原理，特别是含时密度泛函理论（TDDFT）和可极化连续介质模型（PCM）。该问题提法恰当、客观、自洽，并为获得唯一且有意义的解提供了所有必要的数据和常数。其底层的物理模型是计算电子光谱中溶剂化显色效应位移的一种标准且可验证的方法。\n\n任务是推导垂直电子激发能的溶剂致位移$\\Delta E$的表达式，并编写程序为几个测试案例计算此位移。推导将基于非平衡溶剂化框架内的连续介质静电学。\n\n**1. 理论框架**\n\n该模型将溶质（染料分子）视为位于半径为$R$的球形空腔中心的点偶极子。溶剂是一种连续、均匀、各向同性的电介质，其特性由静态介电常数$\\varepsilon_s$和光学介电常数$\\varepsilon_\\infty$描述。光学介电常数与溶剂的折射率$n$通过$\\varepsilon_\\infty = n^2$相关联。\n\n偶极子$\\vec{\\mu}$与其在周围电介质中感应出的反应场$\\vec{\\mathcal{R}}$之间的相互作用能产生了溶剂化能。对于球形空腔，Onsager反应场由下式给出：\n$$\n\\vec{\\mathcal{R}}(\\vec{\\mu}) = \\frac{2}{4\\pi\\varepsilon_0 R^3} \\left( \\frac{\\varepsilon - 1}{2\\varepsilon + 1} \\right) \\vec{\\mu}\n$$\n其中$\\varepsilon$是介质的介电常数。我们定义介电函数$f(\\varepsilon)$为：\n$$\nf(\\varepsilon) = \\frac{\\varepsilon - 1}{2\\varepsilon + 1}\n$$\n总溶剂化自由能，包括极化介质所做的功，为$G_{solv} = -\\frac{1}{2} \\vec{\\mu} \\cdot \\vec{\\mathcal{R}}(\\vec{\\mu})$。由于基态和激发态偶极子$\\vec{\\mu}_g$和$\\vec{\\mu}_e$被说明为共线，我们可以使用它们的标量大小$\\mu_g$和$\\mu_e$。具有偶极子$\\mu$的态的平衡溶剂化能为：\n$$\nG_{solv}^{eq}(\\mu) = -\\frac{1}{4\\pi\\varepsilon_0 R^3} f(\\varepsilon_s) \\mu^2\n$$\n\n**2. 垂直激发的非平衡溶剂化**\n\n垂直电子激发是一个基本上瞬时的过程（飞秒量级）。溶剂的响应被分为两个部分：\n- **快速极化**：溶剂的电子极化，它能瞬时响应溶质电子密度的变化。此响应由$\\varepsilon_\\infty$控制。\n- **慢速极化**：溶剂的取向和核极化，其变化速度太慢，无法在电子跃迁期间改变。它保持“冻结”在对应于初始（基态）的构型中。\n\n我们可以将反应场和溶剂化能分解为快速和慢速分量。快速分量与介电函数$f(\\varepsilon_\\infty)$相关，而慢速分量与差值$\\Delta f = f(\\varepsilon_s) - f(\\varepsilon_\\infty)$相关。\n\n**3. 激发能移$\\Delta E$的推导**\n\n溶质-溶剂体系在基态（$g$）和非平衡激发态（$e$）的总能量决定了溶液中的激发能。\n\n**基态能量（$U_g$）**：体系处于完全平衡状态。溶剂完全极化以响应基态偶极矩$\\mu_g$。总能量是真空能量$E_g^{vac}$与平衡溶剂化自由能$G_{solv}^{eq}(\\mu_g)$之和。\n$$\nU_g = E_g^{vac} + G_{solv}^{eq}(\\mu_g) = E_g^{vac} - \\frac{\\mu_g^2}{4\\pi\\varepsilon_0 R^3} f(\\varepsilon_s)\n$$\n\n**非平衡激发态能量（$U_e$）**：紧随垂直跃迁之后，溶质具有激发态偶极矩$\\mu_e$。溶剂极化的快速分量已经与$\\mu_e$平衡，但慢速分量仍然按照基态偶极矩$\\mu_g$极化。总能量$U_e$是激发态的真空能量$E_e^{vac}$与非平衡溶剂化自由能$G_{solv}^{neq}(e)$之和。$G_{solv}^{neq}(e)$由三项组成：\n1. 响应$\\mu_e$的快速极化的平衡自由能：$G_{fast,eq}(\\mu_e) = -\\frac{1}{2} \\mu_e \\mathcal{R}_{fast}(\\mu_e) = -\\frac{\\mu_e^2}{4\\pi\\varepsilon_0 R^3} f(\\varepsilon_\\infty)$。\n2. 偶极子$\\mu_e$与慢速反应场分量的相互作用能，该慢速场分量冻结在与$\\mu_g$平衡的状态：$V_{int} = -\\mu_e \\mathcal{R}_{slow}(\\mu_g) = -\\frac{2\\mu_e\\mu_g}{4\\pi\\varepsilon_0 R^3} \\Delta f$。\n3. 慢速极化场的自能（重组能），此时该场仍对应于$\\mu_g$：$G_{slow,reorg} = \\frac{1}{2} \\mu_g \\mathcal{R}_{slow}(\\mu_g) = \\frac{\\mu_g^2}{4\\pi\\varepsilon_0 R^3} \\Delta f$。\n\n将这些贡献相加，得到非平衡溶剂化能：\n$$\nG_{solv}^{neq}(e) = -\\frac{1}{4\\pi\\varepsilon_0 R^3} \\left[ f(\\varepsilon_\\infty)\\mu_e^2 + 2\\mu_e\\mu_g\\Delta f - \\mu_g^2\\Delta f \\right]\n$$\n非平衡激发态的总能量为：\n$$\nU_e = E_e^{vac} + G_{solv}^{neq}(e)\n$$\n溶液中的激发能$E$是这些总能量之差：\n$$\nE = U_e - U_g = (E_e^{vac} - E_g^{vac}) + (G_{solv}^{neq}(e) - G_{solv}^{eq}(\\mu_g))\n$$\n真空激发能为$E_0 = E_e^{vac} - E_g^{vac}$。因此，位移$\\Delta E$为：\n$$\n\\Delta E = E - E_0 = G_{solv}^{neq}(e) - G_{solv}^{eq}(\\mu_g)\n$$\n代入推导出的表达式：\n$$\n\\Delta E = -\\frac{1}{4\\pi\\varepsilon_0 R^3} \\left[ f(\\varepsilon_\\infty)\\mu_e^2 + 2\\mu_e\\mu_g\\Delta f - \\mu_g^2\\Delta f \\right] - \\left( -\\frac{\\mu_g^2}{4\\pi\\varepsilon_0 R^3} f(\\varepsilon_s) \\right)\n$$\n使用$f(\\varepsilon_s) = f(\\varepsilon_\\infty) + \\Delta f$：\n$$\n\\Delta E = \\frac{1}{4\\pi\\varepsilon_0 R^3} \\left[ -f(\\varepsilon_\\infty)\\mu_e^2 - 2\\mu_e\\mu_g\\Delta f + \\mu_g^2\\Delta f + \\mu_g^2(f(\\varepsilon_\\infty) + \\Delta f) \\right]\n$$\n$$\n\\Delta E = \\frac{1}{4\\pi\\varepsilon_0 R^3} \\left[ -f(\\varepsilon_\\infty)\\mu_e^2 - 2\\mu_e\\mu_g\\Delta f + 2\\mu_g^2\\Delta f + \\mu_g^2 f(\\varepsilon_\\infty) \\right]\n$$\n$$\n\\Delta E = -\\frac{1}{4\\pi\\varepsilon_0 R^3} \\left[ f(\\varepsilon_\\infty)(\\mu_e^2 - \\mu_g^2) + 2\\Delta f (\\mu_e\\mu_g - \\mu_g^2) \\right]\n$$\n这可以简化为最终的、物理意义清晰的表达式：\n$$\n\\Delta E = - \\frac{1}{4\\pi\\varepsilon_0 R^3} \\left[ f(\\varepsilon_\\infty)(\\mu_e^2 - \\mu_g^2) + \\left(f(\\varepsilon_s) - f(\\varepsilon_\\infty)\\right) \\cdot 2\\mu_g(\\mu_e - \\mu_g) \\right]\n$$\n\n**4. 单位转换和实现**\n\n为了实现这个公式，我们需要一个转换因子，以便在偶极矩$\\mu$以德拜（D）为单位、半径$R$以埃（Å）为单位时，计算出以电子伏特（eV）为单位的$\\Delta E$。能量与$\\mu^2/R^3$成正比。我们计算用于将原子单位体系的$(\\mathrm{D}^2/\\mathrm{\\AA}^3)$转换为$\\mathrm{eV}$的前置因子$C_{\\text{factor}}$。\n\n$\\frac{1}{4\\pi\\varepsilon_0}$项在SI单位制中约等于$8.98755 \\times 10^9 \\ \\mathrm{N \\cdot m^2 \\cdot C^{-2}}$。以焦耳为单位的完整前置因子为：\n$$\n\\frac{(1\\ \\mathrm{D})^2}{(1\\ \\mathrm{\\AA})^3} \\frac{1}{4\\pi\\varepsilon_0} = \\frac{(3.33564 \\times 10^{-30}\\ \\mathrm{C \\cdot m})^2}{(1.0 \\times 10^{-10}\\ \\mathrm{m})^3} \\frac{1}{4\\pi (8.854187817 \\times 10^{-12}\\ \\mathrm{F/m})}\n$$\n此计算得出$0.999999 \\times 10^{-19}\\ \\mathrm{J}$。将焦耳转换为电子伏特：\n$$\nC_{\\text{factor}} = \\frac{0.999999 \\times 10^{-19}\\ \\mathrm{J}}{1.602176634 \\times 10^{-19}\\ \\mathrm{J/eV}} \\approx 0.6241509\\ \\mathrm{eV \\cdot \\AA^3 \\cdot D^{-2}}\n$$\n以$\\mathrm{eV}$为单位的$\\Delta E$的最终可计算表达式为：\n$$\n\\Delta E = -C_{\\text{factor}} \\frac{1}{R^3} \\left[ f(\\varepsilon_\\infty)(\\mu_e^2 - \\mu_g^2) + \\left(f(\\varepsilon_s) - f(\\varepsilon_\\infty)\\right) \\cdot 2\\mu_g(\\mu_e - \\mu_g) \\right]\n$$\n其中$\\mu_g, \\mu_e$以德拜为单位，R以埃为单位。该算法将此公式应用于每个染料-溶剂对，计算$\\Delta E$，然后计算溶剂致位移的激发能$E = E_0 + \\Delta E$。", "answer": "```python\nimport numpy as np\nimport json\n\ndef solve():\n    \"\"\"\n    Calculates the solvent stabilization energy shift for charge-transfer excitations\n    based on the non-equilibrium Polarizable Continuum Model (PCM).\n    \"\"\"\n\n    # Constants and Unit Conversions\n    EPSILON_0 = 8.854187817e-12  # Vacuum permittivity in F/m\n    DEBYE_TO_CM = 3.33564e-30      # 1 Debye in Coulomb-meters\n    ANGSTROM_TO_M = 1.0e-10        # 1 Angstrom in meters\n    JOULE_TO_EV = 1.602176634e-19  # 1 eV in Joules\n\n    # Pre-calculate the conversion factor from D^2/A^3 to eV\n    # Factor = (1/(4*pi*eps0)) * (D_to_Cm^2 / A_to_m^3) / J_to_eV\n    joules_per_unit = (1 / (4 * np.pi * EPSILON_0)) * (DEBYE_TO_CM**2 / ANGSTROM_TO_M**3)\n    EV_FACTOR = joules_per_unit / JOULE_TO_EV\n    \n    # Test cases for dyes\n    # (E0 in eV, mu_g in Debye, mu_e in Debye, R in Angstroms)\n    dye_cases = [\n        (2.40, 5.0, 18.0, 6.0),\n        (3.10, 4.0, 10.0, 5.0),\n        (2.80, 8.0, 8.0, 6.0),\n        (2.10, 3.0, 22.0, 4.5),\n    ]\n\n    # Solvent parameters\n    # (name, static dielectric eps_s, refractive index n)\n    solvents = [\n        ('n-Hexane', 1.89, 1.375),\n        ('Toluene', 2.38, 1.496),\n        ('Dichloromethane', 8.93, 1.424),\n        ('Acetonitrile', 35.94, 1.344),\n        ('Water', 78.30, 1.333),\n    ]\n\n    def dielectric_func(epsilon):\n        \"\"\"Calculates the Onsager dielectric function f(epsilon).\"\"\"\n        if epsilon == -0.5:\n             # Avoid division by zero, though physically unlikely\n             return np.inf\n        return (epsilon - 1) / (2 * epsilon + 1)\n\n    all_results = []\n    \n    for case_params in dye_cases:\n        e0, mu_g, mu_e, R = case_params\n        \n        delta_e_list = []\n        final_e_list = []\n        \n        for solvent_params in solvents:\n            _, eps_s, n = solvent_params\n            \n            eps_inf = n**2\n            \n            f_eps_s = dielectric_func(eps_s)\n            f_eps_inf = dielectric_func(eps_inf)\n            \n            # The derived expression for the energy shift in eV\n            # Delta_E = -C_factor * (1/R^3) * [f(eps_inf)*(mu_e^2 - mu_g^2) + (f(eps_s) - f(eps_inf))*2*mu_g*(mu_e - mu_g)]\n            \n            term1 = f_eps_inf * (mu_e**2 - mu_g**2)\n            term2 = (f_eps_s - f_eps_inf) * 2 * mu_g * (mu_e - mu_g)\n            \n            delta_e = -EV_FACTOR * (1 / R**3) * (term1 + term2)\n            final_e = e0 + delta_e\n            \n            delta_e_list.append(round(delta_e, 6))\n            final_e_list.append(round(final_e, 6))\n            \n        all_results.append([delta_e_list, final_e_list])\n\n    # Custom JSON-like string formatting to match the output specification exactly.\n    # json.dumps adds spaces which might not be desired. This gives full control.\n    def format_list(lst):\n        if isinstance(lst, list):\n            return f\"[{','.join(map(format_list, lst))}]\"\n        return str(lst)\n\n    print(format_list(all_results))\n\nsolve()\n\n```", "id": "3727847"}, {"introduction": "电子跃迁在实验上并非表现为无限窄的谱线，而是具有一定的峰形。电子态与分子振动的耦合会产生丰富的振动电子能级结构（vibronic structure），这决定了吸收带的形状。本练习 [@problem_id:3727865] 深入探讨了如何通过应用Franck-Condon原理来模拟这些光谱形状，将TDDFT计算的输出（如振动频率和Huang-Rhys因子）转化为可与实验进行视觉和定量比较的振动光谱。", "problem": "您的任务是构建一个计算流程，使用基于含时密度泛函理论 (Time Dependent Density Functional Theory, TDDFT) 梯度可推导参数的平行简正模式谐振子近似，来组装一个有机生色团的振动吸收光谱。您必须将数学原理形式化，并实现一个程序，该程序在给定一组以 Huang–Rhys 因子编码的振动模式频率和无量纲位移的情况下，计算 Franck–Condon 因子，构建一个包含热初始态布居的线状谱，并生成一个高斯展宽光谱。然后，您必须为每个测试用例报告一小组总结性量。\n\n您的推导必须基于以下基本原理：\n- 每个简正模式在基态和激发电子态中的谐振子哈密顿量。谐振子能级为 $E_{n} = \\hbar \\omega \\left(n + \\tfrac{1}{2}\\right)$，其中 $n \\in \\{0,1,2,\\dots\\}$。\n- 在平行模式近似（Duschinsky 转动可忽略）下，激发态的简正模式坐标相对于基态的坐标发生了位移，该位移由每个模式的无量纲位移（由 Huang–Rhys 因子 $S_k \\ge 0$ 编码）描述，其中 $k$ 是模式的索引。\n- Franck–Condon 因子是每个模式上初末振动数态之间振动重叠的模的平方，当模式是独立且谐和的时，将所有模式的结果相乘。\n- 在温度为 $T$ 开尔文时，基电子态中初始振动占据的正则玻尔兹曼分布：对于单个模式 $k$，占据量子数 $m_k$ 的概率为 $p_{k}(m_k) = (1 - q_k)\\, q_k^{m_k}$，其中 $q_k = \\exp(-\\beta \\hbar \\omega_k)$ 且 $\\beta = 1/(k_{\\mathrm{B}} T)$，$k_{\\mathrm{B}}$ 是玻尔兹曼常数。\n- 从基电子态的初始振动能态 $\\mathbf{m} = (m_1,\\dots,m_{N})$ 到激发电子态的末态振动能态 $\\mathbf{n} = (n_1,\\dots,n_{N})$ 的振动吸收跃迁的光子能量为 $E_{\\mathrm{ph}} = E_{00} + \\sum_{k=1}^{N} \\hbar \\omega_k \\left(n_k - m_k\\right)$，其中 $E_{00}$ 是绝热 $0-0$ 电子跃迁能。在谐振子平行模式近似下，假定所有电子态的 $\\omega_k$ 相同。\n\n您必须实现以下要求：\n- 使用独立模式谐振子近似和平行模式假设。使用等频率下精确的位移谐振子重叠来计算每个模式上 $m_k \\to n_k$ 的 Franck–Condon 因子，并将各模式的结果相乘得到多维跃迁 $(\\mathbf{m} \\to \\mathbf{n})$ 的总 Franck–Condon 因子。通过玻尔兹曼分布包含热初始态布居，并构建线状谱，其强度由热平均 Franck–Condon 因子给出。归一化线状谱强度，使其总和等于 $1$。\n- 对线状谱进行高斯展宽，以在指定的能量网格上获得连续的振动谱线形。对于位于能量 $E_i$、单位面积、宽度为 $\\sigma$ 的谱线，其高斯核函数为 $g(E;E_i,\\sigma) = \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{(E-E_i)^2}{2\\sigma^2}\\right)$。使用测试参数中给出的以电子伏特为单位的 $\\sigma$。\n- 单位与常数：\n  - 使用 $1~\\mathrm{cm}^{-1} = 1/8065.544005~\\mathrm{eV}$ 将波数转换为能量，即 $\\hbar \\omega~[\\mathrm{eV}] = \\omega~[\\mathrm{cm}^{-1}] \\times (1/8065.544005)$。\n  - 使用 $k_{\\mathrm{B}} = 8.617333262145\\times 10^{-5}~\\mathrm{eV/K}$。\n  - 所有能量必须以电子伏特计算和处理，所有频率将以 $\\mathrm{cm}^{-1}$ 指定，且必须按上述方式转换。\n- 截断与网格：\n  - 对于每个测试用例，枚举每个模式的所有初态量子数 $m_k \\in \\{0,\\dots,m_{\\max}\\}$ 和末态量子数 $n_k \\in \\{0,\\dots,n_{\\max}\\}$，并在线状谱中包含所有组合，然后重新归一化线状谱强度使其总和为 $1$。\n  - 对于高斯展宽光谱，使用提供的以电子伏特为单位的能量网格参数 $[E_{\\min}, E_{\\max}, \\Delta E]$。\n- 每个测试用例需报告的量：\n  1. 展宽光谱达到最大值时的能量 $E_{\\max}$，以电子伏特为单位，四舍五入到六位小数。\n  2. 展宽光谱对应的最大强度 $I_{\\max}$，四舍五入到六位小数。\n  3. 总 $0-0$ Franck–Condon 因子 $S_{00} = \\prod_{k=1}^{N} \\exp(-S_k)$，四舍五入到六位小数。\n- 角度单位不适用。若要求任何概率，请以小数值表示。\n- 数值稳定性要求：当 $T = 0$ K 时，处理玻尔兹曼因子，使得只有振动基态被占据。\n\n您的程序必须实现以上要求，并使用以下固定的测试套件。对于每个测试用例，生成三元组 $[E_{\\max}, I_{\\max}, S_{00}]$，并将所有用例的结果汇总到一个 Python 风格的列表的列表中。最终的打印输出必须是包含该列表的单行。\n\n测试套件（每个项目符号代表一个用例）：\n- 用例 1（边界情况：无位移）：\n  - 模式数 $N = 1$。\n  - 基态和激发态模式频率 $\\boldsymbol{\\omega} = [1500]~\\mathrm{cm}^{-1}$。\n  - Huang–Rhys 因子 $\\mathbf{S} = [0.0]$。\n  - 绝热 $0-0$ 能量 $E_{00} = 3.000~\\mathrm{eV}$。\n  - 温度 $T = 0.0~\\mathrm{K}$。\n  - 高斯宽度 $\\sigma = 0.050~\\mathrm{eV}$。\n  - 截断参数 $m_{\\max} = 0$，$n_{\\max} = 4$。\n  - 能量网格 $[E_{\\min}, E_{\\max}, \\Delta E] = [2.5, 3.5, 0.002]~\\mathrm{eV}$。\n- 用例 2（单模式，中等位移）：\n  - $N = 1$, $\\boldsymbol{\\omega} = [1400]~\\mathrm{cm}^{-1}$, $\\mathbf{S} = [1.0]$, $E_{00} = 2.500~\\mathrm{eV}$, $T = 0.0~\\mathrm{K}$, $\\sigma = 0.030~\\mathrm{eV}$, $m_{\\max} = 0$, $n_{\\max} = 6$, 网格 $[2.0, 3.0, 0.002]~\\mathrm{eV}$。\n- 用例 3（双模式，有限温度）：\n  - $N = 2$, $\\boldsymbol{\\omega} = [1200, 1600]~\\mathrm{cm}^{-1}$, $\\mathbf{S} = [0.5, 0.8]$, $E_{00} = 2.200~\\mathrm{eV}$, $T = 300.0~\\mathrm{K}$, $\\sigma = 0.040~\\mathrm{eV}$, $m_{\\max} = 2$, $n_{\\max} = 3$, 网格 $[1.8, 3.0, 0.002]~\\mathrm{eV}$。\n- 用例 4（低频模式，用于探测热带贡献）：\n  - $N = 1$, $\\boldsymbol{\\omega} = [200]~\\mathrm{cm}^{-1}$, $\\mathbf{S} = [0.3]$, $E_{00} = 1.800~\\mathrm{eV}$, $T = 300.0~\\mathrm{K}$, $\\sigma = 0.020~\\mathrm{eV}$, $m_{\\max} = 5$, $n_{\\max} = 6$, 网格 $[1.6, 2.2, 0.001]~\\mathrm{eV}$。\n- 用例 5（双模式，其中一个无位移）：\n  - $N = 2$, $\\boldsymbol{\\omega} = [1000, 1800]~\\mathrm{cm}^{-1}$, $\\mathbf{S} = [0.0, 1.2]$, $E_{00} = 3.400~\\mathrm{eV}$, $T = 0.0~\\mathrm{K}$, $\\sigma = 0.050~\\mathrm{eV}$, $m_{\\max} = 0$, $n_{\\max} = 5$, 网格 $[2.8, 4.2, 0.002]~\\mathrm{eV}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含结果，格式为逗号分隔的三元组列表，并用方括号括起来，例如 $[[E_{\\max}^{(1)},I_{\\max}^{(1)},S_{00}^{(1)}],\\dots]$。每个浮点数在打印输出中必须四舍五入到六位小数。", "solution": "该问题要求构建一个计算流程，以基于谐振子、平行模式近似来模拟分子的振动吸收光谱。解决方案涉及几个步骤：计算单个振动跃迁的 Franck-Condon 因子 (FCF)，通过初始态的热布居对其进行加权，构建线状谱，并应用高斯展宽以获得连续光谱。\n\n首先，我们建立理论框架。该模型假设每个振动模式 $k$ 都是一个独立的谐振子。基电子态和激发电子态的势能面被假定为谐和且平行的，这意味着它们具有相同的振动频率 $\\omega_k$，但激发态的势能最小值沿简正模式坐标发生了位移。该位移由无量纲的 Huang-Rhys 因子 $S_k \\ge 0$ 来量化。\n\n振动跃迁的强度由 Franck-Condon 原理决定，该原理指出跃迁概率与初始和最终振动波函数之间的重叠积分的平方成正比。这个重叠的平方就是 Franck-Condon 因子 (FCF)。对于单个模式 $k$，从振动态 $m_k$ 到 $n_k$ 的跃迁的 FCF 由等频率位移谐振子的精确公式给出：\n$$\nFC_k(m_k \\to n_k) = e^{-S_k} \\frac{\\min(m_k, n_k)!}{\\max(m_k, n_k)!} S_k^{|n_k - m_k|} \\left[ L_{\\min(m_k, n_k)}^{|n_k - m_k|}(S_k) \\right]^2\n$$\n这里，$L_p^q(x)$ 是广义拉盖尔 (Laguerre) 多项式。该公式将使用数值库实现。对于 $S_k=0$ 的特殊情况，FCF 简化为克罗内克 (Kronecker) δ 函数 $\\delta_{m_k, n_k}$，因为谐振子波函数构成一个标准正交集。\n\n从状态 $\\mathbf{m} = (m_1, \\dots, m_N)$ 到 $\\mathbf{n} = (n_1, \\dots, n_N)$ 的多模式跃迁的总 FCF 是各个模式 FCF 的乘积，这是独立模式近似的结果：\n$$\nFC(\\mathbf{m} \\to \\mathbf{n}) = \\prod_{k=1}^{N} FC_k(m_k \\to n_k)\n$$\n\n在有限温度 $T$ 下，基电子态的初始振动能级根据正则玻尔兹曼分布进行布居。模式 $k$ 处于状态 $m_k$ 的概率是：\n$$\np_k(m_k; T) = (1 - q_k) q_k^{m_k}\n$$\n其中 $q_k = \\exp(-\\hbar \\omega_k / (k_{\\mathrm{B}} T))$ 且 $k_{\\mathrm{B}}$ 是玻尔兹曼 (Boltzmann) 常数。对于 $T=0~\\mathrm{K}$，只有振动基态 ($m_k=0$) 被占据，因此 $p_k(0) = 1$ 且 $p_k(m_k>0) = 0$。总的初始态布居为 $P(\\mathbf{m}; T) = \\prod_{k=1}^N p_k(m_k; T)$。\n\n单个振动跃迁（光谱中的一条“谱线”）的强度与初始态布居和总 FCF 的乘积成正比：\n$$\nI_{\\mathbf{m} \\to \\mathbf{n}} \\propto P(\\mathbf{m}; T) \\times FC(\\mathbf{m} \\to \\mathbf{n})\n$$\n此跃迁的能量由下式给出：\n$$\nE_{\\mathbf{m} \\to \\mathbf{n}} = E_{00} + \\sum_{k=1}^{N} \\hbar \\omega_k (n_k - m_k)\n$$\n其中 $E_{00}$ 是绝热 $0-0$ 电子跃迁能。所有频率 $\\omega_k$ 都以波数 ($\\mathrm{cm}^{-1}$) 提供，并且必须使用给定的转换因子 $1~\\mathrm{cm}^{-1} = 1/8065.544005~\\mathrm{eV}$ 转换为电子伏特 ($\\mathrm{eV}$) 能量。\n\n计算算法如下：\n1.  对每个测试用例，解析输入参数：模式数 $N$，频率 $\\boldsymbol{\\omega}$，Huang-Rhys 因子 $\\mathbf{S}$，$E_{00}$，温度 $T$，高斯展宽宽度 $\\sigma$，以及量子数截断极限 $m_{\\max}$ 和 $n_{\\max}$。\n2.  预先计算常数，例如波数到 eV 的转换因子和以 eV/K 为单位的玻尔兹曼常数。\n3.  对每个模式 $k$（从 $1$ 到 $N$）：\n    a. 将 $\\omega_k$ 转换为 $\\mathrm{eV}$。\n    b. 计算并存储所有 $m_k \\in \\{0, \\dots, m_{\\max}\\}$ 的玻尔兹曼布居 $p_k(m_k)$。\n    c. 使用拉盖尔 (Laguerre) 多项式公式，在一个二维数组中计算并存储所有 $m_k \\in \\{0, \\dots, m_{\\max}\\}$ 和 $n_k \\in \\{0, \\dots, n_{\\max}\\}$ 的 FCFs, $FC_k(m_k \\to n_k)$。这可以通过使用 `scipy.special.genlaguerre` 和 `math.factorial` 高效实现。\n4.  在指定的截断限制内，生成初态量子数 $\\mathbf{m} = (m_1, \\dots, m_N)$ 和末态量子数 $\\mathbf{n} = (n_1, \\dots, n_N)$ 的所有可能组合。\n5.  遍历所有这些跃迁 $(\\mathbf{m} \\to \\mathbf{n})$。对于每一个跃迁，计算跃迁能量 $E_{\\mathbf{m} \\to \\mathbf{n}}$ 和未归一化的强度 $I_{\\mathbf{m} \\to \\mathbf{n}}$。将它们存储为（能量，强度）对的列表。为了处理简并跃迁，使用一个将能量映射到总强度的字典来累加在相同能量下发生的跃迁强度。\n6.  计算完所有线状谱强度后，对其进行归一化，使其总和等于 $1$。这考虑了振动基组的截断。\n7.  通过将归一化的线状谱与高斯核进行卷积来构建展宽光谱。对于每个位于能量 $E_i$、归一化强度为 $I_i$ 的谱线，其对离散网格上能量 $E$ 处最终光谱的贡献是 $I_i \\times g(E; E_i, \\sigma)$，其中 $g(E; E_i, \\sigma) = \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{(E-E_i)^2}{2\\sigma^2}\\right)$。最终光谱是在指定的能量网格 $[E_{\\min}, E_{\\max}]$（间距为 $\\Delta E$）上评估的所有谱线贡献的总和。\n8.  从最终的展宽光谱中，确定最大强度 $I_{\\max}$ 和相应的能量 $E_{\\max}$。\n9.  计算总的 $0-0$ Franck-Condon 因子，它是单个模式 $0\\to 0$ FCF 的乘积：$S_{00} = \\prod_{k=1}^N FC_k(0 \\to 0) = \\prod_{k=1}^N e^{-S_k} = \\exp(-\\sum_{k} S_k)$。\n10. 按照规定格式化每个测试用例的结果 $[E_{\\max}, I_{\\max}, S_{00}]$，并将它们汇总到最终的列表中以供输出。\n\n此过程严格地实现了问题陈述中描述的物理模型，从第一性原理到最终的数值结果，并遵守所有指定的约束和格式。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import genlaguerre\nfrom math import exp, sqrt, pi, factorial\nfrom itertools import product\n\ndef solve():\n    \"\"\"\n    Main function to compute and print vibronic spectra simulation results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (edge case: no displacement)\n        (1, [1500], [0.0], 3.000, 0.0, 0.050, 0, 4, [2.5, 3.5, 0.002]),\n        # Case 2 (single mode with moderate displacement)\n        (1, [1400], [1.0], 2.500, 0.0, 0.030, 0, 6, [2.0, 3.0, 0.002]),\n        # Case 3 (two modes with finite temperature)\n        (2, [1200, 1600], [0.5, 0.8], 2.200, 300.0, 0.040, 2, 3, [1.8, 3.0, 0.002]),\n        # Case 4 (low-frequency mode to probe hot-band contributions)\n        (1, [200], [0.3], 1.800, 300.0, 0.020, 5, 6, [1.6, 2.2, 0.001]),\n        # Case 5 (two modes, one with zero displacement)\n        (2, [1000, 1800], [0.0, 1.2], 3.400, 0.0, 0.050, 0, 5, [2.8, 4.2, 0.002]),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = _solve_one_case(case)\n        results.append(result)\n\n    # Format output string as a list of lists with 6 decimal places.\n    sublist_strs = [f\"[{item[0]:.6f},{item[1]:.6f},{item[2]:.6f}]\" for item in results]\n    final_str = f\"[{','.join(sublist_strs)}]\"\n    print(final_str)\n\ndef _solve_one_case(case_params):\n    \"\"\"\n    Solves a single test case for vibronic spectrum simulation.\n    \"\"\"\n    N, omegas_cm, S_factors, E00, T, sigma, m_max, n_max, grid_params = case_params\n\n    # Constants and conversions\n    CM_TO_EV = 1 / 8065.544005\n    KB_EV_K = 8.617333262145e-5\n    \n    # Pre-compute factorials for efficiency\n    max_qn = max(m_max, n_max)\n    fact_table = [factorial(i) for i in range(max_qn + 1)]\n    \n    def compute_fcf_1d(m, n, S):\n        if S  1e-12:\n            return 1.0 if m == n else 0.0\n        p, q = min(m, n), max(m, n)\n        d = q - p\n        fact_ratio = fact_table[p] / fact_table[q]\n        laguerre_poly = genlaguerre(p, d)\n        laguerre_val = laguerre_poly(S)\n        return exp(-S) * fact_ratio * (S**d) * (laguerre_val**2)\n\n    omegas_ev = [w * CM_TO_EV for w in omegas_cm]\n\n    # Pre-compute FCFs and Boltzmann populations for each mode\n    all_fcfs = []\n    all_pops = []\n    \n    for k in range(N):\n        # Boltzmann populations\n        pops_k = np.zeros(m_max + 1)\n        if T == 0.0:\n            pops_k[0] = 1.0\n        else:\n            beta_hbar_omega = omegas_ev[k] / (KB_EV_K * T)\n            q = np.exp(-beta_hbar_omega) if beta_hbar_omega  700 else 0.0\n            norm = 1.0 - q\n            for m in range(m_max + 1):\n                pops_k[m] = norm * (q**m)\n        all_pops.append(pops_k)\n\n        # Franck-Condon factors\n        S_k = S_factors[k]\n        fcfs_k = np.zeros((m_max + 1, n_max + 1))\n        for m in range(m_max + 1):\n            for n in range(n_max + 1):\n                fcfs_k[m, n] = compute_fcf_1d(m, n, S_k)\n        all_fcfs.append(fcfs_k)\n\n    # Assemble stick spectrum\n    stick_spectrum = {}  # {energy: intensity} to group degenerate transitions\n    \n    for m_tuple in product(range(m_max + 1), repeat=N):\n        pop = np.prod([all_pops[k][m_tuple[k]] for k in range(N)])\n        if pop  1e-15: continue\n\n        for n_tuple in product(range(n_max + 1), repeat=N):\n            fcf = np.prod([all_fcfs[k][m_tuple[k], n_tuple[k]] for k in range(N)])\n            if fcf  1e-15: continue\n            \n            intensity = pop * fcf\n            energy_shift = sum(omegas_ev[k] * (n_tuple[k] - m_tuple[k]) for k in range(N))\n            energy = E00 + energy_shift\n            stick_spectrum[energy] = stick_spectrum.get(energy, 0.0) + intensity\n    \n    max_E, max_I = 0.0, 0.0\n    if not stick_spectrum:\n        max_E, max_I = E00, 0.0\n    else:\n        energies, intensities = zip(*stick_spectrum.items())\n        energies = np.array(energies)\n        intensities = np.array(intensities)\n\n        # Normalize stick spectrum\n        total_intensity = np.sum(intensities)\n        if total_intensity > 1e-15:\n            intensities /= total_intensity\n        \n        # Broaden spectrum\n        E_min_grid, E_max_grid, dE = grid_params\n        E_grid = np.arange(E_min_grid, E_max_grid, dE)\n        broadened_spectrum = np.zeros_like(E_grid, dtype=float)\n        \n        prefactor = 1 / (sigma * sqrt(2 * pi))\n        variance_term = 2 * sigma**2\n\n        for E_i, I_i in zip(energies, intensities):\n            if I_i > 0:\n                gaussian = I_i * prefactor * np.exp(-((E_grid - E_i)**2) / variance_term)\n                broadened_spectrum += gaussian\n            \n        max_idx = np.argmax(broadened_spectrum)\n        max_I = broadened_spectrum[max_idx]\n        max_E = E_grid[max_idx]\n\n    # Calculate total 0-0 FCF (S_00)\n    S00 = exp(-sum(S_factors))\n\n    return [max_E, max_I, S00]\n\nsolve()\n```", "id": "3727865"}, {"introduction": "在完成光谱模拟后，一个关键的最后步骤是将其与实验数据进行严格的比较，以验证理论模型的准确性。本练习 [@problem_id:3727877] 为此提供了一个定量的分析框架，教您如何对齐理论光谱与实验光谱，并计算一个拟合优度指标，即均方根误差（RMSE）。这对于任何计算光谱学的研究者来说都是一项评估理论方法性能的基本技能。", "problem": "给定一个中性有机生色团的离散电子激发能和来自含时密度泛函理论 (TDDFT) 的振子强度，以及一个由峰值能量和峰权重振幅表征的理想化实验光谱。从第一性原理出发，将计算出的TDDFT棒状光谱建模为狄拉克δ分布的总和，应用均匀高斯展宽以在预设的能量网格上获得连续光谱，使用由加权最小二乘准则确定的单个最优能量位移将计算的峰位与实验峰位对齐，并通过能量网格上强度的均方根 (RMS) 误差来量化对齐、展宽后的TDDFT光谱与实验光谱之间的失配。\n\n从以下基本原理开始：\n- 线性响应含时密度泛函理论 (TDDFT) 产生一组电子激发能 $\\{\\omega_k\\}$ 和振子强度 $\\{f_k\\}$，它们定义了一个棒状光谱 $S(E) = \\sum_{k} f_k \\,\\delta(E - \\omega_k)$，其中 $\\delta(\\cdot)$ 是狄拉克δ分布，而 $E$ 是光子能量。\n- 均匀展宽将 $\\delta(\\cdot)$ 转换为平滑线型；对于标准差为 $\\sigma$ 的高斯展宽，能量为 $\\mu$ 的单个跃迁的展宽线型为 $G_\\sigma(E;\\mu) = \\dfrac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\!\\left(-\\dfrac{(E - \\mu)^2}{2\\sigma^2}\\right)$。\n- 实验光谱理想化为 $I_{\\mathrm{exp}}(E) = \\sum_{j} a_j \\, G_{\\sigma_{\\mathrm{exp}}}(E; E^{\\mathrm{exp}}_j)$，其中 $\\{E^{\\mathrm{exp}}_j\\}$ 是实验峰值能量，$\\{a_j\\}$ 是峰权重振幅。\n- 为了对齐峰位，确定一个标量能量位移 $\\Delta$，使其最小化加权最小二乘目标函数 $\\Phi(\\Delta) = \\sum_{k} w_k \\left( (\\omega_k + \\Delta) - E^{\\mathrm{exp}}_k \\right)^2$，其中 $\\{w_k\\}$ 是非负权重。假设 $\\sum_k w_k \\neq 0$ 且峰是按索引对齐的，唯一的极小值点是 $\\Delta^\\ast = \\dfrac{\\sum_{k} w_k \\left(E^{\\mathrm{exp}}_k - \\omega_k\\right)}{\\sum_{k} w_k}$。\n- 对齐、展宽后的计算光谱为 $I_{\\mathrm{calc}}(E) = \\sum_{k} f_k \\, G_{\\sigma_{\\mathrm{calc}}}\\!\\left(E; \\omega_k + \\Delta^\\ast\\right)$。\n- 在离散能量网格 $\\{E_n\\}_{n=1}^N$ 上的均方根 (RMS) 误差为 $\\mathrm{RMSE} = \\sqrt{\\dfrac{1}{N} \\sum_{n=1}^{N} \\left( I_{\\mathrm{calc}}(E_n) - I_{\\mathrm{exp}}(E_n) \\right)^2 }$。\n\n使用指定的测试套件实现以上过程。能量必须以电子伏特为单位处理，所有高斯宽度也必须以电子伏特为单位。在这种理想化模型中，强度是无量纲的。您的程序应生成单行输出，其中包含测试用例的RMSE值，格式为用方括号括起来的逗号分隔列表。每个RMSE值必须四舍五入到六位小数。\n\n使用以下测试套件，它涵盖了一个典型案例、一个窄线边界案例和一个宽线案例：\n\n- 测试用例1（紫外-可见光区的典型有机生色团）：\n  - 计算的TDDFT激发能：$\\omega_{\\mathrm{calc}} = [\\,3.40,\\,4.75,\\,5.60\\,]$ $\\mathrm{eV}$。\n  - 计算的振子强度：$f_{\\mathrm{calc}} = [\\,0.80,\\,0.30,\\,0.25\\,]$。\n  - 实验峰：$E^{\\mathrm{exp}} = [\\,3.30,\\,4.62,\\,5.50\\,]$ $\\mathrm{eV}$。\n  - 实验峰权重：$a_{\\mathrm{exp}} = [\\,0.85,\\,0.28,\\,0.27\\,]$。\n  - 实验高斯宽度：$\\sigma_{\\mathrm{exp}} = 0.08$ $\\mathrm{eV}$。\n  - 计算高斯宽度：$\\sigma_{\\mathrm{calc}} = 0.10$ $\\mathrm{eV}$。\n  - 对齐权重：$w_k = f_{\\mathrm{calc},k}$。\n  - 能量网格：起始 $E_{\\min} = 2.80$ $\\mathrm{eV}$，结束 $E_{\\max} = 6.20$ $\\mathrm{eV}$，步长 $\\Delta E = 0.01$ $\\mathrm{eV}$。\n\n- 测试用例2（窄均匀展宽和弱跃迁）：\n  - 计算的TDDFT激发能：$\\omega_{\\mathrm{calc}} = [\\,3.00,\\,4.20,\\,5.00\\,]$ $\\mathrm{eV}$。\n  - 计算的振子强度：$f_{\\mathrm{calc}} = [\\,0.05,\\,0.60,\\,0.00\\,]$。\n  - 实验峰：$E^{\\mathrm{exp}} = [\\,2.95,\\,4.10,\\,4.95\\,]$ $\\mathrm{eV}$。\n  - 实验峰权重：$a_{\\mathrm{exp}} = [\\,0.06,\\,0.58,\\,0.02\\,]$。\n  - 实验高斯宽度：$\\sigma_{\\mathrm{exp}} = 0.02$ $\\mathrm{eV}$。\n  - 计算高斯宽度：$\\sigma_{\\mathrm{calc}} = 0.02$ $\\mathrm{eV}$。\n  - 对齐权重：$w_k = f_{\\mathrm{calc},k}$。\n  - 能量网格：起始 $E_{\\min} = 2.50$ $\\mathrm{eV}$，结束 $E_{\\max} = 5.50$ $\\mathrm{eV}$，步长 $\\Delta E = 0.005$ $\\mathrm{eV}$。\n\n- 测试用例3（模拟凝聚相环境的宽均匀效应）：\n  - 计算的TDDFT激发能：$\\omega_{\\mathrm{calc}} = [\\,2.80,\\,3.80,\\,5.80\\,]$ $\\mathrm{eV}$。\n  - 计算的振子强度：$f_{\\mathrm{calc}} = [\\,0.40,\\,0.35,\\,0.20\\,]$。\n  - 实验峰：$E^{\\mathrm{exp}} = [\\,2.70,\\,3.65,\\,5.65\\,]$ $\\mathrm{eV}$。\n  - 实验峰权重：$a_{\\mathrm{exp}} = [\\,0.42,\\,0.33,\\,0.22\\,]$。\n  - 实验高斯宽度：$\\sigma_{\\mathrm{exp}} = 0.25$ $\\mathrm{eV}$。\n  - 计算高斯宽度：$\\sigma_{\\mathrm{calc}} = 0.25$ $\\mathrm{eV}$。\n  - 对齐权重：$w_k = f_{\\mathrm{calc},k}$。\n  - 能量网格：起始 $E_{\\min} = 2.00$ $\\mathrm{eV}$，结束 $E_{\\max} = 6.50$ $\\mathrm{eV}$，步长 $\\Delta E = 0.02$ $\\mathrm{eV}$。\n\n程序要求：\n- 根据提供的实验峰值能量、权重和 $\\sigma_{\\mathrm{exp}}$，为每个测试用例构建 $I_{\\mathrm{exp}}(E)$。\n- 使用 $w_k = f_{\\mathrm{calc},k}$ 和按索引对齐的峰计算 $\\Delta^\\ast$。\n- 使用 $\\omega_{\\mathrm{calc}} + \\Delta^\\ast$、$f_{\\mathrm{calc}}$ 和 $\\sigma_{\\mathrm{calc}}$ 构建 $I_{\\mathrm{calc}}(E)$。\n- 为每个测试用例计算指定能量网格上的 $\\mathrm{RMSE}$。\n- 以 $[r_1,r_2,r_3]$ 的格式单行输出三个 $\\mathrm{RMSE}$ 值，其中每个 $r_i$ 四舍五入到六位小数。\n\n所有能量都必须以 $\\mathrm{eV}$ 表示和处理，最终强度是无量纲的。本问题不涉及角度。不使用百分比。", "solution": "用户提供了一个问题，要求将使用含时密度泛函理论 (TDDFT) 计算的理论电子光谱与理想化的实验光谱进行比较。任务是通过最优能量位移将理论光谱与实验光谱对齐，然后使用均方根误差 (RMSE) 来量化它们之间的差异。\n\n### 步骤1：提取已知条件\n\n问题提供了以下数据和定义：\n- 理论 (TDDFT) 棒状光谱：$S(E) = \\sum_{k} f_k \\,\\delta(E - \\omega_k)$，其中 $\\{\\omega_k\\}$ 是激发能，$\\{f_k\\}$ 是振子强度，$\\delta(\\cdot)$ 是狄拉克δ分布。\n- 高斯展宽线型：$G_\\sigma(E;\\mu) = \\dfrac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\!\\left(-\\dfrac{(E - \\mu)^2}{2\\sigma^2}\\right)$，标准差为 $\\sigma$。\n- 理想化的实验光谱：$I_{\\mathrm{exp}}(E) = \\sum_{j} a_j \\, G_{\\sigma_{\\mathrm{exp}}}(E; E^{\\mathrm{exp}}_j)$，其中 $\\{E^{\\mathrm{exp}}_j\\}$ 是峰值能量，$\\{a_j\\}$ 是峰权重振幅。\n- 用于对齐的加权最小二乘目标函数：$\\Phi(\\Delta) = \\sum_{k} w_k \\left( (\\omega_k + \\Delta) - E^{\\mathrm{exp}}_k \\right)^2$，其中 $\\{w_k\\}$ 为非负权重。\n- 唯一极小值点（最优能量位移）：$\\Delta^\\ast = \\dfrac{\\sum_{k} w_k \\left(E^{\\mathrm{exp}}_k - \\omega_k\\right)}{\\sum_{k} w_k}$，假设峰是按索引对齐的且 $\\sum_k w_k \\neq 0$。\n- 对齐、展宽后的计算光谱：$I_{\\mathrm{calc}}(E) = \\sum_{k} f_k \\, G_{\\sigma_{\\mathrm{calc}}}\\!\\left(E; \\omega_k + \\Delta^\\ast\\right)$。\n- 均方根误差：$\\mathrm{RMSE} = \\sqrt{\\dfrac{1}{N} \\sum_{n=1}^{N} \\left( I_{\\mathrm{calc}}(E_n) - I_{\\mathrm{exp}}(E_n) \\right)^2 }$，在离散能量网格 $\\{E_n\\}_{n=1}^N$ 上计算。\n- 对齐权重指定为 $w_k = f_{\\mathrm{calc},k}$。\n\n测试用例1：\n- $\\omega_{\\mathrm{calc}} = [\\,3.40,\\,4.75,\\,5.60\\,]$ $\\mathrm{eV}$\n- $f_{\\mathrm{calc}} = [\\,0.80,\\,0.30,\\,0.25\\,]$\n- $E^{\\mathrm{exp}} = [\\,3.30,\\,4.62,\\,5.50\\,]$ $\\mathrm{eV}$\n- $a_{\\mathrm{exp}} = [\\,0.85,\\,0.28,\\,0.27\\,]$\n- $\\sigma_{\\mathrm{exp}} = 0.08$ $\\mathrm{eV}$\n- $\\sigma_{\\mathrm{calc}} = 0.10$ $\\mathrm{eV}$\n- 能量网格：$E_{\\min} = 2.80$ $\\mathrm{eV}$，$E_{\\max} = 6.20$ $\\mathrm{eV}$，$\\Delta E = 0.01$ $\\mathrm{eV}$\n\n测试用例2：\n- $\\omega_{\\mathrm{calc}} = [\\,3.00,\\,4.20,\\,5.00\\,]$ $\\mathrm{eV}$\n- $f_{\\mathrm{calc}} = [\\,0.05,\\,0.60,\\,0.00\\,]$\n- $E^{\\mathrm{exp}} = [\\,2.95,\\,4.10,\\,4.95\\,]$ $\\mathrm{eV}$\n- $a_{\\mathrm{exp}} = [\\,0.06,\\,0.58,\\,0.02\\,]$\n- $\\sigma_{\\mathrm{exp}} = 0.02$ $\\mathrm{eV}$\n- $\\sigma_{\\mathrm{calc}} = 0.02$ $\\mathrm{eV}$\n- 能量网格：$E_{\\min} = 2.50$ $\\mathrm{eV}$，$E_{\\max} = 5.50$ $\\mathrm{eV}$，$\\Delta E = 0.005$ $\\mathrm{eV}$\n\n测试用例3：\n- $\\omega_{\\mathrm{calc}} = [\\,2.80,\\,3.80,\\,5.80\\,]$ $\\mathrm{eV}$\n- $f_{\\mathrm{calc}} = [\\,0.40,\\,0.35,\\,0.20\\,]$\n- $E^{\\mathrm{exp}} = [\\,2.70,\\,3.65,\\,5.65\\,]$ $\\mathrm{eV}$\n- $a_{\\mathrm{exp}} = [\\,0.42,\\,0.33,\\,0.22\\,]$\n- $\\sigma_{\\mathrm{exp}} = 0.25$ $\\mathrm{eV}$\n- $\\sigma_{\\mathrm{calc}} = 0.25$ $\\mathrm{eV}$\n- 能量网格：$E_{\\min} = 2.00$ $\\mathrm{eV}$，$E_{\\max} = 6.50$ $\\mathrm{eV}$，$\\Delta E = 0.02$ $\\mathrm{eV}$\n\n### 步骤2：使用提取的已知条件进行验证\n\n对问题进行验证。\n1.  **科学基础**：该问题基于计算光谱学的标准原理，即使用TDDFT计算电子激发和使用高斯展宽模拟实验线型。用于光谱对齐和误差量化的数学形式是数据分析中的标准方法。所有前提都具有科学合理性。\n2.  **适定性**：该问题是适定的。它提供了所有必要的数据和一个清晰、确定性的算法。最优位移 $\\Delta^\\ast$ 的公式确保了唯一解，因为分母 $\\sum_k w_k = \\sum_k f_{\\mathrm{calc},k}$ 是非负振子强度的总和，并且在所有测试用例中均不为零。唯一RMSE值的存在得到保证。\n3.  **客观性**：问题以精确、定量和无偏见的语言陈述。\n4.  **完整性与一致性**：问题是自洽的。所有变量、常数和程序步骤都已明确定义。每个测试用例的数据是完整的，没有矛盾之处。\n5.  **真实性**：能量值、振子强度和展宽参数对于典型的有机分子是物理上真实的。\n\n问题没有任何使其无效的缺陷。\n\n### 步骤3：结论与行动\n\n问题有效。将提供一个完整且合理的解决方案。\n\n### 解题步骤\n\n通过对每个测试用例执行一个四步计算程序来找到解决方案。\n\n**步骤1：确定最优能量位移 ($\\Delta^\\ast$)**\n最优能量位移 $\\Delta^\\ast$ 最小化了计算峰位和实验峰位之间的加权平方差。它使用以下提供的公式计算：\n$$\n\\Delta^\\ast = \\frac{\\sum_{k} w_k (E^{\\mathrm{exp}}_k - \\omega_k)}{\\sum_{k} w_k}\n$$\n其中权重 $w_k$ 是计算出的振子强度 $f_{\\mathrm{calc},k}$。\n\n**步骤2：定义离散能量网格**\n对于每种情况，从 $E_{\\min}$ 到 $E_{\\max}$ 构建一个步长为 $\\Delta E$ 的离散能量网格 $\\{E_n\\}$。总点数 $N$ 由 $N = \\text{round}((E_{\\max} - E_{\\min}) / \\Delta E) + 1$ 给出。\n\n**步骤3：在网格上生成光谱**\n理想化的实验光谱强度 $I_{\\mathrm{exp}}(E_n)$ 和对齐、展宽后的理论光谱强度 $I_{\\mathrm{calc}}(E_n)$ 必须在能量网格上的每个点 $E_n$ 进行计算。\n高斯线型函数为：\n$$\nG_\\sigma(E; \\mu) = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{(E - \\mu)^2}{2\\sigma^2}\\right)\n$$\n实验光谱是以实验峰值能量为中心的高斯函数的加权总和：\n$$\nI_{\\mathrm{exp}}(E_n) = \\sum_{j} a_{\\mathrm{exp},j} \\, G_{\\sigma_{\\mathrm{exp}}}(E_n; E^{\\mathrm{exp}}_j)\n$$\n理论光谱是一个类似的求和，但使用计算出的振子强度作为权重，并以最优位移后的能量 $\\omega'_k = \\omega_k + \\Delta^\\ast$ 为中心：\n$$\nI_{\\mathrm{calc}}(E_n) = \\sum_{k} f_{\\mathrm{calc},k} \\, G_{\\sigma_{\\mathrm{calc}}}(E_n; \\omega_k + \\Delta^\\ast)\n$$\n\n**步骤4：计算均方根误差 (RMSE)**\n最后一步是计算RMSE，它衡量了两个光谱在整个能量网格上的平均差异：\n$$\n\\mathrm{RMSE} = \\sqrt{\\frac{1}{N} \\sum_{n=1}^{N} \\left( I_{\\mathrm{calc}}(E_n) - I_{\\mathrm{exp}}(E_n) \\right)^2}\n$$\n\n**应用于测试用例**\n\n**测试用例1：**\n- $\\Delta^\\ast$ 的分子：$0.80(3.30-3.40) + 0.30(4.62-4.75) + 0.25(5.50-5.60) = -0.08 - 0.039 - 0.025 = -0.144$。\n- $\\Delta^\\ast$ 的分母：$0.80 + 0.30 + 0.25 = 1.35$。\n- $\\Delta^\\ast = -0.144 / 1.35 \\approx -0.106667$ $\\mathrm{eV}$。\n- 能量网格：$N = (6.20 - 2.80)/0.01 + 1 = 341$ 个点。\n- 光谱 $I_{\\mathrm{exp}}(E)$ 和 $I_{\\mathrm{calc}}(E)$ 使用它们各自的参数和计算出的 $\\Delta^\\ast$ 在该网格上生成。\n- 计算RMSE，得到约 $0.187321$。\n\n**测试用例2：**\n- $\\Delta^\\ast$ 的分子：$0.05(2.95-3.00) + 0.60(4.10-4.20) + 0.00(4.95-5.00) = -0.0025 - 0.06 = -0.0625$。\n- $\\Delta^\\ast$ 的分母：$0.05 + 0.60 + 0.00 = 0.65$。\n- $\\Delta^\\ast = -0.0625 / 0.65 \\approx -0.096154$ $\\mathrm{eV}$。\n- 能量网格：$N = (5.50 - 2.50)/0.005 + 1 = 601$ 个点。\n- 光谱在此精细网格上生成。较小的展宽参数 $\\sigma = 0.02$ $\\mathrm{eV}$ 导致非常尖锐的峰。第三个跃迁的振子强度为零，意味着它对对齐或计算光谱 $I_{\\mathrm{calc}}(E)$ 都没有贡献。\n- 计算RMSE，得到约 $0.207604$。\n\n**测试用例3：**\n- $\\Delta^\\ast$ 的分子：$0.40(2.70-2.80) + 0.35(3.65-3.80) + 0.20(5.65-5.80) = -0.04 - 0.0525 - 0.03 = -0.1225$。\n- $\\Delta^\\ast$ 的分母：$0.40 + 0.35 + 0.20 = 0.95$。\n- $\\Delta^\\ast = -0.1225 / 0.95 \\approx -0.128947$ $\\mathrm{eV}$。\n- 能量网格：$N = (6.50 - 2.00)/0.02 + 1 = 226$ 个点。\n- 光谱在该网格上生成。较大的展宽 $\\sigma=0.25$ $\\mathrm{eV}$ 导致非常宽且重叠的光谱特征。\n- 计算RMSE，得到约 $0.016335$。\n\n最终结果通过对每个测试用例执行此过程并将最终RMSE四舍五入到六位小数来获得。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating the RMSE between aligned TDDFT and\n    idealized experimental spectra for a series of test cases.\n    \"\"\"\n\n    test_cases = [\n        # Test Case 1 (typical organic chromophore in ultraviolet-visible regime)\n        {\n            \"omega_calc\": np.array([3.40, 4.75, 5.60]),\n            \"f_calc\": np.array([0.80, 0.30, 0.25]),\n            \"E_exp\": np.array([3.30, 4.62, 5.50]),\n            \"a_exp\": np.array([0.85, 0.28, 0.27]),\n            \"sigma_exp\": 0.08,\n            \"sigma_calc\": 0.10,\n            \"grid_params\": {\"start\": 2.80, \"end\": 6.20, \"step\": 0.01},\n        },\n        # Test Case 2 (narrow homogeneous broadening and a weak transition)\n        {\n            \"omega_calc\": np.array([3.00, 4.20, 5.00]),\n            \"f_calc\": np.array([0.05, 0.60, 0.00]),\n            \"E_exp\": np.array([2.95, 4.10, 4.95]),\n            \"a_exp\": np.array([0.06, 0.58, 0.02]),\n            \"sigma_exp\": 0.02,\n            \"sigma_calc\": 0.02,\n            \"grid_params\": {\"start\": 2.50, \"end\": 5.50, \"step\": 0.005},\n        },\n        # Test Case 3 (broad homogeneous effect mimicking condensed-phase environment)\n        {\n            \"omega_calc\": np.array([2.80, 3.80, 5.80]),\n            \"f_calc\": np.array([0.40, 0.35, 0.20]),\n            \"E_exp\": np.array([2.70, 3.65, 5.65]),\n            \"a_exp\": np.array([0.42, 0.33, 0.22]),\n            \"sigma_exp\": 0.25,\n            \"sigma_calc\": 0.25,\n            \"grid_params\": {\"start\": 2.00, \"end\": 6.50, \"step\": 0.02},\n        }\n    ]\n\n    results = []\n\n    def gaussian(E, mu, sigma):\n        \"\"\"\n        Calculates the Gaussian lineshape function.\n        G_sigma(E; mu) = (1 / (sigma * sqrt(2*pi))) * exp(-(E - mu)^2 / (2 * sigma^2))\n        \"\"\"\n        if sigma == 0:\n            # Avoid division by zero and handle as a delta function if sigma is 0\n            # For this problem, sigma is always positive, but this is good practice.\n            return np.zeros_like(E)\n        prefactor = 1.0 / (sigma * np.sqrt(2 * np.pi))\n        exponent = -((E - mu)**2) / (2 * sigma**2)\n        return prefactor * np.exp(exponent)\n\n    for case in test_cases:\n        # Step 1: Determine the Optimal Energy Shift (Delta*)\n        # Weights for alignment are the oscillator strengths\n        weights = case[\"f_calc\"]\n        energy_diffs = case[\"E_exp\"] - case[\"omega_calc\"]\n        \n        numerator = np.sum(weights * energy_diffs)\n        denominator = np.sum(weights)\n        \n        # Handle case where sum of weights is zero to avoid division by zero\n        if denominator == 0:\n            delta_shift = 0.0\n        else:\n            delta_shift = numerator / denominator\n\n        # Step 2: Define Discrete Energy Grid\n        grid_p = case[\"grid_params\"]\n        start, end, step = grid_p[\"start\"], grid_p[\"end\"], grid_p[\"step\"]\n        # Use linspace for robust handling of floating point endpoints\n        num_points = int(round((end - start) / step)) + 1\n        energy_grid = np.linspace(start, end, num_points)\n\n        # Step 3: Generate the Spectra on the Grid\n        # Experimental Spectrum\n        I_exp = np.zeros_like(energy_grid)\n        for j in range(len(case[\"E_exp\"])):\n            I_exp += case[\"a_exp\"][j] * gaussian(energy_grid, case[\"E_exp\"][j], case[\"sigma_exp\"])\n        \n        # Aligned, Broadened Computed Spectrum\n        aligned_omega = case[\"omega_calc\"] + delta_shift\n        I_calc = np.zeros_like(energy_grid)\n        for k in range(len(case[\"omega_calc\"])):\n            I_calc += case[\"f_calc\"][k] * gaussian(energy_grid, aligned_omega[k], case[\"sigma_calc\"])\n\n        # Step 4: Calculate the Root-Mean-Square Error (RMSE)\n        squared_errors = (I_calc - I_exp)**2\n        mean_squared_error = np.mean(squared_errors)\n        rmse = np.sqrt(mean_squared_error)\n\n        results.append(round(rmse, 6))\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3727877"}]}