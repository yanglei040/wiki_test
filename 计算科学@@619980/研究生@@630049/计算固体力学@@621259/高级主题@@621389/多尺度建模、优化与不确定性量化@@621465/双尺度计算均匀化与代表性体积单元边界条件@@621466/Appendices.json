{"hands_on_practices": [{"introduction": "在我们实现周期性边界条件（Periodic Boundary Conditions, PBC）之前，我们必须首先理解其数学和几何意义。本练习将引导您为一个通用的非正交代表性体积单元（Representative Volume Element, RVE）推导基本的位移跳跃关系。对于将PBC应用于不局限于简单正方形或立方体盒子的真实复杂微观结构，这项理论工作至关重要。[@problem_id:3608319]", "problem": "考虑一个处于参考构型中的二维周期性复合材料的代表性体积单元 (RVE)。该RVE是一个由晶格平移矢量 $\\boldsymbol{a}_{1}$ 和 $\\boldsymbol{a}_{2}$ 张成的非正交平行四边形，这两个矢量组合成单元矩阵 $\\boldsymbol{A} = \\begin{pmatrix} \\boldsymbol{a}_{1}  \\boldsymbol{a}_{2} \\end{pmatrix} \\in \\mathbb{R}^{2 \\times 2}$。该材料在小应变运动学下建模，宏观载荷由施加于RVE上的一个恒定宏观小应变张量 $\\overline{\\boldsymbol{E}} \\in \\mathbb{R}^{2 \\times 2}$ 表示。\n\n任务：\n1) 基于晶格矢量，使用RVE边界的参数化描述，从第一性原理推导任意一对相对边界点之间的映射关系。您的推导必须明确使用边界上的参数坐标以及相对点通过晶格平移相关联这一事实。\n\n2) 从双尺度运动学分解 $\\boldsymbol{u}(\\boldsymbol{X}) = \\overline{\\boldsymbol{E}}\\,\\boldsymbol{X} + \\tilde{\\boldsymbol{u}}(\\boldsymbol{X})$ 出发，其中 $\\tilde{\\boldsymbol{u}}$ 是微观扰动场，并应用 $\\tilde{\\boldsymbol{u}}$ 在RVE边界上具有周期性的要求，推导将相对边界上的位移跳跃与晶格平移矢量及 $\\overline{\\boldsymbol{E}}$ 相关联的位移型周期性边界条件 (PBC)。用 $\\boldsymbol{a}_{i}$ ($i \\in \\{1,2\\}$) 给出最终表达式。\n\n3) 对于具有以下参数的特定非正交单元：\n$$\n\\boldsymbol{a}_{1} = \\begin{pmatrix} 5.7 \\\\ 3.4 \\end{pmatrix}\\,\\text{mm}, \n\\qquad\n\\boldsymbol{a}_{2} = \\begin{pmatrix} -2.1 \\\\ 6.2 \\end{pmatrix}\\,\\text{mm},\n\\qquad\n\\overline{\\boldsymbol{E}} = \\begin{pmatrix} 0.0117  0.0042 \\\\ 0.0042  -0.0031 \\end{pmatrix},\n$$\n计算由 $\\boldsymbol{a}_{1}$ 关联的任意一对相对边界点之间的位移跳跃矢量。最终位移跳跃以毫米为单位表示，并将您的答案四舍五入到四位有效数字。\n\n答案格式要求：仅提供最终的位移跳跃矢量，形式为一个包含两个元素的单行矩阵，在最终的方框答案中不包含单位。", "solution": "首先对问题进行严格的验证过程。\n\n**第1步：提取已知条件**\n- 系统是一个二维周期性复合材料的代表性体积单元 (RVE)。\n- RVE是由晶格平移矢量 $\\boldsymbol{a}_{1}$ 和 $\\boldsymbol{a}_{2}$ 张成的非正交平行四边形。\n- 单元矩阵为 $\\boldsymbol{A} = \\begin{pmatrix} \\boldsymbol{a}_{1}  \\boldsymbol{a}_{2} \\end{pmatrix} \\in \\mathbb{R}^{2 \\times 2}$。\n- 材料在小应变运动学下建模。\n- 宏观载荷由一个恒定的宏观小应变张量 $\\overline{\\boldsymbol{E}} \\in \\mathbb{R}^{2 \\times 2}$ 给出。\n- 位移场 $\\boldsymbol{u}(\\boldsymbol{X})$ 的运动学分解为 $\\boldsymbol{u}(\\boldsymbol{X}) = \\overline{\\boldsymbol{E}}\\,\\boldsymbol{X} + \\tilde{\\boldsymbol{u}}(\\boldsymbol{X})$。\n- 微观扰动场 $\\tilde{\\boldsymbol{u}}(\\boldsymbol{X})$ 在RVE边界上是周期的。\n- 给出了具体的数值：\n$$\n\\boldsymbol{a}_{1} = \\begin{pmatrix} 5.7 \\\\ 3.4 \\end{pmatrix}\\,\\text{mm}, \n\\qquad\n\\boldsymbol{a}_{2} = \\begin{pmatrix} -2.1 \\\\ 6.2 \\end{pmatrix}\\,\\text{mm},\n\\qquad\n\\overline{\\boldsymbol{E}} = \\begin{pmatrix} 0.0117  0.0042 \\\\ 0.0042  -0.0031 \\end{pmatrix}.\n$$\n\n**第2步：使用提取的已知条件进行验证**\n- **科学依据**：该问题基于固体力学中周期性介质的双尺度计算均匀化的标准且成熟的理论。所有概念，如RVE、运动学分解和周期性边界条件，都是该领域的基础。该问题在科学上是合理的。\n- **适定性**：该问题结构为一系列推导后进行数值计算。每个部分都有明确定义，并拥有唯一、稳定且有意义的解。为完成任务提供了所有必要的数据。\n- **客观性**：语言精确、数学化，没有任何主观或模糊的术语。\n\n**第3步：结论与行动**\n该问题被判定为有效。它具有科学依据、适定性、客观性，并包含一套完整且一致的信息。将提供完整的解答。\n\n***\n\n**第1部分：相对边界点之间的映射关系**\n\nRVE是参考构型$\\Omega$中的一个平行四边形。不失一般性，我们可以将其一个顶点置于坐标系原点 $\\boldsymbol{X} = \\boldsymbol{0}$。RVE的四个顶点则为 $\\boldsymbol{0}$、$\\boldsymbol{a}_1$、$\\boldsymbol{a}_2$ 和 $\\boldsymbol{a}_1 + \\boldsymbol{a}_2$。RVE的边界 $\\partial\\Omega$ 由四个线段组成。这些线段可以分为两对相对的边界。\n\n我们定义一个参数坐标 $s \\in [0, 1]$ 来描述这些边界段上的点。\n\n第一对相对边界，记为 $\\partial\\Omega_1^-$ 和 $\\partial\\Omega_1^+$，与矢量 $\\boldsymbol{a}_2$ 平行。点 $\\boldsymbol{X}^- \\in \\partial\\Omega_1^-$ 可以参数化为：\n$$\n\\boldsymbol{X}^-(s) = s \\boldsymbol{a}_2, \\quad s \\in [0, 1]\n$$\n该线段连接顶点 $\\boldsymbol{0}$ 和顶点 $\\boldsymbol{a}_2$。相对的边界段 $\\partial\\Omega_1^+$ 是通过矢量 $\\boldsymbol{a}_1$ 平移得到的。与相同参数 $s$ 对应的点 $\\boldsymbol{X}^+ \\in \\partial\\Omega_1^+$ 由下式给出：\n$$\n\\boldsymbol{X}^+(s) = \\boldsymbol{a}_1 + s \\boldsymbol{a}_2, \\quad s \\in [0, 1]\n$$\n该线段连接顶点 $\\boldsymbol{a}_1$ 和顶点 $\\boldsymbol{a}_1+\\boldsymbol{a}_2$。因此，在这两条边界上任意一对相对点 $(\\boldsymbol{X}^-, \\boldsymbol{X}^+)$ 之间的映射关系为：\n$$\n\\boldsymbol{X}^+ = \\boldsymbol{X}^- + \\boldsymbol{a}_1\n$$\n\n类似地，对于第二对与矢量 $\\boldsymbol{a}_1$ 平行的相对边界 $\\partial\\Omega_2^-$ 和 $\\partial\\Omega_2^+$：\n点 $\\boldsymbol{X}^- \\in \\partial\\Omega_2^-$ 参数化为：\n$$\n\\boldsymbol{X}^-(s) = s \\boldsymbol{a}_1, \\quad s \\in [0, 1]\n$$\n对应的相对点 $\\boldsymbol{X}^+ \\in \\partial\\Omega_2^+$ 由下式给出：\n$$\n\\boldsymbol{X}^+(s) = \\boldsymbol{a}_2 + s \\boldsymbol{a}_1, \\quad s \\in [0, 1]\n$$\n这对相对点之间的映射关系为：\n$$\n\\boldsymbol{X}^+ = \\boldsymbol{X}^- + \\boldsymbol{a}_2\n$$\n一般而言，一对相对边界点 $(\\boldsymbol{X}^-, \\boldsymbol{X}^+)$ 通过其中一个晶格平移矢量相关联，即 $\\boldsymbol{X}^+ = \\boldsymbol{X}^- + \\boldsymbol{a}_i$，其中 $i \\in \\{1, 2\\}$。\n\n**第2部分：位移型周期性边界条件的推导**\n\n推导从位移场 $\\boldsymbol{u}(\\boldsymbol{X})$ 的双尺度运动学分解开始：\n$$\n\\boldsymbol{u}(\\boldsymbol{X}) = \\overline{\\boldsymbol{E}}\\,\\boldsymbol{X} + \\tilde{\\boldsymbol{u}}(\\boldsymbol{X})\n$$\n其中 $\\overline{\\boldsymbol{E}}\\,\\boldsymbol{X}$ 是位移的宏观均匀部分，而 $\\tilde{\\boldsymbol{u}}(\\boldsymbol{X})$ 是周期性的微观扰动场。\n\n扰动场的周期性条件要求 $\\tilde{\\boldsymbol{u}}$ 在相对边界上的任意一对对应点 $\\boldsymbol{X}^-$ 和 $\\boldsymbol{X}^+$ 处具有相同的值。如第1部分所述，这些点通过 $\\boldsymbol{X}^+ = \\boldsymbol{X}^- + \\boldsymbol{a}_i$ 相关联（$i \\in \\{1, 2\\}$）。因此，周期性条件可形式化地表示为：\n$$\n\\tilde{\\boldsymbol{u}}(\\boldsymbol{X}^+) = \\tilde{\\boldsymbol{u}}(\\boldsymbol{X}^-)\n$$\n我们可以通过重新整理运动学分解，用总位移 $\\boldsymbol{u}$ 来表示扰动场 $\\tilde{\\boldsymbol{u}}$：\n$$\n\\tilde{\\boldsymbol{u}}(\\boldsymbol{X}) = \\boldsymbol{u}(\\boldsymbol{X}) - \\overline{\\boldsymbol{E}}\\,\\boldsymbol{X}\n$$\n将此代入周期性条件，我们得到：\n$$\n\\boldsymbol{u}(\\boldsymbol{X}^+) - \\overline{\\boldsymbol{E}}\\,\\boldsymbol{X}^+ = \\boldsymbol{u}(\\boldsymbol{X}^-) - \\overline{\\boldsymbol{E}}\\,\\boldsymbol{X}^-\n$$\n我们关心的是跨相对边界的位移跳跃，即差值 $\\boldsymbol{u}(\\boldsymbol{X}^+) - \\boldsymbol{u}(\\boldsymbol{X}^-)$。重新整理上式以分离出这一项，得到：\n$$\n\\boldsymbol{u}(\\boldsymbol{X}^+) - \\boldsymbol{u}(\\boldsymbol{X}^-) = \\overline{\\boldsymbol{E}}\\,\\boldsymbol{X}^+ - \\overline{\\boldsymbol{E}}\\,\\boldsymbol{X}^-\n$$\n利用矩阵-矢量乘法的线性性质，我们可以提出宏观应变张量 $\\overline{\\boldsymbol{E}}$：\n$$\n\\boldsymbol{u}(\\boldsymbol{X}^+) - \\boldsymbol{u}(\\boldsymbol{X}^-) = \\overline{\\boldsymbol{E}}\\,(\\boldsymbol{X}^+ - \\boldsymbol{X}^-)\n$$\n最后，我们代入相对边界点之间的几何关系 $\\boldsymbol{X}^+ - \\boldsymbol{X}^- = \\boldsymbol{a}_i$：\n$$\n\\boldsymbol{u}(\\boldsymbol{X}^+) - \\boldsymbol{u}(\\boldsymbol{X}^-) = \\overline{\\boldsymbol{E}}\\,\\boldsymbol{a}_i, \\quad i \\in \\{1, 2\\}\n$$\n这就是位移型周期性边界条件 (PBCs) 的表达式。它表明，跨越由晶格矢量 $\\boldsymbol{a}_i$ 分隔的边界时，总位移场的跳跃是一个恒定矢量，该矢量由宏观应变张量与该晶格矢量的乘积给出。\n\n**第3部分：位移跳跃的数值计算**\n\n题目要求我们计算与晶格矢量 $\\boldsymbol{a}_1$ 相关的相对边界对的位移跳跃矢量。使用第2部分中推导的公式，令 $i=1$，该跳跃记为 $\\Delta \\boldsymbol{u}_1$，即：\n$$\n\\Delta \\boldsymbol{u}_1 = \\boldsymbol{u}(\\boldsymbol{X}^+) - \\boldsymbol{u}(\\boldsymbol{X}^-) = \\overline{\\boldsymbol{E}}\\,\\boldsymbol{a}_1\n$$\n我们代入给定的 $\\overline{\\boldsymbol{E}}$ 和 $\\boldsymbol{a}_1$ 的数值：\n$$\n\\overline{\\boldsymbol{E}} = \\begin{pmatrix} 0.0117  0.0042 \\\\ 0.0042  -0.0031 \\end{pmatrix}, \\quad \\boldsymbol{a}_1 = \\begin{pmatrix} 5.7 \\\\ 3.4 \\end{pmatrix}\\,\\text{mm}\n$$\n计算过程为矩阵-矢量乘法：\n$$\n\\Delta \\boldsymbol{u}_1 = \\begin{pmatrix} 0.0117  0.0042 \\\\ 0.0042  -0.0031 \\end{pmatrix} \\begin{pmatrix} 5.7 \\\\ 3.4 \\end{pmatrix}\n$$\n结果矢量的分量计算如下：\n第一分量：\n$$\n(\\Delta \\boldsymbol{u}_1)_1 = (0.0117)(5.7) + (0.0042)(3.4) = 0.06669 + 0.01428 = 0.08097\n$$\n第二分量：\n$$\n(\\Delta \\boldsymbol{u}_1)_2 = (0.0042)(5.7) + (-0.0031)(3.4) = 0.02394 - 0.01054 = 0.01340\n$$\n宏观应变张量 $\\overline{\\boldsymbol{E}}$ 是无量纲的，矢量 $\\boldsymbol{a}_1$ 的单位是 mm，因此得到的位移跳跃矢量 $\\Delta \\boldsymbol{u}_1$ 的单位是 mm。题目要求答案四舍五入到四位有效数字。\n第一分量 $0.08097$ 已经是四位有效数字。\n第二分量 $0.01340$ 是四位有效数字。\n因此，位移跳跃矢量为：\n$$\n\\Delta \\boldsymbol{u}_1 = \\begin{pmatrix} 0.08097 \\\\ 0.01340 \\end{pmatrix}\\,\\text{mm}\n$$\n最终答案应以单行矩阵的形式呈现。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.08097  0.01340\n\\end{pmatrix}\n}\n$$", "id": "3608319"}, {"introduction": "建立了PBC的理论之后，下一步便是通过构建一个微观尺度求解器将其付诸实践。本练习涉及编写一个有限元程序，以求解在给定宏观应变下二维复合材料RVE内部的应力和应变场。掌握此实现是执行计算均匀化的基石。[@problem_id:3608310]", "problem": "您需要实现一个完整的小应变、二维、平面应变、线性弹性的微观尺度问题，用于双尺度计算均匀化（FE2）。该问题使用一个带有周期性边界条件（PBC）的代表性体积单元（RVE）。RVE 是单位正方形域 $\\Omega = [0,1] \\times [0,1]$，通过均匀的双线性四边形有限元（FE）网格进行离散，并由一个具有预设相属性和体积分数的两相复合材料占据。目标是针对给定的宏观单轴应变，计算均匀化（体积平均）的柯西应力。您必须编写一个程序，执行微观尺度的有限元求解，并为每个提供的测试用例输出均匀化应力分量 $\\bar{\\sigma}_{11}$。\n\n从头开始，基于小应变线性弹性、线性动量平衡和本构线性的第一性原理，除了核心定义外不使用任何简化公式：\n\n- 运动学：小应变张量为 $\\boldsymbol{\\varepsilon}(\\mathbf{u}) = \\frac{1}{2}(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\mathsf{T}})$，其中工程剪切应变定义为 $\\gamma_{12} = 2 \\varepsilon_{12}$。\n- 线性动量平衡（无体力）在微观尺度上为：$\\nabla \\cdot \\boldsymbol{\\sigma} = \\mathbf{0}$ 于 $\\Omega$ 中。\n- 平面应变条件下各向同性线性弹性的本构关系为：$\\boldsymbol{\\sigma} = \\mathbb{C} : \\boldsymbol{\\varepsilon}$，其中 $\\mathbb{C}$ 由杨氏模量 $E$ 和泊松比 $\\nu$ 通过拉梅参数 $\\lambda = \\dfrac{\\nu E}{(1+\\nu)(1-2\\nu)}$ 和 $\\mu = \\dfrac{E}{2(1+\\nu)}$ 确定，以及（在 Voigt 记法中，排序为 $[\\varepsilon_{11}, \\varepsilon_{22}, \\gamma_{12}]^{\\mathsf{T}}$ 的）$3 \\times 3$ 矩阵\n$$\n\\mathbf{C} = \n\\begin{bmatrix}\n\\lambda + 2\\mu  \\lambda  0 \\\\\n\\lambda  \\lambda + 2\\mu  0 \\\\\n0  0  \\mu\n\\end{bmatrix}.\n$$\n\n通过将微观尺度位移 $\\mathbf{u}(\\mathbf{x})$ 分解为 $\\mathbf{u}(\\mathbf{x}) = \\bar{\\boldsymbol{E}} \\, \\mathbf{x} + \\tilde{\\mathbf{u}}(\\mathbf{x})$ 来施加与给定宏观应变 $\\bar{\\boldsymbol{E}}$ 一致的周期性边界条件（PBC），其中 $\\tilde{\\mathbf{u}}(\\mathbf{x})$ 在相对边界上是周期性的。周期性通过约束相对边界节点对来实现，使其位移差等于宏观仿射部分，即对于一对相对边界上的对立点 $\\mathbf{x}^{+}$ 和 $\\mathbf{x}^{-}$，\n$$\n\\mathbf{u}(\\mathbf{x}^{+}) - \\mathbf{u}(\\mathbf{x}^{-}) = \\bar{\\boldsymbol{E}} \\, (\\mathbf{x}^{+} - \\mathbf{x}^{-}).\n$$\n为了消除 $\\tilde{\\mathbf{u}}$ 的刚体模态，固定单个参考节点的两个位移分量。\n\n使用有限元法，采用双线性四边形单元（Q4）和 $2 \\times 2$ 高斯积分。设网格沿 $x$ 方向有 $N_x$ 个单元，沿 $y$ 方向有 $N_y$ 个单元。对于此问题，固定 $N_x = 12$ 和 $N_y = 12$。使用等参映射，通过标准组装 $ \\mathbf{K}_e = \\int_{\\Omega_e} \\mathbf{B}^{\\mathsf{T}} \\mathbf{C} \\, \\mathbf{B} \\, \\mathrm{d}\\Omega$ 计算单元刚度矩阵，其中 $ \\mathbf{B}$ 是应变-位移矩阵，并组装全局刚度矩阵。\n\n两相复合材料定义如下。相 1 的杨氏模量为 $E_1$，泊松比为 $\\nu_1$；相 2 的杨氏模量为 $E_2$，泊松比为 $\\nu_2$。相 1 的目标体积分数为 $v_f \\in [0,1]$。材料分布是完全周期的垂直分层：相 1 占据 $\\{(x,y) \\in \\Omega: x \\in [0, v_f)\\}$，相 2 占据其余部分。这在连续介质设定中精确实现了所需的体积分数，并与 RVE 的周期性延拓一致。在有限元离散化中，根据每个单元形心的 $x$ 坐标相对于 $v_f$ 来分配其本构张量 $\\mathbf{C}_e$。\n\n对于宏观加载，施加形式如下的单轴宏观应变\n$$\n\\bar{\\boldsymbol{E}} = \n\\begin{bmatrix}\n\\bar{\\varepsilon}_{11}  0 \\\\\n0  0\n\\end{bmatrix},\n$$\n其中 $\\bar{\\varepsilon}_{11}$ 是给定的。在 PBC 和参考节点约束下求解微观问题，然后通过体积平均计算均匀化柯西应力，\n$$\n\\bar{\\boldsymbol{\\sigma}} = \\frac{1}{|\\Omega|} \\int_{\\Omega} \\boldsymbol{\\sigma}(\\mathbf{x}) \\, \\mathrm{d}\\Omega = \\frac{1}{|\\Omega|} \\sum_{e} \\int_{\\Omega_e} \\mathbf{C}_e \\, \\mathbf{B} \\, \\mathbf{u}_h \\, \\mathrm{d}\\Omega,\n$$\n并报告 $\\bar{\\sigma}_{11}$ 分量。\n\n物理单位：所有杨氏模量 $E_1$ 和 $E_2$ 必须解释为帕斯卡（Pa）。泊松比 $\\nu_1$ 和 $\\nu_2$ 是无量纲的。宏观应变 $\\bar{\\varepsilon}_{11}$ 是无量纲的。输出的均匀化应力 $\\bar{\\sigma}_{11}$ 必须以帕斯卡（Pa）为单位报告。不使用角度。不得出现百分比；体积分数 $v_f$ 是 $[0,1]$ 内的小数。\n\n有限元离散化和积分的数值规范：\n- 在 $\\Omega$ 上使用具有 $N_x = 12$ 和 $N_y = 12$ 个双线性四边形单元的均匀网格。\n- 每个单元使用 $2 \\times 2$ 高斯积分，标准积分点位于 $\\pm 1/\\sqrt{3}$，权重为单位权重。\n- 通过在 $x$ 和 $y$ 方向上的周期性节点配对来施加 PBC，其中仿射宏观跳跃由 $\\bar{\\boldsymbol{E}}$ 定义。\n- 通过固定位于 $(0,0)$ 的主节点的两个位移分量来消除刚体模态。\n\n测试套件：\n您的程序必须运行以下四个测试用例，并为每个用例输出均匀化的 $\\bar{\\sigma}_{11}$，单位为帕斯卡（Pa）：\n1. $E_1 = 200 \\times 10^{9}$，$\\nu_1 = 0.30$，$E_2 = 70 \\times 10^{9}$，$\\nu_2 = 0.33$，$v_f = 0.30$，$\\bar{\\varepsilon}_{11} = 0.001$。\n2. $E_1 = 150 \\times 10^{9}$，$\\nu_1 = 0.28$，$E_2 = 50 \\times 10^{9}$，$\\nu_2 = 0.25$，$v_f = 0.0$，$\\bar{\\varepsilon}_{11} = 0.001$。\n3. $E_1 = 210 \\times 10^{9}$，$\\nu_1 = 0.30$，$E_2 = 5 \\times 10^{9}$，$\\nu_2 = 0.45$，$v_f = 1.0$，$\\bar{\\varepsilon}_{11} = 0.0005$。\n4. $E_1 = 100 \\times 10^{9}$，$\\nu_1 = 0.29$，$E_2 = 1 \\times 10^{9}$，$\\nu_2 = 0.35$，$v_f = 0.50$，$\\bar{\\varepsilon}_{11} = 0.002$。\n\n答案格式：\n- 您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，采用科学记数法，小数点后保留六位数字，即 $[\\text{res}_1,\\text{res}_2,\\text{res}_3,\\text{res}_4]$，其中每个 $\\text{res}_k$ 是 $\\bar{\\sigma}_{11}$（单位为帕斯卡，Pa），格式例如为 $1.234567\\text{e}+08$。", "solution": "用户提供了一个在计算固体力学领域中定义明确的问题，具体涉及双尺度计算均匀化。任务是为一个二维、平面应变、线性弹性的代表性体积单元（RVE）实现一个带有周期性边界条件（PBC）的有限元（FE）模型。目标是计算由给定的宏观应变产生的均匀化应力张量。\n\n该问题陈述经过验证，是科学上合理、定义明确且客观的。它提供了所有必要的信息，包括控制方程、本构定律、边界条件、离散化参数、材料属性和加载工况，从而可以进行直接而明确的实现。\n\n解决方案如下：\n\n**1. 理论公式**\n\n微观尺度问题由线性动量平衡控制，在没有体力的情况下为 $\\nabla \\cdot \\boldsymbol{\\sigma} = \\mathbf{0}$，其中 $\\boldsymbol{\\sigma}$ 是柯西应力张量。材料行为由线性各向同性弹性本构关系 $\\boldsymbol{\\sigma} = \\mathbb{C} : \\boldsymbol{\\varepsilon}$ 描述，其中 $\\mathbb{C}$ 是四阶弹性张量，$\\boldsymbol{\\varepsilon}$ 是小应变张量，$\\boldsymbol{\\varepsilon}(\\mathbf{u}) = \\frac{1}{2}(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\mathsf{T}})$。对于平面应变条件，Voigt 记法（$[\\varepsilon_{11}, \\varepsilon_{22}, \\gamma_{12}]^\\mathsf{T}$）中的本构矩阵 $\\mathbf{C}$ 如下：\n$$\n\\mathbf{C} = \n\\begin{bmatrix}\n\\lambda + 2\\mu  \\lambda  0 \\\\\n\\lambda  \\lambda + 2\\mu  0 \\\\\n0  0  \\mu\n\\end{bmatrix}\n$$\n其中 $\\lambda = \\frac{\\nu E}{(1+\\nu)(1-2\\nu)}$ 和 $\\mu = \\frac{E}{2(1+\\nu)}$ 是拉梅参数，由杨氏模量 $E$ 和泊松比 $\\nu$ 定义。\n\n**2. 周期性边界条件（PBC）与有限元离散化**\n\n均匀化的关键在于施加 PBC，它将微观尺度位移场 $\\mathbf{u}(\\mathbf{x})$ 与宏观应变张量 $\\bar{\\boldsymbol{E}}$ 联系起来。位移场被分解为 $\\mathbf{u}(\\mathbf{x}) = \\bar{\\boldsymbol{E}} \\mathbf{x} + \\tilde{\\mathbf{u}}(\\mathbf{x})$，其中 $\\tilde{\\mathbf{u}}(\\mathbf{x})$ 是一个周期性波动场。这导致对 RVE 相对边界上的任意一对点 $\\mathbf{x}^{+}$ 和 $\\mathbf{x}^{-}$ 的约束：\n$$\n\\mathbf{u}(\\mathbf{x}^{+}) - \\mathbf{u}(\\mathbf{x}^{-}) = \\bar{\\boldsymbol{E}} (\\mathbf{x}^{+} - \\mathbf{x}^{-})\n$$\n在有限元框架中，这转化为相对边界上节点的自由度（DOF）之间的线性约束方程。我们采用主从方法。左边界和下边界上的节点被指定为“主”节点，右边界和上边界上的节点被指定为“从”节点。从节点的自由度通过其对应主节点的自由度加上一个源自 $\\bar{\\boldsymbol{E}}$ 的非齐次项来表示。对于给定的加载 $\\bar{\\boldsymbol{E}} = \\text{diag}(\\bar{\\varepsilon}_{11}, 0)$，节点位移 $\\mathbf{d}$ 的约束为：\n- 对于右/左边界上的一对节点（在 $x=1, x=0$）：$\\mathbf{d}(1, y_j) = \\mathbf{d}(0, y_j) + [\\bar{\\varepsilon}_{11}, 0]^{\\mathsf{T}}$。\n- 对于上/下边界上的一对节点（在 $y=1, y=0$）：$\\mathbf{d}(x_i, 1) = \\mathbf{d}(x_i, 0)$。\n\n这些约束用于消除从自由度，从而得到一个缩减的线性方程组 $\\mathbf{K}^* \\mathbf{d}^* = \\mathbf{F}^*$，其中 $\\mathbf{d}^*$ 仅包含独立的主自由度。为确保通过消除波动场 $\\tilde{\\mathbf{u}}$ 的刚体运动来获得唯一解，一个主节点（这里是原点 $(0,0)$ 处的节点）的位移被固定为零。\n\nRVE 域 $\\Omega = [0,1] \\times [0,1]$ 使用一个均匀的 $N_x \\times N_y = 12 \\times 12$ 双线性四边形（Q4）单元网格进行离散化。使用标准的等参有限元程序。单元刚度矩阵 $\\mathbf{K}_e = \\int_{\\Omega_e} \\mathbf{B}^{\\mathsf{T}} \\mathbf{C} \\mathbf{B} \\, \\mathrm{d}\\Omega$ 通过 $2 \\times 2$ 高斯积分计算，其中 $\\mathbf{B}$ 是应变-位移矩阵。\n\n**3. 缩减系统的组装**\n\n组装过程将全局系统凝聚为针对独立自由度 $\\mathbf{d}^*$ 的缩减系统。对于每个单元，计算其刚度矩阵 $\\mathbf{K}_e$。每个条目 $K_{e,ij}$ 对缩减系统的贡献由局部自由度 $i$ 和 $j$ 的主从关系确定。如果局部自由度 $j$ 是一个从自由度，其位移为 $d_j = d_{m_j} + g_j$（其中 $d_{m_j}$ 是主自由度，$g_j$ 是跳跃量），则其贡献被分开：刚度部分 $K_{e,ij}d_{m_j}$ 被组装到缩减刚度矩阵 $\\mathbf{K}^*$ 中，而给定强制位移部分 $K_{e,ij}g_j$ 被移到右侧，贡献于缩减力向量 $\\mathbf{F}^*$。\n\n**4. 求解与均匀化**\n\n在组装好 $\\mathbf{K}^*$ 和 $\\mathbf{F}^*$ 之后，求解该线性系统以获得未知的主位移 $\\mathbf{d}^*$。随后，通过应用主从关系重建整个 RVE 上的完整位移场。\n\n最后一步是计算均匀化应力张量，即微观尺度应力的体积平均值：\n$$\n\\bar{\\boldsymbol{\\sigma}} = \\frac{1}{|\\Omega|} \\int_{\\Omega} \\boldsymbol{\\sigma}(\\mathbf{x}) \\, \\mathrm{d}\\Omega\n$$\n由于 $|\\Omega|=1$，这简化为应力在域上的积分。在有限元背景下，该积分计算为对每个单元积分的总和，并使用相同的高斯积分方案进行评估：\n$$\n\\bar{\\boldsymbol{\\sigma}} = \\sum_e \\int_{\\Omega_e} \\mathbf{C}_e \\mathbf{B} \\mathbf{d}_e \\, \\mathrm{d}\\Omega = \\sum_e \\sum_{g} \\mathbf{C}_e \\mathbf{B}(\\mathbf{x}_g) \\mathbf{d}_e \\det(\\mathbf{J}(\\mathbf{x}_g)) w_g\n$$\n其中 $\\mathbf{d}_e$ 是单元 $e$ 重建的节点位移，求和遍及所有单元和所有权重为 $w_g$ 的高斯点 $\\mathbf{x}_g$。程序为每个测试用例计算此均匀化应力张量的 $\\bar{\\sigma}_{11}$ 分量。\n$v_f=0$ 和 $v_f=1$ 的情况对应于均质材料，其精确解析解为 $\\bar{\\sigma}_{11} = \\frac{E(1-\\nu)}{(1+\\nu)(1-2\\nu)} \\bar{\\varepsilon}_{11}$。层状复合材料的情况在这些加载条件下也有已知的解析解，这为数值实现提供了有力的验证。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function that orchestrates the execution for all test cases.\n    \"\"\"\n\n    def get_shape_functions(xi, eta):\n        \"\"\"\n        Returns shape functions N and their derivatives dN/d_xi, dN/d_eta for a Q4 element.\n        \"\"\"\n        N = 0.25 * np.array([\n            (1.0 - xi) * (1.0 - eta),\n            (1.0 + xi) * (1.0 - eta),\n            (1.0 + xi) * (1.0 + eta),\n            (1.0 - xi) * (1.0 + eta)\n        ])\n        dN_dxi = 0.25 * np.array([\n            -(1.0 - eta),\n            (1.0 - eta),\n            (1.0 + eta),\n            -(1.0 + eta)\n        ])\n        dN_deta = 0.25 * np.array([\n            -(1.0 - xi),\n            -(1.0 + xi),\n            (1.0 + xi),\n            (1.0 - xi)\n        ])\n        return N, dN_dxi, dN_deta\n\n    def get_constitutive_matrix(E, nu):\n        \"\"\"\n        Returns the plane strain constitutive matrix C in Voigt notation.\n        \"\"\"\n        lam = (nu * E) / ((1.0 + nu) * (1.0 - 2.0 * nu))\n        mu = E / (2.0 * (1.0 + nu))\n        \n        C = np.array([\n            [lam + 2.0 * mu, lam, 0.0],\n            [lam, lam + 2.0 * mu, 0.0],\n            [0.0, 0.0, mu]\n        ])\n        return C\n\n    def run_fem_case(E1, nu1, E2, nu2, vf, eps11_macro, Nx, Ny):\n        \"\"\"\n        Runs a single FE2 micro-scale simulation for a given test case.\n        \"\"\"\n        # --- Setup FEM Parameters ---\n        num_nodes_x = Nx + 1\n        num_nodes_y = Ny + 1\n        total_nodes = num_nodes_x * total_nodes\n        total_dofs = 2 * total_nodes\n        gauss_points = np.array([-1.0 / np.sqrt(3.0), 1.0 / np.sqrt(3.0)])\n\n        # 1. DOF mapping for independent (master) DOFs\n        # Independent nodes are (i,j) for 0 = i  Nx, 0 = j  Ny\n        num_independent_nodes = Nx * Ny\n        num_reduced_dofs = 2 * num_independent_nodes - 2\n        \n        dof_map = -np.ones((Nx, Ny, 2), dtype=int)\n        dof_counter = 0\n        for j in range(Ny):\n            for i in range(Nx):\n                if i == 0 and j == 0:\n                    continue  # Node (0,0) is fixed\n                dof_map[i, j, 0] = dof_counter\n                dof_counter += 1\n                dof_map[i, j, 1] = dof_counter\n                dof_counter += 1\n\n        # 2. Assembly of reduced system K*d=F\n        K_reduced = np.zeros((num_reduced_dofs, num_reduced_dofs))\n        F_reduced = np.zeros(num_reduced_dofs)\n\n        # Element loop\n        for ey in range(Ny):\n            for ex in range(Nx):\n                node_coords_idx = [\n                    (ex, ey), (ex + 1, ey), (ex + 1, ey + 1), (ex, ey + 1)\n                ]\n                elem_coords = np.array(node_coords_idx, dtype=float)\n                elem_coords[:, 0] /= Nx\n                elem_coords[:, 1] /= Ny\n                \n                centroid_x = (ex + 0.5) / Nx\n                C = get_constitutive_matrix(E1, nu1) if centroid_x  vf else get_constitutive_matrix(E2, nu2)\n\n                Ke = np.zeros((8, 8))\n                for gp_eta in gauss_points:\n                    for gp_xi in gauss_points:\n                        _, dN_dxi, dN_deta = get_shape_functions(gp_xi, gp_eta)\n                        \n                        J = np.array([dN_dxi, dN_deta]) @ elem_coords\n                        detJ = np.linalg.det(J)\n                        invJ = np.linalg.inv(J)\n                        dN_dx_dy = invJ @ np.array([dN_dxi, dN_deta])\n                        \n                        B = np.zeros((3, 8))\n                        for i in range(4):\n                            B[0, 2*i] = dN_dx_dy[0, i]\n                            B[1, 2*i+1] = dN_dx_dy[1, i]\n                            B[2, 2*i] = dN_dx_dy[1, i]\n                            B[2, 2*i+1] = dN_dx_dy[0, i]\n                        Ke += B.T @ C @ B * detJ\n                \n                master_dof_indices = -np.ones(8, dtype=int)\n                g_jumps = np.zeros(8)\n                \n                for i_node in range(4):\n                    i, j = node_coords_idx[i_node]\n                    mi, mj = i % Nx, j % Ny\n                    \n                    jump_x = eps11_macro if i == Nx else 0.0\n                    jump_y = 0.0 # No jump in y-dir for this loading\n                    \n                    if mi == 0 and mj == 0:\n                        master_dof_indices[2*i_node:2*i_node+2] = -1\n                    else:\n                        master_dof_indices[2*i_node] = dof_map[mi, mj, 0]\n                        master_dof_indices[2*i_node+1] = dof_map[mi, mj, 1]\n\n                    g_jumps[2*i_node] = (i // Nx) * jump_x\n                    g_jumps[2*i_node+1] = (j // Ny) * jump_y\n\n                for i_dof in range(8):\n                    ri = master_dof_indices[i_dof]\n                    if ri == -1: continue\n                    \n                    for j_dof in range(8):\n                        rj = master_dof_indices[j_dof]\n                        F_reduced[ri] -= Ke[i_dof, j_dof] * g_jumps[j_dof]\n                        if rj != -1:\n                            K_reduced[ri, rj] += Ke[i_dof, j_dof]\n\n        # 3. Solve the system\n        d_reduced = np.linalg.solve(K_reduced, F_reduced)\n        \n        # 4. Reconstruct full displacement field\n        d_full = np.zeros(total_dofs)\n        for j in range(num_nodes_y):\n            for i in range(num_nodes_x):\n                node_idx = j * num_nodes_x + i\n                mi, mj = i % Nx, j % Ny\n                \n                jump_x = eps11_macro if i == Nx else 0.0\n                jump_y = 0.0\n                \n                if mi == 0 and mj == 0:\n                    ux_master, uy_master = 0.0, 0.0\n                else:\n                    idx_x, idx_y = dof_map[mi, mj, 0], dof_map[mi, mj, 1]\n                    ux_master, uy_master = d_reduced[idx_x], d_reduced[idx_y]\n\n                d_full[2 * node_idx] = ux_master + (i // Nx) * jump_x\n                d_full[2 * node_idx + 1] = uy_master + (j // Ny) * jump_y\n\n        # 5. Post-processing: Compute homogenized stress\n        avg_stress = np.zeros(3)\n        for ey in range(Ny):\n            for ex in range(Nx):\n                node_coords_idx = [\n                    (ex, ey), (ex + 1, ey), (ex + 1, ey + 1), (ex, ey + 1)\n                ]\n                elem_coords = np.array(node_coords_idx, dtype=float)\n                elem_coords[:, 0] /= Nx\n                elem_coords[:, 1] /= Ny\n                \n                centroid_x = (ex + 0.5) / Nx\n                C = get_constitutive_matrix(E1, nu1) if centroid_x  vf else get_constitutive_matrix(E2, nu2)\n\n                elem_dofs = np.zeros(8)\n                for i_node in range(4):\n                    i, j = node_coords_idx[i_node]\n                    node_idx = j * num_nodes_x + i\n                    elem_dofs[2*i_node:2*i_node+2] = d_full[2*node_idx:2*node_idx+2]\n                    \n                for gp_eta in gauss_points:\n                    for gp_xi in gauss_points:\n                        _, dN_dxi, dN_deta = get_shape_functions(gp_xi, gp_eta)\n                        J = np.array([dN_dxi, dN_deta]) @ elem_coords\n                        detJ = np.linalg.det(J)\n                        invJ = np.linalg.inv(J)\n                        dN_dx_dy = invJ @ np.array([dN_dxi, dN_deta])\n                        \n                        B = np.zeros((3, 8))\n                        for i in range(4):\n                            B[0, 2*i] = dN_dx_dy[0, i]\n                            B[1, 2*i+1] = dN_dx_dy[1, i]\n                            B[2, 2*i] = dN_dx_dy[1, i]\n                            B[2, 2*i+1] = dN_dx_dy[0, i]\n                        \n                        avg_stress += (C @ (B @ elem_dofs)) * detJ\n        \n        return avg_stress[0]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (200e9, 0.30, 70e9, 0.33, 0.30, 0.001),\n        (150e9, 0.28, 50e9, 0.25, 0.0, 0.001),\n        (210e9, 0.30, 5e9, 0.45, 1.0, 0.0005),\n        (100e9, 0.29, 1e9, 0.35, 0.50, 0.002),\n    ]\n\n    results = []\n    # Fixed FE discretization parameters\n    Nx, Ny = 12, 12\n\n    for case in test_cases:\n        E1, nu1, E2, nu2, vf, eps11_macro = case\n        sigma11_hom = run_fem_case(E1, nu1, E2, nu2, vf, eps11_macro, Nx, Ny)\n        results.append(f\"{sigma11_hom:.6e}\")\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3608310"}, {"introduction": "微观尺度的RVE分析为大型结构中的单个材料点提供了有效的本构响应（均匀化的应力和切线模量）。最后一个练习演示了如何在非线性有限元框架中于宏观尺度使用这些信息。您将为一个简单的结构实现一个牛顿-拉弗森（Newton-Raphson）迭代步，利用RVE的输出计算结构响应，从而完成完整的$FE^2$计算框架。[@problem_id:3608362]", "problem": "针对一个带有代表性体积单元 (RVE) 的双尺度计算均匀化问题，在宏观尺度上实现单次 Newton–Raphson 迭代。宏观物体是一根一维杆，由一个 $2$ 节点有限元离散化。微观尺度由一个有效的超弹性本构响应表示，该响应源于 RVE 求解，可在任何宏观试应变下提供均匀化的宏观应力及一致切线模量。您的任务是推导、组装并编程一个宏观 Newton 步，以更新宏观应变，并将其应用于提供的测试套件。\n\n从计算固体力学中的以下基本基础开始：\n- 线性动量的弱形式平衡：对于所有容许的虚位移，内部虚功等于外部虚功。\n- 具有 $2$ 个节点的杆的有限元离散化使用线性形函数，导致单元内应变为常数。设形函数导数构成矩阵 $B$，使得 $ \\bar{\\epsilon} = B \\, u $，其中 $u$ 是节点位移向量，$\\bar{\\epsilon}$ 是小应变假设下的宏观 Green–Lagrange 应变（即，$\\bar{\\epsilon}$ 是无穷小应变）。\n- 宏观应力是满足微观到宏观能量一致性（Hill–Mandel 条件）的 RVE 均匀化 Cauchy 应力 $ \\bar{\\sigma} $，宏观一致切线模量是 $ \\mathbb{C}^{\\text{cons}} = \\dfrac{\\partial \\bar{\\sigma}}{\\partial \\bar{\\epsilon}} $，由 RVE 在当前宏观应变下求解提供。\n- Newton–Raphson 方法将残差在当前迭代点 $u^{(k)}$ 附近线性化，并从线性化系统中求解增量 $\\Delta u^{(k)}$，然后更新 $u^{(k+1)} = u^{(k)} + \\Delta u^{(k)}$。\n\n为此问题提供的微观尺度 RVE 闭合：\n- RVE 的有效储存能量密度为 $ W(\\bar{\\epsilon}) = \\dfrac{1}{2} E \\, \\bar{\\epsilon}^{2} + \\dfrac{1}{4} \\alpha \\, \\bar{\\epsilon}^{4} $，其中 $E$ 和 $\\alpha$ 是材料参数。这通过 $ \\bar{\\sigma}(\\bar{\\epsilon}) = \\dfrac{\\mathrm{d} W}{\\mathrm{d} \\bar{\\epsilon}} $ 和 $ \\mathbb{C}^{\\text{cons}}(\\bar{\\epsilon}) = \\dfrac{\\mathrm{d} \\bar{\\sigma}}{\\mathrm{d} \\bar{\\epsilon}} $ 定义了均匀化应力和一致切线模量。这些是您必须用来组装宏观残差和切线模量的微观尺度输出。\n\n宏观模型与加载：\n- 一个长度为 $L$、横截面积为 $A$ 的单 $2$ 节点杆单元，在右端 ($x=L$) 受到指定的轴向牵引力 $T$，在左端 ($x=0$) 受到位移边界条件 $u(0)=0$ 的约束。杆与 $x$ 轴对齐。\n- 使用一维小应变运动学。单元应变为常数，等于 $ \\bar{\\epsilon} = \\dfrac{u_{2}-u_{1}}{L} $，其中 $u_{1}$ 和 $u_{2}$ 分别是 $x=0$ 和 $x=L$ 处的节点位移。初始迭代值为 $u_{1}^{(0)}=0$ 和每个测试用例给定的 $u_{2}^{(0)}$。\n\n单个 Newton 步的组装要求：\n- 使用在当前迭代的宏观应变下评估的 RVE 提供的 $ \\bar{\\sigma} $ 来组装宏观残差向量 $R(u)$。将内力表示为单元积分 $ B^{\\mathsf{T}} \\bar{\\sigma} A $，并减去外部节点力，后者代表右侧节点的牵引力 $T$。\n- 使用在当前迭代的宏观应变下评估的 RVE 提供的一致切线模量 $ \\mathbb{C}^{\\text{cons}} $，通过单元积分 $ B^{\\mathsf{T}} \\mathbb{C}^{\\text{cons}} B \\, A $ 来组装宏观切线矩阵 $K(u)$。\n- 通过缩减至自由度 $u_{2}$ 来施加本质边界条件 $u_{1}=0$，求解线性化方程以获得增量 $\\Delta u_{2}$，并更新 $u_{2}^{(1)} = u_{2}^{(0)} + \\Delta u_{2}$。\n- 将单个 Newton 步后更新的宏观应变报告为 $ \\bar{\\epsilon}^{(1)} = \\dfrac{u_{2}^{(1)} - 0}{L} $。\n\n物理单位：\n- 使用国际单位制。长度 $L$ 以米 ($\\mathrm{m}$) 为单位，面积 $A$ 以平方米 ($\\mathrm{m}^{2}$) 为单位，模量 $E$ 和参数 $\\alpha$ 以帕斯卡 ($\\mathrm{Pa}$) 为单位，牵引力 $T$ 以牛顿 ($\\mathrm{N}$) 为单位，位移 $u$ 以米 ($\\mathrm{m}$) 为单位，应力 $ \\bar{\\sigma} $ 以帕斯卡 ($\\mathrm{Pa}$) 为单位，应变 $ \\bar{\\epsilon} $ 是无量纲的。将所要求的最终应变表示为无量纲的浮点数。\n\n测试套件：\n- 情况 1：$E = 70\\times 10^{9}~\\mathrm{Pa}$，$\\alpha = 5\\times 10^{11}~\\mathrm{Pa}$，$A = 5\\times 10^{-4}~\\mathrm{m}^{2}$，$L = 2.0~\\mathrm{m}$，$T = 5.0\\times 10^{5}~\\mathrm{N}$，$u_{2}^{(0)} = 0.0~\\mathrm{m}$。\n- 情况 2：$E = 210\\times 10^{9}~\\mathrm{Pa}$，$\\alpha = 0~\\mathrm{Pa}$，$A = 1\\times 10^{-4}~\\mathrm{m}^{2}$，$L = 1.0~\\mathrm{m}$，$T = 0~\\mathrm{N}$，$u_{2}^{(0)} = 1\\times 10^{-4}~\\mathrm{m}$。\n- 情况 3：$E = 1\\times 10^{8}~\\mathrm{Pa}$，$\\alpha = 1\\times 10^{10}~\\mathrm{Pa}$，$A = 1\\times 10^{-3}~\\mathrm{m}^{2}$，$L = 0.5~\\mathrm{m}$，$T = 2\\times 10^{4}~\\mathrm{N}$，$u_{2}^{(0)} = -1\\times 10^{-3}~\\mathrm{m}$。\n\n要求的程序输出：\n- 对于每个测试用例，按照所述计算单次 Newton 步后更新的宏观应变 $ \\bar{\\epsilon}^{(1)} $，并按用例顺序将结果作为包含 Python 风格浮点数列表的单行字符串返回，不含额外文本，例如 $[\\text{e1},\\text{e2},\\text{e3}]$。\n\n您的程序必须是一个完整、可运行的实现，仅使用提供的测试套件，并以指定格式精确打印一行。不应读取任何用户输入。所有数值输出必须如所述为无量纲形式。", "solution": "该问题要求为由单个有限元建模的宏观一维杆实现单次 Newton-Raphson 迭代。其本构响应不是由标准材料定律给出，而是由代表性体积单元 (RVE) 的均匀化有效响应提供，这是双尺度计算均匀化的一个关键概念。\n\n推导过程从有限元法和 Newton-Raphson 算法的基本原理出发，并应用于特定的宏观问题设置。\n\n**1. 有限元运动学**\n\n宏观物体是一根长度为 $L$、横截面积恒为 $A$ 的一维杆。它使用一个 $2$ 节点线性有限元进行离散化。节点位移由向量 $u = [u_1, u_2]^{\\mathsf{T}}$ 表示，其中 $u_1$ 是 $x=0$ 处的位移，$u_2$ 是 $x=L$ 处的位移。\n\n在小應變運動學假設下，軸向應變 $\\bar{\\epsilon}$ 在整个单元内是恒定的。它通过应变-位移矩阵 $B$ 与节点位移相关联：\n$$\n\\bar{\\epsilon} = \\frac{u_2 - u_1}{L}\n$$\n这可以写成矩阵形式 $\\bar{\\epsilon} = B u$，其中该单元的矩阵 $B$ 为：\n$$\nB = \\begin{bmatrix} -1/L  1/L \\end{bmatrix}\n$$\n\n**2. 来自 RVE 的均匀化本构律**\n\n该问题提供了源自 RVE 的有效本构行为。有效储存能量密度 $W$ 是宏观应变 $\\bar{\\epsilon}$ 的函数：\n$$\nW(\\bar{\\epsilon}) = \\frac{1}{2} E \\bar{\\epsilon}^{2} + \\frac{1}{4} \\alpha \\bar{\\epsilon}^{4}\n$$\n其中 $E$ 和 $\\alpha$ 是从均匀化过程中获得的材料参数。\n\n宏观 Cauchy 应力 $\\bar{\\sigma}$（轴向）是储存能量密度对宏观应变的导数：\n$$\n\\bar{\\sigma}(\\bar{\\epsilon}) = \\frac{\\mathrm{d}W}{\\mathrm{d}\\bar{\\epsilon}} = E \\bar{\\epsilon} + \\alpha \\bar{\\epsilon}^{3}\n$$\n宏观一致切线模量 $\\mathbb{C}^{\\text{cons}}$ 是应力对应变的导数，这对于 Newton-Raphson 方法的二次收敛至关重要：\n$$\n\\mathbb{C}^{\\text{cons}}(\\bar{\\epsilon}) = \\frac{\\mathrm{d}\\bar{\\sigma}}{\\mathrm{d}\\bar{\\epsilon}} = E + 3 \\alpha \\bar{\\epsilon}^{2}\n$$\n这些表达式定义了 RVE 对宏观计算的贡献。在每个宏观积分点（本例中，整个单元只有一个点），概念上需要求解 RVE 问题以获得 $\\bar{\\sigma}$ 和 $\\mathbb{C}^{\\text{cons}}$；在这里，这些关系是解析给出的。\n\n**3. 宏观尺度上的 Newton-Raphson 公式**\n\nNewton-Raphson 方法迭代求解源于线性动量守恒弱形式的非线性方程组 $R(u) = 0$，其中 $R(u)$ 是残差向量。对于迭代点 $u^{(k)}$，该方法求解线性化系统以获得位移增量 $\\Delta u^{(k)}$：\n$$\nK(u^{(k)}) \\Delta u^{(k)} = -R(u^{(k)})\n$$\n切线刚度矩阵为 $K(u) = \\frac{\\partial R(u)}{\\partial u}$。然后更新解：$u^{(k+1)} = u^{(k)} + \\Delta u^{(k)}$。\n\n残差向量 $R(u)$ 是内力 $F_{\\text{int}}$ 与外力 $F_{\\text{ext}}$之差：\n$$\nR(u) = F_{\\text{int}}(u) - F_{\\text{ext}}\n$$\n\n内力向量通过在单元体积 $V$ 上对应力进行积分来组装：\n$$\nF_{\\text{int}}(u) = \\int_{V} B^{\\mathsf{T}} \\bar{\\sigma} \\, \\mathrm{d}V\n$$\n由于 $B$ 和 $\\bar{\\sigma}$ 在单元上是常数，积分简化为 $V B^{\\mathsf{T}} \\bar{\\sigma}$，其中 $V = A L$：\n$$\nF_{\\text{int}}(u) = A L \\begin{pmatrix} -1/L \\\\ 1/L \\end{pmatrix} \\bar{\\sigma} = \\begin{pmatrix} -A \\bar{\\sigma} \\\\ A \\bar{\\sigma} \\end{pmatrix}\n$$\n\n外力向量 $F_{\\text{ext}}$ 来自于右端（$x=L$，节点 $2$）施加的牵引力 $T$：\n$$\nF_{\\text{ext}} = \\begin{pmatrix} 0 \\\\ T \\end{pmatrix}\n$$\n\n综合这些，残差向量为：\n$$\nR(u) = \\begin{pmatrix} -A \\bar{\\sigma} \\\\ A \\bar{\\sigma} - T \\end{pmatrix}\n$$\n\n切线刚度矩阵 $K(u)$ 通过对一致切线模量进行积分来组装：\n$$\nK(u) = \\int_{V} B^{\\mathsf{T}} \\mathbb{C}^{\\text{cons}} B \\, \\mathrm{d}V\n$$\n同样，由于所有量都是常数，这简化为 $V B^{\\mathsf{T}} \\mathbb{C}^{\\text{cons}} B$：\n$$\nK(u) = A L \\begin{pmatrix} -1/L \\\\ 1/L \\end{pmatrix} \\mathbb{C}^{\\text{cons}} \\begin{bmatrix} -1/L  1/L \\end{bmatrix} = A L \\frac{\\mathbb{C}^{\\text{cons}}}{L^2} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} = \\frac{A \\mathbb{C}^{\\text{cons}}}{L} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}\n$$\n\n**4. 单次迭代的系统缩减与求解**\n\n我们从初始猜测 $u^{(0)} = [u_1^{(0)}, u_2^{(0)}]^{\\mathsf{T}}$ 开始。问题指定了边界条件 $u(0)=0$，这意味着 $u_1=0$。这个本质边界条件通过在所有迭代 $k$ 中设置 $u_1^{(k)}=0$ 来施加，因此增量 $\\Delta u_1^{(k)}$ 也必须为 $0$。\n\n在迭代 $k=0$ 时的完整线性系统是：\n$$\n\\frac{A \\mathbb{C}^{\\text{cons},(0)}}{L} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} \\begin{pmatrix} \\Delta u_1^{(0)} \\\\ \\Delta u_2^{(0)} \\end{pmatrix} = - \\begin{pmatrix} -A \\bar{\\sigma}^{(0)} \\\\ A \\bar{\\sigma}^{(0)} - T \\end{pmatrix}\n$$\n其中 $\\bar{\\epsilon}^{(0)} = (u_2^{(0)} - u_1^{(0)})/L$，$\\bar{\\sigma}^{(0)} = \\bar{\\sigma}(\\bar{\\epsilon}^{(0)})$，且 $\\mathbb{C}^{\\text{cons},(0)} = \\mathbb{C}^{\\text{cons}}(\\bar{\\epsilon}^{(0)})$。\n\n我们将系统缩减至自由度 $u_2$。从矩阵方程的第二行，并设 $\\Delta u_1^{(0)}=0$：\n$$\n\\frac{A \\mathbb{C}^{\\text{cons},(0)}}{L} ( -1 \\cdot \\Delta u_1^{(0)} + 1 \\cdot \\Delta u_2^{(0)} ) = -(A \\bar{\\sigma}^{(0)} - T)\n$$\n$$\n\\frac{A \\mathbb{C}^{\\text{cons},(0)}}{L} \\Delta u_2^{(0)} = T - A \\bar{\\sigma}^{(0)}\n$$\n求解位移增量 $\\Delta u_2^{(0)}$：\n$$\n\\Delta u_2^{(0)} = \\frac{L}{A \\mathbb{C}^{\\text{cons},(0)}} (T - A \\bar{\\sigma}^{(0)})\n$$\n节点 2 更新后的位移为 $u_2^{(1)} = u_2^{(0)} + \\Delta u_2^{(0)}$。\n\n我们关心的量是更新后的宏观应变 $\\bar{\\epsilon}^{(1)}$：\n$$\n\\bar{\\epsilon}^{(1)} = \\frac{u_2^{(1)} - u_1^{(1)}}{L} = \\frac{u_2^{(0)} + \\Delta u_2^{(0)}}{L} = \\bar{\\epsilon}^{(0)} + \\frac{\\Delta u_2^{(0)}}{L}\n$$\n代入 $\\Delta u_2^{(0)}$ 的表达式：\n$$\n\\bar{\\epsilon}^{(1)} = \\bar{\\epsilon}^{(0)} + \\frac{1}{L} \\left( \\frac{L}{A \\mathbb{C}^{\\text{cons},(0)}} (T - A \\bar{\\sigma}^{(0)}) \\right) = \\bar{\\epsilon}^{(0)} + \\frac{T - A \\bar{\\sigma}^{(0)}}{A \\mathbb{C}^{\\text{cons},(0)}}\n$$\n这导出了一个更直接的应变更新公式。令 $\\bar{T} = T/A$ 为指定的宏观应力（牵引力）。则应变增量为：\n$$\n\\Delta \\bar{\\epsilon}^{(0)} = \\frac{\\bar{T} - \\bar{\\sigma}^{(0)}}{\\mathbb{C}^{\\text{cons},(0)}}\n$$\n更新后的应变为：\n$$\n\\bar{\\epsilon}^{(1)} = \\bar{\\epsilon}^{(0)} + \\Delta \\bar{\\epsilon}^{(0)}\n$$\n\n**5. 算法总结**\n\n对于每个具有参数 $(E, \\alpha, A, L, T, u_2^{(0)})$ 的测试用例：\n1. 计算迭代 $k=0$ 时的初始宏观应变：$\\bar{\\epsilon}^{(0)} = u_2^{(0)}/L$ (因为 $u_1^{(0)}=0$)。\n2. 在此应变下评估均匀化应力：$\\bar{\\sigma}^{(0)} = E \\bar{\\epsilon}^{(0)} + \\alpha (\\bar{\\epsilon}^{(0)})^3$。\n3. 在此应变下评估均匀化一致切线模量：$\\mathbb{C}^{\\text{cons},(0)} = E + 3 \\alpha (\\bar{\\epsilon}^{(0)})^2$。\n4. 计算与施加的牵引力等效的宏观应力：$\\bar{T} = T/A$。\n5. 计算应变增量：$\\Delta\\bar{\\epsilon}^{(0)} = (\\bar{T} - \\bar{\\sigma}^{(0)}) / \\mathbb{C}^{\\text{cons},(0)}$。\n6. 计算一次 Newton 步后更新的应变：$\\bar{\\epsilon}^{(1)} = \\bar{\\epsilon}^{(0)} + \\Delta\\bar{\\epsilon}^{(0)}$。\n这个值 $\\bar{\\epsilon}^{(1)}$ 是该测试用例的最终结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a single Newton-Raphson iteration for a two-scale\n    computational homogenization problem on a 1D bar.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each tuple contains: (E, alpha, A, L, T, u2_0)\n    # E: Young's modulus (Pa)\n    # alpha: Nonlinear material parameter (Pa)\n    # A: Cross-sectional area (m^2)\n    # L: Length of the bar (m)\n    # T: Applied traction force (N)\n    # u2_0: Initial displacement at the right node (m)\n    test_cases = [\n        (70e9, 5e11, 5e-4, 2.0, 5e5, 0.0),\n        (210e9, 0.0, 1e-4, 1.0, 0.0, 1e-4),\n        (1e8, 1e10, 1e-3, 0.5, 2e4, -1e-3),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        E, alpha, A, L, T, u2_0 = case\n        \n        # Step 1: Calculate the initial macroscopic strain at iterate k=0.\n        # The boundary condition is u(0)=0, so u1=0.\n        # eps_bar = (u2 - u1) / L\n        eps0 = u2_0 / L\n        \n        # Step 2: Evaluate the homogenized stress at the initial strain.\n        # sigma_bar(eps) = dW/deps = E*eps + alpha*eps^3\n        sigma0 = E * eps0 + alpha * eps0**3\n        \n        # Step 3: Evaluate the homogenized consistent tangent modulus.\n        # C_cons(eps) = d(sigma_bar)/deps = E + 3*alpha*eps^2\n        C_cons0 = E + 3 * alpha * eps0**2\n        \n        # Step 4: Calculate the macroscopic stress equivalent of the applied traction.\n        T_bar = T / A\n        \n        # Step 5: Calculate the strain increment from the Newton-Raphson update.\n        # The residual in terms of stress is f(eps) = sigma_bar(eps) - T_bar.\n        # The update is delta_eps = -f(eps0) / f'(eps0).\n        # f'(eps) = C_cons(eps).\n        # delta_eps = - (sigma0 - T_bar) / C_cons0\n        delta_eps = (T_bar - sigma0) / C_cons0\n\n        # Step 6: Compute the updated strain after one Newton step.\n        eps1 = eps0 + delta_eps\n        \n        results.append(eps1)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3608362"}]}