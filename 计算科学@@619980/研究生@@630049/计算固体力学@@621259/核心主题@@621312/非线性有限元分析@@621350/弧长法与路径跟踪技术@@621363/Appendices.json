{"hands_on_practices": [{"introduction": "弧长法和路径跟踪技术的核心在于将非线性平衡方程与一个额外的约束方程联立求解。本练习将指导您从牛顿法的第一性原理出发，推导出位移控制约束下的增广线性系统，这是理解校正器步骤中著名的“加边矩阵”法的关键第一步。通过这个实践，您将掌握路径跟踪算法中最基本的方程形式。[@problem_id:3544462]", "problem": "考虑一个计算固体力学中的非线性有限元平衡问题，其中外载荷由一个标量载荷因子引入。设平衡残差定义为 $R(u, \\lambda) = r_{int}(u) - \\lambda f_{ext}$，其中 $u$ 是节点位移矢量，$\\lambda$ 是标量载荷因子，$r_{int}(u)$ 是内力矢量，$f_{ext}$ 是外参考载荷矢量。以位移控制的形式施加一个路径跟踪约束，$g(u) = c^T u - s$，其中 $c$ 是一个常数方向矢量，$s$ 是预设的控制值。\n\n从应用于耦合系统 $R(u, \\lambda) = 0$ 和 $g(u) = 0$ 的牛顿-拉夫逊(NR)方法出发，通过将 $R(u+\\delta u, \\lambda+\\delta \\lambda)$ 和 $g(u+\\delta u)$ 展开到一阶，推导 $(\\delta u, \\delta \\lambda)$ 的线性化修正方程。识别切线刚度矩阵 $K_T = \\partial r_{int}/\\partial u$ 以及雅可比贡献 $\\partial R/\\partial \\lambda$ 和 $\\partial g/\\partial u$，并展示如何将得到的修正量写成关于 $(\\delta u, \\delta \\lambda)$ 的增广线性系统。\n\n然后，对于一个特定的NR迭代步，使用在当前迭代点 $(u_{k},\\lambda_{k})$ 处测量的以下无量纲数据：\n- $K_T=\\begin{bmatrix}10  -2 \\\\ -2  6\\end{bmatrix}$，\n- $f_{ext}=\\begin{bmatrix}4 \\\\ 3\\end{bmatrix}$，\n- $c=\\begin{bmatrix}1 \\\\ -1\\end{bmatrix}$，\n- $u_{k}=\\begin{bmatrix}0.1 \\\\ -0.2\\end{bmatrix}$，$s=0.25$，\n- $R=\\begin{bmatrix}1 \\\\ -2\\end{bmatrix}$。\n\n通过求解您推导出的增广系统，计算此NR迭代步的载荷因子修正量 $\\delta \\lambda$。将您的最终 $\\delta \\lambda$ 报告为单个无量纲数。将您的答案四舍五入到四位有效数字。", "solution": "该问题是有效的，因为它科学地基于计算固体力学的原理，特别是非线性有限元分析，并且问题提法良好，具有足够的信息以获得唯一解。\n\n该问题要求推导和求解使用位移控制的路径跟踪算法的线性化方程。控制非线性方程组由平衡残差 $R(u, \\lambda)$ 和路径跟踪约束 $g(u)$ 组成。\n\n耦合系统由以下公式给出：\n$$\nR(u, \\lambda) = r_{int}(u) - \\lambda f_{ext} = 0\n$$\n$$\ng(u) = c^{T}u - s = 0\n$$\n\n我们应用牛顿-拉夫逊方法来求解这个系统。设当前状态为 $(u_k, \\lambda_k)$。我们寻求修正量 $(\\delta u, \\delta \\lambda)$，使得下一个迭代点 $(u_{k+1}, \\lambda_{k+1}) = (u_k + \\delta u, \\lambda_k + \\delta \\lambda)$ 满足系统的线性化版本。我们在 $(u_k, \\lambda_k)$ 周围对 $R$ 和 $g$ 进行一阶泰勒展开：\n\n$$\nR(u_k + \\delta u, \\lambda_k + \\delta \\lambda) \\approx R(u_k, \\lambda_k) + \\frac{\\partial R}{\\partial u}\\bigg|_{(u_k, \\lambda_k)} \\delta u + \\frac{\\partial R}{\\partial \\lambda}\\bigg|_{(u_k, \\lambda_k)} \\delta \\lambda = 0\n$$\n$$\ng(u_k + \\delta u) \\approx g(u_k) + \\frac{\\partial g}{\\partial u}\\bigg|_{u_k} \\delta u = 0\n$$\n\n现在我们按要求识别雅可比项。\n残差 $R$ 关于位移矢量 $u$ 的偏导数是切线刚度矩阵 $K_T$：\n$$\n\\frac{\\partial R}{\\partial u} = \\frac{\\partial}{\\partial u} (r_{int}(u) - \\lambda f_{ext}) = \\frac{\\partial r_{int}(u)}{\\partial u} = K_T\n$$\n残差 $R$ 关于载荷因子 $\\lambda$ 的偏导数是：\n$$\n\\frac{\\partial R}{\\partial \\lambda} = \\frac{\\partial}{\\partial \\lambda} (r_{int}(u) - \\lambda f_{ext}) = -f_{ext}\n$$\n约束 $g$ 关于位移矢量 $u$ 的偏导数是：\n$$\n\\frac{\\partial g}{\\partial u} = \\frac{\\partial}{\\partial u} (c^{T}u - s) = c^T\n$$\n$g$ 关于 $\\lambda$ 的偏导数为 $0$，因为 $g$ 不依赖于 $\\lambda$。\n\n令 $R_k = R(u_k, \\lambda_k)$ 和 $g_k = g(u_k)$ 为当前迭代步的残差。将这些导数代入线性化方程得到：\n$$\nK_T \\delta u - f_{ext} \\delta \\lambda = -R_k\n$$\n$$\nc^T \\delta u = -g_k\n$$\n\n这些方程可以写成关于未知修正量 $(\\delta u, \\delta \\lambda)$ 的增广线性系统形式：\n$$\n\\begin{bmatrix}\nK_T  -f_{ext} \\\\\nc^T  0\n\\end{bmatrix}\n\\begin{bmatrix}\n\\delta u \\\\\n\\delta \\lambda\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n-R_k \\\\\n-g_k\n\\end{bmatrix}\n$$\n这完成了问题的推导和识别部分。\n\n接下来，我们使用提供的无量纲数据计算载荷因子修正量 $\\delta \\lambda$：\n- 切线刚度矩阵: $K_{T}=\\begin{bmatrix}10  -2 \\\\ -2  6\\end{bmatrix}$\n- 外参考载荷矢量: $f_{ext}=\\begin{bmatrix}4 \\\\ 3\\end{bmatrix}$\n- 约束方向矢量: $c=\\begin{bmatrix}1 \\\\ -1\\end{bmatrix}$，所以 $c^T = \\begin{bmatrix}1  -1\\end{bmatrix}$\n- 当前位移矢量: $u_{k}=\\begin{bmatrix}0.1 \\\\ -0.2\\end{bmatrix}$\n- 预设控制值: $s=0.25$\n- 当前迭代点的平衡残差: $R_k=R(u_k, \\lambda_k)=\\begin{bmatrix}1 \\\\ -2\\end{bmatrix}$\n\n首先，我们必须计算当前迭代点的约束残差 $g_k$：\n$$\ng_k = c^T u_k - s = \\begin{bmatrix}1  -1\\end{bmatrix} \\begin{bmatrix}0.1 \\\\ -0.2\\end{bmatrix} - 0.25\n$$\n$$\ng_k = (1)(0.1) + (-1)(-0.2) - 0.25 = 0.1 + 0.2 - 0.25 = 0.3 - 0.25 = 0.05\n$$\n\n增广系统的右侧是：\n$$\n\\begin{bmatrix} -R_k \\\\ -g_k \\end{bmatrix} = \\begin{bmatrix} -\\begin{bmatrix}1 \\\\ -2\\end{bmatrix} \\\\ -0.05 \\end{bmatrix} = \\begin{bmatrix} -1 \\\\ 2 \\\\ -0.05 \\end{bmatrix}\n$$\n\n令 $\\delta u = \\begin{bmatrix} \\delta u_1 \\\\ \\delta u_2 \\end{bmatrix}$，完整的数值系统是：\n$$\n\\begin{bmatrix}\n10  -2  -4 \\\\\n-2  6  -3 \\\\\n1  -1  0\n\\end{bmatrix}\n\\begin{bmatrix}\n\\delta u_1 \\\\\n\\delta u_2 \\\\\n\\delta \\lambda\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n-1 \\\\\n2 \\\\\n-0.05\n\\end{bmatrix}\n$$\n\n我们可以求解这个 $3 \\times 3$ 系统以得到 $\\delta u_1$、$\\delta u_2$ 和 $\\delta \\lambda$。从第三个方程可知：\n$$(1)\\delta u_1 + (-1)\\delta u_2 + (0)\\delta \\lambda = -0.05 \\implies \\delta u_1 = \\delta u_2 - 0.05$$\n\n将 $\\delta u_1$ 的这个表达式代入前两个方程。\n从第一个方程：\n$$10(\\delta u_2 - 0.05) - 2\\delta u_2 - 4\\delta \\lambda = -1$$\n$$10\\delta u_2 - 0.5 - 2\\delta u_2 - 4\\delta \\lambda = -1$$\n$$8\\delta u_2 - 4\\delta \\lambda = -0.5 \\quad (1)$$\n\n从第二个方程：\n$$-2(\\delta u_2 - 0.05) + 6\\delta u_2 - 3\\delta \\lambda = 2$$\n$$-2\\delta u_2 + 0.1 + 6\\delta u_2 - 3\\delta \\lambda = 2$$\n$$4\\delta u_2 - 3\\delta \\lambda = 1.9 \\quad (2)$$\n\n我们现在得到了一个关于 $\\delta u_2$ 和 $\\delta \\lambda$ 的 $2 \\times 2$ 系统。将方程 (2) 乘以 $2$：\n$$8\\delta u_2 - 6\\delta \\lambda = 3.8 \\quad (2')$$\n\n从方程 (2') 中减去方程 (1)：\n$$(8\\delta u_2 - 6\\delta \\lambda) - (8\\delta u_2 - 4\\delta \\lambda) = 3.8 - (-0.5)$$\n$$-2\\delta \\lambda = 4.3$$\n$$\\delta \\lambda = -\\frac{4.3}{2} = -2.15$$\n\n问题要求答案四舍五入到四位有效数字。\n$$\\delta \\lambda = -2.150$$", "answer": "$$\\boxed{-2.150}$$", "id": "3544462"}, {"introduction": "在掌握了增广系统的基本形式后，一个实际问题是如何在有限元程序中高效且稳定地求解它。本练习将引导您设计一种数值稳定的求解算法，该算法通过分区求解策略避免了对大型切线刚度矩阵 $K_T$ 进行显式求逆，并引入正则化方法来处理路径上的临界点。这是将理论算法转化为可靠代码的关键一步。[@problem_id:3544471]", "problem": "您正在为计算固体力学中的非线性平衡问题实现一个带有弧长路径跟踪约束的 Newton 型预测-校正步。其基本依据包括以下事实。\n\n- 对于一个非线性有限元模型，在一次 Newton 迭代中的线性化平衡方程，可由虚功原理和 Newton 线性化导出，表示为位移增量和荷载因子增量之间的线性系统。这会得到如下形式的系统：$K_T \\,\\delta u - f\\,\\delta \\lambda = -r,$\n- 路径跟踪约束被线性化为：$a^\\mathsf{T} \\delta u + h\\,\\delta \\lambda = b,$\n  其中 $a$ 是所选约束对位移变量的导数，$h$ 是对荷载因子的导数，$b$ 是当前迭代的线性化约束右端项。\n\n您的任务是设计一个数值稳定的算法来计算 $(\\delta u,\\delta \\lambda)$，且不显式构造 $K_T^{-1}$。每次 Newton 迭代中，您必须不多不少地使用两次关于 $K_T$ 的线性求解，并通过与 $a$ 的内积来组合结果。具体来说，从上述基本依据出发，您必须推导出 $\\delta \\lambda$ 的一个数值稳定的表达式，该表达式避免了显式矩阵求逆，然后求出 $\\delta u$。该算法必须能够处理 $\\delta \\lambda$ 标量公式中分母变得很小的情况，方法是使用一种稳定的除法策略，该策略能保持与平衡方程的一致性并避免灾难性抵消。\n\n实现要求。\n\n- 令 $w$ 和 $z$ 为以下两个线性系统的唯一解：\n  $$K_T w = f,\\qquad K_T z = r.$$\n  在每次 Newton 迭代中，您只允许进行这两次关于 $K_T$ 的线性求解。\n- 组合 $w$ 和 $z$ 以构成：\n  $$p = a^\\mathsf{T} w + h, \\qquad q = b + a^\\mathsf{T} z.$$\n- 在一般的、良态的情况下，计算\n  $$\\delta \\lambda = \\frac{q}{p}.$$\n  当 $|p|$ 很小时，使用 Tikhonov 稳定化的标量求解来对除法进行正则化，例如通过最小化 \n  $$(p\\,\\delta \\lambda - q)^2 + \\sigma^2 \\delta \\lambda^2,$$\n  其中 $\\sigma > 0$ 是一个根据问题数据进行缩放的很小的稳定化参数，并取其最小值点\n  $$\\delta \\lambda = \\frac{p\\,q}{p^2 + \\sigma^2}.$$\n  然后计算\n  $$\\delta u = w\\,\\delta \\lambda - z.$$\n- 您的程序必须实现上述逻辑，并根据机器精度以及 $a$、$w$ 和 $h$ 的量级自动选择 $\\sigma$。您可以使用任何合理的、连续依赖于数据并在条件数改善时趋于零的缩放方法。您绝不能显式构造 $K_T^{-1}$。\n\n测试套件和要求输出。\n\n- 使用以下四个测试用例。对于每个用例，$K_T \\in \\mathbb{R}^{2 \\times 2}$，其余向量在 $\\mathbb{R}^2$ 中；所有标量均为实数。\n  1) 顺利路径（对称正定）：\n     - $K_T = \\begin{bmatrix} 10  2 \\\\ 2  5 \\end{bmatrix}$,\n       $f = \\begin{bmatrix} 1 \\\\ 0.5 \\end{bmatrix}$,\n       $r = \\begin{bmatrix} -0.2 \\\\ 0.1 \\end{bmatrix}$,\n       $a = \\begin{bmatrix} 0.6 \\\\ -0.8 \\end{bmatrix}$,\n       $h = 0.3$, $b = 0.05$.\n  2) 病态但可解：\n     - $K_T = \\begin{bmatrix} 10^{-3}  0 \\\\ 0  2 \\end{bmatrix}$,\n       $f = \\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix}$,\n       $r = \\begin{bmatrix} 10^{-3} \\\\ -0.2 \\end{bmatrix}$,\n       $a = \\begin{bmatrix} 1 \\\\ 0 \\end{bmatrix}$,\n       $h = 0$, $b = 0.01$.\n  3) 退化的线性化约束（分母为零且右端项相容）：\n     - $K_T = \\begin{bmatrix} 1  0 \\\\ 0  1 \\end{bmatrix}$,\n       $f = \\begin{bmatrix} 1 \\\\ 0 \\end{bmatrix}$,\n       $r = \\begin{bmatrix} 0 \\\\ 0 \\end{bmatrix}$,\n       $a = \\begin{bmatrix} -1 \\\\ 0 \\end{bmatrix}$,\n       $h = 1$, $b = 0$.\n  4) 不定但可逆的 $K_T$：\n     - $K_T = \\begin{bmatrix} 0  1 \\\\ 1  0 \\end{bmatrix}$,\n       $f = \\begin{bmatrix} 0.5 \\\\ -1.0 \\end{bmatrix}$,\n       $r = \\begin{bmatrix} 0.3 \\\\ -0.4 \\end{bmatrix}$,\n       $a = \\begin{bmatrix} 0.2 \\\\ 0.9 \\end{bmatrix}$,\n       $h = -0.1$, $b = -0.02$.\n- 对每个测试用例，计算并返回两个量：\n  1) 标量 $\\delta \\lambda$。\n  2) 平衡残差的欧几里得范数，$\\|K_T \\delta u - f \\delta \\lambda + r\\|_2$。\n- 最终输出格式：您的程序应生成单行输出，其中包含所有用例的结果，形式为方括号内的逗号分隔列表，顺序如下：\n  $$[\\delta \\lambda_1, \\rho_1, \\delta \\lambda_2, \\rho_2, \\delta \\lambda_3, \\rho_3, \\delta \\lambda_4, \\rho_4],$$\n  其中 $\\rho_i$ 是第 $i$ 个用例的残差范数。所有量都是无单位的实数。\n- 在这个纯代数问题中，不涉及角度单位和物理单位。\n\n您的最终答案必须是一个完整、可运行的 Python 程序，该程序仅使用指定的库来计算所需输出。不允许用户输入，并且程序必须以指定格式精确打印一行。", "solution": "该问题要求推导并实现一个数值稳定的算法，用于在弧长约束的 Newton-Raphson 迭代中求解位移修正量 $\\delta u$ 和荷载因子修正量 $\\delta \\lambda$。控制方程是一个代表线性化平衡的线性系统和一个代表线性化路径跟踪约束的线性标量方程。\n\n该方程组由以下公式给出：\n$$\n\\begin{align*}\nK_T \\,\\delta u - f\\,\\delta \\lambda = -r \\quad (1) \\\\\na^\\mathsf{T} \\delta u + h\\,\\delta \\lambda = b \\quad (2)\n\\end{align*}\n$$\n此处，$K_T$ 是切线刚度矩阵，$f$ 是参考荷载向量，$r$ 是残差向量，$a$ 是约束相对于位移的梯度，$h$ 是约束相对于荷载因子的梯度，$b$ 是当前约束值。未知量是向量 $\\delta u$ 和标量 $\\delta \\lambda$。该算法不能显式计算 $K_T$ 的逆。\n\n首先，我们推导形式解。假设切线刚度矩阵 $K_T$ 可逆，我们可以从方程 $(1)$ 中表示出位移修正量 $\\delta u$：\n$$ \\delta u = K_T^{-1} (f\\,\\delta \\lambda - r) $$\n利用矩阵求逆算子的线性性质，我们可以将其分解为两部分：\n$$ \\delta u = (K_T^{-1} f) \\delta \\lambda - (K_T^{-1} r) $$\n问题定义了两个辅助向量 $w$ 和 $z$，作为以下线性系统的解：\n$$ K_T w = f \\implies w = K_T^{-1} f $$\n$$ K_T z = r \\implies z = K_T^{-1} r $$\n这两次线性求解是每次迭代中唯一允许的。将这些定义代入 $\\delta u$ 的表达式中可得：\n$$ \\delta u = w\\,\\delta \\lambda - z \\quad (3) $$\n一旦荷载因子修正量 $\\delta \\lambda$ 已知，此表达式即可提供位移修正量 $\\delta u$。\n\n为了求出 $\\delta \\lambda$，我们将方程 $(3)$ 代入线性化约束，即方程 $(2)$ 中：\n$$ a^\\mathsf{T} (w\\,\\delta \\lambda - z) + h\\,\\delta \\lambda = b $$\n展开各项并重新整理以求解 $\\delta \\lambda$：\n$$ (a^\\mathsf{T} w)\\,\\delta \\lambda - a^\\mathsf{T} z + h\\,\\delta \\lambda = b $$\n$$ (a^\\mathsf{T} w + h)\\,\\delta \\lambda = b + a^\\mathsf{T} z $$\n问题定义了两个标量 $p$ 和 $q$：\n$$ p = a^\\mathsf{T} w + h $$\n$$ q = b + a^\\mathsf{T} z $$\n根据这些定义，$\\delta \\lambda$ 的方程简化为一个标量方程：\n$$ p\\,\\delta \\lambda = q $$\n在 $p \\neq 0$ 的一般情况下，解是直接的：\n$$ \\delta \\lambda = \\frac{q}{p} $$\n当 $|p|$ 接近于零时，会出现数值问题。这种情况对应于荷载-位移路径上的一个临界点，此时约束曲面与平衡路径相切。直接计算 $q/p$ 会导致浮点溢出和灾难性抵消错误。\n\n为处理此问题，题目指定了一个 Tikhonov 稳定化解。我们不直接求解 $p\\,\\delta\\lambda = q$，而是找到使正则化最小二乘泛函最小化的 $\\delta\\lambda$：\n$$ J(\\delta \\lambda) = (p\\,\\delta \\lambda - q)^2 + \\sigma^2 \\delta \\lambda^2 $$\n其中 $\\sigma > 0$ 是一个小的正则化参数。通过将导数 $\\frac{dJ}{d\\delta \\lambda}$ 设为零来找到最小值：\n$$ \\frac{dJ}{d\\delta \\lambda} = 2(p\\,\\delta \\lambda - q)p + 2\\sigma^2 \\delta \\lambda = 0 $$\n$$ p^2 \\delta \\lambda - pq + \\sigma^2 \\delta \\lambda = 0 $$\n$$ (p^2 + \\sigma^2) \\delta \\lambda = pq $$\n$$ \\delta \\lambda = \\frac{p\\,q}{p^2 + \\sigma^2} $$\n当 $|p|$ 被确定为很小时，使用此稳定化公式。参数 $\\sigma$ 必须仔细选择。按照问题的要求，一个鲁棒的选择是基于数据的量级来缩放 $\\sigma$。对于 $p = a^\\mathsf{T}w+h$，一个物理上和数值上都合理的缩放由表达式 $\\|a\\|_2 \\|w\\|_2 + |h|$ 给出。我们可以使用机器精度 $\\epsilon_{\\text{mach}}$ 来定义相对于此尺度的 $\\sigma$：\n$$ \\sigma = \\sqrt{\\epsilon_{\\text{mach}}} \\left( \\|a\\|_2 \\|w\\|_2 + |h| \\right) $$\n使用 $\\sqrt{\\epsilon_{\\text{mach}}}$ 是在舍入误差变得显著时设置容差的一种标准启发式方法。如果 $|p| < \\sigma$，算法则切换到稳定化公式。这种方法确保了在所有条件下对 $\\delta \\lambda$ 的计算都是连续且稳定的。\n\n最后，我们必须计算平衡残差的欧几里得范数，即 $\\|K_T \\delta u - f \\delta \\lambda + r\\|_2$。将方程 $(3)$ 中 $\\delta u$ 的表达式代入：\n$$ \\text{Residual} = K_T (w\\,\\delta \\lambda - z) - f\\,\\delta \\lambda + r $$\n$$ = (K_T w)\\delta \\lambda - K_T z - f\\,\\delta \\lambda + r $$\n根据 $w$ 和 $z$ 的定义，我们有 $K_T w = f$ 和 $K_T z = r$。将它们代入：\n$$ \\text{Residual} = f\\,\\delta \\lambda - r - f\\,\\delta \\lambda + r = 0 $$\n在精确算术中，无论使用标准公式还是稳定化公式计算 $\\delta \\lambda$，残差都恒等于零。这是因为关系式 $\\delta u = w\\,\\delta \\lambda - z$ 的构造正是为了满足线性化平衡方程 $(1)$。在浮点算术中，计算出的残差范数将是一个很小的数，反映了线性求解器和后续操作的数值精度。它可以作为实现的一个有价值的内部一致性检查。\n\n整个算法如下：\n$1$. 给定 $K_T, f, r, a, h, b$。\n$2$. 求解 $K_T w = f$ 和 $K_T z = r$ 以得到 $w$ 和 $z$。\n$3$. 计算标量 $p = a^\\mathsf{T} w + h$ 和 $q = b + a^\\mathsf{T} z$。\n$4$. 根据问题数据和机器精度计算正则化参数 $\\sigma$。例如，$\\sigma = \\sqrt{\\epsilon_{\\text{mach}}} (\\|a\\|_2\\|w\\|_2 + |h| + \\delta_{tiny})$，其中 $\\delta_{tiny}$ 是一个小的正常数，以防止 $\\sigma=0$。\n$5$. 如果 $|p| < \\sigma$，计算 $\\delta \\lambda = \\frac{p\\,q}{p^2 + \\sigma^2}$。\n$6$. 否则，计算 $\\delta \\lambda = q / p$。\n$7$. 计算位移修正量 $\\delta u = w\\,\\delta \\lambda - z$。\n$8$. 计算平衡残差范数 $\\|K_T \\delta u - f \\delta \\lambda + r\\|_2$。\n$9$. 返回计算出的 $\\delta \\lambda$ 和残差范数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes predictor-corrector steps for nonlinear equilibrium with an\n    arc-length constraint for a series of test cases.\n    \"\"\"\n    # Define the test cases as specified in the problem statement.\n    # Each case is a tuple: (KT, f, r, a, h, b)\n    test_cases = [\n        # 1) Happy path (symmetric positive definite)\n        (\n            np.array([[10.0, 2.0], [2.0, 5.0]]),\n            np.array([1.0, 0.5]),\n            np.array([-0.2, 0.1]),\n            np.array([0.6, -0.8]),\n            0.3,\n            0.05\n        ),\n        # 2) Ill-conditioned but solvable\n        (\n            np.array([[1e-3, 0.0], [0.0, 2.0]]),\n            np.array([1.0, 1.0]),\n            np.array([1e-3, -0.2]),\n            np.array([1.0, 0.0]),\n            0.0,\n            0.01\n        ),\n        # 3) Degenerate linearized constraint (p=0, q=0)\n        (\n            np.array([[1.0, 0.0], [0.0, 1.0]]),\n            np.array([1.0, 0.0]),\n            np.array([0.0, 0.0]),\n            np.array([-1.0, 0.0]),\n            1.0,\n            0.0\n        ),\n        # 4) Indefinite but invertible KT\n        (\n            np.array([[0.0, 1.0], [1.0, 0.0]]),\n            np.array([0.5, -1.0]),\n            np.array([0.3, -0.4]),\n            np.array([0.2, 0.9]),\n            -0.1,\n            -0.02\n        ),\n    ]\n\n    results = []\n\n    # Get machine epsilon for floating point comparisons\n    eps = np.finfo(float).eps\n\n    for KT, f, r, a, h, b in test_cases:\n        # Step 1: Perform the two linear solves with KT\n        # This is the only place we interact with KT directly for solving\n        try:\n            w = np.linalg.solve(KT, f)\n            z = np.linalg.solve(KT, r)\n        except np.linalg.LinAlgError:\n            # This should not happen for the given test cases as all KT are invertible\n            results.extend([np.nan, np.nan])\n            continue\n        \n        # Step 2: Combine w and z to form scalars p and q\n        p = a.T @ w + h\n        q = b + a.T @ z\n\n        # Step 3: Compute delta_lambda with stabilization\n        #\n        # The algorithm requires an automatic choice of the stabilization parameter sigma,\n        # scaled to the problem data. A robust choice is to scale it relative to the\n        # size of p, which is |a^T w + h|.\n        # We use a scale based on the norm of the constituent parts.\n        \n        # Define a characteristic scale for p\n        p_scale = np.linalg.norm(a) * np.linalg.norm(w) + np.abs(h)\n        \n        # Add a tiny value to prevent scale from being zero if inputs are all zero\n        p_scale += np.finfo(float).tiny\n\n        # Set the regularization parameter and tolerance. Using sqrt(eps) is a common\n        # heuristic for balancing truncation and round-off errors.\n        sigma = np.sqrt(eps) * p_scale\n\n        if np.abs(p)  sigma:\n            # Use the Tikhonov-stabilized formula for small |p|\n            delta_lambda = (p * q) / (p**2 + sigma**2)\n        else:\n            # Use the standard formula for the well-conditioned case\n            delta_lambda = q / p\n\n        # Step 4: Compute the displacement correction delta_u\n        delta_u = w * delta_lambda - z\n\n        # Step 5: Compute the Euclidean norm of the equilibrium residual\n        # As derived, this residual should be close to zero, serving as a\n        # numerical consistency check.\n        residual_vector = KT @ delta_u - f * delta_lambda + r\n        residual_norm = np.linalg.norm(residual_vector)\n        \n        results.append(delta_lambda)\n        results.append(residual_norm)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3544471"}, {"introduction": "建立了必要的数值方法后，我们现在可以探索为何弧长法如此强大。本练习提供了一个展示对称性破缺分岔的结构实例，这种复杂的失稳现象是传统加载方法无法追踪的。通过分析切线刚度矩阵的奇异性和特征值，您将把抽象的数值条件与结构屈曲的物理行为直接联系起来，深刻理解路径跟踪技术在捕捉和分析结构失稳中的核心作用。[@problem_id:2541400]", "problem": "寻求一个在路径跟踪加载下表现出对称性破缺分岔的最小二自由度非线性有限元模型。在有限元法（FEM）的标准平衡-残差框架内进行分析，其中平衡被设定为 $R(u,\\lambda)=0$，这里 $u \\in \\mathbb{R}^{2}$ 是节点自由度向量，$\\lambda \\in \\mathbb{R}$ 是标量荷载参数。考虑一个承受构型相关随动荷载的对称二自由度系统，其残差如下：\n$$\nR(u,\\lambda) \\;=\\;\n\\begin{pmatrix}\nk\\,u_{1} + \\alpha\\,u_{1}^{3} \\\\\nk\\,u_{2} + \\alpha\\,u_{2}^{3}\n\\end{pmatrix}\n\\;-\\;\n\\lambda\\left[\n\\begin{pmatrix}\np\\\\\np\n\\end{pmatrix}\n\\;+\\;\n\\gamma\\,\n\\begin{pmatrix}\nu_{1}-u_{2}\\\\\nu_{2}-u_{1}\n\\end{pmatrix}\n\\right],\n$$\n其中 $k0$ 和 $\\alpha0$ 是材料刚度参数，$p0$ 是参考荷载幅值，$\\gamma0$ 控制依赖于相对位移 $u_{1}-u_{2}$ 的随动荷载贡献的大小。假设所有量均为无量纲。\n\n从残差平衡 $R(u,\\lambda)=0$ 的基本定义及其在Riks和Crisfield意义下的弧长路径跟踪方法中使用的切线线性化出发，完成以下任务：\n\n1) 证明对称子空间 $u_{1}=u_{2}=u$ 定义了一条平衡路径，并推导该路径上 $u$ 和 $\\lambda$ 之间的标量关系。\n\n2) 推导一致切线刚度矩阵 $K_{T}(u,\\lambda)=\\partial R/\\partial u$ 并在对称路径上对其进行评估。确定 $K_{T}$ 在对称路径上的对称和反对称特征模态，并用 $u$、$\\lambda$ 和参数表示它们对应的特征值。\n\n3) 叙述用于弧长路径跟踪的简单对称性破缺分岔（叉式）点的线性化条件：特别地，阐明 $K_{T}$ 的奇异性条件、相关的左右零向量，以及在分岔点的增广Riks/Crisfield线性化中区分分岔点和极限点的条件。\n\n4) 对于具体参数值 $k=1$, $\\alpha=1$, $p=1$, and $\\gamma=1$，计算对称分支因反对称模态失稳时的临界荷载因子 $\\lambda_{\\star}$。将你的最终答案 $\\lambda_{\\star}$ 表示为一个精确数（无量纲）。不包含单位。无需四舍五入。", "solution": "对提出的问题进行验证。\n\n步骤 1：提取已知条件。\n问题陈述提供了以下信息：\n- 平衡条件为 $R(u,\\lambda)=0$，其中位移向量 $u \\in \\mathbb{R}^{2}$，荷载参数 $\\lambda \\in \\mathbb{R}$。\n- 残差向量定义为：\n$$\nR(u,\\lambda) \\;=\\;\n\\begin{pmatrix}\nk\\,u_{1} + \\alpha\\,u_{1}^{3} \\\\\nk\\,u_{2} + \\alpha\\,u_{2}^{3}\n\\end{pmatrix}\n\\;-\\;\n\\lambda\\left[\n\\begin{pmatrix}\np\\\\\np\n\\end{pmatrix}\n\\;+\\;\n\\gamma\\,\n\\begin{pmatrix}\nu_{1}-u_{2}\\\\\nu_{2}-u_{1}\n\\end{pmatrix}\n\\right]\n$$\n- 参数约束为 $k0$, $\\alpha0$, $p0$, 和 $\\gamma0$。\n- 所有量均为无量纲。\n- 具体任务是：1) 分析对称平衡路径 $u_{1}=u_{2}=u$。2) 推导切线刚度矩阵 $K_{T}$ 及其在对称路径上的特征属性。3) 叙述对称性破缺分岔点的线性化条件。4) 对于具体情况 $k=1$, $\\alpha=1$, $p=1$, 和 $\\gamma=1$ 计算临界荷载因子 $\\lambda_{\\star}$。\n\n步骤 2：使用提取的已知条件进行验证。\n根据所需标准对问题进行评估。\n- **科学依据**：该问题是非线性结构力学和有限元理论中一个成熟的练习。它涉及一个由非保守随动荷载修正的离散保守系统的稳定性分析，这是分岔理论中的一个标准课题。其公式基于力学和微积分的基本原理。\n- **适定性**：该问题完全自洽，提供了所有必要的定义和方程。任务具体，并能导出一个唯一、可推导的解。\n- **客观性**：问题使用精确的数学语言陈述，没有任何主观或模糊的术语。\n\n该问题未违反任何无效性标准。它在科学上是合理的，可形式化的，完整的，并且是适定的。\n\n步骤 3：结论与行动。\n该问题被判定为 **有效**。将提供完整解答。\n\n解答过程按顺序解决四个指定的任务。\n\n1) 首先，我们研究由约束 $u_{1}=u_{2}=u$ 定义的对称子空间。为证明该子空间定义了一条平衡路径，我们将此约束代入残差向量表达式 $R(u,\\lambda)$。\n$$\nR \\;=\\;\n\\begin{pmatrix}\nk\\,u + \\alpha\\,u^{3} \\\\\nk\\,u + \\alpha\\,u^{3}\n\\end{pmatrix}\n\\;-\\;\n\\lambda\\left[\n\\begin{pmatrix}\np\\\\\np\n\\end{pmatrix}\n\\;+\\;\n\\gamma\\,\n\\begin{pmatrix}\nu-u\\\\\nu-u\n\\end{pmatrix}\n\\right]\n\\;=\\;\n\\begin{pmatrix}\nk\\,u + \\alpha\\,u^{3} - \\lambda p \\\\\nk\\,u + \\alpha\\,u^{3} - \\lambda p\n\\end{pmatrix}\n$$\n平衡条件 $R=0$ 要求该向量的两个分量都为零。由于两个分量相同，该条件简化为单个标量方程：\n$$\nk\\,u + \\alpha\\,u^{3} - \\lambda p = 0\n$$\n该方程给出了对称位移 $u$ 和荷载参数 $\\lambda$ 之间的一个隐式关系。我们可以沿此基本路径将 $\\lambda$ 表示为 $u$ 的函数：\n$$\n\\lambda(u) = \\frac{k\\,u + \\alpha\\,u^{3}}{p}\n$$\n这证实了对称子空间构成了系统的一条有效平衡路径。\n\n2) 接下来，我们推导一致切线刚度矩阵 $K_{T}(u,\\lambda)$，它定义为残差向量关于位移向量的雅可比矩阵，$K_{T} = \\frac{\\partial R}{\\partial u}$。残差的分量为：\n$R_{1}(u_{1}, u_{2}, \\lambda) = k\\,u_{1} + \\alpha\\,u_{1}^{3} - \\lambda p - \\lambda\\gamma(u_{1}-u_{2})$\n$R_{2}(u_{1}, u_{2}, \\lambda) = k\\,u_{2} + \\alpha\\,u_{2}^{3} - \\lambda p - \\lambda\\gamma(u_{2}-u_{1})$\n偏导数是：\n$\\frac{\\partial R_{1}}{\\partial u_{1}} = k + 3\\alpha u_{1}^{2} - \\lambda\\gamma$\n$\\frac{\\partial R_{1}}{\\partial u_{2}} = \\lambda\\gamma$\n$\\frac{\\partial R_{2}}{\\partial u_{1}} = \\lambda\\gamma$\n$\\frac{\\partial R_{2}}{\\partial u_{2}} = k + 3\\alpha u_{2}^{2} - \\lambda\\gamma$\n将这些分量组合起来，得到切线刚度矩阵：\n$$\nK_T(u, \\lambda) = \\begin{pmatrix}\nk + 3\\alpha u_{1}^{2} - \\lambda\\gamma   \\lambda\\gamma \\\\\n\\lambda\\gamma   k + 3\\alpha u_{2}^{2} - \\lambda\\gamma\n\\end{pmatrix}\n$$\n现在我们在对称路径上 $u_{1}=u_{2}=u$ 处评估该矩阵：\n$$\nK_T|_{\\text{symm}} = \\begin{pmatrix}\nk + 3\\alpha u^{2} - \\lambda\\gamma   \\lambda\\gamma \\\\\n\\lambda\\gamma   k + 3\\alpha u^{2} - \\lambda\\gamma\n\\end{pmatrix}\n$$\n为了找到特征值和特征模态，我们求解特征方程 $\\det(K_T - \\omega I) = 0$。令 $A = k + 3\\alpha u^{2} - \\lambda\\gamma$ 和 $B = \\lambda\\gamma$。方程变为 $(A-\\omega)^{2} - B^{2} = 0$，由此得到特征值 $\\omega = A \\pm B$。\n第一个特征值对应于对称模态：\n$\\omega_{S} = A + B = (k + 3\\alpha u^{2} - \\lambda\\gamma) + \\lambda\\gamma = k + 3\\alpha u^{2}$。\n对应的特征向量 $\\phi_{S}$ 满足 $(K_T - \\omega_{S} I) \\phi_{S} = 0$。这导致 $\\phi_{S1} - \\phi_{S2} = 0$，因此对称特征模态为 $\\phi_{S} \\propto \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。\n第二个特征值对应于反对称模态：\n$\\omega_{A} = A - B = (k + 3\\alpha u^{2} - \\lambda\\gamma) - \\lambda\\gamma = k + 3\\alpha u^{2} - 2\\lambda\\gamma$。\n对应的特征向量 $\\phi_{A}$ 满足 $(K_T - \\omega_{A} I) \\phi_{A} = 0$。这导致 $\\phi_{A1} + \\phi_{A2} = 0$，因此反对称特征模态为 $\\phi_{A} \\propto \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。\n\n3) 平衡路径上的一个临界点发生在切线刚度矩阵 $K_T$ 变为奇异时，即 $\\det(K_T)=0$。这等价于其某个特征值为零。在这样的点 $(u_{\\star}, \\lambda_{\\star})$，存在一个非零的右零向量（临界模态）$\\phi$，使得 $K_T(u_{\\star}, \\lambda_{\\star})\\phi=0$。由于 $K_T$ 是对称的，左零向量为 $\\phi^T$。\n在弧长法的背景下，极限点和分岔点之间的区别由条件 $\\phi^T (\\partial R / \\partial \\lambda) = 0$ 确定。\n荷载导数向量为 $\\frac{\\partial R}{\\partial \\lambda} = - \\begin{pmatrix} p + \\gamma(u_{1}-u_{2}) \\\\ p + \\gamma(u_{2}-u_{1}) \\end{pmatrix}$。\n在对称路径（$u_{1}=u_{2}=u$）上，这简化为 $\\frac{\\partial R}{\\partial \\lambda} = -\\begin{pmatrix} p \\\\ p \\end{pmatrix}$。\n如果对称模态是临界的（$\\omega_S=0$, $\\phi = \\phi_S$），则条件为：\n$\\phi_S^T \\frac{\\partial R}{\\partial \\lambda} = \\begin{pmatrix} 1   1 \\end{pmatrix} \\left(-\\begin{pmatrix} p \\\\ p \\end{pmatrix}\\right) = -2p$。由于 $p0$，此值非零。对称模态的奇异性对应于一个**极限点**。\n如果反对称模态是临界的（$\\omega_A=0$, $\\phi = \\phi_A$），则条件为：\n$\\phi_A^T \\frac{\\partial R}{\\partial \\lambda} = \\begin{pmatrix} 1   -1 \\end{pmatrix} \\left(-\\begin{pmatrix} p \\\\ p \\end{pmatrix}\\right) = -p - (-p) = 0$。\n这个零结果是**分岔点**的条件。因此，当主路径因反对称模态失稳时，会发生对称性破缺分岔（叉式类型），这在 $\\omega_A=0$ 时发生。\n\n4) 最后，我们针对参数值 $k=1$, $\\alpha=1$, $p=1$, 和 $\\gamma=1$ 计算临界荷载因子 $\\lambda_{\\star}$。对称性破缺分岔发生在点 $(u_{\\star}, \\lambda_{\\star})$，该点同时满足对称平衡路径方程和反对称模态的奇异性条件。\n两个控制方程是：\n1. 平衡方程：$k u_{\\star} + \\alpha u_{\\star}^{3} - \\lambda_{\\star} p = 0$\n2. 奇异性条件：$\\omega_{A} = k + 3\\alpha u_{\\star}^{2} - 2\\lambda_{\\star}\\gamma = 0$\n代入给定的参数值：\n1. $u_{\\star} + u_{\\star}^{3} - \\lambda_{\\star} = 0 \\implies \\lambda_{\\star} = u_{\\star} + u_{\\star}^{3}$\n2. $1 + 3u_{\\star}^{2} - 2\\lambda_{\\star} = 0$\n将第一个方程代入第二个方程：\n$1 + 3u_{\\star}^{2} - 2(u_{\\star} + u_{\\star}^{3}) = 0$\n$1 + 3u_{\\star}^{2} - 2u_{\\star} - 2u_{\\star}^{3} = 0$\n重新整理得到一个关于 $u_{\\star}$ 的三次多项式：\n$2u_{\\star}^{3} - 3u_{\\star}^{2} + 2u_{\\star} - 1 = 0$\n通过观察，我们测试简单的有理根。对于 $u_{\\star}=1$：\n$2(1)^{3} - 3(1)^{2} + 2(1) - 1 = 2 - 3 + 2 - 1 = 0$。\n因此，$u_{\\star}=1$ 是一个实根。对多项式进行因式分解得到 $(u_{\\star}-1)(2u_{\\star}^{2} - u_{\\star} + 1) = 0$。二次因式 $2u_{\\star}^{2} - u_{\\star} + 1$ 的判别式为 $\\Delta = (-1)^{2} - 4(2)(1) = -7  0$，因此它没有其他实根。唯一具有物理意义的临界位移是 $u_{\\star}=1$。\n将该值代回 $\\lambda_{\\star}$ 的表达式中：\n$\\lambda_{\\star} = u_{\\star} + u_{\\star}^{3} = 1 + (1)^{3} = 2$。\n对称分支因反对称模态失稳时的临界荷载因子是 $\\lambda_{\\star}=2$。", "answer": "$$\\boxed{2}$$", "id": "2541400"}]}