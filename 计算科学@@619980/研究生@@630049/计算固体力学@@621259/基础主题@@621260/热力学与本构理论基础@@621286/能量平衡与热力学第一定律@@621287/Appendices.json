{"hands_on_practices": [{"introduction": "热力学第一定律为任何模拟的物理一致性提供了基本检验。本练习将指导您将连续介质的能量平衡方程转化为适用于热弹性杆有限元模型的离散形式。通过实现这种能量平衡检验，您将学会追踪所有的能量分量和外部输入，这是验证和后处理计算力学结果的一项关键技能 ([@problem_id:3546168])。", "problem": "考虑一根一维线性弹性导热杆，在区间 $\\Omega=[0,L]$（其中 $L=2\\,\\mathrm{m}$）上通过两个线性有限元（三个节点）进行离散。该杆具有均匀的横截面积 $A=0.01\\,\\mathrm{m}^2$，质量密度 $\\rho=7800\\,\\mathrm{kg/m^3}$，杨氏模量 $E=210\\times 10^9\\,\\mathrm{Pa}$，以及比热容 $c=500\\,\\mathrm{J/(kg\\cdot K)}$。时间区间为从 $t_0$ 到 $t_1$，其中 $\\Delta t=t_1-t_0=10\\,\\mathrm{s}$。假设应变和位移均为小量。假设没有热弹性耦合（即没有热膨胀和耗散机制），并且所有场都足够光滑以进行以下标准构造。\n\n将使用的基本基准：\n- 在没有惯性源的情况下，局部动量平衡为：$\\rho\\,\\dot{\\mathbf{v}}=\\nabla\\cdot\\boldsymbol{\\sigma}+\\rho\\,\\mathbf{b}$，其中 $\\mathbf{v}$ 是速度，$\\boldsymbol{\\sigma}$ 是柯西应力，$\\mathbf{b}$ 是单位质量的体力。\n- 热力学第一定律（能量平衡）的局部形式为：$\\rho\\,\\dot{e}=\\boldsymbol{\\sigma}:\\nabla \\mathbf{v}-\\nabla\\cdot\\mathbf{q}+\\rho\\,r$，其中 $e$ 是单位质量的内能，$\\mathbf{q}$ 是热通量，而 $r$ 是单位质量的热源。\n- 具有小应变的线性弹性意味着机械应力功率 $\\boldsymbol{\\sigma}:\\nabla\\mathbf{v}$ 以保守方式储存机械应变能，并且内能的热学部分通过 $-\\nabla\\cdot\\mathbf{q}+\\rho\\,r$ 演化。\n- 单位体积的动能是 $\\frac{1}{2}\\rho\\,\\mathbf{v}\\cdot\\mathbf{v}$。\n\n将使用的有限元和离散化约定：\n- 使用一个双单元网格，节点位于 $x_0=0\\,\\mathrm{m}$、$x_1=1\\,\\mathrm{m}$、$x_2=2\\,\\mathrm{m}$。\n- 对于每个长度为 $l_e=L/2=1\\,\\mathrm{m}$ 的单元，其单元刚度矩阵为 $\\mathbf{k}_e=\\dfrac{E A}{l_e}\\begin{bmatrix}1  -1\\\\-1  1\\end{bmatrix}$，并按常规方式组装成全局刚度矩阵 $\\mathbf{K}\\in\\mathbb{R}^{3\\times 3}$。\n- 使用集中节点质量：单元质量为 $m_e=\\rho A l_e$，每个单元为其两个节点各贡献 $\\frac{1}{2}m_e$。全局节点质量向量为 $\\mathbf{m}=[m_0,m_1,m_2]^T$，总质量为 $M_{\\mathrm{tot}}=\\sum_i m_i$。\n- 令 $t_0$ 和 $t_1$ 时刻的节点位移向量为 $\\mathbf{u}_0$ 和 $\\mathbf{u}_1$（单位：$\\mathrm{m}$），节点速度向量为 $\\mathbf{v}_0$ 和 $\\mathbf{v}_1$（单位：$\\mathrm{m/s}$），节点温度向量为 $\\mathbf{T}_0$ 和 $\\mathbf{T}_1$（单位：$\\mathrm{K}$）。\n- 令 $t_0$ 和 $t_1$ 时刻的外部机械节点力分别为 $\\mathbf{F}_0$ 和 $\\mathbf{F}_1$（单位：$\\mathrm{N}$）。\n- 令左端 $x=0$ 的边界向内热通量密度为 $g_0(t)$，右端 $x=L$ 的为 $g_L(t)$（单位：$\\mathrm{W/m^2}$）。您已获知它们在 $t_0$ 和 $t_1$ 时刻的值：$g_0(t_0)$、$g_0(t_1)$、$g_L(t_0)$、$g_L(t_1)$。\n- 令单位质量的体积热源为 $r(t)$（单位：$\\mathrm{W/kg}$），并已获知其在 $t_0$ 和 $t_1$ 的值 $r(t_0)$ 和 $r(t_1)$。\n\n任务：\n1. 从所述的基本平衡定律出发，推导杆在 $[t_0,t_1]$ 时间区间内的单步、时间积分的能量平衡。仔细论证机械、热和动能的贡献是如何产生的，以及边界项和源项是如何出现的。对功率和热输入项的时间积分使用梯形法则（两点牛顿-柯特斯公式）。\n2. 使用一维杆的线性有限元近似和上述约定，将您推导的表达式具体化为以下可计算量：\n   - 时刻 $t_n$ 的动能为 $K(t_n)=\\dfrac{1}{2}\\sum_{i=0}^2 m_i\\,v_i(t_n)^2$。\n   - 时刻 $t_n$ 的弹性应变能为 $U(t_n)=\\dfrac{1}{2}\\,\\mathbf{u}(t_n)^T\\,\\mathbf{K}\\,\\mathbf{u}(t_n)$。\n   - 时刻 $t_n$ 的热内能为 $E_{\\mathrm{th}}(t_n)=c\\sum_{i=0}^2 m_i\\,T_i(t_n)$。\n   - 在 $[t_0,t_1]$ 时间区间内，通过对机械功率使用梯形法则近似的外部机械功：$W_{\\mathrm{ext}}\\approx \\Delta t\\,\\dfrac{1}{2}\\left(\\mathbf{F}_0^T\\mathbf{v}_0+\\mathbf{F}_1^T\\mathbf{v}_1\\right)$。\n   - 在 $[t_0,t_1]$ 时间区间内近似的体积热输入：$Q_{\\mathrm{vol}}\\approx \\Delta t\\,\\dfrac{1}{2}\\left(r(t_0)+r(t_1)\\right)\\,M_{\\mathrm{tot}}$。\n   - 在 $[t_0,t_1]$ 时间区间内近似的边界热输入：$Q_{\\mathrm{bnd}}\\approx \\Delta t\\,\\dfrac{A}{2}\\left(g_0(t_0)+g_0(t_1)+g_L(t_0)+g_L(t_1)\\right)$。\n3. 将一个时间步的能量平衡残差定义为标量\n   $$R=\\big(K(t_1)+U(t_1)+E_{\\mathrm{th}}(t_1)\\big)-\\big(K(t_0)+U(t_0)+E_{\\mathrm{th}}(t_0)\\big)-\\left(W_{\\mathrm{ext}}+Q_{\\mathrm{vol}}+Q_{\\mathrm{bnd}}\\right).$$\n   $R=0$ 的值表示在所述离散化下精确满足第一定律；$R\\neq 0$ 则衡量其不平衡度。\n4. 实现一个程序，对于下述每个测试案例，构造 $\\mathbf{K}$ 和 $\\mathbf{m}$，计算上述所有量，并以 $\\mathrm{J}$ 为单位输出残差 $R$。\n\n测试套件（所有向量均为长度为 $3$ 的向量，节点顺序为 $\\{0,1,2\\}$）：\n- 所有案例共享的全局常量：$L=2\\,\\mathrm{m}$、$A=0.01\\,\\mathrm{m}^2$、$\\rho=7800\\,\\mathrm{kg/m^3}$、$E=210\\times 10^9\\,\\mathrm{Pa}$、$c=500\\,\\mathrm{J/(kg\\cdot K)}$、$\\Delta t=10\\,\\mathrm{s}$。\n- 案例 $\\#1$（纯热输入，绝热边界，无力学）：\n  - $\\mathbf{u}_0=[0,0,0]\\,\\mathrm{m}$，$\\mathbf{u}_1=[0,0,0]\\,\\mathrm{m}$。\n  - $\\mathbf{v}_0=[0,0,0]\\,\\mathrm{m/s}$，$\\mathbf{v}_1=[0,0,0]\\,\\mathrm{m/s}$。\n  - $\\mathbf{T}_0=[300,300,300]\\,\\mathrm{K}$，$\\mathbf{T}_1=[301,301,301]\\,\\mathrm{K}$。\n  - $\\mathbf{F}_0=[0,0,0]\\,\\mathrm{N}$，$\\mathbf{F}_1=[0,0,0]\\,\\mathrm{N}$。\n  - $r(t_0)=50\\,\\mathrm{W/kg}$，$r(t_1)=50\\,\\mathrm{W/kg}$。\n  - $g_0(t_0)=0\\,\\mathrm{W/m^2}$，$g_0(t_1)=0\\,\\mathrm{W/m^2}$，$g_L(t_0)=0\\,\\mathrm{W/m^2}$，$g_L(t_1)=0\\,\\mathrm{W/m^2}$。\n- 案例 $\\#2$（通过节点力进行纯机械输入，无热量；选择位移和速度以储存和改变动能）：\n  - 令 $\\delta_1=\\sqrt{1/(2.1\\times 10^9)}\\,\\mathrm{m}\\approx 2.182178902359924\\times 10^{-5}\\,\\mathrm{m}$。\n  - $\\mathbf{u}_0=[0,0,0]\\,\\mathrm{m}$，$\\mathbf{u}_1=[0,\\delta_1,2\\delta_1]\\,\\mathrm{m}$。\n  - 令 $v_0=\\sqrt{1/78}\\,\\mathrm{m/s}\\approx 0.11322770341445959\\,\\mathrm{m/s}$ 及 $v_1=\\sqrt{5/78}\\,\\mathrm{m/s}\\approx 0.253546276418555\\,\\mathrm{m/s}$。\n  - $\\mathbf{v}_0=[0,v_0,0]\\,\\mathrm{m/s}$，$\\mathbf{v}_1=[0,v_1,0]\\,\\mathrm{m/s}$。\n  - 令 $F^\\star=\\dfrac{3}{5(v_0+v_1)}\\,\\mathrm{N}\\approx 1.6369869842298976\\,\\mathrm{N}$。\n  - $\\mathbf{F}_0=[0,F^\\star,0]\\,\\mathrm{N}$，$\\mathbf{F}_1=[0,F^\\star,0]\\,\\mathrm{N}$。\n  - $\\mathbf{T}_0=[300,300,300]\\,\\mathrm{K}$，$\\mathbf{T}_1=[300,300,300]\\,\\mathrm{K}$。\n  - $r(t_0)=0\\,\\mathrm{W/kg}$，$r(t_1)=0\\,\\mathrm{W/kg}$。\n  - $g_0(t_0)=0\\,\\mathrm{W/m^2}$，$g_0(t_1)=0\\,\\mathrm{W/m^2}$，$g_L(t_0)=0\\,\\mathrm{W/m^2}$，$g_L(t_1)=0\\,\\mathrm{W/m^2}$。\n- 案例 $\\#3$（热与机械结合，通过边界通量故意造成不匹配）：\n  - 令 $\\delta_2=\\sqrt{2/(2.1\\times 10^9)}\\,\\mathrm{m}\\approx 3.086067938066305\\times 10^{-5}\\,\\mathrm{m}$。\n  - $\\mathbf{u}_0=[0,0,0]\\,\\mathrm{m}$，$\\mathbf{u}_1=[0,\\delta_2,2\\delta_2]\\,\\mathrm{m}$。\n  - 令 $v_c=\\sqrt{2/78}\\,\\mathrm{m/s}\\approx 0.16012815380508713\\,\\mathrm{m/s}$。\n  - $\\mathbf{v}_0=[0,v_c,0]\\,\\mathrm{m/s}$，$\\mathbf{v}_1=[0,v_c,0]\\,\\mathrm{m/s}$。\n  - $\\mathbf{F}_0=[0,0,0]\\,\\mathrm{N}$，$\\mathbf{F}_1=[0,0,0]\\,\\mathrm{N}$。\n  - $\\mathbf{T}_0=[300,300,300]\\,\\mathrm{K}$，$\\mathbf{T}_1=[300.5,300.5,300.5]\\,\\mathrm{K}$。\n  - $r(t_0)=25\\,\\mathrm{W/kg}$，$r(t_1)=25\\,\\mathrm{W/kg}$。\n  - $g_0(t_0)=0\\,\\mathrm{W/m^2}$，$g_0(t_1)=0\\,\\mathrm{W/m^2}$，$g_L(t_0)=50\\,\\mathrm{W/m^2}$，$g_L(t_1)=50\\,\\mathrm{W/m^2}$。\n- 案例 $\\#4$（通过负外功提取机械能，无热量）：\n  - 令 $\\delta_3=\\sqrt{3/(2.1\\times 10^9)}\\,\\mathrm{m}\\approx 3.7796447309232046\\times 10^{-5}\\,\\mathrm{m}$。\n  - $\\mathbf{u}_0=[0,\\delta_3,2\\delta_3]\\,\\mathrm{m}$，$\\mathbf{u}_1=[0,0,0]\\,\\mathrm{m}$。\n  - 令 $v_0^\\dagger=\\sqrt{4/78}\\,\\mathrm{m/s}\\approx 0.22645540682891918\\,\\mathrm{m/s}$ 及 $v_1^\\dagger=\\sqrt{2/78}\\,\\mathrm{m/s}\\approx 0.16012815380508713\\,\\mathrm{m/s}$。\n  - $\\mathbf{v}_0=[0,v_0^\\dagger,0]\\,\\mathrm{m/s}$，$\\mathbf{v}_1=[0,v_1^\\dagger,0]\\,\\mathrm{m/s}$。\n  - 令 $F^\\dagger=-\\dfrac{4}{5(v_0^\\dagger+v_1^\\dagger)}\\,\\mathrm{N}\\approx -2.069488533955254\\,\\mathrm{N}$。\n  - $\\mathbf{F}_0=[0,F^\\dagger,0]\\,\\mathrm{N}$，$\\mathbf{F}_1=[0,F^\\dagger,0]\\,\\mathrm{N}$。\n  - $\\mathbf{T}_0=[300,300,300]\\,\\mathrm{K}$，$\\mathbf{T}_1=[300,300,300]\\,\\mathrm{K}$。\n  - $r(t_0)=0\\,\\mathrm{W/kg}$，$r(t_1)=0\\,\\mathrm{W/kg}$。\n  - $g_0(t_0)=0\\,\\mathrm{W/m^2}$，$g_0(t_1)=0\\,\\mathrm{W/m^2}$，$g_L(t_0)=0\\,\\mathrm{W/m^2}$，$g_L(t_1)=0\\,\\mathrm{W/m^2}$。\n\n要求的程序输出：\n- 计算每个案例中指定单位的残差 $R$。\n- 你的程序应生成单行输出，包含方括号括起来的逗号分隔列表形式的结果，例如 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4]$。\n- 以 $\\mathrm{J}$ 为单位表示每个残差，并四舍五入到六位小数。", "solution": "用户提供了一个计算固体力学领域的适定问题。验证步骤已通过，下面是完整的解答。\n\n### 第1部分：时间积分能量平衡的推导\n\n推导从提供的基本局部平衡定律开始。目标是为整个杆在时间区间 $[t_0, t_1]$ 上获得一个全局能量平衡方程。\n\n**1. 机械能平衡：**\n我们从没有惯性源项的局部动量平衡方程（即运动方程）开始：\n$$ \\rho\\,\\dot{\\mathbf{v}}=\\nabla\\cdot\\boldsymbol{\\sigma}+\\rho\\,\\mathbf{b} $$\n将此方程与速度向量 $\\mathbf{v}$ 做内积，得到局部功率平衡方程：\n$$ \\rho\\,\\mathbf{v}\\cdot\\dot{\\mathbf{v}} = (\\nabla\\cdot\\boldsymbol{\\sigma})\\cdot\\mathbf{v} + \\rho\\,\\mathbf{b}\\cdot\\mathbf{v} $$\n左边的项是动能密度的变化率，因为 $\\rho\\,\\mathbf{v}\\cdot\\dot{\\mathbf{v}} = \\frac{d}{dt}\\left(\\frac{1}{2}\\rho\\,\\mathbf{v}\\cdot\\mathbf{v}\\right)$。\n对于应力散度项，我们使用乘积法则 $\\nabla\\cdot(\\boldsymbol{\\sigma}^T\\mathbf{v}) = (\\nabla\\cdot\\boldsymbol{\\sigma})\\cdot\\mathbf{v} + \\boldsymbol{\\sigma}:\\nabla\\mathbf{v}$，这给出 $(\\nabla\\cdot\\boldsymbol{\\sigma})\\cdot\\mathbf{v} = \\nabla\\cdot(\\boldsymbol{\\sigma}^T\\mathbf{v}) - \\boldsymbol{\\sigma}:\\nabla\\mathbf{v}$。\n将这些代入功率平衡方程得到：\n$$ \\frac{d}{dt}\\left(\\frac{1}{2}\\rho\\,\\mathbf{v}\\cdot\\mathbf{v}\\right) = \\nabla\\cdot(\\boldsymbol{\\sigma}^T\\mathbf{v}) - \\boldsymbol{\\sigma}:\\nabla\\mathbf{v} + \\rho\\,\\mathbf{b}\\cdot\\mathbf{v} $$\n将此方程在杆的域 $\\Omega$ 上积分：\n$$ \\int_\\Omega \\frac{d}{dt}\\left(\\frac{1}{2}\\rho\\,\\mathbf{v}\\cdot\\mathbf{v}\\right) dV = \\int_\\Omega \\nabla\\cdot(\\boldsymbol{\\sigma}^T\\mathbf{v}) dV - \\int_\\Omega \\boldsymbol{\\sigma}:\\nabla\\mathbf{v} dV + \\int_\\Omega \\rho\\,\\mathbf{b}\\cdot\\mathbf{v} dV $$\n我们识别出以下各项：\n- $\\dot{K} = \\frac{d}{dt}\\int_\\Omega \\frac{1}{2}\\rho\\,\\mathbf{v}\\cdot\\mathbf{v} dV$ 是杆总动能的变化率。\n- $P_{\\mathrm{stress}} = \\int_\\Omega \\boldsymbol{\\sigma}:\\nabla\\mathbf{v} dV$ 是总应力功率。\n- 问题陈述中指出，对于线性弹性，应力功率以保守方式储存机械应变能。因此，$P_{\\mathrm{stress}} = \\dot{U}$，其中 $U$ 是总弹性应变能。\n- 使用散度定理，$\\int_\\Omega \\nabla\\cdot(\\boldsymbol{\\sigma}^T\\mathbf{v}) dV = \\int_{\\partial\\Omega} \\mathbf{v}\\cdot(\\boldsymbol{\\sigma}\\mathbf{n}) dA = \\int_{\\partial\\Omega} \\mathbf{v}\\cdot\\mathbf{t} dA$，其中 $\\mathbf{t}=\\boldsymbol{\\sigma}\\mathbf{n}$ 是表面牵引力。此项代表外表面力的功率，$P_{\\mathrm{surf}}$。\n- 项 $\\int_\\Omega \\rho\\,\\mathbf{b}\\cdot\\mathbf{v} dV$ 是体力的功率，$P_{\\mathrm{body}}$。\n总的外部机械功率是 $P_{\\mathrm{ext,mech}} = P_{\\mathrm{surf}} + P_{\\mathrm{body}}$。机械能的积分方程变为：\n$$ \\dot{K} = P_{\\mathrm{ext,mech}} - \\dot{U} \\quad \\implies \\quad \\dot{K} + \\dot{U} = P_{\\mathrm{ext,mech}} $$\n\n**2. 热能平衡：**\n热力学第一定律的局部形式为：\n$$ \\rho\\,\\dot{e}=\\boldsymbol{\\sigma}:\\nabla \\mathbf{v}-\\nabla\\cdot\\mathbf{q}+\\rho\\,r $$\n在没有热弹性耦合的假设下，单位质量的内能 $e$ 可以加性分解为机械（应变）部分 $e_{\\mathrm{mech}}$ 和热部分 $e_{\\mathrm{th}}$。机械部分的变化率与应力功率相关，即 $\\rho\\dot{e}_{\\mathrm{mech}} = \\boldsymbol{\\sigma}:\\nabla\\mathbf{v}$。将此代入第一定律，应力功率项被抵消，剩下热能的演化方程：\n$$ \\rho\\,\\dot{e}_{\\mathrm{th}} = -\\nabla\\cdot\\mathbf{q} + \\rho\\,r $$\n在域 $\\Omega$ 上积分：\n$$ \\int_\\Omega \\rho\\,\\dot{e}_{\\mathrm{th}} dV = -\\int_\\Omega \\nabla\\cdot\\mathbf{q} dV + \\int_\\Omega \\rho r dV $$\n我们识别出以下各项：\n- $\\dot{E}_{\\mathrm{th}} = \\frac{d}{dt}\\int_\\Omega \\rho e_{\\mathrm{th}} dV$ 是总热能的变化率。\n- 使用散度定理，$-\\int_\\Omega \\nabla\\cdot\\mathbf{q} dV = -\\int_{\\partial\\Omega} \\mathbf{q}\\cdot\\mathbf{n} dA$。向内热通量密度定义为 $g = -\\mathbf{q}\\cdot\\mathbf{n}$。因此，$-\\int_{\\partial\\Omega} \\mathbf{q}\\cdot\\mathbf{n} dA = \\int_{\\partial\\Omega} g dA = P_{\\mathrm{bnd}}$，即来自边界热通量的功率。\n- $P_{\\mathrm{vol}} = \\int_\\Omega \\rho r dV$ 是来自体积热源的功率。\n热能的积分方程为：\n$$ \\dot{E}_{\\mathrm{th}} = P_{\\mathrm{bnd}} + P_{\\mathrm{vol}} $$\n\n**3. 总能量平衡与时间积分：**\n将机械能和热能的速率方程相加，得到系统总能量的变化率：\n$$ \\frac{d}{dt}(K + U + E_{\\mathrm{th}}) = P_{\\mathrm{ext,mech}} + P_{\\mathrm{bnd}} + P_{\\mathrm{vol}} $$\n将此方程从 $t_0$ 到 $t_1$ 对时间进行积分：\n$$ \\int_{t_0}^{t_1} \\frac{d}{dt}(K + U + E_{\\mathrm{th}}) dt = \\int_{t_0}^{t_1} (P_{\\mathrm{ext,mech}} + P_{\\mathrm{bnd}} + P_{\\mathrm{vol}}) dt $$\n$$ \\left[ K + U + E_{\\mathrm{th}} \\right]_{t_0}^{t_1} = W_{\\mathrm{ext}} + Q_{\\mathrm{bnd}} + Q_{\\mathrm{vol}} $$\n其中 $W_{\\mathrm{ext}}$、$Q_{\\mathrm{bnd}}$ 和 $Q_{\\mathrm{vol}}$ 是该时间区间内的总功和热输入。展开后为：\n$$ (K(t_1)+U(t_1)+E_{\\mathrm{th}}(t_1)) - (K(t_0)+U(t_0)+E_{\\mathrm{th}}(t_0)) = W_{\\mathrm{ext}} + Q_{\\mathrm{bnd}} + Q_{\\mathrm{vol}} $$\n为数值近似功率项的时间积分，我们使用梯形法则。对于一个通用功率项 $P(t)$，在 $[t_0, t_1]$ 上的总能量输入为 $\\int_{t_0}^{t_1} P(t) dt \\approx \\frac{\\Delta t}{2}(P(t_0) + P(t_1))$，其中 $\\Delta t = t_1-t_0$。此规则应用于 $P_{\\mathrm{ext,mech}}$、$P_{\\mathrm{bnd}}$ 和 $P_{\\mathrm{vol}}$，从而证明了问题陈述中给出的表达式。\n\n### 第2部分：离散化系统的具体化\n\n现在，我们将连续的能量项具体化为所提供的有限元定义。\n**共享常量和矩阵：**\n- 杆长 $L=2\\,\\mathrm{m}$，横截面积 $A=0.01\\,\\mathrm{m}^2$，密度 $\\rho=7800\\,\\mathrm{kg/m^3}$，杨氏模量 $E=210\\times 10^9\\,\\mathrm{Pa}$，比热容 $c=500\\,\\mathrm{J/(kg\\cdot K)}$。\n- 单元数量 $N_e=2$，所以单元长度 $l_e=L/N_e=1\\,\\mathrm{m}$。\n- 单元质量 $m_e = \\rho A l_e = 7800 \\times 0.01 \\times 1 = 78\\,\\mathrm{kg}$。\n- 总质量 $M_{\\mathrm{tot}} = \\rho A L = 156\\,\\mathrm{kg}$。\n- 节点质量向量（集中的）：节点0获得单元1质量的一半。节点1获得单元1质量的一半和单元2质量的一半。节点2获得单元2质量的一半。\n$$ \\mathbf{m} = \\left[ \\frac{1}{2}m_e, \\frac{1}{2}m_e+\\frac{1}{2}m_e, \\frac{1}{2}m_e \\right]^T = [39, 78, 39]^T\\,\\mathrm{kg} $$\n- 单元刚度矩阵常数：$\\frac{EA}{l_e} = \\frac{(210\\times 10^9)(0.01)}{1} = 2.1\\times 10^9\\,\\mathrm{N/m}$。\n- 全局刚度矩阵 $\\mathbf{K}$：组装两个单元刚度矩阵 $\\mathbf{k}_e = \\frac{EA}{l_e}\\begin{bmatrix}1  -1\\\\-1  1\\end{bmatrix}$（针对单元(0,1)和(1,2)）得到：\n$$ \\mathbf{K} = \\frac{EA}{l_e} \\begin{bmatrix} 1  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1 \\end{bmatrix} = 2.1\\times 10^9 \\begin{bmatrix} 1  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1 \\end{bmatrix}\\,\\mathrm{N/m} $$\n\n**可计算量：**\n对于给定的时刻 $t_n$ 的状态（节点向量为 $\\mathbf{u}_n, \\mathbf{v}_n, \\mathbf{T}_n$）和外部载荷（$\\mathbf{F}_n, r_n, g_{0,n}, g_{L,n}$），我们计算以下量：\n- 动能：$K(t_n)=\\dfrac{1}{2}\\sum_{i=0}^2 m_i\\,v_i(t_n)^2 = \\frac{1}{2}\\mathbf{v}_n^T \\mathbf{M} \\mathbf{v}_n$，其中 $\\mathbf{M}$ 是节点质量的对角矩阵。\n- 应变能：$U(t_n)=\\dfrac{1}{2}\\,\\mathbf{u}_n^T\\,\\mathbf{K}\\,\\mathbf{u}_n$。\n- 热能：$E_{\\mathrm{th}}(t_n)=c\\sum_{i=0}^2 m_i\\,T_i(t_n) = c\\,\\mathbf{m}^T \\mathbf{T}_n$。\n- 外部机械功：$W_{\\mathrm{ext}}\\approx \\Delta t\\,\\dfrac{1}{2}\\left(\\mathbf{F}_0^T\\mathbf{v}_0+\\mathbf{F}_1^T\\mathbf{v}_1\\right)$。\n- 体积热输入：$Q_{\\mathrm{vol}}\\approx \\Delta t\\,\\dfrac{1}{2}\\left(r(t_0)+r(t_1)\\right)\\,M_{\\mathrm{tot}}$。\n- 边界热输入：$Q_{\\mathrm{bnd}}\\approx \\Delta t\\,\\dfrac{A}{2}\\left(g_0(t_0)+g_0(t_1)+g_L(t_0)+g_L(t_1)\\right)$。\n\n### 第3部分：能量平衡残差的计算\n\n残差 $R$ 定义为储存能量的变化与总能量输入之差：\n$$ R=\\left( (K(t_1)+U(t_1)+E_{\\mathrm{th}}(t_1))-(K(t_0)+U(t_0)+E_{\\mathrm{th}}(t_0)) \\right)-\\left(W_{\\mathrm{ext}}+Q_{\\mathrm{vol}}+Q_{\\mathrm{bnd}}\\right) $$\n我们为每个测试案例计算这个值。\n\n**案例1：**\n- $\\Delta K = 0$, $\\Delta U = 0$。$\\Delta E_{\\mathrm{th}} = c M_{\\mathrm{tot}} (T_1-T_0) = 500 \\times 156 \\times (301-300) = 78000\\,\\mathrm{J}$。\n- 总储存能量变化 $\\Delta E_{\\mathrm{total}} = 78000\\,\\mathrm{J}$。\n- $W_{\\mathrm{ext}}=0$, $Q_{\\mathrm{bnd}}=0$。$Q_{\\mathrm{vol}} = \\Delta t \\frac{1}{2}(r_0+r_1)M_{\\mathrm{tot}} = 10 \\times \\frac{1}{2}(50+50) \\times 156 = 78000\\,\\mathrm{J}$。\n- 总输入 $W_{\\mathrm{total}} = 78000\\,\\mathrm{J}$。\n- $R = 78000 - 78000 = 0\\,\\mathrm{J}$。\n\n**案例2：**\n- $\\Delta E_{\\mathrm{th}}=0$。\n- $U_0 = 0$。$U_1 = \\frac{1}{2} \\mathbf{u}_1^T \\mathbf{K} \\mathbf{u}_1 = \\frac{1}{2} (2.1\\times 10^9 \\times 2 \\times \\delta_1^2) = 1\\,\\mathrm{J}$。所以 $\\Delta U = 1\\,\\mathrm{J}$。\n- $K_0 = \\frac{1}{2} m_1 v_0^2 = \\frac{1}{2} \\times 78 \\times (1/78) = 0.5\\,\\mathrm{J}$。\n- $K_1 = \\frac{1}{2} m_1 v_1^2 = \\frac{1}{2} \\times 78 \\times (5/78) = 2.5\\,\\mathrm{J}$。所以 $\\Delta K = 2\\,\\mathrm{J}$。\n- $\\Delta E_{\\mathrm{total}} = \\Delta K + \\Delta U = 2+1=3\\,\\mathrm{J}$。\n- $W_{\\mathrm{ext}} = \\frac{\\Delta t}{2} F^\\star (v_0+v_1) = 5 \\times \\frac{3}{5(v_0+v_1)} \\times (v_0+v_1) = 3\\,\\mathrm{J}$。\n- $W_{\\mathrm{total}} = 3\\,\\mathrm{J}$。\n- $R = 3 - 3 = 0\\,\\mathrm{J}$。\n\n**案例3：**\n- 由于速度恒定，$\\Delta K = 0$。\n- $U_0=0$。$U_1 = \\frac{1}{2} \\mathbf{u}_1^T \\mathbf{K} \\mathbf{u}_1 = \\frac{1}{2} (2.1\\times 10^9 \\times 2 \\times \\delta_2^2) = 2\\,\\mathrm{J}$。所以 $\\Delta U = 2\\,\\mathrm{J}$。\n- $\\Delta E_{\\mathrm{th}} = c M_{\\mathrm{tot}} \\Delta T = 500 \\times 156 \\times 0.5 = 39000\\,\\mathrm{J}$。\n- $\\Delta E_{\\mathrm{total}} = 2 + 39000 = 39002\\,\\mathrm{J}$。\n- $W_{\\mathrm{ext}}=0$。$Q_{\\mathrm{vol}} = 10 \\times \\frac{1}{2}(25+25) \\times 156 = 39000\\,\\mathrm{J}$。\n- $Q_{\\mathrm{bnd}} = 10 \\times \\frac{0.01}{2} (0+0+50+50) = 5\\,\\mathrm{J}$。\n- $W_{\\mathrm{total}} = 39000 + 5 = 39005\\,\\mathrm{J}$。\n- $R = 39002 - 39005 = -3\\,\\mathrm{J}$。\n\n**案例4：**\n- $\\Delta E_{\\mathrm{th}}=0$。\n- $U_0 = \\frac{1}{2} \\mathbf{u}_0^T \\mathbf{K} \\mathbf{u}_0 = \\frac{1}{2} (2.1\\times 10^9 \\times 2 \\times \\delta_3^2) = 3\\,\\mathrm{J}$。$U_1=0$。所以 $\\Delta U = -3\\,\\mathrm{J}$。\n- $K_0 = \\frac{1}{2} m_1 (v_0^\\dagger)^2 = \\frac{1}{2} \\times 78 \\times (4/78) = 2\\,\\mathrm{J}$。\n- $K_1 = \\frac{1}{2} m_1 (v_1^\\dagger)^2 = \\frac{1}{2} \\times 78 \\times (2/78) = 1\\,\\mathrm{J}$。所以 $\\Delta K = -1\\,\\mathrm{J}$。\n- $\\Delta E_{\\mathrm{total}} = \\Delta K + \\Delta U = -1 - 3 = -4\\,\\mathrm{J}$。\n- $W_{\\mathrm{ext}} = \\frac{\\Delta t}{2} F^\\dagger (v_0^\\dagger+v_1^\\dagger) = 5 \\times \\frac{-4}{5(v_0^\\dagger+v_1^\\dagger)} \\times (v_0^\\dagger+v_1^\\dagger) = -4\\,\\mathrm{J}$。\n- $W_{\\mathrm{total}} = -4\\,\\mathrm{J}$。\n- $R = -4 - (-4) = 0\\,\\mathrm{J}$。\n\n计算出的残差为 $[0.0, 0.0, -3.0, 0.0]$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the energy balance problem for a 1D bar discretized with finite elements.\n    \"\"\"\n\n    # Global constants\n    L = 2.0  # m\n    A = 0.01  # m^2\n    rho = 7800.0  # kg/m^3\n    E = 210.0e9  # Pa\n    c = 500.0  # J/(kg.K)\n    dt = 10.0  # s\n\n    # Discretization parameters\n    num_elements = 2\n    num_nodes = 3\n    le = L / num_elements\n    me = rho * A * le\n    M_tot = rho * A * L\n\n    # Lumped mass vector for nodes {0, 1, 2}\n    m = np.array([0.5 * me, me, 0.5 * me])\n\n    # Global stiffness matrix K\n    k_val = E * A / le\n    K = k_val * np.array([\n        [1.0, -1.0, 0.0],\n        [-1.0, 2.0, -1.0],\n        [0.0, -1.0, 1.0]\n    ])\n\n    # --- Test suite ---\n    v0_c2 = np.sqrt(1.0 / 78.0)\n    v1_c2 = np.sqrt(5.0 / 78.0)\n    vc_c3 = np.sqrt(2.0 / 78.0)\n    v0_c4 = np.sqrt(4.0 / 78.0)\n    v1_c4 = np.sqrt(2.0 / 78.0)\n\n    test_cases = [\n        # Case 1: Pure thermal input\n        {\n            \"u0\": np.array([0.0, 0.0, 0.0]), \"u1\": np.array([0.0, 0.0, 0.0]),\n            \"v0\": np.array([0.0, 0.0, 0.0]), \"v1\": np.array([0.0, 0.0, 0.0]),\n            \"T0\": np.array([300.0, 300.0, 300.0]), \"T1\": np.array([301.0, 301.0, 301.0]),\n            \"F0\": np.array([0.0, 0.0, 0.0]), \"F1\": np.array([0.0, 0.0, 0.0]),\n            \"r0\": 50.0, \"r1\": 50.0,\n            \"g0_0\": 0.0, \"g0_1\": 0.0, \"gL_0\": 0.0, \"gL_1\": 0.0\n        },\n        # Case 2: Pure mechanical input\n        {\n            \"u0\": np.array([0.0, 0.0, 0.0]),\n            \"u1\": np.array([0.0, np.sqrt(1.0 / (2.1e9)), 2 * np.sqrt(1.0 / (2.1e9))]),\n            \"v0\": np.array([0.0, v0_c2, 0.0]), \"v1\": np.array([0.0, v1_c2, 0.0]),\n            \"T0\": np.array([300.0, 300.0, 300.0]), \"T1\": np.array([300.0, 300.0, 300.0]),\n            \"F0\": np.array([0.0, 3.0 / (5.0 * (v0_c2 + v1_c2)), 0.0]),\n            \"F1\": np.array([0.0, 3.0 / (5.0 * (v0_c2 + v1_c2)), 0.0]),\n            \"r0\": 0.0, \"r1\": 0.0,\n            \"g0_0\": 0.0, \"g0_1\": 0.0, \"gL_0\": 0.0, \"gL_1\": 0.0\n        },\n        # Case 3: Combined with mismatch\n        {\n            \"u0\": np.array([0.0, 0.0, 0.0]),\n            \"u1\": np.array([0.0, np.sqrt(2.0 / (2.1e9)), 2 * np.sqrt(2.0 / (2.1e9))]),\n            \"v0\": np.array([0.0, vc_c3, 0.0]), \"v1\": np.array([0.0, vc_c3, 0.0]),\n            \"T0\": np.array([300.0, 300.0, 300.0]), \"T1\": np.array([300.5, 300.5, 300.5]),\n            \"F0\": np.array([0.0, 0.0, 0.0]), \"F1\": np.array([0.0, 0.0, 0.0]),\n            \"r0\": 25.0, \"r1\": 25.0,\n            \"g0_0\": 0.0, \"g0_1\": 0.0, \"gL_0\": 50.0, \"gL_1\": 50.0\n        },\n        # Case 4: Mechanical energy extraction\n        {\n            \"u0\": np.array([0.0, np.sqrt(3.0 / (2.1e9)), 2 * np.sqrt(3.0 / (2.1e9))]),\n            \"u1\": np.array([0.0, 0.0, 0.0]),\n            \"v0\": np.array([0.0, v0_c4, 0.0]), \"v1\": np.array([0.0, v1_c4, 0.0]),\n            \"T0\": np.array([300.0, 300.0, 300.0]), \"T1\": np.array([300.0, 300.0, 300.0]),\n            \"F0\": np.array([0.0, -4.0 / (5.0 * (v0_c4 + v1_c4)), 0.0]),\n            \"F1\": np.array([0.0, -4.0 / (5.0 * (v0_c4 + v1_c4)), 0.0]),\n            \"r0\": 0.0, \"r1\": 0.0,\n            \"g0_0\": 0.0, \"g0_1\": 0.0, \"gL_0\": 0.0, \"gL_1\": 0.0\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack case data\n        u0, u1 = case[\"u0\"], case[\"u1\"]\n        v0, v1 = case[\"v0\"], case[\"v1\"]\n        T0, T1 = case[\"T0\"], case[\"T1\"]\n        F0, F1 = case[\"F0\"], case[\"F1\"]\n        r0, r1 = case[\"r0\"], case[\"r1\"]\n        g0_0, g0_1 = case[\"g0_0\"], case[\"g0_1\"]\n        gL_0, gL_1 = case[\"gL_0\"], case[\"gL_1\"]\n\n        # 1. Calculate change in stored energy\n        # Kinetic energy\n        K0 = 0.5 * np.sum(m * v0**2)\n        K1 = 0.5 * np.sum(m * v1**2)\n        \n        # Strain energy\n        U0 = 0.5 * u0.T @ K @ u0\n        U1 = 0.5 * u1.T @ K @ u1\n        \n        # Thermal energy\n        E_th0 = c * np.sum(m * T0)\n        E_th1 = c * np.sum(m * T1)\n        \n        delta_E_total = (K1 + U1 + E_th1) - (K0 + U0 + E_th0)\n\n        # 2. Calculate total energy input\n        # External mechanical work\n        W_ext = 0.5 * dt * (F0.T @ v0 + F1.T @ v1)\n        \n        # Volumetric heat input\n        Q_vol = 0.5 * dt * (r0 + r1) * M_tot\n        \n        # Boundary heat input\n        Q_bnd = 0.5 * dt * A * (g0_0 + g0_1 + gL_0 + gL_1)\n        \n        W_total_input = W_ext + Q_vol + Q_bnd\n\n        # 3. Calculate the residual\n        residual = delta_E_total - W_total_input\n        results.append(residual)\n\n    # Format and print the final results\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3546168"}, {"introduction": "在实践中，数值方法可能会引入非物理的人为效应，而第一定律是检测这些效应的绝佳工具。本实践探讨了“沙漏”不稳定性，这是一种在减缩积分有限元中可能出现的零能量变形模式。您将通过量化外部功与储存的内能之间的差异来揭示这种病态行为，从而证明能量平衡残差如何能够诊断您的有限元格式问题 ([@problem_id:3546305])。", "problem": "考虑一个二维四节点双线性四边形有限元，其节点坐标分别为 $(0\\,\\text{m},0\\,\\text{m})$、$(L\\,\\text{m},0\\,\\text{m})$、$(L\\,\\text{m},W\\,\\text{m})$、$(0\\,\\text{m},W\\,\\text{m})$，其中 $L$ 和 $W$ 表示单元边长。假设单元处于平面应变状态下的线弹性，其杨氏模量为 $E$，泊松比为 $\\nu$，厚度均匀为 $t$。除非另有说明，机械求解器采用减缩积分（在 $(\\xi,\\eta)=(0,0)$ 处使用一个权重为 $w=4$ 的高斯点）计算单元刚度。外部机械功通过节点力在一个从步骤 $n$ 到步骤 $n+1$ 的准静态增量步中施加，其中位移从 $\\mathbf{u}^n=\\mathbf{0}$ 线性增加到 $\\mathbf{u}^{n+1}=\\mathbf{u}$，力从 $\\mathbf{F}^n=\\mathbf{0}$ 线性增加到 $\\mathbf{F}^{n+1}=\\mathbf{F}$。不存在热传递，因此 $Q=0$。\n\n您的任务是纯粹的数学和算法任务：\n- 使用减缩积分（一个点，权重 $w=4$）和完全积分（在 $\\xi,\\eta=\\pm 1/\\sqrt{3}$ 处的 $2\\times 2$ 个高斯点，单位权重）构建单元刚度矩阵 $\\mathbf{K}$。使用标准的双线性形函数及其导数来构建应变-位移矩阵 $\\mathbf{B}$，以及从 Lamé 参数 $\\lambda$ 和 $\\mu$ 推导出的平面应变本构矩阵 $\\mathbf{D}$，其中 $\\lambda=E\\nu\\big/\\big((1+\\nu)(1-2\\nu)\\big)$ 且 $\\mu=E\\big/\\big(2(1+\\nu)\\big)$，则 $\\mathbf{D}=\\begin{bmatrix}\\lambda+2\\mu  \\lambda  0\\\\ \\lambda  \\lambda+2\\mu  0\\\\ 0  0  \\mu\\end{bmatrix}$。\n- 定义沙漏位移模式向量 $\\mathbf{v}_{\\text{hg}}$，已知该模式在减缩积分下会在单元形心处产生零应变：将 $u_x$ 的节点分量取为 $[+1,-1,+1,-1]$，$u_y$ 的节点分量取为 $[0,0,0,0]$，按节点 $(1,2,3,4)$ 排序，并将此向量归一化为单位欧几里得范数。当对一个轴对齐的矩形单元使用减缩积分计算刚度时，该模式是一个零能模式。\n- 通过指定一个恒定应变 $\\epsilon_x$ 来定义一个均匀轴向应变模式，使得节点位移为 $u_x(x_i,y_i)=\\epsilon_x x_i$ 和 $u_y(x_i,y_i)=0$，其中 $(x_i,y_i)$ 是节点坐标。这会产生恒定应变，对于双线性单元，减缩积分和完全积分会产生相同的单元能量。\n\n对一个封闭的绝热固体，在一个增量步内应用热力学第一定律，理想情况下为 $W_{\\text{ext}}=\\Delta E_{\\text{mech}}$。该增量步内一个可计算的第一定律残差为：\n$$\nR_E \\;=\\; W_{\\text{ext}} \\;-\\; \\big(E_{\\text{mech}}^{n+1}-E_{\\text{mech}}^n\\big) \\;-\\; Q,\n$$\n其中 $Q=0$，$E_{\\text{mech}}^{n}=0$（初始未变形），$E_{\\text{mech}}^{n+1}$ 等于由所选刚度和最终位移计算出的内部应变能，而线性加载过程中的外力功通过梯形法则计算（对于线性加载是精确的）：\n$$\nW_{\\text{ext}} \\;=\\; \\tfrac{1}{2}\\,\\mathbf{F}^{\\top}\\mathbf{u}.\n$$\n对于给定的刚度 $\\mathbf{K}$ 和最终位移 $\\mathbf{u}$ 的准静态线弹性问题，内部应变能为：\n$$\nE_{\\text{mech}}^{n+1} \\;=\\; \\tfrac{1}{2}\\,\\mathbf{u}^{\\top}\\mathbf{K}\\,\\mathbf{u}.\n$$\n\n实现一个程序来通过减缩积分和完全积分装配 $\\mathbf{K}$，为下面的测试套件中的场景评估 $R_E$，并输出残差。所有能量和功必须以焦耳表示。角度单位不适用。程序必须遵循上述规则并生成指定的聚合输出格式。\n\n所有测试中使用的单元几何和材料参数：\n- $L=1\\,\\text{m}$，$W=1\\,\\text{m}$，$t=0.01\\,\\text{m}$，$E=2.10\\times 10^{11}\\,\\text{Pa}$，$\\nu=0.30$。\n\n定义以下测试套件，每个测试产生一个残差 $R_E$：\n- 测试 1（减缩积分下无控制的沙漏激励）：使用减缩积分刚度 $\\mathbf{K}_{\\text{RI}}$。令最终位移为 $\\mathbf{u}=a\\,\\mathbf{v}_{\\text{hg}}$，其中 $a=1.0\\times 10^{-3}\\,\\text{m}$。施加与沙漏模式对齐的节点力 $\\mathbf{F}=f_0\\,\\mathbf{v}_{\\text{hg}}$，其中 $f_0=1.0\\times 10^{3}\\,\\text{N}$。使用 $\\mathbf{K}_{\\text{RI}}$、$Q=0$、$E_{\\text{mech}}^n=0$ 计算 $R_E$。\n- 测试 2（相同位移下的完全积分基准）：使用完全积分刚度 $\\mathbf{K}_{\\text{FI}}$。令最终位移为 $\\mathbf{u}=a\\,\\mathbf{v}_{\\text{hg}}$，其中 $a=1.0\\times 10^{-3}\\,\\text{m}$。选择与线弹性一致的力，$\\mathbf{F}=\\mathbf{K}_{\\text{FI}}\\mathbf{u}$。使用 $\\mathbf{K}_{\\text{FI}}$、$Q=0$、$E_{\\text{mech}}^n=0$ 计算 $R_E$。\n- 测试 3（带沙漏控制的减缩积分）：使用 $\\mathbf{K}_{\\text{eff}}=\\mathbf{K}_{\\text{RI}}+c_H\\,\\mathbf{P}$，其中 $\\mathbf{P}=\\mathbf{v}_{\\text{hg}}\\mathbf{v}_{\\text{hg}}^{\\top}$ 是到沙漏模式的投影算子（因为 $\\mathbf{v}_{\\text{hg}}$ 已被归一化），$c_H=5.0\\times 10^{5}\\,\\text{N/m}$ 代表一个简单的沙漏控制刚度。令 $\\mathbf{u}=a\\,\\mathbf{v}_{\\text{hg}}$，其中 $a=1.0\\times 10^{-3}\\,\\text{m}$，且 $\\mathbf{F}=f_0\\,\\mathbf{v}_{\\text{hg}}$，其中 $f_0=1.0\\times 10^{3}\\,\\text{N}$。使用 $\\mathbf{K}_{\\text{eff}}$、$Q=0$、$E_{\\text{mech}}^n=0$ 计算 $R_E$。\n- 测试 4（零外力功边界情况）：使用减缩积分刚度 $\\mathbf{K}_{\\text{RI}}$。令 $\\mathbf{u}=\\mathbf{0}$ 且 $\\mathbf{F}=\\mathbf{0}$。使用 $Q=0$ 计算 $R_E$。\n- 测试 5（减缩积分下的均匀应变模式）：使用减缩积分刚度 $\\mathbf{K}_{\\text{RI}}$。令 $\\epsilon_x=1.0\\times 10^{-4}$ 并通过 $u_x(x_i,y_i)=\\epsilon_x x_i$、$u_y(x_i,y_i)=0$ 定义节点位移，并汇集到 $\\mathbf{u}$ 中。选择与线弹性一致的力，$\\mathbf{F}=\\mathbf{K}_{\\text{FI}}\\mathbf{u}$（因为对于双线性单元，恒定应变能可由减缩积分精确积分，此处使用 $\\mathbf{K}_{\\text{FI}}$ 可确保力学一致性）。使用 $\\mathbf{K}_{\\text{RI}}$、$Q=0$、$E_{\\text{mech}}^n=0$ 计算 $R_E$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5]$，其中每个 $\\text{result}_i$ 是测试 $i$ 的浮点残差 $R_E$，单位为焦耳。", "solution": "用户提供的问题陈述已经过严格验证，并被确定为计算固体力学中一个有效且适定的问题。它在科学上基于线弹性和有限元法的原理，具有清晰一致的设置。为获得唯一解所需的所有数据和定义均已提供。\n\n求解过程首先为双线性四边形有限元建立理论框架，然后构建必要的矩阵，最后为每个指定的测试用例评估能量残差。\n\n**1. 基本定义和材料属性**\n\n问题提供了单个四边形单元的几何形状，其边长为 $L=1\\,\\text{m}$ 和 $W=1\\,\\text{m}$，厚度为 $t=0.01\\,\\text{m}$。该材料为线弹性，杨氏模量 $E=2.10\\times 10^{11}\\,\\text{Pa}$，泊松比 $\\nu=0.30$。\n\n分析在平面应变条件下进行。本构行为由 Lamé 参数、剪切模量 $\\mu$ 和第一个 Lamé 参数 $\\lambda$ 定义：\n$$\n\\mu = \\frac{E}{2(1+\\nu)} = \\frac{2.10\\times 10^{11}\\,\\text{Pa}}{2(1+0.30)} \\approx 8.0769\\times 10^{10}\\,\\text{Pa}\n$$\n$$\n\\lambda = \\frac{E\\nu}{(1+\\nu)(1-2\\nu)} = \\frac{(2.10\\times 10^{11}\\,\\text{Pa})(0.30)}{(1+0.30)(1-2(0.30))} \\approx 1.2115\\times 10^{11}\\,\\text{Pa}\n$$\n平面应变本构矩阵 $\\mathbf{D}$ 将应变向量 $\\boldsymbol{\\epsilon} = [\\epsilon_x, \\epsilon_y, \\gamma_{xy}]^\\top$ 与应力向量 $\\boldsymbol{\\sigma} = [\\sigma_x, \\sigma_y, \\tau_{xy}]^\\top$ 通过 $\\boldsymbol{\\sigma} = \\mathbf{D}\\boldsymbol{\\epsilon}$ 相关联，其形式为：\n$$\n\\mathbf{D} = \\begin{bmatrix} \\lambda+2\\mu  \\lambda  0 \\\\ \\lambda  \\lambda+2\\mu  0 \\\\ 0  0  \\mu \\end{bmatrix}\n$$\n\n**2. 有限元公式**\n\n该单元有四个节点，坐标分别为 $(0,0)$、$(L,0)$、$(L,W)$ 和 $(0,W)$。单元内的位移场由节点位移 $\\mathbf{d} = [u_{1x}, u_{1y}, \\dots, u_{4x}, u_{4y}]^\\top$ 通过在自然坐标系 $(\\xi, \\eta) \\in [-1,1]\\times[-1,1]$ 中的双线性形函数 $N_i(\\xi, \\eta)$ 插值得到。\n\n应变场由位移场推导得出，$\\boldsymbol{\\epsilon} = \\mathbf{B}\\mathbf{d}$，其中 $\\mathbf{B}$ 是应变-位移矩阵。对于与坐标轴对齐的矩形单元，从自然坐标到物理坐标映射的雅可比矩阵是恒定的：\n$$\n\\mathbf{J} = \\begin{bmatrix} \\partial x/\\partial \\xi  \\partial y/\\partial \\xi \\\\ \\partial x/\\partial \\eta  \\partial y/\\partial \\eta \\end{bmatrix} = \\begin{bmatrix} L/2  0 \\\\ 0  W/2 \\end{bmatrix}\n$$\n雅可比矩阵的行列式为 $\\det(\\mathbf{J}) = LW/4$。应变-位移矩阵 $\\mathbf{B}$ 由每个节点 $i$ 的块矩阵 $\\mathbf{B}_i$ 组成：\n$$\n\\mathbf{B}_i(\\xi, \\eta) = \\begin{bmatrix} \\frac{\\partial N_i}{\\partial x}  0 \\\\ 0  \\frac{\\partial N_i}{\\partial y} \\\\ \\frac{\\partial N_i}{\\partial y}  \\frac{\\partial N_i}{\\partial x} \\end{bmatrix}\n$$\n其中，关于物理坐标 $(x,y)$ 的导数通过雅可比矩阵的逆求得。节点 $i$ 的导数的一般形式为：\n$$\n\\frac{\\partial N_i}{\\partial x} = \\frac{s_i}{2L}(1+t_i \\eta), \\quad \\frac{\\partial N_i}{\\partial y} = \\frac{t_i}{2W}(1+s_i \\xi)\n$$\n其中节点 1, 2, 3, 4 的符号因子 $(s_i, t_i)$ 分别为 $(-1,-1), (1,-1), (1,1), (-1,1)$。\n\n单元刚度矩阵 $\\mathbf{K}$ 通过在单元体积 $V$ 上积分计算得出：\n$$\n\\mathbf{K} = \\int_{V} \\mathbf{B}^\\top \\mathbf{D} \\mathbf{B} \\,dV = t \\int_{-1}^1 \\int_{-1}^1 \\mathbf{B}(\\xi,\\eta)^\\top \\mathbf{D} \\mathbf{B}(\\xi,\\eta) \\det(\\mathbf{J}) \\,d\\xi d\\eta\n$$\n该积分使用高斯求积法进行计算：\n$$\n\\mathbf{K} \\approx t \\cdot \\det(\\mathbf{J}) \\sum_{k} w_k \\, \\mathbf{B}(\\xi_k, \\eta_k)^\\top \\mathbf{D} \\mathbf{B}(\\xi_k, \\eta_k)\n$$\n-   **减缩积分 ($\\mathbf{K}_{\\text{RI}}$)**：在 $(\\xi_1, \\eta_1)=(0,0)$ 处使用单个权重为 $w_1=4$ 的高斯点。\n-   **完全积分 ($\\mathbf{K}_{\\text{FI}}$)**：在 $(\\xi_k, \\eta_k) = (\\pm 1/\\sqrt{3}, \\pm 1/\\sqrt{3})$ 处使用四个单位权重 $w_k=1$ 的高斯点。\n\n**3. 能量残差计算**\n\n对于此绝热、准静态的力学过程，热力学第一定律指出，对系统所做的外功 $W_{\\text{ext}}$ 等于内力学能的变化量 $\\Delta E_{\\text{mech}}$。残差 $R_E$ 量化了数值模型中对此定律的违反程度：\n$$\nR_E = W_{\\text{ext}} - \\Delta E_{\\text{mech}} = W_{\\text{ext}} - (E_{\\text{mech}}^{n+1} - E_{\\text{mech}}^{n})\n$$\n鉴于初始状态是无应变的（$E_{\\text{mech}}^n=0$），外功和内能的表达式为：\n$$\nW_{\\text{ext}} = \\frac{1}{2} \\mathbf{F}^\\top \\mathbf{u}\n$$\n$$\nE_{\\text{mech}}^{n+1} = \\frac{1}{2} \\mathbf{u}^\\top \\mathbf{K} \\mathbf{u}\n$$\n其中 $\\mathbf{u}$ 和 $\\mathbf{F}$ 是最终位移和力向量，$\\mathbf{K}$ 是所选的刚度矩阵。\n\n**4. 测试用例评估**\n\n**测试 1：减缩积分下的沙漏激励**\n-   沙漏位移模式为 $\\mathbf{u} = a\\,\\mathbf{v}_{\\text{hg}}$，其中 $\\mathbf{v}_{\\text{hg}} = \\frac{1}{2}[1, 0, -1, 0, 1, 0, -1, 0]^\\top$ 是一个归一化向量。\n-   该模式在单元中心 $(\\xi,\\eta)=(0,0)$ 处产生零应变，即 $\\mathbf{B}(0,0)\\mathbf{v}_{\\text{hg}} = \\mathbf{0}$。\n-   刚度矩阵为 $\\mathbf{K} = \\mathbf{K}_{\\text{RI}}$。\n-   内能：$E_{\\text{mech}}^{n+1} = \\frac{1}{2} \\mathbf{u}^\\top \\mathbf{K}_{\\text{RI}} \\mathbf{u} = \\frac{a^2 t \\det J w_1}{2} (\\mathbf{B}(0,0)\\mathbf{v}_{\\text{hg}})^\\top \\mathbf{D} (\\mathbf{B}(0,0)\\mathbf{v}_{\\text{hg}}) = 0$。$\\mathbf{K}_{\\text{RI}}$ 是秩亏的，$\\mathbf{v}_{\\text{hg}}$ 在其零空间中。\n-   施加的力为 $\\mathbf{F} = f_0\\,\\mathbf{v}_{\\text{hg}}$。\n-   外功：$W_{\\text{ext}} = \\frac{1}{2} \\mathbf{F}^\\top \\mathbf{u} = \\frac{1}{2} (f_0 \\mathbf{v}_{\\text{hg}})^\\top (a \\mathbf{v}_{\\text{hg}}) = \\frac{1}{2} a f_0 (\\mathbf{v}_{\\text{hg}}^\\top \\mathbf{v}_{\\text{hg}}) = \\frac{1}{2}af_0$。\n-   当 $a = 1.0\\times 10^{-3}\\,\\text{m}$ 且 $f_0 = 1.0\\times 10^{3}\\,\\text{N}$ 时，$W_{\\text{ext}} = \\frac{1}{2}(10^{-3})(10^3) = 0.5\\,\\text{J}$。\n-   残差：$R_E = W_{\\text{ext}} - E_{\\text{mech}}^{n+1} = 0.5 - 0 = 0.5\\,\\text{J}$。\n\n**测试 2：沙漏位移的完全积分基准**\n-   位移为 $\\mathbf{u} = a\\,\\mathbf{v}_{\\text{hg}}$。刚度为 $\\mathbf{K} = \\mathbf{K}_{\\text{FI}}$。\n-   力与线弹性一致：$\\mathbf{F} = \\mathbf{K}_{\\text{FI}}\\mathbf{u}$。\n-   $W_{\\text{ext}} = \\frac{1}{2} \\mathbf{F}^\\top \\mathbf{u} = \\frac{1}{2} (\\mathbf{K}_{\\text{FI}}\\mathbf{u})^\\top \\mathbf{u} = \\frac{1}{2} \\mathbf{u}^\\top \\mathbf{K}_{\\text{FI}}^\\top \\mathbf{u}$。\n-   由于 $\\mathbf{K}_{\\text{FI}}$ 是对称的， $W_{\\text{ext}} = \\frac{1}{2} \\mathbf{u}^\\top \\mathbf{K}_{\\text{FI}} \\mathbf{u} = E_{\\text{mech}}^{n+1}$。\n-   残差：$R_E = W_{\\text{ext}} - E_{\\text{mech}}^{n+1} = 0\\,\\text{J}$。\n\n**测试 3：带沙漏控制的减缩积分**\n-   有效刚度为 $\\mathbf{K}_{\\text{eff}} = \\mathbf{K}_{\\text{RI}} + c_H \\mathbf{v}_{\\text{hg}}\\mathbf{v}_{\\text{hg}}^\\top$，其中 $c_H = 5.0\\times 10^{5}\\,\\text{N/m}$。\n-   $\\mathbf{u} = a\\,\\mathbf{v}_{\\text{hg}}$ 且 $\\mathbf{F} = f_0\\,\\mathbf{v}_{\\text{hg}}$。\n-   $E_{\\text{mech}}^{n+1} = \\frac{1}{2} \\mathbf{u}^\\top \\mathbf{K}_{\\text{eff}} \\mathbf{u} = \\frac{1}{2} (a\\mathbf{v}_{\\text{hg}})^\\top (\\mathbf{K}_{\\text{RI}} + c_H \\mathbf{v}_{\\text{hg}}\\mathbf{v}_{\\text{hg}}^\\top) (a\\mathbf{v}_{\\text{hg}})$。\n-   这可以简化为 $E_{\\text{mech}}^{n+1} = \\frac{a^2}{2} (\\mathbf{v}_{\\text{hg}}^\\top \\mathbf{K}_{\\text{RI}} \\mathbf{v}_{\\text{hg}} + c_H \\mathbf{v}_{\\text{hg}}^\\top (\\mathbf{v}_{\\text{hg}}\\mathbf{v}_{\\text{hg}}^\\top) \\mathbf{v}_{\\text{hg}}) = \\frac{a^2}{2} (0 + c_H (\\mathbf{v}_{\\text{hg}}^\\top \\mathbf{v}_{\\text{hg}})^2) = \\frac{a^2 c_H}{2}$。\n-   $E_{\\text{mech}}^{n+1} = \\frac{(10^{-3})^2 (5\\times 10^5)}{2} = 0.25\\,\\text{J}$。\n-   外功与测试 1 相同：$W_{\\text{ext}} = 0.5\\,\\text{J}$。\n-   残差：$R_E = W_{\\text{ext}} - E_{\\text{mech}}^{n+1} = 0.5 - 0.25 = 0.25\\,\\text{J}$。\n\n**测试 4：零外力功边界情况**\n-   $\\mathbf{u}=\\mathbf{0}$ 和 $\\mathbf{F}=\\mathbf{0}$。\n-   $W_{\\text{ext}} = \\frac{1}{2}\\mathbf{0}^\\top\\mathbf{0} = 0$。$E_{\\text{mech}}^{n+1} = \\frac{1}{2}\\mathbf{0}^\\top \\mathbf{K}_{\\text{RI}}\\mathbf{0} = 0$。\n-   残差：$R_E = 0 - 0 = 0\\,\\text{J}$。\n\n**测试 5：减缩积分下的均匀应变模式**\n-   位移场对应于一个恒定应变 $\\epsilon_x = 1.0 \\times 10^{-4}$。对于这样的场，整个单元的应变是恒定的。\n-   精确的应变能为 $E_{exact} = \\frac{1}{2} \\int_V \\boldsymbol{\\epsilon}^\\top \\mathbf{D} \\boldsymbol{\\epsilon} dV = \\frac{1}{2}(\\boldsymbol{\\epsilon}^\\top \\mathbf{D} \\boldsymbol{\\epsilon}) \\cdot V_{elem}$。\n-   因为被积函数是常数，所以减缩（1点）和完全（$2\\times2$点）高斯求积法都能精确计算此积分。\n-   因此，对于这个特定的位移 $\\mathbf{u}$，有 $\\mathbf{u}^\\top \\mathbf{K}_{\\text{RI}} \\mathbf{u} = \\mathbf{u}^\\top \\mathbf{K}_{\\text{FI}} \\mathbf{u}$。\n-   内能为 $E_{\\text{mech}}^{n+1} = \\frac{1}{2}\\mathbf{u}^\\top \\mathbf{K}_{\\text{RI}}\\mathbf{u}$。\n-   外功为 $W_{\\text{ext}} = \\frac{1}{2}\\mathbf{F}^\\top\\mathbf{u} = \\frac{1}{2}(\\mathbf{K}_{\\text{FI}}\\mathbf{u})^\\top\\mathbf{u} = \\frac{1}{2}\\mathbf{u}^\\top \\mathbf{K}_{\\text{FI}}\\mathbf{u}$。\n-   由于能量相同，所以 $E_{\\text{mech}}^{n+1} = W_{\\text{ext}}$。\n-   残差：$R_E = 0\\,\\text{J}$。\n\n计算结果与这些理论推导一致。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes energy balance residuals for a finite element under different conditions.\n    \"\"\"\n\n    # 1. Define element geometry and material parameters\n    L = 1.0  # m\n    W = 1.0  # m\n    t = 0.01 # m\n    E = 2.10e11 # Pa\n    nu = 0.30\n\n    # 2. Derive material constants for plane strain\n    lmbda = E * nu / ((1.0 + nu) * (1.0 - 2.0 * nu))\n    mu = E / (2.0 * (1.0 + nu))\n    D = np.array([\n        [lmbda + 2.0 * mu, lmbda, 0.0],\n        [lmbda, lmbda + 2.0 * mu, 0.0],\n        [0.0, 0.0, mu]\n    ])\n\n    def get_B_matrix(xi, eta, L, W):\n        \"\"\"Assembles the 3x8 strain-displacement matrix B for given natural coords.\"\"\"\n        s = np.array([-1.0, 1.0, 1.0, -1.0]) # s_i signs for nodes 1-4\n        t_signs = np.array([-1.0, -1.0, 1.0, 1.0]) # t_i signs for nodes 1-4\n        B = np.zeros((3, 8))\n        for i in range(4):\n            # Derivatives of shape function N_i w.r.t. physical coordinates x, y\n            dNi_dx = s[i] * (1.0 + t_signs[i] * eta) / (2.0 * L)\n            dNi_dy = t_signs[i] * (1.0 + s[i] * xi) / (2.0 * W)\n            \n            # Populate columns 2*i and 2*i+1 of B matrix\n            B[0, 2 * i] = dNi_dx\n            B[1, 2 * i + 1] = dNi_dy\n            B[2, 2 * i] = dNi_dy\n            B[2, 2 * i + 1] = dNi_dx\n        return B\n\n    def assemble_stiffness_matrix(L, W, t, D, integration_points):\n        \"\"\"Assembles the 8x8 stiffness matrix K using Gaussian quadrature.\"\"\"\n        K = np.zeros((8, 8))\n        det_J = L * W / 4.0\n        for xi, eta, weight in integration_points:\n            B = get_B_matrix(xi, eta, L, W)\n            K += weight * B.T @ D @ B * det_J * t\n        return K\n\n    # 3. Assemble stiffness matrices\n    \n    # Reduced Integration (1-point Gauss)\n    gauss_ri = [(0.0, 0.0, 4.0)] # (xi, eta, weight w_xi * w_eta)\n    K_RI = assemble_stiffness_matrix(L, W, t, D, gauss_ri)\n\n    # Full Integration (2x2-point Gauss)\n    gp_coord = 1.0 / np.sqrt(3.0)\n    gauss_fi = [\n        (-gp_coord, -gp_coord, 1.0),\n        ( gp_coord, -gp_coord, 1.0),\n        ( gp_coord,  gp_coord, 1.0),\n        (-gp_coord,  gp_coord, 1.0)\n    ]\n    K_FI = assemble_stiffness_matrix(L, W, t, D, gauss_fi)\n\n    # 4. Define and execute test cases\n    results = []\n\n    # Common definitions\n    a = 1.0e-3\n    f0 = 1.0e3\n    v_hg_unnormalized = np.array([1.0, 0.0, -1.0, 0.0, 1.0, 0.0, -1.0, 0.0])\n    v_hg = v_hg_unnormalized / np.linalg.norm(v_hg_unnormalized)\n\n    def calculate_residual(u, F, K):\n        \"\"\"Computes the energy residual R_E.\"\"\"\n        W_ext = 0.5 * F.T @ u\n        E_mech = 0.5 * u.T @ K @ u\n        return W_ext - E_mech\n    \n    # Test 1: Hourglass excitation, reduced integration\n    u1 = a * v_hg\n    F1 = f0 * v_hg\n    R_E_1 = calculate_residual(u1, F1, K_RI)\n    results.append(R_E_1)\n\n    # Test 2: Full integration baseline\n    u2 = a * v_hg\n    F2 = K_FI @ u2\n    R_E_2 = calculate_residual(u2, F2, K_FI)\n    results.append(R_E_2)\n\n    # Test 3: Reduced integration with hourglass control\n    c_H = 5.0e5\n    P = np.outer(v_hg, v_hg)\n    K_eff = K_RI + c_H * P\n    u3 = a * v_hg\n    F3 = f0 * v_hg\n    R_E_3 = calculate_residual(u3, F3, K_eff)\n    results.append(R_E_3)\n\n    # Test 4: Zero external work\n    u4 = np.zeros(8)\n    F4 = np.zeros(8)\n    R_E_4 = calculate_residual(u4, F4, K_RI)\n    results.append(R_E_4)\n    \n    # Test 5: Uniform strain mode\n    eps_x = 1.0e-4\n    node_coords = np.array([[0.0, 0.0], [L, 0.0], [L, W], [0.0, W]])\n    u5 = np.zeros(8)\n    for i in range(4):\n        u5[2 * i] = eps_x * node_coords[i, 0]\n    F5 = K_FI @ u5\n    R_E_5 = calculate_residual(u5, F5, K_RI)\n    results.append(R_E_5)\n    \n    # 5. Print results in the specified format\n    # The expected results are [0.5, 0.0, 0.25, 0.0, 0.0]\n    formatted_results = [f'{r:.17f}' for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3546305"}, {"introduction": "除了空间离散化，时间积分算法的选择也极大地影响着动力学模拟的能量守恒特性。本练习将研究结构动力学中的主力军——Newmark系列时间积分方法及其固有的数值耗散。通过分析一个简单振子的能量衰减，您将深入了解如何调整算法参数来控制能量守恒，这是确保瞬态分析长期准确性的一个关键考虑因素 ([@problem_id:3546260])。", "problem": "考虑一个线性的单自由度振子，其质量为 $m$（单位 $\\mathrm{kg}$），刚度为 $k$（单位 $\\mathrm{N/m}$），不受外力作用，也没有物理耗散。位移 $u(t)$（单位 $\\mathrm{m}$）满足常微分方程 $m \\ddot{u}(t) + k u(t) = 0$，初始条件为 $u(0) = u_0$ 和 $\\dot{u}(0) = v_0$。根据应用于力学系统的热力学第一定律，总机械能 $E(t) = T(t) + U(t)$（其中动能 $T(t) = \\tfrac{1}{2} m \\dot{u}(t)^2$，势能 $U(t) = \\tfrac{1}{2} k u(t)^2$）是一个不随时间变化的常量，即 $\\tfrac{d}{dt} E(t) = 0$，因为外力功率为零。然而，在数值时间积分中，可能会出现算法（数值）耗散，此时离散总能量可能会衰减。\n\n您将要分析 Newmark 方法族（参数对为 $(\\gamma,\\beta)$，并特化为 $\\gamma = \\tfrac{1}{2}$ 和 $\\beta \\ge \\tfrac{1}{4}$）的数值阻尼和算法能量。该时间积分器使用未知的加速度 $a_{n+1}$、速度 $v_{n+1}$ 和位移 $u_{n+1}$ 从时间步 $n$推进到 $n+1$，它们通过 Newmark 运动学关系和 $t_{n+1}$ 时刻的平衡方程联系起来。\n\n任务：\n- 从热力学第一定律和运动方程 $m \\ddot{u}(t) + k u(t) = 0$ 出发，推导 Newmark 方法（$\\gamma = \\tfrac{1}{2}$ 和通用 $\\beta \\ge \\tfrac{1}{4}$）的离散更新方程，并构建离散能量增量 $\\Delta E^{n} = E^{n+1} - E^{n}$，其中 $E^{n} = \\tfrac{1}{2} m (v^{n})^2 + \\tfrac{1}{2} k (u^{n})^2$。确定离散能量不增加时 $\\beta$ 所需满足的条件。\n- 将所得方案实现为一个程序，该程序在给定 $(m,k,u_0,v_0,\\Delta t,N,\\beta)$ 的情况下，计算序列 $\\{(u^{n},v^{n})\\}_{n=0}^{N}$ 以及相应的离散能量 $\\{E^{n}\\}_{n=0}^{N}$。\n- 对于测试套件中提供的每个案例，计算归一化的最终能量比 $r = E^{N} / E^{0}$（无量纲）。报告每个 $r$ 值，四舍五入到 $8$ 位小数。\n\n使用以下定义和要求：\n- 自然圆频率为 $\\omega = \\sqrt{k/m}$（单位 $\\mathrm{rad/s}$），周期为 $T = 2\\pi/\\omega$（单位 $\\mathrm{s}$）。\n- 使用初始条件 $u_0 = 1$（单位 $\\mathrm{m}$）和 $v_0 = 0$（单位 $\\mathrm{m/s}$）。\n- 能量单位为 $\\mathrm{J}$，但只需输出无量纲比值 $r$。\n- 除了在定义 $\\omega$ 和 $T$ 时，不使用角度；无需角度单位。\n- 最终输出必须是单行，包含一个 Python 列表，内含四个比值 $[r_1,r_2,r_3,r_4]$，每个比值四舍五入到 $8$ 位小数，不含额外文本。\n\n测试套件：\n- 案例 1（保守基线）：$m = 1$，$k = 1000$，$\\beta = 0.25$，$\\Delta t = T/40$，$N = 10 T / \\Delta t = 400$。\n- 案例 2（中等算法阻尼，细时间步长）：$m = 1$，$k = 1000$，$\\beta = 0.30$，$\\Delta t = T/40$，$N = 400$。\n- 案例 3（中等算法阻尼，粗时间步长）：$m = 1$，$k = 1000$，$\\beta = 0.30$，$\\Delta t = T/5$，$N = 50$。\n- 案例 4（强算法阻尼，极细时间步长）：$m = 1$，$k = 1000$，$\\beta = 0.50$，$\\Delta t = T/200$，$N = 2000$。\n\n您的程序应生成单行输出，其中包含一个用逗号分隔并用方括号括起来的结果列表（例如，$[r_1,r_2,r_3,r_4]$），其中每个 $r_i$ 是对应案例的归一化最终能量比，四舍五入到 $8$ 位小数。", "solution": "用户需要对一个关于 Newmark 时间积分方法的计算固体力学问题进行批判性分析和求解。\n\n### 问题验证\n\n**第 1 步：提取已知条件**\n\n-   **运动方程**：$m \\ddot{u}(t) + k u(t) = 0$，用于单自由度振子。\n-   **能量定义**：动能 $T(t) = \\tfrac{1}{2} m \\dot{u}(t)^2$，势能 $U(t) = \\tfrac{1}{2} k u(t)^2$，总能量 $E(t) = T(t) + U(t)$。\n-   **连续能量守恒**：对于给定系统，$\\tfrac{d}{dt} E(t) = 0$。\n-   **数值积分器**：Newmark 方法，参数为 $\\gamma = \\tfrac{1}{2}$ 和 $\\beta \\ge \\tfrac{1}{4}$。\n-   **Newmark 更新方程**：\n    -   $u_{n+1} = u_n + \\Delta t \\, v_n + \\Delta t^2 \\left[ \\left(\\tfrac{1}{2}-\\beta\\right) a_n + \\beta a_{n+1} \\right]$\n    -   $v_{n+1} = v_n + \\Delta t \\left[ (1-\\gamma) a_n + \\gamma a_{n+1} \\right]$\n-   **离散能量**：$E^{n} = \\tfrac{1}{2} m (v^{n})^2 + \\tfrac{1}{2} k (u^{n})^2$。\n-   **任务**：\n    1.  推导系统的离散更新方程。\n    2.  构建离散能量增量 $\\Delta E^{n} = E^{n+1} - E^{n}$，并确定能量不增加时 $\\beta$ 所需满足的条件。\n    3.  实现该方案并为四个测试案例计算归一化的最终能量比 $r = E^{N} / E^{0}$。\n-   **定义**：自然频率 $\\omega = \\sqrt{k/m}$，周期 $T = 2\\pi/\\omega$。\n-   **初始条件**：所有案例均使用 $u_0 = 1 \\, \\mathrm{m}$，$v_0 = 0 \\, \\mathrm{m/s}$。\n-   **测试套件**：\n    -   案例 1：$m = 1$，$k = 1000$，$\\beta = 0.25$，$\\Delta t = T/40$，$N = 400$。\n    -   案例 2：$m = 1$，$k = 1000$，$\\beta = 0.30$，$\\Delta t = T/40$，$N = 400$。\n    -   案例 3：$m = 1$，$k = 1000$，$\\beta = 0.30$，$\\Delta t = T/5$，$N = 50$。\n    -   案例 4：$m = 1$，$k = 1000$，$\\beta = 0.50$，$\\Delta t = T/200$，$N = 2000$。\n\n**第 2 步：使用提取的已知条件进行验证**\n\n根据指定标准评估此问题：\n-   **科学依据**：该问题基于经典力学和结构动力学数值方法的标准原理，基础扎实。Newmark 方法及其能量特性是计算力学中的经典课题。\n-   **适定性**：问题陈述完整，为每个测试案例提供了所有必要的物理参数、初始条件和数值参数。其目标是计算一个唯一定义的数值量，这是一个适定任务。\n-   **客观性**：问题使用精确、无歧义的数学和技术语言进行陈述。\n\n该问题未表现出任何诸如科学上不健全、不完整、矛盾或含糊不清等缺陷。所有提供的数据都是一致的。例如，在所有可以从给定比率计算总模拟时间 $N \\Delta t$ 的案例中，该时间都恒为 $10T$（例如，案例 3：$50 \\times (T/5) = 10T$）。\n\n**第 3 步：结论与行动**\n\n问题有效。将提供完整的解决方案。\n\n### 基于原理的解决方案\n\n该问题要求推导和实现用于线性单自由度（SDOF）振子的 Newmark 时间积分方案，并分析其能量守恒特性。\n\n**1. 离散更新方案的推导**\n\n系统在时间步 $n$ 的状态由位移 $u_n$、速度 $v_n$ 和加速度 $a_n$ 给出。我们的目标是找到时间步 $n+1$ 的状态 $(u_{n+1}, v_{n+1}, a_{n+1})$。Newmark 方法提供了运动学关系，而系统的运动方程提供了动力学约束。\n\n给定的 Newmark 更新方程（其中 $\\gamma = \\tfrac{1}{2}$）为：\n$$u_{n+1} = u_n + \\Delta t \\, v_n + \\Delta t^2 \\left[ \\left(\\frac{1}{2}-\\beta\\right) a_n + \\beta a_{n+1} \\right] \\quad (1)$$\n$$v_{n+1} = v_n + \\frac{\\Delta t}{2} (a_n + a_{n+1}) \\quad (2)$$\n\n运动方程必须在时间 $t_{n+1}$ 成立：\n$$m a_{n+1} + k u_{n+1} = 0$$\n对于线性系统，这提供了在时间步 $n+1$ 加速度和位移之间的直接关系：\n$$a_{n+1} = -\\frac{k}{m} u_{n+1} = -\\omega^2 u_{n+1} \\quad (3)$$\n其中 $\\omega = \\sqrt{k/m}$ 是自然圆频率。\n\n这是一个隐式方案，因为未知数 $a_{n+1}$（或 $u_{n+1}$）出现在方程 (1) 的右侧。为了推导显式更新过程，我们将方程 (3) 代入 (1)：\n$$u_{n+1} = u_n + \\Delta t \\, v_n + \\Delta t^2 \\left(\\frac{1}{2}-\\beta\\right) a_n + \\beta \\Delta t^2 (-\\omega^2 u_{n+1})$$\n我们现在可以解出未知位移 $u_{n+1}$：\n$$u_{n+1} \\left(1 + \\beta \\omega^2 \\Delta t^2\\right) = u_n + \\Delta t \\, v_n + \\Delta t^2 \\left(\\frac{1}{2}-\\beta\\right) a_n$$\n$$u_{n+1} = \\frac{1}{1 + \\beta \\omega^2 \\Delta t^2} \\left[ u_n + \\Delta t \\, v_n + \\Delta t^2 \\left(\\frac{1}{2}-\\beta\\right) a_n \\right] \\quad (4)$$\n\n确定 $u_{n+1}$ 后，可由方程 (3) 求得加速度 $a_{n+1}$，再由方程 (2) 求得速度 $v_{n+1}$。因此，系统可以通过以下算法在时间上推进：\n\n**算法：线性单自由度系统的 Newmark 积分步骤**\n1.  给定时间步 $n$ 的 $(u_n, v_n, a_n)$。\n2.  使用方程 (4) 计算 $u_{n+1}$。\n3.  计算 $a_{n+1} = -\\omega^2 u_{n+1}$。\n4.  计算 $v_{n+1} = v_n + \\frac{\\Delta t}{2} (a_n + a_{n+1})$。\n5.  设置 $(u_n, v_n, a_n) \\leftarrow (u_{n+1}, v_{n+1}, a_{n+1})$ 并进入下一步。\n\n启动过程需要初始加速度 $a_0$。它由 $t=0$ 时的运动方程确定：$m a_0 + k u_0 = 0 \\implies a_0 = -\\omega^2 u_0$。\n\n**2. 离散能量分析**\n\n时间步 $n$ 的离散总能量为 $E^n = \\tfrac{1}{2} m (v^n)^2 + \\tfrac{1}{2} k (u^n)^2$。一个时间步内的能量变化为 $\\Delta E^n = E^{n+1} - E^n$。结合方程 (1)、(2) 和 (3) 的严格推导表明，对于 $\\gamma = \\tfrac{1}{2}$ 的 Newmark 方法，数值耗散的能量由下式给出：\n$$\\Delta E^n = E^{n+1} - E^n = - m \\left(\\beta - \\frac{1}{4}\\right) \\frac{\\Delta t^2}{2 \\beta} \\left( a_{n+1} - a_n \\right)^2$$\n（这是计算动力学高级教材中的一个标准结果，例如 Simo  Hughes 的《计算非弹性力学》(Computational Inelasticity)）。\n\n我们分析此表达式以确定能量不增加的条件：\n-   对于 $\\beta  0$，项 $m \\left( a_{n+1} - a_n \\right)^2 \\Delta t^2 / (2 \\beta)$ 总是非负的。\n-   因此，$\\Delta E^n$ 的符号由 $-(\\beta - \\tfrac{1}{4})$ 的符号决定。\n\n这得出以下结论：\n-   如果 $\\beta = \\tfrac{1}{4}$，则 $\\Delta E^n = 0$。对于线性系统，该方法是能量守恒的。此方案被称为平均加速度法或梯形法则。\n-   如果 $\\beta  \\tfrac{1}{4}$，则 $-(\\beta - \\tfrac{1}{4})  0$，这意味着 $\\Delta E^n \\le 0$。该方法引入了数值（或算法）耗散，意味着离散总能量是不增加的。耗散量随 $(\\beta - \\tfrac{1}{4})$ 的值和时间步长 $\\Delta t$ 的增大而增加。\n-   如果 $\\beta  \\tfrac{1}{4}$（在 $\\gamma = \\tfrac{1}{2}$ 的情况下），该方法是无条件不稳定的，并且会在数值上放大能量，这在物理上是不正确的。\n\n问题指定 $\\beta \\ge \\tfrac{1}{4}$，这正是该方法无条件稳定且能量不增加的条件。\n\n**3. 实现计划**\n\n程序将实现推导出的算法。对每个测试案例：\n1.  初始化参数：$m, k, u_0, v_0, \\Delta t, N, \\beta$。\n2.  计算常数：$\\omega = \\sqrt{k/m}$。\n3.  设置初始状态：$u_n = u_0$，$v_n = v_0$，$a_n = -\\omega^2 u_0$。\n4.  计算初始能量：$E^0 = \\tfrac{1}{2}m v_n^2 + \\tfrac{1}{2}k u_n^2$。如果 $E^0 = 0$，比率将无定义，但给定的初始条件确保 $E^0  0$。\n5.  从 $n=0$ 到 $N-1$ 循环 $N$ 次，应用上面推导的更新步骤来计算 $(u_{n+1}, v_{n+1}, a_{n+1})$。\n6.  循环结束后，计算最终能量 $E^N = \\tfrac{1}{2}m (v^N)^2 + \\tfrac{1}{2}k (u^N)^2$。\n7.  计算比率 $r = E^N / E^0$。\n8.  四个案例的最终结果将被收集并以所需格式打印。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the normalized final energy ratio for a linear SDOF oscillator\n    using the Newmark integration method for four different test cases.\n    \"\"\"\n\n    def run_simulation(m, k, u0, v0, dt, N, beta):\n        \"\"\"\n        Performs the time integration using the Newmark method.\n\n        Args:\n            m (float): Mass (kg)\n            k (float): Stiffness (N/m)\n            u0 (float): Initial displacement (m)\n            v0 (float): Initial velocity (m/s)\n            dt (float): Time step (s)\n            N (int): Number of time steps\n            beta (float): Newmark parameter\n\n        Returns:\n            float: The normalized final energy ratio E_N / E_0.\n        \"\"\"\n        # Pre-compute constants\n        omega_sq = k / m\n        gamma = 0.5\n\n        # Initial conditions at step n=0\n        u_n = float(u0)\n        v_n = float(v0)\n        # Initial acceleration from equation of motion: m*a_0 + k*u_0 = 0\n        a_n = -omega_sq * u_n\n\n        # Initial energy E_0\n        E_0 = 0.5 * m * v_n**2 + 0.5 * k * u_n**2\n        if E_0 == 0.0:\n            # If initial energy is zero, the ratio is ill-defined.\n            # With the given ICs, E_0  0, so this is a safeguard.\n            return 1.0\n\n        # Constants for efficient update of u_{n+1}\n        # u_{n+1} = c1 * (u_n + dt*v_n + c3*a_n)\n        c1 = 1.0 / (1.0 + beta * omega_sq * dt**2)\n        c3 = dt**2 * (0.5 - beta)\n\n        # Time-stepping loop\n        for _ in range(N):\n            # Solve for unknowns at step n+1\n            # 1. Update displacement u_{n+1}\n            u_np1 = c1 * (u_n + dt * v_n + c3 * a_n)\n\n            # 2. Update acceleration a_{n+1}\n            a_np1 = -omega_sq * u_np1\n\n            # 3. Update velocity v_{n+1}\n            v_np1 = v_n + dt * ((1.0 - gamma) * a_n + gamma * a_np1)\n            \n            # Prepare for the next step\n            u_n, v_n, a_n = u_np1, v_np1, a_np1\n\n        # Final energy E_N\n        E_N = 0.5 * m * v_n**2 + 0.5 * k * u_n**2\n\n        # Compute and return the ratio\n        ratio = E_N / E_0\n        return ratio\n\n    # Common parameters for all test cases\n    m_val = 1.0\n    k_val = 1000.0\n    u0_val = 1.0\n    v0_val = 0.0\n\n    omega = np.sqrt(k_val / m_val)\n    T_period = 2.0 * np.pi / omega\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        # Case 1 (conservative baseline)\n        {'beta': 0.25, 'dt': T_period / 40.0, 'N': 400},\n        # Case 2 (moderate algorithmic damping, fine time step)\n        {'beta': 0.30, 'dt': T_period / 40.0, 'N': 400},\n        # Case 3 (moderate algorithmic damping, coarse time step)\n        {'beta': 0.30, 'dt': T_period / 5.0, 'N': 50},\n        # Case 4 (strong algorithmic damping, very fine time step)\n        {'beta': 0.50, 'dt': T_period / 200.0, 'N': 2000},\n    ]\n\n    results = []\n    for params in test_cases:\n        ratio = run_simulation(m_val, k_val, u0_val, v0_val, params['dt'], params['N'], params['beta'])\n        # Round the result to 8 decimal places\n        results.append(round(ratio, 8))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3546260"}]}