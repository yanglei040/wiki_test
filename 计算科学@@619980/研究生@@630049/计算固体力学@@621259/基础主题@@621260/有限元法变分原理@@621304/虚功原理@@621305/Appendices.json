{"hands_on_practices": [{"introduction": "在非线性有限元分析中，核心步骤是将虚功原理离散化，从而得到与节点位移相关的内力向量。为了使用牛顿-拉夫逊（Newton-Raphson）等高效的迭代法求解非线性方程组，我们必须对内力向量进行一致性线性化，以获得切线刚度矩阵。本练习将引导你为一个简单但具有代表性的非线性超弹性杆单元推导这两个关键量，这是掌握非线性有限元方法的基础。[@problem_id:3591302]", "problem": "考虑一个双节点等参杆有限元，其未变形长度为 $L$，横截面积为常数 $A$，沿 $x$ 轴排列且发生小应变。轴向位移场由标准线性形函数 $N_{1}(x)=1-\\frac{x}{L}$ 和 $N_{2}(x)=\\frac{x}{L}$ 近似表示为 $u_{h}(x)=N_{1}(x)\\,u_{1}+N_{2}(x)\\,u_{2}$，其中 $u_{1}$ 和 $u_{2}$ 是节点轴向位移。该材料为一维超弹性固体，其亥姆霍兹自由能密度为 $\\psi(\\varepsilon)=\\frac{1}{2}\\,E\\,\\varepsilon^{2}+\\frac{\\alpha}{4}\\,\\varepsilon^{4}$，其中 $\\varepsilon$ 是小轴向应变，$E>0$ 是线性弹性模量，$\\alpha \\ge 0$ 是材料非线性参数。\n\n仅使用虚功原理 (PVW) 和源于自由能的定义，建立单元内虚功的公式，并推导出单元内力矢量。然后，通过对节点位移矢量 $\\mathbf{u}_{e}=[u_{1}\\;\\;u_{2}]^{T}$ 进行一致性线性化，推导出该单元的一致性切向刚度矩阵，用 $A$、$L$、$E$、$\\alpha$、$u_{1}$ 和 $u_{2}$ 表示。假设等温条件，忽略体力与面力，并在小应变、一维框架内进行计算。\n\n将最终答案表示为关于 $u_{1}$ 和 $u_{2}$ 的单个闭式 $2\\times 2$ 矩阵函数，不带单位。不要通过引入中间常量来简化。无需进行数值计算。", "solution": "该问题是有效的，因为它科学地基于连续介质力学和有限元法的原理，信息充分，问题明确，并且陈述客观。\n\n指定的一维超弹性杆单元的一致性切向刚度矩阵的推导过程分为四个步骤：建立运动学关系，根据给定的自由能定义本构律，通过虚功原理 (PVW) 建立内力矢量，最后对内力矢量进行线性化。\n\n**步骤 1：运动学**\n\n单元内的轴向位移场 $u_{h}(x)$ 是通过线性形函数 $N_{1}(x) = 1 - \\frac{x}{L}$ 和 $N_{2}(x) = \\frac{x}{L}$ 从节点位移 $u_{1}$ 和 $u_{2}$ 插值得到。\n用矩阵形式表示为 $u_{h}(x) = \\mathbf{N}(x)\\mathbf{u}_{e}$，其中 $\\mathbf{N}(x) = \\begin{pmatrix} N_{1}(x) & N_{2}(x) \\end{pmatrix}$ 且 $\\mathbf{u}_{e} = \\begin{pmatrix} u_{1} \\\\ u_{2} \\end{pmatrix}$。\n\n在小应变框架内，轴向应变 $\\varepsilon$ 是位移场的空间导数：\n$$\n\\varepsilon(x) = \\frac{d u_{h}}{dx} = \\frac{d\\mathbf{N}}{dx}\\mathbf{u}_{e}\n$$\n形函数矩阵的导数是应变-位移矩阵 $\\mathbf{B}$：\n$$\n\\mathbf{B}(x) = \\frac{d\\mathbf{N}}{dx} = \\begin{pmatrix} \\frac{dN_{1}}{dx} & \\frac{dN_{2}}{dx} \\end{pmatrix} = \\begin{pmatrix} -\\frac{1}{L} & \\frac{1}{L} \\end{pmatrix}\n$$\n由于 $\\mathbf{B}$ 是常数，应变 $\\varepsilon$ 在整个单元内是均匀的：\n$$\n\\varepsilon = \\mathbf{B}\\mathbf{u}_{e} = \\begin{pmatrix} -\\frac{1}{L} & \\frac{1}{L} \\end{pmatrix} \\begin{pmatrix} u_{1} \\\\ u_{2} \\end{pmatrix} = \\frac{u_{2} - u_{1}}{L}\n$$\n\n**步骤 2：本构律**\n\n该材料是超弹性的，其行为由亥姆霍兹自由能密度 $\\psi(\\varepsilon)$ 控制。对于等温过程，轴向应力 $\\sigma$ 与轴向应变 $\\varepsilon$ 热力学共轭，通过对 $\\psi$ 求关于 $\\varepsilon$ 的导数得到：\n$$\n\\sigma = \\frac{\\partial\\psi}{\\partial\\varepsilon}\n$$\n给定自由能密度 $\\psi(\\varepsilon) = \\frac{1}{2}\\,E\\,\\varepsilon^{2}+\\frac{\\alpha}{4}\\,\\varepsilon^{4}$，应力为：\n$$\n\\sigma = \\frac{\\partial}{\\partial\\varepsilon} \\left( \\frac{1}{2}\\,E\\,\\varepsilon^{2}+\\frac{\\alpha}{4}\\,\\varepsilon^{4} \\right) = E\\,\\varepsilon + \\alpha\\,\\varepsilon^{3}\n$$\n这是一个非线性的应力-应变关系。\n\n**步骤 3：内力矢量**\n\n虚功原理 (PVW) 指出，内虚功 $\\delta W_{int}$ 等于外虚功 $\\delta W_{ext}$。对于处于平衡状态的单元，我们考虑其内部部分。内虚功是应力作用于虚应变 $\\delta\\varepsilon$ 在整个单元体积 $V$ 上的积分。\n$$\n\\delta W_{int} = \\int_{V} \\sigma \\, \\delta\\varepsilon \\, dV\n$$\n在一维情况下，$dV = A\\,dx$，其中 $A$ 是横截面积。虚应变由 $\\delta\\varepsilon = \\mathbf{B}\\,\\delta\\mathbf{u}_{e}$ 给出。将此代入 $\\delta W_{int}$ 的表达式中：\n$$\n\\delta W_{int} = \\int_{0}^{L} \\sigma \\, (\\mathbf{B}\\,\\delta\\mathbf{u}_{e}) \\, A \\, dx\n$$\n由于虚节点位移 $\\delta\\mathbf{u}_{e}$ 是任意的且不是 $x$ 的函数，我们可以将其写为：\n$$\n\\delta W_{int} = \\delta\\mathbf{u}_{e}^{T} \\left( \\int_{0}^{L} \\mathbf{B}^{T} \\, \\sigma \\, A \\, dx \\right)\n$$\n根据定义，括号中的表达式是单元内力矢量 $\\mathbf{f}_{int}$：\n$$\n\\mathbf{f}_{int} = \\int_{0}^{L} \\mathbf{B}^{T} \\, \\sigma \\, A \\, dx\n$$\n由于 $\\mathbf{B}$、$\\sigma$（因为 $\\varepsilon$ 是均匀的）和 $A$ 在单元长度上都是常数，积分简化为：\n$$\n\\mathbf{f}_{int} = A \\, L \\, \\mathbf{B}^{T} \\, \\sigma\n$$\n代入 $\\mathbf{B}$ 和 $\\sigma$ 的表达式：\n$$\n\\mathbf{f}_{int} = A \\, L \\, \\begin{pmatrix} -\\frac{1}{L} \\\\ \\frac{1}{L} \\end{pmatrix} (E\\,\\varepsilon + \\alpha\\,\\varepsilon^{3}) = A \\, \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix} (E\\,\\varepsilon + \\alpha\\,\\varepsilon^{3})\n$$\n最后，代入 $\\varepsilon = \\frac{u_{2} - u_{1}}{L}$：\n$$\n\\mathbf{f}_{int} = A \\, \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix} \\left( E\\frac{u_{2} - u_{1}}{L} + \\alpha\\left(\\frac{u_{2} - u_{1}}{L}\\right)^{3} \\right)\n$$\n\n**步骤 4：一致性切向刚度矩阵**\n\n一致性切向刚度矩阵 $\\mathbf{K}_{T}$ 是通过内力矢量 $\\mathbf{f}_{int}$ 对节点位移矢量 $\\mathbf{u}_{e}$ 的线性化得到的。这对应于求 $\\mathbf{f}_{int}$ 的雅可比矩阵：\n$$\n\\mathbf{K}_{T} = \\frac{\\partial \\mathbf{f}_{int}}{\\partial \\mathbf{u}_{e}} = \\begin{pmatrix} \\frac{\\partial (f_{int})_{1}}{\\partial u_{1}} & \\frac{\\partial (f_{int})_{1}}{\\partial u_{2}} \\\\ \\frac{\\partial (f_{int})_{2}}{\\partial u_{1}} & \\frac{\\partial (f_{int})_{2}}{\\partial u_{2}} \\end{pmatrix}\n$$\n我们来计算其分量。$\\mathbf{f}_{int}$ 的分量是：\n$$\n(f_{int})_{1} = -A \\left( \\frac{E}{L}(u_{2} - u_{1}) + \\frac{\\alpha}{L^{3}}(u_{2} - u_{1})^{3} \\right)\n$$\n$$\n(f_{int})_{2} = +A \\left( \\frac{E}{L}(u_{2} - u_{1}) + \\frac{\\alpha}{L^{3}}(u_{2} - u_{1})^{3} \\right)\n$$\n求偏导数：\n$$\nK_{T,11} = \\frac{\\partial (f_{int})_{1}}{\\partial u_{1}} = -A \\left( \\frac{E}{L}(-1) + \\frac{\\alpha}{L^{3}} \\cdot 3(u_{2} - u_{1})^{2}(-1) \\right) = \\frac{AE}{L} + \\frac{3A\\alpha}{L^{3}}(u_{2} - u_{1})^{2}\n$$\n$$\nK_{T,12} = \\frac{\\partial (f_{int})_{1}}{\\partial u_{2}} = -A \\left( \\frac{E}{L}(1) + \\frac{\\alpha}{L^{3}} \\cdot 3(u_{2} - u_{1})^{2}(1) \\right) = -\\frac{AE}{L} - \\frac{3A\\alpha}{L^{3}}(u_{2} - u_{1})^{2}\n$$\n$$\nK_{T,21} = \\frac{\\partial (f_{int})_{2}}{\\partial u_{1}} = A \\left( \\frac{E}{L}(-1) + \\frac{\\alpha}{L^{3}} \\cdot 3(u_{2} - u_{1})^{2}(-1) \\right) = -\\frac{AE}{L} - \\frac{3A\\alpha}{L^{3}}(u_{2} - u_{1})^{2}\n$$\n$$\nK_{T,22} = \\frac{\\partial (f_{int})_{2}}{\\partial u_{2}} = A \\left( \\frac{E}{L}(1) + \\frac{\\alpha}{L^{3}} \\cdot 3(u_{2} - u_{1})^{2}(1) \\right) = \\frac{AE}{L} + \\frac{3A\\alpha}{L^{3}}(u_{2} - u_{1})^{2}\n$$\n将这些分量组合成矩阵，得到一致性切向刚度矩阵的最终表达式：\n$$\n\\mathbf{K}_{T} = \\begin{pmatrix} \\frac{AE}{L} + \\frac{3A\\alpha(u_{2} - u_{1})^{2}}{L^{3}} & -\\frac{AE}{L} - \\frac{3A\\alpha(u_{2} - u_{1})^{2}}{L^{3}} \\\\ -\\frac{AE}{L} - \\frac{3A\\alpha(u_{2} - u_{1})^{2}}{L^{3}} & \\frac{AE}{L} + \\frac{3A\\alpha(u_{2} - u_{1})^{2}}{L^{3}} \\end{pmatrix}\n$$\n该矩阵是对称的，正如所预期的。如果非线性材料参数 $\\alpha = 0$，该矩阵正确地简化为杆单元的标准线性刚度矩阵。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{AE}{L} + \\frac{3A\\alpha(u_{2} - u_{1})^{2}}{L^{3}} & -\\frac{AE}{L} - \\frac{3A\\alpha(u_{2} - u_{1})^{2}}{L^{3}} \\\\\n-\\frac{AE}{L} - \\frac{3A\\alpha(u_{2} - u_{1})^{2}}{L^{3}} & \\frac{AE}{L} + \\frac{3A\\alpha(u_{2} - u_{1})^{2}}{L^{3}}\n\\end{pmatrix}\n}\n$$", "id": "3591302"}, {"introduction": "虚功原理的强大之处在于其普适性，它不仅能处理保守载荷，也能优雅地处理更复杂的非保守力系统。本练习探讨了一种在结构失稳和动力学分析中至关重要的非保守“跟随载荷”（follower load）。通过对该载荷产生的虚功进行一致性线性化，你将亲手揭示一个深刻的结论：非保守力会导致非对称的切线刚度矩阵，这对于理解系统的稳定性和选择正确的求解策略至关重要。[@problem_id:3591290]", "problem": "考虑一个在有限元法（FEM）中使用的平面、双节点、直杆单元。杆的初始构型中，节点 $1$ 位于 $(0,0)$，节点 $2$ 位于 $(L,0)$，其中 $L>0$ 是其未变形长度。节点 $1$ 是固定的。节点 $2$ 在 $x$ 和 $y$ 方向上分别发生平移位移 $(u_x,u_y)$。一个大小为常数 $P>0$ 的非保守随动荷载施加在节点 $2$ 上，其方向始终沿着杆在变形构型下轴线的当前单位法向量。该杆是超弹性的，具有对称的内力切线贡献，但您应只关注外部随动荷载对切线的贡献。\n\n使用虚功原理（PVW），从总虚功在平衡时为零的基本弱形式陈述开始，即 $\\delta W_{\\text{int}} - \\delta W_{\\text{ext}} = 0$，其中 $\\delta W_{\\text{int}}$ 是内虚功，$\\delta W_{\\text{ext}}$ 是由随动荷载引起的​外虚功。将内虚功视为产生对称的切线贡献，并仅考虑外部随动荷载的贡献来证明不对称性。\n\n设从节点 $1$ 到节点 $2$ 的当前向量为 $\\mathbf{r} = (x,y)$，其中 $x=L+u_x$ 且 $y=u_y$，其长度为 $R=\\sqrt{x^2+y^2}$。定义沿杆的当前单位切向量为 $\\mathbf{t} = \\mathbf{r}/R$，相应的单位法向量为 $\\mathbf{n} = (-t_y, t_x) = \\left(-\\dfrac{y}{R}, \\dfrac{x}{R}\\right)$。因此，由随动荷载引起的节点 $2$ 上的外节点力为 $\\mathbf{f}_{\\text{ext}} = P\\,\\mathbf{n}$。\n\n构建离散外虚功 $\\delta W_{\\text{ext}} = \\mathbf{f}_{\\text{ext}} \\cdot \\delta \\mathbf{u}_2$，并通过对 $(u_x,u_y)$ 的一致线性化，得到对 $2\\times 2$ 切线矩阵的外部贡献 $\\mathbf{K}_{\\text{ext}} = \\dfrac{\\partial \\mathbf{f}_{\\text{ext}}}{\\partial \\mathbf{u}_2}$。计算 $\\mathbf{K}_{\\text{ext}}$ 的非对角项之差 $k_{12} - k_{21}$，并以 $P$、$L$、$u_x$ 和 $u_y$ 表示的封闭形式解析表达式给出。\n\n您的最终答案必须是单一的封闭形式解析表达式。所求量 $k_{12}-k_{21}$ 的单位是 $\\mathrm{N/m}$；请确保您的表达式在量纲上与力每长度一致。不需要四舍五入。", "solution": "本问题要求计算由非保守随动荷载产生的外部切线矩阵 $\\mathbf{K}_{\\text{ext}}$ 的非对角项之差，$k_{12} - k_{21}$。该矩阵定义为外部节点力向量 $\\mathbf{f}_{\\text{ext}}$ 对节点位移向量 $\\mathbf{u}_2$ 的雅可比矩阵。\n\n首先，我们明确各个向量的定义。节点2处的位移向量为 $\\mathbf{u}_2 = \\begin{pmatrix} u_x \\\\ u_y \\end{pmatrix}$。\n节点2的当前坐标由向量 $\\mathbf{r} = \\begin{pmatrix} x \\\\ y \\end{pmatrix} = \\begin{pmatrix} L+u_x \\\\ u_y \\end{pmatrix}$ 给出。\n杆的当前长度为 $R = \\|\\mathbf{r}\\| = \\sqrt{x^2+y^2} = \\sqrt{(L+u_x)^2 + u_y^2}$。\n\n施加在节点2上的外部随动荷载向量 $\\mathbf{f}_{\\text{ext}}$ 由 $\\mathbf{f}_{\\text{ext}} = P\\,\\mathbf{n}$ 给出，其中单位法向量 $\\mathbf{n} = \\begin{pmatrix} -y/R \\\\ x/R \\end{pmatrix}$。\n将 $x$、$y$ 和 $R$ 的表达式代入，我们用力位移 $u_x$ 和 $u_y$ 表示力向量 $\\mathbf{f}_{\\text{ext}}$：\n$$\n\\mathbf{f}_{\\text{ext}} = \\begin{pmatrix} f_1 \\\\ f_2 \\end{pmatrix} = P \\begin{pmatrix} -u_y / \\sqrt{(L+u_x)^2 + u_y^2} \\\\ (L+u_x) / \\sqrt{(L+u_x)^2 + u_y^2} \\end{pmatrix} = \\frac{P}{R} \\begin{pmatrix} -y \\\\ x \\end{pmatrix}\n$$\n\n根据定义，外部切线矩阵 $\\mathbf{K}_{\\text{ext}}$ 是一个 $2 \\times 2$ 的雅可比矩阵：\n$$\n\\mathbf{K}_{\\text{ext}} = \\frac{\\partial \\mathbf{f}_{\\text{ext}}}{\\partial \\mathbf{u}_2} = \\begin{pmatrix} \\frac{\\partial f_1}{\\partial u_x} & \\frac{\\partial f_1}{\\partial u_y} \\\\ \\frac{\\partial f_2}{\\partial u_x} & \\frac{\\partial f_2}{\\partial u_y} \\end{pmatrix} = \\begin{pmatrix} k_{11} & k_{12} \\\\ k_{21} & k_{22} \\end{pmatrix}\n$$\n为了计算其分量，我们首先需要求出 $R$ 对 $u_x$ 和 $u_y$ 的偏导数：\n$$\n\\frac{\\partial R}{\\partial u_x} = \\frac{\\partial}{\\partial u_x} \\left( (L+u_x)^2 + u_y^2 \\right)^{1/2} = \\frac{1}{2R} \\cdot 2(L+u_x) = \\frac{L+u_x}{R} = \\frac{x}{R}\n$$\n$$\n\\frac{\\partial R}{\\partial u_y} = \\frac{\\partial}{\\partial u_y} \\left( (L+u_x)^2 + u_y^2 \\right)^{1/2} = \\frac{1}{2R} \\cdot 2u_y = \\frac{u_y}{R} = \\frac{y}{R}\n$$\n\n现在，我们计算非对角分量 $k_{12} = \\frac{\\partial f_1}{\\partial u_y}$ 和 $k_{21} = \\frac{\\partial f_2}{\\partial u_x}$。\n对于 $k_{12}$，我们有 $f_1 = -P \\frac{y}{R}$。使用除法法则求导：\n$$\nk_{12} = \\frac{\\partial}{\\partial u_y} \\left( -P \\frac{y}{R} \\right) = -P \\left( \\frac{(\\frac{\\partial y}{\\partial u_y})R - y(\\frac{\\partial R}{\\partial u_y})}{R^2} \\right)\n$$\n由于 $y=u_y$，我们有 $\\frac{\\partial y}{\\partial u_y} = 1$。代入此式以及 $\\frac{\\partial R}{\\partial u_y} = \\frac{y}{R}$：\n$$\nk_{12} = -P \\left( \\frac{1 \\cdot R - y \\cdot \\frac{y}{R}}{R^2} \\right) = -P \\left( \\frac{R^2 - y^2}{R^3} \\right) = -P \\frac{x^2}{R^3}\n$$\n\n对于 $k_{21}$，我们有 $f_2 = P \\frac{x}{R}$。再次使用除法法则：\n$$\nk_{21} = \\frac{\\partial}{\\partial u_x} \\left( P \\frac{x}{R} \\right) = P \\left( \\frac{(\\frac{\\partial x}{\\partial u_x})R - x(\\frac{\\partial R}{\\partial u_x})}{R^2} \\right)\n$$\n由于 $x=L+u_x$，我们有 $\\frac{\\partial x}{\\partial u_x} = 1$。代入此式以及 $\\frac{\\partial R}{\\partial u_x} = \\frac{x}{R}$：\n$$\nk_{21} = P \\left( \\frac{1 \\cdot R - x \\cdot \\frac{x}{R}}{R^2} \\right) = P \\left( \\frac{R^2 - x^2}{R^3} \\right) = P \\frac{y^2}{R^3}\n$$\n\n最后，我们计算差值 $k_{12} - k_{21}$：\n$$\nk_{12} - k_{21} = \\left( -P \\frac{x^2}{R^3} \\right) - \\left( P \\frac{y^2}{R^3} \\right) = -P \\frac{x^2 + y^2}{R^3}\n$$\n代入 $x^2 + y^2 = R^2$：\n$$\nk_{12} - k_{21} = -P \\frac{R^2}{R^3} = -\\frac{P}{R}\n$$\n将此结果用问题中指定的变量 $P$、$L$、$u_x$ 和 $u_y$ 表示，得到最终答案：\n$$\nk_{12} - k_{21} = -\\frac{P}{\\sqrt{(L+u_x)^2 + u_y^2}}\n$$\n此结果通常非零（因为 $P>0$），表明由随动荷载产生的外部切线刚度贡献 $\\mathbf{K}_{\\text{ext}}$ 是非对称的，这是非保守系统的一个关键特征。", "answer": "$$\n\\boxed{-\\frac{P}{\\sqrt{(L+u_x)^2 + u_y^2}}}\n$$", "id": "3591290"}, {"introduction": "将复杂的理论推导转化为可靠的计算程序，严格的验证是不可或缺的一环。在非线性有限元代码开发中，“切线检验”（tangent check）是确保求解器收敛性和正确性的黄金标准。本实践将指导你完成这一关键的验证过程：利用自动微分技术计算解析切线刚度矩阵，并将其与通过有限差分计算出的数值切线进行比较，从而确保你的本构模型实现是准确无误的。[@problem_id:3591268]", "problem": "考虑一个三维超弹性材料的单个积分点，其总势能密度由一个应变能函数 $\\Psi(I_1, I_2, J)$ 给出，其中 $I_1$ 和 $I_2$ 是右柯西-格林张量 $C = F^{\\mathsf T} F$ 的第一和第二主不变量，而 $J = \\det F$ 是变形梯度 $F$ 的雅可比行列式。内虚功根据虚功原理从第一性原理定义为 $\\delta W_{\\text{int}} = \\int_{\\Omega_0} P : \\delta F \\, \\mathrm{d}V$，其中 $P$ 是第一皮奥拉-基尔霍夫应力，$\\Omega_0$ 是参考构型。在具有有限广义自由度集 $u \\in \\mathbb{R}^n$ 和运动学映射 $F(u)$ 的离散化设定中，内虚功的形式为 $\\delta W_{\\text{int}}(u;\\delta u) = \\delta u^{\\mathsf T} f_{\\text{int}}(u)$，其中 $f_{\\text{int}}(u)$ 是内力向量。牛顿类方法所需的一致线性化是雅可比矩阵 $K(u) = \\dfrac{\\partial f_{\\text{int}}(u)}{\\partial u}$，它是内虚功对 $u$ 的导数。\n\n您的任务是从虚功原理和标准张量定义出发，推导并实现一个验证过程，证明通过对标量能量 $W(u) = \\int_{\\Omega_0} \\Psi(I_1, I_2, J) \\, \\mathrm{d}V$ 进行自动微分而解析计算出的一致线性化，与通过对 $f_{\\text{int}}(u) = \\dfrac{\\partial W(u)}{\\partial u}$ 进行有限差分计算出的数值切线相吻合。工作在单个材料点上，参考体积为单位体积，因此 $\\int_{\\Omega_0} (\\cdot) \\, \\mathrm{d}V = (\\cdot)$，并使用以下形式的运动学映射\n$$\nF(u) = I + \\sum_{a=1}^{n} u_a H_a,\n$$\n其中 $n=4$，常数基矩阵为\n$$\nH_1 = E_{11}, \\quad H_2 = E_{12}, \\quad H_3 = E_{22}, \\quad H_4 = E_{33},\n$$\n$E_{ij}$ 是在第 $i$ 行、第 $j$ 列处为1，其余位置为零的矩阵，而 $I$ 是单位矩阵。因此，\n$$\nF(u) =\n\\begin{bmatrix}\n1 + u_1 & u_2 & 0 \\\\\n0 & 1 + u_3 & 0 \\\\\n0 & 0 & 1 + u_4\n\\end{bmatrix}.\n$$\n\n使用以下不变量定义：\n- $C = F^{\\mathsf T} F$，\n- $I_1 = \\mathrm{tr}(C)$，\n- $I_2 = \\dfrac{1}{2}\\left( I_1^2 - \\mathrm{tr}(C^2) \\right)$，\n- $J = \\det(F)$。\n\n采用以下可压缩超弹性应变能密度\n$$\n\\Psi(I_1, I_2, J) = \\frac{\\mu}{2}(I_1 - 3) + \\frac{\\alpha}{2}(I_2 - 3) - \\mu \\ln J + \\frac{\\lambda}{2} (\\ln J)^2,\n$$\n材料参数为 $\\mu = 20000$，$\\lambda = 40000$ 和 $\\alpha = 5000$（单位：帕斯卡）。该点的总内能为 $W(u) = \\Psi(I_1(u), I_2(u), J(u))$。\n\n您必须：\n- 从虚功原理和上述定义出发，确定 $f_{\\text{int}}(u) = \\dfrac{\\partial W(u)}{\\partial u}$ 和 $K(u) = \\dfrac{\\partial^2 W(u)}{\\partial u^2}$。\n- 实现一个前向模式自动微分引擎，该引擎在给定的 $u$ 值处返回标量函数 $W(u)$ 相对于 $u$ 的梯度和海森矩阵。\n- 通过对 $f_{\\text{int}}(u)$ 应用中心差分法，以扰动 $h = 10^{-6}$ 计算数值切线矩阵 $K_{\\text{FD}}(u)$。\n- 对每个测试用例，验证 $K(u)$ 和 $K_{\\text{FD}}(u)$ 之间逐元素最大绝对差值低于容差 $\\varepsilon = 10^{-6}$。\n\n测试套件：\n- 用例 1（一般中等变形）：$u = [0.05, 0.02, -0.03, 0.04]$。\n- 用例 2（恒等变形）：$u = [0, 0, 0, 0]$。\n- 用例 3（纯剪切）：$u = [0, 0.1, 0, 0]$。\n- 用例 4（受压但容许的）：$u = [-0.4, 0.2, -0.3, -0.2]$。\n\n所有变形必须通过所选的 $u$ 和 $h$ 隐式满足 $J(u) > 0$。\n\n您的程序必须：\n- 对每个测试用例，通过自动微分计算 $K(u)$，并通过对 $f_{\\text{int}}(u)$ 进行中心差分计算 $K_{\\text{FD}}(u)$。\n- 对每个测试用例，计算标量差异 $d = \\max_{i,j} \\left| K_{ij}(u) - K_{\\text{FD},ij}(u) \\right|$ 并生成一个布尔值，指示是否满足 $d \\le \\varepsilon$。\n- 生成单行输出，包含以逗号分隔并用方括号括起来的结果列表（例如，\"[True,True,False,True]\"）。\n\n不应需要外部输入。输出中不需要物理单位，因为请求的输出是布尔值。未使用角度，因此不需要指定角度单位。", "solution": "该问题要求在单个点上验证一个超弹性材料模型的一致切线刚度矩阵。这是计算固体力学中的一个基本步骤，以确保依赖此矩阵的迭代牛顿-拉夫森求解器将表现出二次收敛性。该验证过程将从材料势能导出的解析切线矩阵与通过有限差分计算的数值近似值进行比较。\n\n我们从虚功原理开始，该原理指出内虚功 $\\delta W_{\\text{int}}$ 由下式给出\n$$\n\\delta W_{\\text{int}} = \\int_{\\Omega_0} P : \\delta F \\, \\mathrm{d}V,\n$$\n其中 $P$ 是第一皮奥拉-基尔霍夫应力张量，$F$ 是变形梯度，$\\Omega_0$ 是材料的参考构型。应力 $P$ 通过本构关系与应变能密度函数 $\\Psi$ 相关联，$P = \\dfrac{\\partial \\Psi}{\\partial F}$。总势能 $W$ 是应变能密度的积分，$W = \\int_{\\Omega_0} \\Psi \\, \\mathrm{d}V$。因此，内虚功是总势能的一阶变分，$\\delta W_{\\text{int}} = \\delta W$。\n\n在一个由广义坐标 $u \\in \\mathbb{R}^n$ 参数化的离散系统中，变形梯度成为一个函数 $F(u)$。总势能是一个标量函数 $W(u)$。变分 $\\delta W$ 可以使用链式法则表示：\n$$\n\\delta W(u; \\delta u) = \\frac{\\partial W(u)}{\\partial u} \\cdot \\delta u = \\sum_{a=1}^{n} \\frac{\\partial W(u)}{\\partial u_a} \\delta u_a.\n$$\n根据定义，内虚功也用内力向量 $f_{\\text{int}}(u)$ 表示：\n$$\n\\delta W_{\\text{int}}(u; \\delta u) = f_{\\text{int}}(u)^{\\mathsf{T}} \\delta u = \\sum_{a=1}^{n} f_{\\text{int},a}(u) \\delta u_a.\n$$\n比较这两个表达式揭示了内力向量和势能之间的基本关系：\n$$\nf_{\\text{int}}(u) = \\frac{\\partial W(u)}{\\partial u} = \\nabla_u W(u).\n$$\n内力向量是总势能相对于离散自由度的梯度。\n\n牛顿类求解器所需的一致线性化是切线刚度矩阵 $K(u)$。它被定义为内力向量的雅可比矩阵：\n$$\nK(u) = \\frac{\\partial f_{\\text{int}}(u)}{\\partial u}.\n$$\n代入 $f_{\\text{int}}(u)$ 的表达式，我们发现切线刚度矩阵是总势能的海森矩阵：\n$$\nK(u) = \\frac{\\partial}{\\partial u} \\left( \\frac{\\partial W(u)}{\\partial u} \\right) = \\frac{\\partial^2 W(u)}{\\partial u^2} = \\nabla_u^2 W(u).\n$$\n问题简化为单位体积的单个点，因此 $W(u) = \\Psi(u)$。任务是计算 $W(u)$ 的梯度 $f_{\\text{int}}(u)$ 和海森矩阵 $K(u)$，并验证它们之间的关系。\n\n为了计算解析导数，我们采用前向模式自动微分（AD）。该技术通过在计算的每一步中传播函数值及其导数，来同时计算它们。我们定义一个自定义数据类型 `ADVar`，它存储函数的值、其梯度向量和其海森矩阵。对于标量函数 $g(u)$，其在点 $u_0$ 的 `ADVar` 表示将是元组 $(g(u_0), \\nabla_u g(u_0), \\nabla_u^2 g(u_0))$。然后我们重载算术运算符（$+$、$-$、$*$、$/$）和初等函数（$\\ln$），以根据微积分法则对这些元组进行操作。例如，对于两个函数 $g(u)$ 和 $h(u)$，它们的乘积 $p(u) = g(u)h(u)$ 的法则是：\n- 值：$p = gh$\n- 梯度：$\\nabla p = (\\nabla g)h + g(\\nabla h)$\n- 海森矩阵：$\\nabla^2 p = (\\nabla^2 g)h + g(\\nabla^2 h) + (\\nabla g)(\\nabla h)^{\\mathsf{T}} + (\\nabla h)(\\nabla g)^{\\mathsf{T}}$\n\n使用 AD 的计算过程如下：\n1.  将自变量 $u_a$ 初始化为 `ADVar` 对象：$u_a \\rightarrow (u_a, e_a, 0)$，其中 $e_a$ 是第 $a$ 个标准基向量，$0$ 是一个零矩阵。\n2.  使用给定的运动学映射，将变形梯度矩阵 $F(u)$ 构建为一个 `ADVar` 对象矩阵：\n    $$\n    F(u) =\n    \\begin{bmatrix}\n    1 + u_1 & u_2 & 0 \\\\\n    0 & 1 + u_3 & 0 \\\\\n    0 & 0 & 1 + u_4\n    \\end{bmatrix}.\n    $$\n    每个条目都是对初始 $u_a$ `ADVar`进行运算后得到的 `ADVar`。\n3.  计算右柯西-格林张量 $C = F^{\\mathsf T} F$。这个矩阵乘法在 `ADVar` 对象上执行，自动传播值、梯度和海森矩阵。\n4.  计算不变量 $I_1 = \\mathrm{tr}(C)$，$I_2 = \\frac{1}{2}(I_1^2 - \\mathrm{tr}(C^2))$ 和 $J = \\det(F)$。这些操作也在 `ADVar` 上执行。\n5.  使用给定的材料参数评估应变能函数 $\\Psi(I_1, I_2, J)$。最终结果是一个 `ADVar` 对象，其分量是总能量 $W(u)$、内力向量 $f_{\\text{int}}(u)$ 和切线刚度矩阵 $K(u)$。\n\n为了验证这个解析切线矩阵 $K(u)$，我们使用中心有限差分法计算一个数值切线矩阵 $K_{\\text{FD}}(u)$。该方法近似 $f_{\\text{int}}(u)$ 的雅可比矩阵的各列。$K_{\\text{FD}}(u)$ 的第 $j$ 列由下式给出：\n$$\nK_{\\text{FD}, \\cdot j}(u) = \\frac{f_{\\text{int}}(u + h e_j) - f_{\\text{int}}(u - h e_j)}{2h},\n$$\n其中 $e_j$ 是第 $j$ 个标准基向量，$h$ 是一个小扰动。此公式中使用的函数 $f_{\\text{int}}$ 是从我们的 AD 计算中获得的梯度分量。\n\n验证包括对每个测试用例比较解析切线矩阵 $K(u)$ 和数值切线矩阵 $K_{\\text{FD}}(u)$。计算最大逐元素绝对差值 $d = \\max_{i,j} | K_{ij}(u) - K_{\\text{FD},ij}(u) |$，并与一个小容差 $\\varepsilon = 10^{-6}$ 进行核对。成功的核对（$d \\le \\varepsilon$）确认了解析导数实现的正确性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Note: The problem statement allows for scipy, but it is not used in this implementation\n# as all necessary components (AD, FD) are built from first principles using numpy.\n\ndef solve():\n    \"\"\"\n    Main function to perform the tangent stiffness verification for all test cases.\n    \"\"\"\n\n    class ADVar:\n        \"\"\"\n        A class for forward-mode automatic differentiation up to the second order (Hessian).\n        An ADVar object stores a value, its gradient, and its Hessian with respect to\n        a set of independent variables.\n        \"\"\"\n        def __init__(self, val, grad=None, hess=None, n_vars=4):\n            self.val = float(val)\n            self.n_vars = n_vars\n            \n            if grad is None:\n                self.grad = np.zeros(self.n_vars)\n            else:\n                self.grad = np.array(grad, dtype=float)\n\n            if hess is None:\n                self.hess = np.zeros((self.n_vars, self.n_vars))\n            else:\n                self.hess = np.array(hess, dtype=float)\n\n        def __repr__(self):\n            return f\"ADVar(val={self.val})\"\n\n        def __add__(self, other):\n            if isinstance(other, ADVar):\n                val = self.val + other.val\n                grad = self.grad + other.grad\n                hess = self.hess + other.hess\n                return ADVar(val, grad, hess, self.n_vars)\n            else:\n                return ADVar(self.val + other, self.grad, self.hess, self.n_vars)\n\n        def __radd__(self, other):\n            return self.__add__(other)\n\n        def __sub__(self, other):\n            if isinstance(other, ADVar):\n                val = self.val - other.val\n                grad = self.grad - other.grad\n                hess = self.hess - other.hess\n                return ADVar(val, grad, hess, self.n_vars)\n            else:\n                return ADVar(self.val - other, self.grad, self.hess, self.n_vars)\n\n        def __rsub__(self, other):\n            val = other - self.val\n            grad = -self.grad\n            hess = -self.hess\n            return ADVar(val, grad, hess, self.n_vars)\n\n        def __mul__(self, other):\n            if isinstance(other, ADVar):\n                val = self.val * other.val\n                grad = self.val * other.grad + other.val * self.grad\n                hess = (self.val * other.hess + other.val * self.hess +\n                        np.outer(self.grad, other.grad) + np.outer(other.grad, self.grad))\n                return ADVar(val, grad, hess, self.n_vars)\n            else:\n                return ADVar(self.val * other, self.grad * other, self.hess * other, self.n_vars)\n\n        def __rmul__(self, other):\n            return self.__mul__(other)\n        \n        def __pow__(self, power):\n            if power == 2: # Specific optimization for x^2\n                return self * self\n            val = self.val ** power\n            grad = power * (self.val ** (power - 1)) * self.grad\n            hess = power * (self.val ** (power - 1)) * self.hess + \\\n                   power * (power - 1) * (self.val ** (power - 2)) * np.outer(self.grad, self.grad)\n            return ADVar(val, grad, hess, self.n_vars)\n\n        def __neg__(self):\n            return ADVar(-self.val, -self.grad, -self.hess, self.n_vars)\n\n    def ad_log(x: ADVar):\n        \"\"\" Logarithm function for ADVar \"\"\"\n        if not isinstance(x, ADVar):\n            return np.log(x)\n        val = np.log(x.val)\n        grad = (1.0 / x.val) * x.grad\n        hess = (1.0 / x.val) * x.hess - (1.0 / x.val**2) * np.outer(x.grad, x.grad)\n        return ADVar(val, grad, hess, x.n_vars)\n\n    # Material Parameters\n    mu = 20000.0\n    alpha = 5000.0\n    lambda_ = 40000.0\n    \n    def compute_energy_grad_hess(u_vec):\n        \"\"\"\n        Computes the energy, internal force (gradient), and tangent stiffness (Hessian)\n        for a given displacement vector u_vec using Automatic Differentiation.\n        \"\"\"\n        n_vars = len(u_vec)\n        \n        u_ad = []\n        for i in range(n_vars):\n            grad_vec = np.zeros(n_vars)\n            grad_vec[i] = 1.0\n            u_ad.append(ADVar(u_vec[i], grad=grad_vec, n_vars=n_vars))\n\n        F = np.array([\n            [ADVar(1.0, n_vars=n_vars), ADVar(0.0, n_vars=n_vars), ADVar(0.0, n_vars=n_vars)],\n            [ADVar(0.0, n_vars=n_vars), ADVar(1.0, n_vars=n_vars), ADVar(0.0, n_vars=n_vars)],\n            [ADVar(0.0, n_vars=n_vars), ADVar(0.0, n_vars=n_vars), ADVar(1.0, n_vars=n_vars)]\n        ], dtype=object)\n\n        F[0, 0] += u_ad[0]\n        F[0, 1] += u_ad[1]\n        F[1, 1] += u_ad[2]\n        F[2, 2] += u_ad[3]\n\n        C = F.T @ F\n        C2 = C @ C\n        \n        I1 = np.trace(C)\n        tr_C2 = np.trace(C2)\n        I2 = 0.5 * (I1**2 - tr_C2)\n        \n        J = F[0, 0] * F[1, 1] * F[2, 2]\n\n        # Strain-energy function\n        ln_J = ad_log(J)\n        Psi = (mu / 2.0) * (I1 - 3.0) + \\\n              (alpha / 2.0) * (I2 - 3.0) - \\\n              mu * ln_J + \\\n              (lambda_ / 2.0) * (ln_J**2)\n\n        return Psi.val, Psi.grad, Psi.hess\n\n    def compute_fd_hessian(u_vec, h=1e-6):\n        \"\"\"\n        Computes the tangent stiffness (Hessian) using centered finite differences\n        of the internal force vector (gradient).\n        \"\"\"\n        n_vars = len(u_vec)\n        K_fd = np.zeros((n_vars, n_vars))\n        \n        def get_f_int(u):\n            _, grad, _ = compute_energy_grad_hess(u)\n            return grad\n\n        for j in range(n_vars):\n            e_j = np.zeros(n_vars)\n            e_j[j] = 1.0\n            \n            u_plus = u_vec + h * e_j\n            u_minus = u_vec - h * e_j\n            \n            f_plus = get_f_int(u_plus)\n            f_minus = get_f_int(u_minus)\n            \n            K_fd[:, j] = (f_plus - f_minus) / (2.0 * h)\n            \n        return K_fd\n\n    test_cases = [\n        np.array([0.05, 0.02, -0.03, 0.04]),\n        np.array([0.0, 0.0, 0.0, 0.0]),\n        np.array([0.0, 0.1, 0.0, 0.0]),\n        np.array([-0.4, 0.2, -0.3, -0.2]),\n    ]\n    \n    tolerance = 1e-6\n    results = []\n\n    for u_test in test_cases:\n        _, _, K_ad = compute_energy_grad_hess(u_test)\n        K_fd = compute_fd_hessian(u_test)\n        \n        discrepancy = np.max(np.abs(K_ad - K_fd))\n        results.append(discrepancy = tolerance)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3591268"}]}