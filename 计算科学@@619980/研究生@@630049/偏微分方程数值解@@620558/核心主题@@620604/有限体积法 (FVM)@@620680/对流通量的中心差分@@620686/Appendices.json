{"hands_on_practices": [{"introduction": "对流项的中心差分是一种直观的离散化方法，但其性质需要仔细审视。傅里叶分析是检验数值格式行为的有力工具，它能揭示格式如何处理不同波长的分量。通过将中心差分应用于单个正弦波，我们可以推导出其离散导数，并与精确解对比，从而揭示该格式的色散特性，即不同频率的波以不同的错误速度传播的现象。[@problem_id:3369209]", "problem": "考虑一个定义在周期性域上、具有恒定速度 $a>0$ 的一维线性平流偏微分方程 (PDE) $\\frac{\\partial \\phi}{\\partial t} + \\frac{\\partial (a \\phi)}{\\partial x} = 0$。在一个单元中心位于 $x_i$、间距为 $\\Delta x>0$ 的均匀网格上，使用有限体积法 (FVM)，将面 $i+\\tfrac{1}{2}$ 处的对流面通量定义为 $F_{i+\\tfrac{1}{2}} = a\\,\\phi_{i+\\tfrac{1}{2}}$，其中面上的值 $\\phi_{i+\\tfrac{1}{2}}$ 由中心插值 $\\phi_{i+\\tfrac{1}{2}} = \\tfrac{1}{2}(\\phi_i + \\phi_{i+1})$ 给出；对于 $i-\\tfrac{1}{2}$ 也类似。单元守恒中的半离散对流项为 $\\left(F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}\\right)/\\Delta x$。\n\n假设单元中心解是一个单一傅里叶模态 $\\phi_i = \\sin(k x_i)$，其中 $k$ 是一个实数波数。从上述定义的守恒律单元守恒和中心插值出发，推导以下各项的闭式表达式：\n- 中心面通量 $F_{i-\\tfrac{1}{2}}$ 和 $F_{i+\\tfrac{1}{2}}$，以及\n- 单元 $i$ 处得到的离散对流项 $C_i = \\left(F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}\\right)/\\Delta x$，\n\n所有表达式仅用 $a$、$k$、$x_i$ 和 $\\Delta x$ 表示。\n\n将你的最终答案表示为顺序为 $\\big[F_{i-\\tfrac{1}{2}},\\,F_{i+\\tfrac{1}{2}},\\,C_i\\big]$ 的单行矩阵。无需单位。无需数值取整；请提供精确的闭式表达式。", "solution": "该问题被验证为具有科学依据、适定、客观和完整。提供了对线性平流方程进行有限体积法离散化所需的所有必要定义。该任务是数值分析中的一个标准练习，特别是对数值格式的傅里叶分析。\n\n该问题要求针对一维线性平流方程，推导面通量 $F_{i-\\tfrac{1}{2}}$ 和 $F_{i+\\tfrac{1}{2}}$，以及由此产生的离散对流项 $C_i$。推导过程基于给定的定义。\n\n控制偏微分方程为：\n$$ \\frac{\\partial \\phi}{\\partial t} + \\frac{\\partial (a \\phi)}{\\partial x} = 0 $$\n其中 $a > 0$ 是一个恒定速度。\n\n网格点 $i$ 处的单元中心解被给定为单一傅里叶模态：\n$$ \\phi_i = \\sin(k x_i) $$\n其中 $k$ 是波数，$x_i$ 是单元中心 $i$ 的坐标。网格是均匀的，间距为 $\\Delta x > 0$，因此相邻单元中心的坐标为 $x_{i+1} = x_i + \\Delta x$ 和 $x_{i-1} = x_i - \\Delta x$。\n\n因此，在相邻单元中心处解的值为：\n$$ \\phi_{i+1} = \\sin(k x_{i+1}) = \\sin(k(x_i + \\Delta x)) $$\n$$ \\phi_{i-1} = \\sin(k x_{i-1}) = \\sin(k(x_i - \\Delta x)) $$\n\n首先，我们推导面通量 $F_{i+\\tfrac{1}{2}}$ 的表达式。\n面 $i+\\tfrac{1}{2}$ 处的对流通量定义为 $F_{i+\\tfrac{1}{2}} = a\\,\\phi_{i+\\tfrac{1}{2}}$。面上的值 $\\phi_{i+\\tfrac{1}{2}}$ 通过中心插值得到：\n$$ \\phi_{i+\\tfrac{1}{2}} = \\frac{1}{2}(\\phi_i + \\phi_{i+1}) $$\n代入 $\\phi_i$ 和 $\\phi_{i+1}$ 的表达式：\n$$ \\phi_{i+\\tfrac{1}{2}} = \\frac{1}{2} \\left[ \\sin(k x_i) + \\sin(k(x_i + \\Delta x)) \\right] $$\n我们使用和化积三角恒等式 $\\sin(A) + \\sin(B) = 2 \\sin\\left(\\frac{A+B}{2}\\right) \\cos\\left(\\frac{A-B}{2}\\right)$。令 $A = k(x_i + \\Delta x)$ 和 $B = k x_i$。\n$$ \\frac{A+B}{2} = \\frac{k x_i + k \\Delta x + k x_i}{2} = k x_i + \\frac{k \\Delta x}{2} $$\n$$ \\frac{A-B}{2} = \\frac{k x_i + k \\Delta x - k x_i}{2} = \\frac{k \\Delta x}{2} $$\n应用该恒等式，我们得到：\n$$ \\sin(k x_i) + \\sin(k(x_i + \\Delta x)) = 2 \\sin\\left(k x_i + \\frac{k \\Delta x}{2}\\right) \\cos\\left(\\frac{k \\Delta x}{2}\\right) $$\n将此代回 $\\phi_{i+\\tfrac{1}{2}}$ 的表达式中：\n$$ \\phi_{i+\\tfrac{1}{2}} = \\frac{1}{2} \\left[ 2 \\sin\\left(k x_i + \\frac{k \\Delta x}{2}\\right) \\cos\\left(\\frac{k \\Delta x}{2}\\right) \\right] = \\cos\\left(\\frac{k \\Delta x}{2}\\right) \\sin\\left(k x_i + \\frac{k \\Delta x}{2}\\right) $$\n于是通量为：\n$$ F_{i+\\tfrac{1}{2}} = a\\,\\phi_{i+\\tfrac{1}{2}} = a \\cos\\left(\\frac{k \\Delta x}{2}\\right) \\sin\\left(k x_i + \\frac{k \\Delta x}{2}\\right) $$\n\n接下来，我们推导面通量 $F_{i-\\tfrac{1}{2}}$ 的表达式。\n过程是类似的。通量为 $F_{i-\\tfrac{1}{2}} = a\\,\\phi_{i-\\tfrac{1}{2}}$，其面上的值由以下公式给出：\n$$ \\phi_{i-\\tfrac{1}{2}} = \\frac{1}{2}(\\phi_{i-1} + \\phi_i) $$\n代入 $\\phi_{i-1}$ 和 $\\phi_i$ 的表达式：\n$$ \\phi_{i-\\tfrac{1}{2}} = \\frac{1}{2} \\left[ \\sin(k(x_i - \\Delta x)) + \\sin(k x_i) \\right] $$\n使用相同的和化积恒等式，令 $A = k x_i$ 和 $B = k(x_i - \\Delta x)$：\n$$ \\frac{A+B}{2} = \\frac{k x_i + k x_i - k \\Delta x}{2} = k x_i - \\frac{k \\Delta x}{2} $$\n$$ \\frac{A-B}{2} = \\frac{k x_i - (k x_i - k \\Delta x)}{2} = \\frac{k \\Delta x}{2} $$\n应用该恒等式：\n$$ \\sin(k(x_i - \\Delta x)) + \\sin(k x_i) = 2 \\sin\\left(k x_i - \\frac{k \\Delta x}{2}\\right) \\cos\\left(\\frac{k \\Delta x}{2}\\right) $$\n将此代回：\n$$ \\phi_{i-\\tfrac{1}{2}} = \\frac{1}{2} \\left[ 2 \\sin\\left(k x_i - \\frac{k \\Delta x}{2}\\right) \\cos\\left(\\frac{k \\Delta x}{2}\\right) \\right] = \\cos\\left(\\frac{k \\Delta x}{2}\\right) \\sin\\left(k x_i - \\frac{k \\Delta x}{2}\\right) $$\n于是通量为：\n$$ F_{i-\\tfrac{1}{2}} = a\\,\\phi_{i-\\tfrac{1}{2}} = a \\cos\\left(\\frac{k \\Delta x}{2}\\right) \\sin\\left(k x_i - \\frac{k \\Delta x}{2}\\right) $$\n\n最后，我们推导离散对流项 $C_i$。\n该项被定义为单元体积上的通量散度：\n$$ C_i = \\frac{F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}}{\\Delta x} $$\n代入推导出的通量表达式：\n$$ C_i = \\frac{a}{\\Delta x} \\left[ \\cos\\left(\\frac{k \\Delta x}{2}\\right) \\sin\\left(k x_i + \\frac{k \\Delta x}{2}\\right) - \\cos\\left(\\frac{k \\Delta x}{2}\\right) \\sin\\left(k x_i - \\frac{k \\Delta x}{2}\\right) \\right] $$\n提取公因式 $a \\cos\\left(\\frac{k \\Delta x}{2}\\right)$：\n$$ C_i = \\frac{a \\cos\\left(\\frac{k \\Delta x}{2}\\right)}{\\Delta x} \\left[ \\sin\\left(k x_i + \\frac{k \\Delta x}{2}\\right) - \\sin\\left(k x_i - \\frac{k \\Delta x}{2}\\right) \\right] $$\n现在我们使用差化积三角恒等式 $\\sin(A) - \\sin(B) = 2 \\cos\\left(\\frac{A+B}{2}\\right) \\sin\\left(\\frac{A-B}{2}\\right)$。令 $A = k x_i + \\frac{k \\Delta x}{2}$ 和 $B = k x_i - \\frac{k \\Delta x}{2}$。\n$$ \\frac{A+B}{2} = \\frac{k x_i + \\frac{k \\Delta x}{2} + k x_i - \\frac{k \\Delta x}{2}}{2} = k x_i $$\n$$ \\frac{A-B}{2} = \\frac{k x_i + \\frac{k \\Delta x}{2} - (k x_i - \\frac{k \\Delta x}{2})}{2} = \\frac{k \\Delta x}{2} $$\n应用该恒等式，括号中的项变为：\n$$ \\sin\\left(k x_i + \\frac{k \\Delta x}{2}\\right) - \\sin\\left(k x_i - \\frac{k \\Delta x}{2}\\right) = 2 \\cos(k x_i) \\sin\\left(\\frac{k \\Delta x}{2}\\right) $$\n将此代入 $C_i$ 的表达式中：\n$$ C_i = \\frac{a \\cos\\left(\\frac{k \\Delta x}{2}\\right)}{\\Delta x} \\left[ 2 \\cos(k x_i) \\sin\\left(\\frac{k \\Delta x}{2}\\right) \\right] $$\n重新整理各项：\n$$ C_i = \\frac{a}{\\Delta x} \\left[ 2 \\sin\\left(\\frac{k \\Delta x}{2}\\right) \\cos\\left(\\frac{k \\Delta x}{2}\\right) \\right] \\cos(k x_i) $$\n使用正弦的二倍角恒等式 $\\sin(2\\theta) = 2 \\sin(\\theta) \\cos(\\theta)$，其中 $\\theta = \\frac{k \\Delta x}{2}$：\n$$ 2 \\sin\\left(\\frac{k \\Delta x}{2}\\right) \\cos\\left(\\frac{k \\Delta x}{2}\\right) = \\sin\\left(2 \\cdot \\frac{k \\Delta x}{2}\\right) = \\sin(k \\Delta x) $$\n$C_i$ 的最终表达式是：\n$$ C_i = \\frac{a \\sin(k \\Delta x)}{\\Delta x} \\cos(k x_i) $$\n\n所求的三个表达式为：\n1.  $F_{i-\\tfrac{1}{2}} = a \\cos\\left(\\frac{k \\Delta x}{2}\\right) \\sin\\left(k x_i - \\frac{k \\Delta x}{2}\\right)$\n2.  $F_{i+\\tfrac{1}{2}} = a \\cos\\left(\\frac{k \\Delta x}{2}\\right) \\sin\\left(k x_i + \\frac{k \\Delta x}{2}\\right)$\n3.  $C_i = \\frac{a \\sin(k \\Delta x)}{\\Delta x} \\cos(k x_i)$", "answer": "$$\n\\boxed{\\begin{pmatrix} a \\cos\\left(\\frac{k \\Delta x}{2}\\right) \\sin\\left(k x_i - \\frac{k \\Delta x}{2}\\right)  a \\cos\\left(\\frac{k \\Delta x}{2}\\right) \\sin\\left(k x_i + \\frac{k \\Delta x}{2}\\right)  \\frac{a \\sin(k \\Delta x)}{\\Delta x} \\cos(k x_i) \\end{pmatrix}}\n$$", "id": "3369209"}, {"introduction": "理论分析揭示了中心差分格式的色散误差，但在实际应用中，其更大的问题在于面对急剧变化（如阶跃或激波）时会产生非物理振荡。本练习将从光滑的正弦波转向一个包含不连续的瞬态平流问题。通过计算单个时间步后的解，我们将亲眼见证中心差分格式如何在其初始值范围之外凭空制造出虚假的“过冲”（overshoots）和“下冲”（undershoots），这在物理上是不可能发生的。[@problem_id:3369239]", "problem": "考虑一个被动标量的线性平流（对流）方程，\n$$\n\\frac{\\partial \\phi}{\\partial t} + a \\frac{\\partial \\phi}{\\partial x} = 0,\n$$\n其中平流速度 $a0$ 为常数，作用于一个均匀网格上，网格单元中心为 $x_i = i\\,\\Delta x$，$i \\in \\mathbb{Z}$。采用守恒有限体积离散化方法，在界面处使用中心插值计算对流通量，并采用前向欧拉法进行时间积分。具体来说，通过相邻单元中心值的算术平均值来近似界面值，并向前推进一个大小为 $\\Delta t$ 的显式时间步。\n\n初始条件是在单元 $i=0$ 和 $i=1$ 之间的界面 $x_{1/2} = \\Delta x/2$ 处的一个单一间断阶跃：\n$$\n\\phi(x,0) = \\begin{cases}\n\\phi_L,  x  \\Delta x/2,\\\\\n\\phi_R,  x > \\Delta x/2,\n\\end{cases}\n$$\n其中 $\\phi_L = 1$ 且 $\\phi_R = 0$。\n\n设库朗数（也称为 Courant–Friedrichs–Lewy (CFL) 数）为\n$$\nC \\equiv \\frac{a\\,\\Delta t}{\\Delta x} = \\frac{7}{10}.\n$$\n\n仅使用控制守恒定律、所述的离散化选择以及给定的初始数据，确定在一个时间步后，由中心离散化引入的、超出初始最大值的第一个伪超调的幅度和位置。将“幅度”定义为更新值超过 $\\max(\\phi_L,\\phi_R)$ 的量，将“位置”定义为发生这第一个超调的单元索引 $i$。以行向量 $\\big(i,\\ \\text{magnitude}\\big)$ 的形式报告您的最终答案，使用精确值，不要四舍五入。不需要物理单位。", "solution": "该问题是有效的，因为它在科学上基于偏微分方程的数值分析，对于单个时间步是适定的，并且所有术语和条件都已明确指定，没有歧义或矛盾。\n\n控制方程是一维空间中的线性平流方程，\n$$\n\\frac{\\partial \\phi}{\\partial t} + a \\frac{\\partial \\phi}{\\partial x} = 0,\n$$\n其中 $\\phi = \\phi(x,t)$ 是一个标量，而 $a  0$ 是一个恒定的平流速度。\n\n我们在一个单元宽度为 $\\Delta x$ 的均匀网格上使用守恒有限体积法。单元中心位于 $x_i = i\\,\\Delta x$。单元 $i$ 覆盖区间 $[x_{i-1/2}, x_{i+1/2}]$，其中 $x_{i+1/2} = (i+1/2)\\,\\Delta x$。在时间 $t$，单元 $i$ 中 $\\phi$ 的单元平均值记为 $\\phi_i(t)$。对控制方程在单元 $i$ 上积分，得到单元平均值的精确守恒定律：\n$$\n\\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\phi(x,t) dx + [a\\phi(x,t)]_{x_{i-1/2}}^{x_{i+1/2}} = 0.\n$$\n用单元平均值 $\\phi_i = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\phi(x,t) dx$ 来表示，该式变为：\n$$\n\\frac{d\\phi_i}{dt} + \\frac{a}{\\Delta x} (\\phi_{i+1/2} - \\phi_{i-1/2}) = 0,\n$$\n其中 $\\phi_{i \\pm 1/2}$ 表示在单元界面处 $\\phi$ 的值。\n\n问题指定了对流通量采用中心插值。这意味着单元界面上的值由相邻两个单元中的值的算术平均值来近似：\n$$\n\\phi_{i+1/2} \\approx \\frac{\\phi_i + \\phi_{i+1}}{2}.\n$$\n将此近似代入半离散方程，得到：\n$$\n\\frac{d\\phi_i}{dt} + \\frac{a}{\\Delta x} \\left( \\frac{\\phi_i + \\phi_{i+1}}{2} - \\frac{\\phi_{i-1} + \\phi_i}{2} \\right) = 0,\n$$\n这可以简化为对空间导数的标准中心差分近似：\n$$\n\\frac{d\\phi_i}{dt} + \\frac{a}{2\\Delta x} (\\phi_{i+1} - \\phi_{i-1}) = 0.\n$$\n接下来，我们应用前向欧拉法进行时间积分。设 $\\phi_i^n$ 是在时间 $t_n = n\\,\\Delta t$ 时 $\\phi_i$ 的近似值。时间导数近似为：\n$$\n\\frac{\\phi_i^{n+1} - \\phi_i^n}{\\Delta t} = - \\frac{a}{2\\Delta x} (\\phi_{i+1}^n - \\phi_{i-1}^n).\n$$\n对 $\\phi_i^{n+1}$ 进行整理，我们得到全离散的更新格式：\n$$\n\\phi_i^{n+1} = \\phi_i^n - \\frac{a\\Delta t}{2\\Delta x} (\\phi_{i+1}^n - \\phi_{i-1}^n).\n$$\n使用库朗数的定义 $C \\equiv \\frac{a\\Delta t}{\\Delta x}$，更新格式为：\n$$\n\\phi_i^{n+1} = \\phi_i^n - \\frac{C}{2} (\\phi_{i+1}^n - \\phi_{i-1}^n).\n$$\n问题给出的初始条件是一个阶跃函数：\n$$\n\\phi(x,0) = \\begin{cases}\n1,  x  \\frac{\\Delta x}{2},\\\\\n0,  x > \\frac{\\Delta x}{2}.\n\\end{cases}\n$$\n间断点位于单元 $i=0$ 和单元 $i=1$ 之间的界面 $x_{1/2} = \\frac{\\Delta x}{2}$ 处。我们通过对每个单元上的 $\\phi(x,0)$ 进行积分来确定初始的单元平均值 $\\phi_i^0$：\n对于任何索引 $i \\le 0$ 的单元，其区域 $[(i-\\frac{1}{2})\\Delta x, (i+\\frac{1}{2})\\Delta x]$ 完全位于 $x  \\frac{\\Delta x}{2}$ 的区域内。因此，对于 $i \\le 0$：\n$$\n\\phi_i^0 = \\frac{1}{\\Delta x} \\int_{(i-1/2)\\Delta x}^{(i+1/2)\\Delta x} 1 \\, dx = 1.\n$$\n对于任何索引 $i \\ge 1$ 的单元，其区域 $[(i-\\frac{1}{2})\\Delta x, (i+\\frac{1}{2})\\Delta x]$ 完全位于 $x > \\frac{\\Delta x}{2}$ 的区域内。因此，对于 $i \\ge 1$：\n$$\n\\phi_i^0 = \\frac{1}{\\Delta x} \\int_{(i-1/2)\\Delta x}^{(i+1/2)\\Delta x} 0 \\, dx = 0.\n$$\n所以，在 $n=0$ 时的离散初始状态为：\n$$\n\\phi_i^0 = \\begin{cases}\n1,  i \\le 0, \\\\\n0,  i \\ge 1.\n\\end{cases}\n$$\n现在我们使用 $C=\\frac{7}{10}$ 计算下一个时间步 $n=1$ 时的解。\n$$\n\\phi_i^1 = \\phi_i^0 - \\frac{1}{2} \\left(\\frac{7}{10}\\right) (\\phi_{i+1}^0 - \\phi_{i-1}^0) = \\phi_i^0 - \\frac{7}{20} (\\phi_{i+1}^0 - \\phi_{i-1}^0).\n$$\n我们对每个单元索引 $i$ 计算 $\\phi_i^1$：\n- 对于 $i \\le -1$：$\\phi_{i-1}^0 = 1$，$\\phi_i^0 = 1$，$\\phi_{i+1}^0 = 1$。\n  $$\n  \\phi_i^1 = 1 - \\frac{7}{20}(1 - 1) = 1.\n  $$\n- 对于 $i=0$：$\\phi_{-1}^0=1$，$\\phi_0^0=1$，$\\phi_1^0=0$。\n  $$\n  \\phi_0^1 = 1 - \\frac{7}{20}(0 - 1) = 1 + \\frac{7}{20} = \\frac{27}{20}.\n  $$\n- 对于 $i=1$：$\\phi_0^0=1$，$\\phi_1^0=0$，$\\phi_2^0=0$。\n  $$\n  \\phi_1^1 = 0 - \\frac{7}{20}(0 - 1) = \\frac{7}{20}.\n  $$\n- 对于 $i \\ge 2$：$\\phi_{i-1}^0 = 0$，$\\phi_i^0 = 0$，$\\phi_{i+1}^0 = 0$。\n  $$\n  \\phi_i^1 = 0 - \\frac{7}{20}(0 - 0) = 0.\n  $$\n初始最大值为 $\\max(\\phi_L, \\phi_R) = \\max(1, 0) = 1$。问题将超调定义为超过此最大值的值。\n更新后的值为：\n$$\n\\phi_i^1 = \\begin{cases}\n1,  i \\le -1, \\\\\n\\frac{27}{20},  i = 0, \\\\\n\\frac{7}{20},  i = 1, \\\\\n0,  i \\ge 2.\n\\end{cases}\n$$\n值 $\\phi_0^1 = \\frac{27}{20} = 1.35$ 大于 $1$。这是一个超调。\n值 $\\phi_1^1 = \\frac{7}{20} = 0.35$，在初始范围 $[0, 1]$ 内。所有其他值均为 $0$ 或 $1$。\n因此，唯一的超调发生在单元 $i=0$ 中。根据定义，这是第一个伪超调。\n\n这个超调的位置是单元索引 $i=0$。\n超调的幅度定义为更新值超过初始最大值的量：\n$$\n\\text{Magnitude} = \\phi_0^1 - \\max(\\phi_L, \\phi_R) = \\frac{27}{20} - 1 = \\frac{7}{20}.\n$$\n所求答案是行向量 $(i, \\text{magnitude})$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  \\frac{7}{20}\n\\end{pmatrix}\n}\n$$", "id": "3369239"}, {"introduction": "我们已经看到中心差分在瞬态问题中的振荡行为，现在我们将探讨其在稳态对流-扩散问题中的表现。这类问题在工程和科学计算中非常普遍，其数值解的性质由一个关键的无量纲数——网格佩克莱特数（Grid Peclet Number, $Pe$）——所控制。这个练习要求我们编写代码来求解稳态方程，并通过具体算例验证一个经典结论：当对流项占主导地位以至于$|Pe| \\gt 2$时，即便线性系统本身有唯一解，中心差分格式的解也会出现顽固的、非物理的数值振荡。[@problem_id:3365178]", "problem": "考虑一个一维、稳态、线性的对流-扩散边界值问题，研究的是定义域 $[0,1]$ 上的一个被动标量场 $\\phi(x)$，其材料属性和速度均为常数。其连续控制方程是写成守恒形式的扩散通量和对流通量平衡方程，\n$$\n-\\frac{\\mathrm{d}}{\\mathrm{d}x}\\left(\\Gamma \\frac{\\mathrm{d}\\phi}{\\mathrm{d}x}\\right) + \\frac{\\mathrm{d}}{\\mathrm{d}x}\\left(\\rho u \\, \\phi\\right) = 0,\n$$\n其中 $\\Gamma0$ 是扩散系数，$\\rho0$ 是密度，而 $u$ 是一个可正可负的恒定速度。施加了狄利克雷（Dirichlet）边界条件 $\\phi(0)=\\phi_L$ 和 $\\phi(1)=\\phi_R$。所有量都应被视为无量纲。您必须完全在无量纲单位下进行计算。\n\n您的任务是使用单元中心有限体积法，在一个包含 $N$ 个等大控制体积的均匀网格上（单元交界面位于 $x_i = i \\Delta x$，其中 $\\Delta x = 1/N$ 且 $i=0,1,\\ldots,N$），并对对流通量使用中心差分，以构建一个数值算例，说明一个众所周知的稳定性问题：即当网格佩克莱数（Peclet number）的量级大于 2 时（即 $|Pe|  2$），即使得到的线性系统仍然可解，中心差分格式也会产生非单调的内部振荡。\n\n从每个控制体积的守恒定律出发，使用以下方法离散化方程：\n- 对界面上的扩散通量使用二阶中心差分。\n- 对界面上的对流质量通量使用二阶中心差分。\n\n推导针对内部单元中心值 $\\phi_1,\\ldots,\\phi_{N-1}$ 的最终三对角线性系统，用扩散导率 $D=\\Gamma/\\Delta x$、质量通量 $F=\\rho u$ 和网格佩克莱数 $Pe = F \\Delta x/\\Gamma$ 表示。不要引入任何人工耗散或迎风格式；对两种通量都使用纯中心差分。组装线性系统，并将狄利克雷边界条件整合到右侧项中。\n\n如下定义一个非单调内部振荡的定量检测器。给定包含边界的计算离散解 $\\{\\phi_i\\}_{i=0}^N$，如果以下至少一个条件成立，则判定存在内部振荡：\n- 存在索引 $j \\in \\{1,\\ldots,N-1\\}$，使得 $\\phi_j$ 严格位于以 $\\phi_L$ 和 $\\phi_R$ 为端点的闭区间之外。\n- 存在索引 $j \\in \\{1,\\ldots,N-2\\}$，使得乘积 $(\\phi_{j+1}-\\phi_j)(\\phi_j-\\phi_{j-1})  0$，即一阶差分符号改变，表明存在离散的内部极值。\n\n实现一个程序，该程序：\n- 对每个指定的测试用例，构建并求解上述均匀网格上的中心差分有限体积格式的线性系统。\n- 对每个用例，报告一个布尔值，指示是否根据上述标准检测到非单调内部振荡。\n\n使用以下五个测试用例，每个用例由元组 $(N, Pe, \\phi_L, \\phi_R)$ 指定：\n- 用例 1：$(N, Pe, \\phi_L, \\phi_R) = (10, 0.5, 1, 0)$。\n- 用例 2：$(N, Pe, \\phi_L, \\phi_R) = (10, 4.0, 1, 0)$。\n- 用例 3：$(N, Pe, \\phi_L, \\phi_R) = (40, 4.0, 1, 0)$。\n- 用例 4：$(N, Pe, \\phi_L, \\phi_R) = (10, 2.0, 1, 0)$。\n- 用例 5：$(N, Pe, \\phi_L, \\phi_R) = (10, -4.0, 0, 1)$。\n\n注：\n- 固定 $\\Gamma=1$ 和 $\\rho=1$ 以使所有量无量纲化。那么 $D = 1/\\Delta x$ 且 $F = Pe/\\Delta x$。均匀网格间距为 $\\Delta x = 1/N$。\n- 您必须一致地使用 $Pe$ 的符号来确定质量通量 $F$ 的符号。\n- 最终的线性系统必须严格按照中心差分有限体积公式组装；不要对系数进行正则化、限制或修改。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，顺序与上述五个用例一致。例如，输出形式应为 $[r_1,r_2,r_3,r_4,r_5]$，其中每个 $r_k$ 是一个布尔值，指示是否为用例 $k$ 检测到内部振荡。此问题中不出现角度或物理单位；所有量均为无量纲。唯一要求的输出是指定格式的这一行。", "solution": "用户希望分析一维稳态对流-扩散问题中心差分有限体积格式的稳定性。\n\n### 问题验证\n\n**步骤1：提取给定条件**\n\n*   **控制方程：** $-\\frac{\\mathrm{d}}{\\mathrm{d}x}\\left(\\Gamma \\frac{\\mathrm{d}\\phi}{\\mathrm{d}x}\\right) + \\frac{\\mathrm{d}}{\\mathrm{d}x}\\left(\\rho u \\, \\phi\\right) = 0$，定义域为 $x \\in [0,1]$。\n*   **参数：** 扩散系数 $\\Gamma  0$、密度 $\\rho  0$ 和速度 $u$ 均为常数。所有量均为无量纲。\n*   **边界条件 (BCs)：** 狄利克雷边界，$\\phi(0)=\\phi_L$ 和 $\\phi(1)=\\phi_R$。\n*   **数值离散：**\n    *   在包含 $N$ 个控制体积的均匀网格上使用有限体积法。\n    *   网格节点位于 $x_i = i \\Delta x$，其中 $i=0, \\ldots, N$，$\\Delta x = 1/N$。内部未知数为 $\\phi_1, \\ldots, \\phi_{N-1}$。这意味着这是一个顶点中心格式，其中 $\\phi_i$ 是节点 $x_i$ 处的值。\n    *   指定对控制体积界面上的扩散通量和对流通量均使用二阶中心差分。\n*   **定义：**\n    *   扩散导率：$D = \\Gamma / \\Delta x$。\n    *   质量通量：$F = \\rho u$。\n    *   网格佩克莱数：$Pe = F \\Delta x / \\Gamma$。\n*   **常数：** 实现中指定固定值 $\\Gamma=1$ 和 $\\rho=1$。\n*   **振荡检测：** 如果满足以下两个条件中的至少一个，则存在内部振荡：\n    1.  某个内部解值 $\\phi_j$（对于 $j \\in \\{1, \\ldots, N-1\\}$）严格位于 $[\\min(\\phi_L, \\phi_R), \\max(\\phi_L, \\phi_R)]$ 的范围之外。\n    2.  存在一个离散的内部极值，定义为对于某个索引 $j \\in \\{1, \\ldots, N-2\\}$，有 $(\\phi_{j+1}-\\phi_j)(\\phi_j-\\phi_{j-1})  0$。\n*   **测试用例：**\n    1.  $(N, Pe, \\phi_L, \\phi_R) = (10, 0.5, 1, 0)$\n    2.  $(N, Pe, \\phi_L, \\phi_R) = (10, 4.0, 1, 0)$\n    3.  $(N, Pe, \\phi_L, \\phi_R) = (40, 4.0, 1, 0)$\n    4.  $(N, Pe, \\phi_L, \\phi_R) = (10, 2.0, 1, 0)$\n    5.  $(N, Pe, \\phi_L, \\phi_R) = (10, -4.0, 0, 1)$\n\n**步骤2：使用提取的给定条件进行验证**\n\n*   **科学依据：** 该问题基于经典的一维对流-扩散方程和标准的有限体积法，这是计算流体动力学中的一个基本课题。研究数值稳定性与网格佩克莱数的关系是一个经典且至关重要的主题。该问题在科学上是合理的。\n*   **适定性：** 连续问题是一个适定的线性边界值问题。离散化后得到一个三对角线性系统。对于指定的格式和参数，该系统非奇异，保证了唯一解的存在。问题是适定的。\n*   **目标：** 问题用精确的数学定义、量化标准和具体的数值参数来表述。它没有主观性和模糊性。\n*   **完整性：** 提供了所有必要的信息，包括控制方程、边界条件、离散格式、参数定义和测试用例。问题是自包含的。\n*   **一致性：** 没有矛盾之处。$D$、$F$ 和 $Pe$ 的定义是相互一致的。尽管使用了“单元中心”这一术语，但所要求解的线性系统（针对 $\\phi_1, \\ldots, \\phi_{N-1}$）的结构与顶点中心网格的解释是一致的，这是一个常见的术语上的轻微混淆点，但不会在设置中造成形式上的矛盾。\n\n**步骤3：结论与行动**\n\n问题有效。将制定一个合理的解决方案。\n\n### 基于原理的解决方案\n\n任务是推导并求解一维稳态对流-扩散方程的离散形式，并检查解是否存在非物理振荡。\n\n**1. 通过有限体积法进行离散化**\n守恒形式的控制方程为 $\\frac{\\mathrm{d}}{\\mathrm{d}x} J(x) = 0$，其中 $J(x)$ 是总通量，由 $J = -\\Gamma \\frac{\\mathrm{d}\\phi}{\\mathrm{d}x} + F\\phi$ 给出，$F = \\rho u$。这意味着总通量在整个定义域内是恒定的。\n\n我们采用顶点中心有限体积法。定义域 $[0,1]$ 被 $N+1$ 个节点在位置 $x_i = i\\Delta x$（其中 $i=0, 1, \\ldots, N$，$\\Delta x = 1/N$）划分为 $N$ 个段。未知数是内部节点 $i=1, \\ldots, N-1$ 处的值 $\\phi_i$。边界值是给定的：$\\phi_0 = \\phi_L$ 和 $\\phi_N = \\phi_R$。\n\n我们将控制方程在一个围绕内部节点 $x_i$ 的控制体积 (CV) 上进行积分。该控制体积从位于 $x_i - \\Delta x/2$ 的西界面 $w$ 延伸到位于 $x_i + \\Delta x/2$ 的东界面 $e$。\n$$ \\int_{x_i - \\Delta x/2}^{x_i + \\Delta x/2} \\frac{\\mathrm{d}J}{\\mathrm{d}x} \\mathrm{d}x = 0 $$\n$$ J_e - J_w = 0 $$\n其中 $J_e$ 和 $J_w$ 分别是控制体积东、西界面上的总通量。\n\n**2. 使用中心差分近似通量**\n界面上的通量通过对扩散和对流均使用二阶中心差分来近似。\n\n在东界面 $e$（节点 $i$ 和 $i+1$ 之间）：\n扩散通量近似为：\n$$ \\left(-\\Gamma \\frac{\\mathrm{d}\\phi}{\\mathrm{d}x}\\right)_e \\approx -\\Gamma \\frac{\\phi_{i+1} - \\phi_i}{\\Delta x} = -D(\\phi_{i+1} - \\phi_i) $$\n其中 $D=\\Gamma/\\Delta x$。\n对流通量需要界面上的 $\\phi$ 值，通过线性插值得到：\n$$ (F\\phi)_e \\approx F \\phi_e = F \\frac{\\phi_i + \\phi_{i+1}}{2} $$\n东界面 $e$ 上的总通量为：\n$$ J_e \\approx F \\frac{\\phi_i + \\phi_{i+1}}{2} - D(\\phi_{i+1} - \\phi_i) = \\left(\\frac{F}{2} + D\\right)\\phi_i - \\left(D - \\frac{F}{2}\\right)\\phi_{i+1} $$\n\n类似地，在西界面 $w$（节点 $i-1$ 和 $i$ 之间）：\n$$ J_w \\approx F \\frac{\\phi_{i-1} + \\phi_i}{2} - D(\\phi_i - \\phi_{i-1}) = \\left(\\frac{F}{2} - D\\right)\\phi_i + \\left(\\frac{F}{2} + D\\right)\\phi_{i-1} $$\n\n**3. 代数方程的推导**\n将通量近似值代入平衡方程 $J_e - J_w = 0$：\n$$ \\left[\\left(\\frac{F}{2} + D\\right)\\phi_i - \\left(D - \\frac{F}{2}\\right)\\phi_{i+1}\\right] - \\left[\\left(\\frac{F}{2} - D\\right)\\phi_i + \\left(\\frac{F}{2} + D\\right)\\phi_{i-1}\\right] = 0 $$\n整理关于 $\\phi_{i-1}$、$\\phi_i$ 和 $\\phi_{i+1}$ 的项：\n$$ -\\left(D + \\frac{F}{2}\\right)\\phi_{i-1} + \\left(2D\\right)\\phi_i - \\left(D - \\frac{F}{2}\\right)\\phi_{i+1} = 0 $$\n为了用网格佩克莱数 $Pe = F\\Delta x/\\Gamma = F/D$ 来表示，我们将整个方程除以 $D$：\n$$ -\\left(1 + \\frac{Pe}{2}\\right)\\phi_{i-1} + 2\\phi_i - \\left(1 - \\frac{Pe}{2}\\right)\\phi_{i+1} = 0 $$\n该代数方程将节点 $i$ 处的值与其直接邻居联系起来。\n\n**4. 线性系统的组装**\n此方程对所有内部节点 $i=1, \\ldots, N-1$ 均成立。我们为未知向量 $\\vec{\\phi} = [\\phi_1, \\ldots, \\phi_{N-1}]^T$ 组装一个形式为 $A\\vec{\\phi} = \\vec{b}$ 的三对角线性系统。\n\n矩阵 $A$ 是一个 $(N-1) \\times (N-1)$ 的三对角矩阵，其系数如下：\n- 主对角线 ($d_i$)：$2$\n- 下对角线 ($a_i$)：$-\\left(1 + \\frac{Pe}{2}\\right)$\n- 上对角线 ($c_i$)：$-\\left(1 - \\frac{Pe}{2}\\right) = \\frac{Pe}{2} - 1$\n\n边界条件 $\\phi_0 = \\phi_L$ 和 $\\phi_N = \\phi_R$ 被整合到右侧向量 $\\vec{b}$ 中。\n对于第一个方程 ($i=1$)：\n$$ 2\\phi_1 - \\left(1 - \\frac{Pe}{2}\\right)\\phi_2 = \\left(1 + \\frac{Pe}{2}\\right)\\phi_0 = \\left(1 + \\frac{Pe}{2}\\right)\\phi_L $$\n因此，$b_1 = (1 + Pe/2)\\phi_L$。\n\n对于最后一个方程 ($i=N-1$)：\n$$ -\\left(1 + \\frac{Pe}{2}\\right)\\phi_{N-2} + 2\\phi_{N-1} = \\left(1 - \\frac{Pe}{2}\\right)\\phi_N = \\left(1 - \\frac{Pe}{2}\\right)\\phi_R $$\n因此，$b_{N-1} = (1 - Pe/2)\\phi_R$。\n\n对于所有其他方程 ($i=2, \\ldots, N-2$)，右侧项为零，$b_i = 0$。\n\n**5. 稳定性和振荡**\n众所周知，中心差分格式只有在矩阵 $A$ 是对角占优时才是稳定的并产生单调解。这要求 $|d_i| \\geq |a_i| + |c_i|$，即：\n$$ |2| \\geq \\left|-\\left(1 + \\frac{Pe}{2}\\right)\\right| + \\left|-\\left(1 - \\frac{Pe}{2}\\right)\\right| $$\n$$ 2 \\geq \\left|1 + \\frac{Pe}{2}\\right| + \\left|1 - \\frac{Pe}{2}\\right| $$\n这个不等式仅在 $|Pe/2| \\leq 1$ 或 $|Pe| \\leq 2$ 时成立。当 $|Pe|  2$ 时，对角占优性丧失，模板中相邻节点的系数可能变为负值，导致非物理的振荡解。问题要求展示这种行为。\n\n**6. 计算流程**\n程序将为每个测试用例实现以下步骤：\n1.  给定 $N$、$Pe$、$\\phi_L$ 和 $\\phi_R$。\n2.  如上所述，构建 $(N-1) \\times (N-1)$ 的三对角矩阵 $A$ 和右侧向量 $\\vec{b}$。\n3.  求解线性系统 $A\\vec{\\phi} = \\vec{b}$ 以找到内部解值 $\\phi_1, \\ldots, \\phi_{N-1}$。\n4.  通过在前面添加 $\\phi_L$ 和在末尾添加 $\\phi_R$ 来创建完整的解向量 $\\{\\phi_i\\}_{i=0}^N$。\n5.  应用两个指定的标准来检测振荡：\n    *   检查是否有任何内部 $\\phi_j$ 严格位于 $[\\min(\\phi_L, \\phi_R), \\max(\\phi_L, \\phi_R)]$ 之外。\n    *   检查对于任何 $j \\in \\{1, \\ldots, N-2\\}$ 是否有 $(\\phi_{j+1}-\\phi_j)(\\phi_j-\\phi_{j-1})  0$。\n6.  如果检测到振荡，则报告 `True`，否则报告 `False`。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases for the 1D convection-diffusion\n    problem and print the final formatted result.\n    \"\"\"\n\n    def solve_case(N, Pe, phi_L, phi_R):\n        \"\"\"\n        Constructs and solves the linear system for the central-differencing FVM\n        and detects non-monotone interior oscillations for a single case.\n\n        Args:\n            N (int): Number of control volumes.\n            Pe (float): Grid Peclet number.\n            phi_L (float): Left boundary condition value.\n            phi_R (float): Right boundary condition value.\n\n        Returns:\n            bool: True if an oscillation is detected, False otherwise.\n        \"\"\"\n        num_interior_nodes = N - 1\n\n        # Trivial case with no interior nodes to solve for.\n        if num_interior_nodes = 0:\n            return False\n\n        # 1. Construct the (N-1)x(N-1) tridiagonal matrix A\n        # The discretized equation for node i is: a*phi_{i-1} + d*phi_i + c*phi_{i+1} = 0\n        # where a = -(1 + Pe/2), d = 2, c = -(1 - Pe/2)\n        a = -1.0 - Pe / 2.0  # Lower diagonal coefficient\n        d = 2.0               # Main diagonal coefficient\n        c = -1.0 + Pe / 2.0  # Upper diagonal coefficient\n\n        A = np.diag(np.full(num_interior_nodes, d))\n        if num_interior_nodes > 1:\n            A += np.diag(np.full(num_interior_nodes - 1, c), k=1)\n            A += np.diag(np.full(num_interior_nodes - 1, a), k=-1)\n\n        # 2. Construct the RHS vector b incorporating boundary conditions\n        b = np.zeros(num_interior_nodes)\n        # Equation for i=1: d*phi_1 + c*phi_2 = -a*phi_0, with phi_0 = phi_L\n        b[0] = -a * phi_L\n        # Equation for i=N-1: a*phi_{N-2} + d*phi_{N-1} = -c*phi_N, with phi_N = phi_R\n        b[-1] = -c * phi_R\n\n        # 3. Solve the system A * phi_interior = b\n        phi_interior = np.linalg.solve(A, b)\n\n        # 4. Construct the full solution vector phi (size N+1, indices 0 to N)\n        phi = np.concatenate(([phi_L], phi_interior, [phi_R]))\n\n        # 5. Detect non-monotone interior oscillations\n        has_oscillation = False\n\n        # Criterion 1: Interior values lie strictly outside the boundary value range.\n        min_b = min(phi_L, phi_R)\n        max_b = max(phi_L, phi_R)\n        \n        if np.any(phi_interior  min_b) or np.any(phi_interior > max_b):\n            has_oscillation = True\n        \n        if not has_oscillation:\n            # Criterion 2: An interior extremum exists (sign change in first differences).\n            # Check for (phi_{j+1}-phi_j)(phi_j-phi_{j-1})  0 for j in {1, ..., N-2}\n            # The loop for j from 1 to N-2 (inclusive) is range(1, N-1) in Python.\n            for j in range(1, N - 1):\n                product = (phi[j + 1] - phi[j]) * (phi[j] - phi[j - 1])\n                if product  0:\n                    has_oscillation = True\n                    break\n                    \n        return has_oscillation\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, Pe, phi_L, phi_R)\n        (10, 0.5, 1, 0),\n        (10, 4.0, 1, 0),\n        (40, 4.0, 1, 0),\n        (10, 2.0, 1, 0),\n        (10, -4.0, 0, 1),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = solve_case(*case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3365178"}]}