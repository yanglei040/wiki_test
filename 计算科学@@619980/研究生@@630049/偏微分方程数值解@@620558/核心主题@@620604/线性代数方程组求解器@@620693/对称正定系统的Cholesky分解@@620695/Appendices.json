{"hands_on_practices": [{"introduction": "深入任何算法的核心，首先要理解其计算成本。本练习将引导你通过第一性原理，精确推导稠密矩阵 Cholesky 分解的浮点运算（flop）计数 [@problem_id:3370813]。通过这个过程，你不仅能验证其计算复杂度为 $\\frac{n^3}{3} + O(n^2)$，还能深化对算法逐列计算过程的理解，为评估其在不同问题规模下的效率奠定坚实基础。", "problem": "考虑一个对称正定线性系统 $A x = b$，该系统由均匀网格上的一个一致椭圆偏微分方程（PDE）（例如二维泊松方程）通过有限差分离散化得到。假设 $A \\in \\mathbb{R}^{n \\times n}$ 被视为稠密矩阵，并通过 Cholesky 分解 $A = L L^{\\top}$ 进行分解，其中 $L$ 是一个对角线元素为正的下三角矩阵。采用以下算术成本模型：每次浮点加法、减法、乘法、除法和平方根运算计为 1 次浮点运算（flop）。\n\n任务：\n- 从使用内积逐列计算 $L$ 的标准非分块 Cholesky 算法出发，根据第一性原理推导分解 $A$ 所需的精确总浮点运算次数，并将其表示为关于 $n$ 的多项式，从而证明其为 $n^{3}/3 + O(n^{2})$。\n- 使用标准的前向代入法求解 $L y = b$ 和后向代入法求解 $L^{\\top} x = y$，推导每次三角求解的精确浮点运算次数。\n- 综合您的结果，得出一个关于 $n$ 的单一简化闭式表达式，表示通过 Cholesky 分解 $A$ 然后通过前向和后向代入法求解单个右端项的 $A x = b$ 所需的精确总浮点运算次数。\n\n仅报告合并步骤得出的精确总浮点运算次数，并简化为关于 $n$ 的单个多项式，作为您的最终答案。无需四舍五入。", "solution": "根据指定标准审查问题陈述的有效性。\n\n### 第 1 步：提取已知条件\n- 方程组是一个线性系统 $A x = b$。\n- 矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 是对称正定（SPD）的，并被视为稠密矩阵。\n- 该系统将使用 Cholesky 分解 $A = L L^{\\top}$ 求解，其中 $L$ 是一个对角线元素为正的下三角矩阵。\n- 求解过程包括三个阶段：\n    1.  Cholesky 分解：$A \\to L$。\n    2.  前向代入：求解 $L y = b$ 以得到 $y$。\n    3.  后向代入：求解 $L^{\\top} x = y$ 以得到 $x$。\n- 算术成本模型将一次浮点运算（flop）定义为一次加法、减法、乘法、除法或平方根运算。\n- 任务是：\n    1.  使用基于内积的逐列标准算法，推导 Cholesky 分解的精确总浮点运算次数，并将结果表示为关于 $n$ 的多项式。\n    2.  推导前向和后向代入步骤的精确浮点运算次数。\n    3.  将所有次数合并为一个单一简化的闭式表达式，用于表示求解 $A x = b$ 的总浮点运算次数。\n\n### 第 2 步：使用提取的已知条件进行验证\n- **科学依据：** 该问题基于数值线性代数中的基本和标准概念——Cholesky 分解和三角求解。浮点运算次数分析是科学计算中的一个典型练习。\n- **适定性：** 该问题明确指定了算法、成本模型和期望的输出形式。这种结构确保了存在唯一且有意义的解。\n- **客观性：** 该问题使用精确、无歧义的数学语言陈述，不含主观内容。\n\n该问题没有表现出说明中列出的任何缺陷，如科学上不合理、不完整、矛盾或模棱两可。这是一个数值分析中定义明确的问题。\n\n### 第 3 步：结论和行动\n该问题是**有效的**。将提供详细的解决方案。\n\n### 解题推导\n\n设 $A = (a_{ij})$ 和 $L = (l_{ij})$ 为 $n \\times n$ 矩阵，其中当 $j > i$ 时 $l_{ij}=0$。Cholesky 分解由矩阵方程 $A = L L^{\\top}$ 定义。这对应于标量方程：\n$$a_{ij} = \\sum_{k=1}^{\\min(i,j)} l_{ik} l_{jk}$$\n我们将推导所需三个阶段中每个阶段的浮点运算次数。\n\n**1. Cholesky 分解的浮点运算次数 ($A = L L^{\\top}$)**\n\n问题指定了一个使用内积的逐列算法。对于每一列 $j = 1, 2, \\dots, n$，我们计算元素 $l_{jj}$ 和 $l_{ij}$（其中 $i > j$）。\n\n对于对角线元素 $l_{jj}$：\n从 $a_{jj} = \\sum_{k=1}^{j} l_{jk}^2 = \\sum_{k=1}^{j-1} l_{jk}^2 + l_{jj}^2$，我们求解 $l_{jj}$：\n$$l_{jj} = \\sqrt{a_{jj} - \\sum_{k=1}^{j-1} l_{jk}^2}$$\n- 求和 $\\sum_{k=1}^{j-1} l_{jk}^2$ 涉及 $j-1$ 次乘法和 $j-2$ 次加法。（对于 $j=1$，该和为空，成本为 $0$）。这是一个长度为 $j-1$ 的向量与自身的内积。对于 $j>1$，成本为 $2(j-1)-1 = 2j-3$ 次浮点运算。\n- $l_{jj}$ 的计算在求和之外还需要一次减法和一次平方根运算。\n- 因此，对于 $j>1$，计算 $l_{jj}$ 的浮点运算次数为 $(2j-3) + 1 + 1 = 2j-1$ 次。对于 $j=1$，成本为 1 次浮点运算（一次平方根）。公式 $2j-1$ 对于 $j=1$ 也得出 1，因此它普遍适用。\n\n对于非对角线元素 $l_{ij}$（其中 $i > j$）：\n从 $a_{ij} = \\sum_{k=1}^{j} l_{ik} l_{jk} = \\sum_{k=1}^{j-1} l_{ik} l_{jk} + l_{ij} l_{jj}$，我们求解 $l_{ij}$：\n$$l_{ij} = \\frac{1}{l_{jj}} \\left( a_{ij} - \\sum_{k=1}^{j-1} l_{ik} l_{jk} \\right)$$\n- 求和 $\\sum_{k=1}^{j-1} l_{ik} l_{jk}$ 是两个长度为 $j-1$ 的向量的内积。它需要 $j-1$ 次乘法和 $j-2$ 次加法，总共为 $2(j-1)-1 = 2j-3$ 次浮点运算（对于 $j>1$）。\n- $l_{ij}$ 的计算随后需要一次减法和一次除法。\n- 对于 $j>1$，计算单个 $l_{ij}$ 的浮点运算次数为 $(2j-3) + 1 + 1 = 2j-1$ 次。对于 $j=1$，成本为 1 次浮点运算（一次除法），这也由公式 $2j-1$ 给出。\n\n第 $j$ 列的总浮点运算次数是计算 $l_{jj}$ 和 $n-j$ 个元素 $l_{ij}$（其中 $i=j+1, \\dots, n$）的成本之和。\n第 $j$ 列的成本：\n$$C_j = (2j-1) + (n-j)(2j-1) = (1+n-j)(2j-1)$$\n\n分解的总浮点运算次数 $C_{fact}$ 是所有列的成本之和：\n$$C_{fact} = \\sum_{j=1}^{n} C_j = \\sum_{j=1}^{n} (n-j+1)(2j-1)$$\n我们展开求和中的项：\n$(n-j+1)(2j-1) = 2nj - n + 2j - 1 -2j^2 + j = -2j^2 + (2n+3)j - (n+1)$。\n我们进行求和：\n$$C_{fact} = \\sum_{j=1}^{n} \\left( -2j^2 + (2n+3)j - (n+1) \\right)$$\n$$C_{fact} = -2\\sum_{j=1}^{n} j^2 + (2n+3)\\sum_{j=1}^{n} j - (n+1)\\sum_{j=1}^{n} 1$$\n使用标准的幂和公式：$\\sum_{j=1}^{n} 1 = n$，$\\sum_{j=1}^{n} j = \\frac{n(n+1)}{2}$，$\\sum_{j=1}^{n} j^2 = \\frac{n(n+1)(2n+1)}{6}$。\n$$C_{fact} = -2 \\left( \\frac{n(n+1)(2n+1)}{6} \\right) + (2n+3) \\left( \\frac{n(n+1)}{2} \\right) - n(n+1)$$\n提取公因式 $n(n+1)$：\n$$C_{fact} = n(n+1) \\left[ -\\frac{2n+1}{3} + \\frac{2n+3}{2} - 1 \\right]$$\n$$C_{fact} = n(n+1) \\left[ \\frac{-2(2n+1) + 3(2n+3) - 6}{6} \\right]$$\n$$C_{fact} = n(n+1) \\left[ \\frac{-4n - 2 + 6n + 9 - 6}{6} \\right]$$\n$$C_{fact} = n(n+1) \\left[ \\frac{2n+1}{6} \\right] = \\frac{n(n+1)(2n+1)}{6}$$\n展开此多项式可得：\n$$C_{fact} = \\frac{n(2n^2 + 3n + 1)}{6} = \\frac{2n^3 + 3n^2 + n}{6} = \\frac{n^3}{3} + \\frac{n^2}{2} + \\frac{n}{6}$$\n这表明分解成本确实是 $\\frac{n^3}{3} + O(n^2)$。\n\n**2. 三角求解的浮点运算次数**\n\n**前向代入 ($L y = b$):**\n我们求解 $y_i$，其中 $i=1, \\dots, n$：\n$$y_i = \\frac{1}{l_{ii}} \\left( b_i - \\sum_{j=1}^{i-1} l_{ij} y_j \\right)$$\n为求得总浮点运算次数 $C_{fwd}$，我们将每个 $i$ 的运算次数相加：\n- 对于 $i=1$，$y_1 = b_1 / l_{11}$ 需要 1 次除法。\n- 对于每个 $i > 1$，求和 $\\sum_{j=1}^{i-1} l_{ij} y_j$ 需要 $i-1$ 次乘法和 $i-2$ 次加法。然后，我们执行 1 次减法和 1 次除法。\n- 对于 $i>1$，计算 $y_i$ 的总成本为 $(i-1) + (i-2) + 1 + 1 = 2i-1$ 次浮点运算。\n前向代入的总次数为：\n$$C_{fwd} = 1 + \\sum_{i=2}^{n} (2i-1) = 1 + \\left( 2\\sum_{i=2}^{n} i - \\sum_{i=2}^{n} 1 \\right)$$\n$$C_{fwd} = 1 + 2\\left(\\frac{n(n+1)}{2} - 1\\right) - (n-1) = 1 + n(n+1) - 2 - n + 1 = n^2+n-n = n^2$$\n或者，按运算类型计数：\n- 乘法：$\\sum_{i=2}^{n} (i-1) = \\sum_{k=1}^{n-1} k = \\frac{n(n-1)}{2}$ 次浮点运算。\n- 加法/减法：$\\sum_{i=2}^{n} ((i-2)+1) = \\frac{n(n-1)}{2}$ 次浮点运算。\n- 除法：$\\sum_{i=1}^{n} 1 = n$ 次浮点运算。\n总计 $C_{fwd} = \\frac{n(n-1)}{2} + \\frac{n(n-1)}{2} + n = n(n-1) + n = n^2-n+n = n^2$。\n\n**后向代入 ($L^{\\top} x = y$):**\n我们求解 $x_i$，其中 $i=n, \\dots, 1$：\n$$x_i = \\frac{1}{l_{ii}} \\left( y_i - \\sum_{j=i+1}^{n} l_{ji} x_j \\right)$$\n其结构与前向代入相同。每行 $i$ 的运算次数取决于对角线右侧的非零元素数量，即 $n-i$。\n通过对称性可知，总浮点运算次数 $C_{bwd}$ 与前向代入情况相同。\n$$C_{bwd} = n^2$$\n\n**3. 总浮点运算次数**\n\n分解 $A$ 并求解 $A x = b$ 的总浮点运算次数是三个阶段成本的总和：\n$$C_{total} = C_{fact} + C_{fwd} + C_{bwd}$$\n$$C_{total} = \\left( \\frac{2n^3 + 3n^2 + n}{6} \\right) + n^2 + n^2$$\n$$C_{total} = \\frac{2n^3 + 3n^2 + n}{6} + 2n^2$$\n为了将它们合并成一个单一表达式，我们找到一个公分母：\n$$C_{total} = \\frac{2n^3 + 3n^2 + n + 12n^2}{6}$$\n$$C_{total} = \\frac{2n^3 + 15n^2 + n}{6}$$\n这就是精确总浮点运算次数的简化闭式多项式表达式。", "answer": "$$\\boxed{\\frac{2n^3 + 15n^2 + n}{6}}$$", "id": "3370813"}, {"introduction": "对于来源于偏微分方程的大型稀疏线性系统，直接进行 Cholesky 分解往往因计算量和填充（fill-in）问题而不可行，一个高效的替代方案是使用迭代法，并通过预条件技术加速收敛。本练习将带你亲手构建一个零填充不完全 Cholesky (IC(0)) 预条件子，并将其应用于共轭梯度法 [@problem_id:3370799]。通过对比预处理前后残差的下降速度，你将直观地体验到预条件技术在求解大型稀疏问题中的巨大威力。", "problem": "考虑单位正方形上的模型椭圆边值问题 $-\\Delta u = f$，其边界条件为齐次狄利克雷边界条件。在具有 $2 \\times 2$ 内部点的均匀网格上，使用标准的五点有限差分格式，并按字典序（按行）排序，得到的对称正定（SPD）线性方程组的系数矩阵为 $A \\in \\mathbb{R}^{4 \\times 4}$，如下所示：\n$$\nA \\;=\\; \\begin{pmatrix}\n4  -1  -1  0 \\\\\n-1  4  0  -1 \\\\\n-1  0  4  -1 \\\\\n0  -1  -1  4\n\\end{pmatrix}.\n$$\n为简化起见，均匀网格间距的缩放因子已被吸收到 $A$ 中；这不影响下面的分析。设右端项为 $b = (1,0,0,0)^{\\top}$，初始猜测值为 $x_0 = 0$。定义零填充不完全 Cholesky 分解（IC$(0)$）为一个下三角矩阵 $L$，其稀疏模式与 $A$ 的下三角部分一致，使得预条件子 $M = L L^{\\top}$ 近似于 $A$。使用左预处理，即预处理共轭梯度（PCG）方法将 $M^{-1}$ 应用于残差。\n\n任务：\n- 遵循 $A$ 的下三角部分的自然稀疏模式，为 $A$ 的 IC(0) 分解构造 $L$。\n- 从 $x_0 = 0$ 开始，分别执行一次未预处理的共轭梯度（CG）方法迭代和一次使用 $M^{-1}$ 的左预处理 CG（PCG）方法迭代。将得到的残差分别记为 $r_1^{\\mathrm{unpre}}$ 和 $r_1^{\\mathrm{pre}}$。\n- 计算欧几里得范数 $\\|r_1^{\\mathrm{unpre}}\\|_2$ 和 $\\|r_1^{\\mathrm{pre}}\\|_2$。\n- 通过单个标量因子 $\\mathcal{I} = \\|r_1^{\\mathrm{unpre}}\\|_2 / \\|r_1^{\\mathrm{pre}}\\|_2$ 来量化 PCG 相对于未预处理 CG 的改进程度。\n\n将最终答案表示为单个精确的解析表达式。无需四舍五入，且最终表达式中不包含任何单位。", "solution": "该问题是适定的，具有科学依据，并提供了执行所需计算的所有必要信息。这是数值线性代数中的一个标准练习。我们开始求解。\n\n问题要求计算在一次未预处理和预处理共轭梯度方法迭代后得到的改进因子 $\\mathcal{I} = \\|r_1^{\\mathrm{unpre}}\\|_2 / \\|r_1^{\\mathrm{pre}}\\|_2$。给定的矩阵是\n$$\nA = \\begin{pmatrix}\n4  -1  -1  0 \\\\\n-1  4  0  -1 \\\\\n-1  0  4  -1 \\\\\n0  -1  -1  4\n\\end{pmatrix}\n$$\n右端项是 $b = \\begin{pmatrix} 1  0  0  0 \\end{pmatrix}^{\\top}$，初始猜测值是 $x_0 = \\begin{pmatrix} 0  0  0  0 \\end{pmatrix}^{\\top}$。\n\n首先，我们构造零填充不完全 Cholesky 分解（IC(0)）因子 $L$。矩阵 $L$ 必须具有与 $A$ 的下三角部分相同的稀疏模式。\n$$\nL = \\begin{pmatrix}\nl_{11}  0  0  0 \\\\\nl_{21}  l_{22}  0  0 \\\\\nl_{31}  0  l_{33}  0 \\\\\n0  l_{42}  l_{43}  l_{44}\n\\end{pmatrix}\n$$\n$L$ 的元素通过使 $(LL^{\\top})_{ij} \\approx A_{ij}$ 来计算。IC(0) 算法给出：\n$l_{11} = \\sqrt{a_{11}} = \\sqrt{4} = 2$。\n$l_{21} = a_{21} / l_{11} = -1 / 2$。\n$l_{31} = a_{31} / l_{11} = -1 / 2$。\n$l_{22} = \\sqrt{a_{22} - l_{21}^2} = \\sqrt{4 - (-1/2)^2} = \\sqrt{4 - 1/4} = \\sqrt{15/4} = \\frac{\\sqrt{15}}{2}$。\n$l_{33} = \\sqrt{a_{33} - l_{31}^2} = \\sqrt{4 - (-1/2)^2} = \\sqrt{15/4} = \\frac{\\sqrt{15}}{2}$。\n$l_{42} = (a_{42} - l_{41}l_{21}) / l_{22} = a_{42}/l_{22}$ (因为 $l_{41}=0$) $= -1 / (\\frac{\\sqrt{15}}{2}) = -\\frac{2}{\\sqrt{15}}$。\n$l_{43} = (a_{43} - l_{41}l_{31} - l_{42}l_{32}) / l_{33} = a_{43}/l_{33}$ (因为 $l_{41}=0, l_{32}=0$) $= -1 / (\\frac{\\sqrt{15}}{2}) = -\\frac{2}{\\sqrt{15}}$。\n$l_{44} = \\sqrt{a_{44} - (l_{42}^2 + l_{43}^2)} = \\sqrt{4 - (-\\frac{2}{\\sqrt{15}})^2 - (-\\frac{2}{\\sqrt{15}})^2} = \\sqrt{4 - \\frac{4}{15} - \\frac{4}{15}} = \\sqrt{\\frac{60-8}{15}} = \\sqrt{\\frac{52}{15}} = \\frac{2\\sqrt{13}}{\\sqrt{15}}$。\n所以，IC(0) 因子是\n$$\nL = \\begin{pmatrix}\n2  0  0  0 \\\\\n-1/2  \\sqrt{15}/2  0  0 \\\\\n-1/2  0  \\sqrt{15}/2  0 \\\\\n0  -2/\\sqrt{15}  -2/\\sqrt{15}  2\\sqrt{13}/\\sqrt{15}\n\\end{pmatrix}\n$$\n预条件子是 $M = LL^{\\top}$。\n\n接下来，我们执行一次未预处理的共轭梯度（CG）迭代。\n从 $x_0 = 0$ 开始，初始残差为 $r_0 = b - Ax_0 = b = \\begin{pmatrix} 1  0  0  0 \\end{pmatrix}^{\\top}$。\n初始搜索方向为 $p_0 = r_0$。\n步长 $\\alpha_0$ 为 $\\alpha_0 = \\frac{r_0^{\\top} r_0}{p_0^{\\top} A p_0}$。\n$r_0^{\\top} r_0 = 1^2 = 1$。\n$A p_0 = A r_0 = \\begin{pmatrix} 4  -1  -1  0 \\\\ -1  4  0  -1 \\\\ -1  0  4  -1 \\\\ 0  -1  -1  4 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 4 \\\\ -1 \\\\ -1 \\\\ 0 \\end{pmatrix}$。\n$p_0^{\\top} A p_0 = r_0^{\\top} (A r_0) = \\begin{pmatrix} 1  0  0  0 \\end{pmatrix} \\begin{pmatrix} 4 \\\\ -1 \\\\ -1 \\\\ 0 \\end{pmatrix} = 4$。\n所以，$\\alpha_0 = 1/4$。\n第一次迭代解为 $x_1 = x_0 + \\alpha_0 p_0 = \\frac{1}{4} \\begin{pmatrix} 1  0  0  0 \\end{pmatrix}^{\\top}$。\n新的残差为 $r_1^{\\mathrm{unpre}} = r_0 - \\alpha_0 A p_0 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\frac{1}{4} \\begin{pmatrix} 4 \\\\ -1 \\\\ -1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1/4 \\\\ 1/4 \\\\ 0 \\end{pmatrix}$。\n其欧几里得范数为 $\\|r_1^{\\mathrm{unpre}}\\|_2 = \\sqrt{0^2 + (1/4)^2 + (1/4)^2 + 0^2} = \\sqrt{2/16} = \\sqrt{1/8} = \\frac{1}{2\\sqrt{2}}$。\n\n现在，我们执行一次预处理共轭梯度（PCG）迭代。\n初始残差为 $r_0 = b = \\begin{pmatrix} 1  0  0  0 \\end{pmatrix}^{\\top}$。\n我们求解预处理系统 $M z_0 = r_0$，即 $LL^{\\top}z_0=r_0$。\n首先，通过向前代入法求解 $Ly=r_0$：\n$2y_1 = 1 \\implies y_1=1/2$。\n$-\\frac{1}{2}y_1 + \\frac{\\sqrt{15}}{2}y_2 = 0 \\implies y_2 = \\frac{y_1}{\\sqrt{15}} = \\frac{1}{2\\sqrt{15}}$。\n$-\\frac{1}{2}y_1 + \\frac{\\sqrt{15}}{2}y_3 = 0 \\implies y_3 = \\frac{y_1}{\\sqrt{15}} = \\frac{1}{2\\sqrt{15}}$。\n$-\\frac{2}{\\sqrt{15}}y_2 - \\frac{2}{\\sqrt{15}}y_3 + \\frac{2\\sqrt{13}}{\\sqrt{15}}y_4 = 0 \\implies \\sqrt{13}y_4 = y_2+y_3 = \\frac{1}{\\sqrt{15}} \\implies y_4 = \\frac{1}{\\sqrt{13}\\sqrt{15}}$。\n接下来，通过向后代入法求解 $L^{\\top}z_0=y$：\n$\\frac{2\\sqrt{13}}{\\sqrt{15}}z_{04} = y_4 = \\frac{1}{\\sqrt{13}\\sqrt{15}} \\implies 2\\sqrt{13}z_{04} = \\frac{1}{\\sqrt{13}} \\implies z_{04} = \\frac{1}{26}$。\n$\\frac{\\sqrt{15}}{2}z_{03} - \\frac{2}{\\sqrt{15}}z_{04} = y_3 = \\frac{1}{2\\sqrt{15}} \\implies 15z_{03}-4z_{04} = 1 \\implies 15z_{03} = 1+4/26 = 15/13 \\implies z_{03} = 1/13$。\n根据对称性，$z_{02} = 1/13$。\n$2z_{01} - \\frac{1}{2}z_{02} - \\frac{1}{2}z_{03} = y_1 = 1/2 \\implies 2z_{01} = 1/2 + \\frac{1}{2}(1/13) + \\frac{1}{2}(1/13) = 1/2+1/13 = 15/26 \\implies z_{01}=15/52$。\n所以，$z_0 = \\begin{pmatrix} 15/52  1/13  1/13  1/26 \\end{pmatrix}^{\\top} = \\frac{1}{52}\\begin{pmatrix} 15  4  4  2 \\end{pmatrix}^{\\top}$。\n初始搜索方向为 $p_0 = z_0$。\n步长为 $\\alpha_0 = \\frac{r_0^{\\top} z_0}{p_0^{\\top} A p_0}$。\n$r_0^{\\top} z_0 = \\begin{pmatrix} 1  0  0  0 \\end{pmatrix} z_0 = z_{01} = 15/52$。\n$A p_0 = A z_0 = \\frac{1}{52}\\begin{pmatrix} 4  -1  -1  0 \\\\ -1  4  0  -1 \\\\ -1  0  4  -1 \\\\ 0  -1  -1  4 \\end{pmatrix} \\begin{pmatrix} 15 \\\\ 4 \\\\ 4 \\\\ 2 \\end{pmatrix} = \\frac{1}{52}\\begin{pmatrix} 60-4-4 \\\\ -15+16-2 \\\\ -15+16-2 \\\\ -4-4+8 \\end{pmatrix} = \\frac{1}{52}\\begin{pmatrix} 52 \\\\ -1 \\\\ -1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ -1/52 \\\\ -1/52 \\\\ 0 \\end{pmatrix}$。\n$p_0^{\\top} A p_0 = z_0^{\\top}(Az_0) = \\frac{1}{52}\\begin{pmatrix} 15  4  4  2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -1/52 \\\\ -1/52 \\\\ 0 \\end{pmatrix} = \\frac{1}{52}(15 - \\frac{4}{52} - \\frac{4}{52}) = \\frac{1}{52}(15-\\frac{2}{13}) = \\frac{1}{52}(\\frac{195-2}{13}) = \\frac{193}{676}$。\n$\\alpha_0 = \\frac{15/52}{193/676} = \\frac{15}{52}\\frac{676}{193} = \\frac{15 \\times 13}{193} = \\frac{195}{193}$。\n新的残差为 $r_1^{\\mathrm{pre}} = r_0 - \\alpha_0 A p_0 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\frac{195}{193}\\begin{pmatrix} 1 \\\\ -1/52 \\\\ -1/52 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1-195/193 \\\\ 195/(193 \\cdot 52) \\\\ 195/(193 \\cdot 52) \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -2/193 \\\\ 195/10036 \\\\ 195/10036 \\\\ 0 \\end{pmatrix}$。\n其范数为 $\\|r_1^{\\mathrm{pre}}\\|_2 = \\sqrt{(-\\frac{2}{193})^2 + (\\frac{195}{193 \\cdot 52})^2 + (\\frac{195}{193 \\cdot 52})^2}$。\n由于 $\\frac{195}{52} = \\frac{15 \\cdot 13}{4 \\cdot 13} = \\frac{15}{4}$，我们有\n$\\|r_1^{\\mathrm{pre}}\\|_2^2 = \\frac{1}{193^2} \\left( (-2)^2 + 2 \\cdot (\\frac{15}{4})^2 \\right) = \\frac{1}{193^2} \\left( 4 + 2 \\frac{225}{16} \\right) = \\frac{1}{193^2} \\left( 4 + \\frac{225}{8} \\right) = \\frac{1}{193^2} \\left( \\frac{32+225}{8} \\right) = \\frac{257}{8 \\cdot 193^2}$。\n所以，$\\|r_1^{\\mathrm{pre}}\\|_2 = \\sqrt{\\frac{257}{8 \\cdot 193^2}} = \\frac{\\sqrt{257}}{193\\sqrt{8}} = \\frac{\\sqrt{257}}{193 \\cdot 2\\sqrt{2}}$。\n\n最后，我们计算改进因子 $\\mathcal{I}$。\n$\\mathcal{I} = \\frac{\\|r_1^{\\mathrm{unpre}}\\|_2}{\\|r_1^{\\mathrm{pre}}\\|_2} = \\frac{1/(2\\sqrt{2})}{\\sqrt{257}/(193 \\cdot 2\\sqrt{2})} = \\frac{1}{2\\sqrt{2}} \\cdot \\frac{193 \\cdot 2\\sqrt{2}}{\\sqrt{257}} = \\frac{193}{\\sqrt{257}}$。\n数字 $193$ 和 $257$ 都是素数，所以此表达式不能进一步简化。", "answer": "$$\\boxed{\\frac{193}{\\sqrt{257}}}$$", "id": "3370799"}, {"introduction": "要解决最大规模的科学计算问题，我们必须利用并行计算的力量。本练习将引导你进入稀疏直接求解器的高性能计算领域，运用图论思想分析嵌套剖分排序下的 Cholesky 分解 [@problem_id:3370792]。通过构建一个关于总工作量 (work) 和关键路径长度 (span) 的性能模型，你将学会如何设计并行调度策略并预测其加速效果，从而深刻理解算法结构如何决定其在现代计算机上的性能极限。", "problem": "考虑对称正定矩阵 $A$，该矩阵由单位正方形上泊松方程的标准五点有限差分格式离散化得到，其中内部网格大小为 $n \\times n$，并采用齐次狄利克雷边界条件，因此未知数的数量为 $N = n^{2}$。我们使用嵌套剖分排序对 $A$ 进行 Cholesky 分解，该排序由递归二分法定义，其中平面分离子的基数与网格宽度成正比。在离散化的网格图上运用图论推理来分析消去树并设计并行调度方案。\n\n采用以下建模假设，所有这些假设都是稀疏直接求解器分析中的标准抽象：\n\n- 在嵌套剖分层级 $l \\in \\{0,1,\\dots,k-1\\}$（其中 $k = \\log_{2}(n)$，假设 $n$ 是 2 的幂），有 $2^{l}$ 个不相交的分离子，每个分离子的大小为 $s_{l} = n / 2^{l}$。\n- 分解一个大小为 $s$ 的分离子的工作量（总操作数）与 $s^{3}$ 成正比，而在细粒度的前端内部并行下，该分离子的跨度（任务的有向无环图（DAG）中的关键路径时间）与 $s^{2}$ 成正比。通过选择时间单位，将比例常数设为 $1$。\n- 同一层级的分离子相互独立，可以并发处理；下一层级的分离子只有在其子节点完成后才能处理，这与消去树一致。\n- 对于 $p$ 个相同的核心和一个没有开销的理想贪心调度器，并行时间为 $T_{p} = \\max\\{W/p, S\\}$，其中 $W$ 是总工作量， $S$ 是跨度。\n\n任务：\n\n1. 在网格图上使用图论，确定在这种递归二分方案下消去树的深度（以从叶到根的嵌套剖分层级数衡量）。\n2. 使用上述模型，推导出总工作量 $W$ 和跨度 $S$ 作为 $n$ 的函数的封闭形式表达式（作为有限几何级数）。\n3. 设计一个层级同步的并行调度方案，通过利用分离子间和前端内的并发性来最小化串行化，并用 $n$ 和 $p$ 表示预测的加速比 $\\mathrm{Speedup}(p) = W / T_{p}$。\n4. 对于 $n = 256$ 和 $p = 1536$，计算预测的加速比。将你的最终答案以单个精确数字的形式给出（无需四舍五入）。", "solution": "首先对问题陈述进行验证。\n\n从问题陈述中提取的已知条件如下：\n- 矩阵 $A$ 是对称正定的。\n- 该矩阵由单位正方形网格上泊松方程的标准五点有限差分离散化得到，并采用齐次狄利克雷边界条件。\n- 内部网格大小为 $n \\times n$，导致 $N = n^{2}$ 个未知数。\n- 分解方法是使用嵌套剖分排序的 Cholesky 分解。\n- 参数 $n$ 是 2 的幂，且 $k = \\log_{2}(n)$。\n- 嵌套剖分过程包括层级 $l \\in \\{0, 1, \\dots, k-1\\}$。\n- 对于每个层级 $l$，有 $2^{l}$ 个不相交的分离子，每个的大小为 $s_{l} = n / 2^{l}$。\n- 分解一个大小为 $s$ 的分离子的计算工作量建模为 $s^{3}$。\n- 分解一个大小为 $s$ 的分离子的并行跨度（关键路径时间）建模为 $s^{2}$。\n- 同一层级的分离子可以并发处理。\n- 处理顺序遵循消去树的依赖关系（子分离子必须在其父分离子之前被消去）。\n- 在 $p$ 个相同核心上的并行执行时间由 $T_{p} = \\max\\{W/p, S\\}$ 建模，其中 $W$ 是总工作量， $S$ 是总跨度。\n\n基于这些已知条件对问题进行有效性评估。\n1.  **科学基础**：该问题在数值线性代数领域有坚实的基础，特别是针对偏微分方程产生的方程组的稀疏直接求解器分析。嵌套剖分算法、对对称正定系统使用 Cholesky 分解、将二维问题中大小为 $s$ 的分离子的工作量和跨度分别建模为 $s^3$ 和 $s^2$，以及并行性能模型，都是科学计算中标准且成熟的概念。\n2.  **适定性与一致性**：该问题是适定的。它提供了一套完整且内部一致的假设和定义。这些任务是完全基于所提供模型进行的具体数学推导。每个任务都可以确定唯一的解。假设 $n$ 是 2 的幂简化了分析，这是一种常见的教学技巧。\n3.  **客观性**：该问题以精确、客观、形式化的数学语言陈述，没有任何主观或模棱两可的术语。\n\n因此，该问题被认为是**有效的**，因为它描述了一个用于分析计算科学中经典算法性能的标准（尽管简化了的）理论模型。我们继续进行解答。\n\n**任务1：消去树的深度**\n\n嵌套剖分算法递归地二分网格。问题描述了一个包含 $k = \\log_{2}(n)$ 个分离子层级的过程，由 $l$ 从 $0$ 到 $k-1$ 索引。层级 $l=0$ 对应于第一个也是最大的分离子，它划分了整个网格。层级 $l=k-1$ 对应于最后一组最小的分离子。在 Cholesky 分解过程中，消去顺序与剖分顺序相反。最小、最深嵌套子域中的节点首先被消去，然后是层级 $l=k-1$ 的分离子，接着是层级 $l=k-2$ 的分离子，依此类推，直到根分离子（层级 $l=0$）最后被消去。\n\n消去树表示了这种依赖结构。网格中不属于任何分离子的节点构成了树的叶子。分离子本身构成了树的内部节点。消去树的深度是从任何叶节点到根的最长路径的长度。在这个模型中，分离子被组织成 $k$ 个不同的层级。从叶子到根的路径必须在每个层级穿过一个分离子。因此，树的深度，以从最低层分离子到根的嵌套剖分层级数来衡量，是 $k$。\n\n给定 $k = \\log_{2}(n)$，消去树的深度是 $\\log_{2}(n)$。\n\n**任务2：总工作量 $W$ 和跨度 $S$**\n\n总工作量 $W$ 是在所有层级上为所有分离子执行的工作之和。在给定的层级 $l$，有 $2^{l}$ 个分离子，每个的大小为 $s_{l} = n / 2^{l}$。对于一个大小为 $s_{l}$ 的分离子，其工作量为 $s_{l}^{3}$。\n\n层级 $l$ 的总工作量，记为 $W_{l}$，是分离子数量乘以每个分离子的工作量：\n$$W_{l} = 2^{l} \\times s_{l}^{3} = 2^{l} \\times \\left(\\frac{n}{2^{l}}\\right)^{3} = 2^{l} \\frac{n^{3}}{2^{3l}} = \\frac{n^{3}}{2^{2l}} = n^{3}\\left(\\frac{1}{4}\\right)^{l}$$\n总工作量 $W$ 是 $W_{l}$ 在所有层级 $l \\in \\{0, 1, \\dots, k-1\\}$ 上的总和：\n$$W = \\sum_{l=0}^{k-1} W_{l} = \\sum_{l=0}^{k-1} n^{3}\\left(\\frac{1}{4}\\right)^{l} = n^{3} \\sum_{l=0}^{k-1} \\left(\\frac{1}{4}\\right)^{l}$$\n这是一个有 $k$ 项的有限几何级数，首项 $a=1$，公比 $r=1/4$。其和为 $\\frac{1-r^{k}}{1-r}$。\n$$W = n^{3} \\left( \\frac{1 - (1/4)^{k}}{1 - 1/4} \\right) = n^{3} \\left( \\frac{1 - 1/4^{k}}{3/4} \\right) = \\frac{4}{3}n^{3}(1 - 1/4^{k})$$\n因为 $k = \\log_{2}(n)$，我们有 $n = 2^{k}$，所以 $n^{2} = (2^{k})^{2} = 4^{k}$。将此代入 $W$ 的表达式中：\n$$W = \\frac{4}{3}n^{3}\\left(1 - \\frac{1}{n^{2}}\\right) = \\frac{4}{3}(n^{3} - n)$$\n\n跨度 $S$ 是计算的关键路径长度。由于消去树中的依赖关系，层级 $l$ 的分离子分解必须在层级 $l+1$ 的分解完成后才能开始。总跨度是沿着从叶到根的单条路径上，每个层级一个分离子的跨度之和。大小为 $s_l$ 的分离子的跨度是 $s_l^2$。\n\n来自层级 $l$ 的跨度贡献，记为 $S_{l}$，是：\n$$S_{l} = s_{l}^{2} = \\left(\\frac{n}{2^{l}}\\right)^{2} = \\frac{n^{2}}{2^{2l}} = n^{2}\\left(\\frac{1}{4}\\right)^{l}$$\n总跨度 $S$ 是 $S_{l}$ 在所有层级 $l \\in \\{0, 1, \\dots, k-1\\}$ 上的总和：\n$$S = \\sum_{l=0}^{k-1} S_{l} = \\sum_{l=0}^{k-1} n^{2}\\left(\\frac{1}{4}\\right)^{l} = n^{2} \\sum_{l=0}^{k-1} \\left(\\frac{1}{4}\\right)^{l}$$\n使用与之前相同的几何级数求和公式：\n$$S = n^{2} \\left( \\frac{1 - (1/4)^{k}}{1 - 1/4} \\right) = \\frac{4}{3}n^{2}(1 - 1/4^{k}) = \\frac{4}{3}n^{2}\\left(1 - \\frac{1}{n^{2}}\\right) = \\frac{4}{3}(n^{2} - 1)$$\n\n所要求的封闭形式表达式为：\n$W(n) = n^{3} \\sum_{l=0}^{\\log_{2}(n)-1} (1/4)^l = \\frac{4}{3}(n^{3} - n)$\n$S(n) = n^{2} \\sum_{l=0}^{\\log_{2}(n)-1} (1/4)^l = \\frac{4}{3}(n^{2} - 1)$\n\n**任务3：并行调度和加速比**\n\n在 $p$ 个处理器上的并行时间由 $T_{p} = \\max\\{W/p, S\\}$ 给出。加速比定义为 $\\mathrm{Speedup}(p) = W / T_{p}$。代入 $T_{p}$ 的表达式：\n$$\\mathrm{Speedup}(p) = \\frac{W}{\\max\\{W/p, S\\}}$$\n我们可以代入推导出的 $W$ 和 $S$ 的表达式：\n$$\\mathrm{Speedup}(p) = \\frac{\\frac{4}{3}(n^{3} - n)}{\\max\\left\\{\\frac{\\frac{4}{3}(n^{3} - n)}{p}, \\frac{4}{3}(n^{2} - 1)\\right\\}}$$\n公共因子 $4/3$ 可以从分子和 $\\max$ 函数内的项中约去：\n$$\\mathrm{Speedup}(p) = \\frac{n^{3} - n}{\\max\\left\\{\\frac{n^{3} - n}{p}, n^{2} - 1\\right\\}}$$\n对表达式进行因式分解，我们注意到 $n^{3} - n = n(n^{2} - 1)$。对于 $n>1$，项 $n^{2}-1$ 是正的，可以从 $\\max$ 函数中提出：\n$$\\mathrm{Speedup}(p) = \\frac{n(n^{2} - 1)}{\\max\\left\\{\\frac{n(n^{2} - 1)}{p}, 1 \\cdot (n^{2} - 1)\\right\\}} = \\frac{n(n^{2} - 1)}{(n^{2} - 1) \\max\\left\\{\\frac{n}{p}, 1\\right\\}}$$\n约去 $(n^{2} - 1)$ 项：\n$$\\mathrm{Speedup}(p) = \\frac{n}{\\max\\{n/p, 1\\}}$$\n这个表达式可以分段解释。如果 $p \\le n$，则 $n/p \\ge 1$，所以 $\\max\\{n/p, 1\\} = n/p$，并且 $\\mathrm{Speedup}(p) = n / (n/p) = p$。如果 $p > n$，则 $n/p < 1$，所以 $\\max\\{n/p, 1\\} = 1$，并且 $\\mathrm{Speedup}(p) = n/1 = n$。\n这等价于表达式 $\\mathrm{Speedup}(p) = \\min\\{p, n\\}$。量 $W/S = \\frac{n(n^2-1)}{n^2-1} = n$ 代表了算法的平均并行度。\n\n**任务4：计算 $n = 256$ 和 $p = 1536$ 时的加速比**\n\n我们使用推导出的加速比公式以及给定的值 $n = 256$ 和 $p = 1536$。\n$$\\mathrm{Speedup}(1536) = \\min\\{1536, 256\\}$$\n这两个值的最小值是 $256$。\n$$\\mathrm{Speedup}(1536) = 256$$\n这个结果表明，加速比受限于算法固有的顺序瓶颈（跨度），而不是处理器的数量。根据该模型，此问题可实现的最大加速比为 $n$。", "answer": "$$\\boxed{256}$$", "id": "3370792"}]}