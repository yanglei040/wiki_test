{"hands_on_practices": [{"introduction": "后验误差分析的基石是“可靠性”（reliability）的概念，它确保我们的估计子为真实误差提供了一个可靠的上限。这一保证并非凭空而来，而是源于严谨的数学推导。这个基础性练习 ([@problem_id:3439898]) 将引导你完成证明可靠性的一个关键步骤：通过应用迹不等式（trace inequality）这一泛函分析中的基本工具，来确定诺伊曼（Neumann）边界残差项的正确缩放比例。", "problem": "考虑在有界利普希茨区域 $\\Omega \\subset \\mathbb{R}^{2}$ 上的带有混合狄利克雷-诺伊曼边界条件的二阶线性椭圆边值问题：\n$$\n-\\nabla \\cdot (\\boldsymbol{A} \\nabla u) = f \\quad \\text{in } \\Omega, \\qquad u = 0 \\quad \\text{on } \\Gamma_{D}, \\qquad \\boldsymbol{A}\\nabla u \\cdot \\boldsymbol{n} = g \\quad \\text{on } \\Gamma_{N},\n$$\n其中 $\\partial\\Omega = \\overline{\\Gamma_{D}} \\cup \\overline{\\Gamma_{N}}$，$\\Gamma_{D} \\cap \\Gamma_{N} = \\emptyset$，$\\boldsymbol{n}$ 是 $\\partial\\Omega$ 上的外单位法向量，$f \\in L^{2}(\\Omega)$，$g \\in L^{2}(\\Gamma_{N})$，并且 $\\boldsymbol{A}(x)$ 是一个一致有界且一致强制的对称正定(SPD)矩阵场，该矩阵场关于 $\\Omega$ 的一个协调、形状正则的单纯三角剖分 $\\mathcal{T}_{h}$ 是分片常数。令 $u_{h} \\in V_{h} \\subset H^{1}_{0}(\\Omega; \\Gamma_{D})$ 为协调分片线性伽辽金有限元近似解。\n\n定义单元和边上的标准残量如下。对于一个单元 $K \\in \\mathcal{T}_{h}$，令\n$$\nr_{K} := f + \\nabla \\cdot (\\boldsymbol{A}\\nabla u_{h}) \\in L^{2}(K).\n$$\n对于一条内部边 $E \\in \\mathcal{E}_{h}^{\\mathrm{int}}$，令 $J_{E} := \\llbracket \\boldsymbol{A}\\nabla u_{h} \\cdot \\boldsymbol{n}_{E} \\rrbracket$ 表示法向通量跨过 $E$ 的跳量。对于一条诺伊曼边界边 $E \\subset \\Gamma_{N}$，定义边界残量为\n$$\nR_{E} := g - \\boldsymbol{A}\\nabla u_{h}\\cdot \\boldsymbol{n} \\in L^{2}(E).\n$$\n令 $h_{K}$ 表示 $K$ 的直径，$h_{E}$ 表示 $E$ 的长度。考虑能量范数下的残量型后验误差估计子\n$$\n\\eta^{2} := \\sum_{K \\in \\mathcal{T}_{h}} h_{K}^{2}\\,\\|r_{K}\\|_{0,K}^{2} \\;+\\; \\sum_{E \\in \\mathcal{E}_{h}^{\\mathrm{int}}} h_{E}\\,\\|J_{E}\\|_{0,E}^{2} \\;+\\; \\sum_{E \\subset \\Gamma_{N}} h_{E}^{\\beta}\\,\\|R_{E}\\|_{0,E}^{2},\n$$\n其中 $\\beta > 0$ 是一个待定指数。由 $\\boldsymbol{A}$ 导出的能量半范数为\n$$\n\\|v\\|_{\\boldsymbol{A}}^{2} := \\int_{\\Omega} \\boldsymbol{A}\\nabla v \\cdot \\nabla v \\, dx.\n$$\n假设在每个单元 $K$ 上，对于边 $E \\subset \\partial K$ 均成立边界迹不等式：\n$$\n\\|w\\|_{0,E}^{2} \\le C_{\\mathrm{tr}} \\left( h_{E}^{-1}\\,\\|w\\|_{0,K}^{2} + h_{E}\\,\\|\\nabla w\\|_{0,K}^{2} \\right) \\quad \\text{for all } w \\in H^{1}(K),\n$$\n其中常数 $C_{\\mathrm{tr}}$ 仅依赖于 $\\mathcal{T}_{h}$ 的形状正则性，且与 $h$ 无关。从弱形式出发，并仅使用上述假设，推导诺伊曼边界残量贡献项的尺度关系，以确保可靠性界\n$$\n\\|u - u_{h}\\|_{\\boldsymbol{A}}^{2} \\;\\lesssim\\; \\eta^{2},\n$$\n成立，其中隐藏常数与网格尺寸无关。具体来说，确定指数 $\\beta$ 的值，使得为了通过边界迹不等式获得可靠性界，估计子中的边界残量项必须按 $h_{E}^{\\beta}\\,\\|R_{E}\\|_{0,E}^{2}$ 的尺度变化。你的最终答案必须是 $\\beta$ 的精确值，以单个数字形式给出。", "solution": "我们从模型问题的变分形式开始。精确解 $u \\in H^{1}_{0}(\\Omega; \\Gamma_{D})$ 满足\n$$\n\\int_{\\Omega} \\boldsymbol{A}\\nabla u \\cdot \\nabla v \\, dx \\;=\\; \\int_{\\Omega} f\\, v \\, dx \\;+\\; \\int_{\\Gamma_{N}} g\\, v \\, ds \\quad \\text{for all } v \\in H^{1}_{0}(\\Omega; \\Gamma_{D}).\n$$\n伽辽金有限元解 $u_{h} \\in V_{h} \\subset H^{1}_{0}(\\Omega; \\Gamma_{D})$ 满足\n$$\n\\int_{\\Omega} \\boldsymbol{A}\\nabla u_{h} \\cdot \\nabla v_{h} \\, dx \\;=\\; \\int_{\\Omega} f\\, v_{h} \\, dx \\;+\\; \\int_{\\Gamma_{N}} g\\, v_{h} \\, ds \\quad \\text{for all } v_{h} \\in V_{h}.\n$$\n令 $e := u - u_{h} \\in H^{1}_{0}(\\Omega; \\Gamma_{D})$ 表示误差。对于任意 $v \\in H^{1}_{0}(\\Omega; \\Gamma_{D})$，将两个弱形式相减得到\n$$\n\\int_{\\Omega} \\boldsymbol{A}\\nabla e \\cdot \\nabla v \\, dx \\;=\\; \\int_{\\Omega} f\\, v \\, dx \\;+\\; \\int_{\\Gamma_{N}} g\\, v \\, ds \\;-\\; \\int_{\\Omega} \\boldsymbol{A}\\nabla u_{h} \\cdot \\nabla v \\, dx.\n$$\n我们现在在每个单元 $K \\in \\mathcal{T}_{h}$ 上逐个分部积分。利用 $\\boldsymbol{A}$ 是分片常数以及 $v$ 是连续的，我们得到\n$$\n\\int_{\\Omega} \\boldsymbol{A}\\nabla u_{h} \\cdot \\nabla v \\, dx\n= \\sum_{K \\in \\mathcal{T}_{h}} \\left( - \\int_{K} \\nabla \\cdot (\\boldsymbol{A}\\nabla u_{h})\\, v \\, dx + \\int_{\\partial K} \\boldsymbol{A}\\nabla u_{h} \\cdot \\boldsymbol{n}_{K}\\, v \\, ds \\right).\n$$\n类似地，由于 $u$ 是精确解，我们有\n$$\n\\int_{\\Omega} f\\, v \\, dx = \\sum_{K \\in \\mathcal{T}_{h}} \\int_{K} f\\, v \\, dx, \\qquad \\int_{\\Gamma_{N}} g\\, v \\, ds = \\sum_{E \\subset \\Gamma_{N}} \\int_{E} g\\, v \\, ds.\n$$\n汇总这些表达式，并利用内部边上法向通量的抵消，我们得到标准残量分解：\n$$\n\\int_{\\Omega} \\boldsymbol{A}\\nabla e \\cdot \\nabla v \\, dx\n= \\sum_{K \\in \\mathcal{T}_{h}} \\int_{K} \\big( f + \\nabla \\cdot (\\boldsymbol{A}\\nabla u_{h}) \\big)\\, v \\, dx\n+ \\sum_{E \\in \\mathcal{E}_{h}^{\\mathrm{int}}} \\int_{E} \\llbracket \\boldsymbol{A}\\nabla u_{h} \\cdot \\boldsymbol{n}_{E} \\rrbracket \\, v \\, ds\n+ \\sum_{E \\subset \\Gamma_{N}} \\int_{E} \\big( g - \\boldsymbol{A}\\nabla u_{h} \\cdot \\boldsymbol{n} \\big)\\, v \\, ds.\n$$\n记 $r_{K} := f + \\nabla \\cdot (\\boldsymbol{A}\\nabla u_{h})$，$J_{E} := \\llbracket \\boldsymbol{A}\\nabla u_{h} \\cdot \\boldsymbol{n}_{E} \\rrbracket$ 以及 $R_{E} := g - \\boldsymbol{A}\\nabla u_{h} \\cdot \\boldsymbol{n}$，我们有\n$$\n\\int_{\\Omega} \\boldsymbol{A}\\nabla e \\cdot \\nabla v \\, dx\n= \\sum_{K \\in \\mathcal{T}_{h}} \\int_{K} r_{K}\\, v \\, dx\n+ \\sum_{E \\in \\mathcal{E}_{h}^{\\mathrm{int}}} \\int_{E} J_{E}\\, v \\, ds\n+ \\sum_{E \\subset \\Gamma_{N}} \\int_{E} R_{E}\\, v \\, ds.\n$$\n可靠性估计是通过对右侧的每一项进行放缩得到的，形式为局部贡献乘以 $\\|\\nabla v\\|_{0,K}$，然后对 $v$ 关于能量半范数 $\\|v\\|_{\\boldsymbol{A}}$ 取上确界。我们关注诺伊曼边界项。根据在 $E$ 上的柯西-施瓦茨不等式，\n$$\n\\left| \\int_{E} R_{E}\\, v \\, ds \\right|\n\\le \\|R_{E}\\|_{0,E}\\, \\|v\\|_{0,E}.\n$$\n在具有边 $E \\subset \\partial K$ 的单元 $K$ 上的边界迹不等式表明，对于任意 $w \\in H^{1}(K)$，\n$$\n\\|w\\|_{0,E}^{2} \\le C_{\\mathrm{tr}} \\left( h_{E}^{-1}\\,\\|w\\|_{0,K}^{2} + h_{E}\\,\\|\\nabla w\\|_{0,K}^{2} \\right).\n$$\n为了将其与能量半范数联系起来，我们在 $K$ 上对均值为零或在 $\\partial K$ 一部分上为零的函数使用局部庞加莱不等式（这是形状正则性和残量可靠性证明中局部检验函数构造的标准推论）：存在一个与 $h$ 无关的常数 $C_{\\mathrm{P}}$，使得\n$$\n\\|v\\|_{0,K} \\le C_{\\mathrm{P}}\\, h_{K}\\, \\|\\nabla v\\|_{0,K}.\n$$\n将此代入迹不等式，并使用形状正则性等价关系 $h_{K} \\simeq h_{E}$ (对于 $E \\subset \\partial K$)，我们得到\n$$\n\\|v\\|_{0,E}^{2}\n\\le C_{\\mathrm{tr}} \\left( h_{E}^{-1}\\, C_{\\mathrm{P}}^{2} h_{E}^{2}\\, \\|\\nabla v\\|_{0,K}^{2} + h_{E}\\, \\|\\nabla v\\|_{0,K}^{2} \\right)\n\\le C\\, h_{E}\\, \\|\\nabla v\\|_{0,K}^{2},\n$$\n其中 $C := C_{\\mathrm{tr}}(C_{\\mathrm{P}}^{2} + 1)$ 与网格尺寸无关。两边开方得到\n$$\n\\|v\\|_{0,E} \\le C^{1/2}\\, h_{E}^{1/2}\\, \\|\\nabla v\\|_{0,K}.\n$$\n因此，\n$$\n\\left| \\int_{E} R_{E}\\, v \\, ds \\right|\n\\le C^{1/2}\\, h_{E}^{1/2}\\, \\|R_{E}\\|_{0,E}\\, \\|\\nabla v\\|_{0,K}.\n$$\n令 $\\alpha_{0}, \\alpha_{1} > 0$ 为 $\\boldsymbol{A}$ 的强制性常数和有界性常数，即对于所有 $\\xi \\in \\mathbb{R}^{2}$ 和几乎处处的 $x$，$\\alpha_{0}\\, |\\xi|^{2} \\le \\xi^{\\top}\\boldsymbol{A}(x)\\,\\xi \\le \\alpha_{1}\\, |\\xi|^{2}$。那么\n$$\n\\alpha_{0}\\, \\|\\nabla v\\|_{0,K}^{2} \\le \\int_{K} \\boldsymbol{A}\\nabla v \\cdot \\nabla v \\, dx \\le \\alpha_{1}\\, \\|\\nabla v\\|_{0,K}^{2},\n$$\n所以 $\\|\\nabla v\\|_{0,K} \\lesssim \\|v\\|_{\\boldsymbol{A},K}$，其中 $\\|v\\|_{\\boldsymbol{A},K}^{2} := \\int_{K} \\boldsymbol{A}\\nabla v \\cdot \\nabla v \\, dx$。因此，\n$$\n\\left| \\int_{E} R_{E}\\, v \\, ds \\right| \\lesssim h_{E}^{1/2}\\, \\|R_{E}\\|_{0,E}\\, \\|v\\|_{\\boldsymbol{A},K}.\n$$\n将此界对所有诺伊曼边界边 $E \\subset \\Gamma_{N}$ 求和，并应用柯西-施瓦茨不等式得到\n$$\n\\sum_{E \\subset \\Gamma_{N}} \\left| \\int_{E} R_{E}\\, v \\, ds \\right|\n\\lesssim \\left( \\sum_{E \\subset \\Gamma_{N}} h_{E}\\, \\|R_{E}\\|_{0,E}^{2} \\right)^{1/2} \\left( \\sum_{E \\subset \\Gamma_{N}} \\|v\\|_{\\boldsymbol{A},K(E)}^{2} \\right)^{1/2},\n$$\n其中 $K(E)$ 表示与 $E$ 相连的单元。根据形状正则网格中边片(edge patch)的有限重叠性，$\\sum_{E \\subset \\Gamma_{N}} \\|v\\|_{\\boldsymbol{A},K(E)}^{2} \\lesssim \\|v\\|_{\\boldsymbol{A}}^{2}$。因此，\n$$\n\\sum_{E \\subset \\Gamma_{N}} \\left| \\int_{E} R_{E}\\, v \\, ds \\right| \\lesssim \\left( \\sum_{E \\subset \\Gamma_{N}} h_{E}\\, \\|R_{E}\\|_{0,E}^{2} \\right)^{1/2} \\|v\\|_{\\boldsymbol{A}}.\n$$\n对 $v \\in H^{1}_{0}(\\Omega; \\Gamma_{D})$ 且 $v \\neq 0$ 取上确界，并使用通过对偶性得到的能量半范数的刻画，\n$$\n\\|e\\|_{\\boldsymbol{A}} \\;=\\; \\sup_{0 \\neq v \\in H^{1}_{0}(\\Omega; \\Gamma_{D})} \\frac{\\int_{\\Omega} \\boldsymbol{A}\\nabla e \\cdot \\nabla v \\, dx}{\\|v\\|_{\\boldsymbol{A}}},\n$$\n我们看到诺伊曼边界残量对可靠性界的贡献精确地通过量 $\\sum_{E \\subset \\Gamma_{N}} h_{E}\\, \\|R_{E}\\|_{0,E}^{2}$。因此，为了保证\n$$\n\\|u - u_{h}\\|_{\\boldsymbol{A}}^{2} \\;\\lesssim\\; \\sum_{K \\in \\mathcal{T}_{h}} h_{K}^{2}\\,\\|r_{K}\\|_{0,K}^{2} \\;+\\; \\sum_{E \\in \\mathcal{E}_{h}^{\\mathrm{int}}} h_{E}\\,\\|J_{E}\\|_{0,E}^{2} \\;+\\; \\sum_{E \\subset \\Gamma_{N}} h_{E}^{\\beta}\\,\\|R_{E}\\|_{0,E}^{2},\n$$\n指数必须为 $\\beta = 1$，这样诺伊曼边界项才能按 $h_{E}\\,\\|R_{E}\\|_{0,E}^{2}$ 的尺度变化。这个选择直接源于在线性形式层面上，迹界中的因子 $h_{E}^{1/2}$，该因子在估计子中平方之后变为 $h_{E}$。", "answer": "$$\\boxed{1}$$", "id": "3439898"}, {"introduction": "从理论转向实践，我们将探讨两类主要的后验误差估计子：基于残差的（通常更严谨）和基于恢复的（通常是启发式的，但常常非常有效）。这项动手编程练习 ([@problem_id:3439906]) 让你能够实现并比较一个有可靠性保证的残差型估计子和广受欢迎的 Zienkiewicz-Zhu (ZZ) 恢复型估计子。通过构建一个ZZ估计子失效的场景，你将亲眼见证并量化其在特定情况下的“过度加密”风险，这在自适应方法的实际应用中是至关重要的一课。", "problem": "考虑单位区间上的稳态泊松方程的一维模型问题，其带有齐次Dirichlet边界条件：寻找一个函数 $u \\in H_0^1(0,1)$，使得对于所有测试函数 $v \\in H_0^1(0,1)$，\n$$\n\\int_{0}^{1} u'(x)\\,v'(x)\\,dx = \\int_{0}^{1} f(x)\\,v(x)\\,dx,\n$$\n其中源项由人工解 $u(x) = \\sin(2\\pi x)$ 给出，因此 $f(x) = -u''(x) = (2\\pi)^2 \\sin(2\\pi x)$。该数据在 $x = \\tfrac{1}{4}$ 和 $x = \\tfrac{3}{4}$ 处产生光滑极值，且在这些点处 $u'(x) = 0$。\n\n令 $u_h$ 表示在 $[0,1]$ 的一个给定剖分（网格）上的协调分片线性连续Galerkin有限元近似。该剖分将区间划分为单元 $K_i = [x_i, x_{i+1}]$，其节点为 $0 = x_0 < x_1 < \\dots < x_n = 1$，单元长度为 $h_i = x_{i+1} - x_i$。在每个单元 $K_i$ 上定义分片常数的有限元梯度为 $g_i = \\dfrac{u_h(x_{i+1}) - u_h(x_i)}{h_i}$。考虑两种标准的后验误差估计子：\n\n1. 一个有保证的基于残差的估计子。对每个单元 $K_i$，定义局部残差指示子为\n$$\n\\eta_i^2 = h_i^2 \\int_{K_i} f(x)^2\\,dx + \\frac{1}{2}\\,h_i\\,J_i^2 + \\frac{1}{2}\\,h_i\\,J_{i+1}^2,\n$$\n其中，在节点 $x_j$ 处的内部通量跳跃为 $J_j = g_j - g_{j-1}$（$1 \\le j \\le n-1$），而在Dirichlet边界处 $J_0 = J_n = 0$。全局残差估计子为 $\\eta = \\left(\\sum_{i=0}^{n-1} \\eta_i^2 \\right)^{1/2}$。已知在一维情况下，在标准形状正则性条件下，该估计子能以一个与网格无关的常数来界定误差的能量范数。\n\n2. 一个Zienkiewicz–Zhu (ZZ) 基于恢复的估计子。通过节点平均恢复一个连续的梯度场：对于内部节点 $1 \\le i \\le n-1$，设置\n$$\ng_i^{\\mathrm{rec}} = \\frac{h_{i-1}\\,g_{i-1} + h_i\\,g_i}{h_{i-1} + h_i},\n$$\n并在边界处设置 $g_0^{\\mathrm{rec}} = g_0$ 和 $g_n^{\\mathrm{rec}} = g_{n-1}$。在每个单元 $K_i$上，将恢复梯度定义为线性插值 $g^{\\mathrm{rec}}(x) = g_i^{\\mathrm{rec}}\\,\\lambda_i(x) + g_{i+1}^{\\mathrm{rec}}\\,\\lambda_{i+1}(x)$，其中局部帽子函数为 $\\lambda_i(x) = \\dfrac{x_{i+1} - x}{h_i}$ 和 $\\lambda_{i+1}(x) = \\dfrac{x - x_i}{h_i}$。局部ZZ指示子为\n$$\n\\zeta_i^2 = \\int_{K_i} \\left(g^{\\mathrm{rec}}(x) - g_i\\right)^2\\,dx,\n$$\n全局ZZ估计子为 $\\zeta = \\left(\\sum_{i=0}^{n-1} \\zeta_i^2 \\right)^{1/2}$。\n\n众所周知，在特定的对称性和正则性条件下，ZZ恢复梯度可以表现出超收敛性，在内部点附近将精度提高一个数量级。然而，在非均匀或非对称网格中，这种超收敛性可能会丧失，尤其是在真实梯度为零并改变符号的光滑极值点附近。在这种情况下，与有保证的基于残差的估计子相比，ZZ估计子可能会过度加密（即产生人为的大局部指示子）。\n\n您的任务是构造并分析一个反例，以证明由于超收敛性的丧失，ZZ估计子在光滑极值点附近存在过度加密现象。请使用在 $[0,1]$ 上的以下网格测试套件，并使用人工源项 $f(x) = (2\\pi)^2 \\sin(2\\pi x)$：\n\n- 测试用例1（均匀网格，基准）：$n = 64$ 个单元，节点为 $x_i = \\dfrac{i}{n}$，$i = 0,\\dots,64$。\n\n- 测试用例2（在极值点 $x^\\ast = \\tfrac{1}{4}$ 附近的交替扰动片）：$n = 64$，基础单元尺寸为 $h = \\dfrac{1}{n}$。令 $i^\\ast = \\lfloor n x^\\ast \\rfloor = 16$。对于十单元片 $i \\in \\{i^\\ast-5, i^\\ast-4, \\dots, i^\\ast+4\\}$，对于偶数偏移 $(i - (i^\\ast-5))$ 规定交替长度为 $h_i = 0.3\\,h$，对于奇数偏移则为 $h_i = 1.7\\,h$；对于所有其他单元，使用 $h_i = h$。这种构造保持总长度为1。\n\n- 测试用例3（在 $x^\\ast = \\tfrac{1}{4}$ 附近的强分级对称片）：$n = 64$，基础尺寸为 $h = \\dfrac{1}{n}$。令 $m = 21$ 且 $r = 2$。定义一个以索引 $i^\\ast$ 为中心的 $m$ 个单元的片，其长度为\n$$\nh_i = a\\,r^{\\left|i - i^\\ast\\right|}, \\quad \\text{for } i \\in \\{i^\\ast - \\tfrac{m-1}{2}, \\dots, i^\\ast + \\tfrac{m-1}{2}\\},\n$$\n其中选择 $a$ 以使这 $m$ 个单元的长度之和等于 $m\\,h$，即 $a = \\dfrac{m\\,h}{\\sum_{j=-\\frac{m-1}{2}}^{\\frac{m-1}{2}} r^{|j|}}$。在片外，设置 $h_i = h$。这会产生一个高度分级的网格，其最小单元位于极值点处。\n\n对于每个测试用例：\n- 组装分片线性有限元解 $u_h$。\n- 计算如上定义的单元残差估计子 $\\eta_i$ 和 ZZ估计子 $\\zeta_i$。\n- 识别“极值单元”的索引 $i_{\\mathrm{ext}}$，其中心点最接近 $x^\\ast = 0.25$。\n- 识别“远离单元”的索引 $i_{\\mathrm{far}}$，其中心点最接近 $x = 0.6$。\n- 计算比率 $R_{\\mathrm{ext}} = \\dfrac{\\zeta_{i_{\\mathrm{ext}}}}{\\eta_{i_{\\mathrm{ext}}}}$ 和 $R_{\\mathrm{far}} = \\dfrac{\\zeta_{i_{\\mathrm{far}}}}{\\eta_{i_{\\mathrm{far}}}}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个条目对应一个测试用例，并且本身是一个包含两个条目的列表 $[R_{\\mathrm{ext}}, R_{\\mathrm{far}}]$。例如，输出格式必须为：\n$$\n[\\,[R_{\\mathrm{ext}}^{(1)},R_{\\mathrm{far}}^{(1)}],[R_{\\mathrm{ext}}^{(2)},R_{\\mathrm{far}}^{(2)}],[R_{\\mathrm{ext}}^{(3)},R_{\\mathrm{far}}^{(3)}]\\,].\n$$\n所有值均为纯实数；不适用任何物理单位或角度单位。该测试套件旨在揭示不良行为：在测试用例2和测试用例3中，与基准均匀情况相比，极值点附近的比率应显著超过远离极值点处的比率。", "solution": "解决该问题的数值方法遵循以下步骤，并对三个测试用例分别执行：\n\n1.  **网格生成**：根据每个测试用例（均匀、局部扰动、局部分级）的规则，生成包含 $n=64$ 个单元的节点坐标 $x_0, \\dots, x_n$ 和单元长度 $h_i$。\n\n2.  **有限元求解**：使用分片线性 ($P_1$) 基函数求解一维泊松方程。这需要组装一个 $(n-1) \\times (n-1)$ 的三对角刚度矩阵 $\\mathbf{A}$ 和一个载荷向量 $\\mathbf{b}$，用于内部节点 $j=1, \\dots, n-1$。\n    - 刚度矩阵的元素为 $A_{j,j} = \\frac{1}{h_{j-1}} + \\frac{1}{h_j}$ 以及 $A_{j, j-1} = -\\frac{1}{h_{j-1}}$ 和 $A_{j, j+1} = -\\frac{1}{h_j}$。\n    - 载荷向量的元素 $b_j = \\int_0^1 f(x) \\phi_j(x) dx$ 通过对源项进行数值积分（例如，高斯求积）来计算。\n    - 求解线性系统 $\\mathbf{A}\\mathbf{U} = \\mathbf{b}$ 得到内部节点的解向量 $\\mathbf{U} = [U_1, \\dots, U_{n-1}]^T$。完整的解向量通过施加边界条件 $U_0 = U_n = 0$ 获得。\n\n3.  **计算误差估计子**：\n    - **分片常数梯度**：在每个单元 $K_i$ 上，从解 $u_h$ 计算出梯度 $g_i = (U_{i+1} - U_i)/h_i$。\n    - **基于残差的估计子 ($\\eta_i$)**：对每个单元 $K_i$，计算单元内残差项 $h_i^2 \\int_{K_i} f(x)^2 dx$ 和通量跳跃项 $\\frac{1}{2}h_i(J_i^2 + J_{i+1}^2)$，其中 $J_j = g_j - g_{j-1}$ 是节点 $x_j$ 处的梯度跳跃。将它们相加得到 $\\eta_i^2$。\n    - **Zienkiewicz-Zhu (ZZ) 估计子 ($\\zeta_i$)**：首先，通过对相邻单元的梯度进行加权平均，在每个节点 $x_j$ 处计算一个恢复梯度 $g_j^{\\mathrm{rec}}$。然后，在每个单元 $K_i$ 内，通过对节点值 $g_i^{\\mathrm{rec}}$ 和 $g_{i+1}^{\\mathrm{rec}}$ 进行线性插值，得到一个连续的恢复梯度场 $g^{\\mathrm{rec}}(x)$。最后，通过计算积分 $\\int_{K_i} (g^{\\mathrm{rec}}(x) - g_i)^2 dx$ 来得到 $\\zeta_i^2$。\n\n4.  **计算比率**：对于每个测试用例，找到最接近 $x=0.25$ 的极值单元 $i_{\\mathrm{ext}}$ 和最接近 $x=0.6$ 的远离单元 $i_{\\mathrm{far}}$。计算并记录比率 $R_{\\mathrm{ext}} = \\sqrt{\\zeta_{i_{\\mathrm{ext}}}^2} / \\sqrt{\\eta_{i_{\\mathrm{ext}}}^2}$ 和 $R_{\\mathrm{far}} = \\sqrt{\\zeta_{i_{\\mathrm{far}}}^2} / \\sqrt{\\eta_{i_{\\mathrm{far}}}^2}$。\n\n最终，将所有测试用例的结果整理成问题所要求的列表格式。", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis for all test cases and print the results.\n    \"\"\"\n    \n    # Define source term f(x) and its square\n    f = lambda x: (2 * np.pi)**2 * np.sin(2 * np.pi * x)\n    f_squared = lambda x: f(x)**2\n    \n    n = 64\n    h_base = 1.0 / n\n    x_star_ext = 0.25\n    x_star_far = 0.6\n\n    # Test Case 1: Uniform mesh\n    h_vec1 = np.full(n, h_base)\n\n    # Test Case 2: Alternating perturbed patch\n    h_vec2 = np.full(n, h_base)\n    i_star = int(np.floor(n * x_star_ext))  # 16\n    patch_start_idx = i_star - 5 # 11\n    patch_end_idx = i_star + 4   # 20\n    for i in range(patch_start_idx, patch_end_idx + 1):\n        offset = i - patch_start_idx\n        if offset % 2 == 0:\n            h_vec2[i] = 0.3 * h_base\n        else:\n            h_vec2[i] = 1.7 * h_base\n    # Rescale to ensure total length is exactly 1\n    h_vec2 *= 1.0 / np.sum(h_vec2)\n\n    # Test Case 3: Strongly graded symmetric patch\n    h_vec3 = np.full(n, h_base)\n    i_star = int(np.floor(n * x_star_ext)) # 16\n    m = 21\n    r = 2.0\n    patch_half_width = (m - 1) // 2 # 10\n    patch_start_idx = i_star - patch_half_width # 6\n    patch_end_idx = i_star + patch_half_width   # 26\n    \n    # Sum for scaling factor 'a'\n    sum_geom = 1.0 + 2.0 * np.sum([r**j for j in range(1, patch_half_width + 1)])\n    a = (m * h_base) / sum_geom\n    \n    for i in range(patch_start_idx, patch_end_idx + 1):\n        h_vec3[i] = a * (r**np.abs(i - i_star))\n    \n    # Rescale to ensure total length is exactly 1\n    h_vec3 *= 1.0 / np.sum(h_vec3)\n\n    test_cases = [h_vec1, h_vec2, h_vec3]\n    \n    results = []\n    for h_vec in test_cases:\n        ratios = _compute_for_case(n, h_vec, f, f_squared, x_star_ext, x_star_far)\n        results.append(ratios)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef _compute_for_case(n, h_vec, f, f_squared, x_star_ext, x_star_far):\n    \"\"\"\n    Computes the estimator ratios for a single mesh configuration.\n    \"\"\"\n    # 1. Mesh Generation\n    x_nodes = np.zeros(n + 1)\n    x_nodes[1:] = np.cumsum(h_vec)\n\n    # 2. Finite Element Solution\n    # Assemble stiffness matrix A and load vector b for interior nodes\n    A_banded = np.zeros((3, n - 1))\n    b = np.zeros(n - 1)\n\n    # Main diagonal\n    A_banded[1, :] = 1.0 / h_vec[:-1] + 1.0 / h_vec[1:]\n    # Upper diagonal\n    A_banded[0, 1:] = -1.0 / h_vec[1:-1]\n    # Lower diagonal\n    A_banded[2, :-1] = -1.0 / h_vec[1:-1]\n\n    # Assemble load vector b\n    for k in range(1, n):\n        # Integral over [x_{k-1}, x_k]\n        integrand1 = lambda x: f(x) * (x - x_nodes[k-1]) / h_vec[k-1]\n        b[k-1] += quad(integrand1, x_nodes[k-1], x_nodes[k])[0]\n        # Integral over [x_k, x_{k+1}]\n        integrand2 = lambda x: f(x) * (x_nodes[k+1] - x) / h_vec[k]\n        b[k-1] += quad(integrand2, x_nodes[k], x_nodes[k+1])[0]\n\n    # Solve for interior nodal values U\n    U_interior = solve_banded((1, 1), A_banded, b)\n    U = np.concatenate(([0], U_interior, [0]))\n\n    # 3. Compute Estimators\n    # FEM gradient g_i on each element K_i\n    g = (U[1:] - U[:-1]) / h_vec\n    \n    # --- Residual Estimator ---\n    eta_sq = np.zeros(n)\n    # Flux jumps J_j at each interior node x_j\n    Jumps = np.zeros(n + 1)\n    Jumps[1:n] = g[1:] - g[:-1]\n    \n    for i in range(n):\n        # Element residual term\n        term1 = h_vec[i]**2 * quad(f_squared, x_nodes[i], x_nodes[i+1])[0]\n        # Jump residual term\n        term2 = 0.5 * h_vec[i] * (Jumps[i]**2 + Jumps[i+1]**2)\n        eta_sq[i] = term1 + term2\n\n    # --- ZZ Estimator ---\n    zeta_sq = np.zeros(n)\n    # Recovered gradient g_rec at nodes\n    g_rec = np.zeros(n + 1)\n    g_rec[0] = g[0]\n    g_rec[n] = g[n-1]\n    g_rec[1:n] = (h_vec[:-1] * g[:-1] + h_vec[1:] * g[1:]) / (h_vec[:-1] + h_vec[1:])\n\n    for i in range(n):\n        # Integral of (g_rec(x) - g_i)^2 over K_i\n        A = g_rec[i+1] - g_rec[i]\n        B = g_rec[i] - g[i]\n        zeta_sq[i] = h_vec[i] * (A**2 / 3.0 + A * B + B**2)\n\n    # 4. Analysis\n    midpoints = (x_nodes[:-1] + x_nodes[1:]) / 2.0\n    i_ext = np.argmin(np.abs(midpoints - x_star_ext))\n    i_far = np.argmin(np.abs(midpoints - x_star_far))\n    \n    zeta_i_ext = np.sqrt(zeta_sq[i_ext])\n    eta_i_ext = np.sqrt(eta_sq[i_ext])\n    \n    zeta_i_far = np.sqrt(zeta_sq[i_far])\n    eta_i_far = np.sqrt(eta_sq[i_far])\n    \n    R_ext = zeta_i_ext / eta_i_ext\n    R_far = zeta_i_far / eta_i_far\n\n    return [R_ext, R_far]\n\nsolve()\n```", "id": "3439906"}]}