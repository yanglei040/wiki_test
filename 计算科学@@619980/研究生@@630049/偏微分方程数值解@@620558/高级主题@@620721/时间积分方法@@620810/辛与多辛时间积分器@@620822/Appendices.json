{"hands_on_practices": [{"introduction": "一个数值方法被称为辛方法，其核心在于它的雅可比矩阵必须满足一个特定的代数约束。本次练习将通过一个简单的例子——显式欧拉法——来直接应用这一抽象定义，从而巩固您的理解。通过计算，您将具体地看到为何这种常见的方法无法保持辛结构，进而理解为何我们需要专门的辛积分器 [@problem_id:3451935]。", "problem": "考虑一个二维正则哈密顿系统，其相向量为 $y = (q,p)^{\\top}$，标准辛矩阵为 $J = \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix}$。一个步长为 $h$ 的单步法，记为 $\\Psi_h: \\mathbb{R}^2 \\to \\mathbb{R}^2$，如果其雅可比矩阵满足雅可比约束 $D\\Psi_h(y)^{\\top} J D\\Psi_h(y) = J$ 对所有 $y$ 成立，则该方法称为辛方法。从可分离的二次哈密顿量 $H(q,p) = \\tfrac{1}{2}(p^2 + q^2)$ 的哈密顿正则方程出发，推导显式欧拉单步映射 $\\Psi_h$ 及其雅可比矩阵。然后，仅使用辛性的定义和基本线性代数，证明对于此方法存在一个标量因子 $\\lambda(h)$，使得 $D\\Psi_h(y)^{\\top} J D\\Psi_h(y) = \\lambda(h)\\, J$。以 $h$ 的符号表达式形式计算 $\\lambda(h)$ 的闭式解，并用它来判断显式欧拉法对于非零 $h$ 是否满足辛性约束。以 $\\lambda(h)$ 的单个符号表达式形式提供最终答案，不带单位。无需进行数值取整。", "solution": "对问题陈述的有效性进行严格评估。\n\n**步骤1：提取已知条件**\n- **系统：** 一个二维正则哈密顿系统。\n- **相向量：** $y = (q,p)^{\\top}$。\n- **辛矩阵：** $J = \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix}$。\n- **单步法：** $\\Psi_h: \\mathbb{R}^2 \\to \\mathbb{R}^2$，步长为 $h$。\n- **辛性条件：** 若一个方法的雅可比矩阵 $D\\Psi_h(y)$ 对所有 $y$ 满足 $D\\Psi_h(y)^{\\top} J D\\Psi_h(y) = J$，则该方法是辛的。\n- **哈密顿量：** $H(q,p) = \\frac{1}{2}(p^2 + q^2)$。\n- **待分析方法：** 显式欧拉法。\n- **任务：**\n    1. 推导显式欧拉单步映射 $\\Psi_h$ 及其雅可比矩阵 $D\\Psi_h(y)$。\n    2. 证明对于某个标量 $\\lambda(h)$，有 $D\\Psi_h(y)^{\\top} J D\\Psi_h(y) = \\lambda(h) J$。\n    3. 计算 $\\lambda(h)$ 的闭式表达式。\n    4. 使用 $\\lambda(h)$ 判断当 $h \\neq 0$ 时，显式欧拉法是否是辛的。\n- **最终答案要求：** 提供 $\\lambda(h)$ 的单个符号表达式。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题牢固地植根于经典力学（哈密顿系统）和数值分析（常微分方程的数值解，特别是几何积分）领域。简谐振子的哈密顿量、显式欧拉法以及辛映射的定义都是标准且成熟的概念。\n- **适定性：** 该问题是适定的。它提供了一个特定的哈密顿量和一个特定的数值积分器，并要求一个清晰、可推导的数学属性（$\\lambda(h)$ 的值）。所有必要的信息都已给出，足以得出一个唯一的解。\n- **客观性：** 该问题以精确、客观的数学语言陈述，没有任何主观论断。\n\n**步骤3：结论与行动**\n该问题在科学上是合理的、适定的、客观的且自洽的。这是数值分析中的一个有效练习。因此，将推导其解。\n\n第一步是利用哈密顿正则方程从给定的哈密顿量 $H(q,p) = \\frac{1}{2}(p^2 + q^2)$ 推导出常微分方程组：\n$$\n\\dot{q} = \\frac{\\partial H}{\\partial p} \\\\\n\\dot{p} = -\\frac{\\partial H}{\\partial q}\n$$\n计算 $H$ 的偏导数：\n$$\n\\frac{\\partial H}{\\partial p} = p \\\\\n\\frac{\\partial H}{\\partial q} = q\n$$\n将这些代入哈密顿方程得到方程组：\n$$\n\\dot{q} = p \\\\\n\\dot{p} = -q\n$$\n以向量形式，设 $y = (q,p)^{\\top}$，该系统可以写成 $\\dot{y} = f(y)$，其中 $f(y) = \\begin{pmatrix} p \\\\ -q \\end{pmatrix}$。\n\n接下来，我们将显式欧拉法应用于此系统。对于初值问题 $\\dot{y} = f(y)$，显式欧拉法由递推关系 $y_{n+1} = y_n + h f(y_n)$ 给出，其中 $h$ 是步长。单步映射 $\\Psi_h$ 定义为 $y_{n+1} = \\Psi_h(y_n)$。令 $y = (q,p)^{\\top}$。因此，映射 $\\Psi_h$ 为：\n$$\n\\Psi_h(y) = y + h f(y) = \\begin{pmatrix} q \\\\ p \\end{pmatrix} + h \\begin{pmatrix} p \\\\ -q \\end{pmatrix} = \\begin{pmatrix} q + hp \\\\ p - hq \\end{pmatrix}\n$$\n这是应用于给定哈密顿系统的显式欧拉法的单步映射的显式形式。\n\n下一步是计算此映射的雅可比矩阵 $D\\Psi_h(y)$。$\\Psi_h(y)$ 的分量是 $\\Psi_{h,1}(q,p) = q + hp$ 和 $\\Psi_{h,2}(q,p) = p - hq$。雅可比矩阵为：\n$$\nD\\Psi_h(y) = \\begin{pmatrix} \\frac{\\partial \\Psi_{h,1}}{\\partial q}  \\frac{\\partial \\Psi_{h,1}}{\\partial p} \\\\ \\frac{\\partial \\Psi_{h,2}}{\\partial q}  \\frac{\\partial \\Psi_{h,2}}{\\partial p} \\end{pmatrix}\n$$\n计算偏导数：\n$$\n\\frac{\\partial}{\\partial q}(q + hp) = 1 \\\\\n\\frac{\\partial}{\\partial p}(q + hp) = h \\\\\n\\frac{\\partial}{\\partial q}(p - hq) = -h \\\\\n\\frac{\\partial}{\\partial p}(p - hq) = 1\n$$\n因此，雅可比矩阵是常数，由下式给出：\n$$\nD\\Psi_h(y) = M = \\begin{pmatrix} 1  h \\\\ -h  1 \\end{pmatrix}\n$$\n为检验辛性，我们必须计算乘积 $M^{\\top} J M$。$M$ 的转置是：\n$$\nM^{\\top} = \\begin{pmatrix} 1  -h \\\\ h  1 \\end{pmatrix}\n$$\n现在，我们进行矩阵乘法。首先，我们计算 $M^{\\top}J$：\n$$\nM^{\\top}J = \\begin{pmatrix} 1  -h \\\\ h  1 \\end{pmatrix} \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix} = \\begin{pmatrix} (1)(0) + (-h)(-1)  (1)(1) + (-h)(0) \\\\ (h)(0) + (1)(-1)  (h)(1) + (1)(0) \\end{pmatrix} = \\begin{pmatrix} h  1 \\\\ -1  h \\end{pmatrix}\n$$\n接下来，将此结果乘以 $M$：\n$$\n(M^{\\top}J)M = \\begin{pmatrix} h  1 \\\\ -1  h \\end{pmatrix} \\begin{pmatrix} 1  h \\\\ -h  1 \\end{pmatrix} = \\begin{pmatrix} (h)(1) + (1)(-h)  (h)(h) + (1)(1) \\\\ (-1)(1) + (h)(-h)  (-1)(h) + (h)(1) \\end{pmatrix}\n$$\n化简各项得：\n$$\nM^{\\top} J M = \\begin{pmatrix} h - h  h^2 + 1 \\\\ -1 - h^2  -h + h \\end{pmatrix} = \\begin{pmatrix} 0  1+h^2 \\\\ -(1+h^2)  0 \\end{pmatrix}\n$$\n我们可以提出标量项 $(1+h^2)$：\n$$\n\\begin{pmatrix} 0  1+h^2 \\\\ -(1+h^2)  0 \\end{pmatrix} = (1+h^2) \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix} = (1+h^2)J\n$$\n此结果的形式为 $\\lambda(h)J$，其中标量因子为 $\\lambda(h) = 1+h^2$。\n\n一个方法是辛方法的条件是其雅可比矩阵 $M$ 必须满足 $M^{\\top} J M = J$。在我们的例子中，这要求 $\\lambda(h) = 1$。\n将我们推导出的 $\\lambda(h)$ 表达式设为 $1$：\n$$\n1+h^2 = 1\n$$\n这意味着 $h^2 = 0$，仅当 $h=0$ 时成立。对于任何非零步长 $h \\neq 0$，我们有 $h^2 > 0$，因此 $\\lambda(h) = 1+h^2 > 1$。所以，对于任何非零步长，显式欧拉法对该系统不是辛的。问题要求 $\\lambda(h)$ 的闭式符号表达式。\n\n推导出的表达式是 $\\lambda(h) = 1+h^2$。", "answer": "$$\n\\boxed{1+h^2}\n$$", "id": "3451935"}, {"introduction": "在了解了一个非辛方法的例子之后，我们现在转向一个经典的辛积分器：辛蛙跳法（或称 Störmer–Verlet 方法）。结构保持方法的一个关键优势是其出色的长期稳定性。本练习将引导您对应用于波动方程的蛙跳法进行稳定性分析，从而揭示其精确的稳定性边界，这是实际计算中的一个至关重要的方面 [@problem_id:3451899]。", "problem": "考虑一个半离散波动方程，例如，该方程可由线性波动模型的质量集中有限元空间离散化得到，\n$$\n\\frac{\\mathrm{d}^{2}}{\\mathrm{d}t^{2}} u(t) + A\\,u(t) = 0,\n$$\n其中 $u(t) \\in \\mathbb{R}^{N}$，$A \\in \\mathbb{R}^{N \\times N}$ 是实对称半正定矩阵，其谱半径为 $\\rho(A) = \\max\\{ \\lambda : \\lambda \\text{ is an eigenvalue of } A \\}$。假设质量矩阵是单位矩阵，因此动能由欧几里得范数给出。哈密顿量为\n$$\nH(u,v) = \\frac{1}{2}\\|v\\|^{2} + \\frac{1}{2} u^{\\top} A u,\n$$\n其中 $v(t) = \\frac{\\mathrm{d}}{\\mathrm{d}t}u(t)$。\n\n对该系统应用常数时间步长 $\\Delta t > 0$ 的辛蛙跳（也称 Störmer–Verlet）时间积分器，其定义为\n$$\nv^{n+\\frac{1}{2}} = v^{n-\\frac{1}{2}} - \\Delta t\\,A\\,u^{n}, \\qquad\nu^{n+1} = u^{n} + \\Delta t\\,v^{n+\\frac{1}{2}},\n$$\n对于整数 $n \\ge 0$。仅使用模态分解和线性稳定性分析的基本原理，推导一个关于 $\\Delta t$ 的 Courant–Friedrichs–Lewy (CFL) 型稳定性条件，以确保该方法对所有与 $A$ 相关的模态都是线性稳定的。将允许的最大时间步长表示为关于 $\\rho(A)$ 的单个闭式解析表达式。最终答案必须是单个解析表达式；不包含任何单位。", "solution": "问题要求为应用于半离散波动方程 $\\frac{\\mathrm{d}^{2}}{\\mathrm{d}t^{2}} u(t) + A\\,u(t) = 0$ 的辛蛙跳 (Störmer–Verlet) 方法推导一个 Courant–Friedrichs–Lewy (CFL) 型稳定性条件。分析将基于模态分解。\n\n蛙跳法由以下方程组给出：\n$$\nv^{n+\\frac{1}{2}} = v^{n-\\frac{1}{2}} - \\Delta t\\,A\\,u^{n}\n$$\n$$\nu^{n+1} = u^{n} + \\Delta t\\,v^{n+\\frac{1}{2}}\n$$\n为便于稳定性分析，我们首先将这两个方程合并为关于 $u^{n}$ 的单个三项递推关系。从第二个方程，我们可以将 $v^{n+\\frac{1}{2}}$ 表示为：\n$$\nv^{n+\\frac{1}{2}} = \\frac{u^{n+1} - u^{n}}{\\Delta t}\n$$\n类似地，对于前一个时间步，我们有：\n$$\nv^{n-\\frac{1}{2}} = \\frac{u^{n} - u^{n-1}}{\\Delta t}\n$$\n将 $v^{n+\\frac{1}{2}}$ 和 $v^{n-\\frac{1}{2}}$ 的这些表达式代入第一个蛙跳方程，得到：\n$$\n\\frac{u^{n+1} - u^{n}}{\\Delta t} = \\frac{u^{n} - u^{n-1}}{\\Delta t} - \\Delta t\\,A\\,u^{n}\n$$\n两边乘以 $\\Delta t$ 并重新整理各项，我们得到关于 $u$ 的显式三层格式：\n$$\nu^{n+1} - 2u^{n} + u^{n-1} = -(\\Delta t)^{2} A u^{n}\n$$\n该方程可以重写为：\n$$\nu^{n+1} = (2I - (\\Delta t)^{2} A)u^{n} - u^{n-1}\n$$\n其中 $I$ 是 $\\mathbb{R}^{N \\times N}$ 中的单位矩阵。\n\n该向量递推关系的稳定性由其独立模态的稳定性决定。给定矩阵 $A$ 是实对称半正定的。因此，它拥有一套完备的标准正交特征向量。设 $Q$ 是一个正交矩阵，其列是 $A$ 的特征向量，并设 $\\Lambda$ 是相应特征值 $\\lambda_k \\ge 0$（其中 $k=1, \\dots, N$）组成的对角矩阵。我们可以将 $A$ 的谱分解写为 $A = Q \\Lambda Q^{\\top}$。\n\n我们通过定义 $\\hat{u}^{n} = Q^{\\top}u^{n}$ 来进行到模态坐标的基变换。将 $u^{n} = Q\\hat{u}^{n}$ 代入递推关系得到：\n$$\nQ\\hat{u}^{n+1} - 2Q\\hat{u}^{n} + Q\\hat{u}^{n-1} = -(\\Delta t)^{2} (Q \\Lambda Q^{\\top}) (Q\\hat{u}^{n})\n$$\n从左侧乘以 $Q^{\\top}$ 并利用 $Q^{\\top}Q=I$ 的性质，我们得到：\n$$\n\\hat{u}^{n+1} - 2\\hat{u}^{n} + \\hat{u}^{n-1} = -(\\Delta t)^{2} \\Lambda \\hat{u}^{n}\n$$\n这个向量方程解耦为 $N$ 个独立的标量方程，每个方程对应一个与特征值 $\\lambda_k$ 相关的模态分量 $\\hat{u}_{k}^{n}$：\n$$\n\\hat{u}_{k}^{n+1} - 2\\hat{u}_{k}^{n} + \\hat{u}_{k}^{n-1} = -(\\Delta t)^{2} \\lambda_k \\hat{u}_{k}^{n}\n$$\n为了分析此标量递推的稳定性，我们使用 von Neumann 方法，寻求形式为 $\\hat{u}_{k}^{n} = g^{n} \\hat{u}_{k}^{0}$ 的解，其中 $g$ 是放大因子。将此假设代入方程，我们得到：\n$$\ng^{n+1}\\hat{u}_{k}^{0} - 2g^{n}\\hat{u}_{k}^{0} + g^{n-1}\\hat{u}_{k}^{0} = -(\\Delta t)^{2} \\lambda_k g^{n}\\hat{u}_{k}^{0}\n$$\n假设初始条件非平凡（$\\hat{u}_{k}^{0} \\ne 0$）并除以 $g^{n-1}$，我们得到放大因子 $g$ 的特征方程：\n$$\ng^2 - 2g + 1 = -(\\Delta t)^{2} \\lambda_k g\n$$\n$$\ng^2 - \\left(2 - (\\Delta t)^{2} \\lambda_k\\right) g + 1 = 0\n$$\n为使数值解保持有界（即，为使方法线性稳定），该二次方程的根 $g$ 的模必须小于或等于 1：$|g| \\le 1$。二次方程 $ax^2+bx+c=0$ 的根之积为 $c/a$。在我们的例子中，两个根的乘积是 $1$。如果一个根 $g_1$ 的模 $|g_1| > 1$，那么另一个根 $g_2 = 1/g_1$ 的模必定是 $|g_2|  1$。存在模大于 1 的根会导致相应模态指数增长，从而引起不稳定性。因此，为了保证稳定性，两个根的模都必须恰好为 1，即 $|g|=1$。\n\n具有实系数的二次方程的根的模为 1，当且仅当它们是位于单位圆上的一对共轭复数。这在二次方程的判别式为非正时发生。判别式 $D$ 为：\n$$\nD = \\left(2 - (\\Delta t)^{2} \\lambda_k\\right)^{2} - 4(1)(1)\n$$\n稳定性条件为 $D \\le 0$：\n$$\n\\left(2 - (\\Delta t)^{2} \\lambda_k\\right)^{2} - 4 \\le 0\n$$\n$$\n\\left(2 - (\\Delta t)^{2} \\lambda_k\\right)^{2} \\le 4\n$$\n两边取平方根，得到：\n$$\n|2 - (\\Delta t)^{2} \\lambda_k| \\le 2\n$$\n这个不等式等价于下面的一对不等式：\n$$\n-2 \\le 2 - (\\Delta t)^{2} \\lambda_k \\le 2\n$$\n我们分别分析这两个不等式。\n1. 右侧不等式：$2 - (\\Delta t)^{2} \\lambda_k \\le 2 \\implies -(\\Delta t)^{2} \\lambda_k \\le 0$。由于 $\\Delta t > 0$ 且 $A$ 是半正定的，其特征值是非负的，$\\lambda_k \\ge 0$。因此，$(\\Delta t)^{2} \\lambda_k \\ge 0$，这个不等式恒成立。\n2. 左侧不等式：$-2 \\le 2 - (\\Delta t)^{2} \\lambda_k \\implies (\\Delta t)^{2} \\lambda_k \\le 4$。\n\n这个条件 $(\\Delta t)^{2} \\lambda_k \\le 4$ 必须对所有模态都成立，即对 $A$ 的所有特征值 $\\lambda_k$ 都成立。为确保整个系统的稳定性，时间步长 $\\Delta t$ 必须满足这些条件中最严格的一个。最严格的情况对应于 $\\lambda_k$ 的最大可能值。$A$ 的最大特征值是其谱半径，$\\rho(A) = \\max_k \\{ \\lambda_k \\}$。\n因此，整个系统的稳定性条件是：\n$$\n(\\Delta t)^{2} \\rho(A) \\le 4\n$$\n如果 $\\rho(A) = 0$，那么 $A$ 必定是零矩阵（因为它是半正定的），该条件对任何 $\\Delta t$ 都平凡满足。如果 $\\rho(A) > 0$，我们可以解出 $\\Delta t$：\n$$\n(\\Delta t)^{2} \\le \\frac{4}{\\rho(A)}\n$$\n因为 $\\Delta t > 0$，我们取正平方根：\n$$\n\\Delta t \\le \\frac{2}{\\sqrt{\\rho(A)}}\n$$\n问题要求的是允许的最大时间步长，这对应于上述条件中的等号情况。这就是应用于该系统的蛙跳法的 CFL 型稳定性极限。\n$$\n\\Delta t_{\\text{max}} = \\frac{2}{\\sqrt{\\rho(A)}}\n$$", "answer": "$$\n\\boxed{\\frac{2}{\\sqrt{\\rho(A)}}}\n$$", "id": "3451899"}, {"introduction": "辛性保证了相空间体积形式的保持，但其他物理不变量，比如能量，又将如何呢？这个练习通过比较两种先进的几何积分器来探讨这个问题：辛的隐式中点格式和精确保持能量的平均向量场（AVF）方法。通过计算每种方法所精确保持的不变量，您将对不同类型的结构保持及其在选择数值方法时所涉及的权衡有更深刻的认识 [@problem_id:3451940]。", "problem": "考虑一个单自由度正则哈密顿系统，该系统由一个哈密顿偏微分方程(PDE)的空间半离散化得到，其正则变量为 $q$ 和 $p$，常数辛矩阵为 $J = \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix}$，三次哈密顿量为\n$$\nH(q,p) = \\frac{1}{2} p^{2} + \\frac{1}{3} q^{3}\n$$\n。其连续时间动力学由哈密顿常微分方程 $y'(t) = J \\nabla H(y(t))$ 给出，其中 $y = (q,p)^{\\top}$。\n\n考虑两种时间离散化方法，用于以时间步长 $h > 0$ 从 $(q_{n},p_{n})$ 推进到 $(q_{n+1},p_{n+1})$：\n- 平均向量场(AVF)方法，定义为\n$$\ny_{n+1} = y_{n} + h \\, J \\int_{0}^{1} \\nabla H\\big((1-\\xi) y_{n} + \\xi \\, y_{n+1}\\big) \\, d\\xi,\n$$\n其中 $y_{n} = (q_{n},p_{n})^{\\top}$ 且 $y_{n+1} = (q_{n+1},p_{n+1})^{\\top}$。\n- 隐式中点法，定义为\n$$\ny_{n+1} = y_{n} + h \\, J \\nabla H\\!\\left(\\frac{y_{n} + y_{n+1}}{2}\\right).\n$$\n\n仅使用正则哈密顿结构 $y' = J \\nabla H(y)$ 以及AVF方法和隐式中点法的定义属性，完成以下任务：\n1. 对给定的三次哈密顿量 $H(q,p)$，推导两种方法的分量形式。\n2. 证明AVF方法精确保持哈密顿量，即对给定的 $H(q,p)$，有 $H(y_{n+1}) = H(y_{n})$。\n3. 对于隐式中点法，推导其精确的代数单步更新，并计算精确的单步能量变化\n$$\n\\Delta H_{\\mathrm{mid}}(q_{n},p_{n};h) := H(q_{n+1},p_{n+1}) - H(q_{n},p_{n})\n$$\n以 $q_{n}$，$p_{n}$ 和 $h$ 的封闭形式符号表达式表示。\n\n比较两种方法所保持的不变量，并给出 $\\Delta H_{\\mathrm{mid}}(q_{n},p_{n};h)$ 的精确表达式。你的最终答案必须是关于 $q_{n}$，$p_{n}$ 和 $h$ 的单个封闭形式解析表达式。如果你为了解释其近似保持性而进行任何级数展开，请不要四舍五入；然而，最终报告的表达式必须是精确的，而不是近似值。不需要物理单位，最终表达式中也不要包含任何单位。", "solution": "该问题是有效的。它提法良好，在几何数值积分领域有科学依据，并包含了进行严格求解所需的所有必要信息。\n\n该问题研究了用于一个单自由度哈密顿系统的两种数值积分方法。系统的状态由向量 $y = (q,p)^{\\top}$ 描述。哈密顿量由下式给出\n$$\nH(q,p) = \\frac{1}{2} p^{2} + \\frac{1}{3} q^{3}\n$$\n。哈密顿量的梯度 $\\nabla H = (\\frac{\\partial H}{\\partial q}, \\frac{\\partial H}{\\partial p})^{\\top}$ 为\n$$\n\\nabla H(q,p) = \\begin{pmatrix} q^2 \\\\ p \\end{pmatrix}.\n$$\n连续时间动力学由哈密顿方程 $y' = J \\nabla H(y)$ 控制，其中 $J$ 是标准辛矩阵 $J = \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix}$。这给出了分量形式的方程 $q' = p$ 和 $p' = -q^2$。\n\n### 1. 数值方法的分量形式\n\n我们推导平均向量场(AVF)方法和隐式中点法在时间步长 $h$ 内将解从 $y_n = (q_n, p_n)^{\\top}$ 推进到 $y_{n+1} = (q_{n+1}, p_{n+1})^{\\top}$ 的分量形式。\n\n**平均向量场(AVF)方法**\n\nAVF方法定义为\n$$\ny_{n+1} - y_{n} = h \\, J \\int_{0}^{1} \\nabla H\\big((1-\\xi) y_{n} + \\xi \\, y_{n+1}\\big) \\, d\\xi.\n$$\n令 $y_{\\xi} = (1-\\xi) y_{n} + \\xi \\, y_{n+1}$。其分量为 $q_{\\xi} = (1-\\xi)q_n + \\xi q_{n+1}$ 和 $p_{\\xi} = (1-\\xi)p_n + \\xi p_{n+1}$。\n我们必须计算梯度 $\\nabla H(y_\\xi) = (q_\\xi^2, p_\\xi)^{\\top}$ 的积分：\n$p$-分量的积分为：\n$$\n\\int_{0}^{1} p_{\\xi} \\,d\\xi = \\int_{0}^{1} \\left( (1-\\xi)p_n + \\xi p_{n+1} \\right) \\,d\\xi = \\left[ (1-\\xi)(-\\xi)p_n + \\frac{\\xi^2}{2} p_{n+1} \\right]_{\\xi=0}^{\\xi=1} \\text{ (小心)}.\n$$\n我们直接积分：\n$$\n\\int_0^1 (p_n + \\xi(p_{n+1}-p_n)) d\\xi = \\left[p_n \\xi + \\frac{\\xi^2}{2}(p_{n+1}-p_n)\\right]_0^1 = p_n + \\frac{1}{2}(p_{n+1}-p_n) = \\frac{p_n+p_{n+1}}{2}.\n$$\n$q$-分量的积分为：\n$$\n\\int_{0}^{1} q_{\\xi}^2 \\, d\\xi = \\int_{0}^{1} \\big( (1-\\xi)q_n + \\xi q_{n+1} \\big)^2 \\, d\\xi.\n$$\n使用恒等式 $\\int_0^1 ((1-\\xi)a+\\xi b)^2 d\\xi = \\frac{1}{3}(a^2+ab+b^2)$，我们得到：\n$$\n\\int_{0}^{1} q_{\\xi}^2 \\, d\\xi = \\frac{1}{3}(q_n^2 + q_n q_{n+1} + q_{n+1}^2).\n$$\n因此，AVF更新的向量形式为\n$$\n\\begin{pmatrix} q_{n+1} - q_n \\\\ p_{n+1} - p_n \\end{pmatrix} = h \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix} \\begin{pmatrix} \\frac{1}{3}(q_n^2 + q_n q_{n+1} + q_{n+1}^2) \\\\ \\frac{1}{2}(p_n + p_{n+1}) \\end{pmatrix}.\n$$\nAVF方法的分量形式为：\n$$\nq_{n+1} - q_n = h \\frac{p_n + p_{n+1}}{2}\n$$\n$$\np_{n+1} - p_n = -h \\frac{1}{3}(q_n^2 + q_n q_{n+1} + q_{n+1}^2)\n$$\n\n**隐式中点法**\n\n隐式中点法定义为\n$$\ny_{n+1} - y_{n} = h \\, J \\nabla H\\left(\\frac{y_{n} + y_{n+1}}{2}\\right).\n$$\n梯度的自变量是中点状态 $(\\frac{q_n+q_{n+1}}{2}, \\frac{p_n+p_{n+1}}{2})$。\n在中间点计算的梯度为\n$$\n\\nabla H\\left(\\frac{y_{n} + y_{n+1}}{2}\\right) = \\begin{pmatrix} \\left(\\frac{q_n+q_{n+1}}{2}\\right)^2 \\\\ \\frac{p_n+p_{n+1}}{2} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{4}(q_n+q_{n+1})^2 \\\\ \\frac{1}{2}(p_n+p_{n+1}) \\end{pmatrix}.\n$$\n更新的向量形式为\n$$\n\\begin{pmatrix} q_{n+1} - q_n \\\\ p_{n+1} - p_n \\end{pmatrix} = h \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix} \\begin{pmatrix} \\frac{1}{4}(q_n+q_{n+1})^2 \\\\ \\frac{1}{2}(p_n+p_{n+1}) \\end{pmatrix}.\n$$\n隐式中点法的分量形式为：\n$$\nq_{n+1} - q_n = h \\frac{p_n + p_{n+1}}{2}\n$$\n$$\np_{n+1} - p_n = -h \\frac{1}{4}(q_n + q_{n+1})^2\n$$\n\n### 2. AVF方法能量保持性的证明\n\n我们证明AVF方法精确保持哈密顿量，即 $H(y_{n+1}) = H(y_n)$。\n令 $y(\\xi) = (1-\\xi)y_n + \\xi y_{n+1}$ 为连接 $y_n$ 和 $y_{n+1}$ 的线段。根据线积分的微积分基本定理，哈密顿量的变化为\n$$\nH(y_{n+1}) - H(y_n) = \\int_0^1 \\frac{d}{d\\xi}H(y(\\xi)) \\,d\\xi.\n$$\n使用链式法则，$\\frac{d}{d\\xi}H(y(\\xi)) = \\nabla H(y(\\xi))^{\\top} \\frac{dy(\\xi)}{d\\xi} = \\nabla H(y(\\xi))^{\\top} (y_{n+1}-y_n)$。\n所以，\n$$\nH(y_{n+1}) - H(y_n) = \\int_0^1 \\nabla H(y(\\xi))^{\\top} (y_{n+1}-y_n) \\,d\\xi.\n$$\n由于 $(y_{n+1}-y_n)$ 相对于 $\\xi$ 是常数，可以移到积分号外：\n$$\nH(y_{n+1}) - H(y_n) = \\left( \\int_0^1 \\nabla H(y(\\xi)) \\,d\\xi \\right)^{\\top} (y_{n+1}-y_n).\n$$\n我们定义平均梯度向量 $V = \\int_0^1 \\nabla H(y(\\xi)) \\,d\\xi$。AVF方法的定义是 $y_{n+1}-y_n = hJV$。将此代入上式，得到\n$$\nH(y_{n+1}) - H(y_n) = V^{\\top} (hJV) = h V^{\\top} J V.\n$$\n矩阵 $J$ 是斜对称的，即 $J^{\\top} = -J$。对于任意向量 $V$，二次型 $V^{\\top}JV$ 恒为零：\n$V^{\\top}JV = (V^{\\top}JV)^{\\top} = V^{\\top}J^{\\top}V = V^{\\top}(-J)V = -V^{\\top}JV$。\n这意味着 $2V^{\\top}JV = 0$，所以 $V^{\\top}JV = 0$。\n因此，\n$$\nH(y_{n+1}) - H(y_n) = h \\cdot 0 = 0.\n$$\n这表明AVF方法精确地守恒任何可微的哈密顿量 $H(y)$，因此它也守恒给定的三次哈密顿量。\n\n### 3. 隐式中点法的能量变化\n\n我们推导精确的单步能量变化 $\\Delta H_{\\mathrm{mid}}(q_{n},p_{n};h) = H(q_{n+1},p_{n+1}) - H(q_{n},p_{n})$。\n$$\n\\Delta H_{\\mathrm{mid}} = \\left(\\frac{1}{2} p_{n+1}^{2} + \\frac{1}{3} q_{n+1}^{3}\\right) - \\left(\\frac{1}{2} p_{n}^{2} + \\frac{1}{3} q_{n}^{3}\\right)\n$$\n$$\n\\Delta H_{\\mathrm{mid}} = \\frac{1}{2} (p_{n+1}^2 - p_n^2) + \\frac{1}{3} (q_{n+1}^3 - q_n^3) = \\frac{1}{2} (p_{n+1}-p_n)(p_{n+1}+p_n) + \\frac{1}{3} (q_{n+1}-q_n)(q_n^2+q_n q_{n+1}+q_{n+1}^2).\n$$\n代入中点法的更新规则：\n$p_{n+1}-p_n = -h \\frac{1}{4}(q_n+q_{n+1})^2$ 和 $q_{n+1}-q_n = h \\frac{p_n+p_{n+1}}{2}$。\n$$\n\\Delta H_{\\mathrm{mid}} = \\frac{1}{2} \\left( -h \\frac{(q_n+q_{n+1})^2}{4} \\right) (p_n+p_{n+1}) + \\frac{1}{3} \\left( h \\frac{p_n+p_{n+1}}{2} \\right) (q_n^2+q_n q_{n+1}+q_{n+1}^2)\n$$\n提取公因式 $\\frac{h}{2}(p_n+p_{n+1})$：\n$$\n\\Delta H_{\\mathrm{mid}} = \\frac{h}{2}(p_n+p_{n+1}) \\left[ -\\frac{(q_n+q_{n+1})^2}{4} + \\frac{q_n^2+q_n q_{n+1}+q_{n+1}^2}{3} \\right].\n$$\n简化方括号中的表达式：\n$$\n-\\frac{1}{4}(q_n^2+2q_n q_{n+1}+q_{n+1}^2) + \\frac{1}{3}(q_n^2+q_n q_{n+1}+q_{n+1}^2) = \\left(-\\frac{1}{4}+\\frac{1}{3}\\right)q_n^2 + \\left(-\\frac{2}{4}+\\frac{1}{3}\\right)q_n q_{n+1} + \\left(-\\frac{1}{4}+\\frac{1}{3}\\right)q_{n+1}^2\n$$\n$$\n= \\frac{1}{12}q_n^2 - \\frac{1}{6}q_n q_{n+1} + \\frac{1}{12}q_{n+1}^2 = \\frac{1}{12}(q_n^2-2q_n q_{n+1}+q_{n+1}^2) = \\frac{1}{12}(q_{n+1}-q_n)^2.\n$$\n将其代回得到：\n$$\n\\Delta H_{\\mathrm{mid}} = \\frac{h}{2}(p_n+p_{n+1}) \\left[ \\frac{1}{12}(q_{n+1}-q_n)^2 \\right].\n$$\n现在，代入 $q_{n+1}-q_n = h \\frac{p_n+p_{n+1}}{2}$：\n$$\n\\Delta H_{\\mathrm{mid}} = \\frac{h(p_n+p_{n+1})}{24} \\left( h \\frac{p_n+p_{n+1}}{2} \\right)^2 = \\frac{h^3}{96}(p_n+p_{n+1})^3.\n$$\n为了得到以 $(q_n, p_n, h)$ 表示的最终表达式，我们必须求解 $P = p_n+p_{n+1}$。从两个更新方程中，我们有 $q_{n+1} = q_n + \\frac{h}{2}P$ 和 $p_{n+1} = p_n - \\frac{h}{4}(q_n+q_{n+1})^2$。代入 $p_{n+1}=P-p_n$ 和 $q_{n+1}$ 的表达式，可以得到一个关于 $P$ 的方程：\n$$\nP - 2p_n = -\\frac{h}{4}\\left(q_n + q_n + \\frac{h}{2}P\\right)^2 = -\\frac{h}{4}\\left(2q_n + \\frac{h}{2}P\\right)^2\n$$\n$$\nP - 2p_n = -\\frac{h}{4}\\left(4q_n^2 + 2hq_n P + \\frac{h^2}{4}P^2\\right) = -hq_n^2 - \\frac{h^2}{2}q_n P - \\frac{h^3}{16}P^2.\n$$\n这是一个关于 $P$ 的二次方程：\n$$\n\\frac{h^3}{16}P^2 + \\left(1+\\frac{h^2}{2}q_n\\right)P + (hq_n^2 - 2p_n) = 0.\n$$\n使用二次公式求解 $P$：\n$$\nP = \\frac{-\\left(1+\\frac{h^2}{2}q_n\\right) \\pm \\sqrt{\\left(1+\\frac{h^2}{2}q_n\\right)^2 - 4\\left(\\frac{h^3}{16}\\right)(hq_n^2 - 2p_n)}}{2(h^3/16)}.\n$$\n判别式简化为 $1+h^2q_n+\\frac{h^4}{4}q_n^2 - \\frac{h^4}{4}q_n^2 + \\frac{h^3}{2}p_n = 1+h^2q_n+\\frac{h^3}{2}p_n$。\n$$\nP = \\frac{8}{h^3}\\left[ -\\left(1+\\frac{h^2}{2}q_n\\right) \\pm \\sqrt{1+h^2q_n+\\frac{h^3}{2}p_n} \\right].\n$$\n在极限 $h \\to 0$下，我们必须恢复 $y_{n+1} \\to y_n$，这意味着 $P = p_n+p_{n+1} \\to 2p_n$。解中只有‘+’号能得到这个正确的物理极限。因此：\n$$\np_n+p_{n+1} = \\frac{8}{h^3}\\left[ \\sqrt{1+h^2q_n+\\frac{h^3}{2}p_n} - \\left(1+\\frac{h^2}{2}q_n\\right) \\right].\n$$\n将此代入 $\\Delta H_{\\mathrm{mid}}$ 的表达式中：\n$$\n\\Delta H_{\\mathrm{mid}} = \\frac{h^3}{96} \\left( \\frac{8}{h^3}\\left[ \\sqrt{1+h^2q_n+\\frac{h^3}{2}p_n} - \\left(1+\\frac{h^2}{2}q_n\\right) \\right] \\right)^3\n$$\n$$\n\\Delta H_{\\mathrm{mid}} = \\frac{h^3}{96} \\frac{8^3}{h^9} \\left[ \\sqrt{1+h^2q_n+\\frac{h^3}{2}p_n} - \\left(1+\\frac{h^2}{2}q_n\\right) \\right]^3\n$$\n$$\n\\Delta H_{\\mathrm{mid}}(q_{n},p_{n};h) = \\frac{16}{3h^6} \\left[ \\sqrt{1+h^2q_n+\\frac{h^3}{2}p_n} - \\left(1+\\frac{h^2}{2}q_n\\right) \\right]^3.\n$$\n这就是隐式中点法的精确单步能量变化。\n\n总而言之，AVF方法作为一种离散梯度法，其构造保证了它能对任何多项式哈密顿量（如此处的情形）保持哈密顿量 $H$。而隐式中点法，虽然是辛方法，因此能保持一个邻近的修正哈密顿量 $H_{mod} = H + O(h^2)$，但它并不能精确地保持 $H$。所推导出的非零表达式 $\\Delta H_{\\mathrm{mid}}$ 量化了这种单步偏差。", "answer": "$$\n\\boxed{\\frac{16}{3h^6} \\left[ \\sqrt{1+h^2q_n+\\frac{h^3}{2}p_n} - \\left(1+\\frac{h^2}{2}q_n\\right) \\right]^3}\n$$", "id": "3451940"}]}