{"hands_on_practices": [{"introduction": "第一个练习聚焦于时间积分格式分析的基石：绝对稳定性的概念。通过将经典的四阶龙格-库塔（RK4）方法应用于一个简单的测试方程，你将推导出其稳定性函数，这是一个控制该方法行为的多项式。理解如何推导和分析该函数是确定模拟中最大允许时间步长的基本技能。[@problem_id:3389392]", "problem": "考虑一个由扩散型偏微分方程（PDE）的直线法产生的线性自治半离散系统：$\\,\\frac{d \\boldsymbol{u}}{dt} = \\boldsymbol{L} \\boldsymbol{u}\\,$，其中 $\\,\\boldsymbol{L}\\,$ 是一个常数矩阵，其谱满足对于 $\\,\\boldsymbol{L}\\,$ 的每个特征值 $\\,\\lambda\\,$ 都有 $\\,\\operatorname{Re}(\\lambda) \\le 0\\,$。时间积分通过经典的显式四阶龙格－库塔（RK）方法（通常记为 RK$\\,4$）进行。对于半离散系统，显式单步法的线性绝对稳定性是通过将该方法应用于线性测试常微分方程（ODE）$\\,y'=\\lambda y\\,$，并将迭代格式写成 $\\,y_{n+1} = R(z)\\,y_n\\,$ 的形式来评估的，其中 $\\,z=\\Delta t\\,\\lambda\\,$, $\\,R(z)\\,$ 称为稳定性函数，$\\,\\Delta t\\,$ 是时间步长。\n\n从经典的显式 RK$\\,4$ 方法的四阶定义形式出发，仅使用测试常微分方程 $\\,y'=\\lambda y\\,$ 和 $\\,z=\\Delta t\\,\\lambda\\,$, 通过显式地消去中间步来推导该方法的稳定性函数 $\\,R(z)\\,$。然后，使用绝对稳定区域的定义 $\\,\\mathcal{S}=\\{z\\in\\mathbb{C}:|R(z)|\\le 1\\}\\,$，确定最大的实数 $\\,\\alpha>0\\,$，使得负实轴上的区间 $\\,[-\\alpha,0]\\,$ 包含在 $\\,\\mathcal{S}\\,$ 内。\n\n报告单个数 $\\,\\alpha\\,$ 的值，四舍五入到 $\\,4\\,$ 位有效数字。", "solution": "该问题要求两个主要结果：首先，推导经典四阶显式龙格－库塔方法（RK$4$）的稳定性函数 $R(z)$；其次，确定负实轴上的绝对稳定区间 $[-\\alpha, 0]$ 的长度 $\\alpha$。\n\n首先，我们验证问题的有效性。\n**第1步：提取已知条件**\n-   半离散系统为 $\\frac{d \\boldsymbol{u}}{dt} = \\boldsymbol{L} \\boldsymbol{u}$。\n-   矩阵 $\\boldsymbol{L}$ 是常数矩阵，其所有特征值 $\\lambda$ 满足 $\\operatorname{Re}(\\lambda) \\le 0$。\n-   时间积分方法是经典的显式四阶龙格－库塔方法（RK$4$）。\n-   线性测试常微分方程为 $y' = \\lambda y$。\n-   数值迭代格式为 $y_{n+1} = R(z) y_n$ 的形式，其中 $z = \\Delta t \\lambda$。\n-   绝对稳定区域为 $\\mathcal{S} = \\{z \\in \\mathbb{C} : |R(z)| \\le 1\\}$。\n-   任务是推导 $R(z)$ 并找到最大的 $\\alpha > 0$ 使得 $[-\\alpha, 0] \\subseteq \\mathcal{S}$。\n-   $\\alpha$ 的最终答案必须四舍五入到4位有效数字。\n\n**第2步：使用提取的已知条件进行验证**\n该问题具有科学依据，是微分方程数值分析中的一个标准课题。问题是适定的，有明确的目标和足够的信息来得出唯一解。术语精确客观。没有矛盾、不可靠的前提或歧义。该问题是有效的。\n\n**第3步：结论与行动**\n该问题是有效的。我将继续进行求解。\n\n**稳定性函数 $R(z)$ 的推导**\n\n对于一般的常微分方程 $y' = f(t, y)$，经典的显式四阶龙格－库塔方法（RK$4$）由以下方程组定义：\n$$ k_1 = f(t_n, y_n) $$\n$$ k_2 = f(t_n + \\frac{1}{2}\\Delta t, y_n + \\frac{1}{2}\\Delta t k_1) $$\n$$ k_3 = f(t_n + \\frac{1}{2}\\Delta t, y_n + \\frac{1}{2}\\Delta t k_2) $$\n$$ k_4 = f(t_n + \\Delta t, y_n + \\Delta t k_3) $$\n$$ y_{n+1} = y_n + \\frac{\\Delta t}{6} (k_1 + 2k_2 + 2k_3 + k_4) $$\n\n为了找到稳定性函数 $R(z)$，我们将此方法应用于线性测试方程 $y' = \\lambda y$，因此 $f(t, y) = \\lambda y$。令 $z = \\Delta t \\lambda$。我们通过顺序代入显式计算中间步 $k_i$：\n\n1.  第一步是：\n    $$ k_1 = \\lambda y_n $$\n\n2.  第二步依赖于 $k_1$：\n    $$ k_2 = \\lambda \\left(y_n + \\frac{1}{2}\\Delta t k_1\\right) = \\lambda \\left(y_n + \\frac{1}{2}\\Delta t (\\lambda y_n)\\right) = \\lambda y_n \\left(1 + \\frac{1}{2}\\Delta t \\lambda\\right) = \\lambda y_n \\left(1 + \\frac{z}{2}\\right) $$\n\n3.  第三步依赖于 $k_2$：\n    $$ k_3 = \\lambda \\left(y_n + \\frac{1}{2}\\Delta t k_2\\right) = \\lambda \\left(y_n + \\frac{1}{2}\\Delta t \\left[\\lambda y_n \\left(1 + \\frac{z}{2}\\right)\\right]\\right) = \\lambda y_n \\left(1 + \\frac{z}{2}\\left(1 + \\frac{z}{2}\\right)\\right) = \\lambda y_n \\left(1 + \\frac{z}{2} + \\frac{z^2}{4}\\right) $$\n\n4.  第四步依赖于 $k_3$：\n    $$ k_4 = \\lambda (y_n + \\Delta t k_3) = \\lambda \\left(y_n + \\Delta t \\left[\\lambda y_n \\left(1 + \\frac{z}{2} + \\frac{z^2}{4}\\right)\\right]\\right) = \\lambda y_n \\left(1 + z\\left(1 + \\frac{z}{2} + \\frac{z^2}{4}\\right)\\right) = \\lambda y_n \\left(1 + z + \\frac{z^2}{2} + \\frac{z^3}{4}\\right) $$\n\n现在，我们将 $k_1, k_2, k_3, k_4$ 的这些表达式代入 $y_{n+1}$ 的最终迭代公式中：\n$$ y_{n+1} = y_n + \\frac{\\Delta t}{6} \\left( (\\lambda y_n) + 2\\left[\\lambda y_n \\left(1 + \\frac{z}{2}\\right)\\right] + 2\\left[\\lambda y_n \\left(1 + \\frac{z}{2} + \\frac{z^2}{4}\\right)\\right] + \\left[\\lambda y_n \\left(1 + z + \\frac{z^2}{2} + \\frac{z^3}{4}\\right)\\right] \\right) $$\n提取公因子 $y_n$ 和 $\\lambda$，并使用 $z = \\Delta t \\lambda$：\n$$ y_{n+1} = y_n \\left( 1 + \\frac{\\Delta t \\lambda}{6} \\left[ 1 + 2\\left(1 + \\frac{z}{2}\\right) + 2\\left(1 + \\frac{z}{2} + \\frac{z^2}{4}\\right) + \\left(1 + z + \\frac{z^2}{2} + \\frac{z^3}{4}\\right) \\right] \\right) $$\n$$ y_{n+1} = y_n \\left( 1 + \\frac{z}{6} \\left[ 1 + (2+z) + (2+z+\\frac{z^2}{2}) + (1+z+\\frac{z^2}{2}+\\frac{z^3}{4}) \\right] \\right) $$\n按 $z$ 的幂次对中括号内的项求和：\n-   常数项：$1 + 2 + 2 + 1 = 6$\n-   $z$ 项：$z + z + z = 3z$\n-   $z^2$ 项：$\\frac{z^2}{2} + \\frac{z^2}{2} = z^2$\n-   $z^3$ 项：$\\frac{z^3}{4}$\n\n括号中的表达式为 $6 + 3z + z^2 + \\frac{z^3}{4}$。将其代回：\n$$ y_{n+1} = y_n \\left( 1 + \\frac{z}{6} \\left( 6 + 3z + z^2 + \\frac{z^3}{4} \\right) \\right) $$\n$$ y_{n+1} = y_n \\left( 1 + z + \\frac{3z^2}{6} + \\frac{z^3}{6} + \\frac{z^4}{24} \\right) $$\n$$ y_{n+1} = y_n \\left( 1 + z + \\frac{z^2}{2} + \\frac{z^3}{6} + \\frac{z^4}{24} \\right) $$\n根据定义，$y_{n+1} = R(z) y_n$，所以稳定性函数是：\n$$ R(z) = 1 + z + \\frac{z^2}{2!} + \\frac{z^3}{3!} + \\frac{z^4}{4!} $$\n这是 $\\exp(z)$ 的泰勒级数展开式截断到四阶项的结果。\n\n**稳定区间 $[-\\alpha, 0]$ 的确定**\n\n问题要求最大的实数 $\\alpha > 0$，使得区间 $[-\\alpha, 0]$ 包含在绝对稳定区域 $\\mathcal{S}$ 中。对于实轴上的点 $z=x$，稳定性的条件是 $|R(x)| \\le 1$，这等价于 $-1 \\le R(x) \\le 1$。我们对 $x \\in [-\\alpha, 0]$ 分析这个条件。\n\n1.  **分析条件 $R(x) \\le 1$**：\n    我们需要找到满足 $1 + x + \\frac{x^2}{2} + \\frac{x^3}{6} + \\frac{x^4}{24} \\le 1$ 的范围。\n    $$ x + \\frac{x^2}{2} + \\frac{x^3}{6} + \\frac{x^4}{24} \\le 0 $$\n    $$ x \\left( 1 + \\frac{x}{2} + \\frac{x^2}{6} + \\frac{x^3}{24} \\right) \\le 0 $$\n    这个不等式在 $x=0$ 时成立。对于 $x0$，如果括号中的项非负，则该不等式成立：\n    $P(x) = 1 + \\frac{x}{2} + \\frac{x^2}{6} + \\frac{x^3}{24} \\ge 0$。\n    导数 $P'(x) = \\frac{1}{2} + \\frac{x}{3} + \\frac{x^2}{8}$ 的判别式 $D = (\\frac{1}{3})^2 - 4(\\frac{1}{8})(\\frac{1}{2}) = \\frac{1}{9} - \\frac{1}{4}  0$。由于首项系数为正，因此对于所有实数 $x$，$P'(x) > 0$。所以，$P(x)$ 是一个严格增函数。它有唯一的实根，我们称之为 $x_1$。不等式 $P(x) \\ge 0$ 在 $x \\ge x_1$ 时成立。\n    因此，条件 $R(x) \\le 1$ 在 $x \\in [x_1, 0]$ 时满足。\n\n2.  **分析条件 $R(x) \\ge -1$**：\n    这等价于 $R(x) + 1 \\ge 0$。\n    $$ S(x) = 2 + x + \\frac{x^2}{2} + \\frac{x^3}{6} + \\frac{x^4}{24} \\ge 0 $$\n    为了找到 $S(x)$ 的最小值，我们分析其导数：\n    $S'(x) = R'(x) = 1 + x + \\frac{x^2}{2} + \\frac{x^3}{6}$。这是 $R_3(x)$，一个三阶 RK 方法的稳定性函数。$S(x)$ 的极值点出现在 $S'(x)=R_3(x)=0$ 的实根处。由于对于所有实数 $x$，$R_3'(x) = 1+x+x^2/2  0$，所以 $R_3(x)$ 是严格递增的，并且只有一个实根，记为 $x_0$。\n    函数 $S(x)$ 在 $x=x_0$ 处有唯一的全局最小值。最小值为 $S(x_0) = R(x_0) + 1$。\n    我们可以写出 $R(x) = R_3(x) + \\frac{x^4}{24}$。在 $x_0$ 处，$R_3(x_0) = 0$。\n    所以，$R(x_0) = 0 + \\frac{x_0^4}{24} = \\frac{x_0^4}{24}$。\n    $S(x)$ 的最小值为 $S(x_0) = \\frac{x_0^4}{24} + 1$。因为 $x_0$ 是实数，$x_0^4 \\ge 0$，因此 $S(x_0) \\ge 1$。\n    这意味着 $S(x) = R(x) + 1$ 总是正的，所以对于所有实数 $x$，$R(x)  -1$。\n\n稳定区间仅由条件 $R(x) \\le 1$ 约束。该区间为 $[x_1, 0]$，其中 $x_1$ 是 $R(x) = 1$ 的非零根。该区间的长度为 $\\alpha = -x_1$。\n我们需要求解 $P(x) = 1 + \\frac{x}{2} + \\frac{x^2}{6} + \\frac{x^3}{24} = 0$ 的根 $x_1$。\n乘以 $24$ 得到多项式方程：\n$$ x_1^3 + 4x_1^2 + 12x_1 + 24 = 0 $$\n令 $\\alpha = -x_1  0$。代入 $x_1 = -\\alpha$：\n$$ (-\\alpha)^3 + 4(-\\alpha)^2 + 12(-\\alpha) + 24 = 0 $$\n$$ -\\alpha^3 + 4\\alpha^2 - 12\\alpha + 24 = 0 $$\n$$ \\alpha^3 - 4\\alpha^2 + 12\\alpha - 24 = 0 $$\n我们求解这个关于 $\\alpha$ 的三次方程。令 $g(\\alpha) = \\alpha^3 - 4\\alpha^2 + 12\\alpha - 24$。\n通过观察，$g(2) = 8 - 16 + 24 - 24 = -8$ 且 $g(3) = 27 - 36 + 36 - 24 = 3$。根位于 $2$ 和 $3$ 之间。我们可以使用牛顿法来找到一个更精确的值。导数是 $g'(\\alpha) = 3\\alpha^2 - 8\\alpha + 12$。\n我们从初始猜测 $\\alpha_0 = 2.8$ 开始。\n$g(2.8) = (2.8)^3 - 4(2.8)^2 + 12(2.8) - 24 = 21.952 - 31.36 + 33.6 - 24 = 0.192$。\n$g'(2.8) = 3(2.8)^2 - 8(2.8) + 12 = 23.52 - 22.4 + 12 = 13.12$。\n下一个近似值是 $\\alpha_1 = \\alpha_0 - \\frac{g(\\alpha_0)}{g'(\\alpha_0)} = 2.8 - \\frac{0.192}{13.12} \\approx 2.785365$。\n进一步的迭代会完善这个值。更精确的计算得出 $\\alpha \\approx 2.785178$。\n四舍五入到4位有效数字，我们得到 $\\alpha = 2.785$。\n负实轴上的稳定区间约为 $[-2.785, 0]$。$\\alpha$ 的最大值为 $2.785$。", "answer": "$$ \\boxed{2.785} $$", "id": "3389392"}, {"introduction": "数值稳定性不仅取决于时间积分格式，还取决于空间离散化。这个问题通过研究一维平流方程来展示这种关键的相互作用。你将分析由中心差分格式产生的半离散算子的特征值，并用它们来解释为什么简单的向前欧拉法对于这种设置是无条件不稳定的，这为空间和时间方法之间糟糕的组合提供了一个经典例子。[@problem_id:3389318]", "problem": "考虑一维线性平流偏微分方程 (PDE) $u_{t} + a\\,u_{x} = 0$，其中平流速度 $a \\in \\mathbb{R}$ 为常数，定义在长度为 $L  0$ 的周期性区域上。设该区域用一个包含 $N \\in \\mathbb{N}$ 个点、间距为 $\\Delta x = L/N$ 的均匀网格进行离散化，并令 $U(t) \\in \\mathbb{C}^{N}$ 表示时间 $t$ 时的节点值集合。空间导数的中心差分近似由循环矩阵 $D_{0} \\in \\mathbb{R}^{N \\times N}$ 定义，该矩阵对应于模板 $\\left(-\\tfrac{1}{2\\Delta x},\\,0,\\,\\tfrac{1}{2\\Delta x}\\right)$，并具有周期性环绕特性。因此，半离散的线方法系统为 $U^{\\prime}(t) = -a\\,D_{0}\\,U(t)$。\n\n仅利用以下基本事实：(i) 循环矩阵可由离散傅里叶基对角化，以及 (ii) 对于网格波数 $\\theta \\in \\{2\\pi k/N : k = 0,1,\\dots,N-1\\}$，离散傅里叶模为 $\\varphi^{(\\theta)}_{j} = \\exp(i\\,j\\,\\theta)$，其中 $j \\in \\{0,1,\\dots,N-1\\}$，完成以下任务：\n\n1. 从第一性原理推导半离散算子 $-a\\,D_{0}$ 的特征值 $\\lambda(\\theta)$，将其表示为 $a$、$\\Delta x$ 和 $\\theta$ 的显式函数。\n\n2. 考虑将时间步长为 $\\Delta t  0$ 的前向欧拉 (FE) 时间积分器应用于半离散系统，即 $U^{n+1} = U^{n} + \\Delta t\\,(-a\\,D_{0}\\,U^{n})$。利用你推导出的特征值，从第一性原理上解释为什么对于周期性网格上的这种平流空间离散化，前向欧拉方法是无条件不稳定的。\n\n作为最终答案，请提供你在第1项中找到的 $\\lambda(\\theta)$ 关于 $a$、$\\Delta x$ 和 $\\theta$ 的闭式表达式。不需要进行数值计算，也不需要四舍五入。", "solution": "我们从半离散的线方法系统 $U^{\\prime}(t) = -a\\,D_{0}\\,U(t)$ 开始，其中 $D_{0}$ 是实现带周期性边界条件的一阶导数中心差分近似的循环矩阵。离散傅里叶模构成了循环矩阵的一个特征基。具体来说，对于每个网格波数 $\\theta \\in \\{2\\pi k/N : k = 0,1,\\dots,N-1\\}$，分量为 $\\varphi^{(\\theta)}_{j} = \\exp(i\\,j\\,\\theta)$ 的向量 $\\varphi^{(\\theta)} \\in \\mathbb{C}^{N}$ 是任何循环矩阵的特征向量，其对应的特征值通过将模板符号应用于该模得到。\n\n对于使用模板 $\\left(-\\tfrac{1}{2\\Delta x},\\,0,\\,\\tfrac{1}{2\\Delta x}\\right)$ 的中心差分导数算子 $D_{0}$，我们计算它在离散傅里叶模上的作用。对于一个固定的 $\\theta$，$D_{0}\\,\\varphi^{(\\theta)}$ 的第 $j$ 个分量是\n\n$$\n\\left(D_{0}\\,\\varphi^{(\\theta)}\\right)_{j} \\;=\\; \\frac{1}{2\\Delta x}\\left(\\varphi^{(\\theta)}_{j+1} - \\varphi^{(\\theta)}_{j-1}\\right)\n\\;=\\; \\frac{1}{2\\Delta x}\\left(\\exp(i\\,(j+1)\\,\\theta) - \\exp(i\\,(j-1)\\,\\theta)\\right).\n$$\n\n提出因子 $\\exp(i\\,j\\,\\theta)$，得到\n\n$$\n\\left(D_{0}\\,\\varphi^{(\\theta)}\\right)_{j}\n= \\exp(i\\,j\\,\\theta)\\,\\frac{1}{2\\Delta x}\\left(\\exp(i\\,\\theta) - \\exp(-i\\,\\theta)\\right)\n= \\exp(i\\,j\\,\\theta)\\,\\frac{i}{\\Delta x}\\,\\sin(\\theta).\n$$\n\n因此，$\\varphi^{(\\theta)}$ 是 $D_{0}$ 的一个特征向量，其特征值为\n\n$$\n\\mu(\\theta) \\;=\\; \\frac{i}{\\Delta x}\\,\\sin(\\theta).\n$$\n\n因此，半离散算子 $-a\\,D_{0}$ 的特征值为\n\n$$\n\\lambda(\\theta) \\;=\\; -a\\,\\mu(\\theta) \\;=\\; -\\,i\\,\\frac{a}{\\Delta x}\\,\\sin(\\theta),\n$$\n\n对每个 $\\theta \\in \\{2\\pi k/N : k = 0,1,\\dots,N-1\\}$ 成立。这些特征值是纯虚数，即对于每个 $\\theta$，都有 $\\lambda(\\theta) \\in i\\,\\mathbb{R}$。\n\n接下来，考虑将前向欧拉 (FE) 时间积分器应用于 $U^{\\prime}(t) = -a\\,D_{0}\\,U(t)$。对于线性测试问题 $y^{\\prime} = \\lambda\\,y$，前向欧拉的更新公式为 $y^{n+1} = (1 + \\Delta t\\,\\lambda)\\,y^{n}$，因此放大因子为 $R(z) = 1 + z$，其中 $z = \\Delta t\\,\\lambda$。对给定模的稳定性要求 $|1 + \\Delta t\\,\\lambda(\\theta)| \\leq 1$。\n\n代入 $\\lambda(\\theta) = -\\,i\\,\\dfrac{a}{\\Delta x}\\,\\sin(\\theta)$:\n\n$$\n1 + \\Delta t\\,\\lambda(\\theta) \\;=\\; 1 - i\\,\\frac{a\\,\\Delta t}{\\Delta x}\\,\\sin(\\theta).\n$$\n\n其模为\n\n$$\n\\left|1 + \\Delta t\\,\\lambda(\\theta)\\right|\n= \\sqrt{1 + \\left(\\frac{a\\,\\Delta t}{\\Delta x}\\right)^{2}\\,\\sin^{2}(\\theta)}.\n$$\n\n对于任何 $\\Delta t  0$ 和任何波数满足 $\\sin(\\theta) \\neq 0$ 的情况，我们都有 $\\left|1 + \\Delta t\\,\\lambda(\\theta)\\right|  1$。唯一满足 $\\left|1 + \\Delta t\\,\\lambda(\\theta)\\right| = 1$ 的模是那些 $\\sin(\\theta) = 0$ 的模，即 $\\theta \\in \\{0, \\pi\\}$ (模 $2\\pi$)，这对应于常数模和奈奎斯特模。因此，不存在任何 $\\Delta t  0$ 使得所有模都不被放大，因为对于任何这样的 $\\Delta t$，总会存在 $\\sin(\\theta) \\neq 0$ 的模，其放大因子的模大于1。\n\n等价地，前向欧拉的绝对稳定域 $\\{z \\in \\mathbb{C} : |1 + z| \\leq 1\\}$ 不包含任何非零的纯虚数 $z = i\\,y$，因为对于所有 $y \\neq 0$，有 $|1 + i\\,y| = \\sqrt{1 + y^{2}}  1$。由于 $-a\\,D_{0}$ 的半离散谱除了可能在原点外都是纯虚数，因此对于周期性网格上的这种中心差分空间离散化的平流问题，前向欧拉方法是无条件不稳定的。\n\n因此，所要求的半离散特征值的闭式表达式是 $\\lambda(\\theta) = -\\,i\\,\\dfrac{a}{\\Delta x}\\,\\sin(\\theta)$。", "answer": "$$\\boxed{-\\,i\\,\\dfrac{a}{\\Delta x}\\,\\sin(\\theta)}$$", "id": "3389318"}, {"introduction": "除了线性稳定性，许多物理模拟还需要保持解的某些特性，例如非负性（或称保正性）。这个高级练习使用平流方程的迎风格式来探讨这一概念。你将从理论上推导出 RK4 方法保持解的非负性的条件，然后编写一个程序来数值验证你的发现，从而将理论分析与实际计算验证联系起来。[@problem_id:3389375]", "problem": "考虑在一维周期性域 $x \\in [0,1]$ 上的线性平流偏微分方程 (PDE) $u_t + a\\,u_x = 0$，其中平流速度 $a  0$ 为常数。使用一阶迎风保守半离散格式对空间导数进行离散，该格式建立在 $N$ 个均匀间隔的单元上，网格间距为 $\\Delta x = 1/N$，单元平均值为 $u_i(t)$，并采用周期性索引。该半离散系统为\n$$\n\\frac{d}{dt} u_i(t) = -\\frac{a}{\\Delta x}\\left(u_i(t) - u_{i-1}(t)\\right),\n$$\n可写成线性系统 $\\frac{d}{dt} \\mathbf{u}(t) = \\mathbf{L}\\,\\mathbf{u}(t)$，其中 $\\mathbf{L}$ 是一个托普利茨 (Toeplitz) 矩阵，其元素为 $L_{ii} = -\\lambda$，$L_{i,i-1} = \\lambda$，其余元素为 $L_{ij}=0$，$\\lambda = a/\\Delta x$，且索引具有周期性环绕。\n\n定义：\n- 如果一个半离散算子 $\\mathbf{L}$ 与前向欧拉 (Forward Euler) 时间步进结合时，只要时间步长 $\\Delta t$ 满足一个依赖于算子的界，更新式 $\\mathbf{u}^{n+1} = \\mathbf{u}^n + \\Delta t\\,\\mathbf{L}\\,\\mathbf{u}^n$ 对任意非负的 $\\mathbf{u}^n$ 都能保持非负性，则称该算子是单调的。\n- 对于一个给定的半离散系统，如果对于选定的 $\\Delta t$，$\\mathbf{u}^n \\ge 0$ (逐分量) 能够推导出 $\\mathbf{u}^{n+1} \\ge 0$ (逐分量)，则称该时间积分格式是保正的。\n- 经典四阶龙格-库塔 (Runge-Kutta) 方法 (四阶龙格-库塔法，简写为 RK4) 通过使用四个阶段和阶段导数的特定凸组合，将方程 $\\mathbf{u}' = \\mathbf{L}\\,\\mathbf{u}$ 的解从 $\\mathbf{u}^n$ 推进到 $\\mathbf{u}^{n+1}$。\n\n任务：\n1. 从半离散迎风格式及其前向欧拉更新式出发，推导保证前向欧拉方法正性的时间步长界。您的推导必须从每个单元上的前向欧拉更新式的显式形式开始，并展示其如何形成相邻单元值的凸组合。\n2. 考虑将经典四阶龙格-库塔 (RK4) 方法应用于同一半离散系统。令 $\\mathbf{S}$ 表示作用于网格函数的后向移位算子，即 $(\\mathbf{S}\\,\\mathbf{u})_i = u_{i-1}$，并注意到 $\\mathbf{L} = \\lambda(\\mathbf{S} - \\mathbf{I})$，其中 $\\mathbf{I}$ 是单位算子。通过将 $\\mathbf{L}$ 的幂展开为 $\\mathbf{S}$ 和 $\\mathbf{I}$ 的表达式，将单步 RK4 更新式写成如下形式\n$$\nu_i^{n+1} = \\sum_{m=0}^{4} w_m(r)\\,u_{i-m}^n,\n$$\n其中 $r = \\lambda\\,\\Delta t$ 是库朗数 (无量纲)，$w_m(r)$ 是仅依赖于 $r$ 的标量权重。推导每个 $w_m(r)$ 的显式多项式表达式。\n3. 使用推导出的权重，确定 $r$ 的一个阈值，使得当 $r$ 小于或等于该阈值时所有权重都为非负，并证明当 $r$ 超过该阈值时至少有一个权重变为负值。解释为什么这表明，当 $\\Delta t$ 超过一个依赖于方法的阈值时，经典 RK4 方法即使应用于单调的半离散算子也可能破坏正性。\n4. 实现一个程序，该程序：\n   - 使用参数 $N = 128$ 和 $a = 1$ 构造如上定义的半离散算子 $\\mathbf{L}$。\n   - 初始化一个非负状态 $\\mathbf{u}^0$，该状态在索引 $i_0 = 10$ 处有一个尖峰：$u_{i_0}^0 = 1$，对于 $i \\ne i_0$ 则 $u_i^0 = 0$。\n   - 对下述测试集中的每个 $r = \\lambda\\,\\Delta t$ 测试值，使用精确的半离散算子和标准的 RK4 阶段方程，将解推进一个 RK4 时间步。\n   - 检查所得的 $\\mathbf{u}^{1}$ 是否有任何负分量 (严格小于 0，使用 $10^{-12}$ 的数值容差以忽略舍入误差)。\n   - 生成单行输出，包含一个用方括号括起来的逗号分隔列表，其中每个条目是一个布尔值，指示正性是否被破坏 (如果任何分量为负则为 True，否则为 False)。\n\n测试集 (要使用的库朗数 $r = \\lambda\\,\\Delta t$ 的值)：\n- 情况 1 (零步长)：$r = 0.0$。\n- 情况 2 (低于阈值)：$r = 0.5$。\n- 情况 3 (边界值)：$r = 1.0$。\n- 情况 4 (略高于阈值)：$r = 1.05$。\n- 情况 5 (远高于阈值)：$r = 1.60$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表 (例如，\"[result1,result2,result3,result4,result5]\")。不涉及物理单位；所有量均为无量纲。每个测试用例的最终输出必须是布尔值，指示经过一个 RK4 步后正性是否被破坏。", "solution": "所述问题具有科学依据、适定、客观且自洽。它是在偏微分方程数值分析领域一个标准的、非平凡的练习，特别关注应用于半离散平流方程的显式时间积分格式的正性属性。所有定义、参数和任务都已明确指定，从而可以获得一个严谨且可验证的解。因此，该问题被认为是有效的。\n\n解决方案将按所给顺序处理这四个任务。\n\n### 任务 1：前向欧拉格式的正性条件\n\n问题考虑了在一维周期性域上的线性平流方程 $u_t + a\\,u_x = 0$，其中 $a  0$。空间导数使用一阶迎风格式进行离散，得到关于单元平均值 $u_i(t)$ 的半离散系统：\n$$\n\\frac{d}{dt} u_i(t) = -\\frac{a}{\\Delta x}\\left(u_i(t) - u_{i-1}(t)\\right)\n$$\n其中 $\\Delta x$ 是均匀网格间距。\n\n应用前向欧拉 (Forward Euler) 时间积分方法，从时间步 $n$ 到 $n+1$ 的更新由 $\\mathbf{u}^{n+1} = \\mathbf{u}^n + \\Delta t \\, \\frac{d\\mathbf{u}}{dt}\\big|_{\\mathbf{u}=\\mathbf{u}^n}$ 给出。对于单个单元 $i$，这变为：\n$$\nu_i^{n+1} = u_i^n + \\Delta t \\left( -\\frac{a}{\\Delta x}\\left(u_i^n - u_{i-1}^n\\right) \\right)\n$$\n我们引入无量纲的库朗数，定义为 $r = \\frac{a\\,\\Delta t}{\\Delta x}$。将其代入更新方程得：\n$$\nu_i^{n+1} = u_i^n - r \\left(u_i^n - u_{i-1}^n\\right)\n$$\n重新整理各项，将 $u_i^{n+1}$ 表示为 $n$ 时刻值的线性组合：\n$$\nu_i^{n+1} = (1 - r)u_i^n + r\\,u_{i-1}^n\n$$\n为使格式保持正性，我们要求如果 $\\mathbf{u}^n$ 的所有分量都是非负的 (即，对所有 $j$ 都有 $u_j^n \\ge 0$)，那么 $\\mathbf{u}^{n+1}$ 的所有分量也必须是非负的。从 $u_i^{n+1}$ 的方程来看，如果 $u_i^n \\ge 0$ 且 $u_{i-1}^n \\ge 0$，那么只要线性组合的系数是非负的，$u_i^{n+1}$ 就保证是非负的。\n这给出两个条件：\n1. $r \\ge 0$：由于 $a  0$，$\\Delta t  0$ 且 $\\Delta x  0$，这个条件是内在地满足的。\n2. $1 - r \\ge 0 \\implies r \\le 1$。\n\n综合这些，对于此半离散系统，前向欧拉方法是保正的，当且仅当库朗数 $r$ 满足 $0 \\le r \\le 1$。这对应于时间步长界 $\\Delta t \\le \\frac{\\Delta x}{a}$，也就是该格式的 Courant-Friedrichs-Lewy (CFL) 条件。因此，在这一条件下，所给的算子 $\\mathbf{L}$ 是单调的。\n\n### 任务 2：RK4 模板权重的推导\n\n对于自治系统 $\\mathbf{u}' = \\mathbf{L}\\mathbf{u}$，经典四阶龙格-库塔 (RK4) 方法可以表示为算子 $\\Delta t \\mathbf{L}$ 的多项式。单步更新由下式给出：\n$$\n\\mathbf{u}^{n+1} = \\left( \\mathbf{I} + \\Delta t \\mathbf{L} + \\frac{(\\Delta t \\mathbf{L})^2}{2!} + \\frac{(\\Delta t \\mathbf{L})^3}{3!} + \\frac{(\\Delta t \\mathbf{L})^4}{4!} \\right) \\mathbf{u}^n\n$$\n问题将半离散算子指定为 $\\mathbf{L} = \\lambda(\\mathbf{S} - \\mathbf{I})$，其中 $\\lambda = a/\\Delta x$，$\\mathbf{S}$ 是后向移位算子，$(\\mathbf{S}\\mathbf{u})_i = u_{i-1}$。我们定义库朗数为 $r = \\lambda \\Delta t = a \\Delta t / \\Delta x$。\n算子项 $\\Delta t \\mathbf{L}$ 可写作：\n$$\n\\Delta t \\mathbf{L} = \\Delta t \\lambda (\\mathbf{S} - \\mathbf{I}) = r(\\mathbf{S} - \\mathbf{I})\n$$\n将其代入 RK4 更新公式，单步更新算子 $\\mathbf{W}(r)$ 为：\n$$\n\\mathbf{W}(r) = \\mathbf{I} + r(\\mathbf{S} - \\mathbf{I}) + \\frac{r^2}{2}(\\mathbf{S} - \\mathbf{I})^2 + \\frac{r^3}{6}(\\mathbf{S} - \\mathbf{I})^3 + \\frac{r^4}{24}(\\mathbf{S} - \\mathbf{I})^4\n$$\n我们需要找到表达式 $\\mathbf{u}^{n+1} = \\left(\\sum_{m=0}^{4} w_m(r) \\mathbf{S}^m\\right) \\mathbf{u}^n$ 中的系数 $w_m(r)$。这需要使用二项式定理 $(\\mathbf{A}+\\mathbf{B})^k = \\sum_{j=0}^k \\binom{k}{j} \\mathbf{A}^{k-j}\\mathbf{B}^j$ 展开 $(\\mathbf{S} - \\mathbf{I})$ 的幂：\n- $(\\mathbf{S} - \\mathbf{I})^1 = \\mathbf{S} - \\mathbf{I}$\n- $(\\mathbf{S} - \\mathbf{I})^2 = \\mathbf{S}^2 - 2\\mathbf{S} + \\mathbf{I}$\n- $(\\mathbf{S} - \\mathbf{I})^3 = \\mathbf{S}^3 - 3\\mathbf{S}^2 + 3\\mathbf{S} - \\mathbf{I}$\n- $(\\mathbf{S} - \\mathbf{I})^4 = \\mathbf{S}^4 - 4\\mathbf{S}^3 + 6\\mathbf{S}^2 - 4\\mathbf{S} + \\mathbf{I}$\n\n我们收集从 $\\mathbf{S}^0$ 到 $\\mathbf{S}^4$ 的每个 $\\mathbf{S}$ 幂的系数。\n\n- $\\mathbf{S}^4$ 的系数 ($w_4(r)$)：唯一的贡献来自 $(\\mathbf{S} - \\mathbf{I})^4$ 项。\n$$ w_4(r) = \\frac{r^4}{24} \\binom{4}{4} = \\frac{r^4}{24} $$\n\n- $\\mathbf{S}^3$ 的系数 ($w_3(r)$)：贡献来自 $(\\mathbf{S} - \\mathbf{I})^3$ 和 $(\\mathbf{S} - \\mathbf{I})^4$。\n$$ w_3(r) = \\frac{r^3}{6} \\binom{3}{3} + \\frac{r^4}{24} \\binom{4}{3}(-1)^1 = \\frac{r^3}{6} - \\frac{4r^4}{24} = \\frac{r^3}{6} - \\frac{r^4}{6} $$\n\n- $\\mathbf{S}^2$ 的系数 ($w_2(r)$)：贡献来自 $(\\mathbf{S} - \\mathbf{I})^2$、$(\\mathbf{S} - \\mathbf{I})^3$ 和 $(\\mathbf{S} - \\mathbf{I})^4$。\n$$ w_2(r) = \\frac{r^2}{2} \\binom{2}{2} + \\frac{r^3}{6} \\binom{3}{2}(-1)^1 + \\frac{r^4}{24} \\binom{4}{2}(-1)^2 = \\frac{r^2}{2} - \\frac{3r^3}{6} + \\frac{6r^4}{24} = \\frac{r^2}{2} - \\frac{r^3}{2} + \\frac{r^4}{4} $$\n\n- $\\mathbf{S}^1$ 的系数 ($w_1(r)$)：贡献来自从 $1$ 到 $4$ 的所有幂次。\n$$ w_1(r) = r \\binom{1}{1} + \\frac{r^2}{2} \\binom{2}{1}(-1)^1 + \\frac{r^3}{6} \\binom{3}{1}(-1)^2 + \\frac{r^4}{24} \\binom{4}{1}(-1)^3 = r - r^2 + \\frac{r^3}{2} - \\frac{r^4}{6} $$\n\n- $\\mathbf{S}^0 = \\mathbf{I}$ 的系数 ($w_0(r)$)：贡献来自所有项。\n$$ w_0(r) = 1 - r + \\frac{r^2}{2} - \\frac{r^3}{6} + \\frac{r^4}{24} $$\n\n### 任务 3：RK4 的正性阈值\n\n为使 RK4 格式保持正性，更新式 $u_i^{n+1} = \\sum_{m=0}^{4} w_m(r)\\,u_{i-m}^n$ 对于任何非负初始状态 $\\mathbf{u}^n$ 必须产生非负结果。如果所有模板权重 $w_m(r)$ 都是非负的，则可以保证这一点 (鉴于它们的和为1，这使得更新成为一个凸组合)。让我们分析当 $r \\ge 0$ 时每个权重的符号。\n\n1.  $w_4(r) = \\frac{r^4}{24}$：对于任何实数 $r$，这始终是非负的。\n2.  $w_3(r) = \\frac{r^3}{6} - \\frac{r^4}{6} = \\frac{r^3}{6}(1-r)$：对于 $r \\ge 0$，该权重非负当且仅当 $1-r \\ge 0$，即 $r \\le 1$。对于任何 $r1$，$w_3(r)$ 是严格为负的。\n3.  $w_2(r) = \\frac{r^2}{2} - \\frac{r^3}{2} + \\frac{r^4}{4} = \\frac{r^2}{4}(2 - 2r + r^2)$：二次项 $q(r) = r^2 - 2r + 2$ 的判别式为 $\\Delta = (-2)^2 - 4(1)(2) = -4  0$。由于其首项系数为正，$q(r)$ 对所有实数 $r$ 均为正。因此，对于 $r \\ge 0$，$w_2(r)$ 始终是非负的。\n4.  $w_1(r) = r - r^2 + \\frac{r^3}{2} - \\frac{r^4}{6}$：对于 $r \\in [0, 1]$，该权重是非负的。例如，在 $r=1$ 时，$w_1(1) = 1 - 1 + 1/2 - 1/6 = 1/3  0$。对于 $r0$，$w_1(r)=0$ 的第一个根约等于 $r \\approx 1.596$。\n5.  $w_0(r) = 1 - r + \\frac{r^2}{2} - \\frac{r^3}{6} + \\frac{r^4}{24}$：这是 $e^{-r}$ 的四阶泰勒多项式。它在 $[0,1]$ 上是递减函数，并且在该区间内始终为正 ($w_0(0)=1$，$w_0(1) = 9/24  0$)。对于 $r0$，$w_0(r)=0$ 的第一个根约等于 $r \\approx 2.785$。\n\n对所有权重都非负的最严格条件来自于 $w_3(r) \\ge 0$，它要求 $r \\le 1$。当 $r$ 超过 1 时，$w_3(r)$ 变为负值。这破坏了正性条件。对于单尖峰初始条件 $u_{i-3}^n  0$ 且所有其他 $u_j^n = 0$，所得值 $u_i^{n+1} = w_3(r) u_{i-3}^n$ 将为负。\n\n因此，经典 RK4 方法应用于此半离散系统时保持正性的库朗数阈值为 $r=1$。超过这个阈值，例如 $r=1.05$，会导致一个负权重 ($w_3(1.05)  0$)，这表明即使将格式应用于单调算子，如果时间步长过大，也可能破坏正性。在此特定情况下，RK4 依赖于方法的正性限制 ($r \\le 1$) 恰好与前向欧拉的 CFL 限制 ($r \\le 1$) 相吻合。\n\n### 任务 4：数值验证\n\n提供的 Python 代码实现了所述的数值实验。它设置了包含 $N=128$ 个单元、平流速度为 $a=1$ 的域，并计算了 $\\lambda = a/\\Delta x = 128$。它初始化了一个向量 $\\mathbf{u}^0$，其中只有一个非零项 $u_{10}^0 = 1$。对于测试集中的每个库朗数 $r$，它计算相应的时间步长 $\\Delta t = r/\\lambda$，并使用应用于半离散算子 $\\mathbf{L}\\mathbf{u} = \\lambda(\\mathbf{S}\\mathbf{u} - \\mathbf{u})$ 的经典 RK4 方法将解推进一个步长。`numpy.roll` 函数被用来高效地实现周期性移位算子 $\\mathbf{S}$。最后，它检查所得向量 $\\mathbf{u}^1$ 的任何分量是否为负 (低于 $-10^{-12}$ 的小容差)，并为每种情况报告一个布尔值。结果将证实任务3中的理论发现。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of checking positivity violation for the RK4 scheme\n    applied to a first-order upwind semi-discretization of the linear\n    advection equation.\n    \"\"\"\n\n    # Define problem parameters\n    N = 128  # Number of cells\n    a = 1.0  # Advection speed\n    i_0 = 10 # Index of the initial spike\n\n    # Derived parameters\n    delta_x = 1.0 / N\n    lambda_val = a / delta_x\n\n    # Define the initial condition: a single spike at i_0\n    u0 = np.zeros(N)\n    u0[i_0] = 1.0\n\n    # Define the test cases for the Courant number r = lambda * delta_t\n    test_cases_r = [0.0, 0.5, 1.0, 1.05, 1.60]\n    \n    results = []\n    \n    # Numerical tolerance for checking negativity\n    tolerance = -1e-12\n\n    # Define the semi-discrete operator L such that du/dt = L(u)\n    # L(u)_i = -a/dx * (u_i - u_{i-1}) = -lambda * (u_i - u_{i-1})\n    # This is equivalent to lambda * (u_shifted - u)\n    def L_operator(u_vec):\n        \"\"\"\n        Applies the semi-discrete upwind operator L to a vector u.\n        Uses periodic boundary conditions via np.roll.\n        \"\"\"\n        # np.roll(u, 1) shifts elements to the right, so u_i -> u_{i-1}\n        u_shifted = np.roll(u_vec, 1)\n        return lambda_val * (u_shifted - u_vec)\n\n    for r in test_cases_r:\n        # Calculate the time step delta_t for the current test case\n        if lambda_val > 0:\n            delta_t = r / lambda_val\n        else: # Handle the case of zero advection speed\n            delta_t = 0.0\n\n        # Perform one step of the classical four-stage Runge-Kutta method\n        u_n = u0.copy()\n        \n        # k1 = L(u_n)\n        k1 = L_operator(u_n)\n        \n        # k2 = L(u_n + dt/2 * k1)\n        k2 = L_operator(u_n + (delta_t / 2.0) * k1)\n        \n        # k3 = L(u_n + dt/2 * k2)\n        k3 = L_operator(u_n + (delta_t / 2.0) * k2)\n        \n        # k4 = L(u_n + dt * k3)\n        k4 = L_operator(u_n + delta_t * k3)\n        \n        # u_{n+1} = u_n + dt/6 * (k1 + 2*k2 + 2*k3 + k4)\n        u_next = u_n + (delta_t / 6.0) * (k1 + 2.0 * k2 + 2.0 * k3 + k4)\n        \n        # Check for positivity violation\n        # np.any returns True if any element in the array satisfies the condition\n        violation = np.any(u_next  tolerance)\n        results.append(violation)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3389375"}]}