{"hands_on_practices": [{"introduction": "一个“表现良好”且不产生虚假振荡的数值格式通常需要满足单调性。本练习 [@problem_id:3401094] 将指导你从第一性原理出发，为两种基础格式——迎风格式和Lax-Friedrichs格式——推导这一条件。通过这个过程，你将揭示Courant–Friedrichs–Lewy (CFL) 数在确保数值稳定性和单调性中的关键作用。", "problem": "考虑在均匀网格上的常系数线性平流方程 $u_{t} + a\\,u_{x} = 0$，其中空间步长为 $\\Delta x$，时间步长为 $\\Delta t$，且 $a \\in \\mathbb{R} \\setminus \\{0\\}$ 为常数。考虑两种显式守恒格式：根据 $a$ 的符号使用正确迎风模板的迎风格式，以及Lax–Friedrichs格式。如果一个线性显式有限差分格式在每个网格点上的单步更新可以写成相邻值的线性组合，其系数为非负且和为1，则称该格式为单调的。这意味着该更新是一个凸组合，并且对其每个参数都是非递减的。从这些定义和关于线性显式模板更新及其系数非负性的第一性原理出发，推导迎风格式保持单调的精确Courant–Friedrichs–Lewy (CFL)条件，以及Lax–Friedrichs格式保持单调的精确CFL条件。然后，将这些界限与更新是相邻值的凸组合这一要求联系起来。最后，从你的推导中，提取出保证两种格式同时单调的时间步长 $\\Delta t$（作为 $\\Delta x$ 和 $a$ 的函数）的单个最紧上界。将你的最终答案表示为此最大允许 $\\Delta t$ 的一个闭式解析表达式。无需四舍五入。", "solution": "该问题是有效的。这是一个偏微分方程数值分析领域中适定的、有科学依据的问题。所给定义和格式都是标准的，并且所有必要信息都已提供。\n\n我们首先分析常系数线性平流方程 $u_t + a u_x = 0$，其中 $a \\in \\mathbb{R} \\setminus \\{0\\}$。我们用均匀的空间步长 $\\Delta x$ 和时间步长 $\\Delta t$ 对区域进行离散化。令 $u_j^n$ 表示解 $u(j\\Delta x, n\\Delta t)$ 的数值近似。Courant数定义为 $\\nu = \\frac{a \\Delta t}{\\Delta x}$。\n\n如果更新 $u_j^{n+1}$ 可以表示为前一时间步长的值 $u_k^n$ 的线性组合，且系数非负、和为1，那么这个线性显式有限差分格式就被定义为单调的。即，$u_j^{n+1} = \\sum_k c_k u_k^n$，其中对所有 $k$ 都有 $c_k \\ge 0$ 且 $\\sum_k c_k = 1$。这就是凸组合的定义。\n\n首先，我们分析迎风格式。该格式的表达形式取决于平流速度 $a$ 的符号。\n\n情况1：$a > 0$。特征线方向是从左到右，因此我们对空间导数使用后向差分，$u_x \\approx (u_j^n - u_{j-1}^n) / \\Delta x$。时间向前、空间向后 (FTBS) 的格式为：\n$$\n\\frac{u_j^{n+1} - u_j^n}{\\Delta t} + a \\frac{u_j^n - u_{j-1}^n}{\\Delta x} = 0\n$$\n解出 $u_j^{n+1}$：\n$$\nu_j^{n+1} = u_j^n - \\frac{a \\Delta t}{\\Delta x} (u_j^n - u_{j-1}^n) = u_j^n - \\nu (u_j^n - u_{j-1}^n)\n$$\n$$\nu_j^{n+1} = (1 - \\nu) u_j^n + \\nu u_{j-1}^n\n$$\n系数为 $c_j = 1 - \\nu$ 和 $c_{j-1} = \\nu$。为使格式单调，这些系数必须为非负。由于 $a > 0$、$\\Delta t > 0$ 和 $\\Delta x > 0$，我们有 $\\nu > 0$，因此条件 $\\nu \\ge 0$ 得到满足。另一个条件是 $1 - \\nu \\ge 0$，这意味着 $\\nu \\le 1$。系数之和为 $(1 - \\nu) + \\nu = 1$。因此，对于 $a > 0$，单调性条件是 $0  \\nu \\le 1$。\n\n情况2：$a  0$。特征线方向是从右到左，因此我们对空间导数使用前向差分，$u_x \\approx (u_{j+1}^n - u_j^n) / \\Delta x$。时间向前、空间向前 (FTFS) 的格式为：\n$$\n\\frac{u_j^{n+1} - u_j^n}{\\Delta t} + a \\frac{u_{j+1}^n - u_j^n}{\\Delta x} = 0\n$$\n解出 $u_j^{n+1}$：\n$$\nu_j^{n+1} = u_j^n - \\frac{a \\Delta t}{\\Delta x} (u_{j+1}^n - u_j^n) = u_j^n - \\nu (u_{j+1}^n - u_j^n)\n$$\n$$\nu_j^{n+1} = (1 + \\nu) u_j^n - \\nu u_{j+1}^n\n$$\n系数为 $c_j = 1 + \\nu$ 和 $c_{j+1} = -\\nu$。为了单调性，这些系数必须为非负。由于 $a  0$，我们有 $\\nu  0$，因此条件 $-\\nu \\ge 0$ 得到满足。另一个条件是 $1 + \\nu \\ge 0$，这意味着 $\\nu \\ge -1$。系数之和为 $(1 + \\nu) + (-\\nu) = 1$。因此，对于 $a  0$，单调性条件是 $-1 \\le \\nu  0$。\n\n结合迎风格式的两种情况，单调性条件为 $-1 \\le \\nu \\le 1$。这可以写成Courant数的绝对值的形式，$|\\nu| \\le 1$，它等价于Courant–Friedrichs–Lewy (CFL)条件：\n$$\n\\frac{|a| \\Delta t}{\\Delta x} \\le 1\n$$\n\n接下来，我们分析Lax–Friedrichs格式。该格式对空间导数使用中心差分，并将时间导数中的项 $u_j^n$ 替换为其相邻值的平均值 $\\frac{1}{2}(u_{j-1}^n + u_{j+1}^n)$。\n$$\n\\frac{u_j^{n+1} - \\frac{1}{2}(u_{j-1}^n + u_{j+1}^n)}{\\Delta t} + a \\frac{u_{j+1}^n - u_{j-1}^n}{2\\Delta x} = 0\n$$\n解出 $u_j^{n+1}$：\n$$\nu_j^{n+1} = \\frac{1}{2}(u_{j-1}^n + u_{j+1}^n) - \\frac{a \\Delta t}{2\\Delta x} (u_{j+1}^n - u_{j-1}^n)\n$$\n按 $u_{j-1}^n$ 和 $u_{j+1}^n$ 分组并代入 $\\nu = \\frac{a \\Delta t}{\\Delta x}$：\n$$\nu_j^{n+1} = \\left(\\frac{1}{2} + \\frac{\\nu}{2}\\right) u_{j-1}^n + \\left(\\frac{1}{2} - \\frac{\\nu}{2}\\right) u_{j+1}^n\n$$\n系数为 $c_{j-1} = \\frac{1}{2}(1 + \\nu)$ 和 $c_{j+1} = \\frac{1}{2}(1 - \\nu)$。为了单调性，这些系数必须为非负。\n$c_{j-1} \\ge 0 \\implies 1 + \\nu \\ge 0 \\implies \\nu \\ge -1$。\n$c_{j+1} \\ge 0 \\implies 1 - \\nu \\ge 0 \\implies \\nu \\le 1$。\n系数之和为 $\\frac{1}{2}(1 + \\nu) + \\frac{1}{2}(1 - \\nu) = \\frac{1}{2} + \\frac{\\nu}{2} + \\frac{1}{2} - \\frac{\\nu}{2} = 1$。\n因此，Lax–Friedrichs格式保持单调的条件是 $-1 \\le \\nu \\le 1$，这等价于与迎风格式相同的CFL条件：\n$$\n\\frac{|a| \\Delta t}{\\Delta x} \\le 1\n$$\n与凸组合性质的联系在单调格式的定义中是固有的。在我们对两种格式的推导中，我们都强制要求模板系数必须非负且和为1。这些正是凸组合中系数的定义性质。因此，所推导出的CFL条件是这些格式的单步更新成为相邻值凸组合的充要条件。\n\n最后，我们必须找到保证两种格式同时单调的时间步长 $\\Delta t$ 的单个最紧上界。\n迎风格式保持单调的条件是 $\\frac{|a| \\Delta t}{\\Delta x} \\le 1$。\nLax–Friedrichs格式保持单调的条件也是 $\\frac{|a| \\Delta t}{\\Delta x} \\le 1$。\n由于两种格式施加了完全相同的条件，它们同时单调的条件也就是这个相同的条件。为了找到最大允许的 $\\Delta t$，我们对不等式求解 $\\Delta t$：\n$$\n|a| \\Delta t \\le \\Delta x\n$$\n由于 $a \\in \\mathbb{R} \\setminus \\{0\\}$， $|a|$ 是一个正常数，因此我们可以用它来除不等式两边而不改变不等号的方向：\n$$\n\\Delta t \\le \\frac{\\Delta x}{|a|}\n$$\n$\\Delta t$ 的最紧上界是它能取到的最大值，即该不等式的右侧。\n最大允许的 $\\Delta t$ 是 $\\frac{\\Delta x}{|a|}$。", "answer": "$$\\boxed{\\frac{\\Delta x}{|a|}}$$", "id": "3401094"}, {"introduction": "戈杜诺夫定理指出，任何线性单调格式的精度最多为一阶。本练习 [@problem_id:3401114] 深入探讨了其背后的原因，要求你在解的一个光滑极值点处计算局部截断误差。这一分析将揭示，在解的梯度消失点，通常作为高阶项的误差项如何成为主导的一阶误差，从而为定理提供了直接的解析证据。", "problem": "考虑线性平流方程 $u_{t} + a\\,u_{x} = 0$，其中平流速度 $a>0$ 为常数，在空间步长为 $\\Delta x$、时间步长为 $\\Delta t$ 的均匀网格上。设数值解由一个采用前向欧拉时间步进的守恒单调戈杜诺夫 (Godunov) 格式推进：\n$$\nu_{i}^{n+1} \\;=\\; u_{i}^{n} \\;-\\; \\frac{\\Delta t}{\\Delta x}\\Big(F\\big(u_{i}^{n},u_{i+1}^{n}\\big) \\;-\\; F\\big(u_{i-1}^{n},u_{i}^{n}\\big)\\Big),\n$$\n其中 $F$ 是戈杜诺夫 (Godunov) 数值通量。对于线性通量 $f(u)=a\\,u$ 和 $a>0$，戈杜诺夫 (Godunov) 通量简化为迎风形式 $F(u_{L},u_{R}) = a\\,u_{L}$。定义库朗-弗里德里希斯-路易 (Courant-Friedrichs-Lewy, CFL) 数为 $\\nu := \\dfrac{a\\,\\Delta t}{\\Delta x}$。\n\n假设精确解 $u(x,t)$ 在点 $(x_{\\star},t_{\\star})$ 的邻域内是三阶连续可微的，且在该点处有一个单一的严格光滑极大值，即 $u_{x}(x_{\\star},t_{\\star})=0$ 和 $u_{xx}(x_{\\star},t_{\\star})0$。格式在网格点 $x_{i}=x_{\\star}$ 和时间层 $t^{n}=t_{\\star}$ 的局部截断误差 $\\tau_{i}^{n}$ 定义为将精确解代入格式中：\n$$\n\\tau_{i}^{n} \\;:=\\; \\frac{u(x_{i},t^{n+1})-u(x_{i},t^{n})}{\\Delta t} \\;+\\; \\frac{F\\big(u(x_{i},t^{n}),u(x_{i+1},t^{n})\\big)-F\\big(u(x_{i-1},t^{n}),u(x_{i},t^{n})\\big)}{\\Delta x}.\n$$\n\n仅从偏微分方程 $u_{t}+a\\,u_{x}=0$、$a>0$ 时戈杜诺夫 (Godunov) 通量的定义以及光滑函数的泰勒展开出发，计算在 $(x_{i},t^{n})=(x_{\\star},t_{\\star})$ 处 $\\tau_{i}^{n}$ 的主阶项，并在固定 $0  \\nu \\leq 1$ 的标度关系 $\\Delta t=\\nu\\,\\Delta x/a$ 下证明其关于 $\\Delta x$ 的阶数。将最终答案表示为 $\\tau_{i}^{n}$ 主阶项的单个闭式解析表达式，用 $a$、$\\nu$、$\\Delta x$ 和 $u_{xx}(x_{\\star},t_{\\star})$ 表示。最终答案中不要包含任何大O符号。无需四舍五入。", "solution": "该问题是有效的，因为它具有科学依据、良定、客观，并包含唯一解所需的所有信息。它构成了对一个著名数值格式的局部截断误差的标准分析。\n\n在网格点 $(x_{i}, t^{n})$ 处的局部截断误差 $\\tau_{i}^{n}$ 是通过将精确解 $u(x,t)$ 代入数值格式得到的：\n$$\n\\tau_{i}^{n} = \\frac{u(x_{i},t^{n+1})-u(x_{i},t^{n})}{\\Delta t} + \\frac{F\\big(u(x_{i},t^{n}),u(x_{i+1},t^{n})\\big)-F\\big(u(x_{i-1},t^{n}),u(x_{i},t^{n})\\big)}{\\Delta x}\n$$\n问题考虑的是常数 $a>0$ 的线性平流方程 $u_{t} + a\\,u_{x} = 0$。数值通量是戈杜诺夫 (Godunov) 通量，对于线性通量函数 $f(u)=a\\,u$ 且 $a>0$ 的情况，它简化为迎风通量 $F(u_{L},u_{R}) = a\\,u_{L}$。\n\n将戈杜诺夫 (Godunov) 通量的具体形式代入截断误差的定义中，我们得到：\n$$\nF\\big(u(x_{i},t^{n}),u(x_{i+1},t^{n})\\big) = a\\,u(x_{i},t^{n})\n$$\n$$\nF\\big(u(x_{i-1},t^{n}),u(x_{i},t^{n})\\big) = a\\,u(x_{i-1},t^{n})\n$$\n因此，局部截断误差的表达式变为：\n$$\n\\tau_{i}^{n} = \\frac{u(x_{i},t^{n+1})-u(x_{i},t^{n})}{\\Delta t} + \\frac{a\\,u(x_{i},t^{n}) - a\\,u(x_{i-1},t^{n})}{\\Delta x}\n$$\n为求主阶项，我们对每一项在点 $(x_{i}, t^{n})$ 附近进行泰勒级数展开。我们假设解 $u(x,t)$ 足够光滑（问题指定为 $C^3$）。设 $u_t$, $u_x$, $u_{tt}$, $u_{xx}$ 等表示在 $(x_{i}, t^{n})$ 处求值的 $u$ 的偏导数。\n\n第一项按时间展开：\n$$\nu(x_{i},t^{n+1}) = u(x_{i},t^{n}) + \\Delta t \\, u_t + \\frac{(\\Delta t)^2}{2} u_{tt} + O\\big((\\Delta t)^3\\big)\n$$\n因此，时间导数的有限差分近似变为：\n$$\n\\frac{u(x_{i},t^{n+1})-u(x_{i},t^{n})}{\\Delta t} = u_t + \\frac{\\Delta t}{2} u_{tt} + O\\big((\\Delta t)^2\\big)\n$$\n第二项涉及空间差分。我们将 $u(x_{i-1},t^{n})$ 在 $x_{i}$ 附近展开：\n$$\nu(x_{i-1},t^{n}) = u(x_{i},t^{n}) - \\Delta x \\, u_x + \\frac{(\\Delta x)^2}{2} u_{xx} + O\\big((\\Delta x)^3\\big)\n$$\n将此代入截断误差的空间部分：\n$$\n\\frac{a\\,u(x_{i},t^{n}) - a\\,u(x_{i-1},t^{n})}{\\Delta x} = \\frac{a\\,u(x_{i},t^{n}) - a\\Big(u(x_{i},t^{n}) - \\Delta x \\, u_x + \\frac{(\\Delta x)^2}{2} u_{xx} + O\\big((\\Delta x)^3\\big)\\Big)}{\\Delta x}\n$$\n$$\n= \\frac{a\\,\\Delta x \\, u_x - a\\,\\frac{(\\Delta x)^2}{2} u_{xx} + O\\big((\\Delta x)^3\\big)}{\\Delta x} = a\\,u_x - a\\,\\frac{\\Delta x}{2} u_{xx} + O\\big((\\Delta x)^2\\big)\n$$\n组合展开的各项，局部截断误差为：\n$$\n\\tau_{i}^{n} = \\left(u_t + \\frac{\\Delta t}{2} u_{tt} + \\dots\\right) + \\left(a\\,u_x - a\\,\\frac{\\Delta x}{2} u_{xx} + \\dots\\right)\n$$\n重新整理各项：\n$$\n\\tau_{i}^{n} = (u_t + a\\,u_x) + \\frac{\\Delta t}{2} u_{tt} - a\\,\\frac{\\Delta x}{2} u_{xx} + \\text{H.O.T.}\n$$\n其中 H.O.T. 代表高阶项。由于 $u(x,t)$ 是偏微分方程的精确解，项 $(u_t + a\\,u_x)$ 恒为零。截断误差的表达式简化为：\n$$\n\\tau_{i}^{n} = \\frac{\\Delta t}{2} u_{tt} - a\\,\\frac{\\Delta x}{2} u_{xx} + \\text{H.O.T.}\n$$\n为继续推导，我们必须将时间导数 $u_{tt}$ 与空间导数联系起来。我们将偏微分方程 $u_t = -a\\,u_x$ 对时间求导：\n$$\nu_{tt} = \\frac{\\partial}{\\partial t}(-a\\,u_x) = -a\\,u_{xt}\n$$\n我们也对偏微分方程对空间求导：\n$$\nu_{tx} = \\frac{\\partial}{\\partial x}(-a\\,u_x) = -a\\,u_{xx}\n$$\n由于假设解是 $C^3$ 的，混合偏导数相等，即 $u_{xt} = u_{tx}$。因此，我们有：\n$$\nu_{tt} = -a\\,(-a\\,u_{xx}) = a^2 u_{xx}\n$$\n将此代回 $\\tau_{i}^{n}$ 的表达式中：\n$$\n\\tau_{i}^{n} = \\frac{\\Delta t}{2} (a^2 u_{xx}) - \\frac{a\\,\\Delta x}{2} u_{xx} + \\text{H.O.T.}\n$$\n$$\n\\tau_{i}^{n} = \\frac{a\\,u_{xx}}{2}(a\\,\\Delta t - \\Delta x) + \\text{H.O.T.}\n$$\n问题指定了标度关系 $\\Delta t = \\nu\\,\\Delta x/a$，其中 $\\nu = \\frac{a\\,\\Delta t}{\\Delta x}$ 是 CFL 数。代入 $\\Delta t$：\n$$\n\\tau_{i}^{n} = \\frac{a\\,u_{xx}}{2}\\left(a\\,\\frac{\\nu\\,\\Delta x}{a} - \\Delta x\\right) + \\text{H.O.T.} = \\frac{a\\,u_{xx}}{2}(\\nu\\,\\Delta x - \\Delta x) + \\text{H.O.T.}\n$$\n提出因子 $\\Delta x$ 得到截断误差的主阶项：\n$$\n\\tau_{i}^{n} = \\frac{a}{2}( \\nu - 1) u_{xx} \\Delta x + \\text{H.O.T.}\n$$\n此表达式在 $u_{xx}$ 有定义的任意点 $(x_i, t^n)$ 处均有效。问题要求的是在点 $(x_{i},t^{n})=(x_{\\star},t_{\\star})$ 处的这个主阶项，在该点处精确解有一个光滑极大值，意味着 $u_{x}(x_{\\star},t_{\\star})=0$ 和 $u_{xx}(x_{\\star},t_{\\star})0$。由于 $u_{xx}$ 在该点非零，我们计算出的项确实是主阶项（前提是 $\\nu \\neq 1$）。其大小与 $\\Delta x$ 成正比，表明该格式是一阶精度的。\n\n因此，在 $(x_{\\star},t_{\\star})$ 处的局部截断误差的主阶项是：\n$$\n\\frac{a}{2}( \\nu - 1) u_{xx}(x_{\\star},t_{\\star}) \\Delta x\n$$\n为清晰起见重写，我们得到最终表达式。", "answer": "$$\n\\boxed{\\frac{1}{2}a(\\nu - 1) u_{xx}(x_{\\star},t_{\\star}) \\Delta x}\n$$", "id": "3401114"}, {"introduction": "为了将理论与实践联系起来，最后的这个练习 [@problem_id:3401131] 是一个计算实验，旨在直观地展示戈杜诺夫阶数屏障。通过实现并比较一个带有和不带总变差递减 (Total Variation Diminishing, TVD) 斜率限制器的高分辨率格式，你可以直接观察到其后果。这个实践清晰地展示了施加单调性类的属性在控制振荡的同时，为何不可避免地会在光滑极值点处将格式的精度降低到一阶。", "problem": "考虑一维空间中的线性平流方程，\n$$\n\\partial_t u(x,t) + a \\,\\partial_x u(x,t) = 0, \\quad x \\in [0,1], \\quad t \\ge 0,\n$$\n在区域 $[0,1]$ 上具有周期性边界条件，以及恒定的平流速度 $a>0$。设初始条件为光滑的周期函数\n$$\nu(x,0) = u_0(x) = \\sin(2\\pi x) + \\tfrac{1}{4}\\sin(6\\pi x).\n$$\n对于一个区域遍历时间的整数倍，即对于任何满足 $a\\,T$ 为整数的 $T$，精确解满足 $u(x,T)=u_0(x)$，对所有 $x \\in [0,1]$ 均成立。\n\n您将在一个均匀网格上实现一个有限体积法，该网格包含 $N$ 个宽度为 $\\Delta x = 1/N$ 的单元，单元中心为 $x_i = (i+0.5)\\Delta x$，其中 $i=0,\\dots,N-1$。该方法使用：\n- 界面上的戈杜诺夫迎风数值通量，\n- 每个单元内的二阶分段线性重构，\n- 无限制（中心）斜率或通过 minmod 限制器的总变差递减（TVD）限制斜率，\n- 强稳定性保持（SSP）三阶 Runge–Kutta 时间积分器（也称为 Shu–Osher SSP-RK3），\n- Courant–Friedrichs–Lewy (CFL) 时间步长限制，使用预设的无量纲数 $\\nu \\in (0,1)$，时间步长为 $\\Delta t = \\nu \\,\\Delta x/a$，并采用整数步数以精确达到时间 $T$。\n\n单元 $i$ 内的二阶重构定义为\n$$\nu_i(x) = \\bar{u}_i + \\sigma_i \\,\\frac{x - x_i}{\\Delta x/2}, \\quad x \\in [x_{i-1/2}, x_{i+1/2}],\n$$\n其中 $\\bar{u}_i$ 是单元平均值（对于此光滑测试，用 $x_i$ 处的点值近似），$x_{i\\pm 1/2}$ 是单元面，$\\sigma_i$ 是斜率。在每个面 $x_{i+1/2}$ 处，将左侧重构状态定义为\n$$\nu_{i+1/2}^{-} = \\bar{u}_i + \\tfrac{1}{2}\\,\\sigma_i.\n$$\n对于 $a>0$，戈杜诺夫迎风通量使用此左侧状态：\n$$\nF_{i+1/2} = a\\,u_{i+1/2}^{-}.\n$$\n半离散有限体积更新公式为\n$$\n\\frac{d\\bar{u}_i}{dt} = -\\frac{F_{i+1/2}-F_{i-1/2}}{\\Delta x}.\n$$\n\n定义两种斜率选择：\n- 无限制中心斜率：\n$$\n\\sigma_i^{\\text{unlim}} = \\frac{1}{2}\\left( \\bar{u}_{i+1}-\\bar{u}_{i-1}\\right).\n$$\n- 限制性 minmod 斜率：\n$$\n\\sigma_i^{\\text{mm}} = \\operatorname{minmod}\\left(\\bar{u}_i - \\bar{u}_{i-1},\\; \\bar{u}_{i+1}-\\bar{u}_i\\right),\n$$\n其中 minmod 函数定义为\n$$\n\\operatorname{minmod}(a,b) = \n\\begin{cases}\n\\operatorname{sign}(a)\\,\\min(|a|,|b|),  ab>0,\\\\\n0,  ab\\le 0.\n\\end{cases}\n$$\n将时间推进到 $T=1$，其中 $a=1$，此时精确解返回到 $u_0(x)$。对于在 $T$ 时刻的每个数值解，计算误差 $e_i = \\bar{u}_i^{\\text{num}}(T) - u_0(x_i)$ 和范数\n$$\n\\|e\\|_{L^1} = \\sum_{i=0}^{N-1} |e_i|\\,\\Delta x, \\qquad \\|e\\|_{L^\\infty} = \\max_{0\\le i \\le N-1} |e_i|.\n$$\n使用网格加密级别 $N \\in \\{64, 128, 256, 512\\}$ 和一个固定的 Courant 数 $\\nu = 0.4$。通过下式估算连续加密之间的观测精度阶\n$$\np = \\frac{\\log\\left(\\frac{E(N)}{E(2N)}\\right)}{\\log 2},\n$$\n其中 $E(N)$ 是具有 $N$ 个单元的网格上的误差范数。为减少前渐近效应，报告最后两次加密比率的平均值，即从 $(N=128 \\to 256)$ 和 $(N=256 \\to 512)$ 计算出的阶数的平均值。\n\n戈杜诺夫阶数障碍定理指出，任何用于标量守恒律的线性单调方法最多只能是一阶精度的。在实际的高分辨率方法中，TVD 斜率限制器强制执行类单调属性，并且已知它们会在 $L^\\infty$ 范数下的光滑极值点处将精度降低到一阶。相比之下，无限制的二阶重构不是 TVD，但在光滑区域能达到二阶精度。\n\n实现上述方法，并生成以下四个观测阶数作为您的测试套件：\n1. 无限制二阶重构，$L^\\infty$ 观测阶数。\n2. 限制性（minmod）重构，$L^\\infty$ 观测阶数。\n3. 无限制二阶重构，$L^1$ 观测阶数。\n4. 限制性（minmod）重构，$L^1$ 观测阶数。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，`[r1,r2,r3,r4]`）。每个条目必须是一个浮点数。此问题不需要物理单位。角度单位不适用。\n\n测试套件是上述四种情况的集合；每种情况都使用相同的参数 $a=1$，$T=1$，$\\nu=0.4$ 和 $N \\in \\{64,128,256,512\\}$，仅在斜率重构的选择（无限制与 minmod）和误差范数（$L^\\infty$ 与 $L^1$）上有所不同。最终输出应是按上述顺序排列的四个观测阶数的列表。", "solution": "用户希望通过实现一个线性平流方程的数值格式并测量其收敛率来验证该格式。该问题在科学上是有效的且适定的，提供了控制方程、初始和边界条件以及数值方法的详细说明。我们将进行完整的求解。\n\n该问题研究一维线性平流方程，\n$$\n\\partial_t u(x,t) + a \\,\\partial_x u(x,t) = 0\n$$\n在一个周期性区域 $x \\in [0,1]$ 上，具有恒定的平流速度 $a=1$。初始条件是一个光滑函数 $u(x,0) = u_0(x) = \\sin(2\\pi x) + \\frac{1}{4}\\sin(6\\pi x)$。我们将解演化到时间 $T=1$。由于 $aT = 1 \\cdot 1 = 1$ 是一个整数，时间 $T=1$ 时的精确解与初始条件相同，即 $u(x,1) = u_0(x)$。这为评估数值误差提供了一种便捷的方法。\n\n解是使用二阶有限体积法计算的。实现的关键步骤如下：\n\n1.  **空间离散化**：\n    区域 $[0,1]$ 被划分为 $N$ 个均匀单元，每个单元的宽度为 $\\Delta x = 1/N$。单元中心位于 $x_i = (i+0.5)\\Delta x$，其中 $i=0, \\dots, N-1$。数值解由单元平均值表示，$\\bar{u}_i(t) \\approx \\frac{1}{\\Delta x}\\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) dx$。对于具有光滑初始条件的此问题，我们用单元中心处的点值来初始化单元平均值：$\\bar{u}_i(0) = u_0(x_i)$。\n\n2.  **半离散格式**：\n    有限体积法导出关于单元平均值的常微分方程组（ODEs），称为半离散形式：\n    $$\n    \\frac{d\\bar{u}_i}{dt} = -\\frac{F_{i+1/2}-F_{i-1/2}}{\\Delta x}\n    $$\n    其中 $F_{i+1/2}$ 是穿过界面 $x_{i+1/2}$ 的数值通量。对于 $a>0$ 的线性平流方程，戈杜诺夫迎风通量由界面左侧的状态 $u_{i+1/2}^{-}$ 确定：\n    $$\n    F_{i+1/2} = a\\,u_{i+1/2}^{-}\n    $$\n    左侧状态 $u_{i+1/2}^{-}$ 是从单元 $i$ 内的分段线性重构中获得的。问题指定了公式：\n    $$\n    u_{i+1/2}^{-} = \\bar{u}_i + \\tfrac{1}{2}\\,\\sigma_i\n    $$\n    其中 $\\sigma_i$ 是一个表示跨单元 $i$ 的斜率相关变化的量。周期性边界条件通过对单元索引进行模 $N$ 运算来处理，例如 $\\bar{u}_{-1} = \\bar{u}_{N-1}$ 和 $\\bar{u}_{N} = \\bar{u}_{0}$。\n\n3.  **斜率计算**：\n    为比较标准二阶格式和总变差递减（TVD）格式，实现了斜率项 $\\sigma_i$ 的两种选择。\n    -   **无限制中心斜率**：此选择导致一个线性的、非单调的二阶格式。斜率项定义为：\n        $$\n        \\sigma_i^{\\text{unlim}} = \\frac{1}{2}\\left( \\bar{u}_{i+1}-\\bar{u}_{i-1}\\right)\n        $$\n    -   **限制性 Minmod 斜率**：此选择采用 `minmod` 函数来限制斜率，确保格式是 TVD 的。这可以防止在陡峭梯度附近的伪振荡，但可能会降低精度阶。斜率项为：\n        $$\n        \\sigma_i^{\\text{mm}} = \\operatorname{minmod}\\left(\\bar{u}_i - \\bar{u}_{i-1},\\; \\bar{u}_{i+1}-\\bar{u}_i\\right)\n        $$\n        `minmod` 函数定义为：如果 $ab>0$，则 $\\operatorname{minmod}(a,b) = \\operatorname{sign}(a)\\,\\min(|a|,|b|)$，否则为 $0$。\n\n    半离散系统的右侧项，我们可以表示为 $L(\\bar{\\mathbf{u}})$，在每个时间步为所有单元 $i=0, \\dots, N-1$ 计算。\n\n4.  **时间积分**：\n    该常微分方程组使用三阶强稳定性保持 Runge-Kutta (SSP-RK3) 方法进行时间推进。给定时间 $t_n$ 的解 $\\bar{\\mathbf{u}}^n$，时间 $t_{n+1} = t_n+\\Delta t$ 的解通过三个阶段计算：\n    $$\n    \\begin{aligned}\n    \\bar{\\mathbf{u}}^{(1)} = \\bar{\\mathbf{u}}^n + \\Delta t L(\\bar{\\mathbf{u}}^n) \\\\\n    \\bar{\\mathbf{u}}^{(2)} = \\frac{3}{4}\\bar{\\mathbf{u}}^n + \\frac{1}{4}\\left(\\bar{\\mathbf{u}}^{(1)} + \\Delta t L(\\bar{\\mathbf{u}}^{(1)})\\right) \\\\\n    \\bar{\\mathbf{u}}^{n+1} = \\frac{1}{3}\\bar{\\mathbf{u}}^n + \\frac{2}{3}\\left(\\bar{\\mathbf{u}}^{(2)} + \\Delta t L(\\bar{\\mathbf{u}}^{(2)})\\right)\n    \\end{aligned}\n    $$\n    时间步长 $\\Delta t$ 是基于一个固定的 Courant 数 $\\nu = 0.4$ 选择的，目标时间步长为 $\\Delta t_{\\text{target}} = \\nu \\Delta x/a$。为了精确达到最终时间 $T=1$，我们将步数计算为 $N_{\\text{steps}} = \\lceil T/\\Delta t_{\\text{target}} \\rceil$ 并将时间步长调整为 $\\Delta t = T/N_{\\text{steps}}$。\n\n5.  **误差分析与收敛阶**：\n    将解演化到 $T=1$ 后，相对于精确解 $u_0(x_i)$ 计算误差。误差向量为 $e_i = \\bar{u}_i(T) - u_0(x_i)$。计算两个误差范数：\n    $$\n    \\|e\\|_{L^1} = \\sum_{i=0}^{N-1} |e_i|\\,\\Delta x, \\qquad \\|e\\|_{L^\\infty} = \\max_{0\\le i \\le N-1} |e_i|\n    $$\n    对一系列加密的网格（$N \\in \\{64, 128, 256, 512\\}$）重复此过程。使用以下公式估算两个连续网格加密之间的观测精度阶 $p$：\n    $$\n    p = \\frac{\\log\\left(E(N)/E(2N)\\right)}{\\log 2}\n    $$\n    其中 $E(N)$ 是具有 $N$ 个单元的网格上的给定误差范数。最终报告的阶数是从 $(N=128 \\to 256)$ 和 $(N=256 \\to 512)$ 加密计算出的阶数的平均值。按要求，对所有四种斜率选择和误差范数的组合都执行此操作。预期结果与戈杜诺夫阶数障碍定理和 TVD 格式理论一致：无限制格式具有二阶精度，但由于在光滑极值点处的截断，限制格式在 $L^\\infty$ 范数下精度降至一阶。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and analyzes a second-order finite volume method for the\n    linear advection equation to verify its convergence properties with\n    different slope limiters, in accordance with Godunov's theorem.\n    \"\"\"\n\n    def rhs(u_bar, dx, a, limiter_type):\n        \"\"\"\n        Computes the right-hand-side of the semi-discrete finite volume scheme.\n        d(u_bar)/dt = L(u_bar)\n        \n        Args:\n            u_bar (np.ndarray): Array of cell averages.\n            dx (float): Cell width.\n            a (float): Advection speed.\n            limiter_type (str): 'unlimited' or 'minmod'.\n            \n        Returns:\n            np.ndarray: The time derivative of cell averages.\n        \"\"\"\n        # Enforce periodic boundary conditions using np.roll\n        u_L = np.roll(u_bar, 1)  # u_{i-1}\n        u_R = np.roll(u_bar, -1) # u_{i+1}\n\n        # Calculate slopes based on the chosen limiter\n        if limiter_type == 'unlimited':\n            # Unlimited central difference slope term\n            sigma = 0.5 * (u_R - u_L)\n        elif limiter_type == 'minmod':\n            # Minmod limited slope term\n            delta_L = u_bar - u_L\n            delta_R = u_R - u_bar\n            ab = delta_L * delta_R\n            sigma = np.zeros_like(u_bar)\n            mask = ab > 0\n            sigma[mask] = np.sign(delta_L[mask]) * np.minimum(np.abs(delta_L[mask]), np.abs(delta_R[mask]))\n        else:\n            raise ValueError(f\"Unknown limiter type: {limiter_type}\")\n\n        # Reconstruct state at the left side of the interface i+1/2\n        u_minus_at_i_plus_half = u_bar + 0.5 * sigma\n        \n        # Godunov upwind flux for a > 0\n        flux_i_plus_half = a * u_minus_at_i_plus_half\n\n        # Flux at i-1/2 by rolling the F_{i+1/2} array\n        flux_i_minus_half = np.roll(flux_i_plus_half, 1)\n        \n        # Compute the semi-discrete update\n        dudt = -(flux_i_plus_half - flux_i_minus_half) / dx\n        return dudt\n\n    def run_simulation(N, limiter_type, a, T, nu):\n        \"\"\"\n        Runs a single numerical simulation for a given grid size and limiter.\n\n        Args:\n            N (int): Number of grid cells.\n            limiter_type (str): 'unlimited' or 'minmod'.\n            a (float): Advection speed.\n            T (float): Final time.\n            nu (float): Courant number.\n\n        Returns:\n            tuple (float, float): L-infinity and L-1 errors.\n        \"\"\"\n        # --- Grid and Initial Condition ---\n        dx = 1.0 / N\n        x = (np.arange(N) + 0.5) * dx\n        \n        def u0_func(x_coords):\n            return np.sin(2 * np.pi * x_coords) + 0.25 * np.sin(6 * np.pi * x_coords)\n\n        u_exact = u0_func(x)\n        u = u_exact.copy()\n\n        # --- Time Stepping ---\n        # Adjust dt to hit the final time T exactly\n        dt_target = nu * dx / a\n        num_steps = int(np.ceil(T / dt_target))\n        dt = T / num_steps\n\n        # --- SSP-RK3 Time Integration Loop ---\n        for _ in range(num_steps):\n            # Stage 1\n            u1 = u + dt * rhs(u, dx, a, limiter_type)\n            # Stage 2\n            u2 = 0.75 * u + 0.25 * (u1 + dt * rhs(u1, dx, a, limiter_type))\n            # Stage 3\n            u = (1.0 / 3.0) * u + (2.0 / 3.0) * (u2 + dt * rhs(u2, dx, a, limiter_type))\n\n        # --- Error Calculation ---\n        error_vec = u - u_exact\n        err_linf = np.max(np.abs(error_vec))\n        err_l1 = np.sum(np.abs(error_vec)) * dx\n        \n        return err_linf, err_l1\n\n    # --- Main Driver ---\n    # Parameters for the numerical experiment\n    a = 1.0\n    T = 1.0\n    nu = 0.4\n    N_list = [64, 128, 256, 512]\n    \n    # Store errors for each case\n    errors = {\n        'unlimited': {'L_inf': {}, 'L_1': {}},\n        'minmod': {'L_inf': {}, 'L_1': {}}\n    }\n    \n    # Run simulations for all specified grid sizes and limiters\n    for limiter in ['unlimited', 'minmod']:\n        for N in N_list:\n            err_linf, err_l1 = run_simulation(N, limiter, a, T, nu)\n            errors[limiter]['L_inf'][N] = err_linf\n            errors[limiter]['L_1'][N] = err_l1\n    \n    results = []\n    \n    # --- Calculate and store observed orders of accuracy ---\n    def calculate_avg_order(error_dict):\n        p_128_256 = np.log(error_dict[128] / error_dict[256]) / np.log(2)\n        p_256_512 = np.log(error_dict[256] / error_dict[512]) / np.log(2)\n        return (p_128_256 + p_256_512) / 2.0\n\n    # 1. Unlimited reconstruction, L^inf observed order\n    results.append(calculate_avg_order(errors['unlimited']['L_inf']))\n\n    # 2. Limited (minmod) reconstruction, L^inf observed order\n    results.append(calculate_avg_order(errors['minmod']['L_inf']))\n\n    # 3. Unlimited second-order reconstruction, L^1 observed order\n    results.append(calculate_avg_order(errors['unlimited']['L_1']))\n\n    # 4. Limited (minmod) reconstruction, L^1 observed order\n    results.append(calculate_avg_order(errors['minmod']['L_1']))\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15f}' for r in results)}]\")\n\nsolve()\n```", "id": "3401131"}]}