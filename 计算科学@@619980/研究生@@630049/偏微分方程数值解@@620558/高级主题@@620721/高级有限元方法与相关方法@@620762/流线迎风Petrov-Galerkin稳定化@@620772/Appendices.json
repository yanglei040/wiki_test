{"hands_on_practices": [{"introduction": "要真正掌握流线迎风Petrov-Galerkin (SUPG) 方法，第一步是在最基础的层面理解它如何修正代数系统。本练习将引导你推导一维情形下SUPG方法的刚度矩阵，通过这个过程，你将能明确地识别出SUPG为稳定数值解而引入的“人工扩散”项，从而揭示其核心稳定机制。[@problem_id:3448963]", "problem": "考虑在开区间 $(0,L)$ 上的具有常数系数的一维稳态对流扩散边值问题，其偏微分方程为\n$$\n-\\mu\\,\\frac{d^{2}u}{dx^{2}} + a\\,\\frac{du}{dx} = f(x),\n$$\n其中 $a>0$ 为常数对流速度，$\\mu \\ge 0$ 为（可能很小的）扩散系数，$f$ 为一个足够光滑的源项。使用间距为 $h>0$ 的均匀网格对区域进行离散，并采用连续分段线性拉格朗日基函数（线性 $P_1$ 单元）的标准协调有限元法来近似 $u$。采用流线迎风Petrov-Galerkin (SUPG) 稳定化方法，该方法在每个单元上用Petrov-Galerkin测试函数 $w + \\tau\\,a\\,\\frac{dw}{dx}$ 替换标准测试函数 $w$，其中 $\\tau \\ge 0$ 是一个常数稳定化参数。假设 $a$、$\\mu$ 和 $\\tau$ 为常数，并对弱形式中的对流项不使用分部积分。\n\n从弱形式和SUPG测试函数的定义出发，推导单元级双线性形式，并组合其贡献，以获得与内部节点 $i$ 相关的代数刚度矩阵行。使用局部节点形函数 $N_1$（左）和 $N_2$（右）及其导数，直接在物理单元 $[x_{i-1},x_i]$ 和 $[x_i,x_{i+1}]$ 上进行计算。对线性 $P_1$ 基函数，精确计算所有单元积分。然后组合来自两个相邻单元的贡献，以获得内部行 $i$ 的三点格式，即乘以节点 $i-1$、$i$ 和 $i+1$ 处未知数的系数。\n\n以 $a$、$\\mu$、$h$ 和 $\\tau$ 表示，按 $\\{i-1,i,i+1\\}$ 的顺序，将SUPG刚度矩阵行的最终内部节点三点格式系数报告为一个 $1\\times 3$ 的行矩阵。此外，请指出与标准Galerkin离散化产生的中心差分格式相比，对流格式的修正项是什么。最终答案必须是无单位的解析表达式。", "solution": "用户希望推导应用于一维对流扩散问题的流线迎风Petrov-Galerkin (SUPG) 方法的三点格式。\n\n### 步骤 1：提取已知条件\n-   **控制方程：** 一维稳态对流扩散方程为\n    $$-\\mu\\,\\frac{d^{2}u}{dx^{2}} + a\\,\\frac{du}{dx} = f(x) \\quad \\text{for } x \\in (0,L)$$\n-   **系数：** $a > 0$ 为常数对流速度，$\\mu \\ge 0$ 为常数扩散系数。\n-   **离散化：** 使用间距为 $h > 0$ 的均匀网格对区域进行离散。\n-   **有限元近似：** 试验函数空间 $V_h$ 使用连续分段线性拉格朗日基函数（$P_1$ 单元）。\n-   **稳定化方法：** 采用流线迎风Petrov-Galerkin (SUPG) 方法。\n-   **测试函数：** 标准Galerkin测试函数 $w$ 被Petrov-Galerkin测试函数 $w_{supg} = w + \\tau\\,a\\,\\frac{dw}{dx}$ 替换，其中 $\\tau \\ge 0$ 是一个常数稳定化参数。\n-   **弱形式：** 问题指定对流项的弱形式不使用分部积分。\n-   **目标：**\n    1.  推导内部节点 $i$ 的三点格式，表示节点 $i-1$、$i$ 和 $i+1$ 处未知数的系数。\n    2.  识别与标准Galerkin方法产生的中心差分格式相比，对流格式的修正项。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学依据：** 该问题是偏微分方程数值分析中的一个标准练习。对流扩散方程、有限元法和SUPG稳定化是计算科学与工程中基本且成熟的概念。\n-   **适定性：** 问题提供了唯一推导代数格式所需的所有信息。公式清晰，并能得出一个确定的答案。\n-   **客观性：** 问题以精确的数学语言陈述，没有歧义或主观看法。\n\n### 步骤 3：结论与行动\n问题陈述被确认为**有效**。它是自洽的、科学合理的且适定的。可以继续求解过程。\n\n### SUPG弱形式的推导\n\n控制方程的标准Galerkin弱形式是通过乘以一个测试函数 $w \\in V_h$，在区域 $\\Omega = (0,L)$ 上积分，并对二阶扩散项进行分部积分得到的。这得到：\n找到 $u_h \\in V_h$，使得对于所有 $w_h \\in V_h$，\n$$\n\\int_0^L \\mu \\frac{du_h}{dx} \\frac{dw_h}{dx} dx + \\int_0^L a \\frac{du_h}{dx} w_h dx = \\int_0^L f w_h dx\n$$\n这里，我们按照要求使用了“弱对流项不进行分部积分的形式”。\n\nSUPG方法在Galerkin公式中增加了一个稳定项。该项是通过将在测试函数的“扰动” $\\delta_{w_h} = \\tau a w_h'$ 作用下强微分方程的单元残差 $R(u_h) = -\\mu u_h'' + a u_h' - f$ 的积分相加得到的。积分在所有单元内部的并集上进行。\n$$\n\\sum_{K} \\int_K R(u_h) (\\tau a w_h') dx = \\sum_{K} \\int_K (-\\mu u_h'' + a u_h' - f) (\\tau a w_h') dx\n$$\n由于 $u_h$ 由分段线性函数组成，其二阶导数 $u_h''$ 在每个单元 $K$ 内部为零。稳定项简化为：\n$$\n\\sum_{K} \\int_K (a u_h' - f) (\\tau a w_h') dx = \\sum_{K} \\int_K \\tau a^2 u_h' w_h' dx - \\sum_{K} \\int_K \\tau a f w_h' dx\n$$\n将此项加到Galerkin形式中，并将所有涉及 $f$ 的项移到右侧，我们得到完整的SUPG弱形式：\n找到 $u_h \\in V_h$，使得对于所有 $w_h \\in V_h$，\n$$\n\\int_0^L \\mu u_h' w_h' dx + \\int_0^L a u_h' w_h dx + \\sum_{K} \\int_K \\tau a^2 u_h' w_h' dx = \\int_0^L f w_h dx + \\sum_{K} \\int_K \\tau a f w_h' dx\n$$\n左侧定义了双线性形式 $B_{SUPG}(u_h, w_h)$，刚度矩阵由此导出：\n$$\nB_{SUPG}(u_h, w_h) = \\int_0^L (\\mu + \\tau a^2) \\frac{du_h}{dx} \\frac{dw_h}{dx} dx + \\int_0^L a \\frac{du_h}{dx} w_h dx\n$$\n请注意，在 $\\Omega$ 上的积分可以分解为在单元 $K$ 上的积分之和。由于 $\\tau$ 和 $a$ 是常数，项 $\\sum_K \\int_K$ 等价于 $\\int_0^L$。\n\n### 单元级计算\n\n我们考虑一个长度为 $h$ 的通用单元 $K_e = [x_j, x_{j+1}]$。试验函数 $u_h$ 和测试函数 $w_h$ 使用局部线性形函数 $N_1$ 和 $N_2$ 表示。在坐标为 $\\xi$ 的参考单元 $\\hat{K}=[0,1]$ 上，形函数为 $\\hat{N}_1(\\xi) = 1-\\xi$ 和 $\\hat{N}_2(\\xi) = \\xi$。在物理单元上的导数是常数：$\\frac{dN_1}{dx} = -\\frac{1}{h}$ 和 $\\frac{dN_2}{dx} = \\frac{1}{h}$。\n\n单元刚度矩阵 $k^e$ 的分量为 $k^e_{mn} = B_{SUPG}(N_n, N_m)$，在单元 $K_e$ 上求值，其中 $m$ 是行索引（测试函数），$n$ 是列索引（试验函数）。\n\n双线性形式由两部分组成：一个对称的类扩散部分和一个非对称的对流部分。\n1.  **扩散与稳定化部分：**\n    $k^e_{D,mn} = \\int_{K_e} (\\mu + \\tau a^2) \\frac{dN_n}{dx} \\frac{dN_m}{dx} dx$。\n    由于导数是常数，该矩阵为：\n    $$\n    k^e_D = \\frac{\\mu + \\tau a^2}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}\n    $$\n2.  **对流部分：**\n    $k^e_{A,mn} = \\int_{K_e} a \\frac{dN_n}{dx} N_m dx$。\n    各分量计算如下：\n    $k^e_{A,11} = \\int_{K_e} a(-\\frac{1}{h})N_1 dx = -\\frac{a}{h}\\int_{K_e}N_1 dx = -\\frac{a}{h}(\\frac{h}{2}) = -\\frac{a}{2}$。\n    $k^e_{A,12} = \\int_{K_e} a(+\\frac{1}{h})N_1 dx = +\\frac{a}{h}\\int_{K_e}N_1 dx = +\\frac{a}{h}(\\frac{h}{2}) = +\\frac{a}{2}$。\n    $k^e_{A,21} = \\int_{K_e} a(-\\frac{1}{h})N_2 dx = -\\frac{a}{h}\\int_{K_e}N_2 dx = -\\frac{a}{h}(\\frac{h}{2}) = -\\frac{a}{2}$。\n    $k^e_{A,22} = \\int_{K_e} a(+\\frac{1}{h})N_2 dx = +\\frac{a}{h}\\int_{K_e}N_2 dx = +\\frac{a}{h}(\\frac{h}{2}) = +\\frac{a}{2}$。\n    单元对流矩阵为：\n    $$\n    k^e_A = \\frac{a}{2} \\begin{pmatrix} -1 & 1 \\\\ -1 & 1 \\end{pmatrix}\n    $$\n总单元刚度矩阵为 $k^e = k^e_D + k^e_A$：\n$$\nk^e = \\begin{pmatrix} \\frac{\\mu+\\tau a^2}{h} - \\frac{a}{2} & -\\frac{\\mu+\\tau a^2}{h} + \\frac{a}{2} \\\\ -\\frac{\\mu+\\tau a^2}{h} - \\frac{a}{2} & \\frac{\\mu+\\tau a^2}{h} + \\frac{a}{2} \\end{pmatrix}\n$$\n\n### 内部节点格式的组装\n\n我们为对应于内部节点 $i$ 的全局刚度矩阵行组装系数。该行由两个相邻单元 $K_{left} = [x_{i-1}, x_i]$ 和 $K_{right} = [x_i, x_{i+1}]$ 的贡献构成。测试函数是全局基函数 $N_i$。\n\n-   **$u_{i-1}$ 的系数 ($K_{i,i-1}$):** 此相互作用发生在 $K_{left}$ 上。试验函数是 $N_{i-1}$（局部 $N_1$），测试函数是 $N_i$（局部 $N_2$）。其贡献为 $k^e_{21}$。\n    $$K_{i,i-1} = k^e_{21} = -\\frac{\\mu+\\tau a^2}{h} - \\frac{a}{2}$$\n-   **$u_{i+1}$ 的系数 ($K_{i,i+1}$):** 此相互作用发生在 $K_{right}$ 上。试验函数是 $N_{i+1}$（局部 $N_2$），测试函数是 $N_i$（局部 $N_1$）。其贡献为 $k^e_{12}$。\n    $$K_{i,i+1} = k^e_{12} = -\\frac{\\mu+\\tau a^2}{h} + \\frac{a}{2}$$\n-   **$u_i$ 的系数 ($K_{i,i}$):** 它接收两部分贡献。\n    -   来自 $K_{left}$：试验函数为 $N_i$（局部 $N_2$），测试函数为 $N_i$（局部 $N_2$）。贡献为 $k^e_{22}$。\n    -   来自 $K_{right}$：试验函数为 $N_i$（局部 $N_1$），测试函数为 $N_i$（局部 $N_1$）。贡献为 $k^e_{11}$。\n    $$K_{i,i} = k^e_{22} + k^e_{11} = \\left(\\frac{\\mu+\\tau a^2}{h} + \\frac{a}{2}\\right) + \\left(\\frac{\\mu+\\tau a^2}{h} - \\frac{a}{2}\\right) = \\frac{2(\\mu+\\tau a^2)}{h}$$\n\n内部行 $i$ 的三点格式，按 $\\{u_{i-1}, u_i, u_{i+1}\\}$ 系数的顺序排列为：\n$$\n\\left\\{ -\\frac{\\mu+\\tau a^2}{h} - \\frac{a}{2}, \\quad \\frac{2(\\mu+\\tau a^2)}{h}, \\quad -\\frac{\\mu+\\tau a^2}{h} + \\frac{a}{2} \\right\\}\n$$\n\n### 格式修正项的识别\n\n问题要求识别与标准Galerkin方法产生的中心差分对流格式相比的修正项。如前所推导，对于对流项 $a u'$，标准Galerkin方法（$\\tau=0$）产生的格式为 $\\frac{a}{2}\\{-1, 0, 1\\}$。这对应于方程项 $-\\frac{a}{2}u_{i-1} + \\frac{a}{2}u_{i+1} = a \\frac{u_{i+1}-u_{i-1}}{2}$。当该形式除以 $h$ 时，它恰好是 $a u'$ 的二阶中心差分近似（按 $h$ 缩放）。\n\n问题中“与标准Galerkin离散化产生的中心差分格式相比……的修正项”的措辞有点复杂。更直接的解释是识别SUPG方法添加到Galerkin格式中的项。\n-   **Galerkin格式 ($\\tau=0$):** 这结合了扩散和对流的标准中心差分格式。\n    -   扩散项：$\\frac{\\mu}{h}\\{-1, 2, -1\\}$ (对称)\n    -   对流项：$\\frac{a}{2}\\{-1, 0, 1\\}$ (反对称，中心差分)\n-   **SUPG修正项 ($\\tau>0$):** SUPG从双线性形式 $\\int \\tau a^2 u'w' dx$ 引入了一个附加项。该项的格式为：\n    $$\n    \\frac{\\tau a^2}{h}\\{-1, 2, -1\\}\n    $$\n这个修正项是一个对称的二阶格式，其形式与物理扩散格式相同。它通常被称为**人工扩散**或**流线扩散**项。其目的是为格式增加数值耗散，从而稳定在对流主导流动中中心差分（Galerkin）格式特有的伪振荡。通过为 $\\tau$ 选择一个合适的值（例如，对于纯对流问题，$\\tau = \\frac{h}{2a}$），该项有效地将格式从中心差分类型转变为一阶迎风类型，从而确保稳定性。", "answer": "$$\n\\boxed{\n\\begin{pmatrix} -\\frac{\\mu}{h} - \\frac{\\tau a^2}{h} - \\frac{a}{2} & \\frac{2\\mu}{h} + \\frac{2\\tau a^2}{h} & -\\frac{\\mu}{h} - \\frac{\\tau a^2}{h} + \\frac{a}{2} \\end{pmatrix}\n}\n$$", "id": "3448963"}, {"introduction": "在一维情形的基础上，将SUPG方法应用于多维空间需要在复杂几何形状上定义稳定化参数 $\\tau$。本练习聚焦于一个关键概念：沿流线方向的单元长度 $h_{\\boldsymbol{t}}$。你将为一个二维三角形单元计算该值，并用它来确定最优的 $\\tau$ 值，这是进行多维非结构网格有限元编程的一项核心技能。[@problem_id:2602150]", "problem": "考虑二维空间域中的稳态、无量纲对流-扩散-反应边值问题，\n$$-\\,\\epsilon\\,\\Delta u + \\boldsymbol{\\beta}\\cdot\\nabla u + \\sigma\\,u = f \\quad \\text{在一个多边形域中},$$\n其系数为常数。重点研究一个仿射线性三角形有限元，其顶点位于\n$$\\boldsymbol{x}_1=(0,0),\\quad \\boldsymbol{x}_2=(0.04,0),\\quad \\boldsymbol{x}_3=(0,0.03),$$\n以及相关的线性 Lagrange 节点形函数 $N_i$，这些形函数满足单位分解和线性完备性。设对流速度为 $\\boldsymbol{\\beta}=(10,0.5)$，扩散系数为 $\\epsilon=10^{-4}$，反应系数为 $\\sigma=0$。\n\n(a) 仅从 (i) 线性二节点单元的一维恒等式，即形函数导数的绝对值之和等于 $2/h$（其中 $h$ 是单元长度），以及 (ii) 三角形的仿射映射和方向导数概念出发，推导在流线方向 $\\boldsymbol{t}=\\boldsymbol{\\beta}/\\|\\boldsymbol{\\beta}\\|$ 上的方向单元长度 $h_{\\boldsymbol{t}}$ 的公式，该公式用常梯度 $\\nabla N_i$ 和 $\\boldsymbol{t}$ 表示。然后，对给定的三角形和 $\\boldsymbol{\\beta}$ 计算 $h_{\\boldsymbol{t}}$ 的值。\n\n(b) 使用一维常系数分析，该分析可得出沿流线方向的最优流线迎风/Petrov–Galerkin (SUPG) 稳定化参数，推导稳定化参数 $\\tau$ 的表达式，该表达式用 $h_{\\boldsymbol{t}}$、$\\|\\boldsymbol{\\beta}\\|$、$\\epsilon$ 和单元 Péclet 数表示。然后，根据给定数据计算 $\\tau$ 的值。\n\n给出 $h_{\\boldsymbol{t}}$ 和 $\\tau$ 的最终数值。将两者均四舍五入到六位有效数字。将最终答案表示为有序对 $(h_{\\boldsymbol{t}},\\ \\tau)$，不带单位。", "solution": "问题陈述已经过验证，被认为是适定的、有科学依据且自洽的。它是在对流主导问题的有限元分析中一个标准的、尽管不简单的练习。我们开始求解。\n\n该问题分为两部分。我们依次解决每个部分。\n\n(a) 方向单元长度 $h_{\\boldsymbol{t}}$ 的推导与计算。\n\n对于一个线性三角形单元，Lagrange 节点形函数 $N_i(\\boldsymbol{x})$ 是空间坐标 $\\boldsymbol{x}=(x,y)$ 的线性函数。因此，它们的梯度 $\\nabla N_i$ 在整个单元上是常向量。这些梯度由单元的几何形状决定。给定顶点 $\\boldsymbol{x}_1=(0,0)$、$\\boldsymbol{x}_2=(0.04,0)$ 和 $\\boldsymbol{x}_3=(0,0.03)$，三角形的面积为 $A = \\frac{1}{2}(0.04)(0.03) = 0.0006$。梯度计算如下：\n$$\n\\nabla N_i = \\frac{1}{2A} \\begin{pmatrix} y_j - y_k \\\\ x_k - x_j \\end{pmatrix}\n$$\n其中 $(i,j,k)$ 是 $(1,2,3)$ 的一个循环置换。对于给定的顶点：\n$$\n\\nabla N_1 = \\frac{1}{0.0012} \\begin{pmatrix} 0 - 0.03 \\\\ 0 - 0.04 \\end{pmatrix} = \\begin{pmatrix} -25 \\\\ -100/3 \\end{pmatrix}\n$$\n$$\n\\nabla N_2 = \\frac{1}{0.0012} \\begin{pmatrix} 0.03 - 0 \\\\ 0 - 0 \\end{pmatrix} = \\begin{pmatrix} 25 \\\\ 0 \\end{pmatrix}\n$$\n$$\n\\nabla N_3 = \\frac{1}{0.0012} \\begin{pmatrix} 0 - 0 \\\\ 0.04 - 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 100/3 \\end{pmatrix}\n$$\n线性完备性条件 $\\sum_{i=1}^3 \\nabla N_i = \\boldsymbol{0}$ 得到满足。\n\n问题要求从一个长度为 $h$ 的线性二节点单元的一维恒等式 $\\sum_{i=1}^2 |N_i'| = \\frac{2}{h}$ 出发。这个恒等式可以重新整理，将单元长度定义为 $h = 2 / (\\sum_{i=1}^2 |N_i'|)$。\n\n我们将这个概念推广到多维。单一空间坐标上的导数 $N_i'$ 的作用，被 $N_i$ 沿给定流线方向（由单位向量 $\\boldsymbol{t}$ 给出）的方向导数所替代。方向导数为 $\\nabla N_i \\cdot \\boldsymbol{t}$。对单元的所有节点（本例中为 $i=1, 2, 3$）求和。由此得出方向单元长度 $h_{\\boldsymbol{t}}$ 的定义：\n$$\nh_{\\boldsymbol{t}} = \\frac{2}{\\sum_{i=1}^3 |\\nabla N_i \\cdot \\boldsymbol{t}|}\n$$\n流线方向与对流速度 $\\boldsymbol{\\beta}=(10, 0.5)$ 一致。单位向量为 $\\boldsymbol{t} = \\boldsymbol{\\beta} / \\|\\boldsymbol{\\beta}\\|$。首先，我们计算点积 $\\nabla N_i \\cdot \\boldsymbol{\\beta}$：\n$$\n\\nabla N_1 \\cdot \\boldsymbol{\\beta} = (-25)(10) + (-\\frac{100}{3})(0.5) = -250 - \\frac{50}{3} = -\\frac{800}{3}\n$$\n$$\n\\nabla N_2 \\cdot \\boldsymbol{\\beta} = (25)(10) + (0)(0.5) = 250\n$$\n$$\n\\nabla N_3 \\cdot \\boldsymbol{\\beta} = (0)(10) + (\\frac{100}{3})(0.5) = \\frac{50}{3}\n$$\n它们的绝对值之和为：\n$$\n\\sum_{i=1}^3 |\\nabla N_i \\cdot \\boldsymbol{\\beta}| = |-\\frac{800}{3}| + |250| + |\\frac{50}{3}| = \\frac{800}{3} + \\frac{750}{3} + \\frac{50}{3} = \\frac{1600}{3}\n$$\n对流速度的模为 $\\|\\boldsymbol{\\beta}\\| = \\sqrt{10^2 + 0.5^2} = \\sqrt{100.25}$。\n现在我们可以写出方向导数绝对值的和：\n$$\n\\sum_{i=1}^3 |\\nabla N_i \\cdot \\boldsymbol{t}| = \\sum_{i=1}^3 \\left|\\nabla N_i \\cdot \\frac{\\boldsymbol{\\beta}}{\\|\\boldsymbol{\\beta}\\|}\\right| = \\frac{1}{\\|\\boldsymbol{\\beta}\\|} \\sum_{i=1}^3 |\\nabla N_i \\cdot \\boldsymbol{\\beta}| = \\frac{1600/3}{\\sqrt{100.25}}\n$$\n将此代入 $h_{\\boldsymbol{t}}$ 的公式中：\n$$\nh_{\\boldsymbol{t}} = \\frac{2}{\\frac{1600/3}{\\sqrt{100.25}}} = \\frac{6 \\sqrt{100.25}}{1600} = \\frac{3 \\sqrt{100.25}}{800}\n$$\n对该表达式进行数值计算，我们得到：\n$$\nh_{\\boldsymbol{t}} \\approx \\frac{3 \\times 10.0124922}{800} \\approx 0.03754684575\n$$\n四舍五入到六位有效数字，得到 $h_{\\boldsymbol{t}} = 0.0375468$。\n\n(b) SUPG 稳定化参数 $\\tau$ 的推导与计算。\n\n对于长度为 $h$ 的线性单元上的一维常系数对流扩散方程，最优 SUPG 稳定化参数由下式给出：\n$$\n\\tau_{\\text{1D}} = \\frac{h}{2\\beta} \\left( \\coth(Pe_{\\text{1D}}) - \\frac{1}{Pe_{\\text{1D}}} \\right)\n$$\n其中一维 Péclet 数为 $Pe_{\\text{1D}} = \\frac{\\beta h}{2\\epsilon}$。\n\n为推导多维情况的表达式，我们推广此公式，将一维量统一替换为其多维对应量。单元长度 $h$ 被沿流线的方向单元长度 $h_{\\boldsymbol{t}}$ 替代。标量速度 $\\beta$ 被其模 $\\|\\boldsymbol{\\beta}\\|$ 替代。这得到稳定化参数 $\\tau$ 的表达式为：\n$$\n\\tau = \\frac{h_{\\boldsymbol{t}}}{2\\|\\boldsymbol{\\beta}\\|} \\left( \\coth(Pe) - \\frac{1}{Pe} \\right)\n$$\n其中单元 Péclet 数现在定义为：\n$$\nPe = \\frac{\\|\\boldsymbol{\\beta}\\| h_{\\boldsymbol{t}}}{2\\epsilon}\n$$\n这就完成了所要求的推导。现在我们根据给定数据进行计算。首先，我们计算单元 Péclet 数 $Pe$：\n$$\nPe = \\frac{\\|\\boldsymbol{\\beta}\\| h_{\\boldsymbol{t}}}{2\\epsilon} = \\frac{\\sqrt{100.25}}{2 \\times 10^{-4}} \\left( \\frac{3 \\sqrt{100.25}}{800} \\right) = \\frac{3 (100.25)}{1600 \\times 10^{-4}} = \\frac{300.75}{0.16} = 1879.6875\n$$\nPéclet 数的值非常大，表明这是一个强对流主导的区域。对于大自变量 $x$，双曲余切函数 $\\coth(x)$ 会迅速趋近于 $1$。当 $Pe = 1879.6875$ 时，$\\coth(Pe)$ 的值在计算上与 $1$ 无法区分。因此，我们可以使用高 Péclet 数渐近形式。\n将 $h_{\\boldsymbol{t}}$ 和 $Pe$ 的表达式代入 $\\tau$ 的公式中：\n$$\n\\tau = \\frac{1}{2\\|\\boldsymbol{\\beta}\\|} \\left(\\frac{3 \\|\\boldsymbol{\\beta}\\|}{800}\\right) \\left( \\coth(Pe) - \\frac{1}{Pe} \\right) = \\frac{3}{1600} \\left( \\coth(Pe) - \\frac{1}{Pe} \\right)\n$$\n使用 $Pe$ 的值和近似 $\\coth(Pe) \\approx 1$：\n$$\n\\tau \\approx \\frac{3}{1600} \\left( 1 - \\frac{1}{1879.6875} \\right)\n$$\n$$\n\\tau \\approx 0.001875 \\left( 1 - 0.0005320053... \\right) \\approx 0.001875 \\times 0.99946799... \\approx 0.00187400249\n$$\n四舍五入到六位有效数字，得到 $\\tau = 0.00187400$。", "answer": "$$\\boxed{\\begin{pmatrix} 0.0375468 & 0.00187400 \\end{pmatrix}}$$", "id": "2602150"}, {"introduction": "在许多实际问题中，对流场 $\\boldsymbol{\\beta}$ 并非恒定，而是随空间变化。这就带来一个挑战：如何为整个单元定义一个单一的“流线方向”？本编程练习将探索并比较两种定义单元方向向量的实用策略，通过量化分析它们在精度和单元间连续性之间的权衡，加深对SUPG方法在复杂流场中应用的理解。[@problem_id:3448941]", "problem": "考虑单位平方域 $\\Omega = (0,1)^2$ 上的稳态线性平流-扩散-反应偏微分方程，\n$$\n-\\varepsilon \\nabla \\cdot (\\nabla u) + \\boldsymbol{\\beta}(x)\\cdot \\nabla u + \\sigma u = f \\quad \\text{in } \\Omega,\n$$\n在 $\\partial \\Omega$ 上具有齐次 Dirichlet 边界条件。当平流作用远大于扩散作用时，标准的 Galerkin 弱形式可能会失去稳定性。流线迎风 Petrov–Galerkin (SUPG) 方法通过在检验函数中增加一个旨在控制平流相关振荡的流线方向项来修改检验空间。在有限元法 (FEM) 中，需要一个与平流方向对齐的方向向量来构造稳定项。当 $\\boldsymbol{\\beta}(x)$ 在空间上变化时，单元流线方向的稳健计算以及该方向在单元界面上的连续性对于避免过度的数值扩散和混叠效应至关重要。\n\n从稳定化作用必须优先沿着与平流算子相关的特征曲线作用这一原则出发，推导流线方向向量的作用和必要属性，并解释为什么相对于局部平流大小进行归一化是重要的。然后，为每个网格单元 $E$ 设计一个方向向量 $\\boldsymbol{t}_E$ 的单元计算方法，该方法在 $\\boldsymbol{\\beta}(x)$ 空间变化下是稳健的，并能避免在 $\\|\\boldsymbol{\\beta}(x)\\|\\approx 0$ 的滞止点附近的退化。通过提出一种跨单元界面的流线方向连续近似的构造方法来解决连续性问题，该方法能在不破坏与 $\\boldsymbol{\\beta}(x)$ 对齐的情况下减少跳跃。\n\n您的程序必须实现以下内容：\n\n- 使用一个覆盖 $\\Omega$ 的 $N\\times N$ 结构化、轴对齐的正方形单元网格，其中 $N=20$。设每个单元为开方块\n$$\nE_{ij} = \\left(\\frac{i}{N},\\frac{i+1}{N}\\right)\\times\\left(\\frac{j}{N},\\frac{j+1}{N}\\right),\n$$\n对于整数 $i,j \\in \\{0,1,\\dots,N-1\\}$。\n- 对每个单元 $E$，通过以下方式定义单元稳健方向 $\\boldsymbol{t}_E$：\n  1. 使用映射到 $E$ 的每个坐标上的张量积两点高斯求积（每个单元共 4 个求积点）计算 $\\boldsymbol{\\beta}(x)$ 的单元平均值。\n  2. 通过其模长加上一个小的正阈值来对该平均值进行归一化以避免退化：如果 $\\overline{\\boldsymbol{\\beta}}_E$ 是求积平均值，\n  $$\n  \\boldsymbol{t}_E = \\frac{\\overline{\\boldsymbol{\\beta}}_E}{\\|\\overline{\\boldsymbol{\\beta}}_E\\| + \\varepsilon_t},\n  $$\n  其中 $\\varepsilon_t$ 是一个预设的小稳定化阈值，设为 $\\varepsilon_t = 10^{-12}$。\n- 通过首先计算所有网格节点 $\\mathbf{n}$ 处的节点值 $\\boldsymbol{t}_\\mathbf{n}$ 来构造连续近似，\n  $$\n  \\boldsymbol{t}_\\mathbf{n} = \\frac{\\boldsymbol{\\beta}(\\mathbf{n})}{\\|\\boldsymbol{\\beta}(\\mathbf{n})\\| + \\varepsilon_t},\n  $$\n  然后将单元连续近似定义为与 $E$ 的四个角点相关的四个节点值的算术平均值，\n  $$\n  \\boldsymbol{t}_E^{\\text{cont}} = \\frac{1}{4}\\sum_{\\mathbf{n}\\in \\partial E \\cap \\text{nodes}} \\boldsymbol{t}_\\mathbf{n}.\n  $$\n- 通过计算共享两个相邻单元 $E$ 和 $E'$ 的每个内部边的跳跃大小来量化连续性\n  $$\n  J(E,E') = \\left\\|\\boldsymbol{t}_E - \\boldsymbol{t}_{E'}\\right\\|_2,\n  $$\n  对连续近似也进行类似计算\n  $$\n  J^{\\text{cont}}(E,E') = \\left\\|\\boldsymbol{t}_E^{\\text{cont}} - \\boldsymbol{t}_{E'}^{\\text{cont}}\\right\\|_2.\n  $$\n  报告两种构造方法（单元稳健法和连续近似法）在所有内部边上的最大跳跃值和平均跳跃值。\n\n使用以下空间变化的平流场 $\\boldsymbol{\\beta}(x)$ 测试套件：\n\n- 测试用例 1：$\\boldsymbol{\\beta}(x,y) = \\left(y - \\frac{1}{2}, \\frac{1}{2} - x\\right)$。\n- 测试用例 2：$\\boldsymbol{\\beta}(x,y) = \\left(\\sin(2\\pi x)\\cos(2\\pi y), \\cos(2\\pi x)\\sin(2\\pi y)\\right)$。\n- 测试用例 3：$\\boldsymbol{\\beta}(x,y) = \\left(1 + 0.9 x, 0.01\\right)$。\n\n对于每个测试用例，您的程序必须按此顺序生成两个浮点值：$\\boldsymbol{t}_E$ 的最大内部边跳跃值和 $\\boldsymbol{t}_E^{\\text{cont}}$ 的最大内部边跳跃值。最终输出必须将所有三个测试用例的结果汇总到一行中，以逗号分隔列表的形式用方括号括起来，并按测试用例 1、2、3 的顺序排列，总共 6 个浮点数：\n$$\n[\\text{max\\_jump\\_robust\\_1},\\text{max\\_jump\\_cont\\_1},\\text{max\\_jump\\_robust\\_2},\\text{max\\_jump\\_cont\\_2},\\text{max\\_jump\\_robust\\_3},\\text{max\\_jump\\_cont\\_3}].\n$$\n此计算不涉及物理单位；也不需要角度。您的答案必须采用指定的精确输出格式，打印为单行。", "solution": "所提供的问题陈述是有效的。这是一个在数值分析领域中适定且有科学依据的问题，具体涉及用于求解平流占优偏微分方程 (PDE) 的有限元法 (FEM)。所有必要的数据、定义和计算过程都得到了清晰明确的规定。\n\n稳态线性平流-扩散-反应方程，\n$$\n-\\varepsilon \\nabla \\cdot (\\nabla u) + \\boldsymbol{\\beta}(x)\\cdot \\nabla u + \\sigma u = f,\n$$\n当扩散系数 $\\varepsilon$ 相对于平流场 $\\|\\boldsymbol{\\beta}\\|$ 的大小很小时，该方程构成了一个重大的数值挑战。在这种平流占优的情况下，标准的 Galerkin 有限元法产生的解常常被非物理的伪振荡所破坏。这些振荡的产生是因为 Galerkin 方法的检验空间是对称的，缺乏一种机制来尊重由平流算子 $\\boldsymbol{\\beta} \\cdot \\nabla$ 决定的信息流的方向性。\n\n流线迎风 Petrov-Galerkin (SUPG) 方法通过向检验函数中引入一个精心设计的扰动来纠正这一缺陷。检验空间被修改，使得每个检验函数 $v_h$ 都被一个与平流方向对齐的项所增广。SUPG 弱形式的一种常见形式是：寻找 $u_h \\in V_h$（有限元解空间），使得对于所有 $v_h \\in V_h$ 满足：\n$$\n\\int_\\Omega \\left( \\varepsilon \\nabla u_h \\cdot \\nabla v_h + (\\boldsymbol{\\beta} \\cdot \\nabla u_h)v_h + \\sigma u_h v_h \\right) d\\Omega + \\sum_{E \\in \\mathcal{T}_h} \\int_E \\tau_E (\\boldsymbol{\\beta} \\cdot \\nabla v_h) R(u_h) dE = \\int_\\Omega f v_h d\\Omega,\n$$\n其中 $\\mathcal{T}_h$ 是网格，$E$ 是一个网格单元，$R(u_h) = -\\varepsilon \\nabla \\cdot (\\nabla u_h) + \\boldsymbol{\\beta} \\cdot \\nabla u_h + \\sigma u_h - f$ 是 PDE 的单元残差，而 $\\tau_E$ 是一个稳定化参数。\n\n其核心思想是仅在流线方向上添加人工扩散，流线方向即由平流向量 $\\boldsymbol{\\beta}(x)$ 给出的偏微分方程双曲部分的特征曲线方向。正是在这里，流线方向向量的概念变得至关重要。$\\boldsymbol{\\beta} \\cdot \\nabla v_h$ 项有效地将检验函数的梯度投影到平流场上，从而确保稳定化作用沿着流线方向进行。\n\n为了实现稳健且通用的方法，理想的做法是将平流的方向与其大小分离开。平流的大小 $\\|\\boldsymbol{\\beta}\\|$ 已经被包含在稳定化参数 $\\tau_E$ 中，该参数通常是单元 Péclet 数 $\\text{Pe}_E = \\frac{\\|\\boldsymbol{\\beta}\\| h_E}{2\\varepsilon}$ 的函数，其中 $h_E$ 是特征单元长度。如果稳定项直接使用向量 $\\boldsymbol{\\beta}$，其效果将与 $\\|\\boldsymbol{\\beta}\\|^2$ 成比例，一次是由于 $\\boldsymbol{\\beta}$ 的显式存在，另一次是通过 $\\tau_E$ 对 $\\|\\boldsymbol{\\beta}\\|$ 的依赖性。这可能导致在高速流区域出现过度的数值扩散。将平流场归一化以获得单位方向向量 $\\boldsymbol{t} = \\boldsymbol{\\beta} / \\|\\boldsymbol{\\beta}\\|$，可以将方向信息与大小解耦。然后，稳定项可以写成包含 $\\boldsymbol{t} \\cdot \\nabla v_h$ 的形式，从而允许参数 $\\tau_E$ 仅根据局部平流与扩散的平衡来控制稳定化的量。\n\n直接归一化在滞止点（$\\boldsymbol{\\beta}(x) \\approx \\mathbf{0}$）附近是有问题的。此时方向向量是未良定义的，数值实现会面临除以零的问题。一种稳健的方法，如问题中所述，是对此归一化进行正则化：\n$$\n\\boldsymbol{t}(x) = \\frac{\\boldsymbol{\\beta}(x)}{\\|\\boldsymbol{\\beta}(x)\\| + \\varepsilon_t},\n$$\n其中 $\\varepsilon_t$ 是一个小的正阈值。当 $\\|\\boldsymbol{\\beta}(x)\\| \\gg \\varepsilon_t$ 时，这近似于单位向量 $\\boldsymbol{\\beta}(x)/\\|\\boldsymbol{\\beta}(x)\\|$。当 $\\|\\boldsymbol{\\beta}(x)\\| \\to 0$ 时，方向向量平滑地趋近于 $\\mathbf{0}$。这在物理上和数值上都是合理的：在没有平流的地方，不需要流线稳定化。\n\n当 $\\boldsymbol{\\beta}(x)$ 在空间上变化时，每个单元 $E$ 都需要一个单一的代表性方向向量。问题概述了两种用于此分片常数方向向量场的构造方法：\n\n$1$. **单元稳健方向 $\\boldsymbol{t}_E$**：此方法首先通过使用 $2 \\times 2$（4点）高斯求积来近似积分 $\\frac{1}{|E|} \\int_E \\boldsymbol{\\beta}(x) dE$，从而计算单元的平均平流向量 $\\overline{\\boldsymbol{\\beta}}_E$。然后对该平均向量进行稳健归一化：\n$$\n\\boldsymbol{t}_E = \\frac{\\overline{\\boldsymbol{\\beta}}_E}{\\|\\overline{\\boldsymbol{\\beta}}_E\\| + \\varepsilon_t}.\n$$\n这种方法确保了 $\\boldsymbol{t}_E$ 能精确地反映单元 $E$ 内部的平均流线方向。然而，由于平均计算是针对每个单元独立执行的，所得到的向量场 $\\{\\boldsymbol{t}_E\\}$ 在单元间边界上是不连续的。这些跳跃可能会引入数值伪影。\n\n$2$. **连续近似 $\\boldsymbol{t}_E^{\\text{cont}}$**：此方法优先考虑连续性以减轻跳跃的影响。它首先基于节点值建立方向场的连续表示。在网格的每个顶点 $\\mathbf{n}$ 处，计算一个节点方向向量：\n$$\n\\boldsymbol{t}_\\mathbf{n} = \\frac{\\boldsymbol{\\beta}(\\mathbf{n})}{\\|\\boldsymbol{\\beta}(\\mathbf{n})\\| + \\varepsilon_t}.\n$$\n这些节点向量 $\\{ \\boldsymbol{t}_\\mathbf{n} \\}$ 可以被看作是连续场的样本。然后，通过取单元 $E$ 四个角点处向量的算术平均值，从该场中导出单元向量 $\\boldsymbol{t}_E^{\\text{cont}}$：\n$$\n\\boldsymbol{t}_E^{\\text{cont}} = \\frac{1}{4}\\sum_{\\mathbf{n}\\in \\partial E \\cap \\text{nodes}} \\boldsymbol{t}_\\mathbf{n}.\n$$\n这种构造方法对共享节点的值进行平均，这内在地减少了相邻单元向量之间的差异，从而降低了跳跃的大小 $\\|\\boldsymbol{t}_E^{\\text{cont}} - \\boldsymbol{t}_{E'}^{\\text{cont}}\\|$。其代价是 $\\boldsymbol{t}_E^{\\text{cont}}$ 可能不像 $\\boldsymbol{t}_E$ 那样与单元 $E$ 内的真实平均平流方向对齐得那么紧密。\n\n随后的数值实现将通过计算所有内部单元边上的最大跳跃大小来量化两种方法的不连续性。这一比较将直接评估第二种构造方法在生成更连续的流线方向场近似方面的有效性。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and compares streamline direction vectors for SUPG stabilization.\n    \"\"\"\n    N = 20\n    epsilon_t = 1e-12\n\n    def beta_case1(x, y):\n        return np.array([y - 0.5, 0.5 - x])\n\n    def beta_case2(x, y):\n        return np.array([np.sin(2 * np.pi * x) * np.cos(2 * np.pi * y),\n                         np.cos(2 * np.pi * x) * np.sin(2 * np.pi * y)])\n\n    def beta_case3(x, y):\n        return np.array([1 + 0.9 * x, 0.01])\n\n    test_cases = [beta_case1, beta_case2, beta_case3]\n    results = []\n\n    for beta_func in test_cases:\n        # Precompute nodal vectors t_n for the continuous approximation\n        t_nodal = np.zeros((N + 1, N + 1, 2))\n        nodes_x, nodes_y = np.meshgrid(np.linspace(0, 1, N + 1), np.linspace(0, 1, N + 1))\n        \n        for j in range(N + 1):\n            for i in range(N + 1):\n                x, y = nodes_x[j, i], nodes_y[j, i]\n                beta_val = beta_func(x, y)\n                norm_beta = np.linalg.norm(beta_val)\n                t_nodal[j, i, :] = beta_val / (norm_beta + epsilon_t)\n\n        # Initialize storage for elementwise direction vectors\n        t_robust = np.zeros((N, N, 2))\n        t_cont = np.zeros((N, N, 2))\n\n        # Gaussian quadrature points in reference element [-1, 1]^2\n        gp = 1.0 / np.sqrt(3.0)\n        ref_points = [(-gp, -gp), (gp, -gp), (-gp, gp), (gp, gp)]\n        \n        h = 1.0 / N\n\n        # Compute elementwise vectors t_E and t_E^cont\n        for j in range(N):  # y-index\n            for i in range(N):  # x-index\n                # Compute t_E (robust elementwise)\n                beta_sum = np.zeros(2)\n                x_center, y_center = (i + 0.5) * h, (j + 0.5) * h\n                for xi, eta in ref_points:\n                    xq = x_center + xi * h / 2.0\n                    yq = y_center + eta * h / 2.0\n                    beta_sum += beta_func(xq, yq)\n                \n                beta_avg = beta_sum / 4.0\n                norm_beta_avg = np.linalg.norm(beta_avg)\n                t_robust[j, i, :] = beta_avg / (norm_beta_avg + epsilon_t)\n\n                # Compute t_E^cont (continuous approximation)\n                t_n_sum = (t_nodal[j, i] + t_nodal[j, i+1] + \n                           t_nodal[j+1, i] + t_nodal[j+1, i+1])\n                t_cont[j, i, :] = t_n_sum / 4.0\n\n        # Compute jumps across interior edges\n        jumps_robust = []\n        jumps_cont = []\n\n        # Jumps across vertical edges (separating columns i and i+1)\n        for j in range(N):\n            for i in range(N - 1):\n                jump_r = np.linalg.norm(t_robust[j, i] - t_robust[j, i + 1])\n                jumps_robust.append(jump_r)\n                \n                jump_c = np.linalg.norm(t_cont[j, i] - t_cont[j, i + 1])\n                jumps_cont.append(jump_c)\n\n        # Jumps across horizontal edges (separating rows j and j+1)\n        for j in range(N - 1):\n            for i in range(N):\n                jump_r = np.linalg.norm(t_robust[j, i] - t_robust[j + 1, i])\n                jumps_robust.append(jump_r)\n                \n                jump_c = np.linalg.norm(t_cont[j, i] - t_cont[j + 1, i])\n                jumps_cont.append(jump_c)\n\n        max_jump_robust = np.max(jumps_robust) if jumps_robust else 0.0\n        max_jump_cont = np.max(jumps_cont) if jumps_cont else 0.0\n        \n        results.extend([max_jump_robust, max_jump_cont])\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{x:.12f}' for x in results)}]\")\n\nsolve()\n```", "id": "3448941"}]}