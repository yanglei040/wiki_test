{"hands_on_practices": [{"introduction": "为了从根本上理解稳定化方法，我们首先需要动手推导其离散形式。本练习将引导你对一个标准的一维对流扩散问题，从其流线迎风/彼得罗夫-伽辽金（SUPG）弱形式出发，显式地计算出单元矩阵，并最终组装成全局线性系统。通过这个过程，你将清晰地看到稳定化项是如何具体地改变标准伽辽金法的代数结构，为数值实现奠定坚实的基础 [@problem_id:3397671]。", "problem": "考虑在开区间 $\\Omega=(0,L)$ 上的一维稳态对流扩散边界值问题，其齐次狄利克雷边界条件为 $u(0)=0$ 和 $u(L)=0$，\n$$\n-\\epsilon\\,u''(x) + a\\,u'(x) = f(x), \\quad x\\in(0,L),\n$$\n其中 $\\epsilon>0$ 和 $a\\in\\mathbb{R}\\setminus\\{0\\}$ 是常系数，$f(x)$ 是给定的源项。用 $N$ 个长度为 $h=L/N$ 的单元将 $\\Omega$ 离散化为一个均匀网格，并令 $V_h$ 表示从属于此网格、且在 $x=0$ 和 $x=L$ 处为零的连续分片线性（$P_1$）函数空间。考虑流线迎风/彼得罗夫-伽辽金（SUPG）稳定化格式，该格式可解释为基于残差的伽辽金/最小二乘法，其中，测试空间通过逐单元地添加一个与沿对流场的方向导数成正比的流线项来进行修正。具体来说，对于一个任意的、但在单元上为常数的稳定化参数 $\\tau>0$（其可能依赖于 $h$、$a$ 和 $\\epsilon$），使用形式为 $v_h + \\tau\\,a\\,v_h'$ 的测试函数，其中 $v_h\\in V_h$。\n\n从标准弱形式和基于残差的 SUPG 增广出发，在假设试探函数为分片线性（因此单元内二阶导数为零）的情况下，推导通用单元 $K=[x_i,x_{i+1}]$ 上关于局部帽子函数 $\\varphi_1$ 和 $\\varphi_2$ 及其导数的显式 $2\\times 2$ 单元矩阵，然后组装内部节点的全局线性系统。只处理双线性（左侧）贡献，并假设 $a$ 和 $\\epsilon$ 在 $\\Omega$ 上是常数。您的推导必须从弱形式和 SUPG 残差的定义开始，并通过使用 $P_1$ 基函数的性质来计算精确的单元积分。\n\n最后，对于与内部节点方程相关的组装后的三对角系统，将节点 $i$ 处的三个非零系数——次对角系数 $\\ell$（耦合 $u_{i-1}$）、对角系数 $d$（耦合 $u_i$）和超对角系数 $u$（耦合 $u_{i+1}$）——完全用 $\\epsilon$、$a$、$h$ 和 $\\tau$ 表示。将您的最终答案以包含这三个闭式解析表达式的单行矩阵 $\\begin{pmatrix}\\ell  d  u\\end{pmatrix}$ 的形式给出。不需要进行数值计算，也不应进行舍入。", "solution": "所述问题具有科学依据，是适定的、客观的，并包含了唯一可验证解所需的所有必要信息。因此，我们可以着手进行推导。\n\n出发点是在区域 $\\Omega=(0,L)$ 上的一维稳态对流扩散方程的强形式：\n$$\n-\\epsilon\\,u''(x) + a\\,u'(x) = f(x)\n$$\n其齐次狄利克雷边界条件为 $u(0)=0$ 和 $u(L)=0$。系数 $\\epsilon>0$ 和 $a\\in\\mathbb{R}\\setminus\\{0\\}$ 是常数。\n\n标准伽辽金弱形式旨在从有限维试探空间 $V_h$ 中寻找一个解 $u_h$，使得对于所有测试函数 $v_h \\in V_h$：\n$$\n\\int_0^L (-\\epsilon\\,u_h'' + a\\,u_h') v_h \\,dx = \\int_0^L f v_h \\,dx\n$$\n对二阶项进行分部积分并应用边界条件 $v_h(0)=v_h(L)=0$，得到双线性形式 $B(u_h, v_h)$：\n$$\nB(u_h, v_h) = \\int_0^L \\left(\\epsilon\\,u_h' v_h' + a\\,u_h' v_h\\right) dx\n$$\n\n流线迎风/彼得罗夫-伽辽金（SUPG）方法将测试函数修正为 $w_h = v_h + \\delta_h$，其中 $\\delta_h$ 是为增强稳定性而选择的一个扰动项。根据题目要求，测试函数的形式为 $v_h + \\tau a v_h'$，其中 $\\tau>0$ 是每个单元上的常数稳定化参数。SUPG 弱形式是寻找 $u_h \\in V_h$，使得对于所有 $v_h \\in V_h$：\n$$\n\\int_0^L (-\\epsilon u_h'' + a u_h' - f) (v_h + \\tau a v_h') \\,dx = 0\n$$\n这是一种基于残差的方法，我们要求残差 $R(u_h) = -\\epsilon u_h'' + a u_h' - f$ 与修正后的测试空间正交。关注双线性形式（左侧），我们有：\n$$\nB_{SUPG}(u_h, v_h) = \\int_0^L (-\\epsilon u_h'' + a u_h') (v_h + \\tau a v_h') \\,dx\n$$\n展开此表达式可得：\n$$\nB_{SUPG}(u_h, v_h) = \\int_0^L (-\\epsilon u_h'' + a u_h') v_h \\,dx + \\int_0^L (-\\epsilon u_h'' + a u_h') (\\tau a v_h') \\,dx\n$$\n第一项经过分部积分后，是标准的伽辽金双线性形式 $B(u_h, v_h)$。第二项是稳定化项。问题指定对 $V_h$ 使用连续分片线性（$P_1$）基函数。对于此类函数，其二阶导数 $u_h''$ 在每个单元 $K$ 内部为零。应用此简化，稳定化项变为：\n$$\n\\int_0^L (a u_h') (\\tau a v_h') \\,dx = \\sum_{K} \\int_K \\tau a^2 u_h' v_h' \\,dx\n$$\n结合伽辽金部分和稳定化部分，完整的 SUPG 双线性形式为：\n$$\nB_{SUPG}(u_h, v_h) = \\int_0^L \\left(\\epsilon u_h' v_h' + a u_h' v_h\\right) dx + \\sum_{K} \\int_K \\tau a^2 u_h' v_h' \\,dx\n$$\n由于积分可以逐单元计算，我们可以将来自长度为 $h = x_{i+1} - x_i$ 的单个通用单元 $K=[x_i, x_{i+1}]$ 的贡献写为：\n$$\nB_{SUPG}^K(u_h, v_h) = \\int_K \\left[(\\epsilon + \\tau a^2) u_h' v_h' + a u_h' v_h\\right] dx\n$$\n为了推导单元矩阵，我们通过映射 $\\xi = (x - x_i)/h$ 在参考单元 $[0,1]$ 上使用局部线性基函数（“帽子函数”）。局部基函数为：\n$$\n\\varphi_1(\\xi) = 1 - \\xi \\quad \\text{和} \\quad \\varphi_2(\\xi) = \\xi\n$$\n它们关于 $x$ 的导数为：\n$$\n\\frac{d\\varphi_1}{dx} = \\frac{d\\varphi_1}{d\\xi}\\frac{d\\xi}{dx} = (-1)\\frac{1}{h} = -\\frac{1}{h}\n$$\n$$\n\\frac{d\\varphi_2}{dx} = \\frac{d\\varphi_2}{d\\xi}\\frac{d\\xi}{dx} = (1)\\frac{1}{h} = \\frac{1}{h}\n$$\n$2\\times 2$ 单元矩阵 $A^K$ 的元素为 $A^K_{jk} = B_{SUPG}^K(\\varphi_k, \\varphi_j)$，其中 $j$ 索引测试函数，$k$ 索引试探函数。使用变量替换 $dx = h\\,d\\xi$：\n$$\nA^K_{jk} = \\int_{x_i}^{x_{i+1}} \\left[(\\epsilon + \\tau a^2) \\varphi_k' \\varphi_j' + a \\varphi_k' \\varphi_j\\right] dx = \\frac{\\epsilon + \\tau a^2}{h} \\int_0^1 \\frac{d\\varphi_k}{d\\xi}\\frac{d\\varphi_j}{d\\xi} d\\xi + a \\int_0^1 \\frac{d\\varphi_k}{d\\xi} \\varphi_j d\\xi\n$$\n我们计算两个积分矩阵。首先是“刚度”部分：$S_{jk} = \\int_0^1 \\frac{d\\varphi_j}{d\\xi}\\frac{d\\varphi_k}{d\\xi} d\\xi$。\n$$\nS = \\begin{pmatrix} \\int_0^1(-1)(-1)d\\xi  \\int_0^1(-1)(1)d\\xi \\\\ \\int_0^1(1)(-1)d\\xi  \\int_0^1(1)(1)d\\xi \\end{pmatrix} = \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}\n$$\n其次是“对流”部分：$C_{jk} = \\int_0^1 \\varphi_j \\frac{d\\varphi_k}{d\\xi} d\\xi$。\n$$\nC_{11} = \\int_0^1 (1-\\xi)(-1)d\\xi = -\\frac{1}{2}, \\quad C_{12} = \\int_0^1 (1-\\xi)(1)d\\xi = \\frac{1}{2}\n$$\n$$\nC_{21} = \\int_0^1 (\\xi)(-1)d\\xi = -\\frac{1}{2}, \\quad C_{22} = \\int_0^1 (\\xi)(1)d\\xi = \\frac{1}{2}\n$$\n因此，矩阵 $C$ 是 $C = \\begin{pmatrix} -1/2  1/2 \\\\ -1/2  1/2 \\end{pmatrix}$。\n因此，单元矩阵 $A^K$ 为：\n$$\nA^K = \\frac{\\epsilon + \\tau a^2}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} + a \\begin{pmatrix} -1/2  1/2 \\\\ -1/2  1/2 \\end{pmatrix} = \\begin{pmatrix} \\frac{\\epsilon + \\tau a^2}{h} - \\frac{a}{2}  -\\frac{\\epsilon + \\tau a^2}{h} + \\frac{a}{2} \\\\ -\\frac{\\epsilon + \\tau a^2}{h} - \\frac{a}{2}  \\frac{\\epsilon + \\tau a^2}{h} + \\frac{a}{2} \\end{pmatrix}\n$$\n我们为内部节点 $i$ 组装全局系统。未知数 $u_i$ 的方程是通过将测试函数设置为全局基函数 $\\phi_i$ 来形成的。节点 $i$ 通过单元 $K_{i-1}=[x_{i-1}, x_i]$ 和 $K_i=[x_i, x_{i+1}]$ 与节点 $i-1$ 和 $i+1$ 相连。\n$u_{i-1}$ 的系数（次对角线，$\\ell$）是试探函数 $\\phi_{i-1}$ 和测试函数 $\\phi_i$ 之间的耦合。这发生在单元 $K_{i-1}$ 上，其中 $\\phi_{i-1}$ 是第一个局部基函数（$\\varphi_1$），$\\phi_i$ 是第二个（$\\varphi_2$）。该系数为 $A^K_{21}$。\n$$\n\\ell = A^K_{21} = -\\frac{\\epsilon + \\tau a^2}{h} - \\frac{a}{2}\n$$\n$u_{i+1}$ 的系数（超对角线，$u$）是试探函数 $\\phi_{i+1}$ 和测试函数 $\\phi_i$ 之间的耦合。这发生在单元 $K_i$ 上，其中 $\\phi_i$ 是第一个局部基函数（$\\varphi_1$），$\\phi_{i+1}$ 是第二个（$\\varphi_2$）。该系数为 $A^K_{12}$。\n$$\nu = A^K_{12} = -\\frac{\\epsilon + \\tau a^2}{h} + \\frac{a}{2}\n$$\n$u_i$ 的系数（对角线，$d$）是 $\\phi_i$ 与自身的耦合。它从 $K_{i-1}$ 获得一个贡献，其中 $\\phi_i$ 是第二个局部基函数（$\\varphi_2$），贡献为 $A^K_{22}$。它还从 $K_i$ 获得一个贡献，其中 $\\phi_i$ 是第一个局部基函数（$\\varphi_1$），贡献为 $A^K_{11}$。总系数是二者之和。\n$$\nd = A^K_{11} + A^K_{22} = \\left(\\frac{\\epsilon + \\tau a^2}{h} - \\frac{a}{2}\\right) + \\left(\\frac{\\epsilon + \\tau a^2}{h} + \\frac{a}{2}\\right) = \\frac{2(\\epsilon + \\tau a^2)}{h}\n$$\n因此，内部节点 $i$ 处方程的三个非零系数被完全确定。", "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{\\epsilon + \\tau a^2}{h} - \\frac{a}{2}  \\frac{2(\\epsilon + \\tau a^2)}{h}  -\\frac{\\epsilon + \\tau a^2}{h} + \\frac{a}{2} \\end{pmatrix}}\n$$", "id": "3397671"}, {"introduction": "理论推导揭示了稳定化方法的数学构造，但其威力只有在实践中才能真正显现。本练习要求你通过编程，对一个经典的对流占优问题分别使用标准伽辽金法和SUPG方法进行求解，并量化两种方法产生的数值振荡幅度。这个对比将直观地展示为何稳定化是不可或缺的，以及SUPG是如何有效抑制伪振荡、还原物理上合理的解 [@problem_id:3397663]。", "problem": "考虑单位区间上的稳态一维平流-扩散边界值问题，其形式如下：求解满足以下条件的标量场 $u(x)$\n$$\n-\\varepsilon \\, u''(x) + a \\, u'(x) = 0 \\quad \\text{for } x \\in (0,1),\n$$\n其 Dirichlet 边界条件为\n$$\nu(0) = 1, \\quad u(1) = 0,\n$$\n其中 $\\varepsilon > 0$ 是扩散系数，$a \\neq 0$ 是恒定的平流速度。您将使用具有 $N$ 个单元的均匀网格上的连续分片线性有限元来离散化此问题，并采用两种格式：\n- 标准的 Bubnov-Galerkin 方法（记为“Galerkin”），\n- 流线迎风 Petrov-Galerkin (SUPG) 稳定化方法，这是 Galerkin/最小二乘法族的一员，其单元稳定化参数为常数 $\\tau = \\frac{h}{2 |a|}$，其中 $h = \\frac{1}{N}$ 是均匀的单元尺寸。\n\n从强形式出发，使用标准的变分框架来推导每种离散格式。然后，通过从单元贡献组装全局矩阵来显式地实现这两种离散算子。对于均匀网格上的线性形函数和常系数，您可以依赖于从双线性形式定义中推导出的标准局部贡献，但必须精确保留变分形式中产生的非对称平流算子。\n\n将离散解 $u_h$ 的“类 Gibbs 振荡幅度”定义为超过上边界值的过冲量与低于下边界值的下冲量之和：\n$$\n\\mathcal{A}(u_h) \\;=\\; \\max\\!\\big(0, \\max_{x \\in [0,1]} u_h(x) - 1 \\big) \\;+\\; \\max\\!\\big(0, 0 - \\min_{x \\in [0,1]} u_h(x) \\big).\n$$\n在均匀网格上，于节点值处计算 $\\mathcal{A}(u_h)$。\n\n您的任务是实现一个完整的程序，该程序能够：\n- 为 Galerkin 和 SUPG 两种格式组装并求解线性系统，\n- 计算两种格式的 $\\mathcal{A}(u_h)$，\n- 报告 SUPG 相对于 Galerkin 在振荡方面实现的量化减少。\n\n使用以下参数集 $(N, \\varepsilon, a)$ 的测试套件：\n- 案例 #1: $(N, \\varepsilon, a) = (40, 10^{-2}, 1)$，\n- 案例 #2: $(N, \\varepsilon, a) = (80, 10^{-4}, 1)$，\n- 案例 #3: $(N, \\varepsilon, a) = (40, 10^{-6}, 1)$。\n\n对于每个案例，计算三个浮点数：\n- $A_G = \\mathcal{A}(u_h^{\\text{Galerkin}})$,\n- $A_S = \\mathcal{A}(u_h^{\\text{SUPG}})$,\n- $\\Delta = A_G - A_S$。\n\n最终的程序输出必须是单行格式\n$$\n\\big[ A_G^{(1)}, A_S^{(1)}, \\Delta^{(1)}, A_G^{(2)}, A_S^{(2)}, \\Delta^{(2)}, A_G^{(3)}, A_S^{(3)}, \\Delta^{(3)} \\big],\n$$\n即一个 Python 风格的列表，按顺序列出三个案例的九个结果，条目之间用逗号分隔，无任何附加文本。所有计算都是无量纲的；不需要物理单位。不使用角度。不使用百分比：所有结果均为实数。请确保您的实现对于指定的 $(N, \\varepsilon, a)$ 具有通用性，并且矩阵组装和边界条件施加在数学上与所述的离散化方法一致。", "solution": "该问题被验证为具有科学依据、适定且客观。它是偏微分方程数值分析中的一个标准基准问题，包含唯一解所需的所有数据和定义。所选参数旨在突显 Bubnov-Galerkin 方法在平流主导区域的已知缺陷，以及 SUPG 稳定化技术的有效性。\n\n问题是在域 $x \\in (0,1)$ 上求解稳态一维平流-扩散方程：\n$$\n-\\varepsilon u''(x) + a u'(x) = 0\n$$\n其 Dirichlet 边界条件为 $u(0) = 1$ 和 $u(1) = 0$。这里，$\\varepsilon > 0$ 是扩散系数，$a \\neq 0$ 是恒定的平流速度。\n\n为了推导有限元格式，我们首先建立问题的弱（变分）形式。我们将控制方程乘以一个来自合适函数空间 $W$ 的检验函数 $v(x)$，并在域 $\\Omega = (0,1)$ 上积分：\n$$\n\\int_0^1 (-\\varepsilon u'' + a u') v \\, dx = 0\n$$\n对二阶扩散项应用分部积分，$-\\int_0^1 \\varepsilon u'' v \\, dx = \\int_0^1 \\varepsilon u' v' \\, dx - [\\varepsilon u' v]_0^1$，得到：\n$$\n\\int_0^1 (\\varepsilon u' v' + a u' v) \\, dx - [\\varepsilon u' v]_0^1 = 0\n$$\n为了处理 $u$ 的本质边界条件，我们在一个试验空间 $V$ 中寻找解 $u$，该空间中的成员满足这些条件。检验函数 $v$ 选自空间 $W_0$，其中函数在指定 Dirichlet 条件的边界上为零，即 $v(0) = v(1) = 0$。这个选择消除了边界项 $[\\varepsilon u' v]_0^1$。于是弱形式为：寻找 $u \\in V$ 使得 $u(0)=1, u(1)=0$，且对于所有 $v \\in W_0$ 都满足：\n$$\nB(u, v) = \\int_0^1 (\\varepsilon u' v' + a u' v) \\, dx = 0\n$$\n项 $B(u, v)$ 是一个双线性形式。该问题使用有限元方法在一个包含 $N$ 个单元的均匀网格上进行离散化，单元尺寸为 $h=1/N$。节点位于 $x_i = i h$，其中 $i=0, 1, \\dots, N$。解 $u(x)$ 由一个连续的分片线性函数 $u_h(x) = \\sum_{j=0}^N U_j \\phi_j(x)$ 来近似，其中 $U_j$ 是解的节点值，$\\phi_j(x)$ 是标准的线性“帽”基函数。\n\nBubnov-Galerkin 格式对试验函数和检验函数使用相同的空间，因此 $v_h(x)$ 也是基函数 $\\phi_j(x)$ 的线性组合。离散系统由单元级别的贡献组装而成。在一个长度为 $h$ 的通用单元 $\\Omega_e = [x_e, x_{e+1}]$ 上，局部基函数为 $N_1(x) = (x_{e+1}-x)/h$ 和 $N_2(x) = (x-x_e)/h$，其导数为 $N_1'(x) = -1/h$ 和 $N_2'(x) = 1/h$。$2 \\times 2$ 的单元刚度矩阵 $\\mathbf{k}^e_G$ 的项为 $k^e_{ij} = B(\\phi_j, \\phi_i)|_{\\Omega_e}$，使用局部坐标表示为 $k^e_{\\alpha\\beta} = \\int_{\\Omega_e} (\\varepsilon N_\\beta' N_\\alpha' + a N_\\beta' N_\\alpha) \\, dx$，其中 $\\alpha, \\beta \\in \\{1,2\\}$。\n扩散部分为 $\\mathbf{k}^e_{diff} = \\frac{\\varepsilon}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$。\n平流部分为 $\\mathbf{k}^e_{adv} = \\frac{a}{2} \\begin{pmatrix} -1  1 \\\\ -1  1 \\end{pmatrix}$。\nGalerkin 单元矩阵是其和：\n$$\n\\mathbf{k}^e_G = \\frac{\\varepsilon}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} + \\frac{a}{2} \\begin{pmatrix} -1  1 \\\\ -1  1 \\end{pmatrix} = \\begin{pmatrix} \\frac{\\varepsilon}{h} - \\frac{a}{2}  -\\frac{\\varepsilon}{h} + \\frac{a}{2} \\\\ -\\frac{\\varepsilon}{h} - \\frac{a}{2}  \\frac{\\varepsilon}{h} + \\frac{a}{2} \\end{pmatrix}\n$$\n该矩阵在组装后，对平流项会产生中心差分近似，当平流主导扩散时（即当单元 Peclet 数 $Pe_h = |a|h/(2\\varepsilon) > 1$ 时），容易产生伪振荡。\n\n流线迎风 Petrov-Galerkin (SUPG) 方法在弱形式中引入一个稳定项来处理这些振荡。修改后的弱形式为：\n$$\nB(u_h, v_h) + \\sum_{e=0}^{N-1} \\int_{\\Omega_e} \\mathcal{R}(u_h) \\, \\mathcal{P}(v_h) \\, dx = 0\n$$\n其中 $\\mathcal{R}(u_h) = -\\varepsilon u_h'' + a u_h'$ 是强形式的残差，$\\mathcal{P}(v_h)$ 是对检验函数的扰动。对于 SUPG 稳定化，扰动与流线方向对齐，即 $\\mathcal{P}(v_h) = \\tau a v_h'$。由于 $u_h$ 是分片线性的，其二阶导数 $u_h''$ 在每个单元内部为零。稳定项简化为：\n$$\nB_{stab}(u_h, v_h) = \\sum_{e=0}^{N-1} \\int_{\\Omega_e} (a u_h') (\\tau a v_h') \\, dx\n$$\n稳定化参数给定为 $\\tau = \\frac{h}{2|a|}$。单元稳定化矩阵 $\\mathbf{k}^e_{stab}$ 的项为 $k^e_{stab, \\alpha\\beta} = \\int_{\\Omega_e} \\tau (a N_\\beta') (a N_\\alpha') dx = \\tau a^2 \\int_{\\Omega_e} N_\\alpha' N_\\beta' dx$。这与扩散矩阵成正比：\n$$\n\\mathbf{k}^e_{stab} = \\tau a^2 \\left( \\frac{1}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} \\right) = \\frac{h}{2|a|} a^2 \\frac{1}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} = \\frac{|a|}{2} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}\n$$\n总的 SUPG 单元矩阵为 $\\mathbf{k}^e_S = \\mathbf{k}^e_G + \\mathbf{k}^e_{stab}$。对于 $a > 0$（即 $|a|=a$）的情况，这变为：\n$$\n\\mathbf{k}^e_S = \\left( \\frac{\\varepsilon}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} + \\frac{a}{2} \\begin{pmatrix} -1  1 \\\\ -1  1 \\end{pmatrix} \\right) + \\frac{a}{2} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} = \\frac{\\varepsilon}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} + a \\begin{pmatrix} 0  0 \\\\ -1  1 \\end{pmatrix}\n$$\n这些单元矩阵的组装产生了一个针对未知内部节点值 $\\mathbf{U} = [U_1, \\dots, U_{N-1}]^T$ 的大小为 $(N-1) \\times (N-1)$ 的全局线性方程组 $\\mathbf{K} \\mathbf{U} = \\mathbf{F}$。边界条件 $U_0=1$ 和 $U_N=0$ 通过修改完整系统的第一个和最后一个方程来施加，将已知量移到右侧向量 $\\mathbf{F}$。对于内部节点 $i$，线性系统的组装行由单元矩阵的系数确定。对于 Galerkin，方程为 $(-\\frac{\\varepsilon}{h} - \\frac{a}{2})U_{i-1} + (\\frac{2\\varepsilon}{h})U_i + (-\\frac{\\varepsilon}{h} + \\frac{a}{2})U_{i+1} = 0$。对于 SUPG ($a>0$)，它变为 $(-\\frac{\\varepsilon}{h}-a)U_{i-1} + (\\frac{2\\varepsilon}{h}+a)U_i + (-\\frac{\\varepsilon}{h})U_{i+1} = 0$。右侧向量 $\\mathbf{F}$ 仅在其第一个条目中非零，这是由 $x=0$ 处的边界条件引起的。对于节点 $i=1$，涉及 $U_0=1$ 的项被移到右侧。节点1方程中 $U_0$ 的系数是 $K_{1,0}$，它来自于单元0的贡献，对应于使用检验函数 $\\phi_1$ 和试验函数 $\\phi_0$。该项是 $k^e_{21}$。因此，$F_1 = -K_{1,0} U_0 = -k^e_{21} \\cdot 1$。对于 Galerkin，$F_1 = \\frac{\\varepsilon}{h} + \\frac{a}{2}$。对于 SUPG，$F_1=\\frac{\\varepsilon}{h}+a$。\n\n类 Gibbs 振荡幅度 $\\mathcal{A}(u_h)$ 是根据节点解向量 $\\mathbf{U}_{full} = [1, U_1, \\dots, U_{N-1}, 0]^T$ 使用以下公式计算的：\n$$\n\\mathcal{A}(u_h) = \\max(0, \\max(\\mathbf{U}_{full}) - 1) + \\max(0, 0 - \\min(\\mathbf{U}_{full}))\n$$\n该算法的流程是：对每个测试案例，首先为 Galerkin 方法，然后为 SUPG 方法，实施此组装和求解过程，以计算各自的振荡幅度 $A_G$ 和 $A_S$，以及它们的差值 $\\Delta = A_G - A_S$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_fem_1d(N, epsilon, a, method='Galerkin'):\n    \"\"\"\n    Solves the 1D advection-diffusion problem using linear finite elements.\n\n    Args:\n        N (int): Number of elements.\n        epsilon (float): Diffusion coefficient.\n        a (float): Advection speed.\n        method (str): 'Galerkin' or 'SUPG'.\n\n    Returns:\n        numpy.ndarray: The full nodal solution vector U of size (N+1).\n    \"\"\"\n    h = 1.0 / N\n    num_unknowns = N - 1\n\n    if num_unknowns == 0:\n        # Handle trivial case N=1\n        return np.array([1.0, 0.0])\n\n    # Initialize the (N-1)x(N-1) system matrix K and RHS vector F\n    K_red = np.zeros((num_unknowns, num_unknowns))\n    F_red = np.zeros(num_unknowns)\n\n    # Define element matrices based on the chosen method\n    k_diff = (epsilon / h) * np.array([[1.0, -1.0], [-1.0, 1.0]])\n\n    if method == 'Galerkin':\n        k_adv = (a / 2.0) * np.array([[-1.0, 1.0], [-1.0, 1.0]])\n        k_elem = k_diff + k_adv\n    elif method == 'SUPG':\n        # SUPG with tau = h / (2 * |a|) for a > 0\n        # simplifies to a pure upwind scheme for the advection term\n        if a == 0:\n            k_adv_supg = np.zeros((2, 2))\n        else:\n            # Stabilization matrix contribution\n            k_stab = (abs(a) / 2.0) * np.array([[1.0, -1.0], [-1.0, 1.0]])\n            # Galerkin advection matrix\n            k_adv = (a / 2.0) * np.array([[-1.0, 1.0], [-1.0, 1.0]])\n            k_adv_supg = k_adv + k_stab\n        k_elem = k_diff + k_adv_supg\n    else:\n        raise ValueError(\"Method must be 'Galerkin' or 'SUPG'\")\n\n    # Assemble the reduced tridiagonal system for interior nodes\n    lower_diag = k_elem[1, 0]\n    main_diag = k_elem[0, 0] + k_elem[1, 1]\n    upper_diag = k_elem[0, 1]\n\n    np.fill_diagonal(K_red, main_diag)\n    if num_unknowns > 1:\n        # Use np.diag_indices_from and slicing for robust diagonal filling\n        rows, cols = np.diag_indices_from(K_red)\n        K_red[rows[1:], cols[:-1]] = lower_diag\n        K_red[rows[:-1], cols[1:]] = upper_diag\n\n    # Apply boundary conditions\n    # u(0) = 1 (affects the first equation for U_1)\n    # The term k_elem[1,0] * U_0 is moved to the RHS\n    F_red[0] = -k_elem[1, 0] * 1.0\n    \n    # u(N) = 0 (affects the last equation for U_{N-1})\n    # The term k_elem[0,1] * U_N is moved to the RHS. Since U_N=0, this is 0.\n    # No modification needed for F_red[num_unknowns-1] as it is already 0.\n\n    # Solve the linear system for interior nodes\n    U_internal = np.linalg.solve(K_red, F_red)\n\n    # Construct the full solution vector including boundary nodes\n    U_full = np.zeros(N + 1)\n    U_full[0] = 1.0\n    U_full[N] = 0.0\n    U_full[1:N] = U_internal\n\n    return U_full\n\ndef compute_oscillation_amplitude(u_h):\n    \"\"\"\n    Computes the Gibbs-like oscillation amplitude for a nodal solution.\n    \"\"\"\n    overshoot = np.max([0.0, np.max(u_h) - 1.0])\n    undershoot = np.max([0.0, 0.0 - np.min(u_h)])\n    return overshoot + undershoot\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (40, 1e-2, 1.0),\n        (80, 1e-4, 1.0),\n        (40, 1e-6, 1.0),\n    ]\n\n    results = []\n    for N, epsilon, a in test_cases:\n        # Solve using Bubnov-Galerkin method\n        U_G = solve_fem_1d(N, epsilon, a, method='Galerkin')\n        A_G = compute_oscillation_amplitude(U_G)\n\n        # Solve using SUPG method\n        U_S = solve_fem_1d(N, epsilon, a, method='SUPG')\n        A_S = compute_oscillation_amplitude(U_S)\n\n        # Compute reduction in oscillation\n        Delta = A_G - A_S\n        \n        results.extend([A_G, A_S, Delta])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15f}' for r in results)}]\")\n\nsolve()\n```", "id": "3397663"}, {"introduction": "我们已经看到SUPG方法通过引入一个稳定化参数 $\\tau$ 来改善解的质量，那么这个参数 $\\tau$ 该如何选取呢？本练习将带你深入理论层面，通过分析纯对流方程半离散系统的性质，推导出一个保证数值解无振荡的条件。完成这个练习后，你将理解稳定化参数 $\\tau$ 的取值并非随意，而是基于深刻的数学原理，以确保数值格式的稳定性和保正性 [@problem_id:3397658]。", "problem": "考虑一维线性对流方程 $u_{t} + a\\,u_{x} = 0$，该方程定义在周期域 $\\Omega = (0,L)$ 上，其中 $a \\in \\mathbb{R}\\setminus\\{0\\}$ 是一个常数对流速度。令 $\\{\\varphi_{i}\\}_{i=1}^{N}$ 为与包含 $N$ 个区间的均匀网格相关的标准连续分片线性帽状基函数，网格尺寸为 $h = L/N$。使用伽辽金/最小二乘 (GLS) 稳定化方法，考虑半离散弱形式：求解 $u_{h}(t) \\in \\mathrm{span}\\{\\varphi_{i}\\}$，使得对于所有 $v_{h} \\in \\mathrm{span}\\{\\varphi_{i}\\}$，\n$$(\\dot{u}_{h}, v_{h})_{\\Omega} + a\\,(u_{h,x}, v_{h})_{\\Omega} + \\tau\\,a^{2}\\,(u_{h,x}, v_{h,x})_{\\Omega} = 0,$$\n其中 $\\tau > 0$ 是一个常数稳定化参数，$(\\cdot,\\cdot)_{\\Omega}$ 表示 $L^{2}(\\Omega)$ 内积。采用质量集中法，使得质量矩阵为对角矩阵，其节点质量为 $m_{i} = \\int_{\\Omega}\\varphi_{i}\\,dx = h$。\n\n在均匀网格上，节点值 $\\{u_{i}(t)\\}$ 的代数系统可以写为\n$$h\\,\\dot{u}_{i} + \\sum_{j}A_{ij}\\,u_{j} = 0,$$\n其中空间算子为 $A = a\\,B + a^{2}\\tau\\,K$，其中 $B_{ij} = \\int_{\\Omega}\\varphi_{j,x}\\,\\varphi_{i}\\,dx$ 是伽辽金对流矩阵，$K_{ij} = \\int_{\\Omega}\\varphi_{j,x}\\,\\varphi_{i,x}\\,dx$ 是刚度矩阵。对于均匀网格和所选基函数，非零模板项为\n$$B_{i,i+1} = \\frac{1}{2},\\quad B_{i,i-1} = -\\frac{1}{2},\\quad B_{i,i} = 0,$$\n$$K_{i,i} = \\frac{2}{h},\\quad K_{i,i+1} = -\\frac{1}{h},\\quad K_{i,i-1} = -\\frac{1}{h}.$$\n\n分析由模态关系 $u_{i}(t) = \\hat{u}(t)\\,\\exp(\\mathrm{i}\\,i\\,\\theta)$，$\\theta \\in [-\\pi,\\pi]$（其中 $\\dot{\\hat{u}}(t) = g(\\theta)\\,\\hat{u}(t)$）定义的半离散傅里叶放大因子 $g(\\theta)$，并确定稳定化参数 $\\tau$ 的一个条件，以保证在以下意义上的非振荡行为：生成元矩阵 $-M^{-1}A$（其中 $M = h\\,I$ 是集中质量矩阵）是 Metzler 矩阵，即其非对角线元素为非负，从而确保半离散动力学保持正性并且不产生新的极值。将您的最终答案表示为满足此条件的最小 $\\tau$（作为 $a$ 和 $h$ 的函数）。最终答案必须是单一的封闭形式表达式。", "solution": "该问题已经过验证，被认为是合理的。所涉及的概念是偏微分方程数值分析中的标准内容。所有提供的数据和定义都是一致的，足以推导出解决方案。\n\n节点值 $\\{u_{i}(t)\\}$ 的半离散常微分方程组由下式给出\n$$h\\,\\dot{u}_{i} + \\sum_{j}A_{ij}\\,u_{j} = 0$$\n对于每个节点 $i$。使用质量集中法，质量矩阵 $M$ 是一个对角矩阵，其元素为 $M_{ii} = h$。以矩阵形式，该系统为 $M\\dot{\\mathbf{u}} + A\\mathbf{u} = \\mathbf{0}$，其中 $\\mathbf{u}$ 是节点值的向量。这可以重写为\n$$\\dot{\\mathbf{u}} = -M^{-1}A\\mathbf{u}.$$\n半离散动力学的生成元矩阵为 $G = -M^{-1}A$。对于集中质量矩阵 $M = h\\,I$（其中 $I$ 是单位矩阵），生成元矩阵简化为\n$$G = -\\frac{1}{h}A.$$\n问题将非振荡行为定义为生成元矩阵 $G$ 是一个 Metzler 矩阵的性质。如果一个矩阵的所有非对角线元素都是非负的，则该矩阵是 Metzler 矩阵。因此，我们需要\n$$G_{ij} \\ge 0 \\quad \\text{for all } i \\ne j.$$\n将 $G$ 关于 $A$ 的表达式代入，此条件变为\n$$-\\frac{1}{h}A_{ij} \\ge 0 \\quad \\text{for all } i \\ne j.$$\n由于网格尺寸 $h$ 是正的，这等价于要求空间算子矩阵 $A$ 的非对角线元素为非正：\n$$A_{ij} \\le 0 \\quad \\text{for all } i \\ne j.$$\n矩阵 $A$ 由和式 $A = a\\,B + a^{2}\\tau\\,K$ 给出。对于均匀网格上的给定分片线性基函数，唯一的非零非对角线元素出现在 $j = i-1$ 和 $j = i+1$ 处。我们必须分析这两种情况。\n\n情况 1：$j=i+1$\n元素 $A_{i,i+1}$ 由下式给出\n$$A_{i,i+1} = a\\,B_{i,i+1} + a^{2}\\tau\\,K_{i,i+1}.$$\n代入所提供的模板值 $B_{i,i+1} = \\frac{1}{2}$ 和 $K_{i,i+1} = -\\frac{1}{h}$：\n$$A_{i,i+1} = a\\left(\\frac{1}{2}\\right) + a^{2}\\tau\\left(-\\frac{1}{h}\\right) = \\frac{a}{2} - \\frac{a^{2}\\tau}{h}.$$\nMetzler 条件要求 $A_{i,i+1} \\le 0$：\n$$\\frac{a}{2} - \\frac{a^{2}\\tau}{h} \\le 0 \\implies \\frac{a}{2} \\le \\frac{a^{2}\\tau}{h}.$$\n由于 $a \\in \\mathbb{R}\\setminus\\{0\\}$，$a^2$ 是严格正的。我们可以将不等式两边乘以 $\\frac{h}{a^2} > 0$ 而不改变其方向：\n$$\\frac{h}{a^2}\\frac{a}{2} \\le \\tau \\implies \\frac{h}{2a} \\le \\tau.$$\n\n情况 2：$j=i-1$\n元素 $A_{i,i-1}$ 由下式给出\n$$A_{i,i-1} = a\\,B_{i,i-1} + a^{2}\\tau\\,K_{i,i-1}.$$\n代入所提供的模板值 $B_{i,i-1} = -\\frac{1}{2}$ 和 $K_{i,i-1} = -\\frac{1}{h}$：\n$$A_{i,i-1} = a\\left(-\\frac{1}{2}\\right) + a^{2}\\tau\\left(-\\frac{1}{h}\\right) = -\\frac{a}{2} - \\frac{a^{2}\\tau}{h}.$$\nMetzler 条件要求 $A_{i,i-1} \\le 0$：\n$$-\\frac{a}{2} - \\frac{a^{2}\\tau}{h} \\le 0 \\implies -\\frac{a}{2} \\le \\frac{a^{2}\\tau}{h}.$$\n同样，两边乘以 $\\frac{h}{a^2} > 0$：\n$$-\\frac{h}{a^2}\\frac{a}{2} \\le \\tau \\implies -\\frac{h}{2a} \\le \\tau.$$\n\n为确保生成元矩阵是 Metzler 矩阵，必须同时满足稳定化参数 $\\tau$ 的两个条件。问题还指定了 $\\tau > 0$。我们有：\n$$ \\tau \\ge \\frac{h}{2a} \\quad \\text{and} \\quad \\tau \\ge -\\frac{h}{2a}. $$\n这对不等式可以合并成一个单一的条件：\n$$ \\tau \\ge \\max\\left(\\frac{h}{2a}, -\\frac{h}{2a}\\right). $$\n一个数及其相反数的最大值是其绝对值。因此，$\\tau$ 的条件是\n$$ \\tau \\ge \\left|\\frac{h}{2a}\\right|. $$\n由于 $h > 0$，这等价于\n$$ \\tau \\ge \\frac{h}{2|a|}. $$\n问题要求满足此条件的最小 $\\tau$ 值。这个最小值在等号成立时达到：\n$$ \\tau_{\\min} = \\frac{h}{2|a|}. $$\n选择此 $\\tau$ 值可确保 $A$ 的所有非对角线元素为非正，这反过来又保证了生成元矩阵 $G = -A/h$ 的所有非对角线元素为非负，从而满足 Metzler 性质。这个特定的 $\\tau$ 值向类中心差分的伽辽金格式中添加了足够的人工耗散，以恢复一阶迎风格式的非振荡特性。", "answer": "$$\\boxed{\\frac{h}{2|a|}}$$", "id": "3397658"}]}