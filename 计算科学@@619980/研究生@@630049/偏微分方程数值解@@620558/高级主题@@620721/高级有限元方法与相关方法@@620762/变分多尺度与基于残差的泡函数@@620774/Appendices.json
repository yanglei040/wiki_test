{"hands_on_practices": [{"introduction": "本练习将深入探讨气泡函数稳定化系统的核心机制。通过对一个简单的反应-扩散问题进行静态凝聚，您将推导出稳定化刚度矩阵的精确形式，从而具体理解未解析尺度是如何修正粗尺度方程的。这项基础练习对于揭示VMS方法背后的数学原理至关重要 ([@problem_id:3460285])。", "problem": "考虑在单个具有恒定系数的有限元 $K=[0,h]$ 上的稳态一维反应扩散模型问题：求 $u$ 使得\n$$\n- \\nu \\frac{d^{2}u}{dx^{2}} + \\lambda u = f \\quad \\text{on } K,\n$$\n其中 $\\nu>0$ 是扩散系数，$\\lambda \\ge 0$ 是反应系数。使用标准的Galerkin方法，并根据变分多尺度（VMS）方法的思想，通过单个基于残差的泡状函数进行丰富。在 $K$上，令 $P_{1}$（分段线性）基为节点函数 $N_{1}(x)=1-\\frac{x}{h}$ 和 $N_{2}(x)=\\frac{x}{h}$，并用单元内部的泡状函数 $b(x)=4 N_{1}(x) N_{2}(x)$ 及其限制在 $K$ 上的标量自由度 $u_{b}$ 来丰富试验和测试空间。\n\n将单元未知量向量表示为\n$$\n\\begin{pmatrix} u_{1} \\\\ u_{2} \\\\ u_{b} \\end{pmatrix},\n$$\n以及相应的分块单元刚度矩阵\n$$\n\\begin{pmatrix}\nK_{hh}  K_{hb} \\\\\nK_{bh}  K_{bb}\n\\end{pmatrix},\n$$\n其中 $K_{hh}\\in\\mathbb{R}^{2\\times 2}$，$K_{hb}\\in\\mathbb{R}^{2\\times 1}$，$K_{bh}=K_{hb}^{\\top}\\in\\mathbb{R}^{1\\times 2}$，以及 $K_{bb}\\in\\mathbb{R}^{1\\times 1}$。每个块由弱形式的双线性形式定义，\n$$\na(w,u)=\\int_{0}^{h} \\nu \\frac{dw}{dx}\\frac{du}{dx}\\,dx + \\int_{0}^{h} \\lambda\\, w\\,u\\,dx,\n$$\n通过从适当的基函数对中选取 $w$ 和 $u$。\n\n对泡状自由度进行静态凝聚，以局部消除 $u_{b}$，并表示二乘二的稳定化Schur补\n$$\nK_{\\text{stab}} \\;=\\; K_{hh} \\;-\\; K_{hb}\\,K_{bb}^{-1}\\,K_{bh}\n$$\n仅使用上面给出的定义和基础微积分，将其表示为关于 $\\nu$、$\\lambda$ 和 $h$ 的封闭形式解析表达式。你的最终答案必须是完全简化的 $2\\times 2$ 矩阵 $K_{\\text{stab}}$，以封闭形式书写。不要引入任何额外的近似。不需要四舍五入，最终表达式中不应包含任何单位。", "solution": "该问题是有效的，因为它在科学上基于偏微分方程数值方法的理论，是适定的、客观的，并包含唯一解所需的所有必要信息。\n\n目标是计算通过泡状自由度的静态凝聚得到的稳定化单元刚度矩阵 $K_{\\text{stab}}$。Schur补的公式如下：\n$$\nK_{\\text{stab}} = K_{hh} - K_{hb}\\,K_{bb}^{-1}\\,K_{bh}\n$$\n分析在单个单元 $K=[0,h]$ 上进行。有限元空间由标准线性基函数 $N_1$、$N_2$ 和一个单元内部泡状函数 $b$ 张成。基函数及其导数如下：\n$$\nN_{1}(x) = 1-\\frac{x}{h}, \\quad N_{1}'(x) = -\\frac{1}{h}\n$$\n$$\nN_{2}(x) = \\frac{x}{h}, \\quad N_{2}'(x) = \\frac{1}{h}\n$$\n$$\nb(x) = 4 N_{1}(x) N_{2}(x) = 4 \\left(1-\\frac{x}{h}\\right) \\frac{x}{h} = \\frac{4}{h^2}(hx - x^2), \\quad b'(x) = \\frac{4}{h^2}(h - 2x)\n$$\n刚度矩阵的分量由双线性形式导出：\n$$\na(w,u)=\\int_{0}^{h} \\left( \\nu \\frac{dw}{dx}\\frac{du}{dx} + \\lambda w u \\right) dx\n$$\n我们通过对基函数及其导数的乘积进行积分，来计算矩阵块 $K_{hh}$、$K_{bb}$ 和 $K_{hb}$。每个块矩阵可以写成扩散部分（与 $\\nu$ 成正比）和反应部分（与 $\\lambda$ 成正比）的和。\n\n首先，我们计算标准的 $P_1$ 单元刚度矩阵, $K_{hh} \\in \\mathbb{R}^{2\\times 2}$。其分量为 $(K_{hh})_{ij} = a(N_i, N_j)$。\n扩散部分由积分项 $\\int_0^h N_i' N_j' dx$ 组成：\n$$\n\\int_0^h (N_1')^2 dx = \\int_0^h \\left(-\\frac{1}{h}\\right)^2 dx = \\frac{1}{h}\n$$\n$$\n\\int_0^h N_1' N_2' dx = \\int_0^h \\left(-\\frac{1}{h}\\right)\\left(\\frac{1}{h}\\right) dx = -\\frac{1}{h}\n$$\n$$\n\\int_0^h (N_2')^2 dx = \\int_0^h \\left(\\frac{1}{h}\\right)^2 dx = \\frac{1}{h}\n$$\n反应部分（质量矩阵）由积分项 $\\int_0^h N_i N_j dx$ 组成：\n$$\n\\int_0^h N_1^2 dx = \\int_0^h \\left(1-\\frac{x}{h}\\right)^2 dx = \\left[-\\frac{h}{3}\\left(1-\\frac{x}{h}\\right)^3\\right]_0^h = \\frac{h}{3}\n$$\n$$\n\\int_0^h N_1 N_2 dx = \\int_0^h \\left(1-\\frac{x}{h}\\right)\\frac{x}{h} dx = \\left[\\frac{x^2}{2h} - \\frac{x^3}{3h^2}\\right]_0^h = \\frac{h}{2}-\\frac{h}{3}=\\frac{h}{6}\n$$\n$$\n\\int_0^h N_2^2 dx = \\int_0^h \\left(\\frac{x}{h}\\right)^2 dx = \\left[\\frac{x^3}{3h^2}\\right]_0^h = \\frac{h}{3}\n$$\n将这些组合起来得到 $K_{hh}$：\n$$\nK_{hh} = \\nu \\frac{1}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} + \\lambda \\frac{h}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix} = \\begin{pmatrix} \\frac{\\nu}{h} + \\frac{\\lambda h}{3}  -\\frac{\\nu}{h} + \\frac{\\lambda h}{6} \\\\ -\\frac{\\nu}{h} + \\frac{\\lambda h}{6}  \\frac{\\nu}{h} + \\frac{\\lambda h}{3} \\end{pmatrix}\n$$\n\n接下来，我们计算泡状函数-泡状函数相互作用项 $K_{bb} \\in \\mathbb{R}^{1\\times 1}$，即标量 $a(b,b)$。\n扩散部分：\n$$\n\\int_0^h (b')^2 dx = \\int_0^h \\left(\\frac{4}{h^2}(h-2x)\\right)^2 dx = \\frac{16}{h^4} \\int_0^h (h^2 - 4hx + 4x^2) dx = \\frac{16}{h^4} \\left[h^2x - 2hx^2 + \\frac{4}{3}x^3\\right]_0^h = \\frac{16}{h^4} \\left(h^3 - 2h^3 + \\frac{4}{3}h^3\\right) = \\frac{16}{3h}\n$$\n反应部分：\n$$\n\\int_0^h b^2 dx = \\int_0^h \\left(\\frac{4}{h^2}(hx-x^2)\\right)^2 dx = \\frac{16}{h^4} \\int_0^h (h^2x^2 - 2hx^3 + x^4) dx = \\frac{16}{h^4} \\left[\\frac{h^2x^3}{3} - \\frac{2hx^4}{4} + \\frac{x^5}{5}\\right]_0^h = \\frac{16}{h^4} \\left(\\frac{h^5}{3} - \\frac{h^5}{2} + \\frac{h^5}{5}\\right) = \\frac{16h}{30} = \\frac{8h}{15}\n$$\n将这些组合起来得到 $K_{bb}$：\n$$\nK_{bb} = \\nu \\frac{16}{3h} + \\lambda \\frac{8h}{15} = \\frac{8}{15h}(10\\nu + \\lambda h^2)\n$$\n由于 $\\nu > 0$ 且 $\\lambda \\ge 0$，所以 $K_{bb} > 0$ 且其逆矩阵 $K_{bb}^{-1}$ 存在。\n$$\nK_{bb}^{-1} = \\frac{1}{\\nu \\frac{16}{3h} + \\lambda \\frac{8h}{15}} = \\frac{15h}{8(10\\nu + \\lambda h^2)}\n$$\n\n现在，我们计算耦合块 $K_{hb} \\in \\mathbb{R}^{2\\times 1}$，其分量为 $(K_{hb})_i = a(N_i, b)$。\n对于 $N_1$ 的扩散部分：\n$$\n\\int_0^h N_1' b' dx = \\int_0^h \\left(-\\frac{1}{h}\\right) \\left(\\frac{4}{h^2}(h-2x)\\right) dx = -\\frac{4}{h^3} \\int_0^h (h-2x) dx = -\\frac{4}{h^3} \\left[hx-x^2\\right]_0^h = 0\n$$\n由于符号变化，对 $N_2'$ 的积分也为零：$\\int_0^h N_2' b' dx = 0$。\n对于 $N_1$ 的反应部分：\n$$\n\\int_0^h N_1 b dx = \\int_0^h \\left(1-\\frac{x}{h}\\right) \\frac{4}{h^2}(hx-x^2) dx = \\frac{4}{h^3} \\int_0^h x(h-x)^2 dx = \\frac{4}{h^3} \\left[\\frac{h^2x^2}{2} - \\frac{2hx^3}{3} + \\frac{x^4}{4}\\right]_0^h = \\frac{4}{h^3} \\left(\\frac{h^4}{12}\\right) = \\frac{h}{3}\n$$\n对于 $N_2$ 的反应部分：\n$$\n\\int_0^h N_2 b dx = \\int_0^h \\frac{x}{h} \\frac{4}{h^2}(hx-x^2) dx = \\frac{4}{h^3} \\int_0^h x^2(h-x) dx = \\frac{4}{h^3} \\left[\\frac{hx^3}{3} - \\frac{x^4}{4}\\right]_0^h = \\frac{4}{h^3} \\left(\\frac{h^4}{12}\\right) = \\frac{h}{3}\n$$\n耦合矩阵 $K_{hb}$ 及其转置 $K_{bh}$ 为：\n$$\nK_{hb} = \\begin{pmatrix} \\nu(0) + \\lambda \\frac{h}{3} \\\\ \\nu(0) + \\lambda \\frac{h}{3} \\end{pmatrix} = \\frac{\\lambda h}{3} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}, \\quad K_{bh} = K_{hb}^{\\top} = \\frac{\\lambda h}{3} \\begin{pmatrix} 1  1 \\end{pmatrix}\n$$\n\n最后，我们组装Schur补 $K_{\\text{stab}}$。修正项为 $K_{hb} K_{bb}^{-1} K_{bh}$：\n$$\nK_{hb} K_{bb}^{-1} K_{bh} = \\left(\\frac{\\lambda h}{3} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}\\right) \\left(\\frac{15h}{8(10\\nu + \\lambda h^2)}\\right) \\left(\\frac{\\lambda h}{3} \\begin{pmatrix} 1  1 \\end{pmatrix}\\right)\n$$\n$$\n= \\frac{\\lambda^2 h^2}{9} \\frac{15h}{8(10\\nu + \\lambda h^2)} \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix} = \\frac{15 \\lambda^2 h^3}{72(10\\nu + \\lambda h^2)} \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix} = \\frac{5 \\lambda^2 h^3}{24(10\\nu + \\lambda h^2)} \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix}\n$$\n稳定化刚度矩阵为 $K_{\\text{stab}} = K_{hh} - K_{hb} K_{bb}^{-1} K_{bh}$：\n$$\nK_{\\text{stab}} = \\begin{pmatrix} \\frac{\\nu}{h} + \\frac{\\lambda h}{3}  -\\frac{\\nu}{h} + \\frac{\\lambda h}{6} \\\\ -\\frac{\\nu}{h} + \\frac{\\lambda h}{6}  \\frac{\\nu}{h} + \\frac{\\lambda h}{3} \\end{pmatrix} - \\frac{5 \\lambda^2 h^3}{24(10\\nu + \\lambda h^2)} \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix}\n$$\n明确写出各分量即可得到最终结果。\n$$\n(K_{\\text{stab}})_{11} = (K_{\\text{stab}})_{22} = \\frac{\\nu}{h} + \\frac{\\lambda h}{3} - \\frac{5 \\lambda^2 h^3}{24(10\\nu + \\lambda h^2)}\n$$\n$$\n(K_{\\text{stab}})_{12} = (K_{\\text{stab}})_{21} = -\\frac{\\nu}{h} + \\frac{\\lambda h}{6} - \\frac{5 \\lambda^2 h^3}{24(10\\nu + \\lambda h^2)}\n$$\n这样就得到了完全指定的 $2 \\times 2$ 矩阵 $K_{\\text{stab}}$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{\\nu}{h} + \\frac{\\lambda h}{3} - \\frac{5 \\lambda^{2} h^{3}}{24(10\\nu + \\lambda h^{2})}  -\\frac{\\nu}{h} + \\frac{\\lambda h}{6} - \\frac{5 \\lambda^{2} h^{3}}{24(10\\nu + \\lambda h^{2})} \\\\\n-\\frac{\\nu}{h} + \\frac{\\lambda h}{6} - \\frac{5 \\lambda^{2} h^{3}}{24(10\\nu + \\lambda h^{2})}  \\frac{\\nu}{h} + \\frac{\\lambda h}{3} - \\frac{5 \\lambda^{2} h^{3}}{24(10\\nu + \\lambda h^{2})}\n\\end{pmatrix}\n}\n$$", "id": "3460285"}, {"introduction": "在计算流体动力学中，捕捉尖锐梯度或激波是一个经典挑战。本练习展示了VMS框架如何通过基于残差的气泡函数，为稳定伯格斯方程的数值解提供一种具有物理动机的人工黏性形式。通过标定模型常数以匹配期望的激波厚度，您将把抽象的VMS理论与具体的数值结果联系起来 ([@problem_id:3460310])。", "problem": "要求您比较两种用于解析一维粘性 Burgers 方程中激波的人工扩散机制，并校准它们的常数，以在指定的网格上实现预设的激波厚度。重点是采用基于残差的气泡函数的变分多尺度方法和熵粘性类型的模型。\n\n考虑一维粘性 Burgers 方程\n$$\nu_t + \\partial_x\\left(\\tfrac{1}{2} u^2\\right) = \\nu\\, u_{xx},\n$$\n其中 $u(x,t)$ 是一个标量速度场，$x \\in \\mathbb{R}$，$t \\ge 0$，$\\nu > 0$ 是一个常数运动粘度。假设一个连接常数末端状态 $u_L$ 和 $u_R$（其中 $u_L > u_R$）的稳态行波（激波）。已知精确的粘性行波剖面是光滑且单调的，其特征厚度取决于有效粘度。\n\n您的任务是：\n\n1) 从粘性 Burgers 方程的稳态行波定义出发，推导在激波附加坐标系中波剖面所满足的常微分方程，并获得单调解析解。由此，推导一个闭式表达式，用于计算解达到激波跳跃的 $90\\%$ 和 $10\\%$ 的点之间的距离（即所谓的 $10$–$90$ 厚度）。将此厚度表示为\n$$\n\\delta = \\kappa \\frac{\\nu_{\\text{eff}}}{\\Delta u},\n$$\n其中 $\\Delta u = u_L - u_R$，$\\nu_{\\text{eff}}$ 是激波处的总有效粘度，$\\kappa$ 是一个正常数，您必须在推导过程中从第一性原理精确确定它。陈述您的 $\\kappa$ 的精确值。\n\n2) 考虑一个变分多尺度 (VMS) 格式，其基于残差的气泡函数应用于通过围绕局部平均对流速度 $\\bar{u}$ 线性化 Burgers 通量而得到的线性化、稳态、一维对流-扩散算子。使用一个尺寸为 $h$ 的一维单元，其气泡子尺度在单元端点处为零，推导单元上的精确子尺度解，并证明它导出一个取决于单元 Péclet 数的单元稳定化参数 $\\tau$\n$$\n\\mathrm{Pe} = \\frac{|\\bar{u}|\\, h}{2 \\nu}.\n$$\n从此推导中，获得 $\\tau$ 关于 $\\mathrm{Pe}$ 和 $h, \\bar{u}, \\nu$ 的显式一维表达式。然后，证明该稳定化方法（在一维中）等同于添加一个形式为\n$$\n\\nu_{\\tau} = \\tau\\, \\bar{u}^{2}\n$$\n的流线方向人工扩散。引入一个标量校准因子 $C_{\\tau} > 0$ 乘以参考 $\\tau$，使得诱导的扩散变为 $\\nu_{\\tau} = C_{\\tau}\\, \\tau_{\\text{ref}}\\, \\bar{u}^{2}$，并解释为什么在实践中使用这样的因子。\n\n3) 定义一个熵粘性类型的人工扩散为\n$$\n\\nu_{e} = C_{\\mathrm{ev}}\\, h^{2}\\, |R_h|,\n$$\n其中 $C_{\\mathrm{ev}} > 0$ 是一个标量校准常数，$h$ 是均匀网格间距，$R_h$ 是在激波中心处评估的稳态 Burgers 算子的相容离散残差，该残差通过将二阶中心有限差分应用于在三个点 $x=-h, 0, +h$ 处采样的精确行波剖面来计算。具体来说，定义\n$$\nR_h = D_x\\!\\left(\\tfrac{1}{2} u^2\\right)\\Big|_{x=0} - \\nu\\, D_{xx} u\\Big|_{x=0},\n$$\n其中\n$$\nD_x f\\big|_{x=0} = \\frac{f(h) - f(-h)}{2 h}, \\qquad D_{xx} u\\big|_{x=0} = \\frac{u(h) - 2 u(0) + u(-h)}{h^{2}},\n$$\n并使用以 $x=0$ 为中心、连接 $u_L$ 和 $u_R$ 的精确稳态 Burgers 行波剖面来评估 $u(-h), u(0), u(h)$ 和 $f = \\tfrac{1}{2} u^2$。\n\n4) 对于给定的目标激波厚度 $\\delta_{\\text{target}} = N h$（其中 $N > 0$ 是一个预设值）、基础物理粘度 $\\nu$ 以及状态 $u_L, u_R$（其中 $\\Delta u = u_L - u_R > 0$），将激波中心处的总有效粘度定义为\n$$\n\\nu_{\\text{eff}}^{(\\mathrm{ev})} = \\nu + \\nu_e, \\qquad \\text{或} \\qquad \\nu_{\\text{eff}}^{(\\tau)} = \\nu + \\nu_{\\tau},\n$$\n并校准 $C_{\\mathrm{ev}}$ 和 $C_{\\tau}$，使得每个模型都能匹配目标厚度：\n$$\n\\delta_{\\text{target}} = \\kappa \\frac{\\nu_{\\text{eff}}^{(\\mathrm{ev})}}{\\Delta u}, \\qquad \\delta_{\\text{target}} = \\kappa \\frac{\\nu_{\\text{eff}}^{(\\tau)}}{\\Delta u}.\n$$\n在基于 $\\tau$ 的模型中，使用激波中心处的平均线性化速度 $\\bar{u} = s = \\tfrac{1}{2}(u_L + u_R)$。如果所需的人工扩散将为负（因为 $\\nu$ 已超过目标所需），则将相应的校准常数设为零。本问题中的所有量均为无量纲；所有数值答案均以浮点数报告。\n\n5) 实现一个程序，对于下面的每个测试用例，使用上述推导计算对 $\\big(C_{\\mathrm{ev}}, C_{\\tau}\\big)$。为了评估 $R_h$，使用以 $x=0$ 为中心的精确稳态行波剖面：\n$$\nu(x) = s - \\frac{\\Delta u}{2}\\, \\tanh\\!\\left(\\frac{\\Delta u}{4 \\nu}\\, x\\right), \\quad s = \\frac{u_L + u_R}{2}, \\quad \\Delta u = u_L - u_R,\n$$\n在 $x=-h, 0, +h$ 处采样。\n\n测试套件：\n-   案例 1：$u_L = 2.0$，$u_R = 0.0$，$\\nu = 1.0 \\times 10^{-3}$，$h = 1/200$，$\\delta_{\\text{target}} = 6 h$。\n-   案例 2：$u_L = 1.5$，$u_R = 0.1$，$\\nu = 2.0 \\times 10^{-4}$，$h = 1/400$，$\\delta_{\\text{target}} = 8 h$。\n-   案例 3：$u_L = 1.0$，$u_R = 0.5$，$\\nu = 5.0 \\times 10^{-4}$，$h = 1/100$，$\\delta_{\\text{target}} = 4 h$。\n\n最终输出格式：\n您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表的结果，顺序如下\n$$\n\\big[ C_{\\mathrm{ev}}^{(1)}, C_{\\tau}^{(1)}, C_{\\mathrm{ev}}^{(2)}, C_{\\tau}^{(2)}, C_{\\mathrm{ev}}^{(3)}, C_{\\tau}^{(3)} \\big].\n$$\n每个条目必须是一个浮点数。不应打印任何其他文本。", "solution": "该问题被评估为有效，因为它在科学上是合理的、内容自洽、适定且客观的。它展示了偏微分方程数值方法领域内的一套标准推导和计算。我们开始进行解答。\n\n解答根据问题陈述中指定的五个任务进行组织。\n\n### 1. 行波解与激波厚度\n\n我们寻找形式为 $u(x, t) = U(\\xi)$ 的稳态行波解，其中 $\\xi = x - st$，$s$ 为常数波速。将此代入一维粘性 Burgers 方程 $u_t + \\partial_x\\left(\\tfrac{1}{2} u^2\\right) = \\nu u_{xx}$，我们得到剖面 $U(\\xi)$ 的常微分方程（ODE）。偏导数变为：\n$u_t = -s \\frac{dU}{d\\xi}$，$\\partial_x(\\frac{1}{2} u^2) = U \\frac{dU}{d\\xi}$，以及 $u_{xx} = \\frac{d^2U}{d\\xi^2}$。\n偏微分方程变换为：\n$$ -s \\frac{dU}{d\\xi} + U \\frac{dU}{d\\xi} = \\nu \\frac{d^2U}{d\\xi^2} $$\n这可以写成 $\\frac{d}{d\\xi}\\left(\\frac{1}{2}U^2 - sU\\right) = \\nu \\frac{d^2U}{d\\xi^2}$。对 $\\xi$ 积分得到：\n$$ \\nu \\frac{dU}{d\\xi} = \\frac{1}{2}U^2 - sU + C_1 $$\n其中 $C_1$ 是一个积分常数。边界条件是当 $\\xi \\to -\\infty$ 时 $U \\to u_L$ 且当 $\\xi \\to +\\infty$ 时 $U \\to u_R$。在这些极限下，波剖面是平的，所以 $\\frac{dU}{d\\xi} \\to 0$。应用这些条件：\n$$ 0 = \\frac{1}{2}u_L^2 - su_L + C_1 $$\n$$ 0 = \\frac{1}{2}u_R^2 - su_R + C_1 $$\n两式相减得到 $\\frac{1}{2}(u_L^2 - u_R^2) - s(u_L - u_R) = 0$。由于 $u_L > u_R$，我们有 $\\Delta u = u_L - u_R \\neq 0$，所以我们可以用它除以它来找到激波速度 $s$：\n$$ s = \\frac{1}{2}(u_L + u_R) $$\n将 $s$ 代回第一个方程得到常数 $C_1 = su_L - \\frac{1}{2}u_L^2 = \\frac{1}{2}(u_L+u_R)u_L - \\frac{1}{2}u_L^2 = \\frac{1}{2}u_L u_R$。\n因此，剖面 $U(\\xi)$ 的常微分方程是：\n$$ \\nu \\frac{dU}{d\\xi} = \\frac{1}{2}U^2 - \\frac{u_L+u_R}{2}U + \\frac{1}{2}u_L u_R = \\frac{1}{2}(U - u_L)(U - u_R) $$\n这是一个可分离的常微分方程。我们分离变量并积分：\n$$ \\int \\frac{dU}{(U - u_L)(U - u_R)} = \\int \\frac{1}{2\\nu}d\\xi $$\n使用部分分式分解，$\\frac{1}{(U - u_L)(U - u_R)} = \\frac{1}{u_L-u_R}\\left(\\frac{1}{U-u_L} - \\frac{1}{U-u_R}\\right)$。\n$$ \\frac{1}{u_L-u_R} \\int \\left(\\frac{1}{U-u_L} - \\frac{1}{U-u_R}\\right) dU = \\frac{\\xi}{2\\nu} + C_2 $$\n$$ \\frac{1}{\\Delta u} \\left( \\ln|U-u_L| - \\ln|U-u_R| \\right) = \\frac{\\xi}{2\\nu} + C_2 $$\n由于 $u_R < U < u_L$，我们有 $|U-u_L|=u_L-U$ 和 $|U-u_R|=U-u_R$。\n$$ \\ln\\left(\\frac{u_L-U}{U-u_R}\\right) = \\frac{\\Delta u}{2\\nu}\\xi + C_3 $$\n令激波中心位于 $\\xi=0$ 处，其中 $U(0) = \\frac{u_L+u_R}{2} = s$。此时，$\\frac{u_L-s}{s-u_R} = \\frac{(u_L-u_R)/2}{(u_L-u_R)/2} = 1$。因此，$\\ln(1) = 0 = C_3$。\n解出 $U$ 得到显式剖面：\n$$ U(\\xi) = s - \\frac{\\Delta u}{2}\\tanh\\left(\\frac{\\Delta u}{4\\nu}\\xi\\right) $$\n激波厚度 $\\delta$ 是剖面达到总跳跃 $\\Delta u = u_L - u_R$（在右侧状态 $u_R$ 之上）的 $10\\%$ 和 $90\\%$ 的点 $\\xi_1$ 和 $\\xi_2$ 之间的距离。\n这两个值是 $u_1 = u_R + 0.9(u_L - u_R) = 0.9u_L + 0.1u_R$ 和 $u_2 = u_R + 0.1(u_L - u_R) = 0.1u_L + 0.9u_R$。\n对于 $u_1$：$s - u_1 = \\frac{u_L+u_R}{2} - (0.9u_L + 0.1u_R) = -0.4(u_L-u_R) = -0.4\\Delta u$。\n代入解中：$-0.4\\Delta u = -\\frac{\\Delta u}{2}\\tanh\\left(\\frac{\\Delta u}{4\\nu}\\xi_1\\right) \\implies \\tanh\\left(\\frac{\\Delta u}{4\\nu}\\xi_1\\right) = 0.8$。\n对于 $u_2$：$s - u_2 = \\frac{u_L+u_R}{2} - (0.1u_L + 0.9u_R) = 0.4(u_L-u_R) = 0.4\\Delta u$。\n代入解中：$0.4\\Delta u = -\\frac{\\Delta u}{2}\\tanh\\left(\\frac{\\Delta u}{4\\nu}\\xi_2\\right) \\implies \\tanh\\left(\\frac{\\Delta u}{4\\nu}\\xi_2\\right) = -0.8$。\n位置是 $\\xi_1 = \\frac{4\\nu}{\\Delta u}\\text{arctanh}(0.8)$ 和 $\\xi_2 = \\frac{4\\nu}{\\Delta u}\\text{arctanh}(-0.8) = -\\frac{4\\nu}{\\Delta u}\\text{arctanh}(0.8)$。\n厚度是 $\\delta = \\xi_1 - \\xi_2 = \\frac{8\\nu}{\\Delta u}\\text{arctanh}(0.8)$。\n使用恒等式 $\\text{arctanh}(z) = \\frac{1}{2}\\ln\\left(\\frac{1+z}{1-z}\\right)$，我们有 $\\text{arctanh}(0.8) = \\frac{1}{2}\\ln\\left(\\frac{1.8}{0.2}\\right) = \\frac{1}{2}\\ln(9) = \\ln(3)$。\n因此，厚度是 $\\delta = \\frac{8\\ln(3)}{\\Delta u}\\nu$。\n将此与指定形式 $\\delta = \\kappa \\frac{\\nu_{\\text{eff}}}{\\Delta u}$ 进行比较，对于精确解，$\\nu_{\\text{eff}} = \\nu$，我们确定常数 $\\kappa$：\n$$ \\kappa = 8 \\ln(3) $$\n\n### 2. 变分多尺度稳定化参数\n\n对于线性化的稳态对流-扩散算子 $\\mathcal{L}u = \\bar{u}u_x - \\nu u_{xx}$，VMS 格式引入了一个基于未解析的子网格尺度的稳定项。在一个尺寸为 $h$ 的一维单元上，细尺度（气泡）分量 $u'$ 是 $\\mathcal{L}u' = R_h$ 在零边界条件下的解，其中 $R_h$ 是粗尺度解的残差。对于单元 $K$ 上的常数残差 $R_K$，$u'$ 的解可以解析地找到。这个子尺度对粗尺度的影响等同于在弱形式中添加一个项。对于一维问题，这个项可以通过一个稳定化参数 $\\tau$ 来定义。\n标准推导为具有常系数的线性一维问题提供了节点精确解，并得出以下 $\\tau$ 的表达式：\n$$ \\tau = \\frac{h}{2|\\bar{u}|} \\left(\\coth(\\mathrm{Pe}) - \\frac{1}{\\mathrm{Pe}}\\right) $$\n其中 $\\mathrm{Pe}$ 是单元 Péclet 数，定义为：\n$$ \\mathrm{Pe} = \\frac{|\\bar{u}|h}{2\\nu} $$\n这个 $\\tau$ 的表达式是所要求的显式形式。\n稳定化有限元方法添加一个与 $\\int_K \\tau (\\mathcal{L}u_h) (\\mathcal{L}^* v_h) dx$ 成比例的项，其中 $\\mathcal{L}^*$ 是伴随算子。对于流线迎风/Petrov-Galerkin (SUPG) 方法，它是 VMS 的一个特例，权函数被简化，弱形式中的附加项是 $\\int_K \\tau R_h (\\bar{u} v_{h,x}) dx$，其中 $R_h = \\bar{u}u_{h,x} - \\nu u_{h,xx}$ 是单元残差。\n该项中涉及 $u_h$ 最高阶导数的部分是 $\\int_K \\tau (\\bar{u} u_{h,x})(\\bar{u} v_{h,x}) dx = \\int_K (\\tau \\bar{u}^2) u_{h,x} v_{h,x} dx$。该项与标准 Galerkin 扩散项 $\\int_K \\nu u_{h,x} v_{h,x} dx$ 具有相同的形式。因此，引入稳定项等同于沿流线（在一维中，这是唯一的方向）添加人工扩散 $\\nu_{\\tau}$：\n$$ \\nu_{\\tau} = \\tau \\bar{u}^2 $$\n参数 $\\tau_{\\text{ref}}$ 是从一个简化的线性模型问题中推导出来的。在像 Burgers 方程这样的复杂非线性应用中，这个参考值可能不是最优的。它可能提供过多或过少的稳定化。引入校准因子 $C_{\\tau}$ 是为了提供一种调整人工扩散水平的机制，允许人们调整数值解以获得期望的性质，例如以最小的振荡和特定的厚度捕捉激波。那么人工扩散为 $\\nu_\\tau = C_{\\tau} \\tau_{\\text{ref}} \\bar{u}^2$。\n\n### 3. 熵粘性类型的人工扩散\n\n熵粘性定义为 $\\nu_e = C_{\\mathrm{ev}} h^2 |R_h|$，其中 $R_h$ 是稳态 Burgers 方程的离散残差，$R_h = D_x(\\frac{1}{2}u^2)|_{x=0} - \\nu D_{xx}u|_{x=0}$。\n离散算子是二阶中心差分：\n$D_x f|_{x=0} = \\frac{f(h) - f(-h)}{2h}$ 和 $D_{xx} u|_{x=0} = \\frac{u(h) - 2u(0) + u(-h)}{h^2}$。\n我们使用精确的行波解 $u(x) = s - \\frac{\\Delta u}{2}\\tanh(\\frac{\\Delta u}{4\\nu}x)$ 来计算这些值。剖面 $u(x)-s$ 是 $x$ 的奇函数。因此，$u(h)-s = -(u(-h)-s)$，这意味着 $u(h)+u(-h)=2s$。并且，$u(0)=s$。\n离散拉普拉斯算子是：\n$$ D_{xx} u\\big|_{x=0} = \\frac{u(h) + u(-h) - 2u(0)}{h^2} = \\frac{2s - 2s}{h^2} = 0 $$\n离散残差简化为对流部分：\n$$ R_h = D_x(\\tfrac{1}{2}u^2)|_{x=0} = \\frac{\\frac{1}{2}u(h)^2 - \\frac{1}{2}u(-h)^2}{2h} = \\frac{u(h)^2 - u(-h)^2}{4h} $$\n使用 $u(h) = s - \\frac{\\Delta u}{2}\\tanh(\\frac{\\Delta u}{4\\nu}h)$ 和 $u(-h) = s + \\frac{\\Delta u}{2}\\tanh(\\frac{\\Delta u}{4\\nu}h)$：\n$u(h)^2 - u(-h)^2 = (u(h)-u(-h))(u(h)+u(-h)) = (-\\Delta u \\tanh(\\frac{\\Delta u}{4\\nu}h))(2s)$。\n$$ R_h = \\frac{-2s\\Delta u \\tanh(\\frac{\\Delta u}{4\\nu}h)}{4h} = -\\frac{s\\Delta u}{2h}\\tanh\\left(\\frac{\\Delta u h}{4\\nu}\\right) $$\n那么熵粘性是：\n$$ \\nu_e = C_{ev} h^2 |R_h| = C_{ev} h^2 \\frac{s\\Delta u}{2h} \\tanh\\left(\\frac{\\Delta u h}{4\\nu}\\right) = C_{ev} \\frac{hs\\Delta u}{2} \\tanh\\left(\\frac{\\Delta u h}{4\\nu}\\right) $$\n（假设 $s>0$ 和 $\\Delta u>0$，这对给定的测试用例是成立的）。\n\n### 4. 常数的校准\n\n目标激波厚度为 $\\delta_{\\text{target}} = N h$。使用第 1 部分的公式 $\\delta = \\kappa \\frac{\\nu_{\\text{eff}}}{\\Delta u}$，我们找到所需的总有效粘度：\n$$ \\nu_{\\text{eff, target}} = \\frac{\\delta_{\\text{target}}\\Delta u}{\\kappa} = \\frac{N h \\Delta u}{8 \\ln(3)} $$\n物理粘度为 $\\nu$。所需的人工粘度是 $\\nu_{\\text{art, target}} = \\nu_{\\text{eff, target}} - \\nu$。如果 $\\nu_{\\text{art, target}} \\le 0$，则物理粘度已经足够或过多以达到目标厚度，因此不需要人工粘度，校准常数设为 0。否则，对于 $\\nu_{\\text{art, target}} > 0$：\n\n**$C_{\\mathrm{ev}}$ 的校准**：\n我们令 $\\nu_e = \\nu_{\\text{art, target}}$：\n$$ C_{ev} \\frac{hs\\Delta u}{2} \\tanh\\left(\\frac{\\Delta u h}{4\\nu}\\right) = \\nu_{\\text{art, target}} $$\n解出 $C_{ev}$：\n$$ C_{\\mathrm{ev}} = \\frac{2 \\nu_{\\text{art, target}}}{h s \\Delta u \\tanh\\left(\\frac{\\Delta u h}{4\\nu}\\right)} $$\n\n**$C_{\\tau}$ 的校准**：\n我们令 $\\nu_{\\tau} = \\nu_{\\text{art, target}}$。$\\nu_{\\tau}$ 的表达式是 $\\nu_{\\tau} = C_{\\tau} \\tau_{\\text{ref}} \\bar{u}^2$。使用 $\\bar{u}=s$ 和 $\\tau_{\\text{ref}}$ 的公式：\n$$ \\nu_{\\tau} = C_{\\tau} \\left[ \\frac{h}{2s} \\left(\\coth(\\mathrm{Pe}) - \\frac{1}{\\mathrm{Pe}}\\right) \\right] s^2 = C_{\\tau} \\frac{hs}{2} \\left(\\coth(\\mathrm{Pe}) - \\frac{1}{\\mathrm{Pe}}\\right) $$\n其中 $\\mathrm{Pe} = \\frac{sh}{2\\nu}$（假设 $s>0$）。将此设为等于 $\\nu_{\\text{art, target}}$：\n$$ C_{\\tau} \\frac{hs}{2} \\left(\\coth\\left(\\frac{sh}{2\\nu}\\right) - \\frac{2\\nu}{sh}\\right) = \\nu_{\\text{art, target}} $$\n解出 $C_{\\tau}$：\n$$ C_{\\tau} = \\frac{2 \\nu_{\\text{art, target}}}{hs \\left(\\coth\\left(\\frac{sh}{2\\nu}\\right) - \\frac{2\\nu}{sh}\\right)} $$\n这些公式在以下程序中实现。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes calibration constants C_ev and C_tau for two artificial diffusion models\n    applied to the 1D viscous Burgers equation to match a target shock thickness.\n    \"\"\"\n    \n    # Test cases: (u_L, u_R, nu, h, N) where delta_target = N * h\n    test_cases = [\n        # Case 1\n        (2.0, 0.0, 1.0e-3, 1.0/200.0, 6.0),\n        # Case 2\n        (1.5, 0.1, 2.0e-4, 1.0/400.0, 8.0),\n        # Case 3\n        (1.0, 0.5, 5.0e-4, 1.0/100.0, 4.0),\n    ]\n\n    results = []\n    \n    # Constant kappa from derivation: kappa = 8 * ln(3)\n    kappa = 8.0 * np.log(3.0)\n\n    for case in test_cases:\n        u_L, u_R, nu, h, N = case\n        \n        # Calculate derived parameters\n        delta_u = u_L - u_R\n        s = 0.5 * (u_L + u_R)\n        delta_target = N * h\n\n        # Calculate the target effective viscosity\n        nu_eff_target = (delta_target * delta_u) / kappa\n        \n        # Calculate the required artificial viscosity\n        nu_art_target = nu_eff_target - nu\n        \n        if nu_art_target = 0.0:\n            C_ev = 0.0\n            C_tau = 0.0\n        else:\n            # --- Calibrate C_ev ---\n            # Argument for the tanh function in the R_h expression\n            arg_tanh_ev = (delta_u * h) / (4.0 * nu)\n            # Denominator for C_ev formula\n            denom_ev = (h * s * delta_u / 2.0) * np.tanh(arg_tanh_ev)\n            \n            if np.abs(denom_ev) > 1e-15:\n                C_ev = nu_art_target / denom_ev\n            else:\n                # This case should not be reached with the given inputs but is good practice\n                C_ev = np.inf \n\n            # --- Calibrate C_tau ---\n            # Element Peclet number\n            # Assuming s > 0, so |s| = s\n            peclet = (s * h) / (2.0 * nu)\n            \n            if peclet  1e-8:\n                # Taylor expansion for small x: coth(x) - 1/x -> x/3\n                coth_minus_inv_pe = peclet / 3.0\n            else:\n                coth_minus_inv_pe = (1.0 / np.tanh(peclet)) - (1.0 / peclet)\n\n            # Denominator for C_tau formula\n            denom_tau = (h * s / 2.0) * coth_minus_inv_pe\n            \n            if np.abs(denom_tau) > 1e-15:\n                C_tau = nu_art_target / denom_tau\n            else:\n                # This case should not be reached with the given inputs\n                C_tau = np.inf\n\n        results.extend([C_ev, C_tau])\n\n    # Format output as a single comma-separated string in brackets\n    # e.g., [val1,val2,val3,...]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3460310"}, {"introduction": "标准有限元方法在处理包含不连续材料属性的问题时常常遇到困难，尤其是在跨界面处无法保持通量连续性等物理定律。本项高级练习将指导您设计一个特殊的“界面感知”气泡函数，为一个具有不连续系数的扩散问题显式地恢复通量连续性。通过将该方法与扩展有限元法(XFEM)进行比较，您将体会到VMS在针对特定物理约束定制解决方案方面的灵活性和强大功能 ([@problem_id:3460319])。", "problem": "考虑定义在域 $[0,1]$ 上的一维二阶椭圆边值问题，其形式为 $- \\frac{d}{dx}\\left(a(x)\\frac{d u(x)}{dx}\\right) = f(x)$，具有齐次强迫项 $f(x) = 0$ 和狄利克雷边界条件 $u(0)=0$ 及 $u(1)=1$。扩散系数 $a(x)$ 是分段常数，在界面位置 $x = x_{\\mathrm{I}}$ 处有一个单一间断点，因此当 $x  x_{\\mathrm{I}}$ 时 $a(x) = a^{-}$，当 $x  x_{\\mathrm{I}}$ 时 $a(x) = a^{+}$，其中 $a^{-}  0$ 且 $a^{+}  0$。精确解在界面上具有连续的通量，即 $[a(x)u'(x)]_{x_{\\mathrm{I}}} = 0$，其中 $[\\cdot]_{x_{\\mathrm{I}}}$ 表示跨越 $x_{\\mathrm{I}}$ 的跳跃。\n\n我们使用包含 $N$ 个尺寸为 $h = 1/N$ 的单元的均匀网格和标准的线性拉格朗日有限元来离散化该域。假设通过将切割单元分解为具有相应 $a(x)$ 值的子段，来精确积分单元刚度，包括被界面穿过的切割单元。得到的粗尺度有限元解 $u_{h}(x)$ 是每个单元上的分段线性和全局连续的；在任何包含 $x_{\\mathrm{I}}$ 的切割单元 $[x_{k}, x_{k+1}]$ 上，其斜率是常数，$u_{h}'(x) = c_{1}$ 对于 $x \\in (x_{k}, x_{k+1})$，其在界面处的通量跳跃为 $J_{\\mathrm{FE}} = \\left|a^{-} c_{1} - a^{+} c_{1}\\right|$。\n\n在变分多尺度框架中，考虑在切割单元 $[x_{k}, x_{k+1}]$ 上构造一个基于残差的气泡函数 $b(x)$，其支撑集为该单元，满足 $b(x_{k}) = b(x_{k+1}) = 0$，并在子段 $[x_{k}, x_{\\mathrm{I}}]$ 和 $[x_{\\mathrm{I}}, x_{k+1}]$ 内是分段线性的。记子段长度为 $\\ell_{-} = x_{\\mathrm{I}} - x_{k}$ 和 $\\ell_{+} = x_{k+1} - x_{\\mathrm{I}}$。令 $b'(x)$ 在每个子段上为常数，当 $x \\in (x_{k}, x_{\\mathrm{I}})$ 时 $b'(x) = \\beta_{-}$，当 $x \\in (x_{\\mathrm{I}}, x_{k+1})$ 时 $b'(x) = -\\beta_{+}$，并强制 $b(x)$ 在 $x_{\\mathrm{I}}$ 处连续。将切割单元上的修正粗尺度解定义为 $u_{h}^{\\mathrm{bub}}(x) = u_{h}(x) + b(x)$，并选择 $\\beta_{-}$ 和 $\\beta_{+}$ 使得修正后的通量在界面处连续，即 $a^{-}\\left(c_{1} + \\beta_{-}\\right) = a^{+}\\left(c_{1} - \\beta_{+}\\right)$，同时满足由 $b(x_{\\mathrm{I}}^{-}) = b(x_{\\mathrm{I}}^{+})$ 暗示的连续性约束 $\\beta_{-}\\ell_{-} = \\beta_{+}\\ell_{+}$。这产生了一个基于残差的气泡函数，它恢复了界面感知的通量连续性。气泡修正后的通量跳跃为 $J_{\\mathrm{bub}} = \\left|a^{-}\\left(c_{1} + \\beta_{-}\\right) - a^{+}\\left(c_{1} - \\beta_{+}\\right)\\right|$。\n\n作为对比，考虑一种局限于切割单元的扩展有限元方法 (XFEM) 丰富，该方法允许在界面两侧有独立的斜率，同时保持 $u$ 的连续性。令 $u^{\\mathrm{XFEM}}(x)$ 在两个子段上是分段线性的，在 $[x_{k}, x_{\\mathrm{I}}]$ 上的斜率为 $s_{-}$，在 $[x_{\\mathrm{I}}, x_{k+1}]$ 上的斜率为 $s_{+}$，并受到 $x_{k}$ 和 $x_{k+1}$ 处节点值的约束，因此 $s_{-}\\ell_{-} + s_{+}\\ell_{+} = \\Delta$，其中 $\\Delta = u_{h}(x_{k+1}) - u_{h}(x_{k}) = c_{1} h$。由弱形式所蕴含的能量最小化选择产生一个常数通量 $C$，使得 $a^{-} s_{-} = a^{+} s_{+} = C$，其中 $C = \\Delta\\left(\\ell_{-}/a^{-} + \\ell_{+}/a^{+}\\right)^{-1}$。XFEM 的通量跳跃为 $J_{\\mathrm{XFEM}} = \\left|a^{-} s_{-} - a^{+} s_{+}\\right|$。\n\n您的任务是实现一个程序，该程序：\n- 为粗尺度线性有限元离散化构造全局刚度矩阵，并对切割单元进行精确积分，在狄利克雷边界条件下求解 $u_{h}$，并计算包含界面的切割单元的 $J_{\\mathrm{FE}}$。如果界面与网格节点重合，则定义 $J_{\\mathrm{FE}} = 0$。\n- 如上所述，在切割单元上构造基于残差的气泡函数，计算修正后的斜率 $(c_{1} + \\beta_{-})$ 和 $(c_{1} - \\beta_{+})$，并评估 $J_{\\mathrm{bub}}$。如果界面与节点重合，则定义 $J_{\\mathrm{bub}} = 0$。\n- 构造允许独立斜率 $s_{-}$ 和 $s_{+}$ 的局部 XFEM 丰富，该丰富满足节点约束和常数通量条件，并计算 $J_{\\mathrm{XFEM}}$。如果界面与节点重合，则定义 $J_{\\mathrm{XFEM}} = 0$。\n\n从以下基本依据出发：\n- 对于 $f(x) = 0$ 的伽辽金有限元弱形式，在施加本质边界条件后，会产生一个对称正定的线性系统 $K \\mathbf{u} = \\mathbf{0}$。在精确积分下，$[x_{j}, x_{j+1}]$ 上的单元刚度矩阵为 $\\frac{a_{e}}{h}\\begin{bmatrix}1  -1 \\\\ -1  1\\end{bmatrix}$，其中 $a_{e} = a^{-}$, $a^{+}$，或对于切割单元为加权平均值 $a_{e} = \\frac{a^{-}\\ell_{-} + a^{+}\\ell_{+}}{h}$。\n- 对于具有分段常数 $a(x)$ 的扩散问题，界面条件为 $[u]_{x_{\\mathrm{I}}} = 0$ 和 $[a u']_{x_{\\mathrm{I}}} = 0$。\n- 对于局限于切割单元的 XFEM 丰富，节点约束下的能量最小化意味着跨界面的通量是恒定的。\n\n测试套件：\n使用以下参数集 $(N, x_{\\mathrm{I}}, a^{-}, a^{+})$：\n1. $(4, 0.37, 1.0, 10.0)$\n2. $(8, 0.126, 5.0, 0.5)$\n3. $(5, 0.399, 2.0, 3.0)$\n4. $(10, 0.6, 7.0, 1.0)$\n5. $(3, 0.5, 1.0, 1000.0)$\n\n对于每个测试用例，计算并返回列表 $\\left[J_{\\mathrm{FE}}, J_{\\mathrm{bub}}, J_{\\mathrm{XFEM}}\\right]$，其中每个 $J$ 是一个非负实数。最终的程序输出必须是单行，包含这些按用例排列的列表，格式为用方括号括起来的逗号分隔列表。例如：$\\left[\\left[J_{\\mathrm{FE},1},J_{\\mathrm{bub},1},J_{\\mathrm{XFEM},1}\\right],\\ldots,\\left[J_{\\mathrm{FE},5},J_{\\mathrm{bub},5},J_{\\mathrm{XFEM},5}\\right]\\right]$。所有数字必须表示为无量纲的浮点值。", "solution": "问题陈述已经过严格验证，被认为是科学上合理、适定且自洽的。对于给定的一维扩散问题，关于标准有限元法 (FEM)、基于残差的气泡函数修正法以及扩展有限元法 (XFEM) 丰富的描述在数学上是正确的。任务是计算这三种方法在材料界面处的通量跳跃。这个问题是关于含不连续系数的偏微分方程数值方法的标准练习。我们将继续提供完整解法。\n\n该解法的实现首先通过离散化定义域，并使用标准线性有限元法求解粗尺度问题。然后，计算该解的通量跳跃。最后，构造气泡和 XFEM 修正，并计算它们各自的通量跳跃，根据设计，这些跳跃值预期为零。\n\n**1. 标准有限元法 (FEM) 和通量跳跃 $J_{\\mathrm{FE}}$**\n\n控制方程是一维扩散方程：\n$$\n- \\frac{d}{dx}\\left(a(x)\\frac{d u(x)}{dx}\\right) = 0, \\quad x \\in (0, 1)\n$$\n具有狄利克雷边界条件 $u(0)=0$ 和 $u(1)=1$。扩散系数 $a(x)$ 是分段常数，在 $x = x_{\\mathrm{I}}$ 处有间断。\n\n弱形式是通过乘以一个测试函数 $v(x)$（其中 $v(0)=0$）并在整个域上积分得到的：\n$$\n\\int_0^1 a(x) \\frac{du}{dx} \\frac{dv}{dx} dx = 0\n$$\n我们用 $N$ 个尺寸为 $h = 1/N$ 的均匀单元离散化域 $[0, 1]$。节点位于 $x_j = j h$，其中 $j=0, 1, \\dots, N$。解 $u(x)$ 被一个全局连续的分段线性函数 $u_h(x) = \\sum_{j=0}^{N} U_j \\phi_j(x)$ 近似，其中 $\\phi_j(x)$ 是标准的线性“帽子”基函数，$U_j$ 是节点值。\n\n这导出一个线性方程组 $K \\mathbf{U} = \\mathbf{F}$，其中 $\\mathbf{U}$ 是节点值向量 $[U_0, U_1, \\dots, U_N]^T$。全局刚度矩阵 $K$ 的条目由单元刚度矩阵 $K^e$ 组装而成。对于一个单元 $e = [x_k, x_{k+1}]$，局部刚度矩阵由以下公式给出：\n$$\nK^e_{ij} = \\int_{x_k}^{x_{k+1}} a(x) \\frac{d\\phi_i}{dx} \\frac{d\\phi_j}{dx} dx\n$$\n由于线性基函数的导数在单元上是常数（$\\pm 1/h$），这可以简化。\n- 对于 $a(x)$ 为常数（$a^{-}$ 或 $a^{+}$）的单元，积分为 $\\int_{x_k}^{x_{k+1}} a(x) dx = a \\cdot h$。刚度矩阵为 $K^e = \\frac{a}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$。\n- 对于包含界面 $x_{\\mathrm{I}}$ 的“切割”单元，子段长度为 $\\ell_{-} = x_{\\mathrm{I}} - x_k$ 和 $\\ell_{+} = x_{k+1} - x_{\\mathrm{I}}$，积分为 $\\int_{x_k}^{x_{k+1}} a(x) dx = a^{-}\\ell_{-} + a^{+}\\ell_{+}$。在指定的精确积分下，刚度矩阵为 $K^e = \\frac{a^{-}\\ell_{-} + a^{+}\\ell_{+}}{h^2} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$。\n\n组装完全局 $(N+1) \\times (N+1)$ 矩阵 $K$后，我们施加边界条件 $U_0 = 0$ 和 $U_N = 1$。这将系统简化为针对内部节点值 $U_1, \\dots, U_{N-1}$ 的 $(N-1) \\times (N-1)$ 系统，然后求解该系统。\n\n一旦找到节点解 $\\mathbf{U}$，我们确定切割单元 $[x_k, x_{k+1}]$。FEM 解 $u_h(x)$ 在此单元上的斜率是常数，由 $c_1 = (U_{k+1} - U_k)/h$ 给出。通量 $a(x) u_h'(x)$ 在 $x_{\\mathrm{I}}$ 处不连续。标准 FEM 解的通量跳跃为：\n$$\nJ_{\\mathrm{FE}} = \\left| a^{-}c_1 - a^{+}c_1 \\right| = \\left| (a^{-} - a^{+}) c_1 \\right|\n$$\n\n**2. 基于残差的气泡修正和通量跳跃 $J_{\\mathrm{bub}}$**\n\n气泡函数法在切割单元内引入对 FEM 解的局部修正 $b(x)$，$u_h^{\\mathrm{bub}}(x) = u_h(x) + b(x)$，使得修正后的通量是连续的。气泡函数 $b(x)$ 被定义为在单元节点处为零，$b(x_k)=b(x_{k+1})=0$。它在子段 $[x_k, x_{\\mathrm{I}}]$ 和 $[x_{\\mathrm{I}}, x_{k+1}]$ 上是分段线性的，斜率分别为 $\\beta_{-}$ 和 $-\\beta_{+}$。\n\n两个条件决定了 $\\beta_{-}$ 和 $\\beta_{+}$：\n1. 气泡函数在界面处的连续性：$b(x_{\\mathrm{I}})$ 必须是连续的。这意味着 $\\beta_{-}\\ell_{-} = \\beta_{+}\\ell_{+}$。\n2. 修正后通量在界面处的连续性：$a^{-}(c_1 + \\beta_{-}) = a^{+}(c_1 - \\beta_{+})$。\n\n这两个条件构成了一个关于 $(\\beta_{-}, \\beta_{+})$ 的 $2 \\times 2$ 线性系统：\n$$\n\\begin{pmatrix} a^{-}  a^{+} \\\\ \\ell_{-}  -\\ell_{+} \\end{pmatrix} \\begin{pmatrix} \\beta_{-} \\\\ \\beta_{+} \\end{pmatrix} = \\begin{pmatrix} c_1(a^{+} - a^{-}) \\\\ 0 \\end{pmatrix}\n$$\n求解该系统得到 $\\beta_{-}$ 和 $\\beta_{+}$。气泡修正解的通量跳跃定义为：\n$$\nJ_{\\mathrm{bub}} = \\left| a^{-}(c_1 + \\beta_{-}) - a^{+}(c_1 - \\beta_{+}) \\right|\n$$\n根据构造，绝对值内的项为零。实现将计算此值作为验证，预期其在数值上为零。\n\n**3. XFEM 丰富和通量跳跃 $J_{\\mathrm{XFEM}}$**\n\nXFEM 方法丰富了切割单元上的近似空间，以允许梯度不连续。在 $[x_k, x_{k+1}]$ 上的解 $u^{\\mathrm{XFEM}}(x)$ 由两个具有不同斜率 $s_{-}$ 和 $s_{+}$ 的线性段组成。\n\n两个条件决定了 $s_{-}$ 和 $s_{+}$：\n1. 符合节点值：单元上的总位移变化必须与 FEM 解的节点值相匹配。$s_{-}\\ell_{-} + s_{+}\\ell_{+} = \\Delta U = U_{k+1}-U_k = c_1 h$。\n2. 连续通量（来自能量最小化）：在丰富单元上的弱形式自然导出条件 $a^{-}s_{-} = a^{+}s_{+}$。\n\n常数通量 $C = a^{-}s_{-} = a^{+}s_{+}$ 可以通过求解这个系统找到。问题陈述提供了直接公式：\n$$\nC = \\Delta U \\left( \\frac{\\ell_{-}}{a^{-}} + \\frac{\\ell_{+}}{a^{+}} \\right)^{-1}\n$$\n由此可得 $s_{-} = C/a^{-}$ 和 $s_{+} = C/a^{+}$。XFEM 解的通量跳跃为：\n$$\nJ_{\\mathrm{XFEM}} = \\left| a^{-}s_{-} - a^{+}s_{+} \\right|\n$$\n根据构造，这个值也为零。我们的实现将计算此值以进行确认。\n\n提供的 Python 代码为每个指定的测试用例实现了这三种不同的计算。一个特殊的检查处理了界面与网格节点重合的情况，在这种情况下，所有跳跃都定义为零。", "answer": "```python\nimport numpy as np\n\ndef _calculate_jumps(N, xI, a_minus, a_plus):\n    \"\"\"\n    Computes the flux jumps J_FE, J_bub, and J_XFEM for a given problem setup.\n\n    Args:\n        N (int): Number of elements in the mesh.\n        xI (float): Location of the interface.\n        a_minus (float): Diffusion coefficient for x  xI.\n        a_plus (float): Diffusion coefficient for x > xI.\n\n    Returns:\n        list: A list containing [J_FE, J_bub, J_XFEM].\n    \"\"\"\n    h = 1.0 / N\n    nodes = np.linspace(0, 1, N + 1)\n\n    # If the interface coincides with a node, all jumps are 0 by definition.\n    is_on_node = any(np.isclose(xI, node_pos) for node_pos in nodes)\n    if is_on_node:\n        return [0.0, 0.0, 0.0]\n\n    # Find the element that contains the interface\n    k_cut = -1\n    for k in range(N):\n        if nodes[k]  xI and xI  nodes[k + 1]:\n            k_cut = k\n            break\n    \n    if k_cut == -1:\n        # This case should not be reached with the given test data.\n        raise ValueError(\"Interface location is not within any element.\")\n\n    # 1. Standard FEM solution\n    # Assemble the global stiffness matrix K\n    K = np.zeros((N + 1, N + 1))\n    for k in range(N):\n        k_local = np.array([[1, -1], [-1, 1]])\n        \n        if k == k_cut:\n            l_minus = xI - nodes[k]\n            l_plus = nodes[k + 1] - xI\n            a_integrated = a_minus * l_minus + a_plus * l_plus\n            stiffness_factor = a_integrated / (h * h)\n        elif nodes[k + 1] = xI:\n            stiffness_factor = a_minus / h\n        else:  # nodes[k] >= xI\n            stiffness_factor = a_plus / h\n        \n        K[k:k + 2, k:k + 2] += stiffness_factor * k_local\n\n    # Apply boundary conditions u(0)=0, u(1)=1 to solve for interior nodes\n    K_interior = K[1:N, 1:N]\n    b = np.zeros(N - 1)\n    # The last equation is modified by the boundary condition u(N)=1\n    b[-1] = -K[N - 1, N]  # Since u_N = 1\n\n    u_interior = np.linalg.solve(K_interior, b)\n    u_h = np.concatenate(([0], u_interior, [1]))\n\n    # Compute the flux jump J_FE\n    u_k = u_h[k_cut]\n    u_k_plus_1 = u_h[k_cut + 1]\n    c1 = (u_k_plus_1 - u_k) / h\n    J_FE = np.abs((a_minus - a_plus) * c1)\n    \n    # 2. Residual-based bubble function correction\n    # J_bub should be 0 by construction. We compute it explicitly for verification.\n    l_minus_cut = xI - nodes[k_cut]\n    l_plus_cut = nodes[k_cut + 1] - xI\n    \n    # Solve for bubble slopes beta_minus and beta_plus\n    A_beta = np.array([[a_minus, a_plus], [l_minus_cut, -l_plus_cut]])\n    b_beta = np.array([c1 * (a_plus - a_minus), 0])\n    \n    beta_minus, beta_plus = np.linalg.solve(A_beta, b_beta)\n\n    flux_minus_bub = a_minus * (c1 + beta_minus)\n    flux_plus_bub = a_plus * (c1 - beta_plus)\n    J_bub = np.abs(flux_minus_bub - flux_plus_bub)\n\n    # 3. XFEM enrichment\n    # J_XFEM should be 0 by construction. We compute it explicitly for verification.\n    delta_u = u_k_plus_1 - u_k\n    \n    # The constant flux C is derived from energy minimization\n    harmonic_avg_term = l_minus_cut / a_minus + l_plus_cut / a_plus\n    C = delta_u / harmonic_avg_term\n    \n    # Slopes s_minus and s_plus are determined by C\n    s_minus = C / a_minus\n    s_plus = C / a_plus\n    \n    flux_minus_xfem = a_minus * s_minus\n    flux_plus_xfem = a_plus * s_plus\n    J_XFEM = np.abs(flux_minus_xfem - flux_plus_xfem)\n\n    return [J_FE, J_bub, J_XFEM]\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        (4, 0.37, 1.0, 10.0),\n        (8, 0.126, 5.0, 0.5),\n        (5, 0.399, 2.0, 3.0),\n        (10, 0.6, 7.0, 1.0),\n        (3, 0.5, 1.0, 1000.0)\n    ]\n\n    results = []\n    for case in test_cases:\n        N, xI, a_minus, a_plus = case\n        jumps = _calculate_jumps(N, xI, a_minus, a_plus)\n        results.append(jumps)\n\n    # Format the final output string to match the problem specification\n    # e.g., [[J1,J2,J3],[J4,J5,J6]]\n    output_str = repr(results).replace(' ', '')\n    print(output_str)\n\nsolve()\n```", "id": "3460319"}]}