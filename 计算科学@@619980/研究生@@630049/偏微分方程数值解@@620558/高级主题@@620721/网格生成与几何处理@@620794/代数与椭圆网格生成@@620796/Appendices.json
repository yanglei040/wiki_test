{"hands_on_practices": [{"introduction": "代数网格生成方法因其直接和高效而成为计算流体力学中的基础工具。其中，双线性插值是一种生成四边形区域网格的经典技术。然而，网格的质量，特别是坐标线的正交性，对数值模拟的精度和稳定性至关重要。这项练习将引导您从第一性原理出发，推导物理域的几何形状（一个倾斜的四边形）如何影响网格内部的正交性，通过[@problem_id:3362194]的计算，您将定量地理解边界变形如何转化为内部网格的扭曲。", "problem": "考虑一个从坐标为 $(\\xi,\\eta)\\in[0,1]\\times[0,1]$ 的计算单位正方形到一个凸物理四边形的双线性代数映射。该四边形的顶点按逆时针顺序为 $\\mathbf{P}_{1}=(0,0)$, $\\mathbf{P}_{2}=(L,0)$, $\\mathbf{P}_{3}=(L+s,H)$ 和 $\\mathbf{P}_{4}=(0,H)$，其中 $L>0$, $H>0$ 且 $|s|<L$。请计算在计算域中心点 $(\\xi, \\eta) = (1/2, 1/2)$ 处，网格线切向量 $\\mathbf{x}_\\xi$ 和 $\\mathbf{x}_\\eta$ 之间夹角 $\\theta$ 的余弦值 $\\cos(\\theta)$。", "solution": "该问题要求我们计算双线性插值网格在特定点的正交性度量。\n\n**第一步：写出双线性映射表达式**\n\n双线性插值将计算单位正方形 $(\\xi,\\eta)\\in[0,1]\\times[0,1]$ 映射到物理四边形。其通用公式为：\n$$\n\\mathbf{x}(\\xi, \\eta) = (1-\\xi)(1-\\eta)\\mathbf{P}_{1} + \\xi(1-\\eta)\\mathbf{P}_{2} + \\xi\\eta\\mathbf{P}_{3} + (1-\\xi)\\eta\\mathbf{P}_{4}\n$$\n代入给定的顶点坐标 $\\mathbf{P}_{1}=(0,0)$, $\\mathbf{P}_{2}=(L,0)$, $\\mathbf{P}_{3}=(L+s,H)$ 和 $\\mathbf{P}_{4}=(0,H)$：\n由于 $\\mathbf{P}_{1}=(0,0)$，第一项为零，公式简化为：\n$$\n\\mathbf{x}(\\xi, \\eta) = \\xi(1-\\eta)(L,0) + \\xi\\eta(L+s,H) + (1-\\xi)\\eta(0,H)\n$$\n我们将x和y分量分开：\n$$\nx(\\xi, \\eta) = L\\xi(1-\\eta) + (L+s)\\xi\\eta = L\\xi - L\\xi\\eta + L\\xi\\eta + s\\xi\\eta = \\xi(L+s\\eta)\n$$\n$$\ny(\\xi, \\eta) = H\\xi\\eta + H(1-\\xi)\\eta = H\\xi\\eta + H\\eta - H\\xi\\eta = H\\eta\n$$\n所以，映射为 $\\mathbf{x}(\\xi, \\eta) = (\\xi(L+s\\eta), H\\eta)$。\n\n**第二步：计算切向量**\n\n网格线是 $\\xi=const$ 和 $\\eta=const$ 的曲线。其切向量通过对 $\\xi$ 和 $\\eta$ 求偏导数得到：\n$$\n\\mathbf{x}_\\xi(\\xi, \\eta) = \\frac{\\partial\\mathbf{x}}{\\partial\\xi} = (L+s\\eta, 0)\n$$\n$$\n\\mathbf{x}_\\eta(\\xi, \\eta) = \\frac{\\partial\\mathbf{x}}{\\partial\\eta} = (s\\xi, H)\n$$\n\n**第三步：在中心点 $(\\xi, \\eta) = (1/2, 1/2)$ 求值**\n\n将 $\\xi=1/2$ 和 $\\eta=1/2$ 代入切向量表达式：\n$$\n\\mathbf{x}_\\xi(1/2, 1/2) = (L+s/2, 0)\n$$\n$$\n\\mathbf{x}_\\eta(1/2, 1/2) = (s/2, H)\n$$\n\n**第四步：计算夹角的余弦**\n\n两个向量 $\\mathbf{a}$ 和 $\\mathbf{b}$ 之间夹角 $\\theta$ 的余弦由公式 $\\cos(\\theta) = \\frac{\\mathbf{a} \\cdot \\mathbf{b}}{|\\mathbf{a}| |\\mathbf{b}|}$ 给出。\n首先计算点积：\n$$\n\\mathbf{x}_\\xi \\cdot \\mathbf{x}_\\eta = (L+s/2) \\cdot (s/2) + 0 \\cdot H = \\frac{s(L+s/2)}{2}\n$$\n然后计算各自的模：\n$$\n|\\mathbf{x}_\\xi| = \\sqrt{(L+s/2)^2 + 0^2} = |L+s/2|\n$$\n由于 $L>0$ 且 $|s|<L$，可以保证 $L+s/2 > 0$，所以 $|\\mathbf{x}_\\xi| = L+s/2$。\n$$\n|\\mathbf{x}_\\eta| = \\sqrt{(s/2)^2 + H^2} = \\sqrt{\\frac{s^2}{4} + H^2} = \\frac{1}{2}\\sqrt{s^2 + 4H^2}\n$$\n最后，计算 $\\cos(\\theta)$：\n$$\n\\cos(\\theta) = \\frac{\\frac{s(L+s/2)}{2}}{(L+s/2) \\cdot \\frac{1}{2}\\sqrt{s^2 + 4H^2}} = \\frac{s}{\\sqrt{s^2 + 4H^2}}\n$$\n这个结果就是所求的夹角余弦值，它量化了在四边形中心由于倾斜参数 $s$ 引起的网格非正交程度。当 $s=0$ 时，$\\cos(\\theta)=0$，网格在该点是正交的。", "answer": "$$\\boxed{\\frac{s}{\\sqrt{s^{2} + 4H^{2}}}}$$", "id": "3362194"}, {"introduction": "在掌握了如何分析给定网格的质量后，我们进入一个更高级也更具挑战性的主题：如何设计并生成满足特定属性的网格。椭圆方法通过求解偏微分方程（PDE）来生成光滑的网格，而“反向问题”则更进一步：我们预先指定期望的网格单元尺寸分布（通过目标雅可比行列式 $J_{\\star}$ 体现），然后反解出生成该网格的坐标变换。[@problem_id:3362226]这项练习将展示如何通过线性化和亥姆霍兹分解，将这一复杂的设计问题转化为一个更易于处理的泊松方程系统，从而让您深入理解如何主动控制网格结构。", "problem": "考虑一个从坐标为 $(x,y)$ 的单连通物理域 $\\Omega \\subset \\mathbb{R}^{2}$ 到计算坐标 $(\\xi,\\eta)$ 的二维映射，该映射用于偏微分方程（PDE）数值解的椭圆网格生成。令 $\\boldsymbol{\\xi}(x,y) = (\\xi(x,y),\\eta(x,y))$ 表示从物理空间到计算空间的逆映射，并令逆雅可比行列式为 $J^{-1}(x,y) = \\det\\!\\left(\\nabla \\boldsymbol{\\xi}(x,y)\\right)$，其中 $\\nabla \\boldsymbol{\\xi}$ 是 $2\\times 2$ 的雅可比矩阵 $\\partial(\\xi,\\eta)/\\partial(x,y)$。\n\n要求您探究逆规定问题：给定一个光滑且严格为正的目标雅可比场 $J_{\\star}(x,y)>0$，推导一个关于辅助势的类泊松系统，该系统的解能得到 $(\\xi,\\eta)$，使得 $\\det\\!\\left(\\nabla \\boldsymbol{\\xi}\\right)^{-1} = J_{\\star}$ 近似到主阶成立，并分析相应的可解性约束（可积性条件）。\n\n从以下基本依据出发：\n- 光滑映射的雅可比行列式的定义及其在局部面积变化中的作用：对于任意子域 $U \\subset \\Omega$，$\\int_{U}\\det\\!\\left(\\nabla \\boldsymbol{\\xi}\\right)\\,\\mathrm{d}x\\,\\mathrm{d}y$ 等于 $\\boldsymbol{\\xi}(U)$ 在计算空间中的面积。\n- 围绕恒等映射的线性化：写出 $\\xi(x,y) = x + u(x,y)$ 和 $\\eta(x,y) = y + v(x,y)$，其中 $u$ 和 $v$ 足够光滑且 $|\\nabla u|+|\\nabla v|$ 很小。\n- 矢量场 $\\boldsymbol{w}=(u,v)$ 的二维 Helmholtz 分解：存在标量势 $p$ 和 $q$，使得 $\\boldsymbol{w} = \\nabla p + \\nabla^{\\perp}q$，其中 $\\nabla p = (p_{x},p_{y})$ 且 $\\nabla^{\\perp}q=(-q_{y},q_{x})$。\n\n任务：\n1. 在线性化拟设下，仅使用上述基本依据，为势 $(p,q)$ 推导一个类泊松系统，该系统强制 $\\det\\!\\left(\\nabla \\boldsymbol{\\xi}\\right)^{-1} \\approx J_{\\star}$ 在 $u$ 和 $v$ 的导数的一阶上成立，并简要解释 $q$ 在近共形性中的作用。您的系统必须用 $\\Delta p$ 和 $\\Delta q$ 表示，其中 $\\Delta$ 表示在 $\\Omega$ 上的拉普拉斯算子。\n2. 在 $\\partial\\Omega$ 上的周期性边界条件下，即当 $(\\xi,\\eta)$ 及其所有导数在环面 $\\Omega=[0,2\\pi]\\times[0,2\\pi]$ 上关于 $x$ 和 $y$ 都是 $2\\pi$-周期时，陈述并证明该系统的可解性（可积性）条件。\n3. 将您的推导应用于周期域 $\\Omega=[0,2\\pi]\\times[0,2\\pi]$ 上的特定目标场 $J_{\\star}(x,y) = 1 + \\alpha \\cos(x)\\cos(y)$，其中 $|\\alpha| \\ll 1$，并选择与您的可积性条件一致的最简单的近共形规定。计算 $\\xi(x,y)$ 和 $\\eta(x,y)$ 关于 $\\alpha$、$x$ 和 $y$ 的显式主阶表达式，忽略 $\\alpha^{2}$ 及更高阶的项。\n\n您的最终答案必须是 $(\\xi(x,y),\\eta(x,y))$ 对，作为一个单一的闭式解析表达式。无需四舍五入。如果您呈现多个表达式，请在最终答案中使用 LaTeX 的 $\\mathrm{pmatrix}$ 环境将它们写成单行。", "solution": "首先验证问题，以确保其在科学上合理、内容自洽且适定。\n\n### 第 1 步：提取已知条件\n- **映射：** $\\boldsymbol{\\xi}(x,y) = (\\xi(x,y), \\eta(x,y))$，从物理坐标 $(x,y)$ 到计算坐标 $(\\xi,\\eta)$。\n- **线性化拟设：** $\\xi(x,y) = x + u(x,y)$ 和 $\\eta(x,y) = y + v(x,y)$，其中位移场 $\\boldsymbol{w}=(u,v)$ 的一阶导数很小。\n- **Helmholtz 分解：** $\\boldsymbol{w} = \\nabla p + \\nabla^{\\perp}q$，这意味着 $u = p_x - q_y$ 且 $v = p_y + q_x$。这里，$\\nabla p = (p_x, p_y)$ 且 $\\nabla^{\\perp}q = (-q_y, q_x)$。\n- **目标条件：** $\\det(\\nabla \\boldsymbol{\\xi})^{-1} \\approx J_{\\star}(x,y)$，其中 $\\nabla \\boldsymbol{\\xi}$ 是雅可比矩阵 $\\frac{\\partial(\\xi,\\eta)}{\\partial(x,y)}$，而 $J_{\\star}(x,y)>0$ 是一个给定的光滑目标场。逆映射的雅可比行列式定义为 $J^{-1}(x,y) \\equiv \\det(\\nabla \\boldsymbol{\\xi})$。该条件可转换为 $J \\approx J_\\star$，其中 $J$ 是正向映射（从计算空间到物理空间）的雅可比行列式。\n- **任务 3 的特定情况：** $J_{\\star}(x,y) = 1 + \\alpha \\cos(x)\\cos(y)$，其中 $|\\alpha| \\ll 1$，在周期域 $\\Omega=[0,2\\pi]\\times[0,2\\pi]$ 上。最终表达式应忽略 $\\mathcal{O}(\\alpha^2)$ 阶的项。\n\n### 第 2 步：使用提取的已知条件进行验证\n该问题在矢量微积分、偏微分方程和数值网格生成领域是适定的且有科学依据的。这些定义虽然符号密集，但都明确且一致。线性化方法是一种标准的物理和数学技术。使用 Helmholtz 分解是恰当的。在给定条件 $|\\alpha| \\ll 1$ 下，目标函数 $J_\\star$ 是光滑且严格为正的。在周期域上的设定是一个标准的边界值问题（BVP）设置。因此，该问题被认为是有效的。\n\n### 第 3 步：推导和求解\n\n**任务 1：类泊松系统的推导**\n\n我们首先计算逆映射的雅可比矩阵 $\\nabla\\boldsymbol{\\xi}$ 的行列式。\n该映射由 $\\xi(x,y) = x + u(x,y)$ 和 $\\eta(x,y) = y + v(x,y)$ 给出。\n雅可比矩阵是：\n$$ \\nabla\\boldsymbol{\\xi} = \\begin{pmatrix} \\xi_x & \\xi_y \\\\ \\eta_x & \\eta_y \\end{pmatrix} = \\begin{pmatrix} 1 + u_x & u_y \\\\ v_x & 1 + v_y \\end{pmatrix} $$\n其行列式是：\n$$ \\det(\\nabla\\boldsymbol{\\xi}) = (1+u_x)(1+v_y) - u_y v_x = 1 + u_x + v_y + u_x v_y - u_y v_x $$\n问题要求在 $u$ 和 $v$ 的导数上近似到一阶。因此，我们忽略二次项 $u_x v_y$ 和 $u_y v_x$：\n$$ \\det(\\nabla\\boldsymbol{\\xi}) \\approx 1 + u_x + v_y = 1 + \\nabla \\cdot \\boldsymbol{w} $$\n其中 $\\boldsymbol{w} = (u,v)$。\n\n目标条件是 $\\det(\\nabla\\boldsymbol{\\xi})^{-1} \\approx J_{\\star}$，这意味着 $\\det(\\nabla\\boldsymbol{\\xi}) \\approx \\frac{1}{J_{\\star}}$。\n令 $\\det(\\nabla\\boldsymbol{\\xi})$ 的两个表达式相等，可得：\n$$ 1 + \\nabla \\cdot \\boldsymbol{w} \\approx \\frac{1}{J_{\\star}} \\implies \\nabla \\cdot \\boldsymbol{w} \\approx \\frac{1}{J_{\\star}} - 1 = \\frac{1 - J_{\\star}}{J_{\\star}} $$\n现在，我们将 Helmholtz 分解 $\\boldsymbol{w} = \\nabla p + \\nabla^{\\perp}q$ 代入散度表达式中。\n$\\boldsymbol{w}$ 的分量是 $u = p_x - q_y$ 和 $v = p_y + q_x$。\n散度 $\\nabla \\cdot \\boldsymbol{w}$ 是：\n$$ \\nabla \\cdot \\boldsymbol{w} = u_x + v_y = (p_x - q_y)_x + (p_y + q_x)_y = p_{xx} - q_{yx} + p_{yy} + q_{xy} $$\n假设势 $p$ 和 $q$ 足够光滑，以至混合偏导数相等（即 $q_{xy}=q_{yx}$），则上式可简化为：\n$$ \\nabla \\cdot \\boldsymbol{w} = p_{xx} + p_{yy} = \\Delta p $$\n其中 $\\Delta$ 是拉普拉斯算子。\n这得到了我们系统的第一个方程，即关于势 $p$ 的泊松方程：\n$$ \\Delta p = \\frac{1 - J_{\\star}(x,y)}{J_{\\star}(x,y)} $$\n为了得到关于 $(p,q)$ 的系统，我们必须指定一个关于 $q$ 的方程。这与近共形性要求有关。如果一个映射局部保角，则该映射是共形的。对于线性化映射，这近似等价于位移场 $\\boldsymbol{w}=(u,v)$ 满足类柯西-黎曼方程 $u_x=v_y$ 和 $u_y=-v_x$。\n让我们考虑位移场 $\\boldsymbol{w}$ 的旋度：\n$$ \\nabla \\times \\boldsymbol{w} = v_x - u_y = (p_y + q_x)_x - (p_x - q_y)_y = p_{yx} + q_{xx} - p_{xy} + q_{yy} = q_{xx} + q_{yy} = \\Delta q $$\n量 $\\nabla \\times \\boldsymbol{w}$ 度量了映射的局部无穷小旋转。一个严格共形的映射其网格线的局部旋转为零。因此，为了实现近共形性，很自然地要求位移场的旋转部分很小。最简单的规定是将其设为零，这意味着使位移场 $\\boldsymbol{w}$ 无旋。这给出了我们系统的第二个方程：\n$$ \\Delta q = 0 $$\n因此，得到的关于势 $(p,q)$ 的类泊松系统是：\n$$ \\Delta p = \\frac{1 - J_{\\star}(x,y)}{J_{\\star}(x,y)} $$\n$$ \\Delta q = 0 $$\n势 $q$ 控制位移场 $\\boldsymbol{w}$ 的螺线（无散）部分，这对应于局部旋转。设置 $\\Delta q=0$ 确保了位移场是无旋的（$\\nabla \\times \\boldsymbol{w}=0$），这是共形性的一个基本组成部分，并促进了网格正交性。\n\n**任务 2：可解性条件**\n\n我们分析在具有周期性边界条件的域 $\\Omega$ 上泊松方程 $\\Delta \\phi = F(x,y)$ 的可解性。通过在域上对两边进行积分并应用散度定理（或 Green 第二恒等式）：\n$$ \\iint_{\\Omega} \\Delta \\phi \\,dx\\,dy = \\oint_{\\partial\\Omega} (\\nabla\\phi) \\cdot \\boldsymbol{n} \\,dS $$\n其中 $\\boldsymbol{n}$ 是边界 $\\partial\\Omega$ 的外单位法向量。\n对于周期域 $\\Omega=[0,2\\pi]\\times[0,2\\pi]$，边界积分为：\n$$ \\int_0^{2\\pi} [\\phi_x(2\\pi,y) - \\phi_x(0,y)]\\,dy + \\int_0^{2\\pi} [\\phi_y(x,2\\pi) - \\phi_y(x,0)]\\,dx $$\n由于 $\\phi$ 的所有导数都满足周期性边界条件，我们有 $\\phi_x(2\\pi,y)=\\phi_x(0,y)$ 和 $\\phi_y(x,2\\pi)=\\phi_y(x,0)$。因此，边界积分为零。\n这导出了可解性（或可积性）条件，即所谓的 Fredholm 择一性：\n$$ \\iint_{\\Omega} F(x,y) \\,dx\\,dy = 0 $$\n将此条件应用于我们的系统：\n1.  对于方程 $\\Delta p = \\frac{1-J_{\\star}}{J_{\\star}}$，可解性条件是：\n    $$ \\iint_{\\Omega} \\frac{1 - J_{\\star}(x,y)}{J_{\\star}(x,y)} \\,dx\\,dy = 0 $$\n    该条件对给定的目标雅可比场 $J_{\\star}$ 施加了一个约束。\n2.  对于方程 $\\Delta q = 0$，源项是 $F(x,y) = 0$。条件 $\\iint_{\\Omega} 0 \\,dx\\,dy = 0$ 自然满足，因此 $q$ 的解总是存在的（相差一个相加常数）。\n\n**任务 3：应用于特定情况**\n\n给定在 $\\Omega=[0,2\\pi]\\times[0,2\\pi]$ 上的 $J_{\\star}(x,y) = 1 + \\alpha \\cos(x)\\cos(y)$，并且我们必须忽略 $\\mathcal{O}(\\alpha^2)$ 阶的项。\n$\\Delta p$ 方程的源项是 $F(x,y) = \\frac{1-J_{\\star}}{J_{\\star}} = \\frac{1 - (1 + \\alpha \\cos(x)\\cos(y))}{1 + \\alpha \\cos(x)\\cos(y))} = \\frac{-\\alpha \\cos(x)\\cos(y)}{1 + \\alpha \\cos(x)\\cos(y)}$。\n由于 $|\\alpha| \\ll 1$，我们可以使用几何级数 $1/(1+z) = 1 - z + z^2 - \\dots$ 来展开它：\n$$ F(x,y) = -\\alpha \\cos(x)\\cos(y) \\left(1 - \\alpha \\cos(x)\\cos(y) + \\mathcal{O}(\\alpha^2)\\right) = -\\alpha \\cos(x)\\cos(y) + \\mathcal{O}(\\alpha^2) $$\n按照指示，在 $\\alpha$ 上截断到一阶，偏微分方程组变为：\n$$ \\Delta p = -\\alpha \\cos(x)\\cos(y) $$\n$$ \\Delta q = 0 $$\n我们检查 $p$-方程的可解性条件：\n$$ \\iint_{\\Omega} -\\alpha \\cos(x)\\cos(y) \\,dx\\,dy = -\\alpha \\left(\\int_0^{2\\pi} \\cos(x)\\,dx\\right) \\left(\\int_0^{2\\pi} \\cos(y)\\,dy\\right) = -\\alpha \\cdot 0 \\cdot 0 = 0 $$\n条件得到满足。\n\n现在我们求解具有周期性边界条件的偏微分方程。\n在周期域上 $\\Delta q = 0$ 的解是任意常数 $q(x,y) = C_q$。由于位移场仅依赖于 $q$ 的导数，我们可以不失一般性地选择 $C_q = 0$。\n对于 $p$-方程，我们寻求形如 $p(x,y) = A \\cos(x)\\cos(y)$ 的特解。\n$$ \\Delta p = \\frac{\\partial^2}{\\partial x^2}(A \\cos(x)\\cos(y)) + \\frac{\\partial^2}{\\partial y^2}(A \\cos(x)\\cos(y)) $$\n$$ \\Delta p = -A \\cos(x)\\cos(y) - A \\cos(x)\\cos(y) = -2A \\cos(x)\\cos(y) $$\n与源项 $-2A \\cos(x)\\cos(y) = -\\alpha \\cos(x)\\cos(y)$ 比较，我们发现 $A = \\frac{\\alpha}{2}$。\n$p$ 的通解是 $p(x,y) = \\frac{\\alpha}{2} \\cos(x)\\cos(y) + C_p$，其中 $C_p$ 是一个常数（齐次解）。\n\n最后，我们计算位移场 $(u,v)$ 和映射 $(\\xi,\\eta)$。\n$$ u(x,y) = p_x - q_y = \\frac{\\partial}{\\partial x}\\left(\\frac{\\alpha}{2} \\cos(x)\\cos(y)\\right) - 0 = -\\frac{\\alpha}{2} \\sin(x)\\cos(y) $$\n$$ v(x,y) = p_y + q_x = \\frac{\\partial}{\\partial y}\\left(\\frac{\\alpha}{2} \\cos(x)\\cos(y)\\right) + 0 = -\\frac{\\alpha}{2} \\cos(x)\\sin(y) $$\n常数 $C_p$ 对位移场没有贡献。\n$\\xi(x,y)$ 和 $\\eta(x,y)$ 的主阶表达式是：\n$$ \\xi(x,y) = x + u(x,y) = x - \\frac{\\alpha}{2} \\sin(x)\\cos(y) $$\n$$ \\eta(x,y) = y + v(x,y) = y - \\frac{\\alpha}{2} \\cos(x)\\sin(y) $$\n这些表达式提供了在 $\\alpha$ 上到主阶所需的映射。", "answer": "$$ \\boxed{ \\begin{pmatrix} x - \\frac{\\alpha}{2} \\sin(x)\\cos(y) & y - \\frac{\\alpha}{2} \\cos(x)\\sin(y) \\end{pmatrix} } $$", "id": "3362226"}, {"introduction": "为了精确求解在特定区域具有剧烈变化的物理问题，我们需要使用“自适应网格”，即网格密度根据解的特性自动调整。这通常通过引入一个“监控函数”$\\mathbf{G}$ 到椭圆网格生成方程中来实现，该函数可以使网格线在需要高分辨率的区域变得密集。[@problem_id:3362190]这项练习是一项全面的计算实践，要求您为一个复杂的多块域实现一个有限体积求解器，处理非匹配网格界面和监控函数不连续带来的挑战。通过完成此练习，您将掌握在高级计算模拟中处理复杂几何和自适应网格生成的关键技术。", "problem": "考虑椭圆网格生成问题，其目的在于确定物理域 $\\Omega = [0,1]\\times[0,1]$ 上的两个计算坐标 $\\xi(x,y)$ 和 $\\eta(x,y)$。设存在一由 $x = 0.5$ 给出的内界面 $\\Gamma$，它将 $\\Omega$ 分割为两个矩形块 $\\Omega_L = [0,0.5]\\times[0,1]$ 和 $\\Omega_R = [0.5,1]\\times[0,1]$。设监控张量 $\\mathbf{G}(x,y)$ 是分段常数对角张量，且在 $\\Gamma$ 上不连续，具体规定如下：\n$$\n\\mathbf{G}(x,y) = \\begin{cases}\n\\mathrm{diag}(g_{x,L}, g_{y,L}), & (x,y) \\in \\Omega_L \\\\\n\\mathrm{diag}(g_{x,R}, g_{y,R}), & (x,y) \\in \\Omega_R\n\\end{cases}\n$$\n其中每个对角线元素都严格为正，因此 $\\mathbf{G}$ 是对称正定（SPD）的。网格将通过求解以下这对椭圆偏微分方程（PDE）来生成\n$$\n\\nabla\\cdot(\\mathbf{G}\\nabla \\xi) = 0,\\qquad \\nabla\\cdot(\\mathbf{G}\\nabla \\eta) = 0 \\quad \\text{in } \\Omega,\n$$\n并遵循与物理边界一致的计算线边界条件。对于 $\\xi$，在所有四个边上规定狄利克雷数据，\n$$\n\\xi(0,y) = 0,\\quad \\xi(1,y) = 1,\\quad \\xi(x,0)=x,\\quad \\xi(x,1)=x.\n$$\n对于 $\\eta$，规定\n$$\n\\eta(x,0) = 0,\\quad \\eta(x,1)=1,\\quad \\eta(0,y)=y,\\quad \\eta(1,y)=y.\n$$\n在内界面 $\\Gamma$ 两侧，连续公式要求满足以下界面条件\n$$\n\\llbracket \\xi \\rrbracket_{\\Gamma} = 0,\\quad \\llbracket \\eta \\rrbracket_{\\Gamma} = 0,\\quad \\llbracket \\mathbf{G}\\nabla \\xi\\cdot \\mathbf{n}\\rrbracket_{\\Gamma} = 0,\\quad \\llbracket \\mathbf{G}\\nabla \\eta\\cdot \\mathbf{n}\\rrbracket_{\\Gamma} = 0,\n$$\n其中 $\\mathbf{n}$ 是指向从 $\\Omega_L$ 到 $\\Omega_R$ 且垂直于 $\\Gamma$ 的单位法向量，$\\llbracket \\cdot \\rrbracket_{\\Gamma}$ 表示跨越 $\\Gamma$ 的跳跃值。由于 $\\Gamma$ 是垂直的，所以 $\\mathbf{n}=(1,0)^\\top$，且通量连续性涉及 $\\mathbf{G}$ 的 $g_x$ 项。\n\n使用两个均匀的、具有可能不匹配分辨率的块结构网格来离散化 $\\Omega_L$ 和 $\\Omega_R$：$\\Omega_L$ 中为 $N_{x,L}\\times N_y$，$\\Omega_R$ 中为 $N_{x,R}\\times N_y$，其中 $\\Delta x_L = 0.5/N_{x,L}$，$\\Delta x_R = 0.5/N_{x,R}$，且 $\\Delta y = 1/N_y$。使用基于散度定理和跨面法向通量守恒的单元中心有限体积法进行离散化。处理带有对角张量 $\\mathbf{G}$ 的扩散算子时，应使得跨越垂直面的法向通量仅取决于 $g_x$，而跨越水平面的法向通量仅取决于 $g_y$。在外部边界上，使用以面为中心的半单元距离施加狄利克雷数据。在内界面上，通过使用一个能正确考虑两侧两个半单元距离和不同法向监控值的面传输率来施加通量连续性。不得改变 $\\Gamma$ 或引入重叠；两个块必须仅通过跨越 $\\Gamma$ 的通量进行耦合。求解关于 $\\xi$ 和 $\\eta$ 的两个线性系统。\n\n求解后，分析离散解在界面 $\\Gamma$ 上对界面条件的满足程度。由于邻近 $\\Gamma$ 的单元中心与界面有半个单元的偏移，因此需通过从两侧进行的单边二阶界面重构来估计界面连续性误差和通量连续性误差。对于每个界面行索引 $j\\in\\{0,1,\\dots,N_y-1\\}$，设 $\\xi_{L}(j)$ 和 $\\xi_{L}^{-}(j)$ 表示最后和倒数第二个左侧单元的值，$\\xi_{R}(j)$ 和 $\\xi_{R}^{+}(j)$ 表示第一和第二个右侧单元的值。定义单边界面重构为\n$$\n\\xi_I^{L}(j) \\approx \\tfrac{3}{2}\\xi_L(j)-\\tfrac{1}{2}\\xi_L^{-}(j),\\qquad \\xi_I^{R}(j) \\approx \\tfrac{3}{2}\\xi_R(j)-\\tfrac{1}{2}\\xi_R^{+}(j),\n$$\n对 $\\eta$ 也做类似定义。将 $\\Gamma$ 上的近似法向通量定义为\n$$\n\\mathcal{F}_\\xi^{L}(j) \\approx -g_{x,L}\\frac{\\xi_I^{L}(j)-\\xi_L(j)}{\\Delta x_L/2},\\quad \\mathcal{F}_\\xi^{R}(j) \\approx -g_{x,R}\\frac{\\xi_R(j)-\\xi_I^{R}(j)}{\\Delta x_R/2},\n$$\n对 $\\eta$ 也做类似定义。然后将界面条件缺陷度量为\n$$\nE_{\\xi,\\mathrm{cont}} = \\max_j \\big|\\xi_I^{L}(j)-\\xi_I^{R}(j)\\big|,\\quad E_{\\xi,\\mathrm{flux}} = \\max_j \\big|\\mathcal{F}_\\xi^{L}(j)-\\mathcal{F}_\\xi^{R}(j)\\big|,\n$$\n$$\nE_{\\eta,\\mathrm{cont}} = \\max_j \\big|\\eta_I^{L}(j)-\\eta_I^{R}(j)\\big|,\\quad E_{\\eta,\\mathrm{flux}} = \\max_j \\big|\\mathcal{F}_\\eta^{L}(j)-\\mathcal{F}_\\eta^{R}(j)\\big|.\n$$\n\n实现一个完整的程序，该程序能够：\n- 按照规定构建两个块结构网格。\n- 使用对角分段常数监控张量 $\\mathbf{G}$ 和通量耦合界面，组装并求解关于 $\\xi$ 和 $\\eta$ 的两个有限体积线性系统。\n- 计算四个界面缺陷度量 $E_{\\xi,\\mathrm{cont}}$、$E_{\\xi,\\mathrm{flux}}$、$E_{\\eta,\\mathrm{cont}}$ 和 $E_{\\eta,\\mathrm{flux}}$。\n\n您的程序必须运行以下测试套件并输出汇总结果。\n\n测试套件：\n- 情况 $1$（基准，匹配块，各向同性监控张量）：$N_{x,L}=16$, $N_{x,R}=16$, $N_y=16$, $g_{x,L}=1$, $g_{y,L}=1$, $g_{x,R}=1$, $g_{y,R}=1$.\n- 情况 $2$（法向不匹配，各向异性交换）：$N_{x,L}=12$, $N_{x,R}=36$, $N_y=24$, $g_{x,L}=4$, $g_{y,L}=1$, $g_{x,R}=1$, $g_{y,R}=4$.\n- 情况 $3$（强不连续各向异性及分辨率跳跃）：$N_{x,L}=8$, $N_{x,R}=40$, $N_y=20$, $g_{x,L}=100$, $g_{y,L}=1$, $g_{x,R}=1$, $g_{y,R}=10$.\n\n最终输出格式：\n- 您的程序应生成单行输出，包含一个长度为 $3$ 的列表，其中每个元素是对应测试用例的四个浮点度量值的列表，顺序为 $\\big[E_{\\xi,\\mathrm{cont}},E_{\\xi,\\mathrm{flux}},E_{\\eta,\\mathrm{cont}},E_{\\eta,\\mathrm{flux}}\\big]$。输出必须包含在一对单独的方括号中，并以逗号分隔。例如：$[[a_1,b_1,c_1,d_1],[a_2,b_2,c_2,d_2],[a_3,b_3,c_3,d_3]]$。由于问题是完全无量纲的，因此不涉及物理单位。", "solution": "问题陈述是适定的且科学上是合理的。它描述了一个在双块域上的标准椭圆网格生成问题，其中界面上存在不连续的监控张量。这是偏微分方程（PDE）数值方法中的一个经典问题。我们将按照指定，使用单元中心有限体积法来构建一个解。\n\n问题的核心是求解计算坐标 $\\xi(x,y)$ 和 $\\eta(x,y)$ 的两个椭圆偏微分方程：\n$$\n\\nabla\\cdot\\big(\\mathbf{G}\\,\\nabla \\xi\\big) = 0\n$$\n$$\n\\nabla\\cdot\\big(\\mathbf{G}\\,\\nabla \\eta\\big) = 0\n$$\n其中 $\\mathbf{G}$ 是一个分段常数、对角、对称正定的张量。域 $\\Omega=[0,1]\\times[0,1]$ 被划分为 $\\Omega_L = [0,0.5]\\times[0,1]$ 和 $\\Omega_R = [0.5,1]\\times[0,1]$。\n\n求解方法包括对域和偏微分方程进行离散化，以形成一个线性代数方程组 $\\mathbf{A}\\mathbf{u}=\\mathbf{b}$，其中 $\\mathbf{u}$ 是未知单元中心值（$\\xi$ 或 $\\eta$）的向量。然后对该系统进行数值求解。矩阵 $\\mathbf{A}$ 和右侧向量 $\\mathbf{b}$ 的结构是通过对离散域中的每个单元应用散度定理得出的。对于一个通用单元 $P$，积分后的偏微分方程变成了一个通量守恒的陈述：\n$$\n\\sum_{f \\in \\partial P} \\int_f \\mathbf{F}\\cdot\\mathbf{n}\\,dS = 0\n$$\n其中 $\\mathbf{F} = -\\mathbf{G}\\nabla u$（$u$ 为 $\\xi$ 或 $\\eta$）是通量向量，求和是对单元的所有面进行的。\n\n我们的离散化使用了两个连接的均匀网格，一个用于 $\\Omega_L$，有 $N_{x,L} \\times N_y$ 个大小为 $\\Delta x_L \\times \\Delta y$ 的单元；另一个用于 $\\Omega_R$，有 $N_{x,R} \\times N_y$ 个大小为 $\\Delta x_R \\times \\Delta y$ 的单元。未知数的总数为 $(N_{x,L}+N_{x,R})\\times N_y$。我们将二维网格的未知数映射到线性系统的一维向量中。每个单元的方程将其值与其四个邻居（北、南、东、西）的值联系起来。这会产生一个稀疏带状矩阵 $\\mathbf{A}$。\n\n矩阵 $\\mathbf{A}$ 和向量 $\\mathbf{b}$ 的条目由跨单元面的“传输率”决定。两个相邻单元（例如 $P$ 和 $E$（东））之间的通量近似为 $F_{pe} = T_{pe} (u_P - u_E)$，其中 $T_{pe}$ 是传输率。\n\n对于 $\\Omega_L$ 或 $\\Omega_R$ 内的内部垂直面，传输率为 $T = g_x \\Delta y / \\Delta x$，其中 $g_x$ 和 $\\Delta x$ 是局部值。对于内部水平面，传输率为 $T = g_y \\Delta x / \\Delta y$。\n\n在外部边界上，施加狄利克雷条件。对于与单元 $P$ 相邻的边界 $b$，通量为 $F_{pb} = T_{pb}(u_P - u_b)$，其中 $u_b$ 是给定的边界值。到边界面是半个单元宽度，因此传输率例如对于垂直边界是 $T_{pb} = g_x \\Delta y / (\\Delta x/2)$。$T_{pb}u_P$ 项贡献于 $\\mathbf{A}$ 的对角线，而 $T_{pb}u_b$ 贡献于右侧向量 $\\mathbf{b}$。边界值 $u_b$ 由问题指定的函数在面中心坐标处求值确定。\n\n关键部分是在 $\\Omega_L$ 和 $\\Omega_R$ 之间的内界面 $\\Gamma$ 上的耦合。通量连续性条件 $\\llbracket \\mathbf{G}\\nabla u \\cdot \\mathbf{n} \\rrbracket_\\Gamma = 0$ 通过定义一个有效的界面传输率来强制执行。$\\Omega_L$ 中最后一个单元（单元 $L$）和 $\\Omega_R$ 中第一个单元（单元 $R$）之间的通量为 $F_{LR} = T_{LR}(u_L - u_R)$。传输率 $T_{LR}$ 是两侧属性的调和平均值，考虑了不同的网格间距和监控值：\n$$\nT_{LR} = \\frac{\\Delta y}{\\frac{\\Delta x_L/2}{g_{x,L}} + \\frac{\\Delta x_R/2}{g_{x,R}}}\n$$\n这种公式能正确模拟跨越非连续介质的连续通量。\n\n组装并求解两个独立的线性系统：一个用于 $\\xi$，另一个用于 $\\eta$。虽然两个系统的矩阵 $\\mathbf{A}$ 是相同的（因为它仅取决于网格和 $\\mathbf{G}$），但由于 $\\xi$ 和 $\\eta$ 的边界条件不同，右侧向量 $\\mathbf{b}$ 是不同的。\n\n在获得 $\\xi$ 和 $\\eta$ 的离散解后，我们评估解在界面 $\\Gamma$ 处的质量。由于单元中心不位于界面上，我们首先使用提供的二阶单边外插公式从两侧重构 $\\xi$ 和 $\\eta$ 在 $\\Gamma$ 上的值：\n$$\nu_I^{L}(j) = \\frac{3}{2}u_L(j) - \\frac{1}{2}u_L^{-}(j)\n$$\n$$\nu_I^{R}(j) = \\frac{3}{2}u_R(j) - \\frac{1}{2}u_R^{+}(j)\n$$\n连续性误差 $E_{u,\\mathrm{cont}}$ 是在所有界面位置 $j$ 上 $|u_I^L - u_I^R|$ 的最大绝对差。\n\n接下来，我们从两侧重构界面上的法向通量。左侧块在界面处的通量 $\\mathcal{F}_u^L(j)$ 和右侧的通量 $\\mathcal{F}_u^R(j)$ 使用给定的涉及重构界面值的有限差分近似来估计。例如，对于 $\\xi$：\n$$\n\\mathcal{F}_\\xi^L(j) = -g_{x,L} \\frac{\\xi_I^{L}(j) - \\xi_L(j)}{\\Delta x_L/2}\n$$\n$$\n\\mathcal{F}_\\xi^R(j) = -g_{x,R} \\frac{\\xi_R(j) - \\xi_I^{R}(j)}{\\Delta x_R/2}\n$$\n通量连续性误差 $E_{u,\\mathrm{flux}}$ 是界面上 $|\\mathcal{F}_u^L - \\mathcal{F}_u^R|$ 的最大绝对差。对每个测试用例计算这四个误差度量（$E_{\\xi,\\mathrm{cont}}$、$E_{\\xi,\\mathrm{flux}}$、$E_{\\eta,\\mathrm{cont}}$、$E_{\\eta,\\mathrm{flux}}$）。", "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csc_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the elliptic grid generation problem.\n    \"\"\"\n    test_cases = [\n        # Case 1 (baseline, matched blocks, isotropic monitor)\n        {'N_xL': 16, 'N_xR': 16, 'N_y': 16, 'g_xL': 1.0, 'g_yL': 1.0, 'g_xR': 1.0, 'g_yR': 1.0},\n        # Case 2 (nonmatching in the normal direction, anisotropy swaps)\n        {'N_xL': 12, 'N_xR': 36, 'N_y': 24, 'g_xL': 4.0, 'g_yL': 1.0, 'g_xR': 1.0, 'g_yR': 4.0},\n        # Case 3 (strongly discontinuous anisotropy and resolution jump)\n        {'N_xL': 8, 'N_xR': 40, 'N_y': 20, 'g_xL': 100.0, 'g_yL': 1.0, 'g_xR': 1.0, 'g_yR': 10.0},\n    ]\n\n    def _build_and_solve(variable_type, params):\n        \"\"\"\n        Builds and solves the finite-volume system for a single variable (xi or eta).\n        \"\"\"\n        N_xL, N_xR, N_y = params['N_xL'], params['N_xR'], params['N_y']\n        g_xL, g_yL, g_xR, g_yR = params['g_xL'], params['g_yL'], params['g_xR'], params['g_yR']\n\n        N_x = N_xL + N_xR\n        N_total = N_x * N_y\n        dx_L = 0.5 / N_xL\n        dx_R = 0.5 / N_xR\n        dy = 1.0 / N_y\n\n        A = lil_matrix((N_total, N_total), dtype=np.float64)\n        b = np.zeros(N_total, dtype=np.float64)\n\n        x_centers = np.zeros(N_x)\n        x_centers[:N_xL] = (np.arange(N_xL) + 0.5) * dx_L\n        x_centers[N_xL:] = 0.5 + (np.arange(N_xR) + 0.5) * dx_R\n        y_centers = (np.arange(N_y) + 0.5) * dy\n\n        T_interface = dy / (dx_L / (2.0 * g_xL) + dx_R / (2.0 * g_xR))\n\n        for j in range(N_y):\n            for i in range(N_x):\n                k = j * N_x + i\n                diag_sum = 0.0\n\n                # West face\n                if i == 0:  # West boundary\n                    T_w = g_xL * dy / (dx_L / 2.0)\n                    diag_sum += T_w\n                    bc_val = 0.0 if variable_type == 'xi' else y_centers[j]\n                    b[k] += T_w * bc_val\n                elif i == N_xL:  # Interface from right block\n                    k_w = k - 1\n                    diag_sum += T_interface\n                    A[k, k_w] = -T_interface\n                else:  # Internal face\n                    k_w = k - 1\n                    g_x_loc = g_xL if i  N_xL else g_xR\n                    dx_loc = dx_L if i  N_xL else dx_R\n                    T_w = g_x_loc * dy / dx_loc\n                    diag_sum += T_w\n                    A[k, k_w] = -T_w\n\n                # East face\n                if i == N_x - 1:  # East boundary\n                    T_e = g_xR * dy / (dx_R / 2.0)\n                    diag_sum += T_e\n                    bc_val = 1.0 if variable_type == 'xi' else y_centers[j]\n                    b[k] += T_e * bc_val\n                elif i == N_xL - 1:  # Interface from left block\n                    k_e = k + 1\n                    diag_sum += T_interface\n                    A[k, k_e] = -T_interface\n                else:  # Internal face\n                    k_e = k + 1\n                    g_x_loc = g_xL if i  N_xL else g_xR\n                    dx_loc = dx_L if i  N_xL else dx_R\n                    T_e = g_x_loc * dy / dx_loc\n                    diag_sum += T_e\n                    A[k, k_e] = -T_e\n\n                # South face\n                g_y_loc = g_yL if i  N_xL else g_yR\n                dx_cell = dx_L if i  N_xL else dx_R\n                if j == 0:  # South boundary\n                    T_s = g_y_loc * dx_cell / (dy / 2.0)\n                    diag_sum += T_s\n                    bc_val = x_centers[i] if variable_type == 'xi' else 0.0\n                    b[k] += T_s * bc_val\n                else:  # Internal face\n                    k_s = k - N_x\n                    T_s = g_y_loc * dx_cell / dy\n                    diag_sum += T_s\n                    A[k, k_s] = -T_s\n                \n                # North face\n                if j == N_y - 1:  # North boundary\n                    T_n = g_y_loc * dx_cell / (dy / 2.0)\n                    diag_sum += T_n\n                    bc_val = x_centers[i] if variable_type == 'xi' else 1.0\n                    b[k] += T_n * bc_val\n                else:  # Internal face\n                    k_n = k + N_x\n                    T_n = g_y_loc * dx_cell / dy\n                    diag_sum += T_n\n                    A[k, k_n] = -T_n\n                \n                A[k, k] = diag_sum\n        \n        A_csc = csc_matrix(A)\n        solution_vec = spsolve(A_csc, b)\n        solution_grid = solution_vec.reshape((N_y, N_x))\n\n        # Calculate interface errors\n        E_cont_vals, E_flux_vals = [], []\n        for j in range(N_y):\n            val_L = solution_grid[j, N_xL - 1]\n            val_L_minus = solution_grid[j, N_xL - 2]\n            val_R = solution_grid[j, N_xL]\n            val_R_plus = solution_grid[j, N_xL + 1]\n\n            val_I_L = 1.5 * val_L - 0.5 * val_L_minus\n            val_I_R = 1.5 * val_R - 0.5 * val_R_plus\n            E_cont_vals.append(np.abs(val_I_L - val_I_R))\n\n            Flux_L = -g_xL * (val_I_L - val_L) / (dx_L / 2.0)\n            Flux_R = -g_xR * (val_R - val_I_R) / (dx_R / 2.0)\n            E_flux_vals.append(np.abs(Flux_L - Flux_R))\n\n        E_cont = np.max(E_cont_vals)\n        E_flux = np.max(E_flux_vals)\n        \n        return E_cont, E_flux\n\n    all_results = []\n    for case_params in test_cases:\n        E_xi_cont, E_xi_flux = _build_and_solve('xi', case_params)\n        E_eta_cont, E_eta_flux = _build_and_solve('eta', case_params)\n        all_results.append([E_xi_cont, E_xi_flux, E_eta_cont, E_eta_flux])\n\n    # Final print statement must match the exact required format.\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```", "id": "3362190"}]}