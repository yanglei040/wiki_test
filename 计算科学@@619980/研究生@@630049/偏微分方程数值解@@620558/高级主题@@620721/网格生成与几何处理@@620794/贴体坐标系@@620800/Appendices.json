{"hands_on_practices": [{"introduction": "在将坐标变换用于数值模拟之前，我们必须确保其有效性。一个关键要求是网格单元不会重叠或翻转，如果变换的雅可比行列式在整个域中保持为正，则可以保证这一点。第一个练习 [@problem_id:3367212] 将引导你计算给定映射的雅可比行列式，并确定其参数需满足的条件，以确保变换是非退化的。这是网格生成中至关重要的第一步，它保证了计算网格在物理空间中不会发生折叠或自相交。", "problem": "考虑一个从计算域到物理域的二维贴体映射，这种映射常用于曲边几何上偏微分方程（PDEs）的数值求解。令计算坐标为 $(\\xi,\\eta)\\in[0,1]^{2}$，物理坐标 $(x,y)$ 由以下光滑变换定义：\n$$\nx(\\xi,\\eta)=\\xi+\\alpha\\,\\xi\\,\\eta,\\qquad y(\\xi,\\eta)=\\eta+\\beta\\,\\xi^{2},\n$$\n其中 $\\alpha$ 和 $\\beta$ 为实常数。该映射的雅可比行列式 $J(\\xi,\\eta)$ 定义为 $(x,y)$ 关于 $(\\xi,\\eta)$ 的偏导数所构成的 $2\\times 2$ 矩阵的行列式。$J$ 在 $[0,1]^{2}$ 上的正性是该映射保持定向且非退化（即网格单元不发生折叠）的必要条件。\n\n从坐标变换中雅可比行列式的基本定义出发，推导给定映射的 $J(\\xi,\\eta)$，并确定参数 $(\\alpha,\\beta)$ 的范围，以确保对所有 $(\\xi,\\eta)\\in[0,1]^{2}$ 都有 $J(\\xi,\\eta)>0$。您的推导必须从第一性原理出发，并为证明整个正方形区域上正性所需的最小化过程中的每一步提供理由。\n\n答案规格：\n- 仅用 $\\alpha$ 和 $\\beta$ 将 $J(\\xi,\\eta)$ 在 $[0,1]^{2}$ 上的最小值表示为单个闭式解析表达式。该表达式通过要求其最小值为严格正数来表征 $J>0$ 的正性条件。\n- 最终答案中不应包含不等式或方程。\n- 无需单位。无需四舍五入。", "solution": "问题在于确定参数 $(\\alpha, \\beta)$ 的范围，使得给定坐标变换的雅可比行列式 $J(\\xi, \\eta)$ 在计算域 $(\\xi, \\eta) \\in [0, 1]^2$ 上严格为正。这等价于找到 $J(\\xi, \\eta)$ 在此域上的全局最小值，并要求该值大于零。问题明确要求给出该最小值的解析表达式。\n\n首先，我们定义从计算坐标 $(\\xi, \\eta)$ 到物理坐标 $(x, y)$ 的变换的雅可比矩阵。该变换由以下公式给出：\n$$\nx(\\xi, \\eta) = \\xi + \\alpha \\xi \\eta \\\\\ny(\\xi, \\eta) = \\eta + \\beta \\xi^2\n$$\n雅可比矩阵 $\\mathbf{J}$ 定义为：\n$$\n\\mathbf{J}(\\xi, \\eta) = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix}\n$$\n我们计算所需的偏导数：\n$$\n\\frac{\\partial x}{\\partial \\xi} = \\frac{\\partial}{\\partial \\xi} (\\xi + \\alpha \\xi \\eta) = 1 + \\alpha \\eta \\\\\n\\frac{\\partial x}{\\partial \\eta} = \\frac{\\partial}{\\partial \\eta} (\\xi + \\alpha \\xi \\eta) = \\alpha \\xi \\\\\n\\frac{\\partial y}{\\partial \\xi} = \\frac{\\partial}{\\partial \\xi} (\\eta + \\beta \\xi^2) = 2 \\beta \\xi \\\\\n\\frac{\\partial y}{\\partial \\eta} = \\frac{\\partial}{\\partial \\eta} (\\eta + \\beta \\xi^2) = 1\n$$\n因此，雅可比行列式 $J(\\xi, \\eta) = \\det(\\mathbf{J})$ 为：\n$$\nJ(\\xi, \\eta) = \\left(\\frac{\\partial x}{\\partial \\xi}\\right) \\left(\\frac{\\partial y}{\\partial \\eta}\\right) - \\left(\\frac{\\partial x}{\\partial \\eta}\\right) \\left(\\frac{\\partial y}{\\partial \\xi}\\right)\n$$\n代入偏导数，我们得到：\n$$\nJ(\\xi, \\eta) = (1 + \\alpha \\eta)(1) - (\\alpha \\xi)(2 \\beta \\xi) = 1 + \\alpha \\eta - 2 \\alpha \\beta \\xi^2\n$$\n我们的任务是找到该函数在紧致域 $[0,1]^2 = \\{(\\xi, \\eta) \\mid 0 \\le \\xi \\le 1, 0 \\le \\eta \\le 1\\}$ 上的最小值 $J_{min}$。\n\n$J(\\xi, \\eta)$ 的表达式是关于 $\\xi$ 和 $\\eta$ 的多项式，因此在闭有界域 $[0,1]^2$ 上是连续的。根据极值定理，全局最小值一定存在，且必定在域的内部 $(0,1)^2$ 的一个临界点上或在其边界上取到。\n\n$J$ 关于 $\\xi$ 和 $\\eta$ 的偏导数是：\n$$\n\\frac{\\partial J}{\\partial \\xi} = -4 \\alpha \\beta \\xi \\\\\n\\frac{\\partial J}{\\partial \\eta} = \\alpha\n$$\n对于内部临界点，我们需要 $\\frac{\\partial J}{\\partial \\eta} = 0$，这意味着 $\\alpha = 0$。如果 $\\alpha=0$，那么对所有的 $(\\xi, \\eta)$ 都有 $J(\\xi, \\eta) = 1$，其最小值为 $1$。在 $\\alpha \\neq 0$ 的情况下，域内部没有临界点。因此，$J(\\xi, \\eta)$ 的最小值必须在正方形 $[0,1]^2$ 的边界上取到。\n\n一个更直接的方法是分析 $J(\\xi, \\eta) = 1 + \\alpha \\eta - 2 \\alpha \\beta \\xi^2$ 的结构。让我们定义新变量 $u = \\eta$ 和 $v = \\xi^2$。当 $(\\xi, \\eta)$ 遍历区域 $[0,1]^2$ 时，点 $(u, v)$ 也遍历单位正方形 $[0,1]^2$。用这些新变量表示，雅可比行列式变成一个线性函数：\n$$\nL(u, v) = 1 + \\alpha u - 2 \\alpha \\beta v\n$$\n问题转化为求线性函数 $L(u,v)$ 在单位正方形 $(u,v) \\in [0,1]^2$ 上的最小值。线性函数在凸多边形上的最小值（和最大值）必定在其顶点之一处取得。$(u,v)$-平面中单位正方形的顶点是 $(0,0)$, $(1,0)$, $(0,1)$ 和 $(1,1)$。\n\n我们计算 $L(u,v)$ 在这四个顶点处的值：\n\\begin{enumerate}\n    \\item 在 $(u,v) = (0,0)$ 处（对应于 $(\\xi,\\eta)=(0,0)$）：$L(0,0) = 1$。\n    \\item 在 $(u,v) = (1,0)$ 处（对应于 $(\\xi,\\eta)=(0,1)$）：$L(1,0) = 1 + \\alpha$。\n    \\item 在 $(u,v) = (0,1)$ 处（对应于 $(\\xi,\\eta)=(1,0)$）：$L(0,1) = 1 - 2 \\alpha \\beta$。\n    \\item 在 $(u,v) = (1,1)$ 处（对应于 $(\\xi,\\eta)=(1,1)$）：$L(1,1) = 1 + \\alpha - 2 \\alpha \\beta$。\n\\end{enumerate}\n$J(\\xi, \\eta)$ 在 $[0,1]^2$ 上的全局最小值是这四个值中的最小值：\n$$\nJ_{min} = \\min \\{1, 1+\\alpha, 1-2\\alpha\\beta, 1+\\alpha-2\\alpha\\beta\\}\n$$\n这个表达式可以简化为单一的闭式解析表达式。我们可以对各项进行分组：\n$$\nJ_{min} = \\min \\left( \\min\\{1, 1+\\alpha\\}, \\min\\{1-2\\alpha\\beta, 1+\\alpha-2\\alpha\\beta\\} \\right)\n$$\n第一个内部最小值为 $\\min\\{1, 1+\\alpha\\} = 1 + \\min\\{0, \\alpha\\}$。第二个内部最小值为 $\\min\\{1-2\\alpha\\beta, (1-2\\alpha\\beta)+\\alpha\\} = 1-2\\alpha\\beta + \\min\\{0, \\alpha\\}$。因此，表达式变为：\n$$\nJ_{min} = \\min \\left( 1 + \\min\\{0, \\alpha\\}, 1-2\\alpha\\beta + \\min\\{0, \\alpha\\} \\right)\n$$\n提取公因子 $1 + \\min\\{0, \\alpha\\}$ 得到：\n$$\nJ_{min} = 1 + \\min\\{0, \\alpha\\} + \\min\\{0, -2\\alpha\\beta\\}\n$$\n为用初等函数和绝对值表示，我们使用恒等式 $\\min\\{0, x\\} = \\frac{x - |x|}{2}$ 和 $|xy| = |x||y|$。\n$$\n\\min\\{0, \\alpha\\} = \\frac{\\alpha - |\\alpha|}{2}\n$$\n$$\n\\min\\{0, -2\\alpha\\beta\\} = \\frac{-2\\alpha\\beta - |-2\\alpha\\beta|}{2} = \\frac{-2\\alpha\\beta - 2|\\alpha\\beta|}{2} = - \\alpha\\beta - |\\alpha\\beta|\n$$\n将这些代入 $J_{min}$ 的表达式中：\n$$\nJ_{min} = 1 + \\frac{\\alpha - |\\alpha|}{2} - \\alpha\\beta - |\\alpha\\beta|\n$$\n这就是在指定域上雅可比行列式最小值的单一闭式解析表达式。一个有效、非退化的映射的条件是 $J_{min} > 0$。", "answer": "$$\n\\boxed{1 + \\frac{\\alpha - |\\alpha|}{2} - \\alpha\\beta - |\\alpha\\beta|}\n$$", "id": "3367212"}, {"introduction": "一旦我们有了有效的网格，就需要在其上进行计算，例如对物理量在网格单元上进行积分。这通常通过将积分变换到标准的参考单元上来完成，这个过程涉及到雅可比行列式。接下来的练习 [@problem_id:3367230] 将探讨几何映射的复杂性（以其多项式次数为特征）和被积函数如何共同决定了精确积分所需的高斯求积点数。这个练习揭示了在有限元等方法中，几何与数值精度之间的深刻联系，是理解数值误差来源的关键。", "problem": "考虑一个二维曲边四边形单元 $\\mathcal{K}$，它由参考正方形 $\\widehat{\\mathcal{K}}=[-1,1]^{2}$ 通过一个等参张量积多项式映射 $\\boldsymbol{F}:\\widehat{\\mathcal{K}}\\to \\mathcal{K}$ 得到。在每个参考坐标方向上，该映射的次数为 $k\\geq 1$。也就是说，$\\boldsymbol{F}(\\boldsymbol{\\xi})$ 的每个分量都是关于 $\\xi_{1}$ 次数至多为 $k$、关于 $\\xi_{2}$ 次数至多为 $k$ 的多项式，其中 $\\boldsymbol{\\xi}=(\\xi_{1},\\xi_{2})$。设 $f:\\mathbb{R}^{2}\\to\\mathbb{R}$ 是物理坐标 $(x,y)$ 下的任意多项式，其总次数至多为 $p\\geq 0$。精确的单元积分为\n$$\nI=\\int_{\\mathcal{K}} f(x,y)\\,\\mathrm{d}x\\,\\mathrm{d}y.\n$$\n根据变量替换定理，令 $\\boldsymbol{x}=\\boldsymbol{F}(\\boldsymbol{\\xi})$，雅可比行列式为 $J(\\boldsymbol{\\xi})=\\det\\left(\\frac{\\partial(x,y)}{\\partial(\\xi_{1},\\xi_{2})}\\right)$，该积分可以在 $\\widehat{\\mathcal{K}}$ 上表示为\n$$\nI=\\int_{-1}^{1}\\int_{-1}^{1} \\big(f\\circ \\boldsymbol{F}\\big)(\\xi_{1},\\xi_{2})\\,J(\\xi_{1},\\xi_{2})\\,\\mathrm{d}\\xi_{2}\\,\\mathrm{d}\\xi_{1}.\n$$\n您将使用每个参考方向上具有 $N$ 个点的张量积高斯-勒让德求积来近似 $I$：\n$$\nQ_{N}=\\sum_{i=1}^{N}\\sum_{j=1}^{N} w_{i}\\,w_{j}\\,\\big(f\\circ \\boldsymbol{F}\\big)(\\xi_{i},\\eta_{j})\\,J(\\xi_{i},\\eta_{j}),\n$$\n其中 $\\{(\\xi_{i},w_{i})\\}_{i=1}^{N}$ 是在 $[-1,1]$ 上 $\\xi_{1}$ 方向的 $N$ 点高斯-勒让德节点和权重，而 $\\{(\\eta_{j},w_{j})\\}_{j=1}^{N}$ 是 $\\xi_{2}$ 方向上相应的节点和权重。\n\n从变量替换原理以及一维高斯-勒让德求积及其张量积扩展的既定次数精确性性质出发，确定每个方向所需的最少求积点数 $N_{\\min}$（表示为 $p$ 和 $k$ 的显式解析表达式），以保证对于 $\\mathcal{K}$ 上所有总次数至多为 $p$ 的物理坐标多项式 $f(x,y)$，$Q_{N}$ 都是精确的，即 $Q_{N}=I$。\n\n请清楚地说明您在等参映射及其雅可比行列式下，对多项式的复合与乘积所引用的任何次数界。您的最终答案必须是关于 $p$ 和 $k$ 的单个闭式解析表达式 $N_{\\min}$（无需数值计算，也不涉及单位）。", "solution": "该问题是有效的，因为它科学地基于数值分析的原理，特别是有限元方法中的数值求积，并且是适定的、客观的和完整的。\n\n任务是确定在参考正方形 $\\widehat{\\mathcal{K}}=[-1,1]^{2}$ 上每个方向所需的高斯-勒让德求积点的最小数量 $N_{\\min}$，以保证积分 $I=\\int_{\\mathcal{K}} f(\\boldsymbol{x})\\,\\mathrm{d}\\boldsymbol{x}$ 的精确计算。\n\n该积分通过映射 $\\boldsymbol{x} = \\boldsymbol{F}(\\boldsymbol{\\xi})$ 变换到参考单元 $\\widehat{\\mathcal{K}}$，其中 $\\boldsymbol{x}=(x,y)$ 且 $\\boldsymbol{\\xi}=(\\xi_1, \\xi_2)$。变换后的积分为：\n$$\nI = \\int_{-1}^{1}\\int_{-1}^{1} \\big(f\\circ \\boldsymbol{F}\\big)(\\xi_{1},\\xi_{2})\\,J(\\xi_{1},\\xi_{2})\\,\\mathrm{d}\\xi_{2}\\,\\mathrm{d}\\xi_{1}\n$$\n数值求积 $Q_N$ 近似该积分。要使 $Q_N$ 与 $I$ 完全相等，求积法则必须对被积函数精确，我们记该被积函数为 $g(\\xi_1, \\xi_2) = \\big(f\\circ \\boldsymbol{F}\\big)(\\xi_{1},\\xi_{2})\\,J(\\xi_{1},\\xi_{2})$。\n\n所选的求积是张量积高斯-勒让德法则。在区间 $[-1,1]$ 上的一维 $N$ 点高斯-勒让德求积对次数最高为 $2N-1$ 的任何多项式都是精确的。为了使二维张量积法则精确，对于任意固定的 $\\xi_2$，被积函数 $g(\\xi_1, \\xi_2)$ 必须是 $\\xi_1$ 的次数至多为 $2N-1$ 的多项式；对于任意固定的 $\\xi_1$，它也必须是 $\\xi_2$ 的次数至多为 $2N-1$ 的多项式。因此，我们的目标是找出 $g(\\xi_1, \\xi_2)$ 在其每个变量上的可能最高多项式次数。\n\n让我们分析被积函数的两个因子 $(f\\circ \\boldsymbol{F})$ 和 $J$ 的多项式次数。\n\n1.  **复合函数 $(f\\circ \\boldsymbol{F})(\\boldsymbol{\\xi})$ 的次数**：\n    映射 $\\boldsymbol{F}(\\boldsymbol{\\xi})=(x(\\xi_1, \\xi_2), y(\\xi_1, \\xi_2))$ 是一个在每个参考坐标方向上次数为 $k$ 的张量积多项式。这意味着 $x(\\xi_1, \\xi_2)$ 和 $y(\\xi_1, \\xi_2)$ 是关于 $\\xi_1$ 最高次数为 $k$、关于 $\\xi_2$ 最高次数为 $k$ 的多项式。我们可以将其写为 $\\text{deg}_{\\xi_1}(x) \\le k$，$\\text{deg}_{\\xi_2}(x) \\le k$，$\\text{deg}_{\\xi_1}(y) \\le k$ 和 $\\text{deg}_{\\xi_2}(y) \\le k$。\n    函数 $f(x,y)$ 是物理坐标 $(x,y)$ 下总次数至多为 $p$ 的多项式。$f(x,y)$ 中的一个通项形式为 $c_{ab} x^a y^b$，其中 $a+b \\le p$。\n    当我们将 $f$ 与 $\\boldsymbol{F}$ 复合时，该项变为 $c_{ab} (x(\\xi_1, \\xi_2))^a (y(\\xi_1, \\xi_2))^b$。\n    这个复合项关于变量 $\\xi_1$ 的次数为：\n    $$\n    \\text{deg}_{\\xi_1}\\left((x(\\xi_1, \\xi_2))^a (y(\\xi_1, \\xi_2))^b\\right) = a \\cdot \\text{deg}_{\\xi_1}(x) + b \\cdot \\text{deg}_{\\xi_1}(y)\n    $$\n    为了找到可能的最大次数，我们考虑上界：\n    $$\n    \\text{deg}_{\\xi_1}\\left((x(\\xi_1, \\xi_2))^a (y(\\xi_1, \\xi_2))^b\\right) \\le a \\cdot k + b \\cdot k = (a+b)k\n    $$\n    由于 $a+b$ 的最大值是 $p$，因此 $(f\\circ \\boldsymbol{F})$ 中任意项关于 $\\xi_1$ 的最大次数是 $pk$。同样的逻辑也适用于变量 $\\xi_2$。因此，最大多项式次数为：\n    $$\n    \\text{deg}_{\\xi_1}(f\\circ \\boldsymbol{F}) \\le pk \\quad \\text{and} \\quad \\text{deg}_{\\xi_2}(f\\circ \\boldsymbol{F}) \\le pk\n    $$\n    这些界是紧的，可以通过取 $f(x,y)=x^p$ 和一个映射 $x(\\xi_1,\\xi_2)=\\xi_1^k$ 来看出。\n\n2.  **雅可比行列式 $J(\\boldsymbol{\\xi})$ 的次数**：\n    雅可比行列式定义为：\n    $$\n    J(\\boldsymbol{\\xi}) = \\det\\left(\\frac{\\partial(x,y)}{\\partial(\\xi_{1},\\xi_{2})}\\right) = \\frac{\\partial x}{\\partial \\xi_1}\\frac{\\partial y}{\\partial \\xi_2} - \\frac{\\partial x}{\\partial \\xi_2}\\frac{\\partial y}{\\partial \\xi_1}\n    $$\n    关于 $\\xi_1$ 的偏导数的次数为：\n    $\\text{deg}_{\\xi_1}\\left(\\frac{\\partial x}{\\partial \\xi_1}\\right) \\le k-1$, $\\text{deg}_{\\xi_1}\\left(\\frac{\\partial y}{\\partial \\xi_1}\\right) \\le k-1$。\n    $\\text{deg}_{\\xi_1}\\left(\\frac{\\partial x}{\\partial \\xi_2}\\right) \\le k$, $\\text{deg}_{\\xi_1}\\left(\\frac{\\partial y}{\\partial \\xi_2}\\right) \\le k$。\n    现在我们求 $J$ 表达式中每一项的次数：\n    $$\n    \\text{deg}_{\\xi_1}\\left(\\frac{\\partial x}{\\partial \\xi_1}\\frac{\\partial y}{\\partial \\xi_2}\\right) = \\text{deg}_{\\xi_1}\\left(\\frac{\\partial x}{\\partial \\xi_1}\\right) + \\text{deg}_{\\xi_1}\\left(\\frac{\\partial y}{\\partial \\xi_2}\\right) \\le (k-1) + k = 2k-1\n    $$\n    $$\n    \\text{deg}_{\\xi_1}\\left(\\frac{\\partial x}{\\partial \\xi_2}\\frac{\\partial y}{\\partial \\xi_1}\\right) = \\text{deg}_{\\xi_1}\\left(\\frac{\\partial x}{\\partial \\xi_2}\\right) + \\text{deg}_{\\xi_1}\\left(\\frac{\\partial y}{\\partial \\xi_1}\\right) \\le k + (k-1) = 2k-1\n    $$\n    和（或差）的次数至多是各项次数的最大值。因此，$J$ 关于 $\\xi_1$ 的最大次数是 $2k-1$。根据对称性，对 $\\xi_2$ 同样成立：\n    $$\n    \\text{deg}_{\\xi_1}(J) \\le 2k-1 \\quad \\text{and} \\quad \\text{deg}_{\\xi_2}(J) \\le 2k-1\n    $$\n    这个界也是紧的。\n\n3.  **完整被积函数 $g(\\boldsymbol{\\xi})$ 的次数**：\n    乘积 $g = (f\\circ \\boldsymbol{F}) J$ 的次数是其因子次数之和。$g$ 在 $\\xi_1$ 中的最大次数是：\n    $$\n    \\text{deg}_{\\xi_1}(g) = \\text{deg}_{\\xi_1}(f\\circ \\boldsymbol{F}) + \\text{deg}_{\\xi_1}(J) \\le pk + (2k-1)\n    $$\n    令 $D_{\\max} = pk + 2k - 1$。这是被积函数在每个变量 $\\xi_1$ 和 $\\xi_2$ 中的最大多项式次数。\n\n4.  **确定最少求积点数 $N_{\\min}$**：\n    为了使 $N$ 点高斯-勒让德求积精确，多项式被积函数的次数不能超过 $2N-1$。因此，我们必须满足条件：\n    $$\n    D_{\\max} \\le 2N - 1\n    $$\n    代入 $D_{\\max}$ 的表达式：\n    $$\n    pk + 2k - 1 \\le 2N - 1\n    $$\n    化简此不等式可得：\n    $$\n    pk + 2k \\le 2N\n    $$\n    $$\n    N \\ge \\frac{pk + 2k}{2} = \\frac{k(p+2)}{2}\n    $$\n    由于求积点数 $N$ 必须是整数，我们必须取满足此条件的最小整数。这由上取整函数给出：\n    $$\n    N_{\\min} = \\left\\lceil \\frac{k(p+2)}{2} \\right\\rceil\n    $$\n此表达式给出了在每个方向上所需的最少求积点数，以保证对于次数为 $k$ 的张量积多项式映射的区域上，任何总次数最高为 $p$ 的多项式 $f$ 的积分都能精确计算。", "answer": "$$\n\\boxed{\\left\\lceil \\frac{k(p+2)}{2} \\right\\rceil}\n$$", "id": "3367230"}, {"introduction": "从连续数学到离散的计算机实现会引入新的挑战。仅仅保证我们的连续方程正确是不够的，它们的离散近似也必须保留基本的物理和几何定律。最后的这个实践 [@problem_id:3367290] 深入探讨了这一点，要求你设计网格度量的一个离散表示，使其精确满足一个关键的几何恒等式。然后，你将展示该性质如何导致“均匀流保持”——即数值格式完美维持均匀流场的能力，这是任何可靠的模拟代码的重要基准。", "problem": "考虑一个二维贴体坐标变换，它通过光滑函数 $x(\\xi,\\eta)$ 和 $y(\\xi,\\eta)$ 将计算坐标 $(\\xi,\\eta)\\in[0,1]\\times[0,1]$（具有周期性边界条件）映射到物理坐标 $(x,y)$。设雅可比行列式定义为 $J = \\det\\left(\\frac{\\partial(x,y)}{\\partial(\\xi,\\eta)}\\right)$，并令 $\\boldsymbol{a}^{i}$ 表示与该变换相关的逆变基向量。对于一个标量场 $q(x,y,t)$，在物理域中具有常速度 $(u,v)$ 的守恒型线性平流方程，可以在计算域中写成一种通量散度形式，该形式使用由 $J\\boldsymbol{a}^{i}$ 构建的变换后通量和几何度量。\n\n您的任务是在 $(\\xi,\\eta)$ 的结构化、同位、均匀网格上，使用二阶中心有限差分，为 $J\\boldsymbol{a}^{i}$ 设计并实现一个离散近似，使得在周期性边界条件下，离散度量恒等式 $D_{\\xi}\\left(J\\boldsymbol{a}^{1}\\right) + D_{\\eta}\\left(J\\boldsymbol{a}^{2}\\right) = \\boldsymbol{0}$ 被精确满足，其中 $D_{\\xi}$ 和 $D_{\\eta}$ 是关于 $\\xi$ 和 $\\eta$ 的离散偏导数算子。从链式法则以及雅可比行列式和逆变基的定义出发，推导如何从离散空间导数组装 $J\\boldsymbol{a}^{i}$，以强制满足离散度量恒等式。然后，使用由此产生的度量，为离散守恒型线性平流算子演示自由流保持性：对于常数场 $q(\\xi,\\eta)=q_{0}$ 和常速度 $(u,v)$，证明当半离散算子与度量近似中使用相同的差分算子进行一致构造时，其应用于 $q$ 会产生零残差。\n\n在您的程序中使用以下测试套件。对于每个测试，通过以下方式定义映射\n$$\nx(\\xi,\\eta) = \\xi + \\alpha \\sin(2\\pi \\xi)\\sin(2\\pi \\eta),\\qquad\ny(\\xi,\\eta) = \\eta + \\beta \\cos(2\\pi \\xi)\\sin(2\\pi \\eta),\n$$\n在两个方向上都具有周期性，并用一个大小为 $N_{\\xi}\\times N_{\\eta}$、间距为 $\\Delta \\xi = \\tfrac{1}{N_{\\xi}}$ 和 $\\Delta \\eta = \\tfrac{1}{N_{\\eta}}$ 的均匀周期性网格对域进行离散化。对 $D_{\\xi}$ 和 $D_{\\eta}$ 使用带周期性环绕的中心差分格式。对于每种情况，设置 $q_{0} = 1$（无量纲），并计算：\n- 在整个网格上，$D_{\\xi}\\left(J\\boldsymbol{a}^{1}\\right) + D_{\\eta}\\left(J\\boldsymbol{a}^{2}\\right)$ 的每个分量的最大绝对值。\n- 离散守恒平流残差 $D_{\\xi}(F^{\\xi}) + D_{\\eta}(F^{\\eta})$ 的最大绝对值，其中通量 $F^{\\xi}$ 和 $F^{\\eta}$ 是由 $J\\boldsymbol{a}^{i}$ 和常速度 $(u,v)$ 一致构造的变换后通量。\n\n如果两个分量的最大绝对值都小于容差 $\\varepsilon = 10^{-12}$，则声明离散度量恒等式成功；如果残差的最大绝对值小于相同的容差 $\\varepsilon = 10^{-12}$，则声明自由流保持性成功。\n\n测试套件：\n- 情况 1：$N_{\\xi} = 64$，$N_{\\eta} = 64$，$\\alpha = 0.2$，$\\beta = 0.15$，$u = 0.8$，$v = -0.3$。\n- 情况 2：$N_{\\xi} = 32$，$N_{\\eta} = 48$，$\\alpha = 0.0$，$\\beta = 0.0$，$u = 1.0$，$v = 0.4$。\n- 情况 3：$N_{\\xi} = 33$，$N_{\\eta} = 33$，$\\alpha = 0.25$，$\\beta = 0.05$，$u = 0.0$，$v = 0.0$。\n- 情况 4：$N_{\\xi} = 5$，$N_{\\eta} = 7$，$\\alpha = 0.1$，$\\beta = -0.08$，$u = -0.5$，$v = 0.9$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，顺序为 $[\\text{metric\\_ok\\_case1},\\text{free\\_ok\\_case1},\\text{metric\\_ok\\_case2},\\text{free\\_ok\\_case2},\\ldots]$，其中每个条目都是一个布尔值，指示相应的检查是否在容差 $\\varepsilon = 10^{-12}$ 下通过。不涉及物理单位或角度单位，所有量均为无量纲。", "solution": "该问题要求为曲线坐标系设计几何度量的离散近似，特别是量 $J\\boldsymbol{a}^{1}$ 和 $J\\boldsymbol{a}^{2}$，以使离散几何恒等式得到精确满足。然后利用此性质来证明守恒型平流格式的自由流保持性。\n\n令物理坐标 $(x, y)$ 是计算坐标 $(\\xi, \\eta)$ 的函数。位置向量为 $\\boldsymbol{r}(\\xi, \\eta) = x(\\xi, \\eta)\\boldsymbol{i} + y(\\xi, \\eta)\\boldsymbol{j}$。协变基向量定义为位置向量相对于计算坐标的偏导数：\n$$\n\\boldsymbol{e}_{1} = \\frac{\\partial \\boldsymbol{r}}{\\partial \\xi} = \\frac{\\partial x}{\\partial \\xi}\\boldsymbol{i} + \\frac{\\partial y}{\\partial \\xi}\\boldsymbol{j}\n$$\n$$\n\\boldsymbol{e}_{2} = \\frac{\\partial \\boldsymbol{r}}{\\partial \\eta} = \\frac{\\partial x}{\\partial \\eta}\\boldsymbol{i} + \\frac{\\partial y}{\\partial \\eta}\\boldsymbol{j}\n$$\n逆变基向量 $\\boldsymbol{a}^{1}$ 和 $\\boldsymbol{a}^{2}$ 由关系 $\\boldsymbol{a}^{i} \\cdot \\boldsymbol{e}_{j} = \\delta^{i}_{j}$ 定义，其中 $\\delta^{i}_{j}$ 是克罗内克δ。变换的雅可比行列式为 $J = x_{\\xi}y_{\\eta} - x_{\\eta}y_{\\xi}$。\n求解逆变基向量可得：\n$$\n\\boldsymbol{a}^{1} = \\frac{1}{J}\\left( y_{\\eta}\\boldsymbol{i} - x_{\\eta}\\boldsymbol{j} \\right)\n$$\n$$\n\\boldsymbol{a}^{2} = \\frac{1}{J}\\left( -y_{\\xi}\\boldsymbol{i} + x_{\\xi}\\boldsymbol{j} \\right)\n$$\n我们感兴趣的量是经雅可比行列式缩放的逆变基向量 $J\\boldsymbol{a}^{i}$：\n$$\nJ\\boldsymbol{a}^{1} = y_{\\eta}\\boldsymbol{i} - x_{\\eta}\\boldsymbol{j} = \\begin{pmatrix} y_{\\eta} \\\\ -x_{\\eta} \\end{pmatrix}\n$$\n$$\nJ\\boldsymbol{a}^{2} = -y_{\\xi}\\boldsymbol{i} + x_{\\xi}\\boldsymbol{j} = \\begin{pmatrix} -y_{\\xi} \\\\ x_{\\xi} \\end{pmatrix}\n$$\n在连续情况下，这些度量满足恒等式 $\\frac{\\partial}{\\partial \\xi}(J\\boldsymbol{a}^{1}) + \\frac{\\partial}{\\partial \\eta}(J\\boldsymbol{a}^{2}) = \\boldsymbol{0}$。这是光滑函数混合偏导数相等（Clairaut 定理）的直接推论：\n$$\n\\frac{\\partial}{\\partial \\xi}(J\\boldsymbol{a}^{1}) + \\frac{\\partial}{\\partial \\eta}(J\\boldsymbol{a}^{2}) = \\frac{\\partial}{\\partial \\xi}\\begin{pmatrix} y_{\\eta} \\\\ -x_{\\eta} \\end{pmatrix} + \\frac{\\partial}{\\partial \\eta}\\begin{pmatrix} -y_{\\xi} \\\\ x_{\\xi} \\end{pmatrix} = \\begin{pmatrix} y_{\\eta\\xi} - y_{\\xi\\eta} \\\\ -x_{\\eta\\xi} + x_{\\xi\\eta} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} = \\boldsymbol{0}\n$$\n\n目标是在离散意义上保持此恒等式。我们用一个 $N_{\\xi} \\times N_{\\eta}$ 点的均匀网格对计算域 $[0,1]\\times[0,1]$ 进行离散化，网格间距为 $\\Delta\\xi = 1/N_{\\xi}$ 和 $\\Delta\\eta = 1/N_{\\eta}$。我们为任意网格函数 $f_{i,j} = f(i\\Delta\\xi, j\\Delta\\eta)$ 定义二阶中心差分算子 $D_{\\xi}$ 和 $D_{\\eta}$：\n$$\n(D_{\\xi} f)_{i,j} = \\frac{f_{i+1,j} - f_{i-1,j}}{2\\Delta\\xi}\n$$\n$$\n(D_{\\eta} f)_{i,j} = \\frac{f_{i,j+1} - f_{i,j-1}}{2\\Delta\\eta}\n$$\n其中索引按周期性处理。关键的思路是通过直接用这些差分算子替换 $J\\boldsymbol{a}^{i}$ 表达式中的偏导数来构造离散度量。令 $(\\tilde{G}^{1})_{i,j}$ 和 $(\\tilde{G}^{2})_{i,j}$ 分别为 $(J\\boldsymbol{a}^{1})_{i,j}$ 和 $(J\\boldsymbol{a}^{2})_{i,j}$ 的离散近似。\n$$\n(\\tilde{G}^{1})_{i,j} = \\begin{pmatrix} (D_{\\eta} y)_{i,j} \\\\ -(D_{\\eta} x)_{i,j} \\end{pmatrix}\n$$\n$$\n(\\tilde{G}^{2})_{i,j} = \\begin{pmatrix} -(D_{\\xi} y)_{i,j} \\\\ (D_{\\xi} x)_{i,j} \\end{pmatrix}\n$$\n现在，我们将离散散度算子应用于这些离散度量：\n$$\nD_{\\xi}(\\tilde{G}^{1}) + D_{\\eta}(\\tilde{G}^{2}) = D_{\\xi}\\begin{pmatrix} D_{\\eta} y \\\\ -D_{\\eta} x \\end{pmatrix} + D_{\\eta}\\begin{pmatrix} -D_{\\xi} y \\\\ D_{\\xi} x \\end{pmatrix} = \\begin{pmatrix} D_{\\xi}D_{\\eta}y - D_{\\eta}D_{\\xi}y \\\\ -D_{\\xi}D_{\\eta}x + D_{\\eta}D_{\\xi}x \\end{pmatrix}\n$$\n标准的二阶中心差分算子是可交换的，即对于任何网格函数 $f$，都有 $D_{\\xi}D_{\\eta}f = D_{\\eta}D_{\\xi}f$。这可以通过写出其计算格式来证明。因此，所得向量的每个分量都恒为零。这证明了这种离散度量的特定构造精确地（在机器精度范围内）满足度量恒等式 $D_{\\xi}(\\tilde{G}^{1}) + D_{\\eta}(\\tilde{G}^{2}) = \\boldsymbol{0}$。\n\n接下来，我们证明自由流保持性。对于具有常速度 $\\boldsymbol{v} = (u,v)$ 的标量 $q$，其守恒型线性平流方程在物理空间中为 $\\frac{\\partial q}{\\partial t} + \\nabla \\cdot (\\boldsymbol{v}q) = 0$，变换到计算空间后为：\n$$\n\\frac{\\partial (Jq)}{\\partial t} + \\frac{\\partial F^{\\xi}}{\\partial \\xi} + \\frac{\\partial F^{\\eta}}{\\partial \\eta} = 0\n$$\n其中变换后的通量为 $F^{\\xi} = q (\\boldsymbol{v} \\cdot J\\boldsymbol{a}^{1})$ 和 $F^{\\eta} = q (\\boldsymbol{v} \\cdot J\\boldsymbol{a}^{2})$。\n在半离散形式中，网格点 $(i,j)$ 处的空间算子（残差）为 $R_{i,j} = D_{\\xi}(F^{\\xi})_{i,j} + D_{\\eta}(F^{\\eta})_{i,j}$。对于自由流条件，标量场是常数 $q=q_0$，速度 $(u,v)$ 也是常数。离散通量与度量一致地构造：\n$$\n(F^{\\xi})_{i,j} = q_{0} \\left( u (\\tilde{G}^{1}_{x})_{i,j} + v (\\tilde{G}^{1}_{y})_{i,j} \\right) = q_0 \\left( u (D_{\\eta}y)_{i,j} - v (D_{\\eta}x)_{i,j} \\right)\n$$\n$$\n(F^{\\eta})_{i,j} = q_{0} \\left( u (\\tilde{G}^{2}_{x})_{i,j} + v (\\tilde{G}^{2}_{y})_{i,j} \\right) = q_0 \\left( -u (D_{\\xi}y)_{i,j} + v (D_{\\xi}x)_{i,j} \\right)\n$$\n离散残差是这些通量的散度：\n$$\nR_{i,j} = D_{\\xi} \\left( q_0 ( u D_{\\eta}y - v D_{\\eta}x ) \\right)_{i,j} + D_{\\eta} \\left( q_0 ( -u D_{\\xi}y + v D_{\\xi}x ) \\right)_{i,j}\n$$\n由于 $q_0$、$u$ 和 $v$ 是常数，它们可以从差分算子中提出：\n$$\nR_{i,j} = q_0 u \\left( D_{\\xi}D_{\\eta}y - D_{\\eta}D_{\\xi}y \\right)_{i,j} - q_0 v \\left( D_{\\xi}D_{\\eta}x - D_{\\eta}D_{\\xi}x \\right)_{i,j}\n$$\n如前所述，算子是可交换的，所以 $(D_{\\xi}D_{\\eta}y - D_{\\eta}D_{\\xi}y)_{i,j} = 0$ 且 $(D_{\\xi}D_{\\eta}x - D_{\\eta}D_{\\xi}x)_{i,j} = 0$。因此，对于所有的 $(i,j)$，残差 $R_{i,j}=0$。这证明了常数初始场保持不变，此性质即为自由流保持性。对于一个数值格式而言，这是一个至关重要的性质，以确保在曲线网格上准确模拟均匀流，而不会引入人为的源或汇。下面的实现遵循此推导。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements discrete geometric metrics for a body-fitted coordinate system\n    that satisfy the discrete metric identity and demonstrates free-stream preservation for\n    a conservative linear advection operator.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N_xi, N_eta, alpha, beta, u, v)\n        (64, 64, 0.2, 0.15, 0.8, -0.3),\n        (32, 48, 0.0, 0.0, 1.0, 0.4),\n        (33, 33, 0.25, 0.05, 0.0, 0.0),\n        (5, 7, 0.1, -0.08, -0.5, 0.9),\n    ]\n\n    tolerance = 1e-12\n    results = []\n\n    for case in test_cases:\n        N_xi, N_eta, alpha, beta, u, v = case\n        \n        # 1. Grid Generation\n        d_xi = 1.0 / N_xi\n        d_eta = 1.0 / N_eta\n        \n        # Create computational coordinate grid\n        xi_vec = np.linspace(0.0, 1.0, N_xi, endpoint=False)\n        eta_vec = np.linspace(0.0, 1.0, N_eta, endpoint=False)\n        \n        # Use 'xy' indexing for (N_eta, N_xi) shaped arrays,\n        # where xi varies along axis 1 (columns) and eta along axis 0 (rows).\n        xi_grid, eta_grid = np.meshgrid(xi_vec, eta_vec, indexing='xy')\n        \n        # Compute physical coordinates using the mapping functions\n        x_grid = xi_grid + alpha * np.sin(2 * np.pi * xi_grid) * np.sin(2 * np.pi * eta_grid)\n        y_grid = eta_grid + beta * np.cos(2 * np.pi * xi_grid) * np.sin(2 * np.pi * eta_grid)\n        \n        # 2. Discrete Operators and Metric Calculation\n        def diff_xi(f):\n            \"\"\"Second-order centered difference in xi (axis=1) with periodic BC.\"\"\"\n            return (np.roll(f, -1, axis=1) - np.roll(f, 1, axis=1)) / (2 * d_xi)\n        \n        def diff_eta(f):\n            \"\"\"Second-order centered difference in eta (axis=0) with periodic BC.\"\"\"\n            return (np.roll(f, -1, axis=0) - np.roll(f, 1, axis=0)) / (2 * d_eta)\n        \n        # Calculate discrete partial derivatives of coordinates\n        dx_dxi = diff_xi(x_grid)\n        dx_deta = diff_eta(x_grid)\n        dy_dxi = diff_xi(y_grid)\n        dy_deta = diff_eta(y_grid)\n        \n        # Assemble the discrete metrics J*a^i\n        # G1 corresponds to tilde{G}^1 = J*a^1\n        G1_x = dy_deta\n        G1_y = -dx_deta\n        \n        # G2 corresponds to tilde{G}^2 = J*a^2\n        G2_x = -dy_dxi\n        G2_y = dx_dxi\n        \n        # 3. Check Metric Identity\n        # This is D_xi(J*a^1) + D_eta(J*a^2)\n        metric_identity_x = diff_xi(G1_x) + diff_eta(G2_x)\n        metric_identity_y = diff_xi(G1_y) + diff_eta(G2_y)\n        \n        # Find the maximum absolute error over the grid\n        max_err_x = np.max(np.abs(metric_identity_x))\n        max_err_y = np.max(np.abs(metric_identity_y))\n        \n        metric_ok = max_err_x  tolerance and max_err_y  tolerance\n        results.append(metric_ok)\n        \n        # 4. Check Free-Stream Preservation\n        q0 = 1.0  # Constant scalar field\n        \n        # Compute transformed fluxes F^xi and F^eta\n        flux_xi = q0 * (u * G1_x + v * G1_y)\n        flux_eta = q0 * (u * G2_x + v * G2_y)\n        \n        # Compute the discrete divergence of the fluxes (the residual)\n        residual = diff_xi(flux_xi) + diff_eta(flux_eta)\n        \n        # Find the maximum absolute residual over the grid\n        max_residual = np.max(np.abs(residual))\n        \n        free_ok = max_residual  tolerance\n        results.append(free_ok)\n\n    # Final print statement in the exact required format.\n    # The map to str converts booleans to 'True'/'False'.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3367290"}]}