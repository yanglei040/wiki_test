{"hands_on_practices": [{"introduction": "要真正掌握压力泊松方程（PPE），第一步是理解其离散形式。本练习将引导您从连续的偏微分方程推导到其在网格上的代数形式，并手动执行一次雅可比（Jacobi）迭代计算。通过这个具体的计算[@problem_id:3307564]，您将亲手体验数值求解过程，从而深刻理解离散方程中每一项的物理和数学意义，为后续更复杂的编程实践奠定坚实基础。", "problem": "考虑一个在计算流体动力学（CFD）中通过分数步长（投影）法推进的二维不可压缩流。令中间速度场表示为 $u^{\\ast}$，质量密度为 $\\rho$，时间步长为 $\\Delta t$。校正速度 $u^{n+1}$ 是通过压力校正强制实现不可压缩性得到的。在两个方向上间距均为 $h$ 的均匀笛卡尔网格上进行计算，并假设在区域边界上对压力采用狄利克雷（Dirichlet）边界条件。关注一个内部单元 $(i,j)$。\n\n从不可压缩流的控制方程和分数步长投影的定义出发，推导压力泊松方程（PPE），该方程通过 $p^{n+1}$ 和 $u^{\\ast}$ 来强制实现 $\\nabla \\cdot u^{n+1} = 0$。在均匀网格上使用标准的五点格式离散拉普拉斯算子，并根据前一次迭代的相邻压力值和局部源项，推导用于内部压力更新的雅可比（Jacobi）定点迭代法。然后，使用以下数据计算特定内部位置 $(i,j)$ 的一次雅可比迭代：\n\n- 网格间距：$h = 0.01 \\,\\text{m}$。\n- 密度：$\\rho = 1000 \\,\\text{kg}\\,\\text{m}^{-3}$。\n- 时间步长：$\\Delta t = 0.1 \\,\\text{s}$。\n- 在 $(i,j)$ 处的面心中间速度：\n  - $u^{\\ast}_{i+\\frac{1}{2},j} = 0.20 \\,\\text{m}\\,\\text{s}^{-1}$，$u^{\\ast}_{i-\\frac{1}{2},j} = 0.10 \\,\\text{m}\\,\\text{s}^{-1}$，\n  - $v^{\\ast}_{i,j+\\frac{1}{2}} = -0.05 \\,\\text{m}\\,\\text{s}^{-1}$，$v^{\\ast}_{i,j-\\frac{1}{2}} = -0.10 \\,\\text{m}\\,\\text{s}^{-1}$。\n- 在迭代 $m$ 时的前一次迭代相邻压力（单位：帕斯卡）：\n  - $p^{(m)}_{i+1,j} = 100000$，$p^{(m)}_{i-1,j} = 100010$，$p^{(m)}_{i,j+1} = 100000$，$p^{(m)}_{i,j-1} = 100005$。\n\n使用标准的二阶有限体积或有限差分法离散散度，在单元 $(i,j)$ 处构成 $q_{i,j} = \\left(\\frac{\\rho}{\\Delta t}\\right)\\nabla \\cdot u^{\\ast}$，并对内部压力执行一次雅可比更新。以帕斯卡为单位表示更新后的压力。提供精确值，不要四舍五入。\n\n此外，对于一个尺寸为 $N_{x} \\times N_{y}$ 且具有狄利克雷边界条件的方形内部网格，通过给出雅可比迭代矩阵的谱半径作为 $N_{x}$ 和 $N_{y}$ 的函数，讨论雅可比方法每次迭代的预期收敛率，并简要解释其对大的 $N_{x},N_{y}$ 的影响。该讨论不影响所要求的数值答案。", "solution": "该问题要求在计算流体动力学的背景下进行多步推导和计算，特别是关于不可压缩流的投影法。我们将首先推导连续的压力泊松方程（PPE），然后对其进行离散化并建立雅可比迭代格式，接着进行一次迭代步骤的数值计算，最后讨论该方法的收敛性。\n\n**1. 压力泊松方程（PPE）的推导**\n\n求解不可压缩纳维-斯托克斯（Navier-Stokes）方程的投影法通过将动量方程的更新分为两个步骤来在时间上推进求解。对于密度为常数 $\\rho$ 的不可压缩流体，其控制方程是连续性方程和动量方程。\n\n投影法的核心在于第二步，即校正或投影步骤。在计算出中间速度场 $\\mathbf{u}^{\\ast}$（通常通过求解不含压力梯度项的动量方程得到）之后，找到一个压力场 $p^{n+1}$，使得校正后的速度场 $\\mathbf{u}^{n+1}$ 是无散度的。\n\n校正速度 $\\mathbf{u}^{n+1}$、中间速度 $\\mathbf{u}^{\\ast}$ 和新时间步的压力 $p^{n+1}$ 之间的关系由投影步骤方程给出：\n$$ \\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^{\\ast}}{\\Delta t} = -\\frac{1}{\\rho} \\nabla p^{n+1} $$\n其中 $\\Delta t$ 是时间步长。该方程可以重新整理以显式表示校正速度：\n$$ \\mathbf{u}^{n+1} = \\mathbf{u}^{\\ast} - \\frac{\\Delta t}{\\rho} \\nabla p^{n+1} $$\n不可压缩流的基本约束是速度场必须始终是无散度的（螺线管场）。我们将此条件施加于校正后的速度场 $\\mathbf{u}^{n+1}$：\n$$ \\nabla \\cdot \\mathbf{u}^{n+1} = 0 $$\n为了推导压力 $p^{n+1}$ 的方程，我们对速度校正方程取散度：\n$$ \\nabla \\cdot \\mathbf{u}^{n+1} = \\nabla \\cdot \\left( \\mathbf{u}^{\\ast} - \\frac{\\Delta t}{\\rho} \\nabla p^{n+1} \\right) $$\n将不可压缩性约束 $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$ 应用于左侧，并在右侧使用散度算子的线性性质，我们得到：\n$$ 0 = \\nabla \\cdot \\mathbf{u}^{\\ast} - \\nabla \\cdot \\left( \\frac{\\Delta t}{\\rho} \\nabla p^{n+1} \\right) $$\n假设密度 $\\rho$ 和时间步长 $\\Delta t$ 是常数，它们可以移到散度算子之外：\n$$ \\nabla \\cdot (\\nabla p^{n+1}) = \\frac{\\rho}{\\Delta t} \\nabla \\cdot \\mathbf{u}^{\\ast} $$\n算子 $\\nabla \\cdot \\nabla$ 是拉普拉斯算子，记为 $\\nabla^2$ 或 $\\Delta$。因此，我们得到了压力泊松方程（PPE）：\n$$ \\nabla^2 p^{n+1} = \\frac{\\rho}{\\Delta t} \\nabla \\cdot \\mathbf{u}^{\\ast} $$\n这个椭圆型偏微分方程确定了将中间速度场投影到无散度空间所需的压力场。\n\n**2. 离散化与雅可比（Jacobi）迭代**\n\n我们在 $x$ 和 $y$ 方向上间距均为 $h$ 的均匀二维笛卡尔网格上离散化PPE。令 $p_{i,j}$ 表示单元 $(i,j)$ 中心的压力。\n\n在 $(i,j)$ 处的拉普拉斯算子 $\\nabla^2 p$ 使用标准的二阶五点有限差分格式进行近似：\n$$ (\\nabla^2 p)_{i,j} \\approx \\frac{p_{i+1,j} - 2p_{i,j} + p_{i-1,j}}{h^2} + \\frac{p_{i,j+1} - 2p_{i,j} + p_{i,j-1}}{h^2} $$\n我们记为 $q$ 的右侧源项在单元中心 $(i,j)$ 处进行离散化。问题指定了交错网格布局，其中速度存储在单元面上。中间速度场 $\\mathbf{u}^{\\ast} = (u^{\\ast}, v^{\\ast})$ 的散度通过中心差分进行近似：\n$$ (\\nabla \\cdot \\mathbf{u}^{\\ast})_{i,j} \\approx \\frac{u^{\\ast}_{i+\\frac{1}{2},j} - u^{\\ast}_{i-\\frac{1}{2},j}}{h} + \\frac{v^{\\ast}_{i,j+\\frac{1}{2}} - v^{\\ast}_{i,j-\\frac{1}{2}}}{h} $$\n那么，离散化的源项为：\n$$ q_{i,j} = \\left(\\frac{\\rho}{\\Delta t}\\right) \\left( \\frac{u^{\\ast}_{i+\\frac{1}{2},j} - u^{\\ast}_{i-\\frac{1}{2},j}}{h} + \\frac{v^{\\ast}_{i,j+\\frac{1}{2}} - v^{\\ast}_{i,j-\\frac{1}{2}}}{h} \\right) $$\n结合这些，完全离散化的PPE为：\n$$ \\frac{p_{i+1,j} + p_{i-1,j} + p_{i,j+1} + p_{i,j-1} - 4p_{i,j}}{h^2} = q_{i,j} $$\n为了推导雅可比定点迭代，我们求解此方程以得到中心压力 $p_{i,j}$。设迭代计数器为 $m$。雅可比方法使用所有相邻点在前一次迭代 $m$ 的值来更新点 $(i,j)$ 的值。\n$$ -4p_{i,j} = h^2 q_{i,j} - (p_{i+1,j} + p_{i-1,j} + p_{i,j+1} + p_{i,j-1}) $$\n$$ p_{i,j} = \\frac{1}{4} (p_{i+1,j} + p_{i-1,j} + p_{i,j+1} + p_{i,j-1} - h^2 q_{i,j}) $$\n因此，雅可比更新规则为：\n$$ p^{(m+1)}_{i,j} = \\frac{1}{4} \\left( p^{(m)}_{i+1,j} + p^{(m)}_{i-1,j} + p^{(m)}_{i,j+1} + p^{(m)}_{i,j-1} - h^2 q_{i,j} \\right) $$\n\n**3. 一次雅可比（Jacobi）迭代的数值计算**\n\n我们有以下给定数据：\n- 网格间距：$h = 0.01 \\,\\text{m}$。\n- 密度：$\\rho = 1000 \\,\\text{kg}\\,\\text{m}^{-3}$。\n- 时间步长：$\\Delta t = 0.1 \\,\\text{s}$。\n- 中间速度：\n  - $u^{\\ast}_{i+\\frac{1}{2},j} = 0.20 \\,\\text{m}\\,\\text{s}^{-1}$，$u^{\\ast}_{i-\\frac{1}{2},j} = 0.10 \\,\\text{m}\\,\\text{s}^{-1}$\n  - $v^{\\ast}_{i,j+\\frac{1}{2}} = -0.05 \\,\\text{m}\\,\\text{s}^{-1}$，$v^{\\ast}_{i,j-\\frac{1}{2}} = -0.10 \\,\\text{m}\\,\\text{s}^{-1}$\n- 前一次迭代的压力（在迭代 $m$）：\n  - $p^{(m)}_{i+1,j} = 100000$ Pa，$p^{(m)}_{i-1,j} = 100010$ Pa，$p^{(m)}_{i,j+1} = 100000$ Pa，$p^{(m)}_{i,j-1} = 100005$ Pa。\n\n首先，我们计算单元 $(i,j)$ 处 $\\mathbf{u}^{\\ast}$ 的离散散度：\n$$ (\\nabla \\cdot \\mathbf{u}^{\\ast})_{i,j} = \\frac{0.20 - 0.10}{0.01} + \\frac{-0.05 - (-0.10)}{0.01} = \\frac{0.10}{0.01} + \\frac{0.05}{0.01} = 10 + 5 = 15 \\,\\text{s}^{-1} $$\n接下来，我们计算源项 $q_{i,j}$：\n$$ q_{i,j} = \\frac{\\rho}{\\Delta t} (\\nabla \\cdot \\mathbf{u}^{\\ast})_{i,j} = \\frac{1000}{0.1} \\times 15 = 10000 \\times 15 = 150000 \\,\\text{Pa}\\,\\text{m}^{-2} $$\n现在，我们计算出现在雅可比公式中的项 $h^2 q_{i,j}$：\n$$ h^2 q_{i,j} = (0.01)^2 \\times 150000 = 0.0001 \\times 150000 = 15 \\,\\text{Pa} $$\n最后，我们执行一次雅可比迭代来求得 $p^{(m+1)}_{i,j}$：\n$$ p^{(m+1)}_{i,j} = \\frac{1}{4} \\left( p^{(m)}_{i+1,j} + p^{(m)}_{i-1,j} + p^{(m)}_{i,j+1} + p^{(m)}_{i,j-1} - h^2 q_{i,j} \\right) $$\n代入给定的压力值和计算出的项：\n$$ p^{(m+1)}_{i,j} = \\frac{1}{4} (100000 + 100010 + 100000 + 100005 - 15) $$\n$$ p^{(m+1)}_{i,j} = \\frac{1}{4} (400015 - 15) $$\n$$ p^{(m+1)}_{i,j} = \\frac{1}{4} (400000) $$\n$$ p^{(m+1)}_{i,j} = 100000 \\,\\text{Pa} $$\n\n**4. 雅可比（Jacobi）方法的收敛率**\n\n对于线性系统 $A\\mathbf{p}=\\mathbf{b}$，雅可比方法的收敛性由雅可比迭代矩阵 $T_J$ 的谱半径 $\\rho(T_J)$ 决定。对于在具有 $N_x \\times N_y$ 个内部点和狄利克雷边界条件的矩形网格上，使用五点格式离散化的二维泊松方程，雅可比矩阵的谱半径由下式给出：\n$$ \\rho(T_J) = \\frac{1}{2} \\left[ \\cos\\left(\\frac{\\pi}{N_x+1}\\right) + \\cos\\left(\\frac{\\pi}{N_y+1}\\right) \\right] $$\n对于大量的网格点，即 $N_x \\gg 1$ 且 $N_y \\gg 1$ 时，余弦函数的参数很小。我们可以对小的 $x$ 使用泰勒级数展开 $\\cos(x) \\approx 1 - x^2/2$。\n$$ \\rho(T_J) \\approx \\frac{1}{2} \\left[ \\left(1 - \\frac{1}{2}\\left(\\frac{\\pi}{N_x+1}\\right)^2\\right) + \\left(1 - \\frac{1}{2}\\left(\\frac{\\pi}{N_y+1}\\right)^2\\right) \\right] $$\n$$ \\rho(T_J) \\approx 1 - \\frac{\\pi^2}{4} \\left( \\frac{1}{(N_x+1)^2} + \\frac{1}{(N_y+1)^2} \\right) $$\n由于网格间距 $h$ 与 $N_x$ 和 $N_y$ 成反比（例如，对于长度为 $L_x$ 的域，$h_x = L_x/(N_x+1)$），我们有 $\\rho(T_J) \\approx 1 - O(h^2)$。\n\n这一结果对雅可比方法的性能有至关重要的影响。随着网格加密（即 $N_x, N_y \\rightarrow \\infty$ 或 $h \\rightarrow 0$），谱半径 $\\rho(T_J)$ 趋近于 $1$。收敛率取决于谱半径比 $1$ 小多少，因此收敛率变得极低。将误差减少一个固定因子所需的迭代次数与 $(1 - \\rho(T_J))^{-1}$ 成正比，即 $O(N_x^2 + N_y^2)$ 或 $O(h^{-2})$。这表明雅可比求解器的计算量随每个方向的网格分辨率呈二次方增长，使其在细网格和大规模问题上慢得令人望而却步。这种不良的可扩展性使得必须使用更先进、更高效的求解器，如逐次超松弛（SOR）法、共轭梯度法，或者最有效的多重网格法。", "answer": "$$\n\\boxed{100000}\n$$", "id": "3307564"}, {"introduction": "在理解了单步迭代的原理后，下一步自然是构建一个完整的求解器。本练习[@problem_id:2397063]要求您实现高斯-赛德尔（Gauss-Seidel）或超松弛（SOR）迭代法，来求解一个源于流体动力学中关键物理过程——对流加速项 $(\\vec{u}\\cdot \\nabla)\\vec{u}$——的压力泊松方程。通过编写代码解决这个问题，您不仅能掌握迭代求解器的实现技巧，还能体会到如何将纳维-斯托克斯方程中的复杂项转化为压力泊松方程的源项，从而连接起理论推导与计算实践。", "problem": "你需要实现一个高斯-赛德尔松弛法，用于求解一个由给定速度场构建的二次非线性项驱动的压力场的拉普拉斯型泊松方程。其基本原理是速度场的不可压缩约束以及一阶和二阶空间导数的定义，这些共同导出了压力泊松方程。在单位正方形上，完全在无量纲的纯数学设定下进行计算。\n\n给定一个二维域 $\\Omega = [0,1]\\times[0,1]$，它被离散化为一个大小为 $N\\times N$ 的均匀笛卡尔网格，网格间距为 $h = 1/(N-1)$。设 $\\vec{u} = (u_x, u_y)$ 是一个给定的、足够光滑的速度场。考虑在 $\\Omega$ 上的压力泊松方程\n$$\n\\nabla^2 p = \\nabla \\cdot \\big( (\\vec{u}\\cdot \\nabla)\\vec{u} \\big)\n$$\n其边界条件为在 $\\partial\\Omega$ 上的均匀狄利克雷边界条件 $p=0$。你的任务是：\n\n- 推导作用于内部网格点上 $p$ 的拉普拉斯算子的二阶有限差分格式，并通过在整个边界上保持 $p=0$ 来施加狄利克雷边界值。\n- 推导一个二阶有限差分表达式，以在内部网格点上仅使用同一网格上的 $u_x$ 和 $u_y$ 的点值来近似右侧项 $\\nabla \\cdot \\big( (\\vec{u}\\cdot \\nabla)\\vec{u} \\big)$。为避免模板过度增长，需将对流加速度的散度代数展开为 $u_x$ 和 $u_y$ 的一阶和二阶导数，然后使用中心差分将每个导数离散化至二阶精度。\n- 为离散泊松方程构建一个迭代高斯-赛德尔松弛方案，可选择使用带有松弛因子 $\\omega$ 的逐次超松弛（SOR）方法，当所有内部点上离散残差的均方根值低于容差 $\\tau$，或达到最大迭代次数 $M$ 时，终止迭代。内部点的离散残差必须定义为该点上 $p$ 的离散拉普拉斯算子减去离散的右侧项。\n- 将求解器实现为一个完整的、可运行的程序，该程序计算与速度相关的右侧项，求解 $p$，并报告内部点上最终的均方根残差。\n\n本问题不涉及角度单位，也不需要任何物理单位；所有量均为无量纲。所有数值参数都应视为纯数字。实现不得要求任何用户输入。\n\n测试套件：\n实现你的程序以运行以下 $3$ 个测试用例并汇总其结果：\n\n- 测试用例 A（刚体旋转源）：$N=33$, $\\omega=1.6$, $\\tau=10^{-8}$, $M=8000$，速度场为 $u_x(x,y)=-y$, $u_y(x,y)=x$，作用于网格节点 $(x_i,y_j)=(i h, j h)$，其中 $i,j\\in\\{0,1,\\dots,N-1\\}$。\n\n- 测试用例 B（不可压缩流函数源）：$N=33$, $\\omega=1.8$, $\\tau=10^{-8}$, $M=8000$，定义流函数 $\\psi(x,y)=\\sin(\\pi x)\\sin(\\pi y)$，并设置 $u_x=\\partial \\psi/\\partial y$ 和 $u_y=-\\partial \\psi/\\partial x$，在网格节点上精确求值。\n\n- 测试用例 C（均匀流边界情况）：$N=17$, $\\omega=1.6$, $\\tau=10^{-8}$, $M=4000$，所有节点上的速度均为匀速 $u_x(x,y)=1$, $u_y(x,y)=0$。\n\n可量化的答案和输出格式：\n对于每个测试用例，你的程序必须计算并返回一个浮点数，该数值等于终止时内部点上离散泊松方程的最终均方根残差。你的程序应生成单行输出，其中包含这三个结果，形式为方括号括起来的逗号分隔列表，每个浮点值都以科学记数法格式化，小数点后精确到 $6$ 位（例如，$[1.234567e-08,9.876543e-05,0.000000e+00]$）。", "solution": "所述问题具有科学依据，内容自洽且提法恰当。它构成了计算物理学中的一个标准练习：使用有限差分法和迭代松弛方案求解一个源于不可压缩流体动力学原理的泊松型方程。问题中没有逻辑矛盾、缺失数据或伪科学元素。因此，我们将着手提供一个完整的解法。\n\n控制方程是单位正方形 $\\Omega = [0,1]\\times[0,1]$ 上的压力泊松方程：\n$$\n\\nabla^2 p = \\nabla \\cdot \\big( (\\vec{u}\\cdot \\nabla)\\vec{u} \\big)\n$$\n其边界条件为均匀狄利克雷边界条件，$p=0$ on $\\partial\\Omega$。速度场 $\\vec{u}=(u_x, u_y)$ 是给定的，并且是不可压缩的，即 $\\nabla \\cdot \\vec{u} = 0$。\n\n首先，我们必须在一个大小为 $N \\times N$ 的均匀笛卡尔网格上推导算子和源项的有限差分近似。网格点为 $(x_i, y_j) = (ih, jh)$，其中 $i,j \\in \\{0, 1, \\dots, N-1\\}$，网格间距为 $h = 1/(N-1)$。网格点上的场值用下标表示，例如，$p_{i,j} = p(x_i, y_j)$。\n\n拉普拉斯算子 $\\nabla^2 p = \\frac{\\partial^2 p}{\\partial x^2} + \\frac{\\partial^2 p}{\\partial y^2}$ 在内部网格点 $(i,j)$ 处使用二阶中心差分格式（即所谓的五点模板）进行近似：\n$$\n(\\nabla^2 p)_{i,j} \\approx \\frac{p_{i+1,j} - 2p_{i,j} + p_{i-1,j}}{h^2} + \\frac{p_{i,j+1} - 2p_{i,j} + p_{i,j-1}}{h^2} = \\frac{p_{i+1,j} + p_{i-1,j} + p_{i,j+1} + p_{i,j-1} - 4p_{i,j}}{h^2}\n$$\n该近似对所有内部点均有效，即对于 $i,j \\in \\{1, 2, \\dots, N-2\\}$。\n\n接下来，我们处理右侧项，即源项 $S = \\nabla \\cdot \\big( (\\vec{u}\\cdot \\nabla)\\vec{u} \\big)$。题目要求先展开此项再进行离散化。使用指标记法和爱因斯坦求和约定，源项为 $S = \\partial_k (u_j \\partial_j u_k)$。应用乘积法则得到 $S = (\\partial_k u_j)(\\partial_j u_k) + u_j (\\partial_k \\partial_j u_k)$。第二项可以重写为 $u_j \\partial_j (\\partial_k u_k)$。项 $\\partial_k u_k$ 是散度 $\\nabla \\cdot \\vec{u}$。由于问题建立在不可压缩约束的基础上，整个域内 $\\nabla \\cdot \\vec{u} = 0$。因此，第二项消失，源项显著简化为：\n$$\nS = (\\partial_k u_j)(\\partial_j u_k)\n$$\n对二维场 $(u_x, u_y)$ 展开此表达式：\n$$\nS = \\left(\\frac{\\partial u_x}{\\partial x}\\right)^2 + \\frac{\\partial u_y}{\\partial x}\\frac{\\partial u_x}{\\partial y} + \\frac{\\partial u_x}{\\partial y}\\frac{\\partial u_y}{\\partial x} + \\left(\\frac{\\partial u_y}{\\partial y}\\right)^2 = \\left(\\frac{\\partial u_x}{\\partial x}\\right)^2 + 2 \\frac{\\partial u_x}{\\partial y} \\frac{\\partial u_y}{\\partial x} + \\left(\\frac{\\partial u_y}{\\partial y}\\right)^2\n$$\n现在，每个一阶偏导数都使用二阶中心差分格式在内部点 $(i,j)$ 处进行离散化：\n$$\n\\left(\\frac{\\partial f}{\\partial x}\\right)_{i,j} \\approx \\frac{f_{i+1,j} - f_{i-1,j}}{2h}, \\quad \\left(\\frac{\\partial f}{\\partial y}\\right)_{i,j} \\approx \\frac{f_{i,j+1} - f_{i,j-1}}{2h}\n$$\n将这些代入 $S$ 的表达式中，得到所有内部点的离散源项 $S_{i,j}$。\n\n结合离散拉普拉斯算子和离散源项，我们得到关于内部点未知压力值 $p_{i,j}$ 的线性代数方程组：\n$$\n\\frac{p_{i+1,j} + p_{i-1,j} + p_{i,j+1} + p_{i,j-1} - 4p_{i,j}}{h^2} = S_{i,j}\n$$\n为求解该方程组，我们构建一个带有逐次超松弛（SOR）的高斯-赛德尔迭代。我们重新排列方程以求解 $p_{i,j}$：\n$$\np_{i,j} = \\frac{1}{4} \\left( p_{i+1,j} + p_{i-1,j} + p_{i,j+1} + p_{i,j-1} - h^2 S_{i,j} \\right)\n$$\nSOR 方法根据第 $k$ 次迭代的值和一个临时的高斯-赛德尔更新值 $p_{i,j}^*$ 来更新第 $k+1$ 次迭代的值。在对网格的一次扫描中（例如，先增加 $i$ 再增加 $j$），使用的是最新更新的值：\n$$\np_{i,j}^* = \\frac{1}{4} \\left( p_{i+1,j}^{(k)} + p_{i-1,j}^{(k+1)} + p_{i,j+1}^{(k)} + p_{i,j-1}^{(k+1)} - h^2 S_{i,j} \\right)\n$$\n于是，SOR 更新公式为：\n$$\np_{i,j}^{(k+1)} = (1 - \\omega) p_{i,j}^{(k)} + \\omega p_{i,j}^*\n$$\n其中 $\\omega$ 是松弛因子。当 $\\omega=1$ 时，该方法退化为标准的高斯-赛德尔迭代。\n\n当满足以下两个条件之一时，迭代过程终止：达到最大迭代次数 $M$，或离散残差的均方根（RMS）值低于指定的容差 $\\tau$。内部点的离散残差 $R_{i,j}$ 定义为离散泊松方程左右两侧之差：\n$$\nR_{i,j} = \\frac{p_{i+1,j} + p_{i-1,j} + p_{i,j+1} + p_{i,j-1} - 4p_{i,j}}{h^2} - S_{i,j}\n$$\n均方根残差是在所有 $(N-2)^2$ 个内部点上计算的：\n$$\n\\text{RMS}(R) = \\sqrt{\\frac{1}{(N-2)^2} \\sum_{i=1}^{N-2} \\sum_{j=1}^{N-2} (R_{i,j})^2}\n$$\n步骤如下：\n1. 初始化网格、参数以及速度场 $u_x$ 和 $u_y$。\n2. 计算所有内部点的源项数组 $S_{i,j}$。\n3. 初始化压力场 $p_{i,j} = 0$（对所有 $i,j$），这满足了边界条件。\n4. 开始迭代循环：\n    a. 对每个内部点 $(i,j)$，使用 SOR 公式更新 $p_{i,j}$。\n    b. 完成一次完整扫描后，计算所有内部点上残差的均方根值。\n    c. 如果 $\\text{RMS}(R)  \\tau$ 或迭代次数达到 $M$，则终止循环。\n5. 报告最终的均方根残差。\n\n此算法将被实现，用于求解每个指定测试用例的压力场。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_case(N, omega, tau, M, velocity_case):\n    \"\"\"\n    Solves the pressure Poisson equation for a single test case.\n    \"\"\"\n    # 1. Grid and field setup\n    h = 1.0 / (N - 1)\n    x = np.linspace(0.0, 1.0, N)\n    y = np.linspace(0.0, 1.0, N)\n    # Use 'ij' indexing to match mathematical notation (i for x, j for y)\n    X, Y = np.meshgrid(x, y, indexing='ij')\n\n    # Generate velocity fields\n    if velocity_case == 'A':\n        # Solid-body rotation: u_x = -y, u_y = x\n        ux = -Y\n        uy = X\n    elif velocity_case == 'B':\n        # Streamfunction: psi = sin(pi*x)*sin(pi*y)\n        # u_x = d(psi)/dy, u_y = -d(psi)/dx\n        pi = np.pi\n        ux = pi * np.sin(pi * X) * np.cos(pi * Y)\n        uy = -pi * np.cos(pi * X) * np.sin(pi * Y)\n    elif velocity_case == 'C':\n        # Uniform flow: u_x = 1, u_y = 0\n        ux = np.ones((N, N))\n        uy = np.zeros((N, N))\n    else:\n        raise ValueError(\"Invalid velocity case specified.\")\n\n    # 2. Compute source term S\n    S = np.zeros((N, N))\n    inv_2h = 1.0 / (2.0 * h)\n\n    # Loop over interior points only\n    for i in range(1, N - 1):\n        for j in range(1, N - 1):\n            dux_dx = (ux[i + 1, j] - ux[i - 1, j]) * inv_2h\n            dux_dy = (ux[i, j + 1] - ux[i, j - 1]) * inv_2h\n            duy_dx = (uy[i + 1, j] - uy[i - 1, j]) * inv_2h\n            duy_dy = (uy[i, j + 1] - uy[i, j - 1]) * inv_2h\n            \n            S[i, j] = dux_dx**2 + 2 * dux_dy * duy_dx + duy_dy**2\n\n    # 3. Initialize pressure field\n    p = np.zeros((N, N)) # Homogeneous Dirichlet BCs are automatically satisfied\n\n    h2 = h * h\n    \n    # 4. SOR Iteration\n    rms_residual = 0.0\n    for k in range(M):\n        # Update interior points\n        for i in range(1, N - 1):\n            for j in range(1, N - 1):\n                p_old_ij = p[i, j]\n                p_gs = 0.25 * (p[i + 1, j] + p[i - 1, j] + p[i, j + 1] + p[i, j - 1] - h2 * S[i, j])\n                p[i, j] = (1.0 - omega) * p_old_ij + omega * p_gs\n        \n        # Calculate residual after a full sweep\n        # Vectorized calculation for residual is more efficient\n        lap_p = (p[2:, 1:-1] + p[:-2, 1:-1] + p[1:-1, 2:] + p[1:-1, :-2] - 4 * p[1:-1, 1:-1]) / h2\n        residual_field = lap_p - S[1:-1, 1:-1]\n        \n        rms_residual = np.sqrt(np.mean(residual_field**2))\n\n        if rms_residual  tau:\n            break\n            \n    return rms_residual\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        # (N, omega, tau, M, velocity_case_name)\n        (33, 1.6, 1e-8, 8000, 'A'),\n        (33, 1.8, 1e-8, 8000, 'B'),\n        (17, 1.6, 1e-8, 4000, 'C'),\n    ]\n\n    results = []\n    for params in test_cases:\n        N, omega, tau, M, case_name = params\n        final_residual = run_case(N, omega, tau, M, case_name)\n        results.append(final_residual)\n\n    # Format output as specified\n    print(f\"[{','.join(f'{r:.6e}' for r in results)}]\")\n\nsolve()\n\n```", "id": "2397063"}, {"introduction": "在实际的计算流体动力学（CFD）应用中，有限体积法（FVM）因其良好的守恒性而被广泛采用。这项高级练习[@problem_id:3434688]将挑战您实现一个基于有限体积法的压力泊松方程求解器。练习的核心在于处理计算中至关重要且技巧性强的边界条件，包括狄利克雷（Dirichlet）和诺伊曼（Neumann）边界，并深入探讨纯诺伊曼问题所必须满足的可解性约束条件。完成此练习将使您具备处理真实CFD场景中复杂边界问题的关键能力。", "problem": "考虑用于不可压缩投影法的压力泊松方程 (PPE)，该方程构建于二维矩形域上，并通过均匀、单元中心网格上的有限体积法进行离散。数学模型和数值公式必须从第一性原理推导，从散度定理和控制体上的通量守恒开始。控制方程是压力场 $p$ 的泊松方程，形式为 $\\nabla^{2} p = f$，定义在矩形域 $\\Omega = [0,L_x] \\times [0,L_y]$ 上，其中 $f$ 是给定的源场。边界表示为 $\\partial \\Omega$，其单位外法向量为 $\\mathbf{n}$。在每条边上都规定了边界条件：狄利克雷 (Dirichlet) 条件 $p = p_D$ 或诺伊曼 (Neumann) 条件 $\\frac{\\partial p}{\\partial n} = g$。目标是通过将诺伊曼项表示为边界面通量，并将边界条件纳入有限体积 PPE，以及通过验证全局通量平衡来确保可解性。\n\n您必须从以下基本原理推导有限体积离散化：\n- 散度定理（高斯定理）：对于足够光滑的向量场 $\\mathbf{q}$，有 $\\int_{\\Omega} \\nabla \\cdot \\mathbf{q}\\, d\\Omega = \\int_{\\partial \\Omega} \\mathbf{q}\\cdot \\mathbf{n}\\, dS$。\n- 拉普拉斯算子的定义为梯度的散度：$\\nabla^{2} p = \\nabla \\cdot (\\nabla p)$。\n- 每个控制体上的有限体积平衡：各面通量之和等于源项的体积积分。\n\n在一个具有 $N_x \\times N_y$ 个矩形控制体的均匀网格上，单元间距为 $\\Delta x = L_x/N_x$ 和 $\\Delta y = L_y/N_y$，您必须：\n- 通过使用单元中心差值除以中心间距来线性近似法向梯度，再乘以面面积，从而表示穿过每个内表面的离散面通量。这将为每个面产生与 $A/d$ 成比例的贡献系数。\n- 对于狄利克雷边界，将边界面视为贡献一个由面上已知边界值驱动的已知通量项，使用从单元中心到边界面（单元间距的一半）的距离来定义乘以给定 $p_D$ 的适当 $A/d$ 系数。\n- 对于诺伊曼边界，将边界条件作为面上给定的法向梯度 $\\frac{\\partial p}{\\partial n} = g$ 纳入，并将相应的已知通量 $g \\, A$ 插入到相邻边界控制体的方程右侧。\n- 为未知的单元中心压力值组装最终的线性系统。\n\n对于纯诺伊曼边界条件，必须使用从散度定理推导出的积分相容性条件来验证全局可解性，该条件指出，当所有边界均为诺伊曼条件时，源项在域上的积分必须等于法向导数在边界上的积分。在均匀网格上的离散形式中，这转化为检查 $f$ 乘以控制体面积之和是否在指定公差内等于 $g$ 乘以边界面长度之和。当存在任何狄利克雷边界时，线性系统应无需相容性条件即可适定；尽管如此，仍应计算并报告全局平衡。\n\n您的程序必须：\n- 根据上述原理和边界条件处理方法，为 PPE 构建有限体积线性系统。\n- 对于纯诺伊曼问题，通过将单个单元的压力约束到指定值（例如，零），实现规范固定（gauge fixing）以消除零空间（常数压力模式），从而为数值计算获得唯一解。在评估原始 PPE 平衡时，用于验证的残差必须排除被规范固定的行。\n- 计算并报告全局通量平衡失配，以及一个布尔值，用于指示纯诺伊曼边界条件下的可解性。\n- 求解线性系统并为 PPE 方程计算离散残差范数。\n\n所有量均为无量纲；不需要物理单位。\n\n测试套件定义：\n- 使用以下三个测试用例，每个用例由 $(N_x,N_y,L_x,L_y)$、恒定源 $f$ 以及西（$x=0$）、东（$x=L_x$）、南（$y=0$）和北（$y=L_y$）边界上的边界条件指定。对于狄利克雷边界，使用恒定的 $p_D$；对于诺伊曼边界，使用恒定的 $g$。\n\n1. 正常路径（混合边界条件）：\n    - $N_x = 10$, $N_y = 8$, $L_x = 1.0$, $L_y = 1.0$,\n    - $f = 0.0$,\n    - 西：狄利克雷 $p_D = 0.0$；东：狄利克雷 $p_D = 1.0$；南：诺伊曼 $g = 0.0$；北：诺伊曼 $g = 0.0$。\n\n2. 纯诺伊曼，全局一致：\n    - $N_x = 12$, $N_y = 12$, $L_x = 1.0$, $L_y = 2.0$,\n    - $f = 3.0$ (恒定),\n    - 西：诺伊曼 $g = 0.0$；东：诺伊曼 $g = 0.0$；南：诺伊曼 $g = 2.0$；北：诺伊曼 $g = 4.0$。\n    - 离散全局平衡条件应成立：$\\sum f \\Delta x \\Delta y \\approx \\sum g\\, A_{\\text{face}}$。\n\n3. 纯诺伊曼，全局不一致：\n    - $N_x = 16$, $N_y = 16$, $L_x = 1.0$, $L_y = 1.0$,\n    - $f = 1.0$ (恒定),\n    - 西：诺伊曼 $g = 0.0$；东：诺伊曼 $g = 0.0$；南：诺伊曼 $g = 0.0$；北：诺伊曼 $g = 0.0$。\n    - 离散全局平衡条件应不成立：$\\sum f \\Delta x \\Delta y \\not\\approx \\sum g\\, A_{\\text{face}}$。\n\n输出规范：\n- 对于每个测试用例，生成一个三元列表 $[b, m, r]$，其中 $b$ 是一个布尔值，指示可解性（对于纯诺伊曼情况，如果全局平衡在公差范围内成立，则为 true；对于混合边界情况，始终为 true），$m$ 是一个浮点数，等于绝对失配 $|\\sum f \\Delta x \\Delta y - \\sum g A_{\\text{face}}|$，而 $r$ 是一个浮点数，等于每个单元原始 PPE 方程的离散 $\\ell_2$ 范数（对于纯诺伊曼情况，在计算残差范数时排除被规范固定的行）。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，格式为 $[[b_1,m_1,r_1],[b_2,m_2,r_2],[b_3,m_3,r_3]]$。\n\n数值公差：\n- 在确定纯诺伊曼情况下的可解性布尔值 $b$ 时，使用 $10^{-10}$ 的平衡公差。", "solution": "用户提供的问题被评估为有效。这是一个在数值偏微分方程领域中定义明确的问题，具体涉及压力泊松方程 (PPE) 的有限体积离散化。该问题自成体系，具有科学依据，并为三个不同的测试用例提供了所有必要的数据和边界条件，涵盖了混合边界条件、一个适定的纯诺伊曼问题和一个不适定的纯诺伊曼问题。关于从第一性原理推导、边界条件实现和验证的说明清晰且在数学上是合理的。\n\n### 有限体积离散化的推导\n\n控制方程是二维域 $\\Omega = [0,L_x] \\times [0,L_y]$ 上的压力 $p(\\mathbf{x})$ 的泊松方程：\n$$ \\nabla^2 p = f $$\n其中 $f$ 是给定的源项。使用恒等式 $\\nabla^2 p = \\nabla \\cdot (\\nabla p)$，我们可以将该方程写成守恒形式。有限体积法首先将此方程在一个以 $(x_i, y_j)$ 为中心的控制体（或单元）$V_{i,j}$ 上积分：\n$$ \\int_{V_{i,j}} \\nabla \\cdot (\\nabla p) \\,dV = \\int_{V_{i,j}} f \\,dV $$\n对左侧应用散度定理，将体积积分转换为控制体边界 $\\partial V_{i,j}$ 上的面积分：\n$$ \\oint_{\\partial V_{i,j}} (\\nabla p) \\cdot \\mathbf{n} \\,dS = \\int_{V_{i,j}} f \\,dV $$\n其中 $\\mathbf{n}$ 是表面 $\\partial V_{i,j}$ 上的单位外法向量。\n\n网格是均匀且以单元为中心的，有 $N_x \\times N_y$ 个单元。单元尺寸为 $\\Delta x = L_x/N_x$ 和 $\\Delta y = L_y/N_y$，因此单元 $V_{i,j}$ 的体积（在二维中为面积）是 $\\Delta V = \\Delta x \\Delta y$。压力 $p_{i,j}$ 代表单元中心的值。面积分是穿过矩形单元四个面（东、西、北、南）的通量之和：\n$$ F_e + F_w + F_n + F_s = f_{i,j} \\Delta x \\Delta y $$\n其中 $F_k$ 是流出面 $k$ 的总通量。对于一个内表面，例如单元 $(i,j)$ 和 $(i+1,j)$ 之间的东面，通量使用梯度的二阶中心差分来近似：\n$$ F_e = \\int_{\\text{east face}} (\\nabla p \\cdot \\mathbf{e}_x) \\,dS \\approx \\left(\\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}\\right) \\Delta y $$\n类似地，一个内部单元其他面的通量为：\n$$ F_w = \\int_{\\text{west face}} (\\nabla p \\cdot (-\\mathbf{e}_x)) \\,dS \\approx -\\left(\\frac{p_{i,j} - p_{i-1,j}}{\\Delta x}\\right) \\Delta y $$\n$$ F_n = \\int_{\\text{north face}} (\\nabla p \\cdot \\mathbf{e}_y) \\,dS \\approx \\left(\\frac{p_{i,j+1} - p_{i,j}}{\\Delta y}\\right) \\Delta x $$\n$$ F_s = \\int_{\\text{south face}} (\\nabla p \\cdot (-\\mathbf{e}_y)) \\,dS \\approx -\\left(\\frac{p_{i,j} - p_{i,j-1}}{\\Delta y}\\right) \\Delta x $$\n将这些代入平衡方程，得到拉普拉斯算子的标准五点格式：\n$$ \\frac{\\Delta y}{\\Delta x}(p_{i+1,j} - 2p_{i,j} + p_{i-1,j}) + \\frac{\\Delta x}{\\Delta y}(p_{i,j+1} - 2p_{i,j} + p_{i,j-1}) = f_{i,j} \\Delta x \\Delta y $$\n该方程构成了线性系统 $A\\mathbf{p} = \\mathbf{b}$ 中的一行，其中 $\\mathbf{p}$ 是未知单元中心压力的向量。对于一维索引为 $k = j \\cdot N_x + i$ 的内部单元 $(i,j)$：\n- 对角线系数：$A_{k,k} = -2\\left(\\frac{\\Delta y}{\\Delta x} + \\frac{\\Delta x}{\\Delta y}\\right)$\n- 非对角线系数：$A_{k, k\\pm 1} = \\frac{\\Delta y}{\\Delta x}$（对于东/西邻居），$A_{k, k\\pm N_x} = \\frac{\\Delta x}{\\Delta y}$（对于南/北邻居）。\n- 右侧项：$b_k = f_{i,j} \\Delta x \\Delta y$。\n\n#### 边界条件\n\n对于与域边界相邻的单元，必须修改一个或多个通量项。\n\n**1. 诺伊曼边界条件**：\n法向导数是给定的，$\\frac{\\partial p}{\\partial n} = g$。穿过边界面上的通量是直接指定的。例如，在东边界（$x=L_x$），外法向量为 $\\mathbf{n}=\\mathbf{e}_x$，因此 $\\frac{\\partial p}{\\partial x}=g_e$。流出单元 $(N_x-1, j)$ 东面的通量是：\n$$ F_e = \\int_{\\text{east face}} (\\nabla p \\cdot \\mathbf{e}_x) \\,dS = \\int g_e \\,dS = g_e \\Delta y $$\n这是一个已知值。通量平衡变为 $F_w + F_n + F_s + g_e \\Delta y = f_{N_x-1,j} \\Delta x \\Delta y$。已知通量项移到右侧，因此 $b_k$ 被修改为：$b_k \\rightarrow b_k - g_e \\Delta y$。类似的修改适用于其他诺伊曼边界，但需注意外法向量的方向。\n\n**2. 狄利克雷边界条件**：\n压力是给定的， $p=p_D$。通量使用单元中心和边界之间的单边差分来近似。对于单元 $(N_x-1, j)$ 的东面，该面位于 $x=L_x$，而单元中心位于 $x=L_x-\\frac{\\Delta x}{2}$。梯度为 $\\frac{\\partial p}{\\partial x} \\approx \\frac{p_D - p_{N_x-1,j}}{\\Delta x/2}$。通量为：\n$$ F_e = \\left(\\frac{p_D - p_{N_x-1,j}}{\\Delta x/2}\\right) \\Delta y = 2\\frac{\\Delta y}{\\Delta x}(p_D - p_{N_x-1,j}) $$\n此表达式包含未知量 $p_{N_x-1,j}$ 和已知量 $p_D$。涉及未知量的项修改了矩阵 $A$ 的对角元素：$A_{k,k} \\rightarrow A_{k,k} - 2\\frac{\\Delta y}{\\Delta x}$。涉及已知值的项修改了右侧向量：$b_k \\rightarrow b_k - 2\\frac{\\Delta y}{\\Delta x}p_D$。\n\n### 可解性与规范固定\n\n对于纯诺伊曼问题，矩阵 $A$ 是奇异的，其零空间对应于常数压力场（即，如果 $\\mathbf{c}$ 是一个常数向量，则 $A\\mathbf{c} = \\mathbf{0}$）。仅当右侧向量 $\\mathbf{b}$ 与 $A^T$ 的零空间正交时，解才存在。这引出了相容性条件，其连续形式为：\n$$ \\int_{\\Omega} f \\,dV = \\oint_{\\partial \\Omega} \\frac{\\partial p}{\\partial n} \\,dS $$\n在离散形式中，通过比较所有源项之和与所有给定边界通量之和来检查此条件：\n$$ \\sum_{i,j} f_{i,j} \\Delta x \\Delta y = \\sum_{\\text{bnd faces}} g_k A_k $$\n如果此条件成立，可以通过“规范固定”（即约束一个压力值）来获得唯一解。我们通过修改线性系统的第一行，将其变为 $1 \\cdot p_{0,0} = 0$，从而设定 $p_{0,0}=0$。\n\n### 残差计算\n\n在求解（可能已修改的）系统 $A'\\mathbf{p} = \\mathbf{b}'$ 得到 $\\mathbf{p}$ 后，通过计算*原始*方程的残差 $\\mathbf{r}_{\\text{vec}} = A\\mathbf{p} - \\mathbf{b}$ 来评估解的质量。然后，每个单元的离散 $\\ell_2$ 范数计算为残差向量分量的均方根 (RMS)。对于纯诺伊曼问题，与规范固定单元对应的方程被排除在此计算之外，因为它被人为地修改了。\n$$ r = \\sqrt{\\frac{1}{N_{\\text{eq}}} \\sum_{k \\in \\text{non-gauged}} ( (A\\mathbf{p})_k - b_k )^2} $$\n其中 $N_{\\text{eq}}$ 是求和中的方程数（对于混合边界条件情况为 $N_x N_y$，对于纯诺伊曼情况为 $N_x N_y - 1$）。", "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve_ppe_fv(Nx, Ny, Lx, Ly, f_val, bc_west, bc_east, bc_south, bc_north):\n    \"\"\"\n    Solves the 2D Pressure Poisson Equation using a cell-centered finite volume method.\n\n    The implemented linear system corresponds to a discretization of Nabla^2 p = f.\n    \"\"\"\n    dx = Lx / Nx\n    dy = Ly / Ny\n    N = Nx * Ny\n\n    # --- 1. Global Balance Check ---\n    source_integral = f_val * Lx * Ly\n    flux_integral = 0.0\n    \n    is_pure_neumann = True\n    bcs = {'W': bc_west, 'E': bc_east, 'S': bc_south, 'N': bc_north}\n    lengths = {'W': Ly, 'E': Ly, 'S': Lx, 'N': Lx}\n\n    for direction, bc in bcs.items():\n        if bc[0] == 'N':\n            flux_integral += bc[1] * lengths[direction]\n        else:\n            is_pure_neumann = False\n    \n    mismatch = abs(source_integral - flux_integral)\n    balance_tol = 1e-10\n    \n    if is_pure_neumann:\n        is_solvable = mismatch  balance_tol\n    else:\n        is_solvable = True\n\n    # --- 2. Assemble Linear System A*p = b ---\n    A = lil_matrix((N, N), dtype=float)\n    b = np.full(N, f_val * dx * dy, dtype=float)\n\n    Cx = dy / dx\n    Cy = dx / dy\n\n    for j in range(Ny):\n        for i in range(Nx):\n            k = j * Nx + i\n            \n            # South face\n            if j  0:\n                A[k, k] -= Cy\n                A[k, k - Nx] += Cy\n            else: # South boundary\n                bc_type, bc_val = bc_south\n                if bc_type == 'D':\n                    A[k, k] -= 2 * Cy\n                    b[k] -= 2 * Cy * bc_val\n                elif bc_type == 'N': # dp/dn = -dp/dy = g_s\n                    b[k] -= bc_val * dx\n\n            # North face\n            if j  Ny - 1:\n                A[k, k] -= Cy\n                A[k, k + Nx] += Cy\n            else: # North boundary\n                bc_type, bc_val = bc_north\n                if bc_type == 'D':\n                    A[k, k] -= 2 * Cy\n                    b[k] -= 2 * Cy * bc_val\n                elif bc_type == 'N': # dp/dn = dp/dy = g_n\n                    b[k] -= bc_val * dx\n            \n            # West face\n            if i  0:\n                A[k, k] -= Cx\n                A[k, k - 1] += Cx\n            else: # West boundary\n                bc_type, bc_val = bc_west\n                if bc_type == 'D':\n                    A[k, k] -= 2 * Cx\n                    b[k] -= 2 * Cx * bc_val\n                elif bc_type == 'N': # dp/dn = -dp/dx = g_w\n                    b[k] -= bc_val * dy\n\n            # East face\n            if i  Nx - 1:\n                A[k, k] -= Cx\n                A[k, k + 1] += Cx\n            else: # East boundary\n                bc_type, bc_val = bc_east\n                if bc_type == 'D':\n                    A[k, k] -= 2 * Cx\n                    b[k] -= 2 * Cx * bc_val\n                elif bc_type == 'N': # dp/dn = dp/dx = g_e\n                    b[k] -= bc_val * dy\n\n    A_orig = A.copy().tocsr()\n    b_orig = b.copy()\n    \n    # --- 3. Gauge Fixing for Pure Neumann case ---\n    if is_pure_neumann:\n        gauge_idx = 0\n        A[gauge_idx, :] = 0\n        A[gauge_idx, gauge_idx] = 1.0\n        b[gauge_idx] = 0.0\n\n    # --- 4. Solve the linear system ---\n    A_csr = A.tocsr()\n    try:\n        p = spsolve(A_csr, b)\n    except Exception as e:\n        # Fallback for numerically singular cases\n        p = np.zeros(N)\n\n    # --- 5. Compute Residual Norm ---\n    res_vec = (A_orig @ p) - b_orig\n    \n    if is_pure_neumann:\n        res_sum_sq = np.sum(np.delete(res_vec, gauge_idx)**2)\n        num_eq = N - 1\n    else:\n        res_sum_sq = np.sum(res_vec**2)\n        num_eq = N\n    \n    residual_norm = np.sqrt(res_sum_sq / num_eq) if num_eq  0 else 0.0\n\n    return [is_solvable, mismatch, residual_norm]\n\ndef solve():\n    \"\"\"\n    Main function to run the test cases and print the results.\n    \"\"\"\n    test_cases = [\n        {\n            \"params\": (10, 8, 1.0, 1.0, 0.0),\n            \"bcs\": {\n                \"bc_west\": ('D', 0.0), 'bc_east': ('D', 1.0),\n                'bc_south': ('N', 0.0), 'bc_north': ('N', 0.0)\n            }\n        },\n        {\n            \"params\": (12, 12, 1.0, 2.0, 3.0),\n            \"bcs\": {\n                \"bc_west\": ('N', 0.0), 'bc_east': ('N', 0.0),\n                'bc_south': ('N', 2.0), 'bc_north': ('N', 4.0)\n            }\n        },\n        {\n            \"params\": (16, 16, 1.0, 1.0, 1.0),\n            \"bcs\": {\n                \"bc_west\": ('N', 0.0), 'bc_east': ('N', 0.0),\n                'bc_south': ('N', 0.0), 'bc_north': ('N', 0.0)\n            }\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        Nx, Ny, Lx, Ly, f_val = case[\"params\"]\n        bcs = case[\"bcs\"]\n        result = solve_ppe_fv(Nx, Ny, Lx, Ly, f_val, **bcs)\n        results.append(f\"[{result[0]},{result[1]},{result[2]}]\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3434688"}]}