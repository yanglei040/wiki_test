{"hands_on_practices": [{"introduction": "我们从一个动手编程练习开始。通过对比实现一个朴素的中心差分格式和一个类似 Rhie-Chow 插值的虚拟交错格式，你将亲眼见证一个设计不佳的同位网格格式如何导致压力-速度解耦，以及修正后的插值方法如何通过正确地“感知”高频压力振荡来有效解决这个问题。这个练习直观地展示了压力棋盘格问题的根源和一种经典的解决方案 [@problem_id:3372220]。", "problem": "考虑二维周期性单位正方形域上的稳态、不可压缩斯托克斯方程，两个方向上的网格间距均一。未知量为网格中心的速度分量和压力，其中速度分量与压力采用同位网格布置。控制方程为动量平衡和连续性条件：$$\\mu \\nabla^2 \\mathbf{u} - \\nabla p = \\mathbf{0}, \\quad \\nabla \\cdot \\mathbf{u} = 0,$$ 其中 $\\mathbf{u} = (u,v)$ 是速度，$p$ 是压力，$\\mu > 0$ 是动力粘度。在同位网格上对动量方程进行紧凑半离散建模时，通常将离散动量算子简化为一个对角系数 $a > 0$，使得预测的网格中心速度通过以下方式与离散压力梯度相关联：$$a\\,u_{i,j} \\approx -\\left.\\frac{\\partial p}{\\partial x}\\right|_{i,j}, \\quad a\\,v_{i,j} \\approx -\\left.\\frac{\\partial p}{\\partial y}\\right|_{i,j},$$ 适用于所有内部网格 $(i,j)$，且在两个方向上均采用周期性边界条件。在此背景下，一种通过平均相邻网格中心速度来形成网格面上质量通量的纯同位中心格式，已知会产生一种伪高频压力模态（压力棋盘格），该模态使压力与连续性方程解耦。为避免此问题，同时在速度场重构中保持二阶中心精度，可以采用一种紧凑有限差分方法构建虚拟交错格式（一种通过使用面心压力差分来模拟交错耦合的格式）。\n\n你的任务是为同位网格实现、测试和量化两种面速度重构方法的效果：\n1. 一种朴素的同位中心重构方法，通过平均相邻网格中心的速度来计算面速度，而网格中心的速度则由网格中心的压力紧凑中心差分计算得出。\n2. 一种虚拟交错重构（类似Rhie–Chow的动量插值），它使用紧凑的二阶面心压力差分直接由压力形成面速度，与网格中心平均解耦。\n\n使用的定义和离散算子：\n- 设 $N_x$ 和 $N_y$ 分别为 $x$ 和 $y$ 方向的网格单元数量。均匀间距为 $\\Delta x = 1/N_x$ 和 $\\Delta y = 1/N_y$。\n- 网格中心位于 $(x_i,y_j) = ((i+1/2)\\Delta x,(j+1/2)\\Delta y)$，其中 $i=0,\\dots,N_x-1$, $j=0,\\dots,N_y-1$，采用周期性索引。\n- 定义交替（棋盘格）压力模态为 $p_{i,j} = (-1)^{i+j}$，在每个网格中心 $(i,j)$ 处。\n- 在网格中心为压力梯度定义紧凑二阶中心差分：$$\\left.\\frac{\\partial p}{\\partial x}\\right|_{i,j} \\approx \\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x}, \\quad \\left.\\frac{\\partial p}{\\partial y}\\right|_{i,j} \\approx \\frac{p_{i,j+1} - p_{i,j-1}}{2\\Delta y}.$$ 此处使用周期性索引。\n- 朴素的同位网格面速度使用平均的网格中心速度：$$u_{i+1/2,j}^{\\text{naive}} = \\frac{1}{2}(u_{i,j} + u_{i+1,j}), \\quad v_{i,j+1/2}^{\\text{naive}} = \\frac{1}{2}(v_{i,j} + v_{i,j+1}),$$ 其中 $u_{i,j} = -\\frac{1}{a}\\left.\\frac{\\partial p}{\\partial x}\\right|_{i,j}$ 且 $v_{i,j} = -\\frac{1}{a}\\left.\\frac{\\partial p}{\\partial y}\\right|_{i,j}$。\n- 虚拟交错面速度使用在面上求值的紧凑二阶压力差分：$$u_{i+1/2,j}^{\\text{vs}} = -\\frac{1}{a}\\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}, \\quad v_{i,j+1/2}^{\\text{vs}} = -\\frac{1}{a}\\frac{p_{i,j+1} - p_{i,j}}{\\Delta y}.$$ 该公式通过将跨面的压力跳跃直接与质量通量联系起来，模拟了交错耦合。\n- 每个网格中心的离散散度由面质量通量计算得出：$$\\left.(\\nabla \\cdot \\mathbf{u})\\right|_{i,j} \\approx \\frac{u_{i+1/2,j} - u_{i-1/2,j}}{\\Delta x} + \\frac{v_{i,j+1/2} - v_{i,j-1/2}}{\\Delta y},$$ 同样使用周期性索引。\n\n此外，你必须验证对于光滑场的速度重构，在面法向分量上保持了二阶中心精度。考虑一个无压力强迫项的、构造的光滑周期性速度场 $$u(x,y) = \\sin(2\\pi x)\\cos(2\\pi y),$$，并通过对相邻网格中心值进行紧凑二阶中心平均来重构 $x$ 方向的面速度 $$u_{i+1/2,j}^{\\text{rec}} = \\frac{1}{2}\\left(u_{i,j}^{\\text{cc}} + u_{i+1,j}^{\\text{cc}}\\right),$$，其中 $u_{i,j}^{\\text{cc}} = u(x_i,y_j)$ 且精确的面值为 $u(x_{i+1/2},y_j)$。使用周期性索引。通过计算两种不同网格分辨率 $(N_x,N_y)=(16,16)$ 和 $(32,32)$ 下的离散 $\\ell^2$ 误差，并构成 $$p = \\log_2\\left(\\frac{E_{16}}{E_{32}}\\right),$$ 来量化观测到的精度阶 $p$，其中 $E_{N}$ 是在 $N\\times N$ 网格上重构的 $x$ 方向面速度的离散 $\\ell^2$ 误差。\n\n实现一个程序，遵循其他地方描述的执行环境约束，执行以下测试套件：\n\n- 测试用例 1 (正常路径消除)：$N_x=32$, $N_y=32$, $a=1.0$。使用棋盘格压力，计算朴素同位格式和虚拟交错格式下的离散散度 $\\ell^2$ 范数。如果朴素格式的散度范数小于 $10^{-12}$ 且虚拟交错格式的散度范数大于 $10^{-3}$，则输出布尔值 true。\n- 测试用例 2 (参数变化)：$N_x=16$, $N_y=16$, $a=0.5$。使用棋盘格压力，如果朴素格式的散度范数小于 $10^{-12}$ 且虚拟交错格式的散度范数大于 $10^{-3}$，则输出布尔值 true。\n- 测试用例 3 ($u$ 的精度)：对于任意（未使用）的 $a$，使用 $u(x,y) = \\sin(2\\pi x)\\cos(2\\pi y)$ 计算在 $(N_x,N_y)=(16,16)$ 和 $(32,32)$ 分辨率下重构的 $x$ 方向面速度误差，并输出观测到的精度阶 $p$，作为浮点数，四舍五入到六位小数。\n- 测试用例 4 (小尺寸网格)：$N_x=4$, $N_y=4$, $a=1.0$。使用棋盘格压力，如果朴素格式的散度范数小于 $10^{-12}$ 且虚拟交错格式的散度范数大于 $10^{-3}$，则输出布尔值 true。\n\n最终输出格式：\n你的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，\"[result1,result2,result3,result4]\"），其中第一、第二和第四个条目是如上所述的布尔值，第三个条目是四舍五入到六位小数的浮点数 $p$。", "solution": "该问题要求在稳态、不可压缩斯托克斯方程的背景下，分析并实现两种用于在同位网格上计算面速度的不同有限差分格式。目标是展示与朴素中心差分格式相关的著名压力-速度解耦问题，以及一种类似Rhie-Chow的动量插值方法（此处称为“虚拟交错”格式）如何解决该问题。该分析通过评估由高频棋盘格压力模态产生的离散散度来进行。此外，还评估了针对光滑场的一种相关速度重构的精度。\n\n首先，问题的核心在于构造离散散度算子，该算子构成了离散的压力泊松方程。该算子的性质决定了某些压力模态（如棋盘格模式）是否能通过连续性方程与速度场正确耦合。\n\n令压力场为棋盘格模态，定义为 $p_{i,j} = (-1)^{i+j}$，适用于所有网格单元 $(i,j)$，其索引分别对 $N_x$ 和 $N_y$ 取模。我们在此压力场下分析指定的两种格式。\n\n**1. 朴素同位中心格式**\n\n该格式首先使用紧凑的二阶中心差分计算压力梯度，从而得到网格中心的速度。对于网格单元 $(i,j)$ 处的速度 $x$ 分量：\n$$u_{i,j} = -\\frac{1}{a} \\left(\\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x}\\right)$$\n当应用棋盘格压力 $p_{i,j} = (-1)^{i+j}$ 时，我们有 $p_{i+1,j} = (-1)^{i+1+j} = -(-1)^{i+j} = -p_{i,j}$，类似地，$p_{i-1,j} = (-1)^{i-1+j} = -(-1)^{i+j} = -p_{i,j}$。因此，离散压力梯度为：\n$$\\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x} = \\frac{-p_{i,j} - (-p_{i,j})}{2\\Delta x} = 0$$\n此式对任何 $(i,j)$ 均成立。根据对称性，$y$ 方向的梯度也为零。因此，计算出的网格中心速度处处为零：$u_{i,j} = 0$ 且 $v_{i,j} = 0$。\n\n接下来，通过平均相邻的网格中心速度来计算面速度：\n$$u_{i+1/2,j}^{\\text{naive}} = \\frac{1}{2}(u_{i,j} + u_{i+1,j}) = \\frac{1}{2}(0 + 0) = 0$$\n$$v_{i,j+1/2}^{\\text{naive}} = \\frac{1}{2}(v_{i,j} + v_{i,j+1}) = \\frac{1}{2}(0 + 0) = 0$$\n最后，从这些面速度计算网格单元 $(i,j)$ 处的离散散度：\n$$\\left.(\\nabla \\cdot \\mathbf{u})\\right|_{i,j} = \\frac{u_{i+1/2,j}^{\\text{naive}} - u_{i-1/2,j}^{\\text{naive}}}{\\Delta x} + \\frac{v_{i,j+1/2}^{\\text{naive}} - v_{i,j-1/2}^{\\text{naive}}}{\\Delta y} = \\frac{0 - 0}{\\Delta x} + \\frac{0-0}{\\Delta y} = 0$$\n对于棋盘格压力模态，离散散度恒等于零。这意味着一个非物理的高频压力场不会产生散度，使其对连续性方程“不可见”。这种模态是离散算子的一个零空间解，它可以在不被修正的情况下污染数值解。这证明了该格式的失败。\n\n**2. 虚拟交错重构**\n\n该格式直接通过跨面的压力差来计算面速度，模拟了交错网格的布置。对于网格单元 $(i,j)$ 和 $(i+1,j)$ 之间的 $x$ 方向面：\n$$u_{i+1/2,j}^{\\text{vs}} = -\\frac{1}{a}\\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}$$\n应用棋盘格压力 $p_{i,j} = (-1)^{i+j}$：\n$$u_{i+1/2,j}^{\\text{vs}} = -\\frac{1}{a\\Delta x}(-p_{i,j} - p_{i,j}) = \\frac{2p_{i,j}}{a\\Delta x} = \\frac{2(-1)^{i+j}}{a\\Delta x}$$\n类似地，对于 $y$ 方向的面速度：\n$$v_{i,j+1/2}^{\\text{vs}} = -\\frac{1}{a}\\frac{p_{i,j+1} - p_{i,j}}{\\Delta y} = \\frac{2p_{i,j}}{a\\Delta y} = \\frac{2(-1)^{i+j}}{a\\Delta y}$$\n现在，我们计算网格单元 $(i,j)$ 处的离散散度：\n$$\\left.(\\nabla \\cdot \\mathbf{u})\\right|_{i,j} = \\frac{u_{i+1/2,j}^{\\text{vs}} - u_{i-1/2,j}^{\\text{vs}}}{\\Delta x} + \\frac{v_{i,j+1/2}^{\\text{vs}} - v_{i,j-1/2}^{\\text{vs}}}{\\Delta y}$$\n左侧面上的速度 $u_{i-1/2,j}^{\\text{vs}}$ 由 $u_{i-1/2,j}^{\\text{vs}} = \\frac{2(-1)^{(i-1)+j}}{a\\Delta x} = -\\frac{2(-1)^{i+j}}{a\\Delta x} = -u_{i+1/2,j}^{\\text{vs}}$ 给出。$y$ 方向速度也存在类似关系。将这些代入散度表达式中：\n$$\\left.(\\nabla \\cdot \\mathbf{u})\\right|_{i,j} = \\frac{1}{\\Delta x}\\left(\\frac{2p_{i,j}}{a\\Delta x} - \\left(-\\frac{2p_{i,j}}{a\\Delta x}\\right)\\right) + \\frac{1}{\\Delta y}\\left(\\frac{2p_{i,j}}{a\\Delta y} - \\left(-\\frac{2p_{i,j}}{a\\Delta y}\\right)\\right)$$\n$$\\left.(\\nabla \\cdot \\mathbf{u})\\right|_{i,j} = \\frac{4p_{i,j}}{a\\Delta x^2} + \\frac{4p_{i,j}}{a\\Delta y^2} = -\\frac{4}{a}\\left(\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2}\\right)(-1)^{i+j+1}$$\n这个结果非零，并且实际上其量值很大，与 $1/(\\Delta x^2)$ 成比例。该格式正确地将高频压力振荡转化为一个强的、非零的散度信号，使得压力修正算法能够有效抑制这种伪模态。\n\n**3. 速度重构的精度**\n\n第三个任务是评估对于一个光滑场，从网格中心值重构面速度的精度阶。重构公式为：\n$$u_{i+1/2,j}^{\\text{rec}} = \\frac{1}{2}\\left(u_{i,j}^{\\text{cc}} + u_{i+1,j}^{\\text{cc}}\\right)$$\n其中 $u_{i,j}^{\\text{cc}} = u(x_i,y_j)$ 是在网格中心采样的精确速度。面上的精确值为 $u(x_{i+1/2}, y_j)$。我们可以在面中心 $x_{i+1/2}$ 附近使用泰勒级数展开：\n$$u_{i,j}^{\\text{cc}} = u(x_{i+1/2} - \\Delta x/2, y_j) = u(x_{i+1/2},y_j) - \\frac{\\Delta x}{2} \\frac{\\partial u}{\\partial x} + \\frac{(\\Delta x)^2}{8} \\frac{\\partial^2 u}{\\partial x^2} - O(\\Delta x^3)$$\n$$u_{i+1,j}^{\\text{cc}} = u(x_{i+1/2} + \\Delta x/2, y_j) = u(x_{i+1/2},y_j) + \\frac{\\Delta x}{2} \\frac{\\partial u}{\\partial x} + \\frac{(\\Delta x)^2}{8} \\frac{\\partial^2 u}{\\partial x^2} + O(\\Delta x^3)$$\n平均这两个表达式可得：\n$$u_{i+1/2,j}^{\\text{rec}} = u(x_{i+1/2},y_j) + \\frac{(\\Delta x)^2}{8} \\frac{\\partial^2 u}{\\partial x^2}(x_{i+1/2},y_j) + O(\\Delta x^4)$$\n截断误差的主导项与 $(\\Delta x)^2$ 成正比。因此，该重构格式是二阶精度的。数值实验应通过计算精度阶 $p = \\log_2(E_{16}/E_{32})$ 来证实这一点，其中 $E_N$ 是在 $N \\times N$ 网格上的 $\\ell^2$ 误差。由于 $E_N \\propto (1/N)^2$，我们预期 $p \\approx \\log_2((1/16)^2 / (1/32)^2) = \\log_2( (32/16)^2 ) = \\log_2(2^2) = 2$。\n\n实现过程将通过使用 `numpy` 数组在均匀网格上离散化这些公式。周期性边界条件可使用 `numpy.roll` 高效处理。在 $N_x \\times N_y$ 网格上，离散场 $f_{i,j}$ 的 $\\ell^2$ 范数计算为 $\\sqrt{\\frac{1}{N_x N_y}\\sum_{i,j} f_{i,j}^2}$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_divergence_test(Nx, Ny, a):\n    \"\"\"\n    Computes the discrete divergence norm for the two schemes\n    given a checkerboard pressure field.\n    \"\"\"\n    dx = 1.0 / Nx\n    dy = 1.0 / Ny\n\n    # Create the checkerboard pressure field p_ij = (-1)^(i+j)\n    i_indices = np.arange(Nx)\n    j_indices = np.arange(Ny)\n    ii, jj = np.meshgrid(i_indices, j_indices)\n    p = (-1.0)**(ii + jj)\n\n    # --- 1. Naive Collocated Central Scheme ---\n\n    # Compute cell-centered pressure gradients using second-order central differences\n    # dp/dx|_{i,j} = (p_{i+1,j} - p_{i-1,j}) / (2*dx)\n    dpdx_cc = (np.roll(p, -1, axis=1) - np.roll(p, 1, axis=1)) / (2.0 * dx)\n    dpdy_cc = (np.roll(p, -1, axis=0) - np.roll(p, 1, axis=0)) / (2.0 * dy)\n\n    # Compute cell-centered velocities\n    u_cc = -dpdx_cc / a\n    v_cc = -dpdy_cc / a\n\n    # Compute face velocities by averaging cell-centered velocities\n    # u_{i+1/2,j} = 0.5 * (u_{i,j} + u_{i+1,j})\n    u_face_naive = 0.5 * (u_cc + np.roll(u_cc, -1, axis=1))\n    v_face_naive = 0.5 * (v_cc + np.roll(v_cc, -1, axis=0))\n\n    # Compute divergence from face velocities\n    # div_i,j = (u_{i+1/2,j} - u_{i-1/2,j})/dx + (v_{i,j+1/2} - v_{i,j-1/2})/dy\n    div_u_naive = (u_face_naive - np.roll(u_face_naive, 1, axis=1)) / dx\n    div_v_naive = (v_face_naive - np.roll(v_face_naive, 1, axis=0)) / dy\n    div_naive = div_u_naive + div_v_naive\n    \n    # Compute l2 norm of the divergence field\n    norm_naive = np.sqrt(np.mean(div_naive**2))\n\n    # --- 2. Virtual Staggered Reconstruction ---\n\n    # Compute face velocities directly from pressure differences across faces\n    # u_{i+1/2,j} = -1/a * (p_{i+1,j} - p_{i,j})/dx\n    u_face_vs = -1.0/a * (np.roll(p, -1, axis=1) - p) / dx\n    v_face_vs = -1.0/a * (np.roll(p, -1, axis=0) - p) / dy\n\n    # Compute divergence from face velocities\n    div_u_vs = (u_face_vs - np.roll(u_face_vs, 1, axis=1)) / dx\n    div_v_vs = (v_face_vs - np.roll(v_face_vs, 1, axis=0)) / dy\n    div_vs = div_u_vs + div_v_vs\n    \n    # Compute l2 norm of the divergence field\n    norm_vs = np.sqrt(np.mean(div_vs**2))\n\n    return norm_naive, norm_vs\n\ndef run_accuracy_test():\n    \"\"\"\n    Computes the order of accuracy for the face velocity reconstruction.\n    \"\"\"\n    u_func = lambda x, y: np.sin(2.0 * np.pi * x) * np.cos(2.0 * np.pi * y)\n    \n    errors = []\n    resolutions = [16, 32]\n    \n    for N in resolutions:\n        Nx, Ny = N, N\n        dx, dy = 1.0/Nx, 1.0/Ny\n\n        # Cell center coordinates\n        x_cc = (np.arange(Nx) + 0.5) * dx\n        y_cc = (np.arange(Ny) + 0.5) * dy\n        xv_cc, yv_cc = np.meshgrid(x_cc, y_cc)\n\n        # Exact cell-centered velocity\n        u_cc = u_func(xv_cc, yv_cc)\n\n        # Reconstructed face velocity (at x_{i+1/2}, y_j)\n        u_rec = 0.5 * (u_cc + np.roll(u_cc, -1, axis=1))\n\n        # Exact face velocity (at x_{i+1/2}, y_j)\n        # Face centers are at x=(i+1)*dx\n        x_face = (np.arange(Nx) + 1.0) * dx\n        xv_face, yv_face = np.meshgrid(x_face, y_cc) # Note: y is cell-centered\n        u_exact = u_func(xv_face, yv_face)\n\n        # Compute l2 error norm\n        error_field = u_rec - u_exact\n        l2_error = np.sqrt(np.mean(error_field**2))\n        errors.append(l2_error)\n        \n    E16, E32 = errors[0], errors[1]\n    order_p = np.log2(E16 / E32)\n    \n    return order_p\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        {'type': 'divergence', 'Nx': 32, 'Ny': 32, 'a': 1.0},\n        {'type': 'divergence', 'Nx': 16, 'Ny': 16, 'a': 0.5},\n        {'type': 'accuracy'},\n        {'type': 'divergence', 'Nx': 4, 'Ny': 4, 'a': 1.0},\n    ]\n\n    results = []\n    \n    # Test case 1\n    case1 = test_cases[0]\n    norm_naive, norm_vs = run_divergence_test(case1['Nx'], case1['Ny'], case1['a'])\n    result1 = norm_naive < 1e-12 and norm_vs > 1e-3\n    results.append(str(result1))\n\n    # Test case 2\n    case2 = test_cases[1]\n    norm_naive, norm_vs = run_divergence_test(case2['Nx'], case2['Ny'], case2['a'])\n    result2 = norm_naive < 1e-12 and norm_vs > 1e-3\n    results.append(str(result2))\n\n    # Test case 3\n    order_p = run_accuracy_test()\n    result3 = f\"{round(order_p, 6):.6f}\"\n    results.append(result3)\n\n    # Test case 4\n    case4 = test_cases[3]\n    norm_naive, norm_vs = run_divergence_test(case4['Nx'], case4['Ny'], case4['a'])\n    result4 = norm_naive < 1e-12 and norm_vs > 1e-3\n    results.append(str(result4))\n\n    # Final print statement in the exact required format\n    # Convert Python booleans to lowercase 'true'/'false' for the output.\n    output_str = f\"[{','.join(s.lower() if s in ['True', 'False'] else s for s in results)}]\"\n    print(output_str)\n\nsolve()\n```", "id": "3372220"}, {"introduction": "在实践中看到了 Rhie-Chow 插值的有效性之后，我们现在深入其理论基础。本练习将引导你使用傅里叶分析，揭示该方法如何选择性地引入数值耗散，从而在抑制虚假的高频模式（如棋盘格模式）的同时，保持物理上长波梯度计算的精度。通过这个推导，你将理解 Rhie-Chow 方法设计的精妙之处 [@problem_id:3372235]。", "problem": "考虑一个二维周期性方形区域 $[0,1]\\times[0,1]$ 内的不可压缩流动，并设密度为1。定义一个人为构造的速度场和压力场如下：\n$$u_{1}(x,y) = \\sin(2\\pi x)\\sin(2\\pi y), \\quad u_{2}(x,y) = \\cos(2\\pi x)\\cos(2\\pi y), \\quad p(x,y) = \\cos(2\\pi x)\\cos(2\\pi y),$$\n这些场是光滑且 $(1,1)$-周期的。可以假设在低雷诺数情况下，对流项可以忽略不计，因此受稳态不可压缩 Stokes 方程支配：\n$$-\\nabla p + \\nu \\nabla^{2}\\boldsymbol{u} + \\boldsymbol{f} = \\boldsymbol{0}, \\quad \\nabla \\cdot \\boldsymbol{u} = 0,$$\n其中 $\\nu>0$ 为常数粘度，体力 $\\boldsymbol{f}(x,y)$ 待定，使得 $(\\boldsymbol{u},p)$ 是一个精确解。\n\n现在考虑在间距为 $h$ 的均匀笛卡尔网格上，采用同位网格、单元中心的有限体积法 (FVM)，其中扩散通量使用中心差分，面法向质量通量通过 Rhie-Chow 动量插值构成。在 Rhie-Chow 动量插值的广泛应用中，面法向质量通量包含一个基于压力差的修正项，这在离散连续性方程中等效于增加一个形式为 $-\\kappa(h)\\,\\nabla_{h}^{2} p$ 的压力平滑项。其中 $\\nabla_{h}^{2}$ 表示均匀网格上的标准五点离散拉普拉斯算子，而 $\\kappa(h)>0$ 是由通量构造引入的、依赖于网格的有效平滑系数。\n\n对该网格上的离散拉普拉斯算子进行傅里叶符号分析，以表征 $-\\kappa(h)\\,\\nabla_{h}^{2} p$ 如何作用于长波长的物理梯度（小编数）和压力棋盘格模式（奈奎斯特极限下的最高可分辨波数）。利用此表征，推导当 $h\\to 0$ 时 $\\kappa(h)$ 的渐近缩放要求，该要求需同时满足：\n- 消除奈奎斯特波数处的伪棋盘格模式，并且\n- 在 $h\\to 0$ 的极限下不过度抑制长波长的物理压力梯度。\n\n假设 $\\kappa(h) = C h^{m}$，其中 $C>0$ 是一个与 $h$ 无关的常数，并确定满足这两个标准的唯一指数 $m$。你的最终答案必须是这个指数 $m$，以单个数字的形式给出。不需要四舍五入，最终答案中不应包含物理单位。\n\n在第一部分，计算使给定的人为构造场满足稳态 Stokes 方程的体力 $\\boldsymbol{f}(x,y)$。在第二部分，进行傅里叶符号分析并推导所需的 $m$。", "solution": "我们从稳态不可压缩 Stokes 方程开始，\n$$-\\nabla p + \\nu \\nabla^{2}\\boldsymbol{u} + \\boldsymbol{f} = \\boldsymbol{0}, \\quad \\nabla \\cdot \\boldsymbol{u} = 0,$$\n其中 $\\boldsymbol{u} = (u_{1},u_{2})$ 和 $p$ 由下式给出：\n$$u_{1}(x,y) = \\sin(2\\pi x)\\sin(2\\pi y), \\quad u_{2}(x,y) = \\cos(2\\pi x)\\cos(2\\pi y), \\quad p(x,y) = \\cos(2\\pi x)\\cos(2\\pi y).$$\n\n首先，我们验证不可压缩性。计算\n$$\\frac{\\partial u_{1}}{\\partial x} = 2\\pi \\cos(2\\pi x)\\sin(2\\pi y), \\quad \\frac{\\partial u_{2}}{\\partial y} = -2\\pi \\cos(2\\pi x)\\sin(2\\pi y),$$\n因此\n$$\\nabla \\cdot \\boldsymbol{u} = \\frac{\\partial u_{1}}{\\partial x} + \\frac{\\partial u_{2}}{\\partial y} = 2\\pi \\cos(2\\pi x)\\sin(2\\pi y) - 2\\pi \\cos(2\\pi x)\\sin(2\\pi y) = 0.$$\n因此，该人为构造的速度场是无散度的。\n\n接下来，计算压力梯度和速度场的拉普拉斯算子。压力梯度为\n$$\\nabla p = \\left( \\frac{\\partial p}{\\partial x}, \\frac{\\partial p}{\\partial y} \\right) = \\left( -2\\pi \\sin(2\\pi x)\\cos(2\\pi y), -2\\pi \\cos(2\\pi x)\\sin(2\\pi y) \\right).$$\n对于速度拉普拉斯算子，计算二阶导数：\n$$\\frac{\\partial^{2} u_{1}}{\\partial x^{2}} = -4\\pi^{2} \\sin(2\\pi x)\\sin(2\\pi y), \\quad \\frac{\\partial^{2} u_{1}}{\\partial y^{2}} = -4\\pi^{2} \\sin(2\\pi x)\\sin(2\\pi y),$$\n因此\n$$\\nabla^{2} u_{1} = \\frac{\\partial^{2} u_{1}}{\\partial x^{2}} + \\frac{\\partial^{2} u_{1}}{\\partial y^{2}} = -8\\pi^{2} \\sin(2\\pi x)\\sin(2\\pi y).$$\n同理，\n$$\\frac{\\partial^{2} u_{2}}{\\partial x^{2}} = -4\\pi^{2} \\cos(2\\pi x)\\cos(2\\pi y), \\quad \\frac{\\partial^{2} u_{2}}{\\partial y^{2}} = -4\\pi^{2} \\cos(2\\pi x)\\cos(2\\pi y),$$\n因此\n$$\\nabla^{2} u_{2} = -8\\pi^{2} \\cos(2\\pi x)\\cos(2\\pi y).$$\n于是\n$$\\nabla^{2} \\boldsymbol{u} = \\left( -8\\pi^{2} \\sin(2\\pi x)\\sin(2\\pi y),\\; -8\\pi^{2} \\cos(2\\pi x)\\cos(2\\pi y) \\right).$$\n\n代入 Stokes 动量平衡方程，\n$$-\\nabla p + \\nu \\nabla^{2}\\boldsymbol{u} + \\boldsymbol{f} = \\boldsymbol{0} \\quad \\Longrightarrow \\quad \\boldsymbol{f} = \\nabla p - \\nu \\nabla^{2}\\boldsymbol{u}.$$\n因此，\n\\begin{align*}\nf_{1}(x,y) &= \\frac{\\partial p}{\\partial x} - \\nu \\nabla^{2} u_{1} = -2\\pi \\sin(2\\pi x)\\cos(2\\pi y) - \\nu\\left( -8\\pi^{2} \\sin(2\\pi x)\\sin(2\\pi y) \\right) \\\\\n&= -2\\pi \\sin(2\\pi x)\\cos(2\\pi y) + 8\\nu\\pi^{2} \\sin(2\\pi x)\\sin(2\\pi y), \\\\\nf_{2}(x,y) &= \\frac{\\partial p}{\\partial y} - \\nu \\nabla^{2} u_{2} = -2\\pi \\cos(2\\pi x)\\sin(2\\pi y) - \\nu\\left( -8\\pi^{2} \\cos(2\\pi x)\\cos(2\\pi y) \\right) \\\\\n&= -2\\pi \\cos(2\\pi x)\\sin(2\\pi y) + 8\\nu\\pi^{2} \\cos(2\\pi x)\\cos(2\\pi y).\n\\end{align*}\n该体力使得 $(\\boldsymbol{u},p)$ 在周期性区域上满足稳态不可压缩 Stokes 方程。\n\n我们现在分析同位网格上的 Rhie-Chow 动量插值。在此类格式中，面法向质量通量的构造引入了一个基于压力差的修正项，当将其代入离散连续性方程时，其作用相当于增加了一个压力平滑项 $-\\kappa(h)\\,\\nabla_{h}^{2} p$。其中 $\\nabla_{h}^{2}$ 是间距为 $h$ 的均匀网格上的标准五点离散拉普拉斯算子，而 $\\kappa(h)>0$ 仅依赖于 $h$（以及可能包含在下文 $C$ 中的常数物理参数）。我们假设一个缩放关系 $\\kappa(h) = C h^{m}$，其中 $C>0$ 是一个与 $h$ 无关的常数，并寻找 $m$ 以使其在 $h \\to 0$ 时满足两个条件：\n- 在连续极限下，长波长的物理压力梯度（小编数）不被过度抑制，这要求平滑效应消失。\n- 奈奎斯特波数处的伪棋盘格模式被抑制，这要求对该模式有非零的阻尼效应。\n\n为了使这些要求精确化，我们对离散拉普拉斯算子进行傅里叶符号分析。考虑离散傅里叶模式\n$$p_{i,j} = \\exp\\!\\left( \\mathrm{i} (k_{x} i h + k_{y} j h) \\right),$$\n对于整数 $i,j$ 和第一布里渊区中的波数 $(k_{x},k_{y})$。五点离散拉普拉斯算子具有傅里叶符号\n$$\\lambda_{h}(k_{x},k_{y}) = \\frac{2\\cos(k_{x} h) - 2}{h^{2}} + \\frac{2\\cos(k_{y} h) - 2}{h^{2}} = -\\frac{4}{h^{2}}\\left( \\sin^{2}\\!\\left(\\frac{k_{x}h}{2}\\right) + \\sin^{2}\\!\\left(\\frac{k_{y}h}{2}\\right) \\right).$$\n因此，作用于一个傅里叶模式时，平滑项贡献一个因子 $-\\kappa(h)\\,\\lambda_{h}(k_{x},k_{y})$。\n\n我们现在考察两种情况。\n\n1. 对应于长波长物理梯度的小波数。对于固定的、与 $h$ 无关的连续波数 $(k_{x},k_{y})$，当 $h\\to 0$ 时我们有\n$$\\sin^{2}\\!\\left(\\frac{k_{x}h}{2}\\right) \\sim \\left(\\frac{k_{x}h}{2}\\right)^{2}, \\quad \\sin^{2}\\!\\left(\\frac{k_{y}h}{2}\\right) \\sim \\left(\\frac{k_{y}h}{2}\\right)^{2},$$\n因此\n$$\\lambda_{h}(k_{x},k_{y}) \\sim -\\left( k_{x}^{2} + k_{y}^{2} \\right) \\quad \\text{as } h\\to 0.$$\n那么，增加的平滑项贡献渐近地为\n$$-\\kappa(h)\\,\\lambda_{h}(k_{x},k_{y}) \\sim \\kappa(h)\\left( k_{x}^{2} + k_{y}^{2} \\right).$$\n为了在连续极限下避免过度抑制物理梯度，对于任何固定的 $(k_{x},k_{y})$，该贡献必须在 $h\\to 0$ 时消失，这要求\n$$\\lim_{h\\to 0} \\kappa(h) = 0 \\quad \\Longrightarrow \\quad m>0.$$\n\n2. 奈奎斯特波数处的棋盘格模式。网格上的经典棋盘格交替对应于最高可分辨模式，其波数为\n$$k_{x} = \\frac{\\pi}{h}, \\quad k_{y} = \\frac{\\pi}{h}.$$\n则\n$$\\sin^{2}\\!\\left(\\frac{k_{x}h}{2}\\right) = \\sin^{2}\\!\\left(\\frac{\\pi}{2}\\right) = 1, \\quad \\sin^{2}\\!\\left(\\frac{k_{y}h}{2}\\right) = 1,$$\n所以\n$$\\lambda_{h}\\!\\left(\\frac{\\pi}{h}, \\frac{\\pi}{h}\\right) = -\\frac{4}{h^{2}}(1+1) = -\\frac{8}{h^{2}}.$$\n该模式的平滑项贡献为\n$$-\\kappa(h)\\,\\lambda_{h}\\!\\left(\\frac{\\pi}{h}, \\frac{\\pi}{h}\\right) = \\kappa(h)\\,\\frac{8}{h^{2}} = 8 C\\, h^{m-2}.$$\n为了在 $h\\to 0$ 的极限下抑制棋盘格模式，同时不让阻尼趋于无穷大（这将意味着对最高频率内容的严重过度抑制和潜在的刚性问题），我们要求阻尼贡献趋于一个有限的正的常数。这得出\n$$\\lim_{h\\to 0} 8 C\\, h^{m-2} = \\text{finite and } > 0 \\quad \\Longrightarrow \\quad m-2 = 0 \\quad \\Longrightarrow \\quad m = 2.$$\n当 $m=2$ 且 $C>0$ 时，棋盘格阻尼趋于 $8C$，一个正常数，确保了抑制效果；而对于任何固定的物理波数 $(k_{x},k_{y})$，平滑项的缩放行为如 $\\kappa(h)\\left( k_{x}^{2}+k_{y}^{2}\\right) = C h^{2}\\left( k_{x}^{2}+k_{y}^{2}\\right) \\to 0$（当 $h\\to 0$ 时），确保了物理梯度不会被渐近过度抑制。\n\n总结如下：\n- 人为构造的场在体力为下式时满足不可压缩稳态 Stokes 方程：\n\\begin{align*}\nf_{1}(x,y) &= -2\\pi \\sin(2\\pi x)\\cos(2\\pi y) + 8\\nu\\pi^{2} \\sin(2\\pi x)\\sin(2\\pi y), \\\\\nf_{2}(x,y) &= -2\\pi \\cos(2\\pi x)\\sin(2\\pi y) + 8\\nu\\pi^{2} \\cos(2\\pi x)\\cos(2\\pi y).\n\\end{align*}\n- Rhie-Chow 引入的压力平滑项 $-\\kappa(h)\\,\\nabla_{h}^{2}p$ 必须具有 $\\kappa(h) = C h^{m}$ 且 $m=2$，以便在 $h\\to 0$ 时同时抑制棋盘格模式并避免过度抑制长波长的物理梯度。\n\n因此，唯一的指数是 $m=2$。", "answer": "$$\\boxed{2}$$", "id": "3372235"}, {"introduction": "实现一个数值格式不仅要考虑空间精度，时间稳定性同样至关重要，特别是对于显式时间推进方法。本练习关注在使用 Rhie-Chow 插值和显式时间格式时系统的稳定性问题。你需要通过 von Neumann 稳定性分析，推导出数值参数必须满足的稳定性约束条件，这对于保证数值模拟的成功至关重要 [@problem_id:3372226]。", "problem": "考虑单个空间维度下的线性化、无粘、不可压缩的动量和连续性方程，其速度场 $u(x,t)$ 和压力场 $p(x,t)$ 的形式为 $u_{t} + U\\,u_{x} = -p_{x}$ 和 $u_{x} = 0$。为了在同位网格上进行显式时间推进，引入系数为 $\\beta > 0$ 的人工可压缩性 (AC)，将精确的连续性方程替换为 $\\beta\\,p_{t} + u_{x} = 0$。在间距为 $h$ 的均匀同位网格上，使用二阶中心差分来离散化所有空间导数。对于压力-速度耦合，通过 Rhie–Chow 插值计算面上的速度，这在一维情况下简化为经过充分检验的面公式 $u_{j+\\frac{1}{2}} = \\frac{1}{2}\\left(u_{j+1} + u_{j}\\right) - \\gamma\\,\\frac{p_{j+1} - p_{j}}{h}$，其中 $\\gamma > 0$ 代表线性化动量算子对角线的逆，并被视为一个常数。使用这些面速度，单元中心 $j$ 处的离散散度变为 $u_{x}\\big|_{j} \\approx \\frac{u_{j+\\frac{1}{2}} - u_{j-\\frac{1}{2}}}{h}$，这会引入一个离散的压力拉普拉斯项，并得到形式为 $\\beta\\,p_{t} + u_{x} - \\gamma\\,p_{xx} = 0$ 的连续性方程。\n\n使用步长为 $\\Delta t$ 的前向欧拉法进行时间推进，并将所有项进行显式处理。对上述同位格式进行傅里叶 (von Neumann) 稳定性分析，只关注压力棋盘格模式 $p_{j}^{n} \\propto (-1)^{j}$ 和速度棋盘格模式 $u_{j}^{n} \\propto (-1)^{j}$，这对应于离散波数 $\\theta = k h = \\pi$。推导相关的单模放大因子，并确定在所述的离散化和耦合条件下，对于此棋盘格模式，为使放大因子的大小不超过 $1$，无量纲 Rhie–Chow 扩散数 $\\mathcal{D} = \\frac{\\gamma\\,\\Delta t}{\\beta\\,h^{2}}$ 的最大允许值是多少。\n\n将最终答案表示为一个无量纲数。如果需要四舍五入，请保留四位有效数字；否则，请提供精确值。", "solution": "我们对一个在空间和时间上离散化的、由两个耦合偏微分方程组成的系统进行 von Neumann 稳定性分析。\n\n在网格节点 $j$ 处的半离散方程组由动量方程和包含 Rhie-Chow 贡献项的等效连续性方程给出。\n1.  动量方程：$u_{t} + U\\,u_{x} = -p_{x}$\n2.  连续性方程：$\\beta\\,p_{t} + u_{x} - \\gamma\\,p_{xx} = 0$\n\n我们使用二阶中心差分来离散化所有空间导数：\n$u_{x}\\big|_j \\to \\frac{u_{j+1} - u_{j-1}}{2h}$\n$p_{x}\\big|_j \\to \\frac{p_{j+1} - p_{j-1}}{2h}$\n$p_{xx}\\big|_j \\to \\frac{p_{j+1} - 2p_j + p_{j-1}}{h^2}$\n\n对时间导数应用前向欧拉法，其中新时间步 $n+1$ 的量用时间步 $n$ 的已知量表示：\n$\\frac{u_j^{n+1} - u_j^n}{\\Delta t} + U \\left( \\frac{u_{j+1}^n - u_{j-1}^n}{2h} \\right) = - \\left( \\frac{p_{j+1}^n - p_{j-1}^n}{2h} \\right)$\n$\\beta \\left( \\frac{p_j^{n+1} - p_j^n}{\\Delta t} \\right) + \\left( \\frac{u_{j+1}^n - u_{j-1}^n}{2h} \\right) - \\gamma \\left( \\frac{p_{j+1}^n - 2p_j^n + p_{j-1}^n}{h^2} \\right) = 0$\n\n重新整理这些方程以求解时间步 $n+1$ 的值：\n$u_j^{n+1} = u_j^n - \\frac{U \\Delta t}{2h} (u_{j+1}^n - u_{j-1}^n) - \\frac{\\Delta t}{2h} (p_{j+1}^n - p_{j-1}^n)$\n$p_j^{n+1} = p_j^n - \\frac{\\Delta t}{2\\beta h} (u_{j+1}^n - u_{j-1}^n) + \\frac{\\gamma \\Delta t}{\\beta h^2} (p_{j+1}^n - 2p_j^n + p_{j-1}^n)$\n\n对于 von Neumann 分析，我们为速度和压力引入傅里叶模式：\n$u_j^n = \\hat{u}^n e^{i k x_j} = \\hat{u}^n e^{i j \\theta}$\n$p_j^n = \\hat{p}^n e^{i k x_j} = \\hat{p}^n e^{i j \\theta}$\n其中 $\\hat{u}^n$ 和 $\\hat{p}^n$ 是时间步 $n$ 的复傅里叶振幅，$k$ 是波数，$x_j = j h$ 是空间坐标，$\\theta = k h$ 是无量纲波数。\n\n我们将这些模式代入离散化方程中。差分项变换如下：\n$u_{j+1}^n - u_{j-1}^n = \\hat{u}^n e^{ij\\theta} (e^{i\\theta} - e^{-i\\theta}) = \\hat{u}^n e^{ij\\theta} (2i \\sin\\theta)$\n$p_{j+1}^n - p_{j-1}^n = \\hat{p}^n e^{ij\\theta} (2i \\sin\\theta)$\n$p_{j+1}^n - 2p_j^n + p_{j-1}^n = \\hat{p}^n e^{ij\\theta} (e^{i\\theta} - 2 + e^{-i\\theta}) = \\hat{p}^n e^{ij\\theta} (2\\cos\\theta - 2) = -2 \\hat{p}^n e^{ij\\theta} (1 - \\cos\\theta)$\n\n将这些表达式代入更新方程中，并消去公因子 $e^{ij\\theta}$：\n$\\hat{u}^{n+1} = \\hat{u}^n - \\frac{U \\Delta t}{2h} (\\hat{u}^n (2i \\sin\\theta)) - \\frac{\\Delta t}{2h} (\\hat{p}^n (2i \\sin\\theta))$\n$\\hat{p}^{n+1} = \\hat{p}^n - \\frac{\\Delta t}{2\\beta h} (\\hat{u}^n (2i \\sin\\theta)) + \\frac{\\gamma \\Delta t}{\\beta h^2} (\\hat{p}^n (-2(1 - \\cos\\theta)))$\n\n这可以写成矩阵形式：\n$$\n\\begin{pmatrix} \\hat{u}^{n+1} \\\\ \\hat{p}^{n+1} \\end{pmatrix} =\n\\mathbf{G}(\\theta)\n\\begin{pmatrix} \\hat{u}^{n} \\\\ \\hat{p}^{n} \\end{pmatrix}\n$$\n其中 $\\mathbf{G}(\\theta)$ 是放大矩阵：\n$$\n\\mathbf{G}(\\theta) = \\begin{pmatrix}\n1 - i \\frac{U \\Delta t}{h} \\sin\\theta & -i \\frac{\\Delta t}{h} \\sin\\theta \\\\\n-i \\frac{\\Delta t}{\\beta h} \\sin\\theta & 1 - \\frac{2 \\gamma \\Delta t}{\\beta h^2}(1 - \\cos\\theta)\n\\end{pmatrix}\n$$\n\n问题要求分析棋盘格模式，它对应于最高可能的离散波数 $\\theta = \\pi$。对于此模式，我们有：\n$\\sin(\\pi) = 0$\n$\\cos(\\pi) = -1$\n\n将这些值代入放大矩阵：\n$$\n\\mathbf{G}(\\pi) = \\begin{pmatrix}\n1 - i \\frac{U \\Delta t}{h} (0) & -i \\frac{\\Delta t}{h} (0) \\\\\n-i \\frac{\\Delta t}{\\beta h} (0) & 1 - \\frac{2 \\gamma \\Delta t}{\\beta h^2}(1 - (-1))\n\\end{pmatrix}\n$$\n$$\n\\mathbf{G}(\\pi) = \\begin{pmatrix}\n1 & 0 \\\\\n0 & 1 - \\frac{4 \\gamma \\Delta t}{\\beta h^2}\n\\end{pmatrix}\n$$\n该矩阵是对角的，这意味着对于 $\\theta = \\pi$，速度和压力模式是解耦的。$\\mathbf{G}(\\pi)$ 的特征值，即这些模式的放大因子，是其对角线元素：$\\lambda_1 = 1$ 和 $\\lambda_2 = 1 - \\frac{4 \\gamma \\Delta t}{\\beta h^2}$。\n\n问题关注的是出现在压力方程中的 Rhie-Chow 项的影响。因此，与压力棋盘格模式相关的放大因子是 $\\lambda_2$。我们将其表示为 $G_{\\pi}$。\n$G_{\\pi} = 1 - \\frac{4 \\gamma \\Delta t}{\\beta h^2}$。\n\n使用无量纲 Rhie-Chow 扩散数 $\\mathcal{D} = \\frac{\\gamma \\Delta t}{\\beta h^2}$ 的定义，我们可以将放大因子写为：\n$G_{\\pi} = 1 - 4 \\mathcal{D}$。\n\n为了数值稳定性，放大因子的大小不得超过 $1$：\n$|G_{\\pi}| \\le 1$\n$|1 - 4\\mathcal{D}| \\le 1$\n\n这一个不等式等价于下面的一对不等式：\n$-1 \\le 1 - 4\\mathcal{D} \\le 1$\n\n我们求解 $\\mathcal{D}$。首先，考虑右侧不等式：\n$1 - 4\\mathcal{D} \\le 1 \\implies -4\\mathcal{D} \\le 0 \\implies \\mathcal{D} \\ge 0$。\n由于 $\\gamma$、$\\Delta t$、$\\beta$ 和 $h^2$ 都是正常数，$\\mathcal{D}$ 内在地为正，所以这个条件总是满足的。\n\n接下来，考虑左侧不等式：\n$-1 \\le 1 - 4\\mathcal{D} \\implies 4\\mathcal{D} \\le 1 + 1 \\implies 4\\mathcal{D} \\le 2$\n$\\mathcal{D} \\le \\frac{2}{4}$\n$\\mathcal{D} \\le \\frac{1}{2}$\n\n综合这些条件，棋盘格模式的稳定性要求简化为 $0 < \\mathcal{D} \\le \\frac{1}{2}$。因此，无量纲 Rhie-Chow 扩散数 $\\mathcal{D}$ 的最大允许值为 $\\frac{1}{2}$。", "answer": "$$\\boxed{\\frac{1}{2}}$$", "id": "3372226"}]}