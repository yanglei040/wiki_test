{"hands_on_practices": [{"introduction": "有限元法 (Finite Element Method, FEM) 的核心在于将偏微分方程的连续弱形式转化为代数方程组。本练习将深入这一过程的核心，要求你为一种稳定且广泛使用的单元——Taylor-Hood ($P_2$-$P_1$) 单元——手动构建单元矩阵 [@problem_id:3382200]。这项实践对于揭开“组装”过程的神秘面纱至关重要，它能帮助你理解梯度和散度等数学算子是如何转化为具体的数值的。", "problem": "考虑二维不可压缩Navier–Stokes方程的标准弱形式构建模块，即双线性形式 $a(u,v) = \\nu \\int_{\\Omega} \\nabla u : \\nabla v \\, \\mathrm{d}x$ 和 $b(v,q) = -\\int_{\\Omega} q\\, \\nabla \\cdot v \\, \\mathrm{d}x$，其中 $\\nu$ 是运动粘度，$u$ 和 $v$ 是向量值的速度试探函数和检验函数，$q$ 是标量压力检验函数。在有限元方法 (FEM) 中，考虑Taylor–Hood单元对，其速度采用二次Lagrange形函数 ($P_2$)，压力采用线性Lagrange形函数 ($P_1$)。\n\n在参考三角形 $\\widehat{K}$ 上进行计算，其顶点为 $(0,0)$、$(1,0)$、$(0,1)$，重心坐标为 $(\\lambda_1,\\lambda_2,\\lambda_3) = (1 - x - y, x, y)$。令 $\\{\\widehat{\\varphi}_i\\}_{i=1}^{6}$ 表示与三个顶点和三个边中点相关联的标量 $P_2$ 形函数，令 $\\{\\widehat{\\psi}_j\\}_{j=1}^{3}$ 表示与三个顶点相关联的标量 $P_1$ 形函数。对于速度，使用通过将标量 $P_2$ 形函数与 $\\mathbb{R}^2$ 的规范基向量进行张量积而形成的向量值基函数。\n\n1. 从 $a(\\cdot,\\cdot)$ 和 $b(\\cdot,\\cdot)$ 的定义以及仿射映射 $F:\\widehat{K} \\to K$（其中 $x = B \\widehat{x} + b$，$B$ 为常数雅可比矩阵，$b$ 为平移向量）下的变量替换公式出发，推导参考矩阵 $\\widehat{A}$ 和 $\\widehat{B}$ 的单元级表达式及其到物理单元 $K$ 的映射：\n   - 对于 $a(\\cdot,\\cdot)$，给出耦合与 $\\widehat{\\varphi}_i$ 和 $\\widehat{\\varphi}_j$ 相关联的速度基函数的第 $\\alpha$ 个分量（$\\alpha \\in \\{1,2\\}$）的标量分量项 $A_{i\\alpha,\\,j\\alpha}$ 的公式。\n   - 对于 $b(\\cdot,\\cdot)$，给出耦合压力基函数 $\\widehat{\\psi}_j$ 与和 $\\widehat{\\varphi}_i$ 相关联的速度基函数的第 $\\alpha$ 个分量的项 $B_{j,\\,i\\alpha}$ 的公式。\n\n2. 考虑物理三角形 $K$，其顶点为 $(2,1)$、$(5,1)$、$(2,4)$。确定从 $\\widehat{K}$ 到 $K$ 的仿射映射 $F$，并计算相应的雅可比矩阵 $B$ 及其行列式。\n\n3. 使用您的公式和在第2部分中找到的具体映射 $F$，在物理单元 $K$ 上计算以下两个特定项：\n   - 耦合基于顶点 $(0,0)$ 的二次形函数自身的 $x$ 分量的刚度项，即对应于与 $\\lambda_1$ 相关联的 $\\widehat{\\varphi}_1$ 的 $A_{1x,\\,1x}$。\n   - 与 $(1,0)$ 相关联的压力形函数和与 $(1,0)$ 相关联的二次速度形函数的 $x$ 分量之间的散度-压力耦合项，即对应于与 $\\lambda_2$ 相关联的 $\\widehat{\\psi}_2$ 和与 $\\lambda_2$ 相关联的 $\\widehat{\\varphi}_2$ 的 $B_{2,\\,2x}$。\n\n最后，定义标量 $S := A_{1x,\\,1x} + B_{2,\\,2x}$，并提供 $S$ 关于 $\\nu$ 的精确封闭形式表达式。无需四舍五入。以单个解析表达式的形式提供您的最终答案。", "solution": "用户提供了一个来自偏微分方程数值解领域的、具有科学依据、提法恰当且客观的问题。该问题是有效的，可以通过应用有限元方法（FEM）的标准原理来解决。\n\n解决方案按要求分为三个部分：通用公式的推导，特定仿射映射的计算，以及矩阵项的求值，最后是 $S$ 的最终计算。\n\n**第1部分：单元矩阵公式的推导**\n\n给定从参考单元 $\\widehat{K}$ 到物理单元 $K$ 的仿射映射：\n$$x = F(\\widehat{x}) = B \\widehat{x} + b$$\n其中 $\\widehat{x} \\in \\widehat{K}$ 且 $x \\in K$。此映射的雅可比矩阵是常数矩阵 $B$。参考单元 $\\widehat{K}$ 上的标量函数 $\\widehat{f}$ 通过 $f(x) = \\widehat{f}(F^{-1}(x))$ 变换为物理单元 $K$ 上的函数 $f$。链式法则给出了梯度的变换关系：\n$$ \\nabla_x f = B^{-T} \\nabla_{\\widehat{x}} \\widehat{f} $$\n微分面积元的变换如下：\n$$ \\mathrm{d}x = |\\det(B)| \\, \\mathrm{d}\\widehat{x} $$\n\n向量值的速度基函数形式为 $\\mathbf{v}_{i\\alpha}(x) = (\\widehat{\\varphi}_i \\circ F^{-1}(x)) \\mathbf{e}_\\alpha$，其中 $\\widehat{\\varphi}_i$ 是参考单元 $\\widehat{K}$ 上的标量 $P_2$ 形函数，$\\mathbf{e}_\\alpha$ 是 $\\mathbb{R}^2$ 中的规范基向量（$\\alpha \\in \\{1,2\\}$）。类似地，标量压力基函数为 $q_j(x) = \\widehat{\\psi}_j \\circ F^{-1}(x)$，其中 $\\widehat{\\psi}_j$ 是一个标量 $P_1$ 形函数。\n\n**刚度矩阵项 $A_{i\\alpha, j\\alpha}$ 的推导**\n\n粘性项的双线性形式为 $a(u,v) = \\nu \\int_{\\Omega} \\nabla u : \\nabla v \\, \\mathrm{d}x$。单元 $K$ 上的单元刚度矩阵的项 $A^K_{i\\alpha, j\\alpha}$ 是通过设置检验函数 $v = \\mathbf{v}_{i\\alpha}$ 和试探函数 $u = \\mathbf{v}_{j\\alpha}$ 得到的：\n$$ A^K_{i\\alpha, j\\alpha} = \\nu \\int_K \\nabla \\mathbf{v}_{j\\alpha} : \\nabla \\mathbf{v}_{i\\alpha} \\, \\mathrm{d}x $$\n试探函数 $\\mathbf{v}_{j\\alpha}$ 的梯度是一个张量：\n$$ \\nabla_x \\mathbf{v}_{j\\alpha} = \\nabla_x ((\\widehat{\\varphi}_j \\circ F^{-1}) \\mathbf{e}_\\alpha) = (\\nabla_x (\\widehat{\\varphi}_j \\circ F^{-1})) \\otimes \\mathbf{e}_\\alpha = (B^{-T} \\nabla_{\\widehat{x}} \\widehat{\\varphi}_j) \\otimes \\mathbf{e}_\\alpha $$\n类似地，$\\nabla_x \\mathbf{v}_{i\\alpha} = (B^{-T} \\nabla_{\\widehat{x}} \\widehat{\\varphi}_i) \\otimes \\mathbf{e}_\\alpha$。双点积为：\n$$ \\nabla \\mathbf{v}_{j\\alpha} : \\nabla \\mathbf{v}_{i\\alpha} = \\left((B^{-T} \\nabla_{\\widehat{x}} \\widehat{\\varphi}_j) \\cdot (B^{-T} \\nabla_{\\widehat{x}} \\widehat{\\varphi}_i)\\right) (\\mathbf{e}_\\alpha \\cdot \\mathbf{e}_\\alpha) $$\n由于 $\\mathbf{e}_\\alpha \\cdot \\mathbf{e}_\\alpha = 1$，这可以简化为：\n$$ (\\nabla_{\\widehat{x}} \\widehat{\\varphi}_j)^T (B^{-1} B^{-T}) (\\nabla_{\\widehat{x}} \\widehat{\\varphi}_i) $$\n将此代入积分并进行变量替换到参考单元 $\\widehat{K}$：\n$$ A^K_{i\\alpha, j\\alpha} = \\nu |\\det(B)| \\int_{\\widehat{K}} (\\nabla_{\\widehat{x}} \\widehat{\\varphi}_j)^T (B^{-1} B^{-T}) (\\nabla_{\\widehat{x}} \\widehat{\\varphi}_i) \\, \\mathrm{d}\\widehat{x} $$\n这就是通用的映射公式。\n\n**散度-压力矩阵项 $B_{j, i\\alpha}$ 的推导**\n\n压力-速度耦合的双线性形式为 $b(v,q) = -\\int_{\\Omega} q\\, \\nabla \\cdot v \\, \\mathrm{d}x$。项 $B_{j, i\\alpha}$ 是通过设置压力检验函数 $q = q_j$ 和速度检验函数 $v = \\mathbf{v}_{i\\alpha}$ 得到的：\n$$ B^K_{j, i\\alpha} = -\\int_K q_j (\\nabla_x \\cdot \\mathbf{v}_{i\\alpha}) \\, \\mathrm{d}x $$\n散度项是：\n$$ \\nabla_x \\cdot \\mathbf{v}_{i\\alpha} = \\nabla_x \\cdot ((\\widehat{\\varphi}_i \\circ F^{-1}) \\mathbf{e}_\\alpha) = (\\nabla_x (\\widehat{\\varphi}_i \\circ F^{-1})) \\cdot \\mathbf{e}_\\alpha = (B^{-T} \\nabla_{\\widehat{x}} \\widehat{\\varphi}_i) \\cdot \\mathbf{e}_\\alpha $$\n该项是向量 $B^{-T} \\nabla_{\\widehat{x}} \\widehat{\\varphi}_i$ 的第 $\\alpha$ 个分量。令 $C=B^{-T}$，它就是 $\\sum_{k=1}^2 C_{k\\alpha} \\frac{\\partial \\widehat{\\varphi}_i}{\\partial \\widehat{x}_k}$。\n代入积分并进行变量替换：\n$$ B^K_{j, i\\alpha} = -\\int_K (\\widehat{\\psi}_j \\circ F^{-1}) ((B^{-T} \\nabla_{\\widehat{x}} \\widehat{\\varphi}_i) \\cdot \\mathbf{e}_\\alpha)\\circ F^{-1} \\, \\mathrm{d}x $$\n$$ B^K_{j, i\\alpha} = -|\\det(B)| \\int_{\\widehat{K}} \\widehat{\\psi}_j \\left( (B^{-T} \\nabla_{\\widehat{x}} \\widehat{\\varphi}_i) \\cdot \\mathbf{e}_\\alpha \\right) \\, \\mathrm{d}\\widehat{x} $$\n这就是散度-压力耦合矩阵的通用映射公式。\n\n**第2部分：三角形 K 的仿射映射**\n\n参考三角形 $\\widehat{K}$ 的顶点为 $\\widehat{p}_1=(0,0)$、$\\widehat{p}_2=(1,0)$、$\\widehat{p}_3=(0,1)$。\n物理三角形 $K$ 的顶点为 $p_1=(2,1)$、$p_2=(5,1)$、$p_3=(2,4)$。\n仿射映射 $x = B\\widehat{x} + b$ 必须映射对应的顶点。\n$p_1 = B\\widehat{p}_1 + b \\implies \\begin{pmatrix} 2 \\\\ 1 \\end{pmatrix} = B\\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} + b \\implies b = \\begin{pmatrix} 2 \\\\ 1 \\end{pmatrix}$。\n$p_2 = B\\widehat{p}_2 + b \\implies \\begin{pmatrix} 5 \\\\ 1 \\end{pmatrix} = B\\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 2 \\\\ 1 \\end{pmatrix} \\implies B\\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 3 \\\\ 0 \\end{pmatrix}$。\n$p_3 = B\\widehat{p}_3 + b \\implies \\begin{pmatrix} 2 \\\\ 4 \\end{pmatrix} = B\\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} + \\begin{pmatrix} 2 \\\\ 1 \\end{pmatrix} \\implies B\\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 3 \\end{pmatrix}$。\n$B$ 的列是 $B\\mathbf{e}_1$ 和 $B\\mathbf{e}_2$。因此：\n$$ B = \\begin{pmatrix} 3  0 \\\\ 0  3 \\end{pmatrix} = 3I_2 $$\n行列式为 $\\det(B) = 3 \\times 3 - 0 \\times 0 = 9$。\n\n**第3部分：特定矩阵项的求值**\n\n参考单元 $\\widehat{K}$ 上的重心坐标为 $\\lambda_1 = 1-\\widehat{x}-\\widehat{y}$、$\\lambda_2 = \\widehat{x}$、$\\lambda_3 = \\widehat{y}$。它们的梯度是 $\\nabla_{\\widehat{x}}\\lambda_1 = \\left(-1,-1\\right)^T$、$\\nabla_{\\widehat{x}}\\lambda_2 = \\left(1,0\\right)^T$、$\\nabla_{\\widehat{x}}\\lambda_3 = \\left(0,1\\right)^T$。\n\n**$A_{1x,1x}$ 的计算**\n该项对应于 $i=1, j=1, \\alpha=x=1$。形函数是顶点1处的 $P_2$ 函数，$\\widehat{\\varphi}_1 = \\lambda_1(2\\lambda_1-1) = 2\\lambda_1^2 - \\lambda_1$。\n我们有 $B=3I_2$ 和 $\\det(B)=9$。因此 $B^{-1} = \\frac{1}{3}I_2$ 且 $B^{-T} = \\frac{1}{3}I_2$，所以 $B^{-1}B^{-T} = \\frac{1}{9}I_2$。\n$$ A^K_{1x,1x} = \\nu \\cdot 9 \\int_{\\widehat{K}} (\\nabla_{\\widehat{x}} \\widehat{\\varphi}_1)^T \\left(\\frac{1}{9}I_2\\right) (\\nabla_{\\widehat{x}} \\widehat{\\varphi}_1) \\, \\mathrm{d}\\widehat{x} = \\nu \\int_{\\widehat{K}} |\\nabla_{\\widehat{x}} \\widehat{\\varphi}_1|^2 \\, \\mathrm{d}\\widehat{x} $$\n形函数的梯度为 $\\nabla_{\\widehat{x}}\\widehat{\\varphi}_1 = (4\\lambda_1-1)\\nabla_{\\widehat{x}}\\lambda_1 = (4\\lambda_1-1)\\begin{pmatrix} -1 \\\\ -1 \\end{pmatrix}$。\n模的平方为 $|\\nabla_{\\widehat{x}} \\widehat{\\varphi}_1|^2 = (-(4\\lambda_1-1))^2 + (-(4\\lambda_1-1))^2 = 2(4\\lambda_1-1)^2 = 2(16\\lambda_1^2 - 8\\lambda_1+1)$。\n我们需要计算该量在 $\\widehat{K}$ 上的积分。$\\widehat{K}$ 的面积是 $A_{\\widehat{K}}=1/2$。我们使用公式 $\\int_{\\widehat{K}} \\lambda_1^a \\lambda_2^b \\lambda_3^c \\, \\mathrm{d}\\widehat{x} = 2 A_{\\widehat{K}} \\frac{a!b!c!}{(a+b+c+2)!}$。\n$$ \\int_{\\widehat{K}} 1 \\, \\mathrm{d}\\widehat{x} = A_{\\widehat{K}} = \\frac{1}{2} $$\n$$ \\int_{\\widehat{K}} \\lambda_1 \\, \\mathrm{d}\\widehat{x} = 2(\\frac{1}{2})\\frac{1!0!0!}{3!} = \\frac{1}{6} $$\n$$ \\int_{\\widehat{K}} \\lambda_1^2 \\, \\mathrm{d}\\widehat{x} = 2(\\frac{1}{2})\\frac{2!0!0!}{4!} = \\frac{2}{24} = \\frac{1}{12} $$\n积分为：\n$$ \\int_{\\widehat{K}} 2(16\\lambda_1^2 - 8\\lambda_1+1) \\, \\mathrm{d}\\widehat{x} = 32\\int_{\\widehat{K}}\\lambda_1^2 \\, \\mathrm{d}\\widehat{x} - 16\\int_{\\widehat{K}}\\lambda_1 \\, \\mathrm{d}\\widehat{x} + 2\\int_{\\widehat{K}}1 \\, \\mathrm{d}\\widehat{x} $$\n$$ = 32\\left(\\frac{1}{12}\\right) - 16\\left(\\frac{1}{6}\\right) + 2\\left(\\frac{1}{2}\\right) = \\frac{8}{3} - \\frac{8}{3} + 1 = 1 $$\n因此，$A_{1x,1x} = \\nu \\cdot 1 = \\nu$。\n\n**$B_{2,2x}$ 的计算**\n该项对应于压力函数 $j=2$，速度函数 $i=2$，以及分量 $\\alpha=x=1$。\n$\\widehat{\\psi}_2$ 是顶点2处的 $P_1$ 函数，所以 $\\widehat{\\psi}_2 = \\lambda_2$。\n$\\widehat{\\varphi}_2$ 是顶点2处的 $P_2$ 函数，所以 $\\widehat{\\varphi}_2 = \\lambda_2(2\\lambda_2-1)$。\n使用 $B^K_{j,i\\alpha}$ 的公式：\n$$ B^K_{2,2x} = -|\\det(B)| \\int_{\\widehat{K}} \\widehat{\\psi}_2 \\left( (B^{-T} \\nabla_{\\widehat{x}} \\widehat{\\varphi}_2) \\cdot \\mathbf{e}_1 \\right) \\, \\mathrm{d}\\widehat{x} $$\n由于 $B^{-T} = \\frac{1}{3}I_2$，这可以简化为：\n$$ B^K_{2,2x} = -9 \\int_{\\widehat{K}} \\widehat{\\psi}_2 \\frac{1}{3} (\\nabla_{\\widehat{x}} \\widehat{\\varphi}_2 \\cdot \\mathbf{e}_1) \\, \\mathrm{d}\\widehat{x} = -3 \\int_{\\widehat{K}} \\widehat{\\psi}_2 \\frac{\\partial \\widehat{\\varphi}_2}{\\partial \\widehat{x}} \\, \\mathrm{d}\\widehat{x} $$\n梯度为 $\\nabla_{\\widehat{x}}\\widehat{\\varphi}_2 = (4\\lambda_2-1)\\nabla_{\\widehat{x}}\\lambda_2 = (4\\lambda_2-1)\\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$。\n所以，$\\frac{\\partial \\widehat{\\varphi}_2}{\\partial \\widehat{x}} = 4\\lambda_2-1$。\n积分变为：\n$$ B^K_{2,2x} = -3 \\int_{\\widehat{K}} \\lambda_2 (4\\lambda_2-1) \\, \\mathrm{d}\\widehat{x} = -3 \\int_{\\widehat{K}} (4\\lambda_2^2 - \\lambda_2) \\, \\mathrm{d}\\widehat{x} $$\n$$ = -3 \\left( 4\\int_{\\widehat{K}}\\lambda_2^2 \\, \\mathrm{d}\\widehat{x} - \\int_{\\widehat{K}}\\lambda_2 \\, \\mathrm{d}\\widehat{x} \\right) $$\n使用与之前相同的积分公式（根据对称性，它们对于 $\\lambda_2$ 是相同的）：\n$$ = -3 \\left( 4\\left(\\frac{1}{12}\\right) - \\frac{1}{6} \\right) = -3 \\left( \\frac{1}{3} - \\frac{1}{6} \\right) = -3 \\left( \\frac{1}{6} \\right) = -\\frac{1}{2} $$\n因此，$B_{2,2x} = -1/2$。\n\n**最终量 S**\n量 $S$ 定义为两个计算出的项之和：\n$$ S = A_{1x,1x} + B_{2,2x} = \\nu + \\left(-\\frac{1}{2}\\right) = \\nu - \\frac{1}{2} $$", "answer": "$$\\boxed{\\nu - \\frac{1}{2}}$$", "id": "3382200"}, {"introduction": "在了解了如何组装矩阵之后，本练习将探讨一个关键问题：“为什么”要选择特定的有限元配对。我们将聚焦于 Ladyzhenskaya–Babuška–Brezzi (LBB) 或称 inf-sup 条件，这是保证不可压缩流混合法稳定性的基石 [@problem_id:3382192]。通过分析不稳定的 $P_1-P_0$ 单元并识别多种有效的稳定化策略，你将对压力-速度耦合这一核心挑战及其解决方案建立深刻的理解。", "problem": "考虑在域 $\\Omega = (0,1)^2$ 上，不可压缩纳维-斯托克斯方程所对应的定常斯托克斯子问题，其速度边界条件为齐次狄利克雷条件。设 $\\mathcal{T}_h$ 表示一个均匀三角剖分，该剖分通过将一个 $N \\times N$ 笛卡尔网格的每个正方形沿相同的对角线方向分割成两个全等的直角三角形而得到。考虑协调伽辽金离散，其速度空间为 $V_h = \\left([P_1^c(\\mathcal{T}_h)]^2 \\cap [H_0^1(\\Omega)]^2\\right)$，压力空间为 $Q_h = P_0(\\mathcal{T}_h) \\cap L_0^2(\\Omega)$，其中 $P_k^c$ 表示 $k$ 次连续分片多项式，而没有上标 $c$ 的 $P_k$ 表示 $k$ 次非连续分片多项式。离散 Ladyzhenskaya–Babuška–Brezzi (LBB) inf-sup 条件要求存在一个与 $h$ 无关的常数 $\\beta_h > 0$，使得\n$$\n\\beta_h \\,\\|q_h\\|_{0} \\le \\sup_{v_h \\in V_h \\setminus \\{0\\}} \\frac{\\displaystyle \\int_\\Omega q_h \\,\\nabla\\cdot v_h \\,dx}{\\|v_h\\|_{1}} \\quad \\text{for all } q_h \\in Q_h,\n$$\n其中 $\\|\\cdot\\|_0$ 是 $L^2(\\Omega)$-范数，$\\|\\cdot\\|_1$ 是 $H^1(\\Omega)$-半范数。\n\n仅使用散度算子的基本性质、单元上的通量平衡以及由 $V_h$ 的选择所隐含的连续性约束，推断该元对在上述均匀三角剖分上是否满足离散 inf-sup 条件。如果不满足，请指出以下哪些修改可以恢复一个一致稳定的格式（选择所有适用项）。您的推理应基于第一性原理，如散度定理和有限元空间的结构，而不是不加论证地引用最终结果。\n\n选项：\n- A. 元对 $V_h = [P_1^c]^2$, $Q_h = P_0$ 在 $\\Omega$ 的任何形状正则的三角剖分上都满足离散 inf-sup 条件；无需修改。\n\n- B. 该元对在给定的均匀网格上由于存在伪压力模式而未能满足离散 inf-sup 条件；通过为每个内部边添加一个向量值的边泡函数基来丰富 $V_h$（Bernardi–Raugel 型加密），同时保持 $Q_h = P_0$，可以恢复一致的离散 inf-sup 条件。\n\n- C. 该元对未能满足离散 inf-sup 条件；将其替换为泰勒-胡德元对 $V_h = [P_2^c]^2 \\cap [H_0^1(\\Omega)]^2$ 和 $Q_h = P_1^c \\cap L_0^2(\\Omega)$，可以得到一个一致 inf-sup 稳定的格式。\n\n- D. 该元对未能满足离散 inf-sup 条件；仅添加一个 grad-div 罚项 $\\alpha \\int_\\Omega (\\nabla\\cdot u_h)(\\nabla\\cdot v_h)\\,dx$（其中 $\\alpha > 0$ 为任意固定常数），同时保持 $V_h = [P_1^c]^2$ 和 $Q_h = P_0$，可以恢复一个一致的离散 inf-sup 条件。\n\n- E. 该元对未能满足离散 inf-sup 条件；切换到 Crouzeix–Raviart (CR) 非协调速度空间 $V_h = [P_1^{\\text{CR}}]^2$ 并配合 $Q_h = P_0$，可以得到一个一致 inf-sup 稳定的格式。\n\n- F. 该元对未能满足离散 inf-sup 条件；保持 $V_h = [P_1^c]^2$ 和 $Q_h = P_0$ 不变，但在内部边 $\\mathcal{E}_h^\\circ$ 上添加一个压力跳跃稳定项 $s_h(p_h,q_h) = \\sum_{e \\in \\mathcal{E}_h^\\circ} \\gamma\\, h_e \\int_e [p_h]\\,[q_h] \\,ds$（其中参数 $\\gamma > 0$ 与网格无关），可以得到一个在稳定范数下具有与 $h$ 无关的 inf-sup 下界的稳定方法。", "solution": "用户希望我验证并解决一个关于斯托克斯方程有限元离散稳定性的问题。\n\n### 问题验证\n\n**第 1 步：提取已知条件**\n\n*   **问题：**定常斯托克斯子问题。\n*   **区域：** $\\Omega = (0,1)^2$。\n*   **边界条件：**齐次狄利克雷速度条件，$v = 0$ 在 $\\partial\\Omega$ 上。\n*   **三角剖分 $\\mathcal{T}_h$：**一个来自 $N \\times N$ 笛卡尔网格的均匀网格，其中每个正方形通过相同的对角线方向被分割成两个全等的直角三角形。\n*   **速度空间 $V_h$：** $V_h = \\left([P_1^c(\\mathcal{T}_h)]^2 \\cap [H_0^1(\\Omega)]^2\\right)$，即 $\\mathcal{T}_h$ 上在边界上为零的连续分片线性向量场空间。\n*   **压力空间 $Q_h$：** $Q_h = P_0(\\mathcal{T}_h) \\cap L_0^2(\\Omega)$，即 $\\mathcal{T}_h$ 上在 $\\Omega$ 上均值为零的分片常数函数空间。\n*   **离散 LBB 条件：**需要检查的条件是是否存在一个与网格尺寸无关的常数 $\\beta > 0$，使得：\n    $$\n    \\beta \\,\\|q_h\\|_{0} \\le \\sup_{v_h \\in V_h \\setminus \\{0\\}} \\frac{\\displaystyle \\int_\\Omega q_h \\,\\nabla\\cdot v_h \\,dx}{\\|v_h\\|_{1}} \\quad \\text{for all } q_h \\in Q_h.\n    $$\n    此处，$\\|\\cdot\\|_0$ 是 $L^2(\\Omega)$-范数，而 $\\|v_h\\|_1$ 是 $H^1(\\Omega)$-半范数，即 $\\|v_h\\|_1 = \\|\\nabla v_h\\|_{L^2(\\Omega)}$。根据庞加莱不等式，对于 $H_0^1(\\Omega)$ 中的函数，该半范数等价于完整的 $H^1(\\Omega)$-范数。\n\n**第 2 步：使用提取的已知条件进行验证**\n\n*   **科学依据：**该问题是偏微分方程数值分析中的一个经典问题，具体涉及不可压缩流混合有限元方法的稳定性。斯托克斯问题、Ladyzhenskaya–Babuška–Brezzi (LBB) 条件以及指定的有限元空间（$P_1^c$, $P_0$）都是该领域的基本概念。该问题在科学上是合理的。\n*   **良定性：**该问题是良定的。它要求确定给定元对的稳定性，然后指出所列修改中哪些可以得到稳定格式。这些都是数值分析中标准的、可回答的问题。\n*   **客观性：**该问题使用精确的数学术语陈述，没有任何歧义或主观语言。\n\n**第 3 步：结论与行动**\n\n问题是有效的。我将继续进行解答。\n\n### 推导与选项分析\n\n斯托克斯问题混合有限元方法的稳定性由离散 Ladyzhenskaya–Babuška–Brezzi (LBB) 条件（也称为 inf-sup 条件）决定。如果该条件不能被一个与网格无关的常数 $\\beta > 0$ 满足，将导致离散系统奇异或病态，并使压力解出现伪振荡。\n\n首先，我们分析给定元对的稳定性：连续分片线性速度（$P_1^c$）和分片常数压力（$P_0$）。\n\nLBB 条件的核心是双线性形式 $b(v_h, q_h) = \\int_\\Omega q_h \\nabla \\cdot v_h \\,dx$。在每个单元 $T \\in \\mathcal{T}_h$ 上进行分部积分：\n$$ \\int_T q_h \\nabla \\cdot v_h \\,dx = - \\int_T v_h \\cdot \\nabla q_h \\,dx + \\int_{\\partial T} q_h (v_h \\cdot n_T) \\,ds $$\n由于 $q_h \\in P_0(\\mathcal{T}_h)$，其梯度 $\\nabla q_h$ 在每个单元 $T$ 内部为零。对所有单元求和，我们得到：\n$$ \\int_\\Omega q_h \\nabla \\cdot v_h \\,dx = \\sum_{T \\in \\mathcal{T}_h} \\int_{\\partial T} (q_h|_T) (v_h \\cdot n_T) \\,ds $$\n由于 $v_h$ 在内部边上是连续的，且在 $\\partial \\Omega$ 上 $v_h=0$，因此共享一个内部边 $e$ 的相邻单元 $T_1$ 和 $T_2$ 的贡献会合并。由于在 $e$ 上 $n_{T_2} = -n_{T_1}$，求和变为：\n$$ \\int_\\Omega q_h \\nabla \\cdot v_h \\,dx = \\sum_{e \\in \\mathcal{E}_h^\\circ} \\int_e [q_h]_e (v_h \\cdot n_e) \\,ds $$\n其中 $\\mathcal{E}_h^\\circ$ 是内部边的集合，$[q_h]_e = q_h|_{T_1} - q_h|_{T_2}$ 是压力跨过边 $e$ 的跳跃。\n\n如果存在一个非零压力 $q_h \\in Q_h$（即“伪模式”），使得对于所有 $v_h \\in V_h$ 都有 $\\int_\\Omega q_h \\nabla \\cdot v_h \\,dx = 0$，那么 LBB 条件就不成立。对于 $P_1^c$ 速度空间，自由度是三角剖分顶点处的向量值。边上法向迹 $\\{v_h \\cdot n_e\\}$ 的空间不够丰富，无法约束所有可能的压力跳跃 $[q_h]_e$。在指定的均匀网格上，可以构造一种“棋盘”或“米字旗”类型的压力模式。这样的 $q_h$ 非零，均值为零，并且与任何 $v_h \\in V_h$ 的散度作积分时结果为零。压力自由度的数量（$\\dim(Q_h) = |\\mathcal{T}_h|-1 = 2N^2-1$）相对于起约束作用的速度自由度的数量（$\\dim(V_h) = 2(N-1)^2$）来说太大了。因此，$P_1^c$-$P_0$ 元对是不稳定的。\n\n现在我们来评估每个选项。\n\n**A. 元对 $V_h = [P_1^c]^2$, $Q_h = P_0$ 在 $\\Omega$ 的任何形状正则的三角剖分上都满足离散 inf-sup 条件；无需修改。**\n**分析：**如上所述，$P_1^c$-$P_0$ 元对在大多数常见的三角剖分（包括指定的这种）上都是不稳定的。由于存在伪压力模式，它不满足 LBB 条件。\n**结论：不正确。**\n\n**B. 该元对在给定的均匀网格上由于存在伪压力模式而未能满足离散 inf-sup 条件；通过为每个内部边添加一个向量值的边泡函数基来丰富 $V_h$（Bernardi–Raugel 型加密），同时保持 $Q_h = P_0$，可以恢复一致的离散 inf-sup 条件。**\n**分析：**初始的失败诊断是正确的。提议的修改涉及用与每个内部边相关的向量值泡函数来丰富速度空间 $V_h$。设 $b_e$ 是边 $e=T_1 \\cap T_2$ 的这样一个泡函数。它在 $T_1 \\cup T_2$ 上具有局部支集，并且可以被构造成在 $e$ 上具有非零的法向分量通量，即 $\\int_e b_e \\cdot n_e \\,ds \\neq 0$。用这个 $b_e$ 进行测试，我们得到：\n$$ \\int_\\Omega q_h \\nabla \\cdot b_e \\,dx = \\sum_{e' \\in \\mathcal{E}_h^\\circ} \\int_{e'} [q_h]_{e'} (b_e \\cdot n_{e'}) \\,ds = \\int_e [q_h]_e (b_e \\cdot n_e) \\, ds $$\n如果我们要求对于一个伪模式 $q_h$ 这个值为零，它会迫使跳跃 $[q_h]_e$ 为零。由于可以对每个内部边都这样做，这就迫使 $q_h$ 成为一个常数函数。由于 $q_h \\in L_0^2(\\Omega)$，它在 $\\Omega$ 上的积分为零，所以这个常数必须是零。因此，$q_h=0$。这种加密通过提供对压力跳跃的直接控制来消除所有伪模式，从而恢复了一致的 inf-sup 条件。\n**结论：正确。**\n\n**C. 该元对未能满足离散 inf-sup 条件；将其替换为泰勒-胡德元对 $V_h = [P_2^c]^2 \\cap [H_0^1(\\Omega)]^2$ 和 $Q_h = P_1^c \\cap L_0^2(\\Omega)$，可以得到一个一致 inf-sup 稳定的格式。**\n**分析：**失败的诊断是正确的。泰勒-胡德元族对速度使用 $k$ 次连续分片多项式，对压力使用 $k-1$ 次连续分片多项式（$P_k^c-P_{k-1}^c$），是当 $k \\ge 2$ 时稳定配对的经典例子。给定的选择，即连续二次速度（$P_2^c$）和连续线性压力（$P_1^c$），是最常见的泰勒-胡德元。它在形状正则三角剖分上的稳定性是不可压缩流有限元理论的一个基石性结果。更丰富的速度空间为压力空间提供了足够的约束，以确保 LBB 条件一致成立。\n**结论：正确。**\n\n**D. 该元对未能满足离散 inf-sup 条件；仅添加一个 grad-div 罚项 $\\alpha \\int_\\Omega (\\nabla\\cdot u_h)(\\nabla\\cdot v_h)\\,dx$（其中 $\\alpha > 0$ 为任意固定常数），同时保持 $V_h = [P_1^c]^2$ 和 $Q_h = P_0$，可以恢复一个一致的离散 inf-sup 条件。**\n**分析：**失败的诊断是正确的。grad-div 稳定化是一种修改动量方程弱形式的技术，而不是修改质量守恒方程或底层的 $V_h$ 和 $Q_h$ 空间。它增加了一个罚项，使得解 $u_h$ 的“散度更小”。这导出了一个稳定且收敛的数值方法。然而，它并没有“恢复”问题中定义的 LBB 条件。LBB 条件是空间 $V_h$、$Q_h$ 以及双线性形式 $b(v_h, q_h)$ 的一个性质。这些都没有改变。该方法是绕过了因 LBB 条件失效而导致的不稳定性，而不是直接修复它。因此，关于此修改恢复了指定的 LBB 条件的说法在技术上是不正确的。\n**结论：不正确。**\n\n**E. 该元对未能满足离散 inf-sup 条件；切换到 Crouzeix–Raviart (CR) 非协调速度空间 $V_h = [P_1^{\\text{CR}}]^2$ 并配合 $Q_h = P_0$，可以得到一个一致 inf-sup 稳定的格式。**\n**分析：**失败的诊断是正确的。Crouzeix-Raviart 元使用分片线性函数，这些函数在单元边界上不连续，但在边的中点处是连续的。因为它不在 $H^1(\\Omega)$ 中，所以它是一个“非协调”元。$P_1^{\\text{CR}}$ 速度和 $P_0$ 压力的配对是一个著名的 LBB 稳定元。速度的自由度是边中点处的向量值。这提供了对每个边上常数压力跳跃的直接控制。其推理与选项 B 中的类似：对于任何内部边 $e$，可以在 CR 空间中选择一个仅在该边中点非零的基函数，该函数可以检测到压力跳跃 $[q_h]_e$。这确保了不存在伪压力模式。\n**结论：正确。**\n\n**F. 该元对未能满足离散 inf-sup 条件；保持 $V_h = [P_1^c]^2$ 和 $Q_h = P_0$ 不变，但在内部边 $\\mathcal{E}_h^\\circ$ 上添加一个压力跳跃稳定项 $s_h(p_h,q_h) = \\sum_{e \\in \\mathcal{E}_h^\\circ} \\gamma\\, h_e \\int_e [p_h]\\,[q_h] \\,ds$ ... 可以得到一个在稳定范数下具有与 $h$ 无关的 inf-sup 下界的稳定方法。**\n**分析：**失败的诊断是正确的。此修改描述了一种压力稳定化方法（伽辽金/最小二乘法，或 GLS 的一种形式）。离散弱形式通过增加一个惩罚压力解在单元界面上跳跃的项而被改变。原始的 LBB 条件不被满足，但整个系统的稳定性得以恢复。这类方法的稳定性证明表明，相对于压力空间上一个修正的、依赖于网格的范数，inf-sup 条件是成立的，该范数通常形式为 $\\|q_h\\|_h^2 = \\|q_h\\|_0^2 + s_h(q_h, q_h)$。该选项的措辞承认稳定性是通过一个在“稳定范数”下的 inf-sup 条件实现的，这是对该方法的准确描述。\n**结论：正确。**", "answer": "$$\\boxed{BCEF}$$", "id": "3382192"}, {"introduction": "从线性 Stokes 问题推进到完全非线性的 Navier-Stokes 方程，我们必须处理对流项，这是数值计算困难和不稳定性的主要来源。本练习将研究在离散层面，对流项的不同数学形式（平流形式、守恒形式和旋转形式）在动能守恒方面的表现 [@problem_id:3382198]。通过编程实现并比较这些形式，你将获得关于离散化选择如何保持或人为产生能量的实践洞察，这对于保证模拟的长期稳定性和物理真实性至关重要。", "problem": "考虑在二维域上具有适当边界条件的速度场 $u(x,y,t) \\in \\mathbb{R}^2$ 的不可压缩 Navier–Stokes 方程。重点关注对流项及其三种等效的连续形式：平流形式 $(u \\cdot \\nabla) u$，守恒形式 $\\nabla \\cdot (u \\otimes u)$，以及定义为平流形式和守恒形式算术平均值的旋转（斜对称）形式。动能为 $E(t) = \\frac{1}{2} \\int_{\\Omega} |u|^2 \\, \\mathrm{d}\\Omega$。从时间上半离散（空间离散，时间连续）的角度看，由对流项引起的动能变化率为\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\left( \\frac{1}{2} \\int_{\\Omega} |u|^2 \\, \\mathrm{d}\\Omega \\right) = - \\int_{\\Omega} u \\cdot \\mathcal{C}(u) \\, \\mathrm{d}\\Omega,\n$$\n其中 $\\mathcal{C}(u)$ 表示作用于 $u$ 上的所选离散对流算子。对于不可压缩流（$\\nabla \\cdot u = 0$）和在周期性或齐次边界条件下进行精确空间积分时，这三种形式的连续恒等式均产生零能量。\n\n您的任务是，在两种代表有限元法（FEM）中质量矩阵作用的空间积分策略下，推导、实现并量化对流项三种形式的离散动能恒等式：\n1. 一致质量积分：通过 Gaussian 求积进行精确的单元积分，这代表了一致质量矩阵的作用。\n2. 集中质量积分：在节点上使用 Gauss–Lobatto 求积，这会产生一个对角（集总）质量矩阵。\n\n在单位正方形 $\\Omega = [0,1] \\times [0,1]$ 的 $N_x \\times N_y$ 个单元的结构化矩形网格上，使用双线性 $Q_1$ 有限元法（FEM）进行近似。设离散速度 $u_h(x,y)$ 是通过标准的 $Q_1$ 形函数从节点值获得的。设 $\\Delta t$ 表示时间步长；考虑极限 $\\Delta t \\to 0$，此时瞬时能量产生率等于 $- \\int_{\\Omega} u_h \\cdot \\mathcal{C}_h(u_h) \\, \\mathrm{d}\\Omega$，这定义了在显式时间积分方案中当时间步长趋于零时观察到的伪增长。\n\n任务：\n- 从对流项的三种形式和动能的定义出发，通过用 $u_h$、其梯度和所选的求积法则来表示半离散能量变化率，从而推导出离散动能恒等式。使用以下逐点计算的算子定义：\n  - 平流形式: $(u_h \\cdot \\nabla) u_h$,\n  - 守恒形式: $\\nabla \\cdot (u_h \\otimes u_h)$,\n  - 旋转（斜对称）形式: $\\frac{1}{2}\\left[(u_h \\cdot \\nabla) u_h + \\nabla \\cdot (u_h \\otimes u_h)\\right]$。\n- 证明在精确空间积分下，即使 $\\nabla \\cdot u_h \\neq 0$，旋转形式也产生零离散能量；而平流形式和守恒形式产生的能量大小相等、符号相反，且与 $\\int_{\\Omega} (\\nabla \\cdot u_h) |u_h|^2 \\, \\mathrm{d}\\Omega$ 成正比。\n- 实现一个程序，计算瞬时离散能量产生率\n$$\ng = - \\int_{\\Omega} u_h \\cdot \\mathcal{C}_h(u_h) \\, \\mathrm{d}\\Omega\n$$\n对于每种形式，使用两种求积策略：\n  - 一致：每个单元上使用 $2\\times 2$ Gaussian 求积（代表一致质量矩阵）。\n  - 集总：在单元角点使用 $2\\times 2$ Gauss–Lobatto 求积（代表集总质量矩阵）。\n- 在参考正方形 $[-1,1]^2$ 上使用 $Q_1$ 形函数，并通过仿射映射到每个物理单元。在每个求积点，评估 $u_h$ 及其梯度，然后计算每种形式的逐点能量产生被积函数 $u_h \\cdot \\mathcal{C}_h(u_h)$。在所有单元上进行组装。\n\n速度测试场：\n- 无散度测试场：\n$$\nu(x,y) = \\begin{bmatrix}\n\\sin(2\\pi x)\\, \\cos(2\\pi y) \\\\\n- \\cos(2\\pi x)\\, \\sin(2\\pi y)\n\\end{bmatrix}.\n$$\n- 非无散度测试场：\n$$\nu(x,y) = \\begin{bmatrix}\n\\sin(2\\pi x) \\\\\n\\sin(2\\pi y)\n\\end{bmatrix}.\n$$\n\n单位说明：所有量均为无量纲；将能量产生率 $g$ 报告为纯数。\n\n测试套件：\n计算并输出以下参数集的瞬时能量产生率 $g$，每个参数集指定为一个元组 $(\\text{求积}, \\text{速度}, \\text{形式}, N_x, N_y)$：\n1. $(\\text{一致}, \\text{无散度}, \\text{平流}, 4, 4)$,\n2. $(\\text{一致}, \\text{非无散度}, \\text{平流}, 4, 4)$,\n3. $(\\text{一致}, \\text{非无散度}, \\text{守恒}, 4, 4)$,\n4. $(\\text{一致}, \\text{非无散度}, \\text{旋转}, 4, 4)$,\n5. $(\\text{集总}, \\text{无散度}, \\text{旋转}, 2, 2)$,\n6. $(\\text{集总}, \\text{非无散度}, \\text{旋转}, 1, 1)$,\n7. $(\\text{集总}, \\text{非无散度}, \\text{平流}, 4, 4)$,\n8. $(\\text{集总}, \\text{非无散度}, \\text{守恒}, 4, 4)$.\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,...]”），其中每个结果是按上述顺序列出的相应测试用例的 $g$ 的浮点值。不应打印任何其他文本。", "solution": "用户提供的问题被评估为**有效**，因为它具有科学依据、良定、客观，并包含唯一解所需的所有必要信息，没有任何矛盾或歧义。该问题要求推导和数值计算不可压缩 Navier-Stokes 方程中对流项不同形式的离散动能产生率，这是计算流体动力学中的一个标准课题。\n\n### 理论推导\n\n由于对流项引起的动能 $E_h(t) = \\frac{1}{2}\\int_{\\Omega} |u_h|^2 \\, \\mathrm{d}\\Omega$ 的瞬时变化率由能量产生率 $g$ 给出。考虑半离散动量方程 $\\frac{\\partial u_h}{\\partial t} = -\\mathcal{C}_h(u_h) + \\dots$，其中 $\\mathcal{C}_h(u_h)$ 是离散对流算子，能量变化率为：\n$$\ng = \\frac{\\mathrm{d}E_h}{\\mathrm{d}t} = \\int_{\\Omega} u_h \\cdot \\frac{\\partial u_h}{\\partial t} \\, \\mathrm{d}\\Omega = - \\int_{\\Omega} u_h \\cdot \\mathcal{C}_h(u_h) \\, \\mathrm{d}\\Omega\n$$\n我们针对给定的三种对流项形式分析此表达式。设 $u_h$ 为离散速度场，它在每个单元内是可微的矢量函数。\n\n**1. 对流形式之间的逐点关系**\n\n这三种形式逐点定义如下：\n- 平流形式： $\\mathcal{C}_h^{adv}(u_h) = (u_h \\cdot \\nabla) u_h$\n- 守恒形式： $\\mathcal{C}_h^{cons}(u_h) = \\nabla \\cdot (u_h \\otimes u_h)$\n- 旋转形式： $\\mathcal{C}_h^{rot}(u_h) = \\frac{1}{2}(\\mathcal{C}_h^{adv}(u_h) + \\mathcal{C}_h^{cons}(u_h))$\n\n使用矢量微积分中关于外积散度的恒等式 $\\nabla \\cdot (a \\otimes b) = (\\nabla \\cdot b) a + (b \\cdot \\nabla) a$，我们令 $a=u_h$ 和 $b=u_h$：\n$$\n\\nabla \\cdot (u_h \\otimes u_h) = (u_h \\cdot \\nabla) u_h + u_h (\\nabla \\cdot u_h)\n$$\n这提供了守恒形式和平流形式之间的直接代数关系：\n$$\n\\mathcal{C}_h^{cons}(u_h) = \\mathcal{C}_h^{adv}(u_h) + u_h (\\nabla \\cdot u_h)\n$$\n将此代入旋转形式的定义中可得：\n$$\n\\mathcal{C}_h^{rot}(u_h) = \\frac{1}{2}(\\mathcal{C}_h^{adv}(u_h) + \\mathcal{C}_h^{adv}(u_h) + u_h (\\nabla \\cdot u_h)) = \\mathcal{C}_h^{adv}(u_h) + \\frac{1}{2} u_h (\\nabla \\cdot u_h)\n$$\n\n**2. 能量产生率之间的关系**\n\n利用这些逐点恒等式，我们可以关联能量产生率。设 $g_{adv}$、$g_{cons}$ 和 $g_{rot}$ 分别为平流、守恒和旋转形式的产生率。\n$$\ng_{cons} = - \\int_{\\Omega} u_h \\cdot \\mathcal{C}_h^{cons}(u_h) \\, \\mathrm{d}\\Omega = - \\int_{\\Omega} u_h \\cdot (\\mathcal{C}_h^{adv}(u_h) + u_h(\\nabla \\cdot u_h)) \\, \\mathrm{d}\\Omega\n$$\n$$\ng_{cons} = \\left( - \\int_{\\Omega} u_h \\cdot \\mathcal{C}_h^{adv}(u_h) \\, \\mathrm{d}\\Omega \\right) - \\int_{\\Omega} |u_h|^2 (\\nabla \\cdot u_h) \\, \\mathrm{d}\\Omega = g_{adv} - \\int_{\\Omega} |u_h|^2 (\\nabla \\cdot u_h) \\, \\mathrm{d}\\Omega\n$$\n对于旋转形式，类似地：\n$$\ng_{rot} = - \\int_{\\Omega} u_h \\cdot \\mathcal{C}_h^{rot}(u_h) \\, \\mathrm{d}\\Omega = - \\int_{\\Omega} u_h \\cdot (\\mathcal{C}_h^{adv}(u_h) + \\frac{1}{2} u_h(\\nabla \\cdot u_h)) \\, \\mathrm{d}\\Omega\n$$\n$$\ng_{rot} = g_{adv} - \\frac{1}{2} \\int_{\\Omega} |u_h|^2 (\\nabla \\cdot u_h) \\, \\mathrm{d}\\Omega\n$$\n从这些关系可以得出 $g_{rot} = \\frac{1}{2}(g_{adv} + g_{cons})$。这些是代数关系，无论使用何种数值积分法则都成立，只要用相同的法则计算所有三种率。\n\n**3. 精确积分下的性质**\n\n问题要求在精确空间积分的假设下证明某些性质。这意味着分部积分成立。我们分析 $g_{adv}$：\n$$\ng_{adv} = - \\int_{\\Omega} u_h \\cdot ((u_h \\cdot \\nabla) u_h) \\, \\mathrm{d}\\Omega\n$$\n使用矢量恒等式 $(v \\cdot \\nabla)v = \\frac{1}{2}\\nabla(|v|^2) - v \\times (\\nabla \\times v)$，项 $u_h \\cdot ((u_h \\cdot \\nabla) u_h)$ 可简化为 $\\frac{1}{2} u_h \\cdot \\nabla(|u_h|^2)$。\n$$\ng_{adv} = - \\int_{\\Omega} \\frac{1}{2} u_h \\cdot \\nabla(|u_h|^2) \\, \\mathrm{d}\\Omega\n$$\n应用分部积分（通过散度定理 $\\int_{\\Omega} v \\cdot \\nabla f \\,d\\Omega = \\int_{\\partial \\Omega} f(v \\cdot n) \\,dS - \\int_{\\Omega} f(\\nabla \\cdot v) \\,d\\Omega$），其中 $v=u_h$ 且 $f = \\frac{1}{2}|u_h|^2$，并假设边界积分消失（由于周期性或齐次边界条件），我们得到：\n$$\n\\int_{\\Omega} \\frac{1}{2} u_h \\cdot \\nabla(|u_h|^2) \\, \\mathrm{d}\\Omega = - \\int_{\\Omega} \\frac{1}{2} |u_h|^2 (\\nabla \\cdot u_h) \\, \\mathrm{d}\\Omega\n$$\n因此，对于精确积分：\n$$\ng_{adv} = - \\left( - \\frac{1}{2} \\int_{\\Omega} |u_h|^2 (\\nabla \\cdot u_h) \\, \\mathrm{d}\\Omega \\right) = \\frac{1}{2} \\int_{\\Omega} |u_h|^2 (\\nabla \\cdot u_h) \\, \\mathrm{d}\\Omega\n$$\n这表明平流形式的能量产生与一个涉及离散散度 $\\nabla \\cdot u_h$ 的积分成正比。现在，将此结果代回到 $g_{cons}$ 和 $g_{rot}$ 的代数关系中：\n$$\ng_{cons} = g_{adv} - \\int_{\\Omega} |u_h|^2 (\\nabla \\cdot u_h) \\, \\mathrm{d}\\Omega = \\frac{1}{2} \\int |u_h|^2 (\\nabla \\cdot u_h) \\, \\mathrm{d}\\Omega - \\int |u_h|^2 (\\nabla \\cdot u_h) \\, \\mathrm{d}\\Omega = - \\frac{1}{2} \\int |u_h|^2 (\\nabla \\cdot u_h) \\, \\mathrm{d}\\Omega\n$$\n这证实了 $g_{cons} = -g_{adv}$。对于旋转形式：\n$$\ng_{rot} = g_{adv} - \\frac{1}{2} \\int_{\\Omega} |u_h|^2 (\\nabla \\cdot u_h) \\, \\mathrm{d}\\Omega = \\frac{1}{2} \\int |u_h|^2 (\\nabla \\cdot u_h) \\, \\mathrm{d}\\Omega - \\frac{1}{2}\\int |u_h|^2 (\\nabla \\cdot u_h) \\, \\mathrm{d}\\Omega = 0\n$$\n这证明了旋转（斜对称）形式的关键性质：即使对于非无散度的离散速度场（$ \\nabla \\cdot u_h \\neq 0 $），只要积分是精确计算的，它也能在离散层面产生零净动能。数值求积是对这些积分的近似，这些恒等式成立的程度取决于求积法则的精度。\n\n### 数值实现\n\n该程序使用 $Q_1$ 有限元法在结构化矩形网格上实现 $g$ 的计算。\n1.  **网格与单元**：将域 $\\Omega = [0,1] \\times [0,1]$ 划分为一个 $N_x \\times N_y$ 的矩形单元网格。\n2.  **形函数**：在参考单元 $[-1,1]^2$ 上定义标准的双线性形函数 $N_i(\\xi, \\eta)$ 及其梯度。通过仿射映射将它们转换到每个物理单元，该变换的雅可比行列式为常数。\n3.  **求积**：$g$ 的积分通过对所有单元求和来近似，而单元上的积分则通过数值求积计算：\n    $$\n    g = - \\sum_{e} \\int_{e} u_h \\cdot \\mathcal{C}_h(u_h) \\, \\mathrm{d}\\Omega_e \\approx - \\sum_{e} |J_e| \\sum_{q} w_q (u_h \\cdot \\mathcal{C}_h(u_h))|_{(\\xi_q, \\eta_q)}\n    $$\n    - **一致积分**使用 $2 \\times 2$ Gaussian 求积法则，该法则对最高 3 次的多项式是精确的，并提供高精度的近似。\n    - **集中质量积分**使用 $2 \\times 2$ Gauss-Lobatto 法则，求积点位于单元节点。这种方法精度较低，但在构造对角质量矩阵方面具有计算优势。\n4.  **求积点上的计算**：对于单元内的每个求积点，代码评估：\n    - 离散速度 $u_h = \\sum_i N_i u_i$ 及其梯度 $\\nabla u_h = \\sum_i u_i \\otimes (\\nabla N_i)^T$，其中 $u_i$ 是节点速度值。\n    - 散度 $\\nabla \\cdot u_h = \\text{tr}(\\nabla u_h)$。\n    - 针对指定的对流形式（平流、守恒或旋转）计算项 $u_h \\cdot \\mathcal{C}_h(u_h)$。\n5.  **组装**：将所有求积点和所有单元的贡献相加，得到总能量产生率 $g$。\n节点速度 $u_i$是通过在网格节点坐标处评估给定的解析测试场获得的。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef u_div_free(x, y):\n    \"\"\"Divergence-free velocity test field.\"\"\"\n    pi = np.pi\n    u = np.sin(2 * pi * x) * np.cos(2 * pi * y)\n    v = -np.cos(2 * pi * x) * np.sin(2 * pi * y)\n    return np.array([u, v])\n\ndef u_non_div_free(x, y):\n    \"\"\"Non-divergence-free velocity test field.\"\"\"\n    pi = np.pi\n    u = np.sin(2 * pi * x)\n    v = np.sin(2 * pi * y)\n    return np.array([u, v])\n\ndef get_shape_functions_and_grads(xi, eta):\n    \"\"\"\n    Computes Q1 shape functions and their gradients on the reference element [-1, 1]^2.\n    Nodes are ordered counter-clockwise starting from (-1, -1).\n    \"\"\"\n    N = 0.25 * np.array([\n        (1 - xi) * (1 - eta),  # Node 1: (-1, -1)\n        (1 + xi) * (1 - eta),  # Node 2: ( 1, -1)\n        (1 + xi) * (1 + eta),  # Node 3: ( 1,  1)\n        (1 - xi) * (1 + eta)   # Node 4: (-1,  1)\n    ])\n    \n    # Gradients with respect to (xi, eta)\n    grad_N_ref = 0.25 * np.array([\n        [-(1 - eta), -(1 - xi)],\n        [ (1 - eta), -(1 + xi)],\n        [ (1 + eta),  (1 + xi)],\n        [-(1 + eta),  (1 - xi)]\n    ])\n    return N, grad_N_ref\n\ndef compute_g(quad_type, vel_type, form_type, Nx, Ny):\n    \"\"\"\n    Computes the instantaneous discrete energy production rate g.\n    \"\"\"\n    if vel_type == 'divergence-free':\n        vel_func = u_div_free\n    else:\n        vel_func = u_non_div_free\n\n    if quad_type == 'lumped' and vel_type == 'non-divergence-free' and form_type == 'rotational' and Nx == 1 and Ny == 1:\n        # Special case: for the 1x1 mesh, the nodes are at the corners (0,0), (1,0), (1,1), (0,1).\n        # The non-div-free field u=[sin(2*pi*x), sin(2*pi*y)] is zero at all these nodes.\n        # Thus, the interpolated field u_h is identically zero, and g=0.\n        return 0.0\n\n    hx = 1.0 / Nx\n    hy = 1.0 / Ny\n    detJ = (hx / 2.0) * (hy / 2.0)\n    \n    # Transpose of the inverse Jacobian matrix for transforming gradients\n    inv_J_T = np.array([[2.0 / hx, 0.0], [0.0, 2.0 / hy]])\n\n    # Define 1D quadrature points and weights\n    if quad_type == 'consistent': # 2x2 Gaussian\n        p = 1.0 / np.sqrt(3.0)\n        quad_pts_1d = [-p, p]\n        quad_w_1d = [1.0, 1.0]\n    elif quad_type == 'lumped': # 2x2 Gauss-Lobatto\n        quad_pts_1d = [-1.0, 1.0]\n        quad_w_1d = [1.0, 1.0]\n    \n    # Create 2D quadrature by tensor product\n    quad_pts_2d = []\n    quad_w_2d = []\n    for i in range(2):\n        for j in range(2):\n            quad_pts_2d.append((quad_pts_1d[j], quad_pts_1d[i]))\n            quad_w_2d.append(quad_w_1d[j] * quad_w_1d[i])\n\n    g_total = 0.0\n\n    for elem_j in range(Ny):\n        for elem_i in range(Nx):\n            # Node coordinates: bottom-left, bottom-right, top-right, top-left\n            node_coords = np.array([\n                [elem_i * hx, elem_j * hy],\n                [(elem_i + 1) * hx, elem_j * hy],\n                [(elem_i + 1) * hx, (elem_j + 1) * hy],\n                [elem_i * hx, (elem_j + 1) * hy]\n            ])\n            \n            u_nodal = np.array([vel_func(x, y) for x, y in node_coords])\n\n            for q_idx in range(4):\n                xi, eta = quad_pts_2d[q_idx]\n                w = quad_w_2d[q_idx]\n\n                N, grad_N_ref = get_shape_functions_and_grads(xi, eta)\n                \n                u_h = np.zeros(2)\n                grad_u_h = np.zeros((2, 2))\n\n                for i_node in range(4):\n                    # Physical gradient of shape function\n                    grad_N_phys = np.dot(inv_J_T, grad_N_ref[i_node])\n                    # Interpolate velocity\n                    u_h += N[i_node] * u_nodal[i_node]\n                    # Interpolate velocity gradient\n                    grad_u_h += np.outer(u_nodal[i_node], grad_N_phys)\n\n                # Compute terms at the quadrature point\n                div_u_h = np.trace(grad_u_h)\n                C_adv = np.dot(grad_u_h, u_h) # This is (u_h . grad) u_h\n                \n                # Integrand is u_h . C(u_h)\n                u_dot_C_adv = np.dot(u_h, C_adv)\n\n                if form_type == 'advective':\n                    integrand = u_dot_C_adv\n                elif form_type == 'conservative':\n                    integrand = u_dot_C_adv + np.dot(u_h, u_h) * div_u_h\n                elif form_type == 'rotational':\n                    integrand = u_dot_C_adv + 0.5 * np.dot(u_h, u_h) * div_u_h\n                \n                g_total -= integrand * w * detJ\n\n    return g_total\n\n\ndef solve():\n    test_cases = [\n        ('consistent', 'divergence-free', 'advective', 4, 4),\n        ('consistent', 'non-divergence-free', 'advective', 4, 4),\n        ('consistent', 'non-divergence-free', 'conservative', 4, 4),\n        ('consistent', 'non-divergence-free', 'rotational', 4, 4),\n        ('lumped', 'divergence-free', 'rotational', 2, 2),\n        ('lumped', 'non-divergence-free', 'rotational', 1, 1),\n        ('lumped', 'non-divergence-free', 'advective', 4, 4),\n        ('lumped', 'non-divergence-free', 'conservative', 4, 4),\n    ]\n\n    results = []\n    for case in test_cases:\n        quad_type, vel_type, form_type, Nx, Ny = case\n        result = compute_g(quad_type, vel_type, form_type, Nx, Ny)\n        results.append(result)\n\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nsolve()\n```", "id": "3382198"}]}