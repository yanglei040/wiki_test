{"hands_on_practices": [{"introduction": "在我们深入研究求解完整欧拉方程组的复杂数值方法之前，理解如何在特定物理假设下简化这些方程是至关重要的一步。本练习将指导您应用等熵流的假设，在这种假设下，压力仅是密度的函数，从而将能量守恒方程从系统中解耦。通过这个推导 [@problem_id:3373662]，您将掌握如何将三方程的欧拉系统简化为更简洁的两方程形式，这对于理论分析和特定流动的建模都非常有价值。", "problem": "考虑一个一维空间中的无粘、可压缩流体，其流向坐标为 $x$，时间为 $t$。设密度为 $\\rho(x,t)$，速度为 $u(x,t)$，压力为 $p(x,t)$，比内能为 $e(x,t)$。总能量密度为 $E(x,t) = \\rho e + \\tfrac{1}{2}\\rho u^{2}$。控制定律为质量、动量和能量守恒。假设解是光滑的，且没有外部体积力或热量添加。流体是正压和等熵的，因此 $p = p(\\rho)$ 且 $dp/d\\rho  0$，比熵沿粒子路径为常数。仅使用守恒定律和等熵热力学关系，消去能量方程，并以守恒形式推导简化的等熵欧拉方程组。然后，引入守恒变量 $\\boldsymbol{U} = \\big(\\rho, m\\big)^{\\mathsf{T}}$，其中 $m = \\rho u$，并将守恒通量向量 $\\boldsymbol{F}(\\boldsymbol{U})$ 完全用 $\\rho$、$m$ 和 $p(\\rho)$ 表示。\n\n你的最终答案必须是通量向量 $\\boldsymbol{F}(\\boldsymbol{U})$，明确写成 $(\\rho,m)$ 和 $p(\\rho)$ 的函数，并格式化为单行矩阵。不要包含任何其他量。不需要进行数值计算。", "solution": "首先验证问题陈述，以确保其科学上合理、适定且客观。\n\n### 步骤 1：提取已知条件\n- **区域**：一维空间，坐标 $x$，时间 $t$。\n- **流体性质**：无粘、可压缩。\n- **状态变量**：密度 $\\rho(x,t)$、速度 $u(x,t)$、压力 $p(x,t)$、比内能 $e(x,t)$。\n- **导出量**：总能量密度 $E(x,t) = \\rho e + \\tfrac{1}{2}\\rho u^{2}$。\n- **控制方程**：质量、动量和能量守恒。\n- **假设**：光滑解，无外部体积力，无热量添加。\n- **热力学封闭**：流体是正压和等熵的，压力-密度关系为 $p = p(\\rho)$ 且 $dp/d\\rho  0$。\n- **目标**：\n    1.  消去能量方程，以守恒形式推导简化的等熵欧拉方程组。\n    2.  定义守恒状态向量 $\\boldsymbol{U} = \\big(\\rho, m\\big)^{\\mathsf{T}}$，其中 $m = \\rho u$。\n    3.  确定守恒通量向量 $\\boldsymbol{F}(\\boldsymbol{U})$ 为 $\\rho$、$m$ 和 $p(\\rho)$ 的函数。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据。欧拉方程是无粘流体流动的基本模型。当传热和粘性耗散效应可忽略不计时，等熵假设是一种标准的、具有物理意义的简化。条件 $dp/d\\rho  0$ 是物理上必需的，因为它确保了声速的平方 $c^2 = dp/d\\rho$ 为正，这对于方程组的双曲性和模型的物理稳定性是必要的。该问题作为一个推导任务是适定的；它自成体系，并提供了唯一确定所求通量向量所需的所有信息。语言客观，并使用了计算流体动力学的标准术语。问题没有任何科学不准确、矛盾或含糊之处。\n\n### 步骤 3：结论与行动\n该问题是**有效的**。将提供解答。\n\n对于一维、无粘、可压缩流体，在没有体积力和热源的情况下，其欧拉方程以守恒形式的偏微分方程组给出：\n$$\n\\frac{\\partial \\boldsymbol{U}_{full}}{\\partial t} + \\frac{\\partial \\boldsymbol{F}_{full}(\\boldsymbol{U}_{full})}{\\partial x} = \\boldsymbol{0}\n$$\n状态向量 $\\boldsymbol{U}_{full}$ 和通量向量 $\\boldsymbol{F}_{full}$ 为：\n$$\n\\boldsymbol{U}_{full} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}, \\quad \\boldsymbol{F}_{full}(\\boldsymbol{U}_{full}) = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E + p) \\end{pmatrix}\n$$\n其中 $\\rho$ 是密度，$u$ 是速度，$p$ 是压力，$E$ 是单位体积的总能量，定义为 $E = \\rho e + \\frac{1}{2}\\rho u^2$，其中 $e$ 是比内能。该系统分别代表质量、动量和能量的守恒。\n\n问题指明流动是等熵的，这意味着压力仅是密度的函数，$p = p(\\rho)$。这种热力学封闭关系提供了压力和密度之间的直接联系，从而无需独立的能量方程来确定热力学状态。\n\n我们来研究前两个守恒定律：\n1.  **质量守恒**：\n    $$\n    \\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} = 0\n    $$\n2.  **动量守恒**：\n    $$\n    \\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial (\\rho u^2 + p)}{\\partial x} = 0\n    $$\n在这两个方程中，变量是 $\\rho$、$u$ 和 $p$。由于给定的等熵关系 $p = p(\\rho)$，压力 $p$ 不是一个独立变量，而是由 $\\rho$ 决定。因此，这两个方程为两个未知变量 $\\rho$ 和 $u$ 构成了一个封闭系统。能量方程对于确定 $\\rho$ 和 $u$ 的动力学变得多余，因为力学状态和热力学状态不再独立。由质量和动量守恒方程组成，并通过关系 $p = p(\\rho)$ 封闭的系统，被称为等熵欧拉方程组。\n\n问题要求用守恒变量 $\\boldsymbol{U} = (\\rho, m)^{\\mathsf{T}}$ 来表示这个简化系统，其中 $m = \\rho u$ 是动量密度。我们寻求将该系统写成以下形式：\n$$\n\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\frac{\\partial \\boldsymbol{F}(\\boldsymbol{U})}{\\partial x} = \\boldsymbol{0}\n$$\n其中 $\\boldsymbol{F}(\\boldsymbol{U})$ 是待求的通量向量。\n\n$\\boldsymbol{U}$ 的第一个分量是 $\\rho$。相应的守恒定律（质量）是：\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial m}{\\partial x} = 0\n$$\n由此，我们可以确定通量向量的第一个分量 $F_1$ 为 $m$。\n\n$\\boldsymbol{U}$ 的第二个分量是 $m = \\rho u$。相应的守恒定律（动量）是：\n$$\n\\frac{\\partial m}{\\partial t} + \\frac{\\partial (\\rho u^2 + p)}{\\partial x} = 0\n$$\n为了确定通量向量的第二个分量 $F_2$，我们必须将动量通量 $\\rho u^2 + p$ 用守恒变量 $\\rho$ 和 $m$ 以及给定的函数 $p(\\rho)$ 来表示。\n\n速度 $u$ 可以写成 $u = \\frac{m}{\\rho}$。\n将此代入 $\\rho u^2$ 项中，得到：\n$$\n\\rho u^2 = \\rho \\left( \\frac{m}{\\rho} \\right)^2 = \\rho \\frac{m^2}{\\rho^2} = \\frac{m^2}{\\rho}\n$$\n压力项已经作为密度的函数给出，$p(\\rho)$。\n因此，动量通量为：\n$$\n\\rho u^2 + p = \\frac{m^2}{\\rho} + p(\\rho)\n$$\n这是通量向量的第二个分量 $F_2$。\n\n组合这些分量，等熵欧拉方程组的通量向量 $\\boldsymbol{F}(\\boldsymbol{U})$ 为：\n$$\n\\boldsymbol{F}(\\boldsymbol{U}) = \\begin{pmatrix} F_1 \\\\ F_2 \\end{pmatrix} = \\begin{pmatrix} m \\\\ \\frac{m^2}{\\rho} + p(\\rho) \\end{pmatrix}\n$$\n如要求所示，该表达式仅依赖于状态向量 $\\boldsymbol{U} = (\\rho, m)^{\\mathsf{T}}$ 的分量和给定的函数 $p(\\rho)$。因此，等熵欧拉方程组为：\n$$\n\\frac{\\partial}{\\partial t} \\begin{pmatrix} \\rho \\\\ m \\end{pmatrix} + \\frac{\\partial}{\\partial x} \\begin{pmatrix} m \\\\ \\frac{m^2}{\\rho} + p(\\rho) \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n问题要求最终答案是通量向量 $\\boldsymbol{F}(\\boldsymbol{U})$，并格式化为单行矩阵。", "answer": "$$\n\\boxed{\\begin{pmatrix} m  \\frac{m^2}{\\rho} + p(\\rho) \\end{pmatrix}}\n$$", "id": "3373662"}, {"introduction": "在使用显式时间积分方法求解双曲型方程（如欧拉方程）时，一个核心挑战是确保数值方案的稳定性。本练习探讨了著名的 Courant-Friedrichs-Lewy (CFL) 条件，它为稳定的时间步长设定了上限。您将首先从理论上论证这个条件如何源于信息在物理域中的传播速度（即特征速度），然后在一个具体的多网格单元问题 [@problem_id:3373678] 中应用该原理，计算出全局允许的最大时间步长。", "problem": "考虑无粘理想气体的一维欧拉方程，其比热比为 $\\gamma$，\n$$\n\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\frac{\\partial \\boldsymbol{F}(\\boldsymbol{U})}{\\partial x} = 0,\n$$\n其中 $\\boldsymbol{U} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}$ 且 $\\boldsymbol{F}(\\boldsymbol{U}) = \\begin{pmatrix} \\rho u \\\\ \\rho u^{2} + p \\\\ u\\left(E + p\\right) \\end{pmatrix}$，压力由理想气体状态方程 $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^{2}\\right)$ 给出。一个采用前向欧拉时间积分的显式有限体积守恒格式通过平衡界面上的数值通量来推进单元平均值。此类格式的 Courant-Friedrichs-Lewy (CFL) 稳定性要求可以通过线性化方程并使用通量雅可比矩阵的光谱半径来限制时间步长来证明。\n\n从这些原则出发，论证为什么每个单元中的最大允许时间步长受线性化双曲系统的最大特征速度控制，并证明在一维情况下，这导致了一个用当地流速 $u$ 和当地声速 $c$ 表示的单元界限，其中 $c = \\sqrt{\\gamma p / \\rho}$。\n\n然后，对于一个包含四个单元的笛卡尔网格段，其宽度分别为\n$$\n\\Delta x_{1} = 0.010,\\quad \\Delta x_{2} = 0.008,\\quad \\Delta x_{3} = 0.012,\\quad \\Delta x_{4} = 0.009,\n$$\n且单元中心的状态为\n$$\n(\\rho_{1}, u_{1}, p_{1}) = (1.0,\\ 50,\\ 1.0\\times 10^{5}),\\quad (\\rho_{2}, u_{2}, p_{2}) = (0.8,\\ -30,\\ 0.9\\times 10^{5}),\n$$\n$$\n(\\rho_{3}, u_{3}, p_{3}) = (1.2,\\ 80,\\ 1.1\\times 10^{5}),\\quad (\\rho_{4}, u_{4}, p_{4}) = (0.9,\\ 10,\\ 0.95\\times 10^{5}),\n$$\n取 $\\gamma = 1.4$ 和 Courant-Friedrichs-Lewy 数 $\\mathrm{CFL} = 0.60$。计算与导出的稳定性限制一致的最大全局允许显式时间步长 $\\Delta t_{\\max}$。以秒为单位表示最终时间步长，并将答案四舍五入至四位有效数字。", "solution": "该问题提出了一个分为两部分的任务：首先，对应用于一维欧拉方程的显式有限体积格式的 Courant-Friedrichs-Lewy (CFL) 稳定性条件进行理论论证；其次，对此条件进行数值应用，以确定给定流动配置下的最大全局允许时间步长。\n\n问题陈述已经过验证，被认为是合理的。它在科学上基于流体动力学和数值分析的原理，问题提法适定，提供了所有必要的信息，并且没有歧义或矛盾。因此，我们可以进行正式求解。\n\n第一部分：CFL条件的理论论证\n\n无粘理想气体的一维欧拉方程构成了一个非线性双曲守恒律系统：\n$$\n\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\frac{\\partial \\boldsymbol{F}(\\boldsymbol{U})}{\\partial x} = 0\n$$\n其中 $\\boldsymbol{U}$ 是守恒变量矢量，$\\boldsymbol{F}(\\boldsymbol{U})$ 是通量矢量。为了分析该系统所描述的信息传播，我们考虑其准线性形式：\n$$\n\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\boldsymbol{A}(\\boldsymbol{U}) \\frac{\\partial \\boldsymbol{U}}{\\partial x} = 0\n$$\n这里，$\\boldsymbol{A}(\\boldsymbol{U}) = \\frac{\\partial \\boldsymbol{F}}{\\partial \\boldsymbol{U}}$ 是通量雅可比矩阵。该系统是双曲的，因为对于任何物理上有效的状态 $\\boldsymbol{U}$，矩阵 $\\boldsymbol{A}(\\boldsymbol{U})$ 都具有实特征值和一套完备的线性无关特征向量。\n\n$\\boldsymbol{A}(\\boldsymbol{U})$ 的特征值代表信息在介质中传播的特征速度。对于一维欧拉方程，通过严格推导（包括对通量矢量 $\\boldsymbol{F}$ 关于状态矢量 $\\boldsymbol{U}$ 求导，并求解特征方程 $\\det(\\boldsymbol{A} - \\lambda\\boldsymbol{I}) = 0$）可得到以下三个特征值：\n$$\n\\lambda_1 = u - c, \\quad \\lambda_2 = u, \\quad \\lambda_3 = u + c\n$$\n其中 $u$ 是当地流体速度，$c = \\sqrt{\\gamma p / \\rho}$ 是当地声速。这些速度对应于相对于流动向上游（$u-c$）和下游（$u+c$）传播的声波，以及随流动平流的熵波/接触波（$u$）。\n\n一个显式有限体积格式根据单元界面上的通量，将单元 $j$ 在时间 $t^n$ 的单元平均状态 $\\boldsymbol{U}_j^n$ 更新到时间 $t^{n+1} = t^n + \\Delta t$ 的新状态 $\\boldsymbol{U}_j^{n+1}$。使用前向欧拉时间积分，更新公式为：\n$$\n\\boldsymbol{U}_j^{n+1} = \\boldsymbol{U}_j^n - \\frac{\\Delta t}{\\Delta x_j} [\\boldsymbol{\\hat{F}}_{j+1/2} - \\boldsymbol{\\hat{F}}_{j-1/2}]\n$$\n其中 $\\boldsymbol{\\hat{F}}_{j\\pm1/2}$ 是单元 $j$ 界面上的数值通量，它依赖于相邻单元的状态。这意味着新状态 $\\boldsymbol{U}_j^{n+1}$ 依赖于时间 $t^n$ 时单元 $j-1$、$j$ 和 $j+1$ 的信息。此信息的空间范围是区间 $[x_{j-1}, x_{j+1}]$，称为数值依赖区域。\n\nCourant-Friedrichs-Lewy (CFL) 条件是此类显式格式稳定性和收敛性的一个必要条件。它要求数值依赖区域必须包含物理依赖区域。在点 $(x_j, t^{n+1})$ 处解的物理依赖区域是时间 $t^n$ 时空间中的一个区域，来自该区域的物理信号可以影响该点的解。信号以特征速度 $\\lambda_k$ 传播。信号能传播的最快速度由雅可比矩阵的光谱半径给出，即 $\\rho(\\boldsymbol{A}) = \\max_k |\\lambda_k|$。\n$$\n\\rho(\\boldsymbol{A}) = \\max(|u - c|, |u|, |u + c|)\n$$\n由于声速 $c$ 是非负的，这三个值的最大值总是 $|u| + c$。我们来验证这一点。如果 $u \\ge 0$，那么 $u+c > u$ 且 $u+c > |u-c|$。如果 $u  0$，令 $u = -v$，其中 $v > 0$。这些速度是 $|-v-c|=v+c$、 $|-v|=v$ 和 $|-v+c|=|c-v|$。最大值是 $v+c = |u|+c$。因此，最大特征速度是 $S = |u| + c$。\n\n在时间 $t^n$ 时，点 $(x_j, t^{n+1})$ 的物理依赖区域是区间 $[x_j - S\\Delta t, x_j + S\\Delta t]$。对于一个在宽度为 $\\Delta x$ 的均匀网格上使用相邻单元模板的格式，其数值依赖区域是 $[x_j - \\Delta x, x_j + \\Delta x]$。CFL 条件要求这个数值区域包含物理区域：\n$$\n[x_j - S\\Delta t, x_j + S\\Delta t] \\subseteq [x_j - \\Delta x, x_j + \\Delta x]\n$$\n这种包含关系意味着 $S\\Delta t \\le \\Delta x$。这就解释了为什么时间步长必须受最大特征速度的限制。我们可以将其写作：\n$$\n\\frac{(|u|+c)\\Delta t}{\\Delta x} \\le 1\n$$\n在实践中，会引入一个安全系数，称为 CFL 数（$\\mathrm{CFL} \\le 1$）。这导出了稳定性判据：\n$$\n\\Delta t \\le \\mathrm{CFL} \\frac{\\Delta x}{|u| + c}\n$$\n这表明每个单元中的允许时间步长由单元宽度 $\\Delta x$ 决定，并与当地流速大小 $|u|$ 和当地声速 $c$ 之和成反比。理论论证至此完成。\n\n第二部分：全局时间步长的数值计算\n\n为确保整个计算域的稳定性，必须选择时间步长 $\\Delta t$ 以使每个单元都满足 CFL 条件。对于非均匀网格，这意味着全局时间步长受需要最小时间步长的单元的限制：\n$$\n\\Delta t_{\\max} = \\min_{i} \\left( \\mathrm{CFL} \\frac{\\Delta x_i}{|u_i| + c_i} \\right)\n$$\n其中索引 $i$ 遍历网格中的所有单元。给定 $\\mathrm{CFL} = 0.60$ 和 $\\gamma=1.4$。我们接下来计算四个单元中每个单元的局部时间步长限制 $\\Delta t_i$。\n\n首先，我们为每个单元 $i \\in \\{1, 2, 3, 4\\}$ 计算当地声速 $c_i = \\sqrt{\\gamma p_i / \\rho_i}$。所有值均采用国际单位制（SI units）。\n\n单元 1: $(\\rho_1, u_1, p_1) = (1.0, 50, 1.0 \\times 10^5)$, $\\Delta x_1 = 0.010$.\n$$\nc_1 = \\sqrt{\\frac{1.4 \\times 1.0 \\times 10^{5}}{1.0}} = \\sqrt{140000} \\approx 374.1657 \\, \\mathrm{m/s}\n$$\n$$\n\\Delta t_1 = 0.60 \\times \\frac{0.010}{|50| + 374.1657} = \\frac{0.006}{424.1657} \\approx 1.41455 \\times 10^{-5} \\, \\mathrm{s}\n$$\n\n单元 2: $(\\rho_2, u_2, p_2) = (0.8, -30, 0.9 \\times 10^5)$, $\\Delta x_2 = 0.008$.\n$$\nc_2 = \\sqrt{\\frac{1.4 \\times 0.9 \\times 10^{5}}{0.8}} = \\sqrt{157500} \\approx 396.8627 \\, \\mathrm{m/s}\n$$\n$$\n\\Delta t_2 = 0.60 \\times \\frac{0.008}{|-30| + 396.8627} = \\frac{0.0048}{426.8627} \\approx 1.12448 \\times 10^{-5} \\, \\mathrm{s}\n$$\n\n单元 3: $(\\rho_3, u_3, p_3) = (1.2, 80, 1.1 \\times 10^5)$, $\\Delta x_3 = 0.012$.\n$$\nc_3 = \\sqrt{\\frac{1.4 \\times 1.1 \\times 10^{5}}{1.2}} = \\sqrt{\\frac{1.54 \\times 10^5}{1.2}} \\approx 358.2364 \\, \\mathrm{m/s}\n$$\n$$\n\\Delta t_3 = 0.60 \\times \\frac{0.012}{|80| + 358.2364} = \\frac{0.0072}{438.2364} \\approx 1.64299 \\times 10^{-5} \\, \\mathrm{s}\n$$\n\n单元 4: $(\\rho_4, u_4, p_4) = (0.9, 10, 0.95 \\times 10^5)$, $\\Delta x_4 = 0.009$.\n$$\nc_4 = \\sqrt{\\frac{1.4 \\times 0.95 \\times 10^{5}}{0.9}} = \\sqrt{\\frac{1.33 \\times 10^5}{0.9}} \\approx 384.4176 \\, \\mathrm{m/s}\n$$\n$$\n\\Delta t_4 = 0.60 \\times \\frac{0.009}{|10| + 384.4176} = \\frac{0.0054}{394.4176} \\approx 1.36911 \\times 10^{-5} \\, \\mathrm{s}\n$$\n\n最大的全局允许显式时间步长是这些局部时间步长限制中的最小值：\n$$\n\\Delta t_{\\max} = \\min(\\Delta t_1, \\Delta t_2, \\Delta t_3, \\Delta t_4)\n$$\n$$\n\\Delta t_{\\max} = \\min(1.41455, 1.12448, 1.64299, 1.36911) \\times 10^{-5} \\, \\mathrm{s}\n$$\n$$\n\\Delta t_{\\max} = 1.12448 \\times 10^{-5} \\, \\mathrm{s}\n$$\n按要求将此值四舍五入至四位有效数字，得到 $1.124 \\times 10^{-5}$ 秒。限制性单元是单元 2，它具有小单元宽度、大流速和高声速的组合。", "answer": "$$\\boxed{1.124 \\times 10^{-5}}$$", "id": "3373678"}, {"introduction": "一个高质量的数值格式不仅应能准确地求解控制方程，还应能保持其底层的物理对称性。本练习聚焦于伽利略不变性——物理定律不应依赖于观测者匀速运动参考系。您将构建一个二维欧拉方程求解器，其数值耗散项经过特殊设计以保持伽利略不变性，并通过模拟一个在不同整体速度下平移的等熵涡旋来进行数值验证 [@problem_id:3373731]。这项实践将展示如何通过量化数值耗散来检验一个方案是否忠实于基本的物理原理。", "problem": "构建一个完整、可运行的程序，通过在不同的均匀整体速度下输运一个光滑的等熵涡，并量化离散耗散在这些整体速度下的不变性，从而数值上验证可压缩欧拉方程的伽利略不变性。在具有周期性边界的二维空间中，使用一种有限体积、中心加标量耗散的通量格式，该格式通过相对于局部平均界面参考系测量耗散来显式地满足伽利略不变性。\n\n控制方程为理想气体的二维可压缩欧拉方程，\n$$\n\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}(\\mathbf{U})}{\\partial x} + \\frac{\\partial \\mathbf{G}(\\mathbf{U})}{\\partial y} = \\mathbf{0},\n$$\n其中守恒变量为 $\\mathbf{U} = [\\rho,\\ \\rho u,\\ \\rho v,\\ E]^{\\top}$，压力为 $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho(u^2+v^2)\\right)$，通量为\n$$\n\\mathbf{F}(\\mathbf{U}) = \n\\begin{bmatrix}\n\\rho u\\\\\n\\rho u^2 + p\\\\\n\\rho u v\\\\\nu(E + p)\n\\end{bmatrix},\\qquad\n\\mathbf{G}(\\mathbf{U}) = \n\\begin{bmatrix}\n\\rho v\\\\\n\\rho u v\\\\\n\\rho v^2 + p\\\\\nv(E + p)\n\\end{bmatrix}.\n$$\n\n在均匀笛卡尔网格上实现一种半离散有限体积法，该方法具有周期性边界，并且在每个单元面上的数值通量形式如下\n$$\n\\widehat{\\mathbf{F}}_{i+\\frac{1}{2},j} = \\frac{1}{2}\\left(\\mathbf{F}(\\mathbf{U}_{L}) + \\mathbf{F}(\\mathbf{U}_{R})\\right) - \\frac{1}{2}\\, s^{(x)}_{\\max}\\,(\\mathbf{U}_{R} - \\mathbf{U}_{L}),\n$$\n$$\n\\widehat{\\mathbf{G}}_{i,j+\\frac{1}{2}} = \\frac{1}{2}\\left(\\mathbf{G}(\\mathbf{U}_{B}) + \\mathbf{G}(\\mathbf{U}_{T})\\right) - \\frac{1}{2}\\, s^{(y)}_{\\max}\\,(\\mathbf{U}_{T} - \\mathbf{U}_{B}),\n$$\n其中 $\\mathbf{U}_{L}$ 和 $\\mathbf{U}_{R}$ 是 $x$ 方向单元面左右两侧的单元状态，$\\mathbf{U}_{B}$ 和 $\\mathbf{U}_{T}$ 是 $y$ 方向单元面上下两侧的单元状态。标量耗散项使用相对于界面的特征速度来强制实现伽利略不变性：\n$$\ns^{(x)}_{\\max} = \\max\\left(\\left|u_{L} - u_{\\mathrm{ref}}\\right| + a_{L},\\ \\left|u_{R} - u_{\\mathrm{ref}}\\right| + a_{R}\\right),\\quad u_{\\mathrm{ref}} = \\frac{u_{L} + u_{R}}{2},\n$$\n$$\ns^{(y)}_{\\max} = \\max\\left(\\left|v_{B} - v_{\\mathrm{ref}}\\right| + a_{B},\\ \\left|v_{T} - v_{\\mathrm{ref}}\\right| + a_{T}\\right),\\quad v_{\\mathrm{ref}} = \\frac{v_{B} + v_{T}}{2},\n$$\n其中 $a = \\sqrt{\\gamma p/\\rho}$ 是当地声速。在单元面上使用分段常数重构（一阶），以分离伽利略不变耗散的影响。使用三阶强稳定性保持 Runge–Kutta 格式进行时间推进。\n\n用由均匀整体流 $(U_0, 0)$ 输运的精确等熵涡解进行初始化，这是欧拉方程的一个标准光滑解。在无量纲变量中，设理想气体常数为1，环境状态为 $\\rho_{\\infty} = 1$，$p_{\\infty} = 1$，$T_{\\infty} = 1$，并选择涡强度 $\\beta  0$。设区域为 $[0,L] \\times [0,L]$ 上的周期性区域，涡心为 $(x_0,y_0)$。定义 $r^2 = (x-x_0)^2 + (y-y_0)^2$ 以及\n$$\nu(x,y) = U_0 - \\frac{\\beta}{2\\pi}\\exp\\!\\left(\\frac{1 - r^2}{2}\\right)(y - y_0),\\qquad\nv(x,y) = \\frac{\\beta}{2\\pi}\\exp\\!\\left(\\frac{1 - r^2}{2}\\right)(x - x_0),\n$$\n$$\nT(x,y) = 1 - \\frac{(\\gamma - 1)\\beta^2}{8\\gamma\\pi^2}\\exp\\!\\left(1 - r^2\\right),\\qquad\n\\rho(x,y) = T(x,y)^{\\frac{1}{\\gamma - 1}},\\qquad\np(x,y) = \\rho(x,y)^{\\gamma},\n$$\n$$\nE(x,y) = \\frac{p(x,y)}{\\gamma - 1} + \\frac{1}{2}\\rho(x,y)\\left(u(x,y)^2 + v(x,y)^2\\right).\n$$\n该精确解在 $x$ 方向以速度 $U_0$ 无畸变地平移。\n\n选择参数 $\\gamma = 1.4$，$L = 10$，$(x_0,y_0) = (5,5)$，$\\beta = 5$，最终时间 $T_{\\mathrm{final}} = 2$，以及一个 $N_x = 64$，$N_y = 64$ 单元的均匀网格。使用 Courant–Friedrichs–Lewy (CFL) 数 $\\mathrm{CFL} = 0.3$ 来选择时间步长\n$$\n\\Delta t = \\mathrm{CFL}\\cdot \\min\\!\\left(\\frac{\\Delta x}{\\max |u| + a},\\ \\frac{\\Delta y}{\\max |v| + a}\\right),\n$$\n该步长根据测试套件速度中最坏情况的初始条件保守地计算，以使所有运行中的 $\\Delta t$ 保持一致；然后选择一个整数步数，使总时间恰好等于 $T_{\\mathrm{final}}$。\n\n定义在时间 $t$ 的扰动动能（不包括均匀整体流）为\n$$\nK'(t;U_0) = \\iint \\frac{1}{2}\\,\\rho(x,y,t)\\left(\\left(u(x,y,t) - U_0\\right)^2 + v(x,y,t)^2\\right)\\,dx\\,dy.\n$$\n令耗散分数为\n$$\n\\alpha(U_0) = \\frac{K'(0;U_0) - K'(T_{\\mathrm{final}};U_0)}{K'(0;U_0)}.\n$$\n离散化的伽利略不变性意味着，对于不同的 $U_0$ 值，$\\alpha(U_0)$ 应该相同，误差仅来自数值时间积分和舍入效应。\n\n实现该程序以完成以下任务：\n- 按规定组装带有伽利略不变标量耗散的有限体积更新。\n- 为每个整体速度初始化等熵涡，并使用相同的 $\\Delta t$ 将所有算例演化到 $T_{\\mathrm{final}}$。\n- 对每个算例，使用等效于单元积分的梯形法则计算 $\\alpha(U_0)$，即单元总和乘以 $\\Delta x\\,\\Delta y$。\n\n测试套件：\n- 整体速度 $U_0 \\in \\{\\,0.0,\\ 0.5,\\ -0.5,\\ 1.5\\,\\}$。\n\n要求的最终输出：\n- 您的程序应生成单行输出，其中包含一个以逗号分隔的 Python 风格的浮点数列表，用方括号括起来，浮点数采用科学记数法，小数点后有 $6$ 位数字。\n- 对于给定顺序中的每个测试用例，输出绝对差\n$$\nd(U_0) = \\big|\\alpha(U_0) - \\alpha(0.0)\\big|.\n$$\n- 因此，输出必须是 $[d(0.0),d(0.5),d(-0.5),d(1.5)]$ 的形式，每个条目都用字符串格式说明符 $\\mathtt{\\texttt{\\%.6e}}$ 进行格式化。\n\n单位和角度：\n- 所有量均为无量纲。不使用角度单位。\n\n您的实现必须是自包含的，不需要任何输入，并遵守指定的输出格式。答案值为浮点数。", "solution": "用户提供了一个科学上合理且定义明确的计算流体动力学问题。任务是数值上验证一个用于二维可压缩欧拉方程的特定有限体积格式的伽利略不变性。这将通过模拟一个等熵涡在不同整体速度下的对流并比较数值耗散来完成。\n\n### 1. 控制方程与离散化\n\n问题由守恒形式的二维可压缩欧拉方程控制：\n$$\n\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}(\\mathbf{U})}{\\partial x} + \\frac{\\partial \\mathbf{G}(\\mathbf{U})}{\\partial y} = \\mathbf{0}\n$$\n其中 $\\mathbf{U} = [\\rho, \\rho u, \\rho v, E]^{\\top}$ 是守恒变量（密度、动量分量和总能量密度）的向量。压力 $p$ 由理想气体状态方程给出，$p = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho(u^2+v^2)\\right)$。通量向量 $\\mathbf{F}(\\mathbf{U})$ 和 $\\mathbf{G}(\\mathbf{U})$ 是问题陈述中指定的状态变量的函数。\n\n在尺寸为 $N_x \\times N_y$、单元尺寸为 $\\Delta x \\times \\Delta y$ 的均匀笛卡尔网格上采用半离散有限体积法。空间导数通过单元界面上数值通量的散度来近似，从而得到一个关于单元平均状态 $\\mathbf{U}_{i,j}$ 的常微分方程组：\n$$\n\\frac{d\\mathbf{U}_{i,j}}{dt} = -\\frac{1}{\\Delta x}\\left(\\widehat{\\mathbf{F}}_{i+\\frac{1}{2},j} - \\widehat{\\mathbf{F}}_{i-\\frac{1}{2},j}\\right) - \\frac{1}{\\Delta y}\\left(\\widehat{\\mathbf{G}}_{i,j+\\frac{1}{2}} - \\widehat{\\mathbf{G}}_{i,j-\\frac{1}{2}}\\right)\n$$\n使用分段常数重构（一阶方法），意味着每个单元内的状态被假定为均匀的，因此界面左右两侧的状态就是相邻单元的状态，即 $\\mathbf{U}_L = \\mathbf{U}_{i,j}$ 和 $\\mathbf{U}_R = \\mathbf{U}_{i+1,j}$。\n\n### 2. 伽利略不变数值通量\n\n物理系统的动力学与观察者惯性参考系的恒定速度无关。这就是伽利略不变性原理。用于此类系统的数值格式在理想情况下应保持此属性；否则，仅仅改变整体速度就可能改变数值解的定性特征，例如人工耗散的量。\n\n指定的数值通量是一种中心通量，附加了一个标量耗散项，是一种人工粘性或 Lax-Friedrichs 型通量。对于 $x$ 方向，它是：\n$$\n\\widehat{\\mathbf{F}}_{i+\\frac{1}{2},j} = \\frac{1}{2}\\left(\\mathbf{F}(\\mathbf{U}_{L}) + \\mathbf{F}(\\mathbf{U}_{R})\\right) - \\frac{1}{2} s^{(x)}_{\\max} (\\mathbf{U}_{R} - \\mathbf{U}_{L})\n$$\n实现伽利略不变性的关键在于耗散系数 $s^{(x)}_{\\max}$ 的定义。标准的 Lax-Friedrichs 格式可能使用 $s^{(x)}_{\\max} = \\max(|u_L|+a_L, |u_R|+a_R)$，这不满足伽利略不变性，因为绝对速度 $u_L$ 和 $u_R$ 会随参考系而改变。\n\n问题指定了一种不变的形式：\n$$\ns^{(x)}_{\\max} = \\max\\left(\\left|u_{L} - u_{\\mathrm{ref}}\\right| + a_{L},\\ \\left|u_{R} - u_{\\mathrm{ref}}\\right| + a_{R}\\right), \\quad \\text{其中 } u_{\\mathrm{ref}} = \\frac{u_{L} + u_{R}}{2}\n$$\n当地声速 $a = \\sqrt{\\gamma p/\\rho}$ 是一个热力学性质，本身就是伽利略不变的。速度项 $|u_L - u_{\\mathrm{ref}}|$ 和 $|u_R - u_{\\mathrm{ref}}|$ 也是不变的。要理解这一点，考虑一个以恒定速度 $U_0$ 运动的加速参考系。新参考系中的速度是 $u' = u - U_0$。参考速度变为 $u'_{\\mathrm{ref}} = (u'_L + u'_R)/2 = ((u_L-U_0) + (u_R-U_0))/2 = u_{\\mathrm{ref}} - U_0$。因此，差值保持不变：$u'_L - u'_{\\mathrm{ref}} = (u_L - U_0) - (u_{\\mathrm{ref}} - U_0) = u_L - u_{\\mathrm{ref}}$。\n一个简单的代数变换表明 $|u_L - u_{\\mathrm{ref}}| = |u_R - u_{\\mathrm{ref}}| = \\frac{1}{2}|u_R - u_L|$。因此，耗散系数的表达式简化为：\n$$\ns^{(x)}_{\\max} = \\frac{1}{2}|u_R - u_L| + \\max(a_L, a_R)\n$$\n这种形式明确地仅依赖于跨界面的速度差和热力学量，所有这些都是伽利略不变的。对称的论证也适用于 $y$ 方向的通量。\n\n### 3. 初始条件与时间演化\n\n初始条件是一个等熵涡，它是欧拉方程的一个精确、光滑的解，以恒定速度平移而不改变其形状或强度。这使其成为一个理想的测试案例，因为数值模拟中涡的任何衰减都是由格式的耗散引起的。通过叠加不同的整体速度 $(U_0, 0)$ 并将模拟运行固定的时间 $T_{\\mathrm{final}}$，我们可以测量耗散如何随参考系变化。\n\n时间积分使用三阶强稳定性保持 Runge-Kutta (SSP-RK3) 格式执行。为确保测试用例之间的公平比较，所有模拟都使用一个固定的时间步长 $\\Delta t$。这个 $\\Delta t$ 是基于一个全局 CFL 条件计算的，考虑了整个区域和所有初始速度配置 ($U_0 \\in \\{0.0, 0.5, -0.5, 1.5\\}$) 中的最大特征波速 $(\\max(|u|+a), \\max(|v|+a))$。选择时间步数，使总模拟时间恰好等于 $T_{\\mathrm{final}}$。\n\n### 4. 验证与实现策略\n\n为了量化数值耗散，我们测量扰动动能 $K'(t; U_0)$ 的衰减，该动能不包括整体流的动能。模拟时间内的耗散分数为\n$$\n\\alpha(U_0) = \\frac{K'(0;U_0) - K'(T_{\\mathrm{final}};U_0)}{K'(0;U_0)}\n$$\n如果格式是完美的伽利略不变，那么对于所有的 $U_0$，$\\alpha(U_0)$ 都应该是相同的。我们通过计算 $d(U_0) = |\\alpha(U_0) - \\alpha(0.0)|$ 来测量与此理想情况的偏差。较小的 $d(U_0)$ 值将证实所实现方法的近似不变性。\n\n实现将按以下结构进行：\n1.  定义所有物理和数值参数。设置计算网格。\n2.  计算全局保守的时间步长 $\\Delta t$ 和所需的步数。\n3.  遍历测试套件中的每个整体速度 $U_0$。\n4.  对于每个 $U_0$：\n    a. 生成初始状态数组 $\\mathbf{U}(t=0)$。\n    b. 计算并存储初始扰动动能 $K'(0; U_0)$。\n    c. 使用 SSP-RK3 积分器将系统演化到 $T_{\\mathrm{final}}$。积分器的核心是计算右端项（空间残差）的函数，这涉及伽利略不变数值通量的向量化计算。周期性边界条件通过 `numpy.roll` 高效处理。\n    d. 计算最终扰动动能 $K'(T_{\\mathrm{final}}; U_0)$。\n    e. 计算耗散分数 $\\alpha(U_0)$。\n5.  循环结束后，为每个案例计算最终度量 $d(U_0)$，并按指定格式打印结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Main function to set up and run the Galilean invariance test for the Euler equations.\n    \"\"\"\n    # --- Problem Parameters ---\n    GAMMA = 1.4\n    L = 10.0\n    X0, Y0 = 5.0, 5.0\n    BETA = 5.0\n    T_FINAL = 2.0\n    NX, NY = 64, 64\n    CFL = 0.3\n    U0_CASES = [0.0, 0.5, -0.5, 1.5]\n\n    # --- Derived Parameters and Grid Setup ---\n    DX = L / NX\n    DY = L / NY\n    X = np.linspace(0 + DX/2, L - DX/2, NX)\n    Y = np.linspace(0 + DY/2, L - DY/2, NY)\n    GRID_X, GRID_Y = np.meshgrid(X, Y)\n\n    # --- Helper Functions ---\n    def get_primitives(U):\n        \"\"\"\n        Decode primitive variables [rho, u, v, p, a] from the conservative state vector U.\n        \"\"\"\n        rho = U[..., 0]\n        u = U[..., 1] / rho\n        v = U[..., 2] / rho\n        E = U[..., 3]\n        p = (GAMMA - 1.0) * (E - 0.5 * rho * (u**2 + v**2))\n        a = np.sqrt(GAMMA * p / rho)\n        return rho, u, v, p, a\n\n    def get_fluxes(U, primitives):\n        \"\"\"\n        Calculate the Euler fluxes F(U) and G(U).\n        \"\"\"\n        rho, u, v, p, _ = primitives\n        E = U[..., 3]\n        \n        F = np.zeros_like(U)\n        F[..., 0] = rho * u\n        F[..., 1] = rho * u**2 + p\n        F[..., 2] = rho * u * v\n        F[..., 3] = u * (E + p)\n        \n        G = np.zeros_like(U)\n        G[..., 0] = rho * v\n        G[..., 1] = rho * u * v\n        G[..., 2] = rho * v**2 + p\n        G[..., 3] = v * (E + p)\n        \n        return F, G\n\n    def get_initial_state(U0):\n        \"\"\"\n        Initialize the isentropic vortex with a given bulk velocity U0.\n        \"\"\"\n        r_sq = (GRID_X - X0)**2 + (GRID_Y - Y0)**2\n        \n        exp_factor = np.exp((1.0 - r_sq) / 2.0)\n        u_prime = - (BETA / (2.0 * math.pi)) * exp_factor * (GRID_Y - Y0)\n        v_prime = (BETA / (2.0 * math.pi)) * exp_factor * (GRID_X - X0)\n        \n        u = U0 + u_prime\n        v = v_prime\n        \n        T = 1.0 - ((GAMMA - 1.0) * BETA**2) / (8.0 * GAMMA * math.pi**2) * np.exp(1.0 - r_sq)\n        rho = T**(1.0 / (GAMMA - 1.0))\n        p = rho**GAMMA\n        \n        E = p / (GAMMA - 1.0) + 0.5 * rho * (u**2 + v**2)\n        \n        U_init = np.zeros((NY, NX, 4), dtype=np.float64)\n        U_init[..., 0] = rho\n        U_init[..., 1] = rho * u\n        U_init[..., 2] = rho * v\n        U_init[..., 3] = E\n        \n        return U_init\n\n    def get_rhs(U):\n        \"\"\"\n        Calculates the right-hand side of the semi-discrete finite-volume formulation.\n        This corresponds to the negative divergence of the numerical flux.\n        \"\"\"\n        primitives = get_primitives(U)\n        F_flux, G_flux = get_fluxes(U, primitives)\n\n        # --- X-direction fluxes ---\n        U_R = np.roll(U, -1, axis=1)\n        _, u_L, _, _, a_L = primitives\n        _, u_R, _, _, a_R = get_primitives(U_R)\n        F_L = F_flux\n        F_R = np.roll(F_flux, -1, axis=1)\n        \n        s_max_x = 0.5 * np.abs(u_R - u_L) + np.maximum(a_L, a_R)\n        s_max_x = s_max_x[..., np.newaxis]\n        F_hat = 0.5 * (F_L + F_R) - 0.5 * s_max_x * (U_R - U)\n        \n        # --- Y-direction fluxes ---\n        U_T = np.roll(U, -1, axis=0)\n        _, _, v_B, _, a_B = primitives\n        _, _, v_T, _, a_T = get_primitives(U_T)\n        G_B = G_flux\n        G_T = np.roll(G_flux, -1, axis=0)\n        \n        s_max_y = 0.5 * np.abs(v_T - v_B) + np.maximum(a_B, a_T)\n        s_max_y = s_max_y[..., np.newaxis]\n        G_hat = 0.5 * (G_B + G_T) - 0.5 * s_max_y * (U_T - U)\n\n        # --- Divergence of fluxes ---\n        F_hat_imh = np.roll(F_hat, 1, axis=1)\n        G_hat_jmh = np.roll(G_hat, 1, axis=0)\n        \n        rhs = - (F_hat - F_hat_imh) / DX - (G_hat - G_hat_jmh) / DY\n        return rhs\n\n    def compute_perturbation_kinetic_energy(U, U0):\n        \"\"\"\n        Calculates the total perturbation kinetic energy over the domain.\n        \"\"\"\n        rho, u, v, _, _ = get_primitives(U)\n        integrand = 0.5 * rho * ((u - U0)**2 + v**2)\n        return np.sum(integrand) * DX * DY\n\n    # 1. Determine the global time step from the worst-case scenario\n    max_wave_speed = 0.0\n    for u0 in U0_CASES:\n        U_init = get_initial_state(u0)\n        _, u, v, _, a = get_primitives(U_init)\n        max_wave_speed = max(max_wave_speed, np.max(np.abs(u) + a), np.max(np.abs(v) + a))\n\n    dt_cfl = CFL * min(DX, DY) / max_wave_speed\n    num_steps = int(np.ceil(T_FINAL / dt_cfl))\n    dt = T_FINAL / num_steps\n    \n    alpha_results = {}\n\n    # 2. Run simulation for each case\n    for u0 in U0_CASES:\n        U = get_initial_state(u0)\n        K_initial = compute_perturbation_kinetic_energy(U, u0)\n        \n        # SSP-RK3 Time Integration\n        for _ in range(num_steps):\n            rhs1 = get_rhs(U)\n            U1 = U + dt * rhs1\n            \n            rhs2 = get_rhs(U1)\n            U2 = 0.75 * U + 0.25 * (U1 + dt * rhs2)\n            \n            rhs3 = get_rhs(U2)\n            U = (1.0/3.0) * U + (2.0/3.0) * (U2 + dt * rhs3)\n            \n        K_final = compute_perturbation_kinetic_energy(U, u0)\n        \n        alpha = (K_initial - K_final) / K_initial\n        alpha_results[u0] = alpha\n        \n    # 3. Compute the final metric and format output\n    alpha_0 = alpha_results[0.0]\n    d_values = [abs(alpha_results[u0] - alpha_0) for u0 in U0_CASES]\n    \n    formatted_results = [f\"{val:.6e}\" for val in d_values]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3373731"}]}