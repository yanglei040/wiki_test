{"hands_on_practices": [{"introduction": "预处理可以从左侧或右侧应用于系统矩阵，这个选择虽然看似微小，却直接影响着迭代方法（如GMRES）的内在机制。左预处理和右预处理构建的克里洛夫子空间不同，优化的目标函数也随之改变。通过这个练习[@problem_id:3352731]，你将亲手计算一个完整的GMRES迭代步骤，具体比较两种预处理方式，从而深刻理解它们在算法层面上的区别以及对最终残差的影响。", "problem": "考虑一个简化的计算流体动力学离散化中产生的线性系统，\n$$\nA x = b,\n$$\n其中 $A \\in \\mathbb{R}^{3 \\times 3}$ 是非对称矩阵，$M \\in \\mathbb{R}^{3 \\times 3}$ 是一个可逆的预条件子。设\n$$\nA = \\begin{pmatrix}\n4  1  0 \\\\\n2  3  1 \\\\\n0  -1  2\n\\end{pmatrix}, \n\\quad\nM = \\begin{pmatrix}\n1  0  0 \\\\\n0  2  0 \\\\\n0  0  3\n\\end{pmatrix},\n\\quad\nb = \\begin{pmatrix}\n1 \\\\\n2 \\\\\n3\n\\end{pmatrix},\n\\quad\nx_0 = \\begin{pmatrix}\n0 \\\\\n0 \\\\\n0\n\\end{pmatrix}.\n$$\n广义最小残差（GMRES）方法通过在仿射克里洛夫子空间上最小化相应的残差范数来计算 $x_k$。该子空间由算子和初始残差构建，具体取决于使用的是左预处理还是右预处理。对于左预处理，求解 $M^{-1} A x = M^{-1} b$ 并最小化预处理后残差的范数；对于右预处理，求解 $A M^{-1} y = b$（其中 $x = x_0 + M^{-1} y$）并最小化真实残差的范数。从 $x_0$ 开始，对两种预处理策略各使用仅 $k=1$ 个基向量（即，精确执行一次 GMRES 迭代）：\n- 从基本原理推导左预处理系统和右预处理系统的单步 GMRES 更新，\n- 显式计算原始（未预处理）系统中的迭代后残差 $r_{1,\\mathrm{L}} = b - A x_{1,\\mathrm{L}}$ 和 $r_{1,\\mathrm{R}} = b - A x_{1,\\mathrm{R}}$，\n- 计算欧几里得范数 $\\|r_{1,\\mathrm{L}}\\|_2$ 和 $\\|r_{1,\\mathrm{R}}\\|_2$。\n\n作为最终答案，给出比值 $\\|r_{1,\\mathrm{L}}\\|_2 \\big/ \\|r_{1,\\mathrm{R}}\\|_2$ 的精确值。不要四舍五入；以精确解析形式表示结果。", "solution": "用户提供了一个问题，要求对一个线性系统应用一次广义最小残差（GMRES）方法的迭代，并同时使用左预处理和右预处理策略。目标是计算所得真实残差的欧几里得范数之比。\n\n### 第 1 步：提取已知条件\n给定的矩阵和向量如下：\n- $A = \\begin{pmatrix} 4  1  0 \\\\ 2  3  1 \\\\ 0  -1  2 \\end{pmatrix}$\n- $M = \\begin{pmatrix} 1  0  0 \\\\ 0  2  0 \\\\ 0  0  3 \\end{pmatrix}$\n- $b = \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix}$\n- $x_0 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$\n问题指定执行一次 GMRES 迭代（$k=1$）。\n\n### 第 2 步：使用提取的已知条件进行验证\n1.  **科学依据：** 该问题植根于数值线性代数，特别是使用带预处理的 GMRES 方法迭代求解线性系统。这些是计算科学与工程中的标准且完善的课题。没有违反科学或数学原理的地方。\n2.  **适定性：** 矩阵 $A$ 是非奇异的（$\\det(A) = 4(6 - (-1)) - 1(4 - 0) = 4(7) - 4 = 24 \\neq 0$）。预条件子 $M$ 是一个对角元素非零的对角矩阵，因此是可逆的。初始状态和所需计算都已明确定义。所有步骤都存在唯一解。\n3.  **客观性：** 问题使用精确的数学语言和符号陈述。没有主观或含糊的术语。\n4.  **自洽性和一致性：** 所有必要的数据（$A, M, b, x_0$）均已提供。问题内部是一致的。\n\n### 第 3 步：结论与行动\n问题是有效的。将提供完整的解答。\n\n### 求解推导\n\n首先，我们计算预条件子 $M$ 的逆，因为它在两种情况下都会被用到。\n$$M = \\begin{pmatrix} 1  0  0 \\\\ 0  2  0 \\\\ 0  0  3 \\end{pmatrix} \\implies M^{-1} = \\begin{pmatrix} 1  0  0 \\\\ 0  \\frac{1}{2}  0 \\\\ 0  0  \\frac{1}{3} \\end{pmatrix}$$\n\n#### 左预处理\n\n对于左预处理，我们求解系统 $M^{-1} A x = M^{-1} b$。令 $\\tilde{A} = M^{-1}A$ 和 $\\tilde{b} = M^{-1}b$。GMRES 方法应用于 $\\tilde{A}x = \\tilde{b}$。\n\n初始猜测为 $x_0 = (0, 0, 0)^T$。初始预处理残差为：\n$$\\tilde{r}_0 = \\tilde{b} - \\tilde{A}x_0 = \\tilde{b} = M^{-1}b = \\begin{pmatrix} 1  0  0 \\\\ 0  \\frac{1}{2}  0 \\\\ 0  0  \\frac{1}{3} \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix}$$\n一次 GMRES 迭代寻找一个解 $x_{1,\\mathrm{L}} \\in x_0 + \\mathcal{K}_1(\\tilde{A}, \\tilde{r}_0)$，其中 $\\mathcal{K}_1(\\tilde{A}, \\tilde{r}_0) = \\mathrm{span}\\{\\tilde{r}_0\\}$。\n因此，$x_{1,\\mathrm{L}} = x_0 + \\alpha_{\\mathrm{L}} \\tilde{r}_0 = \\alpha_{\\mathrm{L}} \\tilde{r}_0$。\n选择标量 $\\alpha_{\\mathrm{L}}$ 以最小化新的预处理残差的范数，即 $\\|\\tilde{r}_{1,\\mathrm{L}}\\|_2 = \\|\\tilde{b} - \\tilde{A}x_{1,\\mathrm{L}}\\|_2$。\n$$\\min_{\\alpha_{\\mathrm{L}}} \\|\\tilde{r}_0 - \\alpha_{\\mathrm{L}} \\tilde{A}\\tilde{r}_0\\|_2$$\n这是一个线性最小二乘问题，解 $\\alpha_{\\mathrm{L}}$ 由正规方程给出：\n$$\\alpha_{\\mathrm{L}} = \\frac{\\langle \\tilde{A}\\tilde{r}_0, \\tilde{r}_0 \\rangle}{\\|\\tilde{A}\\tilde{r}_0\\|_2^2}$$\n我们计算各项：\n$$\\tilde{A} = M^{-1}A = \\begin{pmatrix} 1  0  0 \\\\ 0  \\frac{1}{2}  0 \\\\ 0  0  \\frac{1}{3} \\end{pmatrix} \\begin{pmatrix} 4  1  0 \\\\ 2  3  1 \\\\ 0  -1  2 \\end{pmatrix} = \\begin{pmatrix} 4  1  0 \\\\ 1  \\frac{3}{2}  \\frac{1}{2} \\\\ 0  -\\frac{1}{3}  \\frac{2}{3} \\end{pmatrix}$$\n$$\\tilde{A}\\tilde{r}_0 = \\begin{pmatrix} 4  1  0 \\\\ 1  \\frac{3}{2}  \\frac{1}{2} \\\\ 0  -\\frac{1}{3}  \\frac{2}{3} \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 1+\\frac{3}{2}+\\frac{1}{2} \\\\ -\\frac{1}{3}+\\frac{2}{3} \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 3 \\\\ \\frac{1}{3} \\end{pmatrix}$$\n现在我们求 $\\alpha_{\\mathrm{L}}$：\n$$\\langle \\tilde{A}\\tilde{r}_0, \\tilde{r}_0 \\rangle = \\begin{pmatrix} 5 \\\\ 3 \\\\ \\frac{1}{3} \\end{pmatrix} \\cdot \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix} = 5 + 3 + \\frac{1}{3} = \\frac{25}{3}$$\n$$\\|\\tilde{A}\\tilde{r}_0\\|_2^2 = 5^2 + 3^2 + \\left(\\frac{1}{3}\\right)^2 = 25 + 9 + \\frac{1}{9} = 34 + \\frac{1}{9} = \\frac{307}{9}$$\n$$\\alpha_{\\mathrm{L}} = \\frac{25/3}{307/9} = \\frac{25}{3} \\cdot \\frac{9}{307} = \\frac{75}{307}$$\n更新后的解是：\n$$x_{1,\\mathrm{L}} = \\frac{75}{307} \\tilde{r}_0 = \\frac{75}{307} \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix}$$\n真实（未预处理）残差为 $r_{1,\\mathrm{L}} = b - A x_{1,\\mathrm{L}}$：\n$$A \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 4  1  0 \\\\ 2  3  1 \\\\ 0  -1  2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 6 \\\\ 1 \\end{pmatrix}$$\n$$r_{1,\\mathrm{L}} = \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix} - \\frac{75}{307} \\begin{pmatrix} 5 \\\\ 6 \\\\ 1 \\end{pmatrix} = \\frac{1}{307} \\left( \\begin{pmatrix} 307 \\\\ 614 \\\\ 921 \\end{pmatrix} - \\begin{pmatrix} 375 \\\\ 450 \\\\ 75 \\end{pmatrix} \\right) = \\frac{1}{307} \\begin{pmatrix} -68 \\\\ 164 \\\\ 846 \\end{pmatrix}$$\n该残差的范数平方为：\n$$\\|r_{1,\\mathrm{L}}\\|_2^2 = \\frac{1}{307^2} \\left( (-68)^2 + 164^2 + 846^2 \\right) = \\frac{4624 + 26896 + 715716}{307^2} = \\frac{747236}{307^2}$$\n\n#### 右预处理\n\n对于右预处理，我们求解系统 $A M^{-1} y = b$，然后求 $x = x_0 + M^{-1}y$。令 $\\hat{A} = AM^{-1}$。GMRES 方法应用于 $\\hat{A}y = b$。\n\n$y$ 的初始猜测为 $y_0 = 0$（因为 $x_0 = 0$）。初始残差为：\n$$\\hat{r}_0 = b - \\hat{A}y_0 = b = \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix}$$\n一次 GMRES 迭代寻找一个解 $y_1 \\in y_0 + \\mathcal{K}_1(\\hat{A}, \\hat{r}_0) = \\mathrm{span}\\{\\hat{r}_0\\}$。因此，$y_1 = y_0 + \\alpha_{\\mathrm{R}} \\hat{r}_0 = \\alpha_{\\mathrm{R}} b$。\n选择标量 $\\alpha_{\\mathrm{R}}$ 以最小化新残差的范数，对于右预处理，这就是真实残差：$\\|\\hat{r}_{1,\\mathrm{R}}\\|_2 = \\|b - \\hat{A}y_1\\|_2$。\n$$\\min_{\\alpha_{\\mathrm{R}}} \\|b - \\alpha_{\\mathrm{R}} \\hat{A}b\\|_2$$\n解为：\n$$\\alpha_{\\mathrm{R}} = \\frac{\\langle \\hat{A}b, b \\rangle}{\\|\\hat{A}b\\|_2^2}$$\n我们计算各项：\n$$\\hat{A} = AM^{-1} = \\begin{pmatrix} 4  1  0 \\\\ 2  3  1 \\\\ 0  -1  2 \\end{pmatrix} \\begin{pmatrix} 1  0  0 \\\\ 0  \\frac{1}{2}  0 \\\\ 0  0  \\frac{1}{3} \\end{pmatrix} = \\begin{pmatrix} 4  \\frac{1}{2}  0 \\\\ 2  \\frac{3}{2}  \\frac{1}{3} \\\\ 0  -\\frac{1}{2}  \\frac{2}{3} \\end{pmatrix}$$\n$$\\hat{A}b = \\begin{pmatrix} 4  \\frac{1}{2}  0 \\\\ 2  \\frac{3}{2}  \\frac{1}{3} \\\\ 0  -\\frac{1}{2}  \\frac{2}{3} \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix} = \\begin{pmatrix} 4(1) + \\frac{1}{2}(2) \\\\ 2(1) + \\frac{3}{2}(2) + \\frac{1}{3}(3) \\\\ -\\frac{1}{2}(2) + \\frac{2}{3}(3) \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 6 \\\\ 1 \\end{pmatrix}$$\n现在我们求 $\\alpha_{\\mathrm{R}}$：\n$$\\langle \\hat{A}b, b \\rangle = \\begin{pmatrix} 5 \\\\ 6 \\\\ 1 \\end{pmatrix} \\cdot \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix} = 5 + 12 + 3 = 20$$\n$$\\|\\hat{A}b\\|_2^2 = 5^2 + 6^2 + 1^2 = 25 + 36 + 1 = 62$$\n$$\\alpha_{\\mathrm{R}} = \\frac{20}{62} = \\frac{10}{31}$$\n更新后的变量为 $y_1 = \\alpha_{\\mathrm{R}} b = \\frac{10}{31}b$。解 $x$ 为：\n$$x_{1,\\mathrm{R}} = x_0 + M^{-1}y_1 = M^{-1} \\left(\\frac{10}{31} b\\right) = \\frac{10}{31} M^{-1}b = \\frac{10}{31} \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix}$$\n真实残差为 $r_{1,\\mathrm{R}} = b - A x_{1,\\mathrm{R}}$：\n$$r_{1,\\mathrm{R}} = b - A \\left(\\frac{10}{31} \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix}\\right) = b - \\frac{10}{31} \\begin{pmatrix} 5 \\\\ 6 \\\\ 1 \\end{pmatrix} = \\frac{1}{31} \\left( \\begin{pmatrix} 31 \\\\ 62 \\\\ 93 \\end{pmatrix} - \\begin{pmatrix} 50 \\\\ 60 \\\\ 10 \\end{pmatrix} \\right) = \\frac{1}{31} \\begin{pmatrix} -19 \\\\ 2 \\\\ 83 \\end{pmatrix}$$\n该残差的范数平方为：\n$$\\|r_{1,\\mathrm{R}}\\|_2^2 = \\frac{1}{31^2} \\left( (-19)^2 + 2^2 + 83^2 \\right) = \\frac{361 + 4 + 6889}{31^2} = \\frac{7254}{31^2}$$\n由于 $7254 = 234 \\times 31$，我们有：\n$$\\|r_{1,\\mathrm{R}}\\|_2^2 = \\frac{234 \\times 31}{31^2} = \\frac{234}{31}$$\n\n#### 范数之比\n我们需要计算比值 $\\|r_{1,\\mathrm{L}}\\|_2 / \\|r_{1,\\mathrm{R}}\\|_2$。我们将先计算平方之比：\n$$\\frac{\\|r_{1,\\mathrm{L}}\\|_2^2}{\\|r_{1,\\mathrm{R}}\\|_2^2} = \\frac{747236 / 307^2}{234 / 31} = \\frac{747236 \\cdot 31}{234 \\cdot 307^2}$$\n可以注意到，两个残差都具有 $b - c(AM^{-1}b)$ 的形式，其中 $c$ 是不同的标量，从而简化计算。令 $v = AM^{-1}b = (5,6,1)^T$。\n$x_{1,\\mathrm{L}} = \\alpha_{\\mathrm{L}} \\tilde{r}_0 = \\frac{75}{307}M^{-1}b$，所以 $r_{1,\\mathrm{L}} = b - \\frac{75}{307}AM^{-1}b = b - \\frac{75}{307}v$。\n$x_{1,\\mathrm{R}} = \\frac{10}{31}M^{-1}b$，所以 $r_{1,\\mathrm{R}} = b - \\frac{10}{31}AM^{-1}b = b - \\frac{10}{31}v$。\n范数平方 $\\|b - \\alpha v\\|_2^2$ 是关于 $\\alpha$ 的二次函数：$\\|b\\|^2 - 2\\alpha \\langle b,v \\rangle + \\alpha^2 \\|v\\|^2$。\n最小值在 $\\alpha^* = \\langle b,v \\rangle / \\|v\\|^2 = 20/62 = 10/31$ 处取得。这恰好是右预处理情况下的系数。\n因此，$\\|b-\\alpha v\\|_2^2 = \\|b-\\alpha^* v\\|_2^2 + (\\alpha-\\alpha^*)^2\\|v\\|_2^2 = \\|r_{1,\\mathrm{R}}\\|_2^2 + (\\alpha-\\alpha^*)^2\\|v\\|_2^2$。\n对于左预处理的情况，$\\alpha = \\alpha_{\\mathrm{L}} = 75/307$，所以：\n$$\\|r_{1,\\mathrm{L}}\\|_2^2 = \\|r_{1,\\mathrm{R}}\\|_2^2 + (\\alpha_{\\mathrm{L}} - \\alpha_{\\mathrm{R}})^2 \\|v\\|_2^2$$\n平方之比为：\n$$\\frac{\\|r_{1,\\mathrm{L}}\\|_2^2}{\\|r_{1,\\mathrm{R}}\\|_2^2} = 1 + \\frac{(\\alpha_{\\mathrm{L}} - \\alpha_{\\mathrm{R}})^2 \\|v\\|_2^2}{\\|r_{1,\\mathrm{R}}\\|_2^2}$$\n我们计算各项：\n$$\\alpha_{\\mathrm{L}} - \\alpha_{\\mathrm{R}} = \\frac{75}{307} - \\frac{10}{31} = \\frac{75 \\cdot 31 - 10 \\cdot 307}{307 \\cdot 31} = \\frac{2325 - 3070}{9517} = -\\frac{745}{9517}$$\n$\\|v\\|_2^2 = 62$。$\\|r_{1,\\mathrm{R}}\\|_2^2 = 234/31$。\n$$\\frac{(\\alpha_{\\mathrm{L}} - \\alpha_{\\mathrm{R}})^2 \\|v\\|_2^2}{\\|r_{1,\\mathrm{R}}\\|_2^2} = \\frac{(-745/9517)^2 \\cdot 62}{234/31} = \\frac{745^2}{(307 \\cdot 31)^2} \\frac{62 \\cdot 31}{234} = \\frac{745^2 \\cdot (2 \\cdot 31) \\cdot 31}{307^2 \\cdot 31^2 \\cdot 234} = \\frac{2 \\cdot 745^2}{234 \\cdot 307^2} = \\frac{745^2}{117 \\cdot 307^2}$$\n所以，平方比的简化表达式为：\n$$\\frac{\\|r_{1,\\mathrm{L}}\\|_2^2}{\\|r_{1,\\mathrm{R}}\\|_2^2} = 1 + \\frac{745^2}{117 \\cdot 307^2} = \\frac{117 \\cdot 307^2 + 745^2}{117 \\cdot 307^2}$$\n我们计算整数值：\n$745^2 = 555025$。\n$307^2 = 94249$。\n$117 \\cdot 94249 = 11027133$。\n$$\\frac{\\|r_{1,\\mathrm{L}}\\|_2^2}{\\|r_{1,\\mathrm{R}}\\|_2^2} = \\frac{11027133 + 555025}{11027133} = \\frac{11582158}{11027133}$$\n所求的比值是该值的平方根。\n$$\\frac{\\|r_{1,\\mathrm{L}}\\|_2}{\\|r_{1,\\mathrm{R}}\\|_2} = \\sqrt{\\frac{11582158}{11027133}}$$\n这个分数是最简分数。", "answer": "$$\\boxed{\\sqrt{\\frac{11582158}{11027133}}}$$", "id": "3352731"}, {"introduction": "在掌握了如何应用预处理之后，下一步是学习如何构建一个具体的预处理器，其中不完全LU（ILU）分解是一种经典且高效的方法。ILU的核心思想是通过保持原矩阵的稀疏模式来近似计算其LU因子，从而在计算成本和预处理效果之间取得平衡。本练习[@problem_id:3352747]将指导你为一个源自一维泊松问题的典型矩阵手动构造ILU(0)预处理器，并揭示一个重要的特例：对于这类结构良好的矩阵，ILU(0)分解实际上是精确的，从而将预处理后的系统变为理想的单位矩阵。", "problem": "考虑一维泊松边界值问题 $-u''(x)=f(x)$，定义在区间 $(0,1)$ 上，其齐次狄利克雷边界条件为 $u(0)=u(1)=0$。在 $n=5$ 个内部网格点上，使用网格间距为 $h=1/(n+1)$ 的标准二阶中心有限差分格式进行离散化，可得到一个线性系统 $A \\mathbf{u}=\\mathbf{b}$，其系数矩阵 $A\\in\\mathbb{R}^{5\\times 5}$ 由 $A=\\frac{1}{h^{2}}\\operatorname{tridiag}(-1,2,-1)$ 给出。设 $M=\\mathrm{ILU}(0)$ 表示对 $A$ 进行的零填充不完全下-上 (ILU) 分解，并将其用作迭代克雷洛夫方法的左预条件子。\n\n请为这个 $5\\times 5$ 系统手动构造 $M$，从第一性原理出发：从微分方程推导出离散算子，利用 $\\mathrm{ILU}(0)$ 关于保持 $A$ 原始稀疏模式的不完全高斯消去的定义，并解释为何您构造的分解与该定义一致。然后，构建预处理算子 $M^{-1}A$，并根据您的构造和分解的基本性质，分析 $M^{-1}A$ 特征值的聚集行为。\n\n以 $\\mathrm{pmatrix}$ 格式的单行矩阵形式，报告 $M^{-1}A$ 的精确特征值作为最终答案。无需四舍五入，不涉及物理单位。", "solution": "用户要求我解决一个关于预处理的问题，该问题涉及由一维泊松方程离散化产生的线性系统。\n\n我的计划如下：\n\n1.  **问题验证**：\n    *   **步骤 1：提取已知条件**：我将列出所有提供的信息：微分方程、边界条件、离散化方案、内部网格点数 ($n$)、网格间距 ($h$)、矩阵形式 ($A$)、预条件子的定义 ($M = ILU(0)$)，以及任务（构造 $M$、$M^{-1}A$ 并求出 $M^{-1}A$ 的特征值）。\n    *   **步骤 2：验证**：我将评估问题的科学基础、适定性和客观性。这是一个数值线性代数和计算科学中的标准问题，涉及泊松方程、有限差分和 ILU(0) 分解，这些都是成熟的概念。该问题定义明确，对于分解和特征值有唯一解。语言精确客观。\n    *   **步骤 3：结论**：问题有效。我将继续进行求解。\n\n2.  **求解过程构建**：\n    *   **第 1 部分：推导并构造矩阵 $A$**：\n        *   我将首先展示给定的微分方程和离散化如何导出矩阵结构。\n        *   我将使用给定的参数 $n=5$ 和 $h = 1/(n+1) = 1/6$ 来构造具体的 $5 \\times 5$ 矩阵 $A$。\n\n    *   **第 2 部分：构造 ILU(0) 预条件子 $M$**：\n        *   我将 ILU(0) 定义为不完全 LU 分解 $M = L_I U_I$，其中 $L_I$ 和 $U_I$ 的组合稀疏模式与 $A$ 的稀疏模式相同。\n        *   我将论证对于一个三对角矩阵，其精确 LU 分解不会产生填充（即，得到的 $L$ 和 $U$ 因子是双对角的）。\n        *   因此，对于三对角矩阵，ILU(0) 分解与精确 LU 分解相同，意味着 $M = A$。\n        *   为了满足问题的要求，我将细致地对矩阵 $A$ 执行 ILU(0) 算法的逐步计算。这将正式证明所得因子 $L_I U_I$ 的乘积完全等于 $A$。\n\n    *   **第 3 部分：构建预处理算子并分析特征值**：\n        *   基于已确立的 $M=A$ 事实，预处理算子 $M^{-1}A$ 变为 $A^{-1}A = I$，即单位矩阵。\n        *   单位矩阵的特征值全部为 $1$。\n        *   然后我将分析聚集行为，指出特征值完美地聚集在一个点上，这表明预条件子实际上是一个精确求解器。这将导致像 GMRES 这样的迭代方法在一步之内收敛。\n\n    *   **第 4 部分：最终答案的格式化**：\n        *   我将以所需的 `pmatrix` LaTeX 格式将 $M^{-1}A$ 的特征值表示为一个行矩阵。\n\n这种结构化方法确保了问题的所有部分都得到解决，包括推导、构造和分析，同时遵守科学正确性和逻辑严谨性的原则。该问题的潜在“陷阱”——ILU(0) 对于三对角矩阵是精确分解——将是我解释的中心点。\n\n***\n\n首先，我们验证问题陈述。\n\n**步骤 1：提取已知条件**\n- **微分方程**：$-u''(x)=f(x)$，对于 $x \\in (0,1)$。\n- **边界条件**：齐次狄利克雷，$u(0)=0$ 和 $u(1)=0$。\n- **离散化**：标准二阶中心有限差分。\n- **网格**：$n=5$ 个内部网格点。\n- **网格间距**：$h=1/(n+1)$。\n- **线性系统**：$A \\mathbf{u}=\\mathbf{b}$。\n- **系数矩阵**：$A\\in\\mathbb{R}^{5\\times 5}$，由 $A=\\frac{1}{h^{2}}\\operatorname{tridiag}(-1, 2, -1)$ 给出。\n- **预条件子**：$M=\\mathrm{ILU}(0)$，零填充不完全 LU 分解，用作左预条件子。\n- **任务**：\n    1.  手动构造 $M$。\n    2.  推导离散算子。\n    3.  使用 $\\mathrm{ILU}(0)$ 的定义并解释一致性。\n    4.  构建预处理算子 $M^{-1}A$。\n    5.  分析 $M^{-1}A$ 的特征值聚集情况。\n    6.  报告 $M^{-1}A$ 的特征值。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学性**：该问题根植于偏微分方程数值分析的基本概念，特别是泊松方程的有限差分法和带预处理的克雷洛夫子空间方法。$\\mathrm{ILU}(0)$ 分解和特征值分析的概念都是标准且严格定义的。该问题在科学上是合理的。\n- **适定性**：问题定义清晰。矩阵 $A$ 的构造是明确的。对于给定的矩阵，$\\mathrm{ILU}(0)$ 分解是一个定义良好的算法，对于像 $A$ 这样的对称正定矩阵会产生唯一的结果。随后的特征值计算是标准的线性代数任务。问题要求一个具体、唯一且有意义的解。\n- **客观性**：问题使用精确的数学和计算术语陈述。没有主观或含糊的陈述。\n\n**步骤 3：结论与行动**\n问题有效。这是一个计算科学中的标准、适定问题，旨在测试离散化和预处理的基础知识。我们继续求解。\n\n一维泊松问题由下式给出：\n$$\n-u''(x) = f(x), \\quad x \\in (0, 1)\n$$\n边界条件为 $u(0) = 0$ 和 $u(1) = 0$。\n我们使用 $n=5$ 个内部点 $x_i = ih$（$i=1, \\dots, 5$）对定义域进行离散化，其中网格间距为 $h = \\frac{1}{n+1} = \\frac{1}{6}$。边界点为 $x_0 = 0$ 和 $x_6 = 1$。设 $u_i \\approx u(x_i)$。\n\n二阶导数 $u''(x_i)$ 使用二阶中心有限差分格式近似：\n$$\nu''(x_i) \\approx \\frac{u(x_{i+1}) - 2u(x_i) + u(x_{i-1})}{h^2} = \\frac{u_{i+1} - 2u_i + u_{i-1}}{h^2}\n$$\n将此式代入每个内部点 $x_i$ 处的微分方程，得到：\n$$\n-\\frac{u_{i+1} - 2u_i + u_{i-1}}{h^2} = f(x_i)\n$$\n两边乘以 $h^2$ 并重新整理各项，得到：\n$$\n-u_{i-1} + 2u_i - u_{i+1} = h^2 f_i\n$$\n其中 $f_i = f(x_i)$。当 $i=1$ 时，我们使用边界条件 $u_0 = u(0) = 0$。当 $i=5$ 时，我们使用 $u_6 = u(1) = 0$。\n\n这 5 个线性方程可以写成矩阵形式 $A\\mathbf{u} = \\mathbf{b}$，其中 $\\mathbf{u} = [u_1, u_2, u_3, u_4, u_5]^T$ 且 $\\mathbf{b} = h^2[f_1, f_2, f_3, f_4, f_5]^T$。系数矩阵 $A$ 是：\n$$\nA = \\begin{pmatrix}\n2  -1  0  0  0 \\\\\n-1  2  -1  0  0 \\\\\n0  -1  2  -1  0 \\\\\n0  0  -1  2  -1 \\\\\n0  0  0  -1  2\n\\end{pmatrix}\n$$\n问题陈述中包含因子 $\\frac{1}{h^2}$，因此我们将系统重新定义为 $\\frac{1}{h^2}(-u_{i-1} + 2u_i - u_{i+1}) = f_i$。这导出了问题陈述中给出的矩阵 $A$：\n$$\nA = \\frac{1}{h^2} \\operatorname{tridiag}(-1, 2, -1)\n$$\n当 $h = \\frac{1}{6}$ 时，缩放因子为 $\\frac{1}{h^2} = 36$。\n$$\nA = 36 \\begin{pmatrix}\n2  -1  0  0  0 \\\\\n-1  2  -1  0  0 \\\\\n0  -1  2  -1  0 \\\\\n0  0  -1  2  -1 \\\\\n0  0  0  -1  2\n\\end{pmatrix}\n= \\begin{pmatrix}\n72  -36  0  0  0 \\\\\n-36  72  -36  0  0 \\\\\n0  -36  72  -36  0 \\\\\n0  0  -36  72  -36 \\\\\n0  0  0  -36  72\n\\end{pmatrix}\n$$\n接下来，我们构造 $\\mathrm{ILU}(0)$ 预条件子 $M$。$\\mathrm{ILU}(0)$ 的定义是一种不完全 LU 分解 $M = L_I U_I$，其中 $L_I$ 是单位下三角矩阵，$U_I$ 是上三角矩阵。关键约束是“零填充”，这意味着 $L_I$ 和 $U_I$ 的稀疏模式是原始矩阵 $A$ 稀疏模式的子集。具体来说，如果 $A$ 中的某个元素 $(i, j)$ 为零，那么它在 $L_I$ 和 $U_I$ 中也必须为零。\n\n对于三对角矩阵 $A$，其精确 LU 分解 $A=LU$ 会产生一个下双对角矩阵 $L$ 和一个上双对角矩阵 $U$。这意味着精确 LU 分解不会产生任何“填充”——即在原始矩阵中为零的位置不会产生新的非零项。因此，对于三对角矩阵，精确 LU 分解已经满足了 $\\mathrm{ILU}(0)$ 的零填充条件。所以，$\\mathrm{ILU}(0)$ 分解与精确 LU 分解是相同的，我们必然有 $M=A$。\n\n为了证实这一点并按要求构造 $M$，我们执行分解步骤。设 $M = L_I U_I$，其中 $L_I$ 是单位下双对角矩阵，$U_I$ 是上双对角矩阵，其稀疏模式与 $A$ 匹配。\n$$\nL_I = \\begin{pmatrix}\n1  0  0  0  0 \\\\\nl_{21}  1  0  0  0 \\\\\n0  l_{32}  1  0  0 \\\\\n0  0  l_{43}  1  0 \\\\\n0  0  0  l_{54}  1\n\\end{pmatrix}, \\quad\nU_I = \\begin{pmatrix}\nu_{11}  u_{12}  0  0  0 \\\\\n0  u_{22}  u_{23}  0  0 \\\\\n0  0  u_{33}  u_{34}  0 \\\\\n0  0  0  u_{44}  u_{45} \\\\\n0  0  0  0  u_{55}\n\\end{pmatrix}\n$$\n$M = L_I U_I$ 的元素必须在 $A$ 的所有非零位置上与 $A$ 的元素相等。\n$U_I$ 的上对角线与 $A$ 的相同：$u_{i,i+1} = A_{i,i+1} = -36$。\n其余元素通过递归计算得出：\n对于 $i=1$：\n$u_{11} = A_{11} = 72$。\n\n对于 $i=2$：\n$l_{21} u_{11} = A_{21} \\implies l_{21} = A_{21} / u_{11} = -36 / 72 = -1/2$。\n$l_{21} u_{12} + u_{22} = A_{22} \\implies u_{22} = A_{22} - l_{21} u_{12} = 72 - (-1/2)(-36) = 72 - 18 = 54$。\n\n对于 $i=3$：\n$l_{32} u_{22} = A_{32} \\implies l_{32} = A_{32} / u_{22} = -36 / 54 = -2/3$。\n$l_{32} u_{23} + u_{33} = A_{33} \\implies u_{33} = A_{33} - l_{32} u_{23} = 72 - (-2/3)(-36) = 72 - 24 = 48$。\n\n对于 $i=4$：\n$l_{43} u_{33} = A_{43} \\implies l_{43} = A_{43} / u_{33} = -36 / 48 = -3/4$。\n$l_{43} u_{34} + u_{44} = A_{44} \\implies u_{44} = A_{44} - l_{43} u_{34} = 72 - (-3/4)(-36) = 72 - 27 = 45$。\n\n对于 $i=5$：\n$l_{54} u_{44} = A_{54} \\implies l_{54} = A_{54} / u_{44} = -36 / 45 = -4/5$。\n$l_{54} u_{45} + u_{55} = A_{55} \\implies u_{55} = A_{55} - l_{54} u_{45} = 72 - (-4/5)(-36) = 72 - 144/5 = (360-144)/5 = 216/5$。\n\n因此，分解因子为：\n$$\nL_I = \\begin{pmatrix}\n1  0  0  0  0 \\\\\n-1/2  1  0  0  0 \\\\\n0  -2/3  1  0  0 \\\\\n0  0  -3/4  1  0 \\\\\n0  0  0  -4/5  1\n\\end{pmatrix}, \\quad\nU_I = \\begin{pmatrix}\n72  -36  0  0  0 \\\\\n0  54  -36  0  0 \\\\\n0  0  48  -36  0 \\\\\n0  0  0  45  -36 \\\\\n0  0  0  0  216/5\n\\end{pmatrix}\n$$\n预条件子是 $M=L_I U_I$。如前所述，这个乘积必须精确等于 $A$。我们来验证一个元素：\n$M_{3,3} = (L_I U_I)_{3,3} = l_{32} u_{23} + l_{33} u_{33} = (-2/3)(-36) + (1)(48) = 24 + 48 = 72 = A_{3,3}$。\n该构造得出 $M = A$。这个分解与 $\\mathrm{ILU}(0)$ 的定义是一致的，因为三对角矩阵 $A$ 的精确 LU 分解不产生任何填充，从而遵守了保持原始稀疏模式的规则。\n\n现在我们构建预处理算子 $M^{-1}A$。由于 $M=A$ 且 $A$ 是可逆的（因为它是对称正定矩阵），我们有：\n$$\nM^{-1}A = A^{-1}A = I\n$$\n其中 $I$ 是 $5 \\times 5$ 的单位矩阵。\n\n最后，我们分析 $M^{-1}A = I$ 的特征值的聚集情况。单位矩阵的特征值是特征方程 $\\det(I - \\lambda I) = 0$ 的解，即 $(1-\\lambda)^5 = 0$。\n特征值为 $\\lambda_1 = \\lambda_2 = \\lambda_3 = \\lambda_4 = \\lambda_5 = 1$。\n\n这些特征值完美地聚集在单一值 $\\lambda=1$ 处。在克雷洛夫方法的背景下，如果预处理后的矩阵的特征值聚集在 1 附近，则该预条件子被认为是理想的。在这里，预条件子是完美的，因为它是 $A$ 的一个精确分解。这意味着任何克雷洛夫子空间方法，如 GMRES，都将在一次迭代中收敛（在精确算术下），因为预条件子有效地将系统 $A\\mathbf{x}=\\mathbf{b}$ 转换为 $I\\mathbf{x} = M^{-1}\\mathbf{b}$，而后者已经是解出的形式。\n\n最终答案是 $M^{-1}A$ 的特征值集合。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1  1  1  1  1\n\\end{pmatrix}\n}\n$$", "id": "3352747"}, {"introduction": "预处理的最终目标是缩短求解时间，但这不仅仅是减少迭代次数那么简单，因为更强的预处理器通常也意味着更高的单次迭代计算成本。因此，选择最佳预处理器是一个典型的权衡问题：是选择一个计算开销小但收敛慢的简单预处理器，还是一个开销大但收敛快的复杂预处理器？这个练习[@problem_id:3352774]建立了一个简洁而实用的性能模型，帮助你量化这种权衡关系，并计算出决定性的“盈亏平衡点”，从而在实际应用中做出更明智的性能优化决策。", "problem": "考虑一个由不可压缩Navier–Stokes方程的有限体积离散化产生的线性系统，具体来说是其对称正定的压力泊松子问题。该系统在一台分布式内存计算机上使用预处理共轭梯度（PCG）方法求解。每次迭代的运行时间主要由浮点计算和节点间通信所主导。预条件子会同时改变每次迭代的成本和达到固定残差容限所需的迭代次数。\n\n有两种预处理选择：\n\n- 一种轻量级的分块雅可比预条件子，记为 $P_{\\mathrm{J}}$，测得的每次迭代计算时间为 $t_{\\mathrm{comp,J}} = 5.5 \\times 10^{-3}$，通信时间为 $t_{\\mathrm{comm,J}} = 3.1 \\times 10^{-3}$。在此配置下，观测到收敛所需的迭代次数为 $n_{\\mathrm{J}} = 750$。\n\n- 一种更强的带1级填充的重叠不完全LU分解预条件子，记为 $P_{\\mathrm{ILU1}}$，测得的每次迭代计算时间为 $t_{\\mathrm{comp,ILU1}} = 8.0 \\times 10^{-3}$，通信时间为 $t_{\\mathrm{comm,ILU1}} = 5.0 \\times 10^{-3}$。当使用 $P_{\\mathrm{ILU1}}$ 时，观测到达到相同容限的迭代次数相对于 $P_{\\mathrm{J}}$ 减少了一个因子 $\\alpha$，因此 $n_{\\mathrm{ILU1}} = \\alpha \\, n_{\\mathrm{J}}$，其中 $0  \\alpha  1$。\n\n假设预条件子的设置成本与累积的迭代运行时间相比可以忽略不计，并且每种选择的总求解时间可以建模为迭代次数与每次迭代时间（计算和通信部分之和）的乘积。从这些定义出发，推导出一个通用的盈亏平衡折减因子 $\\alpha_{\\star}$ 的表达式，使得使用 $P_{\\mathrm{ILU1}}$ 的总运行时间等于使用 $P_{\\mathrm{J}}$ 的总运行时间。然后，使用上述测量值，对 $\\alpha_{\\star}$ 进行数值计算。\n\n将最终的阈值折减因子 $\\alpha_{\\star}$ 表示为一个无量纲量。将您的数值结果保留四位有效数字。", "solution": "该问题已经过验证，被认为是科学上合理、适定且客观的。它提出了一个计算科学中标准的性能建模场景。所有必要的数据和简化假设都已提供，不存在矛盾或歧义。\n\n目标是找到盈亏平衡的迭代折减因子 $\\alpha_{\\star}$，在该点上两种不同预条件子的总求解时间相同。设 $T_{\\mathrm{J}}$ 和 $T_{\\mathrm{ILU1}}$ 分别表示分块雅可比（$P_{\\mathrm{J}}$）和不完全LU分解（$P_{\\mathrm{ILU1}}$）预条件子的总求解时间。\n\n根据问题陈述，总求解时间被建模为迭代次数与每次迭代时间的乘积。每次迭代时间是计算和通信部分之和。\n\n对于分块雅可比预条件子，总时间为：\n$$T_{\\mathrm{J}} = n_{\\mathrm{J}} (t_{\\mathrm{comp,J}} + t_{\\mathrm{comm,J}})$$\n此处，$n_{\\mathrm{J}}$ 是迭代次数，$t_{\\mathrm{comp,J}}$ 是每次迭代的计算时间，$t_{\\mathrm{comm,J}}$ 是每次迭代的通信时间。\n\n对于ILU(1)预条件子，总时间为：\n$$T_{\\mathrm{ILU1}} = n_{\\mathrm{ILU1}} (t_{\\mathrm{comp,ILU1}} + t_{\\mathrm{comm,ILU1}})$$\nILU(1)方法的迭代次数 $n_{\\mathrm{ILU1}}$ 与雅可比方法的迭代次数通过一个折减因子 $\\alpha$ 相关联：\n$$n_{\\mathrm{ILU1}} = \\alpha \\, n_{\\mathrm{J}}$$\n\n当总时间相等时，即 $T_{\\mathrm{ILU1}} = T_{\\mathrm{J}}$，达到盈亏平衡条件。我们寻求满足此等式的 $\\alpha$ 的特定值，记为 $\\alpha_{\\star}$。\n$$n_{\\mathrm{ILU1}} (t_{\\mathrm{comp,ILU1}} + t_{\\mathrm{comm,ILU1}}) = n_{\\mathrm{J}} (t_{\\mathrm{comp,J}} + t_{\\mathrm{comm,J}})$$\n将 $n_{\\mathrm{ILU1}}$ 的表达式代入，并令 $\\alpha = \\alpha_{\\star}$：\n$$(\\alpha_{\\star} \\, n_{\\mathrm{J}}) (t_{\\mathrm{comp,ILU1}} + t_{\\mathrm{comm,ILU1}}) = n_{\\mathrm{J}} (t_{\\mathrm{comp,J}} + t_{\\mathrm{comm,J}})$$\n雅可比方法的迭代次数 $n_{\\mathrm{J}}$ 给定为 $750$，为非零值。因此，我们可以将等式两边同时除以 $n_{\\mathrm{J}}$：\n$$\\alpha_{\\star} (t_{\\mathrm{comp,ILU1}} + t_{\\mathrm{comm,ILU1}}) = t_{\\mathrm{comp,J}} + t_{\\mathrm{comm,J}}$$\n解出 $\\alpha_{\\star}$，得到盈亏平衡折减因子的通用符号表达式：\n$$\\alpha_{\\star} = \\frac{t_{\\mathrm{comp,J}} + t_{\\mathrm{comm,J}}}{t_{\\mathrm{comp,ILU1}} + t_{\\mathrm{comm,ILU1}}}$$\n该表达式是成本较低的预条件子（$P_{\\mathrm{J}}$）的单次迭代总时间与成本较高的预条件子（$P_{\\mathrm{ILU1}}$）的单次迭代总时间之比。\n\n现在，我们使用提供的数据对此表达式进行数值计算：\n- $t_{\\mathrm{comp,J}} = 5.5 \\times 10^{-3}$\n- $t_{\\mathrm{comm,J}} = 3.1 \\times 10^{-3}$\n- $t_{\\mathrm{comp,ILU1}} = 8.0 \\times 10^{-3}$\n- $t_{\\mathrm{comm,ILU1}} = 5.0 \\times 10^{-3}$\n\n首先，计算每种方法的单次迭代总时间。\n对于 $P_{\\mathrm{J}}$：\n$$t_{\\mathrm{comp,J}} + t_{\\mathrm{comm,J}} = 5.5 \\times 10^{-3} + 3.1 \\times 10^{-3} = 8.6 \\times 10^{-3}$$\n对于 $P_{\\mathrm{ILU1}}$：\n$$t_{\\mathrm{comp,ILU1}} + t_{\\mathrm{comm,ILU1}} = 8.0 \\times 10^{-3} + 5.0 \\times 10^{-3} = 13.0 \\times 10^{-3}$$\n\n将这些值代入 $\\alpha_{\\star}$ 的表达式中：\n$$\\alpha_{\\star} = \\frac{8.6 \\times 10^{-3}}{13.0 \\times 10^{-3}}$$\n分子和分母中的因子 $10^{-3}$ 相互抵消，剩下：\n$$\\alpha_{\\star} = \\frac{8.6}{13.0} \\approx 0.66153846...$$\n题目要求结果保留四位有效数字。检查第五位有效数字为3，因此向下舍入。\n$$\\alpha_{\\star} \\approx 0.6615$$\n这个无量纲因子是阈值。如果更强的预条件子能将迭代次数减少到一个小于0.6615的因子，那么它将是性能更好的选择。", "answer": "$$\\boxed{0.6615}$$", "id": "3352774"}]}