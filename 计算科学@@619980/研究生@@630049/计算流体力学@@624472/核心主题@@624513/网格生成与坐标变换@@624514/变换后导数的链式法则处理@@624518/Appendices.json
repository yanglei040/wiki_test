{"hands_on_practices": [{"introduction": "我们从一个基本的构建模块开始。这项练习将引导你从第一性原理出发，推导在通用曲线坐标系中的梯度算子 $\\nabla\\phi$，并将其简化为更常见的正交坐标系形式。这项实践旨在强化梯度算子的几何定义与其分量形式之间的联系 [@problem_id:3298892]，这对于在非笛卡尔网格中正确表述物理定律至关重要。", "problem": "在计算流体动力学（CFD）中，曲线坐标映射用于在贴体网格上表示空间导数。设 $\\boldsymbol{x}(\\xi^1,\\xi^2,\\xi^3)$ 是一个从计算坐标 $(\\xi^1,\\xi^2,\\xi^3)\\in\\mathbb{R}^3$ 到物理空间 $\\boldsymbol{x}\\in\\mathbb{R}^3$ 的光滑双射。定义协变基向量为 $\\boldsymbol{a}_i=\\partial \\boldsymbol{x}/\\partial \\xi^i$（其中 $i\\in\\{1,2,3\\}$），度规张量为 $g_{ij}=\\boldsymbol{a}_i\\cdot \\boldsymbol{a}_j$。设 $d\\boldsymbol{x}=\\boldsymbol{a}_i\\,d\\xi^i$ 表示微分映射，并设 $\\phi(\\boldsymbol{x})$ 为一个光滑标量场。\n\n仅从链式法则和梯度的定义性质 $d\\phi=\\nabla \\phi \\cdot d\\boldsymbol{x}$ 出发，首先用 $\\phi$ 关于 $\\xi^i$ 的导数和倒易基来表示 $\\nabla \\phi$。然后，假设一个正交映射，即当 $i\\neq j$ 时 $g_{ij}=0$，并引入尺度因子 $h_i=\\sqrt{g_{ii}}$ 及相关的标准正交方向 $\\boldsymbol{e}_i=\\boldsymbol{a}_i/h_i$。使用这些定义，将您得到的一般表达式简化为其正交坐标形式。\n\n最终答案请提供一个关于 $\\boldsymbol{e}_i$、$h_i$ 和 $\\partial \\phi/\\partial \\xi^i$ 的、表示简化后梯度的单一闭式解析向量表达式。无需进行数值计算。", "solution": "首先根据所需准则验证问题陈述。\n\n**步骤1：提取已知条件**\n-   坐标映射：$\\boldsymbol{x}(\\xi^1,\\xi^2,\\xi^3)$ 是从计算坐标 $(\\xi^1,\\xi^2,\\xi^3)\\in\\mathbb{R}^3$ 到物理空间 $\\boldsymbol{x}\\in\\mathbb{R}^3$ 的光滑双射。\n-   协变基向量：$\\boldsymbol{a}_i=\\partial \\boldsymbol{x}/\\partial \\xi^i$，其中 $i\\in\\{1,2,3\\}$。\n-   度规张量：$g_{ij}=\\boldsymbol{a}_i\\cdot \\boldsymbol{a}_j$。\n-   微分映射：$d\\boldsymbol{x}=\\boldsymbol{a}_i\\,d\\xi^i$（暗示使用了爱因斯坦求和约定）。\n-   标量场：$\\phi(\\boldsymbol{x})$ 是一个光滑标量场。\n-   梯度定义：$d\\phi=\\nabla \\phi \\cdot d\\boldsymbol{x}$。\n-   正交条件：当 $i\\neq j$ 时，$g_{ij}=0$。\n-   尺度因子：$h_i=\\sqrt{g_{ii}}$。\n-   标准正交基向量：$\\boldsymbol{e}_i=\\boldsymbol{a}_i/h_i$。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学基础**：该问题牢固地植根于张量微积分和微分几何的原理，这些是在曲线坐标中描述物理和工程系统的标准数学工具。这些定义和关系是广义相对论和计算流体动力学等领域的基础。\n-   **适定性**：问题陈述清晰，提供了所有必要的定义和一个明确的目标：在指定的坐标变换下推导一个特定的物理量（梯度）。求解路径逻辑上导向明确，并预期得到一个唯一、有意义的解析表达式。\n-   **客观性**：语言精确、数学化，没有任何主观或模糊的术语。\n\n**步骤3：结论与行动**\n该问题在科学上是合理的、适定的和客观的。它不包含任何矛盾、缺失的信息或伪科学主张。因此，该问题被认为是 **有效的**，并将提供解答。\n\n**梯度表达式的推导**\n\n我们首先在非正交曲线坐标系 $(\\xi^1, \\xi^2, \\xi^3)$ 中寻找梯度 $\\nabla \\phi$ 的一般表达式。标量场 $\\phi$ 是物理坐标 $\\boldsymbol{x}$ 的函数，而物理坐标又是计算坐标 $\\xi^i$ 的函数，因此 $\\phi$ 的全微分可以通过链式法则求得：\n$$d\\phi = \\frac{\\partial\\phi}{\\partial\\xi^1}d\\xi^1 + \\frac{\\partial\\phi}{\\partial\\xi^2}d\\xi^2 + \\frac{\\partial\\phi}{\\partial\\xi^3}d\\xi^3$$\n使用爱因斯坦求和约定，可以紧凑地写为：\n$$d\\phi = \\frac{\\partial\\phi}{\\partial\\xi^i}d\\xi^i$$\n问题给出了梯度向量 $\\nabla \\phi$ 的定义性质：\n$$d\\phi = \\nabla \\phi \\cdot d\\boldsymbol{x}$$\n我们还已知物理微分位移 $d\\boldsymbol{x}$ 和计算坐标微分 $d\\xi^i$ 之间的关系：\n$$d\\boldsymbol{x} = \\frac{\\partial\\boldsymbol{x}}{\\partial\\xi^j}d\\xi^j = \\boldsymbol{a}_j d\\xi^j$$\n将此代入梯度定义中，得到：\n$$d\\phi = \\nabla \\phi \\cdot (\\boldsymbol{a}_j d\\xi^j) = (\\nabla \\phi \\cdot \\boldsymbol{a}_j) d\\xi^j$$\n通过令 $d\\phi$ 的两个表达式相等，我们得到：\n$$\\frac{\\partial\\phi}{\\partial\\xi^i}d\\xi^i = (\\nabla \\phi \\cdot \\boldsymbol{a}_j) d\\xi^j$$\n由于微分 $d\\xi^i$ 构成了计算空间中1-形式的一组基，它们是独立的。因此，我们可以令相应微分的系数相等。为避免指标冲突，我们写为：\n$$\\frac{\\partial\\phi}{\\partial\\xi^i} = \\nabla \\phi \\cdot \\boldsymbol{a}_i$$\n这个方程给出了梯度向量在协变基向量 $\\boldsymbol{a}_i$ 上的投影。为了表示向量 $\\nabla \\phi$ 本身，我们引入由性质定义的倒易（或逆变）基，记为 $\\boldsymbol{a}^j$：\n$$\\boldsymbol{a}^j \\cdot \\boldsymbol{a}_i = \\delta^j_i$$\n其中 $\\delta^j_i$ 是克罗内克δ。物理空间中的任何向量都可以用这个倒易基展开。我们将梯度向量写为：\n$$\\nabla \\phi = C_j \\boldsymbol{a}^j$$\n其中 $C_j$ 是梯度的逆变分量。为了求出这些分量，我们将上述表达式与 $\\boldsymbol{a}_i$ 作点积：\n$$\\nabla \\phi \\cdot \\boldsymbol{a}_i = (C_j \\boldsymbol{a}^j) \\cdot \\boldsymbol{a}_i = C_j (\\boldsymbol{a}^j \\cdot \\boldsymbol{a}_i) = C_j \\delta^j_i = C_i$$\n将此与我们之前的结果比较，我们发现这些分量恰好是 $\\phi$ 的偏导数：\n$$C_i = \\frac{\\partial\\phi}{\\partial\\xi^i}$$\n将此代回到 $\\nabla \\phi$ 的展开式中，我们得到在任意曲线坐标下梯度的一般表达式：\n$$\\nabla \\phi = \\frac{\\partial\\phi}{\\partial\\xi^i} \\boldsymbol{a}^i$$\n接下来，我们为正交坐标系简化此表达式。正交条件是当 $i \\neq j$ 时，$g_{ij} = \\boldsymbol{a}_i \\cdot \\boldsymbol{a}_j = 0$。度规张量的对角元素是 $g_{ii} = \\boldsymbol{a}_i \\cdot \\boldsymbol{a}_i$（对 $i$ 不求和）。\n\n倒易基 $\\boldsymbol{a}^j$ 和协变基 $\\boldsymbol{a}_k$ 之间的关系由 $\\boldsymbol{a}^j = g^{jk}\\boldsymbol{a}_k$ 给出，其中 $g^{jk}$ 是度规张量的逆，$g_{ik}g^{kj} = \\delta^j_i$。对于对角度规张量，其逆也是对角的，分量为 $g^{jj} = 1/g_{jj}$（不求和）且当 $j \\neq k$ 时 $g^{jk}=0$。\n因此，对于正交系统，$\\boldsymbol{a}^j$ 的求和简化为：\n$$\\boldsymbol{a}^j = g^{j1}\\boldsymbol{a}_1 + g^{j2}\\boldsymbol{a}_2 + g^{j3}\\boldsymbol{a}_3 = g^{jj}\\boldsymbol{a}_j = \\frac{1}{g_{jj}}\\boldsymbol{a}_j$$\n（对 $j$ 不求和）。\n将倒易基的这种简化形式代入我们的一般梯度表达式中：\n$$\\nabla \\phi = \\sum_{i=1}^{3} \\frac{\\partial\\phi}{\\partial\\xi^i} \\boldsymbol{a}^i = \\sum_{i=1}^{3} \\frac{\\partial\\phi}{\\partial\\xi^i} \\left(\\frac{1}{g_{ii}}\\boldsymbol{a}_i\\right)$$\n最后，我们引入尺度因子 $h_i = \\sqrt{g_{ii}}$ 和标准正交基向量 $\\boldsymbol{e}_i = \\boldsymbol{a}_i/h_i$。根据这些定义，我们有 $g_{ii} = h_i^2$ 和 $\\boldsymbol{a}_i = h_i \\boldsymbol{e}_i$。将这些代入梯度表达式中：\n$$\\nabla \\phi = \\sum_{i=1}^{3} \\frac{\\partial\\phi}{\\partial\\xi^i} \\left(\\frac{1}{h_i^2}}(h_i \\boldsymbol{e}_i)\\right) = \\sum_{i=1}^{3} \\frac{\\partial\\phi}{\\partial\\xi^i} \\left(\\frac{1}{h_i}\\boldsymbol{e}_i\\right)$$\n这就得出了正交曲线坐标中梯度的最终简化表达式：\n$$\\nabla \\phi = \\frac{1}{h_1}\\frac{\\partial\\phi}{\\partial\\xi^1}\\boldsymbol{e}_1 + \\frac{1}{h_2}\\frac{\\partial\\phi}{\\partial\\xi^2}\\boldsymbol{e}_2 + \\frac{1}{h_3}\\frac{\\partial\\phi}{\\partial\\xi^3}\\boldsymbol{e}_3$$", "answer": "$$\n\\boxed{\\sum_{i=1}^{3} \\frac{1}{h_i} \\frac{\\partial \\phi}{\\partial \\xi^i} \\boldsymbol{e}_i}\n$$", "id": "3298892"}, {"introduction": "在掌握了正确的推导方法之后，理解常见错误的后果也同样至关重要。这个思想实验将展示，对矢量场天真地应用链式法则——特别是在变换中忽略基矢量的空间导数——会如何产生非物理的“源项” [@problem_id:3298873]。这项练习突显了为何在流体力学模拟中，正确处理度量项对于满足自由来流守恒等基本原则是不可或缺的。", "problem": "计算流体动力学 (CFD) 的一个核心要求是，在将控制方程变换到曲线坐标系后，一个恒定的自由流解必须仍然是一个解。考虑一个密度和压力恒定的流体，其二维、定常、无粘的原始变量动量平衡方程。对于均匀自由流，速度场的物理空间物质加速度必须为零。设物理空间通过由极坐标变换定义的光滑双射映射到一个曲线坐标系\n$$\nx = r \\cos\\theta,\\qquad y = r \\sin\\theta,\n$$\n其中计算坐标 $(r,\\theta)$ 覆盖一个 $r>0$ 的单连通环形区域。\n\n在笛卡尔坐标系中施加一个均匀自由流，由下式给出\n$$\nu(x,y) = U_0,\\qquad v(x,y) = 0,\n$$\n其中 $U_0$ 为一个正常数，且密度场和压力场恒定。该场的精确物理空间物质加速度恒等于零。\n\n现在，假设有人试图通过仅对标量分量场应用链式法则，来写出在 $(r,\\theta)$ 坐标系下的非守恒变换对流形式，同时错误地保持曲线基矢量不变（即，忽略它们对 $\\theta$ 的依赖性）。在这个简单的做法中，物质加速度的径向分量被近似为径向分量沿着以 $(r,\\theta)$ 表示的速度矢量的方向导数，该导数仅由标量分量场 $u_r(r,\\theta)$ 和 $u_\\theta(r,\\theta)$ 的偏导数构成。\n\n仅使用基本定义和链式法则，完成以下任务：\n\n- 将均匀笛卡尔自由流 $(u,v)$ 用其在 $(r,\\theta)$ 处的极坐标基矢相关的曲线分量 $(u_r,u_\\theta)$ 表示。\n- 构建通过仅对标量分量求导并将极坐标基矢视为常数得到的简单非守恒变换径向对流残差 $S_r(r,\\theta)$。对于给定的自由流，明确地计算 $S_r(r,\\theta)$。\n- 从第一性原理的层面，简要地指出这种简单的做法忽略了哪些导数，以及为什么在一个正确的变换公式中它们不能被忽略。\n\n你的最终答案必须是 $S_r(r,\\theta)$ 关于 $r$、$\\theta$ 和 $U_0$ 的单一显式封闭形式表达式。不要在最终答案中包含单位，也不要进行四舍五入或近似。", "solution": "问题陈述经过严格验证，确认有效。这是一个在矢量微积分和计算流体动力学领域中适定的、有科学依据的问题，它要求计算一个由有意设计的错误过程产生的特定项，以突显坐标变换中的一个常见错误。\n\n解答按要求分为三个部分。\n\n首先，我们将均匀笛卡尔自由流速度矢量用其在极坐标系 $(r, \\theta)$ 中的曲线分量表示。笛卡尔速度场由 $\\vec{V} = u\\hat{i} + v\\hat{j}$ 给出，其中 $u(x,y) = U_0$ 且 $v(x,y) = 0$。因此，速度矢量在物理空间中是恒定的：$\\vec{V} = U_0\\hat{i}$。\n\n极坐标基矢量 $\\hat{e}_r$ 和 $\\hat{e}_\\theta$ 可以用笛卡尔基矢量 $\\hat{i}$ 和 $\\hat{j}$ 表示为：\n$$\n\\hat{e}_r = \\cos\\theta \\hat{i} + \\sin\\theta \\hat{j}\n$$\n$$\n\\hat{e}_\\theta = -\\sin\\theta \\hat{i} + \\cos\\theta \\hat{j}\n$$\n速度矢量 $\\vec{V}$ 可以在极坐标基中表示为 $\\vec{V} = u_r \\hat{e}_r + u_\\theta \\hat{e}_\\theta$。标量分量 $u_r$ 和 $u_\\theta$ 通过将 $\\vec{V}$ 投影到极坐标基矢量上得到：\n$$\nu_r(r,\\theta) = \\vec{V} \\cdot \\hat{e}_r = (U_0\\hat{i}) \\cdot (\\cos\\theta \\hat{i} + \\sin\\theta \\hat{j}) = U_0 \\cos\\theta\n$$\n$$\nu_\\theta(r,\\theta) = \\vec{V} \\cdot \\hat{e}_\\theta = (U_0\\hat{i}) \\cdot (-\\sin\\theta \\hat{i} + \\cos\\theta \\hat{j}) = -U_0 \\sin\\theta\n$$\n这些是均匀自由流速度场的曲线分量。注意它们是坐标 $\\theta$ 的函数。\n\n其次，我们构建并计算简单的非守恒变换径向对流残差 $S_r(r,\\theta)$。问题陈述指出，这是通过将沿速度矢量的方向导数应用于标量径向速度分量 $u_r$，同时错误地将基矢量视为常数来形成的。这对应于计算 $(\\vec{V} \\cdot \\nabla) u_r$。\n\n在极坐标中，梯度算子 $\\nabla$ 由下式给出：\n$$\n\\nabla = \\hat{e}_r \\frac{\\partial}{\\partial r} + \\hat{e}_\\theta \\frac{1}{r} \\frac{\\partial}{\\partial \\theta}\n$$\n速度矢量为 $\\vec{V} = u_r \\hat{e}_r + u_\\theta \\hat{e}_\\theta$。因此，对流算子，或沿 $\\vec{V}$ 的方向导数是：\n$$\n\\vec{V} \\cdot \\nabla = (u_r \\hat{e}_r + u_\\theta \\hat{e}_\\theta) \\cdot \\left( \\hat{e}_r \\frac{\\partial}{\\partial r} + \\hat{e}_\\theta \\frac{1}{r} \\frac{\\partial}{\\partial \\theta} \\right) = u_r \\frac{\\partial}{\\partial r} + \\frac{u_\\theta}{r} \\frac{\\partial}{\\partial \\theta}\n$$\n简单的径向残差 $S_r$ 是将此算子应用于标量场 $u_r(r,\\theta)$：\n$$\nS_r(r,\\theta) = (\\vec{V} \\cdot \\nabla) u_r = u_r \\frac{\\partial u_r}{\\partial r} + \\frac{u_\\theta}{r} \\frac{\\partial u_r}{\\partial \\theta}\n$$\n为了计算此表达式，我们需要 $u_r = U_0 \\cos\\theta$ 的偏导数：\n$$\n\\frac{\\partial u_r}{\\partial r} = \\frac{\\partial}{\\partial r} (U_0 \\cos\\theta) = 0\n$$\n$$\n\\frac{\\partial u_r}{\\partial \\theta} = \\frac{\\partial}{\\partial \\theta} (U_0 \\cos\\theta) = -U_0 \\sin\\theta\n$$\n将分量 $u_r$、$u_\\theta$ 和偏导数代入 $S_r$ 的表达式中：\n$$\nS_r(r,\\theta) = (U_0 \\cos\\theta)(0) + \\frac{-U_0 \\sin\\theta}{r} (-U_0 \\sin\\theta)\n$$\n$$\nS_r(r,\\theta) = \\frac{U_0^2 \\sin^2\\theta}{r}\n$$\n这个非零残差是错误变换过程的人为产物。对于均匀流，物质加速度的所有分量都必须恒等于零。\n\n第三，我们指出这种简单的做法所忽略的导数。正确的物质加速度径向分量 $a_r$ 是完整矢量导数 $(\\vec{V} \\cdot \\nabla)\\vec{V}$ 的径向分量。这种简单的做法错误在于没有对完整矢量表达式 $\\vec{V} = u_r \\hat{e}_r + u_\\theta \\hat{e}_\\theta$ 应用微分的乘法法则。完整的导数是：\n$$\n(\\vec{V} \\cdot \\nabla)\\vec{V} = (\\vec{V} \\cdot \\nabla) (u_r \\hat{e}_r + u_\\theta \\hat{e}_\\theta) = [(\\vec{V} \\cdot \\nabla)u_r] \\hat{e}_r + [(\\vec{V} \\cdot \\nabla)u_\\theta] \\hat{e}_\\theta + u_r [(\\vec{V} \\cdot \\nabla)\\hat{e}_r] + u_theta [(\\vec{V} \\cdot \\nabla)\\hat{e}_\\theta]\n$$\n这种简单的做法只考虑了 $[(\\vec{V} \\cdot \\nabla)u_r] \\hat{e}_r$ 项，其标量部分是 $S_r$。被忽略的项之所以产生，是因为基矢量 $\\hat{e}_r$ 和 $\\hat{e}_\\theta$ 本身是位置（具体来说是 $\\theta$）的函数，因此具有非零的空间导数。被忽略的导数正是基矢量的导数，即 $(\\vec{V} \\cdot \\nabla)\\hat{e}_r$ 和 $(\\vec{V} \\cdot \\nabla)\\hat{e}_\\theta$。\n具体来说，基矢量的关键导数是：\n$$\n\\frac{\\partial \\hat{e}_r}{\\partial \\theta} = \\frac{\\partial}{\\partial \\theta} (\\cos\\theta \\hat{i} + \\sin\\theta \\hat{j}) = -\\sin\\theta \\hat{i} + \\cos\\theta \\hat{j} = \\hat{e}_\\theta\n$$\n类似地，$\\frac{\\partial \\hat{e}_\\theta}{\\partial \\theta} = -\\hat{e}_r$。这种简单的做法错误地假设这些导数为零。这些项通常被称为“度规项”或与克里斯托费尔符号相关，它们说明了坐标线的曲率。加速度的径向分量 $a_r$ 的正确表达式为：\n$$\na_r = u_r \\frac{\\partial u_r}{\\partial r} + \\frac{u_\\theta}{r} \\frac{\\partial u_r}{\\partial \\theta} - \\frac{u_\\theta^2}{r}\n$$\n$-\\frac{u_\\theta^2}{r}$ 项直接源于基矢量的导数。我们可以验证，对于均匀自由流，真实的加速度为零：\n$$\na_r = S_r - \\frac{u_\\theta^2}{r} = \\frac{U_0^2 \\sin^2\\theta}{r} - \\frac{(-U_0 \\sin\\theta)^2}{r} = \\frac{U_0^2 \\sin^2\\theta}{r} - \\frac{U_0^2 \\sin^2\\theta}{r} = 0\n$$\n因此，这种简单的做法之所以失败，是因为它忽略了曲线基矢量的空间导数，违反了矢量的微分乘法法则，并导致了一个虚假的、非零的加速度。", "answer": "$$\n\\boxed{\\frac{U_0^2 \\sin^2\\theta}{r}}\n$$", "id": "3298873"}, {"introduction": "最后的实践将理论与计算现实联系起来。通过编程实现并比较连续性方程的守恒形式与非守恒形式，你将通过数值实验证明几何守恒律（Geometric Conservation Law, GCL）的重要性 [@problem_id:3298902]。这项编码练习揭示了为何只有经过严谨变换的守恒格式才能在任意曲线网格上保证质量守恒，这是所有可靠CFD求解器的基石。", "problem": "在计算流体力学（CFD）中，守恒性质取决于在曲线映射下如何处理变换后的导数。考虑一个二维周期性计算域 $\\{(\\xi,\\eta)\\mid \\xi\\in[0,2\\pi),\\ \\eta\\in[0,2\\pi)\\}$，其中角度以弧度为单位。一个从计算坐标 $(\\xi,\\eta)$ 到物理坐标 $(x,y)$ 的光滑曲线映射由光滑函数 $x(\\xi,\\eta)$ 和 $y(\\xi,\\eta)$ 定义，并且该映射的雅可比行列式 $J(\\xi,\\eta)$ 处处满足 $J(\\xi,\\eta)\\neq 0$。设标量场为 $\\phi(x,y)$，物理速度场为 $\\boldsymbol{u}(x,y)=(u_x(x,y),u_y(x,y))$。连续性方程通过质量通量的散度 $\\nabla\\cdot(\\phi\\boldsymbol{u})$ 来表达质量守恒。为了在任意光滑网格映射下保持质量守恒，向计算坐标的正确变换必须遵守几何守恒律（GCL）。\n\n仅从适用于此背景的第一性原理出发，即：(i) 散度的定义，(ii) 用于乘积和坐标变换的链式法则，(iii) 雅可比行列式的定义及光滑映射下的度量关系，以及 (iv) 适用于周期性域的散度定理，您必须：\n\n- 推导所需的变换关系，以使用关于 $\\xi$ 和 $\\eta$ 的计算导数和适当的度量量来表示 $\\nabla\\cdot(\\phi\\boldsymbol{u})$。从第一性原理出发解释，为什么一个在离散层面上以守恒形式处理散度的公式对应于通量差的伸缩求和，从而在周期性域上保持质量积分守恒，而一个天真分割的非守恒链式法则处理方法在非正交映射下可能违反此性质。\n\n- 实现一个程序，在 $(\\xi,\\eta)$ 的均匀周期性网格上，对两种公式使用 $(\\xi,\\eta)$ 中的二阶中心差分来数值计算积分质量缺陷\n$$\n\\mathcal{M}=\\iint_{[0,2\\pi)\\times[0,2\\pi)} J(\\xi,\\eta)\\,\\nabla\\cdot(\\phi\\boldsymbol{u})\\ d\\xi\\,d\\eta\n$$\n    1. 一种守恒的变换散度，它将导数应用于计算空间中的组合通量，并在周期性边界条件下遵守通量伸缩求和。\n    2. 一种刻意简化的非守恒分割，它通过解耦的坐标缩放来近似 $\\nabla\\cdot\\boldsymbol{u}$ 和 $\\nabla\\phi$，具体来说，将 $\\partial/\\partial x$ 视为 $(1/x_\\xi)\\,\\partial/\\partial \\xi$，将 $\\partial/\\partial y$ 视为 $(1/y_\\eta)\\,\\partial/\\partial \\eta$，并忽略由 $x_\\eta$ 和 $y_\\xi$ 引起的交叉导数耦合。已知这种简化分割在非正交映射下是不正确的，但可用于构造一个反例。\n\n您的程序必须使用以下科学上真实且自洽的光滑场测试套件：\n\n- 由曲率振幅 $\\kappa$ 参数化的映射族：\n$$\nx(\\xi,\\eta)=\\xi+\\kappa\\sin(\\xi)\\sin(\\eta),\\qquad y(\\xi,\\eta)=\\eta+\\kappa\\cos(\\xi)\\sin(\\eta),\n$$\n具有相应的光滑导数 $x_\\xi(\\xi,\\eta)$、$x_\\eta(\\xi,\\eta)$、$y_\\xi(\\xi,\\eta)$、$y_\\eta(\\xi,\\eta)$ 和雅可比行列式 $J(\\xi,\\eta)=x_\\xi y_\\eta - x_\\eta y_\\xi$。\n\n- 由流函数 $\\psi(x,y)=\\sin(x)\\sin(y)$ 定义的速度，因此\n$u_x(x,y)=\\frac{\\partial\\psi}{\\partial y}(x,y)=\\cos(y)\\sin(x)$，以及 $u_y(x,y)=-\\frac{\\partial\\psi}{\\partial x}(x,y)=-\\cos(x)\\sin(y)$。\n这在 $(x,y)$ 中产生一个物理上无散的速度。\n\n- 标量场\n$$\n\\phi(x,y)=1+\\alpha\\cos(2x)\\sin(y),\n$$\n其中振幅 $\\alpha$ 由每个测试用例指定。\n\n在均匀计算网格上使用二阶中心差分来近似关于 $\\xi$ 和 $\\eta$ 的导数，并强制执行周期性边界条件。\n\n对于每个测试用例，计算并报告两个浮点数：分别是守恒公式和简化的非守恒分割的积分质量缺陷 $\\mathcal{M}$ 的绝对值。数值上将积分计算为离散和\n$$\n\\mathcal{M}\\approx \\sum_{i=0}^{N_\\xi-1}\\sum_{j=0}^{N_\\eta-1} J_{ij}\\,\\left[\\nabla\\cdot(\\phi\\boldsymbol{u})\\right]_{ij}\\ \\Delta\\xi\\ \\Delta\\eta,\n$$\n其中 $N_\\xi$ 和 $N_\\eta$ 是 $\\xi$ 和 $\\eta$ 方向上的网格点数，$\\Delta\\xi=2\\pi/N_\\xi$，$\\Delta\\eta=2\\pi/N_\\eta$。角度以弧度为单位。\n\n测试套件参数值：\n\n- 用例 1（基准正交映射）：$N_\\xi=N_\\eta=64$，$\\kappa=0$，$\\alpha=0.2$。\n- 用例 2（中等曲率映射）：$N_\\xi=N_\\eta=64$，$\\kappa=0.3$，$\\alpha=0.2$。\n- 用例 3（强曲率粗网格）：$N_\\xi=N_\\eta=16$，$\\kappa=0.7$，$\\alpha=0.5$。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表的列表形式的结果，每个内部列表包含守恒和简化的非守恒质量缺陷的两个浮点数，按顺序对应三个用例，并四舍五入到十位小数。例如，打印的行必须是以下形式\n$$\n[[m_{c,1},m_{n,1}],[m_{c,2},m_{n,2}],[m_{c,3},m_{n,3}]],\n$$\n其中每个 $m_{(\\cdot,\\cdot)}$ 是一个四舍五入到十位小数的浮点数。", "solution": "该问题要求推导在坐标变换下散度算子的守恒形式，并通过数值方法证明其对于质量守恒的重要性，并与一种简化的非守恒近似方法进行比较。验证过程确认了问题陈述在科学上是合理的、适定的和客观的。我们着手求解。\n\n核心任务是将物理空间中的连续性方程（由质量通量的散度 $\\nabla\\cdot(\\phi\\boldsymbol{u})$ 表示）变换到计算空间 $(\\xi, \\eta)$ 中。\n\n在笛卡尔坐标 $(x,y)$ 中，质量通量矢量 $\\phi\\boldsymbol{u} = (\\phi u_x, \\phi u_y)$ 的散度定义为：\n$$\n\\nabla\\cdot(\\phi\\boldsymbol{u}) = \\frac{\\partial(\\phi u_x)}{\\partial x} + \\frac{\\partial(\\phi u_y)}{\\partial y}\n$$\n\n一个从计算坐标 $(\\xi, \\eta)$ 到物理坐标 $(x,y)$ 的光滑、可逆的映射由函数 $x(\\xi,\\eta)$ 和 $y(\\xi,\\eta)$ 给出。链式法则提供了两个坐标系中偏导数算子之间的关系：\n$$\n\\begin{pmatrix} \\partial/\\partial\\xi \\\\ \\partial/\\partial\\eta \\end{pmatrix}\n=\n\\begin{pmatrix} x_\\xi  y_\\xi \\\\ x_\\eta  y_\\eta \\end{pmatrix}\n\\begin{pmatrix} \\partial/\\partial x \\\\ \\partial/\\partial y \\end{pmatrix}\n$$\n其中 $x_\\xi = \\partial x/\\partial\\xi$，$y_\\xi = \\partial y/\\partial\\xi$，依此类推。为了用计算空间导数表示物理空间导数，我们必须对该矩阵关系求逆。变换矩阵的行列式是雅可比行列式 $J = x_\\xi y_\\eta - x_\\eta y_\\xi$，根据题意其不为零。逆变换为：\n$$\n\\begin{pmatrix} \\partial/\\partial x \\\\ \\partial/\\partial y \\end{pmatrix}\n=\n\\frac{1}{J}\n\\begin{pmatrix} y_\\eta  -y_\\xi \\\\ -x_\\eta  x_\\xi \\end{pmatrix}\n\\begin{pmatrix} \\partial/\\partial\\xi \\\\ \\partial/\\partial\\eta \\end{pmatrix}\n$$\n这为导数算子提供了度量关系：\n$$\n\\frac{\\partial}{\\partial x} = \\frac{1}{J} \\left( y_\\eta \\frac{\\partial}{\\partial \\xi} - y_\\xi \\frac{\\partial}{\\partial \\eta} \\right)\n\\qquad \\text{和} \\qquad\n\\frac{\\partial}{\\partial y} = \\frac{1}{J} \\left( -x_\\eta \\frac{\\partial}{\\partial \\xi} + x_\\xi \\frac{\\partial}{\\partial \\eta} \\right)\n$$\n\n将这些关系代入散度表达式，得到：\n$$\n\\nabla\\cdot(\\phi\\boldsymbol{u}) = \\frac{1}{J} \\left( y_\\eta \\frac{\\partial(\\phi u_x)}{\\partial \\xi} - y_\\xi \\frac{\\partial(\\phi u_x)}{\\partial \\eta} \\right) + \\frac{1}{J} \\left( -x_\\eta \\frac{\\partial(\\phi u_y)}{\\partial \\xi} + x_\\xi \\frac{\\partial(\\phi u_y)}{\\partial \\eta} \\right)\n$$\n两边乘以雅可比行列式 $J$ 并根据导数算子重新整理各项：\n$$\nJ\\,\\nabla\\cdot(\\phi\\boldsymbol{u}) = \\left( y_\\eta \\frac{\\partial(\\phi u_x)}{\\partial \\xi} - x_\\eta \\frac{\\partial(\\phi u_y)}{\\partial \\xi} \\right) + \\left( x_\\xi \\frac{\\partial(\\phi u_y)}{\\partial \\eta} - y_\\xi \\frac{\\partial(\\phi u_x)}{\\partial \\eta} \\right)\n$$\n使用乘积法则，例如 $y_\\eta \\frac{\\partial(\\phi u_x)}{\\partial \\xi} = \\frac{\\partial}{\\partial \\xi}(y_\\eta \\phi u_x) - (\\phi u_x) \\frac{\\partial y_\\eta}{\\partial \\xi}$，我们可以重写表达式，将各项组合到导数内部：\n$$\nJ\\,\\nabla\\cdot(\\phi\\boldsymbol{u}) = \\frac{\\partial}{\\partial \\xi}\\left( \\phi (u_x y_\\eta - u_y x_\\eta) \\right) + \\frac{\\partial}{\\partial \\eta}\\left( \\phi (u_y x_\\xi - u_x y_\\xi) \\right) + \\mathcal{R}\n$$\n其中余项 $\\mathcal{R}$ 包含度量项的导数：\n$$\n\\mathcal{R} = -\\phi u_x \\frac{\\partial y_\\eta}{\\partial \\xi} + \\phi u_y \\frac{\\partial x_\\eta}{\\partial \\xi} - \\phi u_y \\frac{\\partial x_\\xi}{\\partial \\eta} + \\phi u_x \\frac{\\partial y_\\xi}{\\partial \\eta} = \\phi u_x \\left( \\frac{\\partial y_\\xi}{\\partial \\eta} - \\frac{\\partial y_\\eta}{\\partial \\xi} \\right) + \\phi u_y \\left( \\frac{\\partial x_\\eta}{\\partial \\xi} - \\frac{\\partial x_\\xi}{\\partial \\eta} \\right)\n$$\n对于光滑映射，求导次序无关（关于混合偏导数相等的Clairaut定理），因此 $\\partial y_\\xi/\\partial \\eta = \\partial^2 y/\\partial\\eta\\partial\\xi = \\partial^2 y/\\partial\\xi\\partial\\eta = \\partial y_\\eta/\\partial\\xi$，对 $x$ 也类似。因此，括号中的项恒等于零，所以 $\\mathcal{R}=0$。这个关键结果被称为几何守恒律（GCL）恒等式。\n\n最终表达式是强守恒形式的散度：\n$$\nJ\\,\\nabla\\cdot(\\phi\\boldsymbol{u}) = \\frac{\\partial}{\\partial \\xi}\\left( F_\\xi \\right) + \\frac{\\partial}{\\partial \\eta}\\left( F_\\eta \\right)\n$$\n其中 $F_\\xi = \\phi(u_x y_\\eta - u_y x_\\eta)$ 和 $F_\\eta = \\phi(u_y x_\\xi - u_x y_\\xi)$ 是计算 $(\\xi, \\eta)$ 方向上的守恒质量通量。\n\n积分质量缺陷为 $\\mathcal{M}=\\iint J(\\xi,\\eta)\\,\\nabla\\cdot(\\phi\\boldsymbol{u})\\ d\\xi\\,d\\eta$，积分范围是周期性域 $[0,2\\pi)\\times[0,2\\pi)$。使用守恒形式：\n$$\n\\mathcal{M} = \\int_0^{2\\pi} \\int_0^{2\\pi} \\left(\\frac{\\partial F_\\xi}{\\partial \\xi} + \\frac{\\partial F_\\eta}{\\partial \\eta}\\right) d\\xi\\,d\\eta\n$$\n根据微积分基本定理和所有场的周期性（例如，$F_\\xi(\\xi=0, \\eta) = F_\\xi(\\xi=2\\pi, \\eta)$），一个全导数在一个周期区间上的积分为零。因此，解析上 $\\mathcal{M}=0$。\n\n在离散层面上，使用中心差分等格式近似导数，$\\left(\\frac{\\partial F}{\\partial\\xi}\\right)_i \\approx \\frac{F_{i+1} - F_{i-1}}{2\\Delta\\xi}$，在周期性网格上对所有这些导数求和会得到一个伸缩求和。对于任意网格行 $j$：\n$$\n\\sum_{i=0}^{N_\\xi-1} \\left(\\frac{\\partial F_\\xi}{\\partial \\xi}\\right)_{ij} \\approx \\frac{1}{2\\Delta\\xi} \\sum_{i=0}^{N_\\xi-1} ( (F_\\xi)_{i+1,j} - (F_\\xi)_{i-1,j} ) = 0\n$$\n这是由于周期性边界条件下的抵消（例如，$F_{-1,j} = F_{N_\\xi-1, j}$ 和 $F_{N_\\xi,j} = F_{0,j}$）。这种“通量伸缩求和”特性确保了在整个域上的离散和在机器精度范围内为零，从而在离散层面上保持质量守恒。这是一个守恒数值格式的标志。\n\n相反，指定的简化的非守恒分割将散度近似为：\n$$\n[\\nabla\\cdot(\\phi\\boldsymbol{u})]_{\\text{naive}} = \\frac{1}{x_\\xi} \\frac{\\partial(\\phi u_x)}{\\partial \\xi} + \\frac{1}{y_\\eta} \\frac{\\partial(\\phi u_y)}{\\partial \\eta}\n$$\n这个公式错误地假设网格是正交的，忽略了度量项 $x_\\eta$ 和 $y_\\xi$。积分变为：\n$$\n\\mathcal{M}_{\\text{naive}} = \\iint J \\left( \\frac{1}{x_\\xi} \\frac{\\partial(\\phi u_x)}{\\partial \\xi} + \\frac{1}{y_\\eta} \\frac{\\partial(\\phi u_y)}{\\partial \\eta} \\right) d\\xi\\,d\\eta\n$$\n该表达式不能写成守恒（或散度）形式。例如，积分内的项是 $\\frac{J}{x_\\xi}\\frac{\\partial(\\phi u_x)}{\\partial \\xi}$。分部积分会产生一个因周期性而消失的边界项，但也会产生一个源项 $-\\iint (\\phi u_x) \\frac{\\partial}{\\partial\\xi}\\left(\\frac{J}{x_\\xi}\\right) d\\xi d\\eta$，该源项不保证为零。当网格非正交时（即 $\\kappa \\neq 0$），度量系数 $J$、$x_\\xi$ 等不是常数，这个积分将不为零，导致虚假的数值质量生成或耗散。这种形式唯一正确的情况是当映射是正交的，即 $x=x(\\xi), y=y(\\eta)$，对于所给的族来说，这意味着 $\\kappa=0$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef central_diff(field: np.ndarray, axis: int, delta: float) -> np.ndarray:\n    \"\"\"\n    Computes the second-order central difference of a 2D array along a given axis,\n    assuming periodic boundary conditions.\n\n    Args:\n        field: The 2D numpy array.\n        axis: The axis along which to differentiate (0 for xi, 1 for eta).\n        delta: The grid spacing in that direction.\n\n    Returns:\n        A 2D numpy array of the computed derivatives.\n    \"\"\"\n    return (np.roll(field, -1, axis=axis) - np.roll(field, 1, axis=axis)) / (2.0 * delta)\n\ndef compute_mass_defect(N: int, kappa: float, alpha: float) -> list[float]:\n    \"\"\"\n    Computes the integral mass defect for both conservative and naive formulations.\n\n    Args:\n        N: The number of grid points in each direction (N_xi = N_eta = N).\n        kappa: The curvature amplitude of the grid mapping.\n        alpha: The amplitude of the scalar field.\n\n    Returns:\n        A list containing two floats: the absolute mass defect for the\n        conservative and naive formulations, rounded to 10 decimal places.\n    \"\"\"\n    # 1. Grid Setup\n    N_xi, N_eta = N, N\n    d_xi = 2.0 * np.pi / N_xi\n    d_eta = 2.0 * np.pi / N_eta\n\n    xi_1d = np.linspace(0.0, 2.0 * np.pi, N_xi, endpoint=False)\n    eta_1d = np.linspace(0.0, 2.0 * np.pi, N_eta, endpoint=False)\n    # 'ij' indexing ensures that xi corresponds to axis 0 and eta to axis 1.\n    xi, eta = np.meshgrid(xi_1d, eta_1d, indexing='ij')\n\n    # 2. Compute Mapping, Metrics, and Physical Fields\n    # Mapping to physical coordinates\n    x = xi + kappa * np.sin(xi) * np.sin(eta)\n    y = eta + kappa * np.cos(xi) * np.sin(eta)\n\n    # Analytical metric terms\n    x_xi = 1.0 + kappa * np.cos(xi) * np.sin(eta)\n    x_eta = kappa * np.sin(xi) * np.cos(eta)\n    y_xi = -kappa * np.sin(xi) * np.sin(eta)\n    y_eta = 1.0 + kappa * np.cos(xi) * np.cos(eta)\n    \n    # Jacobian determinant\n    J = x_xi * y_eta - x_eta * y_xi\n\n    # Physical fields evaluated on the grid\n    phi = 1.0 + alpha * np.cos(2.0 * x) * np.sin(y)\n    u_x = np.sin(x) * np.cos(y)\n    u_y = -np.cos(x) * np.sin(y)\n\n    # 3. Conservative Formulation\n    # Transformed conservative mass fluxes\n    F_xi = phi * (u_x * y_eta - u_y * x_eta)\n    F_eta = phi * (u_y * x_xi - u_x * y_xi)\n\n    # Compute derivatives of fluxes\n    dFxi_dxi = central_diff(F_xi, axis=0, delta=d_xi)\n    dFeta_deta = central_diff(F_eta, axis=1, delta=d_eta)\n    \n    # The term J * div(phi*u) is exactly dFxi/dxi + dFeta/deta\n    integrand_c = dFxi_dxi + dFeta_deta\n    \n    # Integrate by summing over the domain and multiplying by cell area\n    M_c = np.sum(integrand_c) * d_xi * d_eta\n\n    # 4. Naive Nonconservative Formulation\n    # Physical mass fluxes\n    f_x = phi * u_x\n    f_y = phi * u_y\n\n    # Differentiate physical fluxes w.r.t. computational coordinates\n    dfx_dxi = central_diff(f_x, axis=0, delta=d_xi)\n    dfy_deta = central_diff(f_y, axis=1, delta=d_eta)\n    \n    # Construct the naive divergence approximation\n    naive_div = (1.0 / x_xi) * dfx_dxi + (1.0 / y_eta) * dfy_deta\n    \n    # The integrand is J * (naive divergence)\n    integrand_n = J * naive_div\n    \n    # Integrate by summing\n    M_n = np.sum(integrand_n) * d_xi * d_eta\n    \n    return [round(abs(M_c), 10), round(abs(M_n), 10)]\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, kappa, alpha)\n        (64, 0.0, 0.2), # Case 1: Baseline orthogonal mapping\n        (64, 0.3, 0.2), # Case 2: Moderate curvature mapping\n        (16, 0.7, 0.5), # Case 3: Strong curvature, coarse grid\n    ]\n\n    results = []\n    for N, kappa, alpha in test_cases:\n        result = compute_mass_defect(N, kappa, alpha)\n        results.append(result)\n\n    # Format the output string exactly as specified.\n    outer_list_str = []\n    for res_pair in results:\n        # Format each float to 10 decimal places.\n        inner_list_str = f\"[{res_pair[0]:.10f},{res_pair[1]:.10f}]\"\n        outer_list_str.append(inner_list_str)\n    \n    final_output = f\"[{','.join(outer_list_str)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "3298902"}]}