{"hands_on_practices": [{"introduction": "我们从有限体积方法的基本构造单元——单个控制体——开始。本练习旨在探索几何守恒律 (Geometric Conservation Law, GCL) 的离散形式，即一个封闭控制体的所有外向面矢量之和必须为零。通过为一个映射后的四边形单元手动计算这些矢量，并验证一个恒定矢量场的离散散度为零，您将对这一几何恒等式如何确保“自由流保持”特性获得具体理解——这是任何有效的计算流体力学 (CFD) 格式都必须具备的关键属性 [@problem_id:3324582]。", "problem": "考虑一个二维曲线控制体，它是通过从计算方块 $[0,1] \\times [0,1]$ 到物理空间中一个凸四边形的双线性映射得到的。该映射 $\\mathbf{x}(\\xi,\\eta) = \\left(x(\\xi,\\eta), y(\\xi,\\eta)\\right)$ 由四个角点的双线性插值定义\n$$\n\\mathbf{x}_{1} = (0,0),\\quad \\mathbf{x}_{2} = (2, \\tfrac{1}{2}),\\quad \\mathbf{x}_{3} = \\left(\\tfrac{11}{5}, \\tfrac{9}{5}\\right),\\quad \\mathbf{x}_{4} = \\left(-\\tfrac{2}{5}, \\tfrac{7}{5}\\right),\n$$\n这些角点分别对应于 $(\\xi,\\eta) = (0,0)$、$(\\xi,\\eta) = (1,0)$、$(\\xi,\\eta) = (1,1)$ 和 $(\\xi,\\eta) = (0,1)$。所有量均为无量纲。\n\n仅从守恒的积分形式和基本几何关系出发，完成以下任务：\n\n1) 写出对于 $i \\in \\{1,2,3,4\\}$ 的双线性形函数 $N_{i}(\\xi,\\eta)$ 以及相应的映射 $\\mathbf{x}(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\,\\mathbf{x}_{i}$。\n\n2) 使用二维面面积矢量 $\\mathbf{S}_{f}$ 的定义，即沿每个面的外法向单位矢量与微分弧长的积分，从第一性原理推导出一个用每个直面端点表示 $\\mathbf{S}_{f}$ 的表达式。显式计算南、东、北、西四个面（分别记为 $\\mathbf{S}_{s}$、$\\mathbf{S}_{e}$、$\\mathbf{S}_{n}$ 和 $\\mathbf{S}_{w}$）的面面积矢量，其中控制体边界从 $\\mathbf{x}_{1}$ 开始，沿逆时针方向经过 $\\mathbf{x}_{2}$、$\\mathbf{x}_{3}$、$\\mathbf{x}_{4}$，最后回到 $\\mathbf{x}_{1}$。\n\n3) 对于恒定矢量场 $\\mathbf{a} = (3,-1)^{\\top}$，计算有限体积离散散度\n$$\n\\left(\\nabla \\cdot \\mathbf{a}\\right)_{\\text{disc}} \\equiv \\frac{1}{A} \\sum_{f \\in \\{s,e,n,w\\}} \\mathbf{a} \\cdot \\mathbf{S}_{f},\n$$\n其中 $A$ 是映射后四边形的物理面积。将此离散散度计算为一个实数值。\n\n4) 根据您的计算，说明此双线性单元是否满足度量恒等式，并从几何一致性和自由来流保持的角度简要论证您的结论。\n\n给出最终的离散散度，结果为一个实数。无需四舍五入，最终答案不应包含单位。", "solution": "该问题经检验在科学上是合理的、适定的和客观的。它提出了一个计算流体动力学中的标准练习，涉及映射网格上有限体积离散化的性质。所有必要的数据和定义均已提供。我们可以开始解题。\n\n按照题目要求，解答分为四个部分。\n\n1) 双线性形函数与映射\n\n对于由 $(\\xi, \\eta) \\in [0,1] \\times [0,1]$ 定义的单位正方形计算域，双线性形函数 $N_i(\\xi, \\eta)$ 的定义为：在角点 $i$ 处 $N_i$ 等于 $1$，在所有其他角点处等于 $0$。它们由以下公式给出：\n- $N_1(\\xi, \\eta) = (1-\\xi)(1-\\eta)$，对应于 $(\\xi, \\eta) = (0,0)$ 处的角点1。\n- $N_2(\\xi, \\eta) = \\xi(1-\\eta)$，对应于 $(\\xi, \\eta) = (1,0)$ 处的角点2。\n- $N_3(\\xi, \\eta) = \\xi\\eta$，对应于 $(\\xi, \\eta) = (1,1)$ 处的角点3。\n- $N_4(\\xi, \\eta) = (1-\\xi)\\eta$，对应于 $(\\xi, \\eta) = (0,1)$ 处的角点4。\n\n从计算空间 $(\\xi, \\eta)$ 到物理空间 $\\mathbf{x} = (x,y)$ 的映射是四个角点 $\\mathbf{x}_1, \\mathbf{x}_2, \\mathbf{x}_3, \\mathbf{x}_4$ 的双线性插值：\n$$\n\\mathbf{x}(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) \\mathbf{x}_i\n$$\n代入形函数，可得：\n$$\n\\mathbf{x}(\\xi, \\eta) = (1-\\xi)(1-\\eta)\\mathbf{x}_1 + \\xi(1-\\eta)\\mathbf{x}_2 + \\xi\\eta\\mathbf{x}_3 + (1-\\xi)\\eta\\mathbf{x}_4\n$$\n其中给定的角点坐标为 $\\mathbf{x}_{1} = (0,0)$、$\\mathbf{x}_{2} = (2, \\frac{1}{2})$、$\\mathbf{x}_{3} = (\\frac{11}{5}, \\frac{9}{5})$ 和 $\\mathbf{x}_{4} = (-\\frac{2}{5}, \\frac{7}{5})$。\n\n2) 面面积矢量\n\n二维面 $f$ 的面面积矢量 $\\mathbf{S}_f$ 定义为外法向单位矢量 $\\mathbf{n}$ 沿该面弧长 $s$ 的积分：\n$$\n\\mathbf{S}_f = \\int_{f} \\mathbf{n} \\, ds\n$$\n问题指定了一个四边形，其各面均为直线段。考虑一个从点 $\\mathbf{x}_A = (x_A, y_A)$ 到点 $\\mathbf{x}_B = (x_B, y_B)$ 的直面。沿该面的矢量位移为 $\\Delta\\mathbf{x} = \\mathbf{x}_B - \\mathbf{x}_A = (\\Delta x, \\Delta y)$，其中 $\\Delta x = x_B - x_A$ 且 $\\Delta y = y_B - y_A$。该面的长度为 $L = |\\Delta\\mathbf{x}| = \\sqrt{(\\Delta x)^2 + (\\Delta y)^2}$。\n\n从 $A$ 到 $B$ 沿该面的单位切向矢量是 $\\mathbf{t} = \\frac{\\Delta\\mathbf{x}}{L} = (\\frac{\\Delta x}{L}, \\frac{\\Delta y}{L})$。对于控制体边界的逆时针遍历，外法向矢量 $\\mathbf{n}$ 是通过将切向矢量 $\\mathbf{t}$ 旋转-90度得到的。这个旋转将一个矢量 $(v_x, v_y)$ 变换为 $(v_y, -v_x)$。因此，外法向单位矢量为：\n$$\n\\mathbf{n} = \\left(\\frac{\\Delta y}{L}, -\\frac{\\Delta x}{L}\\right)\n$$\n由于该面是直线，法向矢量 $\\mathbf{n}$ 沿其是恒定的。积分简化为：\n$$\n\\mathbf{S}_f = \\mathbf{n} \\int_{f} ds = \\mathbf{n} L = \\left(\\frac{\\Delta y}{L}, -\\frac{\\Delta x}{L}\\right) L = (\\Delta y, -\\Delta x)\n$$\n所以，对于一个从 $\\mathbf{x}_A$ 到 $\\mathbf{x}_B$ 的面，$\\mathbf{S}_f = (y_B - y_A, x_A - x_B)$。\n\n我们现在按逆时针顺序计算该四边形四个面的面积矢量：\n- **南面 (s)**：从 $\\mathbf{x}_1 = (0,0)$ 到 $\\mathbf{x}_2 = (2, \\frac{1}{2})$。\n$\\Delta x = 2 - 0 = 2$, $\\Delta y = \\frac{1}{2} - 0 = \\frac{1}{2}$。\n$\\mathbf{S}_s = (\\Delta y, -\\Delta x) = (\\frac{1}{2}, -2)$。\n\n- **东面 (e)**：从 $\\mathbf{x}_2 = (2, \\frac{1}{2})$ 到 $\\mathbf{x}_3 = (\\frac{11}{5}, \\frac{9}{5})$。\n$\\Delta x = \\frac{11}{5} - 2 = \\frac{11-10}{5} = \\frac{1}{5}$, $\\Delta y = \\frac{9}{5} - \\frac{1}{2} = \\frac{18-5}{10} = \\frac{13}{10}$。\n$\\mathbf{S}_e = (\\Delta y, -\\Delta x) = (\\frac{13}{10}, -\\frac{1}{5})$。\n\n- **北面 (n)**：从 $\\mathbf{x}_3 = (\\frac{11}{5}, \\frac{9}{5})$ 到 $\\mathbf{x}_4 = (-\\frac{2}{5}, \\frac{7}{5})$。\n$\\Delta x = -\\frac{2}{5} - \\frac{11}{5} = -\\frac{13}{5}$, $\\Delta y = \\frac{7}{5} - \\frac{9}{5} = -\\frac{2}{5}$。\n$\\mathbf{S}_n = (\\Delta y, -\\Delta x) = (-\\frac{2}{5}, -(-\\frac{13}{5})) = (-\\frac{2}{5}, \\frac{13}{5})$。\n\n- **西面 (w)**：从 $\\mathbf{x}_4 = (-\\frac{2}{5}, \\frac{7}{5})$ 到 $\\mathbf{x}_1 = (0,0)$。\n$\\Delta x = 0 - (-\\frac{2}{5}) = \\frac{2}{5}$, $\\Delta y = 0 - \\frac{7}{5} = -\\frac{7}{5}$。\n$\\mathbf{S}_w = (\\Delta y, -\\Delta x) = (-\\frac{7}{5}, -\\frac{2}{5})$。\n\n3) 离散散度计算\n\n恒定矢量场 $\\mathbf{a}$ 的离散散度由下式给出：\n$$\n(\\nabla \\cdot \\mathbf{a})_{\\text{disc}} = \\frac{1}{A} \\sum_{f \\in \\{s,e,n,w\\}} \\mathbf{a} \\cdot \\mathbf{S}_{f}\n$$\n其中 $A$ 是四边形的面积。给定的恒定矢量场是 $\\mathbf{a} = (3, -1)^{\\top}$。我们计算点积之和：\n- $\\mathbf{a} \\cdot \\mathbf{S}_s = (3, -1) \\cdot (\\frac{1}{2}, -2) = 3(\\frac{1}{2}) + (-1)(-2) = \\frac{3}{2} + 2 = \\frac{7}{2}$。\n- $\\mathbf{a} \\cdot \\mathbf{S}_e = (3, -1) \\cdot (\\frac{13}{10}, -\\frac{1}{5}) = 3(\\frac{13}{10}) + (-1)(-\\frac{1}{5}) = \\frac{39}{10} + \\frac{1}{5} = \\frac{39}{10} + \\frac{2}{10} = \\frac{41}{10}$。\n- $\\mathbf{a} \\cdot \\mathbf{S}_n = (3, -1) \\cdot (-\\frac{2}{5}, \\frac{13}{5}) = 3(-\\frac{2}{5}) + (-1)(\\frac{13}{5}) = -\\frac{6}{5} - \\frac{13}{5} = -\\frac{19}{5}$。\n- $\\mathbf{a} \\cdot \\mathbf{S}_w = (3, -1) \\cdot (-\\frac{7}{5}, -\\frac{2}{5}) = 3(-\\frac{7}{5}) + (-1)(-\\frac{2}{5}) = -\\frac{21}{5} + \\frac{2}{5} = -\\frac{19}{5}$。\n\n总和为：\n$$\n\\sum_{f} \\mathbf{a} \\cdot \\mathbf{S}_{f} = \\frac{7}{2} + \\frac{41}{10} - \\frac{19}{5} - \\frac{19}{5} = \\frac{35}{10} + \\frac{41}{10} - \\frac{38}{10} - \\frac{38}{10} = \\frac{76 - 76}{10} = 0\n$$\n由于总和为 $0$，离散散度为：\n$$\n(\\nabla \\cdot \\mathbf{a})_{\\text{disc}} = \\frac{1}{A} (0) = 0\n$$\n确定最终结果不需要面积 $A$ 的值。离散散度恰好为 $0$。\n\n4) 度量恒等式与论证\n\n闭合控制体的度量恒等式要求所有面面积矢量的和为零矢量：\n$$\n\\sum_{f} \\mathbf{S}_{f} = \\mathbf{0}\n$$\n让我们用第二部分计算出的矢量来验证这个条件。\nx分量之和：\n$$\n\\sum_{f} S_{f,x} = \\frac{1}{2} + \\frac{13}{10} - \\frac{2}{5} - \\frac{7}{5} = \\frac{5}{10} + \\frac{13}{10} - \\frac{4}{10} - \\frac{14}{10} = \\frac{5 + 13 - 4 - 14}{10} = \\frac{18 - 18}{10} = 0\n$$\ny分量之和：\n$$\n\\sum_{f} S_{f,y} = -2 - \\frac{1}{5} + \\frac{13}{5} - \\frac{2}{5} = -\\frac{10}{5} - \\frac{1}{5} + \\frac{13}{5} - \\frac{2}{5} = \\frac{-10 - 1 + 13 - 2}{5} = \\frac{-13 + 13}{5} = 0\n$$\n由于和的两个分量都为零，我们有 $\\sum_{f} \\mathbf{S}_{f} = (0,0) = \\mathbf{0}$。此双线性单元满足度量恒等式。\n\n论证：度量恒等式的满足是各面形成一个闭合环路的直接结果。它是几何恒等式 $\\oint_{\\partial V} \\mathbf{n} \\, dS = \\mathbf{0}$ 的离散模拟。这一性质确保了几何一致性，并且对于实现**自由来流保持**至关重要。对于任何恒定矢量场 $\\mathbf{a}$，其连续散度为 $\\nabla \\cdot \\mathbf{a} = 0$。如果一个数值格式的离散散度算子对任何恒定场也产生零，则称该格式保持自由来流。对于给定的有限体积离散化，我们可以写出：\n$$\n(\\nabla \\cdot \\mathbf{a})_{\\text{disc}} = \\frac{1}{A} \\sum_{f} \\mathbf{a} \\cdot \\mathbf{S}_{f} = \\frac{1}{A} \\left( \\mathbf{a} \\cdot \\sum_{f} \\mathbf{S}_{f} \\right)\n$$\n由于度量恒等式 $\\sum_{f} \\mathbf{S}_{f} = \\mathbf{0}$ 得到满足，因此对于*任何*恒定矢量 $\\mathbf{a}$，都有 $(\\nabla \\cdot \\mathbf{a})_{\\text{disc}} = \\frac{1}{A} (\\mathbf{a} \\cdot \\mathbf{0}) = 0$。第三部分中为特定矢量 $\\mathbf{a} = (3,-1)^{\\top}$ 计算出的结果 $0$ 是对这一普遍原理的证实。此性质得到满足，是因为控制体由连接各顶点的直线段定义，形成了一个闭合多边形。\n\n最终要求的答案是离散散度的数值。根据第三部分的计算，该值为 $0$。", "answer": "$$\n\\boxed{0}\n$$", "id": "3324582"}, {"introduction": "在理解了单个单元的几何特性之后，我们现在来考察网格变换对整个模拟，特别是对数值稳定性的影响。本练习将坐标变换的度量张量（即局部网格拉伸因子）与计算空间中的 Courant–Friedrichs–Lewy (CFL) 条件联系起来。通过推导和计算一个非均匀网格上平流问题的最大稳定时间步长 $\\Delta t$，您将学到物理空间中的网格加密如何导致更严格的稳定性限制，这是一个在计算流体力学中至关重要的实际考量 [@problem_id:3324584]。", "problem": "考虑计算流体动力学（CFD）中的三维被动标量场平流，其在物理空间中由守恒律 $\\frac{\\partial q}{\\partial t} + \\nabla \\cdot (\\boldsymbol{U} q) = 0$ 控制，其中 $q(\\boldsymbol{x}, t)$ 是标量场，$\\boldsymbol{U} = (u, v, w)$ 是一个给定的速度场。物理域 $[0, L_x] \\times [0, L_y] \\times [0, L_z]$ 是通过一一可微映射 $x(\\xi) = L_x \\frac{\\exp(\\alpha_x \\xi) - 1}{\\exp(\\alpha_x) - 1}$，$y(\\eta) = L_y \\frac{\\exp(\\alpha_y \\eta) - 1}{\\exp(\\alpha_y) - 1}$ 和 $z(\\zeta) = L_z \\zeta$ 从计算域 $[0, 1]^3$ 映射得到的，其中 $\\xi, \\eta, \\zeta \\in [0, 1]$。计算网格是结构化且均匀的，网格间距为 $\\Delta \\xi = \\frac{1}{N_{\\xi}}$，$\\Delta \\eta = \\frac{1}{N_{\\eta}}$ 和 $\\Delta \\zeta = \\frac{1}{N_{\\zeta}}$。流场状态是恒定的，为 $\\boldsymbol{U} = (U_0, V_0, W_0)$。数值方法是显式前向欧拉时间积分方法，结合计算空间中映射后的平流方程的一阶迎风离散。从控制守恒律和映射关系出发，基于计算空间中的 Courant–Friedrichs–Lewy (CFL) 条件，推导时间步长 $\\Delta t$ 的稳定性界限，然后计算以下参数下的最大稳定 $\\Delta t$：\n$L_x = 2\\,\\mathrm{m}$，$L_y = 1\\,\\mathrm{m}$，$L_z = 0.5\\,\\mathrm{m}$，$\\alpha_x = 3$，$\\alpha_y = 2$，$U_0 = 30\\,\\mathrm{m/s}$，$V_0 = 10\\,\\mathrm{m/s}$，$W_0 = 5\\,\\mathrm{m/s}$，$N_{\\xi} = 80$，$N_{\\eta} = 60$ 和 $N_{\\zeta} = 40$。将最终的 $\\Delta t_{\\max}$ 以秒为单位表示，并将您的答案四舍五入到四位有效数字。此外，在您的推导过程中，请解释由 $x'(\\xi)$，$y'(\\eta)$ 和 $z'(\\zeta)$ 量化的网格拉伸如何影响计算空间中的稳定性界限。", "solution": "该问题是有效的，因为它在科学上基于计算流体动力学的原理，具有完整且一致的数据集，问题是适定的，并且以客观、正式的语言陈述。我们开始进行解答。\n\n物理空间 $(x, y, z)$ 中被动标量 $q$ 平流的控制方程由以下守恒律给出：\n$$\n\\frac{\\partial q}{\\partial t} + \\nabla \\cdot (\\boldsymbol{U} q) = 0\n$$\n鉴于速度场 $\\boldsymbol{U} = (U_0, V_0, W_0)$ 是恒定的，方程简化为非守恒形式：\n$$\n\\frac{\\partial q}{\\partial t} + U_0 \\frac{\\partial q}{\\partial x} + V_0 \\frac{\\partial q}{\\partial y} + W_0 \\frac{\\partial q}{\\partial z} = 0\n$$\n该问题要求将此方程从物理空间 $(x, y, z)$ 变换到计算空间 $(\\xi, \\eta, \\zeta)$。网格是静止的，因此时间不进行变换，即 $t = \\tau$。坐标变换由下式给出：\n$x(\\xi) = L_x \\frac{\\exp(\\alpha_x \\xi) - 1}{\\exp(\\alpha_x) - 1}$\n$y(\\eta) = L_y \\frac{\\exp(\\alpha_y \\eta) - 1}{\\exp(\\alpha_y) - 1}$\n$z(\\zeta) = L_z \\zeta$\n\n这是一个一维拉伸，其中 $x$ 仅依赖于 $\\xi$，$y$ 仅依赖于 $\\eta$，$z$ 仅依赖于 $\\zeta$。我们对偏导数应用链式法则：\n$\\frac{\\partial q}{\\partial x} = \\frac{d\\xi}{dx} \\frac{\\partial q}{\\partial \\xi} = \\left(\\frac{dx}{d\\xi}\\right)^{-1} \\frac{\\partial q}{\\partial \\xi}$\n$\\frac{\\partial q}{\\partial y} = \\frac{d\\eta}{dy} \\frac{\\partial q}{\\partial \\eta} = \\left(\\frac{dy}{d\\eta}\\right)^{-1} \\frac{\\partial q}{\\partial \\eta}$\n$\\frac{\\partial q}{\\partial z} = \\frac{d\\zeta}{dz} \\frac{\\partial q}{\\partial \\zeta} = \\left(\\frac{dz}{d\\zeta}\\right)^{-1} \\frac{\\partial q}{\\partial \\zeta}$\n\n我们计算变换度量（映射函数的导数）：\n$\\frac{dx}{d\\xi} = x'(\\xi) = L_x \\frac{\\alpha_x \\exp(\\alpha_x \\xi)}{\\exp(\\alpha_x) - 1}$\n$\\frac{dy}{d\\eta} = y'(\\eta) = L_y \\frac{\\alpha_y \\exp(\\alpha_y \\eta)}{\\exp(\\alpha_y) - 1}$\n$\\frac{dz}{d\\zeta} = z'(\\zeta) = L_z$\n\n将这些代入平流方程，得到计算空间中的控制方程：\n$$\n\\frac{\\partial q}{\\partial t} + \\frac{U_0}{x'(\\xi)} \\frac{\\partial q}{\\partial \\xi} + \\frac{V_0}{y'(\\eta)} \\frac{\\partial q}{\\partial \\eta} + \\frac{W_0}{z'(\\zeta)} \\frac{\\partial q}{\\partial \\zeta} = 0\n$$\n这是一个在计算空间中具有空间变化的平流速度的平流方程：\n$U_{comp}(\\xi) = \\frac{U_0}{x'(\\xi)}$，$V_{comp}(\\eta) = \\frac{V_0}{y'(\\eta)}$，和 $W_{comp} = \\frac{W_0}{z'(\\zeta)} = \\frac{W_0}{L_z}$。\n\n数值格式在时间上为显式前向欧拉格式，在空间上为一阶迎风格式。令 $q_{i,j,k}^n$ 表示在计算坐标 $(i\\Delta\\xi, j\\Delta\\eta, k\\Delta\\zeta)$ 和时间 $n\\Delta t$ 处 $q$ 的数值近似。鉴于 $U_0, V_0, W_0 > 0$，并注意到对于给定参数，度量项 $x'(\\xi)$、$y'(\\eta)$ 和 $z'(\\zeta)$ 也为正，因此计算速度 $U_{comp}$、$V_{comp}$、$W_{comp}$ 均为正。对于正速度，一阶迎风格式使用后向差分。离散化方程为：\n$$\n\\frac{q_{i,j,k}^{n+1} - q_{i,j,k}^n}{\\Delta t} + U_{comp,i} \\left( \\frac{q_{i,j,k}^n - q_{i-1,j,k}^n}{\\Delta \\xi} \\right) + V_{comp,j} \\left( \\frac{q_{i,j,k}^n - q_{i,j-1,k}^n}{\\Delta \\eta} \\right) + W_{comp,k} \\left( \\frac{q_{i,j,k}^n - q_{i,j,k-1}^n}{\\Delta \\zeta} \\right) = 0\n$$\n其中 $U_{comp,i} = U_{comp}(i\\Delta\\xi)$，$V_{comp,j} = V_{comp}(j\\Delta\\eta)$，而 $W_{comp,k}$ 是常数。\n\n为保证此显式格式的稳定性，必须满足 Courant-Friedrichs-Lewy (CFL) 条件。对 $q_{i,j,k}^{n+1}$ 的方程进行整理：\n$$ q_{i,j,k}^{n+1} = \\left(1 - \\frac{U_{comp,i}\\Delta t}{\\Delta \\xi} - \\frac{V_{comp,j}\\Delta t}{\\Delta \\eta} - \\frac{W_{comp,k}\\Delta t}{\\Delta \\zeta}\\right) q_{i,j,k}^n + \\frac{U_{comp,i}\\Delta t}{\\Delta \\xi} q_{i-1,j,k}^n + \\frac{V_{comp,j}\\Delta t}{\\Delta \\eta} q_{i,j-1,k}^n + \\frac{W_{comp,k}\\Delta t}{\\Delta \\zeta} q_{i,j,k-1}^n $$\n稳定性的一个充分条件（基于正定性）是右侧所有 $q^n$ 项的系数都为非负。这导出了以下条件：\n$$\n1 - \\frac{U_{comp,i}\\Delta t}{\\Delta \\xi} - \\frac{V_{comp,j}\\Delta t}{\\Delta \\eta} - \\frac{W_{comp,k}\\Delta t}{\\Delta \\zeta} \\ge 0\n$$\n$$\n\\frac{|U_{comp,i}|\\Delta t}{\\Delta \\xi} + \\frac{|V_{comp,j}|\\Delta t}{\\Delta \\eta} + \\frac{|W_{comp,k}|\\Delta t}{\\Delta \\zeta} \\le 1\n$$\n其中为了通用性使用了绝对值。这必须对所有网格点 $(i, j, k)$ 都成立。对时间步长 $\\Delta t$ 的最严格限制发生在 Courant 数之和最大的地方。\n$$\n\\Delta t \\le \\frac{1}{\\max_{\\xi,\\eta,\\zeta} \\left( \\frac{|U_{comp}(\\xi)|}{\\Delta \\xi} + \\frac{|V_{comp}(\\eta)|}{\\Delta \\eta} + \\frac{|W_{comp}|}{\\Delta \\zeta} \\right)}\n$$\n因此，最大稳定时间步长 $\\Delta t_{\\max}$ 为：\n$$\n\\Delta t_{\\max} = \\frac{1}{\\frac{\\max|U_{comp}|}{\\Delta \\xi} + \\frac{\\max|V_{comp}|}{\\Delta \\eta} + \\frac{|W_{comp}|}{\\Delta \\zeta}}\n$$\n问题要求解释网格拉伸的影响。拉伸因子是 $x'(\\xi)$、$y'(\\eta)$ 和 $z'(\\zeta)$，它们表示物理网格间距与计算网格间距之比（例如 $\\Delta x \\approx x'(\\xi) \\Delta \\xi$）。计算平流速度与这些拉伸因子成反比，例如 $U_{comp} = U_0/x'(\\xi)$。稳定性极限由最大的计算速度决定。这些发生在拉伸因子最小的地方，这对应于物理网格最密的区域。\n\n我们必须找到计算速度的最大值。\n由于 $\\alpha_x = 3 > 0$ 和 $\\alpha_y = 2 > 0$，函数 $\\exp(\\alpha_x \\xi)$ 和 $\\exp(\\alpha_y \\eta)$ 是单调递增的。因此，$x'(\\xi)$ 和 $y'(\\eta)$ 也是单调递增的。它们的最小值分别出现在 $\\xi=0$ 和 $\\eta=0$ 处。这是物理网格最密的地方。\n$\\min x'(\\xi) = x'(0) = L_x \\frac{\\alpha_x \\exp(0)}{\\exp(\\alpha_x) - 1} = \\frac{L_x \\alpha_x}{\\exp(\\alpha_x) - 1}$\n$\\min y'(\\eta) = y'(0) = L_y \\frac{\\alpha_y \\exp(0)}{\\exp(\\alpha_y) - 1} = \\frac{L_y \\alpha_y}{\\exp(\\alpha_y) - 1}$\n度量 $z' = L_z$ 是常数。\n\n最大计算速度为：\n$\\max|U_{comp}| = \\frac{|U_0|}{\\min x'(\\xi)} = \\frac{U_0(\\exp(\\alpha_x)-1)}{L_x \\alpha_x}$\n$\\max|V_{comp}| = \\frac{|V_0|}{\\min y'(\\eta)} = \\frac{V_0(\\exp(\\alpha_y)-1)}{L_y \\alpha_y}$\n$|W_{comp}| = \\frac{|W_0|}{L_z}$\n\n现在我们代入给定的数值：\n$L_x = 2\\,\\mathrm{m}$，$L_y = 1\\,\\mathrm{m}$，$L_z = 0.5\\,\\mathrm{m}$\n$\\alpha_x = 3$，$\\alpha_y = 2$\n$U_0 = 30\\,\\mathrm{m/s}$，$V_0 = 10\\,\\mathrm{m/s}$，$W_0 = 5\\,\\mathrm{m/s}$\n$N_{\\xi} = 80 \\implies \\Delta \\xi = \\frac{1}{80}$\n$N_{\\eta} = 60 \\implies \\Delta \\eta = \\frac{1}{60}$\n$N_{\\zeta} = 40 \\implies \\Delta \\zeta = \\frac{1}{40}$\n\n$\\Delta t_{\\max}$ 表达式的分母由三项组成：\n第1项: $\\frac{\\max|U_{comp}|}{\\Delta \\xi} = \\frac{U_0 (\\exp(\\alpha_x)-1)}{L_x \\alpha_x \\Delta \\xi} = \\frac{30 \\cdot (\\exp(3)-1)}{2 \\cdot 3 \\cdot (1/80)} = \\frac{30 \\cdot 80 \\cdot (\\exp(3)-1)}{6} = 400(\\exp(3)-1)$\n第2项: $\\frac{\\max|V_{comp}|}{\\Delta \\eta} = \\frac{V_0 (\\exp(\\alpha_y)-1)}{L_y \\alpha_y \\Delta \\eta} = \\frac{10 \\cdot (\\exp(2)-1)}{1 \\cdot 2 \\cdot (1/60)} = \\frac{10 \\cdot 60 \\cdot (\\exp(2)-1)}{2} = 300(\\exp(2)-1)$\n第3项: $\\frac{|W_{comp}|}{\\Delta \\zeta} = \\frac{W_0}{L_z \\Delta \\zeta} = \\frac{5}{0.5 \\cdot (1/40)} = \\frac{5 \\cdot 40}{0.5} = 400$\n\n现在，我们计算这些项的数值：\n第1项: $400(\\exp(3)-1) \\approx 400(20.085537 - 1) = 400(19.085537) \\approx 7634.2148$\n第2项: $300(\\exp(2)-1) \\approx 300(7.389056 - 1) = 300(6.389056) \\approx 1916.7168$\n第3项: $400$\n\n分母中各项的和为：\n$S = 7634.2148 + 1916.7168 + 400 = 9950.9316$\n\n最后，我们计算最大稳定时间步长：\n$\\Delta t_{\\max} = \\frac{1}{S} = \\frac{1}{9950.9316} \\approx 0.0001004931\\,\\mathrm{s}$\n\n将结果四舍五入到四位有效数字，得到：\n$\\Delta t_{\\max} \\approx 0.0001005\\,\\mathrm{s}$", "answer": "$$\n\\boxed{0.0001005}\n$$", "id": "3324584"}, {"introduction": "现在，我们从理论计算过渡到实际编程实现，在一个完整的二维网格上比较计算网格度量张量的不同数值策略。该问题对比了一种非守恒的度量计算方法与一种几何守恒的方法，并测试它们保持均匀流场（即满足离散 GCL）的能力。通过这个编程练习，您将发现，在连续极限下等价的离散化格式可能具有截然不同的数值特性，并亲眼见证为何几何守恒格式对于防止模拟中出现虚假的源汇项至关重要 [@problem_id:3324596]。", "problem": "您需要编写一个完整、可运行的程序，比较计算空间中控制方程的两种离散网格度量计算策略，并量化它们对标量守恒律自由流保持特性的影响。目标是在一组从计算正方形到物理平面的光滑变形周期性映射上实现这两种策略，并评估当使用计算空间中一致的有限体积散度进行离散化时，恒定自由流的残差。您的实现必须严格遵循下述定义和离散化方法，并且您的最终程序必须生成一行输出，其中包含按指定格式排列的所有测试用例的结果。\n\n考虑一个从计算坐标 $(\\xi,\\eta)\\in [0,1]\\times[0,1]$ 到物理坐标 $(x,y)$ 的光滑可逆映射，由矢量函数 $\\mathbf{r}(\\xi,\\eta)=(x(\\xi,\\eta),y(\\xi,\\eta))$ 给出。记雅可比行列式为 $J=\\det(\\partial\\mathbf{r}/\\partial(\\xi,\\eta))$，逆变度量矢量为 $\\mathbf{a}^{\\xi}$ 和 $\\mathbf{a}^{\\eta}$，因此，对于具有物理速度 $\\mathbf{u}=(u,v)$ 的标量场 $q$ 的守恒律，在计算空间中呈现守恒形式\n$$\n\\frac{\\partial(J q)}{\\partial t}+\\frac{\\partial}{\\partial \\xi}\\left(J(\\mathbf{a}^{\\xi}\\cdot\\mathbf{u})q\\right)+\\frac{\\partial}{\\partial \\eta}\\left(J(\\mathbf{a}^{\\eta}\\cdot\\mathbf{u})q\\right)=0.\n$$\n对于具有恒定 $q$ 和恒定 $\\mathbf{u}$ 的恒定自由流，连续残差简化为\n$$\n\\mathcal{R}=\\frac{\\partial}{\\partial \\xi}\\left(J(\\mathbf{a}^{\\xi}\\cdot\\mathbf{u})\\right)+\\frac{\\partial}{\\partial \\eta}\\left(J(\\mathbf{a}^{\\eta}\\cdot\\mathbf{u})\\right)=\\mathbf{u}\\cdot\\left(\\frac{\\partial(J\\mathbf{a}^{\\xi})}{\\partial \\xi}+\\frac{\\partial(J\\mathbf{a}^{\\eta})}{\\partial \\eta}\\right),\n$$\n如果度量恒等式\n$$\n\\frac{\\partial(J\\mathbf{a}^{\\xi})}{\\partial \\xi}+\\frac{\\partial(J\\mathbf{a}^{\\eta})}{\\partial \\eta}=\\mathbf{0}\n$$\n成立，则该残差恒为零。在离散形式中，如果未能在通量散度中使用相同的离散算子来满足度量恒等式，将导致伪源项，从而破坏自由流保持特性。您必须实现并比较两种离散度量策略：\n\n- 策略 $\\mathrm{D}$ (微分映射，平均到面)：使用二阶中心差分和周期性边界在单元中心计算 $x$ 和 $y$ 的离散偏导数；使用二维叉积公式的模拟形式，在单元中心构建 $J\\mathbf{a}^{\\xi}$ 和 $J\\mathbf{a}^{\\eta}$ 的节点近似值；然后通过相邻单元中心值的算术平均获得面度量矢量，并按相应的计算网格间距进行缩放。\n\n- 策略 $\\mathrm{C}$ (面上协变边的叉积)：直接将面度量矢量构建为离散积分几何对象，这些对象来自单元角点上节点坐标的半索引平均值，利用这些半索引位置的差分形成守恒的面度量矢量，这些矢量在离散散度中可以伸缩对消。\n\n需使用的离散设置和算子：\n\n- 使用均匀的周期性计算网格，在 $\\xi$ 方向上有 $N_{\\xi}$ 个单元，在 $\\eta$ 方向上有 $N_{\\eta}$ 个单元，间距分别为 $\\Delta \\xi=1/N_{\\xi}$ 和 $\\Delta \\eta=1/N_{\\eta}$。\n\n- 在整数索引 $i\\in\\{0,\\dots,N_{\\xi}-1\\}$ 和 $j\\in\\{0,\\dots,N_{\\eta}-1\\}$ 处定义节点坐标 $(\\xi_{i},\\eta_{j})$ 为 $\\xi_{i}=i\\Delta \\xi$ 和 $\\eta_{j}=j\\Delta \\eta$，索引采用模 $N_{\\xi}$ 和 $N_{\\eta}$ 的周期性。\n\n- 在 $(\\xi_{i+1/2},\\eta_{j+1/2})=( (i+\\tfrac{1}{2})\\Delta \\xi,(j+\\tfrac{1}{2})\\Delta \\eta)$ 处定义单元中心，其中 $i\\in\\{0,\\dots,N_{\\xi}-1\\}$ 且 $j\\in\\{0,\\dots,N_{\\eta}-1\\}$。\n\n- 使用以下由振幅 $\\alpha$、$\\beta$ 和整数频率 $m,n,p,q$ 参数化的光滑周期性映射族：\n$$\nx(\\xi,\\eta)=\\xi+\\alpha \\sin(2\\pi m \\xi)\\sin(2\\pi n \\eta),\\quad\ny(\\xi,\\eta)=\\eta+\\beta \\sin(2\\pi p \\xi)\\sin(2\\pi q \\eta).\n$$\n\n- 策略 $\\mathrm{D}$ 详情：\n  - 通过在 $(\\xi_{i+1/2},\\eta_{j+1/2})$ 处评估映射，计算单元中心的 $x$ 和 $y$ 坐标 $(x_{c},y_{c})$。\n  - 使用周期性环绕在单元中心计算中心有限差分：\n    $$\n    x_{\\xi}\\approx \\frac{x_{c}(i+1,j)-x_{c}(i-1,j)}{2\\Delta \\xi},\\quad\n    x_{\\eta}\\approx \\frac{x_{c}(i,j+1)-x_{c}(i,j-1)}{2\\Delta \\eta},\n    $$\n    对 $y_{\\xi}$ 和 $y_{\\eta}$ 进行类似计算。\n  - 在单元中心构建矢量 $J\\mathbf{a}^{\\xi}=(y_{\\eta},-x_{\\eta})$ 和 $J\\mathbf{a}^{\\eta}=(-y_{\\xi},x_{\\xi})$。\n  - 通过相邻单元中心值的算术平均，并乘以面的计算长度，生成面度量矢量：\n    $$\n    \\mathbf{S}_{\\xi}^{\\mathrm{D}}(i+\\tfrac{1}{2},j+\\tfrac{1}{2})=\\Delta \\eta\\,\\frac{(J\\mathbf{a}^{\\xi})(i,j)+(J\\mathbf{a}^{\\xi})(i+1,j)}{2},\n    $$\n    $$\n    \\mathbf{S}_{\\eta}^{\\mathrm{D}}(i+\\tfrac{1}{2},j+\\tfrac{1}{2})=\\Delta \\xi\\,\\frac{(J\\mathbf{a}^{\\eta})(i,j)+(J\\mathbf{a}^{\\eta})(i,j+1)}{2},\n    $$\n    其中 $\\mathbf{S}_{\\xi}$ 定义在单元 $(i,j)$ 的 $\\xi$-面上，位于 $(i+\\tfrac{1}{2},j+\\tfrac{1}{2})$，而 $\\mathbf{S}_{\\eta}$ 定义在 $\\eta$-面上，位于 $(i+\\tfrac{1}{2},j+\\tfrac{1}{2})$。\n\n- 策略 $\\mathrm{C}$ 详情：\n  - 通过在网格节点 $(\\xi_{i},\\eta_{j})$ 处评估映射，计算节点坐标 $(x_{n},y_{n})$。\n  - 通过对周围四个节点值进行平均，计算在位置 $(i+\\tfrac{1}{2},j+\\tfrac{1}{2})$ 处的半索引平均值：\n    $$\n    x_{h}(i+\\tfrac{1}{2},j+\\tfrac{1}{2})=\\frac{x_{n}(i,j)+x_{n}(i+1,j)+x_{n}(i,j+1)+x_{n}(i+1,j+1)}{4},\n    $$\n    对 $y_{h}$ 进行类似计算，索引采用周期性环绕。\n  - 通过这些半索引位置的旋转差分来构建守恒的面度量矢量：\n    $$\n    \\mathbf{S}_{\\xi}^{\\mathrm{C}}(i+\\tfrac{1}{2},j+\\tfrac{1}{2})=\\left(y_{h}(i+\\tfrac{1}{2},j+\\tfrac{1}{2})-y_{h}(i+\\tfrac{1}{2},j-\\tfrac{1}{2}),\\,-\\left(x_{h}(i+\\tfrac{1}{2},j+\\tfrac{1}{2})-x_{h}(i+\\tfrac{1}{2},j-\\tfrac{1}{2})\\right)\\right),\n    $$\n    $$\n    \\mathbf{S}_{\\eta}^{\\mathrm{C}}(i+\\tfrac{1}{2},j+\\tfrac{1}{2})=\\left(-\\left(y_{h}(i+\\tfrac{1}{2},j+\\tfrac{1}{2})-y_{h}(i-\\tfrac{1}{2},j+\\tfrac{1}{2})\\right),\\,\\left(x_{h}(i+\\tfrac{1}{2},j+\\tfrac{1}{2})-x_{h}(i-\\tfrac{1}{2},j+\\tfrac{1}{2})\\right)\\right).\n    $$\n    这种构造是守恒的，并为面度量矢量产生一个离散伸缩对消恒等式。\n\n离散散度和自由流残差：\n\n- 对于任一策略 $\\mathrm{S}\\in\\{\\mathrm{D},\\mathrm{C}\\}$，为恒定的 $q$ 和恒定的 $\\mathbf{u}=(u,v)$ 定义面通量为\n$$\nF_{\\xi}^{\\mathrm{S}}(i+\\tfrac{1}{2},j+\\tfrac{1}{2})=q\\,\\mathbf{u}\\cdot \\mathbf{S}_{\\xi}^{\\mathrm{S}}(i+\\tfrac{1}{2},j+\\tfrac{1}{2}),\\quad\nF_{\\eta}^{\\mathrm{S}}(i+\\tfrac{1}{2},j+\\tfrac{1}{2})=q\\,\\mathbf{u}\\cdot \\mathbf{S}_{\\eta}^{\\mathrm{S}}(i+\\tfrac{1}{2},j+\\tfrac{1}{2}).\n$$\n\n- 单元 $(i,j)$ 的单元中心离散残差为\n$$\n\\mathcal{R}^{\\mathrm{S}}(i,j)=F_{\\xi}^{\\mathrm{S}}(i+\\tfrac{1}{2},j+\\tfrac{1}{2})-F_{\\xi}^{\\mathrm{S}}(i-\\tfrac{1}{2},j+\\tfrac{1}{2})+F_{\\eta}^{\\mathrm{S}}(i+\\tfrac{1}{2},j+\\tfrac{1}{2})-F_{\\eta}^{\\mathrm{S}}(i+\\tfrac{1}{2},j-\\tfrac{1}{2}),\n$$\n采用周期性环绕。为实现完美的自由流保持，此残差必须为零。\n\n- 报告归一化的均方根残差\n$$\nE^{\\mathrm{S}}=\\frac{\\sqrt{\\frac{1}{N_{\\xi}N_{\\eta}}\\sum_{i=0}^{N_{\\xi}-1}\\sum_{j=0}^{N_{\\eta}-1}\\left(\\mathcal{R}^{\\mathrm{S}}(i,j)\\right)^{2}}}{|q|\\,\\sqrt{u^{2}+v^{2}}}.\n$$\n\n测试套件：\n\n您的程序必须实现上述内容，并为以下四个测试用例评估 $E^{\\mathrm{D}}$ 和 $E^{\\mathrm{C}}$，每个用例由 $(N_{\\xi},N_{\\eta},\\alpha,\\beta,m,n,p,q,u,v,q_{0})$ 定义：\n\n- 用例 1：$(N_{\\xi},N_{\\eta})=(48,48)$，$\\alpha=0.15$，$\\beta=-0.17$，$m=1$，$n=1$，$p=1$，$q=2$，$u=0.9$，$v=-0.6$，$q_{0}=2.0$。\n\n- 用例 2：$(N_{\\xi},N_{\\eta})=(16,16)$，$\\alpha=0.3$，$\\beta=0.2$，$m=2$，$n=1$，$p=1$，$q=2$，$u=1.0$，$v=0.0$，$q_{0}=1.0$。\n\n- 用例 3：$(N_{\\xi},N_{\\eta})=(32,32)$，$\\alpha=0.0$，$\\beta=0.0$，$m=1$，$n=1$，$p=1$，$q=1$，$u=1.0$，$v=1.0$，$q_{0}=1.0$。\n\n- 用例 4：$(N_{\\xi},N_{\\eta})=(24,24)$，$\\alpha=0.12$，$\\beta=0.25$，$m=2$，$n=3$，$p=3$，$q=2$，$u=0.7$，$v=1.3$，$q_{0}=0.5$。\n\n最终输出格式：\n\n- 您的程序应生成一行输出，其中包含结果列表，形式为以逗号分隔的各用例对方括号内的配对。每个配对是对应案例的二元列表 $[E^{\\mathrm{D}},E^{\\mathrm{C}}]$。最终格式必须是\n$$\n[[E^{\\mathrm{D}}_{1},E^{\\mathrm{C}}_{1}],[E^{\\mathrm{D}}_{2},E^{\\mathrm{C}}_{2}],[E^{\\mathrm{D}}_{3},E^{\\mathrm{C}}_{3}],[E^{\\mathrm{D}}_{4},E^{\\mathrm{C}}_{4}]],\n$$\n数值以标准浮点表示法打印。", "solution": "用户提供了一个计算流体动力学（CFD）领域的问题，具体涉及在变换网格上对自由流保持特性的数值验证。该问题是验证不同网格度量计算数值方案属性的标准练习。\n\n### 步骤 1：问题验证\n\n已根据指定标准对问题陈述进行了仔细审查。\n\n- **提取的已知信息**：所有参数、方程和数值方案都已明确定义。\n    - 计算空间中标量 $q$ 的控制方程：$\\frac{\\partial(J q)}{\\partial t}+\\frac{\\partial}{\\partial \\xi}\\left(J(\\mathbf{a}^{\\xi}\\cdot\\mathbf{u})q\\right)+\\frac{\\partial}{\\partial \\eta}\\left(J(\\mathbf{a}^{\\eta}\\cdot\\mathbf{u})q\\right)=0$。\n    - 坐标映射：$x(\\xi,\\eta)=\\xi+\\alpha \\sin(2\\pi m \\xi)\\sin(2\\pi n \\eta)$，$y(\\xi,\\eta)=\\eta+\\beta \\sin(2\\pi p \\xi)\\sin(2\\pi q \\eta)$。\n    - 离散网格设置：均匀、周期性，$N_{\\xi} \\times N_{\\eta}$ 个单元。\n    - 策略 D：一种基于对坐标映射进行微分然后平均以获得面度量的方案。所有离散算子都已明确定义。\n    - 策略 C：一种基于从平均节点坐标的差分构造面度量的守恒方案。所有离散算子都已明确定义。\n    - 离散散度和残差：提供了一个特定的有限差分公式用于散度，该公式将应用于两种度量策略计算的通量。\n    - 误差度量：归一化的离散残差均方根（RMS）。\n    - 测试用例：提供了四组不同的参数集用于计算。\n\n- **验证结论**：\n    - **科学上合理**：该问题基于曲线坐标系下守恒律的基本原理，这是CFD的核心课题。度量恒等式 $\\frac{\\partial(J\\mathbf{a}^{\\xi})}{\\partial \\xi}+\\frac{\\partial(J\\mathbf{a}^{\\eta})}{\\partial \\eta}=\\mathbf{0}$ 是一个标准结果，在离散层面测试其保持性是关键的验证步骤。策略D和策略C都代表了度量计算的常用方法。\n    - **适定性**：问题是适定的。输入已明确指定，所需的输出由给定的算法唯一确定。为测试用例提供的参数在物理上和数学上都是合理的，确保了映射是可逆的，并且误差的归一化因子非零。\n    - **客观性**：问题以精确、客观的数学语言陈述。\n    - **索引表示法**：尽管面量的索引表示法，例如 $\\mathbf{S}_{\\xi}(i+1/2, j+1/2)$，有些非传统，但用于构造这些量并在离散散度中使用它们的公式是明确且无歧义的。字面上实现所提供的公式构成了一个自洽且可解的问题。\n\n该问题被判定为**有效**，并将提供解决方案。\n\n### 步骤 2：解决方案设计\n\n解决方案将使用 Python 和 `numpy` 库来实现，以便进行高效的数组计算。整体结构将涉及一个主函数，该函数遍历四个测试用例。对于每个用例，一个专门的函数将执行策略 D 和策略 C 的计算，并返回相应的误差。\n\n**策略 C 实现大纲：**\n该策略是已知的几何守恒策略，应能精确满足离散度量恒等式。因此，残差以及误差 $E^{\\mathrm{C}}$ 预计在机器精度范围内为零。\n1.  在节点位置 $(\\xi_i, \\eta_j)$ 定义计算网格。\n2.  使用提供的映射函数在这些节点上评估物理坐标 $(x_n, y_n)$。\n3.  通过对周围四个节点坐标进行平均，计算单元中心的物理坐标 $(x_h, y_h)$，使用 `numpy.roll` 处理周期性边界。\n4.  通过取 $(x_h, y_h)$ 数组的差分来构建守恒的面度量矢量 $\\mathbf{S}_{\\xi}^{\\mathrm{C}}$ 和 $\\mathbf{S}_{\\eta}^{\\mathrm{C}}$，同样使用 `numpy.roll` 进行周期性移位。\n5.  通过将度量矢量与恒定速度矢量 $\\mathbf{u}$ 进行点积并乘以 $q$ 来计算面通量 $F_{\\xi}^{\\mathrm{C}}$ 和 $F_{\\eta}^{\\mathrm{C}}$。\n6.  应用指定的散度公式计算离散残差 $\\mathcal{R}^{\\mathrm{C}}$，使用 `numpy.roll` 在相邻单元面之间执行减法。\n\n**策略 D 实现大纲：**\n该策略涉及微分，这可能引入违反度量恒等式的离散化误差。误差 $E^{\\mathrm{D}}$ 预计不为零。\n1.  在单元中心位置 $(\\xi_{i+1/2}, \\eta_{j+1/2})$ 定义计算网格。\n2.  在这些单元中心评估物理坐标 $(x_c, y_c)$。\n3.  使用指定的二阶中心差分公式计算单元中心的离散偏导数（$x_{\\xi}$，$x_{\\eta}$，$y_{\\xi}$，$y_{\\eta}$），用 `numpy.roll` 实现。\n4.  形成单元中心的度量量 $J\\mathbf{a}^{\\xi}$ 和 $J\\mathbf{a}^{\\eta}$。\n5.  将这些单元中心量进行平均以获得面度量矢量 $\\mathbf{S}_{\\xi}^{\\mathrm{D}}$ 和 $\\mathbf{S}_{\\eta}^{\\mathrm{D}}$。\n6.  使用与策略 C 中相同的过程计算面通量和离散残差 $\\mathcal{R}^{\\mathrm{D}}$。\n\n**误差计算：**\n对于两种策略，最终的归一化 RMS 误差 $E^{\\mathrm{S}}$ 将根据提供的公式从残差场 $\\mathcal{R}^{\\mathrm{S}}$ 计算得出。所有测试用例的结果将被收集并格式化为所需的输出字符串。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the CFD problem for all test cases.\n    \"\"\"\n    # Test cases defined as tuples:\n    # (N_xi, N_eta, alpha, beta, m, n, p, q, u, v, q_0)\n    test_cases = [\n        (48, 48, 0.15, -0.17, 1, 1, 1, 2, 0.9, -0.6, 2.0),\n        (16, 16, 0.3, 0.2, 2, 1, 1, 2, 1.0, 0.0, 1.0),\n        (32, 32, 0.0, 0.0, 1, 1, 1, 1, 1.0, 1.0, 1.0),\n        (24, 24, 0.12, 0.25, 2, 3, 3, 2, 0.7, 1.3, 0.5),\n    ]\n\n    results = []\n    for params in test_cases:\n        errors = calculate_errors_for_case(params)\n        results.append(errors)\n\n    # Format the final output string exactly as required.\n    case_results_str = [f\"[{ed},{ec}]\" for ed, ec in results]\n    final_output = f\"[{','.join(case_results_str)}]\"\n    print(final_output)\n\ndef map_coordinates(xi_grid, eta_grid, alpha, beta, m, n, p, q):\n    \"\"\"\n    Computes physical coordinates (x, y) from computational (xi, eta).\n    \"\"\"\n    x = xi_grid + alpha * np.sin(2 * np.pi * m * xi_grid) * np.sin(2 * np.pi * n * eta_grid)\n    y = eta_grid + beta * np.sin(2 * np.pi * p * xi_grid) * np.sin(2 * np.pi * q * eta_grid)\n    return x, y\n\ndef calculate_errors_for_case(params):\n    \"\"\"\n    Calculates the normalized RMS residual errors for Strategy D and Strategy C\n    for a single test case.\n    \"\"\"\n    N_xi, N_eta, alpha, beta, m, n, p, q, u, v, q_0 = params\n    \n    dxi = 1.0 / N_xi\n    deta = 1.0 / N_eta\n    \n    # --- Grid Setup ---\n    xi_node_1d = np.arange(N_xi) * dxi\n    eta_node_1d = np.arange(N_eta) * deta\n    xi_node, eta_node = np.meshgrid(xi_node_1d, eta_node_1d, indexing='ij')\n\n    xi_center_1d = (np.arange(N_xi) + 0.5) * dxi\n    eta_center_1d = (np.arange(N_eta) + 0.5) * deta\n    xi_center, eta_center = np.meshgrid(xi_center_1d, eta_center_1d, indexing='ij')\n\n    # --- Strategy D: Differentiate then Average ---\n    \n    # 1. Physical coords at cell centers\n    xc, yc = map_coordinates(xi_center, eta_center, alpha, beta, m, n, p, q)\n    \n    # 2. Centered differences of coords at cell centers\n    x_xi = (np.roll(xc, -1, axis=0) - np.roll(xc, 1, axis=0)) / (2 * dxi)\n    x_eta = (np.roll(xc, -1, axis=1) - np.roll(xc, 1, axis=1)) / (2 * deta)\n    y_xi = (np.roll(yc, -1, axis=0) - np.roll(yc, 1, axis=0)) / (2 * dxi)\n    y_eta = (np.roll(yc, -1, axis=1) - np.roll(yc, 1, axis=1)) / (2 * deta)\n    \n    # 3. Cell-centered metric vectors J*a^xi and J*a^eta\n    Ja_xi_D = np.stack((y_eta, -x_eta), axis=-1)\n    Ja_eta_D = np.stack((-y_xi, x_xi), axis=-1)\n    \n    # 4. Face metric vectors by averaging cell-centered values\n    S_xi_D = deta / 2.0 * (Ja_xi_D + np.roll(Ja_xi_D, -1, axis=0))\n    S_eta_D = dxi / 2.0 * (Ja_eta_D + np.roll(Ja_eta_D, -1, axis=1))\n    \n    # 5. Face fluxes\n    F_xi_D = q_0 * (S_xi_D[..., 0] * u + S_xi_D[..., 1] * v)\n    F_eta_D = q_0 * (S_eta_D[..., 0] * u + S_eta_D[..., 1] * v)\n\n    # 6. Discrete residual\n    R_D = (F_xi_D - np.roll(F_xi_D, 1, axis=0)) + (F_eta_D - np.roll(F_eta_D, 1, axis=1))\n\n    # --- Strategy C: Conservative Cross Products ---\n\n    # 1. Physical coords at nodes\n    xn, yn = map_coordinates(xi_node, eta_node, alpha, beta, m, n, p, q)\n    \n    # 2. Half-indexed averages (cell-centered positions)\n    xh = 0.25 * (xn + np.roll(xn, -1, axis=0) + np.roll(xn, -1, axis=1) + np.roll(np.roll(xn, -1, axis=0), -1, axis=1))\n    yh = 0.25 * (yn + np.roll(yn, -1, axis=0) + np.roll(yn, -1, axis=1) + np.roll(np.roll(yn, -1, axis=0), -1, axis=1))\n    \n    # 3. Conservative face metric vectors\n    S_xi_C_y = yh - np.roll(yh, 1, axis=1)\n    S_xi_C_x = -(xh - np.roll(xh, 1, axis=1))\n    S_xi_C = np.stack((S_xi_C_y, S_xi_C_x), axis=-1)\n\n    S_eta_C_x = -(yh - np.roll(yh, 1, axis=0))\n    S_eta_C_y = xh - np.roll(xh, 1, axis=0)\n    S_eta_C = np.stack((S_eta_C_x, S_eta_C_y), axis=-1)\n    \n    # 4. Face fluxes\n    F_xi_C = q_0 * (S_xi_C[..., 0] * u + S_xi_C[..., 1] * v)\n    F_eta_C = q_0 * (S_eta_C[..., 0] * u + S_eta_C[..., 1] * v)\n\n    # 5. Discrete residual\n    R_C = (F_xi_C - np.roll(F_xi_C, 1, axis=0)) + (F_eta_C - np.roll(F_eta_C, 1, axis=1))\n    \n    # --- Final Error Calculation ---\n    norm_factor = abs(q_0) * np.sqrt(u**2 + v**2)\n    \n    if norm_factor == 0:\n        E_D = np.sqrt(np.mean(R_D**2))\n        E_C = np.sqrt(np.mean(R_C**2))\n    else:\n        E_D = np.sqrt(np.mean(R_D**2)) / norm_factor\n        E_C = np.sqrt(np.mean(R_C**2)) / norm_factor\n        \n    return [E_D, E_C]\n\nsolve()\n```", "id": "3324596"}]}