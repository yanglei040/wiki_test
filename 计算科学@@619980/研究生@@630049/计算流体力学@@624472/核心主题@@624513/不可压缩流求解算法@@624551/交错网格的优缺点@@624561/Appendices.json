{"hands_on_practices": [{"introduction": "理解一个数值格式的优劣始于分析其局部截断误差。本练习将引导你通过经典的泰勒级数分析，证明 MAC 交错网格上的基本散度和梯度算子的二阶精度[@problem_id:3289961]。掌握这种分析方法，对于领会交错网格为不可压缩流模拟带来的形式上的精确性至关重要。", "problem": "考虑一个由质量守恒控制的二维不可压缩流，其中速度场的散度必须为零，且压力梯度出现在动量平衡中。在一个双向空间步长均为 $h$ 的均匀矩形网格上，采用标记网格法（MAC）的交错排列方式：压力 $p$位于网格中心 $(x_i,y_j)$，水平速度分量 $u$ 位于垂直面中心 $(x_{i+\\frac{1}{2}},y_j)$，垂直速度分量 $v$ 位于水平面中心 $(x_i,y_{j+\\frac{1}{2}})$。\n\n设制造的光滑场为\n$$\nu(x,y) = \\sin(\\alpha x)\\sin(\\beta y), \\quad v(x,y) = \\cos(\\alpha x)\\cos(\\beta y), \\quad p(x,y) = \\sin(\\alpha x)\\cos(\\beta y),\n$$\n其中 $\\alpha>0$ 和 $\\beta>0$ 为常数。定义网格中心 $(x_0,y_0)$ 处的离散MAC散度为\n$$\nD_h[u,v](x_0,y_0) \\equiv \\frac{u(x_0+\\frac{h}{2},y_0)-u(x_0-\\frac{h}{2},y_0)}{h} + \\frac{v(x_0,y_0+\\frac{h}{2})-v(x_0,y_0-\\frac{h}{2})}{h},\n$$\n并定义离散MAC压力梯度分量为\n$$\nG_h^x[p](x_0+\\tfrac{h}{2},y_0) \\equiv \\frac{p(x_0+h,y_0)-p(x_0,y_0)}{h}, \\qquad G_h^y[p](x_0,y_0+\\tfrac{h}{2}) \\equiv \\frac{p(x_0,y_0+h)-p(x_0,y_0)}{h}.\n$$\n\n从空间导数的定义出发，并使用以求值点为基准的泰勒级数展开，进行截断误差分析，以获得在均匀网格上 $D_h[u,v](x_0,y_0)$、$G_h^x[p](x_0+\\tfrac{h}{2},y_0)$ 和 $G_h^y[p](x_0,y_0+\\tfrac{h}{2})$ 的局部截断误差关于 $h$ 的幂次的主阶项。明确证明这些主阶项的尺度为 $\\mathcal{O}(h^2)$，从而表明在均匀网格上，交错MAC散度和压力梯度在空间上是二阶相容的。简要说明这种二阶相容性与交错网格的一个优点有何关联，并指出一个与实现相关的缺点。\n\n最后，计算主阶截断误差之和\n$$\nS(h) \\equiv \\operatorname{TE}_{\\mathrm{div}}(x_0,y_0) + \\operatorname{TE}_{\\mathrm{grad},x}(x_0+\\tfrac{h}{2},y_0) + \\operatorname{TE}_{\\mathrm{grad},y}(x_0,y_0+\\tfrac{h}{2}),\n$$\n在点 $(x_0,y_0) = \\left(\\frac{1}{3},\\frac{1}{4}\\right)$ 处，并将 $S(h)$ 表示为关于 $\\alpha$、$\\beta$ 和 $h$ 的单个闭式解析表达式。精确表达你的最终答案；此处无需四舍五入，且各量均不带物理单位。", "solution": "该问题要求对标记网格法（MAC）交错网格上用于散度和压力梯度的有限差分算子进行截断误差分析，讨论该方法的特性，并对给定的一组制造场显式计算主阶误差项之和。\n\n对于一个函数 $f$，近似连续微分算子 $L$ 的离散算子 $L_h$ 的局部截断误差（TE）定义为 $\\operatorname{TE}[f] \\equiv L_h[f] - L[f]$。截断误差的主阶项决定了离散化的精度阶。\n\n**1. 离散散度 $D_h[u,v]$ 的截断误差分析**\n\n在网格中心 $(x_0, y_0)$ 的离散散度由下式给出：\n$$\nD_h[u,v](x_0,y_0) = \\frac{u(x_0+\\frac{h}{2},y_0)-u(x_0-\\frac{h}{2},y_0)}{h} + \\frac{v(x_0,y_0+\\frac{h}{2})-v(x_0,y_0-\\frac{h}{2})}{h}\n$$\n相应的连续算子是在 $(x_0, y_0)$ 处求值的散度 $\\nabla \\cdot \\mathbf{u} = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}$。\n\n我们围绕点 $(x_0, y_0)$ 对 $u$ 和 $v$ 进行泰勒级数展开。对于涉及 $u$ 的第一项，我们有：\n$$\nu(x_0 \\pm \\frac{h}{2}, y_0) = u(x_0,y_0) \\pm \\frac{h}{2}\\frac{\\partial u}{\\partial x}\\bigg|_{(x_0,y_0)} + \\frac{1}{2!}\\left(\\frac{h}{2}\\right)^2\\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{(x_0,y_0)} \\pm \\frac{1}{3!}\\left(\\frac{h}{2}\\right)^3\\frac{\\partial^3 u}{\\partial x^3}\\bigg|_{(x_0,y_0)} + \\mathcal{O}(h^4)\n$$\n将两个展开式相减得到：\n$$\nu(x_0+\\frac{h}{2},y_0) - u(x_0-\\frac{h}{2},y_0) = h\\frac{\\partial u}{\\partial x}\\bigg|_{(x_0,y_0)} + \\frac{h^3}{24}\\frac{\\partial^3 u}{\\partial x^3}\\bigg|_{(x_0,y_0)} + \\mathcal{O}(h^5)\n$$\n除以 $h$，我们得到 $\\frac{\\partial u}{\\partial x}$ 的近似：\n$$\n\\frac{u(x_0+\\frac{h}{2},y_0)-u(x_0-\\frac{h}{2},y_0)}{h} = \\frac{\\partial u}{\\partial x}\\bigg|_{(x_0,y_0)} + \\frac{h^2}{24}\\frac{\\partial^3 u}{\\partial x^3}\\bigg|_{(x_0,y_0)} + \\mathcal{O}(h^4)\n$$\n通过对 $v$ 分量关于 $y$ 的相同分析：\n$$\n\\frac{v(x_0,y_0+\\frac{h}{2})-v(x_0,y_0-\\frac{h}{2})}{h} = \\frac{\\partial v}{\\partial y}\\bigg|_{(x_0,y_0)} + \\frac{h^2}{24}\\frac{\\partial^3 v}{\\partial y^3}\\bigg|_{(x_0,y_0)} + \\mathcal{O}(h^4)\n$$\n将这两个结果相加，得到离散散度算子的展开式：\n$$\nD_h[u,v](x_0,y_0) = \\left(\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}\\right)\\bigg|_{(x_0,y_0)} + \\frac{h^2}{24}\\left(\\frac{\\partial^3 u}{\\partial x^3} + \\frac{\\partial^3 v}{\\partial y^3}\\right)\\bigg|_{(x_0,y_0)} + \\mathcal{O}(h^4)\n$$\n截断误差为 $\\operatorname{TE}_{\\mathrm{div}} = D_h[u,v] - (\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y})$。主阶项是：\n$$\n\\operatorname{TE}_{\\mathrm{div}}(x_0,y_0) = \\frac{h^2}{24}\\left(\\frac{\\partial^3 u}{\\partial x^3} + \\frac{\\partial^3 v}{\\partial y^3}\\right)\\bigg|_{(x_0,y_0)} + \\mathcal{O}(h^4)\n$$\n此项的阶为 $\\mathcal{O}(h^2)$，因此该算子是二阶精确的。\n\n**2. 离散压力梯度 $G_h[p]$ 的截断误差分析**\n\n压力梯度的离散x分量在 $u$ 速度位置 $(x_0+\\frac{h}{2},y_0)$ 处求值：\n$$\nG_h^x[p](x_0+\\tfrac{h}{2},y_0) = \\frac{p(x_0+h,y_0)-p(x_0,y_0)}{h}\n$$\n我们通过围绕求值点 $(x_0+\\frac{h}{2}, y_0)$ 展开 $p(x_0+h, y_0)$ 和 $p(x_0, y_0)$ 来分析此问题。设 $x' = x_0+\\frac{h}{2}$。模板点是 $x'+\\frac{h}{2}$ 和 $x'-\\frac{h}{2}$。\n$$\np(x' \\pm \\frac{h}{2}, y_0) = p(x',y_0) \\pm \\frac{h}{2}\\frac{\\partial p}{\\partial x}\\bigg|_{(x',y_0)} + \\frac{h^2}{8}\\frac{\\partial^2 p}{\\partial x^2}\\bigg|_{(x',y_0)} \\pm \\frac{h^3}{48}\\frac{\\partial^3 p}{\\partial x^3}\\bigg|_{(x',y_0)} + \\mathcal{O}(h^4)\n$$\n标准的中心差分公式给出：\n$$\nG_h^x[p](x',y_0) = \\frac{\\partial p}{\\partial x}\\bigg|_{(x',y_0)} + \\frac{h^2}{24}\\frac{\\partial^3 p}{\\partial x^3}\\bigg|_{(x',y_0)} + \\mathcal{O}(h^4)\n$$\n代入 $x' = x_0+\\frac{h}{2}$，主阶截断误差为：\n$$\n\\operatorname{TE}_{\\mathrm{grad},x}(x_0+\\tfrac{h}{2},y_0) = \\frac{h^2}{24}\\frac{\\partial^3 p}{\\partial x^3}\\bigg|_{(x_0+h/2,y_0)} + \\mathcal{O}(h^4)\n$$\n该算子也是二阶精确的。根据对称性，对在 $(x_0, y_0+\\frac{h}{2})$ 处求值的梯度y分量的分析得出：\n$$\n\\operatorname{TE}_{\\mathrm{grad},y}(x_0,y_0+\\tfrac{h}{2}) = \\frac{h^2}{24}\\frac{\\partial^3 p}{\\partial y^3}\\bigg|_{(x_0,y_0+h/2)} + \\mathcal{O}(h^4)\n$$\n这证明了在均匀交错网格上，离散散度和压力梯度算子都具有二阶相容性。\n\n**3. 交错网格的优缺点**\n\n交错网格排列的一个重要优点是它在压力和速度之间建立了紧密的、自然的耦合。对于同位网格（所有变量位于同一节点），压力梯度的简单中心差分将只涉及不相邻的压力节点（例如，用 $p_{i+1}$ 和 $p_{i-1}$ 来计算节点 $i$ 处的梯度）。这可能导致一种解耦现象，即压力场中的高频、非物理的“棋盘”振荡不会被离散梯度算子“感知”，因此不影响速度场。交错网格通过使用相邻网格中的压力值计算网格面上的速度来防止这种情况（例如，$u_{i+1/2}$ 由 $p_{i+1}-p_i$ 驱动），确保跨网格的压力差直接影响通过它的流动。\n\n一个主要缺点是实现复杂性的增加。管理不同变量的位置需要更复杂的数据结构和索引逻辑。边界条件的实现也更加复杂，因为不同的变量距离物理边界的距离不同。在非笛卡尔网格上，这种复杂性会加剧。\n\n**4. 主阶截断误差之和的计算**\n\n我们需要计算主阶截断误差项的总和 $S(h)$：\n$$\nS(h) = \\frac{h^2}{24}\\left[ \\left(\\frac{\\partial^3 u}{\\partial x^3} + \\frac{\\partial^3 v}{\\partial y^3}\\right)\\bigg|_{(x_0,y_0)} + \\frac{\\partial^3 p}{\\partial x^3}\\bigg|_{(x_0+h/2,y_0)} + \\frac{\\partial^3 p}{\\partial y^3}\\bigg|_{(x_0,y_0+h/2)} \\right]\n$$\n首先，我们从给定的制造解中计算所需的三阶导数：\n$u(x,y) = \\sin(\\alpha x)\\sin(\\beta y)$\n$v(x,y) = \\cos(\\alpha x)\\cos(\\beta y)$\n$p(x,y) = \\sin(\\alpha x)\\cos(\\beta y)$\n\n这些导数是：\n$\\frac{\\partial^3 u}{\\partial x^3} = -\\alpha^3 \\cos(\\alpha x)\\sin(\\beta y)$\n$\\frac{\\partial^3 v}{\\partial y^3} = \\beta^3 \\cos(\\alpha x)\\sin(\\beta y)$\n$\\frac{\\partial^3 p}{\\partial x^3} = -\\alpha^3 \\cos(\\alpha x)\\cos(\\beta y)$\n$\\frac{\\partial^3 p}{\\partial y^3} = \\beta^3 \\sin(\\alpha x)\\sin(\\beta y)$\n\n现在，我们组合出 $S(h)$ 的表达式：\n$$\nS(h) = \\frac{h^2}{24}\\left[ \\left(-\\alpha^3 \\cos(\\alpha x)\\sin(\\beta y) + \\beta^3 \\cos(\\alpha x)\\sin(\\beta y)\\right)\\bigg|_{(x_0,y_0)} \\right. \\\\ \\left. + \\left(-\\alpha^3 \\cos(\\alpha x)\\cos(\\beta y)\\right)\\bigg|_{(x_0+h/2,y_0)} + \\left(\\beta^3 \\sin(\\alpha x)\\sin(\\beta y)\\right)\\bigg|_{(x_0,y_0+h/2)} \\right]\n$$\n简化第一项：\n$$\nS(h) = \\frac{h^2}{24}\\left[ (\\beta^3 - \\alpha^3)\\cos(\\alpha x_0)\\sin(\\beta y_0) - \\alpha^3 \\cos\\left(\\alpha(x_0+\\frac{h}{2})\\right)\\cos(\\beta y_0) \\right. \\\\ \\left. + \\beta^3 \\sin(\\alpha x_0)\\sin\\left(\\beta(y_0+\\frac{h}{2})\\right) \\right]\n$$\n最后，我们代入指定的点 $(x_0, y_0) = (\\frac{1}{3}, \\frac{1}{4})$：\n$$\nS(h) = \\frac{h^2}{24}\\left[ (\\beta^3 - \\alpha^3)\\cos\\left(\\frac{\\alpha}{3}\\right)\\sin\\left(\\frac{\\beta}{4}\\right) - \\alpha^3 \\cos\\left(\\alpha\\left(\\frac{1}{3}+\\frac{h}{2}\\right)\\right)\\cos\\left(\\frac{\\beta}{4}\\right) \\right. \\\\ \\left. + \\beta^3 \\sin\\left(\\frac{\\alpha}{3}\\right)\\sin\\left(\\beta\\left(\\frac{1}{4}+\\frac{h}{2}\\right)\\right) \\right]\n$$\n这就是主阶截断误差之和的最终闭式解析表达式。", "answer": "$$\n\\boxed{\\frac{h^2}{24} \\left[ (\\beta^3 - \\alpha^3)\\cos\\left(\\frac{\\alpha}{3}\\right)\\sin\\left(\\frac{\\beta}{4}\\right) - \\alpha^3 \\cos\\left(\\frac{\\alpha}{3}+\\frac{\\alpha h}{2}\\right)\\cos\\left(\\frac{\\beta}{4}\\right) + \\beta^3 \\sin\\left(\\frac{\\alpha}{3}\\right)\\sin\\left(\\frac{\\beta}{4}+\\frac{\\beta h}{2}\\right) \\right]}\n$$", "id": "3289961"}, {"introduction": "交错网格的主要设计动机在于其能够避免非物理的压力振荡，而这正是同位网格（collocated grid）常见的一种失效模式。本动手编程练习提供了一个直接的对比，用一个“棋盘格”压力场来挑战两种网格[@problem_id:3289986]。你将通过数值计算验证同位网格存在奇偶解耦问题，而交错网格能够稳健地处理这类高频模式。", "problem": "考虑计算流体动力学 (CFD) 中的二维不可压缩压力-速度耦合问题，其中压力梯度驱动速度更新，离散散度算子强制执行质量守恒。当不当使用中心差分时，同位网格布置会产生奇偶解耦和压力棋盘格现象，而交错网格布置则能抑制这些模式。请设计一个人工解和离散算子，在纯数学背景下量化此现象。\n\n使用一个方形周期性域 $[0,1]\\times[0,1]$，将其离散为 $N\\times N$ 个大小为 $\\Delta x=\\Delta y=1/N$ 的均匀单元。压力 $p$ 定义在单元中心 $(x_i,y_j)$ 处，其中 $x_i=(i+\\tfrac{1}{2})\\Delta x$，$y_j=(j+\\tfrac{1}{2})\\Delta y$，指标 $i,j\\in\\{0,1,\\dots,N-1\\}$。\n\n人工解：\n- 棋盘格 (奈奎斯特) 模式：$p_{i,j}=(-1)^{i+j}$，对应于网格尺度上的交替模式。\n- 平滑模式：$p_{i,j}=\\sin(2\\pi x_i)\\sin(2\\pi y_j)$。\n\n具有周期性边界条件的离散算子：\n1. 单元中心的同位中心差分梯度和散度：\n   - 中心的梯度：\n     $$G_{x}^{c}(i,j)=\\frac{p_{i+1,j}-p_{i-1,j}}{2\\Delta x},\\quad G_{y}^{c}(i,j)=\\frac{p_{i,j+1}-p_{i,j-1}}{2\\Delta y}.$$\n   - 中心的梯度散度：\n     $$D^{c}G^{c}(i,j)=\\frac{G_{x}^{c}(i+1,j)-G_{x}^{c}(i-1,j)}{2\\Delta x}+\\frac{G_{y}^{c}(i,j+1)-G_{y}^{c}(i,j-1)}{2\\Delta y}.$$\n2. 面上的交错梯度和到中心的散度 (通量差分)：\n   - 面梯度：\n     $$G_{x}^{s}(i+\\tfrac{1}{2},j)=\\frac{p_{i+1,j}-p_{i,j}}{\\Delta x},\\quad G_{y}^{s}(i,j+\\tfrac{1}{2})=\\frac{p_{i,j+1}-p_{i,j}}{\\Delta y}.$$\n   - 面梯度到中心的散度：\n     $$D^{s}G^{s}(i,j)=\\frac{G_{x}^{s}(i+\\tfrac{1}{2},j)-G_{x}^{s}(i-\\frac{1}{2},j)}{\\Delta x}+\\frac{G_{y}^{s}(i,j+\\tfrac{1}{2})-G_{y}^{s}(i,j-\\tfrac{1}{2})}{\\Delta y}.$$\n\n将五点离散拉普拉斯算子定义为参考算子：\n$$L p_{i,j}=\\frac{p_{i+1,j}+p_{i-1,j}+p_{i,j+1}+p_{i,j-1}-4p_{i,j}}{\\Delta x^{2}}.$$\n\n为网格函数 $q_{i,j}$ 定义离散 $L^{2}$ 范数如下\n$$\\|q\\|_{2}=\\sqrt{\\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1} q_{i,j}^{2}\\,\\Delta x\\,\\Delta y}.$$\n\n对于每个测试用例，计算：\n- $L^{2}$ 误差 $E=\\|D^{\\star}G^{\\star}p-Lp\\|_{2}$，其中 $\\star\\in\\{c,s\\}$ 表示同位或交错。\n- 棋盘格振幅比 $A=\\|D^{\\star}G^{\\star}p\\|_{2}/\\|Lp\\|_{2}$。\n\n待研究的科学原理：\n- 证明同位算子 $D^{c}G^{c}$ 能消除奈奎斯特棋盘格模式，即产生 $A\\approx 0$，这表现为奇偶解耦和伪压力模式。\n- 证明交错算子 $D^{s}G^{s}$ 在两种模式下都与参考拉普拉斯算子匹配，即产生 $A\\approx 1$ 和 $E\\approx 0$，从而抑制了棋盘格现象。\n\n物理和数值单位：\n- 没有物理单位；所有量均为无量纲。角度（若有）以弧度为单位，但仅使用无量纲参数的三角函数。\n\n测试套件：\n- 用例 1：$N=8$，棋盘格模式，同位。\n- 用例 2：$N=8$，棋盘格模式，交错。\n- 用例 3：$N=32$，棋盘格模式，同位。\n- 用例 4：$N=4$，棋盘格模式，同位（边界粗网格）。\n- 用例 5：$N=32$，平滑模式，同位。\n- 用例 6：$N=32$，平滑模式，交错。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例的结果必须是按顺序包含浮点数 $[E,A]$ 的双元素列表。例如，输出格式必须为\n$$[ [E_{1},A_{1}], [E_{2},A_{2}], \\dots ]$$\n无任何附加文本。", "solution": "用户提供了有效的问题陈述。所有给定条件均已提取和验证。\n\n### **问题验证**\n\n**1. 给定条件提取：**\n- **域：** 方形周期性域 $[0,1]\\times[0,1]$。\n- **离散化：** $N\\times N$ 均匀网格，单元尺寸为 $\\Delta x=\\Delta y=1/N$。\n- **网格点：** 压力 $p$ 定义在单元中心 $(x_i,y_j)$，其中 $x_i=(i+\\frac{1}{2})\\Delta x$，$y_j=(j+\\frac{1}{2})\\Delta y$，指标 $i,j\\in\\{0,1,\\dots,N-1\\}$。\n- **人工解：**\n    - 棋盘格模式：$p_{i,j}=(-1)^{i+j}$。\n    - 平滑模式：$p_{i,j}=\\sin(2\\pi x_i)\\sin(2\\pi y_j)$。\n- **离散算子 (周期性)：**\n    - 同位梯度-散度：$D^{c}G^{c}(i,j)=\\frac{G_{x}^{c}(i+1,j)-G_{x}^{c}(i-1,j)}{2\\Delta x}+\\frac{G_{y}^{c}(i,j+1)-G_{y}^{c}(i,j-1)}{2\\Delta y}$，其中 $G_{x}^{c}(i,j)=\\frac{p_{i+1,j}-p_{i-1,j}}{2\\Delta x}$，$G_{y}^{c}(i,j)=\\frac{p_{i,j+1}-p_{i,j-1}}{2\\Delta y}$。\n    - 交错梯度-散度：$D^{s}G^{s}(i,j)=\\frac{G_{x}^{s}(i+\\frac{1}{2},j)-G_{x}^{s}(i-\\frac{1}{2},j)}{\\Delta x}+\\frac{G_{y}^{s}(i,j+\\tfrac{1}{2})-G_{y}^{s}(i,j-\\tfrac{1}{2})}{\\Delta y}$，其中 $G_{x}^{s}(i+\\frac{1}{2},j)=\\frac{p_{i+1,j}-p_{i,j}}{\\Delta x}$，$G_{y}^{s}(i,j+\\tfrac{1}{2})=\\frac{p_{i,j+1}-p_{i,j}}{\\Delta y}$。\n- **参考算子 (拉普拉斯算子)：** $L p_{i,j}=\\frac{p_{i+1,j}+p_{i-1,j}+p_{i,j+1}+p_{i,j-1}-4p_{i,j}}{\\Delta x^{2}}$。\n- **范数：** 离散 $L^{2}$ 范数 $\\|q\\|_{2}=\\sqrt{\\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1} q_{i,j}^{2}\\,\\Delta x\\,\\Delta y}$。\n- **度量指标：** 误差 $E=\\|D^{\\star}G^{\\star}p-Lp\\|_{2}$ 和振幅比 $A=\\|D^{\\star}G^{\\star}p\\|_{2}/\\|Lp\\|_{2}$，其中 $\\star\\in\\{c,s\\}$。\n- **测试用例：** 指定了六个测试用例，改变 $N$、压力模式和算子类型。\n\n**2. 验证：**\n- **科学合理性：** 该问题在科学上是合理的。它构建了一个经典的数值分析实验，用于研究同位网格有限差分格式中的奇偶解耦现象，这是计算流体动力学中的一个基本课题。所用的算子和人工解是标准的验证工具。\n- **适定性：** 该问题是适定的。所有的数学对象（域、网格、算子、范数）都有精确定义。任务是定量的，并且对于每个测试用例都能得到唯一的、可计算的结果。\n- **客观性：** 问题陈述是客观的，使用了形式化的数学语言，没有歧义或主观论断。\n- **结论：** 问题是有效的且自洽的。\n\n**3. 操作：** 继续求解。\n\n### **理论分析与求解方法**\n\n目标是量化同位和交错网格布置对特定压力场的响应。分析的核心在于展开复合的梯度散度算子 $D^{\\star}G^{\\star}$，并将其与参考的五点拉普拉斯算子 $L$ 进行比较。所有的指标运算都对 $N$ 取模，以强制执行周期性边界条件。\n\n**交错算子分析**\n首先，我们分析交错算子 $D^{s}G^{s}$。通过将面梯度的定义代入散度表达式，我们得到算子对压力场 $p_{i,j}$ 的作用。\n散度的 $x$ 分量是：\n$$ \\frac{G_{x}^{s}(i+\\frac{1}{2},j)-G_{x}^{s}(i-\\frac{1}{2},j)}{\\Delta x} = \\frac{1}{\\Delta x} \\left( \\frac{p_{i+1,j}-p_{i,j}}{\\Delta x} - \\frac{p_{i,j}-p_{i-1,j}}{\\Delta x} \\right) = \\frac{p_{i+1,j}-2p_{i,j}+p_{i-1,j}}{\\Delta x^2} $$\n$y$ 分量是类似的。将它们相加并注意到 $\\Delta x = \\Delta y$，我们发现：\n$$ D^{s}G^{s}p_{i,j} = \\frac{p_{i+1,j}-2p_{i,j}+p_{i-1,j}}{\\Delta x^2} + \\frac{p_{i,j+1}-2p_{i,j}+p_{i,j-1}}{\\Delta y^2} = \\frac{p_{i+1,j}+p_{i-1,j}+p_{i,j+1}+p_{i,j-1}-4p_{i,j}}{\\Delta x^2} $$\n此表达式与参考的五点拉普拉斯算子 $Lp_{i,j}$ 的定义完全相同。\n$$ D^{s}G^{s}p_{i,j} \\equiv Lp_{i,j} $$\n因此，对于交错布置，误差 $E=\\|D^{s}G^{s}p-Lp\\|_{2}$ 将恒为零（在机器精度范围内），并且对于任何 $\\|Lp\\|_2 \\neq 0$ 的压力场，振幅比 $A=\\|D^{s}G^{s}p\\|_{2}/\\|Lp\\|_{2}$ 将恒为 1。该格式正确地表示了压力拉普拉斯算子。\n\n**同位算子分析**\n接下来，我们分析同位算子 $D^{c}G^{c}$。我们将中心差分梯度代入中心差分散度。\n散度的 $x$ 分量是：\n$$ \\frac{G_{x}^{c}(i+1,j)-G_{x}^{c}(i-1,j)}{2\\Delta x} = \\frac{1}{2\\Delta x} \\left( \\frac{p_{i+2,j}-p_{i,j}}{2\\Delta x} - \\frac{p_{i,j}-p_{i-2,j}}{2\\Delta x} \\right) = \\frac{p_{i+2,j}-2p_{i,j}+p_{i-2,j}}{4\\Delta x^2} $$\n$y$ 分量是类似的。将它们相加得到：\n$$ D^{c}G^{c}p_{i,j} = \\frac{p_{i+2,j}+p_{i-2,j}+p_{i,j+2}+p_{i,j-2}-4p_{i,j}}{4\\Delta x^2} $$\n这个算子是一个五点拉普拉斯算子，但它作用在一个间距为 $2\\Delta x$ 的模板上，而不是 $\\Delta x$。模板的这种差异是解耦现象的根本原因。\n\n**应用于人工解**\n\n1. **棋盘格 (奈奎斯特) 模式：** $p_{i,j} = (-1)^{i+j}$\n   - **同位算子：** 我们应用展开的 $D^{c}G^{c}$ 算子。注意 $p_{i\\pm 2,j} = (-1)^{(i\\pm 2)+j} = (-1)^2 (-1)^{i+j} = p_{i,j}$。类似地，$p_{i,j\\pm 2} = p_{i,j}$。将这些代入算子表达式得到：\n     $$ D^{c}G^{c}p_{i,j} = \\frac{p_{i,j}+p_{i,j}+p_{i,j}+p_{i,j}-4p_{i,j}}{4\\Delta x^2} = 0 $$\n     同位算子消除了棋盘格模式。它位于算子的零空间中。这意味着 $\\|D^{c}G^{c}p\\|_{2} = 0$，因此振幅比 $A=0$。这是奇偶解耦的数学特征：一个非零的压力模式产生了零压力梯度，从而无法驱动流体运动。\n   - **参考拉普拉斯算子：** 将 $L$ 应用于棋盘格模式：$p_{i\\pm 1, j} = -p_{i,j}$ 且 $p_{i, j\\pm 1} = -p_{i,j}$。\n     $$ Lp_{i,j} = \\frac{-p_{i,j}-p_{i,j}-p_{i,j}-p_{i,j}-4p_{i,j}}{\\Delta x^2} = \\frac{-8p_{i,j}}{\\Delta x^2} = -8N^2 p_{i,j} $$\n     这显然是非零的。误差为 $E = \\|D^{c}G^{c}p - Lp\\|_{2} = \\|0 - Lp\\|_{2} = \\|Lp\\|_{2}$。我们可以计算这个范数：\n     $$ \\|Lp\\|_{2}^2 = \\sum_{i,j=0}^{N-1} (-8N^2 p_{i,j})^2 \\Delta x \\Delta y = \\sum_{i,j=0}^{N-1} 64N^4 ((-1)^{i+j})^2 \\frac{1}{N^2} = \\frac{64N^4}{N^2} \\sum_{i,j=0}^{N-1} 1 = 64N^2 \\cdot N^2 = 64N^4 $$\n     因此，$E = \\|Lp\\|_{2} = \\sqrt{64N^4} = 8N^2$。\n   - **交错算子：** 如前所示，$D^s G^s p = Lp$。因此，$E=0$ 且 $A=1$。交错格式正确地解析了棋盘格模式。\n\n2. **平滑模式：** $p_{i,j} = \\sin(2\\pi x_i)\\sin(2\\pi y_j)$\n   - **交错算子：** 同样地，$D^s G^s p = Lp$，所以 $E=0$ 且 $A=1$。该算子相对于参考拉普拉斯算子是精确的。\n   - **同位算子：** $D^c G^c$ 和 $L$ 算子都是连续拉普拉斯算子 $\\nabla^2$ 的二阶精确近似。然而，它们并不相同。它们的截断误差不同。\n     对于一个平滑函数 $f(x)$，主导误差项为：\n     $$ Lf - f'' = \\frac{\\Delta x^2}{12} f^{(4)} + O(\\Delta x^4) $$\n     $$ (D^c G^c f)_{\\text{1D}} - f'' = \\frac{(2\\Delta x)^2}{12} f^{(4)} + O(\\Delta x^4) = \\frac{4\\Delta x^2}{12} f^{(4)} + O(\\Delta x^4) $$\n     同位算子的截断误差要大四倍。它们的差值 $D^c G^c p - Lp$ 是非零的，导致非零误差 $E$。由于对于这种平滑的长波模式，两个算子都为相同的底层连续算子提供了合理的近似，它们的范数将是相似的，从而导致振幅比 $A \\approx 1$。\n\n**预测总结**\n- **用例 1, 3, 4 (棋盘格，同位)：** $A=0$, $E=8N^2$。\n- **用例 2 (棋盘格，交错)：** $A=1$, $E=0$。\n- **用例 5 (平滑，同位)：** $A \\approx 1$, $E > 0$。\n- **用例 6 (平滑，交错)：** $A=1$, $E=0$。\n\n这些理论预测将通过数值实现来验证。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_case(N, mode, op_type):\n    \"\"\"\n    Computes the error E and amplitude ratio A for a single test case.\n    \n    Args:\n        N (int): Number of grid cells in each dimension.\n        mode (str): Type of manufactured solution ('checkerboard' or 'smooth').\n        op_type (str): Type of discrete operator ('collocated' or 'staggered').\n\n    Returns:\n        tuple: A tuple containing the L2 error (E) and amplitude ratio (A).\n    \"\"\"\n    dx = 1.0 / N\n    dy = 1.0 / N\n\n    # Define grid indices and coordinates\n    i_indices = np.arange(N)\n    j_indices = np.arange(N)\n    ii, jj = np.meshgrid(i_indices, j_indices, indexing='ij')\n\n    # Construct the pressure field p\n    if mode == 'checkerboard':\n        p = (-1.0)**(ii + jj)\n    elif mode == 'smooth':\n        # Cell-centered coordinates\n        x = (ii + 0.5) * dx\n        y = (jj + 0.5) * dy\n        p = np.sin(2.0 * np.pi * x) * np.sin(2.0 * np.pi * y)\n    else:\n        raise ValueError(\"Unknown mode type\")\n\n    # --- Operator Calculations ---\n\n    # Periodic shifts for stencils\n    # i-direction shifts\n    p_ip1 = np.roll(p, -1, axis=0) # Index i+1\n    p_im1 = np.roll(p,  1, axis=0) # Index i-1\n    # j-direction shifts\n    p_jp1 = np.roll(p, -1, axis=1) # Index j+1\n    p_jm1 = np.roll(p,  1, axis=1) # Index j-1\n\n    # 1. Reference 5-point Laplacian (Lp)\n    # Since dx = dy, we use dx**2\n    Lp = (p_ip1 + p_im1 + p_jp1 + p_jm1 - 4.0 * p) / (dx**2)\n\n    # 2. Divergence-of-Gradient operator (DGp)\n    if op_type == 'collocated':\n        # Expanded form of D^c G^c operator\n        # This stencil uses points at i±2 and j±2\n        p_ip2 = np.roll(p, -2, axis=0)\n        p_im2 = np.roll(p,  2, axis=0)\n        p_jp2 = np.roll(p, -2, axis=1)\n        p_jm2 = np.roll(p,  2, axis=1)\n        DGp = (p_ip2 + p_im2 + p_jp2 + p_jm2 - 4.0 * p) / (4.0 * dx**2)\n    elif op_type == 'staggered':\n        # Expanded form of D^s G^s operator, which is identical to Lp\n        DGp = (p_ip1 + p_im1 + p_jp1 + p_jm1 - 4.0 * p) / (dx**2)\n    else:\n        raise ValueError(\"Unknown operator type\")\n\n    # --- Metric Calculations ---\n\n    def l2_norm(q_grid):\n        \"\"\"Computes the discrete L2 norm of a grid function.\"\"\"\n        cell_area = dx * dy\n        return np.sqrt(np.sum(q_grid**2 * cell_area))\n\n    # Calculate norms of the operator outputs\n    norm_Lp = l2_norm(Lp)\n    norm_DGp = l2_norm(DGp)\n    \n    # Calculate the L2 error E\n    error_field = DGp - Lp\n    E = l2_norm(error_field)\n\n    # Calculate the amplitude ratio A\n    # Avoid division by zero, although not expected for these test cases\n    if norm_Lp  1e-15:\n        # If Lp is zero, A is undefined. If DGp is also zero, 1 is a plausible value.\n        # If DGp is non-zero, the ratio is infinite.\n        A = 1.0 if norm_DGp  1e-15 else np.inf\n    else:\n        A = norm_DGp / norm_Lp\n\n    return E, A\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # (N, mode, operator_type)\n        (8, 'checkerboard', 'collocated'),\n        (8, 'checkerboard', 'staggered'),\n        (32, 'checkerboard', 'collocated'),\n        (4, 'checkerboard', 'collocated'),\n        (32, 'smooth', 'collocated'),\n        (32, 'smooth', 'staggered'),\n    ]\n\n    results = []\n    for N, mode, op_type in test_cases:\n        E, A = compute_case(N, mode, op_type)\n        results.append([E, A])\n\n    # Format the output as a list of lists string\n    # e.g., [[E1,A1],[E2,A2],...]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3289986"}, {"introduction": "除了测试单一的病态情况，更深入的稳定性分析需要考察整个耦合压力-速度系统的性质。本练习将对同位网格和交错网格的离散斯托克斯（Stokes）算子进行特征值分析[@problem_id:3289928]。通过确定算子零空间（null space）的维度，你将发现同位网格系统中存在虚假的“棋盘格”压力模式，这为交错网格旨在消除的不稳定性提供了严谨的解释。", "problem": "考虑在长度为 $1$ 的周期性域上的稳态一维不可压缩斯托克斯方程，记为 $-\\nu \\, \\partial_{xx} u + \\partial_x p = f$ 和 $\\partial_x u = 0$，其中 $u$ 是速度，$p$ 是压力，$\\nu  0$ 是运动粘度，$f$ 是给定的彻体力。设 $\\nu = 1$ 且 $f \\equiv 0$。在两种网格上离散化该系统：一种是同位网格（collocated grid），另一种是交错的标记-单元（Marker-and-Cell, MAC）网格，两者都具有周期性边界条件。使用具有 $N$ 个点的均匀网格，网格尺寸 $h = 1/N$，索引对 $N$ 取模。\n\n将每个网格的离散鞍点系统定义为分块矩阵\n$$\nK = \\begin{bmatrix}\nA  G \\\\\n-D  0\n\\end{bmatrix},\n$$\n其中 $A$ 是速度的离散扩散算子，$D$ 是离散散度，$G$ 是离散梯度。在两种网格上都强制采用对称兼容的选择 $G = -D^\\top$，以使 $K$ 是对称不定的。\n\n对于同位网格：\n- 将 $u$ 和 $p$ 都置于单元中心 $x_i = i h$，$i = 0, \\dots, N-1$。\n- 在单元中心使用标准二阶差分拉普拉斯算子作为 $A$：\n$$\n(A u)_i = \\nu \\frac{u_{i+1} - 2 u_i + u_{i-1}}{h^2}.\n$$\n- 在单元中心使用中心差分散度作为 $D$：\n$$\n(D u)_i = \\frac{u_{i+1} - u_{i-1}}{2 h}.\n$$\n- 设置 $G = -D^\\top$。\n\n对于交错的标记-单元（MAC）网格：\n- 将 $u$ 置于面 $x_{i+\\frac{1}{2}} = (i+\\frac{1}{2}) h$，将 $p$ 置于单元中心 $x_i = i h$，$i = 0, \\dots, N-1$。\n- 在面位置使用标准二阶差分拉普拉斯算子作为 $A$：\n$$\n(A u)_{i+\\frac{1}{2}} = \\nu \\frac{u_{i+\\frac{3}{2}} - 2 u_{i+\\frac{1}{2}} + u_{i-\\frac{1}{2}}}{h^2}.\n$$\n- 使用从面到中心的单边差分散度作为 $D$：\n$$\n(D u)_i = \\frac{u_{i+\\frac{1}{2}} - u_{i-\\frac{1}{2}}}{h}.\n$$\n- 设置 $G = -D^\\top$。\n\n对于每个网格，使用周期性环绕索引将 $K$ 组装成一个 $2N \\times 2N$ 的矩阵。计算 $K$ 的所有特征值 $\\{\\lambda_j\\}$，如果一个特征值满足 $|\\lambda_j| \\le \\tau$，则将其归类为近零特征值，其中 $\\tau = \\varepsilon \\cdot \\rho$，$\\rho = \\max_j |\\lambda_j|$ 且 $\\varepsilon = 10^{-8}$。\n\n任务：\n- 实现一个程序，对于每个指定的 $N$，构建两种离散化（同位和 MAC），组装相应的 $K$，计算所有特征值，并使用上面定义的阈值 $\\tau$ 为每个网格计数近零特征值的数量。\n- 对于每个测试用例 $N$，输出三元组 $[n_{\\mathrm{MAC}}, n_{\\mathrm{COL}}, n_{\\mathrm{COL}} - n_{\\mathrm{MAC}}]$，其中 $n_{\\mathrm{MAC}}$ 是 MAC 网格的近零计数，$n_{\\mathrm{COL}}$ 是同位网格的近零计数。\n\n使用以下网格尺寸的测试套件：\n- $N = 4$ (偶数网格),\n- $N = 5$ (奇数网格，用于探究交替模式的行为),\n- $N = 8$ (中等大小的偶数网格，理想路径),\n- $N = 32$ (较大的偶数网格)。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个元素格式化为无空格的方括号内的三元组。例如：\n- 如果有四个测试用例，输出必须如下所示\n$$\n[[a_1,b_1,c_1],[a_2,b_2,c_2],[a_3,b_3,c_3],[a_4,b_4,c_4]]\n$$\n其中每个 $a_k$、$b_k$ 和 $c_k$ 都是整数。", "solution": "用户要求我分析周期域上一维稳态不可压缩斯托克斯方程的离散算子的零空间。我将首先验证问题陈述，然后提供详细的解决方案。\n\n### 步骤1：提取已知条件\n- **方程**：\n  - 动量：$-\\nu \\, \\partial_{xx} u + \\partial_x p = f$\n  - 连续性：$\\partial_x u = 0$\n- **域**：周期性，长度 $L=1$。\n- **参数**：运动粘度 $\\nu = 1$，彻体力 $f \\equiv 0$。\n- **离散化**：具有 $N$ 个点的均匀网格，网格尺寸 $h = 1/N$。索引对 $N$ 取模。\n- **离散系统**：一个分块矩阵 $K = \\begin{bmatrix} A  G \\\\ -D  0 \\end{bmatrix}$，其中 $A$ 是离散扩散算子，$D$ 是离散散度，并且 $G = -D^\\top$ 以确保 $K$ 是对称的。\n- **同位网格**：\n  - 变量 $u$ 和 $p$ 位于单元中心 $x_i = i h$。\n  - 扩散 $A$：$(A u)_i = \\nu \\frac{u_{i+1} - 2 u_i + u_{i-1}}{h^2}$。\n  - 散度 $D$：$(D u)_i = \\frac{u_{i+1} - u_{i-1}}{2 h}$。\n- **交错（MAC）网格**：\n  - 速度 $u$ 位于面 $x_{i+\\frac{1}{2}} = (i+\\frac{1}{2}) h$，压力 $p$ 位于中心 $x_i = i h$。\n  - 扩散 $A$：$(A u)_{i+\\frac{1}{2}} = \\nu \\frac{u_{i+\\frac{3}{2}} - 2 u_{i+\\frac{1}{2}} + u_{i-\\frac{1}{2}}}{h^2}$。\n  - 散度 $D$：$(D u)_i = \\frac{u_{i+\\frac{1}{2}} - u_{i-\\frac{1}{2}}}{h}$。\n- **任务**：对于 $N \\in \\{4, 5, 8, 32\\}$，为两种网格组装 $2N \\times 2N$ 矩阵 $K$。计算 $K$ 的所有特征值 $\\{\\lambda_j\\}$。计数近零特征值的数量，定义为 $|\\lambda_j| \\le \\tau$，其中 $\\tau = \\varepsilon \\cdot \\rho$，$\\rho = \\max_j |\\lambda_j|$ 且 $\\varepsilon = 10^{-8}$。\n- **输出**：对于每个 $N$，提供三元组 $[n_{\\mathrm{MAC}}, n_{\\mathrm{COL}}, n_{\\mathrm{COL}} - n_{\\mathrm{MAC}}]$，其中 $n_{\\mathrm{MAC}}$ 和 $n_{\\mathrm{COL}}$ 分别是 MAC 和同位网格的近零计数。\n\n### 步骤2：使用提取的已知条件进行验证\n1.  **科学依据**：该问题涉及斯托克斯方程的数值分析，这是流体动力学中的一个基本模型。离散化方案（同位和交错 MAC）是计算流体动力学中的标准方法。分析离散算子的零空间（或核）是评估数值方法稳定性与准确性的关键步骤（与 LBB 或 inf-sup 条件相关）。该问题在科学上是合理的。\n2.  **适定性**：该问题为连续方程及其离散对应物提供了所有必要的定义。矩阵的构造被明确定义。计算特征值和计数近零模式的任务是明确的。该问题是适定的。\n3.  **客观性**：问题使用精确的数学和数值术语陈述。它不含主观性或观点。\n\n### 步骤3：结论与行动\n问题有效。我将继续进行解答。\n\n### 基于原理的解决方案\n该问题要求分析斯托克斯方程的离散鞍点算子 $K$ 的特征值，这有助于深入了解同位网格和交错网格离散化的稳定性。零特征值对应于 $K$ 的零空间中一个非平凡的向量 $(u, p)$。这个零空间的维数是离散化的一个关键属性。\n\n寻找 $K = \\begin{bmatrix} A  -D^\\top \\\\ -D  0 \\end{bmatrix}$ 零空间的方程组是：\n$$\n\\begin{cases}\nA u - D^\\top p = 0 \\\\\n-D u = 0\n\\end{cases}\n$$\n\n**连续系统分析**\n首先，考虑周期域上的连续问题。零空间由方程 $\\partial_x u = 0$ 和 $-\\nu \\partial_{xx} u + \\partial_x p = 0$ 决定。\n1.  由 $\\partial_x u = 0$ 可知，速度 $u$ 必须是一个常数，$u(x) = c_1$。\n2.  将其代入动量方程得到 $-\\nu \\partial_{xx} c_1 + \\partial_x p = 0$，简化为 $\\partial_x p = 0$。因此，压力 $p$ 也必须是一个常数，$p(x) = c_2$。\n因此，零空间由数对 $(u, p) = (c_1, 0)$（恒速模式，一种物理刚体运动）和 $(u, p) = (0, c_2)$（恒压模式，一种规范自由度，因为压力仅在相差一个常数的意义下确定）张成。连续算子具有一个二维零空间。一个稳定的离散化应能复现此属性。\n\n**交错（MAC）网格分析**\n在 MAC 网格上，散度算子为 $(D u)_i = (u_{i+1/2} - u_{i-1/2})/h$。\n- 条件 $Du = 0$ 意味着对所有 $i=0, \\dots, N-1$ 都有 $u_{i+1/2} - u_{i-1/2} = 0$。由于周期性，这意味着所有速度分量都相等：$u_{1/2} = u_{3/2} = \\dots = u_{N-1/2}$。$D$ 的零空间 $\\ker(D)$ 仅由恒速向量组成。因此，任何零空间速度模式 $u$ 都必须是一个常数向量，$u = c_1 \\vec{1}$。\n- 系统中的类梯度算子是 $-D^\\top$。其作用为 $(-D^\\top p)_{i+1/2} = (p_i - p_{i+1})/h$。条件 $D^\\top p = 0$ 意味着对所有 $i$ 都有 $p_i - p_{i+1} = 0$，即 $p$ 是一个常数向量，$p = c_2 \\vec{1}$。\n- 现在我们检查整个系统。\n  1. 对于恒压模式 $(u, p) = (0, c_2\\vec{1})$：$A(0) - D^\\top(c_2\\vec{1}) = 0$（因为 $D^\\top$ 零化常数向量）且 $-D(0) = 0$。这是一个零向量。\n  2. 对于恒速模式 $(u, p) = (c_1\\vec{1}, 0)$：$-D(c_1\\vec{1}) = 0$（因为 $D$ 零化常数向量）且 $A(c_1\\vec{1}) - D^\\top(0) = 0$（因为离散拉普拉斯算子 $A$ 在周期域上也零化常数向量）。这也是一个零向量。\n$K_{\\mathrm{MAC}}$ 的零空间由 $(\\vec{1}, 0)$ 和 $(0, \\vec{1})$ 张成，正确地再现了连续算子的二维零空间。我们期望对于所有 $N$，都能找到 $n_{\\mathrm{MAC}} = 2$ 个近零特征值。\n\n**同位网格分析**\n在同位网格上，散度算子为 $(D u)_i = (u_{i+1} - u_{i-1})/(2h)$。\n- 条件 $Du = 0$ 意味着对所有 $i$ 都有 $u_{i+1} = u_{i-1}$。这意味着偶数索引处的值相等（$u_0 = u_2 = u_4 = \\dots$），奇数索引处的值也相等（$u_1 = u_3 = u_5 = \\dots$）。\n  - 如果 $N$ 是奇数，这将迫使所有元素相等，因此 $\\ker(D)$ 仅包含常数向量，就像 MAC 网格一样。\n  - 如果 $N$ 是偶数，$\\ker(D)$ 是二维的。它由常数向量 $\\vec{1} = (1, 1, \\dots, 1)^\\top$ 和高频“棋盘”或“之字形”模式 $u_s = (1, -1, 1, -1, \\dots)^\\top$ 张成。这个 $u_s$ 模式是非物理的，是这种离散化的一个已知人为产物，会导致不稳定性。\n- 算子 $D$ 是斜对称的（$D^\\top = -D$），所以 $\\ker(D^\\top) = \\ker(D)$。这意味着 $D^\\top$ 也零化常数向量，并且对于偶数 $N$，也零化棋盘模式。\n- 我们现在检查 $K_{\\mathrm{COL}}$ 的零空间。与 MAC 情况一样的原因，物理模式 $(\\vec{1}, 0)$ 和 $(0, \\vec{1})$ 位于零空间中。这对于任何 $N$ 都给出了两个零模式。\n- 考虑 $N$ 为偶数的情况。可能存在一个额外的伪压力模式。我们测试一下数对 $(u, p) = (0, p_s)$，其中 $p_s$ 是棋盘模式。\n  1. $-Du = -D(0) = 0$ 吗？是的。\n  2. $Au - D^\\top p_s = A(0) - D^\\top p_s = -D^\\top p_s = 0$ 吗？是的，因为 $p_s \\in \\ker(D^\\top)$。\n  因此，对于偶数 $N$，$(0, p_s)$ 是 $K_{\\mathrm{COL}}$ 的一个零向量。这是一个纯粹的数值伪影，一个伪压力模式。\n- 因此，对于偶数 $N$，$K_{\\mathrm{COL}}$ 的零空间是三维的，由 $(\\vec{1}, 0)$、$(0, \\vec{1})$ 和 $(0, p_s)$ 张成。对于奇数 $N$，棋盘模式不存在于 $\\ker(D)$ 中，因此零空间是二维的。\n\n**预测结果**\n- 对于 $N=4, 8, 32$ (偶数)：$n_{\\mathrm{MAC}}=2$，$n_{\\mathrm{COL}}=3$。三元组为 $[2, 3, 1]$。\n- 对于 $N=5$ (奇数)：$n_{\\mathrm{MAC}}=2$，$n_{\\mathrm{COL}}=2$。三元组为 $[2, 2, 0]$。\n\n以下代码实现了这些矩阵的构建，并通过计算特征值来数值验证这些预测。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef construct_matrices(N, grid_type):\n    \"\"\"\n    Constructs the discrete operators A and D for a given grid size and type.\n\n    Args:\n        N (int): The number of grid points.\n        grid_type (str): Either 'collocated' or 'mac'.\n\n    Returns:\n        tuple[np.ndarray, np.ndarray]: The matrices A and D.\n    \"\"\"\n    if not isinstance(N, int) or N = 0:\n        raise ValueError(\"N must be a positive integer.\")\n\n    h = 1.0 / N\n    nu = 1.0\n\n    A = np.zeros((N, N), dtype=float)\n    D = np.zeros((N, N), dtype=float)\n\n    if grid_type == 'collocated':\n        for i in range(N):\n            # A matrix: Standard second-difference Laplacian at cell centers\n            A[i, i] = -2.0 * nu / h**2\n            A[i, (i - 1) % N] = 1.0 * nu / h**2\n            A[i, (i + 1) % N] = 1.0 * nu / h**2\n\n            # D matrix: Centered-difference divergence at cell centers\n            D[i, (i + 1) % N] = 1.0 / (2.0 * h)\n            D[i, (i - 1) % N] = -1.0 / (2.0 * h)\n            \n    elif grid_type == 'mac':\n        for i in range(N):\n            # A matrix: Standard second-difference Laplacian at faces\n            # The structure is identical to the collocated grid's A matrix\n            A[i, i] = -2.0 * nu / h**2\n            A[i, (i - 1) % N] = 1.0 * nu / h**2\n            A[i, (i + 1) % N] = 1.0 * nu / h**2\n\n            # D matrix: One-sided difference from faces to centers\n            D[i, i] = 1.0 / h\n            D[i, (i - 1) % N] = -1.0 / h\n    else:\n        raise ValueError(\"Invalid grid_type. Must be 'collocated' or 'mac'.\")\n\n    return A, D\n\ndef assemble_saddle_point_matrix(A, D):\n    \"\"\"\n    Assembles the symmetric saddle-point matrix K.\n\n    K = [ A  -D^T ]\n        [ -D   0  ]\n\n    Args:\n        A (np.ndarray): The N x N diffusion matrix.\n        D (np.ndarray): The N x N divergence matrix.\n\n    Returns:\n        np.ndarray: The 2N x 2N saddle-point matrix K.\n    \"\"\"\n    N = A.shape[0]\n    K = np.zeros((2 * N, 2 * N), dtype=float)\n    \n    # Upper-left block (A)\n    K[:N, :N] = A\n    # Upper-right block (G = -D^T)\n    K[:N, N:] = -D.T\n    # Lower-left block (-D)\n    K[N:, :N] = -D\n    # Lower-right block is zero\n\n    return K\n\ndef count_near_null_eigenvalues(K, epsilon=1e-8):\n    \"\"\"\n    Computes eigenvalues of K and counts how many are near-null.\n\n    Args:\n        K (np.ndarray): The matrix to analyze.\n        epsilon (float): Relative tolerance for defining \"near-null\".\n\n    Returns:\n        int: The number of near-null eigenvalues.\n    \"\"\"\n    # K is constructed to be symmetric, so use eigvalsh for numerical stability\n    eigenvalues = np.linalg.eigvalsh(K)\n    \n    # Get the spectral radius (max absolute eigenvalue)\n    rho = np.max(np.abs(eigenvalues))\n    \n    # Define the absolute tolerance for being near-null\n    # Avoid rho=0 for a zero matrix\n    if rho == 0:\n        tau = epsilon\n    else:\n        tau = epsilon * rho\n\n    # Count eigenvalues whose absolute value is within the tolerance\n    near_null_count = np.sum(np.abs(eigenvalues) = tau)\n    \n    return int(near_null_count)\n\ndef solve():\n    \"\"\"\n    Main function to execute the problem for the specified test cases.\n    \"\"\"\n    test_cases = [4, 5, 8, 32]\n    \n    results = []\n    \n    for N in test_cases:\n        # Collocated grid\n        A_col, D_col = construct_matrices(N, 'collocated')\n        K_col = assemble_saddle_point_matrix(A_col, D_col)\n        n_col = count_near_null_eigenvalues(K_col)\n        \n        # Staggered (MAC) grid\n        A_mac, D_mac = construct_matrices(N, 'mac')\n        K_mac = assemble_saddle_point_matrix(A_mac, D_mac)\n        n_mac = count_near_null_eigenvalues(K_mac)\n        \n        # Store the result triple\n        results.append([n_mac, n_col, n_col - n_mac])\n\n    # Format the final output string as specified\n    string_parts = []\n    for r in results:\n        string_parts.append(f\"[{r[0]},{r[1]},{r[2]}]\")\n    final_output = f\"[{','.join(string_parts)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "3289928"}]}