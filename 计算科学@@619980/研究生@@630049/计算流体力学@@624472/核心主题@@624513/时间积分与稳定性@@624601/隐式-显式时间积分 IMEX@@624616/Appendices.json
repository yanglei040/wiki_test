{"hands_on_practices": [{"introduction": "一个高效的IMEX格式并非凭空产生，而是通过满足一系列代数约束（即阶条件）来精心设计的。本练习将引导你亲手构建一个经典的二阶IMEX格式，即Ascher–Ruuth–Spiteri (ARS)格式。通过推导其系数，你将体会到设计一个既能保证高阶精度，又具备刚性精度等优良特性的数值方法所蕴含的数学匠心 [@problem_id:3334236]。", "problem": "考虑一个来自计算流体动力学的半离散守恒律，其形式为 $u^{\\prime}(t) = f(u(t)) + g(u(t))$，其中 $f$ 是待显式积分的非刚性部分，$g$ 是待隐式积分的刚性部分。我们寻求一种 Ascher–Ruuth–Spiteri 类型的两阶隐-显 (IMEX) 加性龙格-库塔 (ARK) 方法，记作 ARS$(2,2,2)$，其显式和隐式部分的系数矩阵 $A^{E}$ 和 $A^{I}$ 为下三角矩阵，权重为 $b^{E}$ 和 $b^{I}$。\n\n该两阶 IMEX 方法的内部阶 $Y_{i}$（$i=1,2$）定义为\n$$\nY_{i} \\;=\\; u^{n} \\;+\\; h \\sum_{j=1}^{i-1} a^{E}_{ij} f(Y_{j}) \\;+\\; h \\sum_{j=1}^{i} a^{I}_{ij} g(Y_{j}),\n$$\n步长更新公式为\n$$\nu^{n+1} \\;=\\; u^{n} \\;+\\; h \\sum_{i=1}^{2} b^{E}_{i} f(Y_{i}) \\;+\\; h \\sum_{i=1}^{2} b^{I}_{i} g(Y_{i}).\n$$\n假设 $A^{E}$ 是严格下三角矩阵，$A^{I}$ 是下三角且对角隐式的矩阵。施加以下设计要求：\n- 通过强制执行截至二阶的加性龙格-库塔阶条件（从 $y^{\\prime} = f + g$ 的泰勒/B级数展开至 $h^{2}$ 项导出），使加性分裂达到二阶精度。\n- 当另一部分不存在时，各部分具有一阶相容性；当另一部分为零时，各部分具有二阶精度。\n- 隐式部分具有刚性精度，这意味着 $b^{I}$ 等于 $A^{I}$ 的最后一行，并且第二个隐式横坐标为 $1$。\n- 使用单对角隐式结构，其中 $a^{I}_{11} = a^{I}_{22} = \\gamma$，并指定 $\\gamma = 1 - 1/\\sqrt{2}$。\n\n设 $A^{E}$ 只有一个非零系数 $a^{E}_{21}$，设 $A^{I}$ 中的 $a^{I}_{21}$ 未知，而 $a^{I}_{11} = a^{I}_{22} = \\gamma$ 是固定的。确定满足上述所有要求的 $a^{E}_{21}$、$a^{I}_{21}$、$b^{E}_{1}$、$b^{E}_{2}$、$b^{I}_{1}$ 和 $b^{I}_{2}$ 的具体值。\n\n将您的结果以单行矩阵的形式报告，顺序如下\n$$\n\\bigl(a^{E}_{21},\\, a^{I}_{11},\\, a^{I}_{21},\\, a^{I}_{22},\\, b^{E}_{1},\\, b^{E}_{2},\\, b^{I}_{1},\\, b^{I}_{2}\\bigr).\n$$\n不要近似；给出最简闭式形式的精确表达式。无需单位。", "solution": "该问题要求确定一个两阶、刚性精度的隐-显 (IMEX) 加性龙格-库塔 (ARK) 方法的系数。该方法应用于半离散守恒律 $u^{\\prime}(t) = f(u(t)) + g(u(t))$，其中 $f$ 被显式处理，$g$ 被隐式处理。\n\n该方法由以下关于内部阶 $Y_i$ 和最终更新 $u^{n+1}$ 的方程定义：\n$$ Y_{i} = u^{n} + h \\sum_{j=1}^{i-1} a^{E}_{ij} f(Y_{j}) + h \\sum_{j=1}^{i} a^{I}_{ij} g(Y_{j}) \\quad \\text{for } i=1,2 $$\n$$ u^{n+1} = u^{n} + h \\sum_{i=1}^{2} b^{E}_{i} f(Y_{i}) + h \\sum_{i=1}^{2} b^{I}_{i} g(Y_{i}) $$\n这些系数被组织在布彻表中。根据问题特定的约束条件，系数矩阵 $A^E$ 和 $A^I$ 以及权重向量 $b^E$ 和 $b^I$ 为：\n$$\nA^{E} = \\begin{pmatrix} 0 & 0 \\\\ a^{E}_{21} & 0 \\end{pmatrix}, \\quad b^{E} = \\begin{pmatrix} b^{E}_{1} \\\\ b^{E}_{2} \\end{pmatrix}\n$$\n$$\nA^{I} = \\begin{pmatrix} a^{I}_{11} & 0 \\\\ a^{I}_{21} & a^{I}_{22} \\end{pmatrix}, \\quad b^{I} = \\begin{pmatrix} b^{I}_{1} \\\\ b^{I}_{2} \\end{pmatrix}\n$$\n单对角隐式 (SDIRK) 结构意味着 $a^{I}_{11} = a^{I}_{22} = \\gamma$，其指定值为 $\\gamma = 1 - 1/\\sqrt{2}$。因此，\n$$\nA^{I} = \\begin{pmatrix} \\gamma & 0 \\\\ a^{I}_{21} & \\gamma \\end{pmatrix}\n$$\n任务是找到未知数 $a^{E}_{21}$、$a^{I}_{21}$、$b^{E}_{1}$、$b^{E}_{2}$、$b^{I}_{1}$ 和 $b^{I}_{2}$ 的具体值。我们通过系统地应用给定的设计要求来继续。\n\n首先，我们分别定义显式和隐式横坐标，$c^E_i = \\sum_{j=1}^{i-1} a^E_{ij}$ 和 $c^I_i = \\sum_{j=1}^{i} a^I_{ij}$。\n对于给定的结构：\n$c^{E}_{1} = 0$\n$c^{E}_{2} = a^{E}_{21}$\n$c^{I}_{1} = a^{I}_{11} = \\gamma$\n$c^{I}_{2} = a^{I}_{21} + a^{I}_{22} = a^{I}_{21} + \\gamma$\n\n我们现在利用设计要求。“刚性精度”要求尤其有效。它规定 $b^{I}$ 等于 $A^{I}$ 的最后一行，且第二个隐式横坐标为 $1$。\n1.  $b^{I}_{i} = a^{I}_{2i}$，对于 $i=1,2$。这意味着 $b^{I}_{1} = a^{I}_{21}$ 和 $b^{I}_{2} = a^{I}_{22}$。\n2.  第二个隐式横坐标 $c^{I}_{2}=1$。\n\n由 $b^{I}_{2} = a^{I}_{22}$ 和 SDIRK 条件 $a^{I}_{22}=\\gamma$，我们得到 $b^{I}_{2} = \\gamma = 1 - 1/\\sqrt{2}$。\n由 $c^{I}_{2}=1$，我们有 $a^{I}_{21} + \\gamma = 1$，这给出 $a^{I}_{21} = 1 - \\gamma = 1 - (1 - 1/\\sqrt{2}) = 1/\\sqrt{2}$。\n由 $b^{I}_{1} = a^{I}_{21}$，我们接着找到 $b^{I}_{1} = 1/\\sqrt{2}$。\n\n至此，隐式部分的所有系数都已确定：\n$a^{I}_{11} = \\gamma = 1 - 1/\\sqrt{2}$\n$a^{I}_{21} = 1/\\sqrt{2}$\n$a^{I}_{22} = \\gamma = 1 - 1/\\sqrt{2}$\n$b^{I}_{1} = 1/\\sqrt{2}$\n$b^{I}_{2} = 1 - 1/\\sqrt{2}$\n\n接下来，我们强制执行阶条件。问题要求加性分裂和每个独立部分都具有二阶精度。二阶 IMEX-ARK 格式的阶条件是：\n(A) $\\sum_{i=1}^{2} b^{I}_{i} = 1$\n(B) $\\sum_{i=1}^{2} b^{E}_{i} = 1$\n(C) $\\sum_{i=1}^{2} b^{I}_{i} c^{I}_{i} = 1/2$\n(D) $\\sum_{i=1}^{2} b^{E}_{i} c^{E}_{i} = 1/2$\n(E) $\\sum_{i=1}^{2} b^{E}_{i} c^{I}_{i} = 1/2$ (耦合条件)\n(F) $\\sum_{i=1}^{2} b^{I}_{i} c^{E}_{i} = 1/2$ (耦合条件)\n\n让我们用我们已确定的隐式系数来检查条件 (A) 和 (C)。这些条件必须成立，问题才有效。\n条件 (A): $\\sum b^{I}_{i} = b^{I}_{1} + b^{I}_{2} = (1/\\sqrt{2}) + (1 - 1/\\sqrt{2}) = 1$。此条件满足。\n条件 (C): $\\sum b^{I}_{i} c^{I}_{i} = b^{I}_{1}c^{I}_{1} + b^{I}_{2}c^{I}_{2} = (1/\\sqrt{2})(\\gamma) + (1-1/\\sqrt{2})(1) = (1/\\sqrt{2})(1-1/\\sqrt{2}) + (1-1/\\sqrt{2}) = 1/\\sqrt{2} - 1/2 + 1 - 1/\\sqrt{2} = 1/2$。此条件也满足。\n\n现在我们使用剩下的条件 (B)、(D)、(E)、(F) 来找到显式系数 $a^{E}_{21}$、$b^{E}_{1}$ 和 $b^{E}_{2}$。我们有一个包含三个未知数的四个方程组，该方程组必须是相容的。\n(B) $b^{E}_{1} + b^{E}_{2} = 1$\n(D) $b^{E}_{1}c^{E}_{1} + b^{E}_{2}c^{E}_{2} = b^{E}_{1}(0) + b^{E}_{2}(a^{E}_{21}) = b^{E}_{2}a^{E}_{21} = 1/2$\n(E) $b^{E}_{1}c^{I}_{1} + b^{E}_{2}c^{I}_{2} = b^{E}_{1}(\\gamma) + b^{E}_{2}(1) = 1/2$\n(F) $b^{I}_{1}c^{E}_{1} + b^{I}_{2}c^{E}_{2} = b^{I}_{1}(0) + b^{I}_{2}(a^{E}_{21}) = b^{I}_{2}a^{E}_{21} = 1/2$\n\n从条件 (F)，我们可以解出 $a^{E}_{21}$：\n$a^{E}_{21} = \\frac{1/2}{b^{I}_{2}} = \\frac{1/2}{1 - 1/\\sqrt{2}} = \\frac{1}{2 - \\sqrt{2}} = \\frac{2+\\sqrt{2}}{(2-\\sqrt{2})(2+\\sqrt{2})} = \\frac{2+\\sqrt{2}}{4-2} = 1 + \\frac{1}{\\sqrt{2}}$。\n\n接下来，从条件 (D)，我们解出 $b^{E}_{2}$：\n$b^{E}_{2} = \\frac{1/2}{a^{E}_{21}} = \\frac{1/2}{1 + 1/\\sqrt{2}} = \\frac{1}{2 + \\sqrt{2}} = \\frac{2-\\sqrt{2}}{(2+\\sqrt{2})(2-\\sqrt{2})} = \\frac{2-\\sqrt{2}}{4-2} = 1 - \\frac{1}{\\sqrt{2}}$。\n\n从条件 (B)，我们找到 $b^{E}_{1}$：\n$b^{E}_{1} = 1 - b^{E}_{2} = 1 - (1 - 1/\\sqrt{2}) = 1/\\sqrt{2}$。\n\n最后，我们必须验证这些值是否满足剩下的条件 (E) 以确保相容性。\n左侧 = $b^{E}_{1}(\\gamma) + b^{E}_{2}(1) = (1/\\sqrt{2})(1-1/\\sqrt{2}) + (1-1/\\sqrt{2})(1)$\n左侧 = $(1/\\sqrt{2} - 1/2) + 1 - 1/\\sqrt{2} = 1 - 1/2 = 1/2$。\n右侧 = $1/2$。\n该条件得到满足，证实了问题的相容性和我们解的唯一性。\n\n完整的系数集是：\n$a^{E}_{21} = 1 + \\frac{1}{\\sqrt{2}}$\n$a^{I}_{11} = 1 - \\frac{1}{\\sqrt{2}}$\n$a^{I}_{21} = \\frac{1}{\\sqrt{2}}$\n$a^{I}_{22} = 1 - \\frac{1}{\\sqrt{2}}$\n$b^{E}_{1} = \\frac{1}{\\sqrt{2}}$\n$b^{E}_{2} = 1 - \\frac{1}{\\sqrt{2}}$\n$b^{I}_{1} = \\frac{1}{\\sqrt{2}}$\n$b^{I}_{2} = 1 - \\frac{1}{\\sqrt{2}}$\n这些值将以单行矩阵的形式报告。", "answer": "$$\n\\boxed{\\begin{pmatrix} 1 + \\frac{1}{\\sqrt{2}} & 1 - \\frac{1}{\\sqrt{2}} & \\frac{1}{\\sqrt{2}} & 1 - \\frac{1}{\\sqrt{2}} & \\frac{1}{\\sqrt{2}} & 1 - \\frac{1}{\\sqrt{2}} & \\frac{1}{\\sqrt{2}} & 1 - \\frac{1}{\\sqrt{2}} \\end{pmatrix}}\n$$", "id": "3334236"}, {"introduction": "构建了一个数值格式后，其稳定性是首要关注的问题。本练习将介绍冯·诺依曼（Fourier）稳定性分析这一基本工具，它对于分析线性问题的稳定性至关重要。通过将其应用于标准的对流-扩散方程，我们将能够精确地确定显式部分的时间步长限制，从而保证数值解的有界性 [@problem_id:3334251]。", "problem": "考虑一维空间中的线性对流-扩散方程，\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = \\nu \\frac{\\partial^{2} u}{\\partial x^{2}},\n$$\n该方程定义在一个周期性区域上，使用间距为 $\\Delta x$ 的均匀网格。设对流速度 $a$ 和运动粘度 $\\nu$ 为非负常数。对一个二阶两步隐式-显式（IMEX）龙格-库塔（RK）方法进行冯·诺依曼（傅里叶）稳定性分析，其中对流项作显式处理，扩散项作隐式处理。\n\n假设使用以下半离散空间算子：\n- 对于 $a \\ge 0$ 的对流项，使用一阶迎风差分 $D^{-} u_{j} = (u_{j} - u_{j-1})/\\Delta x$，其对于波数 $\\theta \\in [0,\\pi]$ 的离散傅里叶符号为 $-a (1 - \\exp(-\\mathrm{i}\\theta))/\\Delta x$，\n- 对于扩散项，使用二阶中心拉普拉斯算子 $L u_{j} = (u_{j+1} - 2 u_{j} + u_{j-1})/\\Delta x^{2}$，其离散傅里叶符号为 $-4 \\nu \\sin^{2}(\\theta/2)/\\Delta x^{2}$。\n\n定义库朗数和扩散数，\n$$\nC = \\frac{a \\Delta t}{\\Delta x}, \\qquad D = \\frac{\\nu \\Delta t}{\\Delta x^{2}},\n$$\n并考虑使用参数为\n$$\n\\gamma = 1 - \\frac{1}{\\sqrt{2}},\n$$\n的 Ascher–Ruuth–Spiteri 二阶两步 IMEX RK 格式，其显式和隐式布彻表为\n$$\n\\text{显式（对流）：}\\quad \n\\begin{array}{c|cc}\n0 & 0 & 0 \\\\\n1 & 1 & 0 \\\\\n\\hline\n  & \\tfrac{1}{2} & \\tfrac{1}{2}\n\\end{array}\n\\qquad\n\\text{隐式（扩散）：}\\quad \n\\begin{array}{c|cc}\n\\gamma & \\gamma & 0 \\\\\n1-\\gamma & 1 - 2\\gamma & \\gamma \\\\\n\\hline\n  & \\tfrac{1}{2} & \\tfrac{1}{2}\n\\end{array}.\n$$\n\n令 $G(\\theta)$ 表示此 IMEX RK 方法应用于波数为 $\\theta$ 的傅里叶模态的半离散系统时的单步放大因子。从第一性原理出发推导 $G(\\theta)$，并确定最大库朗数 $C_{\\max}$，使得该格式对于所有离散波数在冯·诺依曼意义下都是稳定的，即：\n$$\n|G(\\theta)| \\le 1 \\quad \\text{对于所有} \\quad \\theta \\in [0,\\pi],\n$$\n对任意非负扩散数 $D \\ge 0$ 一致成立。请用一个无量纲数表示你的最终答案。无需四舍五入。", "solution": "用户希望对应用于线性对流-扩散方程的给定隐式-显式（IMEX）龙格-库塔格式进行冯·诺依曼稳定性分析。\n\n### 第1步：问题验证\n\n**提取已知条件：**\n-   **偏微分方程：** $\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = \\nu \\frac{\\partial^{2} u}{\\partial x^{2}}$，在周期性区域上。\n-   **常数：** 对流速度 $a \\ge 0$，运动粘度 $\\nu \\ge 0$。\n-   **空间离散化：** 均匀网格，间距为 $\\Delta x$。\n-   **对流算子（显式）：** 对于 $a \\ge 0$ 的一阶迎风差分，$-a D^{-} u_{j} = -a (u_{j} - u_{j-1})/\\Delta x$。\n-   **对流傅里叶符号：** 对于波数 $\\theta \\in [0,\\pi]$，算子 $-a D^{-}$ 的符号给定为 $-a (1 - \\exp(-\\mathrm{i}\\theta))/\\Delta x$。\n-   **扩散算子（隐式）：** 二阶中心拉普拉斯算子，$\\nu L u_{j} = \\nu (u_{j+1} - 2 u_{j} + u_{j-1})/\\Delta x^{2}$。\n-   **扩散傅里叶符号：** 算子 $\\nu L$ 的符号给定为 $-4 \\nu \\sin^{2}(\\theta/2)/\\Delta x^{2}$。\n-   **无量纲数：** 库朗数 $C = \\frac{a \\Delta t}{\\Delta x}$，扩散数 $D = \\frac{\\nu \\Delta t}{\\Delta x^{2}}$。\n-   **IMEX 格式：** 一个二阶两步格式，由显式和隐式布彻表以及参数 $\\gamma = 1 - \\frac{1}{\\sqrt{2}}$ 定义。\n    $$\n    \\text{显式（对流）：}\\quad A_E = \\begin{pmatrix} 0 & 0 \\\\ 1 & 0 \\end{pmatrix}, \\quad b_E^T = (\\tfrac{1}{2}, \\tfrac{1}{2})\n    $$\n    $$\n    \\text{隐式（扩散）：}\\quad A_I = \\begin{pmatrix} \\gamma & 0 \\\\ 1 - 2\\gamma & \\gamma \\end{pmatrix}, \\quad b_I^T = (\\tfrac{1}{2}, \\tfrac{1}{2})\n    $$\n-   **稳定性条件：** 单步放大因子 $G(\\theta)$ 必须满足 $|G(\\theta)| \\le 1$，对于所有 $\\theta \\in [0,\\pi]$ 和任意非负扩散数 $D \\ge 0$。\n-   **目标：** 推导 $G(\\theta)$ 并找到满足稳定性条件的最大库朗数 $C_{\\max}$。\n\n**使用提取的已知条件进行验证：**\n-   **科学依据：** 该问题是偏微分方程数值分析中的一个标准练习，特别是在计算流体力学领域。对流-扩散方程、冯·诺依曼分析和 IMEX-RK 方法都是基础且成熟的概念。问题设置是科学合理的。\n-   **适定性：** 该问题提供了所有必要的信息：方程、离散化方法、它们的傅里叶符号、时间步进格式以及稳定性判据。目标是找到一个单一的、具体的数值（$C_{\\max}$）。问题是适定的。\n-   **客观性：** 该问题使用精确的数学语言和定义进行表述，没有歧义或主观陈述。\n\n**结论：** 问题有效。\n\n### 第2步：推导放大因子\n\n偏微分方程对每个网格点 $u_j$ 的半离散形式由下式给出：\n$$\n\\frac{du_j}{dt} = \\underbrace{-a D^{-} u_j}_{\\text{显式}} + \\underbrace{\\nu L u_j}_{\\text{隐式}}\n$$\n我们通过考虑单个傅里叶模态 $u_j(t) = \\hat{u}(t) \\exp(\\mathrm{i} j \\theta)$ 来进行冯·诺依曼分析，其中 $\\theta = k_m \\Delta x$ 是无量纲波数。将此代入半离散方程，得到关于模态振幅 $\\hat{u}(t)$ 的常微分方程：\n$$\n\\frac{d\\hat{u}}{dt} = (\\hat{F} + \\hat{N}) \\hat{u}\n$$\n其中 $\\hat{F}$ 和 $\\hat{N}$ 分别是显式和隐式空间算子的傅里叶符号（特征值）。使用所给的符号：\n$$\n\\hat{F} = -a \\frac{1 - \\exp(-\\mathrm{i}\\theta)}{\\Delta x}\n$$\n$$\n\\hat{N} = \\nu \\frac{-4 \\sin^{2}(\\theta/2)}{\\Delta x^{2}} = \\nu \\frac{2(\\cos(\\theta)-1)}{\\Delta x^2}\n$$\n让我们定义无量纲参数 $z_E = \\Delta t \\hat{F}$ 和 $z_I = \\Delta t \\hat{N}$。\n$$\nz_E = -\\frac{a \\Delta t}{\\Delta x} (1 - \\exp(-\\mathrm{i}\\theta)) = -C(1 - \\cos\\theta + \\mathrm{i}\\sin\\theta)\n$$\n$$\nz_I = \\frac{\\nu \\Delta t}{\\Delta x^2} (2(\\cos\\theta - 1)) = -2D(1 - \\cos\\theta)\n$$\n注意，对于 $D \\ge 0$，$z_I$ 总是实数且非正。\n\n放大因子 $G(\\theta) = G(z_E, z_I)$ 是 IMEX-RK 格式应用于标量线性常微分方程 $\\hat{u}' = (\\hat{F}+\\hat{N})\\hat{u}$ 时的稳定性函数。对于给定的 IMEX 龙格-库塔格式，作用于线性问题 $y' = Fy+Ny$（其中 $F=\\hat{F}, N=\\hat{N}$）时，阶段解 $Y_i$ 为：\n$$\nY_1 = u_n + \\Delta t a^I_{11} N Y_1 \\implies (1 - a^I_{11} z_I)Y_1 = u_n\n$$\n由于 $a^I_{11} = \\gamma$，我们有 $Y_1 = (1 - \\gamma z_I)^{-1} u_n$。\n$$\nY_2 = u_n + \\Delta t a^E_{21} F Y_1 + \\Delta t (a^I_{21} N Y_1 + a^I_{22} N Y_2)\n$$\n$$\n(1 - a^I_{22} z_I)Y_2 = u_n + (a^E_{21}z_E + a^I_{21}z_I) Y_1\n$$\n使用 $a^E_{21}=1$，$a^I_{21}=1-2\\gamma$，$a^I_{22}=\\gamma$：\n$$\n(1 - \\gamma z_I)Y_2 = u_n + (z_E + (1-2\\gamma)z_I) (1-\\gamma z_I)^{-1}u_n\n$$\n$$\nY_2 = \\left[ (1-\\gamma z_I)^{-1} + (z_E + (1-2\\gamma)z_I)(1-\\gamma z_I)^{-2} \\right] u_n\n$$\n最终解由下式给出：\n$$\nu_{n+1} = u_n + \\Delta t \\sum_{i=1}^2 b^E_i F Y_i + \\Delta t \\sum_{i=1}^2 b^I_i N Y_i\n$$\n由于 $b^E_i = b^I_i = 1/2$，我们有：\n$$\nu_{n+1} = u_n + \\frac{1}{2}(z_E+z_I)(Y_1 + Y_2)\n$$\n放大因子 $G(z_E, z_I) = u_{n+1}/u_n$ 为：\n$$\nG(z_E, z_I) = 1 + \\frac{1}{2}(z_E+z_I) \\left[ \\frac{Y_1}{u_n} + \\frac{Y_2}{u_n} \\right]\n$$\n$$\nG = 1 + \\frac{1}{2}(z_E+z_I) \\left[ 2(1-\\gamma z_I)^{-1} + (z_E + (1-2\\gamma)z_I)(1-\\gamma z_I)^{-2} \\right]\n$$\n$$\nG = 1 + \\frac{z_E+z_I}{2(1-\\gamma z_I)^2} [2(1-\\gamma z_I) + z_E + (1-2\\gamma)z_I]\n$$\n$$\nG = \\frac{2(1-\\gamma z_I)^2 + (z_E+z_I)(2+z_E+(1-4\\gamma)z_I)}{2(1-\\gamma z_I)^2}\n$$\n展开分子：\n$N_G = 2(1-2\\gamma z_I + \\gamma^2 z_I^2) + (2z_E+z_E^2+2z_I+(2-4\\gamma)z_Ez_I+(1-4\\gamma)z_I^2)$\n$N_G = (2+2z_E+z_E^2) + (2-4\\gamma)z_I + (2-4\\gamma)z_Ez_I + (2\\gamma^2-4\\gamma+1)z_I^2$\n参数 $\\gamma=1-1/\\sqrt{2}$ 是 $2\\gamma^2-4\\gamma+1=0$ 的一个根。因此，$z_I^2$ 项消失了。\n$$\nN_G = (2+2z_E+z_E^2) + (2-4\\gamma)z_I(1+z_E)\n$$\n放大因子简化为：\n$$\nG(z_E, z_I) = \\frac{1+z_E+\\frac{1}{2}z_E^2 + (1-2\\gamma)z_I(1+z_E)}{(1-\\gamma z_I)^2}\n$$\n\n### 第3步：稳定性分析\n\n稳定性条件为 $|G(z_E, z_I)| \\le 1$，对于所有 $\\theta \\in [0, \\pi]$ 和所有 $D \\ge 0$。\n通过考虑没有扩散的情况，即 $D=0$（这意味着 $z_I=0$），可以得到一个稳定性的必要条件。\n$$\n|G(z_E, 0)| = |1 + z_E + \\frac{1}{2}z_E^2| \\le 1\n$$\n这是该格式显式部分（霍恩方法）的稳定性条件。当 $\\theta$ 变化时，复数 $z_E$ 在复平面上描绘出一条曲线。我们必须找到最大的 $C$，使得整条曲线都位于霍恩方法的稳定区域内。\n该曲线由 $z_E = -C(1-e^{-\\mathrm{i}\\theta}) = -C + C e^{\\mathrm{i}(\\pi-\\theta)}$ 给出。这可以写成 $z_E+C = C e^{\\mathrm{i}(\\pi-\\theta)}$，它描述了一个以 $-C$ 为中心、半径为 $C$ 的圆。当 $\\theta$ 从 $0$ 扫到 $\\pi$ 时，$z_E$ 从 $z_E(0)=0$ 到 $z_E(\\pi)=-2C$ 描绘出下半圆。\n\n霍恩方法的稳定区域 $S = \\{z \\in \\mathbb{C} : |1+z+\\frac{1}{2}z^2| \\le 1\\}$ 与负实轴相交于 $z \\in [-2, 0]$。这是通过设 $z=-x$（$x>0$）并解不等式 $|1-x+\\frac{1}{2}x^2|\\le 1$ 得到的，该不等式简化为 $x(x-2)\\le 0$，得出 $0 \\le x \\le 2$。\n我们曲线的端点 $z_E(\\pi)=-2C$ 必须在此区间内。由于 $C \\ge 0$，我们需要 $-2C \\ge -2$，即 $C \\le 1$。因此，一个必要条件是 $C_{\\max} \\le 1$。\n\n我们来检查 $C=1$ 对于 $D=0$ 的情况是否充分。对于 $C=1$，曲线为 $|z_E+1|=1$，且 $\\mathrm{Im}(z_E) \\le 0$。我们检查此曲线是否在 $S$ 内。令 $z_E = -1+e^{-\\mathrm{i}\\phi}$，其中 $\\phi \\in [0, \\pi]$。\n$$\n|1+z_E+\\frac{1}{2}z_E^2| = |1+(-1+e^{-\\mathrm{i}\\phi})+\\frac{1}{2}(-1+e^{-\\mathrm{i}\\phi})^2| = |e^{-\\mathrm{i}\\phi}+\\frac{1}{2}(1-2e^{-\\mathrm{i}\\phi}+e^{-2\\mathrm{i}\\phi})| = |\\frac{1}{2}(1+e^{-2\\mathrm{i}\\phi})|\n$$\n$$\n|\\frac{1}{2}(1+e^{-2\\mathrm{i}\\phi})|^2 = \\frac{1}{4}(1+e^{-2\\mathrm{i}\\phi})(1+e^{2\\mathrm{i}\\phi}) = \\frac{1}{4}(2+2\\cos(2\\phi)) = \\frac{1+\\cos(2\\phi)}{2} = \\cos^2(\\phi)\n$$\n由于对于所有 $\\phi$ 都有 $|\\cos^2(\\phi)| \\le 1$，所以稳定性条件对于此曲线上的所有点都满足。因此，对于纯显式情况，$C_{\\max}=1$。\n\n现在，我们必须验证当 $C=1$ 时，对于任何 $D > 0$，该格式都保持稳定。我们需要证明 $|G(z_E, z_I)| \\le 1$ 对于 $C=1$ 时的曲线上的 $z_E$ 和任意 $z_I = -X$（其中 $X = 2D(1-\\cos\\theta) \\ge 0$）都成立。该条件是：\n$$\n|R_E(z_E) + (1-2\\gamma)z_I(1+z_E)|^2 \\le |(1-\\gamma z_I)^2|^2\n$$\n其中 $R_E(z_E) = 1+z_E+\\frac{1}{2}z_E^2$。代入 $z_I = -X$：\n$$\n|R_E(z_E) - (1-2\\gamma)X(1+z_E)|^2 \\le (1+\\gamma X)^4\n$$\n让我们将其展开并重排为一个关于 $X$ 的多项式不等式：\n$$\nP(X) = (1+\\gamma X)^4 - |R_E(z_E) - (1-2\\gamma)X(1+z_E)|^2 \\ge 0\n$$\n将各项展开为 $X$ 的多项式，我们需要对于所有 $X \\ge 0$ 都有 $P(X) \\ge 0$。\n$P(X)= (\\gamma^4 X^4 + 4\\gamma^3 X^3) + (6\\gamma^2 - |(1-2\\gamma)(1+z_E)|^2)X^2 + (4\\gamma + 2\\text{Re}(R_E \\overline{A}))X + (1-|R_E|^2)$，其中 $A=(1-2\\gamma)(1+z_E)$。\n对于 $C=1$，我们已求得 $|R_E|^2 = \\cos^2\\theta$。所以常数项是 $1-\\cos^2\\theta = \\sin^2\\theta \\ge 0$。\n$X$ 的系数是 $4\\gamma + 2\\text{Re}(R_E \\bar{A})$。\n$A=(1-2\\gamma)(1+z_E) = (1-2\\gamma)e^{-\\mathrm{i}\\theta}$。$\\bar{A}=(1-2\\gamma)e^{\\mathrm{i}\\theta}$。\n$R_E = \\frac{1}{2}(1+e^{-2\\mathrm{i}\\theta})$。\n$R_E \\bar{A} = \\frac{1}{2}(1+e^{-2\\mathrm{i}\\theta})(1-2\\gamma)e^{\\mathrm{i}\\theta} = \\frac{1-2\\gamma}{2}(e^{\\mathrm{i}\\theta}+e^{-\\mathrm{i}\\theta}) = (1-2\\gamma)\\cos\\theta$。\n该项是实数，所以其实部就是其本身。该系数是 $4\\gamma+2(1-2\\gamma)\\cos\\theta=2(2\\gamma+(1-2\\gamma)\\cos\\theta)$。\n由于 $\\gamma \\approx 0.293$，$1-2\\gamma \\approx 0.414$，两者均为正。该表达式的最小值在 $\\cos\\theta=-1$ 处取得，值为 $2(2\\gamma-(1-2\\gamma))=2(4\\gamma-1) = 2(4(1-1/\\sqrt{2})-1)=2(3-2\\sqrt{2})>0$。所以这个系数是非负的。\n$X^2$ 的系数是 $6\\gamma^2 - |A|^2 = 6\\gamma^2-(1-2\\gamma)^2$。\n$\\gamma=1-1/\\sqrt{2} \\implies (1-\\gamma)^2=1/2 \\implies 1-2\\gamma+\\gamma^2=1/2 \\implies \\gamma^2=2\\gamma-1/2$。\n$1-2\\gamma = \\sqrt{2}-1$。\n该系数是 $6(2\\gamma-1/2) - (1-2\\gamma)^2 = 12\\gamma-3 - (\\sqrt{2}-1)^2 = 12(1-1/\\sqrt{2})-3 - (3-2\\sqrt{2}) = 12-6\\sqrt{2}-3-3+2\\sqrt{2} = 6-4\\sqrt{2}>0$。\n最后，$X^3$ 和 $X^4$ 的系数是 $4\\gamma^3$ 和 $\\gamma^4$，它们都是正的。\n当 $C=1$ 时，对于任何 $\\theta \\in [0,\\pi]$，多项式 $P(X)$ 的所有系数都是非负的。由于我们考虑的是 $X \\ge 0$，这就保证了 $P(X) \\ge 0$。\n因此，选择 $C=1$ 对所有 $D \\ge 0$ 都是稳定的。由于我们已经确定了 $C_{\\max} \\le 1$，我们得出结论 $C_{\\max}=1$。", "answer": "$$\n\\boxed{1}\n$$", "id": "3334251"}, {"introduction": "理论分析与实际应用之间需要一座桥梁。本练习将从线性问题转向一个带反应项的非线性守恒律，这是流体动力学中的常见模型。通过对一个IMEX格式进行编程实现，你将探索如何确保数值解能够保持质量守恒和正定性等物理特性，这些特性在实际问题中与稳定性和精度同等重要 [@problem_id:3334223]。", "problem": "考虑一个周期性域上带线性反应项的一维标量守恒律，其偏微分方程（PDE）为\n$$\nu_t + \\partial_x\\left(\\frac{u^2}{2}\\right) = -k\\,u,\n$$\n其中 $u(x,t) \\ge 0$ 是未知的标量场，$k \\ge 0$ 是空间上均匀的反应速率，$x \\in [0,1]$ 且具有周期性边界条件，$t \\ge 0$。目标是为此 PDE 设计并分析一个一阶隐式-显式（IMEX）时间积分方法，并研究其保正性和质量守恒性质。缩写 IMEX 代表隐式-显式（Implicit–Explicit），即对流项显式处理，反应项隐式处理。\n\n从具有 $N$ 个网格、网格宽度 $\\Delta x = 1/N$ 的均匀网格的有限体积格式出发，令 $u_i^n$ 表示在时间层 $t^n$ 时网格 $i$ 内的单元平均值。使用以下基本原则：\n- 对流项的守恒形式：显式更新由穿过单元界面的数值通量确定，确保局部守恒。\n- 线性反应项的后向欧拉方法：隐式更新为每个单元求解一个局部代数方程。\n\n从第一性原理出发，推导出一个形式如下的一步 IMEX 欧拉格式\n$$\nu_i^{n+1} = \\frac{u_i^n + \\Delta t\\,R_i(u^n)}{1 + k\\,\\Delta t},\n$$\n其中 $R_i(u^n)$ 使用界面数值通量以守恒形式近似 $-\\partial_x\\left(\\frac{u^2}{2}\\right)$。选择 Burgers 方程的 Godunov 通量作为单调数值通量\n$$\nF_{i+\\frac{1}{2}} = \\mathcal{G}(u_i^n,u_{i+1}^n),\n$$\n对于 Burgers 通量 $f(u)=\\tfrac{u^2}{2}$，其著名的分情况定义如下：\n- 若 $u_L \\le u_R$：那么当 $u_L \\ge 0$ 时 $F = f(u_L)$，当 $u_R \\le 0$ 时 $F = f(u_R)$，否则 $F = f(0) = 0$。\n- 若 $u_L > u_R$：激波速度为 $s = \\frac{f(u_L) - f(u_R)}{u_L - u_R} = \\frac{u_L + u_R}{2}$；若 $s \\ge 0$ 则设 $F = f(u_L)$，否则设 $F = f(u_R)$。\n\n使用 Courant–Friedrichs–Lewy (CFL) 条件来保证显式对流部分的稳定性，该条件基于特征速度 $|f'(u)| = |u|$，\n$$\n\\Delta t = \\text{CFL}\\,\\frac{\\Delta x}{\\max_i |u_i^n|},\n$$\n其中 $\\text{CFL} \\in (0,1]$。\n\n任务：\n1. 根据守恒原理，用界面通量 $F_{i+\\frac{1}{2}}$ 和 $F_{i-\\frac{1}{2}}$ 显式推导 $R_i(u^n)$，并解释为何在周期性域上，显式对流更新能够守恒离散总质量。\n2. 在初始数据为非负的情况下，证明使用 Godunov 通量和所述 CFL 条件的显式对流更新的保正性条件，并证明使用后向欧拉方法的隐式反应步骤的保正性。\n3. 提出一种在显式和隐式阶段都一致的限制器策略，即，该策略在显式阶段保持单元平均值的非负性（例如，通过使用单调通量或保界修正），并且不违反隐式反应更新的正性。论证该策略在显式阶段与守恒性的一致性，以及在隐式阶段与局部保正性的一致性。\n\n实现要求：\n- 在周期性域上为下面定义的测试案例实现单步 IMEX 欧拉方法。为每个测试案例计算以下诊断量：\n    - 显式对流阶段后的保正性：一个布尔值，指示是否 $\\min_i u_i^{\\star} \\ge -10^{-12}$，其中 $u_i^{\\star} = u_i^n + \\Delta t\\,R_i(u^n)$。\n    - 显式阶段的离散质量守恒误差：绝对相对变化\n      $$\n      \\left|\\frac{M^{\\star} - M^n}{M^n}\\right|,\n      $$\n      其中 $M^n = \\sum_i u_i^n \\Delta x$ 且 $M^{\\star} = \\sum_i u_i^{\\star} \\Delta x$。\n    - 完整 IMEX 步骤后的保正性：一个布尔值，指示是否 $\\min_i u_i^{n+1} \\ge -10^{-12}$。\n    - 离散反应质量一致性误差：绝对相对误差\n      $$\n      \\left|\\frac{M^{n+1} - \\frac{M^{\\star}}{1+k\\,\\Delta t}}{\\frac{M^{\\star}}{1+k\\,\\Delta t}}\\right|,\n      $$\n      其中 $M^{n+1} = \\sum_i u_i^{n+1} \\Delta x$。\n\n- 网格和域：在 $[0,1]$ 上使用具有周期性边界条件的均匀网格。将所有量视为无量纲。\n\n测试套件：\n- 案例 A（光滑，中等反应，安全 CFL）：$N=200$，初始条件 $u(x)=1+0.2\\sin(2\\pi x)$，$k=0.3$，$\\text{CFL}=0.5$。\n- 案例 B（接近 CFL 边界，弱反应）：$N=100$，初始条件 $u(x)=1+0.99\\sin(2\\pi x)$，$k=0.01$，$\\text{CFL}=1.0$。\n- 案例 C（刚性反应，安全 CFL）：$N=200$，初始条件 $u(x)=1+0.5\\sin(2\\pi x)$，$k=1000$，$\\text{CFL}=0.5$。\n- 案例 D（紧支集，接近 CFL，中等反应）：$N=400$，初始条件 $u(x)=\\max\\{0,\\,1-10|x-0.5|\\}$，$k=1.0$，$\\text{CFL}=0.9$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，按以下四个案例的顺序排列结果：\n$$\n[\\text{pos\\_explicit\\_A},\\,\\text{mass\\_err\\_explicit\\_A},\\,\\text{pos\\_full\\_A},\\,\\text{mass\\_err\\_implicit\\_A},\\,\\text{pos\\_explicit\\_B},\\,\\text{mass\\_err\\_explicit\\_B},\\,\\text{pos\\_full\\_B},\\,\\text{mass\\_err\\_implicit\\_B},\\,\\text{pos\\_explicit\\_C},\\,\\text{mass\\_err\\_explicit\\_C},\\,\\text{pos\\_full\\_C},\\,\\text{mass\\_err\\_implicit\\_C},\\,\\text{pos\\_explicit\\_D},\\,\\text{mass\\_err\\_explicit\\_D},\\,\\text{pos\\_full\\_D},\\,\\text{mass\\_err\\_implicit\\_D}].\n$$\n每个布尔值为 True 或 False，每个误差值为一个浮点数。", "solution": "我们从带反应项的守恒律开始\n$$\nu_t + \\partial_x f(u) = -k\\,u,\\quad f(u) = \\frac{u^2}{2},\n$$\n定义在周期性域 $x \\in [0,1]$ 上。我们使用有限体积法在具有 $N$ 个单元、$\\Delta x = 1/N$ 和周期性边界条件的均匀网格上进行空间离散。令 $u_i^n$ 表示在时间 $t^n$ 时单元 $i$ 内的单元平均值。\n\n**有限体积更新与显式对流：**\n对于对流部分，守恒性意味着半离散形式为\n$$\n\\frac{d u_i}{dt} = -\\frac{1}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right),\n$$\n其中 $F_{i+\\frac{1}{2}}$ 是单元 $i$ 和 $i+1$ 之间界面的一个相容的数值通量，周期性边界条件意味着索引是对 $N$ 取模。对流项的一阶显式时间更新（前向欧拉）使用\n$$\nu_i^{\\star} = u_i^n + \\Delta t\\,R_i(u^n),\\qquad R_i(u^n) = -\\frac{1}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right),\n$$\n其中 $\\Delta t$ 的选择需满足基于最大特征速度的 Courant–Friedrichs–Lewy (CFL) 条件。对于 Burgers 方程，特征速度为 $|f'(u)|=|u|$，所以\n$$\n\\Delta t = \\text{CFL}\\,\\frac{\\Delta x}{\\max_i |u_i^n|},\\qquad \\text{CFL} \\in (0,1].\n$$\n\n**Burgers 方程的 Godunov 通量：**\n我们为标量凸通量 $f(u) = \\tfrac{u^2}{2}$ 选择 Godunov 通量 $\\mathcal{G}(u_L,u_R)$。其显式形式为：\n- 如果 $u_L \\le u_R$（稀疏波），则\n$$\nF = \\begin{cases}\nf(u_L), & u_L \\ge 0,\\\\\nf(u_R), & u_R \\le 0,\\\\\n0, & \\text{otherwise}.\n\\end{cases}\n$$\n- 如果 $u_L > u_R$（激波），计算激波速度 $s = \\frac{f(u_L)-f(u_R)}{u_L-u_R} = \\frac{u_L+u_R}{2}$，并设置\n$$\nF = \\begin{cases}\nf(u_L), & s \\ge 0,\\\\\nf(u_R), & s  0.\n\\end{cases}\n$$\n该通量是单调、相容且守恒的。\n\n**显式对流阶段的质量守恒：**\n定义时间 $t^n$ 的离散总质量为\n$$\nM^n = \\sum_{i=0}^{N-1} u_i^n \\Delta x.\n$$\n使用守恒残差 $R_i(u^n)$，\n$$\nM^{\\star} = \\sum_i u_i^{\\star}\\Delta x = \\sum_i \\left(u_i^n + \\Delta t R_i(u^n)\\right)\\Delta x = M^n + \\Delta t\\sum_i R_i(u^n)\\Delta x.\n$$\n由于\n$$\n\\sum_i R_i(u^n)\\Delta x = -\\sum_i\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right) = 0,\n$$\n通过裂项求和与周期性，可得 $M^{\\star} = M^n$。因此，对于任何相容的数值通量（包括 Godunov 通量），在周期性域上，显式对流更新能精确地守恒离散质量。\n\n**显式对流阶段的保正性：**\n对于具有单调通量函数的标量守恒律，在 CFL 条件 $\\Delta t \\le \\Delta x / \\max_i |f'(u_i^n)|$ 下，前向欧拉显式更新可以写成相邻状态的凸组合。特别地，对于 Godunov 通量和 Burgers 方程，在 $\\text{CFL} \\le 1$ 的条件下，更新后的 $u_i^{\\star}$ 满足一个局部极值原理，这意味着如果对所有 $i$ 都有 $u_i^n \\ge 0$，那么对所有 $i$ 也都有 $u_i^{\\star} \\ge 0$。这是由 Godunov 通量的单调性以及该格式在一阶时是总变差递减（TVD）的性质所决定的，因此不会在相邻值的凸包之外产生新的极值。所以，在所述的 CFL 约束下，显式对流阶段能保持非负性。\n\n**隐式反应更新与保正性：**\n每个单元中仅有反应项的常微分方程（ODE）是\n$$\n\\frac{d u_i}{dt} = -k\\,u_i,\n$$\n这是线性的并且在单元间解耦。对此 ODE 应用后向欧拉方法得到\n$$\n\\frac{u_i^{n+1} - u_i^{\\star}}{\\Delta t} = -k\\,u_i^{n+1}\\quad\\Rightarrow\\quad u_i^{n+1} = \\frac{u_i^{\\star}}{1 + k\\,\\Delta t}.\n$$\n如果 $u_i^{\\star} \\ge 0$ 且 $k \\ge 0$，那么 $u_i^{n+1} \\ge 0$ 也成立，所以隐式反应步骤保持了正性。此外，隐式步骤后的离散质量为\n$$\nM^{n+1} = \\sum_i u_i^{n+1}\\Delta x = \\sum_i \\frac{u_i^{\\star}}{1+k\\,\\Delta t}\\Delta x = \\frac{M^{\\star}}{1+k\\,\\Delta t}.\n$$\n因此，质量在一个后向欧拉步骤中减少了因子 $(1+k\\,\\Delta t)^{-1}$，这是精确指数衰减的离散对应，并且与隐式处理相一致。\n\n**在显式和隐式阶段都一致的限制器策略：**\n一个一致的策略是在显式对流阶段使用单调通量（Godunov）并配合 $\\text{CFL} \\le 1$，这保证了局部极值原理，从而在以非负单元平均值初始化时保证非负性。对于高阶重构，可以在显式阶段应用保界限制器（例如，Zhang–Shu 类型的重构界面值缩放以保持单元平均值为非负），同时通过仅对反扩散修正项应用限制器来维持守恒性。当显式阶段的输出为非负时，带有后向欧拉的隐式反应阶段在构造上是保正的。这种一致性来源于：\n- 显式阶段的守恒性：通量限制不会改变守恒形式；它只修改界面通量或高阶修正项，但保持裂项求和的性质不变。\n- 两个阶段的保正性：显式阶段维持的非负性被隐式反应步骤传播，因为除以 $(1+k\\,\\Delta t)$ 会保持符号。\n\n**程序的算法设计：**\n- 在 $[0,1]$ 上构建一个具有 $N$ 个单元的均匀周期性网格。\n- 通过在单元中心 $x_i = (i+0.5)\\Delta x$ 处采样给定的初始条件来初始化 $u_i^n$；这作为一阶方法的单元平均值。\n- 计算 $\\Delta t = \\text{CFL}\\,\\Delta x / \\max_i |u_i^n|$。\n- 使用分情况公式计算所有界面的 Godunov 通量 $F_{i+\\frac{1}{2}}$，并使用周期性索引。\n- 通过守恒通量差分计算 $R_i(u^n)$，显式更新 $u_i^{\\star}$，并跟踪保正性和质量。\n- 应用隐式反应更新 $u_i^{n+1} = u_i^{\\star}/(1+k\\,\\Delta t)$，并跟踪保正性和与因子 $(1+k\\,\\Delta t)^{-1}$ 的质量一致性。\n- 按指定的输出顺序报告诊断量。\n\n这个基于原理的构造将有限体积守恒律离散化与 IMEX 欧拉时间积分器相结合，并且所选的单调通量与后向欧拉方法在给定的 CFL 条件下保证了所期望的保正性和质量性质。测试套件涵盖了典型和边界情况：具有中等反应的光滑数据、接近 CFL 稳定性极限、刚性反应以及具有零区域的紧支集初始数据。诊断量分别以浮点数和布尔值的形式量化了质量守恒和保正性，使得结果可直接检验。", "answer": "```python\nimport numpy as np\n\ndef godunov_flux_burgers(uL, uR):\n    # Burgers flux: f(u) = u^2 / 2\n    fL = 0.5 * uL * uL\n    fR = 0.5 * uR * uR\n    if uL = uR:\n        # Rarefaction\n        if uL >= 0.0:\n            return fL\n        elif uR = 0.0:\n            return fR\n        else: # uL  0  uR\n            return 0.0\n    else:\n        # Shock\n        s = 0.5 * (uL + uR)  # shock speed\n        if s >= 0.0:\n            return fL\n        else:\n            return fR\n\ndef explicit_convective_stage(u, dx, dt):\n    N = len(u)\n    # Compute interface fluxes with periodic indexing\n    F = np.empty(N, dtype=float)  # F[i] = flux at i+1/2\n    for i in range(N):\n        uL = u[i]\n        uR = u[(i + 1) % N]\n        F[i] = godunov_flux_burgers(uL, uR)\n    # Residual R_i = - (F_{i+1/2} - F_{i-1/2}) / dx\n    R = np.empty_like(u)\n    for i in range(N):\n        F_plus = F[i]\n        F_minus = F[(i - 1 + N) % N]\n        R[i] = - (F_plus - F_minus) / dx\n    u_star = u + dt * R\n    return u_star\n\ndef implicit_reaction_step(u_star, k, dt):\n    # Backward Euler for linear reaction: u^{n+1} = u_star / (1 + k dt)\n    denom = 1.0 + k * dt\n    return u_star / denom\n\ndef initial_condition(case_id, x):\n    if case_id == 'A':\n        return 1.0 + 0.2 * np.sin(2.0 * np.pi * x)\n    elif case_id == 'B':\n        return 1.0 + 0.99 * np.sin(2.0 * np.pi * x)\n    elif case_id == 'C':\n        return 1.0 + 0.5 * np.sin(2.0 * np.pi * x)\n    elif case_id == 'D':\n        # Triangular compact support: max(0, 1 - 10 |x - 0.5|)\n        return np.maximum(0.0, 1.0 - 10.0 * np.abs(x - 0.5))\n    else:\n        raise ValueError(\"Unknown case\")\n\ndef run_case(N, k, CFL, case_id):\n    L = 1.0\n    dx = L / N\n    # Cell centers\n    i = np.arange(N)\n    x = (i + 0.5) * dx\n    # Initialize u^n\n    u_n = initial_condition(case_id, x)\n    # Compute dt from CFL and max characteristic speed |u|\n    umax = np.max(np.abs(u_n))\n    # To avoid dt=inf if umax is very small, set a threshold\n    dt = CFL * dx / umax if umax > 1e-15 else 0.0\n\n    # Mass at time n\n    M_n = np.sum(u_n) * dx\n\n    # Explicit convective stage\n    u_star = explicit_convective_stage(u_n, dx, dt)\n    M_star = np.sum(u_star) * dx\n    # Positivity check after explicit stage\n    pos_explicit = np.min(u_star) >= -1e-12\n    # Mass conservation error after explicit stage (relative)\n    mass_err_explicit = abs(M_star - M_n) / (M_n if abs(M_n) > 1e-15 else 1.0)\n\n    # Implicit reaction step\n    u_np1 = implicit_reaction_step(u_star, k, dt)\n    M_np1 = np.sum(u_np1) * dx\n    # Positivity check after full IMEX step\n    pos_full = np.min(u_np1) >= -1e-12\n    # Reaction mass consistency error: compare against M_star / (1 + k dt)\n    denom = 1.0 + k * dt\n    target_mass = M_star / denom if denom != 0.0 else M_star\n    mass_err_implicit = abs(M_np1 - target_mass) / (target_mass if abs(target_mass) > 1e-15 else 1.0)\n\n    return pos_explicit, mass_err_explicit, pos_full, mass_err_implicit\n\ndef solve():\n    test_cases = [\n        # (case_id, N, k, CFL)\n        ('A', 200, 0.3, 0.5),\n        ('B', 100, 0.01, 1.0),\n        ('C', 200, 1000.0, 0.5),\n        ('D', 400, 1.0, 0.9),\n    ]\n\n    results = []\n    for case_id, N, k, CFL in test_cases:\n        pos_explicit, mass_err_explicit, pos_full, mass_err_implicit = run_case(N, k, CFL, case_id)\n        results.extend([pos_explicit, mass_err_explicit, pos_full, mass_err_implicit])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3334223"}]}