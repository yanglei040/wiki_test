{"hands_on_practices": [{"introduction": "为了掌握戈杜诺夫格式，我们首先从最基础的标量守恒律入手。这个练习要求为无粘汉堡方程（一种最简单的非线性守恒律）推导出戈杜诺夫通量。通过这个实践，你将深入理解如何利用精确黎曼问题的自相似解来确定单元界面上的通量，这是构建戈杜诺夫格式的核心思想。", "problem": "考虑一维空间中的标量守恒律，\n$$\n\\partial_t u + \\partial_x f(u) = 0,\n$$\n其通量函数为 $f(u) = \\frac{u^{2}}{2}$。设空间域由一个均匀的网格单元 $\\{i\\}$ 离散化，单元中心位于 $x_{i}$，单元宽度为 $\\Delta x$。设在时间 $t^{n}$ 时的分片常数单元平均值表示为 $u_{i}^{n}$。假设时间步长 $\\Delta t$ 满足一个合适的 Courant–Friedrichs–Lewy (CFL) 条件，使得 Godunov 有限体积法更新\n$$\nu_{i}^{n+1} = u_{i}^{n} - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}} \\right)\n$$\n是良定的，该更新使用相邻状态间的精确黎曼解。Godunov 单元间通量 $F_{i+\\frac{1}{2}}$ 是通过求解以左状态 $u_{L} = u_{i}^{n}$ 和右状态 $u_{R} = u_{i+1}^{n}$ 为初值的黎曼问题的自相似熵解，并在界面 $x = x_{i+\\frac{1}{2}}$ 和时间 $t  0$ 处求值得到的。\n\n从守恒律的积分形式、Godunov 格式的定义以及凸通量的精确熵解结构（包括激波的 Rankine–Hugoniot 条件和稀疏波扇的自相似解）出发，推导对于给定的通量 $f(u) = \\frac{u^{2}}{2}$，$F_{i+\\frac{1}{2}}$ 作为 $u_{L}$ 和 $u_{R}$ 的分段函数的封闭解析表达式。将最终答案表示为单个解析表达式。无需进行数值计算，也无需四舍五入。最终表达式中不要包含单位。", "solution": "用户希望推导无粘伯格斯方程的 Godunov 通量。\n\n### 问题验证\n\n**第一步：提取已知条件**\n-   **守恒律**：$\\partial_t u + \\partial_x f(u) = 0$。\n-   **通量函数**：$f(u) = \\frac{u^{2}}{2}$。\n-   **空间离散**：均匀网格，单元宽度为 $\\Delta x$，中心为 $x_i$。\n-   **单元平均值**：$u_{i}^{n}$ 是时间 $t^n$ 时的分片常数单元平均值。\n-   **有限体积更新**：$u_{i}^{n+1} = u_{i}^{n} - \\frac{\\Delta t}{\\Delta x} ( F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}} )$。\n-   **Godunov 通量**：$F_{i+\\frac{1}{2}}$ 由单元界面 $x_{i+\\frac{1}{2}}$ 处的黎曼问题的精确熵解导出。\n-   **黎曼问题数据**：左状态 $u_{L} = u_{i}^{n}$ 和右状态 $u_{R} = u_{i+1}^{n}$。\n-   **通量是凸的**：问题指出了这一点，可以通过 $f''(u) = 1  0$ 来验证。\n-   **任务**：推导 $F_{i+\\frac{1}{2}}$ 作为 $u_L$ 和 $u_R$ 的函数的封闭解析表达式。\n\n**第二步：使用提取的已知条件进行验证**\n-   **科学依据**：该问题是双曲偏微分方程数值方法领域的一个标准、基本推导，特别关注用于无粘伯格斯方程的 Godunov 格式。所有概念在计算流体力学和应用数学中都已成熟。该问题在科学上和数学上都是合理的。\n-   **良定性**：该问题是良定的。对于具有凸通量的标量守恒律，黎曼问题的熵解是唯一的。任务是推导一个特定的、唯一的解析表达式。\n-   **客观性**：语言精确、技术性强，没有任何主观或模棱两可的陈述。\n-   **完整性和一致性**：问题陈述是自洽的，并提供了执行推导所需的所有必要信息。没有矛盾之处。\n\n**第三步：结论与行动**\n问题有效。将提供一个完整的、有理有据的解答。\n\n### Godunov 通量的推导\n\nGodunov 格式使用的数值通量是通过在每个单元界面求解局部黎曼问题得到的。跨越界面 $x_{i+\\frac{1}{2}}$ 的数值通量 $F_{i+\\frac{1}{2}}$ 由物理通量 $f(u)$ 在该界面上的状态 $u$ 处求值得到。由于黎曼问题解的自相似性，这个状态不随时间变化。解 $u(x,t)$ 仅依赖于相似性变量 $\\xi = (x-x_{i+\\frac{1}{2}})/t$。因此，Godunov 通量为：\n$$\nF_{i+\\frac{1}{2}} = F(u_L, u_R) = f(u(\\xi=0))\n$$\n其中 $u_L = u_i^n$ 且 $u_R = u_{i+1}^n$。\n\n控制方程是无粘伯格斯方程，这是一个通量函数为 $f(u) = \\frac{u^2}{2}$ 的标量守恒律。特征速度由通量函数的导数给出：\n$$\na(u) = f'(u) = u\n$$\n由于二阶导数 $f''(u) = 1  0$，通量是严格凸的。黎曼问题的熵解结构取决于 $u_L$ 和 $u_R$ 的相对值。\n\n**情况1：稀疏波 ($u_L \\le u_R$)**\n当 $u_L \\le u_R$ 时，特征线 $a(u_L)=u_L$ 和 $a(u_R)=u_R$ 相互远离（如果 $u_L=u_R$ 则速度相同）。解是一个连续的稀疏波扇。自相似解 $u(\\xi)$ 由下式给出：\n$$\nu(\\xi) = \\begin{cases}\nu_L  \\text{if } \\xi  u_L \\\\\n\\xi  \\text{if } u_L \\le \\xi \\le u_R \\\\\nu_R  \\text{if } \\xi  u_R\n\\end{cases}\n$$\n我们必须在界面处对该解进行求值，这对应于 $\\xi = 0$。\n-   如果 $0  u_L \\le u_R$：坐标 $\\xi=0$ 位于稀疏波扇的左侧。界面处的状态为 $u(0) = u_L$。通量为 $F = f(u_L) = \\frac{1}{2}u_L^2$。\n-   如果 $u_L \\le u_R  0$：坐标 $\\xi=0$ 位于稀疏波扇的右侧。界面处的状态为 $u(0) = u_R$。通量为 $F = f(u_R) = \\frac{1}{2}u_R^2$。\n-   如果 $u_L \\le 0 \\le u_R$：坐标 $\\xi=0$ 位于稀疏波扇内部。界面处的状态为 $u(0) = 0$。通量为 $F = f(0) = 0$。\n\n**情况2：激波 ($u_L > u_R$)**\n当 $u_L > u_R$ 时，特征线 $a(u_L)=u_L$ 和 $a(u_R)=u_R$ 相互碰撞。熵解是一个以恒定速度 $s$ 移动的单一间断，即激波。速度由 Rankine-Hugoniot 跳跃条件确定：\n$$\ns = \\frac{f(u_R) - f(u_L)}{u_R - u_L} = \\frac{\\frac{1}{2}u_R^2 - \\frac{1}{2}u_L^2}{u_R - u_L} = \\frac{\\frac{1}{2}(u_R-u_L)(u_R+u_L)}{u_R-u_L} = \\frac{u_L+u_R}{2}\n$$\n自相似解为：\n$$\nu(\\xi) = \\begin{cases}\nu_L  \\text{if } \\xi  s \\\\\nu_R  \\text{if } \\xi  s\n\\end{cases}\n$$\n我们在界面 $\\xi = 0$ 处对该解进行求值。\n-   如果 $s  0$：激波向右移动。坐标 $\\xi=0$ 位于左状态 $u_L$ 的区域内。界面处的状态为 $u(0) = u_L$。通量为 $F = f(u_L) = \\frac{1}{2}u_L^2$。这对应于 $\\frac{u_L+u_R}{2}  0$，或 $u_L+u_R  0$。\n-   如果 $s  0$：激波向左移动。坐标 $\\xi=0$ 位于右状态 $u_R$ 的区域内。界面处的状态为 $u(0) = u_R$。通量为 $F = f(u_R) = \\frac{1}{2}u_R^2$。这对应于 $\\frac{u_L+u_R}{2}  0$，或 $u_L+u_R  0$。\n-   如果 $s = 0$：激波在界面处静止。这发生在 $u_L+u_R=0$ 时，即 $u_L = -u_R$。在这种情况下，$f(u_L) = \\frac{1}{2}u_L^2 = \\frac{1}{2}(-u_R)^2 = f(u_R)$，因此通量是明确确定的。我们可以将此边界情况与 $s0$ 的情况关联起来，使条件变为 $s \\ge 0$。\n\n**通量的综合表达式**\n现在我们将所有情况的结果组合成一个单一的、分段解析的 Godunov 通量表达式 $F_{i+\\frac{1}{2}} = F(u_L, u_R)$。\n\n在两个条件下，通量为 $F(u_L, u_R) = \\frac{1}{2}u_L^2$：\n1.  稀疏波 ($u_L \\le u_R$)，且波扇在原点右侧 ($0  u_L$)。\n2.  激波 ($u_L  u_R$)，向右移动 ($s \\ge 0$，即 $u_L+u_R \\ge 0$)。\n\n在两个条件下，通量为 $F(u_L, u_R) = \\frac{1}{2}u_R^2$：\n1.  稀疏波 ($u_L \\le u_R$)，且波扇在原点左侧 ($u_R  0$)。\n2.  激波 ($u_L  u_R$)，向左移动 ($s  0$，即 $u_L+u_R  0$)。\n\n在一个情况下，通量为 $F(u_L, u_R) = 0$：\n1.  稀疏波 ($u_L \\le u_R$)，且波扇跨越原点 ($u_L \\le 0 \\le u_R$)。\n\n将这些条件进行逻辑组合，我们在整个 $(u_L, u_R)$ 平面上定义通量。为了清晰和简洁，我们可以将导致相同通量表达式的条件分组。\n-   若 $(u_L \\le u_R \\text{ 且 } u_L > 0) \\lor (u_L  u_R \\text{ 且 } u_L+u_R \\ge 0)$，则 $F = \\frac{1}{2}u_L^2$。\n这个条件的第一个部分可以写成 $0  u_L \\le u_R$。\n-   若 $(u_L \\le u_R \\text{ 且 } u_R  0) \\lor (u_L  u_R \\text{ 且 } u_L+u_R  0)$，则 $F = \\frac{1}{2}u_R^2$。\n这个条件的第一个部分可以写成 $u_L \\le u_R  0$。\n-   若 $u_L \\le 0 \\le u_R$，则 $F = 0$。\n\n这组条件涵盖了所有可能性，并给出了 Godunov 通量的最终表达式。", "answer": "$$\n\\boxed{\nF(u_L, u_R) = \\begin{cases}\n\\frac{1}{2}u_{L}^{2}  \\text{若 } (u_{L} \\leq u_{R} \\text{ 且 } u_{L}  0) \\text{ 或 } (u_{L}  u_{R} \\text{ 且 } u_{L}+u_{R} \\geq 0) \\\\\n\\frac{1}{2}u_{R}^{2}  \\text{若 } (u_{L} \\leq u_{R} \\text{ 且 } u_{R}  0) \\text{ 或 } (u_{L}  u_{R} \\text{ 且 } u_{L}+u_{R}  0) \\\\\n0  \\text{若 } u_{L} \\leq 0 \\leq u_{R}\n\\end{cases}\n}\n$$", "id": "3324313"}, {"introduction": "在掌握了凸通量函数的情形后，我们面临一个更高级的挑战：非凸通量。这种情况在更真实的物理模型（如相变流体动力学）中经常出现，其黎曼解的结构也更为复杂。这个练习要求你为带有非凸通量的标量守恒律设计一个满足熵条件的黎曼求解器，并处理可能出现的复合波结构，从而加深对熵条件和弱解理论的理解。", "problem": "考虑标量守恒律 $\\partial_t u + \\partial_x f(u) = 0$，该定律建立在具有网格中心 $x_{i}$ 和网格宽度 $\\Delta x$ 的均匀网格上，并令 $u_{i}^{n}$ 表示在时间 $t^{n}$ 时网格 $i$ 上 $u$ 的网格平均值。Godunov 有限体积格式通过在交界面 $x_{i \\pm \\frac{1}{2}}$ 处求解精确的满足熵条件的黎曼问题并使用由此产生的交界面通量来更新 $u_{i}^{n}$。您的任务是为非凸通量开发一个熵相容的 Godunov 更新方法，然后针对一个特定的数据配置对其进行评估。\n\n请从积分守恒的基本原理和满足熵条件的弱解的定义出发。不要假设任何未从这些基础推导出的特殊“捷径”公式。请解决以下问题：\n\n1) 从控制体积和时间片上的积分形式守恒律出发，推导 $u_{i}^{n+1}$ 的 Godunov 有限体积更新公式，该公式用由精确黎曼解在交界面上的状态定义的数值通量函数 $g(u_{L},u_{R})$ 表示。清晰地指出黎曼问题的自相似熵解所扮演的角色，以及它如何确定设定数值通量的交界面状态。\n\n2) 对于一般的非凸通量 $f(u)$，设计一个熵相容的黎曼求解器，通过强制执行 Lax 熵条件并经由凸化选择复合波，以避免伪非经典（亚压缩）激波。使用原函数 $F(u) = \\int^{u} f(s)\\,\\mathrm{d}s$ 的凸包构造来刻画连接左状态 $u_{L}$ 和右状态 $u_{R}$ 的容许熵解。根据此构造，推导 Godunov 数值通量 $g(u_{L},u_{R})$ 的闭式表达式，该表达式可以直接根据 $u_{L}$ 和 $u_{R}$ 之间的区间上的 $f$ 进行求值，而无需解隐式方程。然后将您的表达式具体化到特定的非凸通量 $f(u) = u^{3} - 3u$。\n\n3) 考虑数据 $u_{i-1}^{n} = 2$、$u_{i}^{n} = -\\frac{1}{2}$ 和 $u_{i+1}^{n} = \\frac{3}{2}$，以及非凸通量 $f(u) = u^{3} - 3u$。取 Courant–Friedrichs–Lewy 数 $\\frac{\\Delta t}{\\Delta x} = \\frac{1}{10}$。使用您推导的 Godunov 更新公式和第 (2) 部分的熵相容数值通量，计算 $u_{i}^{n+1}$。将 $u_{i}^{n+1}$ 的最终值以一个实数形式给出。由于数据是精确有理数，因此不需要四舍五入，也不涉及物理单位。", "solution": "在尝试求解之前，先对问题陈述的有效性进行评估。\n\n### 步骤 1：提取给定条件\n-   标量守恒律：$\\partial_t u + \\partial_x f(u) = 0$。\n-   网格：具有网格中心 $x_{i}$ 和网格宽度 $\\Delta x$ 的均匀网格。\n-   状态变量：$u_{i}^{n}$ 是在时间 $t^{n}$ 时网格 $i$ 上 $u$ 的网格平均值。\n-   数值方法：Godunov 有限体积格式，在交界面 $x_{i \\pm \\frac{1}{2}}$ 处求解精确的满足熵条件的黎曼问题。\n-   目标 1：推导 $u_{i}^{n+1}$ 的 Godunov 更新公式，用数值通量函数 $g(u_{L},u_{R})$ 表示。\n-   目标 2：为一般非凸通量 $f(u)$ 设计一个熵相容的黎曼求解器，并推导 Godunov 数值通量 $g(u_{L},u_{R})$ 的闭式表达式，然后将其具体化到 $f(u) = u^{3} - 3u$。\n-   目标 3：为特定的数据配置计算 $u_{i}^{n+1}$。\n-   特定的非凸通量：$f(u) = u^{3} - 3u$。\n-   时间 $t^n$ 时的初始数据：$u_{i-1}^{n} = 2$、$u_{i}^{n} = -\\frac{1}{2}$ 和 $u_{i+1}^{n} = \\frac{3}{2}$。\n-   Courant–Friedrichs–Lewy (CFL) 数：$\\frac{\\Delta t}{\\Delta x} = \\frac{1}{10}$。\n\n### 步骤 2：使用提取的给定条件进行验证\n根据所需标准对问题进行评估：\n-   **科学基础**：该问题是双曲型偏微分方程数值方法领域的标准练习，特别是关于非凸通量守恒律的 Godunov 方法。所有涉及的概念（守恒律、弱解、熵条件、黎曼问题、有限体积法）都是该学科的基石。\n-   **适定的**：该问题提供了进行唯一且有意义的计算所需的所有信息。通量函数、初始网格平均值以及时间步长与网格间距的比率都已明确定义。\n-   **客观的**：该问题以精确、形式化的数学语言陈述，没有歧义或主观因素。\n\n### 步骤 3：结论与行动\n该问题是有效的。它自成体系、科学合理且适定。将提供详细的解答。\n\n解答按要求分为三个部分。\n\n### 1. Godunov 有限体积更新公式的推导\n\n标量守恒律由 $\\partial_t u + \\partial_x f(u) = 0$ 给出。该定律在控制体积 $C_i = [x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}]$ 和时间区间 $[t^n, t^{n+1}]$ 上的积分形式为：\n$$\n\\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u(x, t^{n+1}) \\,dx - \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u(x, t^n) \\,dx = \\int_{t^n}^{t^{n+1}} f(u(x_{i-\\frac{1}{2}}, t)) \\,dt - \\int_{t^n}^{t^{n+1}} f(u(x_{i+\\frac{1}{2}}, t)) \\,dt\n$$\n令 $\\Delta x = x_{i+\\frac{1}{2}} - x_{i-\\frac{1}{2}}$ 为均匀的网格宽度。在时间 $t^n$ 时，网格 $i$ 中解的网格平均值定义为：\n$$\nu_i^n = \\frac{1}{\\Delta x} \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u(x, t^n) \\,dx\n$$\n将积分守恒律两边同除以 $\\Delta x$，我们得到：\n$$\nu_i^{n+1} - u_i^n = \\frac{1}{\\Delta x} \\left( \\int_{t^n}^{t^{n+1}} f(u(x_{i-\\frac{1}{2}}, t)) \\,dt - \\int_{t^n}^{t^{n+1}} f(u(x_{i+\\frac{1}{2}}, t)) \\,dt \\right)\n$$\nGodunov 方法基于在时间 $t^n$ 时数据的分段常数表示，即对于 $x \\in C_i$，$u(x, t^n) = u_i^n$。这在网格交界面 $x_{i\\pm\\frac{1}{2}}$ 处产生间断，从而定义了一系列黎曼问题。对于交界面 $x_{i+\\frac{1}{2}}$，黎曼问题设定左状态 $u_L = u_i^n$ 和右状态 $u_R = u_{i+1}^n$。\n\n该黎曼问题的解，记为 $W(\\frac{x-x_{i+\\frac{1}{2}}}{t-t^n}; u_i^n, u_{i+1}^n)$，是自相似且满足熵条件的。对于足够小的时间步长 $\\Delta t = t^{n+1} - t^n$（满足 CFL 条件），相邻黎曼问题的波在时间片内不会相互作用。因此，在 $t \\in (t^n, t^{n+1}]$ 期间，交界面 $x_{i+\\frac{1}{2}}$ 上的状态是恒定的，并由自相似解沿射线 $\\frac{x-x_{i+\\frac{1}{2}}}{t-t^n}=0$ 的值给出。设此状态为 $u_{i+\\frac{1}{2}}^* = W(0; u_i^n, u_{i+1}^n)$。\n\n因此，穿过交界面 $x_{i+\\frac{1}{2}}$ 的通量在时间上也是恒定的，$f(u(x_{i+\\frac{1}{2}},t)) = f(u_{i+\\frac{1}{2}}^*)$。通量的时间积分为：\n$$\n\\int_{t^n}^{t^{n+1}} f(u(x_{i+\\frac{1}{2}}, t)) \\,dt = (t^{n+1} - t^n) f(u_{i+\\frac{1}{2}}^*) = \\Delta t \\cdot f(W(0; u_i^n, u_{i+1}^n))\n$$\n我们将数值通量函数 $g(u_L, u_R)$ 定义为在精确黎曼解中出现在交界面上的状态所对应的物理通量：\n$$\ng(u_L, u_R) = f(W(0; u_L, u_R))\n$$\n使用此定义，交界面处的时间积分通量为 $\\Delta t \\cdot g(u_i^n, u_{i+1}^n)$ 和 $\\Delta t \\cdot g(u_{i-1}^n, u_i^n)$。将这些代入网格平均值更新方程，得到 Godunov 有限体积格式：\n$$\nu_i^{n+1} - u_i^n = \\frac{\\Delta t}{\\Delta x} \\left( g(u_{i-1}^n, u_i^n) - g(u_i^n, u_{i+1}^n) \\right)\n$$\n整理后得到最终的更新公式：\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x} \\left[ g(u_i^n, u_{i+1}^n) - g(u_{i-1}^n, u_i^n) \\right]\n$$\n\n### 2. 非凸通量的熵相容数值通量\n\n对于非凸通量函数 $f(u)$，黎曼解的构造必须满足 Oleinik 熵条件。此条件不允许在小扰动下不稳定的激波，例如亚压缩激波。这通过沿通量函数的凸包或凹包构造解路径来实现。问题中提到的原函数 $F(u)$ 的凸包是指一个变分公式，该公式可产生相同的熵条件。\n\n决定 Godunov 通量 $g(u_L, u_R) = f(u^*)$ 的状态 $u^* = W(0; u_L, u_R)$ 是黎曼扇中特征速度或激波速度为零的状态。这对应于熵路径（凸/凹包）上斜率为零的状态。对于一般的通量函数 $f(u)$ 和状态 $u_L, u_R$，Godunov 通量由以下表达式给出，该表达式避免了波扇的显式构造：\n$$\ng(u_L, u_R) = \\begin{cases} \\min_{u \\in [u_L, u_R]} f(u)  \\text{若 } u_L \\le u_R \\\\ \\max_{u \\in [u_R, u_L]} f(u)  \\text{若 } u_L > u_R \\end{cases}\n$$\n此公式正确地识别了满足熵条件的解中静止波处的通量。\n\n我们现在将此公式具体化到给定的非凸通量 $f(u) = u^3 - 3u$。特征速度为 $f'(u) = 3u^2 - 3$。$f'(u) = 0$ 的临界点是 $u = 1$ 和 $u = -1$。\n- 在 $u=1$ 处，$f(1) = 1^3 - 3(1) = -2$。因为 $f''(1) = 6(1) = 6  0$，这是一个局部极小值。\n- 在 $u=-1$ 处，$f(-1) = (-1)^3 - 3(-1) = 2$。因为 $f''(-1) = 6(-1) = -6  0$，这是一个局部极大值。\n\n为了计算 $g(u_L, u_R)$，我们必须找到 $f(u)$ 在 $u_L$ 和 $u_R$ 之间的区间上的全局极值。\n\n情况 1：$u_L \\le u_R$。我们需要找到 $\\min_{u \\in [u_L, u_R]} f(u)$。$[u_L, u_R]$ 上的全局最小值只能出现在端点 $u_L, u_R$ 或区间内的局部极小值点。唯一的局部极小值点在 $u=1$。因此，Godunov 通量为：\n$$\ng(u_L, u_R) = \\min(f(u_L), f(u_R), f(1)) \\quad \\text{若 } u_L  1  u_R\n$$\n如果 $1$ 不在 $(u_L, u_R)$ 内，则最小值必定在端点：\n$$\ng(u_L, u_R) = \\min(f(u_L), f(u_R)) \\quad \\text{若 } 1 \\notin [u_L, u_R]\n$$\n情况 2：$u_L  u_R$。我们需要找到 $\\max_{u \\in [u_R, u_L]} f(u)$。$[u_R, u_L]$ 上的全局最大值只能出现在端点 $u_R, u_L$ 或区间内的局部极大值点。唯一的局部极大值点在 $u=-1$。因此，Godunov 通量为：\n$$\ng(u_L, u_R) = \\max(f(u_L), f(u_R), f(-1)) \\quad \\text{若 } u_R  -1  u_L\n$$\n如果 $-1$ 不在 $(u_R, u_L)$ 内，则最大值必定在端点：\n$$\ng(u_L, u_R) = \\max(f(u_L), f(u_R)) \\quad \\text{若 } -1 \\notin [u_R, u_L]\n$$\n这些表达式构成了熵相容数值通量的闭式计算方法。\n\n### 3. $u_i^{n+1}$ 的计算\n\n给定数据 $u_{i-1}^{n} = 2$，$u_{i}^{n} = -\\frac{1}{2}$，$u_{i+1}^{n} = \\frac{3}{2}$ 以及 $\\frac{\\Delta t}{\\Delta x} = \\frac{1}{10}$。我们需要计算交界面 $x_{i-\\frac{1}{2}}$ 和 $x_{i+\\frac{1}{2}}$ 处的数值通量。\n\n在 $x_{i+\\frac{1}{2}}$ 处的通量：$g_{R} = g(u_i^n, u_{i+1}^n) = g(-\\frac{1}{2}, \\frac{3}{2})$。\n这里 $u_L = -\\frac{1}{2}$ 且 $u_R = \\frac{3}{2}$。因为 $u_L  u_R$，我们应用情况 1。区间是 $[-\\frac{1}{2}, \\frac{3}{2}]$，即 $[-0.5, 1.5]$。局部极小值点 $u=1$ 在此区间内。因此，我们必须计算端点和 $u=1$ 处的通量值：\n- $f(u_L) = f(-\\frac{1}{2}) = (-\\frac{1}{2})^3 - 3(-\\frac{1}{2}) = -\\frac{1}{8} + \\frac{3}{2} = -\\frac{1}{8} + \\frac{12}{8} = \\frac{11}{8}$。\n- $f(u_R) = f(\\frac{3}{2}) = (\\frac{3}{2})^3 - 3(\\frac{3}{2}) = \\frac{27}{8} - \\frac{9}{2} = \\frac{27}{8} - \\frac{36}{8} = -\\frac{9}{8}$。\n- $f(1) = 1^3 - 3(1) = -2 = -\\frac{16}{8}$。\n我们求这些值的最小值：\n$$\ng_{R} = \\min\\left(\\frac{11}{8}, -\\frac{9}{8}, -2\\right) = -2\n$$\n\n在 $x_{i-\\frac{1}{2}}$ 处的通量：$g_{L} = g(u_{i-1}^n, u_i^n) = g(2, -\\frac{1}{2})$。\n这里 $u_L = 2$ 且 $u_R = -\\frac{1}{2}$。因为 $u_L  u_R$，我们应用情况 2。区间是 $[-\\frac{1}{2}, 2]$。局部极大值点 $u=-1$ 不在此区间内。因此，最大值必定出现在某个端点。我们计算端点处的通量值：\n- $f(u_L) = f(2) = 2^3 - 3(2) = 8 - 6 = 2$。\n- $f(u_R) = f(-\\frac{1}{2}) = \\frac{11}{8}$。\n我们求这些值的最大值：\n$$\ng_{L} = \\max\\left(2, \\frac{11}{8}\\right) = 2\n$$\n\n最后，我们使用 Godunov 更新公式来计算 $u_i^{n+1}$：\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x} \\left[ g_{R} - g_{L} \\right]\n$$\n代入给定值和我们计算出的通量：\n$$\nu_i^{n+1} = -\\frac{1}{2} - \\frac{1}{10} \\left[ (-2) - 2 \\right]\n$$\n$$\nu_i^{n+1} = -\\frac{1}{2} - \\frac{1}{10} \\left[ -4 \\right]\n$$\n$$\nu_i^{n+1} = -\\frac{1}{2} + \\frac{4}{10} = -\\frac{1}{2} + \\frac{2}{5}\n$$\n$$\nu_i^{n+1} = -\\frac{5}{10} + \\frac{4}{10} = -\\frac{1}{10}\n$$\n更新后的网格平均值为 $-\\frac{1}{10}$。", "answer": "$$\n\\boxed{-\\frac{1}{10}}\n$$", "id": "3324334"}, {"introduction": "这个综合性练习将我们从标量方程带入气体动力学的核心——一维欧拉方程组。你将亲手实现一个完整的精确黎曼求解器，这是戈杜诺夫格式的理论基石。这项实践综合了对激波、稀疏波和接触间断等波系的理解，并要求通过迭代方法求解星区的压力和速度，是连接理论与计算实践的关键一步。", "problem": "考虑理想气体的一维欧拉方程，其比热比为 $\\gamma$，写成守恒形式，状态向量为 $\\mathbf{U} = (\\rho, \\rho u, E)^{\\top}$，通量向量为 $\\mathbf{F}(\\mathbf{U}) = (\\rho u, \\rho u^{2} + p, u(E + p))^{\\top}$，其中 $\\rho$ 是密度，$u$ 是速度，$p$ 是压力，$E = p/(\\gamma - 1) + \\tfrac{1}{2} \\rho u^{2}$ 是单位体积的总能量。界面上的黎曼问题由初始数据定义：当 $x  0$ 时 $\\mathbf{U}(x,0) = \\mathbf{U}_{L}$，当 $x > 0$ 时 $\\mathbf{U}(x,0) = \\mathbf{U}_{R}$，其中 $\\mathbf{U}_{L}, \\mathbf{U}_{R}$ 为常数。在 Godunov 有限体积格式中，精确黎曼求解器提供 $x/t = 0$ 处的界面解，这需要通过自相似解构建连接左右状态的波系，并确定中间星区的压力和速度。从控制欧拉方程以及压缩激波（Rankine–Hugoniot 条件）和等熵稀疏波（积分曲线）的基本关系出发，通过将左右波函数与速度跳跃关联起来，从第一性原理推导星区压力 $p^{*}$ 的非线性标量方程。然后，设计一个鲁棒的迭代方法，在每一侧使用相应的激波或稀疏波关系来求解 $p^{*}$。在获得 $p^{*}$ 后，根据自相似解的自洽条件计算共同的星区速度 $u^{*}$，通过将 $p^{*}$ 与给定侧的初始压力进行比较，将每一侧的波分类为激波或稀疏波，并计算左右两侧相应的星区密度。\n\n所有量都是无量纲的，所有计算都必须在没有物理单位的无量纲框架下进行。本问题不涉及角度。您的程序必须遵循这些原理，为理想气体实现欧拉方程的精确黎曼求解器。它必须通过带有解析推导导数的牛顿类迭代法求解 $p^{*}$ 的标量方程；如果牛顿迭代不收敛，需要一种有界保证的回退方法（如二分法或割线法）来确保鲁棒性。您必须确保解的物理可容许性，包括检测可能导致真空形成的条件；在这种情况下，程序不应崩溃，并应返回与极限稀疏行为一致的非负压力 $p^{*}$ 和有限速度 $u^{*}$。\n\n对于每个测试用例，输入参数为左状态 $(\\rho_{L}, u_{L}, p_{L})$、右状态 $(\\rho_{R}, u_{R}, p_{R})$ 和比热比 $\\gamma$。构建精确黎曼解，并为每个测试用例返回以下输出：\n- 星区压力 $p^{*}$，浮点数类型。\n- 星区速度 $u^{*}$，浮点数类型。\n- 左星区密度 $\\rho^{*}_{L}$，浮点数类型。\n- 右星区密度 $\\rho^{*}_{R}$，浮点数类型。\n- 左波分类，整数代码：$0$ 表示激波，$1$ 表示稀疏波。\n- 右波分类，整数代码：$0$ 表示激波，$1$ 表示稀疏波。\n\n所有浮点数输出必须四舍五入到 $6$ 位小数。在计算星区密度时，使用从第一性原理推导出的适当关系：对稀疏波使用等熵关系，对激波使用 Rankine–Hugoniot 压缩比。对于真空检测，将您的逻辑建立在从稀疏波积分推导出的临界条件上。\n\n您的程序必须生成单行输出，其中包含所有测试用例的结果，格式为一个由方括号括起来的逗号分隔列表，其中每个测试用例的结果本身就是一个包含上述六个量的、由方括号括起来的逗号分隔列表。例如，如果有 $n$ 个测试用例，您的输出必须是以下形式：$[[p^{*}_{1},u^{*}_{1},\\rho^{*}_{L,1},\\rho^{*}_{R,1},\\text{code}_{L,1},\\text{code}_{R,1}],[p^{*}_{2},u^{*}_{2},\\rho^{*}_{L,2},\\rho^{*}_{R,2},\\text{code}_{L,2},\\text{code}_{R,2}],\\ldots]$，每个浮点数四舍五入到 $6$ 位小数。\n\n使用以下参数值测试套件来评估正确性和鲁棒性：\n- 测试用例 $1$（经典的稀疏-激波模式）：$\\gamma = 1.4$, $(\\rho_{L}, u_{L}, p_{L}) = (1.0, 0.0, 1.0)$, $(\\rho_{R}, u_{R}, p_{R}) = (0.125, 0.0, 0.1)$。\n- 测试用例 $2$（Lax 型配置）：$\\gamma = 1.4$, $(\\rho_{L}, u_{L}, p_{L}) = (0.445, 0.698, 3.528)$, $(\\rho_{R}, u_{R}, p_{R}) = (0.5, 0.0, 0.571)$。\n- 测试用例 $3$（具有两道稀疏波的近真空对称膨胀）：$\\gamma = 1.4$, $(\\rho_{L}, u_{L}, p_{L}) = (1.0, -3.0, 0.4)$, $(\\rho_{R}, u_{R}, p_{R}) = (1.0, 3.0, 0.4)$。\n- 测试用例 $4$（比热比变化）：$\\gamma = 1.667$, $(\\rho_{L}, u_{L}, p_{L}) = (1.0, 0.0, 1.0)$, $(\\rho_{R}, u_{R}, p_{R}) = (0.125, 0.0, 0.1)$。\n\n您的程序应生成单行输出，其中包含如上所述的结果，格式为一个由方括号括起来的逗号分隔列表。每个浮点数必须四舍五入到 $6$ 位小数。", "solution": "所提出的问题是确定理想气体欧拉方程一维黎曼问题中间“星”区的状态。这是构建 Godunov 型有限体积方法的一项基本任务。解是自相似的，仅依赖于坐标 $x/t$，由分隔初始左右状态（$\\mathbf{U}_L, \\mathbf{U}_R$）与恒定星区状态（$(\\rho^*, u^*, p^*)$）的左行波和右行波组成。速度 $u^*$ 和压力 $p^*$ 在整个星区是恒定的，而密度是不连续的，在以速度 $u^*$ 传播的接触间断两侧分别具有值 $\\rho^*_L$ 和 $\\rho^*_R$。\n\n问题的核心是通过在接触间断处强制速度 $u^*$ 的自洽性来求得 $p^*$。速度 $u^*$ 可以表示为 $p^*$ 和两侧初始条件的函数。设初始状态为 $(\\rho_k, u_k, p_k)$，其中 $k \\in \\{L, R\\}$。从状态 $k$ 推导出的星区速度 $u^*_k(p^*)$ 必须等于共同的速度 $u^*$。\n\n$p^*$ 和 $u^*$ 之间的关系取决于连接初始状态与星区状态的波的性质（激波或稀疏波）。这通过将 $p^*$ 与初始压力 $p_k$ 进行比较来确定。设 $a_k = \\sqrt{\\gamma p_k / \\rho_k}$ 为状态 $k$ 中的声速。\n\n**1. 波函数**\n\n对于左行波系，星区速度 $u^*$ 与左状态 $(\\rho_L, u_L, p_L)$ 的关系为：\n$$ u^* = u_L - f(p^*; p_L, \\rho_L, \\gamma) $$\n对于右行波系，星区速度与右状态 $(\\rho_R, u_R, p_R)$ 的关系为：\n$$ u^* = u_R + f(p^*; p_R, \\rho_R, \\gamma) $$\n函数 $f(p^*; p_k, \\rho_k, \\gamma)$ 取决于波是激波还是稀疏波。\n\n**情况 A：激波 ($p^* > p_k$)**\n正激波的 Rankine-Hugoniot 跳跃条件给出了以下关系：\n$$ f(p^*; p_k, \\rho_k, \\gamma) = (p^* - p_k) \\sqrt{\\frac{2 / ((\\gamma+1)\\rho_k)}{p^* + \\frac{\\gamma-1}{\\gamma+1} p_k}} $$\n\n**情况 B：稀疏波 ($p^* \\le p_k$)**\n对于等熵稀疏波，该关系从黎曼不变量的恒定性推导得出：\n$$ f(p^*; p_k, \\rho_k, \\gamma) = \\frac{2 a_k}{\\gamma-1} \\left[ \\left(\\frac{p^*}{p_k}\\right)^{\\frac{\\gamma-1}{2\\gamma}} - 1 \\right] $$\n请注意，当 $p^* \\le p_k$ 时，此函数为非正值。\n\n**2. 压力的非线性方程**\n\n通过令星区速度 $u^*$ 的两个表达式相等，我们得到一个关于 $p^*$ 的单一非线性标量方程：\n$$ u_L - f(p^*; p_L, \\rho_L, \\gamma) = u_R + f(p^*; p_R, \\rho_R, \\gamma) $$\n重新整理后得到我们必须求其根的函数：\n$$ F(p^*) = f(p^*; p_L, \\rho_L, \\gamma) + f(p^*; p_R, \\rho_R, \\gamma) + u_R - u_L = 0 $$\n函数 $F(p^*)$ 是单调且凸的，这有助于实现鲁棒的数值解。\n\n**3. 通过牛顿法进行数值求解**\n\n为了使用牛顿法 $p_{n+1} = p_n - F(p_n)/F'(p_n)$ 求解 $F(p^*) = 0$，我们需要导数 $F'(p^*) = f'_L(p^*) + f'_R(p^*)$。\n\n**激波的导数 ($p^* > p_k$)**：\n$$ f'(p^*; p_k, \\rho_k, \\gamma) = \\sqrt{\\frac{2 / ((\\gamma+1)\\rho_k)}{p^* + \\frac{\\gamma-1}{\\gamma+1} p_k}} \\left(1 - \\frac{p^*-p_k}{2 \\left(p^* + \\frac{\\gamma-1}{\\gamma+1}p_k\\right)}\\right) $$\n\n**稀疏波的导数 ($p^* \\le p_k$)**：\n$$ f'(p^*; p_k, \\rho_k, \\gamma) = \\frac{1}{\\rho_k a_k} \\left(\\frac{p^*}{p_k}\\right)^{-\\frac{\\gamma+1}{2\\gamma}} $$\n迭代从一个初始猜测值开始，例如 $p_0 = (p_L + p_R)/2$，并持续进行直到收敛。必须设置安全措施以确保压力迭代值 $p_n$ 保持为正。\n\n**4. 真空条件**\n\n如果初始状态以足够快的速度相互远离，可能会形成一个压力和密度为零的真空区域。如果需要 $p^*$ 为负才能满足速度匹配，就会发生这种情况。真空形成的临界条件是从两道稀疏波在 $p^* \\to 0$ 时的波尾速度推导出来的：\n$$ u_L - u_R \\ge \\frac{2a_L}{\\gamma-1} + \\frac{2a_R}{\\gamma-1} $$\n如果满足此条件，则解取 $p^*=0$。\n\n**5. 最终状态的确定**\n\n一旦找到收敛的 $p^*$ 值，其余量计算如下：\n- **星区速度 $u^*$**：\n  $$ u^* = \\frac{1}{2} \\left( u_L + u_R + f(p^*; p_R, \\rho_R, \\gamma) - f(p^*; p_L, \\rho_L, \\gamma) \\right) $$\n- **波的分类**：对于每一侧 $k \\in \\{L, R\\}$：\n  - 如果 $p^* > p_k$，波为激波（代码 $0$）。\n  - 如果 $p^* \\le p_k$，波为稀疏波（代码 $1$）。\n- **星区密度 $\\rho^*_k$**：密度在接触面两侧是不连续的。其公式取决于波的类型。\n  - 对于激波 ($p^*>p_k$)：\n    $$ \\rho^*_k = \\rho_k \\frac{p^*/p_k + \\frac{\\gamma-1}{\\gamma+1}}{1 + \\frac{\\gamma-1}{\\gamma+1} (p^*/p_k)} $$\n  - 对于稀疏波 ($p^* \\le p_k$)：\n    $$ \\rho^*_k = \\rho_k \\left( \\frac{p^*}{p_k} \\right)^{1/\\gamma} $$\n\n这样就完成了求解黎曼问题精确解的整个过程。具体实现将遵循这些推导出的关系。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the specified test cases for the 1D Euler Riemann problem.\n    \"\"\"\n    test_cases = [\n        # Test case 1: Rarefaction-Shock (Sod-like)\n        {'gamma': 1.4, 'rho_l': 1.0, 'u_l': 0.0, 'p_l': 1.0, 'rho_r': 0.125, 'u_r': 0.0, 'p_r': 0.1},\n        # Test case 2: Lax-type shock tube\n        {'gamma': 1.4, 'rho_l': 0.445, 'u_l': 0.698, 'p_l': 3.528, 'rho_r': 0.5, 'u_r': 0.0, 'p_r': 0.571},\n        # Test case 3: Near-vacuum symmetric expansion\n        {'gamma': 1.4, 'rho_l': 1.0, 'u_l': -3.0, 'p_l': 0.4, 'rho_r': 1.0, 'u_r': 3.0, 'p_r': 0.4},\n        # Test case 4: Monatomic gas, same initial state as TC1\n        {'gamma': 1.667, 'rho_l': 1.0, 'u_l': 0.0, 'p_l': 1.0, 'rho_r': 0.125, 'u_r': 0.0, 'p_r': 0.1}\n    ]\n\n    results = []\n    for case in test_cases:\n        p_star, u_star, rho_star_l, rho_star_r, wave_l_type, wave_r_type = solve_riemann(**case)\n        \n        # Format the result for the current test case\n        formatted_result = [\n            round(p_star, 6),\n            round(u_star, 6),\n            round(rho_star_l, 6),\n            round(rho_star_r, 6),\n            wave_l_type,\n            wave_r_type\n        ]\n        results.append(formatted_result)\n\n    # Format the final output string as per requirements\n    result_strings = []\n    for r in results:\n        # Manually format each sub-list to avoid spaces from str(list)\n        sub_string = f\"[{r[0]},{r[1]},{r[2]},{r[3]},{r[4]},{r[5]}]\"\n        result_strings.append(sub_string)\n    \n    print(f\"[{','.join(result_strings)}]\")\n\ndef solve_riemann(rho_l, u_l, p_l, rho_r, u_r, p_r, gamma, tol=1e-8, max_iter=30):\n    \"\"\"\n    Solves the 1D Euler Riemann problem for an ideal gas for a single case.\n    Returns: p*, u*, rho*_L, rho*_R, wave_type_L, wave_type_R\n    \"\"\"\n    g1 = (gamma - 1.0) / (2.0 * gamma)\n    g2 = (gamma + 1.0) / (2.0 * gamma)\n    g4 = (gamma - 1.0) / (gamma + 1.0)\n    g5 = 2.0 / (gamma + 1.0)\n    g6 = 2.0 / (gamma - 1.0)\n\n    if p_l = 0 or rho_l = 0 or p_r = 0 or rho_r = 0:\n        raise ValueError(\"Initial densities and pressures must be positive.\")\n\n    a_l = np.sqrt(gamma * p_l / rho_l)\n    a_r = np.sqrt(gamma * p_r / rho_r)\n\n    # Check for vacuum formation\n    if (u_l - u_r) >= (a_l + a_r) * g6:\n        p_star = 0.0\n        f_l_vac = -g6 * a_l\n        f_r_vac = -g6 * a_r\n        u_star = 0.5 * (u_l + u_r + f_r_vac - f_l_vac)\n        \n        rho_star_l = rho_l * (p_star / p_l)**(1.0 / gamma) if p_l > 0 else 0.0\n        rho_star_r = rho_r * (p_star / p_r)**(1.0 / gamma) if p_r > 0 else 0.0\n        \n        return p_star, u_star, rho_star_l, rho_star_r, 1, 1\n\n    def pressure_function(p, p_k, rho_k, a_k):\n        \"\"\"Computes the wave function f and its derivative f'.\"\"\"\n        if p > p_k:  # Shock\n            A_k = g5 / rho_k\n            B_k = g4 * p_k\n            sqrt_term = np.sqrt(A_k / (p + B_k))\n            f = (p - p_k) * sqrt_term\n            f_prime = sqrt_term * (1.0 - (p - p_k) / (2.0 * (p + B_k)))\n        else:  # Rarefaction\n            if p > 0:\n                f = g6 * a_k * ((p / p_k)**g1 - 1.0)\n                f_prime = (1.0 / (rho_k * a_k)) * (p / p_k)**(-g2)\n            else: # Limiting case for p -> 0\n                f = -g6 * a_k\n                f_prime = np.inf\n        return f, f_prime\n\n    # Iteratively solve for p_star using Newton's method\n    p_guess = 0.5 * (p_l + p_r)\n    p_star = max(tol, p_guess)\n    du = u_r - u_l\n\n    for _ in range(max_iter):\n        f_l, fp_l = pressure_function(p_star, p_l, rho_l, a_l)\n        f_r, fp_r = pressure_function(p_star, p_r, rho_r, a_r)\n        \n        F = f_l + f_r + du\n        Fp = fp_l + fp_r\n        \n        if Fp == 0: \n            break\n            \n        p_new = p_star - F / Fp\n        \n        if np.abs(p_new - p_star)  tol * p_star + tol:\n            p_star = p_new\n            break\n        \n        if p_new  0:\n            p_new = tol # Safeguard: clamp to small positive value\n        \n        p_star = p_new\n    \n    # Compute the remaining star region values\n    f_l, _ = pressure_function(p_star, p_l, rho_l, a_l)\n    f_r, _ = pressure_function(p_star, p_r, rho_r, a_r)\n    u_star = 0.5 * (u_l + u_r + f_r - f_l)\n\n    # Classify waves\n    wave_l_type = 1 if p_star = p_l else 0\n    wave_r_type = 1 if p_star = p_r else 0\n\n    # Compute star densities\n    if wave_l_type == 1:  # Rarefaction\n        rho_star_l = rho_l * (p_star / p_l)**(1.0 / gamma) if p_l > 0 and p_star > 0 else 0.0\n    else:  # Shock\n        num = p_star / p_l + g4\n        den = g4 * p_star / p_l + 1.0\n        rho_star_l = rho_l * num / den\n\n    if wave_r_type == 1:  # Rarefaction\n        rho_star_r = rho_r * (p_star / p_r)**(1.0 / gamma) if p_r > 0 and p_star > 0 else 0.0\n    else:  # Shock\n        num = p_star / p_r + g4\n        den = g4 * p_star / p_r + 1.0\n        rho_star_r = rho_r * num / den\n        \n    return p_star, u_star, rho_star_l, rho_star_r, wave_l_type, wave_r_type\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3324319"}]}