{"hands_on_practices": [{"introduction": "要想真正掌握 Roe 求解器，没有比从零开始实现它更好的方法了。第一个练习将指导您将 Roe 求解器的核心数学公式转化为一个可运行的程序。通过为各种典型的测试用例计算 Roe 平均状态、波强度和最终的数值通量，您将为后续的探索建立坚实的基础和实用的工具。[@problem_id:3359352]", "problem": "考虑在计算流体动力学（CFD）和Roe近似黎曼求解器的背景下的一维可压缩欧拉方程。守恒变量为 $U = [\\rho, \\rho u, E]^T$，其中 $\\rho$ 是质量密度（单位为 $\\mathrm{kg \\, m^{-3}}$），$u$ 是速度（单位为 $\\mathrm{m \\, s^{-1}}$），$E$ 是总能量密度（单位为 $\\mathrm{J \\, m^{-3}}$）。压力 $p$（单位为 $\\mathrm{Pa}$）通过量热完全气体的热力学闭合关系与守恒变量相关联，其比热比为 $\\gamma$：\n$$\np = (\\gamma - 1)\\left(E - \\tfrac{1}{2} \\rho u^2\\right).\n$$\n物理通量矢量为\n$$\nF(U) = \\begin{bmatrix}\n\\rho u \\\\\n\\rho u^2 + p \\\\\nu(E + p)\n\\end{bmatrix},\n$$\n其中质量通量单位为 $\\mathrm{kg \\, m^{-2} \\, s^{-1}}$，动量通量单位为 $\\mathrm{kg \\, m^{-1} \\, s^{-2}}$，能量通量单位为 $\\mathrm{W \\, m^{-2}}$。\n\nRoe近似黎曼求解器在左、右状态之间的一个Roe平均状态下构造一个线性化的通量雅可比矩阵 $A^{\\sim}$。设左、右原始变量状态为 $(\\rho_L, u_L, p_L)$ 和 $(\\rho_R, u_R, p_R)$，且具有相同的 $\\gamma$。定义左、右总能量为\n$$\nE_L = \\frac{p_L}{\\gamma - 1} + \\tfrac{1}{2} \\rho_L u_L^2, \\quad E_R = \\frac{p_R}{\\gamma - 1} + \\tfrac{1}{2} \\rho_R u_R^2,\n$$\n比焓定义为\n$$\nH_L = \\frac{E_L + p_L}{\\rho_L}, \\quad H_R = \\frac{E_R + p_R}{\\rho_R}.\n$$\nRoe平均变量通过密度的平方根加权获得：\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L} u_L + \\sqrt{\\rho_R} u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}, \\quad \\tilde{H} = \\frac{\\sqrt{\\rho_L} H_L + \\sqrt{\\rho_R} H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}},\n$$\nRoe平均声速为\n$$\n\\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\tfrac{1}{2} \\tilde{u}^2\\right)}.\n$$\nRoe线性化雅可比矩阵 $A^{\\sim}$ 的特征值为\n$$\n\\Lambda = \\mathrm{diag}(\\lambda_1, \\lambda_2, \\lambda_3) = \\mathrm{diag}(\\tilde{u} - \\tilde{a}, \\tilde{u}, \\tilde{u} + \\tilde{a}),\n$$\n一维欧拉系统的一组规范右特征向量（$R$的列）为\n$$\nr_1 = \\begin{bmatrix} 1 \\\\ \\tilde{u} - \\tilde{a} \\\\ \\tilde{H} - \\tilde{u}\\tilde{a} \\end{bmatrix}, \\quad\nr_2 = \\begin{bmatrix} 1 \\\\ \\tilde{u} \\\\ \\tfrac{1}{2}\\tilde{u}^2 \\end{bmatrix}, \\quad\nr_3 = \\begin{bmatrix} 1 \\\\ \\tilde{u} + \\tilde{a} \\\\ \\tilde{H} + \\tilde{u}\\tilde{a} \\end{bmatrix},\n$$\n使得\n$$\nR = \\begin{bmatrix}\n1 & 1 & 1 \\\\\n\\tilde{u} - \\tilde{a} & \\tilde{u} & \\tilde{u} + \\tilde{a} \\\\\n\\tilde{H} - \\tilde{u}\\tilde{a} & \\tfrac{1}{2}\\tilde{u}^2 & \\tilde{H} + \\tilde{u}\\tilde{a}\n\\end{bmatrix}.\n$$\n令 $L = R^{-1}$ 为左特征向量矩阵。守恒变量的跳跃为 $\\Delta U = U_R - U_L$，其中 $U_L = [\\rho_L, \\rho_L u_L, E_L]^T$ 且 $U_R = [\\rho_R, \\rho_R u_R, E_R]^T$。波强度为\n$$\n\\alpha = \\begin{bmatrix} \\alpha_1 \\\\ \\alpha_2 \\\\ \\alpha_3 \\end{bmatrix} = L \\, \\Delta U.\n$$\nRoe数值通量则计算如下：\n$$\nF^{\\mathrm{Roe}} = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2} \\sum_{i=1}^{3} |\\lambda_i| \\, \\alpha_i \\, r_i.\n$$\n\n您的任务是实现一个完整的、可运行的程序，对于每个给定的测试用例，该程序执行以下操作：\n- 根据原始输入和 $\\gamma$ 计算 $U_L$、$U_R$、$F(U_L)$、$F(U_R)$。\n- 形成Roe平均值 $\\tilde{u}$、$\\tilde{H}$、$\\tilde{a}$。\n- 构造 $R$、$\\Lambda$ 和 $L$。\n- 计算波强度 $\\alpha_i$。\n- 计算数值通量 $F^{\\mathrm{Roe}}$ 并返回其前三个分量（质量、动量、能量通量）。\n\n您的程序必须计算矩阵和波强度，但只输出通量分量。使用以下具有比热比 $\\gamma$ 的左/右原始状态测试套件：\n- 测试1（典型的类激波管对比）：$(\\rho_L, u_L, p_L, \\gamma) = (1.0, 0.0, 100000.0, 1.4)$ 和 $(\\rho_R, u_R, p_R, \\gamma) = (0.125, 0.0, 10000.0, 1.4)$。\n- 测试2（类接触间断情况）：$(\\rho_L, u_L, p_L, \\gamma) = (1.0, 300.0, 100000.0, 1.4)$ 和 $(\\rho_R, u_R, p_R, \\gamma) = (0.125, 300.0, 100000.0, 1.4)$。\n- 测试3（强压缩情况）：$(\\rho_L, u_L, p_L, \\gamma) = (1.0, 800.0, 150000.0, 1.4)$ 和 $(\\rho_R, u_R, p_R, \\gamma) = (0.5, 100.0, 80000.0, 1.4)$。\n- 测试4（具有相反速度的近真空右状态）：$(\\rho_L, u_L, p_L, \\gamma) = (1.0, 50.0, 200000.0, 1.4)$ 和 $(\\rho_R, u_R, p_R, \\gamma) = (0.02, -50.0, 5000.0, 1.4)$。\n\n所有通量必须以国际单位制（SI）表示。具体而言：\n- 质量通量单位为 $\\mathrm{kg \\, m^{-2} \\, s^{-1}}$。\n- 动量通量单位为 $\\mathrm{kg \\, m^{-1} \\, s^{-2}}$。\n- 能量通量单位为 $\\mathrm{W \\, m^{-2}}$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个测试用例一个三元组。每个三元组的形式必须为 $[f_\\mathrm{mass}, f_\\mathrm{mom}, f_\\mathrm{energy}]$，四舍五入到八位小数，且不含空格。例如，输出格式必须为\n$$\n[[x_1,y_1,z_1],[x_2,y_2,z_2],[x_3,y_3,z_3],[x_4,y_4,z_4]]\n$$\n其中 $x_i$、$y_i$、$z_i$ 是十进制浮点数。", "solution": "该问题是有效的。它提出了一个清晰、独立且有科学依据的任务：为一组明确定义的测试用例，实现一维欧拉方程的Roe近似黎曼求解器。方程、变量定义和算法步骤在计算流体动力学领域都是标准且正确的。我现在将提供论证后的解决方案。\n\n解决方案涉及如前所述的Roe求解器算法的逐步实现。对于每个测试用例，我们都给出了左、右状态的原始变量 $(\\rho_L, u_L, p_L)$ 和 $(\\rho_R, u_R, p_R)$，以及比热比 $\\gamma$。目标是计算这两个状态之间界面上的Roe数值通量 $F^{\\mathrm{Roe}}$。\n\n过程如下：\n\n1.  **计算守恒状态矢量和物理通量**\n    第一步是将给定的原始变量 $(\\rho, u, p)$ 转换为守恒变量矢量 $U = [\\rho, \\rho u, E]^T$。总能量密度 $E$ 由量热完全气体的状态方程给出：\n    $$\n    E = \\frac{p}{\\gamma - 1} + \\frac{1}{2} \\rho u^2\n    $$\n    对左（L）和右（R）状态都执行此操作，以获得 $U_L$ 和 $U_R$。\n    $$\n    U_L = \\begin{bmatrix} \\rho_L \\\\ \\rho_L u_L \\\\ E_L \\end{bmatrix}, \\quad U_R = \\begin{bmatrix} \\rho_R \\\\ \\rho_R u_R \\\\ E_R \\end{bmatrix}\n    $$\n    随后，使用以下公式计算物理通量矢量 $F(U_L)$ 和 $F(U_R)$：\n    $$\n    F(U) = \\begin{bmatrix}\n    \\rho u \\\\\n    \\rho u^2 + p \\\\\n    u(E + p)\n    \\end{bmatrix}\n    $$\n\n2.  **计算Roe平均状态**\n    Roe方法通过引入一个特殊的平均状态 $(\\tilde{\\rho}, \\tilde{u}, \\tilde{p}, \\tilde{H}, \\tilde{a})$ 来线性化黎曼问题。关键是这个平均状态必须满足Roe性质，$\\Delta F = \\tilde{A} \\Delta U$，其中 $\\tilde{A}$ 是在Roe平均状态下计算的雅可比矩阵。问题陈述中提供的特定平均公式保证了这一点。\n    我们首先计算左、右状态的比焓：\n    $$\n    H_L = \\frac{E_L + p_L}{\\rho_L}, \\quad H_R = \\frac{E_R + p_R}{\\rho_R}\n    $$\n    然后使用密度的平方根加权计算Roe平均速度 $\\tilde{u}$ 和比焓 $\\tilde{H}$：\n    $$\n    \\tilde{u} = \\frac{\\sqrt{\\rho_L} u_L + \\sqrt{\\rho_R} u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}, \\quad \\tilde{H} = \\frac{\\sqrt{\\rho_L} H_L + \\sqrt{\\rho_R} H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n    $$\n    由此，可以找到Roe平均声速 $\\tilde{a}$：\n    $$\n    \\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\tfrac{1}{2} \\tilde{u}^2\\right)}\n    $$\n\n3.  **确定Roe矩阵的特征结构**\n    Roe矩阵 $\\tilde{A}$ 拥有一组实特征值和一组完备的线性无关特征向量。特征值对应于线性化系统中特征波的速度：\n    $$\n    \\lambda_1 = \\tilde{u} - \\tilde{a}, \\quad \\lambda_2 = \\tilde{u}, \\quad \\lambda_3 = \\tilde{u} + \\tilde{a}\n    $$\n    给出了相应的右特征向量 $r_1, r_2, r_3$，它们构成了右特征向量矩阵 $R$ 的列。左特征向量矩阵 $L$ 是 $R$ 的逆矩阵，即 $L=R^{-1}$。\n\n4.  **计算波强度**\n    守恒变量的跳跃 $\\Delta U = U_R - U_L$ 被投影到右特征向量的基上。该投影的系数就是波强度 $\\alpha_i$。\n    $$\n    \\Delta U = \\sum_{i=1}^3 \\alpha_i r_i = R \\alpha\n    $$\n    波强度矢量 $\\alpha = [\\alpha_1, \\alpha_2, \\alpha_3]^T$ 通过求解这个线性系统得到，最直接的方法是计算 $\\alpha = R^{-1} \\Delta U = L \\Delta U$。\n\n5.  **计算Roe数值通量**\n    Roe通量被构造为左、右物理通量的平均值，再加上一个耗散项，该项模拟了从界面传播的波的影响。该耗散项由波强度、特征值和特征向量构造而成。\n    $$\n    F^{\\mathrm{Roe}} = \\frac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\frac{1}{2} \\sum_{i=1}^{3} |\\lambda_i| \\, \\alpha_i \\, r_i\n    $$\n    项 $|\\lambda_i|$ 确保格式被正确地迎风化。$\\lambda_i > 0$ 的波向右传播，而 $\\lambda_i  0$ 的波向左传播。该总和代表了这些波在单元界面上的净效应，提供了必要的数值耗散以确保稳定性并捕捉激波等间断。绝对值 $|...|$至关重要，因为它确保耗散项总是起到减少总变差的作用，将陡峭的梯度平滑到几个网格单元上。\n\n通过对每个测试用例实施这些步骤，我们可以获得所需的数值通量矢量，其分量代表了跨单元界面的质量、动量和能量通量。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the Roe's approximate Riemann solver problem\n    for the given test cases.\n    \"\"\"\n\n    test_cases = [\n        {'L': (1.0, 0.0, 100000.0), 'R': (0.125, 0.0, 10000.0), 'gamma': 1.4},\n        {'L': (1.0, 300.0, 100000.0), 'R': (0.125, 300.0, 100000.0), 'gamma': 1.4},\n        {'L': (1.0, 800.0, 150000.0), 'R': (0.5, 100.0, 80000.0), 'gamma': 1.4},\n        {'L': (1.0, 50.0, 200000.0), 'R': (0.02, -50.0, 5000.0), 'gamma': 1.4}\n    ]\n\n    results = []\n    for case in test_cases:\n        rho_l, u_l, p_l = case['L']\n        rho_r, u_r, p_r = case['R']\n        gamma = case['gamma']\n\n        flux_vector = compute_roe_flux(rho_l, u_l, p_l, rho_r, u_r, p_r, gamma)\n        \n        formatted_flux = (f\"[{flux_vector[0]:.8f},\"\n                          f\"{flux_vector[1]:.8f},\"\n                          f\"{flux_vector[2]:.8f}]\")\n        results.append(formatted_flux)\n\n    print(f\"[{','.join(results)}]\")\n\ndef compute_roe_flux(rho_l, u_l, p_l, rho_r, u_r, p_r, gamma):\n    \"\"\"\n    Computes the Roe numerical flux for the 1D Euler equations.\n\n    Args:\n        rho_l, u_l, p_l (float): Density, velocity, and pressure for the left state.\n        rho_r, u_r, p_r (float): Density, velocity, and pressure for the right state.\n        gamma (float): Ratio of specific heats.\n\n    Returns:\n        numpy.ndarray: The Roe flux vector [mass_flux, momentum_flux, energy_flux].\n    \"\"\"\n    \n    gm1 = gamma - 1.0\n\n    # Step 1: Compute Conservative State Vectors and Physical Fluxes\n    # Left State\n    e_l = p_l / gm1 + 0.5 * rho_l * u_l**2\n    u_vec_l = np.array([rho_l, rho_l * u_l, e_l])\n    f_vec_l = np.array([rho_l * u_l, rho_l * u_l**2 + p_l, u_l * (e_l + p_l)])\n\n    # Right State\n    e_r = p_r / gm1 + 0.5 * rho_r * u_r**2\n    u_vec_r = np.array([rho_r, rho_r * u_r, e_r])\n    f_vec_r = np.array([rho_r * u_r, rho_r * u_r**2 + p_r, u_r * (e_r + p_r)])\n\n    # Step 2: Compute Roe-Averaged State\n    sqrt_rho_l = np.sqrt(rho_l)\n    sqrt_rho_r = np.sqrt(rho_r)\n    \n    # Roe-averaged velocity\n    u_roe = (sqrt_rho_l * u_l + sqrt_rho_r * u_r) / (sqrt_rho_l + sqrt_rho_r)\n    \n    # Specific enthalpies\n    h_l = (e_l + p_l) / rho_l\n    h_r = (e_r + p_r) / rho_r\n    \n    # Roe-averaged specific enthalpy\n    h_roe = (sqrt_rho_l * h_l + sqrt_rho_r * h_r) / (sqrt_rho_l + sqrt_rho_r)\n    \n    # Roe-averaged sound speed\n    a_roe_sq = gm1 * (h_roe - 0.5 * u_roe**2)\n    a_roe = np.sqrt(a_roe_sq)\n\n    # Step 3: Determine the Eigenstructure of the Roe Matrix\n    # Eigenvalues\n    lambda_vals = np.array([u_roe - a_roe, u_roe, u_roe + a_roe])\n    \n    # Right eigenvectors\n    r1 = np.array([1.0, u_roe - a_roe, h_roe - u_roe * a_roe])\n    r2 = np.array([1.0, u_roe, 0.5 * u_roe**2])\n    r3 = np.array([1.0, u_roe + a_roe, h_roe + u_roe * a_roe])\n    \n    # Right eigenvector matrix (eigenvectors as columns)\n    R = np.vstack([r1, r2, r3]).T\n\n    # Step 4: Calculate Wave Strengths\n    # Left eigenvector matrix\n    L = np.linalg.inv(R)\n    \n    # Jump in conservative variables\n    delta_u = u_vec_r - u_vec_l\n    \n    # Wave strengths\n    alpha_vals = L @ delta_u\n\n    # Step 5: Compute the Roe Numerical Flux\n    # Dissipation term: sum of |lambda_i| * alpha_i * r_i\n    dissipation = np.zeros(3)\n    abs_lambda = np.abs(lambda_vals)\n    r_vecs = [r1, r2, r3]\n    for i in range(3):\n        dissipation += abs_lambda[i] * alpha_vals[i] * r_vecs[i]\n\n    # Final Roe flux\n    f_roe = 0.5 * (f_vec_l + f_vec_r) - 0.5 * dissipation\n    \n    return f_roe\n\nif __name__ == \"__main__\":\n    solve()\n\n```", "id": "3359352"}, {"introduction": "尽管标准的 Roe 求解器效率很高，但在跨音速稀疏波等特定情况下可能会失效，产生不符合物理规律的膨胀激波。本练习通过引入“熵修正”来解决这个关键缺陷，这是一种有针对性的修改，以确保解的物理真实性。您将实现此修正，并且重要的是，分析其对静止接触间断的意外副作用，从而揭示数值格式设计中固有的精细权衡。[@problem_id:3359305]", "problem": "您需要为理想气体和恒定比热比的一维气体动力学欧拉方程实现并分析Roe近似黎曼求解器，并引入一个仅应用于声学场的熵修正。然后，定量评估此熵修正对保持静止接触间断的影响。\n\n从以下基本基础开始：\n- 理想气体的一维气体动力学欧拉方程的守恒形式如下：\n$$\nU_t + F(U)_x = 0,\n$$\n其中守恒状态向量为\n$$\nU = \\begin{bmatrix} \\rho \\\\ \\rho u \\\\ E \\end{bmatrix},\n$$\n通量为\n$$\nF(U) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{bmatrix},\n$$\n理想气体的热力学闭合关系为\n$$\np = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho u^2\\right).\n$$\n这里，$ \\rho $ 是密度，$ u $ 是速度，$ p $ 是压力，$ E $ 是总能量密度，$ \\gamma $ 是比热比。\n\n- Roe线性化使用Roe平均状态来近似雅可比矩阵。定义Roe平均速度 $ \\tilde{u} $、Roe平均比焓 $ \\tilde{H} $ 和Roe平均声速 $ \\tilde{a} $ 如下：\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L}u_L + \\sqrt{\\rho_R}u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}, \\quad\n\\tilde{H} = \\frac{\\sqrt{\\rho_L}H_L + \\sqrt{\\rho_R}H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}, \\quad\n\\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\frac{1}{2}\\tilde{u}^2\\right)},\n$$\n其中 $ H = (E + p)/\\rho $ 是总比焓，下标 $ L $ 和 $ R $ 分别表示左、右状态。\n\n- Roe平均雅可比矩阵的特征值为\n$$\n\\lambda_1 = \\tilde{u} - \\tilde{a}, \\quad \\lambda_2 = \\tilde{u}, \\quad \\lambda_3 = \\tilde{u} + \\tilde{a},\n$$\n其对应的右特征向量（以守恒变量形式表示）为\n$$\nr_1 = \\begin{bmatrix} 1 \\\\ \\tilde{u} - \\tilde{a} \\\\ \\tilde{H} - \\tilde{u}\\tilde{a} \\end{bmatrix}, \\quad\nr_2 = \\begin{bmatrix} 1 \\\\ \\tilde{u} \\\\ \\frac{1}{2}\\tilde{u}^2 \\end{bmatrix}, \\quad\nr_3 = \\begin{bmatrix} 1 \\\\ \\tilde{u} + \\tilde{a} \\\\ \\tilde{H} + \\tilde{u}\\tilde{a} \\end{bmatrix}.\n$$\n令 $ \\Delta U = U_R - U_L $。波强度向量 $ \\alpha = (\\alpha_1, \\alpha_2, \\alpha_3)^T $ 可通过以下线性系统获得\n$$\nR \\alpha = \\Delta U, \\quad \\text{其中 } R = [r_1 \\; r_2 \\; r_3].\n$$\n\n- 界面处的Roe数值通量为\n$$\n\\hat{F}(U_L, U_R) = \\frac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\frac{1}{2}\\sum_{i=1}^3 |\\lambda_i| \\alpha_i r_i.\n$$\n\n- 熵修正在声速点附近对特征值的绝对值进行正则化。使用Harten的二次熵修正函数，阈值为 $ \\delta  0 $：\n$$\n\\phi(|\\lambda|;\\delta) = \\begin{cases}\n\\frac{1}{2}\\left(\\frac{|\\lambda|^2}{\\delta} + \\delta\\right),  \\text{if } |\\lambda|  \\delta, \\\\\n|\\lambda|,  \\text{if } |\\lambda| \\ge \\delta.\n\\end{cases}\n$$\n仅将此熵修正应用于声学场，即将 $ |\\lambda_1| $ 和 $ |\\lambda_3| $ 修改为 $ \\phi(|\\lambda_1|;\\delta) $ 和 $ \\phi(|\\lambda_3|;\\delta) $，而保持 $ |\\lambda_2| $ 不变。作为对比，也考虑将熵修正应用于所有三个场的备选配置。\n\n任务：\n1. 实现一个函数，使用Roe求解器计算 $ \\hat{F}(U_L, U_R) $，该函数具有可配置的熵修正模式：无（none）、仅声学场（acoustic-only）或所有特征值（all-eigenvalues）。\n2. 评估静止接触间断是否被保持。此处的静止接触间断定义为 $ u_L = u_R = 0 $，$ p_L = p_R $ 且 $ \\rho_L \\ne \\rho_R $。在这种情况下，两侧的物理通量相等，即 $ F(U_L) = F(U_R) = [0, p, 0]^T $，界面上的完美保持意味着数值通量 $ \\hat{F} $ 精确等于 $ [0, p, 0]^T $。\n3. 全程使用无量纲量；不需要物理单位。\n\n定义保持准则：对于给定的配置，计算静止接触情况下的数值通量 $ \\hat{F} $ 和精确物理通量 $ F(U_L) $，然后计算误差向量 $ e = \\hat{F} - F(U_L) $ 及其欧几里得范数 $ \\|e\\|_2 $。如果 $ \\|e\\|_2 \\le \\varepsilon $，则界面保持静止接触，其中 $ \\varepsilon $ 是一个固定的容差。\n\n测试套件：\n使用以下测试用例，所有用例的比热比 $ \\gamma = 1.4 $，容差 $ \\varepsilon = 10^{-12} $。\n\n- 用例1（标准情况）：左侧 $ (\\rho_L, u_L, p_L) = (1.0, 0.0, 1.0) $，右侧 $ (\\rho_R, u_R, p_R) = (2.0, 0.0, 1.0) $，熵修正阈值 $ \\delta = 10^{-3} $，熵修正模式：仅声学场（acoustic-only）。输出一个布尔值，指示是否保持。\n\n- 用例2（对比配置）：状态与用例1相同，熵修正阈值 $ \\delta = 10^{-3} $，熵修正模式：所有特征值（all-eigenvalues）。输出一个布尔值，指示是否保持。\n\n- 用例3（边界阈值）：状态与用例1相同，熵修正阈值 $ \\delta = 10^{-12} $，熵修正模式：所有特征值（all-eigenvalues）。输出一个布尔值，指示是否保持。\n\n- 用例4（近静止接触间断，对仅声学场修正的影响）：左侧 $ (\\rho_L, u_L, p_L) = (1.0, 10^{-6}, 1.0) $，右侧 $ (\\rho_R, u_R, p_R) = (2.0, 10^{-6}, 1.0) $，熵修正阈值 $ \\delta = 10^{-3} $。计算熵修正模式为“无”（none）和“仅声学场”（acoustic-only）时的数值通量，并输出它们差值的欧几里得范数 $ \\|\\hat{F}_{\\text{acoustic}} - \\hat{F}_{\\text{none}}\\|_2 $，结果为浮点数。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$ [\\text{result1},\\text{result2},\\text{result3},\\text{result4}] $），前三个条目分别为用例1-3的布尔值结果，第四个条目为用例4的浮点数结果。所有计算都必须是无量纲的。", "solution": "用户要求实现并分析用于一维欧拉方程的Roe近似黎曼求解器，并特别关注熵修正对保持静止接触间断的影响。该问题在科学上是合理的，提法恰当，并且提供了所有必要的定义和数据。我将提供一个完整的解决方案。\n\n解决方案涉及分步实现Roe求解器，然后分析其在四个指定测试用例下的行为。该方法的核心是在左状态 $U_L$ 和右状态 $U_R$ 之间的界面上计算数值通量 $\\hat{F}(U_L, U_R)$。\n\n### 步骤1：状态和通量表示\n问题以原始变量 $(\\rho, u, p)$ 提供了状态。必须首先将它们转换为守恒状态向量 $U = [\\rho, \\rho u, E]^T$。总能量密度 $E$ 可通过重新整理理想气体状态方程得到：\n$$\nE = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho u^2\n$$\n物理通量函数 $F(U)$ 由下式给出：\n$$\nF(U) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{bmatrix}\n$$\n我们需要为左、右两种状态计算此通量。\n\n### 步骤2：Roe平均状态\nRoe方法通过引入一个状态平均的雅可比矩阵来线性化问题。该矩阵的元素取决于Roe平均量，这些量是根据左（$L$）和右（$R$）状态计算的。所需的平均量是速度 $\\tilde{u}$、比焓 $\\tilde{H}$ 和声速 $\\tilde{a}$。\n\n首先，我们定义比焓 $H = (E+p)/\\rho$。然后，Roe平均值的计算如下：\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L}u_L + \\sqrt{\\rho_R}u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\n$$\n\\tilde{H} = \\frac{\\sqrt{\\rho_L}H_L + \\sqrt{\\rho_R}H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\n$$\n\\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\frac{1}{2}\\tilde{u}^2\\right)}\n$$\n构建这些平均值的目的是为了精确满足Rankine-Hugoniot条件，即 $F(U_R) - F(U_L) = \\tilde{A}(U_R - U_L)$，其中 $\\tilde{A}$ 是在Roe平均状态下求值的雅可比矩阵。\n\n### 步骤3：波分解\n跨界面的状态跳跃 $\\Delta U = U_R - U_L$ 被投影到Roe平均雅可比矩阵 $\\tilde{A}$ 的右特征向量基上。$\\tilde{A}$ 的特征值为 $\\lambda_1 = \\tilde{u} - \\tilde{a}$、$\\lambda_2 = \\tilde{u}$ 和 $\\lambda_3 = \\tilde{u} + \\tilde{a}$，分别对应左行声波、熵/接触波和右行声波。该投影由以下线性系统给出：\n$$\nR \\alpha = \\Delta U\n$$\n其中 $R = [r_1, r_2, r_3]$ 是以右特征向量为列的矩阵，$\\alpha = [\\alpha_1, \\alpha_2, \\alpha_3]^T$ 是波强度向量。通过求解这个 $3 \\times 3$ 系统，我们得到了波强度的显式公式：\n$$\n\\alpha_2 = \\frac{\\gamma-1}{\\tilde{a}^2} \\left( \\Delta U_1 (\\tilde{H} - \\tilde{u}^2) + \\Delta U_2 \\tilde{u} - \\Delta U_3 \\right)\n$$\n$$\n\\alpha_1 = \\frac{1}{2} \\left[ (\\Delta U_1 - \\alpha_2) - \\frac{\\Delta U_2 - \\tilde{u}\\Delta U_1}{\\tilde{a}} \\right]\n$$\n$$\n\\alpha_3 = \\frac{1}{2} \\left[ (\\Delta U_1 - \\alpha_2) + \\frac{\\Delta U_2 - \\tilde{u}\\Delta U_1}{\\tilde{a}} \\right]\n$$\n其中 $\\Delta U = [\\Delta U_1, \\Delta U_2, \\Delta U_3]^T$。\n\n### 步骤4：带熵修正的数值通量\nRoe数值通量是一种迎风型通量，由左、右通量的平均值加上一个模拟界面处波传播的耗散项构成。\n$$\n\\hat{F}(U_L, U_R) = \\frac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\frac{1}{2}\\sum_{i=1}^3 |\\lambda_i|_{\\text{fixed}} \\alpha_i r_i\n$$\n项 $|\\lambda_i|$ 引入了数值耗散。然而，对于接近零的特征值，这可能产生非物理的解，如膨胀激波。应用Harten的熵修正来对 $|\\lambda_i|$ 进行正则化：\n$$\n|\\lambda_i|_{\\text{fixed}} = \\phi(|\\lambda_i|;\\delta) = \\begin{cases}\n\\frac{1}{2}\\left(\\frac{|\\lambda_i|^2}{\\delta} + \\delta\\right),  \\text{if } |\\lambda_i|  \\delta \\\\\n|\\lambda_i|,  \\text{if } |\\lambda_i| \\ge \\delta\n\\end{cases}\n$$\n问题指定了三种应用此修正的模式：`'none'`（无）、`'acoustic-only'`（仅应用于 $\\lambda_1, \\lambda_3$）和 `'all-eigenvalues'`（所有特征值）。\n\n### 测试用例分析\n\n**用例1：静止接触，仅声学场修正**\n- 状态：$(\\rho_L, u_L, p_L)=(1.0, 0.0, 1.0)$，$(\\rho_R, u_R, p_R)=(2.0, 0.0, 1.0)$。模式：`acoustic-only`。\n- 静止接触具有 $u_L=u_R=0$ 和 $p_L=p_R$ 的特点。这意味着 $\\tilde{u}=0$。两侧的物理通量为 $F(U_L)=F(U_R)=[0, p, 0]^T = [0, 1, 0]^T$。要实现完美保持，$\\hat{F}$ 必须等于此通量。\n- 对于此配置，波分解正确地将间断分离到接触波中。波强度为 $\\alpha_1=0$、$\\alpha_3=0$ 和 $\\alpha_2 = \\Delta \\rho = 1$。耗散项变为 $\\frac{1}{2}|\\lambda_2|_{\\text{fixed}} \\alpha_2 r_2$。\n- 特征值 $\\lambda_2 = \\tilde{u} = 0$。在 `'acoustic-only'` 模式下，不对该特征值应用熵修正，因此 $|\\lambda_2|_{\\text{fixed}} = |\\lambda_2| = 0$。\n- 耗散项恰好为零。因此，$\\hat{F} = \\frac{1}{2}(F_L + F_R) = F_L$。误差为零，静止接触被完美保持。结果为 `True`。\n\n**用例2：静止接触，所有特征值修正**\n- 状态相同，但熵修正应用于所有特征值。\n- 波强度再次为 $\\alpha=(0, 1, 0)$。耗散项为 $\\frac{1}{2}|\\lambda_2|_{\\text{fixed}} \\alpha_2 r_2$。\n- 特征值 $\\lambda_2 = 0$。当 $\\delta=10^{-3}$ 时，我们有 $|\\lambda_2|  \\delta$。修正被激活：$|\\lambda_2|_{\\text{fixed}} = \\phi(0; \\delta) = \\frac{\\delta}{2}$。\n- 耗散项非零：$\\frac{1}{2} (\\frac{\\delta}{2}) (1) r_2$，其中 $r_2 = [1, \\tilde{u}, \\frac{1}{2}\\tilde{u}^2]^T = [1,0,0]^T$。耗散向量为 $[\\delta/4, 0, 0]^T$。\n- 数值通量为 $\\hat{F} = [0, 1, 0]^T - [\\delta/4, 0, 0]^T$。误差向量为 $e = [-\\delta/4, 0, 0]^T$。\n- 误差范数为 $\\|e\\|_2 = \\delta/4 = 10^{-3}/4 = 2.5 \\times 10^{-4}$。\n- 由于 $2.5 \\times 10^{-4} > \\varepsilon=10^{-12}$，条件未满足。接触间断未被保持。结果为 `False`。这表明对接触波应用熵修正会引入伪耗散，从而涂抹静止接触间断。\n\n**用例3：静止接触，所有特征值修正，小 $\\delta$ 值**\n- 与用例2相同，但 $\\delta = 10^{-12}$。\n- 误差范数同样为 $\\delta/4 = 10^{-12}/4 = 2.5 \\times 10^{-13}$。\n- 此时，$2.5 \\times 10^{-13} \\le \\varepsilon=10^{-12}$。保持准则得到满足。结果为 `True`。\n\n**用例4：近静止接触间断**\n- 状态：$(\\rho_L, u_L, p_L)=(1.0, 10^{-6}, 1.0)$，$(\\rho_R, u_R, p_R)=(2.0, 10^{-6}, 1.0)$，$\\delta=10^{-3}$。我们计算 $\\|\\hat{F}_{\\text{acoustic}} - \\hat{F}_{\\text{none}}\\|_2$。\n- 两种通量之间的差异完全由其耗散项的差异引起：$ \\hat{F}_{\\text{acoustic}} - \\hat{F}_{\\text{none}} = \\frac{1}{2} \\sum_{i=1}^3 (\\alpha_i r_i (|\\lambda_i| - |\\lambda_i|_{\\text{acoustic-fixed}})) $\n- 在 `'acoustic-only'` 模式下，修正仅应用于 $\\lambda_1$ 和 $\\lambda_3$。\n- 对于这个近静止流，$\\tilde{u} = 10^{-6}$，Roe平均声速 $\\tilde{a} \\approx 0.995$。\n- 声学特征值为 $\\lambda_1 = \\tilde{u} - \\tilde{a} \\approx -0.995$ 和 $\\lambda_3 = \\tilde{u} + \\tilde{a} \\approx 0.995$。\n- 对应的绝对值为 $|\\lambda_1| \\approx 0.995$ 和 $|\\lambda_3| \\approx 0.995$。两者都远大于阈值 $\\delta = 10^{-3}$。\n- 根据 $\\phi$ 的定义，如果 $|\\lambda| \\ge \\delta$，则 $\\phi(|\\lambda|; \\delta) = |\\lambda|$。\n- 因此，对于两个声波，熵修正均不起作用。$|\\lambda_{1,3}|_{\\text{acoustic-fixed}} = |\\lambda_{1,3}|$。`'acoustic-only'` 和 `'none'` 模式的耗散项是相同的，因此通量之间的差值为零。结果是 `0.0`。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_roe_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma, delta, mode):\n    \"\"\"\n    Computes Roe's approximate Riemann solver flux for the 1D Euler equations.\n    \"\"\"\n    # Step 1: Convert primitive variables to conservative variables\n    E_L = p_L / (gamma - 1.0) + 0.5 * rho_L * u_L**2\n    U_L = np.array([rho_L, rho_L * u_L, E_L])\n    \n    E_R = p_R / (gamma - 1.0) + 0.5 * rho_R * u_R**2\n    U_R = np.array([rho_R, rho_R * u_R, E_R])\n\n    # Compute physical fluxes\n    F_L = np.array([rho_L * u_L, rho_L * u_L**2 + p_L, u_L * (E_L + p_L)])\n    F_R = np.array([rho_R * u_R, rho_R * u_R**2 + p_R, u_R * (E_R + p_R)])\n\n    # Step 2: Compute Roe-averaged quantities\n    sqrt_rho_L = np.sqrt(rho_L)\n    sqrt_rho_R = np.sqrt(rho_R)\n    \n    u_tilde = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / (sqrt_rho_L + sqrt_rho_R)\n    \n    H_L = (E_L + p_L) / rho_L\n    H_R = (E_R + p_R) / rho_R\n    H_tilde = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / (sqrt_rho_L + sqrt_rho_R)\n    \n    a_tilde_sq = (gamma - 1.0) * (H_tilde - 0.5 * u_tilde**2)\n    # Ensure non-negativity before sqrt due to potential floating point errors\n    a_tilde = np.sqrt(max(0.0, a_tilde_sq))\n\n    # Step 3: Compute wave strengths (alpha vector)\n    Delta_U = U_R - U_L\n    Delta_U1, Delta_U2, Delta_U3 = Delta_U\n    \n    if a_tilde == 0:\n        # This case is degenerate and not expected for the given problems.\n        # A robust implementation would handle this, e.g., by falling\n        # back to a more diffusive flux like Lax-Friedrichs.\n        # For this problem set, an exception is sufficient.\n        raise ValueError(\"Roe-averaged sound speed is zero.\")\n\n    alpha_2 = (gamma - 1.0) / a_tilde**2 * (Delta_U1 * (H_tilde - u_tilde**2) + Delta_U2 * u_tilde - Delta_U3)\n    alpha_1 = 0.5 * ((Delta_U1 - alpha_2) - (Delta_U2 - u_tilde * Delta_U1) / a_tilde)\n    alpha_3 = 0.5 * ((Delta_U1 - alpha_2) + (Delta_U2 - u_tilde * Delta_U1) / a_tilde)\n    alphas = np.array([alpha_1, alpha_2, alpha_3])\n\n    # Eigenvalues and right eigenvectors\n    lambdas = np.array([u_tilde - a_tilde, u_tilde, u_tilde + a_tilde])\n    \n    r1 = np.array([1.0, u_tilde - a_tilde, H_tilde - u_tilde * a_tilde])\n    r2 = np.array([1.0, u_tilde, 0.5 * u_tilde**2])\n    r3 = np.array([1.0, u_tilde + a_tilde, H_tilde + u_tilde * a_tilde])\n    R = np.array([r1, r2, r3]).T # Eigenvectors as columns\n\n    # Step 4: Apply Harten's entropy fix\n    def phi(lambda_abs, d):\n        return 0.5 * (lambda_abs**2 / d + d) if lambda_abs  d else lambda_abs\n\n    abs_lambdas_fixed = np.abs(lambdas)\n    \n    if mode == 'acoustic-only':\n        abs_lambdas_fixed[0] = phi(abs_lambdas_fixed[0], delta)\n        abs_lambdas_fixed[2] = phi(abs_lambdas_fixed[2], delta)\n    elif mode == 'all-eigenvalues':\n        for i in range(3):\n            abs_lambdas_fixed[i] = phi(abs_lambdas_fixed[i], delta)\n    # Mode 'none' requires no changes\n\n    # Step 5: Compute Roe flux\n    dissipation = 0.5 * np.dot(R, (abs_lambdas_fixed * alphas))\n    \n    F_hat = 0.5 * (F_L + F_R) - dissipation\n    return F_hat\n\ndef solve():\n    # Define the test cases from the problem statement.\n    gamma = 1.4\n    epsilon = 1e-12\n    \n    test_cases = [\n        # Case 1\n        {'rho_L': 1.0, 'u_L': 0.0, 'p_L': 1.0, 'rho_R': 2.0, 'u_R': 0.0, 'p_R': 1.0, 'delta': 1e-3, 'mode': 'acoustic-only'},\n        # Case 2\n        {'rho_L': 1.0, 'u_L': 0.0, 'p_L': 1.0, 'rho_R': 2.0, 'u_R': 0.0, 'p_R': 1.0, 'delta': 1e-3, 'mode': 'all-eigenvalues'},\n        # Case 3\n        {'rho_L': 1.0, 'u_L': 0.0, 'p_L': 1.0, 'rho_R': 2.0, 'u_R': 0.0, 'p_R': 1.0, 'delta': 1e-12, 'mode': 'all-eigenvalues'},\n        # Case 4\n        {'rho_L': 1.0, 'u_L': 1e-6, 'p_L': 1.0, 'rho_R': 2.0, 'u_R': 1e-6, 'p_R': 1.0, 'delta': 1e-3}\n    ]\n\n    results = []\n\n    # Cases 1, 2, 3: Preservation of stationary contact\n    for i in range(3):\n        case = test_cases[i]\n        \n        roe_flux = compute_roe_flux(case['rho_L'], case['u_L'], case['p_L'],\n                                      case['rho_R'], case['u_R'], case['p_R'],\n                                      gamma, case['delta'], case['mode'])\n        \n        # For a stationary contact, the exact flux is F(U_L) = [0, p, 0]\n        exact_flux = np.array([0.0, case['p_L'], 0.0])\n        \n        error_norm = np.linalg.norm(roe_flux - exact_flux)\n        \n        results.append(error_norm = epsilon)\n\n    # Case 4: Difference between acoustic-only and no-fix fluxes\n    case4 = test_cases[3]\n    \n    flux_acoustic = compute_roe_flux(case4['rho_L'], case4['u_L'], case4['p_L'],\n                                     case4['rho_R'], case4['u_R'], case4['p_R'],\n                                     gamma, case4['delta'], 'acoustic-only')\n    \n    flux_none = compute_roe_flux(case4['rho_L'], case4['u_L'], case4['p_L'],\n                                 case4['rho_R'], case4['u_R'], case4['p_R'],\n                                 gamma, case4['delta'], 'none')\n\n    diff_norm = np.linalg.norm(flux_acoustic - flux_none)\n    results.append(diff_norm)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(str(r) for r in results)}]\")\n\nsolve()\n```", "id": "3359305"}, {"introduction": "除了熵误差，数值格式还必须足够稳健，以应对强稀疏波或近真空等极端条件，而不会产生负密度或负压力等非物理结果。最后一个练习处理了“保正性”这一关键问题，这是标准 Roe 求解器所缺乏的属性。您将设计并实现一种混合格式，该格式将 Roe 求解器与更稳健的 HLLE 求解器自适应地混合，确保您的代码在更广泛的挑战性问题中保持稳定和物理意义。[@problem_id:3359360]", "problem": "考虑理想气体的一维可压缩欧拉方程，其守恒变量形式如下，其中比热比 $\\gamma \\in \\mathbb{R}$，$\\gamma  1$：\n$$\n\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F}(\\mathbf{U}) = \\mathbf{0}, \\quad \\mathbf{U} = \\begin{bmatrix} \\rho \\\\ m \\\\ E \\end{bmatrix}, \\quad \\mathbf{F}(\\mathbf{U}) = \\begin{bmatrix} m \\\\ \\dfrac{m^2}{\\rho} + p \\\\ (E+p)u \\end{bmatrix},\n$$\n其中原始变量为密度 $\\rho  0$、速度 $u = m/\\rho$、压力 $p$ 和总能量 $E$，它们通过理想气体状态方程关联：\n$$\np = (\\gamma - 1)\\left( E - \\tfrac{1}{2}\\rho u^2 \\right).\n$$\n定义不变区域 $\\mathcal{G} = \\{ \\mathbf{U}: \\rho  0,\\ p  0 \\}$。\n\n设左右状态 $(\\mathbf{U}_L, \\mathbf{U}_R)$ 处的 Roe 线性化由标准的 Roe 平均速度 $\\tilde{u}$、总焓 $\\tilde{H}$ 和声速 $\\tilde{a}$ 定义：\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L}\\,u_L + \\sqrt{\\rho_R}\\,u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}},\\quad\n\\tilde{H} = \\frac{\\sqrt{\\rho_L}\\,H_L + \\sqrt{\\rho_R}\\,H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}},\\quad\n\\tilde{a}^2 = (\\gamma - 1)\\left(\\tilde{H} - \\tfrac{1}{2}\\tilde{u}^2\\right),\n$$\n其中 $H = (E + p)/\\rho$ 且 $u = m/\\rho$。Roe 通量 $\\mathbf{F}^{\\mathrm{Roe}}(\\mathbf{U}_L,\\mathbf{U}_R)$ 是利用 Roe 矩阵的特征分解计算出的近似黎曼通量，其特征值为 $\\tilde{u}-\\tilde{a}$、$\\tilde{u}$、$\\tilde{u}+\\tilde{a}$ 和相应的右特征向量。Harten–Lax–van Leer–Einfeldt (HLLE) 通量 $\\mathbf{F}^{\\mathrm{HLLE}}(\\mathbf{U}_L,\\mathbf{U}_R)$ 由单侧信号速度 $S_L \\le 0 \\le S_R$ 定义，这些速度由最快的左行和右行特征的一致下界和上界构造而来，例如：\n$$\nS_L = \\min\\{u_L - c_L,\\ \\tilde{u} - \\tilde{a},\\ u_R - c_R\\},\\quad\nS_R = \\max\\{u_L + c_L,\\ \\tilde{u} + \\tilde{a},\\ u_R + c_R\\},\n$$\n其中 $c = \\sqrt{\\gamma p/\\rho}$ 是物理声速，并且\n$$\n\\mathbf{F}^{\\mathrm{HLLE}}(\\mathbf{U}_L,\\mathbf{U}_R) = \n\\begin{cases}\n\\mathbf{F}(\\mathbf{U}_L),  S_L \\ge 0,\\\\\n\\mathbf{F}(\\mathbf{U}_R),  S_R \\le 0,\\\\\n\\dfrac{S_R \\mathbf{F}(\\mathbf{U}_L) - S_L \\mathbf{F}(\\mathbf{U}_R) + S_L S_R (\\mathbf{U}_R - \\mathbf{U}_L)}{S_R - S_L},  \\text{otherwise}.\n\\end{cases}\n$$\n\n在 $\\Delta x  0$ 的均匀网格上，一阶有限体积更新由下式给出：\n$$\n\\mathbf{U}_i^{n+1} = \\mathbf{U}_i^{n} - \\lambda \\left( \\hat{\\mathbf{F}}_{i+\\tfrac{1}{2}} - \\hat{\\mathbf{F}}_{i-\\tfrac{1}{2}} \\right), \\quad \\lambda = \\frac{\\Delta t}{\\Delta x},\n$$\n其中 $\\hat{\\mathbf{F}}_{i\\pm \\tfrac{1}{2}}$ 是一致性数值通量，$\\Delta t  0$ 是时间步长，通过 Courant–Friedrichs–Lewy (CFL) 数 $\\nu \\in (0,1)$ 选择，如下所示：\n$$\n\\Delta t = \\nu \\frac{\\Delta x}{\\max_i\\left(|u_i| + c_i\\right)}.\n$$\n\n任务：\n1. 构造显式的左右初始状态 $(\\mathbf{U}_L,\\mathbf{U}_R) \\in \\mathcal{G} \\times \\mathcal{G}$，使得在第一波段和第三波段之间的中心扇区中的 Roe 线性化中间状态满足 $\\rho^\\star \\le 0$ 或 $p^\\star \\le 0$。为使此检查无需时间推进即可在算法上验证，将 Roe 星状态定义为\n$$\n\\mathbf{U}^\\star = \\mathbf{U}_L + \\alpha_1 \\mathbf{r}_1 + \\alpha_2 \\mathbf{r}_2,\n$$\n其中 $\\{\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3\\}$ 是在 $(\\tilde{u},\\tilde{H},\\tilde{a})$ 处的 Roe 右特征向量，波强度系数 $\\alpha_k$ 由以下线性系统定义\n$$\n[\\mathbf{r}_1\\ \\mathbf{r}_2\\ \\mathbf{r}_3]\\begin{bmatrix}\\alpha_1\\\\ \\alpha_2\\\\ \\alpha_3\\end{bmatrix} = \\mathbf{U}_R - \\mathbf{U}_L.\n$$\n如果 $\\mathbf{U}^\\star$ 的任一分量导致 $\\rho^\\star \\le 0$ 或 $p^\\star \\le 0$，则声明 Roe 求解器对于给定的 $(\\mathbf{U}_L,\\mathbf{U}_R)$ 是不可纳的。\n\n2. 设计一种保正通量修正方法，通过在每个界面处将 Roe 通量与 HLLE 通量混合，\n$$\n\\hat{\\mathbf{F}}_{\\theta}(\\mathbf{U}_L,\\mathbf{U}_R) = \\mathbf{F}^{\\mathrm{HLLE}}(\\mathbf{U}_L,\\mathbf{U}_R) + \\theta \\left( \\mathbf{F}^{\\mathrm{Roe}}(\\mathbf{U}_L,\\mathbf{U}_R) - \\mathbf{F}^{\\mathrm{HLLE}}(\\mathbf{U}_L,\\mathbf{U}_R) \\right), \\quad \\theta \\in [0,1],\n$$\n其中逐界面的参数 $\\theta$ 自适应地选择，以确保在含三个单元的周期性网格上进行一步向前欧拉步后，所有更新后的单元状态都位于 $\\mathcal{G}$ 内。$\\theta$ 的选择必须仅能从每个界面的局部邻居信息计算得出，且绝不能超过 $\\theta = 1$。实现一个关于 $\\theta$ 的构造性选择规则，当 CFL 数满足形如 $\\nu \\le \\nu_0$（其中 $\\nu_0 \\in (0,1)$ 是一个您必须明确指定的常数）的界时，该规则总能保证共享界面的两个单元满足 $\\rho_i^{n+1}  0$ 和 $p_i^{n+1}  0$。\n\n3. 证明一个不变区域性质：证明仅对于 HLLE 通量（即 $\\theta=0$），在 CFL 界 $\\nu \\le \\nu_0$ 下，映射 $\\mathbf{U}^n \\mapsto \\mathbf{U}^{n+1}$ 保持 $\\mathcal{G}$ 不变，并且按任务2构造的、使用 $\\theta \\in [0,1]$ 的混合方法也同样保持 $\\mathcal{G}$ 不变。\n\n实现要求：\n- 使用理想气体方程，其中 $\\gamma = 1.4$。\n- 使用一个含三个单元的周期性网格，其中 $\\Delta x = 1$，并执行单步向前欧拉更新。\n- 对于保正混合通量，使用 $\\nu = 0.45$。\n- 对于任务1中的 Roe 不可纳性检查，不要进行时间推进；仅检查如上定义的 Roe 星状态 $\\mathbf{U}^\\star$。\n- 将状态视为无量纲；无需物理单位。\n\n测试套件：\n- 使用以下左右原始状态对 $(\\rho_L,u_L,p_L;\\ \\rho_R,u_R,p_R)$，并且对于混合通量更新，将三个周期性单元初始化为 $[\\text{左状态},\\ \\text{右状态},\\ \\text{左状态}]$：\n  - 情况 A (极端对称稀疏波): $(1.0,-100.0,10^{-6};\\ 1.0,100.0,10^{-6})$。\n  - 情况 B (具有密度反差的强非对称稀疏波): $(10.0,-60.0,10^{-4};\\ 0.1,60.0,10^{-6})$。\n  - 情况 C (中等激波管类问题): $(1.0,0.0,1.0;\\ 0.125,0.0,0.1)$。\n  - 情况 D (近真空且速度相反): $(10^{-3},-20.0,10^{-12};\\ 10^{-3},20.0,10^{-12})$。\n\n必需输出：\n- 对于每种情况，输出两个布尔值：\n  - 第一个布尔值为真，如果 Roe 星状态是不可纳的，即 $\\rho^\\star \\le 0$ 或 $p^\\star \\le 0$。\n  - 第二个布尔值为真，如果使用 $\\nu = 0.45$ 的混合通量在三个周期性单元上进行一步更新后，所有更新后的单元状态都满足 $\\rho  0$ 和 $p  0$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序如下\n$$\n[\\text{roe\\_bad\\_A},\\ \\text{pos\\_ok\\_A},\\ \\text{roe\\_bad\\_B},\\ \\text{pos\\_ok\\_B},\\ \\text{roe\\_bad\\_C},\\ \\text{pos\\_ok\\_C},\\ \\text{roe\\_bad\\_D},\\ \\text{pos\\_ok\\_D}],\n$$\n其中每个符号都是实现语言中的布尔字面量。", "solution": "该问题是有效的，因为它科学地基于计算流体力学中广为人知的原理，特别是关于欧拉方程的数值解法。它提出了一组清晰、客观且适定的任务：分析 Roe 近似黎曼求解器的一种已知失效模式，并通过将其与鲁棒的 HLLE 通量混合来实现一种标准的保正修正。参数、初始条件和必需的输出都已明确定义，使得该问题自洽且可验证。\n\n### 理论基础\n\n对于可压缩理想气体，一维欧拉方程是一个双曲守恒律系统：\n$$\n\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F}(\\mathbf{U}) = \\mathbf{0}\n$$\n其中 $\\mathbf{U} = [\\rho, m, E]^T$ 是守恒变量（密度、动量、总能量）的向量，$\\mathbf{F}(\\mathbf{U})$ 是通量向量。该系统必须通过状态方程封闭，对于理想气体，状态方程将压力 $p$ 与守恒量关联起来：\n$$\np = (\\gamma - 1)\\left( E - \\tfrac{1}{2}\\rho u^2 \\right) = (\\gamma - 1)\\left( E - \\tfrac{1}{2}\\frac{m^2}{\\rho} \\right)\n$$\n一个物理上有意义的解必须位于不变区域 $\\mathcal{G} = \\{ \\mathbf{U}: \\rho  0, p  0 \\}$ 内。\n\n一阶有限体积法通过以下方式更新单元平均状态 $\\mathbf{U}_i$：\n$$\n\\mathbf{U}_i^{n+1} = \\mathbf{U}_i^{n} - \\frac{\\Delta t}{\\Delta x} \\left( \\hat{\\mathbf{F}}_{i+\\tfrac{1}{2}} - \\hat{\\mathbf{F}}_{i-\\tfrac{1}{2}} \\right)\n$$\n其中 $\\hat{\\mathbf{F}}_{i\\pm\\tfrac{1}{2}}$ 是与 $\\mathbf{F}(\\mathbf{U})$ 一致的数值通量函数。数值通量的选择对解的稳定性、准确性和物理可纳性至关重要。\n\n#### 任务1：Roe 求解器的不可纳性\n\nRoe 的近似黎曼求解器通过寻找一个矩阵 $\\tilde{\\mathbf{A}}(\\mathbf{U}_i, \\mathbf{U}_{i+1})$（Roe 矩阵）来在每个单元界面 $(i+\\tfrac{1}{2})$ 处将问题线性化，该矩阵满足 $\\mathbf{F}(\\mathbf{U}_{i+1}) - \\mathbf{F}(\\mathbf{U}_i) = \\tilde{\\mathbf{A}}(\\mathbf{U}_{i+1} - \\mathbf{U}_i)$。矩阵 $\\tilde{\\mathbf{A}}$ 是使用 Roe 平均状态构造的。虽然计算效率高，但这种线性化可能无法遵循欧拉方程的非线性约束，特别是在涉及强稀疏波或近真空状态的问题中。这可能导致生成具有非物理负密度或负压力的状态。\n\n问题为此失效模式定义了一个特定的检查方法。给定左右状态 $(\\mathbf{U}_L, \\mathbf{U}_R)$：\n1.  计算 Roe 平均量 $(\\tilde{u}, \\tilde{H}, \\tilde{a})$。\n2.  跳跃量 $\\Delta\\mathbf{U} = \\mathbf{U}_R - \\mathbf{U}_L$ 在 Roe 矩阵的右特征向量基 $\\{\\mathbf{r}_1, \\mathbf{r}_2, \\mathbf{r}_3\\}$ 中分解：$\\Delta\\mathbf{U} = \\sum_{k=1}^3 \\alpha_k \\mathbf{r}_k$。\n3.  系数 $\\alpha_k$ 通过求解此线性系统找到。我们使用标准特征向量：\n    $$\n    \\mathbf{r}_1 = \\begin{bmatrix} 1 \\\\ \\tilde{u}-\\tilde{a} \\\\ \\tilde{H}-\\tilde{u}\\tilde{a} \\end{bmatrix}, \\quad\n    \\mathbf{r}_2 = \\begin{bmatrix} 1 \\\\ \\tilde{u} \\\\ \\frac{1}{2}\\tilde{u}^2 \\end{bmatrix}, \\quad\n    \\mathbf{r}_3 = \\begin{bmatrix} 1 \\\\ \\tilde{u}+\\tilde{a} \\\\ \\tilde{H}+\\tilde{u}\\tilde{a} \\end{bmatrix}\n    $$\n    第二个特征向量 $\\mathbf{r}_2$ 对应于在恒定压力和速度下的熵跳跃。\n4.  一个中间“星”状态被定义为 $\\mathbf{U}^\\star = \\mathbf{U}_L + \\alpha_1 \\mathbf{r}_1 + \\alpha_2 \\mathbf{r}_2$。通过将其转换为原始变量 $(\\rho^\\star, u^\\star, p^\\star)$ 并验证是否 $\\rho^\\star  0$ 和 $p^\\star  0$ 来检查该状态的物理可纳性。如果不是，则认为该求解器对于这对状态是不可纳的。\n\n#### 任务3：HLLE 通量的不变区域性质\n\n众所周知，HLLE 通量在适当的 CFL 条件下是鲁棒保正的。可以证明该更新格式是前一时间步状态的凸组合，从而保持凸集 $\\mathcal{G}$ 不变。\n可以证明，只要时间步长 $\\Delta t$ 满足类 CFL 条件，HLLE 有限体积格式就能保持 $\\rho$ 和 $p$ 的正性：\n$$\n\\frac{\\Delta t}{\\Delta x} \\max_{j} \\left( S_{R, j+\\tfrac{1}{2}} - S_{L, j+\\tfrac{1}{2}} \\right) \\le 1\n$$\n其中最大值取自所有单元界面 $j+\\tfrac{1}{2}$。信号速度 $S_L$ 和 $S_R$ 定义为：\n$$\nS_L = \\min\\{u_L - c_L,\\ \\tilde{u} - \\tilde{a},\\ u_R - c_R\\}, \\quad S_R = \\max\\{u_L + c_L,\\ \\tilde{u} + \\tilde{a},\\ u_R + c_R\\}\n$$\n令 $S_{\\text{max}} = \\max_i(|u_i| + c_i)$。时间步长为 $\\Delta t = \\nu \\frac{\\Delta x}{S_{\\text{max}}}$。\n根据 $S_L$ 和 $S_R$ 的定义，我们有界 $S_R \\le S_{\\text{max}}$ 和 $S_L \\ge -S_{\\text{max}}$。因此，$S_R - S_L \\le 2S_{\\text{max}}$。将此代入 CFL 条件：\n$$\n\\frac{1}{S_{\\text{max}}} \\nu \\cdot (2 S_{\\text{max}}) \\le 1 \\implies 2\\nu \\le 1 \\implies \\nu \\le 0.5\n$$\n因此，对于 $\\nu \\le \\nu_0 = 0.5$，HLLE 格式保证保持不变区域 $\\mathcal{G}$。\n\n#### 任务2：保正混合通量\n\n为了结合 Roe 求解器的准确性和 HLLE 的鲁棒性，我们使用混合通量：\n$$\n\\hat{\\mathbf{F}}_{\\theta} = (1-\\theta)\\mathbf{F}^{\\mathrm{HLLE}} + \\theta \\mathbf{F}^{\\mathrm{Roe}}\n$$\n其中 $\\theta \\in [0,1]$ 是一个自适应参数。为确保正性，必须在每个界面处仔细选择 $\\theta$。这里采用了一种构造性方法，该方法遵循保正限制器的框架（例如，Zhang  Shu, JCP 2010）。\n\n在每个界面 $j=i+\\tfrac{1}{2}$（位于单元 $i$ 和 $i+1$ 之间），我们确定一个单一参数 $\\theta_j$，它能确保两个相邻单元更新的正性。这通过考虑两个“测试状态”来实现，这两个状态分离了界面 $j$ 处通量的贡献：\n$$\n\\mathbf{P}_{i} (\\theta_j) = \\mathbf{U}_i^n - 2\\lambda \\left( \\hat{\\mathbf{F}}_{\\theta_j}(\\mathbf{U}_i^n, \\mathbf{U}_{i+1}^n) - \\mathbf{F}(\\mathbf{U}_i^n) \\right)\n$$\n$$\n\\mathbf{P}_{i+1}(\\theta_j) = \\mathbf{U}_{i+1}^n + 2\\lambda \\left( \\hat{\\mathbf{F}}_{\\theta_j}(\\mathbf{U}_i^n, \\mathbf{U}_{i+1}^n) - \\mathbf{F}(\\mathbf{U}_{i+1}^n) \\right)\n$$\n其中 $\\lambda = \\Delta t/\\Delta x$。为了使整个格式在 CFL 条件 $\\nu \\le \\nu_0/2 = 0.25$ 下保正，只需确保 $\\mathbf{P}_i, \\mathbf{P}_{i+1} \\in \\mathcal{G}$ 即可。尽管本问题使用 $\\nu=0.45$，但这种限制过程是一种鲁棒的启发式方法，通常在其严格的理论界之外也能奏效。\n\n令 $\\mathbf{F}^{\\mathrm{R-H}} = \\mathbf{F}^{\\mathrm{Roe}} - \\mathbf{F}^{\\mathrm{HLLE}}$。单元 $i$ 的测试状态可写为：\n$$\n\\mathbf{P}_{i}(\\theta_j) = \\left( \\mathbf{U}_i^n - 2\\lambda(\\mathbf{F}^{\\mathrm{HLLE}} - \\mathbf{F}_i^n) \\right) - 2\\lambda\\theta_j \\mathbf{F}^{\\mathrm{R-H}}\n$$\n令 $\\mathbf{U}_{\\mathrm{base}} = \\mathbf{U}_i^n - 2\\lambda(\\mathbf{F}^{\\mathrm{HLLE}} - \\mathbf{F}_i^n)$，在更严格的 CFL 条件下，它保证位于 $\\mathcal{G}$ 内。令 $\\delta\\mathbf{U} = -2\\lambda \\mathbf{F}^{\\mathrm{R-H}}$。我们需要找到最大的 $\\theta \\in [0,1]$ 使得 $\\mathbf{U}(\\theta) = \\mathbf{U}_{\\mathrm{base}} + \\theta \\delta\\mathbf{U}$ 位于 $\\mathcal{G}$ 内。这涉及两个条件：\n1.  **密度正性**：$\\rho(\\theta) = \\rho_{\\mathrm{base}} + \\theta \\delta\\rho  0$。这是关于 $\\theta$ 的一个线性不等式。\n2.  **压力正性**：$p(\\theta) = (\\gamma-1)(E(\\theta) - \\frac{m(\\theta)^2}{2\\rho(\\theta)})  0$。这可转化为一个二次不等式 $A\\theta^2 + B\\theta + C  0$，其中 $C  0$。\n\n通过求解 $\\mathbf{P}_i$ 和 $\\mathbf{P}_{i+1}$ 的这些不等式，我们得到两个上界 $\\theta_{i, \\max}$ 和 $\\theta_{i+1, \\max}$。界面 $j$ 的最终混合因子是 $\\theta_j = \\min(\\theta_{i, \\max}, \\theta_{i+1, \\max}, 1.0)$。这种构造确保了混合通量恰好在保持物理可纳性的前提下，向鲁棒的 HLLE 通量回归。\n\n然后使用这些局部确定的混合通量执行完整的有限体积更新。此过程保持了不变区域 $\\mathcal{G}$，正如任务3对混合格式所要求的那样。\n\n### 数值实现\n\n为解决此问题，我们实现以下组件：\n1.  用于在原始 $(\\rho, u, p)$ 和守恒 $(\\rho, m, E)$ 变量之间转换的函数。\n2.  用于计算物理通量 $\\mathbf{F}(\\mathbf{U})$、声速 $c$ 和总焓 $H$ 的函数。\n3.  用于 Roe 不可纳性检查的函数（任务1）。\n4.  用于计算 Roe 通量和 HLLE 通量的函数。\n5.  通过求解两个相邻单元的线性和二次不等式来计算界面处保正混合因子 $\\theta$ 的函数。\n6.  一个主程序，它建立三单元周期性问题，计算时间步长，确定每个界面的 $\\theta$，执行有限体积更新，并检查最终状态的正性。\n\n最终代码将对所提供的四个测试用例分别执行此逻辑，并按要求格式化布尔结果。", "answer": "```python\nimport numpy as np\n\n# Global constants\nGAMMA = 1.4\nGAMMA_MINUS_1 = GAMMA - 1.0\n\n# --- Primitive and Conservative Variable Conversions ---\ndef prim_to_cons(rho, u, p):\n    \"\"\"Converts primitive variables to conservative variables.\"\"\"\n    m = rho * u\n    E = p / GAMMA_MINUS_1 + 0.5 * rho * u**2\n    return np.array([rho, m, E])\n\ndef cons_to_prim(U):\n    \"\"\"Converts conservative variables to primitive variables.\"\"\"\n    rho, m, E = U\n    if rho = 0:\n        return np.array([rho, 0.0, -1.0]) # Invalid state\n    u = m / rho\n    p = GAMMA_MINUS_1 * (E - 0.5 * m * u)\n    if p = 0:\n        return np.array([rho, u, p]) # Invalid state\n    return np.array([rho, u, p])\n\n# --- Physics Calculations ---\ndef get_flux(U):\n    \"\"\"Computes the Euler flux vector F(U).\"\"\"\n    rho, m, E = U\n    if rho = 0: # Handle non-physical state\n        return np.zeros(3)\n    u = m / rho\n    p = GAMMA_MINUS_1 * (E - 0.5 * m * u)\n    if p  0: p = 0 # Pressure cannot be negative in flux calculation\n    \n    F = np.zeros(3)\n    F[0] = m\n    F[1] = m * u + p\n    F[2] = (E + p) * u\n    return F\n\ndef get_h_and_c(rho, u, p):\n    \"\"\"Computes total enthalpy H and sound speed c.\"\"\"\n    if rho = 0 or p = 0:\n        return 0, 0\n    E = p / GAMMA_MINUS_1 + 0.5 * rho * u**2\n    H = (E + p) / rho\n    c = np.sqrt(GAMMA * p / rho)\n    return H, c\n    \n# --- Task 1: Roe Non-Admissibility Check ---\ndef check_roe_admissibility(prim_L, prim_R):\n    \"\"\"Checks if the Roe intermediate state is non-physical.\"\"\"\n    rho_L, u_L, p_L = prim_L\n    rho_R, u_R, p_R = prim_R\n    \n    U_L = prim_to_cons(rho_L, u_L, p_L)\n    U_R = prim_to_cons(rho_R, u_R, p_R)\n\n    # Roe averages\n    sqrt_rho_L, sqrt_rho_R = np.sqrt(rho_L), np.sqrt(rho_R)\n    tilde_u = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / (sqrt_rho_L + sqrt_rho_R)\n    \n    H_L, _ = get_h_and_c(rho_L, u_L, p_L)\n    H_R, _ = get_h_and_c(rho_R, u_R, p_R)\n    tilde_H = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / (sqrt_rho_L + sqrt_rho_R)\n\n    a_sq = GAMMA_MINUS_1 * (tilde_H - 0.5 * tilde_u**2)\n    if a_sq  0:\n        return True # Roe average leads to imaginary sound speed\n\n    tilde_a = np.sqrt(a_sq)\n\n    # Eigenvectors\n    r1 = np.array([1.0, tilde_u - tilde_a, tilde_H - tilde_u * tilde_a])\n    r2 = np.array([1.0, tilde_u, 0.5 * tilde_u**2])\n    r3 = np.array([1.0, tilde_u + tilde_a, tilde_H + tilde_u * tilde_a])\n    R_matrix = np.vstack([r1, r2, r3]).T\n\n    # Solve for wave strengths\n    delta_U = U_R - U_L\n    try:\n        alphas = np.linalg.solve(R_matrix, delta_U)\n    except np.linalg.LinAlgError:\n        return True # Singular matrix, pathological case\n    alpha1, alpha2, _ = alphas\n    \n    # Compute star state as defined in the problem\n    U_star = U_L + alpha1 * r1 + alpha2 * r2\n    \n    # Check positivity\n    _, _, p_star = cons_to_prim(U_star)\n    return U_star[0] = 0 or p_star = 0\n\n# --- Task 2: Positivity-Preserving Blended Flux ---\n\ndef get_roe_flux(U_L, U_R):\n    rho_L, u_L, p_L = cons_to_prim(U_L)\n    rho_R, u_R, p_R = cons_to_prim(U_R)\n    \n    if rho_L = 0 or p_L =0 or rho_R = 0 or p_R = 0:\n        # Fallback for non-physical states, e.g. return average flux\n        return 0.5 * (get_flux(U_L) + get_flux(U_R))\n\n    sqrt_rho_L, sqrt_rho_R = np.sqrt(rho_L), np.sqrt(rho_R)\n    tilde_u = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / (sqrt_rho_L + sqrt_rho_R)\n\n    H_L, _ = get_h_and_c(rho_L, u_L, p_L)\n    H_R, _ = get_h_and_c(rho_R, u_R, p_R)\n    tilde_H = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / (sqrt_rho_L + sqrt_rho_R)\n\n    a_sq = GAMMA_MINUS_1 * (tilde_H - 0.5 * tilde_u**2)\n    if a_sq  0: a_sq = 0 # Einfeldt fix\n    tilde_a = np.sqrt(a_sq)\n\n    r1 = np.array([1.0, tilde_u - tilde_a, tilde_H - tilde_u * tilde_a])\n    r2 = np.array([1.0, tilde_u, 0.5 * tilde_u**2])\n    r3 = np.array([1.0, tilde_u + tilde_a, tilde_H + tilde_u * tilde_a])\n    R_matrix = np.vstack([r1, r2, r3]).T\n\n    delta_U = U_R - U_L\n    try:\n        alphas = np.linalg.solve(R_matrix, delta_U)\n    except np.linalg.LinAlgError: # Fallback\n        return 0.5 * (get_flux(U_L) + get_flux(U_R))\n\n    lambda_tilde = np.array([tilde_u - tilde_a, tilde_u, tilde_u + tilde_a])\n    \n    F_L, F_R = get_flux(U_L), get_flux(U_R)\n    dissipation = R_matrix @ (np.diag(np.abs(lambda_tilde)) @ alphas)\n    \n    return 0.5 * (F_L + F_R) - 0.5 * dissipation\n\ndef get_hlle_flux(U_L, U_R):\n    rho_L, u_L, p_L = cons_to_prim(U_L)\n    rho_R, u_R, p_R = cons_to_prim(U_R)\n    \n    if rho_L = 0 or p_L =0: return get_flux(U_R)\n    if rho_R = 0 or p_R =0: return get_flux(U_L)\n    \n    H_L, c_L = get_h_and_c(rho_L, u_L, p_L)\n    H_R, c_R = get_h_and_c(rho_R, u_R, p_R)\n    \n    sqrt_rho_L, sqrt_rho_R = np.sqrt(rho_L), np.sqrt(rho_R)\n    tilde_u = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / (sqrt_rho_L + sqrt_rho_R)\n    tilde_H = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / (sqrt_rho_L + sqrt_rho_R)\n    a_sq = GAMMA_MINUS_1 * (tilde_H - 0.5 * tilde_u**2)\n    if a_sq  0: a_sq = 0\n    tilde_a = np.sqrt(a_sq)\n    \n    S_L = min(u_L - c_L, tilde_u - tilde_a, u_R - c_R)\n    S_R = max(u_L + c_L, tilde_u + tilde_a, u_R + c_R)\n\n    F_L, F_R = get_flux(U_L), get_flux(U_R)\n\n    if S_L >= 0: return F_L\n    if S_R = 0: return F_R\n    \n    return (S_R * F_L - S_L * F_R + S_L * S_R * (U_R - U_L)) / (S_R - S_L)\n\ndef get_positivity_theta(U, factor, U_base, dU):\n    \"\"\"Calculates max theta in [0,1] for one test state.\"\"\"\n    rho_base, m_base, E_base = U_base\n    drho, dm, dE = dU\n    \n    theta_rho = 1.0\n    if drho  -1e-15: # Avoid division by zero\n        theta_rho = -rho_base / drho\n        if theta_rho  0: theta_rho = 1.0 # Negative root is not a constraint\n    \n    # Quadratic for pressure: A*theta^2 + B*theta + C > 0\n    C = 2 * E_base * rho_base - m_base**2\n    if C  0: return 0.0 # Base state is already non-positive\n    \n    A = 2 * dE * drho - dm**2\n    B = 2 * (E_base * drho + rho_base * dE) - 2 * m_base * dm\n    \n    theta_p = 1.0\n    \n    if abs(A)  1e-15: # Linear case\n        if B  -1e-15:\n            root = -C / B\n            if root > 0:\n                theta_p = root\n    else: # Quadratic case\n        delta = B**2 - 4 * A * C\n        if delta >= 0:\n            sqrt_delta = np.sqrt(delta)\n            r1 = (-B + sqrt_delta) / (2 * A)\n            r2 = (-B - sqrt_delta) / (2 * A)\n            \n            # Find smallest positive root\n            pos_roots = []\n            if r1 > 1e-15: pos_roots.append(r1)\n            if r2 > 1e-15: pos_roots.append(r2)\n            \n            if len(pos_roots) > 0:\n                root = min(pos_roots)\n                if A > 0: # Parabola opens up, positive outside roots\n                    if min(r1, r2) > 0:\n                        theta_p = min(r1, r2)\n                else: # Parabola opens down, positive between roots\n                    theta_p = root\n\n    return min(theta_rho, theta_p, 1.0) * 0.9999 # Safety factor\n\ndef run_blended_flux_update(prim_L, prim_R):\n    \"\"\"Runs one step on 3 periodic cells and checks positivity.\"\"\"\n    # Setup\n    dx = 1.0\n    cfl = 0.45\n    \n    U_states_n = [\n        prim_to_cons(*prim_L),\n        prim_to_cons(*prim_R),\n        prim_to_cons(*prim_L)\n    ]\n    \n    # Calculate dt\n    max_wave_speed = 0.0\n    for U in U_states_n:\n        rho, u, p = cons_to_prim(U)\n        _, c = get_h_and_c(rho, u, p)\n        max_wave_speed = max(max_wave_speed, abs(u) + c)\n    if max_wave_speed == 0: return False # Cannot proceed\n    dt = cfl * dx / max_wave_speed\n    lam = dt / dx\n\n    # Interfaces states: L_cell, R_cell\n    interfaces = [(U_states_n[2], U_states_n[0]), (U_states_n[0], U_states_n[1]), (U_states_n[1], U_states_n[2])]\n\n    # Compute blending factors\n    thetas = []\n    for U_L, U_R in interfaces:\n        F_roe = get_roe_flux(U_L, U_R)\n        F_hlle = get_hlle_flux(U_L, U_R)\n        F_R_minus_H = F_roe - F_hlle\n        \n        # Theta for Left Cell\n        U_base_L = U_L - 2 * lam * (F_hlle - get_flux(U_L))\n        dU_L = -2 * lam * F_R_minus_H\n        theta_L = get_positivity_theta(U_L, -2*lam, U_base_L, dU_L)\n\n        # Theta for Right Cell\n        U_base_R = U_R + 2 * lam * (F_hlle - get_flux(U_R))\n        dU_R = 2 * lam * F_R_minus_H\n        theta_R = get_positivity_theta(U_R, 2*lam, U_base_R, dU_R)\n\n        thetas.append(min(theta_L, theta_R))\n\n    # Compute blended fluxes\n    fluxes = []\n    for i, (U_L, U_R) in enumerate(interfaces):\n        F_roe = get_roe_flux(U_L, U_R)\n        F_hlle = get_hlle_flux(U_L, U_R)\n        fluxes.append(F_hlle + thetas[i] * (F_roe - F_hlle))\n\n    # Update states\n    U_states_n_plus_1 = [\n        U_states_n[0] - lam * (fluxes[1] - fluxes[0]),\n        U_states_n[1] - lam * (fluxes[2] - fluxes[1]),\n        U_states_n[2] - lam * (fluxes[0] - fluxes[2]),\n    ]\n    \n    # Check positivity of all updated states\n    all_positive = True\n    for U in U_states_n_plus_1:\n        rho, _, p = cons_to_prim(U)\n        if rho = 0 or p = 0:\n            all_positive = False\n            break\n            \n    return all_positive\n    \ndef solve():\n    \"\"\"Main solver function to run test cases.\"\"\"\n    # (rho_L, u_L, p_L; rho_R, u_R, p_R)\n    test_cases = [\n        ((1.0, -100.0, 1e-6), (1.0, 100.0, 1e-6)),         # Case A\n        ((10.0, -60.0, 1e-4), (0.1, 60.0, 1e-6)),          # Case B\n        ((1.0, 0.0, 1.0), (0.125, 0.0, 0.1)),              # Case C\n        ((1e-3, -20.0, 1e-12), (1e-3, 20.0, 1e-12)),       # Case D\n    ]\n    \n    results = []\n    for case in test_cases:\n        prim_L, prim_R = case\n        \n        # Task 1: Check Roe admissibility\n        roe_bad = check_roe_admissibility(prim_L, prim_R)\n        results.append(str(roe_bad).lower())\n        \n        # Task 2: Run blended flux update and check positivity\n        pos_ok = run_blended_flux_update(prim_L, prim_R)\n        results.append(str(pos_ok).lower())\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3359360"}]}