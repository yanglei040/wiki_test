{"hands_on_practices": [{"introduction": "要构建一个近似黎曼求解器，我们首先必须理解其所对应的双曲系统的基本波动结构。本练习将指导您直接从欧拉方程中推导出声波速度和黎曼不变量，它们构成了捕捉可压缩流中波传播的理论基石。掌握这种分析是建立和理解任何高级数值格式的第一步 [@problem_id:3291767]。", "problem": "考虑一维、无粘、可压缩的热力学和量热学完美理想气体的流动，该流动由以原始变量$(\\rho,u,p)$表示的欧拉方程控制，其中$\\rho$是密度，$u$是速度，$p$是压力。在计算流体力学(CFD)中使用的近似黎曼求解器（如HLLC (Harten–Lax–van Leer with Contact)求解器）的背景下，欧拉方程的通量雅可比矩阵的特征结构决定了波速以及沿这些波传播的特征变量。\n\n从欧拉方程和理想气体的基本热力学关系出发，推导等熵族的声波速度和相关的特征变量（黎曼不变量）。然后，对于数值状态\n$$\n\\rho = 1.2\\ \\text{kg m}^{-3},\\quad u = 120\\ \\text{m s}^{-1},\\quad p = 101325\\ \\text{Pa},\\quad \\gamma = 1.4,\n$$\n计算声速并验证严格双曲性排序$u-c  u  u+c$。使用推导出的对应于左行和右行声波族的特征变量，计算量\n$$\nJ \\equiv w_{+} - w_{-},\n$$\n其中，对于理想气体，$w_{+}$和$w_{-}$分别是与右行和左行声波相关的黎曼不变量。\n\n用$\\text{m s}^{-1}$表示$J$的最终数值，并将您的答案四舍五入到四位有效数字。", "solution": "该问题要求推导一维欧拉方程的声波速度和黎曼不变量，然后对给定状态进行数值计算。\n\n对于无粘可压缩流，以原始变量$\\mathbf{W} = (\\rho, u, p)^T$表示的一维欧拉方程为：\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} = 0 \\quad (\\text{连续性})\n$$\n$$\n\\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} + \\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} = 0 \\quad (\\text{动量})\n$$\n$$\n\\frac{\\partial p}{\\partial t} + u \\frac{\\partial p}{\\partial x} + \\gamma p \\frac{\\partial u}{\\partial x} = 0 \\quad (\\text{能量})\n$$\n这种形式的能量方程是在量热学完美理想气体的假设下，从能量守恒和连续性方程推导出来的。\n\n我们将该系统写成拟线性形式$\\frac{\\partial \\mathbf{W}}{\\partial t} + \\mathbf{A}(\\mathbf{W}) \\frac{\\partial \\mathbf{W}}{\\partial x} = \\mathbf{0}$。通过将连续性方程展开为$\\frac{\\partial \\rho}{\\partial t} + u\\frac{\\partial \\rho}{\\partial x} + \\rho\\frac{\\partial u}{\\partial x} = 0$，我们可以确定通量雅可比矩阵$\\mathbf{A}$：\n$$\n\\mathbf{A} = \\begin{pmatrix} u  \\rho  0 \\\\ 0  u  \\frac{1}{\\rho} \\\\ 0  \\gamma p  u \\end{pmatrix}\n$$\n系统的波速是矩阵$\\mathbf{A}$的特征值$\\lambda$。它们通过求解特征方程$\\det(\\mathbf{A} - \\lambda \\mathbf{I}) = 0$得到：\n$$\n\\det \\begin{pmatrix} u - \\lambda  \\rho  0 \\\\ 0  u - \\lambda  \\frac{1}{\\rho} \\\\ 0  \\gamma p  u - \\lambda \\end{pmatrix} = 0\n$$\n沿第一列展开行列式可得：\n$$\n(u - \\lambda) \\left[ (u - \\lambda)^2 - (\\gamma p)\\left(\\frac{1}{\\rho}\\right) \\right] = 0\n$$\n引入声速平方的定义$c^2 = \\frac{\\gamma p}{\\rho}$，我们有：\n$$\n(u - \\lambda) \\left[ (u - \\lambda)^2 - c^2 \\right] = 0\n$$\n这产生了三个不同的实特征值，证实了欧拉方程的双曲性：\n$$\n\\lambda_1 = u - c \\quad (\\text{左行声波})\n$$\n$$\n\\lambda_2 = u \\quad (\\text{接触/熵波})\n$$\n$$\n\\lambda_3 = u + c \\quad (\\text{右行声波})\n$$\n问题要求的是声波速度，即$\\lambda_1 = u - c$和$\\lambda_3 = u + c$。\n\n接下来，我们推导黎曼不变量。这些量沿着由$\\frac{dx}{dt} = \\lambda$定义的特征曲线保持不变。特征变量由$\\mathbf{A}$的左特征向量$\\mathbf{l}_k^T$确定，左特征向量满足$\\mathbf{l}_k^T \\mathbf{A} = \\lambda_k \\mathbf{l}_k^T$。这导致沿特征线的特征相容性方程$\\mathbf{l}_k^T d\\mathbf{W} = 0$。\n\n设左特征向量为$\\mathbf{l}^T = (l_1, l_2, l_3)$。左特征向量方程是$\\mathbf{l}^T(\\mathbf{A} - \\lambda \\mathbf{I}) = \\mathbf{0}^T$：\n$$\n(l_1, l_2, l_3) \\begin{pmatrix} u - \\lambda  \\rho  0 \\\\ 0  u - \\lambda  \\frac{1}{\\rho} \\\\ 0  \\gamma p  u - \\lambda \\end{pmatrix} = (0, 0, 0)\n$$\n这得到以下方程组：\n1. $l_1(u - \\lambda) = 0$\n2. $l_1 \\rho + l_2(u - \\lambda) + l_3 \\gamma p = 0$\n3. $l_2 \\frac{1}{\\rho} + l_3(u - \\lambda) = 0$\n\n对于声波，$\\lambda = u \\pm c$，所以$u - \\lambda = \\mp c \\neq 0$。\n由方程(1)，$l_1(\\mp c) = 0$，这意味着$l_1 = 0$。\n方程组简化为：\n2. $l_2(\\mp c) + l_3 \\gamma p = 0$\n3. $l_2 \\frac{1}{\\rho} + l_3(\\mp c) = 0 \\implies l_2 = \\pm l_3 \\rho c$\n将$l_2$代入方程(2)：\n$$\n(\\pm l_3 \\rho c)(\\mp c) + l_3 \\gamma p = 0 \\implies -l_3 \\rho c^2 + l_3 \\gamma p = 0 \\implies l_3(-\\rho c^2 + \\gamma p) = 0\n$$\n由于$c^2 = \\gamma p / \\rho$，该方程对$l_3$的任何选择都成立。我们可以选择$l_3 = 1$。这得到$l_2 = \\pm \\rho c$。\n声波族的左特征向量是：\n对于$\\lambda_1 = u - c$: $\\mathbf{l}_1^T = (0, -\\rho c, 1)$\n对于$\\lambda_3 = u + c$: $\\mathbf{l}_3^T = (0, \\rho c, 1)$\n\n相应的特征相容性关系为$\\mathbf{l}^T d\\mathbf{W} = 0$：\n$$-\\rho c \\, du + dp = 0 \\quad \\text{沿着} \\quad \\frac{dx}{dt} = u - c$$\n$$\\rho c \\, du + dp = 0 \\quad \\text{沿着} \\quad \\frac{dx}{dt} = u + c$$\n这些可以合并为$dp \\pm \\rho c \\, du = 0$。为了找到黎曼不变量，我们必须对这些微分形式进行积分。穿过声波的流动是等熵的，意味着熵是恒定的。对于理想气体，这意味着$p = K\\rho^\\gamma$，其中$K$是某个常数。由此，我们有$dp = K\\gamma\\rho^{\\gamma-1}d\\rho$。同时，$c^2 = \\frac{\\gamma p}{\\rho} = \\gamma K \\rho^{\\gamma-1}$，所以$dp = c^2 d\\rho$。\n相容性关系可以写成$\\frac{dp}{\\rho c} \\pm du = 0$。我们来找一个函数，其微分为$\\frac{dp}{\\rho c}$：\n$$\n\\int \\frac{dp}{\\rho c} = \\int \\frac{c^2 d\\rho}{\\rho c} = \\int \\frac{c}{\\rho} d\\rho\n$$\n由于$c = \\sqrt{\\gamma K \\rho^{\\gamma-1}}$，我们将这个积分用$c$来表示。\n$c^2 = \\gamma K \\rho^{\\gamma-1} \\implies \\ln(c^2) = \\ln(\\gamma K) + (\\gamma-1)\\ln(\\rho) \\implies 2\\ln(c) = \\text{const} + (\\gamma-1)\\ln(\\rho)$。\n对$\\rho$微分：$\\frac{2}{c}\\frac{dc}{d\\rho} = \\frac{\\gamma-1}{\\rho} \\implies d\\rho = \\frac{2\\rho}{(\\gamma-1)c}dc$。\n将$d\\rho$代入积分：\n$$\n\\int \\frac{c}{\\rho} d\\rho = \\int \\frac{c}{\\rho} \\frac{2\\rho}{(\\gamma-1)c} dc = \\int \\frac{2}{\\gamma-1} dc = \\frac{2c}{\\gamma-1}\n$$\n所以，$d\\left(\\frac{2c}{\\gamma-1}\\right) = \\frac{dp}{\\rho c}$。\n相容性关系现在是全微分：\n$$ d\\left(\\frac{2c}{\\gamma-1}\\right) \\pm du = 0 \\implies d\\left(u \\pm \\frac{2c}{\\gamma-1}\\right) = 0 $$\n黎曼不变量是沿着它们各自的特征线守恒的量：\n$$\nw_{-} = u - \\frac{2c}{\\gamma-1} \\quad (\\text{沿着 } \\frac{dx}{dt} = u - c \\text{ 保持不变})\n$$\n$$\nw_{+} = u + \\frac{2c}{\\gamma-1} \\quad (\\text{沿着 } \\frac{dx}{dt} = u + c \\text{ 保持不变})\n$$\n这里，$w_{+}$与右行波相关，$w_{-}$与左行波相关。\n\n现在我们使用给定状态进行数值计算：\n$$\n\\rho = 1.2\\ \\text{kg m}^{-3},\\quad u = 120\\ \\text{m s}^{-1},\\quad p = 101325\\ \\text{Pa},\\quad \\gamma = 1.4\n$$\n首先，计算声速$c$：\n$$\nc = \\sqrt{\\frac{\\gamma p}{\\rho}} = \\sqrt{\\frac{1.4 \\times 101325}{1.2}} = \\sqrt{\\frac{141855}{1.2}} = \\sqrt{118212.5}\\ \\text{m s}^{-1}\n$$\n$$\nc \\approx 343.82043\\ \\text{m s}^{-1}\n$$\n声波速度为：\n$$\n\\lambda_1 = u - c = 120 - 343.82043 = -223.82043\\ \\text{m s}^{-1}\n$$\n$$\n\\lambda_3 = u + c = 120 + 343.82043 = 463.82043\\ \\text{m s}^{-1}\n$$\n接触波的波速是$\\lambda_2 = u = 120\\ \\text{m s}^{-1}$。\n我们验证严格双曲性排序$u-c  u  u+c$：\n$$\n-223.82043\\ \\text{m s}^{-1}  120\\ \\text{m s}^{-1}  463.82043\\ \\text{m s}^{-1}\n$$\n该排序得到确认，这对于$c > 0$的物理有效流是必需的。\n\n最后，我们计算量$J \\equiv w_{+} - w_{-}$：\n$$\nJ = \\left(u + \\frac{2c}{\\gamma-1}\\right) - \\left(u - \\frac{2c}{\\gamma-1}\\right) = u + \\frac{2c}{\\gamma-1} - u + \\frac{2c}{\\gamma-1} = \\frac{4c}{\\gamma-1}\n$$\n代入$c$和$\\gamma$的数值：\n$$\nJ = \\frac{4 \\times \\sqrt{118212.5}}{1.4 - 1} = \\frac{4 \\times \\sqrt{118212.5}}{0.4} = 10 \\times \\sqrt{118212.5}\n$$\n$$\nJ = 10 \\times 343.82043... = 3438.2043...\\ \\text{m s}^{-1}\n$$\n问题要求将答案四舍五入到四位有效数字。\n$$\nJ \\approx 3438\\ \\text{m s}^{-1}\n$$", "answer": "$$\\boxed{3438}$$", "id": "3291767"}, {"introduction": "在掌握了波速的理论基础之后，我们现在可以构建一个完整的数值方法来求解欧拉方程。这个动手编程练习将涉及使用鲁棒的Harten-Lax-van Leer(HLL)近似黎曼求解器，来实现一个一阶Godunov格式。这项实践将巩固您对数值通量和稳定性条件等抽象概念如何转化为一个可实际运行的仿真代码的理解 [@problem_id:3291811]。", "problem": "您需要为一个一阶Godunov有限体积格式实现一个显式时间步，用于求解一维可压缩欧拉方程，其中使用分段常数重构和指定的近似黎曼求解器。控制方程是质量、动量和能量的守恒律，其状态向量为$U = [\\rho, \\rho u, E]^\\top$，通量为$F(U) = [\\rho u, \\rho u^2 + p, u (E + p)]^\\top$。状态方程是理想气体定律，比热比为$\\gamma$，压力由$p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$给出。采用分段常数重构的离散更新根据$U_i^{n+1} = U_i^n - \\dfrac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right)$来演化单元平均值，其中$F_{i\\pm \\frac{1}{2}}$是在单元界面处由近似黎曼求解器计算的数值通量。使用透射（零梯度）边界条件，在每个域边界上通过一个鬼点单元实现。\n\n您的程序必须实现Harten–Lax–van Leer(HLL)近似黎曼求解器。您应当使用从左右状态和状态方程导出的信号速度估计来构建HLL通量。Courant–Friedrichs–Lewy(CFL)数$0  \\text{CFL} \\le 1$通过$\\Delta t = \\text{CFL}\\,\\Delta x / a_{\\max}$控制显式时间步长，其中$a_{\\max}$是整个区域特征速度的一个合适的全局上界。将$a_{\\max}$计算为所有单元上$|u| + c$的最大值，其中$c$是声速$c = \\sqrt{\\gamma p / \\rho}$，由每个单元中的原始变量计算得出。\n\n您将在域$[0,1]$上进行模拟，该域包含$N$个大小为$\\Delta x = 1/N$的均匀单元，其分段常数初始数据由位于$x_0 \\in (0,1)$的单个间断定义：对于单元中心$x_i  x_0$，设置左状态$(\\rho_L, u_L, p_L)$，否则设置右状态$(\\rho_R, u_R, p_R)$。将这些原始变量转换为守恒变量$U = [\\rho, \\rho u, E]^\\top$，其中$E = p/(\\gamma - 1) + \\tfrac{1}{2}\\rho u^2$。\n\n对于下面的每个测试用例，完全按照规定执行一个时间步，并在更新后计算并返回以下三个量：\n- 时间步长$\\Delta t$，作为浮点数。\n- 更新后的总质量$M = \\sum_{i=1}^{N} \\rho_i^{n+1} \\Delta x$，作为浮点数。\n- 更新后所有内部单元的最小压力$\\min_i p_i^{n+1}$，作为浮点数。\n\n此无量纲问题不需要物理单位。不涉及角度。所有输出均表示为十进制浮点数。\n\n使用以下测试套件，每个测试由$(N, \\text{CFL}, \\gamma, (\\rho_L,u_L,p_L), (\\rho_R,u_R,p_R), x_0)$指定：\n1. $N = 200$，$\\text{CFL} = 0.5$，$\\gamma = 1.4$，$(\\rho_L,u_L,p_L) = (1.0, 0.0, 1.0)$，$(\\rho_R,u_R,p_R) = (0.125, 0.0, 0.1)$，$x_0 = 0.5$。\n2. $N = 200$，$\\text{CFL} = 0.5$，$\\gamma = 1.4$，$(\\rho_L,u_L,p_L) = (0.445, 0.698, 3.528)$，$(\\rho_R,u_R,p_R) = (0.5, 0.0, 0.571)$，$x_0 = 0.5$。\n3. $N = 200$，$\\text{CFL} = 0.2$，$\\gamma = 1.4$，$(\\rho_L,u_L,p_L) = (1.0, 0.0, 1.0)$，$(\\rho_R,u_R,p_R) = (0.001, 0.0, 0.000001)$，$x_0 = 0.5$。\n4. $N = 200$，$\\text{CFL} = 0.5$，$\\gamma = 1.4$，$(\\rho_L,u_L,p_L) = (1.0, 3.0, 1.0)$，$(\\rho_R,u_R,p_R) = (1.0, 3.0, 1.0)$，$x_0 = 0.25$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个测试用例贡献一个子列表，其中包含$[\\Delta t, M, \\min p]$顺序的三个值。例如，最终输出格式必须是\n`[[dt_1, M_1, min_p_1],[dt_2, M_2, min_p_2],[dt_3, M_3, min_p_3],[dt_4, M_4, min_p_4]]`,\n行中不包含任何其他文本，也没有任何空格。", "solution": "用户要求实现一个一阶Godunov型有限体积格式的单次显式时间步，用于求解一维可压缩欧拉方程。该解决方案必须使用Harten–Lax–van Leer (HLL)近似黎曼求解器。\n\n一维欧拉方程是一个由$\\partial_t U + \\partial_x F(U) = 0$给出的守恒律系统，其中$U$是守恒变量向量，$F(U)$是通量向量。\n状态向量$U$和通量向量$F(U)$定义如下：\n$$\nU = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}, \\quad\nF(U) = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{pmatrix}\n$$\n这里，$\\rho$是流体密度，$u$是速度，$E$是单位体积的总能量，$p$是压力。该系统由理想气体状态方程封闭，该方程将压力与守恒变量联系起来：\n$$\np = (\\gamma - 1) \\left( E - \\frac{1}{2}\\rho u^2 \\right)\n$$\n其中$\\gamma$是比热比。\n\n有限体积法将空间域$[0, 1]$离散为$N$个计算单元$C_i = [x_{i-1/2}, x_{i+1/2}]$（$i=1, \\dots, N$）。每个单元具有均匀的宽度$\\Delta x = 1/N$。单元平均状态变量为$U_i(t) = \\frac{1}{\\Delta x} \\int_{C_i} U(x, t) dx$。\n对于一阶格式，我们假设分段常数重构，即每个单元内的状态是均匀的，$U(x, t) = U_i(t)$对于$x \\in C_i$。\n在单元$C_i$和时间间隔$[t^n, t^{n+1}]$上对守恒律进行积分，得到显式时间推进公式：\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\n其中$\\Delta t = t^{n+1} - t^n$是时间步，而$F_{i\\pm 1/2}$是单元界面$x_{i\\pm 1/2}$处的数值通量。这些通量通过在每个界面求解黎曼问题来计算。\n\nHLL近似黎曼求解器基于左右状态$U_L = U_i^n$和$U_R = U_{i+1}^n$为界面通量$F_{i+1/2}$提供了一个估计。该方法估计从界面发出的最快向左传播($S_L$)和向右传播($S_R$)的信号速度。一个常见且稳健的估计(Davis, 1988)是：\n$$\nS_L = \\min(u_L - c_L, u_R - c_R)\n$$\n$$\nS_R = \\max(u_L + c_L, u_R + c_R)\n$$\n其中$c = \\sqrt{\\gamma p / \\rho}$是声速。HLL通量，$F_{HLL}$，则由以下公式给出：\n$$\nF_{HLL}(U_L, U_R) = \\begin{cases}\nF(U_L)  \\text{if } S_L \\ge 0 \\\\\nF(U_R)  \\text{if } S_R \\le 0 \\\\\n\\dfrac{S_R F(U_L) - S_L F(U_R) + S_L S_R (U_R - U_L)}{S_R - S_L}  \\text{if } S_L  0  S_R\n\\end{cases}\n$$\n\n显式格式在Courant–Friedrichs–Lewy (CFL) 条件下是稳定的。时间步$\\Delta t$计算如下：\n$$\n\\Delta t = \\text{CFL} \\frac{\\Delta x}{a_{\\max}}\n$$\n其中$\\text{CFL}$是CFL数（$0  \\text{CFL} \\le 1$），$a_{\\max}$是在时间$t^n$时整个域上的最大特征速度：\n$$\na_{\\max} = \\max_i(|u_i^n| + c_i^n)\n$$\n\n实现过程如下：\n1.  **初始化**：设置包含$N$个单元的空间网格。根据给定的分段常数原始变量$(\\rho, u, p)$，使用转换公式$E = p/(\\gamma-1) + \\frac{1}{2}\\rho u^2$初始化单元平均守恒变量$U_i^0$（$i=1, \\dots, N$）。\n2.  **时间步计算**：计算所有单元上的最大特征速度$a_{\\max}$，并使用CFL条件计算时间步$\\Delta t$。\n3.  **边界条件**：在每侧用一个鬼点单元扩展域。对于透射（零梯度）边界，左侧鬼点单元的状态设置为与第一个内部单元的状态相等（$U_0 = U_1$），右侧鬼点单元的状态设置为与最后一个内部单元的状态相等（$U_{N+1} = U_N$）。这将创建一个大小为$N+2$的扩展状态向量。\n4.  **通量计算**：遍历从$x_{1/2}$到$x_{N+1/2}$的所有$N+1$个界面。在每个界面$x_{i+1/2}$处，使用扩展网格中的状态$U_i$和$U_{i+1}$作为HLL求解器的左右输入，以计算数值通量$F_{i+1/2}$。\n5.  **状态更新**：使用离散守恒律更新所有内部单元$i=1, \\dots, N$的守恒变量$U_i$。\n6.  **输出计算**：在一个时间步之后，将新的守恒变量$U_i^{n+1}$转换回原始变量$(\\rho_i^{n+1}, u_i^{n+1}, p_i^{n+1})$。计算总质量$M = \\sum_{i=1}^{N} \\rho_i^{n+1} \\Delta x$和最小压力$\\min_i p_i^{n+1}$。\n\n此过程将应用于每个测试用例以生成所需的输出。为提高效率，使用了向量化的 `numpy` 操作。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\nclass Euler1DHLLSolver:\n    \"\"\"\n    Implements a single step of a first-order Godunov scheme for the\n    1D Euler equations using the HLL approximate Riemann solver.\n    \"\"\"\n    def __init__(self, N, CFL, gamma, left_prim, right_prim, x0):\n        self.N = N\n        self.CFL = CFL\n        self.gamma = gamma\n        self.dx = 1.0 / self.N\n        self.U = self._initialize_state(left_prim, right_prim, x0)\n\n    def _primitives_to_conserved(self, rho, u, p):\n        return np.array([rho, rho * u, p / (self.gamma - 1.0) + 0.5 * rho * u**2])\n\n    def _conserved_to_primitives_vec(self, U):\n        rho = U[:, 0]\n        rho_u = U[:, 1]\n        E = U[:, 2]\n        u = rho_u / rho\n        # Prevent negative pressure from floating point errors\n        p = np.maximum(1e-12, (self.gamma - 1.0) * (E - 0.5 * rho * u**2))\n        return rho, u, p\n\n    def _get_flux_vec(self, U):\n        rho, u, p = self._conserved_to_primitives_vec(U)\n        rho_u = U[:, 1]\n        E = U[:, 2]\n        \n        F = np.zeros_like(U)\n        F[:, 0] = rho_u\n        F[:, 1] = rho_u * u + p\n        F[:, 2] = u * (E + p)\n        return F\n\n    def _get_hll_flux_vec(self, U_L, U_R):\n        gamma = self.gamma\n        rho_L, u_L, p_L = self._conserved_to_primitives_vec(U_L)\n        rho_R, u_R, p_R = self._conserved_to_primitives_vec(U_R)\n\n        F_L = self._get_flux_vec(U_L)\n        F_R = self._get_flux_vec(U_R)\n\n        c_L = np.sqrt(gamma * p_L / rho_L)\n        c_R = np.sqrt(gamma * p_R / rho_R)\n\n        S_L = np.minimum(u_L - c_L, u_R - c_R)\n        S_R = np.maximum(u_L + c_L, u_R + c_R)\n\n        # Broadcasting for array operations\n        S_L_b = S_L[:, np.newaxis]\n        S_R_b = S_R[:, np.newaxis]\n        \n        # HLL flux formula vectorized\n        num = S_R_b * F_L - S_L_b * F_R + S_L_b * S_R_b * (U_R - U_L)\n        den = S_R - S_L\n        \n        F_hll = np.zeros_like(U_L)\n\n        # Conditions for HLL cases\n        cond_L = S_L >= 0\n        cond_R = S_R = 0\n        cond_star = (~cond_L)  (~cond_R)\n        \n        F_hll[cond_L] = F_L[cond_L]\n        F_hll[cond_R] = F_R[cond_R]\n\n        # For the star region, handle possible division by zero\n        den_star = den[cond_star]\n        is_zero_den = np.isclose(den_star, 0)\n        \n        F_star = np.zeros_like(F_L[cond_star])\n        \n        # Non-zero denominator case\n        non_zero_mask = ~is_zero_den\n        if np.any(non_zero_mask):\n            F_star[non_zero_mask] = num[cond_star][non_zero_mask] / den_star[non_zero_mask, np.newaxis]\n\n        # Zero denominator case (uniform flow U_L=U_R) -> flux is physical flux\n        if np.any(is_zero_den):\n            F_star[is_zero_den] = F_L[cond_star][is_zero_den]\n        \n        F_hll[cond_star] = F_star\n        \n        return F_hll\n\n    def _initialize_state(self, left_prim, right_prim, x0):\n        x_centers = (np.arange(self.N) + 0.5) * self.dx\n        \n        left_U = self._primitives_to_conserved(*left_prim)\n        right_U = self._primitives_to_conserved(*right_prim)\n        \n        mask = (x_centers  x0)[:, np.newaxis]\n        U = np.where(mask, left_U, right_U)\n        return U\n\n    def run_one_step(self):\n        # 1. Calculate time step dt\n        rho, u, p = self._conserved_to_primitives_vec(self.U)\n        c = np.sqrt(self.gamma * p / rho)\n        a_max = np.max(np.abs(u) + c)\n        dt = self.CFL * self.dx / a_max\n        \n        # 2. Apply boundary conditions (1 ghost cell on each side)\n        U_ext = np.zeros((self.N + 2, 3))\n        U_ext[1:-1, :] = self.U\n        U_ext[0, :] = U_ext[1, :]   # zero-gradient BC on left\n        U_ext[-1, :] = U_ext[-2, :] # zero-gradient BC on right\n\n        # 3. Compute fluxes at cell interfaces\n        U_L = U_ext[:-1, :]\n        U_R = U_ext[1:, :]\n        F_half = self._get_hll_flux_vec(U_L, U_R)\n\n        # 4. Update cell averages\n        F_L_cell = F_half[:-1, :] # Fluxes at i-1/2\n        F_R_cell = F_half[1:, :]  # Fluxes at i+1/2\n        U_new = self.U - (dt / self.dx) * (F_R_cell - F_L_cell)\n\n        # 5. Compute required outputs\n        rho_new, _, p_new = self._conserved_to_primitives_vec(U_new)\n        total_mass = np.sum(rho_new) * self.dx\n        min_pressure = np.min(p_new)\n\n        return dt, total_mass, min_pressure\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (200, 0.5, 1.4, (1.0, 0.0, 1.0), (0.125, 0.0, 0.1), 0.5),\n        (200, 0.5, 1.4, (0.445, 0.698, 3.528), (0.5, 0.0, 0.571), 0.5),\n        (200, 0.2, 1.4, (1.0, 0.0, 1.0), (0.001, 0.0, 0.000001), 0.5),\n        (200, 0.5, 1.4, (1.0, 3.0, 1.0), (1.0, 3.0, 1.0), 0.25),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, CFL, gamma, left_prim, right_prim, x0 = case\n        solver = Euler1DHLLSolver(N, CFL, gamma, left_prim, right_prim, x0)\n        res = solver.run_one_step()\n        results.append(list(res))\n\n    # Final print statement in the exact required format.\n    result_strs = [f\"[{r[0]},{r[1]},{r[2]}]\" for r in results]\n    print(f\"[{','.join(result_strs)}]\")\n\nsolve()\n```", "id": "3291811"}, {"introduction": "近似黎曼求解器功能强大，但它们并非万无一失，尤其是那些基于线性化的求解器。本练习展示了一个经典的反例，其中Roe近似黎曼求解器在模拟强膨胀流时，会产生一个具有负压的非物理状态。通过解决这个问题，您将学到关于求解器不变域的关键概念，并理解为何在计算流体力学中，鲁棒性与准确性同等重要 [@problem_id:3291766]。", "problem": "考虑理想气体的一维可压缩欧拉方程，\n$$\n\\frac{\\partial}{\\partial t}\n\\begin{pmatrix}\n\\rho \\\\\n\\rho u \\\\\nE\n\\end{pmatrix}\n+\n\\frac{\\partial}{\\partial x}\n\\begin{pmatrix}\n\\rho u \\\\\n\\rho u^{2} + p \\\\\nu\\,(E + p)\n\\end{pmatrix}\n= 0,\n$$\n其热力学封闭关系为\n$$\nE = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\,\\rho u^{2},\n$$\n其中$\\rho$是密度，$u$是速度，$p$是压力，$E$是总能量，$\\gamma$是恒定的比热比。所有变量均为无量纲。\n\n定义一个具有以下左态和右态的黎曼问题\n$$\n(\\rho_{L}, u_{L}, p_{L}) = (1, -2, 0.1), \\qquad (\\rho_{R}, u_{R}, p_{R}) = (1, 2, 0.1),\n$$\n对于理想气体，$\\gamma = 1.4$。\n\n使用Roe线性化（不进行任何熵修正），构造此黎曼问题的分段常数近似解，并确定对应于自相似变量$x/t$的中间常数状态$U_{*}$，该变量严格位于最小和最大Roe特征速度之间。然后，通过理想气体关系从守恒变量计算该中间状态的压力$p_{*}$。\n\n解释在这种情况下Roe求解器为何会失去不变域（密度和压力的正性），并将其与线性化的结构以及数据的跨音速稀疏波特征联系起来。\n\n以无量纲单位提供$p_{*}$的值（一个实数），并将您的答案四舍五入到四位有效数字。", "solution": "该问题要求使用Roe近似黎曼求解器分析一维可压缩欧拉方程的特定黎曼问题。我将首先验证问题陈述，然后进行详细的求解推导。\n\n该方程组由下式给出\n$$\n\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}(\\mathbf{U})}{\\partial x} = 0,\n$$\n其中守恒变量向量$\\mathbf{U}$和通量向量$\\mathbf{F}$为\n$$\n\\mathbf{U} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}, \\qquad \\mathbf{F}(\\mathbf{U}) = \\begin{pmatrix} \\rho u \\\\ \\rho u^{2} + p \\\\ u(E + p) \\end{pmatrix}.\n$$\n该系统由理想气体状态方程封闭，该方程将总能量$E$与压力$p$、密度$\\rho$和速度$u$联系起来：\n$$\nE = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho u^{2}.\n$$\n给定的黎曼问题具有以下左（L）态和右（R）态：\n$$\n(\\rho_{L}, u_{L}, p_{L}) = (1, -2, 0.1)\n$$\n$$\n(\\rho_{R}, u_{R}, p_{R}) = (1, 2, 0.1)\n$$\n比热比为$\\gamma = 1.4$。\n\nRoe方法通过求解一个线性化系统$\\frac{\\partial \\mathbf{U}}{\\partial t} + \\tilde{A} \\frac{\\partial \\mathbf{U}}{\\partial x} = 0$来近似黎曼问题的解，其中Roe矩阵$\\tilde{A}(\\mathbf{U}_L, \\mathbf{U}_R)$是一个满足属性$\\mathbf{F}_R - \\mathbf{F}_L = \\tilde{A}(\\mathbf{U}_R - \\mathbf{U}_L)$的常数矩阵。该矩阵是使用Roe平均变量构造的。\n\n首先，我们计算左态和右态所需的原始量和派生量。\n对于左态：\n$$\nE_L = \\frac{p_L}{\\gamma - 1} + \\frac{1}{2}\\rho_L u_L^2 = \\frac{0.1}{1.4 - 1} + \\frac{1}{2}(1)(-2)^2 = \\frac{0.1}{0.4} + 2 = 0.25 + 2 = 2.25\n$$\n比总焓为$h = (E+p)/\\rho$。\n$$\nh_L = \\frac{E_L + p_L}{\\rho_L} = \\frac{2.25 + 0.1}{1} = 2.35\n$$\n对于右态，问题是对称的：\n$$\nE_R = \\frac{p_R}{\\gamma - 1} + \\frac{1}{2}\\rho_R u_R^2 = \\frac{0.1}{1.4 - 1} + \\frac{1}{2}(1)(2)^2 = 0.25 + 2 = 2.25\n$$\n$$\nh_R = \\frac{E_R + p_R}{\\rho_R} = \\frac{2.25 + 0.1}{1} = 2.35\n$$\n接下来，我们计算用波浪号表示的Roe平均变量：\n$$\n\\tilde{\\rho} = \\sqrt{\\rho_L \\rho_R} = \\sqrt{1 \\times 1} = 1\n$$\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L}u_L + \\sqrt{\\rho_R}u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}} = \\frac{\\sqrt{1}(-2) + \\sqrt{1}(2)}{\\sqrt{1} + \\sqrt{1}} = \\frac{-2 + 2}{2} = 0\n$$\n$$\n\\tilde{h} = \\frac{\\sqrt{\\rho_L}h_L + \\sqrt{\\rho_R}h_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}} = \\frac{\\sqrt{1}(2.35) + \\sqrt{1}(2.35)}{\\sqrt{1} + \\sqrt{1}} = 2.35\n$$\nRoe平均声速$\\tilde{c}$由$\\tilde{c}^2 = (\\gamma - 1)(\\tilde{h} - \\frac{1}{2}\\tilde{u}^2)$给出。\n$$\n\\tilde{c}^2 = (1.4 - 1)(2.35 - \\frac{1}{2}(0)^2) = 0.4 \\times 2.35 = 0.94\n$$\n$$\n\\tilde{c} = \\sqrt{0.94}\n$$\nRoe矩阵$\\tilde{A}$的特征值是在平均状态下计算的特征速度：\n$$\n\\tilde{\\lambda}_1 = \\tilde{u} - \\tilde{c} = -\\sqrt{0.94}\n$$\n$$\n\\tilde{\\lambda}_2 = \\tilde{u} = 0\n$$\n$$\n\\tilde{\\lambda}_3 = \\tilde{u} + \\tilde{c} = \\sqrt{0.94}\n$$\n状态向量的跳跃$\\Delta \\mathbf{U} = \\mathbf{U}_R - \\mathbf{U}_L$被分解到$\\tilde{A}$的右特征向量$\\tilde{\\mathbf{r}}_k$的基上，其系数（波强度）为$\\tilde{\\alpha}_k$：$\\Delta \\mathbf{U} = \\sum_{k=1}^3 \\tilde{\\alpha}_k \\tilde{\\mathbf{r}}_k$。\n波强度由原始变量的跳跃计算得出：\n$$\n\\Delta\\rho = \\rho_R - \\rho_L = 1 - 1 = 0\n$$\n$$\n\\Delta u = u_R - u_L = 2 - (-2) = 4\n$$\n$$\n\\Delta p = p_R - p_L = 0.1 - 0.1 = 0\n$$\n波强度的公式为：\n$$\n\\tilde{\\alpha}_1 = \\frac{1}{2\\tilde{c}^2}(\\Delta p - \\tilde{\\rho}\\tilde{c}\\Delta u) = \\frac{1}{2(0.94)}(0 - (1)(\\sqrt{0.94})(4)) = -\\frac{4\\sqrt{0.94}}{2(0.94)} = -\\frac{2}{\\sqrt{0.94}}\n$$\n$$\n\\tilde{\\alpha}_2 = \\Delta\\rho - \\frac{\\Delta p}{\\tilde{c}^2} = 0 - \\frac{0}{0.94} = 0\n$$\n$$\n\\tilde{\\alpha}_3 = \\frac{1}{2\\tilde{c}^2}(\\Delta p + \\tilde{\\rho}\\tilde{c}\\Delta u) = \\frac{1}{2(0.94)}(0 + (1)(\\sqrt{0.94})(4)) = \\frac{4\\sqrt{0.94}}{2(0.94)} = \\frac{2}{\\sqrt{0.94}}\n$$\n近似解由以速度$\\tilde{\\lambda}_k$移动的间断分隔的常数状态组成。位于$\\tilde{\\lambda}_1$和$\\tilde{\\lambda}_2$之间的状态是$\\mathbf{U}_{*L} = \\mathbf{U}_L + \\tilde{\\alpha}_1 \\tilde{\\mathbf{r}}_1$。位于$\\tilde{\\lambda}_2$和$\\tilde{\\lambda}_3$之间的状态是$\\mathbf{U}_{*R} = \\mathbf{U}_{*L} + \\tilde{\\alpha}_2 \\tilde{\\mathbf{r}}_2$。由于接触波强度$\\tilde{\\alpha}_2 = 0$，因此只有一个中间状态，即$\\mathbf{U}_* = \\mathbf{U}_{*L} = \\mathbf{U}_{*R}$。\n\nRoe矩阵的第一个右特征向量是$\\tilde{\\mathbf{r}}_1 = (1, \\tilde{u}-\\tilde{c}, \\tilde{h}-\\tilde{u}\\tilde{c})^T$。在Roe平均状态下计算：\n$$\n\\tilde{\\mathbf{r}}_1 = (1, 0-\\sqrt{0.94}, 2.35 - 0 \\times \\sqrt{0.94})^T = (1, -\\sqrt{0.94}, 2.35)^T\n$$\n左态向量为$\\mathbf{U}_L = (\\rho_L, \\rho_L u_L, E_L)^T = (1, -2, 2.25)^T$。\n中间状态$\\mathbf{U}_* = (\\rho_*, (\\rho u)_*, E_*)^T$计算如下：\n$$\n\\mathbf{U}_* = \\mathbf{U}_L + \\tilde{\\alpha}_1 \\tilde{\\mathbf{r}}_1 = \\begin{pmatrix} 1 \\\\ -2 \\\\ 2.25 \\end{pmatrix} + \\left(-\\frac{2}{\\sqrt{0.94}}\\right) \\begin{pmatrix} 1 \\\\ -\\sqrt{0.94} \\\\ 2.35 \\end{pmatrix}\n$$\n我们计算$\\mathbf{U}_*$的分量：\n$$\n\\rho_* = 1 - \\frac{2}{\\sqrt{0.94}}\n$$\n$$\n(\\rho u)_* = -2 - \\frac{2}{\\sqrt{0.94}}(-\\sqrt{0.94}) = -2 + 2 = 0\n$$\n$$\nE_* = 2.25 - \\frac{2 \\times 2.35}{\\sqrt{0.94}} = 2.25 - \\frac{4.7}{\\sqrt{0.94}}\n$$\n从这些守恒变量中，我们求出中间状态的原始变量。速度为：\n$$\nu_* = \\frac{(\\rho u)_*}{\\rho_*} = \\frac{0}{\\rho_*} = 0\n$$\n压力$p_*$由总能量求得：\n$$\nE_* = \\frac{p_*}{\\gamma - 1} + \\frac{1}{2}\\rho_* u_*^2 \\implies p_* = (\\gamma - 1) E_* \\quad (\\text{因为 } u_*=0)\n$$\n代入$E_*$的表达式：\n$$\np_* = (1.4 - 1) \\left( 2.25 - \\frac{4.7}{\\sqrt{0.94}} \\right) = 0.4 \\left( 2.25 - \\frac{4.7}{\\sqrt{0.94}} \\right)\n$$\n数值上，$\\sqrt{0.94} \\approx 0.969536$。\n$$\np_* \\approx 0.4 \\left( 2.25 - \\frac{4.7}{0.969536} \\right) \\approx 0.4 (2.25 - 4.84765) = 0.4 (-2.59765) \\approx -1.03906\n$$\n四舍五入到四位有效数字，我们得到$p_* = -1.039$。\n\n负压力是非物理的，这突显了Roe求解器的一个已知失效。这种失效的机制如下：\n1.  **跨音速稀疏波：** 初始数据代表一个强烈的对称膨胀。与声波相关的特征速度在整个问题域内改变符号。对于左态，速度为$(u_L-c_L, u_L, u_L+c_L)$，其中$c_L = \\sqrt{\\gamma p_L / \\rho_L} = \\sqrt{1.4 \\times 0.1 / 1} = \\sqrt{0.14} \\approx 0.374$。所有特征速度$u_L \\pm c_L$和$u_L$均为负：$(-2.374, -2.0, -1.626)$。对于右态，所有速度均为正：$(1.626, 2.0, 2.374)$。这种情况，即一个特征场（例如$u-c$或$u+c$场）在两侧都是亚音速的，但特征速度穿过零点，被称为跨音速稀疏波。精确解在中心包含一个真空状态($p=0, \\rho=0$)。\n2.  **线性化与非物理激波：** Roe求解器基于非线性欧拉方程的线性化。它用单个间断（一个“稀疏激波”）取代了精确解中的光滑稀疏扇。这个跳跃满足线性化系统的Rankine-Hugoniot条件，但违反了真实非线性系统的熵条件，因为激波必须是压缩的。问题指定了不使用熵修正，这是一种旨在在这种情况下增加数值耗散以抹平稀疏波并防止这种非物理解的修正。\n3.  **失去不变域：** 欧拉方程的状态向量必须位于由物理约束$\\rho > 0$和$p > 0$定义的“不变域”内。Roe线性化本身并不保证中间状态$(\\mathbf{U}_*)$会保持在该域内。对于像这样的强膨胀，从初始状态$\\mathbf{U}_L$到中间状态$\\mathbf{U}_*$的跳跃由波强度$\\tilde{\\alpha}_1$表征。这个跳跃$\\tilde{\\alpha}_1 \\tilde{\\mathbf{r}}_1$足够大，以至于“超调”了物理区域。\n    具体来说，新的密度是$\\rho_* = \\rho_L + \\tilde{\\alpha}_1 (\\tilde{\\mathbf{r}}_1)_1 = 1 - 2/\\sqrt{0.94}$。由于$2 > \\sqrt{0.94}$，得到的密度$\\rho_*$是负的。因此，从$E_*$推导出的压力$p_*$也变为负值。线性化无法捕捉导致真空的非线性动力学，而是产生了一个数学上一致但物理上不可能的状态。", "answer": "$$\n\\boxed{-1.039}\n$$", "id": "3291766"}]}