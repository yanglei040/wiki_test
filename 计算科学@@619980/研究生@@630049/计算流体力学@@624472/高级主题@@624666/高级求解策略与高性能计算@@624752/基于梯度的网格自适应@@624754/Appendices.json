{"hands_on_practices": [{"introduction": "本练习将引导你完成一个基础但至关重要的计算：为单个有限元估算基于梯度的误差。通过比较精确解的梯度和数值插值解的梯度，我们可以量化一个单元内的离散误差，这是决定网格何处需要加密的根本依据。这项实践将帮助你深入理解误差指示子的概念，并将其与解的局部行为联系起来 [@problem_id:3325351]。", "problem": "考虑一个三角形有限元，其顶点在平面上按逆时针顺序排列，分别为 $\\mathbf{x}_1=(0,0)$、$\\mathbf{x}_2=(1,0)$ 和 $\\mathbf{x}_3=(0,1)$。设标量场为 $u(x,y)=\\exp(x)\\sin(y)$，并设 $u_h$ 是通过三个顶点处的逐点采样值 $u(\\mathbf{x}_i)$ 在仿射线性多项式空间（也称为 $\\mathbb{P}_1$ 有限元）中构建的节点插值函数。\n\n仅使用插值理论和矢量微积分的基本定义，完成以下任务：\n\n1. 通过一阶形心求积法，近似计算单元 $K$ 上梯度误差的 $L^2$ 范数，从而定义单元上的基于梯度的误差指示子 $\\eta_K$。也就是说，将 $K$ 上梯度误差平方的积分视为单元面积乘以形心处梯度逐点误差的平方。然后推导并计算此单元的 $\\eta_K$ 的数值。\n\n2. 对于由穿过每条边的方向导数大小驱动的各向异性加密，预测哪条边应被最密集地加密。对于一条外单位法向量为 $\\mathbf{n}_e$ 的边 $e$，在单元形心 $\\mathbf{x}_c$ 处穿过边的方向导数是标量 $|\\nabla u(\\mathbf{x}_c)\\cdot \\mathbf{n}_e|$。使用绝对值以消除对法线方向选择的依赖。将边枚举为 $e_1=\\overline{\\mathbf{x}_1\\mathbf{x}_2}$、$e_2=\\overline{\\mathbf{x}_2\\mathbf{x}_3}$ 和 $e_3=\\overline{\\mathbf{x}_3\\mathbf{x}_1}$，并选择达到最大值的索引 $k\\in\\{1,2,3\\}$。\n\n将你的最终答案报告为一个 $1\\times 2$ 的行矩阵，其中包含：\n- $\\eta_K$ 的值（无量纲），四舍五入到4位有效数字，后跟\n- 边索引 $k$（整数）。\n\n最终方框内的答案不应包含任何单位。", "solution": "首先验证问题，以确保其有科学依据、适定且客观。\n已知条件如下：\n- 一个顶点为 $\\mathbf{x}_1=(0,0)$、$\\mathbf{x}_2=(1,0)$ 和 $\\mathbf{x}_3=(0,1)$ 的三角形有限元 $K$。\n- 一个标量场 $u(x,y)=\\exp(x)\\sin(y)$。\n- 节点插值 $u_h$ 是一个 $\\mathbb{P}_1$ 多项式。\n- 各向同性误差指示子定义为 $\\eta_K = \\left( |K| \\cdot |\\nabla u(\\mathbf{x}_c) - \\nabla u_h(\\mathbf{x}_c)|^2 \\right)^{1/2}$，其中 $|K|$ 是三角形的面积，$\\mathbf{x}_c$ 是其形心。\n- 边 $e$ 的各向异性加密准则为 $|\\nabla u(\\mathbf{x}_c)\\cdot \\mathbf{n}_e|$，其中 $\\mathbf{n}_e$ 是外单位法向量。\n- 边枚举为 $e_1=\\overline{\\mathbf{x}_1\\mathbf{x}_2}$、$e_2=\\overline{\\mathbf{x}_2\\mathbf{x}_3}$ 和 $e_3=\\overline{\\mathbf{x}_3\\mathbf{x}_1}$。\n\n该问题是有限元法后验误差估计领域的一个标准练习。所有术语都定义良好，函数光滑，几何形状简单。该问题基于数值分析和矢量微积分的既定原则。因此，该问题是有效的。\n\n我们将依次解决问题的两个部分。\n\n**第1部分：误差指示子 $\\eta_K$ 的计算**\n\n首先，我们确定三角形单元 $K$ 的几何属性。其顶点为 $\\mathbf{x}_1=(0,0)$、$\\mathbf{x}_2=(1,0)$ 和 $\\mathbf{x}_3=(0,1)$。这是一个直角三角形。\n单元的面积 $|K|$ 由 $|K| = \\frac{1}{2} \\times \\text{底} \\times \\text{高} = \\frac{1}{2} \\times 1 \\times 1 = \\frac{1}{2}$ 给出。\n三角形的形心 $\\mathbf{x}_c$ 是其顶点坐标的平均值：\n$$\n\\mathbf{x}_c = \\frac{1}{3}(\\mathbf{x}_1 + \\mathbf{x}_2 + \\mathbf{x}_3) = \\frac{1}{3}((0,0) + (1,0) + (0,1)) = \\left(\\frac{1}{3}, \\frac{1}{3}\\right)\n$$\n\n接下来，我们计算真实标量场 $u(x,y) = \\exp(x)\\sin(y)$ 的梯度。\n$$\n\\nabla u(x,y) = \\left(\\frac{\\partial u}{\\partial x}, \\frac{\\partial u}{\\partial y}\\right) = (\\exp(x)\\sin(y), \\exp(x)\\cos(y))\n$$\n我们在单元形心 $\\mathbf{x}_c = (1/3, 1/3)$ 处计算该梯度：\n$$\n\\nabla u(\\mathbf{x}_c) = \\left(\\exp\\left(\\frac{1}{3}\\right)\\sin\\left(\\frac{1}{3}\\right), \\exp\\left(\\frac{1}{3}\\right)\\cos\\left(\\frac{1}{3}\\right)\\right)\n$$\n\n现在，我们必须找到 $\\mathbb{P}_1$ 节点插值函数 $u_h(x,y)$。一个 $\\mathbb{P}_1$ 函数是一个形式为 $u_h(x,y) = a + bx + cy$ 的仿射线性多项式。其系数通过强制 $u_h$ 在顶点处与 $u$ 匹配来确定。\n$u$ 的节点值为：\n$u_1 = u(\\mathbf{x}_1) = u(0,0) = \\exp(0)\\sin(0) = 0$。\n$u_2 = u(\\mathbf{x}_2) = u(1,0) = \\exp(1)\\sin(0) = 0$。\n$u_3 = u(\\mathbf{x}_3) = u(0,1) = \\exp(0)\\sin(1) = \\sin(1)$。\n\n插值函数 $u_h$ 可以使用三角形的线性基函数 $\\phi_i$ 来表示：\n$u_h(x,y) = u_1 \\phi_1(x,y) + u_2 \\phi_2(x,y) + u_3 \\phi_3(x,y)$。\n对于这个参考三角形，基函数为 $\\phi_1(x,y) = 1-x-y$、$\\phi_2(x,y) = x$ 和 $\\phi_3(x,y) = y$。\n代入节点值：\n$$\nu_h(x,y) = 0 \\cdot (1-x-y) + 0 \\cdot x + \\sin(1) \\cdot y = y\\sin(1)\n$$\n插值函数 $\\nabla u_h$ 的梯度在单元上是常数：\n$$\n\\nabla u_h(x,y) = \\left(\\frac{\\partial}{\\partial x}(y\\sin(1)), \\frac{\\partial}{\\partial y}(y\\sin(1))\\right) = (0, \\sin(1))\n$$\n由于 $\\nabla u_h$ 是常数，其在形心 $\\mathbf{x}_c$ 处的值为 $\\nabla u_h(\\mathbf{x}_c) = (0, \\sin(1))$。\n\n现在我们计算形心处的梯度误差向量：\n$$\n\\nabla u(\\mathbf{x}_c) - \\nabla u_h(\\mathbf{x}_c) = \\left(\\exp\\left(\\frac{1}{3}\\right)\\sin\\left(\\frac{1}{3}\\right), \\exp\\left(\\frac{1}{3}\\right)\\cos\\left(\\frac{1}{3}\\right) - \\sin(1)\\right)\n$$\n该向量大小的平方是：\n$$\n|\\nabla u(\\mathbf{x}_c) - \\nabla u_h(\\mathbf{x}_c)|^2 = \\left(\\exp\\left(\\frac{1}{3}\\right)\\sin\\left(\\frac{1}{3}\\right)\\right)^2 + \\left(\\exp\\left(\\frac{1}{3}\\right)\\cos\\left(\\frac{1}{3}\\right) - \\sin(1)\\right)^2\n$$\n$$\n= \\exp\\left(\\frac{2}{3}\\right)\\sin^2\\left(\\frac{1}{3}\\right) + \\exp\\left(\\frac{2}{3}\\right)\\cos^2\\left(\\frac{1}{3}\\right) - 2\\exp\\left(\\frac{1}{3}\\right)\\cos\\left(\\frac{1}{3}\\right)\\sin(1) + \\sin^2(1)\n$$\n$$\n= \\exp\\left(\\frac{2}{3}\\right)\\left(\\sin^2\\left(\\frac{1}{3}\\right) + \\cos^2\\left(\\frac{1}{3}\\right)\\right) - 2\\exp\\left(\\frac{1}{3}\\right)\\cos\\left(\\frac{1}{3}\\right)\\sin(1) + \\sin^2(1)\n$$\n$$\n= \\exp\\left(\\frac{2}{3}\\right) - 2\\exp\\left(\\frac{1}{3}\\right)\\cos\\left(\\frac{1}{3}\\right)\\sin(1) + \\sin^2(1)\n$$\n误差指示子 $\\eta_K$ 定义为：\n$$\n\\eta_K = \\sqrt{|K|} \\cdot |\\nabla u(\\mathbf{x}_c) - \\nabla u_h(\\mathbf{x}_c)| = \\sqrt{\\frac{1}{2}} \\sqrt{\\exp\\left(\\frac{2}{3}\\right) - 2\\exp\\left(\\frac{1}{3}\\right)\\cos\\left(\\frac{1}{3}\\right)\\sin(1) + \\sin^2(1)}\n$$\n我们现在计算其数值（对三角函数使用弧度）：\n$\\exp(2/3) \\approx 1.947734$\n$2\\exp(1/3)\\cos(1/3)\\sin(1) \\approx 2 \\cdot (1.395612) \\cdot (0.944957) \\cdot (0.841471) \\approx 2.219516$\n$\\sin^2(1) \\approx (0.841471)^2 \\approx 0.708073$\n所以，平方根内的项约为 $1.947734 - 2.219516 + 0.708073 \\approx 0.436291$。\n$$\n\\eta_K \\approx \\sqrt{\\frac{1}{2} \\cdot 0.436291} = \\sqrt{0.2181455} \\approx 0.4670609\n$$\n四舍五入到4位有效数字，$\\eta_K \\approx 0.4671$。\n\n**第2部分：确定待加密的边**\n\n我们需要为每条边 $e \\in \\{e_1, e_2, e_3\\}$ 计算指示子 $|\\nabla u(\\mathbf{x}_c)\\cdot \\mathbf{n}_e|$。顶点按逆时针顺序排列。\n边向量为：\n$e_1 = \\overline{\\mathbf{x}_1\\mathbf{x}_2}$：向量 $\\mathbf{v}_1 = \\mathbf{x}_2 - \\mathbf{x}_1 = (1,0)$。\n$e_2 = \\overline{\\mathbf{x}_2\\mathbf{x}_3}$：向量 $\\mathbf{v}_2 = \\mathbf{x}_3 - \\mathbf{x}_2 = (-1,1)$。\n$e_3 = \\overline{\\mathbf{x}_3\\mathbf{x}_1}$：向量 $\\mathbf{v}_3 = \\mathbf{x}_1 - \\mathbf{x}_3 = (0,-1)$。\n\n相应的向外单位法向量 $\\mathbf{n}_e$ 通过将边向量旋转 $-90^\\circ$（这将一个向量 $(a,b)$ 映射到 $(b,-a)$）并单位化得到。\n对于 $e_1$：法线方向是 $(0,-1)$。这已经是一个单位向量。所以，$\\mathbf{n}_{e_1} = (0,-1)$。\n对于 $e_2$：法线方向是 $(1,1)$。长度为 $\\sqrt{1^2+1^2}=\\sqrt{2}$。所以，$\\mathbf{n}_{e_2} = (1/\\sqrt{2}, 1/\\sqrt{2})$。\n对于 $e_3$：法线方向是 $(-1,0)$。这已经是一个单位向量。所以，$\\mathbf{n}_{e_3} = (-1,0)$。\n\n现在我们计算梯度 $\\nabla u(\\mathbf{x}_c) = (\\exp(1/3)\\sin(1/3), \\exp(1/3)\\cos(1/3))$ 与每个法向量的点积。\n设 $g_x = \\exp(1/3)\\sin(1/3)$ 且 $g_y = \\exp(1/3)\\cos(1/3)$。\n$\\nabla u(\\mathbf{x}_c) = (g_x, g_y)$。\n\n对于边 $e_1$：\nIndicator$_1 = |\\nabla u(\\mathbf{x}_c) \\cdot \\mathbf{n}_{e_1}| = |(g_x, g_y) \\cdot (0, -1)| = |-g_y| = g_y = \\exp(1/3)\\cos(1/3)$。\nIndicator$_1 \\approx 1.395612 \\cdot 0.944957 \\approx 1.31876$。\n\n对于边 $e_2$：\nIndicator$_2 = |\\nabla u(\\mathbf{x}_c) \\cdot \\mathbf{n}_{e_2}| = |(g_x, g_y) \\cdot (1/\\sqrt{2}, 1/\\sqrt{2})| = \\frac{1}{\\sqrt{2}}|g_x+g_y|$。由于 $g_x, g_y > 0$，这等于 $\\frac{1}{\\sqrt{2}}(g_x+g_y)$。\nIndicator$_2 = \\frac{\\exp(1/3)}{\\sqrt{2}}(\\sin(1/3) + \\cos(1/3))$。\nIndicator$_2 \\approx \\frac{1.395612}{\\sqrt{2}}(0.327195 + 0.944957) \\approx 0.986845 \\cdot 1.272152 \\approx 1.25544$。\n\n对于边 $e_3$：\nIndicator$_3 = |\\nabla u(\\mathbf{x}_c) \\cdot \\mathbf{n}_{e_3}| = |(g_x, g_y) \\cdot (-1, 0)| = |-g_x| = g_x = \\exp(1/3)\\sin(1/3)$。\nIndicator$_3 \\approx 1.395612 \\cdot 0.327195 \\approx 0.45659$。\n\n比较这三个值：\nIndicator$_1 \\approx 1.31876$\nIndicator$_2 \\approx 1.25544$\nIndicator$_3 \\approx 0.45659$\n最大值是 Indicator$_1$，它对应于边 $e_1$。因此，应最密集加密的边的索引是 $k=1$。\n\n最终答案由四舍五入到4位有效数字的 $\\eta_K$ 数值和边索引 $k$ 组成。\n$\\eta_K \\approx 0.4671$\n$k = 1$\n这些将以一个 $1 \\times 2$ 行矩阵的形式报告。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.4671 & 1\n\\end{pmatrix}\n}\n$$", "id": "3325351"}, {"introduction": "在识别出需要调整分辨率的区域后，我们需要一种精确的语言来描述理想的网格尺寸和形状。黎曼度量张量 (Riemannian metric tensor) 正是实现这一目标的强大工具。在此练习中，你将使用在单元节点上给定的度量张量，来计算一个四面体单元中每条边的“度量长度”并评估其形状质量，从而将度量自适应的抽象概念转化为具体的数值计算 [@problem_id:3325366]。", "problem": "在计算流体动力学 (CFD) 中，基于梯度的网格自适应使用黎曼度量张量来控制各向异性分辨率。考虑一个四面体单元，其顶点标记为 $1$、$2$、$3$ 和 $4$，物理坐标为\n$$\n\\mathbf{x}_1 = (0, 0, 0), \\quad \\mathbf{x}_2 = (1, 0, 0), \\quad \\mathbf{x}_3 = (0.2, 1.1, 0), \\quad \\mathbf{x}_4 = (0, 0.3, 0.9).\n$$\n在每个顶点 $i$ 处，给定一个对称正定的黎曼度量张量 $M_i$，它代表了局部所需的分辨率，如下所示\n$$\nM_1 = \\begin{pmatrix}4 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 1\\end{pmatrix}, \\quad\nM_2 = \\begin{pmatrix}2.5 & 0 & 0 \\\\ 0 & 1.5 & 0 \\\\ 0 & 0 & 1\\end{pmatrix}, \\quad\nM_3 = \\begin{pmatrix}3 & 0 & 0 \\\\ 0 & 0.8 & 0 \\\\ 0 & 0 & 1.2\\end{pmatrix}, \\quad\nM_4 = \\begin{pmatrix}2 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 2.2\\end{pmatrix}.\n$$\n基于度量的长度的基本定义是，对于在点 $\\mathbf{x}$ 处向量为 $\\mathbf{v}$ 的边，其度量长度为 $\\ell(\\mathbf{x}) = \\sqrt{\\mathbf{v}^{\\mathsf{T}} M(\\mathbf{x}) \\mathbf{v}}$。对于连接节点 $i$ 和 $j$ 的边，通过算术平均来近似该边上的度量\n$$\nM_{ij} = \\frac{1}{2}\\left(M_i + M_j\\right).\n$$\n定义边质量函数 $q(\\ell) = \\exp\\!\\big(-|\\ln \\ell|\\big)$，该函数是无量纲的，当 $\\ell = 1$ 时达到最大值 $1$，并对称地惩罚大于和小于 $1$ 的偏差。对于该四面体，定义平均度量形状质量为\n$$\nQ_{\\mathrm{avg}} = \\frac{1}{6} \\sum_{(i,j) \\in \\mathcal{E}} q\\!\\left(\\ell_{ij}\\right),\n$$\n其中 $\\mathcal{E}$ 是六条边的集合，$\\ell_{ij} = \\sqrt{\\mathbf{v}_{ij}^{\\mathsf{T}} M_{ij} \\mathbf{v}_{ij}}$ 且 $\\mathbf{v}_{ij} = \\mathbf{x}_j - \\mathbf{x}_i$。\n\n按如下方式用索引枚举边：\n$$\n\\text{边 }1: (1,2), \\quad \\text{边 }2: (1,3), \\quad \\text{边 }3: (1,4), \\quad \\text{边 }4: (2,3), \\quad \\text{边 }5: (2,4), \\quad \\text{边 }6: (3,4).\n$$\n\n从上述基本定义出发，计算 $Q_{\\mathrm{avg}}$ 并找出六条边中 $q(\\ell_{ij})$ 值最小的最差边。将平均质量表示为一个无量纲数，并四舍五入到四位有效数字。将最终答案表示为一个包含两个条目的行矩阵，第一个条目是 $Q_{\\mathrm{avg}}$（无量纲，四舍五入到四位有效数字），第二个条目是根据上述枚举的最差边的整数索引。最终答案中不需要物理单位。", "solution": "该问题经验证在科学上是有根据的、适定的、客观的和完整的。唯一解所需的所有数据和定义都已提供。其背景，即CFD中基于梯度的网格自适应，是一个合理的研究领域，黎曼度量的使用是一种标准技术。所提供的度量张量按要求是对称正定的。该问题是所给定义的一个直接应用，需要进行系统性计算。\n\n任务是为一个给定的四面体计算平均度量形状质量 $Q_{\\mathrm{avg}}$，并找出质量最低的边。计算过程将通过评估四面体六条边中每一条的质量，然后对这些值进行平均。\n\n四面体的顶点由下式给出：\n$$\n\\mathbf{x}_1 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad \\mathbf{x}_2 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad \\mathbf{x}_3 = \\begin{pmatrix} 0.2 \\\\ 1.1 \\\\ 0 \\end{pmatrix}, \\quad \\mathbf{x}_4 = \\begin{pmatrix} 0 \\\\ 0.3 \\\\ 0.9 \\end{pmatrix}.\n$$\n每个顶点 $i$ 处的黎曼度量张量为 $M_i$。对于连接顶点 $i$ 和 $j$ 的边，边向量为 $\\mathbf{v}_{ij} = \\mathbf{x}_j - \\mathbf{x}_i$，度量张量通过算术平均近似为 $M_{ij} = \\frac{1}{2}(M_i + M_j)$。边的度量长度为 $\\ell_{ij} = \\sqrt{\\mathbf{v}_{ij}^{\\mathsf{T}} M_{ij} \\mathbf{v}_{ij}}$。由于所有给定的度量张量 $M_i$ 都是对角矩阵，所以平均度量 $M_{ij}$ 也是对角矩阵。对于一个对角度量 $M = \\mathrm{diag}(m_{11}, m_{22}, m_{33})$ 和一个向量 $\\mathbf{v} = (v_1, v_2, v_3)^{\\mathsf{T}}$，其二次型简化为 $\\mathbf{v}^{\\mathsf{T}} M \\mathbf{v} = m_{11}v_1^2 + m_{22}v_2^2 + m_{33}v_3^2$。\n\n边的质量由 $q(\\ell) = \\exp(-|\\ln \\ell|)$ 给出。这也可以写成 $q(\\ell) = \\min(\\ell, 1/\\ell)$。如果 $\\ell \\ge 1$，则 $q(\\ell) = 1/\\ell$。如果 $0 < \\ell < 1$，则 $q(\\ell) = \\ell$。最差的边是质量 $q(\\ell_{ij})$ 最小的边，它对应于与理想值 $1$ 偏差最大的度量长度 $\\ell_{ij}$。\n\n我们现在计算六条边中每一条的质量。\n\n**边 1: (1, 2)**\n$\\mathbf{v}_{12} = \\mathbf{x}_2 - \\mathbf{x}_1 = (1, 0, 0)^{\\mathsf{T}}$。\n$M_{12} = \\frac{1}{2}(M_1 + M_2) = \\frac{1}{2}\\left(\\begin{pmatrix}4 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 1\\end{pmatrix} + \\begin{pmatrix}2.5 & 0 & 0 \\\\ 0 & 1.5 & 0 \\\\ 0 & 0 & 1\\end{pmatrix}\\right) = \\begin{pmatrix}3.25 & 0 & 0 \\\\ 0 & 1.25 & 0 \\\\ 0 & 0 & 1\\end{pmatrix}$。\n$\\ell_{12}^2 = \\mathbf{v}_{12}^{\\mathsf{T}} M_{12} \\mathbf{v}_{12} = 3.25 \\cdot 1^2 + 1.25 \\cdot 0^2 + 1 \\cdot 0^2 = 3.25$。\n$\\ell_{12} = \\sqrt{3.25} \\approx 1.80278$。由于 $\\ell_{12} > 1$，$q_{12} = 1/\\ell_{12} = 1/\\sqrt{3.25} \\approx 0.554708$。\n\n**边 2: (1, 3)**\n$\\mathbf{v}_{13} = \\mathbf{x}_3 - \\mathbf{x}_1 = (0.2, 1.1, 0)^{\\mathsf{T}}$。\n$M_{13} = \\frac{1}{2}(M_1 + M_3) = \\frac{1}{2}\\left(\\begin{pmatrix}4 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 1\\end{pmatrix} + \\begin{pmatrix}3 & 0 & 0 \\\\ 0 & 0.8 & 0 \\\\ 0 & 0 & 1.2\\end{pmatrix}\\right) = \\begin{pmatrix}3.5 & 0 & 0 \\\\ 0 & 0.9 & 0 \\\\ 0 & 0 & 1.1\\end{pmatrix}$。\n$\\ell_{13}^2 = 3.5 \\cdot (0.2)^2 + 0.9 \\cdot (1.1)^2 = 3.5 \\cdot 0.04 + 0.9 \\cdot 1.21 = 0.14 + 1.089 = 1.229$。\n$\\ell_{13} = \\sqrt{1.229} \\approx 1.10860$。由于 $\\ell_{13} > 1$，$q_{13} = 1/\\ell_{13} = 1/\\sqrt{1.229} \\approx 0.902054$。\n\n**边 3: (1, 4)**\n$\\mathbf{v}_{14} = \\mathbf{x}_4 - \\mathbf{x}_1 = (0, 0.3, 0.9)^{\\mathsf{T}}$。\n$M_{14} = \\frac{1}{2}(M_1 + M_4) = \\frac{1}{2}\\left(\\begin{pmatrix}4 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 1\\end{pmatrix} + \\begin{pmatrix}2 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 2.2\\end{pmatrix}\\right) = \\begin{pmatrix}3 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 1.6\\end{pmatrix}$。\n$\\ell_{14}^2 = 1 \\cdot (0.3)^2 + 1.6 \\cdot (0.9)^2 = 1 \\cdot 0.09 + 1.6 \\cdot 0.81 = 0.09 + 1.296 = 1.386$。\n$\\ell_{14} = \\sqrt{1.386} \\approx 1.17728$。由于 $\\ell_{14} > 1$，$q_{14} = 1/\\ell_{14} = 1/\\sqrt{1.386} \\approx 0.849416$。\n\n**边 4: (2, 3)**\n$\\mathbf{v}_{23} = \\mathbf{x}_3 - \\mathbf{x}_2 = (-0.8, 1.1, 0)^{\\mathsf{T}}$。\n$M_{23} = \\frac{1}{2}(M_2 + M_3) = \\frac{1}{2}\\left(\\begin{pmatrix}2.5 & 0 & 0 \\\\ 0 & 1.5 & 0 \\\\ 0 & 0 & 1\\end{pmatrix} + \\begin{pmatrix}3 & 0 & 0 \\\\ 0 & 0.8 & 0 \\\\ 0 & 0 & 1.2\\end{pmatrix}\\right) = \\begin{pmatrix}2.75 & 0 & 0 \\\\ 0 & 1.15 & 0 \\\\ 0 & 0 & 1.1\\end{pmatrix}$。\n$\\ell_{23}^2 = 2.75 \\cdot (-0.8)^2 + 1.15 \\cdot (1.1)^2 = 2.75 \\cdot 0.64 + 1.15 \\cdot 1.21 = 1.76 + 1.3915 = 3.1515$。\n$\\ell_{23} = \\sqrt{3.1515} \\approx 1.77525$。由于 $\\ell_{23} > 1$，$q_{23} = 1/\\ell_{23} = 1/\\sqrt{3.1515} \\approx 0.563302$。\n\n**边 5: (2, 4)**\n$\\mathbf{v}_{24} = \\mathbf{x}_4 - \\mathbf{x}_2 = (-1, 0.3, 0.9)^{\\mathsf{T}}$。\n$M_{24} = \\frac{1}{2}(M_2 + M_4) = \\frac{1}{2}\\left(\\begin{pmatrix}2.5 & 0 & 0 \\\\ 0 & 1.5 & 0 \\\\ 0 & 0 & 1\\end{pmatrix} + \\begin{pmatrix}2 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 2.2\\end{pmatrix}\\right) = \\begin{pmatrix}2.25 & 0 & 0 \\\\ 0 & 1.25 & 0 \\\\ 0 & 0 & 1.6\\end{pmatrix}$。\n$\\ell_{24}^2 = 2.25 \\cdot (-1)^2 + 1.25 \\cdot (0.3)^2 + 1.6 \\cdot (0.9)^2 = 2.25 + 1.25 \\cdot 0.09 + 1.6 \\cdot 0.81 = 2.25 + 0.1125 + 1.296 = 3.6585$。\n$\\ell_{24} = \\sqrt{3.6585} \\approx 1.91272$。由于 $\\ell_{24} > 1$，$q_{24} = 1/\\ell_{24} = 1/\\sqrt{3.6585} \\approx 0.522818$。\n\n**边 6: (3, 4)**\n$\\mathbf{v}_{34} = \\mathbf{x}_4 - \\mathbf{x}_3 = (-0.2, -0.8, 0.9)^{\\mathsf{T}}$。\n$M_{34} = \\frac{1}{2}(M_3 + M_4) = \\frac{1}{2}\\left(\\begin{pmatrix}3 & 0 & 0 \\\\ 0 & 0.8 & 0 \\\\ 0 & 0 & 1.2\\end{pmatrix} + \\begin{pmatrix}2 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 2.2\\end{pmatrix}\\right) = \\begin{pmatrix}2.5 & 0 & 0 \\\\ 0 & 0.9 & 0 \\\\ 0 & 0 & 1.7\\end{pmatrix}$。\n$\\ell_{34}^2 = 2.5 \\cdot (-0.2)^2 + 0.9 \\cdot (-0.8)^2 + 1.7 \\cdot (0.9)^2 = 2.5 \\cdot 0.04 + 0.9 \\cdot 0.64 + 1.7 \\cdot 0.81 = 0.1 + 0.576 + 1.377 = 2.053$。\n$\\ell_{34} = \\sqrt{2.053} \\approx 1.43283$。由于 $\\ell_{34} > 1$，$q_{34} = 1/\\ell_{34} = 1/\\sqrt{2.053} \\approx 0.697914$。\n\n现在，我们对质量求和：\n$\\sum_{(i,j) \\in \\mathcal{E}} q(\\ell_{ij}) = q_{12} + q_{13} + q_{14} + q_{23} + q_{24} + q_{34}$\n$\\sum q_{ij} \\approx 0.554708 + 0.902054 + 0.849416 + 0.563302 + 0.522818 + 0.697914 = 4.090212$。\n\n平均质量为：\n$Q_{\\mathrm{avg}} = \\frac{1}{6} \\sum q_{ij} = \\frac{4.090212}{6} \\approx 0.681702$。\n四舍五入到四位有效数字，$Q_{\\mathrm{avg}} \\approx 0.6817$。\n\n为了找到最差的边，我们找出最小的质量值：\n$q_1 \\approx 0.5547$\n$q_2 \\approx 0.9021$\n$q_3 \\approx 0.8494$\n$q_4 \\approx 0.5633$\n$q_5 \\approx 0.5228$\n$q_6 \\approx 0.6979$\n最小质量为 $q_5 \\approx 0.522818$，对应于边5。因此，最差边的索引为 $5$。\n\n最终答案由四舍五入后的平均质量和最差边的索引组成。", "answer": "$$\n\\boxed{\\begin{pmatrix} 0.6817 & 5 \\end{pmatrix}}\n$$", "id": "3325366"}, {"introduction": "在真实的计算流体动力学（CFD）求解器中，数值格式为了保证解的稳定性和物理真实性（例如，防止在极值点附近产生新的伪振荡），常常需要对梯度进行修正或“限制”。本练习探讨了这种梯度限制对网格自适应策略的深远影响。你将发现，在一个局部极值点，为了维持单调性，求解器计算出的“有效”梯度可能为零，这会错误地引导一个简单的自适应算法认为该区域不需要加密，从而揭示了在实际应用中一个关键的挑战 [@problem_id:3325297]。", "problem": "考虑一个计算流体力学背景下的二维有限体积单元，其形心位于原点 $(x,y)=(0,0)$。设标量守恒变量 $u$ 满足标量守恒律 $\\partial_{t} u + \\nabla \\cdot \\mathbf{F}(u) = 0$，其中 $\\mathbf{F}(u)$ 是一个可微的通量函数。在有限体积重构中，形心处的单元中心值 $u_{P}$ 在其邻域内使用线性重构 $u(\\mathbf{r}) \\approx u_{P} + \\nabla u \\cdot \\mathbf{r}$ 进行近似，其中 $\\nabla u$ 是单元上的常数梯度，$\\mathbf{r}$ 表示相对于形心的位置向量。无约束梯度 $\\nabla u$ 是通过最小二乘拟合计算得出的，该拟合在单元的邻近模板 $\\{\\mathbf{r}_{i}, u_{i}\\}$ 上（权重相等）最小化关系式 $u_{i} - u_{P} \\approx \\nabla u \\cdot \\mathbf{r}_{i}$ 的残差平方和。\n\n给定模板的相邻单元形心位置和单元中心值：\n- $\\mathbf{r}_{1} = (1,0)$，$u_{1} = 1.6$，\n- $\\mathbf{r}_{2} = (0,1)$，$u_{2} = 1.7$，\n- $\\mathbf{r}_{3} = (-1,0)$，$u_{3} = 1.8$，\n- $\\mathbf{r}_{4} = (0,-1)$，$u_{4} = 1.9$，\n以及目标单元的中心值 $u_{P} = 2.0$。\n\n一个极值检测器已将目标单元标记为局部最大值，即对于所有模板点，$u_{P} \\geq u_{i}$。为了强制执行与单调性一致的离散极值原理，引入一个标量限制器 $\\phi \\in [0,1]$ 并定义限制梯度 $\\nabla u^{\\ell} = \\phi \\nabla u_{\\mathrm{ls}}$，其中 $\\nabla u_{\\mathrm{ls}}$ 表示最小二乘梯度。必须选择限制器以确保在相邻单元形心处的重构值保持在模板界限内，即对于所有的 $i$ 都有 $u_{P} + \\phi \\, \\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_{i} \\in [u_{\\min}, u_{\\max}]$，其中 $u_{\\min} = \\min\\{u_{P}, u_{1}, u_{2}, u_{3}, u_{4}\\}$ 且 $u_{\\max} = \\max\\{u_{P}, u_{1}, u_{2}, u_{3}, u_{4}\\}$。\n\n使用这些数据和约束：\n1. 计算无约束的最小二乘梯度 $\\nabla u_{\\mathrm{ls}}$。\n2. 确定满足所有模板点单调性约束的最大 $\\phi \\in [0,1]$。\n3. 计算限制梯度 $\\nabla u^{\\ell}$。\n\n将最终的限制梯度分量以无量纲单位表示为一个行向量。无需四舍五入。此外，在您的解答中，讨论在检测到的极值点处限制梯度对于构建基于梯度的网格自适应度量的影响，并将其与基于Hessian矩阵的方法进行对比，从插值误差控制应与 $u$ 的局部光滑度一致这一基本要求出发。", "solution": "对用户提供的问题进行有效性评估。\n\n### 步骤1：提取已知条件\n- **控制方程**：标量守恒变量 $u$ 满足守恒律 $\\partial_{t} u + \\nabla \\cdot \\mathbf{F}(u) = 0$。\n- **单元几何**：一个二维有限体积单元，其形心位于原点 $(x,y)=(0,0)$。\n- **线性重构**：单元中心值 $u_{P}$ 在单元内近似为 $u(\\mathbf{r}) \\approx u_{P} + \\nabla u \\cdot \\mathbf{r}$，其中 $\\mathbf{r}$ 是从单元形心出发的位置向量。\n- **梯度计算**：无约束梯度 $\\nabla u$ 通过最小二乘拟合计算，该拟合在权重相等的邻近模板 $\\{\\mathbf{r}_{i}, u_{i}\\}$ 上最小化 $u_{i} - u_{P} \\approx \\nabla u \\cdot \\mathbf{r}_{i}$ 的残差平方和。\n- **模板数据**：\n    - 邻居1：$\\mathbf{r}_{1} = (1,0)$，$u_{1} = 1.6$。\n    - 邻居2：$\\mathbf{r}_{2} = (0,1)$，$u_{2} = 1.7$。\n    - 邻居3：$\\mathbf{r}_{3} = (-1,0)$，$u_{3} = 1.8$。\n    - 邻居4：$\\mathbf{r}_{4} = (0,-1)$，$u_{4} = 1.9$。\n- **目标单元数据**：$u_{P} = 2.0$。\n- **极值条件**：目标单元是一个局部最大值，对所有模板点 $i$ 满足 $u_{P} \\geq u_{i}$。\n- **梯度限制**：限制梯度为 $\\nabla u^{\\ell} = \\phi \\nabla u_{\\mathrm{ls}}$，其中 $\\nabla u_{\\mathrm{ls}}$ 是最小二乘梯度，$\\phi \\in [0,1]$ 是一个标量限制器。\n- **单调性约束**：限制器 $\\phi$ 必须确保在相邻单元形心处的重构值 $u(\\mathbf{r}_{i}) = u_{P} + \\phi \\, \\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_{i}$ 保持在界限 $[u_{\\min}, u_{\\max}]$ 内。\n- **模板界限**：$u_{\\min} = \\min\\{u_{P}, u_{1}, u_{2}, u_{3}, u_{4}\\}$ 且 $u_{\\max} = \\max\\{u_{P}, u_{1}, u_{2}, u_{3}, u_{4}\\}$。\n- **任务**：\n    1. 计算无约束的最小二乘梯度 $\\nabla u_{\\mathrm{ls}}$。\n    2. 确定满足单调性约束的最大 $\\phi \\in [0,1]$。\n    3. 计算限制梯度 $\\nabla u^{\\ell}$。\n    4. 讨论限制梯度对基于梯度的网格自适应的影响。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题描述了标准的 Barth-Jespersen 限制器过程，这是有限体积法中一种成熟的技术，用于在二阶重构中强制执行单调性。使用最小二乘法计算梯度也是一种标准做法。这些原理在科学上是合理的，并且是计算流体力学领域的核心内容。\n- **适定性**：该问题提供了计算梯度和限制器的唯一解所需的所有数据和约束。数据是自洽的；给定值满足条件 $u_P \\geq u_i$（$2.0 \\ge \\{1.6, 1.7, 1.8, 1.9\\}$）。\n- **客观性**：该问题使用精确、客观的数学和技术术语进行陈述。\n\n### 步骤3：结论与行动\n该问题是有效的。它具有科学依据、适定且客观。将提供完整的解答。\n\n### 第1部分：计算无约束最小二乘梯度 $\\nabla u_{\\mathrm{ls}}$\n设无约束梯度为 $\\nabla u_{\\mathrm{ls}} = (g_x, g_y)$。目标是找到最小化残差平方和 $S$ 的 $(g_x, g_y)$：\n$$S(g_x, g_y) = \\sum_{i=1}^{4} \\left( (\\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_i) - (u_i - u_P) \\right)^2 = \\sum_{i=1}^{4} \\left( g_x x_i + g_y y_i - (u_i - u_P) \\right)^2$$\n为最小化 $S$，我们将其关于 $g_x$ 和 $g_y$ 的偏导数设为零：\n$$ \\frac{\\partial S}{\\partial g_x} = 2 \\sum_{i=1}^{4} \\left( g_x x_i + g_y y_i - (u_i - u_P) \\right) x_i = 0 $$\n$$ \\frac{\\partial S}{\\partial g_y} = 2 \\sum_{i=1}^{4} \\left( g_x x_i + g_y y_i - (u_i - u_P) \\right) y_i = 0 $$\n这导出了正规方程组，一个关于 $(g_x, g_y)$ 的线性方程组：\n$$ \\begin{pmatrix} \\sum x_i^2 & \\sum x_i y_i \\\\ \\sum x_i y_i & \\sum y_i^2 \\end{pmatrix} \\begin{pmatrix} g_x \\\\ g_y \\end{pmatrix} = \\begin{pmatrix} \\sum x_i (u_i - u_P) \\\\ \\sum y_i (u_i - u_P) \\end{pmatrix} $$\n首先，我们计算矩阵的系数。相邻位置为 $\\mathbf{r}_{1} = (1,0)$，$\\mathbf{r}_{2} = (0,1)$，$\\mathbf{r}_{3} = (-1,0)$ 和 $\\mathbf{r}_{4} = (0,-1)$。\n$$ \\sum x_i^2 = 1^2 + 0^2 + (-1)^2 + 0^2 = 2 $$\n$$ \\sum y_i^2 = 0^2 + 1^2 + 0^2 + (-1)^2 = 2 $$\n$$ \\sum x_i y_i = (1)(0) + (0)(1) + (-1)(0) + (0)(-1) = 0 $$\n由于模板位置的正交性，系统矩阵是对角矩阵。\n接下来，我们计算右侧向量。差值 $u_i - u_P$ 为：\n- $u_1 - u_P = 1.6 - 2.0 = -0.4$\n- $u_2 - u_P = 1.7 - 2.0 = -0.3$\n- $u_3 - u_P = 1.8 - 2.0 = -0.2$\n- $u_4 - u_P = 1.9 - 2.0 = -0.1$\n和为：\n$$ \\sum x_i (u_i - u_P) = (1)(-0.4) + (0)(-0.3) + (-1)(-0.2) + (0)(-0.1) = -0.4 + 0.2 = -0.2 $$\n$$ \\sum y_i (u_i - u_P) = (0)(-0.4) + (1)(-0.3) + (0)(-0.2) + (-1)(-0.1) = -0.3 + 0.1 = -0.2 $$\n线性系统为：\n$$ \\begin{pmatrix} 2 & 0 \\\\ 0 & 2 \\end{pmatrix} \\begin{pmatrix} g_x \\\\ g_y \\end{pmatrix} = \\begin{pmatrix} -0.2 \\\\ -0.2 \\end{pmatrix} $$\n求解 $g_x$ 和 $g_y$：\n$$ 2g_x = -0.2 \\implies g_x = -0.1 $$\n$$ 2g_y = -0.2 \\implies g_y = -0.1 $$\n因此，无约束最小二乘梯度为 $\\nabla u_{\\mathrm{ls}} = (-0.1, -0.1)$。\n\n### 第2部分：确定最大限制器 $\\phi$\n单调性约束要求在每个相邻单元形心处的重构值 $u(\\mathbf{r}_i) = u_{P} + \\phi \\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_i$ 位于范围 $[u_{\\min}, u_{\\max}]$ 内。\n首先，我们从给定的模板数据 $\\{2.0, 1.6, 1.7, 1.8, 1.9\\}$ 确定界限：\n$$ u_{\\min} = 1.6 $$\n$$ u_{\\max} = 2.0 $$\n约束为 $1.6 \\le u(\\mathbf{r}_i) \\le 2.0$。代入 $u_P = 2.0$，这变为：\n$$ 1.6 \\le 2.0 + \\phi \\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_i \\le 2.0 $$\n这可以简化为两个不等式：\n1. $2.0 + \\phi \\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_i \\le 2.0 \\implies \\phi \\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_i \\le 0$\n2. $1.6 \\le 2.0 + \\phi \\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_i \\implies -0.4 \\le \\phi \\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_i$\n我们为每个相邻单元计算 $\\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_i$：\n- $\\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_1 = (-0.1)(1) + (-0.1)(0) = -0.1$\n- $\\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_2 = (-0.1)(0) + (-0.1)(1) = -0.1$\n- $\\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_3 = (-0.1)(-1) + (-0.1)(0) = 0.1$\n- $\\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_4 = (-0.1)(0) + (-0.1)(-1) = 0.1$\n\n我们寻求满足所有 $i=1, 2, 3, 4$ 约束的最大 $\\phi \\in [0,1]$。\n- 对于 $i=1$：$\\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_1 = -0.1$。\n    - 约束1：$\\phi(-0.1) \\le 0$，这对 $\\phi \\ge 0$ 成立。\n    - 约束2：$-0.4 \\le \\phi(-0.1)$，即 $0.4 \\ge 0.1\\phi$，所以 $\\phi \\le 4$。\n    - 对于 $i=1$ 的净约束是 $0 \\le \\phi \\le 4$。\n- 对于 $i=2$：$\\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_2 = -0.1$。\n    - 约束与 $i=1$ 的情况相同，得出 $0 \\le \\phi \\le 4$。\n- 对于 $i=3$：$\\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_3 = 0.1$。\n    - 约束1：$\\phi(0.1) \\le 0$。因为 $\\phi \\ge 0$，这要求 $\\phi \\le 0$。\n    - 约束2：$-0.4 \\le \\phi(0.1)$，即 $\\phi \\ge -4$。\n    - 对于 $i=3$ 的净约束是 $\\phi=0$。\n- 对于 $i=4$：$\\nabla u_{\\mathrm{ls}} \\cdot \\mathbf{r}_4 = 0.1$。\n    - 约束与 $i=3$ 的情况相同，得出 $\\phi=0$。\n\n为了同时满足所有相邻单元的约束，我们必须取最严格的条件。在区间 $[0,1]$ 内，同时满足 $\\phi \\le 4$ 和 $\\phi=0$ 的最大值 $\\phi$ 是 $\\phi = 0$。\n其物理解释是，无约束线性重构 $u(\\mathbf{r}) = 2.0 - 0.1 x - 0.1 y$ 会产生值 $u(\\mathbf{r}_3) = 2.1$ 和 $u(\\mathbf{r}_4)=2.1$，这些值大于 $u_{\\max} = 2.0$。这种新的、虚假的极值的产生违反了离散极值原理。为防止这种情况，必须将梯度完全展平，这对应于设置 $\\phi=0$。\n\n### 第3部分：计算限制梯度 $\\nabla u^{\\ell}$\n限制梯度由 $\\nabla u^{\\ell} = \\phi \\nabla u_{\\mathrm{ls}}$ 给出。使用前面部分的结果：\n$$ \\nabla u^{\\ell} = (0) \\times (-0.1, -0.1) = (0, 0) $$\n限制梯度是零向量。\n\n### 讨论：对基于梯度的网格自适应的影响\n在检测到的局部极值点处，结果 $\\nabla u^{\\ell} = (0,0)$ 对基于梯度的网格自适应具有深远的影响。网格自适应技术旨在通过在解误差高的区域加密计算网格、在其他地方粗化网格来提高解的精度。误差通常使用从计算解中导出的度量（或传感器）来估计。\n\n一种常见且简单的自适应度量是基于解的梯度大小 $|\\nabla u|$。其策略是在 $|\\nabla u|$ 大的区域加密网格，以更好地解析剧烈变化。然而，如果有人天真地使用流动求解器重构出的*限制*梯度 $\\nabla u^{\\ell}$ 作为自适应度量，将会出现严重的逻辑缺陷。如前所示，在局部极值点，数值格式所要求的单调性强制使 $\\nabla u^{\\ell}$ 为零。因此，一个基于梯度的度量会把这个区域解释为已完全解析，不需要加密。这从根本上是错误的，因为极值是解的关键特征，在这些地方，虽然梯度为零，但底层函数表现出显著的曲率。未能在极值点加密会导致对解的峰、谷和涡的表达不佳。\n\n这凸显了稳定数值离散化（可能需要限制）的需求与网格自适应的精确误差估计需求之间的冲突。函数 $u$ 在极值点附近的局部光滑度不是由其一阶导数表征，而是由其二阶导数表征，这些二阶导数封装在Hessian矩阵 $H(u)$ 中。对于分段线性近似，插值误差与 $h^2|H(u)|$ 成正比，其中 $h$ 是网格尺寸。\n\n因此，一个鲁棒的网格自适应策略必须与插值误差的行为一致。在这方面，基于Hessian矩阵的自适应度量在概念上更为优越，它们是根据解的二阶导数的估计值构建的。一个基于Hessian矩阵的度量会正确识别出此问题中极值点处的大曲率——即使梯度为零——并触发网格加密。这确保了局部插值误差得到控制，并且重要的物理特征不会因分辨率不足而被平滑掉或产生混叠。相比之下，依赖于限制梯度的方案对这些特征是“盲目”的，因此不能作为通用自适应策略的充分基础。", "answer": "$$\n\\boxed{\n\\begin{pmatrix} 0 & 0 \\end{pmatrix}\n}\n$$", "id": "3325297"}]}