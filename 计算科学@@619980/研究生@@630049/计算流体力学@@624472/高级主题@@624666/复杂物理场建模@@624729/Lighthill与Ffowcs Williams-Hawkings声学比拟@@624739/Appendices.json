{"hands_on_practices": [{"introduction": "本练习在通用的福克斯·威廉姆斯-霍金斯（Ffowcs Williams-Hawkings, FW-H）理论与经典声学之间架起了一座桥梁。我们将利用FW-H方程中的“厚度”项，该项代表因运动表面排开流体而产生的声音。通过将其应用于一个简单的脉动球体，并证明其能重现众所周知的单极子声源解，我们可以为FW-H项的物理意义建立坚实的直觉，并在一个简单、易于理解的情境中验证更复杂的FW-H公式。", "problem": "一个平均半径为 $a$ 的刚性球体，嵌入在环境密度为 $\\rho_0$、声速为 $c_0$ 的静止、无粘性、可压缩流体中。该球体进行小振幅、空间均匀的径向脉动，其表面位移由 $\\xi(t)=\\xi_0 \\sin(\\omega t)$ 描述，其中 $\\xi_0 \\ll a$。假设声场是线性的，球体是声学紧致的，因此 $ka \\ll 1$（其中 $k=\\omega/c_0$，波长为 $\\lambda=2\\pi/k$），并且观测点位于远场，距离球心 $r \\gg a$。仅使用 Ffowcs Williams–Hawkings (FW–H) 声学比拟的厚度项，在所述假设下，推导由脉动引起的、在观测点处的辐射声压 $p'(r,t)$ 的主阶表达式。然后，将此表达式与从球体体积速度得到的经典紧致单极子解进行比较，并说明它们是否一致。\n\n将声压的最终答案以帕斯卡表示。不提供数值；给出仅含 $\\rho_0$、$a$、$r$、$c_0$、$\\xi_0$ 和 $\\omega$ 的单个闭式解析表达式。如果引入了推迟时间，请明确定义它。不需要四舍五入。", "solution": "问题陈述被评估为有效。它提出了一个在经典声学和气动声学领域中适定、有科学依据的问题。其前提在物理上是一致的，并且提供了推导唯一、有意义解所需的数据和条件。该问题是客观的，并使用了该领域的标准术语和假设。\n\n该问题要求从 Ffowcs Williams–Hawkings (FW–H) 比拟的厚度项推导脉动球体辐射的声压。FW–H 方程是质量守恒和动量守恒定律到非齐次波动方程的精确重排。声压扰动 $p'(\\mathbf{x}, t) = p(\\mathbf{x}, t) - p_0$ 的通解由三个积分项之和给出，分别代表厚度（单极子）、载荷（偶极子）和四极子声源。\n\n我们被要求仅使用厚度项，该项解释了由表面运动引起的流体位移。对于在时间 $t$ 位于位置 $\\mathbf{x}$ 的观测者，该项由下式给出：\n$$\np'_{T}(\\mathbf{x}, t) = \\frac{1}{4\\pi} \\frac{\\partial}{\\partial t} \\int_{S} \\left[ \\frac{\\rho_0 v_n}{r_s |1 - M_r|} \\right]_{\\tau} dS(\\mathbf{y})\n$$\n此处，$S$ 是物体表面，$\\mathbf{y}$ 是表面上的一点，$v_n$ 是垂直于表面的局部法向速度（定义为向外为正），$\\rho_0$ 是环境流体密度，$r_s = |\\mathbf{x} - \\mathbf{y}|$ 是从声源点到观测者的距离，$M_r$ 是表面在观测者方向上的马赫数，符号 $[\\cdot]_{\\tau}$ 表示方括号内的量在推迟时间 $\\tau = t - r_s/c_0$ 处取值，其中 $c_0$ 是声速。\n\n问题陈述了几个简化条件：\n1.  流体是静止的，意味着没有背景流动，因此球体表面相对于流体的运动就是其绝对运动。球体没有平移，所以其表面马赫数 $M_r$ 为零。\n2.  观测者在远场，所以 $r \\gg a$，其中 $r$ 是从球心到观测者的距离。这允许我们近似 $r_s = |\\mathbf{x} - \\mathbf{y}| \\approx r$。因此我们可以将因子 $1/r_s$ 移到积分外，变为 $1/r$。\n3.  球体是声学紧致的（$ka \\ll 1$，其中 $k = \\omega/c_0$）。这证明了将表面上所有点的推迟时间用基于球心的单个值来近似是合理的：$\\tau = t - r/c_0$。\n\n应用这些简化，厚度项简化为：\n$$\np'(r, t) \\approx \\frac{1}{4\\pi r} \\frac{\\partial}{\\partial t} \\int_{S} \\left[ \\rho_0 v_n \\right]_{\\tau} dS(\\mathbf{y})\n$$\n其中 $\\tau = t - r/c_0$。\n\n球体进行空间均匀的径向脉动，其表面位移由 $\\xi(t) = \\xi_0 \\sin(\\omega t)$ 描述。表面速度 $v_n$ 是该位移的时间导数：\n$$\nv_n(t) = \\frac{d\\xi}{dt} = \\frac{d}{dt} (\\xi_0 \\sin(\\omega t)) = \\xi_0 \\omega \\cos(\\omega t)\n$$\n由于脉动是均匀的，在任何给定时刻，$v_n$ 在整个表面 $S$ 上都是恒定的。我们可以将其和恒定的环境密度 $\\rho_0$ 从积分中提出：\n$$\np'(r, t) \\approx \\frac{\\rho_0}{4\\pi r} \\frac{\\partial}{\\partial t} \\left[ v_n(t) \\right]_{\\tau} \\int_{S} dS\n$$\n该积分是球体的表面积，即 $4\\pi a^2$。\n$$\np'(r, t) \\approx \\frac{\\rho_0 (4\\pi a^2)}{4\\pi r} \\frac{\\partial}{\\partial t} \\left[ v_n(t) \\right]_{\\tau} = \\frac{\\rho_0 a^2}{r} \\frac{\\partial}{\\partial t} v_n(\\tau)\n$$\n将 $v_n$ 的表达式代入，并在推迟时间 $\\tau = t - r/c_0$ 处求值：\n$$\np'(r, t) = \\frac{\\rho_0 a^2}{r} \\frac{\\partial}{\\partial t} \\left( \\xi_0 \\omega \\cos(\\omega(t - r/c_0)) \\right)\n$$\n使用链式法则进行时间微分：\n$$\n\\frac{\\partial}{\\partial t} \\left( \\xi_0 \\omega \\cos(\\omega(t - r/c_0)) \\right) = \\xi_0 \\omega \\left( -\\sin(\\omega(t - r/c_0)) \\cdot \\omega \\right) = -\\xi_0 \\omega^2 \\sin(\\omega(t - r/c_0))\n$$\n将此代回，得到声压的最终表达式：\n$$\np'(r, t) = \\frac{\\rho_0 a^2}{r} \\left( -\\xi_0 \\omega^2 \\sin(\\omega(t - r/c_0)) \\right) = - \\frac{\\rho_0 a^2 \\xi_0 \\omega^2}{r} \\sin\\left(\\omega \\left(t - \\frac{r}{c_0}\\right)\\right)\n$$\n\n问题接下来要求将此表达式与经典紧致单极子解进行比较。一个紧致脉动球体是声学单极子或简单源的典型例子。简单源的声场可以用一个速度势 $\\phi$ 来描述，它产生一个球对称的出射波，$\\phi(r,t) = f(t-r/c_0)/r$。声压为 $p' = \\rho_0 \\partial \\phi / \\partial t$，径向速度为 $u_r = -\\partial \\phi / \\partial r$。\n\n边界条件是球体表面的流体速度与表面速度相匹配：$u_r(a,t) = v_n(t)$。对于一个紧致源（$ka \\ll 1$），速度表达式中的近场项占主导，因此 $u_r(a,t) \\approx f(t)/a^2$。因此，$f(t) \\approx a^2 v_n(t) = a^2 \\xi_0 \\omega \\cos(\\omega t)$。\n远场压力由下式给出：\n$$\np'(r,t) = \\rho_0 \\frac{\\partial \\phi}{\\partial t} = \\frac{\\rho_0}{r} f'(t-r/c_0)\n$$\n我们通过对 $f(t)$ 求导来找到 $f'(t)$：\n$$\nf'(t) = \\frac{d}{dt}(a^2 \\xi_0 \\omega \\cos(\\omega t)) = -a^2 \\xi_0 \\omega^2 \\sin(\\omega t)\n$$\n在推迟时间处计算该式，得到：\n$$\np'(r,t) = \\frac{\\rho_0}{r} \\left( -a^2 \\xi_0 \\omega^2 \\sin(\\omega(t-r/c_0)) \\right) = - \\frac{\\rho_0 a^2 \\xi_0 \\omega^2}{r} \\sin\\left(\\omega \\left(t - \\frac{r}{c_0}\\right)\\right)\n$$\n这个结果与从 FW–H 厚度项得到的结果完全相同。因此，当应用于紧致脉动体时，FW–H 比拟的厚度项正确地再现了经典的紧致单极子解。它们确实是一致的。辐射压力与表面加速度成正比，因此存在 $-\\sin$ 依赖关系，这与速度（$\\cos$）有 $90^\\circ$ 的相位差。\n推迟时间为 $\\tau = t - r/c_0$。\n\n声压的最终表达式为：\n$$\np'(r, t) = - \\frac{\\rho_0 a^2 \\xi_0 \\omega^2}{r} \\sin\\left(\\omega \\left(t - \\frac{r}{c_0}\\right)\\right)\n$$", "answer": "$$\n\\boxed{- \\frac{\\rho_0 a^2 \\xi_0 \\omega^2}{r} \\sin\\left(\\omega \\left(t - \\frac{r}{c_0}\\right)\\right)}\n$$", "id": "3288158"}, {"introduction": "在理解了理论之后，一个关键的实践步骤是为声学分析正确地从计算流体动力学（CFD）仿真中获取数据。该实践涉及应用奈奎斯特-香农采样定理，并结合多普勒效应，以确定所需的最短数据采样频率。这项练习解决了一个至关重要的现实世界挑战：确保您的CFD输出适用于福克斯·威廉姆斯-霍金斯（FW-H）求解器，防止混叠误差，并优化数据存储，将流体求解器的约束（如库朗数）与声学后处理器的需求直接联系起来。", "problem": "您的任务是设计一种算法，以确定对 Ffowcs Williams–Hawkings (FW–H) 评估获得的信号进行后处理所需的最小采样频率和采样间隔。目标是解析高达所需最大频率的声学内容，同时考虑所有观测器和声源运动下的最坏情况多普勒频移，并将采样要求与可压缩流求解器的 Courant–Friedrichs–Lewy (CFL) 时间步长联系起来。\n\n您必须基于以下基本原理，从第一性原理出发推导并实现以下逻辑：\n- Nyquist–Shannon 采样定理：为了解析频率高达 $f_{\\max}$ 的信号，需要采样频率 $f_s \\ge 2 f_{\\max}$。\n- 声学多普勒效应：观测到的频率乘以一个多普勒因子。设最大多普勒因子（在所有观测器和声源运动中）表示为 $\\mathcal{D}_{\\max}$，假设其由声源和观测器的马赫数定义为 $\\mathcal{D} = \\dfrac{1 + M_{o,r}}{1 - M_{s,r}}$，其中 $M_{o,r}$ 和 $M_{s,r}$ 分别是观测器和声源马赫数的径向分量。在此问题中，$\\mathcal{D}_{\\max}$ 作为输入直接提供。\n- 可压缩流的显式时间步进稳定性约束：求解器时间步长 $\\Delta t_{\\mathrm{CFD}}$ 由库朗数 $C$ 控制，通过 $\\Delta t_{\\mathrm{CFD}} = \\dfrac{C \\, \\Delta x}{a_{\\mathrm{char}}}$，其中 $\\Delta x$ 是网格间距，而 $a_{\\mathrm{char}}$ 是特征信号速度。对于移动介质中的声学问题，一个保守且标准的选择是 $a_{\\mathrm{char}} = c_0 + \\lvert U_{\\max} \\rvert$，即环境声速 $c_0$ 与最大流速大小 $\\lvert U_{\\max} \\rvert$ 之和。\n\n您的任务：\n1. 使用 Nyquist–Shannon 结果和多普勒缩放，确定最小采样频率 $f_{s,\\min}$，使得在最坏情况的多普勒频移后，观测信号中能解析出高达 $f_{\\max}$（在多普勒效应前于声源坐标系中测量）的内容。证明这可以推导出\n   $$ f_{s,\\min} = 2 \\, \\mathcal{D}_{\\max} \\, f_{\\max}. $$\n2. 确定仍然满足奈奎斯特界限的最大允许采样间隔 $\\Delta t_{\\mathrm{req}}$：\n   $$ \\Delta t_{\\mathrm{req}} = \\dfrac{1}{f_{s,\\min}}. $$\n3. 给定 $\\Delta t_{\\mathrm{CFD}} = \\dfrac{C \\, \\Delta x}{a_{\\mathrm{char}}}$，计算是否可以通过存储每第 $k$ 个 CFD 步（整数抽取因子 $k \\ge 1$）来满足采样要求。存储信号的采样间隔为 $\\Delta t_{\\mathrm{sample}} = k \\, \\Delta t_{\\mathrm{CFD}}$。定义\n   $$ k_{\\max} = \\left\\lfloor \\dfrac{\\Delta t_{\\mathrm{req}}}{\\Delta t_{\\mathrm{CFD}}} \\right\\rfloor. $$\n   如果 $k_{\\max} \\ge 1$，则对于任何满足 $1 \\le k \\le k_{\\max}$ 的整数 $k$，通过存储每第 $k$ 步来满足要求是可行的。如果 $k_{\\max} = 0$，即使存储每个 CFD 步，也无法满足要求。\n4. 为了将采样要求与库朗数直接关联，计算在存储每个 CFD 步（$k = 1$）的情况下足以满足奈奎斯特条件的最大库朗数 $C_{\\max}$：\n   $$ C_{\\max} = \\dfrac{a_{\\mathrm{char}}}{\\Delta x \\, f_{s,\\min}}. $$\n\n输入参数和单位：\n- $f_{\\max}$，单位为 Hz。\n- $\\mathcal{D}_{\\max}$，无量纲。\n- $\\Delta x$，单位为 m。\n- $c_0$，单位为 m/s。\n- $\\lvert U_{\\max} \\rvert$，单位为 m/s。\n- $C$，无量纲。\n\n每个测试用例需要计算的输出：\n- $f_{s,\\min}$，单位为 Hz。\n- $\\Delta t_{\\mathrm{req}}$，单位为 s。\n- $\\Delta t_{\\mathrm{CFD}}$，单位为 s。\n- $k_{\\max}$，为整数。\n- 一个可行性布尔值，指示 $k_{\\max} \\ge 1$ 是否成立。\n- $C_{\\max}$，无量纲。\n\n测试套件：\n为以下参数集提供结果（每行为一个独立的案例）：\n- 案例 A（通用亚音速，可进行充分抽取）：$f_{\\max} = 2000$ Hz, $\\mathcal{D}_{\\max} = 1.2$, $\\Delta x = 0.005$ m, $c_0 = 343$ m/s, $\\lvert U_{\\max} \\rvert = 50$ m/s, $C = 0.5$。\n- 案例 B（边界条件，存储每步时恰好满足奈奎斯特条件）：$f_{\\max} = 1000$ Hz, $\\mathcal{D}_{\\max} = 1.0$, $\\Delta x = 1.0$ m, $c_0 = 340$ m/s, $\\lvert U_{\\max} \\rvert = 10$ m/s, $C = 0.175$。\n- 案例 C（给定求解器步长下不可行，即使存储每一步）：$f_{\\max} = 5000$ Hz, $\\mathcal{D}_{\\max} = 1.3$, $\\Delta x = 0.04$ m, $c_0 = 343$ m/s, $\\lvert U_{\\max} \\rvert = 27$ m/s, $C = 0.8$。\n- 案例 D（通用亚音速，求解器步长很小，可进行大比例抽取）：$f_{\\max} = 800$ Hz, $\\mathcal{D}_{\\max} = 1.5$, $\\Delta x = 0.002$ m, $c_0 = 330$ m/s, $\\lvert U_{\\max} \\rvert = 20$ m/s, $C = 0.6$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果本身是按以下顺序排列的列表：\n$[f_{s,\\min}, \\Delta t_{\\mathrm{req}}, \\Delta t_{\\mathrm{CFD}}, k_{\\max}, \\text{feasible}, C_{\\max}]$。\n例如，两个假设案例的输出将如下所示：\n$[[f_{s,\\min}^{(1)}, \\Delta t_{\\mathrm{req}}^{(1)}, \\Delta t_{\\mathrm{CFD}}^{(1)}, k_{\\max}^{(1)}, \\text{True}, C_{\\max}^{(1)}],[f_{s,\\min}^{(2)}, \\Delta t_{\\mathrm{req}}^{(2)}, \\Delta t_{\\mathrm{CFD}}^{(2)}, k_{\\max}^{(2)}, \\text{False}, C_{\\max}^{(2)}]]$。\n\n所有量都必须以指定的国际单位制（SI）单位计算。不使用角度。不使用百分比；所有比率均为纯小数。", "solution": "该问题是有效的，因为它在科学上基于信号处理、声学和计算流体动力学的既定原理，并且问题设定良好，具有清晰、客观和完整的定义与输入。\n\n目标是制定一个算法，用于确定气动声学数据（源自计算流体动力学（CFD）模拟）的必要采样参数，以便在考虑多普勒频移和CFD求解器约束的情况下，解析高达指定频率的声学内容。推导过程如所述从第一性原理出发。\n\n**1. 最小采样频率 ($f_{s, \\min}$) 的推导**\n\nNyquist-Shannon 采样定理指出，要解析一个最大频率分量为 $f_{\\text{highest}}$ 的信号，采样频率 $f_s$ 必须至少是该最大频率的两倍，即 $f_s \\ge 2 f_{\\text{highest}}$。\n\n在气动声学的背景下，声源参考系中的频率 $f_{\\text{source}}$ 在观测时会因多普勒效应而变为频率 $f_{\\text{obs}}$。其关系为 $f_{\\text{obs}} = \\mathcal{D} f_{\\text{source}}$，其中 $\\mathcal{D}$ 是多普勒因子。为确保在所有可能的观测器位置和声源运动下都能解析声学内容，我们必须考虑最坏情况。这对应于最大可能源频率 $f_{\\max}$ 被最大可能多普勒因子 $\\mathcal{D}_{\\max}$ 放大。\n\n因此，任何观测信号中存在的最高频率为：\n$$ f_{\\text{obs,max}} = \\mathcal{D}_{\\max} f_{\\max} $$\n将 Nyquist-Shannon 定理应用于此最高观测频率，所需的最小采样频率 $f_{s, \\min}$ 为：\n$$ f_{s, \\min} = 2 f_{\\text{obs,max}} = 2 \\mathcal{D}_{\\max} f_{\\max} $$\n此推导证实了第一个所需公式。\n\n**2. 最大允许采样间隔 ($\\Delta t_{\\mathrm{req}}$) 的推导**\n\n采样间隔 $\\Delta t$ 是采样频率 $f_s$ 的倒数，即 $\\Delta t = 1/f_s$。对采样频率的要求是一个不等式：$f_s \\ge f_{s, \\min}$。用采样间隔表示此不等式，可得：\n$$ \\frac{1}{\\Delta t} \\ge f_{s, \\min} \\implies \\Delta t \\le \\frac{1}{f_{s, \\min}} $$\n此不等式表明，存在一个仍然满足采样定理的最大允许采样间隔 $\\Delta t_{\\mathrm{req}}$。该最大间隔对应于最小采样频率：\n$$ \\Delta t_{\\mathrm{req}} = \\frac{1}{f_{s, \\min}} $$\n这证实了第二个所需关系。\n\n**3. 数据抽取和可行性分析**\n\nCFD 求解器使用离散的时间步长 $\\Delta t_{\\mathrm{CFD}}$ 来推进时间，该步长受 Courant–Friedrichs–Lewy (CFL) 稳定性条件的制约。对于显式格式，此时间步长由下式给出：\n$$ \\Delta t_{\\mathrm{CFD}} = \\frac{C \\, \\Delta x}{a_{\\mathrm{char}}} $$\n其中 $C$ 是库朗数，$\\Delta x$ 是网格间距，$a_{\\mathrm{char}}$ 是特征波速。对于包含声传播的可压缩流，对 $a_{\\mathrm{char}}$ 的一个保守选择是环境声速 $c_0$ 与最大流速大小 $\\lvert U_{\\max} \\rvert$ 之和：\n$$ a_{\\mathrm{char}} = c_0 + \\lvert U_{\\max} \\rvert $$\n为减少数据存储，通常不是在每个时间步都采样 CFD 数据，而是每隔 $k$ 步采样一次，其中 $k$ 是一个整数抽取因子，$k \\ge 1$。因此，所存储信号的采样间隔为：\n$$ \\Delta t_{\\mathrm{sample}} = k \\, \\Delta t_{\\mathrm{CFD}} $$\n为满足奈奎斯特准则，此采样间隔不得超过最大允许间隔：\n$$ \\Delta t_{\\mathrm{sample}} \\le \\Delta t_{\\mathrm{req}} \\implies k \\, \\Delta t_{\\mathrm{CFD}} \\le \\Delta t_{\\mathrm{req}} $$\n解出 $k$，得到对抽取因子的约束：\n$$ k \\le \\frac{\\Delta t_{\\mathrm{req}}}{\\Delta t_{\\mathrm{CFD}}} $$\n由于 $k$ 必须是整数，抽取因子的最大允许值 $k_{\\max}$ 是此比率的向下取整：\n$$ k_{\\max} = \\left\\lfloor \\frac{\\Delta t_{\\mathrm{req}}}{\\Delta t_{\\mathrm{CFD}}} \\right\\rfloor $$\n如果存在至少一个整数 $k \\ge 1$ 满足该条件，则此采样策略被认为是可行的。这当且仅当 $k_{\\max} \\ge 1$ 时成立。如果 $k_{\\max} = 0$，则意味着 $\\Delta t_{\\mathrm{CFD}}  \\Delta t_{\\mathrm{req}}$，即即使对每个 CFD 步进行采样（$k=1$）也不足以满足要求。\n\n**4. 最大库朗数 ($C_{\\max}$) 的推导**\n\n我们现在确定在每步都采样 CFD 数据（$k=1$）的情况下，足以满足条件的最高库朗数 $C_{\\max}$。当 $k=1$ 时，满足条件的充分条件是 $\\Delta t_{\\mathrm{CFD}} \\le \\Delta t_{\\mathrm{req}}$。代入 $\\Delta t_{\\mathrm{CFD}}$ 和 $\\Delta t_{\\mathrm{req}}$ 的表达式：\n$$ \\frac{C \\, \\Delta x}{a_{\\mathrm{char}}} \\le \\frac{1}{f_{s, \\min}} $$\n为求得最大库朗数，我们解出 $C$：\n$$ C \\le \\frac{a_{\\mathrm{char}}}{\\Delta x \\, f_{s, \\min}} $$\n此不等式的上限给出了最大允许库朗数 $C_{\\max}$：\n$$ C_{\\max} = \\frac{a_{\\mathrm{char}}}{\\Delta x \\, f_{s, \\min}} $$\n如果求解器以大于 $C_{\\max}$ 的库朗数 $C$ 运行，那么即使存储每个时间步，也无法满足所需声学频率 $f_{\\max}$ 的奈奎斯特准则。\n\n这些推导提供了一套完整的公式来实现所需的算法。", "answer": "```python\nimport numpy as np\n\ndef calculate_sampling_params(f_max, D_max, dx, c0, U_max, C):\n    \"\"\"\n    Calculates sampling parameters for aeroacoustic post-processing.\n\n    Args:\n        f_max (float): Maximum source frequency in Hz.\n        D_max (float): Maximum Doppler factor (dimensionless).\n        dx (float): Grid spacing in m.\n        c0 (float): Ambient sound speed in m/s.\n        U_max (float): Maximum flow speed magnitude in m/s.\n        C (float): Courant number (dimensionless).\n\n    Returns:\n        list: A list containing [f_s_min, dt_req, dt_cfd, k_max, feasible, C_max].\n    \"\"\"\n    # Task 1: Minimum sampling frequency\n    # f_s_min = 2 * D_max * f_max\n    f_s_min = 2.0 * D_max * f_max\n\n    # Task 2: Maximum admissible sampling interval\n    # dt_req = 1 / f_s_min\n    dt_req = 1.0 / f_s_min\n\n    # Task 3: CFD time step and decimation factor\n    # a_char = c_0 + |U_max|\n    a_char = c0 + U_max\n    # dt_cfd = (C * dx) / a_char\n    dt_cfd = (C * dx) / a_char\n    \n    # k_max = floor(dt_req / dt_cfd)\n    # Ensure dt_cfd is not zero to prevent division by zero,\n    # though physically it must be positive for a simulation to advance.\n    if dt_cfd > 0.0:\n        k_max = int(np.floor(dt_req / dt_cfd))\n    else:\n        # This case is physically unrealistic but handled for robustness.\n        # If dt_cfd is zero, any sampling interval is infinitely larger, so k_max is 0.\n        k_max = 0\n    \n    # Feasibility is true if k_max is at least 1.\n    feasible = k_max >= 1\n\n    # Task 4: Maximum Courant number\n    # C_max = a_char / (dx * f_s_min)\n    denominator_c_max = dx * f_s_min\n    if denominator_c_max > 0.0:\n        C_max = a_char / denominator_c_max\n    else:\n        # Physically unrealistic, implies infinite C_max is allowed.\n        C_max = float('inf')\n\n    return [f_s_min, dt_req, dt_cfd, k_max, feasible, C_max]\n\ndef solve():\n    \"\"\"\n    Executes the calculations for the test cases provided in the problem.\n    \"\"\"\n    # Test cases: (f_max, D_max, dx, c0, U_max, C)\n    test_cases = [\n        # Case A\n        (2000.0, 1.2, 0.005, 343.0, 50.0, 0.5),\n        # Case B\n        (1000.0, 1.0, 1.0, 340.0, 10.0, 0.175),\n        # Case C\n        (5000.0, 1.3, 0.04, 343.0, 27.0, 0.8),\n        # Case D\n        (800.0, 1.5, 0.002, 330.0, 20.0, 0.6),\n    ]\n\n    results = []\n    for case in test_cases:\n        f_max, D_max, dx, c0, U_max, C = case\n        result = calculate_sampling_params(f_max, D_max, dx, c0, U_max, C)\n        results.append(result)\n\n    # Format the output as a string representation of a list of lists.\n    # The map(str, results) converts each sub-list into its string form,\n    # e.g., '[4800.0, ...]', and join combines them with commas.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3288213"}, {"introduction": "在使用可渗透控制面的福克斯·威廉姆斯-霍金斯（FW-H）方法时，一个常见的挑战是当声源穿过积分域边界时产生的非物理噪声。这项高级练习通过分析一个离开有限控制面的涡，对这种截断误差进行建模，并将误差与“缺失”冲量的时间变化率联系起来。通过推导和数值求解此误差，您将深入了解实际航空声学模拟中不准确性的一个关键来源，并培养量化数值伪影和设计计算设置（例如，选择控制面尺寸）以将其最小化到可接受水平的技能。", "problem": "考虑一个紧凑的、轴对齐的类 Lamb–Oseen 涡管，其环量为 $\\Gamma$，沿单位矢量 $\\boldsymbol{k}$（垂直于 $\\left(x,y\\right)$ 平面）定向。该涡流以恒定速度 $U$ 沿 $+x$ 方向对流。选择一个可渗透的 Ffowcs Williams–Hawkings (FWH) 控制面，该控制面是 $\\left(x,y\\right)$ 平面内以原点为中心、半径为 $a$ 的圆。一个观察者位于声远场，距离为 $R$，方向为单位法向 $\\boldsymbol{n}=\\boldsymbol{e}_y$。假设为低马赫数条件且平均流折射可忽略不计，因此适用声速为 $c_0$、密度为 $\\rho$ 的自由空间传播。使用以下基本原理：可压缩 Navier–Stokes 方程、Lighthill 声学比拟、可渗透 FWH 公式，以及远场紧致源极限，其中辐射声压可由所包含的 Kelvin 冲量的时间导数表示。\n\n使用平滑指示函数 $f\\!\\left(r\\right)$ 来模拟控制面内包含的涡环量分数，其中 $r$ 是涡心到原点的距离。令\n$$\nf\\!\\left(r\\right)=\\frac{1}{1+\\exp\\!\\left(\\dfrac{r-a}{\\varepsilon}\\right)},\n$$\n平滑长度 $\\varepsilon0$ 代表涡核尺寸和可渗透过渡区的厚度。将涡心随时间变化参数化为\n$$\n\\boldsymbol{x}_v\\!\\left(t\\right)=\\left(a+U t\\right)\\,\\boldsymbol{e}_x,\\quad r\\!\\left(t\\right)=a+U t,\n$$\n使得涡在 $t=0$ 时穿过控制面。在紧致源、远场极限下，沿 $\\boldsymbol{n}$ 方向的所包含流的冲量的类偶极子贡献决定了辐射压力。将每单位翼展的所包含 Kelvin 冲量定义为与 $\\rho\\,\\Gamma\\,\\boldsymbol{k}\\times\\boldsymbol{x}_v\\!\\left(t\\right)\\,f\\!\\left(r\\!\\left(t\\right)\\right)$ 成正比，并令观察者处仅由控制面截断引起的远场压力在偶极子极限下表示为所包含偶极矩的二阶时间导数除以 $4\\pi c_0 R$。对于一个匀速平移的紧致涡，真实的辐射声为零；因此，任何来自有限控制面的非零预测都是截断误差，而修正它所需的“缺失”贡献在量值上相等，符号上相反。\n\n任务：\n- 从上述基本定律出发，并使用 Ffowcs Williams–Hawkings 比拟的远场、紧致源极限，推导所述几何构型的远场截断误差信号 $p'_{\\mathrm{err}}\\!\\left(t\\right)$，其形式为沿 $\\boldsymbol{n}$ 方向的所包含偶极矩的二阶时间导数除以 $4\\pi c_0 R$。用 $\\rho$、$\\Gamma$、$U$、$a$、$c_0$、$R$ 和 $\\varepsilon$ 以及函数 $f\\!\\left(\\cdot\\right)$ 及其时间导数来表示 $p'_{\\mathrm{err}}\\!\\left(t\\right)$。显式表达 $f\\!\\left(t\\right)=f\\!\\left(r\\!\\left(t\\right)\\right)$ 及其关于 $t$ 的导数。\n- 将“缺失”贡献解释为 $p'_{\\mathrm{miss}}\\!\\left(t\\right)=-\\,p'_{\\mathrm{err}}\\!\\left(t\\right)$。在对称窗口 $t\\in\\left[-T,T\\right]$（其中\n$$\nT=\\frac{10\\,\\varepsilon}{U},\n$$\n）上定义均方根为\n$$\np_{\\mathrm{rms}}=\\left(\\frac{1}{2T}\\int_{-T}^{T}\\left(p'_{\\mathrm{err}}\\!\\left(t\\right)\\right)^2\\,\\mathrm{d}t\\right)^{1/2}.\n$$\n基于此截断误差定义声压级为\n$$\nL_{\\mathrm{err}}=20\\log_{10}\\!\\left(\\frac{p_{\\mathrm{rms}}}{p_{\\mathrm{ref}}}\\right),\\quad p_{\\mathrm{ref}}=2.0\\times 10^{-5}\\ \\mathrm{Pa}.\n$$\n- 提出一个关于控制面放置半径 $a$ 的定量准则，以确保 $L_{\\mathrm{err}}\\le L_{\\mathrm{target}}$，其中 $L_{\\mathrm{target}}$ 是以分贝为单位的指定阈值。特别地，对于固定的 $\\rho$、$c_0$、$\\Gamma$、$U$、$\\varepsilon$、$R$ 和 $L_{\\mathrm{target}}$，确定最大的 $a$（记为 $a_{\\max}$），使得条件 $L_{\\mathrm{err}}\\!\\left(a\\right)\\le L_{\\mathrm{target}}$ 成立。为了模型的数值稳定性，强制要求 $a\\ge a_{\\min}$，其中 $a_{\\min}=5\\,\\varepsilon$。\n\n数值实现要求：\n- 使用您推导出的 $p'_{\\mathrm{err}}\\!\\left(t\\right)$ 的显式表达式，通过对区间 $t\\in\\left[-T,T\\right]$ 进行具有足够精细分辨率以达到收敛的均匀采样，采用数值积分方法计算 $p_{\\mathrm{rms}}$。然后计算 $L_{\\mathrm{err}}$，并对给定的 $L_{\\mathrm{target}}$ 使用区间套加二分法程序来定位 $a_{\\max}$。如果 $L_{\\mathrm{err}}\\!\\left(a_{\\min}\\right)L_{\\mathrm{target}}$，则返回 $a_{\\max}=a_{\\min}$。如果在某个大的搜索界限内 $L_{\\mathrm{err}}$ 未超过 $L_{\\mathrm{target}}$，则将搜索到的最大 $a$ 作为 $a_{\\max}$ 报告。\n- 单位：$\\rho$ 的单位为 $\\mathrm{kg/m^3}$，$c_0$ 为 $\\mathrm{m/s}$，$\\Gamma$ 为 $\\mathrm{m^2/s}$，$U$ 为 $\\mathrm{m/s}$，$\\varepsilon$ 和 $a$ 为 $\\mathrm{m}$，$R$ 为 $\\mathrm{m}$，$p$ 为 $\\mathrm{Pa}$。最终的表面半径答案以 $\\mathrm{m}$ 为单位表示，并四舍五入到三位小数。\n\n测试组：\n对于下面的每个参数元组 $(\\rho, c_0, \\Gamma, U, \\varepsilon, R, L_{\\mathrm{target}})$，计算并返回以 $\\mathrm{m}$ 为单位的 $a_{\\max}$。\n\n- 情况 1：$\\rho=1.225\\ \\mathrm{kg/m^3}$，$c_0=343\\ \\mathrm{m/s}$，$\\Gamma=0.003\\ \\mathrm{m^2/s}$，$U=50\\ \\mathrm{m/s}$，$\\varepsilon=0.05\\ \\mathrm{m}$，$R=10\\ \\mathrm{m}$，$L_{\\mathrm{target}}=40$ 分贝。\n- 情况 2：$\\rho=1.225\\ \\mathrm{kg/m^3}$，$c_0=343\\ \\mathrm{m/s}$，$\\Gamma=0.01\\ \\mathrm{m^2/s}$，$U=20\\ \\mathrm{m/s}$，$\\varepsilon=0.02\\ \\mathrm{m}$，$R=50\\ \\mathrm{m}$，$L_{\\mathrm{target}}=30$ 分贝。\n- 情况 3：$\\rho=1.18\\ \\mathrm{kg/m^3}$，$c_0=340\\ \\mathrm{m/s}$，$\\Gamma=0.02\\ \\mathrm{m^2/s}$，$U=100\\ \\mathrm{m/s}$，$\\varepsilon=0.05\\ \\mathrm{m}$，$R=5\\ \\mathrm{m}$，$L_{\\mathrm{target}}=60$ 分贝。\n- 情况 4：$\\rho=1.225\\ \\mathrm{kg/m^3}$，$c_0=343\\ \\mathrm{m/s}$，$\\Gamma=0.002\\ \\mathrm{m^2/s}$，$U=80\\ \\mathrm{m/s}$，$\\varepsilon=0.10\\ \\mathrm{m}$，$R=20\\ \\mathrm{m}$，$L_{\\mathrm{target}}=35$ 分贝。\n\n最终输出格式：\n您的程序应产生单行输出，其中包含四个 $a_{\\max}$ 的值，这些值以米为单位，四舍五入到三位小数，并以逗号分隔列表的形式置于方括号内，例如 $\\left[\\text{a1},\\text{a2},\\text{a3},\\text{a4}\\right]$。", "solution": "问题陈述已根据指定标准进行了严格验证。所有给定条件均已逐字提取并进行分析。该问题被判定为**有效**。它在科学上基于计算航空声学的原理，特别是 Lighthill 声学比拟和 Ffowcs Williams–Hawkings (FWH) 公式。该设置尽管为易于处理而采用了特定的建模选择——例如涡路径 $\\boldsymbol{x}_v(t)$ 的参数化和指示函数径向距离 $r(t)$ 的定义——但其本身是自洽的、数学上一致且适定的。所定义的量是客观的，数值任务也已明确规定。因此，我们可以着手求解。\n\n解决方案分两部分展开：首先，是对截断误差压力信号 $p'_{\\mathrm{err}}(t)$ 的解析推导；其次，是对计算最大允许控制面半径 $a_{\\max}$ 的数值算法的描述。\n\n**1. 截断误差压力信号 $p'_{\\mathrm{err}}(t)$ 的推导**\n\n问题陈述指出，在紧致源、远场极限下，位于距离 $R$、方向为 $\\boldsymbol{n}$ 的观察者处的截断误差所致声压由下式给出：\n$$\np'_{\\mathrm{err}}(t) = \\frac{1}{4\\pi c_0 R} \\frac{d^2}{dt^2} \\left[ \\boldsymbol{n} \\cdot \\boldsymbol{I}(t) \\right]\n$$\n此处，$c_0$ 是声速，$\\boldsymbol{I}(t)$ 是每单位翼展的所包含 Kelvin 冲量，它充当有效偶极矩。右侧的时间参数应为延迟时间 $t - R/c_0$，但为简化符号，我们推导源信号作为源时间 $t$ 的函数。\n\n每单位翼展的所包含 Kelvin 冲量定义为：\n$$\n\\boldsymbol{I}(t) = \\rho \\Gamma (\\boldsymbol{k} \\times \\boldsymbol{x}_v(t)) f(r(t))\n$$\n其中 $\\rho$ 是流体密度，$\\Gamma$ 是涡环量，$\\boldsymbol{k}=\\boldsymbol{e}_z$ 是沿涡轴的单位矢量，$\\boldsymbol{x}_v(t)$ 是涡心位置，$f(r(t))$ 是平滑指示函数。\n\n给定条件如下：\n- 涡位置：$\\boldsymbol{x}_v(t) = (a+Ut)\\boldsymbol{e}_x$。\n- 观察者方向：$\\boldsymbol{n} = \\boldsymbol{e}_y$。\n- 指示函数：$f(r) = (1 + \\exp(\\frac{r-a}{\\varepsilon}))^{-1}$。\n- 指示函数的径向距离：$r(t) = a+Ut$。\n\n首先，我们将 $r(t)$ 的定义代入 $f(r)$：\n$$\nf(t) = f(r(t)) = \\frac{1}{1 + \\exp\\left(\\frac{(a+Ut)-a}{\\varepsilon}\\right)} = \\frac{1}{1 + \\exp\\left(\\frac{Ut}{\\varepsilon}\\right)}\n$$\n注意，这种形式的 $f(t)$ 与半径 $a$ 无关。\n\n接下来，我们计算冲量定义中的叉积：\n$$\n\\boldsymbol{k} \\times \\boldsymbol{x}_v(t) = \\boldsymbol{e}_z \\times \\left((a+Ut)\\boldsymbol{e}_x\\right) = (a+Ut) (\\boldsymbol{e}_z \\times \\boldsymbol{e}_x) = (a+Ut)\\boldsymbol{e}_y\n$$\n将此式代入 $\\boldsymbol{I}(t)$ 的表达式：\n$$\n\\boldsymbol{I}(t) = \\rho \\Gamma (a+Ut) f(t) \\boldsymbol{e}_y\n$$\n冲量沿观察者方向 $\\boldsymbol{n}=\\boldsymbol{e}_y$ 的分量为：\n$$\n\\boldsymbol{n} \\cdot \\boldsymbol{I}(t) = \\boldsymbol{e}_y \\cdot \\left(\\rho \\Gamma (a+Ut) f(t) \\boldsymbol{e}_y\\right) = \\rho \\Gamma (a+Ut) f(t)\n$$\n为求出压力，我们必须计算该量的二阶时间导数。令 $g(t) = (a+Ut)f(t)$。我们需要计算 $\\rho\\Gamma\\ddot{g}(t)$。\n\n首先，我们求 $f(t)$ 的导数。令 $\\tau = Ut/\\varepsilon$。则 $f(t) = (1+e^\\tau)^{-1}$。\n使用链式法则，一阶导数为：\n$$\n\\dot{f}(t) = \\frac{df}{d\\tau}\\frac{d\\tau}{dt} = \\left( -(1+e^\\tau)^{-2}e^\\tau \\right) \\left( \\frac{U}{\\varepsilon} \\right) = -\\frac{U}{\\varepsilon} \\frac{e^{Ut/\\varepsilon}}{\\left(1+e^{Ut/\\varepsilon}\\right)^2}\n$$\n这可以更紧凑地写为 $\\dot{f}(t) = -\\frac{U}{\\varepsilon} f(t)(1-f(t))$。\n二阶导数为：\n$$\n\\ddot{f}(t) = \\frac{d}{dt}\\left(-\\frac{U}{\\varepsilon}f(t)(1-f(t))\\right) = -\\frac{U}{\\varepsilon}\\left(\\dot{f}(t)(1-f(t)) + f(t)(-\\dot{f}(t))\\right) = -\\frac{U}{\\varepsilon}\\dot{f}(t)(1-2f(t))\n$$\n代入 $\\dot{f}(t)$ 的表达式：\n$$\n\\ddot{f}(t) = -\\frac{U}{\\varepsilon} \\left(-\\frac{U}{\\varepsilon}f(t)(1-f(t))\\right) (1-2f(t)) = \\left(\\frac{U}{\\varepsilon}\\right)^2 f(t)(1-f(t))(1-2f(t))\n$$\n现在我们对 $g(t) = (a+Ut)f(t)$ 求关于时间 $t$ 的二阶导数：\n$$\n\\dot{g}(t) = \\frac{d}{dt}(a+Ut) \\cdot f(t) + (a+Ut) \\cdot \\dot{f}(t) = Uf(t) + (a+Ut)\\dot{f}(t)\n$$\n$$\n\\ddot{g}(t) = U\\dot{f}(t) + \\left[ U\\dot{f}(t) + (a+Ut)\\ddot{f}(t) \\right] = 2U\\dot{f}(t) + (a+Ut)\\ddot{f}(t)\n$$\n代入 $\\dot{f}(t)$ 和 $\\ddot{f}(t)$ 的表达式：\n$$\n\\ddot{g}(t) = 2U\\left(-\\frac{U}{\\varepsilon}f(t)(1-f(t))\\right) + (a+Ut)\\left(\\left(\\frac{U}{\\varepsilon}\\right)^2 f(t)(1-f(t))(1-2f(t))\\right)\n$$\n提出公因式：\n$$\n\\ddot{g}(t) = \\frac{U^2}{\\varepsilon}f(t)(1-f(t))\\left[-2 + \\frac{a+Ut}{\\varepsilon}(1-2f(t))\\right]\n$$\n最后，将此式代入压力公式，得到截断误差信号的显式表达式：\n$$\np'_{\\mathrm{err}}(t) = \\frac{\\rho \\Gamma}{4\\pi c_0 R} \\ddot{g}(t) = \\frac{\\rho \\Gamma U^2}{4\\pi c_0 R \\varepsilon} f(t)(1-f(t)) \\left[-2 + \\frac{a+Ut}{\\varepsilon}(1-2f(t))\\right]\n$$\n\n**2. 计算 $a_{\\max}$ 的数值程序**\n\n目标是找到最大半径 $a_{\\max}$（其中 $a \\ge a_{\\min}=5\\varepsilon$），使得由截断误差产生的声压级 $L_{\\mathrm{err}}$ 不超过目标值 $L_{\\mathrm{target}}$。这需要计算 $L_{\\mathrm{err}}$ 作为 $a$ 的函数。\n\n均方根压力 $p_{\\mathrm{rms}}$ 在时间区间 $t \\in [-T, T]$ 上定义，其中 $T = 10\\varepsilon/U$：\n$$\np_{\\mathrm{rms}}(a) = \\left(\\frac{1}{2T}\\int_{-T}^{T}\\left(p'_{\\mathrm{err}}(t; a)\\right)^2\\,\\mathrm{d}t\\right)^{1/2}\n$$\n声压级 $L_{\\mathrm{err}}$ 则为：\n$$\nL_{\\mathrm{err}}(a) = 20\\log_{10}\\left(\\frac{p_{\\mathrm{rms}}(a)}{p_{\\mathrm{ref}}}\\right)\n$$\n参考压力为 $p_{\\mathrm{ref}} = 2.0 \\times 10^{-5}\\ \\mathrm{Pa}$。\n\n$p'_{\\mathrm{err}}(t)$ 的表达式表明它是 $a$ 的线性函数。因此，$p_{\\mathrm{rms}}(a)$ 和 $L_{\\mathrm{err}}(a)$ 是 $a$ 的单调递增函数。这使得可以高效地搜索 $a_{\\max}$。\n\n数值算法如下：\n1.  **定义一个计算 $L_{\\mathrm{err}}(a)$ 的函数**：\n    a. 对于给定的 $a$ 和其他物理参数，在 $t \\in [-T, T]$ 上定义一个精细、均匀的时间网格。我们使用 $N=4097$ 个点以获得高精度。\n    b. 在网格上的每个时间步 $t_i$，使用推导出的解析公式计算 $p'_{\\mathrm{err}}(t_i)$。通过使用向量化计算可以高效地完成此操作。\n    c. 使用梯形法则（`numpy.trapz`）数值近似积分 $\\int_{-T}^{T} (p'_{\\mathrm{err}}(t))^2 dt$。\n    d. 计算 $p_{\\mathrm{rms}}$，然后计算 $L_{\\mathrm{err}}$。\n\n2.  **实现一个用于 $a_{\\max}$ 的求根程序**：\n    a. 定义搜索函数 $h(a) = L_{\\mathrm{err}}(a) - L_{\\mathrm{target}}$。我们寻求根 $a_{\\max}$，使得 $h(a_{\\max})=0$。\n    b. 设置最小半径 $a_{\\min} = 5\\varepsilon$。计算 $L_{\\mathrm{err}}(a_{\\min})$。如果 $L_{\\mathrm{err}}(a_{\\min})  L_{\\mathrm{target}}$，则没有半径 $a \\ge a_{\\min}$ 满足该准则。根据问题要求，我们返回 $a_{\\max} = a_{\\min}$。\n    c. 建立一个较大的搜索上界，例如 $a_{bound} = 1000$ 米。计算 $L_{\\mathrm{err}}(a_{bound})$。如果 $L_{\\mathrm{err}}(a_{bound})  L_{\\mathrm{target}}$，则在此实际限制内未达到阈值。我们将 $a_{bound}$ 作为 $a_{\\max}$ 返回。\n    d. 如果 $L_{\\mathrm{err}}(a_{\\min}) \\le L_{\\mathrm{target}} \\le L_{\\mathrm{err}}(a_{bound})$，则根 $a_{\\max}$ 被限定在 $[a_{\\min}, a_{bound}]$ 区间内。\n    e. 使用二分法算法在此区间内高精度地找到 $h(a)=0$ 的根。经过足够次数的迭代（例如 100 次）后，最终区间的中点给出了 $a_{\\max}$ 的值。\n\n对每个测试用例实施此程序，以找到相应的 $a_{\\max}$。最终结果四舍五入到三位小数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to compute a_max for all test cases.\n    \"\"\"\n    P_REF = 2.0e-5 # Reference pressure in Pa\n\n    test_cases = [\n        # (rho, c0, Gamma, U, eps, R, L_target)\n        (1.225, 343.0, 0.003, 50.0, 0.05, 10.0, 40.0),\n        (1.225, 343.0, 0.01, 20.0, 0.02, 50.0, 30.0),\n        (1.18, 340.0, 0.02, 100.0, 0.05, 5.0, 60.0),\n        (1.225, 343.0, 0.002, 80.0, 0.10, 20.0, 35.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        rho, c0, Gamma, U, eps, R, L_target = case\n        a_max = find_a_max(rho, c0, Gamma, U, eps, R, L_target, P_REF)\n        results.append(f\"{a_max:.3f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_L_err(a, rho, c0, Gamma, U, eps, R, p_ref):\n    \"\"\"\n    Calculates the sound pressure level L_err for a given control surface radius 'a'.\n\n    The function implements the analytical formula for the truncation error pressure\n    signal and computes its root-mean-square value through numerical integration.\n    \"\"\"\n    # 1. Define integration window and constants\n    T = 10.0 * eps / U\n    Cp = (rho * Gamma * U**2) / (4.0 * np.pi * c0 * R * eps)\n    \n    # 2. Set up a fine time grid for numerical integration\n    N_points = 4097\n    t = np.linspace(-T, T, N_points)\n    \n    # 3. Vectorized calculation of the pressure signal p'_err(t)\n    Ut_over_eps = U * t / eps\n    f_t = 1.0 / (1.0 + np.exp(Ut_over_eps))\n    \n    # Pre-compute parts of the main formula\n    f_term = f_t * (1.0 - f_t)\n    bracket_term = -2.0 + ((a + U * t) / eps) * (1.0 - 2.0 * f_t)\n    \n    p_err_t = Cp * f_term * bracket_term\n    \n    # 4. Compute the root-mean-square pressure p_rms\n    # Use the trapezoidal rule for numerical integration of (p'_err(t))^2\n    integral_val = np.trapz(p_err_t**2, t)\n    p_rms_sq = integral_val / (2.0 * T)\n    \n    # Handle the case of zero pressure to avoid sqrt of negative (due to precision)\n    if p_rms_sq = 0:\n        return -np.inf\n    \n    p_rms = np.sqrt(p_rms_sq)\n    \n    # 5. Compute the sound pressure level L_err\n    if p_rms = 0: # Avoid log(0)\n        return -np.inf\n        \n    L_err = 20.0 * np.log10(p_rms / p_ref)\n    \n    return L_err\n\ndef find_a_max(rho, c0, Gamma, U, eps, R, L_target, p_ref):\n    \"\"\"\n    Finds the maximum control surface radius 'a_max' such that L_err(a) = L_target.\n    \n    This function uses a bisection search method to find the root of the equation\n    L_err(a) - L_target = 0, respecting the problem's constraints and edge cases.\n    \"\"\"\n    a_min = 5.0 * eps\n    \n    # Check if the condition is already violated at the minimum allowed radius\n    L_at_min = calculate_L_err(a_min, rho, c0, Gamma, U, eps, R, p_ref)\n    if L_at_min > L_target:\n        return a_min\n        \n    # Set a large, practical upper bound for the search\n    a_upper_bound = 1000.0  # in meters\n    \n    # Bracket the root for bisection\n    a_low = a_min\n    a_high = a_upper_bound\n    \n    # Check if the target level is ever reached within the search bound\n    L_at_high = calculate_L_err(a_high, rho, c0, Gamma, U, eps, R, p_ref)\n    if L_at_high  L_target:\n        return a_high\n        \n    # Bisection search loop for high precision\n    num_iterations = 100\n    for _ in range(num_iterations):\n        a_mid = (a_low + a_high) / 2.0\n        if a_mid == a_low or a_mid == a_high: # Precision limit reached\n            break\n        \n        L_at_mid = calculate_L_err(a_mid, rho, c0, Gamma, U, eps, R, p_ref)\n        \n        if L_at_mid  L_target:\n            a_low = a_mid\n        else:\n            a_high = a_mid\n            \n    # The root is a_high, as it's the upper bound of the final interval\n    return a_high\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3288141"}]}