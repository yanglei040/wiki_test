{"hands_on_practices": [{"introduction": "高阶强稳定性保持（SSP）龙格-库塔格式看似复杂，但其核心思想却出人意料地简洁。本练习旨在揭开SSP格式的神秘面纱，向您展示它们是如何通过基础的前向欧拉步骤巧妙构建而成的。通过从第一性原理出发，将一个三阶SSP格式分解为凸组合，您将亲手推导出其稳定性条件，从而深刻理解高阶方法如何继承简单方法的稳定性。[@problem_id:3350094]", "problem": "考虑一维线性平流方程 $u_{t} + a\\,u_{x} = 0$，该方程定义在一个周期性区域上，并在间距为 $\\Delta x$ 的均匀网格上进行离散化，其中当 $a>0$ 时采用守恒的一阶迎风有限体积法进行近似。单元中心的半离散系统为\n$$\n\\frac{d u_{i}}{dt} \\;=\\; \\mathcal{N}(u)_i \\;=\\; -\\frac{a}{\\Delta x}\\left(u_{i} - u_{i-1}\\right).\n$$\n假设数值解使用标准的 Shu-Osher 形式的三阶段三阶强稳定性保持 (SSP) Runge-Kutta (RK) 方法进行时间推进。假设前向欧拉法在时间步长限制 $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$下是强稳定的（例如，在诸如全变差之类的凸单调性范数下非增），其中对于此空间离散化，$\\Delta t_{\\mathrm{FE}} = \\Delta x/a$。\n\n仅从强稳定性保持 (SSP) 时间积分器的基本定义（即将其视为应用于半离散算子 $\\mathcal{N}(\\cdot)$ 的前向欧拉步的凸组合）出发，完成以下任务：\n\n1. 写出应用于 $\\dot{u}=\\mathcal{N}(u)$ 的 Shu-Osher 形式的三阶段三阶 SSP Runge-Kutta 格式。\n2. 将每个阶段重写为当前状态或具有相同时间步长 $\\Delta t$ 的前向欧拉更新的显式凸组合。\n3. 利用此表示和给定的前向欧拉强稳定性界限 $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$，推导允许的最大时间步长 $\\Delta t$，以确保三阶段三阶 SSP Runge-Kutta 方法具有相同的强稳定性。\n4. 对于 $a = 1.7\\,\\mathrm{m/s}$ 和 $\\Delta x = 6.2 \\times 10^{-3}\\,\\mathrm{m}$，计算这个允许的时间步长。\n\n以秒为单位表示最终的允许时间步长，并将答案四舍五入到四位有效数字。", "solution": "该问题要求从 SSP 方法的基本定义出发，推导应用于一个半离散系统的特定三阶段三阶强稳定性保持 (SSP) Runge-Kutta 方法的强稳定性时间步长限制。\n\n首先验证该问题。\n\n### 步骤 1：提取已知条件\n- **控制方程**：一维线性平流方程，$u_{t} + a\\,u_{x} = 0$，其中 $a > 0$。\n- **区域与网格**：周期性区域，间距为 $\\Delta x$ 的均匀网格。\n- **空间离散化**：守恒的一阶迎风有限体积近似。\n- **半离散系统**：$\\frac{d u_{i}}{dt} = \\mathcal{N}(u)_i = -\\frac{a}{\\Delta x}\\left(u_{i} - u_{i-1}\\right)$。\n- **时间积分器**：标准的 Shu-Osher 形式的三阶段三阶 SSP Runge-Kutta (SSP(3,3)) 方法。\n- **前向欧拉稳定性**：前向欧拉法，$u^{n+1} = u^n + \\Delta t \\mathcal{N}(u^n)$，在其时间步长 $\\Delta t$ 满足 $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$ 的条件下是强稳定的（例如，全变差非增），其中 $\\Delta t_{\\mathrm{FE}} = \\frac{\\Delta x}{a}$。\n- **数值**：$a = 1.7\\,\\mathrm{m/s}$ 和 $\\Delta x = 6.2 \\times 10^{-3}\\,\\mathrm{m}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题基于数值分析和计算流体力学中标准的、公认的概念，包括线性平流方程、有限体积法、迎风格式和 SSP Runge-Kutta 方法。其表述是正确的，并且在物理上是合理的。\n- **适定性**：该问题是适定的。它提供了一套清晰的定义和一个已知的稳定方法（前向欧拉法）作为构建模块。任务是推导由这些模块构建的更复杂方法的稳定性极限，这将导出一个唯一的、有意义的解。\n- **客观性**：该问题以精确、客观的数学语言陈述，没有歧义或主观论断。\n\n### 步骤 3：结论与行动\n该问题具有科学依据、适定、客观且自洽。因此，判定其为有效问题。将提供完整解答。\n\n### 求解推导\n\n求解过程遵循问题陈述中概述的四个步骤。\n\n**1. Shu-Osher 形式的 SSP(3,3) Runge-Kutta 格式**\n\n任务是将指定的时间积分器应用于一般的半离散常微分方程 (ODE) 系统 $\\frac{du}{dt} = \\mathcal{N}(u)$，其中 $u$ 代表单元中心值的向量 $\\{u_i\\}$。标准的三阶段三阶 SSP Runge-Kutta 格式，通常表示为 SSP(3,3)，其 Shu-Osher 形式如下：\n$$u^{(0)} = u^n$$\n$$u^{(1)} = u^{(0)} + \\Delta t \\, \\mathcal{N}(u^{(0)})$$\n$$u^{(2)} = \\frac{3}{4} u^{(0)} + \\frac{1}{4} \\left( u^{(1)} + \\Delta t \\, \\mathcal{N}(u^{(1)}) \\right)$$\n$$u^{n+1} = \\frac{1}{3} u^{(0)} + \\frac{2}{3} \\left( u^{(2)} + \\Delta t \\, \\mathcal{N}(u^{(2)}) \\right)$$\n其中 $u^n$ 是在时间 $t_n$ 的解，$u^{n+1}$ 是在下一个时间层 $t_{n+1} = t_n + \\Delta t$ 的解。向量 $u^{(1)}$ 和 $u^{(2)}$ 代表中间阶段的值。\n\n**2. 将各阶段重写为前向欧拉步的凸组合**\n\nSSP 方法的基本原理是它们可以表示为前向欧拉步的凸组合。如果一个方法可以写成 $\\sum_{k} \\alpha_k \\mathcal{O}_k$ 的形式，那么它就是一个凸组合，其中算子 $\\mathcal{O}_k$ 本身是强稳定的，并且系数满足 $\\alpha_k \\ge 0$ 和 $\\sum_k \\alpha_k = 1$。基础的稳定算子是前向欧拉 (FE) 步。\n\n我们将时间步长为 $\\delta t$ 的前向欧拉算子定义为：\n$$E(w; \\delta t) = w + \\delta t \\, \\mathcal{N}(w)$$\n问题陈述指出，在某个凸半范数 $\\|\\cdot\\|$（例如，全变差 $\\|u\\|_{\\text{TV}} = \\sum_i |u_{i+1}-u_i|$）下，该算子是强稳定的，即 $\\|E(w; \\delta t)\\| \\le \\|w\\|$，条件是 $\\delta t \\le \\Delta t_{\\mathrm{FE}}$。\n\n我们现在使用该算子重写 SSP(3,3) 格式的每个阶段。\n\n*   **阶段 1：**\n    第一个阶段已经是应用于 $u^n = u^{(0)}$、时间步长为 $\\Delta t$ 的前向欧拉步的形式：\n    $$u^{(1)} = u^{(0)} + \\Delta t \\, \\mathcal{N}(u^{(0)}) = E(u^{(0)}; \\Delta t)$$\n    这是一个平凡的凸组合。为使此步稳定，我们必须有 $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$。\n\n*   **阶段 2：**\n    第二个阶段是：\n    $$u^{(2)} = \\frac{3}{4} u^{(0)} + \\frac{1}{4} \\left( u^{(1)} + \\Delta t \\, \\mathcal{N}(u^{(1)}) \\right)$$\n    将括号中的项识别为作用于 $u^{(1)}$、时间步长为 $\\Delta t$ 的前向欧拉步，我们可以写出：\n    $$u^{(2)} = \\frac{3}{4} u^{(0)} + \\frac{1}{4} E(u^{(1)}; \\Delta t)$$\n    该表达式将 $u^{(2)}$ 表示为状态 $u^{(0)}$ 和 $E(u^{(1)}; \\Delta t)$ 的凸组合，因为系数是非负的（$\\frac{3}{4} \\ge 0, \\frac{1}{4} \\ge 0$）并且和为 1（$\\frac{3}{4} + \\frac{1}{4} = 1$）。为了使整个阶段保持稳定性，算子 $E(u^{(1)}; \\Delta t)$ 必须是稳定的。这要求其时间步长 $\\Delta t$ 满足 $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$。\n\n*   **阶段 3（最终阶段）：**\n    最终阶段给出新解 $u^{n+1}$：\n    $$u^{n+1} = \\frac{1}{3} u^{(0)} + \\frac{2}{3} \\left( u^{(2)} + \\Delta t \\, \\mathcal{N}(u^{(2)}) \\right)$$\n    类似地，我们将括号中的项识别为作用于 $u^{(2)}$、时间步长为 $\\Delta t$ 的前向欧拉步：\n    $$u^{n+1} = \\frac{1}{3} u^{(0)} + \\frac{2}{3} E(u^{(2)}; \\Delta t)$$\n    这将 $u^{n+1}$ 表示为 $u^{(0)}$ 和 $E(u^{(2)}; \\Delta t)$ 的凸组合，其系数为非负的（$\\frac{1}{3} \\ge 0, \\frac{2}{3} \\ge 0$）且和为 1（$\\frac{1}{3} + \\frac{2}{3} = 1$）。为了使此步保持稳定性，算子 $E(u^{(2)}; \\Delta t)$ 必须是稳定的，这要求其时间步长 $\\Delta t$ 满足 $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$。\n\n**3. 推导最大允许时间步长**\n\n整个 SSP(3,3) 方法的稳定性要求其结构内的每一个前向欧拉运算都是稳定的。我们已经分析了每个阶段，发现前向欧拉算子 $E$ 总是使用 Runge-Kutta 方法的完整时间步长 $\\Delta t$。\n\n- 从阶段 1，我们要求 $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$。\n- 从阶段 2，我们要求 $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$。\n- 从阶段 3，我们要求 $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$。\n\n为了同时满足所有这些条件，时间步长 $\\Delta t$ 必须受这些约束中最严格的一个限制。由于所有约束都相同，SSP(3,3) 方法的总体稳定性条件是：\n$$\\Delta t \\le \\Delta t_{\\mathrm{FE}}$$\n因此，最大允许时间步长 $\\Delta t_{\\max}$ 等于前向欧拉稳定性极限：\n$$\\Delta t_{\\max} = \\Delta t_{\\mathrm{FE}}$$\n这个结果意味着这个特定的三阶 Runge-Kutta 格式的 SSP 系数为 $C=1$。\n\n**4. 计算允许的时间步长**\n\n问题给出了给定空间离散化的前向欧拉稳定性极限的表达式：\n$$\\Delta t_{\\mathrm{FE}} = \\frac{\\Delta x}{a}$$\n因此，SSP(3,3) 方法的最大允许时间步长是：\n$$\\Delta t_{\\max} = \\frac{\\Delta x}{a}$$\n我们已知数值 $a = 1.7\\,\\mathrm{m/s}$ 和 $\\Delta x = 6.2 \\times 10^{-3}\\,\\mathrm{m}$。代入这些值，我们得到：\n$$\\Delta t_{\\max} = \\frac{6.2 \\times 10^{-3}\\,\\mathrm{m}}{1.7\\,\\mathrm{m/s}}$$\n$$\\Delta t_{\\max} \\approx 3.6470588... \\times 10^{-3}\\,\\mathrm{s}$$\n根据要求，将结果四舍五入到四位有效数字：\n$$\\Delta t_{\\max} \\approx 3.647 \\times 10^{-3}\\,\\mathrm{s}$$", "answer": "$$\\boxed{3.647 \\times 10^{-3}}$$", "id": "3350094"}, {"introduction": "“保持强稳定性”这一理论性质在实践中究竟意味着什么？本练习将通过一个具体的编程实例，将抽象概念转化为直观的视觉证据。您将对比一个SSP格式和一个非SSP格式，并亲眼观察非SSP方法如何在看似合理的步长下，仍会产生非物理的振荡（例如负值或超出初始范围的值）。这项实践将无可辩驳地证明SSP属性在确保数值解物理真实性方面的重要性。[@problem_id:3287729]", "problem": "考虑一个一维周期性定义域 $x \\in [0,1]$ 上的标量守恒律 $u_t + f(u)_x = 0$。将空间域离散为 $N$ 个均匀单元，单元宽度为 $\\Delta x = 1/N$，并用 $u_j(t)$ 表示在时间 $t$、单元索引为 $j$ 处的单元平均近似值，索引具有周期性。使用有限体积半离散化方法，并采用单调数值通量 $\\hat{f}$，使得半离散算子 $L(u)$ 的分量形式定义为\n$$\n\\left[L(u)\\right]_j = -\\frac{\\hat{f}_{j+1/2} - \\hat{f}_{j-1/2}}{\\Delta x}.\n$$\n设物理通量为 $f(u) = a\\,u$，其中 $a$ 是一个恒定的平流速度。使用局部 Lax-Friedrichs 通量，对于此线性通量，该通量简化为一阶迎风格式：\n- 如果 $a > 0$，设 $\\hat{f}_{j+1/2} = a\\,u_j$。\n- 如果 $a  0$，设 $\\hat{f}_{j+1/2} = a\\,u_{j+1}$。\n这会产生一个单调的半离散算子。\n\n使用满足最大值原理边界的单单元脉冲来初始化数据：\n$$\nu_j^0 = \\begin{cases}\n1  \\text{if } j = j^\\star,\\\\\n0  \\text{otherwise},\n\\end{cases}\n$$\n其中 $j^\\star = \\lfloor N/2 \\rfloor$。\n\n定义 Courant-Friedrichs-Lewy 数为 $r = \\frac{|a|\\,\\Delta t}{\\Delta x}$，并计算时间步长 $\\Delta t = r\\,\\frac{\\Delta x}{|a|}$。\n\n为单个时间步长实现两种显式 Runge-Kutta 时间积分器：\n1. 显式中点法（二阶，非强稳定性保持）：\n   - 阶段 1：$u^{(1)} = u^n + \\Delta t\\,L(u^n)$，\n   - 更新：$u^{n+1} = u^n + \\Delta t\\,L(u^{(1)})$。\n2. 二阶强稳定性保持 (SSP) Runge-Kutta 方法（Heun 方法）：\n   - 阶段 1：$u^{(1)} = u^n + \\Delta t\\,L(u^n)$，\n   - 阶段 2：$\\tilde{u}^{(2)} = u^{(1)} + \\Delta t\\,L(u^{(1)})$，\n   - 更新：$u^{n+1} = \\tfrac{1}{2}\\,u^n + \\tfrac{1}{2}\\,\\tilde{u}^{(2)}$。\n\n对于下面的每个测试用例，从指定的初始数据和空间离散化开始，使用每个积分器精确执行一个时间步长。对于每个得到的解 $u^{n+1}$，检查其是否满足初始边界 $[0,1]$ 的最大值原理：\n- 计算 $\\min_j u_j^{n+1}$ 和 $\\max_j u_j^{n+1}$。\n- 如果 $\\min_j u_j^{n+1} \\ge 0$ 且 $\\max_j u_j^{n+1} \\le 1$，则声明最大值原理得以保持（在比较时使用 $10^{-12}$ 的数值容差）。\n\n测试套件：\n- 对所有测试使用 $N = 100$ 和 $j^\\star = \\lfloor N/2 \\rfloor$。\n- 考虑以下 $(a,r)$ 对：\n  1. $(a,r) = (1.0, 0.25)$，\n  2. $(a,r) = (1.0, 0.50)$，\n  3. $(a,r) = (1.0, 0.60)$，\n  4. $(a,r) = (1.0, 0.95)$，\n  5. $(a,r) = (-1.0, 0.60)$，\n  6. $(a,r) = (1.0, 1.05)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于每个测试用例，列表包含两个布尔值条目，分别指示显式中点法和二阶强稳定性保持 (SSP) Runge-Kutta 方法是否保持最大值原理。最终输出必须严格按照测试套件和方法配对的顺序，即：\n$$\n\\left[\\text{MP}_{\\text{midpoint},1},\\text{MP}_{\\text{SSP2},1},\\text{MP}_{\\text{midpoint},2},\\text{MP}_{\\text{SSP2},2},\\ldots,\\text{MP}_{\\text{midpoint},6},\\text{MP}_{\\text{SSP2},6}\\right],\n$$\n其中 $\\text{MP}_{\\text{method},k}$ 是第 $k$ 个测试用例和指定方法的布尔结果。不涉及物理单位；所有量均为无量纲。", "solution": "该问题要求分析两种不同的二阶显式 Runge-Kutta 时间积分格式在应用于半离散化线性平流方程时，其保持最大值原理的特性。分析将通过实现这些格式并用一系列参数对其进行测试来完成。\n\n控制偏微分方程是标量线性平流方程，是守恒律的一种特定形式：\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial f(u)}{\\partial x} = 0\n$$\n其中物理通量函数为 $f(u) = a\\,u$，$a$ 是一个恒定的平流速度。空间域为 $x \\in [0,1]$，具有周期性边界条件。\n\n该域被离散为 $N$ 个宽度为 $\\Delta x = 1/N$ 的均匀单元。每个单元 $j$ 内的解由其单元平均值 $u_j(t)$ 表示。使用有限体积法得到的方程的半离散形式为：\n$$\n\\frac{du_j}{dt} = L(u)_j = -\\frac{\\hat{f}_{j+1/2} - \\hat{f}_{j-1/2}}{\\Delta x}\n$$\n其中 $\\hat{f}_{j+1/2}$ 是单元 $j$ 和单元 $j+1$ 之间界面上的数值通量。问题指定了一阶迎风通量，它取决于平流速度 $a$ 的符号。\n\n情况 1：$a > 0$（向右平流）\n界面 $j+1/2$ 处的通量由迎风单元（即单元 $j$）中的值确定。\n$$\n\\hat{f}_{j+1/2} = a\\,u_j\n$$\n单元 $j$ 的半离散算子变为：\n$$\nL(u)_j = -\\frac{a\\,u_j - a\\,u_{j-1}}{\\Delta x} = -\\frac{a}{\\Delta x}(u_j - u_{j-1})\n$$\n\n情况 2：$a  0$（向左平流）\n界面 $j+1/2$ 处的通量由迎风单元（即单元 $j+1$）中的值确定。\n$$\n\\hat{f}_{j+1/2} = a\\,u_{j+1}\n$$\n单元 $j$ 的半离散算子变为：\n$$\nL(u)_j = -\\frac{a\\,u_{j+1} - a\\,u_j}{\\Delta x} = -\\frac{a}{\\Delta x}(u_{j+1} - u_j)\n$$\n\n时间步长 $\\Delta t$ 通过 Courant-Friedrichs-Lewy (CFL) 数 $r$ 定义：\n$$\nr = \\frac{|a|\\,\\Delta t}{\\Delta x} \\implies \\Delta t = r \\frac{\\Delta x}{|a|}\n$$\n量 $\\Delta t \\, L(u)$ 出现在时间步进格式中。我们可以简化此项。\n\n对于 $a > 0$，有 $|a|=a$：\n$$\n\\Delta t\\, L(u)_j = \\left(r \\frac{\\Delta x}{a}\\right) \\left(-\\frac{a}{\\Delta x}(u_j - u_{j-1})\\right) = -r(u_j - u_{j-1}) = r(u_{j-1} - u_j)\n$$\n\n对于 $a  0$，有 $|a|=-a$：\n$$\n\\Delta t\\, L(u)_j = \\left(r \\frac{\\Delta x}{-a}\\right) \\left(-\\frac{a}{\\Delta x}(u_{j+1} - u_j)\\right) = r(u_{j+1} - u_j)\n$$\n这些表达式可以使用带有周期性移位的向量运算来高效实现，对此 `numpy.roll` 非常适用。\n\n初始条件是一个离散脉冲：当 $j=j^\\star = \\lfloor N/2 \\rfloor$ 时，$u_j^0 = 1$，否则 $u_j^0=0$。初始数据位于区间 $[0,1]$ 内。如果下一个时间步的解 $u_j^{n+1}$ 对所有 $j$ 也保持在这些界限内，即 $0 \\le u_j^{n+1} \\le 1$，则称最大值原理得以保持。此检查使用 $10^{-12}$ 的数值容差。\n\n我们现在为从 $u^n = u^0$ 到 $u^{n+1}$ 的单个时间步长实现两种指定的 Runge-Kutta 格式。\n\n1.  **显式中点法**（如问题中所定义）：\n    - 阶段 1：$u^{(1)} = u^n + \\Delta t\\,L(u^n)$\n    - 更新：$u^{n+1} = u^n + \\Delta t\\,L(u^{(1)})$\n    该方法具有二阶精度，但通常不具有强稳定性保持 (SSP) 特性。对于迎风半离散化，它仅在受限的 CFL 条件下（理论上为 $r \\le 0.5$）保持最大值原理。\n\n2.  **二阶强稳定性保持 (SSP) Runge-Kutta 方法（Heun 方法）**（如问题中所定义）：\n    - 阶段 1：$u^{(1)} = u^n + \\Delta t\\,L(u^n)$\n    - 阶段 2：$\\tilde{u}^{(2)} = u^{(1)} + \\Delta t\\,L(u^{(1)})$\n    - 更新：$u^{n+1} = \\tfrac{1}{2}\\,u^n + \\tfrac{1}{2}\\,\\tilde{u}^{(2)}$\n    此方法可以解释为初始状态与应用两次前向欧拉步长后的状态的凸组合。对于此半离散化，如果 $r \\le 1$，则前向欧拉法是保持最大值原理的。由于此 SSP 格式是保持最大值原理（在 $r \\le 1$ 的条件下）的操作的凸组合，因此整个格式在相同条件 $r \\le 1$ 下也保持最大值原理。\n\n求解过程如下：对于测试套件中的每个 $(a, r)$ 对，我们初始化状态向量 $u^0$。然后，对于两种时间积分器中的每一种，我们计算一个时间步长后的状态 $u^{n+1}$。接着，我们检查所得向量 $u^{n+1}$ 的最小值和最大值是否在 $[0,1]$ 内（有容差）。收集每种方法和每个测试用例的布尔结果（True 表示保持，False 表示违反）。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of checking maximum principle preservation for two RK methods.\n    \"\"\"\n    # Define problem parameters\n    N = 100\n    # j_star needs to be an integer for array indexing\n    j_star = int(np.floor(N / 2))\n    # Numerical tolerance for checking the maximum principle\n    tol = 1e-12\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (a, r) pairs\n        (1.0, 0.25),\n        (1.0, 0.50),\n        (1.0, 0.60),\n        (1.0, 0.95),\n        (-1.0, 0.60),\n        (1.0, 1.05),\n    ]\n\n    results = []\n\n    # Define the operator L_op(u, a, r) which computes delta_t * L(u).\n    # This operator directly uses the CFL number r.\n    def apply_L_times_dt(u, a, r):\n        \"\"\"\n        Applies the semi-discrete operator multiplied by the time step.\n        L(u) = - (f_j+1/2 - f_j-1/2) / dx\n        delta_t * L(u) is computed using the CFL number r.\n        \"\"\"\n        if a > 0:\n            # Upwind flux for positive advection (a > 0)\n            # Stencil uses u_j and u_{j-1}. np.roll(u, 1) gets u_{j-1}.\n            return r * (np.roll(u, 1) - u)\n        else: # a  0\n            # Upwind flux for negative advection (a  0)\n            # Stencil uses u_j and u_{j+1}. np.roll(u, -1) gets u_{j+1}.\n            return r * (np.roll(u, -1) - u)\n\n    # Define a helper function to check the maximum principle.\n    def check_mp(u, tolerance):\n        \"\"\"\n        Checks if the solution u respects the maximum principle bounds [0, 1].\n        \"\"\"\n        min_u = np.min(u)\n        max_u = np.max(u)\n        # The condition is that all values u_j must be in [0, 1].\n        # We use a tolerance for floating-point comparisons.\n        is_preserved = (min_u >= -tolerance) and (max_u = 1.0 + tolerance)\n        return is_preserved\n\n    # Main loop over test cases\n    for a, r in test_cases:\n        # Initialize the data with a single-cell spike\n        u0 = np.zeros(N, dtype=float)\n        u0[j_star] = 1.0\n\n        # 1. Explicit Midpoint Method\n        # Stage 1: u^(1) = u^n + dt*L(u^n)\n        u1_mid = u0 + apply_L_times_dt(u0, a, r)\n        # Update: u^{n+1} = u^n + dt*L(u^(1))\n        u_final_mid = u0 + apply_L_times_dt(u1_mid, a, r)\n        results.append(check_mp(u_final_mid, tol))\n\n        # 2. Strong Stability Preserving (SSP) Runge-Kutta method of order two\n        # Stage 1: u^(1) = u^n + dt*L(u^n)\n        u1_ssp = u0 + apply_L_times_dt(u0, a, r)\n        # Stage 2: u_tilde^(2) = u^(1) + dt*L(u^(1))\n        u2_tilde_ssp = u1_ssp + apply_L_times_dt(u1_ssp, a, r)\n        # Update: u^{n+1} = 0.5*u^n + 0.5*u_tilde^(2)\n        u_final_ssp = 0.5 * u0 + 0.5 * u2_tilde_ssp\n        results.append(check_mp(u_final_ssp, tol))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3287729"}, {"introduction": "SSP方法的强大之处在于其框架的通用性，它不仅限于纯平流问题。本练习将挑战一个更复杂的场景：带非线性扩散的平流-扩散方程。您将实践一套完整的分析流程：首先，分析这个更复杂的空间算子，推导出其前向欧拉格式的稳定性约束；然后，利用该约束来检验一个高阶SSPRK格式的总变差（TV）性质。这个过程将展示如何将SSP分析思想推广到新的物理模型中。[@problem_id:3366832]", "problem": "考虑具有非线性扩散的一维标量守恒律\n$$\nu_t + a\\,u_x \\;=\\; \\big(\\nu(u)\\,u_x\\big)_x,\n$$\n该方程定义在周期区间 $[0,1)$ 上，具有恒定的平流速度 $a \\in \\mathbb{R}$ 和非线性扩散系数 $\\nu(u) \\ge 0$。在具有 $N$ 个单元和网格间距 $\\Delta x = 1/N$ 的均匀网格上，采用线方法进行半离散化，使用：\n- 对平流算子 $a\\,u_x$ 使用一阶迎风差分；即 $-a D_h(u)$，其中迎风偏差取决于 $a$ 的符号。\n- 对扩散算子 $(\\nu(u)\\,u_x)_x$ 使用守恒通量形式的离散化，其中界面值由单元中心的 $\\nu(u)$ 的算术平均值计算，具体为\n$$\n\\big(\\nu(u)\\,u_x\\big)\\big|_{x_{i+\\frac12}} \\approx \\nu_{i+\\frac12} \\frac{u_{i+1}-u_i}{\\Delta x},\\quad \\nu_{i+\\frac12} = \\tfrac12\\big(\\nu(u_i)+\\nu(u_{i+1})\\big),\n$$\n因此\n$$\n\\big(\\nu(u)\\,u_x\\big)_x\\Big|_{x_i} \\approx \\frac{1}{\\Delta x}\\left(\\nu_{i+\\frac12} \\frac{u_{i+1}-u_i}{\\Delta x} - \\nu_{i-\\frac12}\\frac{u_i-u_{i-1}}{\\Delta x}\\right).\n$$\n定义半离散算子 $L(u)$ 来表示右侧项，得到常微分方程组 $u'(t)=L(u(t))$。\n\n你将使用 Shu–Osher 形式的三阶三步强稳定保持龙格－库塔方法（SSPRK$(3,3)$）进行时间步进：\n- 第一步：$u^{(1)} = u^n + \\Delta t\\,L(u^n)$。\n- 第二步：$u^{(2)} = \\tfrac34 u^n + \\tfrac14\\left(u^{(1)} + \\Delta t\\,L\\big(u^{(1)}\\big)\\right)$。\n- 第三步：$u^{n+1} = \\tfrac13 u^n + \\tfrac23\\left(u^{(2)} + \\Delta t\\,L\\big(u^{(2)}\\big)\\right)$。\n\n任务 A。从离散极值原理以及要求应用于 $u'(t)=L(u(t))$ 的前向欧拉时间步进为保证单调性的邻近值的凸组合出发，推导一个关于前向欧拉时间步长 $\\Delta t$ 的充分界。该界依赖于网格间距 $\\Delta x$、平流速度大小 $|a|$ 以及当前时刻网格上扩散系数的最大值，\n$$\n\\nu_{\\max} = \\max_i \\nu(u_i).\n$$\n你的推导必须从具有指定空间离散化的显式前向欧拉更新的系数开始，对三对角模板中的所有权重施加非负性约束，并得出一个形式为 $\\Delta t \\le f(\\Delta x, |a|, \\nu_{\\max})$ 的标量不等式。\n\n任务 B。实现一个程序，该程序：\n- 使用具有周期性边界条件的域 $[0,1)$ 和 $N=400$ 个均匀单元，因此 $\\Delta x = 1/400$。\n- 使用非线性扩散 $\\nu(u) = \\varepsilon + \\alpha |u|$，其中 $\\varepsilon = 10^{-6}$ 且 $\\alpha = 1$。\n- 将 $u(x,0)$ 初始化为以 $x=0.5$ 为中心、宽度为 $w=0.2$、振幅为 $s$ 的顶帽（矩形）剖面：\n  $$\n  u(x,0) = \\begin{cases}\n  s,  \\text{if } |x-0.5| \\le 0.1\\ \\text{(interpreting periodicity)},\\\\\n  0,  \\text{otherwise}.\n  \\end{cases}\n  $$\n  以与离散网格一致的方式实现周期性解释。\n- 使用在初始数据 $u^n$ 上计算的 $\\nu_{\\max}$，计算任务 A 中的前向欧拉时间步长界。\n- 对于下面的每个测试用例，设置时间步长 $\\Delta t = m\\,\\Delta t_{\\mathrm{FE}}$，其中 $m$ 是该用例的乘数，将解精确推进一个 SSPRK$(3,3)$ 步，并评估离散全变分是否未增加：\n  $$\n  \\mathrm{TV}(u) \\;=\\; \\sum_{i=0}^{N-1} \\big|u_{i+1} - u_i\\big|,\\quad \\text{with }u_N:=u_0.\n  $$\n  报告一个布尔值，当且仅当 $\\mathrm{TV}(u^{n+1}) \\le \\mathrm{TV}(u^n)$（在 $10^{-12}$ 的数值容差内）时，该值为真。\n- 将所有测试用例的布尔结果汇总到单行输出中，其中包含用方括号括起来的逗号分隔列表。\n\n测试套件。使用以下五个测试用例，每个用例由三元组 $(a,s,m)$ 指定：\n1. $(a,s,m) = (1.0,\\,10^{-3},\\,0.95)$\n2. $(a,s,m) = (1.0,\\,10^{-3},\\,1.00)$\n3. $(a,s,m) = (1.0,\\,10^{-3},\\,1.50)$\n4. $(a,s,m) = (0.0,\\,1.0,\\,1.00)$\n5. $(a,s,m) = (0.0,\\,1.0,\\,2.00)$\n\n最终输出格式。你的程序应生成单行输出，其中包含与上述五个测试用例顺序对应的、用方括号括起来的逗号分隔列表（例如，“[True,False,True,True,False]”）。不应打印任何其他文本。", "solution": "本解答处理计算流体动力学中的一个问题，涉及一维标量平流-扩散方程的数值解。任务有两部分：首先，推导前向欧拉方法保持单调性的一个充分时间步长限制；其次，实现一个高阶强稳定保持龙格-库塔（SSPRK）格式，以验证与全变分相关的理论稳定性。\n\n### 任务 A：前向欧拉时间步长界的推导\n\n问题考虑的是具有非线性扩散的一维标量守恒律：\n$$\nu_t + a\\,u_x \\;=\\; \\big(\\nu(u)\\,u_x\\big)_x\n$$\n这可以写成 $u_t = L(u)$ 的形式，其中 $L(u)$ 是空间算子：\n$$\nL(u) = -a\\,u_x + \\big(\\nu(u)\\,u_x\\big)_x\n$$\n我们在间距为 $\\Delta x$ 的均匀网格上进行线方法半离散化。设 $u_i(t)$ 是在网格点 $x_i = i\\Delta x$ 处对 $u(x_i, t)$ 的近似。半离散常微分方程组为 $u_i'(t) = L_h(u)_i$，其中 $L_h$ 是离散空间算子。\n\n**1. 空间离散化**\n\n算子 $L_h(u)_i$ 由平流部分 $L_{adv}$ 和扩散部分 $L_{diff}$ 组成。\n\n- **平流项 $L_{adv}(u)_i = -a\\,(u_x)_i$**：使用一阶迎风差分，其近似取决于平流速度 $a$ 的符号。\n  - 如果 $a > 0$，信息从左向右传播，因此我们使用后向差分：\n    $$\n    L_{adv}(u)_i = -a \\frac{u_i - u_{i-1}}{\\Delta x}\n    $$\n  - 如果 $a  0$，信息从右向左传播，因此我们使用前向差分：\n    $$\n    L_{adv}(u)_i = -a \\frac{u_{i+1} - u_i}{\\Delta x}\n    $$\n- **扩散项 $L_{diff}(u)_i = \\big((\\nu(u)u_x)_x\\big)_i$**：使用指定的守恒中心差分格式：\n  $$\n  L_{diff}(u)_i = \\frac{1}{\\Delta x}\\left(\\nu_{i+\\frac12} \\frac{u_{i+1}-u_i}{\\Delta x} - \\nu_{i-\\frac12}\\frac{u_i-u_{i-1}}{\\Delta x}\\right)\n  $$\n  其中 $\\nu_{i+\\frac12} = \\frac{1}{2}\\big(\\nu(u_i)+\\nu(u_{i+1})\\big)$。\n\n**2. 前向欧拉更新与单调性**\n\n对于 $u_i' = L_h(u)_i$ 的前向欧拉时间步进方法由下式给出：\n$$\nu_i^{n+1} = u_i^n + \\Delta t L_h(u^n)_i\n$$\n为确保单调性（这意味着离散极值原理，并且是守恒律全变分递减的充分条件），$u_i^{n+1}$ 的更新必须是其在时间 $n$ 的邻近点 $u_{i-1}^n$、$u_i^n$ 和 $u_{i+1}^n$ 的凸组合。这意味着我们可以写成：\n$$\nu_i^{n+1} = C_{i-1} u_{i-1}^n + C_{i} u_i^n + C_{i+1} u_{i+1}^n\n$$\n其中系数 $C_{i-1}, C_i, C_{i+1} \\ge 0$ 为非负且和为一。\n\n让我们用模板值 $u_{i-1}^n, u_i^n, u_{i+1}^n$ 来表示 $L_h(u^n)_i$。无论 $a$ 的符号如何，迎风平流项和中心扩散项对 $u_i$ 系数的贡献分别为 $-\\frac{|a|}{\\Delta x}$ 和 $-\\frac{\\nu_{i+\\frac12} + \\nu_{i-\\frac12}}{\\Delta x^2}$。\n完整的算子可以写为：\n$$\nL_h(u)_i = (\\text{...})u_{i-1} - \\left(\\frac{|a|}{\\Delta x} + \\frac{\\nu_{i+\\frac12} + \\nu_{i-\\frac12}}{\\Delta x^2}\\right)u_i + (\\text{...})u_{i+1}\n$$\n将此代入前向欧拉公式，并关注 $u_i^n$ 的系数：\n$$\nu_i^{n+1} = \\dots + \\underbrace{\\left(1 - \\Delta t \\left(\\frac{|a|}{\\Delta x} + \\frac{\\nu_{i+\\frac12} + \\nu_{i-\\frac12}}{\\Delta x^2}\\right)\\right)}_{C_i} u_i^n + \\dots\n$$\n由于迎风和扩散模板的性质（其中非对角项是非负的），对于 $\\Delta t > 0$，$u_{i-1}^n$ 和 $u_{i+1}^n$ 的系数将是非负的。因此，为使更新成为一个凸组合，单调性的关键约束来自于要求系数 $C_i$ 为非负：\n$$\n1 - \\Delta t \\left(\\frac{|a|}{\\Delta x} + \\frac{\\nu_{i+\\frac12} + \\nu_{i-\\frac12}}{\\Delta x^2}\\right) \\ge 0\n$$\n这个不等式必须对所有网格点 $i$ 成立。解出 $\\Delta t$：\n$$\n\\Delta t \\le \\frac{1}{\\frac{|a|}{\\Delta x} + \\frac{\\nu_{i+\\frac12} + \\nu_{i-\\frac12}}{\\Delta x^2}}\n$$\n为了获得一个对整个网格都有效的时间步长约束，我们必须对所有 $i$ 的“最坏情况”分母满足这个不等式。这通过最大化分母来实现。项 $\\nu_{i+\\frac12} + \\nu_{i-\\frac12}$ 可以展开并进行界定。设 $\\nu_{\\max} = \\max_j \\nu(u_j^n)$ 是在当前时间 $t_n$ 网格上扩散系数的最大值。我们可以建立一个上界：\n$$\n\\nu_{i+\\frac12} = \\frac{\\nu(u_i)+\\nu(u_{i+1})}{2} \\le \\frac{\\nu_{\\max}+\\nu_{\\max}}{2} = \\nu_{\\max}\n$$\n因此：\n$$\n\\nu_{i+\\frac12} + \\nu_{i-\\frac12} \\le \\nu_{\\max} + \\nu_{\\max} = 2\\nu_{\\max}\n$$\n将此界代入 $\\Delta t$ 的不等式中，得到一个更严格但充分的全局条件：\n$$\n\\Delta t \\le \\frac{1}{\\frac{|a|}{\\Delta x} + \\frac{2\\nu_{\\max}}{\\Delta x^2}}\n$$\n这可以重排为最终形式，它表示前向欧拉方法保持单调性的充分时间步长界：\n$$\n\\Delta t \\le \\frac{\\Delta x^2}{|a|\\Delta x + 2\\nu_{\\max}}\n$$\n这个界类似于一个组合的CFL条件，包括平流的CFL条件（$\\Delta t \\le \\Delta x/|a|$）和扩散的von Neumann稳定性条件（$\\Delta t \\le \\Delta x^2/(2\\nu_{\\max})$）。\n\n### 任务 B：数值验证\n\n第二个任务是数值验证 SSPRK$(3,3)$ 方法的性质。SSP 方法的设计宗旨是，如果时间步长为 $\\Delta t_{FE}$ 的前向欧拉（FE）步满足某个稳定性属性（例如全变分递减，TVD），那么只要时间步长 $\\Delta t$ 受限于 $\\Delta t \\le c \\cdot \\Delta t_{FE}$（其中 $c$ 是 SSP 系数），高阶 SSPRK 步也满足该属性。对于给定的 SSPRK$(3,3)$ 方法，系数为 $c=1$。\n我们推导的界是针对单调性的，这是 TVD 属性的一个充分条件。因此，我们将使用 $\\Delta t_{\\mathrm{FE}} = \\frac{\\Delta x^2}{|a|\\Delta x + 2\\nu_{\\max}}$。数值实验将测试对于不同的乘数 $m$，当 $\\Delta t = m \\cdot \\Delta t_{\\mathrm{FE}}$ 时，该格式是否是 TVD 的（即 $\\mathrm{TV}(u^{n+1}) \\le \\mathrm{TV}(u^n)$）。我们预期当 $m \\le 1$ 时该属性成立，而当 $m > 1$ 时不成立。因此，实现将针对五个测试用例，在执行一个 SSPRK$(3,3)$ 步后计算解，并报告全变分是否未增加。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D advection-diffusion problem using SSPRK(3,3) and verifies\n    the Total Variation Diminishing (TVD) property for several test cases.\n    \"\"\"\n    \n    # --- Problem Parameters ---\n    N = 400\n    DX = 1.0 / N\n    EPS = 1e-6\n    ALPHA = 1.0\n    TOL = 1e-12\n\n    # --- Test Cases (a, s, m) ---\n    test_cases = [\n        (1.0, 1e-3, 0.95),\n        (1.0, 1e-3, 1.00),\n        (1.0, 1e-3, 1.50),\n        (0.0, 1.0, 1.00),\n        (0.0, 1.0, 2.00)\n    ]\n\n    results = []\n\n    # --- Grid Setup ---\n    # Finite difference grid points x_i = i * Delta x\n    x = np.arange(N) * DX\n\n    def L_operator(u, a):\n        \"\"\"\n        Computes the semi-discrete spatial operator L(u) = -a*u_x + (nu(u)*u_x)_x.\n        \"\"\"\n        # Periodic boundary conditions using numpy.roll\n        u_im1 = np.roll(u, 1)\n        u_ip1 = np.roll(u, -1)\n        \n        # --- Advection Term (First-Order Upwind) ---\n        if a > 0:\n            L_adv = -a * (u - u_im1) / DX\n        elif a  0:\n            L_adv = -a * (u_ip1 - u) / DX\n        else: # a == 0\n            L_adv = np.zeros_like(u)\n\n        # --- Diffusion Term (Conservative Finite Difference) ---\n        nu_u = EPS + ALPHA * np.abs(u)\n        nu_u_ip1 = np.roll(nu_u, -1)\n        \n        # Interface diffusion coefficients (arithmetic mean)\n        nu_ip1_2 = 0.5 * (nu_u + nu_u_ip1)\n        \n        # Interface fluxes\n        flux_diff_ip1_2 = nu_ip1_2 * (u_ip1 - u) / DX\n        flux_diff_im1_2 = np.roll(flux_diff_ip1_2, 1)\n        \n        L_diff = (flux_diff_ip1_2 - flux_diff_im1_2) / DX\n        \n        return L_adv + L_diff\n\n    def total_variation(u):\n        \"\"\"\n        Computes the discrete total variation of a periodic array u.\n        TV(u) = sum |u_{i+1} - u_i|\n        \"\"\"\n        u_ip1 = np.roll(u, -1)\n        return np.sum(np.abs(u_ip1 - u))\n\n    for case in test_cases:\n        a, s, m = case\n\n        # --- Initial Condition: Top-hat profile ---\n        # u(x,0) = s if |x-0.5| = 0.1, else 0.\n        # This corresponds to x in [0.4, 0.6].\n        u_n = np.zeros(N)\n        # We interpret |x-0.5| = 0.1 to mean x inclusive of 0.4 and 0.6.\n        # This implies grid points with index i s.t. x_i is in [0.4, 0.6].\n        u_n[np.where(np.logical_and(x >= 0.4, x = 0.6))] = s\n\n        # --- Time Step Calculation ---\n        # Evaluate nu_max on initial data\n        nu_on_u = EPS + ALPHA * np.abs(u_n)\n        nu_max = np.max(nu_on_u)\n        \n        # Forward Euler time step bound from Task A\n        denominator = np.abs(a) * DX + 2 * nu_max\n        if denominator > 1e-15:\n            dt_fe = DX**2 / denominator\n        else: # Avoid division by zero if a=0 and nu_max is close to 0\n            dt_fe = float('inf')\n        \n        dt = m * dt_fe\n        \n        # --- TVD Check ---\n        tv_n = total_variation(u_n)\n\n        # --- SSPRK(3,3) single step ---\n        # Stage 1\n        L0 = L_operator(u_n, a)\n        u1 = u_n + dt * L0\n        \n        # Stage 2\n        L1 = L_operator(u1, a)\n        u2 = 0.75 * u_n + 0.25 * (u1 + dt * L1)\n        \n        # Stage 3\n        L2 = L_operator(u2, a)\n        u_n1 = (1.0/3.0) * u_n + (2.0/3.0) * (u2 + dt * L2)\n        \n        tv_n1 = total_variation(u_n1)\n        \n        # Check if TV has not increased, within a tolerance\n        is_tvd = tv_n1 = tv_n + TOL\n        results.append(is_tvd)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3366832"}]}