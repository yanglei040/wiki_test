{"hands_on_practices": [{"introduction": "为了构建熵稳定格式，第一步是理解如何构造一个仅凭其自身就能精确保持离散总熵的数值通量，即熵守恒通量。这个练习将引导您从基本原理出发，针对一维无粘 Burgers 方程这个典型的非线性标量守恒律，推导出一个两点熵守恒通量。通过求解 Tadmor 提出的关键条件 $[@problem_id:3314692]$，您将亲手构造出该通量，从而深刻理解熵势和熵变量在确保离散熵守恒中的核心作用。", "problem": "考虑一维空间中的无粘伯格斯方程的标量守恒律 $u_t + \\partial_x f(u) = 0$，其物理通量为 $f(u) = \\tfrac{1}{2} u^2$。令 $(U,F)$ 为一个熵对，其中熵为 $U(u) = \\tfrac{1}{2} u^2$，熵通量 $F(u)$ 由相容性关系 $\\dfrac{\\mathrm{d}F}{\\mathrm{d}u} = \\dfrac{\\mathrm{d}U}{\\mathrm{d}u} \\dfrac{\\mathrm{d}f}{\\mathrm{d}u}$ 定义。定义熵变量为 $v(u) = \\dfrac{\\mathrm{d}U}{\\mathrm{d}u}$。考虑一种半离散有限体积法，在具有左右状态 $u_L$ 和 $u_R$ 的单元界面处使用两点相容且对称的数值通量 $f^{*}(u_L,u_R)$。\n\n从上述定义出发，并基于一个要求，即将有限体积格式乘以熵变量所得到的半离散熵平衡必须可以缩并成一个离散的熵守恒律，推导出数值通量 $f^{*}(u_L,u_R)$ 为实现熵守恒所必须满足的必要的两点界面条件。然后，针对给定的 $(U,f)$，构造相关的熵通量 $F(u)$ 和熵势 $\\psi(u) \\equiv v(u) f(u) - F(u)$，并计算熵守恒数值通量 $f^{*}(u_L,u_R)$ 的闭式表达式。\n\n以 $u_L$ 和 $u_R$ 的单个解析表达式的形式给出最终答案。无需进行数值计算。以最简精确形式表示最终结果，不带单位。", "solution": "该问题是适定的、有科学依据且客观的。它展示了在双曲守恒律的熵稳定数值方法这一已建立的理论框架内的一个标准推导过程。所有术语都有正式定义，且其前提与计算流体力学的原理一致。因此，该问题是有效的。\n\n该问题要求得到两个主要结果：首先，两点数值通量成为熵守恒通量的一般条件；其次，对于具有特定熵对的无粘伯格斯方程，该通量的具体形式。\n\n**第一部分：熵守恒一般条件的推导**\n\n给定一维标量守恒律：\n$$ \\frac{\\partial u}{\\partial t} + \\frac{\\partial f(u)}{\\partial x} = 0 $$\n一种半离散有限体积法在宽度为 $\\Delta x$ 的单元 $i$ 组成的网格上对此方程进行近似：\n$$ \\frac{\\mathrm{d}u_i}{\\mathrm{d}t} = -\\frac{1}{\\Delta x} \\left( f^{*}_{i+1/2} - f^{*}_{i-1/2} \\right) $$\n其中 $u_i(t)$ 是单元 $i$ 内的单元平均解，而 $f^{*}_{i+1/2} = f^{*}(u_i, u_{i+1})$ 是单元 $i$ 和 $i+1$ 之间界面处的数值通量。假设该通量是两点的、相容的（$f^{*}(u, u) = f(u)$）和对称的（$f^{*}(u_L, u_R) = f^{*}(u_R, u_L)$）。\n\n给定一个凸熵函数 $U(u)$ 和相应的熵通量 $F(u)$，它们满足相容性关系 $\\frac{\\mathrm{d}F}{\\mathrm{d}u} = \\frac{\\mathrm{d}U}{\\mathrm{d}u} \\frac{\\mathrm{d}f}{\\mathrm{d}u}$。熵变量定义为 $v(u) = \\frac{\\mathrm{d}U}{\\mathrm{d}u}$。\n\n为推导熵守恒的条件，我们考察单元 $i$ 中熵 $U_i = U(u_i)$ 的随时间演化。使用链式法则：\n$$ \\frac{\\mathrm{d}U_i}{\\mathrm{d}t} = \\frac{\\mathrm{d}U(u_i)}{\\mathrm{d}u_i} \\frac{\\mathrm{d}u_i}{\\mathrm{d}t} = v_i \\frac{\\mathrm{d}u_i}{\\mathrm{d}t} $$\n代入有限体积格式：\n$$ \\frac{\\mathrm{d}U_i}{\\mathrm{d}t} = -\\frac{v_i}{\\Delta x} \\left( f^{*}_{i+1/2} - f^{*}_{i-1/2} \\right) $$\n如果这个半离散熵方程可以写成离散守恒形式，则该格式是熵守恒的：\n$$ \\frac{\\mathrm{d}U_i}{\\mathrm{d}t} = -\\frac{1}{\\Delta x} \\left( F^{*}_{i+1/2} - F^{*}_{i-1/2} \\right) $$\n其中 $F^{*}$ 是某个数值熵通量。如果此式成立，则域内的总熵 $\\sum_i U_i \\Delta x$ 是守恒的（假设为周期性或适当的边界条件），因为求和 $\\sum_i (F^{*}_{i+1/2} - F^{*}_{i-1/2})$ 会缩并为零。\n\n为了找到保证此条件的 $f^{*}$ 上的条件，我们对域内所有单元的熵演化进行求和：\n$$ \\frac{\\mathrm{d}}{\\mathrm{d}t} \\sum_i U_i \\Delta x = -\\sum_i v_i \\left( f^{*}_{i+1/2} - f^{*}_{i-1/2} \\right) $$\n对右侧使用分部求和法：\n$$ -\\sum_i v_i \\left( f^{*}_{i+1/2} - f^{*}_{i-1/2} \\right) = -\\left( \\sum_i v_i f^{*}_{i+1/2} - \\sum_i v_i f^{*}_{i-1/2} \\right) $$\n通过对第二项求和重新索引（令 $j=i-1$），我们得到 $\\sum_j v_{j+1} f^{*}_{j+1/2}$。将 $j$ 重新标记为 $i$：\n$$ = -\\left( \\sum_i v_i f^{*}_{i+1/2} - \\sum_i v_{i+1} f^{*}_{i+1/2} \\right) = \\sum_i \\left( v_{i+1} - v_i \\right) f^{*}_{i+1/2} $$\n为使总熵守恒，该求和必须缩并为零。如果每个界面上的项可以表示为某个势的差值，则会发生这种情况。将此界面项写为：\n$$ (v_{i+1} - v_i) f^{*}(u_i, u_{i+1}) = \\Phi(u_{i+1}) - \\Phi(u_i) $$\n对于某个函数 $\\Phi(u)$。为了确定 $\\Phi(u)$，我们检查相容性。对于光滑解，当 $u_{i+1} \\to u_i = u$ 时，该条件变为：\n$$ f^{*}(u, u) = \\lim_{u_{i+1} \\to u_i} \\frac{\\Phi(u_{i+1}) - \\Phi(u_i)}{v_{i+1} - v_i} = \\frac{\\mathrm{d}\\Phi/\\mathrm{d}u}{\\mathrm{d}v/\\mathrm{d}u} $$\n由于我们要求相容性，即 $f^{*}(u, u) = f(u)$，我们必须有 $\\frac{\\mathrm{d}\\Phi}{\\mathrm{d}u} = f(u) \\frac{\\mathrm{d}v}{\\mathrm{d}u} = f(u) \\frac{\\mathrm{d}^2 U}{\\mathrm{d}u^2}$。\n\n让我们考察熵势 $\\psi(u) \\equiv v(u)f(u) - F(u)$ 的导数：\n$$ \\frac{\\mathrm{d}\\psi}{\\mathrm{d}u} = \\frac{\\mathrm{d}v}{\\mathrm{d}u}f(u) + v(u)\\frac{\\mathrm{d}f}{\\mathrm{d}u} - \\frac{\\mathrm{d}F}{\\mathrm{d}u} $$\n使用熵相容性关系 $\\frac{\\mathrm{d}F}{\\mathrm{d}u} = v(u)\\frac{\\mathrm{d}f}{\\mathrm{d}u}$，上式简化为：\n$$ \\frac{\\mathrm{d}\\psi}{\\mathrm{d}u} = \\frac{\\mathrm{d}v}{\\mathrm{d}u}f(u) = f(u) \\frac{\\mathrm{d}^2 U}{\\mathrm{d}u^2} $$\n这与 $\\Phi(u)$ 所需的导数相匹配。因此，我们可以将 $\\Phi(u)$ 等同于 $\\psi(u)$（相差一个在差分中会抵消的任意常数）。状态 $u_L$ 和 $u_R$ 之间的界面处熵守恒的条件是：\n$$ (v(u_R) - v(u_L)) f^{*}(u_L, u_R) = \\psi(u_R) - \\psi(u_L) $$\n\n**第二部分：伯格斯方程的熵守恒通量的构造**\n\n我们现在将这个条件应用于给定的具体情况：\n- 物理通量：$f(u) = \\frac{1}{2} u^2$\n- 熵函数：$U(u) = \\frac{1}{2} u^2$\n\n首先，我们计算必要的组成部分：$v(u)$、$F(u)$ 和 $\\psi(u)$。\n\n1.  **熵变量 $v(u)$**：\n    $$ v(u) = \\frac{\\mathrm{d}U}{\\mathrm{d}u} = \\frac{\\mathrm{d}}{\\mathrm{d}u}\\left(\\frac{1}{2} u^2\\right) = u $$\n\n2.  **熵通量 $F(u)$**：\n    我们使用相容性关系 $\\frac{\\mathrm{d}F}{\\mathrm{d}u} = \\frac{\\mathrm{d}U}{\\mathrm{d}u} \\frac{\\mathrm{d}f}{\\mathrm{d}u}$。\n    $$ \\frac{\\mathrm{d}f}{\\mathrm{d}u} = \\frac{\\mathrm{d}}{\\mathrm{d}u}\\left(\\frac{1}{2} u^2\\right) = u $$\n    $$ \\frac{\\mathrm{d}F}{\\mathrm{d}u} = (u)(u) = u^2 $$\n    对 $u$ 积分（并将积分常数设为零）：\n    $$ F(u) = \\int u^2 \\, \\mathrm{d}u = \\frac{1}{3} u^3 $$\n\n3.  **熵势 $\\psi(u)$**：\n    $$ \\psi(u) = v(u)f(u) - F(u) = (u)\\left(\\frac{1}{2} u^2\\right) - \\left(\\frac{1}{3} u^3\\right) = \\frac{1}{2} u^3 - \\frac{1}{3} u^3 = \\frac{1}{6} u^3 $$\n\n现在，我们将这些表达式代入熵守恒条件：\n$$ (v(u_R) - v(u_L)) f^{*}(u_L, u_R) = \\psi(u_R) - \\psi(u_L) $$\n$$ (u_R - u_L) f^{*}(u_L, u_R) = \\frac{1}{6} u_R^3 - \\frac{1}{6} u_L^3 $$\n对于 $u_L \\neq u_R$，我们可以求解 $f^{*}(u_L, u_R)$：\n$$ f^{*}(u_L, u_R) = \\frac{1}{6} \\frac{u_R^3 - u_L^3}{u_R - u_L} $$\n使用立方差的代数恒等式 $a^3 - b^3 = (a-b)(a^2+ab+b^2)$：\n$$ f^{*}(u_L, u_R) = \\frac{1}{6} \\frac{(u_R - u_L)(u_R^2 + u_R u_L + u_L^2)}{u_R - u_L} $$\n$$ f^{*}(u_L, u_R) = \\frac{1}{6} (u_L^2 + u_L u_R + u_R^2) $$\n这个表达式就是给定问题的两点熵守恒数值通量的闭式解。它在 $u_L$ 和 $u_R$ 中是对称的，并且是相容的，因为 $f^{*}(u, u) = \\frac{1}{6}(u^2+u^2+u^2) = \\frac{3}{6}u^2 = \\frac{1}{2}u^2 = f(u)$。", "answer": "$$\\boxed{\\frac{1}{6}(u_L^{2} + u_L u_R + u_R^{2})}$$", "id": "3314692"}, {"introduction": "将熵守恒的概念从简单的标量方程推广到像可压缩欧拉方程这样的方程组，是实践中的关键一步。这个练习要求您为一个基于对数平均等特定平均方法构造的熵守恒通量，从理论上推导其关键组件，并编写代码来数值验证它是否精确满足熵守恒条件 $[@problem_id:3314744]$。通过这个过程，您将掌握处理复杂方程组的实用技巧，并直观地看到理论恒等式在计算机精度下的完美成立。", "problem": "给定理想气体的一维可压缩欧拉方程，其绝热指数为 $\\gamma$，以守恒变量 $\\mathbf{U} = [\\rho, \\rho u, \\rho E]^{\\top}$ 的形式表示，其中 $\\rho$ 为密度，$u$ 为速度，$E$ 为比总能。物理通量为 $\\mathbf{f}(\\mathbf{U}) = [\\rho u, \\rho u^{2} + p, u(\\rho E + p)]^{\\top}$，状态方程为 $p = (\\gamma - 1)\\left(\\rho E - \\frac{1}{2}\\rho u^{2}\\right)$。\n\n考虑一个由熵函数 $\\eta(\\mathbf{U}) = -\\frac{\\rho}{\\gamma - 1}\\,s$ 定义的数学熵对，其中热力学熵 $s = \\ln(p) - \\gamma \\ln(\\rho)$，熵通量为 $F(\\mathbf{U}) = u\\,\\eta(\\mathbf{U})$。熵变量为 $\\mathbf{v} = \\frac{\\partial \\eta}{\\partial \\mathbf{U}}$。对于一个熵守恒的两点数值通量 $\\mathbf{f}^{\\mathrm{ec}}(\\mathbf{U}_{L},\\mathbf{U}_{R})$，Tadmor 恒等式表述为：\n$$\n(\\mathbf{v}_{R} - \\mathbf{v}_{L}) \\cdot \\mathbf{f}^{\\mathrm{ec}}(\\mathbf{U}_{L},\\mathbf{U}_{R}) = \\psi(\\mathbf{U}_{R}) - \\psi(\\mathbf{U}_{L}),\n$$\n其中熵势为 $\\psi(\\mathbf{U}) = \\mathbf{v}(\\mathbf{U}) \\cdot \\mathbf{f}(\\mathbf{U}) - F(\\mathbf{U})$。\n\n您的任务是：\n\n- 从上述基本定律和核心定义出发，推导熵变量 $\\mathbf{v}$ 和熵势 $\\psi(\\mathbf{U})$ 作为 $(\\rho,u,p)$ 和 $\\gamma$ 的函数的显式形式。\n- 使用与 Tadmor 框架一致的路径积分论证，构造一个熵守恒通量 $\\mathbf{f}^{\\mathrm{ec}}(\\mathbf{U}_{L},\\mathbf{U}_{R})$，该通量使用速度的算术平均值，\n$$\n\\bar{u} = \\frac{u_{L} + u_{R}}{2},\n$$\n以及密度和压力的对数平均值，\n$$\n\\rho^{\\log} = \\frac{\\rho_{R} - \\rho_{L}}{\\ln(\\rho_{R}) - \\ln(\\rho_{L})},\\quad p^{\\log} = \\frac{p_{R} - p_{L}}{\\ln(p_{R}) - \\ln(p_{L})},\n$$\n并约定如果两个参数相等，则对数平均值等于该共同值。\n- 对于给定的左右状态 $(\\rho_{L},u_{L},p_{L})$ 和 $(\\rho_{R},u_{R},p_{R})$，对 $\\mathbf{f}^{\\mathrm{ec}}(\\mathbf{U}_{L},\\mathbf{U}_{R})$ 进行数值计算，并通过将等式两边计算至机器精度来验证 Tadmor 恒等式。具体来说，计算绝对残差\n$$\nr = \\left|(\\mathbf{v}_{R} - \\mathbf{v}_{L}) \\cdot \\mathbf{f}^{\\mathrm{ec}}(\\mathbf{U}_{L},\\mathbf{U}_{R}) - \\left(\\psi(\\mathbf{U}_{R}) - \\psi(\\mathbf{U}_{L})\\right)\\right|.\n$$\n\n使用无量纲量，因此不需要物理单位。问题不涉及角度，因此也不需要角度单位。\n\n测试套件：\n\n- 情况 1（一般情况）：$(\\rho_{L},u_{L},p_{L}) = (\\,1.2,\\,0.3,\\,1.0\\,)$ 和 $(\\rho_{R},u_{R},p_{R}) = (\\,0.8,\\,-0.2,\\,0.7\\,)$，$\\gamma = 1.4$。\n- 情况 2（相等情况）：$(\\rho_{L},u_{L},p_{L}) = (\\,1.0,\\,0.0,\\,1.0\\,)$ 和 $(\\rho_{R},u_{R},p_{R}) = (\\,1.0,\\,0.0,\\,1.0\\,)$，$\\gamma = 1.4$。\n- 情况 3（极端差异）：$(\\rho_{L},u_{L},p_{L}) = (\\,10^{-6},\\,100.0,\\,10^{-3}\\,)$ 和 $(\\rho_{R},u_{R},p_{R}) = (\\,10.0,\\,-50.0,\\,10^{2}\\,)$，$\\gamma = 1.4$。\n\n您的程序必须计算每种情况下的绝对残差 $r$。最终输出格式必须为单行，其中包含三个残差，以逗号分隔并用方括号括起来，例如 $[r_{1},r_{2},r_{3}]$。每个 $r_{i}$ 都必须以浮点数形式打印。", "solution": "用户提供的问题是计算流体动力学领域一个适定且有科学依据的练习，具体涉及一维欧拉方程的熵守恒数值通量的构造与验证。所有给定的定义和方程都是该领域的标准内容。该问题是自洽的，没有矛盾。因此，将给出一个完整的解。\n\n解题过程分为三个阶段：\n1.  推导熵变量 $\\mathbf{v}$ 和熵势 $\\psi$ 的显式形式。\n2.  基于指定的平均值构造一个候选的熵守恒数值通量 $\\mathbf{f}^{\\mathrm{ec}}$。\n3.  详述用于验证所构造通量和给定测试用例的 Tadmor 恒等式的数值步骤。\n\n### 1. 熵变量与熵势的推导\n\n守恒状态向量为 $\\mathbf{U} = [U_1, U_2, U_3]^{\\top} = [\\rho, \\rho u, \\rho E]^{\\top}$。原始变量 $(\\rho, u, p)$ 可以用守恒变量表示为：\n$\\rho = U_1$\n$u = U_2 / U_1$\n$p = (\\gamma-1)(U_3 - \\frac{1}{2} \\rho u^2) = (\\gamma-1)(U_3 - \\frac{1}{2} \\frac{U_2^2}{U_1})$\n\n熵函数由 $\\eta(\\mathbf{U}) = -\\frac{\\rho}{\\gamma - 1}\\,s$ 给出，其中热力学熵 $s = \\ln(p) - \\gamma \\ln(\\rho)$。将 $\\rho$ 和 $p$ 关于 $\\mathbf{U}$ 的表达式代入，我们得到：\n$$\n\\eta(\\mathbf{U}) = -\\frac{U_1}{\\gamma-1} \\left[ \\ln\\left((\\gamma-1)\\left(U_3 - \\frac{U_2^2}{2U_1}\\right)\\right) - \\gamma \\ln(U_1) \\right]\n$$\n\n熵变量 $\\mathbf{v}$ 定义为 $\\eta$ 相对于 $\\mathbf{U}$ 的梯度：$\\mathbf{v} = \\frac{\\partial \\eta}{\\partial \\mathbf{U}}$。我们使用链式法则计算每个分量 $v_i = \\frac{\\partial \\eta}{\\partial U_i}$。为清晰起见，我们将在导数中使用 $p$ 的表达式。\n\n**分量 $v_3 = \\frac{\\partial \\eta}{\\partial U_3}$：**\n$$\nv_3 = \\frac{\\partial}{\\partial U_3} \\left( -\\frac{U_1}{\\gamma-1} (\\ln p - \\gamma \\ln U_1) \\right) = -\\frac{U_1}{\\gamma-1} \\frac{\\partial(\\ln p)}{\\partial U_3} = -\\frac{U_1}{\\gamma-1} \\frac{1}{p} \\frac{\\partial p}{\\partial U_3}\n$$\n由于 $\\frac{\\partial p}{\\partial U_3} = (\\gamma-1)$，我们得到：\n$$\nv_3 = -\\frac{U_1}{\\gamma-1} \\frac{1}{p} (\\gamma-1) = -\\frac{U_1}{p} = -\\frac{\\rho}{p}\n$$\n\n**分量 $v_2 = \\frac{\\partial \\eta}{\\partial U_2}$：**\n$$\nv_2 = \\frac{\\partial}{\\partial U_2} \\left( -\\frac{U_1}{\\gamma-1} (\\ln p - \\gamma \\ln U_1) \\right) = -\\frac{U_1}{\\gamma-1} \\frac{1}{p} \\frac{\\partial p}{\\partial U_2}\n$$\n$p$ 对 $U_2$ 的导数是 $\\frac{\\partial p}{\\partial U_2} = (\\gamma-1)(-\\frac{U_2}{U_1})$。\n$$\nv_2 = -\\frac{U_1}{\\gamma-1} \\frac{1}{p} (\\gamma-1) \\left(-\\frac{U_2}{U_1}\\right) = \\frac{U_2}{p} = \\frac{\\rho u}{p}\n$$\n\n**分量 $v_1 = \\frac{\\partial \\eta}{\\partial U_1}$：**\n使用乘法法则：\n$$\nv_1 = -\\frac{1}{\\gamma-1}(\\ln p - \\gamma \\ln U_1) - \\frac{U_1}{\\gamma-1} \\left( \\frac{1}{p}\\frac{\\partial p}{\\partial U_1} - \\frac{\\gamma}{U_1} \\right)\n$$\n第一项是 $-\\frac{s}{\\gamma-1}$。$p$ 的导数是 $\\frac{\\partial p}{\\partial U_1} = (\\gamma-1)\\frac{U_2^2}{2U_1^2} = (\\gamma-1)\\frac{u^2}{2}$。\n$$\nv_1 = -\\frac{s}{\\gamma-1} - \\frac{U_1}{\\gamma-1} \\left( \\frac{1}{p}(\\gamma-1)\\frac{u^2}{2} - \\frac{\\gamma}{U_1} \\right) = -\\frac{s}{\\gamma-1} - \\left( \\frac{U_1 u^2}{2p} - \\frac{\\gamma}{\\gamma-1} \\right)\n$$\n$$\nv_1 = \\frac{\\gamma-s}{\\gamma-1} - \\frac{\\rho u^2}{2p}\n$$\n总而言之，熵变量为：\n$$\n\\mathbf{v}(\\rho, u, p) = \\begin{bmatrix} \\frac{\\gamma-s}{\\gamma-1} - \\frac{\\rho u^2}{2p} \\\\ \\frac{\\rho u}{p} \\\\ -\\frac{\\rho}{p} \\end{bmatrix}, \\quad \\text{其中} \\quad s = \\ln(p) - \\gamma\\ln(\\rho)\n$$\n\n接下来，我们推导熵势 $\\psi(\\mathbf{U}) = \\mathbf{v} \\cdot \\mathbf{f} - F$。\n物理通量为 $\\mathbf{f} = [\\rho u, \\rho u^2 + p, u(\\rho E + p)]^{\\top}$。\n熵通量为 $F = u\\eta = -u \\frac{\\rho s}{\\gamma-1}$。\n我们计算点积 $\\mathbf{v} \\cdot \\mathbf{f}$：\n$$\n\\mathbf{v} \\cdot \\mathbf{f} = \\left(\\frac{\\gamma-s}{\\gamma-1} - \\frac{\\rho u^2}{2p}\\right)(\\rho u) + \\left(\\frac{\\rho u}{p}\\right)(\\rho u^2 + p) + \\left(-\\frac{\\rho}{p}\\right)(u(\\rho E + p))\n$$\n使用关系式 $\\rho E = \\frac{p}{\\gamma-1} + \\frac{1}{2}\\rho u^2$，第三个通量分量变为 $u(\\rho E + p) = u(\\frac{\\gamma p}{\\gamma-1} + \\frac{1}{2}\\rho u^2)$。\n将此代入点积表达式：\n$$\n\\mathbf{v} \\cdot \\mathbf{f} = \\left(\\frac{(\\gamma-s)\\rho u}{\\gamma-1} - \\frac{\\rho^2 u^3}{2p}\\right) + \\left(\\frac{\\rho^2 u^3}{p} + \\rho u\\right) - \\left(\\frac{\\rho u}{p}\\left(\\frac{\\gamma p}{\\gamma-1} + \\frac{1}{2}\\rho u^2\\right)\\right)\n$$\n$$\n\\mathbf{v} \\cdot \\mathbf{f} = \\frac{\\gamma\\rho u}{\\gamma-1} - \\frac{s\\rho u}{\\gamma-1} - \\frac{\\rho^2 u^3}{2p} + \\frac{\\rho^2 u^3}{p} + \\rho u - \\frac{\\gamma\\rho u}{\\gamma-1} - \\frac{\\rho^2 u^3}{2p}\n$$\n合并同类项，我们观察到几项相互抵消：\n$$\n\\mathbf{v} \\cdot \\mathbf{f} = \\left(\\frac{\\gamma\\rho u}{\\gamma-1} - \\frac{\\gamma\\rho u}{\\gamma-1}\\right) + \\left(-\\frac{\\rho^2 u^3}{2p} + \\frac{\\rho^2 u^3}{p} - \\frac{\\rho^2 u^3}{2p}\\right) - \\frac{s\\rho u}{\\gamma-1} + \\rho u\n$$\n$$\n\\mathbf{v} \\cdot \\mathbf{f} = \\rho u - \\frac{s\\rho u}{\\gamma-1}\n$$\n现在我们计算熵势 $\\psi$：\n$$\n\\psi = \\mathbf{v} \\cdot \\mathbf{f} - F = \\left(\\rho u - \\frac{s\\rho u}{\\gamma-1}\\right) - \\left(- \\frac{s\\rho u}{\\gamma-1} \\right) = \\rho u\n$$\n对于所选的熵函数，熵势的形式非常简洁：\n$$\n\\psi(\\mathbf{U}) = \\rho u\n$$\n\n### 2. 熵守恒通量的构造\n\nTadmor 框架提供了一种通过在熵变量空间中进行路径积分来构造熵守恒通量的形式化方法。然而，这些积分的显式计算通常是难以处理的。另一种方法是通过以一种已知可以保持熵的方式对变量进行平均来构造通量。该问题指定了对速度使用算术平均值 $(\\bar{u})$，对密度 $(\\rho^{\\log})$ 和压力 $(p^{\\log})$ 使用对数平均值。\n\n一个合理且简单的方法是，取物理通量向量 $\\mathbf{f}(\\rho, u, p)$，并将其中的每个原始变量替换为指定的平均值，从而构造一个候选通量。该方法产生一个对称且相容的数值通量。我们据此定义我们的候选通量 $\\mathbf{f}^{\\mathrm{ec}}$。\n\n以原始变量表示的物理通量为：\n$$\n\\mathbf{f}(\\rho, u, p) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u\\left(\\frac{\\gamma p}{\\gamma-1} + \\frac{1}{2}\\rho u^2\\right) \\end{bmatrix}\n$$\n我们通过替换 $\\rho \\to \\rho^{\\log}$、$u \\to \\bar{u}$ 和 $p \\to p^{\\log}$ 来构造候选通量 $\\mathbf{f}^{\\mathrm{ec}}$：\n$$\nf_1^{\\mathrm{ec}} = \\rho^{\\log} \\bar{u}\n$$\n$$\nf_2^{\\mathrm{ec}} = \\rho^{\\log} \\bar{u}^2 + p^{\\log}\n$$\n$$\nf_3^{\\mathrm{ec}} = \\bar{u}\\left(\\frac{\\gamma p^{\\log}}{\\gamma-1} + \\frac{1}{2}\\rho^{\\log}\\bar{u}^2\\right)\n$$\n平均值的定义如下：\n$$\n\\bar{u} = \\frac{u_L + u_R}{2}, \\quad \\rho^{\\log} = \\frac{\\rho_R - \\rho_L}{\\ln(\\rho_R) - \\ln(\\rho_L)}, \\quad p^{\\log} = \\frac{p_R - p_L}{\\ln(p_R) - \\ln(p_L)}\n$$\n特殊情况是，如果对数平均值的两个参数相等，则平均值等于该共同值。这种构造满足相容性要求，即 $\\mathbf{f}^{\\mathrm{ec}}(\\mathbf{U},\\mathbf{U}) = \\mathbf{f}(\\mathbf{U})$。通过数值验证其满足 Tadmor 恒等式，可以确认此特定通量形式作为熵守恒通量的有效性。\n\n### 3. 数值验证\n\n最后的任务是为推导出的量和构造的通量计算 Tadmor 恒等式的绝对残差 $r$：\n$$\nr = \\left|(\\mathbf{v}_{R} - \\mathbf{v}_{L}) \\cdot \\mathbf{f}^{\\mathrm{ec}}(\\mathbf{U}_{L},\\mathbf{U}_{R}) - \\left(\\psi(\\mathbf{U}_{R}) - \\psi(\\mathbf{U}_{L})\\right)\\right|\n$$\n每个测试用例的步骤如下：\n1.  给定左右状态 $(\\rho_L, u_L, p_L)$ 和 $(\\rho_R, u_R, p_R)$ 以及 $\\gamma$。\n2.  使用第 1 节中推导的公式和左状态变量计算左熵变量 $\\mathbf{v}_L$。\n3.  使用第 1 节中推导的公式和右状态变量计算右熵变量 $\\mathbf{v}_R$。\n4.  计算两个状态的熵势：$\\psi_L = \\rho_L u_L$ 和 $\\psi_R = \\rho_R u_R$。\n5.  使用第 2 节中的公式计算熵守恒通量 $\\mathbf{f}^{\\mathrm{ec}} = [f_1^{\\mathrm{ec}}, f_2^{\\mathrm{ec}}, f_3^{\\mathrm{ec}}]^{\\top}$。\n6.  计算恒等式的左侧 (LHS)：$LHS = (\\mathbf{v}_R - \\mathbf{v}_L) \\cdot \\mathbf{f}^{\\mathrm{ec}} = (v_{1,R} - v_{1,L})f_1^{\\mathrm{ec}} + (v_{2,R} - v_{2,L})f_2^{\\mathrm{ec}} + (v_{3,R} - v_{3,L})f_3^{\\mathrm{ec}}$。\n7.  计算恒等式的右侧 (RHS)：$RHS = \\psi_R - \\psi_L$。\n8.  计算绝对残差 $r = |LHS - RHS|$。\n\n如果所构造的通量 $\\mathbf{f}^{\\mathrm{ec}}$ 对于给定的熵函数确实是熵守恒的，那么残差 $r$ 应该在机器精度范围内为零。程序实现将对三个指定的测试用例执行这些计算。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of verifying Tadmor's identity for a constructed\n    entropy-conservative flux for the 1D Euler equations.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: General\n        {'rho_L': 1.2, 'u_L': 0.3, 'p_L': 1.0, 'rho_R': 0.8, 'u_R': -0.2, 'p_R': 0.7, 'gamma': 1.4},\n        # Case 2: Equality\n        {'rho_L': 1.0, 'u_L': 0.0, 'p_L': 1.0, 'rho_R': 1.0, 'u_R': 0.0, 'p_R': 1.0, 'gamma': 1.4},\n        # Case 3: Extreme contrast\n        {'rho_L': 1e-6, 'u_L': 100.0, 'p_L': 1e-3, 'rho_R': 10.0, 'u_R': -50.0, 'p_R': 100.0, 'gamma': 1.4},\n    ]\n\n    results = []\n    for case in test_cases:\n        residual = calculate_tadmor_residual(**case)\n        results.append(residual)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef logmean(a: float, b: float) -> float:\n    \"\"\"\n    Computes the logarithmic mean of two numbers a and b.\n    \"\"\"\n    if np.isclose(a, b):\n        return a\n    # Handle positivity for log\n    if a = 0 or b = 0:\n        raise ValueError(\"Logarithmic mean is only defined for positive numbers.\")\n    return (b - a) / (np.log(b) - np.log(a))\n\ndef get_entropy_variables(rho: float, u: float, p: float, gamma: float) - np.ndarray:\n    \"\"\"\n    Computes the entropy variables v from primitive variables (rho, u, p).\n    v = [v1, v2, v3]^T\n    \"\"\"\n    s = np.log(p) - gamma * np.log(rho)\n    v1 = (gamma - s) / (gamma - 1) - (rho * u**2) / (2 * p)\n    v2 = rho * u / p\n    v3 = -rho / p\n    return np.array([v1, v2, v3])\n\ndef get_entropy_potential(rho: float, u: float) - float:\n    \"\"\"\n    Computes the entropy potential psi.\n    \"\"\"\n    return rho * u\n\ndef get_ec_flux(rho_L: float, u_L: float, p_L: float,\n                rho_R: float, u_R: float, p_R: float,\n                gamma: float) - np.ndarray:\n    \"\"\"\n    Constructs the entropy-conservative flux f_ec based on specified means.\n    \"\"\"\n    rho_ln = logmean(rho_L, rho_R)\n    p_ln = logmean(p_L, p_R)\n    u_avg = 0.5 * (u_L + u_R)\n\n    f1_ec = rho_ln * u_avg\n    f2_ec = rho_ln * u_avg**2 + p_ln\n    f3_ec = u_avg * (gamma * p_ln / (gamma - 1) + 0.5 * rho_ln * u_avg**2)\n    \n    return np.array([f1_ec, f2_ec, f3_ec])\n\ndef calculate_tadmor_residual(rho_L: float, u_L: float, p_L: float,\n                              rho_R: float, u_R: float, p_R: float,\n                              gamma: float) - float:\n    \"\"\"\n    Calculates the absolute residual of Tadmor's identity.\n    r = |(v_R - v_L) . f_ec - (psi_R - psi_L)|\n    \"\"\"\n    # 1. Compute entropy variables for left and right states\n    v_L = get_entropy_variables(rho_L, u_L, p_L, gamma)\n    v_R = get_entropy_variables(rho_R, u_R, p_R, gamma)\n    \n    # 2. Compute entropy potential for left and right states\n    psi_L = get_entropy_potential(rho_L, u_L)\n    psi_R = get_entropy_potential(rho_R, u_R)\n    \n    # 3. Compute the entropy-conservative flux\n    f_ec = get_ec_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma)\n    \n    # 4. Calculate the two sides of Tadmor's identity\n    delta_v = v_R - v_L\n    lhs = np.dot(delta_v, f_ec)\n    \n    delta_psi = psi_R - psi_L\n    rhs = delta_psi\n    \n    # 5. Compute the absolute residual\n    residual = np.abs(lhs - rhs)\n    \n    return residual\n\nsolve()\n```", "id": "3314744"}, {"introduction": "纯粹的熵守恒格式虽然在光滑流中表现优异，但在处理激波等间断时会产生非物理振荡，因为它们缺乏熵耗散机制。这个动手实践旨在解决这一问题，指导您构建一个完整的熵稳定格式，它将一个熵守恒通量与一个由熵残差驱动的激波传感器相结合 $[@problem_id:3314726]$。通过实现这种智能的耗散添加机制，您将学会如何构造既能在光滑区保持高精度，又能在间断处稳定捕捉激波的现代数值方法。", "problem": "您需要在一维有限体积离散化的无粘性 Burgers 守恒律中，构建并测试一个熵稳定的子单元激波传感器。控制方程为标量守恒律 $u_t + f(u)_x = 0$，其中物理通量为 $f(u) = \\frac{1}{2} u^2$。使用由 $U(u) = \\frac{1}{2} u^2$ 和 $F(u) = \\frac{1}{3} u^3$ 定义的数学熵对 $(U(u), F(u))$。熵变量为 $v(u) = \\frac{dU}{du} = u$。在状态 $u_L$ 和 $u_R$ 之间的界面处，采用由 Tadmor 条件 $(v_R - v_L)\\, f^{\\mathrm{ec}}(u_L, u_R) = \\psi(u_R) - \\psi(u_L)$ 隐式给出的两点熵守恒数值通量，其中熵势为 $\\psi(u) = v(u)\\, f(u) - F(u)$。对于无粘性 Burgers 方程，这简化为显式两点通量 $f^{\\mathrm{ec}}(u_L, u_R) = \\frac{u_L^2 + u_L u_R + u_R^2}{6}$。仅在基于每个界面上的离散熵残差的子单元激波传感器指示的位置添加耗散。\n\n将界面 $(i+\\frac{1}{2})$ 上的离散熵残差定义为\n$$\nR_{i+\\frac{1}{2}} = \\left| F(u_R) - F(u_L) - \\frac{1}{2} (u_L + u_R)\\, \\big(f(u_R) - f(u_L)\\big) \\right|.\n$$\n此残差在离散意义上衡量了对链式法则恒等式 $dF = v\\, df$ 的局部违背程度；它在光滑区域很小，在间断附近很大。构建一个布尔激波传感器 $S_{i+\\frac{1}{2}}$，如果 $R_{i+\\frac{1}{2}}  \\tau$ 则等于 $1$，否则等于 $0$，其中 $\\tau$ 是用户定义的阈值。使用此传感器来门控熵稳定耗散：每个界面处的数值通量为\n$$\nf^{\\mathrm{num}}_{i+\\frac{1}{2}} = f^{\\mathrm{ec}}(u_L, u_R) - \\frac{1}{2} S_{i+\\frac{1}{2}}\\, \\alpha_{i+\\frac{1}{2}}\\, (u_R - u_L),\n$$\n其中 $\\alpha_{i+\\frac{1}{2}} = \\max\\{|u_L|, |u_R|\\}$ 是局部特征速度。单元平均值 $u_i$ 的半离散有限体积更新为\n$$\n\\frac{d u_i}{d t} = - \\frac{f^{\\mathrm{num}}_{i+\\frac{1}{2}} - f^{\\mathrm{num}}_{i-\\frac{1}{2}}}{\\Delta x}.\n$$\n使用两阶段强稳定性保持 (SSP) Runge–Kutta 格式进行时间推进，并选择 Courant–Friedrichs–Lewy (CFL) 条件 $\\Delta t = \\mathrm{CFL}\\, \\frac{\\Delta x}{\\max_i |u_i|}$ 且 $\\mathrm{CFL} = 0.4$。在长度为 $L$ 的域上，使用包含 $N$ 个单元的均匀网格进行空间离散化，采用单元中心状态和界面通量。对于光滑周期流应用周期性边界条件，对于黎曼类问题应用透射（零梯度）边界条件。\n\n使用以下初始条件和阈值的测试套件实现该算法：\n\n- 测试用例 #1 (光滑周期流)：$L = 1$，$N = 256$，$\\mathrm{CFL} = 0.4$，$u(x,0) = a \\sin(2 \\pi k x)$，其中 $a = 0.4$，$k = 1$，周期性边界条件，最终时间 $T = 0.05$，阈值 $\\tau = 10^{-6}$。\n- 测试用例 #2 (含激波的黎曼问题)：$L = 1$，$N = 256$，$\\mathrm{CFL} = 0.4$，$u(x,0) = u_L$ 对于 $x  0.5$ 且 $u(x,0) = u_R$ 对于 $x \\ge 0.5$，其中 $u_L = 2.0$ 且 $u_R = 0.0$，透射边界条件，最终时间 $T = 0.02$，阈值 $\\tau = 10^{-6}$。\n- 测试用例 #3 (混合光滑/激波流)：$L = 1$，$N = 256$，$\\mathrm{CFL} = 0.4$，分段初始条件\n$$\nu(x,0) = \n\\begin{cases}\n0.2 + 0.2 \\sin(4 \\pi x),  0 \\le x  0.5,\\\\\n1.5,  0.5 \\le x  0.75,\\\\\n0.0,  0.75 \\le x \\le 1,\n\\end{cases}\n$$\n透射边界条件，最终时间 $T = 0.02$，阈值 $\\tau = 10^{-6}$。\n- 测试用例 #4 (边缘情况，光滑流上的高阈值)：$L = 1$，$N = 256$，$\\mathrm{CFL} = 0.4$，$u(x,0) = a \\sin(2 \\pi k x)$，其中 $a = 0.1$，$k = 1$，周期性边界条件，最终时间 $T = 0.05$，阈值 $\\tau = 0.5$。\n\n对于每个测试用例，计算在最终时刻传感器被触发的所有界面的比例，即比率\n$$\n\\frac{\\sum_{i=0}^{N} S_{i+\\frac{1}{2}}^{\\mathrm{final}}}{N+1}.\n$$\n输出不涉及物理单位。您的程序应生成单行输出，其中包含四个测试用例的结果，格式为方括号内以逗号分隔的浮点数列表，顺序如上所述（例如，$[r_1,r_2,r_3,r_4]$）。值 $r_j$ 必须是十进制格式的实数。程序必须是自包含的，且不得要求任何用户输入。", "solution": "该问题要求实现并测试一个用于一维无粘性 Burgers 方程 $u_t + f(u)_x = 0$ 的有限体积数值格式，其物理通量由 $f(u) = \\frac{1}{2} u^2$ 给出。该格式必须是熵稳定的，并采用激波传感器仅在必要时施加人工耗散。\n\n首先，我们在长度为 $L$ 的域上建立一个包含 $N$ 个单元的均匀网格进行空间离散化。每个单元的宽度为 $\\Delta x = L/N$。解 $u_i(t)$ 表示在时间 $t$ 时单元 $i$ 中守恒量的单元平均值。每个单元的半离散有限体积更新由下式给出：\n$$\n\\frac{d u_i}{d t} = -\\frac{f^{\\mathrm{num}}_{i+\\frac{1}{2}} - f^{\\mathrm{num}}_{i-\\frac{1}{2}}}{\\Delta x}\n$$\n这里，$f^{\\mathrm{num}}_{i+\\frac{1}{2}}$ 是单元 $i$ 和单元 $i+1$ 之间界面上的数值通量。\n\n数值通量被构造成熵稳定的。对于给定的熵对，$U(u) = \\frac{1}{2} u^2$（熵）和 $F(u) = \\frac{1}{3} u^3$（熵通量），相应的熵变量为 $v(u) = dU/du = u$。数值通量由一个基准的熵守恒通量 $f^{\\mathrm{ec}}$ 和一个由激波传感器 $S_{i+\\frac{1}{2}}$ 激活的耗散项组成。\n\n对于左状态 $u_L$ 和右状态 $u_R$ 之间的 Burgers 方程，其两点熵守恒通量由 Tadmor 条件导出，并显式地给出为：\n$$\nf^{\\mathrm{ec}}(u_L, u_R) = \\frac{u_L^2 + u_L u_R + u_R^2}{6}\n$$\n\n为了检测必须耗散熵的激波和其他间断，我们基于离散熵残差构建了一个激波传感器。残差 $R_{i+\\frac{1}{2}}$ 衡量了对连续熵通量相容性条件 $dF = v \\, df$ 的局部偏离。它在状态为 $u_L$ 和 $u_R$ 的单元之间的界面上定义为：\n$$\nR_{i+\\frac{1}{2}} = \\left| F(u_R) - F(u_L) - \\frac{1}{2} (u_L + u_R)\\, \\big(f(u_R) - f(u_L)\\big) \\right|\n$$\n对于 Burgers 方程的特定情况，此表达式简化为计算上更高效的形式：\n$$\nR_{i+\\frac{1}{2}} = \\frac{|(u_R - u_L)^3|}{12}\n$$\n该残差在流场的光滑区域很小，在间断处很大。然后，通过将残差与用户指定的阈值 $\\tau$ 进行比较，定义一个布尔激波传感器 $S_{i+\\frac{1}{2}}$：\n$$\nS_{i+\\frac{1}{2}} = \n\\begin{cases}\n1  \\text{if } R_{i+\\frac{1}{2}}  \\tau \\\\\n0  \\text{if } R_{i+\\frac{1}{2}} \\le \\tau\n\\end{cases}\n$$\n\n完整的数值通量 $f^{\\mathrm{num}}_{i+\\frac{1}{2}}$ 将熵守恒通量与一个由激波传感器缩放的人工耗散项相结合：\n$$\nf^{\\mathrm{num}}_{i+\\frac{1}{2}} = f^{\\mathrm{ec}}(u_L, u_R) - \\frac{1}{2} S_{i+\\frac{1}{2}}\\, \\alpha_{i+\\frac{1}{2}}\\, (u_R - u_L)\n$$\n系数 $\\alpha_{i+\\frac{1}{2}}$ 提供了正确的粘性量，并基于局部特征波速：\n$$\n\\alpha_{i+\\frac{1}{2}} = \\max\\{|u_L|, |u_R|\\}\n$$\n这种格式确保了耗散仅在被传感器标记的界面处添加，从而在保持光滑区域解的精度的同时稳定激波。\n\n对于半离散系统的时间积分，采用两阶段强稳定性保持 Runge-Kutta (SSP-RK2) 格式。给定半离散算子 $\\mathcal{L}(u)_i = -\\frac{1}{\\Delta x}(f^{\\mathrm{num}}_{i+\\frac{1}{2}} - f^{\\mathrm{num}}_{i-\\frac{1}{2}})$，从时间层 $n$ 到 $n+1$ 的更新分两个阶段进行：\n$$\nu^{(1)} = u^n + \\Delta t \\, \\mathcal{L}(u^n)\n$$\n$$\nu^{n+1} = \\frac{1}{2} u^n + \\frac{1}{2} \\left( u^{(1)} + \\Delta t \\, \\mathcal{L}(u^{(1)}) \\right)\n$$\n时间步长 $\\Delta t$ 由 Courant–Friedrichs–Lewy (CFL) 条件确定，以确保数值稳定性：\n$$\n\\Delta t = \\mathrm{CFL}\\, \\frac{\\Delta x}{\\max_i |u_i|}\n$$\n其中指定的 $\\mathrm{CFL}$ 值为 $0.4$。\n\n边界条件（周期性或透射性）通过使用虚拟单元来处理。对于周期性边界，一个域边界外的虚拟单元用相对边界处单元的值填充。对于透射（零梯度）边界，虚拟单元的值从最近的内部单元复制。\n\n算法的流程是：首先根据每个测试用例指定的初始条件初始化解数组 $u$。然后使用 SSP-RK2 格式随时间演化系统，直到达到最终时间 $T$。在模拟结束时，基于最终解的状态计算所有 $N+1$ 个界面上的激波传感器 $S_{i+\\frac{1}{2}}$。所需的输出指标是传感器被激活的界面所占的比例，计算公式为：\n$$\n\\frac{\\sum_{j=0}^{N} S_{j+\\frac{1}{2}}^{\\mathrm{final}}}{N+1}\n$$\n对问题陈述中定义的四个测试用例中的每一个都重复此过程。", "answer": "```python\nimport numpy as np\n\ndef run_simulation(L, N, cfl, u0_func, bc_type, T, tau):\n    \"\"\"\n    Runs a 1D Burgers' equation simulation with an entropy-stable scheme.\n    \"\"\"\n    dx = L / N\n    # Cell centers for x\n    x = np.linspace(dx / 2.0, L - dx / 2.0, N)\n    u = u0_func(x)\n    t = 0.0\n\n    while t  T:\n        max_abs_u = np.max(np.abs(u))\n        # Add a small epsilon to prevent division by zero in static cases\n        dt = cfl * dx / (max_abs_u + 1e-12)\n        \n        # Ensure the final time step does not overshoot T\n        if t + dt > T:\n            dt = T - t\n\n        # Standard two-stage SSP Runge-Kutta (SSP-RK2) scheme, also known as Heun's method\n        # Stage 1\n        dudt1 = calculate_rhs(u, N, dx, bc_type, tau)\n        u1 = u + dt * dudt1\n\n        # Stage 2\n        dudt2 = calculate_rhs(u1, N, dx, bc_type, tau)\n        u = 0.5 * u + 0.5 * (u1 + dt * dudt2)\n        \n        t += dt\n\n    # After the loop, calculate the final sensor activation\n    _, final_sensors = calculate_rhs(u, N, dx, bc_type, tau, return_sensors=True)\n    \n    # The problem asks for the fraction over N+1 interfaces\n    sensor_fraction = np.sum(final_sensors) / (N + 1)\n    \n    return sensor_fraction\n\ndef calculate_rhs(u, N, dx, bc_type, tau, return_sensors=False):\n    \"\"\"\n    Calculates the right-hand side of the semi-discrete finite volume scheme.\n    \"\"\"\n    # Create a padded array for ghost cells (1 on each side)\n    u_padded = np.zeros(N + 2)\n    u_padded[1:-1] = u\n\n    # Apply boundary conditions\n    if bc_type == 'periodic':\n        u_padded[0] = u[-1]\n        u_padded[-1] = u[0]\n    elif bc_type == 'transmissive':  # Zero-gradient\n        u_padded[0] = u[0]\n        u_padded[-1] = u[-1]\n\n    # Get left and right states at the N+1 interfaces\n    uL = u_padded[:-1]\n    uR = u_padded[1:]\n\n    # Simplified discrete entropy residual for Burgers' equation: |(u_R - u_L)^3| / 12\n    delta_u = uR - uL\n    residual = np.abs(delta_u**3) / 12.0\n    \n    # Boolean shock sensor\n    sensors = (residual > tau).astype(float)\n    \n    # Entropy-conservative flux: (u_L^2 + u_L*u_R + u_R^2) / 6\n    f_ec = (uL**2 + uL * uR + uR**2) / 6.0\n    \n    # Dissipation coefficient: max(|u_L|, |u_R|)\n    alpha = np.maximum(np.abs(uL), np.abs(uR))\n    \n    # Numerical flux with entropy-stable dissipation\n    f_num = f_ec - 0.5 * sensors * alpha * delta_u\n    \n    # RHS for cells 0 to N-1\n    rhs = -(f_num[1:] - f_num[:-1]) / dx\n    \n    if return_sensors:\n        return rhs, sensors\n    else:\n        return rhs\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run simulations, and print results.\n    \"\"\"\n    # Test case definitions\n    def u0_case1(x):\n        a = 0.4\n        k = 1.0\n        return a * np.sin(2 * np.pi * k * x)\n\n    def u0_case2(x):\n        u = np.zeros_like(x)\n        u[x  0.5] = 2.0\n        u[x >= 0.5] = 0.0\n        return u\n\n    def u0_case3(x):\n        u = np.zeros_like(x)\n        mask1 = (x >= 0)  (x  0.5)\n        mask2 = (x >= 0.5)  (x  0.75)\n        # mask3 is the rest\n        u[mask1] = 0.2 + 0.2 * np.sin(4 * np.pi * x[mask1])\n        u[mask2] = 1.5\n        # u[mask3] is already 0.0\n        return u\n\n    def u0_case4(x):\n        a = 0.1\n        k = 1.0\n        return a * np.sin(2 * np.pi * k * x)\n\n    test_cases = [\n        {'L': 1.0, 'N': 256, 'cfl': 0.4, 'u0_func': u0_case1, 'bc_type': 'periodic', 'T': 0.05, 'tau': 1e-6},\n        {'L': 1.0, 'N': 256, 'cfl': 0.4, 'u0_func': u0_case2, 'bc_type': 'transmissive', 'T': 0.02, 'tau': 1e-6},\n        {'L': 1.0, 'N': 256, 'cfl': 0.4, 'u0_func': u0_case3, 'bc_type': 'transmissive', 'T': 0.02, 'tau': 1e-6},\n        {'L': 1.0, 'N': 256, 'cfl': 0.4, 'u0_func': u0_case4, 'bc_type': 'periodic', 'T': 0.05, 'tau': 0.5},\n    ]\n\n    results = []\n    for params in test_cases:\n        result = run_simulation(**params)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3314726"}]}