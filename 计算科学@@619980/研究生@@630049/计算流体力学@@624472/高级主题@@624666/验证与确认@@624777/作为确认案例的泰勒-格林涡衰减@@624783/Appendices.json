{"hands_on_practices": [{"introduction": "本练习旨在为泰勒-格林涡的衰减建立理论基础。通过直接从纳维-斯托克斯方程推导初始能量耗散率，学习者将巩固对粘性如何从流场中移除动能的理解。这个解析结果是验证数值模拟准确性的一个关键基准 [@problem_id:3370515]。", "problem": "考虑在边长为 $2\\pi/k$ 的三重周期性立方体域中，用于描述恒定密度粘性流体的不可压缩纳维-斯托克斯方程。其中空间平均 $\\langle \\cdot \\rangle$ 定义为 $\\langle f \\rangle = \\frac{1}{V}\\int_{V} f \\,\\mathrm{d}V$，这里的 $V$ 是域的体积。设初始条件为三维泰勒-格林速度场\n$$\nu(x,y,z,0) = U_{0}\\,\\sin(kx)\\cos(ky)\\cos(kz),\\quad\nv(x,y,z,0) = -U_{0}\\,\\cos(kx)\\sin(ky)\\cos(kz),\\quad\nw(x,y,z,0) = 0,\n$$\n该速度场满足 $\\nabla\\cdot\\boldsymbol{u}=0$。定义单位质量动能为 $E(t)=\\frac{1}{2}\\langle |\\boldsymbol{u}|^{2}\\rangle$，涡量为 $\\boldsymbol{\\omega}=\\nabla\\times\\boldsymbol{u}$。从不可压缩纳维-斯托克斯方程和上述定义出发，推导能量平衡方程，然后评估此泰勒-格林初始条件下的初始能量衰减率 $\\left.\\frac{\\mathrm{d}E}{\\mathrm{d}t}\\right|_{t=0}$。请用 $U_{0}$、$k$ 和运动粘度 $\\nu$ 表示你的最终答案，形式为一个闭式解析表达式。请以符号形式提供该表达式；如果进行数值计算，请使用国际单位制 (SI)，但最终表达式中不包含单位。", "solution": "该问题在科学上是成立的、适定的且客观的。这是一个理论流体动力学中的标准问题，涉及对泰勒-格林涡的分析。泰勒-格林涡是用于研究湍流和验证纳维-斯托克斯方程数值求解器的典型流动。因此，我们可以进行形式推导。\n\n对于密度为 $\\rho$、运动粘度为 $\\nu$ 的不可压缩流体，其控制方程是纳维-斯托克斯方程。用速度 $\\boldsymbol{u}$ 和运动压力 $p$ (压力除以 $\\rho$) 表示，动量方程为：\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + (\\boldsymbol{u} \\cdot \\nabla) \\boldsymbol{u} = -\\nabla p + \\nu \\nabla^2 \\boldsymbol{u}\n$$\n不可压缩约束由下式给出：\n$$\n\\nabla \\cdot \\boldsymbol{u} = 0\n$$\n单位质量动能定义为 $E(t) = \\frac{1}{2}\\langle |\\boldsymbol{u}|^{2}\\rangle$，其中在域体积 $V$ 上的空间平均 $\\langle f \\rangle$ 为 $\\frac{1}{V}\\int_{V} f \\,\\mathrm{d}V$。\n\n首先，我们推导广义的能量平衡方程。我们将动量方程与速度矢量 $\\boldsymbol{u}$ 做点积：\n$$\n\\boldsymbol{u} \\cdot \\frac{\\partial \\boldsymbol{u}}{\\partial t} + \\boldsymbol{u} \\cdot ((\\boldsymbol{u} \\cdot \\nabla) \\boldsymbol{u}) = -\\boldsymbol{u} \\cdot \\nabla p + \\nu \\boldsymbol{u} \\cdot \\nabla^2 \\boldsymbol{u}\n$$\n我们可以将第一项重写为 $\\boldsymbol{u} \\cdot \\frac{\\partial \\boldsymbol{u}}{\\partial t} = \\frac{1}{2} \\frac{\\partial}{\\partial t}(\\boldsymbol{u} \\cdot \\boldsymbol{u}) = \\frac{1}{2} \\frac{\\partial |\\boldsymbol{u}|^2}{\\partial t}$。对整个方程进行空间平均，得到：\n$$\n\\left\\langle \\frac{1}{2} \\frac{\\partial |\\boldsymbol{u}|^2}{\\partial t} \\right\\rangle + \\left\\langle \\boldsymbol{u} \\cdot ((\\boldsymbol{u} \\cdot \\nabla) \\boldsymbol{u}) \\right\\rangle = -\\left\\langle \\boldsymbol{u} \\cdot \\nabla p \\right\\rangle + \\nu \\left\\langle \\boldsymbol{u} \\cdot \\nabla^2 \\boldsymbol{u} \\right\\rangle\n$$\n空间平均和时间导数可以交换次序，所以第一项是 $\\frac{\\mathrm{d}}{\\mathrm{d}t} \\left\\langle \\frac{1}{2} |\\boldsymbol{u}|^2 \\right\\rangle = \\frac{\\mathrm{d}E}{\\mathrm{d}t}$。\n\n现在我们分析三重周期性域中余下的各项：\n1.  对流项：使用矢量恒等式 $\\nabla \\cdot (c\\boldsymbol{A}) = c(\\nabla \\cdot \\boldsymbol{A}) + \\boldsymbol{A} \\cdot \\nabla c$，并令 $c = \\frac{|\\boldsymbol{u}|^2}{2}$、$\\boldsymbol{A} = \\boldsymbol{u}$，再结合不可压缩条件 $\\nabla \\cdot \\boldsymbol{u} = 0$，可以将项 $\\boldsymbol{u} \\cdot ((\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u})$ 写为 $\\nabla \\cdot (\\boldsymbol{u} \\frac{|\\boldsymbol{u}|^2}{2})$。该项的平均为 $\\langle \\nabla \\cdot (\\boldsymbol{u} \\frac{|\\boldsymbol{u}|^2}{2}) \\rangle$。根据散度定理，此体积分可转换为域边界上的面积分。对于周期性边界条件，相对面上的积分相互抵消，因此该项为零。\n\n2.  压力项：使用乘法法则和不可压缩条件 $\\nabla \\cdot \\boldsymbol{u} = 0$，可以将项 $-\\boldsymbol{u} \\cdot \\nabla p$ 写为 $-\\nabla \\cdot (p\\boldsymbol{u})$。其平均值 $-\\langle \\nabla \\cdot (p\\boldsymbol{u}) \\rangle$ 同样是一个散度的体积分，对于周期性边界条件，该积分也为零。\n\n3.  粘性项：我们分析项 $\\nu \\langle \\boldsymbol{u} \\cdot \\nabla^2 \\boldsymbol{u} \\rangle$。我们使用矢量恒等式 $\\nabla^2 \\boldsymbol{u} = \\nabla(\\nabla \\cdot \\boldsymbol{u}) - \\nabla \\times (\\nabla \\times \\boldsymbol{u})$。由于 $\\nabla \\cdot \\boldsymbol{u} = 0$，该式简化为 $\\nabla^2 \\boldsymbol{u} = -\\nabla \\times (\\nabla \\times \\boldsymbol{u}) = -\\nabla \\times \\boldsymbol{\\omega}$，其中 $\\boldsymbol{\\omega} = \\nabla \\times \\boldsymbol{u}$ 是涡量。粘性项变为 $-\\nu \\langle \\boldsymbol{u} \\cdot (\\nabla \\times \\boldsymbol{\\omega}) \\rangle$。使用另一个矢量恒等式 $\\nabla \\cdot (\\boldsymbol{a} \\times \\boldsymbol{b}) = (\\nabla \\times \\boldsymbol{a}) \\cdot \\boldsymbol{b} - \\boldsymbol{a} \\cdot (\\nabla \\times \\boldsymbol{b})$，我们令 $\\boldsymbol{a}=\\boldsymbol{u}$ 和 $\\boldsymbol{b}=\\boldsymbol{\\omega}$，得到 $\\nabla \\cdot (\\boldsymbol{u} \\times \\boldsymbol{\\omega}) = (\\nabla \\times \\boldsymbol{u}) \\cdot \\boldsymbol{\\omega} - \\boldsymbol{u} \\cdot (\\nabla \\times \\boldsymbol{\\omega}) = |\\boldsymbol{\\omega}|^2 - \\boldsymbol{u} \\cdot (\\nabla \\times \\boldsymbol{\\omega})$。整理后，我们有 $\\boldsymbol{u} \\cdot (\\nabla \\times \\boldsymbol{\\omega}) = |\\boldsymbol{\\omega}|^2 - \\nabla \\cdot (\\boldsymbol{u} \\times \\boldsymbol{\\omega})$。因此，粘性项为 $\\nu \\langle -|\\boldsymbol{\\omega}|^2 + \\nabla \\cdot (\\boldsymbol{u} \\times \\boldsymbol{\\omega}) \\rangle$。散度部分的平均值 $\\langle \\nabla \\cdot (\\boldsymbol{u} \\times \\boldsymbol{\\omega}) \\rangle$ 在周期性边界条件下为零。我们剩下 $-\\nu \\langle |\\boldsymbol{\\omega}|^2 \\rangle$。\n\n综合这些结果，能量平衡方程简化为能量耗散率：\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}t} = -\\nu \\langle |\\boldsymbol{\\omega}|^2 \\rangle\n$$\n为了求得初始能量衰减率，我们必须计算该表达式在 $t=0$ 时的值：\n$$\n\\left.\\frac{\\mathrm{d}E}{\\mathrm{d}t}\\right|_{t=0} = -\\nu \\langle |\\boldsymbol{\\omega}(x,y,z,0)|^2 \\rangle\n$$\n我们从初始速度场 $\\boldsymbol{u}(x,y,z,0)$ 计算初始涡量场 $\\boldsymbol{\\omega}(x,y,z,0)$：\n$$\n\\boldsymbol{u}(0) = \\begin{pmatrix} U_{0}\\,\\sin(kx)\\cos(ky)\\cos(kz) \\\\ -U_{0}\\,\\cos(kx)\\sin(ky)\\cos(kz) \\\\ 0 \\end{pmatrix}\n$$\n涡量 $\\boldsymbol{\\omega} = \\nabla \\times \\boldsymbol{u} = (\\omega_x, \\omega_y, \\omega_z)$ 的分量是：\n$$\n\\omega_x = \\frac{\\partial w}{\\partial y} - \\frac{\\partial v}{\\partial z} = 0 - \\frac{\\partial}{\\partial z}(-U_0 \\cos(kx)\\sin(ky)\\cos(kz)) = -U_0 k \\cos(kx)\\sin(ky)\\sin(kz)\n$$\n$$\n\\omega_y = \\frac{\\partial u}{\\partial z} - \\frac{\\partial w}{\\partial x} = \\frac{\\partial}{\\partial z}(U_0 \\sin(kx)\\cos(ky)\\cos(kz)) - 0 = -U_0 k \\sin(kx)\\cos(ky)\\sin(kz)\n$$\n$$\n\\omega_z = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y} = \\frac{\\partial}{\\partial x}(-U_0 \\cos(kx)\\sin(ky)\\cos(kz)) - \\frac{\\partial}{\\partial y}(U_0 \\sin(kx)\\cos(ky)\\cos(kz))\n$$\n$$\n= U_0 k \\sin(kx)\\sin(ky)\\cos(kz) - (-U_0 k \\sin(kx)\\sin(ky)\\cos(kz)) = 2 U_0 k \\sin(kx)\\sin(ky)\\cos(kz)\n$$\n接下来，我们计算涡量大小的平方，即 $|\\boldsymbol{\\omega}|^2 = \\omega_x^2 + \\omega_y^2 + \\omega_z^2$：\n$$\n|\\boldsymbol{\\omega}(0)|^2 = (-U_0 k \\cos(kx)\\sin(ky)\\sin(kz))^2 + (-U_0 k \\sin(kx)\\cos(ky)\\sin(kz))^2 + (2 U_0 k \\sin(kx)\\sin(ky)\\cos(kz))^2\n$$\n$$\n|\\boldsymbol{\\omega}(0)|^2 = (U_0 k)^2 \\left[ \\cos^2(kx)\\sin^2(ky)\\sin^2(kz) + \\sin^2(kx)\\cos^2(ky)\\sin^2(kz) + 4\\sin^2(kx)\\sin^2(ky)\\cos^2(kz) \\right]\n$$\n现在，我们计算空间平均。该域是一个边长为 $L = 2\\pi/k$ 的立方体。函数 $\\sin^2(k\\xi)$ 和 $\\cos^2(k\\xi)$ 在区间 $[0, 2\\pi/k]$ 上的平均值为 $\\frac{1}{2}$。即 $\\langle \\sin^2(kx) \\rangle = 1/2$，$\\langle \\cos^2(kx) \\rangle = 1/2$，对于 $y$ 和 $z$ 坐标也类似。由于积分的可分离性，我们可以独立地对每个三角因子进行平均：\n$$\n\\langle |\\boldsymbol{\\omega}(0)|^2 \\rangle = (U_0 k)^2 \\left[ \\langle\\cos^2(kx)\\rangle\\langle\\sin^2(ky)\\rangle\\langle\\sin^2(kz)\\rangle + \\langle\\sin^2(kx)\\rangle\\langle\\cos^2(ky)\\rangle\\langle\\sin^2(kz)\\rangle + 4\\langle\\sin^2(kx)\\rangle\\langle\\sin^2(ky)\\rangle\\langle\\cos^2(kz)\\rangle \\right]\n$$\n$$\n\\langle |\\boldsymbol{\\omega}(0)|^2 \\rangle = (U_0 k)^2 \\left[ \\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right) + \\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right) + 4\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right) \\right]\n$$\n$$\n\\langle |\\boldsymbol{\\omega}(0)|^2 \\rangle = (U_0 k)^2 \\left[ \\frac{1}{8} + \\frac{1}{8} + \\frac{4}{8} \\right] = (U_0 k)^2 \\left( \\frac{6}{8} \\right) = \\frac{3}{4} U_0^2 k^2\n$$\n最后，我们将此结果代回到初始能量衰减率的表达式中：\n$$\n\\left.\\frac{\\mathrm{d}E}{\\mathrm{d}t}\\right|_{t=0} = -\\nu \\langle |\\boldsymbol{\\omega}(0)|^2 \\rangle = -\\nu \\left( \\frac{3}{4} U_0^2 k^2 \\right) = -\\frac{3}{4}\\nu k^2 U_0^2\n$$\n这就是三维泰勒-格林涡初始能量衰减率的闭式解析表达式。", "answer": "$$\n\\boxed{-\\frac{3}{4}\\nu k^{2}U_{0}^{2}}\n$$", "id": "3370515"}, {"introduction": "从理论转向实践，本练习要求学习者构建一个简单的伪谱求解器。其目标是特意省略去混淆（de-aliasing）步骤，以观察和量化一种常见的数值误差：高波数下的伪能量增长。这个动手实践的模拟将展示为何正确的数值技术至关重要，并利用简单的二维泰勒-格林涡作为一个理想的测试平台，因为理论上该流场不应发生能量传递 [@problem_id:3370572]。", "problem": "您需要设计并实现一个完全可复现的数值实验，以量化在泰勒-格林涡衰减的伪谱模拟中，因去混叠不足而导致的伪高波数能量增长。目标是从计算流体动力学的基本原理出发，编写一个程序，用于计算在不采用三分之二去混叠规则的运行中，高波数处的伪能量度量。\n\n从周期性域上的二维不可压缩纳维-斯托克斯方程开始，\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + (\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u} = -\\nabla p + \\nu \\nabla^2 \\boldsymbol{u}, \\quad \\nabla\\cdot\\boldsymbol{u} = 0,\n$$\n其中 $\\boldsymbol{u} = (u,v)$ 是速度场，$p$ 是压力，$\\nu$ 是运动粘度。在边长为 $L$ 的方形域上，使用周期性边界条件。考虑泰勒-格林涡初始条件\n$$\nu(x,y,0) = U_0 \\cos(k_0 x)\\sin(k_0 y), \\quad v(x,y,0) = -U_0 \\sin(k_0 x)\\cos(k_0 y),\n$$\n其中 $k_0 = 1$ 且 $L = 2\\pi$，因此 $x,y\\in[0,2\\pi]$。在连续情况下，该场是无散度的，并且非线性项被压力梯度抵消，导致振幅纯粹的扩散衰减。因此，在没有数值误差的情况下，能量不应填充到高于初始 $k_0$ 模式的波数上。\n\n为了数值上逼近该动力学过程，请实现一个伪谱法，该方法包含以下基本步骤，仅使用广泛接受的事实和算子来表示：\n- 使用快速傅里叶变换（FFT）在物理空间和谱空间之间切换。用 $k_x$ 和 $k_y$ 表示谱波数，并通过在傅里叶空间中乘以 $i k_x$ 或 $i k_y$ 来定义谱微分。\n- 通过将速度分量与其空间导数相乘，在物理空间中计算非线性对流项 $(\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u}$，然后变换回谱空间。\n- 通过使用正交Leray投影 $\\boldsymbol{P}(k)$ 将非线性项投影到谱空间中的无散度子空间上来强制不可压缩性，该投影可移除梯度分量。对于每个非零波数向量 $\\boldsymbol{k}=(k_x,k_y)$，定义投影 $\\boldsymbol{P}(k) = \\boldsymbol{I} - \\frac{\\boldsymbol{k}\\boldsymbol{k}^\\top}{|\\boldsymbol{k}|^2}$。\n- 使用针对扩散项的积分因子显式更新方法进行时间推进：对于每个谱模式，其幅值平方为 $|\\boldsymbol{k}|^2 = k_x^2 + k_y^2$，通过以下方式更新 $\\hat{\\boldsymbol{u}}$\n$$\n\\hat{\\boldsymbol{u}}^{n+1} = e^{-\\nu |\\boldsymbol{k}|^2 \\Delta t} \\left( \\hat{\\boldsymbol{u}}^{n} + \\Delta t\\,\\widehat{\\boldsymbol{N}}^{n} \\right),\n$$\n其中 $\\widehat{\\boldsymbol{N}}$ 是投影后的非线性项。不应应用任何去混叠，这意味着在计算乘积时，您不得使用三分之二截断规则或任何抗混叠滤波器。\n\n将时刻 $t$ 的瞬时谱能量密度定义为\n$$\nE(\\boldsymbol{k}, t) = \\frac{1}{2}\\left( |\\hat{u}(\\boldsymbol{k},t)|^2 + |\\hat{v}(\\boldsymbol{k},t)|^2 \\right).\n$$\n令 $|\\boldsymbol{k}|_{\\max}$ 为离散网格上最大可分辨波数幅值。对于固定的分数 $f_h$（$0  f_h  1$），将“高波数带”定义为所有满足 $|\\boldsymbol{k}| \\ge f_h |\\boldsymbol{k}|_{\\max}$ 的模式。那么，在时刻 $T$ 的伪高波数能量分数为\n$$\nR(T) = \\frac{\\sum_{|\\boldsymbol{k}| \\ge f_h |\\boldsymbol{k}|_{\\max}} E(\\boldsymbol{k}, T)}{\\sum_{\\boldsymbol{k}\\ne \\boldsymbol{0}} E(\\boldsymbol{k}, T)}.\n$$\n在理想的连续泰勒-格林涡衰减中，$R(T)$ 对于所有 $T$ 都应为零，因为能量保持在初始波数壳层中。任何在没有去混叠的情况下数值计算出的非零值都反映了由于混叠误差导致的高波数处的伪能量增长。\n\n所有量都将以无量纲形式处理，最终答案应为无单位的小数。\n\n实现上述无任何去混叠的伪谱法，并为以下每个测试用例计算 $R(T)$。在所有用例中，使用 $k_0 = 1$ 和 $L = 2\\pi$。任何三角函数求值的角度单位均为弧度。量 $f_h$ 表示高波数带的分数阈值。测试套件参数为：\n- 用例 1：网格大小 $N = 32$，粘度 $\\nu = 0.01$，时间步长 $\\Delta t = 0.002$，最终时间 $T = 0.2$，振幅 $U_0 = 1.0$，高波数分数 $f_h = 0.8$。\n- 用例 2：网格大小 $N = 32$，粘度 $\\nu = 0.01$，时间步长 $\\Delta t = 0.002$，最终时间 $T = 0.2$，振幅 $U_0 = 4.0$，高波数分数 $f_h = 0.8$。\n- 用例 3：网格大小 $N = 32$，粘度 $\\nu = 0.0$，时间步长 $\\Delta t = 0.001$，最终时间 $T = 0.2$，振幅 $U_0 = 1.0$，高波数分数 $f_h = 0.8$。\n- 用例 4：网格大小 $N = 64$，粘度 $\\nu = 0.01$，时间步长 $\\Delta t = 0.002$，最终时间 $T = 0.2$，振幅 $U_0 = 1.0$，高波数分数 $f_h = 0.8$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[r_1,r_2,r_3,r_4]$），其中每个 $r_i$ 是相应测试用例计算出的伪高波数能量分数 $R(T)$，表示为小数。不应打印任何其他文本。所有计算，包括任何变换步骤，都必须由您的代码显式执行，不得使用外部文件或用户输入。", "solution": "所提供的问题是计算流体动力学中一个适定且科学上合理的任务。它要求实现一个伪谱数值模拟，以研究在典范流——泰勒-格林涡的背景下，一种基本的数值伪影——混叠误差。所有必要的组成部分，包括控制方程、初始和边界条件、数值算法的详细描述以及测试用例的具体参数，都已提供。该问题是自洽的、一致的且在计算上是可行的。因此，有必要提供一个解决方案。\n\n目标是在双周期方形域 $[0, 2\\pi] \\times [0, 2\\pi]$ 上求解二维不可压缩纳维-斯托克斯方程：\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + (\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u} = -\\nabla p + \\nu \\nabla^2 \\boldsymbol{u}\n$$\n$$\n\\nabla\\cdot\\boldsymbol{u} = 0\n$$\n其中 $\\boldsymbol{u} = (u, v)$ 是速度场，$p$ 是压力，$\\nu$ 是运动粘度。模拟从泰勒-格林涡初始条件开始：\n$$\nu(x,y,0) = U_0 \\cos(k_0 x)\\sin(k_0 y)\n$$\n$$\nv(x,y,0) = -U_0 \\sin(k_0 x)\\cos(k_0 y)\n$$\n初始波数为 $k_0=1$，振幅为 $U_0$。\n\n数值解是使用伪谱法在大小为 $N \\times N$ 的均匀网格上构建的。\n\n**1. 离散化与谱表示**\n物理域 $[0, 2\\pi] \\times [0, 2\\pi]$ 被离散化为 $N \\times N$ 的点 $(x_i, y_j)$ 网格，其中 $x_i = i(2\\pi/N)$ 和 $y_j = j(2\\pi/N)$，对于 $i,j = 0, 1, \\dots, N-1$。此网格上的函数 $f(x,y)$ 在傅里叶空间中由其谱系数 $\\hat{f}(k_x, k_y)$ 表示，通过二维离散傅里叶变换（DFT）获得。对于长度为 $L=2\\pi$ 的域，对应的整数波数为 $k_x, k_y \\in \\{-N/2, \\dots, N/2-1\\}$。这些是使用标准FFT库建立的。我们构建与谱网格上每个点对应的二维波数数组 $K_x$ 和 $K_y$。\n\n**2. 时间积分方案**\n模拟从时刻 $t_n$ 的初始状态 $\\hat{\\boldsymbol{u}}^n$ 推进到时刻 $t_{n+1} = t_n + \\Delta t$ 的 $\\hat{\\boldsymbol{u}}^{n+1}$。问题指定了一种积分因子法，该方法隐式处理线性扩散项，显式处理非线性平流项。谱空间中的更新规则是：\n$$\n\\hat{\\boldsymbol{u}}^{n+1}(\\boldsymbol{k}) = e^{-\\nu |\\boldsymbol{k}|^2 \\Delta t} \\left( \\hat{\\boldsymbol{u}}^{n}(\\boldsymbol{k}) + \\Delta t\\,\\widehat{\\boldsymbol{N}}^{n}(\\boldsymbol{k}) \\right)\n$$\n这里，$|\\boldsymbol{k}|^2 = k_x^2 + k_y^2$，$\\widehat{\\boldsymbol{N}}$ 是非线性平流项 $-(\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u}$ 的无散部分的傅里叶变换。在每个时间步计算 $\\widehat{\\boldsymbol{N}}$ 的步骤如下。\n\n**2.1. 计算非线性项**\n项 $(\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u}$ 是二次的，因此在物理空间中计算效率很高（这是“伪谱”方法）。\n首先，在谱空间中计算梯度 $\\nabla\\boldsymbol{u}$ 所需的空间导数。例如，导数 $\\partial_x u$ 的傅里叶系数由 $(i k_x) \\hat{u}(k_x, k_y)$ 给出。\n算法是：\n1. 从谱空间中的速度场 $\\hat{u}^n$ 和 $\\hat{v}^n$ 开始。\n2. 计算所有四个梯度分量的谱表示：\n   - $\\widehat{\\partial_x u} = i K_x \\hat{u}^n$\n   - $\\widehat{\\partial_y u} = i K_y \\hat{u}^n$\n   - $\\widehat{\\partial_x v} = i K_x \\hat{v}^n$\n   - $\\widehat{\\partial_y v} = i K_y \\hat{v}^n$\n3. 使用逆二维FFT将速度分量及其导数变换到物理空间：\n   - $u^n = \\text{IFFT}(\\hat{u}^n)$, $v^n = \\text{IFFT}(\\hat{v}^n)$\n   - $\\partial_x u = \\text{IFFT}(\\widehat{\\partial_x u})$，依此类推。\n4. 在物理空间中，计算平流项的分量，我们称之为 $(A_u, A_v)$：\n   - $A_u = u^n (\\partial_x u) + v^n (\\partial_y u)$\n   - $A_v = u^n (\\partial_x v) + v^n (\\partial_y v)$\n5. 将平流项变换回谱空间：$\\widehat{\\boldsymbol{A}} = (\\widehat{A_u}, \\widehat{A_v}) = \\text{FFT}(A_u, A_v)$。\n根据问题规范，不对 $\\widehat{\\boldsymbol{A}}$ 应用任何去混叠滤波器（例如三分之二规则）。这使得由物理空间中的乘法引起的混叠误差能够污染所有波数模式。\n\n**2.2. 强制不可压缩性**\n纳维-斯托克斯方程要求速度场保持无散度。这是通过将非线性项 $\\widehat{\\boldsymbol{A}}$ 投影到无散度子空间上来强制执行的。时间更新所需的项是 $\\widehat{\\boldsymbol{N}} = -\\boldsymbol{P}(\\boldsymbol{k})\\widehat{\\boldsymbol{A}}$，其中 $\\boldsymbol{P}(\\boldsymbol{k})$ 是Leray投影算子。该算子移除了可以写成梯度的矢量场分量。在谱空间中，对于任何非零波数向量 $\\boldsymbol{k}=(k_x,k_y)$，投影由下式给出：\n$$\n\\boldsymbol{P}(\\boldsymbol{k}) \\widehat{\\boldsymbol{A}}(\\boldsymbol{k}) = \\widehat{\\boldsymbol{A}}(\\boldsymbol{k}) - \\frac{\\boldsymbol{k} (\\boldsymbol{k} \\cdot \\widehat{\\boldsymbol{A}}(\\boldsymbol{k}))}{|\\boldsymbol{k}|^2}\n$$\n此投影应用于每个波数 $\\boldsymbol{k} \\ne \\boldsymbol{0}$ 的计算出的谱平流项 $\\widehat{\\boldsymbol{A}}$。对于 $\\boldsymbol{k} = \\boldsymbol{0}$，不应用投影，其系数通常为零。更新的总非线性项为 $\\widehat{\\boldsymbol{N}}^n = -\\boldsymbol{P}(\\boldsymbol{k})\\widehat{\\boldsymbol{A}}^n$。\n\n**3. 测量伪能量**\n在总时间 $T$ 内运行模拟后，使用最终状态 $\\hat{\\boldsymbol{u}}(T)$ 计算伪高波数能量分数 $R(T)$。\n1. 能谱由傅里叶空间中的最终速度场计算得出：\n   $$\n   E(\\boldsymbol{k}, T) = \\frac{1}{2}\\left( |\\hat{u}(\\boldsymbol{k},T)|^2 + |\\hat{v}(\\boldsymbol{k},T)|^2 \\right)\n   $$\n   请注意，FFT的归一化不影响最终比率 $R(T)$，因此可以使用原始FFT输出。\n2. 所有已解析模式（不包括平均值 $\\boldsymbol{k}=\\boldsymbol{0}$ 模式）的总能量是谱上的总和：\n   $$\n   E_{\\text{total}} = \\sum_{\\boldsymbol{k}\\ne \\boldsymbol{0}} E(\\boldsymbol{k}, T)\n   $$\n3. 伪能量定义为驻留在高波数带中的能量。此带由波数幅值 $|\\boldsymbol{k}| = \\sqrt{k_x^2+k_y^2}$ 超过特定阈值的模式 $\\boldsymbol{k}$ 定义。阈值为 $f_h |\\boldsymbol{k}|_{\\max}$，其中 $f_h$ 是给定的分数，而 $|\\boldsymbol{k}|_{\\max}$ 是最大可分辨波数幅值。对于 $N \\times N$ 网格，最大波数分量为 $N/2$，因此 $|\\boldsymbol{k}|_{\\max} = \\sqrt{(N/2)^2 + (N/2)^2} = N/\\sqrt{2}$。高波数能量为：\n   $$\n   E_{\\text{high}} = \\sum_{|\\boldsymbol{k}| \\ge f_h |\\boldsymbol{k}|_{\\max}} E(\\boldsymbol{k}, T)\n   $$\n4. 最终度量是这两种能量的比率：\n   $$\n   R(T) = \\frac{E_{\\text{high}}}{E_{\\text{total}}}\n   $$\n此过程被实现并针对问题陈述中指定的四个测试用例中的每一个执行。结果展示了诸如非线性强度（与 $U_0$ 成正比）、粘度 $\\nu$ 和网格分辨率 $N$ 等因素如何影响由混叠产生的伪能量。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(N, nu, dt, T, U0, fh):\n    \"\"\"\n    Runs a single pseudo-spectral simulation of the 2D Taylor-Green vortex decay.\n\n    Args:\n        N (int): Grid size (N x N).\n        nu (float): Kinematic viscosity.\n        dt (float): Time step.\n        T (float): Final time.\n        U0 (float): Initial velocity amplitude.\n        fh (float): Fractional threshold for high-wavenumber band.\n\n    Returns:\n        float: Spurious high-wavenumber energy fraction R(T).\n    \"\"\"\n    # 1. Setup Grid and Wavenumbers\n    L = 2.0 * np.pi\n    k0 = 1.0\n    dx = L / N\n    x = np.arange(N) * dx\n    X, Y = np.meshgrid(x, x, indexing='ij')\n\n    # Wavenumbers (for a 2*pi domain, these are integers)\n    k = np.fft.fftfreq(N) * N\n    Kx, Ky = np.meshgrid(k, k, indexing='ij')\n    Ksq = Kx**2 + Ky**2\n    \n    # Inverse of Ksq for projection, handling division by zero at k=0\n    Ksq_inv = np.divide(1.0, Ksq, out=np.zeros_like(Ksq), where=Ksq != 0)\n\n    # 2. Initial Conditions\n    u = U0 * np.cos(k0 * X) * np.sin(k0 * Y)\n    v = -U0 * np.sin(k0 * X) * np.cos(k0 * Y)\n\n    u_hat = np.fft.fft2(u)\n    v_hat = np.fft.fft2(v)\n\n    # 3. Time-Stepping Loop\n    num_steps = int(round(T / dt))\n    \n    # Integrating factor for diffusion term\n    integrating_factor = np.exp(-nu * Ksq * dt)\n\n    for _ in range(num_steps):\n        # 3a. Compute nonlinear term in physical space\n        u = np.fft.ifft2(u_hat)\n        v = np.fft.ifft2(v_hat)\n        \n        du_dx_hat = 1j * Kx * u_hat\n        du_dy_hat = 1j * Ky * u_hat\n        dv_dx_hat = 1j * Kx * v_hat\n        dv_dy_hat = 1j * Ky * v_hat\n        \n        du_dx = np.fft.ifft2(du_dx_hat)\n        du_dy = np.fft.ifft2(du_dy_hat)\n        dv_dx = np.fft.ifft2(dv_dx_hat)\n        dv_dy = np.fft.ifft2(dv_dy_hat)\n\n        # Advection term A = (u.grad)u\n        # For the update equation, we need N = -(u.grad)u\n        A_u = u * du_dx + v * du_dy\n        A_v = u * dv_dx + v * dv_dy\n\n        A_u_hat = np.fft.fft2(A_u)\n        A_v_hat = np.fft.fft2(A_v)\n\n        # 3b. Project nonlinear term to be divergence-free\n        # N_hat_projected = -P(A_hat)\n        k_dot_A_hat = Kx * A_u_hat + Ky * A_v_hat\n        \n        N_u_hat = -(A_u_hat - Kx * k_dot_A_hat * Ksq_inv)\n        N_v_hat = -(A_v_hat - Ky * k_dot_A_hat * Ksq_inv)\n\n        # 3c. Update in spectral space\n        u_hat = integrating_factor * (u_hat + dt * N_u_hat)\n        v_hat = integrating_factor * (v_hat + dt * N_v_hat)\n\n    # 4. Compute Spurious Energy Fraction R(T)\n    # Energy spectrum E(k) = 0.5 * (|u_hat|^2 + |v_hat|^2)\n    energy_spectrum = 0.5 * (np.abs(u_hat)**2 + np.abs(v_hat)**2)\n\n    # Maximum resolvable wavenumber magnitude\n    k_max_mag = np.sqrt(2 * (N / 2)**2)\n    \n    # Calculate mask for high-wavenumber band\n    k_mag = np.sqrt(Ksq)\n    high_wavenumber_mask = k_mag >= fh * k_max_mag\n\n    # Calculate total and high-wavenumber energies\n    # Exclude the k=0 mode from total energy\n    total_energy_mask = k_mag > 0\n    total_energy = np.sum(energy_spectrum[total_energy_mask])\n    high_wavenumber_energy = np.sum(energy_spectrum[high_wavenumber_mask])\n\n    if total_energy == 0:\n        return 0.0\n\n    return high_wavenumber_energy / total_energy\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1\n        {'N': 32, 'nu': 0.01, 'dt': 0.002, 'T': 0.2, 'U0': 1.0, 'fh': 0.8},\n        # Case 2\n        {'N': 32, 'nu': 0.01, 'dt': 0.002, 'T': 0.2, 'U0': 4.0, 'fh': 0.8},\n        # Case 3\n        {'N': 32, 'nu': 0.0, 'dt': 0.001, 'T': 0.2, 'U0': 1.0, 'fh': 0.8},\n        # Case 4\n        {'N': 64, 'nu': 0.01, 'dt': 0.002, 'T': 0.2, 'U0': 1.0, 'fh': 0.8},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(\n            N=case['N'],\n            nu=case['nu'],\n            dt=case['dt'],\n            T=case['T'],\n            U0=case['U0'],\n            fh=case['fh']\n        )\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```", "id": "3370572"}, {"introduction": "这最后一个练习是一个综合性项目：对三维泰勒-格林涡进行一次完整的直接数值模拟（DNS）。与其二维形式不同，该流场是不稳定的，并会向湍流状态演化，展示了从大尺度到小尺度的真实能量级串过程。通过实现这一模拟并分析能量谱，学习者将亲眼见证一个基本的湍流机制，并对照一个经典基准案例来验证自己的代码 [@problem_id:3370566]。", "problem": "考虑一个边长为 $L = 2\\pi$ 的三重周期立方体域上的三维不可压缩纳维-斯托克斯方程，其空间坐标为 $(x,y,z) \\in [0,2\\pi]^3$，速度场为 $\\boldsymbol{u}(x,y,z,t) = (u(x,y,z,t), v(x,y,z,t), w(x,y,z,t))$。控制方程为\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + (\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u} = -\\nabla p + \\nu \\nabla^2 \\boldsymbol{u}, \\quad \\nabla \\cdot \\boldsymbol{u} = 0,\n$$\n其中 $p$ 是压力，$\\nu$ 是运动粘度。初始条件是经典的三维泰勒-格林涡：\n$$\nu(x,y,z,0) = U_0 \\sin(x)\\cos(y)\\cos(z), \\quad v(x,y,z,0) = -U_0 \\cos(x)\\sin(y)\\cos(z), \\quad w(x,y,z,0) = 0,\n$$\n其中 $U_0$ 是特征速度幅值。\n\n您将使用伪谱方法，在具有 $N^3$ 个点的均匀网格上对上述系统进行直接数值模拟（DNS），其中 $N$ 是每个空间方向上的网格点数，并采用周期性边界条件。使用标准的基于傅里叶的不可压缩投影，在傅里叶空间中消除非线性项的散度。时间积分必须通过积分因子精确处理粘性项，并使用二阶Adams-Bashforth方法显式推进非线性项。在傅里叶空间中对非线性项使用2/3规则进行反走样处理。\n\n通过将离散傅里叶空间中的动能分箱到整数波数大小 $k \\in \\mathbb{N}$ 的球壳中，定义一维各向同性动能谱 $E(k,t)$：\n$$\nE(k,t) = \\frac{1}{2}\\sum_{\\boldsymbol{\\kappa} \\in S_k} \\frac{\\left|\\hat{u}(\\boldsymbol{\\kappa},t)\\right|^2 + \\left|\\hat{v}(\\boldsymbol{\\kappa},t)\\right|^2 + \\left|\\hat{w}(\\boldsymbol{\\kappa},t)\\right|^2}{N^3},\n$$\n其中 $\\hat{u}$、$\\hat{v}$ 和 $\\hat{w}$ 分别是 $u$、$v$ 和 $w$ 的离散傅里叶变换，而 $S_k = \\{\\boldsymbol{\\kappa} : \\|\\boldsymbol{\\kappa}\\| \\approx k\\}$ 表示大小最接近 $k$ 的模态壳层。在时间 $t$ 的单位质量总动能为\n$$\n\\mathcal{K}(t) = \\frac{1}{2}\\left\\langle u^2 + v^2 + w^2 \\right\\rangle = \\frac{1}{2N^3}\\sum_{i,j,\\ell} \\left( u_{i,j,\\ell}^2(t) + v_{i,j,\\ell}^2(t) + w_{i,j,\\ell}^2(t) \\right).\n$$\n定义谱质心为\n$$\nC(t) = \\frac{\\sum_{k=1}^{k_{\\max}} k\\, E(k,t)}{\\sum_{k=1}^{k_{\\max}} E(k,t)},\n$$\n其中 $k_{\\max}$ 是离散网格中可分辨的最大整数壳层指数。\n\n您的程序必须通过三维泰勒-格林涡衰减的直接数值模拟（DNS）计算能量谱 $E(k,t)$ 的时间演化，并验证在耗散之前能量从低波数向高波数的预期转移。使用以下参数集测试套件，其中所有物理量必须以其指定单位处理。时间应以固定时间步长推进。角度单位是弧度，空间坐标单位是米：\n\n- 测试用例 1：$N=32$，$U_0=1.0$ 单位 $\\mathrm{m/s}$，$\\nu=0.01$ 单位 $\\mathrm{m^2/s}$，$\\Delta t=0.005$ 单位 $\\mathrm{s}$，$t_{\\mathrm{mid}}=0.20$ 单位 $\\mathrm{s}$，$t_{\\mathrm{final}}=0.60$ 单位 $\\mathrm{s}$。\n- 测试用例 2：$N=32$，$U_0=1.0$ 单位 $\\mathrm{m/s}$，$\\nu=0.10$ 单位 $\\mathrm{m^2/s}$，$\\Delta t=0.005$ 单位 $\\mathrm{s}$，$t_{\\mathrm{mid}}=0.10$ 单位 $\\mathrm{s}$，$t_{\\mathrm{final}}=0.30$ 单位 $\\mathrm{s}$。\n- 测试用例 3：$N=32$，$U_0=1.0$ 单位 $\\mathrm{m/s}$，$\\nu=0.005$ 单位 $\\mathrm{m^2/s}$，$\\Delta t=0.004$ 单位 $\\mathrm{s}$，$t_{\\mathrm{mid}}=0.30$ 单位 $\\mathrm{s}$，$t_{\\mathrm{final}}=0.80$ 单位 $\\mathrm{s}$。\n\n对于每个测试用例，计算在时间 $t=0$、$t=t_{\\mathrm{mid}}$ 和 $t=t_{\\mathrm{final}}$ 时的 $E(k,t)$。根据这些谱，计算：\n\n- 布尔值 $B_1$，表示谱质心是否从 $t=0$ 增加到 $t=t_{\\mathrm{mid}}$，即 $C(t_{\\mathrm{mid}}) > C(0)$。\n- 布尔值 $B_2$，表示总动能是否从 $t=0$ 严格减少到 $t=t_{\\mathrm{final}}$，即 $\\mathcal{K}(t_{\\mathrm{final}})  \\mathcal{K}(0)$。\n- 整数峰值壳层指数 $K_0$、$K_{\\mathrm{mid}}$ 和 $K_{\\mathrm{final}}$，定义为在时间 $t=0$、$t=t_{\\mathrm{mid}}$ 和 $t=t_{\\mathrm{final}}$ 时，$E(k,t)$ 达到其最大值时的整数 $k$。\n\n您的程序应生成单行输出，其中包含结果，格式为方括号括起来的逗号分隔列表，每个测试用例一个列表，并按顺序排列。每个测试用例的列表必须是 $[B_1,B_2,K_0,K_{\\mathrm{mid}},K_{\\mathrm{final}}]$ 的形式，其中布尔值为 $\\mathrm{True}$ 或 $\\mathrm{False}$，整数为十进制数字。例如，总输出格式为 $[[\\cdot],[\\cdot],[\\cdot]]$。", "solution": "该问题要求对三维泰勒-格林涡衰减进行直接数值模拟（DNS）。解决方案是使用伪谱方法获得的。该过程涉及初始化流场，使用处理纳维-斯托克斯方程的非线性项和粘性项的数值方案随时间推进流场，最后在指定时间分析产生的动能分布。\n\n### 1. 傅里叶空间中的控制方程\n\n不可压缩的纳维-斯托克斯方程由下式给出：\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + (\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u} = -\\nabla p + \\nu \\nabla^2 \\boldsymbol{u}\n$$\n$$\n\\nabla \\cdot \\boldsymbol{u} = 0\n$$\n对于边长为 $L=2\\pi$ 的周期性域，使用傅里叶级数的光谱方法是合适的。速度场 $\\boldsymbol{u}(\\boldsymbol{x},t)$ 由其傅里叶系数 $\\hat{\\boldsymbol{u}}(\\boldsymbol{\\kappa},t)$ 表示，其中 $\\boldsymbol{\\kappa} = (k_x, k_y, k_z)$ 是整数波数向量。\n\n对纳维-斯托克斯方程应用傅里叶变换，空间导数变成了与波数向量的乘法。无散度条件 $\\nabla \\cdot \\boldsymbol{u} = 0$ 变为 $i\\boldsymbol{\\kappa} \\cdot \\hat{\\boldsymbol{u}} = 0$，这意味着傅里叶速度向量垂直于波数向量。压力项 $\\nabla p$ 是一个梯度，因此其傅里叶变换 $i\\boldsymbol{\\kappa}\\hat{p}$ 与 $\\boldsymbol{\\kappa}$ 平行。这使我们能够通过将方程投影到无散度向量场的空间来消除压力项。傅里叶空间中的投影算子为 $\\mathbb{P}(\\hat{\\boldsymbol{f}}) = \\hat{\\boldsymbol{f}} - (\\hat{\\boldsymbol{f}} \\cdot \\boldsymbol{\\kappa})\\boldsymbol{\\kappa}/|\\boldsymbol{\\kappa}|^2$，其中 $\\boldsymbol{\\kappa} \\neq \\mathbf{0}$。\n\n变换后的动量方程变为关于每个傅里叶模态 $\\hat{\\boldsymbol{u}}(\\boldsymbol{\\kappa},t)$ 的常微分方程（ODE）：\n$$\n\\frac{d \\hat{\\boldsymbol{u}}}{d t} = \\mathbb{P}\\left(-\\mathcal{F}\\{(\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u}\\}\\right) - \\nu |\\boldsymbol{\\kappa}|^2 \\hat{\\boldsymbol{u}}\n$$\n其中 $\\mathcal{F}\\{\\cdot\\}$ 表示傅里叶变换，且 $|\\boldsymbol{\\kappa}|^2 = k_x^2 + k_y^2 + k_z^2$。我们将投影后的非线性项表示为 $\\hat{\\boldsymbol{N}}_{\\text{proj}} = \\mathbb{P}\\left(-\\mathcal{F}\\{(\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u}\\}\\right)$。该常微分方程组为：\n$$\n\\frac{d \\hat{\\boldsymbol{u}}}{d t} = \\hat{\\boldsymbol{N}}_{\\text{proj}}(\\hat{\\boldsymbol{u}}) - \\nu |\\boldsymbol{\\kappa}|^2 \\hat{\\boldsymbol{u}}\n$$\n\n### 2. 数值方案\n\n时间积分按规定使用半隐式方案进行。为保证稳定性，粘性（线性）项被隐式处理，而对流（非线性）项被显式处理。问题中提到的方案可以解释为使用二阶Adams-Bashforth处理非线性项，并用积分因子或Crank-Nicolson处理粘性项。一个标准的、稳定的二阶精度方法是AB2/CN（Adams-Bashforth/Crank-Nicolson）。\n\n对于从 $t_n$ 到 $t_{n+1} = t_n + \\Delta t$ 的一个时间步长，AB2/CN方案为：\n$$\n\\frac{\\hat{\\boldsymbol{u}}^{n+1} - \\hat{\\boldsymbol{u}}^n}{\\Delta t} = \\left(\\frac{3}{2}\\hat{\\boldsymbol{N}}_{\\text{proj}}^n - \\frac{1}{2}\\hat{\\boldsymbol{N}}_{\\text{proj}}^{n-1}\\right) - \\frac{\\nu |\\boldsymbol{\\kappa}|^2}{2}(\\hat{\\boldsymbol{u}}^{n+1} + \\hat{\\boldsymbol{u}}^n)\n$$\n其中上标表示时间步索引。重新整理以求解 $\\hat{\\boldsymbol{u}}^{n+1}$：\n$$\n\\left(1 + \\frac{\\nu |\\boldsymbol{\\kappa}|^2 \\Delta t}{2}\\right)\\hat{\\boldsymbol{u}}^{n+1} = \\left(1 - \\frac{\\nu |\\boldsymbol{\\kappa}|^2 \\Delta t}{2}\\right)\\hat{\\boldsymbol{u}}^n + \\Delta t \\left(\\frac{3}{2}\\hat{\\boldsymbol{N}}_{\\text{proj}}^n - \\frac{1}{2}\\hat{\\boldsymbol{N}}_{\\text{proj}}^{n-1}\\right)\n$$\n该方案需要前两个时间步的值（$\\hat{\\boldsymbol{N}}_{\\text{proj}}^n$ 和 $\\hat{\\boldsymbol{N}}_{\\text{proj}}^{n-1}$）。因此，第一个时间步需要不同的方法。这里采用一阶半隐式欧拉方案，对于单个启动步骤，其精度足够：\n$$\n\\frac{\\hat{\\boldsymbol{u}}^1 - \\hat{\\boldsymbol{u}}^0}{\\Delta t} = \\hat{\\boldsymbol{N}}_{\\text{proj}}^0 - \\nu |\\boldsymbol{\\kappa}|^2 \\hat{\\boldsymbol{u}}^1 \\implies \\left(1 + \\nu |\\boldsymbol{\\kappa}|^2 \\Delta t\\right)\\hat{\\boldsymbol{u}}^1 = \\hat{\\boldsymbol{u}}^0 + \\Delta t \\hat{\\boldsymbol{N}}_{\\text{proj}}^0\n$$\n\n### 3. 非线性项的伪谱计算\n\n项 $(\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u}$ 是非线性的，在傅里叶空间中产生卷积。为避免昂贵的卷积计算，使用伪谱方法。在每个时间步计算 $\\hat{\\boldsymbol{N}}_{\\text{proj}}$ 的步骤如下：\n1.  从傅里叶空间中的速度场 $\\hat{\\boldsymbol{u}}(\\boldsymbol{\\kappa},t)$ 开始。\n2.  计算空间导数的傅里叶变换，例如 $\\mathcal{F}\\{\\partial u/\\partial x\\} = i k_x \\hat{u}$。\n3.  使用逆快速傅里叶变换（IFFT）将速度分量及其导数转换到物理空间。\n4.  在物理空间中，计算乘积，例如 $u(x,y,z) \\cdot \\frac{\\partial u}{\\partial x}(x,y,z)$，并将它们相加形成 $(\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u}$ 的分量。\n5.  使用快速傅里叶变换（FFT）将得到的非线性对流项向量变换回傅里叶空间。\n6.  **反走样**：为防止二次非线性引起的走样误差，需要移除乘积产生的高频模态。应用 $2/3$ 规则，将波数向量任一分量满足 $|k_i| > K_c = \\lfloor N/3 \\rfloor$ 的所有傅里叶系数 $\\hat{f}(\\boldsymbol{\\kappa})$ 设置为零。对于 $N=32$，截止波数为 $K_c=10$。此滤波应用于非线性项的傅里叶表示及其结果状态。\n7.  **投影**：将经过反走样处理的非线性项投影到无散度场的空间，以强制执行不可压缩性约束，从而得到 $\\hat{\\boldsymbol{N}}_{\\text{proj}}$。\n\n### 4. 初始化与后处理\n\n模拟在 $t=0$ 时用指定的泰勒-格林涡速度场进行初始化：\n$$\nu(x,y,z,0) = U_0 \\sin(x)\\cos(y)\\cos(z) \\\\\nv(x,y,z,0) = -U_0 \\cos(x)\\sin(y)\\cos(z) \\\\\nw(x,y,z,0) = 0\n$$\n速度场在 $N^3$ 网格上初始化，然后变换到傅里叶空间以获得 $\\hat{\\boldsymbol{u}}(\\boldsymbol{\\kappa},0)$。\n\n在时间 $t=0, t_{\\text{mid}}, t_{\\text{final}}$，计算以下物理量：\n- **总动能**：使用帕萨瓦尔定理，它在傅里叶空间中计算。问题中对 $\\mathcal{K}(t)$ 的定义与傅里叶模态上的求和关系如下：\n  $$\n  \\mathcal{K}(t) = \\frac{1}{2N^6} \\sum_{\\boldsymbol{\\kappa}} \\left( |\\hat{u}(\\boldsymbol{\\kappa},t)|^2 + |\\hat{v}(\\boldsymbol{\\kappa},t)|^2 + |\\hat{w}(\\boldsymbol{\\kappa},t)|^2 \\right)\n  $$\n- **动能谱 $E(k,t)$**：傅里叶空间中的离散动能根据整数波数大小 $k = \\text{round}(\\|\\boldsymbol{\\kappa}\\|)$ 被分箱到球壳中。\n  $$\n  E(k,t) = \\frac{1}{2N^3} \\sum_{\\boldsymbol{\\kappa} \\text{ s.t. round}(\\|\\boldsymbol{\\kappa}\\|)=k} \\left( |\\hat{u}(\\boldsymbol{\\kappa},t)|^2 + |\\hat{v}(\\boldsymbol{\\kappa},t)|^2 + |\\hat{w}(\\boldsymbol{\\kappa},t)|^2 \\right)\n  $$\n- **谱质心 $C(t)$**：这是能量加权的平均波数：\n  $$\n  C(t) = \\frac{\\sum_{k=1}^{k_{\\max}} k\\, E(k,t)}{\\sum_{k=1}^{k_{\\max}} E(k,t)}\n  $$\n  其中 $k_{\\max}$ 是在反走样网格上可达到的最大整数壳层指数，即 $k_{\\max} = \\text{round}(\\sqrt{3 K_c^2})$。对于 $N=32$，$K_c=10$，所以 $k_{\\max}=17$。\n- **峰值壳层指数 $K$**：使得 $E(k,t)$ 达到最大值的整数波数 $k$。\n\n然后，使用这些计算出的量来确定布尔值 $B_1 = (C(t_{\\mathrm{mid}}) > C(0))$ 和 $B_2 = (\\mathcal{K}(t_{\\mathrm{final}})  \\mathcal{K}(0))$，以及峰值指数 $K_0, K_{\\mathrm{mid}}, K_{\\mathrm{final}}$。初始条件仅激发 $\\|\\boldsymbol{\\kappa}\\| = \\sqrt{3} \\approx 1.732$ 的模态，因此它们落在 $k=2$ 的壳层中，得出 $K_0=2$ 的预期值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef run_dns(N, U0, nu, dt, t_mid, t_final):\n    \"\"\"\n    Performs a Direct Numerical Simulation of the 3D Taylor-Green vortex decay.\n    \"\"\"\n    # 1. Grid and Wavenumber Setup\n    L = 2 * np.pi\n    x = np.linspace(0, L, N, endpoint=False)\n    y = np.linspace(0, L, N, endpoint=False)\n    z = np.linspace(0, L, N, endpoint=False)\n    X, Y, Z = np.meshgrid(x, y, z, indexing='ij')\n\n    k = np.fft.fftfreq(N, d=L / (2 * np.pi * N))\n    Kx, Ky, Kz = np.meshgrid(k, k, k, indexing='ij')\n    K_sq = Kx**2 + Ky**2 + Kz**2\n    \n    # Dealiasing mask (2/3 rule)\n    K_c = math.floor(N / 3.0)\n    dealias_mask = (np.abs(Kx) = K_c)  (np.abs(Ky) = K_c)  (np.abs(Kz) = K_c)\n    \n    # Wavenumber magnitudes for shell binning\n    K_mag = np.sqrt(K_sq)\n    k_max = int(np.round(np.sqrt(3 * K_c**2)))\n    K_mag_rounded = np.round(K_mag).astype(int)\n    \n    # 2. Initial Conditions\n    u0 = U0 * np.sin(X) * np.cos(Y) * np.cos(Z)\n    v0 = -U0 * np.cos(X) * np.sin(Y) * np.cos(Z)\n    w0 = np.zeros_like(u0)\n\n    u_hat = np.fft.fftn(u0)\n    v_hat = np.fft.fftn(v0)\n    w_hat = np.fft.fftn(w0)\n\n    # 3. Helper Functions\n    def calculate_nonlinear_term(u_h, v_h, w_h):\n        ikx, iky, ikz = 1j * Kx, 1j * Ky, 1j * Kz\n\n        u = np.fft.ifftn(u_h)\n        v = np.fft.ifftn(v_h)\n        w = np.fft.ifftn(w_h)\n\n        du_dx = np.fft.ifftn(ikx * u_h)\n        du_dy = np.fft.ifftn(iky * u_h)\n        du_dz = np.fft.ifftn(ikz * u_h)\n        dv_dx = np.fft.ifftn(ikx * v_h)\n        dv_dy = np.fft.ifftn(iky * v_h)\n        dv_dz = np.fft.ifftn(ikz * v_h)\n        dw_dx = np.fft.ifftn(ikx * w_h)\n        dw_dy = np.fft.ifftn(iky * w_h)\n        dw_dz = np.fft.ifftn(ikz * w_h)\n\n        nl_u = u * du_dx + v * du_dy + w * du_dz\n        nl_v = u * dv_dx + v * dv_dy + w * dv_dz\n        nl_w = u * dw_dx + v * dw_dy + w * dw_dz\n\n        nl_u_hat = np.fft.fftn(nl_u) * dealias_mask\n        nl_v_hat = np.fft.fftn(nl_v) * dealias_mask\n        nl_w_hat = np.fft.fftn(nl_w) * dealias_mask\n\n        # Projection\n        k_sq_inv = np.divide(1.0, K_sq, out=np.zeros_like(K_sq), where=K_sq!=0)\n        k_dot_nl = Kx * nl_u_hat + Ky * nl_v_hat + Kz * nl_w_hat\n        \n        N_u_proj_hat = nl_u_hat - k_dot_nl * k_sq_inv * Kx\n        N_v_proj_hat = nl_v_hat - k_dot_nl * k_sq_inv * Ky\n        N_w_proj_hat = nl_w_hat - k_dot_nl * k_sq_inv * Kz\n\n        return -N_u_proj_hat, -N_v_proj_hat, -N_w_proj_hat\n\n    def analyze_state(u_h, v_h, w_h):\n        kin_energy_hat = 0.5 * (np.abs(u_h)**2 + np.abs(v_h)**2 + np.abs(w_h)**2)\n        \n        total_kin_energy = np.sum(kin_energy_hat) / (N**6)\n        \n        E_k = np.zeros(k_max + 1)\n        for k_shell in range(1, k_max + 1):\n            mask = (K_mag_rounded == k_shell)\n            E_k[k_shell] = np.sum(kin_energy_hat[mask]) / (N**3)\n        \n        sum_E_k = np.sum(E_k[1:])\n        if sum_E_k == 0:\n            centroid = 0.0\n        else:\n            k_vals = np.arange(1, k_max + 1)\n            centroid = np.sum(k_vals * E_k[1:]) / sum_E_k\n            \n        if np.all(E_k[1:] == 0):\n             peak_k = 0\n        else:\n             peak_k = np.argmax(E_k[1:]) + 1\n\n        return total_kin_energy, centroid, peak_k\n\n    # 4. Time Integration\n    t = 0.0\n    n_steps = int(np.ceil(t_final / dt))\n    \n    # Analysis at t=0\n    K0, C0, K_peak0 = analyze_state(u_hat, v_hat, w_hat)\n    \n    # Storage for results\n    results = {'K0': K0, 'K_peak0': K_peak0, 'C0': C0}\n\n    # Starter step (1st-order semi-implicit)\n    Nu0_hat, Nv0_hat, Nw0_hat = calculate_nonlinear_term(u_hat, v_hat, w_hat)\n    \n    # Precompute viscous term factors for starter\n    visc_factor_starter = 1.0 / (1.0 + nu * K_sq * dt)\n    u_hat_n1 = visc_factor_starter * (u_hat + dt * Nu0_hat)\n    v_hat_n1 = visc_factor_starter * (v_hat + dt * Nv0_hat)\n    w_hat_n1 = visc_factor_starter * (w_hat + dt * Nw0_hat)\n\n    # Apply dealiasing to the state\n    u_hat_n1 *= dealias_mask\n    v_hat_n1 *= dealias_mask\n    w_hat_n1 *= dealias_mask\n\n    # Update for next step\n    u_hat = u_hat_n1\n    v_hat = v_hat_n1\n    w_hat = w_hat_n1\n    N_u_hat_old, N_v_hat_old, N_w_hat_old = Nu0_hat, Nv0_hat, Nw0_hat\n    t += dt\n\n    # Check for analysis at step 1\n    if abs(t - t_mid)  dt / 2:\n        _, C_mid, K_mid = analyze_state(u_hat, v_hat, w_hat)\n        results['C_mid'] = C_mid\n        results['K_mid'] = K_mid\n    if abs(t - t_final)  dt / 2:\n        K_final, _, K_peak_final = analyze_state(u_hat, v_hat, w_hat)\n        results['K_final'] = K_final\n        results['K_peak_final'] = K_peak_final\n\n    # Precompute viscous factors for AB2/CN main loop\n    visc_factor1 = (1.0 - 0.5 * nu * K_sq * dt) / (1.0 + 0.5 * nu * K_sq * dt)\n    visc_factor2 = dt / (1.0 + 0.5 * nu * K_sq * dt)\n\n    # Main loop (2nd-order AB2/CN)\n    for n in range(1, n_steps):\n        Nu_hat, Nv_hat, Nw_hat = calculate_nonlinear_term(u_hat, v_hat, w_hat)\n        \n        nl_term_u = 1.5 * Nu_hat - 0.5 * N_u_hat_old\n        nl_term_v = 1.5 * Nv_hat - 0.5 * N_v_hat_old\n        nl_term_w = 1.5 * Nw_hat - 0.5 * N_w_hat_old\n        \n        u_hat_n1 = visc_factor1 * u_hat + visc_factor2 * nl_term_u\n        v_hat_n1 = visc_factor1 * v_hat + visc_factor2 * nl_term_v\n        w_hat_n1 = visc_factor1 * w_hat + visc_factor2 * nl_term_w\n\n        # Apply dealiasing to the state\n        u_hat_n1 *= dealias_mask\n        v_hat_n1 *= dealias_mask\n        w_hat_n1 *= dealias_mask\n\n        # Update for next step\n        u_hat, v_hat, w_hat = u_hat_n1, v_hat_n1, w_hat_n1\n        N_u_hat_old, N_v_hat_old, N_w_hat_old = Nu_hat, Nv_hat, Nw_hat\n        t += dt\n\n        if abs(t - t_mid)  dt / 2:\n            _, C_mid, K_mid = analyze_state(u_hat, v_hat, w_hat)\n            results['C_mid'] = C_mid\n            results['K_mid'] = K_mid\n        if abs(t - t_final)  dt / 2:\n            K_final, _, K_peak_final = analyze_state(u_hat, v_hat, w_hat)\n            results['K_final'] = K_final\n            results['K_peak_final'] = K_peak_final\n\n    # 5. Final Calculations\n    B1 = results.get('C_mid', 0) > results['C0']\n    B2 = results.get('K_final', K0)  K0\n    K0_peak = results['K_peak0']\n    K_mid_peak = results.get('K_mid', 0)\n    K_final_peak = results.get('K_peak_final', 0)\n    \n    return [B1, B2, K0_peak, K_mid_peak, K_final_peak]\n\ndef solve():\n    \"\"\"\n    Main solver function that runs the test suite.\n    \"\"\"\n    test_cases = [\n        {'N': 32, 'U0': 1.0, 'nu': 0.01, 'dt': 0.005, 't_mid': 0.20, 't_final': 0.60},\n        {'N': 32, 'U0': 1.0, 'nu': 0.10, 'dt': 0.005, 't_mid': 0.10, 't_final': 0.30},\n        {'N': 32, 'U0': 1.0, 'nu': 0.005, 'dt': 0.004, 't_mid': 0.30, 't_final': 0.80},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_dns(**case)\n        results.append(result)\n\n    # Convert list of lists to the required string format\n    result_str = ','.join(map(str, results))\n    print(f\"[{result_str}]\")\n\nsolve()\n\n```", "id": "3370566"}]}