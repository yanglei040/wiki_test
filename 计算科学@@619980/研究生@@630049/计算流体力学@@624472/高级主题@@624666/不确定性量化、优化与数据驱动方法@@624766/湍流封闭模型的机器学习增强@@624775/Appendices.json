{"hands_on_practices": [{"introduction": "要增强湍流模型，第一步是理解修正项在何处以及如何影响流动物理。湍动能（$k$）收支平衡是许多雷诺平均（RANS）模型的基石，它描述了湍流的产生、耗散和输运之间的平衡。本练习提供了一个具体的定量分析，探讨了对涡粘性的机器学习修正如何直接改变控制体积内的湍动能收支项。通过完成这一推导和计算，您将对机器学习增强闭包的物理影响获得基础性理解 [@problem_id:3342944]。", "problem": "考虑一个由雷诺平均纳维-斯托克斯 (RANS) 方程控制的不可压缩湍流。令湍动能 (TKE) 定义为 $k = \\frac{1}{2} \\langle u_{i}' u_{i}' \\rangle$，其中 $\\langle \\cdot \\rangle$ 表示雷诺平均，$u_{i}'$ 是脉动速度。从 $k$ 的精确雷诺平均输运方程出发，推导其收支分解为产生项、耗散项和输运项。使用 Boussinesq 涡粘性近似 $- \\langle u_{i}' u_{j}' \\rangle = 2 \\nu_{t} S_{ij} - \\frac{2}{3} k \\delta_{ij}$，其中 $\\nu_{t}$ 是涡粘性系数，$S_{ij} = \\frac{1}{2} \\left( \\frac{\\partial U_{i}}{\\partial x_{j}} + \\frac{\\partial U_{j}}{\\partial x_{i}} \\right)$ 是平均应变率张量，来表示模化的产生项 $P_{k}$，用 $\\nu_{t}$ 和 $S_{ij}$ 表示。使用梯度扩散模型对输运项进行建模，其有效扩散系数由 $T_{j} = - \\left( \\nu + \\frac{\\nu_{t}}{\\sigma_{k}} \\right) \\frac{\\partial k}{\\partial x_{j}}$ 给出，其中 $\\nu$ 是运动粘度，$\\sigma_{k}$ 是一个正常数。\n\n然后，将 $k$ 方程在一个矩形控制体积上积分，该控制体积在流向和展向上具有周期性边界，并在 $y = 0$ 和 $y = H$ 处有不可渗透的壁面。该控制体积的宽度、长度和高度分别为 $L_{z}$、$L_{x}$ 和 $H$，其中 $L_{x} = 1\\,\\mathrm{m}$，$L_{z} = 0.5\\,\\mathrm{m}$，$H = 0.1\\,\\mathrm{m}$。平均流具有空间均匀的剪切 $\\frac{\\partial U_{x}}{\\partial y} = S$，其中 $S = 100\\,\\mathrm{s^{-1}}$，其他平均梯度为零。假设耗散项 $\\varepsilon$ 是均匀的，为 $\\varepsilon = 4\\,\\mathrm{m^{2}\\,s^{-3}}$，$k$ 的梯度也是均匀的，为 $\\frac{\\partial k}{\\partial y} = -10\\,\\mathrm{m^{2}\\,s^{-2}\\,m^{-1}}$。分子运动粘度为 $\\nu = 1.0 \\times 10^{-6}\\,\\mathrm{m^{2}\\,s^{-1}}$，基准涡粘性系数（未经增强）在空间上是均匀的，为 $\\nu_{t,0} = 5.0 \\times 10^{-4}\\,\\mathrm{m^{2}\\,s^{-1}}$。令 $\\sigma_{k} = 1.0$。\n\n一个机器学习 (ML) 修正在涡粘性系数上进行增强，形式为 $\\nu_{t}^{\\mathrm{ML}}(y) = \\nu_{t,0} \\left[ 1 + \\alpha \\, \\phi(y) \\right]$，其中 $\\alpha = 0.2$，特征为 $\\phi(y) = \\frac{y}{H}$。使用推导出的全局（控制体积积分的）$k$ 收支方程，计算在 ML 修正下，控制体积积分的湍动能的瞬时变化率 $\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{V} k \\,\\mathrm{d}V$。以 $\\mathrm{m^{5}\\,s^{-3}}$ 为单位表示最终答案，并四舍五入到四位有效数字。", "solution": "该问题要求在特定的流动配置下，计算体积积分的湍动能 (TKE) 的瞬时变化率。这涉及到推导积分的 TKE 收支方程，然后使用给定的模型和参数对每一项进行求值。\n\n湍动能 $k = \\frac{1}{2} \\langle u_{i}' u_{i}' \\rangle$ 的精确雷诺平均输运方程为：\n$$\n\\frac{\\partial k}{\\partial t} + U_j \\frac{\\partial k}{\\partial x_j} = P_k - \\varepsilon + \\mathcal{D}_k\n$$\n其中 $U_j$ 是平均速度，$P_k = - \\langle u_{i}' u_{j}' \\rangle \\frac{\\partial U_{i}}{\\partial x_{j}}$ 是 TKE 的产生率，$\\varepsilon = \\nu \\langle \\frac{\\partial u_{i}'}{\\partial x_{j}} \\frac{\\partial u_{i}'}{\\partial x_{j}} \\rangle$ 是耗散率，$\\mathcal{D}_k$ 是输运项，包括湍流、压力和粘性扩散效应。输运项可以写成散度形式，$\\mathcal{D}_k = \\frac{\\partial T_{j}^{\\text{total}}}{\\partial x_j}$。问题为该总输运通量 $T_j$ 提供了一个模型。\n\n利用不可压缩条件 $\\frac{\\partial U_j}{\\partial x_j} = 0$，对流项可以写为 $U_j \\frac{\\partial k}{\\partial x_j} = \\frac{\\partial (U_j k)}{\\partial x_j}$。因此，模化的 TKE 方程为：\n$$\n\\frac{\\partial k}{\\partial t} + \\frac{\\partial (U_j k)}{\\partial x_j} = P_k - \\varepsilon + \\frac{\\partial T_j}{\\partial x_j}\n$$\n其中 $T_j = - \\left( \\nu + \\frac{\\nu_{t}}{\\sigma_{k}} \\right) \\frac{\\partial k}{\\partial x_{j}}$。\n\n首先，我们使用 Boussinesq 涡粘性近似 $- \\langle u_{i}' u_{j}' \\rangle = 2 \\nu_{t} S_{ij} - \\frac{2}{3} k \\delta_{ij}$ 来表示产生项 $P_k$。产生项可以写为 $P_k = - \\langle u_i' u_j' \\rangle S_{ij}$，因为对称张量（$\\langle u_i' u_j' \\rangle$）与反对称张量（平均旋转速率张量）的乘积为零。\n代入 Boussinesq 模型：\n$$\nP_k = \\left( 2 \\nu_t S_{ij} - \\frac{2}{3} k \\delta_{ij} \\right) S_{ij} = 2 \\nu_t S_{ij} S_{ij} - \\frac{2}{3} k \\delta_{ij} S_{ij}\n$$\n对于不可压缩流，平均应变率张量的迹为零：$S_{ii} = \\frac{\\partial U_i}{\\partial x_i} = 0$。由于 $\\delta_{ij} S_{ij} = S_{ii}$，第二项消失。这得到了模化的产生项：\n$$\nP_k = 2 \\nu_t S_{ij} S_{ij}\n$$\n\n接下来，我们将模化的 TKE 方程在控制体积 $V$ 上积分：\n$$\n\\int_V \\frac{\\partial k}{\\partial t} \\, \\mathrm{d}V + \\int_V \\frac{\\partial (U_j k)}{\\partial x_j} \\, \\mathrm{d}V = \\int_V P_k \\, \\mathrm{d}V - \\int_V \\varepsilon \\, \\mathrm{d}V + \\int_V \\frac{\\partial T_j}{\\partial x_j} \\, \\mathrm{d}V\n$$\n令 $\\mathcal{K} = \\int_V k \\, \\mathrm{d}V$。我们必须计算的项是 $\\frac{\\mathrm{d}\\mathcal{K}}{\\mathrm{d}t} = \\int_V \\frac{\\partial k}{\\partial t} \\, \\mathrm{d}V$。\n对对流项和输运项应用散度定理：\n$$\n\\frac{\\mathrm{d}\\mathcal{K}}{\\mathrm{d}t} + \\oint_A (U_j k) n_j \\, \\mathrm{d}A = \\int_V P_k \\, \\mathrm{d}V - \\int_V \\varepsilon \\, \\mathrm{d}V + \\oint_A T_j n_j \\, \\mathrm{d}A\n$$\n其中 $A$ 是控制体积的表面。在流向 ($x$) 和展向 ($z$) 的周期性边界上的面积分相互抵消。在不可渗透的壁面（$y=0$ 和 $y=H$）处，法向速度 $U_y$ 为零。因此，对流项的面积分 $\\oint (U_j k) n_j \\, \\mathrm{d}A$ 为零。输运项的剩余面积分为：\n$$\n\\oint_A T_j n_j \\, \\mathrm{d}A = \\int_{0}^{L_z}\\int_{0}^{L_x} [T_y|_{y=H} - T_y|_{y=0}] \\, \\mathrm{d}x\\mathrm{d}z = L_x L_z [T_y(H) - T_y(0)]\n$$\n积分的 TKE 收支方程为：\n$$\n\\frac{\\mathrm{d}\\mathcal{K}}{\\mathrm{d}t} = \\underbrace{\\int_V P_k \\, \\mathrm{d}V}_{\\mathcal{P}} - \\underbrace{\\int_V \\varepsilon \\, \\mathrm{d}V}_{\\mathcal{E}} + \\underbrace{L_x L_z [T_y(H) - T_y(0)]}_{\\mathcal{T}}\n$$\n我们现在计算右侧的每一项。\n控制体积为 $V = L_x L_z H = (1)(0.5)(0.1) = 0.05\\,\\mathrm{m^3}$。\n\n1.  **积分产生项, $\\mathcal{P}$**：\n    平均流是简单剪切流，$\\frac{\\partial U_x}{\\partial y} = S = 100\\,\\mathrm{s^{-1}}$，所有其他平均速度梯度均为零。\n    应变率张量的分量为 $S_{12} = S_{21} = \\frac{1}{2}S$，所有其他分量均为零。\n    因此，$S_{ij} S_{ij} = S_{12}^2 + S_{21}^2 = (\\frac{S}{2})^2 + (\\frac{S}{2})^2 = \\frac{S^2}{2}$。\n    产生率为 $P_k(y) = 2 \\nu_t(y) (\\frac{S^2}{2}) = \\nu_t(y) S^2$。\n    涡粘性系数由 ML 增强模型给出：$\\nu_t(y) = \\nu_{t,0} \\left( 1 + \\alpha \\frac{y}{H} \\right)$。\n    我们将 $P_k$ 在体积上积分：\n    $$\n    \\mathcal{P} = \\int_V \\nu_t(y) S^2 \\, \\mathrm{d}V = S^2 L_x L_z \\int_0^H \\nu_{t,0} \\left( 1 + \\alpha \\frac{y}{H} \\right) \\mathrm{d}y\n    $$\n    $$\n    \\mathcal{P} = S^2 L_x L_z \\nu_{t,0} \\left[ y + \\frac{\\alpha y^2}{2H} \\right]_0^H = S^2 L_x L_z \\nu_{t,0} \\left( H + \\frac{\\alpha H^2}{2H} \\right) = S^2 (L_x L_z H) \\nu_{t,0} \\left( 1 + \\frac{\\alpha}{2} \\right)\n    $$\n    代入给定值：$S=100\\,\\mathrm{s^{-1}}$，$V=0.05\\,\\mathrm{m^3}$，$\\nu_{t,0} = 5.0 \\times 10^{-4}\\,\\mathrm{m^{2}\\,s^{-1}}$，以及 $\\alpha=0.2$。\n    $$\n    \\mathcal{P} = (100^2)(0.05)(5.0 \\times 10^{-4}) \\left( 1 + \\frac{0.2}{2} \\right) = (10000)(0.05)(5.0 \\times 10^{-4})(1.1) = (500)(5.0 \\times 10^{-4})(1.1) = 0.25 \\times 1.1 = 0.275\\,\\mathrm{m^{5}\\,s^{-3}}\n    $$\n2.  **积分耗散项, $\\mathcal{E}$**：\n    耗散率 $\\varepsilon$ 是均匀的，为 $\\varepsilon = 4\\,\\mathrm{m^{2}\\,s^{-3}}$。\n    $$\n    \\mathcal{E} = \\int_V \\varepsilon \\, \\mathrm{d}V = \\varepsilon V = (4)(0.05) = 0.2\\,\\mathrm{m^{5}\\,s^{-3}}\n    $$\n3.  **净输运项, $\\mathcal{T}$**：\n    输运贡献来自通过壁面的净通量。我们需要计算 $T_y(H) - T_y(0)$。\n    通量为 $T_y(y) = - \\left( \\nu + \\frac{\\nu_t(y)}{\\sigma_k} \\right) \\frac{\\partial k}{\\partial y}$。TKE 梯度 $\\frac{\\partial k}{\\partial y}$ 是均匀的，为 $-10\\,\\mathrm{m\\,s^{-2}}$。\n    $$\n    T_y(y) = - \\left( \\nu + \\frac{\\nu_{t,0}}{\\sigma_k} \\left(1 + \\alpha \\frac{y}{H}\\right) \\right) \\frac{\\partial k}{\\partial y}\n    $$\n    差值为：\n    $$\n    T_y(H) - T_y(0) = - \\left( \\nu + \\frac{\\nu_{t,0}(1+\\alpha)}{\\sigma_k} \\right)\\frac{\\partial k}{\\partial y} - \\left[ - \\left( \\nu + \\frac{\\nu_{t,0}}{\\sigma_k} \\right)\\frac{\\partial k}{\\partial y} \\right]\n    $$\n    $$\n    T_y(H) - T_y(0) = \\left( -\\nu - \\frac{\\nu_{t,0}}{\\sigma_k} - \\frac{\\alpha \\nu_{t,0}}{\\sigma_k} + \\nu + \\frac{\\nu_{t,0}}{\\sigma_k} \\right) \\frac{\\partial k}{\\partial y} = - \\frac{\\alpha \\nu_{t,0}}{\\sigma_k} \\frac{\\partial k}{\\partial y}\n    $$\n    总输运项为 $\\mathcal{T} = L_x L_z [T_y(H) - T_y(0)] = L_x L_z \\left( - \\frac{\\alpha \\nu_{t,0}}{\\sigma_k} \\frac{\\partial k}{\\partial y} \\right)$。\n    代入数值：$L_x=1\\,\\mathrm{m}$，$L_z=0.5\\,\\mathrm{m}$，$\\alpha=0.2$，$\\nu_{t,0}=5.0 \\times 10^{-4}\\,\\mathrm{m^{2}\\,s^{-1}}$，$\\sigma_k=1.0$，以及 $\\frac{\\partial k}{\\partial y}=-10\\,\\mathrm{m\\,s^{-2}}$。\n    $$\n    \\mathcal{T} = (1)(0.5) \\left( - \\frac{(0.2)(5.0 \\times 10^{-4})}{1.0} \\right) (-10) = (0.5)(-1.0 \\times 10^{-4})(-10) = (0.5)(1.0 \\times 10^{-3}) = 0.0005\\,\\mathrm{m^{5}\\,s^{-3}}\n    $$\n最后，我们计算积分 TKE 的总变化率：\n$$\n\\frac{\\mathrm{d}\\mathcal{K}}{\\mathrm{d}t} = \\mathcal{P} - \\mathcal{E} + \\mathcal{T} = 0.275 - 0.2 + 0.0005 = 0.0755\\,\\mathrm{m^{5}\\,s^{-3}}\n$$\n问题要求将答案四舍五入到四位有效数字。\n$$\n\\frac{\\mathrm{d}\\mathcal{K}}{\\mathrm{d}t} = 0.07550\\,\\mathrm{m^{5}\\,s^{-3}}\n$$", "answer": "$$\n\\boxed{0.07550}\n$$", "id": "3342944"}, {"introduction": "在理解了物理影响之后，开发雷诺应力张量（$R_{ij}$）的机器学习闭包时，一个关键步骤是确保模型的预测在物理上是合理的。物理可实现性要求雷诺应力张量是半正定的，这是一个数学约束，反映了湍流法向应力不能为负值。本练习专注于实现一个“可实现性层”，它将模型的原始输出投影到物理有效张量的集合上。这项练习介绍了一种在先进模型中使用的关键技术，强制机器学习的输出尊重物理定律。您将在特征值空间中实现该投影，并量化其影响，包括对湍流产生等物理量造成的意外改变，从而学习在施加硬约束时所涉及的权衡 [@problem_id:3342977]。", "problem": "您的任务是为雷诺平均纳维-斯托克斯（RANS）建模中的机器学习（ML）增强湍流封闭模型设计并评估一个可实现性层。该可实现性层必须将预测的雷诺应力张量投影到半正定张量锥上，同时保持湍动能不变。评估必须量化该投影如何改变均匀剪切流中模拟的生成项，以及它如何影响相对于基准张量的准确性。\n\n出发点和基于第一性原理的定义：\n- 雷诺应力张量 $R_{ij}$ 定义为 $R_{ij} = \\overline{u_i' u_j'}$，是对称的，单位为 $\\mathrm{m^2/s^2}$。\n- 湍动能 $k$ 满足 $R_{ii} = 2k$；等价地，迹约束为 $\\mathrm{tr}(R) = 2k$。\n- 如果一个张量 $R$ 是半正定（PSD）的，即对于所有向量 $a$ 都有 $a_i R_{ij} a_j \\ge 0$，那么它就是可实现的。对于对称张量，这等价于其所有特征值均为非负。\n- 在平均速度场为 $U_1 = S y$，$U_2 = 0$，$U_3 = 0$ 的均匀平面剪切流中，其中 $S$ 是单位为 $\\mathrm{s^{-1}}$ 的恒定剪切率，单位质量的湍流生成项为 $P = -R_{ij} \\partial U_i/\\partial x_j = -R_{12} S$，单位为 $\\mathrm{m^2/s^3}$。\n\n设计任务：\n- 给定一个预测的对称 $3 \\times 3$ 张量 $R_{ij}^{\\mathrm{pred}}$（可能非半正定且 $\\mathrm{tr}(R^{\\mathrm{pred}}) \\ne 2k$），设计一个可实现性层，计算\n$$\nR^{\\mathrm{proj}} = \\underset{R}{\\arg\\min}\\ \\lVert R - R^{\\mathrm{pred}}\\rVert_F\n\\quad\\text{subject to}\\quad\nR = R^\\top,\\ R \\succeq 0,\\ \\mathrm{tr}(R)=2k,\n$$\n其中 $\\lVert \\cdot \\rVert_F$ 是弗罗贝尼乌斯范数，$R \\succeq 0$ 表示半正定。通过将问题简化为特征值空间中的欧几里得投影并重构 $R^{\\mathrm{proj}}$ 来实现此投影。\n\n评估任务：\n- 定义均匀平面剪切流的基准张量为\n$$\nR^{\\mathrm{true}} = \\begin{bmatrix}\n\\frac{2k}{3}  -c\\frac{2k}{3}  0 \\\\\n-c\\frac{2k}{3}  \\frac{2k}{3}  0 \\\\\n0  0  \\frac{2k}{3}\n\\end{bmatrix},\n$$\n其中 $c \\in [0,1]$ 是一个无量纲剪切应力系数。对于 $|R^{\\mathrm{true}}_{12}| \\le \\frac{2k}{3}$，该张量是对称且半正定的。\n- 对每个测试用例，计算以下量：\n  1. $P^{\\mathrm{pred}} = -R^{\\mathrm{pred}}_{12} S$，单位 $\\mathrm{m^2/s^3}$，\n  2. $P^{\\mathrm{proj}} = -R^{\\mathrm{proj}}_{12} S$，单位 $\\mathrm{m^2/s^3}$，\n  3. 投影引起的等效耗散 $\\Delta P = P^{\\mathrm{pred}} - P^{\\mathrm{proj}}$，单位 $\\mathrm{m^2/s^3}$，\n  4. 相对弗罗贝尼乌斯误差 $e_F = \\lVert R^{\\mathrm{proj}} - R^{\\mathrm{true}}\\rVert_F / \\lVert R^{\\mathrm{true}}\\rVert_F$（无量纲），\n  5. 相对剪切应力误差 $e_{12} = \\lvert R^{\\mathrm{proj}}_{12} - R^{\\mathrm{true}}_{12}\\rvert / \\lvert R^{\\mathrm{true}}_{12}\\rvert$（无量纲）。\n\n数值规格和单位要求：\n- 使用单位为 $\\mathrm{m^2/s^2}$ 的 $k$ 和单位为 $\\mathrm{s^{-1}}$ 的 $S$。将 $\\Delta P$ 表示为 $\\mathrm{m^2/s^3}$，四舍五入到六位小数。将 $e_F$ 和 $e_{12}$ 表示为小数，四舍五入到六位小数。此问题不涉及角度。不要使用百分号；所有比率必须是小数。\n\n测试套件：\n提供以下四个测试用例，每个用例由 $(k, S, c, R^{\\mathrm{pred}})$ 指定，其中 $R^{\\mathrm{pred}}$ 由其条目给出。程序在投影前必须首先通过 $(R^{\\mathrm{pred}} + (R^{\\mathrm{pred}})^\\top)/2$ 对 $R^{\\mathrm{pred}}$ 进行对称化。\n- 用例 1（理想情况，轻度非可实现性）：\n  - $k = 0.5$, $S = 10$, $c = 0.8$,\n  - $R^{\\mathrm{pred}} = \\begin{bmatrix} 0.30  -0.30  0.00 \\\\ -0.31  0.32  0.00 \\\\ 0.00  0.00  0.35 \\end{bmatrix}$。\n- 用例 2（边界情况，已可实现且迹正确）：\n  - $k = 0.3$, $S = 5$, $c = 0.5$,\n  - $R^{\\mathrm{pred}} = \\begin{bmatrix} 0.20  -0.10  0.00 \\\\ -0.10  0.20  0.00 \\\\ 0.00  0.00  0.20 \\end{bmatrix}$。\n- 用例 3（严重违例，含负法向应力和过大剪切应力）：\n  - $k = 0.8$, $S = 20$, $c = 0.9$,\n  - $R^{\\mathrm{pred}} = \\begin{bmatrix} 0.90  -0.70  0.20 \\\\ -0.70  -0.10  -0.10 \\\\ 0.20  -0.10  0.70 \\end{bmatrix}$。\n- 用例 4（边缘情况，零剪切率）：\n  - $k = 1.0$, $S = 0$, $c = 0.6$,\n  - $R^{\\mathrm{pred}} = \\begin{bmatrix} 1.80  -0.90  0.00 \\\\ -0.90  0.10  0.00 \\\\ 0.00  0.00  0.30 \\end{bmatrix}$。\n\n计算要求：\n- 将可实现性层实现为对称化 $R^{\\mathrm{pred}}$ 的特征值到非负单形 $\\{x \\in \\mathbb{R}^3: x_i \\ge 0,\\ \\sum_i x_i = 2k\\}$ 上的欧几里得投影，然后用相同的特征向量重构 $R^{\\mathrm{proj}}$。\n- 对每个测试用例，按照上述单位规格计算三元组 $(\\Delta P, e_F, e_{12})$。将每个值四舍五入到六位小数。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个逗号分隔的列表，用方括号括起来，结果按以下顺序排列：\n$[\\Delta P_1, e_{F,1}, e_{12,1}, \\Delta P_2, e_{F,2}, e_{12,2}, \\Delta P_3, e_{F,3}, e_{12,3}, \\Delta P_4, e_{F,4}, e_{12,4}]$,\n每个浮点数按规定四舍五入到六位小数。", "solution": "用户要求设计和评估一个用于雷诺平均纳维-斯托克斯（RANS）湍流模型的可实现性层。该问题的解决方法是，首先验证其科学和数学完整性，然后给出一个详细、有原则的解决方案。\n\n### 问题验证\n\n**第 1 步：提取的已知条件**\n- 雷诺应力张量：$R_{ij} = \\overline{u_i' u_j'}$，对称，单位为 $\\mathrm{m^2/s^2}$。\n- 迹约束：$\\mathrm{tr}(R) = R_{ii} = 2k$，其中 $k$ 是湍动能。\n- 可实现性约束：$R$ 必须是半正定的（$R \\succeq 0$），等价于具有非负特征值。\n- 流动配置：均匀平面剪切流，平均速度场为 $U_1 = S y$，$U_2 = 0$，$U_3 = 0$。\n- 湍流生成项：$P = -R_{12} S$，单位为 $\\mathrm{m^2/s^3}$。\n- 优化问题：在约束条件 $R = R^\\top$、$R \\succeq 0$ 和 $\\mathrm{tr}(R)=2k$ 下，求 $R^{\\mathrm{proj}} = \\underset{R}{\\arg\\min}\\ \\lVert R - R^{\\mathrm{pred}}\\rVert_F$。\n- 实现规格：投影将在对称化 $R^{\\mathrm{pred}}$ 的特征值空间中执行。\n- 基准张量：$R^{\\mathrm{true}} = \\begin{bmatrix} \\frac{2k}{3}  -c\\frac{2k}{3}  0 \\\\ -c\\frac{2k}{3}  \\frac{2k}{3}  0 \\\\ 0  0  \\frac{2k}{3} \\end{bmatrix}$，其中 $c \\in [0,1]$。\n- 评估指标：$P^{\\mathrm{pred}} = -R^{\\mathrm{pred}}_{12} S$，$P^{\\mathrm{proj}} = -R^{\\mathrm{proj}}_{12} S$，$\\Delta P = P^{\\mathrm{pred}} - P^{\\mathrm{proj}}$，$e_F = \\lVert R^{\\mathrm{proj}} - R^{\\mathrm{true}}\\rVert_F / \\lVert R^{\\mathrm{true}}\\rVert_F$，$e_{12} = \\lvert R^{\\mathrm{proj}}_{12} - R^{\\mathrm{true}}_{12}\\rvert / \\lvert R^{\\mathrm{true}}_{12}\\rvert$。\n- 预处理：$R^{\\mathrm{pred}}$ 必须首先通过 $(R^{\\mathrm{pred}} + (R^{\\mathrm{pred}})^\\top)/2$ 进行对称化。\n- 指定了四个测试用例，包含 $(k, S, c, R^{\\mathrm{pred}})$ 的数值。\n- 数值精度：$\\Delta P$、$e_F$ 和 $e_{12}$ 必须四舍五入到六位小数。\n\n**第 2 步：使用提取的已知条件进行验证**\n- **科学与事实的合理性**：该问题在连续介质力学和湍流理论的原理上有坚实的基础。雷诺应力张量、湍动能、生成项以及可实现性约束（$R \\succeq 0$，$\\mathrm{tr}(R)=2k$）的定义在计算流体力学中是标准的。数学表述是正确的。\n- **适定性**：该优化问题构成了一个在希尔伯特空间（具有弗罗贝尼乌斯内积的对称 $3 \\times 3$ 矩阵空间）中到一个非空、闭合、凸集上的投影。这保证了解 $R^{\\mathrm{proj}}$ 的存在性和唯一性。\n- **完整性与一致性**：该问题提供了所有必要的数据，包括物理参数、模型预测以及每个测试用例的基准张量的明确定义。约束条件是一致的，评估指标的定义是明确的。通过特征值投影的指定实现方法是解决此问题的标准且正确的方法。\n\n**第 3 步：结论与行动**\n- 问题是**有效的**。它在科学上合理，数学上适定，且内容完整。我们着手进行求解。\n\n### 基于原则的解决方案\n\n任务的核心是将一个给定的对称 $3 \\times 3$ 张量 $R^{\\mathrm{pred}}$ 投影到物理上可实现的雷诺应力张量空间上。一个可实现的张量必须是对称的、半正定的，并满足迹约束。\n\n**1. 对称化**\n我们的投影算子的定义域是对称矩阵空间。来自机器学习模型的初始输入，此处表示为 $R^{\\mathrm{raw}}$，可能由于数值伪影或模型结构而不是完全对称的。第一步是找到其最近的对称对应物，这通过将其与其转置矩阵取平均值来实现：\n$$\nR^{\\mathrm{pred}} = \\frac{1}{2} (R^{\\mathrm{raw}} + (R^{\\mathrm{raw}})^\\top)\n$$\n此操作将 $R^{\\mathrm{raw}}$ 投影到对称矩阵子空间上。\n\n**2. 到可实现锥上的投影**\n问题是找到满足以下条件的 $R^{\\mathrm{proj}}$：\n$$\n\\underset{R}{\\text{minimize}} \\quad \\frac{1}{2}\\lVert R - R^{\\mathrm{pred}}\\rVert_F^2 \\quad \\text{subject to} \\quad R = R^\\top, \\quad R \\succeq 0, \\quad \\mathrm{tr}(R)=2k\n$$\n这个约束优化问题可以通过变换到特征值空间来高效解决。由于 $R^{\\mathrm{pred}}$ 是对称的，它允许谱分解：\n$$\nR^{\\mathrm{pred}} = Q \\Lambda^{\\mathrm{pred}} Q^\\top\n$$\n其中 $Q$ 是一个正交矩阵，其列是 $R^{\\mathrm{pred}}$ 的特征向量，$\\Lambda^{\\mathrm{pred}} = \\mathrm{diag}(\\lambda_1^{\\mathrm{pred}}, \\lambda_2^{\\mathrm{pred}}, \\lambda_3^{\\mathrm{pred}})$ 是相应特征值的对角矩阵。\n\n弗罗贝尼乌斯范数是酉不变的，即对于任何正交矩阵 $U$，有 $\\lVert A \\rVert_F = \\lVert U A U^\\top \\rVert_F$。此性质使我们能够用特征值重写优化问题。我们寻求一个投影后的张量 $R$，它与 $R^{\\mathrm{pred}}$ 共享相同的特征向量，因此 $R = Q \\Lambda Q^\\top$。问题随后简化为寻找投影后特征值的对角矩阵 $\\Lambda = \\mathrm{diag}(\\lambda_1, \\lambda_2, \\lambda_3)$：\n$$\n\\underset{\\vec{\\lambda}}{\\text{minimize}} \\quad \\frac{1}{2}\\lVert \\vec{\\lambda} - \\vec{\\lambda}^{\\mathrm{pred}}\\rVert_2^2 \\quad \\text{subject to} \\quad \\lambda_i \\ge 0 \\;\\forall i, \\quad \\sum_{i=1}^3 \\lambda_i = 2k\n$$\n其中 $\\vec{\\lambda} = (\\lambda_1, \\lambda_2, \\lambda_3)$ 且 $\\vec{\\lambda}^{\\mathrm{pred}} = (\\lambda_1^{\\mathrm{pred}}, \\lambda_2^{\\mathrm{pred}}, \\lambda_3^{\\mathrm{pred}})$。这是将点 $\\vec{\\lambda}^{\\mathrm{pred}}$ 投影到按因子 $2k$ 缩放的概率单形上的标准欧几里得投影问题。\n\n**3. 到单形上的投影算法**\n存在一种高效的算法来完成此投影。对于一个向量 $y \\in \\mathbb{R}^n$ 和一个目标和 $s$，到集合 $\\{x \\in \\mathbb{R}^n | x_i \\ge 0, \\sum x_i = s\\}$ 上的投影 $x$ 由 $x_i = \\max(0, y_i - \\theta)$ 给出，其中 $\\theta$ 是一个常数偏移。这个偏移 $\\theta$ 的确定是为了满足约束条件。算法如下：\n1. 将向量 $\\vec{\\lambda}^{\\mathrm{pred}}$ 的分量按降序排序：$u_1 \\ge u_2 \\ge u_3$。\n2. 找到最大的整数 $\\rho \\in \\{1, 2, 3\\}$，使得 $u_\\rho - \\frac{1}{\\rho}(\\sum_{j=1}^\\rho u_j - 2k) > 0$。\n3. 计算阈值 $\\theta = \\frac{1}{\\rho}(\\sum_{j=1}^\\rho u_j - 2k)$。\n4. 投影后的特征值为 $\\lambda_i^{\\mathrm{proj}} = \\max(0, \\lambda_i^{\\mathrm{pred}} - \\theta)$。\n\n该算法有效地从较大的特征值中“削去”一个常数值，并将任何得到的负值截断为零，同时确保满足和约束 $\\sum \\lambda_i^{\\mathrm{proj}} = 2k$。\n\n**4. 重构与评估**\n在计算出投影后的特征值 $\\vec{\\lambda}^{\\mathrm{proj}}$ 后，最终的可实现张量 $R^{\\mathrm{proj}}$ 使用原始特征向量 $Q$ 进行重构：\n$$\nR^{\\mathrm{proj}} = Q \\, \\mathrm{diag}(\\vec{\\lambda}^{\\mathrm{proj}}) \\, Q^\\top\n$$\n有了 $R^{\\mathrm{proj}}$，就可以按规定计算评估指标：\n- 计算生成项 $P^{\\mathrm{pred}} = -R^{\\mathrm{pred}}_{12} S$ 和 $P^{\\mathrm{proj}} = -R^{\\mathrm{proj}}_{12} S$。\n- 确定投影引起的变化量 $\\Delta P = P^{\\mathrm{pred}} - P^{\\mathrm{proj}}$。\n- 根据给定的 $k$ 和 $c$ 构建基准张量 $R^{\\mathrm{true}}$。\n- 计算弗罗贝尼乌斯范数（$e_F$）和剪切应力分量（$e_{12}$）的相对误差，以量化投影后张量相对于基准张量的准确性。\n\n此过程将应用于提供的四个测试用例中的每一个。", "answer": "[0.050000,0.117851,0.018750,0.000000,0.000000,0.000000,12.753333,1.383329,1.751333,0.000000,1.201850,0.333333]", "id": "3342977"}, {"introduction": "机器学习闭包的最终目标通常是改进对系统级工程量（如升力或阻力）的预测，而不仅仅是局部流动统计量。这需要先进的训练策略，将模型参数与这些全局可观测量联系起来。本练习对比了两种关键的训练理念：一种是针对局部应力值的“局部”方法，另一种是使用伴随方法（adjoint method）的“全局”端到端方法。伴随方法提供了一种高效的方式来计算全局可观测量相对于模型中每个参数的梯度，即使它们通过复杂的计算流体力学（CFD）求解过程隐式关联。通过在一个代理问题上实现并比较局部训练策略与更复杂但更强大的基于伴随的策略，您将深入了解可微 CFD 的前沿，并理解机器学习增强求解器中不同训练范式之间的权衡 [@problem_id:3343024]。", "problem": "考虑一个在区间 $\\left[0,1\\right]$ 上、采用均匀网格和狄利克雷边界条件的一维稳态标量对流扩散方程，作为雷诺平均纳维-斯托克斯（Reynolds-averaged Navier–Stokes）封闭模型的代理模型。设内部网格点上的未知离散状态为向量 $\\mathbf{u}\\in\\mathbb{R}^{n}$，单元面上的有效扩散率建模为 $k\\left(\\theta,x\\right)=\\nu\\left(1+\\theta f\\left(x\\right)\\right)$，其中 $\\nu>0$ 是给定的分子粘度，$\\theta\\in\\mathbb{R}$ 是一个标量机器学习封闭参数，而 $f\\left(x\\right)$ 是一个给定的特征场。离散线性系统具有以下形式\n$$\n\\mathbf{A}\\left(\\theta\\right)\\mathbf{u}=\\mathbf{b}\\left(\\theta\\right),\n$$\n该系统通过对扩散项使用二阶中心差分和对正对流速度使用一阶迎风格式得到。假设对流速度为正常数 $a>0$。左、右边界值分别为 $u_{L}$ 和 $u_{R}$。我们关注的可观测量是一个阻力代理，定义为左壁的剪切应力，\n$$\nJ\\left(\\theta,\\mathbf{u}\\right)=k_{1/2}\\left(\\theta\\right)\\,\\frac{u_{1}-u_{L}}{\\Delta x},\n$$\n其中 $u_{1}$ 是第一个内部节点的值，$k_{1/2}\\left(\\theta\\right)$ 是最左侧面上的扩散率。该可观测量 $J^{\\star}$ 的目标值，是由同一模型在隐藏的真实基准参数 $\\theta^{\\star}$ 下，使用相同的离散化和参数计算生成的。\n\n您的任务是实现并比较两种训练策略来估计 $\\theta$：\n- 策略 A（全局，基于伴随）：最小化标量损失\n$$\n\\mathcal{L}_{J}\\left(\\theta\\right)=\\tfrac{1}{2}\\left(J\\left(\\theta,\\mathbf{u}\\left(\\theta\\right)\\right)-J^{\\star}\\right)^{2},\n$$\n并使用线性化系统的离散伴随方法计算其关于 $\\theta$ 的梯度。对于一个可微的线性系统 $\\mathbf{A}\\left(\\theta\\right)\\mathbf{u}\\left(\\theta\\right)=\\mathbf{b}\\left(\\theta\\right)$ 和可观测量 $J\\left(\\theta,\\mathbf{u}\\right)$，其全导数满足\n$$\n\\frac{\\mathrm{d}J}{\\mathrm{d}\\theta}=\\frac{\\partial J}{\\partial \\theta}+\\boldsymbol{\\lambda}^{\\top}\\left(\\frac{\\partial \\mathbf{b}}{\\partial \\theta}-\\frac{\\partial \\mathbf{A}}{\\partial \\theta}\\,\\mathbf{u}\\right),\n$$\n其中伴随变量 $\\boldsymbol{\\lambda}\\in\\mathbb{R}^{n}$ 求解伴随线性系统\n$$\n\\mathbf{A}\\left(\\theta\\right)^{\\top}\\boldsymbol{\\lambda}=\\frac{\\partial J}{\\partial \\mathbf{u}}.\n$$\n使用梯度下降法进行更新 $\\theta\\leftarrow\\theta-\\eta_{J}\\,\\frac{\\mathrm{d}\\mathcal{L}_{J}}{\\mathrm{d}\\theta}$，其中学习率为指定的 $\\eta_{J}$。\n\n- 策略 B（局部，应力目标）：根据真实基准状态定义每个面上的真实剪切应力为 $\\tau_{f}^{\\star}=k_{f}\\left(\\theta^{\\star}\\right)\\,g_{f}^{\\star}$，其中 $g_{f}^{\\star}$ 是根据 $\\mathbf{u}\\left(\\theta^{\\star}\\right)$ 和边界值计算出的真实面梯度。对于一个候选的 $\\theta$，将预测应力定义为 $\\tau_{f}\\left(\\theta\\right)=k_{f}\\left(\\theta\\right)\\,g_{f}^{\\star}$，并最小化局部二次损失\n$$\n\\mathcal{L}_{S}\\left(\\theta\\right)=\\tfrac{1}{2}\\sum_{f} \\left(\\tau_{f}\\left(\\theta\\right)-\\tau_{f}^{\\star}\\right)^{2}.\n$$\n使用精确的局部梯度 $\\frac{\\mathrm{d}\\mathcal{L}_{S}}{\\mathrm{d}\\theta}$ 和梯度下降法进行更新 $\\theta\\leftarrow\\theta-\\eta_{S}\\,\\frac{\\mathrm{d}\\mathcal{L}_{S}}{\\mathrm{d}\\theta}$，其中学习率为指定的 $\\eta_{S}$。\n\n您的程序必须：\n- 在一个包含 $N_{x}$ 个总节点的均匀网格上组装 $\\mathbf{A}\\left(\\theta\\right)$ 和 $\\mathbf{b}\\left(\\theta\\right)$，其中内部维度为 $n=N_{x}-2$。设网格间距为 $\\Delta x=\\frac{1}{N_{x}-1}$，并强制 $u\\left(0\\right)=u_{L}$ 和 $u\\left(1\\right)=u_{R}$。对流项使用 $a>0$ 的迎风格式。扩散算子由面扩散率 $k_{i+1/2}\\left(\\theta\\right)=\\nu\\left(1+\\theta f_{i+1/2}\\right)$ 构建，对流算子使用迎风模板 $(a/\\Delta x)\\left(u_{i}-u_{i-1}\\right)$。\n- 在面上定义 $f\\left(x\\right)=\\alpha\\sin\\left(2\\pi x\\right)+\\beta\\cos\\left(4\\pi x\\right)$，其中 $x$ 在面中心取值，常数 $\\alpha$ 和 $\\beta$ 的选择应确保在测试套件的所有迭代中，对所有面都有 $1+\\theta f\\left(x\\right)>0$；使用 $\\alpha=0.5$ 和 $\\beta=0.25$。\n- 使用 $u_{L}=1$ 和 $u_{R}=0$。\n- 从 $\\theta_{0}=0$ 开始，为两种训练策略实现固定迭代次数 $K$ 的梯度下降。\n- 报告收敛性和稳定性指标，定义如下：\n  - 收敛性：一个布尔值，如果 $\\left|\\theta_{K}-\\theta^{\\star}\\right|<\\varepsilon$ 则为真，容差为 $\\varepsilon=10^{-3}$。\n  - 稳定性：一个布尔值，如果相应的损失序列在数值容差 $\\delta=10^{-12}$ 内单调非增，即对于所有迭代 $t\\in\\{1,\\dots,K\\}$ 都有 $\\mathcal{L}_{t}-\\mathcal{L}_{t-1}\\leq \\delta$，则为真。\n\n从第一性原理出发设计算法，从离散守恒定律和用于伴随推导的微积分链式法则开始。通过在所有运行中保持 $1+\\theta f\\left(x\\right)>0$ 来确保科学合理性。\n\n测试套件：\n使用以下四组参数，每组定义一个测试用例。所有用例均使用 $\\theta^{\\star}=0.8$、$\\nu=0.05$、$u_{L}=1$、$u_{R}=0$、$\\alpha=0.5$、$\\beta=0.25$ 和 $K=60$。\n- 用例 1：$N_{x}=33$, $a=1.0$, $\\eta_{J}=0.1$, $\\eta_{S}=0.5$。\n- 用例 2：$N_{x}=65$, $a=5.0$, $\\eta_{J}=0.05$, $\\eta_{S}=0.3$。\n- 用例 3：$N_{x}=33$, $a=1.0$, $\\eta_{J}=1.2$, $\\eta_{S}=0.5$。\n- 用例 4：$N_{x}=33$, $a=1.0$, $\\eta_{J}=0.005$, $\\eta_{S}=1.0$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个结果列表，每个测试用例一个结果，其中每个测试用例的结果本身就是一个列表\n$$\n\\left[\\theta_{J,\\mathrm{final}},\\ \\theta_{S,\\mathrm{final}},\\ \\mathcal{L}_{J,\\mathrm{final}},\\ \\mathcal{L}_{S,\\mathrm{final}},\\ c_{J},\\ s_{J},\\ c_{S},\\ s_{S}\\right],\n$$\n其中 $\\theta_{J,\\mathrm{final}}$ 和 $\\theta_{S,\\mathrm{final}}$ 是全局和局部策略的最终参数，$\\mathcal{L}_{J,\\mathrm{final}}$ 和 $\\mathcal{L}_{S,\\mathrm{final}}$ 是最终损失，而 $c_{\\cdot}$ 和 $s_{\\cdot}$ 分别是表示收敛性和稳定性的布尔值。最终打印的行必须是一个包含四个用例列表的单一列表，格式为用方括号括起来的逗号分隔列表（例如，$\\left[\\left[\\cdot\\right],\\left[\\cdot\\right],\\left[\\cdot\\right],\\left[\\cdot\\right]\\right]$）。所有量都是无量纲的，因此不需要物理单位。角度（如果有的话）必须以弧度为单位，但此问题中没有出现角度。", "solution": "用户希望我扮演一名 STEM 教授，解决一个与机器学习增强湍流封闭模型相关的问题。\n\n该问题要求我针对一维稳态对流扩散方程中的标量参数 `theta`，实现并比较两种不同的训练策略。\n\n首先，我必须仔细验证问题陈述。\n\n## 问题验证\n\n### 步骤 1：提取已知条件\n\n- **方程**：在 $[0, 1]$ 上均匀网格的一维稳态标量对流扩散方程。\n- **未知量**：内部网格点上的离散状态向量 $\\mathbf{u} \\in \\mathbb{R}^n$。\n- **有效扩散率模型**：$k(\\theta, x) = \\nu(1 + \\theta f(x))$，其中：\n    - $\\nu > 0$ 是分子粘度。\n    - $\\theta \\in \\mathbb{R}$ 是标量机器学习封闭参数。\n    - $f(x)$ 是给定的特征场。\n- **离散线性系统**：$\\mathbf{A}(\\theta)\\mathbf{u} = \\mathbf{b}(\\theta)$。\n- **离散化**：\n    - 扩散项采用二阶中心差分。\n    - 正对流速度 $a > 0$ 采用一阶迎风格式。\n- **边界条件**：狄利克雷边界条件，$u(0) = u_L$, $u(1) = u_R$。\n- **可观测量**：阻力代理（左壁剪切应力），$J(\\theta, \\mathbf{u}) = k_{1/2}(\\theta) \\frac{u_1 - u_L}{\\Delta x}$。\n    - $u_1$ 是第一个内部节点的值。\n    - $k_{1/2}(\\theta)$ 是最左侧面上的扩散率。\n- **目标值**：$J^\\star$ 由同一模型在隐藏的真实基准参数 $\\theta^\\star$ 下生成。\n- **任务**：实现并比较两种训练策略来估计 $\\theta$。\n\n**策略 A（全局，基于伴随）**：\n- **损失函数**：$\\mathcal{L}_J(\\theta) = \\frac{1}{2}(J(\\theta, \\mathbf{u}(\\theta)) - J^\\star)^2$。\n- **梯度计算**：使用离散伴随方法。\n    - 全导数：$\\frac{\\mathrm{d}J}{\\mathrm{d}\\theta} = \\frac{\\partial J}{\\partial \\theta} + \\boldsymbol{\\lambda}^{\\top} (\\frac{\\partial \\mathbf{b}}{\\partial \\theta} - \\frac{\\partial \\mathbf{A}}{\\partial \\theta} \\mathbf{u})$。\n    - 伴随系统：$\\mathbf{A}(\\theta)^{\\top}\\boldsymbol{\\lambda} = \\frac{\\partial J}{\\partial \\mathbf{u}}$。\n- **更新规则**：梯度下降，$\\theta \\leftarrow \\theta - \\eta_J \\frac{\\mathrm{d}\\mathcal{L}_J}{\\mathrm{d}\\theta}$。\n\n**策略 B（局部，应力目标）**：\n- **真实剪切应力**：$\\tau_{f}^{\\star} = k_{f}(\\theta^{\\star}) g_{f}^{\\star}$，其中 $g_f^\\star$ 是来自 $\\mathbf{u}(\\theta^\\star)$ 的真实面梯度。\n- **预测应力**：$\\tau_f(\\theta) = k_f(\\theta) g_f^\\star$。\n- **损失函数**：$\\mathcal{L}_S(\\theta) = \\frac{1}{2} \\sum_{f} (\\tau_f(\\theta) - \\tau_f^\\star)^2$。\n- **梯度计算**：精确的局部梯度 $\\frac{\\mathrm{d}\\mathcal{L}_S}{\\mathrm{d}\\theta}$。\n- **更新规则**：梯度下降，$\\theta \\leftarrow \\theta - \\eta_S \\frac{\\mathrm{d}\\mathcal{L}_S}{\\mathrm{d}\\theta}$。\n\n**实现细节**：\n- **网格**：$N_x$ 个总节点的均匀网格。\n- **内部维度**：$n = N_x - 2$。\n- **网格间距**：$\\Delta x = \\frac{1}{N_x - 1}$。\n- **边界条件**：$u(0)=u_L$, $u(1)=u_R$。\n- **对流算子模板**：$(a/\\Delta x)(u_i - u_{i-1})$。\n- **扩散算子**：由面扩散率 $k_{i+1/2}(\\theta) = \\nu(1 + \\theta f_{i+1/2})$ 构建。\n- **特征场**：$f(x) = \\alpha \\sin(2\\pi x) + \\beta \\cos(4\\pi x)$ 在面中心取值。\n- **常数**：$\\alpha=0.5, \\beta=0.25$。\n- **正定性约束**：确保 $1 + \\theta f(x) > 0$。\n- **边界值**：$u_L=1, u_R=0$。\n- **初始参数**：$\\theta_0 = 0$。\n- **迭代次数**：$K$。\n\n**指标**：\n- **收敛性**：$|\\theta_K - \\theta^\\star| < \\varepsilon$，其中 $\\varepsilon = 10^{-3}$。\n- **稳定性**：$\\mathcal{L}_t - \\mathcal{L}_{t-1} \\leq \\delta$，其中 $\\delta = 10^{-12}$，对于 $t \\in \\{1, ..., K\\}$。\n\n**测试套件**：\n- 公共参数：$\\theta^\\star = 0.8$, $\\nu = 0.05$, $u_L=1, u_R=0$, $\\alpha=0.5, \\beta=0.25$, $K=60$。\n- 用例 1：$N_x=33, a=1.0, \\eta_J=0.1, \\eta_S=0.5$。\n- 用例 2：$N_x=65, a=5.0, \\eta_J=0.05, \\eta_S=0.3$。\n- 用例 3：$N_x=33, a=1.0, \\eta_J=1.2, \\eta_S=0.5$。\n- 用例 4：$N_x=33, a=1.0, \\eta_J=0.005, \\eta_S=1.0$。\n\n**输出格式**：\n- 单行 `[[...], [...], [...], [...]]`。\n- 每个内部列表：`[\\theta_{J,final}, \\theta_{S,final}, \\mathcal{L}_{J,final}, \\mathcal{L}_{S,final}, c_J, s_J, c_S, s_S]`。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n1.  **科学基础**：该问题在计算流体力学领域有坚实的基础，特别是在数据驱动的湍流建模方面。它使用标准的1D对流扩散方程作为代理模型，这是开发和测试新方法的常见做法。所涉及的技术，如有限差分法、基于伴随的优化和物理启发的损失函数，都是成熟且科学有效的方法。\n2.  **适定性**：问题是适定的。对流项使用一阶迎风格式，扩散项使用中心差分格式，对于稳态问题，这通常会得到一个对角占优的矩阵 $\\mathbf{A}$，因此是非奇异的，确保了状态向量 $\\mathbf{u}$ 的唯一解。优化任务有明确定义的损失函数。问题指定了所有必要的参数和条件。\n3.  **客观性**：问题的所有方面都用精确的数学语言和客观的数值定义。没有主观或模棱两可的语言。\n4.  **科学或事实上的不健全性**：问题在事实上是健全的。指出了扩散率必须为正 ($k(\\theta, x) > 0$) 的物理约束。对于给定的特征场 $f(x) = 0.5 \\sin(2\\pi x) + 0.25 \\cos(4\\pi x)$，在 $[0,1]$ 上的最小值为 $-0.75$。正定性约束 $1 + \\theta f(x) > 0$ 要求对于正 $\\theta$ 有 $1 + \\theta(-0.75) > 0$，这意味着 $\\theta  4/3 \\approx 1.333$。测试用例使用 $\\theta^\\star=0.8$ 并从 $\\theta=0$ 开始训练，这完全在有效范围内。学习率的选择旨在测试一系列行为，包括潜在的不稳定性（例如 $\\eta_J=1.2$），这是数值方法研究的有效部分。\n5.  **非形式化或不相关**：问题是高度形式化的，并且与其所述主题直接相关。\n6.  **不完整或矛盾的设置**：设置是完整且自洽的。所有必需的常数、边界条件和离散化方案都已提供。\n7.  **不切实际或不可行**：问题是一个标准的数值实验，完全可行。\n8.  **不适定或结构不良**：问题结构清晰，提出了一个可解的数值任务。\n9.  **伪深刻、琐碎或同义反复**：问题不琐碎，需要仔细实现偏微分方程的数值方法、用于灵敏度分析的伴随方法以及优化循环。它代表了计算科学中一个概念上合理且具有教育意义的任务。\n10. **超出科学可验证性**：结果是可通过计算验证的。\n\n### 步骤 3：结论与行动\n问题是有效的。将提供完整的解决方案。\n\n### 基于原理的设计\n\n解决方案将通过系统地离散化控制偏微分方程，然后实现两种指定的优化策略来开发。\n\n**1. 控制方程的离散化**\n\n一维稳态对流扩散方程为：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}x} \\left( a u(x) - k(\\theta,x) \\frac{\\mathrm{d}u}{\\mathrm{d}x} \\right) = 0\n$$\n我们在一个均匀网格上离散化此方程，网格有 $N_x$ 个节点 $x_i = i \\Delta x$，$i=0, \\dots, N_x-1$，其中 $\\Delta x = 1/(N_x-1)$。未知数是 $n=N_x-2$ 个内部节点上的值 $u_i$，$i=1, \\dots, n$。边界值是固定的：$u_0=u_L$ 和 $u_{N_x-1}=u_R$。\n\n问题指定了一种类有限体积的离散化方法。内部节点 $i$ 的离散方程是根据单元面 $x_{i-1/2}$ 和 $x_{i+1/2}$ 处的对流通量和扩散通量来建立的。节点 $i$ 的残差是：\n$$\nR_i = \\left( a u_i - a u_{i-1} \\right) \\frac{1}{\\Delta x} - \\frac{1}{\\Delta x}\\left( k_{i+1/2} \\frac{u_{i+1}-u_i}{\\Delta x} - k_{i-1/2} \\frac{u_i-u_{i-1}}{\\Delta x} \\right) = 0\n$$\n其中 $k_{i+1/2} = k(\\theta, x_{i+1/2})$。乘以 $\\Delta x^2$ 并重新整理关于 $u_{i-1}$, $u_i$, 和 $u_{i+1}$ 的项，得到第 $i$ 行的线性方程：\n$$\n(-a\\Delta x - k_{i-1/2}) u_{i-1} + (a\\Delta x + k_{i+1/2} + k_{i-1/2}) u_i - k_{i+1/2} u_{i+1} = 0\n$$\n此方程适用于内部节点 $i=1, \\dots, n$。对于 $i=1$，$u_0=u_L$ 是已知的，移到右侧。对于 $i=n$，$u_{n+1}=u_{N_x-1}=u_R$ 是已知的，移到右侧。这定义了三对角系统 $\\mathbf{A}(\\theta)\\mathbf{u} = \\mathbf{b}(\\theta)$。\n\n**2. 策略 A：全局伴随优化**\n\n该策略最小化损失 $\\mathcal{L}_{J}(\\theta) = \\frac{1}{2}(J(\\theta) - J^{\\star})^2$，其中 $J(\\theta) = J(\\theta, \\mathbf{u}(\\theta))$ 是预测的壁面剪切应力。损失的梯度为 $\\frac{\\mathrm{d}\\mathcal{L}_{J}}{\\mathrm{d}\\theta} = (J-J^\\star)\\frac{\\mathrm{d}J}{\\mathrm{d}\\theta}$。\n\n此方法的核心是计算全导数 $\\frac{\\mathrm{d}J}{\\mathrm{d}\\theta}$，它考虑了状态 $\\mathbf{u}$ 对参数 $\\theta$ 的依赖性。对由线性系统 $\\mathbf{A}\\mathbf{u}=\\mathbf{b}$ 定义的隐函数使用链式法则得到：\n$$\n\\frac{\\mathrm{d}J}{\\mathrm{d}\\theta} = \\frac{\\partial J}{\\partial \\theta} + \\left(\\frac{\\partial J}{\\partial \\mathbf{u}}\\right)^{\\top} \\frac{\\mathrm{d}\\mathbf{u}}{\\mathrm{d}\\theta}\n$$\n从 $\\mathbf{A}\\mathbf{u}=\\mathbf{b}$ 对 $\\theta$ 求导，以找到 $\\frac{\\mathrm{d}\\mathbf{u}}{\\mathrm{d}\\theta}$：\n$$\n\\frac{\\partial \\mathbf{A}}{\\partial \\theta}\\mathbf{u} + \\mathbf{A}\\frac{\\mathrm{d}\\mathbf{u}}{\\mathrm{d}\\theta} = \\frac{\\partial \\mathbf{b}}{\\partial \\theta} \\implies \\frac{\\mathrm{d}\\mathbf{u}}{\\mathrm{d}\\theta} = \\mathbf{A}^{-1}\\left( \\frac{\\partial \\mathbf{b}}{\\partial \\theta} - \\frac{\\partial \\mathbf{A}}{\\partial \\theta}\\mathbf{u} \\right)\n$$\n将其代入 $\\frac{\\mathrm{d}J}{\\mathrm{d}\\theta}$ 的表达式中：\n$$\n\\frac{\\mathrm{d}J}{\\mathrm{d}\\theta} = \\frac{\\partial J}{\\partial \\theta} + \\left(\\frac{\\partial J}{\\partial \\mathbf{u}}\\right)^{\\top} \\mathbf{A}^{-1}\\left( \\frac{\\partial \\mathbf{b}}{\\partial \\theta} - \\frac{\\partial \\mathbf{A}}{\\partial \\theta}\\mathbf{u} \\right)\n$$\n为避免计算成本高昂的矩阵求逆 $\\mathbf{A}^{-1}$，我们引入伴随向量 $\\boldsymbol{\\lambda}$，定义为 $\\mathbf{A}^{\\top}\\boldsymbol{\\lambda} = (\\frac{\\partial J}{\\partial \\mathbf{u}})$ 的解。这使我们能够写出：\n$$\n\\left(\\frac{\\partial J}{\\partial \\mathbf{u}}\\right)^{\\top} \\mathbf{A}^{-1} = (\\mathbf{A}^{-\\top} \\frac{\\partial J}{\\partial \\mathbf{u}})^{\\top} = \\boldsymbol{\\lambda}^{\\top}\n$$\n这导出了问题陈述中提供的用于高效计算全导数的公式：\n$$\n\\frac{\\mathrm{d}J}{\\mathrm{d}\\theta}=\\frac{\\partial J}{\\partial \\theta}+\\boldsymbol{\\lambda}^{\\top}\\left(\\frac{\\partial \\mathbf{b}}{\\partial \\theta}-\\frac{\\partial \\mathbf{A}}{\\partial \\theta}\\,\\mathbf{u}\\right)\n$$\n训练算法包括：(i) 求解原始系统得到 $\\mathbf{u}$，(ii) 求解伴随系统得到 $\\boldsymbol{\\lambda}$，(iii) 计算所有必要的偏导数，(iv) 组装总梯度，以及 (v) 通过梯度下降更新 $\\theta$。\n\n**3. 策略 B：局部应力目标优化**\n\n该策略基于局部量，即每个单元面 $f$ 处的剪切应力 $\\tau_f = k_f g_f$，来最小化一个损失函数。“真实”梯度 $g_f^\\star$ 从真实基准状态 $\\mathbf{u}(\\theta^\\star)$ 计算得出，然后保持不变。模型预测的应力为 $\\tau_f(\\theta) = k_f(\\theta) g_f^\\star$。损失为：\n$$\n\\mathcal{L}_{S}(\\theta) = \\frac{1}{2} \\sum_{f} (\\tau_f(\\theta) - \\tau_f^\\star)^2\n$$\n关于 $\\theta$ 的梯度可以简单地使用链式法则计算：\n$$\n\\frac{\\mathrm{d}\\mathcal{L}_{S}}{\\mathrm{d}\\theta} = \\sum_{f} (\\tau_f(\\theta) - \\tau_f^\\star) \\frac{\\partial \\tau_f(\\theta)}{\\partial \\theta}\n$$\n由于 $\\tau_f(\\theta) = \\nu(1+\\theta f_f) g_f^\\star$，其导数为 $\\frac{\\partial \\tau_f(\\theta)}{\\partial \\theta} = \\nu f_f g_f^\\star$。这种训练策略是“局部的”，因为梯度计算在每次迭代中不需要求解全局线性系统（无论是原始系统还是伴随系统）。它只需要真实基准梯度 $g_f^\\star$ 作为输入数据。因此，每个训练步骤的计算成本远低于策略 A。\n\n实现将遵循这些原则，并仔细注意矩阵构建和索引管理。", "answer": "[[0.7999881387693951, 0.799985338169106, 1.2298132912301913e-13, 2.515250106208577e-12, True, True, True, True],[0.8000000001009132, 0.8000000000371449, 6.007629631317371e-20, 1.2185521876599723e-18, True, True, True, True],[1.328766107470659, 0.799985338169106, 0.003774880561502052, 2.515250106208577e-12, False, False, True, True],[0.3804828114674719, 0.8000011532415714, 0.00021996765793444073, 2.046835338804983e-12, False, True, True, True]]", "id": "3343024"}]}