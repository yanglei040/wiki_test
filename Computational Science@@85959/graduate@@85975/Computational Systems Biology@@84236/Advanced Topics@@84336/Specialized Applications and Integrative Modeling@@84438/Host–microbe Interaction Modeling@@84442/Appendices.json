{"hands_on_practices": [{"introduction": "Understanding how microbes compete for limited resources is central to predicting the composition of host-associated microbial communities. The concept of the 'equilibrium resource requirement,' or $R^*$, provides a powerful framework for this, stating that the species capable of persisting at the lowest resource concentration will outcompete others. This practice [@problem_id:3319034] provides a foundational exercise in deriving and applying the $R^*$ rule from first principles using standard chemostat dynamics, allowing you to determine the outcome of competition between a pathogen and commensal bacteria.", "problem": "Consider a well-mixed mucosal niche in the host where a single limiting resource, denoted by $R$ in units of millimoles per liter $\\mathrm{mmol\\ L^{-1}}$, is supplied by the host at inflow concentration $S$ and washed out at a volumetric turnover rate $D$ in units of per hour $\\mathrm{h^{-1}}$. Three microbial populations use $R$: a pathogen $P$ and two commensals $C_{A}$ and $C_{B}$. Assume the following chemostat-style dynamics, consistent with mass balance and standard microbial physiology:\n- The resource dynamics are given by\n$$\n\\frac{dR}{dt} \\;=\\; D\\,(S - R) \\;-\\; \\sum_{i\\in\\{P,C_{A},C_{B}\\}} \\frac{1}{Y_{i}}\\,\\mu_{i}(R)\\,X_{i},\n$$\nwhere $X_{i}$ is the biomass concentration of species $i$ (in any consistent biomass unit), $Y_{i}$ is the biomass yield per unit resource (in biomass per $\\mathrm{mmol}$), and $\\mu_{i}(R)$ is the gross specific growth rate.\n- The population dynamics are given by\n$$\n\\frac{dX_{i}}{dt} \\;=\\; \\big(\\mu_{i}(R) - m_{i} - D\\big)\\,X_{i},\n$$\nwhere $m_{i}$ is a maintenance rate (in $\\mathrm{h^{-1}}$) that subtracts from the gross growth to yield the net growth available for dilution-balanced persistence.\n\nAssume Michaelis–Menten (Monod) growth kinetics for each species,\n$$\n\\mu_{i}(R) \\;=\\; \\mu_{\\max,i}\\,\\frac{R}{K_{i} + R},\n$$\nwhere $\\mu_{\\max,i}$ is the maximal specific growth rate (in $\\mathrm{h^{-1}}$) and $K_{i}$ is the half-saturation constant (in $\\mathrm{mmol\\ L^{-1}}$). The equilibrium resource requirement $R^{*}_{i}$ for species $i$ is defined as the steady-state resource concentration at which species $i$ can just persist alone in the chemostat (its net per-capita growth balances dilution), under the above dynamics.\n\nParameters for the host environment and the three species are:\n- Host supply concentration $S = 0.25$ $\\mathrm{mmol\\ L^{-1}}$; turnover $D = 0.20$ $\\mathrm{h^{-1}}$.\n- Pathogen $P$: $\\mu_{\\max,P} = 0.85$ $\\mathrm{h^{-1}}$, $K_{P} = 0.030$ $\\mathrm{mmol\\ L^{-1}}$, $m_{P} = 0.050$ $\\mathrm{h^{-1}}$, $Y_{P} = 0.45$ (biomass per $\\mathrm{mmol}$).\n- Commensal $C_{A}$: $\\mu_{\\max,C_{A}} = 0.65$ $\\mathrm{h^{-1}}$, $K_{C_{A}} = 0.015$ $\\mathrm{mmol\\ L^{-1}}$, $m_{C_{A}} = 0.020$ $\\mathrm{h^{-1}}$, $Y_{C_{A}} = 0.55$ (biomass per $\\mathrm{mmol}$).\n- Commensal $C_{B}$: $\\mu_{\\max,C_{B}} = 1.10$ $\\mathrm{h^{-1}}$, $K_{C_{B}} = 0.080$ $\\mathrm{mmol\\ L^{-1}}$, $m_{C_{B}} = 0.120$ $\\mathrm{h^{-1}}$, $Y_{C_{B}} = 0.40$ (biomass per $\\mathrm{mmol}$).\n\nTasks:\n1. Starting from the above dynamical definitions and the Monod law, derive a general closed-form expression for $R^{*}_{i}$ in terms of $(\\mu_{\\max,i}, K_{i}, m_{i}, D)$ for any single species $i$.\n2. Use the derived expression to compute $R^{*}_{P}$, $R^{*}_{C_{A}}$, and $R^{*}_{C_{B}}$ with the given parameters.\n3. Assume the host niche is initially dominated by $C_{A}$ alone at its single-species steady state. Using the dynamical definitions and your $R^{*}$ results, determine whether $P$ or $C_{B}$ can invade when introduced at infinitesimal density by evaluating the quantity\n$$\n\\Delta_{i\\mid C_{A}} \\;=\\; R_{\\mathrm{res}} - R^{*}_{i},\n$$\nwhere $R_{\\mathrm{res}}$ is the resource concentration in the resident state with $C_{A}$ alone. A positive $\\Delta_{i\\mid C_{A}}$ implies invasion is possible; a negative value implies invasion fails.\n\nAnswer format:\n- Report the five requested quantities in the ordered row matrix $\\big(R^{*}_{P}\\; R^{*}_{C_{A}}\\; R^{*}_{C_{B}}\\; \\Delta_{P\\mid C_{A}}\\; \\Delta_{C_{B}\\mid C_{A}}\\big)$.\n- Express each entry in $\\mathrm{mmol\\ L^{-1}}$.\n- Round each reported value to four significant figures.", "solution": "The problem is well-posed, scientifically grounded in standard ecological competition theory, and contains all necessary information for a unique solution. We can therefore proceed with the derivation and calculation.\n\n**1. Derivation of the equilibrium resource requirement, $R^{*}_{i}$**\n\nThe equilibrium resource requirement, $R^{*}_{i}$, is defined as the steady-state resource concentration at which a single species $i$ can just persist in the chemostat. This means its population biomass $X_{i}$ is non-zero and constant, i.e., at a non-trivial steady state. The condition for any steady state is that the population's rate of change is zero:\n$$\n\\frac{dX_{i}}{dt} \\;=\\; \\big(\\mu_{i}(R) - m_{i} - D\\big)\\,X_{i} \\;=\\; 0\n$$\nFor a non-trivial steady state ($X_i  0$), the term in the parenthesis must be zero. The resource concentration that satisfies this condition is, by definition, $R^{*}_{i}$:\n$$\n\\mu_{i}(R^{*}_{i}) - m_{i} - D \\;=\\; 0\n$$\nThis equation states that at the equilibrium resource level $R^{*}_{i}$, the gross specific growth rate must exactly balance the total loss rate due to maintenance ($m_i$) and washout ($D$).\nRearranging gives the required growth rate for persistence:\n$$\n\\mu_{i}(R^{*}_{i}) \\;=\\; m_{i} + D\n$$\nWe now substitute the given Michaelis–Menten (Monod) kinetics for the growth rate $\\mu_{i}(R)$:\n$$\n\\mu_{\\max,i}\\,\\frac{R^{*}_{i}}{K_{i} + R^{*}_{i}} \\;=\\; m_{i} + D\n$$\nTo find the closed-form expression for $R^{*}_{i}$, we solve this equation algebraically:\n$$\n\\mu_{\\max,i}\\,R^{*}_{i} \\;=\\; (m_{i} + D)(K_{i} + R^{*}_{i})\n$$\n$$\n\\mu_{\\max,i}\\,R^{*}_{i} \\;=\\; (m_{i} + D)K_{i} + (m_{i} + D)R^{*}_{i}\n$$\n$$\n\\mu_{\\max,i}\\,R^{*}_{i} - (m_{i} + D)R^{*}_{i} \\;=\\; (m_{i} + D)K_{i}\n$$\n$$\nR^{*}_{i}\\,\\big(\\mu_{\\max,i} - m_{i} - D\\big) \\;=\\; K_{i}\\,(m_{i} + D)\n$$\nFinally, isolating $R^{*}_{i}$ yields the general expression:\n$$\nR^{*}_{i} \\;=\\; K_{i}\\,\\frac{m_{i} + D}{\\mu_{\\max,i} - m_{i} - D}\n$$\nThis expression is valid provided that $\\mu_{\\max,i}  m_{i} + D$, which ensures that the species has a maximum potential growth rate sufficient to overcome its losses, leading to a physically meaningful positive value for $R^{*}_{i}$.\n\n**2. Calculation of $R^{*}_{P}$, $R^{*}_{C_{A}}$, and $R^{*}_{C_{B}}$**\n\nUsing the derived formula and the provided parameters, with the dilution rate $D = 0.20$ $\\mathrm{h^{-1}}$, we compute the equilibrium resource requirement for each species.\n\nFor the pathogen $P$:\n$m_{P} + D = 0.050 + 0.20 = 0.25$ $\\mathrm{h^{-1}}$\n$\\mu_{\\max,P} - m_{P} - D = 0.85 - 0.25 = 0.60$ $\\mathrm{h^{-1}}$\n$$\nR^{*}_{P} \\;=\\; K_{P}\\,\\frac{m_{P} + D}{\\mu_{\\max,P} - m_{P} - D} \\;=\\; (0.030\\,\\mathrm{mmol\\ L^{-1}})\\,\\frac{0.25}{0.60} \\;=\\; 0.0125\\,\\mathrm{mmol\\ L^{-1}}\n$$\n\nFor the commensal $C_{A}$:\n$m_{C_{A}} + D = 0.020 + 0.20 = 0.22$ $\\mathrm{h^{-1}}$\n$\\mu_{\\max,C_{A}} - m_{C_{A}} - D = 0.65 - 0.22 = 0.43$ $\\mathrm{h^{-1}}$\n$$\nR^{*}_{C_{A}} \\;=\\; K_{C_{A}}\\,\\frac{m_{C_{A}} + D}{\\mu_{\\max,C_{A}} - m_{C_{A}} - D} \\;=\\; (0.015\\,\\mathrm{mmol\\ L^{-1}})\\,\\frac{0.22}{0.43} \\;\\approx\\; 0.0076744\\,\\mathrm{mmol\\ L^{-1}}\n$$\n\nFor the commensal $C_{B}$:\n$m_{C_{B}} + D = 0.120 + 0.20 = 0.32$ $\\mathrm{h^{-1}}$\n$\\mu_{\\max,C_{B}} - m_{C_{B}} - D = 1.10 - 0.32 = 0.78$ $\\mathrm{h^{-1}}$\n$$\nR^{*}_{C_{B}} \\;=\\; K_{C_{B}}\\,\\frac{m_{C_{B}} + D}{\\mu_{\\max,C_{B}} - m_{C_{B}} - D} \\;=\\; (0.080\\,\\mathrm{mmol\\ L^{-1}})\\,\\frac{0.32}{0.78} \\;\\approx\\; 0.032821\\,\\mathrm{mmol\\ L^{-1}}\n$$\n\n**3. Invasion Analysis**\n\nThe problem posits a niche dominated by commensal $C_A$ at its single-species steady state. In this state, assuming the species is not washed out ($X_{C_A}  0$), the species will draw down the limiting resource concentration to its own equilibrium requirement. Therefore, the resident resource concentration is $R_{\\mathrm{res}} = R^{*}_{C_{A}}$. This is possible because $R^{*}_{C_{A}} \\approx 0.007674\\,\\mathrm{mmol\\ L^{-1}}$ is less than the supply concentration $S=0.25\\,\\mathrm{mmol\\ L^{-1}}$.\n\nAn invading species $i$ (here, $P$ or $C_B$) can successfully establish in this environment if its initial per-capita growth rate is positive. The growth rate for an invader at infinitesimal density is determined by the resource level set by the resident, $R_{\\mathrm{res}}$:\n$$\n\\frac{1}{X_i}\\frac{dX_{i}}{dt} \\;=\\; \\mu_{i}(R_{\\mathrm{res}}) - m_{i} - D\n$$\nThis growth rate is positive if and only if $\\mu_{i}(R_{\\mathrm{res}})  m_{i} + D$. Since $\\mu_i(R)$ is a monotonically increasing function of $R$, and by definition $\\mu_{i}(R^{*}_{i}) = m_{i} + D$, the condition for positive growth becomes $R_{\\mathrm{res}}  R^{*}_{i}$.\n\nThe problem defines the quantity $\\Delta_{i\\mid C_{A}} = R_{\\mathrm{res}} - R^{*}_{i}$. A positive value indicates successful invasion.\nUsing $R_{\\mathrm{res}} = R^{*}_{C_{A}}$, we calculate $\\Delta$ for the two potential invaders.\n\nFor the invasion of pathogen $P$:\n$$\n\\Delta_{P\\mid C_{A}} \\;=\\; R^{*}_{C_{A}} - R^{*}_{P} \\;\\approx\\; 0.0076744 - 0.0125 \\;=\\; -0.0048256\\,\\mathrm{mmol\\ L^{-1}}\n$$\nSince $\\Delta_{P\\mid C_{A}}  0$, the pathogen $P$ cannot invade the niche when occupied by $C_A$.\n\nFor the invasion of commensal $C_{B}$:\n$$\n\\Delta_{C_{B}\\mid C_{A}} \\;=\\; R^{*}_{C_{A}} - R^{*}_{C_{B}} \\;\\approx\\; 0.0076744 - 0.032821 \\;=\\; -0.0251466\\,\\mathrm{mmol\\ L^{-1}}\n$$\nSince $\\Delta_{C_{B}\\mid C_{A}}  0$, commensal $C_B$ also cannot invade.\n\nThis outcome is consistent with the R-star competition rule, which states that for a single limiting resource, the species with the lowest $R^*$ will be the superior competitor and exclude all others. Here, $R^{*}_{C_{A}}$ is the lowest of the three values.\n\nRounding the five requested quantities to four significant figures gives:\n$R^{*}_{P} \\to 0.01250$\n$R^{*}_{C_{A}} \\to 0.007674$\n$R^{*}_{C_{B}} \\to 0.03282$\n$\\Delta_{P\\mid C_{A}} \\to -0.004826$\n$\\Delta_{C_{B}\\mid C_{A}} \\to -0.02515$", "answer": "$$\n\\boxed{\\begin{pmatrix} 0.01250  0.007674  0.03282  -0.004826  -0.02515 \\end{pmatrix}}\n$$", "id": "3319034"}, {"introduction": "Beyond simple competition for a single resource, host-microbe interactions involve a complex metabolic network of exchanged nutrients and byproducts. Flux Balance Analysis (FBA) is a cornerstone method for analyzing these systems at a genome scale without requiring detailed kinetic data. This hands-on exercise [@problem_id:3319045] guides you through the process of constructing and solving a community FBA model from scratch, coupling the metabolic networks of a host and a microbe to explore their cooperative and competitive potential.", "problem": "You are asked to formalize and solve a community Flux Balance Analysis (FBA) model coupling a host and a microbe under steady-state mass balance. Flux Balance Analysis (FBA) models metabolic networks by asserting a steady-state mass balance for intracellular metabolites, encoded by a stoichiometric matrix and a flux vector, and optimizes a biologically meaningful linear objective subject to physicochemical flux bounds. In a host-microbe community FBA, the host and the microbe are represented by separate stoichiometric matrices and flux vectors, and are coupled through exchange fluxes representing inter-compartment metabolite transport.\n\nStart from the fundamental principles:\n- Steady-state mass balance for each compartment implies that intracellular metabolite concentrations are time-invariant under constant flux patterns. This is encoded as a homogeneous linear system for the fluxes. For a stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$ (where $m$ is the number of intracellular metabolites and $n$ is the number of reactions) and flux vector $v \\in \\mathbb{R}^{n}$, the mass balance is $S v = 0$.\n- Reaction fluxes are bounded due to enzyme capacity, thermodynamics, and transport limits. Each flux $v_i$ is constrained by lower and upper bounds $l_i \\le v_i \\le u_i$ in the physical units millimole per gram dry weight per hour (mmol gDW$^{-1}$ h$^{-1}$).\n- A community objective is a weighted sum of host and microbe objectives. With a host objective flux $v_{h,\\text{obj}}$ and a microbe objective flux $v_{m,\\text{obj}}$, and nonnegative weights $w_h, w_m$, the community objective is $w_h v_{h,\\text{obj}} + w_m v_{m,\\text{obj}}$.\n\nFormulate the optimization problem\n$$\n\\max_{v_h, v_m, v_e}\\quad w_h\\, v_{h,\\text{obj}} + w_m\\, v_{m,\\text{obj}}\n$$\nsubject to\n$$\nS_h v_h = 0,\\quad S_m v_m = 0,\n$$\nand exchange coupling constraints between host and microbe through exchange fluxes $v_e$, along with individual flux bounds. The exchange coupling must enforce that the host’s export flux of the exchanged metabolite equals the microbe’s import flux and also equals the exchange variable. Specifically, if $v_{h,\\text{exp}}$ is the host export reaction flux and $v_{m,\\text{imp}}$ is the microbe import reaction flux, impose\n$$\nv_e - v_{h,\\text{exp}} = 0,\\quad v_e - v_{m,\\text{imp}} = 0,\n$$\nwith $v_e$ bounded by $0 \\le v_e \\le E_{\\max}$ in mmol gDW$^{-1}$ h$^{-1}$.\n\nImplement this linear optimization as a single program that, given the following test suite of parameter values, computes the optimal objective value $w_h\\, v_{h,\\text{obj}} + w_m\\, v_{m,\\text{obj}}$ for each case. Report each optimal value in mmol gDW$^{-1}$ h$^{-1}$ as a float rounded to six decimal places.\n\nHost network definition:\n- Host metabolites: two intracellular species, labeled implicitly by rows.\n- Host reactions: $4$ reactions with stoichiometric matrix\n$$\nS_h = \\begin{bmatrix}\n1  -1  0  0\\\\\n0  1  -1  -1\n\\end{bmatrix},\n$$\nwhere the columns correspond to reactions in order: $R_{h,1}$ (uptake of $A$ from environment), $R_{h,2}$ (conversion $A_h \\to B_h$), $R_{h,3}$ (host biomass using $B_h$), $R_{h,4}$ (export of $B_h$ to microbe). The host objective is to maximize the host biomass flux, so the host objective selector is\n$$\nc_h = \\begin{bmatrix}0  0  1  0\\end{bmatrix}^\\top,\n$$\nwhich picks $R_{h,3}$.\n\nMicrobe network definition:\n- Microbe metabolites: two intracellular species, labeled implicitly by rows.\n- Microbe reactions: $3$ reactions with stoichiometric matrix\n$$\nS_m = \\begin{bmatrix}\n1  -1  0\\\\\n0  1  -1\n\\end{bmatrix},\n$$\nwhere the columns correspond to reactions in order: $R_{m,1}$ (import of $B$ from host), $R_{m,2}$ (conversion $B_m \\to C_m$), $R_{m,3}$ (microbe biomass using $C_m$). The microbe objective selector is\n$$\nc_m = \\begin{bmatrix}0  0  1\\end{bmatrix}^\\top,\n$$\nwhich picks $R_{m,3}$.\n\nExchange coupling:\n- Single exchange variable $v_e$ represents the net flux of $B$ from host to microbe. It is coupled to host export and microbe import by the equalities $v_e = v_{h,4}$ and $v_e = v_{m,1}$.\n- Bound for $v_e$: $0 \\le v_e \\le E_{\\max}$, where $E_{\\max}$ is specified per test case.\n\nFlux bounds, unless otherwise specified per test case:\n- Host reaction bounds (in order $R_{h,1}$, $R_{h,2}$, $R_{h,3}$, $R_{h,4}$): lower bounds $l_h = [0, 0, 0, 0]$ and upper bounds $u_h = [U_{\\text{in}}, 10, 10, 10]$, where $U_{\\text{in}}$ is the host uptake capacity for $R_{h,1}$ provided per test case in mmol gDW$^{-1}$ h$^{-1}$, and the other upper bounds are $10$ mmol gDW$^{-1}$ h$^{-1}$.\n- Microbe reaction bounds (in order $R_{m,1}$, $R_{m,2}$, $R_{m,3}$): lower bounds $l_m = [0, 0, 0]$ and upper bounds $u_m = [10, 10, 10]$ in mmol gDW$^{-1}$ h$^{-1}$.\n\nTest suite:\n- Case $1$: weights $w_h = 0.5$, $w_m = 0.5$; host uptake capacity $U_{\\text{in}} = 10$; exchange cap $E_{\\max} = 5$.\n- Case $2$: weights $w_h = 0.5$, $w_m = 0.5$; $U_{\\text{in}} = 10$; $E_{\\max} = 0$.\n- Case $3$: weights $w_h = 0$, $w_m = 1$; $U_{\\text{in}} = 10$; $E_{\\max} = 5$.\n- Case $4$: weights $w_h = 0.2$, $w_m = 0.8$; $U_{\\text{in}} = 3$; $E_{\\max} = 100$.\n\nYour program should set up the combined linear program for each case as follows. Let the full decision vector be $x = [v_h; v_m; v_e] \\in \\mathbb{R}^{8}$, with $v_h \\in \\mathbb{R}^{4}$, $v_m \\in \\mathbb{R}^{3}$, and $v_e \\in \\mathbb{R}^{1}$. Construct equality constraints\n$$\nA_{\\text{eq}} x = b_{\\text{eq}},\n$$\nby embedding $S_h v_h = 0$ and $S_m v_m = 0$ into $A_{\\text{eq}}$ with appropriate zero-padding, and adding two rows for $v_e - v_{h,4} = 0$ and $v_e - v_{m,1} = 0$. Bounds on $x$ are formed by concatenating the host bounds, microbe bounds, and the exchange bound $0 \\le v_e \\le E_{\\max}$. The objective vector for the maximization is\n$$\nc^\\top x = w_h c_h^\\top v_h + w_m c_m^\\top v_m + 0 \\cdot v_e,\n$$\nwhich you should implement as a minimization by negating $c$.\n\nRequired output format:\n- Compute the optimal objective value $w_h\\, v_{h,\\text{obj}} + w_m\\, v_{m,\\text{obj}}$ for each case, expressed in mmol gDW$^{-1}$ h$^{-1}$, rounded to six decimal places.\n- Produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example $[\\alpha_1,\\alpha_2,\\alpha_3,\\alpha_4]$, where each $\\alpha_i$ is the float for the corresponding case in the order listed above.", "solution": "The problem statement has been critically examined and is deemed valid. It presents a well-posed, scientifically grounded, and computationally tractable problem in community Flux Balance Analysis (FBA), a standard methodology in computational systems biology. All required data, parameters, and constraints are provided, allowing for a unique optimal objective value to be determined for each test case.\n\nThe task is to solve a linear programming (LP) problem that models the metabolic coupling between a host and a microbe. The objective is to maximize a weighted sum of their respective biomass fluxes under steady-state conditions. The problem is formulated as follows:\n$$\n\\max_{v_h, v_m, v_e}\\quad w_h\\, v_{h,\\text{obj}} + w_m\\, v_{m,\\text{obj}}\n$$\nsubject to a set of linear equality and inequality constraints. This maximization problem can be solved using standard LP solvers, which typically perform minimization. We can achieve this by minimizing the negative of the objective function:\n$$\n\\min_{v_h, v_m, v_e}\\quad -(w_h\\, v_{h,\\text{obj}} + w_m\\, v_{m,\\text{obj}})\n$$\nTo implement this, we first construct a single linear system representing the combined host-microbe community. The full vector of decision variables, $x$, is formed by concatenating the individual flux vectors:\n$$\nx = \\begin{bmatrix} v_h \\\\ v_m \\\\ v_e \\end{bmatrix} = [v_{h,1}, v_{h,2}, v_{h,3}, v_{h,4}, v_{m,1}, v_{m,2}, v_{m,3}, v_e]^\\top \\in \\mathbb{R}^8\n$$\nThe components of $x$ correspond to the $4$ host reaction fluxes ($v_h$), $3$ microbe reaction fluxes ($v_m$), and $1$ exchange flux ($v_e$).\n\nThe objective function to maximize is $Z = w_h v_{h,3} + w_m v_{m,3}$. In terms of the vector $x$, this is $c_{orig}^\\top x$ where $c_{orig} = [0, 0, w_h, 0, 0, 0, w_m, 0]^\\top$. For minimization, we use the objective vector $c = -c_{orig} = [0, 0, -w_h, 0, 0, 0, -w_m, 0]^\\top$.\n\nThe constraints are of two types: equality constraints and bounds. The equality constraints $A_{eq} x = b_{eq}$ enforce mass balance and coupling.\nThe steady-state mass balance conditions are $S_h v_h = 0$ for the host and $S_m v_m = 0$ for the microbe. These equations are embedded into the larger system.\nGiven $S_h = \\begin{bmatrix} 1  -1  0  0\\\\ 0  1  -1  -1 \\end{bmatrix}$ and $S_m = \\begin{bmatrix} 1  -1  0\\\\ 0  1  -1 \\end{bmatrix}$, these correspond to:\n$1 \\cdot v_{h,1} - 1 \\cdot v_{h,2} = 0$\n$1 \\cdot v_{h,2} - 1 \\cdot v_{h,3} - 1 \\cdot v_{h,4} = 0$\n$1 \\cdot v_{m,1} - 1 \\cdot v_{m,2} = 0$\n$1 \\cdot v_{m,2} - 1 \\cdot v_{m,3} = 0$\n\nThe exchange coupling constraints are $v_e = v_{h,4}$ and $v_e = v_{m,1}$. In the standard form for a linear solver, these are written as:\n$-v_{h,4} + v_e = 0$\n$-v_{m,1} + v_e = 0$\n\nCombining these $6$ equations gives the equality constraint matrix $A_{eq} \\in \\mathbb{R}^{6 \\times 8}$ and the vector $b_{eq} \\in \\mathbb{R}^{6}$. Since all equations are homogeneous, $b_{eq}$ is a zero vector.\n$$\nA_{eq} = \\begin{bmatrix}\n1  -1  0  0  0  0  0  0 \\\\\n0  1  -1  -1  0  0  0  0 \\\\\n0  0  0  0  1  -1  0  0 \\\\\n0  0  0  0  0  1  -1  0 \\\\\n0  0  0  -1  0  0  0  1 \\\\\n0  0  0  0  -1  0  0  1\n\\end{bmatrix}, \\quad\nb_{eq} = \\begin{bmatrix}\n0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0\n\\end{bmatrix}\n$$\nThe bounds for each flux variable $x_i$ are specified as $l_i \\le x_i \\le u_i$. These are assembled from the individual bounds on $v_h$, $v_m$, and $v_e$. For each test case, the bounds are:\n$v_{h,1} \\in [0, U_{\\text{in}}]$\n$v_{h,2} \\in [0, 10]$\n$v_{h,3} \\in [0, 10]$\n$v_{h,4} \\in [0, 10]$\n$v_{m,1} \\in [0, 10]$\n$v_{m,2} \\in [0, 10]$\n$v_{m,3} \\in [0, 10]$\n$v_e \\in [0, E_{\\max}]$\nThese form a list of (lower bound, upper bound) tuples for the solver.\n\nFor each test case, we substitute the given values for $w_h$, $w_m$, $U_{\\text{in}}$, and $E_{\\max}$ to define the specific LP instance. The problem is then solved using the `linprog` function from the `scipy.optimize` library. The returned optimal value from the minimization, `res.fun`, is negated to obtain the maximum value for the original objective function. This value is then rounded to six decimal places as required.", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a series of community Flux Balance Analysis problems.\n    Each problem is formulated as a linear program and solved using scipy.optimize.linprog.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each tuple contains: (w_h, w_m, U_in, E_max)\n    test_cases = [\n        (0.5, 0.5, 10, 5),\n        (0.5, 0.5, 10, 0),\n        (0.0, 1.0, 10, 5),\n        (0.2, 0.8, 3, 100),\n    ]\n\n    # The decision vector is x = [v_h1, v_h2, v_h3, v_h4, v_m1, v_m2, v_m3, v_e]\n    # It has 8 variables.\n    \n    # Construct the equality constraint matrix A_eq.\n    # This matrix is constant for all test cases.\n    # It has 6 constraints: 2 for S_h, 2 for S_m, 2 for coupling.\n    A_eq = np.zeros((6, 8))\n\n    # S_h * v_h = 0\n    # Equation 1: v_h1 - v_h2 = 0\n    A_eq[0, 0] = 1\n    A_eq[0, 1] = -1\n    # Equation 2: v_h2 - v_h3 - v_h4 = 0\n    A_eq[1, 1] = 1\n    A_eq[1, 2] = -1\n    A_eq[1, 3] = -1\n\n    # S_m * v_m = 0\n    # Equation 3: v_m1 - v_m2 = 0\n    A_eq[2, 4] = 1\n    A_eq[2, 5] = -1\n    # Equation 4: v_m2 - v_m3 = 0\n    A_eq[3, 5] = 1\n    A_eq[3, 6] = -1\n\n    # Coupling constraints\n    # Equation 5: v_e - v_h4 = 0 = -v_h4 + v_e = 0\n    A_eq[4, 3] = -1\n    A_eq[4, 7] = 1\n    # Equation 6: v_e - v_m1 = 0 = -v_m1 + v_e = 0\n    A_eq[5, 4] = -1\n    A_eq[5, 7] = 1\n    \n    # The right-hand side of the equality constraints is all zeros.\n    b_eq = np.zeros(6)\n\n    results = []\n    for case in test_cases:\n        w_h, w_m, U_in, E_max = case\n\n        # Objective function vector c for minimization.\n        # We want to maximize w_h*v_h3 + w_m*v_m3, which is equivalent to\n        # minimizing -w_h*v_h3 - w_m*v_m3.\n        # v_h3 is at index 2, v_m3 is at index 6.\n        c = np.zeros(8)\n        c[2] = -w_h\n        c[6] = -w_m\n\n        # Define bounds for each variable in the decision vector x.\n        bounds = [\n            (0, U_in),   # v_h1: bounds [0, U_in]\n            (0, 10),     # v_h2: bounds [0, 10]\n            (0, 10),     # v_h3: bounds [0, 10]\n            (0, 10),     # v_h4: bounds [0, 10]\n            (0, 10),     # v_m1: bounds [0, 10]\n            (0, 10),     # v_m2: bounds [0, 10]\n            (0, 10),     # v_m3: bounds [0, 10]\n            (0, E_max),  # v_e:  bounds [0, E_max]\n        ]\n\n        # Solve the linear program using the 'highs' method for robustness.\n        res = linprog(c, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n        \n        # The result 'res.fun' is the minimum value of the objective.\n        # We negate it to get the maximum value of the original problem.\n        optimal_value = -res.fun\n\n        # Append the formatted result.\n        results.append(f\"{optimal_value:.6f}\")\n\n    # Print the final results in the specified format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3319045"}, {"introduction": "The dynamics of host-microbe interactions are not static; they are shaped by the rapid evolution of microbial populations. For viruses, this is often described by the 'quasispecies' concept, where a cloud of mutants surrounds a high-fitness master genotype. This practice [@problem_id:3319085] delves into the core of this theory by tasking you with deriving the 'error threshold'—the critical mutation rate beyond which the master genotype is lost. This calculation illuminates the fundamental trade-off between replication speed and accuracy that governs viral persistence and diversification within a host.", "problem": "A virus replicating within a host forms a \"quasispecies\" centered on a high-fitness \"master\" genotype and a surrounding cloud of mutant genotypes. Consider a single-peak fitness landscape where the master genotype has replication fitness $W_0$ and all mutants (the cloud) have lower fitness $W_1$, with $W_0  W_1$. Let the viral genome length be $L$ nucleotides, and assume independent per-site mutations with per-site mutation probability $u$ per replication. Denote the per-site fidelity by $q = 1 - u$, so that the probability that a master genotype produces an error-free copy of itself over the entire genome is $q^L$. Assume the large-genome limit where back-mutation from the mutant cloud to the exact master genotype is negligible.\n\nUsing the replicator–mutator framework as a system of Ordinary Differential Equations (ODEs), derive from first principles the condition under which the master genotype persists in the population and obtain the closed-form expression for the critical per-site mutation probability $u_c$ (the \"error threshold\") as a function of $W_0$, $W_1$, and $L$. Then, evaluate $u_c$ for the parameter values $L = 10^4$, $W_0 = 1.3$, and $W_1 = 1.0$.\n\nExpress the final answer as the critical per-site mutation probability per replication (dimensionless), rounded to four significant figures.", "solution": "This problem is valid. It is scientifically grounded in the established theory of quasispecies and the error threshold, it is well-posed with all necessary information provided, and it is expressed objectively.\n\nThe problem asks for the derivation of the critical per-site mutation probability, $u_c$, for a viral quasispecies, based on a replicator-mutator model. We are given a two-class system: a master genotype with replication fitness $W_0$ and a cloud of mutant genotypes with a uniform lower fitness $W_1$.\n\nLet $x_0(t)$ be the frequency of the master genotype and $x_1(t)$ be the frequency of the mutant cloud in the population at time $t$. By definition, $x_0(t) + x_1(t) = 1$. The genome has length $L$, the per-site mutation probability is $u$, and the per-site fidelity is $q = 1 - u$. The probability that a master genotype replicates without any mutations is $Q = q^L = (1-u)^L$. Any replication with one or more mutations is assumed to produce a member of the mutant cloud. Back-mutation from the mutant cloud to the master genotype is considered negligible.\n\nThe dynamics of the number of individuals of the master genotype, $N_0$, and the mutant cloud, $N_1$, can be described by the following ordinary differential equations (ODEs):\n$$ \\frac{dN_0}{dt} = N_0 W_0 Q $$\n$$ \\frac{dN_1}{dt} = N_0 W_0 (1 - Q) + N_1 W_1 $$\nThe first equation states that the master population grows only through error-free replication. The second equation states that the mutant population grows from two sources: erroneous replication of the master genotype and replication of existing mutants.\n\nThe total population size is $N = N_0 + N_1$. The rate of change of the total population is:\n$$ \\frac{dN}{dt} = \\frac{dN_0}{dt} + \\frac{dN_1}{dt} = N_0 W_0 Q + N_0 W_0 (1 - Q) + N_1 W_1 = N_0 W_0 + N_1 W_1 $$\nThe average fitness of the population, $\\bar{W}$, is given by:\n$$ \\bar{W} = \\frac{1}{N} \\frac{dN}{dt} = \\frac{N_0 W_0 + N_1 W_1}{N_0 + N_1} = x_0 W_0 + x_1 W_1 = x_0 W_0 + (1-x_0)W_1 $$\nNext, we derive the ODE for the frequency of the master genotype, $x_0 = N_0 / N$:\n$$ \\frac{dx_0}{dt} = \\frac{d}{dt}\\left(\\frac{N_0}{N}\\right) = \\frac{1}{N}\\frac{dN_0}{dt} - \\frac{N_0}{N^2}\\frac{dN}{dt} $$\nSubstituting the expressions for $\\frac{dN_0}{dt}$ and $\\frac{dN}{dt}$:\n$$ \\frac{dx_0}{dt} = \\frac{N_0 W_0 Q}{N} - \\frac{N_0}{N} \\left(\\frac{N_0 W_0 + N_1 W_1}{N}\\right) $$\n$$ \\frac{dx_0}{dt} = x_0 W_0 Q - x_0 \\bar{W} $$\n$$ \\frac{dx_0}{dt} = x_0 (W_0 Q - \\bar{W}) $$\nSubstituting the expression for $\\bar{W}$:\n$$ \\frac{dx_0}{dt} = x_0 (W_0 Q - (x_0 W_0 + (1-x_0)W_1)) $$\nThe master genotype persists in the population if there is a stable steady-state solution where its frequency $x_0^*  0$. At steady state, $\\frac{dx_0}{dt} = 0$.\n$$ x_0^* (W_0 Q - (x_0^* W_0 + (1-x_0^*)W_1)) = 0 $$\nThis equation has two possible solutions for $x_0^*$:\n1. $x_0^* = 0$: This corresponds to the extinction of the master genotype.\n2. $W_0 Q - (x_0^* W_0 + (1-x_0^*)W_1) = 0$: This corresponds to a non-trivial steady state.\n\nFor the master genotype to persist, the second solution must be physically meaningful, i.e., $0  x_0^* \\le 1$. Let's solve for $x_0^*$:\n$$ W_0 Q - W_1 = x_0^* (W_0 - W_1) $$\n$$ x_0^* = \\frac{W_0 Q - W_1}{W_0 - W_1} $$\nSince we are given $W_0  W_1$, the denominator is positive. Therefore, for $x_0^*$ to be positive, the numerator must also be positive:\n$$ W_0 Q - W_1  0 \\implies W_0 Q  W_1 $$\nThis is the condition for the persistence of the master genotype. It means that the effective fitness of the master genotype, which is its intrinsic fitness $W_0$ discounted by the probability of faithful replication $Q$, must be greater than the fitness of the mutant cloud $W_1$.\n\nThe error threshold is defined by the critical mutation probability $u_c$ at which this inequality becomes an equality. Let $q_c = 1 - u_c$ be the critical fidelity. The condition is:\n$$ W_0 q_c^L = W_1 $$\nThe problem specifies the large-genome limit, where $L \\gg 1$. In this limit, and for small mutation rates $u_c \\ll 1$, we can use the approximation $(1-u_c)^L \\approx \\exp(-u_c L)$. Applying this approximation to the critical condition:\n$$ W_0 \\exp(-u_c L) = W_1 $$\nWe now solve for the critical per-site mutation probability, $u_c$:\n$$ \\exp(-u_c L) = \\frac{W_1}{W_0} $$\nTaking the natural logarithm of both sides:\n$$ -u_c L = \\ln\\left(\\frac{W_1}{W_0}\\right) = -\\ln\\left(\\frac{W_0}{W_1}\\right) $$\n$$ u_c = \\frac{1}{L} \\ln\\left(\\frac{W_0}{W_1}\\right) $$\nThis is the closed-form expression for the critical per-site mutation probability at the error threshold.\n\nNow, we evaluate $u_c$ for the given parameters: $L = 10^4$, $W_0 = 1.3$, and $W_1 = 1.0$.\n$$ u_c = \\frac{1}{10^4} \\ln\\left(\\frac{1.3}{1.0}\\right) $$\n$$ u_c = \\frac{\\ln(1.3)}{10000} $$\nUsing a calculator, $\\ln(1.3) \\approx 0.262364264$.\n$$ u_c \\approx \\frac{0.262364264}{10000} = 0.0000262364264 $$\nThis can be written in scientific notation as $2.62364264 \\times 10^{-5}$.\nThe problem requires the answer to be rounded to four significant figures.\n$$ u_c \\approx 2.624 \\times 10^{-5} $$", "answer": "$$\\boxed{2.624 \\times 10^{-5}}$$", "id": "3319085"}]}