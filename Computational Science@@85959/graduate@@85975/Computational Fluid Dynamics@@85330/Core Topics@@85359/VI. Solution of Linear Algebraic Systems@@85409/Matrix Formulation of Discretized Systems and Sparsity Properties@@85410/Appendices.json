{"hands_on_practices": [{"introduction": "The journey from a continuous partial differential equation to a computable algebraic system begins with discretization. This first exercise serves as a foundational building block, demonstrating how a simple, one-dimensional problem gives rise to a highly structured and sparse matrix. By applying a standard finite difference approximation, you will see firsthand how the local nature of the stencil directly translates into a matrix where most entries are zero, a property that is paramount for computational efficiency. [@problem_id:3344037]", "problem": "Consider the one-dimensional steady diffusion model governed by the second-order ordinary differential equation $-u''(x)=f(x)$ on the closed interval $[0,L]$, subject to Dirichlet boundary conditions $u(0)=g_{0}$ and $u(L)=g_{L}$, where $L0$ is fixed. Let the interval be partitioned into a uniform grid of $N+2$ points with spacing $h=\\frac{L}{N+1}$, and let the $N$ interior grid points be denoted $x_{i}=ih$ for $i=1,2,\\dots,N$. Define the vector of unknowns $\\boldsymbol{u}=\\left(u(x_{1}),u(x_{2}),\\dots,u(x_{N})\\right)^{\\mathsf{T}}$ and the forcing vector $\\boldsymbol{f}=\\left(f(x_{1}),f(x_{2}),\\dots,f(x_{N})\\right)^{\\mathsf{T}}$. Using a second-order central difference approximation for the second derivative $u''(x)$ at each interior point, construct the linear system $A\\boldsymbol{u}=\\boldsymbol{b}$ that discretizes $-u''(x)=f(x)$, making explicit the entries of the matrix $A\\in\\mathbb{R}^{N\\times N}$ in terms of $N$ and $h$ (the right-hand side $\\boldsymbol{b}$ may include boundary contributions but is not the focus of this question). \n\nDefine the lower bandwidth $\\ell$ of an $N\\times N$ matrix $A=\\left(a_{ij}\\right)$ as the smallest nonnegative integer such that $a_{ij}=0$ whenever $ji-\\ell$, and define the upper bandwidth $u$ as the smallest nonnegative integer such that $a_{ij}=0$ whenever $ji+u$. The full bandwidth is then $b=\\ell+u+1$. For the matrix $A$ you constructed, compute the full bandwidth $b$ and the exact total number of nonzero entries in $A$ as functions of $N$. Express your final answer as a row matrix using the LaTeX $\\texttt{pmatrix}$ environment with the first entry equal to $b$ and the second entry equal to the total number of nonzeros. No rounding is required and no units should be included in the final answer.", "solution": "The problem is well-posed and scientifically grounded, representing a standard application of the finite difference method to a one-dimensional steady diffusion equation. We shall proceed with the derivation.\n\nThe governing ordinary differential equation is $-u''(x) = f(x)$ on the domain $x \\in [0, L]$, with $L0$. The problem is subject to Dirichlet boundary conditions $u(0) = g_0$ and $u(L) = g_L$. The domain is discretized using a uniform grid with $N+2$ points, defined as $x_i = ih$ for $i = 0, 1, \\dots, N+1$, where the grid spacing is $h = \\frac{L}{N+1}$. The values $u(x_0)=u(0)=g_0$ and $u(x_{N+1})=u(L)=g_L$ are known. The unknowns are the values of the function $u(x)$ at the $N$ interior grid points, $u_i = u(x_i)$ for $i=1, 2, \\dots, N$.\n\nThe second derivative $u''(x)$ is approximated at each interior grid point $x_i$ using a second-order accurate central difference formula:\n$$\nu''(x_i) \\approx \\frac{u(x_i - h) - 2u(x_i) + u(x_i + h)}{h^2} = \\frac{u(x_{i-1}) - 2u(x_i) + u(x_{i+1})}{h^2}\n$$\nSubstituting this approximation into the differential equation $-u''(x_i) = f(x_i)$, we obtain a system of algebraic equations:\n$$\n-\\frac{u_{i+1} - 2u_i + u_{i-1}}{h^2} = f_i\n$$\nwhere $u_i = u(x_i)$ and $f_i = f(x_i)$. This equation is valid for each interior node $i = 1, 2, \\dots, N$. We can rearrange it to group terms involving the unknown values of $u$:\n$$\n\\frac{1}{h^2}(-u_{i-1} + 2u_i - u_{i+1}) = f_i\n$$\nThis set of $N$ equations forms the linear system $A\\boldsymbol{u} = \\boldsymbol{b}$, where $\\boldsymbol{u} = (u_1, u_2, \\dots, u_N)^{\\mathsf{T}}$ is the vector of unknowns. The matrix $A \\in \\mathbb{R}^{N \\times N}$ and the right-hand side vector $\\boldsymbol{b} \\in \\mathbb{R}^N$ are constructed by considering the equations for each index $i$.\n\nFor the first interior point, $i=1$:\n$$\n\\frac{1}{h^2}(-u_0 + 2u_1 - u_2) = f_1\n$$\nSince $u_0 = g_0$ is a known boundary value, this term is moved to the right-hand side:\n$$\n\\frac{1}{h^2}(2u_1 - u_2) = f_1 + \\frac{g_0}{h^2}\n$$\nThis equation defines the first row of the matrix $A$. The coefficients of the unknowns $u_1$ and $u_2$ are $a_{11} = \\frac{2}{h^2}$ and $a_{12} = -\\frac{1}{h^2}$. All other entries in the first row, $a_{1j}$ for $j2$, are zero.\n\nFor a general interior point, $1  i  N$:\n$$\n\\frac{1}{h^2}(-u_{i-1} + 2u_i - u_{i+1}) = f_i\n$$\nThis equation defines the $i$-th row of $A$. The non-zero coefficients are $a_{i,i-1} = -\\frac{1}{h^2}$, $a_{ii} = \\frac{2}{h^2}$, and $a_{i,i+1} = -\\frac{1}{h^2}$. All other entries $a_{ij}$ for $|i-j|  1$ are zero.\n\nFor the last interior point, $i=N$:\n$$\n\\frac{1}{h^2}(-u_{N-1} + 2u_N - u_{N+1}) = f_N\n$$\nSince $u_{N+1} = g_L$ is a known boundary value, this term is moved to the right-hand side:\n$$\n\\frac{1}{h^2}(-u_{N-1} + 2u_N) = f_N + \\frac{g_L}{h^2}\n$$\nThis equation defines the last row of $A$. The coefficients are $a_{N,N-1} = -\\frac{1}{h^2}$ and $a_{NN} = \\frac{2}{h^2}$. All other entries $a_{Nj}$ for $j  N-1$ are zero.\n\nCombining these results, the matrix $A$ is an $N \\times N$ matrix with the following structure:\n$$\nA = \\frac{1}{h^2}\n\\begin{pmatrix}\n2  -1  0  \\cdots  0 \\\\\n-1  2  -1  \\ddots  \\vdots \\\\\n0  -1  2  \\ddots  0 \\\\\n\\vdots  \\ddots  \\ddots  \\ddots  -1 \\\\\n0  \\cdots  0  -1  2\n\\end{pmatrix}\n$$\nThis is a symmetric tridiagonal matrix. The non-zero entries are located on the main diagonal ($a_{ii}$), the first sub-diagonal ($a_{i,i-1}$), and the first super-diagonal ($a_{i,i+1}$).\n\nNext, we compute the bandwidth.\nThe lower bandwidth $\\ell$ is the smallest non-negative integer such that $a_{ij}=0$ for all $j  i - \\ell$. The non-zero entries below the main diagonal occur only for $j = i-1$. Thus, for any $j  i-1$, we have $a_{ij}=0$. This implies that the condition is satisfied for $\\ell=1$. Since this is the smallest such non-negative integer, we have $\\ell=1$.\n\nThe upper bandwidth $u$ is the smallest non-negative integer such that $a_{ij}=0$ for all $j  i + u$. The non-zero entries above the main diagonal occur only for $j = i+1$. Thus, for any $j  i+1$, we have $a_{ij}=0$. This implies that the condition is satisfied for $u=1$. Since this is the smallest such non-negative integer, we have $u=1$.\n\nThe full bandwidth $b$ is defined as $b = \\ell + u + 1$. Substituting the values we found:\n$$\nb = 1 + 1 + 1 = 3\n$$\n\nFinally, we compute the total number of non-zero entries in $A$.\nThe matrix $A$ has non-zero entries exclusively on three diagonals:\n$1$. The main diagonal ($a_{ii}$ for $i=1, \\dots, N$) has $N$ non-zero entries.\n$2$. The first super-diagonal ($a_{i,i+1}$ for $i=1, \\dots, N-1$) has $N-1$ non-zero entries.\n$3$. The first sub-diagonal ($a_{i,i-1}$ for $i=2, \\dots, N$) has $N-1$ non-zero entries.\n\nThe total number of non-zero entries is the sum of the counts from these three diagonals:\n$$\n\\text{Total non-zeros} = N + (N-1) + (N-1) = 3N - 2\n$$\n\nThe required answer is a row matrix containing the full bandwidth $b$ and the total number of non-zeros.\nThe first entry is $b=3$.\nThe second entry is $3N-2$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n3  3N-2\n\\end{pmatrix}\n}\n$$", "id": "3344037"}, {"introduction": "Moving from one to two dimensions significantly changes the complexity and structure of the resulting linear system. This practice explores the matrix arising from the classic five-point stencil for the Laplacian, a cornerstone of many CFD models. You will analyze how the grid's topology dictates the matrix's sparsity pattern and, crucially, how nodes near the domain boundary have a different connectivity than interior nodes, directly affecting the number of nonzeros in corresponding matrix rows. [@problem_id:3344091]", "problem": "Consider the discrete pressure Poisson equation arising in incompressible Computational Fluid Dynamics (CFD) as a model of elliptic operators: the continuous Partial Differential Equation (PDE) is $-\\nabla^{2} u = f$ on a rectangular domain with Dirichlet boundary conditions. Using a uniform Cartesian mesh and the standard second-order five-point finite difference approximation of the Laplacian, assemble the linear system $A \\mathbf{u} = \\mathbf{b}$ over the interior nodes only. Let the unknowns be indexed as $\\{u_{i,j}\\}$ with $i = 1, 2, \\dots, N_{x}$ and $j = 1, 2, \\dots, N_{y}$, where $N_{x} \\geq 2$ and $N_{y} \\geq 2$ denote the number of interior points in the $x$- and $y$-directions, respectively. Use lexicographic (row-major) ordering that maps $(i,j)$ to a single index $k = i + (j-1) N_{x}$. Assume Dirichlet boundary values are known and have been incorporated into the right-hand side $\\mathbf{b}$, so only interior nodes are in the unknown vector.\n\nStarting from the finite difference stencil connectivity implied by the five-point Laplacian and the interior-only assembly with Dirichlet conditions, derive:\n- a formula for the number of nonzero entries in each matrix row as a function of the node location $(i,j)$ within the interior grid, and classify the possible row nonzero counts by location type (corner, edge-but-not-corner, interior),\n- a closed-form expression for the total number of nonzero entries $\\mathrm{nnz}(A)$ in the matrix $A$.\n\nReport your final answer as a single row matrix containing four entries in the following order: $(\\text{corner row nonzeros}, \\text{edge row nonzeros}, \\text{interior row nonzeros}, \\mathrm{nnz}(A))$. No rounding is required.", "solution": "The user wants to analyze the structure of the matrix $A$ arising from a five-point finite difference discretization of the Poisson equation on a rectangular domain.\n\n### Step 1: Problem Validation\n\n**Extract Givens:**\n- PDE: $-\\nabla^{2} u = f$ on a rectangular domain.\n- Boundary Conditions: Dirichlet.\n- Discretization Scheme: Uniform Cartesian mesh, second-order five-point finite difference approximation of the Laplacian.\n- Linear System: $A \\mathbf{u} = \\mathbf{b}$.\n- Domain of Unknowns: The vector $\\mathbf{u}$ contains values at interior nodes only. The number of interior points is $N_{x}$ in the $x$-direction and $N_{y}$ in the $y$-direction, with $N_{x} \\geq 2$ and $N_{y} \\geq 2$.\n- Nodal Indexing: Interior nodes are indexed by $\\{u_{i,j}\\}$ where $i = 1, 2, \\dots, N_{x}$ and $j = 1, 2, \\dots, N_{y}$.\n- Vectorization: A lexicographic (row-major) ordering maps the two-dimensional index $(i,j)$ to a one-dimensional index $k = i + (j-1) N_{x}$.\n- Right-Hand Side (RHS): The vector $\\mathbf{b}$ includes contributions from the source term $f$ and the known Dirichlet boundary values.\n\n**Validate Using Extracted Givens:**\n- **Scientifically Grounded:** The problem is a standard, fundamental topic in numerical partial differential equations and computational fluid dynamics. The Poisson equation, finite difference methods, and matrix assembly are well-established concepts.\n- **Well-Posed:** The problem is clearly defined. The discretization stencil, boundary condition type, and indexing scheme are all explicitly stated, which allows for the unambiguous construction of the matrix $A$. The constraints $N_{x} \\geq 2$ and $N_{y} \\geq 2$ are provided and ensure the existence of all node types (corner, edge, interior) or their valid limiting cases.\n- **Objective:** The problem is stated using precise, objective, and standard mathematical terminology.\n\n**Verdict and Action:**\nThe problem is valid as it is scientifically sound, well-posed, objective, and complete. I will proceed with the solution.\n\n### Step 2: Deriving the Structure of Matrix $A$\n\nThe five-point finite difference approximation for the negative Laplacian $-\\nabla^2 u$ at an interior grid point $(i,j)$ is given by:\n$$ -\\left( \\frac{u_{i-1,j} - 2u_{i,j} + u_{i+1,j}}{(\\Delta x)^2} + \\frac{u_{i,j-1} - 2u_{i,j} + u_{i,j+1}}{(\\Delta y)^2} \\right) = f_{i,j} $$\nFor simplicity, let's assume a uniform mesh with $\\Delta x = \\Delta y = h$. The equation becomes:\n$$ 4u_{i,j} - u_{i-1,j} - u_{i+1,j} - u_{i,j-1} - u_{i,j+1} = h^2f_{i,j} $$\nThis equation defines the $k$-th row of the linear system $A \\mathbf{u} = \\mathbf{b}$, where $k$ is the single index corresponding to the node $(i,j)$. The non-zero entries in this row of $A$ correspond to the variables that appear on the left-hand side of the equation.\n\nA variable $u_{m,n}$ appears on the LHS if and only if the node $(m,n)$ is an interior node. If a neighbor, e.g., $(i-1,j)$, falls on the boundary, its value $u_{i-1,j}$ is known due to the Dirichlet condition. This known value is moved to the right-hand side, and thus it does not contribute to a non-zero entry in the matrix $A$ (which only multiplies the vector of unknowns $\\mathbf{u}$).\n\nThe number of non-zero entries in the row of $A$ corresponding to node $(i,j)$ is therefore $1$ (for the diagonal term $u_{i,j}$ itself) plus the number of its four neighbors—$(i-1,j)$, $(i+1,j)$, $(i,j-1)$, $(i,j+1)$—that are also interior nodes.\n\nLet's classify the interior nodes $\\{ (i,j) : 1 \\leq i \\leq N_x, 1 \\leq j \\leq N_y \\}$ based on their location.\n\n**1. Number of Non-Zero Entries per Row by Node Location**\n\n*   **Interior-Interior Nodes:** These are nodes $(i,j)$ such that $1  i  N_x$ and $1  j  N_y$.\n    For such a node, all four of its neighbors—$(i-1,j)$, $(i+1,j)$, $(i,j-1)$, and $(i,j+1)$—are within the interior grid. The finite difference equation involves $u_{i,j}$ and these four neighboring unknowns.\n    Therefore, the corresponding row in matrix $A$ has $1 + 4 = 5$ non-zero entries.\n\n*   **Edge-but-not-Corner Nodes:** These nodes lie on one of the four edges of the interior grid but are not at a corner.\n    -   $i=1$, $1  j  N_y$ (left edge): Neighbors are $(0,j)$, $(2,j)$, $(1,j-1)$, $(1,j+1)$. Node $(0,j)$ is on the boundary. The other three neighbors are interior. The equation involves $u_{1,j}$ and three neighboring unknowns. Total non-zeros: $1 + 3 = 4$.\n    -   $i=N_x$, $1  j  N_y$ (right edge): Similar to the left edge, one neighbor is on the boundary. Total non-zeros: $4$.\n    -   $j=1$, $1  i  N_x$ (bottom edge): One neighbor is on the boundary. Total non-zeros: $4$.\n    -   $j=N_y$, $1  i  N_x$ (top edge): One neighbor is on the boundary. Total non-zeros: $4$.\n    In all these cases, a row corresponding to an edge node (not a corner) has **$4$** non-zero entries.\n\n*   **Corner Nodes:** These are the four corners of the interior grid: $(1,1)$, $(N_x,1)$, $(1,N_y)$, and $(N_x,N_y)$. Let's consider $(1,1)$.\n    -   Neighbors of $(1,1)$ are $(0,1)$, $(2,1)$, $(1,0)$, $(1,2)$.\n    -   Nodes $(0,1)$ and $(1,0)$ are on the boundary.\n    -   Nodes $(2,1)$ and $(1,2)$ are interior.\n    -   The equation involves $u_{1,1}$ and two neighboring unknowns. Total non-zeros: $1 + 2 = 3$.\n    By symmetry, all four corner nodes result in rows with **$3$** non-zero entries.\n\n**Summary of non-zeros per row:**\n- Corner row nonzeros: $3$\n- Edge row nonzeros: $4$\n- Interior row nonzeros: $5$\n\n**2. Total Number of Non-Zero Entries, nnz($A$)**\n\nTo find the total number of non-zero entries, we sum the non-zeros from all rows. We do this by counting the number of nodes of each type. The interior grid has dimensions $N_x \\times N_y$. The conditions $N_x \\geq 2$ and $N_y \\geq 2$ are essential.\n\n*   **Number of corner nodes:** There are always $4$ corners: $(1,1)$, $(N_x,1)$, $(1,N_y)$, $(N_x,N_y)$.\n*   **Number of edge-but-not-corner nodes:**\n    -   There are $N_x-2$ such nodes on the bottom edge and $N_x-2$ on the top edge.\n    -   There are $N_y-2$ such nodes on the left edge and $N_y-2$ on the right edge.\n    -   Total: $2(N_x-2) + 2(N_y-2) = 2N_x + 2N_y - 8$.\n*   **Number of interior-interior nodes:** These form a sub-grid of size $(N_x-2) \\times (N_y-2)$.\n    -   Total: $(N_x-2)(N_y-2) = N_xN_y - 2N_x - 2N_y + 4$.\n\nTotal non-zero entries $\\mathrm{nnz}(A)$ is the sum of contributions from each node type:\n$$ \\mathrm{nnz}(A) = (\\text{num corners} \\times 3) + (\\text{num edges} \\times 4) + (\\text{num interiors} \\times 5) $$\n$$ \\mathrm{nnz}(A) = 4 \\times 3 + (2N_x + 2N_y - 8) \\times 4 + (N_xN_y - 2N_x - 2N_y + 4) \\times 5 $$\n$$ \\mathrm{nnz}(A) = 12 + (8N_x + 8N_y - 32) + (5N_xN_y - 10N_x - 10N_y + 20) $$\nNow, collect terms:\n- For $N_xN_y$: $5N_xN_y$\n- For $N_x$: $8N_x - 10N_x = -2N_x$\n- For $N_y$: $8N_y - 10N_y = -2N_y$\n- For the constant term: $12 - 32 + 20 = 0$\nCombining these terms yields the closed-form expression:\n$$ \\mathrm{nnz}(A) = 5N_xN_y - 2N_x - 2N_y $$\n\nAn alternative method is to count the diagonal and off-diagonal entries. The matrix A is of size $(N_xN_y) \\times (N_xN_y)$.\n- **Diagonal entries:** Every row has a non-zero diagonal entry, $A_{k,k}$, corresponding to the term with $u_{i,j}$ itself. There are $N_xN_y$ such entries.\n- **Off-diagonal entries:** An off-diagonal entry $A_{k,l}$ is non-zero if nodes $k$ and $l$ are adjacent interior nodes. Each such adjacency (or \"link\") creates two non-zero entries, $A_{k,l}$ and $A_{l,k}$.\n    - Number of horizontal links: $(N_x-1)$ links in each of the $N_y$ rows. Total: $(N_x-1)N_y$.\n    - Number of vertical links: $(N_y-1)$ links in each of the $N_x$ columns. Total: $N_x(N_y-1)$.\n    - Total links = $(N_x-1)N_y + N_x(N_y-1) = N_xN_y - N_y + N_xN_y - N_x = 2N_xN_y - N_x - N_y$.\n    - Total off-diagonal non-zeros = $2 \\times (\\text{Total links}) = 2(2N_xN_y - N_x - N_y) = 4N_xN_y - 2N_x - 2N_y$.\n- **Total nnz($A$):**\n$$ \\mathrm{nnz}(A) = (\\text{diagonal entries}) + (\\text{off-diagonal entries}) $$\n$$ \\mathrm{nnz}(A) = (N_xN_y) + (4N_xN_y - 2N_x - 2N_y) = 5N_xN_y - 2N_x - 2N_y $$\nBoth methods yield the same result, confirming the expression.\n\nThe final answer is composed of the four required quantities in a row matrix: (corner row nonzeros, edge row nonzeros, interior row nonzeros, $\\mathrm{nnz}(A)$).\nThe values are ($3$, $4$, $5$, $5N_xN_y - 2N_x - 2N_y$).", "answer": "$$ \\boxed{ \\begin{pmatrix} 3  4  5  5 N_x N_y - 2 N_x - 2 N_y \\end{pmatrix} } $$", "id": "3344091"}, {"introduction": "The profound importance of matrix sparsity becomes most apparent in the context of high-performance parallel computing. This final hands-on practice connects the abstract structure of the matrix to the tangible challenge of minimizing communication between processors. You will learn that the matrix's sparsity pattern defines a graph, and the efficiency of a parallel solver depends on how this graph is partitioned. Through this coding exercise, you will directly quantify how different domain decomposition strategies affect communication overhead, revealing why graph partitioning is a critical step in scalable CFD. [@problem_id:3344036]", "problem": "Consider the constant-coefficient diffusion operator arising from mass conservation and Fick’s law on a rectangular domain with uniform grid. Starting from conservation of a scalar field $u$ in steady state with diffusion coefficient $\\kappa$, the conservation law and constitutive relation are\n$$ \\nabla \\cdot \\left( \\kappa \\nabla u \\right) = f, \\quad \\kappa  0. $$\nOn a uniform Cartesian grid with $n_x$ nodes in the $x$-direction and $n_y$ nodes in the $y$-direction, and homogeneous Dirichlet boundary conditions, a standard finite volume or finite difference discretization produces a linear system\n$$ A \\, \\mathbf{u} = \\mathbf{b}, $$\nwhere $A \\in \\mathbb{R}^{N \\times N}$ with $N = n_x n_y$ has the $5$-point stencil sparsity: each interior node $(i,j)$ is coupled to itself and its immediate neighbors $(i\\pm1,j)$ and $(i,j\\pm1)$ when those neighbors exist.\n\nDefine the adjacency graph $G = (V,E)$ of the sparsity pattern of $A$ as follows: the vertex set is $V=\\{0,1,\\dots,N-1\\}$ indexing grid nodes in row-major order, and an undirected edge $\\{p,q\\} \\in E$ exists if and only if $p \\ne q$ and $A_{pq} \\ne 0$. Consider a distributed-memory decomposition of the unknowns specified by a partition function $\\Pi: V \\to \\{0,1,\\dots,P-1\\}$ assigning each vertex to one of $P$ processes. Let the edge cut be\n$$ E_{\\mathrm{cut}} = \\left\\{ \\{p,q\\} \\in E \\,:\\, \\Pi(p) \\ne \\Pi(q) \\right\\}. $$\nA single sparse matrix-vector product $y = A x$ on this distributed layout requires exchanging values of $x$ that lie on partition interfaces. Assume a symmetric halo exchange where processes exchange exactly the boundary values they own with all neighboring processes that require them, with one scalar sent per edge direction across an interface.\n\nTasks:\n- Starting from the discrete conservation law and the definition of the graph $G$, derive a relationship between the size of the edge cut $\\lvert E_{\\mathrm{cut}} \\rvert$ and two quantities:\n  1. The total number of scalar values communicated (summed over all processes) in one synchronous halo exchange to perform $y = A x$.\n  2. The number of nonzero entries that appear in the off-diagonal blocks of the matrix after permuting the unknowns to group all vertices by partition contiguously. Here, the matrix is permuted by a permutation that groups equal $\\Pi$ labels together, yielding a $P \\times P$ block matrix whose diagonal blocks contain intra-partition couplings and off-diagonal blocks contain inter-partition couplings.\n\n- Implement a program that:\n  1. Constructs the undirected adjacency of the $5$-point operator on a rectangular grid with given $n_x$ and $n_y$.\n  2. Builds partitions $\\Pi$ according to specified strategies:\n     - \"slab_x\": split the $n_x$ columns into $P$ contiguous intervals as evenly as possible; $\\Pi(i,j)$ depends only on the column index $i$.\n     - \"slab_y\": split the $n_y$ rows into $P$ contiguous intervals as evenly as possible; $\\Pi(i,j)$ depends only on the row index $j$.\n     - \"checkerboard\": require $P$ to be a perfect square, $P = P_x P_y$ with $P_x = P_y = \\sqrt{P}$; split both $x$ and $y$ into $P_x$ and $P_y$ contiguous intervals as evenly as possible; $\\Pi(i,j) = p_x + P_x \\, p_y$ with $p_x$ and $p_y$ the interval indices of $i$ and $j$ respectively.\n     - \"random\": assign each vertex an independent label uniformly from $\\{0,1,\\dots,P-1\\}$ using a fixed seed for reproducibility.\n  3. Computes, for each test case:\n     - The integer cut size $\\lvert E_{\\mathrm{cut}} \\rvert$.\n     - The integer total number of scalars communicated in one halo exchange for $y = A x$ under the assumptions above, as a function of $\\lvert E_{\\mathrm{cut}} \\rvert$ that you derive.\n     - The floating-point fraction of matrix nonzeros that lie in off-diagonal blocks after partition-grouped permutation, defined as the ratio\n       $$ r = \\frac{\\text{number of nonzeros in off-diagonal blocks}}{\\text{total number of nonzeros in } A}, $$\n       reported rounded to $6$ decimal places.\n\nUse the following test suite (each item is $(n_x,n_y,P,\\text{strategy})$):\n- Case $1$: $(4,4,1,\\text{\"slab\\_x\"})$.\n- Case $2$: $(6,6,2,\\text{\"slab\\_x\"})$.\n- Case $3$: $(6,6,4,\\text{\"checkerboard\"})$.\n- Case $4$: $(8,4,4,\\text{\"slab\\_x\"})$.\n- Case $5$: $(6,6,4,\\text{\"random\"})$ with a fixed random seed of $0$.\n- Case $6$: $(1,8,2,\\text{\"slab\\_y\"})$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is a three-element list $[c,v,r]$ for the corresponding test case in the order above, with $c$ the integer $\\lvert E_{\\mathrm{cut}} \\rvert$, $v$ the integer total number of scalars communicated, and $r$ the floating-point fraction rounded to $6$ decimal places. For example, the overall format must be\n$$ [ [c_1,v_1,r_1],[c_2,v_2,r_2],\\dots,[c_6,v_6,r_6] ]. $$\n\nNo physical units are involved, and angles are not used. All floating-point answers must be rounded to exactly $6$ decimal places.", "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded in the principles of numerical linear algebra and parallel computing as applied to the discretization of partial differential equations. The problem is well-posed, objective, and contains all necessary information to derive a unique solution.\n\n### Theoretical Derivations\n\nThe problem asks for relationships between the size of the edge cut, $\\lvert E_{\\mathrm{cut}} \\rvert$, and two derived quantities: the total communication volume for a sparse matrix-vector product and the number of nonzeros in off-diagonal blocks of a permuted matrix.\n\n**1. Relationship between Edge Cut and Communication Volume**\n\nA sparse matrix-vector product (SpMV) of the form $\\mathbf{y} = A \\mathbf{x}$ is computed component-wise for each grid node $p \\in V$:\n$$ y_p = \\sum_{q \\in V} A_{pq} x_q $$\nFor the $5$-point stencil matrix $A$, the summation is only over the node $p$ itself and its immediate grid neighbors. Let $\\mathcal{N}(p)$ be the set of neighbors of node $p$ such that $A_{pq} \\ne 0$ for $q \\ne p$. The computation is:\n$$ y_p = A_{pp} x_p + \\sum_{q \\in \\mathcal{N}(p)} A_{pq} x_q $$\nIn a distributed memory setting, the vector $\\mathbf{x}$ is partitioned among $P$ processes according to the function $\\Pi: V \\to \\{0,1,\\dots,P-1\\}$. A process responsible for node $p$ (i.e., process $\\Pi(p)$) stores the value $x_p$.\n\nTo compute $y_p$, process $\\Pi(p)$ requires the values $x_q$ for all neighbors $q \\in \\mathcal{N}(p)$. If a neighbor $q$ is in a different partition, i.e., $\\Pi(q) \\ne \\Pi(p)$, its value $x_q$ is not locally available and must be communicated from process $\\Pi(q)$.\n\nThe set of edges connecting nodes in different partitions is the edge cut, $E_{\\mathrm{cut}} = \\left\\{ \\{p,q\\} \\in E \\,:\\, \\Pi(p) \\ne \\Pi(q) \\right\\}$. Each edge $\\{p,q\\} \\in E_{\\mathrm{cut}}$ signifies a data dependency between process $\\Pi(p)$ and process $\\Pi(q)$.\n\nThe problem specifies a \"symmetric halo exchange where processes exchange exactly the boundary values they own with all neighboring processes that require them, with one scalar sent per edge direction across an interface.\" For a single edge $\\{p,q\\} \\in E_{\\mathrm{cut}}$:\n- To compute $y_p$, process $\\Pi(p)$ needs $x_q$ from process $\\Pi(q)$. This is one communication (one scalar value).\n- To compute $y_q$, process $\\Pi(q)$ needs $x_p$ from process $\\Pi(p)$. This is a second communication.\n\nTherefore, each undirected edge in the cut corresponds to two directed communications of one scalar value each. The total number of scalars communicated, which we denote as $v$, is the sum of these communications over all edges in the cut:\n$$ v = 2 \\times \\lvert E_{\\mathrm{cut}} \\rvert $$\n\n**2. Relationship between Edge Cut and Off-Diagonal Block Nonzeros**\n\nWhen the matrix $A$ and vectors $\\mathbf{u}, \\mathbf{b}$ are permuted to group nodes by their partition index $\\Pi$, the linear system $A \\mathbf{u} = \\mathbf{b}$ becomes a block system. The permuted matrix, let's call it $A'$, has a $P \\times P$ block structure. A block $A'_{kl}$ contains all entries $A_{pq}$ where node $p$ is in partition $k$ and node $q$ is in partition $l$.\n- **Diagonal blocks** ($k=l$): Contain couplings $A_{pq}$ where both nodes $p$ and $q$ belong to the same partition ($\\Pi(p) = \\Pi(q)$).\n- **Off-diagonal blocks** ($k \\neq l$): Contain couplings $A_{pq}$ where the nodes $p$ and $q$ belong to different partitions ($\\Pi(p) \\ne \\Pi(q)$).\n\nA non-zero off-diagonal entry $A_{pq}$ (with $p \\ne q$) exists if and only if $\\{p,q\\}$ is an edge in the adjacency graph $E$. The entry $A_{pq}$ will be located in an off-diagonal block of the permuted matrix $A'$ if and only if $\\Pi(p) \\ne \\Pi(q)$. This condition is precisely the definition of the edge $\\{p,q\\}$ being in the edge cut $E_{\\mathrm{cut}}$.\n\nThe sparsity pattern of $A$ is symmetric for the diffusion operator, meaning $A_{pq} \\ne 0 \\iff A_{qp} \\ne 0$ for $p \\ne q$. Thus, each undirected edge $\\{p,q\\} \\in E_{\\mathrm{cut}}$ corresponds to two non-zero entries in the off-diagonal blocks of $A'$: the entry $A_{pq}$ and the entry $A_{qp}$.\n\nLet $N_{od}$ be the total number of non-zero entries in the off-diagonal blocks. This count is:\n$$ N_{od} = 2 \\times \\lvert E_{\\mathrm{cut}} \\rvert $$\nFrom this, we observe that $v = N_{od}$.\n\n**3. Fraction of Off-Diagonal Nonzeros**\n\nThe fraction $r$ is defined as the ratio of nonzeros in off-diagonal blocks to the total number of nonzeros in $A$, denoted $nnz(A)$.\n$$ r = \\frac{N_{od}}{nnz(A)} = \\frac{2 \\lvert E_{\\mathrm{cut}} \\rvert}{nnz(A)} $$\nTo compute this, we first need an expression for $nnz(A)$. For a $5$-point stencil on an $n_x \\times n_y$ grid:\n- Each of the $N=n_x n_y$ nodes contributes a diagonal entry to $A$.\n- The off-diagonal entries correspond to the graph edges. The number of undirected edges $|E|$ is the sum of horizontal and vertical connections:\n  - Horizontal edges: $n_y \\times (n_x - 1)$\n  - Vertical edges: $n_x \\times (n_y - 1)$\n  - Total edges: $|E| = n_y(n_x-1) + n_x(n_y-1) = 2n_x n_y - n_x - n_y$\n- Each edge $\\{p,q\\}$ corresponds to two off-diagonal non-zero entries, $A_{pq}$ and $A_{qp}$. Thus, the number of off-diagonal nonzeros is $2|E|$.\n- The total number of nonzeros is the sum of diagonal and off-diagonal entries:\n$$ nnz(A) = N + 2|E| = (n_x n_y) + 2(2n_x n_y - n_x - n_y) = 5n_x n_y - 2n_x - 2n_y $$\nThis formula simplifies to $nnz(A) = 5n_x n_y - 2(n_x + n_y)$ and is valid for all $n_x, n_y \\ge 1$.\n\n### Computational Methodology\n\nThe program will execute the following steps for each test case $(n_x, n_y, P, \\text{strategy})$:\n1.  **Construct Graph**: Generate the set of undirected edges $E$ for the $n_x \\times n_y$ grid. Nodes are indexed from $0$ to $n_x n_y - 1$ in row-major order, so node $(i,j)$ has global index $k=j \\cdot n_x + i$.\n2.  **Assign Partitions**: Create a partition vector $\\Pi$ of length $n_x n_y$. For each node $k$, its partition $\\Pi(k)$ is determined by the specified strategy (`slab_x`, `slab_y`, `checkerboard`, or `random`). For strategies involving splitting intervals \"as evenly as possible\", we use integer arithmetic `(index * P) // num_items` to distribute the items.\n3.  **Compute Edge Cut**: Iterate through each edge $\\{p,q\\} \\in E$. If $\\Pi(p) \\neq \\Pi(q)$, increment the cut size counter, $c = \\lvert E_{\\mathrm{cut}} \\rvert$.\n4.  **Calculate Results**:\n    - The total number of scalars communicated is $v = 2c$.\n    - The total number of nonzeros in matrix $A$ is $nnz(A) = 5n_x n_y - 2(n_x+n_y)$.\n    - The fraction of nonzeros in off-diagonal blocks is $r = \\frac{2c}{nnz(A)}$. This value is rounded to $6$ decimal places.\n5.  **Format Output**: The results for each case are collated into a list $[c, v, r]$ and the final output is a list of these lists.", "answer": "```python\nimport numpy as np\n\ndef get_adj_edges(nx, ny):\n    \"\"\"\n    Constructs the undirected adjacency graph for a 5-point stencil on a\n    rectangular grid.\n    \n    Args:\n        nx (int): Number of nodes in the x-direction.\n        ny (int): Number of nodes in the y-direction.\n        \n    Returns:\n        list: A list of tuples, where each tuple represents an undirected edge\n              as a pair of sorted node indices.\n    \"\"\"\n    edges = set()\n    num_nodes = nx * ny\n    if num_nodes == 0:\n        return []\n    \n    for k in range(num_nodes):\n        # Global index k to 2D grid coordinates (i, j)\n        j = k // nx\n        i = k % nx\n        \n        # Horizontal neighbor\n        if i + 1  nx:\n            neighbor_k = k + 1\n            edges.add(tuple(sorted((k, neighbor_k))))\n            \n        # Vertical neighbor\n        if j + 1  ny:\n            neighbor_k = k + nx\n            edges.add(tuple(sorted((k, neighbor_k))))\n            \n    return list(edges)\n\ndef get_partition(nx, ny, P, strategy, seed=None):\n    \"\"\"\n    Computes the partition assignment for each node on the grid.\n    \n    Args:\n        nx (int): Number of nodes in the x-direction.\n        ny (int): Number of nodes in the y-direction.\n        P (int): Number of partitions.\n        strategy (str): The partitioning strategy (\"slab_x\", \"slab_y\", \n                        \"checkerboard\", \"random\").\n        seed (int, optional): The random seed for the \"random\" strategy.\n        \n    Returns:\n        numpy.ndarray: An array of size (nx*ny) where each element is the\n                       partition ID of the corresponding node.\n    \"\"\"\n    num_nodes = nx * ny\n    partitions = np.zeros(num_nodes, dtype=int)\n    \n    if P == 1:\n        return partitions\n\n    if strategy == \"slab_x\":\n        for k in range(num_nodes):\n            i = k % nx\n            partitions[k] = (i * P) // nx\n    elif strategy == \"slab_y\":\n        for k in range(num_nodes):\n            j = k // nx\n            partitions[k] = (j * P) // ny\n    elif strategy == \"checkerboard\":\n        # Problem statement guarantees P is a perfect square.\n        Px = int(np.sqrt(P))\n        Py = Px\n        for k in range(num_nodes):\n            j = k // nx\n            i = k % nx\n            px = (i * Px) // nx\n            py = (j * Py) // ny\n            partitions[k] = px + py * Px\n    elif strategy == \"random\":\n        rng = np.random.default_rng(seed)\n        partitions = rng.integers(0, P, size=num_nodes)\n    \n    return partitions\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test suite and prints the final answer.\n    \"\"\"\n    test_cases = [\n        (4, 4, 1, \"slab_x\"),\n        (6, 6, 2, \"slab_x\"),\n        (6, 6, 4, \"checkerboard\"),\n        (8, 4, 4, \"slab_x\"),\n        (6, 6, 4, \"random\"),\n        (1, 8, 2, \"slab_y\"),\n    ]\n\n    results = []\n    for i, case in enumerate(test_cases):\n        nx, ny, P, strategy = case\n        \n        edges = get_adj_edges(nx, ny)\n        \n        seed = 0 if strategy == \"random\" else None\n        partitions = get_partition(nx, ny, P, strategy, seed=seed)\n        \n        cut_size = 0\n        for p, q in edges:\n            if partitions[p] != partitions[q]:\n                cut_size += 1\n        \n        # c: integer cut size\n        c = cut_size\n        \n        # v: integer total number of scalars communicated\n        v = 2 * c\n        \n        # r: floating-point fraction of matrix nonzeros in off-diagonal blocks\n        nnz_A = 5 * nx * ny - 2 * (nx + ny)\n        \n        if nnz_A > 0:\n            num_off_diag_block_nonzeros = 2 * c\n            r_frac = round(num_off_diag_block_nonzeros / nnz_A, 6)\n        else:\n            r_frac = 0.0\n\n        results.append([c, v, r_frac])\n\n    # Final print statement in the exact required format.\n    # The str() representation of a list is its code representation, e.g., '[0, 0, 0.0]',\n    # which is exactly what's needed.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3344036"}]}