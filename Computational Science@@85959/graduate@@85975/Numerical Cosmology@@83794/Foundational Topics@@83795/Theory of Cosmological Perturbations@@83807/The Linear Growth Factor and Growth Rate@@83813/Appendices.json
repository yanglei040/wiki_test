{"hands_on_practices": [{"introduction": "Before tackling the full complexity of our universe, it is essential to understand the growth of structure in a simplified setting. This exercise guides you through the classic derivation of perturbation growth in an Einstein-de Sitter universe, a model containing only matter. By solving the governing equation analytically, you will discover the fundamental concepts of the growing and decaying modes and see firsthand why one comes to dominate the cosmic landscape [@problem_id:3496911].", "problem": "Consider a spatially flat, pressureless matter-dominated Einstein–de Sitter universe embedded in the Friedmann–Lemaître–Robertson–Walker (FLRW) metric with scale factor $a(t)$. Linear sub-horizon density perturbations $\\delta(\\boldsymbol{x}, t)$ in this background obey the Newtonian linear evolution equation\n$$\\ddot{\\delta} + 2 H \\dot{\\delta} - 4 \\pi G \\rho \\,\\delta = 0,$$\nwhere $H(t) = \\dot{a}/a$ is the Hubble parameter, $\\rho(t)$ is the background matter density, and $G$ is Newton’s gravitational constant. Using only the Friedmann equation for a flat matter-only universe,\n$$H^{2}(t) = \\frac{8 \\pi G}{3}\\,\\rho(t),$$\nand the continuity equation for pressureless matter, derive the general behavior in time of the two independent solutions to the above perturbation equation. Then re-express the decaying mode solution as a function of the scale factor $a$ and determine its power-law scaling with $a$. Finally, quantify how the amplitude of the decaying mode, relative to the growing mode, changes between $a=10^{-3}$ and $a=1$ by computing the multiplicative suppression factor\n$$\\frac{\\left[\\delta_{\\text{dec}}(a)/\\delta_{\\text{grow}}(a)\\right]_{a=1}}{\\left[\\delta_{\\text{dec}}(a)/\\delta_{\\text{grow}}(a)\\right]_{a=10^{-3}}}.$$\nProvide the suppression factor as a single exact analytic expression with no rounding and no units.", "solution": "The problem statement has been critically validated and is deemed sound. It is scientifically grounded, well-posed, objective, and internally consistent, representing a standard exercise in physical cosmology. All necessary physical laws and model specifications are provided to derive a unique and meaningful solution. We may therefore proceed with the derivation.\n\nThe central task is to solve the linear ordinary differential equation for sub-horizon density perturbations, $\\delta$, in an Einstein–de Sitter universe:\n$$\n\\ddot{\\delta} + 2 H \\dot{\\delta} - 4 \\pi G \\rho \\,\\delta = 0\n$$\nThe coefficients $H(t)$ and $\\rho(t)$ are determined by the background cosmology. For a spatially flat, pressureless matter-dominated universe, the Friedmann equation is given as:\n$$\nH^{2} = \\left(\\frac{\\dot{a}}{a}\\right)^{2} = \\frac{8 \\pi G}{3}\\,\\rho\n$$\nThe continuity equation for pressureless matter ($P=0$) is $\\dot{\\rho} + 3 H \\rho = 0$. This can be rewritten as $\\frac{d\\rho}{\\rho} = -3 \\frac{da}{a}$, which integrates to give the evolution of the background matter density:\n$$\n\\rho(t) \\propto a(t)^{-3}\n$$\nSubstituting this into the Friedmann equation:\n$$\n\\left(\\frac{\\dot{a}}{a}\\right)^{2} \\propto a^{-3} \\implies \\dot{a}^{2} \\propto a^{-1} \\implies \\dot{a} \\propto a^{-1/2}\n$$\nThis differential equation for the scale factor, $a(t)$, can be solved by separation of variables:\n$$\na^{1/2} da \\propto dt \\implies \\int a^{1/2} da \\propto \\int dt \\implies \\frac{2}{3} a^{3/2} \\propto t\n$$\nChoosing the initial time such that the integration constant is zero, we find the characteristic time evolution of the scale factor in an Einstein–de Sitter universe:\n$$\na(t) \\propto t^{2/3}\n$$\nFrom this, we can express the Hubble parameter $H(t)$ and the density term $4 \\pi G \\rho$ explicitly as functions of time $t$. Let $a(t) = C t^{2/3}$ for some constant $C$.\nThe Hubble parameter is:\n$$\nH(t) = \\frac{\\dot{a}}{a} = \\frac{\\frac{2}{3} C t^{-1/3}}{C t^{2/3}} = \\frac{2}{3t}\n$$\nUsing the Friedmann equation, we can express the density term as:\n$$\n4 \\pi G \\rho = \\frac{3}{2} H^{2} = \\frac{3}{2} \\left(\\frac{2}{3t}\\right)^{2} = \\frac{3}{2} \\left(\\frac{4}{9t^2}\\right) = \\frac{2}{3t^2}\n$$\nNow, we substitute these time-dependent coefficients into the perturbation evolution equation:\n$$\n\\ddot{\\delta} + 2 \\left(\\frac{2}{3t}\\right) \\dot{\\delta} - \\left(\\frac{2}{3t^2}\\right) \\delta = 0\n$$\n$$\n\\ddot{\\delta} + \\frac{4}{3t} \\dot{\\delta} - \\frac{2}{3t^2} \\delta = 0\n$$\nThis is a second-order linear homogeneous differential equation of the Euler-Cauchy type. We seek power-law solutions of the form $\\delta(t) \\propto t^{n}$. Substituting this ansatz and its derivatives, $\\dot{\\delta} \\propto n t^{n-1}$ and $\\ddot{\\delta} \\propto n(n-1) t^{n-2}$, into the equation yields:\n$$\nn(n-1)t^{n-2} + \\frac{4}{3t} (n t^{n-1}) - \\frac{2}{3t^2} (t^n) = 0\n$$\nDividing by $t^{n-2}$ gives the characteristic equation for the exponent $n$:\n$$\nn(n-1) + \\frac{4}{3}n - \\frac{2}{3} = 0\n$$\n$$\nn^2 - n + \\frac{4}{3}n - \\frac{2}{3} = 0\n$$\n$$\nn^2 + \\frac{1}{3}n - \\frac{2}{3} = 0\n$$\nMultiplying by $3$ to clear the denominators, we obtain a simple quadratic equation:\n$$\n3n^2 + n - 2 = 0\n$$\nThis can be factored as $(3n - 2)(n + 1) = 0$. The two roots are:\n$$\nn_1 = \\frac{2}{3} \\quad \\text{and} \\quad n_2 = -1\n$$\nThese exponents correspond to the two independent solutions for the time evolution of the density perturbation:\n1.  The growing mode: $\\delta_{\\text{grow}}(t) \\propto t^{2/3}$\n2.  The decaying mode: $\\delta_{\\text{dec}}(t) \\propto t^{-1}$\n\nThe general solution is a linear combination of these two modes: $\\delta(t) = C_1 t^{2/3} + C_2 t^{-1}$.\n\nNext, we re-express these solutions as a function of the scale factor $a$. We have the relation $a(t) \\propto t^{2/3}$, which implies $t \\propto a^{3/2}$.\nThe growing mode becomes:\n$$\n\\delta_{\\text{grow}}(a) \\propto (a^{3/2})^{2/3} = a^1\n$$\nThe decaying mode becomes:\n$$\n\\delta_{\\text{dec}}(a) \\propto (a^{3/2})^{-1} = a^{-3/2}\n$$\nThe power-law scaling of the decaying mode with the scale factor $a$ is thus $a^{-3/2}$.\n\nFinally, we must quantify the suppression of the decaying mode relative to the growing mode as the universe expands from $a=10^{-3}$ to $a=1$. We define the ratio of the amplitudes of the decaying mode to the growing mode as $R(a)$:\n$$\nR(a) = \\frac{\\delta_{\\text{dec}}(a)}{\\delta_{\\text{grow}}(a)}\n$$\nLet $\\delta_{\\text{dec}}(a) = K_2 a^{-3/2}$ and $\\delta_{\\text{grow}}(a) = K_1 a^1$, where $K_1$ and $K_2$ are constants determined by initial conditions. The ratio is:\n$$\nR(a) = \\frac{K_2 a^{-3/2}}{K_1 a^1} = \\frac{K_2}{K_1} a^{-3/2 - 1} = \\frac{K_2}{K_1} a^{-5/2}\n$$\nThe problem asks for the multiplicative suppression factor, which is the ratio of this quantity at $a=1$ to its value at $a=10^{-3}$:\n$$\n\\text{Suppression Factor} = \\frac{R(a=1)}{R(a=10^{-3})} = \\frac{\\left(\\frac{K_2}{K_1}\\right) (1)^{-5/2}}{\\left(\\frac{K_2}{K_1}\\right) (10^{-3})^{-5/2}}\n$$\nThe constants cancel, leaving:\n$$\n\\text{Suppression Factor} = \\frac{1}{(10^{-3})^{-5/2}} = \\frac{1}{10^{(-3) \\times (-5/2)}} = \\frac{1}{10^{15/2}} = 10^{-15/2}\n$$\nThis is the exact analytic expression for the suppression factor.", "answer": "$$\\boxed{10^{-15/2}}$$", "id": "3496911"}, {"introduction": "In the standard $\\Lambda$CDM model, the growth of structure no longer has a simple analytic solution, requiring us to turn to numerical methods. This practice challenges you to compute the true linear growth rate by numerically integrating its governing differential equation. You will then test the accuracy of the widely-used approximation $f(a) \\simeq \\Omega_{\\rm m}(a)^{\\gamma}$, a crucial skill for understanding the trade-offs between precision and convenience in modern cosmological calculations [@problem_id:3496854].", "problem": "Consider linear perturbation theory for a spatially flat Cold Dark Matter plus Cosmological Constant model, where the cosmic scale factor is denoted by $a$, the Hubble parameter by $H(a)$, and the present-day matter density parameter by $\\Omega_{\\rm m0}$. The linear growth factor $D(a)$ evolves according to the second-order ordinary differential equation derived from the Newtonian limit of General Relativity (GR) coupled to the Friedmann–Lemaître–Robertson–Walker background, expressed in terms of the variable $x=\\ln a$ as\n$$\n\\frac{d^2 D}{dx^2} + \\left[2 + \\frac{d \\ln H}{d \\ln a}\\right] \\frac{d D}{dx} - \\frac{3}{2}\\,\\Omega_{\\rm m}(a)\\, D = 0,\n$$\nwhere the matter fraction $\\Omega_{\\rm m}(a)$ is defined by\n$$\n\\Omega_{\\rm m}(a) = \\frac{\\Omega_{\\rm m0}\\, a^{-3}}{\\Omega_{\\rm m0}\\, a^{-3} + \\Omega_{\\Lambda 0}},\n$$\nwith $\\Omega_{\\Lambda 0} = 1 - \\Omega_{\\rm m0}$ for spatial flatness, and\n$$\n\\frac{d \\ln H}{d \\ln a} = -\\frac{3}{2}\\,\\Omega_{\\rm m}(a)\n$$\nfollows from $H^2(a) \\propto \\Omega_{\\rm m0}\\, a^{-3} + \\Omega_{\\Lambda 0}$ in a flat Cosmological Constant (Lambda) background.\n\nDefine the linear growth rate $f(a)$ by\n$$\nf(a) = \\frac{d \\ln D}{d \\ln a}.\n$$\nAn often-used approximation is $f(a) \\simeq \\Omega_{\\rm m}(a)^{\\gamma}$ with a constant index $\\gamma$. Your task is to quantify the fractional error of this approximation with $\\gamma = 0.55$ across the redshift interval $0  z  2$ for $\\Omega_{\\rm m0} = 0.3$ by comparing against the numerically integrated solution for $f(a)$ obtained from the differential equation above.\n\nUse the following fundamental base in your derivation and implementation:\n- The background expansion law for a spatially flat Cosmological Constant plus matter universe, $H^2(a) \\propto \\Omega_{\\rm m0}\\, a^{-3} + \\Omega_{\\Lambda 0}$ with $\\Omega_{\\Lambda 0} = 1 - \\Omega_{\\rm m0}$.\n- The linear growth factor equation for $D(a)$ in terms of $x=\\ln a$ given above.\n- The definition $f(a) = \\left(d \\ln D / d \\ln a\\right)$.\n\nDo not introduce any shortcut formulas that bypass these bases. Explicitly obtain $f(a)$ by numerically integrating the second-order ordinary differential equation for $D(a)$ and evaluating $f(a) = \\left(\\frac{d D}{dx}\\right)/D$ from the numerical solution.\n\nInitial condition specification:\n- Choose $a_{\\rm ini} = 10^{-3}$ and impose the matter-dominated asymptotic scaling $D(a) \\propto a$ at early times by setting $D(a_{\\rm ini}) = a_{\\rm ini}$ and $\\left.\\frac{d D}{dx}\\right|_{a_{\\rm ini}} = D(a_{\\rm ini})$. This ensures $f(a_{\\rm ini}) \\to 1$ consistent with $D \\propto a$ when $a \\ll 1$.\n\nDefine the fractional error at a given $a$ as\n$$\n\\varepsilon(a) = \\frac{f_{\\rm approx}(a) - f_{\\rm true}(a)}{f_{\\rm true}(a)},\n$$\nwhere $f_{\\rm approx}(a) = \\Omega_{\\rm m}(a)^{\\gamma}$ and $f_{\\rm true}(a)$ is obtained from the numerical solution.\n\nNumerically evaluate the error over the redshift range $z \\in [0,2]$ where $a = 1/(1+z)$. Construct two uniform grids in $z$:\n- A fine grid with $N_{\\rm fine} = 401$ points including endpoints $z=0$ and $z=2$.\n- A coarse grid with $N_{\\rm coarse} = 41$ points including endpoints $z=0$ and $z=2$.\n\nTest Suite and required metrics:\n- Test $1$ (happy path): Compute the maximum absolute fractional error $\\max_{0z2} |\\varepsilon|$ on the fine grid, excluding the endpoints $z=0$ and $z=2$ from the maximization.\n- Test $2$ (resolution robustness): Compute the maximum absolute fractional error $\\max_{0z2} |\\varepsilon|$ on the coarse grid, excluding the endpoints $z=0$ and $z=2$ from the maximization.\n- Test $3$ (boundary condition at late time): Compute the signed fractional error $\\varepsilon$ at $z=0$.\n- Test $4$ (boundary condition at the edge of the interval): Compute the signed fractional error $\\varepsilon$ at $z=2$.\n\nAll outputs are dimensionless and must be expressed as decimal numbers (no percentage sign). Your program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the order $[\\text{Test }1,\\text{ Test }2,\\text{ Test }3,\\text{ Test }4]$. For example, the output format must be exactly like $[\\varepsilon_1,\\varepsilon_2,\\varepsilon_3,\\varepsilon_4]$.", "solution": "The user wants to validate the problem statement and, if it is valid, provide a solution.\n\n### Step 1: Extract Givens\n- **Model**: Spatially flat Cold Dark Matter plus Cosmological Constant ($\\Lambda$CDM) universe.\n- **Governing Equation**: The linear growth factor $D$ as a function of $x = \\ln a$ evolves according to:\n$$\n\\frac{d^2 D}{dx^2} + \\left[2 + \\frac{d \\ln H}{d \\ln a}\\right] \\frac{d D}{dx} - \\frac{3}{2}\\,\\Omega_{\\rm m}(a)\\, D = 0\n$$\n- **Definitions and Relations**:\n    - Matter density parameter at scale factor $a$: \n    $$\n    \\Omega_{\\rm m}(a) = \\frac{\\Omega_{\\rm m0}\\, a^{-3}}{\\Omega_{\\rm m0}\\, a^{-3} + \\Omega_{\\Lambda 0}}\n    $$\n    - Flatness condition: $\\Omega_{\\Lambda 0} = 1 - \\Omega_{\\rm m0}$.\n    - Hubble parameter evolution: \n    $$\n    \\frac{d \\ln H}{d \\ln a} = -\\frac{3}{2}\\,\\Omega_{\\rm m}(a)\n    $$\n    - Linear growth rate:\n    $$\n    f(a) = \\frac{d \\ln D}{d \\ln a}\n    $$\n- **Approximation**: The growth rate is approximated as $f_{\\rm approx}(a) = \\Omega_{\\rm m}(a)^{\\gamma}$.\n- **Parameters**: \n    - Present-day matter density parameter: $\\Omega_{\\rm m0} = 0.3$.\n    - Growth index for approximation: $\\gamma = 0.55$.\n- **Initial Conditions**:\n    - Initial scale factor: $a_{\\rm ini} = 10^{-3}$.\n    - Initial growth factor: $D(a_{\\rm ini}) = a_{\\rm ini}$.\n    - Initial growth factor derivative: $\\left.\\frac{d D}{dx}\\right|_{a_{\\rm ini}} = D(a_{\\rm ini})$.\n- **Task**: Calculate the fractional error $\\varepsilon(a) = \\frac{f_{\\rm approx}(a) - f_{\\rm true}(a)}{f_{\\rm true}(a)}$ over the redshift range $z \\in [0, 2]$, where $a = 1/(1+z)$.\n- **Evaluation Grids**:\n    - Fine grid: $N_{\\rm fine} = 401$ uniform points in $z$ from $z=0$ to $z=2$.\n    - Coarse grid: $N_{\\rm coarse} = 41$ uniform points in $z$ from $z=0$ to $z=2$.\n- **Required Metrics**:\n    1. Maximum absolute fractional error $\\max_{0z2} |\\varepsilon|$ on the fine grid (endpoints excluded).\n    2. Maximum absolute fractional error $\\max_{0z2} |\\varepsilon|$ on the coarse grid (endpoints excluded).\n    3. Signed fractional error $\\varepsilon$ at $z=0$.\n    4. Signed fractional error $\\varepsilon$ at $z=2$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is subjected to a rigorous validation check.\n\n- **Scientifically Grounded**: The problem is fundamentally sound. The equations for the background expansion ($H(a)$), matter density ($\\Omega_{\\rm m}(a)$), and a simplified form of the Mészáros equation for the linear growth factor ($D(a)$) are cornerstones of modern cosmology and linear perturbation theory. The parameter values ($\\Omega_{\\rm m0}=0.3$) are consistent with current cosmological constraints.\n- **Well-Posed**: The problem is well-posed. It describes a second-order linear ordinary differential equation (ODE) with a complete set of initial conditions, forming a standard initial value problem (IVP). A unique, stable solution is guaranteed to exist.\n- **Objective**: The problem is stated in precise, objective, and quantitative terms. All tasks are clearly defined calculations.\n- **Incompleteness or Contradiction**: The problem is self-contained and free of contradictions. All necessary equations, parameters, and initial conditions are provided. The initial conditions, $D(a_{\\rm ini}) \\propto a_{\\rm ini}$ and $f(a_{\\rm ini}) = 1$, are physically motivated and correctly select the growing mode solution in the early, matter-dominated universe.\n- **Unrealistic or Infeasible**: The setup is realistic. The numerical integration is a standard task in computational cosmology. The redshift range and parameter choices are physically relevant.\n- **Ill-Posed or Poorly Structured**: The problem is well-structured and leads to a unique, meaningful solution.\n- **Other Flaws**: The problem is not trivial, pseudo-profound, or unverifiable. It represents a standard, meaningful exercise in numerical cosmology.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be provided.\n\n### Solution Derivation\n\nThe goal is to numerically solve for the linear growth factor $D(a)$ and its derivative to find the true growth rate $f_{\\rm true}(a)$, then compare it to the approximation $f_{\\rm approx}(a) = \\Omega_{\\rm m}(a)^\\gamma$.\n\n**1. Formulating the ODE for Numerical Integration**\n\nWe first substitute the expression for $\\frac{d \\ln H}{d \\ln a}$ into the governing ODE for $D(x)$:\n$$\n\\frac{d^2 D}{dx^2} + \\left[2 - \\frac{3}{2}\\,\\Omega_{\\rm m}(a)\\right] \\frac{d D}{dx} - \\frac{3}{2}\\,\\Omega_{\\rm m}(a)\\, D = 0\n$$\nwhere $x = \\ln a$ and $\\Omega_{\\rm m}(a)$ is given by:\n$$\n\\Omega_{\\rm m}(a) = \\frac{\\Omega_{\\rm m0}\\, a^{-3}}{\\Omega_{\\rm m0}\\, a^{-3} + 1 - \\Omega_{\\rm m0}}\n$$\nTo solve this second-order ODE numerically, we convert it into a system of two first-order ODEs. Let the state vector be $Y(x) = [Y_1, Y_2]^T = [D(x), dD/dx]^T$. The system is:\n$$\n\\frac{dY}{dx} = \\begin{pmatrix} dY_1/dx \\\\ dY_2/dx \\end{pmatrix} = \\begin{pmatrix} Y_2 \\\\ \\left[\\frac{3}{2}\\,\\Omega_{\\rm m}(e^x) - 2\\right] Y_2 + \\frac{3}{2}\\,\\Omega_{\\rm m}(e^x)\\, Y_1 \\end{pmatrix}\n$$\nThis system can be integrated using a standard IVP solver.\n\n**2. Setting Up the Integration**\n\nThe integration will proceed in the variable $x = \\ln a$. The initial conditions are specified at $a_{\\rm ini} = 10^{-3}$, which corresponds to an initial $x$ of $x_{\\rm ini} = \\ln(10^{-3})$.\nThe state vector at this point is $Y(x_{\\rm ini})$:\n- $Y_1(x_{\\rm ini}) = D(a_{\\rm ini}) = a_{\\rm ini} = 10^{-3}$.\n- $Y_2(x_{\\rm ini}) = \\frac{dD}{dx}\\Big|_{x_{\\rm ini}} = D(a_{\\rm ini}) = 10^{-3}$.\nThe integration range must cover the redshift interval $z \\in [0, 2]$. This corresponds to $a \\in [1/3, 1]$ and $x \\in [\\ln(1/3), 0]$. The integration will run from $x_{\\rm ini} \\approx -6.907$ up to $x = 0$.\n\nWe will construct a grid of evaluation points `t_eval` for the solver, comprising $x_{\\rm ini}$ and all $x$ values corresponding to the union of the fine and coarse $z$-grids. This ensures the solution is computed exactly at all required points.\n\n**3. Calculating the Fractional Error**\n\nAfter solving the ODE system, we obtain the numerical solutions for $D(x)$ and $dD/dx$ at each point in `t_eval`. The \"true\" growth rate is then calculated as:\n$$\nf_{\\rm true}(a) = \\frac{d \\ln D}{d \\ln a} = \\frac{1}{D(x)} \\frac{dD}{dx}\n$$\nThe approximate growth rate is:\n$$\nf_{\\rm approx}(a) = \\Omega_{\\rm m}(a)^{\\gamma}\n$$\nwith $\\gamma = 0.55$. The fractional error $\\varepsilon(a)$ is then computed at each grid point:\n$$\n\\varepsilon(a) = \\frac{f_{\\rm approx}(a) - f_{\\rm true}(a)}{f_{\\rm true}(a)}\n$$\n\n**4. Extracting the Required Metrics**\n\nThe numerical solution provides the error $\\varepsilon$ at all points on the combined grid. From this, we extract:\n- The error values corresponding to the fine and coarse grids.\n- The maximum of the absolute errors on the interior of each grid ($z \\in (0, 2)$).\n- The signed error at the boundary points $z=0$ and $z=2$.\n\nThe implementation will use `scipy.integrate.solve_ivp` for the numerical integration and `numpy` for array manipulations. The results for the fine and coarse grids are efficiently retrieved from the master solution by using `numpy.interp` as a robust lookup mechanism, since the evaluation points for the grids are a subset of the points passed to the solver.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the linear growth factor ODE, computes the growth rate, and evaluates\n    the fractional error of the f ~ Omega_m^gamma approximation.\n    \"\"\"\n    \n    # 1. Define cosmological and problem parameters\n    Omega_m0 = 0.3\n    Omega_L0 = 1.0 - Omega_m0\n    gamma = 0.55\n    a_ini = 1e-3\n\n    # 2. Define the grids for evaluation\n    N_fine = 401\n    N_coarse = 41\n    z_fine = np.linspace(0.0, 2.0, N_fine)\n    z_coarse = np.linspace(0.0, 2.0, N_coarse)\n    \n    # Create a single, sorted, unique grid of all z-points for one master integration\n    z_combined = np.union1d(z_fine, z_coarse)\n\n    # Convert z grids to x = ln(a) grids for the ODE solver\n    # Note: a = 1 / (1 + z)\n    x_ini = np.log(a_ini)\n    x_combined = np.log(1.0 / (1.0 + z_combined))\n    \n    # The solver requires a sorted array of evaluation times (t_eval)\n    x_eval = np.unique(np.concatenate(([x_ini], x_combined)))\n\n    # 3. Define the system of first-order ODEs\n    # Y = [D, dD/dx]\n    def ode_system(x, Y, Om0, OL0):\n        \"\"\"\n        Defines the ODE system dY/dx for the linear growth factor.\n        x: independent variable, ln(a)\n        Y: state vector [D, dD/dx]\n        Om0, OL0: cosmological parameters\n        \"\"\"\n        D, dDdx = Y\n        \n        # Calculate Omega_m(a) at the given x = ln(a)\n        # Omega_m(a) = (Om0 * a^-3) / (Om0 * a^-3 + OL0)\n        # Use a = exp(x) - a^-3 = exp(-3x) for numerical stability\n        num = Om0 * np.exp(-3.0 * x)\n        den = num + OL0\n        Omega_m_a = num / den\n        \n        # Second derivative from the rearranged growth equation:\n        # d^2D/dx^2 = -[2 - 1.5*Omega_m(a)]*(dD/dx) + 1.5*Omega_m(a)*D\n        d2Ddx2 = -(2.0 - 1.5 * Omega_m_a) * dDdx + 1.5 * Omega_m_a * D\n        \n        return [dDdx, d2Ddx2]\n\n    # 4. Set initial conditions and solve the ODE\n    # Initial conditions for matter-dominated growing mode: D=a, dD/dx=D\n    y_ini = np.array([a_ini, a_ini])\n    x_span = [x_ini, 0.0] # Integrate from x_ini up to today (x=0)\n    \n    sol = solve_ivp(\n        ode_system,\n        x_span,\n        y_ini,\n        method='RK45',\n        t_eval=x_eval,\n        args=(Omega_m0, Omega_L0),\n        rtol=1e-9,  # High precision for accurate error calculation\n        atol=1e-12\n    )\n\n    # 5. Calculate true and approximate growth rates and the fractional error\n    # The solution is returned at x_eval points, which is sol.t\n    x_solution = sol.t\n    D_solution = sol.y[0]\n    dDdx_solution = sol.y[1]\n    \n    # True growth rate: f_true = (dD/dx) / D\n    f_true = dDdx_solution / D_solution\n    \n    # Approximate growth rate: f_approx = Omega_m(a)^gamma\n    a_solution = np.exp(x_solution)\n    Omega_m_solution = (Omega_m0 * a_solution**-3) / (Omega_m0 * a_solution**-3 + Omega_L0)\n    f_approx = Omega_m_solution**gamma\n    \n    # Fractional error\n    errors = (f_approx - f_true) / f_true\n\n    # 6. Extract metrics for test cases by mapping solution back to z-grids\n    # Use np.interp as a robust lookup, since x_eval contains all our points.\n    # np.interp requires xp to be increasing, which sol.t is.\n    # The x-grids corresponding to z-grids are decreasing, so we flip them.\n    \n    x_fine = np.log(1.0 / (1.0 + z_fine))\n    errors_fine = np.interp(np.flip(x_fine), x_solution, errors)\n    errors_fine = np.flip(errors_fine) # Flip back to match z_fine ordering\n    \n    x_coarse = np.log(1.0 / (1.0 + z_coarse))\n    errors_coarse = np.interp(np.flip(x_coarse), x_solution, errors)\n    errors_coarse = np.flip(errors_coarse) # Flip back to match z_coarse ordering\n\n    # Test 1: Max absolute error on fine grid interior (0  z  2)\n    max_err_fine = np.max(np.abs(errors_fine[1:-1]))\n    \n    # Test 2: Max absolute error on coarse grid interior (0  z  2)\n    max_err_coarse = np.max(np.abs(errors_coarse[1:-1]))\n\n    # Test 3: Signed error at z=0\n    # This corresponds to the first element of z_fine and errors_fine\n    err_z0 = errors_fine[0]\n\n    # Test 4: Signed error at z=2\n    # This corresponds to the last element of z_fine and errors_fine\n    err_z2 = errors_fine[-1]\n\n    results = [max_err_fine, max_err_coarse, err_z0, err_z2]\n\n    # 7. Print the final results in the required format\n    # Example format: [0.0152,-0.01,0.005,-0.002]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3496854"}, {"introduction": "A key task for cosmologists is to determine the regime of validity for our theoretical models when comparing them to simulations or observations. This exercise simulates this process by asking you to analyze a synthetic dataset that mimics the output of an N-body simulation, including mild non-linear effects. By comparing this 'data' to the pure linear theory prediction you will calculate, you will identify the scale at which linear theory breaks down, a critical step in the analysis of large-scale structure [@problem_id:3496921].", "problem": "You are asked to design a numerical procedure that, for a set of cosmological backgrounds and synthetic Fourier-mode amplitudes, reconstructs the simulated growth factor from individual modes, builds the corresponding linear growth factor from first principles, and quantifies the breakdown scale of linear theory as a function of the mode wave number. Your program must implement a complete pipeline without any user input and produce a single-line output aggregating the results for all test cases.\n\nThe task must be grounded in fundamental cosmological dynamics and linear perturbation theory. Use the background expansion determined by the Friedmann equation and the standard linear matter perturbation evolution in an expanding universe. The linear growth factor is defined as the normalization of the growing solution for the matter density contrast amplitude, and the linear growth rate is defined as the logarithmic derivative of the growth factor with respect to the scale factor. Begin from these foundations and derive the ordinary differential equation for the growth factor, phrased in terms of the natural time variable built from the scale factor, and implement its numerical solution with physically consistent initial conditions deep in the matter-dominated regime. Do not assume or use any pre-packaged formulas for the growth factor; derive and solve the differential equation implied by the stated dynamics. Normalize your solution by a reference value at an early scale factor to construct a dimensionless linear growth ratio.\n\nYou will be provided synthetic \"simulation-like\" data in the form of Fourier-mode amplitudes. Each mode amplitude is constructed to be proportional to the linear growth ratio multiplied by a mild scale- and time-dependent suppression that mimics mode-coupling effects at mildly nonlinear scales. From these synthetic amplitudes, extract the simulated growth per mode by taking ratios to the initial amplitude, and compare to the linear growth ratio to assess the validity of the linear approximation as a function of wave number.\n\nAll quantities in this task are dimensionless, and there are no physical units involved.\n\nYour program must carry out the following steps for each test case:\n- Construct the background expansion function $H(a)$ from the Friedmann equation with matter, cosmological constant, and curvature components specified by present-day density parameters $\\,\\Omega_{m0}\\,$, $\\,\\Omega_{\\Lambda0}\\,$, and implicit $\\,\\Omega_{k0} = 1 - \\Omega_{m0} - \\Omega_{\\Lambda0}\\,$.\n- Starting from the linearized matter perturbation dynamics for the growth of the density contrast, derive the second-order ordinary differential equation (Ordinary Differential Equation (ODE)) for the linear growth factor $\\,D(a)\\,$ expressed in terms of the variable $\\,y = \\ln a\\,$ and solve it numerically from $\\,a = a_{\\mathrm{i}}\\,$ up to the largest scale factor in the provided grid. Impose matter-dominated initial conditions at $\\,a_{\\mathrm{i}}\\,$ for the growing mode. Use the solution to form the dimensionless linear growth ratio $\\,R(a) = D(a)/D(a_{\\mathrm{i}})\\,$ evaluated on the supplied scale-factor grid.\n- Using the provided synthetic Fourier-mode prescription, compute the mode amplitudes $\\,\\delta_k(a)\\,$ for every $\\,a\\,$ on the scale-factor grid and every $\\,k\\,$ on the wave-number grid. Then, for each mode $\\,k\\,$, measure the simulated growth as $\\,G_{\\mathrm{sim}}(k,a) = \\delta_k(a)/\\delta_k(a_{\\mathrm{i}})\\,$.\n- For each wave number $\\,k\\,$, evaluate the relative deviation from linear theory for all $\\,a\\,$ in the grid as $\\,\\Delta(k,a) = G_{\\mathrm{sim}}(k,a)/R(a) - 1\\,$. Define a tolerance $\\,\\varepsilon\\,$ (as a decimal) and determine the largest wave number $\\,k_{\\max}\\,$ among the provided $\\,k\\,$ values such that the maximum over the scale-factor grid satisfies $\\,\\max_{a}\\,|\\Delta(k,a)| \\le \\varepsilon\\,$. If no $\\,k\\,$ satisfies the criterion, set $\\,k_{\\max} = 0.0\\,$.\n- Your program should produce a single line of output containing $\\,k_{\\max}\\,$ for each test case as a comma-separated list enclosed in square brackets.\n\nSynthetic Fourier-mode prescription and numerical inputs:\n- For a given cosmology, define the dimensionless linear growth ratio $\\,R(a) = D(a)/D(a_{\\mathrm{i}})\\,$, where $\\,D(a)\\,$ is obtained by numerically integrating the derived ODE.\n- Define the synthetic mode amplitudes by\n$$\n\\delta_k(a) = \\delta_0(k)\\,R(a)\\,\\frac{1}{1 + \\left(\\frac{k}{k_{\\mathrm{mnl}}}\\right)^{\\beta} \\, [R(a)]^{\\gamma}},\n$$\nwhere $\\,\\delta_0(k) = k^{n_s}\\,$ sets the initial mode dependence and $\\,k_{\\mathrm{mnl}}\\,$, $\\,\\beta\\,$, and $\\,\\gamma\\,$ control the onset and strength of mildly nonlinear suppression.\n- The simulated growth per mode is\n$$\nG_{\\mathrm{sim}}(k,a) = \\frac{\\delta_k(a)}{\\delta_k(a_{\\mathrm{i}})}.\n$$\n\nTest suite:\n- Case $\\,1\\,$ (Lambda Cold Dark Matter (ΛCDM), happy path):\n  - Cosmology: $\\,\\Omega_{m0} = 0.3\\,$, $\\,\\Omega_{\\Lambda0} = 0.7\\,$.\n  - Initial scale factor: $\\,a_{\\mathrm{i}} = 0.01\\,$.\n  - Scale-factor grid: $\\,a \\in \\{0.05, 0.1, 0.3, 0.5, 1.0\\}\\,$.\n  - Wave-number grid: $\\,k \\in \\{0.02, 0.05, 0.1, 0.2, 0.3\\}\\,$.\n  - Synthetic parameters: $\\,n_s = 1.0\\,$, $\\,k_{\\mathrm{mnl}} = 0.15\\,$, $\\,\\beta = 1.2\\,$, $\\,\\gamma = 1.0\\,$.\n  - Tolerance: $\\,\\varepsilon = 0.05\\,$ (expressed as a decimal).\n- Case $\\,2\\,$ (Einstein–de Sitter, near-linear boundary):\n  - Cosmology: $\\,\\Omega_{m0} = 1.0\\,$, $\\,\\Omega_{\\Lambda0} = 0.0\\,$.\n  - Initial scale factor: $\\,a_{\\mathrm{i}} = 0.01\\,$.\n  - Scale-factor grid: $\\,a \\in \\{0.05, 0.1, 0.3, 0.5, 1.0\\}\\,$.\n  - Wave-number grid: $\\,k \\in \\{0.02, 0.05, 0.1, 0.2, 0.3\\}\\,$.\n  - Synthetic parameters: $\\,n_s = 1.0\\,$, $\\,k_{\\mathrm{mnl}} = 0.30\\,$, $\\,\\beta = 1.0\\,$, $\\,\\gamma = 1.0\\,$.\n  - Tolerance: $\\,\\varepsilon = 0.05\\,$.\n- Case $\\,3\\,$ (open universe, curvature-dominated at late times):\n  - Cosmology: $\\,\\Omega_{m0} = 0.3\\,$, $\\,\\Omega_{\\Lambda0} = 0.0\\,$.\n  - Initial scale factor: $\\,a_{\\mathrm{i}} = 0.01\\,$.\n  - Scale-factor grid: $\\,a \\in \\{0.05, 0.1, 0.3, 0.5, 1.0\\}\\,$.\n  - Wave-number grid: $\\,k \\in \\{0.02, 0.05, 0.1, 0.2, 0.3\\}\\,$.\n  - Synthetic parameters: $\\,n_s = 1.0\\,$, $\\,k_{\\mathrm{mnl}} = 0.12\\,$, $\\,\\beta = 1.4\\,$, $\\,\\gamma = 1.1\\,$.\n  - Tolerance: $\\,\\varepsilon = 0.05\\,$.\n- Case $\\,4\\,$ (ΛCDM with strong mildly nonlinear suppression, edge case for breakdown):\n  - Cosmology: $\\,\\Omega_{m0} = 0.3\\,$, $\\,\\Omega_{\\Lambda0} = 0.7\\,$.\n  - Initial scale factor: $\\,a_{\\mathrm{i}} = 0.01\\,$.\n  - Scale-factor grid: $\\,a \\in \\{0.05, 0.1, 0.3, 0.5, 1.0\\}\\,$.\n  - Wave-number grid: $\\,k \\in \\{0.02, 0.05, 0.1, 0.2, 0.3\\}\\,$.\n  - Synthetic parameters: $\\,n_s = 1.0\\,$, $\\,k_{\\mathrm{mnl}} = 0.08\\,$, $\\,\\beta = 1.5\\,$, $\\,\\gamma = 1.0\\,$.\n  - Tolerance: $\\,\\varepsilon = 0.05\\,$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where the entries are the values of $\\,k_{\\max}\\,$ for Cases $\\,1\\,$ through $\\,4\\,$ in order. For example, a valid output line has the form $\\,\\,[k_{\\max,1},k_{\\max,2},k_{\\max,3},k_{\\max,4}]\\,\\,$.", "solution": "The problem posed is a self-contained and scientifically robust exercise in numerical cosmology, requiring the derivation and solution of the linear growth factor equation and its application to a synthetic dataset. The problem is valid, and a full solution is presented below.\n\nOur objective is to determine the breakdown scale of linear perturbation theory by comparing a synthetic, non-linear dataset of Fourier-mode amplitudes to the predictions of linear theory. This involves several steps: establishing the cosmological background, deriving and solving the differential equation for the linear growth of structure, calculating synthetic mode amplitudes, and quantifying the deviation.\n\nFirst, we establish the background cosmology, which is governed by the Friedmann equation. For a homogeneous and isotropic universe containing non-relativistic matter (density parameter $\\Omega_m$), a cosmological constant ($\\Omega_\\Lambda$), and spatial curvature ($\\Omega_k$), the Hubble parameter $H(a) = \\dot{a}/a$ evolves with the scale factor $a$ as:\n$$\nH(a)^2 = H_0^2 \\left( \\Omega_{m0} a^{-3} + \\Omega_{k0} a^{-2} + \\Omega_{\\Lambda0} \\right)\n$$\nwhere $H_0$ is the Hubble constant today (at $a=1$), and the density parameters $\\Omega_{i0}$ are the present-day values. The flatness condition dictates that $\\Omega_{m0} + \\Omega_{\\Lambda0} + \\Omega_{k0} = 1$. It is convenient to define a dimensionless Hubble parameter $E(a) = H(a)/H_0$, such that $E(a)^2 = \\Omega_{m0} a^{-3} + \\Omega_{k0} a^{-2} + \\Omega_{\\Lambda0}$. The matter density parameter as a function of scale factor is given by $\\Omega_m(a) = \\frac{\\rho_m(a)}{\\rho_{crit}(a)} = \\frac{\\Omega_{m0} a^{-3}}{E(a)^2}$.\n\nSecond, we consider the growth of small density perturbations $\\delta(\\mathbf{x}, t) = (\\rho_m(\\mathbf{x}, t) - \\bar{\\rho}_m(t))/\\bar{\\rho}_m(t)$ in this expanding background. In the linear regime, the evolution of the matter density contrast $\\delta$ is described by the second-order ordinary differential equation:\n$$\n\\ddot{\\delta} + 2H(t)\\dot{\\delta} - 4\\pi G \\bar{\\rho}_m(t) \\delta = 0\n$$\nwhere dots denote derivatives with respect to cosmic time $t$, and $\\bar{\\rho}_m(t) = \\bar{\\rho}_{m0} a^{-3}$ is the mean matter density. Using the Friedmann equation, we can express the source term as $4\\pi G \\bar{\\rho}_m = \\frac{3}{2} H_0^2 \\Omega_{m0} a^{-3} = \\frac{3}{2} H(a)^2 \\Omega_m(a)$. The equation for $\\delta$ then becomes:\n$$\n\\ddot{\\delta} + 2H\\dot{\\delta} - \\frac{3}{2}H^2\\Omega_m(a)\\delta = 0\n$$\nSince all Fourier modes grow at the same rate in linear theory, we can write $\\delta(\\mathbf{k}, a) = \\delta_{\\mathrm{in}}(\\mathbf{k}) D(a)$, where $D(a)$ is the linear growth factor. The problem requires us to solve for $D(a)$ using the variable $y = \\ln a$. We perform a change of variables from $t$ to $y$:\n$$\n\\frac{d}{dt} = \\frac{dy}{dt} \\frac{d}{dy} = \\frac{\\dot{a}}{a} \\frac{d}{dy} = H \\frac{d}{dy}\n$$\n$$\n\\frac{d^2}{dt^2} = H \\frac{d}{dy}\\left(H\\frac{d}{dy}\\right) = H^2 \\frac{d^2}{dy^2} + \\left(H \\frac{dH}{dy}\\right) \\frac{d}{dy}\n$$\nSubstituting these into the evolution equation for $D(a)$ (which is the same as for $\\delta$) and dividing by $H^2$ yields:\n$$\nD'' + \\left( 2 + \\frac{1}{H} \\frac{dH}{dy} \\right)D' - \\frac{3}{2}\\Omega_m(a)D = 0\n$$\nwhere primes denote derivatives with respect to $y$. The coefficient of $D'$ can be expressed analytically in terms of the cosmological parameters:\n$$\n2 + \\frac{1}{H} \\frac{dH}{dy} = 2 + \\frac{a}{H} \\frac{dH}{da} = 2 + \\frac{a}{2H^2} \\frac{dH^2}{da} = 2 - \\frac{3\\Omega_{m0}a^{-3} + 2\\Omega_{k0}a^{-2}}{2E(a)^2}\n$$\nThis is the equation we must solve numerically.\n\nThird, we impose initial conditions. The problem specifies that we start deep in the matter-dominated era, at $a_{\\mathrm{i}} = 0.01$. In this epoch, the universe behaves like an Einstein-de Sitter (EdS) model where $\\Omega_m(a) \\approx 1$. For an EdS universe, the ODE for $D(y)$ simplifies to $D'' + \\frac{1}{2}D' - \\frac{3}{2}D = 0$. This equation has two solutions, $D \\propto e^y$ (the growing mode) and $D \\propto e^{-3y/2}$ (the decaying mode). The growing mode corresponds to $D(a) \\propto a$. To isolate this mode, we set the initial conditions for $D(y)$ and its derivative $D'(y)$ to match this behavior. If $D(y) = C e^y$, then $D'(y) = C e^y$, which implies $D'(y) = D(y)$. We can normalize the solution by setting $D(y_i) = 1$ at the initial time $y_i = \\ln a_i$. Consequently, the initial conditions for our numerical integration are $D(y_i) = 1$ and $D'(y_i) = 1$. The resulting solution $D(a)$ is then precisely the dimensionless linear growth ratio $R(a) = D(a)/D(a_{\\mathrm{i}})$ required by the problem.\n\nFourth, we analyze the synthetic data. The synthetic mode amplitude is given by:\n$$\n\\delta_k(a) = \\delta_0(k)\\,R(a)\\,\\frac{1}{1 + \\left(\\frac{k}{k_{\\mathrm{mnl}}}\\right)^{\\beta} \\, [R(a)]^{\\gamma}}\n$$\nWe compute the simulated growth per mode, $G_{\\mathrm{sim}}(k,a) = \\delta_k(a)/\\delta_k(a_{\\mathrm{i}})$. This gives:\n$$\nG_{\\mathrm{sim}}(k,a) = \\frac{\\delta_0(k) R(a) / (1 + (\\frac{k}{k_{\\mathrm{mnl}}})^{\\beta} R(a)^{\\gamma})}{\\delta_0(k) R(a_{\\mathrm{i}}) / (1 + (\\frac{k}{k_{\\mathrm{mnl}}})^{\\beta} R(a_{\\mathrm{i}})^{\\gamma})} = \\frac{R(a)}{R(a_{\\mathrm{i}})} \\frac{1 + (\\frac{k}{k_{\\mathrm{mnl}}})^{\\beta} R(a_{\\mathrm{i}})^{\\gamma}}{1 + (\\frac{k}{k_{\\mathrm{mnl}}})^{\\beta} R(a)^{\\gamma}}\n$$\nSince $R(a)$ is defined as $D(a)/D(a_i)$ and our numerical solution is normalized such that $D(a_i)=1$, we have $R(a_i)=1$. The expression for simulated growth simplifies to:\n$$\nG_{\\mathrm{sim}}(k,a) = R(a) \\frac{1 + (\\frac{k}{k_{\\mathrm{mnl}}})^{\\beta}}{1 + (\\frac{k}{k_{\\mathrm{mnl}}})^{\\beta} R(a)^{\\gamma}}\n$$\nThe relative deviation from linear theory is $\\Delta(k,a) = G_{\\mathrm{sim}}(k,a)/R(a) - 1$. Substituting the expression for $G_{\\mathrm{sim}}$ yields a simplified formula for the deviation:\n$$\n\\Delta(k,a) = \\frac{1 + \\left(\\frac{k}{k_{\\mathrm{mnl}}}\\right)^{\\beta}}{1 + \\left(\\frac{k}{k_{\\mathrm{mnl}}}\\right)^{\\beta} [R(a)]^{\\gamma}} - 1\n$$\nThis expression depends only on $k$, the cosmological model (through $R(a)$), and the synthetic parameters, but not on the initial power spectrum shape $n_s$.\n\nFinally, for each test case, we implement the following procedure:\n1.  Numerically solve the ODE for $D(y)$ with initial conditions $D(y_i)=1, D'(y_i)=1$ to obtain the growth ratio $R(a)$ at the required scale factors.\n2.  For each wave number $k$ in the provided grid, compute $\\Delta(k,a)$ for all scale factors $a$ in the test grid.\n3.  Calculate the maximum absolute deviation $\\max_a |\\Delta(k,a)|$.\n4.  If this maximum deviation is less than or equal to the tolerance $\\varepsilon$, the wave number $k$ is considered to be within the linear regime.\n5.  The final result for the test case, $k_{\\max}$, is the largest wave number from the grid that satisfies this criterion. If no $k$ satisfies it, $k_{\\max}=0.0$.\n\nThis procedure is systematically applied to all test cases provided.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final results.\n    \"\"\"\n    test_cases = [\n        {\n            \"name\": \"Case 1 (ΛCDM)\",\n            \"Omega_m0\": 0.3, \"Omega_L0\": 0.7,\n            \"a_i\": 0.01,\n            \"a_grid\": [0.05, 0.1, 0.3, 0.5, 1.0],\n            \"k_grid\": [0.02, 0.05, 0.1, 0.2, 0.3],\n            \"n_s\": 1.0, \"k_mnl\": 0.15, \"beta\": 1.2, \"gamma\": 1.0,\n            \"epsilon\": 0.05,\n        },\n        {\n            \"name\": \"Case 2 (Einstein-de Sitter)\",\n            \"Omega_m0\": 1.0, \"Omega_L0\": 0.0,\n            \"a_i\": 0.01,\n            \"a_grid\": [0.05, 0.1, 0.3, 0.5, 1.0],\n            \"k_grid\": [0.02, 0.05, 0.1, 0.2, 0.3],\n            \"n_s\": 1.0, \"k_mnl\": 0.30, \"beta\": 1.0, \"gamma\": 1.0,\n            \"epsilon\": 0.05,\n        },\n        {\n            \"name\": \"Case 3 (Open Universe)\",\n            \"Omega_m0\": 0.3, \"Omega_L0\": 0.0,\n            \"a_i\": 0.01,\n            \"a_grid\": [0.05, 0.1, 0.3, 0.5, 1.0],\n            \"k_grid\": [0.02, 0.05, 0.1, 0.2, 0.3],\n            \"n_s\": 1.0, \"k_mnl\": 0.12, \"beta\": 1.4, \"gamma\": 1.1,\n            \"epsilon\": 0.05,\n        },\n        {\n            \"name\": \"Case 4 (ΛCDM, strong suppression)\",\n            \"Omega_m0\": 0.3, \"Omega_L0\": 0.7,\n            \"a_i\": 0.01,\n            \"a_grid\": [0.05, 0.1, 0.3, 0.5, 1.0],\n            \"k_grid\": [0.02, 0.05, 0.1, 0.2, 0.3],\n            \"n_s\": 1.0, \"k_mnl\": 0.08, \"beta\": 1.5, \"gamma\": 1.0,\n            \"epsilon\": 0.05,\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        k_max = process_case(case)\n        results.append(k_max)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef process_case(case_params):\n    \"\"\"\n    Processes a single test case: solves the growth factor ODE and finds k_max.\n    \"\"\"\n    # Unpack parameters from the dictionary\n    Omega_m0 = case_params[\"Omega_m0\"]\n    Omega_L0 = case_params[\"Omega_L0\"]\n    a_i = case_params[\"a_i\"]\n    a_grid = np.array(case_params[\"a_grid\"])\n    k_grid = np.array(case_params[\"k_grid\"])\n    k_mnl = case_params[\"k_mnl\"]\n    beta = case_params[\"beta\"]\n    gamma = case_params[\"gamma\"]\n    epsilon = case_params[\"epsilon\"]\n\n    Omega_k0 = 1.0 - Omega_m0 - Omega_L0\n\n    def growth_ode_system(y, Y, Omega_m0, Omega_k0, Omega_L0):\n        \"\"\"\n        Defines the system of first-order ODEs for the growth factor D(y).\n        y = ln(a)\n        Y = [D, D']\n        \"\"\"\n        D, D_prime = Y\n        a = np.exp(y)\n\n        # Dimensionless Hubble parameter squared E(a)^2 = H(a)^2 / H_0^2\n        E2 = Omega_m0 * a**(-3) + Omega_k0 * a**(-2) + Omega_L0\n        if E2 = 0:\n            # This should not be reached for physical cosmologies with a  0\n            return [np.nan, np.nan]\n\n        # Matter density parameter at scale factor a\n        Omega_m_a = (Omega_m0 * a**-3) / E2\n        \n        # Coefficient of the D' term in the ODE for D(y)\n        # coeff = 2 + (1/H) * dH/dy\n        coeff_D_prime = 2.0 - (3.0 * Omega_m0 * a**-3 + 2.0 * Omega_k0 * a**-2) / (2.0 * E2)\n\n        # Second derivative of D with respect to y\n        # D'' = (3/2)*Omega_m(a)*D - coeff*D'\n        D_double_prime = 1.5 * Omega_m_a * D - coeff_D_prime * D_prime\n        \n        return [D_prime, D_double_prime]\n\n    # Define the scale factor points for evaluation, including the initial point\n    a_eval_points = np.sort(np.unique(np.insert(a_grid, 0, a_i)))\n    y_eval_points = np.log(a_eval_points)\n    \n    # Set initial conditions for the growing mode in the matter-dominated era\n    y_i = np.log(a_i)\n    # D(a_i) = 1 (normalization), D'(a_i) = dD/d(lna)|_i = 1 (growing mode)\n    Y0 = [1.0, 1.0]\n\n    # Numerically integrate the ODE system\n    sol = solve_ivp(\n        growth_ode_system,\n        (y_eval_points[0], y_eval_points[-1]),\n        Y0,\n        t_eval=y_eval_points,\n        args=(Omega_m0, Omega_k0, Omega_L0),\n        method='RK45',\n        rtol=1e-8,\n        atol=1e-8\n    )\n\n    # The solution D(a) is the growth ratio R(a) due to our normalization D(a_i)=1\n    R_values = sol.y[0]\n    R_map = {a: R for a, R in zip(a_eval_points, R_values)}\n\n    # Determine k_max by analyzing deviation from linear theory\n    valid_ks = []\n    for k in k_grid:\n        deviations = []\n        for a_val in a_grid:\n            R_a = R_map[a_val]\n            \n            # Simplified formula for deviation: Delta(k,a) = G_sim/R - 1\n            # G_sim/R = (1 + (k/kmnl)^beta) / (1 + (k/kmnl)^beta * R(a)^gamma)\n            term = (k / k_mnl)**beta\n            deviation = (1.0 + term) / (1.0 + term * R_a**gamma) - 1.0\n            deviations.append(deviation)\n        \n        max_abs_deviation = np.max(np.abs(deviations))\n        \n        if max_abs_deviation = epsilon:\n            valid_ks.append(k)\n\n    k_max = max(valid_ks) if valid_ks else 0.0\n    return k_max\n\nsolve()\n```", "id": "3496921"}]}