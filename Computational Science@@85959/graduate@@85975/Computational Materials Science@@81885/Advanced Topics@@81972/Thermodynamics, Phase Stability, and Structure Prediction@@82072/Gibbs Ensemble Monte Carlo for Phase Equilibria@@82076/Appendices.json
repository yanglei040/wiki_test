{"hands_on_practices": [{"introduction": "In computational simulations, intermolecular potentials are typically truncated at a cutoff distance to manage computational cost. This practice addresses the critical issue of correcting for this truncation. You will derive and quantify the systematic errors, or biases, in pressure and chemical potential that arise in a Gibbs Ensemble Monte Carlo (GEMC) simulation when these corrections are ignored, providing a foundational understanding of how to obtain accurate phase coexistence properties. [@problem_id:3454569]", "problem": "Consider a two-phase Gibbs Ensemble Monte Carlo (GEMC) simulation of a single-component fluid interacting via the Lennard–Jones pair potential. The Lennard–Jones potential is defined by $u(r) = 4\\epsilon\\left[\\left(\\dfrac{\\sigma}{r}\\right)^{12} - \\left(\\dfrac{\\sigma}{r}\\right)^6\\right]$, where $\\epsilon$ sets the energy scale and $\\sigma$ sets the length scale. In practical simulations, the potential is truncated at a cutoff $r_c$, and long-range corrections are often added to compensate for the neglected contributions from $r>r_c$. In this problem, you will quantify the bias in coexistence properties when long-range corrections are omitted, by deriving and implementing tail corrections for two boxes with number densities $\\rho_1$ and $\\rho_2$.\n\nStarting from the following well-tested, fundamental formulas for a uniform fluid with radial distribution function $g(r)=1$ beyond the cutoff distance $r_c$:\n- The potential energy per unit volume is given by $U/V = \\dfrac{1}{2}\\rho^2 \\int u(r)\\, 4\\pi r^2\\,dr$.\n- The virial contribution to pressure is given by $P_{\\text{vir}} = -\\dfrac{2\\pi}{3}\\rho^2 \\int r^3\\dfrac{du}{dr}\\,dr$.\n- The excess chemical potential in the Widom insertion picture is given by $\\mu_{\\text{ex}} = -k_{\\text{B}}T\\ln\\left\\langle e^{-\\Delta U/k_{\\text{B}}T}\\right\\rangle$; in a mean-field approximation for the tail beyond $r_c$, the insertion energy contribution simplifies to the uniform integral of $u(r)$ against $4\\pi r^2$ weighted by $\\rho$.\n\nYour tasks:\n1. Derive the tail correction to the potential energy per unit volume, $U_{\\text{tail}}/V$, as the contribution from $r\\in[r_c,\\infty)$ assuming $g(r)=1$ in that range. Express it in terms of $\\rho$, $\\epsilon$, $\\sigma$, and $r_c$.\n2. Derive the tail correction to the pressure, $P_{\\text{tail}}$, from the virial expression for $r\\in[r_c,\\infty)$ assuming $g(r)=1$.\n3. Derive the tail correction to the excess chemical potential, $\\mu_{\\text{tail}}$, by considering the mean-field insertion energy of a test particle with particles beyond $r_c$ in a uniform fluid of density $\\rho$.\n4. Explain how, in GEMC, equalization of truncated (uncorrected) pressure and truncated (uncorrected) chemical potential across boxes implies that the true pressure and true chemical potential will differ by the difference in tail corrections. Define the coexistence biases as $\\Delta P_{\\text{bias}} = P_{\\text{tail}}(\\rho_1) - P_{\\text{tail}}(\\rho_2)$ and $\\Delta \\mu_{\\text{bias}} = \\mu_{\\text{tail}}(\\rho_1) - \\mu_{\\text{tail}}(\\rho_2)$.\n5. Implement a program that, for each test case, computes the tail energy per unit volume in each box and the coexistence biases $\\Delta P_{\\text{bias}}$ and $\\Delta \\mu_{\\text{bias}}$ using your derived formulas. All quantities must be reported in reduced Lennard–Jones units based on the provided $\\epsilon$ and $\\sigma$ values (i.e., energies in units of $\\epsilon$, lengths in units of $\\sigma$, densities in units of $\\sigma^{-3}$). No angles or percentages are involved.\n\nTest suite (each case specifies $(\\epsilon,\\sigma,r_c,\\rho_1,\\rho_2)$):\n- Case A: $(\\epsilon, \\sigma, r_c, \\rho_1, \\rho_2) = (1, 1, 2.5, 0.8, 0.02)$.\n- Case B: $(\\epsilon, \\sigma, r_c, \\rho_1, \\rho_2) = (1, 1, 5.0, 0.7, 0.02)$.\n- Case C (boundary, equal densities): $(\\epsilon, \\sigma, r_c, \\rho_1, \\rho_2) = (1, 1, 2.5, 0.5, 0.5)$.\n- Case D (short cutoff, stronger bias): $(\\epsilon, \\sigma, r_c, \\rho_1, \\rho_2) = (1, 1, 1.5, 0.85, 0.01)$.\n\nFor each test case, your program must output a list of four floats:\n- $U_{\\text{tail}}(\\rho_1)/V$,\n- $U_{\\text{tail}}(\\rho_2)/V$,\n- $\\Delta P_{\\text{bias}}$,\n- $\\Delta \\mu_{\\text{bias}}$.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a list of the four floats specified above (e.g., $[[x_{A1},x_{A2},x_{A3},x_{A4}],[x_{B1},x_{B2},x_{B3},x_{B4}],\\dots]$).", "solution": "The problem statement is subjected to validation before a solution is attempted.\n\n### Step 1: Extract Givens\n- **System**: A two-phase Gibbs Ensemble Monte Carlo (GEMC) simulation of a single-component fluid.\n- **Interaction Potential**: Lennard–Jones potential, $u(r) = 4\\epsilon\\left[\\left(\\dfrac{\\sigma}{r}\\right)^{12} - \\left(\\dfrac{\\sigma}{r}\\right)^6\\right]$.\n- **Parameters**: $\\epsilon$ (energy scale), $\\sigma$ (length scale).\n- **Simulation Protocol**: The potential is truncated at a cutoff distance $r_c$.\n- **Objective**: Quantify the bias in coexistence properties when long-range corrections are omitted for two boxes with number densities $\\rho_1$ and $\\rho_2$.\n- **Approximation**: The radial distribution function $g(r)=1$ for distances $r > r_c$.\n- **Fundamental Formulas**:\n    - Potential energy per unit volume: $U/V = \\dfrac{1}{2}\\rho^2 \\int u(r)\\, 4\\pi r^2\\,dr$.\n    - Virial contribution to pressure: $P_{\\text{vir}} = -\\dfrac{2\\pi}{3}\\rho^2 \\int r^3\\dfrac{du}{dr}\\,dr$.\n    - Excess chemical potential (mean-field tail): The insertion energy contribution is the uniform integral of $u(r)$ against $4\\pi r^2$ weighted by the density $\\rho$.\n- **Tasks**:\n    1. Derive the tail correction to the potential energy per unit volume, $U_{\\text{tail}}/V$.\n    2. Derive the tail correction to the pressure, $P_{\\text{tail}}$.\n    3. Derive the tail correction to the excess chemical potential, $\\mu_{\\text{tail}}$.\n    4. Explain the origin of coexistence biases $\\Delta P_{\\text{bias}}$ and $\\Delta \\mu_{\\text{bias}}$ in GEMC.\n    5. Implement a program to compute $U_{\\text{tail}}(\\rho_1)/V$, $U_{\\text{tail}}(\\rho_2)/V$, $\\Delta P_{\\text{bias}}$, and $\\Delta \\mu_{\\text{bias}}$.\n- **Units**: All quantities are to be in reduced Lennard–Jones units based on $\\epsilon$ and $\\sigma$.\n- **Test Cases**:\n    - Case A: $(\\epsilon, \\sigma, r_c, \\rho_1, \\rho_2) = (1, 1, 2.5, 0.8, 0.02)$.\n    - Case B: $(\\epsilon, \\sigma, r_c, \\rho_1, \\rho_2) = (1, 1, 5.0, 0.7, 0.02)$.\n    - Case C: $(\\epsilon, \\sigma, r_c, \\rho_1, \\rho_2) = (1, 1, 2.5, 0.5, 0.5)$.\n    - Case D: $(\\epsilon, \\sigma, r_c, \\rho_1, \\rho_2) = (1, 1, 1.5, 0.85, 0.01)$.\n- **Output Format**: A single line containing a list of lists of four floats for each test case: $[[U_{\\text{tail}}(\\rho_1)/V, U_{\\text{tail}}(\\rho_2)/V, \\Delta P_{\\text{bias}}, \\Delta \\mu_{\\text{bias}}]_{\\text{A}}, \\dots]$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated against the validation criteria:\n- **Scientifically Grounded**: The problem is a standard exercise in statistical mechanics and computational physics. It deals with Lennard-Jones fluids, Gibbs ensemble simulations, and the derivation of long-range corrections, all of which are fundamental and well-established concepts. The assumption $g(r)=1$ for $r > r_c$ is the standard mean-field approximation for these derivations.\n- **Well-Posed**: The problem is clearly specified. It asks for derivations of specific physical quantities and their subsequent numerical calculation for a given set of parameters. The tasks are unambiguous and lead to a unique solution.\n- **Objective**: The language is technical and precise, free from any subjective or biased statements.\n- **Flaw Check**: The problem does not violate any of the invalidity criteria. It is scientifically sound, formalizable, complete, and poses a non-trivial but solvable challenge in computational science.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A step-by-step solution will be provided.\n\n---\n\nThe derivations will be performed using reduced Lennard-Jones units, where energy is expressed in units of $\\epsilon$, length in units of $\\sigma$, density $\\rho^*$ in units of $\\sigma^{-3}$, and so on. The test cases provide $\\epsilon=1$ and $\\sigma=1$, so the given numerical values for $r_c$ and $\\rho$ are already in the appropriate reduced units. For conciseness, the asterisk symbol on reduced quantities will be omitted. The reduced Lennard-Jones potential is:\n$$\nu(r) = 4\\left(r^{-12} - r^{-6}\\right)\n$$\n\n**1. Derivation of the Tail Correction to Potential Energy, $U_{\\text{tail}}/V$**\n\nThe tail correction to the potential energy per unit volume is the contribution from interactions at distances $r \\in [r_c, \\infty)$. Using the provided formula and the assumption that $g(r)=1$ in this range:\n$$\n\\frac{U_{\\text{tail}}}{V} = \\frac{1}{2}\\rho^2 \\int_{r_c}^{\\infty} u(r) \\, 4\\pi r^2 \\, dr\n$$\nSubstituting the Lennard-Jones potential:\n$$\n\\frac{U_{\\text{tail}}}{V} = \\frac{1}{2}\\rho^2 \\int_{r_c}^{\\infty} 4\\left(r^{-12} - r^{-6}\\right) \\, 4\\pi r^2 \\, dr = 8\\pi\\rho^2 \\int_{r_c}^{\\infty} \\left(r^{-10} - r^{-4}\\right) \\, dr\n$$\nPerforming the integration:\n$$\n\\int \\left(r^{-10} - r^{-4}\\right) \\, dr = \\frac{r^{-9}}{-9} - \\frac{r^{-3}}{-3} = -\\frac{1}{9}r^{-9} + \\frac{1}{3}r^{-3}\n$$\nEvaluating the definite integral from $r_c$ to $\\infty$:\n$$\n\\left[-\\frac{1}{9}r^{-9} + \\frac{1}{3}r^{-3}\\right]_{r_c}^{\\infty} = (0 - 0) - \\left(-\\frac{1}{9}r_c^{-9} + \\frac{1}{3}r_c^{-3}\\right) = \\frac{1}{9}r_c^{-9} - \\frac{1}{3}r_c^{-3}\n$$\nThus, the final expression for the tail correction to the potential energy per unit volume is:\n$$\n\\frac{U_{\\text{tail}}}{V}(\\rho, r_c) = 8\\pi\\rho^2 \\left(\\frac{1}{9r_c^9} - \\frac{1}{3r_c^3}\\right)\n$$\n\n**2. Derivation of the Tail Correction to Pressure, $P_{\\text{tail}}$**\n\nThe tail correction to the pressure arises from the virial contribution for $r \\in [r_c, \\infty)$. First, we find the derivative of the potential:\n$$\n\\frac{du}{dr} = 4\\left(-12r^{-13} + 6r^{-7}\\right)\n$$\nThe tail contribution to the pressure is then:\n$$\nP_{\\text{tail}} = -\\frac{2\\pi}{3}\\rho^2 \\int_{r_c}^{\\infty} r^3 \\frac{du}{dr} \\, dr = -\\frac{2\\pi}{3}\\rho^2 \\int_{r_c}^{\\infty} r^3 \\cdot 4\\left(-12r^{-13} + 6r^{-7}\\right) \\, dr\n$$\n$$\nP_{\\text{tail}} = -\\frac{8\\pi}{3}\\rho^2 \\int_{r_c}^{\\infty} \\left(-12r^{-10} + 6r^{-4}\\right) \\, dr\n$$\nIntegrating the expression:\n$$\n\\int \\left(-12r^{-10} + 6r^{-4}\\right) \\, dr = -12\\frac{r^{-9}}{-9} + 6\\frac{r^{-3}}{-3} = \\frac{4}{3}r^{-9} - 2r^{-3}\n$$\nEvaluating the definite integral:\n$$\n\\left[\\frac{4}{3}r^{-9} - 2r^{-3}\\right]_{r_c}^{\\infty} = (0 - 0) - \\left(\\frac{4}{3}r_c^{-9} - 2r_c^{-3}\\right) = 2r_c^{-3} - \\frac{4}{3}r_c^{-9}\n$$\nSubstituting this back, the tail correction to pressure is:\n$$\nP_{\\text{tail}}(\\rho, r_c) = -\\frac{8\\pi}{3}\\rho^2 \\left(2r_c^{-3} - \\frac{4}{3}r_c^{-9}\\right) = \\frac{32\\pi}{9}\\rho^2 r_c^{-9} - \\frac{16\\pi}{3}\\rho^2 r_c^{-3}\n$$\n\n**3. Derivation of the Tail Correction to Chemical Potential, $\\mu_{\\text{tail}}$**\n\nThe tail correction to the excess chemical potential corresponds to the interaction energy of a single test particle with all other particles in the system beyond $r_c$, assuming a uniform density $\\rho$.\n$$\n\\mu_{\\text{tail}} = \\int_{r_c}^{\\infty} u(r) \\rho g(r) \\, 4\\pi r^2 \\, dr\n$$\nWith $g(r)=1$:\n$$\n\\mu_{\\text{tail}} = \\rho \\int_{r_c}^{\\infty} u(r) \\, 4\\pi r^2 \\, dr\n$$\nThis integral is related to the one performed for the energy correction. Specifically, $\\mu_{\\text{tail}} = \\dfrac{2}{\\rho} \\left( \\dfrac{U_{\\text{tail}}}{V} \\right)$. Using the result from Task 1:\n$$\n\\int_{r_c}^{\\infty} u(r) \\, 4\\pi r^2 \\, dr = 8\\pi \\left(\\frac{1}{9r_c^9} - \\frac{1}{3r_c^3}\\right)\n$$\nTherefore, the tail correction to the excess chemical potential is:\n$$\n\\mu_{\\text{tail}}(\\rho, r_c) = 8\\pi\\rho \\left(\\frac{1}{9r_c^9} - \\frac{1}{3r_c^3}\\right)\n$$\nNote that the problem asks for $\\mu_{tail}$ for the insertion energy, which, as derived from the Widom test particle method in the mean-field approximation, is $2 \\times (U_{excess}/N)$. The derived formula is actually for $U_{excess}/N$ as the statement refers to the \"insertion energy contribution (...) simplified to the uniform integral\". The standard definition of the tail contribution to the excess chemical potential is actually twice the tail contribution to the excess energy per particle.\n$$\n\\mu_{\\text{tail}} = \\rho \\int_{r_c}^\\infty u(r) 4 \\pi r^2 dr = 2 \\left( \\frac{1}{2} \\rho \\int_{r_c}^\\infty u(r) 4 \\pi r^2 dr \\right) = 2 \\frac{U_{\\text{tail, per particle}}}{1}\n$$\nThe integral expression from the problem implies a tail energy, and in the context of chemical potential a factor of $2$ is standard.\nSo, $\\mu_{\\text{tail}}$ is $2 \\times$ (the interaction energy of one particle). The interaction of one particle with the mean-field fluid is $\\rho \\int u(r) 4\\pi r^2 dr$.\n$$\n\\mu_{\\text{tail}}(\\rho, r_c) = \\rho \\int_{r_c}^{\\infty} 4\\left(r^{-12} - r^{-6}\\right) 4\\pi r^2 dr = 16\\pi\\rho \\int_{r_c}^{\\infty} \\left(r^{-10} - r^{-4}\\right) dr\n$$\nUsing the previous integral result:\n$$\n\\mu_{\\text{tail}}(\\rho, r_c) = 16\\pi\\rho \\left(\\frac{1}{9r_c^9} - \\frac{1}{3r_c^3}\\right)\n$$\n\n**4. Coexistence Biases in GEMC**\n\nIn a GEMC simulation, equilibrium between two phases (e.g., liquid in box $1$, vapor in box $2$) requires equality of temperature, pressure, and chemical potential: $T_1=T_2$, $P_1=P_2$, and $\\mu_1=\\mu_2$. The simulation algorithm enforces these conditions.\nWhen using a truncated potential without long-range corrections, the algorithm actually equalizes the *truncated* properties, which are the properties calculated from the potential only for $r \\le r_c$. Let these be $P_{\\text{trunc}}$ and $\\mu_{\\text{trunc}}$. So, at convergence, the simulation establishes:\n$$\nP_{1, \\text{trunc}} = P_{2, \\text{trunc}} \\quad \\text{and} \\quad \\mu_{1, \\text{trunc}} = \\mu_{2, \\text{trunc}}\n$$\nThe true physical properties are the sum of the truncated part and the tail correction:\n$$\nP_{\\text{true}}(\\rho) = P_{\\text{trunc}}(\\rho) + P_{\\text{tail}}(\\rho)\n$$\n$$\n\\mu_{\\text{true}}(\\rho) = \\mu_{\\text{trunc}}(\\rho) + \\mu_{\\text{tail}}(\\rho)\n$$\nThe difference in the *true* pressures between the two boxes is therefore:\n$$\n\\Delta P = P_{1, \\text{true}} - P_{2, \\text{true}} = \\left(P_{1, \\text{trunc}} + P_{\\text{tail}}(\\rho_1)\\right) - \\left(P_{2, \\text{trunc}} + P_{\\text{tail}}(\\rho_2)\\right)\n$$\nSince $P_{1, \\text{trunc}} = P_{2, \\text{trunc}}$, this simplifies to the pressure bias:\n$$\n\\Delta P_{\\text{bias}} = P_{\\text{tail}}(\\rho_1) - P_{\\text{tail}}(\\rho_2)\n$$\nSimilarly, the difference in the *true* chemical potentials is:\n$$\n\\Delta \\mu = \\mu_{1, \\text{true}} - \\mu_{2, \\text{true}} = \\left(\\mu_{1, \\text{trunc}} + \\mu_{\\text{tail}}(\\rho_1)\\right) - \\left(\\mu_{2, \\text{trunc}} + \\mu_{\\text{tail}}(\\rho_2)\\right)\n$$\nSince $\\mu_{1, \\text{trunc}} = \\mu_{2, \\text{trunc}}$, this simplifies to the chemical potential bias:\n$$\n\\Delta \\mu_{\\text{bias}} = \\mu_{\\text{tail}}(\\rho_1) - \\mu_{\\text{tail}}(\\rho_2)\n$$\nBecause the tail corrections $P_{\\text{tail}}$ and $\\mu_{\\text{tail}}$ are functions of density ($\\rho^2$ and $\\rho$, respectively), and the coexisting phases have different densities ($\\rho_1 \\neq \\rho_2$), the tail corrections are unequal. This results in a systematic error, or bias, where the simulated system does not achieve true mechanical and chemical equilibrium.\n\n**5. Implementation**\nThe following Python code implements the derived formulas and computes the required quantities for the given test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef u_tail_per_v(rho, rc):\n    \"\"\"\n    Calculates the tail correction to the potential energy per unit volume\n    in reduced Lennard-Jones units.\n    Formula: U_tail/V = 8 * pi * rho^2 * (1/9 * rc^-9 - 1/3 * rc^-3)\n    \"\"\"\n    rc_inv3 = 1.0 / (rc**3)\n    rc_inv9 = 1.0 / (rc**9)\n    return 8.0 * np.pi * rho**2 * (rc_inv9 / 9.0 - rc_inv3 / 3.0)\n\ndef p_tail(rho, rc):\n    \"\"\"\n    Calculates the tail correction to the pressure in reduced\n    Lennard-Jones units.\n    Formula: P_tail = (32*pi/9 * rc^-9 - 16*pi/3 * rc^-3) * rho^2\n    \"\"\"\n    rc_inv3 = 1.0 / (rc**3)\n    rc_inv9 = 1.0 / (rc**9)\n    term1 = (32.0 * np.pi / 9.0) * rc_inv9\n    term2 = -(16.0 * np.pi / 3.0) * rc_inv3\n    return (term1 + term2) * rho**2\n\ndef mu_tail(rho, rc):\n    \"\"\"\n    Calculates the tail correction to the excess chemical potential in\n    reduced Lennard-Jones units.\n    Formula: mu_tail = 16 * pi * rho * (1/9 * rc^-9 - 1/3 * rc^-3)\n    \"\"\"\n    rc_inv3 = 1.0 / (rc**3)\n    rc_inv9 = 1.0 / (rc**9)\n    return 16.0 * np.pi * rho * (rc_inv9 / 9.0 - rc_inv3 / 3.0)\n\ndef solve():\n    \"\"\"\n    Solves the problem for all test cases and prints the results in the\n    specified format.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (epsilon, sigma, r_c, rho_1, rho_2)\n    # Since epsilon and sigma are 1, parameters are already in reduced units.\n    test_cases = [\n        (1, 1, 2.5, 0.8, 0.02),\n        (1, 1, 5.0, 0.7, 0.02),\n        (1, 1, 2.5, 0.5, 0.5),\n        (1, 1, 1.5, 0.85, 0.01),\n    ]\n\n    results = []\n    for case in test_cases:\n        epsilon, sigma, rc, rho1, rho2 = case\n\n        # Calculate the tail energy per unit volume for each box\n        U_tail_V1 = u_tail_per_v(rho1, rc)\n        U_tail_V2 = u_tail_per_v(rho2, rc)\n\n        # Calculate the tail pressure for each box\n        P_tail1 = p_tail(rho1, rc)\n        P_tail2 = p_tail(rho2, rc)\n        # The pressure bias is the difference in tail corrections\n        delta_P_bias = P_tail1 - P_tail2\n\n        # Calculate the tail chemical potential for each box\n        mu_tail1 = mu_tail(rho1, rc)\n        mu_tail2 = mu_tail(rho2, rc)\n        # The chemical potential bias is the difference in tail corrections\n        delta_mu_bias = mu_tail1 - mu_tail2\n\n        case_results = [U_tail_V1, U_tail_V2, delta_P_bias, delta_mu_bias]\n        results.append(case_results)\n\n    # Final print statement in the exact required format.\n    # [[val_A1, val_A2, ...], [val_B1, val_B2, ...], ...]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3454569"}, {"introduction": "Beyond single-component systems, GEMC is a powerful tool for mapping the rich phase diagrams of mixtures. This exercise introduces the semigrand canonical ensemble, an efficient variant for simulating mixture equilibria by fixing the chemical potential difference, $\\Delta\\mu = \\mu_B - \\mu_A$. You will derive the acceptance probability for the crucial identity-swap move from first principles and then apply the macroscopic thermodynamic consequences to detect an azeotrope, a key feature of non-ideal mixture behavior. [@problem_id:3454556]", "problem": "You are to write a complete, runnable program that detects an azeotrope in a binary mixture using a semigrand Gibbs ensemble based on a mean-field regular solution model. Your tasks are: derive the identity-swap move acceptance probability from first principles and implement a numerical solver to map tie-lines in the composition–temperature plane and detect the azeotrope if it exists.\n\nBegin from the following fundamental base:\n- The Boltzmann distribution in the grand canonical and semigrand ensembles. The probability weight of a microstate with energy $U$, number of species $A$ equal to $N_A$, number of species $B$ equal to $N_B$, temperature $T$, and chemical potentials $\\mu_A$ and $\\mu_B$ is proportional to $\\exp\\left(-\\beta U + \\beta \\mu_A N_A + \\beta \\mu_B N_B\\right)$, where $\\beta = 1/(k_B T)$ and $k_B$ is Boltzmann’s constant.\n- Detailed balance for Monte Carlo moves: the acceptance probability $p_{\\mathrm{acc}}$ must be chosen so that the Markov chain with transition probabilities $T(i \\to j)$ has the Boltzmann stationary distribution.\n- The mean-field regular solution free energy per particle in box $i$ at temperature $T$ and mole fraction $x_B$ is modeled as\n$$\nf_i(x_B,T) = k_B T\\left[x_B \\ln x_B + (1-x_B)\\ln(1-x_B)\\right] + \\frac{z_i}{2}\\left[x_B^2 \\varepsilon_{BB} + (1-x_B)^2 \\varepsilon_{AA} + 2 x_B (1-x_B) \\varepsilon_{AB}\\right],\n$$\nwhere $z_i$ is an effective coordination number in box $i$ proportional to the density, and $\\varepsilon_{AA}$, $\\varepsilon_{BB}$, and $\\varepsilon_{AB}$ are interaction energy parameters.\n\nYour derivation must obtain the identity-swap acceptance probability for toggling the identity of one chosen particle in a semigrand Gibbs ensemble with fixed chemical potential difference $\\Delta \\mu = \\mu_B - \\mu_A$:\n$$\np_{\\mathrm{acc}} = \\min\\left[1, \\exp\\left(-\\beta \\Delta U + \\beta \\Delta \\mu \\, \\Delta N_B\\right)\\right],\n$$\nwhere $\\Delta U$ is the energy change and $\\Delta N_B$ is the change in the number of species $B$ in the box due to the identity swap.\n\nFor the computational task, consider two boxes representing two coexisting phases (liquid-like and vapor-like) at the same temperature $T$. The densities in the two boxes follow a mean-field coexistence relation around a critical temperature $T_c$:\n$$\n\\rho_L(T) = \\rho_c + \\rho_0 \\sqrt{\\max\\left(0, 1 - \\frac{T}{T_c}\\right)}, \\quad \\rho_V(T) = \\rho_c - \\rho_0 \\sqrt{\\max\\left(0, 1 - \\frac{T}{T_c}\\right)}.\n$$\nThe effective coordination numbers are $z_L(T) = z_0 \\rho_L(T)$ and $z_V(T) = z_0 \\rho_V(T)$, where $z_0$ is a constant. In the semigrand description with constant chemical potential difference $\\Delta \\mu$, the equilibrium composition in box $i$ at temperature $T$ is obtained by solving\n$$\n\\frac{\\partial f_i}{\\partial x_B}(x_B,T) = \\Delta \\mu,\n$$\ni.e.,\n$$\nk_B T \\ln \\frac{x_B}{1-x_B} + z_i(T) \\left[x_B \\varepsilon_{BB} - (1-x_B)\\varepsilon_{AA} + (1-2x_B)\\varepsilon_{AB}\\right] = \\Delta \\mu.\n$$\nAt a given $T$, this equation defines $x_B^{(L)}(T)$ and $x_B^{(V)}(T)$ for the two boxes. A tie-line at temperature $T$ is the pair $\\{x_B^{(L)}(T), x_B^{(V)}(T)\\}$. An azeotrope occurs at a temperature where $x_B^{(L)}(T) = x_B^{(V)}(T)$.\n\nYour program should:\n- Implement a function that, for given parameters and a list of temperatures, solves the equilibrium equation in each box to obtain $x_B^{(L)}(T)$ and $x_B^{(V)}(T)$ across the temperature grid.\n- Detect an azeotrope by finding a temperature $T$ where the absolute difference $\\left|x_B^{(L)}(T) - x_B^{(V)}(T)\\right|$ is minimized and falls below a tolerance $\\tau$. Report the azeotrope temperature $T_{\\mathrm{az}}$ and composition $x_{B,\\mathrm{az}} = \\frac{1}{2}\\left[x_B^{(L)}(T_{\\mathrm{az}}) + x_B^{(V)}(T_{\\mathrm{az}})\\right]$. If no such temperature exists within the grid, return a sentinel indicating no azeotrope found.\n- All temperatures and energies are in reduced units with $k_B = 1$; express all outputs in reduced temperature units and mole fraction as dimensionless decimals. Round all outputs to three decimal places.\n\nTest suite:\n- Case $1$ (general coexistence): $\\varepsilon_{AA} = -1.0$, $\\varepsilon_{BB} = -0.5$, $\\varepsilon_{AB} = -0.7$, $z_0 = 6.0$, $\\rho_c = 0.5$, $\\rho_0 = 0.4$, $T_c = 1.5$, $\\Delta \\mu = 0.0$, temperature grid $\\{0.6, 0.8, 1.0, 1.2, 1.4\\}$, tolerance $\\tau = 0.02$.\n- Case $2$ (degenerate symmetric interactions, boundary-like behavior): $\\varepsilon_{AA} = -0.8$, $\\varepsilon_{BB} = -0.8$, $\\varepsilon_{AB} = -0.8$, $z_0 = 6.0$, $\\rho_c = 0.5$, $\\rho_0 = 0.4$, $T_c = 1.5$, $\\Delta \\mu = 0.0$, temperature grid $\\{0.6, 0.8, 1.0, 1.2, 1.4\\}$, tolerance $\\tau = 0.02$.\n- Case $3$ (no azeotrope due to biased chemical potential difference): $\\varepsilon_{AA} = -1.0$, $\\varepsilon_{BB} = -0.5$, $\\varepsilon_{AB} = -0.7$, $z_0 = 6.0$, $\\rho_c = 0.5$, $\\rho_0 = 0.4$, $T_c = 1.5$, $\\Delta \\mu = 0.4$, temperature grid $\\{0.6, 0.8, 1.0, 1.2, 1.4\\}$, tolerance $\\tau = 0.02$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case’s result must be a two-element list $[T_{\\mathrm{az}}, x_{B,\\mathrm{az}}]$ if detected, otherwise $[-1.0,-1.0]$. For example, an output might look like $[[0.800,0.500],[-1.000,-1.000],[1.200,0.470]]$.", "solution": "The problem presents two distinct but related tasks. The first is a theoretical derivation of the acceptance probability for an identity-swap Monte Carlo move in a semigrand ensemble. The second is a computational task to find azeotropes in a binary mixture using a mean-field thermodynamic model derived from this framework.\n\n### Part 1: Derivation of the Identity-Swap Acceptance Probability\n\nWe begin with the fundamental statistical mechanical description of the system. The problem specifies a semigrand ensemble where the temperature $T$, total number of particles $N = N_A + N_B$, and volume $V$ are fixed, along with the chemical potential difference $\\Delta\\mu = \\mu_B - \\mu_A$. The probability $\\pi$ of a microstate with energy $U$ and composition $(N_A, N_B)$ is given by the Boltzmann distribution for this ensemble.\n\nIn the grand canonical ensemble, the probability of a state is proportional to $\\exp(-\\beta U + \\beta\\mu_A N_A + \\beta\\mu_B N_B)$, where $\\beta = 1/(k_B T)$. We can rewrite the exponent using the specified constraints:\n$$\n-\\beta U + \\beta\\mu_A N_A + \\beta\\mu_B N_B = -\\beta U + \\beta\\mu_A N_A + \\beta(\\mu_A + \\Delta\\mu) N_B\n$$\n$$\n= -\\beta U + \\beta\\mu_A (N_A + N_B) + \\beta\\Delta\\mu N_B\n$$\nSince the total number of particles $N = N_A + N_B$ is fixed, the term $\\beta\\mu_A N$ is a constant for all states accessible through identity-swap moves. Therefore, this term can be absorbed into the normalization constant of the probability distribution. The statistical weight of a microstate is thus proportional to:\n$$\n\\pi(U, N_B) \\propto \\exp(-\\beta U + \\beta\\Delta\\mu N_B)\n$$\nThis is the stationary distribution that a valid Monte Carlo simulation must sample.\n\nAn identity-swap move consists of changing a particle of species A to B, or vice-versa. Let's consider a transition from an initial state $i$ to a final state $j$. The states are characterized by their energy and composition, i.e., $i = (U_i, N_{B,i})$ and $j = (U_j, N_{B,j})$.\n\nThe dynamics of the Monte Carlo simulation must satisfy the detailed balance condition, which ensures that the simulation correctly samples the stationary distribution $\\pi$. The detailed balance condition is:\n$$\n\\pi_i T(i \\to j) = \\pi_j T(j \\to i)\n$$\nwhere $T(i \\to j)$ is the transition probability from state $i$ to state $j$. This transition probability can be decomposed into a proposal probability $\\alpha(i \\to j)$ and an acceptance probability $p_{\\mathrm{acc}}(i \\to j)$, such that $T(i \\to j) = \\alpha(i \\to j) p_{\\mathrm{acc}}(i \\to j)$.\n\nSubstituting this into the detailed balance equation gives:\n$$\n\\pi_i \\alpha(i \\to j) p_{\\mathrm{acc}}(i \\to j) = \\pi_j \\alpha(j \\to i) p_{\\mathrm{acc}}(j \\to i)\n$$\nThis can be rearranged to express the ratio of acceptance probabilities:\n$$\n\\frac{p_{\\mathrm{acc}}(i \\to j)}{p_{\\mathrm{acc}}(j \\to i)} = \\frac{\\pi_j}{\\pi_i} \\frac{\\alpha(j \\to i)}{\\alpha(i \\to j)}\n$$\nFor an identity-swap move, a simple proposal scheme is to randomly select one of the $N$ particles and attempt to flip its identity. The probability of proposing a move from $A \\to B$ is proportional to the number of A particles, $N_A$, and the probability of proposing a move from $B \\to A$ is proportional to $N_B$. However, a simpler choice is a symmetric proposal: pick any particle uniformly at random and attempt to flip its identity. In this case, $\\alpha(i \\to j) = \\alpha(j \\to i)$, and the proposal ratio is unity. The Metropolis-Hastings criterion then simplifies to the Metropolis choice:\n$$\np_{\\mathrm{acc}}(i \\to j) = \\min\\left(1, \\frac{\\pi_j}{\\pi_i}\\right)\n$$\nWe now calculate the ratio of the stationary probabilities $\\pi_j / \\pi_i$:\n$$\n\\frac{\\pi_j}{\\pi_i} = \\frac{\\exp(-\\beta U_j + \\beta\\Delta\\mu N_{B,j})}{\\exp(-\\beta U_i + \\beta\\Delta\\mu N_{B,i})}\n$$\n$$\n\\frac{\\pi_j}{\\pi_i} = \\exp[-\\beta(U_j - U_i) + \\beta\\Delta\\mu(N_{B,j} - N_{B,i})]\n$$\nLet $\\Delta U = U_j - U_i$ be the change in energy and $\\Delta N_B = N_{B,j} - N_{B,i}$ be the change in the number of B particles. The ratio becomes:\n$$\n\\frac{\\pi_j}{\\pi_i} = \\exp(-\\beta \\Delta U + \\beta\\Delta\\mu \\Delta N_B)\n$$\nFor an $A \\to B$ swap, one A particle is converted to a B particle, so $\\Delta N_B = +1$. For a $B \\to A$ swap, $\\Delta N_B = -1$.\nSubstituting this ratio into the Metropolis formula gives the final acceptance probability:\n$$\np_{\\mathrm{acc}} = \\min\\left[1, \\exp\\left(-\\beta \\Delta U + \\beta \\Delta \\mu \\, \\Delta N_B\\right)\\right]\n$$\nThis completes the derivation as required.\n\n### Part 2: Algorithmic Approach for Azeotrope Detection\n\nThe computational task is to find an azeotrope by analyzing the phase equilibrium of a binary mixture. An azeotrope occurs at a temperature $T_{\\mathrm{az}}$ where the compositions of the two coexisting phases (liquid, $L$, and vapor, $V$) become equal, i.e., $x_B^{(L)}(T_{\\mathrm{az}}) = x_B^{(V)}(T_{\\mathrm{az}})$.\n\nThe system is described by a mean-field regular solution model. The equilibrium composition $x_B$ in each phase $i \\in \\{L, V\\}$ at a given temperature $T$ and chemical potential difference $\\Delta\\mu$ is determined by the condition of thermodynamic equilibrium, which states that the partial derivative of the free energy per particle $f_i$ with respect to the composition $x_B$ equals $\\Delta\\mu$:\n$$\n\\frac{\\partial f_i}{\\partial x_B}(x_B, T) = \\Delta \\mu\n$$\nUsing the provided expression for $f_i(x_B, T)$, this condition yields the following transcendental equation for $x_B$:\n$$\nk_B T \\ln \\frac{x_B}{1-x_B} + z_i(T) \\left[x_B \\varepsilon_{BB} - (1-x_B)\\varepsilon_{AA} + (1-2x_B)\\varepsilon_{AB}\\right] = \\Delta \\mu\n$$\nThe effective coordination number $z_i(T)$ depends on the temperature-dependent density $\\rho_i(T)$ of each phase:\n$$\nz_i(T) = z_0 \\rho_i(T)\n$$\nThe densities for the liquid and vapor phases are given by a mean-field scaling relation near a critical temperature $T_c$:\n$$\n\\rho_L(T) = \\rho_c + \\rho_0 \\sqrt{\\max\\left(0, 1 - \\frac{T}{T_c}\\right)}\n$$\n$$\n\\rho_V(T) = \\rho_c - \\rho_0 \\sqrt{\\max\\left(0, 1 - \\frac{T}{T_c}\\right)}\n$$\nFor any temperature $T < T_c$, we have $\\rho_L(T) \\neq \\rho_V(T)$, which implies $z_L(T) \\neq z_V(T)$. Consequently, the equilibrium equations for the two phases are different, leading to potentially different compositions $x_B^{(L)}$ and $x_B^{(V)}$. At the critical temperature, $T = T_c$, the densities and coordination numbers become equal, $z_L = z_V$, and thus the compositions must be identical, $x_B^{(L)} = x_B^{(V)}$. An azeotrope can occur at $T < T_c$ if the parameters conspire to make the compositions equal despite the different densities.\n\nThe algorithm to find the azeotrope is as follows:\n1.  Iterate through each temperature $T$ in the provided grid.\n2.  For each $T$, calculate the densities $\\rho_L(T)$ and $\\rho_V(T)$ and the coordination numbers $z_L(T)$ and $z_V(T)$.\n3.  Define the function whose root we seek for each phase $i$:\n    $$\n    F_i(x_B) = k_B T \\ln \\frac{x_B}{1-x_B} + z_i(T) \\left[x_B \\varepsilon_{BB} - (1-x_B)\\varepsilon_{AA} + (1-2x_B)\\varepsilon_{AB}\\right] - \\Delta \\mu\n    $$\n4.  Solve the nonlinear equations $F_L(x_B^{(L)}) = 0$ and $F_V(x_B^{(V)}) = 0$ for $x_B^{(L)}$ and $x_B^{(V)}$ respectively. Since the function $F_i(x_B)$ is monotonic in the interval $x_B \\in (0, 1)$ for the given parameters, a robust numerical root-finding method like the Brent-Dekker method (`brentq` in SciPy) is suitable.\n5.  Calculate the absolute difference in composition, $\\Delta x_B(T) = |x_B^{(L)}(T) - x_B^{(V)}(T)|$.\n6.  Keep track of the temperature $T^*$ that yields the minimum difference $\\Delta x_{B, \\min}$ found so far. If multiple temperatures give the same minimum difference, the lowest temperature is chosen.\n7.  After checking all temperatures in the grid, if the minimum difference $\\Delta x_{B, \\min}$ is less than the specified tolerance $\\tau$, an azeotrope is considered detected. The azeotrope temperature is $T_{\\mathrm{az}} = T^*$ and the composition is $x_{B, \\mathrm{az}} = \\frac{1}{2}\\left[x_B^{(L)}(T^*) + x_B^{(V)}(T^*)\\right]$.\n8.  If $\\Delta x_{B, \\min} \\geq \\tau$, no azeotrope is found within the given temperature grid and tolerance. A sentinel value is reported.\n9.  All numerical outputs are rounded to three decimal places.\n\nThis procedure systematically maps the tie-lines $\\{x_B^{(L)}(T), x_B^{(V)}(T)\\}$ across the temperature grid and identifies the point of closest approach, which, if close enough, is identified as an azeotrope.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for azeotrope detection.\n    \"\"\"\n    # Test cases as defined in the problem statement.\n    # (params, temp_grid, tolerance)\n    test_cases = [\n        ({\n            'eps_AA': -1.0, 'eps_BB': -0.5, 'eps_AB': -0.7, \n            'z0': 6.0, 'rho_c': 0.5, 'rho_0': 0.4, 'Tc': 1.5, 'delta_mu': 0.0\n         }, np.array([0.6, 0.8, 1.0, 1.2, 1.4]), 0.02),\n        ({\n            'eps_AA': -0.8, 'eps_BB': -0.8, 'eps_AB': -0.8,\n            'z0': 6.0, 'rho_c': 0.5, 'rho_0': 0.4, 'Tc': 1.5, 'delta_mu': 0.0\n         }, np.array([0.6, 0.8, 1.0, 1.2, 1.4]), 0.02),\n        ({\n            'eps_AA': -1.0, 'eps_BB': -0.5, 'eps_AB': -0.7, \n            'z0': 6.0, 'rho_c': 0.5, 'rho_0': 0.4, 'Tc': 1.5, 'delta_mu': 0.4\n         }, np.array([0.6, 0.8, 1.0, 1.2, 1.4]), 0.02),\n    ]\n\n    results = []\n    for params, temp_grid, tolerance in test_cases:\n        result = find_azeotrope(params, temp_grid, tolerance)\n        results.append(result)\n\n    # Format the final output string.\n    output_str_parts = []\n    for res in results:\n        # Each result is a list [T_az, xB_az] or [-1.0, -1.0]\n        # round to 3 decimal places\n        output_str_parts.append(f\"[{res[0]:.3f},{res[1]:.3f}]\")\n    \n    final_output = f\"[{','.join(output_str_parts)}]\"\n    print(final_output)\n\n\ndef find_azeotrope(params, temp_grid, tolerance):\n    \"\"\"\n    Finds an azeotrope for a given set of parameters and temperature grid.\n\n    Args:\n        params (dict): A dictionary of model parameters.\n        temp_grid (np.array): An array of temperatures to scan.\n        tolerance (float): The tolerance for composition difference.\n\n    Returns:\n        list: A list [T_az, xB_az] if an azeotrope is found, otherwise [-1.0, -1.0].\n    \"\"\"\n    p = params\n    k_B = 1.0\n\n    min_diff = float('inf')\n    azeotrope_data = None\n\n    # Function to solve for x_B\n    def equilibrium_eq(x_B, T, z):\n        # To avoid log(0) or division by zero, x_B is bounded slightly away from 0 and 1\n        if x_B <= 0 or x_B >= 1:\n            return float('nan') # Should not happen with brentq's interval\n        \n        term1 = k_B * T * np.log(x_B / (1.0 - x_B))\n        term2 = z * (x_B * p['eps_BB'] - (1.0 - x_B) * p['eps_AA'] + (1.0 - 2.0 * x_B) * p['eps_AB'])\n        return term1 + term2 - p['delta_mu']\n\n    for T in temp_grid:\n        if T >= p['Tc']:\n            sqrt_term = 0.0\n        else:\n            sqrt_term = np.sqrt(1.0 - T / p['Tc'])\n\n        rho_L = p['rho_c'] + p['rho_0'] * sqrt_term\n        rho_V = p['rho_c'] - p['rho_0'] * sqrt_term\n\n        z_L = p['z0'] * rho_L\n        z_V = p['z0'] * rho_V\n\n        # Search interval for x_B, mole fraction\n        x_interval = [1e-9, 1 - 1e-9]\n\n        try:\n            x_B_L = brentq(equilibrium_eq, x_interval[0], x_interval[1], args=(T, z_L))\n            x_B_V = brentq(equilibrium_eq, x_interval[0], x_interval[1], args=(T, z_V))\n        except ValueError:\n            # Root finding might fail if the function does not cross zero.\n            # This indicates an issue with parameters or model assumptions not covered.\n            # For this problem, we assume solutions always exist.\n            continue\n            \n        diff = abs(x_B_L - x_B_V)\n\n        if diff < min_diff:\n            min_diff = diff\n            azeotrope_data = (T, x_B_L, x_B_V)\n\n    if azeotrope_data and min_diff < tolerance:\n        T_az, x_B_L_az, x_B_V_az = azeotrope_data\n        xB_az = 0.5 * (x_B_L_az + x_B_V_az)\n        return [T_az, xB_az]\n    else:\n        return [-1.0, -1.0]\n\nsolve()\n```", "id": "3454556"}, {"introduction": "Many modern materials science problems involve fluids in complex, heterogeneous environments, such as nanoporous materials. Standard GEMC is not always suitable for such systems, requiring creative algorithmic solutions. This practice guides you through the design of a hybrid Monte Carlo scheme that couples Gibbs ensemble swaps with grand canonical moves to correctly simulate equilibrium between a bulk fluid and a confined phase, emphasizing the fundamental importance of satisfying detailed balance when engineering custom simulation protocols. [@problem_id:3454523]", "problem": "You are asked to design and test a hybrid Markov Chain Monte Carlo (MC) scheme that couples Gibbs Ensemble Monte Carlo (GEMC) particle swaps with Grand Canonical Monte Carlo (GCMC) insertions and deletions restricted to the porous box, for a simplified model of methane coexistence in nanopores. The target of the computation is to ensure that the hybrid move set satisfies detailed balance with respect to an intended stationary distribution and that mixing different move types does not break microscopic reversibility.\n\nConsider two simulation boxes at fixed temperature: a porous box (box $1$) and a bulk box (box $2$). Treat methane as non-interacting point particles (ideal gas) for both boxes. The porous box experiences a spatially uniform external potential such that each particle in box $1$ contributes an energy penalty $+\\epsilon$ (with $\\epsilon \\ge 0$), while the bulk box has no external contribution. Use reduced units with $k_{\\mathrm B}T = 1$ so that $\\beta = 1$, and let all energies be expressed in the same reduced energy unit and all volumes be expressed in the same reduced volume unit. In these units, write all numerical values as pure numbers. Let the chemical potential be the scalar $\\mu$, also in these reduced units.\n\nDefine the following hybrid move types:\n- Move type S (Gibbs-like swap): select a particle in box $2$ and propose moving it into box $1$ at a uniformly random position in box $1$ (the reverse moves a particle from box $1$ to box $2$ analogously). This move changes the pair $(N_1,N_2)$ by $(+1,-1)$ in the forward direction (box $2 \\to 1$), where $N_1$ and $N_2$ are the current particle counts.\n- Move type G (Grand canonical in porous box): propose an insertion into box $1$ at a uniformly random position (the reverse is a deletion from box $1$ chosen uniformly among its particles). This move changes $(N_1,N_2)$ by $(+1,0)$ in the forward direction (insertion).\n\nAssume move types are chosen independently from the state, with fixed probabilities $p_{\\mathrm S}$ for type S and $p_{\\mathrm G}$ for type G, with $p_{\\mathrm S} + p_{\\mathrm G} = 1$. Within each type, assume a fixed direction selection probability equal to $1/2$ between a move and its reverse (for type S, box $2 \\to 1$ versus box $1 \\to 2$; for type G, insertion versus deletion). Within a specific direction, the proposal probabilities are:\n- For type S, box $2 \\to 1$: select one particle uniformly from $N_2$ and a new position uniformly in box $1$, giving a proposal density proportional to $(1/N_2)\\,(1/V_1)$; the reverse uses $(1/(N_1+1))\\,(1/V_2)$.\n- For type G, insertion into box $1$: select a position uniformly in $V_1$, proposal density $(1/V_1)$; the reverse deletion uses $(1/(N_1+1))$.\n\nLet the unnormalized stationary weight for a configuration with counts $(N_1,N_2)$ be proportional to\n$$\n\\pi(N_1,N_2) \\propto \\exp\\!\\big(-\\beta\\,U_1(N_1) - \\beta\\,U_2(N_2) + \\beta\\,\\mu\\,(N_1 + N_2)\\big),\n$$\nwith $U_1(N_1) = \\epsilon\\,N_1$ and $U_2(N_2) = 0$. The positions are integrated out, consistent with the ideal-gas and uniform external-field assumptions; your acceptance formula must arise from first-principles detailed balance in the Metropolis–Hastings construction using the stated proposal mechanisms.\n\nTask 1. Starting from the principle of detailed balance and the Metropolis–Hastings acceptance rule, derive acceptance probabilities for:\n- Type S forward swap (box $2 \\to 1$) and its reverse (box $1 \\to 2$) that ensure detailed balance for the stated $\\pi(N_1,N_2)$.\n- Type G forward insertion (into box $1$) and its reverse deletion (from box $1$) that ensure detailed balance for the stated $\\pi(N_1,N_2)$.\n\nYour derivation must start from the definition of detailed balance and the given proposal densities, and it must arrive at explicit acceptance functions in terms of $(N_1,N_2,V_1,V_2,\\beta,\\epsilon,\\mu)$.\n\nTask 2. Implement a program that:\n- Computes, for given parameters and a specified forward direction, the forward and reverse one-step transition probabilities $K(x \\to y)$ and $K(y \\to x)$, where $K$ includes the type selection probability, the direction selection probability, the proposal probability for that move, and the derived Metropolis–Hastings acceptance probability.\n- Verifies that the ratio $K(x \\to y)/K(y \\to x)$ equals the ratio $\\pi(y)/\\pi(x)$ implied by the given $\\pi(N_1,N_2)$ and the changes in $(N_1,N_2)$ incurred by the move type and direction. For move type S (box $2 \\to 1$), the ratio must be $\\exp(-\\beta\\,\\epsilon)$; for move type G insertion into box $1$, the ratio must be $\\exp(\\beta\\,\\mu - \\beta\\,\\epsilon)$.\n- Returns a boolean indicating whether the absolute difference between the two sides is less than a tolerance of $10^{-12}$.\n\nTest suite. Use reduced units with $\\beta = 1$. For each case below, compute the boolean described above. Use $p_{\\mathrm S} = 0.7$ and $p_{\\mathrm G} = 0.3$ in all cases.\n- Case 1 (type S forward, box $2 \\to 1$): $N_1 = 10$, $N_2 = 90$, $V_1 = 5.0$, $V_2 = 95.0$, $\\epsilon = 1.5$.\n- Case 2 (type S forward, box $2 \\to 1$): $N_1 = 0$, $N_2 = 5$, $V_1 = 12.0$, $V_2 = 8.0$, $\\epsilon = 2.3$.\n- Case 3 (type G forward, insertion into box $1$): $N_1 = 10$, $V_1 = 5.0$, $\\epsilon = 1.5$, $\\mu = -2.0$.\n- Case 4 (type G forward, insertion into box $1$): $N_1 = 0$, $V_1 = 2.0$, $\\epsilon = 0.2$, $\\mu = 3.0$.\n- Case 5 (type G forward, insertion into box $1$): $N_1 = 50$, $V_1 = 100.0$, $\\epsilon = 4.0$, $\\mu = 1.0$.\n\nFinal output format. Your program should produce a single line of output containing the five booleans corresponding to Cases $1$ through $5$, as a comma-separated list enclosed in square brackets, for example, \"[True,True,True,True,True]\". No other output is permitted.", "solution": "The problem requires the derivation of acceptance probabilities for a hybrid Gibbs Ensemble Monte Carlo (GEMC) and Grand Canonical Monte Carlo (GCMC) scheme and subsequent numerical verification that the resulting transition probabilities satisfy the principle of detailed balance. The system consists of two boxes containing non-interacting particles, where particles in box $1$ have an additional energy penalty of $\\epsilon$. All calculations are performed in reduced units where $\\beta = (k_BT)^{-1} = 1$.\n\nThe foundation of this analysis is the detailed balance condition, which states that for any two states $x$ and $y$ in the configuration space, the transition rates in equilibrium must satisfy:\n$$\n\\pi(x) K(x \\to y) = \\pi(y) K(y \\to x)\n$$\nHere, $\\pi(x)$ is the equilibrium probability of state $x$, and $K(x \\to y)$ is the total transition probability from state $x$ to $y$. The transition probability can be decomposed into the probability of proposing a move, $p_{select}(x \\to y)$, and the probability of accepting it, $A(x \\to y)$:\n$$\nK(x \\to y) = p_{select}(x \\to y) A(x \\to y)\n$$\nThe Metropolis-Hastings algorithm provides a choice for the acceptance probability that guarantees detailed balance:\n$$\nA(x \\to y) = \\min\\left(1, \\frac{\\pi(y) p_{select}(y \\to x)}{\\pi(x) p_{select}(x \\to y)}\\right)\n$$\nThe problem specifies that the selection of a move type (S or G) and its direction (e.g., forward or reverse) are independent of the current state and symmetric for a move and its reverse. That is, $p_{type}(x \\to y) = p_{type}(y \\to x)$ and $p_{dir}(x \\to y) = p_{dir}(y \\to x)$. The full proposal probability $p_{select}(x \\to y)$ includes these probabilities as well as a term $T_{prob}(x \\to y)$ related to generating the specific final configuration from the initial one.\n$$\np_{select}(x \\to y) = p_{type} \\cdot p_{dir} \\cdot T_{prob}(x \\to y)\n$$\nDue to the symmetry of $p_{type}$ and $p_{dir}$, the acceptance criterion simplifies to:\n$$\nA(x \\to y) = \\min\\left(1, \\frac{\\pi(y) T_{prob}(y \\to x)}{\\pi(x) T_{prob}(x \\to y)}\\right)\n$$\nThe problem provides an unnormalized stationary weight for a macrostate $(N_1, N_2)$:\n$$\n\\pi(N_1, N_2) \\propto \\exp(-\\beta \\epsilon N_1 + \\beta \\mu (N_1 + N_2))\n$$\nWe use this expression along with the given proposal terms $T_{prob}$ to derive the acceptance rules.\n\n**Task 1: Derivation of Acceptance Probabilities**\n\n**Move Type S (Gibbs-like swap)**\nThis move transfers a particle between box $1$ and box $2$.\n- Forward move ($2 \\to 1$): The state changes from $x = (N_1, N_2)$ to $y = (N_1+1, N_2-1)$.\n- Reverse move ($1 \\to 2$): The state changes from $y = (N_1+1, N_2-1)$ to $x = (N_1, N_2)$.\nThe proposal terms are given as $T_{prob}(x \\to y) \\propto \\frac{1}{N_2 V_1}$ and $T_{prob}(y \\to x) \\propto \\frac{1}{(N_1+1) V_2}$. The ratio of stationary weights is:\n$$\n\\frac{\\pi(y)}{\\pi(x)} = \\frac{\\pi(N_1+1, N_2-1)}{\\pi(N_1, N_2)} = \\frac{\\exp(-\\beta\\epsilon(N_1+1) + \\beta\\mu(N_1+1+N_2-1))}{\\exp(-\\beta\\epsilon N_1 + \\beta\\mu(N_1+N_2))} = \\exp(-\\beta\\epsilon)\n$$\nThe argument of the acceptance function, $R_S$, is:\n$$\nR_S = \\frac{\\pi(y)}{\\pi(x)} \\frac{T_{prob}(y \\to x)}{T_{prob}(x \\to y)} = \\exp(-\\beta\\epsilon) \\frac{1/((N_1+1)V_2)}{1/(N_2 V_1)} = \\frac{N_2 V_1}{(N_1+1)V_2} \\exp(-\\beta\\epsilon)\n$$\nThe acceptance probability for the forward swap ($2 \\to 1$) is:\n$$\nA_{S, 2 \\to 1} = \\min(1, R_S) = \\min\\left(1, \\frac{N_2 V_1}{(N_1+1)V_2} \\exp(-\\beta\\epsilon)\\right)\n$$\nThe acceptance probability for the reverse swap ($1 \\to 2$) is:\n$$\nA_{S, 1 \\to 2} = \\min(1, 1/R_S) = \\min\\left(1, \\frac{(N_1+1)V_2}{N_2 V_1} \\exp(\\beta\\epsilon)\\right)\n$$\n\n**Move Type G (Grand canonical in porous box)**\nThis move inserts or deletes a particle in box $1$.\n- Forward move (insertion): The state changes from $x = (N_1, N_2)$ to $y = (N_1+1, N_2)$.\n- Reverse move (deletion): The state changes from $y = (N_1+1, N_2)$ to $x = (N_1, N_2)$.\nThe proposal terms are given as $T_{prob}(x \\to y) \\propto \\frac{1}{V_1}$ and $T_{prob}(y \\to x) \\propto \\frac{1}{N_1+1}$. The ratio of stationary weights is:\n$$\n\\frac{\\pi(y)}{\\pi(x)} = \\frac{\\pi(N_1+1, N_2)}{\\pi(N_1, N_2)} = \\frac{\\exp(-\\beta\\epsilon(N_1+1) + \\beta\\mu(N_1+1+N_2))}{\\exp(-\\beta\\epsilon N_1 + \\beta\\mu(N_1+N_2))} = \\exp(\\beta\\mu - \\beta\\epsilon)\n$$\nThe argument of the acceptance function, $R_G$, is:\n$$\nR_G = \\frac{\\pi(y)}{\\pi(x)} \\frac{T_{prob}(y \\to x)}{T_{prob}(x \\to y)} = \\exp(\\beta\\mu - \\beta\\epsilon) \\frac{1/(N_1+1)}{1/V_1} = \\frac{V_1}{N_1+1} \\exp(\\beta\\mu - \\beta\\epsilon)\n$$\nThe acceptance probability for the forward insertion is:\n$$\nA_{G, \\text{ins}} = \\min(1, R_G) = \\min\\left(1, \\frac{V_1}{N_1+1} \\exp(\\beta\\mu - \\beta\\epsilon)\\right)\n$$\nThe acceptance probability for the reverse deletion is:\n$$\nA_{G, \\text{del}} = \\min(1, 1/R_G) = \\min\\left(1, \\frac{N_1+1}{V_1} \\exp(-\\beta\\mu + \\beta\\epsilon)\\right)\n$$\n\n**Task 2: Numerical Verification**\nThe task is to verify that the ratio of the total transition probabilities, $\\frac{K(x \\to y)}{K(y \\to x)}$, equals the ratio of the stationary probabilities, $\\frac{\\pi(y)}{\\pi(x)}$. By construction, this equality must hold. The identity $\\frac{A(x \\to y)}{A(y \\to x)} = \\frac{\\pi(y) T_{prob}(y \\to x)}{\\pi(x) T_{prob}(x \\to y)}$ guarantees this:\n$$\n\\frac{K(x \\to y)}{K(y \\to x)} = \\frac{p_{type} p_{dir} T_{prob}(x \\to y) A(x \\to y)}{p_{type} p_{dir} T_{prob}(y \\to x) A(y \\to x)} = \\frac{T_{prob}(x \\to y)}{T_{prob}(y \\to x)} \\frac{\\pi(y) T_{prob}(y \\to x)}{\\pi(x) T_{prob}(x \\to y)} = \\frac{\\pi(y)}{\\pi(x)}\n$$\nThe program will compute both sides of this equation numerically, using the derived formulas for acceptance probabilities, for each test case and verify their agreement within a specified tolerance. For a forward move from an initial state $x$ to a final state $y$, the left side is the ratio of $K(x \\to y)$ to $K(y \\to x)$, and the right side is the analytically known target ratio, either $\\exp(-\\beta\\epsilon)$ for type S or $\\exp(\\beta\\mu - \\beta\\epsilon)$ for type G.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and verifies detailed balance for a hybrid MC scheme.\n    \n    The function tests two types of Monte Carlo moves (S: swap, G: grand canonical)\n    for a simplified model of gas coexistence in nanopores. For each test case,\n    it calculates the forward and reverse transition probabilities K(x->y) and K(y->x).\n    It then verifies that their ratio K(x->y)/K(y->x) equals the ratio of the\n    stationary probabilities pi(y)/pi(x), as required by detailed balance.\n    \"\"\"\n    \n    # Parameters given in the problem\n    p_S = 0.7\n    p_G = 0.3\n    beta = 1.0\n    tolerance = 1e-12\n\n    # Test suite from the problem statement.\n    # Each case: (type, N1_initial, N2_initial, V1, V2, epsilon, mu)\n    # V2 or mu might be None if not used by the move type.\n    test_cases = [\n        ('S', 10, 90, 5.0, 95.0, 1.5, None),\n        ('S', 0, 5, 12.0, 8.0, 2.3, None),\n        ('G', 10, None, 5.0, None, 1.5, -2.0),\n        ('G', 0, None, 2.0, None, 0.2, 3.0),\n        ('G', 50, None, 100.0, None, 4.0, 1.0),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        move_type, N1, N2, V1, V2, epsilon, mu = case\n        \n        computed_ratio = 0.0\n        target_ratio = 0.0\n\n        if move_type == 'S':\n            # Type S forward move: box 2 -> 1\n            # Initial state x: (N1, N2), Final state y: (N1+1, N2-1)\n            \n            # The problem's test cases ensure N2 > 0 for this move.\n            \n            # Target ratio from stationary distribution: pi(y)/pi(x) = exp(-beta*epsilon)\n            target_ratio = np.exp(-beta * epsilon)\n\n            # Proposal factors T_prob from the problem statement\n            T_forward = 1.0 / (N2 * V1)\n            T_reverse = 1.0 / ((N1 + 1) * V2)\n\n            # Argument R for the Metropolis-Hastings acceptance rule\n            # R = (pi(y)/pi(x)) * (T_reverse / T_forward)\n            R = target_ratio * (T_reverse / T_forward) if T_forward != 0 else float('inf')\n\n            # Acceptance probabilities A(x->y) and A(y->x)\n            A_forward = min(1.0, R)\n            A_reverse = min(1.0, 1.0 / R) if R != 0 else 1.0\n\n            # Total transition probabilities K = p_type * p_direction * T_prob * A\n            # p_direction is 1/2 for both forward and reverse moves.\n            K_forward = p_S * 0.5 * T_forward * A_forward\n            K_reverse = p_S * 0.5 * T_reverse * A_reverse\n            \n            # Ratio of transition probabilities K(x->y)/K(y->x)\n            if K_reverse == 0:\n                # This should not happen with the given test cases.\n                computed_ratio = float('inf') if K_forward != 0 else 1.0\n            else:\n                computed_ratio = K_forward / K_reverse\n\n        elif move_type == 'G':\n            # Type G forward move: insertion into box 1\n            # Initial state x: (N1, N_any), Final state y: (N1+1, N_any)\n\n            # Target ratio from analytical derivation: pi(y)/pi(x) = exp(beta*mu - beta*epsilon)\n            target_ratio = np.exp(beta * mu - beta * epsilon)\n\n            # Proposal factors T_prob\n            T_forward = 1.0 / V1          # Insertion\n            T_reverse = 1.0 / (N1 + 1)    # Deletion\n            \n            # Argument R for the Metropolis-Hastings acceptance rule\n            R = target_ratio * (T_reverse / T_forward) if T_forward != 0 else float('inf')\n            \n            # Acceptance probabilities\n            A_forward = min(1.0, R)\n            A_reverse = min(1.0, 1.0 / R) if R != 0 else 1.0\n            \n            # Total transition probabilities K\n            K_forward = p_G * 0.5 * T_forward * A_forward\n            K_reverse = p_G * 0.5 * T_reverse * A_reverse\n            \n            # Ratio K(x->y)/K(y->x)\n            if K_reverse == 0:\n                computed_ratio = float('inf') if K_forward != 0 else 1.0\n            else:\n                computed_ratio = K_forward / K_reverse\n        \n        # Verify if computed ratio matches the target ratio within tolerance\n        is_balanced = np.abs(computed_ratio - target_ratio) < tolerance\n        results.append(is_balanced)\n        \n    # Format and print the final output as specified.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3454523"}]}