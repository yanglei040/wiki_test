{"hands_on_practices": [{"introduction": "We begin our hands-on exploration with the fundamentals of algebraic grid generation. This practice examines the bilinear map, a cornerstone technique for creating structured grids on four-sided regions. By deriving the relationship between the physical domain's geometry and the grid's local orthogonality, you will gain direct, analytical insight into how simple algebraic formulations control grid quality [@problem_id:3362194]. This foundational exercise is crucial for building intuition about the geometric consequences of mapping choices before we advance to more complex and powerful grid generation methods.", "problem": "Consider the bilinear algebraic mapping from the computational unit square with coordinates $(\\xi,\\eta)\\in[0,1]\\times[0,1]$ to a convex physical quadrilateral with vertices, in counterclockwise order, $\\mathbf{P}_{1}=(0,0)$, $\\mathbf{P}_{2}=(L,0)$, $\\mathbf{P}_{3}=(L+s,H)$, and $\\mathbf{P}_{4}=(0,H)$, where $L0$, $H0$, and $|s|L$ so that the quadrilateral is convex and non-degenerate. Let $\\mathbf{x}(\\xi,\\eta)=(x(\\xi,\\eta),y(\\xi,\\eta))$ denote the physical coordinates obtained by bilinear interpolation of the vertex positions. Using only the definitions of bilinear interpolation and the metric coefficients $g_{11}=\\mathbf{x}_{\\xi}\\cdot\\mathbf{x}_{\\xi}$, $g_{12}=\\mathbf{x}_{\\xi}\\cdot\\mathbf{x}_{\\eta}$, and $g_{22}=\\mathbf{x}_{\\eta}\\cdot\\mathbf{x}_{\\eta}$ associated with the mapping, derive from first principles an explicit expression for the cosine of the angle between the coordinate lines (the $\\xi$-curve and the $\\eta$-curve) at the parametric center $(\\xi,\\eta)=(\\tfrac{1}{2},\\tfrac{1}{2})$ in terms of $L$, $H$, and $s$. Your derivation should start from the definition of bilinear interpolation and the geometric definition of the angle between two vectors. Additionally, explain qualitatively how the skew parameter $s$ affects the interior angle at the center through its appearance in your expression. The final answer must be a single closed-form analytic expression for $\\cos\\theta$ at $(\\xi,\\eta)=(\\tfrac{1}{2},\\tfrac{1}{2})$ in terms of $L$, $H$, and $s$.", "solution": "The user wants me to solve the following problem:\nConsider the bilinear algebraic mapping from the computational unit square with coordinates $(\\xi,\\eta)\\in[0,1]\\times[0,1]$ to a convex physical quadrilateral with vertices, in counterclockwise order, $\\mathbf{P}_{1}=(0,0)$, $\\mathbf{P}_{2}=(L,0)$, $\\mathbf{P}_{3}=(L+s,H)$, and $\\mathbf{P}_{4}=(0,H)$, where $L0$, $H0$, and $|s|L$ so that the quadrilateral is convex and non-degenerate. Let $\\mathbf{x}(\\xi,\\eta)=(x(\\xi,\\eta),y(\\xi,\\eta))$ denote the physical coordinates obtained by bilinear interpolation of the vertex positions. Using only the definitions of bilinear interpolation and the metric coefficients $g_{11}=\\mathbf{x}_{\\xi}\\cdot\\mathbf{x}_{\\xi}$, $g_{12}=\\mathbf{x}_{\\xi}\\cdot\\mathbf{x}_{\\eta}$, and $g_{22}=\\mathbf{x}_{\\eta}\\cdot\\mathbf{x}_{\\eta}$ associated with the mapping, derive from first principles an explicit expression for the cosine of the angle between the coordinate lines (the $\\xi$-curve and the $\\eta$-curve) at the parametric center $(\\xi,\\eta)=(\\tfrac{1}{2},\\tfrac{1}{2})$ in terms of $L$, $H$, and $s$. Your derivation should start from the definition of bilinear interpolation and the geometric definition of the angle between two vectors. Additionally, explain qualitatively how the skew parameter $s$ affects the interior angle at the center through its appearance in your expression. The final answer must be a single closed-form analytic expression for $\\cos\\theta$ at $(\\xi,\\eta)=(\\tfrac{1}{2},\\tfrac{1}{2})$ in terms of $L$, $H$, and $s$.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- **Computational Domain**: Unit square $(\\xi,\\eta)\\in[0,1]\\times[0,1]$.\n- **Physical Vertices**: $\\mathbf{P}_{1}=(0,0)$, $\\mathbf{P}_{2}=(L,0)$, $\\mathbf{P}_{3}=(L+s,H)$, and $\\mathbf{P}_{4}=(0,H)$.\n- **Constraints**: $L0$, $H0$, $|s|L$. The quadrilateral is convex and non-degenerate.\n- **Mapping**: Bilinear interpolation, $\\mathbf{x}(\\xi,\\eta)=(x(\\xi,\\eta),y(\\xi,\\eta))$ from the computational domain to the physical quadrilateral.\n- **Metric Coefficients Definitions**: $g_{11}=\\mathbf{x}_{\\xi}\\cdot\\mathbf{x}_{\\xi}$, $g_{12}=\\mathbf{x}_{\\xi}\\cdot\\mathbf{x}_{\\eta}$, $g_{22}=\\mathbf{x}_{\\eta}\\cdot\\mathbf{x}_{\\eta}$. The vectors $\\mathbf{x}_{\\xi}$ and $\\mathbf{x}_{\\eta}$ are the partial derivatives of $\\mathbf{x}$ with respect to $\\xi$ and $\\eta$.\n- **Objective**: Derive an explicit expression for the cosine of the angle, $\\cos\\theta$, between the $\\xi$-coordinate line and the $\\eta$-coordinate line at the parametric center $(\\xi,\\eta)=(\\tfrac{1}{2},\\tfrac{1}{2})$.\n- **Derivation Requirement**: Start from first principles (bilinear interpolation definition and the geometric definition of the angle between vectors).\n- **Additional Task**: Qualitatively explain the effect of the skew parameter $s$ on the angle.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is assessed against the validation criteria:\n- **Scientifically Grounded**: The problem is based on standard, well-established concepts in numerical grid generation and differential geometry, namely bilinear mapping and the metric tensor. The concepts are mathematically rigorous and factually sound.\n- **Well-Posed**: The problem provides all necessary information (vertices, mapping type, target point) to determine a unique solution. The constraints $L0$, $H0$, and $|s|L$ ensure that the quadrilateral is well-behaved (non-degenerate and convex), which guarantees the mapping is non-singular.\n- **Objective**: The problem is stated in precise mathematical language, free from subjectivity or ambiguity.\nThe problem does not violate any of the invalidity criteria. It is a formalizable problem directly related to its stated topic, is self-contained, and poses a non-trivial challenge requiring direct application and derivation from fundamental principles.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete solution will be provided.\n\n### Derivation of the Solution\n\nThe derivation begins with the definition of the bilinear interpolation mapping $\\mathbf{x}(\\xi, \\eta)$ for the four vertices $\\mathbf{P}_1, \\mathbf{P}_2, \\mathbf{P}_3, \\mathbf{P}_4$. The mapping is given by:\n$$\n\\mathbf{x}(\\xi, \\eta) = (1-\\xi)(1-\\eta)\\mathbf{P}_1 + \\xi(1-\\eta)\\mathbf{P}_2 + \\xi\\eta\\mathbf{P}_3 + (1-\\xi)\\eta\\mathbf{P}_4\n$$\nSubstituting the given vertex coordinates $\\mathbf{P}_{1}=(0,0)$, $\\mathbf{P}_{2}=(L,0)$, $\\mathbf{P}_{3}=(L+s,H)$, and $\\mathbf{P}_{4}=(0,H)$:\n$$\n\\mathbf{x}(\\xi, \\eta) = (1-\\xi)(1-\\eta)(0,0) + \\xi(1-\\eta)(L,0) + \\xi\\eta(L+s,H) + (1-\\xi)\\eta(0,H)\n$$\nWe can separate this into components $x(\\xi, \\eta)$ and $y(\\xi, \\eta)$:\n$$\nx(\\xi, \\eta) = \\xi(1-\\eta)L + \\xi\\eta(L+s) = L\\xi - L\\xi\\eta + L\\xi\\eta + s\\xi\\eta = L\\xi + s\\xi\\eta\n$$\n$$\ny(\\xi, \\eta) = \\xi\\eta H + (1-\\xi)\\eta H = \\xi\\eta H + \\eta H - \\xi\\eta H = H\\eta\n$$\nThus, the vector mapping is $\\mathbf{x}(\\xi, \\eta) = (L\\xi + s\\xi\\eta, H\\eta)$.\n\nThe angle $\\theta$ between the coordinate lines is the angle between their tangent vectors, $\\mathbf{x}_{\\xi} = \\frac{\\partial\\mathbf{x}}{\\partial\\xi}$ and $\\mathbf{x}_{\\eta} = \\frac{\\partial\\mathbf{x}}{\\partial\\eta}$. From the geometric definition of the dot product, the cosine of this angle is:\n$$\n\\cos\\theta = \\frac{\\mathbf{x}_{\\xi} \\cdot \\mathbf{x}_{\\eta}}{|\\mathbf{x}_{\\xi}| |\\mathbf{x}_{\\eta}|}\n$$\nIn terms of the metric coefficients $g_{ij}$, this is written as:\n$$\n\\cos\\theta = \\frac{g_{12}}{\\sqrt{g_{11} g_{22}}}\n$$\nFirst, we compute the tangent vectors by taking the partial derivatives of $\\mathbf{x}(\\xi, \\eta)$:\n$$\n\\mathbf{x}_{\\xi} = \\frac{\\partial}{\\partial\\xi}(L\\xi + s\\xi\\eta, H\\eta) = (L+s\\eta, 0)\n$$\n$$\n\\mathbf{x}_{\\eta} = \\frac{\\partial}{\\partial\\eta}(L\\xi + s\\xi\\eta, H\\eta) = (s\\xi, H)\n$$\nNext, we evaluate these tangent vectors at the parametric center of the domain, $(\\xi, \\eta) = (\\frac{1}{2}, \\frac{1}{2})$:\n$$\n\\mathbf{x}_{\\xi}\\Big|_{(\\frac{1}{2},\\frac{1}{2})} = \\left(L + s\\left(\\frac{1}{2}\\right), 0\\right) = \\left(L + \\frac{s}{2}, 0\\right)\n$$\n$$\n\\mathbf{x}_{\\eta}\\Big|_{(\\frac{1}{2},\\frac{1}{2})} = \\left(s\\left(\\frac{1}{2}\\right), H\\right) = \\left(\\frac{s}{2}, H\\right)\n$$\nNow, we compute the dot product and the magnitudes of these vectors at the center point. This corresponds to calculating the metric coefficients at $(\\frac{1}{2}, \\frac{1}{2})$.\nThe dot product, $g_{12}$:\n$$\ng_{12} = \\mathbf{x}_{\\xi} \\cdot \\mathbf{x}_{\\eta} = \\left(L + \\frac{s}{2}\\right)\\left(\\frac{s}{2}\\right) + (0)(H) = \\frac{sL}{2} + \\frac{s^2}{4}\n$$\nThe squared magnitudes, $g_{11}$ and $g_{22}$:\n$$\ng_{11} = |\\mathbf{x}_{\\xi}|^2 = \\left(L + \\frac{s}{2}\\right)^2 + 0^2 = \\left(L + \\frac{s}{2}\\right)^2\n$$\n$$\ng_{22} = |\\mathbf{x}_{\\eta}|^2 = \\left(\\frac{s}{2}\\right)^2 + H^2 = \\frac{s^2}{4} + H^2\n$$\nSubstituting these into the expression for $\\cos\\theta$:\n$$\n\\cos\\theta = \\frac{\\frac{sL}{2} + \\frac{s^2}{4}}{\\sqrt{\\left(L + \\frac{s}{2}\\right)^2} \\sqrt{\\frac{s^2}{4} + H^2}}\n$$\nWe can simplify the numerator: $\\frac{sL}{2} + \\frac{s^2}{4} = \\frac{s}{2}\\left(L + \\frac{s}{2}\\right)$.\nThe expression becomes:\n$$\n\\cos\\theta = \\frac{\\frac{s}{2}\\left(L + \\frac{s}{2}\\right)}{\\left|L + \\frac{s}{2}\\right| \\sqrt{\\frac{s^2}{4} + H^2}}\n$$\nGiven the constraint $|s|  L$ and $L0$, we have $L+\\frac{s}{2}  L - \\frac{L}{2} = \\frac{L}{2}  0$. Therefore, the absolute value is unnecessary, i.e., $|L + \\frac{s}{2}| = L + \\frac{s}{2}$. The term $(L + \\frac{s}{2})$ cancels from the numerator and denominator:\n$$\n\\cos\\theta = \\frac{\\frac{s}{2}}{\\sqrt{\\frac{s^2}{4} + H^2}}\n$$\nTo simplify further, we can multiply the numerator and denominator by $2$:\n$$\n\\cos\\theta = \\frac{s}{2\\sqrt{\\frac{s^2}{4} + H^2}} = \\frac{s}{\\sqrt{4\\left(\\frac{s^2}{4} + H^2\\right)}} = \\frac{s}{\\sqrt{s^2 + 4H^2}}\n$$\nThis is the final expression for the cosine of the angle between the coordinate lines at the center of the domain.\n\n### Qualitative Analysis of the skew parameter $s$\n\nThe derived expression $\\cos\\theta = \\frac{s}{\\sqrt{s^2 + 4H^2}}$ reveals the influence of the skew parameter $s$ on the grid geometry at the center.\n1.  **Orthogonality Condition**: If $s=0$, the quadrilateral becomes a rectangle. The formula yields $\\cos\\theta = 0$, which means $\\theta = \\frac{\\pi}{2}$. This confirms that for a rectangular physical domain, the bilinear mapping produces an orthogonal grid at the center, as expected.\n2.  **Effect of Magnitude $|s|$**: The parameter $s$ directly controls the non-orthogonality. As the magnitude $|s|$ increases from $0$, the value of $|\\cos\\theta| = \\frac{|s|}{\\sqrt{s^2 + 4H^2}}$ also increases. An increasing $|\\cos\\theta|$ signifies that the angle $\\theta$ deviates further from orthogonality ($\\frac{\\pi}{2}$ radians or $90^\\circ$). In the limit as $|s| \\to \\infty$ (a theoretical case not covered by the problem constraints, but illustrative), $|\\cos\\theta| \\to 1$, indicating extreme skew where the coordinate lines become nearly parallel. Thus, a larger $|s|$ corresponds to a more skewed grid at the center.\n3.  **Effect of Sign of $s$**: The sign of $s$ determines the nature of the angle.\n    - If $s  0$, then $\\cos\\theta  0$, implying the angle $\\theta$ is acute ($0  \\theta  \\frac{\\pi}{2}$). Geometrically, a positive $s$ represents a shear of the top edge to the right, causing the $\\eta$-lines to lean \"forward\" in the direction of increasing $\\xi$.\n    - If $s  0$, then $\\cos\\theta  0$, implying the angle $\\theta$ is obtuse ($\\frac{\\pi}{2}  \\theta  \\pi$). This corresponds to a shear of the top edge to the left, causing the $\\eta$-lines to lean \"backward\" relative to the direction of increasing $\\xi$.\n4.  **Influence of $H$**: The height $H$ of the quadrilateral modulates the effect of $s$. For a fixed non-zero $s$, as $H$ increases, the denominator $\\sqrt{s^2 + 4H^2}$ increases, causing $|\\cos\\theta|$ to decrease. This means a taller quadrilateral (larger $H$) mitigates the angular distortion caused by the skew $s$, making the grid \"less skewed\" or closer to orthogonal at its center.", "answer": "$$\\boxed{\\frac{s}{\\sqrt{s^{2} + 4H^{2}}}}$$", "id": "3362194"}, {"introduction": "Building upon algebraic methods, we now transition to the more powerful and flexible framework of elliptic grid generation. A key advantage of elliptic systems is their ability to exert fine-grained control over grid characteristics, a vital feature for creating adaptive meshes that resolve complex phenomena. This practice delves into the \"inverse problem\": designing a grid to match a prescribed cell size distribution by specifying a target Jacobian field [@problem_id:3362226]. You will use principles from vector calculus, including the Helmholtz decomposition, to derive a system of Poisson equations that governs the grid, providing a deep look into the mathematical machinery behind advanced grid control.", "problem": "Consider a two-dimensional mapping from a simply connected physical domain $\\Omega \\subset \\mathbb{R}^{2}$ with coordinates $(x,y)$ to computational coordinates $(\\xi,\\eta)$ used in elliptic grid generation for the numerical solution of partial differential equations (PDE). Let $\\boldsymbol{\\xi}(x,y) = (\\xi(x,y),\\eta(x,y))$ denote the inverse map from physical to computational space, and let the inverse Jacobian determinant be $J^{-1}(x,y) = \\det\\!\\left(\\nabla \\boldsymbol{\\xi}(x,y)\\right)$, where $\\nabla \\boldsymbol{\\xi}$ is the $2\\times 2$ Jacobian matrix $\\partial(\\xi,\\eta)/\\partial(x,y)$.\n\nYou are asked to explore the inverse prescription problem: given a smooth and strictly positive target Jacobian field $J_{\\star}(x,y)0$, derive a Poisson-like system for auxiliary potentials whose solution yields $(\\xi,\\eta)$ that approximates $\\det\\!\\left(\\nabla \\boldsymbol{\\xi}\\right)^{-1} = J_{\\star}$ to leading order, and analyze the corresponding solvability constraints (integrability conditions).\n\nStart from the following fundamental bases:\n- The definition of the Jacobian determinant of a smooth mapping, and its role in local area change: for any subdomain $U \\subset \\Omega$, $\\int_{U}\\det\\!\\left(\\nabla \\boldsymbol{\\xi}\\right)\\,\\mathrm{d}x\\,\\mathrm{d}y$ equals the area of $\\boldsymbol{\\xi}(U)$ in computational space.\n- Linearization around the identity mapping: write $\\xi(x,y) = x + u(x,y)$ and $\\eta(x,y) = y + v(x,y)$ with $u$ and $v$ sufficiently smooth and $|\\nabla u|+|\\nabla v|$ small.\n- The two-dimensional Helmholtz decomposition for a vector field $\\boldsymbol{w}=(u,v)$: there exist scalar potentials $p$ and $q$ such that $\\boldsymbol{w} = \\nabla p + \\nabla^{\\perp}q$, where $\\nabla p = (p_{x},p_{y})$ and $\\nabla^{\\perp}q=(-q_{y},q_{x})$.\n\nTasks:\n1. Under the linearization ansatz and using only the above bases, derive a Poisson-like system for the potentials $(p,q)$ that enforces $\\det\\!\\left(\\nabla \\boldsymbol{\\xi}\\right)^{-1} \\approx J_{\\star}$ to first order in derivatives of $u$ and $v$, and briefly explain the role of $q$ in near-conformality. Your system must be expressed in terms of $\\Delta p$ and $\\Delta q$, where $\\Delta$ denotes the Laplacian operator on $\\Omega$.\n2. State and justify the solvability (integrability) condition(s) for this system under periodic boundary conditions on $\\partial\\Omega$, i.e., when $(\\xi,\\eta)$ and all derivatives are $2\\pi$-periodic in both $x$ and $y$ on the torus $\\Omega=[0,2\\pi]\\times[0,2\\pi]$.\n3. Apply your derivation to the specific target field\n   $$J_{\\star}(x,y) = 1 + \\alpha \\cos(x)\\cos(y), \\quad |\\alpha|1,$$\n   on the periodic domain $\\Omega=[0,2\\pi]\\times[0,2\\pi]$, and choose the simplest near-conformal prescription consistent with your integrability conditions. Compute the explicit leading-order expressions for $\\xi(x,y)$ and $\\eta(x,y)$ in terms of $\\alpha$, $x$, and $y$, neglecting terms of order $\\alpha^{2}$ and higher.\n\nYour final answer must be the pair $(\\xi(x,y),\\eta(x,y))$ as a single closed-form analytic expression. No rounding is required. If you present multiple expressions, write them as a single row using the LaTeX $\\mathrm{pmatrix}$ environment inside your final answer.", "solution": "The problem is first validated to ensure it is scientifically sound, self-contained, and well-posed.\n\n### Step 1: Extract Givens\n- **Mapping:** $\\boldsymbol{\\xi}(x,y) = (\\xi(x,y), \\eta(x,y))$ from physical coordinates $(x,y)$ to computational coordinates $(\\xi,\\eta)$.\n- **Linearization Ansatz:** $\\xi(x,y) = x + u(x,y)$ and $\\eta(x,y) = y + v(x,y)$, where the displacement field $\\boldsymbol{w}=(u,v)$ has small first derivatives.\n- **Helmholtz Decomposition:** $\\boldsymbol{w} = \\nabla p + \\nabla^{\\perp}q$, which implies $u = p_x - q_y$ and $v = p_y + q_x$. Here, $\\nabla p = (p_x, p_y)$ and $\\nabla^{\\perp}q = (-q_y, q_x)$.\n- **Target Condition:** $\\det(\\nabla \\boldsymbol{\\xi})^{-1} \\approx J_{\\star}(x,y)$, where $\\nabla \\boldsymbol{\\xi}$ is the Jacobian matrix $\\frac{\\partial(\\xi,\\eta)}{\\partial(x,y)}$ and $J_{\\star}(x,y)0$ is a given smooth target field. The determinant of the Jacobian of the inverse map is defined as $J^{-1}(x,y) \\equiv \\det(\\nabla \\boldsymbol{\\xi})$. The condition translates to $J \\approx J_\\star$, where $J$ is the determinant of the Jacobian of the forward map (from computational to physical space).\n- **Specific Case for Task 3:** $J_{\\star}(x,y) = 1 + \\alpha \\cos(x)\\cos(y)$ with $|\\alpha|1$ on the periodic domain $\\Omega=[0,2\\pi]\\times[0,2\\pi]$. The final expressions should neglect terms of order $\\mathcal{O}(\\alpha^2)$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is well-posed and scientifically grounded in the fields of vector calculus, partial differential equations, and numerical grid generation. The definitions, though notationally dense, are explicit and consistent. The linearization approach is a standard physical and mathematical technique. The use of Helmholtz decomposition is appropriate. The target function $J_\\star$ is smooth and strictly positive under the given condition $|\\alpha|1$. The setting on a periodic domain is a standard BVP setup. The problem is therefore deemed valid.\n\n### Step 3: Derivation and Solution\n\n**Task 1: Derivation of the Poisson-like System**\n\nWe begin by computing the determinant of the Jacobian matrix of the inverse map, $\\nabla\\boldsymbol{\\xi}$.\nThe map is given by $\\xi(x,y) = x + u(x,y)$ and $\\eta(x,y) = y + v(x,y)$.\nThe Jacobian matrix is:\n$$ \\nabla\\boldsymbol{\\xi} = \\begin{pmatrix} \\xi_x  \\xi_y \\\\ \\eta_x  \\eta_y \\end{pmatrix} = \\begin{pmatrix} 1 + u_x  u_y \\\\ v_x  1 + v_y \\end{pmatrix} $$\nThe determinant is:\n$$ \\det(\\nabla\\boldsymbol{\\xi}) = (1+u_x)(1+v_y) - u_y v_x = 1 + u_x + v_y + u_x v_y - u_y v_x $$\nThe problem requires an approximation to first order in the derivatives of $u$ and $v$. We thus neglect the quadratic terms $u_x v_y$ and $u_y v_x$:\n$$ \\det(\\nabla\\boldsymbol{\\xi}) \\approx 1 + u_x + v_y = 1 + \\nabla \\cdot \\boldsymbol{w} $$\nwhere $\\boldsymbol{w} = (u,v)$.\n\nThe target condition is $\\det(\\nabla\\boldsymbol{\\xi})^{-1} \\approx J_{\\star}$, which implies $\\det(\\nabla\\boldsymbol{\\xi}) \\approx \\frac{1}{J_{\\star}}$.\nEquating the two expressions for $\\det(\\nabla\\boldsymbol{\\xi})$ gives:\n$$ 1 + \\nabla \\cdot \\boldsymbol{w} \\approx \\frac{1}{J_{\\star}} \\implies \\nabla \\cdot \\boldsymbol{w} \\approx \\frac{1}{J_{\\star}} - 1 = \\frac{1 - J_{\\star}}{J_{\\star}} $$\nNow, we substitute the Helmholtz decomposition $\\boldsymbol{w} = \\nabla p + \\nabla^{\\perp}q$ into the divergence expression.\nThe components of $\\boldsymbol{w}$ are $u = p_x - q_y$ and $v = p_y + q_x$.\nThe divergence $\\nabla \\cdot \\boldsymbol{w}$ is:\n$$ \\nabla \\cdot \\boldsymbol{w} = u_x + v_y = (p_x - q_y)_x + (p_y + q_x)_y = p_{xx} - q_{yx} + p_{yy} + q_{xy} $$\nAssuming the potentials $p$ and $q$ are sufficiently smooth such that mixed partial derivatives are equal (i.e., $q_{xy}=q_{yx}$), this simplifies to:\n$$ \\nabla \\cdot \\boldsymbol{w} = p_{xx} + p_{yy} = \\Delta p $$\nwhere $\\Delta$ is the Laplacian operator.\nThis yields the first equation of our system, a Poisson equation for the potential $p$:\n$$ \\Delta p = \\frac{1 - J_{\\star}(x,y)}{J_{\\star}(x,y)} $$\nTo obtain a system for both $(p,q)$, we must specify an equation for $q$. This is related to the near-conformality requirement. A map is conformal if it preserves angles locally. For the linearized map, this is approximately equivalent to the displacement field $\\boldsymbol{w}=(u,v)$ satisfying the Cauchy-Riemann-like equations $u_x=v_y$ and $u_y=-v_x$.\nLet's consider the curl of the displacement field $\\boldsymbol{w}$:\n$$ \\nabla \\times \\boldsymbol{w} = v_x - u_y = (p_y + q_x)_x - (p_x - q_y)_y = p_{yx} + q_{xx} - p_{xy} + q_{yy} = q_{xx} + q_{yy} = \\Delta q $$\nThe quantity $\\nabla \\times \\boldsymbol{w}$ measures the local infinitesimal rotation of the mapping. A strictly conformal map would have zero local rotation of grid lines. Therefore, to achieve near-conformality, it is natural to demand that the rotational part of the displacement field be small. The simplest prescription is to set it to zero, which means making the displacement field $\\boldsymbol{w}$ irrotational. This gives the second equation of our system:\n$$ \\Delta q = 0 $$\nThus, the resulting Poisson-like system for the potentials $(p,q)$ is:\n$$ \\Delta p = \\frac{1 - J_{\\star}(x,y)}{J_{\\star}(x,y)} $$\n$$ \\Delta q = 0 $$\nThe potential $q$ controls the solenoidal (divergence-free) part of the displacement field $\\boldsymbol{w}$, which corresponds to local rotation. Setting $\\Delta q=0$ ensures the displacement is irrotational ($\\nabla \\times \\boldsymbol{w}=0$), which is a fundamental component of conformality and promotes grid orthogonality.\n\n**Task 2: Solvability Conditions**\n\nWe analyze the solvability of the Poisson equation $\\Delta \\phi = F(x,y)$ on a domain $\\Omega$ with periodic boundary conditions. By integrating both sides over the domain and applying the Divergence Theorem (or Green's second identity):\n$$ \\iint_{\\Omega} \\Delta \\phi \\,dx\\,dy = \\oint_{\\partial\\Omega} (\\nabla\\phi) \\cdot \\boldsymbol{n} \\,dS $$\nwhere $\\boldsymbol{n}$ is the outward unit normal to the boundary $\\partial\\Omega$.\nFor the periodic domain $\\Omega=[0,2\\pi]\\times[0,2\\pi]$, the boundary integral is:\n$$ \\int_0^{2\\pi} [\\phi_x(2\\pi,y) - \\phi_x(0,y)]\\,dy + \\int_0^{2\\pi} [\\phi_y(x,2\\pi) - \\phi_y(x,0)]\\,dx $$\nDue to the periodic boundary conditions on all derivatives of $\\phi$, we have $\\phi_x(2\\pi,y)=\\phi_x(0,y)$ and $\\phi_y(x,2\\pi)=\\phi_y(x,0)$. Consequently, the boundary integral is zero.\nThis leads to the solvability (or integrability) condition, known as the Fredholm alternative:\n$$ \\iint_{\\Omega} F(x,y) \\,dx\\,dy = 0 $$\nApplying this condition to our system:\n1.  For the equation $\\Delta p = \\frac{1-J_{\\star}}{J_{\\star}}$, the solvability condition is:\n    $$ \\iint_{\\Omega} \\frac{1 - J_{\\star}(x,y)}{J_{\\star}(x,y)} \\,dx\\,dy = 0 $$\n    This condition imposes a constraint on the prescribed target Jacobian field $J_{\\star}$.\n2.  For the equation $\\Delta q = 0$, the source term is $F(x,y) = 0$. The condition $\\iint_{\\Omega} 0 \\,dx\\,dy = 0$ is trivially satisfied, so a solution for $q$ always exists (up to an additive constant).\n\n**Task 3: Application to the Specific Case**\n\nWe are given $J_{\\star}(x,y) = 1 + \\alpha \\cos(x)\\cos(y)$ on $\\Omega=[0,2\\pi]\\times[0,2\\pi]$, and we must neglect terms of order $\\mathcal{O}(\\alpha^2)$.\nThe source term for the $\\Delta p$ equation is $F(x,y) = \\frac{1-J_{\\star}}{J_{\\star}} = \\frac{1 - (1 + \\alpha \\cos(x)\\cos(y))}{1 + \\alpha \\cos(x)\\cos(y))} = \\frac{-\\alpha \\cos(x)\\cos(y)}{1 + \\alpha \\cos(x)\\cos(y)}$.\nAs $|\\alpha|1$, we can expand this using the geometric series $1/(1+z) = 1 - z + z^2 - \\dots$:\n$$ F(x,y) = -\\alpha \\cos(x)\\cos(y) \\left(1 - \\alpha \\cos(x)\\cos(y) + \\mathcal{O}(\\alpha^2)\\right) = -\\alpha \\cos(x)\\cos(y) + \\mathcal{O}(\\alpha^2) $$\nTruncating to first order in $\\alpha$ as instructed, the system of PDEs becomes:\n$$ \\Delta p = -\\alpha \\cos(x)\\cos(y) $$\n$$ \\Delta q = 0 $$\nWe check the solvability condition for the $p$-equation:\n$$ \\iint_{\\Omega} -\\alpha \\cos(x)\\cos(y) \\,dx\\,dy = -\\alpha \\left(\\int_0^{2\\pi} \\cos(x)\\,dx\\right) \\left(\\int_0^{2\\pi} \\cos(y)\\,dy\\right) = -\\alpha \\cdot 0 \\cdot 0 = 0 $$\nThe condition is satisfied.\n\nNow we solve the PDEs with periodic boundary conditions.\nThe solution to $\\Delta q = 0$ on a periodic domain is any constant, $q(x,y) = C_q$. Since the displacement field depends only on derivatives of $q$, we can choose $C_q = 0$ without loss of generality.\nFor the $p$-equation, we seek a particular solution of the form $p(x,y) = A \\cos(x)\\cos(y)$.\n$$ \\Delta p = \\frac{\\partial^2}{\\partial x^2}(A \\cos(x)\\cos(y)) + \\frac{\\partial^2}{\\partial y^2}(A \\cos(x)\\cos(y)) $$\n$$ \\Delta p = -A \\cos(x)\\cos(y) - A \\cos(x)\\cos(y) = -2A \\cos(x)\\cos(y) $$\nComparing with the source term, $-2A \\cos(x)\\cos(y) = -\\alpha \\cos(x)\\cos(y)$, we find $A = \\frac{\\alpha}{2}$.\nThe general solution for $p$ is $p(x,y) = \\frac{\\alpha}{2} \\cos(x)\\cos(y) + C_p$, where $C_p$ is a constant (the homogeneous solution).\n\nFinally, we compute the displacement field $(u,v)$ and the map $(\\xi,\\eta)$.\n$$ u(x,y) = p_x - q_y = \\frac{\\partial}{\\partial x}\\left(\\frac{\\alpha}{2} \\cos(x)\\cos(y)\\right) - 0 = -\\frac{\\alpha}{2} \\sin(x)\\cos(y) $$\n$$ v(x,y) = p_y + q_x = \\frac{\\partial}{\\partial y}\\left(\\frac{\\alpha}{2} \\cos(x)\\cos(y)\\right) + 0 = -\\frac{\\alpha}{2} \\cos(x)\\sin(y) $$\nThe constant $C_p$ does not contribute to the displacement field.\nThe leading-order expressions for $\\xi(x,y)$ and $\\eta(x,y)$ are:\n$$ \\xi(x,y) = x + u(x,y) = x - \\frac{\\alpha}{2} \\sin(x)\\cos(y) $$\n$$ \\eta(x,y) = y + v(x,y) = y - \\frac{\\alpha}{2} \\cos(x)\\sin(y) $$\nThese expressions provide the required mapping to leading order in $\\alpha$.", "answer": "$$ \\boxed{ \\begin{pmatrix} x - \\frac{\\alpha}{2} \\sin(x)\\cos(y)  y - \\frac{\\alpha}{2} \\cos(x)\\sin(y) \\end{pmatrix} } $$", "id": "3362226"}, {"introduction": "Our final practice serves as a capstone, challenging you to translate theory into a robust numerical implementation. Here, you will construct a block-structured elliptic grid generator capable of handling realistic complexities, such as discontinuous grid control functions (the monitor tensor $\\mathbf{G}$) and non-matching grids across internal interfaces [@problem_id:3362190]. By developing a finite-volume solver from the ground up, you will master the practical details of discretizing elliptic PDEs and enforcing flux conservation in a multi-domain context. This exercise synthesizes the chapter's concepts and provides essential experience in building the computational tools used throughout numerical science and engineering.", "problem": "Consider the elliptic grid generation problem posed as the determination of two computational coordinates $\\,\\xi(x,y)\\,$ and $\\,\\eta(x,y)\\,$ over a physical domain $\\,\\Omega = [0,1]\\times[0,1]\\,$. Let there be an internal interface $\\,\\Gamma\\,$ given by $\\,x = 0.5\\,$ that partitions $\\,\\Omega\\,$ into two rectangular blocks $\\,\\Omega_L = [0,0.5]\\times[0,1]\\,$ and $\\,\\Omega_R = [0.5,1]\\times[0,1]\\,$. Let the monitor tensor $\\,\\mathbf{G}(x,y)\\,$ be piecewise constant and diagonal, and discontinuous across $\\,\\Gamma\\,$, specified by\n$$\n\\mathbf{G}(x,y) = \\begin{cases}\n\\mathrm{diag}\\big(g_{x,L},\\,g_{y,L}\\big),  (x,y)\\in \\Omega_L,\\\n$$4pt]\n\\mathrm{diag}\\big(g_{x,R},\\,g_{y,R}\\big),  (x,y)\\in \\Omega_R,\n\\end{cases}\n$$\nwhere each diagonal entry is strictly positive so that $\\,\\mathbf{G}\\,$ is symmetric positive definite (SPD). The grid is to be generated by solving the pair of elliptic Partial Differential Equations (PDEs)\n$$\n\\nabla\\cdot\\big(\\mathbf{G}\\,\\nabla \\xi\\big) = 0,\\qquad \\nabla\\cdot\\big(\\mathbf{G}\\,\\nabla \\eta\\big) = 0 \\quad \\text{in } \\Omega,\n$$\nsubject to boundary conditions that impose computational lines consistent with the physical boundary. For $\\,\\xi\\,$, prescribe Dirichlet data on all four sides,\n$$\n\\xi(0,y) = 0,\\quad \\xi(1,y) = 1,\\quad \\xi(x,0)=x,\\quad \\xi(x,1)=x.\n$$\nFor $\\,\\eta\\,$, prescribe\n$$\n\\eta(x,0) = 0,\\quad \\eta(x,1)=1,\\quad \\eta(0,y)=y,\\quad \\eta(1,y)=y.\n$$\nAcross the internal interface $\\,\\Gamma\\,$, the continuous formulation requires the interface conditions\n$$\n\\llbracket \\xi \\rrbracket_{\\Gamma} = 0,\\quad \\llbracket \\eta \\rrbracket_{\\Gamma} = 0,\\quad \\llbracket \\mathbf{G}\\,\\nabla \\xi\\cdot \\mathbf{n}\\rrbracket_{\\Gamma} = 0,\\quad \\llbracket \\mathbf{G}\\,\\nabla \\eta\\cdot \\mathbf{n}\\rrbracket_{\\Gamma} = 0,\n$$\nwhere $\\,\\mathbf{n}\\,$ is the unit normal to $\\,\\Gamma\\,$ pointing from $\\,\\Omega_L\\,$ to $\\,\\Omega_R\\,$, and $\\,\\llbracket \\cdot \\rrbracket_{\\Gamma}\\,$ denotes the jump across $\\,\\Gamma\\,$. Because $\\,\\Gamma\\,$ is vertical, $\\,\\mathbf{n}=(1,0)^\\top\\,$ and the flux continuity involves the $\\,g_x\\,$ entries of $\\,\\mathbf{G}\\,$.\n\nDiscretize $\\,\\Omega_L\\,$ and $\\,\\Omega_R\\,$ using two uniform, block-structured grids with potentially nonmatching resolutions: $\\,N_{x,L}\\times N_y\\,$ in $\\,\\Omega_L\\,$ and $\\,N_{x,R}\\times N_y\\,$ in $\\,\\Omega_R\\,$, where $\\,\\Delta x_L = 0.5/N_{x,L}\\,$, $\\,\\Delta x_R = 0.5/N_{x,R}\\,$, and $\\,\\Delta y = 1/N_y\\,$. Use a cell-centered finite-volume discretization based on the divergence theorem and conservation of normal fluxes across faces. Treat the diffusion operator with the diagonal tensor $\\,\\mathbf{G}\\,$ so that across a vertical face the normal flux depends only on $\\,g_x\\,$ and across a horizontal face only on $\\,g_y\\,$. On the outer boundaries, impose the Dirichlet data using face-centered half-cell distances. On the internal interface, impose the flux continuity by using a face transmissibility that correctly accounts for the two half-cell distances and the distinct normal monitor values on either side of $\\,\\Gamma\\,$. You must not alter $\\,\\Gamma\\,$ or introduce overlap; the two blocks must be coupled only through fluxes across $\\,\\Gamma\\,$. Solve the two linear systems for $\\,\\xi\\,$ and for $\\,\\eta\\,$.\n\nAfter solving, analyze the discrete satisfaction of the interface conditions on $\\,\\Gamma\\,$. Because the cell centers adjacent to $\\,\\Gamma\\,$ are offset from the interface by half-cells, estimate the interface continuity and flux continuity errors via one-sided, second-order interface reconstructions from each side. For each interface row index $\\,j\\in\\{0,1,\\dots,N_y-1\\}\\,$, let $\\,\\xi_{L}(j)\\,$ and $\\,\\xi_{L}^{-}(j)\\,$ denote the values at the last and next-to-last left cells, and $\\,\\xi_{R}(j)\\,$ and $\\,\\xi_{R}^{+}(j)\\,$ those at the first and second right cells along that row. Define the one-sided interface reconstructions\n$$\n\\xi_I^{L}(j) \\approx \\tfrac{3}{2}\\,\\xi_L(j)-\\tfrac{1}{2}\\,\\xi_L^{-}(j),\\qquad \\xi_I^{R}(j) \\approx \\tfrac{3}{2}\\,\\xi_R(j)-\\tfrac{1}{2}\\,\\xi_R^{+}(j),\n$$\nand analogously for $\\,\\eta\\,$. Define the approximate normal fluxes on $\\,\\Gamma\\,$ by\n$$\n\\mathcal{F}_\\xi^{L}(j) \\approx -\\,g_{x,L}\\,\\frac{\\xi_I^{L}(j)-\\xi_L(j)}{\\Delta x_L/2},\\quad \\mathcal{F}_\\xi^{R}(j) \\approx -\\,g_{x,R}\\,\\frac{\\xi_R(j)-\\xi_I^{R}(j)}{\\Delta x_R/2},\n$$\nand similarly for $\\,\\eta\\,$. Then measure the interface condition defects as\n$$\nE_{\\xi,\\mathrm{cont}} = \\max_j \\big|\\xi_I^{L}(j)-\\xi_I^{R}(j)\\big|,\\quad E_{\\xi,\\mathrm{flux}} = \\max_j \\big|\\mathcal{F}_\\xi^{L}(j)-\\mathcal{F}_\\xi^{R}(j)\\big|,\n$$\n$$\nE_{\\eta,\\mathrm{cont}} = \\max_j \\big|\\eta_I^{L}(j)-\\eta_I^{R}(j)\\big|,\\quad E_{\\eta,\\mathrm{flux}} = \\max_j \\big|\\mathcal{F}_\\eta^{L}(j)-\\mathcal{F}_\\eta^{R}(j)\\big|.\n$$\n\nImplement a complete program that:\n- Builds the two block-structured grids as specified.\n- Assembles and solves the two finite-volume linear systems for $\\,\\xi\\,$ and $\\,\\eta\\,$ using the diagonal piecewise-constant monitor $\\,\\mathbf{G}\\,$ and flux-coupled interface.\n- Computes the four interface defect metrics $\\,E_{\\xi,\\mathrm{cont}}\\,$, $\\,E_{\\xi,\\mathrm{flux}}\\,$, $\\,E_{\\eta,\\mathrm{cont}}\\,$, and $\\,E_{\\eta,\\mathrm{flux}}\\,$.\n\nYour program must run the following test suite and output the aggregated results.\n\nTest suite:\n- Case $\\,1\\,$ (baseline, matched blocks, isotropic monitor): $\\,N_{x,L}=16\\,$, $\\,N_{x,R}=16\\,$, $\\,N_y=16\\,$, $\\,g_{x,L}=1\\,$, $\\,g_{y,L}=1\\,$, $\\,g_{x,R}=1\\,$, $\\,g_{y,R}=1\\,$.\n- Case $\\,2\\,$ (nonmatching in the normal direction, anisotropy swaps): $\\,N_{x,L}=12\\,$, $\\,N_{x,R}=36\\,$, $\\,N_y=24\\,$, $\\,g_{x,L}=4\\,$, $\\,g_{y,L}=1\\,$, $\\,g_{x,R}=1\\,$, $\\,g_{y,R}=4\\,$.\n- Case $\\,3\\,$ (strongly discontinuous anisotropy and resolution jump): $\\,N_{x,L}=8\\,$, $\\,N_{x,R}=40\\,$, $\\,N_y=20\\,$, $\\,g_{x,L}=100\\,$, $\\,g_{y,L}=1\\,$, $\\,g_{x,R}=1\\,$, $\\,g_{y,R}=10\\,$.\n\nFinal output format:\n- Your program should produce a single line of output containing a list of length $\\,3\\,$, where each element is a list of the four floating-point metrics for the corresponding test case, in the order $\\,\\big[E_{\\xi,\\mathrm{cont}},E_{\\xi,\\mathrm{flux}},E_{\\eta,\\mathrm{cont}},E_{\\eta,\\mathrm{flux}}\\big]\\,$. The output must be enclosed in a single pair of square brackets and be comma-separated. For example: $\\,[[a_1,b_1,c_1,d_1],[a_2,b_2,c_2,d_2],[a_3,b_3,c_3,d_3]]\\,$. No physical units are involved because the problem is fully nondimensional.", "solution": "The problem statement is well-posed and scientifically sound. It describes a standard elliptic grid generation problem on a two-block domain with a discontinuous monitor tensor at the interface. This is a classic problem in numerical methods for Partial Differential Equations (PDEs). We will construct a solution using a cell-centered finite-volume method, as specified.\n\nThe core of the problem is to solve the two elliptic PDEs for the computational coordinates $\\xi(x,y)$ and $\\eta(x,y)$:\n$$\n\\nabla\\cdot\\big(\\mathbf{G}\\,\\nabla \\xi\\big) = 0\n$$\n$$\n\\nabla\\cdot\\big(\\mathbf{G}\\,\\nabla \\eta\\big) = 0\n$$\nwhere $\\mathbf{G}$ is a piecewise-constant, diagonal, symmetric positive-definite tensor. The domain $\\Omega=[0,1]\\times[0,1]$ is partitioned into $\\Omega_L = [0,0.5]\\times[0,1]$ and $\\Omega_R = [0.5,1]\\times[0,1]$.\n\nThe solution methodology involves discretizing the domain and the PDEs to form a system of linear algebraic equations, $\\mathbf{A}\\mathbf{u}=\\mathbf{b}$, where $\\mathbf{u}$ is a vector of the unknown cell-centered values of either $\\xi$ or $\\eta$. This system is then solved numerically. The structure of the matrix $\\mathbf{A}$ and the right-hand side vector $\\mathbf{b}$ arises from applying the divergence theorem to each cell in the discretized domain. For a generic cell $P$, the integrated PDE becomes a statement of flux conservation:\n$$\n\\sum_{f \\in \\partial P} \\int_f \\mathbf{F}\\cdot\\mathbf{n}\\,dS = 0\n$$\nwhere $\\mathbf{F} = -\\mathbf{G}\\nabla u$ (with $u$ being $\\xi$ or $\\eta$) is the flux vector, and the sum is over the faces of the cell.\n\nOur discretization uses two concatenated uniform grids, one for $\\Omega_L$ with $N_{x,L} \\times N_y$ cells of size $\\Delta x_L \\times \\Delta y$, and one for $\\Omega_R$ with $N_{x,R} \\times N_y$ cells of size $\\Delta x_R \\times \\Delta y$. The total number of unknowns is $(N_{x,L}+N_{x,R})\\times N_y$. We map the 2D grid of unknowns to a 1D vector for the linear system. The equation for each cell relates its value to the values of its four neighbors (north, south, east, west). This results in a sparse, banded matrix $\\mathbf{A}$.\n\nThe entries of the matrix $\\mathbf{A}$ and vector $\\mathbf{b}$ are determined by the \"transmissibility\" across cell faces. The flux between two adjacent cells, say $P$ and $E$ (east), is approximated as $F_{pe} = T_{pe} (u_P - u_E)$, where $T_{pe}$ is the transmissibility.\n\nFor an internal vertical face within $\\Omega_L$ or $\\Omega_R$, the transmissibility is $T = g_x \\Delta y / \\Delta x$, where $g_x$ and $\\Delta x$ are the local values. For an internal horizontal face, it is $T = g_y \\Delta x / \\Delta y$.\n\nAt the external boundaries, the Dirichlet conditions are imposed. For a boundary face $b$ adjacent to cell $P$, the flux is $F_{pb} = T_{pb}(u_P - u_b)$, where $u_b$ is the given boundary value. The distance to the boundary face is half a cell width, so the transmissibility is, for example, $T_{pb} = g_x \\Delta y / (\\Delta x/2)$ for a vertical boundary. The term $T_{pb}u_P$ contributes to the diagonal of $\\mathbf{A}$, while $T_{pb}u_b$ contributes to the right-hand side vector $\\mathbf{b}$. The boundary values $u_b$ are determined from the problem's specified functions, evaluated at the coordinates of the face centers.\n\nThe crucial part is the coupling at the internal interface $\\Gamma$ between $\\Omega_L$ and $\\Omega_R$. The flux continuity condition $\\llbracket \\mathbf{G}\\nabla u \\cdot \\mathbf{n} \\rrbracket_\\Gamma = 0$ is enforced by defining an effective interface transmissibility. The flux between the last cell in $\\Omega_L$ (cell $L$) and the first cell in $\\Omega_R$ (cell $R$) is $F_{LR} = T_{LR}(u_L - u_R)$. The transmissibility $T_{LR}$ is the harmonic average of the properties on both sides, accounting for the different grid spacings and monitor values:\n$$\nT_{LR} = \\frac{\\Delta y}{\\frac{\\Delta x_L/2}{g_{x,L}} + \\frac{\\Delta x_R/2}{g_{x,R}}}\n$$\nThis formulation correctly models the continuous flux across the discontinuous medium.\n\nTwo separate linear systems are assembled and solved: one for $\\xi$ and one for $\\eta$. While the matrix $\\mathbf{A}$ is identical for both (as it depends only on the grid and $\\mathbf{G}$), the right-hand side vectors $\\mathbf{b}$ are different due to the distinct boundary conditions for $\\xi$ and $\\eta$.\n\nAfter obtaining the discrete solutions for $\\xi$ and $\\eta$, we evaluate the quality of the solution at the interface $\\Gamma$. Since the cell centers do not lie on the interface, we first reconstruct the values of $\\xi$ and $\\eta$ on $\\Gamma$ from each side using the provided second-order one-sided extrapolation formulas:\n$$\nu_I^{L}(j) = \\frac{3}{2}u_L(j) - \\frac{1}{2}u_L^{-}(j)\n$$\n$$\nu_I^{R}(j) = \\frac{3}{2}u_R(j) - \\frac{1}{2}u_R^{+}(j)\n$$\nThe continuity error $E_{u,\\mathrm{cont}}$ is the maximum absolute difference $|u_I^L - u_I^R|$ over all interface locations $j$.\n\nNext, we reconstruct the normal fluxes at the interface from each side. The flux from the left block at the interface, $\\mathcal{F}_u^L(j)$, and from the right, $\\mathcal{F}_u^R(j)$, are estimated using the given finite-difference approximations involving the reconstructed interface values. For example, for $\\xi$:\n$$\n\\mathcal{F}_\\xi^L(j) = -g_{x,L} \\frac{\\xi_I^{L}(j) - \\xi_L(j)}{\\Delta x_L/2}\n$$\n$$\n\\mathcal{F}_\\xi^R(j) = -g_{x,R} \\frac{\\xi_R(j) - \\xi_I^{R}(j)}{\\Delta x_R/2}\n$$\nThe flux continuity error $E_{u,\\mathrm{flux}}$ is the maximum absolute difference $|\\mathcal{F}_u^L - \\mathcal{F}_u^R|$ over the interface. These four error metrics ($E_{\\xi,\\mathrm{cont}}$, $E_{\\xi,\\mathrm{flux}}$, $E_{\\eta,\\mathrm{cont}}$, $E_{\\eta,\\mathrm{flux}}$) are computed for each test case.", "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csc_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the elliptic grid generation problem.\n    \"\"\"\n    test_cases = [\n        # Case 1 (baseline, matched blocks, isotropic monitor)\n        {'N_xL': 16, 'N_xR': 16, 'N_y': 16, 'g_xL': 1.0, 'g_yL': 1.0, 'g_xR': 1.0, 'g_yR': 1.0},\n        # Case 2 (nonmatching in the normal direction, anisotropy swaps)\n        {'N_xL': 12, 'N_xR': 36, 'N_y': 24, 'g_xL': 4.0, 'g_yL': 1.0, 'g_xR': 1.0, 'g_yR': 4.0},\n        # Case 3 (strongly discontinuous anisotropy and resolution jump)\n        {'N_xL': 8, 'N_xR': 40, 'N_y': 20, 'g_xL': 100.0, 'g_yL': 1.0, 'g_xR': 1.0, 'g_yR': 10.0},\n    ]\n\n    def _build_and_solve(variable_type, params):\n        \"\"\"\n        Builds and solves the finite-volume system for a single variable (xi or eta).\n        \"\"\"\n        N_xL, N_xR, N_y = params['N_xL'], params['N_xR'], params['N_y']\n        g_xL, g_yL, g_xR, g_yR = params['g_xL'], params['g_yL'], params['g_xR'], params['g_yR']\n\n        N_x = N_xL + N_xR\n        N_total = N_x * N_y\n        dx_L = 0.5 / N_xL\n        dx_R = 0.5 / N_xR\n        dy = 1.0 / N_y\n\n        A = lil_matrix((N_total, N_total), dtype=np.float64)\n        b = np.zeros(N_total, dtype=np.float64)\n\n        x_centers = np.zeros(N_x)\n        x_centers[:N_xL] = (np.arange(N_xL) + 0.5) * dx_L\n        x_centers[N_xL:] = 0.5 + (np.arange(N_xR) + 0.5) * dx_R\n        y_centers = (np.arange(N_y) + 0.5) * dy\n\n        T_interface = dy / (dx_L / (2.0 * g_xL) + dx_R / (2.0 * g_xR))\n\n        for j in range(N_y):\n            for i in range(N_x):\n                k = j * N_x + i\n                diag_sum = 0.0\n\n                # West face\n                if i == 0:  # West boundary\n                    T_w = g_xL * dy / (dx_L / 2.0)\n                    diag_sum += T_w\n                    bc_val = 0.0 if variable_type == 'xi' else y_centers[j]\n                    b[k] += T_w * bc_val\n                elif i == N_xL:  # Interface from right block\n                    k_w = k - 1\n                    diag_sum += T_interface\n                    A[k, k_w] = -T_interface\n                else:  # Internal face\n                    k_w = k - 1\n                    g_x_loc = g_xL if i  N_xL else g_xR\n                    dx_loc = dx_L if i  N_xL else dx_R\n                    T_w = g_x_loc * dy / dx_loc\n                    diag_sum += T_w\n                    A[k, k_w] = -T_w\n\n                # East face\n                if i == N_x - 1:  # East boundary\n                    T_e = g_xR * dy / (dx_R / 2.0)\n                    diag_sum += T_e\n                    bc_val = 1.0 if variable_type == 'xi' else y_centers[j]\n                    b[k] += T_e * bc_val\n                elif i == N_xL - 1:  # Interface from left block\n                    k_e = k + 1\n                    diag_sum += T_interface\n                    A[k, k_e] = -T_interface\n                else:  # Internal face\n                    k_e = k + 1\n                    g_x_loc = g_xL if i  N_xL else g_xR\n                    dx_loc = dx_L if i  N_xL else dx_R\n                    T_e = g_x_loc * dy / dx_loc\n                    diag_sum += T_e\n                    A[k, k_e] = -T_e\n\n                # South face\n                g_y_loc = g_yL if i  N_xL else g_yR\n                dx_cell = dx_L if i  N_xL else dx_R\n                if j == 0:  # South boundary\n                    T_s = g_y_loc * dx_cell / (dy / 2.0)\n                    diag_sum += T_s\n                    bc_val = x_centers[i] if variable_type == 'xi' else 0.0\n                    b[k] += T_s * bc_val\n                else:  # Internal face\n                    k_s = k - N_x\n                    T_s = g_y_loc * dx_cell / dy\n                    diag_sum += T_s\n                    A[k, k_s] = -T_s\n                \n                # North face\n                if j == N_y - 1:  # North boundary\n                    T_n = g_y_loc * dx_cell / (dy / 2.0)\n                    diag_sum += T_n\n                    bc_val = x_centers[i] if variable_type == 'xi' else 1.0\n                    b[k] += T_n * bc_val\n                else:  # Internal face\n                    k_n = k + N_x\n                    T_n = g_y_loc * dx_cell / dy\n                    diag_sum += T_n\n                    A[k, k_n] = -T_n\n                \n                A[k, k] = diag_sum\n        \n        A_csc = csc_matrix(A)\n        solution_vec = spsolve(A_csc, b)\n        solution_grid = solution_vec.reshape((N_y, N_x))\n\n        # Calculate interface errors\n        E_cont_vals, E_flux_vals = [], []\n        for j in range(N_y):\n            val_L = solution_grid[j, N_xL - 1]\n            val_L_minus = solution_grid[j, N_xL - 2]\n            val_R = solution_grid[j, N_xL]\n            val_R_plus = solution_grid[j, N_xL + 1]\n\n            val_I_L = 1.5 * val_L - 0.5 * val_L_minus\n            val_I_R = 1.5 * val_R - 0.5 * val_R_plus\n            E_cont_vals.append(np.abs(val_I_L - val_I_R))\n\n            Flux_L = -g_xL * (val_I_L - val_L) / (dx_L / 2.0)\n            Flux_R = -g_xR * (val_R - val_I_R) / (dx_R / 2.0)\n            E_flux_vals.append(np.abs(Flux_L - Flux_R))\n\n        E_cont = np.max(E_cont_vals)\n        E_flux = np.max(E_flux_vals)\n        \n        return E_cont, E_flux\n\n    all_results = []\n    for case_params in test_cases:\n        E_xi_cont, E_xi_flux = _build_and_solve('xi', case_params)\n        E_eta_cont, E_eta_flux = _build_and_solve('eta', case_params)\n        all_results.append([E_xi_cont, E_xi_flux, E_eta_cont, E_eta_flux])\n\n    # Final print statement must match the exact required format.\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```", "id": "3362190"}]}