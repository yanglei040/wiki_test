{"hands_on_practices": [{"introduction": "At the heart of the Barnes-Hut algorithm lies the octree, a data structure that recursively partitions three-dimensional space to group particles hierarchically. Before analyzing its performance or accuracy, it is crucial to understand precisely how this tree is constructed. This exercise will guide you through a manual, step-by-step simulation of particle insertion and node subdivision, solidifying your grasp of the algorithm's fundamental mechanics. [@problem_id:3514300]", "problem": "Consider building an octree for use in the Barnes–Hut algorithm (BH) in three dimensions. The octree is constructed over a fixed root domain, which is the axis-aligned cube $[0,8)\\times[0,8)\\times[0,8)$. Each node stores an axis-aligned bounding box (AABB), and subdivision always halves the node’s box along each Cartesian axis at its midpoint. Each node can contain at most $n_{\\max}=1$ particle; upon inserting a second particle into a leaf node, that node is subdivided into its $8$ children, and the previously stored particle is re-inserted into the appropriate child. Child assignment uses half-open interval rules: for a node with bounds $[x_{0},x_{1})\\times[y_{0},y_{1})\\times[z_{0},z_{1})$, with midpoints $m_{x}=(x_{0}+x_{1})/2$, $m_{y}=(y_{0}+y_{1})/2$, $m_{z}=(z_{0}+z_{1})/2$, a particle with coordinates $(x,y,z)$ is assigned to the “low” side along an axis if its coordinate $c$ satisfies $c  m$ and to the “high” side if it satisfies $c \\ge m$, where $m$ is the corresponding midpoint.\n\nYou are given five particles, inserted in the order $\\mathbf{x}_{1},\\mathbf{x}_{2},\\mathbf{x}_{3},\\mathbf{x}_{4},\\mathbf{x}_{5}$ with coordinates\n$\\mathbf{x}_{1}=(1,1,1)$, $\\mathbf{x}_{2}=(2,2,2)$, $\\mathbf{x}_{3}=(6,3,1)$, $\\mathbf{x}_{4}=(7,3,1)$, $\\mathbf{x}_{5}=(6,6,6)$.\n\nTasks:\n- Using only the definitions above and Newtonian space partitioning concepts, outline the sequence of insertions and the corresponding subdivisions that occur. For every internal node created during this process (that is, every node that subdivides), determine its axis-aligned bounding box.\n- Let $\\mathcal{I}$ denote the set of all internal nodes created by the end of the insertion sequence. For each $u\\in\\mathcal{I}$, let $V_{u}$ be the volume of its bounding box, and let $V_{\\mathrm{root}}$ be the volume of the root domain. Compute the dimensionless sum\n$$\nS \\;=\\; \\sum_{u\\in\\mathcal{I}} \\frac{V_{u}}{V_{\\mathrm{root}}}.\n$$\n\nReport $S$ as a single exact number. Do not include any units in your final numerical answer.", "solution": "The problem requires us to simulate the construction of an octree according to the Barnes-Hut algorithm for a specific sequence of $5$ particles and then to compute a sum based on the volumes of the resulting internal nodes. The process is deterministic, governed by the provided rules for subdivision and particle assignment.\n\nThe root domain of the octree is the cube defined by the axis-aligned bounding box (AABB) $[0,8)\\times[0,8)\\times[0,8)$. The volume of this root domain is $V_{\\mathrm{root}} = (8-0)^3 = 8^3 = 512$. Each leaf node has a maximum capacity of $n_{\\max}=1$ particle.\n\nWe will trace the insertion of each particle in the specified order. An internal node is created whenever a leaf node containing a particle must be subdivided to accommodate a second particle. The set $\\mathcal{I}$ will be the collection of all such nodes that become internal during the entire insertion process.\n\n**Initial State:**\nThe octree consists of a single root node, which we will call $u_0$. It is a leaf node, it is empty, and its AABB is $\\mathrm{Box}(u_0) = [0,8)\\times[0,8)\\times[0,8)$.\n\n**1. Insertion of $\\mathbf{x}_{1}=(1,1,1)$**\nThe root node $u_0$ is empty. The particle $\\mathbf{x}_{1}$ is stored in $u_0$. The tree now consists of a single leaf node containing one particle. No subdivisions occur.\n\n**2. Insertion of $\\mathbf{x}_{2}=(2,2,2)$**\nParticle $\\mathbf{x}_{2}$ is to be inserted into the root node $u_0$. However, $u_0$ already contains $\\mathbf{x}_{1}$, so its capacity of $n_{\\max}=1$ is exceeded.\n- Node $u_0$ is subdivided into $8$ children and becomes an **internal node**. Thus, $u_0 \\in \\mathcal{I}$. Its AABB is $\\mathrm{Box}(u_0) = [0,8)\\times[0,8)\\times[0,8)$. The midpoints for subdivision are $(m_x, m_y, m_z) = (4,4,4)$.\n- The previously stored particle, $\\mathbf{x}_{1}=(1,1,1)$, must be re-inserted into the appropriate child of $u_0$. Since its coordinates satisfy $1  4$, $1  4$, and $1  4$, it is placed in the child node whose AABB is $[0,4)\\times[0,4)\\times[0,4)$. Let us call this node $u_1$.\n- Now, the new particle $\\mathbf{x}_{2}=(2,2,2)$ is inserted starting from the root $u_0$. Since its coordinates also satisfy $2  4$, $2  4$, and $2  4$, it is directed to the same child node $u_1$.\n- Node $u_1$ currently holds $\\mathbf{x}_{1}$. The attempt to insert $\\mathbf{x}_{2}$ exceeds its capacity.\n- Node $u_1$ is subdivided and becomes an **internal node**. Thus, $u_1 \\in \\mathcal{I}$. Its AABB is $\\mathrm{Box}(u_1) = [0,4)\\times[0,4)\\times[0,4)$. The midpoints for subdivision are $(m_x, m_y, m_z) = (2,2,2)$.\n- The old particle $\\mathbf{x}_{1}=(1,1,1)$ is re-inserted into a child of $u_1$. Since $1  2$, $1  2$, and $1  2$, it is placed in the leaf node with AABB $[0,2)\\times[0,2)\\times[0,2)$.\n- The new particle $\\mathbf{x}_{2}=(2,2,2)$ is inserted from $u_1$. The assignment rule for a coordinate $c$ and midpoint $m$ is $c  m$ for the \"low\" side and $c \\ge m$ for the \"high\" side. Here, $2 \\ge 2$, $2 \\ge 2$, and $2 \\ge 2$. Thus, $\\mathbf{x}_{2}$ is placed in the leaf node with AABB $[2,4)\\times[2,4)\\times[2,4)$.\n\n**3. Insertion of $\\mathbf{x}_{3}=(6,3,1)$**\n- Insertion begins at the root $u_0$ (an internal node with midpoints $(4,4,4)$). For $\\mathbf{x}_{3}=(6,3,1)$, we have $6 \\ge 4$, $3  4$, and $1  4$. This directs the particle to the child node corresponding to the AABB $[4,8)\\times[0,4)\\times[0,4)$. Let's call this node $u_2$.\n- Node $u_2$ was created as an empty leaf when $u_0$ was subdivided. It is empty, so $\\mathbf{x}_{3}$ is stored in $u_2$. No new subdivisions occur.\n\n**4. Insertion of $\\mathbf{x}_{4}=(7,3,1)$**\n- Insertion begins at the root $u_0$. For $\\mathbf{x}_{4}=(7,3,1)$, we have $7 \\ge 4$, $3  4$, and $1  4$. This again directs the particle to node $u_2$, which has AABB $[4,8)\\times[0,4)\\times[0,4)$.\n- Node $u_2$ already contains $\\mathbf{x}_{3}$, so its capacity is exceeded.\n- Node $u_2$ is subdivided and becomes an **internal node**. Thus, $u_2 \\in \\mathcal{I}$. Its AABB is $\\mathrm{Box}(u_2) = [4,8)\\times[0,4)\\times[0,4)$. The midpoints are $(m_x, m_y, m_z) = (6,2,2)$.\n- The old particle $\\mathbf{x}_{3}=(6,3,1)$ is re-inserted into a child of $u_2$. Since $6 \\ge 6$, $3 \\ge 2$, and $1  2$, it is placed in the child node with AABB $[6,8)\\times[2,4)\\times[0,2)$. Let us call this node $u_3$.\n- The new particle $\\mathbf{x}_{4}=(7,3,1)$ is inserted from $u_2$. Since $7 \\ge 6$, $3 \\ge 2$, and $1  2$, it is directed to the same child node $u_3$.\n- Node $u_3$ now holds $\\mathbf{x}_{3}$. The attempt to insert $\\mathbf{x}_{4}$ exceeds its capacity.\n- Node $u_3$ is subdivided and becomes an **internal node**. Thus, $u_3 \\in \\mathcal{I}$. Its AABB is $\\mathrm{Box}(u_3) = [6,8)\\times[2,4)\\times[0,2)$. The midpoints are $(m_x, m_y, m_z) = (7,3,1)$.\n- The old particle $\\mathbf{x}_{3}=(6,3,1)$ is re-inserted into a child of $u_3$. Since $6  7$, $3 \\ge 3$, and $1 \\ge 1$, it is placed in the leaf with AABB $[6,7)\\times[3,4)\\times[1,2)$.\n- The new particle $\\mathbf{x}_{4}=(7,3,1)$ is inserted from $u_3$. Since $7 \\ge 7$, $3 \\ge 3$, and $1 \\ge 1$, it is placed in the leaf with AABB $[7,8)\\times[3,4)\\times[1,2)$.\n\n**5. Insertion of $\\mathbf{x}_{5}=(6,6,6)$**\n- Insertion begins at the root $u_0$ (midpoints $(4,4,4)$). For $\\mathbf{x}_{5}=(6,6,6)$, we have $6 \\ge 4$, $6 \\ge 4$, and $6 \\ge 4$. This directs the particle to the child node with AABB $[4,8)\\times[4,8)\\times[4,8)$.\n- This node is an empty leaf. Particle $\\mathbf{x}_{5}$ is stored there. No new subdivisions occur.\n\n**Calculation of the Sum $S$**\nBy the end of the insertion sequence, the set of all created internal nodes is $\\mathcal{I} = \\{u_0, u_1, u_2, u_3\\}$. We now find the volume $V_u$ for each node $u \\in \\mathcal{I}$.\n1.  Node $u_0$: The root node with $\\mathrm{Box}(u_0) = [0,8)\\times[0,8)\\times[0,8)$. Its side length is $8$.\n    $V_{u_0} = 8^3 = 512$.\n2.  Node $u_1$: A child of $u_0$ with $\\mathrm{Box}(u_1) = [0,4)\\times[0,4)\\times[0,4)$. Its side length is $4$.\n    $V_{u_1} = 4^3 = 64$.\n3.  Node $u_2$: A child of $u_0$ with $\\mathrm{Box}(u_2) = [4,8)\\times[0,4)\\times[0,4)$. Its side length is $4$.\n    $V_{u_2} = 4^3 = 64$.\n4.  Node $u_3$: A child of $u_2$ with $\\mathrm{Box}(u_3) = [6,8)\\times[2,4)\\times[0,2)$. Its side length is $2$.\n    $V_{u_3} = 2^3 = 8$.\n\nThe volume of the root domain is $V_{\\mathrm{root}} = V_{u_0} = 512$.\n\nWe compute the dimensionless sum $S$:\n$$\nS \\;=\\; \\sum_{u\\in\\mathcal{I}} \\frac{V_{u}}{V_{\\mathrm{root}}} \\;=\\; \\frac{V_{u_0}}{V_{\\mathrm{root}}} + \\frac{V_{u_1}}{V_{\\mathrm{root}}} + \\frac{V_{u_2}}{V_{\\mathrm{root}}} + \\frac{V_{u_3}}{V_{\\mathrm{root}}}\n$$\nSubstituting the volumes:\n$$\nS \\;=\\; \\frac{512}{512} + \\frac{64}{512} + \\frac{64}{512} + \\frac{8}{512}\n$$\nSimplifying the fractions:\n$$\nS \\;=\\; 1 + \\frac{1}{8} + \\frac{1}{8} + \\frac{1}{64}\n$$\n$$\nS \\;=\\; 1 + \\frac{2}{8} + \\frac{1}{64} \\;=\\; 1 + \\frac{1}{4} + \\frac{1}{64}\n$$\nTo sum the fractions, we find a common denominator, which is $64$:\n$$\nS \\;=\\; \\frac{64}{64} + \\frac{16}{64} + \\frac{1}{64} \\;=\\; \\frac{64+16+1}{64} \\;=\\; \\frac{81}{64}\n$$\nThe sum $S$ is the exact number $\\frac{81}{64}$.", "answer": "$$\\boxed{\\frac{81}{64}}$$", "id": "3514300"}, {"introduction": "The primary advantage of the Barnes-Hut algorithm over direct $O(N^2)$ summation is its significantly better scaling performance. This practice connects the theoretical $O(N \\ln N)$ complexity to a tangible, empirical model by analyzing the operational costs of tree traversal and particle interactions. By fitting a model to timing data, you will gain practical experience in performance analysis, a vital skill for any computational scientist. [@problem_id:3514370]", "problem": "In a self-gravitating $N$-body simulation in three spatial dimensions using the Barnes–Hut (BH) algorithm, the gravitational acceleration on each particle is computed by traversing an octree and applying a multipole approximation where an opening-angle criterion decides whether to accept a cell’s multipole or to descend to its children. Consider a uniform particle distribution in a unit cube with total particle number $N$, an opening angle parameter $\\theta$ (in radians), and a leaf capacity of $n_{\\ell}$ particles. The cost per particle can be modeled by two components: visits to internal nodes (cell multipole interactions) and near-field leaf or particle interactions. Assume the following foundational facts and definitions:\n- Each particle’s tree walk descends from the root, and at each level the number of accepted cells is approximately bounded independent of $N$ for fixed $\\theta$ in a uniform configuration. The number of levels grows like $\\ln N$ because the octree refines until leaves have $O(1)$ occupancy set by $n_{\\ell}$.\n- Consequently, the average number of accepted internal nodes per particle scales as $c_{1} \\ln N + c_{2}$, where $c_{1}$ and $c_{2}$ are geometry- and $\\theta$-dependent constants that do not depend on $N$.\n- The average number of near-field particle-level interactions per particle is approximately constant, $c_{3}$, for fixed $\\theta$ and $n_{\\ell}$ under a uniform distribution, because only $O(1)$ neighboring leaves contribute direct interactions.\n\nSuppose a detailed operation audit of the code gives the following per-event costs measured on a fixed single-threaded platform:\n- An accepted internal node “visit” (including opening-angle test, multipole evaluation, and accumulation) has a measured wall time of $t_{v}$ seconds per visit.\n- A direct near-field particle-particle interaction has a measured wall time of $t_{p}$ seconds per interaction.\n\nDerive a practical runtime model of the form $T(N) = a N \\ln N + b N$, with $a$ and $b$ expressed in terms of $t_{v}$, $t_{p}$, $c_{1}$, $c_{2}$, and $c_{3}$. You may take the logarithm to be the natural logarithm. Then, using the two sample timing measurements obtained on the same platform and code configuration,\n- $T(10^{5}) = 0.04154$ seconds,\n- $T(10^{6}) = 0.4845$ seconds,\nfit the coefficients $a$ and $b$ in $T(N) = a N \\ln N + b N$ from these data alone. Report $a$ and $b$ in seconds, rounded to four significant figures. Express your final numerical values for $a$ and $b$ using scientific notation $a \\times 10^{b}$.", "solution": "The problem asks for two tasks: first, to derive a theoretical runtime model for the Barnes-Hut algorithm based on provided scaling relations and per-event costs, and second, to fit the coefficients of this model using two experimental timing measurements.\n\nPart 1: Derivation of the Runtime Model\n\nThe total runtime, $T(N)$, for an $N$-body simulation is the total number of particles, $N$, multiplied by the average computational cost per particle. The cost per particle is given as the sum of two components: the cost of interacting with internal nodes (cell multipoles) and the cost of direct near-field particle-particle interactions.\n\nLet us define the average cost per particle, $T_{\\text{particle}}(N)$.\nThe problem states that the average number of accepted internal node \"visits\" per particle scales as $c_{1} \\ln N + c_{2}$. The measured wall time for each such visit is $t_{v}$. Therefore, the time spent on internal node interactions per particle is:\n$$ T_{\\text{visits/particle}}(N) = (c_{1} \\ln N + c_{2}) t_{v} $$\n\nThe problem also states that the average number of near-field particle-particle interactions per particle is a constant, $c_{3}$. The measured wall time for each direct interaction is $t_{p}$. Therefore, the time spent on near-field interactions per particle is:\n$$ T_{\\text{particles/particle}} = c_{3} t_{p} $$\n\nThe total average time cost per particle is the sum of these two components:\n$$ T_{\\text{particle}}(N) = T_{\\text{visits/particle}}(N) + T_{\\text{particles/particle}} = (c_{1} \\ln N + c_{2}) t_{v} + c_{3} t_{p} $$\n\nThe total runtime $T(N)$ for all $N$ particles is $N$ times the average cost per particle:\n$$ T(N) = N \\cdot T_{\\text{particle}}(N) = N \\left[ (c_{1} \\ln N + c_{2}) t_{v} + c_{3} t_{p} \\right] $$\n\nTo match the specified form $T(N) = a N \\ln N + b N$, we distribute the terms:\n$$ T(N) = N (c_{1} t_{v} \\ln N + c_{2} t_{v} + c_{3} t_{p}) $$\n$$ T(N) = (c_{1} t_{v}) N \\ln N + (c_{2} t_{v} + c_{3} t_{p}) N $$\n\nBy comparing this expression with the model $T(N) = a N \\ln N + b N$, we can identify the coefficients $a$ and $b$ in terms of the given parameters:\n$$ a = c_{1} t_{v} $$\n$$ b = c_{2} t_{v} + c_{3} t_{p} $$\nThis completes the derivation of the model's coefficients.\n\nPart 2: Fitting the Coefficients from Data\n\nWe are given the model $T(N) = a N \\ln N + b N$ and two data points:\n1. $N_{1} = 10^{5}$, $T(N_{1}) = 0.04154$ seconds.\n2. $N_{2} = 10^{6}$, $T(N_{2}) = 0.4845$ seconds.\n\nTo find the coefficients $a$ and $b$, we can set up a system of two linear equations. It is convenient to first divide the model equation by $N$:\n$$ \\frac{T(N)}{N} = a \\ln N + b $$\n\nSubstituting the two data points into this form gives:\nFor $(N_{1}, T(N_{1}))$:\n$$ \\frac{0.04154}{10^{5}} = a \\ln(10^{5}) + b $$\n$$ 4.154 \\times 10^{-7} = a (5 \\ln 10) + b \\quad (1) $$\n\nFor $(N_{2}, T(N_{2}))$:\n$$ \\frac{0.4845}{10^{6}} = a \\ln(10^{6}) + b $$\n$$ 4.845 \\times 10^{-7} = a (6 \\ln 10) + b \\quad (2) $$\n\nWe now solve this system of two linear equations for $a$ and $b$. Subtracting equation (1) from equation (2) eliminates $b$:\n$$ (4.845 \\times 10^{-7}) - (4.154 \\times 10^{-7}) = (a (6 \\ln 10) + b) - (a (5 \\ln 10) + b) $$\n$$ 0.691 \\times 10^{-7} = a (6 \\ln 10 - 5 \\ln 10) $$\n$$ 0.691 \\times 10^{-7} = a \\ln 10 $$\n\nSolving for $a$:\n$$ a = \\frac{0.691 \\times 10^{-7}}{\\ln 10} = \\frac{6.91 \\times 10^{-8}}{\\ln 10} $$\n\nNow, we substitute this expression for $a$ back into equation (1) to solve for $b$:\n$$ b = 4.154 \\times 10^{-7} - a (5 \\ln 10) $$\n$$ b = 4.154 \\times 10^{-7} - \\left(\\frac{6.91 \\times 10^{-8}}{\\ln 10}\\right) (5 \\ln 10) $$\n$$ b = 4.154 \\times 10^{-7} - 5 \\times (6.91 \\times 10^{-8}) $$\n$$ b = 4.154 \\times 10^{-7} - 3.455 \\times 10^{-7} $$\n$$ b = (4.154 - 3.455) \\times 10^{-7} = 0.699 \\times 10^{-7} = 6.99 \\times 10^{-8} $$\n\nThe problem requires the final numerical values for $a$ and $b$, rounded to four significant figures and expressed in scientific notation. We use the value $\\ln 10 \\approx 2.30258509$.\n\nFor $a$:\n$$ a = \\frac{6.91 \\times 10^{-8}}{2.30258509} \\approx 2.9990306 \\times 10^{-8} $$\nRounding to four significant figures, we get:\n$$ a \\approx 2.999 \\times 10^{-8} $$\n\nFor $b$:\n$$ b = 6.99 \\times 10^{-8} $$\nTo express this value with four significant figures, we append a zero:\n$$ b = 6.990 \\times 10^{-8} $$\n\nThe units for $a$ and $b$ are seconds, as they are derived from time measurements.\nThe fitted model is $T(N) \\approx (2.999 \\times 10^{-8}) N \\ln N + (6.990 \\times 10^{-8}) N$.", "answer": "$$ \\boxed{ \\begin{pmatrix} 2.999 \\times 10^{-8}  6.990 \\times 10^{-8} \\end{pmatrix} } $$", "id": "3514370"}, {"introduction": "Efficiency in the Barnes-Hut algorithm is achieved by approximating the gravitational influence of distant particle groups, which introduces a controlled error. This exercise delves into the physics of this trade-off, requiring a first-principles derivation of the force error from the multipole expansion for a symmetric mass distribution. You will see firsthand how the geometry of a node can cause higher-order multipole moments to vanish, leading to surprisingly high accuracy even with simple approximations. [@problem_id:3514331]", "problem": "Consider Newtonian gravity with gravitational potential $\\Phi(\\mathbf{r})$ generated by a mass density $\\rho(\\mathbf{r}')$ via\n$$\n\\Phi(\\mathbf{r}) \\;=\\; -\\,G \\int \\frac{\\rho(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|}\\,d^3\\mathbf{r}'\\,,\n$$\nand gravitational force $\\mathbf{F}(\\mathbf{r}) \\;=\\; -\\,\\nabla \\Phi(\\mathbf{r})$. In the Barnes–Hut algorithm, a distant collection of sources is approximated by a truncated multipole expansion about its center of mass. Let a single tree node be a uniform-density cube of side length $s$ and total mass $M$, centered at the origin and aligned with the coordinate axes. Place a test particle on the positive $z$-axis at $\\mathbf{r}=(0,0,d)$ with $d \\gg s$.\n\nDefine the relative force error for a truncation by\n$$\n\\varepsilon \\;\\equiv\\; \\frac{\\left\\|\\mathbf{F}_{\\text{exact}}-\\mathbf{F}_{\\text{approx}}\\right\\|}{\\left\\|\\mathbf{F}_{\\text{exact}}\\right\\|}\\,.\n$$\nStarting only from the potential integral above and standard far-field expansions of $|\\mathbf{r}-\\mathbf{r}'|^{-1}$ that are valid when $|\\mathbf{r}'||\\mathbf{r}|$, perform the following:\n\n1) Using the monopole approximation (retaining only the total mass at the center of mass), derive the leading-order asymptotic form of the relative force error $\\varepsilon_{\\text{mono}}$ as $s/d \\to 0$ for this uniform cube, and determine the exact constant $C_{\\text{mono}}$ in\n$$\n\\varepsilon_{\\text{mono}} \\;=\\; C_{\\text{mono}}\\left(\\frac{s}{d}\\right)^{p} \\;+\\; \\mathcal{O}\\!\\left(\\left(\\frac{s}{d}\\right)^{p+2}\\right),\n$$\nincluding both the exponent $p$ and the constant $C_{\\text{mono}}$.\n\n2) Using the quadrupole truncation (retaining monopole and quadrupole moments about the center of mass), repeat the derivation to obtain the leading-order asymptotic form $\\varepsilon_{\\text{quad}}$ and the exact constant $C_{\\text{quad}}$ in\n$\n\\varepsilon_{\\text{quad}} \\;=\\; C_{\\text{quad}}\\left(\\frac{s}{d}\\right)^{q} \\;+\\; \\mathcal{O}\\!\\left(\\left(\\frac{s}{d}\\right)^{q+2}\\right),\n$\nincluding both the exponent $q$ and the constant $C_{\\text{quad}}$.\n\nWork explicitly with the cube of uniform density $\\rho = M/s^3$ and the observation point on the face-normal axis as specified. Express your final answer as a single row matrix containing the two exact constants $C_{\\text{mono}}$ and $C_{\\text{quad}}$. No rounding is required. The final answer is dimensionless. Do not include units.", "solution": "The problem requires the calculation of the leading-order relative force error for monopole and quadrupole approximations of the gravitational field of a uniform cube. The test mass is located on an axis passing through the center of the cube and normal to one of its faces.\n\nFirst, we validate the problem statement.\nThe problem is set within the framework of Newtonian gravity and uses standard mathematical techniques of multipole expansion. The object is a well-defined geometric shape with uniform density. The task is to perform a specific, formal derivation. All components are scientifically grounded, well-posed, and objective. There are no contradictions, missing information, or pseudo-scientific claims. The problem is valid.\n\nWe begin by calculating the gravitational potential $\\Phi(\\mathbf{r})$ for a test particle at $\\mathbf{r}=(0,0,d)$ generated by a uniform cube of mass $M$ and side length $s$ centered at the origin. The density is $\\rho = M/s^3$ for $\\mathbf{r}'=(x',y',z') \\in [-s/2, s/2]^3$.\nThe potential is given by the integral:\n$$\n\\Phi(\\mathbf{r}) = -G \\int_{V'} \\frac{\\rho(\\mathbf{r}')}{|\\mathbf{r}-\\mathbf{r}'|} d^3\\mathbf{r}'\n$$\nFor $\\mathbf{r}=(0,0,d)$ and a source point $\\mathbf{r}'=(x',y',z')$, the distance is $|\\mathbf{r}-\\mathbf{r}'| = \\sqrt{(x')^2 + (y')^2 + (d-z')^2}$.\nFor a distant particle ($d \\gg s \\ge |\\mathbf{r}'|$), we expand the term $|\\mathbf{r}-\\mathbf{r}'|^{-1}$ using the multipole expansion in terms of Legendre polynomials, $P_l(u)$:\n$$\n\\frac{1}{|\\mathbf{r}-\\mathbf{r}'|} = \\frac{1}{|\\mathbf{r}|} \\sum_{l=0}^{\\infty} \\left(\\frac{|\\mathbf{r}'|}{|\\mathbf{r}|}\\right)^l P_l(\\hat{\\mathbf{r}}\\cdot\\hat{\\mathbf{r}}')\n$$\nHere, $|\\mathbf{r}| = d$, $\\hat{\\mathbf{r}} = \\hat{\\mathbf{z}}$, so $\\hat{\\mathbf{r}}\\cdot\\hat{\\mathbf{r}}' = z'/|\\mathbf{r}'|$. The potential becomes:\n$$\n\\Phi(d) = -G \\sum_{l=0}^{\\infty} \\frac{1}{d^{l+1}} \\int_{V'} \\rho(\\mathbf{r}') |\\mathbf{r}'|^l P_l(z'/|\\mathbf{r}'|) d^3\\mathbf{r}'\n$$\nWe evaluate the first few terms of this series, which correspond to the monopole ($l=0$), dipole ($l=1$), quadrupole ($l=2$), octupole ($l=3$), and hexadecapole ($l=4$) moments.\n\nThe mass distribution is symmetric with respect to reflections across the planes $x'=0$, $y'=0$, and $z'=0$. This implies that any integral of a function that is odd in $x'$, $y'$, or $z'$ over the volume of the cube will be zero.\n\n$l=0$: Monopole term. $P_0(u)=1$.\n$$\n\\Phi_0 = -\\frac{G}{d} \\int_{V'} \\rho(\\mathbf{r}') d^3\\mathbf{r}' = -\\frac{GM}{d}\n$$\n\n$l=1$: Dipole term. $P_1(u)=u$.\n$$\n\\Phi_1 = -\\frac{G}{d^2} \\int_{V'} \\rho(\\mathbf{r}') |\\mathbf{r}'| \\left(\\frac{z'}{|\\mathbf{r}'|}\\right) d^3\\mathbf{r}' = -\\frac{G}{d^2} \\int_{V'} \\rho(\\mathbf{r}') z' d^3\\mathbf{r}' = 0\n$$\nThe integral vanishes due to the integrand being odd in $z'$. This is expected as the center of mass is at the origin.\n\n$l=2$: Quadrupole term. $P_2(u) = \\frac{1}{2}(3u^2-1)$.\n$$\n\\Phi_2 = -\\frac{G}{d^3} \\int_{V'} \\rho |\\mathbf{r}'|^2 \\frac{1}{2}\\left(3\\frac{(z')^2}{|\\mathbf{r}'|^2}-1\\right) d^3\\mathbf{r}' = -\\frac{G}{2d^3} \\int_{V'} \\rho (3(z')^2 - |\\mathbf{r}'|^2) d^3\\mathbf{r}'\n$$\nThe integral is $\\int \\rho (3(z')^2 - ((x')^2+(y')^2+(z')^2)) d^3\\mathbf{r}' = \\int \\rho (2(z')^2 - (x')^2 - (y')^2) d^3\\mathbf{r}'$.\nDue to the cubic symmetry of the mass distribution, $\\int \\rho (x')^2 dV = \\int \\rho (y')^2 dV = \\int \\rho (z')^2 dV$. Thus the integral is zero. $\\Phi_2=0$.\n\n$l=3$: Octupole term. $P_3(u) = \\frac{1}{2}(5u^3-3u)$.\n$$\n\\Phi_3 = -\\frac{G}{2d^4} \\int_{V'} \\rho (5(z')^3 - 3z'|\\mathbf{r}'|^2) d^3\\mathbf{r}'\n$$\nThe integrand is a sum of terms that are odd in $z'$, so the integral vanishes by symmetry. $\\Phi_3=0$.\n\n$l=4$: Hexadecapole term. $P_4(u) = \\frac{1}{8}(35u^4 - 30u^2 + 3)$. This is the first non-vanishing term after the monopole.\n$$\n\\Phi_4 = -\\frac{G}{8d^5} \\int_{V'} \\rho (35(z')^4 - 30(z')^2|\\mathbf{r}'|^2 + 3|\\mathbf{r}'|^4) d^3\\mathbf{r}'\n$$\nLet's evaluate the required moment integrals. Let $\\rho = M/s^3$.\n$$\n\\int_{V'} (z')^4 \\rho dV = \\frac{M}{s^3} \\int_{-s/2}^{s/2} s^2 (z')^4 dz' = \\frac{M}{s} \\left[\\frac{(z')^5}{5}\\right]_{-s/2}^{s/2} = \\frac{M}{s} \\frac{2(s/2)^5}{5} = \\frac{Ms^4}{80}\n$$\nBy symmetry, $\\int \\rho (x')^4 dV = \\int \\rho (y')^4 dV = \\int \\rho (z')^4 dV = \\frac{Ms^4}{80}$.\nThe cross-term integrals like $\\int (x')^2(z')^2 \\rho dV$ are separable due to the cubic domain:\n$$\n\\int_{V'} (x')^2(z')^2 \\rho dV = \\frac{M}{s^3} \\left(\\int_{-s/2}^{s/2} (x')^2 dx'\\right) \\left(\\int_{-s/2}^{s/2} dy'\\right) \\left(\\int_{-s/2}^{s/2} (z')^2 dz'\\right) = \\frac{M}{s^3} \\left(\\frac{s^3}{12}\\right) (s) \\left(\\frac{s^3}{12}\\right) = \\frac{Ms^4}{144}\n$$\nLet $I_{klm} = \\int \\rho (x')^k (y')^l (z')^m dV$. By symmetry, $I_{400}=I_{040}=I_{004}=\\frac{Ms^4}{80}$ and $I_{220}=I_{202}=I_{022}=\\frac{Ms^4}{144}$.\nThe integral for $\\Phi_4$, let's call it $I_4$, is:\n$I_4 = \\int \\rho [35(z')^4 - 30(z')^2((x')^2+(y')^2+(z')^2) + 3((x')^2+(y')^2+(z')^2)^2] dV$\n$I_4 = 35 I_{004} - 30(I_{202}+I_{022}+I_{004}) + 3(I_{400}+I_{040}+I_{004} + 2(I_{220}+I_{022}+I_{202}))$\nSubstituting the values and using symmetry:\n$I_4 = (35-30+3+3+3)I_{004} + (-30-30+6+6+6)I_{220} = 14 I_{004} - 42 I_{220}$\n$I_4 = 14 \\frac{Ms^4}{80} - 42 \\frac{Ms^4}{144} = \\frac{7}{40}Ms^4 - \\frac{7}{24}Ms^4 = Ms^4 \\left(\\frac{21-35}{120}\\right) = -\\frac{14Ms^4}{120} = -\\frac{7Ms^4}{60}$.\nSubstituting this back into the expression for $\\Phi_4$:\n$$\n\\Phi_4 = -\\frac{G}{8d^5}\\left(-\\frac{7Ms^4}{60}\\right) = \\frac{7GMs^4}{480d^5}\n$$\nThe total potential is $\\Phi_{\\text{exact}}(d) = -\\frac{GM}{d} + \\frac{7GMs^4}{480d^5} + \\mathcal{O}(d^{-7})$.\nThe gravitational force is purely in the $z$-direction due to symmetry: $\\mathbf{F} = F_z \\hat{\\mathbf{z}}$, where $F_z = -\\frac{\\partial\\Phi}{\\partial d}$.\n$$\nF_{z, \\text{exact}} = -\\frac{\\partial}{\\partial d} \\left(-\\frac{GM}{d} + \\frac{7GMs^4}{480d^5} + \\dots\\right) = -\\frac{GM}{d^2} + \\frac{7GMs^4}{480}(-5d^{-6}) + \\dots\n$$\n$$\nF_{z, \\text{exact}} = -\\frac{GM}{d^2} + \\frac{35GMs^4}{480d^6} + \\mathcal{O}(d^{-8}) = -\\frac{GM}{d^2} + \\frac{7GMs^4}{96d^6} + \\mathcal{O}(d^{-8})\n$$\nThe force vector is $\\mathbf{F}_{\\text{exact}} = \\left(-\\frac{GM}{d^2} + \\frac{7GMs^4}{96d^6} + \\dots\\right)\\hat{\\mathbf{z}}$.\n\n1) Monopole Approximation\nThe monopole approximation retains only the $l=0$ term.\n$\\Phi_{\\text{mono}}(d) = -\\frac{GM}{d}$.\n$F_{z, \\text{mono}} = -\\frac{\\partial \\Phi_{\\text{mono}}}{\\partial d} = -\\frac{GM}{d^2}$.\n$\\mathbf{F}_{\\text{mono}} = -\\frac{GM}{d^2}\\hat{\\mathbf{z}}$.\nThe force error is:\n$$\n\\mathbf{F}_{\\text{exact}} - \\mathbf{F}_{\\text{mono}} = \\left(\\frac{7GMs^4}{96d^6} + \\mathcal{O}(d^{-8})\\right)\\hat{\\mathbf{z}}\n$$\nThe relative error $\\varepsilon_{\\text{mono}}$ is:\n$$\n\\varepsilon_{\\text{mono}} = \\frac{\\|\\mathbf{F}_{\\text{exact}} - \\mathbf{F}_{\\text{mono}}\\|}{\\|\\mathbf{F}_{\\text{exact}}\\|} = \\frac{\\left|\\frac{7GMs^4}{96d^6} + \\mathcal{O}(d^{-8})\\right|}{\\left|-\\frac{GM}{d^2} + \\frac{7GMs^4}{96d^6} + \\mathcal{O}(d^{-8})\\right|}\n$$\nTaking the leading terms for small $s/d$:\n$$\n\\varepsilon_{\\text{mono}} = \\frac{\\frac{7GMs^4}{96d^6}}{\\frac{GM}{d^2}} \\left(1 + \\mathcal{O}\\left(\\frac{s^2}{d^2}\\right)\\right) = \\frac{7s^4}{96d^4} + \\mathcal{O}\\left(\\frac{s^6}{d^6}\\right)\n$$\nThis is of the form $C_{\\text{mono}}(s/d)^p + \\mathcal{O}((s/d)^{p+2})$, with $p=4$. The constant is $C_{\\text{mono}} = \\frac{7}{96}$.\n\n2) Quadrupole Approximation\nThe quadrupole truncation includes moments up to $l=2$.\n$\\Phi_{\\text{quad}}(d) = \\Phi_0 + \\Phi_1 + \\Phi_2$.\nAs we have shown, for this specific geometry, $\\Phi_1 = 0$ and $\\Phi_2 = 0$.\nTherefore, $\\Phi_{\\text{quad}}(d) = \\Phi_0 = -\\frac{GM}{d}$.\nThis means the quadrupole approximation for the potential is identical to the monopole approximation.\nConsequently, the approximated force is also the same:\n$\\mathbf{F}_{\\text{quad}} = -\\nabla \\Phi_{\\text{quad}} = -\\nabla \\Phi_{\\text{mono}} = \\mathbf{F}_{\\text{mono}}$.\nThe error in the quadrupole approximation is thus identical to the error in the monopole approximation:\n$$\n\\mathbf{F}_{\\text{exact}} - \\mathbf{F}_{\\text{quad}} = \\mathbf{F}_{\\text{exact}} - \\mathbf{F}_{\\text{mono}}\n$$\nThe relative error $\\varepsilon_{\\text{quad}}$ is therefore:\n$$\n\\varepsilon_{\\text{quad}} = \\frac{\\|\\mathbf{F}_{\\text{exact}} - \\mathbf{F}_{\\text{quad}}\\|}{\\|\\mathbf{F}_{\\text{exact}}\\|} = \\varepsilon_{\\text{mono}} = \\frac{7}{96}\\left(\\frac{s}{d}\\right)^4 + \\mathcal{O}\\left(\\left(\\frac{s}{d}\\right)^6\\right)\n$$\nThis is of the form $C_{\\text{quad}}(s/d)^q + \\mathcal{O}((s/d)^{q+2})$ with $q=4$. The constant is $C_{\\text{quad}} = \\frac{7}{96}$.\n\nThe problem highlights a crucial feature of multipole expansions: symmetries in the source distribution can cause several low-order multipole moments to vanish, making the approximation error smaller than for a generic distribution of the same size. For the specific case of a uniform cube observed along a symmetry axis, the dipole, quadrupole, and octupole contributions to the on-axis potential are all zero. The first correction to the monopole term comes from the hexadecapole ($l=4$) moment. As a result, both the monopole and quadrupole approximations result in the same approximated force, and their error is governed by the same leading-order term.\n\nThe two constants are $C_{\\text{mono}} = \\frac{7}{96}$ and $C_{\\text{quad}} = \\frac{7}{96}$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{7}{96}  \\frac{7}{96}\n\\end{pmatrix}\n}\n$$", "id": "3514331"}]}