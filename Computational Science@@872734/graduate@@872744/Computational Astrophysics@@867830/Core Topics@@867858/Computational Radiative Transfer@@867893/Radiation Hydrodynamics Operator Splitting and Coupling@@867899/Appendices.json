{"hands_on_practices": [{"introduction": "The tight coupling between matter and radiation often leads to \"stiff\" equations, where explicit time-stepping methods would require prohibitively small time steps. This practice drills into the core of the implicit methods used to overcome this stiffness, focusing on a single Newton-Raphson step—the workhorse algorithm for solving the nonlinear equations that arise in a single computational cell. By manually computing an update step, you will gain a concrete understanding of how these powerful solvers iteratively approach a self-consistent solution for radiation energy $E_r$ and gas temperature $T$. [@problem_id:3530860]", "problem": "In gray Radiation Hydrodynamics (RHD) under operator splitting, the stiff matter–radiation energy exchange within a single computational cell is advanced implicitly over one time step. Let the coupled unknowns be the radiation energy density $E_{r}$ and the gas temperature $T$. At Newton–Raphson (NR) iteration $k$ of the implicit source solve, the nonlinear residual vector $\\mathbf{R}(E_{r},T)$ and its Jacobian matrix $\\mathbf{J}(E_{r},T)$ have been assembled at the current iterate $(E_{r}^{(k)},T^{(k)})$.\n\nSuppose that at a particular cell and iteration you are given\n$$\n\\mathbf{R}\\big(E_{r}^{(k)},T^{(k)}\\big)\n=\n\\begin{pmatrix}\n2.0\\times 10^{10} \\\\\n-1.0\\times 10^{11}\n\\end{pmatrix}\n\\quad\\text{and}\\quad\n\\mathbf{J}\\big(E_{r}^{(k)},T^{(k)}\\big)\n=\n\\begin{pmatrix}\n101  -3.024\\times 10^{6} \\\\\n-100  1.3024\\times 10^{7}\n\\end{pmatrix},\n$$\nwith the current iterate\n$$\nE_{r}^{(k)} = 1.0\\times 10^{12}, \\qquad T^{(k)} = 1.0\\times 10^{6}.\n$$\nHere, all entries of $\\mathbf{R}$ have units of $\\mathrm{erg}\\,\\mathrm{cm}^{-3}$, the first column of $\\mathbf{J}$ has units consistent with $\\partial \\mathbf{R}/\\partial E_{r}$, and the second column has units consistent with $\\partial \\mathbf{R}/\\partial T$.\n\nUsing the Newton–Raphson linearization of the implicit source equations, compute one Newton step update vector $\\Delta \\mathbf{U} = \\big(\\Delta E_{r},\\,\\Delta T\\big)$ that advances $(E_{r}^{(k)},T^{(k)})$ to $(E_{r}^{(k+1)},T^{(k+1)}) = (E_{r}^{(k)},T^{(k)}) + \\Delta \\mathbf{U}$. Report the two components $\\Delta E_{r}$ and $\\Delta T$ rounded to four significant figures. Express $\\Delta E_{r}$ in $\\mathrm{erg}\\,\\mathrm{cm}^{-3}$ and $\\Delta T$ in $\\mathrm{K}$.\n\nThen, state mathematically precise convergence criteria suitable for stiff source coupling in RHD that simultaneously control both the residual and the update size using physically motivated scalings, and that enforce positivity of both $E_{r}^{(k+1)}$ and $T^{(k+1)}$. Your criteria should be stated in terms of norms and clearly indicate absolute and relative tolerances, but you do not need to assign numerical values to these tolerances.\n\nRound the reported $\\Delta E_{r}$ and $\\Delta T$ to four significant figures as requested.", "solution": "The Newton-Raphson method is an iterative procedure for finding the roots of a system of nonlinear equations $\\mathbf{F}(\\mathbf{U}) = \\mathbf{0}$. Given an iterate $\\mathbf{U}^{(k)}$, the next iterate $\\mathbf{U}^{(k+1)}$ is found by solving the linear system that represents the tangent approximation to $\\mathbf{F}$ at $\\mathbf{U}^{(k)}$. In the context of an implicit time integration scheme, the function to be zeroed is the residual $\\mathbf{R}(\\mathbf{U}) = \\mathbf{0}$. The update step $\\Delta \\mathbf{U} = \\mathbf{U}^{(k+1)} - \\mathbf{U}^{(k)}$ is found by solving the linear system:\n$$\n\\mathbf{J}(\\mathbf{U}^{(k)}) \\Delta \\mathbf{U} = -\\mathbf{R}(\\mathbf{U}^{(k)})\n$$\nwhere $\\mathbf{J}$ is the Jacobian matrix of $\\mathbf{R}$ evaluated at $\\mathbf{U}^{(k)}$. The state vector is $\\mathbf{U} = (E_r, T)^T$.\n\nWe are asked to compute the update vector $\\Delta \\mathbf{U} = (\\Delta E_r, \\Delta T)^T$.\nThe linear system is:\n$$\n\\begin{pmatrix}\n101  -3.024\\times 10^{6} \\\\\n-100  1.3024\\times 10^{7}\n\\end{pmatrix}\n\\begin{pmatrix}\n\\Delta E_{r} \\\\\n\\Delta T\n\\end{pmatrix}\n=\n-\n\\begin{pmatrix}\n2.0\\times 10^{10} \\\\\n-1.0\\times 10^{11}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-2.0\\times 10^{10} \\\\\n1.0\\times 10^{11}\n\\end{pmatrix}\n$$\nTo solve this $2 \\times 2$ system, we can use the formula for the inverse of a matrix. For a matrix $\\mathbf{A} = \\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix}$, its inverse is $\\mathbf{A}^{-1} = \\frac{1}{\\det(\\mathbf{A})} \\begin{pmatrix} d  -b \\\\ -c  a \\end{pmatrix}$.\nFirst, we compute the determinant of the Jacobian matrix $\\mathbf{J}$:\n$$\n\\det(\\mathbf{J}) = (101)(1.3024\\times 10^{7}) - (-3.024\\times 10^{6})(-100)\n$$\n$$\n\\det(\\mathbf{J}) = 1.315424\\times 10^{9} - 3.024\\times 10^{8} = 1.013024\\times 10^{9}\n$$\nSince the determinant is non-zero, the matrix is invertible and a unique solution for $\\Delta\\mathbf{U}$ exists.\nNow we can find the update vector $\\Delta \\mathbf{U} = \\mathbf{J}^{-1} (-\\mathbf{R})$:\n$$\n\\begin{pmatrix}\n\\Delta E_{r} \\\\\n\\Delta T\n\\end{pmatrix}\n=\n\\frac{1}{1.013024\\times 10^{9}}\n\\begin{pmatrix}\n1.3024\\times 10^{7}  3.024\\times 10^{6} \\\\\n100  101\n\\end{pmatrix}\n\\begin{pmatrix}\n-2.0\\times 10^{10} \\\\\n1.0\\times 10^{11}\n\\end{pmatrix}\n$$\nWe compute the components $\\Delta E_r$ and $\\Delta T$.\n$$\n\\Delta E_r = \\frac{ (1.3024\\times 10^{7})(-2.0\\times 10^{10}) + (3.024\\times 10^{6})(1.0\\times 10^{11}) }{1.013024\\times 10^{9}} = \\frac{ -2.6048\\times 10^{17} + 3.024\\times 10^{17} }{1.013024\\times 10^{9}} = \\frac{ 4.192\\times 10^{16} }{1.013024\\times 10^{9}} \\approx 4.13813 \\times 10^7\n$$\nRounding to four significant figures, we get $\\Delta E_r \\approx 4.138 \\times 10^{7} \\, \\mathrm{erg}\\,\\mathrm{cm}^{-3}$.\n$$\n\\Delta T = \\frac{ (100)(-2.0\\times 10^{10}) + (101)(1.0\\times 10^{11}) }{1.013024\\times 10^{9}} = \\frac{ -2.0\\times 10^{12} + 10.1\\times 10^{12} }{1.013024\\times 10^{9}} = \\frac{ 8.1\\times 10^{12} }{1.013024\\times 10^{9}} \\approx 7995.89 \\, \\mathrm{K}\n$$\nRounding to four significant figures, we get $\\Delta T \\approx 7996 \\, \\mathrm{K}$.\n\nFor a stiff, coupled system, convergence criteria must be robust. They typically involve monitoring both the size of the residual (how well the equations are satisfied) and the size of the update step (how much the solution is still changing). Physically motivated scaling is essential because the variables ($E_r$ and $T$) have different units and can span many orders of magnitude. Positivity is a critical physical constraint.\n\nLet $\\mathbf{U}^{(k)} = (E_r^{(k)}, T^{(k)})^T$ be the state at iteration $k$, and let $\\Delta\\mathbf{U}^{(k)} = \\mathbf{U}^{(k+1)} - \\mathbf{U}^{(k)}$ be the update. Let $\\epsilon_{r}$ be a user-defined relative tolerance, and let $\\epsilon_{abs,E_r}$, $\\epsilon_{abs,T}$, and $\\epsilon_{abs,R}$ be user-defined absolute tolerances. The iterative process is considered converged when the following conditions are met simultaneously:\n\n1.  **Update Size Criterion:** The change in each variable is small compared to its value. A mixed relative-absolute error criterion is robust:\n    $$\n    |\\Delta E_r^{(k)}| \\le \\epsilon_{r} E_r^{(k+1)} + \\epsilon_{abs,E_r} \\quad \\text{and} \\quad |\\Delta T^{(k)}| \\le \\epsilon_{r} T^{(k+1)} + \\epsilon_{abs,T}\n    $$\n    This is checked for each component of the solution vector. The absolute tolerance terms prevent stalling when a solution component is close to zero.\n\n2.  **Residual Size Criterion:** The residual vector $\\mathbf{R}(\\mathbf{U}^{(k+1)})$ is close to zero. Since the components of $\\mathbf{R}$ (say, $R_{E_r}$ and $R_T$) have units of energy density, they should be compared to a characteristic energy density in the cell, such as the radiation energy density $E_r$ or the sum of radiation and gas energy densities.\n    $$\n    \\| \\mathbf{R}(\\mathbf{U}^{(k+1)}) \\| \\le \\epsilon_{r} \\| \\text{Scale} \\| + \\epsilon_{abs,R}\n    $$\n    where the norm could be an $L_2$ norm and the scale could be based on the total energy. A component-wise check is also common.\n\n3.  **Positivity Enforcement:** The physical quantities $E_r$ and $T$ must remain positive. This is not a convergence test but a constraint that must be enforced at every iteration. This is typically achieved by damping the Newton step. If the full Newton step $\\Delta\\mathbf{U}_{NR} = -\\mathbf{J}^{-1}\\mathbf{R}$ leads to a negative state, i.e., $E_r^{(k)} + \\Delta E_{r,NR} \\le 0$ or $T^{(k)} + \\Delta T_{NR} \\le 0$, the update is scaled by a factor $\\alpha \\in (0, 1)$ such that $\\Delta \\mathbf{U}^{(k)} = \\alpha \\Delta \\mathbf{U}_{NR}$. The factor $\\alpha$ is chosen to be the largest value that maintains positivity in all components, often with a small safety margin. Convergence is only declared for a physically valid state:\n    $$\n    E_r^{(k+1)} > 0 \\quad \\text{and} \\quad T^{(k+1)} > 0\n    $$", "answer": "$$\n\\boxed{\\begin{pmatrix} 4.138 \\times 10^{7}  7.996 \\times 10^{3} \\end{pmatrix}}\n$$", "id": "3530860"}, {"introduction": "Operator splitting separates the complex problem of radiation hydrodynamics into more manageable parts, one of which is often the spatial transport of radiation. This exercise explores Flux-Limited Diffusion (FLD), a widely used and physically intuitive method for approximating the radiation flux across a computational grid. You will calculate the flux at a cell interface using a specific flux limiter and derive its behavior in both optically thick (diffusion) and optically thin (free-streaming) regimes, revealing how FLD cleverly interpolates between these two physical limits. [@problem_id:3530849]", "problem": "Consider a one-dimensional uniform Cartesian grid for radiation hydrodynamics in which the radiation energy density $E_{r}$ is stored at cell centers $x_{i}$ with spacing $\\Delta x$. In an operator-split radiation update, the radiation flux $F_{r}$ at interfaces is required to couple the radiation to the gas. Assume isotropic gray opacity with mass absorption coefficient $\\kappa$ and mass density $\\rho$, and adopt the Flux-Limited Diffusion (FLD) closure where the optical-depth parameter $R$ is defined by $R = \\frac{|\\nabla E_{r}|}{\\kappa \\rho E_{r}}$. Use the Levermore–Pomraning flux limiter $\\lambda(R)$, defined by $\\lambda(R) = \\frac{2 + R}{6 + 3 R + R^{2}}$, together with the standard FLD form of the radiation flux consistent with the radiation moment equations and closure.\n\nOn the interface $x_{i+\\frac{1}{2}}$ between cells $i$ and $i+1$, approximate the radiation energy density by the arithmetic average $E_{r,\\mathrm{int}} = \\frac{E_{r,i} + E_{r,i+1}}{2}$ and the discrete gradient by the central difference $\\nabla E_{r}\\big|_{i+\\frac{1}{2}} \\approx \\frac{E_{r,i+1} - E_{r,i}}{\\Delta x}$. Take the speed of light to be $c$. The grid and material parameters are:\n- $E_{r,i} = 1.0 \\times 10^{5}$ in $\\mathrm{erg}\\,\\mathrm{cm}^{-3}$,\n- $E_{r,i+1} = 8.0 \\times 10^{4}$ in $\\mathrm{erg}\\,\\mathrm{cm}^{-3}$,\n- $\\Delta x = 1.0 \\times 10^{7}$ in $\\mathrm{cm}$,\n- $\\kappa = 0.34$ in $\\mathrm{cm}^{2}\\,\\mathrm{g}^{-1}$,\n- $\\rho = 1.0 \\times 10^{-7}$ in $\\mathrm{g}\\,\\mathrm{cm}^{-3}$,\n- $c = 3.0 \\times 10^{10}$ in $\\mathrm{cm}\\,\\mathrm{s}^{-1}$.\n\nStarting from the radiation moment equations with the FLD closure, derive the discrete interface radiation flux $F_{r,i+\\frac{1}{2}}$ and evaluate it numerically using the above data. Then, using only the definitions of $R$ and $\\lambda(R)$ and the limiting behaviors associated with the FLD closure, derive the closed-form expressions for the limiting radiation flux in the diffusion limit $R \\to 0$ and in the free-streaming limit $R \\to \\infty$, expressed in terms of $\\kappa$, $\\rho$, $c$, $\\Delta x$, and the discrete values of $E_{r}$. Express the computed interface flux in $\\mathrm{erg}\\,\\mathrm{cm}^{-2}\\,\\mathrm{s}^{-1}$ and round your numerical result to four significant figures.", "solution": "The fundamental equation for the radiation flux $\\mathbf{F}_r$ in the Flux-Limited Diffusion (FLD) approximation is given by a modified Fick's law of diffusion:\n$$\n\\mathbf{F}_r = -D \\nabla E_r = -\\frac{c \\lambda(R)}{\\kappa \\rho} \\nabla E_r\n$$\nHere, $E_r$ is the radiation energy density, $c$ is the speed of light, $\\kappa$ is the mass absorption coefficient, $\\rho$ is the mass density, and $\\lambda(R)$ is the flux limiter, which depends on the dimensionless parameter $R = \\frac{|\\nabla E_{r}|}{\\kappa \\rho E_{r}}$.\n\nWe will use the provided discrete approximations for the quantities at the interface $x_{i+\\frac{1}{2}}$.\n\n**1. Numerical Evaluation of the Interface Flux $F_{r,i+\\frac{1}{2}}$**\n\nFirst, we calculate the terms needed to evaluate the flux. The gradient of the radiation energy density at the interface is approximated by a central difference:\n$$\n\\nabla E_{r}\\big|_{i+\\frac{1}{2}} \\approx \\frac{E_{r,i+1} - E_{r,i}}{\\Delta x} = \\frac{8.0 \\times 10^{4} - 1.0 \\times 10^{5}}{1.0 \\times 10^{7}} = -2.0 \\times 10^{-3} \\, \\mathrm{erg}\\,\\mathrm{cm}^{-4}\n$$\nThe magnitude of the gradient is $|\\nabla E_{r}|_{i+\\frac{1}{2}} = 2.0 \\times 10^{-3} \\, \\mathrm{erg}\\,\\mathrm{cm}^{-4}$.\n\nNext, we evaluate the radiation energy density at the interface using the arithmetic mean:\n$$\nE_{r,i+\\frac{1}{2}} = \\frac{E_{r,i} + E_{r,i+1}}{2} = \\frac{1.0 \\times 10^{5} + 8.0 \\times 10^{4}}{2} = 9.0 \\times 10^{4} \\, \\mathrm{erg}\\,\\mathrm{cm}^{-3}\n$$\nThe product $\\kappa \\rho$ is:\n$$\n\\kappa \\rho = (0.34 \\, \\mathrm{cm}^{2}\\,\\mathrm{g}^{-1}) \\times (1.0 \\times 10^{-7} \\, \\mathrm{g}\\,\\mathrm{cm}^{-3}) = 3.4 \\times 10^{-8} \\, \\mathrm{cm}^{-1}\n$$\nNow we can calculate the dimensionless parameter $R$ at the interface:\n$$\nR_{i+\\frac{1}{2}} = \\frac{|\\nabla E_{r}|_{i+\\frac{1}{2}}}{(\\kappa \\rho E_{r})_{i+\\frac{1}{2}}} = \\frac{2.0 \\times 10^{-3}}{ (3.4 \\times 10^{-8}) \\times (9.0 \\times 10^{4}) } = \\frac{2.0 \\times 10^{-3}}{3.06 \\times 10^{-3}} \\approx 0.65359\n$$\nWith the value of $R$, we find the flux limiter $\\lambda(R)$ using the Levermore–Pomraning formula:\n$$\n\\lambda(R_{i+\\frac{1}{2}}) = \\frac{2 + R}{6 + 3R + R^2} = \\frac{2 + 0.65359}{6 + 3(0.65359) + (0.65359)^2} = \\frac{2.65359}{8.38797} \\approx 0.31636\n$$\nFinally, we compute the radiation flux at the interface, $F_{r,i+\\frac{1}{2}}$:\n$$\nF_{r,i+\\frac{1}{2}} = -\\frac{c \\lambda(R_{i+\\frac{1}{2}})}{\\kappa \\rho} \\nabla E_{r}\\big|_{i+\\frac{1}{2}} = -\\frac{(3.0 \\times 10^{10}) \\times (0.31636)}{3.4 \\times 10^{-8}} \\times (-2.0 \\times 10^{-3})\n$$\nThe two negative signs cancel, resulting in a positive flux, as energy flows from the higher energy density cell ($i$) to the lower one ($i+1$):\n$$\nF_{r,i+\\frac{1}{2}} = \\frac{(3.0 \\times 10^{10}) \\times (0.31636) \\times (2.0 \\times 10^{-3})}{3.4 \\times 10^{-8}} \\approx 5.5828 \\times 10^{14} \\, \\mathrm{erg}\\,\\mathrm{cm}^{-2}\\,\\mathrm{s}^{-1}\n$$\nRounding to four significant figures, we get:\n$$\nF_{r,i+\\frac{1}{2}} = 5.583 \\times 10^{14} \\, \\mathrm{erg}\\,\\mathrm{cm}^{-2}\\,\\mathrm{s}^{-1}\n$$\n\n**2. Derivation of Limiting Flux Expressions**\n\n**a) Diffusion Limit ($R \\to 0$)**\nIn the optically thick diffusion limit, we examine the behavior of the flux limiter $\\lambda(R)$ as $R \\to 0$:\n$$\n\\lim_{R \\to 0} \\lambda(R) = \\lim_{R \\to 0} \\frac{2 + R}{6 + 3R + R^2} = \\frac{2}{6} = \\frac{1}{3}\n$$\nThe radiation flux, denoted $F_{r,i+\\frac{1}{2}}^{(\\text{diff})}$, becomes:\n$$\nF_{r,i+\\frac{1}{2}}^{(\\text{diff})} = -\\frac{c (1/3)}{\\kappa \\rho} \\nabla E_{r}\\big|_{i+\\frac{1}{2}} = -\\frac{c}{3 \\kappa \\rho} \\frac{E_{r,i+1} - E_{r,i}}{\\Delta x}\n$$\nThis is the standard expression for radiation flux in the diffusion approximation.\n\n**b) Free-Streaming Limit ($R \\to \\infty$)**\nIn the optically thin free-streaming limit, we examine the behavior of the product $R \\lambda(R)$ as $R \\to \\infty$:\n$$\n\\lim_{R \\to \\infty} R \\lambda(R) = \\lim_{R \\to \\infty} R \\left( \\frac{2 + R}{6 + 3R + R^2} \\right) = \\lim_{R \\to \\infty} \\frac{2R + R^2}{6 + 3R + R^2} = \\lim_{R \\to \\infty} \\frac{2/R + 1}{6/R^2 + 3/R + 1} = 1\n$$\nThe magnitude of the flux is $|F_r| = \\frac{c \\lambda(R)}{\\kappa \\rho} |\\nabla E_r|$. Using the definition of $R$, we have $|\\nabla E_r| = R \\kappa \\rho E_r$. Substituting this in:\n$$\n|F_r| = \\frac{c \\lambda(R)}{\\kappa \\rho} (R \\kappa \\rho E_r) = c (R \\lambda(R)) E_r\n$$\nIn the limit $R \\to \\infty$, the magnitude of the flux becomes:\n$$\n\\lim_{R \\to \\infty} |F_r| = c \\left( \\lim_{R \\to \\infty} R \\lambda(R) \\right) E_r = c E_r\n$$\nThe limiting flux vector is $\\mathbf{F}_{r}^{(\\text{stream})} = -c E_r \\frac{\\nabla E_r}{|\\nabla E_r|}$. Using the discrete approximations at the interface, the free-streaming limit of the interface flux is:\n$$\nF_{r,i+\\frac{1}{2}}^{(\\text{stream})} = -c \\left(\\frac{E_{r,i} + E_{r,i+1}}{2}\\right) \\frac{E_{r,i+1} - E_{r,i}}{|E_{r,i+1} - E_{r,i}|}\n$$\nThis expression correctly captures the physics: the radiation streams at the speed of light, with magnitude proportional to the local energy density, flowing from high to low energy density.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n5.583 \\times 10^{14}  -\\frac{c}{3 \\kappa \\rho} \\frac{E_{r,i+1} - E_{r,i}}{\\Delta x}  -c \\left(\\frac{E_{r,i} + E_{r,i+1}}{2}\\right) \\frac{E_{r,i+1} - E_{r,i}}{|E_{r,i+1} - E_{r,i}|}\n\\end{pmatrix}\n}\n$$", "id": "3530849"}, {"introduction": "The convenience of operator splitting comes at a cost: a \"splitting error\" that arises because the physical operators (e.g., hydrodynamic compression and radiative coupling) do not mathematically commute. This advanced practice guides you through a numerical experiment to quantify this error by comparing the results of applying the operators in different orders. By measuring the change in specific entropy, a key thermodynamic quantity, you will investigate how the splitting error depends on the physical regime, particularly the balance between gas energy $e$ and radiation energy $E_r$. [@problem_id:3530870]", "problem": "Consider a single uniform computational cell representing a localized zone within a spherically expanding blast wave where compressive gas dynamics and radiative cooling are both relevant. Work in nondimensional units where the speed of light, the radiation constant, and the specific heat at constant volume are each unity, i.e., take $c=1$, $a_r=1$, and $c_v=1$. Assume an ideal gas with adiabatic index $\\gamma$, so the pressure is $p=(\\gamma-1)e$ where $e$ is the gas internal energy density, and the specific entropy (per unit mass) is\n$$\ns(\\rho,e)=c_{\\mathrm{v}}\\ln\\left(\\frac{T}{\\rho^{\\gamma-1}}\\right)=\\ln e-\\gamma \\ln \\rho,\n$$\nusing $T=e/(\\rho c_v)=e/\\rho$ in these nondimensional units. Neglect radiation fluxes and spatial transport; model only local compressional work and local matter–radiation energy exchange under Local Thermodynamic Equilibrium (LTE) coupling.\n\nStart from the following fundamental, well-tested laws in the comoving frame for a uniform cell with constant velocity divergence over a time step:\n- Mass conservation under uniform velocity divergence $\\theta=\\nabla\\cdot \\mathbf{u}$: $\\frac{d\\rho}{dt}=-\\rho\\,\\theta$.\n- Gas internal energy density under compressional work (no external heating): $\\frac{de}{dt}=-(e+p)\\,\\theta=-\\gamma e\\,\\theta$.\n- Radiation energy density under compressional work with isotropic radiation pressure $P_{\\mathrm{r}}=\\frac{1}{3}E_{\\mathrm{r}}$: $\\frac{dE_{\\mathrm{r}}}{dt}=-\\frac{4}{3}E_{\\mathrm{r}}\\,\\theta$.\n- Gray matter–radiation energy exchange (LTE), with Planck-mean opacity $\\kappa_{\\mathrm{P}}$ and $T=e/\\rho$: \n$$\n\\frac{de}{dt}=-c\\,\\kappa_{\\mathrm{P}}\\rho\\left(a_{\\mathrm{r}} T^{4}-E_{\\mathrm{r}}\\right),\\qquad\n\\frac{dE_{\\mathrm{r}}}{dt}=+c\\,\\kappa_{\\mathrm{P}}\\rho\\left(a_{\\mathrm{r}} T^{4}-E_{\\mathrm{r}}\\right).\n$$\n\nAdopt operator splitting over a single time step of duration $\\Delta t$, in which the compressional (hydrodynamic) operator and the matter–radiation coupling operator are applied sequentially over the full $\\Delta t$ in one of two orders:\n- Gas-first (GF): apply the compressional update first (for gas and radiation), then apply the matter–radiation coupling update at the compressed density.\n- Radiation-first (RF): apply the matter–radiation coupling update first (at the initial density), then apply the compressional update for gas and radiation.\n\nAssume the divergence $\\theta$ is constant during the step and define the nondimensional compression parameter $\\kappa \\equiv -\\theta \\Delta t$. Compression corresponds to $\\kappa > 0$. Define the nondimensional coupling strength $\\chi \\equiv c \\kappa_P \\Delta t$ so that, during the coupling substep, the stiffness factor is $K = \\chi \\rho$ with $\\rho$ held constant during that substep. Use a backward Euler implicit update for the coupling substep in order to respect energy conservation between $e$ and $E_{\\mathrm{r}}$ and to preserve positivity.\n\nYour tasks:\n- Derive closed-form expressions for the compressional updates of $\\rho$, $e$, and $E_{\\mathrm{r}}$ over the duration $\\Delta t$ under constant $\\theta$.\n- Formulate the backward Euler implicit equations for the coupling substep and reduce them to a one-dimensional nonlinear equation for $e^{n+1}$, given the conserved total energy density $E_{\\mathrm{tot}} \\equiv e^n + E_r^n$ during the coupling substep and the constant density used in that substep. Specify a robust bracket for a bisection solver.\n- Implement both split orders (GF and RF), compute the post-step specific entropy $s_{\\mathrm{GF}}$ and $s_{\\mathrm{RF}}$, and then compute the entropy changes relative to the initial state $\\Delta s_{\\mathrm{GF}}=s_{\\mathrm{GF}}-s_{0}$ and $\\Delta s_{\\mathrm{RF}}=s_{\\mathrm{RF}}-s_{0}$ where $s_{0}=\\ln e_{0}-\\gamma \\ln \\rho_{0}$.\n- Quantify the order-dependence using the normalized measure\n$$\n\\mathcal{M}\\equiv \\frac{\\left|\\Delta s_{\\mathrm{GF}}-\\Delta s_{\\mathrm{RF}}\\right|}{\\left|\\Delta s_{\\mathrm{GF}}\\right|+\\left|\\Delta s_{\\mathrm{RF}}\\right|+\\varepsilon},\n$$\nwith $\\varepsilon=10^{-14}$ to avoid division by zero. Define that the order-dependence is “order unity” if $\\mathcal{M} \\ge 0.5$. All quantities are nondimensional.\n\nUse the following fixed parameters for all tests unless otherwise specified: $\\gamma=5/3$, $\\Delta t=1$, $\\rho_0=1$, $e_0=1$. For each test, set the initial radiation energy density by $E_{\\mathrm{r},0} = r e_0$ using the specified ratio $r=E_{\\mathrm{r},0}/e_0$. Use the same $\\kappa$ and $\\chi$ for both split orders within a test case.\n\nTest suite:\n- Case $1$: $(r,\\chi,\\kappa)=\\left(10^{-6},\\,0.5,\\,1\\right)$.\n- Case $2$: $(r,\\chi,\\kappa)=\\left(10^{-1},\\,0.5,\\,1\\right)$.\n- Case $3$: $(r,\\chi,\\kappa)=\\left(1,\\,0.5,\\,1\\right)$.\n- Case $4$: $(r,\\chi,\\kappa)=\\left(10,\\,0.5,\\,1\\right)$.\n- Case $5$: $(r,\\chi,\\kappa)=\\left(1,\\,10^{-2},\\,1\\right)$.\n- Case $6$: $(r,\\chi,\\kappa)=\\left(1,\\,10,\\,1\\right)$.\n- Case $7$: $(r,\\chi,\\kappa)=\\left(1,\\,0.5,\\,0\\right)$.\n- Case $8$: $(r,\\chi,\\kappa)=\\left(0,\\,0.5,\\,1\\right)$.\n- Case $9$: $(r,\\chi,\\kappa)=\\left(10^{2},\\,0.5,\\,1\\right)$.\n\nYour program must:\n- Implement the above model faithfully.\n- For each test case, compute $\\mathcal{M}$ and the indicator $I$ defined by $I=1$ if $\\mathcal{M}\\ge 0.5$ and $I=0$ otherwise.\n- Produce a single line of output containing the results as a comma-separated list enclosed in square brackets, alternating $\\mathcal{M}$ (rounded to six decimal places) and $I$ for the $9$ cases in order: for example, $\\left[\\mathcal{M}_{1},I_{1},\\mathcal{M}_{2},I_{2},\\ldots,\\mathcal{M}_{9},I_{9}\\right]$.\n\nAll outputs are nondimensional (unitless). Angles are not used. Percentages are not used; any fractional quantities must be expressed as decimals.", "solution": "We begin from the mass, gas internal energy density, and radiation energy density evolution under uniform velocity divergence. The mass conservation equation $\\frac{d\\rho}{dt}=-\\rho\\,\\theta$ with constant $\\theta$ integrates exactly over a time step of duration $\\Delta t$ to\n$$\n\\rho^{n+1} = \\rho^n \\exp(-\\theta \\Delta t).\n$$\nDefine $\\kappa \\equiv -\\theta \\Delta t$, so compression corresponds to $\\kappa>0$. Then\n$$\n\\rho^{n+1} = \\rho^n \\exp(\\kappa).\n$$\nFor the gas internal energy density $e$, the compressional work in a uniform cell without source terms obeys $\\frac{de}{dt}=-(e+p)\\theta = -\\gamma e\\theta$ (using $p=(\\gamma-1)e$). With constant $\\theta$, this integrates to\n$$\ne^{n+1} = e^n \\exp(-\\gamma \\theta \\Delta t) = e^n \\exp(\\gamma \\kappa).\n$$\nThe radiation energy density $E_{\\mathrm{r}}$ evolves under compressional work with isotropic radiation pressure $P_{\\mathrm{r}}=\\frac{1}{3}E_{\\mathrm{r}}$, giving $\\frac{dE_{\\mathrm{r}}}{dt}=-\\left(E_{\\mathrm{r}}+P_{\\mathrm{r}}\\right)\\theta=-\\frac{4}{3}E_{\\mathrm{r}}\\theta$. With constant $\\theta$,\n$$\nE_{\\mathrm{r}}^{n+1} = E_{\\mathrm{r}}^n \\exp\\left(-\\frac{4}{3} \\theta \\Delta t\\right) = E_{\\mathrm{r}}^n \\exp\\left(\\frac{4}{3} \\kappa\\right).\n$$\nThese three exact relations define the compressional (hydrodynamic) operator for the split step.\n\nFor the matter–radiation energy exchange under Local Thermodynamic Equilibrium (LTE) in a gray medium, with Planck-mean opacity $\\kappa_{\\mathrm{P}}$ and in nondimensional units $c=1$, $a_r=1$, and $c_v=1$, the exchange is\n$$\n\\frac{de}{dt}=-K\\left(T^{4}-E_{\\mathrm{r}}\\right),\\qquad \\frac{dE_{\\mathrm{r}}}{dt}=+K\\left(T^{4}-E_{\\mathrm{r}}\\right),\n$$\nwhere $K=c \\kappa_P \\rho = \\chi \\rho$ during the coupling substep and $T=e/\\rho$. The backward Euler implicit update over $\\Delta t=1$ enforces the discrete system\n\\begin{align*}\ne^{n+1}=e^{n}-K\\left(\\left(\\frac{e^{n+1}}{\\rho}\\right)^{4}-E_{\\mathrm{r}}^{n+1}\\right),\\\\\nE_{\\mathrm{r}}^{n+1}=E_{\\mathrm{r}}^{n}+K\\left(\\left(\\frac{e^{n+1}}{\\rho}\\right)^{4}-E_{\\mathrm{r}}^{n+1}\\right).\n\\end{align*}\nSumming the two equations shows that the backward Euler discretization preserves the total energy density,\n$$\ne^{n+1}+E_{\\mathrm{r}}^{n+1}=e^{n}+E_{\\mathrm{r}}^{n} \\equiv E_{\\mathrm{tot}}.\n$$\nTherefore $E_{\\mathrm{r}}^{n+1}=E_{\\mathrm{tot}}-e^{n+1}$. Substituting into the first equation yields a single nonlinear scalar equation for $e^{n+1}$,\n$$\ne^{n+1}=e^{n}-K\\left(\\left(\\frac{e^{n+1}}{\\rho}\\right)^{4}-\\left(E_{\\mathrm{tot}}-e^{n+1}\\right)\\right).\n$$\nRearranging gives a quartic polynomial equation for $e^{n+1}$:\n$$f(e^{n+1}) \\equiv (1+K)e^{n+1} + \\frac{K}{\\rho^4} (e^{n+1})^4 - (e^n + K E_{\\mathrm{tot}}) = 0.$$\nDefine\n$$\\alpha \\equiv \\frac{K}{\\rho^4}, \\qquad \\beta \\equiv e^n + K E_{\\mathrm{tot}},$$\nso the equation becomes\n$$\nf(x) \\equiv (1+K)x + \\alpha x^4 - \\beta = 0,\n$$\nwhere $x=e^{n+1}$. Because $e^{n+1}\\ge 0$ and $E_{\\mathrm{r}}^{n+1}=E_{\\mathrm{tot}}-e^{n+1}\\ge 0$, the physically admissible solution satisfies $0\\le e^{n+1}\\le E_{\\mathrm{tot}}$. In this interval,\n$$\nf(0)=-\\beta  0, \\qquad f(E_{\\mathrm{tot}})=(1+K)E_{\\mathrm{tot}}+\\alpha E_{\\mathrm{tot}}^4-\\beta = E_{\\mathrm{tot}}-e^n + \\alpha E_{\\mathrm{tot}}^4 \\ge 0,\n$$\nso a unique root exists and is bracketed in the interval $[0, E_{\\mathrm{tot}}]$. A robust bisection method can therefore be used to solve for $e^{n+1}$, after which $E_{\\mathrm{r}}^{n+1}=E_{\\mathrm{tot}}-e^{n+1}$.\n\nOperator splitting sequences over one time step:\n- Gas-first (GF): apply the compressional operator using $\\kappa$ to obtain $\\rho^{\\star}=\\rho^{n}e^{\\kappa}$, $e^{\\star}=e^{n}e^{\\gamma\\kappa}$, $E_{\\mathrm{r}}^{\\star}=E_{\\mathrm{r}}^{n}e^{\\frac{4}{3}\\kappa}$. Then apply the coupling operator at density $\\rho^{\\star}$ with stiffness $K=\\chi\\,\\rho^{\\star}$ to $(e^{\\star},E_{\\mathrm{r}}^{\\star})$, producing $(e^{n+1},E_{\\mathrm{r}}^{n+1})$ and $\\rho^{n+1}=\\rho^{\\star}$.\n- Radiation-first (RF): apply the coupling operator at the initial density $\\rho^{n}$ with stiffness $K=\\chi\\,\\rho^{n}$ to $(e^{n},E_{\\mathrm{r}}^{n})$, producing $(\\tilde e,\\tilde E_{\\mathrm{r}})$ and leaving $\\rho$ unchanged. Then apply the compressional operator using $\\kappa$ to obtain $e^{n+1}=\\tilde e\\,e^{\\gamma\\kappa}$, $E_{\\mathrm{r}}^{n+1}=\\tilde E_{\\mathrm{r}}\\,e^{\\frac{4}{3}\\kappa}$, and $\\rho^{n+1}=\\rho^{n}e^{\\kappa}$.\n\nSpecific entropy and order-dependence metric:\nWith $s(\\rho,e)=\\ln e-\\gamma \\ln \\rho$ in these nondimensional units and $s_{0}=\\ln e_{0}-\\gamma \\ln \\rho_{0}$, the entropy changes are $\\Delta s_{\\mathrm{GF}}=s(\\rho_{\\mathrm{GF}},e_{\\mathrm{GF}})-s_{0}$ and $\\Delta s_{\\mathrm{RF}}=s(\\rho_{\\mathrm{RF}},e_{\\mathrm{RF}})-s_{0}$. Define\n$$\n\\mathcal{M}=\\frac{\\left|\\Delta s_{\\mathrm{GF}}-\\Delta s_{\\mathrm{RF}}\\right|}{\\left|\\Delta s_{\\mathrm{GF}}\\right|+\\left|\\Delta s_{\\mathrm{RF}}\\right|+\\varepsilon},\n$$\nwith $\\varepsilon=10^{-14}$. By construction, $0\\le \\mathcal{M}\\le 1$. We classify the order-dependence as “order unity” if $\\mathcal{M}\\ge 0.5$.\n\nAlgorithmic steps per test case:\n- Initialize $(\\rho_{0},e_{0},E_{\\mathrm{r},0})$ from $\\rho_{0}=1$, $e_{0}=1$, and $E_{\\mathrm{r},0}=r\\,e_{0}$.\n- Gas-first:\n  1. Compress: $\\rho^{\\star}=\\rho_{0}e^{\\kappa}$, $e^{\\star}=e_{0}e^{\\gamma\\kappa}$, $E_{\\mathrm{r}}^{\\star}=E_{\\mathrm{r},0}e^{\\frac{4}{3}\\kappa}$.\n  2. Couple at $\\rho^{\\star}$ with $K=\\chi\\,\\rho^{\\star}$ using bisection on $f(e^{n+1})$ to get $e_{\\mathrm{GF}}$, $E_{\\mathrm{r},\\mathrm{GF}}=E_{\\mathrm{tot}}^{\\star}-e_{\\mathrm{GF}}$ where $E_{\\mathrm{tot}}^{\\star}=e^{\\star}+E_{\\mathrm{r}}^{\\star}$; set $\\rho_{\\mathrm{GF}}=\\rho^{\\star}$.\n- Radiation-first:\n  1. Couple at $\\rho_{0}$ with $K=\\chi\\,\\rho_{0}$ using bisection on $f(e^{n+1})$ to get $\\tilde e$ and $\\tilde E_{\\mathrm{r}}=E_{\\mathrm{tot}}^{0}-\\tilde e$ where $E_{\\mathrm{tot}}^{0}=e_{0}+E_{\\mathrm{r},0}$.\n  2. Compress: $e_{\\mathrm{RF}}=\\tilde e\\,e^{\\gamma\\kappa}$, $E_{\\mathrm{r},\\mathrm{RF}}=\\tilde E_{\\mathrm{r}}\\,e^{\\frac{4}{3}\\kappa}$, $\\rho_{\\mathrm{RF}}=\\rho_{0}e^{\\kappa}$.\n- Compute $\\Delta s_{\\mathrm{GF}}=\\ln e_{\\mathrm{GF}}-\\gamma \\ln \\rho_{\\mathrm{GF}}-s_{0}$ and $\\Delta s_{\\mathrm{RF}}=\\ln e_{\\mathrm{RF}}-\\gamma \\ln \\rho_{\\mathrm{RF}}-s_{0}$ with $s_{0}=\\ln e_{0}-\\gamma \\ln \\rho_{0}=0$.\n- Compute $\\mathcal{M}$ and the indicator $I=1$ if $\\mathcal{M}\\ge 0.5$ and $I=0$ otherwise.\n\nEdge and boundary considerations:\n- If $\\kappa=0$, the compressional operator is the identity; both orders reduce to the same coupling update at the same density, so $\\mathcal{M}=0$.\n- If $\\chi=0$, there is no coupling; both orders reduce to pure compression, so $\\mathcal{M}=0$.\n- If $r\\ll 1$, the radiation reservoir is negligible and order effects are small.\n- If $r\\gg 1$ and/or $\\chi\\gg 1$, the coupling is strong and the radiation reservoir dominates, so performing coupling before or after compression uses significantly different densities and reservoir states, making $\\mathcal{M}$ approach order unity.\n\nImplementation details:\n- Use bisection on $f(e)$ over the bracket $[0,E_{\\mathrm{tot}}]$ for the coupling substep, with a sufficient number of iterations (for example, $60$) to ensure convergence to machine precision.\n- Use the nine test cases specified in the problem statement.\n- For each test, report $\\mathcal{M}$ rounded to six decimals and the indicator $I$, in a single flat list alternating $\\mathcal{M}$ and $I$ as required.\n\nThis construction cleanly isolates the operator splitting order effect arising from performing compressional work and radiative coupling in different sequences, and expresses the effect on the physically meaningful quantity of specific entropy. The measure $\\mathcal{M}$ directly diagnoses when the order-dependence becomes of order unity, especially as the ratio $E_{\\mathrm{r}}/e$ and the coupling strength $\\chi$ increase.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compress_step(rho, e, Er, kappa, gamma):\n    \"\"\"\n    Exact compressional update over one timestep with constant divergence:\n    rho *= exp(kappa)\n    e   *= exp(gamma * kappa)\n    Er  *= exp((4/3) * kappa)\n    \"\"\"\n    factor_rho = np.exp(kappa)\n    rho_new = rho * factor_rho\n    e_new = e * np.exp(gamma * kappa)\n    Er_new = Er * np.exp((4.0/3.0) * kappa)\n    return rho_new, e_new, Er_new\n\ndef couple_step_BE(e, Er, rho, chi, tol_iters=60):\n    \"\"\"\n    Backward Euler implicit matter-radiation coupling over one timestep (Delta t = 1),\n    with K = chi * rho, c = a_r = c_v = 1.\n    Solve for e_{n+1} using bisection on:\n        f(x) = (1+K) x + (K / rho^4) x^4 - (e + K * E_tot) = 0,\n    where E_tot = e + Er is conserved during the coupling substep.\n    Returns (e_new, Er_new).\n    \"\"\"\n    E_tot = e + Er\n    K = chi * rho\n    alpha = K / (rho**4)\n    beta = e + K * E_tot\n\n    # Bracket: [0, E_tot]\n    lo = 0.0\n    hi = E_tot\n    # Evaluate f at bounds\n    def f(x):\n        return (1.0 + K) * x + alpha * (x**4) - beta\n\n    f_lo = f(lo)  # should be -beta  0\n    f_hi = f(hi)  # should be = 0\n    # Numerical safety: if f_hi  0 due to extreme roundoff with E_tot ~ 0, set hi to max(hi, 1)\n    if f_hi  0.0:\n        # If total energy is extremely small, solution is near zero.\n        hi = max(1.0, E_tot + 1.0)\n        f_hi = f(hi)\n\n    # Bisection iterations\n    for _ in range(tol_iters):\n        mid = 0.5 * (lo + hi)\n        f_mid = f(mid)\n        # Decide interval\n        if f_mid = 0.0:\n            lo = mid\n            f_lo = f_mid\n        else:\n            hi = mid\n            f_hi = f_mid\n    e_new = 0.5 * (lo + hi)\n    # Enforce positivity and bounds\n    if e_new  0.0:\n        e_new = 0.0\n    if e_new  E_tot:\n        e_new = E_tot\n    Er_new = E_tot - e_new\n    return e_new, Er_new\n\ndef entropy(e, rho, gamma):\n    # s = ln e - gamma ln rho; initial s0 = ln e0 - gamma ln rho0\n    return np.log(e) - gamma * np.log(rho)\n\ndef run_case(r, chi, kappa, gamma):\n    # Initial conditions in nondimensional units\n    rho0 = 1.0\n    e0 = 1.0\n    Er0 = r * e0\n    s0 = np.log(e0) - gamma * np.log(rho0)  # equals 0\n\n    # Gas-first (GF): compress then couple at compressed density\n    rho_gf, e_gf_star, Er_gf_star = compress_step(rho0, e0, Er0, kappa, gamma)\n    e_gf, Er_gf = couple_step_BE(e_gf_star, Er_gf_star, rho_gf, chi)\n    s_gf = entropy(e_gf, rho_gf, gamma)\n    ds_gf = s_gf - s0\n\n    # Radiation-first (RF): couple at initial density then compress\n    e_rf_tilde, Er_rf_tilde = couple_step_BE(e0, Er0, rho0, chi)\n    rho_rf, e_rf, Er_rf = compress_step(rho0, e_rf_tilde, Er_rf_tilde, kappa, gamma)\n    s_rf = entropy(e_rf, rho_rf, gamma)\n    ds_rf = s_rf - s0\n\n    # Normalized order-dependence measure\n    eps = 1e-14\n    M = abs(ds_gf - ds_rf) / (abs(ds_gf) + abs(ds_rf) + eps)\n    I = 1 if M = 0.5 else 0\n    return M, I\n\ndef solve():\n    gamma = 5.0/3.0\n    test_cases = [\n        (1e-6, 0.5, 1.0),   # Case 1\n        (1e-1, 0.5, 1.0),   # Case 2\n        (1.0,  0.5, 1.0),   # Case 3\n        (10.0, 0.5, 1.0),   # Case 4\n        (1.0,  1e-2, 1.0),  # Case 5\n        (1.0,  10.0, 1.0),  # Case 6\n        (1.0,  0.5, 0.0),   # Case 7\n        (0.0,  0.5, 1.0),   # Case 8\n        (1e2,  0.5, 1.0),   # Case 9\n    ]\n\n    results = []\n    for r, chi, kappa in test_cases:\n        M, I = run_case(r, chi, kappa, gamma)\n        results.append(f\"{M:.6f}\")\n        results.append(str(int(I)))\n\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3530870"}]}