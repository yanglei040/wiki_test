{"hands_on_practices": [{"introduction": "The heart of the Smoothed Particle Hydrodynamics (SPH) method is the smoothing kernel, which defines how quantities are averaged in space. For a kernel to properly represent a partition of unity and ensure fundamental conservation laws like mass conservation, its volume integral must be normalized to one. This exercise provides essential hands-on practice by guiding you through the first-principles derivation of the normalization constant for the cubic spline kernel, one of the most widely used kernels in computational astrophysics.", "problem": "In three-dimensional smoothed particle hydrodynamics (SPH), the smoothing kernel $W(\\mathbf{r},h)$ is required to be non-negative, compactly supported, radially symmetric, and normalized so that the volume integral over all space satisfies $\\int W(\\mathbf{r},h)\\,d^{3}\\mathbf{r}=1$. Consider the widely used cubic spline (also called $M_{4}$) kernel with support radius $2h$, which is defined in terms of the dimensionless radius $q=r/h$ as\n$$\nW(r,h)=\\sigma\\,h^{-3}\\,f(q),\\quad q=\\frac{r}{h},\n$$\nwith the piecewise function\n$$\nf(q)=\\begin{cases}\n1-\\frac{3}{2}q^{2}+\\frac{3}{4}q^{3},  0\\le q1, \\\\\n\\frac{1}{4}(2-q)^{3},  1\\le q2, \\\\\n0,  q\\ge 2.\n\\end{cases}\n$$\nStarting from the normalization requirement and appropriate three-dimensional volume integration, derive the normalization constant $\\sigma$ that ensures $\\int W(\\mathbf{r},h)\\,d^{3}\\mathbf{r}=1$. Your derivation should use only fundamental principles (radial symmetry, change of variables, and the normalization condition) and must explicitly carry out all necessary integrals. Verify explicitly that the resulting kernel satisfies the normalization condition for arbitrary smoothing length $h$. Provide your final answer for $\\sigma$ as a closed-form analytic expression. No numerical approximation is required, and no rounding is needed.", "solution": "The normalization condition for a spherically symmetric kernel in three dimensions is\n$$\n\\int_{\\mathbb{R}^{3}} W(\\mathbf{r},h)\\,d^{3}\\mathbf{r} \\;=\\; 4\\pi\\int_{0}^{\\infty} W(r,h)\\,r^{2}\\,dr \\;=\\; 1.\n$$\nGiven that $W(r,h)=\\sigma\\,h^{-3}\\,f(q)$ with $q=r/h$ and that $f(q)=0$ for $q\\ge 2$, the radial integral has compact support and becomes\n$$\n4\\pi\\int_{0}^{2h} \\sigma\\,h^{-3}\\,f\\!\\left(\\frac{r}{h}\\right)\\,r^{2}\\,dr.\n$$\nIntroduce the change of variables $q=r/h$, so that $r=hq$ and $dr=h\\,dq$. Then $r^{2}=h^{2}q^{2}$, and the integral transforms to\n$$\n4\\pi\\int_{0}^{2} \\sigma\\,h^{-3}\\,f(q)\\,(h^{2}q^{2})\\,(h\\,dq)\n\\;=\\;\n4\\pi\\,\\sigma\\int_{0}^{2} f(q)\\,q^{2}\\,dq.\n$$\nHence the normalization condition reduces to\n$$\n4\\pi\\,\\sigma\\int_{0}^{2} f(q)\\,q^{2}\\,dq \\;=\\; 1,\n$$\nso that\n$$\n\\sigma \\;=\\; \\frac{1}{4\\pi}\\left[\\int_{0}^{2} f(q)\\,q^{2}\\,dq\\right]^{-1}.\n$$\nWe now compute the integral $I=\\int_{0}^{2} f(q)\\,q^{2}\\,dq$ by splitting it at $q=1$:\n$$\nI \\;=\\; \\int_{0}^{1} \\left(1-\\frac{3}{2}q^{2}+\\frac{3}{4}q^{3}\\right)q^{2}\\,dq\n\\;+\\;\n\\int_{1}^{2} \\frac{1}{4}(2-q)^{3} q^{2}\\,dq.\n$$\nCompute the first integral $I_{1}$:\n$$\nI_{1} \\;=\\; \\int_{0}^{1}\\left(q^{2}-\\frac{3}{2}q^{4}+\\frac{3}{4}q^{5}\\right)\\,dq\n\\;=\\;\n\\left[\\frac{q^{3}}{3}-\\frac{3}{2}\\cdot\\frac{q^{5}}{5}+\\frac{3}{4}\\cdot\\frac{q^{6}}{6}\\right]_{0}^{1}\n\\;=\\;\n\\frac{1}{3}-\\frac{3}{10}+\\frac{1}{8}.\n$$\nWith a common denominator, this yields\n$$\nI_{1} \\;=\\; \\frac{40}{120}-\\frac{36}{120}+\\frac{15}{120} \\;=\\; \\frac{19}{120}.\n$$\nCompute the second integral $I_{2}$ by expanding the integrand:\n$$\n(2-q)^{3}=8-12q+6q^{2}-q^{3},\\quad\n\\frac{1}{4}(2-q)^{3}q^{2}\n=2q^{2}-3q^{3}+\\frac{3}{2}q^{4}-\\frac{1}{4}q^{5}.\n$$\nThus\n$$\nI_{2} \\;=\\; \\int_{1}^{2} \\left(2q^{2}-3q^{3}+\\frac{3}{2}q^{4}-\\frac{1}{4}q^{5}\\right)\\,dq\n\\;=\\;\n\\left[\\frac{2}{3}q^{3}-\\frac{3}{4}q^{4}+\\frac{3}{10}q^{5}-\\frac{1}{24}q^{6}\\right]_{1}^{2}.\n$$\nEvaluate at $q=2$:\n$$\n\\frac{2}{3}\\cdot 8 - \\frac{3}{4}\\cdot 16 + \\frac{3}{10}\\cdot 32 - \\frac{1}{24}\\cdot 64\n\\;=\\;\n\\frac{16}{3} - 12 + \\frac{48}{5} - \\frac{8}{3}\n\\;=\\;\n\\frac{4}{15}.\n$$\nEvaluate at $q=1$:\n$$\n\\frac{2}{3} - \\frac{3}{4} + \\frac{3}{10} - \\frac{1}{24}\n\\;=\\;\n\\frac{80}{120}-\\frac{90}{120}+\\frac{36}{120}-\\frac{5}{120}\n\\;=\\;\n\\frac{21}{120} \\;=\\; \\frac{7}{40}.\n$$\nTherefore\n$$\nI_{2} \\;=\\; \\frac{4}{15} - \\frac{7}{40}\n\\;=\\;\n\\frac{32}{120}-\\frac{21}{120}\n\\;=\\;\n\\frac{11}{120}.\n$$\nCombine $I_{1}$ and $I_{2}$:\n$$\nI \\;=\\; \\frac{19}{120}+\\frac{11}{120} \\;=\\; \\frac{30}{120} \\;=\\; \\frac{1}{4}.\n$$\nSubstitute $I=\\frac{1}{4}$ into the expression for $\\sigma$:\n$$\n\\sigma \\;=\\; \\frac{1}{4\\pi}\\left(\\frac{1}{4}\\right)^{-1}\n\\;=\\;\n\\frac{1}{\\pi}.\n$$\nFinally, verify the normalization explicitly:\n$$\n\\int W(\\mathbf{r},h)\\,d^{3}\\mathbf{r}\n\\;=\\;\n4\\pi\\,\\sigma\\int_{0}^{2} f(q)\\,q^{2}\\,dq\n\\;=\\;\n4\\pi\\cdot \\frac{1}{\\pi}\\cdot \\frac{1}{4}\n\\;=\\;\n1,\n$$\nindependent of the smoothing length $h$. Thus the required normalization constant is $\\sigma=\\frac{1}{\\pi}$.", "answer": "$$\\boxed{\\frac{1}{\\pi}}$$", "id": "3534778"}, {"introduction": "While kernels with compact support like the cubic spline are common, other functional forms such as the Gaussian kernel are also of great theoretical and practical importance. This problem generalizes the fundamental concept of kernel normalization to the Gaussian function, whose integral is a cornerstone of statistical mechanics and quantum field theory. By deriving the normalization constant in one, two, and three dimensions, you will gain a deeper appreciation for how SPH principles are applied across different dimensionalities and kernel shapes.", "problem": "In Smoothed Particle Hydrodynamics (SPH), a central requirement for scientific consistency is that the smoothing kernel be normalized so that the kernel acts as a proper partition of unity and recovers conserved quantities such as mass density in the continuum limit. Consider the isotropic Gaussian kernel in $\\nu$-dimensional Euclidean space, defined by $W(r,h)=\\sigma_{\\nu} h^{-\\nu}\\exp(-r^{2}/h^{2})$, where $r=|\\mathbf{r}|$ is the radial distance, $h0$ is the smoothing length, and $\\sigma_{\\nu}$ is a dimension-dependent normalization constant. The normalization condition is $\\int_{\\mathbb{R}^{\\nu}} W(r,h)\\,d^{\\nu}\\mathbf{r}=1$. Starting from first principles appropriate to Smoothed Particle Hydrodynamics (SPH) in computational astrophysics and the requirement of kernel normalization for mass conservation in the continuum limit, derive the closed-form expression for $\\sigma_{\\nu}$ that enforces $\\int_{\\mathbb{R}^{\\nu}} W(r,h)\\,d^{\\nu}\\mathbf{r}=1$. Then, evaluate this expression explicitly for $\\nu=1$, $\\nu=2$, and $\\nu=3$. Express your final answers as exact analytical expressions. Provide your final answer as a three-entry row matrix corresponding to $(\\nu=1,\\nu=2,\\nu=3)$.", "solution": "The normalization condition for the kernel $W(r,h)$ in $\\nu$-dimensional space is\n$$\n\\int_{\\mathbb{R}^{\\nu}} W(r,h)\\,d^{\\nu}\\mathbf{r} \\;=\\; 1.\n$$\nWith $W(r,h)=\\sigma_{\\nu} h^{-\\nu}\\exp(-r^{2}/h^{2})$, this becomes\n$$\n\\int_{\\mathbb{R}^{\\nu}} \\sigma_{\\nu} h^{-\\nu}\\exp\\!\\left(-\\frac{r^{2}}{h^{2}}\\right)\\,d^{\\nu}\\mathbf{r} \\;=\\; 1.\n$$\nBecause $\\sigma_{\\nu}$ and $h$ are constants with respect to the integration variable $\\mathbf{r}$, we can factor them out:\n$$\n\\sigma_{\\nu} h^{-\\nu} \\int_{\\mathbb{R}^{\\nu}} \\exp\\!\\left(-\\frac{r^{2}}{h^{2}}\\right)\\,d^{\\nu}\\mathbf{r} \\;=\\; 1.\n$$\nIntroduce the dimensionless change of variables $\\mathbf{u}=\\mathbf{r}/h$, so $d^{\\nu}\\mathbf{r}=h^{\\nu}\\,d^{\\nu}\\mathbf{u}$ and $r^{2}/h^{2}=|\\mathbf{u}|^{2}$. The integral becomes\n$$\n\\sigma_{\\nu} h^{-\\nu} \\int_{\\mathbb{R}^{\\nu}} \\exp\\!\\left(-|\\mathbf{u}|^{2}\\right) h^{\\nu}\\,d^{\\nu}\\mathbf{u} \\;=\\; \\sigma_{\\nu} \\int_{\\mathbb{R}^{\\nu}} \\exp\\!\\left(-|\\mathbf{u}|^{2}\\right)\\,d^{\\nu}\\mathbf{u} \\;=\\; 1.\n$$\nDefine\n$$\nI_{\\nu} \\;=\\; \\int_{\\mathbb{R}^{\\nu}} \\exp\\!\\left(-|\\mathbf{u}|^{2}\\right)\\,d^{\\nu}\\mathbf{u}.\n$$\nThen the normalization condition reduces to\n$$\n\\sigma_{\\nu} I_{\\nu} \\;=\\; 1 \\quad \\Longrightarrow \\quad \\sigma_{\\nu} \\;=\\; \\frac{1}{I_{\\nu}}.\n$$\nWe now compute $I_{\\nu}$ from first principles. There are two standard approaches: separation into Cartesian coordinates using product structure, or transformation to spherical coordinates in $\\nu$ dimensions. We present both to emphasize the fundamental base.\n\nCartesian product approach: Since $\\exp(-|\\mathbf{u}|^{2})=\\exp\\!\\left(-\\sum_{i=1}^{\\nu} u_{i}^{2}\\right)=\\prod_{i=1}^{\\nu}\\exp(-u_{i}^{2})$ and $d^{\\nu}\\mathbf{u}=\\prod_{i=1}^{\\nu} du_{i}$, we have\n$$\nI_{\\nu} \\;=\\; \\prod_{i=1}^{\\nu} \\left( \\int_{-\\infty}^{\\infty} \\exp(-u_{i}^{2})\\,du_{i} \\right) \\;=\\; \\left( \\int_{-\\infty}^{\\infty} \\exp(-x^{2})\\,dx \\right)^{\\nu}.\n$$\nThe one-dimensional Gaussian integral is a well-tested fact:\n$$\n\\int_{-\\infty}^{\\infty} \\exp(-x^{2})\\,dx \\;=\\; \\sqrt{\\pi}.\n$$\nTherefore,\n$$\nI_{\\nu} \\;=\\; \\left(\\sqrt{\\pi}\\right)^{\\nu} \\;=\\; \\pi^{\\nu/2}.\n$$\n\nAlternatively, spherical-coordinate approach: Write $d^{\\nu}\\mathbf{u}=S_{\\nu-1}\\,r^{\\nu-1}\\,dr$ where $r=|\\mathbf{u}|$ and $S_{\\nu-1}$ is the surface area of the unit sphere in $\\nu$ dimensions, $S_{\\nu-1} = \\frac{2\\pi^{\\nu/2}}{\\Gamma(\\nu/2)}$. Then\n$$\nI_{\\nu} \\;=\\; \\int_{0}^{\\infty} \\exp(-r^{2})\\,S_{\\nu-1}\\,r^{\\nu-1}\\,dr \\;=\\; \\frac{2\\pi^{\\nu/2}}{\\Gamma(\\nu/2)} \\int_{0}^{\\infty} \\exp(-r^{2})\\,r^{\\nu-1}\\,dr.\n$$\nUse the substitution $t=r^{2}$ so $dt=2r\\,dr$ and $r^{\\nu-1}\\,dr=\\frac{1}{2}t^{\\nu/2-1}\\,dt$. Then\n$$\n\\int_{0}^{\\infty} \\exp(-r^{2})\\,r^{\\nu-1}\\,dr \\;=\\; \\frac{1}{2}\\int_{0}^{\\infty} \\exp(-t)\\,t^{\\nu/2-1}\\,dt \\;=\\; \\frac{1}{2}\\,\\Gamma\\!\\left(\\frac{\\nu}{2}\\right).\n$$\nHence\n$$\nI_{\\nu} \\;=\\; \\frac{2\\pi^{\\nu/2}}{\\Gamma(\\nu/2)} \\cdot \\frac{1}{2}\\,\\Gamma\\!\\left(\\frac{\\nu}{2}\\right) \\;=\\; \\pi^{\\nu/2},\n$$\nin agreement with the Cartesian product method.\n\nEither way, we obtain $I_{\\nu}=\\pi^{\\nu/2}$, so\n$$\n\\sigma_{\\nu} \\;=\\; \\frac{1}{\\pi^{\\nu/2}} \\;=\\; \\pi^{-\\nu/2}.\n$$\nEvaluating for $\\nu=1,2,3$ gives\n$$\n\\sigma_{1} \\;=\\; \\pi^{-1/2}, \\quad \\sigma_{2} \\;=\\; \\pi^{-1}, \\quad \\sigma_{3} \\;=\\; \\pi^{-3/2}.\n$$\nThese are exact analytical expressions that ensure the Gaussian SPH kernel is properly normalized in one, two, and three dimensions, thereby preserving mass conservation in the continuum limit and providing the correct partition of unity essential for Smoothed Particle Hydrodynamics (SPH).", "answer": "$$\\boxed{\\begin{pmatrix}\\pi^{-1/2}  \\pi^{-1}  \\pi^{-3/2}\\end{pmatrix}}$$", "id": "3534819"}, {"introduction": "The choice of a smoothing kernel is not merely a mathematical formality; it has profound consequences for the stability and accuracy of a simulation. A critical numerical pathology in SPH is the \"pairing instability,\" an artificial clumping of particles that arises from negative power in the kernel's Fourier spectrum. This advanced exercise connects the abstract properties of a kernel to tangible numerical outcomes by asking you to quantitatively assess whether a given simulation setup is stable against this pairing instability, highlighting why modern kernels like the Wendland family are often preferred.", "problem": "In Smoothed Particle Hydrodynamics (SPH), the pairing (or clumping) instability is linked to the presence of negative spectral power in the smoothing kernel at wavenumbers that are representable on the discrete particle lattice. Consider a uniform, equal-mass particle distribution on a simple-cubic lattice with spacing $\\Delta x$ in three spatial dimensions. The smoothing length is $h$, and both the cubic spline kernel (the $M_{4}$ B-spline) and the Wendland $C^{4}$ kernel have compact support radius $\\kappa h$ with $\\kappa=2$. The neighbor number is defined as $N_{\\rm ngb} \\equiv n V_{\\rm supp}$ with number density $n$ and support volume $V_{\\rm supp}=\\frac{4}{3}\\pi (\\kappa h)^{3}$. For a simple-cubic lattice, the Nyquist wavenumber is $k_{N}=\\pi/\\Delta x$. A sufficient spectral stability criterion against pairing for an equal-mass, uniformly sampled configuration is that the radial Fourier transform of the kernel be non-negative for all wavenumbers $k$ represented on the lattice. Equivalently, if the first sign change to negative values of the kernelâ€™s radial Fourier transform occurs at $k h = x_{c}$, then stability requires $k_{N} h  x_{c}$. It is a well-established property that the three-dimensional radial Fourier transform of the cubic spline kernel first becomes negative at $k h = x_{c}=3.8317$ (numerically determined), while the Wendland $C^{4}$ kernel has a non-negative radial Fourier transform for all $k \\ge 0$ in three dimensions.\n\nGiven a target neighbor number $N_{\\rm ngb}=64$, use only the fundamental definitions above to derive the dimensionless spectral coverage parameter $k_{N} h$ as a function of $N_{\\rm ngb}$ and $\\kappa$, evaluate it for $\\kappa=2$ and $N_{\\rm ngb}=64$, and then determine, by quantitative comparison to $x_{c}$, whether each kernel is stable against pairing on the given lattice.\n\nReport your final result as a row matrix $\\bigl[s_{\\rm M4}\\;\\;s_{\\rm WC4}\\bigr]$, where $s_{\\rm M4}$ corresponds to the cubic spline $M_{4}$ kernel and $s_{\\rm WC4}$ corresponds to the Wendland $C^{4}$ kernel, using the convention $s=1$ if stable and $s=0$ if unstable. No units are required. Provide a single final answer. There is no rounding requirement; if you choose to provide an intermediate numerical estimate, round it to four significant figures, but the final matrix entries must be exact integers.", "solution": "The task is to determine the stability of the cubic spline and Wendland $C^4$ kernels for a given configuration by first deriving and evaluating the dimensionless spectral coverage parameter $k_{N} h$.\n\nThe neighbor number $N_{\\rm ngb}$ is defined as the product of the number density $n$ and the kernel's support volume $V_{\\rm supp}$:\n$$N_{\\rm ngb} = n V_{\\rm supp}$$\nFor a simple-cubic lattice with inter-particle spacing $\\Delta x$, the number density is the inverse of the volume per particle, $V_{\\rm particle} = (\\Delta x)^3$. Thus,\n$$n = \\frac{1}{(\\Delta x)^3}$$\nThe support volume for a spherical kernel with compact support radius $\\kappa h$ is:\n$$V_{\\rm supp} = \\frac{4}{3}\\pi (\\kappa h)^3$$\nSubstituting these expressions into the definition of $N_{\\rm ngb}$ yields:\n$$N_{\\rm ngb} = \\frac{1}{(\\Delta x)^3} \\left( \\frac{4}{3}\\pi (\\kappa h)^3 \\right) = \\frac{4\\pi\\kappa^3}{3} \\left( \\frac{h}{\\Delta x} \\right)^3$$\nWe wish to find the dimensionless spectral coverage parameter $k_N h$. The Nyquist wavenumber for the lattice is given as $k_N = \\pi / \\Delta x$. Therefore, the parameter is:\n$$k_N h = \\left( \\frac{\\pi}{\\Delta x} \\right) h = \\pi \\left( \\frac{h}{\\Delta x} \\right)$$\nTo express this in terms of $N_{\\rm ngb}$ and $\\kappa$, we first rearrange the equation for $N_{\\rm ngb}$ to solve for the ratio $h/\\Delta x$:\n$$\\left( \\frac{h}{\\Delta x} \\right)^3 = \\frac{3 N_{\\rm ngb}}{4\\pi\\kappa^3}$$\n$$\\frac{h}{\\Delta x} = \\left( \\frac{3 N_{\\rm ngb}}{4\\pi\\kappa^3} \\right)^{1/3}$$\nNow, we substitute this expression into the equation for $k_N h$:\n$$k_N h = \\pi \\left( \\frac{3 N_{\\rm ngb}}{4\\pi\\kappa^3} \\right)^{1/3}$$\nThis can be simplified by bringing the factor of $\\pi$ inside the cubic root:\n$$k_N h = \\left( \\pi^3 \\frac{3 N_{\\rm ngb}}{4\\pi\\kappa^3} \\right)^{1/3} = \\left( \\frac{3\\pi^2 N_{\\rm ngb}}{4\\kappa^3} \\right)^{1/3}$$\nThis is the general expression for the spectral coverage parameter $k_N h$ as a function of the neighbor number $N_{\\rm ngb}$ and the support radius parameter $\\kappa$.\n\nWe now evaluate this expression for the given parameters $N_{\\rm ngb}=64$ and $\\kappa=2$:\n$$k_N h = \\left( \\frac{3\\pi^2 (64)}{4(2)^3} \\right)^{1/3} = \\left( \\frac{192\\pi^2}{4(8)} \\right)^{1/3} = \\left( \\frac{192\\pi^2}{32} \\right)^{1/3} = \\left( 6\\pi^2 \\right)^{1/3}$$\nTo perform the stability analysis, we need a numerical estimate of this value.\nUsing $\\pi \\approx 3.14159$, we have $\\pi^2 \\approx 9.86960$.\n$$k_N h \\approx (6 \\times 9.86960)^{1/3} = (59.2176)^{1/3} \\approx 3.8978$$\nThe problem states to round any intermediate numerical estimate to four significant figures, so we use $k_N h \\approx 3.8978$.\n\nThe stability criterion is $k_N h  x_c$, where $x_c$ is the value of $k h$ at which the kernel's Fourier transform first becomes negative. We analyze each kernel separately.\n\n1.  **Cubic Spline ($M_4$) Kernel:**\n    The problem provides the critical value $x_{c, M4} = 3.8317$.\n    We must compare our calculated $k_N h$ to this value.\n    $$3.8978 \\not 3.8317$$\n    Since $k_N h  x_{c, M4}$, the stability criterion is violated. This means that wavenumbers that can be represented on the particle lattice (specifically, those close to the Nyquist limit) fall into the region where the cubic spline kernel's Fourier transform is negative, leading to the pairing instability.\n    Therefore, the cubic spline kernel is unstable for this configuration. We assign it the stability code $s_{\\rm M4}=0$.\n\n2.  **Wendland $C^4$ Kernel:**\n    The problem states that the radial Fourier transform of the Wendland $C^4$ kernel is non-negative for all wavenumbers $k \\ge 0$. This implies that there is no finite $k$ at which the transform becomes negative. We can thus consider its critical value to be infinite, $x_{c, WC4} = \\infty$.\n    The stability criterion is:\n    $$k_N h  \\infty$$\n    Our calculated value $k_N h \\approx 3.8978$ is a finite number, so this condition is satisfied.\n    Therefore, the Wendland $C^4$ kernel is stable for this configuration. We assign it the stability code $s_{\\rm WC4}=1$.\n\nThe final result is a row matrix containing the stability codes for the cubic spline ($s_{\\rm M4}$) and Wendland $C^4$ ($s_{\\rm WC4}$) kernels, respectively.", "answer": "$$\\boxed{\\begin{pmatrix} 0  1 \\end{pmatrix}}$$", "id": "3534793"}]}