{"hands_on_practices": [{"introduction": "Before building numerical solvers, it is crucial to understand the mathematical structure of the equations themselves. This exercise involves deriving the Jacobian matrix of the 1D Euler equations, which linearizes the system and reveals how information propagates through characteristic waves. By finding its eigenvalues and eigenvectors, you will uncover the fundamental wave speeds and structures that form the basis of all modern Godunov-type schemes. [@problem_id:3510528]", "problem": "In the context of constructing approximate Riemann solvers for a finite volume method for astrophysical hydrodynamics, consider the one-dimensional ($1$-dimensional) compressible Euler equations in conservative form,\n$$\n\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0,\n$$\nwith conservative state vector $U = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}$, flux $F(U) = \\begin{pmatrix} \\rho u \\\\ \\rho u^{2} + p \\\\ u\\,(E+p) \\end{pmatrix}$, and an ideal-gas equation of state $p = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho u^{2}\\right)$, where $\\rho$ is the mass density, $u$ is the velocity, $E$ is the total energy density, $p$ is the gas pressure, and $\\gamma$ is the ratio of specific heats. Define the total specific enthalpy $H = \\frac{E + p}{\\rho}$ and the adiabatic sound speed $c$ via $c^{2} = \\gamma p/\\rho$.\n\nStarting from these definitions alone, do the following:\n$1.$ Derive the flux Jacobian $A(U) = \\frac{\\partial F}{\\partial U}$ explicitly in terms of the conservative variables and the thermodynamic quantities $u$, $H$, and $c$.\n$2.$ Determine the three real eigenvalues of $A(U)$ and construct a linearly independent set of right eigenvectors corresponding to each eigenvalue. Adopt the normalization where the first component of each right eigenvector is unity.\n$3.$ Using your results, provide a closed-form expression for the characteristic polynomial $P(\\lambda)$ of the flux Jacobian in the convention $P(\\lambda) = \\det(\\lambda I - A)$, expressed solely in terms of the symbols $\\lambda$, $u$, and $c$.\n\nYour final reported answer must be the single analytic expression for $P(\\lambda)$ requested in part $3$. No numerical evaluation is required, and no units are to be given. If you choose to expand or factor the polynomial, either form is acceptable as long as it is algebraically correct and fully simplified.", "solution": "The problem requires a three-part derivation concerning the flux Jacobian of the one-dimensional compressible Euler equations. We will address each part in sequence.\n\nThe conservative state vector is $U = \\begin{pmatrix} U_1 \\\\ U_2 \\\\ U_3 \\end{pmatrix} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}$, and the flux vector is $F(U) = \\begin{pmatrix} F_1 \\\\ F_2 \\\\ F_3 \\end{pmatrix} = \\begin{pmatrix} \\rho u \\\\ \\rho u^2+p \\\\ u(E+p) \\end{pmatrix}$. The equation of state is $p = (\\gamma - 1)(E - \\frac{1}{2}\\rho u^2)$.\n\nFirst, we express the primitive variables $\\rho, u$ and the pressure $p$ in terms of the components of $U$:\n$\\rho = U_1$\n$u = \\frac{U_2}{U_1}$\n$p = (\\gamma-1)\\left(U_3 - \\frac{1}{2}U_1\\left(\\frac{U_2}{U_1}\\right)^2\\right) = (\\gamma-1)\\left(U_3 - \\frac{U_2^2}{2U_1}\\right)$.\n\nWe will need the partial derivatives of $p$ with respect to the components of $U$:\n$\\frac{\\partial p}{\\partial U_1} = (\\gamma-1)\\left(- \\frac{U_2^2}{2}(-1)U_1^{-2}\\right) = \\frac{\\gamma-1}{2}\\left(\\frac{U_2}{U_1}\\right)^2 = \\frac{\\gamma-1}{2}u^2$.\n$\\frac{\\partial p}{\\partial U_2} = (\\gamma-1)\\left(-\\frac{2U_2}{2U_1}\\right) = -(\\gamma-1)\\frac{U_2}{U_1} = -(\\gamma-1)u$.\n$\\frac{\\partial p}{\\partial U_3} = \\gamma-1$.\n\nAlso, we express the flux components in terms of $U$:\n$F_1 = U_2$\n$F_2 = \\frac{U_2^2}{U_1} + p = \\frac{U_2^2}{U_1} + (\\gamma-1)\\left(U_3 - \\frac{U_2^2}{2U_1}\\right) = \\frac{3-\\gamma}{2}\\frac{U_2^2}{U_1} + (\\gamma-1)U_3$.\n$F_3 = u(E+p) = \\frac{U_2}{U_1}(U_3 + p)$.\n\n### Part 1: Derivation of the Flux Jacobian $A(U)$\n\nThe flux Jacobian is the matrix $A(U)$ with elements $A_{ij} = \\frac{\\partial F_i}{\\partial U_j}$.\n\n**Column 1 ($j=1$):**\n$A_{11} = \\frac{\\partial F_1}{\\partial U_1} = \\frac{\\partial U_2}{\\partial U_1} = 0$.\n$A_{21} = \\frac{\\partial F_2}{\\partial U_1} = \\frac{3-\\gamma}{2}U_2^2(-1)U_1^{-2} = -\\frac{3-\\gamma}{2}u^2 = \\frac{\\gamma-3}{2}u^2$.\n$A_{31} = \\frac{\\partial (u(E+p))}{\\partial U_1} = \\frac{\\partial u}{\\partial U_1}(E+p) + u\\left(\\frac{\\partial E}{\\partial U_1} + \\frac{\\partial p}{\\partial U_1}\\right)$. We use $\\frac{\\partial u}{\\partial U_1} = -\\frac{U_2}{U_1^2} = -\\frac{u}{\\rho}$ and $\\frac{\\partial E}{\\partial U_1} = \\frac{\\partial U_3}{\\partial U_1}=0$.\n$A_{31} = -\\frac{u}{\\rho}(E+p) + u\\left(\\frac{\\gamma-1}{2}u^2\\right) = -uH + \\frac{\\gamma-1}{2}u^3 = u\\left(\\frac{\\gamma-1}{2}u^2 - H\\right)$.\n\n**Column 2 ($j=2$):**\n$A_{12} = \\frac{\\partial F_1}{\\partial U_2} = \\frac{\\partial U_2}{\\partial U_2} = 1$.\n$A_{22} = \\frac{\\partial F_2}{\\partial U_2} = \\frac{3-\\gamma}{2}\\frac{2U_2}{U_1} = (3-\\gamma)u$.\n$A_{32} = \\frac{\\partial (u(E+p))}{\\partial U_2} = \\frac{\\partial u}{\\partial U_2}(E+p) + u\\left(\\frac{\\partial E}{\\partial U_2} + \\frac{\\partial p}{\\partial U_2}\\right)$. We use $\\frac{\\partial u}{\\partial U_2} = \\frac{1}{U_1} = \\frac{1}{\\rho}$ and $\\frac{\\partial E}{\\partial U_2} = 0$.\n$A_{32} = \\frac{1}{\\rho}(E+p) + u(-(\\gamma-1)u) = H - (\\gamma-1)u^2$.\n\n**Column 3 ($j=3$):**\n$A_{13} = \\frac{\\partial F_1}{\\partial U_3} = \\frac{\\partial U_2}{\\partial U_3} = 0$.\n$A_{23} = \\frac{\\partial F_2}{\\partial U_3} = \\gamma-1$.\n$A_{33} = \\frac{\\partial (u(E+p))}{\\partial U_3} = u\\left(\\frac{\\partial E}{\\partial U_3} + \\frac{\\partial p}{\\partial U_3}\\right)$. We use $\\frac{\\partial E}{\\partial U_3} = \\frac{\\partial U_3}{\\partial U_3} = 1$.\n$A_{33} = u(1 + (\\gamma-1)) = \\gamma u$.\n\nAssembling these components, the flux Jacobian $A(U)$ is:\n$$A(U) = \\begin{pmatrix} 0 & 1 & 0 \\\\ \\frac{\\gamma-3}{2}u^2 & (3-\\gamma)u & \\gamma-1 \\\\ u\\left(\\frac{\\gamma-1}{2}u^2 - H\\right) & H - (\\gamma-1)u^2 & \\gamma u \\end{pmatrix}$$\n\n### Part 2: Eigenvalues and Right Eigenvectors of $A(U)$\n\nThe eigenvalues $\\lambda$ of $A(U)$ are the roots of the characteristic equation $\\det(A - \\lambda I) = 0$. The right eigenvectors $\\mathbf{k}$ satisfy $A\\mathbf{k} = \\lambda\\mathbf{k}$.\nThe eigenvalues of the Euler equations are known to be $\\lambda = u, u \\pm c$. We verify this and find the corresponding eigenvectors.\nA key relation, derived from the definitions of $H$ and $c$, is $c^2 = (\\gamma-1)(H - \\frac{1}{2}u^2)$.\n\nLet $\\mathbf{k} = \\begin{pmatrix} k_1 \\\\ k_2 \\\\ k_3 \\end{pmatrix}$. The system $A\\mathbf{k} = \\lambda \\mathbf{k}$ is:\n$1.$ $k_2 = \\lambda k_1$\n$2.$ $\\frac{\\gamma-3}{2}u^2 k_1 + (3-\\gamma)u k_2 + (\\gamma-1)k_3 = \\lambda k_2$\n$3.$ $u\\left(\\frac{\\gamma-1}{2}u^2 - H\\right)k_1 + (H - (\\gamma-1)u^2) k_2 + \\gamma u k_3 = \\lambda k_3$\n\nWe adopt the normalization $k_1=1$. Thus $k_2 = \\lambda$. Substituting this into equation $2$:\n$(\\gamma-1)k_3 = \\lambda^2 - (3-\\gamma)u\\lambda - \\frac{\\gamma-3}{2}u^2$.\nSubstituting into equation $3$:\n$u\\left(\\frac{\\gamma-1}{2}u^2 - H\\right) + (H - (\\gamma-1)u^2)\\lambda = (\\lambda-\\gamma u)k_3$.\nCombining these gives the characteristic equation for $\\lambda$. Letting $\\delta = \\lambda - u$, this complex equation simplifies to $\\delta(\\delta^2 - c^2) = 0$. The roots are $\\delta=0$ and $\\delta=\\pm c$, which implies the eigenvalues are $\\lambda_2=u$, $\\lambda_{1,3}=u \\pm c$.\n\n**Eigenvalue $\\lambda_2 = u$:**\nWith $\\lambda=u$, $k_1=1, k_2=u$. Equation $2$ becomes:\n$\\frac{\\gamma-3}{2}u^2 + (3-\\gamma)u^2 + (\\gamma-1)k_3 = u^2 \\implies u^2(\\frac{\\gamma-3+6-2\\gamma-2}{2}) + (\\gamma-1)k_3 = 0 \\implies \\frac{1-\\gamma}{2}u^2 + (\\gamma-1)k_3 = 0$.\nFor $\\gamma \\neq 1$, this gives $k_3 = \\frac{1}{2}u^2$.\nThe eigenvector is $\\mathbf{k}_2 = \\begin{pmatrix} 1 \\\\ u \\\\ \\frac{1}{2}u^2 \\end{pmatrix}$.\n\n**Eigenvalues $\\lambda_{1,3} = u \\mp c$:**\nWith $\\lambda = u\\mp c$, we have $k_1=1, k_2=u\\mp c$. We find $k_3$ using the expression for $(\\gamma-1)k_3$ above:\n$k_3 = \\frac{1}{\\gamma-1}\\left((u\\mp c)^2 - (3-\\gamma)u(u\\mp c) - \\frac{\\gamma-3}{2}u^2\\right)$\n$k_3 = \\frac{1}{\\gamma-1}\\left( (u^2 \\mp 2uc + c^2) - ((3-\\gamma)u^2 \\mp (3-\\gamma)uc) - \\frac{\\gamma-3}{2}u^2 \\right)$\nCollecting coefficients for powers of $u, c$:\n$k_3 = \\frac{1}{\\gamma-1} \\left[ u^2(1 - (3-\\gamma) - \\frac{\\gamma-3}{2}) \\mp uc(2 - (3-\\gamma)) + c^2 \\right]$\n$k_3 = \\frac{1}{\\gamma-1} \\left[ u^2(\\frac{\\gamma-1}{2}) \\mp uc(\\gamma-1) + c^2 \\right] = \\frac{1}{2}u^2 \\mp uc + \\frac{c^2}{\\gamma-1}$.\nUsing $c^2 = (\\gamma-1)(H - \\frac{1}{2}u^2)$, we have $\\frac{c^2}{\\gamma-1} = H - \\frac{1}{2}u^2$.\n$k_3 = \\frac{1}{2}u^2 \\mp uc + H - \\frac{1}{2}u^2 = H \\mp uc$.\nThe resulting eigenvectors are:\n$\\mathbf{k}_1 = \\begin{pmatrix} 1 \\\\ u-c \\\\ H-uc \\end{pmatrix}$ for $\\lambda_1 = u-c$.\n$\\mathbf{k}_3 = \\begin{pmatrix} 1 \\\\ u+c \\\\ H+uc \\end{pmatrix}$ for $\\lambda_3 = u+c$.\n\n(Note: The eigenvector ordering for $u-c$ and $u+c$ can be swapped, but the pairing must be consistent.)\n\n### Part 3: Characteristic Polynomial $P(\\lambda)$\n\nThe characteristic polynomial, in the convention $P(\\lambda) = \\det(\\lambda I - A)$, is a monic polynomial whose roots are the eigenvalues of $A$. Given the eigenvalues $\\lambda_1 = u-c$, $\\lambda_2 = u$, and $\\lambda_3 = u+c$, the polynomial can be written in factored form as:\n$P(\\lambda) = (\\lambda - \\lambda_1)(\\lambda - \\lambda_2)(\\lambda - \\lambda_3)$\n$P(\\lambda) = (\\lambda - (u-c))(\\lambda - u)(\\lambda - (u+c))$\n\nThis expression is already in terms of $\\lambda, u,$ and $c$. As allowed, we can provide a simplified, partially expanded form which is more revealing of its structure.\nLet $\\delta = \\lambda - u$. The expression becomes:\n$P(\\lambda) = (\\delta + c)(\\delta)(\\delta - c) = \\delta(\\delta^2 - c^2)$.\nSubstituting $\\delta = \\lambda - u$ back gives the final expression:\n$P(\\lambda) = (\\lambda-u)((\\lambda-u)^2 - c^2)$.", "answer": "$$\\boxed{(\\lambda-u)((\\lambda-u)^2 - c^2)}$$", "id": "3510528"}, {"introduction": "High-order accuracy in finite volume methods requires reconstructing data within cells, but this can introduce spurious oscillations near shocks or sharp gradients. This practice applies the characteristic decomposition from the previous exercise to a concrete numerical task: projecting state differences onto characteristic waves and applying a slope limiter in that space. This physically motivated approach is central to building robust, high-resolution shock-capturing schemes. [@problem_id:3510535]", "problem": "Consider the one-dimensional Euler equations for an ideal gas with adiabatic index $\\gamma$ written in primitive variables $\\boldsymbol{W} = (\\rho, u, p)^{\\mathsf{T}}$ on a uniform mesh. Starting from the quasi-linear primitive-variable form, derive the characteristic decomposition (eigenvalues, right and left eigenvectors) of the primitive-variable Jacobian evaluated at a given state. Then use this to perform characteristic projection and slope limiting for a second-order, piecewise-linear, finite-volume reconstruction.\n\nTake the cell-centered primitive states (in dimensionless code units) to be\n$\\boldsymbol{W}_{i-1} = (\\,1.3,\\, 0.3,\\, 1.3\\,)^{\\mathsf{T}}$, $\\boldsymbol{W}_{i} = (\\,1.0,\\, 0.2,\\, 1.0\\,)^{\\mathsf{T}}$, and $\\boldsymbol{W}_{i+1} = (\\,0.7,\\, 0.1,\\, 0.7\\,)^{\\mathsf{T}}$, with $\\gamma = 5/3$. Work in primitive variables and linearize at cell $i$. Use characteristic projection and the Monotonized Central (MC) limiter applied componentwise in characteristic space as follows. Define $\\Delta \\boldsymbol{W}_{L} = \\boldsymbol{W}_{i} - \\boldsymbol{W}_{i-1}$, $\\Delta \\boldsymbol{W}_{R} = \\boldsymbol{W}_{i+1} - \\boldsymbol{W}_{i}$, and $\\Delta \\boldsymbol{W}_{C} = (\\boldsymbol{W}_{i+1} - \\boldsymbol{W}_{i-1})/2$. Project these differences onto characteristic components via the left eigenvector matrix $\\boldsymbol{L}$ at cell $i$:\n$\\boldsymbol{\\alpha}_{L} = \\boldsymbol{L}\\,\\Delta \\boldsymbol{W}_{L}$, $\\boldsymbol{\\alpha}_{R} = \\boldsymbol{L}\\,\\Delta \\boldsymbol{W}_{R}$, and $\\boldsymbol{\\alpha}_{C} = \\boldsymbol{L}\\,\\Delta \\boldsymbol{W}_{C}$. For each characteristic field $k$, compute the limited amplitude\n$\\alpha^{\\mathrm{lim}}_{k} = \\mathrm{minmod}\\!\\left(\\alpha_{C,k},\\, 2\\,\\alpha_{L,k},\\, 2\\,\\alpha_{R,k}\\right)$, where $\\mathrm{minmod}(a,b,c)$ returns the argument of smallest magnitude if $a, b, c$ have the same sign, and returns $0$ otherwise. Reconstruct the left state at the interface $x_{i+1/2}$ by\n$\\boldsymbol{W}_{i+1/2,L} = \\boldsymbol{W}_{i} + \\tfrac{1}{2}\\,\\boldsymbol{R}\\,\\boldsymbol{\\alpha}^{\\mathrm{lim}}$, where $\\boldsymbol{R}$ is the right eigenvector matrix at cell $i$.\n\nUsing this procedure, compute the reconstructed left-state density $\\rho_{i+1/2,L}$ at $x_{i+1/2}$. Report your answer in dimensionless code units and round your answer to six significant figures.\n\nIn your derivation, begin from the conservation laws and their quasi-linear primitive-variable form, justify the characteristic decomposition, and explain the rationale for limiting in characteristic space. Briefly explain, at the end, how this one-dimensional characteristic projection and limiting procedure generalizes to multidimensional unsplit Godunov schemes in more than one spatial dimension (for example, how to treat face-normal and transverse characteristics).\n\nYour final reported quantity must be a single real number (the requested density value).", "solution": "The assigned task is to compute a reconstructed density at a cell interface using a second-order, piecewise-linear, finite-volume method with characteristic limiting. This requires deriving the characteristic decomposition of the 1D Euler equations and applying the specified limiting procedure to the given fluid states.\n\n### 1. Theoretical Framework: Characteristic Decomposition\n\nThe one-dimensional Euler equations for an ideal gas can be written in terms of primitive variables $\\boldsymbol{W} = (\\rho, u, p)^{\\mathsf{T}}$, where $\\rho$ is the density, $u$ is the fluid velocity, and $p$ is the pressure. The system is expressed in quasi-linear form as:\n$$\n\\frac{\\partial \\boldsymbol{W}}{\\partial t} + \\boldsymbol{A}(\\boldsymbol{W}) \\frac{\\partial \\boldsymbol{W}}{\\partial x} = 0\n$$\nTo find the Jacobian matrix $\\boldsymbol{A}(\\boldsymbol{W})$, we write out the advection equations for each primitive variable. For an adiabatic flow (constant entropy along streamlines), these are:\n1.  Mass conservation: $\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} = 0 \\implies \\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} + \\rho \\frac{\\partial u}{\\partial x} = 0$\n2.  Momentum conservation: $\\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} + \\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} = 0$\n3.  Entropy conservation (adiabatic condition $p \\propto \\rho^\\gamma$): $\\frac{\\partial p}{\\partial t} + u \\frac{\\partial p}{\\partial x} + \\rho c^2 \\frac{\\partial u}{\\partial x} = 0$, where $c = \\sqrt{\\gamma p / \\rho}$ is the adiabatic sound speed and $\\gamma$ is the adiabatic index.\n\nArranging these into matrix form gives the Jacobian:\n$$\n\\boldsymbol{A} = \\begin{pmatrix} u & \\rho & 0 \\\\ 0 & u & 1/\\rho \\\\ 0 & \\rho c^2 & u \\end{pmatrix}\n$$\nThe system is hyperbolic, and its behavior is governed by the eigensystem of $\\boldsymbol{A}$. The eigenvalues $\\lambda$ are the characteristic speeds at which information propagates. They are found by solving $\\det(\\boldsymbol{A} - \\lambda\\boldsymbol{I}) = 0$:\n$$\n\\det \\begin{pmatrix} u-\\lambda & \\rho & 0 \\\\ 0 & u-\\lambda & 1/\\rho \\\\ 0 & \\rho c^2 & u-\\lambda \\end{pmatrix} = (u-\\lambda)\\left( (u-\\lambda)^2 - c^2 \\right) = 0\n$$\nThe eigenvalues, ordered by speed, are:\n$\\lambda_1 = u - c$ (backward-propagating acoustic wave)\n$\\lambda_2 = u$ (entropy/contact wave)\n$\\lambda_3 = u + c$ (forward-propagating acoustic wave)\n\nThe corresponding right eigenvectors $\\boldsymbol{r}_k$ satisfy $\\boldsymbol{A}\\boldsymbol{r}_k = \\lambda_k \\boldsymbol{r}_k$. A standard set of right eigenvectors is:\n$$\n\\boldsymbol{r}_1 = \\begin{pmatrix} \\rho \\\\ -c \\\\ \\rho c^2 \\end{pmatrix}, \\quad \\boldsymbol{r}_2 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad \\boldsymbol{r}_3 = \\begin{pmatrix} \\rho \\\\ c \\\\ \\rho c^2 \\end{pmatrix}\n$$\nThe matrix of right eigenvectors, $\\boldsymbol{R}$, has these vectors as its columns: $\\boldsymbol{R} = [\\boldsymbol{r}_1, \\boldsymbol{r}_2, \\boldsymbol{r}_3]$.\n\nThe left eigenvectors $\\boldsymbol{l}_k$ satisfy $\\boldsymbol{l}_k^\\mathsf{T}\\boldsymbol{A} = \\lambda_k \\boldsymbol{l}_k^\\mathsf{T}$. They form the rows of the inverse matrix $\\boldsymbol{L} = \\boldsymbol{R}^{-1}$, chosen such that $\\boldsymbol{L}\\boldsymbol{R} = \\boldsymbol{I}$. The left eigenvectors are:\n$$\n\\boldsymbol{l}_1 = \\begin{pmatrix} 0, & -\\frac{1}{2c}, & \\frac{1}{2\\rho c^2} \\end{pmatrix}, \\quad \\boldsymbol{l}_2 = \\begin{pmatrix} 1, & 0, & -\\frac{1}{c^2} \\end{pmatrix}, \\quad \\boldsymbol{l}_3 = \\begin{pmatrix} 0, & \\frac{1}{2c}, & \\frac{1}{2\\rho c^2} \\end{pmatrix}\n$$\nThe matrix of left eigenvectors is $\\boldsymbol{L} = [\\boldsymbol{l}_1, \\boldsymbol{l}_2, \\boldsymbol{l}_3]^\\mathsf{T}$.\n\n### 2. Rationale for Characteristic Limiting\n\nIn finite volume methods, high-order spatial reconstruction can introduce spurious oscillations near sharp gradients (shocks, contacts). Slope limiters are designed to suppress these oscillations by reducing the reconstruction slope. However, the variables $(\\rho, u, p)$ are physically coupled. Limiting them component-wise can be unphysical, as it mixes information that propagates at different speeds.\n\nThe characteristic decomposition diagonalizes the system. A change in the state $\\Delta \\boldsymbol{W}$ can be projected onto the basis of right eigenvectors: $\\Delta \\boldsymbol{W} = \\sum_k \\alpha_k \\boldsymbol{r}_k$. The coefficients $\\boldsymbol{\\alpha} = (\\alpha_1, \\alpha_2, \\alpha_3)^\\mathsf{T} = \\boldsymbol{L} \\Delta\\boldsymbol{W}$ are the amplitudes of the characteristic waves. These waves evolve independently, so it is more physically robust to apply the limiter to each characteristic amplitude $\\alpha_k$ separately. This prevents mixing of different wave families and leads to sharper, more stable results.\n\n### 3. Numerical Calculation\n\n**Step 1: Evaluate State**\nWe linearize the system at cell $i$ using the state $\\boldsymbol{W}_{i} = (\\rho, u, p)^{\\mathsf{T}} = (1.0, 0.2, 1.0)^{\\mathsf{T}}$. The adiabatic index is $\\gamma = 5/3$.\nThe sound speed at cell $i$ is:\n$$\nc_i = \\sqrt{\\frac{\\gamma p_i}{\\rho_i}} = \\sqrt{\\frac{(5/3)(1.0)}{1.0}} = \\sqrt{\\frac{5}{3}}\n$$\n\n**Step 2: Compute Differences**\nThe neighboring cell states are $\\boldsymbol{W}_{i-1} = (1.3, 0.3, 1.3)^{\\mathsf{T}}$ and $\\boldsymbol{W}_{i+1} = (0.7, 0.1, 0.7)^{\\mathsf{T}}$.\nWe compute the difference vectors as defined in the problem:\n$$\n\\Delta \\boldsymbol{W}_{L} = \\boldsymbol{W}_{i} - \\boldsymbol{W}_{i-1} = \\begin{pmatrix} 1.0 - 1.3 \\\\ 0.2 - 0.3 \\\\ 1.0 - 1.3 \\end{pmatrix} = \\begin{pmatrix} -0.3 \\\\ -0.1 \\\\ -0.3 \\end{pmatrix}\n$$\n$$\n\\Delta \\boldsymbol{W}_{R} = \\boldsymbol{W}_{i+1} - \\boldsymbol{W}_{i} = \\begin{pmatrix} 0.7 - 1.0 \\\\ 0.1 - 0.2 \\\\ 0.7 - 1.0 \\end{pmatrix} = \\begin{pmatrix} -0.3 \\\\ -0.1 \\\\ -0.3 \\end{pmatrix}\n$$\n$$\n\\Delta \\boldsymbol{W}_{C} = \\frac{\\boldsymbol{W}_{i+1} - \\boldsymbol{W}_{i-1}}{2} = \\frac{1}{2}\\begin{pmatrix} 0.7 - 1.3 \\\\ 0.1 - 0.3 \\\\ 0.7 - 1.3 \\end{pmatrix} = \\frac{1}{2}\\begin{pmatrix} -0.6 \\\\ -0.2 \\\\ -0.6 \\end{pmatrix} = \\begin{pmatrix} -0.3 \\\\ -0.1 \\\\ -0.3 \\end{pmatrix}\n$$\nThe initial data lie on a straight line, so all three difference vectors are identical.\n\n**Step 3: Characteristic Projection**\nWe project these differences into characteristic space using the matrix $\\boldsymbol{L}$ evaluated at state $\\boldsymbol{W}_i$. Since $\\Delta \\boldsymbol{W}_{L} = \\Delta \\boldsymbol{W}_{R} = \\Delta \\boldsymbol{W}_{C}$, their projections will also be identical:\n$\\boldsymbol{\\alpha}_{L} = \\boldsymbol{\\alpha}_{R} = \\boldsymbol{\\alpha}_{C}$. Let's compute this vector, denoted $\\boldsymbol{\\alpha}$:\n$$\n\\boldsymbol{\\alpha} = \\boldsymbol{L}_i \\Delta \\boldsymbol{W}_{C}\n$$\nThe calculation of the full matrix $\\boldsymbol{L}_i$ and the vector $\\boldsymbol{\\alpha}$ is unnecessary for the final result, as shown in the next step.\n\n**Step 4: Apply Limiter and Reconstruct**\nThe Monotonized Central (MC) limiter is applied component-wise to the characteristic amplitudes:\n$$\n\\alpha^{\\mathrm{lim}}_{k} = \\mathrm{minmod}\\!\\left(\\alpha_{C,k},\\, 2\\,\\alpha_{L,k},\\, 2\\,\\alpha_{R,k}\\right)\n$$\nSince $\\alpha_{C,k} = \\alpha_{L,k} = \\alpha_{R,k}$, this simplifies for each component $k$:\n$$\n\\alpha^{\\mathrm{lim}}_{k} = \\mathrm{minmod}\\!\\left(\\alpha_{C,k},\\, 2\\,\\alpha_{C,k},\\, 2\\,\\alpha_{C,k}\\right)\n$$\nThe `minmod` of three arguments with the same sign is the one with the smallest magnitude. Here, that is $\\alpha_{C,k}$. Therefore, the limited amplitudes are identical to the unlimited central difference amplitudes:\n$$\n\\boldsymbol{\\alpha}^{\\mathrm{lim}} = \\boldsymbol{\\alpha}_{C}\n$$\nThe reconstructed state at the left side of the interface $x_{i+1/2}$ is given by:\n$$\n\\boldsymbol{W}_{i+1/2,L} = \\boldsymbol{W}_{i} + \\frac{1}{2}\\,\\boldsymbol{R}_i\\,\\boldsymbol{\\alpha}^{\\mathrm{lim}}\n$$\nSubstituting $\\boldsymbol{\\alpha}^{\\mathrm{lim}} = \\boldsymbol{\\alpha}_{C} = \\boldsymbol{L}_i \\Delta\\boldsymbol{W}_C$:\n$$\n\\boldsymbol{W}_{i+1/2,L} = \\boldsymbol{W}_{i} + \\frac{1}{2}\\,\\boldsymbol{R}_i\\,(\\boldsymbol{L}_i \\Delta\\boldsymbol{W}_C)\n$$\nSince $\\boldsymbol{R}_i \\boldsymbol{L}_i = \\boldsymbol{I}$, the expression simplifies significantly:\n$$\n\\boldsymbol{W}_{i+1/2,L} = \\boldsymbol{W}_{i} + \\frac{1}{2}\\,\\Delta\\boldsymbol{W}_C\n$$\nThis result is expected: for data on a straight line, a reasonable reconstruction scheme should recover that line, and the limiter should not activate.\n\n**Step 5: Final Calculation**\nWe substitute the numerical values:\n$$\n\\boldsymbol{W}_{i+1/2,L} = \\begin{pmatrix} 1.0 \\\\ 0.2 \\\\ 1.0 \\end{pmatrix} + \\frac{1}{2}\\begin{pmatrix} -0.3 \\\\ -0.1 \\\\ -0.3 \\end{pmatrix} = \\begin{pmatrix} 1.0 \\\\ 0.2 \\\\ 1.0 \\end{pmatrix} + \\begin{pmatrix} -0.15 \\\\ -0.05 \\\\ -0.15 \\end{pmatrix} = \\begin{pmatrix} 0.85 \\\\ 0.15 \\\\ 0.85 \\end{pmatrix}\n$$\nThe reconstructed left-state density at interface $x_{i+1/2}$ is the first component of this vector:\n$$\n\\rho_{i+1/2,L} = 0.85\n$$\nRounding to six significant figures as requested, the answer is $0.850000$.\n\n### 4. Generalization to Multiple Dimensions\n\nThe one-dimensional characteristic projection and limiting procedure is the building block for multidimensional unsplit Godunov-type schemes. At each face of a computational cell in a 2D or 3D mesh, the problem is treated locally as one-dimensional along the direction normal to the face.\n1.  **Face-Normal Decomposition**: For a face with normal unit vector $\\boldsymbol{\\hat{n}}$, one computes the flux Jacobian projected onto this direction, $\\boldsymbol{A}_{\\boldsymbol{\\hat{n}}} = \\boldsymbol{A}\\cdot\\boldsymbol{\\hat{n}}$. The eigensystem of this matrix is then used. For the 3D Euler equations, this results in five characteristic waves: two acoustic waves propagating normal to the face (with speeds $u_n \\pm c$, where $u_n = \\boldsymbol{u}\\cdot\\boldsymbol{\\hat{n}}$), an entropy wave, and two shear waves. The latter three all propagate with the normal fluid velocity $u_n$.\n2.  **Transverse Derivatives**: The source terms for the 1D Riemann problem at the interface arise from the gradients of quantities in the directions transverse to the face normal. These terms must be accounted for, often through a procedure known as transverse propagation correction.\n3.  **Limiting**: Slope limiting is also performed in a direction-by-direction manner. For a given face, the slopes of the primitive variables are projected onto the face-normal direction and limited using the 1D characteristic procedure. More advanced schemes use multidimensional limiting to better preserve the geometry of flow features.\n\nThis local, one-dimensional approach at each interface allows the robust and accurate methods developed for 1D problems to be extended to complex multidimensional flows.", "answer": "$$\n\\boxed{0.850000}\n$$", "id": "3510535"}, {"introduction": "In astrophysical environments with supersonic flows, the kinetic energy density $K$ can vastly exceed the internal energy density $e$. This exercise explores a critical failure mode where the standard conservative update for total energy $E = e + K$ can lead to non-physical negative pressures due to floating-point errors. You will analyze this problem of \"subtractive cancellation\" and evaluate different strategies, identifying the most robust and physically consistent fallback method used in modern astrophysical codes. [@problem_id:3510586]", "problem": "Consider the one-dimensional Euler equations for an ideal gas in conservative form,\n$$\n\\partial_t \\boldsymbol{U} + \\partial_x \\boldsymbol{F}(\\boldsymbol{U}) = 0, \\quad \\boldsymbol{U} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}, \\quad \\boldsymbol{F}(\\boldsymbol{U}) = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{pmatrix},\n$$\nwith the equation of state for an ideal gas,\n$$\np = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right), \\quad \\gamma > 1,\n$$\nwhere $\\rho$ is mass density, $u$ is velocity, $E$ is total energy density, $p$ is pressure, and $\\gamma$ is the adiabatic index. In a second-order Godunov-type finite volume method with spatial reconstruction to the interfaces and a Riemann solver, the update for cell average $\\boldsymbol{U}_i$ is\n$$\n\\boldsymbol{U}_i^{n+1} = \\boldsymbol{U}_i^{n} - \\frac{\\Delta t}{\\Delta x}\\left(\\boldsymbol{F}_{i+1/2} - \\boldsymbol{F}_{i-1/2}\\right),\n$$\nwhere $\\boldsymbol{F}_{i\\pm 1/2}$ are numerical fluxes computed from left and right reconstructed states at interfaces $x_{i\\pm 1/2}$. Let $K \\equiv \\tfrac{1}{2}\\rho u^2$ denote the kinetic energy density and $e \\equiv E - K$ denote the internal energy density. Define the internal energy fraction\n$$\n\\chi \\equiv \\frac{e}{E} = 1 - \\frac{K}{E}.\n$$\nIn high-Mach-number astrophysical flows, cells often satisfy $E \\approx K$ so that $\\chi \\ll 1$, making $p$ the result of subtracting two nearly equal large numbers. Suppose a linear reconstruction with slope limiting is used on the conserved variables to obtain left states at an interface,\n$$\nE^L = E(1+\\delta_E), \\quad \\rho^L = \\rho(1+\\delta_\\rho), \\quad u^L = u(1+\\delta_u),\n$$\nwhere $\\delta_E$, $\\delta_\\rho$, and $\\delta_u$ are small reconstruction errors due to truncation and round-off. Then the reconstructed kinetic energy is $K^L \\approx K\\left(1+\\delta_\\rho + 2\\delta_u\\right)$, and the reconstructed internal energy is $e^L = E^L - K^L$. When $E \\approx K$, even small $\\delta$â€™s can produce $e^L < 0$, leading to $p^L < 0$, which is nonphysical and can cause Riemann solver failure or catastrophic updates. A similar issue occurs on the right state.\n\nStarting from the Euler equations and the equation of state, analyze the failure mechanism when $E \\approx \\tfrac{1}{2}\\rho u^2$ and propose a mathematically consistent fallback that maintains positivity of $\\rho$ and $p$ at interfaces and during the update without globally sacrificing conservation in regimes where $\\chi$ is not small. Which option below best describes such a fallback procedure?\n\nA. Use a dual-energy fallback: evolve an auxiliary internal energy density $e$ using the internal energy equation derived from the Euler system,\n$$\n\\partial_t e + \\partial_x\\left((e+p)u\\right) - p\\,\\partial_x u = 0,\n$$\nreconstruct $(\\rho, u, e)$ at interfaces when $\\chi < \\eta$ for a small threshold $\\eta$, enforce $e^{\\text{face}} \\ge 0$ and $\\rho^{\\text{face}} > 0$ with a positivity-preserving limiter, set $p^{\\text{face}} = (\\gamma - 1)e^{\\text{face}}$, define $E^{\\text{face}} = e^{\\text{face}} + \\tfrac{1}{2}\\rho^{\\text{face}} u_{\\text{face}}^2$, and compute conservative fluxes from these states. Outside the trigger, reconstruct and update using total energy alone. For the cell update, compute pressure from $E - \\tfrac{1}{2}\\rho u^2$ when $\\chi \\ge \\eta$, but fall back to $e$ for pressure when $\\chi < \\eta$, thereby maintaining positivity while preserving global conservation of $E$ in regions where $\\chi$ is not small.\n\nB. Reduce velocity magnitude in flagged cells by rescaling $u \\to \\alpha u$ with $\\alpha < 1$ whenever $\\chi < \\eta$ to ensure $E - \\tfrac{1}{2}\\rho u^2 \\ge 0$, then reconstruct conserved variables as usual and advance with the standard fluxes.\n\nC. Add a uniform pressure floor $p_{\\min} > 0$ to all cells at every time step to prevent negative pressures, i.e., replace $p$ by $\\max\\left(p, p_{\\min}\\right)$ both in reconstruction and in the update, leaving all other parts of the scheme unchanged.\n\nD. Switch to an isothermal closure in flagged cells by enforcing $p = c_s^2 \\rho$ with constant sound speed $c_s$ whenever $\\chi < \\eta$, and evolve $(\\rho, \\rho u)$ while treating $E$ as a passive scalar.\n\nE. Continue reconstructing total energy $E$ and set any negative reconstructed internal energy to zero after the Riemann solve, i.e., if $E^{\\text{face}} - \\tfrac{1}{2}\\rho^{\\text{face}} u_{\\text{face}}^2 < 0$, then replace it by $0$ before computing $p^{\\text{face}}$, keeping all other steps unchanged.", "solution": "Begin with the Euler equations and the ideal-gas closure. The pressure is\n$$\np = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right) = (\\gamma - 1)e,\n$$\nwith $e \\equiv E - K$ and $K \\equiv \\tfrac{1}{2}\\rho u^2$. The finite volume update is conservative in the sense that\n$$\n\\boldsymbol{U}_i^{n+1} = \\boldsymbol{U}_i^{n} - \\frac{\\Delta t}{\\Delta x}\\left(\\boldsymbol{F}_{i+1/2} - \\boldsymbol{F}_{i-1/2}\\right),\n$$\nso global conservation of $\\boldsymbol{U}$ holds if the fluxes are computed consistently from physically admissible states with $\\rho > 0$ and $p \\ge 0$. The Riemann solver requires left and right states with nonnegative pressure.\n\nFailure mechanism when $E \\approx \\tfrac{1}{2}\\rho u^2$. Define $\\chi \\equiv e/E$, with $K/E = 1 - \\chi$. Consider reconstructed left state errors,\n$$\nE^L = E(1+\\delta_E), \\quad \\rho^L = \\rho(1+\\delta_\\rho), \\quad u^L = u(1+\\delta_u),\n$$\nwith $|\\delta_E|, |\\delta_\\rho|, |\\delta_u| \\ll 1$. The reconstructed kinetic energy to leading order is\n$$\nK^L = \\tfrac{1}{2}\\rho^L (u^L)^2 \\approx \\tfrac{1}{2} \\rho u^2 \\left(1+\\delta_\\rho + 2\\delta_u\\right) = K\\left(1+\\delta_\\rho + 2\\delta_u\\right).\n$$\nThe reconstructed internal energy is then\n$$\ne^L = E^L - K^L \\approx E(1+\\delta_E) - E(1-\\chi)\\left(1+\\delta_\\rho + 2\\delta_u\\right).\n$$\nPositivity $e^L \\ge 0$ requires\n$$\n(1+\\delta_E) - (1-\\chi)(1+\\delta_\\rho + 2\\delta_u) \\ge 0,\n$$\nor equivalently\n$$\n\\delta_E - (1-\\chi)(\\delta_\\rho + 2\\delta_u) \\ge -\\chi.\n$$\nWhen $\\chi \\ll 1$, the right-hand side is a small negative number, so modest imbalances between $\\delta_E$ and $(\\delta_\\rho + 2\\delta_u)$ easily violate the inequality, yielding $e^L < 0$ and hence $p^L < 0$. The same argument applies to the right reconstructed state. This is a subtractive-cancellation failure: $p$ is the difference of two nearly equal large quantities, and small reconstruction or round-off errors dominate the small internal energy.\n\nA robust fallback must (i) ensure interface and updated cell states remain in the physically admissible set $\\rho > 0$, $p \\ge 0$, and (ii) preserve conservation of $\\boldsymbol{U}$ wherever possible, especially when $\\chi$ is not small, while (iii) recovering accuracy in smooth regions. From the Euler equations, one can derive the internal energy equation by subtracting the kinetic energy evolution (obtained from the momentum equation) from the total energy equation. In one dimension for an ideal gas,\n$$\n\\partial_t E + \\partial_x\\left(u(E+p)\\right) = 0, \\quad \\partial_t K + \\partial_x\\left(uK\\right) = -p\\,\\partial_x u,\n$$\nwhich yields\n$$\n\\partial_t e + \\partial_x\\left(u e\\right) = -p\\,\\partial_x u,\n$$\nor equivalently\n$$\n\\partial_t e + \\partial_x\\left((e+p)u\\right) - p\\,\\partial_x u = 0.\n$$\nThis equation evolves $e$ in a way consistent with the Euler system. Using $e$ directly for reconstruction and pressure computation in regimes with small $\\chi$ avoids the subtractive-cancellation because $p = (\\gamma - 1)e$ depends on $e$ alone, not on $E - K$.\n\nOption-by-option analysis:\n\nA. This option proposes a dual-energy fallback grounded in the Euler equations: evolve $e$ with its non-conservative form, reconstruct $(\\rho, u, e)$ at interfaces when $\\chi$ is small, enforce positivity with a limiter so that $e^{\\text{face}} \\ge 0$ and $\\rho^{\\text{face}} > 0$, compute $p^{\\text{face}} = (\\gamma - 1)e^{\\text{face}}$, and define $E^{\\text{face}} = e^{\\text{face}} + \\tfrac{1}{2}\\rho^{\\text{face}} u_{\\text{face}}^2$. Fluxes are then computed from physically admissible states, and the finite volume update remains conservative because it uses flux differences of conserved quantities. Outside the trigger region, standard total-energy reconstruction is used, preserving accuracy and conservation when $\\chi$ is not small. For the updated cell, pressure is computed from the conservative $E$ when $\\chi$ is not small, and from $e$ when it is, maintaining positivity without globally altering conservation. This strategy directly addresses the failure mechanism by eliminating subtractive-cancellation in the pressure and is consistent with the Euler system through the derived internal energy evolution. Verdict: Correct.\n\nB. Rescaling $u$ reduces $K$ and can make $E - K$ positive, but it violates the momentum equation and destroys conservation of momentum and kinetic energy. Altering $u$ arbitrarily breaks the finite volume update derived from fluxes and introduces nonphysical dissipation and errors near shocks and contacts. Moreover, it affects the Riemann problem inconsistently. Verdict: Incorrect.\n\nC. A uniform pressure floor $p_{\\min}$ enforces $p \\ge p_{\\min}$ but it does so by fiat, not by adherence to the Euler system or conservation. It injects spurious internal energy across the domain, corrupts the thermodynamics, breaks scale invariance, and can cause large errors in low-pressure regions. It also does not prevent negative reconstructed states at interfaces unless enforced in a way that breaks conservation or introduces inconsistencies. Verdict: Incorrect.\n\nD. Switching to an isothermal closure in flagged cells replaces the energy equation with $p = c_s^2 \\rho$ locally, which is inconsistent with the conservative total energy evolution. Treating $E$ as a passive scalar decouples it from the dynamics, violating the Euler equations and undermining conservation and shock capturing. It also introduces discontinuities in physics between flagged and unflagged cells. Verdict: Incorrect.\n\nE. Zeroing negative reconstructed internal energy after the Riemann solve enforces $e^{\\text{face}} \\ge 0$, but it is a post hoc clip that breaks the consistency of the reconstructed states and the Riemann solution. It does not address the root cause (subtractive-cancellation), and it can lead to nonconservative and nonphysical fluxes because the energy state used to compute fluxes is altered in a way that is not derived from the Euler equations. This approach can create severe spurious heating and loss of accuracy. Verdict: Incorrect.\n\nTherefore, the mathematically consistent fallback that maintains positivity while adhering to conservation and the Euler framework is the dual-energy fallback with internal energy reconstruction and positivity-preserving limiting described in option A.", "answer": "$$\\boxed{A}$$", "id": "3510586"}]}