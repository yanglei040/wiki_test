{"hands_on_practices": [{"introduction": "The foundation of any numerical method for conservation laws is expressing the governing physics in a precise mathematical form. This exercise is a crucial first step, guiding you to derive the 1D Euler equations from the integral form of mass, momentum, and energy conservation. By translating these physical principles into the conservative flux-divergence form, $\\partial_{t} U + \\partial_{x} F(U) = 0$, you will construct the flux vector $F$ purely in terms of the conserved state vector $U$, a necessary formulation for modern finite-volume schemes [@problem_id:3539810].", "problem": "In compressible, inviscid, non-relativistic astrophysical hydrodynamics without external body forces, the dynamics of an ideal fluid are governed by local conservation of mass, momentum, and total energy. Consider a one-dimensional Cartesian domain along the spatial coordinate $x$, with fluid density $\\rho(x,t)$, velocity $u(x,t)$, pressure $p(x,t)$, and total energy density $E(x,t)$. The total energy density is defined by $E = \\rho e + \\tfrac{1}{2}\\rho u^{2}$, where $e$ is the specific internal energy. Assume an ideal-gas Equation of State (EOS) with constant adiabatic index $\\gamma$, so that $p = (\\gamma - 1)\\rho e$.\n\nStarting solely from the integral forms of conservation for mass, momentum, and energy over a control volume in one-dimensional Cartesian geometry, derive the conservative, flux-divergence form $\\partial_{t} U + \\partial_{x} F(U) = 0$ for the conserved state vector $U = (\\rho, \\rho u, E)$. Eliminate $e$ and $p$ using the given relations so that the resulting flux vector $F(U)$ is expressed entirely in terms of the conserved variables $(\\rho, \\rho u, E)$ and the parameter $\\gamma$, with no appearance of primitive variables other than through these conserved variables.\n\nProvide your final result as a single, closed-form analytic expression for the flux vector $F(U)$ written as a row vector with three entries, containing only $\\rho$, $\\rho u$, $E$, and $\\gamma$. Do not introduce any additional variables in the final expression. No numerical values are required.", "solution": "The problem as stated is scientifically grounded, self-contained, and well-posed. It requests the derivation of the flux vector for the one-dimensional Euler equations of gas dynamics, a standard and fundamental exercise in computational fluid dynamics and astrophysics. All necessary definitions and physical relations are provided, and there are no internal contradictions, ambiguities, or factual inaccuracies. The problem is therefore valid, and we may proceed with the derivation.\n\nThe objective is to derive the flux vector $F(U)$ for the system of conservation laws $\\partial_{t} U + \\partial_{x} F(U) = 0$, where the state vector of conserved variables is $U = (\\rho, \\rho u, E)$. The derivation will begin from the integral form of the conservation laws for mass, momentum, and energy for an ideal, inviscid fluid in a one-dimensional Cartesian domain, absent any external forces.\n\nConsider a fixed spatial control volume (CV) defined by the interval $[x_1, x_2]$. The integral form of a generic conservation law for a conserved quantity density $q$ with a corresponding flux $f_q$ is:\n$$\n\\frac{d}{dt} \\int_{x_1}^{x_2} q \\, dx = f_q(x_1) - f_q(x_2)\n$$\nThe right-hand side represents the net rate at which the quantity enters the control volume. By the Fundamental Theorem of Calculus, $f_q(x_1) - f_q(x_2) = -\\int_{x_1}^{x_2} \\frac{\\partial f_q}{\\partial x} dx$. Substituting this and bringing the time derivative inside the integral (as the domain is fixed) yields:\n$$\n\\int_{x_1}^{x_2} \\left[ \\frac{\\partial q}{\\partial t} + \\frac{\\partial f_q}{\\partial x} \\right] dx = 0\n$$\nSince this relation must hold for any arbitrary control volume $[x_1, x_2]$, the integrand must be identically zero. This gives the differential, or \"flux-divergence,\" form of the conservation law:\n$$\n\\frac{\\partial q}{\\partial t} + \\frac{\\partial f_q}{\\partial x} = 0\n$$\nWe now apply this general principle to mass, momentum, and total energy.\n\n1.  **Conservation of Mass**\n    The conserved quantity is mass density, $q = \\rho$. The mass flux, or the rate of mass trasport per unit area, is $f_{\\rho} = \\rho u$. Applying the principle above gives the continuity equation:\n    $$\n    \\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial}{\\partial x}(\\rho u) = 0\n    $$\n    This is the first component of our vector equation. The first component of the state vector is $U_1 = \\rho$, and the first component of the flux vector is $F_1 = \\rho u$.\n\n2.  **Conservation of Momentum**\n    The conserved quantity is momentum density, $q = \\rho u$. The flux of momentum has two contributions: the advective transport of momentum, $\\rho u^2$, and the force per unit area exerted by pressure, $p$. Thus, the momentum flux is $f_{\\rho u} = \\rho u^2 + p$. This gives the momentum equation:\n    $$\n    \\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial}{\\partial x}(\\rho u^2 + p) = 0\n    $$\n    The second component of the state vector is $U_2 = \\rho u$, and the second component of the flux vector is $F_2 = \\rho u^2 + p$.\n\n3.  **Conservation of Energy**\n    The conserved quantity is the total energy density, $q = E = \\rho e + \\tfrac{1}{2}\\rho u^{2}$. The flux of energy, $f_E$, is the sum of the advective transport of total energy, $E u$, and the rate of work done by pressure forces on the fluid at the boundary, $p u$. Therefore, the energy flux is $f_E = E u + p u = (E+p)u$. This gives the energy equation:\n    $$\n    \\frac{\\partial E}{\\partial t} + \\frac{\\partial}{\\partial x}((E+p)u) = 0\n    $$\n    The third component of the state vector is $U_3 = E$, and the third component of the flux vector is $F_3 = (E+p)u$.\n\nCombining these results, the system of equations is $\\partial_t U + \\partial_x F = 0$ with $U = (\\rho, \\rho u, E)$ and $F = (\\rho u, \\rho u^2 + p, (E+p)u)$. The problem requires that the flux vector $F$ be expressed solely in terms of the components of $U$, which are $\\rho$, $\\rho u$, and $E$, and the constant $\\gamma$. To achieve this, we must eliminate the primitive variables $p$ and $u$ from the expression for $F$.\n\nThe velocity $u$ can be expressed as the ratio of momentum density to mass density:\n$$\nu = \\frac{\\rho u}{\\rho}\n$$\nNext, we express the pressure $p$ in terms of the conserved variables. We are given the ideal-gas Equation of State (EOS), $p = (\\gamma-1)\\rho e$, and the definition of total energy density, $E = \\rho e + \\frac{1}{2}\\rho u^2$. From the definition of $E$, we can isolate the internal energy density $\\rho e$:\n$$\n\\rho e = E - \\frac{1}{2}\\rho u^2\n$$\nSubstituting the expression for $u$:\n$$\n\\rho e = E - \\frac{1}{2}\\rho \\left(\\frac{\\rho u}{\\rho}\\right)^2 = E - \\frac{1}{2}\\frac{(\\rho u)^2}{\\rho}\n$$\nNow, we substitute this expression for $\\rho e$ into the EOS to find $p$:\n$$\np = (\\gamma - 1) (\\rho e) = (\\gamma-1)\\left(E - \\frac{1}{2}\\frac{(\\rho u)^2}{\\rho}\\right)\n$$\nWe have now successfully expressed both $u$ and $p$ in terms of $\\rho$, $\\rho u$, and $E$. The final step is to substitute these into the components of the flux vector $F$.\n\n-   **Flux component $F_1$:**\n    $F_1 = \\rho u$. This is already a conserved variable.\n\n-   **Flux component $F_2$:**\n    $F_2 = \\rho u^2 + p$. We substitute the expressions for $u$ and $p$:\n    $$\n    F_2 = \\rho \\left(\\frac{\\rho u}{\\rho}\\right)^2 + (\\gamma-1)\\left(E - \\frac{1}{2}\\frac{(\\rho u)^2}{\\rho}\\right)\n    $$\n    $$\n    F_2 = \\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^2}{\\rho}\n    $$\n    Combining the terms proportional to $(\\rho u)^2/\\rho$:\n    $$\n    F_2 = \\left(1 - \\frac{\\gamma-1}{2}\\right)\\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E = \\left(\\frac{2 - \\gamma + 1}{2}\\right)\\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E\n    $$\n    $$\n    F_2 = \\frac{3-\\gamma}{2}\\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E\n    $$\n\n-   **Flux component $F_3$:**\n    $F_3 = (E+p)u$. We substitute the expressions for $p$ and $u$:\n    $$\n    F_3 = \\left[ E + (\\gamma-1)\\left(E - \\frac{1}{2}\\frac{(\\rho u)^2}{\\rho}\\right) \\right] \\left( \\frac{\\rho u}{\\rho} \\right)\n    $$\n    First, simplify the term in the square brackets:\n    $$\n    E + p = E + (\\gamma-1)E - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^2}{\\rho} = \\gamma E - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^2}{\\rho}\n    $$\n    Now, multiply by $u = \\frac{\\rho u}{\\rho}$:\n    $$\n    F_3 = \\left( \\gamma E - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^2}{\\rho} \\right) \\frac{\\rho u}{\\rho} = \\gamma \\frac{E(\\rho u)}{\\rho} - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^3}{\\rho^2}\n    $$\n\nSo, the flux vector $F(U)$ expressed entirely in terms of the conserved variables $(\\rho, \\rho u, E)$ is:\n$$\nF(U) = \\left( \\rho u, \\quad \\frac{3-\\gamma}{2}\\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E, \\quad \\gamma \\frac{E(\\rho u)}{\\rho} - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^3}{\\rho^2} \\right)\n$$\nThis result is in the required form.", "answer": "$$\n\\boxed{\\begin{pmatrix} \\rho u  \\frac{3-\\gamma}{2}\\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E  \\gamma \\frac{E(\\rho u)}{\\rho} - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^3}{\\rho^2} \\end{pmatrix}}\n$$", "id": "3539810"}, {"introduction": "Shock waves are ubiquitous in astrophysics and represent one of the most important nonlinear solutions to the Euler equations. This practice blends analytical derivation with computational exploration by first tasking you with deriving the famous Rankine-Hugoniot relations for the compression ratio across a shock. You will then implement this formula to investigate how the shock's compressive power depends on its strength (Mach number $M$) and the fluid's thermodynamic properties (adiabatic index $\\gamma$), providing key insights into phenomena from supernova remnants to accretion flows [@problem_id:3539802].", "problem": "Consider the one-dimensional Euler equations for an ideal, inviscid, non-relativistic fluid with the ideal-gas equation of state, where pressure $p$, density $\\rho$, velocity $u$, and specific internal energy $e$ obey $p = (\\gamma - 1)\\,\\rho\\,e$ with adiabatic index $\\gamma$. A steady, planar, normal shock is characterized by uniform upstream state $(\\rho_1, u_1, p_1)$ and uniform downstream state $(\\rho_2, u_2, p_2)$ in the shock rest frame. The upstream flow is supersonic with Mach number $M \\equiv u_1 / c_1$, where $c_1 = \\sqrt{\\gamma p_1/\\rho_1}$ is the upstream sound speed. Starting only from the conservation of mass, momentum, and energy across the discontinuity and the ideal-gas equation of state, derive an explicit expression for the compression ratio $r \\equiv \\rho_2 / \\rho_1$ as a function of $\\gamma$ and $M$. You may assume $M \\ge 1$. Express all variables and constants using dimensionless quantities; no physical units are required.\n\nAfter deriving the relation, write a program that:\n- Implements a function that, given $(\\gamma, M)$, returns the compression ratio $r$. For the boundary case $M \\le 1$, return $r = 1.0$.\n- Uses the function to compute $r$ for two values of the adiabatic index corresponding to astrophysically relevant regimes: $\\gamma = 5/3$ (monatomic ideal gas) and $\\gamma = 4/3$ (radiation-pressure-dominated surrogate).\n- Evaluates $r$ for the following set of upstream Mach numbers $M$ to probe near-threshold, moderate, and strong-shock behavior: $M \\in \\{1.0, 1.001, 1.5, 2.0, 5.0, 10.0, 100.0\\}$.\n\nTest suite:\n- Case set A: $\\gamma = 5/3$ with $M \\in \\{1.0, 1.001, 1.5, 2.0, 5.0, 10.0, 100.0\\}$.\n- Case set B: $\\gamma = 4/3$ with $M \\in \\{1.0, 1.001, 1.5, 2.0, 5.0, 10.0, 100.0\\}$.\n\nYour program should produce a single line of output containing a list of two sublists. The first sublist must contain the seven compression ratios for $\\gamma = 5/3$ in the order of $M$ given above, rounded to eight decimal places. The second sublist must contain the seven compression ratios for $\\gamma = 4/3$ in the same order of $M$, rounded to eight decimal places. The exact output format is a single line with no extra whitespace, using a comma-separated list enclosed in square brackets. For example, the output structure must be of the form:\n[[r_5_3_M1,r_5_3_M2,...,r_5_3_M7],[r_4_3_M1,r_4_3_M2,...,r_4_3_M7]]\nwhere each $r_{\\cdot}$ is a decimal with exactly eight digits after the decimal point.\n\nYour task is to:\n- Derive $r(\\gamma, M)$ from the conservation laws and the equation of state, starting from first principles.\n- Implement the specified program to compute the required values and print them in the exact format described above.", "solution": "The problem is valid as it is scientifically grounded in the principles of fluid dynamics, well-posed, and objective. It asks for the derivation of the Rankine-Hugoniot compression ratio for an ideal gas, a standard and fundamental result in the study of shock waves. All necessary information and definitions are provided, and there are no contradictions or ambiguities.\n\nThe derivation of the compression ratio $r \\equiv \\rho_2 / \\rho_1$ as a function of the adiabatic index $\\gamma$ and the upstream Mach number $M$ begins with the one-dimensional, steady-state Euler equations applied across a shock discontinuity. These are the Rankine-Hugoniot jump conditions, representing the conservation of mass, momentum, and energy.\n\nLet the upstream state be denoted by subscript $1$ and the downstream state by subscript $2$. The variables are density $\\rho$, velocity $u$, and pressure $p$.\n\nThe conservation laws are:\n1.  **Conservation of Mass:** The mass flux is constant across the shock.\n    $$ \\rho_1 u_1 = \\rho_2 u_2 $$\n2.  **Conservation of Momentum:** The sum of the dynamic pressure and static pressure is constant.\n    $$ p_1 + \\rho_1 u_1^2 = p_2 + \\rho_2 u_2^2 $$\n3.  **Conservation of Energy:** The flux of total energy is constant. A more convenient form is the conservation of total specific enthalpy.\n    $$ h_1 + \\frac{1}{2}u_1^2 = h_2 + \\frac{1}{2}u_2^2 $$\n    where $h = e + p/\\rho$ is the specific enthalpy and $e$ is the specific internal energy.\n\nThe system is closed by the ideal-gas equation of state (EOS):\n$$ p = (\\gamma - 1)\\rho e $$\n\nFrom the EOS, we can express the specific enthalpy $h$ in terms of pressure and density:\n$$ h = e + \\frac{p}{\\rho} = \\frac{p}{(\\gamma - 1)\\rho} + \\frac{p}{\\rho} = \\left(\\frac{1}{\\gamma-1} + 1\\right)\\frac{p}{\\rho} = \\frac{\\gamma}{\\gamma-1}\\frac{p}{\\rho} $$\n\nOur goal is to find an expression for the compression ratio $r = \\rho_2 / \\rho_1$ in terms of $\\gamma$ and the upstream Mach number $M = u_1 / c_1$, where $c_1 = \\sqrt{\\gamma p_1 / \\rho_1}$ is the upstream speed of sound.\n\nFrom the mass conservation equation (1), we express the downstream velocity $u_2$ in terms of the upstream velocity $u_1$ and the compression ratio $r$:\n$$ u_2 = \\frac{\\rho_1}{\\rho_2}u_1 = \\frac{u_1}{r} $$\n\nNext, we rearrange the momentum conservation equation (2) to solve for the pressure jump $p_2 - p_1$:\n$$ p_2 - p_1 = \\rho_1 u_1^2 - \\rho_2 u_2^2 $$\nSubstitute $u_2 = u_1/r$ and $\\rho_2=r\\rho_1$:\n$$ p_2 - p_1 = \\rho_1 u_1^2 - (r\\rho_1)\\left(\\frac{u_1}{r}\\right)^2 = \\rho_1 u_1^2 - \\frac{\\rho_1 u_1^2}{r} = \\rho_1 u_1^2 \\left(1 - \\frac{1}{r}\\right) $$\nDividing by $p_1$ gives the pressure ratio $p_2/p_1$:\n$$ \\frac{p_2}{p_1} - 1 = \\frac{\\rho_1 u_1^2}{p_1} \\left(1 - \\frac{1}{r}\\right) $$\nWe can relate the term $\\rho_1 u_1^2 / p_1$ to the Mach number $M$:\n$$ M^2 = \\frac{u_1^2}{c_1^2} = \\frac{u_1^2}{\\gamma p_1 / \\rho_1} = \\frac{\\rho_1 u_1^2}{\\gamma p_1} \\implies \\frac{\\rho_1 u_1^2}{p_1} = \\gamma M^2 $$\nSubstituting this into the pressure ratio equation yields:\n$$ \\frac{p_2}{p_1} = 1 + \\gamma M^2 \\left(1 - \\frac{1}{r}\\right) \\quad (\\text{Eq. A}) $$\n\nNow we turn to the energy conservation equation (3), using the expression for specific enthalpy $h$:\n$$ \\frac{\\gamma}{\\gamma-1}\\frac{p_1}{\\rho_1} + \\frac{1}{2}u_1^2 = \\frac{\\gamma}{\\gamma-1}\\frac{p_2}{\\rho_2} + \\frac{1}{2}u_2^2 $$\nSubstitute $\\rho_2 = r\\rho_1$ and $u_2 = u_1/r$:\n$$ \\frac{\\gamma}{\\gamma-1}\\frac{p_1}{\\rho_1} + \\frac{1}{2}u_1^2 = \\frac{\\gamma}{\\gamma-1}\\frac{p_2}{r\\rho_1} + \\frac{1}{2}\\frac{u_1^2}{r^2} $$\nTo simplify, let's substitute $p_2$ from the momentum equation, $p_2 = p_1 + \\rho_1 u_1^2 (1 - 1/r)$:\n$$ \\frac{\\gamma}{\\gamma-1}\\frac{p_1}{\\rho_1} + \\frac{1}{2}u_1^2 = \\frac{\\gamma}{(\\gamma-1)r\\rho_1}\\left[p_1 + \\rho_1 u_1^2 \\left(1 - \\frac{1}{r}\\right)\\right] + \\frac{1}{2}\\frac{u_1^2}{r^2} $$\nLet's rearrange the energy equation in a more suggestive way first.\n$$ \\frac{2\\gamma}{\\gamma-1}\\left(\\frac{p_1}{\\rho_1} - \\frac{p_2}{\\rho_2}\\right) = u_2^2 - u_1^2 $$\n$$ \\frac{2\\gamma}{\\gamma-1}\\left(\\frac{p_1}{\\rho_1} - \\frac{p_2}{r\\rho_1}\\right) = \\left(\\frac{u_1}{r}\\right)^2 - u_1^2 = u_1^2\\left(\\frac{1}{r^2}-1\\right) $$\n$$ \\frac{2\\gamma}{(\\gamma-1)\\rho_1}\\frac{rp_1 - p_2}{r} = -u_1^2\\frac{r^2 - 1}{r^2} $$\n$$ p_2 - rp_1 = \\frac{\\rho_1 u_1^2 (\\gamma-1)}{2\\gamma} \\frac{r^2 - 1}{r} $$\nFrom momentum, we also have $p_2 - p_1 = \\rho_1 u_1^2 (1 - 1/r)$. These two expressions for $p_2$ can be equated:\n$$ rp_1 + \\frac{\\rho_1 u_1^2 (\\gamma-1)}{2\\gamma} \\frac{r^2 - 1}{r} = p_1 + \\rho_1 u_1^2 \\frac{r - 1}{r} $$\nAssuming a shock exists ($r \\ne 1$), we can divide by $r-1$:\n$$ p_1(r-1) + \\frac{\\rho_1 u_1^2 (\\gamma-1)(r-1)(r+1)}{2\\gamma r} = \\rho_1 u_1^2 \\frac{r-1}{r} $$\n$$ p_1 + \\frac{\\rho_1 u_1^2 (\\gamma-1)(r+1)}{2\\gamma r} = \\frac{\\rho_1 u_1^2}{r} $$\nMultiply the equation by $2\\gamma r / (\\rho_1 u_1^2)$:\n$$ \\frac{2\\gamma p_1 r}{\\rho_1 u_1^2} + (\\gamma-1)(r+1) = 2\\gamma $$\nUsing $\\frac{p_1}{\\rho_1 u_1^2} = \\frac{1}{\\gamma M^2}$:\n$$ \\frac{2\\gamma r}{\\gamma M^2} + (\\gamma-1)r + (\\gamma-1) = 2\\gamma $$\n$$ \\frac{2r}{M^2} + (\\gamma-1)r = 2\\gamma - (\\gamma-1) $$\n$$ r\\left(\\frac{2}{M^2} + \\gamma - 1\\right) = \\gamma + 1 $$\n$$ r\\left(\\frac{2 + (\\gamma - 1)M^2}{M^2}\\right) = \\gamma + 1 $$\nSolving for $r$ yields the final expression for the compression ratio:\n$$ r(\\gamma, M) = \\frac{(\\gamma+1)M^2}{(\\gamma-1)M^2 + 2} $$\nFor the case $M=1$, this formula gives $r = (\\gamma+1)/(\\gamma-1+2) = 1$, corresponding to no compression. For the strong shock limit ($M \\to \\infty$), the compression ratio approaches a finite limit $r_{\\text{max}} = (\\gamma+1)/(\\gamma-1)$.\nFor a monatomic gas ($\\gamma = 5/3$), $r_{\\text{max}} = (8/3)/(2/3) = 4$. For a radiation-dominated gas ($\\gamma = 4/3$), $r_{\\text{max}} = (7/3)/(1/3) = 7$.\nThe problem specifies that for $M \\le 1$, the function should return $r=1$, which aligns with the physical reality that shocks do not form in subsonic flow.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes the compression ratio for a normal shock in an ideal gas.\n    \"\"\"\n\n    def compression_ratio(gamma: float, M: float) - float:\n        \"\"\"\n        Calculates the shock compression ratio r = rho_2 / rho_1.\n\n        Args:\n            gamma: The adiabatic index of the gas.\n            M: The upstream Mach number.\n\n        Returns:\n            The compression ratio r. For M = 1, r = 1.0.\n        \"\"\"\n        if M = 1.0:\n            return 1.0\n        \n        M2 = M * M\n        numerator = (gamma + 1.0) * M2\n        denominator = (gamma - 1.0) * M2 + 2.0\n        \n        return numerator / denominator\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case set A: gamma = 5/3\n        (5.0 / 3.0, [1.0, 1.001, 1.5, 2.0, 5.0, 10.0, 100.0]),\n        # Case set B: gamma = 4/3\n        (4.0 / 3.0, [1.0, 1.001, 1.5, 2.0, 5.0, 10.0, 100.0]),\n    ]\n\n    all_results = []\n    \n    for gamma, mach_numbers in test_cases:\n        case_results = []\n        for M in mach_numbers:\n            r = compression_ratio(gamma, M)\n            # Format the result to exactly eight decimal places.\n            formatted_r = f\"{r:.8f}\"\n            case_results.append(formatted_r)\n        \n        # Create the string representation for one sublist.\n        list_string = f\"[{','.join(case_results)}]\"\n        all_results.append(list_string)\n\n    # Final print statement in the exact required format.\n    # The output is a string representing a list of lists.\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```", "id": "3539802"}, {"introduction": "While analytical solutions provide invaluable insight, most real-world astrophysical problems require sophisticated numerical solvers. This advanced practice takes you into the heart of computational fluid dynamics, challenging you to build a first-order finite-volume hydrodynamics code from the ground up. You will implement and compare two celebrated approximate Riemann solvers, HLLE and HLLC, to critically evaluate their performance in resolving contact discontinuities—a key test that highlights the trade-offs between robustness and accuracy in numerical scheme design [@problem_id:3539851].", "problem": "Consider the one-dimensional Euler equations for an ideal gas fluid with ratio of specific heats $\\gamma$, written in conservation-law form for mass, momentum, and total energy. Let the conserved variables be $U = [\\rho, \\rho u, E]$ and the physical flux be $F(U) = [\\rho u, \\rho u^2 + p, u(E + p)]$, with equation of state $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$. The domain is periodic on the interval $[0,1]$ in dimensionless units. You are to perform a finite-volume simulation that advects a square-wave contact discontinuity at constant velocity and pressure, and compare two approximate Riemann solvers: the Harten–Lax–van Leer–Einfeldt (HLLE) solver and the Harten–Lax–van Leer–Contact (HLLC) solver, in terms of their ability to capture contact discontinuities. The comparison metric is the numerical thickness of the contact after one domain-crossing time.\n\nStarting from the foundational principles below, derive and implement a first-order accurate, explicit, finite-volume method with periodic boundary conditions for the Euler system:\n- Conservation of mass: $\\partial_t \\rho + \\partial_x(\\rho u) = 0$.\n- Conservation of momentum: $\\partial_t (\\rho u) + \\partial_x(\\rho u^2 + p) = 0$.\n- Conservation of energy: $\\partial_t E + \\partial_x(u(E + p)) = 0$.\n- Ideal gas equation of state: $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$.\n\nYour initial condition should represent a square-wave contact at uniform pressure and velocity, which is an entropy/contact wave. Specifically, set $\\gamma = 1.4$, $u_0 = 1$, $p_0 = 1$, and define two density states $\\rho_{\\mathrm{low}} = 1$ and $\\rho_{\\mathrm{high}} = 2$. The total energy density is $E = \\tfrac{p_0}{\\gamma - 1} + \\tfrac{1}{2}\\rho u_0^2$ in each region. Initialize the domain with $\\rho(x) = \\rho_{\\mathrm{high}}$ for $x \\in [0, \\tfrac{1}{2})$ and $\\rho(x) = \\rho_{\\mathrm{low}}$ for $x \\in [\\tfrac{1}{2}, 1)$, with $u(x) \\equiv u_0$ and $p(x) \\equiv p_0$, and periodic boundary conditions. Advance the solution to final time $t_{\\mathrm{end}} = 1$, corresponding to one advection of the square wave across the domain.\n\nImplement two finite-volume solvers that differ only in their numerical flux function at interfaces:\n- The Harten–Lax–van Leer–Einfeldt (HLLE) flux.\n- The Harten–Lax–van Leer–Contact (HLLC) flux.\n\nUse a Courant–Friedrichs–Lewy (CFL) number of $0.4$ to determine the time step $\\Delta t = \\mathrm{CFL}\\,\\Delta x / \\max_i(|u_i| + a_i)$, where the local sound speed is $a_i = \\sqrt{\\gamma p_i / \\rho_i}$ and $\\Delta x$ is the uniform grid spacing.\n\nDefine the contact thickness at final time as follows. Let the reference low and high densities be $\\rho_{\\mathrm{low}}$ and $\\rho_{\\mathrm{high}}$. Compute the normalized density $q_i = \\mathrm{clip}\\left((\\rho_i - \\rho_{\\mathrm{low}})/(\\rho_{\\mathrm{high}} - \\rho_{\\mathrm{low}}), 0, 1\\right)$ for each cell index $i$. Identify the sets of indices where $q_i \\in (0.1, 0.9)$; these indices mark transitional regions near contacts. The contact thickness is the number of grid cells in each contiguous transitional segment. Since the square wave has two contact interfaces in the periodic domain, report the average thickness across all transitional segments present at $t_{\\mathrm{end}}$. Express thickness as an integer number of cells.\n\nDesign a program that, for each grid resolution in the test suite, runs the simulation twice (once with HLLE and once with HLLC) and reports the measured average contact thickness for each solver.\n\nTest suite and coverage:\n- Case $1$: $N = 64$ cells (a coarse resolution to test strong numerical diffusion).\n- Case $2$: $N = 128$ cells (a moderate resolution to test convergence).\n- Case $3$: $N = 256$ cells (a finer resolution to test sharper capturing and stability).\n\nAnswer specification:\n- For each case, produce the pair $[\\text{thickness}_{\\mathrm{HLLE}}, \\text{thickness}_{\\mathrm{HLLC}}]$ of integer thicknesses in number of cells.\n- Your program should produce a single line of output containing the three pairs for the three cases as a comma-separated list of lists enclosed in square brackets, for example: $[[a,b],[c,d],[e,f]]$.\n\nAll quantities are dimensionless, and the required outputs are integers in number of grid cells. No other units are involved. The implementation must be self-contained, require no input, and adhere to the specified environment constraints.", "solution": "The problem requires the implementation and comparison of two approximate Riemann solvers, Harten–Lax–van Leer–Einfeldt (HLLE) and Harten–Lax–van Leer–Contact (HLLC), for the one-dimensional Euler equations of gas dynamics. The comparison is based on their ability to resolve a contact discontinuity. The solution is developed using a first-order, explicit finite-volume method.\n\nThe one-dimensional Euler equations in conservation form are given by:\n$$\n\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0\n$$\nwhere $U$ is the vector of conserved variables and $F(U)$ is the vector of corresponding fluxes. For an ideal gas with a ratio of specific heats $\\gamma$, these are:\n$$\nU = \\begin{bmatrix} \\rho \\\\ \\rho u \\\\ E \\end{bmatrix}, \\quad F(U) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E + p) \\end{bmatrix}\n$$\nHere, $\\rho$ is the fluid density, $u$ is the velocity, $E$ is the total energy density per unit volume, and $p$ is the pressure. The system is closed by the ideal gas equation of state, which connects pressure to the conserved quantities:\n$$\np = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho u^2\\right)\n$$\n\nThe numerical solution is constructed using a finite-volume method on a uniform grid over the periodic domain $[0,1]$. The domain is discretized into $N$ cells of width $\\Delta x = 1/N$. Let $U_i(t)$ be the spatial average of the conserved variables over the $i$-th cell, $[x_{i-1/2}, x_{i+1/2}]$, at time $t$. Integrating the conservation law over cell $i$ yields the semi-discrete update equation:\n$$\n\\frac{dU_i}{dt} = -\\frac{1}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\nwhere $F_{i+1/2}$ is the numerical flux at the interface between cell $i$ and cell $i+1$. For a first-order accurate scheme, this flux is a function of the constant states in the adjacent cells, $U_i$ and $U_{i+1}$: $F_{i+1/2} = F_{\\text{num}}(U_i, U_{i+1})$. The time integration is performed using an explicit forward Euler method:\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2}^n - F_{i-1/2}^n \\right)\n$$\nThe time step $\\Delta t$ is determined by the Courant–Friedrichs–Lewy (CFL) condition to ensure numerical stability:\n$$\n\\Delta t = \\text{CFL} \\frac{\\Delta x}{\\max_i(|u_i| + a_i)}\n$$\nwhere $a_i = \\sqrt{\\gamma p_i / \\rho_i}$ is the local sound speed in cell $i$, and we use a CFL number of $0.4$.\n\nThe core of the method lies in the choice of the numerical flux function, $F_{\\text{num}}$. We implement and compare two such functions.\n\n**1. The Harten–Lax–van Leer–Einfeldt (HLLE) Solver**\nThe HLLE solver is based on a two-wave model of the Riemann problem, assuming the solution consists of the original left and right states separated by a single contact region bounded by the fastest left-going and right-going waves. The signal speeds are estimated as:\n$$\nS_L = \\min(u_L - a_L, u_R - a_R) \\quad \\text{and} \\quad S_R = \\max(u_L + a_L, u_R + a_R)\n$$\nwhere the subscripts $L$ and $R$ denote the states to the left and right of the interface, respectively. The HLLE flux is then given by a piecewise function:\n$$\nF_{\\text{HLLE}}(U_L, U_R) = \\begin{cases} \nF(U_L)  \\text{if } S_L \\geq 0 \\\\\n\\frac{S_R F(U_L) - S_L F(U_R) + S_L S_R (U_R - U_L)}{S_R - S_L}  \\text{if } S_L  0  S_R \\\\\nF(U_R)  \\text{if } S_R \\leq 0\n\\end{cases}\n$$\nThis solver is very robust but is known to be diffusive, as it smears out intermediate waves like contact discontinuities and shear waves.\n\n**2. The Harten–Lax–van Leer–Contact (HLLC) Solver**\nThe HLLC solver improves upon HLLE by reintroducing the contact wave into the model, resulting in a three-wave structure ($S_L$, $S_*$, $S_R$). The contact wave speed $S_*$ is estimated as:\n$$\nS_* = \\frac{p_R - p_L + \\rho_L u_L (S_L - u_L) - \\rho_R u_R (S_R - u_R)}{\\rho_L (S_L - u_L) - \\rho_R (S_R - u_R)}\n$$\nThis addition allows the HLLC solver to exactly resolve isolated contact discontinuities. The flux is again a piecewise function, but now with four regions defined by the wave speeds:\n$$\nF_{\\text{HLLC}}(U_L, U_R) = \\begin{cases} \nF_L  \\text{if } 0 \\le S_L \\\\\nF_L + S_L(U_*^L - U_L)  \\text{if } S_L  0 \\le S_* \\\\\nF_R + S_R(U_*^R - U_R)  \\text{if } S_*  0  S_R \\\\\nF_R  \\text{if } S_R \\le 0\n\\end{cases}\n$$\nwhere $F_L = F(U_L)$, $F_R = F(U_R)$, and $U_*^K$ ($K \\in \\{L, R\\}$) are the states in the \"star\" region between the acoustic waves and the contact wave. These are given by:\n$$\nU_*^K = \\rho_K \\left( \\frac{S_K - u_K}{S_K - S_*} \\right) \\begin{bmatrix} 1 \\\\ S_* \\\\ E_K/\\rho_K + (S_* - u_K)(S_* + p_K/(\\rho_K(S_K-u_K))) \\end{bmatrix}\n$$\n\n**Simulation Setup and Measurement**\nThe simulation is initialized with a contact discontinuity. The parameters are $\\gamma = 1.4$, uniform velocity $u_0 = 1$, and uniform pressure $p_0 = 1$. The density profile is a square wave: $\\rho = \\rho_{\\mathrm{high}} = 2$ for $x \\in [0, 0.5)$ and $\\rho = \\rho_{\\mathrm{low}} = 1$ for $x \\in [0.5, 1)$. This setup is an exact solution to the Euler equations, representing a contact wave advecting with speed $u_0=1$. The simulation runs until $t_{\\mathrm{end}}=1$, which corresponds to one full period of the wave crossing the domain.\n\nThe performance of each solver is quantified by the numerical thickness of the contact discontinuity at the final time. The density $\\rho_i$ in each cell is normalized:\n$$\nq_i = \\text{clip}\\left(\\frac{\\rho_i - \\rho_{\\mathrm{low}}}{\\rho_{\\mathrm{high}} - \\rho_{\\mathrm{low}}}, 0, 1\\right)\n$$\nCells where $q_i \\in (0.1, 0.9)$ are considered part of a transitional region. Due to periodicity, the initial condition has two such transitions. The thickness is defined as the number of cells in a contiguous transitional segment. The final reported value is the average thickness over the two segments present at $t_{\\mathrm{end}}$, rounded to the nearest integer.\n\nThe algorithm proceeds by initializing the grid with the square-wave initial condition, then entering a time loop. In each step, $\\Delta t$ is computed, numerical fluxes are calculated at all cell interfaces using either the HLLE or HLLC solver, and the conserved variables in all cells are updated. Periodic boundary conditions are enforced by treating the grid as a circular array. After reaching $t_{\\mathrm{end}}$, the final density profile is analyzed to compute the average contact thickness. This process is repeated for each solver and each specified grid resolution $N$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Global constants\nGAMMA = 1.4\n\ndef cons_to_prim(U):\n    \"\"\"Converts a conserved state vector U to primitive variables rho, u, p.\"\"\"\n    rho = U[..., 0]\n    # To avoid division by zero in vacuum states (not in this problem, but good practice)\n    u = U[..., 1] / (rho + 1e-12)\n    E = U[..., 2]\n    # Prevent negative pressure from numerical errors\n    p = np.maximum((GAMMA - 1.0) * (E - 0.5 * rho * u**2), 1e-9)\n    return rho, u, p\n\ndef prim_to_cons(rho, u, p):\n    \"\"\"Converts primitive variables rho, u, p to a conserved state vector U.\"\"\"\n    shape = rho.shape + (3,) if rho.ndim  0 else (3,)\n    U = np.zeros(shape)\n    U[..., 0] = rho\n    U[..., 1] = rho * u\n    U[..., 2] = p / (GAMMA - 1.0) + 0.5 * rho * u**2\n    return U\n\ndef get_physical_flux_from_cons(U):\n    \"\"\"Computes the physical flux F from a conserved state vector U.\"\"\"\n    rho, u, p = cons_to_prim(U)\n    F = np.zeros_like(U)\n    F[..., 0] = rho * u\n    F[..., 1] = rho * u**2 + p\n    F[..., 2] = u * (U[..., 2] + p)\n    return F\n\ndef hlle_flux(U_L, U_R):\n    \"\"\"Computes the HLLE flux at interfaces.\"\"\"\n    rho_L, u_L, p_L = cons_to_prim(U_L)\n    rho_R, u_R, p_R = cons_to_prim(U_R)\n\n    a_L = np.sqrt(GAMMA * p_L / rho_L)\n    a_R = np.sqrt(GAMMA * p_R / rho_R)\n\n    S_L = np.minimum(u_L - a_L, u_R - a_R)\n    S_R = np.maximum(u_L + a_L, u_R + a_R)\n\n    F_L = get_physical_flux_from_cons(U_L)\n    F_R = get_physical_flux_from_cons(U_R)\n    \n    # Numerator of the intermediate HLLE flux state\n    F_hlle_num = (S_R[:, None] * F_L - S_L[:, None] * F_R +\n                  S_L[:, None] * S_R[:, None] * (U_R - U_L))\n    F_hlle_den = S_R - S_L\n    \n    F_hlle = F_hlle_num / (F_hlle_den[:, None] + 1e-12)\n\n    flux = np.zeros_like(U_L)\n    \n    cond_L_region = S_L = 0\n    cond_R_region = S_R = 0\n    cond_HLL_region = ~(cond_L_region | cond_R_region)\n    \n    flux = np.where(cond_L_region[:, None], F_L, flux)\n    flux = np.where(cond_R_region[:, None], F_R, flux)\n    flux = np.where(cond_HLL_region[:, None], F_hlle, flux)\n    \n    return flux\n\ndef hllc_flux(U_L, U_R):\n    \"\"\"Computes the HLLC flux at interfaces.\"\"\"\n    rho_L, u_L, p_L = cons_to_prim(U_L)\n    rho_R, u_R, p_R = cons_to_prim(U_R)\n\n    a_L = np.sqrt(GAMMA * p_L / rho_L)\n    a_R = np.sqrt(GAMMA * p_R / rho_R)\n\n    S_L = np.minimum(u_L - a_L, u_R - a_R)\n    S_R = np.maximum(u_L + a_L, u_R + a_R)\n\n    S_star_num = (p_R - p_L + rho_L * u_L * (S_L - u_L) - rho_R * u_R * (S_R - u_R))\n    S_star_den = (rho_L * (S_L - u_L) - rho_R * (S_R - u_R))\n    S_star = S_star_num / (S_star_den + 1e-12)\n\n    F_L = get_physical_flux_from_cons(U_L)\n    F_R = get_physical_flux_from_cons(U_R)\n    \n    flux = np.zeros_like(U_L)\n\n    # Conditions based on interface location relative to waves\n    cond_L_region = S_L = 0\n    cond_R_region = S_R = 0\n    cond_L_star_region = (S_L  0)  (S_star = 0)\n    cond_R_star_region = (S_R  0)  (S_star  0)\n\n    # Flux in L region\n    flux = np.where(cond_L_region[:, None], F_L, flux)\n    # Flux in R region\n    flux = np.where(cond_R_region[:, None], F_R, flux)\n\n    if np.any(cond_L_star_region):\n        fact = rho_L * (S_L - u_L) / (S_L - S_star)\n        U_star_L = np.zeros_like(U_L)\n        U_star_L[:, 0] = fact\n        U_star_L[:, 1] = fact * S_star\n        E_L = U_L[:, 2]\n        term_E = (S_star - u_L) * (S_star + p_L / (rho_L * (S_L - u_L) + 1e-12))\n        U_star_L[:, 2] = fact * (E_L / rho_L + term_E)\n        F_star_L = F_L + S_L[:, None] * (U_star_L - U_L)\n        flux = np.where(cond_L_star_region[:, None], F_star_L, flux)\n        \n    if np.any(cond_R_star_region):\n        fact = rho_R * (S_R - u_R) / (S_R - S_star)\n        U_star_R = np.zeros_like(U_R)\n        U_star_R[:, 0] = fact\n        U_star_R[:, 1] = fact * S_star\n        E_R = U_R[:, 2]\n        term_E = (S_star - u_R) * (S_star + p_R / (rho_R * (S_R - u_R) + 1e-12))\n        U_star_R[:, 2] = fact * (E_R / rho_R + term_E)\n        F_star_R = F_R + S_R[:, None] * (U_star_R - U_R)\n        flux = np.where(cond_R_star_region[:, None], F_star_R, flux)\n\n    return flux\n\ndef run_simulation(N, solver_type, CFL, t_end):\n    \"\"\"Main simulation driver.\"\"\"\n    dx = 1.0 / N\n    x = np.linspace(0.5 * dx, 1.0 - 0.5 * dx, N)\n    \n    rho_low, rho_high = 1.0, 2.0\n    p0, u0 = 1.0, 1.0\n\n    rho = np.full(N, rho_low)\n    rho[x  0.5] = rho_high\n    u = np.full(N, u0)\n    p = np.full(N, p0)\n\n    U = prim_to_cons(rho, u, p)\n\n    flux_func = hlle_flux if solver_type == 'HLLE' else hllc_flux\n\n    t = 0.0\n    while t  t_end:\n        rho_n, u_n, p_n = cons_to_prim(U)\n        a_n = np.sqrt(GAMMA * p_n / rho_n)\n        max_speed = np.max(np.abs(u_n) + a_n)\n        dt = CFL * dx / max_speed\n        if t + dt  t_end:\n            dt = t_end - t\n\n        U_L = U\n        U_R = np.roll(U, -1, axis=0)\n        \n        fluxes = flux_func(U_L, U_R)\n        fluxes_L = np.roll(fluxes, 1, axis=0)\n        \n        U = U - (dt / dx) * (fluxes - fluxes_L)\n        \n        t += dt\n\n    final_rho = U[:, 0]\n    return calculate_thickness(final_rho, rho_low, rho_high)\n\ndef calculate_thickness(rho, rho_low, rho_high):\n    \"\"\"Calculates the average thickness of contact discontinuities.\"\"\"\n    q = (rho - rho_low) / (rho_high - rho_low)\n    q = np.clip(q, 0, 1)\n    \n    is_transitional = (q  0.1)  (q  0.9)\n    total_cells = np.sum(is_transitional)\n    \n    if total_cells == 0:\n        return 0\n\n    is_transitional_shifted = np.roll(is_transitional, 1)\n    num_segments = np.sum(is_transitional  ~is_transitional_shifted)\n\n    if num_segments == 0:\n        return total_cells if total_cells  0 else 0\n\n    avg_thickness = total_cells / num_segments\n    return int(round(avg_thickness))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [64, 128, 256]\n    CFL = 0.4\n    t_end = 1.0\n\n    results = []\n    for N in test_cases:\n        thickness_hlle = run_simulation(N, 'HLLE', CFL, t_end)\n        thickness_hllc = run_simulation(N, 'HLLC', CFL, t_end)\n        results.append([thickness_hlle, thickness_hllc])\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"[{r[0]},{r[1]}]\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3539851"}]}