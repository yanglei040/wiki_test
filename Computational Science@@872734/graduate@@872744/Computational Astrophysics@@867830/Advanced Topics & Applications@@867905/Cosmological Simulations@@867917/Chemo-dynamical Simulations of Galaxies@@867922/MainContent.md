## Introduction
Chemo-dynamical simulations represent one of the most powerful tools in modern [computational astrophysics](@entry_id:145768), providing a virtual laboratory to unravel the complex processes that govern how galaxies form and evolve. Understanding a galaxy requires tracing the intricate, coupled evolution of its primary components—dark matter, stars, and interstellar gas—along with the production and distribution of [heavy elements](@entry_id:272514) over billions of years. These simulations address the fundamental knowledge gap between the microphysics of star formation and feedback and the macroscopic, observable properties of galaxies, such as their morphology, [kinematics](@entry_id:173318), and chemical composition.

This article provides a comprehensive overview of the physics and numerics behind these powerful models. To build a complete picture, we will proceed through three distinct chapters. The first, **Principles and Mechanisms**, lays the theoretical groundwork, dissecting the governing equations for the collisionless and fluid components of a galaxy and introducing the critical [subgrid models](@entry_id:755601) that encapsulate baryonic physics. Next, **Applications and Interdisciplinary Connections** will showcase how these principles are applied to study diverse phenomena, from the multi-phase structure of the [interstellar medium](@entry_id:150031) to the violent merger of galaxies and the [secular evolution](@entry_id:158486) of galactic disks. Finally, a series of **Hands-On Practices** will offer the opportunity to engage directly with the core concepts, building an intuitive understanding of [numerical stability](@entry_id:146550), [radiative cooling](@entry_id:754014), and feedback loops. We begin by exploring the foundational principles that form the engine of all [chemo-dynamical simulations](@entry_id:747327).

## Principles and Mechanisms

Chemo-dynamical simulations of galaxies are built upon a set of foundational physical principles and numerical techniques that describe the coupled evolution of dark matter, stars, and interstellar gas. This chapter delineates these core principles, from the governing [equations of motion](@entry_id:170720) to the microphysical processes that drive galactic evolution, and introduces the numerical machinery used to solve them.

### Governing Equations: A Tale of Two Components

A galaxy is a multi-component system, dominated dynamically by [collisionless matter](@entry_id:747486) (dark matter and stars) and a collisional, dissipative fluid (the interstellar gas). The fundamental difference in their governing physics necessitates distinct theoretical and numerical treatments.

#### The Collisionless Component: Stars and Dark Matter

The stellar and dark matter components of a galaxy are effectively **collisionless**. The timescale for gravitational two-body encounters to significantly alter a particle's orbit (the relaxation time) is typically much longer than the age of the universe. Consequently, individual stars and dark matter particles are assumed to move under the influence of the smooth, mean-field [gravitational potential](@entry_id:160378), $\Phi(\mathbf{x}, t)$, generated by the total mass distribution of the galaxy.

The state of such a system is completely described by the one-particle **[phase-space distribution](@entry_id:151304) function**, $f(\mathbf{x}, \mathbf{v}, t)$. This function is defined such that $f(\mathbf{x}, \mathbf{v}, t) \, \mathrm{d}^3\mathbf{x} \, \mathrm{d}^3\mathbf{v}$ gives the expected number of particles within an infinitesimal phase-space volume element $\mathrm{d}^3\mathbf{x} \, \mathrm{d}^3\mathbf{v}$ around the point $(\mathbf{x}, \mathbf{v})$ at time $t$ [@problem_id:3505139]. The evolution of this function is governed by the **collisionless Boltzmann equation** (CBE), also known as the Vlasov equation:
$$
\frac{\partial f}{\partial t} + \mathbf{v} \cdot \nabla_{\mathbf{x}} f - \nabla_{\mathbf{x}} \Phi \cdot \nabla_{\mathbf{v}} f = 0
$$
This equation is a statement of Liouville's theorem: the [phase-space density](@entry_id:150180) $f$ is conserved along the trajectory of any particle. The system of equations is closed by coupling the CBE to the **Poisson equation**, which relates the gravitational potential $\Phi$ to the total mass density $\rho_{\mathrm{tot}}$, sourced by all components (dark matter, stars, and gas):
$$
\nabla^2 \Phi = 4\pi G \rho_{\mathrm{tot}}
$$
where the stellar contribution to the density is found by integrating the [distribution function](@entry_id:145626) over all velocities: $\rho_{\star}(\mathbf{x}, t) = m_{\star} \int f(\mathbf{x}, \mathbf{v}, t) \, \mathrm{d}^3\mathbf{v}$.

An alternative approach is to describe the stellar system using velocity moments of the CBE, leading to a hierarchy of fluid-like equations known as the Jeans equations. However, this hierarchy suffers from a fundamental **[closure problem](@entry_id:160656)**: the equation for the $n$-th moment of the velocity distribution always depends on the $(n+1)$-th moment. For instance, the evolution of the [mean velocity](@entry_id:150038) (first moment) depends on the velocity dispersion tensor (second moment), whose evolution in turn depends on the third moment. Truncating this hierarchy requires making an assumption about a higher-order moment, a step that lacks strong physical justification for a collisionless system, which is not guaranteed to be in [local thermodynamic equilibrium](@entry_id:139579) [@problem_id:3505139]. The direct solution of the CBE (via N-body methods, as discussed later) avoids this [closure problem](@entry_id:160656) by retaining the full 6D phase-space information.

#### The Collisional Component: Interstellar Gas

The [interstellar medium](@entry_id:150031) (ISM) behaves as a collisional, [compressible fluid](@entry_id:267520). Its evolution is described by the **Euler equations** of [gas dynamics](@entry_id:147692), augmented with source terms that represent the crucial baryonic physics of galaxy formation. In **[conservative form](@entry_id:747710)**, these equations express the [conservation of mass](@entry_id:268004), momentum, and energy for a fluid element [@problem_id:3505135].

Let $\rho$ be the gas mass density, $\mathbf{v}$ the velocity, and $E$ the total energy density, defined as the sum of internal energy density $\rho\epsilon$ and kinetic energy density $\frac{1}{2}\rho|\mathbf{v}|^2$. With pressure $P$ given by an ideal gas [equation of state](@entry_id:141675), e.g., $P = (\gamma-1)\rho\epsilon$, the system of equations is:

**1. Mass Conservation (Continuity Equation):**
$$
\frac{\partial \rho}{\partial t} + \nabla \cdot \left(\rho\,\mathbf{v}\right) = S_{\rho}^{\mathrm{fb}}
$$
The left side describes how the local density changes due to the flux of mass, $\rho\mathbf{v}$. The right side, $S_{\rho}^{\mathrm{fb}}$, is a [source term](@entry_id:269111) representing mass injection into the ISM from stellar processes like winds and [supernovae](@entry_id:161773).

**2. Momentum Conservation:**
$$
\frac{\partial \left(\rho\,\mathbf{v}\right)}{\partial t} + \nabla \cdot \left(\rho\,\mathbf{v}\,\mathbf{v} + P\,\mathbf{I}\right) = \rho\,\mathbf{g} + \mathbf{S}_{\mathrm{mom}}^{\mathrm{fb}}
$$
The momentum density, $\rho\mathbf{v}$, which captures all bulk, turbulent, and rotational motions, changes due to the flux of momentum. This flux has two parts: the advection of momentum with the flow, $\rho\mathbf{v}\mathbf{v}$, and the force exerted by the fluid's pressure, $P\mathbf{I}$, where $\mathbf{I}$ is the identity tensor. Source terms include the [body force](@entry_id:184443) from gravity, $\rho\mathbf{g}$ (where $\mathbf{g} = -\nabla\Phi$), and momentum injected by [stellar feedback](@entry_id:755431), $\mathbf{S}_{\mathrm{mom}}^{\mathrm{fb}}$.

**3. Energy Conservation:**
$$
\frac{\partial E}{\partial t} + \nabla \cdot \left[\left(E + P\right)\,\mathbf{v}\right] = \rho\,\mathbf{v}\cdot \mathbf{g} - \mathcal{C}(\rho, T, Z) + S_{E}^{\mathrm{fb}}
$$
The total energy density $E$ changes due to its flux, which includes both the advection of energy, $E\mathbf{v}$, and the rate of work done by pressure forces, $P\mathbf{v}$. The source terms are critical: $\rho\mathbf{v}\cdot\mathbf{g}$ is the rate of work done by gravity; $\mathcal{C}$ is a sink term representing volumetric energy loss from [radiative cooling](@entry_id:754014); and $S_{E}^{\mathrm{fb}}$ is the energy injected by [stellar feedback](@entry_id:755431) [@problem_id:3505135].

### Chemical Evolution: Tracking the Elements

A central goal of [chemo-dynamical simulations](@entry_id:747327) is to track the production and distribution of heavy elements (metals). This is achieved by treating the **metal [mass fraction](@entry_id:161575)**, $Z$, as a passive scalar field advected with the gas flow.

The evolution of metals is governed by the conservation of metal mass. The metal mass density is $\rho_Z = \rho Z$. Its transport equation in [conservative form](@entry_id:747710), including advection, diffusion, and sources, is:
$$
\frac{\partial (\rho Z)}{\partial t} + \nabla \cdot (\rho Z \mathbf{v}) = \nabla \cdot (\rho \kappa_t \nabla Z) + S_{Z}
$$
Here, $\rho Z \mathbf{v}$ is the advective flux. The first term on the right models the mixing effect of unresolved turbulence as a [diffusive flux](@entry_id:748422), proportional to a [turbulent diffusivity](@entry_id:196515) $\kappa_t$ and the gradient of the [mass fraction](@entry_id:161575) $Z$. $S_Z$ is the volumetric source rate of new metals from [stellar nucleosynthesis](@entry_id:138552) [@problem_id:3505176].

By applying the [product rule](@entry_id:144424) and using the gas continuity equation, this conservative law can be transformed into an equation for the evolution of the primitive variable $Z$:
$$
\frac{\partial Z}{\partial t} + \mathbf{v} \cdot \nabla Z = \frac{1}{\rho} \nabla \cdot (\rho \kappa_t \nabla Z) + \frac{S_Z}{\rho}
$$
The term on the left is the [material derivative](@entry_id:266939), $\frac{DZ}{Dt}$. In the absence of diffusion and sources, $\frac{DZ}{Dt} = 0$, meaning the metallicity of a given fluid parcel is conserved as it moves.

The source term, $S_Z$, encapsulates the physics of galactic [chemical evolution](@entry_id:144713). It is calculated by integrating the yields from all stellar populations that die at a given time $t$. This requires knowledge of the **Initial Mass Function** (IMF), $\phi(M)$, which describes the birth distribution of stellar masses, and the stellar yields, $y_k(M)$, which specify the mass of newly synthesized element $k$ ejected by a star of initial mass $M$ [@problem_id:3505145].

In the most general **time-delayed enrichment** model, the [source term](@entry_id:269111) accounts for the finite lifetime of stars, $\tau(M)$. The rate of element $k$ injection at time $t$ is an integral over all stars that were born at earlier times $t - \tau(M)$ and are dying now:
$$
S_k(t) = \int_{M_{\ell}}^{M_{u}} \psi(t-\tau(M))\,\phi(M)\,\Big[y_k(M) + Z_k(t-\tau(M))\,\big(M - M_{\mathrm{r}}(M)\big)\Big]\,H(t-\tau(M))\,dM
$$
Here, $\psi$ is the [star formation](@entry_id:160356) rate, $M_r(M)$ is the remnant mass, and $Z_k(t-\tau(M))$ accounts for the unprocessed material returned by the star, which had the gas-phase metallicity at the time of its birth. The Heaviside step function $H$ ensures causality [@problem_id:3505145]. A common simplification is the **Instantaneous Recycling Approximation (IRA)**, which assumes $\tau(M) \to 0$, so that all enrichment occurs simultaneously with star formation. This simplifies the convolution integral into an algebraic expression, which is a reasonable approximation for elements produced primarily by massive, short-lived stars.

### Baryonic Physics: Subgrid Models and Source Terms

The source terms in the hydrodynamical equations encode complex, small-scale physics that cannot be resolved directly in a galaxy-scale simulation. This unresolved physics is incorporated via **[subgrid models](@entry_id:755601)**.

#### Radiative Cooling and Heating

The term $-\mathcal{C}$ in the [energy equation](@entry_id:156281) represents the net effect of radiative processes. In the optically thin limit, this is the balance between cooling and heating. The volumetric cooling rate is dominated by two-body collisional processes and scales as $C = n_e n_H \Lambda(T,Z)$, where $n_e$ and $n_H$ are the electron and hydrogen number densities, respectively. The **cooling function**, $\Lambda(T,Z)$, encapsulates the microphysics of [collisional excitation](@entry_id:159854), ionization, recombination, and Bremsstrahlung. In contrast, [photoheating](@entry_id:753413) by an external UV background is a one-body process (photoabsorption) and scales linearly with density: $H = n_H \Gamma$, where $\Gamma$ is the heating rate per hydrogen atom [@problem_id:3505173].

Metallicity plays a crucial role in cooling. While hydrogen and helium cooling is inefficient in the temperature range $10^4 \lesssim T \lesssim 10^7$ K, heavy elements possess complex electronic structures with many bound-bound transitions. These transitions can be collisionally excited, leading to efficient [line cooling](@entry_id:157856) that radiates away thermal energy. Consequently, increasing the metallicity $Z$ dramatically increases the value of $\Lambda$, particularly in this temperature range, a process vital for the condensation of gas out of hot galactic halos [@problem_id:3505173].

#### Star Formation

Star formation occurs in dense, cold [molecular clouds](@entry_id:160702), on scales far below what galaxy simulations can resolve. It must therefore be implemented as a subgrid recipe that converts gas into star particles based on local, resolved gas properties. Common criteria for [star formation](@entry_id:160356) include [@problem_id:3505148]:
*   **Density Threshold:** Gas must exceed a certain number density, $n > n_{\mathrm{th}}$. This is motivated by the idea that at high densities, the [free-fall time](@entry_id:261377) becomes short enough for collapse to proceed before disruptive events occur.
*   **Gravitational Boundedness:** The gas clump must be gravitationally bound. This is often tested using the virial parameter, $\alpha = 2E_K/|E_P|$, with a requirement that $\alpha \le \alpha_{\mathrm{crit}}$ (typically $\alpha_{\mathrm{crit}} \le 2$). This criterion filters out transient, unbound overdensities.
*   **Gravitational Instability:** In disk galaxies, large-scale [gravitational instability](@entry_id:160721) can trigger star formation. This is often modeled using the Toomre $Q$ parameter, $Q = \frac{\sigma \kappa}{\pi G \Sigma}$, with a requirement that $Q  1$ for instability.
*   **Molecular Fraction:** Since [star formation](@entry_id:160356) occurs in [molecular clouds](@entry_id:160702), some models require a minimum molecular hydrogen fraction, $f_{\text{H}_2} > f_{\text{H}_{2, \text{min}}}$. This introduces a chemo-dynamical link: $\text{H}_2$ formation is catalyzed by dust grains, so its rate depends on metallicity. Higher metallicity leads to more dust, more $\text{H}_2$, and thus more star formation, creating a feedback loop [@problem_id:3505148].

#### Stellar Feedback

Massive stars and supernovae inject vast amounts of energy, momentum, mass, and metals into the surrounding ISM. This **[stellar feedback](@entry_id:755431)** is crucial for regulating star formation and driving galactic outflows. Modeling its coupling to the grid-scale gas is one of the greatest challenges in computational galaxy formation. A naive injection of thermal energy often leads to the **overcooling problem**: at the resolution of typical simulations, the injected energy is deposited into a small mass of gas, raising its temperature to the peak of the cooling curve ($\sim 10^5 - 10^6$ K) where the cooling time is extremely short. As a case study, injecting $10^{52}$ ergs from a cluster of supernovae into a $10^5 M_{\odot}$ gas parcel can heat it to $\sim 10^{5.4}$ K, resulting in a cooling time much shorter than the time it takes for the hot gas to expand and do mechanical work (the sound-crossing time). The injected energy is radiated away numerically before it can have a dynamical impact [@problem_id:3505167].

To circumvent this, more sophisticated feedback schemes are used:
*   **Thermal Feedback:** The simplest approach, but highly susceptible to overcooling as described.
*   **Kinetic Feedback:** A fraction of the feedback energy is injected as a directed momentum kick to neighboring gas particles/cells. This momentum is not subject to [radiative cooling](@entry_id:754014) and can drive motions directly.
*   **Mechanical Feedback:** This advanced approach recognizes that a supernova remnant evolves through distinct phases. If the simulation cannot resolve the energy-conserving phase, the model bypasses it by injecting the analytically- or empirically-known *terminal momentum* that the remnant is expected to have in its late, momentum-conserving phase. This makes the feedback effect less sensitive to numerical resolution [@problem_id:3505167].

### Numerical Methods: Discretizing the Equations

To solve the governing equations, they must be discretized onto a computational domain. The methods for the collisionless and collisional components are fundamentally different.

#### Collisionless Dynamics: N-body Methods

The CBE is typically solved using an **N-body method**, which samples the continuous [phase-space distribution](@entry_id:151304) $f$ with a large number $N$ of discrete "macro-particles". Each particle represents a collection of stars or dark matter particles and its trajectory is integrated under the influence of the collective gravitational field. To avoid large, unphysical accelerations from close encounters between these massive simulation particles (a source of numerical [two-body relaxation](@entry_id:756252)), the gravitational force is **softened** on a small length scale $\epsilon$ [@problem_id:3505149].

#### Gas Dynamics: Hydrodynamic Solvers

The Euler equations are solved using [hydrodynamics](@entry_id:158871) codes, which fall into two main families: Lagrangian and Eulerian.

*   **Smoothed Particle Hydrodynamics (SPH):** An SPH code is Lagrangian, representing the fluid with a set of particles that move with the flow. Hydrodynamic forces (like pressure gradients) are computed by smoothing properties over neighboring particles using a [kernel function](@entry_id:145324). SPH methods are manifestly conservative and, being Galilean-invariant, are well-suited for following bulk flows. However, standard SPH has difficulty capturing certain fluid instabilities and suffers from artificial suppression of mixing across [contact discontinuities](@entry_id:747781). This can lead to metals remaining "stuck" to the particles they were injected near, reducing numerical metal mixing [@problem_id:3505149].

*   **Mesh-based Godunov-type Schemes:** These Eulerian methods discretize space into a grid (which can be fixed, moving, or adaptive) and solve the conservation laws in their finite-volume form. The key to these methods is the computation of fluxes between adjacent grid cells. At each interface, a **Riemann problem** is solved—the initial value problem with piecewise constant states on either side. The solution to the Riemann problem describes the waves (shocks, rarefactions, [contact discontinuities](@entry_id:747781)) that emerge, and from this solution, the flux across the interface is determined [@problem_id:3505218]. To avoid the computational cost of solving the exact Riemann problem, **approximate Riemann solvers** (like HLL or HLLC) are used. This shock-capturing approach is robust and provides a natural mechanism for numerical mixing via the averaging inherent in the Riemann solution, which can be both a benefit (more realistic diffusion) and a drawback (loss of sharp features) [@problem_id:3505149].

The transport of passive scalars like metallicity must be handled consistently. The scalar flux is coupled to the mass flux determined by the Riemann solver at the interface. This ensures that metals are advected correctly with the [mass flow](@entry_id:143424) [@problem_id:3505218].

#### Angular Momentum Transport

The mechanisms of [angular momentum transport](@entry_id:160167) also differ. In the collisionless stellar component, transport is driven by non-axisymmetric gravitational torques from structures like bars and [spiral arms](@entry_id:160156). In the gaseous component, transport occurs via physical stresses, such as those in shocks, or numerical artifacts like artificial viscosity. Poorly tuned artificial viscosity in SPH, for example, can act like a spurious [shear viscosity](@entry_id:141046) and cause an unphysical drain of angular momentum from rotating disks [@problem_id:3505149].

### Simulation Fidelity: Resolution and Convergence

Interpreting the results of [chemo-dynamical simulations](@entry_id:747327) requires an understanding of their inherent limitations, particularly resolution and convergence.

**Resolution** is defined on three axes [@problem_id:3505203]:
*   **Spatial Resolution:** The smallest hydrodynamic length scale resolved, given by the [cell size](@entry_id:139079) $\Delta x$ in mesh codes or the smoothing length $h$ in SPH.
*   **Mass Resolution:** The mass of the smallest discrete element, such as an SPH particle or dark matter particle. This determines the smallest physical structures (e.g., star clusters, dwarf galaxies) that can be reliably modeled.
*   **Temporal Resolution:** The integration time-step $\Delta t$, which is dynamically chosen to be smaller than all relevant physical and numerical timescales. This is constrained by the Courant-Friedrichs-Lewy (CFL) condition for fluid dynamics and often more stringently by the very short timescales of cooling or chemical reactions.

Because simulations rely on [subgrid models](@entry_id:755601), the traditional concept of numerical convergence is nuanced. One distinguishes between [@problem_id:3505203]:
*   **Strong Convergence:** Macroscopic predictions of the simulation (e.g., the galaxy's total [star formation](@entry_id:160356) rate) approach a stable result as resolution is increased, *without* re-tuning the parameters of the [subgrid models](@entry_id:755601). This is the ideal but is rarely achieved in practice.
*   **Weak Convergence:** One is permitted to adjust subgrid model parameters at each resolution level to ensure that the macroscopic predictions remain consistent or continue to match observational constraints. This acknowledges that [subgrid models](@entry_id:755601) are "effective" theories whose parameterizations are inherently tied to the scale they are meant to represent.

Understanding these principles is the first step toward critically assessing the results of modern galaxy simulations and appreciating both their profound explanatory power and their inherent limitations.