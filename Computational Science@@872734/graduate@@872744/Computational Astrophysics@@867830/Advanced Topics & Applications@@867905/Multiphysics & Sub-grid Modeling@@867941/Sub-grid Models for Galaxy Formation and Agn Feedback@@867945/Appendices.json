{"hands_on_practices": [{"introduction": "A central challenge in modeling galaxy formation is capturing how radiation from an Active Galactic Nucleus (AGN) drives powerful outflows. This practice explores the physics behind \"momentum-driven\" winds, a key sub-grid feedback mechanism. By equating the momentum flux from the AGN's radiation field—critically including the momentum boost factor $(1 + \\tau_{\\mathrm{IR}})$ from multiple photon scatterings in optically thick gas—to the momentum flux of the outflowing material, you will derive the wind's terminal velocity from first principles [@problem_id:3537605]. This exercise provides a tangible link between the observable luminosity of an AGN and the kinetic power of the feedback it imparts on its host galaxy.", "problem": "In a sub-grid radiation pressure feedback model for galaxy formation and Active Galactic Nucleus (AGN) feedback, dusty gas reprocesses ultraviolet into infrared radiation, leading to a momentum boost proportional to the infrared optical depth. Assume that radiation of bolometric luminosity $L$ imparts momentum to the gas at a rate characterized by an effective momentum flux due to multiple scatterings in the infrared with optical depth $\\tau_{\\mathrm{IR}}$. The mass outflow rate is linked to the star-forming reservoir via the mass-loading factor $\\eta$ through $\\dot{M}_{\\mathrm{out}} = \\eta \\,\\dot{M}_{\\star}$, where $\\dot{M}_{\\star}$ is the Star Formation Rate (SFR). In the steady, momentum-driven limit with negligible gravity at the launch scale and isotropic coupling, the terminal velocity $v_{\\infty}$ of the wind can be estimated by equating the radiation-driven momentum flux to the wind momentum flux.\n\nStarting from fundamental radiative momentum transfer and conservation of momentum, compute the radiation-driven momentum flux and estimate the wind terminal velocity under the following conditions: $\\tau_{\\mathrm{IR}} = 5$, $L = 10^{46}\\,\\mathrm{erg\\,s^{-1}}$, $\\eta = 1$, and $\\dot{M}_{\\star} = 50\\,M_{\\odot}\\,\\mathrm{yr^{-1}}$. Use the speed of light $c = 2.99792458 \\times 10^{10}\\,\\mathrm{cm\\,s^{-1}}$, solar mass $M_{\\odot} = 1.98847 \\times 10^{33}\\,\\mathrm{g}$, and $1\\,\\mathrm{yr} = 3.15576 \\times 10^{7}\\,\\mathrm{s}$. Round your answer to $4$ significant figures. Express the momentum flux in dyne and the terminal velocity in $\\mathrm{km\\,s^{-1}}$. The solution must justify the formulae used from first principles, without invoking empirical fitting functions or unresolved parameterizations beyond the stated assumptions.", "solution": "The problem asks for the calculation of the radiation momentum flux and the resulting wind terminal velocity based on a momentum-driven wind model.\n\n**1. Radiation-Driven Momentum Flux**\n\nThe momentum flux from a source of luminosity $L$ is fundamentally $\\dot{p}_{\\gamma} = L/c$. In an optically thick medium, infrared photons re-radiated by dust can be scattered multiple times, boosting the momentum transfer. The problem states this boost is proportional to the infrared optical depth $\\tau_{\\mathrm{IR}}$. The total momentum flux imparted to the gas, $\\dot{p}_{\\mathrm{rad}}$, is therefore the sum of the momentum from initial absorption (the \"single-scattering\" limit) and the momentum from subsequent multiple scatterings of re-radiated photons. This is given by the formula:\n$$\n\\dot{p}_{\\mathrm{rad}} = (1 + \\tau_{\\mathrm{IR}}) \\frac{L}{c}\n$$\nThis formula is derived from first principles of radiative transfer in the optically thick limit.\nGiven:\n- $L = 10^{46}\\,\\mathrm{erg\\,s^{-1}}$\n- $\\tau_{\\mathrm{IR}} = 5$\n- $c = 2.99792458 \\times 10^{10}\\,\\mathrm{cm\\,s^{-1}}$\n\nSubstituting the values:\n$$\n\\dot{p}_{\\mathrm{rad}} = (1 + 5) \\frac{10^{46}\\,\\mathrm{erg\\,s^{-1}}}{2.99792458 \\times 10^{10}\\,\\mathrm{cm\\,s^{-1}}} = \\frac{6 \\times 10^{46}}{2.99792458 \\times 10^{10}}\\,\\mathrm{erg\\,cm^{-1}}\n$$\nThe unit $\\mathrm{erg\\,cm^{-1}}$ is equivalent to a dyne ($\\mathrm{g\\,cm\\,s^{-2}}$).\n$$\n\\dot{p}_{\\mathrm{rad}} \\approx 2.0013856 \\times 10^{36}\\,\\mathrm{dyne}\n$$\nRounding to 4 significant figures, the momentum flux is $2.001 \\times 10^{36}\\,\\mathrm{dyne}$.\n\n**2. Wind Terminal Velocity**\n\nIn a steady, momentum-driven wind, the momentum flux of the radiation is balanced by the momentum flux of the outflowing gas. The wind's momentum flux, $\\dot{p}_{\\mathrm{wind}}$, is the product of its mass outflow rate $\\dot{M}_{\\mathrm{out}}$ and its terminal velocity $v_{\\infty}$:\n$$\n\\dot{p}_{\\mathrm{wind}} = \\dot{M}_{\\mathrm{out}} v_{\\infty}\n$$\nEquating the fluxes gives:\n$$\n\\dot{p}_{\\mathrm{rad}} = \\dot{M}_{\\mathrm{out}} v_{\\infty}\n$$\nWe can solve for the terminal velocity:\n$$\nv_{\\infty} = \\frac{\\dot{p}_{\\mathrm{rad}}}{\\dot{M}_{\\mathrm{out}}}\n$$\nThe mass outflow rate is given by $\\dot{M}_{\\mathrm{out}} = \\eta \\dot{M}_{\\star}$. We need to convert $\\dot{M}_{\\star}$ to CGS units ($\\mathrm{g\\,s^{-1}}$).\nGiven:\n- $\\eta = 1$\n- $\\dot{M}_{\\star} = 50\\,M_{\\odot}\\,\\mathrm{yr^{-1}}$\n- $M_{\\odot} = 1.98847 \\times 10^{33}\\,\\mathrm{g}$\n- $1\\,\\mathrm{yr} = 3.15576 \\times 10^{7}\\,\\mathrm{s}$\n\nFirst, calculate $\\dot{M}_{\\mathrm{out}}$:\n$$\n\\dot{M}_{\\mathrm{out}} = 1 \\times 50 \\frac{M_{\\odot}}{\\mathrm{yr}} = 50 \\times \\frac{1.98847 \\times 10^{33}\\,\\mathrm{g}}{3.15576 \\times 10^{7}\\,\\mathrm{s}} \\approx 3.150495 \\times 10^{27}\\,\\mathrm{g\\,s^{-1}}\n$$\nNow, calculate $v_{\\infty}$:\n$$\nv_{\\infty} = \\frac{2.0013856 \\times 10^{36}\\,\\mathrm{g\\,cm\\,s^{-2}}}{3.150495 \\times 10^{27}\\,\\mathrm{g\\,s^{-1}}} \\approx 6.35260 \\times 10^{8}\\,\\mathrm{cm\\,s^{-1}}\n$$\nThe problem requires the velocity in $\\mathrm{km\\,s^{-1}}$. Using the conversion $1\\,\\mathrm{km} = 10^5\\,\\mathrm{cm}$:\n$$\nv_{\\infty} \\approx \\frac{6.35260 \\times 10^{8}\\,\\mathrm{cm\\,s^{-1}}}{10^{5}\\,\\mathrm{cm\\,km^{-1}}} \\approx 6352.60\\,\\mathrm{km\\,s^{-1}}\n$$\nRounding to 4 significant figures gives $6353\\,\\mathrm{km\\,s^{-1}}$.", "answer": "$$\n\\boxed{\\begin{pmatrix} 2.001 \\times 10^{36} & 6.353 \\times 10^{3} \\end{pmatrix}}\n$$", "id": "3537605"}, {"introduction": "Once feedback energy and momentum are injected, their impact depends on how they are transported throughout the galaxy. This exercise focuses on the transport of cosmic rays (CRs), a key non-thermal product of feedback processes. You will analyze the fundamental diffusion-advection equation to understand the competition between two primary transport mechanisms: advection, where CRs are carried along with the bulk gas flow, and diffusion, where they scatter off magnetic irregularities [@problem_id:3537587]. By deriving and evaluating the dimensionless Péclet number, you will learn to assess which process dominates, a crucial step in predicting the spatial distribution and ultimate effects of feedback.", "problem": "In a large-eddy galaxy formation simulation with sub-grid transport of cosmic rays (CRs) and feedback from an Active Galactic Nucleus (AGN), assume an isotropic CR diffusion coefficient $\\,\\kappa\\,$ and a characteristic CR gradient length scale $\\,L\\,$ that is resolved on the grid. A steady galactic wind of speed $\\,v\\,$ advects the CRs. Starting from the standard diffusion-advection form of the CR transport equation and using dimensional analysis of the diffusion and advection operators to define characteristic timescales, derive the dimensionless ratio $\\,R\\,$ of the diffusion timescale to the advection timescale across the length scale $\\,L\\,$. Then evaluate $\\,R\\,$ for $\\,\\kappa = 3 \\times 10^{28}\\,\\mathrm{cm^{2}\\,s^{-1}}$, $\\,L = 1\\,\\mathrm{kpc}$, and $\\,v = 300\\,\\mathrm{km\\,s^{-1}}$. Use the centimeter-gram-second system (cgs) with $\\,1\\,\\mathrm{kpc} = 3.085677581 \\times 10^{21}\\,\\mathrm{cm}\\,$ and $\\,1\\,\\mathrm{km\\,s^{-1}} = 10^{5}\\,\\mathrm{cm\\,s^{-1}}$. Report the single numerical value of $\\,R\\,$ (unitless). Round your answer to four significant figures.", "solution": "The problem statement is evaluated to be valid. It is scientifically grounded in the established physics of cosmic ray transport, well-posed with sufficient information for a unique solution, and expressed in objective, precise language. All provided data and conditions are consistent and physically plausible within the context of computational astrophysics.\n\nThe task is to derive the dimensionless ratio, $R$, of the diffusion timescale to the advection timescale for cosmic rays (CRs) in a galactic wind, and then to evaluate this ratio numerically.\n\nWe begin with the standard diffusion-advection equation for the transport of CR energy density, denoted as $e_{cr}$. In the absence of source and sink terms, the equation is:\n$$\n\\frac{\\partial e_{cr}}{\\partial t} + \\nabla \\cdot \\mathbf{F}_{cr} = 0\n$$\nwhere $\\mathbf{F}_{cr}$ is the CR flux. The flux consists of an advective component due to the bulk motion of the gas (the galactic wind) and a diffusive component due to CRs scattering off magnetic irregularities. The expression for the flux is:\n$$\n\\mathbf{F}_{cr} = \\mathbf{v} e_{cr} - \\kappa \\nabla e_{cr}\n$$\nHere, $\\mathbf{v}$ is the wind velocity and $\\kappa$ is the isotropic CR diffusion coefficient. Substituting the flux into the transport equation gives:\n$$\n\\frac{\\partial e_{cr}}{\\partial t} = -\\nabla \\cdot (\\mathbf{v} e_{cr}) + \\nabla \\cdot (\\kappa \\nabla e_{cr})\n$$\nThe first term on the right-hand side represents advection, and the second term represents diffusion. We can determine the characteristic timescale for each process through dimensional analysis. Let $L$ be the characteristic length scale over which the CR energy density $e_{cr}$ varies significantly.\n\nThe advection term is $\\mathcal{A} = -\\nabla \\cdot (\\mathbf{v} e_{cr})$. Assuming a constant wind velocity $\\mathbf{v}$ of magnitude $v$, its magnitude can be estimated as:\n$$\n|\\mathcal{A}| \\sim v |\\nabla e_{cr}| \\sim v \\frac{e_{cr}}{L}\n$$\nThe advection process modifies the CR energy density on a timescale $\\tau_{adv}$ such that the rate of change is approximately $\\frac{e_{cr}}{\\tau_{adv}}$. Equating this to the magnitude of the advection operator gives:\n$$\n\\frac{e_{cr}}{\\tau_{adv}} \\sim v \\frac{e_{cr}}{L} \\implies \\tau_{adv} \\sim \\frac{L}{v}\n$$\nThis is the time it takes for the wind to transport CRs across the length scale $L$.\n\nThe diffusion term is $\\mathcal{D} = \\nabla \\cdot (\\kappa \\nabla e_{cr})$. Assuming a constant diffusion coefficient $\\kappa$, its magnitude can be estimated as:\n$$\n|\\mathcal{D}| \\sim \\kappa |\\nabla^2 e_{cr}| \\sim \\kappa \\frac{e_{cr}}{L^2}\n$$\nThe diffusion process modifies the CR energy density on a timescale $\\tau_{diff}$ such that the rate of change is approximately $\\frac{e_{cr}}{\\tau_{diff}}$. Equating this to the magnitude of the diffusion operator gives:\n$$\n\\frac{e_{cr}}{\\tau_{diff}} \\sim \\kappa \\frac{e_{cr}}{L^2} \\implies \\tau_{diff} \\sim \\frac{L^2}{\\kappa}\n$$\nThis is the characteristic time for CRs to diffuse across the length scale $L$.\n\nThe problem asks for the dimensionless ratio $R$ of the diffusion timescale to the advection timescale.\n$$\nR = \\frac{\\tau_{diff}}{\\tau_{adv}}\n$$\nSubstituting the derived expressions for the timescales:\n$$\nR = \\frac{L^2 / \\kappa}{L / v} = \\frac{L^2}{\\kappa} \\frac{v}{L} = \\frac{vL}{\\kappa}\n$$\nThis ratio is also known as the Péclet number, which compares the relative importance of advective and diffusive transport.\n\nNext, we evaluate $R$ using the provided numerical values. We must first convert all quantities to the centimeter-gram-second (cgs) system of units.\nThe given values are:\n$\\kappa = 3 \\times 10^{28}\\,\\mathrm{cm^{2}\\,s^{-1}}$\n$L = 1\\,\\mathrm{kpc}$\n$v = 300\\,\\mathrm{km\\,s^{-1}}$\n\nThe conversion factors are:\n$1\\,\\mathrm{kpc} = 3.085677581 \\times 10^{21}\\,\\mathrm{cm}$\n$1\\,\\mathrm{km\\,s^{-1}} = 10^{5}\\,\\mathrm{cm\\,s^{-1}}$\n\nConverting the length scale $L$:\n$$\nL = 1\\,\\mathrm{kpc} \\times \\frac{3.085677581 \\times 10^{21}\\,\\mathrm{cm}}{1\\,\\mathrm{kpc}} = 3.085677581 \\times 10^{21}\\,\\mathrm{cm}\n$$\nConverting the wind speed $v$:\n$$\nv = 300\\,\\mathrm{km\\,s^{-1}} \\times \\frac{10^{5}\\,\\mathrm{cm\\,s^{-1}}}{1\\,\\mathrm{km\\,s^{-1}}} = 3 \\times 10^2 \\times 10^5\\,\\mathrm{cm\\,s^{-1}} = 3 \\times 10^7\\,\\mathrm{cm\\,s^{-1}}\n$$\nNow, we substitute these cgs values into the expression for $R$:\n$$\nR = \\frac{vL}{\\kappa} = \\frac{(3 \\times 10^7\\,\\mathrm{cm\\,s^{-1}}) \\times (3.085677581 \\times 10^{21}\\,\\mathrm{cm})}{3 \\times 10^{28}\\,\\mathrm{cm^{2}\\,s^{-1}}}\n$$\nThe units cancel out as expected: $(\\mathrm{cm\\,s^{-1}} \\cdot \\mathrm{cm}) / (\\mathrm{cm^{2}\\,s^{-1}}) = 1$.\n$$\nR = \\frac{3 \\times 3.085677581 \\times 10^{7+21}}{3 \\times 10^{28}} = \\frac{3.085677581 \\times 10^{28}}{10^{28}} = 3.085677581\n$$\nThe problem requires the answer to be rounded to four significant figures. The first five significant figures are $3.0856$. Since the fifth digit ($6$) is greater than or equal to $5$, we round up the fourth digit.\n$$\nR \\approx 3.086\n$$", "answer": "$$\n\\boxed{3.086}\n$$", "id": "3537587"}, {"introduction": "Implementing sub-grid models requires navigating the complex interface between physics and numerical methods. This problem addresses a classic numerical artifact: artificial fragmentation, where unresolved gas clouds collapse due to numerical instability rather than physical gravity. You are tasked with designing and evaluating a sub-grid pressure floor, a common technique to prevent this by enforcing a minimum Jeans length $\\lambda_J$ [@problem_id:3537584]. This practice will guide you through determining the floor's parameters to ensure numerical stability, while also quantifying its unavoidable impact on the modeled black hole accretion rate, highlighting the critical trade-offs inherent in sub-grid modeling.", "problem": "You are asked to design and implement a computational experiment to assess whether a sub-grid pressure floor of the form $P_{\\mathrm{floor}} = K \\,\\rho^{\\gamma_{\\mathrm{eff}}}$ can prevent artificial fragmentation in Active Galactic Nucleus (AGN) influenced galactic cores while not biasing black hole accretion histories. The assessment must be done purely from first principles and well-tested formulas, and your program must decide this for a set of test cases.\n\nBegin from the following fundamental bases:\n- The Jeans instability criterion in a barotropic fluid, where the instantaneous effective sound speed is $c_s^2 = \\mathrm{d}P/\\mathrm{d}\\rho$, and the Jeans length is\n$$\n\\lambda_J = \\sqrt{\\frac{\\pi\\, c_s^2}{G\\,\\rho}}\n$$.\n- The Bondi accretion rate (steady, spherically symmetric) for a black hole of mass $M_{\\mathrm{BH}}$ in gas of density $\\rho$ and sound speed $c_s$ with relative velocity $v$,\n$$\n\\dot{M}_{\\mathrm{Bondi}} \\propto \\frac{\\rho\\, G^2 M_{\\mathrm{BH}}^2}{\\left(c_s^2 + v^2\\right)^{3/2}}\n$$,\nwhich is used only up to a ratio, so all proportionality constants cancel in a comparative analysis.\n\nYou must:\n1. Treat the gas as barotropic under the sub-grid floor with $P_{\\mathrm{floor}} = K\\,\\rho^{\\gamma_{\\mathrm{eff}}}$, so that $c_{s,\\mathrm{eff}}^2 = \\mathrm{d}P_{\\mathrm{floor}}/\\mathrm{d}\\rho$.\n2. Choose the coefficient $K$ such that the Jeans length requirement $\\lambda_J \\ge N_J \\Delta x$ is satisfied for all densities in an AGN core density range $\\rho \\in [\\rho_{\\min}, \\rho_{\\max}]$. To achieve this, identify the most constraining reference density $\\rho_{\\mathrm{ref}}$ in the range based on the monotonicity of $\\lambda_J(\\rho)$ implied by the chosen $\\gamma_{\\mathrm{eff}}$, and enforce $\\lambda_J(\\rho_{\\mathrm{ref}}) = N_J \\Delta x$ to set $K$. You must derive the needed expressions from the above bases; do not assume or import any further closed-form results.\n3. Quantify accretion bias by comparing, at each density, the Bondi accretion rate evaluated with and without the pressure floor. Adopt a thermal baseline with gas temperature $T_0$ and adiabatic index $\\gamma_{\\mathrm{ad}}$, giving a baseline thermal sound speed $c_{s,0}^2 = \\gamma_{\\mathrm{ad}} k_B T_0 / (\\mu m_p)$. With the floor active, use $c_{s,\\mathrm{use}}^2(\\rho) = \\max\\left(c_{s,0}^2,\\; c_{s,\\mathrm{eff}}^2(\\rho)\\right)$. For each density, define the instantaneous ratio\n$$\n\\mathcal{R}(\\rho) \\equiv \\frac{\\dot{M}_{\\mathrm{Bondi, floor}}(\\rho)}{\\dot{M}_{\\mathrm{Bondi, base}}(\\rho)} = \\left(\\frac{c_{s,0}^2 + v^2}{c_{s,\\mathrm{use}}^2(\\rho) + v^2}\\right)^{3/2}.\n$$\nAggregate over the density range using a mass-weighting proportional to $\\rho$ on a fixed log-spaced grid of $N_{\\mathrm{dens}}$ densities between $n_{\\mathrm{H},\\min}$ and $n_{\\mathrm{H},\\max}$, where $\\rho = \\mu m_p n_{\\mathrm{H}}$. Define the mass-weighted mean ratio\n$$\n\\overline{\\mathcal{R}} = \\frac{\\sum_i \\rho_i \\,\\mathcal{R}(\\rho_i)}{\\sum_i \\rho_i}.\n$$\nDeclare the sub-grid floor to be “non-biasing” if $|\\overline{\\mathcal{R}} - 1| \\le \\tau$ for a specified tolerance $\\tau$.\n4. Declare the floor to “prevent artificial fragmentation” if for all densities in the grid the Jeans criterion is satisfied, i.e., $\\lambda_J(\\rho) \\ge N_J \\Delta x$ when evaluated using the floor $P_{\\mathrm{floor}}$ and its implied $c_{s,\\mathrm{eff}}(\\rho)$.\n5. For each test case, output a boolean that is true if and only if both conditions hold: it prevents artificial fragmentation and is non-biasing by the above criterion.\n\nConstants, units, and fixed choices:\n- Use centimeter–gram–second units throughout. Gravitational constant $G$ in $\\mathrm{cm^3\\,g^{-1}\\,s^{-2}}$, Boltzmann constant $k_B$ in $\\mathrm{erg\\,K^{-1}}$, proton mass $m_p$ in $\\mathrm{g}$, Solar mass $M_\\odot$ in $\\mathrm{g}$, and parsec in $\\mathrm{cm}$.\n- Use mean molecular weight $\\mu = 0.62$, adiabatic index $\\gamma_{\\mathrm{ad}} = 5/3$, and baseline temperature $T_0 = 10^{4}\\,\\mathrm{K}$.\n- Use a log-spaced density grid with $N_{\\mathrm{dens}} = 64$ samples from $n_{\\mathrm{H},\\min} = 10^{2}\\,\\mathrm{cm^{-3}}$ to $n_{\\mathrm{H},\\max} = 10^{5}\\,\\mathrm{cm^{-3}}$. Convert to mass density via $\\rho = \\mu m_p n_{\\mathrm{H}}$.\n- Use tolerance $\\tau = 0.25$ (i.e., deviations up to a quarter in the mass-weighted mean ratio are acceptable).\n- The Bondi mass $M_{\\mathrm{BH}}$ is given in Solar masses but cancels out in the ratio; include it in parameters for completeness and scientific realism.\n\nTest suite of parameter sets to evaluate:\n- Case A (happy path): $\\Delta x = 5\\,\\mathrm{pc}$, $N_J = 4$, $\\gamma_{\\mathrm{eff}} = 4/3$, $M_{\\mathrm{BH}} = 10^{8}\\,M_\\odot$, $v = 50\\,\\mathrm{km\\,s^{-1}}$.\n- Case B (bias-prone isothermal floor at coarse resolution): $\\Delta x = 20\\,\\mathrm{pc}$, $N_J = 4$, $\\gamma_{\\mathrm{eff}} = 1.0$, $M_{\\mathrm{BH}} = 10^{8}\\,M_\\odot$, $v = 10\\,\\mathrm{km\\,s^{-1}}$.\n- Case C (stiff floor with low relative velocity): $\\Delta x = 5\\,\\mathrm{pc}$, $N_J = 4$, $\\gamma_{\\mathrm{eff}} = 2.0$, $M_{\\mathrm{BH}} = 10^{8}\\,M_\\odot$, $v = 10\\,\\mathrm{km\\,s^{-1}}$.\n- Case D (stiff floor but high relative velocity): $\\Delta x = 5\\,\\mathrm{pc}$, $N_J = 4$, $\\gamma_{\\mathrm{eff}} = 2.0$, $M_{\\mathrm{BH}} = 10^{8}\\,M_\\odot$, $v = 300\\,\\mathrm{km\\,s^{-1}}$.\n- Case E (fine resolution polytropic floor): $\\Delta x = 0.5\\,\\mathrm{pc}$, $N_J = 4$, $\\gamma_{\\mathrm{eff}} = 4/3$, $M_{\\mathrm{BH}} = 10^{8}\\,M_\\odot$, $v = 10\\,\\mathrm{km\\,s^{-1}}$.\n\nImplementation requirements:\n- For each case, compute the coefficient $K$ by enforcing $\\lambda_J(\\rho_{\\mathrm{ref}}) = N_J \\Delta x$ at the most constraining density $\\rho_{\\mathrm{ref}}$ within $[\\rho_{\\min}, \\rho_{\\max}]$, determined by the sign of $\\mathrm{d}\\ln \\lambda_J / \\mathrm{d}\\ln \\rho$ implied by $\\gamma_{\\mathrm{eff}}$. Then evaluate the two criteria above across the density grid and combine them into the final boolean.\n- Angle units are not applicable.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result_1,result_2,\\dots]$) where each entry is a boolean corresponding to the cases in the order A, B, C, D, E.\n\nAll numerical inputs are given above; ensure all internal calculations use the specified units. The final outputs are booleans and therefore unitless.", "solution": "The problem asks us to design and implement a computational experiment to evaluate a sub-grid pressure floor model, $P_{\\mathrm{floor}} = K \\rho^{\\gamma_{\\mathrm{eff}}}$, for its ability to prevent artificial fragmentation in simulations while not biasing black hole accretion rates. We must develop an algorithm based on first principles to test this for several scenarios. The solution proceeds in several logical steps.\n\n**1. Effective Sound Speed and Jeans Length**\nThe pressure floor is given by a barotropic equation of state, $P_{\\mathrm{floor}} = K \\rho^{\\gamma_{\\mathrm{eff}}}$. The corresponding effective sound speed squared, $c_{s,\\mathrm{eff}}^2$, is the derivative of pressure with respect to density:\n$$\nc_{s,\\mathrm{eff}}^2 = \\frac{\\mathrm{d}P_{\\mathrm{floor}}}{\\mathrm{d}\\rho} = \\frac{\\mathrm{d}}{\\mathrm{d}\\rho}\\left(K \\rho^{\\gamma_{\\mathrm{eff}}}\\right) = K \\gamma_{\\mathrm{eff}} \\rho^{\\gamma_{\\mathrm{eff}}-1}\n$$\nThe Jeans length, $\\lambda_J$, is a critical scale for gravitational instability. Using the effective sound speed from the pressure floor, it is given by:\n$$\n\\lambda_J(\\rho) = \\sqrt{\\frac{\\pi c_{s,\\mathrm{eff}}^2}{G \\rho}} = \\sqrt{\\frac{\\pi (K \\gamma_{\\mathrm{eff}} \\rho^{\\gamma_{\\mathrm{eff}}-1})}{G \\rho}} = \\sqrt{\\frac{\\pi K \\gamma_{\\mathrm{eff}}}{G}} \\rho^{\\frac{\\gamma_{\\mathrm{eff}}-2}{2}}\n$$\nwhere $G$ is the gravitational constant.\n\n**2. Determining the Coefficient $K$**\nThe pressure floor must prevent artificial fragmentation, which is achieved by ensuring that the Jeans length is always resolved by a minimum number of grid cells, $N_J$. This is a form of the Truelove-Bate-Couchman criterion: $\\lambda_J(\\rho) \\ge N_J \\Delta x$ for all densities $\\rho$ in the relevant range $[\\rho_{\\min}, \\rho_{\\max}]$. To ensure this condition holds, we must enforce it at the density $\\rho_{\\mathrm{ref}}$ where $\\lambda_J(\\rho)$ is at its minimum value within the range.\n\nThe monotonicity of $\\lambda_J(\\rho)$ depends on the sign of the exponent of $\\rho$, which is $(\\gamma_{\\mathrm{eff}}-2)/2$.\n- If $\\gamma_{\\mathrm{eff}} < 2$, the exponent is negative, so $\\lambda_J(\\rho)$ is a decreasing function of $\\rho$. The minimum occurs at $\\rho_{\\mathrm{ref}} = \\rho_{\\max}$.\n- If $\\gamma_{\\mathrm{eff}} \\ge 2$, the exponent is non-negative, so $\\lambda_J(\\rho)$ is a non-decreasing function of $\\rho$. The minimum occurs at $\\rho_{\\mathrm{ref}} = \\rho_{\\min}$.\n\nBy setting the Jeans length to the required minimum at this most constraining density, we satisfy the criterion everywhere in the density range.\n$$\n\\lambda_J(\\rho_{\\mathrm{ref}}) = N_J \\Delta x\n$$\nSquaring both sides and substituting the expression for $\\lambda_J(\\rho)$:\n$$\n(N_J \\Delta x)^2 = \\frac{\\pi K \\gamma_{\\mathrm{eff}}}{G} \\rho_{\\mathrm{ref}}^{\\gamma_{\\mathrm{eff}}-2}\n$$\nSolving for the coefficient $K$:\n$$\nK = \\frac{(N_J \\Delta x)^2 G}{\\pi \\gamma_{\\mathrm{eff}}} \\rho_{\\mathrm{ref}}^{2-\\gamma_{\\mathrm{eff}}}\n$$\nThis formula defines the value of $K$ for each test case.\n\n**3. Fragmentation Prevention Condition**\nThe first condition for a successful model is that it prevents artificial fragmentation. As per the problem, this is true if $\\lambda_J(\\rho) \\ge N_J \\Delta x$ for all densities on our test grid. By our construction of $K$, we have set an equality at the minimum of $\\lambda_J(\\rho)$ for the continuous range, so this condition is guaranteed to hold for all $\\rho \\in [\\rho_{\\min}, \\rho_{\\max}]$, and thus for all discrete points within it. The flag for this condition, `prevents_fragmentation`, will be determined by explicitly checking this for all points on the discrete density grid.\n\n**4. Accretion Bias Condition**\nThe second condition is that the floor does not unduly bias the black hole accretion rate, modeled by the Bondi rate, $\\dot{M}_{\\mathrm{Bondi}}$. We compare the rate with the floor to a baseline thermal case.\n\nThe baseline case assumes a gas with a constant temperature $T_0$ and adiabatic index $\\gamma_{\\mathrm{ad}}$. The baseline sound speed squared is:\n$$\nc_{s,0}^2 = \\frac{\\gamma_{\\mathrm{ad}} k_B T_0}{\\mu m_p}\n$$\nwhere $k_B$ is the Boltzmann constant, $\\mu$ is the mean molecular weight, and $m_p$ is the proton mass.\n\nWhen the pressure floor model is active, the sound speed used in a simulation would be the maximum of the baseline thermal sound speed and the floor's effective sound speed:\n$$\nc_{s,\\mathrm{use}}^2(\\rho) = \\max\\left(c_{s,0}^2, c_{s,\\mathrm{eff}}^2(\\rho)\\right)\n$$\nThe Bondi accretion rate is proportional to $(c_s^2 + v^2)^{-3/2}$, where $v$ is the relative velocity between the black hole and the gas. The accretion bias is quantified by the ratio $\\mathcal{R}(\\rho)$:\n$$\n\\mathcal{R}(\\rho) = \\frac{\\dot{M}_{\\mathrm{Bondi, floor}}}{\\dot{M}_{\\mathrm{Bondi, base}}} = \\frac{\\left(c_{s,\\mathrm{use}}^2(\\rho) + v^2\\right)^{-3/2}}{\\left(c_{s,0}^2 + v^2\\right)^{-3/2}} = \\left(\\frac{c_{s,0}^2 + v^2}{c_{s,\\mathrm{use}}^2(\\rho) + v^2}\\right)^{3/2}\n$$\nNote that all other terms in the Bondi formula ($\\rho$, $G$, $M_{\\mathrm{BH}}$) cancel out.\n\nTo get a single metric for the bias, we compute a mass-weighted average of $\\mathcal{R}(\\rho)$ over a logarithmic grid of $N_{\\mathrm{dens}}$ gas number densities, $n_{\\mathrm{H},i}$, from $n_{\\mathrm{H},\\min}$ to $n_{\\mathrm{H},\\max}$. The mass density is $\\rho_i = \\mu m_p n_{\\mathrm{H},i}$.\n$$\n\\overline{\\mathcal{R}} = \\frac{\\sum_{i=1}^{N_{\\mathrm{dens}}} \\rho_i \\mathcal{R}(\\rho_i)}{\\sum_{i=1}^{N_{\\mathrm{dens}}} \\rho_i}\n$$\nThe floor is considered \"non-biasing\" if the average ratio is close to unity, specifically if $|\\overline{\\mathcal{R}} - 1| \\le \\tau$, where $\\tau$ is a given tolerance.\n\n**5. Algorithm Summary**\nFor each test case $(\\Delta x, N_J, \\gamma_{\\mathrm{eff}}, M_{\\mathrm{BH}}, v)$:\n1. Define constants and convert all inputs to a consistent CGS unit system.\n2. Create a logarithmically spaced grid of $N_{\\mathrm{dens}}$ number densities $n_{\\mathrm{H},i}$ from $n_{\\mathrm{H},\\min}$ to $n_{\\mathrm{H},\\max}$, and convert to a mass density grid $\\rho_i$.\n3. Determine the reference density $\\rho_{\\mathrm{ref}}$ by comparing $\\gamma_{\\mathrm{eff}}$ to $2$. If $\\gamma_{\\mathrm{eff}} < 2$, $\\rho_{\\mathrm{ref}} = \\rho_{\\max}$; otherwise, $\\rho_{\\mathrm{ref}} = \\rho_{\\min}$.\n4. Calculate the coefficient $K$ using $\\rho_{\\mathrm{ref}}$ and the test case parameters.\n5. Calculate $c_{s,\\mathrm{eff}}^2(\\rho_i)$ for each density on the grid.\n6. Verify the fragmentation condition: check if $\\sqrt{\\pi c_{s,\\mathrm{eff}}^2(\\rho_i) / (G \\rho_i)} \\ge N_J \\Delta x$ for all $i$.\n7. Calculate the baseline sound speed squared, $c_{s,0}^2$.\n8. Calculate $c_{s,\\mathrm{use}}^2(\\rho_i) = \\max(c_{s,0}^2, c_{s,\\mathrm{eff}}^2(\\rho_i))$ for all $i$.\n9. Calculate $\\mathcal{R}(\\rho_i)$ for all $i$.\n10. Compute the mass-weighted average $\\overline{\\mathcal{R}}$.\n11. Verify the non-biasing condition: check if $|\\overline{\\mathcal{R}} - 1| \\le \\tau$.\n12. The final result for the test case is the logical AND of the fragmentation prevention and non-biasing boolean outcomes.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of evaluating a sub-grid pressure floor for AGN simulations.\n    This function sets up constants and test cases, then iterates through them,\n    calling a helper function to evaluate each case. Finally, it prints the\n    results in the specified format.\n    \"\"\"\n\n    # --- Constants in CGS units ---\n    G_CGS = 6.67430e-8    # cm^3 g^-1 s^-2\n    KB_CGS = 1.380649e-16   # erg K^-1 (g cm^2 s^-2 K^-1)\n    MP_CGS = 1.6726219e-24  # g\n    M_SUN_CGS = 1.98847e33    # g\n    PC_CGS = 3.08567758e18  # cm\n    KMS_TO_CMS = 1e5        # Factor to convert km/s to cm/s\n\n    # --- Fixed problem parameters ---\n    MU = 0.62               # Mean molecular weight\n    GAMMA_AD = 5.0 / 3.0    # Adiabatic index\n    T0 = 1e4                # K, Baseline gas temperature\n    N_DENS = 64             # Number of density samples\n    N_H_MIN = 1e2           # cm^-3, Min number density\n    N_H_MAX = 1e5           # cm^-3, Max number density\n    TAU = 0.25              # Tolerance for accretion bias\n\n    # --- Test suite of parameter sets ---\n    # (delta_x_pc, N_J, gamma_eff, M_BH_Msun, v_kms)\n    test_cases = [\n        (5.0, 4, 4.0/3.0, 1e8, 50.0),   # Case A\n        (20.0, 4, 1.0, 1e8, 10.0),    # Case B\n        (5.0, 4, 2.0, 1e8, 10.0),     # Case C\n        (5.0, 4, 2.0, 1e8, 300.0),    # Case D\n        (0.5, 4, 4.0/3.0, 1e8, 10.0),   # Case E\n    ]\n    \n    # --- Density grid setup ---\n    # Create a logarithmically spaced grid of number densities\n    n_h_grid = np.geomspace(N_H_MIN, N_H_MAX, N_DENS)\n    # Convert to mass density grid\n    rho_grid = MU * MP_CGS * n_h_grid\n    rho_min = rho_grid[0]\n    rho_max = rho_grid[-1]\n\n    # --- Baseline sound speed ---\n    cs0_sq = (GAMMA_AD * KB_CGS * T0) / (MU * MP_CGS)\n\n    results = []\n    for case in test_cases:\n        delta_x_pc, N_J, gamma_eff, M_BH_Msun, v_kms = case\n\n        # --- Unit conversions ---\n        delta_x = delta_x_pc * PC_CGS\n        v = v_kms * KMS_TO_CMS\n        \n        # --- Step 1: Determine K ---\n        # Determine the reference density rho_ref where Jeans length is minimal\n        if gamma_eff  2.0:\n            rho_ref = rho_max\n        else: # gamma_eff >= 2.0\n            rho_ref = rho_min\n        \n        # Calculate the pressure floor coefficient K\n        # K = ( (N_J*dx)^2 * G / (pi*gamma_eff) ) * rho_ref^(2-gamma_eff)\n        K_coeff = ((N_J * delta_x)**2 * G_CGS) / (np.pi * gamma_eff)\n        K_coeff *= rho_ref**(2.0 - gamma_eff)\n\n        # --- Step 2: Evaluate fragmentation prevention condition ---\n        # c_s,eff^2 = K * gamma_eff * rho^(gamma_eff-1)\n        cs_eff_sq_grid = K_coeff * gamma_eff * rho_grid**(gamma_eff - 1.0)\n        \n        # lambda_J = sqrt(pi * c_s,eff^2 / (G * rho))\n        lambda_J_sq_grid = (np.pi * cs_eff_sq_grid) / (G_CGS * rho_grid)\n        lambda_J_grid = np.sqrt(lambda_J_sq_grid)\n\n        # Check if Jeans length is resolved at all densities in the grid.\n        # Use a small tolerance for floating point comparisons.\n        prevents_fragmentation = np.all(lambda_J_grid >= N_J * delta_x * (1.0 - 1e-9))\n\n        # --- Step 3: Evaluate accretion bias condition ---\n        # c_s,use^2 = max(c_s,0^2, c_s,eff^2)\n        cs_use_sq_grid = np.maximum(cs0_sq, cs_eff_sq_grid)\n\n        # R(rho) = ( (cs0^2 + v^2) / (cs_use^2 + v^2) )^(3/2)\n        numerator = cs0_sq + v**2\n        denominator = cs_use_sq_grid + v**2\n        R_grid = (numerator / denominator)**(1.5)\n\n        # Calculate mass-weighted mean of R\n        # np.average with weights=rho_grid does sum(R*rho)/sum(rho)\n        R_bar = np.average(R_grid, weights=rho_grid)\n\n        # Check if the bias is within tolerance\n        is_non_biasing = np.abs(R_bar - 1.0) = TAU\n\n        # --- Step 4: Final verdict for the case ---\n        # The model is valid if it prevents fragmentation AND is non-biasing.\n        final_verdict = prevents_fragmentation and is_non_biasing\n        results.append(final_verdict)\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(lambda b: str(b).capitalize(), results))}]\")\n\nsolve()\n\n```", "id": "3537584"}]}