{"hands_on_practices": [{"introduction": "To a first approximation, gas in an accretion disk follows Keplerian orbits, where gravitational force is balanced solely by centripetal acceleration. However, a more detailed model must account for the disk's internal pressure. This practice explores how a radial pressure gradient provides an additional source of support against gravity, causing the gas to orbit at a slightly sub-Keplerian speed. By calculating this deviation, you will gain a practical understanding of the force balance that governs disk dynamics and how to quantify the departure from the idealized Keplerian case.", "problem": "You are tasked with writing a complete, runnable program that models the azimuthal velocity profile of a thin, axisymmetric gas disk orbiting a central point mass in a Newtonian gravitational potential, including the effect of a radial gas pressure gradient. The goal is to compute the pressure gradient from a specified radial temperature profile $T(R)$ and surface density profile $\\Sigma(R)$, determine the resulting azimuthal speed $v_{\\phi}(R)$, and compare it to the Keplerian speed. All physics must be expressed and computed in the International System of Units (SI), and all answers must be unitless floats as specified below.\n\nStarting point and assumptions:\n- The gravitational potential of a point mass $M$ is $\\Phi(R) = - G M / R$, where $G$ is the gravitational constant and $R$ is the cylindrical radius.\n- Assume a steady, axisymmetric, geometrically thin disk with negligible radial velocity and negligible self-gravity.\n- Use the radial component of the Euler equation for circular motion under a Newtonian potential and include the radial pressure gradient term.\n- Use an isothermal vertical structure at each radius so that $P = \\rho c_{s}^{2}$, where $P$ is thermal pressure, $\\rho$ is density, and $c_{s}$ is the isothermal sound speed. Adopt $c_{s}^{2}(R) = k_{\\mathrm{B}} T(R) / (\\mu m_{p})$, where $k_{\\mathrm{B}}$ is the Boltzmann constant, $m_{p}$ is the proton mass, and $\\mu$ is the mean molecular weight.\n- Use the vertically integrated pressure $\\Pi(R) \\equiv \\int_{-\\infty}^{+\\infty} P \\, dz$ and the surface density $\\Sigma(R) \\equiv \\int_{-\\infty}^{+\\infty} \\rho \\, dz$, and assume vertical isothermality so that $\\Pi(R) = \\Sigma(R) c_{s}^{2}(R)$.\n- Define the Keplerian speed as $v_{K}(R) = \\sqrt{G M / R}$.\n\nRequired derivations and computations:\n1. Starting from the above fundamental relations, derive the expression that determines $v_{\\phi}(R)$ in terms of $M$, $\\Sigma(R)$, and the radial gradient of the vertically integrated pressure $\\Pi(R)$ under a Newtonian potential.\n2. Implement a numerical method to compute the radial derivative $d\\Pi/dR$ from $\\Pi(R)$ using a second-order accurate finite-difference scheme in the interior and a one-sided first-order scheme at the boundaries.\n3. Compute $v_{\\phi}(R)$ and compare to $v_{K}(R)$ by evaluating the absolute fractional deviation $\\delta(R) \\equiv \\lvert v_{\\phi}(R)/v_{K}(R) - 1 \\rvert$.\n4. For each test case specified below, return the maximum value of $\\delta(R)$ over the provided radial grid as a single float.\n\nPhysical constants and units to be used:\n- Use $G = 6.67430 \\times 10^{-11} \\ \\mathrm{m^{3} \\ kg^{-1} \\ s^{-2}}$.\n- Use $M_{\\odot} = 1.98847 \\times 10^{30} \\ \\mathrm{kg}$.\n- Use $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23} \\ \\mathrm{J \\ K^{-1}}$.\n- Use $m_{p} = 1.67262192369 \\times 10^{-27} \\ \\mathrm{kg}$.\n- Use $\\mu = 2.34$ (dimensionless).\n- Use $1$ Astronomical Unit as $1 \\ \\mathrm{AU} = 1.495978707 \\times 10^{11} \\ \\mathrm{m}$.\n- All radial distances $R$ must be in $\\mathrm{m}$, temperatures in $\\mathrm{K}$, surface densities $\\Sigma$ in $\\mathrm{kg \\ m^{-2}}$, speeds in $\\mathrm{m \\ s^{-1}}$, and the final reported deviations must be unitless floats.\n\nProfiles to be used:\n- Temperature: $T(R) = T_{0} \\left( R / R_{0} \\right)^{-q}$.\n- Surface density: $\\Sigma(R) = \\Sigma_{0} \\left( R / R_{0} \\right)^{-p} \\times \\exp\\left( - R / R_{c} \\right)$ if a taper radius $R_{c}$ is provided; otherwise the exponential factor is omitted.\n\nNumerical differentiation requirement:\n- For a radius grid $\\{ R_{i} \\}_{i=0}^{N-1}$ with uniform spacing $\\Delta R$, approximate $d\\Pi/dR$ using\n  - Interior points $i \\in \\{1,2,\\dots,N-2\\}$: $ \\left( d\\Pi/dR \\right)_{i} \\approx \\left( \\Pi_{i+1} - \\Pi_{i-1} \\right) / \\left( 2 \\Delta R \\right)$.\n  - Boundaries: $ \\left( d\\Pi/dR \\right)_{0} \\approx \\left( \\Pi_{1} - \\Pi_{0} \\right) / \\Delta R$ and $ \\left( d\\Pi/dR \\right)_{N-1} \\approx \\left( \\Pi_{N-1} - \\Pi_{N-2} \\right) / \\Delta R$.\n\nTest suite:\nFor each of the following test cases, construct the radius grid $\\{R_{i}\\}$ as a linearly spaced array between the stated bounds (inclusive) with the stated number of points, compute $\\delta(R)$, and return the maximum over the grid. In all cases, set $M = M_{\\star} \\equiv 1 \\ M_{\\odot}$ and $\\mu = 2.34$.\n\n- Test case $1$ (happy path, power laws without taper):\n  - $R \\in [0.1 \\ \\mathrm{AU}, \\ 100 \\ \\mathrm{AU}]$, number of points $N = 256$.\n  - $T_{0} = 280 \\ \\mathrm{K}$ at $R_{0} = 1 \\ \\mathrm{AU}$, exponent $q = 0.5$.\n  - $\\Sigma_{0} = 17000 \\ \\mathrm{kg \\ m^{-2}}$ at $R_{0} = 1 \\ \\mathrm{AU}$, exponent $p = 1.0$.\n  - No exponential taper (omit the exponential factor).\n- Test case $2$ (boundary case, constant profiles):\n  - $R \\in [1 \\ \\mathrm{AU}, \\ 10 \\ \\mathrm{AU}]$, number of points $N = 256$.\n  - $T_{0} = 100 \\ \\mathrm{K}$ at $R_{0} = 1 \\ \\mathrm{AU}$, exponent $q = 0.0$.\n  - $\\Sigma_{0} = 100 \\ \\mathrm{kg \\ m^{-2}}$ at $R_{0} = 1 \\ \\mathrm{AU}$, exponent $p = 0.0$.\n  - No exponential taper.\n- Test case $3$ (tapered outer disk):\n  - $R \\in [1 \\ \\mathrm{AU}, \\ 200 \\ \\mathrm{AU}]$, number of points $N = 512$.\n  - $T_{0} = 150 \\ \\mathrm{K}$ at $R_{0} = 1 \\ \\mathrm{AU}$, exponent $q = 0.4$.\n  - $\\Sigma_{0} = 1000 \\ \\mathrm{kg \\ m^{-2}}$ at $R_{0} = 1 \\ \\mathrm{AU}$, exponent $p = 1.0$.\n  - Exponential taper with $R_{c} = 30 \\ \\mathrm{AU}$.\n- Test case $4$ (hot inner disk, steeper gradients):\n  - $R \\in [0.1 \\ \\mathrm{AU}, \\ 10 \\ \\mathrm{AU}]$, number of points $N = 384$.\n  - $T_{0} = 1000 \\ \\mathrm{K}$ at $R_{0} = 0.1 \\ \\mathrm{AU}$, exponent $q = 0.75$.\n  - $\\Sigma_{0} = 10000 \\ \\mathrm{kg \\ m^{-2}}$ at $R_{0} = 0.1 \\ \\mathrm{AU}$, exponent $p = 1.5$.\n  - No exponential taper.\n\nWhat to output:\n- For each test case, compute the maximum absolute fractional deviation $\\max_{i} \\delta(R_{i})$.\n- Your program should produce a single line of output containing the results as a comma-separated list of four floats, enclosed in square brackets, with each float rounded to exactly six digits after the decimal point. For example, output of the form $[x_{1},x_{2},x_{3},x_{4}]$ where each $x_{j}$ is a float with six digits after the decimal point and no units.\n\nAngle units: No angles are used.\n\nPercentages: Do not use a percentage sign; the deviation is a fraction and must be reported as a unitless float.\n\nScientific realism constraints:\n- Ensure that the computed $v_{\\phi}^2(R)$ never becomes negative. If numerical differentiation leads to a slightly negative value due to round-off, you must treat it as zero before taking a square root.\n\nFinal requirement:\n- The final code must be self-contained, require no input, and print only the specified single-line list on standard output. The implementation language and library constraints are specified separately in the execution environment.", "solution": "The user has requested a solution to a computational astrophysics problem involving the calculation of the azimuthal velocity profile in a gaseous accretion disk. The first step is to validate the problem statement. The problem is found to be scientifically grounded, well-posed, objective, and internally consistent. It represents a standard exercise in accretion disk theory. Therefore, I will proceed with a full solution.\n\nThe solution involves two main stages: first, the derivation of the governing equation for the azimuthal velocity, and second, the implementation of a numerical algorithm to solve this equation for the given physical parameters and profiles.\n\n### I. Derivation of the Azimuthal Velocity Equation\n\nThe fundamental relationship governing the motion of a fluid in a gravitational potential is the Euler equation. For a steady-state ($\\partial/\\partial t = 0$), axisymmetric ($\\partial/\\partial\\phi = 0$), and inviscid fluid in circular motion ($v_R = v_z = 0$, $v_\\phi \\neq 0$) within a potential $\\Phi$, the radial component of the Euler equation in cylindrical coordinates $(R, \\phi, z)$ is:\n$$\n-\\frac{v_{\\phi}^2(R)}{R} = \\frac{\\partial \\Phi(R)}{\\partial R} + \\frac{1}{\\rho}\\frac{\\partial P}{\\partial R}\n$$\nHere, $\\rho$ is the volume density, and $P$ is the thermal pressure. The term on the left is the centripetal acceleration. The terms on the right are the gravitational force per unit mass and the pressure gradient force per unit mass, respectively.\n\nRearranging this equation to solve for $v_{\\phi}^2$ yields:\n$$\nv_{\\phi}^2(R) = -R\\frac{\\partial \\Phi(R)}{\\partial R} - \\frac{R}{\\rho}\\frac{\\partial P}{\\partial R}\n$$\nFor a central point mass $M$, the Newtonian gravitational potential is $\\Phi(R) = -G M / R$. The gravitational term becomes:\n$$\n-R\\frac{\\partial \\Phi(R)}{\\partial R} = -R \\frac{\\partial}{\\partial R}\\left(-\\frac{G M}{R}\\right) = -R\\left(\\frac{G M}{R^2}\\right) = -\\frac{G M}{R}\n$$\nThis is an error in the sign application. Let us be more careful. The force is $\\vec{F} = -m\\nabla\\Phi$. The radial component of force per unit mass is $F_R/m = -\\partial\\Phi/\\partial R = -GM/R^2$. This is an inward (negative) force. The radial acceleration is $a_R = -v_\\phi^2/R$. The pressure force is $-1/\\rho \\cdot \\partial P/\\partial R$. The equation of motion $m a_R = F_{R, grav} + F_{R, press}$ becomes:\n$$\nm\\left(-\\frac{v_\\phi^2}{R}\\right) = m\\left(-\\frac{GM}{R^2}\\right) - \\frac{\\partial P}{\\partial R} V\n$$\nwhere V is a volume element. Dividing by mass $m=\\rho V$ and simplifying:\n$$\n-\\frac{v_\\phi^2}{R} = -\\frac{GM}{R^2} - \\frac{1}{\\rho}\\frac{\\partial P}{\\partial R}\n$$\nMultiplying by $-R$:\n$$\nv_\\phi^2(R) = \\frac{GM}{R} + \\frac{R}{\\rho} \\frac{\\partial P}{\\partial R}\n$$\nThis equation correctly shows that a negative pressure gradient ($\\partial P/\\partial R  0$, i.e., pressure decreasing outwards) provides a radial force that helps support the disk against gravity, thus reducing the required orbital speed below the Keplerian value.\n\nThe problem requires a formulation in terms of vertically integrated quantities. We assume $v_{\\phi}$ and $\\Phi$ are independent of the vertical coordinate $z$ and integrate the equation of motion (multiplied by $\\rho$) over $z$:\n$$\n\\int_{-\\infty}^{+\\infty} \\rho(R,z) \\frac{v_{\\phi}^2(R)}{R} dz = \\int_{-\\infty}^{+\\infty} \\rho(R,z) \\frac{G M}{R^2} dz + \\int_{-\\infty}^{+\\infty} \\frac{\\partial P(R,z)}{\\partial R} dz\n$$\nUsing the definitions of surface density $\\Sigma(R) = \\int \\rho dz$ and vertically integrated pressure $\\Pi(R) = \\int P dz$, and applying the Leibniz integral rule to the pressure term, we get:\n$$\n\\Sigma(R) \\frac{v_{\\phi}^2(R)}{R} = \\Sigma(R) \\frac{G M}{R^2} + \\frac{d\\Pi(R)}{dR}\n$$\nDividing by $\\Sigma(R)$ and multiplying by $R$ gives the desired expression for $v_{\\phi}^2(R)$:\n$$\nv_{\\phi}^2(R) = \\frac{G M}{R} + \\frac{R}{\\Sigma(R)}\\frac{d\\Pi(R)}{dR}\n$$\nRecognizing the Keplerian velocity $v_K(R) = \\sqrt{G M/R}$, we arrive at the final governing equation:\n$$\nv_{\\phi}^2(R) = v_K^2(R) + \\frac{R}{\\Sigma(R)}\\frac{d\\Pi}{dR}\n$$\n\n### II. Numerical Implementation\n\nThe algorithm proceeds as follows for each test case:\n1.  **Setup**: All physical constants and parameters from the test case are defined in SI units. The radial grid $R$ is constructed as a linearly spaced array from $R_{\\min}$ to $R_{\\max}$ with $N$ points, with all distances converted from AU to meters.\n2.  **Profile Calculation**: The radial profiles for temperature $T(R)$ and surface density $\\Sigma(R)$ are calculated for each point on the radial grid using the provided power-law and optional exponential taper forms:\n    $$\n    T(R) = T_{0} \\left( \\frac{R}{R_{0}} \\right)^{-q}\n    $$\n    $$\n    \\Sigma(R) = \\Sigma_{0} \\left( \\frac{R}{R_{0}} \\right)^{-p} \\times \\exp\\left( - \\frac{R}{R_{c}} \\right)\n    $$\n3.  **Integrated Pressure**: The isothermal sound speed squared, $c_s^2(R) = \\frac{k_{\\mathrm{B}} T(R)}{\\mu m_{p}}$, is computed. Subsequently, the vertically integrated pressure is determined using the given relation $\\Pi(R) = \\Sigma(R) c_s^2(R)$.\n4.  **Numerical Differentiation**: The radial gradient of the integrated pressure, $d\\Pi/dR$, is computed numerically. As specified, a second-order central difference scheme is used for the interior points of the grid, and first-order one-sided (forward/backward) schemes are used at the two boundary points.\n    $$\n    \\left( \\frac{d\\Pi}{dR} \\right)_{i} = \\begin{cases}\n        (\\Pi_{1} - \\Pi_{0}) / \\Delta R  \\text{if } i=0 \\\\\n        (\\Pi_{i+1} - \\Pi_{i-1}) / (2\\Delta R)  \\text{if } 1 \\le i \\le N-2 \\\\\n        (\\Pi_{N-1} - \\Pi_{N-2}) / \\Delta R  \\text{if } i=N-1\n    \\end{cases}\n    $$\n    where $\\Delta R$ is the uniform grid spacing.\n5.  **Velocity Calculation**: The Keplerian velocity squared, $v_K^2(R) = G M / R$, is computed. The pressure gradient term, $\\frac{R}{\\Sigma(R)} \\frac{d\\Pi}{dR}$, is then added to $v_K^2(R)$ to obtain $v_{\\phi}^2(R)$. A check is performed to ensure $v_{\\phi}^2(R)$ is non-negative, setting any small negative values resulting from numerical inaccuracies to zero. Finally, $v_{\\phi}(R)$ and $v_K(R)$ are found by taking the square root.\n6.  **Deviation Analysis**: The absolute fractional deviation, $\\delta(R) = |v_{\\phi}(R)/v_K(R) - 1|$, is calculated across the grid. The maximum value of this deviation, $\\max(\\delta(R))$, is identified.\n7.  **Output**: The maximum deviation for each test case is collected, and the final results are formatted and printed as a single comma-separated list.\n\nThis procedure is systematically applied to all four test cases provided in the problem statement.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum fractional deviation from Keplerian velocity in a\n    pressure-supported accretion disk for a series of test cases.\n    \"\"\"\n    \n    # Physical constants in SI units\n    G = 6.67430e-11  # m^3 kg^-1 s^-2\n    M_SOLAR = 1.98847e30  # kg\n    KB = 1.380649e-23  # J K^-1\n    MP = 1.67262192369e-27  # kg\n    AU = 1.495978707e11  # m\n    \n    # Fixed parameters for all test cases\n    M_STAR = 1.0 * M_SOLAR\n    MU = 2.34\n\n    # Test cases defined in the problem statement\n    test_cases = [\n        {\n            \"R_range_au\": (0.1, 100), \"N\": 256,\n            \"T0\": 280, \"R0_T_au\": 1.0, \"q\": 0.5,\n            \"Sigma0\": 17000, \"R0_Sigma_au\": 1.0, \"p\": 1.0,\n            \"Rc_au\": None\n        },\n        {\n            \"R_range_au\": (1, 10), \"N\": 256,\n            \"T0\": 100, \"R0_T_au\": 1.0, \"q\": 0.0,\n            \"Sigma0\": 100, \"R0_Sigma_au\": 1.0, \"p\": 0.0,\n            \"Rc_au\": None\n        },\n        {\n            \"R_range_au\": (1, 200), \"N\": 512,\n            \"T0\": 150, \"R0_T_au\": 1.0, \"q\": 0.4,\n            \"Sigma0\": 1000, \"R0_Sigma_au\": 1.0, \"p\": 1.0,\n            \"Rc_au\": 30.0\n        },\n        {\n            \"R_range_au\": (0.1, 10), \"N\": 384,\n            \"T0\": 1000, \"R0_T_au\": 0.1, \"q\": 0.75,\n            \"Sigma0\": 10000, \"R0_Sigma_au\": 0.1, \"p\": 1.5,\n            \"Rc_au\": None\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # 1. Setup: Construct radial grid and convert units to SI\n        r_min_au, r_max_au = case[\"R_range_au\"]\n        N = case[\"N\"]\n        R = np.linspace(r_min_au * AU, r_max_au * AU, N)\n        \n        R0_T = case[\"R0_T_au\"] * AU\n        R0_Sigma = case[\"R0_Sigma_au\"] * AU\n        \n        # 2. Profile Calculation\n        # Temperature profile T(R)\n        T = case[\"T0\"] * (R / R0_T)**(-case[\"q\"])\n\n        # Surface density profile Sigma(R)\n        Sigma = case[\"Sigma0\"] * (R / R0_Sigma)**(-case[\"p\"])\n        if case[\"Rc_au\"] is not None:\n            Rc = case[\"Rc_au\"] * AU\n            Sigma *= np.exp(-R / Rc)\n            \n        # 3. Integrated Pressure Calculation\n        # Isothermal sound speed squared c_s^2(R)\n        cs2 = (KB * T) / (MU * MP)\n        \n        # Vertically integrated pressure Pi(R)\n        Pi = Sigma * cs2\n        \n        # 4. Numerical Differentiation of Pi\n        dPi_dR = np.zeros_like(R)\n        dR = R[1] - R[0]\n        \n        # Central difference for interior points\n        dPi_dR[1:-1] = (Pi[2:] - Pi[0:-2]) / (2 * dR)\n        \n        # One-sided difference for boundaries\n        dPi_dR[0] = (Pi[1] - Pi[0]) / dR  # Forward difference\n        dPi_dR[-1] = (Pi[-1] - Pi[-2]) / dR # Backward difference\n        \n        # 5. Velocity Calculation\n        # Keplerian velocity squared\n        vk2 = G * M_STAR / R\n        \n        # Pressure support term\n        pressure_term = (R / Sigma) * dPi_dR\n        \n        # Azimuthal velocity squared\n        v_phi_sq = vk2 + pressure_term\n        \n        # Ensure v_phi_sq is non-negative\n        v_phi_sq = np.maximum(v_phi_sq, 0)\n        \n        # Calculate velocities\n        v_phi = np.sqrt(v_phi_sq)\n        vk = np.sqrt(vk2)\n        \n        # 6. Deviation Analysis\n        # Handle potential division by zero at R=0, though not possible with given ranges\n        with np.errstate(divide='ignore', invalid='ignore'):\n            delta = np.abs(v_phi / vk - 1)\n        \n        # The result for the case is the maximum deviation\n        max_delta = np.nanmax(delta)\n        results.append(max_delta)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```", "id": "3517571"}, {"introduction": "For matter to accrete onto a central object, it must lose angular momentum. The Shakura–Sunyaev model parameterizes the viscous stress responsible for this transport with the dimensionless parameter $\\alpha$. This hands-on exercise guides you through the derivation and implementation of the classic steady-state solution for an $\\alpha$-disk, connecting the accretion rate $\\dot{M}$ to the disk's surface density $\\Sigma(R)$ and radial velocity $v_R(R)$ [@problem_id:3517540]. The verification step emphasizes a critical skill in computational astrophysics: ensuring that your numerical results are consistent with the fundamental conservation laws from which the model was derived.", "problem": "Consider a steady, axisymmetric, geometrically thin accretion disk orbiting a central point mass. The disk is modeled using the Shakura–Sunyaev prescription for viscosity and is assumed to be vertically isothermal. Your task is to derive, implement, and verify the steady-state radial profiles of the surface density and radial velocity under these assumptions, starting from first principles that are appropriate for computational astrophysics.\n\nAssumptions and foundational base:\n- The disk is steady and axisymmetric, so all quantities are independent of azimuth and time.\n- The gravitational potential is Newtonian and Keplerian rotation applies. The Keplerian angular frequency is $\\Omega_{\\mathrm{K}}(R)=\\sqrt{G M / R^{3}}$, where $G$ is the gravitational constant and $M$ is the central mass.\n- Vertical hydrostatic balance with an isothermal vertical structure gives the pressure scale height $H(R)=c_{s}(R)/\\Omega_{\\mathrm{K}}(R)$, where $c_{s}(R)$ is the isothermal sound speed.\n- The Shakura–Sunyaev $\\alpha$ prescription for viscosity is used: $\\nu(R)=\\alpha\\,c_{s}(R)\\,H(R)$, where $\\alpha$ is a dimensionless constant.\n- The equation of state is locally isothermal with a prescribed radial profile $c_{s}(R)=c_{s0}\\,[R/R_{0}]^{-q}$, where $c_{s0}$ is a constant speed at reference radius $R_{0}$ and $q$ is a dimensionless exponent.\n- The inner boundary of the disk is at $R_{\\mathrm{in}}=6 G M / c^{2}$, where $c$ is the speed of light. Adopt the zero-torque boundary condition at $R_{\\mathrm{in}}$.\n- The advective mass flux and the total radial angular momentum flux are constant in steady state.\n\nStarting from conservation laws and the definitions above, derive expressions for the steady-state radial profiles:\n- the surface density $\\Sigma(R)$,\n- the radial velocity $v_{R}(R)$,\nin terms of the parameters $M$, $\\dot{M}$, $\\alpha$, $c_{s}(R)$, and $R_{\\mathrm{in}}$.\n\nThen, implement a program that:\n- Constructs a logarithmically spaced radius array $R$ from $R_{\\mathrm{min}}=(1+\\epsilon)\\,R_{\\mathrm{in}}$ to $R_{\\mathrm{out}}$, where $\\epsilon=0.01$ and the number of points is $N=256$.\n- Uses the derived expressions to compute $\\Sigma(R)$ and $v_{R}(R)$.\n- Verifies mass flux conservation by computing $F_{M}(R)=-2\\pi R \\Sigma(R) v_{R}(R)$ and comparing it to the specified $\\dot{M}$.\n- Verifies angular momentum flux conservation under the zero-torque inner boundary condition by computing\n$$\nF_{J}(R)=\\dot{M}\\,l(R)-2\\pi R^{3}\\,\\nu(R)\\,\\Sigma(R)\\,\\frac{d\\Omega_{\\mathrm{K}}}{dR},\n$$\nand comparing it to the constant $F_{J,\\mathrm{in}}=\\dot{M}\\,l(R_{\\mathrm{in}})$, where $l(R)=R^{2}\\Omega_{\\mathrm{K}}(R)$.\n\nReport, for each test case, the following two numbers:\n- the maximum relative deviation of the mass flux from the specified $\\dot{M}$ over the radial grid, defined as $\\max_{R}\\left|\\frac{F_{M}(R)}{\\dot{M}}-1\\right|$,\n- the maximum relative deviation of the angular momentum flux from $F_{J,\\mathrm{in}}$ over the radial grid, defined as $\\max_{R}\\left|\\frac{F_{J}(R)}{F_{J,\\mathrm{in}}}-1\\right|$.\n\nUse the following constants: $G=6.67430\\times 10^{-11}\\,\\mathrm{m^{3}\\,kg^{-1}\\,s^{-2}}$, $c=2.99792458\\times 10^{8}\\,\\mathrm{m\\,s^{-1}}$, and $M_{\\odot}=1.98847\\times 10^{30}\\,\\mathrm{kg}$.\n\nPhysical units:\n- Mass $M$ in $\\mathrm{kg}$,\n- Mass accretion rate $\\dot{M}$ in $\\mathrm{kg\\,s^{-1}}$,\n- Radius $R$ in $\\mathrm{m}$,\n- Sound speed $c_{s0}$ in $\\mathrm{m\\,s^{-1}}$,\n- Radial velocity $v_{R}$ in $\\mathrm{m\\,s^{-1}}$,\n- Surface density $\\Sigma$ in $\\mathrm{kg\\,m^{-2}}$.\n\nAngle units are not used. All outputs of the program must be dimensionless floats as defined below.\n\nTest suite:\nImplement your program to compute the required quantities for the following parameter sets. In each case, set $R_{0}=f_{0}\\,R_{\\mathrm{in}}$ and $R_{\\mathrm{out}}=f_{\\mathrm{out}}\\,R_{\\mathrm{in}}$, and use $N=256$ and $\\epsilon=0.01$.\n\n- Case $1$ (happy path):\n  - $M=10\\,M_{\\odot}$,\n  - $\\dot{M}=10^{17}\\,\\mathrm{kg\\,s^{-1}}$,\n  - $\\alpha=0.1$,\n  - $c_{s0}=10^{5}\\,\\mathrm{m\\,s^{-1}}$,\n  - $q=0.5$,\n  - $f_{0}=10$,\n  - $f_{\\mathrm{out}}=500$.\n\n- Case $2$ (lower viscosity, constant sound speed):\n  - $M=1\\,M_{\\odot}$,\n  - $\\dot{M}=3\\times 10^{16}\\,\\mathrm{kg\\,s^{-1}}$,\n  - $\\alpha=0.01$,\n  - $c_{s0}=5\\times 10^{4}\\,\\mathrm{m\\,s^{-1}}$,\n  - $q=0$,\n  - $f_{0}=1$,\n  - $f_{\\mathrm{out}}=300$.\n\n- Case $3$ (higher accretion rate and moderate sound speed gradient):\n  - $M=5\\,M_{\\odot}$,\n  - $\\dot{M}=5\\times 10^{18}\\,\\mathrm{kg\\,s^{-1}}$,\n  - $\\alpha=0.2$,\n  - $c_{s0}=2\\times 10^{5}\\,\\mathrm{m\\,s^{-1}}$,\n  - $q=0.25$,\n  - $f_{0}=3$,\n  - $f_{\\mathrm{out}}=1000$.\n\n- Case $4$ (edge case: small $\\alpha$ and cooler disk):\n  - $M=30\\,M_{\\odot}$,\n  - $\\dot{M}=10^{18}\\,\\mathrm{kg\\,s^{-1}}$,\n  - $\\alpha=0.005$,\n  - $c_{s0}=10^{4}\\,\\mathrm{m\\,s^{-1}}$,\n  - $q=0.75$,\n  - $f_{0}=1$,\n  - $f_{\\mathrm{out}}=200$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element of this list corresponds to one test case and must itself be a two-element list containing the two floats described above, in that order, i.e., $\\left[\\left[\\mathrm{mass\\_rel\\_err\\_max}_{1},\\mathrm{angmom\\_rel\\_err\\_max}_{1}\\right],\\ldots,\\left[\\mathrm{mass\\_rel\\_err\\_max}_{4},\\mathrm{angmom\\_rel\\_err\\_max}_{4}\\right]\\right]$. For example: $[[a_{1},b_{1}],[a_{2},b_{2}],[a_{3},b_{3}],[a_{4},b_{4}]]$.", "solution": "The problem statement is a well-posed and scientifically grounded exercise in computational astrophysics, rooted in the standard Shakura-Sunyaev model for accretion disks. All assumptions, constants, and boundary conditions are explicitly provided and are self-consistent. The problem is valid.\n\nThe derivation of the steady-state profiles for surface density $\\Sigma(R)$ and radial velocity $v_R(R)$ proceeds from the fundamental conservation laws of mass and angular momentum.\n\n**1. Mass Conservation**\nFor a steady-state ($ \\partial/\\partial t = 0 $), axisymmetric ($ \\partial/\\partial \\phi = 0 $) disk, the vertically integrated continuity equation is:\n$$ \\frac{1}{R} \\frac{d}{dR} \\left( R \\Sigma(R) v_R(R) \\right) = 0 $$\nIntegrating this equation shows that the quantity $R \\Sigma v_R$ is constant. The mass accretion rate, $\\dot{M}$, is defined as the total mass flowing radially inward per unit time across a cylinder of radius $R$. By convention, $\\dot{M}  0$ for inflow, which implies $v_R(R)  0$.\n$$ \\dot{M} = -2\\pi R \\Sigma(R) v_R(R) $$\nThis equation is a statement of constant mass flux through the disk. It provides a relationship between $\\Sigma(R)$ and $v_R(R)$:\n$$ v_R(R) = -\\frac{\\dot{M}}{2\\pi R \\Sigma(R)} \\quad (*)$$\n\n**2. Angular Momentum Conservation**\nThe conservation of angular momentum requires the net flux of angular momentum across any radius to be constant in a steady state. This flux consists of two components: advective transport by the accreting gas and viscous transport due to shear. The problem defines the total radial angular momentum flux as:\n$$ F_J(R) = \\dot{M} l(R) - 2\\pi R^3 \\nu(R) \\Sigma(R) \\frac{d\\Omega_{\\mathrm{K}}}{dR} $$\nwhere $l(R) = R^2 \\Omega_K(R)$ is the specific angular momentum at radius $R$, and the second term represents the viscous torque. In steady state, this flux is constant. The constant is determined by the inner boundary condition. The problem specifies a zero-torque condition at the inner boundary, $R_{\\mathrm{in}}$. This implies that the viscous torque term vanishes at $R=R_{\\mathrm{in}}$. Therefore, the constant flux is equal to the purely advective flux at the inner edge:\n$$ F_J(R) = F_{J, \\mathrm{in}} = \\dot{M} l(R_{\\mathrm{in}}) $$\nEquating the two expressions for $F_J(R)$ gives the governing equation for the disk structure:\n$$ \\dot{M} l(R) - 2\\pi R^3 \\nu(R) \\Sigma(R) \\frac{d\\Omega_{\\mathrm{K}}}{dR} = \\dot{M} l(R_{\\mathrm{in}}) $$\nWe can now solve for the surface density $\\Sigma(R)$:\n$$ -2\\pi R^3 \\nu(R) \\Sigma(R) \\frac{d\\Omega_{\\mathrm{K}}}{dR} = \\dot{M} \\left( l(R_{\\mathrm{in}}) - l(R) \\right) $$\n$$ \\Sigma(R) = \\frac{\\dot{M} \\left( l(R) - l(R_{\\mathrm{in}}) \\right)}{-2\\pi R^3 \\nu(R) \\frac{d\\Omega_{\\mathrm{K}}}{dR}} $$\nTo simplify this expression, we use the Keplerian angular velocity profile $\\Omega_{\\mathrm{K}}(R) = \\sqrt{GM/R^3}$. Its derivative is:\n$$ \\frac{d\\Omega_{\\mathrm{K}}}{dR} = -\\frac{3}{2} \\sqrt{GM} R^{-5/2} = -\\frac{3}{2} \\frac{\\Omega_{\\mathrm{K}}(R)}{R} $$\nSubstituting this into the denominator of the expression for $\\Sigma(R)$:\n$$ -2\\pi R^3 \\nu(R) \\left( -\\frac{3}{2} \\frac{\\Omega_{\\mathrm{K}}(R)}{R} \\right) = 3\\pi \\nu(R) R^2 \\Omega_{\\mathrm{K}}(R) $$\nSo, the surface density is:\n$$ \\Sigma(R) = \\frac{\\dot{M} \\left( l(R) - l(R_{\\mathrm{in}}) \\right)}{3\\pi \\nu(R) R^2 \\Omega_{\\mathrm{K}}(R)} $$\nNext, we substitute the specific angular momentum, $l(R) = \\sqrt{GMR}$:\n$$ \\Sigma(R) = \\frac{\\dot{M} \\left( \\sqrt{GMR} - \\sqrt{GMR_{\\mathrm{in}}} \\right)}{3\\pi \\nu(R) R^2 \\sqrt{GM/R^3}} = \\frac{\\dot{M}\\sqrt{GM}\\left( \\sqrt{R} - \\sqrt{R_{\\mathrm{in}}} \\right)}{3\\pi \\nu(R) \\sqrt{GM}\\sqrt{R}} $$\nThis simplifies to the canonical expression for the surface density in a Shakura-Sunyaev disk with a zero-torque inner boundary condition:\n$$ \\Sigma(R) = \\frac{\\dot{M}}{3\\pi\\nu(R)} \\left[ 1 - \\sqrt{\\frac{R_{\\mathrm{in}}}{R}} \\right] \\quad (1) $$\nThe kinematic viscosity $\\nu(R)$ is given by the $\\alpha$-prescription, $\\nu(R) = \\alpha c_s(R) H(R)$. With the vertical scale height $H(R) = c_s(R)/\\Omega_K(R)$, this becomes:\n$$ \\nu(R) = \\alpha \\frac{c_s(R)^2}{\\Omega_K(R)} $$\nwhere the sound speed profile is $c_s(R) = c_{s0} (R/R_0)^{-q}$.\n\n**3. Derived Expressions for Profiles**\nWith the expression for $\\Sigma(R)$ established, we can find the radial velocity $v_R(R)$ by substituting equation $(1)$ into equation $(*)$:\n$$ v_R(R) = -\\frac{\\dot{M}}{2\\pi R \\left( \\frac{\\dot{M}}{3\\pi\\nu(R)} \\left[ 1 - \\sqrt{\\frac{R_{\\mathrm{in}}}{R}} \\right] \\right)} $$\nSimplifying this expression yields:\n$$ v_R(R) = - \\frac{3}{2} \\frac{\\nu(R)}{R} \\left( \\frac{1}{1 - \\sqrt{\\frac{R_{\\mathrm{in}}}{R}}} \\right) \\quad (2) $$\nEquations $(1)$ and $(2)$ are the final derived expressions for the steady-state surface density and radial velocity profiles.\n\n**4. Implementation and Verification**\nThe program will implement these derived analytical solutions. The verification steps required by the problem are checks of algebraic self-consistency.\n- **Mass Flux Conservation**: Substituting the derived expressions for $\\Sigma(R)$ and $v_R(R)$ into the mass flux definition $F_M(R)=-2\\pi R \\Sigma(R) v_R(R)$ yields:\n$$ F_M(R) = -2\\pi R \\left(\\frac{\\dot{M}}{3\\pi\\nu(R)} \\left[ 1 - \\sqrt{\\frac{R_{\\mathrm{in}}}{R}} \\right]\\right) \\left(- \\frac{3}{2} \\frac{\\nu(R)}{R} \\frac{1}{1 - \\sqrt{\\frac{R_{\\mathrm{in}}}{R}}}\\right) = \\dot{M} $$\nThis is an identity. The numerical calculation will test the fidelity of the floating-point implementation. The maximum relative deviation, $\\max_{R}\\left|\\frac{F_{M}(R)}{\\dot{M}}-1\\right|$, should be on the order of machine precision.\n- **Angular Momentum Flux Conservation**: The expression for $\\Sigma(R)$ was derived directly from the condition $F_J(R) = F_{J,\\mathrm{in}}$. Therefore, computing $F_J(R)$ using the derived $\\Sigma(R)$ must analytically return $F_{J,\\mathrm{in}}$.\n$$ F_J(R) = \\dot{M}l(R) - 2\\pi R^3 \\nu \\frac{d\\Omega_K}{dR} \\left( \\frac{\\dot{M}(l(R)-l(R_{in}))}{-2\\pi R^3 \\nu \\frac{d\\Omega_K}{dR}} \\right) = \\dot{M}l(R) + \\dot{M}(l(R_{in})-l(R))=\\dot{M}l(R_{in}) $$\nThis is also an identity. The numerical check, $\\max_{R}\\left|\\frac{F_{J}(R)}{F_{J,\\mathrm{in}}}-1\\right|$, will similarly test the implementation's numerical accuracy.\nThe code will compute these maximum relative deviations for each test case.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Shakura-Sunyaev disk problem for multiple test cases and\n    prints the verification results in the specified format.\n    \"\"\"\n    \n    # Physical and mathematical constants\n    G = 6.67430e-11  # Gravitational constant in m^3 kg^-1 s^-2\n    c = 2.99792458e8  # Speed of light in m s^-1\n    M_sun = 1.98847e30 # Solar mass in kg\n\n    test_cases = [\n        # Case 1: M(Msun), Mdot(kg/s), alpha, cs0(m/s), q, f0, fout\n        (10, 1e17, 0.1, 1e5, 0.5, 10, 500),\n        # Case 2\n        (1, 3e16, 0.01, 5e4, 0, 1, 300),\n        # Case 3\n        (5, 5e18, 0.2, 2e5, 0.25, 3, 1000),\n        # Case 4\n        (30, 1e18, 0.005, 1e4, 0.75, 1, 200)\n    ]\n    \n    results = []\n    for params in test_cases:\n        results.append(solve_case(params, G, c, M_sun))\n\n    # Format the final output string exactly as required, without extra spaces.\n    results_str = \",\".join([f\"[{r[0]},{r[1]}]\" for r in results])\n    print(f\"[{results_str}]\")\n\n\ndef solve_case(params, G, c, M_sun):\n    \"\"\"\n    Computes the verification metrics for a single test case.\n    \"\"\"\n    # Unpack parameters for the current test case\n    M_in_Msun, dot_M, alpha, c_s0, q, f0, fout = params\n    N = 256\n    epsilon = 0.01\n\n    # 1. Preliminary calculations\n    M = M_in_Msun * M_sun\n    # Inner boundary radius (Schwarzschild radius for non-rotating black hole is Rs=2GM/c^2, so Rin=3Rs)\n    R_in = 6 * G * M / c**2\n    # Reference radius and outer radius\n    R0 = f0 * R_in\n    R_out = fout * R_in\n    # Innermost grid point, slightly outside R_in to avoid singularity\n    R_min = (1 + epsilon) * R_in\n    \n    # Construct the logarithmically spaced radial grid\n    R = np.logspace(np.log10(R_min), np.log10(R_out), N, dtype=np.float64)\n\n    # 2. Define physical quantities as functions of radius R\n    \n    # Keplerian angular velocity\n    omega_k_R = np.sqrt(G * M / R**3)\n    \n    # Isothermal sound speed\n    cs_R = c_s0 * (R / R0)**(-q)\n    \n    # Shakura-Sunyaev kinematic viscosity\n    nu_R = alpha * cs_R**2 / omega_k_R\n\n    # 3. Compute derived profiles for Sigma(R) and v_R(R)\n    \n    # Common factor in the standard solution for a zero-torque inner boundary\n    f_boundary = 1 - np.sqrt(R_in / R)\n    \n    # Surface density profile\n    Sigma_R = (dot_M / (3 * np.pi * nu_R)) * f_boundary\n    \n    # Radial velocity profile\n    v_R = - (3 / 2) * (nu_R / R) / f_boundary\n\n    # 4. Verification checks\n    \n    # 4.1. Mass Flux Conservation\n    # Analytically, F_M(R) = -2*pi*R*Sigma(R)*v_R(R) should be exactly M_dot.\n    F_M_R = -2 * np.pi * R * Sigma_R * v_R\n    mass_rel_err_max = np.max(np.abs(F_M_R / dot_M - 1))\n\n    # 4.2. Angular Momentum Flux Conservation\n    \n    # Specific angular momentum\n    l_R = np.sqrt(G * M * R)\n    \n    # Analytical derivative of Keplerian angular velocity\n    d_omega_k_dr_R = -1.5 * omega_k_R / R\n    \n    # Constant angular momentum flux at the inner boundary\n    F_J_in = dot_M * np.sqrt(G * M * R_in)\n    \n    # Angular momentum flux at each radius R, as defined in the problem\n    # F_J(R) = M_dot*l(R) - 2*pi*R^3*nu(R)*Sigma(R)*dOmega_k/dR\n    F_J_R = dot_M * l_R - 2 * np.pi * R**3 * nu_R * Sigma_R * d_omega_k_dr_R\n\n    # The maximum relative deviation from the constant value F_J_in.\n    # Note: F_J_in can be zero if M=0 or Rin=0, handle division by zero.\n    if F_J_in == 0:\n        # If F_J_in is zero, the absolute error is more appropriate.\n        # But for this problem, M  0 and R_in  0, so F_J_in is never zero.\n        ang_mom_rel_err_max = np.max(np.abs(F_J_R))\n    else:\n        ang_mom_rel_err_max = np.max(np.abs(F_J_R / F_J_in - 1))\n        \n    return [mass_rel_err_max, ang_mom_rel_err_max]\n\n\nif __name__ == \"__main__\":\n    solve()\n\n```", "id": "3517540"}, {"introduction": "While steady-state models are insightful, understanding how disks evolve requires solving time-dependent equations. The viscous transport of angular momentum is mathematically described by a diffusion equation, causing an initial concentration of mass and angular momentum to spread out over time. This advanced practice challenges you to move beyond implementing analytical formulas and instead numerically solve the partial differential equation for a \"spreading ring\" test case [@problem_id:3517585]. This exercise is fundamental to developing computational skills, as it introduces the core concepts of numerical stability, conservative discretization, and convergence testing—the gold standard for validating a numerical code.", "problem": "You are to design and implement a computational experiment, grounded in conservation laws, that quantifies and validates angular momentum transport in a thin, axisymmetric accretion disk. The experiment uses a standard rotating ring configuration and a conservative numerical discretization of the viscous thin-disk evolution equation. Your goals are to compute a measurable transport rate, quantify numerical error, and verify convergence with resolution.\n\nStart from the following fundamental laws and widely tested formulas and definitions:\n- Conservation of mass (continuity equation): for an axisymmetric thin disk with surface density $\\,\\Sigma(r,t)\\,$, the mass inside a cylinder of radius $\\,r\\,$ changes due to radial fluxes of $\\,\\Sigma\\,$.\n- Newtonian gravity with a point mass $\\,M\\,$ at the origin. The angular speed for a circular orbit is $\\,\\Omega(r) = \\sqrt{GM/r^3}\\,$. The specific angular momentum is $\\,\\ell(r) = r^2 \\Omega(r)\\,$.\n- The viscous shear stress in a thin disk under the Navier–Stokes framework with kinematic viscosity $\\,\\nu\\,$ and axisymmetry is $\\,T_{r\\varphi} = \\nu \\,\\Sigma\\, r \\,\\dfrac{d\\Omega}{dr}\\,$.\n- The angular momentum flux carried by viscous stress across a circle of radius $\\,r\\,$ is $\\,F_J(r,t) = -\\,2\\pi\\, r^3 \\,\\nu\\, \\Sigma(r,t)\\, \\dfrac{d\\Omega}{dr}\\,$. For a Keplerian disk, $\\,\\dfrac{d\\Omega}{dr} = -\\dfrac{3}{2}\\dfrac{\\Omega}{r}\\,$, so $\\,F_J(r,t) = 3\\pi\\,\\nu\\,\\Sigma(r,t)\\,r^2\\,\\Omega(r)\\,$.\n- Under the standard thin-disk approximation, the evolution of $\\,\\Sigma(r,t)\\,$ with viscous angular momentum transport is described by a diffusion-type equation,\n$$\n\\frac{\\partial \\Sigma}{\\partial t}\n= \\frac{3}{r}\\,\\frac{\\partial}{\\partial r}\\!\\left(r^{1/2}\\,\\frac{\\partial}{\\partial r}\\big(\\nu\\,\\Sigma\\,r^{1/2}\\big)\\right).\n$$\n\nYour numerical method must:\n- Discretize $\\,r\\,$ on a uniform grid of $\\,N\\,$ cell centers spanning $\\,r\\in[r_{\\min},r_{\\max}]\\,$.\n- Evolve $\\,\\Sigma(r,t)\\,$ by a second-order, conservative flux form of the diffusion equation using the discrete flux\n$$\nF(r,t) = r^{1/2}\\,\\frac{\\partial}{\\partial r}\\big(\\nu\\,\\Sigma(r,t)\\,r^{1/2}\\big),\n$$\nsuch that\n$$\n\\frac{\\partial \\Sigma}{\\partial t} = \\frac{3}{r}\\,\\frac{\\partial F}{\\partial r}.\n$$\n- Use zero-torque (no-flux) boundary conditions, i.e., set $\\,F=0\\,$ at both domain boundaries.\n- Employ a stable explicit time integrator. For stability, use the time step constraint\n$$\n\\Delta t \\le C\\,\\frac{\\Delta r^2}{3\\,\\nu},\n$$\nwith $\\,C=0.2\\,$, where $\\,\\Delta r\\,$ is the uniform radial spacing.\n\nInitial condition:\n- Construct an initially uniform rotating ring centered at $\\,r_0=1\\,$ with half-width $\\,w\\,$. Let $\\,\\Sigma(r,0)=\\Sigma_0\\,$ for $\\,r\\in[r_0-w,\\,r_0+w]\\,$ and $\\,\\Sigma(r,0)=0\\,$ otherwise. Choose $\\,\\Sigma_0\\,$ so that the total ring mass equals $\\,M_{\\rm ring}=1\\,$, i.e.,\n$$\nM_{\\rm ring} = 2\\pi \\int_{r_0-w}^{r_0+w} \\Sigma_0\\, r\\, dr = 1,\n$$\nwhich fixes $\\,\\Sigma_0\\,$ uniquely given $\\,w\\,$.\n\nComputables:\n- The total angular momentum inside $\\,r\\le r_0\\,$ is\n$$\nJ_{\\rm in}(t) = \\int_{r_{\\min}}^{r_0} 2\\pi\\,r\\,\\Sigma(r,t)\\,\\ell(r)\\,dr\n= \\int_{r_{\\min}}^{r_0} 2\\pi\\,\\Sigma(r,t)\\,r^{3/2}\\,dr,\n$$\nusing $\\,G=M=1\\,$ so $\\,\\Omega(r)=r^{-3/2}\\,$ and $\\,\\ell(r)=\\sqrt{r}\\,$.\n- The measured transport rate across $\\,r_0\\,$ is\n$$\n\\dot{J}_{\\rm meas} \\approx \\frac{J_{\\rm in}(t_{\\rm end}) - J_{\\rm in}(0)}{t_{\\rm end}}.\n$$\n- The continuum predicted viscous flux at $\\,r_0\\,$ (using the evolved $\\,\\Sigma(r_0,t_{\\rm end})\\,$) is\n$$\n\\dot{J}_{\\rm pred} = F_J(r_0,t_{\\rm end}) = -\\,2\\pi\\,r_0^3\\,\\nu\\,\\Sigma(r_0,t_{\\rm end})\\,\\frac{d\\Omega}{dr}\\bigg|_{r_0}\n= 3\\pi\\,\\nu\\,\\Sigma(r_0,t_{\\rm end})\\,r_0^2\\,\\Omega(r_0).\n$$\n- The absolute error for a case is\n$$\ne = \\big|\\dot{J}_{\\rm meas} - \\dot{J}_{\\rm pred}\\big|.\n$$\n\nUnits:\n- Use dimensionless units with $\\,G=1\\,$ and $\\,M=1\\,$, length in units of $\\,r_0\\,$, time in units consistent with $\\,\\Omega(r)=r^{-3/2}\\,$, and mass normalized so $\\,M_{\\rm ring}=1\\,$. All outputs should be dimensionless floats.\n\nTest suite:\n- Domain: $\\,r_{\\min}=0.5\\,$, $\\,r_{\\max}=1.5\\,$, $\\,r_0=1\\,$, viscosity $\\,\\nu=10^{-3}\\,$, final time $\\,t_{\\rm end}=10^{-2}\\,$.\n- Cases to run:\n  1. Happy path resolution $\\,N=128\\,$, ring half-width $\\,w=0.1\\,$.\n  2. Higher resolution $\\,N=256\\,$, same $\\,w=0.1\\,$.\n  3. Highest resolution $\\,N=512\\,$, same $\\,w=0.1\\,$.\n  4. Boundary/coarse resolution $\\,N=64\\,$, same $\\,w=0.1\\,$.\n  5. Edge/narrow ring $\\,N=512\\,$, $\\,w=0.05\\,$.\n- Convergence assessment for the $\\,w=0.1\\,$ suite: compute the observed order\n$$\np \\approx \\frac{\\ln(e_{128}/e_{512})}{\\ln(\\Delta r_{128}/\\Delta r_{512})},\n$$\noptionally averaged over adjacent pairs $\\,\\{128,256\\}$ and $\\,\\{256,512\\}$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the following dimensionless floats, as a comma-separated list enclosed in square brackets:\n  1. $\\,e_{64}\\,$ for $\\,N=64,\\,w=0.1\\,$,\n  2. $\\,e_{128}\\,$ for $\\,N=128,\\,w=0.1\\,$,\n  3. $\\,e_{256}\\,$ for $\\,N=256,\\,w=0.1\\,$,\n  4. $\\,e_{512}\\,$ for $\\,N=512,\\,w=0.1\\,$,\n  5. the observed convergence order $\\,p\\,$ for the $\\,w=0.1\\,$ cases,\n  6. the ratio $\\,\\dot{J}_{\\rm meas}/\\dot{J}_{\\rm pred}\\,$ for the narrow ring case $\\,N=512,\\,w=0.05\\,$.\n- The output must look exactly like\n$$\n[\\text{e64},\\text{e128},\\text{e256},\\text{e512},\\text{p},\\text{ratio\\_narrow}],\n$$\nwith numerical values replacing the placeholders, rounded by the default string conversion of your programming language.\n\nYour submission must be a complete, runnable program that performs these computations and prints the single-line output in the exact format specified above.", "solution": "The problem statement has been critically validated and is deemed a valid, scientifically grounded, and well-posed computational astrophysics problem. It outlines a standard numerical experiment for verifying a solver for the viscous diffusion equation in thin accretion disks. All provided equations, constants, and boundary conditions are consistent with established theory and form a complete set of specifications for a solvable problem.\n\nThe solution involves designing and implementing a numerical solver for the specified partial differential equation and using it to compute the required physical and error metrics. The methodology is detailed below.\n\n**1. Governing Equation**\nThe evolution of the disk's surface density, $\\Sigma(r,t)$, is governed by the thin-disk equation under viscous transport:\n$$\n\\frac{\\partial \\Sigma}{\\partial t} = \\frac{3}{r}\\,\\frac{\\partial}{\\partial r}\\!\\left(r^{1/2}\\,\\frac{\\partial}{\\partial r}\\big(\\nu\\,\\Sigma\\,r^{1/2}\\big)\\right)\n$$\nThis equation can be written in a conservative flux form as specified, $\\frac{\\partial \\Sigma}{\\partial t} = \\frac{3}{r}\\frac{\\partial F}{\\partial r}$, where the flux is $F(r,t) = r^{1/2}\\,\\frac{\\partial}{\\partial r}\\big(\\nu\\,\\Sigma\\,r^{1/2}\\big)$.\n\n**2. Numerical Discretization**\nA finite-difference method on a uniform staggered grid is employed to solve the equation.\n\n**2.1. Spatial Grid**\nThe radial domain $r \\in [r_{\\min}, r_{\\max}]$ is discretized into $N$ cells of uniform width $\\Delta r = (r_{\\max}-r_{\\min})/N$.\n- The cell interfaces are located at positions $r_j = r_{\\min} + j \\Delta r$ for $j=0, 1, \\ldots, N$.\n- The cell centers are at $r_{j+1/2} = (r_j+r_{j+1})/2$ for $j=0, 1, \\ldots, N-1$.\nThe surface density, $\\Sigma$, is a cell-centered quantity, defined at $r_{j+1/2}$ and denoted by $\\Sigma_{j+1/2}$.\n\n**2.2. Finite-Difference Scheme**\nThe time derivative of $\\Sigma$ at each cell center is discretized as:\n$$\n\\frac{d\\Sigma_{j+1/2}}{dt} = \\frac{3}{r_{j+1/2}} \\frac{F_{j+1} - F_j}{\\Delta r}\n$$\nwhere $F_j$ is the numerical flux evaluated at the interface $r_j$. The flux $F(r,t)$ involves a spatial derivative, which is also discretized using a second-order centered difference. Let $V(r,t) = \\nu\\Sigma r^{1/2}$. $V$ is evaluated at cell centers as $V_{j+1/2} = \\nu \\Sigma_{j+1/2} r_{j+1/2}^{1/2}$. The flux at an interior interface $r_j$ (for $j=1, \\ldots, N-1$) is then:\n$$\nF_j = r_j^{1/2} \\left[ \\frac{\\partial V}{\\partial r} \\right]_{r_j} \\approx r_j^{1/2} \\frac{V_{j+1/2} - V_{j-1/2}}{\\Delta r} = r_j^{1/2} \\frac{\\nu (\\Sigma_{j+1/2} r_{j+1/2}^{1/2} - \\Sigma_{j-1/2} r_{j-1/2}^{1/2})}{\\Delta r}\n$$\nThis scheme is conservative and second-order accurate in space.\n\n**2.3. Boundary Conditions**\nThe problem specifies zero-torque (no-flux) boundary conditions at $r_{\\min}$ and $r_{\\max}$. This is implemented by setting the fluxes at the domain boundaries to zero:\n$$\nF_0 = 0 \\quad \\text{and} \\quad F_N = 0\n$$\n\n**3. Time Integration**\nThe system of ordinary differential equations for $\\Sigma_{j+1/2}$ is integrated forward in time using an explicit forward Euler method:\n$$\n\\Sigma_{j+1/2}^{n+1} = \\Sigma_{j+1/2}^{n} + \\Delta t \\left[ \\frac{d\\Sigma_{j+1/2}}{dt} \\right]^n\n$$\nwhere the superscript $n$ denotes the time step. For stability of this explicit scheme, the time step $\\Delta t$ is constrained by the Courant-Friedrichs-Lewy (CFL) condition for a diffusion equation:\n$$\n\\Delta t \\le C\\,\\frac{\\Delta r^2}{3\\,\\nu}\n$$\nThe problem provides a safety factor $C=0.2$. The total number of steps is calculated to reach the final time $t_{\\rm end}$, and $\\Delta t$ is adjusted slightly to ensure the final step lands exactly at $t_{\\rm end}$.\n\n**4. Initial Conditions**\nThe initial condition is a ring of uniform surface density $\\Sigma_0$ and half-width $w$ centered at $r_0=1$. The value of $\\Sigma_0$ is determined by normalizing the total ring mass to $M_{\\rm ring}=1$:\n$$\nM_{\\rm ring} = 2\\pi \\int_{r_0-w}^{r_0+w} \\Sigma_0 r dr = 4\\pi r_0 w \\Sigma_0 = 1 \\implies \\Sigma_0 = \\frac{1}{4\\pi r_0 w}\n$$\nFor each cell center $r_{j+1/2}$, the initial surface density $\\Sigma_{j+1/2}(0)$ is set to $\\Sigma_0$ if $r_0-w \\le r_{j+1/2} \\le r_0+w$, and to $0$ otherwise.\n\n**5. Computation of Observables**\nAll quantities are computed in dimensionless units where $G=M=1$.\n\n- **Initial and Final Angular Momentum ($J_{\\rm in}$):** The total angular momentum in the inner part of the disk ($r \\le r_0$) is computed via numerical integration using a midpoint rule (summation over cells):\n$$\nJ_{\\rm in}(t) = \\int_{r_{\\min}}^{r_0} 2\\pi\\Sigma(r,t)r^{3/2}dr \\approx \\sum_{j=0}^{k-1} 2\\pi \\Sigma_{j+1/2}(t) r_{j+1/2}^{3/2} \\Delta r\n$$\nwhere the index $k$ is such that $r_k = r_0$. This is computed for both the initial state ($t=0$) and the final state ($t=t_{\\rm end}$).\n\n- **Measured Transport Rate ($\\dot{J}_{\\rm meas}$):** This is the time-averaged rate of change of angular momentum in the inner disk:\n$$\n\\dot{J}_{\\rm meas} = \\frac{J_{\\rm in}(t_{\\rm end}) - J_{\\rm in}(0)}{t_{\\rm end}}\n$$\n\n- **Predicted Transport Rate ($\\dot{J}_{\\rm pred}$):** This is the theoretical instantaneous viscous flux across the boundary at $r=r_0$ at the final time:\n$$\n\\dot{J}_{\\rm pred} = F_J(r_0, t_{\\rm end}) = 3\\pi\\nu\\Sigma(r_0, t_{\\rm end})r_0^{1/2}\n$$\nSince $r_0=1$, this simplifies to $3\\pi\\nu\\Sigma(1, t_{\\rm end})$. The value of $\\Sigma(1, t_{\\rm end})$ is obtained by linearly interpolating the values from the two adjacent cell centers.\n\n- **Error and Convergence:** The absolute error $e = |\\dot{J}_{\\rm meas} - \\dot{J}_{\\rm pred}|$ quantifies the consistency of the simulation. The order of convergence, $p$, is calculated by averaging the rates determined from pairs of successive mesh refinements:\n$$\np_1 = \\frac{\\ln(e_{128}/e_{256})}{\\ln(2)}, \\quad p_2 = \\frac{\\ln(e_{256}/e_{512})}{\\ln(2)}, \\quad p = \\frac{p_1+p_2}{2}\n$$\nThis provides a robust measure of the numerical scheme's accuracy. A second-order scheme is expected to yield $p \\approx 2$.\n\nThe last computable is the ratio $\\dot{J}_{\\rm meas}/\\dot{J}_{\\rm pred}$ for the narrow ring case. The entire procedure is encapsulated in a Python program to run the specified test suite and produce the required output.", "answer": "```python\nimport numpy as np\n\ndef run_simulation(N, w, r_min=0.5, r_max=1.5, r_0=1.0, nu=1e-3, t_end=1e-2):\n    \"\"\"\n    Performs one simulation of the accretion disk evolution.\n\n    Args:\n        N (int): Number of radial grid cells.\n        w (float): Half-width of the initial ring.\n        r_min (float): Inner radius of the domain.\n        r_max (float): Outer radius of the domain.\n        r_0 (float): Center of the initial ring.\n        nu (float): Kinematic viscosity.\n        t_end (float): Final time of the simulation.\n\n    Returns:\n        tuple: A tuple containing (J_dot_meas, J_dot_pred).\n    \"\"\"\n    # Grid setup\n    dr = (r_max - r_min) / N\n    r_interfaces = np.linspace(r_min, r_max, N + 1)\n    r_centers = (r_interfaces[:-1] + r_interfaces[1:]) / 2.0\n\n    # Time step from stability criterion\n    C = 0.2\n    dt_stable = C * dr**2 / (3.0 * nu)\n    num_steps = int(np.ceil(t_end / dt_stable))\n    dt = t_end / num_steps\n\n    # Initial condition\n    sigma_0_const = 1.0 / (4.0 * np.pi * r_0 * w)\n    sigma = np.zeros(N)\n    mask = (r_centers = r_0 - w)  (r_centers = r_0 + w)\n    sigma[mask] = sigma_0_const\n\n    # Calculate initial angular momentum in the inner disk (r = r_0)\n    # The interface at r_0 is at index k\n    k = int(round((r_0 - r_min) / dr))\n    # Integration is over cells from 0 to k-1\n    J_in_initial = np.sum(2.0 * np.pi * sigma[:k] * r_centers[:k]**1.5 * dr)\n\n    # Time evolution loop\n    for _ in range(num_steps):\n        # Calculate intermediate variable V = nu * Sigma * r^1/2 at cell centers\n        V_centers = nu * sigma * r_centers**0.5\n\n        # Calculate fluxes at interior interfaces\n        # F_j = r_j^1/2 * (V_{j+1/2} - V_{j-1/2}) / dr\n        F_internal = r_interfaces[1:-1]**0.5 * (V_centers[1:] - V_centers[:-1]) / dr\n        \n        # Flux array with boundary conditions F=0\n        F = np.zeros(N + 1)\n        F[1:-1] = F_internal\n\n        # Calculate time derivative of Sigma\n        dsigma_dt = (3.0 / r_centers) * (F[1:] - F[:-1]) / dr\n\n        # Update Sigma using Forward Euler\n        sigma += dt * dsigma_dt\n\n    # Calculate final quantities\n    # Final angular momentum in the inner disk\n    J_in_final = np.sum(2.0 * np.pi * sigma[:k] * r_centers[:k]**1.5 * dr)\n\n    # Measured average transport rate\n    J_dot_meas = (J_in_final - J_in_initial) / t_end\n\n    # Predicted instantaneous transport rate at t_end\n    # Interpolate Sigma at r_0 (interface k)\n    sigma_at_r0 = (sigma[k - 1] + sigma[k]) / 2.0\n    # J_dot_pred = 3 * pi * nu * Sigma(r_0) * r_0^1/2. With r_0=1.\n    J_dot_pred = 3.0 * np.pi * nu * sigma_at_r0\n\n    return J_dot_meas, J_dot_pred\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases_w01 = [\n        (64, 0.1),\n        (128, 0.1),\n        (256, 0.1),\n        (512, 0.1),\n    ]\n\n    test_case_narrow = (512, 0.05)\n\n    errors = {}\n    for N, w in test_cases_w01:\n        J_dot_meas, J_dot_pred = run_simulation(N, w)\n        error = np.abs(J_dot_meas - J_dot_pred)\n        errors[N] = error\n\n    e64 = errors[64]\n    e128 = errors[128]\n    e256 = errors[256]\n    e512 = errors[512]\n\n    # Calculate convergence order p, averaged over adjacent pairs\n    # p = ln(error_ratio) / ln(resolution_ratio)\n    # Resolution ratio for successive doublings is 2.\n    if e128  0 and e256  0 and e512  0:\n        p1 = np.log(e128 / e256) / np.log(2)\n        p2 = np.log(e256 / e512) / np.log(2)\n        p = (p1 + p2) / 2.0\n    else:\n        p = np.nan # Avoid division by zero if errors are zero\n\n    # Run the narrow ring case\n    J_dot_meas_narrow, J_dot_pred_narrow = run_simulation(*test_case_narrow)\n    if J_dot_pred_narrow != 0:\n        ratio_narrow = J_dot_meas_narrow / J_dot_pred_narrow\n    else:\n        ratio_narrow = np.nan # Avoid division by zero\n\n    # Format and print the final output\n    results = [e64, e128, e256, e512, p, ratio_narrow]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3517585"}]}