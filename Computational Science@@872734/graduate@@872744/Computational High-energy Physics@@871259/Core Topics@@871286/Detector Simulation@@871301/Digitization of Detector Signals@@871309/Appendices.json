{"hands_on_practices": [{"introduction": "The journey from a continuous detector signal to a discrete digital number begins with capturing the analog voltage at a precise moment. This practice explores the sample-and-hold (SH) circuit, a fundamental building block in many data acquisition systems. By analyzing the charging and discharging dynamics of a capacitor, you will derive how sources of amplitude error—incomplete acquisition and voltage droop—fundamentally limit the precision of the digitized value ([@problem_id:3511767]).", "problem": "A sample-and-hold (SH) front end in a computational high-energy physics readout digitizes shaped detector pulses. The SH consists of a sampling capacitor with capacitance $C_{s}$ charged from a source at constant amplitude $v_{0}$ through a series resistance $R_{s}$ during an acquisition (track) interval of duration $t_{a}$. At the end of acquisition, the circuit switches to hold, isolating the capacitor except for an effective leakage resistance $R_{\\text{leak}}$ that causes the held voltage to decay. The analog-to-digital converter (ADC) begins conversion a time $t_{h}$ after the switch to hold. Assume the worst-case that the input steps from $0$ to $v_{0}$ at the start of acquisition, that the dynamics are governed by linear first-order resistor-capacitor differential equations derived from Kirchhoff’s current law, and that the held voltage during hold decays due to leakage according to the same first-order law.\n\nStarting from the first-order resistor-capacitor differential equations\n$$\n\\frac{d v_{c}}{d t}=\\frac{v_{0}-v_{c}}{R_{s} C_{s}} \\quad \\text{(acquisition)}, \n\\qquad \n\\frac{d v_{c}}{d t}=-\\frac{v_{c}}{R_{\\text{leak}} C_{s}} \\quad \\text{(hold)},\n$$\nderive an analytic expression for the maximum allowable hold time $t_{h,\\max}$ such that the amplitude error at the ADC sampling instant obeys\n$$\n\\left|v_{0}-v_{\\text{ADC}}(t_{h})\\right| \\leq \\epsilon\\, v_{0},\n$$\nwhere $v_{\\text{ADC}}(t_{h})$ is the held voltage at time $t_{h}$ into hold, and $0  \\epsilon  1$ is a specified fractional error budget. Then evaluate $t_{h,\\max}$ numerically for the parameter set\n$$\nR_{s}=1.0\\times 10^{3}\\ \\text{Ω},\\quad C_{s}=50\\times 10^{-12}\\ \\text{F},\\quad R_{\\text{leak}}=1.0\\times 10^{8}\\ \\text{Ω},\\quad t_{a}=400\\times 10^{-9}\\ \\text{s},\\quad \\epsilon=0.010.\n$$\nExpress the final answer for $t_{h,\\max}$ in microseconds. Round your answer to four significant figures.", "solution": "The problem asks for the maximum allowable hold time, $t_{h,\\max}$, for a sample-and-hold circuit, and its numerical value for a given set of parameters. The solution involves solving two first-order linear ordinary differential equations sequentially and then applying an error constraint.\n\nThe process is divided into three stages:\n1.  **Acquisition phase:** A capacitor with capacitance $C_s$ is charged towards a voltage $v_0$ through a resistor $R_s$. This phase lasts for a duration $t_a$.\n2.  **Hold phase:** The capacitor is isolated and slowly discharges through a large leakage resistance $R_{\\text{leak}}$.\n3.  **ADC conversion:** The analog-to-digital converter measures the capacitor voltage at a time $t_h$ into the hold phase.\n\nWe start by analyzing the acquisition phase. The governing differential equation is:\n$$\n\\frac{d v_{c}}{d t}=\\frac{v_{0}-v_{c}}{R_{s} C_{s}}\n$$\nWe define the charging time constant as $\\tau_s = R_s C_s$. The equation can be rewritten as:\n$$\n\\frac{d v_{c}}{d t} + \\frac{1}{\\tau_s} v_c = \\frac{v_0}{\\tau_s}\n$$\nThis is a standard first-order linear inhomogeneous differential equation. The general solution is the sum of the homogeneous solution, $A \\exp(-t/\\tau_s)$, and a particular solution, which is $v_0$ by inspection.\n$$\nv_c(t) = v_0 + A \\exp\\left(-\\frac{t}{\\tau_s}\\right)\n$$\nThe problem states that the input steps from $0$ to $v_0$ at the start of acquisition, which implies the initial condition $v_c(0) = 0$. We use this to find the constant $A$:\n$$\n0 = v_0 + A \\exp(0) \\implies A = -v_0\n$$\nThus, the voltage across the capacitor during the acquisition phase is:\n$$\nv_c(t) = v_0 \\left(1 - \\exp\\left(-\\frac{t}{\\tau_s}\\right)\\right)\n$$\nAt the end of the acquisition interval $t_a$, the voltage on the capacitor is:\n$$\nv_c(t_a) = v_0 \\left(1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)\\right)\n$$\nThis voltage serves as the initial condition for the subsequent hold phase. Let us denote this voltage as $v_{\\text{hold},0} = v_c(t_a)$.\n\nNext, we analyze the hold phase. The governing differential equation is:\n$$\n\\frac{d v_{c}}{d t}=-\\frac{v_{c}}{R_{\\text{leak}} C_{s}}\n$$\nWe define the leakage time constant as $\\tau_{\\text{leak}} = R_{\\text{leak}} C_s$. The equation becomes:\n$$\n\\frac{d v_{c}}{d t} = -\\frac{1}{\\tau_{\\text{leak}}} v_c\n$$\nThis is a first-order homogeneous differential equation. Let's measure time from the beginning of the hold phase. The solution is of the form:\n$$\nv_c(t) = B \\exp\\left(-\\frac{t}{\\tau_{\\text{leak}}}\\right)\n$$\nThe initial condition for this phase is $v_c(0) = v_{\\text{hold},0} = v_c(t_a)$. So, $B=v_c(t_a)$, and the voltage during the hold phase is:\n$$\nv_c(t) = v_c(t_a) \\exp\\left(-\\frac{t}{\\tau_{\\text{leak}}}\\right)\n$$\nThe ADC samples this voltage at time $t_h$ into the hold. So, $v_{\\text{ADC}}(t_h)$ is:\n$$\nv_{\\text{ADC}}(t_h) = v_c(t_a) \\exp\\left(-\\frac{t_h}{\\tau_{\\text{leak}}}\\right) = v_0 \\left(1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)\\right) \\exp\\left(-\\frac{t_h}{\\tau_{\\text{leak}}}\\right)\n$$\nThe problem specifies an error condition:\n$$\n\\left|v_{0}-v_{\\text{ADC}}(t_{h})\\right| \\leq \\epsilon\\, v_{0}\n$$\nSince the capacitor charges towards $v_0$ from below, $v_c(t_a)  v_0$. During the hold phase, the voltage only decays further. Therefore, $v_{\\text{ADC}}(t_h) \\leq v_c(t_a)  v_0$, which means the term $v_0 - v_{\\text{ADC}}(t_h)$ is always positive. We can drop the absolute value:\n$$\nv_{0}-v_{\\text{ADC}}(t_{h}) \\leq \\epsilon\\, v_{0}\n$$\nSubstituting the expression for $v_{\\text{ADC}}(t_h)$:\n$$\nv_0 - v_0 \\left(1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)\\right) \\exp\\left(-\\frac{t_h}{\\tau_{\\text{leak}}}\\right) \\leq \\epsilon v_0\n$$\nDividing by $v_0$ (which is a positive amplitude):\n$$\n1 - \\left(1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)\\right) \\exp\\left(-\\frac{t_h}{\\tau_{\\text{leak}}}\\right) \\leq \\epsilon\n$$\nWe rearrange the inequality to solve for $t_h$:\n$$\n1 - \\epsilon \\leq \\left(1 - \\exp\\left(-\\fract_a}{\\tau_s}\\right)\\right) \\exp\\left(-\\frac{t_h}{\\tau_{\\text{leak}}}\\right)\n$$\n$$\n\\exp\\left(-\\frac{t_h}{\\tau_{\\text{leak}}}\\right) \\geq \\frac{1-\\epsilon}{1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)}\n$$\nTaking the natural logarithm of both sides:\n$$\n-\\frac{t_h}{\\tau_{\\text{leak}}} \\geq \\ln\\left(\\frac{1-\\epsilon}{1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)}\\right)\n$$\nMultiplying by $-\\tau_{\\text{leak}}$ (a positive quantity) reverses the inequality sign:\n$$\nt_h \\leq -\\tau_{\\text{leak}} \\ln\\left(\\frac{1-\\epsilon}{1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)}\\right)\n$$\nUsing the logarithm property $-\\ln(x/y) = \\ln(y/x)$:\n$$\nt_h \\leq \\tau_{\\text{leak}} \\ln\\left(\\frac{1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)}{1-\\epsilon}\\right)\n$$\nThe maximum allowable hold time, $t_{h,\\max}$, corresponds to the equality:\n$$\nt_{h,\\max} = \\tau_{\\text{leak}} \\ln\\left(\\frac{1 - \\exp\\left(-\\frac{t_a}{\\tau_s}\\right)}{1-\\epsilon}\\right) = R_{\\text{leak}} C_s \\ln\\left(\\frac{1 - \\exp\\left(-\\frac{t_a}{R_s C_s}\\right)}{1-\\epsilon}\\right)\n$$\nThis is the required analytic expression.\n\nNow, we evaluate $t_{h,\\max}$ for the given numerical values:\n$R_{s}=1.0\\times 10^{3}\\ \\Omega$\n$C_{s}=50\\times 10^{-12}\\ \\text{F}$\n$R_{\\text{leak}}=1.0\\times 10^{8}\\ \\Omega$\n$t_{a}=400\\times 10^{-9}\\ \\text{s}$\n$\\epsilon=0.010$\n\nFirst, calculate the time constants:\nThe charging time constant is $\\tau_s = R_s C_s = (1.0 \\times 10^3\\ \\Omega) \\times (50 \\times 10^{-12}\\ \\text{F}) = 50 \\times 10^{-9}\\ \\text{s}$.\nThe leakage time constant is $\\tau_{\\text{leak}} = R_{\\text{leak}} C_s = (1.0 \\times 10^8\\ \\Omega) \\times (50 \\times 10^{-12}\\ \\text{F}) = 5.0 \\times 10^{-3}\\ \\text{s}$.\n\nNext, calculate the exponent's argument for the acquisition phase:\n$$\n\\frac{t_a}{\\tau_s} = \\frac{400 \\times 10^{-9}\\ \\text{s}}{50 \\times 10^{-9}\\ \\text{s}} = 8\n$$\nSubstitute these values into the expression for $t_{h,\\max}$:\n$$\nt_{h,\\max} = (5.0 \\times 10^{-3}\\ \\text{s}) \\times \\ln\\left(\\frac{1 - \\exp(-8)}{1-0.010}\\right)\n$$\n$$\nt_{h,\\max} = (5.0 \\times 10^{-3}) \\times \\ln\\left(\\frac{1 - \\exp(-8)}{0.99}\\right)\n$$\nNow, we compute the numerical value:\n$1 - \\exp(-8) \\approx 1 - 0.0003354626 = 0.9996645374$\n$$\n\\frac{0.9996645374}{0.99} \\approx 1.009762159\n$$\n$$\n\\ln(1.009762159) \\approx 0.009714710\n$$\n$$\nt_{h,\\max} \\approx (5.0 \\times 10^{-3}) \\times 0.009714710 \\approx 4.857355 \\times 10^{-5}\\ \\text{s}\n$$\nThe problem requires the answer in microseconds ($\\mu\\text{s}$). $1\\ \\mu\\text{s} = 10^{-6}\\ \\text{s}$.\n$$\nt_{h,\\max} \\approx 48.57355\\ \\mu\\text{s}\n$$\nRounding to four significant figures, we get:\n$$\nt_{h,\\max} \\approx 48.57\\ \\mu\\text{s}\n$$", "answer": "$$\n\\boxed{48.57}\n$$", "id": "3511767"}, {"introduction": "In high-energy physics, determining *when* a particle interaction occurred is often as critical as measuring its energy. This exercise delves into the core of high-precision timing by comparing two classic architectures: the leading-edge discriminator (LED) and the constant-fraction discriminator (CFD). Starting from first principles, you will analyze how electronic noise and signal slew rate limit timing precision and derive the total time resolution by combining multiple independent jitter sources ([@problem_id:3511856]).", "problem": "A fast silicon sensor in a collider detector produces current pulses that, after front-end amplification with a single-pole response, appear at the discriminator input as voltage pulses modeled by $v(t) = A \\bigl(1 - \\exp(-(t - t_{0})/\\tau_{r})\\bigr) u(t - t_{0})$, where $A$ is the pulse amplitude, $\\tau_{r}$ is the rise time constant, $t_{0}$ is the true arrival time, and $u(\\cdot)$ is the unit step. The front-end contributes additive, stationary, zero-mean Gaussian electronic noise with root-mean-square (RMS) $\\sigma_{n}$ referred to the discriminator input. Two timing architectures are considered: a Leading-Edge Discriminator (LED) with a fixed threshold $V_{\\mathrm{th}}$, and a Constant-Fraction Discriminator (CFD) implemented as a subtraction of a delayed and scaled copy, $v_{\\mathrm{CFD}}(t) = v(t) - f\\,v(t - \\Delta)$, followed by a zero-crossing comparator. Assume the noise at the inputs of the CFD subtraction is uncorrelated and has the same RMS $\\sigma_{n}$ in each branch. The comparator in either architecture exhibits intrinsic timing jitter with RMS $\\sigma_{\\mathrm{disc}}$ that is independent of the input slew rate, and the Time-to-Digital Converter (TDC) sampling clock contributes independent RMS jitter $\\sigma_{\\mathrm{clk}}$. All jitters are zero-mean Gaussian and mutually independent.\n\nStarting from first principles that connect a time pickoff defined by an implicit crossing condition to the effect of a small additive voltage perturbation on the inferred time, and using only core definitions and linearization, derive a general expression for the overall time resolution $\\sigma_{t}$ that combines the contributions of additive electronic noise, comparator intrinsic jitter, and TDC clock jitter for:\n- the LED, which defines $t_{\\ast}$ by $v(t_{\\ast}) = V_{\\mathrm{th}}$, and\n- the CFD, which defines $t_{\\ast}$ by $v_{\\mathrm{CFD}}(t_{\\ast}) = 0$.\n\nFor the CFD, specialize your derivation to the given rising-exponential pulse and show explicitly how the effective slew rate and effective RMS noise at the zero-crossing depend on the fraction $f$ and the delay $\\Delta$, and identify any constraint on $\\Delta$ required for a valid zero crossing on the rising edge. Then, for the numerical parameter set\n- $\\tau_{r} = 250\\,\\mathrm{ps}$,\n- $A = 20\\,\\mathrm{mV}$,\n- $\\sigma_{n} = 0.5\\,\\mathrm{mV}$,\n- $V_{\\mathrm{th}} = 5\\,\\mathrm{mV}$,\n- $f = 0.2$,\n- $\\Delta = 200\\,\\mathrm{ps}$,\n- $\\sigma_{\\mathrm{disc}} = 5\\,\\mathrm{ps}$,\n- $\\sigma_{\\mathrm{clk}} = 12\\,\\mathrm{ps}$,\n\ncompute the total time resolution $\\sigma_{t}$ for both LED and CFD. Round your final numerical results to four significant figures and express $\\sigma_{t}$ in picoseconds.", "solution": "The problem is well-posed, scientifically grounded, and contains all necessary information to derive the requested time resolutions. We will proceed with the solution.\n\nThe fundamental principle connecting a small voltage perturbation (noise) $\\delta v$ to a small timing error (jitter) $\\delta t$ is derived by linearizing the signal $v(t)$ around the timing pickoff point $t_{\\ast}$. Let the pickoff time $t_{\\ast}$ be defined by an implicit condition $F(v(t_{\\ast})) = C$, where $C$ is a constant. In the presence of a small additive noise voltage $n(t)$, the condition is met at a slightly different time $t_{\\ast} + \\delta t$, so $F(v(t_{\\ast} + \\delta t) + n(t_{\\ast})) = C$.\n\nFor a simple threshold crossing, like in a Leading-Edge Discriminator (LED), the condition is $v(t_{\\ast}) = V_{\\mathrm{th}}$. With noise, this becomes $v(t_{\\ast} + \\delta t) + n(t_{\\ast}) = V_{\\mathrm{th}}$. Taylor expanding $v(t)$ around $t_{\\ast}$ to first order gives $v(t_{\\ast} + \\delta t) \\approx v(t_{\\ast}) + \\frac{dv}{dt}\\big|_{t_{\\ast}} \\delta t$. Substituting this and the original condition $v(t_{\\ast}) = V_{\\mathrm{th}}$ into the perturbed equation, we get $V_{\\mathrm{th}} + \\frac{dv}{dt}\\big|_{t_{\\ast}} \\delta t + n(t_{\\ast}) \\approx V_{\\mathrm{th}}$. This simplifies to $\\delta t \\approx - \\frac{n(t_{\\ast})}{\\frac{dv}{dt}\\big|_{t_{\\ast}}}$.\n\nThe variance of the timing jitter, $\\sigma_{t, \\text{noise}}^2$, is the expectation value of $(\\delta t)^2$. Since the noise $n(t)$ is a stationary zero-mean process with RMS value $\\sigma_n$, we have $\\mathbb{E}[n(t_{\\ast})^2] = \\sigma_n^2$. Therefore, the jitter contribution from electronic noise is given by\n$$\n\\sigma_{t, \\text{noise}}^2 = \\mathbb{E}[(\\delta t)^2] = \\frac{\\mathbb{E}[n(t_{\\ast})^2]}{\\left(\\frac{dv}{dt}\\big|_{t_{\\ast}}\\right)^2} = \\left(\\frac{\\sigma_n}{\\frac{dv}{dt}\\big|_{t_{\\ast}}}\\right)^2\n$$\nThe term $\\frac{dv}{dt}\\big|_{t_{\\ast}}$ is the slew rate of the signal at the crossing time. The same principle applies to more complex timing signals, such as in a Constant-Fraction Discriminator (CFD), by using the effective slew rate and effective noise of the timing signal at its zero-crossing.\n\nThe total time resolution $\\sigma_t$ is the quadratic sum of all independent jitter sources. The problem specifies three such sources: electronic noise ($\\sigma_{t, \\text{noise}}$), intrinsic discriminator jitter ($\\sigma_{\\mathrm{disc}}$), and TDC clock jitter ($\\sigma_{\\mathrm{clk}}$). Thus, the total time resolution is:\n$$\n\\sigma_t = \\sqrt{\\sigma_{t, \\text{noise}}^2 + \\sigma_{\\mathrm{disc}}^2 + \\sigma_{\\mathrm{clk}}^2}\n$$\n\nWe now apply this framework to the LED and CFD architectures. The voltage pulse is given by $v(t) = A \\bigl(1 - \\exp(-(t - t_{0})/\\tau_{r})\\bigr) u(t - t_{0})$, where we can set $t_0=0$ without loss of generality for the calculation.\n\n**1. Leading-Edge Discriminator (LED)**\n\nFor the LED, the timing pickoff $t_{\\ast}$ is defined by $v(t_{\\ast}) = V_{\\mathrm{th}}$.\n$$\nA \\bigl(1 - \\exp(-t_{\\ast}/\\tau_{r})\\bigr) = V_{\\mathrm{th}} \\implies \\exp(-t_{\\ast}/\\tau_{r}) = 1 - \\frac{V_{\\mathrm{th}}}{A} = \\frac{A - V_{\\mathrm{th}}}{A}\n$$\nThe slew rate of the signal is $\\frac{dv}{dt} = \\frac{d}{dt}\\left[A(1-\\exp(-t/\\tau_r))\\right] = \\frac{A}{\\tau_r}\\exp(-t/\\tau_r)$.\nEvaluating the slew rate at the crossing time $t_{\\ast}$:\n$$\n\\frac{dv}{dt}\\bigg|_{t_{\\ast}} = \\frac{A}{\\tau_r}\\exp(-t_{\\ast}/\\tau_r) = \\frac{A}{\\tau_r}\\left(\\frac{A - V_{\\mathrm{th}}}{A}\\right) = \\frac{A - V_{\\mathrm{th}}}{\\tau_r}\n$$\nThe jitter contribution from noise is then:\n$$\n\\sigma_{t, \\text{noise, LED}} = \\frac{\\sigma_n}{\\frac{dv}{dt}\\big|_{t_{\\ast}}} = \\frac{\\sigma_n}{(A - V_{\\mathrm{th}})/\\tau_r} = \\frac{\\sigma_n \\tau_r}{A - V_{\\mathrm{th}}}\n$$\nThe total time resolution for the LED is:\n$$\n\\sigma_{t, \\text{LED}} = \\sqrt{\\left(\\frac{\\sigma_n \\tau_r}{A - V_{\\mathrm{th}}}\\right)^2 + \\sigma_{\\mathrm{disc}}^2 + \\sigma_{\\mathrm{clk}}^2}\n$$\n\n**2. Constant-Fraction Discriminator (CFD)**\n\nThe CFD forms a bipolar signal $v_{\\mathrm{CFD}}(t) = v(t) - f\\,v(t - \\Delta)$, and the timing pickoff $t_{\\ast}$ is at its zero-crossing, $v_{\\mathrm{CFD}}(t_{\\ast}) = 0$. This implies $v(t_{\\ast}) = f\\,v(t_{\\ast} - \\Delta)$.\n\nThe jitter is determined by the effective slew rate of $v_{\\mathrm{CFD}}(t)$ and the effective noise on this signal. The effective slew rate at $t_{\\ast}$ is:\n$$\nS_{\\text{eff}} = \\frac{dv_{\\mathrm{CFD}}}{dt}\\bigg|_{t_{\\ast}} = \\frac{dv}{dt}\\bigg|_{t_{\\ast}} - f \\frac{d v(t - \\Delta)}{dt}\\bigg|_{t_{\\ast}} = \\frac{dv}{dt}\\bigg|_{t_{\\ast}} - f \\frac{dv}{dt}\\bigg|_{t_{\\ast}-\\Delta}\n$$\nThe noise on the CFD signal is $n_{\\mathrm{CFD}}(t) = n_1(t) - f n_2(t)$, where $n_1(t)$ and $n_2(t)$ are the noise contributions from the non-delayed and delayed branches, respectively. The problem states these are uncorrelated and each has RMS $\\sigma_n$. The variance of the effective noise is:\n$$\n\\sigma_{n, \\text{eff}}^2 = \\mathbb{E}[n_{\\mathrm{CFD}}^2] = \\mathbb{E}[(n_1 - fn_2)^2] = \\mathbb{E}[n_1^2] - 2f\\mathbb{E}[n_1 n_2] + f^2\\mathbb{E}[n_2^2] = \\sigma_n^2 + f^2\\sigma_n^2 = (1+f^2)\\sigma_n^2\n$$\nSo, the effective RMS noise is $\\sigma_{n, \\text{eff}} = \\sigma_n \\sqrt{1+f^2}$.\n\nNow, we specialize to the given pulse shape for a more explicit expression of $S_{\\text{eff}}$. The zero-crossing condition is:\n$$\nA(1-\\exp(-t_{\\ast}/\\tau_r)) = f A(1-\\exp(-(t_{\\ast}-\\Delta)/\\tau_r))\n$$\n$$\n1-\\exp(-t_{\\ast}/\\tau_r) = f(1-\\exp(-t_{\\ast}/\\tau_r)\\exp(\\Delta/\\tau_r))\n$$\nLetting $x = \\exp(-t_{\\ast}/\\tau_r)$, we solve for $x$: $1-x = f(1-x\\exp(\\Delta/\\tau_r)) \\implies 1-f = x(1-f\\exp(\\Delta/\\tau_r))$, which gives\n$$\nx = \\exp(-t_{\\ast}/\\tau_r) = \\frac{1-f}{1-f\\exp(\\Delta/\\tau_r)}\n$$\nFor a physically meaningful solution ($t_{\\ast}>0$), we need $0  x  1$. The numerator $1-f$ is positive since $f1$. For the denominator to be positive, we require $1-f\\exp(\\Delta/\\tau_r) > 0$, which yields the constraint on the delay $\\Delta$:\n$$\n\\Delta  \\tau_r \\ln(1/f)\n$$\nThe condition $x1$ is always satisfied for $\\Delta>0$ and $f1$.\n\nThe slew rate terms are:\n$\\frac{dv}{dt}\\big|_{t_{\\ast}} = \\frac{A}{\\tau_r}\\exp(-t_{\\ast}/\\tau_r) = \\frac{A}{\\tau_r} \\frac{1-f}{1-f\\exp(\\Delta/\\tau_r)}$.\n$\\frac{dv}{dt}\\big|_{t_{\\ast}-\\Delta} = \\frac{A}{\\tau_r}\\exp(-(t_{\\ast}-\\Delta)/\\tau_r) = \\frac{A}{\\tau_r}\\exp(-t_{\\ast}/\\tau_r)\\exp(\\Delta/\\tau_r) = \\frac{dv}{dt}\\big|_{t_{\\ast}}\\exp(\\Delta/\\tau_r)$.\n\nThe effective slew rate is thus:\n$$\nS_{\\text{eff}} = \\frac{dv}{dt}\\bigg|_{t_{\\ast}} - f \\left(\\frac{dv}{dt}\\bigg|_{t_{\\ast}}\\exp(\\Delta/\\tau_r)\\right) = \\frac{dv}{dt}\\bigg|_{t_{\\ast}} \\left(1 - f\\exp(\\Delta/\\tau_r)\\right)\n$$\nSubstituting the expression for $\\frac{dv}{dt}\\big|_{t_{\\ast}}$:\n$$\nS_{\\text{eff}} = \\left(\\frac{A}{\\tau_r} \\frac{1-f}{1-f\\exp(\\Delta/\\tau_r)}\\right) \\left(1 - f\\exp(\\Delta/\\tau_r)\\right) = \\frac{A(1-f)}{\\tau_r}\n$$\nThis is the explicit dependence of the effective slew rate. It depends on $f$ but not on $\\Delta$. The effective RMS noise, $\\sigma_{n, \\text{eff}} = \\sigma_n\\sqrt{1+f^2}$, depends on $f$ but not on $\\Delta$.\n\nThe jitter contribution from noise for the CFD is:\n$$\n\\sigma_{t, \\text{noise, CFD}} = \\frac{\\sigma_{n, \\text{eff}}}{S_{\\text{eff}}} = \\frac{\\sigma_n \\sqrt{1+f^2}}{A(1-f)/\\tau_r} = \\frac{\\tau_r \\sigma_n \\sqrt{1+f^2}}{A(1-f)}\n$$\nThe total time resolution for the CFD is:\n$$\n\\sigma_{t, \\text{CFD}} = \\sqrt{\\left(\\frac{\\tau_r \\sigma_n \\sqrt{1+f^2}}{A(1-f)}\\right)^2 + \\sigma_{\\mathrm{disc}}^2 + \\sigma_{\\mathrm{clk}}^2}\n$$\n\n**3. Numerical Calculations**\n\nGiven parameters are:\n$\\tau_{r} = 250\\,\\mathrm{ps}$, $A = 20\\,\\mathrm{mV}$, $\\sigma_{n} = 0.5\\,\\mathrm{mV}$, $V_{\\mathrm{th}} = 5\\,\\mathrm{mV}$, $f = 0.2$, $\\Delta = 200\\,\\mathrm{ps}$, $\\sigma_{\\mathrm{disc}} = 5\\,\\mathrm{ps}$, $\\sigma_{\\mathrm{clk}} = 12\\,\\mathrm{ps}$.\n\n**For the LED:**\nThe noise-induced jitter contribution is:\n$$\n\\sigma_{t, \\text{noise, LED}} = \\frac{(0.5\\,\\mathrm{mV})(250\\,\\mathrm{ps})}{20\\,\\mathrm{mV} - 5\\,\\mathrm{mV}} = \\frac{125}{15}\\,\\mathrm{ps} = \\frac{25}{3}\\,\\mathrm{ps} \\approx 8.333\\,\\mathrm{ps}\n$$\nThe total time resolution is:\n$$\n\\sigma_{t, \\text{LED}} = \\sqrt{\\left(\\frac{25}{3}\\right)^2 + 5^2 + 12^2}\\,\\mathrm{ps} = \\sqrt{\\frac{625}{9} + 25 + 144}\\,\\mathrm{ps} = \\sqrt{69.444\\dots + 169}\\,\\mathrm{ps} = \\sqrt{238.444\\dots}\\,\\mathrm{ps} \\approx 15.4416\\,\\mathrm{ps}\n$$\nRounding to four significant figures, $\\sigma_{t, \\text{LED}} = 15.44\\,\\mathrm{ps}$.\n\n**For the CFD:**\nFirst, we check the constraint on $\\Delta$:\n$$\n\\Delta  \\tau_r \\ln(1/f) \\implies 200\\,\\mathrm{ps}  (250\\,\\mathrm{ps})\\ln(1/0.2) = (250\\,\\mathrm{ps})\\ln(5) \\approx (250\\,\\mathrm{ps})(1.6094) \\approx 402.4\\,\\mathrm{ps}\n$$\nThe condition $200  402.4$ is satisfied.\nThe noise-induced jitter contribution is:\n$$\n\\sigma_{t, \\text{noise, CFD}} = \\frac{(250\\,\\mathrm{ps})(0.5\\,\\mathrm{mV})\\sqrt{1 + 0.2^2}}{(20\\,\\mathrm{mV})(1-0.2)} = \\frac{125\\sqrt{1.04}}{16}\\,\\mathrm{ps} \\approx \\frac{125 \\times 1.0198}{16}\\,\\mathrm{ps} \\approx 7.9672\\,\\mathrm{ps}\n$$\nThe total time resolution is:\n$$\n\\sigma_{t, \\text{CFD}} = \\sqrt{(7.9672\\dots)^2 + 5^2 + 12^2}\\,\\mathrm{ps} = \\sqrt{63.476\\dots + 25 + 144}\\,\\mathrm{ps} = \\sqrt{232.476\\dots}\\,\\mathrm{ps} \\approx 15.2472\\,\\mathrm{ps}\n$$\nRounding to four significant figures, $\\sigma_{t, \\text{CFD}} = 15.25\\,\\mathrm{ps}$.", "answer": "$$\n\\boxed{\\begin{pmatrix} 15.44  15.25 \\end{pmatrix}}\n$$", "id": "3511856"}, {"introduction": "Ultimately, digitization serves the goal of extracting physical observables from detector signals. This advanced practice models a realistic scenario using Silicon Photomultipliers (SiPMs), where detector artifacts like afterpulsing complicate the measurement of energy. You will apply principles of compound Poisson statistics to model the full signal and evaluate how two competing digitization strategies—charge integration versus peak-sensing—impact the final energy resolution ([@problem_id:3511813]).", "problem": "Consider a simplified but scientifically plausible model of Silicon Photomultiplier (SiPM) pulse digitization for energy measurement in the context of high-energy physics instrumentation. A SiPM detects an energy deposition that triggers a random number of primary microcell avalanches, modeled as a Poisson random variable with mean $\\mu$. Each primary microcell avalanche can produce a single afterpulse with probability $r_a$. The afterpulse has amplitude fraction $\\alpha$ of the primary avalanche and an independent delay $t$ drawn from an exponential distribution with rate $1/\\tau_a$ (that is, with probability density $f(t) = \\frac{1}{\\tau_a} e^{-t/\\tau_a}$ for $t \\ge 0$). The front-end electronics are linear and time-invariant, modeled as a single-pole differentiation followed by a single-pole integration (commonly referred to as \"CR-RC shaping\") with shaping time $\\tau_s$, resulting in a shaped pulse that attains its peak at $t_p = \\tau_s$.\n\nTwo digitization strategies are to be compared:\n\n1. Integrating Analog-to-Digital Converter (ADC): This is an ADC that measures total charge by integrating the shaped signal over a fixed time window $T_{\\mathrm{int}}$ starting at the primary pulse time origin. Assume the integrator captures any afterpulse contribution that occurs within the integration window (i.e., any afterpulse with delay $t \\le T_{\\mathrm{int}}$ contributes its fraction $\\alpha$ to the measured charge). The integrator output is modeled as $Q$ with additive electronic noise of variance $\\sigma_Q^2$, independent of the signal.\n\n2. Peak-sensing digitization: This method scans the shaped waveform for its maximum value within a finite acquisition window. Assume the peak value is dominated by the primary pulse near its peak at $t_p = \\tau_s$ and that only afterpulses that occur within a symmetric capture window of width $w$ around $t_p$ superpose onto the primary peak (i.e., afterpulses with delay $t \\in [\\max(0,\\,t_p - w/2),\\,t_p + w/2]$ contribute their fraction $\\alpha$ to the measured peak). The peak output is modeled as $V$ with additive electronic noise of variance $\\sigma_V^2$, independent of the signal.\n\nAssume a unit gain $q_0$ for charge per primary avalanche and a unit gain $a_0$ for peak amplitude per primary avalanche. Treat $q_0$ and $a_0$ as known constants.\n\nStarting from fundamental definitions, compute, for each digitization strategy, the mean and variance of the measured quantity as functions of $\\mu$, $r_a$, $\\alpha$, and the effective capture probabilities implied by the above windows and the exponential afterpulse delay model. From these, derive the energy resolution defined as the relative standard deviation $R = \\frac{\\sqrt{\\mathrm{Var}}}{\\mathrm{E}[\\cdot]}$ for each strategy, expressed as a decimal fraction. Use the following physical unit conventions:\n- Time parameters $\\tau_a$, $\\tau_s$, $T_{\\mathrm{int}}$, and $w$ must be treated in nanoseconds (ns) in your computation.\n- Energy resolution $R$ must be reported as a decimal fraction (e.g., $0.1$), not a percentage.\n\nYour program must implement the derived expressions and produce results for the following test suite. Each test case is specified as a tuple $(\\mu, r_a, \\alpha, \\tau_a, \\tau_s, T_{\\mathrm{int}}, w, q_0, a_0, \\sigma_Q, \\sigma_V)$, where all time parameters are in ns and all non-time parameters are in dimensionless or in arbitrary, consistent signal units:\n\n- Test Case 1 (general \"happy path\"): $(100,\\,0.1,\\,0.5,\\,50,\\,20,\\,200,\\,20,\\,1.0,\\,1.0,\\,2.0,\\,2.0)$.\n- Test Case 2 (boundary, no afterpulsing): $(100,\\,0.0,\\,0.5,\\,50,\\,20,\\,200,\\,20,\\,1.0,\\,1.0,\\,2.0,\\,2.0)$.\n- Test Case 3 (edge case, very short windows): $(100,\\,0.1,\\,0.5,\\,50,\\,20,\\,5,\\,5,\\,1.0,\\,1.0,\\,2.0,\\,2.0)$.\n- Test Case 4 (high afterpulse rate with different parameters): $(60,\\,0.5,\\,0.3,\\,30,\\,15,\\,40,\\,10,\\,1.0,\\,1.0,\\,1.0,\\,1.0)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output two values: first the integrating ADC energy resolution $R_Q$, then the peak-sensing energy resolution $R_V$. Aggregate all test cases in order, resulting in a list of eight decimal numbers: $\\big[ R_{Q,1}, R_{V,1}, R_{Q,2}, R_{V,2}, R_{Q,3}, R_{V,3}, R_{Q,4}, R_{V,4} \\big]$.\n\nImplement the computation using only the stated assumptions and definitions. Do not use any shortcut formulas that are not derived from these bases.", "solution": "The problem is scientifically grounded, well-posed, and contains all necessary information for a unique solution. We can therefore proceed with the derivation.\n\nThe goal is to compute the energy resolution, defined as the relative standard deviation $R = \\sqrt{\\mathrm{Var}[\\cdot]} / \\mathrm{E}[\\cdot]$, for two different signal digitization strategies. The core of the problem lies in modeling the mean and variance of the measured quantity for each strategy. This requires a careful application of probability theory to the stochastic model of the SiPM signal.\n\nLet $N_p$ be the number of primary microcell avalanches, which is a Poisson random variable with mean $\\mu$.\n$$N_p \\sim \\mathrm{Poisson}(\\mu)$$\nThe mean and variance of $N_p$ are $\\mathrm{E}[N_p] = \\mu$ and $\\mathrm{Var}[N_p] = \\mu$.\n\nEach primary avalanche may trigger an afterpulse. The total signal is the sum of contributions from all primary avalanches and their corresponding afterpulses that are captured by the electronics. Let us model the signal contribution from a single primary avalanche. This consists of the primary avalanche's own signal (normalized to $1$) plus a potential contribution from an afterpulse.\n\nAn afterpulse occurs with probability $r_a$. It is captured by the digitization electronics with a certain probability $p$, which depends on the strategy (integrating vs. peak-sensing). The probability that a single primary avalanche produces a *captured* afterpulse is thus $r_{\\mathrm{eff}} = r_a \\cdot p$.\n\nLet $X$ be a Bernoulli random variable where $X=1$ if a primary avalanche generates a captured afterpulse, and $X=0$ otherwise. $P(X=1) = r_{\\mathrm{eff}}$.\nThe signal contribution from one primary avalanche and its potential afterpulse can be modeled as a random variable $Y$. The primary avalanche contributes a signal of $1$ unit. The afterpulse, if it occurs and is captured, contributes an additional signal of fraction $\\alpha$. Thus,\n$$Y = 1 + \\alpha X$$\nThe total signal from all $N_p$ primary avalanches (without electronic noise) is given by $S_{\\mathrm{sig}} = g \\sum_{i=1}^{N_p} Y_i$, where $g$ is the gain constant ($q_0$ or $a_0$) and $Y_i$ are independent, identically distributed random variables, each with the same distribution as $Y$. This is a classic compound Poisson process.\n\nTo find the mean and variance of $S_{\\mathrm{sig}}$, we use the properties of compound Poisson distributions. If $S = \\sum_{i=1}^{N} Z_i$ where $N \\sim \\mathrm{Poisson}(\\lambda)$ and $Z_i$ are i.i.d., then $\\mathrm{E}[S] = \\lambda \\mathrm{E}[Z]$ and $\\mathrm{Var}[S] = \\lambda \\mathrm{E}[Z^2]$.\n\nIn our case, the signal is $S_{\\mathrm{sig}}$, $N$ is $N_p$ with $\\lambda=\\mu$, and $Z_i$ is $g Y_i$. So we need the first two moments of $gY_i$.\nFirst, let's find the moments of $Y$.\nThe mean of $Y$ is:\n$$\\mathrm{E}[Y] = \\mathrm{E}[1 + \\alpha X] = 1 + \\alpha \\mathrm{E}[X] = 1 + \\alpha r_{\\mathrm{eff}}$$\nFor the second moment, we use the property that for a Bernoulli variable, $X^2 = X$:\n$$\\mathrm{E}[Y^2] = \\mathrm{E}[(1 + \\alpha X)^2] = \\mathrm{E}[1 + 2\\alpha X + \\alpha^2 X^2] = 1 + 2\\alpha \\mathrm{E}[X] + \\alpha^2 \\mathrm{E}[X] = 1 + (2\\alpha + \\alpha^2)r_{\\mathrm{eff}}$$\n\nNow we apply the compound Poisson formulas to $S_{\\mathrm{sig}} = \\sum_{i=1}^{N_p} (g Y_i)$:\n$$\\mathrm{E}[S_{\\mathrm{sig}}] = \\mu \\cdot \\mathrm{E}[gY] = g \\mu \\mathrm{E}[Y] = g \\mu (1 + \\alpha r_{\\mathrm{eff}})$$\n$$\\mathrm{Var}[S_{\\mathrm{sig}}] = \\mu \\cdot \\mathrm{E}[(gY)^2] = g^2 \\mu \\mathrm{E}[Y^2] = g^2 \\mu (1 + (2\\alpha + \\alpha^2)r_{\\mathrm{eff}})$$\n\nThe total measured quantity, let's call it $S$, includes additive electronic noise $N_{\\mathrm{elec}}$ with mean $0$ and variance $\\sigma^2$. The signal and noise are independent.\n$$S = S_{\\mathrm{sig}} + N_{\\mathrm{elec}}$$\nThe mean of the total measured signal is:\n$$\\mathrm{E}[S] = \\mathrm{E}[S_{\\mathrm{sig}}] + \\mathrm{E}[N_{\\mathrm{elec}}] = g \\mu (1 + \\alpha r_{\\mathrm{eff}})$$\nThe variance of the total measured signal is:\n$$\\mathrm{Var}[S] = \\mathrm{Var}[S_{\\mathrm{sig}}] + \\mathrm{Var}[N_{\\mathrm{elec}}] = g^2 \\mu (1 + (2\\alpha + \\alpha^2)r_{\\mathrm{eff}}) + \\sigma^2$$\n\nThe only remaining task is to determine the capture probability $p$ for each strategy. The afterpulse delay $t$ follows an exponential distribution with PDF $f(t) = \\frac{1}{\\tau_a} e^{-t/\\tau_a}$. The corresponding cumulative distribution function (CDF) is $F(t) = P(T \\le t) = 1 - e^{-t/\\tau_a}$.\n\nStrategy 1: Integrating ADC (Quantity $Q$)\nThis strategy captures afterpulses with delay $t \\le T_{\\mathrm{int}}$. The capture probability $p_Q$ is therefore:\n$$p_Q = P(t \\le T_{\\mathrm{int}}) = F(T_{\\mathrm{int}}) = 1 - e^{-T_{\\mathrm{int}}/\\tau_a}$$\nThe effective afterpulse rate is $r_{\\mathrm{eff}, Q} = r_a \\cdot p_Q$. The gain is $g=q_0$ and the noise variance is $\\sigma_Q^2$.\nThe mean and variance are:\n$$\\mathrm{E}[Q] = q_0 \\mu (1 + \\alpha r_{\\mathrm{eff}, Q})$$\n$$\\mathrm{Var}[Q] = q_0^2 \\mu (1 + (2\\alpha + \\alpha^2)r_{\\mathrm{eff}, Q}) + \\sigma_Q^2$$\nThe resolution is $R_Q = \\sqrt{\\mathrm{Var}[Q]} / \\mathrm{E}[Q]$.\n\nStrategy 2: Peak-sensing ADC (Quantity $V$)\nThis strategy captures afterpulses with delay $t$ in the window $[\\max(0, t_p - w/2), t_p + w/2]$. We are given $t_p = \\tau_s$. Let $t_{\\min} = \\max(0, \\tau_s - w/2)$ and $t_{\\max} = \\tau_s + w/2$. The capture probability $p_V$ is:\n$$p_V = P(t_{\\min} \\le t \\le t_{\\max}) = F(t_{\\max}) - F(t_{\\min})$$\n$$p_V = (1 - e^{-t_{\\max}/\\tau_a}) - (1 - e^{-t_{\\min}/\\tau_a}) = e^{-t_{\\min}/\\tau_a} - e^{-t_{\\max}/\\tau_a}$$\nThe effective afterpulse rate is $r_{\\mathrm{eff}, V} = r_a \\cdot p_V$. The gain is $g=a_0$ and the noise variance is $\\sigma_V^2$.\nThe mean and variance are:\n$$\\mathrm{E}[V] = a_0 \\mu (1 + \\alpha r_{\\mathrm{eff}, V})$$\n$$\\mathrm{Var}[V] = a_0^2 \\mu (1 + (2\\alpha + \\alpha^2)r_{\\mathrm{eff}, V}) + \\sigma_V^2$$\nThe resolution is $R_V = \\sqrt{\\mathrm{Var}[V]} / \\mathrm{E}[V]$.\n\nThese derived expressions are implemented in the program below to calculate the resolutions for the given test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# SciPy is specified as available in the execution environment\n# but is not necessary for this implementation, as the required\n# functions (exp, sqrt) are readily available in NumPy.\n\ndef solve():\n    \"\"\"\n    Main function to solve the SiPM resolution problem for the given test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple:\n    # (μ, r_a, α, τ_a, τ_s, T_int, w, q_0, a_0, σ_Q, σ_V)\n    test_cases = [\n        (100.0, 0.1, 0.5, 50.0, 20.0, 200.0, 20.0, 1.0, 1.0, 2.0, 2.0),\n        (100.0, 0.0, 0.5, 50.0, 20.0, 200.0, 20.0, 1.0, 1.0, 2.0, 2.0),\n        (100.0, 0.1, 0.5, 50.0, 20.0, 5.0, 5.0, 1.0, 1.0, 2.0, 2.0),\n        (60.0, 0.5, 0.3, 30.0, 15.0, 40.0, 10.0, 1.0, 1.0, 1.0, 1.0),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        mu, r_a, alpha, tau_a, tau_s, T_int, w, q_0, a_0, sigma_Q, sigma_V = case\n\n        # --- Strategy 1: Integrating ADC ---\n        \n        # Calculate afterpulse capture probability for the integrator\n        # p_Q = 1 - exp(-T_int / tau_a)\n        p_Q = 1.0 - np.exp(-T_int / tau_a)\n        \n        # Calculate effective afterpulse rate\n        r_eff_Q = r_a * p_Q\n        \n        # Calculate mean of the measured charge Q\n        # E[Q] = q_0 * mu * (1 + alpha * r_eff_Q)\n        mean_Q = q_0 * mu * (1.0 + alpha * r_eff_Q)\n        \n        # Calculate variance of the measured charge Q\n        # Var[Q] = q_0^2 * mu * (1 + (2*alpha + alpha^2)*r_eff_Q) + sigma_Q^2\n        var_Q = (q_0**2 * mu * (1.0 + (2.0 * alpha + alpha**2) * r_eff_Q)) + sigma_Q**2\n        \n        # Calculate resolution R_Q\n        resolution_Q = np.sqrt(var_Q) / mean_Q\n        results.append(resolution_Q)\n        \n        # --- Strategy 2: Peak-sensing ADC ---\n\n        # Define the capture window boundaries for the peak-sensing ADC\n        t_p = tau_s\n        t_min = max(0.0, t_p - w / 2.0)\n        t_max = t_p + w / 2.0\n        \n        # Calculate afterpulse capture probability for the peak-sensor\n        # p_V = exp(-t_min / tau_a) - exp(-t_max / tau_a)\n        p_V = np.exp(-t_min / tau_a) - np.exp(-t_max / tau_a)\n        \n        # Calculate effective afterpulse rate\n        r_eff_V = r_a * p_V\n        \n        # Calculate mean of the measured peak voltage V\n        # E[V] = a_0 * mu * (1 + alpha * r_eff_V)\n        mean_V = a_0 * mu * (1.0 + alpha * r_eff_V)\n        \n        # Calculate variance of the measured peak voltage V\n        # Var[V] = a_0^2 * mu * (1 + (2*alpha + alpha^2)*r_eff_V) + sigma_V^2\n        var_V = (a_0**2 * mu * (1.0 + (2.0 * alpha + alpha**2) * r_eff_V)) + sigma_V**2\n        \n        # Calculate resolution R_V\n        resolution_V = np.sqrt(var_V) / mean_V\n        results.append(resolution_V)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nsolve()\n```", "id": "3511813"}]}