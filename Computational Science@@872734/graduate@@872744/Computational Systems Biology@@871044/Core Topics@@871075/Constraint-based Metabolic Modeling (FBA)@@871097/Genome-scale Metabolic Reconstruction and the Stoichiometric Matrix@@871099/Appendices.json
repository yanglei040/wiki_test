{"hands_on_practices": [{"introduction": "Genome-scale models must accurately represent the connection between genes and the reactions they catalyze. This exercise [@problem_id:3316802] focuses on translating Gene-Protein-Reaction (GPR) rules, which are Boolean statements describing how genes form enzyme complexes (AND logic) or isozymes (OR logic), into the mathematical language of mixed-integer linear programming. Mastering this translation is crucial for accurately simulating the effects of gene knockouts and integrating genomic data into metabolic models.", "problem": "You are reconstructing a minimal metabolic module to illustrate how gene–protein–reaction (GPR) rules constrain reaction fluxes in flux balance analysis (FBA). Consider an intracellular metabolite network with two internal metabolites, $A$ and $B$, and three irreversible reactions: an uptake reaction $v_{u}$ that imports $A$ from an external pool into the cell, a conversion reaction $v_{R}$ that converts $A$ into $B$, and a drain reaction $v_{d}$ that removes $B$ to an external sink. The steady-state assumption for intracellular metabolites is represented by the stoichiometric matrix $S$ and the constraint $S \\, v = 0$, which here implies $v_{u} = v_{R} = v_{d}$ at steady state given the network topology. Each reaction $v_{i}$ obeys bounds $0 \\le v_{i} \\le u_{i}$.\n\nThe conversion reaction $v_{R}$ is catalyzed by an enzyme that follows the gene–protein–reaction (GPR) rule $((g_{1} \\land g_{2}) \\lor g_{3})$, where genes $g_{1}$ and $g_{2}$ encode subunits of a protein complex (logical AND), and $g_{3}$ encodes an isozyme (logical OR). Let $x_{1}, x_{2}, x_{3} \\in \\{0,1\\}$ denote binary gene presence indicators, where $x_{i} = 1$ means gene $g_{i}$ is present (not knocked out) and $x_{i} = 0$ means it is knocked out. Introduce a binary reaction activity indicator $y \\in \\{0,1\\}$ for $v_{R}$. Assume the following for bounds: the uptake is non-limiting relative to the catalytic capacity of $v_{R}$, i.e., $0 \\le v_{u} \\le U$ and $U \\ge V$, and the drain is non-limiting, i.e., $0 \\le v_{d} \\le \\bar{U}$ with $\\bar{U}$ sufficiently large. The enzyme-catalyzed reaction has a catalytic upper bound $0 \\le v_{R} \\le V$ when active. You may assume irreversibility for all three reactions.\n\nTask:\n- Using only the core definitions of the stoichiometric steady state ($S \\, v = 0$), reaction bounds, and Boolean logic for GPR rules (isozymes as logical OR, protein complexes as logical AND), translate the Boolean rule $((g_{1} \\land g_{2}) \\lor g_{3})$ into a set of mixed-integer linear constraints that link the gene indicators $x_{1}, x_{2}, x_{3}$, the reaction activity indicator $y$, and the catalytic bound on $v_{R}$, so that $v_{R} = 0$ whenever the rule is not satisfied and $v_{R} \\le V$ when the rule is satisfied. Do not assume any particular linearization a priori; derive it from the Boolean semantics.\n\n- Now suppose that gene presence events are random and independent across genes, with $\\mathbb{P}(x_{i} = 1) = p_{i}$ for $i \\in \\{1,2,3\\}$, and $\\mathbb{P}(x_{i} = 0) = 1 - p_{i}$. Under an FBA objective to maximize $v_{R}$ subject to $S \\, v = 0$ and the bounds derived above, compute the expected value of the optimal objective, $\\mathbb{E}[\\max v_{R}]$, as a closed-form analytic expression in terms of $p_{1}$, $p_{2}$, $p_{3}$, and $V$.\n\nExpress your final answer as a single closed-form expression. If you include physical units, express the expected flux in $\\mathrm{mmol\\ gDW^{-1}\\ h^{-1}}$. No rounding is needed.", "solution": "This problem consists of two parts. First, we must translate a given Gene-Protein-Reaction (GPR) Boolean rule into a set of mixed-integer linear constraints. Second, we must compute the expected value of the maximum flux through the GPR-associated reaction under a probabilistic model of gene presence.\n\nFirst, we analyze the structure of the metabolic network. The network involves two internal metabolites, $A$ and $B$, and three irreversible reactions: uptake $v_{u}$, conversion $v_{R}$, and drain $v_{d}$.\nThe reactions are:\n$v_{u}: \\text{ext} \\rightarrow A$\n$v_{R}: A \\rightarrow B$\n$v_{d}: B \\rightarrow \\text{ext}$\nThe stoichiometric matrix $S$ for the internal metabolites $A$ and $B$ is constructed as follows:\n$$ S = \\begin{pmatrix} 1 & -1 & 0 \\\\ 0 & 1 & -1 \\end{pmatrix} $$\nThe columns correspond to the fluxes $v_u$, $v_R$, and $v_d$ respectively, and the rows correspond to metabolites $A$ and $B$. The steady-state assumption is given by the equation $S v = 0$, where $v = [v_u, v_R, v_d]^T$.\n$$ \\begin{pmatrix} 1 & -1 & 0 \\\\ 0 & 1 & -1 \\end{pmatrix} \\begin{pmatrix} v_u \\\\ v_R \\\\ v_d \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} $$\nThis system of linear equations yields $v_u - v_R = 0$ and $v_R - v_d = 0$. Consequently, at steady state, all fluxes must be equal: $v_u = v_R = v_d$.\n\nThe first task is to formalize the GPR rule $((g_1 \\land g_2) \\lor g_3)$ as a set of linear constraints connecting the gene presence indicators $x_1, x_2, x_3 \\in \\{0, 1\\}$ to the reaction activity indicator $y \\in \\{0, 1\\}$ for reaction $v_R$. The reaction is active ($y=1$) if the Boolean expression is true, and inactive ($y=0$) otherwise.\nThe logical expression for $y$ is $y = (x_1 \\land x_2) \\lor x_3$. This means $y=1$ if and only if $(x_1=1 \\text{ and } x_2=1)$ or if $x_3=1$.\nTo translate this into linear inequalities, we can analyze the conditions for $y$ to be $0$ or $1$.\nThe indicator $y$ must be $1$ if $x_3=1$. This is captured by the inequality:\n$$ y \\ge x_3 $$\nThe indicator $y$ must also be $1$ if both $x_1=1$ and $x_2=1$. This condition is equivalent to stating that if $y=0$, then it is not the case that $(x_1=1 \\text{ and } x_2=1)$. A standard way to represent the \"AND\" condition is through the inequality $z \\ge x_1+x_2-1$ for an intermediate variable $z$. We can combine this logic directly.\nThe reaction is inactive ($y=0$) if and only if the GPR rule is false. By De Morgan's laws, this corresponds to $\\neg((x_1 \\land x_2) \\lor x_3) = (\\neg(x_1 \\land x_2)) \\land (\\neg x_3) = ((\\neg x_1) \\lor (\\neg x_2)) \\land (\\neg x_3)$. In terms of our variables, this means $y=0$ if and only if $((1-x_1)=1 \\text{ or } (1-x_2)=1) \\text{ and } (1-x_3)=1$, which is equivalent to $(x_1=0 \\text{ or } x_2=0) \\text{ and } x_3=0$.\nThe complete set of linear inequalities that correctly models $y = (x_1 \\land x_2) \\lor x_3$ for binary variables is:\n$$ y \\ge x_3 $$\n$$ y \\ge x_1 + x_2 - 1 $$\n$$ y \\le x_1 + x_3 $$\n$$ y \\le x_2 + x_3 $$\nThese four inequalities ensure that $y$ behaves as required. For example, if $x_3=1$, the first inequality forces $y=1$. If $x_3=0$, the system reduces to $y \\ge x_1+x_2-1$, $y \\le x_1$, and $y \\le x_2$, which is the standard linearization for $y=x_1 \\land x_2$.\nNext, we must link the reaction activity indicator $y$ to the flux $v_R$. The condition is that $v_R=0$ when the GPR rule is not satisfied ($y=0$) and $0 \\le v_R \\le V$ when the rule is satisfied ($y=1$), where $V$ is the catalytic upper bound. This is achieved with the \"big-M\" type of constraint:\n$$ v_R \\le V \\cdot y $$\nGiven that the reaction is irreversible ($v_R \\ge 0$), if $y=0$, this constraint becomes $v_R \\le 0$, which forces $v_R=0$. If $y=1$, the constraint becomes $v_R \\le V$, as required.\n\nThe second task is to compute the expected value of the optimal objective, $\\mathbb{E}[\\max v_R]$. The FBA problem is to maximize $v_R$ subject to the network constraints. The constraints on $v_R$ are:\n$1.$ From $v_u=v_R$: $v_R \\le U$\n$2.$ From $v_d=v_R$: $v_R \\le \\bar{U}$\n$3.$ From GPR activity: $v_R \\le V \\cdot y$\n$4.$ From irreversibility: $v_R \\ge 0$\nWe are given that $U \\ge V$ and $\\bar{U}$ is sufficiently large (implying $\\bar{U} \\ge V$). Therefore, the effective upper bound on $v_R$ is determined by the GPR-dependent constraint. The optimization problem for a given set of gene states $\\{x_1, x_2, x_3\\}$ simplifies to:\n$$ \\max v_R \\quad \\text{s.t.} \\quad 0 \\le v_R \\le V \\cdot y $$\nThe solution to this problem is $\\max v_R = V \\cdot y$.\nThe value of $y$ is determined by the random variables $x_1, x_2, x_3$. Thus, the optimal flux is a random variable. We need to compute its expectation:\n$$ \\mathbb{E}[\\max v_R] = \\mathbb{E}[V \\cdot y] = V \\cdot \\mathbb{E}[y] $$\nFor a binary variable $y$, its expectation is the probability that it takes the value $1$:\n$$ \\mathbb{E}[y] = 1 \\cdot \\mathbb{P}(y=1) + 0 \\cdot \\mathbb{P}(y=0) = \\mathbb{P}(y=1) $$\nSo, we need to calculate the probability that the GPR rule is satisfied, $\\mathbb{P}(y=1)$. This is the probability of the event $(x_1=1 \\land x_2=1) \\lor x_3=1$.\nIt is often simpler to calculate the probability of the complementary event, $\\mathbb{P}(y=0)$, and use $\\mathbb{P}(y=1) = 1 - \\mathbb{P}(y=0)$.\nThe event $y=0$ occurs if and only if the GPR rule is false, i.e., $((x_1=0 \\lor x_2=0) \\land x_3=0)$.\nThe gene presence events are independent. Let $E_{i}$ be the event $x_i=1$. We have $\\mathbb{P}(E_i) = p_i$ and thus $\\mathbb{P}(\\neg E_i) = \\mathbb{P}(x_i=0) = 1-p_i$.\n$$ \\mathbb{P}(y=0) = \\mathbb{P}((x_1=0 \\lor x_2=0) \\land x_3=0) $$\nDue to independence of genes, we can separate the probabilities:\n$$ \\mathbb{P}(y=0) = \\mathbb{P}(x_1=0 \\lor x_2=0) \\cdot \\mathbb{P}(x_3=0) $$\nThe probability $\\mathbb{P}(x_3=0)$ is $1-p_3$.\nFor the term $\\mathbb{P}(x_1=0 \\lor x_2=0)$, we use the complement rule:\n$$ \\mathbb{P}(x_1=0 \\lor x_2=0) = 1 - \\mathbb{P}(\\neg(x_1=0 \\lor x_2=0)) = 1 - \\mathbb{P}(x_1=1 \\land x_2=1) $$\nDue to independence of $x_1$ and $x_2$:\n$$ \\mathbb{P}(x_1=1 \\land x_2=1) = \\mathbb{P}(x_1=1) \\cdot \\mathbb{P}(x_2=1) = p_1 p_2 $$\nSo, $\\mathbb{P}(x_1=0 \\lor x_2=0) = 1 - p_1 p_2$.\nSubstituting back, we get the probability of an inactive reaction:\n$$ \\mathbb{P}(y=0) = (1 - p_1 p_2)(1 - p_3) $$\nThe probability of an active reaction, $\\mathbb{P}(y=1)$, is therefore:\n$$ \\mathbb{P}(y=1) = 1 - \\mathbb{P}(y=0) = 1 - (1 - p_1 p_2)(1 - p_3) $$\nExpanding this expression:\n$$ \\mathbb{P}(y=1) = 1 - (1 - p_3 - p_1 p_2 + p_1 p_2 p_3) = p_1 p_2 + p_3 - p_1 p_2 p_3 $$\nFinally, the expected value of the maximum flux is:\n$$ \\mathbb{E}[\\max v_R] = V \\cdot \\mathbb{P}(y=1) = V (p_1 p_2 + p_3 - p_1 p_2 p_3) $$\nThis expression gives the expected optimal flux in terms of the catalytic capacity $V$ and the probabilities of gene presence $p_1, p_2, p_3$. The units of this quantity would be the same as the units of $V$, for example, $\\mathrm{mmol\\ gDW^{-1}\\ h^{-1}}$.", "answer": "$$ \\boxed{V (p_1 p_2 + p_3 - p_1 p_2 p_3)} $$", "id": "3316802"}, {"introduction": "The stoichiometric matrix defines mass balance, but it does not inherently constrain the direction of metabolic flux. This directionality is governed by thermodynamics, a principle you will apply in this practice [@problem_id:3316719]. You will calculate the actual reaction Gibbs energy, $\\Delta_r G^\\prime$, from standard formation energies and metabolite activities, and use its sign to justify setting irreversibility constraints, a fundamental step in ensuring a model is biophysically realistic.", "problem": "Consider a single intracellular reaction embedded within a genome-scale stoichiometric representation of metabolism. The reaction consumes metabolite $A$ and $B$ to produce metabolite $C$ and $D$ according to the stoichiometry $2A + B \\rightarrow C + D$. The corresponding column of the stoichiometric matrix for this reaction, written as a stoichiometric coefficient vector, is $\\boldsymbol{\\nu}^{(r)} = \\begin{pmatrix} \\nu_A \\\\ \\nu_B \\\\ \\nu_C \\\\ \\nu_D \\end{pmatrix} = \\begin{pmatrix} -2 \\\\ -1 \\\\ 1 \\\\ 1 \\end{pmatrix}$. Assume standard Gibbs free energies of formation at biochemical standard state (pH $7$, $I \\approx 0.1$ M) are given by $\\Delta_f G_A^\\circ = -120$ kJ/mol, $\\Delta_f G_B^\\circ = -80$ kJ/mol, $\\Delta_f G_C^\\circ = -220$ kJ/mol, and $\\Delta_f G_D^\\circ = -90$ kJ/mol. Cytosolic activities are $a_A = 0.2$, $a_B = 0.1$, $a_C = 1.0 \\times 10^{-6}$, and $a_D = 1.0 \\times 10^{-4}$. Let the absolute temperature be $T = 310$ K and the universal gas constant be $R = 8.314462618 \\times 10^{-3}$ kJ mol$^{-1}$ K$^{-1}$. The sign convention for the reaction free energy is set by the stoichiometry above, and the forward flux $v_r$ is defined positive when the reaction proceeds in the written direction, consuming $A$ and $B$ and forming $C$ and $D$.\n\nStarting from the definition of chemical potential and the stoichiometric representation of reactions, derive the standard reaction Gibbs energy $\\Delta_r G^\\circ$ in terms of the standard Gibbs free energies of formation $\\Delta_f G_i^\\circ$ and the stoichiometric coefficients $\\nu_i$, then use metabolite activities to obtain the transformed reaction Gibbs energy $\\Delta_r G^\\prime$ at temperature $T$. In the context of steady-state Flux Balance Analysis (FBA), where fluxes $\\boldsymbol{v}$ satisfy $\\mathbf{S}\\boldsymbol{v} = \\boldsymbol{0}$, formulate the inequalities on the scalar flux $v_r$ that enforce irreversibility of the reaction when $\\Delta_r G^\\prime \\ll 0$ under the given activities. Finally, compute the numerical value of $\\Delta_r G^\\prime$ using the provided data and express your final numerical answer in kJ/mol, rounded to four significant figures.", "solution": "**Derivation of Reaction Gibbs Energy**\n\nThe standard Gibbs free energy of reaction, $\\Delta_r G^\\circ$, is the change in Gibbs energy when one mole of reaction proceeds with all reactants and products maintained in their standard states. According to Hess's Law, this can be calculated from the standard Gibbs free energies of formation, $\\Delta_f G_i^\\circ$, of each species $i$. The change is the sum of the energies of formation of the products minus the sum of the energies of formation of the reactants, each weighted by its stoichiometric coefficient. Using the convention where stoichiometric coefficients $\\nu_i$ are positive for products and negative for reactants, this relationship is expressed compactly as a sum over all participating species:\n$$\n\\Delta_r G^\\circ = \\sum_i \\nu_i \\Delta_f G_i^\\circ\n$$\nIn vector notation, this corresponds to the dot product of the transposed stoichiometric vector for the reaction, $(\\boldsymbol{\\nu}^{(r)})^T$, and the vector of standard Gibbs free energies of formation, $\\boldsymbol{\\Delta_f G^\\circ}$:\n$$\n\\Delta_r G^\\circ = (\\boldsymbol{\\nu}^{(r)})^T \\boldsymbol{\\Delta_f G^\\circ} = \\begin{pmatrix} -2 & -1 & 1 & 1 \\end{pmatrix} \\begin{pmatrix} \\Delta_f G_A^\\circ \\\\ \\Delta_f G_B^\\circ \\\\ \\Delta_f G_C^\\circ \\\\ \\Delta_f G_D^\\circ \\end{pmatrix}\n$$\n\nThe chemical potential $\\mu_i$ of a species $i$ at a specified activity $a_i$ is related to its standard chemical potential $\\mu_i^\\circ$ (which is equal to its standard Gibbs free energy of formation, $\\Delta_f G_i^\\circ$) by the equation:\n$$\n\\mu_i = \\mu_i^\\circ + RT \\ln a_i\n$$\nwhere $R$ is the universal gas constant and $T$ is the absolute temperature. The actual Gibbs free energy of reaction under these non-standard conditions, known as the transformed reaction Gibbs energy $\\Delta_r G^\\prime$, is the sum of the chemical potentials of the products and reactants, weighted by their stoichiometric coefficients $\\nu_i$:\n$$\n\\Delta_r G^\\prime = \\sum_i \\nu_i \\mu_i\n$$\nSubstituting the expression for $\\mu_i$:\n$$\n\\Delta_r G^\\prime = \\sum_i \\nu_i (\\mu_i^\\circ + RT \\ln a_i) = \\sum_i \\nu_i \\mu_i^\\circ + \\sum_i \\nu_i RT \\ln a_i\n$$\nThe first term is the definition of $\\Delta_r G^\\circ$. The second term can be simplified:\n$$\n\\Delta_r G^\\prime = \\Delta_r G^\\circ + RT \\sum_i \\ln(a_i^{\\nu_i}) = \\Delta_r G^\\circ + RT \\ln \\left( \\prod_i a_i^{\\nu_i} \\right)\n$$\nThe product term, $\\prod_i a_i^{\\nu_i}$, is the reaction quotient, $Q$. For the reaction $2A + B \\rightarrow C + D$, this is:\n$$\nQ = a_A^{-2} a_B^{-1} a_C^{1} a_D^{1} = \\frac{a_C a_D}{a_A^2 a_B}\n$$\nThus, the final derived expression for the transformed reaction Gibbs energy is:\n$$\n\\Delta_r G^\\prime = \\Delta_r G^\\circ + RT \\ln Q\n$$\n\n**Flux Irreversibility Constraint in FBA**\n\nThe second law of thermodynamics requires that a reaction can only proceed spontaneously if the change in Gibbs free energy is negative ($\\Delta_r G < 0$). In the context of FBA, the flux $v_r$ represents the rate of the reaction. The direction of the flux is linked to the sign of $\\Delta_r G^\\prime$.\n- If $\\Delta_r G^\\prime < 0$, the forward reaction is spontaneous, implying $v_r \\ge 0$.\n- If $\\Delta_r G^\\prime > 0$, the reverse reaction is spontaneous, implying $v_r \\le 0$.\n- If $\\Delta_r G^\\prime = 0$, the reaction is at equilibrium, and the net flux is zero, $v_r = 0$.\n\nThe problem specifies a scenario where $\\Delta_r G^\\prime \\ll 0$. This indicates a large negative Gibbs energy change, meaning the forward reaction is strongly favored and thermodynamically irreversible. The reverse reaction is not possible under these conditions. Therefore, the flux $v_r$ must be non-negative. In the constraint-based modeling framework of FBA, this is formulated as an inequality setting a lower bound on the flux:\n$$\nv_r \\ge 0\n$$\nThis is the standard way to enforce irreversibility for a reaction in FBA. A typical full constraint would be $0 \\le v_r \\le v_{max}$, where $v_{max}$ is an upper bound on flux capacity.\n\n**Numerical Calculation**\n\nFirst, we compute the standard reaction Gibbs energy, $\\Delta_r G^\\circ$:\n$$\n\\Delta_r G^\\circ = \\nu_A \\Delta_f G_A^\\circ + \\nu_B \\Delta_f G_B^\\circ + \\nu_C \\Delta_f G_C^\\circ + \\nu_D \\Delta_f G_D^\\circ\n$$\n$$\n\\Delta_r G^\\circ = (-2)(-120 \\text{ kJ/mol}) + (-1)(-80 \\text{ kJ/mol}) + (1)(-220 \\text{ kJ/mol}) + (1)(-90 \\text{ kJ/mol})\n$$\n$$\n\\Delta_r G^\\circ = (240 + 80 - 220 - 90) \\text{ kJ/mol} = (320 - 310) \\text{ kJ/mol} = 10 \\text{ kJ/mol}\n$$\nNext, we compute the reaction quotient, $Q$, using the given activities:\n$$\nQ = \\frac{a_C a_D}{a_A^2 a_B} = \\frac{(1.0 \\times 10^{-6})(1.0 \\times 10^{-4})}{(0.2)^2 (0.1)} = \\frac{1.0 \\times 10^{-10}}{(0.04)(0.1)} = \\frac{1.0 \\times 10^{-10}}{0.004} = \\frac{1.0 \\times 10^{-10}}{4 \\times 10^{-3}} = 2.5 \\times 10^{-8}\n$$\nNow, we calculate the term $RT \\ln Q$:\n$$\nR = 8.314462618 \\times 10^{-3} \\text{ kJ mol}^{-1} \\text{ K}^{-1}\n$$\n$$\nT = 310 \\text{ K}\n$$\n$$\nRT = (8.314462618 \\times 10^{-3})(310) \\text{ kJ/mol} \\approx 2.57748 \\text{ kJ/mol}\n$$\n$$\n\\ln Q = \\ln(2.5 \\times 10^{-8}) \\approx -17.504397\n$$\n$$\nRT \\ln Q \\approx (2.57748)( -17.504397) \\text{ kJ/mol} \\approx -45.12028 \\text{ kJ/mol}\n$$\nFinally, we compute the transformed reaction Gibbs energy, $\\Delta_r G^\\prime$:\n$$\n\\Delta_r G^\\prime = \\Delta_r G^\\circ + RT \\ln Q\n$$\n$$\n\\Delta_r G^\\prime \\approx 10 \\text{ kJ/mol} - 45.12028 \\text{ kJ/mol} = -35.12028 \\text{ kJ/mol}\n$$\nRounding the final answer to four significant figures as requested:\n$$\n\\Delta_r G^\\prime = -35.12 \\text{ kJ/mol}\n$$\nThe highly negative value confirms that the reaction is indeed strongly favorable in the forward direction under the specified cytosolic conditions and is effectively irreversible, justifying the constraint $v_r \\ge 0$.", "answer": "$$\n\\boxed{-35.12}\n$$", "id": "3316719"}, {"introduction": "This practice [@problem_id:3316755] integrates the principles of GPR evaluation and constrained optimization into a complete computational workflow. You will implement a program to predict the phenotypic consequences of gene deletions, from determining which reactions are disabled to solving for the optimal growth rate using Flux Balance Analysis (FBA). This exercise simulates a core task in systems biology: using a genome-scale model to perform *in silico* experiments that can guide wet-lab research.", "problem": "You are given a toy genome-scale metabolic reconstruction in steady state that obeys the law of mass conservation for intracellular metabolites. Under the standard steady-state assumption in constraint-based modeling, the intracellular metabolite concentrations do not change with time. This implies the linear conservation law $S v = 0$, where $S$ is the stoichiometric matrix and $v$ is the vector of reaction fluxes. Enzyme availability constraints arise from gene-protein-reaction (GPR) rules, which are Boolean expressions in genes that determine whether a reaction is catalytically enabled. A reaction affected by a GPR rule is enabled if and only if its GPR evaluates to true given the set of non-deleted genes. Exchange and biomass sink reactions without GPR rules are assumed to be always available. The Flux Balance Analysis (FBA) optimal growth is computed by maximizing the biomass reaction flux subject to these constraints and reaction bounds. The effect on the feasible flux space can be summarized, to first order, by the dimension of the null space of the active-stoichiometry submatrix, which is $n_{\\text{active}} - \\operatorname{rank}(S_{\\text{active}})$, where $n_{\\text{active}}$ is the number of reactions not disabled by gene deletions and $S_{\\text{active}}$ is the restriction of $S$ to those reactions.\n\nThe metabolic network is defined over two intracellular metabolites, $G$ and $P$, with six reactions labeled by zero-based indices $0$ through $5$. The stoichiometric matrix $S \\in \\mathbb{R}^{2 \\times 6}$ has rows ordered as $[G, P]$ and columns ordered as reactions $[0,1,2,3,4,5]$. The entries of $S$ are:\n$$\nS = \\begin{bmatrix}\n+1 & -1 & -1 & 0 & 0 & -1 \\\\\n0  & +2 & +1 & -1 & -1 & 0\n\\end{bmatrix}.\n$$\nThe reactions and their default flux bounds (all fluxes are in a consistent arbitrary unit; report floats as plain numbers) are:\n- Reaction $0$ (glucose uptake exchange, no GPR): bounds $[0,10]$.\n- Reaction $1$ (glycolysis, GPR requires an enzyme complex): bounds $[0,1000]$.\n- Reaction $2$ (alternative pathway, GPR represents isoenzymes): bounds $[0,1000]$.\n- Reaction $3$ (biomass sink, no GPR; this is the objective to maximize): bounds $[0,1000]$.\n- Reaction $4$ (byproduct sink, GPR is a single gene): bounds $[0,1000]$.\n- Reaction $5$ (maintenance drain, GPR is a single gene): bounds $[0,1000]$.\n\nThe GPR rules are:\n- Reaction $0$: no rule (always enabled).\n- Reaction $1$: $(gA \\land gB)$, that is, requires both gene $gA$ and gene $gB$ present.\n- Reaction $2$: $(gC \\lor gD)$, that is, any one of gene $gC$ or gene $gD$ present.\n- Reaction $3$: no rule (always enabled).\n- Reaction $4$: gene $gE$.\n- Reaction $5$: gene $gF$.\n\nGiven a set of deleted genes, a reaction is disabled if its GPR evaluates to false. A disabled reaction must have its flux fixed to $0$ by tightening both its lower and upper bounds to $0$. Reactions without GPR remain enabled regardless of gene deletions.\n\nYour tasks for each test case (set of gene deletions) are:\n1. Determine which reactions are disabled by evaluating the GPR rules against the set of deleted genes. Report the disabled reactions as a sorted list of their zero-based indices.\n2. Compute the dimension of the feasible steady-state subspace approximated by the null space dimension $d = n_{\\text{active}} - \\operatorname{rank}(S_{\\text{active}})$, where $S_{\\text{active}}$ is $S$ restricted to the columns of enabled reactions and $\\operatorname{rank}(\\cdot)$ is the matrix rank over the real numbers.\n3. Predict the optimal growth by solving a linear program that maximizes the flux of reaction $3$ subject to $S v = 0$, the original bounds for enabled reactions, and $v_j = 0$ for disabled reactions. Express the optimal biomass flux as a float rounded to six decimal places.\n\nYou must implement a program that carries out the above for the following test suite of gene deletion sets:\n- Test case $1$: $[]$ (no deletions).\n- Test case $2$: $[gA]$.\n- Test case $3$: $[gC]$.\n- Test case $4$: $[gC,gD]$.\n- Test case $5$: $[gA,gB,gC,gD]$.\n- Test case $6$: $[gE,gF]$.\n- Test case $7$: $[gB]$.\n\nAll gene symbols are case-sensitive. For each test case, your program must output a list of the form $[\\text{disabled}, d, b]$, where $\\text{disabled}$ is the list of disabled reaction indices, $d$ is the integer null space dimension, and $b$ is the optimal biomass flux as a float rounded to six decimal places. Aggregate the results for all test cases into a single line of output containing a JSON-like list with no spaces, for example:\n\"[item1,item2,item3,...]\" where each item is itself of the form \"[disabled_list,dimension_float,biomass_float]\" without spaces. Ensure that the floats are rounded to six decimal places. If a linear program is infeasible in any test case, report the optimal biomass as a floating-point Not-a-Number value encoded as \"nan\". All angles are not involved, and no physical unit conversion is required; all reported numbers are unitless.", "solution": "The problem is well-posed and grounded in the established principles of computational systems biology, specifically concerning genome-scale metabolic reconstruction and Flux Balance Analysis (FBA). All necessary data and constraints are provided, allowing for a unique and meaningful solution for each test case.\n\nThe core of the problem lies in analyzing a metabolic network under the steady-state assumption. This assumption dictates that the concentrations of intracellular metabolites do not change over time, leading to the fundamental mass balance equation for a set of $m$ metabolites and $n$ reactions:\n$$S v = 0$$\nwhere $S \\in \\mathbb{R}^{m \\times n}$ is the stoichiometric matrix and $v \\in \\mathbb{R}^{n}$ is the vector of reaction fluxes. In this problem, $m=2$ metabolites ($G$ and $P$) and $n=6$ reactions, and the stoichiometric matrix is given as:\n$$\nS = \\begin{bmatrix}\n+1 & -1 & -1 & 0 & 0 & -1 \\\\\n0  & +2 & +1 & -1 & -1 & 0\n\\end{bmatrix}\n$$\nThe system is further constrained by thermodynamic and enzymatic capacity limitations, expressed as lower and upper bounds on each flux, $l_j \\le v_j \\le u_j$.\n\nThe first task is to determine the impact of gene deletions on reaction availability. This is governed by Gene-Protein-Reaction (GPR) rules, which are Boolean expressions. A reaction is considered \"enabled\" if its GPR rule evaluates to true given the set of available (non-deleted) genes; otherwise, it is \"disabled\". A disabled reaction cannot carry flux, a constraint that is imposed by setting both its lower and upper bounds to $0$, i.e., $v_j = 0$. For each test case, the set of deleted genes is provided, and the GPRs must be evaluated:\n- Reaction $1$: $(gA \\land gB)$ is true if both gene $gA$ and gene $gB$ are present.\n- Reaction $2$: $(gC \\lor gD)$ is true if gene $gC$ or gene $gD$ (or both) are present.\n- Reaction $4$: $gE$ is true if gene $gE$ is present.\n- Reaction $5$: $gF$ is true if gene $gF$ is present.\nReactions $0$ and $3$ have no GPR rules and are always enabled. The disabled reactions for each case are reported as a sorted list of indices.\n\nThe second task is to compute the dimension of the steady-state feasible flux space, which is approximated by the dimension of the null space of the \"active\" stoichiometric matrix. For a given set of gene deletions, let $S_{\\text{active}}$ be the submatrix of $S$ formed by retaining only the columns corresponding to enabled reactions. Let $n_{\\text{active}}$ be the number of such reactions. The dimension of the null space, $d$, is given by the rank-nullity theorem:\n$$d = \\operatorname{dim}(\\operatorname{null}(S_{\\text{active}})) = n_{\\text{active}} - \\operatorname{rank}(S_{\\text{active}})$$\nwhere $\\operatorname{rank}(\\cdot)$ denotes the matrix rank. This value $d$ represents the number of degrees of freedom in the metabolic network's flux distribution under steady-state conditions.\n\nThe third task is to predict the maximum possible biomass production rate using Flux Balance Analysis (FBA). FBA is a mathematical optimization method that finds a specific flux distribution $v$ within the feasible space that maximizes or minimizes a given objective function. Here, the objective is to maximize the flux through the biomass sink reaction, which is reaction $3$ ($v_3$). This is formulated as a Linear Program (LP):\n$$\n\\begin{align*}\n\\text{maximize} \\quad & v_3 \\\\\n\\text{subject to} \\quad & S v = 0 \\\\\n& l_j \\le v_j \\le u_j \\quad \\text{for each reaction } j \\in \\{0, 1, ..., 5\\}\n\\end{align*}\n$$\nFor each test case, the bounds $\\{l_j, u_j\\}$ are adjusted first: for enabled reactions, the default bounds are used; for disabled reactions, the bounds are set to $[0, 0]$. The resulting LP is then solved to find the optimal biomass flux. If the LP is found to be infeasible, the optimal flux is undefined. The solution will be numerically determined using an appropriate LP solver. The biomass flux will be reported as a float rounded to six decimal places.\n\nThe procedure will be systematically applied to each of the provided gene deletion scenarios.", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a series of computational systems biology problems involving gene deletions\n    and their effect on a toy metabolic network.\n    \"\"\"\n    # Define the stoichiometric matrix S\n    S = np.array([\n        [1, -1, -1, 0, 0, -1],\n        [0,  2,  1, -1, -1,  0]\n    ])\n\n    # Default flux bounds for reactions 0 through 5\n    default_bounds = [\n        (0, 10),    # R0: Glucose uptake\n        (0, 1000),  # R1: Glycolysis\n        (0, 1000),  # R2: Alternative pathway\n        (0, 1000),  # R3: Biomass sink\n        (0, 1000),  # R4: Byproduct sink\n        (0, 1000)   # R5: Maintenance drain\n    ]\n\n    # All genes in the model\n    all_genes = {'gA', 'gB', 'gC', 'gD', 'gE', 'gF'}\n\n    # GPR rules are defined as lambda functions that take the set of present genes\n    # and return True if the reaction is enabled.\n    gpr_rules = {\n        1: lambda present: {'gA', 'gB'}.issubset(present),        # R1: (gA AND gB)\n        2: lambda present: not {'gC', 'gD'}.isdisjoint(present), # R2: (gC OR gD)\n        4: lambda present: 'gE' in present,                      # R4: gE\n        5: lambda present: 'gF' in present                       # R5: gF\n    }\n    \n    # Test cases: sets of deleted genes\n    test_cases = [\n        [],            # Case 1: No deletions\n        ['gA'],        # Case 2\n        ['gC'],        # Case 3\n        ['gC', 'gD'],  # Case 4\n        ['gA', 'gB', 'gC', 'gD'], # Case 5\n        ['gE', 'gF'],  # Case 6\n        ['gB']         # Case 7\n    ]\n\n    results = []\n    \n    # Objective function for FBA: maximize v3, which is equivalent to minimizing -v3.\n    # c is the coefficient vector for the objective function.\n    c = np.array([0, 0, 0, -1, 0, 0])\n\n    for deleted_genes_list in test_cases:\n        deleted_genes = set(deleted_genes_list)\n        present_genes = all_genes - deleted_genes\n        \n        # Task 1: Determine disabled reactions\n        disabled_reactions = []\n        enabled_reactions = []\n        current_bounds = list(default_bounds)\n\n        for i in range(S.shape[1]):\n            is_enabled = gpr_rules.get(i, lambda pg: True)(present_genes)\n            if is_enabled:\n                enabled_reactions.append(i)\n            else:\n                disabled_reactions.append(i)\n                current_bounds[i] = (0, 0) # Constrain flux to 0 for disabled reactions\n        \n        disabled_reactions.sort()\n        \n        # Task 2: Compute null space dimension\n        n_active = len(enabled_reactions)\n        if n_active > 0:\n            S_active = S[:, enabled_reactions]\n            rank_S_active = np.linalg.matrix_rank(S_active)\n        else:\n            rank_S_active = 0\n            \n        d = n_active - rank_S_active\n        \n        # Task 3: Predict optimal growth (FBA)\n        A_eq = S\n        b_eq = np.zeros(S.shape[0])\n\n        res = linprog(c, A_eq=A_eq, b_eq=b_eq, bounds=current_bounds, method='highs')\n        \n        biomass = float('nan')\n        if res.success:\n            # The objective was to minimize -v3, so the max v3 is -res.fun\n            biomass = -res.fun\n        # Note: For this problem, v=0 is always a feasible solution, so the LP\n        # should not be infeasible. This 'else' is for general robustness.\n\n        results.append((disabled_reactions, d, biomass))\n\n    # Format the final output string as per the requirements\n    final_items_str = []\n    for item in results:\n        disabled_list, d_val, b_val = item\n        disabled_str = str(disabled_list).replace(\" \", \"\")\n        d_str = str(d_val)\n        \n        if np.isnan(b_val):\n            b_str = \"nan\"\n        else:\n            # Round to 6 decimal places before formatting to handle float inaccuracies\n            b_str = f\"{round(b_val, 6):.6f}\"\n\n        item_str = f\"[{disabled_str},{d_str},{b_str}]\"\n        final_items_str.append(item_str)\n        \n    print(f\"[{','.join(final_items_str)}]\")\n\nsolve()\n```", "id": "3316755"}]}