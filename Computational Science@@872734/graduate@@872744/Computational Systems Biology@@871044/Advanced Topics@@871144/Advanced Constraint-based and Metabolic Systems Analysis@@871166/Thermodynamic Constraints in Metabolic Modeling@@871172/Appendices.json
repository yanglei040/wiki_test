{"hands_on_practices": [{"introduction": "To determine whether a metabolic reaction can proceed spontaneously within a cell, we must look beyond its standard Gibbs free energy ($\\Delta_r G^{\\circ'}$). The actual Gibbs free energy ($\\Delta_r G$) depends critically on the intracellular concentrations of reactants and products, captured by the reaction quotient $Q$. This first exercise [@problem_id:3355483] provides a hands-on calculation of $\\Delta_r G$ for a key glycolytic reaction, demonstrating how to use real concentration data to assess the thermodynamic feasibility of a flux.", "problem": "A central step in glycolysis couples an oxidation to a high-energy acyl phosphate formation via the reaction glyceraldehyde 3-phosphate (G3P) $+$ inorganic phosphate (Pi) $+$ oxidized nicotinamide adenine dinucleotide (NAD$^{+}$) $\\rightarrow$ 1,3-bisphosphoglycerate (1,3-BPG) $+$ reduced nicotinamide adenine dinucleotide (NADH). Consider this reaction in a cellular cytosol at temperature $T = 310 \\ \\mathrm{K}$, with pH buffered at $7$ and water activity approximated as unity, so that the transformed standard state applies. Assume activities are well-approximated by concentrations normalized to the $1 \\ \\mathrm{M}$ standard state (activity coefficients close to $1$), and take the transformed standard equilibrium constant at these conditions to be $K^{\\circ \\prime} = 0.10$ (dimensionless).\n\nThe metabolite concentrations are:\n- $[ \\mathrm{G3P} ] = 5.0 \\times 10^{-4} \\ \\mathrm{M}$,\n- $[ \\mathrm{Pi} ] = 2.0 \\times 10^{-2} \\ \\mathrm{M}$,\n- $[ \\mathrm{NAD}^{+} ] = 1.0 \\times 10^{-3} \\ \\mathrm{M}$,\n- $[ \\mathrm{1,3\\text{-}BPG} ] = 1.0 \\times 10^{-6} \\ \\mathrm{M}$,\n- $[ \\mathrm{NADH} ] = 1.0 \\times 10^{-5} \\ \\mathrm{M}$.\n\nUsing fundamental thermodynamic relations that connect the Gibbs energy of reaction to chemical potentials, equilibrium constants, and activities, compute the Gibbs energy of reaction $\\Delta_{r} G$ under these non-equilibrium conditions. Use the ideal-gas constant $R = 8.314462618 \\ \\mathrm{J \\ mol^{-1} \\ K^{-1}}$. Then, determine whether a forward metabolic flux is thermodynamically permissible under the Thermodynamics-based Flux Balance Analysis (TFBA) constraint that a nonzero forward flux requires $\\Delta_{r} G  0$.\n\nExpress $\\Delta_{r} G$ in $\\mathrm{kJ \\ mol^{-1}}$ and round your numerical answer to four significant figures.", "solution": "The problem is validated against the required criteria.\n\n### Step 1: Extract Givens\n- **Reaction**: glyceraldehyde 3-phosphate (G3P) $+$ inorganic phosphate (Pi) $+$ oxidized nicotinamide adenine dinucleotide (NAD$^{+}$) $\\rightarrow$ 1,3-bisphosphoglycerate (1,3-BPG) $+$ reduced nicotinamide adenine dinucleotide (NADH)\n- **Temperature**: $T = 310 \\ \\mathrm{K}$\n- **pH**: $7$\n- **Water activity**: approximated as unity\n- **State**: Transformed standard state applies\n- **Approximation**: Activities are approximated by concentrations normalized to the $1 \\ \\mathrm{M}$ standard state.\n- **Transformed standard equilibrium constant**: $K^{\\circ \\prime} = 0.10$ (dimensionless)\n- **Concentrations**:\n  - $[\\mathrm{G3P}] = 5.0 \\times 10^{-4} \\ \\mathrm{M}$\n  - $[\\mathrm{Pi}] = 2.0 \\times 10^{-2} \\ \\mathrm{M}$\n  - $[\\mathrm{NAD}^{+}] = 1.0 \\times 10^{-3} \\ \\mathrm{M}$\n  - $[\\text{1,3-BPG}] = 1.0 \\times 10^{-6} \\ \\mathrm{M}$\n  - $[\\mathrm{NADH}] = 1.0 \\times 10^{-5} \\ \\mathrm{M}$\n- **Ideal-gas constant**: $R = 8.314462618 \\ \\mathrm{J \\ mol^{-1} \\ K^{-1}}$\n- **Constraint**: A nonzero forward flux requires $\\Delta_{r} G  0$.\n- **Required Output**: The Gibbs energy of reaction $\\Delta_{r} G$ in $\\mathrm{kJ \\ mol^{-1}}$ rounded to four significant figures, and a determination of whether the forward flux is thermodynamically permissible.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective. It provides a complete and consistent set of data to solve a standard problem in biochemical thermodynamics. The reaction is a well-known step in glycolysis, the provided concentrations are physiologically plausible, and the temperature is typical for a human body. The question asks for the calculation of the Gibbs energy of reaction under non-equilibrium conditions, which is a fundamental concept. All necessary constants and conditions are provided, and there are no contradictions, ambiguities, or violations of scientific principles.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete, reasoned solution will be provided.\n\nThe chemical reaction can be written as:\n$$\n\\mathrm{G3P} + \\mathrm{Pi} + \\mathrm{NAD}^{+} \\rightleftharpoons \\mathrm{1,3\\text{-}BPG} + \\mathrm{NADH}\n$$\nThe Gibbs energy of reaction, $\\Delta_{r} G$, under non-equilibrium conditions is related to the transformed standard Gibbs energy of reaction, $\\Delta_{r} G^{\\circ \\prime}$, and the reaction quotient, $Q^{\\prime}$, by the fundamental thermodynamic relation:\n$$\n\\Delta_{r} G = \\Delta_{r} G^{\\circ \\prime} + RT \\ln Q^{\\prime}\n$$\nThe transformed standard Gibbs energy, $\\Delta_{r} G^{\\circ \\prime}$, can be calculated from the given transformed standard equilibrium constant, $K^{\\circ \\prime}$, using the equation:\n$$\n\\Delta_{r} G^{\\circ \\prime} = -RT \\ln K^{\\circ \\prime}\n$$\nSubstituting the second equation into the first yields a direct relationship between $\\Delta_r G$, $Q^{\\prime}$, and $K^{\\circ \\prime}$:\n$$\n\\Delta_{r} G = -RT \\ln K^{\\circ \\prime} + RT \\ln Q^{\\prime} = RT \\ln \\left( \\frac{Q^{\\prime}}{K^{\\circ \\prime}} \\right)\n$$\nThe reaction quotient, $Q^{\\prime}$, is calculated from the given non-equilibrium concentrations of reactants and products. The problem specifies that activities can be approximated by molar concentrations. For the given reaction, $Q^{\\prime}$ is:\n$$\nQ^{\\prime} = \\frac{[\\mathrm{1,3\\text{-}BPG}] [\\mathrm{NADH}]}{[\\mathrm{G3P}] [\\mathrm{Pi}] [\\mathrm{NAD}^{+}]}\n$$\nSubstituting the given concentration values:\n$$\nQ^{\\prime} = \\frac{(1.0 \\times 10^{-6}) (1.0 \\times 10^{-5})}{(5.0 \\times 10^{-4}) (2.0 \\times 10^{-2}) (1.0 \\times 10^{-3})}\n$$\n$$\nQ^{\\prime} = \\frac{1.0 \\times 10^{-11}}{1.0 \\times 10^{-8}} = 1.0 \\times 10^{-3}\n$$\nThe reaction quotient $Q^{\\prime}$ is dimensionless, as it is formally a ratio of activities, which are themselves dimensionless (concentrations normalized to a $1 \\ \\mathrm{M}$ standard state).\n\nNow, we can calculate $\\Delta_{r} G$ using the derived expression. The given values are $R = 8.314462618 \\ \\mathrm{J \\ mol^{-1} \\ K^{-1}}$, $T = 310 \\ \\mathrm{K}$, $K^{\\circ \\prime} = 0.10$, and we calculated $Q^{\\prime} = 1.0 \\times 10^{-3}$.\n$$\n\\Delta_{r} G = (8.314462618 \\ \\mathrm{J \\ mol^{-1} \\ K^{-1}}) (310 \\ \\mathrm{K}) \\ln \\left( \\frac{1.0 \\times 10^{-3}}{0.10} \\right)\n$$\n$$\n\\Delta_{r} G = (2577.48341... \\ \\mathrm{J \\ mol^{-1}}) \\ln(1.0 \\times 10^{-2})\n$$\nThe natural logarithm $\\ln(1.0 \\times 10^{-2})$ is approximately $-4.605170186...$.\n$$\n\\Delta_{r} G \\approx (2577.48341... \\ \\mathrm{J \\ mol^{-1}}) \\times (-4.605170186...)\n$$\n$$\n\\Delta_{r} G \\approx -11869.608 \\ \\mathrm{J \\ mol^{-1}}\n$$\nThe problem requires the answer in $\\mathrm{kJ \\ mol^{-1}}$. To convert, we divide by $1000$:\n$$\n\\Delta_{r} G \\approx -11.869608 \\ \\mathrm{kJ \\ mol^{-1}}\n$$\nRounding this value to four significant figures gives:\n$$\n\\Delta_{r} G \\approx -11.87 \\ \\mathrm{kJ \\ mol^{-1}}\n$$\nThe second part of the problem asks to determine if a forward metabolic flux is thermodynamically permissible. The criterion given is that a nonzero forward flux requires $\\Delta_{r} G  0$.\nSince our calculated value is $\\Delta_{r} G = -11.87 \\ \\mathrm{kJ \\ mol^{-1}}$, which is less than $0$, the forward reaction is thermodynamically spontaneous and a forward flux is permissible under these cellular conditions.", "answer": "$$\\boxed{-11.87}$$", "id": "3355483"}, {"introduction": "A valid metabolic model must obey the Second Law of Thermodynamics not just globally, but for every individual reaction carrying a flux. This means the direction of each flux ($v_j$) must align with a negative Gibbs free energy change ($\\Delta_r G_j$), ensuring that the product $v_j \\Delta_r G_j \\le 0$. In this practice [@problem_id:3355496], you will act as a model validator, checking a given flux distribution for thermodynamic consistency and calculating the total entropy production rate ($\\sigma$) to see how these local constraints contribute to the overall thermodynamic viability of the system.", "problem": "An isothermal, isobaric, open cellular system at steady state operates a small metabolic subnetwork at temperature $T = 310\\,\\mathrm{K}$. For each reaction $j$, you are given the net reaction flux $v_j$ (taken as positive in the forward direction as written) and the actual reaction Gibbs free energy change $\\Delta_r G_j$ under the given intracellular conditions, for the reaction written in the forward direction. The Second Law of Thermodynamics requires that the internal entropy production rate due to chemical reactions be non-negative and that for each reaction carrying a nonzero flux the product $v_j \\Delta_r G_j$ satisfies $v_j \\Delta_r G_j \\le 0$.\n\nThe data are:\n- Reaction $1$: $v_1 = 2.0 \\times 10^{-6}\\,\\mathrm{mol\\,s^{-1}}$, $\\Delta_r G_1 = -30\\,\\mathrm{kJ\\,mol^{-1}}$.\n- Reaction $2$: $v_2 = 1.0 \\times 10^{-6}\\,\\mathrm{mol\\,s^{-1}}$, $\\Delta_r G_2 = -50\\,\\mathrm{kJ\\,mol^{-1}}$.\n- Reaction $3$: $v_3 = 3.0 \\times 10^{-6}\\,\\mathrm{mol\\,s^{-1}}$, $\\Delta_r G_3 = -3\\,\\mathrm{kJ\\,mol^{-1}}$.\n- Reaction $4$: $v_4 = 1.5 \\times 10^{-6}\\,\\mathrm{mol\\,s^{-1}}$, $\\Delta_r G_4 = +20\\,\\mathrm{kJ\\,mol^{-1}}$.\n- Reaction $5$: $v_5 = -5.0 \\times 10^{-7}\\,\\mathrm{mol\\,s^{-1}}$, $\\Delta_r G_5 = +1\\,\\mathrm{kJ\\,mol^{-1}}$.\n\nUsing only fundamental nonequilibrium thermodynamics and definitions appropriate for chemical reactions, compute the total internal entropy production rate $\\sigma$ due to these chemical reactions. Express your final result for $\\sigma$ in $\\mathrm{J\\,s^{-1}\\,K^{-1}}$ and round your answer to four significant figures. In addition, verify compliance with the Second Law at the reaction level by identifying any reactions for which $v_j \\Delta_r G_j \\le 0$ is violated. Do not include intermediate steps or units in the final boxed answer; the verification should appear in your solution reasoning only.", "solution": "We begin from the Second Law of Thermodynamics for an isothermal, isobaric, open system. The internal entropy production rate due to irreversible processes is the sum over generalized fluxes multiplied by their conjugate thermodynamic forces. For chemical reactions, the generalized flux for reaction $j$ is the reaction rate (net flux) $v_j$ and the corresponding thermodynamic driving force (in units of energy) is the De Donder affinity $\\mathcal{A}_j$, defined by $\\mathcal{A}_j = -\\Delta_r G_j$, where $\\Delta_r G_j$ is the Gibbs free energy change for the reaction as written. The entropy production contribution of reaction $j$ is thus given by the product of the flux and the force divided by the absolute temperature:\n$$\n\\sigma_j \\;=\\; \\frac{v_j \\,\\mathcal{A}_j}{T} \\;=\\; \\frac{v_j \\left(-\\Delta_r G_j\\right)}{T} \\;=\\; -\\,\\frac{v_j \\,\\Delta_r G_j}{T}.\n$$\nThe total internal entropy production rate due to the set of chemical reactions is the sum over all reactions:\n$$\n\\sigma \\;=\\; \\sum_{j} \\sigma_j \\;=\\; -\\,\\frac{1}{T}\\,\\sum_{j} v_j\\,\\Delta_r G_j.\n$$\nThe Second Law requires $\\sigma \\ge 0$ and, for each reaction carrying a nonzero flux, the product $v_j \\Delta_r G_j \\le 0$, which ensures that the net flux proceeds down the Gibbs free energy gradient.\n\nWe now compute the products $v_j \\Delta_r G_j$ for each reaction, converting $\\Delta_r G_j$ to $\\mathrm{J\\,mol^{-1}}$:\n- Reaction $1$: $\\Delta_r G_1 = -30\\,\\mathrm{kJ\\,mol^{-1}} = -3.0 \\times 10^{4}\\,\\mathrm{J\\,mol^{-1}}$, $v_1 = 2.0 \\times 10^{-6}\\,\\mathrm{mol\\,s^{-1}}$.\n  $$\n  v_1 \\Delta_r G_1 = \\left(2.0 \\times 10^{-6}\\right)\\left(-3.0 \\times 10^{4}\\right)\\,\\mathrm{J\\,s^{-1}} = -6.0 \\times 10^{-2}\\,\\mathrm{J\\,s^{-1}}.\n  $$\n  This satisfies $v_1 \\Delta_r G_1 \\le 0$.\n- Reaction $2$: $\\Delta_r G_2 = -50\\,\\mathrm{kJ\\,mol^{-1}} = -5.0 \\times 10^{4}\\,\\mathrm{J\\,mol^{-1}}$, $v_2 = 1.0 \\times 10^{-6}\\,\\mathrm{mol\\,s^{-1}}$.\n  $$\n  v_2 \\Delta_r G_2 = \\left(1.0 \\times 10^{-6}\\right)\\left(-5.0 \\times 10^{4}\\right) = -5.0 \\times 10^{-2}\\,\\mathrm{J\\,s^{-1}}.\n  $$\n  This satisfies $v_2 \\Delta_r G_2 \\le 0$.\n- Reaction $3$: $\\Delta_r G_3 = -3\\,\\mathrm{kJ\\,mol^{-1}} = -3.0 \\times 10^{3}\\,\\mathrm{J\\,mol^{-1}}$, $v_3 = 3.0 \\times 10^{-6}\\,\\mathrm{mol\\,s^{-1}}$.\n  $$\n  v_3 \\Delta_r G_3 = \\left(3.0 \\times 10^{-6}\\right)\\left(-3.0 \\times 10^{3}\\right) = -9.0 \\times 10^{-3}\\,\\mathrm{J\\,s^{-1}}.\n  $$\n  This satisfies $v_3 \\Delta_r G_3 \\le 0$.\n- Reaction $4$: $\\Delta_r G_4 = +20\\,\\mathrm{kJ\\,mol^{-1}} = +2.0 \\times 10^{4}\\,\\mathrm{J\\,mol^{-1}}$, $v_4 = 1.5 \\times 10^{-6}\\,\\mathrm{mol\\,s^{-1}}$.\n  $$\n  v_4 \\Delta_r G_4 = \\left(1.5 \\times 10^{-6}\\right)\\left(2.0 \\times 10^{4}\\right) = +3.0 \\times 10^{-2}\\,\\mathrm{J\\,s^{-1}}.\n  $$\n  This violates $v_4 \\Delta_r G_4 \\le 0$, because it is positive, indicating an endergonic net flux as written.\n- Reaction $5$: $\\Delta_r G_5 = +1\\,\\mathrm{kJ\\,mol^{-1}} = +1.0 \\times 10^{3}\\,\\mathrm{J\\,mol^{-1}}$, $v_5 = -5.0 \\times 10^{-7}\\,\\mathrm{mol\\,s^{-1}}$.\n  $$\n  v_5 \\Delta_r G_5 = \\left(-5.0 \\times 10^{-7}\\right)\\left(1.0 \\times 10^{3}\\right) = -5.0 \\times 10^{-4}\\,\\mathrm{J\\,s^{-1}}.\n  $$\n  This satisfies $v_5 \\Delta_r G_5 \\le 0$ (note the negative flux implies the net direction is opposite to the written reaction, consistent with the positive $\\Delta_r G_5$).\n\nThe sum of the products is:\n$$\n\\sum_{j=1}^{5} v_j \\Delta_r G_j = \\left(-6.0 \\times 10^{-2}\\right) + \\left(-5.0 \\times 10^{-2}\\right) + \\left(-9.0 \\times 10^{-3}\\right) + \\left(+3.0 \\times 10^{-2}\\right) + \\left(-5.0 \\times 10^{-4}\\right)\\,\\mathrm{J\\,s^{-1}}.\n$$\nNumerically,\n$$\n\\sum_{j=1}^{5} v_j \\Delta_r G_j = -8.95 \\times 10^{-2}\\,\\mathrm{J\\,s^{-1}}.\n$$\nTherefore,\n$$\n\\sigma = -\\,\\frac{1}{T}\\,\\sum_{j} v_j \\Delta_r G_j = -\\,\\frac{1}{310}\\,\\left(-8.95 \\times 10^{-2}\\right)\\,\\mathrm{J\\,s^{-1}\\,K^{-1}} = \\frac{8.95 \\times 10^{-2}}{310}\\,\\mathrm{J\\,s^{-1}\\,K^{-1}}.\n$$\nCarrying out the division,\n$$\n\\sigma = 2.88709677419 \\times 10^{-4}\\,\\mathrm{J\\,s^{-1}\\,K^{-1}}.\n$$\nRounded to four significant figures, this is\n$$\n\\sigma = 2.887 \\times 10^{-4}\\,\\mathrm{J\\,s^{-1}\\,K^{-1}}.\n$$\n\nVerification of Second Law constraints:\n- Reaction-level constraints $v_j \\Delta_r G_j \\le 0$ are satisfied for reactions $1$, $2$, $3$, and $5$, and violated for reaction $4$.\n- The total entropy production rate $\\sigma$ is positive, $\\sigma  0$, as required by the Second Law for the overall system.\n\nThus, the computed $\\sigma$ is as above, and reaction $4$ is flagged as violating $v_j \\Delta_r G_j \\le 0$ under the given signs.", "answer": "$$\\boxed{2.887\\times 10^{-4}}$$", "id": "3355496"}, {"introduction": "Constraint-based models can sometimes predict flux distributions that, while satisfying mass balance ($S v = 0$), contain internal 'futile cycles' that violate thermodynamics. These cycles represent a perpetual motion machine of the second kind and must be eliminated for a model to be physically realistic. This final practice [@problem_id:3355529] takes you from theory to implementation, guiding you through the process of using Linear Programming (LP) to design a computational test that automatically detects and eliminates such thermodynamically infeasible loops from a metabolic network.", "problem": "Consider a metabolic network under the steady-state assumption where the stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$ encodes the conservation of mass for $m$ metabolites and $n$ reactions, and the flux vector $v \\in \\mathbb{R}^n$ satisfies $S v = 0$. Each reaction $r$ has an associated Gibbs free energy change (denoted $\\Delta G_r$) in $\\mathrm{kJ/mol}$. A hidden futile cycle is defined here as a nonzero flux vector $v \\ne 0$ with $S v = 0$ such that the total energy dissipation $\\sum_{r=1}^n v_r \\Delta G_r  0$ while obeying the prescribed reaction reversibility constraints. The existence of such a vector implies that the network admits internal energy-dissipating flux loops that do not contribute to net conversion of metabolites, potentially compromising optimization results in Flux Balance Analysis (FBA).\n\nStarting from the steady-state mass conservation $S v = 0$ and the Second Law of Thermodynamics (Clausius inequality) which requires that feasible spontaneous directions reduce Gibbs free energy (i.e., forward flux $v_r  0$ requires $\\Delta G_r  0$ if unconstrained by coupling), design a computational test to detect hidden futile cycles and then add a thermodynamic inequality constraint to eliminate those cycles in an optimization problem. Quantify the impact on the optimal objective when this constraint is added.\n\nYour program must implement the following two components:\n\n1) Hidden futile cycle detection. Formulate and solve a Linear Programming (LP) problem that searches for $v \\ne 0$ with $S v = 0$ minimizing the energy sum $\\sum_{r=1}^n v_r \\Delta G_r$ under the normalization constraint $\\sum_{r=1}^n |v_r| = 1$ and reaction directionality bounds, with forward-only irreversibility enforced where indicated. Report whether the minimum is strictly less than $0$ (use a numerical tolerance of $10^{-9}$) indicating the presence of a hidden futile cycle.\n\n2) Impact on an energy-dissipation objective due to thermodynamic elimination. Consider an objective $J(v) = -\\sum_{r=1}^n v_r \\Delta G_r$ expressed in $\\mathrm{kJ/mol}$, to be maximized under $S v = 0$ and flux bounds. Compute the optimal value $J_{\\mathrm{pre}}$ without thermodynamic elimination. Then add the linear inequality constraint $\\sum_{r=1}^n v_r \\Delta G_r \\ge 0$ to eliminate energy-dissipating cycles and compute the new optimal value $J_{\\mathrm{post}}$. Report both $J_{\\mathrm{pre}}$ and $J_{\\mathrm{post}}$ (in $\\mathrm{kJ/mol}$), and the impact defined as $J_{\\mathrm{pre}} - J_{\\mathrm{post}}$ (in $\\mathrm{kJ/mol}$). If no feasible solution exists after adding the constraint, the impact should be reported as a floating-point Not-a-Number (NaN).\n\nAll optimization problems must be posed and solved in purely mathematical terms. In particular:\n- Use equality constraints for steady-state ($S v = 0$).\n- Use the normalization constraint $\\sum_{r=1}^n |v_r| = 1$ only for the detection LP.\n- Use explicit lower and upper bounds for reaction fluxes for the optimization of $J(v)$.\n- Enforce irreversibility by restricting the sign of $v_r$ where indicated.\n\nImplement the detection LP via variable splitting $v = v^+ - v^-$ with $v^+, v^- \\ge 0$ so that $\\sum_{r=1}^n |v_r| = \\sum_{r=1}^n (v_r^+ + v_r^-)$ becomes a linear equality, $S v = 0$ becomes $S v^+ - S v^- = 0$, and irreversibility $v_r \\ge 0$ is represented by fixing $v_r^- = 0$.\n\nTest Suite. Use the following three test cases, each with the same $S$ but different $\\Delta G$ vectors. In all cases, the flux bounds for the objective optimization are $0 \\le v_r \\le 3$ (dimensionless scaled flux units), and reactions are forward-only irreversible.\n\n- Case 1 (energy-dissipating cycle present):\n  $$\n  S = \\begin{bmatrix}\n  -1  0  1 \\\\\n  1  -1  0 \\\\\n  0  1  -1\n  \\end{bmatrix},\\quad\n  \\Delta G = \\begin{bmatrix}\n  -10 \\\\\n  -5 \\\\\n  -7\n  \\end{bmatrix}\\ \\mathrm{kJ/mol}.\n  $$\n- Case 2 (no energy-dissipating cycle; net positive energy around loop):\n  $$\n  S = \\begin{bmatrix}\n  -1  0  1 \\\\\n  1  -1  0 \\\\\n  0  1  -1\n  \\end{bmatrix},\\quad\n  \\Delta G = \\begin{bmatrix}\n  20 \\\\\n  -5 \\\\\n  -7\n  \\end{bmatrix}\\ \\mathrm{kJ/mol}.\n  $$\n- Case 3 (near thermodynamic neutrality; net zero energy around loop within numerical tolerance):\n  $$\n  S = \\begin{bmatrix}\n  -1  0  1 \\\\\n  1  -1  0 \\\\\n  0  1  -1\n  \\end{bmatrix},\\quad\n  \\Delta G = \\begin{bmatrix}\n  -0.001 \\\\\n  -0.001 \\\\\n  0.002\n  \\end{bmatrix}\\ \\mathrm{kJ/mol}.\n  $$\n\nOutput requirements:\n- For each test case, produce a list $[b, J_{\\mathrm{pre}}, J_{\\mathrm{post}}, \\Delta J]$ where $b$ is a boolean indicating detection of a hidden cycle, $J_{\\mathrm{pre}}$ is the optimal value of $J(v)$ before adding the thermodynamic inequality, $J_{\\mathrm{post}}$ is the optimal value after adding the inequality, and $\\Delta J = J_{\\mathrm{pre}} - J_{\\mathrm{post}}$.\n- All energy-related quantities must be expressed in $\\mathrm{kJ/mol}$, rounded to six decimal places as real numbers.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[\\text{result1},\\text{result2},\\text{result3}]$), where each $\\text{resulti}$ is itself a list in the format above.\n\nNo user input should be read; all parameters are embedded as constants in the program. Use Scientific Python (SciPy) Linear Programming via $ \\texttt{scipy.optimize.linprog} $ and Numerical Python (NumPy) for linear algebra. Ensure scientific realism by strictly enforcing the constraints stated and by using the units specified for reporting energy-related outputs.", "solution": "The problem requires the development of a computational method to detect and mitigate the effects of thermodynamically-driven hidden futile cycles in a metabolic network model. The solution is presented in two parts: first, the formulation of a Linear Programming (LP) problem for cycle detection, and second, the formulation of LPs to quantify the impact of a thermodynamic constraint on a given optimization objective.\n\n### Underlying Principles\n\nA metabolic network at steady state is governed by the mass conservation law, expressed as $S v = 0$, where $S \\in \\mathbb{R}^{m \\times n}$ is the stoichiometric matrix for $m$ metabolites and $n$ reactions, and $v \\in \\mathbb{R}^n$ is the vector of reaction fluxes. The null space of $S$, denoted $\\mathrm{ker}(S)$, contains all flux vectors that satisfy the steady-state condition.\n\nThe second law of thermodynamics imposes constraints on the direction of spontaneous processes. For a chemical reaction $r$, the Gibbs free energy change, $\\Delta G_r$, determines its spontaneity. The total rate of Gibbs free energy dissipation for the network is given by $\\sum_{r=1}^n v_r \\Delta G_r$. For any spontaneous process, this sum must be negative ($\\sum v_r \\Delta G_r  0$).\n\nA futile cycle is a non-zero flux vector $v \\in \\mathrm{ker}(S)$ ($v \\neq 0$) that corresponds to an internal loop in the network. If such a cycle is also thermodynamically favorable (i.e., $\\Delta G^T v  0$), it represents a pathway that dissipates energy without net production of biomass or other target molecules. This can lead to unrealistic solutions in optimization frameworks like Flux Balance Analysis (FBA), where an objective function might exploit this energy dissipation to reach artificially high values.\n\nThe provided stoichiometric matrix is:\n$$\nS = \\begin{bmatrix}\n-1  0  1 \\\\\n1  -1  0 \\\\\n0  1  -1\n\\end{bmatrix}\n$$\nThe null space of $S$ consists of vectors $v$ where $v_1 = v_2 = v_3$. A basis for this null space is the vector $[1, 1, 1]^T$. Thus, any flux vector representing a cycle in this network is of the form $v = k \\cdot [1, 1, 1]^T$ for some scalar $k$.\n\n### Part 1: Hidden Futile Cycle Detection\n\nTo detect a hidden futile cycle, we search for a non-trivial flux vector $v \\neq 0$ that satisfies the steady-state condition $S v = 0$, respects reaction directionality, and minimizes the Gibbs free energy dissipation rate $\\Delta G^T v$. A strictly negative minimum indicates a thermodynamically feasible futile cycle.\n\nThe problem is formulated as the following LP:\n$$\n\\begin{aligned}\n\\text{minimize} \\quad  Z_1 = \\sum_{r=1}^n v_r \\Delta G_r = \\Delta G^T v \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n \\sum_{r=1}^n |v_r| = 1 \\\\\n v_r \\ge 0, \\quad \\text{for all } r=1, \\dots, n\n\\end{aligned}\n$$\nThe normalization constraint $\\sum_{r=1}^n |v_r| = 1$ ensures a non-trivial solution ($v \\neq 0$) and makes the LP bounded. Since the test cases specify all reactions are forward-only irreversible ($v_r \\ge 0$), the absolute value simplifies, and the constraint becomes $\\sum_{r=1}^n v_r = 1$.\n\nThe problem states that the LP should be implemented using variable splitting, where each flux $v_r$ is split into a forward component $v_r^+$ and a reverse component $v_r^-$, such that $v_r = v_r^+ - v_r^-$ with $v_r^+, v_r^- \\ge 0$. The LP then takes the general form:\n$$\n\\begin{aligned}\n\\text{minimize} \\quad  \\sum_{r=1}^n (v_r^+ \\Delta G_r - v_r^- \\Delta G_r) = [\\Delta G^T, -\\Delta G^T] \\begin{bmatrix} v^+ \\\\ v^- \\end{bmatrix} \\\\\n\\text{subject to} \\quad  S v^+ - S v^- = 0 \\\\\n \\sum_{r=1}^n (v_r^+ + v_r^-) = 1 \\\\\n v_r^+, v_r^- \\ge 0, \\quad \\text{for all } r\n\\end{aligned}\n$$\nFor the given test cases, all reactions are irreversible, so $v_r \\ge 0$. This is enforced by setting $v_r^- = 0$ for all $r$. The formulation simplifies back to the one involving only $v$ (which corresponds to $v^+$). A futile cycle is detected if the optimal value $Z_{1,opt}  -10^{-9}$.\n\nFor the specific $S$ matrix where $v = k[1, 1, 1]^T$, the constraint $\\sum v_r = 1$ implies $3k=1$, so $k=1/3$. The only feasible point is $v = [1/3, 1/3, 1/3]^T$. The objective value is $Z_1 = (1/3)\\sum \\Delta G_r$. Thus, a cycle is detected if and only if $\\sum \\Delta G_r  0$.\n\n### Part 2: Impact Assessment of Thermodynamic Constraint\n\nThis part assesses how adding a thermodynamic constraint affects the optimal value of an objective function. The objective is to maximize the total energy dissipation, $J(v) = -\\sum_{r=1}^n v_r \\Delta G_r$. This is equivalent to minimizing $\\Delta G^T v$.\n\n**A. Pre-Constraint Optimization ($J_{\\mathrm{pre}}$)**\n\nFirst, we find the optimal value without the thermodynamic constraint. The LP is:\n$$\n\\begin{aligned}\n\\text{maximize} \\quad  J(v) = - \\Delta G^T v \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n 0 \\le v_r \\le 3, \\quad \\text{for all } r=1, \\dots, n\n\\end{aligned}\n$$\nThis is equivalent to minimizing $Z_2 = \\Delta G^T v$. The optimal pre-constraint value is $J_{\\mathrm{pre}} = -\\min(Z_2)$. The feasible flux vectors are $v=k[1,1,1]^T$ with $0 \\le k \\le 3$. The objective becomes $Z_2 = k \\sum \\Delta G_r$.\n- If $\\sum \\Delta G_r  0$, $Z_2$ is minimized at the maximum possible $k$, which is $k=3$. Then $J_{\\mathrm{pre}} = -3 \\sum \\Delta G_r$.\n- If $\\sum \\Delta G_r \\ge 0$, $Z_2$ is minimized at the minimum non-negative $k$, which is $k=0$. Then $J_{\\mathrm{pre}} = 0$.\n\n**B. Post-Constraint Optimization ($J_{\\mathrm{post}}$)**\n\nNext, we add the thermodynamic constraint that eliminates energy-dissipating cycles. This constraint is $\\sum_{r=1}^n v_r \\Delta G_r \\ge 0$. The new LP is:\n$$\n\\begin{aligned}\n\\text{maximize} \\quad  J(v) = - \\Delta G^T v \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n 0 \\le v_r \\le 3, \\quad \\text{for all } r=1, \\dots, n \\\\\n \\Delta G^T v \\ge 0\n\\end{aligned}\n$$\nWe are maximizing $J(v)$ while also constraining it: the condition $\\Delta G^T v \\ge 0$ is equivalent to $-\\Delta G^T v \\le 0$, which is $J(v) \\le 0$. The problem becomes maximizing a function that is constrained to be non-positive. The highest possible value is $0$. This value is achievable at the point $v=0$, which is always feasible as it satisfies $S \\cdot 0 = 0$, the bounds $0 \\le 0 \\le 3$, and the added constraint $\\Delta G^T \\cdot 0 = 0 \\ge 0$. Therefore, the optimal post-constraint value is always $J_{\\mathrm{post}} = 0$.\n\n**C. Impact Calculation**\n\nThe impact $\\Delta J$ is the difference between the optimal values before and after applying the constraint:\n$$\n\\Delta J = J_{\\mathrm{pre}} - J_{\\mathrm{post}}\n$$\nIf the post-constraint problem were to be infeasible, the impact would be NaN. However, for the given problem structure, it is always feasible.\nThe impact will be non-zero only when $J_{\\mathrm{pre}}  0$, which occurs if and only if a thermodynamically favorable futile cycle ($\\sum \\Delta G_r  0$) exists that the unconstrained optimization can exploit.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis for all test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    S_matrix = np.array([\n        [-1, 0, 1],\n        [1, -1, 0],\n        [0, 1, -1]\n    ])\n\n    test_cases = [\n        # Case 1: Energy-dissipating cycle present\n        {\n            \"S\": S_matrix,\n            \"delta_G\": np.array([-10, -5, -7])\n        },\n        # Case 2: No energy-dissipating cycle\n        {\n            \"S\": S_matrix,\n            \"delta_G\": np.array([20, -5, -7])\n        },\n        # Case 3: Near thermodynamic neutrality\n        {\n            \"S\": S_matrix,\n            \"delta_G\": np.array([-0.001, -0.001, 0.002])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = analyze_network(case[\"S\"], case[\"delta_G\"])\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The string representation of a list in Python includes spaces.\n    # To match the typical compact representation, we remove them.\n    # However, standard `str(list)` is often the intended format.\n    # Example in problem statement shows no spaces after commas.\n    # e.g., '[1.23,4.56]'\n    # Let's generate a string representation manually for full control.\n    def format_list(lst):\n        items = []\n        for item in lst:\n            if isinstance(item, bool):\n                items.append(str(item).lower()) # Python bools are True/False, problem example seems to imply lowercase\n            elif isinstance(item, float):\n                # Format float to 6 decimal places, avoiding scientific notation for small numbers\n                items.append(f\"{item:.6f}\")\n            else:\n                items.append(repr(item)) # Fallback for other types\n        return f\"[{','.join(items)}]\"\n    \n    final_output_str = f\"[{','.join([format_list(r) for r in results])}]\"\n    # The problem description is slightly ambiguous. Standard Python `str(list)` for [True, 66.0, 0.0, 66.0]\n    # is `[True, 66.0, 0.0, 66.0]`. Removing spaces gives `[True,66.0,0.0,66.0]`. Let's stick to this.\n    final_output_str = str(results).replace(\" \", \"\")\n\n    print(final_output_str)\n\n\ndef analyze_network(S, delta_G):\n    \"\"\"\n    Performs the two-part analysis for a given metabolic network setup.\n    1. Detects hidden futile cycles.\n    2. Quantifies the impact of thermodynamic constraints on an objective.\n\n    Args:\n        S (np.ndarray): The stoichiometric matrix (m x n).\n        delta_G (np.ndarray): The vector of Gibbs free energy changes (n,).\n\n    Returns:\n        list: [b, J_pre, J_post, delta_J]\n              b (bool): True if a futile cycle is detected.\n              J_pre (float): Optimal objective value before constraint.\n              J_post (float): Optimal objective value after constraint.\n              delta_J (float): Impact J_pre - J_post.\n    \"\"\"\n    n_reactions = S.shape[1]\n    n_metabolites = S.shape[0]\n    tolerance = 1e-9\n\n    # Part 1: Hidden Futile Cycle Detection\n    # Minimize: c_det^T * v = delta_G^T * v\n    # Subject to:\n    # S*v = 0\n    # sum(v) = 1 (since v_r >= 0 for irreversible reactions)\n    # v_r >= 0\n    c_det = delta_G\n    A_eq_det = np.vstack([S, np.ones((1, n_reactions))])\n    b_eq_det = np.zeros(n_metabolites + 1)\n    b_eq_det[-1] = 1\n    bounds_det = [(0, None) for _ in range(n_reactions)]\n\n    res_det = linprog(c=c_det, A_eq=A_eq_det, b_eq=b_eq_det, bounds=bounds_det, method='highs')\n    \n    is_cycle_detected = bool(res_det.success and res_det.fun  -tolerance)\n\n    # Part 2: Impact on Energy-Dissipation Objective\n    # Objective: Maximize J(v) = -delta_G^T * v, which is equivalent to\n    # minimizing Z(v) = delta_G^T * v.\n    c_opt = delta_G\n    A_eq_opt = S\n    b_eq_opt = np.zeros(n_metabolites)\n    bounds_opt = [(0, 3) for _ in range(n_reactions)]\n\n    # Compute J_pre (without thermodynamic constraint)\n    res_pre = linprog(c=c_opt, A_eq=A_eq_opt, b_eq=b_eq_opt, bounds=bounds_opt, method='highs')\n    \n    J_pre = -res_pre.fun if res_pre.success else np.nan\n\n    # Compute J_post (with thermodynamic constraint delta_G^T * v >= 0)\n    # This constraint is written as -delta_G^T * v = 0 for linprog's A_ub\n    A_ub_post = -delta_G.reshape(1, -1)\n    b_ub_post = np.array([0])\n    \n    res_post = linprog(c=c_opt, A_eq=A_eq_opt, b_eq=b_eq_opt, \n                       A_ub=A_ub_post, b_ub=b_ub_post, \n                       bounds=bounds_opt, method='highs')\n                       \n    if res_post.status == 2: # Infeasible\n        J_post = np.nan\n        delta_J = np.nan\n    elif res_post.success:\n        J_post = -res_post.fun\n        # Handle potential floating point imprecision for results known to be zero\n        if abs(J_post)  tolerance:\n            J_post = 0.0\n        delta_J = J_pre - J_post\n    else: # Other failure\n        J_post = np.nan\n        delta_J = np.nan\n\n    # Round results to 6 decimal places\n    J_pre_rounded = round(J_pre, 6)\n    J_post_rounded = round(J_post, 6) if not np.isnan(J_post) else np.nan\n    delta_J_rounded = round(delta_J, 6) if not np.isnan(delta_J) else np.nan\n\n    return [is_cycle_detected, J_pre_rounded, J_post_rounded, delta_J_rounded]\n\n# The problem requires calling solve() to produce the output.\n# In a typical execution environment, this would be the entry point.\n# For this structured response, we call it to ensure the logic runs.\nif __name__ == '__main__':\n    solve()\n```", "id": "3355529"}]}