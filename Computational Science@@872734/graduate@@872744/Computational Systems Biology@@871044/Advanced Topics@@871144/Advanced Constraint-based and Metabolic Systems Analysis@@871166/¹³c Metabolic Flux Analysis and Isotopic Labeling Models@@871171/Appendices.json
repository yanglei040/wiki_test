{"hands_on_practices": [{"introduction": "This exercise tackles a critical first step in analyzing mass spectrometry data: removing the \"noise\" from naturally occurring heavy isotopes in elements other than our carbon tracer. We will use the elegant mathematics of generating functions to build a correction matrix from first principles, a technique essential for obtaining the true labeling distribution caused by the $^{13}\\mathrm{C}$ tracer. This practice will strengthen your understanding of how probability distributions convolve and how linear algebra can be used to systematically correct experimental data [@problem_id:3287063].", "problem": "A central task in isotope-resolved Mass Spectrometry (MS) for one-carbon tracer experiments in computational systems biology is the removal of natural abundance contributions from non-tracer elements to recover the true carbon-label Mass Isotopomer Distribution (MID). Consider an MS fragment with elemental composition $n_{C}=3$, $n_{H}=2$, and $n_{O}=1$. The tracer element is carbon, with variable labeling by carbon-13 ($^{13}\\mathrm{C}$). Natural abundance contributions from non-carbon heavy isotopes are modeled as independent Bernoulli trials per atom, with the following natural abundance probabilities: $p_{^{2}\\!H} = 1.5 \\times 10^{-4}$ for deuterium in hydrogen, $p_{^{17}\\!O} = 3.8 \\times 10^{-4}$ for oxygen-17 in oxygen, and $p_{^{18}\\!O} = 2.05 \\times 10^{-3}$ for oxygen-18 in oxygen. For hydrogen, the heavy isotope contributes a $+1$ mass shift; for oxygen, $^{17}\\mathrm{O}$ contributes $+1$ and $^{18}\\mathrm{O}$ contributes $+2$.\n\nStarting from first principles, use the independence of isotopic substitutions across atoms and the multinomial expansion to derive the non-carbon mass-shift generating polynomial $G(z)$ for this fragment and show that the mapping from the carbon-label MID $\\mathbf{x} = (x_{0}, x_{1}, x_{2}, x_{3})^{\\mathsf{T}}$ to the measured first four bins of the MID $\\mathbf{m} = (m_{0}, m_{1}, m_{2}, m_{3})^{\\mathsf{T}}$ is a lower-triangular Toeplitz system $\\mathbf{m} = C\\,\\mathbf{x}$, where $C$ is the natural abundance correction matrix constructed from the coefficients of $G(z)$. Explicitly derive $C$ and provide the constructive inversion procedure to obtain $\\mathbf{x} = C^{-1}\\mathbf{m}$.\n\nFor a single spectrum, the measured first four MID bins are\n$$\nm_{0} = 0.299181225,\\quad\nm_{1} = 0.399112034,\\quad\nm_{2} = 0.250204189,\\quad\nm_{3} = 0.050853309.\n$$\nCompute the corrected carbon-label fraction $x_{2}$ (the $M+2$ bin attributable solely to labeled $^{13}\\mathrm{C}$ in the three carbons). Express your final answer as a decimal and round your answer to four significant figures.", "solution": "The goal is to construct the natural abundance correction matrix for non-carbon heavy isotopes and use it to recover the true carbon-label Mass Isotopomer Distribution (MID). The fundamental base comprises: (i) independence of isotopic substitutions across atoms, (ii) the binomial/multinomial laws for independent substitutions, and (iii) convolution of independent mass-shift distributions via generating functions.\n\nDefine the Mass Isotopomer Distribution (MID) as the vector of probabilities $\\mathbf{x} = (x_{0}, x_{1}, x_{2}, x_{3})^{\\mathsf{T}}$ that the fragment contains $0,1,2,3$ labeled $^{13}\\mathrm{C}$ among its $n_{C} = 3$ carbons; this is the quantity to be estimated. Let the non-carbon heavy isotopes contribute additional mass shifts stochastically: each of the $n_{H} = 2$ hydrogen atoms independently is $^{2}\\mathrm{H}$ with probability $p_{^{2}\\!H}$ and contributes a $+1$ shift; the $n_{O} = 1$ oxygen atom is $^{17}\\mathrm{O}$ with probability $p_{^{17}\\!O}$ contributing $+1$, or $^{18}\\mathrm{O}$ with probability $p_{^{18}\\!O}$ contributing $+2$, and otherwise $^{16}\\mathrm{O}$ with probability $1 - p_{^{17}\\!O} - p_{^{18}\\!O}$ contributing $+0$.\n\nIndependence implies that the total non-carbon mass-shift distribution is the convolution (polynomial product) of the element-specific generating functions. The hydrogen generating polynomial for $n_{H}=2$ with $+1$ shift per heavy isotope is\n$$\nH(z) \\;=\\; \\left((1 - p_{^{2}\\!H}) + p_{^{2}\\!H} z\\right)^{2}\n\\;=\\; a_{0} + a_{1} z + a_{2} z^{2},\n$$\nwith coefficients\n$$\na_{0} \\;=\\; (1 - p_{^{2}\\!H})^{2},\\quad\na_{1} \\;=\\; 2 p_{^{2}\\!H} (1 - p_{^{2}\\!H}),\\quad\na_{2} \\;=\\; p_{^{2}\\!H}^{2}.\n$$\nThe oxygen generating polynomial for $n_{O}=1$ with $+1$ from $^{17}\\mathrm{O}$ and $+2$ from $^{18}\\mathrm{O}$ is\n$$\nO(z) \\;=\\; (1 - p_{^{17}\\!O} - p_{^{18}\\!O}) + p_{^{17}\\!O} z + p_{^{18}\\!O} z^{2}\n\\;=\\; b_{0} + b_{1} z + b_{2} z^{2},\n$$\nwhere\n$$\nb_{0} \\;=\\; 1 - p_{^{17}\\!O} - p_{^{18}\\!O},\\quad\nb_{1} \\;=\\; p_{^{17}\\!O},\\quad\nb_{2} \\;=\\; p_{^{18}\\!O}.\n$$\nThe total non-carbon generating polynomial is the product\n$$\nG(z) \\;=\\; H(z)\\,O(z) \\;=\\; (a_{0} + a_{1} z + a_{2} z^{2})(b_{0} + b_{1} z + b_{2} z^{2})\n\\;=\\; \\sum_{k=0}^{4} c_{k} z^{k},\n$$\nwith convolution coefficients\n$$\nc_{0} \\;=\\; a_{0} b_{0},\\quad\nc_{1} \\;=\\; a_{1} b_{0} + a_{0} b_{1},\\quad\nc_{2} \\;=\\; a_{2} b_{0} + a_{1} b_{1} + a_{0} b_{2},\\quad\nc_{3} \\;=\\; a_{2} b_{1} + a_{1} b_{2},\\quad\nc_{4} \\;=\\; a_{2} b_{2}.\n$$\nBy construction, $\\sum_{k=0}^{4} c_{k} = 1$. The measured MID $\\mathbf{m}$ for the first four mass bins ($M+0$ through $M+3$) is the convolution of the carbon-label distribution $\\mathbf{x}$ with the non-carbon distribution specified by $G(z)$, restricted to those bins. This yields the lower-triangular Toeplitz system\n$$\n\\begin{pmatrix}\nm_{0} \\\\\nm_{1} \\\\\nm_{2} \\\\\nm_{3}\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\nc_{0} & 0 & 0 & 0 \\\\\nc_{1} & c_{0} & 0 & 0 \\\\\nc_{2} & c_{1} & c_{0} & 0 \\\\\nc_{3} & c_{2} & c_{1} & c_{0}\n\\end{pmatrix}\n\\begin{pmatrix}\nx_{0} \\\\\nx_{1} \\\\\nx_{2} \\\\\nx_{3}\n\\end{pmatrix}\n\\;\\equiv\\; C\\,\\mathbf{x}.\n$$\nThis follows directly from matching coefficients of $z^{i}$ in the product $G(z)\\cdot \\sum_{j=0}^{3} x_{j} z^{j}$ for $i = 0,1,2,3$, giving $m_{i} = \\sum_{j=0}^{i} c_{i-j}\\,x_{j}$.\n\nTo invert $C$, note it is lower-triangular with nonzero diagonal $c_{0}>0$, hence invertible by forward substitution. The constructive inversion is:\n$$x_{0} \\;=\\; \\frac{m_{0}}{c_{0}}$$\n$$x_{1} \\;=\\; \\frac{m_{1} - c_{1} x_{0}}{c_{0}}$$\n$$x_{2} \\;=\\; \\frac{m_{2} - c_{2} x_{0} - c_{1} x_{1}}{c_{0}}$$\n$$x_{3} \\;=\\; \\frac{m_{3} - c_{3} x_{0} - c_{2} x_{1} - c_{1} x_{2}}{c_{0}}$$\nWe now compute the coefficients numerically using the provided natural abundances:\n$$p_{^{2}\\!H} = 1.5 \\times 10^{-4},\\quad\np_{^{17}\\!O} = 3.8 \\times 10^{-4},\\quad\np_{^{18}\\!O} = 2.05 \\times 10^{-3}.\n$$\nHydrogen coefficients:\n$$a_{0} = (1 - 1.5\\times 10^{-4})^{2} \\approx 0.99970002$$\n$$a_{1} = 2(1.5\\times 10^{-4})(1 - 1.5\\times 10^{-4}) \\approx 0.00029996$$\n$$a_{2} = (1.5\\times 10^{-4})^{2} = 2.25\\times 10^{-8}$$\nOxygen coefficients:\n$$b_{0} = 1 - 3.8\\times 10^{-4} - 2.05\\times 10^{-3} = 0.99757$$\n$$b_{1} = 3.8\\times 10^{-4}$$\n$$b_{2} = 2.05\\times 10^{-3}$$\nConvolution gives the final coefficients for the correction matrix (using higher precision for calculation):\n$$c_{0} = a_{0} b_{0} \\approx 0.99727075$$\n$$c_{1} = a_{1} b_{0} + a_{0} b_{1} \\approx 0.00067911$$\n$$c_{2} = a_{2} b_{0} + a_{1} b_{1} + a_{0} b_{2} \\approx 0.00204952$$\n$$c_{3} = a_{2} b_{1} + a_{1} b_{2} \\approx 6.1491\\times 10^{-7}$$\nWe now apply the constructive inversion to the given measured MID:\n$$m_{0} = 0.299181225,\\quad m_{1} = 0.399112034,\\quad m_{2} = 0.250204189,\\quad m_{3} = 0.050853309.$$\nCompute sequentially:\n$$\nx_{0} \\;=\\; \\frac{m_{0}}{c_{0}} \\;=\\; \\frac{0.299181225}{0.99727075144} \\;\\approx\\; 0.300000000\n$$\n$$\nx_{1} \\;=\\; \\frac{m_{1} - c_{1} x_{0}}{c_{0}} \\;=\\; \\frac{0.399112034 - (0.00067911214 \\times 0.300000000)}{0.99727075144} \\;\\approx\\; 0.400000000\n$$\n$$\nx_{2} \\;=\\; \\frac{m_{2} - c_{2} x_{0} - c_{1} x_{1}}{c_{0}} \\;=\\; \\frac{0.250204189 - (0.00204952147 \\times 0.300000000) - (0.00067911214 \\times 0.400000000)}{0.99727075144} \\;\\approx\\; 0.250000000\n$$\nTherefore, the corrected $M+2$ carbon-label fraction is $x_{2} \\approx 0.25$. Rounded to four significant figures as instructed, the final answer is $0.2500$.", "answer": "$$\\boxed{0.2500}$$", "id": "3287063"}, {"introduction": "With corrected data, the next step is to model how isotopic labels propagate through metabolic reactions. This problem presents a foundational scenario in the Elementary Metabolite Unit (EMU) framework: the mixing of labeled and unlabeled sources of a metabolite and the subsequent condensation reaction. By deriving the labeling pattern of the product, you will gain hands-on experience with two core operations in metabolic flux analysis modeling: flux-weighted averaging and convolution [@problem_id:3287030].", "problem": "Consider a simplified isotopic labeling model at isotopic steady state in which acetyl coenzyme A (acetyl-CoA, a two-carbon fragment) is formed from two inflows into a single Elementary Metabolite Unit (EMU) pool. One inflow is labeled acetyl-CoA produced by pyruvate dehydrogenase at flux $v_{L}$, whose two-carbon mass isotopomer distribution (MID) is known and denoted by $\\mathbf{m}^{(L)} = \\big(m_{0}^{(L)}, m_{1}^{(L)}, m_{2}^{(L)}\\big)^{\\top}$. The other inflow is unlabeled acetyl-CoA produced from externally taken-up acetate at flux $v_{U}$, whose MID is $\\mathbf{e}_{0} = (1,0,0)^{\\top}$. Define the fractional contribution of the unlabeled inflow as $\\alpha = \\dfrac{v_{U}}{v_{U} + v_{L}} \\in [0,1]$. The downstream metabolite acetoacetyl-CoA (a four-carbon product) is formed by the thiolase condensation of two ($2$) acetyl-CoA molecules without carbon loss or scrambling, so that the acetoacetyl-CoA MID is obtained by the standard convolution of the acetyl-CoA two-carbon MID with itself under the Elementary Metabolite Unit (EMU) framework.\n\nUsing only the core definitions of isotopic steady state, linear mixing of inflows at the EMU level, and the convolution rule for independent fragment assembly of mass isotopomer distributions, derive the closed-form analytical expression for the fraction of the $M+0$ isotopomer of acetoacetyl-CoA as a function of $\\alpha$ and $m_{0}^{(L)}$. Express your final answer as a single analytic expression in terms of $\\alpha$ and $m_{0}^{(L)}$ only. No numerical evaluation is required, and no units are needed.", "solution": "Let $\\mathbf{m}^{(\\text{acCoA})}$ be the MID of the acetyl-CoA pool at isotopic steady state. This pool is a mixture of a labeled inflow (fraction $1-\\alpha$, MID $\\mathbf{m}^{(L)}$) and an unlabeled inflow (fraction $\\alpha$, MID $\\mathbf{e}_{0}=(1,0,0)^{\\top}$). The MID of the mixed pool is the flux-weighted average of its inflows:\n$$\n\\mathbf{m}^{(\\text{acCoA})} = (1 - \\alpha) \\mathbf{m}^{(L)} + \\alpha \\mathbf{e}_{0}\n$$\nWe are interested in the $M+0$ fraction of this pool, which we denote as $m_{0}^{(\\text{acCoA})}$. This is the first component of the vector $\\mathbf{m}^{(\\text{acCoA})}$. By looking at the first component of each vector in the equation, we get:\n$$\nm_{0}^{(\\text{acCoA})} = (1 - \\alpha) m_{0}^{(L)} + \\alpha (1) = (1 - \\alpha) m_{0}^{(L)} + \\alpha\n$$\nAcetoacetyl-CoA is formed by the condensation of two molecules of acetyl-CoA. The MID of the product is the convolution of the precursor MID with itself. The $M+0$ fraction of the product, which we can denote $m_{0}^{(\\text{aCoA})}$, is the probability that two independent acetyl-CoA molecules drawn from the pool are both $M+0$. This probability is the square of the $M+0$ fraction of the acetyl-CoA pool:\n$$\nm_{0}^{(\\text{aCoA})} = \\left( m_{0}^{(\\text{acCoA})} \\right)^2\n$$\nSubstituting the expression for $m_{0}^{(\\text{acCoA})}$ gives the final result:\n$$\nm_{0}^{(\\text{aCoA})} = \\left( (1 - \\alpha) m_{0}^{(L)} + \\alpha \\right)^2\n$$\nThis is the closed-form expression for the $M+0$ fraction of acetoacetyl-CoA as a function of $\\alpha$ and $m_{0}^{(L)}$.", "answer": "$$ \\boxed{((1 - \\alpha) m_{0}^{(L)} + \\alpha)^{2}} $$", "id": "3287030"}, {"introduction": "Isotopic labeling patterns are not just determined by single reactions, but by the interplay of multiple pathways within the metabolic network. This final practice explores the important phenomenon of $\\mathrm{CO_2}$ recycling, where $\\mathrm{CO_2}$ produced by one reaction is re-incorporated by another. By calculating the steady-state labeling of a key TCA cycle precursor, you will learn how to apply atom-mapping rules and isotopic mass balance equations to dissect complex, interconnected network behavior [@problem_id:3286991].", "problem": "Consider a minimal central carbon network at isotopic steady state in which pyruvate is partitioned between Pyruvate Dehydrogenase (PDH) and Pyruvate Carboxylase (PC), and oxaloacetate is in rapid exchange with malate via Malate Dehydrogenase (MDH). The system operates in well-mixed liquid phase under constant gas exchange with an external reservoir of carbon dioxide. You are studying Carbon-13 ($\\mathrm{^{13}C}$) isotopic labeling propagation using atom mappings and isotopomer mass balances.\n\nFundamental base and definitions:\n- The fractional labeling of a carbon position $i$ in a metabolite $X$ is the probability that carbon $i$ is $\\mathrm{^{13}C}$, denoted $L_{X,i} \\in [0,1]$.\n- A decarboxylation removes a specific carbon atom as carbon dioxide ($\\mathrm{CO_2}$) according to established atom mappings; the fractional labeling of the produced $\\mathrm{CO_2}$ equals the fractional labeling of the carbon position lost.\n- For a well-mixed $\\mathrm{CO_2}$ pool at isotopic steady state with total inflow rates $\\{v_k\\}$ and corresponding inflow labeling fractions $\\{f_k\\}$ (for $\\mathrm{CO_2}$ introduced by process $k$), the steady-state $\\mathrm{CO_2}$ labeling fraction $f_{\\mathrm{CO_2}}$ satisfies\n$$\nf_{\\mathrm{CO_2}} = \\frac{\\sum_{k} v_k f_k}{\\sum_{k} v_k}.\n$$\n- Pyruvate atom mappings:\n  - PDH releases pyruvate carbon $1$ as $\\mathrm{CO_2}$, and forms acetyl-coenzyme A with carbons from pyruvate carbons $2$ (acetyl carbon $1$) and $3$ (acetyl carbon $2$).\n  - PC fixes bicarbonate/carbon dioxide into oxaloacetate; oxaloacetate carbon $1$ originates from $\\mathrm{CO_2}$, and the remaining carbons map from pyruvate as: $L_{\\mathrm{OAA},2} \\leftarrow L_{\\mathrm{PYR},2}$, $L_{\\mathrm{OAA},3} \\leftarrow L_{\\mathrm{PYR},1}$, $L_{\\mathrm{OAA},4} \\leftarrow L_{\\mathrm{PYR},3}$.\n- Malate and oxaloacetate interconversion via MDH preserves carbon positions: $L_{\\mathrm{MAL},i} = L_{\\mathrm{OAA},i}$ for $i \\in \\{1,2,3,4\\}$.\n- Malic Enzyme (ME) decarboxylates malate by releasing malate carbon $4$ as $\\mathrm{CO_2}$.\n- Citrate Synthase condenses acetyl-coenzyme A and oxaloacetate to citrate; oxaloacetate carbon $1$ maps to citrate carbon $4$.\n\nExperimental and flux context:\n- The external $\\mathrm{CO_2}$ inflow into the liquid phase occurs at rate $v_{\\mathrm{ext}} = 10$ and is unlabeled ($f_{\\mathrm{ext}} = 0$).\n- PDH operates at rate $v_{\\mathrm{PDH}} = 8$ and releases $\\mathrm{CO_2}$ that equals pyruvate carbon $1$; measured pyruvate carbon $1$ fractional labeling is $L_{\\mathrm{PYR},1} = 0.75$.\n- ME operates at rate $v_{\\mathrm{ME}} = 2$ and releases $\\mathrm{CO_2}$ that equals malate carbon $4$; due to rapid MDH equilibration and exclusive oxaloacetate production via PC, malate carbon $4$ equals oxaloacetate carbon $4$, which maps from pyruvate carbon $3$; measured pyruvate carbon $3$ fractional labeling is $L_{\\mathrm{PYR},3} = 0.20$.\n- PC fixes the well-mixed $\\mathrm{CO_2}$ pool into oxaloacetate such that oxaloacetate carbon $1$ labeling equals the pool labeling $f_{\\mathrm{CO_2}}$.\n- Citrate carbon $4$ labeling equals oxaloacetate carbon $1$ labeling.\n\nTask:\nUsing only the above fundamental definitions and atom mappings, derive the isotopic steady-state fractional labeling of citrate carbon $4$, $L_{\\mathrm{CIT},4}$, as a numerical value. Express your answer as a decimal fraction and round your answer to four significant figures.", "solution": "The objective is to calculate the isotopic steady-state fractional labeling of citrate carbon 4, denoted as $L_{\\mathrm{CIT},4}$.\n\nAccording to the provided atom mappings, we can establish a chain of equalities:\n1.  Citrate Synthase maps oxaloacetate carbon 1 to citrate carbon 4. Therefore, their fractional labelings are equal:\n    $$L_{\\mathrm{CIT},4} = L_{\\mathrm{OAA},1}$$\n2.  Pyruvate Carboxylase fixes $\\mathrm{CO_2}$ from the intracellular pool to become carbon 1 of oxaloacetate. Therefore, the labeling of this carbon is equal to the labeling of the intracellular $\\mathrm{CO_2}$ pool, $f_{\\mathrm{CO_2}}$:\n    $$L_{\\mathrm{OAA},1} = f_{\\mathrm{CO_2}}$$\n\nCombining these relationships, we find that the target quantity $L_{\\mathrm{CIT},4}$ is equal to the fractional labeling of the intracellular $\\mathrm{CO_2}$ pool:\n$$L_{\\mathrm{CIT},4} = f_{\\mathrm{CO_2}}$$\n\nThe problem is thus reduced to calculating $f_{\\mathrm{CO_2}}$. The problem provides the formula for the steady-state labeling of a well-mixed pool, which is the weighted average of the labelings of all inflows, with the weights being the respective inflow rates:\n$$\nf_{\\mathrm{CO_2}} = \\frac{\\sum_{k} v_k f_k}{\\sum_{k} v_k}\n$$\nwhere $v_k$ is the rate of inflow process $k$ and $f_k$ is the fractional labeling of the $\\mathrm{CO_2}$ provided by that process.\n\nWe must identify all processes that contribute $\\mathrm{CO_2}$ to the intracellular pool. Based on the problem description, there are three such processes:\n1.  **External $\\mathrm{CO_2}$ exchange:** Rate $v_{\\mathrm{ext}} = 10$, labeling $f_{\\mathrm{ext}} = 0$ (unlabeled).\n2.  **Pyruvate Dehydrogenase (PDH):** Rate $v_{\\mathrm{PDH}} = 8$. This reaction releases pyruvate carbon 1, so the labeling of the produced $\\mathrm{CO_2}$ is $f_{\\mathrm{PDH}} = L_{\\mathrm{PYR},1} = 0.75$.\n3.  **Malic Enzyme (ME):** Rate $v_{\\mathrm{ME}} = 2$. This reaction releases malate carbon 4. The problem states that $L_{\\mathrm{MAL},4} = L_{\\mathrm{OAA},4} = L_{\\mathrm{PYR},3}$. Therefore, the labeling of the produced $\\mathrm{CO_2}$ is $f_{\\mathrm{ME}} = L_{\\mathrm{PYR},3} = 0.20$.\n\nNow, we can assemble the numerator (sum of labeled fluxes) and the denominator (total flux).\nThe total inflow rate is:\n$$\n\\sum v_k = v_{\\mathrm{ext}} + v_{\\mathrm{PDH}} + v_{\\mathrm{ME}} = 10 + 8 + 2 = 20\n$$\nThe sum of labeled fluxes is:\n$$\n\\sum v_k f_k = (v_{\\mathrm{ext}} \\times f_{\\mathrm{ext}}) + (v_{\\mathrm{PDH}} \\times f_{\\mathrm{PDH}}) + (v_{\\mathrm{ME}} \\times f_{\\mathrm{ME}})\n$$\n$$\n\\sum v_k f_k = (10 \\times 0) + (8 \\times 0.75) + (2 \\times 0.20) = 0 + 6.0 + 0.40 = 6.4\n$$\nWe can now calculate $f_{\\mathrm{CO_2}}$:\n$$\nf_{\\mathrm{CO_2}} = \\frac{6.4}{20} = 0.32\n$$\nSince $L_{\\mathrm{CIT},4} = f_{\\mathrm{CO_2}}$, we have:\n$$\nL_{\\mathrm{CIT},4} = 0.32\n$$\nThe problem requires the answer to be expressed as a decimal fraction rounded to four significant figures. The value $0.32$ can be written as $0.3200$ to meet this requirement.", "answer": "$$\\boxed{0.3200}$$", "id": "3286991"}]}