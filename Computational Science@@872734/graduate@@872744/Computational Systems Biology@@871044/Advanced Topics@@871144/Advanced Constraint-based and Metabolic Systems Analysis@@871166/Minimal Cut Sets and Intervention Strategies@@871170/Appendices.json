{"hands_on_practices": [{"introduction": "The most fundamental way to identify intervention strategies is by directly analyzing a network's mass balance equations. This exercise guides you through deriving minimal cut sets from first principles, using only the steady-state condition $S v = 0$ and flux non-negativity constraints. By working through the hypothetical network in this problem [@problem_id:3326074], you will gain a concrete understanding of how reaction knockouts constrain the feasible flux space to disable a target function.", "problem": "Consider a toy metabolic network with four irreversible reactions $R_1, R_2, R_3, R_4$ over metabolites $A, B, C$:\n- $R_1:\\ A \\rightarrow B$,\n- $R_2:\\ B \\rightarrow C$,\n- $R_4:\\ A \\rightarrow C$,\n- $R_3:\\ C \\rightarrow \\emptyset$.\n\nAssume the standard steady-state flux balance setting: the stoichiometric matrix $S$ is constructed over internal metabolites, fluxes satisfy $S v = 0$ and $v \\ge 0$ with $v = (v_1, v_2, v_3, v_4)^\\top$, and metabolite $A$ is an external substrate not included in the steady-state balance. Reaction $R_3$ is a drain (demand) reaction for $C$. The target function is the ability to sustain a flux $v_3 \\ge 1$ through $R_3$.\n\nA minimal cut set is defined as a minimal set of reactions whose simultaneous inactivation forces $v_3 = 0$ for all feasible steady-state flux vectors with $v \\ge 0$. Using only the foundational definitions of steady-state mass balance $S v = 0$, irreversible nonnegativity $v \\ge 0$, and the given network topology, derive from first principles all minimal cut sets that block the target $v_3 \\ge 1$.\n\nReport as your final answer the total number of minimal cut sets that disable the target reaction $R_3$. Provide the number as an exact integer. No rounding is required, and no physical units are involved.", "solution": "We start from the steady-state mass balance and irreversibility constraints in flux balance analysis. Let $v = (v_1, v_2, v_3, v_4)^\\top$ denote the reaction fluxes for reactions $R_1, R_2, R_3, R_4$, respectively. Metabolite $A$ is external, so it is not included in the steady-state mass balance. The internal metabolites are $B$ and $C$. Construct the stoichiometric matrix $S$ over rows corresponding to $B$ and $C$ and columns corresponding to $R_1, R_2, R_3, R_4$.\n\nFrom the reaction definitions:\n- For metabolite $B$, $R_1$ produces $B$ and $R_2$ consumes $B$. Thus the $B$-row entries are $+1$ for $R_1$, $-1$ for $R_2$, and $0$ for $R_3$ and $R_4$.\n- For metabolite $C$, $R_2$ produces $C$, $R_4$ produces $C$, and $R_3$ consumes $C$. Thus the $C$-row entries are $0$ for $R_1$, $+1$ for $R_2$, $-1$ for $R_3$, and $+1$ for $R_4$.\n\nTherefore,\n\n$$\nS \\;=\\;\n\\begin{pmatrix}\n1 & -1 & 0 & 0 \\\\\n0 & 1 & -1 & 1\n\\end{pmatrix},\n\\qquad\nv \\;=\\; \\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\\\ v_4 \\end{pmatrix},\n\\qquad\nv \\ge 0.\n$$\n\n\nThe steady-state condition $S v = 0$ yields the linear constraints\n\n$$\n\\text{(B balance)}\\quad v_1 - v_2 = 0 \\;\\Rightarrow\\; v_1 = v_2,\n$$\n\n\n$$\n\\text{(C balance)}\\quad v_2 - v_3 + v_4 = 0 \\;\\Rightarrow\\; v_3 = v_2 + v_4.\n$$\n\nWith $v \\ge 0$, the target condition $v_3 \\ge 1$ requires that at least one of $v_2$ or $v_4$ be strictly positive, scaled so that $v_3$ reaches at least $1$. A minimal cut set is a minimal set of reactions whose removal enforces $v_3 = 0$ for all feasible $v$, thereby blocking any $v_3 \\ge 1$.\n\nWe identify all ways to make $v_3 = v_2 + v_4 = 0$ unavoidable under $S v = 0$, $v \\ge 0$:\n\n1. Knocking out $R_3$ directly forces $v_3 = 0$. The singleton set $\\{R_3\\}$ is therefore a cut set. It is minimal because removing no proper subset of $\\{R_3\\}$ achieves the same effect.\n\n2. To force $v_3 = v_2 + v_4 = 0$ without removing $R_3$ itself, one must force $v_2 = 0$ and $v_4 = 0$.\n   - Forcing $v_4 = 0$ is achieved by removing $R_4$.\n   - Forcing $v_2 = 0$ can be achieved by removing either $R_2$ directly or by removing its unique precursor $R_1$, because $v_1 = v_2$ implies that removing $R_1$ enforces $v_1 = 0$ and hence $v_2 = 0$.\n\n   This yields two distinct minimal pairs:\n   - $\\{R_2, R_4\\}$: Removing $R_2$ enforces $v_2 = 0$, and removing $R_4$ enforces $v_4 = 0$, thus $v_3 = 0$. Neither $\\{R_2\\}$ nor $\\{R_4\\}$ alone blocks $v_3$, so the pair is minimal.\n   - $\\{R_1, R_4\\}$: Removing $R_1$ enforces $v_1 = v_2 = 0$, and removing $R_4$ enforces $v_4 = 0$, thus $v_3 = 0$. Neither $\\{R_1\\}$ nor $\\{R_4\\}$ alone blocks $v_3$, so the pair is minimal.\n\nWe verify that no other minimal cut sets exist:\n- Any set containing $R_3$ properly, such as $\\{R_1, R_3\\}$, is not minimal because $\\{R_3\\}$ already suffices.\n- The pair $\\{R_1, R_2\\}$ does not block $v_3$ because $v_4$ can supply $C$ directly, allowing $v_3 = v_4 > 0$.\n- Larger sets that do not include one of the already identified minimal sets are not minimal by definition.\n\nAn equivalent view through elementary flux modes confirms this enumeration. The only elementary flux modes that carry $v_3 > 0$ are the pathway via $R_1 \\rightarrow R_2 \\rightarrow R_3$ with support $\\{R_1, R_2, R_3\\}$ and the direct route $\\{R_4, R_3\\}$. Minimal cut sets are minimal hitting sets of these supports, namely $\\{R_3\\}$, $\\{R_1, R_4\\}$, and $\\{R_2, R_4\\}$.\n\nThus, the total number of minimal cut sets that disable the target reaction $R_3$ is $3$.", "answer": "$$\\boxed{3}$$", "id": "3326074"}, {"introduction": "While direct analysis is insightful, a more powerful approach involves Elementary Flux Modes (EFMs), which represent the fundamental pathways of a network. This practice demonstrates the crucial duality between pathways and interventions: to block a target, one must inactivate at least one reaction in every EFM that produces it. You will apply the concept of minimal hitting sets to find candidate cut sets and then verify them, solidifying your understanding of this cornerstone of metabolic engineering [@problem_id:3326054].", "problem": "Consider a small steady-state metabolic network with internal metabolites $B$ and $C$ and four irreversible reactions $R_1$, $R_2$, $R_3$, and $R_4$. Let the stoichiometric matrix $S \\in \\mathbb{R}^{2 \\times 4}$ be ordered by metabolites $[B,\\,C]^{\\top}$ and reactions $[R_1,\\,R_2,\\,R_3,\\,R_4]$, with entries\n$$\nS \\;=\\; \\begin{pmatrix}\n+1 & -1 & 0 & 0 \\\\\n0 & +1 & -1 & +1\n\\end{pmatrix}.\n$$\nAll reactions are irreversible with flux bounds $v_i \\ge 0$ for $i \\in \\{1,2,3,4\\}$. At steady state, the flux vector $v \\in \\mathbb{R}^4$ must satisfy $S\\,v = 0$. The target of interest is a strictly positive flux through reaction $R_3$, i.e., the target condition is $v_3 \\ge 1$ (without loss of generality due to positive scaling of feasible steady-state fluxes).\n\nElementary Flux Modes (EFMs) are defined as nonzero steady-state flux vectors with minimal support that satisfy $S\\,v=0$ and $v \\ge 0$. Suppose that the set of EFMs that achieve the target reaction $R_3$ has been determined and consists of exactly the two supports $E_1 = \\{R_1, R_2, R_3\\}$ and $E_2 = \\{R_4, R_3\\}$, meaning there exist EFMs whose nonzero reaction sets are precisely $E_1$ and $E_2$.\n\nAn intervention strategy is modeled as a knock-out of a subset of reactions. A Minimal Cut Set (MCS) for the target is a subset $C$ of an allowed intervention set $K$ such that, upon removing all reactions in $C$, there is no feasible steady-state flux with $v_3 \\ge 1$, and no strict subset of $C$ has this property. For this problem, the allowed intervention set excludes the target reaction and is given by $K = \\{R_1, R_2, R_4\\}$.\n\nYour tasks are:\n- Using only the definition of a hitting set and the given EFMs $E_1$ and $E_2$, enumerate all inclusion-wise minimal hitting sets $C \\subseteq K$ that intersect every target-achieving EFM.\n- For each candidate $C$, verify that it is an MCS by solving the feasibility problem for the residual network obtained by removing reactions in $C$: determine whether there exists $v \\ge 0$ with $S\\,v = 0$ and $v_3 \\ge 1$. Also verify minimality by showing that every strict subset of $C$ fails to block the target, i.e., there exists a feasible $v \\ge 0$ with $S\\,v=0$ and $v_3 \\ge 1$ when fewer reactions are removed.\n- Let $N$ denote the number of minimal cut sets you have verified. Report the value of $N$.\n\nProvide your final answer as a single real number. No units are required. If you obtain a non-integer real number, round your answer to $4$ significant figures. Otherwise, report the exact integer.", "solution": "The problem requires us to find the number of Minimal Cut Sets ($N$) for a given metabolic target. The target is to maintain a flux of at least $1$ through reaction $R_3$, i.e., $v_3 \\ge 1$. A Minimal Cut Set (MCS) is a minimal set of reaction knockouts from an allowed set $K=\\{R_1, R_2, R_4\\}$ that makes the target unachievable.\n\nA fundamental principle of metabolic pathway analysis states that any feasible steady-state flux distribution can be represented as a non-negative linear combination of the network's EFMs. The problem states that the only EFMs capable of producing the target (i.e., having a non-zero flux through $R_3$) are those with supports $E_1 = \\{R_1, R_2, R_3\\}$ and $E_2 = \\{R_4, R_3\\}$. To block the target, it is necessary and sufficient to inactivate all of these target-producing EFMs. An EFM is inactivated if at least one of its constituent reactions is knocked out.\n\nTherefore, an MCS corresponds to an inclusion-wise minimal subset of $K$ that has a non-empty intersection with every target-producing EFM. In other words, an MCS is a minimal hitting set of the target-producing EFMs, restricted to the knockable reactions in $K$.\n\n**Step 1: Enumerate Minimal Hitting Sets**\n\nThe set of target-producing EFMs is given by their supports, $\\mathcal{E} = \\{E_1, E_2\\}$, where $E_1 = \\{R_1, R_2, R_3\\}$ and $E_2 = \\{R_4, R_3\\}$. The set of allowed intervention reactions is $K = \\{R_1, R_2, R_4\\}$.\n\nA cut set $C \\subseteq K$ must \"hit\" both $E_1$ and $E_2$. This means $C \\cap E_1 \\neq \\emptyset$ and $C \\cap E_2 \\neq \\emptyset$. Since $C$ must be a subset of $K$, we are interested in the parts of the EFMs that are knockable:\n$E'_1 = E_1 \\cap K = \\{R_1, R_2, R_3\\} \\cap \\{R_1, R_2, R_4\\} = \\{R_1, R_2\\}$\n$E'_2 = E_2 \\cap K = \\{R_4, R_3\\} \\cap \\{R_1, R_2, R_4\\} = \\{R_4\\}$\n\nWe need to find the minimal hitting sets for the family of sets $\\mathcal{F} = \\{E'_1, E'_2\\} = \\{\\{R_1, R_2\\}, \\{R_4\\}\\}$. A hitting set must contain at least one element from each set in $\\mathcal{F}$.\n\\begin{itemize}\n    \\item To hit $\\{R_4\\}$, a set must contain $R_4$.\n    \\item To hit $\\{R_1, R_2\\}$, a set must contain either $R_1$ or $R_2$.\n\\end{itemize}\nCombining these conditions, a hitting set must contain $\\{R_4\\}$ and either $\\{R_1\\}$ or $\\{R_2\\}$. This gives rise to two candidate sets:\n\\begin{enumerate}\n    \\item $C_1 = \\{R_1, R_4\\}$\n    \\item $C_2 = \\{R_2, R_4\\}$\n\\end{enumerate}\nThese sets are minimal because removing any single reaction from either set would result in a set that no longer hits both $E'_1$ and $E'_2$. For example, for $C_1$, the subset $\\{R_1\\}$ does not hit $E'_2$, and the subset $\\{R_4\\}$ does not hit $E'_1$. A similar argument holds for $C_2$. Thus, these are the minimal hitting sets.\n\n**Step 2: Verify Candidates as Minimal Cut Sets**\n\nThe problem requires explicit verification that each candidate is an MCS. This involves solving a feasibility problem for the residual network. The governing equations are the steady-state condition $S v = 0$ with non-negativity constraints $v_i \\ge 0$.\nThe stoichiometric equations are:\n$v_1 - v_2 = 0 \\implies v_1 = v_2$\n$v_2 - v_3 + v_4 = 0 \\implies v_3 = v_2 + v_4$\n\nThe target condition is $v_3 \\ge 1$.\n\n**Verification of $C_1 = \\{R_1, R_4\\}$**\n\n\\begin{itemize}\n    \\item **Blocking capability**: We test if the target can be achieved when reactions $R_1$ and $R_4$ are knocked out, i.e., $v_1=0$ and $v_4=0$.\n    Substituting these into the steady-state equations:\n    $0 - v_2 = 0 \\implies v_2 = 0$\n    $v_2 - v_3 + 0 = 0 \\implies v_3 = v_2$\n    Combining these, we get $v_3 = 0$. This result contradicts the target condition $v_3 \\ge 1$. Thus, no feasible flux exists, and $C_1$ successfully blocks the target.\n\n    \\item **Minimality**: We must show that no strict subset of $C_1$ can block the target.\n    \\begin{itemize}\n        \\item Subset $\\{R_1\\}$: Knock out $R_1$ ($v_1=0$). The system becomes:\n        $0 - v_2 = 0 \\implies v_2=0$\n        $0 - v_3 + v_4 = 0 \\implies v_3=v_4$\n        We need to find if there is a vector $v$ satisfying these conditions, $v \\ge 0$, and $v_3 \\ge 1$. Let's set $v_3=1$. This implies $v_4=1$. The flux vector $v = [0, 0, 1, 1]^\\top$ is a valid steady-state flux distribution with $v_1=0$. Since $v_3 = 1 \\ge 1$, the target is achievable. Thus, $\\{R_1\\}$ is not a cut set.\n\n        \\item Subset $\\{R_4\\}$: Knock out $R_4$ ($v_4=0$). The system becomes:\n        $v_1 - v_2 = 0 \\implies v_1=v_2$\n        $v_2 - v_3 + 0 = 0 \\implies v_3=v_2$\n        We need to find if there is a vector $v$ satisfying these conditions, $v \\ge 0$, and $v_3 \\ge 1$. Let's set $v_3=1$. This implies $v_2=1$ and $v_1=1$. The flux vector $v = [1, 1, 1, 0]^\\top$ is a valid steady-state flux distribution with $v_4=0$. Since $v_3 = 1 \\ge 1$, the target is achievable. Thus, $\\{R_4\\}$ is not a cut set.\n    \\end{itemize}\n    Since $C_1$ blocks the target and no proper subset of it does, $C_1 = \\{R_1, R_4\\}$ is a verified MCS.\n\\end{itemize}\n\n**Verification of $C_2 = \\{R_2, R_4\\}$**\n\n\\begin{itemize}\n    \\item **Blocking capability**: We test if the target can be achieved when $R_2$ and $R_4$ are knocked out, i.e., $v_2=0$ and $v_4=0$.\n    Substituting into the steady-state equations:\n    $v_1 - 0 = 0 \\implies v_1 = 0$\n    $0 - v_3 + 0 = 0 \\implies v_3 = 0$\n    The result $v_3=0$ contradicts the target condition $v_3 \\ge 1$. Thus, $C_2$ successfully blocks the target.\n\n    \\item **Minimality**: We check the strict subsets of $C_2$.\n    \\begin{itemize}\n        \\item Subset $\\{R_2\\}$: Knock out $R_2$ ($v_2=0$). The system becomes:\n        $v_1 - 0 = 0 \\implies v_1=0$\n        $0 - v_3 + v_4 = 0 \\implies v_3=v_4$\n        As before with the subset $\\{R_1\\}$, we can find a feasible flux vector achieving the target, for example $v=[0, 0, 1, 1]^\\top$. Thus, $\\{R_2\\}$ is not a cut set.\n\n        \\item Subset $\\{R_4\\}$: Knock out $R_4$ ($v_4=0$). This case is identical to the one analyzed for $C_1$. A feasible flux vector $v=[1, 1, 1, 0]^\\top$ achieves the target. Thus, $\\{R_4\\}$ is not a cut set.\n    \\end{itemize}\n    Since $C_2$ blocks the target and no proper subset of it does, $C_2 = \\{R_2, R_4\\}$ is also a verified MCS.\n\\end{itemize}\n\n**Conclusion**\n\nWe have identified two candidate sets, $C_1 = \\{R_1, R_4\\}$ and $C_2 = \\{R_2, R_4\\}$, by finding the minimal hitting sets of the target EFMs. We have rigorously verified that both candidates satisfy the definition of a Minimal Cut Set: they block the target reaction, and no subset of them does.\n\nTherefore, the total number of minimal cut sets is $N=2$.", "answer": "$$\\boxed{2}$$", "id": "3326054"}, {"introduction": "In practice, real-world metabolic networks are too large for manual calculation, requiring computational algorithms to identify intervention strategies. This exercise challenges you to translate the search for minimal cut sets into a formal optimization problem, a critical step in developing tools for systems biology. You will explore the formulation and then implement a search algorithm to find minimum-cardinality cut sets for several test cases, bridging the gap between theory and application [@problem_id:3326084].", "problem": "You are given the task of rigorously formulating an optimization-based intervention strategy for a metabolic network using Mixed-Integer Linear Programming (MILP), and then implementing a computational check of minimal cut sets for specified test cases. The goal is to find a minimum-cardinality set of reaction knockouts that block a target flux at or above a specified threshold. Your program must produce a single line of output containing the computed minimal cut sets for a test suite of networks.\n\nConsider a metabolic network defined by a stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$, a flux vector $v \\in \\mathbb{R}^{n}$, lower bounds $L \\in \\mathbb{R}^{n}$, upper bounds $U \\in \\mathbb{R}^{n}$, and a target reaction index $t \\in \\{0,1,\\dots,n-1\\}$. A knockout of reaction $i$ is represented by a binary variable $y_i \\in \\{0,1\\}$, where $y_i = 1$ forces $v_i = 0$, and $y_i = 0$ allows $v_i$ within its bounds. The steady-state mass balance is represented by $S v = 0$. For irreversible reactions with nonnegative lower bounds, the availability constraints under knockouts may be imposed by $v_i \\le U_i(1 - y_i)$ and $v_i \\ge L_i(1 - y_i)$ for all $i \\in \\{0,1,\\dots,n-1\\}$. The target feasibility requirement is $v_t \\ge \\tau$ for a specified threshold $\\tau \\in \\mathbb{R}_{\\ge 0}$.\n\nYour derivation must start from the fundamental steady-state constraints $S v = 0$ and the bound constraints $L \\le v \\le U$, and construct a bilevel Linear Programming (LP) for the inner target-achieving problem, followed by a single-level MILP using strong duality or Farkas' Lemma. Specifically, formulate the bilevel problem that minimizes the cardinality of the knockouts subject to the inner LP that attempts to achieve $v_t \\ge \\tau$, and then derive a single-level MILP by replacing the inner LP with its dual constraints and appropriate linearization to handle products with binary variables.\n\nYour final program must, given specific test suite instances, compute a minimum-cardinality cut set $C \\subseteq \\mathcal{R}_{\\text{allowed}}$ that blocks the feasibility of $v_t \\ge \\tau$ under $S v = 0$ and $L \\le v \\le U$, where $\\mathcal{R}_{\\text{allowed}}$ is the set of reactions eligible for knockout. For each test case, you must return the lexicographically smallest minimum-cardinality cut set as a list of zero-based reaction indices. If the target feasibility $v_t \\ge \\tau$ is already impossible without any knockouts, return the empty list $[\\ ]$.\n\nTest Suite:\n- Case $1$ (happy path with two parallel routes and nontrivial minimal cut set):\n  - Stoichiometric matrix $$S_1 = \\begin{bmatrix} 1 & -1 & 0 & -1 & 0 \\\\ 0 & 1 & -1 & 0 & 0 \\\\ 0 & 0 & 1 & 1 & -1 \\end{bmatrix}$$.\n  - Lower bounds $L_1 = [0, 0, 0, 0, 0]$.\n  - Upper bounds $U_1 = [10, 10, 10, 10, 100]$.\n  - Target index $t_1 = 4$.\n  - Threshold $\\tau_1 = 5$.\n  - Allowed interventions $\\mathcal{R}_{\\text{allowed},1} = \\{1, 2, 3\\}$.\n- Case $2$ (boundary condition where the target threshold is unattainable even without intervention):\n  - Stoichiometric matrix $S_2 = S_1$.\n  - Lower bounds $L_2 = L_1$.\n  - Upper bounds $U_2 = [3, 10, 10, 10, 100]$.\n  - Target index $t_2 = 4$.\n  - Threshold $\\tau_2 = 5$.\n  - Allowed interventions $\\mathcal{R}_{\\text{allowed},2} = \\{1, 2, 3\\}$.\n- Case $3$ (single-path network where one knockout suffices):\n  - Stoichiometric matrix $$S_3 = \\begin{bmatrix} 1 & -1 & 0 \\\\ 0 & 1 & -1 \\end{bmatrix}$$.\n  - Lower bounds $L_3 = [0, 0, 0]$.\n  - Upper bounds $U_3 = [10, 10, 100]$.\n  - Target index $t_3 = 2$.\n  - Threshold $\\tau_3 = 6$.\n  - Allowed interventions $\\mathcal{R}_{\\text{allowed},3} = \\{1\\}$.\n\nRequired Output:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each result is the lexicographically smallest minimum-cardinality cut set list for the corresponding test case. For example, if the minimal cut sets are $[1,3]$, $[\\ ]$, and $[1]$, then the output must be the single line $[[1,3],[],[1]]$.\n\nAssumptions and Constraints:\n- All reactions in the test suite are irreversible with nonnegative lower bounds, so $L_i \\ge 0$ for all $i$.\n- Reaction indices are zero-based.\n- No physical units are required for fluxes; treat all flux bounds and thresholds as dimensionless real numbers.\n- The implementation must compute feasibility of $v_t \\ge \\tau$ for each knockout subset by solving a zero-objective LP with constraints $S v = 0$, $L \\le v \\le U$, $v_i = 0$ for knocked-out $i$, and $v_t \\ge \\tau$; then search for the minimum-cardinality blocking set by increasing subset size. For performance, limit the search to $\\mathcal{R}_{\\text{allowed}}$ as specified per case.", "solution": "The problem requires the formulation of an optimization strategy to identify a minimal set of reaction knockouts that render a metabolic network incapable of achieving a target flux, followed by a computational implementation to solve specific test cases. We begin with a rigorous derivation of the governing mathematical framework before proceeding to the computational method.\n\n### I. Problem Formulation: Bilevel Optimization\n\nThe core of the problem is to find a minimum-cardinality set of interventions (reaction knockouts) that guarantees the failure of a metabolic objective. This is naturally structured as a bilevel optimization problem.\n\nLet the metabolic network be defined by a stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$, where $m$ is the number of metabolites and $n$ is the number of reactions. The vector $v \\in \\mathbb{R}^{n}$ represents the fluxes through these reactions. At steady-state, the mass balance equation is:\n$$S v = 0$$\nThe fluxes are constrained by lower and upper bounds, $L \\in \\mathbb{R}^{n}$ and $U \\in \\mathbb{R}^{n}$ respectively:\n$$L \\le v \\le U$$\nAn intervention in reaction $i$ is modeled by a binary variable $y_i \\in \\{0, 1\\}$. If $y_i=1$, reaction $i$ is knocked out, forcing its flux $v_i$ to $0$. If $y_i=0$, the reaction operates within its original bounds. For irreversible reactions where $L_i \\ge 0$, this is captured by modifying the bounds:\n$$L_i(1-y_i) \\le v_i \\le U_i(1-y_i)$$\nThe problem's objective is to make the production of a target, represented by flux $v_t$ through reaction $t$, infeasible at or above a threshold $\\tau \\ge 0$. That is, we seek an intervention vector $y$ such that the system of constraints:\n$$S v = 0$$\n$$L_i(1-y_i) \\le v_i \\le U_i(1-y_i) \\quad \\forall i \\in \\{0, \\dots, n-1\\}$$\n$$v_t \\ge \\tau$$\nadmits no solution for $v$.\n\nThe **outer problem** seeks to minimize the number of knockouts, restricted to an allowed set of reactions $\\mathcal{R}_{\\text{allowed}}$. The objective function is $\\sum_{i \\in \\mathcal{R}_{\\text{allowed}}} y_i$.\n\nThe **inner problem** checks whether, for a given $y$, the target is achievable. A common way to formalize this is to maximize the target flux $v_t$ and check if its maximum possible value, $v_t^*(y)$, is less than $\\tau$.\n$$v_t^*(y) = \\max_{v} \\quad v_t$$\nsubject to:\n$$S v = 0$$\n$$L_i(1-y_i) \\le v_i \\le U_i(1-y_i) \\quad \\forall i$$\n\nThe complete bilevel formulation is thus:\n$$\\min_{y} \\quad \\sum_{i \\in \\mathcal{R}_{\\text{allowed}}} y_i$$\nsubject to:\n$$v_t^*(y) < \\tau$$\n$$y_i \\in \\{0, 1\\} \\quad \\forall i \\in \\mathcal{R}_{\\text{allowed}}$$\n$$y_i = 0 \\quad \\forall i \\notin \\mathcal{R}_{\\text{allowed}}$$\n\n### II. Single-Level MILP Reformulation using Duality\n\nThe bilevel structure is computationally intractable. We can reformulate it into a single-level Mixed-Integer Linear Program (MILP) using principles of duality, specifically Farkas' Lemma.\n\nA set of linear constraints $Ax \\le b$ is infeasible if and only if there exists a vector $z \\ge 0$ such that $z^T A = 0$ and $z^T b < 0$. The vector $z$ is known as a Farkas certificate of infeasibility.\n\nWe apply this to the system of constraints that we wish to make infeasible for any choice of $v$:\n1. $S v = 0$ (which is equivalent to $S v \\le 0$ and $-S v \\le 0$)\n2. $v \\le U(1-y)$\n3. $-v \\le -L(1-y)$\n4. $v_t \\ge \\tau$ (which is equivalent to $-e_t^T v \\le -\\tau$, where $e_t$ is a standard basis vector with a $1$ at index $t$)\n\nLet us introduce dual variables (the components of the Farkas certificate $z$):\n- $\\lambda_1 \\ge 0$ for $S v \\le 0$\n- $\\lambda_2 \\ge 0$ for $-S v \\le 0$\n- $\\mu_i \\ge 0$ for $v_i \\le U_i(1-y_i)$\n- $\\nu_i \\ge 0$ for $-v_i \\le -L_i(1-y_i)$\n- $\\gamma \\ge 0$ for $-v_t \\le -\\tau$\n\nThe condition $z^T A = 0$ translates to the dual constraints. For each primal variable $v_j$, the sum of coefficients in the constraints, weighted by the dual variables, must be zero:\n$$(S^T)_j \\lambda_1 - (S^T)_j \\lambda_2 + \\mu_j - \\nu_j - \\gamma (e_t)_j = 0 \\quad \\forall j \\in \\{0, \\dots, n-1\\}$$\nLetting $\\lambda = \\lambda_1 - \\lambda_2$ (which is now a free variable), this simplifies to:\n$$S^T \\lambda + \\mu - \\nu - \\gamma e_t = 0$$\n\nThe condition $z^T b < 0$ translates to:\n$$\\sum_i \\mu_i U_i (1-y_i) - \\sum_i \\nu_i L_i (1-y_i) - \\gamma \\tau < 0$$\nThis is a strict inequality, which is often implemented in solvers by introducing a small positive constant $\\epsilon$:\n$$\\sum_i \\mu_i U_i (1-y_i) - \\sum_i \\nu_i L_i (1-y_i) - \\gamma \\tau \\le -\\epsilon$$\n\nThis inequality contains bilinear terms of the form $\\mu_i y_i$ and $\\nu_i y_i$. These must be linearized. For a term like $w_i = \\mu_i y_i$, where $\\mu_i \\ge 0$ and $y_i \\in \\{0,1\\}$, we can replace it with a new variable $w_i$ and add the following linear constraints, using a sufficiently large constant $M$:\n$$w_i \\le M y_i$$\n$$w_i \\le \\mu_i$$\n$$w_i \\ge \\mu_i - M(1 - y_i)$$\n$$w_i \\ge 0$$\nSimilar constraints are added for products involving $\\nu_i$.\n\nThe complete single-level MILP is to find a set of interventions $y$ and a corresponding Farkas certificate $(\\lambda, \\mu, \\nu, \\gamma)$ that satisfy these constraints while minimizing the cardinality of $y$.\n\n### III. Algorithmic Implementation via Combinatorial Search\n\nWhile the MILP formulation is general and powerful, the problem statement directs the implementation to follow a specific, more direct combinatorial search strategy for the given small-scale test cases. This approach iterates through all possible knockout sets in increasing order of size.\n\nThe algorithm proceeds as follows:\n1.  Initialize the knockout set size $k=0$.\n2.  Generate all unique combinations $C$ of reactions from the allowed set $\\mathcal{R}_{\\text{allowed}}$ of size $k$.\n3.  The combinations are naturally generated in lexicographical order, which fulfills the tie-breaking requirement.\n4.  For each combination $C$:\n    a.  Formulate a Linear Program (LP) to test if the target flux is still achievable. This is a feasibility problem: find $v$ such that\n        -   $S v = 0$\n        -   $L_i \\le v_i \\le U_i$ for $i \\notin C$\n        -   $v_i = 0$ for $i \\in C$\n        -   $v_t \\ge \\tau$\n    b.  Solve this LP. We can use a zero-objective function, as only feasibility is of interest.\n    c.  If the LP is found to be **infeasible**, it means the set $C$ is a valid cut set. Since we are iterating on $k$ from $0$ and processing subsets in lexicographical order, this $C$ is the lexicographically smallest minimal-cardinality cut set. The search terminates and $C$ is returned.\n5.  If all combinations of size $k$ are tested and all are found to be non-blocking (i.e., the LP is feasible), increment $k$ to $k+1$ and repeat from step 2.\n6.  The process begins with $k=0$, testing the empty set $C=[]$. If the target is unachievable even without any knockouts, the initial LP will be infeasible, and the empty set is correctly returned as the result.\n\nThis procedure guarantees finding the desired minimal cut set. For an implementation, we use `scipy.optimize.linprog` to solve the feasibility LPs. An infeasible status from this solver indicates that a valid cut set has been identified.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\nimport itertools\n\ndef find_minimal_cut_set(S, L, U, t, tau, R_allowed):\n    \"\"\"\n    Finds the lexicographically smallest minimum-cardinality cut set.\n\n    This function iterates through knockout set sizes k = 0, 1, 2, ...\n    For each size, it checks all combinations of reactions from R_allowed.\n    For each combination (cut_set), it solves a feasibility LP to check\n    if the target flux is blocked. The first cut set found is guaranteed\n    to be minimal in cardinality and lexicographically first.\n    \"\"\"\n    S = np.array(S, dtype=float)\n    L = np.array(L, dtype=float)\n    U = np.array(U, dtype=float)\n    num_reactions = S.shape[1]\n\n    # Objective function is zero, we only care about feasibility.\n    c = np.zeros(num_reactions)\n\n    # Equality constraints S*v = 0\n    A_eq = S\n    b_eq = np.zeros(S.shape[0])\n\n    R_allowed = sorted(list(R_allowed))\n\n    for k in range(len(R_allowed) + 1):\n        for cut_set in itertools.combinations(R_allowed, k):\n            # Create bounds for the current LP\n            # Default bounds are (L_i, U_i)\n            current_bounds = list(zip(L, U))\n\n            # Apply target constraint: v_t >= tau\n            # This means the lower bound of v_t is max(L_t, tau)\n            current_bounds[t] = (max(L[t], tau), U[t])\n            \n            # Apply knockouts: v_i = 0 for i in cut_set\n            for i in cut_set:\n                current_bounds[i] = (0.0, 0.0)\n            \n            # Solve the feasibility LP\n            # method 'highs' is robust and is the default in recent SciPy\n            res = linprog(c, A_eq=A_eq, b_eq=b_eq, bounds=current_bounds, method='highs')\n            \n            # linprog status 2 means the problem is infeasible.\n            # This means the cut_set is effective in blocking the target flux.\n            if res.status == 2:\n                return list(cut_set)\n    \n    # This part should not be reached if a solution always exists\n    return None\n\ndef solve():\n    \"\"\"\n    Defines and runs the test suite for finding minimal cut sets.\n    \"\"\"\n    test_cases = [\n        {\n            \"S\": [[1, -1, 0, -1, 0], \n                  [0, 1, -1, 0, 0], \n                  [0, 0, 1, 1, -1]],\n            \"L\": [0, 0, 0, 0, 0],\n            \"U\": [10, 10, 10, 10, 100],\n            \"t\": 4,\n            \"tau\": 5,\n            \"R_allowed\": {1, 2, 3}\n        },\n        {\n            \"S\": [[1, -1, 0, -1, 0], \n                  [0, 1, -1, 0, 0], \n                  [0, 0, 1, 1, -1]],\n            \"L\": [0, 0, 0, 0, 0],\n            \"U\": [3, 10, 10, 10, 100],\n            \"t\": 4,\n            \"tau\": 5,\n            \"R_allowed\": {1, 2, 3}\n        },\n        {\n            \"S\": [[1, -1, 0], \n                  [0, 1, -1]],\n            \"L\": [0, 0, 0],\n            \"U\": [10, 10, 100],\n            \"t\": 2,\n            \"tau\": 6,\n            \"R_allowed\": {1}\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = find_minimal_cut_set(\n            case[\"S\"], case[\"L\"], case[\"U\"], case[\"t\"], case[\"tau\"], case[\"R_allowed\"]\n        )\n        results.append(result)\n\n    # Format the output string to be exactly as specified, e.g., [[1,3],[],[1]]\n    output_parts = [str(res).replace(\" \", \"\") for res in results]\n    final_output = f\"[{','.join(output_parts)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "3326084"}]}