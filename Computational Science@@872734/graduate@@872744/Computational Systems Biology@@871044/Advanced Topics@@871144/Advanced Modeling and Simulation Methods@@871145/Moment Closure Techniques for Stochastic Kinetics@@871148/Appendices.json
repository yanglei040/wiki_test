{"hands_on_practices": [{"introduction": "Understanding moment closure begins with mastering the foundational derivations. This practice problem guides you through the essential mechanics of applying a second-order normal (or Gaussian) closure to a fundamental bimolecular reaction, a process that creates the nonlinearity necessitating closure [@problem_id:3329113]. By systematically deriving the dynamics of the first and second moments and expressing higher-order moments in terms of lower-order ones, you will build a core skill set for analyzing a wide range of stochastic biochemical networks.", "problem": "Consider the bimolecular reaction system $X + Y \\xrightarrow{k} Z$ occurring in a well-mixed compartment of finite size $\\Omega$, where $k$ is the macroscopic mass-action rate constant. Let $X(t)$, $Y(t)$, and $Z(t)$ denote the discrete molecule counts at time $t$. Assume dynamics are governed by the Chemical Master Equation (CME), and let the reaction propensity be $a(X,Y) = \\frac{k}{\\Omega} X Y$. Define the raw moments $m_{ij}(t) = \\mathbb{E}[X(t)^{i} Y(t)^{j}]$, the means $\\mu_{X}(t) = \\mathbb{E}[X(t)]$, $\\mu_{Y}(t) = \\mathbb{E}[Y(t)]$, $\\mu_{Z}(t) = \\mathbb{E}[Z(t)]$, and the covariance matrix entries $C_{XX}(t) = \\mathrm{Var}[X(t)]$, $C_{YY}(t) = \\mathrm{Var}[Y(t)]$, $C_{XY}(t) = \\mathrm{Cov}[X(t), Y(t)]$. Starting from the CME and using only fundamental definitions, do the following:\n1. Derive the ordinary differential equations (ODEs) for the time evolution of the first and second raw moments required to construct a second-order closure for the two-species subsystem $(X,Y)$. Explicitly write $\\,\\frac{d}{dt}\\mu_{X}(t)$, $\\,\\frac{d}{dt}\\mu_{Y}(t)$, $\\,\\frac{d}{dt}m_{20}(t)$, $\\,\\frac{d}{dt}m_{02}(t)$, and $\\,\\frac{d}{dt}m_{11}(t)$ in terms of expectations of products of $X$ and $Y$.\n2. Show the algebraic transformation between raw and central moments for $(X,Y)$ up to second order, expressing $m_{20}(t)$, $m_{02}(t)$, and $m_{11}(t)$ in terms of $\\mu_{X}(t)$, $\\mu_{Y}(t)$, $C_{XX}(t)$, $C_{YY}(t)$, and $C_{XY}(t)$.\n3. Implement a second-order normal (Gaussian) moment closure for $(X,Y)$ by setting all third-order central moments of $(X,Y)$ to zero. Under this closure, compute $\\,\\mathbb{E}[X(t)^{2} Y(t)]$ and $\\,\\mathbb{E}[X(t) Y(t)^{2}]$ in terms of $\\mu_{X}(t)$, $\\mu_{Y}(t)$, $C_{XX}(t)$, $C_{YY}(t)$, and $C_{XY}(t)$.\n4. Using the results of parts 1–3, derive a closed system of ODEs for the means $\\mu_{X}(t)$, $\\mu_{Y}(t)$, $\\mu_{Z}(t)$ and the covariances $C_{XX}(t)$, $C_{YY}(t)$, $C_{XY}(t)$ under the second-order Gaussian closure.\nYour final reported answer must be a single analytic expression for the closed right-hand side of the covariance cross-term $\\,\\frac{d}{dt}C_{XY}(t)$ obtained in part 4, expressed in terms of $k$, $\\Omega$, $\\mu_{X}(t)$, $\\mu_{Y}(t)$, $C_{XX}(t)$, $C_{YY}(t)$, and $C_{XY}(t)$. No numerical approximation or rounding is required, and no units should be included in the final expression.", "solution": "The problem asks for a multi-part derivation related to moment closure for a stochastic bimolecular reaction system. The solution will be presented in four parts as requested.\n\nThe reaction system is $X + Y \\xrightarrow{k} Z$ with propensity $a(X,Y) = \\frac{k}{\\Omega}XY$. The state change vector for $(X,Y)$ is $\\nu = (-1, -1)$. The time evolution of the expectation of any function of state, $f(X,Y)$, is given by the master equation formalism as:\n$$ \\frac{d\\mathbb{E}[f(X,Y)]}{dt} = \\mathbb{E}[a(X,Y) (f(X-1, Y-1) - f(X,Y))] $$\n\n### Part 1: ODEs for Raw Moments\nWe derive the equations for the first and second raw moments, $m_{ij} = \\mathbb{E}[X^i Y^j]$.\n\n1.  **For $\\mu_X(t) = m_{10}(t) = \\mathbb{E}[X(t)]$**:\n    Let $f(X,Y) = X$. The change in $f$ per reaction is $f(X-1, Y-1) - f(X,Y) = (X-1) - X = -1$.\n    $$ \\frac{d\\mu_X}{dt} = \\mathbb{E}\\left[\\frac{k}{\\Omega}XY \\cdot (-1)\\right] = -\\frac{k}{\\Omega}\\mathbb{E}[XY] = -\\frac{k}{\\Omega}m_{11}(t) $$\n\n2.  **For $\\mu_Y(t) = m_{01}(t) = \\mathbb{E}[Y(t)]$**:\n    By symmetry with $X$, $f(X,Y)=Y$, and the change is $-1$.\n    $$ \\frac{d\\mu_Y}{dt} = \\mathbb{E}\\left[\\frac{k}{\\Omega}XY \\cdot (-1)\\right] = -\\frac{k}{\\Omega}\\mathbb{E}[XY] = -\\frac{k}{\\Omega}m_{11}(t) $$\n\n3.  **For $m_{20}(t) = \\mathbb{E}[X(t)^2]$**:\n    Let $f(X,Y) = X^2$. The change is $f(X-1, Y-1) - f(X,Y) = (X-1)^2 - X^2 = X^2 - 2X + 1 - X^2 = -2X + 1$.\n    $$ \\frac{dm_{20}}{dt} = \\mathbb{E}\\left[\\frac{k}{\\Omega}XY(-2X+1)\\right] = \\frac{k}{\\Omega}\\mathbb{E}[-2X^2Y + XY] = -\\frac{2k}{\\Omega}\\mathbb{E}[X^2Y] + \\frac{k}{\\Omega}\\mathbb{E}[XY] $$\n    $$ \\frac{dm_{20}}{dt} = -\\frac{2k}{\\Omega}m_{21}(t) + \\frac{k}{\\Omega}m_{11}(t) $$\n\n4.  **For $m_{02}(t) = \\mathbb{E}[Y(t)^2]$**:\n    By symmetry with $X^2$,\n    $$ \\frac{dm_{02}}{dt} = -\\frac{2k}{\\Omega}\\mathbb{E}[XY^2] + \\frac{k}{\\Omega}\\mathbb{E}[XY] = -\\frac{2k}{\\Omega}m_{12}(t) + \\frac{k}{\\Omega}m_{11}(t) $$\n\n5.  **For $m_{11}(t) = \\mathbb{E}[X(t)Y(t)]$**:\n    Let $f(X,Y) = XY$. The change is $f(X-1, Y-1) - f(X,Y) = (X-1)(Y-1) - XY = XY - X - Y + 1 - XY = -X - Y + 1$.\n    $$ \\frac{dm_{11}}{dt} = \\mathbb{E}\\left[\\frac{k}{\\Omega}XY(-X-Y+1)\\right] = \\frac{k}{\\Omega}\\mathbb{E}[-X^2Y - XY^2 + XY] $$\n    $$ \\frac{dm_{11}}{dt} = -\\frac{k}{\\Omega}\\left(m_{21}(t) + m_{12}(t)\\right) + \\frac{k}{\\Omega}m_{11}(t) $$\nThese equations are unclosed, as the dynamics of second-order moments depend on third-order moments ($m_{21}, m_{12}$).\n\n### Part 2: Transformation Between Raw and Central Moments\nWe express the second raw moments in terms of means ($\\mu_X, \\mu_Y$) and second central moments (variances $C_{XX}, C_{YY}$ and covariance $C_{XY}$).\n\n1.  **Variance $C_{XX}$**:\n    $C_{XX} = \\mathrm{Var}[X] = \\mathbb{E}[(X-\\mu_X)^2] = \\mathbb{E}[X^2 - 2X\\mu_X + \\mu_X^2] = \\mathbb{E}[X^2] - 2\\mu_X\\mathbb{E}[X] + \\mu_X^2 = m_{20} - 2\\mu_X\\mu_X + \\mu_X^2 = m_{20} - \\mu_X^2$.\n    Thus, $m_{20}(t) = C_{XX}(t) + \\mu_X(t)^2$.\n\n2.  **Variance $C_{YY}$**:\n    By symmetry, $m_{02}(t) = C_{YY}(t) + \\mu_Y(t)^2$.\n\n3.  **Covariance $C_{XY}$**:\n    $C_{XY} = \\mathrm{Cov}[X,Y] = \\mathbb{E}[(X-\\mu_X)(Y-\\mu_Y)] = \\mathbb{E}[XY - X\\mu_Y - Y\\mu_X + \\mu_X\\mu_Y] = \\mathbb{E}[XY] - \\mu_Y\\mathbb{E}[X] - \\mu_X\\mathbb{E}[Y] + \\mu_X\\mu_Y = m_{11} - \\mu_Y\\mu_X - \\mu_X\\mu_Y + \\mu_X\\mu_Y = m_{11} - \\mu_X\\mu_Y$.\n    Thus, $m_{11}(t) = C_{XY}(t) + \\mu_X(t)\\mu_Y(t)$.\n\n### Part 3: Second-Order Normal (Gaussian) Moment Closure\nThe normal closure approximation sets all central moments of order three and higher to zero. We use this to express the third-order raw moments required in Part 1. Let $\\tilde{X} = X-\\mu_X$ and $\\tilde{Y} = Y-\\mu_Y$.\n\n1.  **For $\\mathbb{E}[X^2Y]$**:\n    The corresponding third central moment is $\\mathbb{E}[\\tilde{X}^2\\tilde{Y}] = \\mathbb{E}[(X-\\mu_X)^2(Y-\\mu_Y)]$. We set this to zero.\n    $0 = \\mathbb{E}[(X^2 - 2X\\mu_X + \\mu_X^2)(Y-\\mu_Y)]$\n    $0 = \\mathbb{E}[X^2Y - X^2\\mu_Y - 2X\\mu_X Y + 2X\\mu_X\\mu_Y + \\mu_X^2 Y - \\mu_X^2\\mu_Y]$\n    $0 = \\mathbb{E}[X^2Y] - \\mu_Y\\mathbb{E}[X^2] - 2\\mu_X\\mathbb{E}[XY] + 2\\mu_X\\mu_Y\\mathbb{E}[X] + \\mu_X^2\\mathbb{E}[Y] - \\mu_X^2\\mu_Y$\n    $0 = \\mathbb{E}[X^2Y] - \\mu_Y m_{20} - 2\\mu_X m_{11} + 2\\mu_X^2\\mu_Y + \\mu_X^2\\mu_Y - \\mu_X^2\\mu_Y$\n    $\\mathbb{E}[X^2Y] = \\mu_Y m_{20} + 2\\mu_X m_{11} - 2\\mu_X^2\\mu_Y$\n    Substituting the relations from Part 2:\n    $\\mathbb{E}[X^2Y] = \\mu_Y(C_{XX} + \\mu_X^2) + 2\\mu_X(C_{XY} + \\mu_X\\mu_Y) - 2\\mu_X^2\\mu_Y$\n    $\\mathbb{E}[X^2Y] = \\mu_Y C_{XX} + \\mu_X^2\\mu_Y + 2\\mu_X C_{XY} + 2\\mu_X^2\\mu_Y - 2\\mu_X^2\\mu_Y$\n    $\\mathbb{E}[X^2Y] = \\mu_X^2\\mu_Y + \\mu_Y C_{XX} + 2\\mu_X C_{XY}$\n\n2.  **For $\\mathbb{E}[XY^2]$**:\n    By symmetry, swapping the roles of $X$ and $Y$:\n    $\\mathbb{E}[XY^2] = \\mu_Y^2\\mu_X + \\mu_X C_{YY} + 2\\mu_Y C_{XY}$\n\n### Part 4: Closed System of ODEs\nWe now combine the results from the previous parts to derive a closed system of ODEs for the means and covariances.\n\n**Mean Dynamics**:\nUsing the result from Part 1 and Part 2:\n$\\frac{d\\mu_X}{dt} = -\\frac{k}{\\Omega}m_{11} = -\\frac{k}{\\Omega}(\\mu_X\\mu_Y + C_{XY})$\n$\\frac{d\\mu_Y}{dt} = -\\frac{k}{\\Omega}m_{11} = -\\frac{k}{\\Omega}(\\mu_X\\mu_Y + C_{XY})$\nFor $\\mu_Z$, the stoichiometry is $\\Delta Z = +1$.\n$\\frac{d\\mu_Z}{dt} = \\mathbb{E}[a(X,Y)\\cdot (+1)] = \\frac{k}{\\Omega}m_{11} = \\frac{k}{\\Omega}(\\mu_X\\mu_Y + C_{XY})$\n\n**Covariance Dynamics**:\nWe derive the ODE for $C_{XY}(t)$. The ODEs for $C_{XX}$ and $C_{YY}$ follow similar procedures but are not required for the final answer. The time derivative of the covariance is given by the chain rule:\n$$ \\frac{dC_{XY}}{dt} = \\frac{d}{dt}(m_{11} - \\mu_X\\mu_Y) = \\frac{dm_{11}}{dt} - \\left(\\mu_Y\\frac{d\\mu_X}{dt} + \\mu_X\\frac{d\\mu_Y}{dt}\\right) $$\nSubstitute the derived expressions for the derivatives:\n$$ \\frac{dC_{XY}}{dt} = \\left(-\\frac{k}{\\Omega}(\\mathbb{E}[X^2Y] + \\mathbb{E}[XY^2]) + \\frac{k}{\\Omega}\\mathbb{E}[XY]\\right) - \\left(\\mu_Y(-\\frac{k}{\\Omega}\\mathbb{E}[XY]) + \\mu_X(-\\frac{k}{\\Omega}\\mathbb{E}[XY])\\right) $$\nFactor out $\\frac{k}{\\Omega}$:\n$$ \\frac{dC_{XY}}{dt} = \\frac{k}{\\Omega} \\left( -\\mathbb{E}[X^2Y] - \\mathbb{E}[XY^2] + \\mathbb{E}[XY] + \\mu_Y\\mathbb{E}[XY] + \\mu_X\\mathbb{E}[XY] \\right) $$\n$$ \\frac{dC_{XY}}{dt} = \\frac{k}{\\Omega} \\left( -\\mathbb{E}[X^2Y] - \\mathbb{E}[XY^2] + (1+\\mu_X+\\mu_Y)\\mathbb{E}[XY] \\right) $$\nNow, substitute the closure expressions from Part 3 and the relation for $\\mathbb{E}[XY]$ from Part 2:\n\\begin{itemize}\n    \\item $-\\mathbb{E}[X^2Y] = -(\\mu_X^2\\mu_Y + \\mu_Y C_{XX} + 2\\mu_X C_{XY})$\n    \\item $-\\mathbb{E}[XY^2] = -(\\mu_Y^2\\mu_X + \\mu_X C_{YY} + 2\\mu_Y C_{XY})$\n    \\item $(1+\\mu_X+\\mu_Y)\\mathbb{E}[XY] = (1+\\mu_X+\\mu_Y)(\\mu_X\\mu_Y + C_{XY}) = \\mu_X\\mu_Y + C_{XY} + \\mu_X^2\\mu_Y + \\mu_X C_{XY} + \\mu_X\\mu_Y^2 + \\mu_Y C_{XY}$\n\\end{itemize}\nSumming these terms inside the parentheses for the $\\frac{dC_{XY}}{dt}$ equation:\n$$ (-\\mu_X^2\\mu_Y - \\mu_Y C_{XX} - 2\\mu_X C_{XY}) + (-\\mu_Y^2\\mu_X - \\mu_X C_{YY} - 2\\mu_Y C_{XY}) + (\\mu_X\\mu_Y + C_{XY} + \\mu_X^2\\mu_Y + \\mu_X C_{XY} + \\mu_X\\mu_Y^2 + \\mu_Y C_{XY}) $$\nGroup terms by variables:\n\\begin{itemize}\n    \\item Mean products: $(-\\mu_X^2\\mu_Y + \\mu_X^2\\mu_Y) + (-\\mu_Y^2\\mu_X + \\mu_X\\mu_Y^2) + \\mu_X\\mu_Y = \\mu_X\\mu_Y$\n    \\item $C_{XX}$ terms: $-\\mu_Y C_{XX}$\n    \\item $C_{YY}$ terms: $-\\mu_X C_{YY}$\n    \\item $C_{XY}$ terms: $(-2\\mu_X C_{XY} - 2\\mu_Y C_{XY}) + (C_{XY} + \\mu_X C_{XY} + \\mu_Y C_{XY}) = C_{XY} - \\mu_X C_{XY} - \\mu_Y C_{XY}$\n\\end{itemize}\nCombining these simplified terms gives the expression for the right-hand side:\n$$ \\mu_X\\mu_Y - \\mu_Y C_{XX} - \\mu_X C_{YY} + C_{XY} - \\mu_X C_{XY} - \\mu_Y C_{XY} $$\nThis can be factored slightly for clarity:\n$$ \\mu_X\\mu_Y - \\mu_Y C_{XX} - \\mu_X C_{YY} + (1-\\mu_X-\\mu_Y)C_{XY} $$\nThe final closed ODE for the covariance cross-term is:\n$$ \\frac{dC_{XY}}{dt}(t) = \\frac{k}{\\Omega}\\left[\\mu_X\\mu_Y - \\mu_Y C_{XX} - \\mu_X C_{YY} + (1-\\mu_X-\\mu_Y)C_{XY}\\right] $$\nwhere the time dependence of the means and covariances on the right-hand side is implicit.", "answer": "$$\n\\boxed{\\frac{k}{\\Omega}\\left(\\mu_X\\mu_Y - \\mu_Y C_{XX} - \\mu_X C_{YY} + (1-\\mu_X-\\mu_Y)C_{XY}\\right)}\n$$", "id": "3329113"}, {"introduction": "While Gaussian closure is common, other assumptions can be more natural or convenient for certain systems. This exercise introduces the use of factorial moments, which elegantly handle the polynomial propensities of mass-action kinetics, and explores the application of a Poisson moment closure ansatz [@problem_id:3329136]. You will see how the structure of the reaction propensities directly informs the moment dynamics and learn to apply a different, physically motivated closure scheme to obtain a tractable model.", "problem": "Consider a single-species stochastic reaction network for a molecular count process $X(t) \\in \\{0,1,2,\\dots\\}$ with the following mass-action reactions:\n$$(\\mathrm{R1})\\;\\; \\varnothing \\xrightarrow{k_0} X,\\qquad (\\mathrm{R2})\\;\\; X \\xrightarrow{k_1} \\varnothing,\\qquad (\\mathrm{R3})\\;\\; 2X \\xrightarrow{k_2} \\varnothing,$$\nwhere $k_0$, $k_1$, and $k_2$ are positive rate constants. The reaction $(\\mathrm{R1})$ increases the count by $+1$, $(\\mathrm{R2})$ decreases it by $-1$, and $(\\mathrm{R3})$ decreases it by $-2$. Let $X(t)$ evolve according to the Chemical Master Equation (CME), and define the falling factorial $x^{\\underline{n}} := x(x-1)\\cdots(x-n+1)$ for $n \\in \\mathbb{N}$ with the conventional value $x^{\\underline{0}} := 1$. Define the factorial moments $f_n(t) := \\mathbb{E}\\!\\left[X^{\\underline{n}}(t)\\right]$.\n\nStarting from the CME and the definition of factorial moments, derive the exact time-evolution equation for the first factorial moment $f_1(t)$. In doing so, appeal only to the structure of the CME and the mass-action propensities, and make explicit how a reaction of order $n$ contributes naturally through the factorial moment $f_n(t)$. Then impose a Poisson moment closure ansatz by assuming that $X(t)$ is approximately Poisson distributed with mean $m(t)$ for all $t \\ge 0$, so that $f_n(t) = m(t)^n$. Under this ansatz, obtain a closed-form ordinary differential equation for $m(t)$, and compute the positive steady-state mean $m^\\ast$ in terms of $k_0$, $k_1$, and $k_2$.\n\nExpress your final answer as a single closed-form analytic expression for $m^\\ast$. No numerical rounding is required. Do not include any units in your final expression.", "solution": "The time evolution of the expectation of any function $g(X(t))$ for a process governed by the CME is given by\n$$\n\\frac{d}{dt}\\mathbb{E}[g(X(t))] = \\sum_{j} \\mathbb{E}[a_j(X(t))(g(X(t)+s_j) - g(X(t)))]\n$$\nwhere the sum is over all reaction channels $j$, $a_j(x)$ is the propensity function for reaction $j$, and $s_j$ is the corresponding stoichiometric change in the species count $X$.\n\nFor the given mass-action reaction network, the propensities and stoichiometric changes are:\n- Reaction $(\\mathrm{R1})$: $s_1 = +1$. The propensity for a zeroth-order reaction is constant, $a_1(x) = k_0$.\n- Reaction $(\\mathrm{R2})$: $s_2 = -1$. The propensity for a first-order reaction is proportional to the number of molecules, $a_2(x) = k_1 x$.\n- Reaction $(\\mathrm{R3})$: $s_3 = -2$. For the second-order reaction (R3), the mass-action propensity is the rate constant multiplied by the number of distinct reactant pairs. For a state with $x$ molecules, the number of pairs is $\\binom{x}{2} = \\frac{x(x-1)}{2}$. Thus, the propensity is $a_3(x) = k_2 \\frac{x(x-1)}{2}$.\n\nWe are asked to derive the time-evolution equation for the first factorial moment, $f_1(t) = \\mathbb{E}[X(t)]$. For this, we set $g(x) = x$. The changes in $g(x)$ for each reaction are:\n- For $(\\mathrm{R1})$: $g(x+1) - g(x) = (x+1) - x = 1$.\n- For $(\\mathrm{R2})$: $g(x-1) - g(x) = (x-1) - x = -1$.\n- For $(\\mathrm{R3})$: $g(x-2) - g(x) = (x-2) - x = -2$.\n\nSubstituting these into the general evolution equation:\n$$\n\\frac{d}{dt}\\mathbb{E}[X(t)] = \\mathbb{E}[a_1(X)(1)] + \\mathbb{E}[a_2(X)(-1)] + \\mathbb{E}[a_3(X)(-2)]\n$$\n$$\n\\frac{d}{dt}\\mathbb{E}[X(t)] = \\mathbb{E}[k_0] + \\mathbb{E}[k_1 X (-1)] + \\mathbb{E}\\left[k_2 \\frac{X(X-1)}{2} (-2)\\right]\n$$\nUsing the linearity of the expectation operator, we get:\n$$\n\\frac{d}{dt}\\mathbb{E}[X(t)] = k_0 - k_1 \\mathbb{E}[X] - k_2 \\mathbb{E}[X(X-1)]\n$$\nBy definition, $f_1(t) = \\mathbb{E}[X(t)]$ and $f_2(t) = \\mathbb{E}[X(X-1)] = \\mathbb{E}[X^{\\underline{2}}(t)]$. So, the exact equation for the first factorial moment is:\n$$\n\\frac{df_1}{dt} = k_0 - k_1 f_1 - k_2 f_2\n$$\nThis equation is not closed because the dynamics of the first moment $f_1$ depend on the second moment $f_2$. This illustrates the moment closure problem. The use of factorial moments is natural for mass-action systems because the propensity of a reaction of order $n$ is proportional to $x^{\\underline{n}}$, which directly couples to the $n$-th factorial moment $f_n$ in the evolution equations.\n\nNext, we impose the Poisson moment closure ansatz. This assumes that the distribution of $X(t)$ is approximately Poisson with mean $m(t)$ for all $t \\ge 0$. A key property of the Poisson distribution is that its $n$-th factorial moment is the mean raised to the $n$-th power, i.e., $f_n = m^n$.\nUnder this assumption, we have:\n- $f_1(t) = m(t)^1 = m(t)$\n- $f_2(t) = m(t)^2$\n\nSubstituting these into the exact moment equation gives a closed ODE for the mean $m(t)$:\n$$\n\\frac{dm}{dt} = k_0 - k_1 m - k_2 m^2\n$$\nThis is the closed-form ODE for $m(t)$ under the Poisson closure.\n\nFinally, we compute the positive steady-state mean, $m^\\ast$. At steady state, the mean does not change with time, so $\\frac{dm}{dt} = 0$. This leads to the algebraic equation:\n$$\nk_0 - k_1 m^\\ast - k_2 (m^\\ast)^2 = 0\n$$\nRearranging into standard quadratic form $ax^2 + bx + c = 0$:\n$$\nk_2 (m^\\ast)^2 + k_1 m^\\ast - k_0 = 0\n$$\nThe solutions for $m^\\ast$ are given by the quadratic formula:\n$$\nm^\\ast = \\frac{-k_1 \\pm \\sqrt{k_1^2 - 4(k_2)(-k_0)}}{2k_2} = \\frac{-k_1 \\pm \\sqrt{k_1^2 + 4 k_0 k_2}}{2 k_2}\n$$\nThe problem specifies that the rate constants $k_0$, $k_1$, and $k_2$ are positive. Therefore, the discriminant $k_1^2 + 4 k_0 k_2$ is always positive. The mean number of molecules $m^\\ast$ must be a non-negative quantity. We analyze the two roots:\n1. $m^\\ast_1 = \\frac{-k_1 + \\sqrt{k_1^2 + 4 k_0 k_2}}{2 k_2}$. Since $4 k_0 k_2 > 0$, we have $\\sqrt{k_1^2 + 4 k_0 k_2} > \\sqrt{k_1^2} = k_1$. Thus, the numerator is positive. The denominator is also positive. Hence, $m^\\ast_1 > 0$.\n2. $m^\\ast_2 = \\frac{-k_1 - \\sqrt{k_1^2 + 4 k_0 k_2}}{2 k_2}$. The numerator is clearly negative, while the denominator is positive. Hence, $m^\\ast_2  0$.\n\nThe only physically meaningful solution is the positive one. Therefore, the positive steady-state mean is:\n$$\nm^\\ast = \\frac{-k_1 + \\sqrt{k_1^2 + 4 k_0 k_2}}{2 k_2}\n$$", "answer": "$$\n\\boxed{\\frac{-k_1 + \\sqrt{k_1^2 + 4 k_0 k_2}}{2 k_2}}\n$$", "id": "3329136"}, {"introduction": "A derived system of moment equations is only useful if it can be solved, and this often requires numerical integration. This practice problem transitions from pen-and-paper theory to computational implementation, challenging you to not only derive the closed ODEs but also to solve them numerically [@problem_id:3329153]. Crucially, you will confront the practical issue of 'realizability'—ensuring that the moments remain physically valid—and design a projection method to enforce these constraints during simulation.", "problem": "Consider a single-species stochastic reaction network in computational systems biology governed by the Chemical Master Equation (CME). The species has copy number $X(t) \\in \\{0,1,2,\\dots\\}$ and is subject to three reactions: birth with stoichiometry $+1$ and propensity $a_1(X) = k_b$, death with stoichiometry $-1$ and propensity $a_2(X) = k_d X$, and pair annihilation with stoichiometry $-2$ and propensity $a_3(X) = k_a X (X - 1)$. All rate constants are nonnegative: $k_b \\ge 0$ with units $\\mathrm{s}^{-1}$, $k_d \\ge 0$ with units $\\mathrm{s}^{-1}$ per molecule, and $k_a \\ge 0$ with units $\\mathrm{s}^{-1}$ per pair. Let the first moment be $\\mu(t) = \\mathbb{E}[X(t)]$ with units molecules, and the centered second moment be $\\sigma^2(t) = \\mathrm{Var}(X(t))$ with units $\\text{molecules}^2$. The second raw moment is $m_2(t) = \\mathbb{E}[X(t)^2] = \\mu(t)^2 + \\sigma^2(t)$.\n\nStarting from the CME and the definition that for any function $g$, $\\frac{d}{dt}\\mathbb{E}[g(X)] = \\mathbb{E}\\left[\\sum_r \\left(g(X+\\nu_r) - g(X)\\right) a_r(X)\\right]$, where $r$ indexes reactions with stoichiometric change $\\nu_r$ and propensity $a_r(X)$, derive deterministic ordinary differential equations for $\\frac{d}{dt}\\mu(t)$ and $\\frac{d}{dt}m_2(t)$ expressed in terms of $\\mu(t)$, $m_2(t)$, and $\\mathbb{E}[X(t)^3]$. Then obtain a closed system for $\\mu(t)$ and $\\sigma^2(t)$ by adopting a Gaussian moment closure that assumes vanishing third and higher cumulants, thereby expressing $\\mathbb{E}[X(t)^3]$ in terms of $\\mu(t)$ and $\\sigma^2(t)$. Use the identity $\\sigma^2(t) = m_2(t) - \\mu(t)^2$ and the product rule to write $\\frac{d}{dt}\\sigma^2(t)$ in terms of $\\frac{d}{dt}m_2(t)$ and $\\frac{d}{dt}\\mu(t)$.\n\nIn numerical integration of the resulting closed system, realizability must be enforced: the truncated moment matrix $M_2(t) = \\begin{pmatrix} 1  \\mu(t) \\\\ \\mu(t)  \\mu(t)^2 + \\sigma^2(t) \\end{pmatrix}$ must be positive semidefinite for all $t \\ge 0$. Additionally, for a nonnegative integer-valued species, the mean must remain nonnegative: $\\mu(t) \\ge 0$. Design a projection map $\\Pi$ that takes any pair $(\\mu,\\sigma^2)$ to the closest feasible point in the set $\\mathcal{F} = \\{(\\mu,\\sigma^2) \\mid \\mu \\ge 0,\\; M_2 \\succeq 0\\}$ under the Euclidean norm in $\\mathbb{R}^2$, and apply this projection at every integration step. Explicitly specify and justify the form of $\\Pi$.\n\nImplement an explicit Euler method to integrate the closed system from initial conditions $\\mu(0) = \\mu_0$ and $\\sigma^2(0) = \\sigma_0^2$ up to final time $T$ with fixed step size $\\Delta t$, applying the projection $\\Pi$ at the end of every Euler step. Use the following test suite of parameter sets, which are specified to test a general case, strong nonlinear damping, a boundary variance case, and a large-step stress test:\n\n- Test case $1$: $k_b = 20.0\\,\\mathrm{s}^{-1}$, $k_d = 0.5\\,\\mathrm{s}^{-1}$ per molecule, $k_a = 0.01\\,\\mathrm{s}^{-1}$ per pair, $\\mu_0 = 10.0$ molecules, $\\sigma_0^2 = 5.0\\,\\text{molecules}^2$, $T = 10.0$ seconds, $\\Delta t = 0.2$ seconds.\n- Test case $2$: $k_b = 5.0\\,\\mathrm{s}^{-1}$, $k_d = 0.3\\,\\mathrm{s}^{-1}$ per molecule, $k_a = 0.5\\,\\mathrm{s}^{-1}$ per pair, $\\mu_0 = 25.0$ molecules, $\\sigma_0^2 = 40.0\\,\\text{molecules}^2$, $T = 10.0$ seconds, $\\Delta t = 1.0$ seconds.\n- Test case $3$: $k_b = 0.0\\,\\mathrm{s}^{-1}$, $k_d = 0.1\\,\\mathrm{s}^{-1}$ per molecule, $k_a = 0.2\\,\\mathrm{s}^{-1}$ per pair, $\\mu_0 = 50.0$ molecules, $\\sigma_0^2 = 0.0\\,\\text{molecules}^2$, $T = 5.0$ seconds, $\\Delta t = 0.5$ seconds.\n- Test case $4$: $k_b = 100.0\\,\\mathrm{s}^{-1}$, $k_d = 2.0\\,\\mathrm{s}^{-1}$ per molecule, $k_a = 1.0\\,\\mathrm{s}^{-1}$ per pair, $\\mu_0 = 1.0$ molecule, $\\sigma_0^2 = 0.1\\,\\text{molecules}^2$, $T = 5.0$ seconds, $\\Delta t = 2.0$ seconds.\n\nYour program must compute, for each test case, the final projected values $\\mu(T)$ and $\\sigma^2(T)$ in the specified units (molecules and $\\text{molecules}^2$ respectively). Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each test case reported as a two-element list of floats $[\\mu(T),\\sigma^2(T)]$. For example, the output format must be like $[[\\mu_1, \\sigma^2_1],[\\mu_2, \\sigma^2_2],[\\mu_3, \\sigma^2_3],[\\mu_4, \\sigma^2_4]]$ with no unit strings appended.", "solution": "The Chemical Master Equation (CME) provides the evolution of expectations by the identity $\\frac{d}{dt}\\mathbb{E}[g(X)] = \\mathbb{E}\\left[\\sum_r \\left(g(X+\\nu_r) - g(X)\\right) a_r(X)\\right]$, where reaction $r$ has stoichiometric increment $\\nu_r$ and propensity $a_r(X)$. For the single-species network with birth $\\nu_1 = +1$, $a_1(X) = k_b$, death $\\nu_2 = -1$, $a_2(X) = k_d X$, and pair annihilation $\\nu_3 = -2$, $a_3(X) = k_a X(X-1)$, we compute the first and second raw moment equations by choosing $g(X) \\in \\{X,X^2\\}$ and applying linearity of expectation.\n\nFor the first moment with $g(X)=X$, we use $\\Delta_r X = X+\\nu_r - X = \\nu_r$. Therefore\n$$\n\\frac{d}{dt}\\mu(t) \\;=\\; \\mathbb{E}\\left[\\nu_1 a_1(X) + \\nu_2 a_2(X) + \\nu_3 a_3(X)\\right]\n\\;=\\; \\mathbb{E}\\left[1\\cdot k_b + (-1)\\cdot k_d X + (-2)\\cdot k_a X(X-1)\\right].\n$$\nEvaluating expectations termwise gives\n$$\n\\frac{d}{dt}\\mu(t) \\;=\\; k_b \\;-\\; k_d\\,\\mu(t) \\;-\\; 2 k_a\\,\\mathbb{E}[X(t)(X(t)-1)].\n$$\nUsing $\\mathbb{E}[X(X-1)] = \\mathbb{E}[X^2] - \\mathbb{E}[X] = m_2(t) - \\mu(t)$ yields\n$$\n\\frac{d}{dt}\\mu(t) \\;=\\; k_b \\;-\\; k_d\\,\\mu(t) \\;-\\; 2 k_a\\,\\big(m_2(t) - \\mu(t)\\big).\n$$\n\nFor the second raw moment with $g(X)=X^2$, we compute $\\Delta_r X^2 = (X+\\nu_r)^2 - X^2$. The algebraic increments are $\\Delta_1 X^2 = (X+1)^2 - X^2 = 2X + 1$, $\\Delta_2 X^2 = (X-1)^2 - X^2 = -2X + 1$, and $\\Delta_3 X^2 = (X-2)^2 - X^2 = -4X + 4$. Therefore\n$$\n\\frac{d}{dt} m_2(t) \\;=\\; \\mathbb{E}\\left[(2X+1) k_b + (-2X+1) k_d X + (-4X+4) k_a X(X-1)\\right].\n$$\nEvaluating expectations by linearity,\n$$\n\\frac{d}{dt} m_2(t) \\;=\\; 2 k_b\\,\\mu(t) + k_b \\;-\\; 2 k_d\\,\\mathbb{E}[X^2] + k_d\\,\\mu(t) \\;+\\; k_a\\,\\mathbb{E}\\big[(-4X+4) X(X-1)\\big].\n$$\nTo simplify the annihilation term, note $\\mathbb{E}[(-4X+4) X(X-1)] = -4\\,\\mathbb{E}[X^2(X-1)] + 4\\,\\mathbb{E}[X(X-1)]$ and $\\mathbb{E}[X^2(X-1)] = \\mathbb{E}[X^3 - X^2] = \\mathbb{E}[X^3] - \\mathbb{E}[X^2]$. Using $\\mathbb{E}[X(X-1)] = \\mathbb{E}[X^2] - \\mathbb{E}[X] = m_2(t) - \\mu(t)$, we obtain\n$$\n\\frac{d}{dt} m_2(t) \\;=\\; 2 k_b\\,\\mu(t) + k_b \\;-\\; 2 k_d\\, m_2(t) + k_d\\,\\mu(t) \\;+\\; k_a\\left[-4\\,\\mathbb{E}[X^3] + 8\\, m_2(t) - 4\\, \\mu(t)\\right].\n$$\n\nThis system involves $\\mathbb{E}[X^3]$. To obtain a closed system in terms of $\\mu(t)$ and $\\sigma^2(t)$, we adopt a Gaussian moment closure, which assumes vanishing third and higher cumulants. Under this closure, the third raw moment of a univariate distribution is related to the first two moments by\n$$\n\\mathbb{E}[X^3] \\;=\\; \\mu(t)^3 + 3\\,\\mu(t)\\,\\sigma^2(t).\n$$\nThis choice is consistent with the assumption that the distribution of $X$ is approximated by a normal distribution in terms of its moments, a widely used closure in moment-based methods.\n\nUsing $m_2(t) = \\mu(t)^2 + \\sigma^2(t)$, we write the second equation entirely in terms of $\\mu(t)$ and $\\sigma^2(t)$ by substitution. We also express the variance dynamics via the identity\n$$\n\\sigma^2(t) \\;=\\; m_2(t) - \\mu(t)^2,\\quad\\text{so}\\quad \\frac{d}{dt}\\sigma^2(t) \\;=\\; \\frac{d}{dt} m_2(t) - 2\\,\\mu(t)\\,\\frac{d}{dt}\\mu(t).\n$$\nThis guarantees that variance updates reflect both the raw second moment dynamics and the interaction with the mean.\n\nRealizability conditions must be enforced because integration and closure approximations can produce unphysical states. The truncated moment matrix\n$$\nM_2(t) \\;=\\; \\begin{pmatrix}\n1  \\mu(t) \\\\\n\\mu(t)  \\mu(t)^2 + \\sigma^2(t)\n\\end{pmatrix}\n$$\nmust be positive semidefinite to correspond to a valid measure; additionally, for a nonnegative species, the mean must satisfy $\\mu(t) \\ge 0$. For a $2\\times 2$ symmetric matrix, $M_2 \\succeq 0$ is equivalent to nonnegative principal minors: the $(1,1)$ entry equals $1$ and is nonnegative; the determinant constraint reads $1\\cdot(\\mu^2+\\sigma^2) - \\mu^2 \\ge 0$, which simplifies to $\\sigma^2 \\ge 0$. Therefore the feasible set is\n$$\n\\mathcal{F} \\;=\\; \\{(\\mu,\\sigma^2) \\in \\mathbb{R}^2 \\mid \\mu \\ge 0,\\; \\sigma^2 \\ge 0\\}.\n$$\nThe Euclidean projection $\\Pi$ onto $\\mathcal{F}$ is the minimizer of $\\|(\\tilde{\\mu},\\tilde{\\sigma}^2) - (\\mu,\\sigma^2)\\|_2$ subject to $(\\tilde{\\mu},\\tilde{\\sigma}^2) \\in \\mathcal{F}$. Because $\\mathcal{F}$ is a Cartesian product of half-lines, this projection decouples by coordinate:\n$$\n\\Pi(\\mu,\\sigma^2) \\;=\\; \\big(\\max\\{\\mu,0\\},\\; \\max\\{\\sigma^2,0\\}\\big).\n$$\nThis choice enforces both $M_2 \\succeq 0$ and nonnegativity of the mean while minimally altering the state in the Euclidean sense.\n\nAlgorithmic implementation proceeds as follows:\n- Initialize $\\mu \\leftarrow \\mu_0$ and $\\sigma^2 \\leftarrow \\sigma_0^2$.\n- For time steps $t \\in \\{0,\\Delta t,2\\Delta t,\\dots,T\\}$, with the last step shortened if necessary to end exactly at $T$:\n  - Compute $m_2 = \\mu^2 + \\sigma^2$ and $\\mathbb{E}[X^3] = \\mu^3 + 3\\mu\\sigma^2$.\n  - Compute $\\frac{d}{dt}\\mu = k_b - k_d \\mu - 2 k_a (m_2 - \\mu)$.\n  - Compute $\\frac{d}{dt} m_2 = 2 k_b \\mu + k_b - 2 k_d m_2 + k_d \\mu + k_a(-4\\mathbb{E}[X^3] + 8 m_2 - 4 \\mu)$.\n  - Compute $\\frac{d}{dt}\\sigma^2 = \\frac{d}{dt} m_2 - 2 \\mu \\frac{d}{dt}\\mu$.\n  - Perform an explicit Euler update: $\\mu \\leftarrow \\mu + \\Delta t \\cdot \\frac{d}{dt}\\mu$, $\\sigma^2 \\leftarrow \\sigma^2 + \\Delta t \\cdot \\frac{d}{dt}\\sigma^2$.\n  - Project: $(\\mu,\\sigma^2) \\leftarrow \\Pi(\\mu,\\sigma^2) = (\\max\\{\\mu,0\\},\\max\\{\\sigma^2,0\\})$.\n- Report the final $(\\mu(T),\\sigma^2(T))$.\n\nUnits are carried consistently: $\\mu$ in molecules, $\\sigma^2$ in $\\text{molecules}^2$, and time in seconds. The test suite spans:\n- A general case that exercises all terms.\n- A case with strong pair annihilation that can drive rapid damping and challenge numerical stability.\n- A boundary case where the initial variance is zero.\n- A stress test with large step size that can induce overshoot, making projection essential.\n\nThe final program aggregates the four test-case results into a single line in the required format $[[\\mu_1, \\sigma^2_1],[\\mu_2, \\sigma^2_2],[\\mu_3, \\sigma^2_3],[\\mu_4, \\sigma^2_4]]$.", "answer": "```python\nimport numpy as np\n\ndef gaussian_closure_third_moment(mu, var):\n    # E[X^3] under Gaussian closure (zero third cumulant)\n    return mu**3 + 3.0 * mu * var\n\ndef integrate_moments(kb, kd, ka, mu0, var0, T, dt):\n    mu = float(mu0)\n    var = float(var0)\n\n    t = 0.0\n    # Integrate to exactly time T with possibly shortened last step\n    while t  T - 1e-15:\n        h = dt\n        if t + h > T:\n            h = T - t\n\n        m2 = mu**2 + var\n        E3 = gaussian_closure_third_moment(mu, var)\n\n        dmu = kb - kd * mu - 2.0 * ka * (m2 - mu)\n        dm2 = (2.0 * kb * mu + kb\n               - 2.0 * kd * m2 + kd * mu\n               + ka * (-4.0 * E3 + 8.0 * m2 - 4.0 * mu))\n        dvar = dm2 - 2.0 * mu * dmu\n\n        mu_new = mu + h * dmu\n        var_new = var + h * dvar\n\n        # Euclidean projection onto feasible set: mu >= 0, var >= 0\n        mu = max(mu_new, 0.0)\n        var = max(var_new, 0.0)\n\n        t += h\n\n    return mu, var\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (kb, kd, ka, mu0, var0, T, dt)\n    test_cases = [\n        (20.0, 0.5, 0.01, 10.0, 5.0, 10.0, 0.2),\n        (5.0, 0.3, 0.5, 25.0, 40.0, 10.0, 1.0),\n        (0.0, 0.1, 0.2, 50.0, 0.0, 5.0, 0.5),\n        (100.0, 2.0, 1.0, 1.0, 0.1, 5.0, 2.0),\n    ]\n\n    results = []\n    for kb, kd, ka, mu0, var0, T, dt in test_cases:\n        muT, varT = integrate_moments(kb, kd, ka, mu0, var0, T, dt)\n        results.append([muT, varT])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join('[' + ','.join(map(str, pair)) + ']' for pair in results)}]\")\n\nsolve()\n```", "id": "3329153"}]}