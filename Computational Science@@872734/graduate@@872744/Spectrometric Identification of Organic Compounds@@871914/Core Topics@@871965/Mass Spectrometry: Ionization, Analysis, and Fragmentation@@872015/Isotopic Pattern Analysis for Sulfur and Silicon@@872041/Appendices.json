{"hands_on_practices": [{"introduction": "To truly understand isotopic patterns, it is essential to build them from the ground up. This exercise [@problem_id:3709664] challenges you to derive the theoretical probability of the $M+2$ peak for a molecule containing both sulfur and silicon by systematically accounting for every contributing isotopic combination. Mastering this \"forward problem\" provides a solid foundation for interpreting complex, overlapping isotopic signatures in real spectra.", "problem": "An organic molecule is analyzed by Mass Spectrometry (MS) in a singly charged state. The molecule contains $n_{\\mathrm{S}}=3$ sulfur atoms and $n_{\\mathrm{Si}}=2$ silicon atoms. Assume isotopic selections at each atom are independent and follow the natural isotopic abundances for sulfur and silicon. For sulfur, take the fractional abundances of $^{34}\\mathrm{S}$ and $^{33}\\mathrm{S}$ as $p_{34}=0.0425$ and $p_{33}=0.0075$, and define the baseline $^{32}\\mathrm{S}$ fraction as $p_{32}=1-p_{33}-p_{34}$. For silicon, take the fractional abundances of $^{30}\\mathrm{Si}$ and $^{29}\\mathrm{Si}$ as $q_{30}=0.0310$ and $q_{29}=0.0469$, and define the baseline $^{28}\\mathrm{Si}$ fraction as $q_{28}=1-q_{29}-q_{30}$. Neglect $^{36}\\mathrm{S}$ due to its very low abundance, and ignore contributions from all other elements in the molecule.\n\nIn isotopic pattern analysis, the monoisotopic composition ($^{32}\\mathrm{S}$ and $^{28}\\mathrm{Si}$) defines the $M$ peak. The presence of an isotope that is heavier by $+1$ relative to baseline contributes $+1$ to the mass shift, and an isotope heavier by $+2$ contributes $+2$ to the mass shift. Specifically, $^{33}\\mathrm{S}$ and $^{29}\\mathrm{Si}$ contribute $+1$, while $^{34}\\mathrm{S}$ and $^{30}\\mathrm{Si}$ contribute $+2$. The observed $M+2$ intensity arises from configurations whose net mass shift is exactly $+2$.\n\nStarting from the independence of isotopic selections and the basic counting principles for identical sites, derive from first principles a closed-form expression for the probability that this molecule exhibits exactly an $+2$ Dalton mass shift relative to the monoisotopic composition owing solely to sulfur and silicon isotopes. Your expression must sum disjoint contributions from all allowed configurations that yield a net $+2$ shift. Then evaluate the expression numerically using $p_{34}$, $p_{33}$, $p_{32}$, $q_{30}$, $q_{29}$, and $q_{28}$ as specified above.\n\nExpress your final answer as a dimensionless decimal, and round your answer to four significant figures.", "solution": "The problem is well-posed, scientifically grounded, and contains all necessary information to derive a unique solution. We can proceed with the derivation.\n\nThe problem asks for the probability of observing a mass shift of $+2$ Daltons relative to the monoisotopic mass, which corresponds to the $M+2$ peak in the mass spectrum. The molecule contains $n_{\\mathrm{S}}=3$ sulfur atoms and $n_{\\mathrm{Si}}=2$ silicon atoms. The total mass shift, $\\Delta m_{total}$, is the sum of the mass shifts from the sulfur isotopes, $\\Delta m_{\\mathrm{S}}$, and the silicon isotopes, $\\Delta m_{\\mathrm{Si}}$.\n$$\n\\Delta m_{total} = \\Delta m_{\\mathrm{S}} + \\Delta m_{\\mathrm{Si}}\n$$\nWe are seeking the probability $P(\\Delta m_{total} = 2)$. Since isotopic selections at each atomic site are independent, the selections for the group of sulfur atoms are independent of the selections for the group of silicon atoms. Therefore, the probability of a total shift of $+2$ can be expressed as the sum of probabilities of all disjoint composite events where the individual shifts sum to $+2$.\n$$\nP(\\Delta m_{total} = 2) = \\sum_{i+j=2} P(\\Delta m_{\\mathrm{S}} = i \\text{ and } \\Delta m_{\\mathrm{Si}} = j)\n$$\nBy independence, this becomes:\n$$\nP(M+2) = P(\\Delta m_{\\mathrm{S}}=0)P(\\Delta m_{\\mathrm{Si}}=2) + P(\\Delta m_{\\mathrm{S}}=1)P(\\Delta m_{\\mathrm{Si}}=1) + P(\\Delta m_{\\mathrm{S}}=2)P(\\Delta m_{\\mathrm{Si}}=0)\n$$\nWe must now derive from first principles the expressions for the probabilities of mass shifts $0$, $1$, and $2$ for the sulfur and silicon moieties separately.\n\nThe given isotopic abundances are:\nFor sulfur: $p_{34}=0.0425$ ($\\Delta m = +2$), $p_{33}=0.0075$ ($\\Delta m = +1$), and $p_{32}=1-p_{33}-p_{34}=1-0.0075-0.0425=0.9500$ ($\\Delta m = 0$).\nFor silicon: $q_{30}=0.0310$ ($\\Delta m = +2$), $q_{29}=0.0469$ ($\\Delta m = +1$), and $q_{28}=1-q_{29}-q_{30}=1-0.0469-0.0310=0.9221$ ($\\Delta m = 0$).\n\n**1. Probability distribution for the sulfur moiety ($n_{\\mathrm{S}}=3$)**\nThe selection of isotopes for the $3$ sulfur atoms follows a multinomial distribution. The probability of having $k_{32}$ atoms of $^{32}\\mathrm{S}$, $k_{33}$ of $^{33}\\mathrm{S}$, and $k_{34}$ of $^{34}\\mathrm{S}$ is:\n$$\nP(k_{32}, k_{33}, k_{34}) = \\frac{n_{\\mathrm{S}}!}{k_{32}! k_{33}! k_{34}!} p_{32}^{k_{32}} p_{33}^{k_{33}} p_{34}^{k_{34}}\n$$\nwhere $k_{32}+k_{33}+k_{34}=3$. The total mass shift from sulfur is $\\Delta m_{\\mathrm{S}} = 1 \\cdot k_{33} + 2 \\cdot k_{34}$.\n\n-   **$P(\\Delta m_{\\mathrm{S}}=0)$**: This requires $k_{33}=0$ and $k_{34}=0$, which implies $k_{32}=3$.\n    Configuration: ($3 \\times ^{32}\\mathrm{S}$).\n    $P(\\Delta m_{\\mathrm{S}}=0) = \\frac{3!}{3!0!0!} p_{32}^3 p_{33}^0 p_{34}^0 = p_{32}^3$.\n\n-   **$P(\\Delta m_{\\mathrm{S}}=1)$**: This requires $k_{33}=1$ and $k_{34}=0$, which implies $k_{32}=2$.\n    Configuration: ($1 \\times ^{33}\\mathrm{S}$, $2 \\times ^{32}\\mathrm{S}$).\n    $P(\\Delta m_{\\mathrm{S}}=1) = \\frac{3!}{2!1!0!} p_{32}^2 p_{33}^1 p_{34}^0 = 3 p_{32}^2 p_{33}$.\n\n-   **$P(\\Delta m_{\\mathrm{S}}=2)$**: This can be achieved in two disjoint ways:\n    a) One $^{34}\\mathrm{S}$ isotope: $k_{34}=1, k_{33}=0 \\implies k_{32}=2$. Configuration: ($1 \\times ^{34}\\mathrm{S}$, $2 \\times ^{32}\\mathrm{S}$).\n    Probability: $\\frac{3!}{2!0!1!} p_{32}^2 p_{33}^0 p_{34}^1 = 3 p_{32}^2 p_{34}$.\n    b) Two $^{33}\\mathrm{S}$ isotopes: $k_{33}=2, k_{34}=0 \\implies k_{32}=1$. Configuration: ($2 \\times ^{33}\\mathrm{S}$, $1 \\times ^{32}\\mathrm{S}$).\n    Probability: $\\frac{3!}{1!2!0!} p_{32}^1 p_{33}^2 p_{34}^0 = 3 p_{32} p_{33}^2$.\n    The total probability is the sum: $P(\\Delta m_{\\mathrm{S}}=2) = 3 p_{32}^2 p_{34} + 3 p_{32} p_{33}^2$.\n\n**2. Probability distribution for the silicon moiety ($n_{\\mathrm{Si}}=2$)**\nSimilarly, for the $2$ silicon atoms, with probabilities $q_{28}, q_{29}, q_{30}$:\nThe total mass shift from silicon is $\\Delta m_{\\mathrm{Si}} = 1 \\cdot j_{29} + 2 \\cdot j_{30}$, where $j_{28}+j_{29}+j_{30}=2$.\n\n-   **$P(\\Delta m_{\\mathrm{Si}}=0)$**: Requires $j_{29}=0, j_{30}=0 \\implies j_{28}=2$.\n    Configuration: ($2 \\times ^{28}\\mathrm{Si}$).\n    $P(\\Delta m_{\\mathrm{Si}}=0) = \\frac{2!}{2!0!0!} q_{28}^2 q_{29}^0 q_{30}^0 = q_{28}^2$.\n\n-   **$P(\\Delta m_{\\mathrm{Si}}=1)$**: Requires $j_{29}=1, j_{30}=0 \\implies j_{28}=1$.\n    Configuration: ($1 \\times ^{29}\\mathrm{Si}$, $1 \\times ^{28}\\mathrm{Si}$).\n    $P(\\Delta m_{\\mathrm{Si}}=1) = \\frac{2!}{1!1!0!} q_{28}^1 q_{29}^1 q_{30}^0 = 2 q_{28} q_{29}$.\n\n-   **$P(\\Delta m_{\\mathrm{Si}}=2)$**: This can be achieved in two disjoint ways:\n    a) One $^{30}\\mathrm{Si}$ isotope: $j_{30}=1, j_{29}=0 \\implies j_{28}=1$. Configuration: ($1 \\times ^{30}\\mathrm{Si}$, $1 \\times ^{28}\\mathrm{Si}$).\n    Probability: $\\frac{2!}{1!0!1!} q_{28}^1 q_{29}^0 q_{30}^1 = 2 q_{28} q_{30}$.\n    b) Two $^{29}\\mathrm{Si}$ isotopes: $j_{29}=2, j_{30}=0 \\implies j_{28}=0$. Configuration: ($2 \\times ^{29}\\mathrm{Si}$).\n    Probability: $\\frac{2!}{0!2!0!} q_{28}^0 q_{29}^2 q_{30}^0 = q_{29}^2$.\n    The total probability is the sum: $P(\\Delta m_{\\mathrm{Si}}=2) = 2 q_{28} q_{30} + q_{29}^2$.\n\n**3. Final Closed-Form Expression for $P(M+2)$**\nSubstituting these derived expressions into our original formula for $P(M+2)$:\n$$\nP(M+2) = (p_{32}^3) \\cdot (2 q_{28} q_{30} + q_{29}^2) + (3 p_{32}^2 p_{33}) \\cdot (2 q_{28} q_{29}) + (3 p_{32}^2 p_{34} + 3 p_{32} p_{33}^2) \\cdot (q_{28}^2)\n$$\nThis is the required closed-form expression derived from first principles.\n\n**4. Numerical Evaluation**\nFirst, we calculate the numerical values for the component probabilities:\n$P(\\Delta m_{\\mathrm{S}}=0) = (0.9500)^3 = 0.857375$\n$P(\\Delta m_{\\mathrm{S}}=1) = 3(0.9500)^2(0.0075) = 0.02030625$\n$P(\\Delta m_{\\mathrm{S}}=2) = 3(0.9500)^2(0.0425) + 3(0.9500)(0.0075)^2 = 0.11506875 + 0.0001603125 = 0.1152290625$\n\n$P(\\Delta m_{\\mathrm{Si}}=0) = (0.9221)^2 = 0.85026841$\n$P(\\Delta m_{\\mathrm{Si}}=1) = 2(0.9221)(0.0469) = 0.08649298$\n$P(\\Delta m_{\\mathrm{Si}}=2) = 2(0.9221)(0.0310) + (0.0469)^2 = 0.0571702 + 0.00219961 = 0.05936981$\n\nNow, we compute the three terms for $P(M+2)$:\nTerm 1: $P(\\Delta m_{\\mathrm{S}}=0)P(\\Delta m_{\\mathrm{Si}}=2) = (0.857375)(0.05936981) \\approx 0.05089850$\nTerm 2: $P(\\Delta m_{\\mathrm{S}}=1)P(\\Delta m_{\\mathrm{Si}}=1) = (0.02030625)(0.08649298) \\approx 0.00175635$\nTerm 3: $P(\\Delta m_{\\mathrm{S}}=2)P(\\Delta m_{\\mathrm{Si}}=0) = (0.1152290625)(0.85026841) \\approx 0.09798028$\n\nSumming these terms gives the total probability:\n$P(M+2) \\approx 0.05089850 + 0.00175635 + 0.09798028 = 0.15063513$\n\nRounding to four significant figures, we get $0.1506$.\nLet's use the full precision values for the final sum:\n$P(M+2) = (0.857375)(0.05936981) + (0.02030625)(0.08649298) + (0.1152290625)(0.85026841)$\n$P(M+2) = 0.050898495146875 + 0.001756346288875 + 0.09798028213200625$\n$P(M+2) = 0.15063512356775625$\n\nRounding to four significant figures, the final result is $0.1506$.", "answer": "$$\\boxed{0.1506}$$", "id": "3709664"}, {"introduction": "A common task in mass spectrometry is to deduce a molecule's elemental composition from its spectrum. This practice [@problem_id:3709605] focuses on this \"inverse problem\" by asking you to derive an estimator for the number of sulfur atoms based on an observed $M+2$ peak intensity, after accounting for the known contribution from carbon. This exercise hones your ability to quantitatively dissect a signal and extract valuable structural information.", "problem": "An organic molecular ion is recorded by high-resolution mass spectrometry under conditions that resolve nominal mass peaks. The composition is constrained to contain carbon and sulfur but no silicon. The number of carbon atoms is known to be $n_{\\mathrm{C}}=30$, and the number of silicon atoms is known to be $n_{\\mathrm{Si}}=0$. The number of sulfur atoms $n_{\\mathrm{S}}$ is unknown. The observed intensity ratio of the $M+2$ peak to the monoisotopic $M$ peak is $I_{M+2}=0.12$. Assume natural isotopic abundances with carbon-13 fraction $p_{^{13}\\mathrm{C}}=0.0107$ and sulfur-34 fraction $p_{^{34}\\mathrm{S}}=0.0421$. Neglect all other isotopic contributions to $M+2$ beyond the following two channels: exactly two $^{13}\\mathrm{C}$ substitutions among the $n_{\\mathrm{C}}$ carbons with all sulfur as $^{32}\\mathrm{S}$, and exactly one $^{34}\\mathrm{S}$ substitution among the $n_{\\mathrm{S}}$ sulfurs with all carbon as $^{12}\\mathrm{C}$. Retain the exact survival factors in $(1-p)$ for both elements in your derivation.\n\nYou may assume that the integrated ion counts in the $M$ and $M+2$ peaks are governed by independent Poisson counting statistics. In this experiment, the recorded $M$-peak area is $N_{M}=1.00\\times 10^{5}$ counts, and the $M+2$-peak area is consistent with the reported ratio $I_{M+2}=0.12$.\n\nStarting from the multinomial model for independent isotope draws at each atomic site, and using only the facts stated above, derive an explicit estimator for $n_{\\mathrm{S}}$ in terms of $I_{M+2}$, $n_{\\mathrm{C}}$, $p_{^{13}\\mathrm{C}}$, and $p_{^{34}\\mathrm{S}}$. Then evaluate this estimator numerically for the given data to obtain the maximum-likelihood estimate $\\hat{n}_{\\mathrm{S}}$. Round your reported value of $\\hat{n}_{\\mathrm{S}}$ to three significant figures. As part of your reasoning, assess the one-standard-deviation uncertainty on $\\hat{n}_{\\mathrm{S}}$ arising from counting noise via first-order error propagation, but do not include the uncertainty in your final reported value.", "solution": "The problem as stated is formally analyzed and validated against the required criteria.\n\n**Step 1: Extract Givens**\n- The molecular ion contains carbon (C) and sulfur (S), with no silicon (Si).\n- Number of carbon atoms: $n_{\\mathrm{C}}=30$.\n- Number of silicon atoms: $n_{\\mathrm{Si}}=0$.\n- Number of sulfur atoms, $n_{\\mathrm{S}}$, is unknown.\n- Observed intensity ratio of the $M+2$ peak to the monoisotopic $M$ peak: $I_{M+2}=0.12$.\n- Natural isotopic abundance (fraction) of $^{13}\\mathrm{C}$: $p_{^{13}\\mathrm{C}}=0.0107$.\n- Natural isotopic abundance (fraction) of $^{34}\\mathrm{S}$: $p_{^{34}\\mathrm{S}}=0.0421$.\n- The model for the $M+2$ peak is restricted to two channels: (1) exactly two $^{13}\\mathrm{C}$ substitutions and (2) exactly one $^{34}\\mathrm{S}$ substitution. All other isotopic contributions are neglected.\n- Survival factors of the form $(1-p)$ must be retained.\n- Ion counts for $M$ and $M+2$ peaks are governed by independent Poisson counting statistics.\n- Recorded $M$-peak area (counts): $N_{M}=1.00\\times 10^{5}$.\n- The $M+2$-peak area is consistent with the ratio $I_{M+2}=0.12$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded**: The problem is based on the well-established principles of mass spectrometry and isotopic abundance analysis. The use of a multinomial (or binomial approximation) distribution to model isotope patterns is a standard method. The given isotopic abundances are correct. The assumption of Poisson statistics for ion counting is a fundamental aspect of detector physics. The simplifications made (neglecting minor isotopes like $^{33}\\mathrm{S}$ or contributions like one $^{13}\\mathrm{C}$ and one $^{33}\\mathrm{S}$) are explicitly stated and are common for creating tractable problems in this field.\n- **Well-Posed**: The problem is well-posed. It provides sufficient data and a clear set of model assumptions to derive a unique estimator for the single unknown variable, $n_{\\mathrm{S}}$.\n- **Objective**: The problem is stated in precise, quantitative, and objective language, free from any subjective or ambiguous terminology.\n\n**Step 3: Verdict and Action**\nThe problem is scientifically sound, self-contained, and well-posed. It is therefore deemed **valid**. A solution will be derived.\n\n**Derivation of the Estimator for $n_{\\mathrm{S}}$**\n\nThe intensity of a mass peak is proportional to the probability of occurrence of the corresponding isotopic composition. We model the selection of isotopes at each atomic site as an independent Bernoulli trial.\n\nThe monoisotopic peak, $M$, corresponds to the molecule composed entirely of the most abundant isotopes, $^{12}\\mathrm{C}$ and $^{32}\\mathrm{S}$. The probability of a carbon atom being $^{12}\\mathrm{C}$ is $(1 - p_{^{13}\\mathrm{C}})$. The probability of a sulfur atom being $^{32}\\mathrm{S}$ is approximated as $(1 - p_{^{34}\\mathrm{S}})$, as other sulfur isotopes are neglected per the problem statement. The probability of the monoisotopic species, $P(M)$, is:\n$$P(M) = (1 - p_{^{13}\\mathrm{C}})^{n_{\\mathrm{C}}} (1 - p_{^{34}\\mathrm{S}})^{n_{\\mathrm{S}}}$$\n\nThe $M+2$ peak intensity is the sum of probabilities of the two specified channels.\n1.  **Channel 1: Two $^{13}\\mathrm{C}$ atoms.** The molecule has exactly two $^{13}\\mathrm{C}$ atoms among the $n_{\\mathrm{C}}$ carbons, and all $n_{\\mathrm{S}}$ sulfur atoms are $^{32}\\mathrm{S}$. The number of ways to choose two carbons is $\\binom{n_{\\mathrm{C}}}{2}$. The probability for this channel, $P(M+2)_{\\mathrm{C}}$, is:\n    $$P(M+2)_{\\mathrm{C}} = \\binom{n_{\\mathrm{C}}}{2} (p_{^{13}\\mathrm{C}})^{2} (1 - p_{^{13}\\mathrm{C}})^{n_{\\mathrm{C}}-2} (1 - p_{^{34}\\mathrm{S}})^{n_{\\mathrm{S}}}$$\n2.  **Channel 2: One $^{34}\\mathrm{S}$ atom.** The molecule has exactly one $^{34}\\mathrm{S}$ atom among the $n_{\\mathrm{S}}$ sulfurs, and all $n_{\\mathrm{C}}$ carbon atoms are $^{12}\\mathrm{C}$. The number of ways to choose one sulfur is $\\binom{n_{\\mathrm{S}}}{1} = n_{\\mathrm{S}}$. The probability for this channel, $P(M+2)_{\\mathrm{S}}$, is:\n    $$P(M+2)_{\\mathrm{S}} = \\binom{n_{\\mathrm{S}}}{1} p_{^{34}\\mathrm{S}} (1 - p_{^{34}\\mathrm{S}})^{n_{\\mathrm{S}}-1} (1 - p_{^{13}\\mathrm{C}})^{n_{\\mathrm{C}}}$$\n\nThe total probability for the $M+2$ isotopic species, $P(M+2)$, is the sum of these mutually exclusive events:\n$$P(M+2) = P(M+2)_{\\mathrm{C}} + P(M+2)_{\\mathrm{S}}$$\n\nThe theoretical intensity ratio, $I_{\\text{theory}}$, is the ratio of these probabilities, which we equate to the observed ratio $I_{M+2}$:\n$$I_{M+2} = \\frac{P(M+2)}{P(M)} = \\frac{P(M+2)_{\\mathrm{C}}}{P(M)} + \\frac{P(M+2)_{\\mathrm{S}}}{P(M)}$$\nSubstituting the expressions and simplifying:\n$$I_{M+2} = \\frac{\\binom{n_{\\mathrm{C}}}{2} (p_{^{13}\\mathrm{C}})^{2} (1 - p_{^{13}\\mathrm{C}})^{n_{\\mathrm{C}}-2} (1 - p_{^{34}\\mathrm{S}})^{n_{\\mathrm{S}}}}{(1 - p_{^{13}\\mathrm{C}})^{n_{\\mathrm{C}}} (1 - p_{^{34}\\mathrm{S}})^{n_{\\mathrm{S}}}} + \\frac{\\binom{n_{\\mathrm{S}}}{1} p_{^{34}\\mathrm{S}} (1 - p_{^{34}\\mathrm{S}})^{n_{\\mathrm{S}}-1} (1 - p_{^{13}\\mathrm{C}})^{n_{\\mathrm{C}}}}{(1 - p_{^{13}\\mathrm{C}})^{n_{\\mathrm{C}}} (1 - p_{^{34}\\mathrm{S}})^{n_{\\mathrm{S}}}}$$\n$$I_{M+2} = \\binom{n_{\\mathrm{C}}}{2} \\frac{(p_{^{13}\\mathrm{C}})^2}{(1 - p_{^{13}\\mathrm{C}})^2} + \\binom{n_{\\mathrm{S}}}{1} \\frac{p_{^{34}\\mathrm{S}}}{1 - p_{^{34}\\mathrm{S}}}$$\nUsing $\\binom{n}{k} = \\frac{n(n-1)...(n-k+1)}{k!}$, we have $\\binom{n_{\\mathrm{C}}}{2} = \\frac{n_{\\mathrm{C}}(n_{\\mathrm{C}}-1)}{2}$ and $\\binom{n_{\\mathrm{S}}}{1} = n_{\\mathrm{S}}$.\n$$I_{M+2} = \\frac{n_{\\mathrm{C}}(n_{\\mathrm{C}}-1)}{2} \\left(\\frac{p_{^{13}\\mathrm{C}}}{1 - p_{^{13}\\mathrm{C}}}\\right)^2 + n_{\\mathrm{S}} \\left(\\frac{p_{^{34}\\mathrm{S}}}{1 - p_{^{34}\\mathrm{S}}}\\right)$$\nWe can now rearrange this equation to solve for $n_{\\mathrm{S}}$. This provides the explicit estimator:\n$$n_{\\mathrm{S}} \\left(\\frac{p_{^{34}\\mathrm{S}}}{1 - p_{^{34}\\mathrm{S}}}\\right) = I_{M+2} - \\frac{n_{\\mathrm{C}}(n_{\\mathrm{C}}-1)}{2} \\left(\\frac{p_{^{13}\\mathrm{C}}}{1 - p_{^{13}\\mathrm{C}}}\\right)^2$$\n$$\\hat{n}_{\\mathrm{S}} = \\left( I_{M+2} - \\frac{n_{\\mathrm{C}}(n_{\\mathrm{C}}-1)}{2} \\left(\\frac{p_{^{13}\\mathrm{C}}}{1 - p_{^{13}\\mathrm{C}}}\\right)^2 \\right) \\left(\\frac{1 - p_{^{34}\\mathrm{S}}}{p_{^{34}\\mathrm{S}}}\\right)$$\n\n**Numerical Evaluation**\nWe substitute the given values into the estimator for $\\hat{n}_{\\mathrm{S}}$:\n- $I_{M+2} = 0.12$\n- $n_{\\mathrm{C}} = 30$\n- $p_{^{13}\\mathrm{C}} = 0.0107$\n- $p_{^{34}\\mathrm{S}} = 0.0421$\n\nFirst, calculate the contribution from carbon:\n$$\\text{Carbon term} = \\frac{30(29)}{2} \\left(\\frac{0.0107}{1 - 0.0107}\\right)^2 = 435 \\left(\\frac{0.0107}{0.9893}\\right)^2 \\approx 435 \\times (0.0108157)^2 \\approx 0.050895$$\nNext, calculate the multiplicative factor for the sulfur term:\n$$\\frac{1 - p_{^{34}\\mathrm{S}}}{p_{^{34}\\mathrm{S}}} = \\frac{1 - 0.0421}{0.0421} = \\frac{0.9579}{0.0421} \\approx 22.753$$\nNow, substitute these into the expression for $\\hat{n}_{\\mathrm{S}}$:\n$$\\hat{n}_{\\mathrm{S}} \\approx (0.12 - 0.050895) \\times 22.753$$\n$$\\hat{n}_{\\mathrm{S}} \\approx 0.069105 \\times 22.753 \\approx 1.57228$$\nRounding to three significant figures, the maximum-likelihood estimate is $\\hat{n}_{\\mathrm{S}} = 1.57$. This non-integer result is an expected outcome for a statistical estimator based on noisy data.\n\n**Uncertainty Analysis**\nThe uncertainty in $\\hat{n}_{\\mathrm{S}}$ arises from the Poisson counting noise in the measurement of $I_{M+2}$.\nThe estimator is of the form $\\hat{n}_{\\mathrm{S}} = (I_{M+2} - C)K$, where $C$ and $K$ are constants derived from $n_{\\mathrm{C}}$, $p_{^{13}\\mathrm{C}}$, and $p_{^{34}\\mathrm{S}}$.\nUsing first-order error propagation, the variance of $\\hat{n}_{\\mathrm{S}}$ is $\\sigma^2_{\\hat{n}_{\\mathrm{S}}} \\approx \\left(\\frac{\\partial \\hat{n}_{\\mathrm{S}}}{\\partial I_{M+2}}\\right)^2 \\sigma^2_{I_{M+2}}$.\nThe derivative is $\\frac{\\partial \\hat{n}_{\\mathrm{S}}}{\\partial I_{M+2}} = K = \\frac{1 - p_{^{34}\\mathrm{S}}}{p_{^{34}\\mathrm{S}}}$.\nThe variance of the ratio $I_{M+2} = N_{M+2}/N_M$, where $N_M$ and $N_{M+2}$ are independent Poisson counts, is given by $\\sigma^2_I \\approx \\frac{I(1+I)}{N_M}$.\nWith $N_M = 1.00 \\times 10^5$ and $I_{M+2} = 0.12$:\n$$\\sigma^2_{I_{M+2}} \\approx \\frac{0.12(1+0.12)}{1.00 \\times 10^5} = \\frac{0.1344}{10^5} = 1.344 \\times 10^{-6}$$\nThe standard deviation of the ratio is $\\sigma_{I_{M+2}} = \\sqrt{1.344 \\times 10^{-6}} \\approx 1.159 \\times 10^{-3}$.\nThe uncertainty on $\\hat{n}_{\\mathrm{S}}$ is:\n$$\\sigma_{\\hat{n}_{\\mathrm{S}}} \\approx |K| \\sigma_{I_{M+2}} \\approx 22.753 \\times (1.159 \\times 10^{-3}) \\approx 0.026$$\nThus, the estimate can be reported as $\\hat{n}_{\\mathrm{S}} = 1.572 \\pm 0.026$. The small uncertainty indicates that the true integer value is very unlikely to be $1$, but is consistent with being $2$. However, the question asks for the numerical value of the estimator itself.", "answer": "$$\\boxed{1.57}$$", "id": "3709605"}, {"introduction": "Real-world data is noisy and often requires sophisticated modeling to interpret correctly. This advanced practice [@problem_id:3709610] simulates this scenario, guiding you to build a full isotopic model and use least-squares fitting to estimate both sulfur and silicon counts from a noisy spectrum. It introduces the critical concept of identifiability, allowing you to assess whether your data is robust enough to reliably distinguish between these two diagnostically important elements.", "problem": "You are given observed relative intensities from High-Resolution Mass Spectrometry (HRMS) for the first three peaks in an isotopic envelope, corresponding to the monoisotopic peak $\\mathrm{M}$, $\\mathrm{M}+1$, and $\\mathrm{M}+2$. The envelope is determined by the elemental composition of an organic compound with counts $\\left(n_{\\mathrm{C}}, n_{\\mathrm{H}}, n_{\\mathrm{N}}, n_{\\mathrm{O}}, n_{\\mathrm{S}}, n_{\\mathrm{Si}}\\right)$ of carbon, hydrogen, nitrogen, oxygen, sulfur, and silicon atoms, respectively. Assume the following fundamental base facts.\n\n- For each element, isotopic substitutions are independent across atoms, and each atom independently contributes a mass shift of $0$, $+1$, or $+2$ units with probabilities given by its natural isotopic abundances.\n- Natural isotopic abundances (heavy-isotope fractions) are treated as constants:\n  - Carbon: $p^{(\\mathrm{C})}_{+1} = 0.0107$, $p^{(\\mathrm{C})}_{+2} = 0$.\n  - Hydrogen: $p^{(\\mathrm{H})}_{+1} = 0.000115$, $p^{(\\mathrm{H})}_{+2} = 0$.\n  - Nitrogen: $p^{(\\mathrm{N})}_{+1} = 0.00364$, $p^{(\\mathrm{N})}_{+2} = 0$.\n  - Oxygen: $p^{(\\mathrm{O})}_{+1} = 0.00038$, $p^{(\\mathrm{O})}_{+2} = 0.00205$.\n  - Sulfur: $p^{(\\mathrm{S})}_{+1} = 0.0075$, $p^{(\\mathrm{S})}_{+2} = 0.0429$.\n  - Silicon: $p^{(\\mathrm{Si})}_{+1} = 0.0469$, $p^{(\\mathrm{Si})}_{+2} = 0.0312$.\n- For each element $E \\in \\{\\mathrm{C}, \\mathrm{H}, \\mathrm{N}, \\mathrm{O}, \\mathrm{S}, \\mathrm{Si}\\}$, define $p^{(E)}_{0} = 1 - p^{(E)}_{+1} - p^{(E)}_{+2}$ and assume $p^{(E)}_{0} > 0$.\n\nStarting from these base facts, derive how to compute the theoretical envelope of the first three peaks $\\left(\\mathrm{M}, \\mathrm{M}+1, \\mathrm{M}+2\\right)$ as a function of $\\left(n_{\\mathrm{C}}, n_{\\mathrm{H}}, n_{\\mathrm{N}}, n_{\\mathrm{O}}, n_{\\mathrm{S}}, n_{\\mathrm{Si}}\\right)$, and normalize the envelope so that the three intensities sum to $1$ (i.e., express intensities as decimal fractions summing to $1$). Then formulate a least-squares fit that estimates $\\left(n_{\\mathrm{S}}, n_{\\mathrm{Si}}\\right)$ from observed intensities when $\\left(n_{\\mathrm{C}}, n_{\\mathrm{H}}, n_{\\mathrm{N}}, n_{\\mathrm{O}}\\right)$ are known and fixed. Finally, discuss and implement an identifiability criterion for $\\left(n_{\\mathrm{S}}, n_{\\mathrm{Si}}\\right)$ based on the local sensitivity (Jacobian) of the normalized intensities with respect to $\\left(n_{\\mathrm{S}}, n_{\\mathrm{Si}}\\right)$.\n\nYour program must:\n\n- Implement the theoretical model consistent with the base facts above.\n- For a given set of known counts $\\left(n_{\\mathrm{C}}, n_{\\mathrm{H}}, n_{\\mathrm{N}}, n_{\\mathrm{O}}\\right)$ and unknown $\\left(n_{\\mathrm{S}}, n_{\\mathrm{Si}}\\right)$, compute the normalized theoretical intensities for $\\mathrm{M}$, $\\mathrm{M}+1$, and $\\mathrm{M}+2$.\n- Given observed intensities $\\left(I_{0}^{\\mathrm{obs}}, I_{1}^{\\mathrm{obs}}, I_{2}^{\\mathrm{obs}}\\right)$ that are normalized to sum to $1$, estimate $\\left(n_{\\mathrm{S}}, n_{\\mathrm{Si}}\\right)$ by minimizing the sum of squared residuals $\\sum_{m \\in \\{0,1,2\\}} \\left(I_{m}^{\\mathrm{theory}} - I_{m}^{\\mathrm{obs}}\\right)^{2}$ subject to the constraints $n_{\\mathrm{S}} \\ge 0$ and $n_{\\mathrm{Si}} \\ge 0$.\n- Assess identifiability of $\\left(n_{\\mathrm{S}}, n_{\\mathrm{Si}}\\right)$ at the estimated solution by computing the Jacobian of the normalized intensity vector with respect to $\\left(n_{\\mathrm{S}}, n_{\\mathrm{Si}}\\right)$ and returning a boolean flag indicating identifiability based on the condition number of the Jacobian’s column space. Use the rule: identifiable if and only if the condition number is less than or equal to $10^{3}$.\n\nObserved intensities must be in unitless decimal fractions. Angles are not involved. All outputs must be numeric primitives or lists of them.\n\nTest Suite:\n\nFor each test case, the observed intensities must be generated as follows: compute the theoretical normalized envelope for the stated ground-truth counts, add the given noise vector component-wise, and renormalize the three intensities to sum to $1$.\n\n- Test $1$ (happy path, sulfur present, silicon absent): ground truth $\\left(n_{\\mathrm{C}}, n_{\\mathrm{H}}, n_{\\mathrm{N}}, n_{\\mathrm{O}}, n_{\\mathrm{S}}, n_{\\mathrm{Si}}\\right) = (20, 40, 2, 5, 1, 0)$, noise vector $\\left(\\delta_{0}, \\delta_{1}, \\delta_{2}\\right) = (0.0005, -0.0003, -0.0002)$.\n- Test $2$ (boundary, neither sulfur nor silicon): ground truth $\\left(n_{\\mathrm{C}}, n_{\\mathrm{H}}, n_{\\mathrm{N}}, n_{\\mathrm{O}}, n_{\\mathrm{S}}, n_{\\mathrm{Si}}\\right) = (10, 20, 0, 3, 0, 0)$, noise vector $\\left(\\delta_{0}, \\delta_{1}, \\delta_{2}\\right) = (-0.0002, 0.0001, 0.0001)$.\n- Test $3$ (potential confounding, both sulfur and silicon present): ground truth $\\left(n_{\\mathrm{C}}, n_{\\mathrm{H}}, n_{\\mathrm{N}}, n_{\\mathrm{O}}, n_{\\mathrm{S}}, n_{\\mathrm{Si}}\\right) = (15, 30, 0, 4, 2, 2)$, noise vector $\\left(\\delta_{0}, \\delta_{1}, \\delta_{2}\\right) = (0.0004, -0.0002, -0.0002)$.\n- Test $4$ (edge, high carbon, silicon only): ground truth $\\left(n_{\\mathrm{C}}, n_{\\mathrm{H}}, n_{\\mathrm{N}}, n_{\\mathrm{O}}, n_{\\mathrm{S}}, n_{\\mathrm{Si}}\\right) = (60, 100, 0, 0, 0, 3)$, noise vector $\\left(\\delta_{0}, \\delta_{1}, \\delta_{2}\\right) = (0.0003, -0.0002, -0.0001)$.\n\nFor each test case, treat $\\left(n_{\\mathrm{C}}, n_{\\mathrm{H}}, n_{\\mathrm{N}}, n_{\\mathrm{O}}\\right)$ as known. Estimate $\\left(n_{\\mathrm{S}}, n_{\\mathrm{Si}}\\right)$ and report:\n\n- The estimated $n_{\\mathrm{S}}$ rounded to the nearest integer.\n- The estimated $n_{\\mathrm{Si}}$ rounded to the nearest integer.\n- The final sum of squared residuals as a decimal fraction.\n- The identifiability flag as a boolean determined by the Jacobian condition number rule.\n\nFinal Output Format:\n\nYour program should produce a single line of output containing the results for the four test cases as a comma-separated list enclosed in square brackets, where each test case’s result is itself a list in the order $\\left[n_{\\mathrm{S}}^{\\mathrm{est}}, n_{\\mathrm{Si}}^{\\mathrm{est}}, \\mathrm{SSE}, \\mathrm{identifiable}\\right]$. For example: $\\left[[1,0,0.000123,\\mathrm{True}],[\\dots]\\right]$. All intensities and residuals must be expressed as decimal fractions (not percentages).", "solution": "The user-provided problem statement has been meticulously reviewed and is determined to be valid. It is scientifically grounded in the principles of mass spectrometry, well-posed, and contains all necessary information for a complete solution.\n\n### 1. Theoretical Model of Isotopic Intensities\n\nThe relative intensity of isotopic peaks in a mass spectrum is governed by the natural abundances of heavy isotopes for each element in the molecule. For a molecule with an elemental composition given by the counts $\\left(n_{\\mathrm{C}}, n_{\\mathrm{H}}, n_{\\mathrm{N}}, n_{\\mathrm{O}}, n_{\\mathrm{S}}, n_{\\mathrm{Si}}\\right)$, we can model the distribution of mass shifts relative to the monoisotopic mass.\n\nThe fundamental assumption is that isotopic substitutions are independent events, both within and across elements. For each atom of an element $E$, there are probabilities $p^{(E)}_{+1}$ and $p^{(E)}_{+2}$ of it being a heavy isotope that contributes a mass shift of $+1$ or $+2$ Da, respectively. The probability of a zero shift (i.e., being the most abundant light isotope) is $p^{(E)}_{0} = 1 - p^{(E)}_{+1} - p^{(E)}_{+2}$.\n\nA powerful tool for this analysis is the probability generating function (PGF). For a single atom of element $E$, the PGF for its mass shift is:\n$$G_E(z) = p^{(E)}_{0} + p^{(E)}_{+1}z^1 + p^{(E)}_{+2}z^2$$\nFor a group of $n_E$ independent and identically distributed atoms of element $E$, the PGF for their total mass shift is the product of their individual PGFs:\n$$G_{E, n_E}(z) = \\left( G_E(z) \\right)^{n_E} = \\left( p^{(E)}_{0} + p^{(E)}_{+1}z + p^{(E)}_{+2}z^2 \\right)^{n_E}$$\nDue to the independence of contributions from different elements, the PGF for the total mass shift of the entire molecule is the product of the PGFs for each elemental group:\n$$G_{\\text{total}}(z) = \\prod_{E \\in \\{\\mathrm{C,H,N,O,S,Si}\\}} G_{E, n_E}(z) = \\prod_{E} \\left( p^{(E)}_{0} + p^{(E)}_{+1}z + p^{(E)}_{+2}z^2 \\right)^{n_E}$$\nThe unnormalized theoretical intensities of the first three isotopic peaks, $I'_{0}$ (M), $I'_{1}$ (M+1), and $I'_{2}$ (M+2), are the coefficients of $z^0$, $z^1$, and $z^2$ in the Maclaurin series expansion of $G_{\\text{total}}(z)$:\n$$G_{\\text{total}}(z) = I'_{0} + I'_{1}z + I'_{2}z^2 + \\mathcal{O}(z^3)$$\nThese coefficients can be found by evaluating the derivatives of $G_{\\text{total}}(z)$ at $z=0$:\n$$I'_{0} = G_{\\text{total}}(0)$$\n$$I'_{1} = \\frac{G'_{\\text{total}}(0)}{1!}$$\n$$I'_{2} = \\frac{G''_{\\text{total}}(0)}{2!}$$\nTo simplify the derivative calculations, we define $H(z) = \\ln G_{\\text{total}}(z) = \\sum_E n_E \\ln G_E(z)$. The derivatives are:\n$G'_{\\text{total}}(z) = G_{\\text{total}}(z) H'(z)$\n$G''_{\\text{total}}(z) = G_{\\text{total}}(z) \\left( (H'(z))^2 + H''(z) \\right)$\n\nEvaluating at $z=0$:\n$G_E(0) = p^{(E)}_0$, so $I'_{0} = G_{\\text{total}}(0) = \\prod_E \\left(p^{(E)}_0\\right)^{n_E}$.\n$H'(0) = \\sum_E n_E \\frac{G'_E(0)}{G_E(0)} = \\sum_E n_E \\frac{p^{(E)}_{+1}}{p^{(E)}_0}$. Let $u_E = p^{(E)}_{+1}/p^{(E)}_0$.\nThen $I'_{1} = G_{\\text{total}}(0) H'(0) = I'_{0} \\sum_E n_E u_E$.\n\n$H''(0) = \\sum_E n_E \\frac{G''_E(0)G_E(0) - (G'_E(0))^2}{(G_E(0))^2} = \\sum_E n_E \\frac{2p^{(E)}_{+2}p^{(E)}_0 - (p^{(E)}_{+1})^2}{(p^{(E)}_0)^2}$. Let $v_E = p^{(E)}_{+2}/p^{(E)}_0$.\nThen $H''(0) = \\sum_E n_E (2v_E - u_E^2)$.\n$I'_{2} = \\frac{1}{2} G_{\\text{total}}(0) \\left( (H'(0))^2 + H''(0) \\right) = \\frac{1}{2} I'_{0} \\left( \\left(\\sum_E n_E u_E\\right)^2 + \\sum_E n_E(2v_E - u_E^2) \\right)$.\n\nSo, the formulas for the unnormalized intensities are:\n$$I'_{0} = \\prod_E \\left(p^{(E)}_0\\right)^{n_E}$$\n$$I'_{1} = I'_{0} \\left( \\sum_E n_E \\frac{p^{(E)}_{+1}}{p^{(E)}_0} \\right)$$\n$$I'_{2} = \\frac{I'_{0}}{2} \\left[ \\left(\\sum_E n_E \\frac{p^{(E)}_{+1}}{p^{(E)}_0}\\right)^2 + \\sum_E n_E \\left( \\frac{2p^{(E)}_{+2}}{p^{(E)}_0} - \\left(\\frac{p^{(E)}_{+1}}{p^{(E)}_0}\\right)^2 \\right) \\right]$$\nThese raw intensities are then normalized to sum to $1$ to yield the final theoretical intensities $(I_0, I_1, I_2)$ for comparison with observed data:\n$$S = I'_{0} + I'_{1} + I'_{2}$$\n$$I_m = \\frac{I'_{m}}{S} \\quad \\text{for } m \\in \\{0, 1, 2\\}$$\n\n### 2. Parameter Estimation via Least-Squares Minimization\n\nGiven the known counts $(n_{\\mathrm{C}}, n_{\\mathrm{H}}, n_{\\mathrm{N}}, n_{\\mathrm{O}})$ and observed normalized intensities $(I_{0}^{\\mathrm{obs}}, I_{1}^{\\mathrm{obs}}, I_{2}^{\\mathrm{obs}})$, the goal is to estimate the unknown counts $(n_{\\mathrm{S}}, n_{\\mathrm{Si}})$. This is formulated as a non-linear least-squares optimization problem. We seek to find the values of $n_{\\mathrm{S}}$ and $n_{\\mathrm{Si}}$ that minimize the sum of squared errors (SSE) between the theoretical and observed intensities:\n$$\\text{SSE}(n_{\\mathrm{S}}, n_{\\mathrm{Si}}) = \\sum_{m=0}^{2} \\left( I_{m}^{\\mathrm{theory}}(n_{\\mathrm{S}}, n_{\\mathrm{Si}}) - I_{m}^{\\mathrm{obs}} \\right)^2$$\nThe optimization is performed under the physically necessary constraints $n_{\\mathrm{S}} \\ge 0$ and $n_{\\mathrm{Si}} \\ge 0$. Although atom counts are integers, it is standard practice to treat them as continuous variables during optimization for computational convenience, and then round the final continuous estimate to the nearest integer. This minimization problem is solved using a numerical algorithm such as L-BFGS-B, which can handle box constraints.\n\n### 3. Identifiability Analysis using the Jacobian\n\nIdentifiability concerns whether the parameters of a model, here $(n_{\\mathrm{S}}, n_{\\mathrm{Si}})$, can be uniquely determined from the observed data. Poor identifiability arises when different combinations of parameter values produce very similar model outputs. We assess this locally at the estimated solution $(\\hat{n}_{\\mathrm{S}}, \\hat{n}_{\\mathrm{Si}})$ by examining the sensitivity of the model output to small changes in the parameters.\n\nThis sensitivity is captured by the Jacobian matrix, $J$, of the normalized intensity vector $I = (I_0, I_1, I_2)^T$ with respect to the vector of unknown parameters $n_{\\text{unk}} = (n_{\\mathrm{S}}, n_{\\mathrm{Si}})^T$:\n$$J = \\frac{\\partial I}{\\partial n_{\\text{unk}}} = \\begin{pmatrix}\n\\frac{\\partial I_0}{\\partial n_{\\mathrm{S}}} & \\frac{\\partial I_0}{\\partial n_{\\mathrm{Si}}} \\\\\n\\frac{\\partial I_1}{\\partial n_{\\mathrm{S}}} & \\frac{\\partial I_1}{\\partial n_{\\mathrm{Si}}} \\\\\n\\frac{\\partial I_2}{\\partial n_{\\mathrm{S}}} & \\frac{\\partial I_2}{\\partial n_{\\mathrm{Si}}}\n\\end{pmatrix}$$\nThe columns of $J$ represent how the intensity pattern changes with an infinitesimal change in $n_{\\mathrm{S}}$ and $n_{\\mathrm{Si}}$, respectively. If these columns are nearly linearly dependent, it becomes difficult to distinguish the effect of sulfur from that of silicon.\n\nThe degree of this linear dependence is quantified by the condition number, $\\kappa(J)$, of the Jacobian matrix, defined as the ratio of its largest singular value ($\\sigma_{\\text{max}}$) to its smallest singular value ($\\sigma_{\\text{min}}$):\n$$\\kappa(J) = \\frac{\\sigma_{\\text{max}}}{\\sigma_{\\text{min}}}$$\nA large condition number indicates that the matrix is close to being singular (rank-deficient), implying poor identifiability. The problem specifies a quantitative criterion: the parameters $(n_{\\mathrm{S}}, n_{\\mathrm{Si}})$ are considered identifiable if and only if $\\kappa(J) \\le 10^3$.\n\nThe partial derivatives in the Jacobian are computed numerically using a central finite difference scheme for accuracy and implementation simplicity:\n$$\\frac{\\partial f(x)}{\\partial x_i} \\approx \\frac{f(x + h e_i) - f(x - h e_i)}{2h}$$\nwhere $e_i$ is a standard basis vector and $h$ is a small step size.", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Main function to run the isotopic analysis for all test cases.\n    \"\"\"\n    isotope_data = {\n        'C': {'p1': 0.0107, 'p2': 0.0},\n        'H': {'p1': 0.000115, 'p2': 0.0},\n        'N': {'p1': 0.00364, 'p2': 0.0},\n        'O': {'p1': 0.00038, 'p2': 0.00205},\n        'S': {'p1': 0.0075, 'p2': 0.0429},\n        'Si': {'p1': 0.0469, 'p2': 0.0312},\n    }\n\n    params = {}\n    for elem, p_vals in isotope_data.items():\n        p1, p2 = p_vals['p1'], p_vals['p2']\n        p0 = 1.0 - p1 - p2\n        params[elem] = {\n            'p0': p0,\n            'u': p1 / p0 if p0 > 1e-12 else 0.0,\n            'v': p2 / p0 if p0 > 1e-12 else 0.0,\n        }\n\n    test_cases = [\n        {'known_counts': {'C': 20, 'H': 40, 'N': 2, 'O': 5}, 'gt_unknown_counts': {'S': 1, 'Si': 0}, 'noise': (0.0005, -0.0003, -0.0002)},\n        {'known_counts': {'C': 10, 'H': 20, 'N': 0, 'O': 3}, 'gt_unknown_counts': {'S': 0, 'Si': 0}, 'noise': (-0.0002, 0.0001, 0.0001)},\n        {'known_counts': {'C': 15, 'H': 30, 'N': 0, 'O': 4}, 'gt_unknown_counts': {'S': 2, 'Si': 2}, 'noise': (0.0004, -0.0002, -0.0002)},\n        {'known_counts': {'C': 60, 'H': 100, 'N': 0, 'O': 0}, 'gt_unknown_counts': {'S': 0, 'Si': 3}, 'noise': (0.0003, -0.0002, -0.0001)},\n    ]\n\n    results = []\n    for case in test_cases:\n        observed_intensities = generate_observed_data(case['known_counts'], case['gt_unknown_counts'], case['noise'], params)\n        result = fit_and_analyze(case['known_counts'], observed_intensities, params)\n        results.append(result)\n\n    # Format the final output string exactly as required\n    result_str = '[' + ','.join([f\"[{res[0]},{res[1]},{res[2]:.6f},{'True' if res[3] else 'False'}]\" for res in results]) + ']'\n    print(result_str)\n\ndef calculate_theoretical_intensities(counts, params):\n    \"\"\"\n    Computes the normalized theoretical intensities for a given elemental composition.\n    \n    Args:\n        counts (dict): A dictionary mapping element symbols to their counts.\n        params (dict): A dictionary with pre-calculated isotope parameters (p0, u, v).\n\n    Returns:\n        numpy.ndarray: A 1D array of three normalized intensities (M, M+1, M+2).\n    \"\"\"\n    # Using logarithms for I'_0 to prevent potential underflow with large molecules.\n    log_I_prime_0 = sum(n * np.log(params[elem]['p0']) for elem, n in counts.items() if n > 0)\n    I_prime_0 = np.exp(log_I_prime_0)\n\n    sum_n_u = sum(n * params[elem]['u'] for elem, n in counts.items())\n    sum_n_v = sum(n * params[elem]['v'] for elem, n in counts.items())\n    sum_n_u_sq = sum(n * (params[elem]['u']**2) for elem, n in counts.items())\n\n    # Calculate unnormalized M+1 and M+2 based on PGF derivatives\n    I_prime_1 = I_prime_0 * sum_n_u\n    I_prime_2 = 0.5 * I_prime_0 * (sum_n_u**2 + 2 * sum_n_v - sum_n_u_sq)\n    \n    unnormalized = np.array([I_prime_0, I_prime_1, I_prime_2])\n    \n    total_intensity = np.sum(unnormalized)\n    if total_intensity > 1e-12:\n        return unnormalized / total_intensity\n    else:\n        return np.array([1.0, 0.0, 0.0])\n\ndef generate_observed_data(known_counts, gt_unknown_counts, noise, params):\n    \"\"\"\n    Generates observed intensities by adding noise to the ground truth and renormalizing.\n    \"\"\"\n    full_counts = {**known_counts, **gt_unknown_counts}\n    theoretical_intensities = calculate_theoretical_intensities(full_counts, params)\n    noisy_intensities = theoretical_intensities + np.array(noise)\n    return noisy_intensities / np.sum(noisy_intensities)\n\ndef fit_and_analyze(known_counts, observed_intensities, params):\n    \"\"\"\n    Performs least-squares fitting and identifiability analysis.\n    \"\"\"\n    def objective_function(unknown_vars):\n        n_S, n_Si = unknown_vars\n        counts = known_counts.copy()\n        counts['S'] = n_S\n        counts['Si'] = n_Si\n        \n        theoretical_intensities = calculate_theoretical_intensities(counts, params)\n        sse = np.sum((theoretical_intensities - observed_intensities)**2)\n        return sse\n\n    # Perform minimization\n    initial_guess = [0.0, 0.0]\n    bounds = [(0, None), (0, None)]\n    result = minimize(objective_function, initial_guess, method='L-BFGS-B', bounds=bounds)\n    \n    optimal_vars = result.x\n    final_sse = result.fun\n    \n    # Round estimates to the nearest integer\n    n_S_est = int(np.round(optimal_vars[0]))\n    n_Si_est = int(np.round(optimal_vars[1]))\n\n    # --- Identifiability Analysis ---\n    def get_normalized_intensities_for_jacobian(unknown_vars):\n        counts = known_counts.copy()\n        counts['S'], counts['Si'] = unknown_vars\n        return calculate_theoretical_intensities(counts, params)\n\n    h = 1e-6\n    jacobian = np.zeros((3, 2))\n    \n    # Partial derivative with respect to n_S\n    vars_p_s = [optimal_vars[0] + h, optimal_vars[1]]\n    vars_m_s = [optimal_vars[0] - h, optimal_vars[1]]\n    I_p_s = get_normalized_intensities_for_jacobian(vars_p_s)\n    I_m_s = get_normalized_intensities_for_jacobian(vars_m_s)\n    jacobian[:, 0] = (I_p_s - I_m_s) / (2 * h)\n\n    # Partial derivative with respect to n_Si\n    vars_p_si = [optimal_vars[0], optimal_vars[1] + h]\n    vars_m_si = [optimal_vars[0], optimal_vars[1] - h]\n    I_p_si = get_normalized_intensities_for_jacobian(vars_p_si)\n    I_m_si = get_normalized_intensities_for_jacobian(vars_m_si)\n    jacobian[:, 1] = (I_p_si - I_m_si) / (2 * h)\n    \n    try:\n        _, s, _ = np.linalg.svd(jacobian, full_matrices=False)\n        if s[1]  1e-12: # Check for near-zero smallest singular value\n            cond_num = np.inf\n        else:\n            cond_num = s[0] / s[1]\n    except np.linalg.LinAlgError:\n        cond_num = np.inf\n\n    is_identifiable = (cond_num = 1000.0)\n\n    return n_S_est, n_Si_est, final_sse, is_identifiable\n\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3709610"}]}