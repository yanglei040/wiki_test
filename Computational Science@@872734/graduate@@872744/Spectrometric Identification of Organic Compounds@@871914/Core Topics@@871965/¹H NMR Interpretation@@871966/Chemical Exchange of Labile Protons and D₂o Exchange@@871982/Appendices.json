{"hands_on_practices": [{"introduction": "One of the most powerful and routine applications of $\\mathrm{D_2O}$ exchange is in structure elucidation. By providing a simple and definitive test for labile protons, it allows chemists to confirm the presence of functional groups like hydroxyls, amines, and carboxylic acids. This practice [@problem_id:3695986] challenges you to act as a detective, using a combination of spectroscopic data to solve a molecular puzzle where identifying the number of exchangeable protons is the key.", "problem": "An unknown neutral organic compound is characterized by High-Resolution Mass Spectrometry (HRMS) as having the molecular formula $\\mathrm{C_7H_7NO_2}$. Infrared (IR) spectroscopy shows a strong carbonyl stretch and a broad signal consistent with a hydrogen-bonded hydroxyl group. Carbon-13 Nuclear Magnetic Resonance ($^{13}$C NMR) spectroscopy reveals one downfield resonance indicative of a single carbonyl carbon and six aromatic carbons, consistent with a para-disubstituted benzene ring. Proton Nuclear Magnetic Resonance ($^{1}$H NMR) spectroscopy in a non-exchanging solvent shows a total integrated intensity corresponding to $7$ protons, with an aromatic pattern consistent with a para-disubstituted ring and additional downfield/broad signals attributable to heteroatom-bound protons. When deuterium oxide ($\\mathrm{D_2O}$) is added under conditions ensuring complete exchange of all labile hydrogens, the labile sites are fully deuterated.\n\nUsing first principles of Nuclear Magnetic Resonance (NMR) signal integration and isotopic substitution, determine the expected decrease in the total observed $\\mathrm{^{1}H}$ count, denoted $\\Delta n_{^{1}\\mathrm{H}}$, upon complete deuteration of $m$ exchangeable sites. Then, using only the given spectroscopic inferences and the molecular formula, verify that the computed $\\Delta n_{^{1}\\mathrm{H}}$ is consistent with the non-exchangeable aromatic proton count of a para-disubstituted benzene ring. Express your final answer as a pure number without units.", "solution": "The relevant foundational facts are:\n- In Proton Nuclear Magnetic Resonance (NMR), the integrated area of each resonance is proportional to the number of $\\mathrm{^{1}H}$ nuclei contributing to that signal. If the sum of integrals corresponds to $n_{^{1}\\mathrm{H},\\text{total}}$ protons, then replacing some of those $\\mathrm{^{1}H}$ by $\\mathrm{^{2}H}$ (deuterium) removes those nuclei from detection in a standard $\\mathrm{^{1}H}$ experiment.\n- Deuterium, $\\mathrm{^{2}H}$, is a spin-$1$ nucleus and does not produce a signal in a standard proton-detection experiment under typical acquisition parameters. Therefore, complete exchange of $m$ labile protons with $\\mathrm{D}$ reduces the observed $\\mathrm{^{1}H}$ count by exactly $m$.\n- Labile hydrogens typically include those bound to heteroatoms such as oxygen ($\\mathrm{OH}$) and nitrogen ($\\mathrm{NH}$ and $\\mathrm{NH_2}$), which undergo rapid chemical exchange with $\\mathrm{D_2O}$ under suitable conditions.\n\nWe are asked to compute $\\Delta n_{^{1}\\mathrm{H}}$, the decrease in the total $\\mathrm{^{1}H}$ count upon complete deuteration of $m$ exchangeable sites. From the proportionality of integrals to the number of observed $\\mathrm{^{1}H}$ nuclei and the removal of exchanged sites from the proton channel, the decrease is\n$$\n\\Delta n_{^{1}\\mathrm{H}} = m.\n$$\n\nNext, we must determine $m$ from the molecular formula $\\mathrm{C_7H_7NO_2}$ and the spectroscopic inferences, and then verify consistency with the non-exchangeable aromatic proton count.\n\nWe compute the double bond equivalent (DBE) to constrain the functional group topology. For a formula $\\mathrm{C}_c\\mathrm{H}_h\\mathrm{N}_n\\mathrm{O}_o\\mathrm{X}_x$ with no halogens ($x=0$), the DBE is\n$$\n\\mathrm{DBE} = \\frac{2c + 2 + n - h - x}{2}.\n$$\nInserting $c=7$, $h=7$, $n=1$, and $x=0$ gives\n$$\n\\mathrm{DBE} = \\frac{2\\cdot 7 + 2 + 1 - 7 - 0}{2} = \\frac{14 + 2 + 1 - 7}{2} = \\frac{10}{2} = 5.\n$$\nA para-disubstituted benzene ring accounts for $4$ units of unsaturation (one ring and three $\\pi$ bonds), and a single carbonyl group accounts for $1$ more, giving a total $\\mathrm{DBE} = 5$. This is consistent with one aromatic ring and one carbonyl.\n\nThe presence of one nitrogen and two oxygens, together with one carbonyl, suggests an amide functionality $\\mathrm{CONH_2}$ (contributing the carbonyl and the nitrogen) and one additional oxygen as a hydroxyl substituent on the ring (a phenol). Spectroscopic observations support this: IR indicates a carbonyl and a hydrogen-bonded hydroxyl, and $^{13}$C NMR shows one carbonyl carbon and six aromatic carbons, consistent with a para-disubstituted ring. Therefore, the heteroatom-bound hydrogens are:\n- $\\mathrm{NH_2}$ hydrogens: $2$ exchangeable $\\mathrm{^{1}H}$,\n- $\\mathrm{OH}$ hydrogen: $1$ exchangeable $\\mathrm{^{1}H}$.\n\nThus, the number of exchangeable sites is\n$$\nm = 2 + 1 = 3,\n$$\nand therefore the expected decrease in total $\\mathrm{^{1}H}$ count upon complete deuteration is\n$$\n\\Delta n_{^{1}\\mathrm{H}} = m = 3.\n$$\n\nWe now verify consistency with the molecular formula. The total number of hydrogens is $7$, and the aromatic ring is para-disubstituted, which implies $4$ non-exchangeable aromatic $\\mathrm{^{1}H}$ on the ring. The remaining $3$ hydrogens must be heteroatom-bound and thus exchangeable, consistent with $\\mathrm{NH_2}$ ($2$) plus $\\mathrm{OH}$ ($1$). After complete deuteration, the observed total $\\mathrm{^{1}H}$ count becomes\n$$\nn_{^{1}\\mathrm{H},\\text{after}} = n_{^{1}\\mathrm{H},\\text{before}} - \\Delta n_{^{1}\\mathrm{H}} = 7 - 3 = 4,\n$$\nwhich matches the expected $4$ aromatic protons of a para-disubstituted benzene ring. Therefore, the decrease $\\Delta n_{^{1}\\mathrm{H}} = 3$ is consistent with the molecular formula and the spectroscopic inferences.", "answer": "$$\\boxed{3}$$", "id": "3695986"}, {"introduction": "Beyond simply identifying labile protons, Nuclear Magnetic Resonance (NMR) spectroscopy allows us to study their dynamics. The rate of chemical exchange is highly sensitive to temperature, and this manifests as dramatic changes in the NMR lineshape, from sharp, distinct signals at low temperatures to broad, coalesced peaks at higher temperatures. This exercise [@problem_id:3696102] guides you through the classic analysis of coalescence, connecting the observed spectral features to the underlying kinetic rate constant, $k_c$, a cornerstone of dynamic NMR studies.", "problem": "A diol exhibits two hydroxyl proton resonances in a room-temperature one-dimensional Nuclear Magnetic Resonance (NMR) spectrum acquired at a proton Larmor frequency of $600.0$ MHz. At low temperature where exchange is negligible, the hydroxyl signals are observed at chemical shifts $\\delta_1 = 1.90$ ppm and $\\delta_2 = 2.75$ ppm. Upon heating, the two hydroxyl resonances broaden and coalesce into a single line at a well-defined coalescence temperature. A deuterium oxide (D$_2$O) shake experiment at low temperature removes both hydroxyl signals, confirming that they are labile and exchangeable. Assume the following for the exchange process: (i) two-site exchange between sites $A$ and $B$ with equal populations and symmetric first-order exchange ($k_{AB} = k_{BA} = k$), (ii) identical intrinsic transverse relaxation rates $R_2$ for the two sites with $R_2 \\ll k$ near coalescence, and (iii) negligible scalar couplings and baseline distortions.\n\nStarting from the two-site Bloch–McConnell description of chemical exchange and the definition of chemical shift, derive the coalescence condition for equal populations in terms of the angular frequency separation $\\Delta \\omega$ between the two sites, and then use the given data to estimate the exchange rate at coalescence $k_c$. Your steps should include converting the chemical shift difference to a frequency difference in hertz using the spectrometer frequency, converting to angular frequency $\\Delta \\omega$ in $\\mathrm{rad\\,s^{-1}}$, and then applying the coalescence condition you derive from the two-site exchange formalism.\n\nRound your final numeric answer to three significant figures. Express the rate constant in $\\mathrm{s}^{-1}$.", "solution": "The analysis begins with the Bloch–McConnell equations, which describe the evolution of the complex transverse magnetization for a two-site exchange system. For sites $A$ and $B$ with equal populations ($p_A = p_B = 1/2$), symmetric first-order exchange kinetics ($k_{AB} = k_{BA} = k$), and identical transverse relaxation rates ($R_{2,A} = R_{2,B} = R_2$), the lineshape function $I(\\omega)$ derived from these equations, in the limit of slow transverse relaxation ($R_2 \\ll k$), is given by:\n\n$$\nI(\\omega) \\propto \\frac{k (\\Delta \\omega)^2}{\\left( \\frac{(\\Delta \\omega)^2}{4} - (\\omega - \\omega_0)^2 \\right)^2 + 4k^2(\\omega - \\omega_0)^2}\n$$\n\nHere, $\\omega_A$ and $\\omega_B$ are the Larmor frequencies of the two sites in angular units ($\\mathrm{rad\\,s^{-1}}$), $\\Delta \\omega = \\omega_A - \\omega_B$ is the separation between them, $\\omega_0 = (\\omega_A + \\omega_B)/2$ is the mean frequency, and $\\omega$ is the variable frequency.\n\nThe shape of the NMR spectrum is determined by the maxima of this function $I(\\omega)$. To find these maxima, we can analyze the denominator for minima. Let $x = \\omega - \\omega_0$. We seek the maxima of the function with respect to $x$. The maxima of $I(x)$ correspond to the minima of the denominator, $D(x)$:\n\n$$\nD(x) = \\left( \\frac{(\\Delta \\omega)^2}{4} - x^2 \\right)^2 + 4k^2x^2\n$$\n\nWe find the extrema by setting the first derivative with respect to $x$ to zero:\n\n$$\n\\frac{dD(x)}{dx} = 2\\left( \\frac{(\\Delta \\omega)^2}{4} - x^2 \\right)(-2x) + 8k^2x = -4x \\left( \\frac{(\\Delta \\omega)^2}{4} - x^2 - 2k^2 \\right) = 0\n$$\n\nThis equation has solutions at $x=0$ (the center of the spectrum) and where the term in the parenthesis is zero:\n\n$$\nx^2 = \\frac{(\\Delta \\omega)^2}{4} - 2k^2\n$$\n\nFor two distinct peaks to be observed in the spectrum (i.e., for $x$ to have real, non-zero solutions), the right-hand side of the equation must be positive:\n\n$$\n\\frac{(\\Delta \\omega)^2}{4} - 2k^2 > 0 \\implies (\\Delta \\omega)^2 > 8k^2 \\implies |\\Delta \\omega| > 2\\sqrt{2}k\n$$\n\nThis is the slow exchange regime. Coalescence is the critical point where the two distinct peaks merge into a single broad peak. This occurs at the boundary of the condition above, where the two maxima at $x \\neq 0$ merge with the extremum at $x=0$. This happens when:\n\n$$\n\\frac{(\\Delta \\omega)^2}{4} - 2k^2 = 0\n$$\n\nSolving for the rate constant at coalescence, denoted $k_c$:\n\n$$\n(\\Delta \\omega)^2 = 8k_c^2 \\implies k_c = \\frac{|\\Delta \\omega|}{2\\sqrt{2}}\n$$\n\nThis is the derived coalescence condition. Now, we apply this condition to the data provided.\n\n1.  **Calculate the chemical shift difference, $\\Delta\\delta$:**\n    The chemical shifts are given as $\\delta_1 = 1.90 \\, \\text{ppm}$ and $\\delta_2 = 2.75 \\, \\text{ppm}$.\n    $$\n    \\Delta\\delta = |\\delta_2 - \\delta_1| = |2.75 - 1.90| \\, \\text{ppm} = 0.85 \\, \\text{ppm}\n    $$\n\n2.  **Convert $\\Delta\\delta$ to a frequency difference in Hertz, $\\Delta\\nu$:**\n    The spectrometer frequency is $\\nu_{\\text{spec}} = 600.0 \\, \\text{MHz} = 600.0 \\times 10^6 \\, \\text{Hz}$.\n    $$\n    \\Delta\\nu = \\Delta\\delta \\times \\nu_{\\text{spec}} = (0.85 \\times 10^{-6}) \\times (600.0 \\times 10^6 \\, \\text{Hz}) = 0.85 \\times 600.0 \\, \\text{Hz} = 510 \\, \\text{Hz}\n    $$\n\n3.  **Convert the frequency difference $\\Delta\\nu$ to an angular frequency difference, $\\Delta\\omega$:**\n    The relationship between angular frequency and frequency is $\\omega = 2\\pi\\nu$.\n    $$\n    \\Delta\\omega = 2\\pi \\Delta\\nu = 2\\pi (510 \\, \\text{s}^{-1}) = 1020\\pi \\, \\mathrm{rad\\,s^{-1}}\n    $$\n\n4.  **Calculate the exchange rate at coalescence, $k_c$:**\n    Using the derived coalescence condition:\n    $$\n    k_c = \\frac{|\\Delta \\omega|}{2\\sqrt{2}} = \\frac{1020\\pi}{2\\sqrt{2}} \\, \\text{s}^{-1} = \\frac{510\\pi}{\\sqrt{2}} \\, \\text{s}^{-1}\n    $$\n    Now, we compute the numerical value:\n    $$\n    k_c \\approx \\frac{510 \\times 3.14159265}{1.41421356} \\, \\text{s}^{-1} \\approx \\frac{1602.21225}{1.41421356} \\, \\text{s}^{-1} \\approx 1132.96 \\, \\text{s}^{-1}\n    $$\n\nThe problem requires the final answer to be rounded to three significant figures.\n\n$$\nk_c \\approx 1130 \\, \\text{s}^{-1} = 1.13 \\times 10^3 \\, \\text{s}^{-1}\n$$\nThe units of the first-order rate constant $k$ are $\\text{s}^{-1}$.", "answer": "$$\n\\boxed{1.13 \\times 10^3}\n$$", "id": "3696102"}, {"introduction": "To truly master the concept of chemical exchange, it is invaluable to visualize the entire spectral evolution from the slow to the fast exchange limit. This computational practice [@problem_id:3696062] moves beyond analyzing a single point like coalescence and asks you to simulate the complete lineshape using the fundamental Bloch-McConnell equations. By generating these spectra yourself, you will gain a profound and intuitive understanding of how the interplay between chemical shift difference, $\\Delta\\nu$, and exchange rate, $k$, governs what we observe in an NMR experiment.", "problem": "A two-site exchange of labile protons in Nuclear Magnetic Resonance (NMR) can be modeled by linear response of the transverse magnetization subject to chemical shift offsets and first-order exchange kinetics. Consider two exchanging amide (NH) sites, labeled site A and site B, with equal equilibrium populations and equal transverse relaxation times. The following fundamental base applies: (i) the transverse magnetization of each site follows the Bloch equation augmented by chemical exchange terms (Bloch–McConnell formulation), (ii) the observed spectrum is the real part of the Fourier transform of the free induction decay, which for a linear time-invariant system equals the real part of the resolvent of the generator matrix evaluated on the angular frequency axis, and (iii) a chemical shift difference of $\\Delta \\delta$ in parts per million (ppm) at a spectrometer resonance frequency $f_{0}$ in $\\mathrm{Hz}$ corresponds to a frequency difference of $\\Delta \\nu = f_{0} \\Delta \\delta \\times 10^{-6}$ in $\\mathrm{Hz}$, and an angular frequency difference of $\\Delta \\omega = 2 \\pi \\Delta \\nu$ in $\\mathrm{rad\\,s^{-1}}$.\n\nYou are given a simulated pair of exchanging NH signals on a $600\\,\\mathrm{MHz}$ spectrometer with the following physically realistic and self-consistent parameters:\n- Chemical shifts: site A at $\\delta_{A} = 8.50\\,\\mathrm{ppm}$ and site B at $\\delta_{B} = 7.50\\,\\mathrm{ppm}$.\n- The transmitter is set at the midpoint $\\delta_{\\mathrm{tx}} = 8.00\\,\\mathrm{ppm}$, so that the offsets in $\\mathrm{Hz}$ are $\\nu_{A} - \\nu_{\\mathrm{tx}} = +300\\,\\mathrm{Hz}$ and $\\nu_{B} - \\nu_{\\mathrm{tx}} = -300\\,\\mathrm{Hz}$, and the offsets in $\\mathrm{rad\\,s^{-1}}$ are $\\Delta \\omega_{A} = 2 \\pi \\times 300$ and $\\Delta \\omega_{B} = -2 \\pi \\times 300$.\n- Transverse relaxation rates: $R_{2,A} = R_{2,B} = R_{2} = 5\\,\\mathrm{s}^{-1}$ (corresponding to $T_{2} = 0.2\\,\\mathrm{s}$).\n- Exchange is symmetric with equal forward and backward rate constants: $k_{AB} = k_{BA} = k$ (so that the mean residence time in either site is $1/k$).\n- Detection is the sum of transverse magnetizations from sites A and B; the initial transverse magnetizations immediately after a nonselective, small-tip excitation are proportional to the equilibrium populations and are taken as $M_{A}(0) = 1$ and $M_{B}(0) = 1$ (arbitrary units).\n\nLet $M(t) = \\begin{bmatrix} M_{A}(t) \\\\ M_{B}(t) \\end{bmatrix}$ denote the complex transverse magnetizations. Under the linear Bloch–McConnell model, the time evolution is given by\n$$\n\\frac{d}{dt} M(t) = -\\mathbf{L}\\, M(t),\n$$\nwhere\n$$\n\\mathbf{L} = \\begin{bmatrix}\nR_{2} + k + i \\Delta \\omega_{A} & -k \\\\\n-k & R_{2} + k + i \\Delta \\omega_{B}\n\\end{bmatrix}.\n$$\nThe complex frequency-domain response to the initial condition $M(0)$ at observation angular frequency $\\omega$ (with $\\omega = 2 \\pi \\nu$ and $\\nu$ in $\\mathrm{Hz}$ relative to the transmitter) is given by the resolvent\n$$\n\\widehat{M}(\\omega) = \\left( \\mathbf{L} - i \\omega \\mathbf{I} \\right)^{-1} M(0).\n$$\nThe absorptive lineshape at frequency $\\omega$ is the real part of the detected response,\n$$\nS(\\omega) = \\Re\\left( \\mathbf{u}^{\\top} \\widehat{M}(\\omega) \\right), \\quad \\mathbf{u} = \\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix}.\n$$\n\nTask:\n- For each specified exchange rate $k$ (in $\\mathrm{s^{-1}}$), compute the absorptive lineshape $S(\\omega)$ sampled on a frequency grid of $121$ uniformly spaced points in $\\nu$ from $-600\\,\\mathrm{Hz}$ to $+600\\,\\mathrm{Hz}$ inclusive (i.e., step size $10\\,\\mathrm{Hz}$), by evaluating $S(\\omega)$ at $\\omega = 2 \\pi \\nu$ for each grid point.\n- For each $k$, normalize the sampled lineshape so that its maximum value over the grid equals $1$ (unitless).\n- Use the constants given above without alteration.\n\nTest suite:\n- Five exchange rates covering no exchange, slow, intermediate, fast, and very fast exchange regimes: $k \\in \\{ 0,\\, 10,\\, 100,\\, 1000,\\, 100000 \\}\\,\\mathrm{s^{-1}}$.\n  - The case $k = 0\\,\\mathrm{s^{-1}}$ is a boundary condition (no exchange).\n  - The case $k = 100000\\,\\mathrm{s^{-1}}$ probes the very fast exchange limit.\n  - The intermediate cases illustrate the approach to coalescence on a $600\\,\\mathrm{MHz}$ spectrometer.\n\nRequired final output format:\n- Your program must produce a single line of output containing a JSON-like list of length $5$, where each element is a list of $121$ floating-point numbers corresponding to the normalized absorptive lineshape samples for one of the five $k$ values, in the order listed in the test suite.\n- Frequencies are not printed; only the normalized amplitudes. All amplitudes are unitless after normalization.\n- Example format (illustrative only): $[[a_{1,1}, a_{1,2}, \\dots, a_{1,121}], [a_{2,1}, \\dots], \\dots, [a_{5,1}, \\dots, a_{5,121}]]$.\n\nAll angles, where applicable, are in radians. All frequencies must be treated in $\\mathrm{Hz}$ and converted to angular frequencies in $\\mathrm{rad\\,s^{-1}}$ via $\\omega = 2 \\pi \\nu$. Ensure numerical stability and do not assume any degeneracy beyond what is stated. The answer for each test case is the list of $121$ normalized floating-point samples, and the aggregate output is the list of these $5$ lists printed on a single line exactly as specified.", "solution": "The task is to compute the NMR absorptive lineshape $S(\\omega)$ for a two-site exchange system for a given set of exchange rates $k$. The time evolution of the complex transverse magnetizations for sites A and B, denoted by the vector $M(t) = \\begin{bmatrix} M_{A}(t) \\\\ M_{B}(t) \\end{bmatrix}$, is governed by the linear differential equation:\n$$\n\\frac{d}{dt} M(t) = -\\mathbf{L}\\, M(t)\n$$\nThe Liouvillian super-operator matrix $\\mathbf{L}$ is given by:\n$$\n\\mathbf{L} = \\begin{bmatrix}\nR_{2} + k + i \\Delta \\omega_{A} & -k \\\\\n-k & R_{2} + k + i \\Delta \\omega_{B}\n\\end{bmatrix}\n$$\nwhere the parameters are defined as:\n- Transverse relaxation rate: $R_{2} = 5\\,\\mathrm{s}^{-1}$\n- Exchange rate constant: $k \\in \\{ 0, 10, 100, 1000, 100000 \\}\\,\\mathrm{s}^{-1}$\n- Angular frequency offsets: $\\Delta \\omega_{A} = 2 \\pi \\times 300\\,\\mathrm{rad\\,s^{-1}}$ and $\\Delta \\omega_{B} = -2 \\pi \\times 300\\,\\mathrm{rad\\,s^{-1}}$.\n\nThe frequency-domain spectrum is obtained by Fourier transforming the time-domain signal. For a linear time-invariant system, this is equivalent to calculating the resolvent of the matrix $\\mathbf{L}$. The complex spectrum at an observation angular frequency $\\omega$ is given by:\n$$\n\\widehat{M}(\\omega) = \\left( \\mathbf{L} - i \\omega \\mathbf{I} \\right)^{-1} M(0)\n$$\nHere, $\\mathbf{I}$ is the $2 \\times 2$ identity matrix and $M(0)$ is the vector of initial magnetizations, given as $M(0) = \\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix}$. The matrix to be inverted is:\n$$\n\\mathbf{A}(\\omega) = \\mathbf{L} - i \\omega \\mathbf{I} = \\begin{bmatrix}\nR_{2} + k + i (\\Delta \\omega_{A} - \\omega) & -k \\\\\n-k & R_{2} + k + i (\\Delta \\omega_{B} - \\omega)\n\\end{bmatrix}\n$$\nThe observable signal is the sum of the magnetizations from both sites, so the detection vector is $\\mathbf{u} = \\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix}$. The absorptive lineshape $S(\\omega)$ is the real part of the total detected signal:\n$$\nS(\\omega) = \\Re\\left( \\mathbf{u}^{\\top} \\widehat{M}(\\omega) \\right) = \\Re\\left( \\mathbf{u}^{\\top} \\left( \\mathbf{L} - i \\omega \\mathbf{I} \\right)^{-1} M(0) \\right)\n$$\nTo compute this, we can derive an analytical expression for the total complex signal, $\\mathbf{u}^{\\top} \\widehat{M}(\\omega)$. For a general $2 \\times 2$ matrix $\\mathbf{A} = \\begin{bmatrix} a & b \\\\ c & d \\end{bmatrix}$, the inverse is $\\mathbf{A}^{-1} = \\frac{1}{ad-bc} \\begin{bmatrix} d & -b \\\\ -c & a \\end{bmatrix}$.\nIn our case, the components of $\\mathbf{A}(\\omega)$ are:\n- $a(\\omega) = R_{2} + k + i (\\Delta \\omega_{A} - \\omega)$\n- $b = -k$\n- $c = -k$\n- $d(\\omega) = R_{2} + k + i (\\Delta \\omega_{B} - \\omega)$\n\nThe determinant is $\\det(\\mathbf{A}(\\omega)) = a(\\omega)d(\\omega) - k^2$.\nThe total signal is:\n$$\n\\mathbf{u}^{\\top} \\mathbf{A}(\\omega)^{-1} M(0) = \\begin{bmatrix} 1 & 1 \\end{bmatrix} \\frac{1}{\\det(\\mathbf{A}(\\omega))} \\begin{bmatrix} d(\\omega) & k \\\\ k & a(\\omega) \\end{bmatrix} \\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix}\n$$\n$$\n= \\frac{1}{\\det(\\mathbf{A}(\\omega))} \\begin{bmatrix} 1 & 1 \\end{bmatrix} \\begin{bmatrix} d(\\omega) + k \\\\ k + a(\\omega) \\end{bmatrix} = \\frac{a(\\omega) + d(\\omega) + 2k}{\\det(\\mathbf{A}(\\omega))}\n$$\nSubstituting the expressions for $a(\\omega)$ and $d(\\omega)$:\n- Numerator: $a(\\omega) + d(\\omega) + 2k = (R_{2} + k + i (\\Delta \\omega_{A} - \\omega)) + (R_{2} + k + i (\\Delta \\omega_{B} - \\omega)) + 2k = 2R_{2} + 4k + i(\\Delta \\omega_{A} + \\Delta \\omega_{B} - 2\\omega)$. Since $\\Delta \\omega_{A} = -\\Delta \\omega_{B}$, this simplifies to $2R_2 + 4k - 2i\\omega$.\n- Denominator: $\\det(\\mathbf{A}(\\omega)) = a(\\omega)d(\\omega) - k^2 = (R_{2} + k + i (\\Delta \\omega_{A} - \\omega))(R_{2} + k + i (\\Delta \\omega_{B} - \\omega)) - k^2$.\n\nThe computational procedure is as follows:\n1. Define the physical constants: $R_{2} = 5\\,\\mathrm{s}^{-1}$, $\\Delta \\omega_{A} = 2 \\pi \\times 300\\,\\mathrm{rad\\,s^{-1}}$, $\\Delta \\omega_{B} = -2\\pi \\times 300\\,\\mathrm{rad\\,s^{-1}}$.\n2. Define the list of exchange rates to be tested: $k \\in \\{ 0, 10, 100, 1000, 100000 \\}\\,\\mathrm{s^{-1}}$.\n3. Generate a grid of $121$ observation frequencies $\\nu$ from $-600\\,\\mathrm{Hz}$ to $+600\\,\\mathrm{Hz}$.\n4. Convert this frequency grid to angular frequencies: $\\omega = 2 \\pi \\nu$.\n5. For each value of $k$:\n    a. For each value of $\\omega$ in the grid, calculate the complex matrix components $a(\\omega)$ and $d(\\omega)$.\n    b. Calculate the complex numerator and denominator of the total signal expression derived above.\n    c. Compute the complex total signal as their ratio.\n    d. Take the real part to obtain the absorptive lineshape value $S(\\omega)$.\n    e. This process is vectorized for efficiency, calculating the entire spectrum for a given $k$ in a single step.\n6. After obtaining the list of $121$ values for $S(\\omega)$ for a given $k$, find the maximum value in this list.\n7. Normalize the list by dividing every element by this maximum value.\n8. Collect the $5$ resulting normalized lists of $121$ floating-point numbers. The final output is a list containing these $5$ lists.", "answer": "```python\nimport numpy as np\nimport json\n\ndef solve():\n    \"\"\"\n    Calculates normalized NMR lineshapes for a two-site exchange system.\n    \"\"\"\n    # Define physical parameters and constants from the problem statement.\n    R2 = 5.0  # s^-1\n    nu_A_offset = 300.0  # Hz\n    nu_B_offset = -300.0  # Hz\n    d_omega_A = 2 * np.pi * nu_A_offset  # rad/s\n    d_omega_B = 2 * np.pi * nu_B_offset  # rad/s\n\n    # Define the frequency grid.\n    num_points = 121\n    nu_grid = np.linspace(-600.0, 600.0, num_points)  # Hz\n    omega_grid = 2 * np.pi * nu_grid  # rad/s\n\n    # Define the test suite for the exchange rate k.\n    k_values = [0.0, 10.0, 100.0, 1000.0, 100000.0]  # s^-1\n\n    all_normalized_spectra = []\n\n    for k in k_values:\n        # Vectorized calculation of the complex lineshape using the derived analytical formula.\n        # This is more efficient than inverting a matrix for each frequency point.\n        #\n        # Total complex signal = (a + d + 2k) / (a*d - k^2)\n        # where a = R2 + k + i*(d_omega_A - omega)\n        # and   d = R2 + k + i*(d_omega_B - omega)\n\n        # Components 'a' and 'd' of the A(omega) matrix as vectors over omega_grid.\n        # Note: In NumPy, 'j' is used for the imaginary unit.\n        a_vec = (R2 + k) + 1j * (d_omega_A - omega_grid)\n        d_vec = (R2 + k) + 1j * (d_omega_B - omega_grid)\n\n        # Numerator and denominator of the total signal expression.\n        numerator = a_vec + d_vec + 2 * k\n        denominator = a_vec * d_vec - k**2\n\n        # The complex spectrum (vector of complex values).\n        complex_spectrum = numerator / denominator\n        \n        # The absorptive lineshape is the real part.\n        absorptive_spectrum = np.real(complex_spectrum)\n\n        # Normalize the spectrum so its maximum value is 1.\n        max_intensity = np.max(absorptive_spectrum)\n        if max_intensity > 0:\n            normalized_spectrum = absorptive_spectrum / max_intensity\n        else:\n            # Handle the case of a zero spectrum to avoid division by zero.\n            normalized_spectrum = absorptive_spectrum\n\n        all_normalized_spectra.append(normalized_spectrum.tolist())\n\n    # Format the final output as a JSON-like string on a single line.\n    print(json.dumps(all_normalized_spectra, separators=(',', ':')))\n\nsolve()\n```", "id": "3696062"}]}