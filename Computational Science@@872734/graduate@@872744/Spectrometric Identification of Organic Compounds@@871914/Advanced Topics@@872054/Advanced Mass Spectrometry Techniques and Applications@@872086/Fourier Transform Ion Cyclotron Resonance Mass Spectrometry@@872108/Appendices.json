{"hands_on_practices": [{"introduction": "The power of FT-ICR mass spectrometry stems from its ability to measure mass with extraordinary precision. However, the instrument does not measure mass directly; instead, it measures the cyclotron frequency of an ion orbiting in a magnetic field. This exercise solidifies the fundamental inverse relationship between an ion's mass-to-charge ratio ($m/z$) and its cyclotron frequency ($\\omega_c$), which is the cornerstone of all mass assignments in FT-ICR [@problem_id:1463743].", "problem": "In a Fourier Transform Ion Cyclotron Resonance (FT-ICR) mass spectrometer, ions are trapped within a Penning trap by a strong, uniform axial magnetic field, $B$. The trapped ions undergo cyclotron motion in a plane perpendicular to the magnetic field. The angular frequency of this motion, known as the cyclotron frequency ($\\omega_c$), is measured to determine the ion's mass-to-charge ratio.\n\nConsider an experiment where a large, neutral molecule, $M$, with a precise monoisotopic mass of $m_M = 1200.500000$ u, is ionized and trapped. It is initially observed as a singly-charged sodium adduct, $[M+\\text{Na}]^+$. This precursor ion is then isolated in the ICR cell. Subsequently, a neutral potassium-containing reagent is introduced into the cell, inducing a gas-phase cation exchange reaction that completely converts the precursor ion into a singly-charged potassium adduct, $[M+\\text{K}]^+$.\n\nGiven the following exact monoisotopic masses for the neutral atoms:\n- Mass of a sodium atom, $m_{\\text{Na}} = 22.989770$ u\n- Mass of a potassium atom, $m_{\\text{K}} = 38.963707$ u\n\nFor the purpose of this calculation, assume the mass of an ion is the simple sum of the masses of its constituent neutral atoms/molecules. Calculate the numerical ratio of the cyclotron frequency of the product ion to that of the precursor ion, $\\omega_{[M+\\text{K}]^+} / \\omega_{[M+\\text{Na}]^+}$. Round your final answer to six significant figures.", "solution": "The cyclotron angular frequency for an ion of charge $q$ and mass $m$ in a uniform magnetic field $B$ is\n$$\n\\omega_{c}=\\frac{qB}{m}.\n$$\nFor two singly charged ions in the same magnetic field, the ratio of their cyclotron frequencies is inversely proportional to the ratio of their masses:\n$$\n\\frac{\\omega_{[M+\\text{K}]^{+}}}{\\omega_{[M+\\text{Na}]^{+}}}\n=\\frac{qB/m_{[M+\\text{K}]^{+}}}{qB/m_{[M+\\text{Na}]^{+}}}\n=\\frac{m_{[M+\\text{Na}]^{+}}}{m_{[M+\\text{K}]^{+}}}.\n$$\nWith the stated assumption that the ion mass is the sum of constituent neutral masses, we first calculate the masses of the two adducts:\n$$\nm_{[M+\\text{Na}]^{+}}=m_{M}+m_{\\text{Na}}=1200.500000\\ \\text{u} + 22.989770\\ \\text{u} = 1223.489770\\ \\text{u}\n$$\n$$\nm_{[M+\\text{K}]^{+}}=m_{M}+m_{\\text{K}}=1200.500000\\ \\text{u} + 38.963707\\ \\text{u} = 1239.463707\\ \\text{u}\n$$\nNow, we compute the ratio of the frequencies:\n$$\n\\frac{\\omega_{[M+\\text{K}]^{+}}}{\\omega_{[M+\\text{Na}]^{+}}}\n=\\frac{1223.489770}{1239.463707} \\approx 0.9871122188\n$$\nRounding the result to six significant figures gives $0.987112$.", "answer": "$$\\boxed{0.987112}$$", "id": "1463743"}, {"introduction": "Knowing the relationship between frequency and mass is the first step; the next is understanding how effectively we can distinguish between two ions with very similar masses. This capability is quantified by the resolving power, $R$. This practice challenges you to apply the definition of resolving power to a common real-world scenario: determining if an instrument can differentiate between two candidate molecular formulas for an unknown compound based on a tiny mass difference [@problem_id:3715422]. By performing this calculation, you will gain a tangible appreciation for why the ultra-high resolution of FT-ICR is critical for modern chemical analysis.", "problem": "An unknown compound measured by high-resolution mass spectrometry produces a singly charged monoisotopic peak at $m/z = 300$. Two plausible elemental formula assignments have computed exact monoisotopic masses that differ by $3\\ \\text{mDa}$ near $m/z = 300$. Using the operational definition of resolving power at Full Width at Half Maximum (FWHM), determine the minimum resolving power necessary to baseline-resolve these two candidate formulas at $m/z = 300$. Then, based on this requirement, assess whether the following instruments are feasible for baseline resolution under the same acquisition conditions: a Quadrupole Time-of-Flight (Q-TOF) with resolving power $R = 40{,}000$ at $m/z = 300$, an Orbitrap high-field analyzer with resolving power $R = 240{,}000$ at $m/z = 300$, and a Fourier Transform Ion Cyclotron Resonance (FT-ICR) mass spectrometer with resolving power $R = 450{,}000$ at $m/z = 300$. Round the computed minimum resolving power to four significant figures and express your answer as a dimensionless resolving power.", "solution": "### Solution\n\nThe resolving power, $R$, of a mass spectrometer is a measure of its ability to distinguish between two peaks of slightly different mass-to-charge ratios. The operational definition based on the Full Width at Half Maximum (FWHM) of a single peak is given by:\n$$\nR = \\frac{m}{\\Delta m_{FWHM}}\n$$\nwhere $m$ is the mass-to-charge ratio of the ion, and $\\Delta m_{FWHM}$ is the width of the peak at $50\\%$ of its maximum height.\n\nTo \"baseline-resolve\" two peaks, the minimum condition is that the separation between their centers, $\\Delta m$, is equal to the FWHM of one of the peaks. Therefore, to find the minimum required resolving power, $R_{min}$, we set the peak width to the mass difference between the two species:\n$$\n\\Delta m_{FWHM} = \\Delta m\n$$\nSubstituting this into the defining equation for resolving power gives:\n$$\nR_{min} = \\frac{m}{\\Delta m}\n$$\nThe problem states the analysis is for an ion at $m/z = 300$, so the mass $m$ is $300\\ \\text{Da}$. The mass difference is given as $\\Delta m = 3\\ \\text{mDa}$, which is $0.003\\ \\text{Da}$.\n\nWe can now calculate the minimum required resolving power:\n$$\nR_{min} = \\frac{300\\ \\text{Da}}{0.003\\ \\text{Da}} = 100,000\n$$\nTo express this with four significant figures, we write it as $1.000 \\times 10^5$.\n\nNext, we assess the feasibility of the three instruments. An instrument is feasible if its specified resolving power, $R_{\\text{instrument}}$, is greater than or equal to $R_{min} = 100,000$.\n\n1.  **Q-TOF Mass Spectrometer**:\n    $R_{Q-TOF} = 40,000$. Since $40,000  100,000$, this instrument is **not feasible**.\n\n2.  **Orbitrap High-Field Analyzer**:\n    $R_{Orbitrap} = 240,000$. Since $240,000 > 100,000$, this instrument is **feasible**.\n\n3.  **FT-ICR Mass Spectrometer**:\n    $R_{FT-ICR} = 450,000$. Since $450,000 > 100,000$, this instrument is **feasible**.\n\nTherefore, the minimum resolving power required is $1.000 \\times 10^5$, and both the Orbitrap and FT-ICR instruments meet this requirement.", "answer": "$$\n\\boxed{1.000 \\times 10^{5}}\n$$", "id": "3715422"}, {"introduction": "The final mass spectrum in FT-ICR is not observed directly but is generated by applying a Fourier transform to the time-domain signal produced by the orbiting ions. A common and often misunderstood step in this process is zero-filling, where the acquired signal is padded with zeros before the transform. Through this computational exercise, you will explore how zero-filling can improve the visual quality and interpolation of a peak without actually increasing the true, physically-limited resolving power of the measurement [@problem_id:3702851]. This distinction is crucial for the correct interpretation of high-resolution mass spectra.", "problem": "Design and implement a complete, runnable program that demonstrates, using a simulated Fourier Transform Ion Cyclotron Resonance (FT-ICR) mass spectrometry transient, the effect of zero-filling on peak interpolation and the invariance of true resolving power. The goal is to show that zero-filling increases the sampling density of the discrete spectrum, thereby interpolating peak tops, but does not increase true resolving power, which is set by the finite acquisition time. Begin from foundational principles about discrete sampling and the Discrete Fourier Transform (DFT), and proceed without assuming or using any shortcut formulas beyond those fundamental bases.\n\nUse the following fundamental base:\n- A time-domain FT-ICR transient can be modeled (in one dimension) as a sum of exponentially damped cosines:\n$$ s(t) = \\sum_{i=1}^{M} A_i e^{-t/\\tau} \\cos\\left(2\\pi f_i t + \\phi_i\\right), $$\nwhere $A_i$ is amplitude, $\\tau$ is a decay constant (assumed common to all components for simplicity), $f_i$ is cyclotron frequency, and $\\phi_i$ is phase.\n- The Discrete Fourier Transform (DFT) of $N$ uniformly sampled points with sampling frequency $F_s$ yields a frequency bin spacing\n$$ \\Delta f = \\frac{F_s}{N} = \\frac{1}{T}, $$\nwhere $T$ is the total acquisition time in seconds of the non-zero transient ($T = N/F_s$).\n- Zero-filling is defined here as appending zeros to the end of the transient before the DFT so that the transform length becomes $M = z N$, where $z$ is an integer zero-fill factor ($z \\ge 1$). The DFT bin spacing becomes $\\Delta f_{\\text{bin}} = F_s/M$, but the spectral envelope due to the finite-duration window is unchanged.\n\nYour program must:\n1. Simulate the transient $s(t)$ on the interval $t \\in [0, T)$ with uniform sampling at $F_s$, for the specified test cases below. Implement a function to compute the one-sided magnitude spectrum using the Fast Fourier Transform (FFT) algorithm on a zero-filled vector of length $M = z N$ (where $z$ is the zero-fill factor). Normalize the one-sided magnitude spectrum so that a cosine at an exact DFT bin frequency and amplitude $A$ has a spectral peak magnitude equal to $A$ (i.e., use a scale factor of $2/M$ on the magnitude of the complex FFT for a real-valued transient).\n2. For each spectrum, identify the maximum magnitude and the frequency at which this maximum occurs by scanning the one-sided spectrum. Report both quantities for each zero-fill factor in the single-component test case.\n3. Demonstrate that true resolving power is unchanged by zero-filling by evaluating a resolvability criterion derived from the finite-duration acquisition: two tones at frequencies $f_1$ and $f_2$ are considered truly resolvable if and only if $|f_2 - f_1| > 1/T$. Compute and report a boolean for each zero-fill factor for two doublet test cases, one below the resolution limit and one above it.\n\nPhysical units and conventions:\n- Frequencies must be treated and reported in hertz (Hz).\n- Time must be treated and specified in seconds (s).\n- Angles (phases) may be set to zero; no angle-dependent quantities are asked in the output.\n- Amplitudes are arbitrary units and dimensionless.\n- All reported float results must be rounded to six decimal places.\n- Booleans must be printed as True or False.\n\nTest suite specification:\n- Sampling frequency: $F_s = 65536$ Hz.\n- Acquisition time: $T = 0.25$ s.\n- Number of non-zero samples: $N = F_s T = 16384$ samples.\n- Common decay constant: $\\tau = 10.0$ s.\n- Phase: $\\phi_i = 0$ for all $i$.\n- Zero-fill factors to evaluate: $z \\in \\{1, 2, 4\\}$.\n\nCase A (single component, peak interpolation via zero-filling):\n- One component with $A_1 = 1.0$, $f_1 = 10000.5$ Hz.\n- For each $z \\in \\{1, 2, 4\\}$, compute and report:\n  - The maximum one-sided magnitude $m_{\\max}(z)$ (dimensionless, rounded to six decimals).\n  - The frequency $f_{\\max}(z)$ at which the maximum occurs (Hz, rounded to six decimals).\n\nCase B (doublet, below resolution limit):\n- Two components with $A_1 = A_2 = 1.0$, frequencies $f_1 = 10000.5$ Hz and $f_2 = f_1 + 0.5 \\Delta f$, where $\\Delta f = 1/T$.\n- For each $z \\in \\{1, 2, 4\\}$, compute and report a boolean value indicating $|f_2 - f_1| > 1/T$. This evaluates true resolving power and must be independent of $z$.\n\nCase C (doublet, above resolution limit):\n- Two components with $A_1 = A_2 = 1.0$, frequencies $f_1 = 10000.5$ Hz and $f_2 = f_1 + 1.1 \\Delta f$, where $\\Delta f = 1/T$.\n- For each $z \\in \\{1, 2, 4\\}$, compute and report the same boolean $|f_2 - f_1| > 1/T$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of four lists, in the order:\n  - The list of $m_{\\max}(z)$ for $z \\in \\{1, 2, 4\\}$.\n  - The list of $f_{\\max}(z)$ for $z \\in \\{1, 2, 4\\}$.\n  - The list of booleans for Case B for $z \\in \\{1, 2, 4\\}$.\n  - The list of booleans for Case C for $z \\in \\{1, 2, 4\\}$.\nFor example, the printed line must look like:\n$$ [ [m_{\\max}(1), m_{\\max}(2), m_{\\max}(4)], [f_{\\max}(1), f_{\\max}(2), f_{\\max}(4)], [\\text{B}_1, \\text{B}_2, \\text{B}_4], [\\text{C}_1, \\text{C}_2, \\text{C}_4] ] $$\nwith all floats rounded to six decimals and all booleans rendered as True or False.", "solution": "This problem requires implementing a program to demonstrate two fundamental properties of the Discrete Fourier Transform (DFT) using a simulated FT-ICR transient: that zero-filling acts as an interpolation method to improve peak parameter estimation, and that it does not improve the true resolving power, which is fundamentally limited by the signal's acquisition time.\n\n### Signal Model and Digital Processing\n\nThe time-domain transient is modeled as an exponentially damped cosine wave. For a signal acquired over a duration $T$ with a sampling frequency $F_s$, we obtain $N = F_s T$ discrete data points. The DFT of this discrete signal is calculated using a Fast Fourier Transform (FFT) algorithm.\n\n**Zero-filling** is the process of appending zeros to the end of the acquired signal before performing the FFT. If we start with $N$ data points and increase the total transform length to $M_{len} = zN$ (where $z$ is the zero-fill factor), the spacing between frequency bins in the resulting spectrum decreases from $\\Delta f = F_s/N$ to $\\Delta f_{\\text{bin}} = F_s/M_{len}$. This provides a more densely sampled view of the underlying continuous spectral shape determined by the original signal.\n\n### Case A: Peak Interpolation\n\nThis case simulates a single component with frequency $f_1 = 10000.5$ Hz, which lies exactly between the natural frequency bins of the DFT without zero-filling ($\\Delta f = 1/T = 1/0.25 = 4$ Hz). Without zero-filling ($z=1$), the peak energy is split between the adjacent bins (at 10000 Hz and 10004 Hz), leading to an underestimated peak magnitude (scalloping loss) and an inaccurate peak frequency. As the zero-fill factor $z$ increases to 2 and 4, the frequency bins become denser. This finer sampling allows a bin to fall closer to the true peak of the spectral envelope, resulting in a more accurate measurement of both the peak's magnitude and its frequency, demonstrating the interpolative effect of zero-filling.\n\n### Cases B and C: Invariance of True Resolving Power\n\nTrue resolving power is the ability to distinguish two closely spaced spectral features, which is fundamentally limited by the acquisition time $T$. The resolution limit is given by the Fourier uncertainty principle: two frequencies, $f_1$ and $f_2$, are considered resolvable only if their separation is greater than the inverse of the acquisition time.\n$$ |f_2 - f_1| > \\frac{1}{T} $$\nIn this problem, the resolution limit is $\\Delta f_{res} = 1/T = 4$ Hz.\n\nZero-filling does not add new information to the signal; it only interpolates the spectral shape that was already determined by the $N$ original data points. It cannot narrow the intrinsic width of the spectral peaks and therefore cannot change the true resolving power. The program demonstrates this by testing two scenarios:\n- **Case B (Below Limit):** The frequency separation is $|f_2 - f_1| = 2$ Hz. Since $2\\text{ Hz} \\ngtr 4\\text{ Hz}$, the resolvability condition is **False**, regardless of the zero-fill factor.\n- **Case C (Above Limit):** The frequency separation is $|f_2 - f_1| = 4.4$ Hz. Since $4.4\\text{ Hz} > 4\\text{ Hz}$, the resolvability condition is **True**, regardless of the zero-fill factor.\n\nThe program calculates and reports these boolean outcomes to explicitly show that true resolving power is invariant to zero-filling.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates FT-ICR transients to demonstrate the effects of zero-filling on\n    peak interpolation and the invariance of true resolving power.\n    \"\"\"\n    \n    # Test suite specification\n    Fs = 65536.0  # Sampling frequency in Hz\n    T = 0.25      # Acquisition time in seconds\n    N = int(Fs * T) # Number of non-zero samples\n    tau = 10.0      # Common decay constant in seconds\n    phi = 0.0       # Common phase in radians\n    z_factors = [1, 2, 4] # Zero-fill factors\n    \n    # Time vector for the non-zero transient\n    t = np.arange(N) / Fs\n\n    def generate_transient(frequencies, amplitudes, t_vec, tau_val, phi_val):\n        \"\"\"\n        Generates a transient signal as a sum of exponentially damped cosines.\n        \"\"\"\n        signal = np.zeros_like(t_vec)\n        for f, A in zip(frequencies, amplitudes):\n            signal += A * np.exp(-t_vec / tau_val) * np.cos(2 * np.pi * f * t_vec + phi_val)\n        return signal\n\n    def compute_spectrum(transient, z, Fs_val):\n        \"\"\"\n        Computes the one-sided magnitude spectrum of a transient using FFT\n        with zero-filling.\n        \"\"\"\n        N_transient = len(transient)\n        M_len = z * N_transient # Total length after zero-filling\n\n        # Create the zero-filled signal\n        padded_signal = np.zeros(M_len)\n        padded_signal[:N_transient] = transient\n\n        # Compute the one-sided FFT\n        # np.fft.rfft is efficient for real inputs\n        fft_complex = np.fft.rfft(padded_signal)\n        \n        # Frequency axis for the one-sided spectrum\n        freq_axis = np.fft.rfftfreq(M_len, d=1.0/Fs_val)\n\n        # Compute magnitude and apply normalization\n        # Scale factor is 2/M for a one-sided spectrum to preserve amplitude\n        magnitude = np.abs(fft_complex) * (2.0 / M_len)\n        \n        # The DC component (at index 0) is not doubled\n        magnitude[0] /= 2.0\n        \n        return freq_axis, magnitude\n\n    # --- Case A: Single component, peak interpolation ---\n    case_A_freqs = [10000.5]\n    case_A_amps = [1.0]\n    transient_A = generate_transient(case_A_freqs, case_A_amps, t, tau, phi)\n    \n    m_max_results = []\n    f_max_results = []\n\n    for z in z_factors:\n        freqs, mags = compute_spectrum(transient_A, z, Fs)\n        max_idx = np.argmax(mags)\n        m_max = mags[max_idx]\n        f_max = freqs[max_idx]\n        \n        m_max_results.append(round(m_max, 6))\n        f_max_results.append(round(f_max, 6))\n\n    # --- Case B: Doublet, below resolution limit ---\n    delta_f_res = 1.0 / T\n    f1_B = 10000.5\n    f2_B = f1_B + 0.5 * delta_f_res\n    \n    bool_B_results = []\n    for z in z_factors:\n        # The resolvability criterion is independent of z\n        is_resolvable = (abs(f2_B - f1_B) > delta_f_res)\n        bool_B_results.append(is_resolvable)\n\n    # --- Case C: Doublet, above resolution limit ---\n    f1_C = 10000.5\n    f2_C = f1_C + 1.1 * delta_f_res\n\n    bool_C_results = []\n    for z in z_factors:\n        # The resolvability criterion is independent of z\n        is_resolvable = (abs(f2_C - f1_C) > delta_f_res)\n        bool_C_results.append(is_resolvable)\n\n    # Compile all results into the final list structure\n    final_results = [\n        m_max_results,\n        f_max_results,\n        bool_B_results,\n        bool_C_results\n    ]\n\n    # Format the output string exactly as required\n    print(str(final_results).replace(\"'\", \"\").replace(\" \", \"\"))\n\nsolve()\n\n```", "id": "3702851"}]}