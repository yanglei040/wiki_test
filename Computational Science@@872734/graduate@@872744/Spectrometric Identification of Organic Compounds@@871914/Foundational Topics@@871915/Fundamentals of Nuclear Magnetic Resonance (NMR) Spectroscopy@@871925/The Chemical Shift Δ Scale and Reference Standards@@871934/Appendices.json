{"hands_on_practices": [{"introduction": "The power of the chemical shift $\\delta$ scale lies in its independence from the spectrometer's magnetic field strength, allowing for the universal comparison of spectra. This exercise challenges you to demonstrate this fundamental principle starting from the Larmor relation. By working through a hypothetical scenario involving two different high-field instruments, you will not only prove the field-independence of $\\delta$ but also learn to correct for practical measurement artifacts like magnetic susceptibility shifts from external references [@problem_id:3726735].", "problem": "In Proton Nuclear Magnetic Resonance (NMR) spectroscopy, the chemical shift on the delta scale is defined relative to a reference standard such as Tetramethylsilane (TMS). Consider an analyte whose proton resonance is measured on two high-field spectrometers that operate at $500.00\\,\\text{MHz}$ and $700.00\\,\\text{MHz}$ for $^{1}\\text{H}$. On each instrument, the reference is an external capillary containing TMS, which is subject to a bulk magnetic susceptibility displacement relative to an ideal internal TMS reference in the same magnetic environment. The susceptibility displacement is linear in the static magnetic field $B_{0}$.\n\nOn the $500.00\\,\\text{MHz}$ instrument, the analyte resonance appears at a frequency offset of $11{,}737.990\\,\\text{Hz}$ downfield from the external TMS signal, and the external TMS is known to be upfield by $9.600\\,\\text{Hz}$ relative to an ideal internal TMS at this field. On the $700.00\\,\\text{MHz}$ instrument, the analyte resonance appears at a frequency offset of $16{,}433.186\\,\\text{Hz}$ downfield from the external TMS signal, and the external TMS is upfield by $13.440\\,\\text{Hz}$ relative to an ideal internal TMS at this field.\n\nStarting from the Larmor relation $\\,\\omega=\\gamma B_{0}(1-\\sigma)\\,$, where $\\gamma$ is the gyromagnetic ratio and $\\sigma$ is the nuclear magnetic shielding, and the conventional definition of the chemical shift delta scale, derive an expression showing that the delta scale (in parts per million) is independent of $B_{0}$ when the reference displacement is proportional to $B_{0}$. Then, using the provided measurements and correcting to the conventional internal TMS reference, compute the analyteâ€™s chemical shift $\\delta$ in parts per million.\n\nRound your final numerical result to six significant figures and express it in $\\text{ppm}$. Provide a single numerical value for $\\delta$.", "solution": "The problem is evaluated as scientifically grounded, well-posed, and objective. It is based on established principles of Nuclear Magnetic Resonance (NMR) spectroscopy and provides a complete and consistent set of data for a unique solution.\n\nThe solution is divided into two parts as requested: a derivation of the field-independence of the chemical shift delta scale, and the computation of the analyte's chemical shift from the provided data.\n\n**Part 1: Derivation of Field-Independence**\n\nThe chemical shift, $\\delta$, in parts per million ($\\text{ppm}$), is conventionally defined with respect to an ideal internal reference standard, such as Tetramethylsilane (TMS). The formula is:\n$$ \\delta = \\frac{\\nu_{sample} - \\nu_{ref,i}}{\\nu_{0}} \\times 10^6 $$\nwhere $\\nu_{sample}$ is the resonance frequency of the analyte nucleus, $\\nu_{ref,i}$ is the resonance frequency of the ideal internal reference nucleus, and $\\nu_{0}$ is the operating frequency of the spectrometer.\n\nThe resonance frequency $\\nu$ of a nucleus is given by the Larmor relation, $\\omega = 2\\pi\\nu = \\gamma B_{eff}$, where $\\gamma$ is the gyromagnetic ratio and $B_{eff}$ is the effective magnetic field experienced by the nucleus. This effective field is the applied static magnetic field $B_0$ minus the shielding effect from the local electronic environment: $B_{eff} = B_0(1-\\sigma)$, where $\\sigma$ is the shielding constant. The Larmor relation in terms of frequency is:\n$$ \\nu = \\frac{\\gamma B_{0}(1-\\sigma)}{2\\pi} $$\nThe spectrometer operating frequency $\\nu_0$ is directly proportional to the static magnetic field $B_0$. We can write $\\nu_0 = K B_0$, where $K$ is a constant related to the nucleus being observed (for ${}^{1}\\text{H}$, $K \\approx \\frac{\\gamma_{{}^{1}\\text{H}}}{2\\pi}$).\n\nUsing the Larmor relation, the frequency difference in the numerator of the $\\delta$ expression is:\n$$ \\nu_{sample} - \\nu_{ref,i} = \\frac{\\gamma B_{0}(1-\\sigma_{sample})}{2\\pi} - \\frac{\\gamma B_{0}(1-\\sigma_{ref,i})}{2\\pi} = \\frac{\\gamma B_{0}}{2\\pi}(\\sigma_{ref,i} - \\sigma_{sample}) $$\nThis frequency difference in Hertz ($\\text{Hz}$) is directly proportional to $B_0$.\n\nSubstituting this into the definition of $\\delta$:\n$$ \\delta = \\frac{\\frac{\\gamma B_{0}}{2\\pi}(\\sigma_{ref,i} - \\sigma_{sample})}{K B_0} \\times 10^6 $$\nSince $K \\approx \\frac{\\gamma}{2\\pi}$, the terms involving $B_0$ and $\\gamma$ cancel out, leaving:\n$$ \\delta \\approx (\\sigma_{ref,i} - \\sigma_{sample}) \\times 10^6 $$\nThis shows that the chemical shift $\\delta$ is a function of the shielding constants only and is therefore independent of the applied magnetic field $B_0$.\n\nNow, we extend this to the case of an external reference with a susceptibility-induced displacement.\nLet $\\nu_{ref,e}$ be the observed frequency of the external reference.\nThe problem states that the analyte resonance is observed at a frequency offset $\\Delta\\nu_{obs}$ downfield from the external TMS. \"Downfield\" signifies a higher frequency, so:\n$$ \\Delta\\nu_{obs} = \\nu_{sample} - \\nu_{ref,e} > 0 $$\nThe problem also states that the external TMS is upfield relative to an ideal internal TMS. \"Upfield\" signifies a lower frequency, meaning $\\nu_{ref,e}  \\nu_{ref,i}$. The frequency difference due to this displacement is:\n$$ \\Delta\\nu_{corr} = \\nu_{ref,i} - \\nu_{ref,e} > 0 $$\nThe true frequency difference required for the chemical shift calculation is $\\nu_{sample} - \\nu_{ref,i}$. We can express this in terms of the observed quantities:\n$$ \\nu_{sample} - \\nu_{ref,i} = (\\nu_{sample} - \\nu_{ref,e}) - (\\nu_{ref,i} - \\nu_{ref,e}) = \\Delta\\nu_{obs} - \\Delta\\nu_{corr} $$\nThe problem states that the susceptibility displacement is linear in $B_0$. This means the frequency shift $\\Delta\\nu_{corr}$ is proportional to $B_0$, and therefore also proportional to the spectrometer frequency $\\nu_0$. We can write this as $\\Delta\\nu_{corr} = c \\cdot \\nu_0$ for some dimensionless constant of proportionality $c$.\n\nThe true chemical shift $\\delta$ (a field-independent quantity) relates the true frequency difference to the spectrometer frequency:\n$$ \\nu_{sample} - \\nu_{ref,i} = \\delta \\cdot \\nu_0 \\cdot 10^{-6} $$\nSubstituting our expressions into this equation:\n$$ \\Delta\\nu_{obs} - \\Delta\\nu_{corr} = \\delta \\cdot \\nu_0 \\cdot 10^{-6} $$\nReplacing $\\Delta\\nu_{corr}$ with $c \\cdot \\nu_0$:\n$$ \\Delta\\nu_{obs} - c \\cdot \\nu_0 = \\delta \\cdot \\nu_0 \\cdot 10^{-6} $$\n$$ \\Delta\\nu_{obs} = (\\delta \\cdot 10^{-6} + c) \\cdot \\nu_0 $$\nThis demonstrates that the observed frequency offset, $\\Delta\\nu_{obs}$, is also proportional to the spectrometer frequency $\\nu_0$.\n\nTo calculate the true chemical shift $\\delta$ from the experimental measurements, we use the formula:\n$$ \\delta_{calc} = \\frac{\\Delta\\nu_{obs} - \\Delta\\nu_{corr}}{\\nu_{0}} \\times 10^6 $$\nSubstituting the relationships $\\Delta\\nu_{obs} = (\\delta \\cdot 10^{-6} + c) \\cdot \\nu_0$ and $\\Delta\\nu_{corr} = c \\cdot \\nu_0$:\n$$ \\delta_{calc} = \\frac{(\\delta \\cdot 10^{-6} + c) \\cdot \\nu_0 - c \\cdot \\nu_0}{\\nu_{0}} \\times 10^6 = \\frac{\\delta \\cdot 10^{-6} \\cdot \\nu_0}{\\nu_{0}} \\times 10^6 = \\delta $$\nThis completes the derivation, showing that correcting the observed frequency shift by the susceptibility displacement (which is proportional to $B_0$) yields the true, field-independent chemical shift $\\delta$.\n\n**Part 2: Calculation of the Analyte's Chemical Shift**\n\nWe are given two sets of data from two different spectrometers. We will compute the chemical shift for each to verify consistency.\n\nFor the first spectrometer:\n- Spectrometer frequency: $\\nu_{0,1} = 500.00 \\, \\text{MHz} = 500.00 \\times 10^6 \\, \\text{Hz}$\n- Observed analyte offset: $\\Delta\\nu_{obs,1} = 11737.990 \\, \\text{Hz}$\n- External TMS displacement correction: $\\Delta\\nu_{corr,1} = 9.600 \\, \\text{Hz}$\n\nThe true frequency shift $\\Delta\\nu_{true,1}$ is:\n$$ \\Delta\\nu_{true,1} = \\Delta\\nu_{obs,1} - \\Delta\\nu_{corr,1} = 11737.990 \\, \\text{Hz} - 9.600 \\, \\text{Hz} = 11728.390 \\, \\text{Hz} $$\nThe chemical shift $\\delta_1$ is:\n$$ \\delta_1 = \\frac{\\Delta\\nu_{true,1}}{\\nu_{0,1}} \\times 10^6 = \\frac{11728.390 \\, \\text{Hz}}{500.00 \\times 10^6 \\, \\text{Hz}} \\times 10^6 = \\frac{11728.390}{500.00} = 23.45678 \\, \\text{ppm} $$\n\nFor the second spectrometer:\n- Spectrometer frequency: $\\nu_{0,2} = 700.00 \\, \\text{MHz} = 700.00 \\times 10^6 \\, \\text{Hz}$\n- Observed analyte offset: $\\Delta\\nu_{obs,2} = 16433.186 \\, \\text{Hz}$\n- External TMS displacement correction: $\\Delta\\nu_{corr,2} = 13.440 \\, \\text{Hz}$\n\nThe true frequency shift $\\Delta\\nu_{true,2}$ is:\n$$ \\Delta\\nu_{true,2} = \\Delta\\nu_{obs,2} - \\Delta\\nu_{corr,2} = 16433.186 \\, \\text{Hz} - 13.440 \\, \\text{Hz} = 16419.746 \\, \\text{Hz} $$\nThe chemical shift $\\delta_2$ is:\n$$ \\delta_2 = \\frac{\\Delta\\nu_{true,2}}{\\nu_{0,2}} \\times 10^6 = \\frac{16419.746 \\, \\text{Hz}}{700.00 \\times 10^6 \\, \\text{Hz}} \\times 10^6 = \\frac{16419.746}{700.00} = 23.45678 \\, \\text{ppm} $$\n\nBoth calculations yield the identical result $\\delta = 23.45678 \\, \\text{ppm}$, which confirms the field-independent nature of the correctly referenced chemical shift. The problem asks for the final answer to be rounded to six significant figures. The sixth significant digit is $7$, and the following digit is $8$, so we round up.\n\nFinal value: $\\delta = 23.4568 \\, \\text{ppm}$.", "answer": "$$\n\\boxed{23.4568}\n$$", "id": "3726735"}, {"introduction": "While Tetramethylsilane (TMS) is the conventional primary reference, other standards like DSS are often used, especially in aqueous solutions. This practice reinforces the concept that chemical shifts are fundamentally relative measurements defined by frequency differences. You will perform a straightforward but crucial conversion between two different reference scales, a skill essential for comparing and standardizing NMR data from diverse experimental setups [@problem_id:3726727].", "problem": "An organic compound is analyzed by proton nuclear magnetic resonance (proton NMR) spectroscopy at a constant magnetic flux density $B_{0}$ such that the bare Larmor frequency of the proton (i.e., the frequency in the absence of electronic shielding) is $\\nu_{0} = 600.000000~\\text{MHz}$. The resonance frequency of a nucleus with electronic shielding $\\sigma$ obeys the Larmor relation $\\nu = \\nu_{0}(1 - \\sigma)$, and the chemical shift on a chosen reference scale is defined by the dimensionless quantity\n$$\n\\delta^{R}(S) \\equiv \\frac{\\nu(S) - \\nu(R)}{\\nu_{0}} \\times 10^{6},\n$$\nwhere $R$ denotes the chosen reference and $S$ denotes a sample resonance.\n\nTwo different reference standards are considered: Tetramethylsilane (TMS) and 4,4-dimethyl-4-silapentane-1-sulfonic acid (DSS). On the $^{1}\\text{H}$ channel at the stated field, the following frequency offsets are measured under identical conditions:\n- The frequency offset of the sample resonance $S$ relative to DSS: $\\Delta \\nu_{S,\\text{DSS}} = +1823.45~\\text{Hz}$, meaning $\\nu(S) - \\nu(\\text{DSS}) = +1823.45~\\text{Hz}$.\n- The frequency offset of TMS relative to DSS: $\\Delta \\nu_{\\text{TMS},\\text{DSS}} = +9.75~\\text{Hz}$, meaning $\\nu(\\text{TMS}) - \\nu(\\text{DSS}) = +9.75~\\text{Hz}$.\n\nStarting only from the Larmor relation and the definition of chemical shift above, determine the chemical shift of the sample resonance $S$ when the reference choice is switched from DSS to TMS, i.e., compute $\\delta^{\\text{TMS}}(S)$.\n\nExpress the final chemical shift in parts per million (ppm) as a pure number with no unit symbol, and round your answer to six significant figures.", "solution": "The problem statement is subjected to validation and is found to be valid. It is scientifically grounded in the principles of Nuclear Magnetic Resonance (NMR) spectroscopy, well-posed with a unique and stable solution, and expressed in objective, formal language. All provided data and definitions are self-consistent and realistic.\n\nThe objective is to compute the chemical shift of a sample resonance $S$ using Tetramethylsilane (TMS) as the reference standard, denoted by $\\delta^{\\text{TMS}}(S)$. The problem requires this calculation to be based on the provided Larmor relation and the definition of chemical shift.\n\nThe chemical shift on a reference scale $R$ for a sample $S$ is defined as:\n$$\n\\delta^{R}(S) \\equiv \\frac{\\nu(S) - \\nu(R)}{\\nu_{0}} \\times 10^{6}\n$$\nFor our specific case, where the reference $R$ is TMS, this definition becomes:\n$$\n\\delta^{\\text{TMS}}(S) = \\frac{\\nu(S) - \\nu(\\text{TMS})}{\\nu_{0}} \\times 10^{6}\n$$\nHere, $\\nu(S)$ is the resonance frequency of the sample, $\\nu(\\text{TMS})$ is the resonance frequency of TMS, and $\\nu_{0}$ is the bare Larmor frequency of the proton.\n\nThe problem provides the following givens:\n1. The bare Larmor frequency, $\\nu_{0} = 600.000000~\\text{MHz} = 600.000000 \\times 10^{6}~\\text{Hz}$.\n2. The frequency offset of the sample resonance $S$ relative to the 4,4-dimethyl-4-silapentane-1-sulfonic acid (DSS) reference: $\\nu(S) - \\nu(\\text{DSS}) = 1823.45~\\text{Hz}$.\n3. The frequency offset of TMS relative to the DSS reference: $\\nu(\\text{TMS}) - \\nu(\\text{DSS}) = 9.75~\\text{Hz}$.\n\nTo calculate $\\delta^{\\text{TMS}}(S)$, we first need to determine the value of the numerator in its definition, which is the frequency difference $\\nu(S) - \\nu(\\text{TMS})$. This quantity represents the frequency of the sample resonance relative to the TMS reference. We can compute this by algebraically combining the two given frequency offsets, both of which are measured relative to the common reference DSS.\n\nWe can write:\n$$\n\\nu(S) - \\nu(\\text{TMS}) = (\\nu(S) - \\nu(\\text{DSS})) - (\\nu(\\text{TMS}) - \\nu(\\text{DSS}))\n$$\nSubstituting the given numerical values into this expression:\n$$\n\\nu(S) - \\nu(\\text{TMS}) = 1823.45~\\text{Hz} - 9.75~\\text{Hz}\n$$\n$$\n\\nu(S) - \\nu(\\text{TMS}) = 1813.70~\\text{Hz}\n$$\n\nNow we substitute this frequency difference and the value of $\\nu_{0}$ into the formula for $\\delta^{\\text{TMS}}(S)$:\n$$\n\\delta^{\\text{TMS}}(S) = \\frac{1813.70~\\text{Hz}}{600.000000 \\times 10^{6}~\\text{Hz}} \\times 10^{6}\n$$\nThe factor of $10^{6}$ in the definition's scaling factor and the factor of $10^{6}$ from converting $\\nu_{0}$ from MHz to Hz cancel each other out. The expression simplifies to a dimensionless ratio:\n$$\n\\delta^{\\text{TMS}}(S) = \\frac{1813.70}{600.000000}\n$$\nPerforming the division yields the numerical value of the chemical shift:\n$$\n\\delta^{\\text{TMS}}(S) \\approx 3.0228333...\n$$\nThe problem requires the final answer to be rounded to six significant figures. The first six significant digits of the result are $3$, $0$, $2$, $2$, $8$, and $3$. The seventh digit is $3$, which is less than $5$, so we round down by truncating.\n\nTherefore, the chemical shift of the sample resonance $S$ relative to TMS is:\n$$\n\\delta^{\\text{TMS}}(S) = 3.02283\n$$\nThis calculation, derived directly from the definition of $\\delta$ and the experimental frequency differences, is fully consistent with the underlying physics described by the Larmor relation $\\nu = \\nu_0(1-\\sigma)$.", "answer": "$$\\boxed{3.02283}$$", "id": "3726727"}, {"introduction": "A reported chemical shift is the final output of a complex chain of digital signal processing, and understanding this process is key to interpreting spectra with confidence. In this computational exercise, you will build a model that simulates a Free Induction Decay (FID) and processes it into a final spectrum. By manipulating parameters such as phase and applying different window functions, you will gain first-hand insight into how these choices can affect the apparent peak position and the accuracy of the resulting chemical shift value [@problem_id:3726733].", "problem": "You are to implement a complete, runnable program that models how digital signal processing in Nuclear Magnetic Resonance (NMR) spectrometry can influence the apparent peak position and, consequently, the computed chemical shift on the $\\delta$ scale, when referencing against a standard. The investigation must be grounded in first principles, specifically: the definition of chemical shift on the $\\delta$ scale, Fourier analysis of a time-domain Free Induction Decay (FID), discrete-time sampling constraints, and the role of reference standards in constructing the frequency origin.\n\nThe chemical shift on the $\\delta$ scale is a dimensionless quantity defined by the difference in resonance frequency relative to a reference standard and normalized by the operating frequency for the observed nucleus. For a sample resonance frequency $\\,\\nu_{\\text{sample}}\\,$ and a reference resonance frequency $\\,\\nu_{\\text{ref}}\\,$ measured at the same magnetic field for the same nucleus, the chemical shift $\\delta$ (in parts per million) is defined by\n$$\n\\delta \\equiv \\frac{\\nu_{\\text{sample}} - \\nu_{\\text{ref}}}{\\nu_0} \\times 10^6,\n$$\nwhere $\\,\\nu_0\\,$ is the spectrometer frequency of the observed nucleus (for example, $\\,^{1}\\mathrm{H}\\,$ at $\\,\\nu_0 = 400\\ \\mathrm{MHz}\\,$). The reference compound is commonly Tetramethylsilane (TMS) which is defined to be at $\\delta = 0$ for $\\,^{1}\\mathrm{H}\\,$ and $\\,^{13}\\mathrm{C}\\,$.\n\nYou will simulate a single-resonance $\\,^{1}\\mathrm{H}\\,$ NMR FID in the time domain, process it with different windows and phase conditions, compute the discrete Fourier transform, detect the apparent peak frequency, and convert it to a chemical shift using the definition above. Your simulation and analysis must adhere to the following fundamental bases:\n\n- Time-domain detection produces an FID modeled as a damped complex exponential with transverse relaxation characterized by a decay time $\\,T_2\\,$. The signal can be written generically as $\\,s(t) = e^{-t/T_2}\\,e^{i(2\\pi f_0 t + \\phi_0)}\\,$, where $\\,f_0\\,$ is the baseband resonance frequency relative to the chosen reference origin and $\\,\\phi_0\\,$ is a zero-order phase error.\n- Discrete-time sampling with dwell time $\\,\\Delta t\\,$ and $\\,N\\,$ points yields an acquisition time $\\,T = N \\Delta t\\,$ and a nominal frequency bin spacing $\\,\\Delta \\nu = 1/T\\,$. Zero-filling increases the number of frequency bins without increasing true resolution.\n- Time-domain apodization multiplies $\\,s(t)\\,$ by a window $\\,w(t)\\,$ (for example an exponential or a Gaussian), which alters linewidth and lineshape through convolution in the frequency domain.\n- Referencing sets the origin such that $\\,\\nu_{\\text{ref}}\\,$ defines $\\,\\delta = 0\\,$. A misreference by $\\,\\Delta \\nu_{\\text{ref}}\\,$ means the used reference is $\\,\\nu_{\\text{ref,used}} = \\nu_{\\text{ref,true}} + \\Delta \\nu_{\\text{ref}}\\,$ and affects the computed chemical shift.\n\nYour program must implement the following steps for each test case:\n1. Compute the true baseband resonance frequency $\\,f_0\\,$ in hertz from the provided true chemical shift $\\,\\delta_{\\text{true}}\\,$ and $\\,\\nu_0\\,$ via $\\,f_0 = \\nu_0 \\,\\delta_{\\text{true}} / 10^6\\,$ assuming the digital origin is set by $\\,\\nu_{\\text{ref,true}}\\,$.\n2. Construct the FID $\\,s(t)\\,$ over $\\,t_k = k\\,\\Delta t\\,$ for $\\,k = 0,1,\\dots,N-1\\,$ using the specified $\\,T_2\\,$, $\\,f_0\\,$, and $\\,\\phi_0\\,$.\n3. Apply the specified window $\\,w(t)\\,$ (options: `none`, `exponential` with parameter $\\tau$, or `Gaussian` with parameter $\\sigma$).\n4. Zero-fill by padding with zeros to $\\,N_{\\mathrm{zf}} = \\mathrm{zf\\_factor} \\times N\\,$ points.\n5. Compute the discrete Fourier transform and its frequency axis in hertz, and then choose the spectral amplitude as either the real part or the magnitude, according to the test case.\n6. Detect the maximum peak bin and refine the peak frequency using simple parabolic interpolation on the maximum and its neighbors to estimate a sub-bin peak location. Handle boundary bins gracefully by skipping interpolation if the maximum is at an edge.\n7. Convert the measured peak frequency $\\,f_{\\text{peak}}\\,$ to an apparent chemical shift in parts per million using $\\,\\delta_{\\text{meas}} = [(f_{\\text{peak}} - \\Delta \\nu_{\\text{ref}})/\\nu_0] \\times 10^6\\,$, where $\\,\\Delta \\nu_{\\text{ref}}\\,$ is the provided misreference in hertz (use $\\,\\Delta \\nu_{\\text{ref}} = 0\\,$ for correctly referenced cases).\n8. Return the computed $\\,\\delta_{\\text{meas}}\\,$ as a floating-point number for each test case.\n\nPhysical units:\n- Frequencies $\\,\\nu_0\\,$, $\\,f_0\\,$, and $\\,\\Delta \\nu_{\\text{ref}}\\,$ must be treated in hertz ($\\,\\mathrm{Hz}\\,$).\n- Time parameters $\\,\\Delta t\\,$, $\\,T_2\\,$, $\\,\\tau\\,$, and $\\,\\sigma\\,$ must be treated in seconds ($\\,\\mathrm{s}\\,$).\n- All chemical shifts $\\,\\delta\\,$ must be expressed in parts per million (ppm) as decimal floats.\n\nAngle unit:\n- Phases such as $\\,\\phi_0\\,$ must be in radians.\n\nTest suite:\nProvide the following test cases as a list in your program. Each case is a tuple of parameters \n$\\,(\\nu_0,\\ \\delta_{\\text{true}},\\ N,\\ \\Delta t,\\ T_2,\\ \\phi_0,\\ \\text{window\\_type},\\ \\text{window\\_param},\\ \\mathrm{zf\\_factor},\\ \\text{amplitude\\_mode},\\ \\Delta \\nu_{\\text{ref}})\\,$. Use exactly these values:\n- Case A (happy path): $\\,\\nu_0 = 400\\times 10^6\\,$, $\\,\\delta_{\\text{true}} = 4.700\\,$, $\\,N = 8192\\,$, $\\,\\Delta t = 1.25\\times 10^{-4}\\,$, $\\,T_2 = 0.5\\,$, $\\,\\phi_0 = 0.0\\,$, window `none` with parameter 0.0, $\\,\\mathrm{zf\\_factor} = 1\\,$, amplitude mode `real`, $\\,\\Delta \\nu_{\\text{ref}} = 0.0\\,$.\n- Case B (exponential apodization): $\\,\\nu_0 = 400\\times 10^6\\,$, $\\,\\delta_{\\text{true}} = 4.700\\,$, $\\,N = 8192\\,$, $\\,\\Delta t = 1.25\\times 10^{-4}\\,$, $\\,T_2 = 0.5\\,$, $\\,\\phi_0 = 0.0\\,$, window `exponential` with parameter $\\tau = 0.2$, $\\,\\mathrm{zf\\_factor} = 1\\,$, amplitude mode `real`, $\\,\\Delta \\nu_{\\text{ref}} = 0.0\\,$.\n- Case C (phase-induced lineshape mixing): $\\,\\nu_0 = 400\\times 10^6\\,$, $\\,\\delta_{\\text{true}} = 4.700\\,$, $\\,N = 8192\\,$, $\\,\\Delta t = 1.25\\times 10^{-4}\\,$, $\\,T_2 = 0.5\\,$, $\\,\\phi_0 = \\pi/3\\,$, window `none` with parameter 0.0, $\\,\\mathrm{zf\\_factor} = 1\\,$, amplitude mode `real`, $\\,\\Delta \\nu_{\\text{ref}} = 0.0\\,$.\n- Case D (zero-filling): $\\,\\nu_0 = 400\\times 10^6\\,$, $\\,\\delta_{\\text{true}} = 4.700\\,$, $\\,N = 8192\\,$, $\\,\\Delta t = 1.25\\times 10^{-4}\\,$, $\\,T_2 = 0.5\\,$, $\\,\\phi_0 = 0.0\\,$, window `none` with parameter 0.0, $\\,\\mathrm{zf\\_factor} = 4\\,$, amplitude mode `real`, $\\,\\Delta \\nu_{\\text{ref}} = 0.0\\,$.\n- Case E (misreference by $\\,10\\,$ hertz): $\\,\\nu_0 = 400\\times 10^6\\,$, $\\,\\delta_{\\text{true}} = 4.700\\,$, $\\,N = 8192\\,$, $\\,\\Delta t = 1.25\\times 10^{-4}\\,$, $\\,T_2 = 0.5\\,$, $\\,\\phi_0 = 0.0\\,$, window `none` with parameter 0.0, $\\,\\mathrm{zf\\_factor} = 1\\,$, amplitude mode `real`, $\\,\\Delta \\nu_{\\text{ref}} = +10.0\\,$.\n- Case F (boundary proximity): $\\,\\nu_0 = 400\\times 10^6\\,$, $\\,\\delta_{\\text{true}} = 9.900\\,$, $\\,N = 8192\\,$, $\\,\\Delta t = 1.25\\times 10^{-4}\\,$, $\\,T_2 = 0.5\\,$, $\\,\\phi_0 = 0.0\\,$, window `none` with parameter 0.0, $\\,\\mathrm{zf\\_factor} = 1\\,$, amplitude mode `real`, $\\,\\Delta \\nu_{\\text{ref}} = 0.0\\,$.\n\nAnswer specification:\n- For each test case, compute and return the measured chemical shift $\\,\\delta_{\\text{meas}}\\,$ in parts per million as a decimal float.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $\\,[$result1,result2,result3$]$).\n\nYour implementation must be fully self-contained, require no inputs, and must strictly adhere to the execution environment defined in the final answer tag.", "solution": "The objective is to quantify how digital signal processing operations in Nuclear Magnetic Resonance (NMR) spectrometry influence the apparent peak frequency and therefore the chemical shift on the $\\delta$ scale, while anchored in definitions and Fourier analysis.\n\nWe begin with the fundamental definition of the chemical shift. For a single $\\,^{1}\\mathrm{H}\\,$ resonance, the chemical shift $\\delta$ (in parts per million) is defined by\n$$\n\\delta = \\frac{\\nu_{\\text{sample}} - \\nu_{\\text{ref}}}{\\nu_0} \\times 10^6,\n$$\nwhere $\\,\\nu_{\\text{sample}}\\,$ is the resonance frequency of the sample, $\\,\\nu_{\\text{ref}}\\,$ is the resonance frequency of a reference standard at the same magnetic field (e.g., Tetramethylsilane (TMS)), and $\\,\\nu_0\\,$ is the spectrometer frequency for the nucleus. This definition is the basis for the $\\delta$ scale and ensures dimensionless normalization across instruments.\n\nIn an NMR experiment, a Free Induction Decay (FID) is recorded in the time domain. For a single resonance with transverse relaxation time $\\,T_2\\,$, a zero-order phase $\\,\\phi_0\\,$, and a baseband resonance frequency $\\,f_0\\,$ relative to the reference origin, we model the FID as\n$$\ns(t) = e^{-t/T_2} \\, e^{i(2\\pi f_0 t + \\phi_0)},\n$$\nwhich follows from precessing magnetization decaying exponentially and producing a complex signal in quadrature detection. Discrete-time sampling with dwell time $\\,\\Delta t\\,$ over $\\,N\\,$ points yields sample times $\\,t_k = k \\Delta t\\,$ for $\\,k = 0,1,\\dots,N-1\\,$. The acquisition time is $\\,T = N \\Delta t\\,$, and the nominal frequency bin spacing is $\\,\\Delta \\nu = 1/T\\,$. Zero-filling increases the number of points in the discrete Fourier transform to $\\,N_{\\mathrm{zf}} = \\mathrm{zf\\_factor} \\times N\\,$, thereby providing denser binning in frequency without altering true physical resolution.\n\nSignal processing operations such as apodization are modeled by multiplying the FID by a window $\\,w(t)\\,$. We consider:\n- Exponential apodization: $\\,w(t) = e^{-t/\\tau}\\,$, which increases effective linewidth by broadening the frequency-domain lineshape through convolution.\n- Gaussian apodization: $\\,w(t) = e^{-(t/\\sigma)^2}\\,$, which yields approximately Gaussian broadening.\n\nMultiplication in the time domain corresponds to convolution in the frequency domain. For an isolated, symmetric resonance line, convolution with a symmetric window transform preserves the true center frequency. However, the discretized peak maximum may not perfectly coincide with the true center due to binning, lineshape distortion, and especially when the real part is used under phase errors (which mix absorptive and dispersive components). Specifically, the Fourier transform of $\\,s(t)\\,$ produces a complex spectrum $\\,S(\\nu)\\,$. A non-zero $\\,\\phi_0\\,$ rotates the spectrum, so the real part becomes a linear combination of the absorptive Lorentzian and the dispersive component. Because the dispersive component is antisymmetric about the true resonance, mixing it into the real part induces asymmetry and can shift the location of the maximum of the real part away from the true center even though the true resonance frequency is unchanged. This phenomenon demonstrates how signal processing affects peak picking and therefore chemical shift assignment.\n\nTo compute the apparent chemical shift from simulated data:\n1. Compute $\\,f_0 = \\nu_0\\,\\delta_{\\text{true}}/10^6\\,$ from the definition of $\\delta$, assuming the digital origin equals $\\,\\nu_{\\text{ref,true}}\\,$.\n2. Generate the discrete FID as $\\,s_k = e^{-t_k/T_2}\\,e^{i(2\\pi f_0 t_k + \\phi_0)}\\,$.\n3. Apply the selected window: none, exponential with parameter $\\,\\tau\\,$, or Gaussian with parameter $\\,\\sigma\\,$.\n4. Zero-fill by padding zeros to reach $\\,N_{\\mathrm{zf}}\\,$.\n5. Compute the discrete Fourier transform and form the frequency axis in hertz using the sampling theorem. Shift to center zero frequency for intuitive inspection.\n6. Depending on the amplitude mode, choose either $\\,\\Re\\{S(\\nu)\\}\\,$ or $\\,|S(\\nu)|\\,$ to perform peak detection. The choice of the real part under $\\,\\phi_0 \\neq 0\\,$ illustrates phase-induced apparent shifts.\n7. Find the maximum bin index $i_{\\max}$. If $i_{\\max}$ is not at a boundary, refine the peak frequency by quadratic interpolation on the three-point neighborhood. For uniform bin spacing $\\Delta f$ and amplitudes $y_{-1}, y_0, y_{+1}$ at bins $i_{\\max}-1, i_{\\max}, i_{\\max}+1$, the sub-bin offset $\\delta i$ that maximizes a fitted parabola satisfies\n$$ \\delta i = \\frac{1}{2}\\,\\frac{y_{-1} - y_{+1}}{y_{-1} - 2y_0 + y_{+1}}, $$\nand the interpolated peak frequency is $f_{\\text{peak}} = f_{i_{\\max}} + \\delta i \\,\\Delta f$ provided the denominator is non-zero.\n8. Convert $f_{\\text{peak}}$ to the apparent chemical shift in parts per million by\n$$\n\\delta_{\\text{meas}} = \\frac{f_{\\text{peak}} - \\Delta \\nu_{\\text{ref}}}{\\nu_0} \\times 10^6,\n$$\nwhere $\\,\\Delta \\nu_{\\text{ref}}\\,$ encodes misreferencing (positive $\\,\\Delta \\nu_{\\text{ref}}\\,$ means the used reference is higher than the true reference so the computed $\\,\\delta\\,$ is reduced).\n\nThis procedure ties peak-picking outcomes directly to the physical definition of chemical shift and illustrates how windowing, phase, zero-filling, binning, and referencing impact $\\,\\delta\\,$. The test suite covers:\n- A well-conditioned case with no window and zero phase (Case A).\n- Exponential apodization that broadens the line but should not alter the true center (Case B).\n- Non-zero phase with real-part peak picking that mixes dispersive contributions and can shift the apparent maximum (Case C).\n- Zero-filling to mitigate binning coarseness through denser sampling (Case D).\n- Misreference offset to demonstrate systematic bias in $\\,\\delta\\,$ (Case E).\n- A resonance near the boundary of the spectral window to probe binning and edge behavior (Case F).\n\nThe output for each case is $\\,\\delta_{\\text{meas}}\\,$ in parts per million, printed as a single comma-separated list enclosed in square brackets, satisfying the stated unit requirements and providing quantifiable floating-point results aligned with the advanced-graduate exploration of the chemical shift $\\delta$ scale and reference standards under realistic signal processing.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef simulate_fid(n_points, dt, f0_hz, T2_s, phase0_rad, window_type, window_param, zf_factor):\n    \"\"\"\n    Simulate a single-resonance complex FID:\n    s(t) = exp(-t/T2) * exp(i*(2*pi*f0*t + phase0)).\n    Apply optional windowing and zero-filling.\n    \"\"\"\n    t = np.arange(n_points, dtype=np.float64) * dt\n    fid = np.exp(-t / T2_s) * np.exp(1j * (2.0 * np.pi * f0_hz * t + phase0_rad))\n\n    # Apply window\n    if window_type == 'none':\n        pass  # no change\n    elif window_type == 'exponential':\n        tau = float(window_param)\n        if tau  0.0:\n            fid = fid * np.exp(-t / tau)\n    elif window_type == 'gaussian':\n        sigma = float(window_param)\n        if sigma  0.0:\n            fid = fid * np.exp(-(t / sigma) ** 2)\n    else:\n        # Unknown window; do nothing\n        pass\n\n    # Zero-filling\n    zf_factor = int(zf_factor)\n    if zf_factor  1:\n        pad_len = n_points * (zf_factor - 1)\n        fid = np.pad(fid, (0, pad_len), mode='constant', constant_values=0.0)\n\n    return fid\n\ndef spectrum_and_frequency(fid, dt):\n    \"\"\"\n    Compute FFT spectrum (shifted) and corresponding frequency axis in Hz.\n    \"\"\"\n    n = fid.shape[0]\n    spec = np.fft.fftshift(np.fft.fft(fid))\n    freqs = np.fft.fftshift(np.fft.fftfreq(n, d=dt))\n    return spec, freqs\n\ndef peak_pick(freqs, spectrum, mode='real'):\n    \"\"\"\n    Peak picking with optional parabolic interpolation.\n    mode: 'real' uses real part, 'magnitude' uses absolute value.\n    Returns interpolated peak frequency in Hz.\n    \"\"\"\n    if mode == 'real':\n        amp = np.real(spectrum)\n    else:\n        amp = np.abs(spectrum)\n\n    # Find maximum bin\n    i_max = int(np.argmax(amp))\n    f_peak = freqs[i_max]\n\n    # Parabolic interpolation using neighbors if available\n    if 0  i_max  (len(amp) - 1):\n        y_m1 = amp[i_max - 1]\n        y_0 = amp[i_max]\n        y_p1 = amp[i_max + 1]\n        denom = (y_m1 - 2.0 * y_0 + y_p1)\n        if denom != 0.0:\n            delta_i = 0.5 * (y_m1 - y_p1) / denom\n            # frequency step is uniform\n            df = freqs[1] - freqs[0]\n            f_peak = f_peak + delta_i * df\n\n    return f_peak\n\ndef compute_delta_meas(nu0_hz, delta_true_ppm, n_points, dt, T2_s, phase0_rad,\n                       window_type, window_param, zf_factor, amplitude_mode, ref_offset_hz):\n    \"\"\"\n    Compute apparent chemical shift delta_meas (ppm) given simulation and processing parameters.\n    \"\"\"\n    # True baseband resonance frequency relative to true reference origin\n    f0_hz = nu0_hz * (delta_true_ppm / 1.0e6)\n\n    # Simulate FID with windowing and zero-filling\n    fid = simulate_fid(n_points, dt, f0_hz, T2_s, phase0_rad, window_type, window_param, zf_factor)\n\n    # Compute spectrum and frequency axis\n    spec, freqs = spectrum_and_frequency(fid, dt)\n\n    # Peak picking\n    f_peak_hz = peak_pick(freqs, spec, mode=amplitude_mode)\n\n    # Apply misreference offset: used reference = true reference + ref_offset_hz\n    # delta_meas = ((f_peak - ref_offset_hz) / nu0) * 1e6\n    delta_meas_ppm = ((f_peak_hz - ref_offset_hz) / nu0_hz) * 1.0e6\n\n    return delta_meas_ppm\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple: (nu0_hz, delta_true_ppm, N, dt, T2, phi0, window_type, window_param, zf_factor, amplitude_mode, ref_offset_hz)\n    test_cases = [\n        (400e6, 4.700, 8192, 1.25e-4, 0.5, 0.0, 'none', 0.0, 1, 'real', 0.0),       # Case A\n        (400e6, 4.700, 8192, 1.25e-4, 0.5, 0.0, 'exponential', 0.2, 1, 'real', 0.0),# Case B\n        (400e6, 4.700, 8192, 1.25e-4, 0.5, np.pi/3, 'none', 0.0, 1, 'real', 0.0),   # Case C\n        (400e6, 4.700, 8192, 1.25e-4, 0.5, 0.0, 'none', 0.0, 4, 'real', 0.0),       # Case D\n        (400e6, 4.700, 8192, 1.25e-4, 0.5, 0.0, 'none', 0.0, 1, 'real', 10.0),      # Case E\n        (400e6, 9.900, 8192, 1.25e-4, 0.5, 0.0, 'none', 0.0, 1, 'real', 0.0),       # Case F\n    ]\n\n    results = []\n    for case in test_cases:\n        (nu0_hz, delta_true_ppm, N, dt, T2, phi0, window_type, window_param,\n         zf_factor, amplitude_mode, ref_offset_hz) = case\n\n        delta_meas = compute_delta_meas(\n            nu0_hz=nu0_hz,\n            delta_true_ppm=delta_true_ppm,\n            n_points=N,\n            dt=dt,\n            T2_s=T2,\n            phase0_rad=phi0,\n            window_type=window_type,\n            window_param=window_param,\n            zf_factor=zf_factor,\n            amplitude_mode=amplitude_mode,\n            ref_offset_hz=ref_offset_hz\n        )\n        # Format to a reasonable precision to reflect ppm reporting\n        results.append(f\"{delta_meas:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3726733"}]}