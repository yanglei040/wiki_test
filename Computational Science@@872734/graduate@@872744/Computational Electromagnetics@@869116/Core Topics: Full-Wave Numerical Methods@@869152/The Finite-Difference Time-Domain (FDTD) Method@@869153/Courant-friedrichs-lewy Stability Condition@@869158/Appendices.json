{"hands_on_practices": [{"introduction": "Understanding the Courant-Friedrichs-Lewy (CFL) condition begins with a solid mathematical foundation. This first practice provides exactly that by guiding you through a von Neumann stability analysis of the first-order upwind scheme [@problem_id:3375615]. By working through this fundamental exercise, you will directly derive the relationship between the time step, spatial grid size, and wave speed that ensures a numerically stable solution for the linear advection equation, a cornerstone model for hyperbolic systems.", "problem": "Consider the linear advection partial differential equation (PDE) $u_{t} + a\\,u_{x} = 0$ for a constant advection speed $a \\in \\mathbb{R}$ on a uniform spatial grid with spacing $\\Delta x  0$ and explicit time stepping with step size $\\Delta t  0$. Discretize $u_{x}$ using the first-order upwind finite-difference approximation consistent with the sign of $a$ (backward difference if $a0$, forward difference if $a0$), and discretize $u_{t}$ using forward Euler in time. Assume a spatially periodic setting so that discrete Fourier modes are admissible. Define the Courant-Friedrichs-Lewy (CFL) number $C := a\\,\\Delta t/\\Delta x$. Perform a von Neumann (Fourier) stability analysis of this scheme by considering a discrete Fourier mode $u_{j}^{n} = \\hat{u}^{n}\\exp(i\\theta j)$, where $\\theta \\in \\mathbb{R}$ is the nondimensional wavenumber, and derive the sharp necessary and sufficient stability constraint on $C$ ensuring that the amplification factor has magnitude at most one for all wavenumbers. Finally, express your result as the maximal allowable time step $\\Delta t_{\\max}$ in terms of $a$ and $\\Delta x$. Provide your final answer as a single closed-form analytic expression. No numerical rounding is required.", "solution": "The user wants me to solve a problem.\n\n### Step 1: Extract Givens\n- **PDE**: $u_{t} + a\\,u_{x} = 0$, where $a \\in \\mathbb{R}$ is a constant advection speed.\n- **Grid**: Uniform spatial grid with spacing $\\Delta x  0$.\n- **Time Stepping**: Explicit, with step size $\\Delta t  0$.\n- **Discretization of $u_t$**: Forward Euler in time, $u_t \\approx \\frac{u_j^{n+1} - u_j^n}{\\Delta t}$.\n- **Discretization of $u_x$**: First-order upwind scheme.\n    - If $a  0$: Backward difference, $u_x \\approx \\frac{u_j^n - u_{j-1}^n}{\\Delta x}$.\n    - If $a  0$: Forward difference, $u_x \\approx \\frac{u_{j+1}^n - u_j^n}{\\Delta x}$.\n- **Setting**: Spatially periodic.\n- **Analysis Method**: von Neumann stability analysis using a discrete Fourier mode $u_{j}^{n} = \\hat{u}^{n}\\exp(i\\theta j)$, where $\\theta \\in \\mathbb{R}$.\n- **Definition**: Courant-Friedrichs-Lewy (CFL) number, $C := a\\,\\Delta t/\\Delta x$.\n- **Objective**: Derive the sharp necessary and sufficient stability constraint on $C$ and express the result as the maximal allowable time step $\\Delta t_{\\max}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically and mathematically sound. It poses a standard, well-defined question in the field of numerical analysis for partial differential equations.\n- **Scientifically Grounded**: The linear advection equation is a fundamental model equation. The first-order upwind scheme and von Neumann stability analysis are standard, well-established techniques. All premises are correct.\n- **Well-Posed**: The problem is clearly stated with all necessary information to derive a unique and meaningful solution. The definitions are precise.\n- **Objective**: The language is formal, objective, and free of bias or subjective claims.\n- **Completeness**: The problem is self-contained and provides all required definitions and conditions. There are no contradictions.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. I will proceed with a full, reasoned solution.\n\nThe linear advection equation is given by\n$$\nu_t + a u_x = 0\n$$\nwhere $u(x,t)$ is the transported quantity, $a$ is the constant advection speed, $t$ is time, and $x$ is the spatial coordinate. We discretize this equation on a uniform grid where $x_j = j\\Delta x$ and $t_n = n\\Delta t$. Let $u_j^n$ denote the numerical approximation of $u(x_j, t_n)$.\n\nThe time derivative $u_t$ is approximated using the forward Euler method:\n$$\nu_t \\approx \\frac{u_j^{n+1} - u_j^n}{\\Delta t}\n$$\nThe spatial derivative $u_x$ is approximated using a first-order upwind scheme, which depends on the sign of the advection speed $a$.\n\n**Case 1: $a  0$**\nFor positive advection speed, information propagates in the positive $x$ direction. The upwind scheme uses a backward difference for the spatial derivative:\n$$\nu_x \\approx \\frac{u_j^n - u_{j-1}^n}{\\Delta x}\n$$\nSubstituting these approximations into the PDE gives the finite difference equation:\n$$\n\\frac{u_j^{n+1} - u_j^n}{\\Delta t} + a \\frac{u_j^n - u_{j-1}^n}{\\Delta x} = 0\n$$\nRearranging for $u_j^{n+1}$ and introducing the Courant-Friedrichs-Lewy (CFL) number $C = \\frac{a \\Delta t}{\\Delta x}$, we get:\n$$\nu_j^{n+1} = u_j^n - C (u_j^n - u_{j-1}^n)\n$$\nSince $a  0$, $\\Delta t  0$, and $\\Delta x  0$, we have $C  0$.\n\nFor the von Neumann stability analysis, we substitute the discrete Fourier mode $u_j^n = \\hat{u}^n \\exp(i\\theta j)$ into the scheme, where $\\theta$ is the non-dimensional wavenumber. The amplitude $\\hat{u}^n$ evolves according to $\\hat{u}^{n+1} = G(\\theta) \\hat{u}^n$, where $G(\\theta)$ is the amplification factor.\n$$\n\\hat{u}^{n+1} \\exp(i\\theta j) = \\hat{u}^n \\exp(i\\theta j) - C (\\hat{u}^n \\exp(i\\theta j) - \\hat{u}^n \\exp(i\\theta (j-1)))\n$$\nDividing by $\\hat{u}^n \\exp(i\\theta j)$ (assuming $\\hat{u}^n \\neq 0$):\n$$\nG(\\theta) = \\frac{\\hat{u}^{n+1}}{\\hat{u}^n} = 1 - C (1 - \\exp(-i\\theta))\n$$\nFor the scheme to be stable, the magnitude of the amplification factor must satisfy $|G(\\theta)| \\le 1$ for all wavenumbers $\\theta \\in \\mathbb{R}$. We analyze the squared magnitude:\n$$\n|G(\\theta)|^2 = |(1 - C) + C \\exp(-i\\theta)|^2 = |(1 - C + C\\cos\\theta) - iC\\sin\\theta|^2\n$$\n$$\n|G(\\theta)|^2 = (1 - C + C\\cos\\theta)^2 + (-C\\sin\\theta)^2\n$$\n$$\n|G(\\theta)|^2 = (1-C)^2 + 2C(1-C)\\cos\\theta + C^2\\cos^2\\theta + C^2\\sin^2\\theta\n$$\n$$\n|G(\\theta)|^2 = 1 - 2C + C^2 + 2C(1-C)\\cos\\theta + C^2(\\cos^2\\theta + \\sin^2\\theta)\n$$\n$$\n|G(\\theta)|^2 = 1 - 2C + 2C^2 + 2C(1-C)\\cos\\theta = 1 - 2C(1-C) + 2C(1-C)\\cos\\theta\n$$\n$$\n|G(\\theta)|^2 = 1 - 2C(1-C)(1-\\cos\\theta)\n$$\nThe stability condition $|G(\\theta)|^2 \\le 1$ implies:\n$$\n1 - 2C(1-C)(1-\\cos\\theta) \\le 1\n$$\n$$\n-2C(1-C)(1-\\cos\\theta) \\le 0\n$$\nSince $(1-\\cos\\theta) \\ge 0$ for all $\\theta$, the inequality simplifies to:\n$$\nC(1-C) \\ge 0\n$$\nGiven that we are in the case $a  0$, we have $C  0$. Thus, for the product to be non-negative, we must have $1-C \\ge 0$, which implies $C \\le 1$. The combined stability condition for this case is $0  C \\le 1$.\n\n**Case 2: $a  0$**\nFor negative advection speed, information propagates in the negative $x$ direction. The upwind scheme uses a forward difference for the spatial derivative:\n$$\nu_x \\approx \\frac{u_{j+1}^n - u_j^n}{\\Delta x}\n$$\nThe finite difference equation is:\n$$\n\\frac{u_j^{n+1} - u_j^n}{\\Delta t} + a \\frac{u_{j+1}^n - u_j^n}{\\Delta x} = 0\n$$\n$$\nu_j^{n+1} = u_j^n - C (u_{j+1}^n - u_j^n)\n$$\nSince $a  0$, we have $C  0$. Substituting the Fourier mode $u_j^n = \\hat{u}^n \\exp(i\\theta j)$ yields:\n$$\n\\hat{u}^{n+1} \\exp(i\\theta j) = \\hat{u}^n \\exp(i\\theta j) - C (\\hat{u}^n \\exp(i\\theta (j+1)) - \\hat{u}^n \\exp(i\\theta j))\n$$\nDividing by $\\hat{u}^n \\exp(i\\theta j)$:\n$$\nG(\\theta) = \\frac{\\hat{u}^{n+1}}{\\hat{u}^n} = 1 - C (\\exp(i\\theta) - 1)\n$$\nThe squared magnitude is:\n$$\n|G(\\theta)|^2 = |(1+C) - C \\exp(i\\theta)|^2 = |(1+C-C\\cos\\theta) - iC\\sin\\theta|^2\n$$\n$$\n|G(\\theta)|^2 = (1+C-C\\cos\\theta)^2 + (-C\\sin\\theta)^2\n$$\n$$\n|G(\\theta)|^2 = (1+C)^2 - 2C(1+C)\\cos\\theta + C^2\\cos^2\\theta + C^2\\sin^2\\theta\n$$\n$$\n|G(\\theta)|^2 = 1 + 2C + 2C^2 - 2C(1+C)\\cos\\theta = 1 + 2C(1+C)(1-\\cos\\theta)\n$$\nThe stability condition $|G(\\theta)|^2 \\le 1$ implies:\n$$\n1 + 2C(1+C)(1-\\cos\\theta) \\le 1\n$$\n$$\n2C(1+C)(1-\\cos\\theta) \\le 0\n$$\nAs before, since $(1-\\cos\\theta) \\ge 0$, the inequality simplifies to:\n$$\nC(1+C) \\le 0\n$$\nGiven that we are in the case $a  0$, we have $C  0$. Thus, for the product to be non-positive, we must have $1+C \\ge 0$, which implies $C \\ge -1$. The combined stability condition for this case is $-1 \\le C  0$.\n\n**Combined Stability Constraint**\nThe stability condition is $0  C \\le 1$ when $a0$, and $-1 \\le C  0$ when $a0$. These two conditions can be unified.\nFor $a  0$, $C = \\frac{a\\Delta t}{\\Delta x}  0$. The condition $C \\le 1$ becomes $\\frac{a\\Delta t}{\\Delta x} \\le 1$.\nFor $a  0$, $C = \\frac{a\\Delta t}{\\Delta x}  0$. The condition $C \\ge -1$ becomes $\\frac{a\\Delta t}{\\Delta x} \\ge -1$, which is equivalent to $-\\frac{a\\Delta t}{\\Delta x} \\le 1$.\nNoting that for $a0$, $|a| = a$, and for $a0$, $|a| = -a$, both conditions can be expressed in a single, compact form:\n$$\n\\frac{|a|\\Delta t}{\\Delta x} \\le 1\n$$\nThis is the sharp necessary and sufficient stability constraint for the first-order upwind scheme.\n\n**Maximal Allowable Time Step**\nTo find the maximal allowable time step, $\\Delta t_{\\max}$, we solve the stability inequality for $\\Delta t$. Assuming $a \\neq 0$:\n$$\n\\Delta t \\le \\frac{\\Delta x}{|a|}\n$$\nThe maximal value of $\\Delta t$ that guarantees stability for all wavenumbers is therefore:\n$$\n\\Delta t_{\\max} = \\frac{\\Delta x}{|a|}\n$$\nThis result is the celebrated Courant-Friedrichs-Lewy (CFL) condition for this specific numerical scheme. It states that the time step must be small enough so that the domain of dependence of the numerical scheme contains the domain of dependence of the PDE. In one time step, a fluid particle travels a distance $|a|\\Delta t$, and this must be less than or equal to one grid spacing $\\Delta x$.", "answer": "$$\n\\boxed{\\frac{\\Delta x}{|a|}}\n$$", "id": "3375615"}, {"introduction": "Having established the CFL condition for a classic hyperbolic problem, we now broaden our conceptual understanding. This practice challenges you to compare the stability requirements for hyperbolic (advection) and parabolic (diffusion) equations [@problem_id:3375540]. By examining why the time step restriction for diffusion, which scales with $(\\Delta x)^2$, is still considered a \"CFL-like\" condition, you will uncover a more profound principle: stability constraints in explicit schemes are fundamentally tied to the spectral radius of the discrete spatial operator, regardless of the underlying physics.", "problem": "Consider the linear constant-coefficient scalar advection equation $u_t + a\\,u_x = 0$ and the heat equation $u_t = \\nu\\,u_{xx}$ on a uniform one-dimensional spatial grid with spacing $\\Delta x$ and explicit time stepping with step $\\Delta t$. For advection, use an upwind spatial discretization consistent with the sign of $a$ and forward Euler time integration; for diffusion, use Forward-Time Centered-Space (FTCS) with forward Euler in time and the standard second-difference approximation in space. Perform a Fourier (von Neumann) stability analysis for each scheme by considering a single Fourier mode $u_j^n = \\hat{u}^n\\,e^{\\mathrm{i} j \\theta}$, and derive the conditions on $\\Delta t$ in terms of $\\Delta x$, $|a|$, and $\\nu$ that guarantee linear stability. Then, interpret and compare the resulting time-step restrictions. In particular, clarify why the advection bound, often expressed through the Courant-Friedrichs-Lewy (CFL) number $|a|\\,\\Delta t/\\Delta x$, and the diffusive bound, often expressed through $\\nu\\,\\Delta t/(\\Delta x)^2$, are both referred to as CFL-like conditions even though they scale differently with $\\Delta x$.\n\nChoose all statements that are correct:\n\nA. The advection stability restriction can be written as $|a|\\,\\Delta t/\\Delta x \\leq 1$ for the explicit upwind scheme, and the diffusion stability restriction can be written as $\\nu\\,\\Delta t/(\\Delta x)^2 \\leq 1/2$ for FTCS; the latter is CFL-like because it limits $\\Delta t$ by the inverse of the grid-dependent spectral radius of the discrete operator, which scales as $O(1/(\\Delta x)^2)$.\n\nB. The diffusive restriction is not CFL-like because diffusion has infinite physical propagation speed; therefore, explicit time stepping imposes no upper bound on $\\Delta t$.\n\nC. Both advection and diffusion restrictions are merely consistency requirements, not stability requirements; they can be violated without instability provided the grid is sufficiently refined.\n\nD. Both restrictions can be viewed as consequences of applying forward Euler to the semi-discrete system $u'(t) = L\\,u(t)$: the spectrum of the discrete advection operator scales like $O(|a|/\\Delta x)$, while that of the discrete Laplacian scales like $O(\\nu/(\\Delta x)^2)$; bounding $\\Delta t$ by the inverse of these scales yields CFL-like conditions with different $\\Delta x$ dependence.\n\nE. For advection, switching from an upwind to a centered difference in space makes the amplification factor unitary for all $\\Delta t$, so the explicit centered scheme becomes unconditionally stable.\n\nSelect all that apply.", "solution": "The problem asks for a stability analysis of two common numerical schemes for the linear advection and heat equations, and an interpretation of the resulting stability conditions, particularly regarding the term \"CFL-like\".\n\nFirst, a validation of the problem statement is performed.\n**Step 1: Extract Givens**\n-   Equation 1: Linear advection, $u_t + a\\,u_x = 0$.\n-   Equation 2: Heat equation, $u_t = \\nu\\,u_{xx}$.\n-   Grid: Uniform 1D, spatial spacing $\\Delta x$, time step $\\Delta t$.\n-   Scheme for Advection: Explicit upwind in space (consistent with the sign of $a$), Forward Euler in time.\n-   Scheme for Diffusion: Forward-Time Centered-Space (FTCS), which is Forward Euler in time and a standard centered second-difference in space.\n-   Analysis Method: Fourier (von Neumann) stability analysis using the mode $u_j^n = \\hat{u}^n\\,e^{\\mathrm{i} j \\theta}$, where $\\theta = k_m \\Delta x$ for a wavenumber $k_m$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, utilizing standard model PDEs (advection and heat equations) and fundamental numerical methods (upwind, FTCS, von Neumann analysis). It is well-posed, providing all necessary information to perform the requested derivations and an interpretative comparison. The language used is objective and precise. The problem does not violate any of the invalidity criteria. It is a standard, non-trivial exercise in the numerical analysis of partial differential equations.\n\n**Step 3: Verdict and Action**\nThe problem is **valid**. A full derivation and evaluation of options will be performed.\n\n**Derivation of Stability Conditions**\n\n**1. Advection Equation: $u_t + a\\,u_x = 0$ with Explicit Upwind Scheme**\n\nThe discretization must be consistent with the sign of the advection speed $a$.\n\nCase 1: $a  0$. The upwind direction is from the left, so we use a backward difference for the spatial derivative $u_x$:\n$$\n\\frac{u_j^{n+1} - u_j^n}{\\Delta t} + a \\frac{u_j^n - u_{j-1}^n}{\\Delta x} = 0\n$$\nRearranging for the next time step, $u_j^{n+1}$:\n$$\nu_j^{n+1} = u_j^n - \\frac{a \\Delta t}{\\Delta x} (u_j^n - u_{j-1}^n)\n$$\nLet the Courant number be $C = \\frac{a \\Delta t}{\\Delta x}$. Since $a0$, we have $C0$.\n$$\nu_j^{n+1} = (1-C) u_j^n + C u_{j-1}^n\n$$\nWe substitute the Fourier mode $u_j^n = G^n \\hat{u}_0 e^{\\mathrm{i} j \\theta}$, where $G$ is the amplification factor.\n$$\nG^{n+1} e^{\\mathrm{i} j \\theta} = (1-C) G^n e^{\\mathrm{i} j \\theta} + C G^n e^{\\mathrm{i} (j-1) \\theta}\n$$\nDividing by $G^n e^{\\mathrm{i} j \\theta}$:\n$$\nG = (1-C) + C e^{-\\mathrm{i} \\theta} = 1 - C + C(\\cos\\theta - \\mathrm{i}\\sin\\theta)\n$$\nFor stability, we require $|G| \\leq 1$ for all $\\theta \\in [-\\pi, \\pi]$.\n$$\n|G|^2 = (1 - C + C\\cos\\theta)^2 + (-C\\sin\\theta)^2 = (1-C)^2 + 2C(1-C)\\cos\\theta + C^2\\cos^2\\theta + C^2\\sin^2\\theta\n$$\n$$\n|G|^2 = (1-C)^2 + 2C(1-C)\\cos\\theta + C^2 = 1 - 2C + 2C^2 + 2C(1-C)\\cos\\theta\n$$\n$$\n|G|^2 = 1 + 2C(C-1) - 2C(C-1)(-\\cos\\theta) = 1 + 2C(C-1)(1-\\cos\\theta)\n$$\nSince $C  0$ and $(1-\\cos\\theta) \\ge 0$, for $|G|^2 \\le 1$ we must have $C-1 \\le 0$, which implies $C \\le 1$. Thus, the stability condition is $0 \\le \\frac{a \\Delta t}{\\Delta x} \\le 1$.\n\nCase 2: $a  0$. The upwind direction is from the right, so we use a forward difference for $u_x$:\n$$\n\\frac{u_j^{n+1} - u_j^n}{\\Delta t} + a \\frac{u_{j+1}^n - u_j^n}{\\Delta x} = 0\n$$\nThe Courant number $C = \\frac{a \\Delta t}{\\Delta x}$ is now negative.\n$$\nu_j^{n+1} = (1+C)u_j^n - C u_{j+1}^n\n$$\nSubstituting the Fourier mode gives the amplification factor:\n$$\nG = (1+C) - C e^{\\mathrm{i} \\theta}\n$$\nA similar calculation yields $|G|^2 = 1 + 2C(C+1)(1-\\cos\\theta)$.\nSince $C  0$ and $(1-\\cos\\theta) \\ge 0$, for $|G|^2 \\le 1$ we must have $C+1 \\ge 0$, which implies $C \\ge -1$. The stability condition is $-1 \\le \\frac{a \\Delta t}{\\Delta x} \\le 0$.\n\nCombining both cases, the stability condition for the explicit upwind scheme is:\n$$\n\\left| \\frac{a \\Delta t}{\\Delta x} \\right| \\le 1 \\quad \\text{or} \\quad \\frac{|a| \\Delta t}{\\Delta x} \\le 1\n$$\n\n**2. Heat Equation: $u_t = \\nu u_{xx}$ with FTCS Scheme**\n\nThe FTCS scheme uses Forward Euler in time and a centered second difference in space:\n$$\n\\frac{u_j^{n+1} - u_j^n}{\\Delta t} = \\nu \\frac{u_{j+1}^n - 2u_j^n + u_{j-1}^n}{(\\Delta x)^2}\n$$\nLet the diffusion number be $d = \\frac{\\nu \\Delta t}{(\\Delta x)^2}$. For physical diffusion, $\\nu  0$, so $d  0$.\n$$\nu_j^{n+1} = u_j^n + d(u_{j+1}^n - 2u_j^n + u_{j-1}^n) = (1-2d)u_j^n + d(u_{j+1}^n + u_{j-1}^n)\n$$\nSubstituting the Fourier mode $u_j^n = G^n \\hat{u}_0 e^{\\mathrm{i} j \\theta}$:\n$$\nG e^{\\mathrm{i} j \\theta} = (1-2d)e^{\\mathrm{i} j \\theta} + d(e^{\\mathrm{i} (j+1) \\theta} + e^{\\mathrm{i} (j-1) \\theta})\n$$\nDividing by $e^{\\mathrm{i} j \\theta}$:\n$$\nG = (1-2d) + d(e^{\\mathrm{i}\\theta} + e^{-\\mathrm{i}\\theta}) = 1 - 2d + d(2\\cos\\theta) = 1 + 2d(\\cos\\theta - 1)\n$$\nUsing the identity $1 - \\cos\\theta = 2\\sin^2(\\theta/2)$:\n$$\nG = 1 - 4d\\sin^2(\\theta/2)\n$$\nSince $G$ is real, the stability condition $|G| \\le 1$ is equivalent to $-1 \\le G \\le 1$.\nThe upper bound, $G \\le 1$, is always satisfied because $d0$ and $\\sin^2(\\theta/2) \\ge 0$.\nThe lower bound requires $G \\ge -1$:\n$$\n1 - 4d\\sin^2(\\theta/2) \\ge -1 \\implies 2 \\ge 4d\\sin^2(\\theta/2) \\implies d \\le \\frac{1}{2\\sin^2(\\theta/2)}\n$$\nThis condition must hold for all $\\theta$. The most restrictive case is when $\\sin^2(\\theta/2)$ is maximum, which is $\\sin^2(\\theta/2) = 1$ (for the highest frequency mode $\\theta=\\pi$). This leads to the stability condition:\n$$\nd \\le \\frac{1}{2} \\quad \\text{or} \\quad \\frac{\\nu \\Delta t}{(\\Delta x)^2} \\le \\frac{1}{2}\n$$\n\n**Interpretation of \"CFL-like\" Conditions**\n\nThe term \"CFL condition\" originally stems from the domain-of-dependence argument for hyperbolic equations, which gives the $|a|\\Delta t/\\Delta x \\le 1$ criterion. However, in modern numerical analysis, the term is often used more broadly to describe any stability restriction on the time step $\\Delta t$ for an explicit time integration scheme that depends on the spatial step $\\Delta x$.\n\nThis broader view is best understood by considering the method of lines. Discretizing in space first yields a system of ordinary differential equations (ODEs), $\\frac{d\\vec{u}}{dt} = L_h \\vec{u}$, where $L_h$ is the matrix representing the discrete spatial operator. Applying Forward Euler yields $\\vec{u}^{n+1} = (I + \\Delta t L_h)\\vec{u}^n$. Stability requires that the eigenvalues of the amplification matrix, $1 + \\Delta t \\lambda_k$ (where $\\lambda_k$ are the eigenvalues of $L_h$), have magnitude no greater than $1$. This means $\\Delta t \\lambda_k$ must lie in the stability region of Forward Euler, which is a disk of radius $1$ centered at $(-1, 0)$ in the complex plane. This imposes a bound of the form $\\Delta t \\le C / \\rho(L_h)$, where $\\rho(L_h) = \\max_k |\\lambda_k|$ is the spectral radius of $L_h$.\n\n-   For the upwind advection operator, the eigenvalues $\\lambda(\\theta)$ have a maximum magnitude (spectral radius) that scales as $\\rho(L_h) \\sim O(|a|/\\Delta x)$. This leads to a stability limit $\\Delta t \\le \\text{const} \\cdot \\Delta x / |a|$, which is the classic CFL condition.\n-   For the FTCS diffusion operator, the eigenvalues $\\lambda(\\theta)$ are real and negative, and the spectral radius scales as $\\rho(L_h) \\sim O(\\nu/(\\Delta x)^2)$. This leads to a stability limit $\\Delta t \\le \\text{const} \\cdot (\\Delta x)^2 / \\nu$.\n\nBoth conditions are thus \"CFL-like\" in that they constrain $\\Delta t$ based on the spectral radius (the highest \"frequency\") of the semi-discrete operator. The difference in scaling with $\\Delta x$ is a direct result of the different order of the spatial derivatives being approximated.\n\n**Evaluation of Options**\n\nA. **The advection stability restriction can be written as $|a|\\,\\Delta t/\\Delta x \\leq 1$ for the explicit upwind scheme, and the diffusion stability restriction can be written as $\\nu\\,\\Delta t/(\\Delta x)^2 \\leq 1/2$ for FTCS; the latter is CFL-like because it limits $\\Delta t$ by the inverse of the grid-dependent spectral radius of the discrete operator, which scales as $O(1/(\\Delta x)^2)$.**\nOur derivations confirm both stability restrictions, $|a|\\Delta t/\\Delta x \\le 1$ and $\\nu\\Delta t/(\\Delta x)^2 \\le 1/2$. The interpretation of the diffusive condition as \"CFL-like\" due to its dependence on the inverse of the spectral radius of the discrete Laplacian (which scales as $O(\\nu/(\\Delta x)^2)$) is accurate and aligns with the modern understanding of stability for explicit schemes.\n**Verdict: Correct.**\n\nB. **The diffusive restriction is not CFL-like because diffusion has infinite physical propagation speed; therefore, explicit time stepping imposes no upper bound on $\\Delta t$.**\nThe premise that the original CFL argument from domain-of-dependence does not strictly apply to parabolic equations is correct. However, the conclusion that \"explicit time stepping imposes no upper bound on $\\Delta t$\" is false. Our derivation clearly shows the FTCS scheme is conditionally stable with the restriction $\\Delta t \\le (\\Delta x)^2 / (2\\nu)$.\n**Verdict: Incorrect.**\n\nC. **Both advection and diffusion restrictions are merely consistency requirements, not stability requirements; they can be violated without instability provided the grid is sufficiently refined.**\nThis statement incorrectly conflates consistency and stability. The derived conditions are specifically for stability. Violating them leads to numerical instability, where errors grow exponentially. The claim that violation is permissible with grid refinement is the opposite of the truth; a finer grid (smaller $\\Delta x$) requires an even smaller $\\Delta t$ to maintain stability.\n**Verdict: Incorrect.**\n\nD. **Both restrictions can be viewed as consequences of applying forward Euler to the semi-discrete system $u'(t) = L\\,u(t)$: the spectrum of the discrete advection operator scales like $O(|a|/\\Delta x)$, while that of the discrete Laplacian scales like $O(\\nu/(\\Delta x)^2)$; bounding $\\Delta t$ by the inverse of these scales yields CFL-like conditions with different $\\Delta x$ dependence.**\nThis statement provides an elegant and accurate unification of the two stability conditions through the method of lines. It correctly identifies the scaling of the spectral radii of the semi-discrete operators for upwind advection ($O(|a|/\\Delta x)$) and centered diffusion ($O(\\nu/(\\Delta x)^2)$). It correctly concludes that the stability requirement of the time integrator (Forward Euler) couples $\\Delta t$ to the inverse of these scales, thus explaining the different dependencies on $\\Delta x$.\n**Verdict: Correct.**\n\nE. **For advection, switching from an upwind to a centered difference in space makes the amplification factor unitary for all $\\Delta t$, so the explicit centered scheme becomes unconditionally stable.**\nLet's analyze the FTCS scheme for advection: $\\frac{u_j^{n+1}-u_j^n}{\\Delta t} + a \\frac{u_{j+1}^n - u_{j-1}^n}{2\\Delta x} = 0$. The amplification factor is $G = 1 - \\mathrm{i} \\frac{a \\Delta t}{\\Delta x} \\sin\\theta$. The magnitude squared is $|G|^2 = 1 + (\\frac{a \\Delta t}{\\Delta x} \\sin\\theta)^2$. For any $\\Delta t  0$ and any mode with $\\sin\\theta \\ne 0$, we have $|G|  1$. The scheme is therefore unconditionally unstable, not unconditionally stable. The amplification factor is not unitary ($|G| \\ne 1$).\n**Verdict: Incorrect.**", "answer": "$$\\boxed{AD}$$", "id": "3375540"}, {"introduction": "This final practice bridges the gap between theoretical derivation and practical implementation, a crucial step for any computational scientist. Here, you are tasked with developing a program to determine a globally stable time step for a Finite-Difference Time-Domain (FDTD) simulation on a complex, heterogeneous grid [@problem_id:3296724]. This exercise requires you to translate the CFL stability formula into a robust algorithm that scans a grid with varying material properties and cell sizes, identifying the most restrictive local condition to ensure stability for the entire simulation domain.", "problem": "You are asked to design a program that computes a conservative global time step for an explicit Finite-Difference Time-Domain (FDTD) discretization of Maxwell's equations on heterogeneous grids, based on the Courant-Friedrichs-Lewy (CFL) stability condition. Begin from the differential form of Maxwell's equations and the discrete leapfrog update structure of the Yee scheme. From this foundation, derive the stability requirement that constrains the time step in terms of the local wave speed and the discrete spatial derivatives. Then, implement a program that, for each provided test case, scans the grid elementwise, forms a local bound on the time step from the most restrictive condition, and returns a single conservative global time step that is valid for the entire grid.\n\nStart from fundamental electromagnetic laws and definitions and proceed to the numerical stability requirement. The foundational base must include:\n- Maxwell's equations in differential form and constitutive relations linking the electric field to permittivity and the magnetic field to permeability, together with the local wave speed relation $v = 1/\\sqrt{\\mu \\epsilon}$.\n- The explicit time-stepping structure of the Yee FDTD scheme in $d$ spatial dimensions with staggered electric and magnetic fields.\n\nYour derivation must explain why the explicit update induces a constraint on the time step and how heterogeneity in space (through varying local wave speeds and varying grid spacings) leads to a most restrictive bound that determines a single global time step. Do not present shortcut formulas or provide hints that simplify the derivation pathway; instead, start from the base concepts described and derive the stability constraint logically.\n\nAfter completing the derivation, implement a program that, for each test case specified below, computes a conservative global time step by scanning all grid elements and using the most restrictive local CFL bound to set the global time step. The program should handle $d=1$, $d=2$, and $d=3$ dimensions. For each grid element, consider the local wave speed $v$ and the local spatial increments in each active dimension. The output for each test case must be a single floating-point number representing the time step in seconds, rounded to $12$ decimal places, and the final printed output must be a single line containing all test case results in a comma-separated list enclosed in square brackets.\n\nPhysical units are mandatory: spatial increments must be in meters, wave speeds must be in meters per second, and the time step must be reported in seconds. Angles are not involved. The results should be floats.\n\nTest Suite:\n- Test Case $1$ (three dimensions, heterogeneous grid, moderate variability):\n  - Dimension: $d=3$.\n  - Grid shape: $2\\times 2\\times 2$.\n  - Local wave speed array $v$ in meters per second: a $2\\times 2\\times 2$ array\n    $$\n    v = \\begin{bmatrix}\n    \\begin{bmatrix} 2.0\\times 10^{8}  2.5\\times 10^{8} \\\\ 3.0\\times 10^{8}  1.8\\times 10^{8} \\end{bmatrix} \n    \\begin{bmatrix} 1.5\\times 10^{8}  3.0\\times 10^{8} \\\\ 2.2\\times 10^{8}  2.8\\times 10^{8} \\end{bmatrix}\n    \\end{bmatrix}.\n    $$\n  - Local spatial increments in meters: $2\\times 2\\times 2$ arrays\n    $$\n    \\Delta x = \\begin{bmatrix}\n    \\begin{bmatrix} 1.0\\times 10^{-3}  1.0\\times 10^{-3} \\\\ 1.0\\times 10^{-3}  1.0\\times 10^{-3} \\end{bmatrix} \n    \\begin{bmatrix} 1.0\\times 10^{-3}  1.0\\times 10^{-3} \\\\ 1.0\\times 10^{-3}  1.0\\times 10^{-3} \\end{bmatrix}\n    \\end{bmatrix},\n    $$\n    $$\n    \\Delta y = \\begin{bmatrix}\n    \\begin{bmatrix} 1.2\\times 10^{-3}  1.2\\times 10^{-3} \\\\ 1.0\\times 10^{-3}  0.9\\times 10^{-3} \\end{bmatrix} \n    \\begin{bmatrix} 1.1\\times 10^{-3}  1.0\\times 10^{-3} \\\\ 1.0\\times 10^{-3}  1.0\\times 10^{-3} \\end{bmatrix}\n    \\end{bmatrix},\n    $$\n    $$\n    \\Delta z = \\begin{bmatrix}\n    \\begin{bmatrix} 0.9\\times 10^{-3}  1.1\\times 10^{-3} \\\\ 1.3\\times 10^{-3}  1.0\\times 10^{-3} \\end{bmatrix} \n    \\begin{bmatrix} 1.0\\times 10^{-3}  1.0\\times 10^{-3} \\\\ 1.0\\times 10^{-3}  0.8\\times 10^{-3} \\end{bmatrix}\n    \\end{bmatrix}.\n    $$\n  - Safety factor (unitless): $\\sigma = 0.95$.\n\n- Test Case $2$ (three dimensions, pronounced anisotropy in one direction):\n  - Dimension: $d=3$.\n  - Grid shape: $2\\times 2\\times 1$.\n  - Local wave speed array $v$ in meters per second:\n    $$\n    v = \\begin{bmatrix}\n    \\begin{bmatrix} 3.0\\times 10^{8}  2.5\\times 10^{8} \\\\ 3.0\\times 10^{8}  2.0\\times 10^{8} \\end{bmatrix}\n    \\end{bmatrix}.\n    $$\n  - Local spatial increments in meters:\n    $$\n    \\Delta x = \\begin{bmatrix}\n    \\begin{bmatrix} 1.0\\times 10^{-3}  1.0\\times 10^{-3} \\\\ 1.0\\times 10^{-3}  1.0\\times 10^{-3} \\end{bmatrix}\n    \\end{bmatrix},\\quad\n    \\Delta y = \\begin{bmatrix}\n    \\begin{bmatrix} 0.2\\times 10^{-3}  1.5\\times 10^{-3} \\\\ 0.2\\times 10^{-3}  1.5\\times 10^{-3} \\end{bmatrix}\n    \\end{bmatrix},\\quad\n    \\Delta z = \\begin{bmatrix}\n    \\begin{bmatrix} 1.0\\times 10^{-3}  1.0\\times 10^{-3} \\\\ 1.0\\times 10^{-3}  1.0\\times 10^{-3} \\end{bmatrix}\n    \\end{bmatrix}.\n    $$\n  - Safety factor (unitless): $\\sigma = 1.0$.\n\n- Test Case $3$ (two dimensions, mixed spacings):\n  - Dimension: $d=2$.\n  - Grid shape: $3\\times 2$.\n  - Local wave speed array $v$ in meters per second:\n    $$\n    v = \\begin{bmatrix}\n    \\begin{bmatrix} 1.5\\times 10^{8}  2.0\\times 10^{8}  2.5\\times 10^{8} \\\\ 1.8\\times 10^{8}  2.2\\times 10^{8}  2.6\\times 10^{8} \\end{bmatrix}\n    \\end{bmatrix}.\n    $$\n  - Local spatial increments in meters:\n    $$\n    \\Delta x = \\begin{bmatrix}\n    \\begin{bmatrix} 0.5\\times 10^{-3}  0.3\\times 10^{-3}  0.4\\times 10^{-3} \\\\ 0.6\\times 10^{-3}  0.4\\times 10^{-3}  0.5\\times 10^{-3} \\end{bmatrix}\n    \\end{bmatrix},\\quad\n    \\Delta y = \\begin{bmatrix}\n    \\begin{bmatrix} 0.6\\times 10^{-3}  0.7\\times 10^{-3}  0.6\\times 10^{-3} \\\\ 0.5\\times 10^{-3}  0.8\\times 10^{-3}  0.7\\times 10^{-3} \\end{bmatrix}\n    \\end{bmatrix}.\n    $$\n  - Safety factor (unitless): $\\sigma = 0.98$.\n\n- Test Case $4$ (one dimension, heterogeneous medium):\n  - Dimension: $d=1$.\n  - Grid shape: $5$.\n  - Local wave speed array $v$ in meters per second:\n    $$\n    v = \\begin{bmatrix} 1.0\\times 10^{8}  1.5\\times 10^{8}  2.0\\times 10^{8}  2.5\\times 10^{8}  3.0\\times 10^{8} \\end{bmatrix}.\n    $$\n  - Local spatial increments in meters:\n    $$\n    \\Delta x = \\begin{bmatrix} 1.0\\times 10^{-3}  0.9\\times 10^{-3}  0.8\\times 10^{-3}  0.7\\times 10^{-3}  0.6\\times 10^{-3} \\end{bmatrix}.\n    $$\n  - Safety factor (unitless): $\\sigma = 1.0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For example, if there are four test cases with results $r_1$, $r_2$, $r_3$, and $r_4$, the output must be exactly of the form $[r_1,r_2,r_3,r_4]$ with each $r_i$ a floating-point number in seconds, rounded to $12$ decimal places.", "solution": "The user requests a comprehensive derivation of the Courant-Friedrichs-Lewy (CFL) stability condition for the Finite-Difference Time-Domain (FDTD) method on heterogeneous grids, followed by a program to compute the global time step for several test cases.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- **Topic**: Courant-Friedrichs-Lewy (CFL) stability condition for FDTD in computational electromagnetics.\n- **Starting Point**: Maxwell's equations in differential form, constitutive relations, local wave speed $v = 1/\\sqrt{\\mu \\epsilon}$, and the explicit leapfrog structure of the Yee FDTD scheme.\n- **Task**: Derive the stability requirement, explain its application to heterogeneous grids, and implement a program to compute a conservative global time step.\n- **Dimensionality**: The program must handle $d=1$, $d=2$, and $d=3$ spatial dimensions.\n- **Test Cases**: Four test cases are provided, each with:\n    - Dimension $d$.\n    - Grid shape.\n    - Local wave speed array $v$ (in m/s).\n    - Local spatial increment arrays $\\Delta x$, $\\Delta y$, $\\Delta z$ (in m).\n    - A unitless safety factor $\\sigma$.\n- **Output Format**: A single line containing a comma-separated list of floating-point results (rounded to $12$ decimal places) enclosed in square brackets.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded**: The problem is based on fundamental principles of electromagnetism (Maxwell's equations) and numerical analysis (FDTD method, Yee scheme, von Neumann stability analysis). These are well-established and core concepts in physics and engineering. The problem is scientifically sound.\n- **Well-Posed**: The problem asks for the calculation of a single value (conservative global time step) based on a well-defined procedure: finding the minimum of local stability limits over a discrete, finite grid. This procedure guarantees the existence, uniqueness, and stability of the solution.\n- **Objective**: All parameters are given as precise numerical values. The task is objective and free of subjective interpretation.\n- **Completeness**: The problem provides all necessary data for each test case, including material properties (via wave speed $v$), grid geometry (via $\\Delta x, \\Delta y, \\Delta z$), and numerical parameters ($\\sigma$). The derivation path is clearly prescribed.\n- **Other Flaws**: The problem does not exhibit any of the listed flaws. It is not metaphorical, trivial, contradictory, or unverifiable. The setup is realistic for typical FDTD simulations.\n\n**Step 3: Verdict and Action**\nThe problem is **valid**. A complete, reasoned solution will be provided.\n\n### Derivation of the CFL Stability Condition for FDTD\n\nThe foundation of computational electromagnetics for time-domain problems rests on Maxwell's equations. In a source-free, linear, isotropic, and non-dispersive medium, they are given by:\n$$ \\nabla \\times \\vec{E} = - \\frac{\\partial \\vec{B}}{\\partial t} \\quad (1) $$\n$$ \\nabla \\times \\vec{H} = \\frac{\\partial \\vec{D}}{\\partial t} \\quad (2) $$\nThe electric field $\\vec{E}$ and magnetic field $\\vec{H}$ are related to the electric flux density $\\vec{D}$ and magnetic flux density $\\vec{B}$ through the constitutive relations:\n$$ \\vec{D} = \\epsilon \\vec{E} \\quad (3) $$\n$$ \\vec{B} = \\mu \\vec{H} \\quad (4) $$\nwhere $\\epsilon$ is the electric permittivity and $\\mu$ is the magnetic permeability of the medium. Substituting $(3)$ and $(4)$ into $(1)$ and $(2)$ yields:\n$$ \\frac{\\partial \\vec{E}}{\\partial t} = \\frac{1}{\\epsilon} (\\nabla \\times \\vec{H}) \\quad (5) $$\n$$ \\frac{\\partial \\vec{H}}{\\partial t} = - \\frac{1}{\\mu} (\\nabla \\times \\vec{E}) \\quad (6) $$\nThese coupled first-order partial differential equations describe the propagation of electromagnetic waves. By taking the curl of equation $(1)$ and substituting $(2)$, one can derive the wave equation, which shows that waves propagate at a speed $v = 1/\\sqrt{\\mu\\epsilon}$.\n\nThe Finite-Difference Time-Domain (FDTD) method, specifically the Yee scheme, solves these equations numerically. The key idea is to discretize both space and time and evaluate the $\\vec{E}$ and $\\vec{H}$ fields on a staggered grid, known as the Yee cell. The electric field components are located on the edges of a conceptual grid cell, while the magnetic field components are on the faces. This spatial staggering allows for a natural and accurate evaluation of the curl operator using central differences. Furthermore, the fields are updated in a leapfrog manner in time: $\\vec{E}$-fields are evaluated at integer time steps ($n\\Delta t$) and $\\vec{H}$-fields at half-integer time steps ($(n \\pm 1/2)\\Delta t$).\n\nLet's write the update equation for one component, for example, $E_x$, in a $3$-dimensional grid. Using central differences for both time and space derivatives, equation $(5)$ becomes:\n$$ \\frac{E_x^{n+1}|_{i+\\frac{1}{2},j,k} - E_x^{n}|_{i+\\frac{1}{2},j,k}}{\\Delta t} = \\frac{1}{\\epsilon} \\left( \\frac{H_z^{n+\\frac{1}{2}}|_{i+\\frac{1}{2},j+\\frac{1}{2},k} - H_z^{n+\\frac{1}{2}}|_{i+\\frac{1}{2},j-\\frac{1}{2},k}}{\\Delta y} - \\frac{H_y^{n+\\frac{1}{2}}|_{i+\\frac{1}{2},j,k+\\frac{1}{2}} - H_y^{n+\\frac{1}{2}}|_{i+\\frac{1}{2},j,k-\\frac{1}{2}}}{\\Delta z} \\right) $$\nThis is an explicit update: the \"future\" value $E_x^{n+1}$ is computed solely from \"past\" values ($E_x^n$ and $H^{n+1/2}$). This explicit nature imposes a constraint on the time step $\\Delta t$ for the numerical solution to remain stable. If $\\Delta t$ is too large, numerical errors can grow exponentially, rendering the simulation useless. The Courant-Friedrichs-Lewy (CFL) condition provides this stability bound.\n\nTo derive the condition, we perform a von Neumann stability analysis. We assume a plane-wave solution for the fields on the discrete grid. For a uniform grid section with spacings $\\Delta x$, $\\Delta y$, $\\Delta z$, a generic field component $F$ can be written as:\n$$ F^{n}|_{i,j,k} = F_0 \\, G^n \\, e^{I(k_x i \\Delta x + k_y j \\Delta y + k_z k \\Delta z)} $$\nHere, $F_0$ is the amplitude, $\\vec{k} = (k_x, k_y, k_z)$ is the wavevector, $I = \\sqrt{-1}$, and $G = e^{-I\\omega_{num} \\Delta t}$ is the amplification or growth factor, where $\\omega_{num}$ is the numerical angular frequency. For stability, the magnitude of the growth factor must not exceed unity for any possible wavevector $\\vec{k}$, i.e., $|G| \\le 1$.\n\nSubstituting the plane-wave ansatz into the full set of discretized Maxwell's equations leads to the numerical dispersion relation. A more direct path involves combining the update equations. We can express the discretized $\\vec{E}$ and $\\vec{H}$ leapfrog updates symbolically as:\n$$ \\vec{E}^{n+1} = \\vec{E}^n + \\frac{\\Delta t}{\\epsilon} \\vec{\\nabla}_d \\times \\vec{H}^{n+\\frac{1}{2}} $$\n$$ \\vec{H}^{n+\\frac{1}{2}} = \\vec{H}^{n-\\frac{1}{2}} - \\frac{\\Delta t}{\\mu} \\vec{\\nabla}_d \\times \\vec{E}^{n} $$\nSubstituting the second equation into a time-shifted version of the first gives a discrete wave equation for $\\vec{E}$:\n$$ \\frac{\\vec{E}^{n+1} - 2\\vec{E}^n + \\vec{E}^{n-1}}{(\\Delta t)^2} = \\frac{1}{\\epsilon\\mu} \\vec{\\nabla}_d \\times (\\vec{\\nabla}_d \\times \\vec{E}^n) $$\nApplying the plane-wave form $E^n \\propto G^n$ yields:\n$$ \\frac{G - 2 + G^{-1}}{(\\Delta t)^2} = -v^2 |\\vec{K}|^2 $$\nwhere $v=1/\\sqrt{\\epsilon\\mu}$ and $\\vec{K}$ is the numerical wavevector whose components are $K_x = \\frac{2}{\\Delta x}\\sin(\\frac{k_x \\Delta x}{2})$, $K_y = \\frac{2}{\\Delta y}\\sin(\\frac{k_y \\Delta y}{2})$, and $K_z = \\frac{2}{\\Delta z}\\sin(\\frac{k_z \\Delta z}{2})$.\nRearranging the equation for $G$ gives:\n$$ G^2 - (2 - (v \\Delta t |\\vec{K}|)^2)G + 1 = 0 $$\nThis is a quadratic equation for $G$. For $|G| \\le 1$, the roots must be complex conjugates on the unit circle. This occurs when the discriminant of the quadratic equation is non-positive:\n$$ \\left(2 - (v \\Delta t |\\vec{K}|)^2\\right)^2 - 4 \\le 0 $$\n$$ -2 \\le 2 - (v \\Delta t |\\vec{K}|)^2 \\le 2 $$\n$$ 0 \\le (v \\Delta t |\\vec{K}|)^2 \\le 4 $$\nThe stability condition is therefore $v \\Delta t |\\vec{K}| \\le 2$. This must hold for all possible wavevectors $\\vec{k}$. The most restrictive condition on $\\Delta t$ arises from the maximum possible value of $|\\vec{K}|$. The maximum of $\\sin(\\theta)$ is $1$. This occurs for the highest frequency modes the grid can support (Nyquist frequency), where $k_x = \\pi/\\Delta x$, $k_y = \\pi/\\Delta y$, and $k_z = \\pi/\\Delta z$. In this worst-case scenario:\n$$ |\\vec{K}|_{max}^2 = \\left(\\frac{2}{\\Delta x}\\right)^2 + \\left(\\frac{2}{\\Delta y}\\right)^2 + \\left(\\frac{2}{\\Delta z}\\right)^2 $$\nSubstituting this into the stability condition $ (v \\Delta t |\\vec{K}|_{max})^2 \\le 4 $:\n$$ (v \\Delta t)^2 \\left( \\frac{4}{(\\Delta x)^2} + \\frac{4}{(\\Delta y)^2} + \\frac{4}{(\\Delta z)^2} \\right) \\le 4 $$\n$$ \\Delta t \\le \\frac{1}{v \\sqrt{\\left(\\frac{1}{\\Delta x}\\right)^2 + \\left(\\frac{1}{\\Delta y}\\right)^2 + \\left(\\frac{1}{\\Delta z}\\right)^2}} \\quad (7) $$\nThis is the CFL stability condition for a $3D$ FDTD simulation on a uniform grid. The conditions for $2D$ and $1D$ are obtained by removing the irrelevant spatial terms:\n$$ \\Delta t \\le \\frac{1}{v \\sqrt{\\left(\\frac{1}{\\Delta x}\\right)^2 + \\left(\\frac{1}{\\Delta y}\\right)^2}} \\quad (2D) $$\n$$ \\Delta t \\le \\frac{\\Delta x}{v} \\quad (1D) $$\n\nThe problem specifies a heterogeneous grid, where the local wave speed $v_{i,j,k}$ and grid spacings $\\Delta x_{i,j,k}, \\Delta y_{i,j,k}, \\Delta z_{i,j,k}$ vary with position. Since a single, global time step $\\Delta t$ is used for the entire simulation domain, this $\\Delta t$ must be small enough to ensure stability in every single cell. The overall stability is dictated by the \"weakest link\" in the grid: the cell that requires the smallest time step. This corresponds to the cell with the combination of highest wave speed and smallest grid spacings.\nTherefore, to find a conservative global time step for the entire grid, one must calculate the local stability limit for each cell $(i,j,k)$ and choose the minimum among them.\n$$ \\Delta t_{limit} = \\min_{i,j,k} \\left( \\Delta t_{local, i,j,k} \\right) $$\nwhere $\\Delta t_{local, i,j,k}$ is given by equation $(7)$ using the local parameters $v_{i,j,k}$, $\\Delta x_{i,j,k}$, etc.\n\nFinally, it is common practice to use a safety factor $\\sigma \\le 1$ to reduce the time step slightly below the theoretical maximum, providing a margin of safety against numerical artifacts not captured by this idealized analysis. The final computed time step is:\n$$ \\Delta t_{compute} = \\sigma \\times \\Delta t_{limit} $$\nThe program to be implemented will perform this element-wise scan, compute the minimum local time step limit, and apply the safety factor.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes a conservative global time step for FDTD simulations\n    on heterogeneous grids based on the CFL stability condition.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test Case 1: 3D, heterogeneous grid\n        {\n            \"d\": 3, \"sigma\": 0.95,\n            \"v\": np.array([\n                [[2.0e8, 2.5e8], [3.0e8, 1.8e8]],\n                [[1.5e8, 3.0e8], [2.2e8, 2.8e8]]\n            ]),\n            \"dx\": np.array([\n                [[1.0e-3, 1.0e-3], [1.0e-3, 1.0e-3]],\n                [[1.0e-3, 1.0e-3], [1.0e-3, 1.0e-3]]\n            ]),\n            \"dy\": np.array([\n                [[1.2e-3, 1.2e-3], [1.0e-3, 0.9e-3]],\n                [[1.1e-3, 1.0e-3], [1.0e-3, 1.0e-3]]\n            ]),\n            \"dz\": np.array([\n                [[0.9e-3, 1.1e-3], [1.3e-3, 1.0e-3]],\n                [[1.0e-3, 1.0e-3], [1.0e-3, 0.8e-3]]\n            ]),\n        },\n        # Test Case 2: 3D, anisotropic spacing\n        {\n            \"d\": 3, \"sigma\": 1.0,\n            \"v\": np.array([\n                [[3.0e8, 2.5e8], [3.0e8, 2.0e8]]\n            ]),\n            \"dx\": np.array([\n                [[1.0e-3, 1.0e-3], [1.0e-3, 1.0e-3]]\n            ]),\n            \"dy\": np.array([\n                [[0.2e-3, 1.5e-3], [0.2e-3, 1.5e-3]]\n            ]),\n            \"dz\": np.array([\n                [[1.0e-3, 1.0e-3], [1.0e-3, 1.0e-3]]\n            ]),\n        },\n        # Test Case 3: 2D, mixed spacings\n        {\n            \"d\": 2, \"sigma\": 0.98,\n            \"v\": np.array([\n                [1.5e8, 2.0e8, 2.5e8],\n                [1.8e8, 2.2e8, 2.6e8]\n            ]),\n            \"dx\": np.array([\n                [0.5e-3, 0.3e-3, 0.4e-3],\n                [0.6e-3, 0.4e-3, 0.5e-3]\n            ]),\n            \"dy\": np.array([\n                [0.6e-3, 0.7e-3, 0.6e-3],\n                [0.5e-3, 0.8e-3, 0.7e-3]\n            ]),\n        },\n        # Test Case 4: 1D, heterogeneous medium\n        {\n            \"d\": 1, \"sigma\": 1.0,\n            \"v\": np.array([1.0e8, 1.5e8, 2.0e8, 2.5e8, 3.0e8]),\n            \"dx\": np.array([1.0e-3, 0.9e-3, 0.8e-3, 0.7e-3, 0.6e-3]),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        d = case[\"d\"]\n        sigma = case[\"sigma\"]\n        v = case[\"v\"]\n\n        if d == 1:\n            dx = case[\"dx\"]\n            # CFL condition for 1D: dt = dx / v\n            local_dt_limits = dx / v\n        elif d == 2:\n            dx = case[\"dx\"]\n            dy = case[\"dy\"]\n            # Sum of inverse squared deltas for 2D\n            inv_deltas_sq = (1.0 / dx**2) + (1.0 / dy**2)\n            # CFL condition for 2D: dt = 1 / (v * sqrt(1/dx^2 + 1/dy^2))\n            local_dt_limits = 1.0 / (v * np.sqrt(inv_deltas_sq))\n        elif d == 3:\n            dx = case[\"dx\"]\n            dy = case[\"dy\"]\n            dz = case[\"dz\"]\n            # Sum of inverse squared deltas for 3D\n            inv_deltas_sq = (1.0 / dx**2) + (1.0 / dy**2) + (1.0 / dz**2)\n            # CFL condition for 3D: dt = 1 / (v * sqrt(1/dx^2 + 1/dy^2 + 1/dz^2))\n            local_dt_limits = 1.0 / (v * np.sqrt(inv_deltas_sq))\n        else:\n            raise ValueError(f\"Unsupported dimension d={d}\")\n\n        # The global time step limit is the minimum of all local limits.\n        min_dt_limit = np.min(local_dt_limits)\n        \n        # Apply the safety factor to get the final conservative time step.\n        final_dt = sigma * min_dt_limit\n        \n        # Round to 12 decimal places as specified.\n        results.append(round(final_dt, 12))\n\n    # Final print statement in the exact required format.\n    # Using 'g' format to avoid trailing zeros for simple numbers if they occur\n    # and to handle scientific notation, then converting to string.\n    # The `round` above already sets the precision.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3296724"}]}