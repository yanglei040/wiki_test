## Introduction
In [computational electromagnetics](@entry_id:269494), simulating how an object interacts with an incident electromagnetic wave is a canonical problem. A key challenge is to introduce a well-defined incident wave (like a plane wave) into the simulation domain while simultaneously isolating the scattered field generated by the object. The Total-Field/Scattered-Field (TFSF) boundary condition offers an elegant and powerful solution to this problem, partitioning the computational domain into a region containing the total field (incident + scattered) and a region containing only the scattered field. Mastering its implementation is essential for accurately modeling a wide range of scattering, antenna, and wave-matter interaction phenomena.

This article provides a comprehensive guide to understanding and implementing the TFSF boundary. We will build this knowledge across three interconnected chapters. First, the **Principles and Mechanisms** chapter will deconstruct the method's theoretical underpinnings, from the linearity of Maxwell's equations and the [equivalence principle](@entry_id:152259) to the discrete FDTD correction terms and proper wave sampling. Next, the **Applications and Interdisciplinary Connections** chapter will explore its practical use, covering verification, far-field analysis, and its extension to complex geometries and coupled-physics problems like plasma simulations. Finally, the **Hands-On Practices** section will present targeted exercises to solidify understanding of key implementation details, from deriving boundary signs to handling [numerical interpolation](@entry_id:166640). By progressing through these sections, you will gain the theoretical and practical expertise needed to effectively deploy the TFSF technique in your own electromagnetic simulations.

## Principles and Mechanisms

The Total-Field/Scattered-Field (TFSF) method provides a powerful and elegant framework for introducing a known incident wave into a computational domain while simultaneously isolating the fields scattered by an object. This separation is the cornerstone of many scattering and antenna problems in computational electromagnetics. To master its implementation, one must understand the fundamental principles of field superposition, the theoretical basis in the [electromagnetic equivalence principle](@entry_id:748885), and the practical details of its discrete realization within a time-domain numerical scheme.

### The Superposition Principle and Field Decomposition

The TFSF technique is founded on the **linearity** of Maxwell's equations in the media under consideration. This linearity permits the decomposition of the total electromagnetic field $(\mathbf{E}^{\text{tot}}, \mathbf{H}^{\text{tot}})$ into the sum of a known **incident field** $(\mathbf{E}^{\text{inc}}, \mathbf{H}^{\text{inc}})$ and an unknown **scattered field** $(\mathbf{E}^{\text{scat}}, \mathbf{H}^{\text{scat}})$:

$ \mathbf{E}^{\text{tot}} = \mathbf{E}^{\text{inc}} + \mathbf{E}^{\text{scat}} $

$ \mathbf{H}^{\text{tot}} = \mathbf{H}^{\text{inc}} + \mathbf{H}^{\text{scat}} $

The incident field is defined as a solution to Maxwell's equations in a simplified, homogeneous background medium (e.g., free space). The scattered field is the disturbance caused by the presence of any object or inhomogeneity whose material properties differ from this background.

For this superposition to be valid, the underlying Maxwell's equations and the material [constitutive relations](@entry_id:186508) must form a linear system. This condition holds as long as the [permittivity](@entry_id:268350) $\epsilon$, permeability $\mu$, and conductivity $\sigma$ are independent of the field strengths. This linearity is not broken by [material dispersion](@entry_id:199072) or loss. For instance, in a linear [dispersive medium](@entry_id:180771), the relationship between the electric displacement $\mathbf{D}$ and the electric field $\mathbf{E}$ is described by a convolution integral, $ \mathbf{D}(t) = \int \epsilon(t - \tau)\mathbf{E}(\tau)d\tau $, which is a linear operation. Therefore, the TFSF decomposition is rigorously applicable in linear, isotropic, anisotropic, lossy, and [dispersive media](@entry_id:748560) [@problem_id:3318197].

A related but distinct concept is **time-invariance**. While the superposition principle holds even in a linear, time-varying medium, the practical implementation of a TFSF source in the Finite-Difference Time-Domain (FDTD) method carries an additional constraint. Typically, the incident field is pre-calculated analytically or in a separate, simpler simulation. These values are then injected at the TFSF boundary at each time step. This procedure implicitly assumes that the discrete update coefficients governing the incident field propagation are identical to those of the background medium inside the total-field region. If the background medium were time-varying, its FDTD update coefficients would change over time, and a pre-calculated incident field would no longer be a valid solution to the local discrete equations. This mismatch would generate spurious, non-physical waves at the injection boundary. Consequently, for a standard and consistent TFSF injection, the background medium within which the TFSF boundary is situated must be **time-invariant** [@problem_id:3318197].

### Theoretical Foundation: The Equivalence Principle

The mechanism for generating the incident field exclusively within the total-field region is formally described by the **[electromagnetic equivalence principle](@entry_id:748885)**, a constructive extension of Huygens' principle. While Huygens' principle is a [representation theorem](@entry_id:275118) stating that fields in a source-free volume can be determined from the tangential fields on its boundary, the [equivalence principle](@entry_id:152259) provides a method to synthesize these fields from a set of [equivalent sources](@entry_id:749062) [@problem_id:3318223].

The principle, also known as Love's or Schelkunoff's principle, states that the fields in a region of space can be reproduced by placing a set of equivalent electric and magnetic surface currents on a fictitious closed surface enclosing that region, while simultaneously enforcing a [null field](@entry_id:199169) elsewhere. For the standard TFSF problem, we wish to generate the incident field $(\mathbf{E}^{\text{inc}}, \mathbf{H}^{\text{inc}})$ *inside* a closed surface $\mathcal{S}$ (the total-field region) while producing a [null field](@entry_id:199169) *outside* $\mathcal{S}$ (the scattered-field region). Let $\hat{\mathbf{n}}$ be the [outward-pointing normal](@entry_id:753030) from the total-field region. The required equivalent surface currents on $\mathcal{S}$ are given by:

$ \mathbf{J}_s = \hat{\mathbf{n}} \times \mathbf{H}^{\text{inc}} $

$ \mathbf{M}_s = -\hat{\mathbf{n}} \times \mathbf{E}^{\text{inc}} $

These surface currents, sourced by the known incident field, radiate to precisely create the incident field inside $\mathcal{S}$ and cancel it outside $\mathcal{S}$, leaving only the scattered field. The FDTD implementation of the TFSF boundary is, in essence, a discrete realization of these equivalent currents.

### Discrete Implementation in the FDTD Method

In the FDTD method, the equivalent currents are not added as explicit source terms. Instead, they arise naturally as correction terms in the update equations for field components located on the Yee grid cells adjacent to the TFSF boundary.

#### Derivation of Correction Terms

Let us consider a simple 1D FDTD grid where a [plane wave](@entry_id:263752) with components $E_z$ and $H_y$ propagates along the $x$-axis. Assume the standard Yee FDTD update equations based on Maxwell's equations $\mu \frac{\partial H_y}{\partial t} = -\frac{\partial E_z}{\partial x}$ and $\epsilon \frac{\partial E_z}{\partial t} = -\frac{\partial H_y}{\partial x}$:

$ H_y\Big|_{i-1/2}^{n+1/2} = H_y\Big|_{i-1/2}^{n-1/2} - \frac{\Delta t}{\mu \Delta x} \left( E_z\Big|_i^n - E_z\Big|_{i-1}^n \right) $

$ E_z\Big|_i^{n+1} = E_z\Big|_i^n - \frac{\Delta t}{\epsilon \Delta x} \left( H_y\Big|_{i+1/2}^{n+1/2} - H_y\Big|_{i-1/2}^{n+1/2} \right) $

Suppose the total-field region exists for $i \ge i_a$. The magnetic field node $H_y$ at $i_a - 1/2$ is in the scattered-field region. Its update requires $E_z$ at $i_a$ (total-field) and $E_z$ at $i_a - 1$ (scattered-field). The update for the scattered field $H_y^{\text{scat}}$ should be based on scattered fields only. The standard update uses the stored total field $E_z^{\text{tot}}|_{i_a} = E_z^{\text{scat}}|_{i_a} + E_z^{\text{inc}}|_{i_a}$ instead of the desired $E_z^{\text{scat}}|_{i_a}$. This introduces an incorrect term of $-\frac{\Delta t}{\mu \Delta x}E_z^{\text{inc}}|_{i_a}^n$ into the update. To cancel this error, we must add a correction term [@problem_id:3318202]:

$ H_y^{\text{scat}}\Big|_{i_a-1/2}^{n+1/2} \leftarrow H_y^{\text{scat}}\Big|_{i_a-1/2}^{n+1/2} + \frac{\Delta t}{\mu \Delta x} E_z^{\text{inc}}\Big|_{i_a}^n $

Similarly, the electric field node $E_z$ at $i_a$ is in the total-field region. Its update requires $H_y$ at $i_a - 1/2$ (scattered-field) and $H_y$ at $i_a+1/2$ (total-field). The update for the total field $E_z^{\text{tot}}$ should use total fields only. The standard update uses the stored scattered field $H_y^{\text{scat}}|_{i_a-1/2}$ instead of the desired total field $H_y^{\text{tot}}|_{i_a-1/2}$. This means the contribution from the incident field, which would appear as the term $-\frac{\Delta t}{\epsilon \Delta x}(-H_y^{\text{inc}}|_{i_a-1/2}^{n+1/2})$, is missing. To correct for this, we must add this missing term, which is equivalent to subtracting its effect:

$ E_z^{\text{tot}}\Big|_{i_a}^{n+1} \leftarrow E_z^{\text{tot}}\Big|_{i_a}^{n+1} - \frac{\Delta t}{\epsilon \Delta x} H_y^{\text{inc}}\Big|_{i_a-1/2}^{n+1/2} $

These additive and subtractive terms are the discrete implementation of the equivalent surface currents. This approach contrasts with **hard sources**, which overwrite field values and act as perfect reflectors for scattered waves, and **soft sources**, which add a [current density](@entry_id:190690) term but radiate symmetrically and fill the entire domain with a total field [@problem_id:3318202]. The TFSF boundary is uniquely designed to be transparent to outgoing scattered waves.

#### The Origin of Correction Signs

The opposite signs of the correction terms in the 1D example (addition for the $H_y$ update, subtraction for the $E_z$ update) are not arbitrary. They arise directly from the structure of Maxwell's curl equations. A formal way to see this is to define a [characteristic function](@entry_id:141714) $\chi(\mathbf{r})$ which is 1 inside the total-field region and 0 outside. The field stored in the FDTD grid is $\mathbf{F}^{\text{st}} = \chi \mathbf{F}^{t} + (1-\chi)\mathbf{F}^{s}$. Applying the [curl operator](@entry_id:184984) and the product rule $\nabla \times (f \mathbf{A}) = f \nabla \times \mathbf{A} + (\nabla f) \times \mathbf{A}$ yields:

$ \nabla \times \mathbf{F}^{\text{st}} = \chi \nabla \times \mathbf{F}^{t} + (1-\chi)\nabla \times \mathbf{F}^{s} + (\nabla \chi) \times (\mathbf{F}^{t} - \mathbf{F}^{s}) $

The term $(\nabla \chi) \times \mathbf{F}^{\text{inc}}$ is a surface term localized on the TFSF boundary that is introduced by applying the standard discrete curl to the mixed stored fields. To obtain the correct total-field update inside the boundary, this spurious surface term must be cancelled.
For the electric field update, Ampere's law is $\epsilon \frac{\partial \mathbf{E}}{\partial t} = +\nabla \times \mathbf{H}$. The spurious term is $+(\nabla \chi) \times \mathbf{H}^{\text{inc}}$, so the correction must involve *subtraction*.
For the magnetic field update, Faraday's law is $\mu \frac{\partial \mathbf{H}}{\partial t} = -\nabla \times \mathbf{E}$. The spurious term is $-(\nabla \chi) \times \mathbf{E}^{\text{inc}}$, so the correction must involve *addition* to cancel it [@problem_id:3318241].

### Defining and Sampling the Incident Wave

The accuracy of the TFSF source depends critically on providing a precise description of the incident wave and sampling it correctly in space and time.

#### Plane Wave Definition

A general time-harmonic [plane wave](@entry_id:263752) is characterized by its propagation direction, polarization, and amplitude. For a wave propagating in a direction given by the unit vector $\hat{\mathbf{k}}$, the electric field vector $\mathbf{E}$ must be perpendicular to $\hat{\mathbf{k}}$, a property known as **[transversality](@entry_id:158669)**. The direction of $\mathbf{E}$ is defined by the polarization unit vector $\hat{\mathbf{p}}$, which must satisfy $\hat{\mathbf{p}} \cdot \hat{\mathbf{k}} = 0$. The corresponding magnetic field is then uniquely determined. For a wave in free space with intrinsic impedance $\eta_0$, the fields are related by [@problem_id:3318262]:

$ \mathbf{H}^{\text{inc}} = \frac{1}{\eta_0} \hat{\mathbf{k}} \times \mathbf{E}^{\text{inc}} $

This ensures that $(\mathbf{E}^{\text{inc}}, \mathbf{H}^{\text{inc}}, \hat{\mathbf{k}})$ form a right-handed [orthogonal system](@entry_id:264885), and the [energy flow](@entry_id:142770), given by the Poynting vector, is aligned with the direction of propagation.

#### Temporal Sampling in the Yee Scheme

The Yee algorithm employs a leapfrog time-stepping scheme where $\mathbf{E}$-fields are evaluated at integer time steps ($t^n$) and $\mathbf{H}$-fields are evaluated at half-integer time steps ($t^{n+1/2}$). To maintain phase consistency, the incident fields used in the correction terms must be sampled at the appropriate time instances.

The update for $\mathbf{H}$ from $t^{n-1/2}$ to $t^{n+1/2}$ uses $\mathbf{E}$-fields at the intermediate time $t^n$. Therefore, any correction term involving an incident electric field must be sampled as $\mathbf{E}^{\text{inc}}(t^n)$.

Conversely, the update for $\mathbf{E}$ from $t^n$ to $t^{n+1}$ uses $\mathbf{H}$-fields at the intermediate time $t^{n+1/2}$. Consequently, any correction term involving an incident magnetic field must be sampled as $\mathbf{H}^{\text{inc}}(t^{n+1/2})$ [@problem_id:3318246].

Adhering to this temporal staggering is essential. Sampling both fields at the same time instance introduces a temporal error that violates the discrete form of Maxwell's equations and generates significant spurious reflections from the TFSF boundary.

### Advanced Implementation and Practical Considerations

#### Boundary Placement

The validity of the TFSF formulation rests on the assumption that the incident field is a solution to Maxwell's equations in the medium where the boundary resides. This leads to two critical rules for placing the TFSF boundary.

1.  **Avoid Material Discontinuities:** The TFSF boundary must be located entirely within a homogeneous region that matches the background medium for which the incident field was defined. If the boundary cuts through a material with different properties ($\epsilon_{\text{true}} \neq \epsilon_{\text{inc}}$), the incident field is no longer a local solution. This creates uncancelled effective source terms proportional to $(\epsilon_{\text{true}}-\epsilon_{\text{inc}})\frac{\partial \mathbf{E}_{\text{inc}}}{\partial t}$, which act as spurious secondary emitters and launch non-physical waves. For a 1D interface, this error manifests as a spurious reflection with a [reflection coefficient](@entry_id:141473) given by the [impedance mismatch](@entry_id:261346), $\Gamma = \frac{Z_{\text{true}}-Z_{\text{inc}}}{Z_{\text{true}}+Z_{\text{inc}}}$ [@problem_id:3318206].

2.  **Separate from the PML:** The Perfectly Matched Layer (PML) used to terminate the grid functions by creating an artificial anisotropic, lossy medium. The FDTD update coefficients inside the PML are therefore different from those in the main domain. If the TFSF boundary is placed adjacent to or inside the PML, the FDTD update stencils that straddle the boundary will use inconsistent coefficients. This breaks the delicate cancellation of the TFSF formulation, creating spurious numerical sources that cause the incident field to "leak" into the scattered-field region. To prevent this, there must be a buffer zone of at least **one Yee cell** of the standard background medium between the TFSF boundary and the PML region [@problem_id:3318235].

#### Numerical Dispersion and Oblique Incidence

The FDTD grid is inherently dispersive and anisotropic, meaning the numerical phase velocity of a wave depends on its frequency and its direction of propagation relative to the grid axes. For an oblique [plane wave](@entry_id:263752), simply using the free-space wavevector $k = \omega/c$ in the incident field definition leads to a phase mismatch between the injected wave and the modes supported by the grid, causing spurious reflections.

To achieve a truly non-reflecting source for an oblique wave, the numerical wavevector magnitude, $k^{\text{num}}$, must be found by solving the grid's **discrete [dispersion relation](@entry_id:138513)**. For a 2D TMz case, this relation is [@problem_id:3318264]:

$ \sin^2\left(\frac{\omega \Delta t}{2}\right) = S_x^2 \sin^2\left(\frac{k^{\text{num}} \cos\theta \, \Delta x}{2}\right) + S_y^2 \sin^2\left(\frac{k^{\text{num}} \sin\theta \, \Delta y}{2}\right) $

where $S_x, S_y$ are Courant numbers and $\theta$ is the propagation angle. By solving this [transcendental equation](@entry_id:276279) for $k^{\text{num}}$, one can define the incident field with the correct phase velocity, $v_p^{\text{num}} = \omega/k^{\text{num}}$, thus minimizing injection error.

#### Periodic Systems and Bloch-Floquet Conditions

When simulating [periodic structures](@entry_id:753351) like photonic crystals or [metasurfaces](@entry_id:180340) under [oblique incidence](@entry_id:267188), the boundaries of the unit cell must obey **Bloch-Floquet quasi-periodic boundary conditions**. For a lattice translation vector $\mathbf{a}$ in the periodic plane, the fields must satisfy:

$ \mathbf{E}(\mathbf{r}+\mathbf{a}) = \mathbf{E}(\mathbf{r}) e^{j \mathbf{k}_{\parallel}\cdot \mathbf{a}} $

Here, $\mathbf{k}_{\parallel}$ is the tangential component of the incident wave's wavevector. This condition implies that the incident field itself must exhibit this phase relationship. Therefore, when sampling the incident field on the TFSF faces, it is essential to include the corresponding tangential phase ramp, $e^{j \mathbf{k}_{\parallel} \cdot \mathbf{r}_{\parallel}}$, where $\mathbf{r}_{\parallel}$ is the tangential [position vector](@entry_id:168381). Injecting a field with uniform phase (as in [normal incidence](@entry_id:260681)) would be incorrect and would not model the desired physics of [oblique illumination](@entry_id:171321) on a periodic structure [@problem_id:3318276]. This ensures that the injected wave is consistent with the [periodicity](@entry_id:152486) imposed on the overall simulation domain.