{"hands_on_practices": [{"introduction": "We begin our practical exploration with the canonical problem of a rectangular cavity. This exercise is the \"hydrogen atom\" of eigenmode analysis, providing a clear, analytical path from Maxwell's equations to a complete set of discrete, orthogonal modes. By deriving the TE and TM mode families and their corresponding eigenfrequencies from first principles, you will build a foundational understanding of how boundary conditions shape the modal structure and how to apply a standard $L^2$ normalization in a simple, lossless system [@problem_id:3303755].", "problem": "A perfectly electric conductor (PEC) rectangular cavity occupies the region $0 \\le x \\le a$, $0 \\le y \\le b$, $0 \\le z \\le d$ and is filled with a homogeneous, isotropic material of permittivity $\\epsilon$ and permeability $\\mu$. Assume time-harmonic fields with time dependence $\\exp(-i \\omega t)$ and no sources inside the cavity. The PEC boundary condition is that the tangential component of the electric field $\\mathbf{E}$ vanishes on all six walls.\n\nStarting from the source-free Maxwell equations and the PEC boundary condition, derive the curl-curl eigenvalue problem for cavity eigenmodes and use separation of variables to formulate the allowable eigenfunctions. Classify the solutions into transverse-electric (TE, with $E_{z}=0$ and $H_{z} \\neq 0$) and transverse-magnetic (TM, with $H_{z}=0$ and $E_{z} \\neq 0$) families relative to the $z$-axis, and determine the admissible sets of separable functions on $[0,a]\\times[0,b]\\times[0,d]$ that satisfy the PEC conditions for each family.\n\nFrom first principles, derive the dispersion relation imposed by the curl-curl operator for these separable eigenfunctions and thereby determine the eigenfrequencies $\\omega_{mnp}$ in terms of the cavity dimensions $a$, $b$, $d$, the material parameters $\\epsilon$, $\\mu$, and the nonnegative integers $m$, $n$, $p$ consistent with the boundary conditions for TE and TM modes. Provide explicit expressions for the $z$-directed scalar field components $H_{z}(x,y,z)$ (for TE) and $E_{z}(x,y,z)$ (for TM) and explain how the transverse field components are obtained from Maxwell’s equations.\n\nImpose a mathematically well-posed normalization for the separated scalar eigenfunctions by requiring the $L^{2}$-norm over the cavity volume to equal unity, that is, for TE choose the scalar normalization $\\int_{V} |H_{z}(x,y,z)|^{2}\\,dV = 1$, and for TM choose $\\int_{V} |E_{z}(x,y,z)|^{2}\\,dV = 1$. Compute the corresponding closed-form normalization constants multiplying the separable solutions, explicitly accounting for the special cases where $m=0$ or $n=0$ in TE modes.\n\nFinally, give the closed-form analytic expression for the eigenfrequency $\\omega_{mnp}$ in terms of $m$, $n$, $p$, $a$, $b$, $d$, $\\epsilon$, and $\\mu$. Your final answer must be a single expression. No numerical values are required.", "solution": "The problem statement is a standard exercise in computational electromagnetics and is scientifically grounded, well-posed, and objective. All necessary information regarding the geometry, material properties, and boundary conditions is provided and is self-consistent. Therefore, the problem is valid, and we may proceed with the solution.\n\nThe analysis begins with the source-free, time-harmonic Maxwell's equations in a linear, isotropic, homogeneous medium, assuming a time-dependence of $\\exp(-i \\omega t)$:\n$$ \\nabla \\times \\mathbf{E} = i \\omega \\mu \\mathbf{H} $$\n$$ \\nabla \\times \\mathbf{H} = -i \\omega \\epsilon \\mathbf{E} $$\n$$ \\nabla \\cdot \\mathbf{E} = 0 $$\n$$ \\nabla \\cdot \\mathbf{H} = 0 $$\nTo obtain the curl-curl eigenvalue problem, we take the curl of the first equation and substitute the second equation into the result:\n$$ \\nabla \\times (\\nabla \\times \\mathbf{E}) = i \\omega \\mu (\\nabla \\times \\mathbf{H}) = i \\omega \\mu (-i \\omega \\epsilon \\mathbf{E}) = \\omega^2 \\mu \\epsilon \\mathbf{E} $$\nLet $k^2 = \\omega^2 \\mu \\epsilon$. The curl-curl eigenvalue equation for the electric field is:\n$$ \\nabla \\times \\nabla \\times \\mathbf{E} - k^2 \\mathbf{E} = 0 $$\nUsing the vector identity $\\nabla \\times (\\nabla \\times \\mathbf{E}) = \\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^2 \\mathbf{E}$ and the source-free condition $\\nabla \\cdot \\mathbf{E} = 0$, this simplifies to the vector Helmholtz equation:\n$$ \\nabla^2 \\mathbf{E} + k^2 \\mathbf{E} = 0 $$\nA similar equation holds for the magnetic field $\\mathbf{H}$. The solutions to this equation subject to the boundary conditions are the eigenmodes of the cavity, and the corresponding values of $k$ (and thus $\\omega$) are the eigenvalues or eigenfrequencies.\n\nThe fields within the cavity can be classified into two independent families with respect to the $z$-axis: Transverse-Magnetic (TM) modes, where $H_z = 0$, and Transverse-Electric (TE) modes, where $E_z = 0$.\n\nFor both mode types, we seek solutions using the method of separation of variables. Considering a generic scalar component $\\psi(x, y, z)$ that satisfies the scalar Helmholtz equation $(\\nabla^2 + k^2)\\psi = 0$, we assume a solution of the form $\\psi(x,y,z) = X(x)Y(y)Z(z)$. Substituting this into the equation yields:\n$$ \\frac{1}{X}\\frac{d^2X}{dx^2} + \\frac{1}{Y}\\frac{d^2Y}{dy^2} + \\frac{1}{Z}\\frac{d^2Z}{dz^2} + k^2 = 0 $$\nThis equation separates into three ordinary differential equations, with separation constants $-k_x^2$, $-k_y^2$, and $-k_z^2$:\n$$ \\frac{d^2X}{dx^2} + k_x^2 X = 0 $$\n$$ \\frac{d^2Y}{dy^2} + k_y^2 Y = 0 $$\n$$ \\frac{d^2Z}{dz^2} + k_z^2 Z = 0 $$\nThese constants must satisfy the dispersion relation: $k_x^2 + k_y^2 + k_z^2 = k^2 = \\omega^2 \\mu \\epsilon$.\n\nThe specific form of the eigenfunctions is determined by the perfectly electric conductor (PEC) boundary condition, which states that the tangential component of the electric field $\\mathbf{E}$ must be zero on all six walls of the cavity defined by $x=0,a$, $y=0,b$, and $z=0,d$.\n\n**Transverse-Magnetic (TM) Modes ($H_z=0, E_z \\neq 0$)**\nThe longitudinal component $E_z$ must satisfy the scalar Helmholtz equation. The boundary conditions on $E_z$ are:\n- $E_z$ is tangential to the walls at $x=0,a$ and $y=0,b$. Thus, $E_z(0,y,z) = E_z(a,y,z) = 0$ and $E_z(x,0,z) = E_z(x,b,z) = 0$.\nThe transverse electric field components $E_x$ and $E_y$ are tangential to the walls at $z=0,d$. The relation between the transverse and longitudinal fields can be shown to be $\\mathbf{E}_t = \\frac{1}{k_c^2} \\nabla_t (\\frac{\\partial E_z}{\\partial z})$, where $k_c^2=k_x^2+k_y^2$. For $E_x$ and $E_y$ to be zero at $z=0,d$, we require $\\frac{\\partial E_z}{\\partial z} = 0$ at $z=0,d$.\n\nApplying these conditions to the separated solutions:\n- $X(0)=0$ and $X(a)=0 \\implies X(x) \\propto \\sin(k_x x)$ with $k_x = \\frac{m\\pi}{a}$ for $m=1,2,3,\\dots$.\n- $Y(0)=0$ and $Y(b)=0 \\implies Y(y) \\propto \\sin(k_y y)$ with $k_y = \\frac{n\\pi}{b}$ for $n=1,2,3,\\dots$.\n- $Z'(0)=0$ and $Z'(d)=0 \\implies Z(z) \\propto \\cos(k_z z)$ with $k_z = \\frac{p\\pi}{d}$ for $p=0,1,2,\\dots$.\nFor a non-trivial TM mode, both $m$ and $n$ must be non-zero. The general form for the $z$-directed scalar component is:\n$$ E_z(x,y,z) = C^{TM}_{mnp} \\sin\\left(\\frac{m\\pi x}{a}\\right) \\sin\\left(\\frac{n\\pi y}{b}\\right) \\cos\\left(\\frac{p\\pi z}{d}\\right) $$\nwith indices $m \\ge 1, n \\ge 1, p \\ge 0$.\n\n**Transverse-Electric (TE) Modes ($E_z=0, H_z \\neq 0$)**\nThe longitudinal component $H_z$ satisfies the scalar Helmholtz equation. The boundary conditions are on the tangential electric field. The transverse E-fields are related to $H_z$ by $\\mathbf{E}_t = -\\frac{i \\omega \\mu}{k_c^2} (\\hat{\\mathbf{z}} \\times \\nabla_t H_z)$, which gives $E_x = -\\frac{i\\omega\\mu}{k_c^2}\\frac{\\partial H_z}{\\partial y}$ and $E_y = \\frac{i\\omega\\mu}{k_c^2}\\frac{\\partial H_z}{\\partial x}$.\nThe PEC conditions are:\n- $E_y(0,y,z) = E_y(a,y,z) = 0 \\implies \\frac{\\partial H_z}{\\partial x} = 0$ at $x=0,a$.\n- $E_x(x,0,z) = E_x(x,b,z) = 0 \\implies \\frac{\\partial H_z}{\\partial y} = 0$ at $y=0,b$.\n- $E_x(x,y,0) = E_x(x,y,d) = 0$ and $E_y(x,y,0) = E_y(x,y,d) = 0$.\n\nApplying these conditions to the separated solutions:\n- $X'(0)=0$ and $X'(a)=0 \\implies X(x) \\propto \\cos(k_x x)$ with $k_x = \\frac{m\\pi}{a}$ for $m=0,1,2,\\dots$.\n- $Y'(0)=0$ and $Y'(b)=0 \\implies Y(y) \\propto \\cos(k_y y)$ with $k_y = \\frac{n\\pi}{b}$ for $n=0,1,2,\\dots$.\nTo satisfy the BCs on the $z=0,d$ walls, a full analysis shows the appropriate form for $Z(z)$ is a sine function. This ensures that $E_x \\propto \\sin(k_z z)$ and $E_y \\propto \\sin(k_z z)$, which vanish at $z=0$. The condition at $z=d$ requires $\\sin(k_z d)=0$.\n- $Z(0)=0$ and $Z(d)=0 \\implies Z(z) \\propto \\sin(k_z z)$ with $k_z = \\frac{p\\pi}{d}$ for $p=1,2,3,\\dots$.\nFor a non-trivial TE mode, at least one of $m$ or $n$ must be non-zero (otherwise $k_c^2=0$ and $H_z$ is constant, leading to zero E-fields). Also, $p$ must be non-zero for $H_z$ to exist. The general form is:\n$$ H_z(x,y,z) = C^{TE}_{mnp} \\cos\\left(\\frac{m\\pi x}{a}\\right) \\cos\\left(\\frac{n\\pi y}{b}\\right) \\sin\\left(\\frac{p\\pi z}{d}\\right) $$\nwith indices $m \\ge 0, n \\ge 0$ (but not both zero, $m^2+n^2 \\neq 0$), and $p \\ge 1$.\n\n**Eigenfrequencies and Transverse Field Derivation**\nFor both TE and TM modes, the eigenfrequencies $\\omega_{mnp}$ are determined by the dispersion relation:\n$$ \\omega_{mnp}^2 \\mu \\epsilon = k^2 = k_x^2 + k_y^2 + k_z^2 = \\left(\\frac{m\\pi}{a}\\right)^2 + \\left(\\frac{n\\pi}{b}\\right)^2 + \\left(\\frac{p\\pi}{d}\\right)^2 $$\nSolving for $\\omega_{mnp}$ gives the general expression for the resonant frequencies of the cavity:\n$$ \\omega_{mnp} = \\frac{1}{\\sqrt{\\mu\\epsilon}} \\sqrt{\\left(\\frac{m\\pi}{a}\\right)^2 + \\left(\\frac{n\\pi}{b}\\right)^2 + \\left(\\frac{p\\pi}{d}\\right)^2} $$\nThe transverse field components ($\\mathbf{E}_t, \\mathbf{H}_t$) can be obtained from the longitudinal components ($E_z, H_z$) by solving the algebraic system derived from Maxwell's curl equations, which yields expressions of the form $\\mathbf{E}_t = f(\\nabla_t E_z, \\nabla_t H_z)$ and $\\mathbf{H}_t = g(\\nabla_t E_z, \\nabla_t H_z)$. Specifically, for traveling waves, one obtains:\n$$ \\mathbf{E}_t = \\frac{i}{k_c^2} \\left( k_z \\nabla_t E_z - \\omega\\mu (\\hat{\\mathbf{z}} \\times \\nabla_t H_z) \\right) $$\n$$ \\mathbf{H}_t = \\frac{i}{k_c^2} \\left( k_z \\nabla_t H_z + \\omega\\epsilon (\\hat{\\mathbf{z}} \\times \\nabla_t E_z) \\right) $$\nFor standing wave solutions, the derivatives $\\partial/\\partial z$ should be used instead of the factor $-i k_z$.\n\n**Normalization Constants**\nThe normalization constants are found by enforcing the condition that the $L^2$-norm of the scalar field component ($E_z$ for TM, $H_z$ for TE) over the cavity volume $V=abd$ is unity. We use the definite integrals:\n$\\int_0^L \\sin^2(\\frac{k\\pi u}{L}) du = \\frac{L}{2}$ for $k \\ge 1$.\n$\\int_0^L \\cos^2(\\frac{k\\pi u}{L}) du = L$ for $k=0$ and $\\frac{L}{2}$ for $k \\ge 1$. This can be written as $\\frac{L}{2}(1+\\delta_{k0})$, where $\\delta_{ij}$ is the Kronecker delta.\n\nFor TM modes, $\\int_V |E_z|^2 dV = 1$:\n$$ |C^{TM}_{mnp}|^2 \\left(\\frac{a}{2}\\right) \\left(\\frac{b}{2}\\right) \\left(\\frac{d(1+\\delta_{p0})}{2}\\right) = 1 $$\n$$ C^{TM}_{mnp} = \\sqrt{\\frac{8}{abd(1+\\delta_{p0})}} \\quad (m,n \\ge 1; p \\ge 0) $$\n\nFor TE modes, $\\int_V |H_z|^2 dV = 1$:\n$$ |C^{TE}_{mnp}|^2 \\left(\\frac{a(1+\\delta_{m0})}{2}\\right) \\left(\\frac{b(1+\\delta_{n0})}{2}\\right) \\left(\\frac{d}{2}\\right) = 1 $$\n$$ C^{TE}_{mnp} = \\sqrt{\\frac{8}{abd(1+\\delta_{m0})(1+\\delta_{n0})}} \\quad (m,n \\ge 0, m^2+n^2 \\neq 0; p \\ge 1) $$\nThese constants ensure the eigenfunctions form an orthonormal set under the specified normalization condition.\n\nThe final requested expression is for the eigenfrequency $\\omega_{mnp}$.", "answer": "$$ \\boxed{ \\frac{1}{\\sqrt{\\mu\\epsilon}} \\sqrt{ \\left(\\frac{m\\pi}{a}\\right)^{2} + \\left(\\frac{n\\pi}{b}\\right)^{2} + \\left(\\frac{p\\pi}{d}\\right)^{2} } } $$", "id": "3303755"}, {"introduction": "Real-world materials are rarely lossless and isotropic. When we introduce complexities like anisotropic loss or magneto-electric coupling, the underlying mathematical operators cease to be Hermitian. This practice explores the profound consequence: the standard orthogonality of eigenmodes gives way to the more general concept of biorthogonality, requiring distinct sets of \"left\" and \"right\" eigenvectors [@problem_id:3303766]. Through a guided numerical implementation, you will verify this principle and quantify the significant errors that arise from naively applying a standard inner product to a non-Hermitian system.", "problem": "You are given a finite-dimensional plane-wave formulation of the frequency-domain Maxwell eigenproblem for a homogeneous medium. The curl operator acting on a plane-wave with wavevector $\\mathbf{k} \\in \\mathbb{R}^3$ is represented by the cross-product matrix $\\mathbf{K}(\\mathbf{k}) \\in \\mathbb{R}^{3 \\times 3}$ defined by\n$$\n\\mathbf{K}(\\mathbf{k}) = \n\\begin{bmatrix}\n0 & -k_z & k_y \\\\\nk_z & 0 & -k_x \\\\\n-k_y & k_x & 0\n\\end{bmatrix},\n$$\nso that $\\mathbf{K}(\\mathbf{k}) \\mathbf{v} = \\mathbf{k} \\times \\mathbf{v}$ for any $\\mathbf{v} \\in \\mathbb{C}^3$. Consider the first-order Maxwell generalized eigenproblem in the form\n$$\n\\mathbf{K}_6(\\mathbf{k}) \\, \\boldsymbol{\\Psi} = \\omega \\, \\mathbf{M} \\, \\boldsymbol{\\Psi},\n$$\nwhere the $6 \\times 6$ operator is\n$$\n\\mathbf{K}_6(\\mathbf{k}) = \n\\begin{bmatrix}\n\\mathbf{0} & i \\, \\mathbf{K}(\\mathbf{k}) \\\\\n- i \\, \\mathbf{K}(\\mathbf{k}) & \\mathbf{0}\n\\end{bmatrix},\n$$\nand the constitutive $6 \\times 6$ matrix $\\mathbf{M}$ is\n$$\n\\mathbf{M} =\n\\begin{bmatrix}\n\\boldsymbol{\\varepsilon} & \\boldsymbol{\\xi} \\\\\n\\boldsymbol{\\zeta} & \\boldsymbol{\\mu}\n\\end{bmatrix},\n$$\nwith $3 \\times 3$ blocks $\\boldsymbol{\\varepsilon}$, $\\boldsymbol{\\mu}$, $\\boldsymbol{\\xi}$, and $\\boldsymbol{\\zeta}$. The state vector is $\\boldsymbol{\\Psi} = \\begin{bmatrix} \\mathbf{E} \\\\ \\mathbf{H} \\end{bmatrix} \\in \\mathbb{C}^{6}$. For reciprocal media with magneto-electric coupling, the reciprocity condition imposes $\\boldsymbol{\\zeta} = - \\boldsymbol{\\xi}^{T}$. In the absence of magneto-electric coupling, $\\boldsymbol{\\xi} = \\mathbf{0}$ and $\\boldsymbol{\\zeta} = \\mathbf{0}$, and the constitutive matrix reduces to a block-diagonal matrix $\\mathbf{M} = \\operatorname{diag}(\\boldsymbol{\\varepsilon}, \\boldsymbol{\\mu})$.\n\nStarting from Maxwell’s equations and the constitutive relations $\\mathbf{D} = \\boldsymbol{\\varepsilon} \\mathbf{E} + \\boldsymbol{\\xi} \\mathbf{H}$ and $\\mathbf{B} = \\boldsymbol{\\mu} \\mathbf{H} + \\boldsymbol{\\zeta} \\mathbf{E}$, it follows that the second-order curl-curl eigenproblem for the electric field $\\mathbf{E}$ in a homogeneous medium with $\\boldsymbol{\\xi} = \\boldsymbol{\\zeta} = \\mathbf{0}$ is\n$$\n\\left( \\mathbf{K}(\\mathbf{k}) \\, \\boldsymbol{\\mu}^{-1} \\, \\mathbf{K}(\\mathbf{k}) \\right) \\mathbf{E} = \\omega^2 \\, \\boldsymbol{\\varepsilon} \\, \\mathbf{E}.\n$$\nDefine the matrix $\\mathbf{A}(\\mathbf{k}) = \\mathbf{K}(\\mathbf{k}) \\, \\boldsymbol{\\mu}^{-1} \\, \\mathbf{K}(\\mathbf{k})$; for $\\boldsymbol{\\mu} = \\mathbf{I}$, this simplifies to $\\mathbf{A}(\\mathbf{k}) = \\mathbf{K}(\\mathbf{k})^2 = - \\|\\mathbf{k}\\|^2 \\mathbf{I} + \\mathbf{k} \\mathbf{k}^{T}$.\n\nFor a generalized eigenproblem $\\mathbf{A} \\mathbf{x} = \\lambda \\mathbf{B} \\mathbf{x}$ with possibly non-Hermitian $\\mathbf{B}$ (e.g., due to anisotropic loss), the right eigenvectors $\\mathbf{x}_n$ and left eigenvectors $\\tilde{\\mathbf{x}}_n$ satisfy\n$$\n\\mathbf{A} \\mathbf{x}_n = \\lambda_n \\mathbf{B} \\mathbf{x}_n, \\quad \\tilde{\\mathbf{x}}_n^{\\dagger} \\mathbf{A} = \\lambda_n \\, \\tilde{\\mathbf{x}}_n^{\\dagger} \\mathbf{B},\n$$\nwhere ${}^\\dagger$ denotes the conjugate transpose. The biorthogonality and normalization condition is\n$$\n\\langle \\tilde{\\mathbf{x}}_m, \\mathbf{x}_n \\rangle_{\\mathbf{B}} \\equiv \\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{B} \\mathbf{x}_n = \\delta_{mn}.\n$$\nIn the electric-field curl-curl problem, $\\mathbf{B} = \\boldsymbol{\\varepsilon}$. In the full first-order formulation with magneto-electric coupling, the appropriate metric in the inner product is $\\mathbf{M}$, so that the biorthogonality condition becomes\n$$\n\\langle \\tilde{\\boldsymbol{\\Psi}}_m, \\boldsymbol{\\Psi}_n \\rangle_{\\mathbf{M}} \\equiv \\tilde{\\boldsymbol{\\Psi}}_m^{\\dagger} \\mathbf{M} \\, \\boldsymbol{\\Psi}_n = \\delta_{mn}.\n$$\n\nYour tasks are:\n- Construct the biorthogonal sets of left and right eigenmodes for the specified generalized eigenproblems and verify that the corresponding inner products satisfy the Kronecker delta property after proper normalization.\n- Quantify the failure of the naive inner product that ignores left-right pairing or ignores magneto-electric coupling.\n- Implement this verification numerically for the three test cases below.\n\nAll quantities are to be treated as dimensionless; do not report any physical units. Angles do not appear in this problem.\n\nTest suite:\n- Case A (lossless, no coupling, first-order): Let $\\mathbf{k} = [\\, 1.1, \\, 0.7, \\, 0.9 \\,]^T$, $\\boldsymbol{\\varepsilon} = 2.0 \\, \\mathbf{I}$, $\\boldsymbol{\\mu} = 1.3 \\, \\mathbf{I}$, $\\boldsymbol{\\xi} = \\mathbf{0}$, $\\boldsymbol{\\zeta} = \\mathbf{0}$. Build $\\mathbf{K}_6(\\mathbf{k})$ and $\\mathbf{M} = \\operatorname{diag}(\\boldsymbol{\\varepsilon}, \\boldsymbol{\\mu})$. Compute left and right eigenvectors and evaluate the deviation\n$$\nd_A = \\max_{m,n} \\left| \\tilde{\\boldsymbol{\\Psi}}_m^{\\dagger} \\mathbf{M} \\, \\boldsymbol{\\Psi}_n - \\delta_{mn} \\right|,\n$$\nafter scaling each right eigenvector $\\boldsymbol{\\Psi}_n$ so that $\\tilde{\\boldsymbol{\\Psi}}_n^{\\dagger} \\mathbf{M} \\, \\boldsymbol{\\Psi}_n = 1$.\n\n- Case B (anisotropic loss, no coupling, curl-curl for $\\mathbf{E}$): Let $\\mathbf{k} = [\\, 1.1, \\, 0.7, \\, 0.9 \\,]^T$, $\\boldsymbol{\\mu} = \\mathbf{I}$, and\n$$\n\\boldsymbol{\\varepsilon} =\n\\begin{bmatrix}\n2.0 + 0.2 i & 0.1 + 0.05 i & 0.0 + 0.02 i \\\\\n0.1 + 0.05 i & 1.5 + 0.15 i & 0.02 + 0.01 i \\\\\n0.0 + 0.02 i & 0.02 + 0.01 i & 1.2 + 0.1 i\n\\end{bmatrix}.\n$$\nBuild $\\mathbf{A}(\\mathbf{k}) = - \\|\\mathbf{k}\\|^2 \\mathbf{I} + \\mathbf{k} \\mathbf{k}^T$. Compute:\n1. The naive right-right Gram deviation using only right eigenvectors:\n$$\nd_{B,\\text{wrong}} = \\max_{m \\neq n} \\left| \\mathbf{x}_m^{\\dagger} \\boldsymbol{\\varepsilon} \\, \\mathbf{x}_n \\right|,\n$$\nafter scaling each right eigenvector $\\mathbf{x}_n$ to have unit $\\boldsymbol{\\varepsilon}$-norm $\\mathbf{x}_n^{\\dagger} \\boldsymbol{\\varepsilon} \\, \\mathbf{x}_n = 1$.\n2. The correct biorthogonal deviation using left-right pairing:\n$$\nd_{B,\\text{right}} = \\max_{m,n} \\left| \\tilde{\\mathbf{x}}_m^{\\dagger} \\boldsymbol{\\varepsilon} \\, \\mathbf{x}_n - \\delta_{mn} \\right|,\n$$\nafter scaling each right eigenvector so that $\\tilde{\\mathbf{x}}_n^{\\dagger} \\boldsymbol{\\varepsilon} \\, \\mathbf{x}_n = 1$.\n\n- Case C (anisotropic loss with magneto-electric coupling, first-order): Let $\\mathbf{k} = [\\, 1.1, \\, 0.7, \\, 0.9 \\,]^T$, and\n$$\n\\boldsymbol{\\varepsilon} =\n\\begin{bmatrix}\n2.0 + 0.05 i & 0.04 + 0.02 i & 0.01 + 0.01 i \\\\\n0.04 + 0.02 i & 1.4 + 0.02 i & 0.03 + 0.01 i \\\\\n0.01 + 0.01 i & 0.03 + 0.01 i & 1.7 + 0.01 i\n\\end{bmatrix}, \\quad\n\\boldsymbol{\\mu} =\n\\begin{bmatrix}\n1.1 + 0.01 i & 0 & 0 \\\\\n0 & 1.0 + 0.02 i & 0 \\\\\n0 & 0 & 0.9 + 0.03 i\n\\end{bmatrix},\n$$\n$$\n\\boldsymbol{\\xi} =\n\\begin{bmatrix}\n0.02 + 0.01 i & -0.01 + 0.005 i & 0.0 + 0.002 i \\\\\n0.005 - 0.004 i & 0.015 + 0.006 i & -0.007 + 0.003 i \\\\\n-0.003 + 0.002 i & 0.004 - 0.001 i & 0.01 + 0.005 i\n\\end{bmatrix}, \\quad\n\\boldsymbol{\\zeta} = - \\boldsymbol{\\xi}^{T}.\n$$\nBuild $\\mathbf{K}_6(\\mathbf{k})$ and $\\mathbf{M} = \\begin{bmatrix} \\boldsymbol{\\varepsilon} & \\boldsymbol{\\xi} \\\\ \\boldsymbol{\\zeta} & \\boldsymbol{\\mu} \\end{bmatrix}$. Compute two deviations:\n1. Using the incorrect metric that ignores magneto-electric coupling,\n$$\nd_{C,\\text{wrong}} = \\max_{m \\neq n} \\left| \\tilde{\\boldsymbol{\\Psi}}_m^{\\dagger} \\, \\operatorname{diag}(\\boldsymbol{\\varepsilon}, \\boldsymbol{\\mu}) \\, \\boldsymbol{\\Psi}_n \\right|,\n$$\nafter scaling so that $\\tilde{\\boldsymbol{\\Psi}}_n^{\\dagger} \\, \\operatorname{diag}(\\boldsymbol{\\varepsilon}, \\boldsymbol{\\mu}) \\, \\boldsymbol{\\Psi}_n = 1$.\n2. Using the correct metric,\n$$\nd_{C,\\text{right}} = \\max_{m,n} \\left| \\tilde{\\boldsymbol{\\Psi}}_m^{\\dagger} \\, \\mathbf{M} \\, \\boldsymbol{\\Psi}_n - \\delta_{mn} \\right|,\n$$\nafter scaling each right eigenvector so that $\\tilde{\\boldsymbol{\\Psi}}_n^{\\dagger} \\, \\mathbf{M} \\, \\boldsymbol{\\Psi}_n = 1$.\n\nYour program must:\n- Implement the construction of the matrices, compute left and right eigenvectors for each generalized eigenproblem, perform the indicated normalizations, and evaluate the deviations $d_A$, $d_{B,\\text{wrong}}$, $d_{B,\\text{right}}$, $d_{C,\\text{wrong}}$, and $d_{C,\\text{right}}$ as defined above.\n- Produce a single line of output containing these five results in the following exact format: a comma-separated list enclosed in square brackets and ordered as $[d_A, d_{B,\\text{wrong}}, d_{B,\\text{right}}, d_{C,\\text{wrong}}, d_{C,\\text{right}}]$.\n\nThe expected types of the outputs are real-valued floating-point numbers. No user input is permitted, and all data are given explicitly above.", "solution": "The problem requires the numerical verification of biorthogonality conditions for eigenvectors of generalized Maxwell eigenproblems. This analysis is fundamental in computational electromagnetics for describing modes in complex media that may be anisotropic, lossy, or exhibit magneto-electric coupling. The core of the problem lies in the properties of generalized non-Hermitian eigenvalue problems.\n\nA generalized eigenvalue problem is given by the equation $\\mathbf{A} \\mathbf{x} = \\lambda \\mathbf{B} \\mathbf{x}$, where $\\mathbf{A}$ and $\\mathbf{B}$ are square matrices. The corresponding left eigenvalue problem is defined by $\\tilde{\\mathbf{x}}^{\\dagger} \\mathbf{A} = \\lambda \\tilde{\\mathbf{x}}^{\\dagger} \\mathbf{B}$. If the system's \"metric\" matrix, $\\mathbf{B}$ in this case, is not Hermitian and positive-definite, the eigenproblem is generally non-Hermitian, and the left eigenvectors $\\tilde{\\mathbf{x}}_n$ are not simply the conjugate transposes of the right eigenvectors $\\mathbf{x}_n$. Instead, they form a distinct set.\n\nThe left and right eigenvectors corresponding to different eigenvalues are orthogonal with respect to the metric $\\mathbf{B}$. To demonstrate this, consider two eigenpairs $(\\lambda_n, \\mathbf{x}_n, \\tilde{\\mathbf{x}}_n)$ and $(\\lambda_m, \\mathbf{x}_m, \\tilde{\\mathbf{x}}_m)$:\n$$\n\\mathbf{A} \\mathbf{x}_n = \\lambda_n \\mathbf{B} \\mathbf{x}_n\n$$\n$$\n\\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{A} = \\lambda_m \\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{B}\n$$\nLeft-multiplying the first equation by $\\tilde{\\mathbf{x}}_m^{\\dagger}$ and right-multiplying the second by $\\mathbf{x}_n$ gives:\n$$\n\\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{A} \\mathbf{x}_n = \\lambda_n \\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{B} \\mathbf{x}_n\n$$\n$$\n\\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{A} \\mathbf{x}_n = \\lambda_m \\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{B} \\mathbf{x}_n\n$$\nSubtracting these two equations yields $(\\lambda_n - \\lambda_m) \\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{B} \\mathbf{x}_n = 0$. For a non-degenerate spectrum where $\\lambda_n \\neq \\lambda_m$, it must be that $\\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{B} \\mathbf{x}_n = 0$. This is the biorthogonality condition.\n\nFor the case $m=n$, the inner product $\\tilde{\\mathbf{x}}_n^{\\dagger} \\mathbf{B} \\mathbf{x}_n$ is generally non-zero. We can normalize the right eigenvectors to form a biorthonormal basis. By defining a new set of right eigenvectors $\\mathbf{x}'_n = c_n \\mathbf{x}_n$ with the scaling factor $c_n = 1 / (\\tilde{\\mathbf{x}}_n^{\\dagger} \\mathbf{B} \\mathbf{x}_n)$, we achieve the complete biorthonormality relation:\n$$\n\\langle \\tilde{\\mathbf{x}}_m, \\mathbf{x}'_n \\rangle_{\\mathbf{B}} \\equiv \\tilde{\\mathbf{x}}_m^{\\dagger} \\mathbf{B} \\mathbf{x}'_n = \\delta_{mn}\n$$\nwhere $\\delta_{mn}$ is the Kronecker delta. The numerical implementation will verify this property for the given electromagnetic eigenproblems and quantify the error when an incorrect procedure is used.\n\nThe solution proceeds by implementing the specific tasks for each test case.\n\nCase A: First-order, lossless, no coupling.\nThe eigenproblem is $\\mathbf{K}_6(\\mathbf{k}) \\boldsymbol{\\Psi} = \\omega \\mathbf{M} \\boldsymbol{\\Psi}$. Here, $\\mathbf{A} = \\mathbf{K}_6(\\mathbf{k})$ and $\\mathbf{B} = \\mathbf{M} = \\operatorname{diag}(2.0 \\, \\mathbf{I}, 1.3 \\, \\mathbf{I})$. The matrix $\\mathbf{K}_6(\\mathbf{k})$ is Hermitian, and $\\mathbf{M}$ is real, symmetric, and positive-definite. This constitutes a generalized Hermitian eigenvalue problem. In such cases, the left eigenvectors are the conjugate transposes of the right eigenvectors, and the standard orthogonality holds. The calculation of $d_A$ will confirm the biorthonormality relation, which reduces to standard orthogonality here. The resulting deviation should be near machine precision.\n\nCase B: Second-order curl-curl for $\\mathbf{E}$, anisotropic loss.\nThe eigenproblem is $\\mathbf{A}(\\mathbf{k}) \\mathbf{E} = \\omega^2 \\boldsymbol{\\varepsilon} \\mathbf{E}$. Here, $\\mathbf{A} = \\mathbf{A}(\\mathbf{k}) = \\mathbf{K}(\\mathbf{k})^2$ is a real symmetric matrix, hence Hermitian. The metric matrix $\\mathbf{B} = \\boldsymbol{\\varepsilon}$ is a complex symmetric matrix but it is not Hermitian due to the presence of material loss (imaginary components). The eigenproblem is therefore non-Hermitian.\n$d_{B,\\text{wrong}}$ quantifies the error from a naive attempt to form an orthogonal basis using only the right eigenvectors $\\mathbf{x}_n$, normalized to have unit $\\boldsymbol{\\varepsilon}$-norm ($\\mathbf{x}_n^{\\dagger} \\boldsymbol{\\varepsilon} \\mathbf{x}_n = 1$). Since the problem is non-Hermitian, the right eigenvectors are not orthogonal with respect to the $\\boldsymbol{\\varepsilon}$ inner product, and this deviation is expected to be large.\n$d_{B,\\text{right}}$ quantifies the correctness of the biorthonormalization procedure using both left $\\tilde{\\mathbf{x}}_n$ and right $\\mathbf{x}_n$ eigenvectors. This deviation is expected to be near machine precision, confirming the validity of the biorthogonality principle.\n\nCase C: First-order with anisotropic loss and magneto-electric coupling.\nThe eigenproblem is again $\\mathbf{K}_6(\\mathbf{k}) \\boldsymbol{\\Psi} = \\omega \\mathbf{M} \\boldsymbol{\\Psi}$. While $\\mathbf{K}_6(\\mathbf{k})$ is Hermitian, the full constitutive matrix $\\mathbf{M}$ is not, due to lossy materials ($\\boldsymbol{\\varepsilon} \\neq \\boldsymbol{\\varepsilon}^{\\dagger}, \\boldsymbol{\\mu} \\neq \\boldsymbol{\\mu}^{\\dagger}$) and the structure of the magneto-electric coupling blocks ($\\boldsymbol{\\zeta} = -\\boldsymbol{\\xi}^T$, which does not imply $\\boldsymbol{\\xi} = \\boldsymbol{\\zeta}^{\\dagger}$). The problem is firmly non-Hermitian.\n$d_{C,\\text{wrong}}$ measures the orthogonality error when ignoring the magneto-electric coupling terms $\\boldsymbol{\\xi}$ and $\\boldsymbol{\\zeta}$ in the inner product metric. The metric is incorrectly assumed to be $\\mathbf{M}_{\\text{wrong}} = \\operatorname{diag}(\\boldsymbol{\\varepsilon}, \\boldsymbol{\\mu})$. Since this is not the true metric $\\mathbf{M}$ of the generalized eigenproblem, the biorthogonality relation will not hold, and a large deviation is expected.\n$d_{C,\\text{right}}$ uses the correct, full metric $\\mathbf{M}$. This restores the proper structure of the problem, and the biorthonormality relation $\\tilde{\\boldsymbol{\\Psi}}_m^{\\dagger} \\mathbf{M} \\boldsymbol{\\Psi}_n = \\delta_{mn}$ should hold up to numerical precision. The resulting deviation is expected to be small.\n\nThe following program implements these calculations. It constructs the matrices, solves the generalized eigenproblems for left and right eigenvectors using `scipy.linalg.eig`, applies the specified normalizations, and computes the required deviations.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eig\n\ndef solve():\n    \"\"\"\n    Computes biorthogonality deviations for three electromagnetic eigenproblems.\n    \"\"\"\n    \n    # Common parameter for all cases\n    k_vec = np.array([1.1, 0.7, 0.9])\n\n    def construct_K(k):\n        \"\"\"Constructs the 3x3 curl operator matrix K(k).\"\"\"\n        kx, ky, kz = k\n        return np.array([\n            [0, -kz, ky],\n            [kz, 0, -kx],\n            [-ky, kx, 0]\n        ])\n\n    results = []\n\n    # Case A: Lossless, no coupling, first-order\n    K_mat = construct_K(k_vec)\n    K6_A = np.block([\n        [np.zeros((3, 3)), 1j * K_mat],\n        [-1j * K_mat, np.zeros((3, 3))]\n    ])\n    eps_A = 2.0 * np.eye(3)\n    mu_A = 1.3 * np.eye(3)\n    M_A = np.block([\n        [eps_A, np.zeros((3, 3))],\n        [np.zeros((3, 3)), mu_A]\n    ])\n\n    _, vl_A, vr_A = eig(K6_A, M_A, left=True, right=True)\n    \n    norm_factors_A = np.einsum('ij,ik,kj->j', vl_A.conj(), M_A, vr_A)\n    vr_A_norm = vr_A / norm_factors_A\n    \n    G_A = vl_A.conj().T @ M_A @ vr_A_norm\n    d_A = np.max(np.abs(G_A - np.eye(6)))\n    results.append(d_A)\n\n    # Case B: Anisotropic loss, no coupling, curl-curl for E\n    eps_B = np.array([\n        [2.0 + 0.2j, 0.1 + 0.05j, 0.0 + 0.02j],\n        [0.1 + 0.05j, 1.5 + 0.15j, 0.02 + 0.01j],\n        [0.0 + 0.02j, 0.02 + 0.01j, 1.2 + 0.1j]\n    ])\n    A_B = -np.dot(k_vec, k_vec) * np.eye(3) + np.outer(k_vec, k_vec)\n\n    _, vl_B, vr_B = eig(A_B, eps_B, left=True, right=True)\n    \n    # B, wrong: Naive right-right Gram deviation\n    norm_factors_B_wrong = np.einsum('ij,ik,kj->j', vr_B.conj(), eps_B, vr_B)\n    vr_B_norm_wrong = vr_B / np.sqrt(norm_factors_B_wrong)\n    \n    G_B_wrong = vr_B_norm_wrong.conj().T @ eps_B @ vr_B_norm_wrong\n    np.fill_diagonal(G_B_wrong, 0)\n    d_B_wrong = np.max(np.abs(G_B_wrong))\n    results.append(d_B_wrong)\n    \n    # B, right: Correct biorthogonal deviation\n    norm_factors_B_right = np.einsum('ij,ik,kj->j', vl_B.conj(), eps_B, vr_B)\n    vr_B_norm_right = vr_B / norm_factors_B_right\n    \n    G_B_right = vl_B.conj().T @ eps_B @ vr_B_norm_right\n    d_B_right = np.max(np.abs(G_B_right - np.eye(3)))\n    results.append(d_B_right)\n\n    # Case C: Anisotropic loss with magneto-electric coupling, first-order\n    eps_C = np.array([\n        [2.0 + 0.05j, 0.04 + 0.02j, 0.01 + 0.01j],\n        [0.04 + 0.02j, 1.4 + 0.02j, 0.03 + 0.01j],\n        [0.01 + 0.01j, 0.03 + 0.01j, 1.7 + 0.01j]\n    ])\n    mu_C = np.array([\n        [1.1 + 0.01j, 0, 0],\n        [0, 1.0 + 0.02j, 0],\n        [0, 0, 0.9 + 0.03j]\n    ])\n    xi_C = np.array([\n        [0.02 + 0.01j, -0.01 + 0.005j, 0.0 + 0.002j],\n        [0.005 - 0.004j, 0.015 + 0.006j, -0.007 + 0.003j],\n        [-0.003 + 0.002j, 0.004 - 0.001j, 0.01 + 0.005j]\n    ])\n    zeta_C = -xi_C.T\n    \n    K6_C = K6_A # Same K6 matrix\n    M_C = np.block([\n        [eps_C, xi_C],\n        [zeta_C, mu_C]\n    ])\n\n    _, vl_C, vr_C = eig(K6_C, M_C, left=True, right=True)\n\n    # C, wrong: Incorrect metric (no coupling)\n    M_C_wrong = np.block([\n        [eps_C, np.zeros((3,3))],\n        [np.zeros((3,3)), mu_C]\n    ])\n    norm_factors_C_wrong = np.einsum('ij,ik,kj->j', vl_C.conj(), M_C_wrong, vr_C)\n    vr_C_norm_wrong = vr_C / norm_factors_C_wrong\n\n    G_C_wrong = vl_C.conj().T @ M_C_wrong @ vr_C_norm_wrong\n    np.fill_diagonal(G_C_wrong, 0)\n    d_C_wrong = np.max(np.abs(G_C_wrong))\n    results.append(d_C_wrong)\n\n    # C, right: Correct metric\n    norm_factors_C_right = np.einsum('ij,ik,kj->j', vl_C.conj(), M_C, vr_C)\n    vr_C_norm_right = vr_C / norm_factors_C_right\n    \n    G_C_right = vl_C.conj().T @ M_C @ vr_C_norm_right\n    d_C_right = np.max(np.abs(G_C_right - np.eye(6)))\n    results.append(d_C_right)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3303766"}, {"introduction": "Normalization is not merely a mathematical convenience; it is deeply rooted in the physics of energy conservation. This advanced practice confronts the subtle but critical question of how to define stored energy in a dispersive medium, where permittivity $\\varepsilon(\\omega)$ is a function of frequency. You will derive the correct energy expression from the fundamental principles of causality and linear response theory, revealing that it involves the frequency derivative of the permittivity [@problem_id:3303727]. A numerical simulation will then starkly demonstrate how a naive, non-dispersive energy calculation can lead to the unphysical result of negative stored energy, highlighting the importance of this rigorous formulation.", "problem": "Consider eigenmode normalization in a linear, time-invariant, passive, and causal dispersive dielectric medium described by a scalar relative permittivity function $ \\varepsilon_r(\\omega) $ under the $ e^{-i \\omega t} $ time-harmonic convention. Start from first principles: the macroscopic Maxwell equations, the Poynting theorem for time-harmonic fields, and linear-response theory where the polarization $ \\mathbf{P}(t) $ is a causal convolution with a susceptibility $ \\chi(t) $ that vanishes for $ t < 0 $. Causality implies analyticity of $ \\varepsilon_r(\\omega) $ in the upper half of the complex-frequency plane and the Kramers–Kronig relations linking the real and imaginary parts. Passivity implies that the work done by fields is nonnegative for $ \\omega > 0 $, which enforces $ \\operatorname{Im} \\varepsilon_r(\\omega) \\ge 0 $ for $ \\omega > 0 $. Using these foundations, construct a principled argument that the correct electromagnetic energy inner product (and eigenmode normalization) in a dispersive medium must involve the derivative $ \\partial_{\\omega}(\\omega \\varepsilon(\\omega)) $ rather than $ \\varepsilon(\\omega) $ itself. Your argument must be based on the positivity of stored energy and the analyticity implied by causality, without appealing to any unproven shortcuts.\n\nThen, numerically demonstrate a counterexample showing that if dispersion is neglected in the normalization (i.e., if one uses $ \\varepsilon(\\omega) $ in place of $ \\partial_{\\omega}(\\omega \\varepsilon(\\omega)) $), the resulting electric energy density can become negative at some frequencies, violating passivity bounds. Use the single-pole Lorentz model for the scalar relative permittivity\n$$\n\\varepsilon_r(\\omega) \\;=\\; \\varepsilon_{\\infty} \\;+\\; \\Delta \\varepsilon \\,\\frac{\\omega_0^2}{\\omega_0^2 \\;-\\; \\omega^2 \\;-\\; i\\,\\gamma\\,\\omega},\n$$\nwith real parameters $ \\varepsilon_{\\infty} > 0 $, $ \\Delta \\varepsilon > 0 $, $ \\omega_0 > 0 $, and damping $ \\gamma \\ge 0 $. Let the absolute permittivity be $ \\varepsilon(\\omega) = \\varepsilon_0 \\,\\varepsilon_r(\\omega) $, where $ \\varepsilon_0 $ is the vacuum permittivity, and assume an isotropic medium.\n\nDefine the cycle-averaged electric energy density candidate with dispersive normalization,\n$$\nw_{\\mathrm{correct}}(\\omega) \\;=\\; \\frac{1}{4}\\,\\varepsilon_0 \\,\\operatorname{Re}\\!\\left[ \\frac{\\partial}{\\partial \\omega}\\bigl(\\omega \\,\\varepsilon_r(\\omega)\\bigr) \\right] \\,|\\mathbf{E}_0|^2,\n$$\nand the incorrect nondispersive surrogate,\n$$\nw_{\\mathrm{wrong}}(\\omega) \\;=\\; \\frac{1}{4}\\,\\varepsilon_0 \\,\\operatorname{Re}\\!\\left[ \\varepsilon_r(\\omega) \\right] \\,|\\mathbf{E}_0|^2,\n$$\nwhere $ \\mathbf{E}_0 $ is a prescribed field amplitude. For the Lorentz model above, implement the analytic derivative\n$$\n\\frac{\\partial \\varepsilon_r}{\\partial \\omega}(\\omega) \\;=\\; \\Delta \\varepsilon \\,\\omega_0^2 \\,\\frac{2\\omega \\;+\\; i\\,\\gamma}{\\left(\\omega_0^2 \\;-\\; \\omega^2 \\;-\\; i\\,\\gamma\\,\\omega\\right)^2},\n$$\nand then compute\n$$\n\\frac{\\partial}{\\partial \\omega}\\bigl(\\omega \\,\\varepsilon_r(\\omega)\\bigr) \\;=\\; \\varepsilon_r(\\omega) \\;+\\; \\omega \\,\\frac{\\partial \\varepsilon_r}{\\partial \\omega}(\\omega).\n$$\n\nUse the following fixed constants and test suite. Constants:\n- Vacuum permittivity: $ \\varepsilon_0 = 8.8541878128 \\times 10^{-12} \\,\\mathrm{F/m} $.\n- Field amplitude: $ |\\mathbf{E}_0| = 1.0 \\,\\mathrm{V/m} $.\n- Volume: $ V = 1.0 \\,\\mathrm{m}^3 $ (so that the energy density equals the total electric energy in joules for this unit-volume setting).\n- Material parameters: $ \\varepsilon_{\\infty} = 2.25 $, $ \\Delta \\varepsilon = 4.0 $, and $ \\omega_0 = 2\\pi \\times 2.0 \\times 10^{14} \\,\\mathrm{rad/s} $.\n\nTest suite of three parameter sets $ (\\gamma, \\omega) $:\n- Case $ \\mathbf{1} $ (happy path, far below resonance): $ \\gamma = 0.05\\,\\omega_0 $, $ \\omega = 0.50\\,\\omega_0 $.\n- Case $ \\mathbf{2} $ (counterexample, above resonance): $ \\gamma = 0.02\\,\\omega_0 $, $ \\omega = 1.05\\,\\omega_0 $.\n- Case $ \\mathbf{3} $ (near-resonant edge, small damping): $ \\gamma = 0.005\\,\\omega_0 $, $ \\omega = 1.005\\,\\omega_0 $.\n\nFor each case, compute:\n- $ w_{\\mathrm{correct}} $ in $ \\mathrm{J/m^3} $.\n- $ w_{\\mathrm{wrong}} $ in $ \\mathrm{J/m^3} $.\n- The ratio $ \\rho = w_{\\mathrm{wrong}} / w_{\\mathrm{correct}} $ (dimensionless), with safe handling when $ w_{\\mathrm{correct}} $ is numerically very small.\n- The boolean $ b_{\\mathrm{KK}} $ which is $ \\mathrm{True} $ if $ \\operatorname{Re}\\!\\left[\\partial_{\\omega}(\\omega \\varepsilon_r)\\right] \\ge 0 $ and $ \\mathrm{False} $ otherwise, as a numerical check of the positivity implied by causality and the Kramers–Kronig relations.\n- The boolean $ b_{\\mathrm{wrong}} $ which is $ \\mathrm{True} $ if $ w_{\\mathrm{wrong}} \\ge 0 $ and $ \\mathrm{False} $ otherwise, indicating whether the nondispersive surrogate violates the passivity bound $ w \\ge 0 $ for the electric contribution.\n\nAngle units are radians. All frequency-like quantities $ \\omega $, $ \\omega_0 $, and $ \\gamma $ must be treated in radians per second. The energies must be expressed in $ \\mathrm{J/m^3} $.\n\nYour program must compute the results for all three cases and produce a single line of output containing a flat list with the following order:\n$$\n\\bigl[w_{\\mathrm{correct}}^{(1)},\\; w_{\\mathrm{wrong}}^{(1)},\\; \\rho^{(1)},\\; b_{\\mathrm{KK}}^{(1)},\\; b_{\\mathrm{wrong}}^{(1)},\\; w_{\\mathrm{correct}}^{(2)},\\; w_{\\mathrm{wrong}}^{(2)},\\; \\rho^{(2)},\\; b_{\\mathrm{KK}}^{(2)},\\; b_{\\mathrm{wrong}}^{(2)},\\; w_{\\mathrm{correct}}^{(3)},\\; w_{\\mathrm{wrong}}^{(3)},\\; \\rho^{(3)},\\; b_{\\mathrm{KK}}^{(3)},\\; b_{\\mathrm{wrong}}^{(3)}\\bigr].\n$$\nFloats must be printed in scientific notation with exactly six significant digits, and booleans must be printed as $ \\mathrm{True} $ or $ \\mathrm{False} $. For example, a float should appear as $ 1.234570\\mathrm{e}{-03} $ and a boolean as $ \\mathrm{True} $. The final output must be a single line containing this list, with elements comma-separated and enclosed in square brackets, and no additional text. No user input is required. The code must be self-contained and runnable as is in the specified environment.", "solution": "The problem as stated is valid. It is scientifically grounded in the principles of classical electromagnetism and linear response theory, well-posed with a unique set of discoverable numerical results, and free of ambiguity or contradiction. We may proceed with a solution.\n\nThe core of the problem is to establish the correct expression for the cycle-averaged electric energy density in a linear, causal, passive, and dispersive dielectric medium. The standard, non-dispersive expression for electric energy density, $w_e = \\frac{1}{2} \\mathbf{D} \\cdot \\mathbf{E} = \\frac{1}{2}\\varepsilon |\\mathbf{E}|^2$, is insufficient because the relationship between $\\mathbf{D}$ and $\\mathbf{E}$ is history-dependent (non-local in time), which in the frequency domain manifests as a frequency-dependent permittivity $\\varepsilon(\\omega)$.\n\nOur derivation begins with the macroscopic Maxwell's equations and the Poynting theorem, which expresses the conservation of energy. In a source-free region, the microscopic Poynting theorem is:\n$$\n-\\nabla \\cdot (\\mathbf{E} \\times \\mathbf{H}) = \\mathbf{E} \\cdot \\frac{\\partial \\mathbf{D}}{\\partial t} + \\mathbf{H} \\cdot \\frac{\\partial \\mathbf{B}}{\\partial t}\n$$\nThe term on the left is the power flowing out of a differential volume. The terms on the right represent the rate at which the fields do work on the medium, which is divided between stored energy and dissipated energy (heat). We focus on the electric field contribution, $\\mathbf{E} \\cdot \\frac{\\partial \\mathbf{D}}{\\partial t}$.\n\nFor a strictly monochromatic field, e.g., $\\mathbf{E}(t) = \\operatorname{Re}[\\mathbf{E}_0 e^{-i\\omega t}]$, the system is in a steady state. The cycle-average of the rate of change of stored energy is, by definition, zero. The cycle-average of $\\mathbf{E} \\cdot \\frac{\\partial \\mathbf{D}}{\\partial t}$ yields only the average power dissipated as heat, $Q$.\n$$\nQ = \\langle \\mathbf{E} \\cdot \\frac{\\partial \\mathbf{D}}{\\partial t} \\rangle = \\frac{\\omega}{2} \\operatorname{Im}[\\varepsilon(\\omega)] |\\mathbf{E}_0|^2\n$$\nSince passivity requires that the medium cannot be a source of energy, we must have $Q \\ge 0$, which implies $\\operatorname{Im}[\\varepsilon(\\omega)] \\ge 0$ for $\\omega > 0$.\n\nTo find the stored energy, we must consider the energy required to establish the field from zero. This necessitates a non-monochromatic field. A physically intuitive and mathematically rigorous approach is to consider a quasi-monochromatic field, whose amplitude varies slowly compared to its oscillation period. We represent such a field as:\n$$\n\\mathbf{E}(t) = \\operatorname{Re}\\left[ \\mathbf{E}_0(t) e^{-i\\omega_c t} \\right]\n$$\nwhere $\\mathbf{E}_0(t)$ is the slowly varying complex envelope and $\\omega_c$ is the carrier frequency. Because $\\mathbf{E}_0(t)$ is slow, its Fourier spectrum $\\mathbf{E}_0(\\omega')$ is sharply peaked around $\\omega'=0$. The spectrum of $\\mathbf{E}(t)$ is correspondingly peaked around $\\omega = \\pm \\omega_c$.\n\nThe constitutive relation in the frequency domain is $\\mathbf{D}(\\omega) = \\varepsilon(\\omega)\\mathbf{E}(\\omega)$. For our quasi-monochromatic field, this means the spectrum of the displacement envelope $\\mathbf{D}_0(t)$ is given by $\\mathbf{D}_0(\\omega') = \\varepsilon(\\omega_c + \\omega') \\mathbf{E}_0(\\omega')$. Since $\\mathbf{E}_0(\\omega')$ is non-zero only for small $\\omega'$, we can Taylor-expand $\\varepsilon(\\omega_c + \\omega')$ about $\\omega_c$:\n$$\n\\varepsilon(\\omega_c + \\omega') \\approx \\varepsilon(\\omega_c) + \\omega' \\frac{d\\varepsilon}{d\\omega}\\bigg|_{\\omega=\\omega_c}\n$$\nSubstituting this back, we get:\n$$\n\\mathbf{D}_0(\\omega') \\approx \\varepsilon(\\omega_c) \\mathbf{E}_0(\\omega') + \\frac{d\\varepsilon}{d\\omega}\\bigg|_{\\omega_c} (\\omega' \\mathbf{E}_0(\\omega'))\n$$\nTo return to the time domain, we apply the inverse Fourier transform. Multiplication by $\\omega'$ in the frequency domain corresponds to the operator $i \\frac{d}{dt}$ in the time domain. Thus, the time-domain envelope relation is:\n$$\n\\mathbf{D}_0(t) \\approx \\varepsilon(\\omega_c) \\mathbf{E}_0(t) + i \\frac{d\\varepsilon}{d\\omega}\\bigg|_{\\omega=\\omega_c} \\frac{d\\mathbf{E}_0(t)}{dt}\n$$\nNow we compute the cycle-averaged rate of work done by the field, $\\langle\\mathbf{E} \\cdot \\frac{\\partial \\mathbf{D}}{\\partial t}\\rangle$. This average must equal the sum of the dissipated power $Q$ and the rate of change of the stored energy density $dw_e/dt$. After a detailed calculation involving substituting the envelope expressions for $\\mathbf{E}(t)$ and $\\mathbf{D}(t)$ and averaging over one cycle (which annihilates rapidly oscillating terms), we find:\n$$\n\\langle\\mathbf{E} \\cdot \\frac{\\partial \\mathbf{D}}{\\partial t}\\rangle = \\frac{\\omega_c}{2}\\operatorname{Im}[\\varepsilon(\\omega_c)]|\\mathbf{E}_0|^2 + \\frac{1}{4} \\frac{d}{dt} \\left( \\operatorname{Re}\\left[ \\frac{d}{d\\omega}(\\omega\\varepsilon(\\omega))\\right]_{\\omega=\\omega_c} |\\mathbf{E}_0|^2 \\right)\n$$\nIdentifying the terms, the first is the known expression for dissipated power $Q$. The second term must therefore be the rate of change of the stored electric energy density, $dw_e/dt$. By integrating this with respect to time, we identify the cycle-averaged electric energy density, which we denote $w_{\\mathrm{correct}}$:\n$$\nw_{\\mathrm{correct}}(\\omega) = \\frac{1}{4} \\operatorname{Re}\\left[ \\frac{d}{d\\omega}\\bigl(\\omega\\varepsilon(\\omega)\\bigr) \\right] |\\mathbf{E}_0|^2\n$$\nSubstituting $\\varepsilon(\\omega) = \\varepsilon_0 \\varepsilon_r(\\omega)$ yields the expression provided in the problem statement. The term $\\frac{d}{d\\omega}(\\omega\\varepsilon) = \\varepsilon + \\omega\\frac{d\\varepsilon}{d\\omega}$ contains two contributions: the first, $\\varepsilon$, is related to the instantaneous field polarization, while the second, $\\omega\\frac{d\\varepsilon}{d\\omega}$, accounts for the additional energy stored in the kinetic and potential energy of the oscillating charges (e.g., electrons bound in atoms) that give rise to the dispersion.\n\nFor a passive medium, physical stability demands that the total energy density be non-negative, $w_{\\mathrm{correct}} \\ge 0$. The causality of the medium (response cannot precede stimulus) implies that $\\varepsilon_r(\\omega)$ is an analytic function in the upper half of the complex frequency plane. This property, combined with passivity ($\\operatorname{Im}[\\varepsilon_r(\\omega)] \\ge 0$ for $\\omega > 0$), leads via the Kramers–Kronig relations to the general result that for any passive medium:\n$$\n\\operatorname{Re}\\left[ \\frac{d}{d\\omega}\\bigl(\\omega\\,\\varepsilon_r(\\omega)\\bigr) \\right] \\ge 0\n$$\nThis guarantees the positivity of the correctly formulated energy density. In contrast, the naive surrogate $w_{\\mathrm{wrong}}$, based on replacing $\\frac{d}{d\\omega}(\\omega\\varepsilon)$ with just $\\varepsilon$, can become negative. In regions of anomalous dispersion, which often occur just above a resonance frequency $\\omega_0$, the real part of the permittivity $\\operatorname{Re}[\\varepsilon_r(\\omega)]$ can be negative. This would imply a negative energy density, a clear violation of thermodynamic stability, demonstrating why $w_{\\mathrm{wrong}}$ is an incorrect formulation. The numerical section will demonstrate this physical absurdity.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes correct and incorrect energy densities for a dispersive Lorentz medium\n    to demonstrate the importance of the dispersive normalization term.\n    \"\"\"\n    # Define the constants from the problem statement.\n    # Vacuum permittivity in F/m\n    eps0 = 8.8541878128e-12\n    # Electric field amplitude squared in (V/m)^2\n    E0_sq = 1.0**2\n    \n    # Define the material parameters for the Lorentz model.\n    # High-frequency permittivity limit\n    eps_inf = 2.25\n    # Oscillator strength\n    delta_eps = 4.0\n    # Resonance frequency in rad/s\n    omega0 = 2.0 * np.pi * 2.0e14\n\n    # Define the test suite of parameter sets (gamma, omega).\n    # gamma is damping rate, omega is evaluation frequency.\n    test_cases = [\n        # Case 1: Far below resonance\n        (0.05 * omega0, 0.50 * omega0),\n        # Case 2: Above resonance (counterexample region)\n        (0.02 * omega0, 1.05 * omega0),\n        # Case 3: Near-resonant edge with small damping\n        (0.005 * omega0, 1.005 * omega0),\n    ]\n\n    # List to store the flat results for all cases.\n    results = []\n\n    for gamma, omega in test_cases:\n        # Use complex numbers for calculation convenience.\n        omega_c = complex(omega)\n        gamma_c = complex(gamma)\n\n        omega_sq = omega_c**2\n        omega0_sq = omega0**2\n        \n        # Denominator of the Lorentz model fraction\n        denominator = omega0_sq - omega_sq - 1j * gamma_c * omega_c\n        \n        # Calculate relative permittivity eps_r(omega)\n        eps_r = eps_inf + delta_eps * omega0_sq / denominator\n        \n        # Calculate the derivative of relative permittivity d(eps_r)/d(omega)\n        # using the provided analytical formula.\n        numerator_deriv = 2.0 * omega_c + 1j * gamma_c\n        deriv_eps_r = delta_eps * omega0_sq * numerator_deriv / (denominator**2)\n        \n        # Calculate the full dispersive term d(omega * eps_r)/d(omega)\n        d_omega_eps_r_full = eps_r + omega_c * deriv_eps_r\n        \n        # Calculate w_correct: the correct, dispersive energy density\n        w_correct = 0.25 * eps0 * E0_sq * d_omega_eps_r_full.real\n        \n        # Calculate w_wrong: the incorrect, non-dispersive surrogate\n        w_wrong = 0.25 * eps0 * E0_sq * eps_r.real\n        \n        # Calculate the ratio rho = w_wrong / w_correct with safe division.\n        # The theory guarantees w_correct >= 0. We use a small tolerance.\n        if abs(w_correct) < 1e-30:\n            rho = np.inf if w_wrong != 0.0 else 0.0\n        else:\n            rho = w_wrong / w_correct\n\n        # b_KK: Check if the Kramers-Kronig-derived positivity holds.\n        b_KK = (d_omega_eps_r_full.real >= 0.0)\n        \n        # b_wrong: Check if the incorrect energy density is non-negative.\n        b_wrong = (w_wrong >= 0.0)\n        \n        # Extend the master results list with the results for this case.\n        results.extend([w_correct, w_wrong, rho, b_KK, b_wrong])\n\n    # Format the final list for printing as per the specified format.\n    formatted_results = []\n    for item in results:\n        if isinstance(item, (bool, np.bool_)):\n            # Format booleans as True/False strings.\n            formatted_results.append(str(item))\n        elif isinstance(item, (float, np.floating)):\n            # Format floats to scientific notation with 6 significant digits.\n            formatted_results.append(f\"{item:.6e}\")\n    \n    # The final print statement must produce only the specified single-line format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3303727"}]}