{"hands_on_practices": [{"introduction": "The foundation of the finite element method lies in calculations performed on a simple, standardized geometric shape known as a reference element. This practice guides you through the essential process of deriving the local stiffness ($K$) and mass ($M$) matrices for lowest-order Nédélec vector elements on a reference triangle [@problem_id:3334007]. By working through these calculations from first principles, you will gain a concrete understanding of how the continuous differential operators in Maxwell's equations are translated into discrete matrix forms.", "problem": "Consider the reference triangle $\\hat{K} = \\{(x,y) \\in \\mathbb{R}^{2} : x \\ge 0,\\, y \\ge 0,\\, x + y \\le 1\\}$ with barycentric coordinates $\\lambda_{1} = 1 - x - y$, $\\lambda_{2} = x$, and $\\lambda_{3} = y$. In computational electromagnetics using the Finite Element Method (FEM), the lowest-order Nédélec first-kind edge elements on $\\hat{K}$ are defined via the basis functions associated with the three edges:\n$$\\boldsymbol{\\phi}_{1} = \\lambda_{1} \\nabla \\lambda_{2} - \\lambda_{2} \\nabla \\lambda_{1}, \\quad \\boldsymbol{\\phi}_{2} = \\lambda_{2} \\nabla \\lambda_{3} - \\lambda_{3} \\nabla \\lambda_{2}, \\quad \\boldsymbol{\\phi}_{3} = \\lambda_{3} \\nabla \\lambda_{1} - \\lambda_{1} \\nabla \\lambda_{3}.$$\nAssume constant magnetic permeability $\\mu > 0$ and electric permittivity $\\epsilon > 0$ on $\\hat{K}$. In two spatial dimensions, for a planar vector field $\\boldsymbol{w}(x,y) = (w_{x}(x,y), w_{y}(x,y))$, define the scalar curl as\n$$\\nabla \\times \\boldsymbol{w} = \\frac{\\partial w_{y}}{\\partial x} - \\frac{\\partial w_{x}}{\\partial y}.$$\nStarting from the weak-form energy bilinear forms arising from Maxwell’s equations,\n$$a(\\boldsymbol{u}, \\boldsymbol{v}) = \\int_{\\hat{K}} \\mu^{-1} \\left(\\nabla \\times \\boldsymbol{u}\\right) \\left(\\nabla \\times \\boldsymbol{v}\\right) \\, \\mathrm{d}x\\,\\mathrm{d}y, \\qquad m(\\boldsymbol{u}, \\boldsymbol{v}) = \\int_{\\hat{K}} \\epsilon \\, \\boldsymbol{u} \\cdot \\boldsymbol{v} \\, \\mathrm{d}x\\,\\mathrm{d}y,$$\nderive the $3 \\times 3$ local element matrices $\\mathbf{K}$ and $\\mathbf{M}$ with entries\n$$K_{ij} = a(\\boldsymbol{\\phi}_{i}, \\boldsymbol{\\phi}_{j}), \\qquad M_{ij} = m(\\boldsymbol{\\phi}_{i}, \\boldsymbol{\\phi}_{j}), \\quad i,j \\in \\{1,2,3\\}.$$\nThen, consider the generalized eigenvalue problem on $\\hat{K}$,\n$$\\mathbf{K} \\mathbf{a} = \\lambda \\, \\mathbf{M} \\mathbf{a},$$\nand compute the largest eigenvalue $\\lambda_{\\max}$ as a closed-form analytic expression in $\\mu$ and $\\epsilon$. Express the final answer as a single closed-form expression. No rounding is required.", "solution": "We begin by specifying the barycentric coordinates on the reference triangle $\\hat{K}$:\n$$\\lambda_{1} = 1 - x - y, \\quad \\lambda_{2} = x, \\quad \\lambda_{3} = y,$$\nwith gradients\n$$\\nabla \\lambda_{1} = \\begin{pmatrix}-1 \\\\ -1\\end{pmatrix}, \\quad \\nabla \\lambda_{2} = \\begin{pmatrix}1 \\\\ 0\\end{pmatrix}, \\quad \\nabla \\lambda_{3} = \\begin{pmatrix}0 \\\\ 1\\end{pmatrix}.$$\nThe lowest-order Nédélec first-kind edge basis functions are\n\n$$\n\\boldsymbol{\\phi}_{1} = \\lambda_{1} \\nabla \\lambda_{2} - \\lambda_{2} \\nabla \\lambda_{1}, \\quad\n\\boldsymbol{\\phi}_{2} = \\lambda_{2} \\nabla \\lambda_{3} - \\lambda_{3} \\nabla \\lambda_{2}, \\quad\n\\boldsymbol{\\phi}_{3} = \\lambda_{3} \\nabla \\lambda_{1} - \\lambda_{1} \\nabla \\lambda_{3}.\n$$\n\nSubstituting the barycentric quantities, we obtain explicit forms:\n\n$$\n\\boldsymbol{\\phi}_{1} = \\lambda_{1} \\begin{pmatrix}1 \\\\ 0\\end{pmatrix} - \\lambda_{2} \\begin{pmatrix}-1 \\\\ -1\\end{pmatrix}\n= \\begin{pmatrix} \\lambda_{1} + \\lambda_{2} \\\\ \\lambda_{2} \\end{pmatrix}\n= \\begin{pmatrix} 1 - y \\\\ x \\end{pmatrix},\n$$\n\n\n$$\n\\boldsymbol{\\phi}_{2} = \\lambda_{2} \\begin{pmatrix}0 \\\\ 1\\end{pmatrix} - \\lambda_{3} \\begin{pmatrix}1 \\\\ 0\\end{pmatrix}\n= \\begin{pmatrix} - \\lambda_{3} \\\\ \\lambda_{2} \\end{pmatrix}\n= \\begin{pmatrix} - y \\\\ x \\end{pmatrix},\n$$\n\n\n$$\n\\boldsymbol{\\phi}_{3} = \\lambda_{3} \\begin{pmatrix}-1 \\\\ -1\\end{pmatrix} - \\lambda_{1} \\begin{pmatrix}0 \\\\ 1\\end{pmatrix}\n= \\begin{pmatrix} - \\lambda_{3} \\\\ -\\lambda_{3} - \\lambda_{1} \\end{pmatrix}\n= \\begin{pmatrix} - y \\\\ x - 1 \\end{pmatrix}.\n$$\n\nNext, we compute the scalar curl of each $\\boldsymbol{\\phi}_{i}$ using $\\nabla \\times \\boldsymbol{w} = \\partial w_{y}/\\partial x - \\partial w_{x}/\\partial y$:\n\n$$\n\\nabla \\times \\boldsymbol{\\phi}_{1} = \\frac{\\partial}{\\partial x}(x) - \\frac{\\partial}{\\partial y}(1 - y) = 1 - (-1) = 2,\n$$\n\n\n$$\n\\nabla \\times \\boldsymbol{\\phi}_{2} = \\frac{\\partial}{\\partial x}(x) - \\frac{\\partial}{\\partial y}(-y) = 1 - (-1) = 2,\n$$\n\n\n$$\n\\nabla \\times \\boldsymbol{\\phi}_{3} = \\frac{\\partial}{\\partial x}(x - 1) - \\frac{\\partial}{\\partial y}(-y) = 1 - (-1) = 2.\n$$\n\nTherefore, each curl is the constant $2$ on $\\hat{K}$. The local stiffness matrix entries are\n\n$$\nK_{ij} = \\int_{\\hat{K}} \\mu^{-1} \\left(\\nabla \\times \\boldsymbol{\\phi}_{i}\\right)\\left(\\nabla \\times \\boldsymbol{\\phi}_{j}\\right) \\, \\mathrm{d}x\\,\\mathrm{d}y\n= \\mu^{-1} \\int_{\\hat{K}} 4 \\, \\mathrm{d}x\\,\\mathrm{d}y\n= 4 \\mu^{-1} |\\hat{K}|.\n$$\n\nSince the area of the reference triangle is $|\\hat{K}| = \\frac{1}{2}$, we have\n\n$$\nK_{ij} = 2 \\mu^{-1} \\quad \\text{for all } i,j \\in \\{1,2,3\\}.\n$$\n\nThus $\\mathbf{K} = 2 \\mu^{-1} \\mathbf{J}$ where $\\mathbf{J}$ is the $3 \\times 3$ matrix of all ones.\n\nWe now derive the local mass matrix $\\mathbf{M}$ with entries $M_{ij} = \\int_{\\hat{K}} \\epsilon \\, \\boldsymbol{\\phi}_{i} \\cdot \\boldsymbol{\\phi}_{j} \\, \\mathrm{d}x\\,\\mathrm{d}y$. First compute the dot products:\n\n$$\n\\boldsymbol{\\phi}_{1} \\cdot \\boldsymbol{\\phi}_{1} = (1 - y)^{2} + x^{2} = 1 - 2y + y^{2} + x^{2},\n$$\n\n\n$$\n\\boldsymbol{\\phi}_{2} \\cdot \\boldsymbol{\\phi}_{2} = (-y)^{2} + x^{2} = y^{2} + x^{2},\n$$\n\n\n$$\n\\boldsymbol{\\phi}_{3} \\cdot \\boldsymbol{\\phi}_{3} = (-y)^{2} + (x - 1)^{2} = y^{2} + x^{2} - 2x + 1,\n$$\n\n\n$$\n\\boldsymbol{\\phi}_{1} \\cdot \\boldsymbol{\\phi}_{2} = (1 - y)(-y) + x x = -y + y^{2} + x^{2},\n$$\n\n\n$$\n\\boldsymbol{\\phi}_{1} \\cdot \\boldsymbol{\\phi}_{3} = (1 - y)(-y) + x(x - 1) = -y + y^{2} + x^{2} - x,\n$$\n\n\n$$\n\\boldsymbol{\\phi}_{2} \\cdot \\boldsymbol{\\phi}_{3} = (-y)(-y) + x(x - 1) = y^{2} + x^{2} - x.\n$$\n\nWe use the monomial integral identities over $\\hat{K}$:\n\n$$\n\\int_{\\hat{K}} 1 \\, \\mathrm{d}x\\,\\mathrm{d}y = \\frac{1}{2}, \\quad\n\\int_{\\hat{K}} x \\, \\mathrm{d}x\\,\\mathrm{d}y = \\frac{1}{6}, \\quad \\int_{\\hat{K}} y \\, \\mathrm{d}x\\,\\mathrm{d}y = \\frac{1}{6}, \\quad\n\\int_{\\hat{K}} x^{2} \\, \\mathrm{d}x\\,\\mathrm{d}y = \\frac{1}{12}, \\quad \\int_{\\hat{K}} y^{2} \\, \\mathrm{d}x\\,\\mathrm{d}y = \\frac{1}{12},\n$$\n\nwhich follow from the general formula for integers $p,q \\ge 0$:\n\n$$\n\\int_{\\hat{K}} x^{p} y^{q} \\, \\mathrm{d}x\\,\\mathrm{d}y = \\frac{p! q!}{(p+q+2)!}.\n$$\n\nEvaluating each entry:\n\n$$\nM_{11} = \\epsilon \\int_{\\hat{K}} \\left(1 - 2y + y^{2} + x^{2}\\right) \\mathrm{d}x\\,\\mathrm{d}y\n= \\epsilon \\left( \\frac{1}{2} - 2 \\cdot \\frac{1}{6} + \\frac{1}{12} + \\frac{1}{12} \\right)\n= \\epsilon \\left( \\frac{1}{2} - \\frac{1}{3} + \\frac{1}{6} \\right)\n= \\epsilon \\cdot \\frac{1}{3},\n$$\n\n\n$$\nM_{22} = \\epsilon \\int_{\\hat{K}} \\left(y^{2} + x^{2}\\right) \\mathrm{d}x\\,\\mathrm{d}y\n= \\epsilon \\left( \\frac{1}{12} + \\frac{1}{12} \\right)\n= \\epsilon \\cdot \\frac{1}{6},\n$$\n\n\n$$\nM_{33} = \\epsilon \\int_{\\hat{K}} \\left(y^{2} + x^{2} - 2x + 1\\right) \\mathrm{d}x\\,\\mathrm{d}y\n= \\epsilon \\left( \\frac{1}{12} + \\frac{1}{12} - 2 \\cdot \\frac{1}{6} + \\frac{1}{2} \\right)\n= \\epsilon \\left( \\frac{1}{6} - \\frac{1}{3} + \\frac{1}{2} \\right)\n= \\epsilon \\cdot \\frac{1}{3},\n$$\n\n\n$$\nM_{12} = \\epsilon \\int_{\\hat{K}} \\left( -y + y^{2} + x^{2} \\right) \\mathrm{d}x\\,\\mathrm{d}y\n= \\epsilon \\left( -\\frac{1}{6} + \\frac{1}{12} + \\frac{1}{12} \\right)\n= \\epsilon \\cdot 0,\n$$\n\n\n$$\nM_{13} = \\epsilon \\int_{\\hat{K}} \\left( -y + y^{2} + x^{2} - x \\right) \\mathrm{d}x\\,\\mathrm{d}y\n= \\epsilon \\left( -\\frac{1}{6} + \\frac{1}{12} + \\frac{1}{12} - \\frac{1}{6} \\right)\n= \\epsilon \\cdot \\left( -\\frac{1}{6} \\right),\n$$\n\n\n$$\nM_{23} = \\epsilon \\int_{\\hat{K}} \\left( y^{2} + x^{2} - x \\right) \\mathrm{d}x\\,\\mathrm{d}y\n= \\epsilon \\left( \\frac{1}{12} + \\frac{1}{12} - \\frac{1}{6} \\right)\n= \\epsilon \\cdot 0.\n$$\n\nCollecting, the mass matrix is\n\n$$\n\\mathbf{M} = \\epsilon \\begin{pmatrix}\n\\frac{1}{3} & 0 & -\\frac{1}{6} \\\\\n0 & \\frac{1}{6} & 0 \\\\\n-\\frac{1}{6} & 0 & \\frac{1}{3}\n\\end{pmatrix}.\n$$\n\nWe now consider the generalized eigenvalue problem $\\mathbf{K} \\mathbf{a} = \\lambda \\mathbf{M} \\mathbf{a}$. Because $\\mathbf{K} = 2 \\mu^{-1} \\mathbf{J}$ has rank one with $\\mathbf{J}$ the all-ones matrix, any vector $\\mathbf{a}$ with components summing to zero lies in the nullspace of $\\mathbf{K}$, yielding $\\lambda = 0$ for those modes (since $\\mathbf{M}$ is positive definite). The nontrivial mode aligns with the eigenvector of $\\mathbf{J}$, namely $\\mathbf{a} = \\begin{pmatrix}1 \\\\ 1 \\\\ 1\\end{pmatrix}$. For this vector,\n\n$$\n\\mathbf{K} \\mathbf{a} = 2 \\mu^{-1} \\mathbf{J} \\begin{pmatrix}1 \\\\ 1 \\\\ 1\\end{pmatrix}\n= 2 \\mu^{-1} \\begin{pmatrix}3 \\\\ 3 \\\\ 3\\end{pmatrix}\n= 6 \\mu^{-1} \\begin{pmatrix}1 \\\\ 1 \\\\ 1\\end{pmatrix}.\n$$\n\nCompute $\\mathbf{M} \\mathbf{a}$:\n\n$$\n\\mathbf{M} \\begin{pmatrix}1 \\\\ 1 \\\\ 1\\end{pmatrix}\n= \\epsilon \\begin{pmatrix}\n\\frac{1}{3} - \\frac{1}{6} \\\\\n\\frac{1}{6} \\\\\n-\\frac{1}{6} + \\frac{1}{3}\n\\end{pmatrix}\n= \\epsilon \\begin{pmatrix}\n\\frac{1}{6} \\\\\n\\frac{1}{6} \\\\\n\\frac{1}{6}\n\\end{pmatrix}\n= \\frac{\\epsilon}{6} \\begin{pmatrix}1 \\\\ 1 \\\\ 1\\end{pmatrix}.\n$$\n\nTherefore, the corresponding generalized eigenvalue $\\lambda$ satisfies\n\n$$\n6 \\mu^{-1} \\begin{pmatrix}1 \\\\ 1 \\\\ 1\\end{pmatrix} = \\lambda \\cdot \\frac{\\epsilon}{6} \\begin{pmatrix}1 \\\\ 1 \\\\ 1\\end{pmatrix},\n$$\n\nso\n\n$$\n\\lambda = \\frac{6 \\mu^{-1}}{\\epsilon/6} = \\frac{36 \\mu^{-1}}{\\epsilon} = \\frac{36}{\\mu \\epsilon}.\n$$\n\nSince the other two generalized eigenvalues are zero, this is the largest eigenvalue:\n\n$$\n\\lambda_{\\max} = \\frac{36}{\\mu \\epsilon}.\n$$\n\nThis completes the derivation of the local element matrices and the computation of the largest generalized eigenvalue on the reference element.", "answer": "$$\\boxed{\\frac{36}{\\mu \\epsilon}}$$", "id": "3334007"}, {"introduction": "After computing local element matrices, the next critical step is assembling them into a global system that represents the entire problem domain. For vector finite elements, this process requires careful handling of orientations to ensure physical continuity across element boundaries. This exercise [@problem_id:3334058] explores the vital role of local-to-global sign conventions and demonstrates computationally the serious errors that arise from inconsistent orientation, reinforcing the importance of this practical implementation detail.", "problem": "Consider the lowest-order edge (vector) finite elements of Nédélec’s first kind on a two-dimensional mesh used for the Finite Element Method (FEM) discretization of fields in the Sobolev space $H(\\mathrm{curl})$. Degrees of Freedom (DOF) for these elements are associated with the line integral of the tangential component of the field along oriented edges. In parallel, consider the lowest-order normal flux elements of Raviart–Thomas type on $H(\\mathrm{div})$, where DOFs are associated with the integral of the normal component across oriented edges (in two dimensions) or faces (in three dimensions).\n\nPart I (conceptual): Starting from the definitions of $H(\\mathrm{curl})$ and $H(\\mathrm{div})$, explain how local-to-global orientation and sign conventions for edges (for $H(\\mathrm{curl})$ tangential DOFs) and edges/faces (for $H(\\mathrm{div})$ normal DOFs) ensure consistent assembly. In particular, justify why reversing the local orientation of an edge or face induces a sign change in the associated DOF and how this sign must be accounted for during assembly so that tangential or normal continuity is respected across element interfaces.\n\nPart II (computational): Consider the unit square $\\Omega=[0,1]^{2}$ partitioned into two triangles\n$$\nK_{1}=\\mathrm{conv}\\{(0,0),(1,0),(0,1)\\}, \\qquad K_{2}=\\mathrm{conv}\\{(1,0),(1,1),(0,0)\\},\n$$\nsharing the horizontal edge $E=\\mathrm{conv}\\{(0,0),(1,0)\\}$, globally oriented from $(0,0)$ to $(1,0)$. On each triangle, use the lowest-order Nédélec basis given by Whitney $1$-forms. Let the local vertex labels on $K_{1}$ be $(1,2,3)=( (0,0),(1,0),(0,1) )$, and on $K_{2}$ be $(1,2,3)=( (1,0),(1,1),(0,0) )$. Denote the three local edge basis functions on a triangle $K$ by\n$$\n\\mathbf{w}_{ij}=\\lambda_{i}\\nabla\\lambda_{j}-\\lambda_{j}\\nabla\\lambda_{i}, \\quad (i,j)\\in\\{(1,2),(2,3),(3,1)\\},\n$$\nwhere $\\lambda_{i}$ are the barycentric coordinates on $K$ and $\\nabla\\lambda_{i}$ are constant on $K$.\n\nDefine the local $L^{2}$ mass matrix on each triangle by\n$$\nM_{ab}^{K}=\\int_{K}\\mathbf{w}_{a}\\cdot\\mathbf{w}_{b}\\,\\mathrm{d}x,\n$$\nwith $a,b$ indexing the local edges $(12),(23),(31)$ on $K$. Assemble the global mass matrix $M$ for the five global edge DOFs corresponding to the edges of the mesh, using the standard local-to-global map with orientation signs. Consider the global DOF vector $\\mathbf{x}\\in\\mathbb{R}^{5}$ whose entries are all equal to $1$.\n\nLet $R_{\\mathrm{good}}=\\mathbf{x}^{\\top}M_{\\mathrm{good}}\\mathbf{x}$ be the quadratic form value with consistent orientation on both elements, meaning the shared edge’s local orientation on $K_{2}$ is taken as $(3\\to 1)$ to match the global orientation $(0,0)\\to(1,0)$. Let $R_{\\mathrm{bad}}=\\mathbf{x}^{\\top}M_{\\mathrm{bad}}\\mathbf{x}$ be the value when the assembly on $K_{2}$ uses the opposite local orientation sign for the shared edge (i.e., mapping the shared edge with a sign inconsistent with the global orientation). Using only the definitions above and well-tested facts about barycentric coordinates, compute the exact difference\n$$\n\\Delta R=R_{\\mathrm{bad}}-R_{\\mathrm{good}}.\n$$\n\nExpress the final answer as an exact rational number with no units. No rounding is required, and no units should be attached to the final scalar.", "solution": "The problem consists of two parts. Part I is a conceptual explanation of orientation conventions in finite element methods for $H(\\mathrm{curl})$ and $H(\\mathrm{div})$ spaces. Part II is a specific computation of the effect of an orientation error on a quadratic form involving the mass matrix.\n\n### Part I: Conceptual Explanation\n\nThe Sobolev spaces $H(\\mathrm{curl})$ and $H(\\mathrm{div})$ are fundamental in the variational formulation of Maxwell's equations. They are defined as:\n$$\nH(\\mathrm{curl}) = \\{ \\mathbf{u} \\in (L^2(\\Omega))^d \\mid \\nabla \\times \\mathbf{u} \\in (L^2(\\Omega))^{d'} \\}\n$$\n$$\nH(\\mathrm{div}) = \\{ \\mathbf{u} \\in (L^2(\\Omega))^d \\mid \\nabla \\cdot \\mathbf{u} \\in L^2(\\Omega) \\}\n$$\nwhere $\\Omega \\subset \\mathbb{R}^d$ is the domain. A key property of functions in $H(\\mathrm{curl})$ is the continuity of their tangential components across element interfaces. Specifically, for a vector field $\\mathbf{u} \\in H(\\mathrm{curl})$, the trace $\\mathbf{u} \\times \\mathbf{n}$ is single-valued across any interior edge or face with normal $\\mathbf{n}$. Similarly, for a vector field $\\mathbf{v} \\in H(\\mathrm{div})$, the normal component $\\mathbf{v} \\cdot \\mathbf{n}$ is continuous across interfaces.\n\nThe finite element methods for these spaces, such as Nédélec for $H(\\mathrm{curl})$ and Raviart–Thomas for $H(\\mathrm{div})$, are designed to enforce these continuity properties discretely. This is achieved through the choice of Degrees of Freedom (DOFs).\n\nFor lowest-order Nédélec edge elements ($H(\\mathrm{curl})$), the DOFs are the line integrals of the field's tangential component along each edge $e$ of the mesh:\n$$\n\\text{DOF}_e(\\mathbf{u}) = \\int_e \\mathbf{u} \\cdot \\boldsymbol{\\tau} \\, \\mathrm{d}s\n$$\nwhere $\\boldsymbol{\\tau}$ is a unit tangent vector defining the orientation of edge $e$.\n\nFor lowest-order Raviart–Thomas elements ($H(\\mathrm{div})$), the DOFs are the fluxes of the field's normal component across each edge $e$ (in 2D) or face $f$ (in 3D):\n$$\n\\text{DOF}_e(\\mathbf{v}) = \\int_e \\mathbf{v} \\cdot \\mathbf{n} \\, \\mathrm{d}s\n$$\nwhere $\\mathbf{n}$ is a unit normal vector defining the orientation of the edge/face.\n\nThe value of these DOFs is fundamentally tied to the chosen orientation. If the orientation of an edge is reversed, the corresponding tangent vector changes sign, $\\boldsymbol{\\tau} \\to -\\boldsymbol{\\tau}$, and the normal vector also changes sign, $\\mathbf{n} \\to -\\mathbf{n}$. By the linearity of the integral, this induces a sign change in the DOF value:\n$$\n\\int_e \\mathbf{u} \\cdot (-\\boldsymbol{\\tau}) \\, \\mathrm{d}s = - \\int_e \\mathbf{u} \\cdot \\boldsymbol{\\tau} \\, \\mathrm{d}s\n$$\nThus, reversing the local orientation of an edge or face flips the sign of the associated DOF.\n\nTo ensure global continuity of the tangential or normal components, a consistent assembly process is required. First, a unique global orientation is assigned to every edge (or face) in the mesh. Inside each element $K$, the local basis functions are defined with respect to local edge orientations (e.g., from vertex $i$ to vertex $j$). When assembling the global system from local contributions, one must compare the local orientation of an edge on element $K$ to its prescribed global orientation.\n\nLet an edge $e$ be shared by two elements, $K_1$ and $K_2$. The tangential continuity of $\\mathbf{u}$ requires that $\\mathbf{u}|_{K_1} \\cdot \\boldsymbol{\\tau} = \\mathbf{u}|_{K_2} \\cdot \\boldsymbol{\\tau}$ along $e$, where $\\boldsymbol{\\tau}$ is the tangent for the global orientation of $e$. This implies that the DOF associated with $e$ must have a single, well-defined value in the global system. Let a local edge $e_{loc}^{K_1}$ on $K_1$ and $e_{loc}^{K_2}$ on $K_2$ both correspond to the global edge $e$. The local DOF on $K_1$ maps to the global DOF for $e$. The local DOF on $K_2$ also maps to the same global DOF. To ensure this mapping is consistent, a sign factor, $\\sigma_e^K \\in \\{+1, -1\\}$, is introduced. This sign is $+1$ if the local orientation on element $K$ matches the global orientation of $e$, and $-1$ if it is opposite. The contribution of a local basis function $\\mathbf{w}_{loc}^K$ to the global basis function $\\boldsymbol{\\Psi}_e$ is then $\\sigma_e^K \\mathbf{w}_{loc}^K$. This sign correction ensures that the single global DOF correctly represents the physical quantity (tangential circulation or normal flux) shared at the interface, thereby enforcing the required continuity.\n\n### Part II: Computational Task\n\nWe are asked to compute $\\Delta R = R_{\\mathrm{bad}} - R_{\\mathrm{good}}$, where $R = \\mathbf{x}^{\\top}M\\mathbf{x}$ and $\\mathbf{x}$ is a column vector of all ones. When $\\mathbf{x}=\\mathbf{1}$, the quadratic form becomes the sum of all elements of the matrix $M$:\n$$\nR = \\mathbf{1}^{\\top}M\\mathbf{1} = \\sum_{i,j} M_{ij}\n$$\nThe global mass matrix $M$ is assembled from local mass matrices $M^K$ using local-to-global sign mappings. Let the global edges be indexed by $i, j$ and local edges on an element $K$ be indexed by $a, b$. The assembly rule is:\n$$\nM_{ij} = \\sum_{K} (\\sigma_i^K \\sigma_j^K) M_{\\text{loc}_K(i), \\text{loc}_K(j)}^K\n$$\nwhere $\\sigma_i^K$ is the sign of the local edge corresponding to global edge $i$ on element $K$ relative to the global orientation, and $\\text{loc}_K(i)$ is its local index. The sum is over all elements $K$ containing the relevant edges.\n\nThe quadratic form $R$ can be written as:\n$$\nR = \\sum_{i,j} \\sum_K (\\sigma_i^K \\sigma_j^K) M_{\\text{loc}_K(i), \\text{loc}_K(j)}^K = \\sum_K \\sum_{a, b \\in K} (\\sigma_a^K \\sigma_b^K) M_{ab}^K\n$$\nwhere the inner sum is over all pairs of local edges $\\{a,b\\}$ in element $K$.\n\nFor $M_{\\mathrm{good}}$, the standard assembly procedure is used. For $M_{\\mathrm{bad}}$, the sign for the shared edge on element $K_2$ is flipped. Let the shared edge be $e_s$. The signs for $M_{\\mathrm{bad}}$ are $\\sigma'_a{^K}$, where $\\sigma'_a{^K} = \\sigma_a^K$ for all edges except for $a=e_s$ on $K=K_2$, for which $\\sigma'_{e_s}{^{K_2}} = -\\sigma_{e_s}^{K_2}$.\n\nThe difference $\\Delta R$ is:\n$$\n\\Delta R = R_{\\mathrm{bad}} - R_{\\mathrm{good}} = \\sum_K \\sum_{a,b \\in K} (\\sigma'_a{^K}\\sigma'_b{^K} - \\sigma_a^K\\sigma_b^K) M_{ab}^K\n$$\nThe difference is zero for element $K_1$, as no signs are changed. The calculation reduces to the contribution from $K_2$:\n$$\n\\Delta R = \\sum_{a,b \\in K_2} (\\sigma'_a{^{K_2}}\\sigma'_b{^{K_2}} - \\sigma_a^{K_2}\\sigma_b^{K_2}) M_{ab}^{K_2}\n$$\nLet the local edges of $K_2$ be denoted $e_s$ (shared) and $e_{o1}, e_{o2}$ (other edges).\nThe term $(\\sigma'_a{^{K_2}}\\sigma'_b{^{K_2}} - \\sigma_a^{K_2}\\sigma_b^{K_2})$ is non-zero only when exactly one of the indices $a$ or $b$ corresponds to the shared edge $e_s$.\n- If $a=e_s, b=e_s$: term is $(-\\sigma_{e_s}^{K_2})^2 - (\\sigma_{e_s}^{K_2})^2 = 0$.\n- If $a,b \\neq e_s$: term is $\\sigma_a^{K_2}\\sigma_b^{K_2} - \\sigma_a^{K_2}\\sigma_b^{K_2} = 0$.\n- If $a=e_s, b \\neq e_s$: term is $(-\\sigma_{e_s}^{K_2})\\sigma_b^{K_2} - \\sigma_{e_s}^{K_2}\\sigma_b^{K_2} = -2 \\sigma_{e_s}^{K_2}\\sigma_b^{K_2}$.\nBy symmetry of the mass matrix, this gives:\n$$\n\\Delta R = \\sum_{b \\neq e_s} (-2 \\sigma_{e_s}^{K_2} \\sigma_b^{K_2} M_{e_s,b}^{K_2}) + \\sum_{a \\neq e_s} (-2 \\sigma_a^{K_2} \\sigma_{e_s}^{K_2} M_{a,e_s}^{K_2})\n= -4 \\sum_{b \\in \\{e_{o1}, e_{o2}\\}} \\sigma_{e_s}^{K_2} \\sigma_b^{K_2} M_{e_s,b}^{K_2}\n$$\nThe quadratic form $R$ is invariant under the choice of global orientations. We can choose the global orientations for the non-shared edges to match a convenient local orientation, making their signs $\\sigma_b^{K_2} = +1$. The problem states that for the consistent assembly ($M_{\\mathrm{good}}$), the shared edge is oriented to match the global orientation, so $\\sigma_{e_s}^{K_2} = +1$. With these choices, the expression simplifies to:\n$$\n\\Delta R = -4 \\sum_{b \\in \\{e_{o1}, e_{o2}\\}} M_{e_s,b}^{K_2}\n$$\nNow we must compute the geometric properties and local mass matrix entries for triangle $K_2 = \\mathrm{conv}\\{(1,0),(1,1),(0,0)\\}$. The local vertices are labeled $v_1=(1,0)$, $v_2=(1,1)$, $v_3=(0,0)$. The area is $|K_2| = 1/2$. The barycentric coordinates $\\lambda_i(\\mathbf{x})$ are linear functions satisfying $\\lambda_i(v_j) = \\delta_{ij}$ and $\\sum_i \\lambda_i(\\mathbf{x}) = 1$. Solving the linear system $\\mathbf{x} = \\sum_i \\lambda_i \\mathbf{v}_i$ gives:\n$$ x = \\lambda_1(1) + \\lambda_2(1) + \\lambda_3(0) \\implies x = \\lambda_1 + \\lambda_2 $$\n$$ y = \\lambda_1(0) + \\lambda_2(1) + \\lambda_3(0) \\implies y = \\lambda_2 $$\nFrom this, $\\lambda_2 = y$ and $\\lambda_1 = x - y$. Then $\\lambda_3 = 1 - \\lambda_1 - \\lambda_2 = 1 - (x-y) - y = 1 - x$.\nThe gradients are constant vectors:\n$$ \\nabla\\lambda_1 = \\begin{pmatrix}1 \\\\ -1\\end{pmatrix}, \\quad \\nabla\\lambda_2 = \\begin{pmatrix}0 \\\\ 1\\end{pmatrix}, \\quad \\nabla\\lambda_3 = \\begin{pmatrix}-1 \\\\ 0\\end{pmatrix} $$\nThe Gram matrix of these gradients is $G_{ij} = \\nabla\\lambda_i \\cdot \\nabla\\lambda_j$:\n$$\nG = \\begin{pmatrix} \\nabla\\lambda_1 \\cdot \\nabla\\lambda_1 & \\nabla\\lambda_1 \\cdot \\nabla\\lambda_2 & \\nabla\\lambda_1 \\cdot \\nabla\\lambda_3 \\\\ \\nabla\\lambda_2 \\cdot \\nabla\\lambda_1 & \\nabla\\lambda_2 \\cdot \\nabla\\lambda_2 & \\nabla\\lambda_2 \\cdot \\nabla\\lambda_3 \\\\ \\nabla\\lambda_3 \\cdot \\nabla\\lambda_1 & \\nabla\\lambda_3 \\cdot \\nabla\\lambda_2 & \\nabla\\lambda_3 \\cdot \\nabla\\lambda_3 \\end{pmatrix} = \\begin{pmatrix} 2 & -1 & -1 \\\\ -1 & 1 & 0 \\\\ -1 & 0 & 1 \\end{pmatrix}\n$$\nThe local edges are defined by vertex pairs $(1,2)$, $(2,3)$, $(3,1)$. The shared edge $E$ corresponds to vertices $(0,0)$ and $(1,0)$, which are $v_3$ and $v_1$ on $K_2$. So, the shared local edge is $e_s = e_{31}$. The other edges are $e_{o1} = e_{12}$ and $e_{o2} = e_{23}$. We need to compute $M_{31,12}^{K_2}$ and $M_{31,23}^{K_2}$.\nThe generic formula for an off-diagonal mass matrix entry between edges sharing a vertex is:\n$$\nM_{ij,jk}^K = \\int_K (\\lambda_i \\nabla\\lambda_j - \\lambda_j \\nabla\\lambda_i) \\cdot (\\lambda_j \\nabla\\lambda_k - \\lambda_k \\nabla\\lambda_j) \\, \\mathrm{d}x\\mathrm{d}y = \\frac{|K|}{12}(G_{ij} + G_{jk} - G_{jj} - 2G_{ik})\n$$\nWe need $M_{31,12}^{K_2}$. The edges $e_{31}$ and $e_{12}$ share vertex $1$. This corresponds to the formula with $(i,j,k)=(3,1,2)$.\n$$\nM_{31,12}^{K_2} = \\frac{|K_2|}{12}(G_{31} + G_{12} - G_{11} - 2G_{32}) = \\frac{1/2}{12}(-1 + (-1) - 2 - 2(0)) = \\frac{1}{24}(-4) = -\\frac{1}{6}\n$$\nNext, we need $M_{31,23}^{K_2}$. The edges $e_{31}$ and $e_{23}$ share vertex $3$. To use the formula we write $e_{31}$ as $e_{13}$ and $e_{23}$ as $e_{32}$. This makes $M_{31,23}^{K_2} = M_{13,32}^{K_2}$. So we use $(i,j,k)=(1,3,2)$.\n$$\nM_{13,32}^{K_2} = \\frac{|K_2|}{12}(G_{13} + G_{32} - G_{33} - 2G_{12}) = \\frac{1/2}{12}(-1 + 0 - 1 - 2(-1)) = \\frac{1}{24}(-1-1+2) = 0\n$$\nThus, $\\Delta R = -4 (M_{31,12}^{K_2} + M_{31,23}^{K_2}) = -4(-\\frac{1}{6}+0) = \\frac{4}{6} = \\frac{2}{3}$.", "answer": "$$\\boxed{\\frac{2}{3}}$$", "id": "3334058"}, {"introduction": "The stability and accuracy of vector finite elements are not accidental; they are guaranteed by a deep underlying mathematical structure. This practice [@problem_id:3334023] illuminates this structure by having you numerically construct the discrete de Rham complex using Whitney forms on a single tetrahedron. By verifying that the discrete operators (gradient, curl, divergence) correspond to topological incidence matrices and that their compositions are null, you will computationally prove the exact sequence property that prevents the emergence of spurious modes in electromagnetic simulations.", "problem": "Construct a complete, runnable program that uses Whitney $1$-forms to realize first-kind Nédélec edge basis functions on a single tetrahedron and numerically verifies, via Galerkin projections, the discrete exact sequence\n$$\nH^1 \\xrightarrow{\\nabla} H(\\mathrm{curl}) \\xrightarrow{\\nabla \\times} H(\\mathrm{div}) \\xrightarrow{\\nabla \\cdot} L^2\n$$\non a contractible mesh.\n\nYou must derive and implement from first principles using the following base:\n\n- Fundamental laws of vector calculus: the gradient $\\nabla$, the curl $\\nabla \\times$, the divergence $\\nabla \\cdot$, and the Divergence Theorem.\n- Whitney forms on a simplex and their correspondence to lowest-order finite element spaces: Whitney $0$-forms (nodal), Whitney $1$-forms (Nédélec first kind), Whitney $2$-forms (face-based $H(\\mathrm{div})$ fields), and Whitney $3$-forms (cellwise constant $L^2$ fields).\n- The discrete exterior derivative realized by coboundary (incidence) matrices between simplices of successive dimension.\n- Exactness on a contractible domain: the image of each map equals the kernel of the next.\n\nUse the single tetrahedron with vertices\n$$\n\\mathbf{v}_0=(0,0,0),\\quad \\mathbf{v}_1=(1,0,0),\\quad \\mathbf{v}_2=(0,1,0),\\quad \\mathbf{v}_3=(0,0,1),\n$$\nso the domain is contractible. Let the oriented tetrahedron be $[0,1,2,3]$. Use the globally oriented edges as the ordered pairs\n$$\n(0,1),\\ (0,2),\\ (0,3),\\ (1,2),\\ (1,3),\\ (2,3),\n$$\nand the oriented faces given by the boundary of the tetrahedron\n$$\n[1,2,3],\\ [0,2,3],\\ [0,1,3],\\ [0,1,2],\n$$\nwith the standard boundary orientation signs $+1,-1,+1,-1$, respectively.\n\nDefine the barycentric coordinates $\\{\\lambda_i\\}_{i=0}^3$ on the tetrahedron, with constant gradients $\\{\\nabla \\lambda_i\\}_{i=0}^3$. Define the basis functions:\n\n- Whitney $0$-forms (nodal): $\\lambda_i$ for vertex $i$.\n- Whitney $1$-forms (Nédélec first kind) associated with an oriented edge $(i,j)$:\n$$\n\\mathbf{N}_{ij}=\\lambda_i \\nabla \\lambda_j - \\lambda_j \\nabla \\lambda_i.\n$$\n- Whitney $2$-forms (vector proxy in $H(\\mathrm{div})$) associated with an oriented face $(i,j,k)$:\n$$\n\\mathbf{W}_{ijk}=2\\left(\\lambda_i\\, (\\nabla \\lambda_j \\times \\nabla \\lambda_k) + \\lambda_j\\, (\\nabla \\lambda_k \\times \\nabla \\lambda_i) + \\lambda_k\\, (\\nabla \\lambda_i \\times \\nabla \\lambda_j)\\right).\n$$\n- Whitney $3$-form basis taken as the constant scalar $\\chi_T = 1/|T|$ on the tetrahedron, where $|T|$ is the tetrahedron volume, so that $\\int_T \\chi_T\\, \\mathrm{d}V = 1$.\n\nUsing these bases, construct the Galerkin matrices that realize the discrete exterior derivative on finite element spaces:\n\n- The discrete gradient matrix $D_0 \\in \\mathbb{R}^{E \\times V}$ via\n$$\nM_1 D_0 = P_0,\\quad (M_1)_{e,e'}=\\int_T \\mathbf{N}_e\\cdot \\mathbf{N}_{e'}\\, \\mathrm{d}V,\\quad (P_0)_{e,i}=\\int_T \\mathbf{N}_e \\cdot \\nabla \\lambda_i\\, \\mathrm{d}V.\n$$\n- The discrete curl matrix $D_1 \\in \\mathbb{R}^{F \\times E}$ via\n$$\nM_2 D_1 = P_1,\\quad (M_2)_{f,f'}=\\int_T \\mathbf{W}_f\\cdot \\mathbf{W}_{f'}\\, \\mathrm{d}V,\\quad (P_1)_{f,e}=\\int_T \\mathbf{W}_f \\cdot (\\nabla \\times \\mathbf{N}_e)\\, \\mathrm{d}V.\n$$\n- The discrete divergence matrix $D_2 \\in \\mathbb{R}^{T \\times F}$ via\n$$\nM_3 D_2 = P_2,\\quad M_3 = \\int_T \\chi_T^2\\, \\mathrm{d}V = \\frac{1}{|T|},\\quad (P_2)_{t,f}=\\int_T \\chi_T\\, (\\nabla \\cdot \\mathbf{W}_f)\\, \\mathrm{d}V.\n$$\n\nAlso construct the purely topological incidence matrices:\n\n- The edge-vertex incidence $B_0 \\in \\mathbb{R}^{E \\times V}$ with entries $-1$ at the tail and $+1$ at the head of each oriented edge.\n- The face-edge incidence $B_1 \\in \\mathbb{R}^{F \\times E}$ with entries given by the oriented boundary of each face.\n- The cell-face incidence $B_2 \\in \\mathbb{R}^{T \\times F}$ with entries given by the oriented boundary of the tetrahedron.\n\nYou must then verify numerically that the Galerkin-realized discrete derivatives recover the incidence matrices, and that the discrete complex is exact on this contractible mesh, as follows:\n\n- Verify $\\|D_0 - B_0\\|_{\\max} \\le \\tau$.\n- Verify $\\|D_1 - B_1\\|_{\\max} \\le \\tau$.\n- Verify $\\|D_2 - B_2\\|_{\\max} \\le \\tau$.\n- Verify $\\|D_1 D_0\\|_{\\max} \\le \\tau$ and $\\|D_2 D_1\\|_{\\max} \\le \\tau$ (discrete exactness).\n- Compute the numerical ranks $\\mathrm{rank}(D_0)$, $\\mathrm{rank}(D_1)$, $\\mathrm{rank}(D_2)$ using a singular value threshold $\\sigma_{\\mathrm{th}} = \\epsilon \\cdot \\sigma_{\\max}$, where $\\epsilon$ is given.\n\nAll integrals must be computed exactly using the standard tetrahedral barycentric integration identities for monomials: for the tetrahedron volume $|T|$, one has $\\int_T \\lambda_i\\, \\mathrm{d}V = |T|/4$, $\\int_T \\lambda_i^2\\, \\mathrm{d}V = |T|/10$, and $\\int_T \\lambda_i \\lambda_j\\, \\mathrm{d}V = |T|/20$ for $i \\ne j$.\n\nTest Suite:\n- Use tolerance $\\tau = 10^{-10}$ for all comparisons of matrices and compositions.\n- Use singular value threshold parameter $\\epsilon = 10^{-12}$ for numerical rank computation.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the order\n$$\n[\\mathrm{b\\_grad},\\mathrm{b\\_curl},\\mathrm{b\\_div},\\mathrm{b\\_curl\\_grad},\\mathrm{b\\_div\\_curl},r_0,r_1,r_2],\n$$\nwhere the first five entries are boolean values for the verifications above and the last three entries are integers equal to $\\mathrm{rank}(D_0)$, $\\mathrm{rank}(D_1)$, and $\\mathrm{rank}(D_2)$. No physical units are involved; all quantities are dimensionless. Angles are not used.\n\nYour implementation must be entirely self-contained and must not require any user input. The result must hold for the given tetrahedron. The program must run in a modern language and environment and adhere to the specified output format.", "solution": "The task is to numerically verify the properties of the discrete de Rham sequence on a single tetrahedron, which serves as a contractible domain. This involves demonstrating that the discrete differential operators (gradient, curl, divergence) constructed via a Galerkin finite element method are equivalent to the topological coboundary operators (incidence matrices), and that the resulting sequence of operators is exact.\n\nFirst, we establish the geometric and topological setting. The domain is a tetrahedron $T$ with vertices $\\mathbf{v}_0=(0,0,0)$, $\\mathbf{v}_1=(1,0,0)$, $\\mathbf{v}_2=(0,1,0)$, and $\\mathbf{v}_3=(0,0,1)$. Its volume is $|T|=1/6$. The barycentric coordinates $\\lambda_i(\\mathbf{x})$ are linear functions, and their gradients $\\nabla\\lambda_i$ are constant vectors. Specifically, for $\\mathbf{x}=(x,y,z)$, we have $\\lambda_1=x, \\lambda_2=y, \\lambda_3=z$, and $\\lambda_0=1-x-y-z$. The gradients are $\\nabla\\lambda_0=(-1,-1,-1)$, $\\nabla\\lambda_1=(1,0,0)$, $\\nabla\\lambda_2=(0,1,0)$, and $\\nabla\\lambda_3=(0,0,1)$.\n\nThe problem defines four finite element spaces using Whitney forms as basis functions:\n1.  Nodal basis ($H^1$): Whitney $0$-forms $\\{\\lambda_i\\}_{i=0}^3$, associated with vertices.\n2.  Nédélec edge basis ($H(\\mathrm{curl})$): Whitney $1$-forms $\\{\\mathbf{N}_{ij} = \\lambda_i \\nabla \\lambda_j - \\lambda_j \\nabla \\lambda_i\\}$, associated with oriented edges $(i,j)$.\n3.  Face basis ($H(\\mathrm{div})$): Whitney $2$-forms $\\{\\mathbf{W}_{ijk}\\}$, associated with oriented faces $(i,j,k)$.\n4.  Cell basis ($L^2$): A Whitney $3$-form, chosen as the constant function $\\chi_T = 1/|T|$, associated with the tetrahedron cell.\n\nThe core of the problem is to construct matrix representations of the gradient, curl, and divergence operators. These discrete operators, denoted $D_0, D_1, D_2$, are obtained through Galerkin projection. For instance, to find the representation of $\\nabla u$ in the edge space for $u \\in \\mathrm{span}\\{\\lambda_i\\}$, we project $\\nabla \\lambda_i$ onto the basis $\\{\\mathbf{N}_e\\}$. This leads to a linear system $M_1 D_0 = P_0$, where $M_1$ is the mass matrix of edge elements and $P_0$ is the projection matrix. Analogous procedures yield $D_1$ and $D_2$. All matrix entries are computed by integrating products of basis functions or their derivatives over the tetrahedron. These integrals can be evaluated exactly using the formula for monomials of barycentric coordinates:\n$$\n\\int_T \\prod_{k=0}^3 \\lambda_k^{\\alpha_k} \\,dV = \\frac{\\prod_{k=0}^3 \\alpha_k!}{(\\sum_{k=0}^3 \\alpha_k + 3)!} 3!|T|\n$$\nSince $3!|T| = 6(1/6) = 1$ for our specific tetrahedron, the formula simplifies to a ratio of factorials.\n\nIn parallel, we construct the topological incidence matrices $B_0, B_1, B_2$. These matrices encode the connectivity of the mesh:\n-   $B_0$ (edge-vertex): Its entries $(B_0)_{e,v}$ are $-1$ if vertex $v$ is the start of edge $e$, $+1$ if it's the end, and $0$ otherwise.\n-   $B_1$ (face-edge): Its entries $(B_1)_{f,e}$ describe how edges form the oriented boundary of faces.\n-   $B_2$ (cell-face): Its entries $(B_2)_{c,f}$ describe how faces form the oriented boundary of the cell.\n\nA fundamental result of Finite Element Exterior Calculus (FEEC) states that for Whitney forms, the diagram involving differential operators and their discrete counterparts commutes. This implies that the Galerkin matrices $D_k$ should be identical to the incidence matrices $B_k$. The program first verifies this identity numerically, i.e., $\\|D_k - B_k\\|_{\\max} \\le \\tau$ for a small tolerance $\\tau$.\n\nThe second property to be verified is the exactness of the discrete sequence, which is the discrete analogue of the vector calculus identities $\\nabla \\times (\\nabla \\phi) = 0$ and $\\nabla \\cdot (\\nabla \\times \\mathbf{A}) = 0$. This corresponds to checking that the compositions of the discrete operators yield a zero matrix: $D_1 D_0 = 0$ and $D_2 D_1 = 0$. This property is a direct algebraic consequence of the topological property $\\partial \\circ \\partial = 0$ (the boundary of a boundary is empty), which translates to $B_1 B_0 = 0$ and $B_2 B_1 = 0$. Since we expect $D_k=B_k$, the exactness of the discrete sequence follows.\n\nFinally, we compute the numerical ranks of the matrices $D_0, D_1, D_2$. For a contractible domain, the ranks of the discrete operators are determined by the Betti numbers of the complex, which are all zero except for the 0-th one. The rank of the $k$-th operator is related to the dimensions of the spaces and the ranks of the adjacent operators through the rank-nullity theorem. The predicted ranks for a single tetrahedron ($V=4, E=6, F=4, T=1$) are:\n-   $\\mathrm{rank}(D_0) = V-1 = 3$.\n-   $\\mathrm{rank}(D_1) = E - \\mathrm{rank}(D_0) = 6 - 3 = 3$. (Since $\\ker(D_1)=\\text{im}(D_0)$ on a contractible domain).\n-   $\\mathrm{rank}(D_2) = F - \\mathrm{rank}(D_1) = 4 - 3 = 1$.\nThe numerical rank is determined by counting the number of singular values that are significant relative to the largest singular value, controlled by a threshold parameter $\\epsilon$.\n\nThe implementation proceeds by systematically constructing these matrices, performing the specified numerical verifications, and computing the ranks, ultimately confirming the core tenets of FEEC on this canonical example.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom math import factorial\n\ndef solve():\n    \"\"\"\n    Constructs and verifies the discrete de Rham complex on a single tetrahedron.\n    \"\"\"\n    # -- 1. Problem Setup: Constants, Geometry, and Topology --\n\n    # Constants for numerical comparisons\n    tau = 1e-10\n    epsilon = 1e-12\n\n    # Geometric data for the reference tetrahedron\n    # The problem specifies these vertices.\n    verts = np.array([\n        [0., 0., 0.],  # v0\n        [1., 0., 0.],  # v1\n        [0., 1., 0.],  # v2\n        [0., 0., 1.]   # v3\n    ])\n    T_vol = 1.0 / 6.0  # Volume of the tetrahedron with these vertices\n\n    # Topological data (oriented simplices)\n    # The order defines the basis function and matrix indexing.\n    vertices = [0, 1, 2, 3]\n    edges = [(0, 1), (0, 2), (0, 3), (1, 2), (1, 3), (2, 3)]\n    faces = [(1, 2, 3), (0, 2, 3), (0, 1, 3), (0, 1, 2)]\n    \n    num_verts = len(vertices)\n    num_edges = len(edges)\n    num_faces = len(faces)\n    num_cells = 1\n\n    # Mappings for convenience to look up indices\n    edge_map = {edge: i for i, edge in enumerate(edges)}\n\n    # -- 2. Basis Functions and their Properties --\n\n    # Gradients of barycentric coordinates are constant vectors.\n    # For a point x, lambda_1=x, lambda_2=y, lambda_3=z, lambda_0=1-x-y-z.\n    grads = np.array([\n        [-1., -1., -1.],  # grad(lambda_0)\n        [ 1.,  0.,  0.],  # grad(lambda_1)\n        [ 0.,  1.,  0.],  # grad(lambda_2)\n        [ 0.,  0.,  1.]   # grad(lambda_3)\n    ])\n\n    # Precompute dot and cross products of gradients for efficiency\n    grad_dots = grads @ grads.T\n    grad_cross = np.zeros((num_verts, num_verts, 3))\n    for i in range(num_verts):\n        for j in range(num_verts):\n            grad_cross[i, j] = np.cross(grads[i], grads[j])\n\n    def tetra_integral(powers):\n        \"\"\"\n        Computes the exact integral of a monomial of barycentric coordinates over the tetrahedron.\n        Formula: Integral(Product(lambda_i^alpha_i)) = (Product(alpha_i!) * 3! * |T|) / (Sum(alpha_i) + 3)!.\n        For our tetrahedron, 3! * |T| = 1.\n        \"\"\"\n        numerator = 1.0\n        for p in powers:\n            numerator *= factorial(p)\n        denominator = factorial(sum(powers) + 3)\n        return numerator / denominator\n\n    # -- 3. Construction of Topological Incidence Matrices (B_k) --\n\n    # B0: Edge-Vertex incidence matrix (6x4)\n    B0 = np.zeros((num_edges, num_verts))\n    for i, edge in enumerate(edges):\n        B0[i, edge[0]] = -1.\n        B0[i, edge[1]] = 1.\n\n    # B1: Face-Edge incidence matrix (4x6)\n    B1 = np.zeros((num_faces, num_edges))\n    for i, face in enumerate(faces):\n        # Boundary of face (v0, v1, v2) is edges (v0,v1), (v1,v2), (v2,v0)\n        f_edges = [(face[0], face[1]), (face[1], face[2]), (face[2], face[0])]\n        for v_start, v_end in f_edges:\n            if (v_start, v_end) in edge_map:\n                B1[i, edge_map[(v_start, v_end)]] = 1.\n            elif (v_end, v_start) in edge_map:\n                B1[i, edge_map[(v_end, v_start)]] = -1.\n\n    # B2: Cell-Face incidence matrix (1x4)\n    # Signs are given in the problem statement\n    B2 = np.array([[1., -1., 1., -1.]])\n\n    # -- 4. Construction of Galerkin Matrices (D_k) via M D_k = P_{k-1} --\n\n    # -- Discrete Gradient D0 (H^1 -> H(curl)) --\n    M1 = np.zeros((num_edges, num_edges))\n    P0 = np.zeros((num_edges, num_verts))\n\n    # Integral of lambda_i is T_vol/4\n    # Integral of lambda_i * lambda_j is T_vol/20 for i!=j\n    # Integral of lambda_i^2 is T_vol/10\n    int_li_lj = T_vol / 20.0\n    int_li_2 = T_vol / 10.0\n\n    for e1_idx, e1 in enumerate(edges):\n        i, j = e1\n        # P0 matrix: (P0)_ei = integral( N_e . grad(lambda_i) ) dV\n        for v_idx in range(num_verts):\n            term1 = grad_dots[j, v_idx]\n            term2 = grad_dots[i, v_idx]\n            P0[e1_idx, v_idx] = (term1 - term2) * (T_vol / 4.0)\n\n        # M1 matrix: (M1)_ee' = integral( N_e . N_e' ) dV\n        for e2_idx, e2 in enumerate(edges):\n            k, l = e2\n            # Integrand: (li*gj - lj*gi) . (lk*gl - ll*gk)\n            # = (gj.gl)li*lk - (gj.gk)li*ll - (gi.gl)lj*lk + (gi.gk)lj*ll\n            val1 = grad_dots[j, l]\n            val2 = -grad_dots[j, k]\n            val3 = -grad_dots[i, l]\n            val4 = grad_dots[i, k]\n            \n            # Integral of lambda_a * lambda_b\n            def int_ab(a, b): return int_li_2 if a == b else int_li_lj\n\n            term1_int = int_ab(i, k)\n            term2_int = int_ab(i, l)\n            term3_int = int_ab(j, k)\n            term4_int = int_ab(j, l)\n            \n            M1[e1_idx, e2_idx] = val1*term1_int + val2*term2_int + val3*term3_int + val4*term4_int\n\n    D0 = np.linalg.solve(M1, P0)\n\n    # -- Discrete Curl D1 (H(curl) -> H(div)) --\n    M2 = np.zeros((num_faces, num_faces))\n    P1 = np.zeros((num_faces, num_edges))\n\n    # Integral of W_f\n    int_W = np.zeros((num_faces, 3))\n    for f_idx, f in enumerate(faces):\n        i, j, k = f\n        # integral(2*(li(gj x gk) + lj(gk x gi) + lk(gi x gj)))\n        # = 2 * ( (T_vol/4)*(gj x gk) + (T_vol/4)*(gk x gi) + (T_vol/4)*(gi x gj) )\n        int_W[f_idx] = 2 * (T_vol/4) * (grad_cross[j,k] + grad_cross[k,i] + grad_cross[i,j])\n\n    for f1_idx, f1 in enumerate(faces):\n        # P1 matrix: (P1)_fe = integral( W_f . curl(N_e) ) dV\n        for e_idx, e in enumerate(edges):\n            p, q = e\n            curl_N = 2.0 * grad_cross[p, q]\n            P1[f1_idx, e_idx] = np.dot(int_W[f1_idx], curl_N)\n\n        # M2 matrix: (M2)_ff' = integral( W_f . W_f' ) dV\n        for f2_idx, f2 in enumerate(faces):\n            i, j, k = f1\n            p, q, r = f2\n            # integral( 4 * (sum_cyclic li (gj x gk)) . (sum_cyclic lp (gq x gr)) )\n            terms = [(i, j, k), (j, k, i), (k, i, j)]\n            terms_prime = [(p, q, r), (q, r, p), (r, p, q)]\n\n            integral = 0.0\n            for t_a, t_b, t_c in terms:\n                for u_a, u_b, u_c in terms_prime:\n                    dot_prod = np.dot(grad_cross[t_b, t_c], grad_cross[u_b, u_c])\n                    p_pow = [0]*4; p_pow[t_a]+=1; p_pow[u_a]+=1\n                    # This integral is for barycentric monomials, needs the original formula\n                    integral += tetra_integral(p_pow) * dot_prod\n            M2[f1_idx, f2_idx] = 4.0 * integral\n\n    D1 = np.linalg.solve(M2, P1)\n\n    # -- Discrete Divergence D2 (H(div) -> L^2) --\n    M3 = 1.0 / T_vol\n    P2 = np.zeros((num_cells, num_faces))\n    for f_idx, f in enumerate(faces):\n        i, j, k = f\n        # div(W_f) = 2 * ( (grad li).(gj x gk) + (grad lj).(gk x gi) + (grad lk).(gi x gj) )\n        # = 6 * det(gi, gj, gk)\n        det_grads = np.linalg.det(np.array([grads[i], grads[j], grads[k]]))\n        div_W = 6.0 * det_grads\n        # P2 = integral( chi_T * div(W_f) ) = (1/|T|) * div(W_f) * |T| = div(W_f)\n        P2[0, f_idx] = div_W\n    D2 = P2 / M3\n\n    # -- 5. Verification and Rank Computation --\n\n    b_grad = np.max(np.abs(D0 - B0)) = tau\n    b_curl = np.max(np.abs(D1 - B1)) = tau\n    b_div = np.max(np.abs(D2 - B2)) = tau\n\n    b_curl_grad = np.max(np.abs(D1 @ D0)) = tau\n    b_div_curl = np.max(np.abs(D2 @ D1)) = tau\n\n    def get_rank(matrix):\n        s = np.linalg.svd(matrix, compute_uv=False)\n        if len(s) == 0 or s[0] == 0:\n            return 0\n        return np.sum(s > epsilon * s[0])\n\n    r0 = get_rank(D0)\n    r1 = get_rank(D1)\n    r2 = get_rank(D2)\n\n    # -- 6. Format Output --\n    results = [b_grad, b_curl, b_div, b_curl_grad, b_div_curl, r0, r1, r2]\n    # Python's bools print as True/False, problem asks for lowercase boolean.\n    results_str = [str(r).lower() for r in results[:5]] + [str(r) for r in results[5:]]\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```", "id": "3334023"}]}