{"hands_on_practices": [{"introduction": "The defining characteristic of vector fields in the Sobolev space $H(\\mathrm{curl}, \\Omega)$ is the continuity of their tangential components across any interior interface, a property essential for the weak formulation of Maxwell's equations. This first exercise provides a direct, by-hand calculation to solidify your understanding of this principle. By examining a vector field with a prescribed jump in its normal component, you will verify that the tangential degrees of freedom, defined by line integrals along shared edges, remain continuous—a non-intuitive result that is fundamental to curl-conforming elements [@problem_id:3297079].", "problem": "Consider the Sobolev space of square-integrable vector fields with square-integrable curl, denoted by $H(\\mathrm{curl}, \\Omega)$, and its curl-conforming finite element discretization using first-kind Nédélec (edge) elements. The tangential trace on an interface is defined by the line integral of the field’s tangential component along each edge. In computational electromagnetics, these edge degrees of freedom encode tangential continuity, which is required by the weak form of Maxwell’s equations and the definition of $H(\\mathrm{curl}, \\Omega)$.\n\nLet $\\Omega \\subset \\mathbb{R}^{3}$ be the union of two tetrahedra $T^{-}$ and $T^{+}$ sharing the triangular face $S$ with vertices $P_{1} = (1,0,0)$, $P_{2} = (0,1,0)$, and $P_{3} = (0,0,1)$. The tetrahedron $T^{-}$ has vertices $A_{0} = (0,0,0)$, $A_{1} = P_{1}$, $A_{2} = P_{2}$, $A_{3} = P_{3}$, and the tetrahedron $T^{+}$ has vertices $B_{0} = P_{1}$, $B_{1} = P_{2}$, $B_{2} = P_{3}$, $B_{3} = (1,1,1)$. The shared face $S$ lies in the plane $x + y + z = 1$ and has unit normal $\\boldsymbol{n}_{S}$ chosen to be outward from $T^{-}$.\n\nDefine a piecewise electric field $\\boldsymbol{E} : \\Omega \\to \\mathbb{R}^{3}$ by\n$$\n\\boldsymbol{E}(\\boldsymbol{x}) = \n\\begin{cases}\n\\boldsymbol{E}^{-}(\\boldsymbol{x}) = \\begin{pmatrix} x + y \\\\ y + z \\\\ z + x \\end{pmatrix} \\ \\text{V/m}, & \\boldsymbol{x} \\in T^{-}, \\\\\n\\boldsymbol{E}^{+}(\\boldsymbol{x}) = \\boldsymbol{E}^{-}(\\boldsymbol{x}) + \\gamma \\, \\boldsymbol{n}_{S} \\ \\text{V/m}, & \\boldsymbol{x} \\in T^{+},\n\\end{cases}\n$$\nwhere $\\gamma \\in \\mathbb{R}$ is a constant and $\\boldsymbol{n}_{S}$ is the unit normal to $S$.\n\nUse the globally oriented shared edges of $S$,\n$$\ne_{1} : P_{1} \\to P_{2}, \\quad e_{2} : P_{2} \\to P_{3}, \\quad e_{3} : P_{3} \\to P_{1},\n$$\nwith the degree of freedom on an edge $e$ defined as the line integral\n$$\nI(\\boldsymbol{E}; e) = \\int_{e} \\boldsymbol{E} \\cdot \\boldsymbol{t}_{e} \\, \\mathrm{d}s = \\int_{e} \\boldsymbol{E} \\cdot \\mathrm{d}\\boldsymbol{l},\n$$\nwhere $\\boldsymbol{t}_{e}$ is the unit tangent to $e$ consistent with its orientation and $\\mathrm{d}\\boldsymbol{l} = \\boldsymbol{t}_{e} \\, \\mathrm{d}s$.\n\nCompute the three shared-edge degrees of freedom for $\\boldsymbol{E}^{-}$ and $\\boldsymbol{E}^{+}$, and verify tangential continuity across $S$ by evaluating the sum of squared differences\n$$\nJ = \\sum_{i=1}^{3} \\left( I\\!\\left(\\boldsymbol{E}^{+}; e_{i}\\right) - I\\!\\left(\\boldsymbol{E}^{-}; e_{i}\\right) \\right)^{2}.\n$$\nExpress the final quantity $J$ in $\\mathrm{V}^{2}$. The final answer must be a single real number or a single closed-form analytic expression.", "solution": "The objective is to compute the quantity $J = \\sum_{i=1}^{3} \\left( I\\!\\left(\\boldsymbol{E}^{+}; e_{i}\\right) - I\\!\\left(\\boldsymbol{E}^{-}; e_{i}\\right) \\right)^{2}$. This quantity represents the sum of squared differences of the edge degrees of freedom for the piecewise-defined electric field $\\boldsymbol{E}$ across the shared interface $S$.\n\nThe degree of freedom associated with a vector field $\\boldsymbol{F}$ and an edge $e$ is given by the line integral $I(\\boldsymbol{F}; e) = \\int_{e} \\boldsymbol{F} \\cdot \\mathrm{d}\\boldsymbol{l}$. We first analyze the difference term for a single edge $e_i$:\n$$\n\\Delta I_i = I(\\boldsymbol{E}^{+}; e_{i}) - I(\\boldsymbol{E}^{-}; e_{i}) = \\int_{e_i} \\boldsymbol{E}^{+}(\\boldsymbol{x}) \\cdot \\mathrm{d}\\boldsymbol{l} - \\int_{e_i} \\boldsymbol{E}^{-}(\\boldsymbol{x}) \\cdot \\mathrm{d}\\boldsymbol{l}\n$$\nBy the linearity of the integral, this can be combined into a single integral over the difference of the vector fields:\n$$\n\\Delta I_i = \\int_{e_i} \\left( \\boldsymbol{E}^{+}(\\boldsymbol{x}) - \\boldsymbol{E}^{-}(\\boldsymbol{x}) \\right) \\cdot \\mathrm{d}\\boldsymbol{l}\n$$\nAccording to the problem statement, the electric field is defined as $\\boldsymbol{E}^{+}(\\boldsymbol{x}) = \\boldsymbol{E}^{-}(\\boldsymbol{x}) + \\gamma \\, \\boldsymbol{n}_{S}$ for $\\boldsymbol{x} \\in T^{+}$. This relation holds for points on the interface $S$, which includes the edges $e_i$. Therefore, the difference between the fields along these edges is constant:\n$$\n\\boldsymbol{E}^{+}(\\boldsymbol{x}) - \\boldsymbol{E}^{-}(\\boldsymbol{x}) = \\gamma \\, \\boldsymbol{n}_{S}\n$$\nSubstituting this into the expression for $\\Delta I_i$:\n$$\n\\Delta I_i = \\int_{e_i} (\\gamma \\, \\boldsymbol{n}_{S}) \\cdot \\mathrm{d}\\boldsymbol{l}\n$$\nThe term $\\gamma \\, \\boldsymbol{n}_{S}$ is a constant vector. As such, it can be factored out of the integral:\n$$\n\\Delta I_i = \\gamma \\, \\boldsymbol{n}_{S} \\cdot \\int_{e_i} \\mathrm{d}\\boldsymbol{l}\n$$\nThe remaining integral, $\\int_{e_i} \\mathrm{d}\\boldsymbol{l}$, represents the vector displacement from the start-point to the end-point of the edge $e_i$.\n\nThe fundamental insight is that each edge $e_i$ lies entirely within the face $S$. The vector $\\boldsymbol{n}_{S}$ is, by definition, normal (perpendicular) to the plane containing the face $S$. Any vector that lies within this plane must be orthogonal to $\\boldsymbol{n}_{S}$. The displacement vector $\\int_{e_i} \\mathrm{d}\\boldsymbol{l}$ is such a vector. Consequently, their dot product must be zero:\n$$\n\\boldsymbol{n}_{S} \\cdot \\int_{e_i} \\mathrm{d}\\boldsymbol{l} = 0\n$$\nThis implies that $\\Delta I_i = \\gamma \\cdot 0 = 0$ for each edge $i=1, 2, 3$.\n\nTo verify this, we can perform the calculation explicitly. The vertices of the face $S$ are $P_{1} = (1,0,0)$, $P_{2} = (0,1,0)$, and $P_{3} = (0,0,1)$. These points satisfy the plane equation $x+y+z=1$. A normal vector to this plane is $\\boldsymbol{n} = (1,1,1)^T$. The corresponding unit normal vector is:\n$$\n\\boldsymbol{n}_{S} = \\frac{1}{\\sqrt{1^2+1^2+1^2}} \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix} = \\frac{1}{\\sqrt{3}} \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix}\n$$\nThe displacement vectors for the oriented edges are:\n- $e_1: P_1 \\to P_2$, so $\\boldsymbol{v}_1 = P_2 - P_1 = (0-1, 1-0, 0-0)^T = \\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\end{pmatrix}$.\n- $e_2: P_2 \\to P_3$, so $\\boldsymbol{v}_2 = P_3 - P_2 = (0-0, 0-1, 1-0)^T = \\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\end{pmatrix}$.\n- $e_3: P_3 \\to P_1$, so $\\boldsymbol{v}_3 = P_1 - P_3 = (1-0, 0-0, 0-1)^T = \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\end{pmatrix}$.\n\nNow we compute the dot products:\n- For $e_1$: $\\Delta I_1 = \\gamma \\boldsymbol{n}_{S} \\cdot \\boldsymbol{v}_1 = \\gamma \\frac{1}{\\sqrt{3}}(1,1,1) \\cdot (-1,1,0) = \\frac{\\gamma}{\\sqrt{3}}(-1+1+0) = 0$.\n- For $e_2$: $\\Delta I_2 = \\gamma \\boldsymbol{n}_{S} \\cdot \\boldsymbol{v}_2 = \\gamma \\frac{1}{\\sqrt{3}}(1,1,1) \\cdot (0,-1,1) = \\frac{\\gamma}{\\sqrt{3}}(0-1+1) = 0$.\n- For $e_3$: $\\Delta I_3 = \\gamma \\boldsymbol{n}_{S} \\cdot \\boldsymbol{v}_3 = \\gamma \\frac{1}{\\sqrt{3}}(1,1,1) \\cdot (1,0,-1) = \\frac{\\gamma}{\\sqrt{3}}(1+0-1) = 0$.\n\nSince the difference in degrees of freedom $\\Delta I_i$ is $0$ for all three shared edges, the quantity $J$ is:\n$$\nJ = \\sum_{i=1}^{3} (\\Delta I_i)^2 = 0^2 + 0^2 + 0^2 = 0\n$$\nThe result $J=0$ in units of $\\mathrm{V}^2$ confirms that the tangential component of the electric field $\\boldsymbol{E}$ is continuous across the interface $S$, irrespective of the specific form of $\\boldsymbol{E}^{-}$ or the value of the normal jump parameter $\\gamma$. This is a fundamental property of fields in $H(\\mathrm{curl}, \\Omega)$ and the basis of Nédélec finite element formulations.", "answer": "$$\\boxed{0}$$", "id": "3297079"}, {"introduction": "While tangential continuity is a theoretical requirement, ensuring it in a computational model depends on careful implementation, where a common pitfall arises from the handling of edge orientations within a finite element mesh. This thought experiment [@problem_id:3297140] illustrates the consequences of a 'naive' assembly process where local edge orientations are inconsistent. By working through a simple example involving a gradient field, you will see how this inconsistency leads to a loss of conformity and breaks the crucial exactness property of the discrete de Rham sequence, highlighting why a consistent global orientation scheme is indispensable for robust finite element simulations.", "problem": "Consider the lowest-order edge (first-kind Nédélec) finite element space that conforms to the Sobolev space of square-integrable vector fields with square-integrable curl, denoted $H(\\mathrm{curl};\\Omega)$, on a polygonal domain $\\Omega \\subset \\mathbb{R}^2$. The edge-based degrees of freedom (Degrees of Freedom (DOF)) on each mesh edge $e$ are defined by the line integral $\\int_e \\mathbf{v}\\cdot \\mathbf{t}_e\\,\\mathrm{d}s$, where $\\mathbf{t}_e$ is the unit tangent vector aligned with a chosen orientation of $e$. The natural energy space for the electric field in computational electromagnetics is $H(\\mathrm{curl};\\Omega)$, and for gradient fields $\\mathbf{E}=\\nabla \\phi$ with a scalar potential $\\phi$, the identity $\\mathrm{curl}(\\nabla \\phi)=0$ holds.\n\nLet $\\Omega=[0,1]^2$ and let the mesh consist of $2$ triangles obtained by splitting $\\Omega$ along the diagonal $e_d$ from $(0,0)$ to $(1,1)$: $T_1=\\mathrm{conv}\\{(0,0),(1,0),(1,1)\\}$ and $T_2=\\mathrm{conv}\\{(0,0),(1,1),(0,1)\\}$. Consider the scalar potential $\\phi(x,y)=x+y$ (so that $\\nabla\\phi=(1,1)$ everywhere). For the shared diagonal edge $e_d$, suppose the local orientation in $T_1$ is chosen from $(1,1)$ to $(0,0)$, while the local orientation in $T_2$ is chosen from $(0,0)$ to $(1,1)$. Assume a naive assembly is performed in which the global edge DOF for $e_d$ is formed by adding the two local DOFs computed with their respective local orientations, without enforcing a single global edge orientation and corresponding sign consistency.\n\nStarting from first principles, use the fundamental theorem of calculus and the definition of the Nédélec edge DOF to compute the local edge integrals for $\\nabla\\phi$ on $e_d$ within $T_1$ and $T_2$, and determine the naive assembled global DOF for $e_d$. Then, explain why this naive assembly causes loss of exactness of the discrete de Rham sequence $H^1(\\Omega)\\xrightarrow{\\nabla}H(\\mathrm{curl};\\Omega)\\xrightarrow{\\mathrm{curl}}L^2(\\Omega)$ when discretized by nodal and edge elements on this mesh, and describe how imposing a single global orientation per edge and mapping local DOFs by the appropriate sign restores conformity and exactness. Choose the option that correctly identifies the computed values and the conceptual reason for the failure and its remedy.\n\nA. Without a consistent global orientation, the naive assembled edge DOF on $e_d$ equals $0$ because the local contributions $+2$ and $-2$ cancel; enforcing a single global edge orientation and sign-mapping yields a global DOF of $2$, thereby restoring tangential continuity and the exactness property that $\\mathrm{curl}\\circ\\nabla=0$ discretely.\n\nB. The naive assembled edge DOF on $e_d$ equals $2$ even without a consistent global orientation; imposing a single global edge orientation changes the global DOF to $0$, which restores tangential continuity and exactness.\n\nC. The loss of exactness occurs because $\\mathrm{curl}(\\nabla\\phi)$ is nonzero on each triangle for piecewise linear $\\phi$; orientation conventions cannot fix this, since the failure is due to the nonlinearity of the curl operator.\n\nD. The phenomenon only appears for second-order Nédélec elements; lowest-order edge elements are immune to orientation inconsistencies, so orientation conventions are unnecessary for restoring exactness in this case.", "solution": "The user wants me to analyze a problem concerning the assembly of degrees of freedom for lowest-order Nédélec edge elements and its implications for the exactness of the discrete de Rham sequence.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n*   **Finite Element Space:** Lowest-order edge (first-kind Nédélec) space on a polygonal domain $\\Omega \\subset \\mathbb{R}^2$, conforming to $H(\\mathrm{curl};\\Omega)$.\n*   **Degrees of Freedom (DOF):** For a mesh edge $e$, the DOF is defined by the line integral $\\int_e \\mathbf{v}\\cdot \\mathbf{t}_e\\,\\mathrm{d}s$, where $\\mathbf{t}_e$ is the unit tangent vector for a chosen orientation of $e$.\n*   **Physical Context:** The space $H(\\mathrm{curl};\\Omega)$ is the natural energy space for the electric field. For gradient fields $\\mathbf{E}=\\nabla \\phi$, the identity $\\mathrm{curl}(\\nabla \\phi)=0$ holds.\n*   **Domain and Mesh:** The domain is the unit square $\\Omega=[0,1]^2$. The mesh consists of two triangles, $T_1=\\mathrm{conv}\\{(0,0),(1,0),(1,1)\\}$ and $T_2=\\mathrm{conv}\\{(0,0),(1,1),(0,1)\\}$, sharing the diagonal edge $e_d$ from $(0,0)$ to $(1,1)$.\n*   **Vector Field Source:** A scalar potential $\\phi(x,y)=x+y$, giving the gradient field $\\nabla\\phi=(1,1)$.\n*   **Edge Orientations:** On the shared edge $e_d$, the local orientation for triangle $T_1$ is from $(1,1)$ to $(0,0)$. For triangle $T_2$, the local orientation is from $(0,0)$ to $(1,1)$.\n*   **Assembly Procedure:** A \"naive assembly\" is assumed, where the global edge DOF for $e_d$ is the sum of the two local DOFs computed with their respective local orientations.\n*   **Task:** Compute local and naively assembled global DOFs for $\\nabla\\phi$ on $e_d$, explain the resulting loss of exactness for the discrete de Rham sequence, and describe the correct procedure.\n\n**Step 2: Validate Using Extracted Givens**\n\n*   **Scientifically Grounded:** The problem is firmly rooted in the theory of Finite Element Exterior Calculus (FEEC), specifically concerning Nédélec elements for $H(\\mathrm{curl})$ spaces. The concepts of degrees of freedom, orientations, assembly, conformity, and the de Rham sequence are standard and rigorously defined in computational electromagnetism and numerical analysis. The identity $\\mathrm{curl}(\\nabla\\phi)=0$ is a fundamental theorem of vector calculus.\n*   **Well-Posed:** The problem provides all necessary information—the geometry, the mesh, the specific function, the definition of the degrees of freedom, and a precisely described (though flawed) assembly procedure—to perform the required calculations and conceptual analysis.\n*   **Objective:** The language is technical and precise, with no subjective or ambiguous statements.\n*   **Completeness and Consistency:** The problem is self-contained and internally consistent. It poses a question about a common pitfall in implementing edge elements.\n*   **Realism:** The scenario is highly realistic. Incorrect handling of edge orientations is a classic implementation error in finite element codes for electromagnetics, and this problem serves as an excellent pedagogical example of why orientation consistency is critical.\n\n**Step 3: Verdict and Action**\n\nThe problem statement is **valid**. It is a well-posed, scientifically sound, and conceptually important problem in the field of computational electromagnetics. I will proceed with the solution.\n\n### Solution Derivation\n\nThe analysis proceeds in two parts: first, the direct computation of the degrees of freedom as specified, and second, the conceptual explanation of the implications for the finite element method.\n\n**Part 1: Computation of Degrees of Freedom**\n\nThe vector field under consideration is the gradient of the scalar potential $\\phi(x,y) = x+y$. This gives the constant vector field $\\mathbf{v} = \\nabla\\phi = (1,1)$.\n\nThe degree of freedom (DOF) associated with an edge $e$ is the line integral of the tangential component of the vector field, $\\int_e \\mathbf{v}\\cdot \\mathbf{t}_e\\,\\mathrm{d}s$. For a gradient field $\\mathbf{v}=\\nabla\\phi$, the fundamental theorem of calculus for line integrals provides a direct method for computation: $\\int_C \\nabla\\phi \\cdot d\\mathbf{r} = \\phi(\\text{end point}) - \\phi(\\text{start point})$.\n\n1.  **Local DOF on $e_d$ for Triangle $T_1$:**\n    The problem states the orientation for $T_1$ is from $(1,1)$ to $(0,0)$.\n    *   Start point: $\\mathbf{p}_S = (1,1)$\n    *   End point: $\\mathbf{p}_E = (0,0)$\n    The local DOF is:\n    $$ \\text{DOF}_{T_1} = \\phi(\\mathbf{p}_E) - \\phi(\\mathbf{p}_S) = \\phi(0,0) - \\phi(1,1) = (0+0) - (1+1) = -2 $$\n\n2.  **Local DOF on $e_d$ for Triangle $T_2$:**\n    The problem states the orientation for $T_2$ is from $(0,0)$ to $(1,1)$.\n    *   Start point: $\\mathbf{p}_S = (0,0)$\n    *   End point: $\\mathbf{p}_E = (1,1)$\n    The local DOF is:\n    $$ \\text{DOF}_{T_2} = \\phi(\\mathbf{p}_E) - \\phi(\\mathbf{p}_S) = \\phi(1,1) - \\phi(0,0) = (1+1) - (0+0) = 2 $$\n\n3.  **Naive Assembled Global DOF for $e_d$:**\n    The problem defines a naive assembly procedure as the simple addition of the local DOFs:\n    $$ \\text{DOF}_{\\text{global, naive}} = \\text{DOF}_{T_1} + \\text{DOF}_{T_2} = (-2) + (2) = 0 $$\n\n**Part 2: Conceptual Analysis of Conformity and Exactness**\n\nThe sequence $H^1(\\Omega)\\xrightarrow{\\nabla}H(\\mathrm{curl};\\Omega)\\xrightarrow{\\mathrm{curl}}L^2(\\Omega)$ is exact. This means the image of the gradient operator is precisely the kernel of the curl operator, i.e., $\\mathrm{curl}(\\nabla \\phi)=0$. Finite element methods that preserve this structure at the discrete level are said to be \"exact\" or \"structure-preserving\" and rely on a commuting diagram property.\n\nA finite element space is said to be \"conforming\" if it is a true subspace of the continuous Sobolev space. For the space $W_h \\subset H(\\mathrm{curl};\\Omega)$, this requires that for any function $\\mathbf{w}_h \\in W_h$, its tangential component must be continuous across all inter-element edges. Nédélec elements are designed to achieve this. Conformity is enforced by associating a single, unique degree of freedom with each edge in the global mesh.\n\nThe procedure is as follows:\n1.  Assign a single **global orientation** to each edge in the mesh. For $e_d$, let's choose the orientation from $(0,0)$ to $(1,1)$.\n2.  The global DOF for this edge is computed as the line integral along this globally oriented path:\n    $$ \\text{DOF}_{\\text{global, correct}} = \\int_{e_d, \\text{global}} \\nabla\\phi \\cdot \\mathbf{t}_{\\text{global}} ds = \\phi(1,1) - \\phi(0,0) = 2 $$\n3.  During assembly, the local DOF from each adjacent element is mapped to this global DOF. If the local orientation (used for basis function definition) matches the global orientation, the value is used directly. If it is opposite, the value must be multiplied by $-1$. This sign-mapping ensures that the local representations are consistent with a single global function that has a continuous tangential trace. For our example:\n    *   Triangle $T_2$: Local orientation matches global. Its local DOF ($2$) contributes to the global DOF.\n    *   Triangle $T_1$: Local orientation is opposite to global. Its local DOF ($-2$) would be multiplied by $-1$, yielding $( -(-2) = 2)$, which is consistent.\n\nThe \"naive assembly\" described in the problem, which simply adds local DOFs with opposing orientations, violates this principle. It produces a global DOF of $0$ for the gradient field $\\nabla\\phi$. This implies that the resulting discrete field has a zero tangential integral on edge $e_d$, which is false for the actual field $\\nabla\\phi$. This procedure effectively constructs a function with a discontinuous tangential component across $e_d$, meaning the resulting function is not in $H(\\mathrm{curl};\\Omega)$.\n\nThis loss of conformity breaks the discrete de Rham sequence. The property that the discrete representation of a gradient field is in the kernel of the discrete curl operator relies on the discrete Stokes' theorem, which only holds for conforming spaces where tangential components cancel correctly around the boundary of each element. By failing to enforce a consistent tangential component, the naive method loses the property that $\\mathrm{curl}_h(\\nabla_h \\phi_h) = 0$, thus breaking the exactness of the sequence. Restoring conformity by imposing a single global orientation per edge and using the correct sign-mapping in assembly restores the exactness property.\n\n### Option-by-Option Analysis\n\n*   **A. Without a consistent global orientation, the naive assembled edge DOF on $e_d$ equals $0$ because the local contributions $+2$ and $-2$ cancel; enforcing a single global edge orientation and sign-mapping yields a global DOF of $2$, thereby restoring tangential continuity and the exactness property that $\\mathrm{curl}\\circ\\nabla=0$ discretely.**\n    This statement accurately reflects our calculations and conceptual analysis. The naive DOF is indeed $0$ from the cancellation of $-2$ and $+2$. The correct global DOF (for one choice of orientation) is $2$. This correction restores conformity (tangential continuity) and, consequently, the exactness of the discrete sequence.\n    **Verdict: Correct.**\n\n*   **B. The naive assembled edge DOF on $e_d$ equals $2$ even without a consistent global orientation; imposing a single global edge orientation changes the global DOF to $0$, which restores tangential continuity and exactness.**\n    This statement has the computed values reversed. The naive DOF is $0$, and the correct global DOF is $2$ (or $-2$).\n    **Verdict: Incorrect.**\n\n*   **C. The loss of exactness occurs because $\\mathrm{curl}(\\nabla\\phi)$ is nonzero on each triangle for piecewise linear $\\phi$; orientation conventions cannot fix this, since the failure is due to the nonlinearity of the curl operator.**\n    This statement is factually incorrect on multiple grounds. For $\\phi(x,y)=x+y$, $\\nabla\\phi=(1,1)$, and $\\mathrm{curl}(\\nabla\\phi)=0$ everywhere. The curl operator is a linear operator. The failure is entirely due to the non-conforming assembly, which is fixed by orientation conventions.\n    **Verdict: Incorrect.**\n\n*   **D. The phenomenon only appears for second-order Nédélec elements; lowest-order edge elements are immune to orientation inconsistencies, so orientation conventions are unnecessary for restoring exactness in this case.**\n    This statement is the opposite of the truth. The need for consistent orientations is a fundamental aspect of all orders of Nédélec/edge elements (and differential forms in FEEC). The lowest-order element is the canonical case where this principle is demonstrated.\n    **Verdict: Incorrect.**", "answer": "$$\\boxed{A}$$", "id": "3297140"}, {"introduction": "With a firm grasp of the local properties and assembly of $H(\\mathrm{curl})$ elements, we can tackle more advanced applications that leverage the global structure of the discrete space. This exercise guides you through the implementation of a discrete Helmholtz decomposition, a cornerstone of vector field analysis that separates a field into its irrotational (gradient) and solenoidal parts [@problem_id:3297121]. You will translate the continuous orthogonality condition into a sparse linear system based on the mesh's incidence matrix, learning how to handle gauge freedom and numerically verify the decomposition, a powerful technique used across computational physics.", "problem": "You are asked to design and implement a discrete algorithm for the Helmholtz decomposition in the curl-conforming Sobolev space $H(\\mathrm{curl})$ on an unstructured mesh. Starting from fundamental definitions, derive a variational characterization of the decomposition and translate it into a graph-based linear algebra formulation that acts on edge-integrated degrees of freedom. The goal is to numerically separate a discrete vector field $\\mathbf{E}$ into a gradient component and an orthogonal curl-conforming complement.\n\nFundamental base and definitions to use:\n- The curl-conforming Sobolev space $H(\\mathrm{curl})$ on a domain $\\Omega \\subset \\mathbb{R}^3$ is defined as $H(\\mathrm{curl};\\Omega) = \\{\\mathbf{v} \\in (L^2(\\Omega))^3 : \\nabla \\times \\mathbf{v} \\in (L^2(\\Omega))^3\\}$, with analogous two-dimensional specialization when needed.\n- The Helmholtz decomposition in $H(\\mathrm{curl})$ expresses $\\mathbf{E} = \\nabla \\phi + \\mathbf{E}_\\perp$, where $\\phi \\in H^1(\\Omega)$ and $\\mathbf{E}_\\perp$ is orthogonal to gradients under a suitable inner product, i.e., $(\\mathbf{E}_\\perp, \\nabla \\psi) = 0$ for all $\\psi \\in H^1(\\Omega)$, where $(\\cdot,\\cdot)$ denotes the $L^2$ inner product.\n- On an unstructured mesh, represent discrete fields by edge-integrated degrees of freedom $\\int_e \\mathbf{E} \\cdot \\mathbf{t}\\, \\mathrm{d}s$ for each oriented edge $e$ with unit tangent $\\mathbf{t}$. For nodal scalar potentials $\\phi$, the discrete gradient along an oriented edge $(i \\to j)$ is the potential difference $\\phi_j - \\phi_i$.\n- The discrete incidence operator $B$ maps nodal potentials to edge differences: if an edge $e$ is oriented from node $i$ to node $j$, then $B_{e,i}=-1$ and $B_{e,j}=+1$. The discrete gradient subspace is $\\mathrm{range}(B)$, and discrete orthogonality to gradients is enforced by requiring $B^\\top W \\mathbf{E}_\\perp = \\mathbf{0}$ for a symmetric positive-definite edge-weight matrix $W$ that encodes the inner product on edges. In this problem, use $W = I$, the identity matrix, to define the discrete inner product on edge degrees of freedom as $(\\mathbf{u},\\mathbf{v}) = \\sum_e u_e v_e$.\n\nDerivation target:\n- Starting from the orthogonality condition $(\\mathbf{E}-B\\phi, B\\psi) = 0$ for all discrete test potentials $\\psi$, derive the normal equations $B^\\top B \\phi = B^\\top \\mathbf{E}$ for the nodal potential $\\phi$ (up to an additive constant). From $\\phi$, recover the gradient component $B\\phi$ and the curl-conforming complement $\\mathbf{E}_\\perp = \\mathbf{E} - B\\phi$. Discuss and justify the need to fix a gauge (e.g., pin one node to zero potential) to make the linear system nonsingular.\n\nAlgorithmic requirements:\n- Implement the discrete Helmholtz decomposition on an unstructured mesh with the above representation. Pin a single node (choose any node) to fix the gauge and solve the reduced linear system for $\\phi$.\n- Produce the gradient component and orthogonal complement and verify the orthogonality $B^\\top \\mathbf{E}_\\perp \\approx \\mathbf{0}$ numerically.\n\nMesh and test suite:\n- Use the following unstructured mesh in two dimensions with $N$ nodes and a set of oriented edges. Nodes have coordinates (dimensionless units):\n  - Node $0$: $(0.0,\\, 0.0)$\n  - Node $1$: $(1.0,\\, 0.0)$\n  - Node $2$: $(0.2,\\, 0.8)$\n  - Node $3$: $(1.1,\\, 0.9)$\n  - Node $4$: $(-0.2,\\, 0.9)$\n  - Node $5$: $(0.5,\\, -0.1)$\n  - Node $6$: $(0.8,\\, 0.5)$\n- Oriented edges (each oriented from the smaller node index to the larger): $(0,1)$, $(0,2)$, $(0,5)$, $(1,2)$, $(1,3)$, $(1,5)$, $(1,6)$, $(2,3)$, $(2,4)$, $(2,6)$, $(3,6)$, $(5,6)$.\n- Define the following discrete fields for three test cases, all expressed as edge-integrated degrees of freedom:\n  1. Mixed field: Let the nodal potential be $\\phi_i = \\sin(\\pi x_i) + 0.3\\, y_i$ at node $i$ with coordinates $(x_i, y_i)$. Define the gradient component along each oriented edge $(i,j)$ as $\\phi_j - \\phi_i$. Superimpose a solenoidal circulation along the closed loop of nodes $[0,1,6,3,2,0]$ with constant edge value amplitude $0.7$ along the loop direction; for an oriented edge used in the loop opposite to its stored orientation, assign the negative of the amplitude. The total field $\\mathbf{E}$ is the sum of the gradient and solenoidal components.\n  2. Pure gradient field: Use the same $\\phi_i$ as above and set $\\mathbf{E}$ equal to the discrete gradient component $B\\phi$ (no solenoidal circulation added).\n  3. Pure solenoidal field: Use only the circulation along the loop $[0,1,6,3,2,0]$ with amplitude $0.7$ (no gradient component).\n\nOutput specification:\n- For each test case, compute the discrete Helmholtz decomposition using $W=I$, pin node $0$ to $\\phi_0 = 0$, solve for $\\phi$, form $B\\phi$, and compute $\\mathbf{E}_\\perp = \\mathbf{E} - B\\phi$.\n- Report the following aggregated metrics across the test suite:\n  - For the mixed field (test case $1$): the orthogonality residual ratio $r_{\\mathrm{orth}} = \\|B^\\top \\mathbf{E}_\\perp\\|_2 / (\\|B^\\top \\mathbf{E}\\|_2 + \\varepsilon)$, and the reconstruction residual ratio $r_{\\mathrm{rec}} = \\|\\mathbf{E} - (B\\phi + \\mathbf{E}_\\perp)\\|_2 / \\|\\mathbf{E}\\|_2$, where $\\varepsilon$ is a small positive constant to avoid division by zero in edge cases; take $\\varepsilon = 10^{-12}$.\n  - For the pure gradient field (test case $2$): a boolean indicating whether the relative norm of the complement $\\|\\mathbf{E}_\\perp\\|_2 / \\|\\mathbf{E}\\|_2$ is less than $10^{-10}$.\n  - For the pure solenoidal field (test case $3$): a boolean indicating whether the relative norm of the gradient component $\\|B\\phi\\|_2 / \\|\\mathbf{E}\\|_2$ is less than $10^{-10}$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[r_{\\mathrm{orth}}, r_{\\mathrm{rec}}, \\text{bool\\_case2}, \\text{bool\\_case3}]$.\n\nAll quantities are dimensionless; do not introduce any physical units. Angles appear only inside the definition of $\\phi_i$ via the sine function and are evaluated in radians.", "solution": "The problem asks for the design and implementation of a discrete Helmholtz decomposition algorithm for a vector field defined on an unstructured mesh. The field is represented by its edge-integrated degrees of freedom. The decomposition separates the field $\\mathbf{E}$ into a pure gradient (curl-free) component $\\mathbf{E}_{\\nabla}$ and an orthogonal complement $\\mathbf{E}_{\\perp}$ that is curl-conforming (in this discrete context, divergence-free). The foundation of the method lies in a variational principle that is translated into a system of linear equations.\n\nLet the set of nodes be $\\mathcal{N}$ and the set of oriented edges be $\\mathcal{E}$, with cardinalities $N_n=|\\mathcal{N}|$ and $N_e=|\\mathcal{E}|$, respectively. A discrete scalar potential is a vector $\\phi \\in \\mathbb{R}^{N_n}$, assigning a value to each node. A discrete vector field is a vector $\\mathbf{E} \\in \\mathbb{R}^{N_e}$, assigning a value to each edge.\n\nThe discrete gradient operator is represented by the incidence matrix $B \\in \\mathbb{R}^{N_e \\times N_n}$. For an edge $e \\in \\mathcal{E}$ oriented from node $i$ to node $j$, the corresponding row of $B$ has entries $B_{e,i} = -1$ and $B_{e,j} = +1$, and $0$ otherwise. The gradient of a nodal potential $\\phi$ is an edge field given by $\\mathbf{E}_{\\nabla} = B\\phi$. This is the discrete analogue of taking the gradient of a scalar function.\n\nThe discrete Helmholtz decomposition is written as:\n$$ \\mathbf{E} = B\\phi + \\mathbf{E}_{\\perp} $$\nwhere $\\mathbf{E}_{\\nabla} = B\\phi$ is the gradient component and $\\mathbf{E}_{\\perp}$ is its orthogonal complement. The problem defines the inner product on the space of edge fields $\\mathbb{R}^{N_e}$ as $(\\mathbf{u}, \\mathbf{v}) = \\mathbf{u}^\\top \\mathbf{v}$, corresponding to the weight matrix $W=I$.\n\nThe defining property of the decomposition is that $\\mathbf{E}_{\\perp}$ must be orthogonal to the entire subspace of gradient fields, which is the range of the operator $B$. This means $(\\mathbf{E}_{\\perp}, B\\psi) = 0$ for all possible nodal potential vectors $\\psi \\in \\mathbb{R}^{N_n}$. Substituting $\\mathbf{E}_{\\perp} = \\mathbf{E} - B\\phi$, we formulate the variational problem: find $\\phi \\in \\mathbb{R}^{N_n}$ such that\n$$ (\\mathbf{E} - B\\phi, B\\psi) = 0 \\quad \\forall \\psi \\in \\mathbb{R}^{N_n} $$\nUsing the inner product definition and properties of the matrix transpose, this becomes:\n$$ (B\\psi)^\\top (\\mathbf{E} - B\\phi) = 0 $$\n$$ \\psi^\\top B^\\top (\\mathbf{E} - B\\phi) = 0 $$\nSince this must hold for any vector $\\psi$, the term in the parenthesis must be the zero vector. This yields the normal equations for the potential $\\phi$:\n$$ B^\\top (\\mathbf{E} - B\\phi) = \\mathbf{0} \\implies B^\\top B \\phi = B^\\top \\mathbf{E} $$\nThe matrix $L = B^\\top B$ is the graph Laplacian. It is a symmetric, positive semi-definite matrix. For any connected graph, $L$ has a one-dimensional nullspace spanned by the constant vector $\\mathbf{1} = [1, 1, \\dots, 1]^\\top$. This is because the gradient of a constant potential is zero: $B(c\\mathbf{1}) = \\mathbf{0}$ for any scalar $c$. Therefore, $L(c\\mathbf{1}) = B^\\top B (c\\mathbf{1}) = \\mathbf{0}$. The singularity of $L$ implies that the system $L\\phi = B^\\top\\mathbf{E}$ does not have a unique solution; if $\\phi^*$ is a solution, so is $\\phi^* + c\\mathbf{1}$.\n\nTo obtain a unique solution for $\\phi$, we must \"fix the gauge\" by imposing an additional constraint. A standard choice is to pin the potential of one node to a constant value, for instance, $\\phi_0 = 0$. This removes the ambiguity. To implement this, we remove the row and column corresponding to node $0$ from the matrix $L$, and the corresponding entry from the vectors $\\phi$ and $B^\\top\\mathbf{E}$. Let $L_R$ be the resulting reduced $(N_n-1) \\times (N_n-1)$ matrix, and let $\\phi_R$ and $(B^\\top\\mathbf{E})_R$ be the reduced vectors. The modified system is:\n$$ L_R \\phi_R = (B^\\top\\mathbf{E})_R $$\nThe reduced matrix $L_R$ is invertible for a connected graph, yielding a unique solution for $\\phi_R$. The full potential vector $\\phi$ is then reconstructed by re-inserting $\\phi_0=0$.\n\nThe overall computational procedure is:\n1.  Construct the incidence matrix $B$ from the mesh topology.\n2.  Define the input edge field $\\mathbf{E}$ for each test case.\n3.  Compute the graph Laplacian $L = B^\\top B$ and the right-hand side vector $\\mathbf{f} = B^\\top \\mathbf{E}$.\n4.  Apply the gauge-fixing condition ($\\phi_0=0$) by forming the reduced system $L_R \\phi_R = \\mathbf{f}_R$.\n5.  Solve the reduced linear system for $\\phi_R$.\n6.  Reconstruct the full potential vector $\\phi$.\n7.  Compute the gradient component $\\mathbf{E}_{\\nabla} = B\\phi$.\n8.  Compute the orthogonal complement $\\mathbf{E}_{\\perp} = \\mathbf{E} - \\mathbf{E}_{\\nabla}$.\n9.  Finally, evaluate the specified quality metrics for each test case to verify the correctness of the decomposition. The orthogonality residual ratio $r_{\\mathrm{orth}} = \\|B^\\top \\mathbf{E}_\\perp\\|_2 / (\\|B^\\top \\mathbf{E}\\|_2 + \\varepsilon)$ should be small, confirming that $\\mathbf{E}_\\perp$ is discretely divergence-free. The reconstruction residual $r_{\\mathrm{rec}} = \\|\\mathbf{E} - (\\mathbf{E}_{\\nabla} + \\mathbf{E}_\\perp)\\|_2 / \\|\\mathbf{E}\\|_2$ should be on the order of machine precision.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and tests the discrete Helmholtz decomposition on a given\n    unstructured mesh.\n    \"\"\"\n    # Define mesh and constants\n    nodes = np.array([\n        [0.0, 0.0],  # Node 0\n        [1.0, 0.0],  # Node 1\n        [0.2, 0.8],  # Node 2\n        [1.1, 0.9],  # Node 3\n        [-0.2, 0.9], # Node 4\n        [0.5, -0.1], # Node 5\n        [0.8, 0.5],  # Node 6\n    ])\n    num_nodes = nodes.shape[0]\n\n    # Edges are oriented from smaller to larger node index\n    edges = [\n        (0, 1), (0, 2), (0, 5), (1, 2), (1, 3), (1, 5), \n        (1, 6), (2, 3), (2, 4), (2, 6), (3, 6), (5, 6)\n    ]\n    num_edges = len(edges)\n    edge_map = {edge: i for i, edge in enumerate(edges)}\n\n    epsilon = 1e-12\n\n    # 1. Construct the incidence matrix B\n    B = np.zeros((num_edges, num_nodes))\n    for i, (u, v) in enumerate(edges):\n        B[i, u] = -1\n        B[i, v] = 1\n\n    # --- Test Case Field Generation ---\n\n    # Base potential for gradient fields\n    phi_true = np.sin(np.pi * nodes[:, 0]) + 0.3 * nodes[:, 1]\n    \n    # Gradient component (used in cases 1 and 2)\n    E_grad_true = B @ phi_true\n\n    # Solenoidal component (used in cases 1 and 3)\n    # Circulation along loop [0, 1, 6, 3, 2, 0] with amplitude 0.7\n    E_sol = np.zeros(num_edges)\n    amplitude = 0.7\n    loop_edges_oriented = [(0, 1), (1, 6), (6, 3), (3, 2), (2, 0)]\n    \n    for u, v in loop_edges_oriented:\n        if (u, v) in edge_map:\n            E_sol[edge_map[(u, v)]] += amplitude\n        elif (v, u) in edge_map:\n            E_sol[edge_map[(v, u)]] -= amplitude\n        # else: This case is not expected for the given mesh and loop\n    \n    test_fields = {\n        1: E_grad_true + E_sol, # Mixed field\n        2: E_grad_true,           # Pure gradient field\n        3: E_sol                  # Pure solenoidal field\n    }\n\n    # --- Decomposition and Metric Calculation ---\n    results = []\n\n    def perform_decomposition(E):\n        \"\"\"Solves for the potential and returns the decomposed fields.\"\"\"\n        # 3. Compute L and f\n        L = B.T @ B\n        f = B.T @ E\n\n        # 4. Apply gauge fixing (pin node 0 to 0)\n        # We solve for nodes 1 to N-1\n        pinned_node = 0\n        active_nodes = list(range(num_nodes))\n        active_nodes.remove(pinned_node)\n        \n        L_reduced = L[np.ix_(active_nodes, active_nodes)]\n        f_reduced = f[active_nodes]\n\n        # 5. Solve the reduced system\n        phi_reduced = np.linalg.solve(L_reduced, f_reduced)\n\n        # 6. Reconstruct full potential vector\n        phi = np.zeros(num_nodes)\n        phi[active_nodes] = phi_reduced\n        \n        # 7.  8. Compute gradient and orthogonal components\n        E_grad = B @ phi\n        E_perp = E - E_grad\n        \n        return E_grad, E_perp\n\n    # Case 1: Mixed field\n    E1 = test_fields[1]\n    E1_grad, E1_perp = perform_decomposition(E1)\n    \n    # Orthogonality residual ratio\n    orth_num = np.linalg.norm(B.T @ E1_perp)\n    orth_den = np.linalg.norm(B.T @ E1) + epsilon\n    r_orth = orth_num / orth_den\n    results.append(r_orth)\n    \n    # Reconstruction residual ratio\n    rec_num = np.linalg.norm(E1 - (E1_grad + E1_perp))\n    rec_den = np.linalg.norm(E1)\n    r_rec = rec_num / rec_den if rec_den > 0 else 0.0\n    results.append(r_rec)\n    \n    # Case 2: Pure gradient field\n    E2 = test_fields[2]\n    _, E2_perp = perform_decomposition(E2)\n    \n    norm_E2 = np.linalg.norm(E2)\n    relative_norm_perp = np.linalg.norm(E2_perp) / norm_E2 if norm_E2 > 0 else 0.0\n    bool_case2 = relative_norm_perp  1e-10\n    results.append(bool_case2)\n    \n    # Case 3: Pure solenoidal field\n    E3 = test_fields[3]\n    E3_grad, _ = perform_decomposition(E3)\n    \n    norm_E3 = np.linalg.norm(E3)\n    relative_norm_grad = np.linalg.norm(E3_grad) / norm_E3 if norm_E3 > 0 else 0.0\n    bool_case3 = relative_norm_grad  1e-10\n    results.append(bool_case3)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3297121"}]}