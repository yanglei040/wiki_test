{"hands_on_practices": [{"introduction": "To begin our hands-on exploration, we first examine the fundamental mathematical properties of pulse basis functions. This exercise grounds our understanding by deriving the mass matrix, which represents the inner product of these functions [@problem_id:3351541]. By demonstrating how the mass matrix becomes diagonal for non-overlapping sub-domains, we reveal a key simplifying property and explore its direct impact on calculating the energy, or $L^2$ norm, of an approximated field.", "problem": "Consider a perfectly conducting surface $\\Gamma$ partitioned into a conforming mesh of nonoverlapping planar elements $\\{T_{i}\\}_{i=1}^{N}$ such that $T_{i} \\cap T_{j}$ has zero area for $i \\neq j$ and $\\bigcup_{i=1}^{N} T_{i} = \\Gamma$. Let $\\{\\phi_{i}\\}_{i=1}^{N}$ denote sub-domain (pulse) basis functions used in the Method of Moments (MoM), defined by $\\phi_{i}(\\mathbf{r}) = 1$ for $\\mathbf{r} \\in T_{i}$ and $\\phi_{i}(\\mathbf{r}) = 0$ otherwise. Using the definition of the $L^{2}$ inner product on $\\Gamma$, \n$$\\langle f, g \\rangle_{L^{2}(\\Gamma)} = \\int_{\\Gamma} f(\\mathbf{r})\\,g(\\mathbf{r})\\,dS,$$\nderive the entries $M_{ij}$ of the mass matrix \n$$M_{ij} = \\int_{\\Gamma} \\phi_{i}(\\mathbf{r})\\,\\phi_{j}(\\mathbf{r})\\,dS,$$\nexpressing $M_{ij}$ in terms of the element areas. Then, starting from the definition of the $L^{2}$ norm, explain how nonuniform element areas affect the discrete $L^{2}$ norm of a scalar surface field $u(\\mathbf{r})$ approximated by pulses $u_{h}(\\mathbf{r}) = \\sum_{i=1}^{N} c_{i}\\,\\phi_{i}(\\mathbf{r})$. \n\nFinally, evaluate this norm for a specific triangulated surface consisting of $N=3$ elements with areas $A_{1} = 8.0 \\times 10^{-3}\\,\\mathrm{m}^{2}$, $A_{2} = 2.0 \\times 10^{-3}\\,\\mathrm{m}^{2}$, and $A_{3} = 1.8 \\times 10^{-2}\\,\\mathrm{m}^{2}$, and a piecewise-constant scalar surface current density approximation with coefficients $c_{1} = 5.0\\,\\mathrm{A/m}$, $c_{2} = -3.0\\,\\mathrm{A/m}$, and $c_{3} = 1.0\\,\\mathrm{A/m}$. Compute \n$$\\|u_{h}\\|_{L^{2}(\\Gamma)} = \\sqrt{\\int_{\\Gamma} |u_{h}(\\mathbf{r})|^{2}\\,dS}.$$\nExpress the final value in amperes $\\mathrm{(A)}$ and round your answer to four significant figures.", "solution": "The problem is validated as self-contained, scientifically grounded, and well-posed. It is a standard exercise in the numerical analysis of integral equations using the Method of Moments (MoM). All definitions and data required for the derivation and calculation are provided and are internally consistent.\n\nThe problem consists of three parts: deriving the entries of the mass matrix for pulse basis functions, explaining the effect of mesh non-uniformity on the $L^{2}$ norm, and calculating this norm for a specific case.\n\nFirst, we derive the entries $M_{ij}$ of the mass matrix. The mass matrix is defined by the $L^{2}$ inner product of the basis functions:\n$$M_{ij} = \\langle \\phi_i, \\phi_j \\rangle_{L^{2}(\\Gamma)} = \\int_{\\Gamma} \\phi_{i}(\\mathbf{r})\\,\\phi_{j}(\\mathbf{r})\\,dS$$\nThe sub-domain (pulse) basis functions are defined as:\n$$\\phi_{k}(\\mathbf{r}) = \\begin{cases} 1 & \\mathbf{r} \\in T_{k} \\\\ 0 & \\mathbf{r} \\notin T_{k} \\end{cases}$$\nThe product of two such functions, $\\phi_{i}(\\mathbf{r})\\,\\phi_{j}(\\mathbf{r})$, is non-zero only at points $\\mathbf{r}$ that belong to both element $T_{i}$ and element $T_{j}$. That is, the support of the integrand is the intersection $T_{i} \\cap T_{j}$. The value of the product on this intersection is $1 \\times 1 = 1$.\nThe integral thus becomes:\n$$M_{ij} = \\int_{T_{i} \\cap T_{j}} 1 \\,dS = \\text{Area}(T_{i} \\cap T_{j})$$\nWe consider two cases for the indices $i$ and $j$:\n1.  Case $i = j$: The intersection is $T_{i} \\cap T_{i} = T_{i}$. The integral evaluates to the area of the element $T_{i}$, which we denote as $A_{i}$.\n    $$M_{ii} = \\text{Area}(T_{i}) = A_{i}$$\n2.  Case $i \\neq j$: The problem states that the elements $\\{T_{k}\\}$ are nonoverlapping, meaning $T_{i} \\cap T_{j}$ has zero area for $i \\neq j$. Therefore, the integral over a region of zero area is zero.\n    $$M_{ij} = \\text{Area}(T_{i} \\cap T_{j}) = 0 \\quad \\text{for } i \\neq j$$\nCombining these two cases using the Kronecker delta, $\\delta_{ij}$, the entries of the mass matrix are given by:\n$$M_{ij} = A_{i}\\,\\delta_{ij}$$\nThis shows that for pulse basis functions on a nonoverlapping mesh, the mass matrix is a diagonal matrix whose diagonal entries are the areas of the corresponding mesh elements.\n\nSecond, we analyze how nonuniform element areas affect the discrete $L^{2}$ norm of a scalar surface field $u(\\mathbf{r})$ approximated by $u_{h}(\\mathbf{r}) = \\sum_{k=1}^{N} c_{k}\\,\\phi_{k}(\\mathbf{r})$. The squared $L^{2}$ norm is defined as:\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = \\int_{\\Gamma} |u_{h}(\\mathbf{r})|^{2}\\,dS$$\nSubstituting the expansion for $u_h(\\mathbf{r})$:\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = \\int_{\\Gamma} \\left| \\sum_{k=1}^{N} c_{k}\\,\\phi_{k}(\\mathbf{r}) \\right|^{2}\\,dS$$\nSince the supports of the basis functions $\\phi_{k}$ are disjoint (the elements $T_k$ are nonoverlapping), at any point $\\mathbf{r}$ within an element $T_j$, only the basis function $\\phi_j(\\mathbf{r})$ is non-zero (equal to $1$). The sum thus simplifies to $c_j$ for $\\mathbf{r} \\in T_j$. The function $u_h(\\mathbf{r})$ is piecewise constant, with $u_{h}(\\mathbf{r}) = c_{j}$ for $\\mathbf{r} \\in T_{j}$. The integral over the entire surface $\\Gamma = \\bigcup_{j=1}^{N} T_{j}$ can be written as a sum of integrals over each element:\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = \\sum_{j=1}^{N} \\int_{T_{j}} |u_{h}(\\mathbf{r})|^{2}\\,dS = \\sum_{j=1}^{N} \\int_{T_{j}} |c_{j}|^{2}\\,dS$$\nSince $|c_j|^2$ is constant over the element $T_j$, we can pull it out of the integral:\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = \\sum_{j=1}^{N} |c_{j}|^{2} \\int_{T_{j}} dS = \\sum_{j=1}^{N} |c_{j}|^{2} A_{j}$$\nThis expression reveals that the squared $L^{2}$ norm of the approximated field is a weighted sum of the squared coefficients $|c_{j}|^{2}$. The weight for each coefficient is the area $A_{j}$ of the corresponding element. Consequently, if the element areas $A_j$ are nonuniform, coefficients associated with larger elements make a greater contribution to the total norm than coefficients of the same magnitude associated with smaller elements. The $L^{2}$ norm thus directly reflects the spatial extent over which the function has a certain value, weighting the function's local magnitude by the area over which it is applied.\n\nFinally, we evaluate this norm for the given specific case. We are given $N=3$ elements with areas $A_{1} = 8.0 \\times 10^{-3}\\,\\mathrm{m}^{2}$, $A_{2} = 2.0 \\times 10^{-3}\\,\\mathrm{m}^{2}$, and $A_{3} = 1.8 \\times 10^{-2}\\,\\mathrm{m}^{2}$. The coefficients for the scalar surface current density approximation are $c_{1} = 5.0\\,\\mathrm{A/m}$, $c_{2} = -3.0\\,\\mathrm{A/m}$, and $c_{3} = 1.0\\,\\mathrm{A/m}$.\nThe squared norm is:\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = |c_{1}|^{2}A_{1} + |c_{2}|^{2}A_{2} + |c_{3}|^{2}A_{3}$$\nSubstituting the given values:\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = |5.0|^{2}\\,(8.0 \\times 10^{-3}) + |-3.0|^{2}\\,(2.0 \\times 10^{-3}) + |1.0|^{2}\\,(1.8 \\times 10^{-2})$$\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = (25.0)\\,(8.0 \\times 10^{-3}) + (9.0)\\,(2.0 \\times 10^{-3}) + (1.0)\\,(18.0 \\times 10^{-3})$$\nThe unit of each term is $(\\mathrm{A/m})^{2} \\cdot \\mathrm{m}^{2} = \\mathrm{A}^{2}$.\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = (200.0 \\times 10^{-3}) + (18.0 \\times 10^{-3}) + (18.0 \\times 10^{-3})\\,\\mathrm{A}^{2}$$\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = (0.200 + 0.018 + 0.018)\\,\\mathrm{A}^{2}$$\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = 0.236\\,\\mathrm{A}^{2}$$\nThe $L^{2}$ norm is the square root of this value:\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)} = \\sqrt{0.236}\\,\\mathrm{A} \\approx 0.48579831\\,\\mathrm{A}$$\nRounding the result to four significant figures as requested, we get $0.4858\\,\\mathrm{A}$.", "answer": "$$\\boxed{0.4858}$$", "id": "3351541"}, {"introduction": "While pulse basis functions offer simplicity, they possess a critical flaw: they are inherently discontinuous. This practice delves into the significant physical consequences of this mathematical discontinuity by investigating how jumps in the approximated current give rise to non-physical, spurious charges at element interfaces [@problem_id:3351553]. By quantifying these artifacts using jump seminorms, you will develop a crucial diagnostic tool for assessing the quality of a numerical solution and gain insight into the primary motivation for developing more advanced, continuous basis functions.", "problem": "Consider a one-dimensional sub-domain discretization of a thin, perfectly conducting wire carrying a time-harmonic current. In the time-harmonic setting with complex phasors and angular frequency $\\,\\omega\\,$, charge conservation yields the continuity equation $\\,\\nabla \\cdot \\mathbf{J} = -j \\omega \\rho\\,$, where $\\,\\mathbf{J}\\,$ is the current density and $\\,\\rho\\,$ is the charge density. In a one-dimensional line model, this reduces to $\\,\\frac{d J(x)}{dx} = -j \\omega \\rho_\\ell(x)\\,$, where $\\,J(x)\\,$ is the line current (in amperes) and $\\,\\rho_\\ell(x)\\,$ is the line charge per unit length (in coulombs per meter). In a sub-domain approach with pulse (piecewise constant) basis functions, the discrete unknowns are the elementwise constants $\\,J_i\\,$ defined on intervals $\\,I_i = [x_{i-1}, x_i]\\,$ of lengths $\\,h_i = x_i - x_{i-1}\\,$ for $\\,i=1,\\dots,N\\,$, so that $\\,J(x) = J_i\\,$ for $\\,x \\in I_i\\,$. At interior interfaces $\\,x_k\\,$, $\\,k=1,\\dots,N-1\\,$, the piecewise constant approximation admits jumps $\\,\\Delta J_k = J_{k+1} - J_k\\,$. Interpreted in the sense of distributions, $\\,\\frac{dJ}{dx} = \\sum_{k=1}^{N-1} \\Delta J_k \\,\\delta(x - x_k)\\,$, which, via the continuity equation, implies concentrated (point) charges at the interfaces with strengths $\\,Q_k = \\int_{x_k-\\varepsilon}^{x_k+\\varepsilon} \\rho_\\ell(x)\\,dx = -\\frac{\\Delta J_k}{j\\omega}\\,$. The magnitudes of these charges are $\\,|Q_k| = \\frac{|\\Delta J_k|}{\\omega}\\,$. These are numerical artifacts of the pulse discretization unless a physical feed or termination enforces real charge accumulation.\n\nDefine two jump-based seminorms that quantify inter-element discontinuities:\n- The pure jump seminorm $\\,S_2 = \\sum_{k=1}^{N-1} |\\Delta J_k|^2\\,$ with units $\\,\\mathrm{A}^2\\,$.\n- The mesh-weighted jump seminorm $\\,S_{2,h} = \\sum_{k=1}^{N-1} \\frac{|\\Delta J_k|^2}{h_k^{\\mathrm{avg}}}\\,$ with $\\,h_k^{\\mathrm{avg}} = \\frac{h_k + h_{k+1}}{2}\\,$ and units $\\,\\mathrm{A}^2/\\mathrm{m}\\,$.\n\nStarting from the conservation law $\\,\\frac{d J(x)}{dx} = -j \\omega \\rho_\\ell(x)\\,$ and the pulse representation $\\,J(x) = \\sum_{i=1}^N J_i \\chi_{I_i}(x)\\,$, derive how the interface jumps $\\,\\Delta J_k\\,$ generate the spurious point charges $\\,Q_k\\,$ and how the seminorms $\\,S_2\\,$ and $\\,S_{2,h}\\,$ quantify the discontinuity-induced error. Then, implement an algorithm that, for each test case described below, computes:\n- $\\,S_2\\,$ in $\\,\\mathrm{A}^2\\,$.\n- $\\,S_{2,h}\\,$ in $\\,\\mathrm{A}^2/\\mathrm{m}\\,$.\n- $\\,Q_{\\max} = \\max_k |Q_k|\\,$ in $\\,\\mathrm{C}\\,$.\n- $\\,Q_{\\mathrm{sum}} = \\sum_k |Q_k|\\,$ in $\\,\\mathrm{C}\\,$.\n\nYou are given the following test suite. Each test case provides the element lengths $\\,h_i\\,$ (in meters), the pulse values $\\,J_i\\,$ (in amperes), and the frequency $\\,f\\,$ (in hertz). Use $\\,\\omega = 2\\pi f\\,$. Consider only interior interfaces $\\,k=1,\\dots,N-1\\,$ when computing jumps and charges. Report charges in coulombs, $\\,S_2\\,$ in $\\,\\mathrm{A}^2\\,$, and $\\,S_{2,h}\\,$ in $\\,\\mathrm{A}^2/\\mathrm{m}\\,$.\n\n- Test case A (happy path): $\\,h = [0.25, 0.25, 0.25, 0.25]\\,$, $\\,J = [1.0, 0.5, 0.5, -0.5]\\,$, $\\,f = 1.0 \\times 10^8\\,$.\n- Test case B (continuity satisfied): $\\,h = [0.2, 0.3, 0.1, 0.4]\\,$, $\\,J = [2.0, 2.0, 2.0, 2.0]\\,$, $\\,f = 1.0 \\times 10^9\\,$.\n- Test case C (single interior jump at low frequency): $\\,h = [0.1, 0.2, 0.4, 0.3]\\,$, $\\,J = [0.0, 5.0, 5.0, 5.0]\\,$, $\\,f = 1.0 \\times 10^4\\,$.\n- Test case D (alternating signs on a nonuniform mesh): $\\,h = [0.05, 0.15, 0.10, 0.20, 0.50]\\,$, $\\,J = [1.0, -1.0, 1.0, -1.0, 1.0]\\,$, $\\,f = 2.0 \\times 10^9\\,$.\n\nYour program should produce a single line of output containing the results as a comma-separated list of per-case results, where each per-case result is a bracketed comma-separated list $[S_2, S_{2,h}, Q_{\\max}, Q_{\\mathrm{sum}}]$, and the overall list is enclosed in square brackets. For example: $[[r_{A1}, r_{A2}, r_{A3}, r_{A4}], [r_{B1}, r_{B2}, r_{B3}, r_{B4}], [r_{C1}, r_{C2}, r_{C3}, r_{C4}], [r_{D1}, r_{D2}, r_{D3}, r_{D4}]]$. No other text should be printed.", "solution": "The problem is valid. It is scientifically grounded in the principles of electromagnetism and numerical analysis, well-posed with all necessary information provided, and objective in its formulation.\n\nThe core of this problem lies in understanding the consequences of approximating a continuous physical quantity, the electric current $J(x)$, with a discontinuous, piecewise-constant function within a numerical method, specifically the Method of Moments using pulse basis functions. The derivation begins with the one-dimensional, time-harmonic continuity equation, which represents the conservation of charge:\n$$\n\\frac{d J(x)}{dx} = -j \\omega \\rho_\\ell(x)\n$$\nHere, $J(x)$ is the line current, $\\rho_\\ell(x)$ is the line charge density, $\\omega$ is the angular frequency, and $j$ is the imaginary unit. This equation states that any spatial variation in the current must be accompanied by a dynamic change in charge density.\n\nIn a sub-domain discretization, the domain (a thin wire) is partitioned into $N$ segments, or elements, $I_i = [x_{i-1}, x_i]$ for $i=1, \\dots, N$. The current $J(x)$ is approximated as a sum of pulse basis functions, $\\chi_{I_i}(x)$, which are equal to $1$ on the interval $I_i$ and $0$ elsewhere. The approximation takes the form:\n$$\nJ(x) \\approx \\sum_{i=1}^N J_i \\chi_{I_i}(x)\n$$\nwhere $J_i$ is the constant value of the current on the $i$-th element. This representation is inherently discontinuous at the interior interfaces $x_k$ for $k=1, \\dots, N-1$. At each such interface, the current value abruptly jumps from $J_k$ to $J_{k+1}$. The magnitude of this jump is defined as $\\Delta J_k = J_{k+1} - J_k$.\n\nIn classical calculus, the derivative of such a piecewise-constant function is undefined at the points of discontinuity. However, in the theory of distributions (or generalized functions), the derivative can be defined. The derivative of a step-like discontinuity is a Dirac delta function, $\\delta(x)$. For the approximated current $J(x)$, its distributional derivative consists of a weighted sum of Dirac delta functions located at each interface where a jump occurs:\n$$\n\\frac{d J(x)}{dx} = \\sum_{k=1}^{N-1} (J_{k+1} - J_k) \\delta(x - x_k) = \\sum_{k=1}^{N-1} \\Delta J_k \\delta(x - x_k)\n$$\nBy substituting this expression back into the continuity equation, we equate the two forms of the derivative:\n$$\n\\sum_{k=1}^{N-1} \\Delta J_k \\delta(x - x_k) = -j \\omega \\rho_\\ell(x)\n$$\nSolving for the line charge density $\\rho_\\ell(x)$ yields:\n$$\n\\rho_\\ell(x) = \\frac{1}{-j\\omega} \\sum_{k=1}^{N-1} \\Delta J_k \\delta(x - x_k) = \\sum_{k=1}^{N-1} \\left( \\frac{j \\Delta J_k}{\\omega} \\right) \\delta(x - x_k)\n$$\nThis expression reveals that the charge density is not smoothly distributed. Instead, it is a series of point charges concentrated at the element interfaces. The strength of the point charge $Q_k$ at interface $x_k$ is the coefficient of the corresponding delta function:\n$$\nQ_k = \\frac{j \\Delta J_k}{\\omega}\n$$\nThese are non-physical, spurious charges that arise as a direct mathematical artifact of using discontinuous basis functions to represent the current. They violate the physics of a continuous conductor unless a physical mechanism (like a source or a gap) is explicitly modeled at that point. The magnitude of each spurious charge is:\n$$\n|Q_k| = \\left| \\frac{j \\Delta J_k}{\\omega} \\right| = \\frac{|j| |\\Delta J_k|}{|\\omega|} = \\frac{|\\Delta J_k|}{\\omega}\n$$\nThe problem requires the calculation of two seminorms that quantify the severity of these discontinuities.\nThe pure jump seminorm, $S_2 = \\sum_{k=1}^{N-1} |\\Delta J_k|^2$, measures the total squared magnitude of all current jumps. It is a direct indicator of the overall \"discontinuity energy\" in the solution.\nThe mesh-weighted jump seminorm, $S_{2,h} = \\sum_{k=1}^{N-1} \\frac{|\\Delta J_k|^2}{h_k^{\\mathrm{avg}}}$ where $h_k^{\\mathrm{avg}} = \\frac{h_k + h_{k+1}}{2}$, penalizes jumps more severely when they occur between smaller elements. This is a common feature in a posteriori error estimators for finite element methods, as a large gradient over a small region suggests a feature that is poorly resolved by the mesh.\n\nThe algorithm to compute the required quantities for each test case is as follows:\n1.  Receive the arrays of element lengths $h = [h_1, \\dots, h_N]$, current values $J = [J_1, \\dots, J_N]$, and the frequency $f$.\n2.  Calculate the angular frequency $\\omega = 2\\pi f$.\n3.  Determine the number of elements $N$ from the length of the input arrays.\n4.  Iterate through the interior interfaces, indexed from $k=1$ to $N-1$. In a zero-indexed programming context, this corresponds to an index $i$ from $0$ to $N-2$.\n5.  At each interface $i$ (between element $i$ and $i+1$):\n    a. Calculate the current jump: $\\Delta J_i = J_{i+1} - J_i$.\n    b. Calculate the average element length: $h_i^{\\mathrm{avg}} = (h_i + h_{i+1})/2$.\n    c. Calculate the magnitude of the spurious charge: $|Q_i| = |\\Delta J_i| / \\omega$.\n    d. Store the squared jump $|\\Delta J_i|^2$, the weighted squared jump $|\\Delta J_i|^2 / h_i^{\\mathrm{avg}}$, and the charge magnitude $|Q_i|$.\n6.  Sum the stored values to obtain $S_2 = \\sum_i |\\Delta J_i|^2$ and $S_{2,h} = \\sum_i \\frac{|\\Delta J_i|^2}{h_i^{\\mathrm{avg}}}$.\n7.  From the stored charge magnitudes, find the maximum value $Q_{\\max} = \\max_i |Q_i|$ and the sum $Q_{\\mathrm{sum}} = \\sum_i |Q_i|$.\n8.  Return the four computed values: $S_2$, $S_{2,h}$, $Q_{\\max}$, and $Q_{\\mathrm{sum}}$. If there are no interior interfaces ($N \\le 1$) or no jumps, these quantities are all zero.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes jump-based seminorms and spurious charge metrics for\n    pulse basis functions in a 1D Method of Moments context.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case A (happy path)\n        {'h': np.array([0.25, 0.25, 0.25, 0.25]), 'J': np.array([1.0, 0.5, 0.5, -0.5]), 'f': 1.0e8},\n        # Test case B (continuity satisfied)\n        {'h': np.array([0.2, 0.3, 0.1, 0.4]), 'J': np.array([2.0, 2.0, 2.0, 2.0]), 'f': 1.0e9},\n        # Test case C (single interior jump at low frequency)\n        {'h': np.array([0.1, 0.2, 0.4, 0.3]), 'J': np.array([0.0, 5.0, 5.0, 5.0]), 'f': 1.0e4},\n        # Test case D (alternating signs on a nonuniform mesh)\n        {'h': np.array([0.05, 0.15, 0.10, 0.20, 0.50]), 'J': np.array([1.0, -1.0, 1.0, -1.0, 1.0]), 'f': 2.0e9},\n    ]\n\n    results = []\n    for case in test_cases:\n        h = case['h']\n        J = case['J']\n        f = case['f']\n        \n        N = len(h)\n        if N <= 1:\n            # No interior interfaces, so all quantities are zero.\n            results.append([0.0, 0.0, 0.0, 0.0])\n            continue\n\n        # Calculate angular frequency\n        omega = 2.0 * np.pi * f\n\n        # Calculate jumps at interior interfaces k=1,...,N-1\n        # In 0-based indexing, this corresponds to J[i+1] - J[i] for i=0,...,N-2\n        delta_J = J[1:] - J[:-1]\n        \n        # Calculate average mesh sizes at interfaces\n        # h_k_avg = (h_k + h_{k+1}) / 2\n        # In 0-based indexing, h_avg for interface i is (h[i] + h[i+1])/2\n        h_avg = (h[:-1] + h[1:]) / 2.0\n        \n        # Calculate pure jump seminorm S_2\n        # S_2 = sum(|delta_J_k|^2)\n        # abs() is used for generality, though J is real in these cases.\n        S_2 = np.sum(np.abs(delta_J)**2)\n        \n        # Calculate mesh-weighted jump seminorm S_{2,h}\n        # S_{2,h} = sum(|delta_J_k|^2 / h_k_avg)\n        S_2_h = np.sum(np.abs(delta_J)**2 / h_avg)\n        \n        # Calculate magnitudes of spurious point charges\n        # |Q_k| = |delta_J_k| / omega\n        if omega > 0:\n            mag_Q = np.abs(delta_J) / omega\n        else: # Avoid division by zero if frequency is 0\n            mag_Q = np.inf * np.abs(delta_J) if np.any(delta_J != 0) else np.zeros_like(delta_J)\n\n        \n        # Calculate max and sum of charge magnitudes\n        if mag_Q.size > 0:\n            Q_max = np.max(mag_Q)\n            Q_sum = np.sum(mag_Q)\n        else: # Handle cases with N<=1 which results in empty mag_Q\n            Q_max = 0.0\n            Q_sum = 0.0\n        \n        # Append this case's results\n        results.append([S_2, S_2_h, Q_max, Q_sum])\n\n    # Format the final output string as specified.\n    # e.g., [[rA1,rA2,rA3,rA4],[rB1,rB2,rB3,rB4],...]\n    case_results_str = [f\"[{r[0]},{r[1]},{r[2]},{r[3]}]\" for r in results]\n    final_output = f\"[{','.join(case_results_str)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "3351553"}, {"introduction": "Despite their limitations, pulse basis functions are a cornerstone of robust numerical methods, particularly for discretizing conservation laws. This final exercise demonstrates their power in the context of the charge continuity equation, forming the basis of many finite-volume time-domain (FDTD) and finite-volume (FV) schemes [@problem_id:3351563]. You will derive a charge-conserving update scheme by applying the divergence theorem to a cell, showing how the piecewise-constant nature of pulses naturally leads to a focus on fluxes across cell faces.", "problem": "Consider the charge continuity equation from Maxwellâ€™s equations, $\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot \\mathbf{J} = 0$, where $\\rho$ is the charge density and $\\mathbf{J}$ is the current density. In a finite-volume discretization aligned with a sub-domain (cell-wise) pulse basis, approximate $\\mathbf{J}$ as piecewise constant within each cell over a time step, and define the discrete divergence via face-normal fluxes.\n\nDerive, starting from the integral form of the continuity equation and using the divergence theorem, an expression for the discrete divergence operator that maps face-normal current flux densities to the cell-wise divergence. Show how interface fluxes between adjacent cells must be treated to preserve conservation, and obtain the fully discrete charge update that is consistent with the continuity equation over one time step.\n\nThen, apply your derivation to the following three-dimensional configuration. Two hexahedral cells are arranged adjacent along the $x$-axis. Each cell has dimensions $\\Delta x = 0.2~\\mathrm{m}$, $\\Delta y = 0.1~\\mathrm{m}$, and $\\Delta z = 0.05~\\mathrm{m}$. Thus, each cell has volume $V_c = 0.2 \\times 0.1 \\times 0.05~\\mathrm{m}^3$, and face areas $A_x = 0.1 \\times 0.05~\\mathrm{m}^2$, $A_y = 0.2 \\times 0.05~\\mathrm{m}^2$, and $A_z = 0.2 \\times 0.1~\\mathrm{m}^2$. Use a time step $\\Delta t = 2.5 \\times 10^{-9}~\\mathrm{s}$. All face-normal current flux densities are given at the temporal midpoint $t^{n+\\frac{1}{2}}$ and are defined as $J_n = \\mathbf{J} \\cdot \\mathbf{n}$ with respect to the outward unit normal $\\mathbf{n}$ of the cell under consideration.\n\nFor cell $1$ (the left cell), the outward face-normal current flux densities are:\n- Left $x-$ face: $J_n = -12~\\mathrm{A~m}^{-2}$,\n- Right $x+$ face (interface with cell $2$): use a single shared interface flux density $J_{n,\\Gamma} = +20~\\mathrm{A~m}^{-2}$ defined with respect to the outward normal of cell $1$,\n- Bottom $y-$ face: $J_n = +5~\\mathrm{A~m}^{-2}$,\n- Top $y+$ face: $J_n = -7~\\mathrm{A~m}^{-2}$,\n- Back $z-$ face: $J_n = +2~\\mathrm{A~m}^{-2}$,\n- Front $z+$ face: $J_n = -2.5~\\mathrm{A~m}^{-2}$.\n\nFor cell $2$ (the right cell), treat the interface flux on its left $x-$ face with the same single shared interface flux magnitude but opposite sign relative to its own outward normal (i.e., $J_n = -20~\\mathrm{A~m}^{-2}$ on its left face). The remaining outward face-normal current flux densities are:\n- Right $x+$ face: $J_n = -8~\\mathrm{A~m}^{-2}$,\n- Bottom $y-$ face: $J_n = -4~\\mathrm{A~m}^{-2}$,\n- Top $y+$ face: $J_n = +6~\\mathrm{A~m}^{-2}$,\n- Back $z-$ face: $J_n = -1~\\mathrm{A~m}^{-2}$,\n- Front $z+$ face: $J_n = +2~\\mathrm{A~m}^{-2}$.\n\nThe initial total charges in the two cells at time $t^n$ are $Q_1^n = 3.0 \\times 10^{-9}~\\mathrm{C}$ and $Q_2^n = -1.5 \\times 10^{-9}~\\mathrm{C}$, respectively. Using your derived discrete divergence and charge update, compute the updated cell-wise total charges $Q_1^{n+1}$ and $Q_2^{n+1}$ at time $t^{n+1}$.\n\nExpress your final answer as a row vector $\\big[ Q_1^{n+1},\\; Q_2^{n+1} \\big]$ in nanocoulombs, and round each entry to four significant figures.", "solution": "The problem requires the derivation of a discrete charge update scheme from the charge continuity equation and its application to a specific two-cell configuration. The validation of the problem statement confirms that it is scientifically sound, well-posed, and contains all necessary information.\n\nThe derivation begins with the integral form of the charge continuity equation over a control volume $V$,\n$$\n\\int_V \\frac{\\partial \\rho}{\\partial t} dV + \\int_V \\nabla \\cdot \\mathbf{J} dV = 0\n$$\nwhere $\\rho$ is the charge density and $\\mathbf{J}$ is the current density.\n\nApplying the divergence theorem, $\\int_V \\nabla \\cdot \\mathbf{J} dV = \\oint_S \\mathbf{J} \\cdot d\\mathbf{S}$, transforms the volume integral of the divergence into a surface integral of the flux over the boundary surface $S$ of the volume $V$. Here, $d\\mathbf{S} = \\mathbf{n} dS$ where $\\mathbf{n}$ is the outward-pointing unit normal vector. The continuity equation becomes:\n$$\n\\int_V \\frac{\\partial \\rho}{\\partial t} dV + \\oint_S \\mathbf{J} \\cdot \\mathbf{n} dS = 0\n$$\n\nWe now discretize this equation for a single computational cell, which is our control volume, denoted by $V_c$. The total charge inside the cell is $Q_c = \\int_{V_c} \\rho dV$. Assuming the volume $V_c$ is fixed in time, the first term becomes $\\frac{d}{dt} \\int_{V_c} \\rho dV = \\frac{dQ_c}{dt}$. The equation for a single cell is thus:\n$$\n\\frac{dQ_c}{dt} + \\oint_{S_c} \\mathbf{J} \\cdot \\mathbf{n} dS = 0\n$$\nwhere $S_c$ is the surface of the cell. This equation states that the rate of change of charge inside a cell is equal to the negative of the total current flowing out of its surface.\n\nThe problem specifies a sub-domain (cell-wise) pulse basis. This implies that quantities are approximated as piecewise constant within each cell. Specifically, the charge density $\\rho$ is constant within $V_c$, so $Q_c = \\rho V_c$. The current flux density $\\mathbf{J} \\cdot \\mathbf{n}$ is assumed to be constant over each face of the cell. A hexahedral cell has $N_f=6$ faces. Let the area of face $k$ be $A_k$ and the constant outward-normal current density on that face be $J_{n,k}$. The surface integral becomes a sum over the faces:\n$$\n\\oint_{S_c} \\mathbf{J} \\cdot \\mathbf{n} dS = \\sum_{k=1}^{N_f} \\int_{A_k} \\mathbf{J} \\cdot \\mathbf{n} dS = \\sum_{k=1}^{N_f} J_{n,k} A_k\n$$\nSubstituting this into the cell equation gives the semi-discrete form:\n$$\n\\frac{dQ_c}{dt} = - \\sum_{k=1}^{N_f} J_{n,k} A_k\n$$\n\nFrom this, we can identify the expression for the discrete divergence. The average divergence in the cell, $(\\nabla \\cdot \\mathbf{J})_c$, is defined such that $(\\nabla \\cdot \\mathbf{J})_c V_c = \\int_{V_c} \\nabla \\cdot \\mathbf{J} dV$. Using the divergence theorem, we have:\n$$\n(\\nabla \\cdot \\mathbf{J})_c = \\frac{1}{V_c} \\oint_{S_c} \\mathbf{J} \\cdot \\mathbf{n} dS = \\frac{1}{V_c} \\sum_{k=1}^{N_f} J_{n,k} A_k\n$$\nThis is the discrete divergence operator, which maps the face-normal flux densities $\\{J_{n,k}\\}$ to the cell-averaged divergence.\n\nFor charge conservation between adjacent cells (e.g., cell $i$ and cell $j$) sharing an interface face $\\Gamma$, the flux leaving cell $i$ through $\\Gamma$ must equal the flux entering cell $j$ through $\\Gamma$. Let $\\mathbf{n}_i$ be the outward normal for cell $i$ at $\\Gamma$. The outward normal for cell $j$ is $\\mathbf{n}_j = -\\mathbf{n}_i$. The flux out of cell $i$ is $I_i = \\int_\\Gamma (\\mathbf{J} \\cdot \\mathbf{n}_i) dS$. The flux out of cell $j$ is $I_j = \\int_\\Gamma (\\mathbf{J} \\cdot \\mathbf{n}_j) dS = -\\int_\\Gamma (\\mathbf{J} \\cdot \\mathbf{n}_i) dS = -I_i$. With the pulse basis, this requires that the shared interface flux density $J_{n,\\Gamma}$ for cell $i$ and $j$ must satisfy $J_{n,j} = -J_{n,i}$. The problem statement enforces this condition, ensuring local and global charge conservation.\n\nTo obtain the fully discrete charge update, we integrate the semi-discrete equation over a time step $\\Delta t = t^{n+1} - t^n$:\n$$\n\\int_{t^n}^{t^{n+1}} \\frac{dQ_c}{dt} dt = Q_c(t^{n+1}) - Q_c(t^n) = Q_c^{n+1} - Q_c^n\n$$\n$$\nQ_c^{n+1} - Q_c^n = - \\int_{t^n}^{t^{n+1}} \\left( \\sum_{k=1}^{N_f} J_{n,k}(t) A_k \\right) dt\n$$\nThe problem provides current flux densities at the temporal midpoint, $t^{n+\\frac{1}{2}}$. We use the second-order accurate midpoint rule to approximate the time integral:\n$$\n\\int_{t^n}^{t^{n+1}} J_{n,k}(t) dt \\approx J_{n,k}(t^{n+\\frac{1}{2}}) \\Delta t\n$$\nUsing the notation $J_{n,k}^{n+\\frac{1}{2}}$ for the midpoint flux densities, the final charge update equation is:\n$$\nQ_c^{n+1} = Q_c^n - \\Delta t \\sum_{k=1}^{N_f} J_{n,k}^{n+\\frac{1}{2}} A_k\n$$\nThis equation will be applied to the two cells.\n\nThe given parameters are:\n-   Time step: $\\Delta t = 2.5 \\times 10^{-9}$ s.\n-   Face areas: $A_x = 0.005$ m$^2$, $A_y = 0.01$ m$^2$, and $A_z = 0.02$ m$^2$.\n-   Initial charges: $Q_1^n = 3.0 \\times 10^{-9}$ C and $Q_2^n = -1.5 \\times 10^{-9}$ C.\n\nThe total outgoing current from a cell is $I_{out} = \\sum_{k=1}^{6} J_{n,k} A_k$.\n\nFor cell $1$:\nThe outward face-normal flux densities ($J_n$) are given for the left ($x-$), right ($x+$), bottom ($y-$), top ($y+$), back ($z-$), and front ($z+$) faces.\n$I_{out,1} = (J_{n,x-})A_x + (J_{n,x+})A_x + (J_{n,y-})A_y + (J_{n,y+})A_y + (J_{n,z-})A_z + (J_{n,z+})A_z$\nUsing the provided values for cell $1$:\n$I_{out,1} = (-12)A_x + (20)A_x + (5)A_y + (-7)A_y + (2)A_z + (-2.5)A_z$\n$I_{out,1} = (20 - 12)A_x + (5 - 7)A_y + (2 - 2.5)A_z$\n$I_{out,1} = (8)A_x - (2)A_y - (0.5)A_z$\n$I_{out,1} = (8)(0.005) - (2)(0.01) - (0.5)(0.02) = 0.04 - 0.02 - 0.01 = 0.01$ A.\n\nThe change in charge for cell $1$ is $\\Delta Q_1 = -I_{out,1} \\Delta t$:\n$\\Delta Q_1 = -(0.01 \\text{ A}) \\times (2.5 \\times 10^{-9} \\text{ s}) = -0.025 \\times 10^{-9}$ C.\nThe updated charge is $Q_1^{n+1} = Q_1^n + \\Delta Q_1$:\n$Q_1^{n+1} = 3.0 \\times 10^{-9} \\text{ C} - 0.025 \\times 10^{-9} \\text{ C} = 2.975 \\times 10^{-9}$ C.\n\nFor cell $2$:\nUsing the provided values for cell $2$:\n$I_{out,2} = (-20)A_x + (-8)A_x + (-4)A_y + (6)A_y + (-1)A_z + (2)A_z$\n$I_{out,2} = (-20 - 8)A_x + (6 - 4)A_y + (2 - 1)A_z$\n$I_{out,2} = (-28)A_x + (2)A_y + (1)A_z$\n$I_{out,2} = (-28)(0.005) + (2)(0.01) + (1)(0.02) = -0.14 + 0.02 + 0.02 = -0.10$ A.\n\nThe change in charge for cell $2$ is $\\Delta Q_2 = -I_{out,2} \\Delta t$:\n$\\Delta Q_2 = -(-0.10 \\text{ A}) \\times (2.5 \\times 10^{-9} \\text{ s}) = 0.25 \\times 10^{-9}$ C.\nThe updated charge is $Q_2^{n+1} = Q_2^n + \\Delta Q_2$:\n$Q_2^{n+1} = -1.5 \\times 10^{-9} \\text{ C} + 0.25 \\times 10^{-9} \\text{ C} = -1.25 \\times 10^{-9}$ C.\n\nThe final charges are $Q_1^{n+1} = 2.975 \\times 10^{-9}$ C and $Q_2^{n+1} = -1.25 \\times 10^{-9}$ C.\nIn nanocoulombs (nC), these are $Q_1^{n+1} = 2.975$ nC and $Q_2^{n+1} = -1.25$ nC.\nRounding to four significant figures, we get $2.975$ and $-1.250$.\nThe final answer is presented as a row vector $[Q_1^{n+1}, Q_2^{n+1}]$ in nanocoulombs.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2.975 & -1.250\n\\end{pmatrix}\n}\n$$", "id": "3351563"}]}