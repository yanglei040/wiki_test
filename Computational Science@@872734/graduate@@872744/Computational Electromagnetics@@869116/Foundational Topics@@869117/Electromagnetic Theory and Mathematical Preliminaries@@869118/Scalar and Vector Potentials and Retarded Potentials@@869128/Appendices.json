{"hands_on_practices": [{"introduction": "The connection between time-varying sources and the fields they produce is the essence of electrodynamics. This exercise provides a foundational, analytical workout in calculating the retarded scalar potential, $V$, directly from a specified current distribution. To solve this problem [@problem_id:73675], one must first apply the continuity equation, $\\nabla \\cdot \\mathbf{J} + \\frac{\\partial \\rho}{\\partial t} = 0$, to find the charge density $\\rho$ that is consistent with the given current $\\mathbf{J}$. This practice reinforces the fundamental principle that charge conservation is intrinsically linked to the generation of scalar and vector potentials.", "problem": "An infinitely long, thin, straight wire is aligned with the $z$-axis. It carries a traveling-wave current given by $I(z, t) = I_0 \\cos(kz - \\omega t)$, where $I_0$, $k$, and $\\omega$ are positive constants. The current constitutes a sinusoidal pattern of charge moving along the wire.\n\nThe phase velocity of this wave is $v_p = \\omega/k$. We consider the case where the wave propagates slower than the speed of light in vacuum, $c$. This condition is expressed by setting $k = \\alpha (\\omega/c)$ for a given dimensionless constant $\\alpha > 1$.\n\nIn the Lorenz gauge, the scalar potential $V$ and vector potential $\\mathbf{A}$ are given by the retarded potential formulae. The time-varying current induces a time-varying charge density on the wire to ensure charge conservation, as described by the continuity equation $\\nabla \\cdot \\mathbf{J} + \\partial \\rho / \\partial t = 0$.\n\nThe resulting scalar potential in cylindrical coordinates $(\\rho, \\phi, z)$ takes the form $V(\\rho, z, t) = V_{\\text{amp}}(\\rho) \\cos(kz - \\omega t)$. Determine the expression for the amplitude of the scalar potential, $V_{\\text{amp}}(\\rho)$. Your answer should be expressed in terms of $I_0$, $\\omega$, $\\rho$, $\\alpha$, $c$, and the permeability of free space $\\mu_0$.", "solution": "1. Continuity equation:\n   ∂λ/∂t+∂I/∂z=0,  I(z,t)=I₀cos(kz−ωt)\n   ⇒ ∂λ/∂t=−∂I/∂z= kI₀ sin(kz−ωt)\n   ⇒ λ(z,t)= −(kI₀/ω)cos(kz−ωt). \n   Thus λ_amp=−kI₀/ω.\n\n2. Lorenz‐gauge wave equation:\n   (∇²−(1/c²)∂²/∂t²)V=−ρ/ε₀,  ρ=λ(z,t)δ(x)δ(y).\n   Seek V=V_amp(ρ)cos(kz−ωt). Then\n   ∂²_zV→−k²V,  ∂²_tV→−ω²V,  so\n   (∇⊥²−γ²)V_amp(ρ)cos... = −λ_ampδ(x)δ(y)cos.../ε₀,\n   where γ²=k²−ω²/c²>0.\n\n3. 2D modified‐Helmholtz equation:\n   (∇⊥²−γ²)G(ρ)=−δ(x)δ(y)  ⇒  G(ρ)=−(1/2π)K₀(γρ).\n   Hence\n   V_amp(ρ)=(λ_amp/ε₀)G(ρ)= −(λ_amp/(2πε₀))\\,K₀(γρ).\n\n4. Substitute λ_amp=−kI₀/ω ⇒ −λ_amp= kI₀/ω. Also ε₀=1/(μ₀c²), \n   k=αω/c,  γ=(ω/c)√(α²−1). Then\n   V_amp(ρ)\n   = (kI₀/(ω))·(μ₀c²/(2π))·K₀(γρ)\n   = (μ₀c²·k·I₀)/(2πω) K₀((ωρ/c)√(α²−1))\n   = (μ₀c²·αω/c·I₀)/(2πω) K₀(...)\n   = (μ₀αcI₀)/(2π) K₀( (ωρ/c)√(α²−1) ).", "answer": "$$\\boxed{\\frac{\\mu_{0}\\,\\alpha\\,c\\,I_{0}}{2\\pi}\\;K_{0}\\!\\Bigl(\\frac{\\omega\\,\\rho}{c}\\sqrt{\\alpha^{2}-1}\\Bigr)}$$", "id": "73675"}, {"introduction": "Moving from continuous analytical models to discrete computational ones requires careful translation of physical laws. This computational practice [@problem_id:3346293] explores how the fundamental law of charge conservation is rigorously enforced in numerical simulations using the Method of Moments. You will work with Rao-Wilton-Glisson (RWG) basis functions, which are specifically designed to be \"divergence-conforming,\" ensuring that the discrete current on a mesh correctly maps to a discrete charge distribution. This exercise is a crucial first step in building robust computational tools for antenna and scattering analysis, bridging the gap between abstract potential theory and practical implementation.", "problem": "Consider time-harmonic electromagnetic fields with angular frequency $\\omega$ in free space. Start from Maxwell's equations in differential form for time-harmonic fields with complex phasors $e^{j \\omega t}$: $$\\nabla \\times \\mathbf{H} = \\mathbf{J} + j \\omega \\mathbf{D}, \\quad \\nabla \\times \\mathbf{E} = - j \\omega \\mathbf{B}, \\quad \\nabla \\cdot \\mathbf{D} = \\rho, \\quad \\nabla \\cdot \\mathbf{B} = 0,$$ with constitutive relations $\\mathbf{D} = \\varepsilon \\mathbf{E}$ and $\\mathbf{B} = \\mu \\mathbf{H}$, where $\\varepsilon$ is the permittivity, $\\mu$ is the permeability, $\\mathbf{J}$ is the current density, and $\\rho$ is the charge density. The fundamental conservation law is the continuity equation $$\\nabla \\cdot \\mathbf{J} + j \\omega \\rho = 0.$$\n\nDefine the magnetic vector potential $\\mathbf{A}$ and the electric scalar potential $\\phi$ through the retarded potentials for sources in free space: $$\\mathbf{A}(\\mathbf{x}) = \\mu \\int_S \\mathbf{J}(\\mathbf{y}) \\frac{e^{-j k \\|\\mathbf{x}-\\mathbf{y}\\|}}{4 \\pi \\|\\mathbf{x}-\\mathbf{y}\\|} \\, \\mathrm{d}S_{\\mathbf{y}}, \\quad \\phi(\\mathbf{x}) = \\frac{1}{\\varepsilon} \\int_S \\rho(\\mathbf{y}) \\frac{e^{-j k \\|\\mathbf{x}-\\mathbf{y}\\|}}{4 \\pi \\|\\mathbf{x}-\\mathbf{y}\\|} \\, \\mathrm{d}S_{\\mathbf{y}},$$ where $k = \\omega \\sqrt{\\mu \\varepsilon}$ is the free-space wavenumber, and the integrals are taken over the source surface $S$. In computational electromagnetics, one must discretize $\\mathbf{J}$ and $\\rho$ in a manner that enforces a discrete analogue of the continuity equation. A standard choice on triangulated surfaces is the Rao-Wilton-Glisson (RWG) basis, which is divergence-conforming and ensures that the discrete divergence maps consistently onto piecewise-constant charge densities.\n\nOn a triangulated planar surface, the lowest-order RWG basis function associated with an interior edge of length $\\ell_e$ shared by two triangles $T^+$ and $T^-$ with areas $A^+$ and $A^-$ and opposite vertices $\\mathbf{r}_\\text{op}^+$ and $\\mathbf{r}_\\text{op}^-$ is defined by $$\\mathbf{f}_e(\\mathbf{r}) = \\begin{cases} \\dfrac{\\ell_e}{2 A^+} \\left(\\mathbf{r} - \\mathbf{r}_\\text{op}^+\\right), & \\mathbf{r} \\in T^+, \\\\ \\dfrac{\\ell_e}{2 A^-} \\left(\\mathbf{r}_\\text{op}^- - \\mathbf{r}\\right), & \\mathbf{r} \\in T^-, \\\\ 0, & \\text{otherwise}, \\end{cases}$$ whose surface divergence is piecewise constant: $$\\nabla_s \\cdot \\mathbf{f}_e = \\begin{cases} + \\dfrac{\\ell_e}{A^+}, & \\mathbf{r} \\in T^+, \\\\ - \\dfrac{\\ell_e}{A^-}, & \\mathbf{r} \\in T^-. \\end{cases}$$ If the current density is discretized as $\\mathbf{J}_h = i_e \\mathbf{f}_e$ for some complex amplitude $i_e$ (in amperes), then a consistent discrete divergence operator $D$ mapping the edge coefficient $i_e$ to piecewise-constant charges on $T^+$ and $T^-$ is $$D \\, i_e = \\begin{bmatrix} \\dfrac{\\ell_e}{A^+} \\\\ - \\dfrac{\\ell_e}{A^-} \\end{bmatrix} i_e.$$ The discrete continuity equation then reads $$D \\, i_e + j \\omega \\boldsymbol{\\rho}_h = \\mathbf{0},$$ where $\\boldsymbol{\\rho}_h \\in \\mathbb{C}^2$ are the piecewise-constant surface charge densities on $T^+$ and $T^-$. Solving for $\\boldsymbol{\\rho}_h$ yields $$\\boldsymbol{\\rho}_h = - \\dfrac{1}{j \\omega} D \\, i_e.$$\n\nTask: Construct the divergence-conforming RWG basis on simple triangle pairs, assemble the discrete divergence operator $D$, compute the charge densities $\\boldsymbol{\\rho}_h$ via the discrete continuity equation, and verify numerically that the residual $\\|D \\, i_e + j \\omega \\boldsymbol{\\rho}_h\\|_2$ is below a prescribed tolerance. Additionally, compute the retarded magnetic vector potential $\\mathbf{A}(\\mathbf{x})$ and scalar potential $\\phi(\\mathbf{x})$ at given observation points using centroid-based quadrature to demonstrate a complete potential-based discretization, though the verification criterion is solely the discrete continuity residual.\n\nUse free-space parameters $\\mu = \\mu_0 = 4 \\pi \\times 10^{-7} \\ \\mathrm{H/m}$ and $\\varepsilon = \\varepsilon_0 = 8.854187817 \\times 10^{-12} \\ \\mathrm{F/m}$. All geometric lengths are in meters, currents in amperes, charges in coulombs per square meter, and potentials in weber per meter for $\\mathbf{A}$ and volts for $\\phi$. Angles, if any, are in radians. Implement the following test suite:\n\n- Test case $1$ (happy path): Triangulated unit square split by the interior edge between $(1,0)$ and $(0,1)$ forming triangles $T^+ = \\{(0,0),(1,0),(0,1)\\}$ and $T^- = \\{(1,1),(0,1),(1,0)\\}$, with $i_e = 1.0 \\ \\mathrm{A}$ and $\\omega = 2 \\pi \\cdot 100 \\times 10^{6} \\ \\mathrm{rad/s}$. Use observation points $\\mathbf{x}_1 = (0.50, 0.50, 0.25)$, $\\mathbf{x}_2 = (0.25, 0.25, 0.25)$, and $\\mathbf{x}_3 = (0.75, 0.25, 0.25)$ in meters for computing $\\mathbf{A}$ and $\\phi$ via centroid quadrature.\n- Test case $2$ (low-frequency edge case): Same geometry and observation points, with $i_e = 0.5 \\ \\mathrm{A}$ and $\\omega = 2 \\pi \\cdot 1 \\times 10^{3} \\ \\mathrm{rad/s}$.\n- Test case $3$ (geometric variation): Rectangle $\\{(0,0),(2,0),(0,1),(2,1)\\}$ split by the interior edge between $(2,0)$ and $(0,1)$ forming triangles $T^+ = \\{(0,0),(2,0),(0,1)\\}$ and $T^- = \\{(2,1),(0,1),(2,0)\\}$, with $i_e = 2.0 \\ \\mathrm{A}$ and $\\omega = 2 \\pi \\cdot 1 \\times 10^{6} \\ \\mathrm{rad/s}$. Use observation points $\\mathbf{x}_1 = (1.00, 0.50, 0.25)$, $\\mathbf{x}_2 = (0.50, 0.25, 0.25)$, and $\\mathbf{x}_3 = (1.50, 0.25, 0.25)$ in meters.\n\nFor each test case, compute the discrete residual $$r = \\left\\| D \\, i_e + j \\omega \\boldsymbol{\\rho}_h \\right\\|_2,$$ and report a boolean indicating whether $r < 10^{-12}$ (unitless threshold applied to the $2$-norm of the complex residual vector). Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $\\texttt{[result1,result2,result3]}$).", "solution": "The user has provided a problem in computational electromagnetics that requires validating the discrete continuity equation for Rao-Wilton-Glisson (RWG) basis functions and subsequently computing the retarded electromagnetic potentials. The problem is to be solved for three distinct test cases.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\nThe problem provides the following information:\n- **Governing Equations**: Time-harmonic Maxwell's equations and the continuity equation.\n$$\n\\begin{align*}\n\\nabla \\times \\mathbf{H} &= \\mathbf{J} + j \\omega \\mathbf{D} \\\\\n\\nabla \\times \\mathbf{E} &= - j \\omega \\mathbf{B} \\\\\n\\nabla \\cdot \\mathbf{D} &= \\rho \\\\\n\\nabla \\cdot \\mathbf{B} &= 0 \\\\\n\\nabla \\cdot \\mathbf{J} + j \\omega \\rho &= 0\n\\end{align*}\n$$\n- **Constitutive Relations**: $\\mathbf{D} = \\varepsilon \\mathbf{E}$, $\\mathbf{B} = \\mu \\mathbf{H}$.\n- **Constants**: Permeability of free space $\\mu = \\mu_0 = 4 \\pi \\times 10^{-7} \\ \\mathrm{H/m}$, Permittivity of free space $\\varepsilon = \\varepsilon_0 = 8.854187817 \\times 10^{-12} \\ \\mathrm{F/m}$.\n- **Retarded Potentials**:\n$$\n\\mathbf{A}(\\mathbf{x}) = \\mu \\int_S \\mathbf{J}(\\mathbf{y}) \\frac{e^{-j k \\|\\mathbf{x}-\\mathbf{y}\\|}}{4 \\pi \\|\\mathbf{x}-\\mathbf{y}\\|} \\, \\mathrm{d}S_{\\mathbf{y}}\n$$\n$$\n\\phi(\\mathbf{x}) = \\frac{1}{\\varepsilon} \\int_S \\rho(\\mathbf{y}) \\frac{e^{-j k \\|\\mathbf{x}-\\mathbf{y}\\|}}{4 \\pi \\|\\mathbf{x}-\\mathbf{y}\\|} \\, \\mathrm{d}S_{\\mathbf{y}}\n$$\nwhere $k = \\omega \\sqrt{\\mu \\varepsilon}$.\n- **RWG Basis Function**: For an interior edge of length $\\ell_e$ between triangles $T^+$ and $T^-$, with areas $A^+$, $A^-$ and opposite vertices $\\mathbf{r}_\\text{op}^+$, $\\mathbf{r}_\\text{op}^-$.\n$$\n\\mathbf{f}_e(\\mathbf{r}) = \\begin{cases} \\dfrac{\\ell_e}{2 A^+} \\left(\\mathbf{r} - \\mathbf{r}_\\text{op}^+\\right), & \\mathbf{r} \\in T^+, \\\\ \\dfrac{\\ell_e}{2 A^-} \\left(\\mathbf{r}_\\text{op}^- - \\mathbf{r}\\right), & \\mathbf{r} \\in T^-, \\\\ 0, & \\text{otherwise}. \\end{cases}\n$$\n- **RWG Surface Divergence**:\n$$\n\\nabla_s \\cdot \\mathbf{f}_e = \\begin{cases} + \\dfrac{\\ell_e}{A^+}, & \\mathbf{r} \\in T^+, \\\\ - \\dfrac{\\ell_e}{A^-}, & \\mathbf{r} \\in T^-. \\end{cases}\n$$\n- **Discrete Divergence Operator**: $D \\, i_e = \\begin{bmatrix} \\ell_e / A^+ \\\\ -\\ell_e / A^- \\end{bmatrix} i_e$.\n- **Discrete Continuity Equation**: $D \\, i_e + j \\omega \\boldsymbol{\\rho}_h = \\mathbf{0}$, where $\\boldsymbol{\\rho}_h$ is the vector of piecewise-constant surface charge densities on $T^+$ and $T^-$.\n- **Solution for Charge Density**: $\\boldsymbol{\\rho}_h = - \\dfrac{1}{j \\omega} D \\, i_e$.\n- **Verification Task**: Compute the residual $r = \\| D \\, i_e + j \\omega \\boldsymbol{\\rho}_h \\|_2$ and check if $r < 10^{-12}$.\n- **Potential Calculation Task**: Compute $\\mathbf{A}(\\mathbf{x})$ and $\\phi(\\mathbf{x})$ using centroid-based quadrature.\n- **Test Case 1**:\n    -   Geometry: $T^+ = \\{(0,0),(1,0),(0,1)\\}$, $T^- = \\{(1,1),(0,1),(1,0)\\}$.\n    -   Current amplitude: $i_e = 1.0 \\ \\mathrm{A}$.\n    -   Angular frequency: $\\omega = 2 \\pi \\cdot 100 \\times 10^{6} \\ \\mathrm{rad/s}$.\n    -   Observation points: $\\mathbf{x}_1 = (0.50, 0.50, 0.25)$, $\\mathbf{x}_2 = (0.25, 0.25, 0.25)$, $\\mathbf{x}_3 = (0.75, 0.25, 0.25)$.\n- **Test Case 2**:\n    -   Geometry: Same as case 1.\n    -   Current amplitude: $i_e = 0.5 \\ \\mathrm{A}$.\n    -   Angular frequency: $\\omega = 2 \\pi \\cdot 1 \\times 10^{3} \\ \\mathrm{rad/s}$.\n    -   Observation points: Same as case 1.\n- **Test Case 3**:\n    -   Geometry: $T^+ = \\{(0,0),(2,0),(0,1)\\}$, $T^- = \\{(2,1),(0,1),(2,0)\\}$.\n    -   Current amplitude: $i_e = 2.0 \\ \\mathrm{A}$.\n    -   Angular frequency: $\\omega = 2 \\pi \\cdot 1 \\times 10^{6} \\ \\mathrm{rad/s}$.\n    -   Observation points: $\\mathbf{x}_1 = (1.00, 0.50, 0.25)$, $\\mathbf{x}_2 = (0.50, 0.25, 0.25)$, $\\mathbf{x}_3 = (1.50, 0.25, 0.25)$.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem is reviewed against the validation criteria:\n1.  **Scientific or Factual Unsoundness**: The problem is based on the standard Maxwell's equations and their application in computational electromagnetics using the Method of Moments with RWG basis functions. The equations for the basis function, its divergence, the discrete continuity equation, and retarded potentials are all standard and correct. There are no scientific flaws.\n2.  **Non-Formalizable or Irrelevant**: The problem is a well-defined computational task directly relevant to the topic of scalar and vector potentials in electromagnetics.\n3.  **Incomplete or Contradictory Setup**: All necessary parameters, including geometries, physical constants, current amplitudes, and frequencies, are explicitly provided for each test case. The procedure for numerical integration (centroid quadrature) is also specified. There are no contradictions.\n4.  **Unrealistic or Infeasible**: The geometric dimensions and physical parameters are realistic for engineering applications (e.g., radio-frequency devices).\n5.  **Ill-Posed or Poorly Structured**: The primary task is to verify an algebraic identity. By defining $\\boldsymbol{\\rho}_h = - \\frac{1}{j \\omega} D i_e$, the residual $D i_e + j \\omega \\boldsymbol{\\rho}_h$ becomes $D i_e + j \\omega (-\\frac{1}{j \\omega} D i_e) = D i_e - D i_e = \\mathbf{0}$. Analytically, the solution is exact. The numerical task is to implement this and show that the residual is zero up to machine precision, which is a well-posed verification task. The potential calculations are also based on well-defined integrals.\n6.  **Pseudo-Profound, Trivial, or Tautological**: While the verification of the continuity equation is algebraically trivial, its numerical implementation requires correct geometric calculations (areas, lengths), assembly of the discrete operator, and correct handling of complex arithmetic. This serves as a valid, non-trivial programming exercise to confirm understanding of the underlying discretization principles.\n7.  **Outside Scientific Verifiability**: The problem is a computational task whose results are entirely verifiable by calculation.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. It is a well-posed, scientifically sound exercise in computational electromagnetics. I will proceed with a full solution.\n\n### Algorithmic Solution\n\nThe solution procedure for each test case involves the following steps:\n1.  **Geometric Analysis**: From the vertices defining the two triangles, $T^+$ and $T^-$, we identify the shared edge and the two opposite vertices, $\\mathbf{r}_{\\text{op}}^+$ and $\\mathbf{r}_{\\text{op}}^-$. We then compute the length of the shared edge, $\\ell_e$, and the areas of the two triangles, $A^+$ and $A^-$. The area of a triangle defined by vertices $\\mathbf{v}_1, \\mathbf{v}_2, \\mathbf{v}_3$ is given by $A = \\frac{1}{2} \\| (\\mathbf{v}_2 - \\mathbf{v}_1) \\times (\\mathbf{v}_3 - \\mathbf{v}_1) \\|$.\n\n2.  **Discrete Operator Assembly**: The discrete divergence operator $D$, which maps the current coefficient $i_e$ on the shared edge to the resulting charges on the triangles, is formed as a $2 \\times 1$ matrix (or a 2-element column vector):\n    $$\n    D = \\begin{bmatrix} \\ell_e / A^+ \\\\ -\\ell_e / A^- \\end{bmatrix}\n    $$\n\n3.  **Charge Density Calculation**: Given the current coefficient $i_e$ and angular frequency $\\omega$, the vector of piecewise-constant charge densities $\\boldsymbol{\\rho}_h = [\\rho^+, \\rho^-]^T$ is computed from the discrete continuity equation, $D i_e + j \\omega \\boldsymbol{\\rho}_h = \\mathbf{0}$. This yields:\n    $$\n    \\boldsymbol{\\rho}_h = -\\frac{1}{j\\omega} D i_e = \\frac{j}{\\omega} D i_e = \\frac{j i_e}{\\omega} \\begin{bmatrix} \\ell_e / A^+ \\\\ -\\ell_e / A^- \\end{bmatrix}\n    $$\n    Here, $j = \\sqrt{-1}$ is the imaginary unit.\n\n4.  **Residual Verification**: We compute the residual vector $\\mathbf{res} = D i_e + j \\omega \\boldsymbol{\\rho}_h$. Substituting the expression for $\\boldsymbol{\\rho}_h$ from the previous step, we expect this vector to be numerically close to the zero vector. We calculate its Euclidean norm (2-norm), $r = \\| \\mathbf{res} \\|_2$, and verify if it is below the specified tolerance of $10^{-12}$.\n\n5.  **Potential Calculation**: To complete the demonstration, we compute the magnetic vector potential $\\mathbf{A}(\\mathbf{x})$ and electric scalar potential $\\phi(\\mathbf{x})$ at specified observation points $\\mathbf{x}$. The problem prescribes centroid-based quadrature.\n    -   First, we determine the centroids of the triangles: $\\mathbf{r}_c^+ = \\frac{1}{3}\\sum_{i=1}^3 \\mathbf{v}_i^+$ and $\\mathbf{r}_c^- = \\frac{1}{3}\\sum_{i=1}^3 \\mathbf{v}_i^-$.\n    -   The magnetic vector potential $\\mathbf{A}(\\mathbf{x})$ is approximated by:\n        $$\n        \\mathbf{A}(\\mathbf{x}) \\approx \\mu_0 i_e \\left[ \\mathbf{f}_e(\\mathbf{r}_c^+) A^+ \\frac{e^{-j k \\|\\mathbf{x}-\\mathbf{r}_c^+\\|}}{4 \\pi \\|\\mathbf{x}-\\mathbf{r}_c^+\\|} + \\mathbf{f}_e(\\mathbf{r}_c^-) A^- \\frac{e^{-j k \\|\\mathbf{x}-\\mathbf{r}_c^-\\|}}{4 \\pi \\|\\mathbf{x}-\\mathbf{r}_c^-\\|} \\right]\n        $$\n        where $\\mathbf{f}_e$ is evaluated at the respective centroids. This simplifies to:\n        $$\n        \\mathbf{A}(\\mathbf{x}) \\approx \\frac{\\mu_0 i_e \\ell_e}{8 \\pi} \\left[ (\\mathbf{r}_c^+ - \\mathbf{r}_\\text{op}^+) \\frac{e^{-j k \\|\\mathbf{x}-\\mathbf{r}_c^+\\|}}{\\|\\mathbf{x}-\\mathbf{r}_c^+\\|} + (\\mathbf{r}_\\text{op}^- - \\mathbf{r}_c^-) \\frac{e^{-j k \\|\\mathbf{x}-\\mathbf{r}_c^-\\|}}{\\|\\mathbf{x}-\\mathbf{r}_c^-\\|} \\right]\n        $$\n        The wavenumber is $k = \\omega \\sqrt{\\mu_0 \\varepsilon_0}$.\n    -   The electric scalar potential $\\phi(\\mathbf{x})$ is approximated by:\n        $$\n        \\phi(\\mathbf{x}) \\approx \\frac{1}{\\varepsilon_0} \\left[ \\rho^+ A^+ \\frac{e^{-j k \\|\\mathbf{x}-\\mathbf{r}_c^+\\|}}{4 \\pi \\|\\mathbf{x}-\\mathbf{r}_c^+\\|} + \\rho^- A^- \\frac{e^{-j k \\|\\mathbf{x}-\\mathbf{r}_c^-\\|}}{4 \\pi \\|\\mathbf{x}-\\mathbf{r}_c^-\\|} \\right]\n        $$\n        using the components $\\rho^+$ and $\\rho^-$ of the vector $\\boldsymbol{\\rho}_h$ computed in step 3.\n\nThis procedure will be applied to each of the three test cases provided. The final output is a boolean list indicating whether the residual check passed for each case. Given the analytical nature of the check, the result is expected to be `True` for all cases, provided the implementation is numerically sound.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the computational electromagnetics problem.\n    It processes three test cases, calculates geometric properties of triangle pairs,\n    verifies the discrete continuity equation for RWG basis functions, and\n    computes the retarded potentials as a demonstration.\n    \"\"\"\n    \n    # Constants\n    MU_0 = 4 * np.pi * 1e-7 # H/m\n    EPSILON_0 = 8.854187817e-12 # F/m\n    \n    test_cases = [\n        {\n            \"tri_plus_verts\": np.array([[0.0, 0.0, 0.0], [1.0, 0.0, 0.0], [0.0, 1.0, 0.0]]),\n            \"tri_minus_verts\": np.array([[1.0, 1.0, 0.0], [0.0, 1.0, 0.0], [1.0, 0.0, 0.0]]),\n            \"i_e\": 1.0 + 0.0j,\n            \"omega\": 2 * np.pi * 100e6,\n            \"obs_points\": np.array([[0.50, 0.50, 0.25], [0.25, 0.25, 0.25], [0.75, 0.25, 0.25]])\n        },\n        {\n            \"tri_plus_verts\": np.array([[0.0, 0.0, 0.0], [1.0, 0.0, 0.0], [0.0, 1.0, 0.0]]),\n            \"tri_minus_verts\": np.array([[1.0, 1.0, 0.0], [0.0, 1.0, 0.0], [1.0, 0.0, 0.0]]),\n            \"i_e\": 0.5 + 0.0j,\n            \"omega\": 2 * np.pi * 1e3,\n            \"obs_points\": np.array([[0.50, 0.50, 0.25], [0.25, 0.25, 0.25], [0.75, 0.25, 0.25]])\n        },\n        {\n            \"tri_plus_verts\": np.array([[0.0, 0.0, 0.0], [2.0, 0.0, 0.0], [0.0, 1.0, 0.0]]),\n            \"tri_minus_verts\": np.array([[2.0, 1.0, 0.0], [0.0, 1.0, 0.0], [2.0, 0.0, 0.0]]),\n            \"i_e\": 2.0 + 0.0j,\n            \"omega\": 2 * np.pi * 1e6,\n            \"obs_points\": np.array([[1.00, 0.50, 0.25], [0.50, 0.25, 0.25], [1.50, 0.25, 0.25]])\n        }\n    ]\n    \n    results = []\n\n    def get_triangle_properties(verts_plus, verts_minus):\n        \"\"\"Identifies shared edge, opposite vertices, and calculates areas.\"\"\"\n        set_plus = {tuple(v) for v in verts_plus}\n        set_minus = {tuple(v) for v in verts_minus}\n        \n        shared_verts_tuples = set_plus.intersection(set_minus)\n        shared_verts = [np.array(v) for v in shared_verts_tuples]\n        \n        v_op_plus_tuple = set_plus.difference(set_minus).pop()\n        v_op_plus = np.array(v_op_plus_tuple)\n        \n        v_op_minus_tuple = set_minus.difference(set_plus).pop()\n        v_op_minus = np.array(v_op_minus_tuple)\n\n        edge_vec = shared_verts[0] - shared_verts[1]\n        ell_e = np.linalg.norm(edge_vec)\n\n        area_plus = 0.5 * np.linalg.norm(np.cross(shared_verts[0] - v_op_plus, shared_verts[1] - v_op_plus))\n        area_minus = 0.5 * np.linalg.norm(np.cross(shared_verts[0] - v_op_minus, shared_verts[1] - v_op_minus))\n        \n        return v_op_plus, v_op_minus, ell_e, area_plus, area_minus\n\n    for case in test_cases:\n        # Step 1: Geometric Analysis\n        v_op_plus, v_op_minus, ell_e, A_plus, A_minus = get_triangle_properties(\n            case[\"tri_plus_verts\"], case[\"tri_minus_verts\"]\n        )\n\n        # Step 2: Discrete Operator Assembly\n        D_op = np.array([ell_e / A_plus, -ell_e / A_minus])\n\n        # Step 3: Charge Density Calculation\n        i_e = case[\"i_e\"]\n        omega = case[\"omega\"]\n        j = 1j\n        \n        rho_h = -(1 / (j * omega)) * D_op * i_e\n\n        # Step 4: Residual Verification\n        residual_vec = D_op * i_e + j * omega * rho_h\n        residual_norm = np.linalg.norm(residual_vec)\n        results.append(residual_norm < 1e-12)\n\n        # Step 5: Potential Calculation (for demonstration)\n        # This part is computed as requested but not part of the final output.\n        k = omega * np.sqrt(MU_0 * EPSILON_0)\n        \n        r_c_plus = np.mean(case[\"tri_plus_verts\"], axis=0)\n        r_c_minus = np.mean(case[\"tri_minus_verts\"], axis=0)\n        \n        rho_plus, rho_minus = rho_h\n        \n        A_values = []\n        phi_values = []\n        \n        for x in case[\"obs_points\"]:\n            # Distances from observation point to centroids\n            dist_plus = np.linalg.norm(x - r_c_plus)\n            dist_minus = np.linalg.norm(x - r_c_minus)\n\n            # Green's function, handling division by zero if x is on a centroid\n            G_plus = np.exp(-j * k * dist_plus) / (4 * np.pi * dist_plus) if dist_plus > 1e-9 else 0\n            G_minus = np.exp(-j * k * dist_minus) / (4 * np.pi * dist_minus) if dist_minus > 1e-9 else 0\n            \n            # Scalar potential\n            phi = (1 / EPSILON_0) * (rho_plus * A_plus * G_plus + rho_minus * A_minus * G_minus)\n            phi_values.append(phi)\n            \n            # Vector potential\n            A = (MU_0 * i_e * ell_e / (8 * np.pi)) * (\n                (r_c_plus - v_op_plus) * np.exp(-j * k * dist_plus) / dist_plus +\n                (v_op_minus - r_c_minus) * np.exp(-j * k * dist_minus) / dist_minus\n            )\n            A_values.append(A)\n\n    # Final print statement must be in this exact format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3346293"}, {"introduction": "The \"retarded\" aspect of potentials, which accounts for the finite speed of light, introduces unique challenges in the time domain. The retarded Green’s function contains a Dirac delta function, $\\delta(t - |\\mathbf{r}|/c)$, which concentrates the source's influence on an expanding \"light-cone.\" This hands-on problem [@problem_id:3346348] tasks you with taming this singularity for numerical integration over a curved surface. By approximating the delta function and comparing the numerical result to an exact analytical solution, you will gain practical experience in developing stable and accurate time-domain boundary element methods.", "problem": "Consider the scalar potential $\\,\\phi(\\mathbf{r},t)\\,$ in the Lorenz gauge, for which the scalar potential satisfies the inhomogeneous wave equation in free space driven by a surface source. The Boundary Element Method (BEM) reduces the field evaluation to a surface integral over a panelized boundary using the retarded Green’s function of the three-dimensional wave equation. In time-domain BEM, the kernel introduces a singular concentration on the light-cone: the contribution from a surface element at position $\\mathbf{r}'$ arrives at an observation point $\\mathbf{r}$ at time $t$ determined by the propagation at the speed of light (Speed of Light (c)). This leads to sampling challenges when integrating over curved panels because the Dirac delta function localizes the contribution to a thin ring on the panel where $|\\mathbf{r}-\\mathbf{r}'| = c\\,t$.\n\nStarting from the wave equation for the scalar potential and the definition of the retarded Green’s function in free space, implement a time-domain BEM quadrature that approximates the scalar potential $\\,\\phi(\\mathbf{r},t)\\,$ due to an impulsive unit surface source at time $\\,t=0\\,$ distributed uniformly over a sphere of radius $\\,a\\,$. Use a spherical panel representation with polar angle $\\theta\\in[0,\\pi]$ and azimuthal angle $\\phi\\in[0,2\\pi)$, both measured in radians. Assume the observation point is located on the $z$-axis at distance $\\,r_0$ from the origin, i.e., $\\mathbf{r}=(0,0,r_0)$. The sphere is parameterized as $\\mathbf{r}'(\\theta,\\phi) = a[\\sin\\theta\\cos\\phi,\\,\\sin\\theta\\sin\\phi,\\,\\cos\\theta]$, with surface element $\\,\\mathrm{d}A = a^2\\sin\\theta\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$. The scalar potential integral to evaluate numerically (with unit source density) is\n$$\n\\Phi(r_0,t) \\equiv \\iint_{S} \\frac{\\delta\\!\\left(t-\\frac{|\\mathbf{r}-\\mathbf{r}'|}{c}\\right)}{4\\pi\\,|\\mathbf{r}-\\mathbf{r}'|}\\,\\mathrm{d}A,\n$$\nwhere $\\,\\delta(\\cdot)\\,$ denotes the Dirac delta function. To enable numerical quadrature over a curved panel (the sphere), approximate the Dirac delta function by a normalized Gaussian mollifier of width $\\,\\sigma_t>0$:\n$$\n\\delta_{\\sigma_t}(x) \\equiv \\frac{1}{\\sqrt{2\\pi}\\,\\sigma_t}\\exp\\!\\left(-\\frac{x^2}{2\\sigma_t^2}\\right).\n$$\nYour program must:\n- Discretize the sphere by uniform angular sampling with $\\,N_\\theta\\,$ samples in the polar angle and $\\,N_\\phi\\,$ samples in the azimuthal angle, using midpoint quadrature in both angles; the surface weight is $\\,a^2\\sin\\theta\\,\\Delta\\theta\\,\\Delta\\phi\\,$ with $\\,\\Delta\\theta=\\pi/N_\\theta\\,$ and $\\,\\Delta\\phi=2\\pi/N_\\phi$.\n- Implement the retarded Green’s function kernel via the above mollified delta function, evaluating $\\,R(\\theta)\\equiv|\\mathbf{r}-\\mathbf{r}'|=\\sqrt{r_0^2+a^2-2ar_0\\cos\\theta}\\,$ and computing\n$$\n\\Phi_{\\mathrm{num}}(r_0,t;N_\\theta,N_\\phi,\\sigma_t) \\equiv \\sum_{i=1}^{N_\\theta}\\sum_{j=1}^{N_\\phi} \\frac{\\delta_{\\sigma_t}\\!\\left(t-\\frac{R(\\theta_i)}{c}\\right)}{4\\pi\\,R(\\theta_i)}\\,a^2\\sin\\theta_i\\,\\Delta\\theta\\,\\Delta\\phi.\n$$\n- Use $\\,c=299{,}792{,}458\\,\\mathrm{m/s}\\,$ and $\\,a=1\\,\\mathrm{m}\\,$.\n\nFor this geometry, there exists a closed-form reference solution for the integral that depends on the observation distance $\\,r_0\\,$ and the time window $\\,t\\in\\left[\\frac{|r_0-a|}{c},\\,\\frac{r_0+a}{c}\\right]$. In your analysis and code, derive and use this reference solution to compute the error of the numerical quadrature.\n\nDesign a test suite that probes different aspects of the light-cone singular quadrature on the curved sphere:\n- Vary $\\,r_0\\,$ to test both $\\,r_0<a\\,$ and $\\,r_0>a$.\n- Evaluate at times $\\,t\\,$ deep inside the window (“happy path”), and close to the lower and upper window boundaries (“near-boundary”), and outside the window (“edge case”).\n- Compare coarse and fine angular discretizations and different $\\,\\sigma_t$ values.\n\nUse the following test suite with specified parameters:\n- Test $\\,1$: $\\,r_0=0.5\\,\\mathrm{m}$, $\\,t=\\frac{|r_0-a|+(r_0+a)}{2c}$, $\\,N_\\theta=48$, $\\,N_\\phi=96$, $\\,\\sigma_t=1\\times 10^{-10}\\,\\mathrm{s}$.\n- Test $\\,2$: $\\,r_0=0.5\\,\\mathrm{m}$, $\\,t=\\frac{|r_0-a|}{c}+1\\times 10^{-11}\\,\\mathrm{s}$, $\\,N_\\theta=48$, $\\,N_\\phi=96$, $\\,\\sigma_t=1\\times 10^{-11}\\,\\mathrm{s}$.\n- Test $\\,3$: $\\,r_0=0.5\\,\\mathrm{m}$, $\\,t=\\frac{r_0+a}{c}-1\\times 10^{-11}\\,\\mathrm{s}$, $\\,N_\\theta=192$, $\\,N_\\phi=384$, $\\,\\sigma_t=5\\times 10^{-12}\\,\\mathrm{s}$.\n- Test $\\,4$: $\\,r_0=0.5\\,\\mathrm{m}$, $\\,t=\\frac{r_0+a}{c}+3\\times 10^{-11}\\,\\mathrm{s}$, $\\,N_\\theta=192$, $\\,N_\\phi=384$, $\\,\\sigma_t=1\\times 10^{-11}\\,\\mathrm{s}$.\n- Test $\\,5$: $\\,r_0=1.5\\,\\mathrm{m}$, $\\,t=\\frac{|r_0-a|+(r_0+a)}{2c}$, $\\,N_\\theta=48$, $\\,N_\\phi=96$, $\\,\\sigma_t=1\\times 10^{-10}\\,\\mathrm{s}$.\n- Test $\\,6$: $\\,r_0=1.5\\,\\mathrm{m}$, $\\,t=\\frac{|r_0-a|}{c}+1\\times 10^{-11}\\,\\mathrm{s}$, $\\,N_\\theta=48$, $\\,N_\\phi=96$, $\\,\\sigma_t=1\\times 10^{-11}\\,\\mathrm{s}$.\n- Test $\\,7$: $\\,r_0=1.5\\,\\mathrm{m}$, $\\,t=\\frac{r_0+a}{c}-1\\times 10^{-11}\\,\\mathrm{s}$, $\\,N_\\theta=192$, $\\,N_\\phi=384$, $\\,\\sigma_t=5\\times 10^{-12}\\,\\mathrm{s}$.\n- Test $\\,8$: $\\,r_0=1.5\\,\\mathrm{m}$, $\\,t=\\frac{r_0+a}{c}+3\\times 10^{-11}\\,\\mathrm{s}$, $\\,N_\\theta=192$, $\\,N_\\phi=384$, $\\,\\sigma_t=1\\times 10^{-11}\\,\\mathrm{s}$.\n\nFor tests where the time $\\,t\\,$ lies within the window $\\,\\left[\\frac{|r_0-a|}{c},\\frac{r_0+a}{c}\\right]$, compute the relative error $\\,\\varepsilon = \\frac{\\Phi_{\\mathrm{num}}-\\Phi_{\\mathrm{ref}}}{\\Phi_{\\mathrm{ref}}}\\,$ using the derived reference solution $\\,\\Phi_{\\mathrm{ref}}(r_0,t)\\,$. For tests where $\\,t\\,$ is outside the window, report the absolute numerical value $\\,\\Phi_{\\mathrm{num}}\\,$ (a float) to assess spurious leakage due to mollification and discretization.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered from Test $\\,1$ to Test $\\,8$, for example, $\\,\\big[\\varepsilon_1,\\varepsilon_2,\\varepsilon_3,\\Phi_{\\mathrm{num},4},\\varepsilon_5,\\varepsilon_6,\\varepsilon_7,\\Phi_{\\mathrm{num},8}\\big]$. No physical units need to be printed; all outputs must be dimensionless floats.", "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective. The problem describes a standard scenario in computational electromagnetics: the calculation of a retarded scalar potential from an impulsive surface source using the time-domain Boundary Element Method (BEM). The use of the retarded Green's function for the wave equation, its representation as an integral involving a Dirac delta function, and the subsequent approximation of the delta function with a Gaussian mollifier for numerical quadrature are all established techniques. The problem provides all necessary physical parameters ($c=299,792,458\\,\\mathrm{m/s}$, $a=1\\,\\mathrm{m}$), numerical parameters ($N_\\theta, N_\\phi, \\sigma_t$), and a clear geometric setup (a sphere of radius $a$ and an observer on the $z$-axis at $z=r_0$). The task requires the derivation of a closed-form analytical solution for this specific configuration, which serves as a benchmark for the numerical results. This comparison is a standard practice for verifying numerical codes. The problem is self-contained, unambiguous, and free from scientific flaws. Thus, it is deemed valid, and we proceed with the solution.\n\nThe solution is developed in two parts: first, the derivation of the analytical reference solution, and second, the design of the numerical algorithm to compute the approximate solution and its error.\n\n**1. Analytical Reference Solution**\n\nThe scalar potential $\\Phi(r_0,t)$ at an observation point $\\mathbf{r}=(0,0,r_0)$ due to an impulsive unit surface source on a sphere $S$ of radius $a$ is given by the integral:\n$$\n\\Phi(r_0,t) = \\iint_{S} \\frac{\\delta\\!\\left(t-\\frac{|\\mathbf{r}-\\mathbf{r}'|}{c}\\right)}{4\\pi\\,|\\mathbf{r}-\\mathbf{r}'|}\\,\\mathrm{d}A\n$$\nThe source point on the sphere is parameterized by $\\mathbf{r}'(\\theta,\\phi) = a(\\sin\\theta\\cos\\phi, \\sin\\theta\\sin\\phi, \\cos\\theta)$, with the surface element $\\mathrm{d}A = a^2\\sin\\theta\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$. The distance $R = |\\mathbf{r}-\\mathbf{r}'|$ between the observation point and a source point is calculated as:\n$$\nR(\\theta) = \\sqrt{(0 - a\\sin\\theta\\cos\\phi)^2 + (0 - a\\sin\\theta\\sin\\phi)^2 + (r_0 - a\\cos\\theta)^2} = \\sqrt{r_0^2+a^2-2ar_0\\cos\\theta}\n$$\nDue to the rotational symmetry about the $z$-axis, $R$ is a function of $\\theta$ only. The integrand is therefore independent of the azimuthal angle $\\phi$. The integration over $\\phi$ from $0$ to $2\\pi$ can be performed immediately, yielding a factor of $2\\pi$:\n$$\n\\Phi(r_0,t) = \\int_{0}^{\\pi} \\frac{\\delta(t - R(\\theta)/c)}{4\\pi R(\\theta)} a^2\\sin\\theta (2\\pi) \\mathrm{d}\\theta = \\frac{a^2}{2} \\int_{0}^{\\pi} \\frac{\\delta(t - R(\\theta)/c)}{R(\\theta)} \\sin\\theta \\mathrm{d}\\theta\n$$\nTo evaluate the remaining integral with the Dirac delta function, we perform a change of integration variable from $\\theta$ to $R$. From the expression for $R(\\theta)$, we have $R^2 = r_0^2+a^2-2ar_0\\cos\\theta$. Differentiating with respect to $\\theta$ gives:\n$$\n2R\\,\\frac{\\mathrm{d}R}{\\mathrm{d}\\theta} = 2ar_0\\sin\\theta \\implies \\sin\\theta\\,\\mathrm{d}\\theta = \\frac{R}{ar_0}\\,\\mathrm{d}R\n$$\nThe limits of integration for the new variable $R$ are determined by the values of $\\theta$ at its endpoints:\nWhen $\\theta=0$, $R(0) = \\sqrt{(r_0-a)^2} = |r_0-a|$.\nWhen $\\theta=\\pi$, $R(\\pi) = \\sqrt{(r_0+a)^2} = r_0+a$.\n\nSubstituting the change of variable into the integral for $\\Phi(r_0,t)$:\n$$\n\\Phi(r_0,t) = \\frac{a^2}{2} \\int_{|r_0-a|}^{r_0+a} \\frac{\\delta(t - R/c)}{R} \\left(\\frac{R}{ar_0}\\,\\mathrm{d}R\\right) = \\frac{a}{2r_0} \\int_{|r_0-a|}^{r_0+a} \\delta(t-R/c)\\,\\mathrm{d}R\n$$\nNow, let $u = R/c$, which implies $\\mathrm{d}R = c\\,\\mathrm{d}u$. The integration limits for $u$ become $\\frac{|r_0-a|}{c}$ and $\\frac{r_0+a}{c}$:\n$$\n\\Phi(r_0,t) = \\frac{a}{2r_0} \\int_{\\frac{|r_0-a|}{c}}^{\\frac{r_0+a}{c}} \\delta(t-u) (c\\,\\mathrm{d}u) = \\frac{ac}{2r_0} \\int_{\\frac{|r_0-a|}{c}}^{\\frac{r_0+a}{c}} \\delta(u-t)\\,\\mathrm{d}u\n$$\nThe sifting property of the Dirac delta function states that $\\int_A^B \\delta(x-x_0)\\,\\mathrm{d}x = 1$ if $x_0 \\in (A,B)$, and $0$ if $x_0 \\notin [A,B]$. This leads to the reference solution $\\Phi_{\\mathrm{ref}}$:\n$$\n\\Phi_{\\mathrm{ref}}(r_0,t) = \n\\begin{cases} \n\\frac{ac}{2r_0} & \\text{for } t \\in \\left[\\frac{|r_0-a|}{c}, \\frac{r_0+a}{c}\\right] \\\\\n0 & \\text{otherwise}\n\\end{cases}\n$$\nThis solution is valid for $r_0 > 0$. It indicates that the potential is constant during the time interval corresponding to the light-wave sweeping across the sphere as seen from the observation point.\n\n**2. Numerical Quadrature Algorithm**\n\nThe numerical approximation $\\Phi_{\\mathrm{num}}$ is given by the discrete sum:\n$$\n\\Phi_{\\mathrm{num}}(r_0,t;N_\\theta,N_\\phi,\\sigma_t) \\equiv \\sum_{i=1}^{N_\\theta}\\sum_{j=1}^{N_\\phi} \\frac{\\delta_{\\sigma_t}\\!\\left(t-\\frac{R(\\theta_i)}{c}\\right)}{4\\pi\\,R(\\theta_i)}\\,a^2\\sin\\theta_i\\,\\Delta\\theta\\,\\Delta\\phi\n$$\nwhere $\\delta_{\\sigma_t}(x)$ is the Gaussian mollifier $\\frac{1}{\\sqrt{2\\pi}\\,\\sigma_t}\\exp(-\\frac{x^2}{2\\sigma_t^2})$. The discretization uses a midpoint rule with $\\theta_i = (i-0.5)\\Delta\\theta$ for $i=1, \\dots, N_\\theta$, where $\\Delta\\theta = \\pi/N_\\theta$, and similarly for $\\phi_j$.\n\nAs the summand is independent of the azimuthal angle $\\phi$, the summation over the index $j$ can be simplified. The sum of the panel weights in the azimuthal direction is $\\sum_{j=1}^{N_\\phi} \\Delta\\phi = N_\\phi \\times (2\\pi/N_\\phi) = 2\\pi$. This simplifies the double summation to a single sum over $\\theta$:\n$$\n\\Phi_{\\mathrm{num}} = \\sum_{i=1}^{N_\\theta} \\frac{\\delta_{\\sigma_t}\\!\\left(t-\\frac{R(\\theta_i)}{c}\\right)}{4\\pi\\,R(\\theta_i)} a^2\\sin\\theta_i\\,\\Delta\\theta (2\\pi) = \\frac{a^2 \\Delta\\theta}{2} \\sum_{i=1}^{N_\\theta} \\frac{\\sin\\theta_i}{R(\\theta_i)} \\delta_{\\sigma_t}\\!\\left(t - \\frac{R(\\theta_i)}{c}\\right)\n$$\nThe implementation follows these steps:\n1.  For each test case with parameters $(r_0, t, N_\\theta, N_\\phi, \\sigma_t)$, the calculation begins.\n2.  The polar angle step size is $\\Delta\\theta = \\pi/N_\\theta$. An array of midpoint angles $\\theta_i$ is generated.\n3.  The corresponding distances $R_i = R(\\theta_i)$ and retarded time arguments $x_i = t - R_i/c$ are computed for all $\\theta_i$ values in a vectorized manner.\n4.  The Gaussian mollifier $\\delta_{\\sigma_t}(x_i)$ is evaluated for each $x_i$.\n5.  The sum over $i$ is computed according to the simplified numerical formula above to obtain $\\Phi_{\\mathrm{num}}$.\n6.  The analytical time window $[t_{\\min}, t_{\\max}] = [\\frac{|r_0-a|}{c}, \\frac{r_0+a}{c}]$ is determined.\n7.  If the evaluation time $t$ falls within this window, the reference solution is $\\Phi_{\\mathrm{ref}} = \\frac{ac}{2r_0}$, and the relative error $\\varepsilon = (\\Phi_{\\mathrm{num}}-\\Phi_{\\mathrm{ref}})/\\Phi_{\\mathrm{ref}}$ is calculated.\n8.  If $t$ is outside the window, the reference solution is $0$. As specified, the absolute value of the numerical potential, $\\Phi_{\\mathrm{num}}$, is reported. This value quantifies the numerical leakage caused by the mollifier.\n9.  The results for all test cases are collected and output in the specified format.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the BEM quadrature test suite and produce the final output.\n    \"\"\"\n    # Define physical constants as per the problem statement\n    C = 299792458.0  # Speed of Light (c) in m/s\n    A = 1.0          # Sphere radius (a) in m\n\n    def gaussian_mollifier(x, sigma_t):\n        \"\"\"\n        Computes the normalized Gaussian mollifier to approximate the Dirac delta function.\n        \"\"\"\n        if sigma_t <= 0:\n            return np.zeros_like(x)\n        \n        # Calculate the argument of the exponential function\n        arg = -0.5 * (x / sigma_t)**2\n        \n        # Using a mask to avoid computing exp for very small arguments, ensuring numerical stability\n        val = np.zeros_like(arg, dtype=float)\n        mask = arg > -700 # Below this, exp(arg) is effectively zero\n        val[mask] = np.exp(arg[mask])\n\n        return (1.0 / (np.sqrt(2.0 * np.pi) * sigma_t)) * val\n\n    def calculate_phi_num(r0, t, N_theta, sigma_t):\n        \"\"\"\n        Computes the numerical approximation of the scalar potential using midpoint quadrature.\n        The formula is simplified by analytically integrating over the azimuthal angle.\n        \"\"\"\n        delta_theta = np.pi / N_theta\n        \n        # Midpoint quadrature points for the polar angle theta\n        theta_i = (np.arange(1, N_theta + 1) - 0.5) * delta_theta\n\n        # Distance R(theta) from observation point to points on the sphere surface\n        R_i = np.sqrt(r0**2 + A**2 - 2 * A * r0 * np.cos(theta_i))\n        \n        # Argument for the mollified delta function (retarded time difference)\n        retarded_time_diff = t - R_i / C\n        \n        # Evaluate the mollifier at each quadrature point\n        delta_vals = gaussian_mollifier(retarded_time_diff, sigma_t)\n        \n        # Compute the summand for each theta panel\n        summand = (np.sin(theta_i) / R_i) * delta_vals\n        \n        # Final numerical potential from the sum over theta\n        # The pre-factor a^2 * delta_theta / 2 comes from simplifying the original double sum\n        phi_num = (A**2 * delta_theta / 2.0) * np.sum(summand)\n        \n        return phi_num\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        # Test 1: r0=0.5, mid-window\n        {'r0': 0.5, 't_expr': lambda t_min, t_max: (t_min + t_max) / 2.0, \n         'N_theta': 48, 'N_phi': 96, 'sigma_t': 1e-10},\n        # Test 2: r0=0.5, near-lower-boundary\n        {'r0': 0.5, 't_expr': lambda t_min, t_max: t_min + 1e-11, \n         'N_theta': 48, 'N_phi': 96, 'sigma_t': 1e-11},\n        # Test 3: r0=0.5, near-upper-boundary\n        {'r0': 0.5, 't_expr': lambda t_min, t_max: t_max - 1e-11, \n         'N_theta': 192, 'N_phi': 384, 'sigma_t': 5e-12},\n        # Test 4: r0=0.5, outside-window\n        {'r0': 0.5, 't_expr': lambda t_min, t_max: t_max + 3e-11, \n         'N_theta': 192, 'N_phi': 384, 'sigma_t': 1e-11},\n        # Test 5: r0=1.5, mid-window\n        {'r0': 1.5, 't_expr': lambda t_min, t_max: (t_min + t_max) / 2.0, \n         'N_theta': 48, 'N_phi': 96, 'sigma_t': 1e-10},\n        # Test 6: r0=1.5, near-lower-boundary\n        {'r0': 1.5, 't_expr': lambda t_min, t_max: t_min + 1e-11, \n         'N_theta': 48, 'N_phi': 96, 'sigma_t': 1e-11},\n        # Test 7: r0=1.5, near-upper-boundary\n        {'r0': 1.5, 't_expr': lambda t_min, t_max: t_max - 1e-11, \n         'N_theta': 192, 'N_phi': 384, 'sigma_t': 5e-12},\n        # Test 8: r0=1.5, outside-window\n        {'r0': 1.5, 't_expr': lambda t_min, t_max: t_max + 3e-11, \n         'N_theta': 192, 'N_phi': 384, 'sigma_t': 1e-11},\n    ]\n\n    results = []\n    for case in test_cases:\n        r0 = case['r0']\n        N_theta = case['N_theta']\n        sigma_t = case['sigma_t']\n        \n        # Calculate the analytical time window boundaries\n        t_min = np.abs(r0 - A) / C\n        t_max = (r0 + A) / C\n        \n        # Determine the evaluation time t based on the test case expression\n        t = case['t_expr'](t_min, t_max)\n        \n        # Compute the numerical solution (N_phi is not needed due to simplification)\n        phi_num = calculate_phi_num(r0, t, N_theta, sigma_t)\n        \n        # Determine whether to report relative error or absolute value\n        if t_min <= t <= t_max:\n            # Time is inside the window, calculate relative error\n            phi_ref = A * C / (2 * r0)\n            relative_error = (phi_num - phi_ref) / phi_ref\n            results.append(relative_error)\n        else:\n            # Time is outside the window, report absolute numerical leakage\n            results.append(phi_num)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3346348"}]}