{"hands_on_practices": [{"introduction": "The boundary conditions that govern electromagnetic fields at material interfaces are not axioms, but direct consequences of Maxwell's equations. This foundational exercise guides you through the process of deriving one of the most important boundary conditions in electromagnetics: the relationship between the tangential magnetic field and the surface current density on a perfect electric conductor (PEC). By applying the integral form of Ampère's law to an infinitesimal loop straddling the interface, you will solidify your understanding of how macroscopic boundary rules emerge from fundamental physics, and then apply this rule to the classic problem of plane wave reflection [@problem_id:3290423].", "problem": "A time-harmonic electromagnetic field with suppressed $\\exp(\\mathrm{j}\\omega t)$ time dependence impinges on a planar interface separating a homogeneous, isotropic, lossless exterior medium occupying $z>0$ from a Perfect Electric Conductor (PEC) occupying $z<0$. The exterior medium has permittivity $\\epsilon_{1}$, permeability $\\mu_{1}$, and intrinsic impedance $\\eta_{1}=\\sqrt{\\mu_{1}/\\epsilon_{1}}$. The unit normal $\\hat{n}$ points out of the PEC into the exterior medium, so $\\hat{n}=\\hat{z}$ at $z=0$. \n\nPart I. Starting from Maxwell’s equations in their integral form, and invoking physically justified limiting arguments for a vanishingly thin rectangular Amperian loop that straddles the interface, derive the boundary relation that connects the tangential component of the magnetic field at the interface to the surface current density induced on the PEC. Your derivation must begin with fundamental laws, namely the integral form of Ampère–Maxwell law with free current density and displacement current, and proceed by evaluating the loop integral and the flux terms consistently as the loop thickness perpendicular to the interface tends to zero.\n\nPart II. Consider a transverse electric (TE) plane wave incident from the exterior medium onto the PEC at $z=0$. The incident electric field is \n$$\\mathbf{E}_{\\mathrm{i}}(\\mathbf{r})=E_{0}\\,\\hat{y}\\,\\exp\\!\\big(\\mathrm{j}\\,k_{1}(\\sin\\theta\\,x-\\cos\\theta\\,z)\\big),$$\nwhere $E_{0}>0$ is the real-valued amplitude, $k_{1}=\\omega\\sqrt{\\mu_{1}\\epsilon_{1}}$ is the wavenumber in the exterior medium, and $\\theta\\in(0,\\pi/2)$ is the angle of incidence measured from the positive $z$-axis toward the positive $x$-axis. Let $\\mathbf{k}_{\\mathrm{i}}=k_{1}(\\sin\\theta\\,\\hat{x}-\\cos\\theta\\,\\hat{z})$ denote the incident propagation vector and assume the standard plane-wave relation between electric and magnetic fields in a homogeneous medium. The PEC reflects the wave so that the total tangential electric field at $z=0$ vanishes. Using the boundary relation established in Part I and enforcing the vanishing of the tangential electric field at $z=0$, determine the induced surface current density $\\mathbf{K}_{s}$ at $z=0$ in terms of $E_{0}$, $\\eta_{1}$, and $\\theta$.\n\nAnswer specification: Provide your final answer as a single closed-form analytic expression for the Cartesian components of $\\mathbf{K}_{s}$, written as the row vector $(K_{sx},K_{sy},K_{sz})$. No numerical evaluation or rounding is required, and no units should be included in your final expression.", "solution": "The problem is validated as self-contained, scientifically grounded, and well-posed. It is a standard problem in classical electromagnetism.\n\nPart I: Derivation of the boundary condition for the tangential magnetic field at a PEC interface.\n\nWe begin with the integral form of the Ampère-Maxwell law for time-harmonic fields, where the time dependence is given by $\\exp(\\mathrm{j}\\omega t)$, and thus the time derivative $\\frac{\\partial}{\\partial t}$ is replaced by $\\mathrm{j}\\omega$:\n$$ \\oint_C \\mathbf{H} \\cdot d\\mathbf{l} = \\int_S (\\mathbf{J}_f + \\mathrm{j}\\omega\\mathbf{D}) \\cdot d\\mathbf{S} $$\nHere, $C$ is a closed path, $S$ is any surface bounded by $C$, $\\mathbf{H}$ is the magnetic field, $\\mathbf{J}_f$ is the free volume current density, and $\\mathbf{D}$ is the electric displacement field.\n\nWe consider a planar interface at $z=0$ separating a general medium (region 1, $z>0$) from a Perfect Electric Conductor (PEC) (region 2, $z<0$). The unit normal vector pointing from region 2 to region 1 is $\\hat{n}=\\hat{z}$. To derive the boundary condition, we construct a small rectangular Amperian loop $C$ that straddles the interface. The loop has a width $\\Delta w$ parallel to the interface and a height $\\Delta h$ perpendicular to the interface, centered at $z=0$. Let the orientation be such that the sides of length $\\Delta w$ are parallel to an arbitrary tangential direction $\\hat{\\tau}$, and the sides of length $\\Delta h$ are parallel to the normal $\\hat{n}$.\n\nWe evaluate the line integral $\\oint_C \\mathbf{H} \\cdot d\\mathbf{l}$ in the limit as the height of the loop vanishes, i.e., $\\Delta h \\to 0$. The integral consists of contributions from the four segments of the rectangle. The contributions from the two vertical segments of length $\\Delta h$ are proportional to $\\Delta h$ and vanish as $\\Delta h \\to 0$, assuming the field $\\mathbf{H}$ is finite. The contributions from the top and bottom horizontal segments remain. The top segment is at $z=+\\Delta h/2$ in region 1, and the bottom segment is at $z=-\\Delta h/2$ in region 2.\n$$ \\lim_{\\Delta h \\to 0} \\oint_C \\mathbf{H} \\cdot d\\mathbf{l} = \\mathbf{H}_1 \\cdot (\\Delta w \\hat{\\tau}) + \\mathbf{H}_2 \\cdot (-\\Delta w \\hat{\\tau}) = (\\mathbf{H}_{1,t} - \\mathbf{H}_{2,t}) \\cdot \\hat{\\tau} \\Delta w $$\nHere, $\\mathbf{H}_1$ and $\\mathbf{H}_2$ are the magnetic fields at the interface in region 1 and region 2 respectively, and $\\mathbf{H}_{1,t}$ and $\\mathbf{H}_{2,t}$ are their components tangential to the surface.\n\nNext, we evaluate the surface integral on the right-hand side. The surface $S$ bounded by the loop has an area of $\\Delta w \\Delta h$. The flux of the displacement current term, $\\int_S \\mathrm{j}\\omega\\mathbf{D} \\cdot d\\mathbf{S}$, is proportional to the area $\\Delta w \\Delta h$. As $\\Delta h \\to 0$, this term vanishes, assuming $\\mathbf{D}$ is finite. The free current term $\\int_S \\mathbf{J}_f \\cdot d\\mathbf{S}$ represents the total free current passing through the loop. If a surface current density $\\mathbf{K}_s$ exists at the interface, the volume current density $\\mathbf{J}_f$ becomes singular at $z=0$. The integral gives the total current, which in the limit $\\Delta h \\to 0$ is the product of the component of $\\mathbf{K}_s$ perpendicular to the side $\\Delta w$ and the length $\\Delta w$. Let the normal to the surface of the loop be $\\hat{t} = \\hat{\\tau} \\times \\hat{n}$. The current passing through the loop is $(\\mathbf{K}_s \\cdot \\hat{t}) \\Delta w$.\n\nEquating the line and surface integrals, and dividing by $\\Delta w$:\n$$ (\\mathbf{H}_{1,t} - \\mathbf{H}_{2,t}) \\cdot \\hat{\\tau} = \\mathbf{K}_s \\cdot (\\hat{\\tau} \\times \\hat{n}) $$\nUsing the scalar triple product identity $\\mathbf{A} \\cdot (\\mathbf{B} \\times \\mathbf{C}) = (\\mathbf{A} \\times \\mathbf{B}) \\cdot \\mathbf{C}$, we have $\\mathbf{K}_s \\cdot (\\hat{\\tau} \\times \\hat{n}) = (\\mathbf{K}_s \\times \\hat{\\tau}) \\cdot \\hat{n}$. The component-wise relationship must hold for any orientation of the loop in the tangent plane. This leads to the general vector boundary condition:\n$$ \\hat{n} \\times (\\mathbf{H}_1 - \\mathbf{H}_2) = \\mathbf{K}_s $$\nInside a PEC (region 2), the electromagnetic fields are identically zero, so $\\mathbf{H}_2 = \\mathbf{0}$. The boundary condition at the surface of a PEC thus simplifies to:\n$$ \\mathbf{K}_s = \\hat{n} \\times \\mathbf{H}_1 $$\nwhere $\\mathbf{H}_1$ is the magnetic field just outside the conductor.\n\nPart II: Calculation of the surface current density.\n\nWe are given a TE-polarized incident plane wave in the exterior medium ($z>0$):\n$$ \\mathbf{E}_{\\mathrm{i}}(\\mathbf{r})=E_{0}\\,\\hat{y}\\,\\exp(\\mathrm{j}(k_{1}x\\sin\\theta - k_{1}z\\cos\\theta)) $$\nThe incident wave vector is $\\mathbf{k}_{\\mathrm{i}} = k_{1}(\\sin\\theta\\,\\hat{x}-\\cos\\theta\\,\\hat{z})$. The corresponding incident magnetic field $\\mathbf{H}_{\\mathrm{i}}$ is found using the plane-wave relation $\\mathbf{H} = (\\eta^{-1}) \\hat{k} \\times \\mathbf{E}$:\n$$ \\mathbf{H}_{\\mathrm{i}} = \\frac{1}{\\eta_{1}} \\frac{\\mathbf{k}_{\\mathrm{i}}}{k_{1}} \\times \\mathbf{E}_{\\mathrm{i}} = \\frac{1}{\\eta_{1}} (\\sin\\theta\\,\\hat{x}-\\cos\\theta\\,\\hat{z}) \\times \\big(E_{0}\\,\\hat{y}\\,\\exp(\\mathrm{j}\\mathbf{k}_{\\mathrm{i}}\\cdot\\mathbf{r})\\big) $$\n$$ \\mathbf{H}_{\\mathrm{i}} = \\frac{E_{0}}{\\eta_{1}} \\big(\\sin\\theta(\\hat{x}\\times\\hat{y}) - \\cos\\theta(\\hat{z}\\times\\hat{y})\\big) \\exp(\\mathrm{j}\\mathbf{k}_{\\mathrm{i}}\\cdot\\mathbf{r}) $$\nUsing $\\hat{x}\\times\\hat{y}=\\hat{z}$ and $\\hat{z}\\times\\hat{y}=-\\hat{x}$, we get:\n$$ \\mathbf{H}_{\\mathrm{i}} = \\frac{E_{0}}{\\eta_{1}} (\\cos\\theta\\,\\hat{x} + \\sin\\theta\\,\\hat{z}) \\exp(\\mathrm{j}(k_{1}x\\sin\\theta - k_{1}z\\cos\\theta)) $$\nAt the PEC boundary ($z=0$), the total tangential electric field must be zero. The total field is the sum of the incident and reflected fields, $\\mathbf{E} = \\mathbf{E}_{\\mathrm{i}} + \\mathbf{E}_{\\mathrm{r}}$.\n$$ \\mathbf{E}_{\\mathrm{tan}}(x,y,0) = \\mathbf{E}_{\\mathrm{i,tan}}(x,y,0) + \\mathbf{E}_{\\mathrm{r,tan}}(x,y,0) = \\mathbf{0} $$\nThe incident electric field $\\mathbf{E}_{\\mathrm{i}}$ is entirely tangential (in the $\\hat{y}$ direction). At $z=0$:\n$$ \\mathbf{E}_{\\mathrm{i}}(x,y,0) = E_{0}\\,\\hat{y}\\,\\exp(\\mathrm{j}k_{1}x\\sin\\theta) $$\nTherefore, the reflected electric field at the boundary must be:\n$$ \\mathbf{E}_{\\mathrm{r}}(x,y,0) = -E_{0}\\,\\hat{y}\\,\\exp(\\mathrm{j}k_{1}x\\sin\\theta) $$\nThe reflected wave propagates away from the interface into region 1. By phase matching, the tangential component of its wave vector is the same as the incident one, while the normal component is reversed: $\\mathbf{k}_{\\mathrm{r}} = k_{1}(\\sin\\theta\\,\\hat{x}+\\cos\\theta\\,\\hat{z})$. Thus, the reflected electric field is:\n$$ \\mathbf{E}_{\\mathrm{r}}(\\mathbf{r}) = -E_{0}\\,\\hat{y}\\,\\exp(\\mathrm{j}(k_{1}x\\sin\\theta + k_{1}z\\cos\\theta)) $$\nThe reflected magnetic field $\\mathbf{H}_{\\mathrm{r}}$ is:\n$$ \\mathbf{H}_{\\mathrm{r}} = \\frac{1}{\\eta_{1}} \\frac{\\mathbf{k}_{\\mathrm{r}}}{k_{1}} \\times \\mathbf{E}_{\\mathrm{r}} = \\frac{1}{\\eta_{1}} (\\sin\\theta\\,\\hat{x}+\\cos\\theta\\,\\hat{z}) \\times \\big(-E_{0}\\,\\hat{y}\\,\\exp(\\mathrm{j}\\mathbf{k}_{\\mathrm{r}}\\cdot\\mathbf{r})\\big) $$\n$$ \\mathbf{H}_{\\mathrm{r}} = -\\frac{E_{0}}{\\eta_{1}} \\big(\\sin\\theta(\\hat{x}\\times\\hat{y}) + \\cos\\theta(\\hat{z}\\times\\hat{y})\\big) \\exp(\\mathrm{j}\\mathbf{k}_{\\mathrm{r}}\\cdot\\mathbf{r}) $$\n$$ \\mathbf{H}_{\\mathrm{r}} = \\frac{E_{0}}{\\eta_{1}} (\\cos\\theta\\,\\hat{x} - \\sin\\theta\\,\\hat{z}) \\exp(\\mathrm{j}(k_{1}x\\sin\\theta + k_{1}z\\cos\\theta)) $$\nThe total magnetic field $\\mathbf{H} = \\mathbf{H}_{\\mathrm{i}} + \\mathbf{H}_{\\mathrm{r}}$ is evaluated at the interface $z=0$:\n$$ \\mathbf{H}(x,y,0) = \\mathbf{H}_{\\mathrm{i}}(x,y,0) + \\mathbf{H}_{\\mathrm{r}}(x,y,0) $$\n$$ \\mathbf{H}(x,y,0) = \\frac{E_{0}}{\\eta_{1}} (\\cos\\theta\\,\\hat{x} + \\sin\\theta\\,\\hat{z})\\exp(\\mathrm{j}k_{1}x\\sin\\theta) + \\frac{E_{0}}{\\eta_{1}} (\\cos\\theta\\,\\hat{x} - \\sin\\theta\\,\\hat{z})\\exp(\\mathrm{j}k_{1}x\\sin\\theta) $$\n$$ \\mathbf{H}(x,y,0) = \\frac{E_{0}}{\\eta_{1}} (2\\cos\\theta\\,\\hat{x})\\exp(\\mathrm{j}k_{1}x\\sin\\theta) = \\frac{2E_{0}}{\\eta_{1}}\\cos\\theta\\,\\hat{x}\\,\\exp(\\mathrm{j}k_{1}x\\sin\\theta) $$\nNow we use the boundary relation from Part I to find the induced surface current density $\\mathbf{K}_s$. With $\\hat{n}=\\hat{z}$ and $\\mathbf{H}_1=\\mathbf{H}(x,y,0)$:\n$$ \\mathbf{K}_s = \\hat{n} \\times \\mathbf{H}_1 = \\hat{z} \\times \\left(\\frac{2E_{0}}{\\eta_{1}}\\cos\\theta\\,\\hat{x}\\,\\exp(\\mathrm{j}k_{1}x\\sin\\theta)\\right) $$\nUsing $\\hat{z}\\times\\hat{x} = \\hat{y}$, we obtain:\n$$ \\mathbf{K}_s = \\frac{2E_{0}}{\\eta_{1}}\\cos\\theta\\,\\hat{y}\\,\\exp(\\mathrm{j}k_{1}x\\sin\\theta) $$\nThe Cartesian components of the surface current density are requested. From the expression above, we have:\n$K_{sx} = 0$\n$K_{sy} = \\frac{2E_{0}}{\\eta_{1}}\\cos\\theta\\,\\exp(\\mathrm{j}k_{1}x\\sin\\theta)$\n$K_{sz} = 0$\nThese components can be written as a row vector $(K_{sx}, K_{sy}, K_{sz})$.", "answer": "$$ \\boxed{\n\\begin{pmatrix}\n0 & \\frac{2E_{0}}{\\eta_{1}}\\cos\\theta\\,\\exp(\\mathrm{j}k_{1}x\\sin\\theta) & 0\n\\end{pmatrix}\n} $$", "id": "3290423"}, {"introduction": "Moving from analytical theory to robust computational code requires careful attention to mathematical formalism, particularly with sign conventions. The jump conditions at an interface depend critically on the choice of the normal vector $\\hat{n}$ and the definition of the jump operator itself, details often glossed over in introductory texts but vital for correct implementation. This practice [@problem_id:3290459] is a thought experiment designed to hone your intuition for these details, exploring how the boundary relations transform under different conventions and ensuring your future numerical schemes are invariant to arbitrary choices of local coordinate systems.", "problem": "Consider a smooth material interface $\\Sigma$ separating medium $1$ and medium $2$ in a time-dependent electromagnetic field. Let $\\hat{n}$ denote a chosen unit normal on $\\Sigma$ pointing from medium $1$ into medium $2$. Assume there is an electric surface charge density $\\rho_s$ and an electric surface current density $\\mathbf{K}_s$ supported on $\\Sigma$. In a computational electromagnetics discretization that enforces boundary conditions via face-local integral relations (e.g., finite volume or discontinuous Galerkin formulations), sign conventions arise from the orientation of $\\hat{n}$ and from how jumps are defined.\n\nStarting only from the integral forms of Maxwell’s equations:\n- Electric Gauss law: $$\\oint_{\\partial V} \\mathbf{D}\\cdot d\\mathbf{S}=\\int_V \\rho\\, dV,$$\n- Ampère–Maxwell law: $$\\oint_{\\partial S} \\mathbf{H}\\cdot d\\boldsymbol{\\ell}=\\int_S \\mathbf{J}\\cdot d\\mathbf{S}+\\frac{\\partial}{\\partial t}\\int_S \\mathbf{D}\\cdot d\\mathbf{S},$$\nuse limiting pillbox and loop arguments to reason about the dependence of the algebraic signs of $\\rho_s$ and $\\mathbf{K}_s$ on the orientation of $\\hat{n}$ and on the ordering used in the jump operator. In particular, distinguish between:\n- a “fixed-label” jump that always uses $(\\cdot)_2-(\\cdot)_1$ regardless of $\\hat{n}$, and\n- an “oriented” jump that is defined as the “plus-side minus minus-side,” where the plus-side is the side into which $\\hat{n}$ points.\n\nWhich of the following statements must be true under these conventions?\n\nA. If $\\hat{n}$ is flipped to $-\\hat{n}$ while the jump is kept as $(\\cdot)_2-(\\cdot)_1$, then the algebraic signs of both $\\rho_s$ and $\\mathbf{K}_s$ on the right-hand sides of the jump relations are reversed.\n\nB. If $\\hat{n}$ is flipped to $-\\hat{n}$ while the jump is kept as $(\\cdot)_2-(\\cdot)_1$, then the algebraic sign of $\\rho_s$ is reversed, but the algebraic sign of $\\mathbf{K}_s$ is unchanged because $\\mathbf{K}_s$ is tangential.\n\nC. If the jump is defined in the oriented sense as “plus-side minus minus-side” with the plus-side chosen in the direction of $\\hat{n}$, then flipping $\\hat{n}$ while correspondingly reassigning which side is plus leaves the right-hand sides involving $\\rho_s$ and $\\mathbf{K}_s$ unchanged (no sign reversal).\n\nD. The cross-product representation of the tangential magnetic field jump is inherently orientation-free, so flipping $\\hat{n}$ cannot alter the sign associated with $\\mathbf{K}_s$.\n\nE. In the absence of magnetic monopoles and regardless of jump ordering, the normal component of the magnetic flux density has a jump equal to the electric surface charge density, so flipping $\\hat{n}$ cannot affect the sign associated with $\\rho_s$.\n\nSelect all that apply. Provide justification rooted in the integral laws and the orientation rules of Stokes’ theorem and the divergence theorem.", "solution": "The problem statement asks for an analysis of sign conventions in electromagnetic boundary conditions derived from the integral forms of Maxwell's equations. The analysis must consider the effect of flipping the interface normal $\\hat{n}$ under two different definitions of the jump operator.\n\n### Step 1: Extract Givens\n-   **Interface and Normal:** A smooth material interface $\\Sigma$ separates medium $1$ and medium $2$. A unit normal $\\hat{n}$ points from medium $1$ into medium $2$.\n-   **Surface Sources:** An electric surface charge density $\\rho_s$ and an electric surface current density $\\mathbf{K}_s$ exist on $\\Sigma$.\n-   **Governing Equations (Integral Form):**\n    -   Electric Gauss Law: $\\oint_{\\partial V} \\mathbf{D}\\cdot d\\mathbf{S}=\\int_V \\rho\\, dV$\n    -   Ampère–Maxwell Law: $\\oint_{\\partial S} \\mathbf{H}\\cdot d\\boldsymbol{\\ell}=\\int_S \\mathbf{J}\\cdot d\\mathbf{S}+\\frac{\\partial}{\\partial t}\\int_S \\mathbf{D}\\cdot d\\mathbf{S}$\n-   **Methodology:** Use limiting pillbox and loop arguments.\n-   **Jump Operator Definitions:**\n    1.  **Fixed-label jump:** Always defined as $(\\cdot)_2 - (\\cdot)_1$.\n    2.  **Oriented jump:** Defined as $(\\cdot)_{\\text{plus-side}} - (\\cdot)_{\\text{minus-side}}$, where the plus-side is the side into which $\\hat{n}$ points.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective. It poses a standard, non-trivial question in electromagnetic theory concerning the derivation and interpretation of boundary conditions, a cornerstone of both analytical and computational electromagnetics. The premises, including the integral forms of Maxwell's equations and the definitions of the jump operators, are clear, correct, and self-consistent. The problem does not violate any fundamental principles, is not based on false premises, and contains all necessary information for a rigorous derivation. It is a formalizable problem with a unique and meaningful solution based on vector calculus and physics.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid**. We may proceed with the solution.\n\n### Derivation of Boundary Conditions\n\nWe derive the boundary conditions from the provided integral laws by applying them to infinitesimal geometries straddling the interface $\\Sigma$. We will consistently use the initial convention where $\\hat{n}$ points from medium $1$ to medium $2$.\n\n**1. Normal Component of $\\mathbf{D}$ (from Gauss's Law)**\n\nConsider a small cylindrical pillbox of top/bottom area $\\Delta A$ and height $h$ centered on $\\Sigma$. The top face is in medium $2$ and the bottom face is in medium $1$. The outward normal to the top face is $\\hat{n}$, and the outward normal to the bottom face is $-\\hat{n}$. We apply the divergence theorem (the basis for Gauss's law).\n\nThe flux integral is $\\oint_{\\partial V} \\mathbf{D}\\cdot d\\mathbf{S} = \\int_{\\text{top}} \\mathbf{D}\\cdot d\\mathbf{S} + \\int_{\\text{bottom}} \\mathbf{D}\\cdot d\\mathbf{S} + \\int_{\\text{side}} \\mathbf{D}\\cdot d\\mathbf{S}$.\n\nIn the limit as $h \\to 0$:\n-   $\\int_{\\text{top}} \\mathbf{D}\\cdot d\\mathbf{S} \\approx (\\mathbf{D}_2 \\cdot \\hat{n}) \\Delta A$.\n-   $\\int_{\\text{bottom}} \\mathbf{D}\\cdot d\\mathbf{S} \\approx (\\mathbf{D}_1 \\cdot (-\\hat{n})) \\Delta A = -(\\mathbf{D}_1 \\cdot \\hat{n}) \\Delta A$.\n-   The flux through the side wall is proportional to $h$ and vanishes.\n\nThe total charge enclosed is $\\int_V \\rho\\, dV \\to \\rho_s \\Delta A$.\n\nEquating the flux to the enclosed charge and dividing by $\\Delta A$:\n$(\\mathbf{D}_2 \\cdot \\hat{n}) - (\\mathbf{D}_1 \\cdot \\hat{n}) = \\rho_s$\n$\\hat{n} \\cdot (\\mathbf{D}_2 - \\mathbf{D}_1) = \\rho_s$\n\n**2. Tangential Component of $\\mathbf{H}$ (from Ampère-Maxwell Law)**\n\nConsider a small rectangular loop of height $h$ and length $\\Delta l$ straddling the interface. Let the sides of length $\\Delta l$ be parallel to the interface, with the loop plane perpendicular to $\\Sigma$. Let $\\hat{t}$ be a unit vector along the top edge of the loop (in medium $2$). The corresponding bottom edge (in medium $1$) is directed along $-\\hat{t}$. The normal to the loop's surface, $\\hat{m}$, is given by the right-hand rule as $\\hat{m} = \\hat{t} \\times \\hat{n}$.\n\nThe line integral is $\\oint_{\\partial S} \\mathbf{H}\\cdot d\\boldsymbol{\\ell} = \\int_{\\text{top}} \\mathbf{H}\\cdot d\\boldsymbol{\\ell} + \\int_{\\text{bottom}} \\mathbf{H}\\cdot d\\boldsymbol{\\ell} + \\int_{\\text{sides}} \\mathbf{H}\\cdot d\\boldsymbol{\\ell}$.\n\nIn the limit as $h \\to 0$:\n-   $\\int_{\\text{top}} \\mathbf{H}\\cdot d\\boldsymbol{\\ell} \\approx (\\mathbf{H}_2 \\cdot \\hat{t}) \\Delta l$.\n-   $\\int_{\\text{bottom}} \\mathbf{H}\\cdot d\\boldsymbol{\\ell} \\approx (\\mathbf{H}_1 \\cdot (-\\hat{t})) \\Delta l = -(\\mathbf{H}_1 \\cdot \\hat{t}) \\Delta l$.\n-   The contribution from the short sides is proportional to $h$ and vanishes.\n\nThe right-hand side of Ampère's law involves the flux of current density $\\mathbf{J}$ and displacement current density $\\partial \\mathbf{D} / \\partial t$. As the area of the loop $h \\Delta l \\to 0$, the flux contributions from any finite volume densities vanish. However, the surface current $\\mathbf{K}_s$ provides a finite contribution:\n$\\int_S \\mathbf{J}\\cdot d\\mathbf{S} \\to (\\mathbf{K}_s \\cdot \\hat{m}) \\Delta l$.\n\nEquating the line integral to the enclosed current and dividing by $\\Delta l$:\n$(\\mathbf{H}_2 \\cdot \\hat{t}) - (\\mathbf{H}_1 \\cdot \\hat{t}) = \\mathbf{K}_s \\cdot \\hat{m} = \\mathbf{K}_s \\cdot (\\hat{t} \\times \\hat{n})$.\nThis scalar relationship must hold for any choice of tangential unit vector $\\hat{t}$. To establish the vector form, consider a local coordinate system with $\\hat{n}=\\hat{z}$. If we choose $\\hat{t}=\\hat{x}$, then $\\hat{m}=\\hat{y}$, and the equation becomes $H_{2x}-H_{1x}=K_{sy}$. If we choose $\\hat{t}=\\hat{y}$, then $\\hat{m}=-\\hat{x}$, and the equation becomes $H_{2y}-H_{1y}=-K_{sx}$. These two component equations are uniquely captured by the vector cross product expression:\n$\\hat{n} \\times (\\mathbf{H}_2 - \\mathbf{H}_1) = \\mathbf{K}_s$.\n\n**Summary of Baseline Relations:**\nWith $\\hat{n}$ from $1 \\to 2$ and jump defined as $(\\cdot)_2 - (\\cdot)_1$:\n1.  $\\hat{n} \\cdot (\\mathbf{D}_2 - \\mathbf{D}_1) = \\rho_s$\n2.  $\\hat{n} \\times (\\mathbf{H}_2 - \\mathbf{H}_1) = \\mathbf{K}_s$\n\n### Option-by-Option Analysis\n\n**A. If $\\hat{n}$ is flipped to $-\\hat{n}$ while the jump is kept as $(\\cdot)_2-(\\cdot)_1$, then the algebraic signs of both $\\rho_s$ and $\\mathbf{K}_s$ on the right-hand sides of the jump relations are reversed.**\n\nLet the new normal be $\\hat{n}' = -\\hat{n}$. The jump operator is unchanged: $\\jump{(\\cdot)} = (\\cdot)_2 - (\\cdot)_1$. We rewrite the baseline relations in terms of $\\hat{n}'$:\n1.  From $\\hat{n} \\cdot (\\mathbf{D}_2 - \\mathbf{D}_1) = \\rho_s$, substitute $\\hat{n} = -\\hat{n}'$.\n    $(-\\hat{n}') \\cdot (\\mathbf{D}_2 - \\mathbf{D}_1) = \\rho_s \\implies \\hat{n}' \\cdot (\\mathbf{D}_2 - \\mathbf{D}_1) = -\\rho_s$.\n2.  From $\\hat{n} \\times (\\mathbf{H}_2 - \\mathbf{H}_1) = \\mathbf{K}_s$, substitute $\\hat{n} = -\\hat{n}'$.\n    $(-\\hat{n}') \\times (\\mathbf{H}_2 - \\mathbf{H}_1) = \\mathbf{K}_s \\implies \\hat{n}' \\times (\\mathbf{H}_2 - \\mathbf{H}_1) = -\\mathbf{K}_s$.\n\nIn both cases, to maintain the physical truth of the equations while replacing $\\hat{n}$ with $\\hat{n}'$ on the left-hand side, the source terms $\\rho_s$ and $\\mathbf{K}_s$ on the right-hand side must acquire a negative sign. This means their algebraic signs are reversed.\n**Verdict: Correct**\n\n**B. If $\\hat{n}$ is flipped to $-\\hat{n}$ while the jump is kept as $(\\cdot)_2-(\\cdot)_1$, then the algebraic sign of $\\rho_s$ is reversed, but the algebraic sign of $\\mathbf{K}_s$ is unchanged because $\\mathbf{K}_s$ is tangential.**\n\nThe analysis for option A showed that the sign of the $\\mathbf{K}_s$ term is also reversed. The cross product is explicitly dependent on the direction of the normal vector. The fact that $\\mathbf{K}_s$ is tangential to the surface does not make the relation $\\hat{n} \\times \\jump{\\mathbf{H}} = \\mathbf{K}_s$ insensitive to the direction of $\\hat{n}$.\n**Verdict: Incorrect**\n\n**C. If the jump is defined in the oriented sense as “plus-side minus minus-side” with the plus-side chosen in the direction of $\\hat{n}$, then flipping $\\hat{n}$ while correspondingly reassigning which side is plus leaves the right-hand sides involving $\\rho_s$ and $\\mathbf{K}_s$ unchanged (no sign reversal).**\n\nLet's test this convention.\n-   **Initial state:** $\\hat{n}$ points from $1 \\to 2$. Plus-side is $2$, minus-side is $1$.\n    -   Oriented jump: $\\jump{(\\cdot)}_{orient} = (\\cdot)_2 - (\\cdot)_1$.\n    -   Equations: $\\hat{n} \\cdot \\jump{\\mathbf{D}}_{orient} = \\rho_s$ and $\\hat{n} \\times \\jump{\\mathbf{H}}_{orient} = \\mathbf{K}_s$.\n\n-   **Flipped state:** $\\hat{n}' = -\\hat{n}$. Now $\\hat{n}'$ points from $2 \\to 1$. Plus-side is $1$, minus-side is $2$.\n    -   New oriented jump: $\\jump{(\\cdot)}'_{orient} = (\\cdot)_1 - (\\cdot)_2 = - ((\\cdot)_2 - (\\cdot)_1) = -\\jump{(\\cdot)}_{orient}$.\n    -   Let's check if the equation form is invariant, i.e., if $\\hat{n}' \\cdot \\jump{\\mathbf{D}}'_{orient} = \\rho_s$ and $\\hat{n}' \\times \\jump{\\mathbf{H}}'_{orient} = \\mathbf{K}_s$ hold true.\n    -   For the $\\mathbf{D}$-field:\n        $\\hat{n}' \\cdot \\jump{\\mathbf{D}}'_{orient} = (-\\hat{n}) \\cdot (- \\jump{\\mathbf{D}}_{orient}) = \\hat{n} \\cdot \\jump{\\mathbf{D}}_{orient} = \\rho_s$. The equation holds with an unchanged RHS.\n    -   For the $\\mathbf{H}$-field:\n        $\\hat{n}' \\times \\jump{\\mathbf{H}}'_{orient} = (-\\hat{n}) \\times (- \\jump{\\mathbf{H}}_{orient}) = \\hat{n} \\times \\jump{\\mathbf{H}}_{orient} = \\mathbf{K}_s$. This equation also holds with an unchanged RHS.\n\nThe \"oriented\" convention is constructed precisely to be invariant to the choice of normal direction, as the flip in the normal vector is cancelled by the flip in the jump operator definition. The source terms $\\rho_s$ and $\\mathbf{K}_s$ remain unchanged on the RHS.\n**Verdict: Correct**\n\n**D. The cross-product representation of the tangential magnetic field jump is inherently orientation-free, so flipping $\\hat{n}$ cannot alter the sign associated with $\\mathbf{K}_s$.**\n\nThe premise is false. The expression $\\hat{n} \\times (\\mathbf{H}_2 - \\mathbf{H}_1)$ is fundamentally dependent on the orientation of $\\hat{n}$. If $\\hat{n}$ is replaced by $-\\hat{n}$, the value of the cross product flips sign. As shown in the analysis of option A, this requires altering the sign of the RHS term $\\mathbf{K}_s$ to maintain the equality under a fixed jump definition. The cross-product is the opposite of \"orientation-free\".\n**Verdict: Incorrect**\n\n**E. In the absence of magnetic monopoles and regardless of jump ordering, the normal component of the magnetic flux density has a jump equal to the electric surface charge density, so flipping $\\hat{n}$ cannot affect the sign associated with $\\rho_s$.**\n\nThis statement contains fundamental scientific errors.\n1.  The boundary condition for the magnetic flux density $\\mathbf{B}$ derived from Gauss's law for magnetism ($\\oint \\mathbf{B} \\cdot d\\mathbf{S} = 0$) is $\\hat{n} \\cdot (\\mathbf{B}_2 - \\mathbf{B}_1) = 0$. The jump in the normal component of $\\mathbf{B}$ is zero.\n2.  The quantity equal to the electric surface charge density $\\rho_s$ is the jump in the normal component of the *electric displacement field* $\\mathbf{D}$, not the magnetic flux density $\\mathbf{B}$.\nThe premise is factually incorrect, making the conclusion invalid.\n**Verdict: Incorrect**", "answer": "$$\\boxed{AC}$$", "id": "3290459"}, {"introduction": "A failure to correctly discretize the physics at a material interface does not merely reduce accuracy; it can introduce non-physical artifacts, or \"spurious modes,\" that violate fundamental conservation laws. This hands-on coding exercise [@problem_id:3290469] demonstrates this principle by tasking you with building a magnetostatic solver where a naive discretization at a high-contrast permeability interface generates a non-zero divergence of the magnetic flux density, $\\nabla \\cdot \\mathbf{B} \\neq 0$, creating unphysical magnetic monopoles. You will then implement a standard divergence-cleaning technique, providing a practical lesson in how to diagnose and enforce physical constraints in a numerical simulation.", "problem": "Consider a two-dimensional, source-free magnetostatic configuration on a unit square domain with Cartesian coordinates $(x,y) \\in [0,1] \\times [0,1]$. The magnetic flux density $\\mathbf{B}$ and the magnetic field intensity $\\mathbf{H}$ obey Maxwell’s equations for magnetostatics: $\\nabla \\cdot \\mathbf{B} = 0$ and $\\nabla \\times \\mathbf{H} = \\mathbf{0}$, with the constitutive relation $\\mathbf{B} = \\mu(x,y)\\,\\mathbf{H}$. In a source-free region, the magnetic field intensity is irrotational and can be represented by a scalar potential $\\phi$ as $\\mathbf{H} = -\\nabla \\phi$. The scalar potential therefore satisfies a variable-coefficient elliptic conservation law $\\nabla \\cdot (\\mu(x,y)\\,\\nabla \\phi) = 0$, which enforces the continuity of the normal component of $\\mathbf{B}$ across material interfaces.\n\nWe examine a piecewise-constant permeability field $\\mu(x,y)$ with a sharp interface at $x = 0.5$:\n- For $x < 0.5$, let $\\mu(x,y) = \\mu_1$.\n- For $x \\ge 0.5$, let $\\mu(x,y) = \\mu_2$.\n\nThe permeability values are defined using the vacuum permeability $\\mu_0 = 4\\pi \\times 10^{-7}$ Henry per meter as $\\mu_1 = \\mu_0$ and $\\mu_2 = \\mu_r\\,\\mu_0$, where $\\mu_r$ is a dimensionless relative-permeability contrast parameter. Impose Dirichlet boundary conditions on $\\phi$ such that $\\phi(0, y) = 0$ Ampere, $\\phi(1, y) = 1$ Ampere, $\\phi(x, 0) = 0$ Ampere, and $\\phi(x, 1) = 0$ Ampere.\n\nThe goal is to quantify how a discrete scheme that ignores the spatial variation of $\\mu$ can create spurious magnetic charges near the interface, and to propose a mixed formulation that mitigates these charges. Specifically, you must:\n\n1. Starting from the fundamental laws stated above, discretize and solve for a scalar potential $\\phi$ on a uniform Cartesian grid using the constant-coefficient Laplace equation $\\nabla^2 \\phi = 0$ with the given Dirichlet boundary conditions. Then compute the discrete magnetic flux density $\\mathbf{B}_{\\text{naive}} = -\\mu(x,y)\\,\\nabla \\phi$ on the same grid. Next, compute the discrete divergence of $\\mathbf{B}_{\\text{naive}}$ using centered differences in the interior of the domain. Report the maximum absolute value of the divergence over interior grid points, which represents the magnitude of spurious magnetic charge density $\\rho_m = \\nabla \\cdot \\mathbf{B}$ introduced by this naive scheme.\n\n2. Propose and implement a mixed formulation to mitigate spurious magnetic charges by enforcing $\\nabla \\cdot \\mathbf{B} = 0$ weakly via a Lagrange multiplier field. One practical realization is a divergence-cleaning projection: find a scalar field $u$ such that $\\Delta u = \\nabla \\cdot \\mathbf{B}_{\\text{naive}}$ in the domain, with homogeneous Dirichlet boundary conditions $u=0$ on $\\partial \\Omega$, and define the corrected field $\\mathbf{B}_{\\text{mixed}} = \\mathbf{B}_{\\text{naive}} - \\nabla u$. Compute the discrete divergence of $\\mathbf{B}_{\\text{mixed}}$ and report the maximum absolute value over interior grid points.\n\nYour program must use a uniform grid of $N_x = 64$ and $N_y = 64$ nodes over $[0,1]^2$, with spacings $\\Delta x = 1/(N_x-1)$ and $\\Delta y = 1/(N_y-1)$. The discrete gradients and divergences should use centered differences on interior nodes and one-sided differences at boundaries only for gradient computation (the divergence statistics are to be evaluated on interior nodes). All quantities must be computed consistently in the following physical units:\n- $\\mu$ in Henry per meter (H/m),\n- $\\phi$ in Ampere (A),\n- $\\mathbf{H}$ in Ampere per meter (A/m),\n- $\\mathbf{B}$ in Tesla (T),\n- $\\nabla \\cdot \\mathbf{B}$ in Tesla per meter (T/m).\n\nTest Suite:\nEvaluate the scheme for three relative-permeability contrasts:\n- Case 1 (baseline, no contrast): $\\mu_r = 1$,\n- Case 2 (moderate contrast): $\\mu_r = 10$,\n- Case 3 (high contrast): $\\mu_r = 1000$.\n\nFor each case, compute two floating-point results:\n- The maximum absolute interior divergence of $\\mathbf{B}_{\\text{naive}}$ in T/m.\n- The maximum absolute interior divergence of $\\mathbf{B}_{\\text{mixed}}$ in T/m.\n\nYour program should produce a single line of output containing the six results as a comma-separated list enclosed in square brackets, in the order [naive_case1, naive_case2, naive_case3, mixed_case1, mixed_case2, mixed_case3]. For example, the exact output format must match: \"[r1,r2,r3,r4,r5,r6]\". All six entries must be floats in Tesla per meter (T/m).", "solution": "The user-provided problem is a valid and well-posed exercise in computational electromagnetics. It asks to demonstrate and then mitigate the creation of spurious magnetic charges when naively discretizing a magnetostatic problem with a material interface. The problem is scientifically sound, contains all necessary information, and its objectives are clear and formalizable.\n\nThe solution proceeds in two main parts for each specified material contrast parameter $\\mu_r$, following the problem description. All calculations are performed on a uniform $N_x \\times N_y$ grid where $N_x=N_y=64$.\n\n### Part 1: The Naive Scheme and Spurious Charges\n\nThe correct governing equation for the magnetic scalar potential $\\phi$ in a source-free region with variable permeability $\\mu(x,y)$ is the conservation law $\\nabla \\cdot (\\mu \\nabla\\phi) = 0$. This equation ensures the continuity of the normal component of the magnetic flux density $\\mathbf{B}$ across material interfaces.\n\nThe \"naive\" scheme, as defined in the problem, simplifies this to the constant-coefficient Laplace equation, $\\nabla^2 \\phi = 0$. This simplification ignores the jump in permeability at the material interface located at $x=0.5$.\n\n1.  **Discretization and Solution for $\\phi$**: We discretize the Laplace equation $\\nabla^2 \\phi = 0$ on the interior nodes of the grid. Using a centered five-point finite difference stencil, the equation at an interior grid point $(i,j)$ becomes:\n    $$\n    \\frac{\\phi_{i+1,j} - 2\\phi_{i,j} + \\phi_{i-1,j}}{(\\Delta x)^2} + \\frac{\\phi_{i,j+1} - 2\\phi_{i,j} + \\phi_{i,j-1}}{(\\Delta y)^2} = 0\n    $$\n    Since $\\Delta x = \\Delta y = h$, this simplifies to:\n    $$\n    \\phi_{i+1,j} + \\phi_{i-1,j} + \\phi_{i,j+1} + \\phi_{i,j-1} - 4\\phi_{i,j} = 0\n    $$\n    This set of linear equations is formed for all $(N_x-2) \\times (N_y-2)$ interior points. The given Dirichlet boundary conditions—$\\phi(0,y)=0$, $\\phi(x,0)=0$, $\\phi(x,1)=0$, and $\\phi(1,y)=1$—are incorporated into the right-hand side of the linear system. The resulting sparse linear system, $\\mathbf{A}\\vec{\\phi}_{int} = \\vec{b}$, is solved for the vector of interior potential values $\\vec{\\phi}_{int}$. The full potential field $\\phi$ is then assembled by combining the solved interior values with the known boundary values.\n\n2.  **Computing $\\mathbf{B}_{\\text{naive}}$**: The naive magnetic flux density is computed as $\\mathbf{B}_{\\text{naive}} = -\\mu(x,y)\\,\\nabla\\phi$.\n    - The piecewise-constant permeability field $\\mu(x,y)$ is defined on the grid with $\\mu=\\mu_1$ for $x < 0.5$ and $\\mu=\\mu_2$ for $x \\ge 0.5$.\n    - The gradient $\\nabla\\phi$ is computed numerically using centered differences for interior points and one-sided differences at the boundaries.\n\n3.  **Computing Spurious Charge Density $\\rho_m$**: The spurious magnetic charge density is the divergence of the computed field, $\\rho_m = \\nabla\\cdot\\mathbf{B}_{\\text{naive}}$. This divergence is computed on the interior grid points using a centered difference scheme:\n    $$\n    (\\nabla \\cdot \\mathbf{B})_{i,j} \\approx \\frac{(B_x)_{i+1,j} - (B_x)_{i-1,j}}{2\\Delta x} + \\frac{(B_y)_{i,j+1} - (B_y)_{i,j-1}}{2\\Delta y}\n    $$\n    The maximum absolute value of this discrete divergence, $\\max|\\nabla \\cdot \\mathbf{B}_{\\text{naive}}|$, over the interior of the domain quantifies the severity of the numerical error. This error arises because the naive $\\phi$ solution has a continuous derivative across the interface, so when multiplied by the discontinuous $\\mu$, the resulting $\\mathbf{B}_{\\text{naive}}$ has a discontinuous normal component, violating $\\nabla \\cdot \\mathbf{B} = 0$.\n\n### Part 2: Mixed Formulation for Divergence Cleaning\n\nTo correct this error, a divergence-cleaning procedure is employed. This is a projection method that enforces the divergence constraint weakly.\n\n1.  **Solving the Correction Poisson Equation**: A correction potential, $u$, is found by solving the Poisson equation $\\Delta u = \\nabla \\cdot \\mathbf{B}_{\\text{naive}}$, where the source term is the spurious charge density computed in the previous step. This equation is subject to homogeneous Dirichlet boundary conditions ($u=0$ on all boundaries). We solve this using the same finite-difference-based linear system solver as for $\\phi$.\n\n2.  **Computing the Corrected Field $\\mathbf{B}_{\\text{mixed}}$**: The gradient of the correction potential, $\\nabla u$, is computed. The corrected magnetic flux density is then defined as:\n    $$\n    \\mathbf{B}_{\\text{mixed}} = \\mathbf{B}_{\\text{naive}} - \\nabla u\n    $$\n\n3.  **Verifying the Correction**: The divergence of the corrected field is computed. By construction:\n    $$\n    \\nabla \\cdot \\mathbf{B}_{\\text{mixed}} = \\nabla \\cdot (\\mathbf{B}_{\\text{naive}} - \\nabla u) = \\nabla \\cdot \\mathbf{B}_{\\text{naive}} - \\nabla^2 u\n    $$\n    Since we solved $\\nabla^2 u = \\nabla \\cdot \\mathbf{B}_{\\text{naive}}$, the divergence of the corrected field should be zero up to numerical precision. We compute $\\max|\\nabla \\cdot \\mathbf{B}_{\\text{mixed}}|$ on the interior grid to verify the effectiveness of the cleaning procedure.\n\nThe following program implements this entire process for the three specified values of relative permeability contrast $\\mu_r$. It assembles the sparse matrices for the discrete Laplacian, solves the linear systems for $\\phi$ and $u$, and computes the required divergence statistics.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import sparse\nfrom scipy.sparse.linalg import spsolve\n\ndef _solve_for_contrast(mu_r, Nx, Ny):\n    \"\"\"\n    Solves the magnetostatics problem for a given permeability contrast,\n    calculating the max divergence for both naive and mixed formulations.\n    \n    Args:\n        mu_r (float): The relative permeability contrast.\n        Nx (int): Number of grid points in the x-direction.\n        Ny (int): Number of grid points in the y-direction.\n\n    Returns:\n        tuple: A tuple containing:\n            - max_div_naive (float): Max absolute divergence of B_naive.\n            - max_div_mixed (float): Max absolute divergence of B_mixed.\n    \"\"\"\n    # 1. SETUP: Constants, Grid, and Operators\n    \n    # Physical constants and material properties in SI units\n    MU0 = 4.0 * np.pi * 1e-7  # Vacuum permeability (H/m)\n    mu1 = MU0\n    mu2 = mu_r * MU0\n    \n    # Grid parameters\n    Lx, Ly = 1.0, 1.0\n    dx = Lx / (Nx - 1)\n    dy = Ly / (Ny - 1)\n    h = dx  # Grid spacing is uniform\n\n    # Interior grid dimensions\n    Mx, My = Nx - 2, Ny - 2\n    \n    # Construct the 2D discrete Laplacian operator, L_2D, for interior nodes\n    # such that (L_2D @ u_flat) approximates (nabla^2 u) without the h^2 scaling.\n    L_1D = sparse.diags([1, -2, 1], [-1, 0, 1], shape=(Mx, Mx), format='csr')\n    I_M = sparse.identity(Mx, format='csr')\n    # Operator built for row-major (C-style) flattening of the 2D grid\n    L_2D = sparse.kron(I_M, L_1D) + sparse.kron(L_1D, I_M)\n\n    # 2. NAIVE SCHEME: Solve Laplace's equation for phi\n    \n    # Set up the Right-Hand Side (RHS) vector for the potential phi.\n    # The non-zero boundary condition phi(1, y) = 1 affects the last column of interior nodes.\n    b_phi_matrix = np.zeros((My, Mx))\n    b_phi_matrix[:, -1] = -1.0  # Contribution from phi_{i+1,j} where phi_{i+1,j}=1\n    b_phi_flat = b_phi_matrix.ravel()\n\n    # Solve the linear system L_2D * phi = b for interior phi values\n    phi_int_flat = spsolve(L_2D, b_phi_flat)\n    phi_int = phi_int_flat.reshape((My, Mx))\n\n    # Assemble the full potential field, including boundaries\n    phi = np.zeros((Ny, Nx))\n    phi[1:-1, 1:-1] = phi_int\n    phi[:, -1] = 1.0  # Set phi(1, y) = 1 A\n\n    # Compute the naive magnetic flux density B_naive = -mu(x,y) * grad(phi)\n    mu = np.full((Ny, Nx), mu1)\n    # The interface is at x = 0.5. Grid points i where x[i] >= 0.5 get mu2.\n    interface_idx = int(np.ceil(0.5 / dx))\n    mu[:, interface_idx:] = mu2\n    \n    # Compute the gradient of phi using centered differences in the interior\n    grad_phi_y, grad_phi_x = np.gradient(phi, dy, dx)\n\n    B_naive_x = -mu * grad_phi_x\n    B_naive_y = -mu * grad_phi_y\n\n    # Compute the divergence of B_naive on the interior grid\n    div_B_naive_x = (B_naive_x[1:-1, 2:] - B_naive_x[1:-1, :-2]) / (2 * dx)\n    div_B_naive_y = (B_naive_y[2:, 1:-1] - B_naive_y[:-2, 1:-1]) / (2 * dy)\n    div_B_naive = div_B_naive_x + div_B_naive_y\n    max_div_naive = np.max(np.abs(div_B_naive))\n\n    # 3. MIXED FORMULATION: Divergence cleaning\n    \n    # Solve the Poisson equation: Delta u = div(B_naive) with homogeneous Dirichlet BCs\n    # The RHS is scaled by h^2 to match the unscaled L_2D operator.\n    b_u_flat = (h**2) * div_B_naive.ravel()\n    \n    u_int_flat = spsolve(L_2D, b_u_flat)\n    u_int = u_int_flat.reshape((My, Mx))\n\n    # Assemble the full correction potential field with zero boundaries\n    u = np.zeros((Ny, Nx))\n    u[1:-1, 1:-1] = u_int\n\n    # Compute the corrected field B_mixed = B_naive - grad(u)\n    grad_u_y, grad_u_x = np.gradient(u, dy, dx)\n    B_mixed_x = B_naive_x - grad_u_x\n    B_mixed_y = B_naive_y - grad_u_y\n\n    # Compute the divergence of B_mixed on the interior grid\n    div_B_mixed_x = (B_mixed_x[1:-1, 2:] - B_mixed_x[1:-1, :-2]) / (2 * dx)\n    div_B_mixed_y = (B_mixed_y[2:, 1:-1] - B_mixed_y[:-2, 1:-1]) / (2 * dy)\n    div_B_mixed = div_B_mixed_x + div_B_mixed_y\n    max_div_mixed = np.max(np.abs(div_B_mixed))\n\n    return max_div_naive, max_div_mixed\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        1.0,      # Case 1: no contrast\n        10.0,     # Case 2: moderate contrast\n        1000.0,   # Case 3: high contrast\n    ]\n    Nx, Ny = 64, 64\n\n    results_naive = []\n    results_mixed = []\n    \n    for mu_r in test_cases:\n        naive_div, mixed_div = _solve_for_contrast(mu_r, Nx, Ny)\n        results_naive.append(naive_div)\n        results_mixed.append(mixed_div)\n\n    # Combine results in the required order: [naive_all_cases, mixed_all_cases]\n    final_results = results_naive + results_mixed\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6e}' for r in final_results)}]\")\n\nsolve()\n```", "id": "3290469"}]}