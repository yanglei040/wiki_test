{"hands_on_practices": [{"introduction": "The non-uniqueness of electromagnetic potentials is not merely a mathematical curiosity; it is a fundamental aspect of gauge freedom that offers significant practical flexibility. This exercise makes this abstract concept tangible by exploring a simple, static magnetic field. By constructing two distinct vector potentials, $\\mathbf{A}$, for the same uniform magnetic field $\\mathbf{B}$, you will see firsthand how different choices of potential can be tailored to reflect different symmetries of a problem, such as rotational or translational invariance. This practice solidifies the relationship $\\mathbf{B} = \\nabla \\times \\mathbf{A}$ and provides concrete experience in finding the scalar gauge function $\\chi$ that bridges two valid, physically equivalent descriptions. [@problem_id:3310127]", "problem": "A static, spatially uniform magnetic field is specified as $\\mathbf{B} = B_{0}\\,\\hat{\\mathbf{z}}$, with $B_{0}$ a constant. In the International System of Units (SI), electromagnetic fields can be represented in terms of scalar and vector potentials $(\\phi,\\mathbf{A})$ satisfying $\\mathbf{B} = \\nabla \\times \\mathbf{A}$ and $\\mathbf{E} = -\\nabla \\phi - \\partial \\mathbf{A}/\\partial t$. Gauge transformations of the potentials are defined by introducing a scalar gauge function $\\chi$ such that $\\mathbf{A}' = \\mathbf{A} + \\nabla \\chi$ and $\\phi' = \\phi - \\partial \\chi/\\partial t$, leaving the physical fields $\\mathbf{E}$ and $\\mathbf{B}$ unchanged.\n\nStarting from these fundamental definitions, carry out the following:\n\n1. Impose the Coulomb gauge $\\nabla \\cdot \\mathbf{A} = 0$ and construct a vector potential $\\mathbf{A}_{\\mathrm{sym}}(\\mathbf{r})$ for $\\mathbf{B} = B_{0}\\,\\hat{\\mathbf{z}}$ that is linear in the spatial coordinates and exhibits rotational symmetry about the $\\hat{\\mathbf{z}}$ axis.\n\n2. Under the same Coulomb gauge, construct a second vector potential $\\mathbf{A}_{\\mathrm{tran}}(\\mathbf{r})$ for $\\mathbf{B} = B_{0}\\,\\hat{\\mathbf{z}}$ that is translationally invariant along the $\\hat{\\mathbf{x}}$ axis, with no dependence on $x$ or $z$ and with components depending only on $y$.\n\n3. Using the gauge transformation relations, determine the scalar gauge function $\\chi(x,y,z)$ that transforms $\\mathbf{A}_{\\mathrm{sym}}$ to $\\mathbf{A}_{\\mathrm{tran}}$, and verify that this gauge function preserves the Coulomb gauge, i.e., $\\nabla \\cdot \\mathbf{A}_{\\mathrm{tran}} = 0$ given $\\nabla \\cdot \\mathbf{A}_{\\mathrm{sym}} = 0$.\n\nAssume time independence throughout (static fields) so that $\\partial \\chi/\\partial t = 0$ and $\\phi$ can be taken as constant. Express your final answer as the explicit analytic expression for the scalar gauge function $\\chi(x,y,z)$. No numerical rounding is required, and no units need to be reported in the final expression.", "solution": "The problem requires the construction of two different vector potentials for a uniform magnetic field and the determination of the scalar gauge function that transforms one into the other. The process is divided into three parts as outlined in the problem statement.\n\nThe fundamental relationship between the magnetic field $\\mathbf{B}$ and the magnetic vector potential $\\mathbf{A}$ is given by $\\mathbf{B} = \\nabla \\times \\mathbf{A}$. The fields are assumed to be static, so all time derivatives are zero.\n\nThe given magnetic field is $\\mathbf{B} = B_{0}\\,\\hat{\\mathbf{z}}$, where $B_{0}$ is a constant. In Cartesian coordinates, this means we must find a vector potential $\\mathbf{A}(x,y,z) = A_{x}\\hat{\\mathbf{x}} + A_{y}\\hat{\\mathbf{y}} + A_{z}\\hat{\\mathbf{z}}$ such that its curl is $\\mathbf{B}$:\n$$ \\nabla \\times \\mathbf{A} = \\left(\\frac{\\partial A_z}{\\partial y} - \\frac{\\partial A_y}{\\partial z}\\right)\\hat{\\mathbf{x}} + \\left(\\frac{\\partial A_x}{\\partial z} - \\frac{\\partial A_z}{\\partial x}\\right)\\hat{\\mathbf{y}} + \\left(\\frac{\\partial A_y}{\\partial x} - \\frac{\\partial A_x}{\\partial y}\\right)\\hat{\\mathbf{z}} = B_{0}\\hat{\\mathbf{z}} $$\nThis implies the following component-wise equations:\n$$(1) \\quad \\frac{\\partial A_z}{\\partial y} - \\frac{\\partial A_y}{\\partial z} = 0$$\n$$(2) \\quad \\frac{\\partial A_x}{\\partial z} - \\frac{\\partial A_z}{\\partial x} = 0$$\n$$(3) \\quad \\frac{\\partial A_y}{\\partial x} - \\frac{\\partial A_x}{\\partial y} = B_{0}$$\n\n**Part 1: Construction of the symmetric vector potential $\\mathbf{A}_{\\mathrm{sym}}$**\n\nWe are asked to find a vector potential $\\mathbf{A}_{\\mathrm{sym}}$ that satisfies the Coulomb gauge condition $\\nabla \\cdot \\mathbf{A}_{\\mathrm{sym}} = 0$, is linear in the spatial coordinates $(x,y,z)$, and exhibits rotational symmetry about the $\\hat{\\mathbf{z}}$ axis.\n\nThe condition of rotational symmetry about the $\\hat{\\mathbf{z}}$ axis suggests a form for $\\mathbf{A}$ that is proportional to $\\mathbf{r} \\times \\hat{\\mathbf{z}} = (x\\hat{\\mathbf{x}} + y\\hat{\\mathbf{y}}) \\times \\hat{\\mathbf{z}} = y\\hat{\\mathbf{x}} - x\\hat{\\mathbf{y}}$. Let's propose an ansatz of the form $\\mathbf{A}_{\\mathrm{sym}} = C(y\\hat{\\mathbf{x}} - x\\hat{\\mathbf{y}})$ for some constant $C$. This form is linear in the coordinates.\n\nLet's check the curl of this ansatz:\n$$ \\nabla \\times \\mathbf{A}_{\\mathrm{sym}} = \\nabla \\times (C y\\hat{\\mathbf{x}} - C x\\hat{\\mathbf{y}}) = \\hat{\\mathbf{z}}\\left(\\frac{\\partial(-Cx)}{\\partial x} - \\frac{\\partial(Cy)}{\\partial y}\\right) = \\hat{\\mathbf{z}}(-C - C) = -2C\\hat{\\mathbf{z}} $$\nTo match the given magnetic field $\\mathbf{B} = B_{0}\\hat{\\mathbf{z}}$, we must have $-2C = B_{0}$, which gives $C = -B_{0}/2$.\n\nThus, the vector potential is $\\mathbf{A}_{\\mathrm{sym}} = -\\frac{B_{0}}{2}(y\\hat{\\mathbf{x}} - x\\hat{\\mathbf{y}}) = \\frac{B_{0}}{2}(-y\\hat{\\mathbf{x}} + x\\hat{\\mathbf{y}})$.\nLet's verify that this satisfies the Coulomb gauge condition $\\nabla \\cdot \\mathbf{A}_{\\mathrm{sym}} = 0$:\n$$ \\nabla \\cdot \\mathbf{A}_{\\mathrm{sym}} = \\frac{\\partial}{\\partial x}\\left(-\\frac{B_{0}}{2}y\\right) + \\frac{\\partial}{\\partial y}\\left(\\frac{B_{0}}{2}x\\right) + \\frac{\\partial}{\\partial z}(0) = 0 + 0 + 0 = 0 $$\nThe condition is satisfied. So, the symmetric vector potential is:\n$$ \\mathbf{A}_{\\mathrm{sym}} = \\frac{B_{0}}{2}(-y\\hat{\\mathbf{x}} + x\\hat{\\mathbf{y}}) $$\n\n**Part 2: Construction of the translationally invariant vector potential $\\mathbf{A}_{\\mathrm{tran}}$**\n\nNext, we seek a different vector potential, $\\mathbf{A}_{\\mathrm{tran}}$, which is also in the Coulomb gauge ($\\nabla \\cdot \\mathbf{A}_{\\mathrm{tran}} = 0$) but has different symmetry properties: it must be translationally invariant along the $\\hat{\\mathbf{x}}$ axis and have components that depend only on the coordinate $y$.\n\nThese constraints mean that $\\mathbf{A}_{\\mathrm{tran}} = \\mathbf{A}_{\\mathrm{tran}}(y)$, i.e., $\\partial \\mathbf{A}_{\\mathrm{tran}}/\\partial x = 0$ and $\\partial \\mathbf{A}_{\\mathrm{tran}}/\\partial z = 0$. Let's write $\\mathbf{A}_{\\mathrm{tran}}(y) = A_{x}(y)\\hat{\\mathbf{x}} + A_{y}(y)\\hat{\\mathbf{y}} + A_{z}(y)\\hat{\\mathbf{z}}$.\n\nThe Coulomb gauge condition $\\nabla \\cdot \\mathbf{A}_{\\mathrm{tran}} = 0$ becomes:\n$$ \\frac{\\partial A_x}{\\partial x} + \\frac{\\partial A_y}{\\partial y} + \\frac{\\partial A_z}{\\partial z} = 0 + \\frac{d A_y}{d y} + 0 = 0 $$\nThis implies that $A_y(y)$ is a constant. By a simple an additional constant vector potential subtraction (a type of gauge transformation), we can set this constant to zero, so $A_{y} = 0$.\n\nNow we apply the curl condition $\\nabla \\times \\mathbf{A}_{\\mathrm{tran}} = B_{0}\\hat{\\mathbf{z}}$:\nFrom equation (1): $\\frac{d A_z}{d y} - \\frac{\\partial A_y}{\\partial z} = \\frac{d A_z}{d y} - 0 = 0$, which means $A_z(y)$ is also a constant. We can set this constant to zero, so $A_{z} = 0$.\nFrom equation (2): $\\frac{\\partial A_x}{\\partial z} - \\frac{\\partial A_z}{\\partial x} = 0 - 0 = 0$. This is satisfied.\nFrom equation (3): $\\frac{\\partial A_y}{\\partial x} - \\frac{\\partial A_x}{\\partial y} = 0 - \\frac{d A_x}{d y} = B_{0}$. This gives $\\frac{d A_x}{d y} = -B_{0}$.\n\nIntegrating with respect to $y$, we get $A_{x}(y) = -B_{0}y + K$, where $K$ is a constant of integration. The addition of a constant to a potential component does not change the magnetic field, so we can choose $K=0$ for simplicity.\n\nThus, the translationally invariant vector potential is:\n$$ \\mathbf{A}_{\\mathrm{tran}} = -B_{0}y \\hat{\\mathbf{x}} $$\n\n**Part 3: Determination of the scalar gauge function $\\chi$**\n\nThe two vector potentials, $\\mathbf{A}_{\\mathrm{sym}}$ and $\\mathbf{A}_{\\mathrm{tran}}$, describe the same magnetic field and are related by a gauge transformation. This means there exists a scalar function $\\chi(x,y,z)$ such that $\\mathbf{A}_{\\mathrm{tran}} = \\mathbf{A}_{\\mathrm{sym}} + \\nabla\\chi$. We need to find this function $\\chi$.\n\nRearranging the transformation equation, we have $\\nabla\\chi = \\mathbf{A}_{\\mathrm{tran}} - \\mathbf{A}_{\\mathrm{sym}}$.\nLet's compute the difference vector:\n$$ \\mathbf{A}_{\\mathrm{tran}} - \\mathbf{A}_{\\mathrm{sym}} = (-B_{0}y\\hat{\\mathbf{x}}) - \\left(\\frac{B_{0}}{2}(-y\\hat{\\mathbf{x}} + x\\hat{\\mathbf{y}})\\right) $$\n$$ \\mathbf{A}_{\\mathrm{tran}} - \\mathbf{A}_{\\mathrm{sym}} = \\left(-B_{0}y + \\frac{B_{0}}{2}y\\right)\\hat{\\mathbf{x}} + \\left(0 - \\frac{B_{0}}{2}x\\right)\\hat{\\mathbf{y}} = -\\frac{B_{0}}{2}y\\hat{\\mathbf{x}} - \\frac{B_{0}}{2}x\\hat{\\mathbf{y}} $$\nSo, we have $\\nabla\\chi = \\frac{\\partial \\chi}{\\partial x}\\hat{\\mathbf{x}} + \\frac{\\partial \\chi}{\\partial y}\\hat{\\mathbf{y}} + \\frac{\\partial \\chi}{\\partial z}\\hat{\\mathbf{z}} = -\\frac{B_{0}}{2}y\\hat{\\mathbf{x}} - \\frac{B_{0}}{2}x\\hat{\\mathbf{y}}$.\n\nThis gives us the partial derivatives of $\\chi$:\n$$ \\frac{\\partial \\chi}{\\partial x} = -\\frac{B_{0}}{2}y $$\n$$ \\frac{\\partial \\chi}{\\partial y} = -\\frac{B_{0}}{2}x $$\n$$ \\frac{\\partial \\chi}{\\partial z} = 0 $$\nFrom the third equation, $\\chi$ is independent of $z$, so $\\chi = \\chi(x,y)$.\nIntegrating the first equation with respect to $x$:\n$$ \\chi(x,y) = \\int \\left(-\\frac{B_{0}}{2}y\\right) dx = -\\frac{B_{0}}{2}xy + f(y) $$\nwhere $f(y)$ is an integration function that depends only on $y$.\n\nTo find $f(y)$, we differentiate this expression for $\\chi$ with respect to $y$ and equate it to the second partial derivative equation:\n$$ \\frac{\\partial \\chi}{\\partial y} = \\frac{\\partial}{\\partial y}\\left(-\\frac{B_{0}}{2}xy + f(y)\\right) = -\\frac{B_{0}}{2}x + \\frac{df}{dy} $$\nComparing this to $\\frac{\\partial \\chi}{\\partial y} = -\\frac{B_{0}}{2}x$, we see that $\\frac{df}{dy} = 0$. This implies that $f(y)$ is a constant, which we can set to zero as it does not affect the gradient $\\nabla\\chi$.\nTherefore, the desired scalar gauge function is:\n$$ \\chi(x,y,z) = -\\frac{B_{0}}{2}xy $$\n\nFinally, we must verify that this gauge transformation preserves the Coulomb gauge. A gauge transformation from $\\mathbf{A}$ to $\\mathbf{A}' = \\mathbf{A} + \\nabla\\chi$ preserves the Coulomb gauge ($\\nabla \\cdot \\mathbf{A} = 0 \\implies \\nabla \\cdot \\mathbf{A}' = 0$) if and only if the gauge function $\\chi$ satisfies the Laplace equation, $\\nabla^2\\chi=0$.\nLet's compute the Laplacian of our function $\\chi$:\n$$ \\nabla^2\\chi = \\frac{\\partial^2 \\chi}{\\partial x^2} + \\frac{\\partial^2 \\chi}{\\partial y^2} + \\frac{\\partial^2 \\chi}{\\partial z^2} $$\n$$ \\frac{\\partial^2}{\\partial x^2}\\left(-\\frac{B_{0}}{2}xy\\right) = \\frac{\\partial}{\\partial x}\\left(-\\frac{B_{0}}{2}y\\right) = 0 $$\n$$ \\frac{\\partial^2}{\\partial y^2}\\left(-\\frac{B_{0}}{2}xy\\right) = \\frac{\\partial}{\\partial y}\\left(-\\frac{B_{0}}{2}x\\right) = 0 $$\n$$ \\frac{\\partial^2}{\\partial z^2}\\left(-\\frac{B_{0}}{2}xy\\right) = 0 $$\nSo, $\\nabla^2\\chi = 0+0+0 = 0$. The condition is satisfied, confirming that since $\\mathbf{A}_{\\mathrm{sym}}$ is in the Coulomb gauge, $\\mathbf{A}_{\\mathrm{tran}}$ must be as well. This is consistent with our independent verification in Part 2.", "answer": "$$ \\boxed{-\\frac{B_{0}}{2}xy} $$", "id": "3310127"}, {"introduction": "Moving from static to time-dependent fields, the choice of gauge has profound implications for numerical methods. The Lorenz gauge, $\\nabla \\cdot \\mathbf{A} + c^{-2} \\partial_t \\phi = 0$, is particularly powerful because it decouples the potentials into a pair of elegant wave equations, simplifying many computational schemes. However, this elegant separation holds if and only if the charge and current densities satisfy the continuity equation. This computational exercise tasks you with implementing a Finite-Difference Time-Domain (FDTD) simulation to build a numerical diagnostic that directly visualizes this crucial link. You will see how enforcing the discrete continuity equation preserves the Lorenz gauge, whereas violating it causes the gauge condition to break down, providing an invaluable lesson on the foundations of stable and accurate time-domain solvers. [@problem_id:3310124]", "problem": "You are given a one-dimensional periodic spatial grid and a second-order explicit time-marching scheme for electromagnetic potentials under the Lorenz gauge. The objective is to design and implement a diagnostic that measures the discrete residual of a chosen gauge condition and relate it to the discrete continuity equation in the scheme. You must implement a complete program that computes the gauge residual and the continuity residual across several test cases and outputs a quantitative diagnostic for each case.\n\nStart from the following physical and mathematical foundations:\n- Maxwell's equations with potentials define the electric field and magnetic field as $\\mathbf{E} = -\\nabla \\phi - \\partial \\mathbf{A} / \\partial t$ and $\\mathbf{B} = \\nabla \\times \\mathbf{A}$, where $\\mathbf{A}$ is the magnetic vector potential and $\\phi$ is the electric scalar potential.\n- The Lorenz gauge condition is $\\nabla \\cdot \\mathbf{A} + \\frac{1}{c^2} \\frac{\\partial \\phi}{\\partial t} = 0$.\n- Imposing the Lorenz gauge leads to decoupled wave equations for the potentials: $\\Box \\phi = \\rho / \\varepsilon_0$ and $\\Box \\mathbf{A} = \\mu_0 \\mathbf{J}$, where $\\Box = \\frac{1}{c^2} \\frac{\\partial^2}{\\partial t^2} - \\nabla^2$ and where $\\rho$ is the charge density and $\\mathbf{J}$ is the current density. Using $c^2 = 1 / (\\mu_0 \\varepsilon_0)$ yields $\\frac{\\partial^2 \\phi}{\\partial t^2} - c^2 \\nabla^2 \\phi = \\frac{c^2}{\\varepsilon_0} \\rho$ and $\\frac{\\partial^2 A}{\\partial t^2} - c^2 \\nabla^2 A = \\frac{1}{\\varepsilon_0} J$.\n- The continuity equation is $\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot \\mathbf{J} = 0$.\n\nWork entirely in nondimensionalized units by setting $c = 1$, $\\varepsilon_0 = 1$, and $\\mu_0 = 1$. In these units, all quantities are dimensionless, and your outputs must be dimensionless floating-point numbers.\n\nDiscretize the one-dimensional spatial domain of length $L$ using $N$ equally spaced points with grid spacing $\\Delta x = L/N$ and periodic boundary conditions. Use a second-order central finite-difference scheme in space and time. Let $t_n = n \\Delta t$ denote the discrete times. Let $f_i^n$ denote the value of a field $f$ at grid point $x_i$ and time $t_n$. Define the following discrete operators:\n- Discrete central spatial derivative (discrete divergence in one dimension) for a field $u$:\n$$\n\\left(\\nabla_h \\cdot u\\right)_i^n = \\frac{u_{i+1}^n - u_{i-1}^n}{2 \\Delta x}.\n$$\n- Discrete Laplacian:\n$$\n\\left(\\nabla_h^2 f\\right)_i^n = \\frac{f_{i+1}^n - 2 f_i^n + f_{i-1}^n}{\\Delta x^2}.\n$$\n- Discrete centered time derivative:\n$$\n\\left(\\delta_t f\\right)_i^n = \\frac{f_i^{n+1} - f_i^{n-1}}{2 \\Delta t}.\n$$\n- Discrete second-order time difference:\n$$\n\\left(\\delta_{tt} f\\right)_i^n = \\frac{f_i^{n+1} - 2 f_i^n + f_i^{n-1}}{\\Delta t^2}.\n$$\n\nImplement the explicit time-marching updates for the potentials under the Lorenz gauge in nondimensional units:\n$$\n\\phi_i^{n+1} = 2 \\phi_i^n - \\phi_i^{n-1} + \\Delta t^2 \\left( \\left(\\nabla_h^2 \\phi\\right)_i^n + \\rho_i^n \\right),\n$$\n$$\nA_i^{n+1} = 2 A_i^n - A_i^{n-1} + \\Delta t^2 \\left( \\left(\\nabla_h^2 A\\right)_i^n + J_i^n \\right).\n$$\nInitialize $\\phi_i^0 = 0$, $\\phi_i^1 = 0$, $A_i^0 = 0$, and $A_i^1 = 0$ for all $i$.\n\nDesign and implement the following discrete diagnostics:\n- The discrete gauge residual at time $n$:\n$$\ng_i^n = \\left(\\nabla_h \\cdot A\\right)_i^n + \\left(\\delta_t \\phi \\right)_i^n.\n$$\n- The discrete continuity residual at time $n$:\n$$\nr_i^n = \\left(\\delta_t \\rho \\right)_i^n + \\left(\\nabla_h \\cdot J\\right)_i^n.\n$$\nDefine the spatial discrete $L^2$ norm at time $n$ for a field $q$ as\n$$\n\\| q^n \\|_{2,h} = \\sqrt{ \\Delta x \\sum_{i=0}^{N-1} \\left(q_i^n\\right)^2 }.\n$$\n\nThe relationship to be examined is that the discrete Lorenz gauge residual $g_i^n$ is driven by the discrete continuity residual $r_i^n$ under the wave-equation updates for $\\phi$ and $A$. Your program should compute the $L^2$ norm of the gauge residual at the final diagnostic time and report it for each test case. To focus the diagnostic on centered differences, evaluate the residual using the definition of $\\left(\\delta_t \\cdot \\right)^n$ at time index $n = T - 2$, where $T$ is the total number of time steps, so that all required time levels exist.\n\nTo construct source terms in cases intended to satisfy the discrete continuity equation, compute $J_i^n$ from a given $\\rho_i^n$ by enforcing\n$$\n\\left(\\nabla_h \\cdot J\\right)_i^n = - \\left(\\delta_t \\rho \\right)_i^n\n$$\nusing a periodic discrete Fourier transform and the discrete central derivative symbol. Let $k_m = \\frac{2\\pi m}{L}$ for $m = 0, 1, \\dots, N-1$ denote the discrete wavenumbers, and let the central difference derivative symbol be $\\sigma(k_m) = \\frac{\\sin(k_m \\Delta x)}{\\Delta x}$. In Fourier space, set $\\widehat{J}(k_m)^n = - \\widehat{s}(k_m)^n / (i \\, \\sigma(k_m))$ for modes with $\\sigma(k_m) \\neq 0$, and set $\\widehat{J}(k_m)^n = 0$ for modes with $\\sigma(k_m) = 0$, where $s_i^n = \\left(\\delta_t \\rho \\right)_i^n$ and hats denote the discrete Fourier transform. Transform back to real space to obtain $J_i^n$.\n\nImplement the following test suite, where $N$ is the number of grid points, $L$ is the domain length, $\\Delta t$ is the time step, $T$ is the total number of time steps, $k$ is the spatial frequency, and $\\Omega$ is the temporal angular frequency in the charge density. All quantities are dimensionless. For all cases, use periodic boundary conditions, and report the discrete $L^2$ norm of the gauge residual at time $n = T - 2$.\n\n- Case 1 (consistency, stable Courant number): $N = 128$, $L = 1.0$, $\\Delta t = 0.8 \\Delta x$, $T = 50$, $k = 2 \\pi$ (one spatial period over the domain), $\\Omega = 1.5$. Define $\\rho_i^n = \\sin(k x_i) \\cos(\\Omega t_n)$ and compute $J_i^n$ by enforcing the discrete continuity equation using the spectral method described above.\n- Case 2 (violate continuity): Same parameters as Case 1, but set $J_i^n = 0$ for all $i,n$ while keeping $\\rho_i^n$ unchanged.\n- Case 3 (zero sources): $N = 128$, $L = 1.0$, $\\Delta t = 0.8 \\Delta x$, $T = 50$. Set $\\rho_i^n = 0$ and $J_i^n = 0$ for all $i,n$.\n- Case 4 (near Courant limit, consistency): $N = 128$, $L = 1.0$, $\\Delta t = 0.99 \\Delta x$, $T = 50$, $k = 4 \\pi$ (two spatial periods over the domain), $\\Omega = 2.0$. Define $\\rho_i^n = \\sin(k x_i) \\cos(\\Omega t_n)$ and compute $J_i^n$ by enforcing the discrete continuity equation using the spectral method described above.\n\nYour program must:\n- Implement the updates for $\\phi$ and $A$ over $n = 1, 2, \\dots, T-2$ and compute the gauge residual $g_i^{T-2}$ at the end.\n- Compute and report the spatial discrete $L^2$ norm $\\| g^{T-2} \\|_{2,h}$ for each case.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, \"[result1,result2,result3,result4]\". Each result must be a floating-point number representing the discrete $L^2$ norm of the gauge residual at time $n = T - 2$ for the corresponding test case. All outputs must be dimensionless real numbers. You must not print any additional text.\n\nYou must implement your solution using the Finite-Difference Time-Domain (FDTD) method in nondimensional units, adhering strictly to the specified discretizations and test suite.", "solution": "The problem requires the design and implementation of a numerical diagnostic to investigate the relationship between the Lorenz gauge condition and the charge continuity equation within a second-order finite-difference time-domain (FDTD) scheme. The problem is set in one spatial dimension with periodic boundary conditions and uses nondimensionalized units where the speed of light $c=1$, the vacuum permittivity $\\varepsilon_0=1$, and the vacuum permeability $\\mu_0=1$.\n\nThe fundamental physical laws governing the system are Maxwell's equations. In terms of the magnetic vector potential $\\mathbf{A}$ and the electric scalar potential $\\phi$, the electric and magnetic fields are $\\mathbf{E} = -\\nabla \\phi - \\partial \\mathbf{A} / \\partial t$ and $\\mathbf{B} = \\nabla \\times \\mathbf{A}$, respectively. The dynamics of the potentials are governed by the inhomogeneous wave equations that arise when the Lorenz gauge condition, $\\nabla \\cdot \\mathbf{A} + \\frac{1}{c^2} \\frac{\\partial \\phi}{\\partial t} = 0$, is imposed. In the specified nondimensional units, these equations are:\n$$\n\\frac{\\partial^2 \\phi}{\\partial t^2} - \\nabla^2 \\phi = \\rho\n$$\n$$\n\\frac{\\partial^2 A}{\\partial t^2} - \\nabla^2 A = J\n$$\nwhere $\\rho$ is the charge density and $J$ is the current density. These sources must satisfy the continuity equation, $\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot J = 0$.\n\nThe numerical solution is constructed on a uniform one-dimensional grid of $N$ points over a domain of length $L$, with spatial step $\\Delta x = L/N$ and time step $\\Delta t$. A function $f(x,t)$ is discretized as $f_i^n = f(x_i, t_n)$, where $x_i = i \\Delta x$ and $t_n = n \\Delta t$. The problem specifies second-order central finite-difference operators for spatial and temporal derivatives:\n- Discrete divergence: $\\left(\\nabla_h \\cdot u\\right)_i^n = \\frac{u_{i+1}^n - u_{i-1}^n}{2 \\Delta x}$\n- Discrete Laplacian: $\\left(\\nabla_h^2 f\\right)_i^n = \\frac{f_{i+1}^n - 2 f_i^n + f_{i-1}^n}{\\Delta x^2}$\n- Discrete time derivative: $\\left(\\delta_t f\\right)_i^n = \\frac{f_i^{n+1} - f_i^{n-1}}{2 \\Delta t}$\n- Discrete second-order time derivative: $\\left(\\delta_{tt} f\\right)_i^n = \\frac{f_i^{n+1} - 2 f_i^n + f_i^{n-1}}{\\Delta t^2}$\n\nUsing these operators, the continuous wave equations are discretized to yield explicit time-marching update rules (a leapfrog scheme):\n$$\n\\phi_i^{n+1} = 2 \\phi_i^n - \\phi_i^{n-1} + \\Delta t^2 \\left( \\left(\\nabla_h^2 \\phi\\right)_i^n + \\rho_i^n \\right)\n$$\n$$\nA_i^{n+1} = 2 A_i^n - A_i^{n-1} + \\Delta t^2 \\left( \\left(\\nabla_h^2 A\\right)_i^n + J_i^n \\right)\n$$\nThese updates, which form the core of the FDTD simulation, are applied for time steps $n=1, 2, \\dots, T-2$, starting from the initial conditions $\\phi_i^0 = \\phi_i^1 = 0$ and $A_i^0 = A_i^1 = 0$.\n\nThe central task is to analyze the discrete Lorenz gauge condition. The discrete gauge residual is defined as $g_i^n = \\left(\\nabla_h \\cdot A\\right)_i^n + \\left(\\delta_t \\phi \\right)_i^n$. Similarly, the discrete continuity residual is $r_i^n = \\left(\\delta_t \\rho \\right)_i^n + \\left(\\nabla_h \\cdot J\\right)_i^n$. A key property of this numerical scheme is that the gauge residual is driven by the continuity residual. To see this, we can apply the discrete wave operator $(\\delta_{tt} - \\nabla_h^2)$ to the gauge residual $g^n$, assuming the discrete operators commute:\n$$\n(\\delta_{tt} - \\nabla_h^2) g^n = (\\delta_{tt} - \\nabla_h^2) (\\nabla_h \\cdot A^n + \\delta_t \\phi^n)\n= \\nabla_h \\cdot ((\\delta_{tt} - \\nabla_h^2) A^n) + \\delta_t ((\\delta_{tt} - \\nabla_h^2) \\phi^n)\n$$\nSubstituting the FDTD update rules, which can be written as $(\\delta_{tt} - \\nabla_h^2) \\phi^n = \\rho^n$ and $(\\delta_{tt} - \\nabla_h^2) A^n = J^n$, we get:\n$$\n(\\delta_{tt} - \\nabla_h^2) g^n = \\nabla_h \\cdot (J^n) + \\delta_t (\\rho^n) = (\\nabla_h \\cdot J^n + \\delta_t \\rho^n) = r^n\n$$\nThis result, $(\\delta_{tt} - \\nabla_h^2) g^n = r^n$, is a discrete wave equation for the gauge residual $g^n$, sourced by the continuity residual $r^n$. This implies that if the discrete continuity equation is satisfied (i.e., $r^n=0$), the gauge residual will satisfy the homogeneous wave equation. With appropriate initial conditions, it should remain small (ideally zero, up to floating-point precision). If the discrete continuity equation is violated ($r^n \\neq 0$), the gauge residual is expected to grow.\n\nThe implementation will test this relationship. For test cases requiring the discrete continuity equation to be satisfied, the current density $J_i^n$ is constructed from the given charge density $\\rho_i^n$. The condition to enforce is $(\\nabla_h \\cdot J)_i^n = - (\\delta_t \\rho)_i^n$. This is achieved algorithmically using the discrete Fourier transform (DFT). Let $s_i^n = (\\delta_t \\rho)_i^n$. The equation in Fourier space becomes $i \\sigma(k_m) \\widehat{J}(k_m)^n = -\\widehat{s}(k_m)^n$, where $\\widehat{\\cdot}$ denotes the DFT, $k_m$ are the discrete wavenumbers, and $\\sigma(k_m) = \\frac{\\sin(k_m \\Delta x)}{\\Delta x}$ is the spectral symbol for the central difference operator $\\nabla_h$. Solving for $\\widehat{J}(k_m)^n$ gives:\n$$\n\\widehat{J}(k_m)^n = - \\frac{\\widehat{s}(k_m)^n}{i \\sigma(k_m)}\n$$\nThis division is performed for all modes where $\\sigma(k_m) \\neq 0$. For the modes where $\\sigma(k_m) = 0$ (the DC mode $m=0$ and the Nyquist mode $m=N/2$ if $N$ is even), $\\widehat{J}(k_m)^n$ is set to $0$. The current density $J_i^n$ in real space is then recovered via an inverse DFT.\n\nThe overall algorithm is as follows:\n1. For each test case, set up the spatial grid, time step, and source terms $\\rho_i^n$ for all required times.\n2. If required by the test case, compute the current density $J_i^n$ for $n \\in [1, T-2]$ using the spectral method described above to ensure the discrete continuity equation $r_i^n=0$ is satisfied. Otherwise, set $J_i^n$ as specified (e.g., to zero).\n3. Initialize the potential fields $\\phi$ and $A$ to zero for time steps $n=0$ and $n=1$.\n4. Execute the FDTD time-marching loop from $n=1$ to $n=T-2$, updating $\\phi_i^{n+1}$ and $A_i^{n+1}$ using the leapfrog scheme. Periodic boundary conditions are handled by using circular shifts for spatial Laplacians.\n5. After the loop, at the final diagnostic time $n_{diag} = T-2$, compute the gauge residual $g_i^{n_{diag}} = (\\nabla_h \\cdot A)_i^{n_{diag}} + (\\delta_t \\phi)_i^{n_{diag}}$. This requires field values at times $T-1$, $T-2$, and $T-3$, all of which are available.\n6. Compute the final diagnostic quantity, the discrete spatial $L^2$ norm of the gauge residual, $\\| g^{T-2} \\|_{2,h} = \\sqrt{ \\Delta x \\sum_{i=0}^{N-1} (g_i^{T-2})^2 }$.\n\nThis procedure is applied to each of the four test cases, and the resulting $L^2$ norms are reported. Case 3, with zero sources and zero initial conditions, will result in zero potentials and thus a zero gauge residual, serving as a baseline. Cases 1 and 4 enforce continuity, so they are expected to yield very small residuals. Case 2 explicitly violates continuity, which should lead to a significantly larger, non-zero gauge residual.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(N, L, cfl_factor, T, k, Omega, use_spectral_J):\n    \"\"\"\n    Runs a single FDTD simulation for the given parameters.\n    \"\"\"\n    # 1. Grid and parameter setup\n    dx = L / N\n    dt = cfl_factor * dx\n    x = np.arange(N) * dx\n    t = np.arange(T) * dt\n\n    # 2. Source term generation\n    xx, tt = np.meshgrid(x, t)\n    rho = np.zeros((T, N))\n    J = np.zeros((T, N))\n\n    if k is not None and Omega is not None:\n        rho = np.sin(k * xx) * np.cos(Omega * tt)\n\n    if use_spectral_J:\n        # Enforce discrete continuity equation r=0 using spectral method\n        s = np.zeros_like(rho)\n        # Compute s = delta_t(rho) for n=1,...,T-2\n        for n in range(1, T - 1):\n            s[n, :] = (rho[n + 1, :] - rho[n - 1, :]) / (2 * dt)\n\n        # Wavenumbers and discrete derivative symbol\n        k_m = 2 * np.pi * np.fft.fftfreq(N, d=dx)\n        sigma = np.sin(k_m * dx) / dx\n        \n        # Denominator for Fourier-space division\n        den = 1j * sigma\n        zero_modes = np.abs(sigma) < 1e-15\n        # Avoid division by zero warning, these modes are handled separately\n        den[zero_modes] = 1.0 \n\n        for n in range(1, T - 1):\n            s_hat = np.fft.fft(s[n, :])\n            # J_hat = - s_hat / (i * sigma)\n            J_hat = -s_hat / den\n            J_hat[zero_modes] = 0.0\n            J[n, :] = np.fft.ifft(J_hat).real\n\n    # 3. Initialization of potentials\n    # phi^0 = 0, phi^1 = 0. A^0 = 0, A^1 = 0\n    phi = np.zeros((T, N))\n    A = np.zeros((T, N))\n\n    # 4. FDTD time-marching loop\n    for n in range(1, T - 1):\n        # Get fields at time n\n        phi_n = phi[n, :]\n        A_n = A[n, :]\n\n        # Compute discrete Laplacians with periodic boundaries\n        phi_lap = (np.roll(phi_n, -1) - 2 * phi_n + np.roll(phi_n, 1)) / dx**2\n        A_lap = (np.roll(A_n, -1) - 2 * A_n + np.roll(A_n, 1)) / dx**2\n\n        # Update fields to time n+1\n        phi[n + 1, :] = 2 * phi_n - phi[n - 1, :] + dt**2 * (phi_lap + rho[n, :])\n        A[n + 1, :] = 2 * A_n - A[n - 1, :] + dt**2 * (A_lap + J[n, :])\n\n    # 5. Diagnostic calculation at n = T-2\n    n_diag = T - 2\n    \n    # Discrete divergence of A\n    div_A_diag = (np.roll(A[n_diag, :], -1) - np.roll(A[n_diag, :], 1)) / (2 * dx)\n    \n    # Discrete time derivative of phi\n    dt_phi_diag = (phi[n_diag + 1, :] - phi[n_diag - 1, :]) / (2 * dt)\n\n    # Gauge residual g = div(A) + dt(phi)\n    g = div_A_diag + dt_phi_diag\n\n    # 6. Compute L2 norm of the gauge residual\n    g_norm = np.sqrt(dx * np.sum(g**2))\n    \n    return g_norm\n\ndef solve():\n    \"\"\"\n    Defines and runs the test suite, then prints the results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (consistency, stable Courant number)\n        {'N': 128, 'L': 1.0, 'cfl_factor': 0.8, 'T': 50, 'k': 2 * np.pi, 'Omega': 1.5, 'use_spectral_J': True},\n        # Case 2 (violate continuity)\n        {'N': 128, 'L': 1.0, 'cfl_factor': 0.8, 'T': 50, 'k': 2 * np.pi, 'Omega': 1.5, 'use_spectral_J': False},\n        # Case 3 (zero sources)\n        {'N': 128, 'L': 1.0, 'cfl_factor': 0.8, 'T': 50, 'k': None, 'Omega': None, 'use_spectral_J': False},\n        # Case 4 (near Courant limit, consistency)\n        {'N': 128, 'L': 1.0, 'cfl_factor': 0.99, 'T': 50, 'k': 4 * np.pi, 'Omega': 2.0, 'use_spectral_J': True},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(\n            N=case['N'],\n            L=case['L'],\n            cfl_factor=case['cfl_factor'],\n            T=case['T'],\n            k=case['k'],\n            Omega=case['Omega'],\n            use_spectral_J=case['use_spectral_J']\n        )\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3310124"}, {"introduction": "While gauge freedom often appears as a choice of convenience, certain physical phenomena reveal it to be a deep necessity for a consistent description of nature. The magnetic monopole, a hypothetical particle carrying a fundamental magnetic charge, is the canonical example. Any attempt to describe its radial magnetic field with a single, globally defined vector potential inevitably fails, resulting in an unphysical singularity known as a Dirac string. This advanced practice guides you through the modern solution to this topological puzzle: covering the space with multiple, overlapping \"gauge patches.\" You will construct distinct vector potentials that are regular on their respective patches and verify that they are smoothly stitched together in the overlap region by a gauge transformation, demonstrating a powerful technique at the heart of modern gauge theory and computational physics. [@problem_id:3310180]", "problem": "You are to implement, analyze, and verify a two-patch gauge representation of a Dirac magnetic monopole on the unit sphere, as used in Computational Electromagnetics (CEM). Begin from fundamental principles without relying on any pre-specified potential formula. The foundations you may use are: magnetostatics with magnetic field $\\mathbf{B}$ defined by a magnetic vector potential $\\mathbf{A}$ via $\\mathbf{B} = \\nabla \\times \\mathbf{A}$, the divergence condition for a monopole with magnetic charge $g$ implying $\\nabla \\cdot \\mathbf{B} = 4 \\pi g \\, \\delta^{3}(\\mathbf{r})$, and the requirement that physical fields are globally well-defined while potentials may be defined patchwise and differ by gauge transformations of the form $\\mathbf{A}' = \\mathbf{A} + \\nabla \\chi$. The geometry is the unit sphere $S^{2}$ embedded in three-dimensional Euclidean space, with spherical angles $\\theta \\in [0,\\pi]$ and $\\phi \\in [0, 2\\pi)$ specified in radians. You must use radians for all angles. All quantities are dimensionless and no physical units are used.\n\nYou will work with two overlapping gauge patches that cover $S^{2}$, such that each patch excludes one of the polar axes, which serve as Dirac strings. Denote by $\\mathcal{U}_{N}$ the patch that excludes the south polar axis (string on the negative $z$-axis), and by $\\mathcal{U}_{S}$ the patch that excludes the north polar axis (string on the positive $z$-axis). On each patch, define a vector potential $\\mathbf{A}_{N}$ and $\\mathbf{A}_{S}$ that are smooth on their respective patches and give rise to the same magnetic field $\\mathbf{B}$ away from the strings and the monopole at the origin. On the overlap $\\mathcal{U}_{N}\\cap \\mathcal{U}_{S}$, the two potentials must differ by a pure gauge, that is, there must exist a scalar function $\\chi$ such that $\\mathbf{A}_{N} - \\mathbf{A}_{S} = \\nabla \\chi$ on the overlap.\n\nYour program must implement the following, following a derivation and algorithmic design that starts from the above principles:\n\n1. Derive explicit expressions for the patchwise vector potentials $\\mathbf{A}_{N}$ on $\\mathcal{U}_{N}$ and $\\mathbf{A}_{S}$ on $\\mathcal{U}_{S}$, as well as a scalar gauge function $\\chi$ such that $\\mathbf{A}_{N} - \\mathbf{A}_{S} = \\nabla \\chi$ on the overlap. Restrict attention to potentials that depend only on $\\theta$ (no explicit $\\phi$ dependence) and that are purely azimuthal when expressed in the spherical basis $\\{\\hat{\\mathbf{e}}_{r}, \\hat{\\mathbf{e}}_{\\theta}, \\hat{\\mathbf{e}}_{\\phi}\\}$, i.e., take the form $\\mathbf{A} = A_{\\phi}(\\theta) \\, \\hat{\\mathbf{e}}_{\\phi}$ on $r = 1$. Ensure each potential is regular on its own patch and singular only on its designated string.\n\n2. Using a discrete grid on the unit sphere with angles $\\theta \\in [\\theta_{\\min}, \\pi - \\theta_{\\min}]$ and $\\phi \\in [0, 2\\pi)$, with uniform spacings $\\Delta \\theta$ and $\\Delta \\phi$, numerically verify the gauge consistency condition on the overlap: compute the maximum absolute mismatch between the $\\phi$-components of $\\mathbf{A}_{N} - \\mathbf{A}_{S}$ and those of $\\nabla \\chi$ across the grid. Exclude the strings by choosing a positive buffer $\\theta_{\\min}$. You must report this maximum mismatch as a single floating-point number.\n\n3. Numerically approximate the magnetic field $\\mathbf{B}$ from $\\mathbf{A}_{N}$ using a finite-difference discretization appropriate to an azimuthal potential in spherical coordinates and compute the maximum absolute error between the computed radial component $B_{r}^{\\mathrm{num}}(\\theta)$ and the exact radial component $B_{r}^{\\mathrm{exact}}(\\theta)$ implied by the divergence law for a monopole of charge $g$ and the fact that $\\mathbf{B}$ is radial and depends only on $r$. Restrict this computation to the same string-excluded band $\\theta \\in [\\theta_{\\min}, \\pi - \\theta_{\\min}]$ and use uniform $\\theta$-spacing. For the numerical curl, use a centered finite difference in $\\theta$ on interior points and restrict attention to the radial component $B_{r}(\\theta)$ because of the assumed azimuthal form of $\\mathbf{A}$. Report the maximum absolute error for several grid sizes to examine convergence.\n\n4. Include a boundary case with $g = 0$ to validate that your implementation yields a vanishing field and zero error in the numerical curl discretization.\n\nGrid design and angle conventions:\n- Use the unit sphere $r = 1$, so all computations are on $r = 1$.\n- All angles $\\theta$ and $\\phi$ must be in radians.\n- Choose a string-exclusion buffer $\\theta_{\\min} > 0$ to avoid the singular axes $\\theta = 0$ and $\\theta = \\pi$.\n- Use uniform grids in $\\theta$; no specific constraint exists on $\\phi$ for the curl computation under the azimuthal assumption.\n\nTest suite specification:\n- Test case $\\#1$ (gauge overlap consistency): magnetic charge $g = 1.0$, buffer $\\theta_{\\min} = 0.05$ radians, $\\theta$-grid with $N_{\\theta} = 181$ points uniformly spanning $[\\theta_{\\min}, \\pi - \\theta_{\\min}]$, and $\\phi$-grid with $N_{\\phi} = 360$ points uniformly spanning $[0, 2\\pi)$. Output the maximum absolute mismatch between the $\\phi$-component of $\\mathbf{A}_{N} - \\mathbf{A}_{S}$ and that of $\\nabla \\chi$ over the grid as a single float.\n- Test cases $\\#2$ to $\\#4$ (curl convergence): magnetic charge $g = 1.0$, buffer $\\theta_{\\min} = 0.05$ radians, and $\\theta$-grid sizes $N_{\\theta} \\in \\{33, 65, 129\\}$, each uniformly spanning $[\\theta_{\\min}, \\pi - \\theta_{\\min}]$. For each $N_{\\theta}$, compute the maximum absolute error $\\max_{\\theta}$ of the radial curl component compared to the exact value implied by the divergence law on $r = 1$ and report each error as a separate float.\n- Test case $\\#5$ (boundary case): magnetic charge $g = 0.0$, buffer $\\theta_{\\min} = 0.05$ radians, $\\theta$-grid with $N_{\\theta} = 65$. Compute and report the maximum absolute error in the radial curl component. This should ideally be zero.\n\nFinal output format:\n- Your program must produce a single line of output containing the results for the five test cases as a comma-separated list of floats enclosed in square brackets, in the order: $[\\text{gauge\\_mismatch}, \\text{curl\\_err}_{33}, \\text{curl\\_err}_{65}, \\text{curl\\_err}_{129}, \\text{curl\\_err}_{g=0}]$.\n- No other text should be printed.\n\nAngle units:\n- All angles must be in radians.\n\nPhysical units:\n- All quantities are dimensionless; no physical units are used.\n\nYour program must be self-contained, require no user input, and follow the specified runtime environment constraints.", "solution": "This problem requires the derivation and numerical verification of the two-patch gauge potential representation for a Dirac magnetic monopole on the unit sphere. The solution is presented in three parts: first, the derivation of the magnetic field and the patchwise vector potentials from fundamental principles; second, the derivation of the gauge transformation relating the potentials on their overlap; and third, the design of the numerical algorithms to verify these theoretical constructs.\n\n### 1. Derivation of the Magnetic Field and Vector Potentials\n\nThe starting point is the fundamental equation for the magnetic field $\\mathbf{B}$ of a static magnetic monopole with charge $g$ located at the origin $\\mathbf{r}=\\mathbf{0}$:\n$$ \\nabla \\cdot \\mathbf{B} = 4 \\pi g \\, \\delta^{3}(\\mathbf{r}) $$\nwhere $\\delta^{3}(\\mathbf{r})$ is the three-dimensional Dirac delta function. By analogy with Gauss's law in electrostatics, this equation is solved by a purely radial field that falls off as $1/r^2$:\n$$ \\mathbf{B}(\\mathbf{r}) = g \\frac{\\hat{\\mathbf{e}}_{r}}{r^2} $$\nHere, $\\hat{\\mathbf{e}}_{r}$ is the unit vector in the radial direction. On the unit sphere where $r=1$, this field simplifies to a constant radial field, $\\mathbf{B} = g\\hat{\\mathbf{e}}_{r}$. The radial component is thus $B_{r}^{\\mathrm{exact}} = g$ for all angles $(\\theta, \\phi)$.\n\nNext, we seek a magnetic vector potential $\\mathbf{A}$ such that $\\mathbf{B} = \\nabla \\times \\mathbf{A}$. The problem specifies looking for a solution that is purely azimuthal and depends only on $\\theta$ (in addition to $r$), of the form $\\mathbf{A} = A_{\\phi}(r, \\theta) \\hat{\\mathbf{e}}_{\\phi}$. The curl in spherical coordinates for such a potential simplifies to:\n$$ \\nabla \\times \\mathbf{A} = \\frac{1}{r \\sin\\theta} \\frac{\\partial}{\\partial\\theta}(\\sin\\theta A_{\\phi}) \\hat{\\mathbf{e}}_{r} - \\frac{1}{r} \\frac{\\partial}{\\partial r}(r A_{\\phi}) \\hat{\\mathbf{e}}_{\\theta} $$\nTo match the purely radial magnetic field $\\mathbf{B} = (g/r^2) \\hat{\\mathbf{e}}_{r}$, the $\\hat{\\mathbf{e}}_{\\theta}$ component of the curl must vanish, which implies $\\frac{\\partial}{\\partial r}(r A_{\\phi}) = 0$. This means $r A_{\\phi}$ is a function of $\\theta$ only, so $A_{\\phi}(r, \\theta) = f(\\theta)/r$ for some function $f(\\theta)$. Equating the radial components gives:\n$$ \\frac{1}{r \\sin\\theta} \\frac{\\partial}{\\partial\\theta}\\left(\\sin\\theta \\frac{f(\\theta)}{r}\\right) = \\frac{g}{r^2} $$\nMultiplying by $r^2 \\sin\\theta$ yields a differential equation for $f(\\theta)$:\n$$ \\frac{d}{d\\theta}(f(\\theta) \\sin\\theta) = g \\sin\\theta $$\nIntegrating with respect to $\\theta$ gives $f(\\theta)\\sin\\theta = -g\\cos\\theta + C$, where $C$ is an integration constant. Thus, the general form of the potential is:\n$$ A_{\\phi}(r, \\theta) = \\frac{1}{r} \\frac{C - g\\cos\\theta}{\\sin\\theta} $$\nThis potential is singular at the poles $\\theta=0$ and $\\theta=\\pi$ where $\\sin\\theta=0$. To construct a physically meaningful theory, we define the potential on two overlapping patches, each excluding one of the poles. The choice of the constant $C$ determines which pole is regular.\n\n**Potential $\\mathbf{A}_{N}$ on Patch $\\mathcal{U}_{N}$ (North-regular):**\nThe patch $\\mathcal{U}_{N}$ includes the north pole ($\\theta=0$) but excludes the south pole ($\\theta=\\pi$). For $A_{\\phi}$ to be regular at $\\theta=0$, the numerator must vanish as $\\theta \\to 0$. Since $\\cos\\theta \\to 1$ as $\\theta \\to 0$, we must have $C-g=0$, so $C=g$. The potential on $\\mathcal{U}_{N}$ is therefore:\n$$ (A_{N})_{\\phi}(r, \\theta) = \\frac{g(1 - \\cos\\theta)}{r \\sin\\theta} $$\nThis expression is regular at $\\theta=0$ but singular at $\\theta=\\pi$.\n\n**Potential $\\mathbf{A}_{S}$ on Patch $\\mathcal{U}_{S}$ (South-regular):**\nThe patch $\\mathcal{U}_{S}$ includes the south pole ($\\theta=\\pi$) but excludes the north pole ($\\theta=0$). For $A_{\\phi}$ to be regular at $\\theta=\\pi$, the numerator must vanish as $\\theta \\to \\pi$. Since $\\cos\\theta \\to -1$ as $\\theta \\to \\pi$, we must have $C-g(-1)=0$, so $C=-g$. The potential on $\\mathcal{U}_{S}$ is:\n$$ (A_{S})_{\\phi}(r, \\theta) = \\frac{-g(1 + \\cos\\theta)}{r \\sin\\theta} $$\nThis expression is regular at $\\theta=\\pi$ but singular at $\\theta=0$.\n\nFor all subsequent numerical computations on the unit sphere, we set $r=1$.\n\n### 2. Gauge Transformation on the Overlap Region\n\nOn the overlap region $\\mathcal{U}_{N} \\cap \\mathcal{U}_{S}$, which is the sphere excluding both poles, the two potentials must be related by a gauge transformation, $\\mathbf{A}_{N} - \\mathbf{A}_{S} = \\nabla\\chi$, for some scalar gauge function $\\chi$. We compute the difference of the two potentials on the unit sphere ($r=1$):\n$$ (A_{N})_{\\phi} - (A_{S})_{\\phi} = g \\frac{1 - \\cos\\theta}{\\sin\\theta} - \\left(-g \\frac{1 + \\cos\\theta}{\\sin\\theta}\\right) = \\frac{g(1 - \\cos\\theta + 1 + \\cos\\theta)}{\\sin\\theta} = \\frac{2g}{\\sin\\theta} $$\nThe difference vector is $\\mathbf{A}_{N} - \\mathbf{A}_{S} = \\frac{2g}{\\sin\\theta} \\hat{\\mathbf{e}}_{\\phi}$. We now seek $\\chi$ such that $\\nabla\\chi$ equals this vector. The gradient in spherical coordinates is $\\nabla\\chi = \\frac{\\partial\\chi}{\\partial r}\\hat{\\mathbf{e}}_{r} + \\frac{1}{r}\\frac{\\partial\\chi}{\\partial\\theta}\\hat{\\mathbf{e}}_{\\theta} + \\frac{1}{r\\sin\\theta}\\frac{\\partial\\chi}{\\partial\\phi}\\hat{\\mathbf{e}}_{\\phi}$. Matching components gives:\n$$ \\frac{\\partial\\chi}{\\partial r} = 0, \\quad \\frac{\\partial\\chi}{\\partial\\theta} = 0, \\quad \\frac{1}{r\\sin\\theta}\\frac{\\partial\\chi}{\\partial\\phi} = \\frac{2g}{r\\sin\\theta} $$\nThe first two equations imply $\\chi$ is a function of $\\phi$ only. The third equation becomes $\\frac{d\\chi}{d\\phi} = 2g$. Integrating yields the gauge function:\n$$ \\chi(\\phi) = 2g\\phi $$\n(The integration constant is taken to be zero without loss of generality). The $\\phi$-component of the gradient of $\\chi$ on the unit sphere is $(\\nabla\\chi)_{\\phi} = \\frac{1}{\\sin\\theta}\\frac{\\partial(2g\\phi)}{\\partial\\phi} = \\frac{2g}{\\sin\\theta}$. This perfectly matches the difference $(A_{N})_{\\phi} - (A_{S})_{\\phi}$.\n\n### 3. Numerical Verification Algorithms\n\n**Gauge Consistency Verification:**\nThe first numerical task is to verify that the difference $(A_{N})_{\\phi} - (A_{S})_{\\phi}$ matches $(\\nabla\\chi)_{\\phi}$ on a discrete grid. The grid spans $\\theta \\in [\\theta_{\\min}, \\pi - \\theta_{\\min}]$ and $\\phi \\in [0, 2\\pi)$. Since all quantities involved, $(A_N)_\\phi$, $(A_S)_\\phi$, and $(\\nabla\\chi)_\\phi$, depend only on $\\theta$, the verification can be performed on the 1D $\\theta$-grid.\n1. Define a uniform grid of $N_{\\theta}$ points for $\\theta$ from $\\theta_{\\min}$ to $\\pi - \\theta_{\\min}$.\n2. Compute the vector $(A_{N})_{\\phi}$ for each $\\theta$ on the grid using the derived formula.\n3. Compute the vector $(A_{S})_{\\phi}$ for each $\\theta$ on the grid.\n4. Calculate the difference vector, $\\mathbf{D}_{\\mathbf{A}} = (A_{N})_{\\phi} - (A_{S})_{\\phi}$.\n5. Calculate the vector for the gradient component, $\\mathbf{G}_{\\chi} = (\\nabla\\chi)_{\\phi} = 2g/\\sin\\theta$.\n6. Compute the absolute mismatch at each grid point, $|D_{\\mathbf{A}, i} - G_{\\chi, i}|$.\n7. The result is the maximum value of this mismatch over the grid. In exact arithmetic, this mismatch is zero. Numerically, it will be a small value on the order of machine precision.\n\n**Curl Calculation and Error Analysis:**\nThe second task is to compute the radial component of $\\mathbf{B} = \\nabla\\times \\mathbf{A}_{N}$ numerically and compare it to the exact value $B_r^{\\mathrm{exact}} = g$. The radial component is given by $B_r = \\frac{1}{r\\sin\\theta} \\frac{\\partial}{\\partial\\theta}(\\sin\\theta A_{\\phi})$. On the unit sphere $r=1$, we evaluate $B_{r} = \\frac{1}{\\sin\\theta} \\frac{d}{d\\theta}(\\sin\\theta (A_{N})_{\\phi})$.\n1. Define a uniform grid of $N_{\\theta}$ points for $\\theta \\in [\\theta_{\\min}, \\pi - \\theta_{\\min}]$ with spacing $\\Delta\\theta$.\n2. Compute $(A_{N})_{\\phi}(\\theta)$ at each grid point.\n3. Form the function $F(\\theta) = \\sin\\theta (A_{N})_{\\phi}(\\theta)$. From our derivation, this simplifies to $F(\\theta) = g(1-\\cos\\theta)$.\n4. Approximate the derivative $\\frac{dF}{d\\theta}$ at interior grid points $\\theta_i$ for $i=1, \\dots, N_{\\theta}-2$ using a second-order centered finite difference scheme:\n   $$ \\left.\\frac{dF}{d\\theta}\\right|_{\\theta_i} \\approx \\frac{F(\\theta_{i+1}) - F(\\theta_{i-1})}{2\\Delta\\theta} $$\n5. Calculate the numerical magnetic field component $B_{r}^{\\mathrm{num}}(\\theta_i) = \\frac{1}{\\sin\\theta_i} \\left(\\frac{F_{i+1} - F_{i-1}}{2\\Delta\\theta}\\right)$ for interior points.\n6. Compute the absolute error $|B_{r}^{\\mathrm{num}}(\\theta_i) - g|$ at each interior point.\n7. The result is the maximum of these errors over all interior points. This procedure is repeated for different values of $N_{\\theta}$ to observe convergence. The centered difference scheme is second-order accurate, so the error is expected to decrease quadratically with $\\Delta\\theta$, i.e., as $1/N_{\\theta}^2$. For the boundary case $g=0$, the potential $\\mathbf{A}_N$ is identically zero, leading to a numerically computed field of zero, and thus zero error.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_gauge_consistency(g, theta_min, N_theta, N_phi):\n    \"\"\"\n    Numerically verifies the gauge consistency condition.\n    \n    Computes the maximum absolute mismatch between the phi-components of\n    A_N - A_S and grad(chi) on a spherical grid patch. Note that N_phi is\n    specified by the problem but not needed for the calculation as all\n    quantities are independent of phi.\n    \n    Args:\n        g (float): Magnetic charge.\n        theta_min (float): Buffer angle in radians to exclude poles.\n        N_theta (int): Number of grid points for theta.\n        N_phi (int): Number of grid points for phi.\n        \n    Returns:\n        float: Maximum absolute mismatch.\n    \"\"\"\n    # Create a uniform grid for theta, excluding the poles.\n    theta = np.linspace(theta_min, np.pi - theta_min, N_theta)\n    \n    sin_theta = np.sin(theta)\n    cos_theta = np.cos(theta)\n    \n    # Calculate the phi-component of the vector potentials A_N and A_S on r=1.\n    # A_N is regular at the North Pole (theta=0).\n    # A_S is regular at the South Pole (theta=pi).\n    AN_phi = g * (1 - cos_theta) / sin_theta\n    AS_phi = -g * (1 + cos_theta) / sin_theta\n    \n    # Calculate the difference of the potential components.\n    # In exact arithmetic, this is 2*g / sin_theta.\n    diff_A_phi = AN_phi - AS_phi\n    \n    # Calculate the phi-component of the gradient of the gauge function chi = 2*g*phi.\n    # (grad chi)_phi = (1/sin(theta)) * d/d_phi (2*g*phi) = 2*g / sin_theta.\n    grad_chi_phi = 2 * g / sin_theta\n    \n    # Compute the mismatch. This should be close to machine epsilon.\n    mismatch = np.abs(diff_A_phi - grad_chi_phi)\n    \n    return np.max(mismatch)\n\ndef solve_curl_error(g, theta_min, N_theta):\n    \"\"\"\n    Computes the maximum absolute error in the numerical curl calculation.\n    \n    Args:\n        g (float): Magnetic charge.\n        theta_min (float): Buffer angle in radians to exclude poles.\n        N_theta (int): Number of grid points for theta.\n        \n    Returns:\n        float: Maximum absolute error between numerical and exact B_r.\n    \"\"\"\n    # Create the theta grid.\n    theta = np.linspace(theta_min, np.pi - theta_min, N_theta)\n    delta_theta = theta[1] - theta[0]\n    \n    # Calculate the potential A_N (or A_S, either works on this grid).\n    sin_theta = np.sin(theta)\n    cos_theta = np.cos(theta)\n    \n    A_phi = np.zeros_like(theta)\n    # Only calculate for non-zero g to avoid 0/0. If g=0, A_phi is 0.\n    if g != 0.0:\n        A_phi = g * (1 - cos_theta) / sin_theta\n        \n    # We need to compute the derivative of F(theta) = sin(theta) * A_phi\n    # Analytically, F(theta) = g * (1 - cos(theta))\n    F = sin_theta * A_phi\n    \n    # Use a centered finite difference for interior points of the grid.\n    # This approximates dF/dtheta at theta[1:-1].\n    dF_dtheta_num = (F[2:] - F[:-2]) / (2 * delta_theta)\n    \n    # Corresponding interior theta values.\n    theta_interior = theta[1:-1]\n    \n    # Compute numerical B_r = (1/sin(theta)) * dF/dtheta.\n    B_r_num = (1 / np.sin(theta_interior)) * dF_dtheta_num\n    \n    # The exact value of the radial magnetic field is B_r = g.\n    B_r_exact = g\n    \n    # Compute the maximum absolute error over the interior grid points.\n    error = np.abs(B_r_num - B_r_exact)\n    \n    # If there are no interior points (N_theta < 3), return 0.0.\n    if error.size == 0:\n        return 0.0\n        \n    return np.max(error)\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Test case #1: Gauge overlap consistency\n    g1 = 1.0\n    theta_min1 = 0.05\n    N_theta1 = 181\n    N_phi1 = 360\n    gauge_mismatch = solve_gauge_consistency(g1, theta_min1, N_theta1, N_phi1)\n\n    # Test cases #2 to #4: Curl convergence\n    g2 = 1.0\n    theta_min2 = 0.05\n    N_theta_list_curl = [33, 65, 129]\n    curl_errors = []\n    for N_theta in N_theta_list_curl:\n        err = solve_curl_error(g2, theta_min2, N_theta)\n        curl_errors.append(err)\n    \n    curl_err_33, curl_err_65, curl_err_129 = curl_errors\n\n    # Test case #5: Boundary case g=0\n    g3 = 0.0\n    theta_min3 = 0.05\n    N_theta3 = 65\n    curl_err_g0 = solve_curl_error(g3, theta_min3, N_theta3)\n\n    results = [\n        gauge_mismatch, \n        curl_err_33, \n        curl_err_65, \n        curl_err_129, \n        curl_err_g0\n    ]\n\n    # Print the final result in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3310180"}]}