{"hands_on_practices": [{"introduction": "To analyze wave propagation in periodic structures, we must first master the language used to describe periodicity: the reciprocal lattice. This practice guides you through the fundamental derivation of the reciprocal lattice vectors for a general two-dimensional oblique lattice, a crucial first step for methods like Plane-Wave Expansion or diffraction analysis. By working through the duality relationship between real and reciprocal lattices, you will solidify your understanding of this essential concept and calculate a key property of the reciprocal-space unit cell, the area of the first Brillouin Zone [@problem_id:3289412].", "problem": "A two-dimensional photonic crystal with spatially periodic permittivity $\\,\\epsilon(\\mathbf{r})\\,$ is defined on an oblique Bravais lattice with primitive real-space vectors $\\,\\mathbf{a}_{1} = a\\,\\hat{\\mathbf{x}}\\,$ and $\\,\\mathbf{a}_{2} = a\\big(\\cos\\theta\\,\\hat{\\mathbf{x}} + \\sin\\theta\\,\\hat{\\mathbf{y}}\\big)\\,$, where $\\,a > 0\\,$ is the lattice constant and $\\,\\theta \\in (0,\\pi)\\,$ is the lattice angle measured in radians. In frequency domain, the source-free macroscopic Maxwell equations yield the vector wave equation $\\,\\nabla \\times \\mu^{-1}(\\mathbf{r})\\,\\nabla \\times \\mathbf{E}(\\mathbf{r}) = \\omega^{2}\\,\\epsilon(\\mathbf{r})\\,\\mathbf{E}(\\mathbf{r})\\,$, and the periodicity implies that the electromagnetic field modes satisfy Bloch’s theorem: for any Bloch wavevector $\\,\\mathbf{k}\\,$, $\\,\\mathbf{E}_{\\mathbf{k}}(\\mathbf{r}+\\mathbf{a}_{i}) = \\mathbf{E}_{\\mathbf{k}}(\\mathbf{r})\\,\\exp\\!\\big(i\\,\\mathbf{k}\\cdot\\mathbf{a}_{i}\\big)\\,$ for $\\,i=1,2\\,$. To formulate a spectral-domain computational approach based on plane-wave expansions, one introduces the reciprocal lattice vectors $\\,\\mathbf{G}\\,$ such that the Fourier harmonics $\\,\\exp\\!\\big(i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}\\big)\\,$ respect the lattice periodicity.\n\nStarting from these foundations and the Bloch-phase compatibility condition for plane-wave harmonics under primitive translations, derive the primitive reciprocal lattice vectors $\\,\\mathbf{b}_{1}\\,$ and $\\,\\mathbf{b}_{2}\\,$ for the given oblique lattice, and then compute the area of the first Brillouin Zone (defined as the Wigner–Seitz cell of the reciprocal lattice) by taking the magnitude of the cross product $\\,|\\mathbf{b}_{1}\\times\\mathbf{b}_{2}|\\,$. Express your final answer as a single closed-form analytic expression in terms of $\\,a\\,$ and $\\,\\theta\\,$. The angle $\\,\\theta\\,$ is in radians. Express the area in $\\,\\mathrm{m}^{-2}\\,$. No numerical substitution is required; provide an exact expression as your final answer.", "solution": "The problem is valid as it is scientifically grounded in the principles of solid-state physics and computational electromagnetics, is well-posed, and is expressed in objective, precise language. All necessary information is provided.\n\nThe objective is to derive the primitive reciprocal lattice vectors $\\mathbf{b}_{1}$ and $\\mathbf{b}_{2}$ for a given two-dimensional oblique lattice and then compute the area of its first Brillouin Zone.\n\nThe primitive real-space lattice vectors are given as:\n$$ \\mathbf{a}_{1} = a\\,\\hat{\\mathbf{x}} $$\n$$ \\mathbf{a}_{2} = a\\big(\\cos\\theta\\,\\hat{\\mathbf{x}} + \\sin\\theta\\,\\hat{\\mathbf{y}}\\big) $$\nwhere $a > 0$ is the lattice constant and $\\theta \\in (0, \\pi)$ is the lattice angle. In a Cartesian coordinate system, these vectors are represented as:\n$$ \\mathbf{a}_{1} = \\begin{pmatrix} a \\\\ 0 \\end{pmatrix} $$\n$$ \\mathbf{a}_{2} = \\begin{pmatrix} a\\cos\\theta \\\\ a\\sin\\theta \\end{pmatrix} $$\nThe condition $\\theta \\in (0, \\pi)$ ensures that $\\sin\\theta > 0$, guaranteeing that the vectors $\\mathbf{a}_{1}$ and $\\mathbf{a}_{2}$ are not collinear and thus form a valid basis for a two-dimensional lattice.\n\nThe primitive reciprocal lattice vectors, $\\mathbf{b}_{1}$ and $\\mathbf{b}_{2}$, are defined by the duality condition:\n$$ \\mathbf{a}_{i} \\cdot \\mathbf{b}_{j} = 2\\pi \\delta_{ij} $$\nwhere $i,j \\in \\{1, 2\\}$ and $\\delta_{ij}$ is the Kronecker delta. This condition ensures that the plane-wave basis functions used in a Fourier expansion are compatible with the periodicity of the lattice, as mentioned in the problem statement.\n\nWe can express the unknown reciprocal vectors in the same Cartesian basis:\n$$ \\mathbf{b}_{1} = \\begin{pmatrix} b_{1x} \\\\ b_{1y} \\end{pmatrix} $$\n$$ \\mathbf{b}_{2} = \\begin{pmatrix} b_{2x} \\\\ b_{2y} \\end{pmatrix} $$\n\nWe now solve for the components of $\\mathbf{b}_{1}$ and $\\mathbf{b}_{2}$ by applying the four equations derived from the duality condition:\n\n1.  $\\mathbf{a}_{1} \\cdot \\mathbf{b}_{1} = 2\\pi$:\n    $\\begin{pmatrix} a & 0 \\end{pmatrix} \\begin{pmatrix} b_{1x} \\\\ b_{1y} \\end{pmatrix} = a b_{1x} = 2\\pi \\implies b_{1x} = \\frac{2\\pi}{a}$\n\n2.  $\\mathbf{a}_{1} \\cdot \\mathbf{b}_{2} = 0$:\n    $\\begin{pmatrix} a & 0 \\end{pmatrix} \\begin{pmatrix} b_{2x} \\\\ b_{2y} \\end{pmatrix} = a b_{2x} = 0 \\implies b_{2x} = 0$\n\n3.  $\\mathbf{a}_{2} \\cdot \\mathbf{b}_{1} = 0$:\n    $\\begin{pmatrix} a\\cos\\theta & a\\sin\\theta \\end{pmatrix} \\begin{pmatrix} b_{1x} \\\\ b_{1y} \\end{pmatrix} = (a\\cos\\theta)b_{1x} + (a\\sin\\theta)b_{1y} = 0$\n    Substituting $b_{1x} = \\frac{2\\pi}{a}$:\n    $(a\\cos\\theta)\\left(\\frac{2\\pi}{a}\\right) + (a\\sin\\theta)b_{1y} = 0$\n    $2\\pi\\cos\\theta + a\\sin\\theta b_{1y} = 0$\n    $b_{1y} = -\\frac{2\\pi\\cos\\theta}{a\\sin\\theta} = -\\frac{2\\pi}{a}\\cot\\theta$\n\n4.  $\\mathbf{a}_{2} \\cdot \\mathbf{b}_{2} = 2\\pi$:\n    $\\begin{pmatrix} a\\cos\\theta & a\\sin\\theta \\end{pmatrix} \\begin{pmatrix} b_{2x} \\\\ b_{2y} \\end{pmatrix} = (a\\cos\\theta)b_{2x} + (a\\sin\\theta)b_{2y} = 2\\pi$\n    Substituting $b_{2x} = 0$:\n    $(a\\cos\\theta)(0) + (a\\sin\\theta)b_{2y} = 2\\pi$\n    $a\\sin\\theta b_{2y} = 2\\pi \\implies b_{2y} = \\frac{2\\pi}{a\\sin\\theta}$\n\nHaving found the components, we can write the primitive reciprocal lattice vectors as:\n$$ \\mathbf{b}_{1} = \\frac{2\\pi}{a}\\hat{\\mathbf{x}} - \\frac{2\\pi\\cot\\theta}{a}\\hat{\\mathbf{y}} $$\n$$ \\mathbf{b}_{2} = \\frac{2\\pi}{a\\sin\\theta}\\hat{\\mathbf{y}} $$\n\nThe first Brillouin Zone is the Wigner–Seitz cell of the reciprocal lattice. The area of any primitive cell of the reciprocal lattice, including the first Brillouin Zone, is given by the magnitude of the cross product of the primitive reciprocal vectors. To compute the cross product, we embed the two-dimensional vectors into three-dimensional space by adding a zero z-component:\n$$ \\mathbf{b}_{1} = \\left( \\frac{2\\pi}{a}, -\\frac{2\\pi\\cot\\theta}{a}, 0 \\right) = \\left( \\frac{2\\pi}{a}, -\\frac{2\\pi\\cos\\theta}{a\\sin\\theta}, 0 \\right) $$\n$$ \\mathbf{b}_{2} = \\left( 0, \\frac{2\\pi}{a\\sin\\theta}, 0 \\right) $$\n\nThe cross product $\\mathbf{b}_{1} \\times \\mathbf{b}_{2}$ is calculated using the determinant formula:\n$$ \\mathbf{b}_{1} \\times \\mathbf{b}_{2} = \\det \\begin{pmatrix} \\hat{\\mathbf{x}} & \\hat{\\mathbf{y}} & \\hat{\\mathbf{z}} \\\\ \\frac{2\\pi}{a} & -\\frac{2\\pi\\cos\\theta}{a\\sin\\theta} & 0 \\\\ 0 & \\frac{2\\pi}{a\\sin\\theta} & 0 \\end{pmatrix} $$\nExpanding the determinant, we find that the $\\hat{\\mathbf{x}}$ and $\\hat{\\mathbf{y}}$ components are zero. The $\\hat{\\mathbf{z}}$ component is:\n$$ \\mathbf{b}_{1} \\times \\mathbf{b}_{2} = \\hat{\\mathbf{z}} \\left[ \\left( \\frac{2\\pi}{a} \\right) \\left( \\frac{2\\pi}{a\\sin\\theta} \\right) - \\left( -\\frac{2\\pi\\cos\\theta}{a\\sin\\theta} \\right)(0) \\right] = \\hat{\\mathbf{z}} \\frac{4\\pi^2}{a^2\\sin\\theta} $$\nThe area of the first Brillouin Zone, $A_{BZ}$, is the magnitude of this vector:\n$$ A_{BZ} = |\\mathbf{b}_{1} \\times \\mathbf{b}_{2}| = \\left| \\hat{\\mathbf{z}} \\frac{4\\pi^2}{a^2\\sin\\theta} \\right| = \\frac{4\\pi^2}{a^2|\\sin\\theta|} $$\nAs established earlier, the angle $\\theta$ lies in the interval $(0, \\pi)$, which implies $\\sin\\theta > 0$. Therefore, $|\\sin\\theta| = \\sin\\theta$.\n\nThe final expression for the area of the first Brillouin Zone is:\n$$ A_{BZ} = \\frac{4\\pi^2}{a^2\\sin\\theta} $$\nGiven that the lattice constant $a$ has units of length (e.g., meters), the area has units of inverse length squared ($\\mathrm{m}^{-2}$), which is appropriate for reciprocal space.", "answer": "$$\\boxed{\\frac{4\\pi^2}{a^2\\sin\\theta}}$$", "id": "3289412"}, {"introduction": "The Plane-Wave Expansion (PWE) method is a cornerstone frequency-domain technique for calculating the band structure of periodic media, revealing the allowed frequencies and propagation modes within a photonic crystal. This hands-on exercise requires you to derive the PWE matrix eigenvalue problem from first principles and then implement it computationally, bridging the gap between electromagnetic theory and practical simulation. By solving for the band structure of a canonical photonic crystal, you will gain direct experience with one of the most powerful tools in computational photonics [@problem_id:3289485].", "problem": "Consider a two-dimensional square-lattice photonic crystal formed by a periodic arrangement of circular dielectric rods of radius $R$ and relative permittivity $\\varepsilon_r$ embedded in a homogeneous background of relative permittivity $\\varepsilon_b$. The lattice constant is $a$ and the structure is invariant in the out-of-plane $z$ direction. The analysis is to be performed for Transverse Electric (TE) polarization, where the magnetic field has only the out-of-plane component $H_z$. The task is to derive, implement, and evaluate the Plane-Wave Expansion (PWE, Plane-Wave Expansion) method to compute the band structure as $H_z$ eigenfrequencies for given Bloch wave vectors.\n\nStarting from the source-free Maxwell's equations in a linear, lossless, nonmagnetic, periodic medium with spatially varying permittivity $\\varepsilon(\\mathbf{r})$, and using Bloch's theorem for fields in periodic structures, you must derive the TE-mode scalar wave equation for $H_z(\\mathbf{r})$ in the lattice and then obtain the corresponding matrix eigenvalue problem in a truncated plane-wave basis. The reduction must start from first principles and must not assume any pre-derived band-structure formulas. You must explicitly use the periodicity of $\\varepsilon(\\mathbf{r})$, the completeness of plane waves on a unit cell, and the Fourier convolution structure that links the operator and the field expansion coefficients. Crucially, express the operator in terms of the Fourier coefficients of the inverse permittivity $1/\\varepsilon(\\mathbf{r})$ for the geometry consisting of a circular disk of radius $R$ (with $\\varepsilon_r$) centered within a square unit cell of area $A = a^2$ in a background of $\\varepsilon_b$. Do not introduce any ad hoc or shortcut expressions; all steps must follow from the stated fundamental base.\n\nYour program must implement the derived PWE eigenproblem for TE modes using a square lattice and a truncated plane-wave basis consisting of reciprocal lattice vectors $\\mathbf{G} = m \\mathbf{b}_1 + n \\mathbf{b}_2$ where $\\mathbf{b}_1 = \\frac{2\\pi}{a} \\hat{\\mathbf{x}}$ and $\\mathbf{b}_2 = \\frac{2\\pi}{a} \\hat{\\mathbf{y}}$, for integer indices $m,n \\in \\{-N, \\ldots, N\\}$. Use the truncation parameter $N$ provided in each test case. For each test case, assemble the Hermitian matrix representing the TE operator in the plane-wave basis for a specified Bloch wave vector $\\mathbf{k}$ within the first Brillouin zone, solve the eigenvalue problem to obtain the eigenvalues corresponding to $\\omega^2/c^2$, and then compute the dimensionless normalized frequencies $\\Omega = \\frac{\\omega a}{2\\pi c}$. For each test case, return the $3$ smallest nonnegative normalized frequencies, sorted in ascending order, and rounded to $6$ decimal places. All quantities in the final output must be dimensionless numbers, so no physical units should be attached to the outputs.\n\nUse the following test suite, each specified as $\\{a, R, \\varepsilon_r, \\varepsilon_b, N, \\mathbf{k}\\}$ where $\\mathbf{k} = (k_x, k_y)$ and each component is given as a multiple of $\\pi/a$ to ensure coverage of high-symmetry and interior points of the Brillouin zone:\n\n- Test case $1$ (happy path interior point): $a = 1.0$, $R = 0.2 a$, $\\varepsilon_r = 12.0$, $\\varepsilon_b = 1.0$, $N = 1$, $\\mathbf{k} = \\left(0.35 \\cdot \\frac{\\pi}{a}, 0.0\\right)$.\n- Test case $2$ (high-symmetry $X$ point): $a = 1.0$, $R = 0.2 a$, $\\varepsilon_r = 12.0$, $\\varepsilon_b = 1.0$, $N = 1$, $\\mathbf{k} = \\left(1.0 \\cdot \\frac{\\pi}{a}, 0.0\\right)$.\n- Test case $3$ (high-symmetry $M$ point): $a = 1.0$, $R = 0.2 a$, $\\varepsilon_r = 12.0$, $\\varepsilon_b = 1.0$, $N = 1$, $\\mathbf{k} = \\left(1.0 \\cdot \\frac{\\pi}{a}, 1.0 \\cdot \\frac{\\pi}{a}\\right)$.\n- Test case $4$ (edge case: very low dielectric contrast): $a = 1.0$, $R = 0.2 a$, $\\varepsilon_r = 1.05$, $\\varepsilon_b = 1.0$, $N = 1$, $\\mathbf{k} = \\left(0.3 \\cdot \\frac{\\pi}{a}, 0.3 \\cdot \\frac{\\pi}{a}\\right)$.\n- Test case $5$ (edge case: zero-radius rods, uniform medium with index $n = \\sqrt{\\varepsilon_b}$): $a = 1.0$, $R = 0.0$, $\\varepsilon_r = 12.0$ (unused in this case), $\\varepsilon_b = 2.25$, $N = 1$, $\\mathbf{k} = \\left(0.6 \\cdot \\frac{\\pi}{a}, 0.0\\right)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each test case result itself being a list of three floats rounded to $6$ decimal places (e.g., $[\\,[0.123456,0.234567,0.345678],\\ldots\\,]$). The results must be computed by constructing and solving the TE-mode PWE eigenproblem derived from first principles for the specified parameters. No external input should be required; the program must be fully self-contained.", "solution": "The problem is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. It is a canonical problem in computational photonics. Therefore, it is valid and a solution will be provided.\n\nThe derivation of the Plane-Wave Expansion (PWE) method for Transverse Electric (TE) modes begins with the source-free, time-harmonic Maxwell's equations in a linear, non-magnetic medium:\n$$ \\nabla \\times \\mathbf{E} = i\\omega\\mu_0 \\mathbf{H} \\quad (1) $$\n$$ \\nabla \\times \\mathbf{H} = -i\\omega\\varepsilon_0 \\varepsilon(\\mathbf{r}) \\mathbf{E} \\quad (2) $$\nHere, $\\mathbf{E}$ and $\\mathbf{H}$ are the complex phasors of the electric and magnetic fields, $\\omega$ is the angular frequency, $\\varepsilon_0$ and $\\mu_0$ are the vacuum permittivity and permeability, and $\\varepsilon(\\mathbf{r})$ is the position-dependent relative permittivity of the medium.\n\nTo obtain a wave equation solely in terms of the magnetic field $\\mathbf{H}$, we solve equation $(2)$ for $\\mathbf{E}$:\n$$ \\mathbf{E} = \\frac{i}{\\omega\\varepsilon_0 \\varepsilon(\\mathbf{r})} \\nabla \\times \\mathbf{H} $$\nSubstituting this expression for $\\mathbf{E}$ into equation $(1)$ yields:\n$$ \\nabla \\times \\left( \\frac{i}{\\omega\\varepsilon_0 \\varepsilon(\\mathbf{r})} \\nabla \\times \\mathbf{H} \\right) = i\\omega\\mu_0 \\mathbf{H} $$\nDefining the inverse relative permittivity $\\eta(\\mathbf{r}) = 1/\\varepsilon(\\mathbf{r})$ and using the vacuum speed of light $c = 1/\\sqrt{\\varepsilon_0\\mu_0}$, we simplify the equation to the master wave equation for $\\mathbf{H}$:\n$$ \\nabla \\times \\left( \\eta(\\mathbf{r}) \\nabla \\times \\mathbf{H} \\right) = \\frac{\\omega^2}{c^2} \\mathbf{H} \\quad (3) $$\n\nFor a two-dimensional structure invariant in the $z$-direction, and for TE-polarized modes, the magnetic field is confined to the out-of-plane direction, $\\mathbf{H}(\\mathbf{r}) = H_z(x, y)\\hat{\\mathbf{z}}$, while the electric field lies in the $xy$-plane. The operator $\\nabla$ is now taken as the in-plane gradient, $\\nabla = \\hat{\\mathbf{x}}\\frac{\\partial}{\\partial x} + \\hat{\\mathbf{y}}\\frac{\\partial}{\\partial y}$. The curl of $\\mathbf{H}$ is:\n$$ \\nabla \\times \\mathbf{H} = \\nabla \\times (H_z \\hat{\\mathbf{z}}) = (\\nabla H_z) \\times \\hat{\\mathbf{z}} = \\frac{\\partial H_z}{\\partial y}\\hat{\\mathbf{x}} - \\frac{\\partial H_z}{\\partial x}\\hat{\\mathbf{y}} $$\nThe term $\\eta(\\mathbf{r}) \\nabla \\times \\mathbf{H}$ is an in-plane vector field. Taking its curl results in a vector purely in the $\\hat{\\mathbf{z}}$ direction:\n$$ \\nabla \\times (\\eta \\nabla \\times \\mathbf{H}) = \\hat{\\mathbf{z}} \\left( \\frac{\\partial}{\\partial x} \\left(-\\eta \\frac{\\partial H_z}{\\partial x} \\right) - \\frac{\\partial}{\\partial y} \\left(\\eta \\frac{\\partial H_z}{\\partial y} \\right) \\right) = - \\hat{\\mathbf{z}} \\left( \\nabla \\cdot (\\eta(\\mathbf{r}) \\nabla H_z) \\right) $$\nSubstituting this back into equation $(3)$ and cancelling the $\\hat{\\mathbf{z}}$ unit vector from both sides, we obtain the scalar wave equation for $H_z(x,y)$:\n$$ - \\nabla \\cdot \\left( \\eta(\\mathbf{r}) \\nabla H_z(\\mathbf{r}) \\right) = \\frac{\\omega^2}{c^2} H_z(\\mathbf{r}) \\quad (4) $$\n\nThe photonic crystal is periodic, so its inverse permittivity $\\eta(\\mathbf{r})$ can be expanded in a Fourier series over the reciprocal lattice vectors $\\mathbf{G}$:\n$$ \\eta(\\mathbf{r}) = \\sum_{\\mathbf{G}} \\eta_{\\mathbf{G}} e^{i\\mathbf{G}\\cdot\\mathbf{r}} $$\nwhere the Fourier coefficients are given by $\\eta_{\\mathbf{G}} = \\frac{1}{A} \\int_{\\text{cell}} \\eta(\\mathbf{r}) e^{-i\\mathbf{G}\\cdot\\mathbf{r}} d\\mathbf{r}$, with $A$ being the area of the unit cell.\n\nAccording to Bloch's theorem, the solution $H_z$ for a given Bloch wave vector $\\mathbf{k}$ can be written as a plane-wave expansion:\n$$ H_z(\\mathbf{r}) = \\sum_{\\mathbf{G}'} h_{\\mathbf{G}'} e^{i(\\mathbf{k}+\\mathbf{G}')\\cdot\\mathbf{r}} $$\nwhere $h_{\\mathbf{G}'}$ are the expansion coefficients.\n\nWe now substitute these two expansions into the scalar wave equation $(4)$. The gradient of a single plane-wave component is $\\nabla e^{i(\\mathbf{k}+\\mathbf{G}')\\cdot\\mathbf{r}} = i(\\mathbf{k}+\\mathbf{G}')e^{i(\\mathbf{k}+\\mathbf{G}')\\cdot\\mathbf{r}}$.\nThe left side of $(4)$ becomes:\n$$ \\text{LHS} = - \\nabla \\cdot \\left( \\left(\\sum_{\\mathbf{G}''} \\eta_{\\mathbf{G}''} e^{i\\mathbf{G}''\\cdot\\mathbf{r}}\\right) \\nabla \\left( \\sum_{\\mathbf{G}'} h_{\\mathbf{G}'} e^{i(\\mathbf{k}+\\mathbf{G}')\\cdot\\mathbf{r}} \\right) \\right) $$\n$$ = - \\nabla \\cdot \\left( \\sum_{\\mathbf{G}'' , \\mathbf{G}'} \\eta_{\\mathbf{G}''} i(\\mathbf{k}+\\mathbf{G}') h_{\\mathbf{G}'} e^{i(\\mathbf{k}+\\mathbf{G}'+\\mathbf{G}'')\\cdot\\mathbf{r}} \\right) $$\nApplying the divergence operator yields another factor of $i(\\mathbf{k}+\\mathbf{G}'+\\mathbf{G}'')$:\n$$ = \\sum_{\\mathbf{G}'' , \\mathbf{G}'} (\\mathbf{k}+\\mathbf{G}'+\\mathbf{G}'') \\cdot (\\mathbf{k}+\\mathbf{G}') \\eta_{\\mathbf{G}''} h_{\\mathbf{G}'} e^{i(\\mathbf{k}+\\mathbf{G}'+\\mathbf{G}'')\\cdot\\mathbf{r}} $$\nTo convert this double summation into a matrix-vector equation, we project it onto a single basis function $e^{i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}}$ by integrating over the unit cell and invoking orthogonality. This is equivalent to equating the coefficients of $e^{i\\mathbf{G}\\cdot\\mathbf{r}}$ in the cell-periodic part. Let the total wave vector be $\\mathbf{K} = \\mathbf{k}+\\mathbf{G}$, which means we set $\\mathbf{G} = \\mathbf{G}'+\\mathbf{G}''$. Substituting $\\mathbf{G}'' = \\mathbf{G}-\\mathbf{G}'$:\n$$ \\text{LHS coefficient for } e^{i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}} = \\sum_{\\mathbf{G}'} (\\mathbf{k}+\\mathbf{G}) \\cdot (\\mathbf{k}+\\mathbf{G}') \\eta_{\\mathbf{G}-\\mathbf{G}'} h_{\\mathbf{G}'} $$\nThe right side of $(4)$ is $\\frac{\\omega^2}{c^2} \\sum_{\\mathbf{G}'} h_{\\mathbf{G}'} e^{i(\\mathbf{k}+\\mathbf{G}')\\cdot\\mathbf{r}}$. Its coefficient for $e^{i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}}$ is simply $\\frac{\\omega^2}{c^2} h_{\\mathbf{G}}$.\nEquating the coefficients gives the eigenvalue equation for each reciprocal vector $\\mathbf{G}$:\n$$ \\sum_{\\mathbf{G}'} (\\mathbf{k}+\\mathbf{G}) \\cdot (\\mathbf{k}+\\mathbf{G}') \\eta_{\\mathbf{G}-\\mathbf{G}'} h_{\\mathbf{G}'} = \\frac{\\omega^2}{c^2} h_{\\mathbf{G}} $$\nThis is a standard matrix eigenvalue problem, $M\\mathbf{h} = \\lambda \\mathbf{h}$, where the vector $\\mathbf{h}$ contains the coefficients $h_{\\mathbf{G}}$, the eigenvalues are $\\lambda = \\omega^2/c^2$, and the matrix elements are:\n$$ M_{\\mathbf{G},\\mathbf{G}'} = |\\mathbf{k}+\\mathbf{G}| |\\mathbf{k}+\\mathbf{G}'| \\cos(\\theta_{\\mathbf{G},\\mathbf{G}'}) \\eta_{\\mathbf{G}-\\mathbf{G}'} = (\\mathbf{k}+\\mathbf{G}) \\cdot (\\mathbf{k}+\\mathbf{G}') \\eta_{\\mathbf{G}-\\mathbf{G}'} $$\n\nFor the specified geometry (circular rods of radius $R$ and permittivity $\\varepsilon_r$ in a background of $\\varepsilon_b$ on a square lattice of constant $a$), $\\eta(\\mathbf{r})$ is $1/\\varepsilon_r$ inside the rod and $1/\\varepsilon_b$ outside. The area of the unit cell is $A = a^2$. The Fourier coefficients $\\eta_{\\mathbf{G}}$ are calculated as follows.\nFor $\\mathbf{G} = \\mathbf{0}$:\n$$ \\eta_{\\mathbf{0}} = \\frac{1}{A} \\left( \\frac{1}{\\varepsilon_r} (\\pi R^2) + \\frac{1}{\\varepsilon_b} (a^2 - \\pi R^2) \\right) = f \\frac{1}{\\varepsilon_r} + (1-f) \\frac{1}{\\varepsilon_b} $$\nwhere $f = \\pi R^2/a^2$ is the filling fraction.\nFor $\\mathbf{G} \\ne \\mathbf{0}$, with $G = |\\mathbf{G}|$:\n$$ \\eta_{\\mathbf{G}} = \\frac{1}{A} \\left( \\frac{1}{\\varepsilon_r} - \\frac{1}{\\varepsilon_b} \\right) \\int_{|\\mathbf{r}| \\le R} e^{-i\\mathbf{G}\\cdot\\mathbf{r}} d\\mathbf{r} = \\left( \\frac{1}{\\varepsilon_r} - \\frac{1}{\\varepsilon_b} \\right) f \\frac{2J_1(GR)}{GR} $$\nwhere $J_1$ is the Bessel function of the first kind of order one.\n\nThe computational procedure is to:\n1. Define the reciprocal lattice vectors $\\mathbf{G} = m \\mathbf{b}_1 + n \\mathbf{b}_2$ for the chosen truncation $m, n \\in \\{-N, \\dots, N\\}$.\n2. Calculate the matrix of Fourier coefficients $\\eta_{\\mathbf{G}-\\mathbf{G}'}$.\n3. Assemble the Hermitian matrix $M_{\\mathbf{G},\\mathbf{G}'}$.\n4. Solve the eigenvalue problem to find the eigenvalues $\\lambda_i = (\\omega_i/c)^2$.\n5. Compute the normalized frequencies $\\Omega_i = \\frac{\\omega_i a}{2\\pi c} = \\frac{a\\sqrt{\\lambda_i}}{2\\pi}$.\n\nThis procedure is implemented in the following code for the specified test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import j1\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main function to solve the PWE problem for all test cases.\n    \"\"\"\n    test_cases = [\n        # a, R_factor, eps_r, eps_b, N, kx_factor, ky_factor\n        (1.0, 0.2, 12.0, 1.0, 1, 0.35, 0.0), # case 1\n        (1.0, 0.2, 12.0, 1.0, 1, 1.0, 0.0),  # case 2\n        (1.0, 0.2, 12.0, 1.0, 1, 1.0, 1.0),  # case 3\n        (1.0, 0.2, 1.05, 1.0, 1, 0.3, 0.3),  # case 4\n        (1.0, 0.0, 12.0, 2.25, 1, 0.6, 0.0), # case 5\n    ]\n\n    all_results = []\n    for case in test_cases:\n        a, R_factor, eps_r, eps_b, N, kx_factor, ky_factor = case\n        R = R_factor * a\n        # k vector components are given as multiples of pi/a\n        kx = kx_factor * np.pi / a\n        ky = ky_factor * np.pi / a\n        \n        frequencies = calculate_bands(a, R, eps_r, eps_b, N, kx, ky)\n        rounded_frequencies = [round(f, 6) for f in frequencies]\n        all_results.append(rounded_frequencies)\n\n    # Final print statement in the exact required format.\n    # The str() on a list gives a representation with spaces, e.g., '[0.1, 0.2]'.\n    # This is fine as the problem example also shows this.\n    # Using repr() could be an alternative for more compact string. But str() is more standard.\n    # To be extremely precise with formatting and remove spaces:\n    formatted_results = []\n    for res_list in all_results:\n        res_str = '[' + ','.join([f\"{x:.6f}\" for x in res_list]) + ']'\n        formatted_results.append(res_str)\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef calculate_bands(a, R, eps_r, eps_b, N, kx, ky):\n    \"\"\"\n    Calculates the band structure for a 2D photonic crystal using PWE.\n\n    Args:\n        a (float): Lattice constant.\n        R (float): Radius of the dielectric rods.\n        eps_r (float): Relative permittivity of the rods.\n        eps_b (float): Relative permittivity of the background.\n        N (int): Truncation parameter for the plane-wave basis.\n        kx (float): x-component of the Bloch wave vector.\n        ky (float): y-component of the Bloch wave vector.\n\n    Returns:\n        list: The 3 smallest non-negative normalized frequencies.\n    \"\"\"\n    # 1. Generate reciprocal lattice vectors for the basis\n    basis_indices = []\n    for m in range(-N, N + 1):\n        for n in range(-N, N + 1):\n            basis_indices.append((m, n))\n    \n    num_plane_waves = len(basis_indices)\n\n    # 2. Compute Fourier coefficients of the inverse permittivity eta(r) = 1/eps(r)\n    # The matrix M requires eta(G-G'), so we need G-G' where G, G' are basis vectors.\n    # The maximum indices for m and n in G-G' are +/- 2N.\n    max_idx = 2 * N\n    eta_coeffs = np.zeros((2 * max_idx + 1, 2 * max_idx + 1), dtype=float)\n\n    f = np.pi * (R/a)**2\n    inv_eps_r = 1.0 / eps_r\n    inv_eps_b = 1.0 / eps_b\n    delta_inv_eps = inv_eps_r - inv_eps_b\n\n    for m_diff in range(-max_idx, max_idx + 1):\n        for n_diff in range(-max_idx, max_idx + 1):\n            if m_diff == 0 and n_diff == 0:\n                eta = f * inv_eps_r + (1 - f) * inv_eps_b\n            else:\n                G_mag = (2 * np.pi / a) * np.sqrt(m_diff**2 + n_diff**2)\n                arg = G_mag * R\n                # The limit of 2*j1(x)/x as x->0 is 1. j1(0)=0 so handle explicitly.\n                if np.isclose(arg, 0.0):\n                    bessel_term = 1.0\n                else:\n                    bessel_term = 2 * j1(arg) / arg\n                \n                eta = delta_inv_eps * f * bessel_term\n            \n            eta_coeffs[m_diff + max_idx, n_diff + max_idx] = eta\n\n    # 3. Assemble the Hermitian matrix M\n    M = np.zeros((num_plane_waves, num_plane_waves), dtype=np.float64)\n    k_vec = np.array([kx, ky])\n    \n    # Pre-compute G and K=k+G vectors\n    b1 = np.array([2 * np.pi / a, 0.0])\n    b2 = np.array([0.0, 2 * np.pi / a])\n    G_vectors = [m * b1 + n * b2 for m, n in basis_indices]\n    K_vectors = [k_vec + G for G in G_vectors]\n\n    for i, (m_i, n_i) in enumerate(basis_indices):\n        for j, (m_j, n_j) in enumerate(basis_indices):\n            m_diff = m_i - m_j\n            n_diff = n_i - n_j\n            \n            eta_val = eta_coeffs[m_diff + max_idx, n_diff + max_idx]\n            \n            K_i = K_vectors[i]\n            K_j = K_vectors[j]\n            \n            dot_product = np.dot(K_i, K_j)\n            M[i, j] = dot_product * eta_val\n\n    # 4. Solve the eigenvalue problem\n    # eigh is for Hermitian matrices and returns sorted eigenvalues\n    eigenvalues = eigh(M, eigvals_only=True)\n\n    # 5. Calculate normalized frequencies\n    # Omega = (omega * a) / (2 * pi * c)\n    # Eigenvalues are lambda = (omega/c)^2\n    # So Omega = (a / (2*pi)) * sqrt(lambda)\n    \n    # Filter for non-negative eigenvalues and calculate frequencies\n    omegas = []\n    for eig in eigenvalues:\n        if eig >= -1e-9: # Use a small tolerance for numerical noise\n            freq = (a / (2.0 * np.pi)) * np.sqrt(max(0, eig))\n            omegas.append(freq)\n\n    # Return the 3 smallest frequencies, which will be the first 3 due to sorting by eigh\n    return omegas[:3]\n\n\nsolve()\n\n```", "id": "3289485"}, {"introduction": "Beyond analyzing intrinsic modes, many applications require calculating the field radiated by a periodic array of sources, such as in antenna arrays or metasurfaces. This task challenges you to tackle the notoriously slow convergence of direct real-space lattice sums by deriving and implementing the elegant and efficient reciprocal-space representation of the periodic Green's function. By programming this spectral series, which lies at the heart of Ewald summation techniques, you will learn to accurately and rapidly compute fields in complex periodic environments [@problem_id:3289490].", "problem": "Consider a two-dimensional square lattice of time-harmonic electric dipoles embedded in a homogeneous, isotropic, non-dispersive medium characterized by scalar wavenumber $k_0$ with $k_0 = \\omega \\sqrt{\\mu \\epsilon}$, where $\\omega$ is the angular frequency, $\\mu$ is the permeability, and $\\epsilon$ is the permittivity. The lattice vectors are integer multiples of the period $a$ along the $x$ and $y$ axes, forming a square Bravais lattice. The array is infinite in the $x$-$y$ plane and the observation point is taken at in-plane position $\\boldsymbol{\\rho} = \\boldsymbol{0}$ and height $z = a/3$ above the lattice plane. Assume no in-plane phase shift for the periodicity (zero Bloch wavevector).\n\nStarting from Maxwell's equations and the definition of the scalar Green’s function for the Helmholtz equation, the periodic Green’s function for a two-dimensional square lattice can be represented as a lattice sum over the free-space Green’s function centered at every lattice site. Direct summation is slowly convergent. The Ewald summation method splits the lattice sum into a rapidly convergent real-space part and a rapidly convergent reciprocal-space part via Gaussian screening and the Poisson summation formula. This yields an analytically equivalent representation that converges uniformly even near resonant conditions.\n\nYour tasks are:\n1. Derive the reciprocal-space representation of the periodic scalar Green’s function of the Helmholtz equation for a two-dimensional square lattice via an Ewald-type summation starting from the scalar Helmholtz equation and Poisson summation. Explicitly state all assumptions, branch choices for square roots of complex numbers, and how the representation ensures convergence away from branch points.\n2. Implement a computational routine that evaluates the normalized periodic Green’s function at $\\boldsymbol{\\rho} = \\boldsymbol{0}$ and $z = a/3$ using the reciprocal-lattice (Rayleigh) series. The normalization is defined as $a G_{\\text{per}}$, where $G_{\\text{per}}$ is the periodic scalar Green’s function value; this normalization renders the quantity dimensionless. The reciprocal-lattice vectors are $\\boldsymbol{G} = \\frac{2\\pi}{a}(p \\,\\hat{\\boldsymbol{x}} + q \\,\\hat{\\boldsymbol{y}})$ with integers $p$ and $q$. Use the branch of the square root such that for $|\\boldsymbol{G}| < k_0$, the vertical spectral wavenumber is real and non-negative, and for $|\\boldsymbol{G}| > k_0$, it is purely imaginary with non-negative imaginary part. The computation should truncate the double sum to $-M \\le p,q \\le M$ for a given integer $M$.\n3. Analyze numerical convergence as the dimensionless parameter $k_0 a$ varies by comparing a truncated evaluation with $M_{\\text{small}}$ to a high-accuracy reference with $M_{\\text{ref}}$. For each prescribed value of $k_0 a$, compute the absolute error between the normalized Green’s function computed with $M_{\\text{small}}$ and $M_{\\text{ref}}$. Report the absolute error as a dimensionless float.\n\nUse the following test suite:\n- Lattice period $a = 1$ meter.\n- Observation height $z = a/3$ meters.\n- Bloch wavevector $\\boldsymbol{k}_{\\parallel} = \\boldsymbol{0}$.\n- Truncation parameters $M_{\\text{small}} = 7$ and $M_{\\text{ref}} = 40$.\n- Test values of the dimensionless parameter $k_0 a$: $0.2$, $1.0$, $2.5$, and $5.5$.\n\nRequirements and clarifications:\n- Begin the derivation from the scalar Helmholtz equation $(\\nabla^2 + k_0^2) G_0(\\boldsymbol{r}) = -\\delta(\\boldsymbol{r})$ and the definition of the periodic extension over a two-dimensional Bravais lattice; use Poisson summation and an Ewald Gaussian screening concept to justify the reciprocal-space representation.\n- Clearly define the chosen branch for the square root in the vertical spectral wavenumber to ensure physical radiation conditions, and explain the convergence behavior in both propagating and evanescent regimes.\n- Implement the reciprocal-space sum numerically to compute $a G_{\\text{per}}(\\boldsymbol{0}, z)$ with truncation $-M \\le p,q \\le M$, and measure the absolute difference between the values computed with $M_{\\text{small}}$ and $M_{\\text{ref}}$ for each specified $k_0 a$; the error must be dimensionless due to normalization by $a$.\n- Angles are not part of the output; square roots involving complex numbers must follow the principal value that yields non-negative real parts for propagating modes and non-negative imaginary parts for evanescent modes.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the exact order of the test suite (e.g., “[result1,result2,result3,result4]”). Each result must be a float.\n\nAll quantities with physical units in the computation should be internally maintained in SI units. The final reported errors are dimensionless floats due to normalization by $a$; no unit needs to be attached to the reported numbers.", "solution": "The problem is assessed to be valid as it is scientifically grounded in classical electromagnetism, mathematically well-posed, internally consistent, and contains all necessary information for a unique solution. The task is a standard problem in the analysis of periodic structures.\n\nThe problem requires the derivation and numerical evaluation of the periodic scalar Green's function for a two-dimensional square lattice. The derivation begins with the definition of the periodic Green's function as a solution to the Helmholtz equation with a periodic arrangement of sources.\n\nThe scalar Helmholtz equation for a time-harmonic field with angular frequency $\\omega$ in a homogeneous, isotropic medium is\n$$(\\nabla^2 + k_0^2) \\psi(\\boldsymbol{r}) = -f(\\boldsymbol{r})$$\nwhere $k_0 = \\omega\\sqrt{\\mu\\epsilon}$ is the wavenumber of the medium and $f(\\boldsymbol{r})$ is the source distribution. The Green's function $G(\\boldsymbol{r}, \\boldsymbol{r}')$ is the solution for a point source, i.e., $f(\\boldsymbol{r}) = \\delta(\\boldsymbol{r}-\\boldsymbol{r}')$. The free-space Green's function, denoted $G_0(\\boldsymbol{r})$, is the solution for a source at the origin, satisfying\n$$(\\nabla^2 + k_0^2) G_0(\\boldsymbol{r}) = -\\delta(\\boldsymbol{r})$$\nThe solution in three dimensions that satisfies the Sommerfeld radiation condition is $G_0(\\boldsymbol{r}) = \\frac{e^{i k_0 |\\boldsymbol{r}|}}{4\\pi |\\boldsymbol{r}|}$.\n\nThe problem considers an infinite two-dimensional square lattice of sources in the $z=0$ plane. The lattice sites are given by the vectors $\\boldsymbol{L}_{n_x, n_y} = n_x a \\hat{\\boldsymbol{x}} + n_y a \\hat{\\boldsymbol{y}}$, where $n_x$ and $n_y$ are integers and $a$ is the lattice period. The problem specifies a zero Bloch wavevector ($\\boldsymbol{k}_{\\parallel} = \\boldsymbol{0}$), which implies that all sources have the same phase and amplitude. The source distribution is a sum of delta functions located at each lattice site:\n$$f(\\boldsymbol{r}) = \\sum_{n_x=-\\infty}^{\\infty} \\sum_{n_y=-\\infty}^{\\infty} \\delta(\\boldsymbol{r} - \\boldsymbol{L}_{n_x, n_y})$$\nBy linearity, the periodic Green's function $G_{\\text{per}}(\\boldsymbol{r})$ is the superposition of the fields from each source:\n$$G_{\\text{per}}(\\boldsymbol{r}) = \\sum_{n_x=-\\infty}^{\\infty} \\sum_{n_y=-\\infty}^{\\infty} G_0(\\boldsymbol{r} - \\boldsymbol{L}_{n_x, n_y})$$\nThis direct summation in real space is known to be very slowly convergent, which motivates the use of Ewald's method or related techniques to find a more rapidly convergent representation. The problem asks for the reciprocal-space representation, which can be derived using the Poisson summation formula.\n\nThe derivation proceeds by representing the free-space Green's function $G_0$ using its two-dimensional Fourier transform, known as the Weyl identity:\n$$G_0(\\boldsymbol{r}) = G_0(\\boldsymbol{\\rho}, z) = \\frac{e^{i k_0 \\sqrt{\\rho^2+z^2}}}{4\\pi\\sqrt{\\rho^2+z^2}} = \\frac{i}{8\\pi^2} \\iint_{-\\infty}^{\\infty} \\frac{e^{i \\boldsymbol{k}_{\\rho} \\cdot \\boldsymbol{\\rho}} e^{i k_z |z|}}{k_z} d^2\\boldsymbol{k}_{\\rho}$$\nwhere $\\boldsymbol{\\rho} = x\\hat{\\boldsymbol{x}} + y\\hat{\\boldsymbol{y}}$, $\\boldsymbol{k}_{\\rho} = k_x\\hat{\\boldsymbol{x}} + k_y\\hat{\\boldsymbol{y}}$, and $k_z = \\sqrt{k_0^2 - k_{\\rho}^2}$. The branch of the square root for $k_z$ is chosen such that $\\text{Im}(k_z) \\ge 0$ to ensure the field decays as $|z| \\to \\infty$ for evanescent waves.\n\nWe are interested in the field at $\\boldsymbol{\\rho}=\\boldsymbol{0}$ and $z=a/3$. Setting $\\boldsymbol{\\rho}=\\boldsymbol{0}$ in the sum for $G_{\\text{per}}$ gives:\n$$G_{\\text{per}}(\\boldsymbol{0}, z) = \\sum_{n_x, n_y} G_0(-\\boldsymbol{\\rho}_{n_x, n_y}, z)$$\nwhere $\\boldsymbol{\\rho}_{n_x, n_y} = n_x a \\hat{\\boldsymbol{x}} + n_y a \\hat{\\boldsymbol{y}}$. Substituting the Weyl identity:\n$$G_{\\text{per}}(\\boldsymbol{0}, z) = \\sum_{n_x, n_y} \\frac{i}{8\\pi^2} \\iint_{-\\infty}^{\\infty} \\frac{e^{-i \\boldsymbol{k}_{\\rho} \\cdot \\boldsymbol{\\rho}_{n_x, n_y}} e^{i k_z |z|}}{k_z} d^2\\boldsymbol{k}_{\\rho}$$\nExchanging the order of summation and integration (which is permissible here):\n$$G_{\\text{per}}(\\boldsymbol{0}, z) = \\frac{i}{8\\pi^2} \\iint_{-\\infty}^{\\infty} \\frac{e^{i k_z |z|}}{k_z} \\left( \\sum_{n_x, n_y} e^{-i (k_x n_x a + k_y n_y a)} \\right) d^2\\boldsymbol{k}_{\\rho}$$\nThe term in parentheses is a two-dimensional sum of complex exponentials. We can transform this sum using the Poisson summation formula. The $2$D formula for a square lattice is:\n$$\\sum_{n_x, n_y} e^{-i (k_x n_x a + k_y n_y a)} = \\left(\\frac{2\\pi}{a}\\right)^2 \\sum_{p,q} \\delta\\left(k_x - \\frac{2\\pi p}{a}\\right) \\delta\\left(k_y - \\frac{2\\pi q}{a}\\right)$$\nHere, $p$ and $q$ are integers, and the vectors $\\boldsymbol{G}_{p,q} = \\frac{2\\pi p}{a}\\hat{\\boldsymbol{x}} + \\frac{2\\pi q}{a}\\hat{\\boldsymbol{y}}$ are the reciprocal lattice vectors. The sum of exponentials in the spatial domain is transformed into a comb of Dirac delta functions in the spectral domain.\n\nSubstituting this back into the integral for $G_{\\text{per}}$:\n$$G_{\\text{per}}(\\boldsymbol{0}, z) = \\frac{i}{8\\pi^2} \\left(\\frac{2\\pi}{a}\\right)^2 \\iint_{-\\infty}^{\\infty} \\frac{e^{i k_z |z|}}{k_z} \\sum_{p,q} \\delta\\left(k_x - \\frac{2\\pi p}{a}\\right) \\delta\\left(k_y - \\frac{2\\pi q}{a}\\right) dk_x dk_y$$\nThe sifting property of the delta functions collapses the integral into a double summation over the integers $p$ and $q$. The integrand is sampled at the discrete spectral locations $\\boldsymbol{k}_{\\rho} = \\boldsymbol{G}_{p,q}$.\n$$G_{\\text{per}}(\\boldsymbol{0}, z) = \\frac{4\\pi^2 i}{8\\pi^2 a^2} \\sum_{p,q} \\frac{e^{i k_{z,pq} |z|}}{k_{z,pq}} = \\frac{i}{2a^2} \\sum_{p,q} \\frac{e^{i k_{z,pq} |z|}}{k_{z,pq}}$$\nThis is the reciprocal-space representation, or Rayleigh series, for the periodic Green's function. The vertical wavenumber $k_{z,pq}$ is given by:\n$$k_{z,pq} = \\sqrt{k_0^2 - |\\boldsymbol{G}_{p,q}|^2} = \\sqrt{k_0^2 - \\left(\\frac{2\\pi p}{a}\\right)^2 - \\left(\\frac{2\\pi q}{a}\\right)^2}$$\nAs specified, the branch of the square root is chosen to ensure a physically meaningful solution. For a complex number $\\zeta$, the root $k_z = \\sqrt{\\zeta}$ is selected such that $\\text{Im}(k_z) \\ge 0$. This corresponds to:\n- If $k_0^2 > |\\boldsymbol{G}_{p,q}|^2$, then $k_{z,pq}$ is real and positive. These terms represent propagating plane waves (diffraction orders) that carry energy away from the lattice.\n- If $k_0^2 < |\\boldsymbol{G}_{p,q}|^2$, then $k_{z,pq}$ is purely imaginary with a positive imaginary part, i.e., $k_{z,pq} = i\\sqrt{|\\boldsymbol{G}_{p,q}|^2 - k_0^2}$. These terms represent evanescent waves that decay exponentially with distance $|z|$ from the lattice plane. The corresponding summand is proportional to $e^{-|k_{z,pq}| |z|}$.\n\nThis exponential decay of the evanescent terms ensures that the summation converges rapidly for any observation point not on the source plane, i.e., for $|z| > 0$. The rate of convergence increases with $|z|$. The series is singular if $k_{z,pq} = 0$ for any pair $(p,q)$, which occurs at the Rayleigh-Wood anomalies ($k_0 = |\\boldsymbol{G}_{p,q}|$). The problem parameters are chosen to avoid these singularities.\n\nFor numerical implementation, we need to evaluate the normalized, dimensionless quantity $a G_{\\text{per}}$ at $z = a/3$.\n$$a G_{\\text{per}}(\\boldsymbol{0}, a/3) = a \\left( \\frac{i}{2a^2} \\sum_{p,q} \\frac{e^{i k_{z,pq} (a/3)}}{k_{z,pq}} \\right) = \\frac{i}{2a} \\sum_{p,q} \\frac{e^{i k_{z,pq} (a/3)}}{k_{z,pq}}$$\nTo make the expression fully dimensionless, we define a dimensionless vertical wavenumber $\\tilde{k}_{z,pq} = a k_{z,pq}$:\n$$\\tilde{k}_{z,pq} = a \\sqrt{k_0^2 - |\\boldsymbol{G}_{p,q}|^2} = \\sqrt{(k_0 a)^2 - (2\\pi)^2(p^2 + q^2)}$$\nSubstituting this into the expression for $a G_{\\text{per}}$:\n$$a G_{\\text{per}} = \\frac{i}{2} \\sum_{p,q} \\frac{e^{i (a k_{z,pq}) (z/a)}}{a k_{z,pq}} = \\frac{i}{2} \\sum_{p,q} \\frac{e^{i \\tilde{k}_{z,pq}/3}}{\\tilde{k}_{z,pq}}$$\nThe sum is truncated to a finite window $-M \\le p,q \\le M$ for computation:\n$$a G_{\\text{per}} \\approx \\frac{i}{2} \\sum_{p=-M}^{M} \\sum_{q=-M}^{M} \\frac{e^{i \\tilde{k}_{z,pq}/3}}{\\tilde{k}_{z,pq}}$$\nThis is the final formula to be implemented. The computation involves calculating this sum for $M = M_{\\text{small}} = 7$ and $M = M_{\\text{ref}} = 40$ for each given value of $k_0 a$, and then finding the absolute difference of the results. The values of $k_0 a$ are $0.2$, $1.0$, $2.5$, and $5.5$. The other parameters are $a=1$ and $z=a/3 = 1/3$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_normalized_gper(k0a: float, M: int, z_over_a: float) -> complex:\n    \"\"\"\n    Computes the normalized periodic Green's function using the reciprocal-space sum.\n\n    The formula for the normalized Green's function aG_per is:\n    aG_per = (i/2) * sum_{p,q=-M to M} [exp(i * k_z_tilde * z_over_a) / k_z_tilde]\n    where k_z_tilde = sqrt((k0a)^2 - (2*pi)^2 * (p^2 + q^2)).\n\n    Args:\n        k0a: Dimensionless parameter k_0 * a.\n        M: Truncation limit for the summation indices p and q.\n        z_over_a: Normalized observation height z/a.\n\n    Returns:\n        The complex value of the normalized periodic Green's function.\n    \"\"\"\n    total_sum = 0.0 + 0.0j\n    k0a_sq = k0a**2\n    two_pi_sq = (2 * np.pi)**2\n\n    for p in range(-M, M + 1):\n        for q in range(-M, M + 1):\n            # Calculate the squared transverse wavenumber\n            G_sq_norm = two_pi_sq * (p**2 + q**2)\n            \n            # Calculate the squared normalized vertical wavenumber\n            k_z_tilde_sq = k0a_sq - G_sq_norm\n            \n            # Calculate k_z_tilde with the correct branch.\n            # We must use complex numbers to handle both propagating (positive k_z_tilde_sq)\n            # and evanescent (negative k_z_tilde_sq) modes.\n            # np.sqrt on a complex number returns the principal root, which for a complex Z\n            # has Re(sqrt(Z)) >= 0. For our case where k_z_tilde_sq is real, this\n            # translates to Im(sqrt(Z)) >= 0, which is the desired physical branch\n            # (radiation/decay condition for z>0).\n            k_z_tilde = np.sqrt(complex(k_z_tilde_sq))\n            \n            # The (p,q)=(0,0) term can lead to a division by zero if k0a=0, but the\n            # problem's test cases ensure k0a > 0.\n            if abs(k_z_tilde) < 1e-12:\n                # This case corresponds to a Wood's anomaly and is not expected\n                # for the given test parameters. Skip if it occurs.\n                continue\n            \n            term = np.exp(1j * k_z_tilde * z_over_a) / k_z_tilde\n            total_sum += term\n\n    return (1j / 2.0) * total_sum\n\ndef solve():\n    \"\"\"\n    Main solver function to perform the requested convergence analysis.\n    \"\"\"\n    # Define the test cases and parameters from the problem statement.\n    k0a_values = [0.2, 1.0, 2.5, 5.5]\n    M_small = 7\n    M_ref = 40\n    a = 1.0  # meters\n    z = a / 3.0  # meters\n    z_over_a = z / a\n\n    errors = []\n    \n    for k0a in k0a_values:\n        # Compute the Green's function with small truncation\n        gper_small = compute_normalized_gper(k0a, M_small, z_over_a)\n        \n        # Compute the reference Green's function with high truncation\n        gper_ref = compute_normalized_gper(k0a, M_ref, z_over_a)\n        \n        # Calculate the absolute error\n        # The result is a float since np.abs of a complex number is its magnitude.\n        error = np.abs(gper_small - gper_ref)\n        \n        errors.append(error)\n\n    # Final print statement in the exact required format.\n    # The output is a comma-separated list of float values.\n    print(f\"[{','.join(map(str, errors))}]\")\n\nsolve()\n\n```", "id": "3289490"}]}