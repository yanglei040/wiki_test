{"hands_on_practices": [{"introduction": "An essential step in moving from idealized theory to real-world application is accounting for material imperfections. While the Perfect Electric Conductor (PEC) assumption simplifies analysis, all physical conductors have finite conductivity, leading to ohmic losses that impact performance. This practice provides a hands-on method to quantify how these losses affect key CMA metrics like the modal quality factor ($Q_n$) and radiation efficiency ($\\eta_n$), building a foundational understanding of the trade-offs inherent in antenna design. [@problem_id:3292846]", "problem": "Given a thin, closed, perfectly smooth metallic spherical shell of radius $a$ in free space, consider Characteristic Mode Analysis (CMA) in the Electric Field Integral Equation (EFIE) framework. The impedance operator for the shell is modeled as $$\\mathbf{Z}(\\omega) = \\mathbf{R}_\\text{rad}(\\omega) + \\mathbf{R}_\\text{ohm}(\\omega) + j\\mathbf{X}(\\omega),$$ where $\\mathbf{R}_\\text{rad}$ is the radiation resistance operator capturing radiated power, $\\mathbf{R}_\\text{ohm}$ is the ohmic resistance operator capturing conduction loss due to finite conductivity, and $\\mathbf{X}$ is the reactance operator. The CMA eigenproblem is formed from the generalized eigenvalue equation $$\\mathbf{X}(\\omega) \\mathbf{J}_n(\\omega) = \\lambda_n(\\omega) \\mathbf{R}_\\text{rad}(\\omega) \\mathbf{J}_n(\\omega),$$ where $\\mathbf{J}_n$ is the $n$th characteristic current mode and $\\lambda_n$ is the corresponding characteristic value.\n\nAssume the shell is electrically small to moderately sized in terms of $ka$, where $k = \\omega/c$ is the free-space wavenumber and $c$ is the speed of light. Use a modal basis on the spherical shell constructed from tangential vector spherical harmonics of degree $l$, where $l = 1,2,\\dots,L$ indexes the mode family. In this basis, approximate the operators as diagonal in $l$ with the following physically motivated scalings:\n\n- Radiation resistance per mode:\n$$R_{\\text{rad},l}(\\omega) = Z_0 \\, C_l \\, (ka)^{2l+1},$$\nwhere $Z_0 = \\sqrt{\\mu_0/\\epsilon_0}$ is the free-space wave impedance, $\\mu_0$ is the vacuum permeability, $\\epsilon_0$ is the vacuum permittivity, and $C_l  0$ is a dimensionless geometry-dependent modal radiation coefficient.\n\n- Ohmic resistance per mode using the good conductor surface resistance model:\n$$R_{\\text{ohm},l}(\\omega) = R_s(\\omega,\\sigma) \\, D_l,$$\nwith the surface resistance\n$$R_s(\\omega,\\sigma) = \\sqrt{\\frac{\\omega \\mu_0}{2\\sigma}} = \\sqrt{\\frac{\\pi f \\mu_0}{\\sigma}},$$\nfor angular frequency $\\omega = 2\\pi f$ and conductivity $\\sigma$, and $D_l  0$ is a dimensionless modal dissipation coefficient representing current concentration and path length effects on the spherical shell for the $l$th mode.\n\n- Modal quality factor using stored energy and radiated power:\n$$Q_l(ka) = \\frac{\\omega \\, W_l(ka)}{P_{\\text{rad},l}(ka)},$$\nwhere $W_l$ is the time-average stored reactive energy of the $l$th mode and $P_{\\text{rad},l}$ is the time-average radiated power. For electrically small spherical shells, $Q_l$ is dominated by near-field storage terms that scale with inverse powers of $ka$, leading to a composite asymptotic model\n$$Q_l(ka) \\approx \\frac{A_l}{(ka)^3} + \\frac{B_l}{ka},$$\nwith $A_l0$ and $B_l0$ dimensionless modal shape factors capturing electric- and magnetic-type storage contributions.\n\nDefine the radiation efficiency of the $l$th mode as\n$$\\eta_l(\\omega) = \\frac{R_{\\text{rad},l}(\\omega)}{R_{\\text{rad},l}(\\omega) + R_{\\text{ohm},l}(\\omega)}.$$\n\nYour task is to implement a program that evaluates how finite conductivity affects the modal quality factor $Q_l$ and radiation efficiency $\\eta_l$ across modes for thin metal shells, using the above operator scalings. Use the following modal shape factors to capture the expected increase of near-field storage and dissipation with mode index $l$:\n- $$A_l = \\frac{l(l+1)}{2}, \\quad B_l = l, \\quad C_l = 10^{-3}, \\quad D_l = l(l+1).$$\n\nCompute the quantities for the following test suite (all quantities in the International System of Units (SI)):\n\n- Case 1 (general happy path): $a = 0.05$ m, $f = 300 \\times 10^6$ Hz, $\\sigma = 5.8 \\times 10^7$ S/m, $L = 4$.\n- Case 2 (electrically small boundary): $a = 0.05$ m, $f = 30 \\times 10^6$ Hz, $\\sigma = 5.8 \\times 10^7$ S/m, $L = 4$.\n- Case 3 (poor conductor edge case): $a = 0.05$ m, $f = 1 \\times 10^9$ Hz, $\\sigma = 1 \\times 10^5$ S/m, $L = 4$.\n- Case 4 (higher frequency happy path): $a = 0.05$ m, $f = 3 \\times 10^9$ Hz, $\\sigma = 5.8 \\times 10^7$ S/m, $L = 4$.\n\nFor each case, evaluate $Q_l$ and $\\eta_l$ for $l = 1,2,3,4$. The program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered by cases and ascending mode index $l$, with each pair as consecutive entries $[Q_1,\\eta_1,Q_2,\\eta_2,\\dots,Q_4,\\eta_4]$ for Case 1, followed by Case 2, Case 3, and Case 4 appended in sequence. All outputs are dimensionless real numbers. No angles are used. No percentages are used.", "solution": "The problem statement has been rigorously evaluated and is determined to be valid. It is self-contained, scientifically grounded in the principles of computational electromagnetics, and mathematically well-posed. It presents a simplified but consistent model for the Characteristic Mode Analysis (CMA) of a thin metallic spherical shell. The task is to compute defined physical quantities using the provided formulas and parameters.\n\nThe objective is to compute the modal quality factor, `$Q_l$`, and the modal radiation efficiency, `$\\eta_l$`, for a set of test cases. The calculations are based on a series of specified analytical models for the modal characteristics of a spherical shell. The fundamental physical constants used are the speed of light in vacuum, `$c \\approx 299792458 \\, \\text{m/s}$`, and the vacuum permeability, `$\\mu_0 = 4\\pi \\times 10^{-7} \\, \\text{H/m}$`. From these, the impedance of free space is derived as `$Z_0 = \\sqrt{\\mu_0/\\epsilon_0} = c\\mu_0 \\approx 376.73 \\, \\Omega$`.\n\nThe computational procedure for each test case, defined by the shell radius `$a$`, operating frequency `$f$`, and shell conductivity `$\\sigma$`, is as follows. For each mode index `$l$` from `$1$` to the maximum specified degree `$L=4$`:\n\n1.  **Calculate Derived Physical Parameters**: First, we compute the parameters that depend on the operating frequency `$f$`.\n    -   The angular frequency is `$\\omega = 2\\pi f$`.\n    -   The free-space wavenumber is `$k = \\omega/c$`.\n    -   The dimensionless size parameter of the sphere is `$ka$`.\n\n2.  **Determine Mode-Dependent Coefficients**: The problem specifies the following dimensionless coefficients that depend on the mode index `$l$`:\n    -   `$A_l = \\frac{l(l+1)}{2}$`\n    -   `$B_l = l$`\n    -   `$C_l = 10^{-3}$` (constant for all `$l$`)\n    -   `$D_l = l(l+1)$`\n\n3.  **Compute Modal Quality Factor `$Q_l$`**: Using the provided asymptotic model, the quality factor for the `$l$`-th mode is calculated as:\n    $$Q_l(ka) = \\frac{A_l}{(ka)^3} + \\frac{B_l}{ka}$$\n    This formula combines contributions from electric-type (`$A_l$`) and magnetic-type (`$B_l$`) energy storage mechanisms, which dominate for electrically small structures.\n\n4.  **Compute Modal Resistances**: The radiation efficiency depends on the modal radiation resistance `$R_{\\text{rad},l}$` and the modal ohmic resistance `$R_{\\text{ohm},l}$`.\n    -   First, the surface resistance `$R_s$` of the metallic shell is computed. This value depends on frequency and conductivity:\n        $$R_s(\\omega,\\sigma) = \\sqrt{\\frac{\\pi f \\mu_0}{\\sigma}}$$\n    -   The modal ohmic resistance `$R_{\\text{ohm},l}$` is then found by scaling the surface resistance with the dissipation coefficient `$D_l$`:\n        $$R_{\\text{ohm},l}(\\omega) = R_s(\\omega,\\sigma) \\cdot D_l$$\n    -   The modal radiation resistance `$R_{\\text{rad},l}$` is calculated based on its specified scaling with `$ka$`:\n        $$R_{\\text{rad},l}(\\omega) = Z_0 \\cdot C_l \\cdot (ka)^{2l+1}$$\n\n5.  **Compute Modal Radiation Efficiency `$\\eta_l$`**: Finally, the radiation efficiency of the `$l$`-th mode is calculated as the ratio of the radiated power (proportional to `$R_{\\text{rad},l}$`) to the total power dissipated through both radiation and ohmic loss (proportional to `$R_{\\text{rad},l} + R_{\\text{ohm},l}$`):\n    $$\\eta_l(\\omega) = \\frac{R_{\\text{rad},l}(\\omega)}{R_{\\text{rad},l}(\\omega) + R_{\\text{ohm},l}(\\omega)}$$\n\nThis complete sequence of calculations is performed for each mode index `$l \\in \\{1, 2, 3, 4\\}$` for each of the four specified test cases. The resulting values of `$Q_l$` and `$\\eta_l$` are then concatenated in the prescribed order to form the final output.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Characteristic Mode Analysis problem for a spherical shell.\n    \"\"\"\n    # Define fundamental physical constants in SI units.\n    C0 = 299792458.0  # Speed of light in vacuum (m/s)\n    MU0 = 4.0 * np.pi * 1e-7  # Vacuum permeability (H/m)\n    Z0 = C0 * MU0  # Free-space wave impedance (Ohms)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (a, f, sigma, L)\n        (0.05, 300e6, 5.8e7, 4),   # Case 1\n        (0.05, 30e6, 5.8e7, 4),    # Case 2\n        (0.05, 1e9, 1e5, 4),     # Case 3\n        (0.05, 3e9, 5.8e7, 4),     # Case 4\n    ]\n\n    def calculate_metrics_for_case(a, f, sigma, l_max):\n        \"\"\"\n        Calculates Q_l and eta_l for a single test case for l from 1 to l_max.\n        \n        Args:\n            a (float): Radius of the spherical shell in meters.\n            f (float): Frequency in Hertz.\n            sigma (float): Conductivity in Siemens per meter.\n            l_max (int): Maximum mode index to compute.\n            \n        Returns:\n            list: A flat list of [Q1, eta1, Q2, eta2, ...].\n        \"\"\"\n        # Calculate derived physical parameters\n        omega = 2.0 * np.pi * f\n        k = omega / C0\n        ka = k * a\n\n        # Calculate surface resistance Rs\n        Rs = np.sqrt((np.pi * f * MU0) / sigma)\n\n        case_results = []\n        for l in range(1, l_max + 1):\n            # Define mode-dependent coefficients\n            A_l = float(l * (l + 1)) / 2.0\n            B_l = float(l)\n            C_l = 1e-3\n            D_l = float(l * (l + 1))\n\n            # Compute modal quality factor Q_l\n            # The problem context ensures ka > 0\n            Q_l = (A_l / np.power(ka, 3)) + (B_l / ka)\n\n            # Compute modal resistances\n            R_ohm_l = Rs * D_l\n            R_rad_l = Z0 * C_l * np.power(ka, 2 * l + 1)\n            \n            # Compute modal radiation efficiency eta_l\n            denominator = R_rad_l + R_ohm_l\n            if denominator == 0.0:\n                 # This case is unlikely with the given formulas but handled for robustness.\n                eta_l = 0.0\n            else:\n                eta_l = R_rad_l / denominator\n\n            case_results.append(Q_l)\n            case_results.append(eta_l)\n        \n        return case_results\n\n    # Process all test cases and collect results\n    all_results = []\n    for case in test_cases:\n        a, f, sigma, l_max = case\n        all_results.extend(calculate_metrics_for_case(a, f, sigma, l_max))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "3292846"}, {"introduction": "When analyzing characteristic modes over a frequency range, it is common to see eigenvalue curves that approach each other. Understanding whether these modes truly cross or merely \"veer\" away from each other is critical for correct mode tracking and physical interpretation. This practice uses a symmetry-adapted model to explore the fundamental phenomena of mode crossing versus avoided crossing, revealing the deep connection between the structure's geometric symmetry and the observable behavior of its characteristic eigenvalues. [@problem_id:3292914]", "problem": "You are asked to design and implement a principled numerical experiment that probes veering (avoided crossing) versus true crossing of characteristic eigenvalues in the framework of characteristic mode analysis for a Perfect Electric Conductor (PEC). Your starting point must be the operator form of the Electric Field Integral Equation (EFIE) and the definition of characteristic modes: a current mode is defined as a nontrivial vector $\\mathbf{J}$ and a real scalar $\\lambda$ such that the real-symmetric reactance operator $\\mathbf{X}(\\omega)$ and the real-symmetric radiation operator $\\mathbf{R}(\\omega)$ satisfy the generalized Hermitian eigenvalue problem\n$$\n\\mathbf{X}(\\omega)\\,\\mathbf{J} \\;=\\; \\lambda(\\omega)\\,\\mathbf{R}(\\omega)\\,\\mathbf{J}.\n$$\nFor a PEC with high geometric symmetry at symmetry parameter $s=0$, mode degeneracies occur when the irreducible representation of the symmetry group has dimension greater than $1$. When symmetry is reduced by a small perturbation $s0$, only modes belonging to the same irreducible representation of the remaining symmetry group are allowed to couple (group-theoretic selection rule), which generically produces avoided crossings. Modes that remain in distinct irreducible representations of the reduced symmetry do not couple and thus cross.\n\nTo make this experiment self-contained and computationally well-posed without a full electromagnetic discretization, you will implement a reduced-order, symmetry-adapted, $4\\times 4$ real-symmetric pencil model $\\left(\\mathbf{X}(\\omega,s),\\mathbf{R}(s)\\right)$, derived as a Galerkin truncation onto four symmetry-adapted basis functions. These basis functions are labeled by two families, $A$ and $B$, each with a two-fold multiplicity induced by high symmetry at $s=0$, and by a residual parity label $p\\in\\{+,-\\}$ that encodes the irreducible representation of the reduced symmetry:\n- Index $0$: family $A$ with parity $+$,\n- Index $1$: family $A$ with parity $-$,\n- Index $2$: family $B$ with parity $+$,\n- Index $3$: family $B$ with parity $-$.\n\nYour construction must satisfy the following physics-grounded structural rules:\n- The operator $\\mathbf{R}(s)$ is positive-definite, real-symmetric, and diagonal in the chosen basis, with repeated entries within each family.\n- The operator $\\mathbf{X}(\\omega,s)$ is real-symmetric and diagonal at $s=0$, with two identical diagonal entries within each family, producing degeneracies consistent with high symmetry. For $s0$, symmetry-breaking is introduced by (i) small parity-splitting diagonal shifts within each family that scale as $s^2$ and change sign between $+$ and $-$ parities, and (ii) off-diagonal couplings that are allowed only between basis functions that share the same residual parity label $p$, modeling the group-theoretic selection rule.\n\nUse the following explicit parameterization, which is physically consistent, numerically stable, and dimensionless:\n- Radiation operator:\n$$\n\\mathbf{R}(s)=\\operatorname{diag}\\big(r_A,\\,r_A,\\,r_B,\\,r_B\\big),\\quad r_A=1.0,\\quad r_B=1.1.\n$$\n- Reactance operator at symmetry parameter $s$ and angular frequency $\\omega$:\n$$\n\\mathbf{X}(\\omega,s)=\\operatorname{diag}\\big(x_A(\\omega)+\\delta_A(s,+),\\;x_A(\\omega)+\\delta_A(s,-),\\;x_B(\\omega)+\\delta_B(s,+),\\;x_B(\\omega)+\\delta_B(s,-)\\big)\\;+\\;\\mathbf{C}(s),\n$$\nwith diagonal dispersion functions\n$$\nx_A(\\omega)=\\omega-2.0,\\qquad x_B(\\omega)=0.6\\,(\\omega-1.0),\n$$\nparity-splitting shifts\n$$\n\\delta_A(s,\\pm)=\\pm d_A\\,s^2,\\quad d_A=0.03,\\qquad \\delta_B(s,\\pm)=\\pm d_B\\,s^2,\\quad d_B=0.02,\n$$\nand symmetry-allowed off-diagonal coupling matrix $\\mathbf{C}(s)$ defined by\n$$\n\\mathbf{C}(s)_{0,2}=\\mathbf{C}(s)_{2,0}=g_{+}\\,s,\\quad g_{+}=0.12,\\qquad \\mathbf{C}(s)_{1,3}=\\mathbf{C}(s)_{3,1}=g_{-}\\,s,\\quad g_{-}=0.0,\n$$\nwith all other entries of $\\mathbf{C}(s)$ equal to $0$. This construction enforces that coupling is allowed only within the same residual parity $p$ sector, namely indices $\\{0,2\\}$ for $p=+$ and $\\{1,3\\}$ for $p=-$, consistent with group-theoretic selection rules.\n\nDenote the two-by-two sub-pencil associated with a given ordered index pair $(i,j)$ by $\\left(\\mathbf{X}_{ij}(\\omega,s),\\mathbf{R}_{ij}(s)\\right)$, where $\\mathbf{X}_{ij}$ and $\\mathbf{R}_{ij}$ are the principal submatrices of $\\mathbf{X}$ and $\\mathbf{R}$ on indices $(i,j)$. The characteristic eigenvalues restricted to this subspace are defined as the two real roots $\\lambda_1(\\omega,s)\\le \\lambda_2(\\omega,s)$ of\n$$\n\\det\\!\\left(\\mathbf{X}_{ij}(\\omega,s)-\\lambda\\,\\mathbf{R}_{ij}(s)\\right)=0.\n$$\nDefine the frequency-dependent gap for the pair $(i,j)$ as\n$$\n\\Delta_{ij}(\\omega,s)=\\left|\\lambda_2(\\omega,s)-\\lambda_1(\\omega,s)\\right|,\n$$\nand define the minimal gap over a closed frequency interval $[\\omega_{\\min},\\omega_{\\max}]$ as\n$$\n\\Delta^{\\star}_{ij}(s;[\\omega_{\\min},\\omega_{\\max}])=\\min_{\\omega\\in[\\omega_{\\min},\\omega_{\\max}]}\\Delta_{ij}(\\omega,s).\n$$\n\nYour task is to:\n- Implement a program that builds $\\mathbf{R}(s)$ and $\\mathbf{X}(\\omega,s)$ as above, extracts the two-by-two sub-pencils for specified pairs $(i,j)$, solves the generalized Hermitian eigenproblem at each sampled frequency using a numerically stable reduction to a standard symmetric eigenproblem, and computes $\\Delta^{\\star}_{ij}$ via dense sampling over the interval $[\\omega_{\\min},\\omega_{\\max}]$.\n- Use the Cholesky factorization of $\\mathbf{R}_{ij}(s)$ to form a standard symmetric eigenproblem, ensuring numerical stability.\n- Evaluate on the frequency grid of $N$ uniformly spaced samples, where $N$ is specified in each test case below.\n\nTest suite:\n- Case $1$ (high-symmetry boundary, degeneracy present): $s=0.0$, pair $(i,j)=(0,2)$, $\\omega\\in[2.5,\\,3.9]$, $N=20001$.\n- Case $2$ (weak symmetry breaking in the $p=+$ sector, avoided crossing expected): $s=0.05$, pair $(i,j)=(0,2)$, $\\omega\\in[2.5,\\,3.9]$, $N=20001$.\n- Case $3$ (symmetry-protected crossing in the $p=-$ sector, no coupling by selection rule): $s=0.2$, pair $(i,j)=(1,3)$, $\\omega\\in[2.5,\\,3.9]$, $N=20001$.\n\nRequired output:\n- For each case, compute the minimal gap $\\Delta^{\\star}_{ij}$ as a floating-point number.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[$r_1$,$r_2$,$r_3$]\"), where each $r_k$ is the minimal gap for the corresponding case, rounded to $6$ decimal places.\n- No physical units are required for this problem; all quantities are dimensionless.", "solution": "The task is to design a numerical experiment to compute the minimal frequency-dependent gap between characteristic eigenvalues for a simplified $4 \\times 4$ matrix pencil model of a Perfect Electric Conductor (PEC). The phenomenon of interest is the distinction between mode veering (avoided crossing) and true mode crossing, which is controlled by a symmetry-breaking parameter $s$.\n\nThe core of the problem is the generalized Hermitian eigenvalue problem\n$$\n\\mathbf{X}(\\omega,s)\\,\\mathbf{J} \\;=\\; \\lambda(\\omega,s)\\,\\mathbf{R}(s)\\,\\mathbf{J}\n$$\nwhere $\\mathbf{X}(\\omega,s)$ is the real-symmetric reactance operator and $\\mathbf{R}(s)$ is the real-symmetric and positive-definite radiation operator. Both are given as parameterized $4 \\times 4$ matrices. The goal is to compute the minimal gap $\\Delta^{\\star}_{ij}$ over a frequency interval for specific $2 \\times 2$ sub-pencils.\n\nThe solution proceeds in four main steps: model construction, subproblem extraction, analytical solution of the subproblem, and numerical computation.\n\n1.  **Model Construction**:\nThe $4 \\times 4$ matrices $\\mathbf{R}(s)$ and $\\mathbf{X}(\\omega,s)$ are constructed according to the problem's explicit parameterization.\nThe radiation operator $\\mathbf{R}(s)$ is constant and diagonal:\n$$\n\\mathbf{R}(s)=\\operatorname{diag}\\big(r_A,\\,r_A,\\,r_B,\\,r_B\\big)\n$$\nwith $r_A=1.0$ and $r_B=1.1$.\n\nThe reactance operator $\\mathbf{X}(\\omega,s)$ is the sum of a diagonal part and an off-diagonal coupling part, $\\mathbf{X}(\\omega,s) = \\mathbf{D}(\\omega, s) + \\mathbf{C}(s)$. The diagonal elements are given by:\n$$\n\\begin{aligned}\n\\mathbf{D}(\\omega,s)_{0,0} = x_A(\\omega) + \\delta_A(s,+) = (\\omega-2.0) + d_A s^2 \\\\\n\\mathbf{D}(\\omega,s)_{1,1} = x_A(\\omega) + \\delta_A(s,-) = (\\omega-2.0) - d_A s^2 \\\\\n\\mathbf{D}(\\omega,s)_{2,2} = x_B(\\omega) + \\delta_B(s,+) = 0.6(\\omega-1.0) + d_B s^2 \\\\\n\\mathbf{D}(\\omega,s)_{3,3} = x_B(\\omega) + \\delta_B(s,-) = 0.6(\\omega-1.0) - d_B s^2\n\\end{aligned}\n$$\nwith $d_A=0.03$ and $d_B=0.02$. The off-diagonal coupling matrix $\\mathbf{C}(s)$ has only two pairs of non-zero elements, governed by the group-theoretic selection rule that coupling is only allowed between modes of the same parity $p$:\n$$\n\\mathbf{C}(s)_{0,2}=\\mathbf{C}(s)_{2,0}=g_{+}\\,s \\quad (p=+) \\\\\n\\mathbf{C}(s)_{1,3}=\\mathbf{C}(s)_{3,1}=g_{-}\\,s \\quad (p=-)\n$$\nwith $g_{+}=0.12$ and $g_{-}=0.0$.\n\n2.  **Subproblem Extraction**:\nFor a given pair of indices $(i,j)$, the $2 \\times 2$ submatrices $\\mathbf{X}_{ij}(\\omega,s)$ and $\\mathbf{R}_{ij}(s)$ are extracted from the full $4 \\times 4$ matrices. $\\mathbf{R}_{ij}(s)$ is a diagonal matrix whose entries are drawn from $\\{r_A, r_B\\}$. $\\mathbf{X}_{ij}(\\omega,s)$ contains the corresponding diagonal elements from $\\mathbf{D}(\\omega,s)$ and the single relevant coupling term from $\\mathbf{C}(s)$.\n\n3.  **Analytical Solution of the $2 \\times 2$ Subproblem**:\nThe analysis is focused on the $2 \\times 2$ generalized eigenproblem:\n$$\n\\det\\!\\left(\\mathbf{X}_{ij}(\\omega,s)-\\lambda\\,\\mathbf{R}_{ij}(s)\\right)=0\n$$\nSince $\\mathbf{R}_{ij}(s)$ is diagonal and positive-definite, this problem can be transformed into a standard symmetric eigenproblem. Let $\\mathbf{R}_{ij} = \\mathbf{L}\\mathbf{L}^T$ be the Cholesky factorization of $\\mathbf{R}_{ij}$. The problem is equivalent to finding the eigenvalues of the matrix $\\mathbf{A} = \\mathbf{L}^{-1}\\mathbf{X}_{ij}(\\mathbf{L}^T)^{-1}$.\n\nA more direct approach for the $2 \\times 2$ case is to solve the characteristic polynomial analytically. Let the sub-matrices be\n$$\n\\mathbf{X}_{ij}(\\omega,s) = \\begin{pmatrix} a(\\omega, s)  c(s) \\\\ c(s)  b(\\omega, s) \\end{pmatrix}, \\quad \\mathbf{R}_{ij}(s) = \\begin{pmatrix} r_i  0 \\\\ 0  r_j \\end{pmatrix}.\n$$\nThe characteristic equation is $(a - \\lambda r_i)(b - \\lambda r_j) - c^2 = 0$, which is a quadratic equation in $\\lambda$:\n$$\n(r_i r_j)\\lambda^2 - (a r_j + b r_i)\\lambda + (ab - c^2) = 0.\n$$\nThe two roots, $\\lambda_1$ and $\\lambda_2$, can be found using the quadratic formula. The gap $\\Delta_{ij} = |\\lambda_2 - \\lambda_1|$ is given by the discriminant divided by the leading coefficient:\n$$\n\\Delta_{ij}(\\omega,s) = \\frac{\\sqrt{(a r_j + b r_i)^2 - 4 r_i r_j (ab - c^2)}}{r_i r_j} = \\frac{\\sqrt{(a r_j - b r_i)^2 + 4 c^2 r_i r_j}}{r_i r_j}.\n$$\nThis analytical expression for the gap allows for a highly efficient, vectorized computation. This formula is mathematically equivalent to solving the standard symmetric eigenproblem derived via Cholesky decomposition.\n\n4.  **Numerical Computation**:\nThe core of the implementation is the evaluation of this analytical gap formula across a dense grid of frequencies. For each test case defined by $s$, $(i,j)$, and an interval $[\\omega_{\\min}, \\omega_{\\max}]$, the following algorithm is executed:\na.  A uniform grid of $N$ frequencies, $\\{\\omega_k\\}$, is generated over $[\\omega_{\\min}, \\omega_{\\max}]$.\nb.  The frequency-dependent diagonal terms $a(\\omega_k, s)$ and $b(\\omega_k, s)$, and the constant terms $c(s)$, $r_i$, and $r_j$ are determined for the specified sub-pencil $(i,j)$.\nc.  The gap function $\\Delta_{ij}(\\omega_k, s)$ is evaluated for all $\\omega_k$ in the grid using the derived analytical formula in a vectorized manner with NumPy. This produces an array of gap values.\nd.  The minimal gap is found by taking the minimum value in this array:\n$$\n\\Delta^{\\star}_{ij}(s;[\\omega_{\\min},\\omega_{\\max}])=\\min_{k} \\Delta_{ij}(\\omega_k,s).\n$$\nThis procedure is repeated for each of the three test cases, and the results are collected. When the off-diagonal coupling $c(s)$ is zero (as in Cases 1 and 3), the gap formula simplifies to $\\Delta_{ij}(\\omega, s) = |a(\\omega, s) r_j - b(\\omega, s) r_i| / (r_i r_j)$. The minimum gap will be zero if the crossing frequency, where $a(\\omega, s) r_j = b(\\omega, s) r_i$, lies within the sampled interval. If the crossing frequency is an exact grid point, the computed minimum is numerically zero. Otherwise, it is a small non-zero value determined by the grid resolution. When $c(s) \\neq 0$ (Case 2, avoided crossing), the gap is never zero, and its minimum value is $\\frac{2|c(s)|}{\\sqrt{r_i r_j}}$.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the minimal characteristic eigenvalue gap for three test cases\n    of a symmetry-adapted 4x4 matrix pencil model.\n    \"\"\"\n\n    # Define physical and model parameters from the problem statement\n    r_A = 1.0\n    r_B = 1.1\n    d_A = 0.03\n    d_B = 0.02\n    g_plus = 0.12\n    g_minus = 0.0\n\n    # Test suite: (s, (i, j), omega_min, omega_max, N)\n    test_cases = [\n        (0.0, (0, 2), 2.5, 3.9, 20001),\n        (0.05, (0, 2), 2.5, 3.9, 20001),\n        (0.2, (1, 3), 2.5, 3.9, 20001),\n    ]\n\n    results = []\n\n    # Map of indices to basis function properties: (family_type, parity_sign)\n    # family_type 'A' or 'B'. parity_sign +1 or -1.\n    basis_map = {\n        0: ('A', 1),  # Family A, parity +\n        1: ('A', -1), # Family A, parity -\n        2: ('B', 1),  # Family B, parity +\n        3: ('B', -1), # Family B, parity -\n    }\n\n    for s, (i, j), omega_min, omega_max, N in test_cases:\n        # Generate the frequency grid\n        omegas = np.linspace(omega_min, omega_max, N, dtype=np.float64)\n\n        # Get properties for the selected indices i and j\n        family_i, parity_i = basis_map[i]\n        family_j, parity_j = basis_map[j]\n\n        # Determine the diagonal elements of the X_ij submatrix as functions of omega\n        if family_i == 'A':\n            a_omega = omegas - 2.0\n            delta_a = parity_i * d_A * s**2\n        else: # family 'B'\n            a_omega = 0.6 * (omegas - 1.0)\n            delta_a = parity_i * d_B * s**2\n        \n        if family_j == 'A':\n            b_omega = omegas - 2.0\n            delta_b = parity_j * d_A * s**2\n        else: # family 'B'\n            b_omega = 0.6 * (omegas - 1.0)\n            delta_b = parity_j * d_B * s**2\n\n        # a(omega, s) and b(omega, s) are the diagonal elements of X_ij\n        a_vals = a_omega + delta_a\n        b_vals = b_omega + delta_b\n\n        # Determine the off-diagonal element c(s) of X_ij\n        # Coupling is only between indices {0,2} (p=+) or {1,3} (p=-)\n        if {i, j} == {0, 2}:\n            c_val = g_plus * s\n        elif {i, j} == {1, 3}:\n            c_val = g_minus * s\n        else:\n            c_val = 0.0\n\n        # Determine diagonal elements r_i, r_j of the R_ij submatrix\n        r_i = r_A if family_i == 'A' else r_B\n        r_j = r_A if family_j == 'A' else r_B\n\n        # Calculate the eigenvalue gap using the derived analytical formula\n        # Delta = sqrt((a*r_j - b*r_i)^2 + 4*c^2*r_i*r_j) / (r_i*r_j)\n        term1 = (a_vals * r_j - b_vals * r_i)**2\n        term2 = 4.0 * c_val**2 * r_i * r_j\n        \n        gaps = np.sqrt(term1 + term2) / (r_i * r_j)\n\n        # Find the minimum gap over the frequency grid\n        min_gap = np.min(gaps)\n        results.append(min_gap)\n\n    # Format the final output string as required\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3292914"}, {"introduction": "This final practice bridges the gap between abstract modal analysis and concrete engineering design, demonstrating one of the most powerful applications of CMA. You will learn to translate the properties of a characteristic mode—specifically its resonance where $\\lambda_n=0$ and the slope of its eigenvalue—into an equivalent series $RLC$ circuit model. Using this intuitive circuit analogue, you will then synthesize a practical L-section network to match the mode's impedance to a standard source impedance, a common task in antenna engineering. [@problem_id:3292877]", "problem": "Consider the task of designing a multiport matching network based on Characteristic Mode Analysis (CMA) within computational electromagnetics. Start from first principles: Maxwell’s equations, the definition of the impedance operator in the Method of Moments, and the definition of characteristic modes. Let the Method of Moments impedance operator be decomposed into the real part and the imaginary part as $\\mathbf{Z}(\\omega) = \\mathbf{R}(\\omega) + j\\mathbf{X}(\\omega)$, where $\\mathbf{R}(\\omega)$ and $\\mathbf{X}(\\omega)$ are frequency-dependent Hermitian operators representing dissipative and reactive components, respectively. The characteristic modes $\\mathbf{J}_n(\\omega)$ and their dimensionless eigenvalues $\\lambda_n(\\omega)$ satisfy the generalized eigenvalue problem $\\mathbf{X}(\\omega)\\mathbf{J}_n(\\omega) = \\lambda_n(\\omega)\\mathbf{R}(\\omega)\\mathbf{J}_n(\\omega)$. The modal radiated power and ohmic loss are encapsulated in an equivalent modal resistance. Near a design angular frequency $\\omega_0$, assume a small-signal behavior where the $n$-th mode is locally resonant so that $\\lambda_n(\\omega_0) = 0$. Under standard CMA normalization, the modal impedance seen by the $n$-th mode can be modeled as an equivalent series $RLC$ circuit, $Z_n(\\omega) = R_n + jX_n(\\omega)$, where $R_n$ aggregates radiation and dissipative loss at $\\omega_0$.\n\nYour task is to:\n- Derive, from the generalized eigenproblem and the definitions of stored energy, radiated power, and dissipative loss, a mapping of each characteristic mode to an equivalent series $RLC$ circuit near $\\omega_0$.\n- Use the slope of the modal reactance with respect to angular frequency at $\\omega_0$ to infer the equivalent inductance and capacitance for each mode.\n- Synthesize, for a chosen subset of modes, a minimal two-element $L$-section matching network that matches their equivalent series resistances to a real source impedance at $\\omega_0$. The $L$-section consists of one series reactance and one shunt reactance; choose the topology based on whether the load resistance $R_n$ is greater than or less than the source resistance $Z_0$, and express the reactive elements as physical inductances or capacitances evaluated at $\\omega_0$.\n\nAll answers involving physical units must be expressed in the specified units:\n- Angular frequency in radians per second.\n- Resistance in ohms.\n- Inductance in henries.\n- Capacitance in farads.\n\nAngles are not involved beyond angular frequency; no angle unit specification is required beyond radians for $\\omega$.\n\nTo make this task precise and testable, use the following test suite of modes and parameters. You must treat all frequency values as exact and perform numerical differentiation of $\\lambda_n(\\omega)$ via the central difference formula. Let the design frequency be $f_0 = 1.0 \\times 10^9$ hertz, with $\\omega_0 = 2\\pi f_0$. Use the frequency samples $f_- = 0.95 \\times 10^9$ hertz, $f_0 = 1.0 \\times 10^9$ hertz, and $f_+ = 1.05 \\times 10^9$ hertz, with corresponding angular frequencies $\\omega_- = 2\\pi f_-$, $\\omega_0 = 2\\pi f_0$, and $\\omega_+ = 2\\pi f_+$. For each mode, you are given $\\lambda_n(\\omega_-)$, $\\lambda_n(\\omega_0)$, and $\\lambda_n(\\omega_+)$, and the modal radiation resistance and ohmic loss resistance at $\\omega_0$. The source impedance is purely real, $Z_0 = 50$ ohms.\n\nTest suite:\n- Mode $0$: $\\lambda_0(\\omega_-) = -0.6283185307179586$, $\\lambda_0(\\omega_0) = 0.0$, $\\lambda_0(\\omega_+) = 0.6283185307179586$; $R_{\\text{rad},0} = 20$ ohms; $R_{\\text{loss},0} = 5$ ohms.\n- Mode $1$: $\\lambda_1(\\omega_-) = -0.25132741228718347$, $\\lambda_1(\\omega_0) = 0.0$, $\\lambda_1(\\omega_+) = 0.25132741228718347$; $R_{\\text{rad},1} = 60$ ohms; $R_{\\text{loss},1} = 10$ ohms.\n- Mode $2$: $\\lambda_2(\\omega_-) = -0.34557519189487723$, $\\lambda_2(\\omega_0) = 0.0$, $\\lambda_2(\\omega_+) = 0.34557519189487723$; $R_{\\text{rad},2} = 40$ ohms; $R_{\\text{loss},2} = 0$ ohms.\n- Mode $3$: $\\lambda_3(\\omega_-) = -0.3141592653589793$, $\\lambda_3(\\omega_0) = 0.0$, $\\lambda_3(\\omega_+) = 0.3141592653589793$; $R_{\\text{rad},3} = 50$ ohms; $R_{\\text{loss},3} = 0$ ohms.\n\nChosen mode subset to be matched: modes $0$, $2$, and $3$.\n\nAlgorithmic requirements:\n1. For each mode $n$, compute the total equivalent resistance at $\\omega_0$ as $R_n = R_{\\text{rad},n} + R_{\\text{loss},n}$.\n2. Approximate the derivative $\\frac{d\\lambda_n}{d\\omega}\\big\\rvert_{\\omega_0}$ using the central difference formula $\\frac{\\lambda_n(\\omega_+) - \\lambda_n(\\omega_-)}{\\omega_+ - \\omega_-}$.\n3. Using your derived mapping from first principles, compute $\\frac{dX_n}{d\\omega}\\big\\rvert_{\\omega_0}$ and infer the equivalent inductance $L_n$ and capacitance $C_n$ of the series $RLC$ circuit that models mode $n$ near $\\omega_0$.\n4. For each selected mode, synthesize an `$L$`-section matching network that matches $R_n$ to $Z_0$ at $\\omega_0$. Use a two-element $L$ network: one series reactance $X_{\\text{series}}$ and one shunt reactance $X_{\\text{shunt}}$; choose a topology appropriate to whether $R_n  Z_0$ or $R_n  Z_0$. Then convert $X_{\\text{series}}$ and $X_{\\text{shunt}}$ to physical elements at $\\omega_0$ using $X = \\omega_0 L$ for inductors and $X = -\\frac{1}{\\omega_0 C}$ for capacitors. Report the chosen element values as physical inductance or capacitance and set unused element values to $0$.\n5. Edge case: if $R_n = Z_0$, set all matching elements to $0$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each selected mode’s result must be a list of seven floats in the order $[R_n, L_n, C_n, L_{\\text{series}}, C_{\\text{series}}, L_{\\text{shunt}}, C_{\\text{shunt}}]$, with resistances in ohms, inductances in henries, and capacitances in farads. For example: $[[\\cdots],[\\cdots],[\\cdots]]$.", "solution": "The derivation begins from first principles in computational electromagnetics. Maxwell’s equations govern electromagnetic fields, and the Method of Moments (MoM) discretizes boundary integral equations for radiating structures. The resulting impedance operator is $\\mathbf{Z}(\\omega) = \\mathbf{R}(\\omega) + j\\mathbf{X}(\\omega)$, where $\\mathbf{R}(\\omega)$ is associated with radiated and dissipative power and $\\mathbf{X}(\\omega)$ with stored reactive energy. Characteristic Mode Analysis (CMA) is defined via the generalized Hermitian eigenproblem\n$$\n\\mathbf{X}(\\omega)\\,\\mathbf{J}_n(\\omega) = \\lambda_n(\\omega)\\,\\mathbf{R}(\\omega)\\,\\mathbf{J}_n(\\omega),\n$$\nwhere $\\mathbf{J}_n(\\omega)$ is the $n$-th modal surface current and $\\lambda_n(\\omega)$ is the corresponding real eigenvalue.\n\nInterpretation of $\\lambda_n(\\omega)$ follows from the bilinear forms: if one adopts the standard CMA normalization where the modal radiated power is proportional to $\\mathbf{J}_n^\\mathsf{T}\\mathbf{R}\\mathbf{J}_n$ and the modal reactive power is proportional to $\\mathbf{J}_n^\\mathsf{T}\\mathbf{X}\\mathbf{J}_n$, then the eigenvalue $\\lambda_n(\\omega)$ quantifies the ratio of reactive to resistive effects for the $n$-th mode. Near a design angular frequency $\\omega_0$ with $\\lambda_n(\\omega_0) = 0$, the $n$-th mode is in resonance. We consider an equivalent series circuit model $Z_n(\\omega) = R_n + jX_n(\\omega)$, where $R_n$ aggregates modal radiation and ohmic loss at $\\omega_0$, and $X_n(\\omega)$ represents the modal reactance.\n\nFrom the eigenproblem and the normalization, one obtains the scalar relationship between the modal reactance and resistance,\n$$\nX_n(\\omega) \\propto \\lambda_n(\\omega)\\,R_n(\\omega),\n$$\nand with appropriate normalization of the modal current, the proportionality constant is unity in the modal sense, yielding\n$$\nX_n(\\omega) = \\lambda_n(\\omega)\\,R_n(\\omega).\n$$\nThis mapping encodes the fundamental CMA interpretation that the eigenvalue scales reactive to resistive power for each mode. Differentiating with respect to angular frequency and evaluating at resonance $\\omega_0$ where $\\lambda_n(\\omega_0) = 0$, we obtain\n$$\n\\left.\\frac{dX_n}{d\\omega}\\right\\rvert_{\\omega_0}\n= R_n(\\omega_0)\\left.\\frac{d\\lambda_n}{d\\omega}\\right\\rvert_{\\omega_0} + \\lambda_n(\\omega_0)\\left.\\frac{dR_n}{d\\omega}\\right\\rvert_{\\omega_0}\n= R_n(\\omega_0)\\left.\\frac{d\\lambda_n}{d\\omega}\\right\\rvert_{\\omega_0}.\n$$\nThus, the slope of the modal reactance at resonance is given by the modal resistance at $\\omega_0$ times the slope of the eigenvalue at $\\omega_0$.\n\nWe next connect $X_n(\\omega)$ to an equivalent series $RLC$ circuit. The reactance of a series $RLC$ is\n$$\nX_{\\text{series}}(\\omega) = \\omega L - \\frac{1}{\\omega C}.\n$$\nAt resonance, the reactance vanishes: $X_{\\text{series}}(\\omega_0) = 0$ implies $\\omega_0 L = \\frac{1}{\\omega_0 C}$ and hence $\\omega_0^2 L C = 1$. Differentiating $X_{\\text{series}}(\\omega)$ with respect to $\\omega$ gives\n$$\n\\frac{dX_{\\text{series}}}{d\\omega} = L + \\frac{1}{\\omega^2 C},\n$$\nand evaluating at $\\omega_0$ using $\\omega_0^2 L C = 1$ yields\n$$\n\\left.\\frac{dX_{\\text{series}}}{d\\omega}\\right\\rvert_{\\omega_0} = L + \\frac{1}{\\omega_0^2 C} = L + L = 2L.\n$$\nEquating this slope with the modal slope derived from CMA provides the equivalent inductance:\n$$\nL_n = \\frac{1}{2}\\,R_n(\\omega_0)\\left.\\frac{d\\lambda_n}{d\\omega}\\right\\rvert_{\\omega_0}.\n$$\nOnce $L_n$ is known, the equivalent capacitance follows from the resonance condition:\n$$\nC_n = \\frac{1}{\\omega_0^2 L_n}.\n$$\nThese expressions map each mode to an equivalent series $RLC$ circuit near $\\omega_0$ using only CMA-derived quantities and the design frequency.\n\nWe now synthesize a minimal two-element $L$-section to match $R_n$ to a real source impedance $Z_0$ at $\\omega_0$. An $L$-section consists of one series reactance $X_{\\text{series}}$ and one shunt reactance $X_{\\text{shunt}}$. Choosing a topology depends on whether $R_n$ is greater or less than $Z_0$. Using standard network analysis, we derive the necessary reactances by enforcing that the transformed load seen at the source port is purely real and equal to $Z_0$.\n\nLet $R_L = R_n$ denote the load resistance and $R_S = Z_0$ the source resistance. For an $L$-section with a series reactance followed by a shunt reactance to ground at the load side, the required quality factor $Q$ and reactances are:\n- Case $R_L  R_S$ (low-pass $L$-match):\n$$\nQ = \\sqrt{\\frac{R_L}{R_S} - 1},\\quad X_{\\text{series}} = Q R_S,\\quad X_{\\text{shunt}} = \\frac{R_L}{Q}.\n$$\n- Case $R_L  R_S$ (high-pass $L$-match):\n$$\nQ = \\sqrt{\\frac{R_S}{R_L} - 1},\\quad X_{\\text{series}} = Q R_L,\\quad X_{\\text{shunt}} = \\frac{R_S}{Q}.\n$$\nThese results follow by solving the input impedance of the cascaded series-shunt network and equating the real part to $R_S$ while nulling the imaginary part. The sign of the reactances determines whether the elements are inductive or capacitive in a given frequency region. A conventional choice for realizability at $\\omega_0$ is:\n- If $R_L  R_S$: choose a series inductor and a shunt capacitor, i.e., $L_{\\text{series}} = \\frac{X_{\\text{series}}}{\\omega_0}$ and $C_{\\text{shunt}} = \\frac{1}{\\omega_0 X_{\\text{shunt}}}$, with $C_{\\text{series}} = 0$ and $L_{\\text{shunt}} = 0$.\n- If $R_L  R_S$: choose a series capacitor and a shunt inductor, i.e., $C_{\\text{series}} = \\frac{1}{\\omega_0 X_{\\text{series}}}$ and $L_{\\text{shunt}} = \\frac{X_{\\text{shunt}}}{\\omega_0}$, with $L_{\\text{series}} = 0$ and $C_{\\text{shunt}} = 0$.\n- Edge case $R_L = R_S$: no matching needed, all matching elements are set to zero.\n\nWe now apply the algorithm to the test suite. Numerical inputs:\n- $f_0 = 1.0 \\times 10^9$ hertz, so $\\omega_0 = 2\\pi f_0 = 2\\pi \\times 10^9$ radians per second.\n- $f_- = 0.95 \\times 10^9$ hertz and $f_+ = 1.05 \\times 10^9$ hertz, giving $\\omega_- = 2\\pi f_- = 2\\pi \\times 0.95\\times 10^9$ radians per second and $\\omega_+ = 2\\pi f_+ = 2\\pi \\times 1.05\\times 10^9$ radians per second.\n- The central difference step in angular frequency is $\\Delta\\omega = \\omega_+ - \\omega_- = 2\\pi(f_+ - f_-) = 2\\pi \\times 0.10\\times 10^9$ radians per second.\n\nFor each mode $n$:\n1. Compute $R_n = R_{\\text{rad},n} + R_{\\text{loss},n}$.\n2. Compute $\\left.\\frac{d\\lambda_n}{d\\omega}\\right\\rvert_{\\omega_0} \\approx \\frac{\\lambda_n(\\omega_+) - \\lambda_n(\\omega_-)}{\\omega_+ - \\omega_-}$.\n3. Compute $L_n = \\frac{1}{2} R_n \\left.\\frac{d\\lambda_n}{d\\omega}\\right\\rvert_{\\omega_0}$.\n4. Compute $C_n = \\frac{1}{\\omega_0^2 L_n}$.\n5. Given $R_S = Z_0 = 50$ ohms and $R_L = R_n$, synthesize the $L$-match reactances using the appropriate case and convert to $L$ or $C$ at $\\omega_0$.\n\nThis yields, for each selected mode, the seven requested quantities $[R_n, L_n, C_n, L_{\\text{series}}, C_{\\text{series}}, L_{\\text{shunt}}, C_{\\text{shunt}}]$ in the specified units. The final program implements these steps exactly with the provided numerical values and prints the aggregate results in the required single-line format.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    # Design frequency and angular frequencies\n    f0 = 1.0e9  # Hz\n    f_minus = 0.95e9  # Hz\n    f_plus = 1.05e9  # Hz\n    w0 = 2.0 * np.pi * f0\n    w_minus = 2.0 * np.pi * f_minus\n    w_plus = 2.0 * np.pi * f_plus\n    dw = w_plus - w_minus\n\n    # Source impedance (ohms)\n    Z0 = 50.0\n\n    # Test suite: modes with lambda values at w_minus, w0, w_plus and resistances at w0\n    # Each entry: (lambda_minus, lambda_0, lambda_plus, R_rad, R_loss)\n    modes = [\n        # Mode 0\n        (-0.6283185307179586, 0.0, 0.6283185307179586, 20.0, 5.0),\n        # Mode 1\n        (-0.25132741228718347, 0.0, 0.25132741228718347, 60.0, 10.0),\n        # Mode 2\n        (-0.34557519189487723, 0.0, 0.34557519189487723, 40.0, 0.0),\n        # Mode 3\n        (-0.3141592653589793, 0.0, 0.3141592653589793, 50.0, 0.0),\n    ]\n\n    # Chosen mode subset indices to be matched\n    subset_indices = [0, 2, 3]\n\n    results = []\n\n    for idx in subset_indices:\n        lam_minus, lam_0, lam_plus, R_rad, R_loss = modes[idx]\n\n        # Total resistance at w0\n        R = R_rad + R_loss\n\n        # Central difference derivative d lambda / d omega at w0\n        dlam_domega = (lam_plus - lam_minus) / dw\n\n        # Equivalent series RLC parameters near w0\n        L_eq = 0.5 * R * dlam_domega\n        # Avoid division by zero (if L_eq == 0, set C_eq to 0)\n        if L_eq > 0.0:\n            C_eq = 1.0 / (w0**2 * L_eq)\n        else:\n            # Physically, L_eq should be positive; handle pathological numerical case\n            L_eq = 0.0\n            C_eq = 0.0\n\n        # L-section matching from R to Z0 at w0\n        RL = R\n        RS = Z0\n\n        L_series = 0.0\n        C_series = 0.0\n        L_shunt = 0.0\n        C_shunt = 0.0\n\n        # Edge case: already matched\n        if np.isclose(RL, RS):\n            # No matching elements required\n            pass\n        else:\n            if RL > RS:\n                # Low-pass L-match: series inductor, shunt capacitor\n                Q = np.sqrt(RL / RS - 1.0)\n                X_series = Q * RS\n                X_shunt = RL / Q\n                L_series = X_series / w0\n                C_shunt = 1.0 / (w0 * X_shunt)\n            else:\n                # High-pass L-match: series capacitor, shunt inductor\n                Q = np.sqrt(RS / RL - 1.0)\n                X_series = Q * RL\n                X_shunt = RS / Q\n                C_series = 1.0 / (w0 * X_series)\n                L_shunt = X_shunt / w0\n\n        # Append results for this mode:\n        # [R_n (ohm), L_n (H), C_n (F), L_series (H), C_series (F), L_shunt (H), C_shunt (F)]\n        results.append([R, L_eq, C_eq, L_series, C_series, L_shunt, C_shunt])\n\n    # Final print statement in the exact required format.\n    # Single line: list of lists with floats\n    print(f\"[{','.join(['[' + ','.join(map(str, r)) + ']' for r in results])}]\")\n\nsolve()\n```", "id": "3292877"}]}