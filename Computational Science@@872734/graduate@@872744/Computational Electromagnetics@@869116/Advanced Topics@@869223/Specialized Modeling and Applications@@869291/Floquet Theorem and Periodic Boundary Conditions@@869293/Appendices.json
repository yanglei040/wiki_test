{"hands_on_practices": [{"introduction": "The transition from continuous physical laws to discrete computational algorithms is a cornerstone of computational science. This first practice challenges you to bridge this gap by deriving the discrete form of the Floquet-Bloch transform directly from first principles, revealing its fundamental connection to the widely-used Fast Fourier Transform (FFT). Mastering this connection is essential for efficiently implementing solvers for periodic systems and understanding the numerical implications of sampling, such as aliasing. [@problem_id:3308765]", "problem": "Consider a one-dimensional periodic electromagnetic medium of period $a$ along the $x$-axis. Let $u(x)$ denote a scalar field component of the time-harmonic electromagnetic solution that satisfies the Floquet–Bloch quasi-periodic condition $u(x+a) = u(x)\\exp\\!\\left(i k a\\right)$, where $k$ is the Bloch wavenumber. In a computational setting, the unit cell is discretized with $N$ equispaced samples $x_n = n\\,\\Delta x$ for $n \\in \\{0,1,\\dots,N-1\\}$ and $\\Delta x = a/N$. The discrete samples are $u[n] \\equiv u(x_n)$. Define the reciprocal lattice vectors $G_q = \\frac{2\\pi}{a}\\,q$ for $q \\in \\{0,1,\\dots,N-1\\}$.\n\nTask A (derivation from first principles):\n- Starting from the quasi-periodic boundary condition and the Fourier series representation of a periodic function, derive a discrete Floquet–Bloch transform that maps the $N$ samples $\\{u[n]\\}$ into $N$ discrete spectral coefficients $\\{C_q(k)\\}$ associated with the harmonics indexed by $q$ at a fixed Bloch wavenumber $k \\in \\left[-\\frac{\\pi}{a},\\frac{\\pi}{a}\\right)$. Your derivation must be based only on the definitions of quasi-periodicity, Fourier series on the unit cell, and Riemann-sum discretization. You must not assume any pre-existing discrete transform formulas.\n\n- Show that the resulting forward transform can be written as a Discrete Fourier Transform (DFT) of a phase-ramped sequence (i.e., an elementwise multiplication by a complex exponential depending on $k$). Relate your discrete transform to a Fast Fourier Transform (FFT) algorithm by identifying the exact phase ramp and the DFT matrix structure.\n\nTask B (aliasing from finite $k$-sampling):\n- Suppose that instead of a continuous range of $k$, you sample the Bloch wavenumber on $M$ points $k_p = k_0 + p\\,\\Delta k$ for $p \\in \\{0,1,\\dots,M-1\\}$ with $\\Delta k = \\frac{2\\pi}{a M}$, covering one Brillouin zone of width $\\frac{2\\pi}{a}$. Using only the sampling theorem for Fourier series on a finite interval and the Poisson summation idea in discrete form, rigorously show that this finite $k$-sampling implies a reconstruction in a supercell of length $M a$ in real space, and identify the precise aliasing mechanism that makes $k$ indistinguishable modulo integer multiples of $\\Delta k$ under this sampling.\n\nTask C (normalization that preserves energy with physical weights):\n- Let the discrete spatial inner product be weighted by $\\Delta x$ and the discrete spectral inner product be weighted by $\\Delta G \\equiv \\frac{2\\pi}{a}$ (the spacing of reciprocal lattice indices). Determine the unique scalar normalization constant $\\beta$ (independent of $k$) in the forward transform\n$$\nC_q(k) \\;=\\; \\beta \\sum_{n=0}^{N-1} u[n] \\,\\exp\\!\\big(-i k x_n\\big)\\,\\exp\\!\\big(-i G_q x_n\\big)\n$$\nsuch that the discrete Parseval relation with physical weights holds:\n$$\n\\sum_{n=0}^{N-1} |u[n]|^2\\,\\Delta x \\;=\\; \\sum_{q=0}^{N-1} |C_q(k)|^2\\,\\Delta G \\, .\n$$\nYou must obtain a closed-form analytic expression for $\\beta$ explicitly in terms of $N$ and $a$ only. Express your final answer for $\\beta$ as a single analytic expression. Do not provide intermediate steps in the final answer. No numerical evaluation or rounding is required. Units need not be reported in the final boxed answer.", "solution": "We begin from the Floquet–Bloch quasi-periodic boundary condition and the Fourier series representation on a single unit cell. The condition $u(x+a) = u(x)\\exp\\!\\left(i k a\\right)$ implies that the field can be factored as $u(x) = \\exp\\!\\left(i k x\\right) g(x)$ where $g(x)$ is strictly periodic with period $a$, i.e., $g(x+a) = g(x)$. The periodic function $g(x)$ admits a Fourier series\n$$\ng(x) \\;=\\; \\sum_{q\\in\\mathbb{Z}} \\widehat{g}_q \\,\\exp\\!\\big(i G_q x\\big) \\, , \\quad G_q \\;=\\; \\frac{2\\pi}{a}\\,q \\, .\n$$\nHence\n$$\nu(x) \\;=\\; \\exp\\!\\left(i k x\\right) \\sum_{q\\in\\mathbb{Z}} \\widehat{g}_q \\,\\exp\\!\\big(i G_q x\\big) \\;=\\; \\sum_{q\\in\\mathbb{Z}} \\widehat{g}_q \\,\\exp\\!\\big(i (k+G_q) x\\big) \\, .\n$$\n\nOn the discrete grid $x_n = n\\,\\Delta x$ with $\\Delta x = a/N$ and $n\\in\\{0,1,\\dots,N-1\\}$, we define the samples $u[n] \\equiv u(x_n)$. The discrete representation of the Fourier coefficients associated with the periodic envelope $g(x) = u(x)\\exp\\!\\left(-i k x\\right)$ arises naturally from a Riemann sum approximation to the integral definition:\n$$\n\\widehat{g}_q \\;\\approx\\; \\frac{1}{a} \\int_{0}^{a} g(x)\\,\\exp\\!\\big(-i G_q x\\big)\\,dx \\;\\approx\\; \\frac{1}{a} \\sum_{n=0}^{N-1} g(x_n)\\,\\exp\\!\\big(-i G_q x_n\\big)\\,\\Delta x \\;=\\; \\frac{\\Delta x}{a} \\sum_{n=0}^{N-1} u[n]\\exp\\!\\big(-i k x_n\\big)\\exp\\!\\big(-i G_q x_n\\big) \\, .\n$$\nThis motivates a discrete Floquet–Bloch transform at fixed $k$ of the form\n$$\nC_q(k) \\;=\\; \\beta \\sum_{n=0}^{N-1} u[n]\\,\\exp\\!\\big(-i k x_n\\big)\\,\\exp\\!\\big(-i G_q x_n\\big) \\, ,\n$$\nwhere $\\beta$ is a normalization constant to be determined by a discrete energy-preservation (Parseval) condition with physically meaningful weights.\n\nTo relate this transform to the Discrete Fourier Transform (DFT) and a Fast Fourier Transform (FFT) implementation, observe that with $x_n = n\\,\\Delta x = n\\,\\frac{a}{N}$ and $G_q = \\frac{2\\pi}{a} q$, we get\n$$\nG_q x_n \\;=\\; \\frac{2\\pi}{a} q \\,\\frac{a}{N} n \\;=\\; \\frac{2\\pi}{N} q n \\, .\n$$\nTherefore\n$$\n\\exp\\!\\big(-i G_q x_n\\big) \\;=\\; \\exp\\!\\left(-i \\frac{2\\pi}{N} q n\\right) \\, ,\n$$\nwhich are precisely the kernel entries of an $N$-point DFT (up to normalization). Defining the phase-ramped sequence\n$$\nv[n;k] \\;\\equiv\\; u[n] \\,\\exp\\!\\big(-i k x_n\\big) \\, ,\n$$\nwe can write the transform compactly as\n$$\nC_q(k) \\;=\\; \\beta \\sum_{n=0}^{N-1} v[n;k] \\,\\exp\\!\\left(-i \\frac{2\\pi}{N} q n\\right) \\, .\n$$\nIn matrix form, with $U \\in \\mathbb{C}^{N}$ the vector of samples $u[n]$, $D_k \\in \\mathbb{C}^{N\\times N}$ the diagonal matrix $\\big(D_k\\big)_{n,n} = \\exp\\!\\big(-i k x_n\\big)$, and $F_{\\mathrm{un}} \\in \\mathbb{C}^{N\\times N}$ the unnormalized DFT matrix $\\big(F_{\\mathrm{un}}\\big)_{q,n} = \\exp\\!\\left(-i \\frac{2\\pi}{N} q n\\right)$, the transform reads\n$$\nC(k) \\;=\\; \\beta \\,F_{\\mathrm{un}} \\,D_k \\,U \\, .\n$$\nThus, the transform is exactly a DFT of the phase-ramped sequence $v[n;k]$, and it can be implemented efficiently by a Fast Fourier Transform (FFT) after applying the elementwise phase ramp $D_k$.\n\nWe now address aliasing due to finite $k$-sampling. Suppose we sample $k$ on $M$ points\n$$\nk_p \\;=\\; k_0 + p\\,\\Delta k \\, , \\quad p \\in \\{0,1,\\dots,M-1\\} \\, , \\quad \\Delta k \\;=\\; \\frac{2\\pi}{a M} \\, ,\n$$\ncovering one Brillouin zone of width $\\frac{2\\pi}{a}$. Consider the inverse (synthesis) over the sampled $k$ values to reconstruct the field in physical space extended over $M$ cells. Denote by $m\\in\\{0,1,\\dots,M-1\\}$ the cell index so that the extended grid points are $x_{n,m} = x_n + m a$. Using the quasi-periodic factorization $u(x) = \\exp\\!\\left(i k x\\right) g(x)$ and the sampled $k$, the discrete inverse over $k$ is a finite sum of exponentials in $m$:\n$$\n\\sum_{p=0}^{M-1} \\exp\\!\\big(i k_p m a\\big) \\;=\\; \\exp\\!\\big(i k_0 m a\\big) \\sum_{p=0}^{M-1} \\exp\\!\\big(i p \\Delta k\\, m a\\big) \\;=\\; \\exp\\!\\big(i k_0 m a\\big) \\sum_{p=0}^{M-1} \\exp\\!\\left(i p \\frac{2\\pi}{M} m\\right) \\, .\n$$\nThe inner sum is a finite geometric series that evaluates to $M$ if $m$ is a multiple of $M$ and otherwise to $0$, i.e., it equals $M\\,\\delta_{m \\bmod M,\\,0}$. This shows that sampling $k$ on the uniform grid of spacing $\\Delta k = \\frac{2\\pi}{a M}$ enforces periodicity over $M$ cells in real space, reconstructing a supercell of length $M a$. Consequently, $k$ is indistinguishable modulo integer multiples of $\\Delta k$ under this sampling, which is the aliasing relation\n$$\nk \\;\\sim\\; k + r\\,\\Delta k \\quad \\text{for any integer } r \\, ,\n$$\nbecause multiplying by $\\exp\\!\\big(i r \\Delta k\\, m a\\big) = \\exp\\!\\big(i r \\frac{2\\pi}{M} m\\big)$ leaves the $M$-point finite sum invariant. This is the discrete counterpart of the Poisson summation idea: sampling in $k$ produces replication and periodicity in real space, with the supercell size $M a$ and aliasing of $k$ modulo $\\Delta k$.\n\nWe now determine the normalization constant $\\beta$ so that a discrete Parseval relation with physical weights holds:\n$$\n\\sum_{n=0}^{N-1} |u[n]|^2\\,\\Delta x \\;=\\; \\sum_{q=0}^{N-1} |C_q(k)|^2\\,\\Delta G \\, , \\quad \\Delta x \\;=\\; \\frac{a}{N} \\, , \\quad \\Delta G \\;=\\; \\frac{2\\pi}{a} \\, .\n$$\nIn matrix form,\n$$\nC(k) \\;=\\; \\beta \\,F_{\\mathrm{un}} \\,D_k \\,U \\, .\n$$\nNote that $D_k$ is unitary diagonal since $\\big| \\exp\\!\\big(-i k x_n\\big) \\big| = 1$. The unnormalized DFT satisfies $F_{\\mathrm{un}}^{H} F_{\\mathrm{un}} = N\\,I$. The weighted Parseval requirement is\n$$\nC(k)^{H} \\big(\\Delta G\\,I\\big) C(k) \\;=\\; U^{H} \\big(\\Delta x\\,I\\big) U \\, ,\n$$\nfor all $U$. Substituting $C(k)$ gives\n$$\nU^{H} D_k^{H} F_{\\mathrm{un}}^{H} \\big(|\\beta|^{2} \\Delta G\\,I\\big) F_{\\mathrm{un}} D_k U \\;=\\; U^{H} \\big(\\Delta x\\,I\\big) U \\, .\n$$\nUsing $D_k^{H} D_k = I$ and $F_{\\mathrm{un}}^{H} F_{\\mathrm{un}} = N\\,I$, we obtain the scalar condition\n$$\n|\\beta|^{2} \\,\\Delta G\\, N \\;=\\; \\Delta x \\, .\n$$\nSolving for $\\beta$ yields\n$$\n|\\beta| \\;=\\; \\sqrt{\\frac{\\Delta x}{N\\,\\Delta G}} \\;=\\; \\sqrt{\\frac{\\frac{a}{N}}{N \\cdot \\frac{2\\pi}{a}}} \\;=\\; \\sqrt{\\frac{a^{2}}{2\\pi\\,N^{2}}} \\;=\\; \\frac{a}{N\\,\\sqrt{2\\pi}} \\, .\n$$\nThe phase of $\\beta$ is arbitrary; the unique positive real normalization consistent with energy preservation is therefore\n$$\n\\beta \\;=\\; \\frac{a}{N\\,\\sqrt{2\\pi}} \\, .\n$$\nThis choice simultaneously ensures that the inverse transform (constructed via the adjoint up to the usual $N$ factor for the unnormalized DFT) exactly recovers $U$ and that the discrete Parseval relation with the physically meaningful weights $\\Delta x$ and $\\Delta G$ holds for all inputs and all $k$.", "answer": "$$\\boxed{\\frac{a}{N\\sqrt{2\\pi}}}$$", "id": "3308765"}, {"introduction": "Modeling isolated features like defects within the framework of periodic systems requires the supercell approximation, a powerful but imperfect technique. This exercise guides you through the analysis of a key numerical artifact arising from this method: spurious Bragg coupling caused by the artificial periodicity of the defect. By deriving and quantifying this aliasing error, you will develop a deeper intuition for the trade-offs involved in supercell simulations and learn how to assess the convergence of your results with respect to supercell size. [@problem_id:3308775]", "problem": "Consider one-dimensional time-harmonic electromagnetic waves governed by the scalar Helmholtz equation in a homogeneous background with a weak, localized defect. The governing equation for the electric field $E(x)$ in dimensionless units is\n$$\n\\frac{d^2 E}{dx^2} + \\omega^2 \\,\\epsilon(x)\\, E = 0,\n$$\nwhere the background permittivity is $\\epsilon_b = 1$, the wave speed is normalized to $c = 1$, and the unperturbed dispersion relation is $\\omega = |k|$ for a plane wave $\\exp(i k x)$. The defect is modeled as a weak perturbation of the permittivity,\n$$\n\\epsilon(x) = 1 + \\eta\\, u(x),\n$$\nwith $0  \\eta \\ll 1$ and a bounded, localized shape $u(x)$. In a numerical supercell approach with Floquet's theorem and Periodic Boundary Conditions (PBC), the defect is periodically replicated with supercell length $L = N a$, where $a$ is a base cell length and $N$ is the number of base cells in the supercell. The resulting periodic perturbation has a fundamental reciprocal lattice vector $G = \\frac{2\\pi}{L}$ and Fourier coefficients\n$$\nU_m = \\frac{1}{L}\\int_{0}^{L} u(x)\\, e^{-i m G x}\\, dx,\\quad m \\in \\mathbb{Z}.\n$$\nIn the nearly-free-wave approximation, spurious Bragg coupling arises near the first Brillouin-zone boundary at $k \\approx G/2$, causing a frequency band splitting driven by the coupling between $\\exp(i k x)$ and $\\exp(i (k - G) x)$ mediated by the $m=1$ harmonic of the defect’s periodic replication. This effect constitutes supercell aliasing error for defect modes because a truly isolated defect should not induce such periodic Bragg scattering.\n\nAssume a Gaussian defect shape,\n$$\nu(x) = \\exp\\!\\left(-\\frac{x^2}{2\\sigma^2}\\right),\n$$\nwhere $\\sigma$ is the width of the defect and all spatial quantities are expressed in units of $a$, so $a = 1$ is permissible without loss of generality. Work in the limit of weak perturbations appropriate for $0  \\eta \\ll 1$. Your task is to derive from first principles the leading-order expression for the normalized spurious Bragg-induced frequency splitting at the first Brillouin-zone boundary, defined as the ratio of the gap magnitude to the unperturbed frequency at $k = G/2$. Then, implement a program that evaluates this aliasing error metric for given parameter sets by exploiting the analytical Fourier transform of the Gaussian and the nearly-free-wave two-mode coupling at $k = G/2$.\n\nAll quantities are dimensionless, and the final answers should be dimensionless real numbers. Your program should compute the aliasing error for the following test suite:\n- Case $1$: $a = 1$, $N = 8$, $\\sigma = 0.15$, $\\eta = 0.02$.\n- Case $2$: $a = 1$, $N = 32$, $\\sigma = 0.15$, $\\eta = 0.02$.\n- Case $3$: $a = 1$, $N = 1$, $\\sigma = 0.15$, $\\eta = 0.02$.\n- Case $4$: $a = 1$, $N = 8$, $\\sigma = 0.50$, $\\eta = 0.02$.\n- Case $5$: $a = 1$, $N = 8$, $\\sigma = 0.15$, $\\eta = 0.00$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each result must be rounded to $8$ decimal places. For example, the output format should be\n$$\n[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5].\n$$", "solution": "The task is to derive the leading-order expression for the normalized frequency splitting at the first Brillouin-zone boundary for a $1$D Helmholtz equation with a periodic perturbation. The governing equation is:\n$$ \\frac{d^2 E}{dx^2} + \\omega^2 \\epsilon(x) E = 0 $$\nIn the supercell model, the permittivity $\\epsilon(x) = 1 + \\eta\\, u_L(x)$ is periodic with period $L=Na$, where $u_L(x)$ is the periodic replication of a single Gaussian defect $u(x) = \\exp(-x^2/(2\\sigma^2))$. The parameter $\\eta$ is a small-valued constant, $0  \\eta \\ll 1$. We can rewrite the governing equation as:\n$$ \\frac{d^2 E}{dx^2} + \\omega^2 E = -\\omega^2 \\eta\\, u_L(x) E $$\nThe term on the right-hand side acts as a perturbation. In the absence of this perturbation ($\\eta=0$), the solutions are plane waves $E(x) = \\exp(ikx)$ with the dispersion relation $\\omega = |k|$, since the background wave speed is $c=1$.\n\nWe are interested in the behavior near the first Brillouin-zone boundary, where the wave number $k$ is close to $G/2$, with $G = 2\\pi/L$ being the fundamental reciprocal lattice vector. At exactly $k=G/2$, the unperturbed forward-propagating wave $\\exp(i(G/2)x)$ and the first-order Bragg-scattered wave $\\exp(i(k-G)x) = \\exp(i(G/2-G)x) = \\exp(-i(G/2)x)$ are degenerate. Their unperturbed frequency is $\\omega_0 = |k| = G/2$.\n\nThe periodic perturbation $u_L(x)$ can be expanded in a Fourier series:\n$$ u_L(x) = \\sum_{m=-\\infty}^{\\infty} U_m e^{imGx} $$\nwhere the Fourier coefficients $U_m$ are given by $U_m = \\frac{1}{L}\\int_0^L u_L(x) e^{-imGx} dx$.\nThe perturbation couples the degenerate modes. According to the nearly-free-wave approximation, we seek a solution as a superposition of these two dominant modes:\n$$ E(x) = c_0 e^{i(G/2)x} + c_1 e^{-i(G/2)x} $$\nSubstituting this two-mode ansatz into the governing equation:\n$$ -(G/2)^2 (c_0 e^{i(G/2)x} + c_1 e^{-i(G/2)x}) + \\omega^2 (c_0 e^{i(G/2)x} + c_1 e^{-i(G/2)x}) = -\\omega^2 \\eta \\left(\\sum_m U_m e^{imGx}\\right) (c_0 e^{i(G/2)x} + c_1 e^{-i(G/2)x}) $$\nLet $\\omega_0 = G/2$. The equation becomes:\n$$ (\\omega^2 - \\omega_0^2) (c_0 e^{i\\omega_0 x} + c_1 e^{-i\\omega_0 x}) = -\\omega^2 \\eta \\sum_m U_m (c_0 e^{i(m+1)\\omega_0 x} + c_1 e^{i(m-1)\\omega_0 x}) $$\nTo obtain a system of equations for the coefficients $c_0$ and $c_1$, we project the equation onto the basis functions $e^{i\\omega_0 x}$ and $e^{-i\\omega_0 x}$. This is done by multiplying by $e^{-i\\omega_0 x}$ (for the first equation) or $e^{i\\omega_0 x}$ (for the second equation) and integrating over one period $L$. Orthogonality of the complex exponentials, $\\frac{1}{L}\\int_0^L e^{ij\\omega_0 x} e^{-il\\omega_0 x} dx = \\delta_{jl}$, simplifies the sums.\n\nFor the first equation (projection onto $e^{i\\omega_0 x}$):\n$$ (\\omega^2 - \\omega_0^2) c_0 = -\\omega^2 \\eta (U_0 c_0 + U_1 c_1) $$\nFor the second equation (projection onto $e^{-i\\omega_0 x}$):\n$$ (\\omega^2 - \\omega_0^2) c_1 = -\\omega^2 \\eta (U_{-1} c_0 + U_0 c_1) $$\nThis can be written as a $2 \\times 2$ homogeneous linear system for $(c_0, c_1)$:\n$$ \\begin{pmatrix} \\omega^2(1+\\eta U_0) - \\omega_0^2  \\omega^2 \\eta U_1 \\\\ \\omega^2 \\eta U_{-1}  \\omega^2(1+\\eta U_0) - \\omega_0^2 \\end{pmatrix} \\begin{pmatrix} c_0 \\\\ c_1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} $$\nFor a non-trivial solution, the determinant of the matrix must be zero. The defect shape $u(x)$ is real and even, so its Fourier coefficients are real and even, i.e., $U_m = U_{-m} \\in \\mathbb{R}$.\n$$ (\\omega^2(1+\\eta U_0) - \\omega_0^2)^2 - (\\omega^2 \\eta U_1)^2 = 0 $$\n$$ \\omega^2(1+\\eta U_0) - \\omega_0^2 = \\pm \\omega^2 \\eta U_1 $$\nThis yields two solutions for $\\omega^2$:\n$$ \\omega^2(1 + \\eta U_0 \\mp \\eta U_1) = \\omega_0^2 \\implies \\omega^2_\\pm = \\frac{\\omega_0^2}{1 + \\eta(U_0 \\mp U_1)} $$\nThe frequencies of the upper ($u$) and lower ($l$) band edges are thus $\\omega_u = \\omega_+$ and $\\omega_l = \\omega_-$.\n$$ \\omega_u = \\frac{\\omega_0}{\\sqrt{1 + \\eta(U_0 - U_1)}} \\quad , \\quad \\omega_l = \\frac{\\omega_0}{\\sqrt{1 + \\eta(U_0 + U_1)}} $$\nThe frequency splitting is $\\Delta\\omega = \\omega_u - \\omega_l$. The normalized splitting is $\\Delta\\omega / \\omega_0$:\n$$ \\frac{\\Delta\\omega}{\\omega_0} = \\frac{1}{\\sqrt{1 + \\eta(U_0 - U_1)}} - \\frac{1}{\\sqrt{1 + \\eta(U_0 + U_1)}} $$\nSince we are interested in the leading-order expression for $\\eta \\ll 1$, we use the Taylor expansion $(1+x)^{-1/2} \\approx 1-x/2$.\n$$ \\frac{\\Delta\\omega}{\\omega_0} \\approx \\left(1 - \\frac{\\eta}{2}(U_0 - U_1)\\right) - \\left(1 - \\frac{\\eta}{2}(U_0 + U_1)\\right) = -\\frac{\\eta}{2}U_0 + \\frac{\\eta}{2}U_1 + \\frac{\\eta}{2}U_0 + \\frac{\\eta}{2}U_1 = \\eta U_1 $$\nSince $U_1$ can be negative for a general shape, the splitting magnitude is given by $\\eta|U_1|$. For the specified Gaussian, $U_1  0$.\n\nThe final step is to calculate the Fourier coefficient $U_1$. The coefficient for the periodic array of defects, $u_L(x) = \\sum_j u(x-jL)$, is:\n$$ U_m = \\frac{1}{L} \\int_{-L/2}^{L/2} \\left( \\sum_{j=-\\infty}^{\\infty} u(x-jL) \\right) e^{-imGx} dx $$\nThis can be shown to be equivalent to $1/L$ times the Fourier transform of a single defect shape $u(x)$, evaluated at the reciprocal lattice points $k_m=mG$. This approximation is excellent when the defect is well-localized within the supercell ($\\sigma \\ll L$).\n$$ U_m = \\frac{1}{L} \\int_{-\\infty}^{\\infty} u(x) e^{-imGx} dx = \\frac{1}{L} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right) e^{-imGx} dx $$\nThe integral is the standard Fourier transform of a Gaussian function. The transform of $\\exp(-ax^2)$ is $\\sqrt{\\pi/a} \\exp(-k^2/(4a))$. Here, $a = 1/(2\\sigma^2)$ and $k=mG$.\n$$ \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right) e^{-imGx} dx = \\sqrt{2\\pi\\sigma^2} \\exp\\left(-\\frac{(mG)^2 \\sigma^2}{2}\\right) $$\nTherefore, the Fourier coefficient is:\n$$ U_m = \\frac{\\sqrt{2\\pi}\\sigma}{L} \\exp\\left(-\\frac{m^2 G^2 \\sigma^2}{2}\\right) $$\nSubstituting $m=1$ and $G=2\\pi/L$:\n$$ U_1 = \\frac{\\sqrt{2\\pi}\\sigma}{L} \\exp\\left(-\\frac{(2\\pi/L)^2 \\sigma^2}{2}\\right) = \\frac{\\sqrt{2\\pi}\\sigma}{L} \\exp\\left(-\\frac{2\\pi^2\\sigma^2}{L^2}\\right) $$\nThe final expression for the normalized aliasing error is:\n$$ \\text{Error} = \\eta U_1 = \\eta \\frac{\\sqrt{2\\pi}\\sigma}{L} \\exp\\left(-\\frac{2\\pi^2\\sigma^2}{L^2}\\right) $$\nThis is the formula to be implemented. We set the base cell length $a=1$, so the supercell length is $L=N$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the normalized spurious Bragg-induced frequency splitting for a\n    1D Helmholtz equation with a periodic Gaussian permittivity defect.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (a, N, sigma, eta)\n        (1, 8, 0.15, 0.02),\n        (1, 32, 0.15, 0.02),\n        (1, 1, 0.15, 0.02),\n        (1, 8, 0.50, 0.02),\n        (1, 8, 0.15, 0.00),\n    ]\n\n    results = []\n    for case in test_cases:\n        a, N, sigma, eta = case\n\n        # The normalized splitting is given by eta * U_1, where U_1 is the\n        # first Fourier coefficient of the periodic defect potential.\n        # If eta is 0, the perturbation is zero, so the splitting is zero.\n        if eta == 0:\n            results.append(f\"{0.0:.8f}\")\n            continue\n\n        # Supercell length L = N * a\n        L = N * a\n\n        # The Fourier coefficient U_1 is derived from the analytical\n        # Fourier transform of a single Gaussian function.\n        # U_1 = (sqrt(2*pi)*sigma / L) * exp(-2*pi^2*sigma^2 / L^2)\n        \n        prefactor = (np.sqrt(2 * np.pi) * sigma) / L\n        exponent_arg = -2 * np.pi**2 * sigma**2 / L**2\n        exp_term = np.exp(exponent_arg)\n        \n        U1 = prefactor * exp_term\n\n        # The aliasing error metric is the normalized frequency splitting\n        aliasing_error = eta * U1\n        \n        results.append(f\"{aliasing_error:.8f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3308775"}, {"introduction": "Beyond direct eigensolvers, the spectral properties of periodic structures can be uncovered by analyzing their response to external excitations, a technique common in both experiment and advanced computation. This practice introduces a powerful method to extract the band structure, $\\omega(k)$, from synthetically generated frequency-domain response data by using harmonic inversion. You will implement a workflow that mimics how one might probe a system's resonances, transforming a driven response into a direct map of its underlying eigenmodes, a cornerstone of modern computational spectroscopy. [@problem_id:3308797]", "problem": "Consider the frequency-domain response of the cell-averaged electric field in a one-dimensional periodic electromagnetic structure of unit-cell length $a$, subject to Bloch-periodic boundary conditions. For a given Bloch wavevector $\\mathbf{k}$ (in one dimension, $\\mathbf{k}=k\\hat{x}$), the forced frequency-domain solution under a spatially periodic source with Bloch phase satisfies Floquet's theorem: any field can be represented as $E_{k}(x)=u_{k}(x)\\mathrm{e}^{\\mathrm{i}kx}$ where $u_{k}(x)$ is periodic with the unit-cell. In the frequency domain, the cell-averaged field $\\overline{E}(\\omega;k)$ exhibits resonances at the eigenfrequencies $\\,\\omega_{n}(k)\\,$ of the Bloch modes, with each resonance broadened by material loss or radiation represented as a small damping rate.\n\nStarting from Maxwell's equations in the frequency domain, the structure is modeled by the linear operator equation for the field $E$ under a source $J$, $\\nabla\\times\\mu^{-1}\\nabla\\times E-\\omega^{2}\\varepsilon E=J$, and the Floquet condition $E(x+a)=E(x)\\mathrm{e}^{\\mathrm{i}ka}$. By Floquet's theorem, the spectrum of the operator for each $k$ yields a discrete set of complex poles $\\Omega_{n}(k)=\\omega_{n}(k)-\\mathrm{i}\\gamma_{n}$ in the resolvent of the operator, which implies that the scalar cell-averaged frequency response can be represented as a rational function of $\\omega$ with simple poles,\n$$\n\\overline{E}(\\omega;k)=\\sum_{n}\\frac{C_{n}(k)}{\\omega-\\Omega_{n}(k)}.\n$$\nHere $C_{n}(k)$ encodes the overlap of the source with the $n$th Bloch mode and $\\gamma_{n}0$ is the damping. The time-domain impulse response $h(t;k)$ obtained by inverse Fourier transformation of $\\overline{E}(\\omega;k)$ is then a finite sum of decaying complex exponentials for $t0$,\n$$\nh(t;k)=\\sum_{n}A_{n}(k)\\,\\mathrm{e}^{\\mathrm{i}\\Omega_{n}(k)t},\n$$\nwhere $A_{n}(k)$ is a constant related to $C_{n}(k)$ by complex residue calculus. Harmonic inversion methods such as Prony's method can recover the complex frequencies $\\Omega_{n}(k)$ from uniformly sampled time-domain data $h(t_{m};k)$, and thus the band structure $\\omega_{n}(k)=\\mathrm{Re}\\,\\Omega_{n}(k)$.\n\nIn this problem, you will recover an approximate band structure from synthetic frequency-domain driven simulations obeying Bloch-periodic forcing. For numerical tractability and clarity, assume a two-band model ($n\\in\\{1,2\\}$) with dispersion relations that emulate a tight-binding-like coupling in a one-dimensional periodic photonic medium:\n$$\n\\omega_{1}(k)=\\sqrt{\\omega_{01}^{2}+4J_{1}\\sin^{2}\\!\\left(\\frac{ka}{2}\\right)},\\qquad\n\\omega_{2}(k)=\\sqrt{\\omega_{02}^{2}+4J_{2}\\sin^{2}\\!\\left(\\frac{ka}{2}\\right)}.\n$$\nAssume small constant damping rates $\\gamma_{1}0$ and $\\gamma_{2}0$ with complex pole locations $\\Omega_{1}(k)=\\omega_{1}(k)-\\mathrm{i}\\gamma_{1}$ and $\\Omega_{2}(k)=\\omega_{2}(k)-\\mathrm{i}\\gamma_{2}$. Let the frequency-domain driven response for the cell-averaged field be\n$$\n\\overline{E}(\\omega;k)=\\frac{C_{1}(k)}{\\omega-\\Omega_{1}(k)}+\\frac{C_{2}(k)}{\\omega-\\Omega_{2}(k)},\n$$\nwith $C_{1}(k)=1+0.4\\cos(ka)$ and $C_{2}(k)=0.7+0.3\\sin(ka)$.\n\nYour task is to:\n- Construct the synthetic frequency-domain data by evaluating $\\overline{E}(\\omega;k)$ on a uniform angular-frequency grid $\\omega\\in[-W,W]$ and numerically approximate the time-domain impulse response $h(t;k)$ via the discrete inverse Fourier integral\n$$\nh(t;k)\\approx\\frac{\\Delta\\omega}{2\\pi}\\sum_{m=0}^{M-1}\\overline{E}(\\omega_{m};k)\\,\\mathrm{e}^{\\mathrm{i}\\omega_{m}t}.\n$$\nHere $\\omega_{m}$ are uniformly spaced samples, $\\Delta\\omega$ is the grid spacing, and $M$ is the number of samples. Use $t_{n}=n\\Delta t$ for $n=0,1,\\ldots,N-1$ to form a uniform time sample.\n- Apply harmonic inversion using a linear prediction (Prony) method of order $P=2$ to the time samples $h(t_{n};k)$ to estimate the two complex frequencies $\\Omega_{1}(k)$ and $\\Omega_{2}(k)$, then report $\\omega_{1}(k)=\\mathrm{Re}\\,\\Omega_{1}(k)$ and $\\omega_{2}(k)=\\mathrm{Re}\\,\\Omega_{2}(k)$.\n- Sort the two recovered values for each $k$ in ascending order and round to six decimal places.\n\nUse the following parameter values, all expressed in angular frequency units where applicable:\n- Unit-cell length $a=1$.\n- Band parameters $\\omega_{01}=10$, $\\omega_{02}=14$, $J_{1}=3$, $J_{2}=1.5$.\n- Damping rates $\\gamma_{1}=0.1$, $\\gamma_{2}=0.08$.\n- Frequency grid half-width $W=40$ with $M=4096$ uniformly spaced samples from $-W$ to $W$.\n- Time sampling step $\\Delta t=0.05$ and $N=128$ samples (i.e., $t_{n}=n\\Delta t$).\n- Linear prediction order $P=2$.\n\nTest suite:\n- Case $1$: $k=0$.\n- Case $2$: $k=\\pi/a$.\n- Case $3$: $k=(\\pi/2)/a$.\n\nAnswer specification:\n- For each test case, your program must return a list of the two recovered angular frequencies $\\left[\\omega_{1}(k),\\omega_{2}(k)\\right]$ in $\\mathrm{rad/s}$, sorted in ascending order and rounded to six decimal places.\n- Your program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets, with each test case represented by its own bracketed list and no spaces, for example, $\\left[\\left[\\omega_{1}(k_{1}),\\omega_{2}(k_{1})\\right],\\left[\\omega_{1}(k_{2}),\\omega_{2}(k_{2})\\right],\\left[\\omega_{1}(k_{3}),\\omega_{2}(k_{3})\\right]\\right]$.\n\nAll angular frequencies must be reported in $\\mathrm{rad/s}$, rounded to six decimal places. Angles such as $ka$ must be evaluated in radians. Ensure scientific realism by using the provided parameters and carrying out the specified numerical approximations and harmonic inversion. No external data is permitted; the program must be self-contained and must compute the synthetic frequency-domain response before performing the inversion.", "solution": "### Principle-Based Solution\n\nThe objective is to recover the band structure, i.e., the resonant angular frequencies $\\omega_1(k)$ and $\\omega_2(k)$, from synthetically generated frequency-domain data. The solution methodology follows a four-step process for each specified wavevector $k$.\n\n#### Step 1: Synthesize Frequency-Domain Data\n\nFirst, we construct the synthetic frequency-domain response $\\overline{E}(\\omega;k)$ based on the provided two-band model. For a given wavevector $k$, we calculate the parameters of the two resonances.\n\nThe resonant frequencies $\\omega_{n}(k)$ are given by:\n$$\n\\omega_{1}(k)=\\sqrt{\\omega_{01}^{2}+4J_{1}\\sin^{2}\\!\\left(\\frac{ka}{2}\\right)} \\quad \\text{and} \\quad \\omega_{2}(k)=\\sqrt{\\omega_{02}^{2}+4J_{2}\\sin^{2}\\!\\left(\\frac{ka}{2}\\right)}\n$$\nThe complex poles in the frequency domain, incorporating damping, are $\\Omega_{n}(k)=\\omega_{n}(k)-\\mathrm{i}\\gamma_{n}$:\n$$\n\\Omega_{1}(k) = \\omega_{1}(k)-\\mathrm{i}\\gamma_{1} \\quad \\text{and} \\quad \\Omega_{2}(k) = \\omega_{2}(k)-\\mathrm{i}\\gamma_{2}\n$$\nThe source coupling coefficients $C_{n}(k)$ are:\n$$\nC_{1}(k)=1+0.4\\cos(ka) \\quad \\text{and} \\quad C_{2}(k)=0.7+0.3\\sin(ka)\n$$\nUsing the specified parameters ($a=1, \\omega_{01}=10, \\omega_{02}=14, J_{1}=3, J_{2}=1.5, \\gamma_{1}=0.1, \\gamma_{2}=0.08$), we evaluate $\\overline{E}(\\omega;k)$ on a uniform angular frequency grid $\\omega_m$ spanning $[ -W, W ] = [ -40, 40 ]$ with $M=4096$ points. The frequency step is $\\Delta\\omega = 2W / (M-1)$.\n\n#### Step 2: Compute Time-Domain Impulse Response\n\nThe time-domain impulse response $h(t;k)$ is the inverse Fourier transform of $\\overline{E}(\\omega;k)$. We numerically approximate this integral using a discrete sum for $N=128$ time points $t_n = n\\Delta t$ where $\\Delta t=0.05$ and $n \\in \\{0, 1, \\dots, N-1\\}$:\n$$\nh(t_n;k) \\approx \\frac{\\Delta\\omega}{2\\pi}\\sum_{m=0}^{M-1}\\overline{E}(\\omega_{m};k)\\,\\mathrm{e}^{\\mathrm{i}\\omega_{m}t_n}\n$$\nThis computation yields a set of $N$ complex-valued time samples, $h_n \\equiv h(t_n; k)$. This operation is effectively a matrix-vector product between an exponential matrix and the frequency-data vector.\n\n#### Step 3: Apply Harmonic Inversion (Linear Prediction)\n\nThe time-domain signal is modeled as a sum of $P=2$ damped complex exponentials:\n$$\nh_n = \\sum_{j=1}^{P} A_j z_j^n\n$$\nwhere $z_j = \\mathrm{e}^{\\mathrm{i}\\Omega_j\\Delta t}$ are the \"poles\" in the z-domain. Such a signal satisfies a linear prediction recurrence relation of order $P$:\n$$\nh_n = -\\sum_{l=1}^{P} c_l h_{n-l} \\quad \\text{for } n \\ge P\n$$\nThe coefficients $c_l$ are found by solving an overdetermined system of linear equations in a least-squares sense. We construct a matrix $\\mathbf{H}$ and a vector $\\mathbf{h}'$ from the time samples $h_n$:\n$$\n\\mathbf{H} = \\begin{pmatrix}\nh_{P-1}  h_{P-2}  \\dots  h_0 \\\\\nh_{P}  h_{P-1}  \\dots  h_1 \\\\\n\\vdots  \\vdots  \\ddots  \\vdots \\\\\nh_{N-2}  h_{N-3}  \\dots  h_{N-1-P}\n\\end{pmatrix}, \\quad\n\\mathbf{h}' = \\begin{pmatrix}\nh_P \\\\\nh_{P+1} \\\\\n\\vdots \\\\\nh_{N-1}\n\\end{pmatrix}\n$$\nWith $P=2$, this becomes:\n$$\n\\begin{pmatrix}\nh_{1}  h_{0} \\\\\nh_{2}  h_{1} \\\\\n\\vdots  \\vdots \\\\\nh_{N-2}  h_{N-3}\n\\end{pmatrix}\n\\begin{pmatrix} c_1 \\\\ c_2 \\end{pmatrix}\n= -\n\\begin{pmatrix} h_2 \\\\ h_3 \\\\ \\vdots \\\\ h_{N-1} \\end{pmatrix}\n$$\nWe solve the system $\\mathbf{H}\\mathbf{c}=-\\mathbf{h}'$ for the coefficient vector $\\mathbf{c}=[c_1, c_2, \\dots, c_P]^T$ using a standard least-squares solver.\n\n#### Step 4: Recover Frequencies\n\nThe coefficients $c_l$ define a characteristic polynomial whose roots are the z-domain poles $z_j$:\n$$\nz^P + c_1 z^{P-1} + \\dots + c_P = 0\n$$\nWe find the $P=2$ roots of this polynomial, $z_1$ and $z_2$. These roots are related to the complex frequencies $\\Omega_j$ by the definition $z_j = \\mathrm{e}^{\\mathrm{i}\\Omega_j\\Delta t}$. We can invert this relationship to find $\\Omega_j$:\n$$\n\\mathrm{i}\\Omega_j\\Delta t = \\ln(z_j) \\implies \\Omega_j = \\frac{-\\mathrm{i}\\ln(z_j)}{\\Delta t}\n$$\nwhere $\\ln$ is the complex natural logarithm. The real part of $\\Omega_j$ is the desired angular frequency $\\omega_j = \\mathrm{Re}(\\Omega_j)$.\n\nFinally, for each test case $k$, we obtain two frequencies, which are then sorted in ascending order and rounded to six decimal places, as specified. This procedure is repeated for all $k$ values in the test suite.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy is not used, as numpy is sufficient.\n\ndef solve():\n    \"\"\"\n    Solves the harmonic inversion problem for a 1D photonic crystal.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # k (wavevector)\n        0.0,\n        np.pi,\n        np.pi / 2.0,\n    ]\n\n    # Define parameters from the problem statement\n    a = 1.0\n    omega_01 = 10.0\n    omega_02 = 14.0\n    J1 = 3.0\n    J2 = 1.5\n    gamma1 = 0.1\n    gamma2 = 0.08\n    \n    W = 40.0\n    M = 4096\n    \n    dt = 0.05\n    N = 128\n    P = 2\n    \n    # Create the frequency and time grids\n    omega_grid = np.linspace(-W, W, M, dtype=np.float64)\n    d_omega = (2 * W) / (M - 1)\n    t_grid = np.arange(N, dtype=np.float64) * dt\n\n    results = []\n    for k in test_cases:\n        # Step 1: Calculate model parameters for the given k\n        omega1_k = np.sqrt(omega_01**2 + 4 * J1 * np.sin(k * a / 2)**2)\n        omega2_k = np.sqrt(omega_02**2 + 4 * J2 * np.sin(k * a / 2)**2)\n        \n        Omega1_k = omega1_k - 1j * gamma1\n        Omega2_k = omega2_k - 1j * gamma2\n        \n        C1_k = 1.0 + 0.4 * np.cos(k * a)\n        C2_k = 0.7 + 0.3 * np.sin(k * a)\n        \n        # Step 2: Generate synthetic frequency-domain data\n        E_bar = C1_k / (omega_grid - Omega1_k) + C2_k / (omega_grid - Omega2_k)\n        \n        # Step 3: Compute time-domain impulse response via numerical inverse Fourier Transform\n        # Vectorized calculation for efficiency\n        exp_matrix = np.exp(1j * np.outer(t_grid, omega_grid))\n        h = (d_omega / (2 * np.pi)) * np.dot(exp_matrix, E_bar)\n\n        # Step 4: Apply harmonic inversion (Prony's Method / Linear Prediction)\n        # Set up the linear system Hc = -h' to find prediction coefficients c\n        \n        # Construct the matrix H of shape (N-P, P)\n        # The j-th column is h[P-1-j : N-1-j]\n        H = np.array([h[P - 1 - j : N - 1 - j] for j in range(P)], dtype=np.complex128).T\n\n        # Construct the vector h' to be predicted\n        h_prime = h[P:N]\n        \n        # Solve the least-squares problem Hc = -h'\n        c, _, _, _ = np.linalg.lstsq(H, -h_prime, rcond=None)\n        \n        # Step 5: Find the roots of the characteristic polynomial z^P + c_1*z^{P-1} + ... = 0\n        poly_coeffs = np.concatenate(([1.0], c))\n        z_roots = np.roots(poly_coeffs)\n        \n        # Step 6: Recover the complex frequencies Ω from the roots z\n        # Ω_j = -i * log(z_j) / Δt\n        Omega_recovered = -1j * np.log(z_roots) / dt\n        \n        # Step 7: Extract real parts (angular frequencies), sort, and round\n        omega_recovered = np.real(Omega_recovered)\n        omega_sorted = np.sort(omega_recovered)\n        omega_rounded = [np.round(val, 6) for val in omega_sorted]\n        \n        results.append(omega_rounded)\n\n    # Final print statement in the exact required format.\n    # e.g., [[val1,val2],[val3,val4]]\n    list_of_strings = [f\"[{res[0]},{res[1]}]\" for res in results]\n    print(f\"[{','.join(list_of_strings)}]\")\n\nsolve()\n```", "id": "3308797"}]}