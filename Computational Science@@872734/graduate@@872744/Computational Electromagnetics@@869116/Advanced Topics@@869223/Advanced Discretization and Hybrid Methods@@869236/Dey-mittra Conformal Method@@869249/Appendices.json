{"hands_on_practices": [{"introduction": "The core advantage of the Dey-Mittra method over simple staircasing lies in its improved geometric accuracy, which translates to a higher order of convergence for the electromagnetic fields. This practice guides you through a theoretical derivation to prove this advantage by analyzing how geometric placement errors of an approximate boundary affect the tangential electric field, allowing you to directly establish the first-order accuracy of staircasing versus the second-order accuracy of the conformal method [@problem_id:3298046].", "problem": "Consider time-harmonic Maxwell equations in a simply connected domain with a smooth Perfect Electric Conductor (PEC) boundary $\\Gamma$ of class $\\mathcal{C}^{2}$. Let the outward unit normal be $\\hat{\\boldsymbol{n}}$, and let the tangential electric field trace be $E_{t}=\\hat{\\boldsymbol{t}}\\cdot\\boldsymbol{E}$ for any unit tangent $\\hat{\\boldsymbol{t}}$ to $\\Gamma$. The exact boundary condition on a PEC is $E_{t}|_{\\Gamma}=0$. Assume the exact solution is smooth in a tubular neighborhood of $\\Gamma$, so that in local normal coordinates $(s,n)$ with $n$ the signed distance to $\\Gamma$ along $\\hat{\\boldsymbol{n}}$, the exact tangential field admits the expansion\n$$\nE_{t}(s,n)=A(s)\\,n+B(s)\\,n^{2}+\\mathcal{O}(n^{3}),\n$$\nwith $A(s)=\\partial E_{t}/\\partial n|_{\\Gamma}$ finite and nonzero in general.\n\nLet a uniform Cartesian grid of spacing $h$ be used. Compare two boundary representations:\n- The staircased boundary used by the standard Yee finite-difference time-domain (FDTD) scheme, denoted $\\Gamma_{\\text{stair}}$, which is a union of grid-aligned planar faces that approximate $\\Gamma$.\n- The Dey–Mittra conformal method boundary, denoted $\\Gamma_{\\text{DM}}$, which within each cut cell replaces the portion of $\\Gamma$ by a plane determined from its intersection with grid edges and modifies curl operators via area and length fractions (the Dey–Mittra conformal FDTD).\n\nAssume the principal curvatures of $\\Gamma$ are bounded, and let $\\kappa(s)$ denote a representative curvature magnitude at arclength coordinate $s$ (for a surface, you may take $\\kappa(s)$ to be the maximum of the principal curvatures in magnitude). Let $\\delta n_{\\text{stair}}(s)$ and $\\delta n_{\\text{DM}}(s)$ denote the signed normal offsets from $\\Gamma$ to $\\Gamma_{\\text{stair}}$ and to $\\Gamma_{\\text{DM}}$, respectively, measured along $\\hat{\\boldsymbol{n}}$. Using only:\n- the PEC boundary condition,\n- the smoothness (Taylor expansion) of $E_{t}(s,n)$ in the normal coordinate,\n- geometric approximation properties of $\\Gamma_{\\text{stair}}$ and $\\Gamma_{\\text{DM}}$ inferred from their constructions and the smoothness of $\\Gamma$,\nderive the leading-order scaling, with respect to $h$, of the spurious tangential electric field on the true boundary produced by imposing $E_{t}=0$ on the approximate boundaries. That is, derive the orders $p_{\\text{stair}}$ and $p_{\\text{DM}}$ in\n$$\n\\left|E_{t}^{\\text{num}}(s,0)\\right|\\sim C_{\\text{stair}}(s)\\,h^{p_{\\text{stair}}}\n\\quad\\text{and}\\quad\n\\left|E_{t}^{\\text{num}}(s,0)\\right|\\sim C_{\\text{DM}}(s)\\,h^{p_{\\text{DM}}},\n$$\nfor $h\\to 0$, where $C_{\\text{stair}}(s)$ and $C_{\\text{DM}}(s)$ are coefficients independent of $h$. Your derivation must explicitly connect the geometry-induced offsets $\\delta n_{\\text{stair}}$ and $\\delta n_{\\text{DM}}$ to $E_{t}^{\\text{num}}(s,0)$ via the normal Taylor expansion, and must argue the offset scalings from geometric considerations of $\\Gamma_{\\text{stair}}$ and $\\Gamma_{\\text{DM}}$.\n\nProvide as your final answer the pair $\\left(p_{\\text{stair}},\\,p_{\\text{DM}}\\right)$ as a row matrix. Do not include units. No numerical rounding is required.", "solution": "The problem is first validated to be self-contained, scientifically grounded in computational electromagnetics, and well-posed. All provided information is consistent and sufficient for deriving a unique solution.\n\nThe core of the problem is to determine how an error in the geometric representation of a Perfect Electric Conductor (PEC) boundary translates into an error in the tangential electric field, $E_t$, on the true boundary. The numerical methods impose the PEC boundary condition, $E_t = 0$, not on the true smooth boundary $\\Gamma$, but on an approximate boundary, which we may denote generally as $\\Gamma_{\\text{approx}}$. This approximate boundary is located at a signed normal distance $n = \\delta n(s)$ from the true boundary, where $s$ is the arclength coordinate along $\\Gamma$.\n\nLet $E_t^{\\text{num}}(s,n)$ denote the tangential electric field component of the numerical solution in local normal coordinates $(s,n)$. The numerical scheme enforces the boundary condition on $\\Gamma_{\\text{approx}}$, which means:\n$$\nE_t^{\\text{num}}(s, \\delta n(s)) = 0\n$$\nWe are asked to find the spurious tangential field on the true boundary $\\Gamma$, which corresponds to the location $n=0$. This is the value $E_t^{\\text{num}}(s, 0)$. Assuming the numerical solution $E_t^{\\text{num}}(s, n)$ is a smooth function of the normal coordinate $n$ for small $n$, we can write its Taylor series expansion around $n=0$:\n$$\nE_t^{\\text{num}}(s, n) = E_t^{\\text{num}}(s, 0) + \\left.\\frac{\\partial E_t^{\\text{num}}}{\\partial n}\\right|_{n=0} n + \\mathcal{O}(n^2)\n$$\nSubstituting $n = \\delta n(s)$ and using the condition $E_t^{\\text{num}}(s, \\delta n(s)) = 0$, we get:\n$$\n0 = E_t^{\\text{num}}(s, 0) + \\left.\\frac{\\partial E_t^{\\text{num}}}{\\partial n}\\right|_{n=0} \\delta n(s) + \\mathcal{O}((\\delta n(s))^2)\n$$\nSolving for the spurious field on the true boundary, we find:\n$$\nE_t^{\\text{num}}(s, 0) = - \\left.\\frac{\\partial E_t^{\\text{num}}}{\\partial n}\\right|_{n=0} \\delta n(s) - \\mathcal{O}((\\delta n(s))^2)\n$$\nFor a convergent numerical scheme, as the grid spacing $h \\to 0$, the numerical solution and its derivatives should converge to those of the exact solution. The problem provides the expansion for the exact field near the boundary: $E_t(s,n) = A(s)n + B(s)n^2 + \\mathcal{O}(n^3)$. The normal derivative of the exact field at the boundary is $\\partial E_t/\\partial n|_{n=0} = A(s)$. Therefore, we can approximate the derivative of the numerical solution by this value:\n$$\n\\left.\\frac{\\partial E_t^{\\text{num}}}{\\partial n}\\right|_{n=0} \\approx \\left.\\frac{\\partial E_t}{\\partial n}\\right|_{n=0} = A(s)\n$$\nThe problem states that $A(s)$ is finite and nonzero in general. Thus, to leading order, the spurious tangential field is directly proportional to the geometric offset of the approximate boundary:\n$$\nE_t^{\\text{num}}(s, 0) \\approx -A(s) \\delta n(s)\n$$\nThe magnitude of the error is therefore $|E_t^{\\text{num}}(s, 0)| \\sim |A(s)| |\\delta n(s)|$. The task reduces to determining the order of scaling of the normal offset $|\\delta n(s)|$ with respect to the grid spacing $h$ for the two specified boundary representations.\n\n**Staircase Method ($\\Gamma_{\\text{stair}}$)**\n\nThe staircase approximation represents the smooth boundary $\\Gamma$ with a collection of planar faces that are aligned with the axes of the Cartesian grid. For any point on the smooth boundary $\\Gamma$ that is not at a location where the normal is perfectly aligned with a grid axis, the staircase boundary $\\Gamma_{\\text{stair}}$ will be locally displaced. The maximum distance between a point on $\\Gamma$ and the faces of the grid cell containing it is fundamentally limited by the size of the cell, $h$. The normal offset $\\delta n_{\\text{stair}}(s)$ is the projection of this displacement onto the normal direction $\\hat{\\boldsymbol{n}}(s)$. Except for special cases (e.g., a planar boundary aligned with the grid), this offset will be, at almost all points $s$, of the order of the grid spacing $h$.\nMore formally, the distance from a point $P \\in \\Gamma$ to the discrete boundary $\\Gamma_{\\text{stair}}$ is bounded by a constant times $h$. Thus, we have:\n$$\n|\\delta n_{\\text{stair}}(s)| = \\mathcal{O}(h)\n$$\nThis is a first-order geometric approximation error. Substituting this scaling into our error expression gives the scaling of the spurious tangential field:\n$$\n|E_t^{\\text{num}}(s,0)| \\sim |A(s)| |\\delta n_{\\text{stair}}(s)| = \\mathcal{O}(h)\n$$\nComparing this with the desired form $|E_t^{\\text{num}}(s,0)| \\sim C_{\\text{stair}}(s) h^{p_{\\text{stair}}}$, we identify the order of accuracy for the staircase method as:\n$$\np_{\\text{stair}} = 1\n$$\n\n**Dey–Mittra Conformal Method ($\\Gamma_{\\text{DM}}$)**\n\nThe Dey–Mittra method provides a more sophisticated approximation. Within each grid cell that is \"cut\" by the boundary $\\Gamma$, the method replaces the curved segment of $\\Gamma$ with a planar facet, $\\Gamma_{\\text{DM}}$. This facet is constructed based on the intersection points of the true boundary $\\Gamma$ with the edges of the grid cell.\nTo analyze the geometric error, consider a local coordinate system at a point on $\\Gamma$, with the origin at the point, one axis tangent to $\\Gamma$, and the other normal to it. Since $\\Gamma$ is of class $\\mathcal{C}^2$, it can be locally approximated by a parabola. The function describing the boundary is of the form $n(t) = \\frac{1}{2}\\kappa t^2 + \\mathcal{O}(t^3)$, where $t$ is the tangential coordinate and $\\kappa$ is the local curvature. The Dey–Mittra approximation, in this view, amounts to replacing this parabolic arc with its chord. The length of this chord is of order $h$.\nA standard geometric result states that the maximum distance between a parabolic arc and its chord is proportional to the curvature and the square of the chord's length. The error between the curve $y(x) = \\frac{1}{2}\\kappa x^2$ and the chord connecting $(\\pm L/2, \\frac{1}{2}\\kappa(L/2)^2)$ is maximal at $x=0$, with a value of $\\frac{1}{8}\\kappa L^2$. Since the characteristic length $L$ scales with the grid size $h$, the normal offset $\\delta n_{\\text{DM}}(s)$ is proportional to the local curvature $\\kappa(s)$ and $h^2$.\n$$\n|\\delta n_{\\text{DM}}(s)| = \\mathcal{O}(\\kappa(s) h^2)\n$$\nAs the problem states that the curvature is bounded, this represents a second-order geometric approximation error:\n$$\n|\\delta n_{\\text{DM}}(s)| = \\mathcal{O}(h^2)\n$$\nSubstituting this improved geometric scaling into the expression for the field error:\n$$\n|E_t^{\\text{num}}(s,0)| \\sim |A(s)| |\\delta n_{\\text{DM}}(s)| = \\mathcal{O}(h^2)\n$$\nComparing this with the form $|E_t^{\\text{num}}(s,0)| \\sim C_{\\text{DM}}(s) h^{p_{\\text{DM}}}$, we identify the order of accuracy for the Dey–Mittra conformal method as:\n$$\np_{\\text{DM}} = 2\n$$\nIn summary, the dominant error in imposing the PEC boundary condition arises from the misplacement of the boundary. The first-order geometric error of the staircase method leads to a first-order field error, while the second-order geometric error of the Dey-Mittra conformal method leads to a second-order field error.\n\nThe resulting orders are $p_{\\text{stair}}=1$ and $p_{\\text{DM}}=2$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1  2\n\\end{pmatrix}\n}\n$$", "id": "3298046"}, {"introduction": "Inaccuracies in modeling the geometry of a resonant cavity lead to systematic errors in the computed resonant frequencies, a phenomenon known as frequency bias. This coding exercise provides a tangible demonstration of theoretical accuracy concepts by having you implement a model that shows how the staircasing method's tendency to underestimate the cavity volume results in an overestimation of the resonant frequency, and how the more accurate Dey-Mittra approach significantly reduces this bias [@problem_id:3298105].", "problem": "Consider a two-dimensional, source-free, time-harmonic electromagnetic cavity problem in vacuum. From Maxwell’s equations and the Perfect Electric Conductor (PEC) boundary condition (vanishing tangential electric field at the PEC surface), the out-of-plane electric field for a transverse electric polarization ($\\mathrm{TE}_z$) in a simply connected cavity reduces to the scalar Dirichlet Helmholtz eigenproblem on a domain $\\Omega \\subset \\mathbb{R}^2$:\n$$\n\\nabla^2 u + k^2 u = 0 \\ \\ \\text{in } \\Omega, \\qquad u=0 \\ \\ \\text{on } \\partial \\Omega,\n$$\nwhere $u$ represents the out-of-plane electric field component, and $k$ is the wavenumber. For a circular cavity of radius $R$, the fundamental wavenumber is $k_\\star = j_{0,1}/R$, where $j_{0,1}$ is the first positive root of the Bessel function $J_0$. The corresponding fundamental frequency is $f_\\star = c\\,k_\\star/(2\\pi)$, where $c$ is the speed of light. In this problem, use dimensionless units with $R=1$ and take $c$ as a positive constant that cancels in ratios so that all computed frequency ratios are dimensionless.\n\nA Cartesian Finite-Difference Time-Domain (FDTD) Yee-grid discretization of a curved PEC boundary introduces geometric error. A standard “staircased Yee” approximation treats each grid cell as either entirely inside or entirely outside the cavity based on its center point, while the Dey–Mittra conformal method uses subcell geometric fractions on edges and faces to represent the true PEC boundary more accurately.\n\nYour task is to quantify, for a circular cavity of radius $R=1$, the systematic bias direction (overestimation or underestimation) in the fundamental frequency for the staircased Yee approximation versus a Dey–Mittra-style conformal approximation, using the following first-principles surrogate model:\n\n1. For a given uniform grid spacing $h$, tile the square $[-R,R]\\times[-R,R]$ by squares (cells) of side $h$. Let the set of cell centers be $\\{(x_i,y_j)\\}$.\n\n2. Define the “staircased Yee” effective cavity area $A_{\\mathrm{st}}(h)$ by summing $h^2$ over all cells whose centers satisfy $x_i^2 + y_j^2 \\le R^2$ (cells fully counted if center is inside the circle, otherwise not counted). Define the corresponding effective radius\n$$\nR_{\\mathrm{st}}(h) = \\sqrt{\\frac{A_{\\mathrm{st}}(h)}{\\pi}}.\n$$\n\n3. Define the “Dey–Mittra-style” effective cavity area $A_{\\mathrm{dm}}(h)$ by summing the area fraction of each grid cell that lies inside the circle. To approximate the area fraction of a single cell of side $h$, uniformly subsample that cell with an $n_s \\times n_s$ deterministic subgrid (midpoint sampling) and take the fraction of subsamples with $x^2+y^2 \\le R^2$. Use\n$$\nn_s = 12\n$$\nfor all computations. Define\n$$\nR_{\\mathrm{dm}}(h) = \\sqrt{\\frac{A_{\\mathrm{dm}}(h)}{\\pi}}.\n$$\n\n4. Using the scale invariance of the Dirichlet spectrum under uniform scaling, approximate the fundamental frequency ratios for the two methods by\n$$\nr_{\\mathrm{st}}(h) = \\frac{f_{\\mathrm{st}}(h)}{f_\\star} \\approx \\frac{R}{R_{\\mathrm{st}}(h)}, \n\\qquad\nr_{\\mathrm{dm}}(h) = \\frac{f_{\\mathrm{dm}}(h)}{f_\\star} \\approx \\frac{R}{R_{\\mathrm{dm}}(h)},\n$$\nwith $R=1$. A value $r1$ indicates an overestimation of the true frequency and a value $r1$ indicates an underestimation.\n\n5. For each method and each grid spacing $h$, report the bias direction as a boolean: “overestimation” if $r1$ and “underestimation” if $r1$. In the extremely unlikely event $r=1$ to within numerical tolerance, treat it as neither and report “overestimation” as false.\n\nUse the following test suite of grid spacings:\n- $h = 0.50$ (very coarse, boundary-dominated regime),\n- $h = 0.25$ (coarse),\n- $h = 0.10$ (moderate),\n- $h = 0.05$ (fine).\n\nYour program must compute, for each $h$ in the test suite, the pair of frequency ratios $\\left(r_{\\mathrm{st}}(h), r_{\\mathrm{dm}}(h)\\right)$ and the corresponding booleans indicating overestimation for staircased Yee and for Dey–Mittra-style approximations.\n\nFinal Output Format:\n- Your program should produce a single line of output containing the results as a comma-separated list of lists, one per test case, in the following order for each test case:\n$$\n\\left[h, \\ r_{\\mathrm{st}}(h), \\ r_{\\mathrm{dm}}(h), \\ \\mathrm{over}_{\\mathrm{st}}(h), \\ \\mathrm{over}_{\\mathrm{dm}}(h)\\right],\n$$\nwhere $h$, $r_{\\mathrm{st}}(h)$, and $r_{\\mathrm{dm}}(h)$ are floats, and $\\mathrm{over}_{\\mathrm{st}}(h)$ and $\\mathrm{over}_{\\mathrm{dm}}(h)$ are booleans as defined above. The entire collection must be printed on a single line as a Python-style list, for example:\n$$\n\\left[\\,[0.5, 1.234, 1.056, \\mathrm{True}, \\mathrm{True}], [\\dots]\\,\\right].\n$$\n\nScientific realism constraints:\n- Justify the use of $r \\approx R/R_{\\mathrm{eff}}$ by starting from the eigenproblem and using uniform scaling of the domain.\n- Do not use any formula that directly gives the numerical bias of the Dey–Mittra method; the bias must arise from the geometric reasoning above.\n- All quantities are dimensionless; no physical units are required or permitted in the output.", "solution": "The problem requires an analysis of the systematic frequency bias introduced by two different numerical approximations of a circular boundary in a 2D electromagnetic cavity problem. The two methods are the standard staircased Yee grid and a conformal method modeled after the Dey–Mittra technique. The analysis is performed using a surrogate model based on the effective area of the discretized cavity.\n\nFirst, we must justify the model used to approximate the frequency ratio, $r = f_{\\mathrm{eff}}/f_\\star \\approx R/R_{\\mathrm{eff}}$. The resonant modes of the cavity are governed by the scalar Dirichlet Helmholtz eigenproblem:\n$$\n\\nabla^2 u + k^2 u = 0 \\ \\ \\text{in } \\Omega, \\qquad u=0 \\ \\ \\text{on } \\partial \\Omega\n$$\nHere, $k$ is the wavenumber, and the eigenvalues of the negative Laplacian, $-\\nabla^2$, on the domain $\\Omega$ with Dirichlet boundary conditions are $\\lambda_n = k_n^2$. For a circular domain $\\Omega_\\star$ of radius $R$, the fundamental wavenumber is $k_\\star = \\sqrt{\\lambda_1(\\Omega_\\star)}$.\n\nLet us consider a uniformly scaled domain $\\Omega' = \\alpha \\Omega_\\star$. A point $\\mathbf{x}' \\in \\Omega'$ can be written as $\\mathbf{x}' = \\alpha \\mathbf{x}$ for some $\\mathbf{x} \\in \\Omega_\\star$. The gradient operator transforms as $\\nabla_{\\mathbf{x}'} = (1/\\alpha)\\nabla_{\\mathbf{x}}$, and thus the Laplacian scales as $\\nabla_{\\mathbf{x}'}^2 = (1/\\alpha^2)\\nabla_{\\mathbf{x}}^2$. The eigenproblem on the scaled domain $\\Omega'$ is $\\nabla_{\\mathbf{x}'}^2 v + (k')^2 v = 0$. Substituting the scaled Laplacian, we get $(1/\\alpha^2)\\nabla_{\\mathbf{x}}^2 v + (k')^2 v = 0$, which is equivalent to $\\nabla_{\\mathbf{x}}^2 v + (\\alpha k')^2 v = 0$. For the eigenfunctions $v$ on $\\Omega'$ to correspond to the eigenfunctions $u$ on $\\Omega_\\star$, the eigenvalues must be the same. Thus, $(\\alpha k')^2 = k_\\star^2$, which implies that the wavenumber on the scaled domain is $k' = k_\\star / \\alpha$.\n\nThe numerical methods effectively replace the true circular domain $\\Omega_\\star$ of radius $R$ and area $A_\\star = \\pi R^2$ with an effective domain $\\Omega_{\\mathrm{eff}}$ of area $A_{\\mathrm{eff}}$. We model this effective domain as a circle with an effective radius $R_{\\mathrm{eff}} = \\sqrt{A_{\\mathrm{eff}}/\\pi}$. The linear scaling factor between the true domain and the effective domain is therefore $\\alpha \\approx R_{\\mathrm{eff}}/R$.\n\nUsing the scaling relation derived above, the wavenumber $k_{\\mathrm{eff}}$ of the effective domain is related to the true fundamental wavenumber $k_\\star$ by $k_{\\mathrm{eff}} \\approx k_\\star / \\alpha = k_\\star (R/R_{\\mathrm{eff}})$. Since the resonant frequency $f$ is directly proportional to the wavenumber $k$ (via $f = ck/(2\\pi)$), the ratio of the numerically approximated frequency $f_{\\mathrm{eff}}$ to the true fundamental frequency $f_\\star$ is:\n$$\nr(h) = \\frac{f_{\\mathrm{eff}}(h)}{f_\\star} = \\frac{k_{\\mathrm{eff}}(h)}{k_\\star} \\approx \\frac{R}{R_{\\mathrm{eff}}(h)}\n$$\nGiven that the problem specifies $R=1$, the ratio simplifies to $r(h) \\approx 1/R_{\\mathrm{eff}}(h)$. A value $r(h)>1$ signifies an overestimation of the frequency, while $r(h)1$ signifies an underestimation.\n\nThe core of the task is to compute the effective areas $A_{\\mathrm{st}}(h)$ and $A_{\\mathrm{dm}}(h)$ for a given grid spacing $h$. The analysis is performed on a square domain $[-R, R] \\times [-R, R]$ (i.e., $[-1, 1] \\times [-1, 1]$) tiled by square cells of side length $h$.\n\nFor the staircased Yee approximation, the effective area $A_{\\mathrm{st}}(h)$ is the sum of the areas of all cells whose centers $(x_i, y_j)$ are inside the true circle. The algorithm is as follows:\n1.  Generate a grid of cell centers $(x_i, y_j)$ with uniform spacing $h$ covering the square $[-1, 1] \\times [-1, 1]$.\n2.  For each center, check if it satisfies the condition $x_i^2 + y_j^2 \\le R^2 = 1$.\n3.  Count the number of centers inside the circle, $N_{\\mathrm{inside}}$.\n4.  The total effective area is $A_{\\mathrm{st}}(h) = N_{\\mathrm{inside}} \\times h^2$.\n\nFor the Dey–Mittra-style conformal approximation, the effective area $A_{\\mathrm{dm}}(h)$ is found by summing area fractions. The problem specifies a deterministic subsampling approach to calculate these fractions. An efficient, equivalent method is to construct a finer grid and perform a similar counting procedure.\n1.  Define a sub-grid spacing $\\delta = h/n_s$, where the subsampling factor is given as $n_s = 12$.\n2.  Generate a fine grid of sub-cell centers with spacing $\\delta$ covering the square $[-1, 1] \\times [-1, 1]$.\n3.  Count the number of sub-cell centers, $N_{\\mathrm{sub,inside}}$, that lie inside the true circle, i.e., satisfy $x^2+y^2 \\le R^2=1$.\n4.  The total effective area is the sum of the areas of these included sub-cells: $A_{\\mathrm{dm}}(h) = N_{\\mathrm{sub,inside}} \\times \\delta^2$. This is mathematically equivalent to summing the fractional areas of the original, coarser cells.\n\nFor both methods, once the effective area $A_{\\mathrm{eff}}(h)$ is computed, the corresponding effective radius $R_{\\mathrm{eff}}(h)$, frequency ratio $r(h)$, and overestimation boolean $\\mathrm{over}(h)$ are calculated as follows:\n$$\nR_{\\mathrm{eff}}(h) = \\sqrt{\\frac{A_{\\mathrm{eff}}(h)}{\\pi}}\n$$\n$$\nr(h) = \\frac{1}{R_{\\mathrm{eff}}(h)}\n$$\n$$\n\\mathrm{over}(h) = (r(h) > 1)\n$$\nThis entire procedure is repeated for each grid spacing $h$ in the provided test suite $\\{0.50, 0.25, 0.10, 0.05\\}$. Because both methods approximate a convex shape (the circle) by counting grid-aligned squares whose centers are inside, the resulting area will be an underestimate of the true area $\\pi R^2$. Consequently, $A_{\\mathrm{eff}}  \\pi$, leading to $R_{\\mathrm{eff}}  1$ and $r > 1$. We therefore expect both methods to consistently overestimate the fundamental frequency, with the Dey–Mittra-style method yielding a much smaller error.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the frequency bias of staircased vs. conformal approximations\n    for a circular cavity using an effective area model.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [0.50, 0.25, 0.10, 0.05]\n\n    # Define problem constants.\n    R = 1.0\n    R_sq = R**2\n    ns = 12 # Subsampling factor for Dey-Mittra-style method\n\n    results = []\n    for h in test_cases:\n        # --- Staircased Yee Method ---\n        # Generate cell centers for the grid of spacing h.\n        centers = np.arange(-R + h / 2.0, R, h)\n        \n        # Check if the grid has any points to avoid errors with large h.\n        if centers.size > 0:\n            X_c, Y_c = np.meshgrid(centers, centers)\n            # Calculate squared distance from origin for each center.\n            D2_c = X_c**2 + Y_c**2\n            # Count centers inside the circle.\n            N_inside_st = np.sum(D2_c = R_sq)\n            # Calculate effective area.\n            A_st = N_inside_st * h**2\n        else:\n            A_st = 0.0\n        \n        # Calculate frequency ratio from effective area.\n        if A_st > 1e-12: # Avoid division by zero\n            R_st = np.sqrt(A_st / np.pi)\n            r_st = 1.0 / R_st\n        else:\n            r_st = np.inf\n        \n        # Determine bias direction.\n        over_st = r_st > 1.0\n\n        # --- Dey-Mittra-style Conformal Method ---\n        # Define sub-grid spacing.\n        delta = h / float(ns)\n        # Generate sub-cell centers.\n        sub_centers = np.arange(-R + delta / 2.0, R, delta)\n        \n        if sub_centers.size > 0:\n            X_s, Y_s = np.meshgrid(sub_centers, sub_centers)\n            # Calculate squared distance from origin for each sub-center.\n            D2_s = X_s**2 + Y_s**2\n            # Count sub-centers inside the circle.\n            N_inside_dm = np.sum(D2_s = R_sq)\n            # Calculate effective area.\n            A_dm = N_inside_dm * delta**2\n        else:\n            A_dm = 0.0\n\n        # Calculate frequency ratio from effective area.\n        if A_dm > 1e-12: # Avoid division by zero\n            R_dm = np.sqrt(A_dm / np.pi)\n            r_dm = 1.0 / R_dm\n        else:\n            r_dm = np.inf\n            \n        # Determine bias direction.\n        over_dm = r_dm > 1.0\n\n        results.append([h, r_st, r_dm, over_st, over_dm])\n\n    # Final print statement in the exact required format.\n    # The template uses str(results), which has spaces. Let's make it match that.\n    # str(list) automatically adds spaces after commas.\n    # map(str, results) converts each sublist to its string representation.\n    # ','.join(...) joins these strings with a comma.\n    # The outer f-string adds the final brackets.\n    # This exactly reproduces the format: [[...],[...]]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3298105"}, {"introduction": "A crucial step in developing and validating any numerical scheme is the \"patch test,\" where the scheme is tested on a small grid patch with a known analytical solution to verify its local consistency. This advanced exercise walks you through constructing such a test for the Dey-Mittra method using a manufactured plane-wave solution, where you will implement the modified curl operator on a single cut cell and measure the residual error to numerically confirm that the method reproduces the integral form of Maxwell's equations to second-order accuracy [@problem_id:3298002].", "problem": "Consider the three-dimensional Maxwell equations in integral form for homogeneous, isotropic free-space with permittivity $\\epsilon$ and permeability $\\mu$. In the phasor frequency domain with angular frequency $\\omega$, Faraday's law over a smooth open surface $\\mathcal{S}$ with boundary $\\partial \\mathcal{S}$ is\n$$\n\\oint_{\\partial \\mathcal{S}} \\mathbf{E} \\cdot d\\boldsymbol{\\ell} \\;=\\; -\\,i\\,\\omega\\,\\mu \\int_{\\mathcal{S}} \\mathbf{H}\\cdot \\mathbf{n}_{\\mathcal{S}}\\, dS,\n$$\nwhere $\\mathbf{n}_{\\mathcal{S}}$ is the unit normal to $\\mathcal{S}$ and $i$ is the imaginary unit. We focus on a local patch test for the Dey–Mittra conformal method on a single cut cell in the Finite-Difference Time-Domain (FDTD) framework. Dey–Mittra (DM) modifies the geometric measures (lengths and areas) of Yee-cell edges and faces that are partially cut by a Perfect Electric Conductor (PEC), while keeping the field degrees of freedom on the canonical Yee locations. The PEC boundary enforces the tangential electric field to vanish on the conductor surface, so the contribution of the interior conductor boundary to the contour integral is zero.\n\nYou will construct a manufactured time-harmonic plane-wave solution that satisfies the Maxwell curl equations exactly and enforces the PEC tangential electric field condition on the cutting plane. Let $\\mathbf{n}$ be a fixed unit normal to the PEC plane and $\\mathbf{k}$ be a wave vector satisfying $\\mathbf{k}\\cdot \\mathbf{n} = 0$, with free-space parameters chosen so that $|\\mathbf{k}| = \\omega \\sqrt{\\mu\\,\\epsilon}$. Define the phasor fields\n$$\n\\mathbf{E}(\\mathbf{r}) \\;=\\; E_0\\, e^{\\,i\\,\\mathbf{k}\\cdot\\mathbf{r}}\\, \\mathbf{n}, \\qquad\n\\mathbf{H}(\\mathbf{r}) \\;=\\; \\frac{1}{\\mu\\,\\omega}\\, \\mathbf{k}\\times \\mathbf{E}(\\mathbf{r}),\n$$\nwith $E_0$ a real amplitude. These satisfy $\\nabla\\times \\mathbf{E} = -\\,i\\,\\omega\\,\\mu\\,\\mathbf{H}$ and $\\nabla\\times \\mathbf{H} = i\\,\\omega\\,\\epsilon\\,\\mathbf{E}$ provided $|\\mathbf{k}| = \\omega \\sqrt{\\mu \\epsilon}$ and $\\mathbf{k}\\cdot \\mathbf{E} = 0$, the latter ensured since $\\mathbf{E}$ is parallel to $\\mathbf{n}$ and $\\mathbf{k}\\cdot \\mathbf{n} = 0$. Because $\\mathbf{E}$ is parallel to $\\mathbf{n}$, the tangential component of $\\mathbf{E}$ on the PEC plane is zero, satisfying the PEC condition.\n\nWork on a single Yee face $\\mathcal{S}_z$ of a cubic cell of size $h$ located at $z = 0$, so $\\mathcal{S}_z = \\{(x,y,0)\\,:\\,0\\le x\\le h,\\,0\\le y\\le h\\}$, with boundary $\\partial \\mathcal{S}_z$ given by the four axis-aligned edges oriented counterclockwise (right-hand rule with $\\mathbf{n}_{\\mathcal{S}} = \\hat{\\mathbf{z}}$). A PEC half-space with plane normal $\\mathbf{n}$ and plane parameter $d$ cuts the cell; the open (non-conducting) portion of $\\mathcal{S}_z$ is the polygon resulting from clipping the square $[0,h]\\times[0,h]$ by the half-space $\\mathbf{n}\\cdot \\mathbf{r} \\le d$ evaluated at $z=0$. Similarly, each boundary edge is partially open where the same half-space inequality holds along that edge.\n\nDefine the Dey–Mittra discrete geometric measures as follows:\n- For each oriented edge $e$ of $\\partial \\mathcal{S}_z$, the open length $L_e$ is the length of the segment where $\\mathbf{n}\\cdot \\mathbf{r} \\le d$. The DM line integral approximation uses the midpoint value of the tangential electric field on the open segment, i.e.,\n$$\nI_{\\mathrm{DM}}^{(e)} \\;=\\; \\left(\\mathbf{E}(\\mathbf{r}_{e,\\mathrm{mid}})\\cdot \\mathbf{t}_e\\right)\\, L_e,\n$$\nwhere $\\mathbf{t}_e$ is the unit tangent of edge $e$ consistent with the orientation of $\\partial \\mathcal{S}_z$, and $\\mathbf{r}_{e,\\mathrm{mid}}$ is the midpoint of the open segment of $e$.\n- For the open polygon $\\mathcal{P}\\subset \\mathcal{S}_z$ with area $A_{\\mathcal{P}}$, the DM flux approximation uses the centroid value of the normal magnetic field,\n$$\n\\Phi_{\\mathrm{DM}} \\;=\\; \\left(\\mathbf{H}(\\mathbf{r}_{\\mathcal{P},\\mathrm{centroid}})\\cdot \\hat{\\mathbf{z}}\\right)\\, A_{\\mathcal{P}}.\n$$\n\nThe DM residual for Faraday's law on the cut face is the complex number\n$$\nR(h;\\mathbf{n},d,\\mathbf{k}) \\;=\\; \\sum_{e\\subset \\partial \\mathcal{S}_z} I_{\\mathrm{DM}}^{(e)} \\;+\\; i\\,\\omega\\,\\mu\\, \\Phi_{\\mathrm{DM}}.\n$$\nFor the manufactured solution above and a planar PEC surface, the exact residual is zero due to the PEC tangential condition along the interior cut segment and the exact Maxwell integral relation. Hence the DM residual magnitude $|R|$ measures the local DM consistency error. The DM method is said to reproduce the integral relation to second order on this patch if $|R| = \\mathcal{O}(h^2)$.\n\nYour task is to implement a program that:\n- Computes, for given $\\mathbf{n}$, $d$, $\\mathbf{k}$, and $h$, the open edge lengths $L_e$, the midpoint locations $\\mathbf{r}_{e,\\mathrm{mid}}$, the clipped open polygon $\\mathcal{P}$, its area $A_{\\mathcal{P}}$, and centroid $\\mathbf{r}_{\\mathcal{P},\\mathrm{centroid}}$.\n- Evaluates $R(h;\\mathbf{n},d,\\mathbf{k})$ and its magnitude $|R|$ for a sequence of three mesh sizes $h$ that differ by halving.\n- Estimates the observed order $p$ by computing the pairwise ratios\n$$\np_1 \\;=\\; \\frac{\\ln\\left(|R(h_1)|/|R(h_2)|\\right)}{\\ln\\left(h_1/h_2\\right)}, \\qquad\np_2 \\;=\\; \\frac{\\ln\\left(|R(h_2)|/|R(h_3)|\\right)}{\\ln\\left(h_2/h_3\\right)},\n$$\nand returning the conservative estimate $\\min(p_1,p_2)$.\n\nUse the following test suite of parameter sets, each with three mesh sizes $h\\in\\{\\,h_1, h_2, h_3\\,\\}$ where $h_1 = 0.2$, $h_2 = 0.1$, and $h_3 = 0.05$:\n- Test A (general oblique cut): $\\mathbf{n} = \\frac{1}{\\|\\mathbf{v}\\|}\\mathbf{v}$ with $\\mathbf{v} = (0.8,\\,0.6,\\,0.3)$, $d = \\alpha h$ with $\\alpha = 0.7$, plane-wave magnitude $E_0 = 1$, free-space parameters $\\mu = 1$, $\\epsilon = 1$, and $|\\mathbf{k}| = \\omega \\sqrt{\\mu \\epsilon}$ with $|\\mathbf{k}| = k_0 = 5.0$. Choose $\\mathbf{k}$ perpendicular to $\\mathbf{n}$ with nonzero $z$-component of $\\mathbf{k}\\times \\mathbf{n}$.\n- Test B (near-corner cut): $\\mathbf{n} = \\frac{1}{\\|\\mathbf{v}\\|}\\mathbf{v}$ with $\\mathbf{v} = (0.8,\\,0.6,\\,0.1)$, $d = \\alpha h$ with $\\alpha = 0.1$, $E_0 = 1$, $\\mu = 1$, $\\epsilon = 1$, and $k_0 = 7.0$ with $\\mathbf{k}\\perp \\mathbf{n}$ chosen to make $(\\mathbf{k}\\times \\mathbf{n})\\cdot \\hat{\\mathbf{z}}\\neq 0$.\n- Test C (no cut on the face; fully open): $\\mathbf{n} = \\frac{1}{\\|\\mathbf{v}\\|}\\mathbf{v}$ with $\\mathbf{v} = (0.3,\\,0.4,\\,0.5)$, $d = \\alpha h$ with $\\alpha = 1.5$, $E_0 = 1$, $\\mu = 1$, $\\epsilon = 1$, and $k_0 = 3.0$ with $\\mathbf{k}\\perp \\mathbf{n}$ chosen as above.\n\nAll quantities are dimensionless, and angles are in radians. Your program must:\n- Implement robust polygon clipping of the square $[0,h]\\times[0,h]$ by the half-space $\\mathbf{n}\\cdot \\mathbf{r} \\le d$ at $z=0$.\n- Compute the DM residual magnitude $|R|$ for $h\\in\\{\\,0.2,\\,0.1,\\,0.05\\,\\}$ for each test.\n- Compute and report the conservative observed order $\\min(p_1,p_2)$ for each test case as described.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of tests A, B, C, i.e., $\\big[ p_{\\mathrm{A}}, p_{\\mathrm{B}}, p_{\\mathrm{C}} \\big]$, where each $p$ is a floating-point number.", "solution": "The user requires an implementation to numerically verify the order of accuracy for the Dey-Mittra (DM) conformal method in electromagnetics. This involves a patch test on a single cut cell face using a manufactured plane-wave solution. The problem is well-posed and scientifically sound, providing a clear set of instructions for geometry, physics, and numerical analysis. We will proceed with a detailed, step-by-step solution.\n\nThe core of the problem is to compute the DM residual, $R$, for a series of decreasing mesh sizes, $h$, and then use these residuals to estimate the method's order of convergence, $p$. The residual is defined as:\n$$\nR(h;\\mathbf{n},d,\\mathbf{k}) \\;=\\; \\sum_{e\\subset \\partial \\mathcal{S}_z} I_{\\mathrm{DM}}^{(e)} \\;+\\; i\\,\\omega\\,\\mu\\, \\Phi_{\\mathrm{DM}}\n$$\nThis expression represents the discrete version of Faraday's law of induction. The first term is the discrete line integral of the electric field $\\mathbf{E}$ around the open portion of the cell face boundary, and the second is the discrete time-derivative of the magnetic flux of $\\mathbf{H}$ through the open area of the face. For an exact solution on a domain with a Perfect Electric Conductor (PEC), the analytical value of this expression is zero. The non-zero value of the numerical approximation, $R$, thus represents the local truncation error of the DM scheme. If the magnitude $|R|$ scales as $\\mathcal{O}(h^p)$, then $p$ is the order of accuracy.\n\nThe solution process can be broken down into three main parts:\n1.  **Geometric Processing**: For a given cell size $h$ and a cutting plane defined by $\\mathbf{n}\\cdot \\mathbf{r} = d$, we must determine the geometry of the \"open\" region, which is not occupied by the PEC. This involves clipping the square cell face $[0,h]\\times[0,h]$ at $z=0$ against the half-space $\\mathbf{n}\\cdot \\mathbf{r} \\le d$. This results in a convex polygon $\\mathcal{P}$. We need to compute its area $A_{\\mathcal{P}}$ and centroid $\\mathbf{r}_{\\mathcal{P},\\mathrm{centroid}}$. We must also determine the length $L_e$ and midpoint $\\mathbf{r}_{e,\\mathrm{mid}}$ of the open segment of each of the four boundary edges of the square.\n2.  **Field Evaluation and Discretization**: We use the provided manufactured plane-wave solution for the electric and magnetic fields, $\\mathbf{E}(\\mathbf{r})$ and $\\mathbf{H}(\\mathbf{r})$. These are evaluated at the specific points determined in the geometric step (edge midpoints and a polygon centroid) to compute the DM approximations for the line integral, $I_{\\mathrm{DM}}^{(e)}$, and the magnetic flux, $\\Phi_{\\mathrm{DM}}$.\n3.  **Residual and Order Calculation**: The discrete terms are combined to form the complex residual $R$. We repeat this for three mesh sizes ($h_1=0.2$, $h_2=0.1$, $h_3=0.05$) to obtain three residual magnitudes $|R_1|, |R_2|, |R_3|$. The order of convergence is then estimated pairwise using the formula $p = \\log_{h_1/h_2} (|R_1|/|R_2|)$. The conservative estimate $\\min(p_1, p_2)$ is reported for each test case.\n\nWe will now detail the implementation steps.\n\n**Step 1: Setup and Parameter Definition**\nFor each test case, we first establish the physical and geometric constants. The material parameters are $\\mu=1$ and $\\epsilon=1$. The plane-wave amplitude is $E_0=1$. The angular frequency $\\omega$ is equal to the wave number magnitude $k_0=|\\mathbf{k}|$ since $\\omega = |\\mathbf{k}| / \\sqrt{\\mu\\epsilon}$. The cutting plane normal $\\mathbf{n}$ is found by normalizing the given vector $\\mathbf{v}$. The wave vector $\\mathbf{k}$ must satisfy $\\mathbf{k}\\cdot\\mathbf{n}=0$ and $(\\mathbf{k}\\times\\mathbf{n})\\cdot\\hat{\\mathbf{z}} \\ne 0$. A deterministic choice that satisfies these conditions is to set $\\mathbf{k}$ proportional to $\\hat{\\mathbf{z}} \\times \\mathbf{n}$. This vector is guaranteed to be orthogonal to $\\mathbf{n}$. As long as $\\mathbf{n}$ is not parallel to $\\hat{\\mathbf{z}}$ (which is true for all test cases), this vector is non-zero, and the condition $(\\mathbf{k}\\times\\mathbf{n})\\cdot\\hat{\\mathbf{z}} \\ne 0$ is also satisfied. So we define $\\mathbf{k} = k_0 \\, (\\hat{\\mathbf{z}} \\times \\mathbf{n}) / \\|\\hat{\\mathbf{z}} \\times \\mathbf{n}\\|$.\n\n**Step 2: Geometric Computations**\nThis is the most intricate part of the implementation.\n- **Polygon Clipping**: The open polygon $\\mathcal{P}$ is the intersection of the square cell face $\\mathcal{S}_z$ and the half-space $\\mathbf{n}\\cdot\\mathbf{r} \\le d$. At $z=0$, this reduces to clipping the 2D square $[0,h]\\times[0,h]$ against the half-plane $n_x x + n_y y \\le d$. We use the Sutherland-Hodgman algorithm, which is well-suited for clipping a convex polygon (our square) against a convex clipping region (the half-plane). The algorithm iterates through the edges of the square, generating a new list of vertices for the clipped polygon.\n- **Polygon Area and Centroid**: Given the vertices of the clipped polygon $\\mathcal{P}$ in order, we compute its area $A_{\\mathcal{P}}$ and centroid $\\mathbf{r}_{\\mathcal{P},\\mathrm{centroid}}$ using standard formulas for polygonal shapes. The area is computed via the shoelace formula: $A = \\frac{1}{2} \\sum_{i=0}^{N-1} (x_i y_{i+1} - x_{i+1} y_i)$. The centroid components are $C_x = \\frac{1}{6A} \\sum_{i=0}^{N-1} (x_i + x_{i+1})(x_i y_{i+1} - x_{i+1} y_i)$ and $C_y = \\frac{1}{6A} \\sum_{i=0}^{N-1} (y_i + y_{i+1})(x_i y_{i+1} - x_{i+1} y_i)$. Special care is taken for cases where the area is near zero.\n- **Edge Clipping**: For each of the four boundary edges of the square (parameterized by $t \\in [0,1]$), the condition $\\mathbf{n}\\cdot\\mathbf{r}(t) \\le d$ defines a subinterval $[t_{start}, t_{end}]$ that corresponds to the open segment. The open length is $L_e = (t_{end} - t_{start})h$, and the midpoint corresponds to $t_{mid} = (t_{start} + t_{end})/2$.\n\n**Step 3: Calculating the DM Residual**\nWith all geometric quantities determined, we compute the two terms of the residual $R$:\n- **Line Integral Sum**: For each edge $e$, we compute $I_{\\mathrm{DM}}^{(e)} = (\\mathbf{E}(\\mathbf{r}_{e,\\mathrm{mid}})\\cdot \\mathbf{t}_e)\\, L_e$. The electric field is a complex vector given by $\\mathbf{E}(\\mathbf{r}) = E_0 e^{i\\mathbf{k}\\cdot\\mathbf{r}} \\mathbf{n}$. The sum $\\sum_e I_{\\mathrm{DM}}^{(e)}$ is a complex number.\n- **Flux Term**: We compute $\\Phi_{\\mathrm{DM}} = (\\mathbf{H}(\\mathbf{r}_{\\mathcal{P},\\mathrm{centroid}})\\cdot \\hat{\\mathbf{z}})\\, A_{\\mathcal{P}}$. The magnetic field is $\\mathbf{H}(\\mathbf{r}) = \\frac{1}{\\mu\\omega}\\mathbf{k}\\times \\mathbf{E}(\\mathbf{r}) = \\frac{E_0}{\\mu\\omega} e^{i\\mathbf{k}\\cdot\\mathbf{r}} (\\mathbf{k}\\times \\mathbf{n})$. This term is then multiplied by $i\\omega\\mu$.\n\n**Step 4: Estimating the Order of Convergence**\nThe above steps are performed for each mesh size $h \\in \\{0.2, 0.1, 0.05\\}$. This yields a list of three residual magnitudes $|R(h_1)|$, $|R(h_2)|$, $|R(h_3)|$. We then compute two pairwise order estimates:\n$$\np_1 \\;=\\; \\frac{\\ln(|R(h_1)|/|R(h_2)|)}{\\ln(h_1/h_2)}, \\qquad p_2 \\;=\\; \\frac{\\ln(|R(h_2)|/|R(h_3)|)}{\\ln(h_2/h_3)}\n$$\nSince $h_{i+1}=h_i/2$, the denominator in each case is $\\ln(2)$. The final reported value for each test case is $\\min(p_1, p_2)$, providing a conservative estimate of the convergence order. The entire procedure is automated in the following Python program.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the observed order of convergence for the Dey-Mittra method\n    on a single cut-cell face for three different test cases.\n    \"\"\"\n\n    # --- Geometric Helper Functions ---\n\n    def clip_polygon(subject_polygon, n_xy, d_plane):\n        \"\"\"Clips a convex polygon against a half-plane using Sutherland-Hodgman.\"\"\"\n        output_list = []\n        if not subject_polygon:\n            return []\n        \n        tol = 1e-14\n        \n        S = subject_polygon[-1]\n        s_val = np.dot(n_xy, S) - d_plane\n        \n        for E in subject_polygon:\n            e_val = np.dot(n_xy, E) - d_plane\n            \n            s_inside = s_val  tol\n            e_inside = e_val  tol\n\n            # Calculate intersection point if edge crosses the boundary\n            if abs(s_val - e_val) > tol:\n                t = s_val / (s_val - e_val)\n                intersection_point = S + t * (E - S)\n            else: # Edge is parallel to the clipping line\n                intersection_point = None\n\n            if e_inside:\n                if not s_inside:\n                    if intersection_point is not None:\n                        output_list.append(intersection_point)\n                output_list.append(E)\n            elif s_inside:\n                if intersection_point is not None:\n                    output_list.append(intersection_point)\n            \n            S = E\n            s_val = e_val\n        return output_list\n\n    def polygon_area(vertices):\n        \"\"\"Calculates the signed area of a polygon using the shoelace formula.\"\"\"\n        if len(vertices)  3:\n            return 0.0\n        area = 0.0\n        for i in range(len(vertices)):\n            p1 = vertices[i]\n            p2 = vertices[(i + 1) % len(vertices)]\n            area += p1[0] * p2[1] - p2[0] * p1[1]\n        return area / 2.0\n\n    def polygon_centroid(vertices, area):\n        \"\"\"Calculates the centroid of a polygon.\"\"\"\n        if len(vertices)  3 or abs(area)  1e-14:\n            if len(vertices) > 0:\n                return sum(vertices) / len(vertices)\n            return np.array([0.0, 0.0])\n        \n        centroid_x, centroid_y = 0.0, 0.0\n        for i in range(len(vertices)):\n            p1 = vertices[i]\n            p2 = vertices[(i + 1) % len(vertices)]\n            cross_prod = p1[0] * p2[1] - p2[0] * p1[1]\n            centroid_x += (p1[0] + p2[0]) * cross_prod\n            centroid_y += (p1[1] + p2[1]) * cross_prod\n        \n        return np.array([centroid_x, centroid_y]) / (6.0 * area)\n\n    # --- Main computation logic ---\n    \n    test_cases = [\n        # (v vector, alpha, k0)\n        (np.array([0.8, 0.6, 0.3]), 0.7, 5.0),\n        (np.array([0.8, 0.6, 0.1]), 0.1, 7.0),\n        (np.array([0.3, 0.4, 0.5]), 1.5, 3.0),\n    ]\n\n    h_vals = [0.2, 0.1, 0.05]\n    result_orders = []\n    \n    for v, alpha, k0 in test_cases:\n        # Define physical parameters and fields for the test case\n        E0 = 1.0\n        mu = 1.0\n        omega = k0\n        n = v / np.linalg.norm(v)\n        \n        k_dir = np.cross(np.array([0.0, 0.0, 1.0]), n)\n        if np.linalg.norm(k_dir)  1e-12: # Handle case where n is parallel to z-axis\n            k_dir = np.cross(np.array([1.0, 0.0, 0.0]), n)\n        k = k0 * k_dir / np.linalg.norm(k_dir)\n\n        def E_field(r):\n            return E0 * np.exp(1j * np.dot(k, r)) * n\n\n        def H_field(r):\n            return (E0 / (mu * omega)) * np.cross(k, n) * np.exp(1j * np.dot(k, r))\n\n        # Calculate residual for each mesh size h\n        R_magnitudes = []\n        for h in h_vals:\n            d = alpha * h\n            n_xy = n[:2]\n            \n            # Clip the square face [0,h]x[0,h]\n            square_verts_2d = [np.array([0.,0.]), np.array([h,0.]), np.array([h,h]), np.array([0.,h])]\n            clipped_poly_2d = clip_polygon(square_verts_2d, n_xy, d)\n            \n            # Compute DM flux term\n            flux_term = 0.0 + 0.0j\n            area_val = polygon_area(clipped_poly_2d)\n            if abs(area_val) > 1e-14:\n                centroid_2d = polygon_centroid(clipped_poly_2d, area_val)\n                r_centroid = np.array([centroid_2d[0], centroid_2d[1], 0.0])\n                H_at_centroid = H_field(r_centroid)\n                phi_dm = H_at_centroid[2] * abs(area_val)\n                flux_term = 1j * omega * mu * phi_dm\n\n            # Compute DM line integral term\n            line_integral_term = 0.0 + 0.0j\n            edge_defs = [\n                (np.array([0., 0., 0.]), np.array([h, 0., 0.])),\n                (np.array([h, 0., 0.]), np.array([h, h, 0.])),\n                (np.array([h, h, 0.]), np.array([0., h, 0.])),\n                (np.array([0., h, 0.]), np.array([0., 0., 0.]))\n            ]\n            \n            for p0, p1 in edge_defs:\n                v0_val = np.dot(n, p0) - d\n                v1_val = np.dot(n, p1) - d\n                tol = 1e-14\n\n                t_start, t_end = 0.0, 1.0 # Default is fully open\n                if v0_val > tol and v1_val > tol: # Fully cut\n                    t_start, t_end = 0.0, 0.0 \n                elif v0_val  tol and v1_val > tol: # Cut at p1 end\n                    if abs(v0_val - v1_val) > tol: t_end = v0_val / (v0_val - v1_val)\n                elif v0_val > tol and v1_val  tol: # Cut at p0 end\n                    if abs(v0_val - v1_val) > tol: t_start = v0_val / (v0_val - v1_val)\n\n                if t_end > t_start:\n                    open_length = (t_end - t_start) * h\n                    t_mid = (t_start + t_end) / 2.0\n                    r_mid = p0 + t_mid * (p1 - p0)\n                    E_at_mid = E_field(r_mid)\n                    t_e = (p1 - p0) / h\n                    line_integral_term += np.dot(E_at_mid, t_e) * open_length\n\n            residual = line_integral_term + flux_term\n            R_magnitudes.append(np.abs(residual))\n            \n        # Estimate order of convergence\n        if any(r = 1e-15 for r in R_magnitudes):\n            p1 = p2 = float('inf')\n        else:\n            p1 = np.log(R_magnitudes[0] / R_magnitudes[1]) / np.log(h_vals[0] / h_vals[1])\n            p2 = np.log(R_magnitudes[1] / R_magnitudes[2]) / np.log(h_vals[1] / h_vals[2])\n\n        result_orders.append(min(p1, p2))\n        \n    print(f\"[{','.join(map(str, result_orders))}]\")\n\nsolve()\n```", "id": "3298002"}]}