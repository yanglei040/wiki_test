{"hands_on_practices": [{"introduction": "The most fundamental requirement for any explicit time-domain simulation is numerical stability. Without it, numerical errors grow exponentially, rendering the simulation results meaningless. This exercise guides you through the derivation of the famous Courant–Friedrichs–Lewy (CFL) condition for the Finite Integration Technique (FIT), a critical constraint connecting the spatial grid resolutions $(\\Delta x, \\Delta y, \\Delta z)$ to the maximum allowable time step $\\Delta t$. By performing a von Neumann stability analysis, you will uncover the physical basis of this condition and master a core technique for analyzing any explicit time-stepping scheme. [@problem_id:3307640]", "problem": "You are given a source-free, homogeneous, isotropic medium with permittivity $\\varepsilon$ and permeability $\\mu$, discretized in space by the Finite Integration Technique (FIT) on a uniform Cartesian primal/dual grid with spacings $\\Delta x$, $\\Delta y$, and $\\Delta z$. Time advancement is performed explicitly with a leapfrog scheme, and periodic boundary conditions are assumed so that a discrete Fourier (von Neumann) analysis is admissible.\n\nStarting from the integral form of Maxwell’s equations and the core FIT topological laws that couple edge-integrated electric field unknowns to face-integrated fluxes via incidence matrices, perform the following:\n\n- Derive the semi-discrete FIT system in terms of the incidence operator for the discrete curl and the diagonal material matrices induced by the uniform Cartesian grid for a source-free, lossless medium.\n- Construct the explicit leapfrog time stepping for the electric and magnetic edge unknowns and carry out a von Neumann analysis using a separable plane-wave ansatz in space and time. Use this to derive the stability requirement (the Courant–Friedrichs–Lewy (CFL) condition) on the time step $\\Delta t$ that guarantees purely oscillatory discrete-time modes for all resolvable wavevectors.\n- Show explicitly how the bound depends on $\\varepsilon$, $\\mu$, $\\Delta x$, $\\Delta y$, and $\\Delta z$, and extract the closed-form expression for the maximum stable time step $\\Delta t_{\\max}$.\n\nAnswer specification: Provide $\\Delta t_{\\max}$ as a single closed-form analytic expression. Express the answer in seconds. Do not round.", "solution": "The problem asks for the derivation of the maximum stable time step, $\\Delta t_{\\max}$, for the Finite Integration Technique (FIT) applied to Maxwell's equations on a uniform Cartesian grid using an explicit leapfrog time-stepping scheme. The derivation proceeds by first establishing the semi-discrete system, then applying a von Neumann stability analysis.\n\n### Step 1: Semi-Discrete FIT Equations\nWe begin with the integral form of Maxwell's equations for a source-free, lossless, homogeneous, and isotropic medium:\n$$\n\\oint_{\\partial A} \\mathbf{E} \\cdot d\\mathbf{l} = -\\frac{d}{dt}\\iint_{A} \\mathbf{B} \\cdot d\\mathbf{S} \\quad (\\text{Faraday's Law})\n$$\n$$\n\\oint_{\\partial \\tilde{A}} \\mathbf{H} \\cdot d\\tilde{\\mathbf{l}} = \\frac{d}{dt}\\iint_{\\tilde{A}} \\mathbf{D} \\cdot d\\tilde{\\mathbf{S}} \\quad (\\text{Ampere's Law})\n$$\nIn the Finite Integration Technique, these equations are projected onto a primal grid and its staggered dual grid. The field quantities are represented by integral values over the cells of these grids. Let $\\mathbf{e}$ be the vector of primal edge path integrals of the electric field (voltages), and $\\tilde{\\mathbf{h}}$ be the vector of dual edge path integrals of the magnetic field (magnetomotive forces). The discrete curl operators are represented by topological incidence matrices $\\mathbf{C}$ (primal grid) and $\\tilde{\\mathbf{C}}$ (dual grid). The semi-discrete forms of Faraday's and Ampere's laws are:\n$$\n\\mathbf{C} \\mathbf{e} = -\\frac{d\\tilde{\\mathbf{b}}}{dt}\n$$\n$$\n\\tilde{\\mathbf{C}} \\tilde{\\mathbf{h}} = \\frac{d\\mathbf{d}}{dt}\n$$\nHere, $\\tilde{\\mathbf{b}}$ is the vector of magnetic fluxes through dual faces and $\\mathbf{d}$ is the vector of electric fluxes through primal faces. The constitutive relations $\\mathbf{D} = \\varepsilon\\mathbf{E}$ and $\\mathbf{B} = \\mu\\mathbf{H}$ are discretized using diagonal material matrices $\\mathbf{M}_{\\varepsilon}$ and $\\mathbf{M}_{\\mu}$:\n$$\n\\mathbf{d} = \\mathbf{M}_{\\varepsilon} \\mathbf{e}\n$$\n$$\n\\tilde{\\mathbf{b}} = \\mathbf{M}_{\\mu} \\tilde{\\mathbf{h}}\n$$\nSubstituting these into the discrete Maxwell equations and using the topological property $\\tilde{\\mathbf{C}} = \\mathbf{C}^T$ yields the semi-discrete system in terms of $\\mathbf{e}$ and $\\tilde{\\mathbf{h}}$:\n$$\n\\frac{d}{dt}(\\mathbf{M}_{\\mu} \\tilde{\\mathbf{h}}) = -\\mathbf{C} \\mathbf{e}\n$$\n$$\n\\frac{d}{dt}(\\mathbf{M}_{\\varepsilon} \\mathbf{e}) = \\mathbf{C}^T \\tilde{\\mathbf{h}}\n$$\nFor a homogeneous medium, $\\varepsilon$ and $\\mu$ are constants. The material matrices are diagonal with entries determined by the grid geometry. For a uniform Cartesian (Yee) grid, these geometric factors in the material matrices and the discrete curl operator combine in such a way that the equations become identical to the standard FDTD equations. Specifically, the system simplifies to:\n$$\n\\mu \\frac{d\\mathbf{H}}{dt} = -\\nabla_d \\times \\mathbf{E}\n$$\n$$\n\\varepsilon \\frac{d\\mathbf{E}}{dt} = \\nabla_d \\times \\mathbf{H}\n$$\nwhere $\\mathbf{E}$ and $\\mathbf{H}$ are now vectors of the field components themselves at their respective Yee grid locations, and $\\nabla_d \\times$ is the corresponding discrete curl operator.\n\n### Step 2: Leapfrog Time Discretization\nThe leapfrog scheme discretizes time with a step $\\Delta t$, evaluating $\\mathbf{E}$ at integer time steps $n$ and $\\mathbf{H}$ at half-integer time steps $n+1/2$. The time derivatives are approximated by central differences:\n$$\n\\mu \\frac{\\mathbf{H}^{n+1/2} - \\mathbf{H}^{n-1/2}}{\\Delta t} = -\\nabla_d \\times \\mathbf{E}^n\n$$\n$$\n\\varepsilon \\frac{\\mathbf{E}^{n+1} - \\mathbf{E}^n}{\\Delta t} = \\nabla_d \\times \\mathbf{H}^{n+1/2}\n$$\nWe can eliminate $\\mathbf{H}$ to obtain a second-order update equation for $\\mathbf{E}$ alone:\n$$\n\\mathbf{E}^{n+1} = \\mathbf{E}^n + \\frac{\\Delta t}{\\varepsilon} \\nabla_d \\times \\mathbf{H}^{n+1/2}\n$$\nSubstituting the update for $\\mathbf{H}^{n+1/2} = \\mathbf{H}^{n-1/2} - \\frac{\\Delta t}{\\mu} \\nabla_d \\times \\mathbf{E}^n$:\n$$\n\\mathbf{E}^{n+1} = \\mathbf{E}^n + \\frac{\\Delta t}{\\varepsilon} \\nabla_d \\times \\left( \\mathbf{H}^{n-1/2} - \\frac{\\Delta t}{\\mu} \\nabla_d \\times \\mathbf{E}^n \\right)\n$$\nRecognizing that $\\frac{\\Delta t}{\\varepsilon} \\nabla_d \\times \\mathbf{H}^{n-1/2} = \\mathbf{E}^n - \\mathbf{E}^{n-1}$ from the E-field update at the previous time step, we get:\n$$\n\\mathbf{E}^{n+1} = \\mathbf{E}^n + (\\mathbf{E}^n - \\mathbf{E}^{n-1}) - \\frac{\\Delta t^2}{\\varepsilon\\mu} (\\nabla_d \\times \\nabla_d \\times \\mathbf{E}^n)\n$$\nRearranging gives the final wave equation for the discrete electric field:\n$$\n\\frac{\\mathbf{E}^{n+1} - 2\\mathbf{E}^n + \\mathbf{E}^{n-1}}{\\Delta t^2} = \\frac{1}{\\varepsilon\\mu} \\nabla_d \\times \\nabla_d \\times \\mathbf{E}^n\n$$\n\n### Step 3: Von Neumann Stability Analysis\nWe test for stability by postulating a plane-wave solution (ansatz) on the grid. Due to the periodic boundary conditions, we can analyze a single spatial Fourier mode:\n$$\n\\mathbf{E}^n(\\mathbf{r}) = \\mathbf{E}_0 e^{i(\\mathbf{k} \\cdot \\mathbf{r})} (Z)^n\n$$\nwhere $\\mathbf{k} = (k_x, k_y, k_z)$ is the wavevector, $\\mathbf{r}$ is the position vector, and $Z = e^{-i\\omega \\Delta t}$ is the amplification factor per time step. For a stable, non-dissipative scheme, we require $|Z| = 1$.\n\nThe action of the discrete curl operator on a plane wave is found by replacing spatial derivatives with their finite-difference counterparts. For a Yee grid, a centered difference like $\\frac{\\partial}{\\partial x}$ becomes a multiplication by $i\\hat{k}_x$ in the Fourier domain, where:\n$$\n\\hat{k}_u = \\frac{2}{\\Delta u} \\sin\\left(\\frac{k_u \\Delta u}{2}\\right) \\quad \\text{ for } u \\in \\{x,y,z\\}\n$$\nThe operator $\\nabla_d \\times$ becomes multiplication by $i\\mathbf{K} \\times$, where $\\mathbf{K} = (\\hat{k}_x, \\hat{k}_y, \\hat{k}_z)$. The operator $\\nabla_d \\times \\nabla_d \\times$ becomes multiplication by $(i\\mathbf{K} \\times)(i\\mathbf{K} \\times) = -\\mathbf{K} \\times (\\mathbf{K} \\times \\cdot)$.\nSubstituting the ansatz into the discrete wave equation gives:\n$$\n\\frac{Z - 2 + Z^{-1}}{\\Delta t^2} \\mathbf{E}_0 = \\frac{1}{\\varepsilon\\mu} \\left( -\\mathbf{K} \\times (\\mathbf{K} \\times \\mathbf{E}_0) \\right)\n$$\nUsing the vector identity $\\mathbf{A} \\times (\\mathbf{B} \\times \\mathbf{C}) = \\mathbf{B}(\\mathbf{A} \\cdot \\mathbf{C}) - \\mathbf{C}(\\mathbf{A} \\cdot \\mathbf{B})$:\n$$\n\\frac{Z^{-1}(Z-1)^2}{\\Delta t^2} \\mathbf{E}_0 = \\frac{1}{\\varepsilon\\mu} \\left( -\\mathbf{K}(\\mathbf{K} \\cdot \\mathbf{E}_0) + \\mathbf{E}_0 (\\mathbf{K} \\cdot \\mathbf{K}) \\right)\n$$\nFor transverse electromagnetic waves, $\\mathbf{K} \\cdot \\mathbf{E}_0 = 0$. The equation simplifies to:\n$$\n\\frac{Z^{-1}(Z-1)^2}{\\Delta t^2} = \\frac{|\\mathbf{K}|^2}{\\varepsilon\\mu}\n$$\nwhere $|\\mathbf{K}|^2 = \\hat{k}_x^2 + \\hat{k}_y^2 + \\hat{k}_z^2$. Let $c = 1/\\sqrt{\\varepsilon\\mu}$ be the speed of light in the medium.\n$$\n(Z-1)^2 = - (c \\Delta t |\\mathbf{K}|)^2 Z\n$$\n$$\nZ^2 - 2Z + 1 = - (c \\Delta t |\\mathbf{K}|)^2 Z\n$$\n$$\nZ^2 + \\left( (c \\Delta t |\\mathbf{K}|)^2 - 2 \\right) Z + 1 = 0\n$$\nThis is a quadratic equation for $Z$. The solutions are on the unit circle if and only if the discriminant is non-positive:\n$$\n\\left( (c \\Delta t |\\mathbf{K}|)^2 - 2 \\right)^2 - 4 \\le 0\n$$\n$$\n-2 \\le (c \\Delta t |\\mathbf{K}|)^2 - 2 \\le 2\n$$\n$$\n0 \\le (c \\Delta t |\\mathbf{K}|)^2 \\le 4\n$$\nSince $(c \\Delta t |\\mathbf{K}|)^2$ is always non-negative, the stability condition is:\n$$\nc \\Delta t |\\mathbf{K}| \\le 2 \\implies \\Delta t \\le \\frac{2}{c |\\mathbf{K}|}\n$$\nThis must hold for all possible wavevectors $\\mathbf{k}$. Stability is therefore governed by the maximum value of $|\\mathbf{K}|$.\n$$\n\\Delta t_{\\max} = \\frac{2}{c |\\mathbf{K}|_{\\max}}\n$$\n\n### Step 4: Deriving the Maximum Stable Time Step\nTo find $|\\mathbf{K}|_{\\max}$, we must find the maximum value of $|\\mathbf{K}|^2 = \\hat{k}_x^2 + \\hat{k}_y^2 + \\hat{k}_z^2$:\n$$\n|\\mathbf{K}|^2 = \\left(\\frac{2}{\\Delta x}\\sin\\left(\\frac{k_x\\Delta x}{2}\\right)\\right)^2 + \\left(\\frac{2}{\\Delta y}\\sin\\left(\\frac{k_y\\Delta y}{2}\\right)\\right)^2 + \\left(\\frac{2}{\\Delta z}\\sin\\left(\\frac{k_z\\Delta z}{2}\\right)\\right)^2\n$$\nThe sine function reaches its maximum value of $1$. This occurs for the highest spatial frequencies (Nyquist frequency) that the grid can resolve, where $k_u \\Delta u = \\pi$. Therefore, the maximum value for each term is achieved when $\\sin^2(\\frac{k_u\\Delta u}{2}) = 1$.\n$$\n|\\mathbf{K}|_{\\max}^2 = \\left(\\frac{2}{\\Delta x}\\right)^2 + \\left(\\frac{2}{\\Delta y}\\right)^2 + \\left(\\frac{2}{\\Delta z}\\right)^2 = 4\\left(\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2}\\right)\n$$\nTaking the square root:\n$$\n|\\mathbf{K}|_{\\max} = 2\\sqrt{\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2}}\n$$\nSubstituting this into the expression for $\\Delta t_{\\max}$:\n$$\n\\Delta t_{\\max} = \\frac{2}{c \\left(2\\sqrt{\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2}}\\right)} = \\frac{1}{c\\sqrt{\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2}}}\n$$\nFinally, substituting $c=1/\\sqrt{\\varepsilon\\mu}$, we arrive at the Courant–Friedrichs–Lewy (CFL) condition for the 3D FIT/FDTD method:\n$$\n\\Delta t_{\\max} = \\frac{\\sqrt{\\varepsilon\\mu}}{\\sqrt{\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2}}} = \\sqrt{\\varepsilon\\mu} \\left(\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2}\\right)^{-1/2}\n$$\nThis expression provides the maximum time step $\\Delta t$ for which the explicit leapfrog scheme is numerically stable.", "answer": "$$\\boxed{\\sqrt{\\varepsilon\\mu} \\left(\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} + \\frac{1}{\\Delta z^2}\\right)^{-1/2}}$$", "id": "3307640"}, {"introduction": "Once a simulation is stable, the next crucial consideration is its accuracy. Discretizing space and time inevitably introduces numerical dispersion, causing simulated waves to propagate at a speed that depends on their wavelength and direction relative to the grid. This practice has you quantify this effect by deriving the errors in numerical phase velocity $v_p$ and group velocity $v_g$ for a wave traveling along a particularly challenging direction, the grid's body diagonal. [@problem_id:3307682] Mastering this analysis is key to understanding and predicting the anisotropic errors inherent in FIT simulations.", "problem": "Consider the Finite Integration Technique (FIT) semi-discretization of Maxwell’s equations on a three-dimensional, uniform, orthogonal lattice in vacuum with lattice spacing $\\,\\Delta\\,$ in each Cartesian direction and time step $\\,\\Delta t\\,$. Let the vacuum permittivity be $\\,\\varepsilon_{0}\\,$, the vacuum permeability be $\\,\\mu_{0}\\,$, and the speed of light be $\\,c = 1/\\sqrt{\\varepsilon_{0}\\mu_{0}}\\,$. Electric field degrees of freedom are associated with primal edges and magnetic field degrees of freedom with dual edges, and the time stepping is leapfrog. The wave vector is assumed to be aligned with the body diagonal of the cubic lattice. Specifically, let the physical wave number magnitude be $\\,k\\,$ and the Cartesian components satisfy $\\,k_{x} = k_{y} = k_{z} = k/\\sqrt{3}\\,$. Assume plane-wave solutions in space and time.\n\nStarting from Faraday’s law and Ampère–Maxwell law in their integral forms and the FIT topological discretization, derive the numerical dispersion relation for these plane waves propagating along the body diagonal of the lattice. Using this dispersion relation, define the Courant–Friedrichs–Lewy (CFL) stability number $\\,S = c\\,\\Delta t / \\Delta\\,$ and the nondimensional wavenumber $\\,\\xi = k\\,\\Delta\\,$, and compute closed-form analytic expressions for the relative phase velocity error\n$$\\delta_{p} = \\frac{v_{p}}{c} - 1$$\nand the relative group velocity error\n$$\\delta_{g} = \\frac{v_{g}}{c} - 1,$$\nwhere $\\,v_{p} = \\omega/k\\,$ and $\\,v_{g} = \\mathrm{d}\\omega/\\mathrm{d}k\\,$ are the numerical phase and group velocities extracted from the derived dispersion relation and $\\,\\omega\\,$ is the numerical angular frequency. Treat all trigonometric function arguments as being in radians, and express both $\\,\\delta_{p}\\,$ and $\\,\\delta_{g}\\,$ symbolically in terms of $\\,S\\,$ and $\\,\\xi\\,$. Provide your final result as a single row matrix containing $\\,\\delta_{p}\\,$ and $\\,\\delta_{g}\\,$. No numerical rounding is required.", "solution": "The Finite Integration Technique (FIT) on a uniform orthogonal lattice is equivalent to the Finite-Difference Time-Domain (FDTD) method on a Yee lattice. For a plane wave with time dependence $\\exp(-i\\omega t)$ and spatial dependence $\\exp(i\\vec{k} \\cdot \\vec{r})$, the leapfrog time-stepping scheme and central-differencing in space lead to the following operator substitutions for the partial derivatives in Maxwell's equations:\n$$ \\frac{\\partial}{\\partial t} \\rightarrow \\frac{-2i}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) $$\n$$ \\nabla \\rightarrow i\\vec{K} $$\nwhere $\\vec{K}$ is the numerical wave vector with components\n$$ K_j = \\frac{2}{\\Delta} \\sin\\left(\\frac{k_j \\Delta}{2}\\right) \\quad \\text{for } j \\in \\{x, y, z\\} $$\nHere, $\\omega$ is the numerical angular frequency, $\\vec{k} = (k_x, k_y, k_z)$ is the physical wave vector, $\\Delta t$ is the time step, and $\\Delta$ is the uniform lattice spacing.\n\nMaxwell's curl equations in a source-free vacuum ($\\vec{D}=\\varepsilon_0\\vec{E}$, $\\vec{B}=\\mu_0\\vec{H}$) are:\n$$ \\nabla \\times \\vec{E} = -\\frac{\\partial \\vec{B}}{\\partial t} \\quad \\implies \\quad \\nabla \\times \\vec{E} = -\\mu_0 \\frac{\\partial \\vec{H}}{\\partial t} $$\n$$ \\nabla \\times \\vec{H} = \\frac{\\partial \\vec{D}}{\\partial t} \\quad \\implies \\quad \\nabla \\times \\vec{H} = \\varepsilon_0 \\frac{\\partial \\vec{E}}{\\partial t} $$\nApplying the FDTD/FIT operator substitutions for a plane-wave solution ($\\vec{E}(\\vec{r},t) = \\vec{E}_0 e^{i(\\vec{k}\\cdot\\vec{r}-\\omega t)}$, $\\vec{H}(\\vec{r},t) = \\vec{H}_0 e^{i(\\vec{k}\\cdot\\vec{r}-\\omega t)}$) yields the algebraic system:\n$$ i\\vec{K} \\times \\vec{E}_0 = -\\mu_0 \\left( \\frac{-2i}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) \\right) \\vec{H}_0 $$\n$$ i\\vec{K} \\times \\vec{H}_0 = \\varepsilon_0 \\left( \\frac{-2i}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) \\right) \\vec{E}_0 $$\nSimplifying, we get:\n$$ \\vec{K} \\times \\vec{E}_0 = \\frac{2\\mu_0}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) \\vec{H}_0 $$\n$$ \\vec{K} \\times \\vec{H}_0 = -\\frac{2\\varepsilon_0}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) \\vec{E}_0 $$\nSubstituting the second equation into the curl of the first:\n$$ \\vec{K} \\times (\\vec{K} \\times \\vec{E}_0) = \\frac{2\\mu_0}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) (\\vec{K} \\times \\vec{H}_0) $$\n$$ \\vec{K}(\\vec{K} \\cdot \\vec{E}_0) - (\\vec{K} \\cdot \\vec{K})\\vec{E}_0 = \\frac{2\\mu_0}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) \\left(-\\frac{2\\varepsilon_0}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) \\vec{E}_0\\right) $$\nFor a transverse electromagnetic wave, the numerical divergence is zero ($\\vec{K} \\cdot \\vec{E}_0 = 0$), leading to:\n$$ -|\\vec{K}|^2 \\vec{E}_0 = -\\frac{4\\mu_0\\varepsilon_0}{(\\Delta t)^2} \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) \\vec{E}_0 $$\nUsing the relation for the speed of light in vacuum, $c = 1/\\sqrt{\\varepsilon_0\\mu_0}$, we obtain the numerical dispersion relation:\n$$ |\\vec{K}|^2 = \\frac{1}{c^2} \\left(\\frac{2}{\\Delta t}\\right)^2 \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) $$\nSubstituting the expression for the components of $\\vec{K}$:\n$$ \\left(\\frac{2}{\\Delta}\\right)^2 \\left( \\sin^2\\left(\\frac{k_x\\Delta}{2}\\right) + \\sin^2\\left(\\frac{k_y\\Delta}{2}\\right) + \\sin^2\\left(\\frac{k_z\\Delta}{2}\\right) \\right) = \\frac{4}{(c\\Delta t)^2} \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) $$\nThe problem specifies propagation along the body diagonal of the cubic lattice, so $k_x = k_y = k_z = k/\\sqrt{3}$. The relation becomes:\n$$ \\frac{1}{\\Delta^2} \\left( 3 \\sin^2\\left(\\frac{(k/\\sqrt{3})\\Delta}{2}\\right) \\right) = \\frac{1}{(c\\Delta t)^2} \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) $$\nWe are given the Courant–Friedrichs–Lewy (CFL) number $S = c\\Delta t/\\Delta$ and the nondimensional wavenumber $\\xi = k\\Delta$. Substituting these definitions:\n$$ \\frac{3}{\\Delta^2} \\sin^2\\left(\\frac{\\xi}{2\\sqrt{3}}\\right) = \\frac{1}{(S\\Delta)^2} \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) $$\n$$ 3 S^2 \\sin^2\\left(\\frac{\\xi}{2\\sqrt{3}}\\right) = \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) $$\nTaking the positive root for forward-propagating waves gives the final form of the numerical dispersion relation:\n$$ \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\sqrt{3} S \\sin\\left(\\frac{\\xi}{2\\sqrt{3}}\\right) $$\nFrom this, we can express the numerical angular frequency $\\omega$ as a function of the wave number $k$ (or $\\xi$):\n$$ \\omega(k) = \\frac{2}{\\Delta t} \\arcsin\\left(\\sqrt{3} S \\sin\\left(\\frac{k\\Delta}{2\\sqrt{3}}\\right)\\right) $$\n\nNext, we compute the relative phase velocity error, $\\delta_p = v_p/c - 1$. The numerical phase velocity is $v_p = \\omega/k$.\n$$ \\frac{v_p}{c} = \\frac{\\omega}{kc} = \\frac{1}{kc} \\left[ \\frac{2}{\\Delta t} \\arcsin\\left(\\sqrt{3} S \\sin\\left(\\frac{k\\Delta}{2\\sqrt{3}}\\right)\\right) \\right] $$\nUsing the relations $S = c\\Delta t/\\Delta$ and $\\xi = k\\Delta$, we can write $kc = (k\\Delta) (c\\Delta t/\\Delta) / \\Delta t = \\xi S / \\Delta t$.\n$$ \\frac{v_p}{c} = \\frac{\\Delta t}{\\xi S} \\left[ \\frac{2}{\\Delta t} \\arcsin\\left(\\sqrt{3} S \\sin\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)\\right) \\right] = \\frac{2}{\\xi S} \\arcsin\\left(\\sqrt{3} S \\sin\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)\\right) $$\nTherefore, the relative phase velocity error is:\n$$ \\delta_p = \\frac{2}{\\xi S} \\arcsin\\left(\\sqrt{3} S \\sin\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)\\right) - 1 $$\n\nNow, we compute the relative group velocity error, $\\delta_g = v_g/c - 1$. The numerical group velocity is $v_g = \\mathrm{d}\\omega/\\mathrm{d}k$. We can find this by implicitly differentiating the dispersion relation with respect to $k$:\n$$ \\frac{d}{dk}\\left[\\sin\\left(\\frac{\\omega \\Delta t}{2}\\right)\\right] = \\frac{d}{dk}\\left[\\sqrt{3} S \\sin\\left(\\frac{k\\Delta}{2\\sqrt{3}}\\right)\\right] $$\n$$ \\cos\\left(\\frac{\\omega \\Delta t}{2}\\right) \\cdot \\frac{\\Delta t}{2} \\cdot \\frac{d\\omega}{dk} = \\sqrt{3} S \\cos\\left(\\frac{k\\Delta}{2\\sqrt{3}}\\right) \\cdot \\frac{\\Delta}{2\\sqrt{3}} $$\n$$ \\cos\\left(\\frac{\\omega \\Delta t}{2}\\right) \\frac{\\Delta t}{2} v_g = S \\frac{\\Delta}{2} \\cos\\left(\\frac{k\\Delta}{2\\sqrt{3}}\\right) $$\nSolving for $v_g$:\n$$ v_g = \\frac{S\\Delta}{\\Delta t} \\frac{\\cos\\left(\\frac{k\\Delta}{2\\sqrt{3}}\\right)}{\\cos\\left(\\frac{\\omega \\Delta t}{2}\\right)} $$\nSince $c = S\\Delta/\\Delta t$, we have $v_g/c$:\n$$ \\frac{v_g}{c} = \\frac{\\cos\\left(\\frac{k\\Delta}{2\\sqrt{3}}\\right)}{\\cos\\left(\\frac{\\omega \\Delta t}{2}\\right)} = \\frac{\\cos\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)}{\\sqrt{1 - \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right)}} $$\nUsing the dispersion relation $\\sin(\\frac{\\omega \\Delta t}{2}) = \\sqrt{3} S \\sin(\\frac{\\xi}{2\\sqrt{3}})$:\n$$ \\frac{v_g}{c} = \\frac{\\cos\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)}{\\sqrt{1 - 3S^2 \\sin^2\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)}} $$\nTherefore, the relative group velocity error is:\n$$ \\delta_g = \\frac{\\cos\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)}{\\sqrt{1 - 3S^2 \\sin^2\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)}} - 1 $$\nThe final results for $\\delta_p$ and $\\delta_g$ are expressed symbolically in terms of $S$ and $\\xi$ as required.", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{2}{\\xi S} \\arcsin\\left(\\sqrt{3} S \\sin\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)\\right) - 1 & \\frac{\\cos\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)}{\\sqrt{1 - 3S^2 \\sin^2\\left(\\frac{\\xi}{2\\sqrt{3}}\\right)}} - 1 \\end{pmatrix}}$$", "id": "3307682"}, {"introduction": "Theoretical analysis provides the foundation, but computational experiments are where concepts like stability and dispersion come to life. This hands-on coding exercise requires you to build a numerical workbench to explore the dispersion characteristics of the 2D FIT method. You will implement the dispersion relation to measure error metrics and perform a practical design task: optimizing the grid's aspect ratio to minimize numerical anisotropy. [@problem_id:3307696] This practice bridges the gap between theory and implementation, demonstrating how analytical insights directly inform engineering decisions in computational modeling.", "problem": "Construct a program that evaluates the numerical plane-wave dispersion and angular anisotropy of the Finite Integration Technique (FIT) with electric–magnetic staggering on a uniform two-dimensional grid, and uses this analysis to compare numerical phase-velocity surfaces with the analytic free-space relation and to propose a grid-aspect-ratio optimization metric. The derivation and implementation must start from Maxwell’s equations and their uniform-grid FIT discretization, and must rely on a plane-wave ansatz to obtain the discrete dispersion. The comparison must be performed against the analytic free-space relation, which is given by the wavenumber–frequency relationship $|\\mathbf{k}| = \\omega \\sqrt{\\mu \\epsilon}$, equivalently $\\omega = c |\\mathbf{k}|$ with $c = 1/\\sqrt{\\mu \\epsilon}$. You must work in the two-dimensional, homogeneous, isotropic case, with all fields and parameters expressed in the International System of Units (SI): meters for length, seconds for time, henries per meter for permeability, and farads per meter for permittivity. Angles must be in radians.\n\nYour program must implement the following, in a way that is fully self-contained and does not accept external input:\n\n1. Start from the integral form of Maxwell’s equations, discretized on a uniform Cartesian grid using the Finite Integration Technique (FIT) with edge-collocated electric voltages and face-collocated magnetic fluxes (electric–magnetic staggering). Consider the two-dimensional case, for which the numerical dispersion relation can be extracted by inserting a plane-wave ansatz of the form $e^{\\mathrm{j}(k_x i \\Delta x + k_y j \\Delta y - \\omega n \\Delta t)}$ into the uniform-grid FIT equations. The time step must satisfy the Courant–Friedrichs–Lewy (CFL) stability bound for a two-dimensional grid, with a specified Courant fraction $s \\in (0, 1)$. The maximum stable time step for two dimensions is\n$$\n\\Delta t_{\\max} = \\frac{1}{c} \\frac{1}{\\sqrt{\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2}}} \\, ,\n$$\nand you must use $\\Delta t = s \\, \\Delta t_{\\max}$, with $c = 1/\\sqrt{\\mu \\epsilon}$.\n\n2. For a given angular wavenumber magnitude $K = |\\mathbf{k}|$ and direction $\\theta \\in [0, 2\\pi)$, define components $k_x = K \\cos \\theta$ and $k_y = K \\sin \\theta$. Using the FIT plane-wave dispersion relation, compute the numerical angular frequency $\\omega_{\\text{num}}(\\theta)$ and thereby the numerical phase velocity $v_{\\text{p,num}}(\\theta) = \\omega_{\\text{num}}(\\theta)/K$. Compare $v_{\\text{p,num}}(\\theta)$ to the analytic free-space phase velocity $c$, and construct the following two metrics over $\\theta \\in [0, 2\\pi)$:\n- The worst-case relative phase-velocity error\n$$\nM_{\\infty} = \\max_{\\theta} \\left| \\frac{v_{\\text{p,num}}(\\theta)}{c} - 1 \\right| \\, .\n$$\n- The anisotropy span\n$$\nA = \\max_{\\theta} \\left( \\frac{v_{\\text{p,num}}(\\theta)}{c} \\right) - \\min_{\\theta} \\left( \\frac{v_{\\text{p,num}}(\\theta)}{c} \\right) \\, .\n$$\nThese are dimensionless. Use $N_{\\theta} = 720$ uniformly spaced angles, i.e., $\\theta_m = 2\\pi m / N_{\\theta}$ for $m = 0, 1, \\ldots, N_{\\theta}-1$. Angles must be in radians.\n\n3. Select the wavenumber magnitude as\n$$\nK = q \\, \\min\\left( \\frac{\\pi}{\\Delta x}, \\frac{\\pi}{\\Delta y} \\right) \\, ,\n$$\nwith a prescribed dimensionless fraction $q \\in (0, 1)$ that sets the fraction of the grid’s spatial Nyquist wavenumber used in every direction. This ensures that $k_x \\Delta x$ and $k_y \\Delta y$ remain within $(-\\pi, \\pi)$ for all angles.\n\n4. Define an aspect-ratio optimization metric that aims to minimize the worst-case phase-velocity error:\n$$\nJ(\\Delta x / \\Delta y) = M_{\\infty} \\, .\n$$\nGiven a fixed $\\Delta y$ and a candidate set of aspect ratios $\\mathcal{R} = \\{0.5, 1.0, 2.0, 4.0\\}$, choose the optimizer\n$$\n\\left(\\frac{\\Delta x}{\\Delta y}\\right)^{\\star} = \\arg\\min_{r \\in \\mathcal{R}} J(r) \\, .\n$$\nTies must be broken by choosing the smallest $r$.\n\n5. Physical constants: use $\\mu = \\mu_0 = 4\\pi \\times 10^{-7} \\, \\mathrm{H/m}$ and $\\epsilon = \\epsilon_0 = 8.854187817 \\times 10^{-12} \\, \\mathrm{F/m}$.\n\nTest suite and required outputs:\n- For each test case below, compute and return a list with three entries $[M_{\\infty}, A, r^{\\star}]$, where $r^{\\star}$ is the optimizing aspect ratio $\\Delta x/\\Delta y$ chosen from $\\{0.5, 1.0, 2.0, 4.0\\}$ using the metric in item $4$ with the same $s$ and $q$ of the test case and with $\\Delta y = 10^{-3} \\, \\mathrm{m}$.\n- Round all floating outputs to $6$ decimals.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test-case result is itself a list in the same bracket-and-comma format.\n\nTest cases (all lengths in meters, time in seconds, angles in radians):\n- Case $1$: $\\Delta x = 10^{-3}$, $\\Delta y = 10^{-3}$, $s = 0.99$, $q = 0.4$.\n- Case $2$: $\\Delta x = 2 \\times 10^{-3}$, $\\Delta y = 10^{-3}$, $s = 0.99$, $q = 0.4$.\n- Case $3$: $\\Delta x = 4 \\times 10^{-3}$, $\\Delta y = 10^{-3}$, $s = 0.50$, $q = 0.4$.\n- Case $4$: $\\Delta x = 10^{-3}$, $\\Delta y = 10^{-3}$, $s = 0.99$, $q = 0.05$.\n- Case $5$: $\\Delta x = 10^{-3}$, $\\Delta y = 10^{-3}$, $s = 0.99$, $q = 0.8$.\n\nFinal output format:\n- A single line containing a list with five entries, each entry being the list $[M_{\\infty}, A, r^{\\star}]$ for the corresponding test case, with all floating-point numbers rounded to $6$ decimals. For example, a syntactically valid line would look like $[[0.001234,0.002468,1.0],[\\dots],\\dots]$ (this is only an example; your program must compute the actual values).", "solution": "The analysis begins with Maxwell's equations in a two-dimensional, source-free, homogeneous, and isotropic medium. For simplicity and without loss of generality, we consider a Transverse Magnetic ($TM_z$) polarization, where the field components are $\\mathbf{E} = (E_x, E_y, 0)$ and $\\mathbf{H} = (0, 0, H_z)$. The governing equations are:\n$$\n\\epsilon \\frac{\\partial E_x}{\\partial t} = \\frac{\\partial H_z}{\\partial y}\n$$\n$$\n\\epsilon \\frac{\\partial E_y}{\\partial t} = -\\frac{\\partial H_z}{\\partial x}\n$$\n$$\n\\mu \\frac{\\partial H_z}{\\partial t} = \\frac{\\partial E_x}{\\partial y} - \\frac{\\partial E_y}{\\partial x}\n$$\nwhere $\\epsilon$ is the permittivity and $\\mu$ is the permeability of the medium.\n\nThe Finite Integration Technique on a uniform Cartesian grid with grid spacings $\\Delta x$ and $\\Delta y$ is equivalent to the Finite-Difference Time-Domain (FDTD) method using the Yee lattice. This scheme employs central differences for both spatial and temporal derivatives, resulting in a leapfrog time-stepping algorithm. The discretized equations are:\n$$\n\\epsilon \\frac{E_x\\big|_{i, j+1/2}^{n+1} - E_x\\big|_{i, j+1/2}^{n}}{\\Delta t} = \\frac{H_z\\big|_{i, j+1}^{n+1/2} - H_z\\big|_{i, j}^{n+1/2}}{\\Delta y}\n$$\n$$\n\\epsilon \\frac{E_y\\big|_{i+1/2, j}^{n+1} - E_y\\big|_{i+1/2, j}^{n}}{\\Delta t} = -\\frac{H_z\\big|_{i+1, j}^{n+1/2} - H_z\\big|_{i, j}^{n+1/2}}{\\Delta x}\n$$\n$$\n\\mu \\frac{H_z\\big|_{i, j}^{n+1/2} - H_z\\big|_{i, j}^{n-1/2}}{\\Delta t} = \\frac{E_x\\big|_{i, j+1/2}^{n} - E_x\\big|_{i, j-1/2}^{n}}{\\Delta y} - \\frac{E_y\\big|_{i+1/2, j}^{n} - E_y\\big|_{i-1/2, j}^{n}}{\\Delta x}\n$$\nHere, $(i, j)$ denotes the grid indices, $n$ is the time index, and the half-integer indices represent the spatial and temporal staggering of the field components.\n\nTo find the numerical dispersion relation, we substitute a plane-wave ansatz for each field component, which takes the form of a discrete plane wave propagating with wavevector $\\mathbf{k} = (k_x, k_y)$ and angular frequency $\\omega_{\\text{num}}$. Accounting for the staggering, the ansatz is:\n$$\nE_x\\big|_{i, j+1/2}^{n} = E_{x0} e^{\\mathrm{j}(k_x i \\Delta x + k_y (j+1/2) \\Delta y - \\omega_{\\text{num}} n \\Delta t)}\n$$\n$$\nE_y\\big|_{i+1/2, j}^{n} = E_{y0} e^{\\mathrm{j}(k_x (i+1/2) \\Delta x + k_y j \\Delta y - \\omega_{\\text{num}} n \\Delta t)}\n$$\n$$\nH_z\\big|_{i, j}^{n+1/2} = H_{z0} e^{\\mathrm{j}(k_x i \\Delta x + k_y j \\Delta y - \\omega_{\\text{num}} (n+1/2) \\Delta t)}\n$$\nSubstituting these into the discretized Maxwell's equations, the difference operators transform into trigonometric functions. For instance, the time-derivative term for $H_z$ becomes:\n$$\n\\frac{H_z\\big|_{i,j}^{n+1/2} - H_z\\big|_{i,j}^{n-1/2}}{\\Delta t} \\rightarrow H_{z0} e^{\\mathrm{j}(\\dots)} \\frac{e^{\\mathrm{j}\\omega_{\\text{num}}\\Delta t/2} - e^{-\\mathrm{j}\\omega_{\\text{num}}\\Delta t/2}}{\\Delta t} = H_{z0} e^{\\mathrm{j}(\\dots)} \\frac{2\\mathrm{j} \\sin(\\omega_{\\text{num}}\\Delta t/2)}{\\Delta t}\n$$\nAfter applying this process to all terms and simplifying, we obtain a system of linear algebraic equations for the amplitudes $E_{x0}$, $E_{y0}$, and $H_{z0}$:\n$$\n\\epsilon E_{x0} \\frac{2\\mathrm{j} \\sin(\\omega_{\\text{num}}\\Delta t/2)}{\\Delta t} = H_{z0} \\frac{2\\mathrm{j} \\sin(k_y\\Delta y/2)}{\\Delta y}\n$$\n$$\n\\epsilon E_{y0} \\frac{2\\mathrm{j} \\sin(\\omega_{\\text{num}}\\Delta t/2)}{\\Delta t} = -H_{z0} \\frac{2\\mathrm{j} \\sin(k_x\\Delta x/2)}{\\Delta x}\n$$\n$$\n\\mu H_{z0} \\frac{2\\mathrm{j} \\sin(\\omega_{\\text{num}}\\Delta t/2)}{\\Delta t} = E_{x0} \\frac{2\\mathrm{j} \\sin(k_y\\Delta y/2)}{\\Delta y} - E_{y0} \\frac{2\\mathrm{j} \\sin(k_x\\Delta x/2)}{\\Delta x}\n$$\nFor a non-trivial solution to exist, the determinant of this system must be zero. Substituting the expressions for $E_{x0}$ and $E_{y0}$ from the first two equations into the third yields the numerical dispersion relation:\n$$\n\\mu\\epsilon \\left( \\frac{\\sin(\\omega_{\\text{num}}\\Delta t/2)}{\\Delta t} \\right)^2 = \\left( \\frac{\\sin(k_x\\Delta x/2)}{\\Delta x} \\right)^2 + \\left( \\frac{\\sin(k_y\\Delta y/2)}{\\Delta y} \\right)^2\n$$\nUsing the free-space speed of light $c = 1/\\sqrt{\\mu\\epsilon}$, we can solve for the numerical angular frequency $\\omega_{\\text{num}}$:\n$$\n\\omega_{\\text{num}}(\\theta) = \\frac{2}{\\Delta t} \\arcsin\\left( c \\Delta t \\sqrt{ \\left(\\frac{\\sin(k_x\\Delta x/2)}{\\Delta x}\\right)^2 + \\left(\\frac{\\sin(k_y\\Delta y/2)}{\\Delta y}\\right)^2 } \\right)\n$$\nwhere $k_x = K \\cos\\theta$ and $k_y = K \\sin\\theta$ for a given wavenumber magnitude $K = |\\mathbf{k}|$ and propagation angle $\\theta$. The argument of the arcsin function must be less than or equal to $1$ for stability, which leads directly to the Courant–Friedrichs–Lewy (CFL) condition provided: $\\Delta t \\le \\Delta t_{\\max} = \\frac{1}{c} (\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2})^{-1/2}$. The problem specifies using a time step $\\Delta t = s \\Delta t_{\\max}$ with a Courant fraction $s \\in (0,1)$, which guarantees stability.\n\nThe numerical phase velocity is $v_{\\text{p,num}}(\\theta) = \\omega_{\\text{num}}(\\theta)/K$. In an ideal, continuum medium, the phase velocity is constant and equal to $c$, independent of direction. The numerical grid introduces dispersion (dependency on $K$) and anisotropy (dependency on $\\theta$). We quantify these effects using two metrics:\nThe worst-case relative phase-velocity error, which measures the maximum deviation from the physical speed of light:\n$$\nM_{\\infty} = \\max_{\\theta} \\left| \\frac{v_{\\text{p,num}}(\\theta)}{c} - 1 \\right|\n$$\nThe anisotropy span, which measures the total variation of the normalized phase velocity over all directions:\n$$\nA = \\max_{\\theta} \\left( \\frac{v_{\\text{p,num}}(\\theta)}{c} \\right) - \\min_{\\theta} \\left( \\frac{v_{\\text{p,num}}(\\theta)}{c} \\right)\n$$\nThe wavenumber magnitude $K$ is set relative to the grid's spatial Nyquist limit, $K = q \\, \\min( \\pi/\\Delta x, \\pi/\\Delta y )$, where $q \\in (0,1)$ is a dimensionless fraction. This ensures that the wave is adequately resolved by the grid.\n\nFinally, the quality of a grid with a given aspect ratio $r = \\Delta x / \\Delta y$ is evaluated using the optimization metric $J(r) = M_{\\infty}$. The optimal aspect ratio $r^{\\star}$ from a candidate set $\\mathcal{R}$ is the one that minimizes this worst-case error:\n$$\nr^{\\star} = \\left(\\frac{\\Delta x}{\\Delta y}\\right)^{\\star} = \\arg\\min_{r \\in \\mathcal{R}} J(r)\n$$\nThe following implementation will compute these quantities for the specified test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_dispersion_metrics(dx, dy, s, q, c0, N_theta):\n    \"\"\"\n    Calculates the numerical dispersion metrics M_infinity and A for given FIT parameters.\n\n    Args:\n        dx (float): Grid spacing in x-direction (m).\n        dy (float): Grid spacing in y-direction (m).\n        s (float): Courant fraction.\n        q (float): Wavenumber fraction of Nyquist limit.\n        c0 (float): Speed of light in vacuum (m/s).\n        N_theta (int): Number of angles for evaluation.\n\n    Returns:\n        tuple[float, float]: A tuple containing M_infinity and A.\n    \"\"\"\n    # 1. Calculate numerical time step based on the CFL condition\n    dt_max = (1 / c0) / np.sqrt(1 / dx**2 + 1 / dy**2)\n    dt = s * dt_max\n\n    # 2. Define wave propagation characteristics\n    # Wavenumber magnitude relative to the grid's Nyquist frequency\n    K = q * min(np.pi / dx, np.pi / dy)\n    \n    # Discretize propagation angles\n    theta = np.linspace(0, 2 * np.pi, N_theta, endpoint=False)\n    kx = K * np.cos(theta)\n    ky = K * np.sin(theta)\n\n    # 3. Calculate the numerical dispersion relation\n    # The term inside the arcsin in the dispersion relation\n    arg_asin = c0 * dt * np.sqrt(\n        (np.sin(kx * dx / 2) / dx)**2 + (np.sin(ky * dy / 2) / dy)**2\n    )\n    \n    # Clip to handle potential floating-point inaccuracies near the stability limit\n    arg_asin = np.clip(arg_asin, -1.0, 1.0)\n    \n    # Numerical angular frequency\n    omega_num = (2 / dt) * np.arcsin(arg_asin)\n    \n    # Numerical phase velocity. K is non-zero, so division is safe.\n    vp_num = omega_num / K\n\n    # 4. Calculate performance metrics\n    vp_ratio = vp_num / c0\n    \n    # Worst-case relative phase-velocity error\n    M_inf = np.max(np.abs(vp_ratio - 1))\n    \n    # Anisotropy span\n    A = np.max(vp_ratio) - np.min(vp_ratio)\n\n    return M_inf, A\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and produce the final output.\n    \"\"\"\n    # Physical constants\n    mu0 = 4 * np.pi * 1e-7  # H/m\n    eps0 = 8.854187817e-12 # F/m\n    c0 = 1 / np.sqrt(mu0 * eps0)\n\n    # Problem parameters\n    N_theta = 720\n    test_cases = [\n        # (dx, dy, s, q)\n        (1e-3, 1e-3, 0.99, 0.4),\n        (2e-3, 1e-3, 0.99, 0.4),\n        (4e-3, 1e-3, 0.50, 0.4),\n        (1e-3, 1e-3, 0.99, 0.05),\n        (1e-3, 1e-3, 0.99, 0.8),\n    ]\n    aspect_ratios_to_test = [0.5, 1.0, 2.0, 4.0]\n    dy_opt = 1e-3\n\n    results = []\n    for case in test_cases:\n        dx_case, dy_case, s, q = case\n        \n        # Part 1: Calculate M_inf and A for the specific test case parameters\n        M_inf, A = calculate_dispersion_metrics(dx_case, dy_case, s, q, c0, N_theta)\n\n        # Part 2: Find the optimal aspect ratio r*\n        min_J = float('inf')\n        best_r = -1.0\n        \n        for r in aspect_ratios_to_test:\n            dx_opt = r * dy_opt\n            # The optimization metric J is defined as M_inf\n            J_r, _ = calculate_dispersion_metrics(dx_opt, dy_opt, s, q, c0, N_theta)\n            \n            # Update best_r if a smaller error is found.\n            # Tie is broken by choosing smaller r due to ordered iteration.\n            if J_r < min_J:\n                min_J = J_r\n                best_r = r\n        \n        results.append([M_inf, A, best_r])\n\n    # Format the final output string as required\n    formatted_results = []\n    for m_inf_val, a_val, r_star_val in results:\n        # Round floating outputs to 6 decimals as specified.\n        # r* is from a discrete set, not a calculation needing rounding in the same way,\n        # but is treated as a float in the final output.\n        m_inf_str = f\"{round(m_inf_val, 6):.6f}\"\n        a_str = f\"{round(a_val, 6):.6f}\"\n        r_star_str = f\"{r_star_val}\"\n        formatted_results.append(f\"[{m_inf_str},{a_str},{r_star_str}]\")\n\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3307696"}]}