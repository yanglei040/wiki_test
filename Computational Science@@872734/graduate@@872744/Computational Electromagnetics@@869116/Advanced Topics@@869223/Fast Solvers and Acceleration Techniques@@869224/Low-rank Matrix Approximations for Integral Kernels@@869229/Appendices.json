{"hands_on_practices": [{"introduction": "The efficiency of low-rank methods hinges on identifying which parts of a system matrix are compressible. This exercise provides a hands-on theoretical derivation to build intuition for how the numerical rank of an interaction block is governed by physical and geometric parameters. By analyzing the interaction between two elongated clusters in different orientations, you will see how the transverse 'footprint' of the scatterers relative to the direction of propagation directly controls the kernel's phase complexity and, consequently, its numerical rank [@problem_id:3326998].", "problem": "Consider a three-dimensional time-harmonic scattering problem governed by the scalar Helmholtz equation with free-space Green's function given by $G(\\mathbf{x},\\mathbf{y}) = \\dfrac{\\exp\\!\\left(i k |\\mathbf{x}-\\mathbf{y}|\\right)}{4\\pi |\\mathbf{x}-\\mathbf{y}|}$, where $k$ is the wavenumber and $\\mathbf{x},\\mathbf{y}\\in\\mathbb{R}^{3}$. Two identical elongated clusters are separated by a distance $R$ along a fixed propagation direction represented by a unit vector $\\hat{\\mathbf{z}}$. Each cluster has length $L$ and small cross-sectional diameter $D$, with $L \\gg D$, and is either aligned with $\\hat{\\mathbf{z}}$ (its long axis parallel to the propagation direction) or orthogonally oriented (its long axis perpendicular to the propagation direction). Assume the high-frequency, far-field regime in the sense that $k R \\gg 1$, $L \\ll R$, and $D \\ll R$, and neglect multiple scattering between the two clusters.\n\nLet $\\mathcal{X}$ and $\\mathcal{Y}$ denote the disjoint supports occupied by the two clusters, and consider the interaction matrix block $\\mathbf{M}$ obtained by discretizing the integral operator $T: f \\mapsto u$, with\n$$\nu(\\mathbf{x}) = \\int_{\\mathcal{Y}} G(\\mathbf{x},\\mathbf{y})\\, f(\\mathbf{y})\\, dS(\\mathbf{y}), \\quad \\mathbf{x}\\in\\mathcal{X}.\n$$\nDefine the numerical rank of $\\mathbf{M}$ at a fixed accuracy tolerance $\\varepsilon$ as the minimum integer $r(\\varepsilon)$ such that $\\mathbf{M}$ is approximable to accuracy $\\varepsilon$ by a rank-$r(\\varepsilon)$ matrix. In the high-frequency, far-field regime, the low-rank approximability of $\\mathbf{M}$ is controlled by the phase variation across the transverse coordinates to $\\hat{\\mathbf{z}}$, via the angular-spectrum or Fresnel approximation of $G(\\mathbf{x},\\mathbf{y})$ for the pair $(\\mathcal{X},\\mathcal{Y})$.\n\nTreat each cluster as a slender rectangular region, so that for parallel alignment its transverse footprint in the plane orthogonal to $\\hat{\\mathbf{z}}$ has characteristic size $D \\times D$, while for orthogonal alignment it has characteristic size $L \\times D$. Using only the scalar Helmholtz Green's function, the far-field expansion to quadratic order in transverse coordinates, and a degrees-of-freedom count based on the space-bandwidth product of the restricted kernel on the transverse supports, derive the leading-order asymptotic expression for the ratio of the numerical ranks,\n$$\n\\frac{r_{\\perp}(\\varepsilon)}{r_{\\parallel}(\\varepsilon)},\n$$\nwhere $r_{\\parallel}(\\varepsilon)$ corresponds to the case where both clusters are aligned with $\\hat{\\mathbf{z}}$ and $r_{\\perp}(\\varepsilon)$ corresponds to the case where both clusters are orthogonal to $\\hat{\\mathbf{z}}$, under the same $k$, $R$, $L$, $D$, and $\\varepsilon$.\n\nYour final answer must be a single closed-form symbolic expression in terms of $L$ and $D$ only. No numerical evaluation or rounding is required. The answer is dimensionless; do not include units.", "solution": "The user wants me to act as a meticulous STEM professor. I need to validate the problem first and then provide a solution.\n\n### Step 1: Extract Givens\n- **Green's Function**: $G(\\mathbf{x},\\mathbf{y}) = \\dfrac{\\exp(i k |\\mathbf{x}-\\mathbf{y}|)}{4\\pi |\\mathbf{x}-\\mathbf{y}|}$ for $\\mathbf{x},\\mathbf{y}\\in\\mathbb{R}^{3}$.\n- **Wavenumber**: $k$.\n- **Geometry**: Two identical elongated clusters, separated by a distance $R$ along a unit vector $\\hat{\\mathbf{z}}$.\n- **Cluster Dimensions**: Length $L$, diameter $D$, with $L \\gg D$.\n- **Physical Regime**: High-frequency, far-field, with $k R \\gg 1$, $L \\ll R$, and $D \\ll R$.\n- **Interaction**: Multiple scattering between the clusters is neglected.\n- **Supports**: $\\mathcal{X}$ and $\\mathcal{Y}$ are the disjoint spatial supports of the two clusters.\n- **Integral Operator**: $u(\\mathbf{x}) = \\int_{\\mathcal{Y}} G(\\mathbf{x},\\mathbf{y})\\, f(\\mathbf{y})\\, dS(\\mathbf{y})$ for $\\mathbf{x}\\in\\mathcal{X}$.\n- **Matrix**: $\\mathbf{M}$ is the discretization of the integral operator.\n- **Numerical Rank**: $r(\\varepsilon)$ is the minimum rank for an approximation of $\\mathbf{M}$ with accuracy $\\varepsilon$.\n- **Approximation Method**: The rank is determined by the phase variation of the kernel, analyzed using the Fresnel approximation (far-field expansion to quadratic order in transverse coordinates).\n- **Rank Estimation**: The rank is to be estimated by a degrees-of-freedom count based on the space-bandwidth product.\n- **Cluster Models**:\n    - **Parallel Alignment ($\\parallel$)**: The long axis of each cluster is parallel to $\\hat{\\mathbf{z}}$. The transverse footprint has characteristic size $D \\times D$.\n    - **Orthogonal Alignment ($\\perp$)**: The long axis of each cluster is perpendicular to $\\hat{\\mathbf{z}}$. The transverse footprint has characteristic size $L \\times D$.\n- **Objective**: Derive the leading-order asymptotic expression for the ratio $\\frac{r_{\\perp}(\\varepsilon)}{r_{\\parallel}(\\varepsilon)}$ in terms of $L$ and $D$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the fields of computational electromagnetics and numerical analysis, specifically dealing with the acceleration of boundary integral equation solvers. The scalar Helmholtz equation, its Green's function, the concept of numerical rank, and the use of low-rank approximations like the Fresnel approximation are all standard and well-established principles. The problem is well-posed, providing a clear objective and specifying the methodology for the derivation (space-bandwidth product of the Fresnel-approximated kernel). The language is objective and precise. The conditions given ($L \\gg D$, $kR \\gg 1$, $L \\ll R$) are physically realistic for many scattering problems. The problem does not contain any contradictions, ambiguities, or unsound premises. It is a standard, non-trivial problem in the specified domain.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be derived.\n\n### Solution Derivation\nThe problem requires us to find the ratio of the numerical ranks, $\\frac{r_{\\perp}(\\varepsilon)}{r_{\\parallel}(\\varepsilon)}$, for two different orientations of elongated scattering clusters. The numerical rank $r(\\varepsilon)$ of the interaction matrix $\\mathbf{M}$ is determined by the number of degrees of freedom of the continuous integral operator, which in turn is estimated by the space-bandwidth product of the kernel $G(\\mathbf{x},\\mathbf{y})$ restricted to the transverse domains of the clusters.\n\nLet the centers of the two clusters $\\mathcal{X}$ and $\\mathcal{Y}$ be separated by a vector $R\\hat{\\mathbf{z}}$. We can set up a coordinate system where a point is denoted by $\\mathbf{v} = (\\mathbf{v}_t, v_z)$, with $\\mathbf{v}_t$ being the transverse coordinate vector. For $\\mathbf{x} \\in \\mathcal{X}$ and $\\mathbf{y} \\in \\mathcal{Y}$, we can write $\\mathbf{x} \\approx ( \\mathbf{x}_t, R)$ and $\\mathbf{y} \\approx (\\mathbf{y}_t, 0)$. The distance between them is $|\\mathbf{x} - \\mathbf{y}| = \\sqrt{|\\mathbf{x}_t - \\mathbf{y}_t|^2 + (x_z - y_z)^2}$.\n\nThe problem specifies using the far-field expansion to quadratic order in transverse coordinates. Under the far-field assumption ($|\\mathbf{x}_t|, |\\mathbf{y}_t| \\ll R$ and variations in $x_z, y_z$ within clusters are much smaller than $R$), the distance can be approximated as:\n$$\n|\\mathbf{x}-\\mathbf{y}| \\approx (x_z - y_z) + \\frac{|\\mathbf{x}_t - \\mathbf{y}_t|^2}{2(x_z - y_z)} \\approx R + \\frac{|\\mathbf{x}_t|^2 - 2\\mathbf{x}_t \\cdot \\mathbf{y}_t + |\\mathbf{y}_t|^2}{2R}\n$$\nThis is the basis of the Fresnel approximation. Substituting this into the Green's function $G(\\mathbf{x}, \\mathbf{y})$, the kernel of the integral operator becomes:\n$$\nG(\\mathbf{x},\\mathbf{y}) \\approx \\frac{\\exp(i k R)}{4\\pi R} \\exp\\left( i k \\frac{|\\mathbf{x}_t - \\mathbf{y}_t|^2}{2R} \\right)\n$$\nWe can factor the kernel into parts dependent on $\\mathbf{x}_t$ and $\\mathbf{y}_t$:\n$$\nG(\\mathbf{x},\\mathbf{y}) \\approx \\left[ \\frac{\\exp(i k R)}{4\\pi R} \\exp\\left(\\frac{ik |\\mathbf{x}_t|^2}{2R}\\right) \\right] \\left[ \\exp\\left(\\frac{ik |\\mathbf{y}_t|^2}{2R}\\right) \\right] \\exp\\left(-i \\frac{k}{R} \\mathbf{x}_t \\cdot \\mathbf{y}_t\\right)\n$$\nThe terms $\\exp(ik|\\mathbf{x}_t|^2/2R)$ and $\\exp(ik|\\mathbf{y}_t|^2/2R)$ are quadratic phase factors. The numerical rank of a kernel of the form $A(\\mathbf{x}) K_0(\\mathbf{x},\\mathbf{y}) B(\\mathbf{y})$ is the same as that of $K_0(\\mathbf{x},\\mathbf{y})$ as long as $A(\\mathbf{x})$ and $B(\\mathbf{y})$ are non-zero (here, they are unimodular). Therefore, the rank is determined by the essential Fourier-type kernel:\n$$\nK_0(\\mathbf{x}_t, \\mathbf{y}_t) = \\exp\\left(-i \\frac{k}{R} \\mathbf{x}_t \\cdot \\mathbf{y}_t\\right)\n$$\nThe numerical rank $r(\\varepsilon)$ of the operator with this kernel, mapping between functions supported on the transverse domain $\\Omega_Y$ to functions supported on $\\Omega_X$, is given by the space-bandwidth product. The spatial domain is $\\Omega_Y$, and its \"area\" is $S_{space} = \\operatorname{Area}(\\Omega_Y)$. The kernel maps functions into a \"frequency\" domain. The frequency variable is conjugate to $\\mathbf{y}_t$ and is given by $\\boldsymbol{\\nu} = \\frac{k}{2\\pi R} \\mathbf{x}_t$. The range of frequencies is determined by the spatial extent of $\\mathbf{x}_t$ over the domain $\\Omega_X$. The \"area\" of the frequency band is:\n$$\nS_{band} = \\operatorname{Area}\\left(\\left\\{ \\frac{k}{2\\pi R} \\mathbf{x}_t \\mid \\mathbf{x}_t \\in \\Omega_X \\right\\}\\right) = \\left(\\frac{k}{2\\pi R}\\right)^2 \\operatorname{Area}(\\Omega_X)\n$$\nThe number of degrees of freedom, which is proportional to the numerical rank $r(\\varepsilon)$, is the product:\n$$\nr(\\varepsilon) \\propto S_{space} \\cdot S_{band} = \\operatorname{Area}(\\Omega_Y) \\cdot \\left(\\frac{k}{2\\pi R}\\right)^2 \\operatorname{Area}(\\Omega_X)\n$$\nSince the two clusters are identical, their transverse domains $\\Omega_X$ and $\\Omega_Y$ have the same area, which we denote as $S_{transverse}$.\n$$\nr(\\varepsilon) \\propto (S_{transverse})^2 \\left(\\frac{k}{2\\pi R}\\right)^2\n$$\nThe factor $(k/2\\pi R)^2$ and the constant of proportionality, which depends on $\\varepsilon$, are common to both alignment cases and will cancel in the ratio. Thus, the rank is proportional to the square of the transverse area:\n$$\nr(\\varepsilon) \\propto (S_{transverse})^2\n$$\n\nNow, we evaluate this for the two specified cases.\n\n**Case 1: Parallel alignment ($\\parallel$)**\nIn this configuration, the long axes of both clusters are aligned with the propagation direction $\\hat{\\mathbf{z}}$. The transverse footprint is given as having a characteristic size of $D \\times D$. The area of the transverse support is:\n$$\nS_{\\parallel} = D \\times D = D^2\n$$\nThe numerical rank for this case is:\n$$\nr_{\\parallel}(\\varepsilon) \\propto (S_{\\parallel})^2 = (D^2)^2 = D^4\n$$\n\n**Case 2: Orthogonal alignment ($\\perp$)**\nIn this configuration, the long axes of both clusters are perpendicular to the propagation direction $\\hat{\\mathbf{z}}$. The transverse footprint has a characteristic size of $L \\times D$. The area of the transverse support is:\n$$\nS_{\\perp} = L \\times D = LD\n$$\nThe numerical rank for this case is:\n$$\nr_{\\perp}(\\varepsilon) \\propto (S_{\\perp})^2 = (LD)^2 = L^2 D^2\n$$\n\n**Ratio of the numerical ranks**\nFinally, we compute the ratio of the ranks for the two configurations:\n$$\n\\frac{r_{\\perp}(\\varepsilon)}{r_{\\parallel}(\\varepsilon)} = \\frac{C \\cdot L^2 D^2}{C \\cdot D^4}\n$$\nwhere $C$ represents the common proportionality constants.\n$$\n\\frac{r_{\\perp}(\\varepsilon)}{r_{\\parallel}(\\varepsilon)} = \\frac{L^2 D^2}{D^4} = \\frac{L^2}{D^2} = \\left(\\frac{L}{D}\\right)^2\n$$\nThe result depends only on $L$ and $D$, as required. This result is physically intuitive: a larger transverse cross-section (orthogonal case) leads to a kernel with more rapid phase oscillations, which requires a higher-rank representation. Given $L \\gg D$, we have $r_{\\perp}(\\varepsilon) \\gg r_{\\parallel}(\\varepsilon)$.", "answer": "$$\n\\boxed{\\left(\\frac{L}{D}\\right)^{2}}\n$$", "id": "3326998"}, {"introduction": "While the smoothness of the Green's function kernel determines its theoretical compressibility, high-frequency oscillations can make a kernel seem non-compressible in practice. This computational exercise guides you through implementing phase extraction, a fundamental technique to handle such oscillations by factoring out the dominant, rapidly varying linear phase component. By comparing the numerical rank of the original kernel matrix with that of the much smoother 'residual' kernel, you will directly observe the dramatic improvement in compressibility [@problem_id:3326914].", "problem": "Consider time-harmonic electromagnetic scattering in free space, modeled by the scalar Helmholtz equation with wavenumber $k$ measured in radians per meter. The associated free-space Green's function is $G(\\mathbf r,\\mathbf r') = \\dfrac{e^{i k \\lVert \\mathbf r - \\mathbf r' \\rVert}}{4\\pi \\lVert \\mathbf r - \\mathbf r' \\rVert}$, where $\\mathbf r,\\mathbf r' \\in \\mathbb R^3$ and $\\lVert \\cdot \\rVert$ denotes the Euclidean norm. In many integral-equation formulations, one assembles a matrix whose entries are proportional to $G(\\mathbf r_i, \\mathbf r'_j)$ for discretization points $\\{\\mathbf r_i\\}$ on a “target” cluster and $\\{\\mathbf r'_j\\}$ on a “source” cluster. High-frequency oscillations in the factor $e^{i k \\lVert \\mathbf r - \\mathbf r' \\rVert}$ can impede low-rank approximations.\n\nA common remedy is phase extraction via local linearization of the distance function. Let the target and source clusters have centers $\\mathbf r_c$ and $\\mathbf r'_c$, respectively, and define $\\mathbf R_0 = \\mathbf r_c - \\mathbf r'_c$, $R_0 = \\lVert \\mathbf R_0 \\rVert$, and the unit vector $\\hat{\\mathbf u} = \\dfrac{\\mathbf R_0}{R_0}$. The first-order Taylor linearization of the map $(\\mathbf r,\\mathbf r') \\mapsto \\lVert \\mathbf r - \\mathbf r' \\rVert$ around $(\\mathbf r_c,\\mathbf r'_c)$ yields the phase function\n$$\nd(\\mathbf r,\\mathbf r') = R_0 + \\hat{\\mathbf u} \\cdot (\\mathbf r - \\mathbf r_c) - \\hat{\\mathbf u} \\cdot (\\mathbf r' - \\mathbf r'_c),\n$$\nwhich captures the dominant phase variation. Define the original kernel matrix\n$$\nK_{ij} = \\frac{e^{i k \\lVert \\mathbf r_i - \\mathbf r'_j \\rVert}}{\\lVert \\mathbf r_i - \\mathbf r'_j \\rVert},\n$$\nand the residual kernel matrix after phase extraction\n$$\nR_{ij} = \\frac{e^{i k \\left(\\lVert \\mathbf r_i - \\mathbf r'_j \\rVert - d(\\mathbf r_i,\\mathbf r'_j)\\right)}}{\\lVert \\mathbf r_i - \\mathbf r'_j \\rVert}.\n$$\nThe numerical rank of a matrix $A$ is defined here as the number of singular values $\\sigma_\\ell(A)$ satisfying $\\sigma_\\ell(A) \\ge \\varepsilon \\, \\sigma_{\\max}(A)$, where $\\sigma_{\\max}(A)$ is the largest singular value and $\\varepsilon$ is a prescribed relative tolerance.\n\nTask: Implement a program that constructs $K$ and $R$ for a set of geometries consisting of two straight line segments in $\\mathbb R^3$ (lying in the plane $z = 0$), parameterized as\n$$\n\\mathbf r(s) = \\mathbf r_c + s \\, \\hat{\\mathbf t}, \\quad s \\in [-L/2,L/2], \\quad \\lVert \\hat{\\mathbf t} \\rVert = 1,\n$$\nfor the target segment, and\n$$\n\\mathbf r'(s') = \\mathbf r'_c + s' \\, \\hat{\\mathbf t}', \\quad s' \\in [-L/2,L/2], \\quad \\lVert \\hat{\\mathbf t}' \\rVert = 1,\n$$\nfor the source segment. Discretize each segment with $M$ and $N$ points, respectively, using uniform samples $s_m$ and $s'_n$ over $[-L/2,L/2]$. Use the following conventions and parameters:\n- All distances are in meters, and the wavenumber $k$ is in radians per meter.\n- Angles are specified in radians.\n- The segment length is $L = 1$.\n- The target segment center is $\\mathbf r_c = (0,0,0)$ and its direction is $\\hat{\\mathbf t} = (1,0,0)$.\n- The source segment center is $\\mathbf r'_c = (0,D,0)$ and its direction is $\\hat{\\mathbf t}' = (\\cos \\theta, \\sin \\theta, 0)$.\n- Use $M = N = 64$ uniformly spaced samples for both segments.\n- Compute numerical ranks using the relative tolerance $\\varepsilon = 10^{-10}$.\n\nFor each test case, build $K$ and $R$ and compute:\n- The numerical rank of $K$, denoted $r_K$.\n- The numerical rank of $R$, denoted $r_R$.\n- The drop in rank $\\Delta r = r_K - r_R$.\n\nTest Suite:\n- Case $1$: $k = 50$, $D = 0.5$, $\\theta = 0$.\n- Case $2$: $k = 200$, $D = 0.5$, $\\theta = 0$.\n- Case $3$: $k = 200$, $D = 5.0$, $\\theta = 0$.\n- Case $4$: $k = 100$, $D = \\frac{1}{2}$, $\\theta = \\frac{\\pi}{4}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is the triple $[r_K,r_R,\\Delta r]$. For example, a valid output format is $[[r_{K,1},r_{R,1},\\Delta r_1],[r_{K,2},r_{R,2},\\Delta r_2],\\dots]$. Each $r_K$, $r_R$, and $\\Delta r$ must be an integer.", "solution": "The user's problem is valid. It is scientifically grounded in the principles of computational electromagnetics, specifically concerning low-rank approximations for integral equation kernels. It is well-posed, with all necessary parameters, definitions, and constraints provided, and is free from ambiguity or contradiction.\n\nThe solution proceeds by first implementing the geometry and then constructing the specified matrices. The core of the problem is to demonstrate the reduction in numerical rank achieved by extracting the dominant, rapidly oscillating phase component from the integral kernel.\n\nFirst, we establish the geometric setup for each test case. The target segment is fixed, centered at $\\mathbf r_c=(0,0,0)$ with length $L=1$ and direction $\\hat{\\mathbf t}=(1,0,0)$. The source segment, also of length $L=1$, is centered at $\\mathbf r'_c=(0,D,0)$ and oriented by the direction vector $\\hat{\\mathbf t}'=(\\cos\\theta, \\sin\\theta, 0)$. The parameters $D$ and $\\theta$ vary with each test case. Each segment is discretized into a set of points. The target segment is discretized into $M=64$ points $\\{\\mathbf r_i\\}_{i=1}^{M}$ and the source segment into $N=64$ points $\\{\\mathbf r'_j\\}_{j=1}^{N}$. The points are chosen by uniformly sampling the parameterization intervals, i.e., $\\mathbf r_i = \\mathbf r_c + s_i \\hat{\\mathbf t}$ and $\\mathbf r'_j = \\mathbf r'_c + s'_j \\hat{\\mathbf t}'$, where $s_i$ and $s'_j$ are drawn from uniform grids on $[-L/2, L/2]$.\n\nWith the discretized points established, we construct the $M \\times N$ kernel matrices. The first matrix is the original kernel matrix, $K$, with entries\n$$\nK_{ij} = \\frac{e^{i k \\lVert \\mathbf r_i - \\mathbf r'_j \\rVert}}{\\lVert \\mathbf r_i - \\mathbf r'_j \\rVert}.\n$$\nThe complex exponential term $e^{i k \\lVert \\mathbf r_i - \\mathbf r'_j \\rVert}$ oscillates rapidly for large wavenumbers $k$, which typically results in a high numerical rank for the matrix $K$.\n\nTo reduce this rank, a phase extraction technique is employed. The distance function $\\lVert \\mathbf r - \\mathbf r' \\rVert$ is linearized around the cluster centers $(\\mathbf r_c, \\mathbf r'_c)$. This yields the approximate distance function $d(\\mathbf r, \\mathbf r')$ given by\n$$\nd(\\mathbf r,\\mathbf r') = R_0 + \\hat{\\mathbf u} \\cdot (\\mathbf r - \\mathbf r_c) - \\hat{\\mathbf u} \\cdot (\\mathbf r' - \\mathbf r'_c),\n$$\nwhere $\\mathbf R_0 = \\mathbf r_c - \\mathbf r'_c$, $R_0 = \\lVert \\mathbf R_0 \\rVert$, and $\\hat{\\mathbf u} = \\mathbf R_0 / R_0$. This function captures the dominant linear phase variation between the clusters.\n\nThe residual kernel matrix, $R$, is then defined by subtracting this linear phase from the true phase:\n$$\nR_{ij} = \\frac{e^{i k \\left(\\lVert \\mathbf r_i - \\mathbf r'_j \\rVert - d(\\mathbf r_i,\\mathbf r'_j)\\right)}}{\\lVert \\mathbf r_i - \\mathbf r'_j \\rVert}.\n$$\nThe argument of the complex exponential in $R$ is $k$ times the error in the Taylor approximation of the distance. When the clusters are well-separated (i.e., $R_0$ is large compared to the cluster sizes), this error is small and varies slowly across the points, resulting in a smoother kernel matrix. A smoother matrix has singular values that decay more rapidly, leading to a lower numerical rank.\n\nThe final step is to compute the numerical ranks. For a given matrix $A$, we compute its singular values $\\sigma_\\ell(A)$ using Singular Value Decomposition (SVD). The numerical rank is the count of singular values that satisfy the condition $\\sigma_\\ell(A) \\ge \\varepsilon \\, \\sigma_{\\max}(A)$, where $\\sigma_{\\max}(A)$ is the largest singular value and $\\varepsilon = 10^{-10}$ is the specified relative tolerance. We compute the ranks $r_K$ and $r_R$ for the matrices $K$ and $R$, respectively, and their difference $\\Delta r = r_K - r_R$.\n\nThe implementation leverages `numpy` for efficient, vectorized computations. Pairwise distances $\\lVert \\mathbf r_i - \\mathbf r'_j \\rVert$ and other matrix quantities are calculated using broadcasting, which avoids explicit loops in Python and significantly improves performance. The singular values are computed using `numpy.linalg.svd`. The entire process is repeated for each test case provided in the problem statement.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_ranks(k, D, theta):\n    \"\"\"\n    Constructs matrices K and R and computes their numerical ranks for a given geometry.\n\n    Args:\n        k (float): Wavenumber in radians per meter.\n        D (float): Separation distance between segment centers.\n        theta (float): Angle of the source segment in radians.\n\n    Returns:\n        list: A list containing [r_K, r_R, delta_r], the integer ranks and their difference.\n    \"\"\"\n    # Define constants and parameters from the problem statement\n    L = 1.0\n    M = 64\n    N = 64\n    epsilon = 1e-10\n\n    # Define segment geometry\n    rc = np.array([0.0, 0.0, 0.0])\n    t_hat = np.array([1.0, 0.0, 0.0])\n    rc_prime = np.array([0.0, D, 0.0])\n    t_prime_hat = np.array([np.cos(theta), np.sin(theta), 0.0])\n\n    # Generate uniformly spaced discretization points for both segments\n    s = np.linspace(-L / 2, L / 2, M)\n    s_prime = np.linspace(-L / 2, L / 2, N)\n\n    # Compute 3D coordinates of points\n    ri = rc + s[:, np.newaxis] * t_hat\n    rj_prime = rc_prime + s_prime[:, np.newaxis] * t_prime_hat\n\n    # Compute the matrix of pairwise distances ||r_i - r'_j||\n    # Use numpy broadcasting for an efficient, loop-free calculation\n    # ri becomes (M, 1, 3) and rj_prime becomes (1, N, 3)\n    # The difference is broadcasted to (M, N, 3)\n    dist_mat = np.linalg.norm(ri[:, np.newaxis, :] - rj_prime[np.newaxis, :, :], axis=2)\n\n    # Construct the original kernel matrix K\n    K = np.exp(1j * k * dist_mat) / dist_mat\n\n    # Compute the linearized phase function d(r, r')\n    R0_vec = rc - rc_prime\n    R0 = np.linalg.norm(R0_vec)\n    # The direction vector u_hat will be [0, -1, 0] since D > 0\n    u_hat = R0_vec / R0\n\n    # Compute dot products for the linearization\n    ri_minus_rc = ri - rc\n    rj_p_minus_rc_p = rj_prime - rc_prime\n    dot1 = ri_minus_rc @ u_hat\n    dot2 = rj_p_minus_rc_p @ u_hat\n    \n    # Construct the matrix of linearized distances d_ij using broadcasting\n    d_mat = R0 + dot1[:, np.newaxis] - dot2[np.newaxis, :]\n\n    # Construct the residual kernel matrix R\n    residual_phase = dist_mat - d_mat\n    R = np.exp(1j * k * residual_phase) / dist_mat\n\n    def compute_numerical_rank(A, eps):\n        \"\"\"Helper function to compute numerical rank based on singular values.\"\"\"\n        s = np.linalg.svd(A, compute_uv=False)\n        if len(s) == 0:\n            return 0\n        s_max = s[0]\n        # The threshold must be strictly non-negative\n        threshold = eps * s_max if s_max > 0 else 0\n        rank = np.sum(s >= threshold)\n        return int(rank)\n\n    # Compute the numerical ranks and their difference\n    r_K = compute_numerical_rank(K, epsilon)\n    r_R = compute_numerical_rank(R, epsilon)\n    delta_r = r_K - r_R\n\n    return [r_K, r_R, delta_r]\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (k, D, theta)\n        (50.0, 0.5, 0.0),\n        (200.0, 0.5, 0.0),\n        (200.0, 5.0, 0.0),\n        (100.0, 0.5, np.pi / 4),\n    ]\n\n    results = []\n    for case in test_cases:\n        k, D, theta = case\n        result = calculate_ranks(k, D, theta)\n        results.append(result)\n\n    # Format the output string precisely as required: [[rK1,rR1,dr1],[rK2,rR2,dr2],...]\n    inner_parts = []\n    for res in results:\n        # Format each triple as [val1,val2,val3] with no spaces\n        inner_parts.append(f\"[{res[0]},{res[1]},{res[2]}]\")\n    \n    # Join the triples with commas and enclose in brackets\n    final_output = f\"[{','.join(inner_parts)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "3326914"}, {"introduction": "Low-rank approximations are inherently a trade-off between computational efficiency and accuracy. It is crucial for a practitioner to understand how the approximation error, often controlled by a tolerance parameter $\\varepsilon$ in the algorithm, propagates to the final physical quantities of interest. This practice problem bridges that gap by guiding you through the derivation of a rigorous error bound, connecting the $L^2$-norm error in the computed surface current to the resulting error in the far-field scattering amplitude, a primary observable in scattering problems [@problem_id:3326935].", "problem": "Consider time-harmonic scattering of an electromagnetic plane wave by a perfectly electrically conducting obstacle with smooth, closed boundary surface $\\Gamma \\subset \\mathbb{R}^{3}$, embedded in a homogeneous background characterized by wavenumber $k0$ and intrinsic impedance $\\eta0$. The exact induced surface electric current density is a vector field $\\mathbf{J} \\in L^{2}(\\Gamma)^{3}$ obtained from the electric field integral equation. Suppose a numerical scheme based on a low-rank matrix approximation of the oscillatory Green kernel (for example, an $\\mathcal{H}$-matrix or Fast Multipole-type compression) produces an approximate current $\\mathbf{J}_{h} \\in L^{2}(\\Gamma)^{3}$ such that the $L^{2}$ error is bounded by $\\|\\mathbf{J}-\\mathbf{J}_{h}\\|_{L^{2}(\\Gamma)} \\le \\varepsilon$, where $\\varepsilon0$ is known from the low-rank approximation and the stability of the discretization.\n\nThe far-field scattering amplitude $\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}})$ in the observation direction $\\hat{\\mathbf{r}} \\in \\mathbb{S}^{2}$ is given by the Stratton–Chu (SC) representation for purely electric surface current,\n$$\n\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) \\;=\\; \\frac{i k \\, \\eta}{4 \\pi} \\, \\hat{\\mathbf{r}} \\times \\Big( \\hat{\\mathbf{r}} \\times \\int_{\\Gamma} \\exp\\!\\big(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}'\\big) \\, \\mathbf{J}(\\mathbf{r}') \\, \\mathrm{d}S' \\Big),\n$$\nand $\\mathbf{E}^{\\infty}_{h}(\\hat{\\mathbf{r}})$ is defined similarly by replacing $\\mathbf{J}$ with $\\mathbf{J}_{h}$. Here $i$ is the imaginary unit, and $\\times$ denotes the vector cross product. Let $|\\Gamma|$ denote the surface area of $\\Gamma$, and let $\\|\\cdot\\|_{2}$ denote the Euclidean norm in $\\mathbb{C}^{3}$ for vectors.\n\nUsing only the SC representation and fundamental norm inequalities, derive a direction-uniform bound of the form\n$$\n\\sup_{\\hat{\\mathbf{r}} \\in \\mathbb{S}^{2}} \\big\\| \\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) - \\mathbf{E}^{\\infty}_{h}(\\hat{\\mathbf{r}}) \\big\\|_{2} \\;\\le\\; C \\, \\varepsilon,\n$$\nand compute the tightest constant $C$ that can be guaranteed using only the given information. Express your final bound as a single closed-form analytic expression in terms of $k$, $\\eta$, $|\\Gamma|$, and $\\varepsilon$. Do not include physical units in your final answer.", "solution": "The problem requires the derivation of a direction-uniform bound for the error in the far-field scattering amplitude, which arises from an error in the numerically computed surface current density. We are asked to find the tightest possible bound given the provided information.\n\nLet the exact and approximate surface current densities be $\\mathbf{J}$ and $\\mathbf{J}_{h}$, respectively. The error in the current is $\\Delta\\mathbf{J}(\\mathbf{r}') = \\mathbf{J}(\\mathbf{r}') - \\mathbf{J}_{h}(\\mathbf{r}')$. We are given that the $L^{2}$-norm of this error is bounded by $\\varepsilon$:\n$$\n\\|\\Delta\\mathbf{J}\\|_{L^{2}(\\Gamma)} = \\left( \\int_{\\Gamma} \\|\\Delta\\mathbf{J}(\\mathbf{r}')\\|_{2}^{2} \\, \\mathrm{d}S' \\right)^{1/2} \\le \\varepsilon\n$$\n\nThe far-field scattering amplitude $\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}})$ is given by the Stratton–Chu representation. The error in the far-field amplitude, $\\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) = \\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) - \\mathbf{E}^{\\infty}_{h}(\\hat{\\mathbf{r}})$, can be expressed by leveraging the linearity of the integral and the cross product operations.\n$$\n\\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) = \\frac{i k \\, \\eta}{4 \\pi} \\, \\hat{\\mathbf{r}} \\times \\left( \\hat{\\mathbf{r}} \\times \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\mathbf{J}(\\mathbf{r}') \\, \\mathrm{d}S' \\right) - \\frac{i k \\, \\eta}{4 \\pi} \\, \\hat{\\mathbf{r}} \\times \\left( \\hat{\\mathbf{r}} \\times \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\mathbf{J}_{h}(\\mathbf{r}') \\, \\mathrm{d}S' \\right)\n$$\n$$\n\\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) = \\frac{i k \\, \\eta}{4 \\pi} \\, \\hat{\\mathbf{r}} \\times \\left( \\hat{\\mathbf{r}} \\times \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\left( \\mathbf{J}(\\mathbf{r}') - \\mathbf{J}_{h}(\\mathbf{r}') \\right) \\, \\mathrm{d}S' \\right)\n$$\n$$\n\\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) = \\frac{i k \\, \\eta}{4 \\pi} \\, \\hat{\\mathbf{r}} \\times \\left( \\hat{\\mathbf{r}} \\times \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\Delta\\mathbf{J}(\\mathbf{r}') \\, \\mathrm{d}S' \\right)\n$$\n\nWe need to find the supremum of the Euclidean norm of this error over all possible observation directions $\\hat{\\mathbf{r}} \\in \\mathbb{S}^{2}$.\n$$\n\\sup_{\\hat{\\mathbf{r}} \\in \\mathbb{S}^{2}} \\left\\| \\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) \\right\\|_{2} = \\sup_{\\hat{\\mathbf{r}} \\in \\mathbb{S}^{2}} \\left\\| \\frac{i k \\, \\eta}{4 \\pi} \\, \\hat{\\mathbf{r}} \\times \\left( \\hat{\\mathbf{r}} \\times \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\Delta\\mathbf{J}(\\mathbf{r}') \\, \\mathrm{d}S' \\right) \\right\\|_{2}\n$$\n\nFirst, we use the property $\\|\\alpha \\mathbf{v}\\|_{2} = |\\alpha| \\|\\mathbf{v}\\|_{2}$ for a scalar $\\alpha \\in \\mathbb{C}$. The pre-factor is $\\frac{i k \\eta}{4\\pi}$. Since $k0$ and $\\eta0$, its modulus is $\\left| \\frac{i k \\eta}{4\\pi} \\right| = \\frac{|i| k \\eta}{4\\pi} = \\frac{k \\eta}{4\\pi}$.\n$$\n\\left\\| \\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) \\right\\|_{2} = \\frac{k \\eta}{4\\pi} \\left\\| \\hat{\\mathbf{r}} \\times \\left( \\hat{\\mathbf{r}} \\times \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\Delta\\mathbf{J}(\\mathbf{r}') \\, \\mathrm{d}S' \\right) \\right\\|_{2}\n$$\n\nLet $\\mathbf{V}(\\hat{\\mathbf{r}}) = \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\Delta\\mathbf{J}(\\mathbf{r}') \\, \\mathrm{d}S'$. The term $\\hat{\\mathbf{r}} \\times (\\hat{\\mathbf{r}} \\times \\mathbf{V})$ represents the projection of the vector $-\\mathbf{V}$ onto the plane perpendicular to the unit vector $\\hat{\\mathbf{r}}$. The norm of such a projection is always less than or equal to the norm of the original vector. That is, for any vector $\\mathbf{V} \\in \\mathbb{C}^{3}$ and unit vector $\\hat{\\mathbf{r}} \\in \\mathbb{R}^{3}$, we have $\\|\\hat{\\mathbf{r}} \\times (\\hat{\\mathbf{r}} \\times \\mathbf{V})\\|_{2} \\le \\|\\mathbf{V}\\|_{2}$. This inequality is tight, with equality holding if $\\mathbf{V}$ is orthogonal to $\\hat{\\mathbf{r}}$.\nApplying this inequality, we obtain:\n$$\n\\left\\| \\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) \\right\\|_{2} \\le \\frac{k \\eta}{4\\pi} \\left\\| \\mathbf{V}(\\hat{\\mathbf{r}}) \\right\\|_{2} = \\frac{k \\eta}{4\\pi} \\left\\| \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\Delta\\mathbf{J}(\\mathbf{r}') \\, \\mathrm{d}S' \\right\\|_{2}\n$$\n\nNext, we use the triangle inequality for integrals, which states that the norm of an integral is less than or equal to the integral of the norm: $\\|\\int \\mathbf{f}(x) \\, dx\\|_{2} \\le \\int \\|\\mathbf{f}(x)\\|_{2} \\, dx$.\n$$\n\\left\\| \\int_{\\Gamma} \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\Delta\\mathbf{J}(\\mathbf{r}') \\, \\mathrm{d}S' \\right\\|_{2} \\le \\int_{\\Gamma} \\left\\| \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2} \\, \\mathrm{d}S'\n$$\nThe exponential term is a complex scalar of unit modulus, i.e., $|\\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}')| = 1$, since its argument is purely imaginary. Therefore:\n$$\n\\int_{\\Gamma} \\left\\| \\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}') \\, \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2} \\, \\mathrm{d}S' = \\int_{\\Gamma} |\\exp(-i k \\, \\hat{\\mathbf{r}} \\cdot \\mathbf{r}')| \\left\\| \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2} \\, \\mathrm{d}S' = \\int_{\\Gamma} \\left\\| \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2} \\, \\mathrm{d}S'\n$$\nThis intermediary bound is independent of the direction $\\hat{\\mathbf{r}}$. Combining the steps so far:\n$$\n\\sup_{\\hat{\\mathbf{r}} \\in \\mathbb{S}^{2}} \\left\\| \\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) \\right\\|_{2} \\le \\frac{k \\eta}{4\\pi} \\int_{\\Gamma} \\left\\| \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2} \\, \\mathrm{d}S'\n$$\n\nThe remaining integral is the $L^1$-norm of the magnitude of $\\Delta\\mathbf{J}$ over the surface $\\Gamma$. We are given a bound on the $L^2$-norm. To relate these two norms, we use the Cauchy-Schwarz inequality for integrals. Let $f(\\mathbf{r}') = \\|\\Delta\\mathbf{J}(\\mathbf{r}')\\|_{2}$ and $g(\\mathbf{r}') = 1$. The inequality states:\n$$\n\\left( \\int_{\\Gamma} f(\\mathbf{r}') g(\\mathbf{r}') \\, \\mathrm{d}S' \\right)^2 \\le \\left( \\int_{\\Gamma} |f(\\mathbf{r}')|^2 \\, \\mathrm{d}S' \\right) \\left( \\int_{\\Gamma} |g(\\mathbf{r}')|^2 \\, \\mathrm{d}S' \\right)\n$$\nSubstituting our functions:\n$$\n\\left( \\int_{\\Gamma} \\left\\| \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2} \\cdot 1 \\, \\mathrm{d}S' \\right)^2 \\le \\left( \\int_{\\Gamma} \\left\\| \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2}^2 \\, \\mathrm{d}S' \\right) \\left( \\int_{\\Gamma} 1^2 \\, \\mathrm{d}S' \\right)\n$$\nThe terms on the right are the squared $L^2$-norm of $\\Delta\\mathbf{J}$ and the surface area $|\\Gamma|$, respectively.\n$$\n\\left( \\int_{\\Gamma} \\left\\| \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2} \\, \\mathrm{d}S' \\right)^2 \\le \\|\\Delta\\mathbf{J}\\|_{L^2(\\Gamma)}^2 \\cdot |\\Gamma|\n$$\nTaking the square root of both sides gives:\n$$\n\\int_{\\Gamma} \\left\\| \\Delta\\mathbf{J}(\\mathbf{r}') \\right\\|_{2} \\, \\mathrm{d}S' \\le \\|\\Delta\\mathbf{J}\\|_{L^2(\\Gamma)} \\sqrt{|\\Gamma|}\n$$\n\nFinally, we substitute this result into our inequality for the far-field error and use the given condition $\\|\\Delta\\mathbf{J}\\|_{L^2(\\Gamma)} \\le \\varepsilon$:\n$$\n\\sup_{\\hat{\\mathbf{r}} \\in \\mathbb{S}^{2}} \\left\\| \\Delta\\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) \\right\\|_{2} \\le \\frac{k \\eta}{4\\pi} \\left( \\|\\Delta\\mathbf{J}\\|_{L^2(\\Gamma)} \\sqrt{|\\Gamma|} \\right) \\le \\frac{k \\eta \\sqrt{|\\Gamma|}}{4\\pi} \\varepsilon\n$$\nThis provides the desired direction-uniform bound. The constant $C$ is $C = \\frac{k \\eta \\sqrt{|\\Gamma|}}{4\\pi}$. This bound is the tightest possible using only the given information because a worst-case error current $\\Delta\\mathbf{J}$ can be constructed that saturates each of the inequalities used in the derivation for a certain direction $\\hat{\\mathbf{r}}$. For example, for a fixed direction $\\hat{\\mathbf{r}}_0$, an error current of the form $\\Delta\\mathbf{J}(\\mathbf{r}') = c \\exp(i k \\hat{\\mathbf{r}}_0 \\cdot \\mathbf{r}') \\mathbf{u}_0$ with $\\|\\Delta\\mathbf{J}\\|_{L^2(\\Gamma)} = \\varepsilon$ and $\\mathbf{u}_0 \\perp \\hat{\\mathbf{r}}_0$ will achieve this bound.\n\nThus, the final expression for the direction-uniform bound is:\n$$\n\\sup_{\\hat{\\mathbf{r}} \\in \\mathbb{S}^{2}} \\big\\| \\mathbf{E}^{\\infty}(\\hat{\\mathbf{r}}) - \\mathbf{E}^{\\infty}_{h}(\\hat{\\mathbf{r}}) \\big\\|_{2} \\le \\frac{k \\eta \\varepsilon \\sqrt{|\\Gamma|}}{4 \\pi}\n$$", "answer": "$$\\boxed{\\frac{k \\eta \\varepsilon \\sqrt{|\\Gamma|}}{4 \\pi}}$$", "id": "3326935"}]}