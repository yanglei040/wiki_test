{"hands_on_practices": [{"introduction": "To build a solid understanding of smearing methods, we first dissect their mathematical foundation. While smearing is essential for numerical stability, it is not a perfect approximation and introduces a systematic bias in the calculated total energy. This practice guides you through a first-principles derivation of this energy bias, revealing how it originates from the convolution of the true occupations with a smearing kernel. By performing this analytical exercise [@problem_id:3488005], you will see precisely how the leading-order error depends on the smearing width $\\sigma$ and the local structure of the density of states at the Fermi energy, providing a rigorous basis for understanding and controlling smearing-induced inaccuracies.", "problem": "Consider a metallic system described within independent-electron theory. The total band energy per unit cell at zero temperature is given by the integral over energy of the product of energy, the density of states (DOS), and the occupation function. Let $\\epsilon$ denote the single-particle energy and $\\epsilon_{F}$ the Fermi energy. The zero-temperature occupation function is the Heaviside step function $\\Theta(\\epsilon_{F}-\\epsilon)$, and the total band energy is\n$$\nE_{0} = \\int_{-\\infty}^{+\\infty} \\epsilon\\, g(\\epsilon)\\, \\Theta(\\epsilon_{F}-\\epsilon)\\, d\\epsilon,\n$$\nwhere $g(\\epsilon)$ is the density of states (DOS).\n\nIn practical electronic-structure calculations for metals, smearing methods replace the discontinuous occupation by a smeared occupation constructed as a convolution of the Heaviside function with a normalized smearing kernel. Specifically, define a smearing kernel $s_{\\sigma}(u)$ with width parameter $\\sigma$ satisfying $\\int_{-\\infty}^{+\\infty} s_{\\sigma}(u)\\, du = 1$, $s_{\\sigma}(u) = s_{\\sigma}(-u)$, and finite even moments. The smeared occupation is\n$$\nn_{\\sigma}(\\epsilon) = \\int_{-\\infty}^{+\\infty} \\Theta(\\epsilon_{F} - \\epsilon - u)\\, s_{\\sigma}(u)\\, du,\n$$\nand the corresponding smeared total band energy is\n$$\nE_{\\sigma} = \\int_{-\\infty}^{+\\infty} \\epsilon\\, g(\\epsilon)\\, n_{\\sigma}(\\epsilon)\\, d\\epsilon.\n$$\n\nUsing only fundamental properties of convolutions and differentiability assumptions near the Fermi energy, derive how $E_{\\sigma}$ can be written in terms of a convolution between the smearing kernel and a primitive of the integrand appearing in $E_{0}$. Then, assuming the DOS is linear in a neighborhood of the Fermi energy,\n$$\ng(\\epsilon) = g_{0} + g_{1}\\, (\\epsilon - \\epsilon_{F}),\n$$\nwith constants $g_{0}$ and $g_{1}$, compute the leading bias in the energy,\n$$\n\\Delta E \\equiv E_{\\sigma} - E_{0},\n$$\nto lowest nonvanishing order in $\\sigma$.\n\nFor definiteness, take the smearing kernel to be the normalized Gaussian\n$$\ns_{\\sigma}(u) = \\frac{1}{\\sigma \\sqrt{\\pi}}\\, \\exp\\!\\big( -(\\tfrac{u}{\\sigma})^{2} \\big),\n$$\nand assume $\\sigma$ is small compared to the characteristic energy scale over which $g(\\epsilon)$ varies. Express your final answer as a single closed-form analytic expression for $\\Delta E$ in terms of $g_{0}$, $g_{1}$, $\\epsilon_{F}$, and $\\sigma$. No numerical evaluation or rounding is required, and no units should be included in your final answer.", "solution": "The problem statement will be validated by first extracting the givens and then critically evaluating the problem's scientific grounding, consistency, and structure.\n\n### Step 1: Extract Givens\n- The total band energy at zero temperature is:\n$E_{0} = \\int_{-\\infty}^{+\\infty} \\epsilon\\, g(\\epsilon)\\, \\Theta(\\epsilon_{F}-\\epsilon)\\, d\\epsilon$, where $\\epsilon$ is energy, $g(\\epsilon)$ is the density of states (DOS), $\\epsilon_{F}$ is the Fermi energy, and $\\Theta(x)$ is the Heaviside step function.\n- The smearing kernel $s_{\\sigma}(u)$ has the following properties:\n  - Width parameter $\\sigma$.\n  - Normalization: $\\int_{-\\infty}^{+\\infty} s_{\\sigma}(u)\\, du = 1$.\n  - Symmetry: $s_{\\sigma}(u) = s_{\\sigma}(-u)$ (even function).\n  - Finite even moments.\n- The smeared occupation function is:\n$n_{\\sigma}(\\epsilon) = \\int_{-\\infty}^{+\\infty} \\Theta(\\epsilon_{F} - \\epsilon - u)\\, s_{\\sigma}(u)\\, du$.\n- The smeared total band energy is:\n$E_{\\sigma} = \\int_{-\\infty}^{+\\infty} \\epsilon\\, g(\\epsilon)\\, n_{\\sigma}(\\epsilon)\\, d\\epsilon$.\n- The DOS is assumed to be linear in a neighborhood of the Fermi energy:\n$g(\\epsilon) = g_{0} + g_{1}\\, (\\epsilon - \\epsilon_{F})$, where $g_{0}$ and $g_{1}$ are constants.\n- The specific smearing kernel to be used is the normalized Gaussian:\n$s_{\\sigma}(u) = \\frac{1}{\\sigma \\sqrt{\\pi}}\\, \\exp\\!\\big( -(\\tfrac{u}{\\sigma})^{2} \\big)$.\n- The goal is to compute the leading bias $\\Delta E \\equiv E_{\\sigma} - E_{0}$ to the lowest non-vanishing order in $\\sigma$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded**: The problem is set in the context of independent-electron theory, a cornerstone of solid-state physics. The concepts of density of states, Fermi energy, and band energy are fundamental. The use of smearing methods to handle the discontinuity of the Fermi-Dirac distribution at zero temperature is a standard and essential technique in computational materials science, particularly in density functional theory calculations for metals. The problem is firmly grounded in established scientific principles.\n2.  **Well-Posed**: The problem provides all necessary definitions and equations. The assumptions (linear DOS, Gaussian smearing) are clearly stated and typical for analytic derivations of this kind. The goal is to find a specific quantity ($\\Delta E$) under these conditions, which leads to a unique and meaningful solution.\n3.  **Objective**: The language is precise and technical, free of subjective or ambiguous terminology. All quantities are formally defined.\n4.  **No Flaws Identified**: The problem does not violate any of the invalidity criteria. It is scientifically sound, formally stated, complete, and well-posed.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. A full, reasoned solution will be provided.\n\n### Solution Derivation\nThe solution proceeds in two main parts as requested by the problem. First, we express the smeared energy $E_{\\sigma}$ in terms of a convolution. Second, we compute the energy bias $\\Delta E$ by expanding this expression for a small smearing width $\\sigma$.\n\nThe zero-temperature energy can be written as:\n$$E_{0} = \\int_{-\\infty}^{\\epsilon_{F}} \\epsilon\\, g(\\epsilon)\\, d\\epsilon$$\nLet us define a primitive function $F(\\mu)$ of the integrand's smooth part, $\\epsilon g(\\epsilon)$, as:\n$$F(\\mu) = \\int_{-\\infty}^{\\mu} \\epsilon'\\, g(\\epsilon')\\, d\\epsilon'$$\nWith this definition, the zero-temperature energy is simply $E_{0} = F(\\epsilon_{F})$. The convergence of the integral at $-\\infty$ is assumed, which is physically reasonable as bands have a finite bottom.\n\nNow, we analyze the smeared energy $E_{\\sigma}$. Substituting the definition of the smeared occupation $n_{\\sigma}(\\epsilon)$:\n$$E_{\\sigma} = \\int_{-\\infty}^{+\\infty} \\epsilon\\, g(\\epsilon)\\, \\left( \\int_{-\\infty}^{+\\infty} \\Theta(\\epsilon_{F} - \\epsilon - u)\\, s_{\\sigma}(u)\\, du \\right) d\\epsilon$$\nSince the functions are well-behaved, we can apply Fubini's theorem to swap the order of integration:\n$$E_{\\sigma} = \\int_{-\\infty}^{+\\infty} s_{\\sigma}(u)\\, \\left( \\int_{-\\infty}^{+\\infty} \\epsilon\\, g(\\epsilon)\\, \\Theta(\\epsilon_{F} - u - \\epsilon)\\, d\\epsilon \\right) du$$\nThe inner integral can be simplified using the definition of the Heaviside function:\n$$\\int_{-\\infty}^{+\\infty} \\epsilon\\, g(\\epsilon)\\, \\Theta(\\epsilon_{F} - u - \\epsilon)\\, d\\epsilon = \\int_{-\\infty}^{\\epsilon_{F}-u} \\epsilon\\, g(\\epsilon)\\, d\\epsilon$$\nThis is precisely our primitive function $F$ evaluated at $\\epsilon_{F}-u$. Thus, the inner integral is $F(\\epsilon_{F}-u)$.\nSubstituting this back, we get:\n$$E_{\\sigma} = \\int_{-\\infty}^{+\\infty} F(\\epsilon_{F}-u)\\, s_{\\sigma}(u)\\, du$$\nThis expression is the convolution of the function $F$ and the smearing kernel $s_{\\sigma}$, evaluated at the Fermi energy $\\epsilon_{F}$. Specifically, if we define the convolution $(F * s_{\\sigma})(x) \\equiv \\int_{-\\infty}^{+\\infty} F(x-u)\\, s_{\\sigma}(u)\\, du$, then we have shown that $E_{\\sigma} = (F * s_{\\sigma})(\\epsilon_{F})$. This fulfills the first part of the problem.\n\nNext, to compute the bias $\\Delta E = E_{\\sigma} - E_{0}$, we Taylor expand the function $F(\\epsilon_{F}-u)$ around $u=0$. We assume $F$ is sufficiently differentiable, which is guaranteed if $g(\\epsilon)$ is smooth.\n$$F(\\epsilon_{F}-u) = \\sum_{k=0}^{\\infty} \\frac{(-u)^{k}}{k!} F^{(k)}(\\epsilon_{F}) = F(\\epsilon_{F}) - u F'(\\epsilon_{F}) + \\frac{u^{2}}{2} F''(\\epsilon_{F}) - \\frac{u^{3}}{6} F'''(\\epsilon_{F}) + \\dots$$\nwhere $F^{(k)}(\\epsilon_{F})$ denotes the $k$-th derivative of $F$ with respect to its argument, evaluated at $\\epsilon_{F}$.\nSubstitute this series into the expression for $E_{\\sigma}$:\n$$E_{\\sigma} = \\int_{-\\infty}^{+\\infty} \\left( \\sum_{k=0}^{\\infty} \\frac{(-u)^{k}}{k!} F^{(k)}(\\epsilon_{F}) \\right) s_{\\sigma}(u)\\, du = \\sum_{k=0}^{\\infty} \\frac{(-1)^k F^{(k)}(\\epsilon_{F})}{k!} \\int_{-\\infty}^{+\\infty} u^{k} s_{\\sigma}(u)\\, du$$\nLet $M_{k} = \\int_{-\\infty}^{+\\infty} u^{k} s_{\\sigma}(u)\\, du$ be the $k$-th moment of the smearing kernel. The expression for $E_{\\sigma}$ becomes:\n$$E_{\\sigma} = F(\\epsilon_{F}) M_{0} - F'(\\epsilon_{F}) M_{1} + \\frac{F''(\\epsilon_{F})}{2} M_{2} - \\dots$$\nFrom the given properties of $s_{\\sigma}(u)$:\n1.  It is normalized, so $M_{0} = \\int s_{\\sigma}(u) du = 1$.\n2.  It is an even function, $s_{\\sigma}(u) = s_{\\sigma}(-u)$, which implies that all odd moments are zero: $M_{2k+1} = 0$ for $k=0, 1, 2, \\dots$.\nThus, the series for $E_{\\sigma}$ simplifies to:\n$$E_{\\sigma} = F(\\epsilon_{F}) + \\frac{F''(\\epsilon_{F})}{2} M_{2} + \\frac{F^{(4)}(\\epsilon_{F})}{24} M_{4} + \\dots$$\nRecalling that $E_{0} = F(\\epsilon_{F})$, the energy bias is:\n$$\\Delta E = E_{\\sigma} - E_{0} = \\frac{M_{2}}{2} F''(\\epsilon_{F}) + \\frac{M_{4}}{24} F^{(4)}(\\epsilon_{F}) + \\dots$$\nThe leading bias to the lowest non-vanishing order in $\\sigma$ is given by the first term, assuming $M_2 \\neq 0$ and $F''(\\epsilon_F) \\neq 0$. We need to compute $F''(\\epsilon_{F})$ and $M_{2}$.\n\nFirst, we compute the derivatives of $F(\\mu)$.\nFrom the definition $F(\\mu) = \\int_{-\\infty}^{\\mu} \\epsilon' g(\\epsilon') d\\epsilon'$, the Fundamental Theorem of Calculus gives:\n$$F'(\\mu) = \\mu\\, g(\\mu)$$\nDifferentiating again with respect to $\\mu$:\n$$F''(\\mu) = \\frac{d}{d\\mu}(\\mu\\, g(\\mu)) = 1 \\cdot g(\\mu) + \\mu \\cdot g'(\\mu)$$\nWe evaluate this at the Fermi energy $\\mu = \\epsilon_{F}$:\n$$F''(\\epsilon_{F}) = g(\\epsilon_{F}) + \\epsilon_{F}\\, g'(\\epsilon_{F})$$\nUsing the given linear approximation for the DOS, $g(\\epsilon) = g_{0} + g_{1}(\\epsilon - \\epsilon_{F})$, we find:\n$$g(\\epsilon_{F}) = g_{0} + g_{1}(\\epsilon_{F} - \\epsilon_{F}) = g_{0}$$\n$$g'(\\epsilon) = g_{1} \\implies g'(\\epsilon_{F}) = g_{1}$$\nSubstituting these into the expression for $F''(\\epsilon_{F})$:\n$$F''(\\epsilon_{F}) = g_{0} + \\epsilon_{F}\\, g_{1}$$\n\nSecond, we compute the second moment $M_{2}$ for the Gaussian kernel $s_{\\sigma}(u) = \\frac{1}{\\sigma \\sqrt{\\pi}}\\, \\exp\\left( -(\\frac{u}{\\sigma})^{2} \\right)$.\n$$M_{2} = \\int_{-\\infty}^{+\\infty} u^{2} s_{\\sigma}(u) \\, du = \\frac{1}{\\sigma \\sqrt{\\pi}} \\int_{-\\infty}^{+\\infty} u^{2} \\exp\\left( -\\left(\\frac{u}{\\sigma}\\right)^{2} \\right) du$$\nLet's perform a change of variables $x = u/\\sigma$, so $u = x\\sigma$ and $du = \\sigma dx$.\n$$M_{2} = \\frac{1}{\\sigma \\sqrt{\\pi}} \\int_{-\\infty}^{+\\infty} (x\\sigma)^{2} \\exp(-x^{2}) (\\sigma dx) = \\frac{\\sigma^{2}}{\\sqrt{\\pi}} \\int_{-\\infty}^{+\\infty} x^{2} \\exp(-x^{2}) dx$$\nThe integral $\\int_{-\\infty}^{+\\infty} x^{2} \\exp(-x^{2}) dx$ is a standard Gaussian integral related to the Gamma function or derivable via integration by parts. We note that $\\int_{-\\infty}^{+\\infty} \\exp(-ax^{2}) dx = \\sqrt{\\pi/a}$. Differentiating with respect to $a$ gives $-\\int_{-\\infty}^{+\\infty} x^2 \\exp(-ax^2) dx = -\\frac{1}{2} \\sqrt{\\pi} a^{-3/2}$. For $a=1$, we get $\\int_{-\\infty}^{+\\infty} x^{2} \\exp(-x^{2}) dx = \\frac{\\sqrt{\\pi}}{2}$.\nSubstituting this result back into the expression for $M_{2}$:\n$$M_{2} = \\frac{\\sigma^{2}}{\\sqrt{\\pi}} \\left( \\frac{\\sqrt{\\pi}}{2} \\right) = \\frac{\\sigma^{2}}{2}$$\nThe moments $M_k$ are proportional to $\\sigma^k$, so $M_2 \\propto \\sigma^2$, $M_4 \\propto \\sigma^4$, etc. Therefore, the term with $M_2$ is the leading order term in $\\sigma$.\n\nFinally, assembling the pieces for the leading-order bias $\\Delta E$:\n$$\\Delta E \\approx \\frac{M_{2}}{2} F''(\\epsilon_{F}) = \\frac{1}{2} \\left(\\frac{\\sigma^{2}}{2}\\right) (g_{0} + \\epsilon_{F} g_{1})$$\nThis gives the final result for the leading bias in the energy:\n$$\\Delta E = \\frac{\\sigma^{2}}{4} (g_{0} + \\epsilon_{F} g_{1})$$", "answer": "$$\n\\boxed{\\frac{\\sigma^{2}}{4}(g_{0} + \\epsilon_{F} g_{1})}\n$$", "id": "3488005"}, {"introduction": "Beyond its role as a numerical tool, the smearing parameter $\\sigma$ often has a direct physical interpretation, particularly when using Fermi-Dirac smearing. This scheme is equivalent to simulating a system at a finite electronic temperature $T$, where $\\sigma = k_{B} T$, which generates a corresponding electronic entropy $S$. This practice [@problem_id:3487962] explores this crucial connection, tasking you with deriving the relationship between $\\sigma$, the density of states at the Fermi level $D(E_{F})$, and the electronic entropy. Completing this exercise will clarify the distinction between the zero-temperature total energy and the finite-temperature free energy $F = E - TS$, a quantity that is central to many electronic structure codes.", "problem": "A metallic system is treated within Density Functional Theory (DFT) using Brillouin-zone sampling, where electronic occupations are broadened by an energy-smearing parameter $\\sigma$ to stabilize convergence in the presence of a Fermi surface. Consider Fermi–Dirac smearing, interpreted as a finite electronic temperature, so that the occupation of a single-particle state of energy $E$ is $f(E) = \\left[1 + \\exp\\left((E - \\mu)/(k_{B} T)\\right)\\right]^{-1}$, with chemical potential $\\mu$ determined by particle-number conservation. The total electronic entropy is defined by the standard statistical-mechanical expression $S = -k_{B} \\sum_{i} \\left[ f_{i} \\ln f_{i} + (1 - f_{i}) \\ln(1 - f_{i}) \\right]$, and in the continuum limit is represented by an integral over the density of states $D(E)$. Assume the system is metallic with a density of states that is slowly varying near the Fermi level $E_{F}$, so that $D(E)$ may be treated as approximately constant and equal to $D(E_{F})$ in a narrow window around $E_{F}$. The total number of electrons is $N_{e}$.\n\nStarting from these definitions and physical assumptions:\n\n- Derive, to leading order in small $T$, an analytical expression for the total entropy $S$ in terms of $D(E_{F})$, $k_{B}$, and $T$. Then write the per-electron entropy $s = S/N_{e}$ and solve symbolically for an energy-smearing parameter $\\sigma$ that, under Fermi–Dirac smearing (with the identification $\\sigma = k_{B} T$), achieves a prescribed target $s$.\n\n- Explain, in the same derivation framework, how choosing $\\sigma$ via a target $s$ affects the computed total energy and forces in DFT when the code reports the electronic free energy $F = E - T S$ and its derivatives, and clarify the finite-temperature interpretation versus purely numerical broadening.\n\nNow apply your symbolic expression for $\\sigma$ to the following concrete case. The total electron count is $N_{e} = $ $20$, the density of states at the Fermi level for the entire simulation cell (including spin) is $D(E_{F}) = $ $10$ states per electronvolt, and the target per-electron entropy is $s = \\alpha k_{B}$ with $\\alpha = $ $0.05$. Compute $\\sigma$ that achieves this $s$ under the low-temperature approximation. Express your final $\\sigma$ in electronvolts and round your answer to four significant figures.", "solution": "The problem is subjected to validation prior to any attempt at a solution.\n\n### Step 1: Extract Givens\n-   **System**: Metallic system described by Density Functional Theory (DFT) with Brillouin-zone sampling.\n-   **Occupation Function**: Fermi–Dirac smearing, $f(E) = \\left[1 + \\exp\\left((E - \\mu)/(k_{B} T)\\right)\\right]^{-1}$.\n-   **Smearing Parameter**: $\\sigma$ is identified with the thermal energy, $\\sigma = k_{B} T$.\n-   **Total Entropy**: $S = -k_{B} \\sum_{i} \\left[ f_{i} \\ln f_{i} + (1 - f_{i}) \\ln(1 - f_{i}) \\right]$.\n-   **Continuum Limit**: The sum is replaced by an integral over the density of states (DOS), $D(E)$.\n-   **Approximation**: The DOS is constant near the Fermi level, $D(E) \\approx D(E_{F})$.\n-   **Total Electron Count**: $N_{e}$.\n-   **Reported Energy**: The electronic free energy is $F = E - T S$.\n-   **Concrete Case Data**:\n    -   Total electron count: $N_{e} = 20$.\n    -   Density of states at the Fermi level: $D(E_{F}) = 10$ states per electronvolt.\n    -   Target per-electron entropy: $s = \\alpha k_{B}$ with $\\alpha = 0.05$.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientific Grounding**: The problem is scientifically sound. It describes Fermi-Dirac smearing, a standard and widely used technique in DFT calculations for metallic systems. The expressions for the occupation function and entropy are fundamental results from statistical mechanics. The low-temperature approximation and the derivation of electronic entropy are based on the well-established Sommerfeld expansion in solid-state physics.\n-   **Well-Posedness**: The problem is well-posed. It clearly defines the task: derive a symbolic expression, provide a physical explanation, and perform a numerical calculation based on the derived formula. The provided information is sufficient and self-consistent for these tasks.\n-   **Objectivity**: The problem is formulated using precise, objective, and standard scientific terminology, free from ambiguity or subjective claims.\n\n### Step 3: Verdict and Action\nThe problem is valid as it is scientifically grounded, well-posed, and objective. A solution will be provided.\n\n### Derivation of Total Entropy $S$\nThe total entropy $S$ in the continuum limit is given by the integral of the single-state entropy over all states, weighted by the density of states $D(E)$:\n$$S = -k_{B} \\int_{-\\infty}^{\\infty} D(E) \\left[ f(E) \\ln f(E) + (1 - f(E)) \\ln(1 - f(E)) \\right] dE$$\nwhere $f(E)$ is the Fermi-Dirac distribution. For a metallic system at low temperature $T$, the entropy is primarily due to thermal excitations of electrons in a narrow energy window of width $\\sim k_B T$ around the Fermi level $E_F$. The problem assumes that the density of states $D(E)$ can be treated as a constant, $D(E_F)$, in this region. The standard approach to derive the leading-order term for the electronic entropy is through the electronic heat capacity, $C_{V}$.\n\nThe electronic heat capacity at constant volume is defined as $C_{V} = \\left(\\frac{\\partial U}{\\partial T}\\right)_{V}$, where $U$ is the total electronic internal energy, $U = \\int_{-\\infty}^{\\infty} E D(E) f(E) dE$. In the low-temperature limit, the change in internal energy relative to the ground state energy $U(0)$ is given by the well-known result from the Sommerfeld expansion:\n$$\\Delta U = U(T) - U(0) = \\frac{\\pi^2}{6} D(E_F) (k_B T)^2$$\nThe electronic heat capacity is then:\n$$C_{V} = \\frac{d}{dT} \\left( U(0) + \\frac{\\pi^2}{6} D(E_F) (k_B T)^2 \\right) = \\frac{\\pi^2}{3} D(E_F) k_B^2 T$$\nThis linear dependence on temperature is a hallmark of the electron gas in a metal. The entropy $S$ is obtained by integrating $C_V/T$ from absolute zero to the temperature $T$:\n$$S(T) = \\int_{0}^{T} \\frac{C_V(T')}{T'} dT' = \\int_{0}^{T} \\left( \\frac{\\pi^2}{3} D(E_F) k_B^2 \\right) dT'$$\nPerforming the integration yields the expression for the total entropy to leading order in $T$:\n$$S = \\frac{\\pi^2}{3} D(E_F) k_B^2 T$$\n\n### Expression for Smearing Parameter $\\sigma$\nThe per-electron entropy $s$ is defined as $s = S/N_{e}$. Substituting the derived expression for $S$:\n$$s = \\frac{\\pi^2 D(E_F) k_B^2 T}{3 N_{e}}$$\nThe problem specifies the identification of the smearing parameter $\\sigma$ with the thermal energy, $\\sigma = k_{B} T$. Substituting this into the expression for $s$:\n$$s = \\frac{\\pi^2 D(E_F) k_B \\sigma}{3 N_{e}}$$\nWe can now solve this equation for the smearing parameter $\\sigma$ required to achieve a target per-electron entropy $s$:\n$$\\sigma = \\frac{3 N_{e} s}{\\pi^2 D(E_F) k_B}$$\n\n### Physical Interpretation and Effect on DFT Calculations\nIn the framework of DFT for metals, there are two common interpretations of the smearing parameter $\\sigma$:\n1.  **Numerical Broadening**: Smearing is used as a numerical technique to accelerate and stabilize the self-consistent field (SCF) convergence by smoothing the sharp discontinuity in the occupation numbers at the Fermi level. In this context, $\\sigma$ is an unphysical parameter. The goal is to recover the zero-temperature ground state properties. DFT codes typically calculate the free energy $F(\\sigma) = U(\\sigma) - TS(\\sigma)$, where $U(\\sigma)$ is the internal energy evaluated with smeared occupations. The zero-temperature total energy $U(0)$ is then estimated by extrapolating $F(\\sigma)$ to the $\\sigma \\to 0$ limit. Using our derived expressions with $\\sigma = k_B T$:\n    $$F(\\sigma) = U(T) - TS = \\left(U(0) + \\frac{\\pi^2}{6} D(E_F) \\sigma^2 \\right) - T\\left(\\frac{\\pi^2}{3} D(E_F) k_B \\sigma\\right)$$\n    $$F(\\sigma) = U(0) + \\frac{\\pi^2}{6} D(E_F) \\sigma^2 - \\frac{\\sigma}{k_B}\\left(\\frac{\\pi^2}{3} D(E_F) k_B \\sigma\\right) = U(0) - \\frac{\\pi^2}{6} D(E_F) \\sigma^2$$\n    This shows that the free energy has a quadratic dependence on $\\sigma$, which provides a basis for the extrapolation $F(\\sigma \\to 0) = U(0)$.\n\n2.  **Finite Electronic Temperature**: Fermi-Dirac smearing can be interpreted literally as describing the system at a finite electronic temperature $T = \\sigma/k_B$. The quantity minimized in the SCF cycle corresponds to the grand potential, and the reported energy is the Helmholtz free energy $F = U - TS$. Forces on atoms are calculated as derivatives of this free energy, $F_{atom} = -\\nabla_R F$, and thus include temperature-dependent effects.\n\nChoosing $\\sigma$ to achieve a target per-electron entropy $s$ firmly places the calculation in the second interpretation. It implies that we are simulating the system at a specific, physically meaningful electronic temperature $T = \\sigma/k_B$. When comparing different atomic configurations or systems, one would be comparing their free energies $F$ at a constant per-electron entropy $s$, which is a non-standard statistical ensemble (as opposed to the more common canonical ensemble of constant $T$). This choice fixes the thermodynamic state, and the resulting total energy (which is $F$) and forces are those corresponding to that finite temperature.\n\n### Application to the Concrete Case\nWe are given the following values:\n-   Total electron count: $N_{e} = 20$.\n-   Density of states at the Fermi level: $D(E_{F}) = 10 \\text{ eV}^{-1}$.\n-   Target per-electron entropy: $s = \\alpha k_{B}$, with $\\alpha = 0.05$. So, $s/k_B = 0.05$.\n\nWe use the symbolic expression for $\\sigma$:\n$$\\sigma = \\frac{3 N_{e} s}{\\pi^2 D(E_F) k_B} = \\frac{3 N_{e}}{\\pi^2 D(E_F)} \\left(\\frac{s}{k_B}\\right)$$\nSubstituting the given numerical values:\n$$\\sigma = \\frac{3 \\times 20}{\\pi^2 \\times 10 \\text{ eV}^{-1}} \\times 0.05$$\nThe Boltzmann constant $k_B$ cancels out, and the units of $\\sigma$ will be electronvolts ($eV$).\n$$\\sigma = \\frac{60 \\times 0.05}{\\pi^2 \\times 10} \\text{ eV} = \\frac{3}{\\pi^2 \\times 10} \\text{ eV}$$\nCalculating the numerical value:\n$$\\sigma = \\frac{3}{10 \\pi^2} \\text{ eV} \\approx \\frac{3}{10 \\times 9.8696044} \\text{ eV} \\approx 0.030396355 \\text{ eV}$$\nRounding the result to four significant figures, we get:\n$$\\sigma \\approx 0.03040 \\text{ eV}$$", "answer": "$$\\boxed{0.03040}$$", "id": "3487962"}, {"introduction": "The theoretical understanding of smearing bias has led to the development of advanced methods designed to systematically cancel the leading-order error terms. This hands-on coding exercise [@problem_id:3488000] challenges you to implement and compare a sophisticated Methfessel-Paxton smearing scheme against a simpler alternative within the context of a tight-binding model. By engineering a scenario with sharp features in the density of states—a common challenge in real materials—you will numerically validate the superior accuracy of the advanced kernel. This practice provides tangible proof of the theoretical concepts and demonstrates the practical impact of choosing an appropriate smearing method for accurate and reliable calculations.", "problem": "Consider a metallic system where the occupation function at zero temperature is a discontinuous step. In numerical Brillouin-zone integrations for metals, one replaces the discontinuous step by a smooth approximation to reduce sampling noise. Let the exact zero-temperature occupation be given by the Heaviside step function $f_{0}(E) = \\Theta(E_{F} - E)$, where $E$ denotes energy and $E_{F}$ denotes the Fermi energy. A general smearing scheme replaces $f_{0}(E)$ by a smooth function $f_{\\sigma}(E)$ constructed from a kernel $g(u)$ of unit mass and characteristic width $\\sigma$. Define the scaled variable $x = (E - E_{F})/\\sigma$ and the occupation as $f_{\\sigma}(E) = \\int_{x}^{\\infty} g(u)\\,du$, so that $\\frac{d}{dE}f_{\\sigma}(E) = -\\frac{1}{\\sigma}g((E - E_{F})/\\sigma)$.\n\nLet the Density of States (DOS) be a smooth function $D(E)$ in a neighborhood of $E_{F}$ and consider the energy functional $F = \\int_{-\\infty}^{\\infty} E\\,D(E)\\,f(E)\\,dE$, where $f(E)$ denotes the occupation function. The smearing-induced energy bias $\\Delta F(\\sigma) = F_{\\sigma} - F_{0}$ depends on the kernel through its moments. By writing $D(E)$ as a Taylor expansion around $E_{F}$, $D(E_{F} + \\sigma x) = \\sum_{m=0}^{\\infty} \\frac{\\sigma^{m}}{m!} D^{(m)}(E_{F})\\,x^{m}$ and integrating term-by-term, one finds that the leading dependence of $\\Delta F(\\sigma)$ is governed by the moments of $g$, $\\mu_{m} = \\int_{-\\infty}^{\\infty} x^{m} g(x)\\,dx$, and cancellations occur when specific moments vanish. The Methfessel-Paxton (MP) family of kernels of order $N$ is designed to cancel even moments up to order $2N$, thereby reducing the bias that couples to DOS curvature. In contrast, Marzari-Vanderbilt (MV) cold smearing employs a strictly positive-definite kernel that does not cancel the same set of moments but improves numerical stability.\n\nYour task is to construct and validate, by computation, a case where MP order $N=2$ outperforms MV cold smearing in total-energy bias due to structured DOS curvature near $E_{F}$. Use a two-dimensional tight-binding model on a square lattice with nearest-neighbor hopping $t$ and next-nearest-neighbor hopping $t'$:\n$$\n\\varepsilon(\\mathbf{k}) = -2t\\left[\\cos(k_{x}) + \\cos(k_{y})\\right] - 4t'\\,\\cos(k_{x})\\cos(k_{y}),\n$$\nwith $\\mathbf{k}$ sampled uniformly over the Brillouin zone $[-\\pi,\\pi]\\times[-\\pi,\\pi]$. Let the zero-temperature energy $F_{0}$ be the discrete sum over the sampling grid\n$$\nF_{0} = \\frac{1}{N_{k}} \\sum_{\\mathbf{k}} \\varepsilon(\\mathbf{k})\\,\\Theta(E_{F} - \\varepsilon(\\mathbf{k})),\n$$\nand the smeared energy be\n$$\nF_{\\sigma}[g] = \\frac{1}{N_{k}} \\sum_{\\mathbf{k}} \\varepsilon(\\mathbf{k})\\,f_{\\sigma}(\\varepsilon(\\mathbf{k})),\n$$\nwith $f_{\\sigma}(\\varepsilon) = \\int_{(\\varepsilon - E_{F})/\\sigma}^{\\infty} g(u)\\,du$.\n\nImplement the following kernels:\n\n1. MP order $N=2$ kernel constructed as a linear combination of even derivatives of the Gaussian,\n$$\ng_{\\mathrm{MP2}}(x) = \\sum_{n=0}^{2} c_{n}\\,\\frac{d^{2n}}{dx^{2n}}\\left(\\frac{1}{\\sqrt{\\pi}}e^{-x^{2}}\\right),\n$$\nwhere the coefficients $c_{n}$ are determined by enforcing the moment conditions\n$$\n\\int_{-\\infty}^{\\infty} g_{\\mathrm{MP2}}(x)\\,dx = 1,\\quad \\int_{-\\infty}^{\\infty} x^{2} g_{\\mathrm{MP2}}(x)\\,dx = 0,\\quad \\int_{-\\infty}^{\\infty} x^{4} g_{\\mathrm{MP2}}(x)\\,dx = 0.\n$$\nExpress the derivatives in terms of physicists' Hermite polynomials $H_{m}(x)$ via $\\frac{d^{m}}{dx^{m}}e^{-x^{2}} = (-1)^{m}H_{m}(x)e^{-x^{2}}$ so that\n$$\ng_{\\mathrm{MP2}}(x) = \\frac{1}{\\sqrt{\\pi}}e^{-x^{2}}\\left[c_{0}H_{0}(x) + c_{1}H_{2}(x) + c_{2}H_{4}(x)\\right].\n$$\n\n2. MV cold smearing kernel corresponding to the occupation\n$f_{\\mathrm{cold}}(x) = \\frac{1}{2}\\left[1 - \\operatorname{erf}(x)\\right] + \\frac{x}{\\sqrt{\\pi}}e^{-x^{2}}$,\nso that\n$g_{\\mathrm{cold}}(x) = -\\frac{d}{dx}f_{\\mathrm{cold}}(x) = \\frac{2}{\\sqrt{\\pi}}x^{2}e^{-x^{2}}$.\n\nDesign the numerical algorithm to compute $F_{0}$ and $F_{\\sigma}[g]$ for both kernels, and evaluate the energy bias $\\Delta F(\\sigma) = F_{\\sigma}[g] - F_{0}$ in electron-volts (eV). Use the following test suite to validate the claim that MP order $N=2$ outperforms cold smearing when the DOS has strong curvature near $E_{F}$:\n\n- Case 1 (structured DOS near $E_{F}$, happy path): $t = 1\\,\\mathrm{eV}$, $t' = 0\\,\\mathrm{eV}$, $E_{F} = 0\\,\\mathrm{eV}$, $\\sigma = 0.15\\,\\mathrm{eV}$.\n- Case 2 (away from van Hove singularity): $t = 1\\,\\mathrm{eV}$, $t' = 0\\,\\mathrm{eV}$, $E_{F} = 1.0\\,\\mathrm{eV}$, $\\sigma = 0.15\\,\\mathrm{eV}$.\n- Case 3 (enhanced curvature via next-nearest hopping): $t = 1\\,\\mathrm{eV}$, $t' = 0.30\\,\\mathrm{eV}$, $E_{F} = 0\\,\\mathrm{eV}$, $\\sigma = 0.15\\,\\mathrm{eV}$.\n- Case 4 (boundary: small smearing width): $t = 1\\,\\mathrm{eV}$, $t' = 0\\,\\mathrm{eV}$, $E_{F} = 0\\,\\mathrm{eV}$, $\\sigma = 0.05\\,\\mathrm{eV}$.\n\nFor each case, compute the boolean outcome\n$\n\\mathrm{better} = \\left|\\Delta F_{\\mathrm{MP2}}(\\sigma)\\right|  \\left|\\Delta F_{\\mathrm{cold}}(\\sigma)\\right|.\n$\n\nPhysical units: Report energy biases in electron-volts (eV). The final program output should be a single line containing the list of boolean outcomes for the four cases, formatted as a comma-separated list enclosed in square brackets, for example, $[{\\tt True},{\\tt False},{\\tt True},{\\tt True}]$. Angles are sampled in radians when constructing $\\varepsilon(\\mathbf{k})$.\n\nYour program must be a complete, runnable program. It must not require user input and must produce the exact single-line output specified. The numerical sampling grid must be uniform and sufficiently fine to resolve the van Hove singularity; use a square grid with $N_{k}$ points in total and explain how $N_{k}$ is chosen in the solution. Ensure scientific realism by justifying all algorithmic approximations. The answer for each test case must be a boolean.", "solution": "The user-provided problem is valid. It is scientifically grounded in the principles of computational solid-state physics, specifically concerning the numerical integration of electron occupations in metallic systems. The problem is well-posed, providing all necessary definitions, equations, and parameters to construct a unique numerical solution. The language is objective and unambiguous. The task is to implement and compare two established smearing techniques, Methfessel-Paxton (MP) and Marzari-Vanderbilt (MV, or cold smearing), under specific conditions designed to highlight their theoretical differences.\n\nThe core principle behind this comparison lies in how the error (or bias) introduced by a smearing scheme, $\\Delta F(\\sigma) = F_{\\sigma} - F_{0}$, depends on the properties of the Density of States, $D(E)$, near the Fermi energy, $E_{F}$. By Taylor-expanding the energy functional, it can be shown that the leading terms in the energy bias are proportional to the even moments, $\\mu_{2n} = \\int_{-\\infty}^{\\infty} x^{2n} g(x)\\,dx$, of the smearing kernel $g(x)$ and the derivatives of the DOS at the Fermi level, $D^{(m)}(E_{F})$.\n\nThe Methfessel-Paxton schemes are constructed precisely to eliminate these leading error terms. An MP scheme of order $N$ is designed such that the even moments $\\mu_{2}, \\mu_{4}, \\dots, \\mu_{2N}$ are all zero. This systematically cancels the bias terms that couple to the curvature of the DOS, $D''(E_F)$, and its higher even-order derivatives. In contrast, other methods like Gaussian smearing or the specified cold smearing do not have these moments cancelled. The primary error of such methods is typically proportional to $\\mu_{2}\\sigma^{2}D'(E_{F})$ for the grand potential and related to $\\sigma^2 D''(E_F)$ for the total energy, becoming large when the DOS has significant structure at $E_F$. The problem sets up a scenario (a van Hove singularity) where $D(E)$ has very high curvature, which is the ideal situation to demonstrate the superiority of the MP method.\n\nOur numerical procedure will involve the following steps:\n1.  Derive the explicit functional form of the occupation function $f_{\\mathrm{MP2}}(x)$ for the Methfessel-Paxton order $N=2$ case.\n2.  Define the numerical k-point grid and calculate the energy dispersion $\\varepsilon(\\mathbf{k})$ over this grid for each test case.\n3.  Compute the exact zero-temperature energy, $F_{0}$, by summing energies below or at the Fermi level.\n4.  Compute the smeared energies, $F_{\\sigma}$, for both the MP2 and cold smearing schemes by summing energies weighted by their respective occupation functions.\n5.  Calculate the energy bias $\\Delta F = F_{\\sigma} - F_{0}$ for each method and compare their absolute magnitudes to determine which is 'better'.\n\n**Step 1: Derivation of the Methfessel-Paxton (N=2) Occupation Function**\n\nThe MP kernel of order $N$ is derived from a basis of derivatives of a Gaussian, $G(x) = \\frac{1}{\\sqrt{\\pi}}e^{-x^{2}}$, as $g_{\\mathrm{MPN}}(x) = \\sum_{n=0}^{N} c_{n} G^{(2n)}(x)$. The occupation function is $f(x) = \\int_{x}^{\\infty} g(u)\\,du$. For $n0$, $\\int_{x}^{\\infty} G^{(2n)}(u)\\,du = -G^{(2n-1)}(x)$. For $n=0$, $\\int_{x}^{\\infty} G(u)\\,du = \\frac{1}{2}\\mathrm{erfc}(x)$.\nThus, the occupation function is:\n$$\nf_{\\mathrm{MPN}}(x) = c_{0} \\frac{1}{2}\\mathrm{erfc}(x) - \\sum_{n=1}^{N} c_{n} G^{(2n-1)}(x)\n$$\nUsing the relation $G^{(m)}(x) = \\frac{(-1)^m}{\\sqrt{\\pi}} H_m(x) e^{-x^2}$, where $H_m(x)$ are the physicists' Hermite polynomials, this becomes:\n$$\nf_{\\mathrm{MPN}}(x) = c_{0} \\frac{1}{2}\\mathrm{erfc}(x) + \\frac{e^{-x^2}}{\\sqrt{\\pi}} \\sum_{n=1}^{N} c_{n} H_{2n-1}(x)\n$$\nThe coefficients $c_n$ for order $N$ are given by $c_n = \\frac{(-1)^n}{2^{2n} n!}$. For $N=2$, we have:\n$c_{0} = \\frac{(-1)^0}{2^0 0!} = 1$\n$c_{1} = \\frac{(-1)^1}{2^2 1!} = -\\frac{1}{4}$\n$c_{2} = \\frac{(-1)^2}{2^4 2!} = \\frac{1}{32}$\n\nThe required Hermite polynomials are $H_1(x) = 2x$ and $H_3(x) = 8x^3 - 12x$. Substituting these into the formula for $f_{\\mathrm{MP2}}(x)$:\n$$\nf_{\\mathrm{MP2}}(x) = \\frac{1}{2}\\mathrm{erfc}(x) + \\frac{e^{-x^2}}{\\sqrt{\\pi}} \\left[ \\left(-\\frac{1}{4}\\right) H_1(x) + \\left(\\frac{1}{32}\\right) H_3(x) \\right]\n$$\n$$\nf_{\\mathrm{MP2}}(x) = \\frac{1}{2}\\left(1 - \\mathrm{erf}(x)\\right) + \\frac{e^{-x^2}}{\\sqrt{\\pi}} \\left[ -\\frac{1}{4}(2x) + \\frac{1}{32}(8x^3 - 12x) \\right]\n$$\n$$\nf_{\\mathrm{MP2}}(x) = \\frac{1}{2}\\left(1 - \\mathrm{erf}(x)\\right) + \\frac{e^{-x^2}}{\\sqrt{\\pi}} \\left[ -\\frac{x}{2} + \\frac{x^3}{4} - \\frac{3x}{8} \\right]\n$$\n$$\nf_{\\mathrm{MP2}}(x) = \\frac{1}{2}\\left(1 - \\mathrm{erf}(x)\\right) + \\frac{e^{-x^2}}{\\sqrt{\\pi}} \\left( \\frac{x^3}{4} - \\frac{7x}{8} \\right)\n$$\nThe cold smearing occupation function is given directly in the problem statement:\n$$\nf_{\\mathrm{cold}}(x) = \\frac{1}{2}\\left[1 - \\operatorname{erf}(x)\\right] + \\frac{x}{\\sqrt{\\pi}}e^{-x^{2}}\n$$\n\n**Step 2: Numerical Setup and Calculation**\n\nTo accurately represent the electronic structure and particularly the van Hove singularity, a fine sampling of the Brillouin zone is required. A square grid of $1000 \\times 1000 = 10^6$ k-points is chosen. This dense mesh ensures that the discrete sum over k-points provides a well-converged approximation to the continuous Brillouin zone integral, adequately resolving the sharp features in the Density of States.\n\nThe algorithm proceeds as follows for each test case:\n1.  Define a uniform grid of $N_k = 1000 \\times 1000$ points for $(k_x, k_y)$ in the range $[-\\pi, \\pi] \\times [-\\pi, \\pi]$.\n2.  Calculate the energy $\\varepsilon(\\mathbf{k})$ for each point on the grid using the tight-binding formula.\n3.  Compute the zero-temperature energy $F_0$ by summing all energies $\\varepsilon(\\mathbf{k})$ such that $\\varepsilon(\\mathbf{k}) \\le E_F$, and then normalizing by the total number of k-points, $N_k$.\n4.  For both MP2 and cold smearing methods:\n    a. Calculate the scaled energy variable $x_k = (\\varepsilon(\\mathbf{k}) - E_F) / \\sigma$.\n    b. Evaluate the occupation function $f(x_k)$ for all k-points.\n    c. Compute the smeared energy $F_\\sigma = \\frac{1}{N_k} \\sum_{\\mathbf{k}} \\varepsilon(\\mathbf{k}) f(x_k)$.\n5.  Calculate the biases $\\Delta F_{\\mathrm{MP2}} = F_{\\mathrm{MP2}} - F_0$ and $\\Delta F_{\\mathrm{cold}} = F_{\\mathrm{cold}} - F_0$.\n6.  Determine the boolean outcome by comparing the absolute values of the biases: $|\\Delta F_{\\mathrm{MP2}}|  |\\Delta F_{\\mathrm{cold}}|$.\n\nThis procedure is implemented for the four specified test cases to validate the theoretical expectation that MP2 is superior when the DOS has strong curvature at the Fermi level.", "answer": "```python\nimport numpy as np\nfrom scipy.special import erf\n\ndef solve():\n    \"\"\"\n    Computes and compares the energy bias of MP2 and cold smearing methods\n    for a 2D tight-binding model.\n    \"\"\"\n\n    # Test cases defined in the problem statement.\n    # (t, t', E_F, sigma)\n    test_cases = [\n        (1.0, 0.0, 0.0, 0.15),   # Case 1: Structured DOS near EF\n        (1.0, 0.0, 1.0, 0.15),   # Case 2: Away from van Hove singularity\n        (1.0, 0.30, 0.0, 0.15),  # Case 3: Enhanced curvature via t'\n        (1.0, 0.0, 0.0, 0.05),   # Case 4: Small smearing width\n    ]\n\n    results = []\n\n    # A sufficiently fine grid to resolve the van Hove singularity.\n    num_k_points_1d = 1000\n    total_k_points = num_k_points_1d ** 2\n\n    # Create the k-space grid\n    k_vals = np.linspace(-np.pi, np.pi, num_k_points_1d, endpoint=False)\n    kx, ky = np.meshgrid(k_vals, k_vals)\n\n    for case in test_cases:\n        t, t_prime, E_F, sigma = case\n\n        # Calculate the energy dispersion relation over the k-grid\n        energies = -2 * t * (np.cos(kx) + np.cos(ky)) - 4 * t_prime * np.cos(kx) * np.cos(ky)\n\n        # 1. Calculate the exact zero-temperature energy F_0\n        # The sum of energies for all states with energy = E_F\n        F0 = np.sum(energies[energies = E_F]) / total_k_points\n\n        # Calculate the scaled energy variable x = (E - E_F) / sigma\n        x = (energies - E_F) / sigma\n\n        # 2. Calculate smeared energy for Marzari-Vanderbilt (cold smearing)\n        # f_cold(x) = 1/2 * [1 - erf(x)] + (x / sqrt(pi)) * exp(-x^2)\n        f_cold_vals = 0.5 * (1 - erf(x)) + (x / np.sqrt(np.pi)) * np.exp(-x**2)\n        F_cold = np.sum(energies * f_cold_vals) / total_k_points\n        delta_F_cold = F_cold - F0\n\n        # 3. Calculate smeared energy for Methfessel-Paxton (N=2)\n        # f_mp2(x) = 1/2 * [1 - erf(x)] + (exp(-x^2) / sqrt(pi)) * (x^3/4 - 7x/8)\n        f_mp2_vals = 0.5 * (1 - erf(x)) + (np.exp(-x**2) / np.sqrt(np.pi)) * (x**3 / 4.0 - 7.0 * x / 8.0)\n        F_mp2 = np.sum(energies * f_mp2_vals) / total_k_points\n        delta_F_mp2 = F_mp2 - F0\n\n        # 4. Compare the absolute biases\n        is_mp2_better = np.abs(delta_F_mp2)  np.abs(delta_F_cold)\n        results.append(is_mp2_better)\n\n    # Format the final output as a string representation of a list of Booleans\n    # Capitalize True/False to match standard Python repr\n    output_str = f\"[{','.join(str(r) for r in results)}]\"\n    print(output_str)\n\nsolve()\n```", "id": "3488000"}]}