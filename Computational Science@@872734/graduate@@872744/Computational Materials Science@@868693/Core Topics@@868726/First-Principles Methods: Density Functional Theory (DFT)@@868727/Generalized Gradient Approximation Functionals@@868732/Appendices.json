{"hands_on_practices": [{"introduction": "The reduced density gradient, $s$, is a key dimensionless variable in all Generalized Gradient Approximations, quantifying the local inhomogeneity of the electron density. To build intuition for its behavior, this first exercise asks you to derive an expression for $s(\\mathbf{r})$ in one of the simplest, yet most instructive, model systems: a uniform electron gas with a weak sinusoidal perturbation [@problem_id:3454011]. By performing this calculation, you will see directly how $s$ relates to the amplitude and wavelength of a density variation and identify where the gradient effects are most significant.", "problem": "In Kohn–Sham density functional theory, generalized gradient approximation (GGA) functionals for a spin-unpolarized system use the exchange reduced gradient defined by $s(\\mathbf{r}) \\equiv \\dfrac{|\\nabla n(\\mathbf{r})|}{2\\,k_{F}(n(\\mathbf{r}))\\,n(\\mathbf{r})}$, where $k_{F}(n) \\equiv \\left(3\\pi^{2} n\\right)^{1/3}$ is the local Fermi wavevector. Consider a one-dimensional modulation of a uniform electron density given by $n(x) = n_{0}\\left(1+\\delta \\cos(k x)\\right)$ with $\\delta \\ll 1$. Starting from the stated definitions and retaining terms consistently to first order in $\\delta$, derive an explicit expression for $s(x)$ in terms of $n_{0}$, $\\delta$, and $k$. Based on the resulting expression, identify within one spatial period where $s(x)$ is smallest and where it is largest. Express your final answer as a single closed-form analytic expression for $s(x)$; no numerical evaluation is required and no units should be included. The qualitative identification of regions should appear in your derivation, not in the final boxed answer.", "solution": "The problem has been validated and is determined to be a well-posed, scientifically grounded problem within the domain of computational materials science. The derivation proceeds as follows.\n\nThe problem asks for an expression for the exchange reduced gradient, $s(\\mathbf{r})$, for a specific one-dimensional electron density modulation. The given definitions are:\n$1$. The reduced gradient for a spin-unpolarized system:\n$$s(\\mathbf{r}) \\equiv \\dfrac{|\\nabla n(\\mathbf{r})|}{2\\,k_{F}(n(\\mathbf{r}))\\,n(\\mathbf{r})}$$\n$2$. The local Fermi wavevector:\n$$k_{F}(n) \\equiv \\left(3\\pi^{2} n\\right)^{1/3}$$\n$3$. The one-dimensional electron density modulation:\n$$n(x) = n_{0}\\left(1+\\delta \\cos(k x)\\right)$$\nThe condition $\\delta \\ll 1$ implies that we can use linear approximations (Taylor series expansion to first order in $\\delta$).\n\nFirst, we adapt the general $3D$ definition of $s(\\mathbf{r})$ to the given $1D$ case. For a function $n(x)$ that only varies along the $x$-direction, the gradient $\\nabla n(x)$ simplifies to $\\frac{dn(x)}{dx}\\hat{\\mathbf{x}}$. The magnitude of the gradient is therefore $|\\nabla n(x)| = \\left|\\frac{dn(x)}{dx}\\right|$. The expression for $s(x)$ becomes:\n$$s(x) = \\dfrac{\\left|\\frac{dn(x)}{dx}\\right|}{2\\,k_{F}(n(x))\\,n(x)}$$\n\nNext, we calculate the numerator, which is the magnitude of the density gradient. We differentiate $n(x)$ with respect to $x$:\n$$\\frac{dn(x)}{dx} = \\frac{d}{dx} \\left[ n_{0}\\left(1+\\delta \\cos(k x)\\right) \\right] = n_{0} \\left( -\\delta k \\sin(k x) \\right) = -n_{0}\\delta k \\sin(k x)$$\nThe magnitude is:\n$$\\left|\\frac{dn(x)}{dx}\\right| = |-n_{0}\\delta k \\sin(k x)| = n_{0}\\delta k |\\sin(k x)|$$\nHere, we assume $n_{0} > 0$, $\\delta > 0$, and $k > 0$ as they represent a background density, a small positive amplitude, and a wavevector magnitude, respectively.\n\nNow, we analyze the denominator, $2\\,k_{F}(n(x))\\,n(x)$. Substituting the definition of $k_{F}(n)$ into this expression gives:\n$$2\\,k_{F}(n(x))\\,n(x) = 2 \\left(3\\pi^{2} n(x)\\right)^{1/3} n(x) = 2 \\left(3\\pi^{2}\\right)^{1/3} n(x)^{1/3} n(x) = 2 \\left(3\\pi^{2}\\right)^{1/3} n(x)^{4/3}$$\nNext, we substitute the expression for $n(x)$:\n$$n(x)^{4/3} = \\left[n_{0}\\left(1+\\delta \\cos(k x)\\right)\\right]^{4/3} = n_{0}^{4/3} \\left(1+\\delta \\cos(k x)\\right)^{4/3}$$\nSince $\\delta \\ll 1$, we can use the binomial approximation $(1+u)^{p} \\approx 1+pu$ for small $u$. Here, $u = \\delta \\cos(k x)$ and $p = 4/3$.\n$$\\left(1+\\delta \\cos(k x)\\right)^{4/3} \\approx 1 + \\frac{4}{3}\\delta \\cos(k x)$$\nThus, the denominator is approximated as:\n$$2\\,k_{F}(n(x))\\,n(x) \\approx 2 \\left(3\\pi^{2}\\right)^{1/3} n_{0}^{4/3} \\left(1 + \\frac{4}{3}\\delta \\cos(k x)\\right)$$\n\nNow we assemble the full expression for $s(x)$:\n$$s(x) \\approx \\dfrac{n_{0}\\delta k |\\sin(k x)|}{2 \\left(3\\pi^{2}\\right)^{1/3} n_{0}^{4/3} \\left(1 + \\frac{4}{3}\\delta \\cos(k x)\\right)}$$\nWe can simplify the terms involving $n_{0}$:\n$$s(x) \\approx \\dfrac{\\delta k |\\sin(k x)|}{2 \\left(3\\pi^{2}\\right)^{1/3} n_{0}^{1/3}} \\left(1 + \\frac{4}{3}\\delta \\cos(k x)\\right)^{-1}$$\nThe term in the denominator can be rewritten in terms of the Fermi wavevector of the uniform density, $k_{F}(n_{0}) = (3\\pi^2 n_{0})^{1/3}$:\n$$s(x) \\approx \\dfrac{\\delta k |\\sin(k x)|}{2 k_{F}(n_{0})} \\left(1 + \\frac{4}{3}\\delta \\cos(k x)\\right)^{-1}$$\nWe again use the binomial approximation, this time $(1+v)^{-1} \\approx 1-v$ for small $v$, where $v = \\frac{4}{3}\\delta \\cos(k x)$.\n$$s(x) \\approx \\dfrac{\\delta k |\\sin(k x)|}{2 k_{F}(n_{0})} \\left(1 - \\frac{4}{3}\\delta \\cos(k x)\\right)$$\nThe problem requires retaining terms consistently to first order in $\\delta$. We expand the expression:\n$$s(x) \\approx \\dfrac{\\delta k |\\sin(k x)|}{2 k_{F}(n_{0})} - \\dfrac{4}{3} \\dfrac{\\delta^2 k |\\sin(k x)|\\cos(k x)}{2 k_{F}(n_{0})}$$\nThe first term is of order $\\mathcal{O}(\\delta)$, while the second term is of order $\\mathcal{O}(\\delta^2)$. To be consistent to first order in $\\delta$, we must drop the second term. The final expression for $s(x)$ is therefore:\n$$s(x) \\approx \\dfrac{\\delta k |\\sin(k x)|}{2 k_{F}(n_{0})}$$\nSubstituting the explicit form of $k_{F}(n_{0})$ gives the expression in terms of the requested parameters $n_{0}$, $\\delta$, and $k$:\n$$s(x) = \\dfrac{\\delta k |\\sin(k x)|}{2 \\left(3\\pi^{2} n_{0}\\right)^{1/3}}$$\nNote that the approximation becomes an equality in the analytic expression for the first-order term.\n\nFinally, we identify where $s(x)$ is largest and smallest within one spatial period, for example $x \\in [0, 2\\pi/k]$. The value of $s(x)$ is directly proportional to $|\\sin(k x)|$.\n- $s(x)$ is smallest where $|\\sin(k x)|$ is minimal. The minimum value of $|\\sin(k x)|$ is $0$, which occurs when $k x = m\\pi$ for any integer $m$. For the interval $x \\in [0, 2\\pi/k]$, this corresponds to $x=0$, $x=\\pi/k$, and $x=2\\pi/k$. At these points, the density $n(x) = n_{0}(1 \\pm \\delta)$ is at its maximum or minimum value, and the density gradient $\\frac{dn}{dx}$ is zero.\n- $s(x)$ is largest where $|\\sin(k x)|$ is maximal. The maximum value of $|\\sin(k x)|$ is $1$, which occurs when $k x = \\frac{\\pi}{2} + m\\pi$ for any integer $m$. For the interval $x \\in [0, 2\\pi/k]$, this corresponds to $x=\\pi/(2k)$ and $x=3\\pi/(2k)$. At these points, $\\cos(kx)=0$, so the density $n(x)=n_{0}$ is equal to its average value. These are the locations of the steepest density gradient.", "answer": "$$\\boxed{\\frac{\\delta k |\\sin(kx)|}{2 \\left(3\\pi^{2} n_{0}\\right)^{1/3}}}$$", "id": "3454011"}, {"introduction": "While the reduced gradient $s$ describes local density variations, the ultimate goal of a functional is to compute the total energy. This exercise builds upon the previous analysis of a weakly perturbed system to explore how these local gradients contribute to the overall exchange energy correction beyond the Local Density Approximation [@problem_id:3453992]. By calculating the total GGA exchange energy for a model density wave and comparing it to the formal second-order gradient expansion, you will uncover the direct relationship between the functional's form and its leading-order gradient coefficient, a cornerstone of GGA design.", "problem": "Consider a quasi-one-dimensional electron density variation in a three-dimensional system of cross-sectional area $A$ and length $L$ (periodic in $x$) given by\n$$\n\\rho(x)=\\rho_{0}\\left(1+\\eta\\cos(kx)\\right),\n$$\nwith $|\\eta|\\ll 1$. Work within Kohn–Sham density functional theory, using the Generalized Gradient Approximation (GGA) for exchange written in the standard “enhancement-factor” form\n$$\nE_{x}^{\\mathrm{GGA}}=\\int d^{3}r\\, e_{x}^{\\mathrm{LDA}}\\!\\left(\\rho(\\mathbf{r})\\right)\\,F_{x}\\!\\left(s(\\mathbf{r})\\right),\n$$\nwhere the Local Density Approximation (LDA) exchange energy density per volume is\n$$\ne_{x}^{\\mathrm{LDA}}(\\rho)=-C_{x}\\,\\rho^{4/3},\\quad C_{x}=\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3},\n$$\nand the reduced density gradient is\n$$\ns(\\mathbf{r})=\\frac{|\\nabla \\rho(\\mathbf{r})|}{2\\,k_{F}(\\rho)\\,\\rho(\\mathbf{r})},\\quad k_{F}(\\rho)=\\left(3\\pi^{2}\\rho\\right)^{1/3}.\n$$\nAssume the following specific exchange enhancement factor:\n$$\nF_{x}(s)=1+\\kappa\\left[1-\\frac{1}{\\sqrt{1+\\frac{\\mu\\,s^{2}}{\\kappa}}}\\right],\n$$\nwith positive parameters $\\kappa$ and $\\mu$. \n\n(a) Compute $E_{x}^{\\mathrm{GGA}}$ up to and including terms of order $\\mathcal{O}(\\eta^{2})$ for the density $\\rho(x)$ given above. Your derivation must explicitly show how the contributions from the LDA baseline and the gradient correction arise, and you must justify any series expansion you use.\n\n(b) Write the analytic second-order gradient expansion form as\n$$\nE_{x}\\approx \\int d^{3}r\\, e_{x}^{\\mathrm{LDA}}(\\rho)\\left[1+\\mu_{\\mathrm{GE}}\\,s^{2}\\right],\n$$\nwith a constant second-order coefficient $\\mu_{\\mathrm{GE}}$. By comparing your result from part (a) to this analytic gradient expansion, extract the implied second-order gradient coefficient $\\mu_{\\mathrm{eff}}$ associated with the given $F_{x}(s)$. \n\nProvide your final answer for the implied coefficient $\\mu_{\\mathrm{eff}}$ as a closed-form analytic expression in terms of the parameter(s) appearing in $F_{x}(s)$. No numerical evaluation or rounding is required. State no units for the final answer.", "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n### Step 1: Extract Givens\n-   Electron density: $\\rho(x)=\\rho_{0}\\left(1+\\eta\\cos(kx)\\right)$\n-   System geometry: Cross-sectional area $A$, length $L$, periodic in $x$. Total volume $V=AL$.\n-   Condition: $|\\eta|\\ll 1$.\n-   GGA exchange energy functional: $E_{x}^{\\mathrm{GGA}}=\\int d^{3}r\\, e_{x}^{\\mathrm{LDA}}\\!\\left(\\rho(\\mathbf{r})\\right)\\,F_{x}\\!\\left(s(\\mathbf{r})\\right)$.\n-   LDA exchange energy density: $e_{x}^{\\mathrm{LDA}}(\\rho)=-C_{x}\\,\\rho^{4/3}$, with $C_{x}=\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}$.\n-   Reduced density gradient: $s(\\mathbf{r})=\\frac{|\\nabla \\rho(\\mathbf{r})|}{2\\,k_{F}(\\rho)\\,\\rho(\\mathbf{r})}$.\n-   Fermi wavevector: $k_{F}(\\rho)=\\left(3\\pi^{2}\\rho\\right)^{1/3}$.\n-   Exchange enhancement factor: $F_{x}(s)=1+\\kappa\\left[1-\\frac{1}{\\sqrt{1+\\frac{\\mu\\,s^{2}}{\\kappa}}}\\right]$, with $\\kappa > 0$ and $\\mu > 0$.\n-   Task (a): Compute $E_{x}^{\\mathrm{GGA}}$ up to order $\\mathcal{O}(\\eta^{2})$.\n-   Task (b): Compare the result from (a) with the analytic form $E_{x}\\approx \\int d^{3}r\\, e_{x}^{\\mathrm{LDA}}(\\rho)\\left[1+\\mu_{\\mathrm{GE}}\\,s^{2}\\right]$ to find the implied coefficient $\\mu_{\\mathrm{eff}}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is set within the standard framework of Kohn-Sham density functional theory, a cornerstone of modern computational physics and chemistry. The functional forms for the LDA energy density, the reduced gradient $s$, and the GGA enhancement factor are all standard or physically plausible models. The density variation is a simple sinusoidal wave, a common test case for analyzing the behavior of density functionals. The requirement to perform a Taylor expansion in the small parameter $\\eta$ is a standard and well-defined mathematical procedure. The problem is self-contained, with all necessary definitions provided. There are no scientific contradictions, ambiguities, or subjective elements.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n***\n\n### Part (a): Computation of $E_{x}^{\\mathrm{GGA}}$ to $\\mathcal{O}(\\eta^2)$\n\nThe total GGA exchange energy is given by the integral over the system volume $V=AL$. Since the density $\\rho(x)$ depends only on the $x$ coordinate, the integral over the cross-sectional area $A$ can be performed trivially.\n$$\nE_{x}^{\\mathrm{GGA}} = \\int d^3 r \\, e_{x}^{\\mathrm{LDA}}(\\rho(x)) F_x(s(x)) = A \\int_{0}^{L} dx \\, e_{x}^{\\mathrm{LDA}}(\\rho(x)) F_x(s(x))\n$$\nTo evaluate this integral up to order $\\mathcal{O}(\\eta^2)$, we must expand the terms in the integrand, $e_{x}^{\\mathrm{LDA}}(\\rho(x))$ and $F_x(s(x))$, in powers of $\\eta$. The expansion is justified because the problem states $|\\eta| \\ll 1$.\n\nLet's denote $g(x) = \\eta \\cos(kx)$, so $\\rho(x) = \\rho_0(1+g(x))$.\n\nFirst, we expand the LDA energy density, $e_{x}^{\\mathrm{LDA}}(\\rho) = -C_x \\rho^{4/3}$:\n$$\ne_{x}^{\\mathrm{LDA}}(\\rho(x)) = -C_x \\left[\\rho_0(1+g(x))\\right]^{4/3} = -C_x \\rho_0^{4/3} (1+g(x))^{4/3}\n$$\nUsing the binomial expansion $(1+u)^\\alpha \\approx 1 + \\alpha u + \\frac{\\alpha(\\alpha-1)}{2}u^2$ for small $u=g(x)$, with $\\alpha=4/3$:\n$$\ne_{x}^{\\mathrm{LDA}}(\\rho(x)) \\approx e_{x}^{\\mathrm{LDA}}(\\rho_0) \\left[1 + \\frac{4}{3}g(x) + \\frac{1}{2}\\frac{4}{3}\\left(\\frac{4}{3}-1\\right)g(x)^2\\right] = e_{x}^{\\mathrm{LDA}}(\\rho_0) \\left[1 + \\frac{4}{3}\\eta\\cos(kx) + \\frac{2}{9}\\eta^2\\cos^2(kx)\\right]\n$$\nThis expansion is correct up to order $\\mathcal{O}(\\eta^2)$.\n\nNext, we compute the reduced gradient $s(x)$. The gradient of the density is:\n$$\n\\nabla \\rho(x) = \\frac{d\\rho}{dx}\\hat{x} = -\\rho_0 \\eta k \\sin(kx) \\hat{x} \\implies |\\nabla\\rho(x)| = \\rho_0 |\\eta k \\sin(kx)|\n$$\nThe Fermi wavevector is $k_F(\\rho(x)) = (3\\pi^2\\rho(x))^{1/3} = (3\\pi^2\\rho_0)^{1/3}(1+g(x))^{1/3} = k_F(\\rho_0)(1+g(x))^{1/3}$.\nThe expression for $s(x)$ is:\n$$\ns(x) = \\frac{|\\nabla\\rho(x)|}{2 k_F(\\rho(x)) \\rho(x)} = \\frac{\\rho_0 |\\eta k \\sin(kx)|}{2 k_F(\\rho_0)(1+g(x))^{1/3} \\rho_0(1+g(x))} = \\frac{|\\eta k \\sin(kx)|}{2 k_F(\\rho_0)} (1+g(x))^{-4/3}\n$$\nSince $s(x)$ is of order $\\mathcal{O}(\\eta)$, $s^2(x)$ is of order $\\mathcal{O}(\\eta^2)$. For the subsequent expansion of $F_x(s)$, we will need $s^2(x)$ to leading order in $\\eta$:\n$$\ns^2(x) = \\frac{\\eta^2 k^2 \\sin^2(kx)}{4 k_F(\\rho_0)^2} (1+g(x))^{-8/3} \\approx \\frac{\\eta^2 k^2 \\sin^2(kx)}{4 k_F(\\rho_0)^2} + \\mathcal{O}(\\eta^3)\n$$\nNow, we expand the enhancement factor $F_x(s)$. Since $s^2 = \\mathcal{O}(\\eta^2)$ is a small quantity, we can expand $F_x(s)$ for small $s^2$.\n$$\nF_x(s) = 1 + \\kappa \\left[1 - \\left(1 + \\frac{\\mu s^2}{\\kappa}\\right)^{-1/2}\\right]\n$$\nUsing $(1+u)^{-1/2} \\approx 1 - \\frac{1}{2}u$ for small $u = \\mu s^2/\\kappa$:\n$$\nF_x(s) \\approx 1 + \\kappa \\left[1 - \\left(1 - \\frac{1}{2}\\frac{\\mu s^2}{\\kappa}\\right)\\right] = 1 + \\kappa \\left(\\frac{\\mu s^2}{2\\kappa}\\right) = 1 + \\frac{\\mu}{2}s^2\n$$\nSubstituting the expression for $s^2(x)$ to order $\\mathcal{O}(\\eta^2)$:\n$$\nF_x(s(x)) \\approx 1 + \\frac{\\mu}{2} \\left[ \\frac{\\eta^2 k^2 \\sin^2(kx)}{4 k_F(\\rho_0)^2} \\right] = 1 + \\frac{\\mu k^2}{8 k_F(\\rho_0)^2} \\eta^2 \\sin^2(kx)\n$$\nThis is the expansion of $F_x(s)$ up to order $\\mathcal{O}(\\eta^2)$.\n\nNow we combine the expansions of $e_{x}^{\\mathrm{LDA}}(\\rho)$ and $F_x(s)$ to form the integrand, keeping terms up to $\\mathcal{O}(\\eta^2)$:\n\\begin{align*}\n\\text{Integrand} &= e_{x}^{\\mathrm{LDA}}(\\rho(x)) F_x(s(x)) \\\\\n&\\approx e_{x}^{\\mathrm{LDA}}(\\rho_0) \\left[1 + \\frac{4}{3}\\eta\\cos(kx) + \\frac{2}{9}\\eta^2\\cos^2(kx)\\right] \\left[1 + \\frac{\\mu k^2}{8 k_F(\\rho_0)^2} \\eta^2 \\sin^2(kx)\\right] \\\\\n&\\approx e_{x}^{\\mathrm{LDA}}(\\rho_0) \\left[1 + \\frac{4}{3}\\eta\\cos(kx) + \\frac{2}{9}\\eta^2\\cos^2(kx) + \\frac{\\mu k^2}{8 k_F(\\rho_0)^2} \\eta^2 \\sin^2(kx)\\right]\n\\end{align*}\nThe cross-term of order $\\mathcal{O}(\\eta) \\times \\mathcal{O}(\\eta^2)$ has been dropped as it is of order $\\mathcal{O}(\\eta^3)$.\n\nFinally, we integrate over $x$ from $0$ to $L$. The periodicity of $\\rho(x)$ implies $k = 2\\pi n/L$ for some integer $n$. We use the following well-known integrals over one period $L$:\n$$\n\\int_0^L \\cos(kx) dx = 0, \\quad \\int_0^L \\cos^2(kx) dx = \\frac{L}{2}, \\quad \\int_0^L \\sin^2(kx) dx = \\frac{L}{2}\n$$\nIntegrating the expression for the integrand:\n$$\nE_{x}^{\\mathrm{GGA}} \\approx A \\int_0^L e_{x}^{\\mathrm{LDA}}(\\rho_0) \\left[1 + \\frac{4}{3}\\eta\\cos(kx) + \\frac{2}{9}\\eta^2\\cos^2(kx) + \\frac{\\mu k^2}{8 k_F(\\rho_0)^2} \\eta^2 \\sin^2(kx)\\right] dx\n$$\n$$\nE_{x}^{\\mathrm{GGA}} \\approx A e_{x}^{\\mathrm{LDA}}(\\rho_0) \\left[L + 0 + \\frac{2}{9}\\eta^2\\frac{L}{2} + \\frac{\\mu k^2}{8 k_F(\\rho_0)^2} \\eta^2\\frac{L}{2}\\right]\n$$\nUsing $V=AL$, we get the final expression for part (a):\n$$\nE_{x}^{\\mathrm{GGA}} \\approx V e_{x}^{\\mathrm{LDA}}(\\rho_0) \\left[1 + \\frac{1}{9}\\eta^2 + \\frac{\\mu k^2}{16 k_F(\\rho_0)^2}\\eta^2\\right] = V e_{x}^{\\mathrm{LDA}}(\\rho_0) \\left[1 + \\left(\\frac{1}{9} + \\frac{\\mu k^2}{16 k_F(\\rho_0)^2}\\right)\\eta^2\\right]\n$$\n\n### Part (b): Extraction of the Effective Gradient Coefficient $\\mu_{\\mathrm{eff}}$\n\nThe analytic second-order gradient expansion (GE2) is given by:\n$$\nE_x^{\\mathrm{GE2}} = \\int d^3 r \\, e_x^{\\mathrm{LDA}}(\\rho) [1 + \\mu_{\\mathrm{eff}} s^2]\n$$\nwhere $\\mu_{\\mathrm{eff}}$ is the effective coefficient we need to determine. To compare with our result from part (a), we expand this expression to order $\\mathcal{O}(\\eta^2)$ for the given density wave.\n$$\nE_x^{\\mathrm{GE2}} = \\int d^3 r \\, e_x^{\\mathrm{LDA}}(\\rho) + \\int d^3 r \\, \\mu_{\\mathrm{eff}} e_x^{\\mathrm{LDA}}(\\rho) s^2\n$$\nThe first term is the LDA exchange energy, $E_x^{\\mathrm{LDA}}$. We have already expanded this to $\\mathcal{O}(\\eta^2)$ in part (a):\n$$\nE_x^{\\mathrm{LDA}} = \\int d^3 r \\, e_x^{\\mathrm{LDA}}(\\rho(x)) = V e_{x}^{\\mathrm{LDA}}(\\rho_0) \\left[1 + \\frac{1}{9}\\eta^2\\right]\n$$\nThe second term is the gradient correction. Since $s^2 = \\mathcal O(\\eta^2)$, to evaluate this term to $\\mathcal O(\\eta^2)$, we only need the leading order part of $e_x^{\\mathrm{LDA}}(\\rho)$, which is $e_x^{\\mathrm{LDA}}(\\rho_0)$:\n$$\n\\int d^3 r \\, \\mu_{\\mathrm{eff}} e_x^{\\mathrm{LDA}}(\\rho) s^2 \\approx \\int d^3 r \\, \\mu_{\\mathrm{eff}} e_x^{\\mathrm{LDA}}(\\rho_0) s^2(x)\n$$\nUsing $s^2(x) \\approx \\frac{\\eta^2 k^2 \\sin^2(kx)}{4 k_F(\\rho_0)^2}$:\n$$\n\\int d^3 r \\, \\mu_{\\mathrm{eff}} e_x^{\\mathrm{LDA}}(\\rho_0) \\frac{\\eta^2 k^2 \\sin^2(kx)}{4 k_F(\\rho_0)^2} = \\mu_{\\mathrm{eff}} e_x^{\\mathrm{LDA}}(\\rho_0) \\frac{\\eta^2 k^2}{4 k_F(\\rho_0)^2} \\left( A \\int_0^L \\sin^2(kx) dx \\right)\n$$\n$$\n= \\mu_{\\mathrm{eff}} V e_x^{\\mathrm{LDA}}(\\rho_0) \\frac{\\eta^2 k^2}{4 k_F(\\rho_0)^2} \\frac{1}{2} = V e_x^{\\mathrm{LDA}}(\\rho_0) \\frac{\\mu_{\\mathrm{eff}} k^2}{8 k_F(\\rho_0)^2} \\eta^2\n$$\nCombining the two terms, the GE2 energy to order $\\mathcal{O}(\\eta^2)$ is:\n$$\nE_x^{\\mathrm{GE2}} \\approx V e_{x}^{\\mathrm{LDA}}(\\rho_0) \\left[1 + \\frac{1}{9}\\eta^2\\right] + V e_x^{\\mathrm{LDA}}(\\rho_0) \\frac{\\mu_{\\mathrm{eff}} k^2}{8 k_F(\\rho_0)^2} \\eta^2 = V e_{x}^{\\mathrm{LDA}}(\\rho_0) \\left[1 + \\left(\\frac{1}{9} + \\frac{\\mu_{\\mathrm{eff}} k^2}{8 k_F(\\rho_0)^2}\\right)\\eta^2\\right]\n$$\nWe now equate this expression with the result for $E_x^{\\mathrm{GGA}}$ from part (a):\n$$\nV e_{x}^{\\mathrm{LDA}}(\\rho_0) \\left[1 + \\left(\\frac{1}{9} + \\frac{\\mu k^2}{16 k_F(\\rho_0)^2}\\right)\\eta^2\\right] = V e_{x}^{\\mathrm{LDA}}(\\rho_0) \\left[1 + \\left(\\frac{1}{9} + \\frac{\\mu_{\\mathrm{eff}} k^2}{8 k_F(\\rho_0)^2}\\right)\\eta^2\\right]\n$$\nBy comparing the coefficients of the $\\eta^2$ term, we can equate the gradient-dependent parts:\n$$\n\\frac{\\mu k^2}{16 k_F(\\rho_0)^2} = \\frac{\\mu_{\\mathrm{eff}} k^2}{8 k_F(\\rho_0)^2}\n$$\nThe factors of $k^2$ and $k_F(\\rho_0)^2$ cancel, yielding:\n$$\n\\frac{\\mu}{16} = \\frac{\\mu_{\\mathrm{eff}}}{8}\n$$\nSolving for $\\mu_{\\mathrm{eff}}$ gives:\n$$\n\\mu_{\\mathrm{eff}} = \\frac{8\\mu}{16} = \\frac{\\mu}{2}\n$$\nThis result could also have been obtained directly by Taylor-expanding the enhancement factor $F_x(s)$ in powers of $s^2$, $F_x(s) \\approx 1 + \\mu_{\\mathrm{eff}} s^2 + \\mathcal{O}(s^4)$, and identifying the coefficient of $s^2$. The calculation performed using the density wave confirms this result through a concrete physical example. The coefficient $\\mu_{\\mathrm{eff}}$ does not depend on $\\kappa$, as $\\kappa$ appears in the expansion of $F_x(s)$ only at order $s^4$ and higher.\nThe implied second-order gradient coefficient is $\\mu/2$.", "answer": "$$\\boxed{\\frac{\\mu}{2}}$$", "id": "3453992"}, {"introduction": "Theoretical expansions, like the second-order gradient expansion for exchange energy, provide invaluable physical insight but are ultimately approximations. This final practice bridges the gap between analytical theory and computational materials science by tasking you with numerically implementing and validating this very expansion [@problem_id:3453981]. By writing code to compare the perturbative estimate against the full, widely-used PBE functional, you will gain practical skills in scientific computing and develop a quantitative understanding of the accuracy and limits of the gradient expansion approximation in realistic scenarios.", "problem": "You are to derive and implement a second-order perturbation theory in the reduced gradient $s$ for estimating the exchange contribution to the Generalized Gradient Approximation (GGA) correction relative to the Local Density Approximation (LDA) in Density Functional Theory (DFT). The derivation must start from well-established facts of the Uniform Electron Gas (UEG) and Kohn-Sham DFT, and the implementation must validate the perturbative estimate against a full GGA exchange calculation using a widely used enhancement factor.\n\nFundamental base and core definitions to use:\n- In Kohn-Sham Density Functional Theory (DFT), the exchange energy in the Local Density Approximation (LDA) is $E_{x}^{\\mathrm{LDA}} = \\int e_{x}^{\\mathrm{LDA}}(\\rho(\\mathbf r)) \\, d\\mathbf r$, where the LDA exchange energy density per unit volume is $e_{x}^{\\mathrm{LDA}}(\\rho) = -A_x \\rho^{4/3}$ with $A_x = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}$.\n- The reduced gradient is $s(\\mathbf r) = \\frac{|\\nabla \\rho(\\mathbf r)|}{2 k_F(\\mathbf r) \\rho(\\mathbf r)}$, where $k_F(\\mathbf r) = \\left(3\\pi^2 \\rho(\\mathbf r)\\right)^{1/3}$ is the local Fermi wavevector.\n- For weakly inhomogeneous densities, the second-order gradient expansion for the exchange energy density yields $e_x^{\\mathrm{GE2}}(\\rho, s) \\approx e_x^{\\mathrm{LDA}}(\\rho)\\left(1 + \\mu_{\\mathrm{GE}} s^2\\right)$, with the gradient expansion coefficient $\\mu_{\\mathrm{GE}} = \\frac{10}{81}$. This leads to the perturbative correction $\\Delta E_x^{\\mathrm{GE2}} \\approx \\int C s^2 \\rho^{4/3} \\, d\\mathbf r$, where $C = -A_x \\mu_{\\mathrm{GE}}$.\n- A well-tested full GGA exchange correction can be obtained by applying the Perdew-Burke-Ernzerhof (PBE) enhancement factor for exchange, defined as $F_x^{\\mathrm{PBE}}(s) = 1 + \\kappa - \\frac{\\kappa}{1 + \\mu_{\\mathrm{PBE}} s^2 / \\kappa}$ with parameters $\\mu_{\\mathrm{PBE}} = 0.21951$ and $\\kappa = 0.804$. The full GGA exchange correction is then $\\Delta e_x^{\\mathrm{PBE}}(\\rho, s) = e_x^{\\mathrm{LDA}}(\\rho)\\left(F_x^{\\mathrm{PBE}}(s) - 1\\right)$ and $\\Delta E_x^{\\mathrm{PBE}} = \\int \\Delta e_x^{\\mathrm{PBE}}(\\rho, s) \\, d\\mathbf r$.\n\nYour task:\n1. Construct a perturbation theory up to second order in $s$ leading to the estimate $\\Delta E_x^{\\mathrm{GE2}} \\approx \\int C s^2 \\rho^{4/3} \\, d\\mathbf r$ for weakly inhomogeneous crystals, starting from the definitions above.\n2. Implement a numerical validation against the full PBE exchange calculation in a periodic cubic cell using a Fourier-mode electron density with small amplitude modulations.\n3. Use a discrete uniform grid with periodic boundary conditions to approximate spatial integrals and gradients by central differences with periodic wrapping.\n4. For the electron density, use the physically plausible periodic model\n$$\n\\rho(\\mathbf r) = \\rho_0 \\left[1 + \\alpha \\cos(k_x x)\\cos(k_y y)\\cos(k_z z)\\right],\n$$\nwith $k_i = \\frac{2\\pi n_i}{L}$ and $\\rho_0 = \\frac{3}{4\\pi r_s^3}$ in atomic units (Bohr for length, Hartree for energy). The Wigner-Seitz radius $r_s$ parameterizes the average electron density.\n5. Compute the following quantities for each test case:\n- The perturbative estimate $\\Delta E_x^{\\mathrm{GE2}}$ in Hartree.\n- The full PBE exchange correction $\\Delta E_x^{\\mathrm{PBE}}$ in Hartree.\n- The relative error defined as $\\frac{|\\Delta E_x^{\\mathrm{GE2}} - \\Delta E_x^{\\mathrm{PBE}}|}{|\\Delta E_x^{\\mathrm{PBE}}|}$, expressed as a decimal.\n\nScientific realism and units:\n- Use atomic units: energies in Hartree and lengths in Bohr.\n- Express energies in Hartree rounded to six decimal places, and relative errors rounded to six decimal places.\n\nTest suite:\nImplement the program to compute the quantities above for the following parameter sets, which collectively cover a happy path, a near-uniform boundary, and a significant edge case:\n- Case $1$ (happy path): $L = 20$, $N = 64$, $r_s = 2.0$, $\\alpha = 0.05$, $(n_x,n_y,n_z) = (1,1,1)$.\n- Case $2$ (near-uniform boundary): $L = 20$, $N = 64$, $r_s = 2.0$, $\\alpha = 10^{-4}$, $(n_x,n_y,n_z) = (1,1,1)$.\n- Case $3$ (edge case, shorter wavelength and larger modulation): $L = 10$, $N = 64$, $r_s = 2.0$, $\\alpha = 0.30$, $(n_x,n_y,n_z) = (4,4,4)$.\n\nNumerical method requirements:\n- Use a $N \\times N \\times N$ grid on a cubic domain of side length $L$ with spacing $\\Delta x = \\Delta y = \\Delta z = \\frac{L}{N}$.\n- Approximate $\\nabla \\rho$ with periodic central differences,\n$\n\\partial_x \\rho \\approx \\frac{\\rho(x+\\Delta x, y, z) - \\rho(x-\\Delta x, y, z)}{2\\Delta x}\n$\nand similarly for $\\partial_y \\rho$ and $\\partial_z \\rho$, using periodic wrapping at boundaries.\n\nFinal output format:\nYour program should produce a single line of output containing a comma-separated list enclosed in square brackets, with entries ordered for cases $1$, $2$, and $3$ as\n$\n[\\Delta E_x^{\\mathrm{GE2}}(1), \\Delta E_x^{\\mathrm{PBE}}(1), \\mathrm{relerr}(1), \\Delta E_x^{\\mathrm{GE2}}(2), \\Delta E_x^{\\mathrm{PBE}}(2), \\mathrm{relerr}(2), \\Delta E_x^{\\mathrm{GE2}}(3), \\Delta E_x^{\\mathrm{PBE}}(3), \\mathrm{relerr}(3)]\n$\nwhere each energy is in Hartree rounded to six decimal places and each relative error is a decimal rounded to six decimal places.", "solution": "The problem is valid as it is scientifically grounded in Density Functional Theory (DFT), well-posed with a complete set of definitions and parameters, and objective. It presents a standard, verifiable problem in computational materials science without any logical or factual inconsistencies.\n\nThe primary objective is to derive the second-order gradient expansion (GE2) for the exchange energy correction and to numerically validate its accuracy against a full Generalized Gradient Approximation (GGA) calculation using the Perdew-Burke-Ernzerhof (PBE) functional.\n\n**1. Theoretical Derivation**\n\nIn Kohn-Sham DFT, the exchange energy for a general GGA functional is expressed as an integral over all space $\\mathbf{r}$:\n$$\nE_x^{\\mathrm{GGA}}[\\rho] = \\int e_x^{\\mathrm{LDA}}(\\rho(\\mathbf{r})) F_x(s(\\mathbf{r})) \\, d\\mathbf{r}\n$$\nwhere $e_x^{\\mathrm{LDA}}(\\rho) = -A_x \\rho^{4/3}$ is the exchange energy density of the Local Density Approximation (LDA), with $A_x = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}$. $F_x(s)$ is the dimensionless enhancement factor, which depends on the reduced density gradient $s(\\mathbf{r})$. The reduced gradient is a measure of the local inhomogeneity of the electron density $\\rho(\\mathbf{r})$:\n$$\ns(\\mathbf{r}) = \\frac{|\\nabla \\rho(\\mathbf{r})|}{2 k_F(\\mathbf{r}) \\rho(\\mathbf{r})}\n$$\nwhere $k_F(\\mathbf{r}) = (3\\pi^2 \\rho(\\mathbf{r}))^{1/3}$ is the local Fermi wavevector.\n\nThe correction to the exchange energy provided by a GGA functional relative to the LDA is:\n$$\n\\Delta E_x^{\\mathrm{GGA}} = E_x^{\\mathrm{GGA}} - E_x^{\\mathrm{LDA}} = \\int e_x^{\\mathrm{LDA}}(\\rho) [F_x(s) - 1] \\, d\\mathbf{r}\n$$\nFor a system with a weakly inhomogeneous electron density, such as a simple metal, the reduced gradient $s$ is small ($s \\ll 1$) everywhere. This physical condition justifies a Taylor series expansion of the enhancement factor $F_x(s)$ around $s=0$:\n$$\nF_x(s) = F_x(0) + \\left.\\frac{dF_x}{ds}\\right|_{s=0} s + \\frac{1}{2} \\left.\\frac{d^2F_x}{ds^2}\\right|_{s=0} s^2 + O(s^3)\n$$\nSeveral exact constraints must be satisfied by any reasonable GGA functional. First, in the limit of a uniform electron gas, $\\nabla\\rho=0$, which implies $s=0$. In this limit, the GGA energy must recover the LDA energy exactly. This imposes the condition $F_x(0) = 1$. Second, due to spatial inversion symmetry $(\\mathbf{r} \\to -\\mathbf{r})$, the gradient transforms as $\\nabla\\rho \\to -\\nabla\\rho$, but its magnitude $|\\nabla\\rho|$ and thus $s$ remain unchanged. More formally, the energy, being a scalar, must be invariant under inversion, which requires it to be an even function of the gradient. Consequently, terms linear in $s$ (and all odd powers of $s$) must vanish from the expansion. This imposes the condition $\\left.\\frac{dF_x}{ds}\\right|_{s=0} = 0$.\n\nApplying these constraints, the Taylor expansion simplifies to:\n$$\nF_x(s) \\approx 1 + \\mu s^2\n$$\nwhere the coefficient $\\mu = \\frac{1}{2} F_x''(0)$ defines the curvature of the enhancement factor at $s=0$. This approximation, truncated at the second order in $s$, is known as the second-order gradient expansion (GE2). For exchange, this coefficient can be derived from first principles and has the value $\\mu_{\\mathrm{GE}} = \\frac{10}{81}$.\n\nThe GE2 exchange energy density is thus given by $e_x^{\\mathrm{GE2}}(\\rho, s) \\approx e_x^{\\mathrm{LDA}}(\\rho)(1 + \\mu_{\\mathrm{GE}} s^2)$. The resulting energy correction relative to LDA is:\n$$\n\\Delta E_x^{\\mathrm{GE2}} = \\int e_x^{\\mathrm{LDA}}(\\rho) \\mu_{\\mathrm{GE}} s^2 \\, d\\mathbf{r}\n$$\nSubstituting the expressions for $e_x^{\\mathrm{LDA}}(\\rho)$ and defining the constant $C = -A_x \\mu_{\\mathrm{GE}}$, we arrive at the perturbative estimate as specified in the problem:\n$$\n\\Delta E_x^{\\mathrm{GE2}} \\approx \\int C s^2 \\rho^{4/3} \\, d\\mathbf{r}\n$$\nThis derivation establishes the GE2 correction as the leading-order contribution beyond LDA for weakly varying densities.\n\nFor comparison, the PBE enhancement factor is $F_x^{\\mathrm{PBE}}(s) = 1 + \\kappa - \\frac{\\kappa}{1 + \\mu_{\\mathrm{PBE}} s^2 / \\kappa}$. Performing a Taylor expansion for small $s$ yields $F_x^{\\mathrm{PBE}}(s) \\approx 1 + \\mu_{\\mathrm{PBE}} s^2$. The PBE functional is thus designed to recover the quadratic behavior of GE2 for small $s$, but it uses a different coefficient, $\\mu_{\\mathrm{PBE}} = 0.21951$, which differs from the exact GE2 coefficient $\\mu_{\\mathrm{GE}} \\approx 0.12345$. This re-parameterization allows PBE to satisfy other physical constraints, such as the Lieb-Oxford bound. The full PBE correction is calculated without Taylor expansion:\n$$\n\\Delta E_x^{\\mathrm{PBE}} = \\int e_x^{\\mathrm{LDA}}(\\rho) [F_x^{\\mathrm{PBE}}(s) - 1] \\, d\\mathbf{r}\n$$\n\n**2. Numerical Implementation**\n\nThe validation is conducted numerically by computing both $\\Delta E_x^{\\mathrm{GE2}}$ and $\\Delta E_x^{\\mathrm{PBE}}$ for a model electron density and comparing them.\nThe spatial domain is a cubic cell of side length $L$, discretized into a uniform $N \\times N \\times N$ grid. The grid spacing is $\\Delta x = L/N$, and the volume element for integration is $dV = (\\Delta x)^3$. An integral $\\int f(\\mathbf{r}) d\\mathbf{r}$ is approximated by the sum $\\sum_{i,j,k} f(x_i, y_j, z_k) dV$ over all grid points.\n\nThe model electron density is given by $\\rho(\\mathbf{r}) = \\rho_0 [1 + \\alpha \\cos(k_x x)\\cos(k_y y)\\cos(k_z z)]$, where $\\rho_0$ is the average density. This function is evaluated at each grid point to obtain a discrete representation $\\rho_{ijk}$.\n\nThe gradient $\\nabla \\rho$ at each grid point is computed using a second-order periodic central difference scheme. For the $x$-component at grid index $(i,j,k)$:\n$$\n(\\partial_x \\rho)_{ijk} \\approx \\frac{\\rho_{i+1, j, k} - \\rho_{i-1, j, k}}{2 \\Delta x}\n$$\nwhere indices are wrapped periodically (e.g., $i+1=N$ becomes $0$, and $i-1=-1$ becomes $N-1$). Analogous expressions apply for $\\partial_y \\rho$ and $\\partial_z \\rho$. From these components, the squared magnitude of the gradient, $|\\nabla \\rho_{ijk}|^2 = (\\partial_x \\rho)_{ijk}^2 + (\\partial_y \\rho)_{ijk}^2 + (\\partial_z \\rho)_{ijk}^2$, is calculated.\n\nWith discrete values for $\\rho_{ijk}$ and $|\\nabla \\rho_{ijk}|^2$, the squared reduced gradient $s_{ijk}^2$ is computed at each grid point:\n$$\ns_{ijk}^2 = \\frac{|\\nabla \\rho_{ijk}|^2}{4 (k_{F,ijk})^2 \\rho_{ijk}^2} = \\frac{|\\nabla \\rho_{ijk}|^2}{4 (3\\pi^2 \\rho_{ijk})^{2/3} \\rho_{ijk}^2} = \\frac{|\\nabla \\rho_{ijk}|^2}{4(3\\pi^2)^{2/3} \\rho_{ijk}^{8/3}}\n$$\nFinally, the integrands for the GE2 and PBE corrections, $\\Delta e_{x, ijk}^{\\mathrm{GE2}} = C s_{ijk}^2 \\rho_{ijk}^{4/3}$ and $\\Delta e_{x, ijk}^{\\mathrm{PBE}} = e_x^{\\mathrm{LDA}}(\\rho_{ijk}) [F_x^{\\mathrm{PBE}}(s_{ijk}) - 1]$, are evaluated at each grid point. The total energy corrections, $\\Delta E_x^{\\mathrm{GE2}}$ and $\\Delta E_x^{\\mathrm{PBE}}$, are obtained by summing these local energy densities over the grid and multiplying by the volume element $dV$. The relative error is then calculated from these integrated energies.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main driver function to solve the problem for all test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (happy path)\n        {'L': 20.0, 'N': 64, 'r_s': 2.0, 'alpha': 0.05, 'n_vec': (1, 1, 1)},\n        # Case 2 (near-uniform boundary)\n        {'L': 20.0, 'N': 64, 'r_s': 2.0, 'alpha': 1e-4, 'n_vec': (1, 1, 1)},\n        # Case 3 (edge case)\n        {'L': 10.0, 'N': 64, 'r_s': 2.0, 'alpha': 0.30, 'n_vec': (4, 4, 4)},\n    ]\n\n    results = []\n    for case in test_cases:\n        delta_E_ge2, delta_E_pbe, rel_err = calculate_corrections(**case)\n        results.extend([delta_E_ge2, delta_E_pbe, rel_err])\n\n    # Format the final output string as required.\n    formatted_results = [f\"{val:.6f}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n\ndef calculate_corrections(L, N, r_s, alpha, n_vec):\n    \"\"\"\n    Calculates the GE2 and PBE exchange corrections for a single parameter set.\n    \"\"\"\n    # Define constants in atomic units.\n    A_x = (3.0 / 4.0) * (3.0 / np.pi)**(1.0/3.0)\n    MU_GE = 10.0 / 81.0\n    C_GE2 = -A_x * MU_GE\n    \n    # PBE parameters\n    KAPPA_PBE = 0.804\n    MU_PBE = 0.21951\n\n    # Grid setup\n    dx = L / N\n    dV = dx**3\n    grid_1d = np.linspace(0, L, N, endpoint=False)\n    x, y, z = np.meshgrid(grid_1d, grid_1d, grid_1d, indexing='ij')\n\n    # Electron density model\n    rho_0 = 3.0 / (4.0 * np.pi * r_s**3)\n    k_x = 2.0 * np.pi * n_vec[0] / L\n    k_y = 2.0 * np.pi * n_vec[1] / L\n    k_z = 2.0 * np.pi * n_vec[2] / L\n    \n    rho = rho_0 * (1.0 + alpha * np.cos(k_x * x) * np.cos(k_y * y) * np.cos(k_z * z))\n    \n    # Check for non-positive density, though problem constraints prevent this.\n    if np.any(rho <= 0):\n        raise ValueError(\"Electron density must be positive everywhere.\")\n\n    # Gradient calculation using periodic central differences\n    grad_rho_x = (np.roll(rho, -1, axis=0) - np.roll(rho, 1, axis=0)) / (2.0 * dx)\n    grad_rho_y = (np.roll(rho, -1, axis=1) - np.roll(rho, 1, axis=1)) / (2.0 * dx)\n    grad_rho_z = (np.roll(rho, -1, axis=2) - np.roll(rho, 1, axis=2)) / (2.0 * dx)\n    \n    grad_rho_mag_sq = grad_rho_x**2 + grad_rho_y**2 + grad_rho_z**2\n    \n    # Reduced gradient s^2 calculation\n    # s^2 = |nabla rho|^2 / (4 * (3*pi^2*rho)^(2/3) * rho^2)\n    # Denominator = 4 * (3*pi^2)^(2/3) * rho^(8/3)\n    c_kf_sq = 4.0 * (3 * np.pi**2)**(2.0/3.0)\n    rho_8_3 = rho**(8.0/3.0)\n    \n    # Avoid division by zero, although not expected for given parameters.\n    s_squared = np.zeros_like(rho)\n    nonzero_mask = rho_8_3 > 0\n    s_squared[nonzero_mask] = grad_rho_mag_sq[nonzero_mask] / (c_kf_sq * rho_8_3[nonzero_mask])\n\n    # LDA exchange energy density\n    rho_4_3 = rho**(4.0/3.0)\n    e_x_lda = -A_x * rho_4_3\n    \n    # GE2 correction calculation\n    integrand_ge2 = C_GE2 * s_squared * rho_4_3\n    delta_E_ge2 = np.sum(integrand_ge2) * dV\n\n    # PBE correction calculation\n    pbe_enhancement_minus_1 = KAPPA_PBE - KAPPA_PBE / (1.0 + MU_PBE * s_squared / KAPPA_PBE)\n    integrand_pbe = e_x_lda * pbe_enhancement_minus_1\n    delta_E_pbe = np.sum(integrand_pbe) * dV\n\n    # Relative error calculation\n    if np.abs(delta_E_pbe) > 1e-15:\n        rel_err = np.abs(delta_E_ge2 - delta_E_pbe) / np.abs(delta_E_pbe)\n    else:\n        # Handle the case where the PBE correction is effectively zero.\n        # If GE2 is also zero, error is 0. Otherwise, infinite.\n        rel_err = 0.0 if np.abs(delta_E_ge2) < 1e-15 else np.inf\n\n    return delta_E_ge2, delta_E_pbe, rel_err\n\nsolve()\n```", "id": "3453981"}]}