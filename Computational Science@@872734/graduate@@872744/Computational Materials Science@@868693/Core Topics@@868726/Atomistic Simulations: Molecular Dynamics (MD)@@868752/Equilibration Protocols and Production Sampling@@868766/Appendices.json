{"hands_on_practices": [{"introduction": "A robust molecular simulation begins with a correctly configured simulation cell. To mimic a bulk system, we use periodic boundary conditions (PBC), but this introduces the risk of a particle interacting with its own periodic image. This exercise [@problem_id:3449022] explores the geometric foundations of the minimum image convention, guiding you to derive the fundamental relationship between the box size $L$ and the potential cutoff radius $r_c$ that prevents such unphysical artifacts.", "problem": "A three-dimensional molecular dynamics (MD) simulation of a simple fluid employs periodic boundary conditions (PBC) in a cubic box of edge length $L$. Interatomic forces are pairwise additive, isotropic, and truncated by a sharp real-space cutoff $r_c$, so that the pair potential $u(r)$ satisfies $u(r)=0$ for $r \\ge r_c$. The simulation uses the minimum image convention: for any pair of particles at positions $\\mathbf{r}_{i}$ and $\\mathbf{r}_{j}$, the displacement used to compute their interaction is the lattice-reduced vector $\\Delta \\mathbf{r}_{ij}=\\mathbf{r}_{i}-\\mathbf{r}_{j}-L\\mathbf{n}$, where $\\mathbf{n}\\in\\mathbb{Z}^{3}$ is chosen so that each Cartesian component of $\\Delta \\mathbf{r}_{ij}$ lies in the interval $\\left(-\\frac{L}{2},\\frac{L}{2}\\right]$. The simulation excludes self-pairs by construction (no $i=j$ terms), but to ensure physically meaningful production sampling it is required that no particle interacts with more than one periodic image of any other particle and, in particular, that the interaction sphere of radius $r_c$ around any particle does not include any of that particle’s own periodic images.\n\nStarting only from the definitions of PBC, the minimum image convention, and the geometry of a cubic Bravais lattice, derive the sharp threshold on $L$ as a function of $r_c$ that guarantees the above uniqueness and absence of self-interactions for an isotropic system. Compute the minimal $L$ expressed analytically in terms of $r_c$ that satisfies this requirement. Provide your final answer as a single exact expression for the minimal $L$ in terms of $r_c$. Do not use any numerical approximations or rounding.", "solution": "The problem is valid. It is scientifically grounded, well-posed, and objective, presenting a standard and fundamental geometric constraint problem in the field of computational materials science, specifically concerning the setup of molecular dynamics simulations. It is free of any of the invalidating flaws listed in the instructions. We can therefore proceed with the derivation.\n\nThe problem requires the derivation of a sharp threshold on the simulation box edge length $L$ as a function of the interaction cutoff radius $r_c$ to satisfy two conditions for a simulation in a cubic box with periodic boundary conditions (PBC) and the minimum image convention (MIC). Let's analyze these two conditions.\n\nLet the simulation box be a cube with vertices at $(\\pm \\frac{L}{2}, \\pm \\frac{L}{2}, \\pm \\frac{L}{2})$. Under PBC, the simulation space is a $3$-torus. A particle at a position $\\mathbf{r}$ has periodic images at all locations $\\mathbf{r} + L\\mathbf{n}$, where $\\mathbf{n}$ is a vector with integer components, $\\mathbf{n} \\in \\mathbb{Z}^3$. The interaction between any two particles $i$ and $j$ is non-zero only if their separation distance $r$ is less than $r_c$. The MIC dictates that this distance is computed between particle $i$ and the single, unique closest periodic image of particle $j$.\n\nThe two conditions to be satisfied are:\n1.  No particle interacts with more than one periodic image of any other particle.\n2.  The interaction sphere of radius $r_c$ around any particle does not include any of that particle’s own periodic images.\n\nLet us analyze each condition to find the constraint it imposes on $L$ and $r_c$.\n\n**Analysis of Condition 1: Uniqueness of Interaction Partner**\n\nThe MIC is a computational shortcut to approximate the Ewald summation for short-range forces. For this approximation to be physically consistent in a system with a simple spherical cutoff, a particle's interaction sphere must not contain more than one periodic image of any other particle. If it did, the MIC would arbitrarily select the closer image and ignore the energetic contribution from the other, leading to an incorrect force calculation.\n\nLet us consider a particle $i$ at position $\\mathbf{r}_i$ and another particle $j$ at position $\\mathbf{r}_j$. The set of all periodic images of particle $j$ is located at positions $\\{ \\mathbf{r}_j + L\\mathbf{n} \\mid \\mathbf{n} \\in \\mathbb{Z}^3 \\}$.\nLet's consider two distinct images of particle $j$, corresponding to two different integer vectors $\\mathbf{n}_1$ and $\\mathbf{n}_2$, where $\\mathbf{n}_1 \\neq \\mathbf{n}_2$. The positions of these two images are $\\mathbf{p}_1 = \\mathbf{r}_j + L\\mathbf{n}_1$ and $\\mathbf{p}_2 = \\mathbf{r}_j + L\\mathbf{n}_2$.\n\nThe vector separating these two images is $\\mathbf{p}_1 - \\mathbf{p}_2 = L(\\mathbf{n}_1 - \\mathbf{n}_2)$. Let $\\mathbf{m} = \\mathbf{n}_1 - \\mathbf{n}_2$. Since $\\mathbf{n}_1$ and $\\mathbf{n}_2$ are distinct integer vectors, $\\mathbf{m}$ is a non-zero integer vector, i.e., $\\mathbf{m} \\in \\mathbb{Z}^3 \\setminus \\{\\mathbf{0}\\}$.\n\nThe distance between these two images is $\\|\\mathbf{p}_1 - \\mathbf{p}_2\\| = \\|L\\mathbf{m}\\| = L\\|\\mathbf{m}\\|$. To find the minimum distance between any two distinct images of a particle, we need to find the minimum magnitude of a non-zero integer vector $\\mathbf{m}=(m_x, m_y, m_z)$. The squared magnitude is $\\|\\mathbf{m}\\|^2 = m_x^2 + m_y^2 + m_z^2$. Since $m_x, m_y, m_z$ are integers and not all zero, the minimum possible value for this sum is $1$ (e.g., for $\\mathbf{m}=(1,0,0)$).\nThus, the minimum magnitude is $\\|\\mathbf{m}\\|_{min} = 1$.\n\nThe minimum distance between any two distinct periodic images of particle $j$ is therefore $L \\times \\|\\mathbf{m}\\|_{min} = L$.\n\nFor particle $i$ to potentially interact with both of these images, $\\mathbf{p}_1$ and $\\mathbf{p}_2$, they must both lie within its interaction sphere of radius $r_c$. A sphere of radius $r_c$ can only contain two points if the distance between them is less than or equal to its diameter, $2r_c$.\nTo guarantee that no more than one image of particle $j$ can ever be inside the interaction sphere of particle $i$, we must ensure that the minimum distance between any two images of $j$ is greater than the diameter of the interaction sphere. A sharp threshold is achieved when the distances are equal.\nSo, we must impose the condition:\n$$L \\ge 2r_c$$\n\n**Analysis of Condition 2: Absence of Self-Interaction**\n\nThis condition states that a particle cannot interact with any of its own periodic images.\nLet a particle $i$ be at position $\\mathbf{r}_i$. Its own periodic images are located at positions $\\mathbf{r}_i + L\\mathbf{n}$ for all non-zero integer vectors $\\mathbf{n} \\in \\mathbb{Z}^3 \\setminus \\{\\mathbf{0}\\}$.\nThe distance between particle $i$ and one of its own images is $\\|\\mathbf{r}_i - (\\mathbf{r}_i + L\\mathbf{n})\\| = \\|-L\\mathbf{n}\\| = L\\|\\mathbf{n}\\|$.\n\nThe closest periodic image of particle $i$ is the one for which $\\|\\mathbf{n}\\|$ is minimal, subject to $\\mathbf{n} \\neq \\mathbf{0}$. As established before, the minimum magnitude is $\\|\\mathbf{n}\\|_{min} = 1$.\nTherefore, the distance from a particle to its nearest own image is exactly $L$.\n\nThe interaction sphere around particle $i$ has a radius of $r_c$. For this sphere to not contain any of the particle's own images, its radius must be less than or equal to the distance to the nearest image.\nThis gives the condition:\n$$r_c \\le L$$\nor equivalently,\n$$L \\ge r_c$$\n\n**Consolidation of Conditions**\n\nWe have derived two necessary conditions:\n1. From the uniqueness of interaction partners: $L \\ge 2r_c$\n2. From the absence of self-image interaction: $L \\ge r_c$\n\nFor any physically meaningful interaction, the cutoff radius $r_c$ must be positive. Therefore, the first condition, $L \\ge 2r_c$, is strictly more restrictive than the second, $L \\ge r_c$. If the first condition is satisfied, the second is automatically satisfied. Thus, the governing constraint that ensures both conditions are met is $L \\ge 2r_c$.\n\nThe problem asks for the minimal $L$ that satisfies this requirement. The minimal value of $L$ is obtained at the equality, which represents the sharp threshold.\n$$L_{min} = 2r_c$$\nThis is the well-known half-box criterion for cubic systems, ensuring the integrity of the minimum image convention with a spherical cutoff.", "answer": "$$ \\boxed{2r_c} $$", "id": "3449022"}, {"introduction": "Once a simulation is set up, we must ensure the system reaches thermodynamic equilibrium before collecting data for production analysis. A powerful method to verify this is to check for energy conservation in a short run under the microcanonical (NVE) ensemble. This practice [@problem_id:3449055] delves into a crucial diagnostic technique: analyzing the systematic drift in total energy to distinguish between residual physical relaxation (indicating incomplete equilibration) and numerical error from the integrator, a key skill for validating simulation protocols.", "problem": "Consider a large crystalline solid modeled with classical Molecular Dynamics (MD) under the microcanonical ensemble, also called the constant number of particles, constant volume, and constant energy (NVE) ensemble. The Hamiltonian is $H(q,p) = T(p) + U(q)$, where $q$ and $p$ are the positions and momenta, $T(p) = \\sum_{i} \\frac{p_{i}^{2}}{2 m_{i}}$ is the kinetic energy, and $U(q)$ is the potential energy. The numerical integration uses the velocity Verlet algorithm with timestep $\\Delta t$. Prior to production sampling, the system was equilibrated under a thermostat, which was then removed to perform NVE runs. To assess whether the prior equilibration was adequate and to choose a timestep that yields acceptable energy conservation in NVE production, you perform two short pilot NVE runs at different $\\Delta t$ values and measure the instantaneous total energy $E(t)$ versus time $t$. In each pilot run, a linear fit to $E(t)$ yields an energy drift rate $s = dE/dt$, assumed to be constant over the short window. The measurements are:\n- $\\Delta t_{1} = 1.0$ femtoseconds and $s_{1} = 0.005$ kilojoules per mole per picosecond,\n- $\\Delta t_{2} = 2.0$ femtoseconds and $s_{2} = 0.020$ kilojoules per mole per picosecond.\n\nStarting from Hamilton’s equations for $H(q,p)$ and the definition of the velocity Verlet updates, derive the leading-order scaling of the energy drift rate $s$ with respect to the timestep $\\Delta t$ for time-reversible symplectic integrators, and explain how this scaling can be used to diagnose whether energy drift arises from numerical integration error or from residual physical relaxation due to inadequate prior equilibration. Then, assuming the measurements are consistent with the derived leading-order scaling, determine the proportionality coefficient relating $s$ and $\\Delta t$. Finally, the production criterion is that the relative energy drift over a production trajectory of duration $T_{\\mathrm{prod}} = 1.0$ nanoseconds must be less than $r_{\\mathrm{thr}} = 1.0 \\times 10^{-3}$. The system’s initial total energy magnitude at the start of the production run is $E_{0} = 5.0 \\times 10^{3}$ kilojoules per mole. Using the derived relation, compute the maximum allowable timestep $\\Delta t_{\\max}$ that satisfies the production criterion. Express the final $\\Delta t_{\\max}$ in femtoseconds and round your numerical answer to three significant figures.", "solution": "The problem statement is evaluated to be valid. It is scientifically grounded in the principles of computational materials science, specifically classical Molecular Dynamics (MD) simulations. It is well-posed, objective, and internally consistent, providing all necessary data to proceed with a unique and meaningful solution. The values given for physical quantities and simulation parameters are realistic.\n\nThe problem requires a four-part analysis: (1) derive the scaling of energy drift with the integration timestep, (2) explain how this scaling differentiates numerical error from physical relaxation, (3) determine the proportionality constant from the provided data, and (4) calculate the maximum allowable timestep for a production run based on a given stability criterion.\n\nFirst, we analyze the origin of energy drift in an NVE simulation. In a perfect analytical world, Hamilton's equations of motion conserve the total energy $H(q,p)$ exactly. The time derivative of the Hamiltonian is:\n$$\n\\frac{dH}{dt} = \\sum_i \\left( \\frac{\\partial H}{\\partial q_i} \\dot{q}_i + \\frac{\\partial H}{\\partial p_i} \\dot{p}_i \\right)\n$$\nUsing Hamilton's equations, $\\dot{q}_i = \\frac{\\partial H}{\\partial p_i}$ and $\\dot{p}_i = -\\frac{\\partial H}{\\partial q_i}$, this becomes:\n$$\n\\frac{dH}{dt} = \\sum_i \\left( (-\\dot{p}_i) \\dot{q}_i + (\\dot{q}_i) \\dot{p}_i \\right) = 0\n$$\nNumerical integrators like the velocity Verlet algorithm introduce discretization errors. A key feature of symplectic integrators, such as velocity Verlet, is that they do not exactly conserve the true Hamiltonian $H$. Instead, they exactly conserve a modified or \"shadow\" Hamiltonian, $\\tilde{H}$, which is close to $H$. For a symmetric, second-order integrator, the shadow Hamiltonian can be expressed as an even power series in the timestep $\\Delta t$:\n$$\n\\tilde{H}(q,p) = H(q,p) + H_2(q,p)(\\Delta t)^2 + H_4(q,p)(\\Delta t)^4 + \\mathcal{O}((\\Delta t)^6)\n$$\nThe energy of the system, $E(t)=H(q(t),p(t))$, computed along the trajectory generated by the integrator, therefore fluctuates. The difference between the conserved value $\\tilde{H}$ and the average of $H$ over the trajectory scales as $(\\Delta t)^2$. While the energy should ideally only show bounded oscillations around a constant value, in practice, factors like finite floating-point precision and, more significantly, the accumulation of local truncation errors can lead to a long-term systematic drift. The local error (per step) in energy for a second-order integrator is of order $\\mathcal{O}((\\Delta t)^3)$. Over a total simulation time $T_{\\text{sim}} = N \\Delta t$, the global error can accumulate, leading to a drift. The rate of this numerical energy drift, $s_{\\text{num}} = dE/dt$, is expected to scale with the leading error term of the integrator. For a second-order scheme like velocity Verlet, this drift rate scales quadratically with the timestep:\n$$\ns_{\\text{num}} \\propto (\\Delta t)^2\n$$\nThis can be written as $s_{\\text{num}} = k (\\Delta t)^2$, where $k$ is a proportionality constant that depends on the system's properties (e.g., frequencies of atomic vibrations, potential landscape).\n\nThis scaling behavior is a powerful diagnostic tool. The observed energy drift, $s$, can have two main components: the numerical drift $s_{\\text{num}}$ and a physical drift $s_{\\text{phys}}$ arising from incomplete equilibration. If the system is not yet in thermal equilibrium when the NVE production run starts, it will continue to relax towards an equilibrium state. This physical relaxation (e.g., structural rearrangements, temperature redistribution between subsystems) is an irreversible process whose rate, $s_{\\text{phys}}$, is an intrinsic property of the system's current state and should be independent of the numerical timestep $\\Delta t$. Therefore, the total observed drift is:\n$$\ns(\\Delta t) = s_{\\text{phys}} + s_{\\text{num}} = s_{\\text{phys}} + k (\\Delta t)^2\n$$\nBy measuring the drift rate $s$ at two or more different timesteps $\\Delta t$, one can distinguish the two contributions. If a plot of $s$ versus $(\\Delta t)^2$ yields a straight line with a non-zero y-intercept, the value of the intercept corresponds to $s_{\\text{phys}}$, indicating inadequate equilibration. If the intercept is zero (within statistical error), then $s_{\\text{phys}} \\approx 0$, which signifies that the system was well-equilibrated and the observed drift is purely a numerical artifact.\n\nThe problem provides two measurements:\n1. $\\Delta t_{1} = 1.0 \\text{ fs}$, $s_{1} = 0.005 \\text{ kJ mol}^{-1} \\text{ps}^{-1}$\n2. $\\Delta t_{2} = 2.0 \\text{ fs}$, $s_{2} = 0.020 \\text{ kJ mol}^{-1} \\text{ps}^{-1}$\n\nWe check the ratio of the drift rates against the ratio of the timesteps squared:\n$$\n\\frac{s_2}{s_1} = \\frac{0.020}{0.005} = 4\n$$\n$$\n\\left(\\frac{\\Delta t_2}{\\Delta t_1}\\right)^2 = \\left(\\frac{2.0}{1.0}\\right)^2 = 4\n$$\nSince $\\frac{s_2}{s_1} = \\left(\\frac{\\Delta t_2}{\\Delta t_1}\\right)^2$, this confirms that the observed drift is consistent with the leading-order numerical error scaling $s = k (\\Delta t)^2$, and we can conclude that the physical relaxation component is negligible, $s_{\\text{phys}} \\approx 0$. The prior equilibration was adequate.\n\nWe now determine the proportionality coefficient $k$. Using the first data point:\n$$\nk = \\frac{s_1}{(\\Delta t_1)^2} = \\frac{0.005 \\text{ kJ mol}^{-1} \\text{ps}^{-1}}{(1.0 \\text{ fs})^2} = 0.005 \\text{ kJ mol}^{-1} \\text{ps}^{-1} \\text{fs}^{-2}\n$$\nThe units of $k$ correctly reflect this relationship.\n\nFinally, we calculate the maximum allowable timestep, $\\Delta t_{\\max}$, that satisfies the production criterion. The criterion states that the relative energy drift over a production run of duration $T_{\\mathrm{prod}}$ must be less than a threshold $r_{\\mathrm{thr}}$. The total energy change is $\\Delta E_{\\mathrm{prod}} = s \\cdot T_{\\mathrm{prod}}$. The criterion is:\n$$\n\\frac{|\\Delta E_{\\mathrm{prod}}|}{|E_0|} < r_{\\mathrm{thr}}\n$$\nSubstituting $\\Delta E_{\\mathrm{prod}} = k (\\Delta t)^2 T_{\\mathrm{prod}}$ and solving for the maximum timestep $\\Delta t_{\\max}$ at the boundary of the condition:\n$$\n\\frac{k (\\Delta t_{\\max})^2 T_{\\mathrm{prod}}}{E_0} = r_{\\mathrm{thr}}\n$$\n$$\n\\Delta t_{\\max} = \\sqrt{\\frac{r_{\\mathrm{thr}} E_0}{k T_{\\mathrm{prod}}}}\n$$\nThe given values are:\n- $r_{\\mathrm{thr}} = 1.0 \\times 10^{-3}$\n- $E_{0} = 5.0 \\times 10^{3} \\text{ kJ mol}^{-1}$\n- $T_{\\mathrm{prod}} = 1.0 \\text{ ns} = 1.0 \\times 10^3 \\text{ ps}$\n- $k = 0.005 \\text{ kJ mol}^{-1} \\text{ps}^{-1} \\text{fs}^{-2}$\n\nWe substitute these values into the equation for $\\Delta t_{\\max}$:\n$$\n\\Delta t_{\\max} = \\sqrt{\\frac{(1.0 \\times 10^{-3}) \\cdot (5.0 \\times 10^{3} \\text{ kJ mol}^{-1})}{(0.005 \\text{ kJ mol}^{-1} \\text{ps}^{-1} \\text{fs}^{-2}) \\cdot (1.0 \\times 10^3 \\text{ ps})}}\n$$\n$$\n\\Delta t_{\\max} = \\sqrt{\\frac{5.0 \\text{ kJ mol}^{-1}}{5.0 \\text{ kJ mol}^{-1} \\text{fs}^{-2}}} = \\sqrt{1.0 \\text{ fs}^2} = 1.0 \\text{ fs}\n$$\nThe problem requires the answer to be rounded to three significant figures. Thus, the maximum allowable timestep is $1.00 \\text{ fs}$.", "answer": "$$\n\\boxed{1.00}\n$$", "id": "3449055"}, {"introduction": "During production sampling, we aim to calculate macroscopic properties that are as accurate as possible. However, the use of a finite potential cutoff, a necessary computational efficiency, introduces systematic errors in properties like pressure. This hands-on problem [@problem_id:3449061] demonstrates how to apply principles of statistical mechanics to derive the analytical long-range correction for pressure, a standard and essential procedure for reconciling the results from a truncated-potential simulation with the intended physical model.", "problem": "A homogeneous single-component fluid is simulated using Molecular Dynamics (MD) with the Lennard–Jones (LJ) pair potential truncated and shifted at a finite cutoff. The Lennard–Jones potential is given by $u_{\\mathrm{LJ}}(r) = 4 \\varepsilon \\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$, and the truncated-and-shifted potential applied in the simulation is\n$$\nu_{\\mathrm{TS}}(r) = \n\\begin{cases}\nu_{\\mathrm{LJ}}(r) - u_{\\mathrm{LJ}}(r_{c}), & r < r_{c},\\\\\n0, & r \\ge r_{c}.\n\\end{cases}\n$$\nAfter proper equilibration, production sampling is performed to compute the average pressure using forces from $u_{\\mathrm{TS}}(r)$. In order to estimate the thermodynamic pressure corresponding to the full (untruncated) LJ fluid, a long-range correction is added under the standard assumption that the pair distribution function is uniform beyond the cutoff, i.e., $g(r) = 1$ for $r \\ge r_{c}$.\n\nStarting from the mechanical definition of the pressure for a homogeneous, isotropic system with pairwise interactions and using only fundamental statistical mechanics relations as your base, derive the analytic expression for the long-range correction to the pressure, $\\Delta P_{\\mathrm{LRC}}$, that must be added to the pressure measured with $u_{\\mathrm{TS}}(r)$, expressed in terms of the number density $\\rho$, the Lennard–Jones parameters $\\varepsilon$ and $\\sigma$, the cutoff radius $r_c$, and universal constants. Assume the system is large enough that surface effects are negligible and the uniformity assumption $g(r)=1$ holds beyond $r_c$.\n\nExpress your final answer as a single closed-form expression in terms of $\\rho$, $\\varepsilon$, $\\sigma$, and $r_c$. The pressure unit is that of $\\varepsilon/\\sigma^{3}$ (that is, energy per volume consistent with $\\varepsilon$ and $\\sigma$). Do not substitute numbers and do not attach units in the final boxed expression.", "solution": "The problem statement is evaluated as valid. It is scientifically grounded in the principles of statistical mechanics and computational physics, is well-posed with all necessary information provided, and is expressed objectively. The task is to derive a standard formula, which is a non-trivial but well-defined exercise.\n\nThe pressure $P$ of a homogeneous, isotropic system of $N$ particles in a volume $V$, interacting through a pairwise potential $u(r)$, is given by the virial equation of state:\n$$ P = \\rho k_{B} T + P_{\\mathrm{conf}} $$\nwhere $\\rho = N/V$ is the number density, $k_B$ is the Boltzmann constant, $T$ is the absolute temperature, and $P_{\\mathrm{conf}}$ is the configurational contribution to the pressure. The configurational pressure is related to the intermolecular forces through the virial. For a system with pairwise interactions, it is given by:\n$$ P_{\\mathrm{conf}} = -\\frac{2\\pi\\rho^2}{3} \\int_{0}^{\\infty} r^3 \\frac{du(r)}{dr} g(r) dr $$\nHere, $g(r)$ is the radial distribution function, which describes the local structure of the fluid.\n\nThe total pressure of the \"true\" fluid, described by the full Lennard-Jones potential $u_{\\mathrm{LJ}}(r)$, is:\n$$ P_{\\mathrm{full}} = \\rho k_{B} T -\\frac{2\\pi\\rho^2}{3} \\int_{0}^{\\infty} r^3 \\frac{du_{\\mathrm{LJ}}(r)}{dr} g_{\\mathrm{full}}(r) dr $$\nwhere $g_{\\mathrm{full}}(r)$ is the radial distribution function corresponding to the full $u_{\\mathrm{LJ}}(r)$ potential.\n\nIn the molecular dynamics simulation, a truncated-and-shifted potential $u_{\\mathrm{TS}}(r)$ is used. The pressure is computed from the forces derived from this potential. For $r < r_c$, $u_{\\mathrm{TS}}(r) = u_{\\mathrm{LJ}}(r) - u_{\\mathrm{LJ}}(r_c)$. The force is the negative gradient of the potential, $f_{\\mathrm{TS}}(r) = -du_{\\mathrm{TS}}(r)/dr$. Since $u_{\\mathrm{LJ}}(r_c)$ is a constant, its derivative is zero. Thus, for $r < r_c$, the force is $f_{\\mathrm{TS}}(r) = -du_{\\mathrm{LJ}}(r)/dr$. For $r \\ge r_c$, the potential is zero, so the force is also zero. The pressure measured in the simulation, $P_{\\mathrm{TS}}$, is therefore:\n$$ P_{\\mathrm{TS}} = \\rho k_{B} T -\\frac{2\\pi\\rho^2}{3} \\int_{0}^{r_c} r^3 \\frac{du_{\\mathrm{LJ}}(r)}{dr} g_{\\mathrm{TS}}(r) dr $$\nwhere $g_{\\mathrm{TS}}(r)$ is the radial distribution function generated by the simulation using the $u_{\\mathrm{TS}}(r)$ potential.\n\nThe long-range correction, $\\Delta P_{\\mathrm{LRC}}$, is the quantity that must be added to the simulated pressure $P_{\\mathrm{TS}}$ to estimate the true pressure $P_{\\mathrm{full}}$.\n$$ \\Delta P_{\\mathrm{LRC}} = P_{\\mathrm{full}} - P_{\\mathrm{TS}} $$\nThe kinetic terms $\\rho k_B T$ cancel, leaving only the difference in configurational pressures:\n$$ \\Delta P_{\\mathrm{LRC}} = -\\frac{2\\pi\\rho^2}{3} \\left[ \\int_{0}^{\\infty} r^3 \\frac{du_{\\mathrm{LJ}}}{dr} g_{\\mathrm{full}}(r) dr - \\int_{0}^{r_c} r^3 \\frac{du_{\\mathrm{LJ}}}{dr} g_{\\mathrm{TS}}(r) dr \\right] $$\nTo proceed, two standard approximations are made. First, the structure of the fluid at short ranges is assumed to be unaffected by the potential truncation, so $g_{\\mathrm{TS}}(r) \\approx g_{\\mathrm{full}}(r)$ for $r < r_c$. Second, for distances beyond the cutoff, the fluid is assumed to be unstructured, meaning the radial distribution function is unity: $g_{\\mathrm{full}}(r) = 1$ for $r \\ge r_c$.\n\nApplying these approximations, we can split the first integral:\n$$ \\int_{0}^{\\infty} r^3 \\frac{du_{\\mathrm{LJ}}}{dr} g_{\\mathrm{full}}(r) dr = \\int_{0}^{r_c} r^3 \\frac{du_{\\mathrm{LJ}}}{dr} g_{\\mathrm{full}}(r) dr + \\int_{r_c}^{\\infty} r^3 \\frac{du_{\\mathrm{LJ}}}{dr} g_{\\mathrm{full}}(r) dr $$\n$$ \\approx \\int_{0}^{r_c} r^3 \\frac{du_{\\mathrm{LJ}}}{dr} g_{\\mathrm{TS}}(r) dr + \\int_{r_c}^{\\infty} r^3 \\frac{du_{\\mathrm{LJ}}}{dr} (1) dr $$\nSubstituting this back into the expression for $\\Delta P_{\\mathrm{LRC}}$:\n$$ \\Delta P_{\\mathrm{LRC}} \\approx -\\frac{2\\pi\\rho^2}{3} \\left[ \\left( \\int_{0}^{r_c} \\dots g_{\\mathrm{TS}}(r) dr + \\int_{r_c}^{\\infty} \\dots (1) dr \\right) - \\int_{0}^{r_c} \\dots g_{\\mathrm{TS}}(r) dr \\right] $$\nThe integrals from $0$ to $r_c$ cancel, leaving the contribution from the tail of the potential:\n$$ \\Delta P_{\\mathrm{LRC}} = -\\frac{2\\pi\\rho^2}{3} \\int_{r_c}^{\\infty} r^3 \\frac{du_{\\mathrm{LJ}}(r)}{dr} dr $$\nNow, we must evaluate this integral. The Lennard-Jones potential is:\n$$ u_{\\mathrm{LJ}}(r) = 4 \\varepsilon \\left[ \\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6} \\right] = 4\\varepsilon(\\sigma^{12}r^{-12} - \\sigma^{6}r^{-6}) $$\nIts derivative with respect to $r$ is:\n$$ \\frac{du_{\\mathrm{LJ}}(r)}{dr} = 4\\varepsilon(-12\\sigma^{12}r^{-13} + 6\\sigma^{6}r^{-7}) $$\nMultiplying by $r^3$:\n$$ r^3 \\frac{du_{\\mathrm{LJ}}(r)}{dr} = 4\\varepsilon(-12\\sigma^{12}r^{-10} + 6\\sigma^{6}r^{-4}) $$\nNow we perform the definite integration:\n$$ \\int_{r_c}^{\\infty} r^3 \\frac{du_{\\mathrm{LJ}}(r)}{dr} dr = 4\\varepsilon \\int_{r_c}^{\\infty} (-12\\sigma^{12}r^{-10} + 6\\sigma^{6}r^{-4}) dr $$\n$$ = 4\\varepsilon \\left[ -12\\sigma^{12}\\frac{r^{-9}}{-9} + 6\\sigma^{6}\\frac{r^{-3}}{-3} \\right]_{r_c}^{\\infty} $$\n$$ = 4\\varepsilon \\left[ \\frac{4}{3}\\sigma^{12}r^{-9} - 2\\sigma^{6}r^{-3} \\right]_{r_c}^{\\infty} $$\nEvaluating at the limits:\n$$ = 4\\varepsilon \\left[ \\lim_{r\\to\\infty} \\left(\\frac{4}{3}\\frac{\\sigma^{12}}{r^9} - 2\\frac{\\sigma^6}{r^3}\\right) - \\left(\\frac{4}{3}\\frac{\\sigma^{12}}{r_c^9} - 2\\frac{\\sigma^6}{r_c^3}\\right) \\right] $$\n$$ = 4\\varepsilon \\left[ (0 - 0) - \\left(\\frac{4}{3}\\frac{\\sigma^{12}}{r_c^9} - 2\\frac{\\sigma^6}{r_c^3}\\right) \\right] = -4\\varepsilon \\left(\\frac{4}{3}\\frac{\\sigma^{12}}{r_c^9} - 2\\frac{\\sigma^6}{r_c^3}\\right) $$\nSubstituting this result back into the expression for $\\Delta P_{\\mathrm{LRC}}$:\n$$ \\Delta P_{\\mathrm{LRC}} = -\\frac{2\\pi\\rho^2}{3} \\left[ -4\\varepsilon \\left(\\frac{4}{3}\\frac{\\sigma^{12}}{r_c^9} - 2\\frac{\\sigma^6}{r_c^3}\\right) \\right] $$\n$$ \\Delta P_{\\mathrm{LRC}} = \\frac{8\\pi\\rho^2\\varepsilon}{3} \\left(\\frac{4}{3}\\frac{\\sigma^{12}}{r_c^9} - 2\\frac{\\sigma^6}{r_c^3}\\right) $$\nFactoring out a $2$ from the parentheses gives a more compact form:\n$$ \\Delta P_{\\mathrm{LRC}} = \\frac{16\\pi\\rho^2\\varepsilon}{3} \\left(\\frac{2}{3}\\frac{\\sigma^{12}}{r_c^9} - \\frac{\\sigma^6}{r_c^3}\\right) $$\nThis is the final analytical expression for the long-range correction to the pressure.", "answer": "$$\n\\boxed{\\frac{16\\pi\\rho^2\\varepsilon}{3} \\left( \\frac{2}{3}\\frac{\\sigma^{12}}{r_c^9} - \\frac{\\sigma^6}{r_c^3} \\right)}\n$$", "id": "3449061"}]}