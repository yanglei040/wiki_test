{"hands_on_practices": [{"introduction": "This exercise is a foundational step in understanding lattice dynamics. By analytically deriving the dynamical matrix and phonon dispersion for a simplified crystal, you will build a concrete understanding of how macroscopic vibrational properties emerge from microscopic interatomic forces. This pen-and-paper practice solidifies the core theoretical concepts of Density Functional Perturbation Theory (DFPT) before moving on to more complex numerical applications [@problem_id:3460694].", "problem": "Consider a monoatomic simple cubic Bravais lattice of lattice parameter $a$ and atomic mass $m$. Within the harmonic approximation of lattice dynamics as formulated by Density Functional Perturbation Theory (DFPT), the interatomic force-constant tensor is defined as the second derivative of the Kohn–Sham total energy with respect to atomic displacements, and the dynamical matrix $\\mathbf{D}(\\mathbf{q})$ is the mass-weighted lattice Fourier transform of those real-space force constants. Assume that only nearest-neighbor couplings are present and that the pairwise interatomic force-constant tensor between the origin and any nearest-neighbor vector $\\mathbf{R}$ is isotropic, $\\Phi_{\\alpha \\beta}(\\mathbf{R})=-\\kappa \\,\\delta_{\\alpha \\beta}$, with the on-site term fixed by the acoustic sum rule $\\sum_{\\mathbf{R}}\\Phi_{\\alpha \\beta}(\\mathbf{R})=0$. The set of nearest-neighbor vectors is $\\mathbf{R}=\\pm a\\,\\hat{\\mathbf{x}},\\pm a\\,\\hat{\\mathbf{y}},\\pm a\\,\\hat{\\mathbf{z}}$.\n\nStarting from the harmonic equations of motion and the definition of the dynamical matrix, derive an explicit analytic expression for $\\mathbf{D}(\\mathbf{q})$ for an arbitrary wave vector $\\mathbf{q}$ in the first Brillouin zone. Then obtain the closed-form phonon dispersion (the triply degenerate acoustic angular frequency $\\omega(\\mathbf{q})$) along the high-symmetry path $\\Gamma \\rightarrow X \\rightarrow M$ of the simple cubic Brillouin zone, where $\\Gamma=(0,0,0)$, $X=(\\pi/a,0,0)$, and $M=(\\pi/a,\\pi/a,0)$. Parameterize the segment $\\Gamma \\rightarrow X$ by $\\mathbf{q}=(k,0,0)$ with $k\\in[0,\\pi/a]$ and the segment $X \\rightarrow M$ by $\\mathbf{q}=(\\pi/a,t,0)$ with $t\\in[0,\\pi/a]$. Express your final results for $\\mathbf{D}(\\mathbf{q})$, $\\omega_{\\Gamma X}(k)$, and $\\omega_{XM}(t)$ as closed-form analytic expressions. Do not substitute numerical values. No rounding is required. In your final answer, present the expressions in the stated order and do not include units.", "solution": "The problem statement is validated as scientifically grounded, well-posed, objective, and internally consistent. It represents a standard problem in solid-state physics. We proceed with the solution.\n\nThe problem asks for the dynamical matrix $\\mathbf{D}(\\mathbf{q})$ and the phonon dispersion relations $\\omega(\\mathbf{q})$ along a specific high-symmetry path for a monoatomic simple cubic lattice. The analysis is based on a simplified model with isotropic, nearest-neighbor interactions within the harmonic approximation.\n\nFirst, we define the dynamical matrix $\\mathbf{D}(\\mathbf{q})$ as the mass-weighted Fourier transform of the interatomic force-constant tensor $\\Phi_{\\alpha \\beta}(\\mathbf{R})$:\n$$D_{\\alpha \\beta}(\\mathbf{q}) = \\frac{1}{m} \\sum_{\\mathbf{R}} \\Phi_{\\alpha \\beta}(\\mathbf{R}) \\exp(i \\mathbf{q} \\cdot \\mathbf{R})$$\nwhere $m$ is the atomic mass, $\\mathbf{q}$ is the wave vector, and the sum runs over all lattice vectors $\\mathbf{R}$. The indices $\\alpha, \\beta$ denote Cartesian components $\\{x, y, z\\}$.\n\nThe force constants are given as non-zero only for on-site ($\\mathbf{R}=0$) and nearest-neighbor (NN) interactions. The NN force-constant tensor is specified as $\\Phi_{\\alpha \\beta}(\\mathbf{R}_{\\text{NN}}) = -\\kappa \\delta_{\\alpha \\beta}$, where $\\kappa$ is a positive constant and $\\delta_{\\alpha \\beta}$ is the Kronecker delta.\n\nThe on-site force constant, $\\Phi_{\\alpha \\beta}(0)$, is determined by the acoustic sum rule, which ensures that a rigid translation of the entire crystal costs zero energy. The rule states:\n$$\\sum_{\\mathbf{R}} \\Phi_{\\alpha \\beta}(\\mathbf{R}) = 0$$\nExpanding this sum, we have:\n$$\\Phi_{\\alpha \\beta}(0) + \\sum_{\\mathbf{R} \\neq 0} \\Phi_{\\alpha \\beta}(\\mathbf{R}) = 0$$\nSince only NN interactions are considered, the sum over $\\mathbf{R} \\neq 0$ reduces to a sum over the NN vectors.\n$$\\Phi_{\\alpha \\beta}(0) = - \\sum_{\\mathbf{R}_{\\text{NN}}} \\Phi_{\\alpha \\beta}(\\mathbf{R}_{\\text{NN}})$$\nA simple cubic lattice has $6$ nearest neighbors, located at $\\mathbf{R}_{\\text{NN}} = \\{\\pm a\\hat{\\mathbf{x}}, \\pm a\\hat{\\mathbf{y}}, \\pm a\\hat{\\mathbf{z}}\\}$. Substituting the given form of the NN force constants:\n$$\\Phi_{\\alpha \\beta}(0) = - \\sum_{j=1}^{6} (-\\kappa \\delta_{\\alpha \\beta}) = 6\\kappa \\delta_{\\alpha \\beta}$$\n\nNow we can construct the dynamical matrix. We split the sum over $\\mathbf{R}$ into the on-site term and the sum over nearest neighbors:\n$$D_{\\alpha \\beta}(\\mathbf{q}) = \\frac{1}{m} \\left( \\Phi_{\\alpha \\beta}(0) \\exp(i \\mathbf{q} \\cdot 0) + \\sum_{\\mathbf{R}_{\\text{NN}}} \\Phi_{\\alpha \\beta}(\\mathbf{R}_{\\text{NN}}) \\exp(i \\mathbf{q} \\cdot \\mathbf{R}_{\\text{NN}}) \\right)$$\nSubstituting the expressions for the force constants:\n$$D_{\\alpha \\beta}(\\mathbf{q}) = \\frac{1}{m} \\left( 6\\kappa \\delta_{\\alpha \\beta} - \\kappa \\delta_{\\alpha \\beta} \\sum_{\\mathbf{R}_{\\text{NN}}} \\exp(i \\mathbf{q} \\cdot \\mathbf{R}_{\\text{NN}}) \\right)$$\n$$D_{\\alpha \\beta}(\\mathbf{q}) = \\frac{\\kappa}{m} \\delta_{\\alpha \\beta} \\left( 6 - \\sum_{\\mathbf{R}_{\\text{NN}}} \\exp(i \\mathbf{q} \\cdot \\mathbf{R}_{\\text{NN}}) \\right)$$\nThe sum over the nearest neighbor vectors is evaluated as follows, with $\\mathbf{q} = (q_x, q_y, q_z)$:\n$$ \\sum_{\\mathbf{R}_{\\text{NN}}} \\exp(i \\mathbf{q} \\cdot \\mathbf{R}_{\\text{NN}}) = \\exp(i q_x a) + \\exp(-i q_x a) + \\exp(i q_y a) + \\exp(-i q_y a) + \\exp(i q_z a) + \\exp(-i q_z a) $$\nUsing the identity $2\\cos\\theta = e^{i\\theta} + e^{-i\\theta}$, the sum becomes:\n$$ \\sum_{\\mathbf{R}_{\\text{NN}}} \\exp(i \\mathbf{q} \\cdot \\mathbf{R}_{\\text{NN}}) = 2\\cos(q_x a) + 2\\cos(q_y a) + 2\\cos(q_z a) $$\nSubstituting this back into the expression for $D_{\\alpha \\beta}(\\mathbf{q})$:\n$$ D_{\\alpha \\beta}(\\mathbf{q}) = \\frac{\\kappa}{m} \\delta_{\\alpha \\beta} \\left( 6 - 2\\cos(q_x a) - 2\\cos(q_y a) - 2\\cos(q_z a) \\right) $$\n$$ D_{\\alpha \\beta}(\\mathbf{q}) = \\frac{2\\kappa}{m} \\left( 3 - \\cos(q_x a) - \\cos(q_y a) - \\cos(q_z a) \\right) \\delta_{\\alpha \\beta} $$\nThis shows that the dynamical matrix is diagonal. Let $\\mathbf{I}_3$ be the $3 \\times 3$ identity matrix. Then the dynamical matrix is:\n$$ \\mathbf{D}(\\mathbf{q}) = \\frac{2\\kappa}{m} \\left( 3 - \\cos(q_x a) - \\cos(q_y a) - \\cos(q_z a) \\right) \\mathbf{I}_3 $$\nThis is the first required expression.\n\nThe phonon frequencies $\\omega(\\mathbf{q})$ are found by solving the eigenvalue problem $\\mathbf{D}(\\mathbf{q})\\mathbf{e} = \\omega^2(\\mathbf{q})\\mathbf{e}$. Since $\\mathbf{D}(\\mathbf{q})$ is a scalar multiple of the identity matrix, its three eigenvalues are identical. This gives a triply degenerate acoustic phonon branch.\n$$ \\omega^2(\\mathbf{q}) = \\frac{2\\kappa}{m} \\left( 3 - \\cos(q_x a) - \\cos(q_y a) - \\cos(q_z a) \\right) $$\nUsing the trigonometric identity $1 - \\cos\\theta = 2\\sin^2(\\theta/2)$, we can rewrite this as:\n$$ \\omega^2(\\mathbf{q}) = \\frac{2\\kappa}{m} \\left[ (1 - \\cos(q_x a)) + (1 - \\cos(q_y a)) + (1 - \\cos(q_z a)) \\right] $$\n$$ \\omega^2(\\mathbf{q}) = \\frac{2\\kappa}{m} \\left[ 2\\sin^2\\left(\\frac{q_x a}{2}\\right) + 2\\sin^2\\left(\\frac{q_y a}{2}\\right) + 2\\sin^2\\left(\\frac{q_z a}{2}\\right) \\right] $$\n$$ \\omega^2(\\mathbf{q}) = \\frac{4\\kappa}{m} \\left( \\sin^2\\left(\\frac{q_x a}{2}\\right) + \\sin^2\\left(\\frac{q_y a}{2}\\right) + \\sin^2\\left(\\frac{q_z a}{2}\\right) \\right) $$\nTaking the square root gives the general dispersion relation:\n$$ \\omega(\\mathbf{q}) = 2\\sqrt{\\frac{\\kappa}{m}} \\sqrt{\\sin^2\\left(\\frac{q_x a}{2}\\right) + \\sin^2\\left(\\frac{q_y a}{2}\\right) + \\sin^2\\left(\\frac{q_z a}{2}\\right)} $$\n\nNext, we evaluate this expression along the specified high-symmetry path $\\Gamma \\rightarrow X \\rightarrow M$.\n\nFor the segment $\\Gamma \\rightarrow X$, the wave vector is parameterized as $\\mathbf{q} = (k, 0, 0)$ with $k \\in [0, \\pi/a]$.\nSubstituting $q_x=k, q_y=0, q_z=0$ into the general dispersion relation:\n$$ \\omega_{\\Gamma X}(k) = 2\\sqrt{\\frac{\\kappa}{m}} \\sqrt{\\sin^2\\left(\\frac{ka}{2}\\right) + \\sin^2(0) + \\sin^2(0)} = 2\\sqrt{\\frac{\\kappa}{m}} \\left|\\sin\\left(\\frac{ka}{2}\\right)\\right| $$\nSince $k \\in [0, \\pi/a]$, the argument $ka/2$ is in the range $[0, \\pi/2]$, where the sine function is non-negative. Thus, the absolute value is redundant.\n$$ \\omega_{\\Gamma X}(k) = 2\\sqrt{\\frac{\\kappa}{m}} \\sin\\left(\\frac{ka}{2}\\right) $$\nThis is the second required expression.\n\nFor the segment $X \\rightarrow M$, the wave vector is parameterized as $\\mathbf{q} = (\\pi/a, t, 0)$ with $t \\in [0, \\pi/a]$.\nSubstituting $q_x=\\pi/a, q_y=t, q_z=0$ into the general dispersion relation:\n$$ \\omega_{XM}(t) = 2\\sqrt{\\frac{\\kappa}{m}} \\sqrt{\\sin^2\\left(\\frac{(\\pi/a)a}{2}\\right) + \\sin^2\\left(\\frac{ta}{2}\\right) + \\sin^2(0)} $$\n$$ \\omega_{XM}(t) = 2\\sqrt{\\frac{\\kappa}{m}} \\sqrt{\\sin^2\\left(\\frac{\\pi}{2}\\right) + \\sin^2\\left(\\frac{ta}{2}\\right)} $$\n$$ \\omega_{XM}(t) = 2\\sqrt{\\frac{\\kappa}{m}} \\sqrt{1 + \\sin^2\\left(\\frac{ta}{2}\\right)} $$\nThis is the third and final required expression.", "answer": "$$\n\\boxed{\n\\begin{aligned}\n\\mathbf{D}(\\mathbf{q}) = \\frac{2\\kappa}{m} \\left( 3 - \\cos(q_x a) - \\cos(q_y a) - \\cos(q_z a) \\right) \\mathbf{I}_3 \\\\\n\\omega_{\\Gamma X}(k) = 2\\sqrt{\\frac{\\kappa}{m}} \\sin\\left(\\frac{ka}{2}\\right) \\\\\n\\omega_{XM}(t) = 2\\sqrt{\\frac{\\kappa}{m}} \\sqrt{1 + \\sin^2\\left(\\frac{ta}{2}\\right)}\n\\end{aligned}\n}\n$$", "id": "3460694"}, {"introduction": "Real-world computational models are subject to numerical precision limitations, which can lead to unphysical results if not properly understood and controlled. This coding practice focuses on the Acoustic Sum Rule (ASR), a direct consequence of translational invariance that is crucial for accurate phonon calculations. You will implement a numerical diagnostic to directly observe how even small violations of the ASR can generate spurious imaginary frequencies, a common challenge in DFPT simulations [@problem_id:3460693].", "problem": "You are asked to implement numerical diagnostics inspired by Density Functional Perturbation Theory (DFPT), focusing on the Acoustic Sum Rule (ASR) and its relationship to spurious imaginary phonon frequencies in a one-dimensional monatomic Bravais lattice. The diagnostic operates on synthetic, translation-invariant force constants approximating those computed by DFPT, and deliberately introduces controlled ASR violations so that their consequences can be quantified.\n\nStart from the following fundamental statements and definitions:\n\n- In the harmonic approximation of lattice dynamics, the Born–Oppenheimer potential energy expanded to second order in atomic displacements defines the force-constant matrix $\\Phi_{ij}$ via $\\Phi_{ij} = \\partial^2 E / \\partial u_i \\partial u_j$, where $i$ and $j$ index atoms. For a one-dimensional monatomic lattice, there is a single Cartesian direction and the tensor indices reduce to scalars.\n- Translational invariance implies the Acoustic Sum Rule: for each atom $i$, $\\sum_j \\Phi_{ij} = 0$. This ensures that a uniform translation produces no restoring force.\n- The mass-normalized dynamical matrix in reciprocal space is defined by the lattice Fourier transform $D(q) = \\frac{1}{M} \\sum_R \\Phi_{0R} e^{\\mathrm{i} q R}$, where $M$ is the atomic mass, $R$ runs over lattice vectors, and $q$ is the wavevector. The phonon angular frequencies satisfy $\\omega^2(q) = \\lambda(q)$, where $\\lambda(q)$ are the eigenvalues of $D(q)$; for a one-dimensional monatomic lattice, $D(q)$ is scalar and equals $\\omega^2(q)$. If $D(q)  0$, then $\\omega(q)$ is imaginary, which is unphysical for a stable structure and may arise from numerical violations of the Acoustic Sum Rule.\n\nYour numerical diagnostic should quantify the ASR deviation and correlate it with spurious imaginary modes:\n\n- Define the ASR deviation as $\\delta = \\max_i \\left| \\sum_j \\Phi_{ij} \\right|$. For the one-dimensional monatomic chain with translational invariance, this reduces to $\\delta = \\left| \\Phi_{00} + \\sum_{R \\neq 0} \\Phi_{0R} \\right|$.\n- For a nearest-neighbor model of the one-dimensional monatomic chain with spring constant $K$ and lattice constant $a$, take the nonzero real-space force constants to be $\\Phi_{01} = \\Phi_{0,-1} = -K$ and $\\Phi_{00} = 2K + \\epsilon$, where $\\epsilon$ parametrizes a controlled violation of the Acoustic Sum Rule. The exact rule is satisfied when $\\epsilon = 0$.\n- In this model, the mass-normalized dynamical matrix is $D(q) = \\frac{1}{M} \\left[ \\Phi_{00} + 2 \\Phi_{01} \\cos(q a) \\right] = \\frac{1}{M} \\left[ (2K + \\epsilon) - 2K \\cos(q a) \\right]$. Spurious imaginary frequencies occur where $D(q)  0$.\n\nImplement a program that for each test case:\n\n1. Constructs the one-dimensional nearest-neighbor force constants with a specified $K$ and $\\epsilon$ as above, and computes the ASR deviation $\\delta$ in $\\text{eV}/\\text{\\AA}^2$.\n2. Builds a uniform wavevector grid with $N_q$ points over the closed interval $q \\in \\left[-\\pi/a, \\pi/a\\right]$ in $\\text{\\AA}^{-1}$, samples $D(q)$ on that grid, and counts the fraction $f_{\\mathrm{imag}}$ of grid points with $D(q)  -\\gamma$, where $\\gamma$ is a small positive guard threshold to avoid classifying numerical roundoff as imaginary. Report $f_{\\mathrm{imag}}$ as a decimal in $[0,1]$.\n3. After processing all test cases, computes the Pearson linear correlation coefficient $r_{\\mathrm{all}}$ between the vector of ASR deviations $\\{\\delta\\}$ and the vector of fractions $\\{f_{\\mathrm{imag}}\\}$ across the full test suite. If the standard deviation of either vector is zero, define the correlation to be $0$.\n4. Additionally, compute a conditional correlation coefficient $r_{\\mathrm{neg}}$ restricted to the subset of test cases with $\\sum_j \\Phi_{0j} = \\epsilon  0$, i.e., the cases that can actually produce $D(q)  0$ in this model. If fewer than two such cases exist, define $r_{\\mathrm{neg}} = 0$.\n\nPhysical units and angle units:\n\n- Report $\\delta$ in $\\text{eV}/\\text{\\AA}^2$.\n- Use $\\text{\\AA}$ for lengths and $\\text{atomic mass units}$ for mass.\n- Wavevectors $q$ must be in $\\text{\\AA}^{-1}$ and angles in trigonometric functions must be in radians.\n\nTest suite:\n\nUse the following fixed parameters across all cases unless otherwise stated:\n\n- Lattice constant $a = 5.43\\,\\text{\\AA}$.\n- Atomic mass $M = 28.0855\\,\\text{amu}$.\n- Spring constant $K = 10.0\\,\\text{eV}/\\text{\\AA}^2$.\n- Number of wavevector points $N_q = 501$.\n- Imaginary guard threshold $\\gamma = 1.0 \\times 10^{-12}\\,\\text{eV}/(\\text{amu}\\cdot\\text{\\AA}^2)$.\n\nDefine four test cases by the ASR-violation parameter $\\epsilon$:\n\n- Case $1$: $\\epsilon = 0.0 \\times K$.\n- Case $2$: $\\epsilon = -1.0 \\times 10^{-4} \\times K$.\n- Case $3$: $\\epsilon = -0.5 \\times K$.\n- Case $4$: $\\epsilon = +0.5 \\times K$.\n\nFor each case, compute and record the pair $(\\delta, f_{\\mathrm{imag}})$ as defined above. Then compute $r_{\\mathrm{all}}$ and $r_{\\mathrm{neg}}$.\n\nFinal output format:\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain the sequence $[\\delta_1, f_{\\mathrm{imag},1}, \\delta_2, f_{\\mathrm{imag},2}, \\delta_3, f_{\\mathrm{imag},3}, \\delta_4, f_{\\mathrm{imag},4}, r_{\\mathrm{all}}, r_{\\mathrm{neg}}]$, where $\\delta_i$ are in $\\text{eV}/\\text{\\AA}^2$, $f_{\\mathrm{imag},i}$ are decimals in $[0,1]$, and $r_{\\mathrm{all}}$, $r_{\\mathrm{neg}}$ are unitless decimals in $\\left[-1,1\\right]$.", "solution": "The problem is valid as it is scientifically grounded in the principles of solid-state physics, specifically lattice dynamics, and is well-posed with all necessary information provided for a unique numerical solution.\n\nThe objective is to implement a numerical diagnostic to study the relationship between violations of the Acoustic Sum Rule (ASR) and the appearance of spurious imaginary phonon frequencies in a simplified one-dimensional ($1$D) monatomic lattice model.\n\nThe algorithmic design proceeds in four main steps for each test case, followed by a final correlation analysis across all cases.\n\nFirst, we establish the physical model. For a $1$D monatomic chain with lattice constant $a$, atomic mass $M$, and nearest-neighbor interactions modeled by a spring constant $K$, the non-zero force constants $\\Phi_{ij}$ are given. The problem introduces a parameter $\\epsilon$ to control a violation of the ASR:\n$$ \\Phi_{01} = \\Phi_{0,-1} = -K $$\n$$ \\Phi_{00} = 2K + \\epsilon $$\nFor this model, translational invariance requires that the sum of force constants is zero for any atom. The sum for the atom at the origin ($R=0$) is:\n$$ \\sum_{j} \\Phi_{0j} = \\Phi_{00} + \\Phi_{01} + \\Phi_{0,-1} = (2K + \\epsilon) + (-K) + (-K) = \\epsilon $$\nThe ASR is satisfied if and only if $\\epsilon=0$. The ASR deviation, $\\delta$, is defined as the maximum magnitude of this sum over all atoms. Due to translational symmetry, this is uniform for all atoms, hence:\n$$ \\delta = \\left| \\sum_j \\Phi_{0j} \\right| = |\\epsilon| $$\nThe spring constant is given as $K=10.0\\,\\text{eV}/\\text{\\AA}^2$. For each test case defined by a value of $\\epsilon$, $\\delta$ can be directly computed in units of $\\text{eV}/\\text{\\AA}^2$.\n\nSecond, we determine the fraction of imaginary phonon modes, $f_{\\mathrm{imag}}$. The phonon frequencies $\\omega(q)$ are related to the eigenvalues of the dynamical matrix $D(q)$. For a $1$D monatomic lattice, $D(q)$ is a scalar given by the Fourier transform of the force constants:\n$$ D(q) = \\frac{1}{M} \\sum_R \\Phi_{0R} e^{\\mathrm{i} q R} = \\omega^2(q) $$\nFor our nearest-neighbor model, this sum becomes:\n$$ D(q) = \\frac{1}{M} \\left( \\Phi_{00} + \\Phi_{01}e^{\\mathrm{i}qa} + \\Phi_{0,-1}e^{-\\mathrm{i}qa} \\right) = \\frac{1}{M} \\left( \\Phi_{00} + (\\Phi_{01} + \\Phi_{0,-1})\\cos(qa) \\right) $$\nSubstituting the model's force constants:\n$$ D(q) = \\frac{1}{M} \\left( (2K + \\epsilon) - 2K\\cos(qa) \\right) = \\frac{1}{M} \\left( 2K(1 - \\cos(qa)) + \\epsilon \\right) $$\nAn imaginary frequency $\\omega(q)$ occurs if $\\omega^2(q)  0$, which means $D(q)  0$. To avoid classifying small negative numbers from numerical round-off as imaginary, the problem defines a stricter condition using a guard threshold $\\gamma = 1.0 \\times 10^{-12}\\,\\text{eV}/(\\text{amu}\\cdot\\text{\\AA}^2)$:\n$$ D(q)  -\\gamma $$\nThe calculation proceeds by constructing a uniform grid of $N_q = 501$ wavevectors $q$ in the first Brillouin zone, $q \\in [-\\pi/a, \\pi/a]$, where $a=5.43\\,\\text{\\AA}$. For each value of $q$ on the grid, $D(q)$ is calculated using the given parameters ($M=28.0855\\,\\text{amu}$, $K=10.0\\,\\text{eV}/\\text{\\AA}^2$) and the specific $\\epsilon$ for the test case. The number of grid points, $N_{\\mathrm{imag}}$, where the condition $D(q)  -\\gamma$ is met is counted. The fraction $f_{\\mathrm{imag}}$ is then:\n$$ f_{\\mathrm{imag}} = \\frac{N_{\\mathrm{imag}}}{N_q} $$\nThe term $2K(1 - \\cos(qa))$ is always non-negative. Therefore, for $D(q)$ to be negative, $\\epsilon$ must be negative and its magnitude must be sufficient to overcome the $2K(1 - \\cos(qa))$ term. Specifically, imaginary modes are possible only if $\\epsilon  0$. If $\\epsilon \\ge 0$, then $D(q) \\ge 0$ for all $q$, and $f_{\\mathrm{imag}}$ will be $0$.\n\nThird, we compute the Pearson linear correlation coefficient, $r_{\\mathrm{all}}$, between the set of all computed ASR deviations, $\\{\\delta_i\\}$, and the corresponding set of imaginary mode fractions, $\\{f_{\\mathrm{imag},i}\\}$, across all four test cases. The Pearson correlation coefficient $r$ for two sets of data $X$ and $Y$ of size $n$ is:\n$$ r = \\frac{\\sum_{i=1}^n (X_i - \\bar{X})(Y_i - \\bar{Y})}{\\sqrt{\\sum_{i=1}^n (X_i - \\bar{X})^2} \\sqrt{\\sum_{i=1}^n (Y_i - \\bar{Y})^2}} $$\nIf the standard deviation of either $\\{ \\delta_i \\}$ or $\\{ f_{\\mathrm{imag},i} \\}$ is zero, the problem specifies that $r_{\\mathrm{all}}$ should be defined as $0$.\n\nFourth, we compute a conditional correlation coefficient, $r_{\\mathrm{neg}}$. This coefficient is calculated using the same Pearson formula but restricted to the subset of test cases where the ASR violation sum is negative, i.e., $\\sum_j \\Phi_{0j} = \\epsilon  0$. If this subset contains fewer than two data points, which is the minimum required to compute a meaningful correlation, $r_{\\mathrm{neg}}$ is defined to be $0$.\n\nThe overall algorithm is to iterate through the four specified values of $\\epsilon$, calculate the pair $(\\delta, f_{\\mathrm{imag}})$ for each, and store these results. After processing all cases, the two correlation coefficients, $r_{\\mathrm{all}}$ and $r_{\\mathrm{neg}}$, are computed from the stored results. The final output is a list containing the ten resultant numerical values.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Performs numerical diagnostics on a 1D monatomic lattice model to correlate\n    Acoustic Sum Rule (ASR) violations with spurious imaginary phonon frequencies.\n    \"\"\"\n    # Define fixed physical parameters and numerical settings\n    a = 5.43  # Lattice constant in Angstrom\n    M = 28.0855  # Atomic mass in amu\n    K = 10.0  # Spring constant in eV/A^2\n    N_q = 501  # Number of wavevector points in the grid\n    gamma = 1.0e-12  # Guard threshold for imaginary modes in eV/(amu*A^2)\n\n    # Define the four test cases by the factor applied to K for epsilon\n    test_case_factors = [0.0, -1.0e-4, -0.5, 0.5]\n\n    # Lists to store results for correlation analysis\n    delta_results = []\n    f_imag_results = []\n    epsilon_values = []\n    output_list = []\n\n    # Create the uniform wavevector grid for the first Brillouin zone\n    q_grid = np.linspace(-np.pi / a, np.pi / a, N_q)\n\n    # Process each test case\n    for factor in test_case_factors:\n        # 1. Calculate ASR violation parameter epsilon and deviation delta\n        epsilon = factor * K\n        delta = abs(epsilon)\n\n        epsilon_values.append(epsilon)\n        delta_results.append(delta)\n\n        # 2. Calculate the dynamical matrix D(q) and find imaginary modes\n        # D(q) = (1/M) * [ (2K + epsilon) - 2K*cos(q*a) ]\n        D_q = (1.0 / M) * ((2.0 * K + epsilon) - 2.0 * K * np.cos(q_grid * a))\n        \n        # Count points where D(q) is below the negative threshold\n        imaginary_modes_count = np.sum(D_q  -gamma)\n        \n        # Calculate the fraction of imaginary modes\n        f_imag = imaginary_modes_count / N_q\n        f_imag_results.append(f_imag)\n\n        # Append the pair (delta, f_imag) to the final output list\n        output_list.append(delta)\n        output_list.append(f_imag)\n\n    # 3. Compute the Pearson correlation coefficient r_all for all cases\n    # Per the problem, if std dev is zero, correlation is 0.\n    if np.std(delta_results) == 0.0 or np.std(f_imag_results) == 0.0:\n        r_all = 0.0\n    else:\n        # np.corrcoef returns a 2x2 matrix, the off-diagonal element is the correlation\n        r_all = np.corrcoef(delta_results, f_imag_results)[0, 1]\n    \n    # 4. Compute the conditional correlation coefficient r_neg for cases with epsilon  0\n    neg_epsilon_indices = [i for i, e in enumerate(epsilon_values) if e  0]\n    \n    # Per the problem, if fewer than two such cases exist, r_neg is 0.\n    if len(neg_epsilon_indices)  2:\n        r_neg = 0.0\n    else:\n        delta_neg_subset = [delta_results[i] for i in neg_epsilon_indices]\n        f_imag_neg_subset = [f_imag_results[i] for i in neg_epsilon_indices]\n        \n        # Check for zero std dev within the subset\n        if np.std(delta_neg_subset) == 0.0 or np.std(f_imag_neg_subset) == 0.0:\n            r_neg = 0.0\n        else:\n            r_neg = np.corrcoef(delta_neg_subset, f_imag_neg_subset)[0, 1]\n\n    # Append correlation coefficients to the final output list\n    output_list.append(r_all)\n    output_list.append(r_neg)\n\n    # Format and print the final output as a single comma-separated list\n    # The format specifier ensures floating point representation without excessive precision\n    formatted_results = [f\"{val:.12g}\" for val in output_list]\n    print(f\"[{','.join(formatted_results)}]\")\n\n\nif __name__ == \"__main__\":\n    solve()\n\n```", "id": "3460693"}, {"introduction": "The calculation of phonon dispersions in metals presents unique challenges due to the presence of the Fermi surface, requiring careful convergence with respect to both Brillouin-zone sampling and electronic smearing. This advanced exercise simulates a realistic research task where you must distinguish a true physical instability (e.g., a charge-density wave) from a numerical artifact. By implementing a systematic convergence study and an extrapolation procedure, you will develop a robust methodology for analyzing potential soft modes in metallic systems [@problem_id:3460717].", "problem": "Consider a simplified but scientifically grounded model for metallic phonons within the framework of Density Functional Perturbation Theory (DFPT). In metals, the phonon dynamical matrix acquires an electronic screening contribution that depends on both the Brillouin-zone sampling ($k$-point mesh) and on the Fermi-surface smearing parameter $\\sigma$ used to regularize occupations near the Fermi energy.\n\nWe study a one-dimensional Brillouin zone with reduced coordinate $q \\in [0,1)$ and two phonon branches: an acoustic branch ($A$) and an optical branch ($O$). The unperturbed (bare) phonon frequencies are defined as\n$$\n\\omega_{0,A}(q) = v_s \\left|\\sin(\\pi q)\\right|,\\quad \\omega_{0,O}(q) = \\omega_{\\mathrm{opt}},\n$$\nboth expressed in terahertz (THz). The electron-phonon screening induces a Kohn-anomaly-like correction to the squared frequency, localized around a wavevector $q_0$, represented by\n$$\n\\Delta \\omega^2(q,\\sigma) = -G \\exp\\left(-\\frac{(q-q_0)^2}{2 w^2}\\right) \\cdot \\frac{1}{1 + \\left(\\frac{\\sigma}{\\sigma_0}\\right)^p},\n$$\nwhere $G$ has units of $\\mathrm{THz}^2$, $w$ is a dimensionless width in reduced $q$, $p$ is a positive exponent controlling the smearing dependence, and $\\sigma$ is the smearing in electronvolts (eV) with characteristic scale $\\sigma_0$ (in eV). Finite $k$-point sampling introduces a bias in the electronic response that we model as\n$$\nB(N_k,q) = -\\frac{B_0}{N_k^\\beta}\\exp\\left(-\\frac{(q-q_0)^2}{2 w^2}\\right),\n$$\nwith $B_0$ in $\\mathrm{THz}^2$ and $\\beta0$. Residual discretization noise is modeled as\n$$\n\\eta(N_k,q) = \\frac{\\eta_0}{N_k^\\gamma} \\sin(2\\pi q),\n$$\nwith $\\eta_0$ in $\\mathrm{THz}^2$ and $\\gamma0$. The total squared frequencies for the two branches are\n$$\n\\omega_A^2(q; \\sigma, N_k) = \\omega_{0,A}^2(q) + \\Delta \\omega^2(q,\\sigma) + B(N_k,q) + \\eta(N_k,q),\n$$\n$$\n\\omega_O^2(q; \\sigma, N_k) = \\omega_{0,O}^2 + \\alpha\\,\\Delta \\omega^2(q,\\sigma) + \\frac{B_0'}{N_k^\\beta}\\exp\\left(-\\frac{(q-q_0)^2}{2 w^2}\\right),\n$$\nwhere $\\alpha \\in [0,1]$ reduces the electronic anomaly for the optical branch and $B_0'$ is the optical-branch sampling bias amplitude. For any $(\\sigma,N_k)$, a negative squared frequency indicates an instability; as is standard, we define the reported frequency as\n$$\n\\omega(q,\\nu; \\sigma, N_k) = \\begin{cases}\n+\\sqrt{\\omega_\\nu^2(q; \\sigma, N_k)},  \\text{if } \\omega_\\nu^2(q; \\sigma, N_k) \\ge 0,\\\\\n-\\sqrt{-\\omega_\\nu^2(q; \\sigma, N_k)},  \\text{if } \\omega_\\nu^2(q; \\sigma, N_k)  0,\n\\end{cases}\n$$\nin THz, such that imaginary modes are represented by negative values.\n\nYour task is to implement a systematic convergence study in the smearing $\\sigma$ and the $k$-point mesh size $N_k$ for three synthetic metallic materials. For each material, construct the function\n$$\nm(N_k,\\sigma) = \\min_{q \\in \\mathbb{Q},\\, \\nu \\in \\{A,O\\}} \\omega_\\nu(q; \\sigma, N_k),\n$$\nwhere $\\mathbb{Q}$ is a uniform grid in $q$ with $N_q=201$ points on $[0,1)$, and define the squared minimum\n$$\ny(N_k,\\sigma) = \\min_{q \\in \\mathbb{Q},\\, \\nu \\in \\{A,O\\}} \\omega_\\nu^2(q; \\sigma, N_k).\n$$\nTo analyze the $\\sigma \\to 0$ limit at fixed $N_k$, fit the following DFPT-inspired regression model to the data $\\{(\\sigma_i, y(N_k,\\sigma_i))\\}$ over the provided smearing set:\n$$\ny(N_k,\\sigma) \\approx c(N_k) - \\frac{A(N_k)}{1 + \\left(\\frac{\\sigma}{\\sigma_0}\\right)^p},\n$$\nwith fit parameters $c(N_k)$ and $A(N_k)$ for each $N_k$, and known $\\sigma_0$ and $p$. Use nonnegative $A(N_k)$ in the fit. The extrapolated $\\sigma \\to 0$ squared minimum is then\n$$\ny_0(N_k) = c(N_k) - A(N_k),\n$$\nand the corresponding extrapolated minimum frequency is\n$$\n\\omega_0(N_k) = \\begin{cases}\n+\\sqrt{y_0(N_k)},  \\text{if } y_0(N_k) \\ge 0,\\\\\n-\\sqrt{-y_0(N_k)},  \\text{if } y_0(N_k)  0,\n\\end{cases}\n$$\nin THz. Design a false-instability metric based on the pattern of $y_0(N_k)$ across meshes: define a tolerance $\\tau = 10^{-3}\\,\\mathrm{THz}^2$ and declare a false instability if and only if\n$$\n\\left(y_0(N_{k,1})  0\\right)\\ \\wedge\\ \\left(y_0(N_{k,3}) \\ge 0\\right)\\ \\wedge\\ \\left(y_0(N_{k,2}) - y_0(N_{k,1}) \\ge -\\tau\\right)\\ \\wedge\\ \\left(y_0(N_{k,3}) - y_0(N_{k,2}) \\ge -\\tau\\right),\n$$\ni.e., negative at the coarsest mesh, nonnegative at the finest mesh, and nondecreasing within tolerance as $N_k$ increases.\n\nUse the following parameter sets for the three materials (all frequencies in THz, all $G$, $B_0$, $B_0'$, $\\eta_0$ in $\\mathrm{THz}^2$, and $q_0$, $w$ dimensionless):\n- Material 1 (intended to exhibit a false instability at coarse meshes):\n  - $v_s = 5.0$, $\\omega_{\\mathrm{opt}} = 10.0$, $q_0 = 0.30$, $w = 0.06$, $G = 12.0$, $\\alpha = 0.4$, $B_0 = 10.0$, $B_0' = 3.0$, $\\beta = 0.30$, $\\eta_0 = 0.6$, $\\gamma = 1.0$, $\\sigma_0 = 0.02$, $p = 2$.\n- Material 2 (intended to have a true instability persisting as $\\sigma \\to 0$ and $N_k \\to \\infty$):\n  - $v_s = 3.0$, $\\omega_{\\mathrm{opt}} = 8.0$, $q_0 = 0.30$, $w = 0.06$, $G = 12.0$, $\\alpha = 0.5$, $B_0 = 2.0$, $B_0' = 1.0$, $\\beta = 0.50$, $\\eta_0 = 0.4$, $\\gamma = 1.0$, $\\sigma_0 = 0.02$, $p = 2$.\n- Material 3 (intended to be stable with well-behaved convergence):\n  - $v_s = 5.0$, $\\omega_{\\mathrm{opt}} = 12.0$, $q_0 = 0.35$, $w = 0.05$, $G = 6.0$, $\\alpha = 0.3$, $B_0 = 2.0$, $B_0' = 1.0$, $\\beta = 0.50$, $\\eta_0 = 0.3$, $\\gamma = 1.0$, $\\sigma_0 = 0.02$, $p = 2$.\n\nUse the smearing test suite\n$$\n\\{\\sigma_i\\} = \\{0.00,\\,0.005,\\,0.010,\\,0.020,\\,0.040\\}\\ \\mathrm{eV},\n$$\nand the $k$-point meshes\n$$\n\\{N_{k,j}\\} = \\{12,\\,24,\\,48\\}.\n$$\n\nYour program must:\n- For each material, for each $N_k \\in \\{12,24,48\\}$, compute $y(N_k,\\sigma_i)$ on the provided $\\sigma$ set by minimizing over the uniform $q$-grid and both branches.\n- Fit the regression model above to obtain $c(N_k)$ and $A(N_k)$, then compute $y_0(N_k)$ and $\\omega_0(N_k)$.\n- Determine the false-instability boolean according to the specified rule.\n\nPhysical units requirement:\n- Report $\\omega_0(N_{k,3})$ for each material in THz, rounded to three decimal places. The boolean must be a strict boolean indicating the presence of false instability according to the rule.\n\nFinal output format:\n- Produce a single line containing a comma-separated list of three items, one per material. Each item itself must be a two-element list of the form $[\\omega_0(N_{k,3}), \\text{boolean}]$, where the first element is the float in THz rounded to three decimals, and the second is the boolean. For example, the overall output should look like\n$$\n\\big[ [\\omega_0^{(1)}, \\text{True}],\\ [\\omega_0^{(2)}, \\text{False}],\\ [\\omega_0^{(3)}, \\text{False}] \\big].\n$$\n\nYour program must be self-contained, take no input, and follow the specified runtime environment constraints. The output should be exactly one line containing the list described above.", "solution": "The problem requires a systematic convergence study of phonon frequencies for three synthetic metallic materials, based on a simplified model grounded in Density Functional Perturbation Theory (DFPT). The core of the task is to distinguish true physical instabilities (imaginary phonon frequencies) from numerical artifacts arising from coarse Brillouin-zone sampling ($N_k$) and finite electronic smearing ($\\sigma$).\n\nThe solution methodology is implemented in the following sequence of steps for each material:\n1.  For each specified $k$-point mesh size $N_k$ and for each smearing value $\\sigma_i$ in the provided set, we compute the squared phonon frequencies for both the acoustic ($A$) and optical ($O$) branches across a fine grid of wavevectors $q$.\n2.  The minimum squared frequency across both branches and all $q$ points, denoted $y(N_k, \\sigma_i)$, is determined.\n3.  For each fixed $N_k$, the set of calculated points $\\{(\\sigma_i, y(N_k, \\sigma_i))\\}$ is used to perform a regression fit to a physically motivated model. This allows for an extrapolation to the zero-smearing limit, yielding $y_0(N_k)$.\n4.  The convergence behavior of the extrapolated values $y_0(N_k)$ as a function of $N_k$ is analyzed to classify any observed instability as either \"false\" (a numerical artifact) or \"true\" (a persistent physical feature).\n5.  The final, converged minimum frequency at the densest $k$-point mesh, $\\omega_0(N_{k,3})$, and the verdict on false instability are reported.\n\nFirst, we establish the computational grid and the physical model. The one-dimensional Brillouin zone is sampled with a uniform grid of $N_q=201$ points for the reduced coordinate $q \\in [0,1)$. The squared frequencies for the acoustic and optical branches are given by:\n$$\n\\omega_A^2(q; \\sigma, N_k) = \\omega_{0,A}^2(q) + \\Delta \\omega^2(q,\\sigma) + B(N_k,q) + \\eta(N_k,q),\n$$\n$$\n\\omega_O^2(q; \\sigma, N_k) = \\omega_{0,O}^2 + \\alpha\\,\\Delta \\omega^2(q,\\sigma) + \\frac{B_0'}{N_k^\\beta}\\exp\\left(-\\frac{(q-q_0)^2}{2 w^2}\\right),\n$$\nwhere the components are defined as:\n- Bare acoustic squared frequency: $\\omega_{0,A}^2(q) = (v_s |\\sin(\\pi q)|)^2$\n- Bare optical squared frequency: $\\omega_{0,O}^2 = \\omega_{\\mathrm{opt}}^2$\n- Kohn anomaly correction: $\\Delta \\omega^2(q,\\sigma) = -G \\exp\\left(-\\frac{(q-q_0)^2}{2 w^2}\\right) \\cdot \\frac{1}{1 + \\left(\\frac{\\sigma}{\\sigma_0}\\right)^p}$\n- Acoustic branch $k$-point sampling bias: $B(N_k,q) = -\\frac{B_0}{N_k^\\beta}\\exp\\left(-\\frac{(q-q_0)^2}{2 w^2}\\right)$\n- Residual discretization noise: $\\eta(N_k,q) = \\frac{\\eta_0}{N_k^\\gamma} \\sin(2\\pi q)$\n\nFor each material, we iterate through the set of $k$-point meshes $\\{N_{k,j}\\} = \\{12, 24, 48\\}$ and the set of smearing values $\\{\\sigma_i\\} = \\{0.00, 0.005, 0.010, 0.020, 0.040\\}\\,\\mathrm{eV}$. For each pair $(N_k, \\sigma_i)$, we compute $\\omega_A^2(q)$ and $\\omega_O^2(q)$ for all $q$ points. The minimum squared frequency is then found:\n$$\ny(N_k,\\sigma_i) = \\min_{q \\in \\mathbb{Q},\\, \\nu \\in \\{A,O\\}} \\omega_\\nu^2(q; \\sigma_i, N_k).\n$$\nThis provides a dataset of five $(y, \\sigma)$ pairs for each $N_k$.\n\nNext, we extrapolate to the zero-smearing limit. For each fixed $N_k$, we fit the regression model:\n$$\ny(N_k,\\sigma) \\approx c(N_k) - \\frac{A(N_k)}{1 + \\left(\\frac{\\sigma}{\\sigma_0}\\right)^p}.\n$$\nTo facilitate a linear regression, we introduce a predictor variable $X(\\sigma) = \\frac{1}{1 + (\\sigma/\\sigma_0)^p}$. The model becomes $y \\approx c - A \\cdot X$. This is a linear least-squares problem for the coefficients $c$ and $A$. We can write this as minimizing $\\| M\\mathbf{p} - \\mathbf{y} \\|_2^2$, where $\\mathbf{y}$ is the vector of $y(N_k, \\sigma_i)$ values, $\\mathbf{p} = [c(N_k), A(N_k)]^T$ is the vector of parameters, and $M$ is the design matrix with columns representing the constant term ($1$) and the predictor term ($-X_i$). The problem specifies a non-negativity constraint $A(N_k) \\ge 0$. This constrained linear least-squares problem is solved using `scipy.optimize.lsq_linear`, with bounds set to $(-\\infty, \\infty)$ for $c(N_k)$ and $[0, \\infty)$ for $A(N_k)$. After determining the optimal parameters $c(N_k)$ and $A(N_k)$, the extrapolated zero-smearing squared minimum frequency is calculated as:\n$$\ny_0(N_k) = c(N_k) - A(N_k).\n$$\nThis procedure is repeated for each $N_k \\in \\{12, 24, 48\\}$, yielding three values: $y_0(N_{k,1})$, $y_0(N_{k,2})$, and $y_0(N_{k,3})$.\n\nFinally, we apply the false-instability criterion. An instability is flagged as \"false\" if and only if all of a set of four conditions are met, using a tolerance $\\tau = 10^{-3}\\,\\mathrm{THz}^2$:\n1. $y_0(N_{k,1})  0$ (Instability at the coarsest mesh)\n2. $y_0(N_{k,3}) \\ge 0$ (Stability at the finest mesh)\n3. $y_0(N_{k,2}) - y_0(N_{k,1}) \\ge -\\tau$ (Non-decreasing trend from coarsest to medium mesh)\n4. $y_0(N_{k,3}) - y_0(N_{k,2}) \\ge -\\tau$ (Non-decreasing trend from medium to finest mesh)\nA boolean value is determined based on this logical predicate. The final extrapolated frequency for the densest mesh, $\\omega_0(N_{k,3})$, is then computed from $y_0(N_{k,3})$ using the standard convention for imaginary frequencies:\n$$\n\\omega_0(N_k) = \\begin{cases}\n+\\sqrt{y_0(N_k)},  \\text{if } y_0(N_k) \\ge 0,\\\\\n-\\sqrt{-y_0(N_k)},  \\text{if } y_0(N_k)  0.\n\\end{cases}\n$$\nThe value of $\\omega_0(N_{k,3})$ is rounded to three decimal places, and this floating-point number, along with the false-instability boolean, constitutes the final result for each material.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import lsq_linear\n\ndef solve():\n    \"\"\"\n    Performs a convergence study of phonon frequencies for three synthetic materials,\n    extrapolates to zero smearing, and identifies false instabilities.\n    \"\"\"\n\n    # Define the material parameters as test cases\n    test_cases = [\n        # Material 1 (intended to exhibit a false instability)\n        {\n            \"name\": \"Material 1\",\n            \"params\": {\n                \"v_s\": 5.0, \"omega_opt\": 10.0, \"q0\": 0.30, \"w\": 0.06, \"G\": 12.0, \"alpha\": 0.4,\n                \"B0\": 10.0, \"B0_prime\": 3.0, \"beta\": 0.30, \"eta0\": 0.6, \"gamma\": 1.0,\n                \"sigma0\": 0.02, \"p\": 2.0\n            }\n        },\n        # Material 2 (intended to have a true instability)\n        {\n            \"name\": \"Material 2\",\n            \"params\": {\n                \"v_s\": 3.0, \"omega_opt\": 8.0, \"q0\": 0.30, \"w\": 0.06, \"G\": 12.0, \"alpha\": 0.5,\n                \"B0\": 2.0, \"B0_prime\": 1.0, \"beta\": 0.50, \"eta0\": 0.4, \"gamma\": 1.0,\n                \"sigma0\": 0.02, \"p\": 2.0\n            }\n        },\n        # Material 3 (intended to be stable)\n        {\n            \"name\": \"Material 3\",\n            \"params\": {\n                \"v_s\": 5.0, \"omega_opt\": 12.0, \"q0\": 0.35, \"w\": 0.05, \"G\": 6.0, \"alpha\": 0.3,\n                \"B0\": 2.0, \"B0_prime\": 1.0, \"beta\": 0.50, \"eta0\": 0.3, \"gamma\": 1.0,\n                \"sigma0\": 0.02, \"p\": 2.0\n            }\n        }\n    ]\n\n    # Computational parameters\n    Nq = 201\n    q_grid = np.linspace(0, 1, Nq, endpoint=False)\n    sigma_values = np.array([0.00, 0.005, 0.010, 0.020, 0.040])\n    Nk_values = np.array([12, 24, 48])\n    tau = 1e-3\n\n    final_results = []\n\n    for case in test_cases:\n        params = case[\"params\"]\n        y0_by_Nk = {}\n\n        for Nk in Nk_values:\n            y_data = []\n            \n            for sigma in sigma_values:\n                # Calculate all components of the squared frequencies\n                omega_0A_sq = (params[\"v_s\"] * np.abs(np.sin(np.pi * q_grid)))**2\n                omega_0O_sq = params[\"omega_opt\"]**2\n                \n                common_gaussian = np.exp(-(q_grid - params[\"q0\"])**2 / (2 * params[\"w\"]**2))\n                \n                # Handle sigma=0 to avoid division by zero in case of p=0 though p=2 here\n                if sigma == 0:\n                    delta_omega_sq_term = 1.0\n                else:\n                    delta_omega_sq_term = 1.0 / (1.0 + (sigma / params[\"sigma0\"])**params[\"p\"])\n                \n                delta_omega_sq = -params[\"G\"] * common_gaussian * delta_omega_sq_term\n                \n                B_Nk_q = -params[\"B0\"] / (Nk**params[\"beta\"]) * common_gaussian\n                eta_Nk_q = params[\"eta0\"] / (Nk**params[\"gamma\"]) * np.sin(2 * np.pi * q_grid)\n                \n                B_prime_term = params[\"B0_prime\"] / (Nk**params[\"beta\"]) * common_gaussian\n\n                # Calculate total squared frequencies for both branches\n                omega_A_sq = omega_0A_sq + delta_omega_sq + B_Nk_q + eta_Nk_q\n                omega_O_sq = omega_0O_sq + params[\"alpha\"] * delta_omega_sq + B_prime_term\n\n                # Find the minimum squared frequency for this (Nk, sigma)\n                y_Nk_sigma = np.min(np.concatenate((omega_A_sq, omega_O_sq)))\n                y_data.append(y_Nk_sigma)\n\n            # Perform the regression to find y0(Nk)\n            X = 1.0 / (1.0 + (sigma_values / params[\"sigma0\"])**params[\"p\"])\n            M = np.vstack([np.ones_like(X), -X]).T\n            \n            fit_result = lsq_linear(M, np.array(y_data), bounds=([-np.inf, 0], [np.inf, np.inf]))\n            c_Nk, A_Nk = fit_result.x\n            \n            y0_Nk = c_Nk - A_Nk\n            y0_by_Nk[Nk] = y0_Nk\n\n        # Analyze for false instability\n        y0_vals = [y0_by_Nk[Nk] for Nk in Nk_values]\n        \n        is_false_instability = (\n            y0_vals[0]  0 and\n            y0_vals[2] = 0 and\n            (y0_vals[1] - y0_vals[0]) = -tau and\n            (y0_vals[2] - y0_vals[1]) = -tau\n        )\n\n        # Calculate final frequency omega_0(N_k=48)\n        y0_final = y0_vals[2]\n        if y0_final = 0:\n            omega0_final = np.sqrt(y0_final)\n        else:\n            omega0_final = -np.sqrt(-y0_final)\n\n        # Store rounded final frequency and boolean\n        final_results.append([round(omega0_final, 3), is_false_instability])\n\n    print(final_results)\n\nsolve()\n```", "id": "3460717"}]}