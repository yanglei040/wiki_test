{"hands_on_practices": [{"introduction": "A cornerstone of any micromagnetic simulation is the translation of continuous physical interactions into discrete operators that can act on a computational grid. The exchange interaction, which penalizes sharp changes in magnetization, is a fundamental component of the effective field. This exercise [@problem_id:3460200] guides you through the process of deriving the discrete exchange field from its continuous energy functional using a variational approach, a technique central to computational physics. Mastering this practice is crucial for building the spatial components of a Landau-Lifshitz-Gilbert solver and correctly implementing boundary conditions.", "problem": "Consider a ferromagnetic cuboid discretized on a uniform, cell-centered, cubic finite-difference grid with cell size $\\Delta$ along each Cartesian direction. The magnetization field $\\mathbf{m}(\\mathbf{r},t)$ is a unit vector field. The micromagnetic exchange energy density is given by $A \\, |\\nabla \\mathbf{m}|^{2}$, where $A$ is the exchange stiffness. In the Landau–Lifshitz–Gilbert dynamics, the corresponding exchange effective field is obtained from the variational derivative of the exchange energy with respect to $\\mathbf{m}$.\n\nStarting from the exchange energy functional and using only standard finite-volume or finite-difference approximations on the aforementioned grid, derive a discrete exchange field operator that is proportional to a discrete Laplacian acting component-wise on $\\mathbf{m}$. Impose the zero normal derivative boundary condition $\\partial_{n} \\mathbf{m} = 0$ on the boundary of the cuboid. Your derivation should:\n- Begin from the exchange energy integral and a consistent discrete approximation of this integral on the grid.\n- Use a variational argument to obtain the discrete operator that plays the role of the Laplacian.\n- Explain how the zero normal derivative boundary condition is incorporated at boundary cells, and why this implementation is consistent with the variational derivation.\n\nFinally, consider a boundary cell that lies on the planar boundary with outward unit normal along the negative $x$-direction (i.e., the face at $x=0$ so that this cell has no $-x$ neighbor). For one Cartesian component of $\\mathbf{m}$, write the seven-point finite-difference stencil coefficients of the discrete Laplacian at this boundary cell, listing the coefficients in the order $[\\text{center}, +x, -x, +y, -y, +z, -z]$. Express your final answer in terms of $\\Delta$ as a single row vector. No numerical evaluation is required.", "solution": "The problem requires the derivation of a discrete exchange field operator on a finite-difference grid, starting from the continuous exchange energy functional. The derivation must employ a variational argument and incorporate zero normal derivative boundary conditions. Finally, the specific stencil coefficients for the resulting discrete Laplacian operator at a boundary cell must be determined.\n\nThe continuous exchange energy functional for a ferromagnetic body occupying a volume $V$ is given by:\n$$E_{ex} = \\int_V A |\\nabla \\mathbf{m}|^2 dV$$\nwhere $A$ is the exchange stiffness constant and $\\mathbf{m} = (m_x, m_y, m_z)$ is the normalized magnetization vector field, i.e., $|\\mathbf{m}| = 1$. The term $|\\nabla \\mathbf{m}|^2$ is a shorthand for the sum of the squared gradients of each component:\n$$|\\nabla \\mathbf{m}|^2 = |\\nabla m_x|^2 + |\\nabla m_y|^2 + |\\nabla m_z|^2 = \\sum_{\\alpha \\in \\{x,y,z\\}} \\left( \\left(\\frac{\\partial m_\\alpha}{\\partial x}\\right)^2 + \\left(\\frac{\\partial m_\\alpha}{\\partial y}\\right)^2 + \\left(\\frac{\\partial m_\\alpha}{\\partial z}\\right)^2 \\right)$$\n\nTo discretize this energy on a uniform cubic grid with cell size $\\Delta$, we can approximate the integral as a sum over all cells. However, a more robust method for derivative-based energies is to discretize the energy contributions associated with the links between adjacent cells. We approximate the spatial derivative on a link connecting two adjacent cells and sum the energy density over the volume. For instance, the term $\\int (\\frac{\\partial m_\\alpha}{\\partial x})^2 dV$ can be discretized by considering the derivative between cells $(i,j,k)$ and $(i+1,j,k)$. The derivative is approximated as $\\frac{m_{\\alpha,i+1,j,k} - m_{\\alpha,i,j,k}}{\\Delta}$. The energy density is $(\\frac{m_{\\alpha,i+1,j,k} - m_{\\alpha,i,j,k}}{\\Delta})^2$. Associating this energy with a volume element of $\\Delta^3$ (e.g., a volume centered on the face between the cells), the energy contribution is $A (\\frac{m_{\\alpha,i+1,j,k} - m_{\\alpha,i,j,k}}{\\Delta})^2 \\Delta^3 = A \\Delta (m_{\\alpha,i+1,j,k} - m_{\\alpha,i,j,k})^2$.\n\nSumming over all nearest-neighbor links in the grid, the total discrete exchange energy $E_{ex}^{disc}$ can be written as:\n$$E_{ex}^{disc} = A \\Delta \\sum_{\\langle p, p' \\rangle} |\\mathbf{m}_p - \\mathbf{m}_{p'}|^2$$\nwhere the sum is over all unique nearest-neighbor pairs of cells $\\langle p, p' \\rangle$ in the grid. An equivalent way to write this to avoid double counting is to sum over each cell $p = (i,j,k)$ and its neighbors in the positive-axis directions:\n$$E_{ex}^{disc} = A \\Delta \\sum_{i,j,k} \\left( |\\mathbf{m}_{i+1,j,k} - \\mathbf{m}_{i,j,k}|^2 + |\\mathbf{m}_{i,j+1,k} - \\mathbf{m}_{i,j,k}|^2 + |\\mathbf{m}_{i,j,k+1} - \\mathbf{m}_{i,j,k}|^2 \\right)$$\nwhere $|\\mathbf{v}|^2 = v_x^2 + v_y^2 + v_z^2$.\n\nThe exchange effective field $\\mathbf{H}_{ex}$ is derived from the variational derivative of the energy. In the discrete case, the field at cell $p$ is proportional to $-\\frac{\\partial E_{ex}^{disc}}{\\partial \\mathbf{m}_p}$. We seek an operator that is proportional to this derivative. Let's compute one component of this derivative, for an arbitrary component $\\alpha \\in \\{x,y,z\\}$ at an interior cell $p_0 = (i,j,k)$.\n$$\\frac{\\partial E_{ex}^{disc}}{\\partial m_{\\alpha,p_0}} = \\frac{\\partial}{\\partial m_{\\alpha,i,j,k}} E_{ex}^{disc}$$\nThe terms in $E_{ex}^{disc}$ that depend on $\\mathbf{m}_{i,j,k}$ are those connecting cell $(i,j,k)$ to its six nearest neighbors: $(i\\pm 1,j,k)$, $(i,j\\pm 1,k)$, and $(i,j,k\\pm 1)$. Let's denote $\\mathbf{m}_{i,j,k}$ as $\\mathbf{m}_0$ and its neighbors as $\\mathbf{m}_{\\pm x}, \\mathbf{m}_{\\pm y}, \\mathbf{m}_{\\pm z}$. The relevant part of the energy is:\n$$E_{rel} = A \\Delta \\left( |\\mathbf{m}_{+x}-\\mathbf{m}_0|^2 + |\\mathbf{m}_0-\\mathbf{m}_{-x}|^2 + |\\mathbf{m}_{+y}-\\mathbf{m}_0|^2 + |\\mathbf{m}_0-\\mathbf{m}_{-y}|^2 + |\\mathbf{m}_{+z}-\\mathbf{m}_0|^2 + |\\mathbf{m}_0-\\mathbf{m}_{-z}|^2 \\right)$$\nThe derivative with respect to $m_{\\alpha,0}$ is:\n$$\\frac{\\partial E_{rel}}{\\partial m_{\\alpha,0}} = A \\Delta \\left( -2(m_{\\alpha,+x}-m_{\\alpha,0}) + 2(m_{\\alpha,0}-m_{\\alpha,-x}) -2(m_{\\alpha,+y}-m_{\\alpha,0}) + 2(m_{\\alpha,0}-m_{\\alpha,-y}) -2(m_{\\alpha,+z}-m_{\\alpha,0}) + 2(m_{\\alpha,0}-m_{\\alpha,-z}) \\right)$$\nCollecting terms for $m_{\\alpha,0}$:\n$$\\frac{\\partial E_{rel}}{\\partial m_{\\alpha,0}} = 2A\\Delta \\left( 6m_{\\alpha,0} - (m_{\\alpha,+x} + m_{\\alpha,-x} + m_{\\alpha,+y} + m_{\\alpha,-y} + m_{\\alpha,+z} + m_{\\alpha,-z}) \\right)$$\nThe standard seven-point finite-difference approximation of the Laplacian operator $\\nabla^2$ acting on a scalar field $f$ is:\n$$(\\nabla_d^2 f)_i = \\frac{f_{i+1,j,k} + f_{i-1,j,k} + f_{i,j+1,k} + f_{i,j-1,k} + f_{i,j,k+1} + f_{i,j,k-1} - 6f_{i,j,k}}{\\Delta^2}$$\nComparing this with our derivative, we find:\n$$\\frac{\\partial E_{ex}^{disc}}{\\partial m_{\\alpha,i,j,k}} = -2A\\Delta \\Delta^2 (\\nabla_d^2 m_\\alpha)_{i,j,k} = -2A\\Delta^3 (\\nabla_d^2 m_\\alpha)_{i,j,k}$$\nThe effective field operator at cell $p$ is therefore proportional to $-\\frac{\\partial E_{ex}^{disc}}{\\partial \\mathbf{m}_p}$, which is proportional to $2A\\Delta^3 \\nabla_d^2 \\mathbf{m}_p$. Thus, the discrete exchange field operator is proportional to the discrete Laplacian acting component-wise on $\\mathbf{m}$.\n\nNext, we incorporate the boundary condition $\\partial_n \\mathbf{m} = 0$, where $\\partial_n$ is the derivative along the outward normal. This is a natural boundary condition for the exchange energy minimization, as seen from the variation of the continuous functional:\n$$\\delta E_{ex} = 2A \\int_V (\\nabla \\mathbf{m}) \\cdot (\\nabla \\delta \\mathbf{m}) dV = \\int_S 2A (\\delta\\mathbf{m}) \\cdot (\\partial_n \\mathbf{m}) dS - \\int_V 2A (\\delta\\mathbf{m}) \\cdot (\\nabla^2 \\mathbf{m}) dV$$\nFor the volume integral to define the effective field, the surface integral must vanish. This occurs if $\\delta\\mathbf{m}=0$ on the boundary (fixed BC) or if $\\partial_n \\mathbf{m} = 0$ (free BC). The problem imposes the latter.\nIn the discrete model, this condition is implemented using ghost cells. Consider a boundary cell at the $x=0$ face. Its outward normal is $\\mathbf{n}=-\\hat{x}$. The boundary condition is $-\\frac{\\partial \\mathbf{m}}{\\partial x} = 0$, or simply $\\frac{\\partial \\mathbf{m}}{\\partial x} = 0$. Let the boundary cell be indexed by $(0,j,k)$. The general Laplacian expression for this cell requires the value at the non-existent neighbor $(-1,j,k)$, which is a ghost cell. We use the boundary condition to define the value in this ghost cell. Approximating the derivative at the boundary face (between cells $0$ and $-1$) with a central difference:\n$$\\frac{\\mathbf{m}_{0,j,k} - \\mathbf{m}_{-1,j,k}}{\\Delta} = 0 \\quad \\implies \\quad \\mathbf{m}_{-1,j,k} = \\mathbf{m}_{0,j,k}$$\nThis means the magnetization in the ghost cell is set equal to the magnetization in the adjacent boundary cell. This is consistent with the variational derivation because the energy contribution from the link between cell $(0,j,k)$ and the ghost cell $(-1,j,k)$, which would be $A\\Delta|\\mathbf{m}_{0,j,k} - \\mathbf{m}_{-1,j,k}|^2$, is zero. This corresponds to no exchange torque from outside the boundary.\n\nFinally, we find the stencil coefficients of the discrete Laplacian operator $\\nabla_d^2$ at this boundary cell $(0,j,k)$. We use the general expression for the Laplacian and substitute the ghost cell value. For any component $m_\\alpha$, which we will denote by $m$:\n$$(\\nabla_d^2 m)_{0,j,k} = \\frac{m_{1,j,k} + m_{-1,j,k} + m_{0,j+1,k} + m_{0,j-1,k} + m_{0,j,k+1} + m_{0,j,k-1} - 6m_{0,j,k}}{\\Delta^2}$$\nSubstituting $m_{-1,j,k} = m_{0,j,k}$:\n$$(\\nabla_d^2 m)_{0,j,k} = \\frac{m_{1,j,k} + m_{0,j,k} + m_{0,j+1,k} + m_{0,j-1,k} + m_{0,j,k+1} + m_{0,j,k-1} - 6m_{0,j,k}}{\\Delta^2}$$\nCollecting terms:\n$$(\\nabla_d^2 m)_{0,j,k} = \\frac{-5 m_{0,j,k} + m_{1,j,k} + m_{0,j+1,k} + m_{0,j-1,k} + m_{0,j,k+1} + m_{0,j,k-1}}{\\Delta^2}$$\nThe operator is a linear combination of the values at the center cell and its real neighbors. The coefficients for the seven-point stencil in the order $[\\text{center}, +x, -x, +y, -y, +z, -z]$ are the multipliers of $m_{0,j,k}$, $m_{1,j,k}$, $m_{-1,j,k}$ (which is not a real cell), $m_{0,j+1,k}$, etc.\nThe coefficient for the center cell $(0,j,k)$ is $\\frac{-5}{\\Delta^2}$.\nThe coefficient for the $+x$ neighbor $(1,j,k)$ is $\\frac{1}{\\Delta^2}$.\nThe coefficient for the $-x$ neighbor is $0$, as this position is outside the computational domain.\nThe coefficients for the $\\pm y$ and $\\pm z$ neighbors are all $\\frac{1}{\\Delta^2}$.\n\nThe final vector of coefficients is:\n$$ \\left[ \\frac{-5}{\\Delta^2}, \\frac{1}{\\Delta^2}, 0, \\frac{1}{\\Delta^2}, \\frac{1}{\\Delta^2}, \\frac{1}{\\Delta^2}, \\frac{1}{\\Delta^2} \\right] $$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{-5}{\\Delta^2}  \\frac{1}{\\Delta^2}  0  \\frac{1}{\\Delta^2}  \\frac{1}{\\Delta^2}  \\frac{1}{\\Delta^2}  \\frac{1}{\\Delta^2}\n\\end{pmatrix}\n}\n$$", "id": "3460200"}, {"introduction": "Once the effective field is discretized, the next challenge is to numerically integrate the Landau-Lifshitz-Gilbert (LLG) equation itself. The strong, short-range nature of the exchange interaction introduces high-frequency modes that make the system of equations numerically \"stiff,\" posing a significant challenge for standard explicit solvers. This practice [@problem_id:3460188] delves into the numerical analysis of different time integration schemes, comparing their stability when applied to the stiff, exchange-dominated LLG dynamics. Understanding these stability limits is key to selecting an appropriate and efficient integrator for your simulations.", "problem": "Consider the Landau-Lifshitz-Gilbert (LLG) equation for the unit magnetization vector $\\mathbf{m}(\\mathbf{r},t)$,\n$$\n\\frac{\\partial \\mathbf{m}}{\\partial t} = -\\gamma \\, \\mathbf{m} \\times \\mathbf{B}_{\\mathrm{eff}} + \\alpha \\, \\mathbf{m} \\times \\frac{\\partial \\mathbf{m}}{\\partial t},\n$$\nwhere $\\gamma$ is the gyromagnetic ratio, $\\alpha$ is the Gilbert damping parameter, and $\\mathbf{B}_{\\mathrm{eff}}$ is the effective field. Assume the effective field is dominated by the exchange contribution\n$$\n\\mathbf{B}_{\\mathrm{ex}} = \\frac{2A}{M_s} \\, \\nabla^2 \\mathbf{m},\n$$\nwith exchange stiffness $A$ and saturation magnetization $M_s$. Consider a small transverse perturbation $\\delta \\mathbf{m}_\\perp(\\mathbf{r},t)$ around a uniform equilibrium $\\mathbf{m}_0 = \\hat{\\mathbf{z}}$, decomposed into a single Fourier mode with wavenumber magnitude $k$, so that $\\nabla^2 \\delta \\mathbf{m}_\\perp = -k^2 \\delta \\mathbf{m}_\\perp$.\n\nUnder these conditions, the linearized dynamics of the transverse perturbation can be represented as a two-dimensional system with eigenvalues of the form\n$$\n\\lambda_k = -\\alpha \\, \\omega_k \\pm i \\, \\omega_k, \\quad \\text{where} \\quad \\omega_k = \\gamma \\, \\frac{2A}{M_s} \\, k^2.\n$$\nYou will compare three time integration schemes applied to this linearized system: explicit Heun (also known as improved Euler), implicit backward Euler, and a semi-implicit Implicit-Explicit (IMEX) scheme that treats the exchange contribution implicitly in both the precessional and damping torques, while treating all non-exchange contributions explicitly.\n\nLet $z_k = \\lambda_k \\Delta t$ denote the dimensionless step parameter associated with the stiff exchange-dominated mode, with $\\Delta t$ the time step. For the explicit Heun method applied to $y' = \\lambda y$, the one-step amplification factor is\n$$\nR_{\\mathrm{Heun}}(z) = 1 + z + \\tfrac{1}{2} z^2.\n$$\nFor the backward Euler method, the amplification factor is\n$$\nR_{\\mathrm{BE}}(z) = \\frac{1}{1 - z}.\n$$\nFor the semi-implicit IMEX scheme described above, the exchange part contributes an implicit factor of the form $1/(1 - z_{\\mathrm{ex}})$ with $z_{\\mathrm{ex}}$ the portion of $z$ arising from the exchange field, while explicit non-exchange contributions enter via an explicit factor analogous to $1 + z_{\\mathrm{oth}} + \\tfrac{1}{2}z_{\\mathrm{oth}}^2$; in the exchange-dominated limit, $z \\approx z_{\\mathrm{ex}}$.\n\nWhich of the following statements correctly compare the stability limits on $\\Delta t$ for large exchange fields (large $k$) and significant damping $\\alpha$ in this exchange-dominated regime?\n\nA. For explicit Heun, stability requires $\\omega_k \\Delta t \\lesssim \\mathcal{O}(1)$; the maximum stable $\\Delta t$ scales inversely with the largest exchange frequency $\\omega_k$ and remains strongly limited by $k^2$, even if $\\alpha$ is large.\n\nB. For implicit backward Euler, the method is unconditionally stable for all $\\Delta t$ whenever $\\mathrm{Re}(z_k)  0$; thus, in the exchange-dominated regime with $\\alpha  0$, stability does not impose any restriction on $\\Delta t$ from $\\omega_k$ or $\\alpha$.\n\nC. For the semi-implicit scheme that treats exchange implicitly within both precessional and damping torques, the stability bound on $\\Delta t$ becomes independent of $\\omega_k$ (i.e., no restriction tied to $k^2$), and any remaining stability limits arise only from explicitly treated non-exchange contributions; increasing $\\alpha$ further relaxes those limits by suppressing precession.\n\nD. In the limit of large exchange and large damping, all three schemes permit arbitrarily large $\\Delta t$ without any stability penalty because the dynamics are overdamped.\n\nSelect all correct options.", "solution": "The user wants me to validate the problem statement and, if valid, solve the problem by analyzing the stability of three numerical integration schemes for the Landau-Lifshitz-Gilbert (LLG) equation in an exchange-dominated regime.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n*   Landau-Lifshitz-Gilbert (LLG) equation: $\\frac{\\partial \\mathbf{m}}{\\partial t} = -\\gamma \\, \\mathbf{m} \\times \\mathbf{B}_{\\mathrm{eff}} + \\alpha \\, \\mathbf{m} \\times \\frac{\\partial \\mathbf{m}}{\\partial t}$.\n*   $\\mathbf{m}(\\mathbf{r},t)$: unit magnetization vector.\n*   $\\gamma$: gyromagnetic ratio.\n*   $\\alpha$: Gilbert damping parameter.\n*   $\\mathbf{B}_{\\mathrm{eff}}$: effective field.\n*   Dominant exchange field: $\\mathbf{B}_{\\mathrm{ex}} = \\frac{2A}{M_s} \\, \\nabla^2 \\mathbf{m}$.\n*   $A$: exchange stiffness.\n*   $M_s$: saturation magnetization.\n*   Equilibrium state: $\\mathbf{m}_0 = \\hat{\\mathbf{z}}$.\n*   Perturbation: A single Fourier mode $\\delta \\mathbf{m}_\\perp(\\mathbf{r},t)$ with wavenumber magnitude $k$, for which $\\nabla^2 \\delta \\mathbf{m}_\\perp = -k^2 \\delta \\mathbf{m}_\\perp$.\n*   Eigenvalues of the linearized system: $\\lambda_k = -\\alpha \\, \\omega_k \\pm i \\, \\omega_k$, where $\\omega_k = \\gamma \\, \\frac{2A}{M_s} \\, k^2$.\n*   Dimensionless step parameter: $z_k = \\lambda_k \\Delta t$.\n*   Amplification factor for explicit Heun method: $R_{\\mathrm{Heun}}(z) = 1 + z + \\tfrac{1}{2} z^2$.\n*   Amplification factor for backward Euler method: $R_{\\mathrm{BE}}(z) = \\frac{1}{1 - z}$.\n*   Description of a semi-implicit IMEX scheme: Exchange contribution is treated implicitly, with implicit factor form $1/(1 - z_{\\mathrm{ex}})$; non-exchange contributions are treated explicitly. In the exchange-dominated limit, $z \\approx z_{\\mathrm{ex}}$.\n*   Question: Compare stability limits on $\\Delta t$ for large exchange fields (large $k$) and significant damping $\\alpha$.\n\n**Step 2: Validate Using Extracted Givens**\n\n*   **Scientifically Grounded:** The problem is based on the LLG equation, a cornerstone of micromagnetism. The expression for the exchange field is standard. The method of linearizing the equation to study spin wave dynamics (magnons) is a fundamental technique in the field. The expressions for the amplification factors of the numerical schemes are correct. A meticulous derivation of the linearized eigenvalues from the Gilbert form of the LLG equation yields $\\lambda_k = \\frac{\\omega_k}{1+\\alpha^2}(-\\alpha \\pm i)$. The problem statement provides $\\lambda_k = \\omega_k(-\\alpha \\pm i)$, which omits the $1/(1+\\alpha^2)$ factor. This is a common simplification, valid for small $\\alpha$, but less accurate for the \"significant damping\" mentioned. However, the problem is mathematically self-contained because it explicitly *defines* the eigenvalues to be used for the analysis. The core of the task is to analyze the stability of numerical methods given this specific eigenvalue structure, which is a well-defined problem in numerical analysis inspired by a physical system. The simplification does not alter the fundamental properties required for the stability analysis (i.e., the location of eigenvalues in the left-half of the complex plane and their scaling with $k^2$).\n*   **Well-Posed:** The problem is well-posed. It asks for a comparison of stability limits based on provided amplification factors and a defined eigenvalue spectrum. A unique, stable, and meaningful analysis can be performed.\n*   **Objective:** The problem is stated in precise, objective, and technical language, free from subjectivity.\n*   **Completeness and Consistency:** The problem provides all necessary information (equations, definitions, and amplification factors) to perform the required analysis. There are no internal contradictions.\n*   **Realism and Feasibility:** The scenario describes a standard problem in computational materials science: the numerical integration of the LLG equation and the challenge posed by the stiff exchange term. The methods discussed are widely used in practice.\n*   **Other Flaws:** The problem is not ill-posed, trivial, or unverifiable.\n\n**Step 3: Verdict and Action**\n\nThe problem statement is **valid**. Although there is a minor simplification in the provided eigenvalue formula compared to a rigorous derivation from the LLG equation, the problem is presented as a self-contained numerical analysis task based on the given eigenvalues. This does not impede a rigorous and correct solution to the question as posed. I will proceed with the solution.\n\n### Derivation and Option Analysis\n\nThe stability of a time integration scheme for the linear ordinary differential equation $y' = \\lambda y$ is determined by its one-step amplification factor, $R(z)$, where $z = \\lambda \\Delta t$. The scheme is stable if $|R(z)| \\le 1$. We are asked to analyze this condition for three different schemes in the exchange-dominated limit, where the eigenvalues are given by $\\lambda_k = -\\alpha \\omega_k \\pm i \\omega_k$, with $\\omega_k \\propto k^2$. The dimensionless parameter is $z_k = \\lambda_k \\Delta t = \\omega_k \\Delta t (-\\alpha \\pm i)$. We are interested in the case of large $k$, which implies large $\\omega_k$.\n\n**A. Evaluation of the Explicit Heun scheme**\n\nThe amplification factor is $R_{\\mathrm{Heun}}(z) = 1 + z + \\frac{1}{2}z^2$. Any explicit numerical method, including the Heun method, has a stability region that is a bounded set in the complex plane, symmetric around the real axis and containing the origin $z=0$. For the scheme to be stable, the value $z_k = \\lambda_k \\Delta t$ must lie within this region for all relevant modes $k$.\n\nFor large $k$, $\\omega_k$ becomes very large. The magnitude of $z_k$ is $|z_k| = |\\omega_k \\Delta t (-\\alpha \\pm i)| = \\omega_k \\Delta t \\sqrt{\\alpha^2 + 1}$. For $z_k$ to remain inside a bounded stability region as $\\omega_k \\to \\infty$, the time step $\\Delta t$ must necessarily approach zero. Specifically, the stability condition takes the form $\\omega_k \\Delta t \\le C$, where $C$ is some constant that depends on the shape of the stability region and the parameter $\\alpha$. This implies that the maximum stable time step scales as $\\Delta t \\lesssim C / \\omega_k$. Since $\\omega_k \\propto k^2$, we have a severe restriction $\\Delta t \\lesssim \\mathcal{O}(1/k^2)$. Increasing $\\alpha$ for a fixed $\\omega_k \\Delta t$ increases the magnitude $|z_k|$, which tends to push $z_k$ out of the stability region, thus requiring an even smaller $\\Delta t$. Therefore, the stability is strongly limited by the exchange frequency, and this limitation is not removed by large damping. The statement that stability requires $\\omega_k \\Delta t \\lesssim \\mathcal{O}(1)$ and that $\\Delta t$ remains strongly limited by $k^2$ is correct.\n\n**Verdict for A: Correct.**\n\n**B. Evaluation of the Implicit Backward Euler scheme**\n\nThe amplification factor is $R_{\\mathrm{BE}}(z) = \\frac{1}{1-z}$. The stability condition is $|R_{\\mathrm{BE}}(z)| \\le 1$, which is equivalent to $|\\frac{1}{1-z}| \\le 1$, or $|1-z| \\ge 1$. This inequality describes the set of all complex numbers $z$ that lie on or outside the circle of radius $1$ centered at $(1,0)$. This region includes the entire closed left-half plane, $\\{z \\in \\mathbb{C} \\mid \\mathrm{Re}(z) \\le 0\\}$. A method with this property is called A-stable.\n\nLet's examine our parameter $z_k = \\lambda_k \\Delta t$. Its real part is $\\mathrm{Re}(z_k) = \\mathrm{Re}((-\\alpha \\omega_k \\pm i \\omega_k)\\Delta t) = -\\alpha \\omega_k \\Delta t$. Since the damping parameter $\\alpha>0$, the frequency $\\omega_k \\ge 0$, and the time step $\\Delta t>0$, we have $\\mathrm{Re}(z_k) \\le 0$ for all modes. As a result, $z_k$ always lies within the stability region of the backward Euler method, regardless of the size of $\\Delta t$, $\\omega_k$, or $\\alpha$. This means the method is unconditionally stable for this problem. The stability of the scheme does not impose any restriction on $\\Delta t$ related to the exchange term.\n\n**Verdict for B: Correct.**\n\n**C. Evaluation of the Semi-Implicit (IMEX) scheme**\n\nThe strategy of an IMEX scheme is to treat stiff terms implicitly and non-stiff terms explicitly. In micromagnetics, the exchange interaction is the archetypal stiff term, as its associated frequency $\\omega_k$ scales with $k^2$. By treating the exchange contribution implicitly (using a method like backward Euler, as suggested by the factor $1/(1-z_{\\mathrm{ex}})$), the unconditional stability property of the implicit solver is leveraged for the stiff part of the problem. As established in the analysis of B, this implicit treatment is stable for any $\\Delta t$, regardless of the magnitude of $\\omega_k$. Consequently, the severe stability constraint $\\Delta t \\propto 1/k^2$ is eliminated.\n\nThe overall stability of the IMEX scheme is then limited by the explicit treatment of the remaining, non-stiff contributions to the effective field (e.g., anisotropy, demagnetization, external fields). These terms typically have much smaller characteristic frequencies than the exchange term for finely discretized models. Therefore, the stability bound on $\\Delta t$ becomes independent of the exchange frequency $\\omega_k$, but it still depends on the explicit part of the update. The final part of the statement, \"increasing $\\alpha$ further relaxes those limits by suppressing precession\", is also physically reasonable. A larger global damping parameter $\\alpha$ increases the dissipative nature of the dynamics for all modes, including those treated explicitly. For many explicit schemes, having a larger negative real part for the eigenvalue $z = \\lambda \\Delta t$ can expand the stable range of $\\Delta t$.\n\n**Verdict for C: Correct.**\n\n**D. Evaluation of the statement for all three schemes**\n\nThis statement claims that in the limit of large exchange and large damping, all three schemes permit arbitrarily large $\\Delta t$. This is false. As shown in the analysis of option A, the explicit Heun method has a bounded stability region, which imposes a strict upper limit on $\\Delta t$ that scales as $\\Delta t \\propto 1/k^2$. This restriction becomes more, not less, severe for large exchange fields. Therefore, the statement is incorrect for the Heun scheme, and thus incorrect as a general statement for all three. While backward Euler is unconditionally stable, and the IMEX scheme's stability is independent of the exchange term, the explicit Heun scheme remains conditionally stable.\n\n**Verdict for D: Incorrect.**", "answer": "$$\\boxed{ABC}$$", "id": "3460188"}, {"introduction": "Beyond basic stability, a high-quality integrator for the LLG equation should also respect the underlying geometry of the dynamics, where the magnetization vector's length must be conserved. Generic schemes like Runge-Kutta often fail this, accumulating numerical errors over time. This final hands-on practice [@problem_id:3460197] takes you from theory to code by having you implement a sophisticated geometric integrator based on operator splitting. By treating the precession and damping dynamics separately and exactly, you will build a method that is not only stable but also significantly more accurate for simulating oscillatory phenomena like ferromagnetic resonance.", "problem": "Implement a numerical integrator for the Landau–Lifshitz–Gilbert spin dynamics that uses operator splitting to treat the precession analytically and the damping implicitly, and compare its phase accuracy against a standard explicit scheme in a ferromagnetic resonance (FMR) ring-down setting. Work with a single-domain macrospin of unit norm. Use the following fundamental base to derive your method.\n\nBase equations and definitions:\n- The Gilbert form of the Landau–Lifshitz–Gilbert equation for the unit magnetization vector $\\mathbf{m}(t)\\in\\mathbb{R}^3$ in a constant effective magnetic field $\\mathbf{B}\\in\\mathbb{R}^3$ is\n$$\n(1+\\alpha^2)\\,\\frac{d\\mathbf{m}}{dt} \\;=\\; -\\gamma\\,\\mathbf{m}\\times \\mathbf{B} \\;-\\; \\alpha\\,\\gamma\\,\\mathbf{m}\\times(\\mathbf{m}\\times \\mathbf{B}),\n$$\nwhere $\\gamma$ is the gyromagnetic ratio in $\\mathrm{rad\\,s^{-1}\\,T^{-1}}$, $\\alpha\\ge 0$ is the dimensionless damping, $\\times$ denotes the vector cross product, and $\\|\\mathbf{m}\\|=1$ for all $t$.\n- Define $\\gamma'=\\gamma/(1+\\alpha^2)$ so that the equation can be written as a sum of two vector fields,\n$$\n\\frac{d\\mathbf{m}}{dt} \\;=\\; \\underbrace{-\\gamma'\\,\\mathbf{m}\\times\\mathbf{B}}_{\\text{precession}} \\;+\\; \\underbrace{-\\alpha\\gamma'\\,\\mathbf{m}\\times(\\mathbf{m}\\times\\mathbf{B})}_{\\text{damping}}.\n$$\n- In a constant field $\\mathbf{B} = B_0\\,\\mathbf{h}$ with $B_0=\\|\\mathbf{B}\\|$ and $\\mathbf{h}$ a unit vector, the precession frequency is $\\omega = \\gamma' B_0$ in $\\mathrm{rad/s}$, and the ferromagnetic resonance (FMR) period is $T_{\\mathrm{per}} = 2\\pi/\\omega$.\n\nTask requirements:\n1. Derive from first principles a time-splitting scheme based on the decomposition above that applies:\n   - an exact precession map over a time step $\\Delta t$ about axis $\\mathbf{h}$ by angle $\\theta=\\omega\\,\\Delta t$ (no approximation in the precession substep), and\n   - an implicit update for the damping substep over a time interval $\\tau$ that preserves the unit norm and is unconditionally stable. Show how to reduce the implicit vector equation for the damping substep under constant $\\mathbf{B}$ to a scalar nonlinear equation for $s = \\mathbf{h}\\cdot \\mathbf{m}_{\\mathrm{new}}$, and solve it in closed form to obtain an explicit formula for $\\mathbf{m}_{\\mathrm{new}}$.\n2. Compose the two substeps in a symmetric Strang-like fashion (half damping, full precession, half damping) to obtain a second-order, symplectic-like splitting method.\n3. Implement, in code, both:\n   - the derived splitting integrator, and\n   - a baseline explicit fourth-order Runge–Kutta (RK4) method applied directly to the Gilbert form above (you may project back to the unit sphere after each RK4 step to control norm drift).\n4. Simulate an FMR ring-down: take a constant field $\\mathbf{B}=B_0\\hat{\\mathbf{z}}$ with $B_00$, start from a slightly tilted initial magnetization $\\mathbf{m}(0)$ at a small polar angle $\\theta_0$ from $\\hat{\\mathbf{z}}$, and evolve for an integer number of FMR periods. Define the numerical phase at time $t$ as the azimuthal angle $\\phi(t)=\\mathrm{atan2}(m_y(t),m_x(t))$ in radians, and compare to the analytical phase $\\phi_{\\mathrm{exact}}(t)=\\omega t$ modulo $2\\pi$. Use the wrapped absolute phase error $\\varepsilon_\\phi(t) = \\left|\\mathrm{atan2}(\\sin(\\phi(t)-\\phi_{\\mathrm{exact}}(t)),\\cos(\\phi(t)-\\phi_{\\mathrm{exact}}(t)))\\right|$ in radians.\n5. Design a test suite with the following three cases to assess phase accuracy:\n   - Case A (happy path): $\\gamma = 1.760859\\times 10^{11}\\ \\mathrm{rad\\,s^{-1}\\,T^{-1}}$, $B_0=1.0\\ \\mathrm{T}$, $\\alpha=0.02$, $\\theta_0 = 5^\\circ$ (convert to radians), total time $T_{\\mathrm{tot}}=20\\,T_{\\mathrm{per}}$, and time step $\\Delta t = T_{\\mathrm{per}}/12$.\n   - Case B (refined step): same as Case A but $\\Delta t = T_{\\mathrm{per}}/40$.\n   - Case C (boundary, no damping): same as Case A but with $\\alpha=0.0$ and $\\Delta t = T_{\\mathrm{per}}/12$.\n   In all cases, $T_{\\mathrm{per}}=2\\pi/\\omega$ with $\\omega=\\gamma' B_0$ and $\\gamma'=\\gamma/(1+\\alpha^2)$, and the integration should run for exactly $20$ FMR periods so that $T_{\\mathrm{tot}}/\\Delta t$ is an integer. All angles must be in radians, times in seconds, and fields in Tesla.\n6. For each case, compute the wrapped absolute phase error at the final time for the splitting method and for RK4, and return a boolean indicating whether the splitting method has strictly smaller final-time phase error than RK4.\n7. Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for the cases in the order A, B, C. For example, the output format must be like `[True,False,True]`.\n\nYour deliverable must be a complete, runnable program that:\n- Implements the above methods and comparisons.\n- Uses no user input.\n- Prints exactly one line with a Python list of three booleans as specified.", "solution": "The problem requires the derivation, implementation, and comparison of two numerical integrators for the Landau–Lifshitz–Gilbert (LLG) equation for a single-domain macrospin. The core of the task is to develop a geometrically-aware splitting method and benchmark its phase accuracy against a standard explicit Runge-Kutta integrator.\n\nThe LLG equation is given in the Gilbert form, which can be rearranged and decomposed into a precession term and a damping term. With $\\gamma' = \\gamma/(1+\\alpha^2)$, the equation of motion for the unit magnetization vector $\\mathbf{m}$ in a constant effective field $\\mathbf{B}$ is:\n$$\n\\frac{d\\mathbf{m}}{dt} = \\underbrace{-\\gamma'\\,\\mathbf{m}\\times\\mathbf{B}}_{\\mathbf{f}_{\\text{prec}}(\\mathbf{m})} + \\underbrace{-\\alpha\\gamma'\\,\\mathbf{m}\\times(\\mathbf{m}\\times\\mathbf{B})}_{\\mathbf{f}_{\\text{damp}}(\\mathbf{m})}\n$$\nThe field is constant, $\\mathbf{B} = B_0\\mathbf{h}$, where $\\mathbf{h}$ is a unit vector. For the simulation, we use $\\mathbf{h}=\\hat{\\mathbf{z}}$.\n\nA symmetric second-order Strang splitting scheme is employed to integrate this system. The formal solution over one time step $\\Delta t$ is approximated as a composition of operators corresponding to the precession and damping flows:\n$$\n\\mathbf{m}(t+\\Delta t) \\approx \\mathcal{D}_{\\Delta t/2} \\circ \\mathcal{P}_{\\Delta t} \\circ \\mathcal{D}_{\\Delta t/2}(\\mathbf{m}(t))\n$$\nwhere $\\mathcal{P}_{\\Delta t}$ is the operator for the precession flow over a full time step $\\Delta t$, and $\\mathcal{D}_{\\tau}$ is the operator for the damping flow over a time interval $\\tau = \\Delta t/2$. We will now derive the exact analytical form of these operators.\n\n**1. Precession Substep $\\mathcal{P}_{\\Delta t}$**\n\nThe precession dynamics are described by the linear ordinary differential equation (ODE):\n$$\n\\frac{d\\mathbf{m}}{dt} = -\\gamma' \\mathbf{m} \\times \\mathbf{B} = \\omega (\\mathbf{h} \\times \\mathbf{m})\n$$\nwhere $\\omega = \\gamma' B_0$ is the Larmor precession frequency. This equation describes a rigid rotation of the vector $\\mathbf{m}$ about the axis defined by $\\mathbf{h}$ with a constant angular velocity $\\omega$. The analytical solution for a time step $\\Delta t$ is a rotation by an angle $\\theta = \\omega \\Delta t$. This rotation can be computed exactly using Rodrigues' rotation formula:\n$$\n\\mathcal{P}_{\\Delta t}(\\mathbf{m}_{\\text{in}}) = \\mathbf{m}_{\\text{in}} \\cos\\theta + (\\mathbf{h} \\times \\mathbf{m}_{\\text{in}}) \\sin\\theta + \\mathbf{h} (\\mathbf{h} \\cdot \\mathbf{m}_{\\text{in}}) (1 - \\cos\\theta)\n$$\nSince this map is an exact rotation, it naturally preserves the norm of the magnetization, $\\|\\mathbf{m}\\|=1$.\n\n**2. Damping Substep $\\mathcal{D}_{\\tau}$**\n\nThe damping dynamics are described by the nonlinear ODE:\n$$\n\\frac{d\\mathbf{m}}{dt} = -\\alpha\\gamma'\\,\\mathbf{m}\\times(\\mathbf{m}\\times\\mathbf{B})\n$$\nUsing the vector triple product identity $\\mathbf{a}\\times(\\mathbf{b}\\times\\mathbf{c}) = \\mathbf{b}(\\mathbf{a}\\cdot\\mathbf{c})-\\mathbf{c}(\\mathbf{a}\\cdot\\mathbf{b})$ and $\\|\\mathbf{m}\\|=1$, the equation becomes:\n$$\n\\frac{d\\mathbf{m}}{dt} = \\alpha\\gamma' \\left( \\mathbf{B} - (\\mathbf{m}\\cdot\\mathbf{B})\\mathbf{m} \\right)\n$$\nThis equation describes a flow that moves $\\mathbf{m}$ towards alignment with $\\mathbf{B}$. The motion is constrained to the great circle on the unit sphere that passes through the initial magnetization vector and the field vector $\\mathbf{B}$. This geometric insight allows us to find an exact analytical solution for the damping substep.\n\nLet $\\phi(t)$ be the polar angle between $\\mathbf{m}(t)$ and $\\mathbf{h}$. We can parameterize $\\mathbf{m}(t)$ as $\\mathbf{m}(t) = \\cos(\\phi(t))\\mathbf{h} + \\sin(\\phi(t))\\hat{\\mathbf{p}}$, where $\\hat{\\mathbf{p}}$ is a fixed unit vector perpendicular to $\\mathbf{h}$ that lies in the plane of motion. Substituting this into the damping ODE yields a scalar ODE for the angle $\\phi(t)$:\n$$\n\\frac{d\\phi}{dt} = -\\alpha\\gamma'B_0 \\sin\\phi\n$$\nThis is a separable ODE. To find the map over a time interval $\\tau$, we integrate:\n$$\n\\int_{\\phi_{\\text{old}}}^{\\phi_{\\text{new}}} \\frac{d\\phi}{\\sin\\phi} = \\int_{0}^{\\tau} -\\alpha\\gamma'B_0 dt\n$$\nThe integral of $\\csc\\phi$ is $\\ln|\\tan(\\phi/2)|$. This leads to:\n$$\n\\ln\\left(\\frac{\\tan(\\phi_{\\text{new}}/2)}{\\tan(\\phi_{\\text{old}}/2)}\\right) = -\\alpha\\gamma'B_0\\tau\n$$\nSolving for $\\phi_{\\text{new}}$, we obtain the explicit, closed-form update rule:\n$$\n\\tan(\\phi_{\\text{new}}/2) = \\tan(\\phi_{\\text{old}}/2) \\exp(-\\alpha\\gamma'B_0\\tau)\n$$\nGiven an input vector $\\mathbf{m}_{\\text{old}}$, we first find its polar angle $\\phi_{\\text{old}} = \\arccos(\\mathbf{m}_{\\text{old}}\\cdot\\mathbf{h})$. We then use the formula above to find $\\phi_{\\text{new}}$. The new vector $\\mathbf{m}_{\\text{new}}$ is reconstructed preserving the plane of motion:\n$$\n\\mathbf{m}_{\\text{new}} = \\cos(\\phi_{\\text{new}})\\mathbf{h} + \\sin(\\phi_{\\text{new}})\\frac{\\mathbf{m}_{\\text{old}} - (\\mathbf{m}_{\\text{old}}\\cdot\\mathbf{h})\\mathbf{h}}{\\|\\mathbf{m}_{\\text{old}} - (\\mathbf{m}_{\\text{old}}\\cdot\\mathbf{h})\\mathbf{h}\\|}\n$$\nThis exact solution for the damping flow is unconditionally stable and preserves the unit norm by construction, satisfying all the requirements for the damping substep integrator.\n\n**3. Baseline: Fourth-Order Runge-Kutta (RK4) Method**\n\nFor comparison, a standard explicit fourth-order Runge-Kutta (RK4) method is applied directly to the full LLG equation. A single step of RK4 from time $t_n$ to $t_n+\\Delta t$ is:\n$$\n\\begin{aligned}\n    \\mathbf{k}_1 = \\mathbf{f}(\\mathbf{m}_n) \\\\\n    \\mathbf{k}_2 = \\mathbf{f}(\\mathbf{m}_n + \\frac{\\Delta t}{2}\\mathbf{k}_1) \\\\\n    \\mathbf{k}_3 = \\mathbf{f}(\\mathbf{m}_n + \\frac{\\Delta t}{2}\\mathbf{k}_2) \\\\\n    \\mathbf{k}_4 = \\mathbf{f}(\\mathbf{m}_n + \\Delta t\\mathbf{k}_3) \\\\\n    \\mathbf{m}_{n+1}^* = \\mathbf{m}_n + \\frac{\\Delta t}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)\n\\end{aligned}\n$$\nwhere $\\mathbf{f}(\\mathbf{m}) = \\mathbf{f}_{\\text{prec}}(\\mathbf{m}) + \\mathbf{f}_{\\text{damp}}(\\mathbf{m})$. The RK4 method does not inherently preserve the unit norm of $\\mathbf{m}$. Therefore, a projection step, $\\mathbf{m}_{n+1} = \\mathbf{m}_{n+1}^* / \\|\\mathbf{m}_{n+1}^*\\|$, must be applied after each time step to prevent unphysical norm drift.\n\n**4. Phase Error Calculation**\n\nThe accuracy of the integrators is assessed by the phase error in a ferromagnetic resonance (FMR) ring-down simulation. The analytical phase of the precessing magnetization at time $t$ is $\\phi_{\\text{exact}}(t) = \\omega t$. The numerical phase is $\\phi_{\\text{num}}(t) = \\mathrm{atan2}(m_y(t), m_x(t))$. The simulation runs for $T_{\\text{tot}} = 20 T_{\\text{per}}$, so the exact final phase is $\\phi_{\\text{exact}}(T_{\\text{tot}}) = 40\\pi$, which is equivalent to $0$ modulo $2\\pi$. The wrapped absolute phase error is calculated as $\\varepsilon_\\phi = |\\mathrm{atan2}(\\sin(\\phi_{\\text{num}}-\\phi_{\\text{exact}}), \\cos(\\phi_{\\text{num}}-\\phi_{\\text{exact}}))|$. The splitting integrator, being a geometric method that treats the dominant oscillatory part exactly, is expected to exhibit significantly lower phase error than the general-purpose RK4 method.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares a Landau-Lifshitz-Gilbert (LLG) splitting integrator\n    against a standard RK4 integrator for a ferromagnetic resonance ring-down problem.\n    The comparison is based on the final phase accuracy for three test cases.\n    \"\"\"\n\n    # --- Fundamental Constants ---\n    GAMMA = 1.760859e11  # Gyromagnetic ratio in rad s^-1 T^-1\n\n    # --- Test Case Definitions ---\n    test_cases = [\n        # Case A: Happy path with moderate damping and time step\n        {'name': 'A', 'alpha': 0.02, 'dt_frac': 12},\n        # Case B: Refined time step\n        {'name': 'B', 'alpha': 0.02, 'dt_frac': 40},\n        # Case C: Boundary case with no damping\n        {'name': 'C', 'alpha': 0.0, 'dt_frac': 12},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # --- Parameter Setup ---\n        alpha = case['alpha']\n        dt_frac = case['dt_frac']\n\n        B0 = 1.0  # Tesla\n        h_axis = np.array([0.0, 0.0, 1.0])\n        B_vec = B0 * h_axis\n\n        theta0_deg = 5.0\n        theta0_rad = np.deg2rad(theta0_deg)\n        m0 = np.array([np.sin(theta0_rad), 0.0, np.cos(theta0_rad)])\n\n        gammap = GAMMA / (1.0 + alpha**2)\n        omega = gammap * B0\n        T_per = 2.0 * np.pi / omega\n        \n        T_tot = 20.0 * T_per\n        dt = T_per / dt_frac\n        num_steps = int(round(T_tot / dt))\n\n        # --- Integrator Implementations ---\n\n        # 1. Splitting Method (Half-Damping, Full-Precession, Half-Damping)\n        def precession_step(m, angle):\n            \"\"\"Exact rotation around z-axis by a given angle.\"\"\"\n            cos_a = np.cos(angle)\n            sin_a = np.sin(angle)\n            mx_new = m[0] * cos_a - m[1] * sin_a\n            my_new = m[0] * sin_a + m[1] * cos_a\n            return np.array([mx_new, my_new, m[2]])\n\n        def damping_step(m, tau):\n            \"\"\"Exact solution of the damping sub-problem over time interval tau.\"\"\"\n            if alpha == 0.0:\n                return m\n            \n            s_old = np.clip(m @ h_axis, -1.0, 1.0)\n            \n            # If m is already aligned with B, no damping occurs.\n            if 1.0 - abs(s_old)  1e-14:\n                return np.sign(s_old) * h_axis\n\n            phi_old = np.arccos(s_old)\n            sin_phi_old = np.sin(phi_old)\n\n            lamb = alpha * gammap * B0 * tau\n            tan_phi_old_half = np.tan(phi_old / 2.0)\n            tan_phi_new_half = tan_phi_old_half * np.exp(-lamb)\n            phi_new = 2.0 * np.arctan(tan_phi_new_half)\n\n            s_new = np.cos(phi_new)\n            sin_phi_new = np.sin(phi_new)\n            \n            # Reconstruct the new vector in the same plane (m, h)\n            # m_new = s_new * h + sin_new/sin_old * (m - s_old * h)\n            m_perp_old = m - s_old * h_axis\n            m_new = s_new * h_axis + m_perp_old * (sin_phi_new / sin_phi_old)\n            \n            return m_new\n\n        def integrate_split(m_init, n_steps, dt_val):\n            m = np.copy(m_init)\n            precession_angle = omega * dt_val\n            damping_tau = dt_val / 2.0\n            for _ in range(n_steps):\n                m = damping_step(m, damping_tau)\n                m = precession_step(m, precession_angle)\n                m = damping_step(m, damping_tau)\n            return m\n\n        # 2. RK4 Method\n        def llg_rhs(m):\n            m_cross_B = np.cross(m, B_vec)\n            m_cross_m_cross_B = np.cross(m, m_cross_B)\n            rhs = -gammap * m_cross_B - alpha * gammap * m_cross_m_cross_B\n            return rhs\n\n        def integrate_rk4(m_init, n_steps, dt_val):\n            m = np.copy(m_init)\n            for _ in range(n_steps):\n                k1 = llg_rhs(m)\n                k2 = llg_rhs(m + dt_val / 2.0 * k1)\n                k3 = llg_rhs(m + dt_val / 2.0 * k2)\n                k4 = llg_rhs(m + dt_val * k3)\n                m = m + dt_val / 6.0 * (k1 + 2 * k2 + 2 * k3 + k4)\n                m /= np.linalg.norm(m)  # Re-normalize after each step\n            return m\n\n        # --- Execution and Comparison ---\n        m_final_split = integrate_split(m0, num_steps, dt)\n        m_final_rk4 = integrate_rk4(m0, num_steps, dt)\n\n        # Final phase is 40*pi, which is 0 mod 2*pi\n        phi_exact_final = 0.0\n\n        phi_split = np.arctan2(m_final_split[1], m_final_split[0])\n        phi_rk4 = np.arctan2(m_final_rk4[1], m_final_rk4[0])\n\n        d_phi_split = phi_split - phi_exact_final\n        error_split = abs(np.arctan2(np.sin(d_phi_split), np.cos(d_phi_split)))\n\n        d_phi_rk4 = phi_rk4 - phi_exact_final\n        error_rk4 = abs(np.arctan2(np.sin(d_phi_rk4), np.cos(d_phi_rk4)))\n\n        results.append(error_split  error_rk4)\n\n    # --- Print Final Output ---\n    # The output format is a Python list of booleans, converted to a string.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3460197"}]}