{"hands_on_practices": [{"introduction": "The connection between a device and its external reservoirs is encapsulated in the self-energy, $\\Sigma(E)$, a cornerstone of the NEGF formalism. This practice builds a foundational understanding of the widely used wide-band limit (WBL) approximation, where the complex, energy-dependent self-energy is replaced by a constant imaginary term. By deriving the exact self-energy for a one-dimensional lead and comparing it to the WBL, you will quantify the approximation's error and gain crucial intuition about its breakdown near band-edge van Hove singularities—a vital skill for robust transport simulations [@problem_id:3482922].", "problem": "Consider a single-site device described by a Hamiltonian $H_\\mathrm{d} = [\\varepsilon_\\mathrm{d}]$ coupled to two semi-infinite one-dimensional tight-binding leads, labeled left ($L$) and right ($R$). Each lead is characterized by an on-site energy $\\varepsilon_0$ and a nearest-neighbor hopping parameter $t$, and the device couples to the terminal site of each lead via coupling amplitudes $\\tau_L$ and $\\tau_R$. Work within the framework of Non-Equilibrium Green's Functions (NEGF), beginning from the definitions of the retarded Green's function $G^r$, advanced Green's function $G^a$, self-energies $\\Sigma_\\alpha^r(E)$ with $\\alpha \\in \\{L,R\\}$, and coupling (broadening) functions $\\Gamma_\\alpha(E)$. Use the Landauer approach for coherent transport and the relationship between the transmission and the device and lead properties that follows from the NEGF formalism. \n\nYour tasks are:\n- Starting from the fundamental NEGF definitions and the equations that define lead self-energies for semi-infinite periodic systems, derive the exact energy-dependent surface Green's function of a semi-infinite one-dimensional tight-binding chain and hence obtain $\\Sigma_\\alpha^r(E)$ and $\\Gamma_\\alpha(E)$ for each lead.\n- Define the wide-band limit (WBL) approximation by replacing the energy-dependent coupling functions $\\Gamma_\\alpha(E)$ with constants $\\Gamma_{\\alpha,0}$ chosen by evaluating the exact $\\Gamma_\\alpha(E)$ at a reference energy $E_0$. In this problem, let $E_0 = 0\\,\\mathrm{eV}$.\n- Using NEGF, derive the transmission function through the single-site device, expressed in terms of $G^r$, $G^a$, and the coupling functions. Evaluate this transmission once using the exact semi-infinite tight-binding self-energies and once using the wide-band limit with $\\Gamma_{\\alpha,0}$ and no energy-dependent real shifts.\n- Quantify the error of the wide-band limit near the band edges, where van Hove singularities occur, by computing for each energy $E$ the error measure $\\Delta(E) = \\left|T_\\mathrm{WBL}(E) - T_\\mathrm{exact}(E)\\right| / \\max\\left(T_\\mathrm{exact}(E), \\epsilon_\\mathrm{reg}\\right)$, with a regularization constant $\\epsilon_\\mathrm{reg} = 10^{-12}$. Express all energies and couplings in $\\mathrm{eV}$.\n\nImplement the above in a program that computes the error measure $\\Delta(E)$ for the following test suite of parameter sets, which explores a general case, approach to the van Hove singularity at the band edge, outside the band, and a coupling boundary condition:\n\n- Case $1$ (general, band center): $(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$.\n- Case $2$ (near band edge): $(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (1.8\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$.\n- Case $3$ (closer to band edge): $(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (1.95\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$.\n- Case $4$ (approaching van Hove singularity): $(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (1.999\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$.\n- Case $5$ (outside the band): $(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (2.1\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$.\n- Case $6$ (zero coupling boundary): $(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,\\dots,r_6]$), where each $r_i$ is the floating-point value of $\\Delta(E)$ for the corresponding case. All energies and couplings must be in $\\mathrm{eV}$, and computed transmissions are dimensionless. No angles appear in this problem.", "solution": "The problem proposed is a valid and well-posed exercise in the field of computational materials science, specifically concerning quantum transport through a single-site electronic device modeled within the Non-Equilibrium Green's Function (NEGF) formalism. It requires the derivation and comparison of the transmission function using an exact lead self-energy versus the wide-band limit approximation. All provided parameters and definitions are standard, scientifically sound, and self-consistent. We therefore proceed with the solution.\n\nThe primary task is to derive the transmission function $T(E)$ for a single-level quantum dot, described by Hamiltonian $H_\\mathrm{d} = [\\varepsilon_\\mathrm{d}]$, coupled to two semi-infinite one-dimensional tight-binding leads. The solution involves several key steps: deriving the lead properties, constructing the device Green's function, and then calculating the transmission.\n\n**1. Surface Green's Function of a 1D Tight-Binding Lead**\n\nA semi-infinite one-dimensional tight-binding lead, indexed from site $n=0$ to infinity, is described by a Hamiltonian with on-site energy $\\varepsilon_0$ and nearest-neighbor hopping $t$. The retarded Green's function $g^r(E) = [(E+i\\eta)I - H_\\mathrm{lead}]^{-1}$ (where $\\eta \\to 0^+$) is required. The element corresponding to the terminal site of the lead, $g^r_{00}(E)$, is known as the surface Green's function, which we denote as $g^r_{surf}(E)$.\n\nThis element can be found using a recursive argument. The Green's function at site $0$ can be expressed via the Dyson equation, where the self-energy term accounts for the coupling to the rest of the chain (sites $n=1, 2, \\dots$):\n$$g^r_{surf}(E) = \\left( E+i\\eta - \\varepsilon_0 - t \\cdot g^r_{surf}(E) \\cdot t \\right)^{-1}$$\nHere, we have exploited the fact that the self-energy for connecting to the sub-chain starting at site $1$ is $t^2 g^r_{surf}(E)$ because the sub-chain is identical in structure to the original semi-infinite chain. Letting $g = g^r_{surf}(E)$ and $z = E - \\varepsilon_0 + i\\eta$, the equation becomes:\n$$g = (z - t^2 g)^{-1} \\implies t^2 g^2 - z g + 1 = 0$$\nThis quadratic equation for $g$ has two solutions:\n$$g = \\frac{z \\pm \\sqrt{z^2 - 4t^2}}{2t^2}$$\nTo select the physically correct root, we require that the Green's function represents an outgoing or decaying wave into the lead, which corresponds to the solution that decays as $\\mathrm{Im}(E) \\to \\infty$. This condition is satisfied by the minus sign. Thus, the exact surface Green's function is:\n$$g^r_{surf}(E) = \\frac{(E - \\varepsilon_0) - \\sqrt{(E - \\varepsilon_0)^2 - 4t^2}}{2t^2}$$\nIn this expression, the branch of the square root is chosen such that its imaginary part is negative, consistent with the small positive imaginary part $i\\eta$ in the energy $E$.\n\n**2. Lead Self-Energy and Broadening Function**\n\nThe lead $\\alpha \\in \\{L, R\\}$ couples to the device via a hopping amplitude $\\tau_\\alpha$. The retarded self-energy, $\\Sigma^r_\\alpha(E)$, which describes the influence of the lead on the device, is given by:\n$$\\Sigma^r_\\alpha(E) = \\tau_\\alpha^2 g^r_{surf}(E) = \\frac{\\tau_\\alpha^2}{2t^2} \\left[ (E - \\varepsilon_0) - \\sqrt{(E - \\varepsilon_0)^2 - 4t^2} \\right]$$\nThe broadening (or coupling) function, $\\Gamma_\\alpha(E)$, is related to the self-energy by $\\Gamma_\\alpha(E) = i[\\Sigma^r_\\alpha(E) - \\Sigma^a_\\alpha(E)]$. Since the advanced self-energy is the Hermitian conjugate of the retarded one, $\\Sigma^a_\\alpha(E) = (\\Sigma^r_\\alpha(E))^*$, this simplifies to:\n$$\\Gamma_\\alpha(E) = -2 \\mathrm{Im}[\\Sigma^r_\\alpha(E)]$$\nThe behavior of $\\Gamma_\\alpha(E)$ depends on whether the energy $E$ falls within the conduction band of the leads, which spans from $\\varepsilon_0 - 2|t|$ to $\\varepsilon_0 + 2|t|$.\n\n- **Inside the band ($|E - \\varepsilon_0| < 2|t|$):** The term $(E - \\varepsilon_0)^2 - 4t^2$ is negative. The square root is purely imaginary: $\\sqrt{(E - \\varepsilon_0)^2 - 4t^2} = \\pm i\\sqrt{4t^2 - (E - \\varepsilon_0)^2}$. The correct physical root gives a negative imaginary part for $\\Sigma^r_\\alpha(E)$, corresponding to dissipation.\n$$\\Sigma^r_\\alpha(E) = \\frac{\\tau_\\alpha^2}{2t^2} \\left[ (E - \\varepsilon_0) - i\\sqrt{4t^2 - (E - \\varepsilon_0)^2} \\right]$$\nThe imaginary part is $\\mathrm{Im}[\\Sigma^r_\\alpha(E)] = -\\frac{\\tau_\\alpha^2}{2t^2}\\sqrt{4t^2 - (E - \\varepsilon_0)^2}$. The broadening is therefore:\n$$\\Gamma_\\alpha(E) = \\frac{\\tau_\\alpha^2}{t^2}\\sqrt{4t^2 - (E - \\varepsilon_0)^2}$$\n- **Outside the band ($|E - \\varepsilon_0| > 2|t|$):** The square root term is real. In the limit $\\eta \\to 0^+$, the imaginary part of $\\Sigma^r_\\alpha(E)$ is zero. Thus, $\\Gamma_\\alpha(E) = 0$, indicating that there are no available states in the lead for transport at these energies.\n\n**3. Transmission Function: Exact vs. Wide-Band Limit**\n\nThe total retarded Green's function for the single-site device is:\n$$G^r(E) = \\left[ E - \\varepsilon_\\mathrm{d} - \\Sigma^r_L(E) - \\Sigma^r_R(E) \\right]^{-1}$$\nThe transmission function, according to the Landauer-Büttiker formula in the NEGF framework, is given by:\n$$T(E) = \\mathrm{Tr}\\left[\\Gamma_L(E) G^r(E) \\Gamma_R(E) G^a(E)\\right]$$\nFor a single-site device, this is a scalar expression, with $G^a(E) = (G^r(E))^*$:\n$$T(E) = \\Gamma_L(E) \\Gamma_R(E) |G^r(E)|^2$$\n\n**A. Exact Transmission, $T_\\mathrm{exact}(E)$**\nTo compute the exact transmission, we use the energy-dependent expressions for $\\Sigma^r_\\alpha(E)$ and $\\Gamma_\\alpha(E)$ derived above. The transmission will be non-zero only within the lead band.\n\n**B. Wide-Band Limit (WBL) Transmission, $T_\\mathrm{WBL}(E)$**\nThe WBL approximation simplifies the problem by assuming the lead broadening is constant over the energy range of interest. The energy-dependent self-energy $\\Sigma^r_\\alpha(E)$ is replaced by a purely imaginary constant:\n$$\\Sigma^r_\\alpha(E) \\approx \\Sigma^r_{\\alpha, \\mathrm{WBL}} = -i\\frac{\\Gamma_{\\alpha,0}}{2}$$\nwhere $\\Gamma_{\\alpha,0}$ is the value of the exact broadening function evaluated at a reference energy $E_0$. The problem specifies $E_0 = 0\\,\\mathrm{eV}$. For the given lead parameters $\\varepsilon_0 = 0\\,\\mathrm{eV}$ and $t=1.0\\,\\mathrm{eV}$, $E_0$ is at the band center.\n$$\\Gamma_{\\alpha,0} = \\Gamma_\\alpha(E_0=0) = \\frac{\\tau_\\alpha^2}{t^2}\\sqrt{4t^2 - (0 - 0)^2} = \\frac{2|t|\\tau_\\alpha^2}{t^2} = \\frac{2\\tau_\\alpha^2}{|t|}$$\nThe device Green's function in the WBL is:\n$$G^r_\\mathrm{WBL}(E) = \\left[ E - \\varepsilon_\\mathrm{d} - (-i\\frac{\\Gamma_{L,0}}{2}) - (-i\\frac{\\Gamma_{R,0}}{2}) \\right]^{-1} = \\left[ (E - \\varepsilon_\\mathrm{d}) + i\\frac{\\Gamma_{L,0} + \\Gamma_{R,0}}{2} \\right]^{-1}$$\nThe WBL transmission is then a Lorentzian function:\n$$T_\\mathrm{WBL}(E) = \\Gamma_{L,0} \\Gamma_{R,0} |G^r_\\mathrm{WBL}(E)|^2 = \\frac{\\Gamma_{L,0} \\Gamma_{R,0}}{(E - \\varepsilon_\\mathrm{d})^2 + \\left(\\frac{\\Gamma_{L,0} + \\Gamma_{R,0}}{2}\\right)^2}$$\nThis approximation notably predicts non-zero transmission at all energies, a key difference from the exact result.\n\n**4. Error Metric**\nThe error of the WBL approximation is quantified by the measure $\\Delta(E)$:\n$$\\Delta(E) = \\frac{\\left|T_\\mathrm{WBL}(E) - T_\\mathrm{exact}(E)\\right|}{\\max\\left(T_\\mathrm{exact}(E), \\epsilon_\\mathrm{reg}\\right)}$$\nThe regularization constant $\\epsilon_\\mathrm{reg} = 10^{-12}$ prevents division by zero in regions where $T_\\mathrm{exact}(E)$ is zero, such as outside the conduction band or when a lead is decoupled.\n\nWe will now implement these formulae to compute $\\Delta(E)$ for the specified test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the error measure Δ(E) for the WBL approximation across several test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (E, eps_d, eps_0, t, tau_L, tau_R)\n        (0.0, 0.0, 0.0, 1.0, 0.5, 0.5),   # Case 1: general, band center\n        (1.8, 0.0, 0.0, 1.0, 0.5, 0.5),   # Case 2: near band edge\n        (1.95, 0.0, 0.0, 1.0, 0.5, 0.5),  # Case 3: closer to band edge\n        (1.999, 0.0, 0.0, 1.0, 0.5, 0.5), # Case 4: approaching van Hove singularity\n        (2.1, 0.0, 0.0, 1.0, 0.5, 0.5),   # Case 5: outside the band\n        (0.0, 0.0, 0.0, 1.0, 0.0, 0.5),   # Case 6: zero coupling boundary\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_delta(*case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_delta(E, eps_d, eps_0, t, tau_L, tau_R):\n    \"\"\"\n    Calculates the error measure Δ(E) for a given set of parameters.\n    \n    Args:\n        E (float): Energy.\n        eps_d (float): Device on-site energy.\n        eps_0 (float): Lead on-site energy.\n        t (float): Lead hopping parameter.\n        tau_L (float): Left lead coupling.\n        tau_R (float): Right lead coupling.\n\n    Returns:\n        float: The calculated error Δ(E).\n    \"\"\"\n    epsilon_reg = 1e-12\n    t_abs = np.abs(t)\n\n    # --- Wide-Band Limit (WBL) Calculation ---\n    # Reference energy for WBL is E0 = 0.0 eV.\n    # The reference energy E0 falls within the band since eps_0=0 and t=1.\n    if t_abs > 0:\n        E0 = 0.0\n        arg_sqrt_wbl = 4 * t**2 - (E0 - eps_0)**2\n        # WBL constant is based on E0 being in the band.\n        if arg_sqrt_wbl >= 0:\n            Gamma_L0 = (tau_L**2 / t**2) * np.sqrt(arg_sqrt_wbl) if t!=0 else 0\n            Gamma_R0 = (tau_R**2 / t**2) * np.sqrt(arg_sqrt_wbl) if t!=0 else 0\n        else: # E0 is outside the band, all WBL couplings are zero.\n            Gamma_L0 = 0.0\n            Gamma_R0 = 0.0\n    else:\n        Gamma_L0 = 0.0\n        Gamma_R0 = 0.0\n\n    Gamma_sum_0 = Gamma_L0 + Gamma_R0\n    denominator_wbl = (E - eps_d)**2 + (Gamma_sum_0 / 2)**2\n    \n    if np.isclose(denominator_wbl, 0.0):\n        # Avoid division by zero, though unlikely for physical parameters.\n        T_wbl = float('inf') if Gamma_L0 * Gamma_R0 != 0 else 0.0\n    else:\n        T_wbl = (Gamma_L0 * Gamma_R0) / denominator_wbl\n    \n    # --- Exact Calculation ---\n    band_half_width = 2 * t_abs\n    is_in_band = np.abs(E - eps_0)  band_half_width\n\n    if not is_in_band or t_abs == 0:\n        T_exact = 0.0\n    else:\n        # Calculate Γ_α(E)\n        arg_sqrt_exact = 4 * t**2 - (E - eps_0)**2\n        Gamma_L = (tau_L**2 / t**2) * np.sqrt(arg_sqrt_exact)\n        Gamma_R = (tau_R**2 / t**2) * np.sqrt(arg_sqrt_exact)\n\n        # Calculate Σ^r_α(E)\n        # Use numpy.lib.scimath.sqrt to handle complex results automatically\n        # for arguments that are negative.\n        sqrt_term_complex = np.lib.scimath.sqrt((E - eps_0)**2 - 4 * t**2)\n        \n        Sigma_r_surf_factor = ((E - eps_0) - sqrt_term_complex) / (2 * t**2)\n        \n        Sigma_r_L = tau_L**2 * Sigma_r_surf_factor\n        Sigma_r_R = tau_R**2 * Sigma_r_surf_factor\n        \n        Sigma_r_total = Sigma_r_L + Sigma_r_R\n\n        # Calculate G^r(E)\n        G_r = 1.0 / (E - eps_d - Sigma_r_total)\n        \n        # Calculate T_exact(E)\n        T_exact = Gamma_L * Gamma_R * np.abs(G_r)**2\n    \n    # --- Error Calculation ---\n    numerator = np.abs(T_wbl - T_exact)\n    denominator = np.maximum(T_exact, epsilon_reg)\n    delta = numerator / denominator\n    \n    return delta\n\nsolve()\n```", "id": "3482922"}, {"introduction": "Moving beyond simple two-terminal devices, realistic simulations must handle multi-terminal geometries and the effects of inelastic scattering, which destroys phase coherence. This exercise introduces Büttiker probes, a powerful and computationally efficient method for modeling dephasing, and tasks you with a critical validation step: verifying local current conservation. By implementing a multi-terminal solver and confirming that the sum of all spectral currents is zero, $\\sum_{\\alpha} I_{\\alpha}(E) = 0$, you ensure your code is physically consistent and ready for more advanced applications [@problem_id:3482901].", "problem": "Consider a one-dimensional tight-binding device with $N$ sites, described by a Hamiltonian matrix $H \\in \\mathbb{C}^{N \\times N}$ with on-site energies $\\{\\varepsilon_i\\}_{i=1}^N$ and nearest-neighbor hopping $t$. The device is connected to multiple terminals (external leads and Büttiker probes). Each terminal $\\alpha$ couples locally to a single device site $i_\\alpha$ with a wide-band retarded self-energy $\\Sigma_\\alpha^r(E) = -\\frac{i}{2}\\Gamma_\\alpha$, where $\\Gamma_\\alpha$ is a coupling matrix that is zero everywhere except at the diagonal element corresponding to $i_\\alpha$, where it equals the scalar broadening $\\gamma_\\alpha  0$. Work in normalized units where $e = \\hbar = k_B = 1$. The energy-resolved retarded Green's function is\n$$\nG^r(E) \\;=\\; \\left[(E + i\\,\\eta)\\,I - H - \\sum_{\\alpha} \\Sigma_\\alpha^r(E)\\right]^{-1},\n$$\nwith $I$ the identity matrix and $\\eta  0$ an infinitesimal used numerically for stability. The advanced Green's function is $G^a(E) = \\left(G^r(E)\\right)^\\dagger$. The coupling matrix for terminal $\\alpha$ is $\\Gamma_\\alpha = i\\left(\\Sigma_\\alpha^r - \\Sigma_\\alpha^{a}\\right)$ which, in the wide-band limit specified above, reduces to the constant matrix whose only nonzero diagonal entry at $i_\\alpha$ is $\\gamma_\\alpha$. The energy-resolved transmission from terminal $\\beta$ to terminal $\\alpha$ is given by the Caroli formula\n$$\nT_{\\alpha\\beta}(E) \\;=\\; \\mathrm{Tr}\\left[\\Gamma_\\alpha\\,G^r(E)\\,\\Gamma_\\beta\\,G^a(E)\\right].\n$$\nAssume external leads have known energy-resolved occupation functions $f_\\ell(E)$ given by the Fermi-Dirac function\n$$\nf_\\ell(E) \\;=\\; \\frac{1}{1 + \\exp\\left(\\dfrac{E - \\mu_\\ell}{T}\\right)},\n$$\nwhere $\\mu_\\ell$ is the chemical potential of external lead $\\ell$ and $T$ is the temperature (with $k_B = 1$). Büttiker probes are fictitious terminals that impose local dephasing by adding their self-energies and by choosing their energy-resolved occupation functions $f_p(E)$ such that the net spectral current into each probe vanishes at every energy. For a multi-terminal structure, the energy-resolved current leaving terminal $\\alpha$ is\n$$\nI_\\alpha(E) \\;=\\; \\frac{1}{2\\pi}\\,\\sum_{\\beta} T_{\\alpha\\beta}(E)\\,\\big(f_\\alpha(E) - f_\\beta(E)\\big).\n$$\nFor Büttiker probes $p$, enforce $I_p(E) = 0$ at each energy by solving the linear system resulting from\n$$\n0 \\;=\\; \\sum_{\\beta} T_{p\\beta}(E)\\,\\big(f_p(E) - f_\\beta(E)\\big),\n$$\nwhere the sum runs over all terminals (external leads and all probes). This determines $f_p(E)$ energy by energy. The local continuity equation at the energy-resolved level requires that\n$$\n\\sum_{\\alpha} I_\\alpha(E) \\;=\\; 0\n$$\nfor every energy $E$, where the sum runs over all terminals (external leads and all probes). Your task is to implement a program that, for each test case specified below, computes the maximum absolute violation of this energy-resolved continuity equation over a given discrete energy set:\n$$\n\\max_{E \\in \\mathcal{E}} \\left|\\sum_{\\alpha} I_\\alpha(E)\\right|.\n$$\nAll computations must be performed using the definitions provided above. Use an infinitesimal $\\eta = 10^{-12}$ in the retarded Green's function. The device Hamiltonian is constructed as\n$$\nH_{ij} \\;=\\; \\begin{cases}\n\\varepsilon_i,  i=j,\\\\\n-t,  |i-j|=1,\\\\\n0,  \\text{otherwise}.\n\\end{cases}\n$$\nEach terminal $\\alpha$ couples at its designated device site $i_\\alpha$ with a scalar broadening $\\gamma_\\alpha$ so that $\\Gamma_\\alpha$ is zero everywhere except $(\\Gamma_\\alpha)_{i_\\alpha,i_\\alpha} = \\gamma_\\alpha$.\n\nImplement the following four test cases. For each case, use the provided parameters and report a single floating-point number equal to $\\max_{E \\in \\mathcal{E}} \\left|\\sum_{\\alpha} I_\\alpha(E)\\right|$. The final program output must be a single line containing the list of these four numbers in order, as a comma-separated list enclosed in square brackets (e.g., $[x_1,x_2,x_3,x_4]$). No units are required because all quantities are in normalized units.\n\n- Test Case $1$ (two external leads and two Büttiker probes):\n  - Device: $N = 5$, $t = 1.0$, on-site energies $\\varepsilon = [0.0, 0.2, -0.1, 0.1, 0.0]$.\n  - External leads: left lead at site $i_L = 0$ with $\\gamma_L = 0.6$ and $\\mu_L = 0.2$; right lead at site $i_R = 4$ with $\\gamma_R = 0.9$ and $\\mu_R = -0.15$.\n  - Büttiker probes: at sites $i_{p_1} = 1$ with $\\gamma_{p_1} = 0.5$ and $i_{p_2} = 3$ with $\\gamma_{p_2} = 0.4$.\n  - Temperature: $T = 0.05$.\n  - Energy set: $\\mathcal{E} = \\{-2.0, -0.5, 0.0, 0.8, 2.0\\}$.\n\n- Test Case $2$ (two external leads, no probes; broad energy coverage including outside the tight-binding band):\n  - Device: $N = 4$, $t = 1.0$, on-site energies $\\varepsilon = [0.0, 0.0, 0.0, 0.0]$.\n  - External leads: left lead at site $i_L = 0$ with $\\gamma_L = 0.5$ and $\\mu_L = 0.1$; right lead at site $i_R = 3$ with $\\gamma_R = 0.7$ and $\\mu_R = -0.1$.\n  - No Büttiker probes.\n  - Temperature: $T = 0.02$.\n  - Energy set: $\\mathcal{E} = \\{-3.0, -1.0, 0.0, 1.0, 3.0\\}$.\n\n- Test Case $3$ (equilibrium check; two external leads, no probes):\n  - Device: $N = 3$, $t = 1.0$, on-site energies $\\varepsilon = [0.0, 0.0, 0.0]$.\n  - External leads: left lead at site $i_L = 0$ with $\\gamma_L = 0.8$ and $\\mu_L = 0.0$; right lead at site $i_R = 2$ with $\\gamma_R = 0.8$ and $\\mu_R = 0.0$.\n  - No Büttiker probes.\n  - Temperature: $T = 0.1$.\n  - Energy set: $\\mathcal{E} = \\{-1.5, 0.0, 1.5\\}$.\n\n- Test Case $4$ (single-site device with one Büttiker probe and two external leads on the same site):\n  - Device: $N = 1$, $t = 1.0$, on-site energies $\\varepsilon = [0.0]$.\n  - External leads: left lead at site $i_L = 0$ with $\\gamma_L = 1.0$ and $\\mu_L = 0.3$; right lead at site $i_R = 0$ with $\\gamma_R = 1.0$ and $\\mu_R = -0.2$.\n  - Büttiker probe: at site $i_p = 0$ with $\\gamma_p = 0.3$.\n  - Temperature: $T = 0.05$.\n  - Energy set: $\\mathcal{E} = \\{0.0\\}$.\n\nYour program must:\n- Construct $H$, $\\Gamma_\\alpha$, and $\\Sigma_\\alpha^r$ for each terminal.\n- For each $E \\in \\mathcal{E}$, compute $G^r(E)$ and $G^a(E)$.\n- Compute all $T_{\\alpha\\beta}(E)$.\n- For cases with Büttiker probes, solve at each $E$ the linear system enforcing $I_p(E) = 0$ for every probe to obtain $f_p(E)$.\n- Compute the spectral currents $I_\\alpha(E)$ for all terminals and evaluate $\\left|\\sum_{\\alpha} I_\\alpha(E)\\right|$.\n- For each test case, report the maximum of this absolute sum over the specified energy set.\n- Output a single line containing these four maxima in order as a comma-separated list enclosed in square brackets (e.g., $[x_1,x_2,x_3,x_4]$).", "solution": "The problem is assessed to be valid. It is a well-posed, scientifically grounded, and objective problem within the domain of computational materials science, specifically concerning quantum transport calculations using the non-equilibrium Green's function (NEGF) formalism. All definitions are standard, and all necessary parameters for the computations are provided. The task is to numerically verify a fundamental conservation law—the local continuity equation for current—which must hold analytically. The magnitude of the numerical violation serves as a stringent test of the implementation's correctness and precision.\n\nThe solution proceeds by implementing the NEGF formalism as prescribed. For each test case, we iterate through a specified set of discrete energies $\\mathcal{E}$. At each energy $E \\in \\mathcal{E}$, the following sequence of calculations is performed:\n\nFirst, the system's tight-binding Hamiltonian matrix $H \\in \\mathbb{C}^{N \\times N}$ is constructed. For a $1$D chain of $N$ sites with on-site energies $\\{\\varepsilon_i\\}_{i=1}^N$ and uniform nearest-neighbor hopping $t$, the matrix elements are given by:\n$$\nH_{ij} \\;=\\; \\begin{cases}\n\\varepsilon_i,  i=j \\\\\n-t,  |i-j|=1 \\\\\n0,  \\text{otherwise}\n\\end{cases}\n$$\nwhere indices $i, j$ range from $1$ to $N$. In implementation, we use $0$-based indexing.\n\nSecond, the influence of the terminals (external leads and Büttiker probes) is incorporated via retarded self-energies $\\Sigma_\\alpha^r(E)$. For each terminal $\\alpha$ coupled to a specific device site $i_\\alpha$ with broadening $\\gamma_\\alpha  0$, the self-energy is taken in the wide-band limit, $\\Sigma_\\alpha^r(E) = -\\frac{i}{2}\\Gamma_\\alpha$. The matrix $\\Gamma_\\alpha$ is zero except for the diagonal element $(\\Gamma_\\alpha)_{i_\\alpha, i_\\alpha} = \\gamma_\\alpha$. The total retarded self-energy is the sum over all terminals: $\\Sigma^r(E) = \\sum_\\alpha \\Sigma_\\alpha^r(E) = -\\frac{i}{2} \\sum_\\alpha \\Gamma_\\alpha$.\n\nThird, the energy-resolved retarded Green's function $G^r(E)$ is computed by inverting the effective Hamiltonian of the open system:\n$$\nG^r(E) \\;=\\; \\left[(E + i\\eta)I - H - \\Sigma^r(E)\\right]^{-1}\n$$\nHere, $I$ is the $N \\times N$ identity matrix and $\\eta = 10^{-12}$ is a small positive infinitesimal added for numerical stability. The advanced Green's function is then found via the relation $G^a(E) = (G^r(E))^\\dagger$, where $\\dagger$ denotes the conjugate transpose.\n\nFourth, the transmission probability $T_{\\alpha\\beta}(E)$ between any two terminals $\\alpha$ and $\\beta$ is calculated using the Caroli formula:\n$$\nT_{\\alpha\\beta}(E) \\;=\\; \\mathrm{Tr}\\left[\\Gamma_\\alpha G^r(E) \\Gamma_\\beta G^a(E)\\right]\n$$\nGiven the sparse nature of the $\\Gamma_\\alpha$ matrices, this expression simplifies to a much more computationally efficient form. Since $\\Gamma_\\alpha$ has only one non-zero entry, $\\gamma_\\alpha$, at position $(i_\\alpha, i_\\alpha)$, the trace reduces to:\n$$\nT_{\\alpha\\beta}(E) \\;=\\; \\gamma_\\alpha \\gamma_\\beta |G^r_{i_\\alpha, i_\\beta}(E)|^2\n$$\nwhere $G^r_{i_\\alpha, i_\\beta}(E)$ is the element of the retarded Green's function matrix connecting the coupling sites of terminals $\\alpha$ and $\\beta$. This calculation is performed for all pairs of terminals. A key property, which follows from time-reversal symmetry in our system (real Hamiltonian $H$ and no magnetic field), is that $T_{\\alpha\\beta}(E) = T_{\\beta\\alpha}(E)$.\n\nFifth, the energy-resolved occupation functions $f_\\alpha(E)$ for all terminals are determined. For external leads $\\ell$, these are given by the Fermi-Dirac distribution:\n$$\nf_\\ell(E) \\;=\\; \\frac{1}{1 + \\exp\\left(\\frac{E - \\mu_\\ell}{T}\\right)}\n$$\nFor Büttiker probes $p$, the occupation $f_p(E)$ is unknown and must be calculated by enforcing the condition of zero net spectral current into each probe at every energy, $I_p(E) = 0$. This condition leads to a system of linear equations for the unknown probe occupations $\\{f_p(E)\\}$. For each probe $p$:\n$$\n0 \\;=\\; I_p(E) \\;=\\; \\frac{1}{2\\pi}\\sum_{\\beta} T_{p\\beta}(E)(f_p(E) - f_\\beta(E))\n$$\nRearranging this for all probes yields a linear system $A \\vec{f}_P = \\vec{b}$, where $\\vec{f}_P$ is the vector of unknown probe occupations. The matrix $A$ and vector $\\vec{b}$ are constructed from the transmission probabilities $T_{\\alpha\\beta}(E)$ and the known lead occupations $\\{f_\\ell(E)\\}$. This system is solved at each energy $E$ to find $\\{f_p(E)\\}$.\n\nSixth, with all occupation functions known, the spectral current $I_\\alpha(E)$ for every terminal $\\alpha$ is computed:\n$$\nI_\\alpha(E) \\;=\\; \\frac{1}{2\\pi}\\sum_{\\beta} T_{\\alpha\\beta}(E)(f_\\alpha(E) - f_\\beta(E))\n$$\n\nFinally, the local continuity equation at the energy-resolved level, $\\sum_\\alpha I_\\alpha(E) = 0$, is checked. Analytically, this sum must be zero because $T_{\\alpha\\beta}(E) = T_{\\beta\\alpha}(E)$. We compute the numerical sum and take its absolute value, $\\left|\\sum_{\\alpha} I_\\alpha(E)\\right|$. The maximum of these absolute values over the entire energy set $\\mathcal{E}$ for a given test case is the quantity to be reported. This entire procedure is repeated for each of the four test cases.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the four test cases for the quantum transport problem and prints the results.\n    \"\"\"\n    eta = 1e-12\n\n    test_cases = [\n        {\n            \"N\": 5, \"t\": 1.0, \"epsilons\": [0.0, 0.2, -0.1, 0.1, 0.0],\n            \"terminals\": [\n                {'type': 'lead', 'site': 0, 'gamma': 0.6, 'mu': 0.2},\n                {'type': 'lead', 'site': 4, 'gamma': 0.9, 'mu': -0.15},\n                {'type': 'probe', 'site': 1, 'gamma': 0.5},\n                {'type': 'probe', 'site': 3, 'gamma': 0.4},\n            ],\n            \"T\": 0.05,\n            \"E_set\": [-2.0, -0.5, 0.0, 0.8, 2.0]\n        },\n        {\n            \"N\": 4, \"t\": 1.0, \"epsilons\": [0.0, 0.0, 0.0, 0.0],\n            \"terminals\": [\n                {'type': 'lead', 'site': 0, 'gamma': 0.5, 'mu': 0.1},\n                {'type': 'lead', 'site': 3, 'gamma': 0.7, 'mu': -0.1},\n            ],\n            \"T\": 0.02,\n            \"E_set\": [-3.0, -1.0, 0.0, 1.0, 3.0]\n        },\n        {\n            \"N\": 3, \"t\": 1.0, \"epsilons\": [0.0, 0.0, 0.0],\n            \"terminals\": [\n                {'type': 'lead', 'site': 0, 'gamma': 0.8, 'mu': 0.0},\n                {'type': 'lead', 'site': 2, 'gamma': 0.8, 'mu': 0.0},\n            ],\n            \"T\": 0.1,\n            \"E_set\": [-1.5, 0.0, 1.5]\n        },\n        {\n            \"N\": 1, \"t\": 1.0, \"epsilons\": [0.0],\n            \"terminals\": [\n                {'type': 'lead', 'site': 0, 'gamma': 1.0, 'mu': 0.3},\n                {'type': 'lead', 'site': 0, 'gamma': 1.0, 'mu': -0.2},\n                {'type': 'probe', 'site': 0, 'gamma': 0.3},\n            ],\n            \"T\": 0.05,\n            \"E_set\": [0.0]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        max_violation = calculate_max_violation(eta=eta, **case)\n        results.append(max_violation)\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\ndef fermi_dirac(E, mu, T):\n    \"\"\"\n    Computes the Fermi-Dirac distribution function.\n    \"\"\"\n    if T == 0.0:\n        return 1.0 if E  mu else 0.0\n    \n    arg = (E - mu) / T\n    # Avoid numerical overflow for large positive arguments\n    if arg > 100:\n        return 0.0\n    return 1.0 / (1.0 + np.exp(arg))\n\ndef calculate_max_violation(N, t, epsilons, terminals, T, E_set, eta):\n    \"\"\"\n    Calculates the maximum absolute violation of the current continuity equation for a single test case.\n    \"\"\"\n    num_terminals = len(terminals)\n    terminal_sites = [term['site'] for term in terminals]\n    terminal_gammas = [term['gamma'] for term in terminals]\n    \n    # Construct the device Hamiltonian H\n    H = np.diag(np.array(epsilons, dtype=float))\n    if N > 1:\n        H += np.diag(-t * np.ones(N - 1), 1)\n        H += np.diag(-t * np.ones(N - 1), -1)\n\n    # Construct the total retarded self-energy Sigma^r\n    Sigma_r_total = np.zeros((N, N), dtype=np.complex128)\n    for i in range(num_terminals):\n        site = terminal_sites[i]\n        gamma = terminal_gammas[i]\n        Sigma_r_total[site, site] += -0.5j * gamma\n\n    max_violation_for_case = 0.0\n\n    for E in E_set:\n        # Compute the retarded Green's function G^r\n        G_r = np.linalg.inv((E + 1j * eta) * np.eye(N) - H - Sigma_r_total)\n\n        # Compute the transmission matrix T_{\\alpha\\beta}\n        T_matrix = np.zeros((num_terminals, num_terminals))\n        for i in range(num_terminals):\n            for j in range(num_terminals):\n                ia, ib = terminal_sites[i], terminal_sites[j]\n                ga, gb = terminal_gammas[i], terminal_gammas[j]\n                T_matrix[i, j] = ga * gb * np.abs(G_r[ia, ib])**2\n\n        # Determine occupation functions f_\\alpha\n        f_alpha = np.zeros(num_terminals)\n        leads = [i for i, term in enumerate(terminals) if term['type'] == 'lead']\n        probes = [i for i, term in enumerate(terminals) if term['type'] == 'probe']\n        \n        for i in leads:\n            f_alpha[i] = fermi_dirac(E, terminals[i]['mu'], T)\n\n        if probes:\n            num_probes = len(probes)\n            A = np.zeros((num_probes, num_probes))\n            b = np.zeros(num_probes)\n            \n            for i, p_i_idx in enumerate(probes):\n                b[i] = sum(T_matrix[p_i_idx, l_idx] * f_alpha[l_idx] for l_idx in leads)\n                \n                sum_T_pi_beta = np.sum(T_matrix[p_i_idx, :])\n                for j, p_j_idx in enumerate(probes):\n                    A[i, j] = -T_matrix[p_i_idx, p_j_idx]\n                A[i, i] += sum_T_pi_beta\n\n            if num_probes > 0:\n                try:\n                    f_probes = np.linalg.solve(A, b)\n                    for i, p_idx in enumerate(probes):\n                        f_alpha[p_idx] = f_probes[i]\n                except np.linalg.LinAlgError:\n                    # If matrix is singular, probes are decoupled, their f_p is irrelevant\n                    # as no current can flow. The current sum remains valid.\n                    pass\n\n        # Compute spectral currents I_\\alpha\n        currents = np.zeros(num_terminals)\n        for i in range(num_terminals):\n            currents[i] = (1.0 / (2.0 * np.pi)) * np.sum(T_matrix[i,:] * (f_alpha[i] - f_alpha))\n        \n        # Calculate violation for the current energy E\n        total_current_violation = np.abs(np.sum(currents))\n        max_violation_for_case = max(max_violation_for_case, total_current_violation)\n        \n    return max_violation_for_case\n\nsolve()\n```", "id": "3482901"}, {"introduction": "With a validated multi-terminal NEGF solver, we can now simulate one of the most striking phenomena in mesoscopic physics: the Aharonov-Bohm effect. This practice guides you through the simulation of conductance oscillations in a ring geometry threaded by a magnetic flux, a direct manifestation of quantum interference. By incorporating magnetic fields via Peierls phases and modeling decoherence with Büttiker probes, you will directly observe the transition from quantum-coherent to classical transport, gaining hands-on insight into the principles governing nanoscale electronics [@problem_id:3482866].", "problem": "You are tasked with implementing a computational experiment using the Non-Equilibrium Green’s Function (NEGF) formalism to study quantum transport in a mesoscopic ring geometry that exhibits Aharonov–Bohm oscillations. The ring is modeled as a single-band tight-binding lattice with $N$ sites, nearest-neighbor hopping, and complex Peierls phases on the hopping terms to account for a perpendicular magnetic field $B$ threading the ring. Two external leads are attached to the ring at opposite sites, and dephasing is introduced via Büttiker voltage probes attached to selected ring sites. Your program must compute the two-terminal conductance $G(B)$ in units of $2e^2/h$ and quantify the oscillation amplitude as a function of dephasing strength and probe density.\n\nFoundational base to use:\n- The retarded Green’s function, $G^r(E)$, for the device region is defined by\n$$\nG^r(E) = \\left[E + i0^+ - H - \\sum_\\alpha \\Sigma_\\alpha\\right]^{-1},\n$$\nwhere $H$ is the device Hamiltonian and $\\Sigma_\\alpha$ are self-energies for each terminal $\\alpha$ (leads and probes).\n- The tight-binding Hamiltonian on a ring with nearest-neighbor hopping $t$ and Peierls phase $\\varphi$ per bond is\n$$\nH_{i,i+1} = -t\\, e^{i\\varphi}, \\quad H_{i+1,i} = -t\\, e^{-i\\varphi},\n$$\nwith periodic boundary conditions $i+N \\equiv i$, and $\\sum_{\\text{bonds around ring}} \\varphi = 2\\pi \\Phi/\\Phi_0$, where $\\Phi = B A$ is the magnetic flux, $A$ is the ring area, and $\\Phi_0 = h/e$ is the flux quantum.\n- In the wide-band limit, a terminal $\\alpha$ coupled to site $i_\\alpha$ with coupling rate $\\gamma_\\alpha$ produces a self-energy\n$$\n\\Sigma_\\alpha = -i\\gamma_\\alpha \\, |i_\\alpha\\rangle\\langle i_\\alpha|, \\quad \\Gamma_\\alpha = i\\left(\\Sigma_\\alpha - \\Sigma_\\alpha^\\dagger\\right) = 2\\gamma_\\alpha\\, |i_\\alpha\\rangle\\langle i_\\alpha|.\n$$\n- The multi-terminal Landauer–Büttiker current relation in linear response is\n$$\nI_\\alpha = \\frac{2e^2}{h}\\sum_\\beta T_{\\alpha\\beta}(V_\\alpha - V_\\beta),\n$$\nwith transmission\n$$\nT_{\\alpha\\beta}(E) = \\mathrm{Tr}\\left[\\Gamma_\\alpha G^r(E)\\,\\Gamma_\\beta G^a(E)\\right],\n$$\nand $G^a = \\left(G^r\\right)^\\dagger$. In the single-site wide-band coupling case, this reduces to\n$$\nT_{\\alpha\\beta}(E) = \\Gamma_\\alpha \\Gamma_\\beta \\left|G^r_{i_\\alpha,i_\\beta}(E)\\right|^2.\n$$\n- Büttiker probes model dephasing by adding terminals at selected sites with coupling $\\eta$ and unknown potentials $V_p$, determined by enforcing zero net current into each probe, $I_p=0$.\n\nYour task:\n1. Construct a ring Hamiltonian $H$ of size $N\\times N$ with nearest-neighbor hopping $t$ and uniform Peierls phase per bond so that the total phase accumulated around the ring equals $2\\pi\\Phi/\\Phi_0$. Use a ring radius $R$ to define area $A=\\pi R^2$. Use periodic boundary conditions and set all onsite energies to $0$. Use $t=1$.\n2. Attach two leads at sites $i_L=0$ and $i_R=N/2$ (assume $N$ is even), modeled in the wide-band limit with self-energies $\\Sigma_L=-i\\gamma\\,|i_L\\rangle\\langle i_L|$ and $\\Sigma_R=-i\\gamma\\,|i_R\\rangle\\langle i_R|$, with $\\gamma=0.5$. Let the Fermi energy be $E_F=0$ and add a small numerical regularization $i\\delta$ with $\\delta=10^{-12}$ to $E_F$.\n3. Add Büttiker probes at specified subsets of ring sites with coupling $\\eta$ (wide-band, single-site), each contributing a self-energy $\\Sigma_p=-i\\eta\\,|i_p\\rangle\\langle i_p|$ and broadening $\\Gamma_p=2\\eta\\,|i_p\\rangle\\langle i_p|$, and treat them as voltage probes with unknown potentials $V_p$.\n4. For a given magnetic field $B$, compute the retarded Green’s function $G^r(E_F)$ and all transmissions $T_{\\alpha\\beta}(E_F)$ among terminals. Build the linear system for multi-terminal currents, enforce $I_p=0$ for probes, and apply source–drain bias by fixing $V_L=+1/2$ and $V_R=-1/2$. Determine $V_p$ by imposing $I_p=0$ via the linear Landauer–Büttiker relations.\n5. Compute the dimensionless two-terminal conductance $g(B)$, defined by\n$$\ng(B) = \\frac{I_L}{V_L - V_R},\n$$\nwhich equals $G(B)$ in units of $2e^2/h$.\n6. Investigate Aharonov–Bohm oscillations across one flux quantum by sweeping $B$ from $0$ to $B_{\\max}=\\Phi_0/A$ and evaluating $g(B)$ at $51$ equally spaced values including endpoints. Quantify the oscillation amplitude as\n$$\n\\Delta g = \\max_{B\\in[0,B_{\\max}]} g(B) - \\min_{B\\in[0,B_{\\max}]} g(B).\n$$\n7. Implement three distinct dephasing configurations using Büttiker probes to study the dependence of oscillation amplitude on dephasing strength and probe density.\n\nPhysical units and constants:\n- Use $B$ in Tesla.\n- Use $R$ in meters and area $A=\\pi R^2$ in $\\mathrm{m}^2$.\n- Use the electron charge $e$ in Coulombs and Planck’s constant $h$ in Joule-seconds, with the flux quantum $\\Phi_0=h/e$ in Webers ($\\mathrm{Wb}$).\n- Report conductance in units of $2e^2/h$ as dimensionless floats.\n\nTest suite specification:\n- Common parameters: $N=40$, $t=1$, $E_F=0$, $\\delta=10^{-12}$, $\\gamma=0.5$, $R=50\\times 10^{-9}\\,\\mathrm{m}$, $i_L=0$, $i_R=20$, $B\\in[0,B_{\\max}]$ with $51$ points.\n- Case A (coherent reference): no probes, $\\eta=0$.\n- Case B (weak dephasing, sparse probes): probes at $i_p\\in\\{4,8,12,16,24,28,32,36\\}$, $\\eta=0.05$.\n- Case C (strong dephasing, dense probes): probes at all sites except $i_L$ and $i_R$, $\\eta=0.5$.\n\nRequired outputs per case:\n- $g(0)$ at $B=0$,\n- $g(\\Phi_0/2A)$ at $B=B_{\\max}/2$,\n- $\\Delta g$ over the sweep $B\\in[0,B_{\\max}]$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order\n$$\n\\left[g_A(0),\\, g_A(B_{\\max}/2),\\, \\Delta g_A,\\, g_B(0),\\, g_B(B_{\\max}/2),\\, \\Delta g_B,\\, g_C(0),\\, g_C(B_{\\max}/2),\\, \\Delta g_C\\right],\n$$\nwhere each entry is a float rounded to six decimal places. No additional text should be printed.", "solution": "The problem requires the implementation of a quantum transport calculation based on the Non-Equilibrium Green's Function (NEGF) formalism to study the Aharonov-Bohm effect in a mesoscopic ring subjected to dephasing. The solution involves constructing the system's Hamiltonian, accounting for external connections via self-energies, calculating the Green's function and transmission probabilities, and finally solving for the two-terminal conductance. Dephasing is modeled using Büttiker's voltage probes, which requires solving a self-consistent problem for the probe potentials.\n\nThe solution is implemented through a series of computational steps for each specified physical configuration:\n\n1.  **System Definition**: The core of the device is a one-dimensional ring with $N$ sites described by a tight-binding model. The Hamiltonian matrix $H$, of size $N \\times N$, has zero on-site energies ($H_{i,i}=0$) and nearest-neighbor hopping terms of magnitude $t$. A magnetic field $B$ perpendicular to the ring's area $A$ introduces a magnetic flux $\\Phi = BA$. This is incorporated into the Hamiltonian via the Peierls substitution, which imparts a complex phase to the hopping elements. The phase accumulated over a single bond is uniform and given by $\\varphi = \\frac{2\\pi}{N} \\frac{\\Phi}{\\Phi_0}$, where $\\Phi_0=h/e$ is the magnetic flux quantum. The Hamiltonian matrix elements are thus:\n    $$\n    H_{i,j} =\n    \\begin{cases}\n    -t e^{i\\varphi}    \\text{if } j = (i+1) \\pmod N \\\\\n    -t e^{-i\\varphi}   \\text{if } j = (i-1) \\pmod N \\\\\n    0                  \\text{otherwise}\n    \\end{cases}\n    $$\n    We set the hopping energy $t=1$ as the unit of energy.\n\n2.  **Terminal Self-Energies**: The ring is connected to external terminals: two leads (source $L$ and drain $R$) and a set of Büttiker voltage probes used to model dephasing. Each terminal $\\alpha$, coupled to a single site $i_\\alpha$ of the ring, contributes a self-energy term $\\Sigma_\\alpha$ to the system. In the wide-band approximation, this self-energy is local and purely imaginary:\n    $$\n    \\Sigma_\\alpha = -i\\gamma_\\alpha |i_\\alpha\\rangle\\langle i_\\alpha|\n    $$\n    where $|i_\\alpha\\rangle$ is the basis vector for site $i_\\alpha$, and $\\gamma_\\alpha$ is the coupling strength. For the leads, the coupling is $\\gamma=0.5$, and for the probes, it is $\\eta$. The total self-energy matrix $\\Sigma$ is the sum of contributions from all terminals: $\\Sigma = \\sum_\\alpha \\Sigma_\\alpha$.\n\n3.  **Retarded Green's Function**: The central quantity in the NEGF formalism is the retarded Green's function $G^r(E)$, which describes the propagation of an electron with energy $E$ through the device. It is obtained by inverting a matrix representing the effective Hamiltonian of the open system:\n    $$\n    G^r(E) = \\left[ (E + i\\delta)I - H - \\Sigma \\right]^{-1}\n    $$\n    Here, $I$ is the identity matrix, and $\\delta$ is an infinitesimal positive number ($10^{-12}$ in this implementation) ensuring the \"retarded\" nature of the Green's function. All calculations are performed at the Fermi energy, $E=E_F=0$.\n\n4.  **Transmission Probabilities**: The probability for an electron to transmit from terminal $\\beta$ to terminal $\\alpha$ is given by the Landauer-Büttiker formula:\n    $$\n    T_{\\alpha\\beta}(E) = \\mathrm{Tr}\\left[\\Gamma_\\alpha G^r(E) \\Gamma_\\beta G^a(E)\\right]\n    $$\n    where $G^a(E) = (G^r(E))^\\dagger$ is the advanced Green's function and $\\Gamma_\\alpha(E) = i(\\Sigma_\\alpha(E) - \\Sigma_\\alpha^\\dagger(E))$ is the broadening function describing the rate of electron escape into terminal $\\alpha$. For our single-site, wide-band coupling model, this simplifies to $\\Gamma_\\alpha = 2\\gamma_\\alpha |i_\\alpha\\rangle\\langle i_\\alpha|$ and the transmission formula reduces to:\n    $$\n    T_{\\alpha\\beta} = (2\\gamma_\\alpha)(2\\gamma_\\beta) \\left|G^r_{i_\\alpha, i_\\beta}\\right|^2\n    $$\n    where $G^r_{i_\\alpha, i_\\beta}$ is the matrix element of the Green's function between the coupling sites of terminals $\\alpha$ and $\\beta$.\n\n5.  **Büttiker Probes and Dephasing**: Dephasing processes scatter electrons between different momentum states, destroying phase coherence. Büttiker's model simulates this by introducing fictitious voltage probes that draw no net current. For each probe $p$, the condition $I_p=0$ must be satisfied. According to the multi-terminal Landauer formula, the current into terminal $\\alpha$ is $I_\\alpha = \\frac{2e^2}{h} \\sum_{\\beta \\neq \\alpha} T_{\\alpha\\beta} (V_\\alpha - V_\\beta)$. The condition $I_p=0$ for all probes $p$ generates a system of linear equations for the unknown probe potentials $V_p$:\n    $$\n    \\sum_{\\beta \\neq p} T_{p\\beta} (V_p - V_\\beta) = 0 \\quad \\implies \\quad \\left(\\sum_{\\beta \\neq p} T_{p\\beta}\\right) V_p - \\sum_{\\beta \\neq p, \\text{probe}} T_{p\\beta} V_\\beta = T_{pL}V_L + T_{pR}V_R\n    $$\n    This linear system is constructed and solved for the vector of probe potentials $\\{V_p\\}$, given the fixed lead potentials $V_L = +1/2$ and $V_R = -1/2$.\n\n6.  **Conductance Calculation**: Once all terminal potentials are known, the current $I_L$ flowing from the source lead is calculated. The dimensionless conductance $g(B)$, in units of $2e^2/h$, is then given by:\n    $$\n    g(B) = \\frac{I_L / (2e^2/h)}{V_L - V_R} = \\sum_{\\beta \\neq L} T_{L\\beta}(V_L - V_\\beta)\n    $$\n    since we define $V_L - V_R = 1$.\n\n7.  **Aharonov-Bohm Oscillations Analysis**: To observe the Aharonov-Bohm effect, the entire calculation is repeated for a series of magnetic field values. The field $B$ is swept from $0$ to $B_{\\max} = \\Phi_0/A$, which corresponds to sweeping the magnetic flux $\\Phi$ through the ring from $0$ to one flux quantum $\\Phi_0$. This sweep is performed over $51$ equally spaced points. The conductance $g(B)$ is stored for each point. From the resulting curve, the required quantities are extracted: $g(0)$, $g(B_{\\max}/2)$, and the oscillation amplitude $\\Delta g = \\max(g) - \\min(g)$. This procedure is carried out for three different dephasing configurations as specified in the problem statement.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_conductance(flux_ratio, probe_sites, eta, N, t, E_F, delta, gamma, i_L, i_R, V_L, V_R):\n    \"\"\"\n    Computes the two-terminal dimensionless conductance for a mesoscopic ring.\n\n    This function implements the NEGF formalism for a tight-binding ring with leads and\n    Büttiker probes, calculating the conductance for a given magnetic flux.\n    \"\"\"\n    # 1. Construct the tight-binding Hamiltonian H for the ring\n    H = np.zeros((N, N), dtype=complex)\n    phase = (2 * np.pi / N) * flux_ratio\n    exp_phase = np.exp(1j * phase)\n    \n    for i in range(N - 1):\n        H[i, i + 1] = -t * exp_phase\n        H[i + 1, i] = -t * np.conj(exp_phase)\n    # Periodic boundary conditions for the ring\n    H[N - 1, 0] = -t * exp_phase\n    H[0, N - 1] = -t * np.conj(exp_phase)\n    \n    # 2. Construct the total self-energy matrix Sigma from all terminals\n    Sigma = np.zeros((N, N), dtype=complex)\n    Sigma[i_L, i_L] = -1j * gamma\n    Sigma[i_R, i_R] = -1j * gamma\n    for p_site in probe_sites:\n        Sigma[p_site, p_site] -= 1j * eta\n        \n    # 3. Calculate the retarded Green's function G^r\n    E = E_F + 1j * delta\n    G_r = np.linalg.inv(E * np.eye(N) - H - Sigma)\n    \n    # 4. Define terminals and calculate the transmission matrix T\n    terminals = [(i_L, gamma), (i_R, gamma)] + [(p, eta) for p in probe_sites]\n    num_terminals = len(terminals)\n    T = np.zeros((num_terminals, num_terminals))\n\n    for alpha in range(num_terminals):\n        for beta in range(alpha + 1, num_terminals):\n            i_alpha, gamma_alpha = terminals[alpha]\n            i_beta, gamma_beta = terminals[beta]\n            \n            trans = 4 * gamma_alpha * gamma_beta * np.abs(G_r[i_alpha, i_beta])**2\n            T[alpha, beta] = trans\n            T[beta, alpha] = trans\n\n    # 5. Solve for probe voltages if probes are present\n    num_probes = len(probe_sites)\n    if num_probes == 0:\n        # For the coherent case with no probes, conductance is simply T_LR\n        # with V_L - V_R = 1\n        g = T[0, 1]\n        return g\n\n    # Set up and solve the linear system for probe potentials\n    A_matrix = np.zeros((num_probes, num_probes))\n    b_vector = np.zeros(num_probes)\n    \n    # Terminal indices: L=0, R=1, probes=2 to num_probes+1\n    for k in range(num_probes):  # Matrix row index, corresponding to probe k\n        alpha = k + 2  # Terminal index for probe k\n        \n        # Right-hand side of the linear system\n        b_vector[k] = T[alpha, 0] * V_L + T[alpha, 1] * V_R\n        \n        # Left-hand side matrix A\n        A_matrix[k, k] = np.sum(T[alpha, :]) - T[alpha, alpha] # On-diagonal: sum of transmissions from probe\n        for m in range(num_probes): # Matrix column index\n            if k != m:\n                beta = m + 2 # Terminal index for probe m\n                A_matrix[k, m] = -T[alpha, beta]\n            \n    probe_voltages = np.linalg.solve(A_matrix, b_vector)\n    \n    # 6. Calculate the final two-terminal conductance\n    all_voltages = np.zeros(num_terminals)\n    all_voltages[0] = V_L\n    all_voltages[1] = V_R\n    all_voltages[2:] = probe_voltages\n    \n    # Calculate dimensionless current out of lead L (index 0)\n    i_L_dim = 0.0\n    for beta in range(1, num_terminals):\n        i_L_dim += T[0, beta] * (all_voltages[0] - all_voltages[beta])\n        \n    g = i_L_dim  # Since V_L - V_R = 1\n    return g\n\ndef solve():\n    \"\"\"\n    Main function to run the quantum transport experiment for all test cases.\n    \"\"\"\n    # Common physical and numerical parameters\n    N = 40\n    t = 1.0\n    E_F = 0.0\n    delta = 1e-12\n    gamma = 0.5\n    i_L = 0\n    i_R = 20\n    V_L_bias = 0.5\n    V_R_bias = -0.5\n    \n    # Magnetic field sweep parameters\n    num_b_points = 51\n    # We sweep the dimensionless flux ratio Phi/Phi_0 from 0 to 1.\n    flux_ratios = np.linspace(0.0, 1.0, num_b_points)\n\n    # Define the three test cases as specified\n    probe_sites_C = [i for i in range(N) if i not in [i_L, i_R]]\n    test_cases = [\n        {'name': 'A', 'probe_sites': [], 'eta': 0.0},\n        {'name': 'B', 'probe_sites': [4, 8, 12, 16, 24, 28, 32, 36], 'eta': 0.05},\n        {'name': 'C', 'probe_sites': probe_sites_C, 'eta': 0.5}\n    ]\n\n    results = []\n\n    for case in test_cases:\n        probe_sites = case['probe_sites']\n        eta = case['eta']\n        \n        g_values = []\n        for flux_ratio in flux_ratios:\n            g = calculate_conductance(flux_ratio, probe_sites, eta, N, t, E_F, delta, gamma, i_L, i_R, V_L_bias, V_R_bias)\n            g_values.append(g)\n            \n        g_values = np.array(g_values)\n        \n        # Extract required results for the current case\n        g_zero_flux = g_values[0]  # B=0 corresponds to flux_ratio=0\n        # B = B_max/2 corresponds to flux_ratio=0.5. Index is (51-1)/2 = 25.\n        g_half_flux_idx = num_b_points // 2\n        g_half_flux = g_values[g_half_flux_idx]\n        delta_g = np.max(g_values) - np.min(g_values)\n        \n        results.extend([g_zero_flux, g_half_flux, delta_g])\n\n    # Print the final results in the required format\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "3482866"}]}