{"hands_on_practices": [{"introduction": "Understanding the reciprocal lattice begins with its mathematical construction from the direct lattice. This exercise walks you through the foundational calculation of reciprocal lattice vectors for the most straightforward case: a simple cubic crystal. By applying the defining relation $\\mathbf{a}_{i} \\cdot \\mathbf{b}_{j} = 2\\pi \\delta_{ij}$, you will not only derive the reciprocal basis but also identify the resulting lattice type and the shape of its first Brillouin zone, solidifying your grasp of this essential duality in crystallography [@problem_id:3485405].", "problem": "In plane-wave implementations of Density Functional Theory (DFT), the reciprocal lattice and the first Brillouin zone determine the sampling of wave vectors in the Fast Fourier Transform (FFT) grid used for evaluating kinetic energy and nonlocal projectors. Consider a three-dimensional crystal whose primitive direct lattice vectors are given by $\\mathbf{a}_{1}=(a,0,0)$, $\\mathbf{a}_{2}=(0,a,0)$, and $\\mathbf{a}_{3}=(0,0,a)$ with $a0$. Starting from the fundamental definition of the reciprocal lattice basis $\\{\\mathbf{b}_{1},\\mathbf{b}_{2},\\mathbf{b}_{3}\\}$ as the unique set of vectors satisfying $\\mathbf{a}_{i}\\cdot\\mathbf{b}_{j}=2\\pi\\,\\delta_{ij}$ for $i,j\\in\\{1,2,3\\}$, and using the scalar triple product identity for the primitive cell volume $V=\\mathbf{a}_{1}\\cdot(\\mathbf{a}_{2}\\times\\mathbf{a}_{3})$, derive the explicit expressions for $\\mathbf{b}_{1}$, $\\mathbf{b}_{2}$, and $\\mathbf{b}_{3}$. Then, by analyzing the metric tensor of the reciprocal basis, identify the Bravais lattice type of the reciprocal lattice and state the geometric shape of the first Brillouin zone along with its edge length as a function of $a$. Express your final answer as a single $3\\times 3$ matrix whose columns are $\\mathbf{b}_{1}$, $\\mathbf{b}_{2}$, and $\\mathbf{b}_{3}$. No rounding is required, and no units should be included in the final expression.", "solution": "The reciprocal lattice basis $\\{\\mathbf{b}_{1},\\mathbf{b}_{2},\\mathbf{b}_{3}\\}$ is defined by the orthogonality and normalization conditions\n$$\n\\mathbf{a}_{i}\\cdot\\mathbf{b}_{j}=2\\pi\\,\\delta_{ij},\\quad i,j\\in\\{1,2,3\\}.\n$$\nThe primitive cell volume of the direct lattice is given by the scalar triple product\n$$\nV=\\mathbf{a}_{1}\\cdot(\\mathbf{a}_{2}\\times\\mathbf{a}_{3}).\n$$\nFor the given orthogonal direct basis $\\mathbf{a}_{1}=(a,0,0)$, $\\mathbf{a}_{2}=(0,a,0)$, $\\mathbf{a}_{3}=(0,0,a)$, we first compute $V$. The cross product $\\mathbf{a}_{2}\\times\\mathbf{a}_{3}$ is\n$$\n\\mathbf{a}_{2}\\times\\mathbf{a}_{3}=(0,a,0)\\times(0,0,a)=(a^{2},0,0),\n$$\nand hence\n$$\nV=\\mathbf{a}_{1}\\cdot(\\mathbf{a}_{2}\\times\\mathbf{a}_{3})=(a,0,0)\\cdot(a^{2},0,0)=a^{3}.\n$$\nWe now solve for $\\mathbf{b}_{1}$, $\\mathbf{b}_{2}$, and $\\mathbf{b}_{3}$ using the defining conditions. Let $\\mathbf{b}_{1}=(b_{1x},b_{1y},b_{1z})$. The conditions\n$$\n\\mathbf{a}_{1}\\cdot\\mathbf{b}_{1}=2\\pi,\\quad \\mathbf{a}_{2}\\cdot\\mathbf{b}_{1}=0,\\quad \\mathbf{a}_{3}\\cdot\\mathbf{b}_{1}=0\n$$\nbecome\n$$\n(a,0,0)\\cdot(b_{1x},b_{1y},b_{1z})=a\\,b_{1x}=2\\pi,\\quad\n(0,a,0)\\cdot(b_{1x},b_{1y},b_{1z})=a\\,b_{1y}=0,\\quad\n(0,0,a)\\cdot(b_{1x},b_{1y},b_{1z})=a\\,b_{1z}=0.\n$$\nTherefore,\n$$\nb_{1x}=\\frac{2\\pi}{a},\\quad b_{1y}=0,\\quad b_{1z}=0,\n$$\nand\n$$\n\\mathbf{b}_{1}=\\left(\\frac{2\\pi}{a},\\,0,\\,0\\right).\n$$\nBy symmetry, the same procedure yields\n$$\n\\mathbf{b}_{2}=\\left(0,\\,\\frac{2\\pi}{a},\\,0\\right),\\quad \\mathbf{b}_{3}=\\left(0,\\,0,\\,\\frac{2\\pi}{a}\\right).\n$$\nEquivalently, these results are consistent with the general construction\n$$\n\\mathbf{b}_{1}=2\\pi\\,\\frac{\\mathbf{a}_{2}\\times\\mathbf{a}_{3}}{V},\\quad\n\\mathbf{b}_{2}=2\\pi\\,\\frac{\\mathbf{a}_{3}\\times\\mathbf{a}_{1}}{V},\\quad\n\\mathbf{b}_{3}=2\\pi\\,\\frac{\\mathbf{a}_{1}\\times\\mathbf{a}_{2}}{V},\n$$\nderived from the definition $\\mathbf{a}_{i}\\cdot\\mathbf{b}_{j}=2\\pi\\,\\delta_{ij}$ and properties of the scalar triple product.\n\nTo identify the Bravais lattice type of the reciprocal lattice, we analyze the metric tensor $G^{*}$ of the reciprocal basis, whose entries are $G^{*}_{ij}=\\mathbf{b}_{i}\\cdot\\mathbf{b}_{j}$. We have\n$$\n\\mathbf{b}_{1}\\cdot\\mathbf{b}_{1}=\\left(\\frac{2\\pi}{a}\\right)^{2},\\quad \\mathbf{b}_{2}\\cdot\\mathbf{b}_{2}=\\left(\\frac{2\\pi}{a}\\right)^{2},\\quad \\mathbf{b}_{3}\\cdot\\mathbf{b}_{3}=\\left(\\frac{2\\pi}{a}\\right)^{2},\n$$\nand\n$$\n\\mathbf{b}_{i}\\cdot\\mathbf{b}_{j}=0\\quad \\text{for}\\quad i\\neq j,\n$$\nso\n$$\nG^{*}=\\left(\\frac{2\\pi}{a}\\right)^{2}\\,I_{3},\n$$\nwith $I_{3}$ the $3\\times 3$ identity matrix. This shows the reciprocal lattice basis is orthogonal with equal lengths, i.e., the reciprocal lattice is a simple cubic Bravais lattice with lattice constant $\\frac{2\\pi}{a}$.\n\nThe first Brillouin zone, being the Wigner–Seitz cell of a simple cubic reciprocal lattice, is a cube centered at the origin bounded by planes at $k_{x}=\\pm\\frac{\\pi}{a}$, $k_{y}=\\pm\\frac{\\pi}{a}$, and $k_{z}=\\pm\\frac{\\pi}{a}$. Its edge length is therefore $2\\,\\frac{\\pi}{a}$.\n\nFinally, the requested $3\\times 3$ matrix whose columns are $\\mathbf{b}_{1}$, $\\mathbf{b}_{2}$, and $\\mathbf{b}_{3}$ is\n$$\n\\begin{pmatrix}\n\\frac{2\\pi}{a}  0  0 \\\\\n0  \\frac{2\\pi}{a}  0 \\\\\n0  0  \\frac{2\\pi}{a}\n\\end{pmatrix}.\n$$", "answer": "$$\\boxed{\\begin{pmatrix}\\frac{2\\pi}{a}00\\\\[4pt]0\\frac{2\\pi}{a}0\\\\[4pt]00\\frac{2\\pi}{a}\\end{pmatrix}}$$", "id": "3485405"}, {"introduction": "The elegance of crystallography lies in its symmetries, which have profound practical implications for computational efficiency. By exploiting the point group symmetry of a crystal, we can reduce the computational domain from the full Brillouin zone (BZ) to a smaller, non-equivalent subset known as the Irreducible Brillouin zone (IBZ). This practice [@problem_id:3485451] guides you through the process of implementing this symmetry reduction for a Monkhorst-Pack k-point grid, demonstrating firsthand how different symmetry operations affect the size of the IBZ and, consequently, the efficiency of a materials simulation.", "problem": "You are given a simple cubic lattice in real space with primitive vectors $\\mathbf{a}_1 = a\\hat{\\mathbf{x}}$, $\\mathbf{a}_2 = a\\hat{\\mathbf{y}}$, and $\\mathbf{a}_3 = a\\hat{\\mathbf{z}}$, which defines a reciprocal lattice with primitive vectors $\\mathbf{b}_1$, $\\mathbf{b}_2$, and $\\mathbf{b}_3$ satisfying $\\mathbf{a}_i \\cdot \\mathbf{b}_j = 2\\pi \\delta_{ij}$. Consider wave vectors $\\mathbf{k}$ expressed in fractional coordinates with respect to the reciprocal basis, namely $\\mathbf{k} = k_1 \\mathbf{b}_1 + k_2 \\mathbf{b}_2 + k_3 \\mathbf{b}_3$, where each component $k_\\alpha$ is dimensionless and taken modulo integers (i.e., the reciprocal lattice periodicity is handled by component-wise equivalence $k_\\alpha \\sim k_\\alpha + n_\\alpha$ with $n_\\alpha \\in \\mathbb{Z}$).\n\nIn computational materials science, symmetry reduction of the Brillouin zone relies on the concept that two $\\mathbf{k}$-points are equivalent if they are related by a point group operation of the crystal (acting in reciprocal space) followed by a reciprocal lattice translation. For a finite sampling of $\\mathbf{k}$-space using a Monkhorst–Pack grid, define the points by the well-tested formula\n$$\nk_\\alpha(m) = \\frac{2m - N_\\alpha - 1}{2 N_\\alpha}, \\quad m \\in \\{1,2,\\dots,N_\\alpha\\},\n$$\nfor each axis $\\alpha \\in \\{x,y,z\\}$ and positive integers $N_\\alpha$. This produces a grid of $N_{\\mathrm{BZ}} = N_x N_y N_z$ points in the first Brillouin zone, with values confined to the interval $[-\\tfrac{1}{2}, \\tfrac{1}{2})$ after applying modulo-$1$ reduction.\n\nLet the Irreducible Brillouin Zone (IBZ) be the minimal set of non-equivalent $\\mathbf{k}$-points under the action of a specified point group $G$ of the lattice. We denote the number of grid points in the Irreducible Brillouin Zone by $N_{\\mathrm{IBZ}}$, and the total number of grid points by $N_{\\mathrm{BZ}}$. For a given set of symmetry operations, compute the reduction ratio $N_{\\mathrm{IBZ}} / N_{\\mathrm{BZ}}$.\n\nFundamental basis for this task:\n- The definition of reciprocal lattice vectors and their role in $\\mathbf{k}$-space periodicity.\n- The definition of point group operations acting linearly on reciprocal space coordinates, represented by integer orthogonal $3\\times 3$ matrices $S$ with entries in $\\{-1,0,1\\}$ and one nonzero entry per row and column.\n- The definition of Monkhorst–Pack grids as above.\n\nYour program must:\n1. Construct the Monkhorst–Pack grid in fractional reciprocal coordinates for each test case.\n2. Represent point group symmetries as sets of integer orthogonal matrices acting on fractional coordinates. Two $\\mathbf{k}$-points are equivalent if one can be mapped to the other by some $S \\in G$ followed by component-wise addition of integers and reduction back into $[-\\tfrac{1}{2}, \\tfrac{1}{2})$.\n3. Partition the grid into equivalence classes (orbits) under the action of $G$ and compute $N_{\\mathrm{IBZ}}$ as the number of distinct orbits.\n4. Report the ratio $N_{\\mathrm{IBZ}} / N_{\\mathrm{BZ}}$ as a float for each test case.\n\nImportant constraints and clarifications:\n- Always include the identity operation in any point group $G$.\n- For groups that permute axes (e.g., cubic rotations), require $N_x = N_y = N_z$ so that the grid is symmetry-compatible; otherwise, do not apply such a group.\n- Work entirely in fractional coordinates and use exact integer arithmetic for constructing and mapping grid points to avoid numerical tolerance issues. You may use modulo-$1$ reduction by adding or subtracting integers to bring mapped coordinates back into the canonical interval $[-\\tfrac{1}{2}, \\tfrac{1}{2})$.\n\nTest suite:\nUse the same simple cubic lattice but toggle symmetries to compare reductions on Monkhorst–Pack grids. For each case, the point group is specified by a label indicating which symmetries are active.\n\n- Case 1 (happy path): $N_x = N_y = N_z = 3$, $G =$ identity only (label \"P1\").\n- Case 2 (toggle inversion only): $N_x = N_y = N_z = 3$, $G =$ identity and inversion (label \"Ci\").\n- Case 3 (mirror-only orthorhombic sign flips): $N_x = N_y = N_z = 4$, $G =$ all diagonal sign flips $\\mathrm{diag}(s_x, s_y, s_z)$ with $s_\\alpha \\in \\{-1, +1\\}$ (label \"SignFlips\").\n- Case 4 (remove inversion, keep full cubic rotations): $N_x = N_y = N_z = 4$, $G =$ all orientation-preserving signed permutations with determinant $+1$ (label \"O_rot\").\n- Case 5 (full cubic with inversion): $N_x = N_y = N_z = 4$, $G =$ all signed permutation matrices (determinant $\\pm 1$), i.e., the full octahedral group including inversion (label \"O_h\").\n- Case 6 (boundary case): $N_x = N_y = N_z = 1$, $G =$ full octahedral including inversion (label \"O_h\").\n\nRequired final output format:\nYour program should produce a single line of output containing the six $N_{\\mathrm{IBZ}} / N_{\\mathrm{BZ}}$ results as a comma-separated list enclosed in square brackets, in the same order as the test suite cases, with each value rounded to six decimal places (e.g., \"[r1,r2,r3,r4,r5,r6]\"). No units are involved; these are dimensionless ratios.", "solution": "The user wants to compute the reduction ratio $N_{\\mathrm{IBZ}} / N_{\\mathrm{BZ}}$ for several Monkhorst-Pack $\\mathbf{k}$-point grids under various point group symmetries. $N_{\\mathrm{BZ}}$ is the total number of points in the grid, and $N_{\\mathrm{IBZ}}$ is the number of points in the Irreducible Brillouin Zone, which corresponds to the number of unique orbits of $\\mathbf{k}$-points under the action of a a point group $G$.\n\n### Principle-Based Design\n\nThe solution is founded on the principles of group theory as applied to crystalline solids in reciprocal space.\n\n1.  **Reciprocal Space and Fractional Coordinates**: The problem is set in reciprocal space. A wave vector $\\mathbf{k}$ is expressed in fractional coordinates relative to the reciprocal lattice primitive vectors $\\mathbf{b}_i$: $\\mathbf{k} = k_1 \\mathbf{b}_1 + k_2 \\mathbf{b}_2 + k_3 \\mathbf{b}_3$. This representation is standard in solid-state physics as it simplifies handling periodicity. Two points $\\mathbf{k}$ and $\\mathbf{k}'$ are equivalent if their fractional coordinates differ by an integer vector, i.e., $\\mathbf{k} - \\mathbf{k}' = n_1\\mathbf{b}_1 + n_2\\mathbf{b}_2 + n_3\\mathbf{b}_3$ for integers $n_i$. This is handled by performing calculations modulo $1$ on each fractional coordinate component.\n\n2.  **Monkhorst-Pack Grid in Integer Arithmetic**: The Monkhorst-Pack grid points are given by the formula $k_\\alpha(m) = \\frac{2m - N_\\alpha - 1}{2 N_\\alpha}$. To avoid floating-point precision issues, we can represent each fractional coordinate $k_\\alpha$ by its integer numerator $n_\\alpha = 2m - N_\\alpha - 1$, keeping in mind the common denominator structure involving $2N_\\alpha$. For a grid with $N_x = N_y = N_z = N$, all points can be represented by integer vectors $(n_x, n_y, n_z)$ with a common denominator of $2N$. This allows all symmetry operations and equivalence checks to be performed using exact integer arithmetic.\n\n3.  **Group Action and Equivalence**: A point group operation is represented by a $3 \\times 3$ integer matrix $S$. It acts linearly on a $\\mathbf{k}$-point vector. In our integer numerator representation, this action corresponds to a matrix-vector multiplication: $\\mathbf{n}' = S \\mathbf{n}$. Two points $\\mathbf{k}$ and $\\mathbf{k}''$ are considered equivalent if $\\mathbf{k}''$ can be obtained from $\\mathbf{k}$ by a symmetry operation $S \\in G$ followed by a translation by a reciprocal lattice vector. In fractional coordinates, this means $\\mathbf{k}'' = S \\mathbf{k} + \\mathbf{T}$, where $\\mathbf{T}$ is a vector of integers.\n\n4.  **Canonical Representation and Modulo Arithmetic**: To uniquely identify each point's equivalence class, we map all transformed points back to a canonical domain, the first Brillouin Zone, defined here as having fractional coordinates in $[-\\frac{1}{2}, \\frac{1}{2})$. For a coordinate $k_\\alpha = n_\\alpha / (2N_\\alpha)$, this corresponds to keeping the numerator $n_\\alpha$ in the range $[-N_\\alpha, N_\\alpha)$. A transformed numerator $n'_\\alpha$ can be mapped back to this range using the modulo operation: $n''_\\alpha = (n'_\\alpha + N_\\alpha) \\pmod{2N_\\alpha} - N_\\alpha$. This formula correctly handles the periodic boundary conditions using integer arithmetic.\n\n5.  **Orbit-Counting Algorithm**: The number of irreducible points, $N_{\\mathrm{IBZ}}$, is the number of distinct equivalence classes (orbits) of the $\\mathbf{k}$-point grid under the action of the group $G$. We can compute this by iterating through each point in the grid. If a point has not yet been visited (i.e., not yet assigned to an orbit), it is declared a representative of a new orbit, and we increment our count of orbits. Then, we generate its entire orbit by applying all symmetry operations in $G$ and add all points in this orbit to a \"visited\" set. This process continues until all points in the grid have been visited.\n\n### Algorithmic Implementation\n\nThe overall algorithm proceeds as follows for each test case:\n1.  **Generate Symmetry Group**: Based on the provided label (e.g., \"Ci\", \"O_h\"), generate the set of $3 \\times 3$ integer matrices representing the point group $G$. The groups are constructed from permutations and sign flips. For example, the full cubic group $O_h$ consists of all $48$ signed permutation matrices. The rotational subgroup $O_{\\text{rot}}$ is the subset of these with determinant $+1$.\n2.  **Generate k-point Grid**: Construct the full set of $N_{\\mathrm{BZ}} = N_x N_y N_z$ points of the Monkhorst-Pack grid. Each point is stored as a tuple of its integer numerators, e.g., $(n_x, n_y, n_z)$.\n3.  **Partition into Orbits**:\n    - Initialize a set `visited_points` to be empty and a counter `num_orbits` to zero.\n    - Iterate through each `k_point` in the generated grid.\n    - If `k_point` is already in `visited_points`, skip it.\n    - Otherwise, increment `num_orbits`. Then, compute the orbit of `k_point`:\n        - For each symmetry matrix $S \\in G$:\n            a. Apply the symmetry: `k_prime = S @ k_point`.\n            b. Reduce `k_prime` to its canonical representation using the integer modulo arithmetic described above.\n            c. Add the resulting canonical point to a temporary `current_orbit` set.\n        - Add all points from `current_orbit` to the main `visited_points` set.\n4.  **Calculate Ratio**: After iterating through all grid points, the final `num_orbits` is $N_{\\mathrm{IBZ}}$. The desired ratio is $N_{\\mathrm{IBZ}} / N_{\\mathrm{BZ}}$.\n\nThis systematic approach guarantees that each $\\mathbf{k}$-point is counted in exactly one orbit, leading to the correct value for $N_{\\mathrm{IBZ}}$. The use of integer arithmetic throughout ensures the correctness and robustness of the calculation, free from floating-point errors.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom itertools import permutations, product\n\ndef get_symmetry_group(label):\n    \"\"\"\n    Generates the set of symmetry operation matrices for a given point group label.\n    \"\"\"\n    if label == \"P1\":\n        # Identity group\n        return [np.eye(3, dtype=int)]\n    \n    if label == \"Ci\":\n        # Inversion group\n        return [np.eye(3, dtype=int), -np.eye(3, dtype=int)]\n        \n    if label == \"SignFlips\":\n        # Group of all diagonal sign flips (8 operations)\n        ops = []\n        for s in product([-1, 1], repeat=3):\n            ops.append(np.diag(s).astype(int))\n        return ops\n\n    if label == \"O_h\" or label == \"O_rot\":\n        # Generate the full octahedral group O_h (48 operations)\n        o_h_ops_tuples = set()\n        \n        # Generate all 3! = 6 permutation matrices\n        p_matrices = []\n        for p in permutations([0, 1, 2]):\n            # A permutation matrix P that maps e_j - e_{p(j)} has P_ij = delta_{i, p(j)}\n            # A matrix P that permutes columns of I is P's columns being e_{p(j)}\n            P = np.zeros((3, 3), dtype=int)\n            P[p[0], 0] = 1\n            P[p[1], 1] = 1\n            P[p[2], 2] = 1\n            p_matrices.append(P)\n        \n        # Combine permutations with all 2^3=8 sign flips\n        for P in p_matrices:\n            for s in product([-1, 1], repeat=3):\n                # S = P @ D, where D is a diagonal sign flip matrix\n                S = P @ np.diag(s)\n                # Use tuples for hashing to add to set\n                o_h_ops_tuples.add(tuple(map(tuple, S)))\n\n        o_h_matrices = [np.array(op, dtype=int) for op in o_h_ops_tuples]\n        \n        if label == \"O_h\":\n            return o_h_matrices\n        \n        if label == \"O_rot\":\n            # The rotational subgroup O_rot has determinant +1 (24 operations)\n            o_rot_matrices = []\n            for S in o_h_matrices:\n                if round(np.linalg.det(S)) == 1:\n                    o_rot_matrices.append(S)\n            return o_rot_matrices\n            \n    return []\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    \"\"\"\n    test_cases = [\n        # (N_dims, group_label)\n        ((3, 3, 3), \"P1\"),\n        ((3, 3, 3), \"Ci\"),\n        ((4, 4, 4), \"SignFlips\"),\n        ((4, 4, 4), \"O_rot\"),\n        ((4, 4, 4), \"O_h\"),\n        ((1, 1, 1), \"O_h\"),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N_dims, group_label = case\n        Nx, Ny, Nz = N_dims\n        N_BZ = Nx * Ny * Nz\n        \n        # Generate symmetry operation matrices\n        G = get_symmetry_group(group_label)\n        \n        # Generate Monkhorst-Pack grid points as integer numerators\n        # k_alpha = (2m - N_alpha - 1) / (2 * N_alpha)\n        k_points_tuples = []\n        nx_vals = [2 * m - Nx - 1 for m in range(1, Nx + 1)]\n        ny_vals = [2 * m - Ny - 1 for m in range(1, Ny + 1)]\n        nz_vals = [2 * m - Nz - 1 for m in range(1, Nz + 1)]\n        for nx in nx_vals:\n            for ny in ny_vals:\n                for nz in nz_vals:\n                    k_points_tuples.append((nx, ny, nz))\n                    \n        visited = set()\n        num_orbits = 0\n        \n        # Partition the grid into orbits\n        for k_point_tuple in k_points_tuples:\n            if k_point_tuple in visited:\n                continue\n            \n            num_orbits += 1\n            k_point_vec = np.array(k_point_tuple, dtype=int)\n            \n            current_orbit = set()\n            for S in G:\n                k_prime_vec = S @ k_point_vec\n                \n                # Reduce coordinates to the canonical range [-N_alpha, N_alpha)\n                # using integer modulo arithmetic: n_reduced = (n' + N) % (2N) - N\n                k_reduced = (\n                    (k_prime_vec[0] + Nx) % (2 * Nx) - Nx,\n                    (k_prime_vec[1] + Ny) % (2 * Ny) - Ny,\n                    (k_prime_vec[2] + Nz) % (2 * Nz) - Nz,\n                )\n                current_orbit.add(k_reduced)\n            \n            visited.update(current_orbit)\n        \n        N_IBZ = num_orbits\n        ratio = N_IBZ / N_BZ\n        results.append(f\"{ratio:.6f}\")\n        \n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3485451"}, {"introduction": "While many theoretical concepts are developed for perfect, primitive crystals, practical simulations often employ large supercells to model defects, surfaces, or alloys. This change in real-space periodicity leads to a \"folding\" of the electronic band structure into a smaller supercell Brillouin zone, which can obscure the underlying physics. This advanced exercise [@problem_id:3485464] introduces the powerful technique of band unfolding, allowing you to project the supercell eigenstates back into the primitive cell's BZ and recover a clear, interpretable band structure.", "problem": "Consider periodic crystals described within computational materials science by translational symmetry and reciprocal-space analysis. In a crystal with primitive lattice vectors, the reciprocal lattice is defined as the set of vectors that generate plane-wave phase factors consistent with translational symmetry, and the Brillouin zone (BZ) is the Wigner–Seitz cell in reciprocal space. The Bloch theorem states that eigenstates of a periodic Hamiltonian can be written as $|\\psi_{\\alpha}(\\mathbf{k})\\rangle$, with crystal momentum $\\mathbf{k}$, such that translating by a lattice vector $\\mathbf{R}$ multiplies the state by a phase $\\exp(i\\,\\mathbf{k}\\cdot\\mathbf{R})$.\n\nA supercell is constructed by enlarging the primitive cell by integer multiples along lattice directions, which reduces the size of the Brillouin zone and folds primitive-cell features into the smaller supercell Brillouin zone. The relation between a supercell crystal momentum $\\mathbf{K}$ and primitive crystal momenta is captured by a set of reciprocal-space offsets $\\mathbf{G}$, where $\\mathbf{k}=\\mathbf{K}+\\mathbf{G}$ identify primitive momenta that fold to the same $\\mathbf{K}$. Unfolding is the inverse operation that projects supercell eigenstates back onto primitive-cell momenta to recover the original dispersion.\n\nStarting from these foundational definitions, do the following:\n\n1. For a one-dimensional tight-binding (TB) chain with primitive lattice constant $a$ and nearest-neighbor hopping parameter $t$, construct a $3a$ supercell. Define the intracell positions as $\\tau_{n}=n\\,a$ for $n=0,1,2$. Using Bloch's theorem and the reciprocal lattice definition, identify the set of three primitive momenta $\\mathbf{k}=\\mathbf{K}+\\mathbf{G}$ that fold onto the supercell Bloch wavevector $\\mathbf{K}=0$. Then, using the projection of a supercell Bloch eigenstate $|\\Psi_{\\alpha}(\\mathbf{K})\\rangle$ described by normalized intracell coefficients $\\{c_{n}\\}$ on the three basis sites, explicitly compute the unfolded weights for the following three normalized eigenvectors at $\\mathbf{K}=0$: \n   (i) $c^{(0)}=\\frac{1}{\\sqrt{3}}(1,1,1)$, \n   (ii) $c^{(1)}=\\frac{1}{\\sqrt{3}}(1,\\exp(i\\,2\\pi/3),\\exp(i\\,4\\pi/3))$, \n   (iii) $c^{(2)}=\\frac{1}{\\sqrt{3}}(1,\\exp(i\\,4\\pi/3),\\exp(i\\,2\\pi/3))$. \n   Show how the zone-folding $\\mathbf{k}\\to\\mathbf{k}+\\mathbf{G}$ maps features and how unfolding recovers the primitive dispersion at the corresponding primitive momenta.\n\n2. For a two-dimensional square lattice with primitive vectors $\\mathbf{a}_{1}=a\\,\\hat{\\mathbf{x}}$ and $\\mathbf{a}_{2}=a\\,\\hat{\\mathbf{y}}$ and nearest-neighbor tight-binding hopping $t$, construct a $2\\times 2$ supercell with intracell positions $\\tau_{mn}=m\\,a\\,\\hat{\\mathbf{x}}+n\\,a\\,\\hat{\\mathbf{y}}$ for $m,n\\in\\{0,1\\}$. Identify the set of four primitive momenta that fold to $\\mathbf{K}=(0,0)$. For the normalized intracell coefficient pattern $c_{00}=1/2$, $c_{10}=-1/2$, $c_{01}=-1/2$, $c_{11}=1/2$, compute the unfolded weights onto the primitive momenta and discuss how the unfolded spectral distribution recovers the primitive dispersion.\n\n3. Generalize the unfolding analysis to an arbitrary $d$-dimensional supercell with intracell positions $\\{\\tau_{n}\\}_{n=1}^{N}$ and a supercell Bloch eigenstate at wavevector $\\mathbf{K}$ having normalized intracell coefficients $\\{c_{n}\\}_{n=1}^{N}$. Derive, from first principles, the closed-form analytic expression for the unfolded spectral function $A_{\\text{unf}}(\\mathbf{k},E)$ for that single supercell eigenstate, expressed in terms of $\\mathbf{K}$, $\\{c_{n}\\}$, $\\{\\tau_{n}\\}$, the set $\\mathcal{S}$ of unique primitive reciprocal-lattice offsets $\\mathbf{G}$ connecting the supercell Brillouin zone to the primitive Brillouin zone, and the supercell eigenenergy $E_{\\alpha}(\\mathbf{K})$. Your final answer must be this single closed-form analytic expression for $A_{\\text{unf}}(\\mathbf{k},E)$; no numerical rounding is required and no physical units should be included in the expression.\n\nProvide clear derivations based on the foundational definitions of reciprocal lattice and Bloch theorem without invoking shortcut formulas. Your computations in parts 1 and 2 should illustrate the mapping $\\mathbf{k}\\to\\mathbf{k}+\\mathbf{G}$ and demonstrate how unfolding recovers primitive dispersions, but the final requested answer is only the general expression requested in part 3.", "solution": "The problem asks for the derivation and application of the band-unfolding technique, which reconstructs the electronic band structure of a primitive cell from a supercell calculation. The core of this method is the projection of supercell eigenstates onto the basis of primitive-cell Bloch momentum states.\n\n### Foundational Derivation of Unfolding Weights\n\nLet the primitive lattice be defined by a set of lattice vectors $\\{\\mathbf{R}_p\\}$ and the supercell lattice by vectors $\\{\\mathbf{R}'_j\\}$. The supercell is composed of $N$ primitive cells, meaning it contains $N$ atoms, each at an intracell position $\\tau_n$ ($n=1, \\dots, N$) relative to the supercell origin. The position of an atom in the crystal can be written as $\\mathbf{R}_p$ in the primitive-cell picture or as $\\mathbf{R}'_j + \\tau_n$ for some supercell index $j$ and intracell index $n$ in the supercell picture. The total number of primitive cells in the crystal is $N_p$, and the total number of supercells is $N_{\\text{sc}}$, with $N_p = N \\cdot N_{\\text{sc}}$.\n\nA supercell Bloch eigenstate $|\\Psi_{\\alpha}(\\mathbf{K})\\rangle$ with supercell crystal momentum $\\mathbf{K}$ and energy $E_{\\alpha}(\\mathbf{K})$ can be expressed as a linear combination of localized atomic orbitals $|\\phi(\\mathbf{r} - \\mathbf{R}'_j - \\tau_n)\\rangle \\equiv |\\phi_{j,n}\\rangle$:\n$$|\\Psi_{\\alpha}(\\mathbf{K})\\rangle = \\frac{1}{\\sqrt{N_{\\text{sc}}}} \\sum_{j,n} c_{n}^{(\\alpha)} \\exp(i\\mathbf{K}\\cdot\\mathbf{R}'_j) |\\phi_{j,n}\\rangle$$\nwhere $\\{c_n^{(\\alpha)}\\}_{n=1}^N$ are the normalized coefficients of the eigenvector for the $N$ basis sites within the supercell, satisfying $\\sum_{n=1}^N |c_n^{(\\alpha)}|^2 = 1$.\n\nWe want to project this state onto the basis of primitive-cell Bloch states. A primitive-cell Bloch state $|\\tilde{\\psi}(\\mathbf{k})\\rangle$ with momentum $\\mathbf{k}$ is a Bloch sum over all sites $\\mathbf{R}_p$ of the primitive lattice:\n$$|\\tilde{\\psi}(\\mathbf{k})\\rangle = \\frac{1}{\\sqrt{N_p}} \\sum_p \\exp(i\\mathbf{k}\\cdot\\mathbf{R}_p) |\\phi_p\\rangle$$\nwhere $|\\phi_p\\rangle$ is the orbital at site $\\mathbf{R}_p$.\n\nThe projection amplitude is the inner product $\\langle \\tilde{\\psi}(\\mathbf{k}) | \\Psi_{\\alpha}(\\mathbf{K})\\rangle$. Assuming the atomic orbitals are orthonormal, $\\langle\\phi_p|\\phi_{j,n}\\rangle = \\delta_{\\mathbf{R}_p, \\mathbf{R}'_j+\\tau_n}$, the projection is:\n$$ \\langle \\tilde{\\psi}(\\mathbf{k}) | \\Psi_{\\alpha}(\\mathbf{K})\\rangle = \\frac{1}{\\sqrt{N_p N_{\\text{sc}}}} \\sum_{p,j,n} \\langle\\phi_p|\\phi_{j,n}\\rangle c_{n}^{(\\alpha)} \\exp(i\\mathbf{K}\\cdot\\mathbf{R}'_j) \\exp(-i\\mathbf{k}\\cdot\\mathbf{R}_p) $$\n$$ = \\frac{1}{\\sqrt{N_p N_{\\text{sc}}}} \\sum_{j,n} c_{n}^{(\\alpha)} \\exp(i\\mathbf{K}\\cdot\\mathbf{R}'_j) \\exp(-i\\mathbf{k}\\cdot(\\mathbf{R}'_j+\\tau_n)) $$\n$$ = \\frac{1}{\\sqrt{N_p N_{\\text{sc}}}} \\left( \\sum_j \\exp(-i(\\mathbf{k}-\\mathbf{K})\\cdot\\mathbf{R}'_j) \\right) \\left( \\sum_n c_{n}^{(\\alpha)} \\exp(-i\\mathbf{k}\\cdot\\tau_n) \\right) $$\nThe sum over supercell lattice vectors $\\sum_j \\exp(-i(\\mathbf{k}-\\mathbf{K})\\cdot\\mathbf{R}'_j)$ is non-zero (and equals $N_{\\text{sc}}$) only if $\\mathbf{k}-\\mathbf{K}$ is a reciprocal lattice vector of the supercell. Let this set of vectors be $\\mathcal{G}'$. In the problem's notation, this set is called $\\mathcal{S}$ and the vectors are denoted by $\\mathbf{G}$. Thus, the projection is non-zero only for primitive momenta $\\mathbf{k}$ of the form $\\mathbf{k} = \\mathbf{K}+\\mathbf{G}$ where $\\mathbf{G} \\in \\mathcal{S}$.\n\nFor such a $\\mathbf{k}$, the projection amplitude becomes:\n$$ \\langle \\tilde{\\psi}(\\mathbf{k}) | \\Psi_{\\alpha}(\\mathbf{K})\\rangle = \\frac{N_{\\text{sc}}}{\\sqrt{N_p N_{\\text{sc}}}} \\sum_n c_{n}^{(\\alpha)} \\exp(-i\\mathbf{k}\\cdot\\tau_n) = \\frac{1}{\\sqrt{N}} \\sum_n c_{n}^{(\\alpha)} \\exp(-i\\mathbf{k}\\cdot\\tau_n) $$\nThe unfolded spectral weight at this primitive momentum $\\mathbf{k}$ is the squared magnitude of this amplitude:\n$$ P_{\\alpha}(\\mathbf{k}) = |\\langle \\tilde{\\psi}(\\mathbf{k}) | \\Psi_{\\alpha}(\\mathbf{K})\\rangle|^2 = \\frac{1}{N} \\left| \\sum_{n=1}^N c_{n}^{(\\alpha)} \\exp(-i\\mathbf{k}\\cdot\\tau_n) \\right|^2 $$\nThis weight is non-zero only for $\\mathbf{k} = \\mathbf{K}+\\mathbf{G}$ with $\\mathbf{G} \\in \\mathcal{S}$.\n\n### Part 1: 1D Tight-Binding Chain\n\nFor a 1D chain with primitive lattice constant $a$, the primitive reciprocal lattice vector is $b = 2\\pi/a$. The supercell is of size $3a$, so its reciprocal lattice vector is $B = 2\\pi/(3a)$. The problem considers supercell momentum $\\mathbf{K}=0$. The set of primitive momenta that fold to $\\mathbf{K}=0$ are $\\mathbf{k} = 0 + mB = m \\frac{2\\pi}{3a}$ for integer $m$. The three smallest unique such momenta are $k \\in \\{0, 2\\pi/(3a), -2\\pi/(3a)\\}$. These correspond to offsets $\\mathbf{G} \\in \\{0, 2\\pi/(3a), -2\\pi/(3a)\\}$. The intracell positions are $\\tau_0=0$, $\\tau_1=a$, $\\tau_2=2a$, so $N=3$. The unfolding weight is $W(k) = \\frac{1}{3} |\\sum_{n=0}^2 c_n \\exp(-ik\\tau_n)|^2$.\n\n(i) For $c^{(0)} = \\frac{1}{\\sqrt{3}}(1,1,1)$:\n- $k=0$: $W(0) = \\frac{1}{3}|\\frac{1}{\\sqrt{3}}(1+1+1)|^2 = 1$.\n- $k=2\\pi/(3a)$: $W(2\\pi/(3a)) = \\frac{1}{3}|\\frac{1}{\\sqrt{3}}(1+e^{-i2\\pi/3}+e^{-i4\\pi/3})|^2 = 0$.\n- $k=-2\\pi/(3a)$: $W(-2\\pi/(3a)) = \\frac{1}{3}|\\frac{1}{\\sqrt{3}}(1+e^{i2\\pi/3}+e^{i4\\pi/3})|^2 = 0$.\nThis state maps entirely to the primitive $\\Gamma$-point ($k=0$).\n\n(ii) For $c^{(1)} = \\frac{1}{\\sqrt{3}}(1, e^{i2\\pi/3}, e^{i4\\pi/3})$:\n- $k=0$: $W(0) = \\frac{1}{3}|\\frac{1}{\\sqrt{3}}(1+e^{i2\\pi/3}+e^{i4\\pi/3})|^2 = 0$.\n- $k=2\\pi/(3a)$: $W(2\\pi/(3a)) = \\frac{1}{3}|\\frac{1}{\\sqrt{3}}(1\\cdot e^0 + e^{i2\\pi/3} e^{-i2\\pi/3} + e^{i4\\pi/3} e^{-i4\\pi/3})|^2 = 1$.\n- $k=-2\\pi/(3a)$: $W(-2\\pi/(3a)) = \\frac{1}{3}|\\frac{1}{\\sqrt{3}}(1 + e^{i2\\pi/3} e^{i2\\pi/3} + e^{i4\\pi/3} e^{i4\\pi/3})|^2 = 0$.\nThis state maps entirely to the primitive momentum $k=2\\pi/(3a)$.\n\n(iii) For $c^{(2)} = \\frac{1}{\\sqrt{3}}(1, e^{i4\\pi/3}, e^{i2\\pi/3})$:\n- $k=0$: $W(0) = 0$.\n- $k=2\\pi/(3a)$: $W(2\\pi/(3a)) = 0$.\n- $k=-2\\pi/(3a)$: $W(-2\\pi/(3a)) = \\frac{1}{3}|\\frac{1}{\\sqrt{3}}(1\\cdot e^0 + e^{i4\\pi/3} e^{i2\\pi/3} + e^{i2\\pi/3} e^{i4\\pi/3})|^2 = 1$.\nThis state maps entirely to the primitive momentum $k=-2\\pi/(3a)$.\n\nThese three supercell states at $\\mathbf{K}=0$ correspond to the three folded primitive-cell states, which have energies $E(0)=-2t$, $E(2\\pi/3a)=t$, and $E(-2\\pi/3a)=t$ (assuming $E_0=0$ in the primitive dispersion $E(k)=-2t\\cos(ka)$).\n\n### Part 2: 2D Square Lattice\n\nFor a $2\\times 2$ supercell on a square lattice of side $a$, the primitive reciprocal vectors are $\\mathbf{b}_1 = \\frac{2\\pi}{a}\\hat{\\mathbf{x}}$, $\\mathbf{b}_2 = \\frac{2\\pi}{a}\\hat{\\mathbf{y}}$. The supercell reciprocal vectors are $\\mathbf{B}_1 = \\frac{\\pi}{a}\\hat{\\mathbf{x}}$, $\\mathbf{B}_2 = \\frac{\\pi}{a}\\hat{\\mathbf{y}}$. For $\\mathbf{K}=(0,0)$, the four primitive momenta that fold are $\\mathbf{k}_{\\Gamma}=(0,0)$, $\\mathbf{k}_{X}=(\\pi/a,0)$, $\\mathbf{k}_{Y}=(0,\\pi/a)$, and $\\mathbf{k}_{M}=(\\pi/a,\\pi/a)$. The intracell positions are $\\tau_{00}=(0,0)$, $\\tau_{10}=(a,0)$, $\\tau_{01}=(0,a)$, $\\tau_{11}=(a,a)$, so $N=4$. The weight is $W(\\mathbf{k}) = \\frac{1}{4} |\\sum_{m,n\\in\\{0,1\\}} c_{mn} \\exp(-i\\mathbf{k}\\cdot\\tau_{mn})|^2$.\nFor the coefficients $c_{00}=1/2, c_{10}=-1/2, c_{01}=-1/2, c_{11}=1/2$:\n- $\\mathbf{k}_{\\Gamma}=(0,0)$: $W(\\mathbf{k}_{\\Gamma}) = \\frac{1}{4}|\\frac{1}{2}-\\frac{1}{2}-\\frac{1}{2}+\\frac{1}{2}|^2=0$.\n- $\\mathbf{k}_{X}=(\\pi/a,0)$: $W(\\mathbf{k}_{X}) = \\frac{1}{4}|\\frac{1}{2}e^0-\\frac{1}{2}e^{-i\\pi}-\\frac{1}{2}e^0+\\frac{1}{2}e^{-i\\pi}|^2 = \\frac{1}{4}|\\frac{1}{2}+\\frac{1}{2}-\\frac{1}{2}-\\frac{1}{2}|^2=0$.\n- $\\mathbf{k}_{Y}=(0,\\pi/a)$: $W(\\mathbf{k}_{Y}) = \\frac{1}{4}|\\frac{1}{2}e^0-\\frac{1}{2}e^0-\\frac{1}{2}e^{-i\\pi}+\\frac{1}{2}e^{-i\\pi}|^2 = \\frac{1}{4}|\\frac{1}{2}-\\frac{1}{2}+\\frac{1}{2}-\\frac{1}{2}|^2=0$.\n- $\\mathbf{k}_{M}=(\\pi/a,\\pi/a)$: $W(\\mathbf{k}_{M}) = \\frac{1}{4}|\\frac{1}{2}e^0-\\frac{1}{2}e^{-i\\pi}-\\frac{1}{2}e^{-i\\pi}+\\frac{1}{2}e^{-i2\\pi}|^2 = \\frac{1}{4}|\\frac{1}{2}+\\frac{1}{2}+\\frac{1}{2}+\\frac{1}{2}|^2=1$.\nThis state corresponds entirely to the primitive M-point. The primitive dispersion is $E(k_x, k_y) = -2t(\\cos(k_x a)+\\cos(k_y a))$. The energy of this state is $E_M = -2t(\\cos(\\pi)+\\cos(\\pi)) = 4t$, representing the top of the band.\n\n### Part 3: General Expression for the Unfolded Spectral Function\n\nThe unfolded spectral function $A_{\\text{unf}}(\\mathbf{k},E)$ provides the distribution of spectral weight of the supercell eigenstates in the primitive momentum-energy space $(\\mathbf{k},E)$. For a single supercell eigenstate $|\\Psi_{\\alpha}(\\mathbf{K})\\rangle$ with energy $E_{\\alpha}(\\mathbf{K})$, the weight exists only at this energy. The momentum distribution is a series of discrete points $\\mathbf{k} = \\mathbf{K}+\\mathbf{G}$ for $\\mathbf{G} \\in \\mathcal{S}$. Combining these facts, the spectral function is a sum of products of delta functions in energy and momentum, weighted by the projection weights derived earlier.\n\nThe number of intracell sites is $N$, given by the size of the set $\\{\\tau_n\\}$. The set of reciprocal-space offsets $\\mathcal{S}$ is interpreted, consistent with the derivation, as the set of supercell reciprocal lattice vectors. For a given supercell eigenstate at $\\mathbf{K}$ with energy $E_{\\alpha}(\\mathbf{K})$ and coefficients $\\{c_n\\}$, the unfolded spectral function is:\n$$A_{\\text{unf}}(\\mathbf{k},E) = \\sum_{\\mathbf{G} \\in \\mathcal{S}} P_{\\alpha}(\\mathbf{K}+\\mathbf{G}) \\, \\delta(\\mathbf{k}-(\\mathbf{K}+\\mathbf{G})) \\, \\delta(E-E_{\\alpha}(\\mathbf{K}))$$\nSubstituting the expression for the weight $P_{\\alpha}$:\n$$A_{\\text{unf}}(\\mathbf{k},E) = \\delta(E-E_{\\alpha}(\\mathbf{K})) \\sum_{\\mathbf{G} \\in \\mathcal{S}} \\left( \\frac{1}{N} \\left|\\sum_{n=1}^{N} c_{n} \\exp(-i(\\mathbf{K}+\\mathbf{G})\\cdot\\tau_{n})\\right|^{2} \\right) \\delta(\\mathbf{k}-(\\mathbf{K}+\\mathbf{G}))$$\nThis is the closed-form analytic expression for the unfolded spectral function for a single supercell eigenstate. It correctly represents the spectral weight decomposition into the primitive Brillouin zone.", "answer": "$$\n\\boxed{\nA_{\\text{unf}}(\\mathbf{k},E) = \\delta(E - E_{\\alpha}(\\mathbf{K})) \\sum_{\\mathbf{G} \\in \\mathcal{S}} \\frac{1}{N} \\left|\\sum_{n=1}^{N} c_{n} \\exp(-i(\\mathbf{K}+\\mathbf{G})\\cdot\\tau_{n})\\right|^{2} \\delta(\\mathbf{k}-(\\mathbf{K}+\\mathbf{G}))\n}\n$$", "id": "3485464"}]}