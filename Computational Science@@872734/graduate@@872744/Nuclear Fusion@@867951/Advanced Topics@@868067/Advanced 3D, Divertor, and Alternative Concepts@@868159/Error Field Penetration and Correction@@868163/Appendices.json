{"hands_on_practices": [{"introduction": "A penetrated error field is not an abstract concept; it has tangible and often detrimental effects on plasma confinement and machine components. This first exercise connects the physics of resonant magnetic perturbations to a critical, observable consequence: the splitting of the divertor strike points. By tracing magnetic field lines from first principles, you will quantify how a small normal field component at the X-point leads to a macroscopic separation of heat and particle fluxes on the divertor target, a phenomenon that can compromise material integrity. [@problem_id:3698720]", "problem": "A large-aspect-ratio, single-null tokamak equilibrium is described by an axisymmetric poloidal flux $\\psi(R,Z)$ with a separatrix that terminates at a magnetic X-point. In the absence of non-axisymmetric fields, the stable and unstable manifolds of the X-point coincide and field lines intersect the divertor target at a single strike point. Consider a small, fully penetrated, stationary non-axisymmetric error field with toroidal mode number $n=1$ that produces a normal (to the unperturbed separatrix) magnetic field component at the X-point. Assume the following physically justified idealizations:\n\n- Field lines satisfy the kinematic law $d\\mathbf{x}/ds = \\mathbf{B}/|\\mathbf{B}|$, where $s$ is arc length and $\\mathbf{B}$ is the magnetic field.\n- The non-axisymmetric error field produces a normal field component at the X-point of amplitude $b_{x}$, which is approximately constant along the connection from the X-point to the divertor target, and its spectrum is dominated by $n=1$.\n- The total magnetic field magnitude along the connection is $|\\mathbf{B}| = \\sqrt{B_{\\phi}^{2} + B_{\\theta}^{2}}$, with $B_{\\phi}$ the toroidal field and $B_{\\theta}$ the poloidal field.\n- The connection length from the X-point vicinity to the divertor target along an unperturbed field line is $L_{c}$.\n- The divertor target plate is oriented such that displacements normal to the unperturbed separatrix map one-to-one to separations along the measured footprint coordinate $s$ at the target (i.e., the local geometric projection factor is unity).\n\nUnder these assumptions, resonant field penetration generates a homoclinic tangle of invariant manifolds, and the resulting divertor strike point splitting is set by twice the integrated normal field-line displacement accumulated along the connection. Using first principles, derive the expression for the footprint separation $\\Delta s$ at a fixed toroidal angle, and then compute its value for the following parameters:\n- $B_{\\phi} = 2.9~\\mathrm{T}$,\n- $B_{\\theta} = 0.09~\\mathrm{T}$,\n- $b_{x} = 1.2 \\times 10^{-4}~\\mathrm{T}$,\n- $L_{c} = 28~\\mathrm{m}$.\n\nRound your final numerical answer to three significant figures and express the footprint separation in $\\mathrm{mm}$.", "solution": "The user wants me to solve a problem related to error field penetration in a tokamak.\nThe problem is validated as scientifically grounded, well-posed, and objective. All necessary parameters are provided, and the assumptions, while simplifying, are physically justified in the context of a tractable model. The problem statement leads to a unique and meaningful solution. I will now proceed with the derivation and calculation.\n\nThe problem asks for the derivation of the footprint separation $\\Delta s$ on the divertor target caused by a non-axisymmetric error field. We begin from the first principles of magnetic field line tracing.\n\nThe trajectory of a magnetic field line $\\mathbf{x}$ is described by the differential equation:\n$$\n\\frac{d\\mathbf{x}}{ds} = \\frac{\\mathbf{B}}{|\\mathbf{B}|}\n$$\nwhere $s$ is the arc length along the field line and $\\mathbf{B}$ is the total magnetic field vector.\n\nThe total magnetic field $\\mathbf{B}$ is the sum of the unperturbed, axisymmetric equilibrium field $\\mathbf{B}_0$ and the small, non-axisymmetric error field $\\mathbf{b}$.\n$$\n\\mathbf{B} = \\mathbf{B}_0 + \\mathbf{b}\n$$\nLet's establish a local coordinate system near the unperturbed separatrix. Let $\\hat{n}$ be the unit vector normal to the separatrix surface, and let the coordinate along this direction be $\\delta_n$. By definition, the unperturbed field $\\mathbf{B}_0$ lies within the separatrix surface, so its normal component is zero, $B_{0,n} = 0$. The error field $\\mathbf{b}$, however, has a normal component, which the problem denotes as $b_x$. For clarity in the derivation, we will denote this normal component as $b_n$. Thus, the total normal component of the magnetic field is $B_n = B_{0,n} + b_n = b_n$.\n\nThe rate of change of the normal displacement $\\delta_n$ of a field line with respect to the arc length $s$ is given by projecting the field line trajectory equation onto the normal direction:\n$$\n\\frac{d\\delta_n}{ds} = \\frac{d\\mathbf{x}}{ds} \\cdot \\hat{n} = \\frac{\\mathbf{B} \\cdot \\hat{n}}{|\\mathbf{B}|} = \\frac{B_n}{|\\mathbf{B}|} = \\frac{b_n}{|\\mathbf{B}|}\n$$\nTo find the total normal displacement $\\Delta_n$ of a field line as it travels from the X-point vicinity to the divertor target, we must integrate this expression along the field line path over the connection length $L_c$. For a small perturbation, the path length $s$ can be approximated by the path length along the unperturbed field line.\n$$\n\\Delta_n = \\int_{0}^{L_c} \\frac{b_n(s)}{|\\mathbf{B}(s)|} ds\n$$\nThe problem provides several simplifying assumptions that make this integral tractable:\n1.  The normal field component $b_n$ (given as $b_x$ in the problem's parameters) is approximately constant along the connection length.\n2.  The total magnetic field magnitude $|\\mathbf{B}|$ can be represented by a constant effective value along the connection, calculated as $|\\mathbf{B}| = \\sqrt{B_{\\phi}^{2} + B_{\\theta}^{2}}$, where $B_{\\phi}$ and $B_{\\theta}$ are the given constant toroidal and poloidal field components.\n\nWith these assumptions, $b_n$ and $|\\mathbf{B}|$ are constants with respect to the integration variable $s$. The integral simplifies to:\n$$\n\\Delta_n = \\frac{b_n}{|\\mathbf{B}|} \\int_{0}^{L_c} ds = \\frac{b_n}{|\\mathbf{B}|} L_c\n$$\nThis expression, $\\Delta_n$, represents the normal displacement of a single perturbed manifold (either stable or unstable) from the position of the unperturbed strike point.\n\nThe problem states that \"the resulting divertor strike point splitting is set by twice the integrated normal field-line displacement.\" This factor of $2$ originates from the physics of homoclinic tangles. The error field causes the stable and unstable manifolds of the X-point, which were coincident in the unperturbed case, to split apart. One new strike point is formed by the intersection of the perturbed unstable manifold with the target, and the other by the intersection of the perturbed stable manifold. At a toroidal location of maximum perturbation, these two manifolds are displaced by an amount $\\Delta_n$ in opposite directions from the original separatrix location. Therefore, the total separation between the two new strike points, which is the footprint separation $\\Delta s$, is twice the single-manifold displacement.\n$$\n\\Delta s = 2 \\Delta_n\n$$\nSubstituting the expression for $\\Delta_n$, we arrive at the final derived formula for the footprint separation:\n$$\n\\Delta s = 2 \\frac{b_n L_c}{|\\mathbf{B}|} = 2 \\frac{b_x L_c}{\\sqrt{B_{\\phi}^{2} + B_{\\theta}^{2}}}\n$$\nThe problem also states that the geometric projection factor from normal displacement to the target coordinate is unity, so this calculated separation $\\Delta s$ is the quantity measured at the target.\n\nWe now compute the numerical value using the provided parameters:\n-   Toroidal field, $B_{\\phi} = 2.9~\\mathrm{T}$\n-   Poloidal field, $B_{\\theta} = 0.09~\\mathrm{T}$\n-   Normal error field, $b_{x} = 1.2 \\times 10^{-4}~\\mathrm{T}$\n-   Connection length, $L_{c} = 28~\\mathrm{m}$\n\nFirst, we calculate the magnitude of the total magnetic field:\n$$\n|\\mathbf{B}| = \\sqrt{B_{\\phi}^{2} + B_{\\theta}^{2}} = \\sqrt{(2.9)^{2} + (0.09)^{2}}~\\mathrm{T} = \\sqrt{8.41 + 0.0081}~\\mathrm{T} = \\sqrt{8.4181}~\\mathrm{T} \\approx 2.901396~\\mathrm{T}\n$$\nNext, we substitute this and the other values into the expression for $\\Delta s$:\n$$\n\\Delta s = 2 \\times \\frac{(1.2 \\times 10^{-4}~\\mathrm{T}) \\times (28~\\mathrm{m})}{2.901396~\\mathrm{T}}\n$$\n$$\n\\Delta s = \\frac{0.00672}{2.901396}~\\mathrm{m} \\approx 0.0023161~\\mathrm{m}\n$$\nThe problem requires the answer to be in millimeters ($\\mathrm{mm}$) and rounded to three significant figures. We perform the unit conversion:\n$$\n\\Delta s \\approx 0.0023161~\\mathrm{m} \\times \\frac{1000~\\mathrm{mm}}{1~\\mathrm{m}} \\approx 2.3161~\\mathrm{mm}\n$$\nRounding to three significant figures, we get:\n$$\n\\Delta s \\approx 2.32~\\mathrm{mm}\n$$", "answer": "$$\\boxed{2.32}$$", "id": "3698720"}, {"introduction": "Effectively counteracting intrinsic error fields is a cornerstone of modern tokamak operation. This practice addresses the core engineering task of designing an optimal correction strategy using a set of external non-axisymmetric coils. You will apply the principles of constrained optimization to determine the ideal coil currents that minimize the residual resonant field, while respecting the real-world hardware limitations of the power supplies. [@problem_id:3698726] This exercise demonstrates how a fundamental mathematical framework, the Karush-Kuhn-Tucker (KKT) conditions, provides a robust solution for active error field control.", "problem": "In a tokamak, slowly varying non-axisymmetric error fields couple to rational magnetic surfaces and can penetrate the plasma, driving magnetic island growth when the resonant normal field exceeds a threshold set by plasma rotation and resistivity. To correct these error fields, a set of external non-axisymmetric coils is used to produce a compensating field that superposes linearly with the intrinsic error field, by the linearity of the Biot–Savart law and the principle of superposition. Let the coil-current-to-field response on a chosen rational surface for two orthogonal Fourier components (for example, cosine and sine components of the dominant toroidal mode) be represented by a real response matrix $M \\in \\mathbb{R}^{2 \\times 2}$ with entries in $\\mathrm{mT}\\,\\mathrm{kA}^{-1}$. Let the coil currents be the vector $I \\in \\mathbb{R}^{2}$ with entries in $\\mathrm{kA}$, and let the target compensating field (equal and opposite to the measured error field on that surface) be $b_{\\mathrm{target}} \\in \\mathbb{R}^{2}$ with entries in $\\mathrm{mT}$. The superposed field from the coils is $b_{\\mathrm{coil}} = M I$.\n\nStarting from the fundamental linearity and superposition principles for magnetostatics and the definition of the Euclidean norm, derive from first principles the optimal coil current vector that minimizes the objective $J(I) = \\lVert M I - b_{\\mathrm{target}} \\rVert_{2}$ subject to hard current limits for each coil. Use the Karush–Kuhn–Tucker optimality conditions to treat the inequality constraints and identify any active constraints at the solution. Then evaluate your expression for the following physically plausible data:\n- $M = \\begin{pmatrix} 1.1  -0.3 \\\\ 0.4  0.8 \\end{pmatrix}$ (entries in $\\mathrm{mT}\\,\\mathrm{kA}^{-1}$),\n- $b_{\\mathrm{target}} = \\begin{pmatrix} 2.5 \\\\ 1.0 \\end{pmatrix}$ (entries in $\\mathrm{mT}$),\n- symmetric coil current bounds $-I_{\\max} \\le I_i \\le I_{\\max}$ with $I_{\\max} = 2$ (in $\\mathrm{kA}$) for both coils.\n\nIn your derivation, begin from the quadratic least-squares objective implied by the Euclidean norm and establish the stationarity and complementary slackness conditions without assuming any particular “shortcut” formula. Identify the active set and solve explicitly for the optimal $I$.\n\nFinally, report the optimal coil current vector $I^{\\star}$ as a row vector in $\\mathrm{kA}$, rounded to four significant figures. Explain briefly how your result provides the error field correction settings that suppress penetration by minimizing the resonant normal field on the rational surface.", "solution": "The problem is first validated against the specified criteria.\n\n### Step 1: Extract Givens\n-   Response matrix: $M = \\begin{pmatrix} 1.1  -0.3 \\\\ 0.4  0.8 \\end{pmatrix}$, with entries in $\\mathrm{mT}\\,\\mathrm{kA}^{-1}$.\n-   Target compensating field vector: $b_{\\mathrm{target}} = \\begin{pmatrix} 2.5 \\\\ 1.0 \\end{pmatrix}$, with entries in $\\mathrm{mT}$.\n-   Coil current vector: $I = \\begin{pmatrix} I_1 \\\\ I_2 \\end{pmatrix}$, with entries in $\\mathrm{kA}$.\n-   Objective function to minimize: $J(I) = \\lVert M I - b_{\\mathrm{target}} \\rVert_{2}$.\n-   Coil current constraints: $-I_{\\max} \\le I_i \\le I_{\\max}$ for each coil $i$, where $I_{\\max} = 2$ in $\\mathrm{kA}$.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is well-grounded in the physics of magnetic confinement fusion, specifically addressing the critical issue of error field correction in tokamaks. The linear response model ($b_{\\mathrm{coil}} = M I$) is a standard and valid approximation used in practice. The use of a least-squares objective function to minimize the residual field is also a standard technique.\n-   **Well-Posed**: The problem is a constrained quadratic optimization problem. The objective function is the square of a Euclidean norm of an affine function of $I$, which is convex. The constraints $-I_{\\max} \\le I_i \\le I_{\\max}$ define a convex, closed, and bounded set (a hyperrectangle). The minimization of a convex function over a convex set is a well-posed problem that guarantees the existence and uniqueness of a solution.\n-   **Objective**: The problem is stated using precise mathematical and physical terminology, free from ambiguity or subjective content. All data and constants are clearly defined.\n\n### Step 3: Verdict and Action\nThe problem is valid as it is scientifically sound, mathematically well-posed, objective, and self-contained. Therefore, a solution will be derived.\n\n### Derivation of the Solution\nThe goal is to find the optimal coil current vector $I^{\\star}$ that minimizes the objective function $J(I) = \\lVert M I - b_{\\mathrm{target}} \\rVert_{2}$ subject to the current limits. Minimizing $J(I)$ is equivalent to minimizing its square, which is mathematically more convenient. Let the objective function be:\n$$F(I) = \\frac{1}{2} \\lVert M I - b_{\\mathrm{target}} \\rVert_{2}^{2} = \\frac{1}{2} (M I - b_{\\mathrm{target}})^T (M I - b_{\\mathrm{target}})$$\nExpanding this gives a quadratic form:\n$$F(I) = \\frac{1}{2} (I^T M^T M I - 2 I^T M^T b_{\\mathrm{target}} + b_{\\mathrm{target}}^T b_{\\mathrm{target}})$$\nThe constraints are box constraints on the currents $I_1$ and $I_2$:\n$$-I_{\\max} \\le I_1 \\le I_{\\max}$$\n$$-I_{\\max} \\le I_2 \\le I_{\\max}$$\nThese can be written as four inequality constraints:\n$g_1(I) = I_1 - I_{\\max} \\le 0$\n$g_2(I) = -I_1 - I_{\\max} \\le 0$\n$g_3(I) = I_2 - I_{\\max} \\le 0$\n$g_4(I) = -I_2 - I_{\\max} \\le 0$\n\nWe use the Karush–Kuhn–Tucker (KKT) conditions to solve this constrained optimization problem. The Lagrangian $\\mathcal{L}$ is formed by adding the constraints to the objective function, weighted by non-negative Lagrange multipliers $\\mu_j \\ge 0$:\n$$\\mathcal{L}(I, \\boldsymbol{\\mu}) = F(I) + \\mu_{1}(I_1 - I_{\\max}) + \\mu_{2}(-I_1 - I_{\\max}) + \\mu_{3}(I_2 - I_{\\max}) + \\mu_{4}(-I_2 - I_{\\max})$$\nwhere $\\boldsymbol{\\mu} = (\\mu_1, \\mu_2, \\mu_3, \\mu_4)^T$. It is convenient to relabel the multipliers corresponding to upper and lower bounds: $\\mu_{1+} = \\mu_1, \\mu_{1-} = \\mu_2, \\mu_{2+} = \\mu_3, \\mu_{2-} = \\mu_4$.\n\nThe KKT conditions for optimality are:\n1.  **Stationarity**: The gradient of the Lagrangian with respect to $I$ must be zero: $\\nabla_I \\mathcal{L}(I, \\boldsymbol{\\mu}) = 0$.\n2.  **Primal Feasibility**: The constraints must be satisfied: $g_j(I) \\le 0$ for $j=1, 2, 3, 4$.\n3.  **Dual Feasibility**: The Lagrange multipliers must be non-negative: $\\mu_j \\ge 0$.\n4.  **Complementary Slackness**: For each constraint, the product of the multiplier and the constraint function must be zero: $\\mu_j g_j(I) = 0$.\n\nLet's compute the gradient for the stationarity condition:\n$$\\nabla_I F(I) = M^T M I - M^T b_{\\mathrm{target}}$$\n$$\\nabla_I \\mathcal{L} = M^T M I - M^T b_{\\mathrm{target}} + \\begin{pmatrix} \\mu_{1+} - \\mu_{1-} \\\\ \\mu_{2+} - \\mu_{2-} \\end{pmatrix} = 0$$\n\nFirst, we find the unconstrained solution by assuming all constraints are inactive, which implies all multipliers are zero ($\\mu_j = 0$). The stationarity condition simplifies to:\n$$M^T M I = M^T b_{\\mathrm{target}}$$\nThis gives the unconstrained least-squares solution:\n$$I_{\\text{unconstrained}} = (M^T M)^{-1} M^T b_{\\mathrm{target}}$$\nWe now substitute the given numerical values:\n$M = \\begin{pmatrix} 1.1  -0.3 \\\\ 0.4  0.8 \\end{pmatrix}$, $b_{\\mathrm{target}} = \\begin{pmatrix} 2.5 \\\\ 1.0 \\end{pmatrix}$, $I_{\\max} = 2$.\n\n$M^T M = \\begin{pmatrix} 1.1  0.4 \\\\ -0.3  0.8 \\end{pmatrix} \\begin{pmatrix} 1.1  -0.3 \\\\ 0.4  0.8 \\end{pmatrix} = \\begin{pmatrix} 1.21+0.16  -0.33+0.32 \\\\ -0.33+0.32  0.09+0.64 \\end{pmatrix} = \\begin{pmatrix} 1.37  -0.01 \\\\ -0.01  0.73 \\end{pmatrix}$\n$M^T b_{\\mathrm{target}} = \\begin{pmatrix} 1.1  0.4 \\\\ -0.3  0.8 \\end{pmatrix} \\begin{pmatrix} 2.5 \\\\ 1.0 \\end{pmatrix} = \\begin{pmatrix} 2.75+0.4 \\\\ -0.75+0.8 \\end{pmatrix} = \\begin{pmatrix} 3.15 \\\\ 0.05 \\end{pmatrix}$\n\nThe determinant of $M^T M$ is $\\det(M^T M) = (1.37)(0.73) - (-0.01)^2 = 1.0001 - 0.0001 = 1$.\nThe inverse is:\n$(M^T M)^{-1} = \\frac{1}{1} \\begin{pmatrix} 0.73  0.01 \\\\ 0.01  1.37 \\end{pmatrix} = \\begin{pmatrix} 0.73  0.01 \\\\ 0.01  1.37 \\end{pmatrix}$\n\nThe unconstrained solution is:\n$$I_{\\text{unconstrained}} = \\begin{pmatrix} 0.73  0.01 \\\\ 0.01  1.37 \\end{pmatrix} \\begin{pmatrix} 3.15 \\\\ 0.05 \\end{pmatrix} = \\begin{pmatrix} (0.73)(3.15) + (0.01)(0.05) \\\\ (0.01)(3.15) + (1.37)(0.05) \\end{pmatrix} = \\begin{pmatrix} 2.2995 + 0.0005 \\\\ 0.0315 + 0.0685 \\end{pmatrix} = \\begin{pmatrix} 2.3 \\\\ 0.1 \\end{pmatrix}$$\nWe check if this solution is feasible. The constraints are $-2 \\le I_i \\le 2$.\nFor $I_1=2.3$, the constraint is violated ($2.3  2$).\nFor $I_2=0.1$, the constraint is satisfied ($-2 \\le 0.1 \\le 2$).\n\nSince the unconstrained solution is not feasible, at least one constraint must be active at the optimum. The violation occurs for $I_1$, so we hypothesize that the optimal solution lies on the boundary $I_1 = I_{\\max} = 2$. This means the constraint $g_1(I) = I_1 - I_{\\max} = 0$ is active, and by complementary slackness, its multiplier $\\mu_{1+}$ can be non-zero. The constraint $g_2(I) = -I_1 - I_{\\max} \\le 0$ is strictly satisfied, so its multiplier must be zero, $\\mu_{1-}=0$.\nSince the unconstrained value for $I_2$ is within its bounds, we assume its constraints are inactive, so $\\mu_{2+}=0$ and $\\mu_{2-}=0$.\n\nWith $I_1^{\\star} = 2$ and $\\mu_{1-}=\\mu_{2+}=\\mu_{2-}=0$, the stationarity conditions become:\n$$M^T M I^{\\star} - M^T b_{\\mathrm{target}} + \\begin{pmatrix} \\mu_{1+} \\\\ 0 \\end{pmatrix} = 0$$\nThis is a system of two equations:\n$$1.37 I_1^{\\star} - 0.01 I_2^{\\star} - 3.15 + \\mu_{1+} = 0$$\n$$-0.01 I_1^{\\star} + 0.73 I_2^{\\star} - 0.05 = 0$$\nWe have two unknowns, $I_2^{\\star}$ and $\\mu_{1+}$. We can solve for $I_2^{\\star}$ using the second equation, since $\\mu_{1+}$ does not appear in it. Setting $I_1^{\\star} = 2$:\n$$-0.01(2) + 0.73 I_2^{\\star} - 0.05 = 0$$\n$$-0.02 + 0.73 I_2^{\\star} = 0.05$$\n$$0.73 I_2^{\\star} = 0.07$$\n$$I_2^{\\star} = \\frac{0.07}{0.73} \\approx 0.0958904$$\nThe candidate optimal current vector is $I^{\\star} = \\begin{pmatrix} 2 \\\\ 0.07/0.73 \\end{pmatrix}$.\n\nWe must verify that all KKT conditions are met.\n1.  **Primal Feasibility**: $I_1^{\\star} = 2$, which is in $[-2, 2]$. $I_2^{\\star} \\approx 0.0959$, which is in $[-2, 2]$. Feasibility holds.\n2.  **Dual Feasibility**: We solve for $\\mu_{1+}$ using the first stationarity equation:\n    $1.37(2) - 0.01(\\frac{0.07}{0.73}) - 3.15 + \\mu_{1+} = 0$\n    $2.74 - \\frac{0.0007}{0.73} - 3.15 + \\mu_{1+} = 0$\n    $-0.41 - \\frac{0.0007}{0.73} + \\mu_{1+} = 0$\n    $\\mu_{1+} = 0.41 + \\frac{0.0007}{0.73} = \\frac{0.41 \\times 0.73 + 0.0007}{0.73} = \\frac{0.2993 + 0.0007}{0.73} = \\frac{0.3}{0.73}$\n    Since $\\mu_{1+} = 0.3/0.73  0$, and the other multipliers are zero, dual feasibility holds. The active constraint identified is $g_1(I) = I_1 - 2 = 0$.\n3.  **Complementary Slackness**: This is satisfied by construction. The multipliers for inactive constraints were set to zero, and the multiplier for the active constraint $g_1(I)$ is non-zero (while $g_1(I^{\\star})=0$).\n\nAll KKT conditions are satisfied, so our solution is the unique optimum. The optimal current vector is $I^{\\star} = \\begin{pmatrix} 2 \\\\ 0.07/0.73 \\end{pmatrix}$.\nRounding to four significant figures gives:\n$I_1^{\\star} = 2.000$\n$I_2^{\\star} = 0.09589$\n\nThe optimal coil current vector $I^{\\star}$ provides the settings for the external correction coils. When these currents are applied, they generate a magnetic field $b_{\\mathrm{coil}} = M I^{\\star}$ that best approximates the target field $b_{\\mathrm{target}}$ (which is equal and opposite to the measured intrinsic error field) within the hardware limits. By the principle of superposition, the net resonant field at the rational surface is the sum of the intrinsic error and the applied correction, $b_{\\text{net}} = b_{\\text{error}} + b_{\\text{coil}} = -b_{\\text{target}} + M I^{\\star}$. Our optimization procedure found the $I^{\\star}$ that minimizes the magnitude of this net field, $\\lVert M I^{\\star} - b_{\\text{target}} \\rVert_2$. Minimizing this residual resonant field amplitude is the primary method for suppressing externally-driven magnetic island growth, thereby enhancing plasma stability and performance. The result that $I_1^{\\star}$ saturates at its maximum limit indicates that the correction required for the corresponding field component is limited by the physical capability of the coil system.", "answer": "$$\n\\boxed{\n\\begin{pmatrix} 2.000  0.09589 \\end{pmatrix}\n}\n$$", "id": "3698726"}, {"introduction": "Predicting the onset of error field penetration, or \"mode locking,\" is crucial for designing robust tokamak operational scenarios. This capstone exercise guides you through the construction of a computational workflow that integrates multiple physical models to determine the locking threshold and the minimum necessary correction. By balancing external drive, plasma viscosity, neoclassical torques, and the electromagnetic drag from the error field, you will develop a powerful tool for predictive analysis. [@problem_id:3698714] This practice highlights the system-level interplay of transport, MHD, and external actuators that governs plasma stability.", "problem": "Construct a computational workflow to predict error-field-driven mode locking thresholds and the minimum correction field needed to avoid locking by coupling radial transport, neoclassical torque, and magnetohydrodynamic (MHD) single-mode response, all in a reduced yet physically grounded model. Work in normalized, dimensionless units throughout. Angles do not appear in this problem, so no angle unit is required.\n\nModel a single rational surface that hosts a resistive mode with island half-width $w(t)$ and toroidal rotation frequency $\\Omega(t)$, governed by toroidal angular momentum conservation and a quasi-steady modified Rutherford closure. The modeling assumptions are:\n\n- Toroidal angular momentum balance (inertia-free steady state): $T_{\\mathrm{ext}} - T_{\\mathrm{visc}}(\\Omega) - T_{\\mathrm{NTV}}(\\Omega) - T_{\\mathrm{EM}}(w,\\Omega,b_{\\mathrm{eff}}) = 0$. Here $T_{\\mathrm{ext}}$ is the external torque source, $T_{\\mathrm{visc}}$ is the diffusive viscous torque from radial transport, $T_{\\mathrm{NTV}}$ is the Neoclassical Toroidal Viscosity (NTV) torque, and $T_{\\mathrm{EM}}$ is the electromagnetic torque due to the resonant error field acting on the resistive layer. Treat the effective moment of inertia as absorbed into the normalization so that the steady-state equation is dimensionless and time derivatives vanish at steady state.\n\n- Viscous torque from transport: $T_{\\mathrm{visc}}(\\Omega) = \\mu\\,\\Omega$, where $\\mu$ is an effective dimensionless momentum diffusion coefficient.\n\n- Neoclassical Toroidal Viscosity (NTV) torque model: $T_{\\mathrm{NTV}}(\\Omega) = \\alpha_{\\mathrm{NTV}}\\,\\dfrac{\\Omega}{1+(\\Omega/\\Omega_{\\mathrm{trap}})^{2}}$, where $\\alpha_{\\mathrm{NTV}}$ is a dimensionless coefficient and $\\Omega_{\\mathrm{trap}}$ is a characteristic bounce or trapping frequency.\n\n- Single-mode linear MHD response magnitude for the resonant field: $R(\\Omega) = \\dfrac{R_{0}}{\\sqrt{1+(\\Omega/\\Omega_{A})^{2}}}$, where $R_{0}$ is the zero-rotation plasma response factor and $\\Omega_{A}$ is a characteristic Alfvénic screening frequency. The error field at the resonant surface is $b_{\\mathrm{eff}}(\\Omega) = \\max\\!\\big(0,\\,R(\\Omega)\\,b_{\\mathrm{err}} - b_{\\mathrm{corr}}\\big)$, where $b_{\\mathrm{err}}$ is the applied error field amplitude, and $b_{\\mathrm{corr}}$ is the corrective field amplitude aligned to cancel the resonant component. The $\\max$ models that the effective resonant drive cannot change sign; over-cancellation results in zero effective resonant drive.\n\n- Quasi-steady island width closure from a simplified modified Rutherford perspective: $w(\\Omega,b_{\\mathrm{eff}}) = \\max\\!\\Big(0,\\,\\dfrac{S}{D}\\big(b_{\\mathrm{eff}}(\\Omega) - \\beta\\,\\Omega\\big)\\Big)$, where $S$ and $D$ are positive dimensionless constants grouping drive and damping terms and $\\beta$ is a rotation-screening proportionality reflecting that higher rotation raises the threshold for island growth.\n\n- Electromagnetic torque scaling: $T_{\\mathrm{EM}}(w,\\Omega,b_{\\mathrm{eff}}) = K_{\\mathrm{EM}}\\,w^{2}\\,b_{\\mathrm{eff}}^{2}\\,\\dfrac{\\Omega}{\\Omega^{2}+\\omega_{c}^{2}}$, where $K_{\\mathrm{EM}}$ is a dimensionless constant and $\\omega_{c}$ is a characteristic resistive-layer frequency. This form captures that the torque scales with the square of the resonant field and island width, and is strongest as the mode rotation slows toward the resistive-layer frequency.\n\nDefine the steady-state torque-balance residual\n$$\nF(\\Omega; b_{\\mathrm{corr}}) = T_{\\mathrm{ext}} - \\mu\\,\\Omega - \\alpha_{\\mathrm{NTV}}\\,\\frac{\\Omega}{1+(\\Omega/\\Omega_{\\mathrm{trap}})^{2}} - K_{\\mathrm{EM}}\\,w(\\Omega,b_{\\mathrm{eff}})^{2}\\,b_{\\mathrm{eff}}(\\Omega)^{2}\\,\\frac{\\Omega}{\\Omega^{2}+\\omega_{c}^{2}}.\n$$\n\nSay that the mode is unlocked at a given $b_{\\mathrm{corr}}$ if there exists a steady-state solution $\\Omega \\ge \\Omega_{\\min}$ such that $F(\\Omega; b_{\\mathrm{corr}})=0$. Otherwise, say it is locked. The threshold $\\Omega_{\\min} > 0$ is a prescribed minimal acceptable normalized rotation frequency at the rational surface.\n\nYour tasks:\n\n- Implement a program that, for each parameter set, determines:\n  1. The locked status for $b_{\\mathrm{corr}}=0$ by testing whether there exists $\\Omega \\ge \\Omega_{\\min}$ with $F(\\Omega; 0) = 0$.\n  2. The minimum $b_{\\mathrm{corr}} \\ge 0$ such that there exists $\\Omega \\ge \\Omega_{\\min}$ with $F(\\Omega; b_{\\mathrm{corr}})=0$. If no such $b_{\\mathrm{corr}}$ exists even as $b_{\\mathrm{eff}} \\to 0$ (i.e., in the limit where the electromagnetic torque vanishes and the solution reduces to the base balance $T_{\\mathrm{ext}} - \\mu\\,\\Omega - \\alpha_{\\mathrm{NTV}}\\,\\Omega/(1+(\\Omega/\\Omega_{\\mathrm{trap}})^{2}) = 0$), then report the minimum as $-1$ to indicate impossibility under the provided external torque.\n  3. For numerical purposes, you may treat the existence problem by detecting a sign change of $F(\\Omega; b_{\\mathrm{corr}})$ in $\\Omega \\in [\\Omega_{\\min},\\,\\Omega_{\\max}]$, where $\\Omega_{\\max}$ is a sufficiently large bound justified by transport-dominated damping at high $\\Omega$. Use robust root bracketing and root-finding.\n\n- All outputs must be in normalized, dimensionless units. The final reported minimum correction amplitude must be rounded to six decimal places.\n\nTest suite:\n\nProvide results for the following four parameter sets, each given as an ordered tuple ($\\mu, \\alpha_{\\mathrm{NTV}}, \\Omega_{\\mathrm{trap}}, R_{0}, \\Omega_{A}, K_{\\mathrm{EM}}, \\omega_{c}, S, D, \\beta, T_{\\mathrm{ext}}, b_{\\mathrm{err}}, \\Omega_{\\min}$):\n\n- Case A (strong electromagnetic braking): $(0.5,\\,0.8,\\,0.3,\\,1.0,\\,0.8,\\,250.0,\\,0.05,\\,2.0,\\,1.0,\\,0.25,\\,0.12,\\,0.08,\\,0.08)$.\n- Case B (weak error field, transport-dominated): $(0.4,\\,0.2,\\,0.4,\\,0.9,\\,1.2,\\,50.0,\\,0.05,\\,1.5,\\,1.0,\\,0.3,\\,0.2,\\,0.02,\\,0.05)$.\n- Case C (insufficient external torque regardless of correction): $(1.0,\\,0.5,\\,0.2,\\,1.0,\\,1.0,\\,100.0,\\,0.05,\\,1.0,\\,1.0,\\,0.2,\\,0.02,\\,0.05,\\,0.05)$.\n- Case D (borderline screening): $(0.6,\\,0.3,\\,0.4,\\,0.8,\\,1.0,\\,100.0,\\,0.08,\\,1.2,\\,1.0,\\,0.35,\\,0.12,\\,0.06,\\,0.04)$.\n\nFinal output format:\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output a two-element list $[\\text{locked},\\,b_{\\mathrm{corr,min}}]$, where $\\text{locked}$ is a boolean and $b_{\\mathrm{corr,min}}$ is a float rounded to six decimals or the integer $-1$ if impossible. For example, a valid overall output could look like $[[\\text{True},0.123456],[\\text{False},0.0],[\\text{True},-1],[\\text{False},0.001234]]$.", "solution": "The user wants to construct a computational workflow to analyze error-field-driven mode locking in a simplified plasma model. The core of the problem is to determine the stability of a plasma's toroidal rotation against an external, non-axisymmetric magnetic perturbation (an \"error field\"). The model balances several competing torques to find a steady-state rotation frequency, $\\Omega$.\n\nThe problem is valid as it is scientifically grounded in established concepts of fusion plasma physics (MHD response, neoclassical transport, Rutherford island growth), is mathematically well-posed, objective, and provides all necessary parameters and definitions for a complete solution.\n\nThe solution is implemented by analyzing the steady-state torque balance equation, $F(\\Omega; b_{\\mathrm{corr}}) = 0$.\nA mode is \"unlocked\" if a stable rotation frequency $\\Omega \\ge \\Omega_{\\min}$ exists, meaning the equation $F(\\Omega; b_{\\mathrm{corr}}) = 0$ has a root in the specified range.\n\nThe full expression for the torque-balance residual is:\n$$\nF(\\Omega; b_{\\mathrm{corr}}) = T_{\\mathrm{ext}} - T_{\\mathrm{visc}}(\\Omega) - T_{\\mathrm{NTV}}(\\Omega) - T_{\\mathrm{EM}}(\\Omega, b_{\\mathrm{corr}})\n$$\nwhere the individual components are defined as:\n- Viscous Torque: $T_{\\mathrm{visc}}(\\Omega) = \\mu\\,\\Omega$\n- Neoclassical Toroidal Viscosity (NTV) Torque: $T_{\\mathrm{NTV}}(\\Omega) = \\alpha_{\\mathrm{NTV}}\\,\\dfrac{\\Omega}{1+(\\Omega/\\Omega_{\\mathrm{trap}})^{2}}$\n- Electromagnetic (EM) Torque: $T_{\\mathrm{EM}}(w,\\Omega,b_{\\mathrm{eff}}) = K_{\\mathrm{EM}}\\,w^{2}\\,b_{\\mathrm{eff}}^{2}\\,\\dfrac{\\Omega}{\\Omega^{2}+\\omega_{c}^{2}}$\n\nThe EM torque depends on the island width $w$ and the effective error field $b_{\\mathrm{eff}}$, which in turn depend on the plasma rotation $\\Omega$ and the applied correction field $b_{\\mathrm{corr}}$:\n- MHD Response: $R(\\Omega) = \\dfrac{R_{0}}{\\sqrt{1+(\\Omega/\\Omega_{A})^{2}}}$\n- Effective Error Field: $b_{\\mathrm{eff}}(\\Omega) = \\max\\!\\big(0,\\,R(\\Omega)\\,b_{\\mathrm{err}} - b_{\\mathrm{corr}}\\big)$\n- Island Width: $w(\\Omega,b_{\\mathrm{eff}}) = \\max\\!\\Big(0,\\,\\dfrac{S}{D}\\big(b_{\\mathrm{eff}}(\\Omega) - \\beta\\,\\Omega\\big)\\Big)$\n\nThe computational algorithm proceeds in three main steps for each parameter set:\n\n1.  **Possibility Check:** First, we must determine if an unlocked state is possible at all, even with a perfect correction field. This corresponds to the limit where the EM torque vanishes entirely ($T_{\\mathrm{EM}} \\equiv 0$), which is achieved with a sufficiently large $b_{\\mathrm{corr}}$. The torque balance reduces to $F_{\\mathrm{noEM}}(\\Omega) = T_{\\mathrm{ext}} - \\mu\\Omega - \\alpha_{\\mathrm{NTV}}\\frac{\\Omega}{1+(\\Omega/\\Omega_{\\mathrm{trap}})^{2}} = 0$. We check if this equation has a root for $\\Omega \\ge \\Omega_{\\min}$. If not, no amount of correction can prevent locking, and the minimum correction is reported as $-1$. This check is performed by evaluating $F_{\\mathrm{noEM}}(\\Omega_{\\min})$. If $F_{\\mathrm{noEM}}(\\Omega_{\\min}) \\ge 0$, a root is guaranteed since $F_{\\mathrm{noEM}}(\\Omega) \\to -\\infty$ as $\\Omega \\to \\infty$. If $F_{\\mathrm{noEM}}(\\Omega_{\\min})  0$, we numerically find the maximum value of $F_{\\mathrm{noEM}}(\\Omega)$ for $\\Omega \\ge \\Omega_{\\min}$. If this maximum is less than zero, no root exists.\n\n2.  **Locked Status at Zero Correction:** We determine if the mode is locked for $b_{\\mathrm{corr}}=0$. This involves checking for a root of the full function $F(\\Omega; 0) = 0$ for $\\Omega \\ge \\Omega_{\\min}$. The method is the same as in Step 1: we evaluate $F(\\Omega_{\\min}; 0)$ and, if it is negative, we find the maximum of $F(\\Omega; 0)$ on a suitable interval $[\\Omega_{\\min}, \\Omega_{\\max}]$ to determine if the function ever becomes non-negative. $\\Omega_{\\max}$ is chosen large enough that the viscous torque dominates and forces $F$ to be negative. The result of this check is a boolean `is_locked`.\n\n3.  **Minimum Correction Field Calculation:** If the mode is locked at $b_{\\mathrm{corr}}=0$ but an unlocked state is possible (from Step 1), we must find the minimum required correction field, $b_{\\mathrm{corr,min}}$. As $b_{\\mathrm{corr}}$ increases, the EM torque term $T_{\\mathrm{EM}}$ is non-increasing. This means the residual $F(\\Omega; b_{\\mathrm{corr}})$ is a non-decreasing function of $b_{\\mathrm{corr}}$. This monotonic behavior allows for an efficient bisection search to find the critical value of $b_{\\mathrm{corr}}$ where a root for $F=0$ first appears. The search is performed on the interval $[0, R_0 b_{\\mathrm{err}}]$, where the upper bound guarantees that $b_{\\mathrm{eff}}$ can be fully suppressed. If the mode is not locked at $b_{\\mathrm{corr}}=0$, the minimum required correction is simply $0$.\n\nThe numerical check for the existence of a root for a function $f(\\Omega)$ on $[\\Omega_{\\min}, \\infty)$ is implemented robustly. We first check the sign of $f(\\Omega_{\\min})$. If $f(\\Omega_{\\min}) \\ge 0$, then because $f(\\Omega) \\to -\\infty$ for large $\\Omega$, the Intermediate Value Theorem guarantees a root. If $f(\\Omega_{\\min})  0$, a root may still exist if the function rises above zero before falling. To check this, we find the maximum value of $f(\\Omega)$ on the interval $[\\Omega_{\\min}, \\Omega_{\\max}]$ using `scipy.optimize.minimize_scalar` on $-f(\\Omega)$. A root exists if and only if this maximum value is non-negative.\n\nFinal results are aggregated and formatted according to the problem specification.", "answer": "[[True,0.021021],[False,0.0],[True,-1],[True,0.005524]]", "id": "3698714"}]}