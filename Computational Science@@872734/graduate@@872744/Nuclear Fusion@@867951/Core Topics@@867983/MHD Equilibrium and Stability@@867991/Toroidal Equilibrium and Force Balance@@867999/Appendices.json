{"hands_on_practices": [{"introduction": "The cornerstone of magnetohydrodynamic (MHD) equilibrium is the precise balance between the outward pressure gradient force, $\\nabla p$, and the inward-confining Lorentz force, $\\mathbf{J} \\times \\mathbf{B}$. This exercise ([@problem_id:3723288]) provides a direct, hands-on test of this fundamental principle. By starting with prescribed pressure and magnetic field profiles in a simplified cylindrical model, you will calculate the force residual to determine if, and where, these profiles can truly represent a static plasma, offering crucial insight into the stringent constraints of MHD equilibrium.", "problem": "Consider a large-aspect-ratio tokamak that can be approximated as a straight, axisymmetric, circular cylinder of minor radius $a$ with cylindrical coordinates $(r,\\theta,z)$, where $r \\in [0,a]$. The plasma pressure is a flux function and is prescribed by\n$$\np(r) = p_{0}\\left(1 - \\frac{r^{2}}{a^{2}}\\right)^{2},\n$$\nwith $p_{0} > 0$. The magnetic field is axisymmetric and has only poloidal and toroidal components,\n$$\n\\mathbf{B}(r) = B_{\\theta}(r)\\,\\hat{\\boldsymbol{\\theta}} + B_{z}(r)\\,\\hat{\\mathbf{z}},\n$$\nwith\n$$\nB_{\\theta}(r) = B_{p0}\\,\\frac{r}{a}\\left(1 - \\frac{r^{2}}{a^{2}}\\right),\\qquad B_{z}(r) = B_{0}\\left(1 - \\varepsilon \\frac{r^{2}}{a^{2}}\\right),\n$$\nwhere $B_{p0} > 0$, $B_{0} > 0$, and $0 \\le \\varepsilon \\ll 1$ is a dimensionless parameter describing a weak radial variation of the toroidal field in the large-aspect-ratio limit. Assume ideal, static magnetohydrodynamics (MHD) and adopt International System of Units (SI) with vacuum permeability $\\mu_{0}$.\n\nStarting only from the fundamental definitions of the Lorentz force density $\\mathbf{f}_{L}=\\mathbf{J}\\times\\mathbf{B}$, the pressure-gradient force density $\\mathbf{f}_{p}=\\nabla p$, and Maxwell–Ampère’s law $\\mu_{0}\\mathbf{J}=\\nabla\\times\\mathbf{B}$ (together with the standard vector-calculus operators in cylindrical coordinates), compute the radial component of the force-balance residual\n$$\nf_{\\mathrm{res}}(r) \\equiv \\big(\\nabla p - \\mathbf{J}\\times\\mathbf{B}\\big)\\cdot \\hat{\\mathbf{r}},\n$$\nas an explicit analytic function of $r$, in terms of the given constants $p_{0}$, $B_{0}$, $B_{p0}$, $a$, $\\varepsilon$, and $\\mu_{0}$. Treat $r$ as a continuous variable on $[0,a]$ and do not perform any numerical substitutions.\n\nYour task is to derive $f_{\\mathrm{res}}(r)$ from first principles and present the result in SI units as a closed-form expression. You should also interpret, in words, the regions in $r$ where the equilibrium condition holds or fails based on the sign and zeros of $f_{\\mathrm{res}}(r)$. The final reported answer must be the single explicit expression for $f_{\\mathrm{res}}(r)$; no numerical rounding is required. If angles appear, they must be in radians; however, no angular evaluation is required in this problem. Express the force density in $\\mathrm{N}\\,\\mathrm{m}^{-3}$.", "solution": "The problem is subjected to validation.\n\n### Step 1: Extract Givens\n-   Geometry: Straight, axisymmetric, circular cylinder of minor radius $a$.\n-   Coordinates: Cylindrical $(r,\\theta,z)$, with $r \\in [0,a]$.\n-   Plasma pressure: $p(r) = p_{0}\\left(1 - \\frac{r^{2}}{a^{2}}\\right)^{2}$, with $p_{0} > 0$.\n-   Magnetic field: $\\mathbf{B}(r) = B_{\\theta}(r)\\,\\hat{\\boldsymbol{\\theta}} + B_{z}(r)\\,\\hat{\\mathbf{z}}$.\n    -   Poloidal component: $B_{\\theta}(r) = B_{p0}\\,\\frac{r}{a}\\left(1 - \\frac{r^{2}}{a^{2}}\\right)$, with $B_{p0} > 0$.\n    -   Toroidal component: $B_{z}(r) = B_{0}\\left(1 - \\varepsilon \\frac{r^{2}}{a^{2}}\\right)$, with $B_{0} > 0$ and $0 \\le \\varepsilon \\ll 1$.\n-   Physics model: Ideal, static magnetohydrodynamics (MHD).\n-   Fundamental equations:\n    -   Lorentz force density: $\\mathbf{f}_{L}=\\mathbf{J}\\times\\mathbf{B}$.\n    -   Pressure-gradient force density: $\\mathbf{f}_{p}=\\nabla p$.\n    -   Maxwell–Ampère’s law: $\\mu_{0}\\mathbf{J}=\\nabla\\times\\mathbf{B}$.\n-   Task: Compute the radial component of the force-balance residual, $f_{\\mathrm{res}}(r) \\equiv \\big(\\nabla p - \\mathbf{J}\\times\\mathbf{B}\\big)\\cdot \\hat{\\mathbf{r}}$, as an explicit function of $r$ and provide an interpretation.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, being a standard exercise in ideal MHD theory applied to a simplified plasma confinement geometry (the cylindrical pinch). The givens are self-contained and consistent, with all necessary functions and parameters specified. The prescribed pressure and magnetic field profiles are physically reasonable models used in plasma physics literature. The task is a direct, well-posed calculation based on fundamental vector calculus and Maxwell's equations. The language is objective and precise. The problem is valid.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\nThe task is to compute the radial component of the force-balance residual, defined as $f_{\\mathrm{res}}(r) = (\\nabla p - \\mathbf{J}\\times\\mathbf{B})\\cdot\\hat{\\mathbf{r}}$. This requires calculating the radial component of the pressure gradient, $(\\nabla p)\\cdot\\hat{\\mathbf{r}}$, and the radial component of the Lorentz force, $(\\mathbf{J}\\times\\mathbf{B})\\cdot\\hat{\\mathbf{r}}$. We proceed by calculating each term from the fundamental definitions provided.\n\nFirst, we compute the pressure gradient term. The pressure $p$ is a function of $r$ only. In cylindrical coordinates, the gradient operator is $\\nabla = \\hat{\\mathbf{r}}\\frac{\\partial}{\\partial r} + \\hat{\\boldsymbol{\\theta}}\\frac{1}{r}\\frac{\\partial}{\\partial\\theta} + \\hat{\\mathbf{z}}\\frac{\\partial}{\\partial z}$. Thus, the pressure gradient has only a radial component:\n$$\n\\nabla p = \\frac{dp}{dr}\\hat{\\mathbf{r}}.\n$$\nWe calculate the derivative of the given pressure profile $p(r) = p_{0}\\left(1 - \\frac{r^{2}}{a^{2}}\\right)^{2}$:\n$$\n\\frac{dp}{dr} = p_{0} \\cdot 2\\left(1 - \\frac{r^{2}}{a^{2}}\\right) \\cdot \\left(-\\frac{2r}{a^{2}}\\right) = -\\frac{4p_{0}r}{a^{2}}\\left(1 - \\frac{r^{2}}{a^{2}}\\right).\n$$\nThe radial component of the pressure gradient force density is therefore $(\\nabla p)\\cdot\\hat{\\mathbf{r}} = \\frac{dp}{dr}$.\n\nSecond, we compute the electric current density $\\mathbf{J}$ using Maxwell-Ampère's law, $\\mathbf{J} = \\frac{1}{\\mu_{0}}\\nabla\\times\\mathbf{B}$. The magnetic field is given by $\\mathbf{B}(r) = B_{\\theta}(r)\\,\\hat{\\boldsymbol{\\theta}} + B_{z}(r)\\,\\hat{\\mathbf{z}}$. The curl in cylindrical coordinates for an axisymmetric field with no radial component simplifies to:\n$$\n\\nabla\\times\\mathbf{B} = \\hat{\\boldsymbol{\\theta}}\\left(-\\frac{\\partial B_{z}}{\\partial r}\\right) + \\hat{\\mathbf{z}}\\frac{1}{r}\\frac{\\partial(rB_{\\theta})}{\\partial r}.\n$$\nThis implies the current density has poloidal ($\\theta$) and toroidal ($z$) components: $\\mathbf{J}(r) = J_{\\theta}(r)\\,\\hat{\\boldsymbol{\\theta}} + J_{z}(r)\\,\\hat{\\mathbf{z}}$.\nThe poloidal component $J_{\\theta}(r)$ is found from the derivative of $B_{z}(r) = B_{0}\\left(1 - \\varepsilon \\frac{r^{2}}{a^{2}}\\right)$:\n$$\n\\frac{dB_{z}}{dr} = B_{0}\\left(-\\frac{2\\varepsilon r}{a^{2}}\\right) = -\\frac{2\\varepsilon B_{0}r}{a^2}.\n$$\n$$\nJ_{\\theta}(r) = -\\frac{1}{\\mu_{0}}\\frac{dB_{z}}{dr} = \\frac{2\\varepsilon B_{0}r}{\\mu_{0}a^{2}}.\n$$\nThe toroidal component $J_{z}(r)$ is found from the derivative of $rB_{\\theta}(r)$. Given $B_{\\theta}(r) = \\frac{B_{p0}}{a}r\\left(1 - \\frac{r^{2}}{a^{2}}\\right) = \\frac{B_{p0}}{a}\\left(r - \\frac{r^{3}}{a^{2}}\\right)$, we have:\n$$\nrB_{\\theta}(r) = \\frac{B_{p0}}{a}\\left(r^{2} - \\frac{r^{4}}{a^{2}}\\right).\n$$\n$$\n\\frac{d(rB_{\\theta})}{dr} = \\frac{B_{p0}}{a}\\left(2r - \\frac{4r^{3}}{a^{2}}\\right) = \\frac{2B_{p0}r}{a}\\left(1 - \\frac{2r^{2}}{a^{2}}\\right).\n$$\n$$\nJ_{z}(r) = \\frac{1}{\\mu_{0}r}\\frac{d(rB_{\\theta})}{dr} = \\frac{1}{\\mu_{0}r}\\left[\\frac{2B_{p0}r}{a}\\left(1 - \\frac{2r^{2}}{a^{2}}\\right)\\right] = \\frac{2B_{p0}}{\\mu_{0}a}\\left(1 - \\frac{2r^{2}}{a^{2}}\\right).\n$$\n\nThird, we compute the Lorentz force density $\\mathbf{J}\\times\\mathbf{B}$. As both $\\mathbf{J}$ and $\\mathbf{B}$ lie in the $\\theta-z$ plane, the cross product will be purely radial:\n$$\n\\mathbf{J}\\times\\mathbf{B} = (J_{\\theta}\\hat{\\boldsymbol{\\theta}} + J_{z}\\hat{\\mathbf{z}})\\times(B_{\\theta}\\hat{\\boldsymbol{\\theta}} + B_{z}\\hat{\\mathbf{z}}) = J_{\\theta}B_{z}(\\hat{\\boldsymbol{\\theta}}\\times\\hat{\\mathbf{z}}) + J_{z}B_{\\theta}(\\hat{\\mathbf{z}}\\times\\hat{\\boldsymbol{\\theta}}) = (J_{\\theta}B_{z} - J_{z}B_{\\theta})\\hat{\\mathbf{r}}.\n$$\nThe radial component is $(\\mathbf{J}\\times\\mathbf{B})\\cdot\\hat{\\mathbf{r}} = J_{\\theta}B_{z} - J_{z}B_{\\theta}$. Substituting the expressions for the field and current components:\n$$\nJ_{\\theta}B_{z} = \\left(\\frac{2\\varepsilon B_{0}r}{\\mu_{0}a^{2}}\\right) \\left(B_{0}\\left(1 - \\varepsilon \\frac{r^{2}}{a^{2}}\\right)\\right) = \\frac{2\\varepsilon B_{0}^{2}r}{\\mu_{0}a^{2}}\\left(1 - \\varepsilon \\frac{r^{2}}{a^{2}}\\right).\n$$\n$$\nJ_{z}B_{\\theta} = \\left(\\frac{2B_{p0}}{\\mu_{0}a}\\left(1 - \\frac{2r^{2}}{a^{2}}\\right)\\right) \\left(B_{p0}\\frac{r}{a}\\left(1 - \\frac{r^{2}}{a^{2}}\\right)\\right) = \\frac{2B_{p0}^{2}r}{\\mu_{0}a^{2}}\\left(1 - \\frac{2r^{2}}{a^{2}}\\right)\\left(1 - \\frac{r^{2}}{a^{2}}\\right).\n$$\nThe product in the $J_{z}B_{\\theta}$ term can be expanded:\n$$\n\\left(1 - \\frac{2r^{2}}{a^{2}}\\right)\\left(1 - \\frac{r^{2}}{a^{2}}\\right) = 1 - \\frac{r^{2}}{a^{2}} - \\frac{2r^{2}}{a^{2}} + \\frac{2r^{4}}{a^{4}} = 1 - 3\\frac{r^{2}}{a^{2}} + 2\\frac{r^{4}}{a^{4}}.\n$$\nSo, the radial Lorentz force is:\n$$\n(\\mathbf{J}\\times\\mathbf{B})\\cdot\\hat{\\mathbf{r}} = \\frac{2\\varepsilon B_{0}^{2}r}{\\mu_{0}a^{2}}\\left(1 - \\varepsilon \\frac{r^{2}}{a^{2}}\\right) - \\frac{2B_{p0}^{2}r}{\\mu_{0}a^{2}}\\left(1 - 3\\frac{r^{2}}{a^{2}} + 2\\frac{r^{4}}{a^{4}}\\right).\n$$\n\nFinally, we assemble the force-balance residual $f_{\\mathrm{res}}(r) = \\frac{dp}{dr} - (\\mathbf{J}\\times\\mathbf{B})\\cdot\\hat{\\mathbf{r}}$:\n$$\nf_{\\mathrm{res}}(r) = -\\frac{4p_{0}r}{a^{2}}\\left(1 - \\frac{r^{2}}{a^{2}}\\right) - \\left[ \\frac{2\\varepsilon B_{0}^{2}r}{\\mu_{0}a^{2}}\\left(1 - \\varepsilon \\frac{r^{2}}{a^{2}}\\right) - \\frac{2B_{p0}^{2}r}{\\mu_{0}a^{2}}\\left(1 - 3\\frac{r^{2}}{a^{2}} + 2\\frac{r^{4}}{a^{4}}\\right) \\right].\n$$\nTo obtain a clear polynomial form, we can factor out common terms and group by powers of $r$. Let's factor out $\\frac{2r}{\\mu_{0}a^{2}}$:\n$$\nf_{\\mathrm{res}}(r) = \\frac{2r}{\\mu_{0}a^{2}} \\left[ -2\\mu_{0}p_{0}\\left(1 - \\frac{r^{2}}{a^{2}}\\right) - \\varepsilon B_{0}^{2}\\left(1 - \\varepsilon \\frac{r^{2}}{a^{2}}\\right) + B_{p0}^{2}\\left(1 - 3\\frac{r^{2}}{a^{2}} + 2\\frac{r^{4}}{a^{4}}\\right) \\right].\n$$\nExpanding and collecting terms by powers of $r^2/a^2$ inside the brackets:\n$$\nf_{\\mathrm{res}}(r) = \\frac{2r}{\\mu_{0}a^{2}} \\left[ (-2\\mu_{0}p_{0} - \\varepsilon B_{0}^{2} + B_{p0}^{2}) + (2\\mu_{0}p_{0} + \\varepsilon^{2}B_{0}^{2} - 3B_{p0}^{2})\\frac{r^{2}}{a^{2}} + (2B_{p0}^{2})\\frac{r^{4}}{a^{4}} \\right].\n$$\nThis can be written as an explicit polynomial in $r$:\n$$\nf_{\\mathrm{res}}(r) = \\frac{2}{\\mu_{0}a^2}(B_{p0}^2 - 2\\mu_{0}p_{0} - \\varepsilon B_{0}^2)r + \\frac{2}{\\mu_{0}a^4}(2\\mu_{0}p_{0} - 3B_{p0}^{2} + \\varepsilon^{2}B_{0}^{2})r^3 + \\frac{4B_{p0}^{2}}{\\mu_{0}a^6}r^5.\n$$\n\nInterpretation: The quantity $f_{\\mathrm{res}}(r)$ represents the net radial force density required to hold the plasma in a static state, given the prescribed profiles. The physical force on a plasma fluid element is $\\mathbf{F} = -\\nabla p + \\mathbf{J}\\times\\mathbf{B}$. The residual is $f_{\\mathrm{res}}(r) = -F_r$, where $F_r$ is the radial component of $\\mathbf{F}$.\n-   If $f_{\\mathrm{res}}(r) = 0$, the plasma is in radial force balance at that specific radius $r$. The outward force from the pressure gradient, $(-\\nabla p)_r$, is perfectly balanced by the inward Lorentz force, $(\\mathbf{J}\\times\\mathbf{B})_r$.\n-   If $f_{\\mathrm{res}}(r) < 0$, it implies $F_r > 0$. The net physical force on the plasma is directed radially outward. This means the outward pressure gradient force exceeds the confining Lorentz force, and the plasma at that radius would tend to expand.\n-   If $f_{\\mathrm{res}}(r) > 0$, it implies $F_r < 0$. The net physical force is directed radially inward. The Lorentz force over-confines the plasma pressure, and the plasma at that radius would tend to be compressed.\n\nFrom the derived expression, $f_{\\mathrm{res}}(0) = 0$, which is a consequence of axisymmetry; the forces must vanish at the center. For $r > 0$, the equilibrium condition $f_{\\mathrm{res}}(r) = 0$ requires finding the roots of a quadratic equation in $r^2$. In general, for arbitrary parameters, this equation will not be satisfied for all $r$, meaning the chosen profiles do not represent a true MHD equilibrium. Equilibrium may exist only at discrete radii, if at all, in the interval $r \\in (0, a]$.", "answer": "$$\\boxed{\\frac{2}{\\mu_{0}a^2}(B_{p0}^2 - 2\\mu_{0}p_{0} - \\varepsilon B_{0}^2)r + \\frac{2}{\\mu_{0}a^4}(2\\mu_{0}p_{0} - 3B_{p0}^{2} + \\varepsilon^{2}B_{0}^{2})r^3 + \\frac{4B_{p0}^{2}}{\\mu_{0}a^6}r^5}$$", "id": "3723288"}, {"introduction": "While direct force calculation is insightful, a more powerful framework for describing axisymmetric toroidal equilibria is the Grad-Shafranov equation, which recasts the force balance problem in terms of the poloidal magnetic flux function, $\\psi$. This practice ([@problem_id:3723296]) delves into finding an analytical solution for an important class of equilibria, demonstrating how plasma shaping parameters like elongation $\\kappa$ are incorporated. Solving this problem reveals how the plasma's internal structure is determined by the interplay of pressure, current, and the shape of the confining magnetic boundary.", "problem": "Consider a static, axisymmetric magnetohydrodynamic (MHD) equilibrium in cylindrical coordinates $(R,\\phi,Z)$ with $\\partial/\\partial\\phi=0$. The equilibrium satisfies the force balance $\\nabla p=\\mathbf{J}\\times\\mathbf{B}$ together with $\\nabla\\times\\mathbf{B}=\\mu_{0}\\mathbf{J}$ and $\\nabla\\cdot\\mathbf{B}=0$. Introduce the poloidal flux function $\\psi(R,Z)$ via the standard axisymmetric representation of the magnetic field, and derive the scalar equation governing $\\psi(R,Z)$ that follows from these equations.\n\nAssume a Solov’ev class equilibrium in which the pressure and the square of the toroidal field function are linear in $\\psi$, namely $\\mathrm{d}p/\\mathrm{d}\\psi=-A$ and $\\mathrm{d}F^{2}/\\mathrm{d}\\psi=-B$, with $A>0$ and $B$ real constants. In a large–aspect–ratio tokamak with major radius $R_{0}\\gg a$, adopt the leading–order approximation inside the plasma that $R\\simeq R_{0}$ wherever it appears as a multiplicative factor in the source terms, and approximate the differential operator by its leading–order form in the local coordinates $x\\equiv R-R_{0}$ and $Z$.\n\nImpose a shaped Dirichlet boundary condition corresponding to an up–down symmetric, elongated cross–section: the last closed flux surface is the ellipse given by\n$$\n\\frac{x^{2}}{a^{2}}+\\frac{Z^{2}}{\\kappa^{2}a^{2}}=1,\n$$\nand take $\\psi=0$ on this boundary. Determine the analytic expression for the flux function $\\psi(R,Z)$ inside the plasma that satisfies the governing equation under the above approximations and boundary condition. Express your final answer as a single closed–form expression in terms of the parameters $\\mu_{0}$, $A$, $B$, $R_{0}$, $a$, and $\\kappa$ and the coordinates $R$ and $Z$. No numerical evaluation or rounding is required, and no physical units should be included in the final boxed expression. State the angle variable in radians if any appear in your derivation or answer; none are expected to appear in the final expression.", "solution": "The starting point is the magnetostatic force balance of magnetohydrodynamics (MHD),\n$$\n\\nabla p=\\mathbf{J}\\times\\mathbf{B},\n$$\ntogether with Maxwell’s equations for magnetostatics,\n$$\n\\nabla\\times\\mathbf{B}=\\mu_{0}\\mathbf{J},\\qquad \\nabla\\cdot\\mathbf{B}=0.\n$$\nUnder axisymmetry in cylindrical coordinates $(R,\\phi,Z)$ with $\\partial/\\partial\\phi=0$, one introduces the poloidal flux function $\\psi(R,Z)$ and the toroidal field function $F(\\psi)$ by the standard representation\n$$\n\\mathbf{B}=\\frac{1}{R}\\nabla\\phi\\times\\nabla\\psi+\\frac{F(\\psi)}{R}\\,\\nabla\\phi,\n$$\nwhich identically satisfies $\\nabla\\cdot\\mathbf{B}=0$. Using $\\nabla\\times\\mathbf{B}=\\mu_{0}\\mathbf{J}$, one can compute the current density and project the force balance perpendicular to flux surfaces to obtain the Grad–Shafranov (GS) equation. The well–known result (derived by standard vector calculus identities) is\n$$\n\\Delta^{*}\\psi=-\\mu_{0}R^{2}\\frac{\\mathrm{d}p}{\\mathrm{d}\\psi}-\\frac{1}{2}\\frac{\\mathrm{d}F^{2}}{\\mathrm{d}\\psi},\n$$\nwhere the Grad–Shafranov operator is\n$$\n\\Delta^{*}\\psi\\equiv R\\frac{\\partial}{\\partial R}\\!\\left(\\frac{1}{R}\\frac{\\partial\\psi}{\\partial R}\\right)+\\frac{\\partial^{2}\\psi}{\\partial Z^{2}}=\\frac{\\partial^{2}\\psi}{\\partial R^{2}}-\\frac{1}{R}\\frac{\\partial\\psi}{\\partial R}+\\frac{\\partial^{2}\\psi}{\\partial Z^{2}}.\n$$\n\nIn the Solov’ev class, one takes\n$$\n\\frac{\\mathrm{d}p}{\\mathrm{d}\\psi}=-A,\\qquad \\frac{\\mathrm{d}F^{2}}{\\mathrm{d}\\psi}=-B,\n$$\nwith constants $A>0$ and $B$ real. Substitution into the Grad–Shafranov equation gives the linear inhomogeneous equation\n$$\n\\Delta^{*}\\psi=\\mu_{0}A\\,R^{2}+\\frac{B}{2}.\n$$\n\nWe now implement the stated large–aspect–ratio approximations. Let $R_{0}\\gg a$ denote the major radius and introduce local coordinates $x\\equiv R-R_{0}$ and $Z$, with $|x|,|Z|\\lesssim a\\ll R_{0}$. Then to leading order in the small parameter $a/R_{0}$, one approximates $R\\simeq R_{0}$ wherever it multiplies a source term, so that $R^{2}\\simeq R_{0}^{2}$ on the right–hand side, and replaces the Grad–Shafranov operator by its leading–order form\n$$\n\\Delta^{*}\\psi=\\frac{\\partial^{2}\\psi}{\\partial R^{2}}-\\frac{1}{R}\\frac{\\partial\\psi}{\\partial R}+\\frac{\\partial^{2}\\psi}{\\partial Z^{2}}\\simeq \\frac{\\partial^{2}\\psi}{\\partial x^{2}}+\\frac{\\partial^{2}\\psi}{\\partial Z^{2}},\n$$\nwhere the neglected term $-(1/R)\\,\\partial\\psi/\\partial R$ is smaller than the retained second–derivative terms by a factor of order $a/R_{0}$. With these approximations, the governing equation reduces inside the plasma to a constant–source Poisson equation in the $(x,Z)$ plane:\n$$\n\\frac{\\partial^{2}\\psi}{\\partial x^{2}}+\\frac{\\partial^{2}\\psi}{\\partial Z^{2}}=S,\\qquad S\\equiv \\mu_{0}A\\,R_{0}^{2}+\\frac{B}{2}.\n$$\n\nWe impose the shaped Dirichlet boundary condition $\\psi=0$ on the ellipse\n$$\n\\frac{x^{2}}{a^{2}}+\\frac{Z^{2}}{\\kappa^{2}a^{2}}=1,\n$$\nwhich describes an up–down symmetric elongated cross–section of minor radius $a$ and elongation $\\kappa$. Because the source is constant, a quadratic ansatz satisfies the Poisson equation and the boundary condition:\n$$\n\\psi(x,Z)=C\\left(1-\\frac{x^{2}}{a^{2}}-\\frac{Z^{2}}{\\kappa^{2}a^{2}}\\right),\n$$\nfor some constant amplitude $C$ to be determined. This ansatz vanishes on the specified ellipse and is smooth inside.\n\nCompute its Laplacian:\n$$\n\\frac{\\partial^{2}\\psi}{\\partial x^{2}}=\\frac{\\partial^{2}}{\\partial x^{2}}\\left[C\\left(1-\\frac{x^{2}}{a^{2}}-\\frac{Z^{2}}{\\kappa^{2}a^{2}}\\right)\\right]=-\\,\\frac{2C}{a^{2}},\n$$\n$$\n\\frac{\\partial^{2}\\psi}{\\partial Z^{2}}=\\frac{\\partial^{2}}{\\partial Z^{2}}\\left[C\\left(1-\\frac{x^{2}}{a^{2}}-\\frac{Z^{2}}{\\kappa^{2}a^{2}}\\right)\\right]=-\\,\\frac{2C}{\\kappa^{2}a^{2}}.\n$$\nTherefore,\n$$\n\\frac{\\partial^{2}\\psi}{\\partial x^{2}}+\\frac{\\partial^{2}\\psi}{\\partial Z^{2}}=-\\,\\frac{2C}{a^{2}}\\left(1+\\frac{1}{\\kappa^{2}}\\right).\n$$\nEquating this to the constant source $S$ yields\n$$\n-\\,\\frac{2C}{a^{2}}\\left(1+\\frac{1}{\\kappa^{2}}\\right)=S\\quad\\Rightarrow\\quad C=-\\,\\frac{S\\,a^{2}}{2\\left(1+\\frac{1}{\\kappa^{2}}\\right)}.\n$$\n\nSubstituting $S=\\mu_{0}A\\,R_{0}^{2}+B/2$ and $x=R-R_{0}$ gives the desired closed–form flux function:\n$$\n\\psi(R,Z)=-\\,\\frac{\\left(\\mu_{0}A\\,R_{0}^{2}+\\frac{B}{2}\\right)a^{2}}{2\\left(1+\\frac{1}{\\kappa^{2}}\\right)}\\left(1-\\frac{(R-R_{0})^{2}}{a^{2}}-\\frac{Z^{2}}{\\kappa^{2}a^{2}}\\right).\n$$\n\nThis expression exhibits explicitly how the shaped boundary enters the solution through the geometric parameters $a$ and $\\kappa$. It solves, to leading order in the large–aspect–ratio approximation, the Solov’ev–driven Grad–Shafranov equation with the specified Dirichlet boundary condition on the elongated cross–section. No angle variables appear in the final expression, so no angle unit specification is required.", "answer": "$$\\boxed{-\\,\\frac{\\left(\\mu_{0}A\\,R_{0}^{2}+\\frac{B}{2}\\right)a^{2}}{2\\left(1+\\frac{1}{\\kappa^{2}}\\right)}\\left(1-\\frac{(R-R_{0})^{2}}{a^{2}}-\\frac{Z^{2}}{\\kappa^{2}a^{2}}\\right)}$$", "id": "3723296"}, {"introduction": "A theoretical equilibrium solution is only physically meaningful if it is stable. The elongated plasma cross-sections desirable for enhanced performance, such as those that can be described by the previous practice, are inherently unstable to vertical displacements. This computational exercise ([@problem_id:3723237]) moves from static equilibrium to the dynamic challenge of stability and control, tasking you with applying the Biot-Savart law to design a feedback coil system that can provide the necessary restoring force to stabilize the plasma's vertical position.", "problem": "Consider an axisymmetric tokamak plasma with an elongated cross-section. The plasma is modeled, for the purpose of vertical force balance, as a thin toroidal current ring with major radius $R_0$, minor radius $a$, elongation (ratio of vertical to horizontal minor semi-axes) $\\kappa$, and total toroidal current $I_p$. Assume $a \\ll R_0$ so that the thin-ring approximation is valid and the radial magnetic field is approximately uniform across the cross-section. A symmetric pair of vertical feedback coils (ring coils) of radius $R_c$ are located above and below the midplane at axial positions $z = +z_c$ and $z = -z_c$, respectively; each carries the same feedback current $I_v$. The coils are coaxial with the tokamak axis. \n\nYou must analyze the vertical force balance and compute the feedback coil current $I_v$ required to counteract vertical instability and produce a specified net linear restoring stiffness about the midplane. Adopt the International System of Units (SI). All angles, if any appear, are to be treated in radians.\n\nFundamental base and modeling assumptions to use:\n- The Lorentz force density is $\\mathbf{f} = \\mathbf{J} \\times \\mathbf{B}$. The net vertical force on the thin toroidal ring in the presence of a radial magnetic field $B_r$ is approximated by\n$$\nF_z \\approx I_p \\, L \\, B_r(R_0, z),\n$$\nwhere $L = 2\\pi R_0$ is the ring circumference and $B_r(R_0, z)$ is the radial magnetic field evaluated at the ring center $(R_0, z)$.\n- The magnetic field of each coil must be computed from the Biot–Savart law,\n$$\n\\mathbf{B}(\\mathbf{r}) = \\frac{\\mu_0 I}{4\\pi} \\oint \\frac{d\\boldsymbol{\\ell} \\times \\mathbf{R}}{|\\mathbf{R}|^3},\n$$\nwhere $\\mu_0$ is the vacuum permeability, $I$ is the coil current, $d\\boldsymbol{\\ell}$ is the coil line element, and $\\mathbf{R}$ is the displacement vector from the coil element to the field point $\\mathbf{r}$. Model each ring coil as a circular filament and numerically evaluate the integral by discretizing the loop into a sufficient number of segments.\n- Linearize about the midplane $z=0$. For small displacements $z$, write\n$$\nB_r(R_0, z) \\approx B_r(R_0, 0) + z \\left.\\frac{\\partial B_r}{\\partial z}\\right|_{z=0}.\n$$\nWith a symmetric pair of identical coils located at $z=\\pm z_c$, the symmetry implies $B_r(R_0, 0) \\approx 0$, so the leading contribution is the slope at $z=0$.\n- Let $K_{\\text{ext}}$ denote the baseline external linear vertical stiffness (units: $\\text{N}/\\text{m}$) arising from all non-feedback fields and geometry, which may be negative for an elongated plasma (reflecting vertical instability). The feedback coils contribute a stiffness\n$$\nK_{\\text{fb}} = I_p \\, L \\, S \\, I_v,\n$$\nwhere\n$$\nS \\equiv \\left.\\frac{\\partial B_r}{\\partial z}\\right|_{z=0,\\, I_v=1}\n$$\nis the radial-field slope per unit coil current evaluated at the plasma center. The net stiffness is\n$$\nK_{\\text{net}} = K_{\\text{ext}} + K_{\\text{fb}}.\n$$\nYour task is to compute $I_v$ such that $K_{\\text{net}}$ equals a specified target $K_{\\text{target}} > 0$.\n\nAlgorithmic tasks to implement:\n1. Using the Biot–Savart law, compute the magnetic field $\\mathbf{B}$ at the point $(R_0, 0, z)$ due to a circular loop of radius $R_c$ centered at $(0,0,z_c)$ carrying current $I$. Use a uniform discretization of the loop parameterized by angle with at least $N$ segments. Extract the radial component $B_r$ from the Cartesian component $B_x$ at the field point $(R_0, 0, z)$.\n2. For the symmetric pair of feedback coils at $z=\\pm z_c$ with equal current $I_v$, compute $B_r^{\\text{pair}}(R_0, z; I_v)$ by superposition.\n3. Evaluate the slope $S = \\left.\\frac{\\partial B_r}{\\partial z}\\right|_{z=0,\\, I_v=1}$ numerically using a symmetric finite difference with a small step $\\Delta z$:\n$$\nS \\approx \\frac{B_r^{\\text{pair}}(R_0, +\\Delta z; 1) - B_r^{\\text{pair}}(R_0, -\\Delta z; 1)}{2\\,\\Delta z}.\n$$\n4. Compute the feedback coil current\n$$\nI_v = \\frac{K_{\\text{target}} - K_{\\text{ext}}}{I_p \\, L \\, S}.\n$$\n\nScientific realism and constraints:\n- Assume $a \\ll R_0$ and that $B_r$ varies slowly across the plasma cross-section so that the thin-ring approximation for net force is valid for elongated cross-sections with elongation $\\kappa > 1$.\n- Use $\\mu_0 = 4\\pi \\times 10^{-7}\\ \\text{H}/\\text{m}$.\n- All computed coil currents must be reported in Ampere ($\\text{A}$). Forces are in Newton ($\\text{N}$), lengths in meters ($\\text{m}$), and magnetic fields in Tesla ($\\text{T}$).\n\nTest suite:\nFor each parameter set below, compute the required feedback coil current $I_v$ in $\\text{A}$.\n\n- Case 1 (happy path): $I_p = 5.0\\times 10^{6}\\ \\text{A}$, $R_0 = 3.0\\ \\text{m}$, $a = 0.6\\ \\text{m}$, $\\kappa = 1.8$, $R_c = 3.2\\ \\text{m}$, $z_c = 1.0\\ \\text{m}$, $K_{\\text{ext}} = -8.0\\times 10^{5}\\ \\text{N}/\\text{m}$, $K_{\\text{target}} = 4.0\\times 10^{5}\\ \\text{N}/\\text{m}$, $N = 1200$, $\\Delta z = 2.0\\times 10^{-4}\\ \\text{m}$.\n- Case 2 (boundary: no baseline stiffness): $I_p = 1.0\\times 10^{7}\\ \\text{A}$, $R_0 = 2.5\\ \\text{m}$, $a = 0.5\\ \\text{m}$, $\\kappa = 2.0$, $R_c = 2.7\\ \\text{m}$, $z_c = 0.8\\ \\text{m}$, $K_{\\text{ext}} = 0.0\\ \\text{N}/\\text{m}$, $K_{\\text{target}} = 2.0\\times 10^{5}\\ \\text{N}/\\text{m}$, $N = 1400$, $\\Delta z = 2.0\\times 10^{-4}\\ \\text{m}$.\n- Case 3 (edge: distant coils): $I_p = 6.0\\times 10^{6}\\ \\text{A}$, $R_0 = 3.5\\ \\text{m}$, $a = 0.7\\ \\text{m}$, $\\kappa = 1.6$, $R_c = 4.0\\ \\text{m}$, $z_c = 2.0\\ \\text{m}$, $K_{\\text{ext}} = -1.2\\times 10^{6}\\ \\text{N}/\\text{m}$, $K_{\\text{target}} = 6.0\\times 10^{5}\\ \\text{N}/\\text{m}$, $N = 1600$, $\\Delta z = 2.0\\times 10^{-4}\\ \\text{m}$.\n\nFinal output format:\nYour program should produce a single line of output containing the computed feedback coil currents in Ampere as a comma-separated list enclosed in square brackets, with each value formatted to six decimal places, for the three cases in the order given (e.g., $[I_1,I_2,I_3]$ where each $I_i$ is a float in $\\text{A}$).", "solution": "The problem requires the calculation of the feedback current $I_v$ in a pair of symmetric coils needed to achieve a specified vertical stabilizing stiffness $K_{\\text{target}}$ for an elongated tokamak plasma. The solution proceeds by first principles, starting from the Biot-Savart law to determine the magnetic field produced by the feedback coils, and then relating this field to the restoring force and stiffness it imparts on the plasma, which is modeled as a rigid current-carrying ring.\n\nThe fundamental model is based on the Lorentz force exerted on the plasma. For a thin toroidal plasma ring of major radius $R_0$ and toroidal current $I_p$, displaced vertically by a small amount $z$ from the midplane, the net vertical force $F_z$ due to an external radial magnetic field $B_r$ is given by\n$$F_z(z) \\approx I_p L B_r(R_0, z)$$\nwhere $L = 2\\pi R_0$ is the circumference of the toroidal ring. The vertical stiffness $K$ is defined from the change in force with vertical displacement. The problem implicitly defines stiffness via the relation for net stiffness, $K_{\\text{net}} = K_{\\text{ext}} + K_{\\text{fb}}$, where $K_{\\text{ext}}$ is the given stiffness from the equilibrium fields and plasma shape, and $K_{\\text{fb}}$ is the contribution from the feedback coils. The feedback stiffness is derived from the force produced by the coils, $F_z^{\\text{fb}} = I_p L B_r^{\\text{pair}}$, where $B_r^{\\text{pair}}$ is the radial field from the coil pair. The problem defines the feedback stiffness as\n$$K_{\\text{fb}} = I_p L S I_v$$\nwhere $S$ is the slope of the radial magnetic field per unit current at the plasma center, $S \\equiv \\left.\\frac{\\partial B_r^{\\text{pair}}}{\\partial z}\\right|_{z=0,\\, I_v=1}$. By setting the net stiffness to the target value, $K_{\\text{net}} = K_{\\text{target}}$, we get the equation:\n$$K_{\\text{target}} = K_{\\text{ext}} + I_p L S I_v$$\nSolving for the required feedback current $I_v$ yields:\n$$I_v = \\frac{K_{\\text{target}} - K_{\\text{ext}}}{I_p L S}$$\nThe primary computational task is to determine the value of $S$. This requires calculating the magnetic field from the feedback coils.\n\nThe magnetic field $\\mathbf{B}$ generated by a current-carrying wire is given by the Biot-Savart law:\n$$\\mathbf{B}(\\mathbf{r}) = \\frac{\\mu_0 I}{4\\pi} \\oint \\frac{d\\boldsymbol{\\ell} \\times \\mathbf{R}}{|\\mathbf{R}|^3}$$\nwhere $\\mu_0 = 4\\pi \\times 10^{-7}\\ \\text{H}/\\text{m}$ is the vacuum permeability, $I$ is the current in the wire, $d\\boldsymbol{\\ell}$ is an infinitesimal element of the wire, and $\\mathbf{R}$ is the vector from the wire element $d\\boldsymbol{\\ell}$ to the field point $\\mathbf{r}$.\n\nWe model each feedback coil as a circular filament of radius $R_c$ coaxial with the z-axis, located at an axial position $z_c$. A point on this loop can be parameterized by the azimuthal angle $\\phi'$ as $\\mathbf{r}' = (R_c \\cos\\phi', R_c \\sin\\phi', z_c)$. The differential line element is $d\\boldsymbol{\\ell} = (-R_c \\sin\\phi', R_c \\cos\\phi', 0)d\\phi'$. We are interested in the field at a point on the major radius of the torus, which we can set to be on the x-axis without loss of generality due to axisymmetry: $\\mathbf{r} = (R_0, 0, z)$. The displacement vector is $\\mathbf{R} = \\mathbf{r} - \\mathbf{r}' = (R_0 - R_c \\cos\\phi', -R_c \\sin\\phi', z - z_c)$. The squared magnitude of $\\mathbf{R}$ is $|\\mathbf{R}|^2 = (R_0 - R_c \\cos\\phi')^2 + R_c^2 \\sin^2\\phi' + (z-z_c)^2 = R_0^2 + R_c^2 - 2R_0 R_c \\cos\\phi' + (z-z_c)^2$.\n\nThe cross product $d\\boldsymbol{\\ell} \\times \\mathbf{R}$ gives the direction of the field contribution from $d\\boldsymbol{\\ell}$. The radial component of the magnetic field, $B_r$, at the point $(R_0, 0, z)$ corresponds to the $B_x$ component. The $x$-component of the cross product is $(d\\boldsymbol{\\ell} \\times \\mathbf{R})_x = R_c(z-z_c)\\cos\\phi' d\\phi'$. Therefore, the radial magnetic field from a single coil at $z_c$ is:\n$$B_r^{\\text{single}}(R_0, z; I, z_c) = \\frac{\\mu_0 I}{4\\pi} \\int_0^{2\\pi} \\frac{R_c (z - z_c) \\cos\\phi'}{(R_0^2 + R_c^2 - 2R_0 R_c \\cos\\phi' + (z-z_c)^2)^{3/2}} d\\phi'$$\nThis integral is evaluated numerically by discretizing the loop into $N$ segments. The integral becomes a sum:\n$$\\int_0^{2\\pi} f(\\phi')d\\phi' \\approx \\sum_{i=0}^{N-1} f(\\phi'_i) \\Delta\\phi' \\quad \\text{where} \\quad \\phi'_i = i \\frac{2\\pi}{N}, \\Delta\\phi' = \\frac{2\\pi}{N}$$\n\nThe feedback system consists of a symmetric pair of coils at $z = +z_c$ and $z = -z_c$, each carrying the same current $I_v$. By the principle of superposition, the total radial field is the sum of the fields from each coil:\n$$B_r^{\\text{pair}}(R_0, z; I_v) = B_r^{\\text{single}}(R_0, z; I_v, +z_c) + B_r^{\\text{single}}(R_0, z; I_v, -z_c)$$\nNext, we compute the field gradient per unit current, $S$. This is evaluated numerically using a symmetric finite difference approximation with a small step size $\\Delta z$:\n$$S = \\left.\\frac{\\partial B_r^{\\text{pair}}}{\\partial z}\\right|_{z=0,\\, I_v=1} \\approx \\frac{B_r^{\\text{pair}}(R_0, +\\Delta z; I_v=1) - B_r^{\\text{pair}}(R_0, -\\Delta z; I_v=1)}{2\\Delta z}$$\nDue to the symmetry of the coil pair, the radial field $B_r^{\\text{pair}}(R_0, z; I_v)$ is an odd function of $z$, meaning $B_r^{\\text{pair}}(R_0, -z; I_v) = -B_r^{\\text{pair}}(R_0, z; I_v)$. The formula for $S$ can be simplified to $S \\approx B_r^{\\text{pair}}(R_0, \\Delta z; I_v=1) / \\Delta z$, though using the two-point formula is more robust.\n\nWith the value of $S$ computed, all terms in the expression for $I_v$ are known. For each test case, we substitute the given parameters ($I_p, R_0, R_c, z_c, K_{\\text{ext}}, K_{\\text{target}}$) and the numerically determined value of $S$ to find the required feedback current $I_v$. The determined sign of $I_v$ indicates the direction of current flow required for stabilization relative to the direction assumed for the $I_v = 1\\ \\text{A}$ calculation of $S$. A negative stiffness $K_{\\text{ext}}$ denotes an inherently unstable plasma, which is typical for vertically elongated cross-sections ($\\kappa > 1$), requiring active feedback to achieve a stable state ($K_{\\text{target}} > 0$).", "answer": "[13531.423971,3902.955561,35354.125712]", "id": "3723237"}]}