{"hands_on_practices": [{"introduction": "A foundational concept in the study of self-organized plasmas is the Taylor relaxation theory, which predicts that a plasma will relax to a minimum energy state while conserving total magnetic helicity. This practice provides a classic application of this theory by examining the stability of such a relaxed state in a cylindrical geometry, which serves as a useful approximation for toroidal devices. You will derive the magnetic field profile for this state, known as the Bessel Function Model, and then calculate its safety factor $q(r)$ to assess its stability against the ideal external kink mode using the renowned Kruskal–Shafranov criterion [@problem_id:3719246]. This exercise is fundamental for understanding the interplay between plasma equilibrium and magnetohydrodynamic (MHD) stability.", "problem": "Consider an axisymmetric magnetized plasma confined inside a perfectly conducting, straight, periodic cylindrical vessel of radius $a$ and periodicity length $L$ (so that the domain is topologically equivalent to a torus). The plasma is in a relaxed magnetohydrodynamic (MHD) state in the sense of Taylor relaxation, namely it satisfies the force-free condition $\\nabla \\times \\mathbf{B} = \\lambda \\mathbf{B}$ with a spatially uniform eigenvalue $\\lambda$. Assume the magnetic field depends only on the cylindrical radius $r$ and has components $\\mathbf{B}(r) = B_{r}(r)\\,\\hat{\\mathbf{e}}_{r} + B_{\\theta}(r)\\,\\hat{\\mathbf{e}}_{\\theta} + B_{z}(r)\\,\\hat{\\mathbf{e}}_{z}$, with $B_{r}(r)=0$ throughout the plasma. The last closed flux surface coincides with the conducting wall at $r=a$, and field lines are periodic along $z$ with period $L$.\n\nYour tasks are:\n- Starting from the field-line equation and the definition of rotational transform, derive an expression for the safety factor $q(r)$ in a periodic cylinder in terms of $B_{\\theta}(r)$, $B_{z}(r)$, $r$, and $L$.\n- Starting from $\\nabla \\times \\mathbf{B} = \\lambda \\mathbf{B}$ with the above symmetry assumptions, determine the general form of $B_{\\theta}(r)$ and $B_{z}(r)$ up to an overall amplitude based on well-behaved solutions regular at $r=0$.\n- Combine these results to obtain an explicit expression for $q(r)$ for the Taylor-relaxed eigenfunction.\n\nFor a specific device, take the parameters $a=0.25\\,\\mathrm{m}$, $L=1.2\\,\\mathrm{m}$, and $\\lambda = 6.0\\,\\mathrm{m}^{-1}$. Evaluate the edge safety factor $q_{\\mathrm{edge}} \\equiv q(a)$ numerically and report it as a pure number (dimensionless). Then, based on the Kruskal–Shafranov ideal kink condition, assess whether the configuration satisfies $q_{\\mathrm{edge}}  1$. Round your reported value of $q_{\\mathrm{edge}}$ to four significant figures and express it as a dimensionless number with no units.", "solution": "The problem is first validated to ensure it is scientifically sound, well-posed, and objective.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n-   **System:** Axisymmetric magnetized plasma in a perfectly conducting, straight, periodic cylindrical vessel.\n-   **Geometry:** Radius $a$, periodicity length $L$.\n-   **Plasma State:** Taylor-relaxed magnetohydrodynamic (MHD) state.\n-   **Governing Equation:** $\\nabla \\times \\mathbf{B} = \\lambda \\mathbf{B}$, where $\\lambda$ is a spatially uniform eigenvalue.\n-   **Field Structure:** $\\mathbf{B}(r) = B_{\\theta}(r)\\,\\hat{\\mathbf{e}}_{\\theta} + B_{z}(r)\\,\\hat{\\mathbf{e}}_{z}$ (since $B_r(r)=0$).\n-   **Boundary/Regularity Conditions:** Last closed flux surface at $r=a$. Field lines are periodic in $z$ with period $L$. Solutions must be regular at $r=0$.\n-   **Tasks:**\n    1. Derive $q(r)$ in terms of $B_{\\theta}(r)$, $B_{z}(r)$, $r$, and $L$.\n    2. Determine the general form of $B_{\\theta}(r)$ and $B_{z}(r)$ for the Taylor state.\n    3. Obtain an explicit expression for $q(r)$ for this state.\n    4. For $a=0.25\\,\\mathrm{m}$, $L=1.2\\,\\mathrm{m}$, $\\lambda = 6.0\\,\\mathrm{m}^{-1}$, calculate $q_{\\mathrm{edge}} \\equiv q(a)$ to four significant figures and assess stability against the Kruskal-Shafranov condition $q_{\\mathrm{edge}}  1$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded in standard MHD theory, specifically the concepts of Taylor relaxation, force-free equilibria, and the safety factor, which are central to the study of plasma confinement devices like spheromaks. It is well-posed, providing a clear governing equation, geometry, and boundary/regularity conditions. The language is objective and precise. The tasks form a logical sequence leading to a unique, verifiable solution. The provided numerical parameters are physically realistic. The problem is therefore valid.\n\n**Step 3: Verdict and Action**\nThe problem is valid. The solution will now be derived.\n\n### Detailed Solution\n\n**Part 1: Derivation of the Safety Factor $q(r)$**\n\nThe magnetic field lines are defined by the differential equation $d\\mathbf{l} \\propto \\mathbf{B}$, where $d\\mathbf{l}$ is the vector element of arc length along a field line. In cylindrical coordinates $(r, \\theta, z)$, this is expressed as:\n$$\n\\frac{dr}{B_r} = \\frac{r d\\theta}{B_\\theta} = \\frac{dz}{B_z}\n$$\nGiven the problem statement that $B_r(r)=0$, the field lines are constrained to lie on cylindrical surfaces of constant radius $r$. For these surfaces, the field line trajectory is governed by:\n$$\n\\frac{r d\\theta}{B_\\theta(r)} = \\frac{dz}{B_z(r)}\n$$\nThis equation can be rearranged to give the pitch of the helical field lines:\n$$\n\\frac{d\\theta}{dz} = \\frac{B_\\theta(r)}{r B_z(r)}\n$$\nThe safety factor, $q(r)$, is defined as the number of transits a field line makes in the toroidal direction (along $z$) for every single transit in the poloidal direction (along $\\theta$). We can find the distance $\\Delta z$ traversed along $z$ for one full poloidal rotation ($\\Delta\\theta = 2\\pi$) by integrating:\n$$\n\\Delta z = \\int_0^{2\\pi} \\frac{dz}{d\\theta} d\\theta = \\int_0^{2\\pi} \\frac{r B_z(r)}{B_\\theta(r)} d\\theta\n$$\nSince $B_\\theta$ and $B_z$ depend only on $r$, the integrand is constant with respect to $\\theta$:\n$$\n\\Delta z = \\frac{r B_z(r)}{B_\\theta(r)} \\int_0^{2\\pi} d\\theta = 2\\pi \\frac{r B_z(r)}{B_\\theta(r)}\n$$\nThis $\\Delta z$ is the pitch length of the helical field line. The safety factor $q(r)$ is this pitch length normalized by the system's periodicity length $L$:\n$$\nq(r) = \\frac{\\Delta z}{L} = \\frac{2\\pi r B_z(r)}{L B_\\theta(r)}\n$$\n\n**Part 2: General Form of the Magnetic Field Components**\n\nThe plasma is in a Taylor-relaxed state, satisfying the force-free equation $\\nabla \\times \\mathbf{B} = \\lambda \\mathbf{B}$ with uniform $\\lambda$. In cylindrical coordinates, for a field $\\mathbf{B}(r) = B_{\\theta}(r)\\,\\hat{\\mathbf{e}}_{\\theta} + B_{z}(r)\\,\\hat{\\mathbf{e}}_{z}$, the curl is:\n$$\n\\nabla \\times \\mathbf{B} = -\\frac{dB_z}{dr} \\hat{\\mathbf{e}}_\\theta + \\frac{1}{r} \\frac{d(r B_\\theta)}{dr} \\hat{\\mathbf{e}}_z\n$$\nSubstituting this into the force-free equation gives:\n$$\n-\\frac{dB_z}{dr} \\hat{\\mathbf{e}}_\\theta + \\frac{1}{r} \\frac{d(r B_\\theta)}{dr} \\hat{\\mathbf{e}}_z = \\lambda B_\\theta(r) \\hat{\\mathbf{e}}_\\theta + \\lambda B_z(r) \\hat{\\mathbf{e}}_z\n$$\nEquating the components yields a system of two coupled ordinary differential equations:\n1.  $\\frac{dB_z}{dr} = -\\lambda B_\\theta$\n2.  $\\frac{1}{r} \\frac{d(r B_\\theta)}{dr} = \\lambda B_z$\n\nTo solve this system, we can differentiate equation (1) with respect to $r$ and substitute $d(r B_\\theta)/dr$ from equation (2), but it is more direct to obtain a single equation for one component. Let us find an equation for $B_z$. From (1), we have $B_\\theta = -\\frac{1}{\\lambda} \\frac{dB_z}{dr}$. Substituting this into (2):\n$$\n\\frac{1}{r} \\frac{d}{dr}\\left(r \\left(-\\frac{1}{\\lambda}\\frac{dB_z}{dr}\\right)\\right) = \\lambda B_z\n$$\n$$\n-\\frac{1}{\\lambda r} \\left( \\frac{dB_z}{dr} + r \\frac{d^2B_z}{dr^2} \\right) = \\lambda B_z\n$$\n$$\n\\frac{d^2B_z}{dr^2} + \\frac{1}{r}\\frac{dB_z}{dr} + \\lambda^2 B_z = 0\n$$\nThis is Bessel's differential equation of order $0$. The general solution is $B_z(r) = C_1 J_0(\\lambda r) + C_2 Y_0(\\lambda r)$, where $J_0$ and $Y_0$ are the Bessel functions of the first and second kind, respectively, of order $0$.\nThe problem requires a solution that is regular at the axis $r=0$. The function $Y_0(\\lambda r)$ diverges as $r \\to 0$. Therefore, physical regularity demands that $C_2=0$. The solution for $B_z$ is thus:\n$$\nB_z(r) = B_0 J_0(\\lambda r)\n$$\nwhere $B_0$ is an arbitrary constant amplitude.\nNow we find $B_\\theta(r)$ using equation (1):\n$$\nB_\\theta(r) = -\\frac{1}{\\lambda} \\frac{d}{dr} [B_0 J_0(\\lambda r)] = -\\frac{B_0}{\\lambda} [J_0'(\\lambda r) \\cdot \\lambda] = -B_0 J_0'(\\lambda r)\n$$\nUsing the Bessel function identity $J_0'(x) = -J_1(x)$, we get:\n$$\nB_\\theta(r) = -B_0 [-J_1(\\lambda r)] = B_0 J_1(\\lambda r)\n$$\nThus, the magnetic field components for the lowest-energy Taylor-relaxed state are given by the Bessel Function Model (BFM):\n$$\nB_z(r) = B_0 J_0(\\lambda r) \\quad \\text{and} \\quad B_\\theta(r) = B_0 J_1(\\lambda r)\n$$\n\n**Part 3: Explicit Expression for $q(r)$**\n\nWe combine the results from Part 1 and Part 2 by substituting the expressions for $B_\\theta(r)$ and $B_z(r)$ into the formula for $q(r)$:\n$$\nq(r) = \\frac{2\\pi r}{L} \\frac{B_z(r)}{B_\\theta(r)} = \\frac{2\\pi r}{L} \\frac{B_0 J_0(\\lambda r)}{B_0 J_1(\\lambda r)}\n$$\nThe amplitude $B_0$ cancels, yielding the explicit expression for the safety factor profile:\n$$\nq(r) = \\frac{2\\pi r}{L} \\frac{J_0(\\lambda r)}{J_1(\\lambda r)}\n$$\n\n**Part 4: Numerical Evaluation and Stability Assessment**\n\nWe are asked to evaluate the edge safety factor, $q_{\\mathrm{edge}} = q(a)$, for the given parameters:\n$a = 0.25\\,\\mathrm{m}$, $L = 1.2\\,\\mathrm{m}$, and $\\lambda = 6.0\\,\\mathrm{m}^{-1}$.\nFirst, calculate the argument of the Bessel functions, $\\lambda a$:\n$$\n\\lambda a = (6.0\\,\\mathrm{m}^{-1})(0.25\\,\\mathrm{m}) = 1.5\n$$\nThe expression for $q_{\\mathrm{edge}}$ is:\n$$\nq_{\\mathrm{edge}} = q(a) = \\frac{2\\pi a}{L} \\frac{J_0(\\lambda a)}{J_1(\\lambda a)} = \\frac{2\\pi(0.25)}{1.2} \\frac{J_0(1.5)}{J_1(1.5)}\n$$\nUsing standard mathematical libraries for the values of the Bessel functions:\n$$\nJ_0(1.5) \\approx 0.51182765\n$$\n$$\nJ_1(1.5) \\approx 0.55793651\n$$\nNow, we compute the value of $q_{\\mathrm{edge}}$:\n$$\nq_{\\mathrm{edge}} = \\frac{0.5\\pi}{1.2} \\frac{0.51182765}{0.55793651} \\approx \\left(1.3089969\\right) \\times \\left(0.9173595\\right) \\approx 1.2007851\n$$\nRounding this result to four significant figures gives:\n$$\nq_{\\mathrm{edge}} \\approx 1.201\n$$\nThe Kruskal-Shafranov stability criterion for the ideal external kink mode requires $q_{\\mathrm{edge}}  1$. Since our calculated value is $q_{\\mathrm{edge}} \\approx 1.201$, we have $1.201  1$. Therefore, the configuration satisfies this fundamental stability condition.", "answer": "$$\n\\boxed{1.201}\n$$", "id": "3719246"}, {"introduction": "While MHD provides a powerful fluid description of plasma behavior, understanding particle transport and confinement often requires a kinetic approach that considers the motion of individual particles. This is particularly true for Field-Reversed Configurations (FRCs), which are characterized by high plasma beta and ion gyroradii that can be comparable to the system size. This exercise shifts focus from fluid stability to kinetic losses by modeling a critical transport mechanism in FRCs: the loss of ions on orbits large enough to intersect the separatrix. By integrating over a Maxwellian velocity distribution, you will calculate the fraction of ions on these \"open\" orbits and determine the resulting particle loss rate, providing crucial insight into the confinement properties of FRCs [@problem_id:3719203].", "problem": "Consider an axisymmetric Field-Reversed Configuration (FRC) at its midplane, where closed magnetic flux surfaces are bounded by a separatrix at cylindrical radius $R_{s}$. Focus on a thin annulus inside the separatrix at radius $r_{0} = R_{s} - \\Delta$, with $0  \\Delta \\ll R_{s}$. Assume the magnetic field magnitude at $r_{0}$ is $B_{0}$, the ion species has charge $q  0$ and mass $m_{i}$, and the ion velocity distribution at $r_{0}$ is an isotropic Maxwell–Boltzmann distribution with temperature $T_{i}$ and number density $n_{0}$. The ion gyrofrequency is defined as $\\Omega_{i} = q B_{0}/m_{i}$, and the ion Larmor radius is defined as $\\rho_{i} = v_{\\perp}/\\Omega_{i}$, where $v_{\\perp}$ is the speed perpendicular to the local magnetic field.\n\nAssume that a guiding-center located at $r_{0}$ is on an open orbit that intersects the separatrix if and only if $\\rho_{i}  \\Delta$. Take the local three-dimensional ion velocity distribution to be\n$$\nf(\\mathbf{v}) = n_{0} \\left( \\frac{m_{i}}{2 \\pi k_{B} T_{i}} \\right)^{3/2} \\exp\\!\\left( - \\frac{m_{i}}{2 k_{B} T_{i}} \\left( v_{\\parallel}^{2} + v_{\\perp}^{2} \\right) \\right),\n$$\nwith $k_{B}$ the Boltzmann constant and $v_{\\parallel}$ the parallel speed relative to the local magnetic field.\n\nTask 1. Using only the stated definitions and distribution, derive a closed-form analytic expression for the fraction $F_{\\text{open}}$ of ions at $r_{0}$ whose cyclotron orbits intersect the separatrix, i.e., the fraction with $v_{\\perp}  \\Omega_{i} \\Delta$.\n\nTask 2. Adopt the following loss model: any ion satisfying $\\rho_{i}  \\Delta$ is promptly lost upon first separatrix intersection within one ion gyroperiod, and any ion with $\\rho_{i} \\le \\Delta$ remains confined indefinitely. Under this model, define the local volumetric particle loss rate coefficient $\\nu_{\\text{loss}}$ by the relation $\\mathrm{d} n/\\mathrm{d} t = - \\nu_{\\text{loss}} n$ at $r_{0}$. Compute $\\nu_{\\text{loss}}$ in closed form in terms of $q$, $m_{i}$, $B_{0}$, $\\Delta$, $k_{B}$, and $T_{i}$.\n\nAnswer specification:\n- Report $F_{\\text{open}}$ as a dimensionless analytic expression.\n- Report $\\nu_{\\text{loss}}$ as an analytic expression and interpret it in units of $\\mathrm{s}^{-1}$.\n- Provide your final result as a two-entry row matrix $\\bigl[F_{\\text{open}},\\,\\nu_{\\text{loss}}\\bigr]$ in closed form. No numerical evaluation or rounding is required.", "solution": "The problem has been validated and is deemed scientifically grounded, well-posed, objective, and self-contained. The solution process proceeds as follows.\n\n**Part 1: Calculation of the open orbit fraction $F_{\\text{open}}$**\n\nThe fraction of ions at radius $r_{0}$ whose orbits are open, $F_{\\text{open}}$, is defined as the fraction of the ion population with a Larmor radius $\\rho_{i}$ greater than the distance to the separatrix, $\\Delta$. The condition is given as $\\rho_{i}  \\Delta$.\n\nUsing the definitions provided for the Larmor radius, $\\rho_{i} = v_{\\perp}/\\Omega_{i}$, and the ion gyrofrequency, $\\Omega_{i} = q B_{0}/m_{i}$, this condition can be expressed in terms of the ion's perpendicular speed, $v_{\\perp}$:\n$$\n\\frac{v_{\\perp}}{\\Omega_{i}}  \\Delta \\implies v_{\\perp}  \\Omega_{i} \\Delta\n$$\nWe must therefore calculate the fraction of ions in the given velocity distribution that satisfy $v_{\\perp}  \\Omega_{i} \\Delta$.\n\nThe ion velocity distribution function is given as:\n$$\nf(\\mathbf{v}) = n_{0} \\left( \\frac{m_{i}}{2 \\pi k_{B} T_{i}} \\right)^{3/2} \\exp\\!\\left( - \\frac{m_{i}}{2 k_{B} T_{i}} \\left( v_{\\parallel}^{2} + v_{\\perp}^{2} \\right) \\right)\n$$\nThe fraction $F_{\\text{open}}$ is the integral of the normalized distribution function, $f(\\mathbf{v})/n_{0}$, over the region of velocity space where the condition is met. We can express the velocity vector $\\mathbf{v}$ in cylindrical coordinates $(v_{\\perp}, \\phi_{v}, v_{\\parallel})$, where $v_{\\perp}$ is the speed perpendicular to the magnetic field, $v_{\\parallel}$ is the speed parallel to the field, and $\\phi_{v}$ is the gyrophase angle. The volume element in velocity space is $d^{3}v = v_{\\perp} dv_{\\perp} d\\phi_{v} dv_{\\parallel}$.\n\nThe fraction $F_{\\text{open}}$ is given by:\n$$\nF_{\\text{open}} = \\frac{1}{n_{0}} \\int_{\\text{loss region}} f(\\mathbf{v}) \\, d^{3}v\n$$\n$$\nF_{\\text{open}} = \\left( \\frac{m_{i}}{2 \\pi k_{B} T_{i}} \\right)^{3/2} \\int_{-\\infty}^{\\infty} \\exp\\!\\left( - \\frac{m_{i} v_{\\parallel}^{2}}{2 k_{B} T_{i}} \\right) dv_{\\parallel} \\int_{0}^{2\\pi} d\\phi_{v} \\int_{\\Omega_{i} \\Delta}^{\\infty} v_{\\perp} \\exp\\!\\left( - \\frac{m_{i} v_{\\perp}^{2}}{2 k_{B} T_{i}} \\right) dv_{\\perp}\n$$\n\nThe integral over $v_{\\parallel}$ is a standard Gaussian integral:\n$$\n\\int_{-\\infty}^{\\infty} \\exp\\!\\left( - \\frac{m_{i} v_{\\parallel}^{2}}{2 k_{B} T_{i}} \\right) dv_{\\parallel} = \\sqrt{\\frac{2 \\pi k_{B} T_{i}}{m_{i}}}\n$$\nThe integral over the angle $\\phi_{v}$ is:\n$$\n\\int_{0}^{2\\pi} d\\phi_{v} = 2\\pi\n$$\nThe integral over $v_{\\perp}$ can be solved by a change of variables. Let $u = \\frac{m_{i} v_{\\perp}^{2}}{2 k_{B} T_{i}}$. Then $du = \\frac{m_{i} v_{\\perp}}{k_{B} T_{i}} dv_{\\perp}$, which means $v_{\\perp} dv_{\\perp} = \\frac{k_{B} T_{i}}{m_{i}} du$. The lower limit of integration for $v_{\\perp}$ is $\\Omega_{i} \\Delta$, so the lower limit for $u$ is $\\frac{m_{i}(\\Omega_{i}\\Delta)^{2}}{2 k_{B} T_{i}}$.\n$$\n\\int_{\\Omega_{i} \\Delta}^{\\infty} v_{\\perp} \\exp\\!\\left( - \\frac{m_{i} v_{\\perp}^{2}}{2 k_{B} T_{i}} \\right) dv_{\\perp} = \\frac{k_{B} T_{i}}{m_{i}} \\int_{\\frac{m_{i}(\\Omega_{i}\\Delta)^{2}}{2 k_{B} T_{i}}}^{\\infty} \\exp(-u) \\, du\n$$\n$$\n= \\frac{k_{B} T_{i}}{m_{i}} \\left[ -\\exp(-u) \\right]_{\\frac{m_{i}(\\Omega_{i}\\Delta)^{2}}{2 k_{B} T_{i}}}^{\\infty} = \\frac{k_{B} T_{i}}{m_{i}} \\exp\\!\\left( - \\frac{m_{i}(\\Omega_{i}\\Delta)^{2}}{2 k_{B} T_{i}} \\right)\n$$\n\nCombining all the parts:\n$$\nF_{\\text{open}} = \\left( \\frac{m_{i}}{2 \\pi k_{B} T_{i}} \\right)^{3/2} \\left( \\sqrt{\\frac{2 \\pi k_{B} T_{i}}{m_{i}}} \\right) (2\\pi) \\left( \\frac{k_{B} T_{i}}{m_{i}} \\exp\\!\\left( - \\frac{m_{i}(\\Omega_{i}\\Delta)^{2}}{2 k_{B} T_{i}} \\right) \\right)\n$$\nThe normalization prefactors cancel out:\n$$\n\\left( \\frac{m_{i}}{2 \\pi k_{B} T_{i}} \\right)^{3/2} \\sqrt{\\frac{2 \\pi k_{B} T_{i}}{m_{i}}} (2\\pi) \\frac{k_{B} T_{i}}{m_{i}} = \\frac{m_{i}^{3/2}}{(2\\pi)^{3/2}(k_{B}T_{i})^{3/2}} \\frac{(2\\pi)^{1/2}(k_{B}T_{i})^{1/2}}{m_{i}^{1/2}} (2\\pi)^{1} \\frac{k_{B}T_{i}}{m_{i}} = 1\n$$\nThus, the fraction of ions on open orbits is:\n$$\nF_{\\text{open}} = \\exp\\!\\left( - \\frac{m_{i}(\\Omega_{i}\\Delta)^{2}}{2 k_{B} T_{i}} \\right)\n$$\nSubstituting $\\Omega_{i} = q B_{0} / m_{i}$:\n$$\nF_{\\text{open}} = \\exp\\!\\left( - \\frac{m_{i}}{2 k_{B} T_{i}} \\left( \\frac{q B_{0} \\Delta}{m_{i}} \\right)^{2} \\right) = \\exp\\!\\left( - \\frac{q^{2} B_{0}^{2} \\Delta^{2}}{2 m_{i} k_{B} T_{i}} \\right)\n$$\n\n**Part 2: Calculation of the loss rate coefficient $\\nu_{\\text{loss}}$**\n\nThe problem defines a loss model where any ion on an open orbit ($\\rho_{i}  \\Delta$) is lost within one ion gyroperiod. The volumetric particle loss rate coefficient $\\nu_{\\text{loss}}$ is defined by the relation $\\mathrm{d}n/\\mathrm{d}t = - \\nu_{\\text{loss}} n$.\n\nThe density of ions susceptible to loss is the total density $n$ multiplied by the fraction of ions on open orbits, $n_{\\text{loss}} = n F_{\\text{open}}$.\nThe loss model states that these particles are lost \"within one ion gyroperiod\". This implies that the characteristic time scale for the loss of this sub-population is the ion gyroperiod, $T_{\\text{gyro}} = 2\\pi / \\Omega_{i}$. The frequency of gyration is $f_{\\text{gyro}} = 1/T_{\\text{gyro}} = \\Omega_{i} / (2\\pi)$.\n\nWe model the rate of change of density as the density of particles in the loss region divided by the characteristic loss time:\n$$\n\\frac{dn}{dt} = - \\frac{n_{\\text{loss}}}{T_{\\text{gyro}}} = - \\frac{n F_{\\text{open}}}{2\\pi/\\Omega_{i}} = -n \\left( \\frac{\\Omega_{i} F_{\\text{open}}}{2\\pi} \\right)\n$$\nBy comparing this with the defining relation $\\mathrm{d}n/\\mathrm{d}t = - \\nu_{\\text{loss}} n$, we identify the loss rate coefficient:\n$$\n\\nu_{\\text{loss}} = \\frac{\\Omega_{i} F_{\\text{open}}}{2\\pi}\n$$\nThis expression has units of frequency ($s^{-1}$), as required for a rate coefficient.\n\nSubstituting the expressions for $\\Omega_{i}$ and $F_{\\text{open}}$:\n$$\n\\nu_{\\text{loss}} = \\frac{1}{2\\pi} \\left( \\frac{q B_{0}}{m_{i}} \\right) \\exp\\!\\left( - \\frac{q^{2} B_{0}^{2} \\Delta^{2}}{2 m_{i} k_{B} T_{i}} \\right)\n$$\n\nThe final expressions for $F_{\\text{open}}$ and $\\nu_{\\text{loss}}$ are:\n$$\nF_{\\text{open}} = \\exp\\!\\left(-\\frac{q^{2} B_{0}^{2} \\Delta^{2}}{2 m_{i} k_{B} T_{i}}\\right)\n$$\n$$\n\\nu_{\\text{loss}} = \\frac{q B_{0}}{2\\pi m_{i}} \\exp\\!\\left(-\\frac{q^{2} B_{0}^{2} \\Delta^{2}}{2 m_{i} k_{B} T_{i}}\\right)\n$$\nThese results are to be reported as a two-entry row matrix.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\exp\\!\\left(-\\frac{q^{2} B_{0}^{2} \\Delta^{2}}{2 m_{i} k_{B} T_{i}}\\right)  \\frac{q B_{0}}{2\\pi m_{i}} \\exp\\!\\left(-\\frac{q^{2} B_{0}^{2} \\Delta^{2}}{2 m_{i} k_{B} T_{i}}\\right)\n\\end{pmatrix}\n}\n$$", "id": "3719203"}, {"introduction": "Bridging the gap between theoretical concepts and experimental measurement is a vital skill in plasma physics. Magnetic helicity, $K=\\int \\mathbf{A}\\cdot\\mathbf{B}\\,dV$, is a quantity of profound theoretical importance for understanding plasma relaxation and self-organization, yet it is not directly measurable. This computational practice challenges you to tackle the real-world problem of reconstructing the vector potential $\\mathbf{A}$ and computing the total helicity from a discrete set of magnetic field measurements, mimicking data from a probe array. By implementing a solution in Fourier space and assessing the numerical uncertainty, you will gain hands-on experience with the powerful spectral methods used in plasma data analysis and develop an intuition for how theoretical quantities are inferred from experimental data [@problem_id:3719180].", "problem": "You are given a synthetic data-generation and reconstruction task motivated by magnetic confinement in self-organized plasmas such as spheromaks and Field-Reversed Configurations (FRC). The quantity of interest is the magnetic helicity, defined as $K=\\int \\mathbf{A}\\cdot\\mathbf{B}\\,dV$, where $\\mathbf{B}$ is the magnetic field and $\\mathbf{A}$ is a vector potential satisfying the Coulomb gauge condition $\\nabla\\cdot\\mathbf{A}=0$ and the relation $\\mathbf{B}=\\nabla\\times\\mathbf{A}$. Starting only from fundamental electromagnetic laws and core vector calculus identities, implement a Coulomb gauge reconstruction of $\\mathbf{A}$ from discrete measurements of $\\mathbf{B}$ on a three-dimensional periodic grid, and then compute the magnetic helicity $K$. Estimate the uncertainty arising from probe spacing by comparing helicity computed on a base grid to helicity computed on a refined grid with doubled resolution in each direction.\n\nFundamental base to be used:\n- Maxwell’s equations in magnetostatics imply $\\nabla\\cdot\\mathbf{B}=0$.\n- A vector potential $\\mathbf{A}$ exists such that $\\mathbf{B}=\\nabla\\times\\mathbf{A}$.\n- Coulomb gauge is defined by $\\nabla\\cdot\\mathbf{A}=0$.\n- Use vector calculus identities consistent with these laws.\n\nSynthetic magnetic probe data are defined on a periodic cubic domain of side length $L=1\\,\\mathrm{m}$ using an analytically divergence-free Beltrami-type magnetic field constructed as a superposition of two Arnold–Beltrami–Childress (ABC) components with equal amplitude across axes. For each component with amplitude $S_i$ (in Tesla) and integer mode number $n_i$, the wave number is $k_i=2\\pi n_i/L$ (in radians per meter), and the contribution to the field is:\n$$\nB_x^{(i)}(x,y,z)=S_i\\left[\\sin(k_i z)+\\cos(k_i y)\\right],\\quad\nB_y^{(i)}(x,y,z)=S_i\\left[\\sin(k_i x)+\\cos(k_i z)\\right],\\quad\nB_z^{(i)}(x,y,z)=S_i\\left[\\sin(k_i y)+\\cos(k_i x)\\right],\n$$\nwith angles in radians. The total $\\mathbf{B}$ is the sum over components $i$.\n\nYour program must:\n1. Generate $\\mathbf{B}$ on the base grid specified in the test suite below (all grids have periodic boundary conditions and domain length $L=1\\,\\mathrm{m}$).\n2. Reconstruct $\\mathbf{A}$ in Coulomb gauge from the discrete $\\mathbf{B}$ on the base grid using a method consistent with the stated fundamental base and periodic boundaries.\n3. Compute the magnetic helicity $K=\\int \\mathbf{A}\\cdot\\mathbf{B}\\,dV$ numerically using the discrete sum over the grid with voxel volume $\\Delta V$.\n4. Independently, generate $\\mathbf{B}$ on a refined grid that doubles each base resolution, repeat the reconstruction and helicity computation, and use the absolute difference between refined and base helicities as an uncertainty estimate due to probe spacing.\n5. Express all helicities and uncertainties in Weber-squared ($\\mathrm{Wb}^2$) as floats rounded to exactly six decimal places.\n\nTest suite:\n- Case 1: Single component with $S_1=0.6\\,\\mathrm{T}$, $n_1=1$, base grid $(N_x,N_y,N_z)=(32, 32, 32)$, refined grid $(64, 64, 64)$.\n- Case 2: Single component with $S_1=0.6\\,\\mathrm{T}$, $n_1=5$, base grid $(16, 16, 16)$, refined grid $(32, 32, 32)$.\n- Case 3: Two components with $(S_1,n_1)=(0.5\\,\\mathrm{T}, 1)$ and $(S_2,n_2)=(0.15\\,\\mathrm{T}, 17)$, base grid $(16, 16, 16)$, refined grid $(32, 32, 32)$.\n- Case 4: Two components with $(S_1,n_1)=(0.4\\,\\mathrm{T}, 3)$ and $(S_2,n_2)=(0.25\\,\\mathrm{T}, 7)$, base grid $(24, 24, 24)$, refined grid $(48, 48, 48)$.\n- Case 5: Two components with $(S_1,n_1)=(0.5\\,\\mathrm{T}, 2)$ and $(S_2,n_2)=(0.15\\,\\mathrm{T}, 9)$, base grid $(12, 24, 18)$, refined grid $(24, 48, 36)$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of pairs, with each pair itself a comma-separated list of the base-grid helicity and the uncertainty estimate, enclosed in square brackets. For example, the required format is $[[K_1,U_1],[K_2,U_2],\\dots]$ with no spaces. All values must be in $\\mathrm{Wb}^2$, rounded to six decimal places.", "solution": "The problem is valid as it is scientifically grounded in magnetohydrodynamics, well-posed, and provides a complete and objective set of specifications for a numerical task. The core of the problem is to reconstruct the magnetic vector potential $\\mathbf{A}$ from a given magnetic field $\\mathbf{B}$ and then compute the magnetic helicity $K = \\int \\mathbf{A} \\cdot \\mathbf{B} \\, dV$.\n\nThe reconstruction is governed by two fundamental relations: the definition of the vector potential, $\\mathbf{B} = \\nabla \\times \\mathbf{A}$, and the Coulomb gauge condition, $\\nabla \\cdot \\mathbf{A} = 0$. To derive a solvable equation for $\\mathbf{A}$, we take the curl of the first relation:\n$$ \\nabla \\times \\mathbf{B} = \\nabla \\times (\\nabla \\times \\mathbf{A}) $$\nUsing the vector calculus identity $\\nabla \\times (\\nabla \\times \\mathbf{F}) = \\nabla(\\nabla \\cdot \\mathbf{F}) - \\nabla^2 \\mathbf{F}$, and applying the Coulomb gauge condition $\\nabla \\cdot \\mathbf{A} = 0$, we obtain the vector Poisson equation for $\\mathbf{A}$:\n$$ \\nabla^2 \\mathbf{A} = -\\nabla \\times \\mathbf{B} $$\nThis is a set of three scalar Poisson equations, one for each component of $\\mathbf{A}$. Given that the problem specifies a periodic domain, the most efficient method for solving this equation is the Fourier spectral method. Let $\\hat{f}(\\mathbf{k}) = \\mathcal{F}[f(\\mathbf{x})]$ denote the three-dimensional Fourier transform. The differential operators transform into algebraic multiplications based on the wavevector $\\mathbf{k} = (k_x, k_y, k_z)$:\n$$ \\mathcal{F}[\\nabla^2 \\mathbf{A}] = -|\\mathbf{k}|^2 \\hat{\\mathbf{A}}(\\mathbf{k}) $$\n$$ \\mathcal{F}[-\\nabla \\times \\mathbf{B}] = -i\\mathbf{k} \\times \\hat{\\mathbf{B}}(\\mathbf{k}) $$\nwhere $|\\mathbf{k}|^2 = k_x^2 + k_y^2 + k_z^2$. Equating the transformed expressions yields an algebraic equation for the Fourier coefficients of the vector potential, $\\hat{\\mathbf{A}}(\\mathbf{k})$:\n$$ -|\\mathbf{k}|^2 \\hat{\\mathbf{A}}(\\mathbf{k}) = -i\\mathbf{k} \\times \\hat{\\mathbf{B}}(\\mathbf{k}) $$\nSolving for $\\hat{\\mathbf{A}}(\\mathbf{k})$ for non-zero wavevectors ($\\mathbf{k} \\neq \\mathbf{0}$) gives:\n$$ \\hat{\\mathbf{A}}(\\mathbf{k}) = \\frac{i\\mathbf{k} \\times \\hat{\\mathbf{B}}(\\mathbf{k})}{|\\mathbf{k}|^2} $$\nFor the mean-field component, $\\mathbf{k} = \\mathbf{0}$, the denominator $|\\mathbf{k}|^2$ is zero. This corresponds to the spatially constant part of $\\mathbf{A}$, which represents a gauge freedom. The magnetic helicity $K$ is invariant under the addition of a constant vector to $\\mathbf{A}$ if the net magnetic flux through the domain boundary is zero. For a periodic field, this condition is equivalent to the mean magnetic field being zero, i.e., $\\int_V \\mathbf{B} dV = \\mathbf{0}$, which implies $\\hat{\\mathbf{B}}(\\mathbf{k}=\\mathbf{0}) = \\mathbf{0}$. The specified analytical form of $\\mathbf{B}$ consists of sines and cosines with integer mode numbers, ensuring its spatial average over the periodic domain is zero. Consequently, we can set $\\hat{\\mathbf{A}}(\\mathbf{k}=\\mathbf{0})=\\mathbf{0}$ without loss of generality for the helicity calculation.\n\nThe numerical algorithm proceeds as follows:\n1.  **Discretization**: A uniform Cartesian grid of size $(N_x, N_y, N_z)$ is defined over the cubic domain of side length $L=1\\,\\mathrm{m}$. The synthetic magnetic field $\\mathbf{B}$ is sampled at each grid point using the provided analytical formula.\n2.  **Forward Transform**: The discrete magnetic field components $(B_x, B_y, B_z)$ are transformed to Fourier space using a 3D Fast Fourier Transform (FFT) to obtain $(\\hat{B}_x, \\hat{B}_y, \\hat{B}_z)$.\n3.  **Solve for $\\hat{\\mathbf{A}}$**: The Fourier coefficients of the vector potential, $(\\hat{A}_x, \\hat{A}_y, \\hat{A}_z)$, are computed algebraically for each discrete wavevector $\\mathbf{k}$, handling the special case at $\\mathbf{k}=\\mathbf{0}$. The discrete wavevectors are determined by the grid dimensions and spacing.\n4.  **Inverse Transform**: The real-space vector potential $\\mathbf{A}$ is recovered by applying a 3D inverse FFT to $(\\hat{A}_x, \\hat{A}_y, \\hat{A}_z)$. The resulting field is guaranteed to be real-valued, so any residual imaginary part from numerical errors is discarded.\n5.  **Helicity Computation**: The magnetic helicity $K$ is computed by numerically approximating the volume integral as a sum over all grid voxels:\n$$ K \\approx \\sum_{i,j,k} (\\mathbf{A}_{ijk} \\cdot \\mathbf{B}_{ijk}) \\Delta V $$\nwhere $\\Delta V = (L/N_x)(L/N_y)(L/N_z)$ is the volume of a grid cell.\n6.  **Uncertainty Estimation**: The entire procedure is performed once for a base grid and again for a refined grid (with doubled resolution in each dimension). The absolute difference between the two computed helicity values, $|K_{refined} - K_{base}|$, serves as an estimate of the numerical error due to grid discretization (probe spacing).\n\nIt is noteworthy that in certain test cases (e.g., Case 3 and Case 5), the specified base grid resolution $N$ is insufficient to represent the highest mode number $n$ in the analytic field without aliasing, as it violates the Nyquist sampling criterion ($N > 2n$). This is a deliberate feature of the problem design, testing the algorithm's direct application to provided discrete data and demonstrating how inadequate sampling manifests as a large discretization error, which will be appropriately captured by the prescribed uncertainty metric.", "answer": "```python\nimport numpy as np\n\ndef compute_helicity(components, grid_res, domain_length):\n    \"\"\"\n    Computes magnetic helicity on a discrete periodic grid.\n\n    Args:\n        components (tuple): A tuple of tuples, where each inner tuple is (S, n)\n                            representing the amplitude and mode number of an ABC component.\n        grid_res (tuple): A tuple (Nx, Ny, Nz) specifying the grid resolution.\n        domain_length (float): The side length of the periodic cubic domain.\n\n    Returns:\n        float: The computed magnetic helicity in Wb^2.\n    \"\"\"\n    Nx, Ny, Nz = grid_res\n    L = domain_length\n\n    # 1. Grid Setup\n    dx, dy, dz = L / Nx, L / Ny, L / Nz\n    dV = dx * dy * dz\n    \n    x = np.linspace(0, L, Nx, endpoint=False)\n    y = np.linspace(0, L, Ny, endpoint=False)\n    z = np.linspace(0, L, Nz, endpoint=False)\n    \n    # Use 'ij' indexing to match the FFT frequency layout\n    xx, yy, zz = np.meshgrid(x, y, z, indexing='ij')\n\n    # 2. Generate B-field\n    Bx = np.zeros_like(xx)\n    By = np.zeros_like(xx)\n    Bz = np.zeros_like(xx)\n\n    for S_i, n_i in components:\n        k_i = 2 * np.pi * n_i / L\n        Bx += S_i * (np.sin(k_i * zz) + np.cos(k_i * yy))\n        By += S_i * (np.sin(k_i * xx) + np.cos(k_i * zz))\n        Bz += S_i * (np.sin(k_i * yy) + np.cos(k_i * xx))\n\n    # 3. FFT of B-field\n    Bhx = np.fft.fftn(Bx)\n    Bhy = np.fft.fftn(By)\n    Bhz = np.fft.fftn(Bz)\n\n    # 4. Wavenumber Grids\n    kx = 2 * np.pi * np.fft.fftfreq(Nx, d=dx)\n    ky = 2 * np.pi * np.fft.fftfreq(Ny, d=dy)\n    kz = 2 * np.pi * np.fft.fftfreq(Nz, d=dz)\n    Kx, Ky, Kz = np.meshgrid(kx, ky, kz, indexing='ij')\n    \n    K_squared = Kx**2 + Ky**2 + Kz**2\n    \n    # Avoid division by zero at k=0. The corresponding amplitude will be zeroed out later.\n    K_squared[0, 0, 0] = 1.0\n\n    # 5. Calculate A-field in Fourier Space\n    Ahx = 1j * (Ky * Bhz - Kz * Bhy) / K_squared\n    Ahy = 1j * (Kz * Bhx - Kx * Bhz) / K_squared\n    Ahz = 1j * (Kx * Bhy - Ky * Bhx) / K_squared\n\n    # Explicitly set the k=0 (DC) component to zero\n    Ahx[0, 0, 0] = 0.0\n    Ahy[0, 0, 0] = 0.0\n    Ahz[0, 0, 0] = 0.0\n\n    # 6. Inverse FFT to get A-field\n    # numpy's ifftn includes the 1/N scaling factor.\n    # The result must be real; imaginary part is numerical error.\n    Ax = np.fft.ifftn(Ahx).real\n    Ay = np.fft.ifftn(Ahy).real\n    Az = np.fft.ifftn(Ahz).real\n\n    # 7. Calculate Helicity\n    integrand = Ax * Bx + Ay * By + Az * Bz\n    helicity = np.sum(integrand) * dV\n\n    return helicity\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    domain_length = 1.0\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Single component, S1=0.6, n1=1, base grid (32,32,32)\n        {'components': ((0.6, 1),), 'base_grid': (32, 32, 32), 'refined_grid': (64, 64, 64)},\n        # Case 2: Single component, S1=0.6, n1=5, base grid (16,16,16)\n        {'components': ((0.6, 5),), 'base_grid': (16, 16, 16), 'refined_grid': (32, 32, 32)},\n        # Case 3: Two components, (S1,n1)=(0.5,1), (S2,n2)=(0.15,17), base grid (16,16,16)\n        {'components': ((0.5, 1), (0.15, 17)), 'base_grid': (16, 16, 16), 'refined_grid': (32, 32, 32)},\n        # Case 4: Two components, (S1,n1)=(0.4,3), (S2,n2)=(0.25,7), base grid (24,24,24)\n        {'components': ((0.4, 3), (0.25, 7)), 'base_grid': (24, 24, 24), 'refined_grid': (48, 48, 48)},\n        # Case 5: Two components, (S1,n1)=(0.5,2), (S2,n2)=(0.15,9), base grid (12,24,18)\n        {'components': ((0.5, 2), (0.15, 9)), 'base_grid': (12, 24, 18), 'refined_grid': (24, 48, 36)},\n    ]\n\n    results = []\n    for case in test_cases:\n        components = case['components']\n        base_grid = case['base_grid']\n        refined_grid = case['refined_grid']\n\n        # Calculate helicity for base and refined grids\n        K_base = compute_helicity(components, base_grid, domain_length)\n        K_refined = compute_helicity(components, refined_grid, domain_length)\n\n        # Calculate uncertainty estimate\n        uncertainty = abs(K_refined - K_base)\n        \n        # Format the result pair to exactly six decimal places\n        results.append(f\"[{K_base:.6f},{uncertainty:.6f}]\")\n\n    # Final print statement in the exact required format\n    print(f\"[[{','.join(results)}]]\")\n\nsolve()\n```", "id": "3719180"}]}