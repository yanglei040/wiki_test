{"hands_on_practices": [{"introduction": "This first exercise grounds our understanding in the fundamental principle of magnetic mirroring. By applying the conservation of energy $E$ and the magnetic moment $\\mu$, you will derive the precise locations where a particle's parallel motion is halted and reversed in a simple, symmetric magnetic field. This calculation of the reflection points is the bedrock for all discussions of trapped particle dynamics and provides a concrete mathematical basis for how magnetic confinement works. [@problem_id:3723893]", "problem": "A collisionless charged particle of mass $m$ and charge $q$ executes guiding-center motion along a single magnetic field line in a static, one-dimensional magnetic mirror configuration relevant to nuclear fusion confinement. The magnetic field magnitude along the arc-length coordinate $s$ is given by $B(s) = B_0 \\left( 1 + \\alpha s^2 \\right)$, where $B_0  0$ is the field minimum at $s = 0$ and $\\alpha  0$ sets the curvature of the mirror.\n\nAssume:\n- The evolution is sufficiently slow and the magnetic field varies smoothly on the scale of the particle gyroradius so that the first adiabatic invariant (magnetic moment) $\\mu$ is conserved.\n- There are no electric fields and the total kinetic energy $E$ is conserved.\n- The particle remains close to the given field line so that the guiding-center description applies.\n\nStarting only from the conservation of total kinetic energy and the constancy of the first adiabatic invariant, derive the condition that determines the reflection (turning) points along $s$ where the parallel component of the velocity vanishes. Then, for the specified profile $B(s)$, solve for the two symmetric reflection points $s_1$ and $s_2$ explicitly in terms of $E$, $\\mu$, $B_0$, and $\\alpha$. State the condition on $E$ and $\\mu$ under which these reflection points exist as real values. Express your final answer for $s_1$ and $s_2$ as a closed-form analytic expression. No numerical evaluation is required.", "solution": "The problem requires us to determine the reflection points of a charged particle in a magnetic mirror. The solution is based on two fundamental conservation laws: the conservation of total kinetic energy, $E$, and the conservation of the first adiabatic invariant (magnetic moment), $\\mu$.\n\nThe total kinetic energy $E$ of the particle is the sum of its kinetic energy parallel to the magnetic field, $E_{k, \\parallel}$, and its kinetic energy perpendicular to the magnetic field, $E_{k, \\perp}$.\n$$E = E_{k, \\parallel} + E_{k, \\perp}$$\nThese components are given by $E_{k, \\parallel} = \\frac{1}{2} m v_{\\parallel}^2$ and $E_{k, \\perp} = \\frac{1}{2} m v_{\\perp}^2$, where $m$ is the particle's mass, and $v_{\\parallel}$ and $v_{\\perp}$ are the components of its velocity parallel and perpendicular to the magnetic field line, respectively.\n\nThe first adiabatic invariant, $\\mu$, is defined as the ratio of the perpendicular kinetic energy to the magnetic field magnitude, $B(s)$. Since $\\mu$ is conserved, we have:\n$$\\mu = \\frac{E_{k, \\perp}}{B(s)} = \\frac{\\frac{1}{2} m v_{\\perp}^2}{B(s)} = \\text{constant}$$\nFrom this relationship, we can express the perpendicular kinetic energy at any point $s$ along the field line as:\n$$E_{k, \\perp}(s) = \\mu B(s)$$\nSubstituting this into the equation for total energy conservation gives:\n$$E = \\frac{1}{2} m v_{\\parallel}^2 + \\mu B(s)$$\nThis equation describes the partitioning of energy between parallel and perpendicular motion as the particle moves along the field line. We can rearrange it to solve for the parallel velocity component:\n$$v_{\\parallel}^2(s) = \\frac{2}{m} \\left( E - \\mu B(s) \\right)$$\nA reflection (or turning) point, which we will denote as $s_{\\text{turn}}$, is a location where the particle's parallel motion ceases and reverses direction. Mathematically, this corresponds to the point where the parallel velocity vanishes, i.e., $v_{\\parallel} = 0$.\nSetting $v_{\\parallel}(s_{\\text{turn}}) = 0$ in the equation above yields the general condition for the turning points:\n$$0 = \\frac{2}{m} \\left( E - \\mu B(s_{\\text{turn}}) \\right)$$\n$$E = \\mu B(s_{\\text{turn}})$$\nThis equation states that a particle is reflected at the point $s_{\\text{turn}}$ where the local magnetic field $B(s_{\\text{turn}})$ becomes strong enough to account for the particle's entire kinetic energy $E$, given its magnetic moment $\\mu$.\n\nNow, we apply this general condition to the specific magnetic field profile given in the problem:\n$$B(s) = B_0 \\left( 1 + \\alpha s^2 \\right)$$\nSubstituting this profile into the turning point condition, we get:\n$$E = \\mu \\left[ B_0 \\left( 1 + \\alpha s_{\\text{turn}}^2 \\right) \\right]$$\nOur goal is to solve this equation for $s_{\\text{turn}}$. We can rearrange the terms as follows:\n$$\\frac{E}{\\mu B_0} = 1 + \\alpha s_{\\text{turn}}^2$$\n$$\\frac{E}{\\mu B_0} - 1 = \\alpha s_{\\text{turn}}^2$$\n$$s_{\\text{turn}}^2 = \\frac{1}{\\alpha} \\left( \\frac{E}{\\mu B_0} - 1 \\right)$$\nTaking the square root of both sides gives two symmetric solutions for the turning points:\n$$s_{\\text{turn}} = \\pm \\sqrt{\\frac{1}{\\alpha} \\left( \\frac{E}{\\mu B_0} - 1 \\right)}$$\nThus, the two symmetric reflection points, $s_1$ and $s_2$, are:\n$$s_1 = - \\sqrt{\\frac{1}{\\alpha} \\left( \\frac{E}{\\mu B_0} - 1 \\right)}$$\n$$s_2 = + \\sqrt{\\frac{1}{\\alpha} \\left( \\frac{E}{\\mu B_0} - 1 \\right)}$$\n\nFor these reflection points to exist as real values, the argument of the square root must be non-negative.\n$$\\frac{1}{\\alpha} \\left( \\frac{E}{\\mu B_0} - 1 \\right) \\ge 0$$\nGiven that the problem specifies $\\alpha  0$, this condition simplifies to:\n$$\\frac{E}{\\mu B_0} - 1 \\ge 0$$\n$$\\frac{E}{\\mu B_0} \\ge 1$$\nTherefore, the condition for the existence of real-valued reflection points is:\n$$E \\ge \\mu B_0$$\nThis is the condition for a particle to be trapped within the magnetic mirror. If this condition is not met, the particle is not confined by this magnetic field configuration (a scenario which is physically inconsistent with the setup as $E_{k,\\parallel}$ would need to be negative at the magnetic minimum). If $E = \\mu B_0$, the turning points coincide at $s=0$, meaning the particle is trapped exactly at the bottom of the magnetic well. If $E  \\mu B_0$, the particle oscillates between the two distinct turning points $s_1$ and $s_2$.", "answer": "$$ \\boxed{ \\begin{pmatrix} - \\sqrt{\\frac{1}{\\alpha} \\left( \\frac{E}{\\mu B_0} - 1 \\right)}  \\sqrt{\\frac{1}{\\alpha} \\left( \\frac{E}{\\mu B_0} - 1 \\right)} \\end{pmatrix} } $$", "id": "3723893"}, {"introduction": "Having established the basic mirroring mechanism, we now apply this concept to the toroidal geometry of a tokamak. The magnetic field in a tokamak is inherently non-uniform, being stronger on the inboard side and weaker on the outboard side, which creates a natural magnetic mirror. This practice will guide you in determining the bounce points for a trapped particle in this environment, revealing the origin of the famous 'banana orbits' that are critical to understanding neoclassical transport and plasma stability. [@problem_id:3723939]", "problem": "Consider an axisymmetric, large-aspect-ratio, circular tokamak with major radius $R_{0}$ and toroidal magnetic field on axis $B_{0}$. On a given flux surface labeled by minor radius $r$ (with inverse aspect ratio $\\epsilon \\equiv r/R_{0} \\ll 1$), approximate the magnetic field magnitude by $B(\\theta) = B_{0}\\,R_{0}/R(\\theta)$ with $R(\\theta) = R_{0} + r \\cos\\theta$, where $\\theta$ is the poloidal angle measured in radians. A charged particle of mass $m$ and charge $q$ moves collisionlessly with conserved total kinetic energy $E = \\tfrac{1}{2} m v^{2}$ and conserved first adiabatic invariant (magnetic moment) $\\mu = m v_{\\perp}^{2}/(2 B)$. Define the dimensionless pitch parameter by $\\lambda \\equiv \\mu B_{0}/E$, so that along the orbit the parallel velocity satisfies $v_{\\parallel}^{2}/v^{2} = 1 - \\lambda\\,B(\\theta)/B_{0}$. Neglect electric fields and magnetic drifts when locating bounce points, and define the “banana tips” as the real-space locations of these bounce (mirror) points in the poloidal plane.\n\nStarting from conservation of energy and magnetic moment and the given large-aspect-ratio magnetic geometry, do the following:\n\n- Determine the condition on $\\lambda$ for which the particle is trapped rather than passing.\n- For a trapped particle, determine the bounce angles $\\theta_{1}$ and $\\theta_{2}$ (in radians) at which $v_{\\parallel} = 0$.\n- Map these bounce points to their cylindrical coordinates in the poloidal plane to obtain the two banana tips $(R_{\\text{tip}}, Z_{\\text{tip}})$.\n\nExpress every intermediate relation you use in terms of $R_{0}$, $B_{0}$, $r$, $\\epsilon$, and $\\lambda$ only, together with standard constants. Use radians for any angles. As your final answer, provide a single closed-form analytic expression for the common major radius of the banana tips, $R_{\\text{tip}}$, in meters. Do not include units in the boxed final answer.", "solution": "The motion is treated in the guiding-center approximation with two conserved quantities: the total kinetic energy $E = \\tfrac{1}{2} m v^{2}$ and the magnetic moment $\\mu = m v_{\\perp}^{2}/(2 B)$. Introducing the dimensionless pitch parameter\n$$\n\\lambda \\equiv \\frac{\\mu B_{0}}{E},\n$$\nwe may write the parallel kinetic energy fraction using conservation of $E$ and $\\mu$:\n$$\n\\frac{v_{\\parallel}^{2}}{v^{2}} \\;=\\; 1 - \\lambda\\,\\frac{B(\\theta)}{B_{0}}.\n$$\nTurning (bounce) points occur where $v_{\\parallel} = 0$, which implies the condition\n$$\n1 - \\lambda\\,\\frac{B(\\theta)}{B_{0}} \\;=\\; 0\n\\quad \\Longrightarrow \\quad\n\\lambda \\;=\\; \\frac{B_{0}}{B(\\theta)}.\n$$\n\nMagnetic geometry for a large-aspect-ratio circular tokamak gives\n$$\nB(\\theta) \\;=\\; \\frac{B_{0} R_{0}}{R(\\theta)} \\;=\\; \\frac{B_{0}}{1 + \\epsilon \\cos\\theta},\n$$\nwhere $R(\\theta) = R_{0} + r \\cos\\theta$ and $\\epsilon \\equiv r/R_{0}$. Therefore\n$$\n\\frac{B_{0}}{B(\\theta)} \\;=\\; 1 + \\epsilon \\cos\\theta.\n$$\nThe bounce condition $\\lambda = B_{0}/B(\\theta)$ thus reads\n$$\n\\lambda \\;=\\; 1 + \\epsilon \\cos\\theta.\n$$\n\nTrapped-passing boundary. For a trapped particle, there must exist poloidal angles $\\theta$ such that the equality above is satisfied with real $\\theta$. Since $\\cos\\theta \\in [-1,1]$, the right-hand side $1 + \\epsilon \\cos\\theta$ spans the interval $[\\,1 - \\epsilon,\\; 1 + \\epsilon\\,]$. Hence bounce points exist if and only if\n$$\n1 - \\epsilon \\;\\le\\; \\lambda \\;\\le\\; 1 + \\epsilon.\n$$\nFor $\\,\\lambda  1 - \\epsilon\\,$, $v_{\\parallel}^{2}  0$ for all $\\theta$ and the particle is passing; for $\\,\\lambda  1 + \\epsilon\\,$, the right-hand side cannot be reached by any $\\theta$ on the given surface.\n\nBounce angles. Solving $\\lambda = 1 + \\epsilon \\cos\\theta$ for $\\theta$ gives\n$$\n\\cos\\theta_{b} \\;=\\; \\frac{\\lambda - 1}{\\epsilon}.\n$$\nDue to poloidal symmetry, the two bounce points are located at\n$$\n\\theta_{1} \\;=\\; -\\,\\theta_{b}, \\qquad \\theta_{2} \\;=\\; \\theta_{b}, \\qquad \\text{with} \\quad \\theta_{b} \\;=\\; \\arccos\\!\\Big(\\frac{\\lambda - 1}{\\epsilon}\\Big),\n$$\nwith $\\theta$ expressed in radians. This is valid provided $\\lambda \\in [\\,1 - \\epsilon,\\; 1 + \\epsilon\\,]$, which ensures the argument of $\\arccos$ lies in $[-1,1]$.\n\nBanana tips in real space. The cylindrical mapping on the given flux surface is\n$$\nR(\\theta) \\;=\\; R_{0} + r \\cos\\theta, \\qquad Z(\\theta) \\;=\\; r \\sin\\theta.\n$$\nEvaluating at the bounce angles $\\pm \\theta_{b}$ yields the two symmetric tip locations:\n$$\nR_{\\text{tip}} \\;=\\; R_{0} + r \\cos\\theta_{b}, \\qquad Z_{\\text{tip}} \\;=\\; \\pm\\, r \\sin\\theta_{b}.\n$$\nUsing $\\cos\\theta_{b} = (\\lambda - 1)/\\epsilon$ and $r = \\epsilon R_{0}$ simplifies $R_{\\text{tip}}$:\n$$\nR_{\\text{tip}} \\;=\\; R_{0} + r \\,\\frac{\\lambda - 1}{\\epsilon}\n\\;=\\; R_{0} + \\epsilon R_{0}\\,\\frac{\\lambda - 1}{\\epsilon}\n\\;=\\; R_{0}\\,\\lambda.\n$$\nEquivalently, one can see this directly from $B \\propto 1/R$: at a bounce $B = B_{0}/\\lambda$, so $R = (B_{0} R_{0})/B = R_{0} \\lambda$.\n\nThus, for a trapped particle, the bounce angles in radians are\n$$\n\\theta_{1} \\;=\\; -\\,\\arccos\\!\\Big(\\frac{\\lambda - 1}{\\epsilon}\\Big), \\qquad \\theta_{2} \\;=\\; \\arccos\\!\\Big(\\frac{\\lambda - 1}{\\epsilon}\\Big),\n$$\nand the banana tips are located at\n$$\nR_{\\text{tip}} \\;=\\; R_{0}\\,\\lambda, \\qquad Z_{\\text{tip}} \\;=\\; \\pm\\, r\\,\\sqrt{\\,1 - \\Big(\\frac{\\lambda - 1}{\\epsilon}\\Big)^{2}\\,}.\n$$\n\nPer the problem’s instruction, the final reported result is the single analytic expression for the common major radius of the banana tips $R_{\\text{tip}}$ in meters:\n$$\nR_{\\text{tip}} \\;=\\; R_{0}\\,\\lambda.\n$$", "answer": "$$\\boxed{R_{0}\\lambda}$$", "id": "3723939"}, {"introduction": "Our final practice tackles a non-ideal but critical effect in real tokamaks: particle loss induced by toroidal field 'ripple.' Discrete toroidal field coils inevitably create small-scale variations in the magnetic field, which can form secondary magnetic wells. In this computational exercise, you will quantify the fraction of particles lost to this effect by implementing a model that includes the important physics of gyroaveraging, providing a practical taste of the quantitative analysis required in fusion reactor design. [@problem_id:3723899]", "problem": "A large-aspect-ratio tokamak of major radius $R_0$ and on-axis toroidal magnetic field $B_0$ has a small toroidal field ripple with amplitude $\\delta$ and periodicity $N$ harmonics around the torus, such that the magnetic field magnitude along a field line can be modeled by $B(\\varphi) = B_0 \\left(1 + \\delta \\cos(N \\varphi)\\right)$, where $\\varphi$ is the toroidal angle. Consider guiding-center motion of ions with fixed total kinetic energy $E$ in this field. Assume conservation of energy $E$ and magnetic moment $\\mu$ so that the pitch parameter $\\lambda$ is defined by $\\lambda = \\mu B_0 / E$, and the parallel speed at location where the field is $B$ is given by $v_{\\parallel}^2 = v^2 \\left( 1 - \\lambda \\frac{B}{B_0} \\right)$ with $v = \\sqrt{2E/m}$ and $m$ the ion mass. A local ripple well exists if there are turning points satisfying $v_{\\parallel}^2 \\le 0$ at the ripple maxima, which imposes an upper-pitch condition that restricts $\\lambda$ to a domain near $\\lambda \\rightarrow 1$. For particles at a point with isotropic velocity-direction distribution at fixed speed $v$, the measure on pitch parameter $\\lambda$ induced by uniform distribution of $\\cos \\alpha \\in [-1,1]$ (where $\\alpha$ is the pitch angle defined by $v_{\\perp} = v \\sin \\alpha$, $v_{\\parallel} = v \\cos \\alpha$) must be used when integrating over the affected phase-space domain.\n\nIn this problem, finite Larmor radius (FLR) effects reduce the effective ripple amplitude seen by a gyrating ion, which is modeled by gyroaveraging the ripple with a Bessel-function factor: the effective ripple amplitude is $\\delta_{\\mathrm{eff}} = \\delta \\, \\left| J_0(k \\rho) \\right|$, where $J_0$ is the Bessel function of the first kind of order zero, $k = N/R_0$ is the toroidal ripple wavenumber, and $\\rho = \\frac{m v_{\\perp}}{Z e B_0}$ is the Larmor radius (with $Z e$ the ion charge). Use the approximation that the phase-space region affected by ripple trapping is near $\\lambda \\approx 1$, so that $v_{\\perp} \\approx v$ and thus $\\rho \\approx \\rho_{\\max} = \\frac{m v}{Z e B_0}$. Under this approximation, determine the fraction of phase-space directions at fixed $E$ that are in the ripple-induced trapped domain (i.e., the “ripple loss” fraction), by integrating the appropriate measure over $\\lambda$ subject to the trapping condition implied by the existence of turning points at ripple maxima.\n\nYou must implement a program that, for each test case described below, computes the ripple loss fraction as a real number in $[0,1]$ using the above assumptions and the guiding-center invariants. The answer must be a dimensionless decimal number. All physical quantities must be handled in International System of Units (SI); however, the input energies for the test suite are specified in kilo-electronvolts (keV), so your program must convert keV to joules using $1\\,\\mathrm{eV} = 1.602176634 \\times 10^{-19}\\,\\mathrm{J}$ before using them. The ion species is deuterium with $Z=1$ and mass $m = 3.343583719 \\times 10^{-27}\\,\\mathrm{kg}$. Use $B_0 = 5\\,\\mathrm{T}$, $R_0 = 3\\,\\mathrm{m}$, and $N = 36$.\n\nTest suite:\n- Case A: $\\delta = 0.03$, $E = 5\\,\\mathrm{keV}$.\n- Case B: $\\delta = 0.03$, $E = 50\\,\\mathrm{keV}$.\n- Case C: $\\delta = 0.03$, $E = 500\\,\\mathrm{keV}$.\n- Case D: $\\delta = 0.03$, $E = 5000\\,\\mathrm{keV}$.\n- Case E: $\\delta = 0.01$, $E = 50\\,\\mathrm{keV}$.\n- Case F: $\\delta = 0.00$, $E = 50\\,\\mathrm{keV}$.\n\nYour program should produce a single line of output containing the six results as a comma-separated list enclosed in square brackets (e.g., “[r_A,r_B,r_C,r_D,r_E,r_F]”), where each $r$ is the computed ripple loss fraction for the corresponding case expressed as a decimal number.", "solution": "The solution involves deriving the ripple trapping condition and then calculating the fraction of velocity space that satisfies this condition for an isotropic distribution.\n\n**1. Ripple Trapping Condition**\n\nA particle is trapped in a local magnetic ripple well if its parallel motion is reversed by the magnetic field maxima. The parallel velocity squared is given by:\n$$v_{\\parallel}^2 = v^2 \\left( 1 - \\lambda \\frac{B}{B_0} \\right)$$\nThe problem states that finite Larmor radius (FLR) effects are modeled by an effective ripple amplitude, $\\delta_{\\mathrm{eff}} = \\delta \\, \\left| J_0(k \\rho) \\right|$. The magnetic field along the particle's path is therefore $B(\\varphi) = B_0 \\left(1 + \\delta_{\\mathrm{eff}} \\cos(N \\varphi)\\right)$.\n\nThe magnetic field is maximum at the ripple crests, where $\\cos(N\\varphi) = 1$, so $B_{\\max} = B_0(1+\\delta_{\\mathrm{eff}})$. For a particle to be trapped, it must be reflected, meaning its parallel velocity must become zero at or before this point. The condition for trapping is therefore $v_{\\parallel}^2 \\le 0$ at $B=B_{\\max}$.\n$$v^2 \\left( 1 - \\lambda \\frac{B_{\\max}}{B_0} \\right) \\le 0$$\n$$1 - \\lambda (1+\\delta_{\\mathrm{eff}}) \\le 0$$\nThis gives the trapping condition in terms of the pitch parameter $\\lambda$:\n$$\\lambda \\ge \\frac{1}{1+\\delta_{\\mathrm{eff}}}$$\nSince $\\lambda = \\mu B_0 / E$ cannot exceed 1 (which corresponds to $v_\\parallel=0$ at the reference field $B_0$), the range of $\\lambda$ for ripple-trapped particles is $\\frac{1}{1+\\delta_{\\mathrm{eff}}} \\le \\lambda \\le 1$.\n\n**2. Calculating the Trapped Fraction**\n\nFor an isotropic velocity distribution at a fixed speed $v$, the probability distribution of the pitch angle cosine, $\\xi = \\cos \\alpha = v_{\\parallel}/v$, is uniform over the interval $[-1, 1]$. We need to find what range of $\\xi$ corresponds to the trapped particle domain.\n\nThe pitch parameter $\\lambda$ can be related to $\\xi$ using the definition of $\\mu$ at the reference field $B_0$:\n$$\\lambda = \\frac{\\mu B_0}{E} = \\frac{(m v_{\\perp}^2 / (2B_0)) B_0}{1/2 m v^2} = \\frac{v_{\\perp}^2}{v^2}$$\nUsing $v^2 = v_{\\parallel}^2 + v_{\\perp}^2$, we get:\n$$\\lambda = \\frac{v^2 - v_{\\parallel}^2}{v^2} = 1 - \\left(\\frac{v_{\\parallel}}{v}\\right)^2 = 1 - \\xi^2$$\nSubstituting this into the trapping condition:\n$$1 - \\xi^2 \\ge \\frac{1}{1+\\delta_{\\mathrm{eff}}}$$\n$$\\xi^2 \\le 1 - \\frac{1}{1+\\delta_{\\mathrm{eff}}} = \\frac{\\delta_{\\mathrm{eff}}}{1+\\delta_{\\mathrm{eff}}}$$\nThis defines the trapped region in pitch-angle-cosine space:\n$$|\\xi| \\le \\sqrt{\\frac{\\delta_{\\mathrm{eff}}}{1+\\delta_{\\mathrm{eff}}}}$$\nThe total range of $\\xi$ is from -1 to 1, a length of 2. The range of trapped particles has a length of $2 \\times \\sqrt{\\delta_{\\mathrm{eff}}/(1+\\delta_{\\mathrm{eff}})}$. The fraction of trapped particles is the ratio of these lengths:\n$$F_{\\mathrm{trap}} = \\frac{2 \\sqrt{\\frac{\\delta_{\\mathrm{eff}}}{1+\\delta_{\\mathrm{eff}}}}}{2} = \\sqrt{\\frac{\\delta_{\\mathrm{eff}}}{1+\\delta_{\\mathrm{eff}}}}$$\n\n**3. Computing the Argument for the Bessel Function**\n\nThe final step is to calculate the argument of the Bessel function, $x = k\\rho$, to find $\\delta_{\\mathrm{eff}}$. The problem specifies using the approximation that for ripple-trapped particles, $\\lambda \\approx 1$, which implies $v_\\perp \\approx v$.\n- The ripple wavenumber is $k = N/R_0$.\n- The particle speed is $v = \\sqrt{2E/m}$.\n- The Larmor radius is approximated as $\\rho \\approx \\rho_{\\max} = \\frac{mv}{ZeB_0}$.\n\nCombining these, the argument $x$ becomes:\n$$ x = k\\rho \\approx \\left(\\frac{N}{R_0}\\right) \\left(\\frac{m v}{ZeB_0}\\right) = \\frac{N}{R_0} \\frac{m}{ZeB_0} \\sqrt{\\frac{2E}{m}} = \\frac{N\\sqrt{2mE}}{R_0 ZeB_0} $$\nThe program in the answer implements this calculation flow: it computes the energy-dependent argument $x$, finds the effective ripple $\\delta_{\\mathrm{eff}} = \\delta |J_0(x)|$, and then calculates the final fraction $F_{\\mathrm{trap}}$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import j0\n\ndef solve():\n    \"\"\"\n    Calculates the ripple loss fraction for ions in a tokamak for several test cases.\n    \"\"\"\n    \n    # Define physical constants in SI units\n    B0 = 5.0  # T\n    R0 = 3.0  # m\n    N = 36  # toroidal mode number\n    M_D = 3.343583719e-27  # kg, mass of Deuterium\n    Z = 1  # charge number of Deuterium\n    E_CHARGE = 1.602176634e-19  # C, elementary charge\n    EV_TO_J = 1.602176634e-19 # J/eV\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (delta, energy_in_keV)\n    test_cases = [\n        (0.03, 5.0),    # Case A\n        (0.03, 50.0),   # Case B\n        (0.03, 500.0),  # Case C\n        (0.03, 5000.0), # Case D\n        (0.01, 50.0),   # Case E\n        (0.00, 50.0),   # Case F\n    ]\n\n    results = []\n    \n    # Pre-calculate the constant part of the Bessel function argument 'x'\n    # x = (N * sqrt(2 * m * E)) / (R0 * Z * e * B0)\n    # x = const * sqrt(E_joules)\n    const_for_x = (N * np.sqrt(2 * M_D)) / (R0 * Z * E_CHARGE * B0)\n\n    for delta, E_keV in test_cases:\n        # If the nominal ripple is zero, the loss fraction is zero.\n        if delta == 0.0:\n            results.append(0.0)\n            continue\n\n        # 1. Convert energy from keV to Joules\n        E_joules = E_keV * 1000.0 * EV_TO_J\n\n        # 2. Calculate the argument 'x' for the Bessel function J0(x)\n        # x = k * rho, where k = N/R0 and rho = m*v / (Z*e*B0)\n        # v = sqrt(2*E/m)\n        x = const_for_x * np.sqrt(E_joules)\n        \n        # 3. Calculate the effective ripple amplitude delta_eff\n        # delta_eff = delta * |J0(x)|\n        delta_eff = delta * np.abs(j0(x))\n\n        # 4. Calculate the ripple loss fraction\n        # F_trap = sqrt(delta_eff / (1 + delta_eff))\n        # Handle the case delta_eff = 0 to avoid division by zero (although not\n        # strictly necessary mathematically as it gives sqrt(0)).\n        if delta_eff == 0.0:\n            fraction = 0.0\n        else:\n            fraction = np.sqrt(delta_eff / (1.0 + delta_eff))\n        \n        results.append(fraction)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n\n```", "id": "3723899"}]}