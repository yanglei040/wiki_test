{"hands_on_practices": [{"introduction": "A successful Gaussian accelerated Molecular Dynamics (GaMD) simulation hinges on the careful selection of its boost parameters. This exercise [@problem_id:3393744] delves into the core principles of parameterizing the harmonic force constant, $k$. You will explore the fundamental trade-off between ensuring numerical stability and maintaining the fidelity of statistical reweighting, translating these conceptual goals into concrete mathematical expressions to find an optimal parameter value.", "problem": "In accelerated molecular dynamics (aMD) and Gaussian accelerated molecular dynamics (GaMD), a bias potential is introduced to smooth the underlying potential energy surface and enhance barrier-crossing events while permitting statistical reweighting back to unbiased thermodynamics. Consider a subsystem dihedral potential energy, denoted by $V$, obtained from a short conventional molecular dynamics (cMD) run. Suppose that, after equilibration, $V$ is well-approximated by a normal distribution with mean $\\mu$ and standard deviation $\\sigma$, i.e., $V \\sim \\mathcal{N}(\\mu,\\sigma^{2})$. In a single-boost GaMD, one applies the harmonic boost\n$$\n\\Delta V = \\begin{cases}\n\\dfrac{1}{2}\\,k\\,(E - V)^{2},  V  E, \\\\[6pt]\n0,  V \\ge E,\n\\end{cases}\n$$\nwhere $k0$ is a curvature parameter and $E$ is an energy threshold. Assume that the following statistically consistent quantities have been estimated from cMD for the subsystem:\n- $\\mu = 120$ kJ mol$^{-1}$,\n- $\\sigma = 25$ kJ mol$^{-1}$,\n- $V_{\\min} = 60$ kJ mol$^{-1}$ (the minimum observed $V$ over a long enough sample),\nand that you will set the GaMD threshold to $E = \\mu + 1.5\\,\\sigma$. For the purposes of analytic design, assume that the probability of $V \\ge E$ is sufficiently small that you may treat the boost as always active, i.e., approximate $\\Delta V \\approx \\dfrac{1}{2}k(E-V)^{2}$ without truncation.\n\nYou wish to select $k$ according to two simultaneous design goals grounded in reweighting theory and numerical stability:\n1) Reweighting fidelity goal: enforce that the standard deviation of the boost potential, $\\mathrm{sd}(\\Delta V)$, equals a target value $s_{0} = 10$ kJ mol$^{-1}$.\n2) Stability goal: enforce that the maximum boost at the sampled minimum, $\\Delta V_{\\max} = \\dfrac{1}{2}k(E - V_{\\min})^{2}$, does not exceed a cap $\\Delta V_{\\mathrm{cap}} = 40$ kJ mol$^{-1}$.\n\nStarting only from the definitions above and the standard moment properties of a normal random variable, first derive an analytic expression for $k$ that achieves the reweighting fidelity goal in terms of $\\mu$, $\\sigma$, $E$, and $s_{0}$. Next, derive the upper bound on $k$ implied by the stability goal. Then, compute the numerical value of $k$ that simultaneously satisfies both goals by taking the most restrictive choice. Express your final result as a single number in units of (kJ mol$^{-1}$)$^{-1}$ and round your answer to $4$ significant figures.", "solution": "The problem is valid as it is scientifically grounded in the principles of accelerated molecular dynamics, is well-posed with sufficient and consistent information, and is expressed in objective, formal language. We proceed with the solution.\n\nThe problem asks for the determination of the harmonic force constant, $k$, in Gaussian accelerated molecular dynamics (GaMD) that satisfies two design goals simultaneously. The potential energy of a subsystem, $V$, is assumed to follow a normal distribution, $V \\sim \\mathcal{N}(\\mu, \\sigma^2)$. The GaMD boost potential, $\\Delta V$, is approximated as being always active:\n$$\n\\Delta V \\approx \\frac{1}{2}k(E-V)^2\n$$\nwhere $k0$ is the parameter to be determined and $E$ is an energy threshold.\n\nThe given parameters are:\n- Mean of the potential: $\\mu = 120 \\, \\text{kJ mol}^{-1}$\n- Standard deviation of the potential: $\\sigma = 25 \\, \\text{kJ mol}^{-1}$\n- Minimum observed potential: $V_{\\min} = 60 \\, \\text{kJ mol}^{-1}$\n- Target standard deviation for the boost potential: $s_0 = 10 \\, \\text{kJ mol}^{-1}$\n- Maximum allowed boost potential: $\\Delta V_{\\mathrm{cap}} = 40 \\, \\text{kJ mol}^{-1}$\n\nThe energy threshold $E$ is set according to the rule:\n$$\nE = \\mu + 1.5\\,\\sigma\n$$\nSubstituting the given values, we find:\n$$\nE = 120 + 1.5 \\times 25 = 120 + 37.5 = 157.5 \\, \\text{kJ mol}^{-1}\n$$\n\nFirst, we derive an expression for $k$ based on the reweighting fidelity goal.\nThis goal states that the standard deviation of the boost potential, $\\mathrm{sd}(\\Delta V)$, must equal $s_0$. This is equivalent to the variance of the boost potential, $\\mathrm{Var}(\\Delta V)$, being equal to $s_0^2$.\n$$\n\\mathrm{Var}(\\Delta V) = E[\\Delta V^2] - (E[\\Delta V])^2 = s_0^2\n$$\nTo compute the expectation values, we use the properties of the random variable $V \\sim \\mathcal{N}(\\mu, \\sigma^2)$. It is convenient to work with the centered variable $X = V - \\mu$, which has distribution $X \\sim \\mathcal{N}(0, \\sigma^2)$. The moments of $X$ are $E[X]=0$, $E[X^2]=\\sigma^2$, $E[X^3]=0$, and $E[X^4]=3\\sigma^4$.\n\nThe term inside the boost potential is $E-V = E - (\\mu + X) = (E-\\mu) - X$.\nThe expectation value of $\\Delta V$ is:\n$$\nE[\\Delta V] = E\\left[\\frac{1}{2}k(E-V)^2\\right] = \\frac{k}{2} E[((E-\\mu) - X)^2]\n$$\n$$\nE[\\Delta V] = \\frac{k}{2} E[(E-\\mu)^2 - 2(E-\\mu)X + X^2]\n$$\nUsing the linearity of expectation and the moments of $X$:\n$$\nE[\\Delta V] = \\frac{k}{2} ((E-\\mu)^2 - 2(E-\\mu)E[X] + E[X^2]) = \\frac{k}{2} ((E-\\mu)^2 + \\sigma^2)\n$$\nNext, we compute the expectation of $\\Delta V^2$:\n$$\nE[\\Delta V^2] = E\\left[\\left(\\frac{1}{2}k(E-V)^2\\right)^2\\right] = \\frac{k^2}{4} E[(E-V)^4] = \\frac{k^2}{4} E[((E-\\mu)-X)^4]\n$$\nUsing the binomial expansion $(a-b)^4 = a^4 - 4a^3b + 6a^2b^2 - 4ab^3 + b^4$:\n$$\nE[\\Delta V^2] = \\frac{k^2}{4} E[(E-\\mu)^4 - 4(E-\\mu)^3X + 6(E-\\mu)^2X^2 - 4(E-\\mu)X^3 + X^4]\n$$\nUsing the moments of $X$:\n$$\nE[\\Delta V^2] = \\frac{k^2}{4} [(E-\\mu)^4 + 6(E-\\mu)^2E[X^2] + E[X^4]] = \\frac{k^2}{4} [(E-\\mu)^4 + 6(E-\\mu)^2\\sigma^2 + 3\\sigma^4]\n$$\nNow we compute the variance:\n$$\n\\mathrm{Var}(\\Delta V) = E[\\Delta V^2] - (E[\\Delta V])^2\n$$\n$$\n\\mathrm{Var}(\\Delta V) = \\frac{k^2}{4} [(E-\\mu)^4 + 6(E-\\mu)^2\\sigma^2 + 3\\sigma^4] - \\left(\\frac{k}{2} ((E-\\mu)^2 + \\sigma^2)\\right)^2\n$$\n$$\n\\mathrm{Var}(\\Delta V) = \\frac{k^2}{4} [(E-\\mu)^4 + 6(E-\\mu)^2\\sigma^2 + 3\\sigma^4] - \\frac{k^2}{4} [(E-\\mu)^4 + 2(E-\\mu)^2\\sigma^2 + \\sigma^4]\n$$\n$$\n\\mathrm{Var}(\\Delta V) = \\frac{k^2}{4} [4(E-\\mu)^2\\sigma^2 + 2\\sigma^4] = \\frac{k^2\\sigma^2}{2} [2(E-\\mu)^2 + \\sigma^2]\n$$\nSetting this equal to $s_0^2$ and solving for $k$ (since $k0$):\n$$\ns_0^2 = \\frac{k^2\\sigma^2}{2} [2(E-\\mu)^2 + \\sigma^2]\n$$\n$$\nk^2 = \\frac{2s_0^2}{\\sigma^2(2(E-\\mu)^2 + \\sigma^2)}\n$$\n$$\nk = \\frac{\\sqrt{2}s_0}{\\sigma\\sqrt{2(E-\\mu)^2 + \\sigma^2}}\n$$\nThis is the analytic expression for $k$ that satisfies the reweighting fidelity goal. Let's call this value $k_{\\mathrm{fidelity}}$.\n\nSecond, we derive the upper bound on $k$ from the stability goal. This goal requires that the maximum boost, $\\Delta V_{\\max} = \\frac{1}{2}k(E-V_{\\min})^2$, does not exceed $\\Delta V_{\\mathrm{cap}}$.\n$$\n\\frac{1}{2}k(E - V_{\\min})^2 \\le \\Delta V_{\\mathrm{cap}}\n$$\nSolving for $k$ gives the upper bound:\n$$\nk \\le \\frac{2\\Delta V_{\\mathrm{cap}}}{(E - V_{\\min})^2}\n$$\nLet's call this upper limit $k_{\\mathrm{stability\\_max}}$.\n\nNow, we compute the numerical values.\nFirst, we calculate the terms needed for $k_{\\mathrm{fidelity}}$:\n- $E-\\mu = 157.5 - 120 = 37.5$\n- $\\sigma = 25$\n- $s_0 = 10$\n$$\nk_{\\mathrm{fidelity}} = \\frac{\\sqrt{2} \\times 10}{25\\sqrt{2(37.5)^2 + (25)^2}} = \\frac{10\\sqrt{2}}{25\\sqrt{2(1406.25) + 625}} = \\frac{10\\sqrt{2}}{25\\sqrt{2812.5 + 625}} = \\frac{10\\sqrt{2}}{25\\sqrt{3437.5}}\n$$\n$$\nk_{\\mathrm{fidelity}} \\approx \\frac{14.142136}{25 \\times 58.6302} \\approx \\frac{14.142136}{1465.755} \\approx 0.00964836 \\, (\\text{kJ mol}^{-1})^{-1}\n$$\nNext, we calculate the upper bound $k_{\\mathrm{stability\\_max}}$:\n- $E - V_{\\min} = 157.5 - 60 = 97.5$\n- $\\Delta V_{\\mathrm{cap}} = 40$\n$$\nk_{\\mathrm{stability\\_max}} = \\frac{2 \\times 40}{(97.5)^2} = \\frac{80}{9506.25} \\approx 0.00841552 \\, (\\text{kJ mol}^{-1})^{-1}\n$$\nTo satisfy both goals simultaneously, we must choose a value of $k$ that meets the fidelity requirement, $k = k_{\\mathrm{fidelity}}$, if and only if it also respects the stability constraint, $k \\le k_{\\mathrm{stability\\_max}}$.\nWe compare the two values:\n$$\nk_{\\mathrm{fidelity}} \\approx 0.009648\n$$\n$$\nk_{\\mathrm{stability\\_max}} \\approx 0.008416\n$$\nSince $k_{\\mathrm{fidelity}}  k_{\\mathrm{stability\\_max}}$, the value of $k$ required to achieve the desired reweighting fidelity violates the numerical stability criterion. Therefore, we must select the most restrictive choice, which is the maximum value allowed by the stability goal. This ensures the simulation remains stable, at the cost of not perfectly achieving the target boost standard deviation.\nThe final value for $k$ is:\n$$\nk = k_{\\mathrm{stability\\_max}} \\approx 0.00841552 \\, (\\text{kJ mol}^{-1})^{-1}\n$$\nRounding to $4$ significant figures as requested, we get $0.008416$.", "answer": "$$\n\\boxed{0.008416}\n$$", "id": "3393744"}, {"introduction": "Enhanced sampling methods like GaMD are powerful tools, but their effectiveness is fundamentally tied to the quality of the underlying potential energy surface. This exercise [@problem_id:3393782] challenges you to think critically about how common approximations in force fields, such as potential truncation, can introduce artifacts that undermine a simulation's validity. By analyzing the connection between force discontinuities and the statistical properties of the boost potential, you will learn to identify and implement best practices for constructing a smooth and physically realistic energy landscape, a prerequisite for any reliable MD study.", "problem": "Consider a classical molecular dynamics simulation of $N$ particles in a cubic box subject to periodic boundary conditions (PBC). Let the total potential energy be $V(\\mathbf{r}) = \\sum_{ij} u(r_{ij})$, where $u(r)$ is a pair potential and $r_{ij}$ is the minimum-image pair distance. Suppose $u(r)$ is truncated at a cutoff $r_c$ without any switching or shifting, i.e., $u_{\\text{trunc}}(r) = u(r)$ for $r  r_c$ and $u_{\\text{trunc}}(r) = 0$ for $r \\ge r_c$. The forces are given by $\\mathbf{F} = -\\nabla V(\\mathbf{r})$, and the dynamics follow Newton’s second law $m \\ddot{\\mathbf{r}} = \\mathbf{F}$ integrated with a finite time step $\\Delta t$.\n\nYou apply Gaussian accelerated Molecular Dynamics (GaMD), which adds a boost potential $\\Delta V(\\mathbf{r})$ that activates when $V(\\mathbf{r})$ is below a threshold $E$, with reweighting procedures that rely on the assumption that the distribution of sampled $\\Delta V$ is approximately Gaussian. You are asked to reason from first principles and well-tested facts about classical dynamics and potential truncation to investigate how the smoothness of $V(\\mathbf{r})$ and its gradient near $E$ affects the distribution of $\\Delta V$.\n\nUsing the definition $\\mathbf{F}(\\mathbf{r}) = -\\nabla V(\\mathbf{r})$, the truncation $u_{\\text{trunc}}(r)$, and the PBC minimum-image convention, analyze the qualitative effect of a discontinuity in $dV/d\\mathbf{r}$ at $r = r_c$ on the fluctuations of $V(\\mathbf{r})$ near $E$ and, by extension, on the on/off activation of $\\Delta V(\\mathbf{r})$. Then identify which of the following statements are correct about the origin of non-Gaussian features in the sampled $\\Delta V$ under GaMD and practical remedies to mitigate them.\n\nChoose all that apply:\n\n- A. A sharp truncation of $u(r)$ at $r_c$ without any force-smoothing introduces a discontinuity in $dV/d\\mathbf{r}$ that yields impulsive changes in $\\mathbf{F}$ when pairs cross $r_c$, which in turn can produce skewness and heavy tails in the sampled $\\Delta V$ distribution near the threshold $E$. Remedy: employ switching functions or force-shifted potentials to ensure both $V(r)$ and $dV/dr$ smoothly approach zero at $r_c$, and use long-range methods (e.g., Ewald-type summation) for Coulombic interactions.\n\n- B. Periodic boundary conditions intrinsically render $V(\\mathbf{r})$ non-differentiable at the box boundaries; therefore, GaMD fundamentally fails under PBC and the remedy is to disable PBC during GaMD.\n\n- C. Increasing the integrator time step $\\Delta t$ reduces the impact of force discontinuities by averaging their effect over longer intervals, thereby improving the Gaussianity of the $\\Delta V$ distribution.\n\n- D. Ensuring continuity of $V(r)$ at $r_c$ via potential-shifting is sufficient to prevent non-Gaussian $\\Delta V$, because $dV/dr$ at $r_c$ does not affect GaMD since $\\Delta V$ depends only on $V(\\mathbf{r})$.\n\n- E. A quintic switching function $s(r)$ applied between a switching radius $r_s$ and $r_c$ that enforces $s(r_s) = 1$, $s(r_c) = 0$, $s'(r_s) = 0$, $s'(r_c) = 0$, $s''(r_s) = 0$, and $s''(r_c) = 0$ (so that both $V$ and $dV/dr$ are continuous and smooth) reduces non-Gaussianity in $\\Delta V$ by removing derivative discontinuities; combining this with Particle Mesh Ewald for electrostatics further mitigates artifacts from truncation.", "solution": "The problem statement will first be validated for scientific soundness, self-consistency, and clarity before a solution is attempted.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- System: $N$ particles in a cubic box with periodic boundary conditions (PBC).\n- Total potential energy: $V(\\mathbf{r}) = \\sum_{ij} u(r_{ij})$, where $u(r)$ is a pair potential and $r_{ij}$ is the minimum-image pair distance.\n- Truncated potential: $u_{\\text{trunc}}(r) = u(r)$ for $r  r_c$ and $u_{\\text{trunc}}(r) = 0$ for $r \\ge r_c$, without switching or shifting.\n- Forces: $\\mathbf{F} = -\\nabla V(\\mathbf{r})$.\n- Dynamics: Newtonian equations of motion $m \\ddot{\\mathbf{r}} = \\mathbf{F}$, integrated with a finite time step $\\Delta t$.\n- Method: Gaussian accelerated Molecular Dynamics (GaMD) adds a boost potential $\\Delta V(\\mathbf{r})$ when the system potential $V(\\mathbf{r})$ is below a threshold $E$.\n- Premise for reweighting: The distribution of sampled $\\Delta V$ values is approximately Gaussian.\n- Question: Analyze the effect of a discontinuity in $dV/d\\mathbf{r}$ at $r=r_c$ on the fluctuations of $V(\\mathbf{r})$ and the activation of $\\Delta V(\\mathbf{r})$. Identify correct statements regarding the origin of non-Gaussian features in the sampled $\\Delta V$ distribution and their mitigation.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem statement is scientifically sound and well-posed.\n- **Scientifically Grounded**: The problem is rooted in the fundamental principles of classical molecular dynamics simulations. It correctly describes the relationship between potential energy $V(\\mathbf{r})$, force $\\mathbf{F} = -\\nabla V(\\mathbf{r})$, and dynamics ($m\\ddot{\\mathbf{r}} = \\mathbf{F}$). The use of pair potentials, PBC, and potential truncation are standard concepts. Gaussian accelerated MD is a well-established enhanced sampling technique, and the importance of the distribution of the boost potential for accurate reweighting is a central aspect of the method. The question probes a known and critical artifact in MD simulations—the consequences of potential and force discontinuities.\n- **Well-Posed**: The question is specific and answerable. It asks for a qualitative analysis based on first principles, connecting a specific implementation choice (sharp potential truncation) to a specific consequence (non-Gaussianity of the GaMD boost potential distribution). A definitive analysis can be performed based on the provided information.\n- **Objective and Complete**: The problem is stated in precise, technical language. It provides all necessary definitions for a rigorous qualitative analysis. No subjective claims are made.\n\n**Step 3: Verdict and Action**\nThe problem is **valid**. The solution will now proceed.\n\n### Derivation and Analysis\n\nThe core of the problem lies in the connection between the smoothness of the potential energy function $V(\\mathbf{r})$ and the statistical properties of the GaMD boost potential, $\\Delta V(\\mathbf{r})$.\n\n1.  **Potential and Force:** The total force on the system is the negative gradient of the total potential energy: $\\mathbf{F}(\\mathbf{r}) = -\\nabla V(\\mathbf{r})$. For a pair potential, the force on a particle $k$ is the sum of pairwise forces: $\\mathbf{F}_k = -\\sum_{j \\neq k} \\nabla_k u_{\\text{trunc}}(r_{kj})$. The pairwise force between particles $i$ and $j$ is $\\mathbf{f}_{ij} = -\\nabla_i u_{\\text{trunc}}(r_{ij}) = - \\frac{d u_{\\text{trunc}}(r_{ij})}{d r_{ij}} \\frac{\\mathbf{r}_{ij}}{r_{ij}}$.\n\n2.  **Discontinuity due to Truncation:** The problem specifies a sharp truncation: $u_{\\text{trunc}}(r) = u(r)$ for $r  r_c$ and $u_{\\text{trunc}}(r) = 0$ for $r \\ge r_c$.\n    - The derivative of this potential is $\\frac{d u_{\\text{trunc}}}{dr} = \\frac{du}{dr}$ for $r  r_c$ and $\\frac{d u_{\\text{trunc}}}{dr} = 0$ for $r \\ge r_c$.\n    - Unless the original potential's derivative happens to be exactly zero at the cutoff, i.e., $\\frac{du}{dr}|_{r=r_c} = 0$, the function $\\frac{d u_{\\text{trunc}}}{dr}$ will have a jump discontinuity at $r = r_c$.\n    - Since the force magnitude is proportional to this derivative, the force itself is discontinuous at $r=r_c$. This is the \"discontinuity in $dV/d\\mathbf{r}$\" mentioned in the problem. (Note: A discontinuity in $u(r_c)$ itself is even more severe, implying an infinite force, but standard potentials like Lennard-Jones are typically used where $u(r_c)$ is small, making the force discontinuity the more common practical issue).\n\n3.  **Effect on Dynamics:** In a molecular dynamics simulation, particles move according to Newton's laws integrated over a finite time step $\\Delta t$. When a pair of particles crosses the distance $r_c$, the force between them changes instantaneously. A discontinuous force implies an infinite third time derivative of position (jerk). Numerical integrators like the Verlet algorithm assume that forces are smoothly varying functions of position. A force discontinuity violates this assumption, leading to significant integration errors and a failure to conserve total energy. These errors manifest as artificial kinetic energy \"kicks\" every time a pair crosses $r_c$, effectively adding noise and heating the system in a non-physical manner.\n\n4.  **Effect on GaMD:** GaMD relies on adding a boost potential $\\Delta V(\\mathbf{r})$ when $V(\\mathbf{r})  E$. The reweighting procedure to recover canonical averages of observables relies on the cumulant expansion of $\\langle e^{\\beta \\Delta V} \\rangle$, which is most accurate and converges quickly when the distribution of $\\Delta V$ is close to a Gaussian.\n    - The artificial energy kicks caused by force discontinuities introduce large, rapid, and non-thermal fluctuations into the time series of the potential energy $V(\\mathbf{r})$.\n    - When $V(\\mathbf{r})$ is fluctuating near the threshold energy $E$, these kicks can cause the system to erratically jump in and out of the \"boosted\" regime.\n    - The distribution of $V(\\mathbf{r})$ will develop non-Gaussian features, such as heavy tails, due to these high-energy unphysical events. Since $\\Delta V$ is a direct function of $V$ (e.g., in dual-boost GaMD, $\\Delta V = \\frac{1}{2} k (E-V)^2$ for $V  E$), the distribution of sampled $\\Delta V$ values will inherit these non-Gaussian characteristics. This can manifest as skewness or heavy tails, compromising the fundamental assumption of the GaMD reweighting scheme and potentially leading to incorrect free energy profiles.\n\n### Option-by-Option Evaluation\n\n-   **A. A sharp truncation of $u(r)$ at $r_c$ without any force-smoothing introduces a discontinuity in $dV/d\\mathbf{r}$ that yields impulsive changes in $\\mathbf{F}$ when pairs cross $r_c$, which in turn can produce skewness and heavy tails in the sampled $\\Delta V$ distribution near the threshold $E$. Remedy: employ switching functions or force-shifted potentials to ensure both $V(r)$ and $dV/dr$ smoothly approach zero at $r_c$, and use long-range methods (e.g., Ewald-type summation) for Coulombic interactions.**\n    - This statement accurately summarizes the analysis above. A discontinuity in the potential gradient ($dV/d\\mathbf{r}$) is a force discontinuity. This causes impulsive changes leading to poor dynamics and artificial fluctuations, which result in a non-Gaussian $\\Delta V$ distribution. The remedies proposed—switching functions, force-shifting, and Ewald summation for electrostatics—are the standard and correct procedures in high-quality MD simulations to ensure the potential energy surface is smooth and physically realistic. These methods eliminate the source of the artifacts.\n    - **Verdict: Correct.**\n\n-   **B. Periodic boundary conditions intrinsically render $V(\\mathbf{r})$ non-differentiable at the box boundaries; therefore, GaMD fundamentally fails under PBC and the remedy is to disable PBC during GaMD.**\n    - This statement is fundamentally incorrect. The minimum image convention within PBC is designed to make the potential energy a continuous and differentiable periodic function of particle coordinates, provided the cutoff radius $r_c$ is less than half the box length and the pair potential $u(r)$ is itself smooth. The source of non-differentiability is the truncation scheme, not PBC. Disabling PBC is not a remedy; it would fundamentally change the system from a bulk-like state to a finite cluster, introducing massive surface effects and making the simulation irrelevant for most condensed-phase studies.\n    - **Verdict: Incorrect.**\n\n-   **C. Increasing the integrator time step $\\Delta t$ reduces the impact of force discontinuities by averaging their effect over longer intervals, thereby improving the Gaussianity of the $\\Delta V$ distribution.**\n    - This statement is the opposite of correct. Numerical integrators for molecular dynamics rely on the assumption that the force is approximately constant over the time step $\\Delta t$. For a rapidly changing or discontinuous force, a larger $\\Delta t$ worsens this approximation, leading to larger integration errors and poorer energy conservation. This would amplify the artificial fluctuations, not reduce them. To handle sharp features in the potential, one must *decrease* the time step.\n    - **Verdict: Incorrect.**\n\n-   **D. Ensuring continuity of $V(r)$ at $r_c$ via potential-shifting is sufficient to prevent non-Gaussian $\\Delta V$, because $dV/dr$ at $r_c$ does not affect GaMD since $\\Delta V$ depends only on $V(\\mathbf{r})$.**\n    - This statement contains a critical flaw in reasoning. While $\\Delta V$ is a function of $V(\\mathbf{r})$, the configurations $\\mathbf{r}$ that the system samples are generated by dynamics governed by the forces, $\\mathbf{F} = -\\nabla V = -dV/d\\mathbf{r}$. A simple potential-shifting scheme ($u_{\\text{shifted}}(r) = u(r) - u(r_c)$ for $r  r_c$) makes $V$ continuous but leaves the force ($ -du/dr$) discontinuous at $r_c$. As established, discontinuous forces lead to pathological dynamics and artificial fluctuations in the sampled $V$ values. Therefore, ensuring continuity in $V(r)$ alone is insufficient; continuity in the force is also essential for stable and physical dynamics, which is a prerequisite for obtaining a well-behaved $\\Delta V$ distribution.\n    - **Verdict: Incorrect.**\n\n-   **E. A quintic switching function $s(r)$ applied between a switching radius $r_s$ and $r_c$ that enforces $s(r_s) = 1$, $s(r_c) = 0$, $s'(r_s) = 0$, $s'(r_c) = 0$, $s''(r_s) = 0$, and $s''(r_c) = 0$ (so that both $V$ and $dV/dr$ are continuous and smooth) reduces non-Gaussianity in $\\Delta V$ by removing derivative discontinuities; combining this with Particle Mesh Ewald for electrostatics further mitigates artifacts from truncation.**\n    - This statement provides a technically detailed and correct solution. A quintic switching function with these boundary conditions ensures that the modified potential, its first derivative (the force), and its second derivative are all continuous and smoothly go to zero at the cutoff $r_c$. This level of smoothness is highly desirable for stable dynamics and excellent energy conservation. By eliminating the force discontinuities, it removes the root cause of the artificial fluctuations in $V(\\mathbf{r})$, thereby promoting a more Gaussian $\\Delta V$ distribution. The mention of Particle Mesh Ewald (PME) is also correct, as it is the standard method for accurately treating long-range electrostatic interactions under PBC, which avoids the gross errors of a simple electrostatic truncation. This entire statement describes state-of-the-art best practices for constructing a high-quality potential energy function for MD, which directly benefits methods like GaMD.\n    - **Verdict: Correct.**", "answer": "$$\\boxed{AE}$$", "id": "3393782"}, {"introduction": "Beyond static parameterization, the next frontier in enhanced sampling is the development of adaptive algorithms that tune themselves during a simulation. This capstone exercise [@problem_id:3393748] requires you to implement such an algorithm, building a feedback loop that dynamically adjusts the GaMD boost parameter $k_0$. You will translate statistical theory into practice by using quantitative tests for Gaussianity to control the simulation, ensuring the validity of the reweighting procedure in real time.", "problem": "You are asked to implement an automated Gaussianity detector for the boost potential time series used in Gaussian accelerated Molecular Dynamics (GaMD), and to use it to dynamically adjust the harmonic fraction parameter $k_0$ during a simulated production run. The goal is to maintain an approximately Gaussian distribution of the accumulated boost potential increments over time so that second-order cumulant expansion remains justified.\n\nUse the following fundamental basis and definitions.\n\n- In Gaussian accelerated Molecular Dynamics (GaMD), a harmonic boost potential is applied to the system. The statistical efficiency and theoretical consistency of free-energy reweighting depend on the boost potential increments being approximately normally distributed. Normality can be assessed by standard statistical tests and quantile diagnostics.\n- For a data vector $x = (x_1,\\dots,x_n)$, define the $z$-scored sample $z_i = (x_i - \\bar{x})/s_x$, where $\\bar{x}$ is the sample mean and $s_x$ is the sample standard deviation. If $s_x \\le \\varepsilon$ for some small tolerance $\\varepsilon$, treat the window as non-Gaussian.\n- Let $\\Phi$ be the cumulative distribution function of the standard normal distribution and $\\Phi^{-1}$ its quantile function. Let $z_{(1)} \\le \\dots \\le z_{(n)}$ be the order statistics of the $z$-scores. Define theoretical quantiles $q_i = \\Phi^{-1}\\!\\left(\\frac{i - 0.5}{n}\\right)$ for $i = 1,\\dots,n$. Define the root-mean-square quantile residual\n  $$\\rho = \\left( \\frac{1}{n} \\sum_{i=1}^{n} \\left(z_{(i)} - q_i \\right)^2 \\right)^{1/2}.$$\n- Define the Kolmogorov–Smirnov test $p$-value against the standard normal for the $z$-scores as $p_{\\mathrm{KS}} \\in [0,1]$. A window is accepted as approximately Gaussian if and only if both $\\rho \\le \\tau$ and $p_{\\mathrm{KS}} \\ge \\alpha$, where $\\tau  0$ and $\\alpha \\in (0,1)$ are user-specified thresholds.\n- Consider a rolling window scheme over a univariate time series $(X_t)_{t=1}^{N}$ with window width $W$ and stride $S$. For window start indices $t \\in \\{1, 1+S, 1+2S, \\dots\\}$ such that $t+W-1 \\le N$, compute the Gaussianity decision for the window $(X_t,\\dots,X_{t+W-1})$.\n- Let the harmonic fraction parameter $k_0$ be updated online by the rule\n  $$k_0 \\leftarrow \\mathrm{clamp}\\!\\left(k_0 + \\eta_{\\uparrow}\\right) \\text{ if the window is accepted as Gaussian, else } k_0 \\leftarrow \\mathrm{clamp}\\!\\left(k_0 - \\eta_{\\downarrow}\\right),$$\n  where $\\eta_{\\uparrow}  0$ and $\\eta_{\\downarrow}  0$ are step sizes and\n  $$\\mathrm{clamp}(x) = \\min\\{\\max\\{x, k_{0,\\min}\\}, k_{0,\\max}\\}.$$\n  The interval endpoints $k_{0,\\min}$ and $k_{0,\\max}$ satisfy $0  k_{0,\\min}  k_{0,\\max}  1$. The parameter $k_0$ is dimensionless.\n\nImplement a program that, for a given synthetic time series and parameters, returns the final value of $k_0$ after processing all rolling windows. The time series $(X_t)$ will be generated from specified distributions using a pseudorandom number generator with a fixed seed. The boost potential increments are dimensionless in this synthetic setup, and you should standardize within each window as specified. All computed outputs are dimensionless real numbers and must be rounded to six decimal places.\n\nThe rolling-window Gaussianity detection and control must be applied to the following test suite. For each case, generate the time series $(X_t)$ as specified, then apply the rolling-window procedure and the dynamic update of $k_0$.\n\n- Case $1$ (Gaussian baseline growth):\n  - Generation: $X_t \\sim \\mathcal{N}(0,1)$ independently for $t=1,\\dots,N$ with seed $s = 20240501$.\n  - Parameters: $N = 2000$, $W = 200$, $S = 100$, $\\alpha = 10^{-6}$, $\\tau = 0.075$, $k_0^{(0)} = 0.3$, $\\eta_{\\uparrow} = 0.02$, $\\eta_{\\downarrow} = 0.05$, $k_{0,\\min} = 0.05$, $k_{0,\\max} = 0.99$.\n\n- Case $2$ (Heavy-tailed suppression):\n  - Generation: $X_t \\sim \\mathrm{Laplace}(0,1)$ independently for $t=1,\\dots,N$ with seed $s = 20240502$. The Laplace distribution with location $0$ and scale $1$ has density $f(x) = \\frac{1}{2} e^{-|x|}$.\n  - Parameters: $N = 2000$, $W = 200$, $S = 100$, $\\alpha = 10^{-6}$, $\\tau = 0.075$, $k_0^{(0)} = 0.8$, $\\eta_{\\uparrow} = 0.02$, $\\eta_{\\downarrow} = 0.05$, $k_{0,\\min} = 0.05$, $k_{0,\\max} = 0.99$.\n\n- Case $3$ (Block mixture with non-overlapping windows):\n  - Generation: For $N = 1000$ points with seed $s = 20240503$, draw the first $\\lfloor 0.6 N \\rfloor$ points independently from $\\mathcal{N}(0,1)$ and the remaining points independently from $\\mathrm{Laplace}(0,1)$. Concatenate in that order to form $(X_t)$.\n  - Parameters: $N = 1000$, $W = 200$, $S = 200$, $\\alpha = 10^{-6}$, $\\tau = 0.075$, $k_0^{(0)} = 0.4$, $\\eta_{\\uparrow} = 0.1$, $\\eta_{\\downarrow} = 0.2$, $k_{0,\\min} = 0.1$, $k_{0,\\max} = 0.9$.\n\n- Case $4$ (Degenerate zero-variance windows):\n  - Generation: Deterministic constant series $X_t = 0$ for all $t=1,\\dots,N$ (no randomness).\n  - Parameters: $N = 200$, $W = 50$, $S = 25$, $\\alpha = 10^{-6}$, $\\tau = 0.075$, $k_0^{(0)} = 0.2$, $\\eta_{\\uparrow} = 0.01$, $\\eta_{\\downarrow} = 0.03$, $k_{0,\\min} = 0.05$, $k_{0,\\max} = 0.99$. Treat any window with sample standard deviation $\\le \\varepsilon$ for $\\varepsilon = 10^{-12}$ as non-Gaussian.\n\n- Case $5$ (Alternating blocks):\n  - Generation: For $N = 1200$ points with seed $s = 20240505$ and $W = 200$, create $6$ contiguous blocks of length $W$, alternating between $\\mathcal{N}(0,1)$ and $\\mathrm{Laplace}(0,1)$ starting with $\\mathcal{N}(0,1)$, and concatenate to form $(X_t)$.\n  - Parameters: $N = 1200$, $W = 200$, $S = 200$, $\\alpha = 10^{-6}$, $\\tau = 0.075$, $k_0^{(0)} = 0.5$, $\\eta_{\\uparrow} = 0.05$, $\\eta_{\\downarrow} = 0.05$, $k_{0,\\min} = 0.05$, $k_{0,\\max} = 0.95$.\n\nYour program must implement the following steps for each case.\n\n- Generate $(X_t)_{t=1}^{N}$ exactly as specified by the case.\n- For each window $(X_t,\\dots,X_{t+W-1})$ with stride $S$, compute the $z$-scores, the root-mean-square quantile residual $\\rho$, and the Kolmogorov–Smirnov $p$-value $p_{\\mathrm{KS}}$ against the standard normal. If the sample standard deviation in a window is $\\le \\varepsilon$ (with $\\varepsilon = 10^{-12}$), treat that window as non-Gaussian.\n- Decide Gaussianity by requiring simultaneously $\\rho \\le \\tau$ and $p_{\\mathrm{KS}} \\ge \\alpha$.\n- Update $k_0$ according to the rule given, clamped to $[k_{0,\\min}, k_{0,\\max}]$.\n- After processing all windows, record the final $k_0$ (dimensionless) and round to six decimal places.\n\nFinal output format requirement: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5]\"), where each result is the final $k_0$ for the corresponding case, rounded to six decimal places.\n\nNotes.\n\n- All mathematical symbols and numbers in this problem are to be interpreted literally; outputs are real numbers without physical units (dimensionless).\n- Angles are not used in this problem.", "solution": "The problem statement has been analyzed and found to be valid. It is scientifically grounded in the principles of enhanced sampling methods in molecular dynamics, well-posed with all necessary information provided, and objective in its definitions and required tasks.\n\nThe problem asks for the implementation of an online control algorithm for the harmonic fraction parameter, $k_0$, in Gaussian accelerated Molecular Dynamics (GaMD). The fundamental principle behind this procedure is the requirement that the applied boost potential, $\\Delta V$, follows a distribution that is approximately Gaussian. This is crucial for the analytical reweighting of observables to recover the canonical ensemble average, as the reweighting formulas are most tractable and theoretically sound when a second-order cumulant expansion is sufficient, which is justified by the normality of $\\Delta V$.\n\nThe proposed algorithm operationalizes this principle through a rolling-window statistical analysis of a time series of boost potential increments, $(X_t)$. For each window of data of width $W$, we assess its deviation from a Gaussian distribution using a two-part statistical test on the $z$-scored data, $z_i=(x_i - \\bar{x})/s_x$. The criteria for accepting a window as \"Gaussian\" are:\n1.  The Kolmogorov-Smirnov (KS) test $p$-value, $p_{\\mathrm{KS}}$, must be greater than or equal to a significance threshold $\\alpha$. The KS test is a non-parametric test that compares the empirical cumulative distribution function (ECDF) of the sample with the theoretical cumulative distribution function (CDF) of the reference distribution—in this case, the standard normal distribution $\\mathcal{N}(0,1)$. A small $p$-value suggests that the sample distribution is significantly different from the reference.\n2.  The root-mean-square quantile residual, $\\rho$, must be less than or equal to a tolerance $\\tau$. This metric is derived from a quantile-quantile (Q-Q) plot analysis. It measures the average deviation between the sample quantiles, $z_{(i)}$, and the theoretical quantiles of a standard normal distribution, $q_i = \\Phi^{-1}\\!\\left(\\frac{i - 0.5}{n}\\right)$. This test is particularly sensitive to discrepancies in the tails of the distribution, which are often of critical importance in statistical mechanics.\n\nA special case is handled for data windows with a sample standard deviation $s_x$ below a small tolerance $\\varepsilon$, which are immediately classified as non-Gaussian. This correctly identifies degenerate or near-degenerate windows that lack the variance to be meaningfully compared to a normal distribution.\n\nBased on this binary decision (Gaussian or non-Gaussian), the parameter $k_0$ is dynamically adjusted according to a feedback control rule. If the window is deemed Gaussian, $k_0$ is increased by a step $\\eta_{\\uparrow}$, reflecting confidence that a stronger (and more efficient) bias potential can be applied. Conversely, if non-Gaussian characteristics are detected, $k_0$ is decreased by a step $\\eta_{\\downarrow}$, a corrective action to reduce the biasing strength and steer the system back towards a regime where the Gaussian approximation holds. The parameter $k_0$ is constrained to lie within a predefined range $[k_{0,\\min}, k_{0,\\max}]$ using a clamping function, ensuring its stability.\n\nThe implementation involves the following steps for each test case:\n1.  Generation of the synthetic time series $(X_t)_{t=1}^{N}$ of length $N$ according to the specified distribution ($\\mathcal{N}(0,1)$, $\\mathrm{Laplace}(0,1)$, or mixtures thereof) using a seeded pseudorandom number generator for reproducibility.\n2.  Initialization of the parameter $k_0$ to its starting value $k_0^{(0)}$.\n3.  Iteration over the time series using a rolling window of width $W$ and stride $S$.\n4.  Within each window, computation of the sample standard deviation $s_x$. If $s_x \\le \\varepsilon = 10^{-12}$, the window is classified as non-Gaussian. Otherwise, the data are $z$-scored, and both $p_{\\mathrm{KS}}$ and $\\rho$ are computed.\n5.  Application of the decision rule: the window is accepted as Gaussian if and only if $p_{\\mathrm{KS}} \\ge \\alpha$ and $\\rho \\le \\tau$.\n6.  Updating $k_0$ based on the decision using the update rule $k_0 \\leftarrow k_0 + \\eta_{\\uparrow}$ (Gaussian) or $k_0 \\leftarrow k_0 - \\eta_{\\downarrow}$ (non-Gaussian), followed by clamping to the interval $[k_{0,\\min}, k_{0,\\max}]$.\n7.  The final value of $k_0$ after processing all windows is reported, rounded to six decimal places.\n\nThis entire procedure is encapsulated in a program that processes five distinct test cases, each designed to probe different aspects of the algorithm's behavior, such as its response to purely Gaussian data, heavy-tailed data, mixed data, and degenerate data.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import kstest, norm\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the final results.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"name\": \"Case 1 (Gaussian baseline growth)\",\n            \"generation_type\": \"gaussian\",\n            \"seed\": 20240501,\n            \"N\": 2000, \"W\": 200, \"S\": 100,\n            \"alpha\": 1e-6, \"tau\": 0.075,\n            \"k0_init\": 0.3, \"eta_up\": 0.02, \"eta_down\": 0.05,\n            \"k0_min\": 0.05, \"k0_max\": 0.99,\n            \"epsilon\": 1e-12\n        },\n        {\n            \"name\": \"Case 2 (Heavy-tailed suppression)\",\n            \"generation_type\": \"laplace\",\n            \"seed\": 20240502,\n            \"N\": 2000, \"W\": 200, \"S\": 100,\n            \"alpha\": 1e-6, \"tau\": 0.075,\n            \"k0_init\": 0.8, \"eta_up\": 0.02, \"eta_down\": 0.05,\n            \"k0_min\": 0.05, \"k0_max\": 0.99,\n            \"epsilon\": 1e-12\n        },\n        {\n            \"name\": \"Case 3 (Block mixture with non-overlapping windows)\",\n            \"generation_type\": \"block_mixture\",\n            \"seed\": 20240503,\n            \"N\": 1000, \"W\": 200, \"S\": 200,\n            \"alpha\": 1e-6, \"tau\": 0.075,\n            \"k0_init\": 0.4, \"eta_up\": 0.1, \"eta_down\": 0.2,\n            \"k0_min\": 0.1, \"k0_max\": 0.9,\n            \"epsilon\": 1e-12\n        },\n        {\n            \"name\": \"Case 4 (Degenerate zero-variance windows)\",\n            \"generation_type\": \"degenerate\",\n            \"seed\": None, # No randomness needed\n            \"N\": 200, \"W\": 50, \"S\": 25,\n            \"alpha\": 1e-6, \"tau\": 0.075,\n            \"k0_init\": 0.2, \"eta_up\": 0.01, \"eta_down\": 0.03,\n            \"k0_min\": 0.05, \"k0_max\": 0.99,\n            \"epsilon\": 1e-12\n        },\n        {\n            \"name\": \"Case 5 (Alternating blocks)\",\n            \"generation_type\": \"alternating_blocks\",\n            \"seed\": 20240505,\n            \"N\": 1200, \"W\": 200, \"S\": 200,\n            \"alpha\": 1e-6, \"tau\": 0.075,\n            \"k0_init\": 0.5, \"eta_up\": 0.05, \"eta_down\": 0.05,\n            \"k0_min\": 0.05, \"k0_max\": 0.95,\n            \"epsilon\": 1e-12\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        final_k0 = run_simulation_case(params)\n        results.append(f\"{final_k0:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef run_simulation_case(params):\n    \"\"\"\n    Runs a single simulation case for GaMD k0 parameter adjustment.\n    \n    Args:\n        params (dict): A dictionary containing all parameters for the simulation.\n        \n    Returns:\n        float: The final value of k0 after processing all windows.\n    \"\"\"\n    # Unpack parameters from the dictionary\n    N, W, S = params[\"N\"], params[\"W\"], params[\"S\"]\n    alpha, tau, epsilon = params[\"alpha\"], params[\"tau\"], params[\"epsilon\"]\n    k0_init, eta_up, eta_down = params[\"k0_init\"], params[\"eta_up\"], params[\"eta_down\"]\n    k0_min, k0_max = params[\"k0_min\"], params[\"k0_max\"]\n    seed = params[\"seed\"]\n    generation_type = params[\"generation_type\"]\n    \n    # --- 1. Generate Time Series X_t ---\n    if seed is not None:\n        rng = np.random.default_rng(seed)\n\n    if generation_type == \"gaussian\":\n        X = rng.normal(loc=0, scale=1, size=N)\n    elif generation_type == \"laplace\":\n        X = rng.laplace(loc=0, scale=1, size=N)\n    elif generation_type == \"block_mixture\":\n        n_gauss = int(np.floor(0.6 * N))\n        n_laplace = N - n_gauss\n        X_gauss = rng.normal(loc=0, scale=1, size=n_gauss)\n        X_laplace = rng.laplace(loc=0, scale=1, size=n_laplace)\n        X = np.concatenate((X_gauss, X_laplace))\n    elif generation_type == \"alternating_blocks\":\n        num_blocks = N // W\n        blocks = []\n        for i in range(num_blocks):\n            if i % 2 == 0:  # Gaussian block\n                blocks.append(rng.normal(loc=0, scale=1, size=W))\n            else:  # Laplace block\n                blocks.append(rng.laplace(loc=0, scale=1, size=W))\n        X = np.concatenate(blocks)\n    elif generation_type == \"degenerate\":\n        X = np.zeros(N)\n    \n    k0 = k0_init\n\n    # --- 2. Rolling Window Analysis ---\n    for t_start in range(0, N - W + 1, S):\n        window = X[t_start : t_start + W]\n        \n        # Use ddof=1 for sample standard deviation, as is standard.\n        s_x = np.std(window, ddof=1)\n        \n        is_gaussian = False\n        if s_x  epsilon:\n            # Z-score the window data\n            x_mean = np.mean(window)\n            z_scores = (window - x_mean) / s_x\n            \n            # Kolmogorov-Smirnov test against standard normal distribution\n            _, p_ks = kstest(z_scores, 'norm')\n            \n            # Root-mean-square quantile residual (rho)\n            n_samples = len(z_scores)\n            z_ordered = np.sort(z_scores)\n            \n            # Theoretical quantiles q_i\n            i = np.arange(1, n_samples + 1)\n            p_i = (i - 0.5) / n_samples\n            q_i = norm.ppf(p_i)\n            \n            rho = np.sqrt(np.mean((z_ordered - q_i)**2))\n            \n            # Gaussianity decision - both conditions must be met\n            if rho = tau and p_ks = alpha:\n                is_gaussian = True\n        \n        # If s_x = epsilon, the window is considered non-Gaussian by definition.\n        \n        # --- 3. Update and Clamp k0 ---\n        if is_gaussian:\n            k0 += eta_up\n        else:\n            k0 -= eta_down\n            \n        k0 = np.clip(k0, k0_min, k0_max)\n        \n    return k0\n\nsolve()\n```", "id": "3393748"}]}