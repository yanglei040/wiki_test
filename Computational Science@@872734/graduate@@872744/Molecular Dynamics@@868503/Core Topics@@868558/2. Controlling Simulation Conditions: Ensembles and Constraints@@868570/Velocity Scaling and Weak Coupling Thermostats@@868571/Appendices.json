{"hands_on_practices": [{"introduction": "The foundation of any thermostat is the quantity it seeks to control: the temperature. In a molecular simulation, the instantaneous kinetic temperature is not a given but must be calculated from the particle velocities and the equipartition theorem. This exercise [@problem_id:3459751] provides practice in this fundamental calculation, emphasizing how to correctly account for all contributing degrees of freedom—including translational and rotational motion—and subtract those removed by system constraints. Mastering this skill is critical for ensuring the accuracy of any temperature-controlled simulation.", "problem": "Consider a Molecular Dynamics (MD) simulation of an ensemble of $N_{m}$ identical rigid linear molecules in a periodic cubic box. The MD integrator removes the global center-of-mass drift at every timestep, which is equivalent to constraining the total linear momentum of the system to zero. The instantaneous kinetic temperature $T_{\\mathrm{kin}}$ used by a velocity-scaling weak-coupling thermostat is defined by equating the instantaneous total kinetic energy of all thermostatted quadratic degrees of freedom to the thermal energy.\n\nFor a rigid linear molecule, the kinetic energy consists of translational and rotational parts. The rotational energy includes rotation about two perpendicular axes through the center of mass; rotation about the molecular axis does not contribute because the moment of inertia about that axis is negligible at the classical level.\n\nFrom a single instantaneous configuration, you recorded the following quantities:\n- The translational sum $S_{v} \\equiv \\sum_{i=1}^{N_{m}} m_{i}\\,|\\mathbf{v}_{i}|^{2} = 6.60 \\times 10^{-18}$ J.\n- The rotational sum $S_{\\omega} \\equiv \\sum_{i=1}^{N_{m}} \\boldsymbol{\\omega}_{i}^{\\top}\\mathbf{I}_{i}\\,\\boldsymbol{\\omega}_{i} = 4.17 \\times 10^{-18}$ J.\n\nAssume $N_{m} = 512$, and that only the global center-of-mass constraint is applied (no other global constraints). The Boltzmann constant is $k_{B} = 1.380649 \\times 10^{-23}$ J K$^{-1}$.\n\nStarting from first principles and appropriate degree-of-freedom counting for rigid linear molecules, compute the instantaneous kinetic temperature $T_{\\mathrm{kin}}$ consistent with a velocity-scaling weak-coupling thermostat. Round your answer to four significant figures and express the temperature in Kelvin.", "solution": "The problem will first be validated for scientific soundness, self-consistency, and clarity before a solution is attempted.\n\n### Step 1: Extract Givens\n\n- Number of molecules: $N_{m} = 512$\n- Molecular type: Identical rigid linear molecules\n- Constraint: Total linear momentum is zero ($\\sum_{i=1}^{N_{m}} m_{i} \\mathbf{v}_{i} = \\mathbf{0}$)\n- Rotational degrees of freedom per molecule: $2$ (rotation about the molecular axis is negligible)\n- Translational sum: $S_{v} \\equiv \\sum_{i=1}^{N_{m}} m_{i}\\,|\\mathbf{v}_{i}|^{2} = 6.60 \\times 10^{-18}$ J\n- Rotational sum: $S_{\\omega} \\equiv \\sum_{i=1}^{N_{m}} \\boldsymbol{\\omega}_{i}^{\\top}\\mathbf{I}_{i}\\,\\boldsymbol{\\omega}_{i} = 4.17 \\times 10^{-18}$ J\n- Boltzmann constant: $k_{B} = 1.380649 \\times 10^{-23}$ J K$^{-1}$\n- Definition of instantaneous kinetic temperature ($T_{\\mathrm{kin}}$): The quantity that satisfies the relation between the total instantaneous kinetic energy of thermostatted degrees of freedom and the thermal energy, analogous to the equipartition theorem.\n\n### Step 2: Validate Using Extracted Givens\n\nThe problem is evaluated against the required criteria:\n\n- **Scientifically Grounded**: The problem is rooted in the fundamental principles of classical statistical mechanics and molecular dynamics (MD) simulations. The concepts of kinetic energy, degrees of freedom, constraints, and the definition of kinetic temperature for a thermostat are all standard and well-established in the field.\n- **Well-Posed**: All necessary data ($N_m$, $S_v$, $S_\\omega$, $k_B$) and conditions (rigid linear molecules, zero total momentum) are provided to compute a unique value for the instantaneous kinetic temperature.\n- **Objective**: The problem is stated using precise, quantitative language, free from ambiguity or subjective claims.\n\nThe problem does not exhibit any of the listed flaws. It is a standard, self-contained physics problem that requires careful counting of degrees of freedom, a common task in statistical mechanics. The provided numerical values are physically plausible for a nanoscale simulation.\n\n### Step 3: Verdict and Action\n\nThe problem statement is **valid**. A solution will be provided.\n\n### Solution\n\nThe instantaneous kinetic temperature, $T_{\\mathrm{kin}}$, is defined by relating the total instantaneous kinetic energy of the system, $K_{\\mathrm{total}}$, to the number of available (thermostatted) quadratic degrees of freedom, $N_{\\mathrm{dof}}$. This relationship is an instantaneous application of the equipartition theorem:\n$$K_{\\mathrm{total}} = \\frac{1}{2} N_{\\mathrm{dof}} k_{B} T_{\\mathrm{kin}}$$\nTo find $T_{\\mathrm{kin}}$, we must first determine $K_{\\mathrm{total}}$ and $N_{\\mathrm{dof}}$ from the provided information.\n\n**1. Calculation of the Total Instantaneous Kinetic Energy ($K_{\\mathrm{total}}$)**\n\nThe total kinetic energy is the sum of the translational and rotational kinetic energies of all molecules:\n$$K_{\\mathrm{total}} = K_{\\mathrm{trans}} + K_{\\mathrm{rot}}$$\nThe translational kinetic energy, $K_{\\mathrm{trans}}$, is given by $K_{\\mathrm{trans}} = \\sum_{i=1}^{N_{m}} \\frac{1}{2} m_{i} |\\mathbf{v}_{i}|^{2}$. Using the provided translational sum $S_{v} = \\sum_{i=1}^{N_{m}} m_{i} |\\mathbf{v}_{i}|^{2}$, we have:\n$$K_{\\mathrm{trans}} = \\frac{1}{2} S_{v}$$\nThe rotational kinetic energy, $K_{\\mathrm{rot}}$, for a system of rigid bodies is given by $K_{\\mathrm{rot}} = \\sum_{i=1}^{N_{m}} \\frac{1}{2} \\boldsymbol{\\omega}_{i}^{\\top}\\mathbf{I}_{i}\\,\\boldsymbol{\\omega}_{i}$. Using the provided rotational sum $S_{\\omega} = \\sum_{i=1}^{N_{m}} \\boldsymbol{\\omega}_{i}^{\\top}\\mathbf{I}_{i}\\,\\boldsymbol{\\omega}_{i}$, we have:\n$$K_{\\mathrm{rot}} = \\frac{1}{2} S_{\\omega}$$\nTherefore, the total instantaneous kinetic energy is:\n$$K_{\\mathrm{total}} = \\frac{1}{2} S_{v} + \\frac{1}{2} S_{\\omega} = \\frac{1}{2} (S_{v} + S_{\\omega})$$\nSubstituting the given values:\n$$S_{v} = 6.60 \\times 10^{-18} \\, \\mathrm{J}$$\n$$S_{\\omega} = 4.17 \\times 10^{-18} \\, \\mathrm{J}$$\n$$K_{\\mathrm{total}} = \\frac{1}{2} (6.60 \\times 10^{-18} \\, \\mathrm{J} + 4.17 \\times 10^{-18} \\, \\mathrm{J}) = \\frac{1}{2} (10.77 \\times 10^{-18} \\, \\mathrm{J}) = 5.385 \\times 10^{-18} \\, \\mathrm{J}$$\n\n**2. Calculation of the Number of Degrees of Freedom ($N_{\\mathrm{dof}}$)**\n\nThe number of thermostatted degrees of freedom is the total number of quadratic terms in the kinetic energy expression, minus the number of constraints applied to the system.\n\nFor a system of $N_{m}$ identical rigid linear molecules:\n- Each molecule has $3$ translational degrees of freedom, associated with motion of its center of mass in three-dimensional space.\n- Each molecule has $2$ rotational degrees of freedom, as rotation about the principal axis aligned with the molecule is classically negligible.\nThus, the total number of degrees of freedom for an unconstrained system would be $(3 + 2)N_m = 5 N_m$.\n\nThe problem states that a constraint is applied: the global center-of-mass drift is removed. This is equivalent to setting the total linear momentum of the system to zero:\n$$\\sum_{i=1}^{N_{m}} m_{i} \\mathbf{v}_{i} = \\mathbf{0}$$\nThis is a vector equation, which imposes $3$ independent scalar constraints on the system's velocities (one for each Cartesian component $x, y, z$). These constraints reduce the number of translational degrees of freedom by $3$. The rotational degrees of freedom are unaffected by this constraint.\n\nTherefore, the number of thermostatted degrees of freedom is:\n$$N_{\\mathrm{dof}} = (\\text{Total DoF}) - (\\text{Number of Constraints})$$\n$$N_{\\mathrm{dof}} = (3 N_{m} + 2 N_{m}) - 3 = 5 N_{m} - 3$$\nSubstituting the given value $N_{m} = 512$:\n$$N_{\\mathrm{dof}} = 5(512) - 3 = 2560 - 3 = 2557$$\n\n**3. Calculation of the Instantaneous Kinetic Temperature ($T_{\\mathrm{kin}}$)**\n\nWe now rearrange the defining equation for $T_{\\mathrm{kin}}$:\n$$T_{\\mathrm{kin}} = \\frac{2 K_{\\mathrm{total}}}{N_{\\mathrm{dof}} k_{B}}$$\nSubstituting the calculated values for $K_{\\mathrm{total}}$, $N_{\\mathrm{dof}}$, and the given value for $k_{B}$:\n$$K_{\\mathrm{total}} = 5.385 \\times 10^{-18} \\, \\mathrm{J}$$\n$$N_{\\mathrm{dof}} = 2557$$\n$$k_{B} = 1.380649 \\times 10^{-23} \\, \\mathrm{J}\\,\\mathrm{K}^{-1}$$\n$$T_{\\mathrm{kin}} = \\frac{2 \\times (5.385 \\times 10^{-18})}{2557 \\times (1.380649 \\times 10^{-23})} = \\frac{1.077 \\times 10^{-17}}{3.530347 \\times 10^{-19}} \\, \\mathrm{K}$$\n$$T_{\\mathrm{kin}} \\approx 305.068... \\, \\mathrm{K}$$\n\nThe problem requires the answer to be rounded to four significant figures.\n$$T_{\\mathrm{kin}} \\approx 305.1 \\, \\mathrm{K}$$\nThis is the instantaneous kinetic temperature of the system consistent with the definitions used by a weak-coupling thermostat.", "answer": "$$\n\\boxed{305.1}\n$$", "id": "3459751"}, {"introduction": "Once the system's temperature is known, a weak-coupling thermostat guides it towards the desired setpoint using a first-order relaxation scheme. This practice [@problem_id:3459750] delves into the dynamics of this process, requiring you to model the exponential decay of temperature deviation over discrete time steps. Solving this problem will provide a concrete, quantitative understanding of the role of the coupling time constant, $\\tau_T$, and how it dictates the timescale for thermal equilibration in a simulation.", "problem": "In a constant-temperature Molecular Dynamics (MD) simulation using a weak coupling (Berendsen) thermostat, the instantaneous kinetic temperature is defined by the equipartition theorem as proportional to the total kinetic energy, so that scaling all velocities by a factor $\\lambda$ scales the temperature by $\\lambda^{2}$. The weak coupling thermostat is designed to impose a first-order relaxation of the kinetic temperature toward a target temperature $T_{0}$ with relaxation time $\\tau_{T}$. Consider a time discretization with time step $\\Delta t$, and let $T_{n}$ denote the kinetic temperature after $n$ thermostat applications, with initial value $T(0)=T_i$.\n\nStarting from the fundamental laws of Newtonian mechanics together with the equipartition theorem and the principle of first-order relaxation toward the target temperature implemented by a velocity-rescaling step at each discrete time, derive the discrete-time update relation for $T_{n}$ and solve it in closed form to obtain $T_{n}$ as a function of $n$, $T_{i}$, $T_{0}$, $\\Delta t$, and $\\tau_{T}$. Then determine the minimal integer number of steps $n$ required to ensure $\\lvert T_{n}-T_{0}\\rvert\\le \\varepsilon$.\n\nUse the following physically realistic parameters: $T_{0}=300\\,\\mathrm{K}$, $T_{i}=800\\,\\mathrm{K}$, $\\Delta t=2\\,\\mathrm{fs}$, $\\tau_{T}=0.2\\,\\mathrm{ps}$, and $\\varepsilon=2\\,\\mathrm{K}$. Report only the minimal integer $n$ as your final answer. No rounding by significant figures is required beyond the determination of this minimal integer. Express any intermediate temperatures in $\\mathrm{K}$ and times in $\\mathrm{fs}$ or $\\mathrm{ps}$ as appropriate.", "solution": "The problem is valid as it is scientifically grounded in the principles of molecular dynamics and statistical mechanics, is well-posed with a clear objective and sufficient data, and is formulated objectively.\n\nThe Berendsen thermostat is designed to enforce a first-order kinetic relaxation of the system's temperature $T$ towards a target temperature $T_{0}$ with a characteristic relaxation time $\\tau_{T}$. The underlying continuous dynamics are described by the differential equation:\n$$\n\\frac{dT}{dt} = \\frac{T_{0} - T}{\\tau_{T}}\n$$\nIn a Molecular Dynamics simulation with a discrete time step $\\Delta t$, a simple forward Euler discretization of this equation provides the update rule for the temperature at step $n+1$, denoted $T_{n+1}$, based on the temperature at step $n$, denoted $T_{n}$:\n$$\n\\frac{T_{n+1} - T_{n}}{\\Delta t} = \\frac{T_{0} - T_{n}}{\\tau_{T}}\n$$\nThis can be rearranged to express $T_{n+1}$ directly:\n$$\nT_{n+1} = T_{n} + \\frac{\\Delta t}{\\tau_{T}} (T_{0} - T_{n})\n$$\nThis update is physically implemented by scaling all particle velocities by a factor $\\lambda$ at each step. The kinetic temperature $T$ is proportional to the total kinetic energy, which is a quadratic function of the velocities. Therefore, scaling velocities by $\\lambda$ scales the temperature by $\\lambda^{2}$: $T_{n+1} = \\lambda_{n}^{2} T_{n}$. The scaling factor $\\lambda_{n}$ is chosen to satisfy the discretized relaxation equation.\n\nLet's define the constant ratio $r = \\frac{\\Delta t}{\\tau_{T}}$. The recurrence relation becomes:\n$$\nT_{n+1} = T_{n} + r(T_{0} - T_{n}) = (1-r)T_{n} + rT_{0}\n$$\nThis is a first-order linear non-homogeneous recurrence relation. To solve it, we can find the fixed point by setting $T_{n+1} = T_{n} = T_{eq}$, which gives $T_{eq} = (1-r)T_{eq} + rT_{0}$, leading to $rT_{eq} = rT_{0}$, so the equilibrium temperature is $T_{eq} = T_{0}$ as expected.\n\nLet's define a new variable $\\delta_{n} = T_{n} - T_{0}$, representing the deviation from the target temperature. Substituting $T_{n} = \\delta_{n} + T_{0}$ into the recurrence relation:\n$$\n(\\delta_{n+1} + T_{0}) = (1-r)(\\delta_{n} + T_{0}) + rT_{0}\n$$\n$$\n\\delta_{n+1} + T_{0} = (1-r)\\delta_{n} + (1-r)T_{0} + rT_{0}\n$$\n$$\n\\delta_{n+1} + T_{0} = (1-r)\\delta_{n} + T_{0}\n$$\n$$\n\\delta_{n+1} = (1-r)\\delta_{n}\n$$\nThis is a simple geometric progression. The solution is $\\delta_{n} = (1-r)^{n} \\delta_{0}$.\nThe initial deviation is $\\delta_{0} = T(0) - T_{0} = T_{i} - T_{0}$, where $T_{i}$ is the initial temperature.\nSubstituting back, we get the expression for the deviation at step $n$:\n$$\nT_{n} - T_{0} = (T_{i} - T_{0})(1-r)^{n}\n$$\nThe closed-form solution for $T_{n}$ is therefore:\n$$\nT_{n} = T_{0} + (T_{i} - T_{0}) \\left( 1 - \\frac{\\Delta t}{\\tau_{T}} \\right)^{n}\n$$\nThe problem requires finding the minimal integer number of steps $n$ to ensure that the absolute difference between the system temperature and the target temperature is less than or equal to a tolerance $\\varepsilon$:\n$$\n|T_{n} - T_{0}| \\le \\varepsilon\n$$\nUsing the derived expression for $T_{n} - T_{0}$:\n$$\n\\left| (T_{i} - T_{0}) \\left( 1 - \\frac{\\Delta t}{\\tau_{T}} \\right)^{n} \\right| \\le \\varepsilon\n$$\nThe given parameters are:\n- Initial temperature $T_{i}=800\\,\\mathrm{K}$\n- Target temperature $T_{0}=300\\,\\mathrm{K}$\n- Time step $\\Delta t=2\\,\\mathrm{fs}$\n- Relaxation time $\\tau_{T}=0.2\\,\\mathrm{ps} = 200\\,\\mathrm{fs}$\n- Temperature tolerance $\\varepsilon=2\\,\\mathrm{K}$\n\nFirst, let's evaluate the terms. The initial temperature difference is $T_{i} - T_{0} = 800\\,\\mathrm{K} - 300\\,\\mathrm{K} = 500\\,\\mathrm{K}$. This is positive.\nThe ratio of time scales is $r = \\frac{\\Delta t}{\\tau_{T}} = \\frac{2\\,\\mathrm{fs}}{200\\,\\mathrm{fs}} = 0.01$.\nThe term $(1 - \\frac{\\Delta t}{\\tau_{T}}) = 1 - 0.01 = 0.99$. This term is positive and less than $1$.\nSo, the inequality can be written without the absolute value signs:\n$$\n(T_{i} - T_{0}) \\left( 1 - \\frac{\\Delta t}{\\tau_{T}} \\right)^{n} \\le \\varepsilon\n$$\nWe need to solve for $n$:\n$$\n\\left( 1 - \\frac{\\Delta t}{\\tau_{T}} \\right)^{n} \\le \\frac{\\varepsilon}{T_{i} - T_{0}}\n$$\nTaking the natural logarithm of both sides:\n$$\nn \\ln\\left( 1 - \\frac{\\Delta t}{\\tau_{T}} \\right) \\le \\ln\\left( \\frac{\\varepsilon}{T_{i} - T_{0}} \\right)\n$$\nSince $1 - \\frac{\\Delta t}{\\tau_{T}}  1$, its logarithm is negative. Therefore, when we divide by $\\ln(1 - \\frac{\\Delta t}{\\tau_{T}})$, we must reverse the inequality sign:\n$$\nn \\ge \\frac{\\ln\\left( \\frac{\\varepsilon}{T_{i} - T_{0}} \\right)}{\\ln\\left( 1 - \\frac{\\Delta t}{\\tau_{T}} \\right)}\n$$\nNow, we substitute the numerical values:\n$$\nn \\ge \\frac{\\ln\\left( \\frac{2}{800 - 300} \\right)}{\\ln\\left( 1 - \\frac{2}{200} \\right)}\n$$\n$$\nn \\ge \\frac{\\ln\\left( \\frac{2}{500} \\right)}{\\ln\\left( 1 - 0.01 \\right)}\n$$\n$$\nn \\ge \\frac{\\ln(0.004)}{\\ln(0.99)}\n$$\nUsing a calculator for the values of the logarithms:\n$$\n\\ln(0.004) \\approx -5.52146\n$$\n$$\n\\ln(0.99) \\approx -0.01005\n$$\nSo, the inequality for $n$ is:\n$$\nn \\ge \\frac{-5.52146}{-0.01005} \\approx 549.399\n$$\nSince $n$ must be an integer representing the number of simulation steps, we must take the smallest integer that satisfies this condition. This is the ceiling of the calculated value.\n$$\nn_{min} = \\lceil 549.399 \\rceil = 550\n$$\nThus, a minimum of $550$ thermostat applications (steps) are required to bring the temperature deviation within the specified tolerance.", "answer": "$$\n\\boxed{550}\n$$", "id": "3459750"}, {"introduction": "While simple and effective for reaching a target temperature, weak-coupling thermostats are known to introduce artifacts that can perturb the system's natural dynamics, as they do not generate a rigorous canonical ensemble. This advanced computational exercise [@problem_id:3459717] challenges you to quantify this effect by measuring the bias introduced into a time-correlation function. By implementing and comparing a deterministic scaling thermostat against a more rigorous stochastic one, you will gain firsthand experience with the limitations of weak-coupling methods and their implications for measuring dynamical observables.", "problem": "Consider a system of $N$ independent point particles evolving under Newton's laws in three spatial dimensions. Each particle of mass $m$ is subject to an isotropic harmonic confinement with angular frequency $\\omega_i$ (possibly different across particles), so that for particle $i$ and Cartesian component $x$, Newton's second law gives $m \\frac{d^2 x_i}{dt^2} = - m \\omega_i^2 x_i$. A numerical integrator can exploit the exact harmonic solution over a time increment $\\Delta t$ as a symplectic, time-reversible mapping based on the fundamental relations $\\frac{dx}{dt} = v$ and $m \\frac{dv}{dt} = - m \\omega^2 x$. Assume a canonical ensemble at target temperature $T_0$ in reduced units with Boltzmann constant $k_B = 1$ and mass $m = 1$. The instantaneous kinetic temperature is defined by the equipartition theorem as $T(t) = \\frac{2 K(t)}{f}$, where $K(t) = \\frac{1}{2}\\sum_{i=1}^N \\sum_{\\alpha \\in \\{x,y,z\\}} v_{i,\\alpha}^2$ is the total kinetic energy at time $t$, and $f = 3N$ is the number of Cartesian degrees of freedom.\n\nYou will implement two distinct global thermostats that act on velocities after each harmonic update at each time step:\n- A deterministic weak-coupling (velocity scaling) thermostat that relaxes the instantaneous kinetic temperature $T(t)$ toward $T_0$ with a characteristic coupling time $\\tau_T$.\n- A stochastic rescaling thermostat that enforces a global Ornstein–Uhlenbeck update on the velocities with relaxation time $\\tau_T$, preserving the canonical velocity distribution while adding Gaussian noise consistent with the target temperature $T_0$.\n\nDefine the convective energy flux along the $x$ direction as the scalar observable $J_x(t) = \\sum_{i=1}^N e_i(t)\\, v_{i,x}(t)$, where $e_i(t)$ is the per-particle energy used for convection; in this idealized non-interacting setting, take $e_i(t) = \\frac{1}{2}\\sum_{\\alpha \\in \\{x,y,z\\}} v_{i,\\alpha}(t)^2$. The equilibrated time-correlation function of the flux is $C_{JJ}(t) = \\langle J_x(0)\\, J_x(t) \\rangle$, with the average interpreted as a time average over a long, stationary trajectory starting from equilibrium. The Green–Kubo relation motivates the study of the integral $I(\\tau_T; t_{\\max}) = \\int_0^{t_{\\max}} C_{JJ}(t)\\, dt$, which we evaluate numerically over a finite window $[0, t_{\\max}]$ to diagnose dynamical bias introduced by thermostats. Work in reduced units with $m=1$, $k_B=1$, and $T_0=1$, and express $t$ in reduced time units; the final numerical quantities are dimensionless.\n\nStarting only from the above fundamental laws and definitions, perform the following tasks:\n1. Derive the explicit discrete-time velocity update for each thermostat in terms of $\\Delta t$, $\\tau_T$, $T_0$, and the current velocities, consistent with the given physical principles. Do not assume or use any pre-specified shortcut formulas beyond the definitions and fundamental relations stated above.\n2. Construct an algorithm that:\n   - Samples initial positions and velocities from the canonical distribution at temperature $T_0$ for the harmonic trap. For each particle $i$, use the same angular frequency $\\omega_i$ for all three Cartesian components, and draw $\\omega_i$ from a fixed distribution to ensure dephasing across particles.\n   - Advances the system for a total of $M$ steps of size $\\Delta t$ using the exact harmonic update for positions and velocities, followed immediately by the chosen thermostat’s velocity update.\n   - Records the stationary time series $J_x(t_n)$ after a brief initial equilibration discard, computes $C_{JJ}(t)$ with an unbiased estimator based on time averages, and numerically approximates $I(\\tau_T; t_{\\max})$ using a Riemann sum with step $\\Delta t$.\n3. Using the same initial conditions for a fair comparison, evaluate $I(\\tau_T; t_{\\max})$ for both thermostats and for a reference trajectory with no thermostat (i.e., $\\tau_T \\to \\infty$). Define the bias as $b(\\tau_T) = \\frac{I(\\tau_T; t_{\\max}) - I(\\infty; t_{\\max})}{I(\\infty; t_{\\max})}$ for each thermostat.\n\nYour program must implement the above algorithm in reduced units and produce numerical biases for a prescribed test suite. Use the following test parameters:\n- Number of particles $N = 300$, degrees of freedom $f = 900$.\n- Time step $\\Delta t = 0.002$.\n- Total steps $M = 50000$.\n- Equilibration discard $M_{\\mathrm{eq}} = 5000$ steps; only the subsequent $M_{\\mathrm{prod}} = M - M_{\\mathrm{eq}}$ steps are used for correlation estimation.\n- Angular frequencies $\\omega_i$ independently drawn once at initialization from a uniform distribution on $[3.0, 7.0]$.\n- Target temperature $T_0 = 1.0$.\n- Correlation integration window $t_{\\max} = 2.0$ (in reduced time units).\n- Thermostat coupling times to test: $\\tau_T \\in \\{\\infty, 5.0, 0.5, 0.05\\}$ (in reduced time units).\n\nFor each $\\tau_T$ in the test suite, compute two biases:\n- $b_{\\mathrm{det}}(\\tau_T)$ for the deterministic weak-coupling thermostat.\n- $b_{\\mathrm{sto}}(\\tau_T)$ for the stochastic rescaling thermostat.\n\nNumerically approximate all integrals using the Riemann sum with step $\\Delta t$. Your program should produce a single line of output containing the biases for the four $\\tau_T$ values as a comma-separated list of pairs enclosed in square brackets, in the order of the test suite and in the exact format:\n\"[[b_det_tau_inf,b_sto_tau_inf],[b_det_tau_5.0,b_sto_tau_5.0],[b_det_tau_0.5,b_sto_tau_0.5],[b_det_tau_0.05,b_sto_tau_0.05]]\"\nAll reported biases must be expressed as decimal numbers with no units.\n\nThe problem requires demonstrating, through simulation consistent with the above derivations, that deterministic velocity scaling and stochastic rescaling differentially bias the time-correlation function and its Green–Kubo integral as a function of $\\tau_T$, including the boundary case $\\tau_T \\to \\infty$ and a strong-coupling edge case $\\tau_T = 0.05$.", "solution": "The problem is assessed as valid as it is scientifically grounded in established principles of statistical mechanics and molecular dynamics, is well-posed with all necessary parameters and definitions provided, and is stated in objective, formal language. We proceed with the solution, beginning with the required derivations.\n\n### 1. Derivations of Physical and Algorithmic Components\n\n#### 1.1. Exact Integrator for the Harmonic Oscillator\nFor a particle of mass $m$ in a harmonic potential with angular frequency $\\omega$, the equation of motion for a single Cartesian component is $m \\frac{d^2 x}{dt^2} = -m \\omega^2 x$. With $m=1$, this simplifies to $\\frac{d^2 x}{dt^2} = -\\omega^2 x$. This second-order ordinary differential equation (ODE) can be written as a system of two first-order ODEs:\n$$\n\\frac{dx}{dt} = v\n$$\n$$\n\\frac{dv}{dt} = -\\omega^2 x\n$$\nThis linear system has the general solution:\n$$\nx(t) = x(0) \\cos(\\omega t) + \\frac{v(0)}{\\omega} \\sin(\\omega t)\n$$\n$$\nv(t) = -\\omega x(0) \\sin(\\omega t) + v(0) \\cos(\\omega t)\n$$\nwhere $x(0)$ and $v(0)$ are the position and velocity at the beginning of a time interval. To propagate the system over a discrete time step $\\Delta t$, we substitute $t = \\Delta t$ to obtain the exact update map from the state $(x_n, v_n)$ at time $t_n$ to the state $(x_{n+1}, v_{n+1})$ at time $t_{n+1} = t_n + \\Delta t$:\n$$\nx_{n+1} = x_n \\cos(\\omega \\Delta t) + \\frac{v_n}{\\omega} \\sin(\\omega \\Delta t)\n$$\n$$\nv_{n+1} = v_n \\cos(\\omega \\Delta t) - x_n \\omega \\sin(\\omega \\Delta t)\n$$\nThis update is applied independently to each Cartesian component of each particle, using the particle-specific angular frequency $\\omega_i$.\n\n#### 1.2. Deterministic Weak-Coupling (Velocity Scaling) Thermostat\nThis thermostat, also known as the Berendsen thermostat, forces the system's temperature towards a target value $T_0$ by directly scaling velocities. The temperature relaxation is governed by the first-order differential equation:\n$$\n\\frac{dT}{dt} = \\frac{1}{\\tau_T} (T_0 - T(t))\n$$\nwhere $T(t)$ is the instantaneous kinetic temperature and $\\tau_T$ is the coupling time constant. Discretizing this over a time step $\\Delta t$, the temperature at the next step, $T(t+\\Delta t)$, is approximated as:\n$$\nT(t+\\Delta t) \\approx T(t) + \\frac{\\Delta t}{\\tau_T} (T_0 - T(t))\n$$\nVelocities are scaled by a factor $\\lambda$ such that $\\vec{v}_{\\text{new}} = \\lambda \\vec{v}_{\\text{old}}$. The kinetic energy $K = \\frac{1}{2} m \\sum v^2$ scales as $K_{\\text{new}} = \\lambda^2 K_{\\text{old}}$. Since the temperature is defined as $T = 2K/f$ (with $f$ being the number of degrees of freedom), the temperature also scales quadratically: $T_{\\text{new}} = \\lambda^2 T_{\\text{old}}$.\nEquating the two expressions for the new temperature, we have:\n$$\n\\lambda^2 T(t) = T(t) + \\frac{\\Delta t}{\\tau_T} (T_0 - T(t))\n$$\nSolving for $\\lambda^2$:\n$$\n\\lambda^2 = 1 + \\frac{\\Delta t}{\\tau_T} \\left(\\frac{T_0}{T(t)} - 1\\right)\n$$\nThe velocity scaling factor $\\lambda$ is therefore:\n$$\n\\lambda = \\sqrt{1 + \\frac{\\Delta t}{\\tau_T} \\left(\\frac{T_0}{T(t)} - 1\\right)}\n$$\nAfter each harmonic update step, all particle velocities $\\vec{v}_{i}$ are updated to $\\lambda \\vec{v}_{i}$. For the case $\\tau_T \\to \\infty$, $\\lambda \\to 1$, and no velocity scaling occurs.\n\n#### 1.3. Stochastic Rescaling Thermostat\nThe problem specifies a global Ornstein-Uhlenbeck (OU) update. The OU process describes the velocity of a particle undergoing Langevin dynamics. For a single velocity component $v$ in a thermal bath, the stochastic differential equation (SDE) is:\n$$\ndv = -\\frac{v}{\\tau_T} dt + \\sqrt{\\frac{2 k_B T_0}{m \\tau_T}} dW_t\n$$\nwhere $\\tau_T$ is the relaxation time and $dW_t$ is a Wiener process. This SDE has an exact solution over a time interval $\\Delta t$. The velocity $v(t+\\Delta t)$ conditional on $v(t)$ is a Gaussian random variable with mean and variance given by:\n$$\nv(t+\\Delta t) = v(t) e^{-\\Delta t/\\tau_T} + \\sqrt{\\frac{k_B T_0}{m} \\left(1 - e^{-2\\Delta t/\\tau_T}\\right)} \\mathcal{N}(0,1)\n$$\nwhere $\\mathcal{N}(0,1)$ is a standard normal random variable. This update is applied independently to each velocity component $\\{v_{i,x}, v_{i,y}, v_{i,z}\\}$ for all particles $i=1, \\dots, N$, requiring $3N$ independent random numbers at each step.\nIn reduced units ($m=1, k_B=1, T_0=1$), the update rule simplifies to:\n$$\nv_{\\text{new}} = v_{\\text{old}} \\, c_1 + c_2 \\, \\mathcal{N}(0,1)\n$$\nwith coefficients $c_1 = e^{-\\Delta t/\\tau_T}$ and $c_2 = \\sqrt{1 - e^{-2\\Delta t/\\tau_T}}$. For the case $\\tau_T \\to \\infty$, $c_1 \\to 1$ and $c_2 \\to 0$, resulting in $v_{\\text{new}} = v_{\\text{old}}$, which corresponds to no thermostat.\n\n### 2. Algorithmic and Computational Procedure\n\n#### 2.1. Initialization\n1.  **Parameters**: Set $N=300$, $m=1$, $k_B=1$, $T_0=1$, $\\Delta t=0.002$.\n2.  **Frequencies**: For each particle $i=1, \\dots, N$, draw an angular frequency $\\omega_i$ from a uniform distribution $U[3.0, 7.0]$.\n3.  **Initial Positions**: For each particle $i$ and component $\\alpha \\in \\{x,y,z\\}$, sample the position $r_{i,\\alpha}$ from the canonical distribution for a harmonic oscillator. This is a Gaussian distribution with mean $0$ and variance $\\sigma_{r,i}^2 = \\langle r_{i,\\alpha}^2 \\rangle = \\frac{k_B T_0}{m \\omega_i^2} = \\frac{1}{\\omega_i^2}$.\n4.  **Initial Velocities**: For each velocity component $v_{i,\\alpha}$, sample from the Maxwell-Boltzmann distribution, which is a Gaussian with mean $0$ and variance $\\sigma_v^2 = \\langle v_{i,\\alpha}^2 \\rangle = \\frac{k_B T_0}{m} = 1$.\n5.  A single set of initial frequencies, positions, and velocities is generated and stored. This same initial state is used for all subsequent simulation runs to ensure a fair comparison.\n\n#### 2.2. Simulation\nThe simulation is run for each specified $\\tau_T$ and for each thermostat type.\n1.  Load the common initial state (positions `r`, velocities `v`, frequencies `omega`).\n2.  Initialize an empty list to store the time series of the flux, `j_series`.\n3.  Loop for a total of $M=50000$ steps:\n    a.  **Harmonic Update**: Update all positions and velocities using the exact harmonic integrator equations derived in Section 1.1.\n    b.  **Thermostat Update**: If a thermostat is active ($\\tau_T \\neq \\infty$), update all velocities according to the rules derived in Section 1.2 or 1.3. For the reference case ($\\tau_T=\\infty$), this step is skipped.\n    c.  **Equilibration and Production**: If the current step number $n \\ge M_{\\mathrm{eq}} = 5000$:\n        i.  Calculate the instantaneous convective flux $J_x(t_n) = \\sum_{i=1}^N \\left(\\frac{1}{2}\\sum_{\\alpha \\in \\{x,y,z\\}} v_{i,\\alpha}^2 \\right) v_{i,x}$.\n        ii. Append this value to `j_series`.\n\n#### 2.3. Data Analysis\nAfter the production run of $M_{\\mathrm{prod}} = 45000$ steps is complete:\n1.  **Correlation Function**: Compute the time-autocorrelation function $C_{JJ}(t_k) = \\langle J_x(0) J_x(t_k) \\rangle$ for time lags $t_k = k \\Delta t$. The time average is estimated using an unbiased estimator:\n    $$\n    C_{JJ}(t_k) = \\frac{1}{M_{\\mathrm{prod}}-k} \\sum_{n=0}^{M_{\\mathrm{prod}}-1-k} J_x(t_n) J_x(t_{n+k})\n    $$\n    This is calculated for lags $k$ from $0$ up to $k_{\\max} = t_{\\max} / \\Delta t = 2.0 / 0.002 = 1000$. This calculation is performed efficiently using a Fast Fourier Transform (FFT) based correlation algorithm.\n2.  **Integral**: Numerically approximate the Green-Kubo integral $I(\\tau_T; t_{\\max}) = \\int_0^{t_{\\max}} C_{JJ}(t) dt$ using a left-point Riemann sum:\n    $$\n    I(\\tau_T; t_{\\max}) \\approx \\sum_{k=0}^{k_{\\max}-1} C_{JJ}(t_k) \\, \\Delta t\n    $$\n3.  **Bias Calculation**: First, the reference integral $I(\\infty; t_{\\max})$ is computed from the simulation with no thermostat. For each thermostat (`det`, `sto`) and each finite coupling time $\\tau_T \\in \\{5.0, 0.5, 0.05\\}$, the corresponding integral $I(\\tau_T; t_{\\max})$ is calculated. The bias is then computed as:\n    $$\n    b(\\tau_T) = \\frac{I(\\tau_T; t_{\\max}) - I(\\infty; t_{\\max})}{I(\\infty; t_{\\max})}\n    $$\n    For the case $\\tau_T=\\infty$, the bias is by definition $b(\\infty) = 0$ for both thermostats. The final results are collected and formatted as specified.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.signal import correlate\n\ndef solve():\n    \"\"\"\n    Implements the simulation and analysis to compute thermostat-induced biases\n    on a Green-Kubo-like integral.\n    \"\"\"\n    #\n    # --- 1. Simulation Parameters ---\n    #\n    N = 300  # Number of particles\n    F = 3 * N  # Degrees of freedom\n    DT = 0.002  # Time step\n    M = 50000  # Total steps\n    M_EQ = 5000  # Equilibration steps\n    M_PROD = M - M_EQ  # Production steps\n    T0 = 1.0  # Target temperature (kB=1)\n    M_MASS = 1.0  # Particle mass\n    T_MAX = 2.0  # Correlation integration window\n    K_MAX = int(T_MAX / DT)\n    \n    TAU_T_VALUES = [np.inf, 5.0, 0.5, 0.05]\n    RNG = np.random.default_rng(seed=42)  # For reproducibility\n\n    #\n    # --- 2. Initial Condition Generation ---\n    #\n    def generate_initial_state():\n        \"\"\"Generates a single set of initial conditions to be reused.\"\"\"\n        omega_i = RNG.uniform(3.0, 7.0, size=N)\n        \n        # Positions from canonical distribution for harmonic oscillator\n        sigma_r = 1.0 / omega_i\n        r0 = RNG.normal(0.0, sigma_r[:, np.newaxis], size=(N, 3))\n        \n        # Velocities from Maxwell-Boltzmann distribution\n        sigma_v = np.sqrt(T0 / M_MASS)\n        v0 = RNG.normal(0.0, sigma_v, size=(N, 3))\n        \n        return r0.copy(), v0.copy(), omega_i.copy()\n\n    initial_state = generate_initial_state()\n\n    #\n    # --- 3. Core Simulation Logic ---\n    #\n    def run_simulation(thermostat, tau_T, r_init, v_init, omega_i):\n        \"\"\"Runs a single MD simulation and returns the integrated correlation.\"\"\"\n        r, v = r_init.copy(), v_init.copy()\n        \n        # Precompute constants for harmonic integrator\n        cos_dt = np.cos(omega_i * DT)[:, np.newaxis]\n        sin_dt_div_omega = (np.sin(omega_i * DT) / omega_i)[:, np.newaxis]\n        omega_sin_dt = (omega_i * np.sin(omega_i * DT))[:, np.newaxis]\n        \n        # Precompute constants for stochastic thermostat if used\n        if thermostat == 'sto' and np.isfinite(tau_T):\n            c1 = np.exp(-DT / tau_T)\n            c2 = np.sqrt(1 - np.exp(-2 * DT / tau_T))\n\n        j_series = np.zeros(M_PROD)\n        \n        for step in range(M):\n            # --- a. Harmonic Update (Exact Integrator) ---\n            r_old = r.copy()\n            r = r * cos_dt + v * sin_dt_div_omega\n            v = v * cos_dt - r_old * omega_sin_dt\n            \n            # --- b. Thermostat Update ---\n            if thermostat == 'det' and np.isfinite(tau_T):\n                kin_energy = 0.5 * M_MASS * np.sum(v**2)\n                temp = (2.0 * kin_energy) / F\n                if temp  1e-9: # Avoid division by zero\n                    lambda_sq = 1.0 + (DT / tau_T) * (T0 / temp - 1.0)\n                    scaling_factor = np.sqrt(max(0.0, lambda_sq)) # Ensure non-negative\n                    v *= scaling_factor\n            \n            elif thermostat == 'sto' and np.isfinite(tau_T):\n                noise = RNG.normal(0.0, 1.0, size=(N, 3))\n                v = v * c1 + c2 * noise\n\n            # --- c. Data Collection (Production Run) ---\n            if step = M_EQ:\n                idx = step - M_EQ\n                particle_ke = 0.5 * M_MASS * np.sum(v**2, axis=1)\n                j_series[idx] = np.sum(particle_ke * v[:, 0])\n\n        # --- d. Post-processing: Correlation and Integral ---\n        # Use FFT for efficient correlation calculation\n        # The result of correlate is C[k] = sum_n x[n+k] * conj(y[n])\n        # We need C_JJ[k] = J(n)J(n+k). The raw correlation sum is at index M_PROD-1-k\n        corr_full = correlate(j_series, j_series, mode='full', method='fft')\n        \n        C_jj = np.zeros(K_MAX)\n        for k in range(K_MAX):\n            # Unbiased estimator normalization\n            if M_PROD - k  0:\n                C_jj[k] = corr_full[M_PROD - 1 - k] / (M_PROD - k)\n        \n        # Riemann sum for the integral\n        integral = np.sum(C_jj) * DT\n        \n        return integral\n\n    #\n    # --- 4. Main Execution and Bias Calculation ---\n    #\n    results = []\n    \n    # Run reference simulation (no thermostat, tau_T = infinity)\n    r0, v0, omega = initial_state\n    I_ref = run_simulation('none', np.inf, r0, v0, omega)\n\n    for tau_T in TAU_T_VALUES:\n        if np.isinf(tau_T):\n            # By definition, bias is zero for the reference case.\n            b_det = 0.0\n            b_sto = 0.0\n        else:\n            # Deterministic thermostat\n            I_det = run_simulation('det', tau_T, r0, v0, omega)\n            b_det = (I_det - I_ref) / I_ref if abs(I_ref)  1e-12 else 0.0\n\n            # Stochastic thermostat\n            I_sto = run_simulation('sto', tau_T, r0, v0, omega)\n            b_sto = (I_sto - I_ref) / I_ref if abs(I_ref)  1e-12 else 0.0\n            \n        results.append([b_det, b_sto])\n\n    #\n    # --- 5. Final Output Formatting ---\n    #\n    output_str = f\"[{','.join(f'[{b1},{b2}]' for b1, b2 in results)}]\"\n    print(output_str)\n\nsolve()\n```", "id": "3459717"}]}