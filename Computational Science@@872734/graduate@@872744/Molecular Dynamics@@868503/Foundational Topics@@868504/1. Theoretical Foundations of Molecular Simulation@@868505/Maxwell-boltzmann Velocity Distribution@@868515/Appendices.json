{"hands_on_practices": [{"introduction": "A deep understanding of the Maxwell-Boltzmann distribution requires appreciating some of its mathematical subtleties. A common point of confusion is the distinction between the kinetic energy of a particle moving at the most probable speed and the most probable kinetic energy itself. This exercise clarifies this apparent paradox, which arises from the non-linear transformation between the speed and energy variables, reinforcing the importance of the Jacobian in changing probability density functions. Resolving this will sharpen your intuition for how statistical distributions behave under transformation [@problem_id:1978855].", "problem": "Consider an ideal gas composed of a large number of identical, non-interacting classical particles of mass $m$ in thermal equilibrium at an absolute temperature $T$. In three dimensions, the probability distribution of the particle speeds, $v$, is given by the Maxwell-Boltzmann speed distribution function:\n$$f(v) = 4\\pi \\left(\\frac{m}{2\\pi k_B T}\\right)^{3/2} v^2 \\exp\\left(-\\frac{mv^2}{2k_B T}\\right)$$\nwhere $k_B$ is the Boltzmann constant. This function $f(v)$ is defined such that $f(v)dv$ is the probability that a particle has a speed in the interval $[v, v+dv]$.\n\nThe most probable speed, $v_p$, is the speed at which this distribution function $f(v)$ reaches its maximum value. This corresponds to a kinetic energy $K_p = \\frac{1}{2}mv_p^2$.\n\nWe can also consider the distribution of kinetic energies, $E = \\frac{1}{2}mv^2$. Let the kinetic energy distribution function be $g(E)$, where $g(E)dE$ is the probability that a particle has kinetic energy in the interval $[E, E+dE]$. The most probable kinetic energy, $E_p$, is the energy at which this function $g(E)$ reaches its maximum value.\n\nYour task is to calculate the exact value of the dimensionless ratio $\\frac{E_p}{K_p}$.", "solution": "We begin by determining the most probable speed from the given Maxwell-Boltzmann speed distribution. Write\n$$\nf(v)=A\\,v^{2}\\exp\\!\\left(-a v^{2}\\right),\n$$\nwhere $A=4\\pi \\left(\\frac{m}{2\\pi k_{B}T}\\right)^{3/2}$ and $a=\\frac{m}{2k_{B}T}$. The most probable speed $v_{p}$ satisfies $\\frac{df}{dv}=0$. Differentiating,\n$$\n\\frac{df}{dv}=A\\exp\\!\\left(-a v^{2}\\right)\\left(2v-2a v^{3}\\right)=2A v\\exp\\!\\left(-a v^{2}\\right)\\left(1-a v^{2}\\right).\n$$\nSetting this to zero gives either $v=0$ or $1-a v^{2}=0$. The nontrivial maximum occurs at\n$$\nv_{p}^{2}=\\frac{1}{a}=\\frac{2k_{B}T}{m},\\quad\\text{so}\\quad K_{p}=\\frac{1}{2}m v_{p}^{2}=\\frac{1}{2}m\\cdot\\frac{2k_{B}T}{m}=k_{B}T.\n$$\n\nNext, we find the most probable kinetic energy from the energy distribution. Let $E=\\frac{1}{2}m v^{2}$ and define $g(E)$ by $g(E)\\,dE=f(v)\\,dv$. Using $v=\\sqrt{\\frac{2E}{m}}$ and\n$$\n\\frac{dv}{dE}=\\frac{1}{m v}=\\frac{1}{\\sqrt{2mE}},\n$$\nwe obtain\n$$\ng(E)=f\\!\\left(\\sqrt{\\frac{2E}{m}}\\right)\\frac{dv}{dE}\n=4\\pi\\left(\\frac{m}{2\\pi k_{B}T}\\right)^{3/2}\\left(\\frac{2E}{m}\\right)\\exp\\!\\left(-\\frac{E}{k_{B}T}\\right)\\cdot\\frac{1}{\\sqrt{2mE}}.\n$$\nSimplifying the $E$-dependent factor,\n$$\n\\left(\\frac{2E}{m}\\right)\\frac{1}{\\sqrt{2mE}}=\\frac{\\sqrt{2}}{m^{3/2}}\\sqrt{E},\n$$\nand simplifying the constants,\n$$\ng(E)=4\\pi\\sqrt{2}\\left(\\frac{1}{2\\pi k_{B}T}\\right)^{3/2}\\sqrt{E}\\,\\exp\\!\\left(-\\frac{E}{k_{B}T}\\right)\n=\\frac{2}{\\sqrt{\\pi}}\\frac{1}{(k_{B}T)^{3/2}}\\sqrt{E}\\,\\exp\\!\\left(-\\frac{E}{k_{B}T}\\right).\n$$\nThus $g(E)=C\\,E^{1/2}\\exp\\!\\left(-\\frac{E}{k_{B}T}\\right)$ with $C=\\frac{2}{\\sqrt{\\pi}}(k_{B}T)^{-3/2}$. To find the most probable energy $E_{p}$, maximize $g(E)$ for $E>0$. It is convenient to maximize $\\ln g(E)$:\n$$\n\\ln g(E)=\\ln C+\\frac{1}{2}\\ln E-\\frac{E}{k_{B}T},\\quad \\frac{d}{dE}\\ln g(E)=\\frac{1}{2E}-\\frac{1}{k_{B}T}.\n$$\nSetting the derivative to zero,\n$$\n\\frac{1}{2E_{p}}=\\frac{1}{k_{B}T}\\quad\\Longrightarrow\\quad E_{p}=\\frac{1}{2}k_{B}T.\n$$\n\nFinally, the ratio is\n$$\n\\frac{E_{p}}{K_{p}}=\\frac{\\frac{1}{2}k_{B}T}{k_{B}T}=\\frac{1}{2}.\n$$", "answer": "$$\\boxed{\\frac{1}{2}}$$", "id": "1978855"}, {"introduction": "Moving from conceptual clarity to practical application, a core task in any molecular simulation is the assignment of initial velocities that correctly represent a system at a given temperature. This practice provides direct experience in this fundamental procedure, first by deriving the Maxwell-Boltzmann distribution for a two-dimensional system from first principles, and then by implementing a computational algorithm to sample from this distribution. By validating the computational results against your derived analytical predictions, you will build and test a cornerstone component of molecular dynamics software [@problem_id:2456611].", "problem": "You are asked to derive, implement, and validate a physically consistent initial velocity assignment procedure for atoms confined to a two-dimensional surface using the Maxwell–Boltzmann (MB) framework. Your goal is to (i) derive the two-dimensional MB speed distribution from first principles and (ii) write a complete program that samples initial velocities consistent with this distribution and validates the sampling by comparing statistics against analytical predictions.\n\nYour derivation must begin from fundamental base principles and definitions that are appropriate for equilibrium statistical mechanics and classical molecular motion:\n- The Boltzmann factor for kinetic energy, proportional to $\\exp\\!\\left(-E/(k_\\mathrm{B} T)\\right)$, where $E$ is the energy, $k_\\mathrm{B}$ is the Boltzmann constant, and $T$ is the absolute temperature.\n- The idealized kinetic energy of a particle of mass $m$ moving with velocity components $\\{v_x, v_y\\}$ in two dimensions is $E = \\tfrac{1}{2} m \\left(v_x^2 + v_y^2\\right)$.\n- Independence of orthogonal degrees of freedom (DOF) in the kinetic energy for a classical ideal gas at equilibrium.\n- Change-of-variables for probability density functions, including the Jacobian determinant.\n\nDo not use, cite, or assume the target two-dimensional MB speed distribution or any intermediate closed-form distribution for speed; you must derive it explicitly from the above base. Your derivation must lead to a normalized speed distribution in two dimensions and the analytic expression for the mean speed $\\langle v \\rangle$.\n\nAfter the derivation, implement a complete, runnable program that:\n- Samples initial velocities $\\{v_x, v_y\\}$ for $N$ atoms residing on a two-dimensional surface at absolute temperature $T$ and mass $m$, consistent with the derived two-dimensional MB speed distribution.\n- Uses a pseudo-random number generator with a fixed seed $314159$ for reproducibility.\n- Computes the following validation metrics for each test case:\n  1. The sample mean speed $\\overline{v}$ in $\\mathrm{m/s}$.\n  2. The absolute error in $\\mathrm{m/s}$ between $\\overline{v}$ and the theoretical mean speed $\\langle v \\rangle$ implied by your derivation.\n  3. The Kolmogorov–Smirnov (KS) statistic comparing the empirical speed distribution to the analytical two-dimensional MB speed distribution for speed (expressed equivalently as a Rayleigh distribution with an appropriate scale).\n  4. A boolean indicating whether equipartition holds per DOF within relative tolerance $\\varepsilon = 5\\times 10^{-3}$, i.e., whether both $\\left|\\frac{\\tfrac{1}{2} m \\overline{v_x^2} - \\tfrac{1}{2} k_\\mathrm{B} T}{\\tfrac{1}{2} k_\\mathrm{B} T}\\right| \\le \\varepsilon$ and $\\left|\\frac{\\tfrac{1}{2} m \\overline{v_y^2} - \\tfrac{1}{2} k_\\mathrm{B} T}{\\tfrac{1}{2} k_\\mathrm{B} T}\\right| \\le \\varepsilon$.\n\nUse the following constants and units:\n- Boltzmann constant $k_\\mathrm{B} = 1.380\\,649 \\times 10^{-23}\\ \\mathrm{J/K}$.\n- Mass $m$ in $\\mathrm{kg}$, temperature $T$ in $\\mathrm{K}$, velocity in $\\mathrm{m/s}$, kinetic energy in $\\mathrm{J}$.\n\nTest suite:\n- Case $1$: $m = 6.633\\,520\\,9 \\times 10^{-26}\\ \\mathrm{kg}$, $T = 300$, $N = 100\\,000$.\n- Case $2$: $m = 1.673\\,557\\,5 \\times 10^{-27}\\ \\mathrm{kg}$, $T = 300$, $N = 100\\,000$.\n- Case $3$: $m = 6.633\\,520\\,9 \\times 10^{-26}\\ \\mathrm{kg}$, $T = 1$, $N = 100\\,000$.\n\nProgram requirements:\n- The program must be self-contained and require no input.\n- For each case, compute the four validation metrics listed above. For floats, round to $6$ decimal places. For the boolean, print either $\\mathrm{True}$ or $\\mathrm{False}$.\n- Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with entries ordered as\n  $[\\overline{v}_1,\\ \\Delta_1,\\ D_1,\\ b_1,\\ \\overline{v}_2,\\ \\Delta_2,\\ D_2,\\ b_2,\\ \\overline{v}_3,\\ \\Delta_3,\\ D_3,\\ b_3]$,\n  where $\\overline{v}_i$ is the sample mean speed for case $i$ in $\\mathrm{m/s}$, $\\Delta_i$ is the absolute error in $\\mathrm{m/s}$, $D_i$ is the KS statistic, and $b_i$ is the equipartition boolean.\n\nExpress all speeds in $\\mathrm{m/s}$ and energies in $\\mathrm{J}$. Angles are not used. Percentages, if any, must be expressed as decimals (e.g., $0.03$ for three percent).\n\nYour final answer must be a single complete program that adheres to the specified execution environment and produces exactly one line as described.", "solution": "The problem posed is valid. It is scientifically grounded in the principles of statistical mechanics, well-posed with all necessary information provided, and objective in its formulation. We shall proceed with the derivation and implementation as requested.\n\n**1. Derivation of the Two-Dimensional Maxwell-Boltzmann Distribution**\n\n**1.1. Velocity Component Distribution**\nWe begin with the fundamental principles of classical statistical mechanics for an ideal gas at thermal equilibrium. The probability of a particle having a specific state is proportional to the Boltzmann factor, $\\exp(-E/(k_\\mathrm{B} T))$, where $E$ is the energy of the state, $k_\\mathrm{B}$ is the Boltzmann constant, and $T$ is the absolute temperature. For a particle of mass $m$ confined to a two-dimensional surface, the kinetic energy $E$ is given in terms of its Cartesian velocity components $\\{v_x, v_y\\}$ as:\n$$\nE = \\frac{1}{2}m(v_x^2 + v_y^2)\n$$\nThe velocity components $v_x$ and $v_y$ represent independent, orthogonal degrees of freedom. Therefore, the joint probability density function (PDF) for the velocity vector, $f(v_x, v_y)$, can be expressed as the product of the individual PDFs for each component, $f_x(v_x)$ and $f_y(v_y)$. The energy can be decomposed as $E = E_x + E_y$, where $E_x = \\frac{1}{2}mv_x^2$ and $E_y = \\frac{1}{2}mv_y^2$.\nThe PDF for the $v_x$ component is thus proportional to the Boltzmann factor for its corresponding energy:\n$$\nf_x(v_x) \\propto \\exp\\left(-\\frac{E_x}{k_\\mathrm{B} T}\\right) = \\exp\\left(-\\frac{m v_x^2}{2 k_\\mathrm{B} T}\\right)\n$$\nTo obtain a normalized PDF, we introduce a normalization constant $A$ and enforce the condition that the total probability is unity:\n$$\n\\int_{-\\infty}^{\\infty} f_x(v_x) dv_x = A \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{m v_x^2}{2 k_\\mathrm{B} T}\\right) dv_x = 1\n$$\nThis is a standard Gaussian integral of the form $\\int_{-\\infty}^{\\infty} e^{-ax^2} dx = \\sqrt{\\pi/a}$. With $a = m/(2 k_\\mathrm{B} T)$, the integral evaluates to $\\sqrt{2\\pi k_\\mathrm{B} T/m}$.\nSolving for $A$:\n$$\nA = \\left(\\frac{m}{2\\pi k_\\mathrm{B} T}\\right)^{1/2}\n$$\nThe normalized PDF for $v_x$ is a Gaussian distribution with mean $0$ and variance $\\sigma_v^2 = k_\\mathrm{B} T/m$:\n$$\nf_x(v_x) = \\left(\\frac{m}{2\\pi k_\\mathrm{B} T}\\right)^{1/2} \\exp\\left(-\\frac{m v_x^2}{2 k_\\mathrm{B} T}\\right)\n$$\nBy symmetry, the PDF for $v_y$ is identical. The joint PDF for the velocity components is:\n$$\nf(v_x, v_y) = f_x(v_x) f_y(v_y) = \\frac{m}{2\\pi k_\\mathrm{B} T} \\exp\\left(-\\frac{m(v_x^2 + v_y^2)}{2 k_\\mathrm{B} T}\\right)\n$$\n\n**1.2. Speed Distribution**\nTo find the distribution of the speed $v = \\sqrt{v_x^2 + v_y^2}$, we transform the velocity components from Cartesian coordinates $(v_x, v_y)$ to polar coordinates $(v, \\theta)$, where $v$ is the speed ($v \\ge 0$) and $\\theta$ is the direction angle. The transformation is given by $v_x = v \\cos\\theta$ and $v_y = v \\sin\\theta$.\nThe differential area element transforms as $dv_x dv_y = |J| dv d\\theta$, where $J$ is the Jacobian determinant of the transformation:\n$$\nJ = \\det \\begin{pmatrix} \\frac{\\partial v_x}{\\partial v} & \\frac{\\partial v_x}{\\partial \\theta} \\\\ \\frac{\\partial v_y}{\\partial v} & \\frac{\\partial v_y}{\\partial \\theta} \\end{pmatrix} = \\det \\begin{pmatrix} \\cos\\theta & -v\\sin\\theta \\\\ \\sin\\theta & v\\cos\\theta \\end{pmatrix} = v\\cos^2\\theta + v\\sin^2\\theta = v\n$$\nThe joint PDF in polar coordinates, $g(v, \\theta)$, is found by substituting the coordinate transformation into $f(v_x, v_y)$ and multiplying by the Jacobian:\n$$\ng(v, \\theta) dv d\\theta = f(v\\cos\\theta, v\\sin\\theta) v dv d\\theta = \\frac{m}{2\\pi k_\\mathrm{B} T} \\exp\\left(-\\frac{mv^2}{2 k_\\mathrm{B} T}\\right) v dv d\\theta\n$$\nThe PDF for speed, $P(v)$, is obtained by integrating $g(v, \\theta)$ over all possible angles $\\theta \\in [0, 2\\pi]$:\n$$\nP(v) = \\int_0^{2\\pi} \\frac{m}{2\\pi k_\\mathrm{B} T} v \\exp\\left(-\\frac{mv^2}{2 k_\\mathrm{B} T}\\right) d\\theta = 2\\pi \\left(\\frac{m}{2\\pi k_\\mathrm{B} T}\\right) v \\exp\\left(-\\frac{mv^2}{2 k_\\mathrm{B} T}\\right)\n$$\nThis simplifies to the two-dimensional Maxwell-Boltzmann speed distribution:\n$$\nP(v) = \\frac{m}{k_\\mathrm{B} T} v \\exp\\left(-\\frac{mv^2}{2 k_\\mathrm{B} T}\\right) \\quad \\text{for } v \\geq 0\n$$\nThis is a Rayleigh distribution with scale parameter $\\sigma = \\sqrt{k_\\mathrm{B} T / m}$.\n\n**1.3. Mean Speed**\nThe mean speed, $\\langle v \\rangle$, is the expectation value of $v$ with respect to the distribution $P(v)$:\n$$\n\\langle v \\rangle = \\int_0^{\\infty} v P(v) dv = \\int_0^{\\infty} v \\left(\\frac{m}{k_\\mathrm{B} T}\\right) v \\exp\\left(-\\frac{mv^2}{2 k_\\mathrm{B} T}\\right) dv = \\frac{m}{k_\\mathrm{B} T} \\int_0^{\\infty} v^2 \\exp\\left(-\\frac{mv^2}{2 k_\\mathrm{B} T}\\right) dv\n$$\nThis integral has the form $\\int_0^{\\infty} x^2 e^{-ax^2} dx = \\frac{1}{4}\\sqrt{\\frac{\\pi}{a^3}}$. Here, $a = m/(2 k_\\mathrm{B} T)$.\nSubstituting $a$ into the solution of the integral gives:\n$$\n\\int_0^{\\infty} v^2 \\exp\\left(-\\frac{mv^2}{2 k_\\mathrm{B} T}\\right) dv = \\frac{1}{4} \\sqrt{\\frac{\\pi}{(m/2k_\\mathrm{B} T)^3}} = \\frac{1}{4} \\sqrt{\\frac{8\\pi (k_\\mathrm{B} T)^3}{m^3}} = \\frac{\\sqrt{2\\pi}}{2} \\frac{(k_\\mathrm{B} T)^{3/2}}{m^{3/2}}\n$$\nSubstituting this back into the expression for $\\langle v \\rangle$:\n$$\n\\langle v \\rangle = \\frac{m}{k_\\mathrm{B} T} \\left(\\frac{\\sqrt{2\\pi}}{2} \\frac{(k_\\mathrm{B} T)^{3/2}}{m^{3/2}}\\right) = \\sqrt{\\frac{\\pi k_\\mathrm{B} T}{2m}}\n$$\nThis is the analytical expression for the mean speed in two dimensions.\n\n**2. Computational Validation Algorithm**\n\nThe computational procedure is designed to sample initial velocities for a system of $N$ atoms and validate the sample against the derived theoretical results.\n\n**2.1. Velocity Sampling**\nBased on the derivation, the velocity components $v_x$ and $v_y$ are independent and each follows a Gaussian (normal) distribution with a mean of $0$ and a variance of $\\sigma_v^2 = k_\\mathrm{B} T / m$. The standard deviation is thus $\\sigma_v = \\sqrt{k_\\mathrm{B} T / m}$.\nFor a system of $N$ particles, we generate $N$ values for $v_x$ and $N$ values for $v_y$ by drawing from this normal distribution using a pseudo-random number generator. A generator initialized with a fixed seed ensures reproducibility.\n\n**2.2. Validation Metrics Computation**\nFor each test case with specified mass $m$, temperature $T$, and number of particles $N$:\n1.  **Sample Mean Speed ($\\overline{v}$)**: After generating the velocity components $\\{v_{x,i}, v_{y,i}\\}$ for $i=1, \\dots, N$, the speed of each particle is computed as $v_i = \\sqrt{v_{x,i}^2 + v_{y,i}^2}$. The sample mean speed is the arithmetic average: $\\overline{v} = \\frac{1}{N} \\sum_{i=1}^N v_i$.\n2.  **Absolute Error ($\\Delta$)**: The absolute error between the sample mean speed and the theoretical mean speed is computed as $\\Delta = |\\overline{v} - \\langle v \\rangle|$, where $\\langle v \\rangle = \\sqrt{\\pi k_\\mathrm{B} T / (2m)}$.\n3.  **Kolmogorov-Smirnov (KS) Statistic ($D$)**: The empirical cumulative distribution function (CDF) of the sampled speeds is compared to the theoretical CDF of the 2D MB speed distribution. The latter is a Rayleigh distribution with scale parameter $\\sigma = \\sqrt{k_\\mathrm{B} T / m}$. The KS statistic $D$ is the maximum absolute difference between the two CDFs.\n4.  **Equipartition Check ($b$)**: The equipartition theorem states that the average kinetic energy per quadratic degree of freedom is $\\frac{1}{2} k_\\mathrm{B} T$. We verify this computationally by calculating the sample mean kinetic energies for each component, $\\langle E_x \\rangle = \\frac{1}{2}m \\overline{v_x^2}$ and $\\langle E_y \\rangle = \\frac{1}{2}m \\overline{v_y^2}$. The relative errors with respect to the theoretical value $\\frac{1}{2} k_\\mathrm{B} T$ are checked against the tolerance $\\varepsilon = 5 \\times 10^{-3}$. The condition is met if both relative errors are less than or equal to $\\varepsilon$.\n$$\n\\left|\\frac{\\frac{1}{2}m \\overline{v_x^2} - \\frac{1}{2}k_\\mathrm{B} T}{\\frac{1}{2}k_\\mathrm{B} T}\\right| \\le \\varepsilon \\quad \\text{and} \\quad \\left|\\frac{\\frac{1}{2}m \\overline{v_y^2} - \\frac{1}{2}k_\\mathrm{B} T}{\\frac{1}{2}k_\\mathrm{B} T}\\right| \\le \\varepsilon\n$$\nThe results of these computations are then formatted and reported as specified.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import stats\n\ndef solve():\n    \"\"\"\n    Derives, implements, and validates a 2D initial velocity assignment procedure\n    using the Maxwell-Boltzmann framework.\n    \"\"\"\n\n    # Define constants and test cases\n    K_B = 1.380649e-23  # Boltzmann constant in J/K\n    EPSILON = 5e-3        # Relative tolerance for equipartition check\n    SEED = 314159         # Seed for pseudo-random number generator\n\n    test_cases = [\n        # Case 1: Argon at 300 K\n        {'m': 6.6335209e-26, 'T': 300, 'N': 100000},\n        # Case 2: Hydrogen at 300 K\n        {'m': 1.6735575e-27, 'T': 300, 'N': 100000},\n        # Case 3: Argon at 1 K\n        {'m': 6.6335209e-26, 'T': 1, 'N': 100000},\n    ]\n\n    # Initialize the random number generator for reproducibility\n    rng = np.random.default_rng(SEED)\n\n    results = []\n\n    for case in test_cases:\n        m = case['m']\n        T = case['T']\n        N = case['N']\n\n        # 1. Sample initial velocities\n        # The velocity components vx and vy are independent and follow a\n        # a normal distribution with mean=0 and variance = k_B*T/m.\n        # The standard deviation is sqrt(k_B*T/m).\n        sigma_v = np.sqrt(K_B * T / m)\n        vx = rng.normal(loc=0.0, scale=sigma_v, size=N)\n        vy = rng.normal(loc=0.0, scale=sigma_v, size=N)\n\n        # 2. Compute sample speeds and statistics\n        speeds = np.sqrt(vx**2 + vy**2)\n        v_bar = np.mean(speeds)\n\n        # 3. Compute theoretical mean speed for 2D system\n        # ⟨v⟩ = sqrt(pi * k_B * T / (2 * m))\n        v_theory = np.sqrt(np.pi * K_B * T / (2 * m))\n\n        # 4. Calculate validation metrics\n\n        # Metric 1: Sample mean speed\n        sample_mean_speed = v_bar\n        \n        # Metric 2: Absolute error\n        abs_error = np.abs(sample_mean_speed - v_theory)\n\n        # Metric 3: Kolmogorov-Smirnov statistic\n        # The analytical distribution is a Rayleigh distribution with scale=sigma_v.\n        ks_result = stats.kstest(speeds, 'rayleigh', args=(0, sigma_v))\n        ks_statistic = ks_result.statistic\n\n        # Metric 4: Equipartition check\n        # Mean kinetic energy per degree of freedom should be 0.5 * k_B * T.\n        ke_x_mean = 0.5 * m * np.mean(vx**2)\n        ke_y_mean = 0.5 * m * np.mean(vy**2)\n        ke_theory = 0.5 * K_B * T\n\n        rel_err_x = np.abs((ke_x_mean - ke_theory) / ke_theory)\n        rel_err_y = np.abs((ke_y_mean - ke_theory) / ke_theory)\n        \n        equipartition_holds = (rel_err_x = EPSILON) and (rel_err_y = EPSILON)\n\n        # Append rounded floats and boolean to the results list\n        results.append(round(sample_mean_speed, 6))\n        results.append(round(abs_error, 6))\n        results.append(round(ks_statistic, 6))\n        results.append(equipartition_holds)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2456611"}, {"introduction": "Theoretical models in statistical mechanics often operate in the thermodynamic limit of infinite particles ($N \\to \\infty$), where particle velocities are truly independent. In contrast, computer simulations are always performed on finite systems, where global constraints can introduce subtle correlations. This practice investigates the profound effect of one such ubiquitous constraint: the removal of the system's center-of-mass motion. You will derive how this constraint modifies the single-particle velocity distribution, moving it away from the ideal Maxwellian form and providing a deeper appreciation for the finite-size effects inherent in molecular dynamics simulations [@problem_id:3424116].", "problem": "Consider a classical ensemble of $N$ point particles with masses $\\{m_1,m_2,\\dots,m_N\\}$ in three spatial dimensions at thermodynamic temperature $T$, with thermal equilibrium described by the canonical ensemble. Denote the Boltzmann constant by $k_{\\mathrm{B}}$. In the absence of any global constraints, the joint distribution of the Cartesian velocity components for all particles is a product of independent Gaussian distributions with zero mean, consistent with the Maxwell–Boltzmann distribution. In many molecular dynamics simulations, one removes global center-of-mass drift to focus on internal thermal motion by imposing the linear constraint $\\sum_{i=1}^{N} m_i \\mathbf{v}_i = \\mathbf{0}$, where $\\mathbf{v}_i \\in \\mathbb{R}^3$ is the velocity of particle $i$. Center of Mass (CM) refers to the mass-weighted average position; here the CM drift refers to the mass-weighted average velocity.  \n\nYour task is to derive, from first principles starting at the canonical ensemble and basic properties of multivariate Gaussian distributions, the single-particle velocity distribution $f(\\mathbf{v}_j)$ for a fixed particle index $j \\in \\{1,\\dots,N\\}$ conditioned on the CM constraint $\\sum_{i=1}^{N} m_i \\mathbf{v}_i = \\mathbf{0}$ for finite $N$. You should obtain a closed-form expression for the three-dimensional probability density function of $\\mathbf{v}_j$ under the constraint, and characterize how it differs from the unconstrained single-particle Maxwell–Boltzmann distribution. Maxwell–Boltzmann (MB) refers to the classical distribution of molecular velocities at equilibrium in the canonical ensemble.\n\nThen, using your derived expression, define and compute the following dimensionless quantities that quantify the effect of removing CM drift on the single-particle distribution:\n\n- The per-component variance reduction factor for particle $j$, defined as $r_j$, which is the ratio of the constrained per-Cartesian-component variance to the unconstrained per-Cartesian-component variance.\n- The Kullback–Leibler divergence (KLD) in nats, denoted $D_{\\mathrm{KL}}$, between the constrained single-particle velocity distribution and the unconstrained single-particle velocity distribution for particle $j$ (both taken as distributions over $\\mathbb{R}^3$ with zero mean). Kullback–Leibler (KL) divergence is a measure of how one probability distribution diverges from a second, reference probability distribution.\n- The ratio $R(v_0)$ of the constrained to unconstrained Maxwell speed densities evaluated at a specified scalar speed $v_0$ (with $v_0$ provided in $\\mathrm{m/s}$). For the speed $v = \\|\\mathbf{v}_j\\|$, the Maxwell speed density is the standard transformation of the three-dimensional Gaussian velocity vector distribution to the radial coordinate.\n\nExpress all intermediate derivations and final formulas in terms of $N$, $\\{m_i\\}$, $m_j$, $M = \\sum_{i=1}^{N} m_i$, $T$, and $k_{\\mathrm{B}}$.\n\nYour final program must implement these formulas and compute $r_j$, $D_{\\mathrm{KL}}$, and $R(v_0)$ for each of the following scientifically realistic test cases. Use the atomic mass unit $1\\,\\mathrm{amu} = 1.66053906660 \\times 10^{-27}\\,\\mathrm{kg}$ and the Argon atomic mass $39.948\\,\\mathrm{amu}$ where specified. All speeds $v_0$ are provided in $\\mathrm{m/s}$.\n\nTest Suite:\n1. Case A (Happy path, identical masses): $N = 10$, $m_i = 39.948\\,\\mathrm{amu}$ for all $i$, $T = 300$ (Kelvin), $j = 1$, $v_0 = 400$ (in $\\mathrm{m/s}$).\n2. Case B (Strong constraint effect, small $N$): $N = 2$, $m_i = 39.948\\,\\mathrm{amu}$ for all $i$, $T = 300$ (Kelvin), $j = 1$, $v_0 = 400$ (in $\\mathrm{m/s}$).\n3. Case C (Heterogeneous masses, heavy particle): $N = 3$, $(m_1,m_2,m_3) = (39.948\\,\\mathrm{amu}, 39.948\\,\\mathrm{amu}, 2 \\times 39.948\\,\\mathrm{amu})$, $T = 1000$ (Kelvin), $j = 3$, $v_0 = 1000$ (in $\\mathrm{m/s}$).\n4. Case D (Heterogeneous masses, light particle): $N = 3$, $(m_1,m_2,m_3) = (39.948\\,\\mathrm{amu}, 39.948\\,\\mathrm{amu}, 2 \\times 39.948\\,\\mathrm{amu})$, $T = 1000$ (Kelvin), $j = 1$, $v_0 = 1000$ (in $\\mathrm{m/s}$).\n5. Case E (Boundary toward large $N$): $N = 100$, $m_i = 39.948\\,\\mathrm{amu}$ for all $i$, $T = 300$ (Kelvin), $j = 51$, $v_0 = 400$ (in $\\mathrm{m/s}$).\n\nFor each case, your program must compute:\n- $r_j$\n- $D_{\\mathrm{KL}}$\n- $R(v_0)$\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test cases above, with each case contributing three consecutive floating-point numbers $[r_j, D_{\\mathrm{KL}}, R(v_0)]$. For example, the output format must be $[r_{A},D_{\\mathrm{KL},A},R_A,r_{B},D_{\\mathrm{KL},B},R_B,\\dots]$.", "solution": "## PROBLEM VALIDATION\n\n### Step 1: Extract Givens\n- **System**: A classical ensemble of $N$ point particles with masses $\\{m_1, m_2, \\dots, m_N\\}$ in three spatial dimensions.\n- **Thermodynamic State**: In thermal equilibrium at temperature $T$, described by the canonical ensemble.\n- **Constants**: Boltzmann constant is $k_{\\mathrm{B}}$.\n- **Unconstrained Distribution**: The joint distribution of Cartesian velocity components for all particles is a product of independent Gaussian distributions with zero mean.\n- **Constraint**: The center-of-mass (CM) drift is removed by imposing the linear constraint $\\sum_{i=1}^{N} m_i \\mathbf{v}_i = \\mathbf{0}$, where $\\mathbf{v}_i$ is the velocity of particle $i$.\n- **Task 1: Derivation**: Derive the single-particle velocity distribution $f(\\mathbf{v}_j)$ for a fixed particle index $j$ conditioned on the CM constraint.\n- **Task 2: Characterization**: Obtain a closed-form expression for $f(\\mathbf{v}_j)$ and characterize how it differs from the unconstrained Maxwell-Boltzmann distribution.\n- **Task 3: Computation**: Define and compute three dimensionless quantities:\n    1.  The per-component variance reduction factor, $r_j$: ratio of constrained to unconstrained per-Cartesian-component variance.\n    2.  The Kullback-Leibler divergence, $D_{\\mathrm{KL}}$: between the constrained and unconstrained single-particle velocity distributions for particle $j$.\n    3.  The ratio of speed densities, $R(v_0)$: ratio of constrained to unconstrained Maxwell speed densities evaluated at a scalar speed $v_0$.\n- **Required Variables for Formulas**: $N$, $\\{m_i\\}$, $m_j$, $M = \\sum_{i=1}^{N} m_i$, $T$, and $k_{\\mathrm{B}}$.\n- **Test Suite**: Five specific test cases with given parameters ($N$, masses, $T$, $j$, $v_0$).\n- **Constants for Tests**: $1\\,\\mathrm{amu} = 1.66053906660 \\times 10^{-27}\\,\\mathrm{kg}$, Argon atomic mass = $39.948\\,\\mathrm{amu}$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded (Critical)**: The problem is firmly rooted in classical statistical mechanics, specifically the kinetic theory of gases and the properties of the canonical ensemble. The Maxwell-Boltzmann distribution and the removal of center-of-mass motion are standard concepts in molecular dynamics simulations. The problem is scientifically sound.\n2.  **Well-Posed**: The problem asks for a derivation of a conditional probability distribution and related quantities based on a clear set of premises. The constraints and variables are well-defined, leading to a unique and meaningful solution.\n3.  **Objective (Critical)**: The problem is stated in precise, mathematical language, free from any subjectivity or opinion.\n4.  **Incomplete or Contradictory Setup**: The problem is self-contained. All necessary information (system description, constraint, quantities to be derived) is provided. There are no contradictions.\n5.  **Unrealistic or Infeasible**: The physical scenario (an ensemble of particles at equilibrium) is realistic. The constraint is a standard technique in computational physics. The parameters provided in the test suite are scientifically plausible for systems like noble gases.\n6.  **Ill-Posed or Poorly Structured**: The problem is structured logically, requesting a derivation followed by an application of the derived formulas. The solution is unique and stable.\n7.  **Pseudo-Profound, Trivial, or Tautological**: The problem requires a non-trivial derivation involving properties of multivariate Gaussian distributions and statistical mechanics, representing a substantive conceptual challenge.\n8.  **Outside Scientific Verifiability**: The derived results can be verified through standard mathematical and physical reasoning.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid** as it is scientifically sound, well-posed, objective, and complete. I will proceed with the full derivation and solution.\n\n---\n\n## DERIVATION AND SOLUTION\n\nThe solution proceeds by first establishing the unconstrained velocity distribution, then deriving the conditional distribution under the zero center-of-mass momentum constraint using properties of multivariate Gaussian distributions, and finally using this result to derive the requested quantities $r_j$, $D_{\\mathrm{KL}}$, and $R(v_0)$.\n\n### 1. Unconstrained Single-Particle Velocity Distribution\n\nIn the canonical ensemble at temperature $T$, the probability density of the system's state in velocity space is proportional to the Boltzmann factor, $e^{-\\beta K}$, where $\\beta = (k_{\\mathrm{B}}T)^{-1}$ and $K$ is the total kinetic energy.\nThe total kinetic energy is $K = \\sum_{i=1}^{N} \\frac{1}{2} m_i \\|\\mathbf{v}_i\\|^2 = \\sum_{i=1}^{N} \\sum_{\\alpha \\in \\{x,y,z\\}} \\frac{1}{2} m_i v_{i\\alpha}^2$.\nThe unconstrained joint probability density function (PDF) for the $3N$ velocity components is a product of independent Gaussian distributions:\n$$P(\\mathbf{v}_1, \\dots, \\mathbf{v}_N) \\propto \\exp\\left(-\\frac{\\beta}{2} \\sum_{i=1}^{N} m_i \\|\\mathbf{v}_i\\|^2\\right)$$\nFrom this, the unconstrained velocity distribution for a single particle $j$ is a three-dimensional Gaussian (Maxwell-Boltzmann) distribution:\n$$f_{\\text{unc}}(\\mathbf{v}_j) = \\left(\\frac{m_j \\beta}{2\\pi}\\right)^{3/2} \\exp\\left(-\\frac{1}{2} \\beta m_j \\|\\mathbf{v}_j\\|^2\\right)$$\nThis corresponds to a multivariate normal distribution $\\mathbf{v}_j \\sim \\mathcal{N}_3(\\mathbf{0}, \\sigma_{j,\\text{unc}}^2 \\mathbf{I}_3)$, where $\\mathbf{I}_3$ is the $3 \\times 3$ identity matrix and the per-component variance is $\\sigma_{j,\\text{unc}}^2 = (m_j \\beta)^{-1} = k_{\\mathrm{B}}T/m_j$.\n\n### 2. Constrained Single-Particle Velocity Distribution\n\nThe constraint is that the total momentum of the system is zero: $\\sum_{i=1}^{N} m_i \\mathbf{v}_i = \\mathbf{0}$. This vector equation holds for each Cartesian component independently. Let's focus on the $x$-component:\n$$\\sum_{i=1}^{N} m_i v_{ix} = 0$$\nLet $\\mathbf{u}_x = (v_{1x}, v_{2x}, \\dots, v_{Nx})^T$ be the vector of the $x$-components of all particle velocities. Without constraints, $\\mathbf{u}_x$ is a multivariate Gaussian random vector with mean $\\boldsymbol{\\mu} = \\mathbf{0}$ and a diagonal covariance matrix $\\mathbf{\\Sigma}_{\\text{unc}}$ with entries $(\\mathbf{\\Sigma}_{\\text{unc}})_{ii} = \\text{Var}(v_{ix}) = k_{\\mathrm{B}}T/m_i$. The variables $v_{ix}$ are independent.\n\nTo find the distribution of $v_{jx}$ conditioned on the constraint, we use the properties of conditional Gaussian distributions. Let's define an auxiliary random variable $Z_x = \\sum_{i=1}^N m_i v_{ix}$. As a linear combination of independent Gaussian variables, $Z_x$ is also Gaussian.\nIts mean is $E[Z_x] = \\sum_{i=1}^N m_i E[v_{ix}] = 0$.\nIts variance is $\\text{Var}(Z_x) = \\sum_{i=1}^N \\text{Var}(m_i v_{ix}) = \\sum_{i=1}^N m_i^2 \\text{Var}(v_{ix}) = \\sum_{i=1}^N m_i^2 \\frac{k_{\\mathrm{B}}T}{m_i} = k_{\\mathrm{B}}T \\sum_{i=1}^N m_i = k_{\\mathrm{B}}T M$, where $M = \\sum_{i=1}^N m_i$.\n\nWe need the conditional distribution of $v_{jx}$ given $Z_x=0$. We analyze the joint distribution of $(v_{jx}, Z_x)$, which is bivariate Gaussian.\nThe covariance is $\\text{Cov}(v_{jx}, Z_x) = \\text{Cov}(v_{jx}, \\sum_{i=1}^N m_i v_{ix}) = \\sum_{i=1}^N m_i \\text{Cov}(v_{jx}, v_{ix})$.\nSince $v_{jx}$ and $v_{ix}$ are independent for $i \\neq j$, $\\text{Cov}(v_{jx}, v_{ix})=0$ for $i \\neq j$.\nThus, $\\text{Cov}(v_{jx}, Z_x) = m_j \\text{Cov}(v_{jx}, v_{jx}) = m_j \\text{Var}(v_{jx}) = m_j \\frac{k_{\\mathrm{B}}T}{m_j} = k_{\\mathrm{B}}T$.\n\nThe conditional variance of $v_{jx}$ given $Z_x=0$ is given by the standard formula:\n$\\sigma_{j,\\text{constr}}^2 = \\text{Var}(v_{jx} | Z_x=0) = \\text{Var}(v_{jx}) - \\frac{\\text{Cov}(v_{jx}, Z_x)^2}{\\text{Var}(Z_x)}$\n$$ \\sigma_{j,\\text{constr}}^2 = \\frac{k_{\\mathrm{B}}T}{m_j} - \\frac{(k_{\\mathrm{B}}T)^2}{k_{\\mathrm{B}}T M} = k_{\\mathrm{B}}T \\left(\\frac{1}{m_j} - \\frac{1}{M}\\right) = \\frac{k_{\\mathrm{B}}T}{m_j} \\left(1 - \\frac{m_j}{M}\\right) $$\nThe conditional mean remains $E[v_{jx} | Z_x=0] = 0$.\nThe same logic applies independently to the $y$ and $z$ components. Therefore, the constrained velocity vector $\\mathbf{v}_j$ follows a 3D Gaussian distribution $\\mathcal{N}_3(\\mathbf{0}, \\sigma_{j,\\text{constr}}^2 \\mathbf{I}_3)$. The PDF is:\n$$f_{\\text{constr}}(\\mathbf{v}_j) = \\left(\\frac{1}{2\\pi \\sigma_{j,\\text{constr}}^2}\\right)^{3/2} \\exp\\left(-\\frac{\\|\\mathbf{v}_j\\|^2}{2 \\sigma_{j,\\text{constr}}^2}\\right) = \\left(\\frac{m_j \\beta}{2\\pi(1-m_j/M)}\\right)^{3/2} \\exp\\left(-\\frac{\\beta m_j \\|\\mathbf{v}_j\\|^2}{2(1-m_j/M)}\\right)$$\nThe effect of the constraint is a reduction of the per-component variance by a factor of $(1 - m_j/M)$.\n\n### 3. Calculation of Required Quantities\n\n#### Variance Reduction Factor, $r_j$\nThe variance reduction factor $r_j$ is the ratio of the constrained to the unconstrained per-component variance.\n$$r_j = \\frac{\\sigma_{j,\\text{constr}}^2}{\\sigma_{j,\\text{unc}}^2} = \\frac{\\frac{k_{\\mathrm{B}}T}{m_j}(1 - m_j/M)}{\\frac{k_{\\mathrm{B}}T}{m_j}} = 1 - \\frac{m_j}{M}$$\n\n#### Kullback-Leibler Divergence, $D_{\\mathrm{KL}}$\nThe KL divergence from a distribution $P$ to a reference distribution $Q$ for two $d$-dimensional zero-mean Gaussians $P \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{\\Sigma}_P)$ and $Q \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{\\Sigma}_Q)$ is given by $D_{\\mathrm{KL}}(P||Q) = \\frac{1}{2} \\left[ \\text{tr}(\\mathbf{\\Sigma}_Q^{-1} \\mathbf{\\Sigma}_P) - d - \\ln(\\det(\\mathbf{\\Sigma}_Q^{-1}\\mathbf{\\Sigma}_P)) \\right]$.\nHere, $P$ is the constrained distribution and $Q$ is the unconstrained one, so $\\mathbf{\\Sigma}_P = \\sigma_{j,\\text{constr}}^2 \\mathbf{I}_3$ and $\\mathbf{\\Sigma}_Q = \\sigma_{j,\\text{unc}}^2 \\mathbf{I}_3$. The dimension is $d=3$.\n$\\mathbf{\\Sigma}_Q^{-1}\\mathbf{\\Sigma}_P = \\frac{\\sigma_{j,\\text{constr}}^2}{\\sigma_{j,\\text{unc}}^2} \\mathbf{I}_3 = r_j \\mathbf{I}_3$.\nThe trace is $\\text{tr}(r_j \\mathbf{I}_3) = 3r_j$.\nThe determinant term is $\\ln(\\det(r_j \\mathbf{I}_3)) = \\ln(r_j^3) = 3\\ln(r_j)$.\nSubstituting these into the KLD formula:\n$$D_{\\mathrm{KL}} = \\frac{1}{2} (3r_j - 3 - 3\\ln(r_j)) = \\frac{3}{2}(r_j - 1 - \\ln(r_j))$$\nSince $r_j = 1 - m_j/M$, we can also write this as $D_{\\mathrm{KL}} = \\frac{3}{2} \\left( -\\frac{m_j}{M} - \\ln\\left(1 - \\frac{m_j}{M}\\right) \\right)$.\n\n#### Ratio of Speed Densities, $R(v_0)$\nFor an isotropic 3D velocity distribution $f(\\mathbf{v})$ with speed $v = \\|\\mathbf{v}\\|$, the speed density is $g(v) = 4\\pi v^2 f(\\mathbf{v})$. We need the ratio $R(v_0) = \\frac{g_{\\text{constr}}(v_0)}{g_{\\text{unc}}(v_0)}$.\n$$R(v_0) = \\frac{4\\pi v_0^2 f_{\\text{constr}}(\\mathbf{v}_j)|_{\\|\\mathbf{v}_j\\|=v_0}}{4\\pi v_0^2 f_{\\text{unc}}(\\mathbf{v}_j)|_{\\|\\mathbf{v}_j\\|=v_0}} = \\frac{\\left(\\frac{1}{2\\pi\\sigma_{j,\\text{constr}}^2}\\right)^{3/2} \\exp\\left(-\\frac{v_0^2}{2\\sigma_{j,\\text{constr}}^2}\\right)}{\\left(\\frac{1}{2\\pi\\sigma_{j,\\text{unc}}^2}\\right)^{3/2} \\exp\\left(-\\frac{v_0^2}{2\\sigma_{j,\\text{unc}}^2}\\right)}$$\n$$R(v_0) = \\left(\\frac{\\sigma_{j,\\text{unc}}^2}{\\sigma_{j,\\text{constr}}^2}\\right)^{3/2} \\exp\\left(\\frac{v_0^2}{2\\sigma_{j,\\text{unc}}^2} - \\frac{v_0^2}{2\\sigma_{j,\\text{constr}}^2}\\right)$$\nUsing $\\sigma_{j,\\text{constr}}^2 = r_j \\sigma_{j,\\text{unc}}^2$:\n$$R(v_0) = \\left(\\frac{1}{r_j}\\right)^{3/2} \\exp\\left(\\frac{v_0^2}{2\\sigma_{j,\\text{unc}}^2} \\left(1 - \\frac{1}{r_j}\\right)\\right)$$\nSubstituting $\\sigma_{j,\\text{unc}}^2 = k_{\\mathrm{B}}T/m_j$ and $1-1/r_j = (r_j-1)/r_j$:\n$$R(v_0) = r_j^{-3/2} \\exp\\left(\\frac{m_j v_0^2}{2 k_{\\mathrm{B}}T} \\left(\\frac{r_j - 1}{r_j}\\right)\\right)$$\nThese formulas are implemented in the provided code.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Note: scipy is permitted but not required for this problem.\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It derives and computes three quantities characterizing the effect of\n    removing center-of-mass drift on a single-particle velocity distribution.\n    \"\"\"\n\n    # Physical constants\n    K_B = 1.380649e-23  # Boltzmann constant in J/K\n    AMU = 1.66053906660e-27  # Atomic mass unit in kg\n    M_AR_AMU = 39.948  # Mass of Argon in amu\n    M_AR = M_AR_AMU * AMU # Mass of Argon in kg\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (Happy path, identical masses)\n        {'N': 10, 'masses': [M_AR] * 10, 'T': 300, 'j': 1, 'v0': 400},\n        # Case B (Strong constraint effect, small N)\n        {'N': 2, 'masses': [M_AR] * 2, 'T': 300, 'j': 1, 'v0': 400},\n        # Case C (Heterogeneous masses, heavy particle)\n        {'N': 3, 'masses': [M_AR, M_AR, 2 * M_AR], 'T': 1000, 'j': 3, 'v0': 1000},\n        # Case D (Heterogeneous masses, light particle)\n        {'N': 3, 'masses': [M_AR, M_AR, 2 * M_AR], 'T': 1000, 'j': 1, 'v0': 1000},\n        # Case E (Boundary toward large N)\n        {'N': 100, 'masses': [M_AR] * 100, 'T': 300, 'j': 51, 'v0': 400},\n    ]\n\n    def calculate_metrics(masses, T, j, v0):\n        \"\"\"\n        Calculates r_j, D_KL, and R(v0) for a single test case.\n\n        Args:\n            masses (list): List of particle masses in kg.\n            T (float): Temperature in Kelvin.\n            j (int): 1-based index of the particle of interest.\n            v0 (float): Speed in m/s for evaluating the speed density ratio.\n\n        Returns:\n            tuple: A tuple containing (r_j, D_KL, R_v0).\n        \"\"\"\n        # Convert 1-based particle index to 0-based array index\n        j_idx = j - 1\n        m_j = masses[j_idx]\n        M = sum(masses)\n        \n        # 1. Variance reduction factor, r_j\n        # r_j = 1 - m_j / M\n        r_j = 1.0 - m_j / M\n        \n        # 2. Kullback-Leibler divergence, D_KL (in nats)\n        # D_KL = (3/2) * (r_j - 1 - ln(r_j))\n        D_KL = 1.5 * (r_j - 1.0 - np.log(r_j))\n        \n        # 3. Ratio of speed densities, R(v0)\n        # R(v0) = r_j^(-3/2) * exp( (m_j * v0^2) / (2 * k_B * T) * (r_j - 1) / r_j )\n        exponent_term = (m_j * v0**2) / (2.0 * K_B * T) * ((r_j - 1.0) / r_j)\n        R_v0 = r_j**(-1.5) * np.exp(exponent_term)\n        \n        return r_j, D_KL, R_v0\n\n    results = []\n    for case in test_cases:\n        r, dkl, rv0 = calculate_metrics(\n            masses=case['masses'],\n            T=case['T'],\n            j=case['j'],\n            v0=case['v0']\n        )\n        results.extend([r, dkl, rv0])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3424116"}]}