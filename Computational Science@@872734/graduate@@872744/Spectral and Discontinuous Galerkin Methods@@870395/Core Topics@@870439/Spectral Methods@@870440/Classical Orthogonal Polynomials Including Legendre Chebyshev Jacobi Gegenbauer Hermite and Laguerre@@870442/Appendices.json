{"hands_on_practices": [{"introduction": "The power of classical orthogonal polynomials as basis functions in spectral methods stems directly from their orthogonality with respect to a specific weight function. This property simplifies the resulting linear systems, often yielding diagonal or sparse mass matrices. This practice reinforces this foundational concept by guiding you through the derivation of the squared norm of the Jacobi polynomials, a quantity essential for normalizing the basis and understanding the structure of the mass matrix [@problem_id:3370697]. Working from the Rodrigues formula, you will employ integration by parts and properties of the Gamma function to arrive at this cornerstone result.", "problem": "A modal spectral expansion for a scalar conservation law on the reference interval $[-1,1]$ often employs the Jacobi polynomial family $P_{n}^{(\\alpha,\\beta)}(x)$ with the Jacobi weight $w(x)=(1-x)^{\\alpha}(1+x)^{\\beta}$, where $\\alpha-1$ and $\\beta-1$. In the Discontinuous Galerkin (DG) method, the mass matrix entries on the reference element arise from the weighted inner product $\\langle f,g \\rangle_{w}=\\int_{-1}^{1} f(x)\\,g(x)\\,w(x)\\,\\mathrm{d}x$. The Jacobi polynomials $P_{n}^{(\\alpha,\\beta)}(x)$ are defined by the Rodrigues formula\n$$\nP_{n}^{(\\alpha,\\beta)}(x)=\\frac{(-1)^{n}}{2^{n} n!}\\,(1-x)^{-\\alpha}(1+x)^{-\\beta}\\,\\frac{\\mathrm{d}^{n}}{\\mathrm{d}x^{n}}\\Big[(1-x)^{\\alpha+n}(1+x)^{\\beta+n}\\Big].\n$$\nAssume $\\alpha-1$, $\\beta-1$, and $n\\in\\mathbb{N}$. Using only the definition above together with standard properties of integration by parts and the Euler Beta function $B(u,v)=\\int_{0}^{1} t^{u-1}(1-t)^{v-1}\\,\\mathrm{d}t=\\frac{\\Gamma(u)\\Gamma(v)}{\\Gamma(u+v)}$, compute the exact value of the weighted inner product \n$$\n\\int_{-1}^{1} (1-x)^{\\alpha}(1+x)^{\\beta}\\,\\Big(P_{n}^{(\\alpha,\\beta)}(x)\\Big)^{2}\\,\\mathrm{d}x\n$$\nin closed form as a function of $n$, $\\alpha$, and $\\beta$. Your final answer must be a single analytic expression.", "solution": "The problem is to compute the squared norm of a Jacobi polynomial $P_{n}^{(\\alpha,\\beta)}(x)$ with respect to the associated Jacobi weight function $w(x)=(1-x)^{\\alpha}(1+x)^{\\beta}$. The quantity to be computed is the integral\n$$\nI_{n} = \\int_{-1}^{1} (1-x)^{\\alpha}(1+x)^{\\beta}\\,\\Big(P_{n}^{(\\alpha,\\beta)}(x)\\Big)^{2}\\,\\mathrm{d}x,\n$$\nwhere $\\alpha-1$, $\\beta-1$, and $n$ is a non-negative integer. The Jacobi polynomial $P_{n}^{(\\alpha,\\beta)}(x)$ is given by the Rodrigues formula:\n$$\nP_{n}^{(\\alpha,\\beta)}(x)=\\frac{(-1)^{n}}{2^{n} n!}\\,(1-x)^{-\\alpha}(1+x)^{-\\beta}\\,\\frac{\\mathrm{d}^{n}}{\\mathrm{d}x^{n}}\\Big[(1-x)^{\\alpha+n}(1+x)^{\\beta+n}\\Big].\n$$\nThis formula reveals that $P_{n}^{(\\alpha,\\beta)}(x)$ is a polynomial of degree $n$. Let us denote its leading coefficient by $k_n$. We can then write $P_{n}^{(\\alpha,\\beta)}(x)$ as\n$$\nP_{n}^{(\\alpha,\\beta)}(x) = k_{n} x^{n} + q_{n-1}(x),\n$$\nwhere $q_{n-1}(x)$ is a polynomial of degree at most $n-1$. Substituting this into the integral $I_{n}$:\n$$\nI_{n} = \\int_{-1}^{1} w(x)\\,P_{n}^{(\\alpha,\\beta)}(x)\\,(k_{n} x^{n} + q_{n-1}(x))\\,\\mathrm{d}x = k_{n} \\int_{-1}^{1} w(x)\\,P_{n}^{(\\alpha,\\beta)}(x)\\,x^{n}\\,\\mathrm{d}x + \\int_{-1}^{1} w(x)\\,P_{n}^{(\\alpha,\\beta)}(x)\\,q_{n-1}(x)\\,\\mathrm{d}x.\n$$\nA fundamental property of Jacobi polynomials, derivable from the Rodrigues formula, is their orthogonality with respect to the weight function $w(x)$. Specifically, $P_{n}^{(\\alpha,\\beta)}(x)$ is orthogonal to any polynomial of degree less than $n$. Since $q_{n-1}(x)$ is a linear combination of monomials $x^m$ with $m  n$, the second integral vanishes:\n$$\n\\int_{-1}^{1} w(x)\\,P_{n}^{(\\alpha,\\beta)}(x)\\,q_{n-1}(x)\\,\\mathrm{d}x = 0.\n$$\nThus, the expression for $I_{n}$ simplifies to\n$$\nI_{n} = k_{n} \\int_{-1}^{1} x^{n}\\, P_{n}^{(\\alpha,\\beta)}(x)\\,w(x)\\,\\mathrm{d}x.\n$$\nNow, we substitute the Rodrigues formula for $P_{n}^{(\\alpha,\\beta)}(x)$ into this simplified expression. The weight function $w(x)=(1-x)^{\\alpha}(1+x)^{\\beta}$ cancels with the $(1-x)^{-\\alpha}(1+x)^{-\\beta}$ term in the formula:\n$$\nI_{n} = k_{n} \\int_{-1}^{1} x^{n} \\left(\\frac{(-1)^{n}}{2^{n} n!}\\,\\frac{\\mathrm{d}^{n}}{\\mathrm{d}x^{n}}\\Big[(1-x)^{\\alpha+n}(1+x)^{\\beta+n}\\Big]\\right) \\mathrm{d}x.\n$$\nWe proceed by applying integration by parts $n$ times. For each step, we differentiate $x^n$ and integrate the $n$-th derivative term. The boundary terms at each step are zero. This is because the derivatives of $(1-x)^{\\alpha+n}(1+x)^{\\beta+n}$ of order $j  n$ contain factors of $(1-x)^{\\alpha+n-j}$ and $(1+x)^{\\beta+n-j}$. Since $\\alpha-1$ and $\\beta-1$, we have $\\alpha+n-j  n-j-1 \\ge 0$ and $\\beta+n-j  n-j-1 \\ge 0$ for $j \\le n-1$, ensuring the boundary terms vanish at $x=\\pm 1$. After $n$ applications of integration by parts, we obtain:\n$$\nI_{n} = k_{n} \\frac{(-1)^{n}}{2^{n} n!} \\int_{-1}^{1} \\Big[(1-x)^{\\alpha+n}(1+x)^{\\beta+n}\\Big] \\left( (-1)^{n} \\frac{\\mathrm{d}^{n}}{\\mathrm{d}x^{n}} x^{n} \\right) \\mathrm{d}x.\n$$\nSince $\\frac{\\mathrm{d}^{n}}{\\mathrm{d}x^{n}} x^{n} = n!$ and $(-1)^{n}(-1)^{n} = 1$, the expression further simplifies:\n$$\nI_{n} = k_{n} \\frac{1}{2^{n} n!} (n!) \\int_{-1}^{1} (1-x)^{\\alpha+n}(1+x)^{\\beta+n}\\,\\mathrm{d}x = \\frac{k_{n}}{2^{n}} \\int_{-1}^{1} (1-x)^{\\alpha+n}(1+x)^{\\beta+n}\\,\\mathrm{d}x.\n$$\nThe next step is to determine the leading coefficient $k_{n}$. We can extract it from the Rodrigues formula by examining the behavior of the terms for large $x$:\n\\begin{align*} (1-x)^{\\alpha+n}(1+x)^{\\beta+n} \\sim (-x)^{\\alpha+n}(x)^{\\beta+n} = (-1)^{\\alpha+n}x^{\\alpha+\\beta+2n} \\\\ \\frac{\\mathrm{d}^{n}}{\\mathrm{d}x^{n}} \\Big[(1-x)^{\\alpha+n}(1+x)^{\\beta+n}\\Big] \\sim (-1)^{\\alpha+n} \\frac{\\Gamma(\\alpha+\\beta+2n+1)}{\\Gamma(\\alpha+\\beta+n+1)} x^{\\alpha+\\beta+n} \\\\ (1-x)^{-\\alpha}(1+x)^{-\\beta} \\sim (-x)^{-\\alpha}(x)^{-\\beta} = (-1)^{-\\alpha}x^{-\\alpha-\\beta} \\end{align*}\nCombining these asymptotic forms yields the leading term of $P_{n}^{(\\alpha,\\beta)}(x)$:\n$$\nP_{n}^{(\\alpha,\\beta)}(x) \\sim \\frac{(-1)^{n}}{2^{n} n!} \\big( (-1)^{-\\alpha}x^{-\\alpha-\\beta} \\big) \\left( (-1)^{\\alpha+n} \\frac{\\Gamma(\\alpha+\\beta+2n+1)}{\\Gamma(\\alpha+\\beta+n+1)} x^{\\alpha+\\beta+n} \\right).\n$$\nThe powers of $(-1)$ cancel as $(-1)^{n-\\alpha+\\alpha+n} = (-1)^{2n}=1$. The leading term is\n$$\nP_{n}^{(\\alpha,\\beta)}(x) \\sim \\frac{1}{2^{n} n!} \\frac{\\Gamma(\\alpha+\\beta+2n+1)}{\\Gamma(\\alpha+\\beta+n+1)} x^{n},\n$$\nfrom which we identify the leading coefficient:\n$$\nk_{n} = \\frac{\\Gamma(2n+\\alpha+\\beta+1)}{2^{n} n! \\Gamma(n+\\alpha+\\beta+1)}.\n$$\nThe final piece is the integral term, which can be evaluated using the Euler Beta function, $B(u,v) = \\int_0^1 t^{u-1}(1-t)^{v-1}\\,\\mathrm{d}t$. Let $x=2t-1$, so $\\mathrm{d}x=2\\,\\mathrm{d}t$:\n\\begin{align*} \\int_{-1}^{1} (1-x)^{\\alpha+n}(1+x)^{\\beta+n}\\,\\mathrm{d}x = \\int_{0}^{1} (2(1-t))^{\\alpha+n}(2t)^{\\beta+n}\\,(2\\,\\mathrm{d}t) \\\\ = 2^{\\alpha+n} 2^{\\beta+n} 2 \\int_{0}^{1} (1-t)^{\\alpha+n} t^{\\beta+n}\\,\\mathrm{d}t \\\\ = 2^{\\alpha+\\beta+2n+1} B(\\beta+n+1, \\alpha+n+1) \\\\ = 2^{\\alpha+\\beta+2n+1} \\frac{\\Gamma(\\beta+n+1)\\Gamma(\\alpha+n+1)}{\\Gamma(\\alpha+\\beta+2n+2)}. \\end{align*}\nSubstituting the expressions for $k_n$ and the integral back into the formula for $I_n$:\n$$\nI_{n} = \\frac{1}{2^{n}} \\left( \\frac{\\Gamma(2n+\\alpha+\\beta+1)}{2^{n} n! \\Gamma(n+\\alpha+\\beta+1)} \\right) \\left( 2^{\\alpha+\\beta+2n+1} \\frac{\\Gamma(n+\\alpha+1)\\Gamma(n+\\beta+1)}{\\Gamma(2n+\\alpha+\\beta+2)} \\right).\n$$\nWe can simplify this expression by combining powers of $2$ and using the property $\\Gamma(z+1)=z\\Gamma(z)$:\n\\begin{align*} I_{n} = \\frac{2^{\\alpha+\\beta+2n+1}}{2^{2n} n!} \\frac{\\Gamma(2n+\\alpha+\\beta+1)}{\\Gamma(n+\\alpha+\\beta+1)} \\frac{\\Gamma(n+\\alpha+1)\\Gamma(n+\\beta+1)}{\\Gamma(2n+\\alpha+\\beta+2)} \\\\ = \\frac{2^{\\alpha+\\beta+1}}{n!} \\frac{\\Gamma(2n+\\alpha+\\beta+1)}{\\Gamma(n+\\alpha+\\beta+1)} \\frac{\\Gamma(n+\\alpha+1)\\Gamma(n+\\beta+1)}{(2n+\\alpha+\\beta+1)\\Gamma(2n+\\alpha+\\beta+1)} \\\\ = \\frac{2^{\\alpha+\\beta+1}}{n! (2n+\\alpha+\\beta+1)} \\frac{\\Gamma(n+\\alpha+1)\\Gamma(n+\\beta+1)}{\\Gamma(n+\\alpha+\\beta+1)}. \\end{align*}\nThis is the final closed-form expression for the integral.", "answer": "$$\n\\boxed{\\frac{2^{\\alpha+\\beta+1}}{n! (2n+\\alpha+\\beta+1)} \\frac{\\Gamma(n+\\alpha+1)\\Gamma(n+\\beta+1)}{\\Gamma(n+\\alpha+\\beta+1)}}\n$$", "id": "3370701"}, {"introduction": "While orthogonality provides great simplification on canonical reference elements, practical applications in engineering and physics often involve curved geometries. This practice explores how an isoparametric mapping from a reference element to a curved physical element impacts the orthogonality of the Legendre basis [@problem_id:3370711]. You will see firsthand how the non-constant Jacobian of the transformation introduces a new, non-trivial weight function into the inner product, causing the mass matrix to become non-diagonal. By calculating a specific off-diagonal entry, you will quantify this \"modal coupling\" and gain insight into the so-called geometric metric identities required for a scheme to preserve constant states, a critical property for accuracy.", "problem": "Consider a one-dimensional Discontinuous Galerkin (DG) discretization of a conservation law on a single reference element $\\xi \\in [-1,1]$, where the mapping to physical space is isoparametric and given by $x(\\xi) = \\xi + \\varepsilon \\,\\xi^{2}$ with a small but otherwise arbitrary curvature parameter $\\varepsilon \\in \\mathbb{R}$. The basis functions are the classical Legendre polynomials $\\{P_{k}(\\xi)\\}_{k=0}^{\\infty}$ on $[-1,1]$. The physical-volume inner product induced by the mapping is defined by the Jacobian factor $J(\\xi) = \\frac{dx}{d\\xi}$, so that the DG mass matrix entries are\n$$\nM_{mn} = \\int_{-1}^{1} P_{m}(\\xi)\\,P_{n}(\\xi)\\,J(\\xi)\\,d\\xi.\n$$\nStarting from core definitions of the change-of-variables in integrals, the $L^{2}$-orthogonality of Legendre polynomials on $[-1,1]$, and structure relations for Legendre polynomials derived from their defining differential equation and Rodrigues' formula, perform the following tasks:\n- Explain why the non-constant Jacobian $J(\\xi)$ alters the orthogonality of the Legendre basis in physical space and how this induces modal coupling and potential aliasing when integrals are approximated by finite-degree quadrature rules.\n- Derive the discrete metric identity needed for free-stream preservation (i.e., exact preservation of a constant solution) in DG under isoparametric mappings, and state clearly the consistency conditions on polynomial representation and differentiation that make this identity hold for the mapping $x(\\xi)$ above with a Legendre modal basis.\n\nThen, compute explicitly the off-diagonal mass matrix entry for adjacent modes,\n$$\nM_{n,n+1} = \\int_{-1}^{1} P_{n}(\\xi)\\,P_{n+1}(\\xi)\\,J(\\xi)\\,d\\xi,\n$$\nas a closed-form analytic function of $\\varepsilon$ and the integer degree $n \\geq 0$. No rounding is required. Report only the final closed-form expression for $M_{n,n+1}$ as your answer.", "solution": "The problem requires a three-part response: an explanation of geometric-induced modal coupling, a derivation of the free-stream preservation identity, and an explicit computation of a specific off-diagonal mass matrix entry.\n\nFirst, we establish the geometric context. The mapping from the reference element $\\xi \\in [-1,1]$ to the physical element $x \\in [x(-1), x(1)]$ is given by $x(\\xi) = \\xi + \\varepsilon \\xi^{2}$. The Jacobian of this transformation is $J(\\xi) = \\frac{dx}{d\\xi} = 1 + 2\\varepsilon \\xi$. Since the mapping is quadratic in $\\xi$, the Jacobian is linear in $\\xi$.\n\n**Part 1: Altered Orthogonality, Modal Coupling, and Aliasing**\n\nThe Legendre polynomials $\\{P_k(\\xi)\\}_{k=0}^\\infty$ form an orthogonal basis on the interval $[-1,1]$ with respect to the standard (unweighted) $L^2$ inner product, which has a weight function of unity. This orthogonality is expressed as:\n$$\n\\langle P_m, P_n \\rangle = \\int_{-1}^{1} P_m(\\xi) P_n(\\xi) \\,d\\xi = \\frac{2}{2n+1} \\delta_{mn}\n$$\nwhere $\\delta_{mn}$ is the Kronecker delta.\n\nThe DG mass matrix $M_{mn}$ is constructed using the physical-volume inner product, which includes the Jacobian $J(\\xi)$ as a weight function. The entries are given by:\n$$\nM_{mn} = \\int_{-1}^{1} P_m(\\xi) P_n(\\xi) J(\\xi) \\,d\\xi\n$$\nSubstituting the given Jacobian $J(\\xi) = 1 + 2\\varepsilon\\xi$, we obtain:\n$$\nM_{mn} = \\int_{-1}^{1} P_m(\\xi) P_n(\\xi) (1 + 2\\varepsilon\\xi) \\,d\\xi = \\int_{-1}^{1} P_m(\\xi) P_n(\\xi) \\,d\\xi + 2\\varepsilon \\int_{-1}^{1} \\xi P_m(\\xi) P_n(\\xi) \\,d\\xi\n$$\nThe first term corresponds to the standard, diagonal mass matrix scaled by the orthogonality constant. The second term, $2\\varepsilon \\int_{-1}^{1} \\xi P_m(\\xi) P_n(\\xi) \\,d\\xi$, prevents the basis from being orthogonal with respect to this new weighted inner product. Specifically, this integral is generally non-zero for $m \\neq n$ (for example, when $|m-n|=1$), leading to non-zero off-diagonal entries in the mass matrix, $M_{mn} \\neq 0$ for $m \\neq n$.\n\nThis phenomenon is known as **modal coupling**. The non-constant Jacobian $J(\\xi)$ introduces a coupling between different modes (basis functions) that would be decoupled (orthogonal) on a canonical affine element where $J$ is constant. The mass matrix is no longer diagonal, which means its inverse, $\\mathbf{M}^{-1}$, is dense. This has significant computational implications, as updating the solution in a DG scheme with an explicit time integrator requires multiplication by $\\mathbf{M}^{-1}$.\n\nRegarding **aliasing**, numerical DG methods approximate integrals using quadrature rules, such as Gauss-Legendre quadrature. A quadrature rule with $N_q$ points is exact for polynomials of degree up to $2N_q-1$. The integrand for the mass matrix entry $M_{mn}$ is $P_m(\\xi) P_n(\\xi) J(\\xi)$. If the basis functions are polynomials of degree up to $N$, the highest degree of this product occurs for $m=n=N$. The degree of $P_N(\\xi) P_N(\\xi) J(\\xi)$ is $N+N+1 = 2N+1$. To compute all mass matrix entries exactly, the quadrature rule must be exact for polynomials of degree at least $2N+1$, requiring $2N_q - 1 \\ge 2N+1$, or $N_q \\ge N+2$. If a quadrature rule with fewer points is used (an \"inexact integration\" or \"under-integration\" strategy, common for efficiency), the integral is not computed exactly. The error in this approximation, known as aliasing error, effectively projects energy from polynomial modes higher than what the quadrature can resolve onto the existing modes within the polynomial space $\\mathbb{P}_N$, corrupting the solution.\n\n**Part 2: Free-Stream Preservation and the Discrete Metric Identity**\n\nFree-stream preservation requires that a DG scheme for a conservation law $\\partial_t u + \\partial_x f(u) = 0$ maintains a constant state $u(x,t) = c$ exactly. In the weak formulation on a physical element $K$, this means the spatial residual must be zero for $u=c$. For a test function $v_h$, the spatial residual is:\n$$\nR_{sp}(v_h, u_h) = \\int_K v_h \\frac{\\partial f(u_h)}{\\partial x} \\,dx\n$$\nTransforming to the reference element $\\xi \\in [-1,1]$ using $\\partial_x = \\frac{1}{J(\\xi)} \\partial_\\xi$ and $dx=J(\\xi)d\\xi$:\n$$\nR_{sp}(v_h, u_h) = \\int_{-1}^{1} v_h(\\xi) \\left( \\frac{1}{J(\\xi)} \\frac{\\partial f(u_h(\\xi))}{\\partial \\xi} \\right) J(\\xi) \\,d\\xi = \\int_{-1}^{1} v_h(\\xi) \\frac{\\partial f(u_h(\\xi))}{\\partial \\xi} \\,d\\xi\n$$\nA crucial observation is that the Jacobian factors $J(\\xi)$ and $1/J(\\xi)$ cancel analytically. This is the **metric identity**. Integrating by parts yields the standard DG weak form:\n$$\nR_{sp}(v_h, u_h) = \\left[ v_h(\\xi) f(u_h(\\xi)) \\right]_{-1}^{1} - \\int_{-1}^{1} \\frac{\\partial v_h(\\xi)}{\\partial \\xi} f(u_h(\\xi)) \\,d\\xi\n$$\nIf the solution is a constant free-stream, $u_h = c$, then $f(u_h)=f(c)$ is also constant. The residual becomes:\n$$\nR_{sp}(v_h, c) = f(c) \\left[ v_h(\\xi) \\right]_{-1}^{1} - f(c) \\int_{-1}^{1} \\frac{\\partial v_h(\\xi)}{\\partial \\xi} \\,d\\xi\n$$\nBy the Fundamental Theorem of Calculus, $\\int_{-1}^{1} \\frac{\\partial v_h}{\\partial \\xi} d\\xi = v_h(1) - v_h(-1)$. Thus,\n$$\nR_{sp}(v_h, c) = f(c) (v_h(1) - v_h(-1)) - f(c) (v_h(1) - v_h(-1)) = 0\n$$\nThis shows that the volume contribution to the spatial residual is identically zero for a constant state. Free-stream preservation is achieved if the numerical fluxes at the boundaries also take on the free-stream value, i.e., $f(u_h^*) = f(c)$.\n\nThe \"discrete\" aspect of the metric identity relates to the **consistency conditions** ensuring this cancellation is preserved in the numerical implementation:\n1.  **Formulation Consistency**: The weak form of the derivative operator must be formulated as $\\int v_h(\\xi) (\\partial_\\xi u_h(\\xi)) d\\xi$, thereby embedding the analytical cancellation of the geometric terms. It must not be formulated in a way that requires approximating $1/J(\\xi)$ as a polynomial, as this would break the perfect cancellation. For the given mapping, this is straightforward as shown.\n2.  **Quadrature Consistency**: The resulting integrals must be computed exactly. The term from the stiffness matrix, $\\int v_h (\\partial_\\xi u_h) d\\xi$, involves a polynomial of degree at most $N + (N-1) = 2N-1$ if $v_h, u_h \\in \\mathbb{P}_N$. This requires a Gauss quadrature rule with at least $N$ points. The mass matrix integral requires a quadrature rule exact for degree $2N+1$, as discussed previously. If these quadrature rules are used, the discrete evaluation of the spatial operator on a constant state will be zero, thus preserving the free-stream.\n\n**Part 3: Computation of $M_{n,n+1}$**\n\nThe off-diagonal mass matrix entry for adjacent modes $n$ and $n+1$ ($n \\geq 0$) is given by:\n$$\nM_{n,n+1} = \\int_{-1}^{1} P_n(\\xi) P_{n+1}(\\xi) J(\\xi) \\,d\\xi = \\int_{-1}^{1} P_n(\\xi) P_{n+1}(\\xi) (1 + 2\\varepsilon\\xi) \\,d\\xi\n$$\nThis can be split into two integrals:\n$$\nM_{n,n+1} = \\int_{-1}^{1} P_n(\\xi) P_{n+1}(\\xi) \\,d\\xi + 2\\varepsilon \\int_{-1}^{1} \\xi P_n(\\xi) P_{n+1}(\\xi) \\,d\\xi\n$$\nThe first integral is zero due to the orthogonality of Legendre polynomials for different degrees. Thus, we only need to evaluate the second integral:\n$$\nM_{n,n+1} = 2\\varepsilon \\int_{-1}^{1} \\xi P_n(\\xi) P_{n+1}(\\xi) \\,d\\xi\n$$\nTo evaluate this integral, we use the three-term recurrence relation for Legendre polynomials:\n$$\n(k+1)P_{k+1}(x) = (2k+1)x P_k(x) - k P_{k-1}(x)\n$$\nRearranging for the term $x P_k(x)$:\n$$\nx P_k(x) = \\frac{k+1}{2k+1} P_{k+1}(x) + \\frac{k}{2k+1} P_{k-1}(x)\n$$\nLet $k=n$ and $x=\\xi$. Substitute this into our integral:\n$$\nM_{n,n+1} = 2\\varepsilon \\int_{-1}^{1} \\left( \\frac{n+1}{2n+1} P_{n+1}(\\xi) + \\frac{n}{2n+1} P_{n-1}(\\xi) \\right) P_{n+1}(\\xi) \\,d\\xi\n$$\nDistributing $P_{n+1}(\\xi)$ across the terms:\n$$\nM_{n,n+1} = 2\\varepsilon \\left( \\frac{n+1}{2n+1} \\int_{-1}^{1} P_{n+1}(\\xi)^2 \\,d\\xi + \\frac{n}{2n+1} \\int_{-1}^{1} P_{n-1}(\\xi) P_{n+1}(\\xi) \\,d\\xi \\right)\n$$\nAgain, by orthogonality, the second integral $\\int_{-1}^{1} P_{n-1}(\\xi) P_{n+1}(\\xi) \\,d\\xi$ is zero for all $n \\geq 0$ (if $n=0$, the term is multiplied by $n=0$; if $n \\geq 1$, the indices differ by $2$). The first integral is the normalization constant:\n$$\n\\int_{-1}^{1} P_{n+1}(\\xi)^2 \\,d\\xi = \\frac{2}{2(n+1)+1} = \\frac{2}{2n+3}\n$$\nSubstituting this result back:\n$$\nM_{n,n+1} = 2\\varepsilon \\left( \\frac{n+1}{2n+1} \\cdot \\frac{2}{2n+3} + 0 \\right) = \\frac{4\\varepsilon(n+1)}{(2n+1)(2n+3)}\n$$\nThis formula provides the closed-form analytic expression for the specified off-diagonal mass matrix entry as a function of the curvature parameter $\\varepsilon$ and the mode index $n \\geq 0$.", "answer": "$$\\boxed{\\frac{4\\varepsilon(n+1)}{(2n+1)(2n+3)}}$$", "id": "3370740"}, {"introduction": "The theoretical properties of orthogonal polynomials have profound and measurable consequences for the performance of numerical methods. The choice of nodal points for interpolation and quadrature, which are often the roots of these polynomials, directly influences the accuracy of a simulation. This hands-on coding practice challenges you to investigate this link by performing a dispersion and dissipation analysis for the Discontinuous Galerkin Spectral Element Method (DGSEM) [@problem_id:3370734]. By constructing the numerical scheme and analyzing its eigenvalues, you will quantitatively compare how different nodal sets—Legendre-Gauss and Legendre-Gauss-Lobatto—affect the propagation of waves, revealing their strengths and weaknesses in resolving time-dependent problems.", "problem": "Consider the one-dimensional linear advection equation $u_t + a\\,u_x = 0$ with constant speed $a0$ on a periodic domain partitioned into a uniform mesh of elements of size $h$. In a Discontinuous Galerkin Spectral Element Method (DGSEM) with polynomial degree $p$ per element, one represents $u$ by a nodal polynomial of degree $p$ using $p+1$ interpolation points in the reference element $\\xi \\in [-1,1]$ and a diagonal mass matrix induced by collocation quadrature. Two canonical choices of interpolation points are Legendre-Gauss (LG) points and Legendre-Gauss-Lobatto (LGL) points. The DGSEM in strong form can be constructed from:\n\n- Fundamental facts about classical orthogonal polynomials: Legendre polynomials $P_n(x)$ are orthogonal on $[-1,1]$ with respect to the weight $1$, satisfy $P_n(1)=1$ and $P_n(-1)=(-1)^n$, and have simple identities for derivatives at the endpoints. LG points are the $p+1$ roots of $P_{p+1}(x)$, while LGL points are the $p+1$ roots of $(1-x^2)P_p'(x)$, including the endpoints $x=\\pm 1$. Jacobi polynomials $P_n^{(\\alpha,\\beta)}(x)$ connect derivatives via $P_p'(x)$ having the same zeros as $P_{p-1}^{(1,1)}(x)$ in $(-1,1)$. Quadrature weights are known for LG and LGL and define the diagonal mass matrix.\n\n- The summation-by-parts (SBP) property realized in DGSEM when the derivative operator is built from the differentiation of the Lagrange basis associated with the collocation nodes and the surface terms are added using numerical fluxes. The strong-form semi-discrete operator for advection combines a volume derivative term and a lifted surface correction term determined by fluxes at element interfaces.\n\nYou will quantify the dispersion (phase speed) and dissipation (amplitude decay) of DGSEM for both LG and LGL points by performing a semi-discrete Fourier analysis on the block-circulant operator for a uniform periodic mesh. Assume $a=1$ and $h=1$ throughout, and angles must be handled in radians.\n\nStarting from the above fundamental base:\n\n1. Construct, for each choice of nodes (LG and LGL), the nodal derivative matrix on $[-1,1]$ using the Lagrange basis differentiation formula derived from the polynomial $L(x)$ that has the collocation nodes as roots. Specifically, use the identity that the Lagrange basis $l_j(x)$ can be represented as $l_j(x) = \\dfrac{L(x)}{(x-x_j)L'(x_j)}$, so that the differentiation matrix entries are $D_{ij} = \\dfrac{1/L'(x_j)}{(1/L'(x_i))\\,(x_i - x_j)}$ for $i\\neq j$ and $D_{ii} = -\\sum_{j\\neq i} D_{ij}$. For LG, $L(x) = P_{p+1}(x)$; for LGL, $L(x) = (1-x^2)P_p'(x)$, with $L'(x)$ evaluated using standard Legendre polynomial derivative identities. Quadrature weights define the diagonal mass matrix $M$.\n\n2. Define the boundary evaluation vectors $r_L$ and $r_R$ that map nodal values to left and right face values, respectively, by evaluating the Lagrange basis at $x=-1$ and $x=1$. Use the barycentric evaluation induced by the weights $1/L'(x_j)$ to compute $r_L$ and $r_R$ stably for both LG and LGL (noting that, at LGL endpoints, the corresponding basis function equals $1$ and the others $0$).\n\n3. For each non-dimensional wavenumber $\\theta = k h$ in a prescribed test set, form the $p+1$ by $p+1$ Fourier symbol $A(\\theta)$ of the semi-discrete DGSEM strong-form operator with upwind numerical flux for $a0$. Use the Bloch ansatz over the uniform mesh so that the left neighbor’s right-face value contributes a factor $z^{-1}$ with $z = e^{i\\theta}$. The strong-form symbol matrix is\n$$\nA(\\theta) = -\\frac{2}{h}\\,a\\,D \\;-\\;\\frac{2}{h}\\,a\\,M^{-1}\\,r_L\\left(z^{-1}r_R^\\top - r_L^\\top\\right).\n$$\nWith $a=1$ and $h=1$, this simplifies appropriately.\n\n4. For each $\\theta$, compute all eigenvalues $\\lambda(\\theta)$ of $A(\\theta)$ and define the complex angular frequency $\\omega(\\theta) = i\\,\\lambda(\\theta)$. The phase speed is $c_p(\\theta) = \\dfrac{\\mathrm{Re}(\\omega(\\theta))}{k} = -\\dfrac{\\mathrm{Im}(\\lambda(\\theta))}{\\theta}$, the dissipation is $d(\\theta) = -\\mathrm{Im}(\\omega(\\theta)) = -\\mathrm{Re}(\\lambda(\\theta))$, and the group velocity is $c_g(\\theta) = \\dfrac{d}{dk}\\mathrm{Re}(\\omega(\\theta))$, which you should approximate by finite differences of $\\mathrm{Re}(\\omega(\\theta))$ with respect to $k=\\theta/h$ on the given grid of $\\theta$ values.\n\n5. Identify the physical branch for each method by selecting, at the smallest $\\theta$ in the test set, the eigenvalue whose phase speed $c_p(\\theta)$ is closest to the exact speed $a$. For successive $\\theta$, continue the branch by choosing, among the eigenvalues at that $\\theta$, the one whose phase speed is closest to the previously selected branch’s phase speed.\n\n6. Compute, for each method and each $p$, the maximum absolute phase speed error $\\max_{\\theta} |c_p(\\theta)-a|$, the maximum absolute group velocity error over interior $\\theta$ values where central differences are defined, and the maximum dissipation $\\max_{\\theta} d(\\theta)$ on the given $\\theta$ grid.\n\nYour program must implement all of the above steps without using any shortcut formulas beyond the fundamental identities stated. Angles must be in radians. No physical units other than radians are involved.\n\nTest Suite:\n- Use $a=1$ and $h=1$.\n- Use polynomial degrees $p \\in \\{1,3,6\\}$.\n- For each $p$, compare the two node choices: LG and LGL.\n- Use the $\\theta$ grid $\\{\\theta_m\\}_{m=1}^9$ with $\\theta_m = \\frac{\\pi}{16} m$ for $m=1,2,\\dots,9$ (so from $\\pi/16$ to $9\\pi/16$). This tests low to moderate wavenumbers, ensuring coverage of smooth and dispersive regimes while avoiding the trivial $\\theta=0$ case.\n- For each $(p,\\text{nodes})$, produce three floats: maximum absolute phase speed error, maximum absolute group velocity error (computed via central differences on interior points only), and maximum dissipation.\n\nFinal Output Format:\n- Aggregate the results for the six comparisons in the fixed order: for $p=1$, LGL then LG; for $p=3$, LGL then LG; for $p=6$, LGL then LG.\n- For each comparison, output the three floats in the order described above.\n- Your program should produce a single line of output containing the eighteen floats as a comma-separated list enclosed in square brackets. For example: \"[f1,f2,...,f18]\".", "solution": "The objective of this problem is to perform a dispersion and dissipation analysis of the Discontinuous Galerkin Spectral Element Method (DGSEM) for the one-dimensional linear advection equation, $u_t + a\\,u_x = 0$, on a periodic domain. The analysis is conducted using a semi-discrete Fourier approach for a uniform mesh with element size $h$ and polynomial approximation of degree $p$. We are tasked with comparing two common choices for intra-element collocation nodes: Legendre-Gauss (LG) and Legendre-Gauss-Lobatto (LGL) points. The analysis requires constructing the DGSEM operator in strong form and then examining the eigenvalues of its Fourier symbol to determine key properties like phase speed, group velocity, and dissipation. Throughout the analysis, the advection speed is set to $a=1$ and the element size to $h=1$.\n\nThe solution methodology is structured as follows:\n1.  **Nodal Sets and Basis Construction**: For a given polynomial degree $p$, we first determine the $p+1$ nodes for both the LG and LGL sets within the reference element $\\xi \\in [-1, 1]$. We then construct the nodal differentiation matrix $D$ and the diagonal mass matrix $M$.\n2.  **Semi-Discrete Operator Symbol**: We define the boundary evaluation vectors $r_L$ and $r_R$ and use them to construct the Fourier symbol $A(\\theta)$ of the strong-form DGSEM operator with an upwind flux.\n3.  **Dispersion and Dissipation Analysis**: For a grid of non-dimensional wavenumbers $\\theta = kh$, we compute the eigenvalues of $A(\\theta)$. From these eigenvalues, we derive the numerical phase speed $c_p(\\theta)$, dissipation $d(\\theta)$, and group velocity $c_g(\\theta)$. A physical mode is identified and tracked across the wavenumber spectrum.\n4.  **Error Quantification**: Finally, we compute three error metrics for each configuration ($p$ and node type): the maximum absolute phase speed error $|c_p(\\theta) - a|$, the maximum absolute group velocity error $|c_g(\\theta) - a|$, and the maximum dissipation $d(\\theta)$.\n\n### Step 1: Nodal Sets, Differentiation, and Mass Matrices\n\nThe foundation of a nodal DGSEM is the set of collocation points within each element.\nFor a polynomial of degree $p$, we use $p+1$ points. Let $N=p+1$.\n-   **Legendre-Gauss (LG) nodes**: These are the $N$ roots of the Legendre polynomial $P_N(\\xi)$. These points lie strictly within the interval $(-1, 1)$.\n-   **Legendre-Gauss-Lobatto (LGL) nodes**: These are the $N$ roots of the polynomial $(1-\\xi^2)P_p'(\\xi)$. These points include the endpoints $\\xi = \\pm 1$ and the $p-1$ roots of $P_p'(\\xi)$, which are the same as the roots of the Jacobi polynomial $P_{p-1}^{(1,1)}(\\xi)$.\n\nThe differentiation matrix $D$ is constructed from the derivatives of the Lagrange basis polynomials $l_j(\\xi)$ evaluated at the nodes $\\xi_i$. The entries $D_{ij} = l_j'(\\xi_i)$ are computed using the formula derived from the polynomial $L(\\xi)$ which has the collocation nodes as its roots:\n$$ D_{ij} = \\begin{cases} \\dfrac{L'(\\xi_i)}{(\\xi_i - \\xi_j)L'(\\xi_j)}  i \\neq j \\\\ -\\sum_{k\\neq i} D_{ik}  i=j \\end{cases} $$\nThe choice of $L(\\xi)$ depends on the nodal set:\n-   For LG nodes, $L(\\xi)$ is proportional to $P_{p+1}(\\xi)$.\n-   For LGL nodes, $L(\\xi)$ is proportional to $(1-\\xi^2)P_p'(\\xi)$.\nThe values $L'(\\xi_j)$ at the nodes are computed using standard identities for Legendre polynomials and their derivatives.\n\nThe mass matrix $M$ for a collocated scheme is diagonal, with entries $M_{jj}$ being the quadrature weights $w_j$ associated with the nodes $\\xi_j$. For both LG and LGL points, these weights are well-known:\n-   For LG quadrature, the weights are given by $w_j = \\frac{2}{(1-\\xi_j^2)[P_{p+1}'(\\xi_j)]^2}$.\n-   For LGL quadrature, the weights are $w_j = \\frac{2}{p(p+1)}$ at the endpoints $\\xi_j=\\pm 1$, and $w_j = \\frac{2}{p(p+1)[P_p(\\xi_j)]^2}$ at the interior nodes.\n\n### Step 2: Boundary Vectors and Operator Symbol\n\nThe strong-form DG operator requires evaluating the solution at the element boundaries $\\xi = -1$ and $\\xi = 1$. This is achieved using boundary evaluation vectors $r_L$ and $r_R$, whose entries are the values of the Lagrange basis functions at the left and right boundaries, respectively: $(r_L)_j = l_j(-1)$ and $(r_R)_j = l_j(1)$.\n-   For LGL nodes, since $\\xi_0 = -1$ and $\\xi_p = 1$ (assuming sorted nodes), the basis functions have the property $l_j(\\pm 1) = \\delta_{j,0 \\text{ or } p}$. This simplifies $r_L$ and $r_R$ to standard basis vectors, e.g., $r_L = [1, 0, \\dots, 0]^\\top$.\n-   For LG nodes, which are all interior to the element, the values $l_j(\\pm 1)$ are non-zero and are computed using the definition of the Lagrange basis.\n\nWith these components, the Fourier symbol $A(\\theta)$ of the semi-discrete operator for the linear advection equation with an upwind flux is given by:\n$$ A(\\theta) = -\\frac{2a}{h}D - \\frac{2a}{h}M^{-1} r_L \\left( z^{-1}r_R^\\top - r_L^\\top \\right) $$\nwhere $z = e^{i\\theta}$, $i = \\sqrt{-1}$, and $\\theta=kh$ is the non-dimensional wavenumber. The term with $D$ represents the volume derivative, while the second term represents the lifted surface flux correction.\n\n### Step 3: Eigenvalue-based Analysis\n\nThe temporal evolution of a Fourier mode with wavenumber $k$ is governed by the eigenvalues $\\lambda(\\theta)$ of the symbol matrix $A(\\theta)$. For each $\\theta$, we compute the $p+1$ eigenvalues. The numerical complex angular frequency is defined as $\\omega(\\theta) = i\\lambda(\\theta)$. From this, we define:\n-   **Phase Speed**: $c_p(\\theta) = \\dfrac{\\mathrm{Re}(\\omega(\\theta))}{k} = -\\dfrac{\\mathrm{Im}(\\lambda(\\theta))}{\\theta}$. This represents the propagation speed of a single Fourier mode. The exact phase speed is $a$.\n-   **Dissipation**: $d(\\theta) = -\\mathrm{Im}(\\omega(\\theta)) = -\\mathrm{Re}(\\lambda(\\theta))$. This represents the exponential decay rate of a mode's amplitude. For the exact equation, dissipation is zero.\n-   **Group Velocity**: $c_g(\\theta) = \\dfrac{d}{dk}\\mathrm{Re}(\\omega(\\theta))$. This represents the propagation speed of a wave packet. The exact group velocity is $a$. We approximate this using central finite differences on the grid of $\\theta$ values.\n\nA critical step is to identify the \"physical branch\" of eigenvalues, corresponding to the mode that correctly approximates the physical wave propagation. Starting with the smallest non-zero $\\theta$, we select the eigenvalue whose phase speed $c_p$ is closest to the exact speed $a=1$. For subsequent values of $\\theta$, we maintain continuity by selecting the eigenvalue whose phase speed is closest to that of the previously selected physical mode.\n\n### Step 4: Error Computation\n\nAfter identifying the physical branch properties across the specified grid of $\\theta$ values, we quantify the performance of each scheme ($p$, node type) by calculating three metrics:\n1.  The maximum absolute phase speed error, $\\max_{\\theta} |c_p(\\theta) - a|$.\n2.  The maximum absolute group velocity error, $\\max_{\\theta_{\\text{int}}} |c_g(\\theta) - a|$, computed over the interior points of the $\\theta$ grid where central differences are defined.\n3.  The maximum dissipation, $\\max_{\\theta} d(\\theta)$.\n\nThese metrics provide a concise summary of the scheme's accuracy in terms of wave propagation and amplitude preservation. The following program implements this entire procedure.", "answer": "[0.05206974868494056,0.10332857418706376,0.0,0.0034633219460265636,0.010375990262174313,0.0,0.001602952876615797,0.006404987050212871,0.0,0.00010839841804246872,0.0006497746561141443,0.0,4.887693952994964e-05,0.0003906356070749007,0.0,7.391694767176166e-08,8.865910372861214e-07,0.0]", "id": "3370734"}]}