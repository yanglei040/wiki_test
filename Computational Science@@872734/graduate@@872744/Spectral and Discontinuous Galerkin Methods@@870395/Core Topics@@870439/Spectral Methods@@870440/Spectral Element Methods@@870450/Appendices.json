{"hands_on_practices": [{"introduction": "In the spectral element method, we can represent a solution within an element in two equivalent ways: as a sum of weighted orthogonal polynomials (a modal basis) or by its values at specific grid points (a nodal basis). This first exercise bridges these two perspectives by tasking you with deriving the explicit transformation matrix between them. Mastering this connection is a key first step, clarifying how the abstract mathematical structure of Legendre polynomials directly relates to the tangible nodal data used in computations. [@problem_id:3417899]", "problem": "Consider a one-dimensional spectral element representation on the reference interval $[-1,1]$ with polynomial degree $p$. Let $\\{P_{k}(x)\\}_{k=0}^{p}$ denote the classical Legendre polynomials, defined by the recurrence relation and orthogonality on $[-1,1]$ with unit weight, and normalized so that $P_{0}(x)=1$, $P_{1}(x)=x$, $P_{2}(x)=\\frac{1}{2}(3x^{2}-1)$, and $P_{3}(x)=\\frac{1}{2}(5x^{3}-3x)$. Let $\\{x_{i}\\}_{i=0}^{p}$ denote the Gauss–Lobatto–Legendre (GLL) points, defined as the endpoints $x_{0}=-1$ and $x_{p}=1$ together with the $p-1$ interior points that are the distinct roots of $P_{p}'(x)$. Let $\\{\\ell_{i}(x)\\}_{i=0}^{p}$ denote the Lagrange cardinal polynomials at the GLL points, i.e., $\\ell_{i}(x_{j})=\\delta_{ij}$ for all $i,j$.\n\nA polynomial $u(x)$ of degree at most $p$ can be represented in a modal Legendre expansion $u(x)=\\sum_{k=0}^{p} a_{k} P_{k}(x)$ with modal coefficients $\\{a_{k}\\}$, or in a nodal Lagrange form $u(x)=\\sum_{i=0}^{p} u_{i} \\ell_{i}(x)$ where $u_{i}=u(x_{i})$ are the nodal values at the GLL points. Starting from the fundamental definitions of Legendre polynomials and Lagrange interpolation, derive the linear transform that maps the modal Legendre coefficients $\\{a_{k}\\}_{k=0}^{p}$ to the nodal Lagrange values $\\{u_{i}\\}_{i=0}^{p}$ at the GLL points. Then, for the case $p=3$ on $[-1,1]$, explicitly compute this transform matrix by determining each of its entries in exact form.\n\nYour final answer must be the $4\\times 4$ transform matrix for $p=3$, written in closed form with exact rational and radical values. No rounding is required or permitted.", "solution": "The user-provided problem statement has been analyzed and is deemed valid. It is scientifically grounded in the mathematical theory of orthogonal polynomials and numerical analysis, it is well-posed with a unique and meaningful solution, and it is expressed in objective, formal language. The problem is self-contained and free of contradictions or ambiguities.\n\nThe objective is to derive the linear transformation that maps the modal Legendre coefficients, $\\{a_{k}\\}_{k=0}^{p}$, of a polynomial $u(x)$ to its nodal values, $\\{u_{i}\\}_{i=0}^{p}$, at the Gauss-Lobatto-Legendre (GLL) points. We must then compute this transformation matrix explicitly for the case where the polynomial degree is $p=3$.\n\nLet $u(x)$ be a polynomial of degree at most $p$. Its modal representation in the Legendre basis is given by\n$$u(x) = \\sum_{k=0}^{p} a_{k} P_{k}(x)$$\nwhere $\\{a_{k}\\}_{k=0}^{p}$ are the modal coefficients and $\\{P_{k}(x)\\}_{k=0}^{p}$ are the Legendre polynomials.\n\nThe nodal representation of the same polynomial is given by\n$$u(x) = \\sum_{j=0}^{p} u_{j} \\ell_{j}(x)$$\nwhere $\\{u_{j}\\}_{j=0}^{p}$ are the nodal values at the GLL points $\\{x_{j}\\}_{j=0}^{p}$, i.e., $u_{j} = u(x_{j})$, and $\\{\\ell_{j}(x)\\}_{j=0}^{p}$ are the Lagrange cardinal polynomials satisfying $\\ell_{j}(x_{i}) = \\delta_{ij}$.\n\nTo find the relationship between the modal coefficients $\\{a_{k}\\}$ and the nodal values $\\{u_{i}\\}$, we evaluate the modal representation at each of the GLL points $x_{i}$ for $i=0, 1, \\dots, p$:\n$$u_{i} = u(x_{i}) = \\sum_{k=0}^{p} a_{k} P_{k}(x_{i})$$\nThis equation provides a system of $p+1$ linear equations relating the nodal values to the modal coefficients. We can express this system in matrix form. Let $\\mathbf{u}$ be the column vector of nodal values and $\\mathbf{a}$ be the column vector of modal coefficients:\n$$\\mathbf{u} = \\begin{pmatrix} u_0 \\\\ u_1 \\\\ \\vdots \\\\ u_p \\end{pmatrix}, \\quad \\mathbf{a} = \\begin{pmatrix} a_0 \\\\ a_1 \\\\ \\vdots \\\\ a_p \\end{pmatrix}$$\nThe linear transformation is given by $\\mathbf{u} = T \\mathbf{a}$, where $T$ is the $(p+1) \\times (p+1)$ transformation matrix. From the summation, we can identify the entries of this matrix. The equation for the $i$-th nodal value is:\n$$u_i = P_{0}(x_i)a_0 + P_{1}(x_i)a_1 + \\dots + P_{p}(x_i)a_p$$\nThus, the entry in the $i$-th row and $k$-th column of the matrix $T$ (using $0$-based indexing for both rows and columns) is given by:\n$$T_{ik} = P_{k}(x_{i})$$\n\nNow, we will compute this matrix explicitly for the case $p=3$. The matrix will be a $4 \\times 4$ matrix, with indices $i, k$ ranging from $0$ to $3$.\n\nFirst, we must determine the GLL points $\\{x_i\\}_{i=0}^3$. By definition, these are the endpoints of the interval $[-1, 1]$ and the roots of the derivative of $P_3(x)$.\nThe Legendre polynomials are given as:\n$P_0(x) = 1$\n$P_1(x) = x$\n$P_2(x) = \\frac{1}{2}(3x^2 - 1)$\n$P_3(x) = \\frac{1}{2}(5x^3 - 3x)$\n\nThe derivative of $P_3(x)$ is:\n$$P_3'(x) = \\frac{d}{dx}\\left(\\frac{1}{2}(5x^3 - 3x)\\right) = \\frac{1}{2}(15x^2 - 3)$$\nSetting $P_3'(x) = 0$ to find the interior GLL points:\n$$\\frac{1}{2}(15x^2 - 3) = 0 \\implies 15x^2 = 3 \\implies x^2 = \\frac{3}{15} = \\frac{1}{5}$$\nThe roots are $x = \\pm \\frac{1}{\\sqrt{5}} = \\pm \\frac{\\sqrt{5}}{5}$.\nThe set of GLL points, ordered from smallest to largest, is:\n$x_0 = -1$\n$x_1 = -\\frac{\\sqrt{5}}{5}$\n$x_2 = \\frac{\\sqrt{5}}{5}$\n$x_3 = 1$\n\nNext, we construct the transformation matrix $T$ by evaluating $P_k(x_i)$ for $k, i \\in \\{0, 1, 2, 3\\}$.\n$$\nT = \\begin{pmatrix}\nP_0(x_0) & P_1(x_0) & P_2(x_0) & P_3(x_0) \\\\\nP_0(x_1) & P_1(x_1) & P_2(x_1) & P_3(x_1) \\\\\nP_0(x_2) & P_1(x_2) & P_2(x_2) & P_3(x_2) \\\\\nP_0(x_3) & P_1(x_3) & P_2(x_3) & P_3(x_3)\n\\end{pmatrix}\n$$\n\nLet's compute the entries for each row:\n\nRow 1: $x_0 = -1$. Using the general property $P_k(-1) = (-1)^k$:\n$T_{00} = P_0(-1) = 1$\n$T_{01} = P_1(-1) = -1$\n$T_{02} = P_2(-1) = 1$\n$T_{03} = P_3(-1) = -1$\n\nRow 2: $x_1 = -\\frac{\\sqrt{5}}{5}$.\n$T_{10} = P_0(-\\frac{\\sqrt{5}}{5}) = 1$\n$T_{11} = P_1(-\\frac{\\sqrt{5}}{5}) = -\\frac{\\sqrt{5}}{5}$\n$T_{12} = P_2(-\\frac{\\sqrt{5}}{5}) = \\frac{1}{2}\\left(3\\left(-\\frac{\\sqrt{5}}{5}\\right)^2 - 1\\right) = \\frac{1}{2}\\left(3\\left(\\frac{5}{25}\\right) - 1\\right) = \\frac{1}{2}\\left(\\frac{3}{5} - 1\\right) = \\frac{1}{2}\\left(-\\frac{2}{5}\\right) = -\\frac{1}{5}$\n$T_{13} = P_3(-\\frac{\\sqrt{5}}{5}) = \\frac{1}{2}\\left(5\\left(-\\frac{\\sqrt{5}}{5}\\right)^3 - 3\\left(-\\frac{\\sqrt{5}}{5}\\right)\\right) = \\frac{1}{2}\\left(5\\left(-\\frac{5\\sqrt{5}}{125}\\right) + \\frac{3\\sqrt{5}}{5}\\right) = \\frac{1}{2}\\left(-\\frac{\\sqrt{5}}{5} + \\frac{3\\sqrt{5}}{5}\\right) = \\frac{1}{2}\\left(\\frac{2\\sqrt{5}}{5}\\right) = \\frac{\\sqrt{5}}{5}$\n\nRow 3: $x_2 = \\frac{\\sqrt{5}}{5}$. We can use the symmetry properties of Legendre polynomials: $P_k(-x) = (-1)^k P_k(x)$.\n$T_{20} = P_0(\\frac{\\sqrt{5}}{5}) = P_0(-\\frac{\\sqrt{5}}{5}) = 1$\n$T_{21} = P_1(\\frac{\\sqrt{5}}{5}) = -P_1(-\\frac{\\sqrt{5}}{5}) = -(-\\frac{\\sqrt{5}}{5}) = \\frac{\\sqrt{5}}{5}$\n$T_{22} = P_2(\\frac{\\sqrt{5}}{5}) = P_2(-\\frac{\\sqrt{5}}{5}) = -\\frac{1}{5}$\n$T_{23} = P_3(\\frac{\\sqrt{5}}{5}) = -P_3(-\\frac{\\sqrt{5}}{5}) = -\\frac{\\sqrt{5}}{5}$\n\nRow 4: $x_3 = 1$. Using the general property $P_k(1) = 1$:\n$T_{30} = P_0(1) = 1$\n$T_{31} = P_1(1) = 1$\n$T_{32} = P_2(1) = 1$\n$T_{33} = P_3(1) = 1$\n\nAssembling the matrix $T$ with these evaluated entries gives the final result:\n$$\nT = \\begin{pmatrix}\n1 & -1 & 1 & -1 \\\\\n1 & -\\frac{\\sqrt{5}}{5} & -\\frac{1}{5} & \\frac{\\sqrt{5}}{5} \\\\\n1 & \\frac{\\sqrt{5}}{5} & -\\frac{1}{5} & -\\frac{\\sqrt{5}}{5} \\\\\n1 & 1 & 1 & 1\n\\end{pmatrix}\n$$\nThis is the required $4 \\times 4$ transformation matrix that maps modal Legendre coefficients to nodal Lagrange values for $p=3$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 & -1 & 1 & -1 \\\\\n1 & -\\frac{\\sqrt{5}}{5} & -\\frac{1}{5} & \\frac{\\sqrt{5}}{5} \\\\\n1 & \\frac{\\sqrt{5}}{5} & -\\frac{1}{5} & -\\frac{\\sqrt{5}}{5} \\\\\n1 & 1 & 1 & 1\n\\end{pmatrix}\n}\n$$", "id": "3417899"}, {"introduction": "With a firm grasp of the polynomial basis, we can now tackle the central task of any finite-element-type method: discretizing a partial differential equation. This practice guides you through the process of deriving the local mass and curl-curl (stiffness) matrices for a problem in computational electromagnetics, governed by the $H(\\mathrm{curl})$ space. By applying the appropriate coordinate transformations and numerical quadrature rules, you will see how the continuous variational formulation of a PDE is translated into the discrete algebraic system that a computer can solve. [@problem_id:3350042]", "problem": "Consider the time-harmonic Maxwell curl-curl formulation for the electric field, posed in the Sobolev space of square-integrable vector fields with square-integrable curl, denoted by $H(\\mathrm{curl},\\Omega)$, on a bounded Lipschitz domain $\\Omega \\subset \\mathbb{R}^{3}$. Let the local (element-level) variational problem on a single hexahedral element $\\Omega_{e}$ be based on the bilinear forms\n$$\na(\\boldsymbol{u},\\boldsymbol{v}) \\equiv \\int_{\\Omega_{e}} \\left( \\nabla \\times \\boldsymbol{u} \\right) \\cdot \\left( \\nabla \\times \\boldsymbol{v} \\right) \\, \\mathrm{d}\\boldsymbol{x}, \n\\qquad \nm(\\boldsymbol{u},\\boldsymbol{v}) \\equiv \\int_{\\Omega_{e}} \\boldsymbol{u} \\cdot \\boldsymbol{v} \\, \\mathrm{d}\\boldsymbol{x}.\n$$\nAdopt a Spectral Element Method with tensor-product $H(\\mathrm{curl})$-conforming basis functions defined on the reference element $\\hat{\\Omega} = [-1,1]^{3}$, using a Gauss–Lobatto–Legendre (GLL) quadrature rule with $N+1$ nodes in each coordinate direction. Denote the one-dimensional GLL nodes and weights by $\\{\\xi_{i},w_{i}\\}_{i=0}^{N}$, and let $\\{\\hat{l}_{j}\\}_{j=0}^{N}$ be the associated one-dimensional Lagrange interpolants on $\\hat{\\Omega}$. Define one-dimensional edge functions $\\{\\hat{e}_{i}\\}_{i=0}^{N-1}$ along each coordinate direction so that the three families of tensor-product $H(\\mathrm{curl})$ basis functions on $\\hat{\\Omega}$ are\n$$\n\\hat{\\boldsymbol{\\phi}}_{i j k}^{(1)}(\\xi,\\eta,\\zeta) = \\hat{e}_{i}(\\xi)\\,\\hat{l}_{j}(\\eta)\\,\\hat{l}_{k}(\\zeta)\\,\\boldsymbol{e}_{x}, \n\\quad \n\\hat{\\boldsymbol{\\phi}}_{i j k}^{(2)}(\\xi,\\eta,\\zeta) = \\hat{l}_{i}(\\xi)\\,\\hat{e}_{j}(\\eta)\\,\\hat{l}_{k}(\\zeta)\\,\\boldsymbol{e}_{y}, \n\\quad \n\\hat{\\boldsymbol{\\phi}}_{i j k}^{(3)}(\\xi,\\eta,\\zeta) = \\hat{l}_{i}(\\xi)\\,\\hat{l}_{j}(\\eta)\\,\\hat{e}_{k}(\\zeta)\\,\\boldsymbol{e}_{z},\n$$\nwith $i,j,k$ running over their natural ranges, and where $\\boldsymbol{e}_{x},\\boldsymbol{e}_{y},\\boldsymbol{e}_{z}$ are the Cartesian unit vectors.\n\nAssume $\\Omega_{e}$ is the image of $\\hat{\\Omega}$ under an affine map $\\boldsymbol{x} = \\boldsymbol{F}(\\boldsymbol{\\xi})$ whose Jacobian matrix is diagonal,\n$$\nJ \\equiv \\frac{\\partial \\boldsymbol{x}}{\\partial \\boldsymbol{\\xi}} = \\mathrm{diag}\\!\\left(\\frac{h_{x}}{2},\\,\\frac{h_{y}}{2},\\,\\frac{h_{z}}{2}\\right),\n$$\nwith $h_{x},h_{y},h_{z} > 0$ the element side lengths in the physical coordinates. Use the $H(\\mathrm{curl})$ covariant Piola transform to map reference basis functions to physical space,\n$$\n\\boldsymbol{\\phi}(\\boldsymbol{x}) = J^{-T}\\,\\hat{\\boldsymbol{\\phi}}(\\boldsymbol{\\xi}), \n\\qquad \n\\nabla_{\\boldsymbol{x}} \\times \\boldsymbol{\\phi}(\\boldsymbol{x}) = \\frac{1}{\\det(J)}\\,J\\,\\left(\\nabla_{\\boldsymbol{\\xi}} \\times \\hat{\\boldsymbol{\\phi}}(\\boldsymbol{\\xi})\\right),\n$$\nand approximate element integrals by tensor-product Gauss–Lobatto–Legendre quadrature. Starting from the $H(\\mathrm{curl})$ variational form, derive algebraic expressions for the element-level mass and curl-curl matrices in terms of the GLL nodes and weights, the tensor-product basis evaluations, and the metric factors $J^{-1}J^{-T}$ and $J^{T}J$.\n\nYour derivation must start from the definitions of the bilinear forms $a(\\cdot,\\cdot)$ and $m(\\cdot,\\cdot)$, apply the appropriate Piola transform identities, and then apply the tensor-product GLL quadrature to obtain discrete expressions that are valid for arbitrary polynomial degree $N$ and anisotropic element sizes $h_{x},h_{y},h_{z}$. Express the final mass and curl-curl matrix entries entirely in terms of sums over one-dimensional quadrature nodes and weights and reference basis function evaluations and their reference curls. The final answer must be a single closed-form analytic expression containing both formulas, written as a row matrix using the LaTeX $\\mathrm{pmatrix}$ environment. No numerical evaluation is required.", "solution": "The problem is valid. It is a well-posed, scientifically grounded problem in computational electromagnetics that requests the derivation of standard algebraic forms for spectral element matrices. All necessary information is provided.\n\nThe objective is to derive the algebraic expressions for the entries of the element-level mass matrix $M_e$ and curl-curl (stiffness) matrix $S_e$ resulting from the discretization of the bilinear forms $m(\\cdot,\\cdot)$ and $a(\\cdot,\\cdot)$ using the Spectral Element Method. Let $\\boldsymbol{u}$ and $\\boldsymbol{v}$ be two arbitrary $H(\\mathrm{curl})$-conforming physical basis functions on the element $\\Omega_e$. Their corresponding basis functions on the reference element $\\hat{\\Omega} = [-1,1]^3$ are denoted by $\\hat{\\boldsymbol{u}}$ and $\\hat{\\boldsymbol{v}}$. The matrices entries are given by $m(\\boldsymbol{u},\\boldsymbol{v})$ and $a(\\boldsymbol{u},\\boldsymbol{v})$.\n\nFirst, we derive the expression for the mass matrix entry, $m(\\boldsymbol{u},\\boldsymbol{v})$.\nStarting from the definition on the physical element $\\Omega_e$:\n$$m(\\boldsymbol{u},\\boldsymbol{v}) = \\int_{\\Omega_{e}} \\boldsymbol{u}(\\boldsymbol{x}) \\cdot \\boldsymbol{v}(\\boldsymbol{x}) \\, \\mathrm{d}\\boldsymbol{x}$$\nWe perform a change of variables to the reference element $\\hat{\\Omega}$ using the affine map $\\boldsymbol{x} = \\boldsymbol{F}(\\boldsymbol{\\xi})$. The differential volume element transforms as $\\mathrm{d}\\boldsymbol{x} = \\det(J) \\, \\mathrm{d}\\boldsymbol{\\xi}$, where $J$ is the Jacobian of the map.\n$$m(\\boldsymbol{u},\\boldsymbol{v}) = \\int_{\\hat{\\Omega}} \\boldsymbol{u}(\\boldsymbol{F}(\\boldsymbol{\\xi})) \\cdot \\boldsymbol{v}(\\boldsymbol{F}(\\boldsymbol{\\xi})) \\, \\det(J) \\, \\mathrm{d}\\boldsymbol{\\xi}$$\nThe $H(\\mathrm{curl})$ covariant Piola transform relates the physical basis functions to the reference basis functions: $\\boldsymbol{u}(\\boldsymbol{x}) = J^{-T}\\,\\hat{\\boldsymbol{u}}(\\boldsymbol{\\xi})$ and $\\boldsymbol{v}(\\boldsymbol{x}) = J^{-T}\\,\\hat{\\boldsymbol{v}}(\\boldsymbol{\\xi})$. Substituting these into the integral gives:\n$$m(\\boldsymbol{u},\\boldsymbol{v}) = \\int_{\\hat{\\Omega}} \\left( J^{-T}\\,\\hat{\\boldsymbol{u}}(\\boldsymbol{\\xi}) \\right) \\cdot \\left( J^{-T}\\,\\hat{\\boldsymbol{v}}(\\boldsymbol{\\xi}) \\right) \\, \\det(J) \\, \\mathrm{d}\\boldsymbol{\\xi}$$\nThe dot product can be rewritten as $\\left( J^{-T}\\hat{\\boldsymbol{u}} \\right) \\cdot \\left( J^{-T}\\hat{\\boldsymbol{v}} \\right) = \\hat{\\boldsymbol{u}}^{T} (J^{-T})^{T} J^{-T} \\hat{\\boldsymbol{v}} = \\hat{\\boldsymbol{u}}^{T} (J^{-1} J^{-T}) \\hat{\\boldsymbol{v}}$. The term $J^{-1} J^{-T}$ is the metric tensor associated with the mass matrix.\n$$m(\\boldsymbol{u},\\boldsymbol{v}) = \\int_{\\hat{\\Omega}} \\hat{\\boldsymbol{u}}(\\boldsymbol{\\xi}) \\cdot \\left( (J^{-1} J^{-T}) \\hat{\\boldsymbol{v}}(\\boldsymbol{\\xi}) \\right) \\, \\det(J) \\, \\mathrm{d}\\boldsymbol{\\xi}$$\nThe integral is approximated using a $3$D tensor-product Gauss-Lobatto-Legendre (GLL) quadrature rule with nodes $\\boldsymbol{\\xi}_{rst} = (\\xi_r, \\xi_s, \\xi_t)$ and weights $W_{rst} = w_r w_s w_t$ for $r,s,t \\in \\{0, 1, \\dots, N\\}$.\n$$m(\\boldsymbol{u},\\boldsymbol{v}) \\approx \\sum_{r=0}^{N}\\sum_{s=0}^{N}\\sum_{t=0}^{N} \\left[ \\hat{\\boldsymbol{u}} \\cdot \\left( (J^{-1} J^{-T}) \\hat{\\boldsymbol{v}} \\right) \\det(J) \\right]_{\\boldsymbol{\\xi}=\\boldsymbol{\\xi}_{rst}} w_r w_s w_t$$\nGiven $J = \\mathrm{diag}(h_x/2, h_y/2, h_z/2)$, we have $\\det(J) = \\frac{h_x h_y h_z}{8}$ and $J^{-1}J^{-T} = (J^{-1})^2 = \\mathrm{diag}(4/h_x^2, 4/h_y^2, 4/h_z^2)$. Let $\\hat{\\boldsymbol{u}} = (\\hat{u}_x, \\hat{u}_y, \\hat{u}_z)$ and $\\hat{\\boldsymbol{v}} = (\\hat{v}_x, \\hat{v}_y, \\hat{v}_z)$. The term in the sum becomes:\n$$ \\left( \\frac{h_x h_y h_z}{8} \\right) \\left( \\frac{4}{h_x^2} \\hat{u}_x \\hat{v}_x + \\frac{4}{h_y^2} \\hat{u}_y \\hat{v}_y + \\frac{4}{h_z^2} \\hat{u}_z \\hat{v}_z \\right) = \\frac{h_y h_z}{2 h_x} \\hat{u}_x \\hat{v}_x + \\frac{h_x h_z}{2 h_y} \\hat{u}_y \\hat{v}_y + \\frac{h_x h_y}{2 h_z} \\hat{u}_z \\hat{v}_z$$\nSo, the discretized mass matrix entry is:\n$$m(\\boldsymbol{u},\\boldsymbol{v}) \\approx \\sum_{r=0}^{N}\\sum_{s=0}^{N}\\sum_{t=0}^{N} \\left( \\frac{h_y h_z}{2 h_x} \\hat{u}_x \\hat{v}_x + \\frac{h_x h_z}{2 h_y} \\hat{u}_y \\hat{v}_y + \\frac{h_x h_y}{2 h_z} \\hat{u}_z \\hat{v}_z \\right)_{\\boldsymbol{\\xi}_{rst}} w_r w_s w_t$$\n\nNext, we derive the expression for the curl-curl matrix entry, $a(\\boldsymbol{u},\\boldsymbol{v})$.\nStarting from the definition on $\\Omega_e$:\n$$a(\\boldsymbol{u},\\boldsymbol{v}) = \\int_{\\Omega_{e}} \\left( \\nabla_{\\boldsymbol{x}} \\times \\boldsymbol{u}(\\boldsymbol{x}) \\right) \\cdot \\left( \\nabla_{\\boldsymbol{x}} \\times \\boldsymbol{v}(\\boldsymbol{x}) \\right) \\, \\mathrm{d}\\boldsymbol{x}$$\nChanging variables to the reference element $\\hat{\\Omega}$:\n$$a(\\boldsymbol{u},\\boldsymbol{v}) = \\int_{\\hat{\\Omega}} \\left( \\nabla_{\\boldsymbol{x}} \\times \\boldsymbol{u} \\right) \\cdot \\left( \\nabla_{\\boldsymbol{x}} \\times \\boldsymbol{v} \\right) \\det(J) \\, \\mathrm{d}\\boldsymbol{\\xi}$$\nThe transformation rule for the curl under the Piola transform is given as $\\nabla_{\\boldsymbol{x}} \\times \\boldsymbol{u}(\\boldsymbol{x}) = \\frac{1}{\\det(J)} J (\\nabla_{\\boldsymbol{\\xi}} \\times \\hat{\\boldsymbol{u}}(\\boldsymbol{\\xi}))$. Substituting this:\n$$a(\\boldsymbol{u},\\boldsymbol{v}) = \\int_{\\hat{\\Omega}} \\left( \\frac{1}{\\det(J)} J (\\nabla_{\\boldsymbol{\\xi}} \\times \\hat{\\boldsymbol{u}}) \\right) \\cdot \\left( \\frac{1}{\\det(J)} J (\\nabla_{\\boldsymbol{\\xi}} \\times \\hat{\\boldsymbol{v}}) \\right) \\det(J) \\, \\mathrm{d}\\boldsymbol{\\xi}$$\n$$a(\\boldsymbol{u},\\boldsymbol{v}) = \\frac{1}{\\det(J)} \\int_{\\hat{\\Omega}} \\left( J (\\nabla_{\\boldsymbol{\\xi}} \\times \\hat{\\boldsymbol{u}}) \\right) \\cdot \\left( J (\\nabla_{\\boldsymbol{\\xi}} \\times \\hat{\\boldsymbol{v}}) \\right) \\, \\mathrm{d}\\boldsymbol{\\xi}$$\nThe dot product can be rewritten using the metric tensor $J^T J$: $\\left( J (\\nabla_{\\boldsymbol{\\xi}} \\times \\hat{\\boldsymbol{u}}) \\right) \\cdot \\left( J (\\nabla_{\\boldsymbol{\\xi}} \\times \\hat{\\boldsymbol{v}}) \\right) = (\\nabla_{\\boldsymbol{\\xi}} \\times \\hat{\\boldsymbol{u}}) \\cdot (J^T J (\\nabla_{\\boldsymbol{\\xi}} \\times \\hat{\\boldsymbol{v}}))$.\n$$a(\\boldsymbol{u},\\boldsymbol{v}) = \\frac{1}{\\det(J)} \\int_{\\hat{\\Omega}} (\\nabla_{\\boldsymbol{\\xi}} \\times \\hat{\\boldsymbol{u}}) \\cdot (J^T J (\\nabla_{\\boldsymbol{\\xi}} \\times \\hat{\\boldsymbol{v}})) \\, \\mathrm{d}\\boldsymbol{\\xi}$$\nApplying the GLL quadrature rule:\n$$a(\\boldsymbol{u},\\boldsymbol{v}) \\approx \\sum_{r=0}^{N}\\sum_{s=0}^{N}\\sum_{t=0}^{N} \\left[ \\frac{1}{\\det(J)} (\\nabla_{\\boldsymbol{\\xi}} \\times \\hat{\\boldsymbol{u}}) \\cdot (J^T J (\\nabla_{\\boldsymbol{\\xi}} \\times \\hat{\\boldsymbol{v}})) \\right]_{\\boldsymbol{\\xi}=\\boldsymbol{\\xi}_{rst}} w_r w_s w_t$$\nUsing $J^T J = J^2 = \\mathrm{diag}(h_x^2/4, h_y^2/4, h_z^2/4)$ and $\\det(J) = \\frac{h_x h_y h_z}{8}$:\n$$ \\frac{1}{\\det(J)} \\left( \\frac{h_x^2}{4} (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{u}})_x (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{v}})_x + \\dots \\right) = \\frac{8}{h_x h_y h_z} \\left( \\frac{h_x^2}{4} (\\dots) + \\dots \\right) $$\n$$ = \\frac{2 h_x}{h_y h_z} (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{u}})_x (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{v}})_x + \\frac{2 h_y}{h_x h_z} (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{u}})_y (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{v}})_y + \\frac{2 h_z}{h_x h_y} (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{u}})_z (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{v}})_z $$\nSo, the discretized curl-curl matrix entry is:\n$$a(\\boldsymbol{u},\\boldsymbol{v}) \\approx \\sum_{r=0}^{N}\\sum_{s=0}^{N}\\sum_{t=0}^{N} \\left( \\frac{2h_x}{h_y h_z} (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{u}})_x (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{v}})_x + \\frac{2h_y}{h_x h_z} (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{u}})_y (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{v}})_y + \\frac{2h_z}{h_x h_y} (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{u}})_z (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{v}})_z \\right)_{\\boldsymbol{\\xi}_{rst}} w_r w_s w_t$$\nwhere $(\\cdot)_{\\boldsymbol{\\xi}_{rst}}$ denotes evaluation at the quadrature point $\\boldsymbol{\\xi}_{rst}$. These expressions are the algebraic forms for the element-level mass and curl-curl matrix entries.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nm(\\boldsymbol{u},\\boldsymbol{v}) = \\sum_{r,s,t=0}^{N} w_r w_s w_t \\left( \\frac{h_y h_z}{2 h_x} \\hat{u}_x \\hat{v}_x + \\frac{h_x h_z}{2 h_y} \\hat{u}_y \\hat{v}_y + \\frac{h_x h_y}{2 h_z} \\hat{u}_z \\hat{v}_z \\right)_{\\boldsymbol{\\xi}_{rst}}\n&\na(\\boldsymbol{u},\\boldsymbol{v}) = \\sum_{r,s,t=0}^{N} w_r w_s w_t \\left( \\frac{2h_x}{h_y h_z} (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{u}})_x (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{v}})_x + \\frac{2h_y}{h_x h_z} (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{u}})_y (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{v}})_y + \\frac{2h_z}{h_x h_y} (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{u}})_z (\\nabla_{\\boldsymbol{\\xi}}\\times\\hat{\\boldsymbol{v}})_z \\right)_{\\boldsymbol{\\xi}_{rst}}\n\\end{pmatrix}\n}\n$$", "id": "3350042"}, {"introduction": "While deriving elemental matrices is instructive, assembling and storing them for high polynomial degrees becomes prohibitively expensive. The true power of SEM on structured elements lies in avoiding this step. This final practice introduces the efficient, matrix-free evaluation of differential operators by exploiting the method's tensor-product structure. You will implement and verify a 3D gradient operator, learning how to apply a small 1D differentiation matrix along each coordinate axis, a technique fundamental to the performance of modern SEM codes. [@problem_id:3417928]", "problem": "Consider the spectral element method on the one-dimensional reference interval $[-1,1]$ using Gauss–Lobatto–Legendre points. Let $p$ denote the polynomial degree and let $N=p+1$ denote the number of interpolation points (including endpoints). The one-dimensional interpolation basis consists of Lagrange polynomials $L_i(x)$, $i=0,\\dots,N-1$, defined with respect to the Gauss–Lobatto–Legendre points $\\{x_i\\}_{i=0}^{N-1}\\in[-1,1]$. The Gauss–Lobatto–Legendre points are given by the endpoints $x_0=-1$, $x_{N-1}=1$, and the internal nodes are the zeros of the derivative of the Legendre polynomial of degree $p$, denoted by $P_p'(x)=0$. The Gauss–Lobatto–Legendre quadrature weights $w_i$ satisfy the identity $w_i>0$, $i=0,\\dots,N-1$, and the quadrature is exact for polynomials up to degree $2p-1$.\n\nStarting from the definition of the Lagrange interpolation polynomials $L_i(x)$ built on a distinct node set $\\{x_0,\\dots,x_{N-1}\\}$, the one-dimensional differentiation matrix $D\\in\\mathbb{R}^{N\\times N}$ is defined by $D_{ij}=L_j'(x_i)$, where $L_j'(x)$ denotes the derivative of $L_j(x)$ with respect to $x$. In the three-dimensional reference hexahedron $[-1,1]^3$ with coordinates $(\\xi,\\eta,\\zeta)$, the spectral element tensor-product basis is $L_i(\\xi) L_j(\\eta) L_k(\\zeta)$, and any nodal field $u(\\xi,\\eta,\\zeta)$ sampled at the three-dimensional Gauss–Lobatto–Legendre grid $\\{(\\xi_i,\\eta_j,\\zeta_k)\\}_{i,j,k=0}^{N-1}$ can be differentiated by tensor-product application of the one-dimensional differentiation matrix along each coordinate direction to obtain the gradient components $\\partial u/\\partial \\xi$, $\\partial u/\\partial \\eta$, and $\\partial u/\\partial \\zeta$.\n\nYour tasks are:\n\n1. Construct the Gauss–Lobatto–Legendre nodes $\\{x_i\\}_{i=0}^{N-1}$ and quadrature weights $\\{w_i\\}_{i=0}^{N-1}$ for $p=4$ on $[-1,1]$, starting from the definition involving the Legendre polynomial $P_p(x)$ and its derivative $P_p'(x)$.\n2. Using only the definition of Lagrange interpolation polynomials on a distinct node set, derive and assemble the one-dimensional differentiation matrix $D\\in\\mathbb{R}^{N\\times N}$ such that $D_{ij}=L_j'(x_i)$ for $i,j=0,\\dots,N-1$.\n3. Show how tensor products of the one-dimensional differentiation matrix form the three-dimensional gradient on the reference hexahedron $[-1,1]^3$, and implement a matrix-free evaluation strategy (i.e., apply one-dimensional matrices along each axis without assembling a global three-dimensional differentiation operator) to compute $\\nabla u=(\\partial u/\\partial \\xi,\\partial u/\\partial \\eta,\\partial u/\\partial \\zeta)$ at all Gauss–Lobatto–Legendre grid points for a single hexahedral element with $p=4$ (thus $N=5$ along each axis).\n\nAngles must be interpreted in radians. There are no physical units required.\n\nFor verification, evaluate the matrix-free gradient for the following four test fields $u(\\xi,\\eta,\\zeta)$ defined on the reference element:\n\n- Test A (constant field): $u(\\xi,\\eta,\\zeta)=3.14$.\n- Test B (polynomial field of degree at most $p$ per coordinate): $u(\\xi,\\eta,\\zeta)=\\xi^4+\\eta^3+\\zeta^2$.\n- Test C (smooth non-polynomial field): $u(\\xi,\\eta,\\zeta)=\\sin(\\xi)\\cos(\\eta)e^{\\zeta}$.\n- Test D (anisotropic mixed field): $u(\\xi,\\eta,\\zeta)=\\xi\\eta+\\eta\\zeta^4+\\cos(\\xi+\\eta+\\zeta)$.\n\nFor each test, compute the exact gradient analytically on the reference element and compare it with the numerical gradient obtained by the matrix-free tensor-product evaluation. For each test, report a single floating-point number equal to the maximum absolute error over all grid points and over all three gradient components, namely\n$$\nE=\\max_{i,j,k\\in\\{0,\\dots,N-1\\}} \\max\\left( \\left|\\frac{\\partial u}{\\partial \\xi}(\\xi_i,\\eta_j,\\zeta_k) - \\left(\\frac{\\partial u}{\\partial \\xi}\\right)_{\\text{num}}(\\xi_i,\\eta_j,\\zeta_k)\\right|, \\left|\\frac{\\partial u}{\\partial \\eta}(\\xi_i,\\eta_j,\\zeta_k) - \\left(\\frac{\\partial u}{\\partial \\eta}\\right)_{\\text{num}}(\\xi_i,\\eta_j,\\zeta_k)\\right|, \\left|\\frac{\\partial u}{\\partial \\zeta}(\\xi_i,\\eta_j,\\zeta_k) - \\left(\\frac{\\partial u}{\\partial \\zeta}\\right)_{\\text{num}}(\\xi_i,\\eta_j,\\zeta_k)\\right| \\right).\n$$\n\nYour program should produce a single line of output containing the four results $[E_A,E_B,E_C,E_D]$ as a comma-separated list enclosed in square brackets, in the order of Tests A, B, C, and D, respectively.", "solution": "The problem requires the implementation and verification of a matrix-free gradient operator for the spectral element method on a three-dimensional reference hexahedron, $[-1,1]^3$, for a polynomial degree of $p=4$. This involves three main tasks: (1) determining the Gauss–Lobatto–Legendre (GLL) nodes and quadrature weights, (2) constructing the one-dimensional differentiation matrix, and (3) implementing the tensor-product-based gradient evaluation and testing it against analytical solutions.\n\n**Part 1: Gauss–Lobatto–Legendre Nodes and Weights for $p=4$**\n\nFor a polynomial degree $p$, the spectral element method uses $N=p+1$ interpolation points on the reference interval $[-1,1]$. For $p=4$, we have $N=5$ points. These points are the Gauss–Lobatto–Legendre (GLL) nodes. They consist of the endpoints of the interval, $x_0=-1$ and $x_{N-1}=1$, and the roots of the derivative of the Legendre polynomial of degree $p$.\n\nThe Legendre polynomial of degree $p=4$ is given by the Rodrigues formula:\n$$ P_4(x) = \\frac{1}{2^4 4!} \\frac{d^4}{dx^4}(x^2-1)^4 = \\frac{1}{8}(35x^4 - 30x^2 + 3) $$\nIts derivative, $P_4'(x)$, is:\n$$ P_4'(x) = \\frac{d}{dx} \\left( \\frac{1}{8}(35x^4 - 30x^2 + 3) \\right) = \\frac{1}{8}(140x^3 - 60x) = \\frac{5}{2}x(7x^2-3) $$\nThe internal GLL nodes are the roots of $P_4'(x)=0$, which are:\n$$ x(7x^2-3)=0 \\implies x=0, \\quad x = \\pm\\sqrt{\\frac{3}{7}} $$\nCombining these internal nodes with the endpoints $\\{-1, 1\\}$ and sorting them, we obtain the five GLL nodes for $p=4$, which we denote by $\\{\\xi_i\\}_{i=0}^4$:\n$$ \\xi_0 = -1, \\quad \\xi_1 = -\\sqrt{\\frac{3}{7}}, \\quad \\xi_2 = 0, \\quad \\xi_3 = \\sqrt{\\frac{3}{7}}, \\quad \\xi_4 = 1 $$\n\nThe corresponding GLL quadrature weights $w_i$ are given by the formula:\n$$ w_i = \\frac{2}{p(p+1)[P_p(\\xi_i)]^2} $$\nFor $p=4$, this becomes $w_i = \\frac{2}{4(5)[P_4(\\xi_i)]^2} = \\frac{1}{10[P_4(\\xi_i)]^2}$. We evaluate $P_4(x)$ at each node $\\xi_i$:\n- $P_4(\\pm 1) = \\frac{1}{8}(35-30+3) = \\frac{8}{8} = 1$\n- $P_4(\\pm\\sqrt{3/7}) = \\frac{1}{8}\\left(35\\left(\\frac{3}{7}\\right)^2 - 30\\left(\\frac{3}{7}\\right) + 3\\right) = \\frac{1}{8}\\left(\\frac{35 \\cdot 9}{49} - \\frac{90}{7} + 3\\right) = \\frac{1}{8}\\left(\\frac{45}{7} - \\frac{90}{7} + \\frac{21}{7}\\right) = \\frac{-24}{56} = -\\frac{3}{7}$\n- $P_4(0) = \\frac{3}{8}$\n\nNow, we compute the weights:\n- $w_0 = w_4 = \\frac{1}{10[P_4(\\pm 1)]^2} = \\frac{1}{10(1)^2} = \\frac{1}{10}$\n- $w_1 = w_3 = \\frac{1}{10[P_4(\\pm\\sqrt{3/7})]^2} = \\frac{1}{10(-3/7)^2} = \\frac{1}{10(9/49)} = \\frac{49}{90}$\n- $w_2 = \\frac{1}{10[P_4(0)]^2} = \\frac{1}{10(3/8)^2} = \\frac{1}{10(9/64)} = \\frac{64}{90} = \\frac{32}{45}$\n\nThe sum of the weights is $\\sum w_i = 2 \\cdot \\frac{1}{10} + 2 \\cdot \\frac{49}{90} + \\frac{64}{90} = \\frac{18}{90} + \\frac{98}{90} + \\frac{64}{90} = \\frac{180}{90} = 2$, which equals $\\int_{-1}^1 1 \\, dx$, as expected.\n\n**Part 2: One-Dimensional Differentiation Matrix**\n\nThe one-dimensional differentiation matrix $D \\in \\mathbb{R}^{N \\times N}$ has entries $D_{ij} = L_j'(\\xi_i)$, where $L_j(x)$ is the Lagrange interpolating polynomial associated with node $\\xi_j$. For the specific case of GLL nodes, there are well-known analytical formulas for the entries of $D$. For a polynomial basis of degree $p$ on $N=p+1$ nodes $\\{\\xi_i\\}_{i=0}^p$:\n$$\nD_{ij} =\n\\begin{cases}\n\\frac{P_p(\\xi_i)}{P_p(\\xi_j)(\\xi_i - \\xi_j)} & i \\neq j \\\\\n-\\frac{p(p+1)}{4} & i=j=0 \\\\\n\\frac{p(p+1)}{4} & i=j=p \\\\\n0 & \\text{otherwise for } i=j\n\\end{cases}\n$$\nFor $p=4$, we have $N=5$ and the indices run from $i,j \\in \\{0, 1, 2, 3, 4\\}$. The diagonal entries are:\n- $D_{00} = -\\frac{4(5)}{4} = -5$\n- $D_{44} = \\frac{4(5)}{4} = 5$\n- $D_{11} = D_{22} = D_{33} = 0$\n\nThe off-diagonal entries $D_{ij}$ are computed using the formula above with the previously calculated values of $\\xi_i$ and $P_4(\\xi_i)$. For example:\n- $D_{01} = \\frac{P_4(\\xi_0)}{P_4(\\xi_1)(\\xi_0 - \\xi_1)} = \\frac{1}{(-3/7)(-1 - (-\\sqrt{3/7}))} = \\frac{7}{3(1-\\sqrt{3/7})}$\n- $D_{10} = \\frac{P_4(\\xi_1)}{P_4(\\xi_0)(\\xi_1 - \\xi_0)} = \\frac{-3/7}{1(-\\sqrt{3/7} - (-1))} = \\frac{-3}{7(1-\\sqrt{3/7})}$\nThe full $5 \\times 5$ matrix $D$ will be assembled numerically in the accompanying code. A crucial property of this matrix is that the sum of each row is zero, i.e., $\\sum_{j=0}^{N-1} D_{ij} = 0$ for all $i$, because the derivative of a constant function (which is represented by a vector of all ones) is zero.\n\n**Part 3: Matrix-Free 3D Gradient Evaluation**\n\nIn three dimensions, a function $u(\\xi, \\eta, \\zeta)$ on the reference hexahedron $[-1,1]^3$ is approximated using a tensor-product basis:\n$$ u^h(\\xi, \\eta, \\zeta) = \\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1}\\sum_{k=0}^{N-1} U_{ijk} L_i(\\xi) L_j(\\eta) L_k(\\zeta) $$\nwhere $U_{ijk} = u(\\xi_i, \\eta_j, \\zeta_k)$ are the values of the function at the $N \\times N \\times N$ grid of GLL points.\n\nTo compute the partial derivative with respect to $\\xi$ at a grid point $(\\xi_a, \\eta_b, \\zeta_c)$, we have:\n$$ \\frac{\\partial u^h}{\\partial \\xi}(\\xi_a, \\eta_b, \\zeta_c) = \\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1}\\sum_{k=0}^{N-1} U_{ijk} L_i'(\\xi_a) L_j(\\eta_b) L_k(\\zeta_c) $$\nUsing the property of Lagrange polynomials $L_j(x_b) = \\delta_{jb}$, the expression simplifies to:\n$$ \\frac{\\partial u^h}{\\partial \\xi}(\\xi_a, \\eta_b, \\zeta_c) = \\sum_{i=0}^{N-1} U_{ibc} L_i'(\\xi_a) = \\sum_{i=0}^{N-1} D_{ai} U_{ibc} $$\nThis shows that the derivative with respect to $\\xi$ at all grid points can be found by applying the 1D differentiation matrix $D$ along the first dimension (the $\\xi$-axis) of the 3D data array $U$. Let $(G_\\xi)_{abc}$ denote the numerical derivative with respect to $\\xi$ at point $(\\xi_a, \\eta_b, \\zeta_c)$. The operations for all three gradient components are:\n* $$ (G_\\xi)_{abc} = \\sum_{i=0}^{N-1} D_{ai} U_{ibc} $$\n* $$ (G_\\eta)_{abc} = \\sum_{j=0}^{N-1} D_{bj} U_{ajc} $$\n* $$ (G_\\zeta)_{abc} = \\sum_{k=0}^{N-1} D_{ck} U_{abk} $$\n\nA \"matrix-free\" strategy avoids assembling the global $N^3 \\times N^3$ differentiation operator. Instead, we store $U$ as an $N \\times N \\times N$ array and apply the small $N \\times N$ matrix $D$ along each dimension successively. This is computationally efficient and requires significantly less memory. In NumPy, these tensor contractions can be elegantly implemented using `np.einsum`.\n\nFinally, for each test case, we compute the numerical gradient arrays $G_\\xi$, $G_\\eta$, $G_\\zeta$ using this method. We then evaluate the analytical gradients on the GLL grid to obtain the exact gradient arrays $G_{\\xi, \\text{exact}}$, $G_{\\eta, \\text{exact}}$, $G_{\\zeta, \\text{exact}}$. The error $E$ is the maximum absolute difference between the numerical and exact values over all grid points and all three components, as defined in the problem statement. For Test A (constant) and Test B (polynomial of degree $\\le p$), the spectral differentiation is exact, so the error is expected to be at the level of machine floating-point precision. For Tests C and D, which contain non-polynomial terms, the error reflects the interpolation error of the spectral method.", "answer": "```python\nimport numpy as np\nfrom scipy.special import legendre, eval_legendre\n\ndef solve():\n    \"\"\"\n    Solves the spectral element problem for p=4.\n    1. Computes GLL nodes and the 1D differentiation matrix.\n    2. Implements a matrix-free 3D gradient operator.\n    3. Evaluates the maximum error for four test cases.\n    \"\"\"\n    p = 4\n    N = p + 1\n\n    def gll_nodes_and_weights(p_deg):\n        \"\"\"\n        Computes Gauss-Lobatto-Legendre nodes and weights for a given polynomial degree p.\n        \"\"\"\n        N_pts = p_deg + 1\n        # Internal nodes are roots of P_p'(x)\n        P_p = legendre(p_deg)\n        P_p_prime = P_p.deriv()\n        internal_nodes = np.sort(P_p_prime.roots)\n\n        # Full set of nodes including endpoints\n        nodes = np.zeros(N_pts)\n        nodes[0] = -1.0\n        nodes[N_pts-1] = 1.0\n        nodes[1:-1] = internal_nodes\n        \n        # Weights\n        weights = 2.0 / (p_deg * (p_deg + 1) * (eval_legendre(p_deg, nodes))**2)\n        \n        return nodes, weights\n\n    def differentiation_matrix(p_deg, nodes):\n        \"\"\"\n        Computes the 1D differentiation matrix for GLL nodes.\n        \"\"\"\n        N_pts = p_deg + 1\n        D = np.zeros((N_pts, N_pts))\n        p_vals = eval_legendre(p_deg, nodes)\n\n        for i in range(N_pts):\n            for j in range(N_pts):\n                if i != j:\n                    D[i, j] = p_vals[i] / (p_vals[j] * (nodes[i] - nodes[j]))\n                else:\n                    if i == 0:\n                        D[i, j] = -p_deg * (p_deg + 1) / 4.0\n                    elif i == N_pts - 1:\n                        D[i, j] = p_deg * (p_deg + 1) / 4.0\n                    else:\n                        D[i, j] = 0.0\n        return D\n\n    # 1. Construct GLL nodes and differentiation matrix for p=4\n    gll_nodes, _ = gll_nodes_and_weights(p)\n    D = differentiation_matrix(p, gll_nodes)\n\n    # 2. Set up the 3D grid\n    xi_grid, eta_grid, zeta_grid = np.meshgrid(gll_nodes, gll_nodes, gll_nodes, indexing='ij')\n\n    # 3. Define test cases\n    test_cases = [\n        {\n            \"name\": \"A\",\n            \"u_func\": lambda xi, eta, zeta: 3.14 + 0*xi,\n            \"grad_u_exact\": lambda xi, eta, zeta: (0*xi, 0*eta, 0*zeta),\n        },\n        {\n            \"name\": \"B\",\n            \"u_func\": lambda xi, eta, zeta: xi**4 + eta**3 + zeta**2,\n            \"grad_u_exact\": lambda xi, eta, zeta: (4*xi**3, 3*eta**2, 2*zeta),\n        },\n        {\n            \"name\": \"C\",\n            \"u_func\": lambda xi, eta, zeta: np.sin(xi) * np.cos(eta) * np.exp(zeta),\n            \"grad_u_exact\": lambda xi, eta, zeta: (\n                np.cos(xi) * np.cos(eta) * np.exp(zeta),\n                -np.sin(xi) * np.sin(eta) * np.exp(zeta),\n                np.sin(xi) * np.cos(eta) * np.exp(zeta),\n            ),\n        },\n        {\n            \"name\": \"D\",\n            \"u_func\": lambda xi, eta, zeta: xi*eta + eta*zeta**4 + np.cos(xi+eta+zeta),\n            \"grad_u_exact\": lambda xi, eta, zeta: (\n                eta - np.sin(xi+eta+zeta),\n                xi + zeta**4 - np.sin(xi+eta+zeta),\n                4*eta*zeta**3 - np.sin(xi+eta+zeta),\n            ),\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # Evaluate function on the grid\n        U = case[\"u_func\"](xi_grid, eta_grid, zeta_grid)\n\n        # Compute numerical gradient using matrix-free tensor products (einsum)\n        G_xi_num = np.einsum('ai,ijk->ajk', D, U)\n        G_eta_num = np.einsum('bj,ijk->ibk', D, U)\n        G_zeta_num = np.einsum('ck,ijk->ijc', D, U)\n\n        # Evaluate exact analytical gradient on the grid\n        G_xi_exact, G_eta_exact, G_zeta_exact = case[\"grad_u_exact\"](xi_grid, eta_grid, zeta_grid)\n\n        # Calculate errors\n        err_xi = np.abs(G_xi_num - G_xi_exact)\n        err_eta = np.abs(G_eta_num - G_eta_exact)\n        err_zeta = np.abs(G_zeta_num - G_zeta_exact)\n\n        # Find the maximum error over all components and all grid points\n        max_error = np.max([np.max(err_xi), np.max(err_eta), np.max(err_zeta)])\n        results.append(max_error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3417928"}]}