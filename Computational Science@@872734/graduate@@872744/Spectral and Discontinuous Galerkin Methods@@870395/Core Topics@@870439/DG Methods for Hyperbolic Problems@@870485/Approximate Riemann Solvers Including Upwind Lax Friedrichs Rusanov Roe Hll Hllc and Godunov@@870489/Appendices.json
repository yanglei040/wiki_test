{"hands_on_practices": [{"introduction": "The Godunov flux represents a cornerstone of numerical methods for conservation laws, as it is derived from the exact solution to the local Riemann problem. This exercise [@problem_id:3364344] provides foundational practice by applying this concept to the inviscid Burgers' equation, a canonical model for nonlinear wave phenomena. By determining whether the solution structure is a shock or a rarefaction, you will directly compute the flux based on the physical state at the cell interface, building a concrete understanding of this exact solver.", "problem": "Consider the inviscid Burgers conservation law $u_t + \\frac{1}{2}(u^2)_x = 0$ posed on the real line. In a Discontinuous Galerkin (DG) discretization, the interface numerical flux at $x=0$ is taken to be the Godunov flux, defined as the physical flux evaluated at the interface state of the exact entropy solution to the Riemann problem with left state $u_L$ and right state $u_R$. At the interface $x=0$, the left and right trace values are $u_L = 2.3$ and $u_R = -1.1$, respectively.\n\nStarting from the conservation law, the Rankine-Hugoniot condition, the Lax entropy condition, and the method of characteristics for convex fluxes, determine whether the Riemann solution between $u_L$ and $u_R$ consists of a shock or a rarefaction. If it is a shock, determine its propagation speed; if it is a rarefaction, determine the self-similar fan interval in similarity variable $\\xi = x/t$. Then, compute the Godunov flux at $x=0$ using the corresponding interface state of the entropy solution.\n\nReport only the Godunov flux value at $x=0$ as your final answer. Express the final value exactly (no rounding).", "solution": "The problem is first validated to ensure it is scientifically sound, well-posed, and objective.\n\n**Step 1: Extract Givens**\n- Conservation Law: $u_t + \\frac{1}{2}(u^2)_x = 0$ (inviscid Burgers' equation).\n- Discretization Context: Discontinuous Galerkin (DG) method.\n- Interface Location: $x=0$.\n- Numerical Flux: Godunov flux, defined as the physical flux evaluated at the interface state of the exact entropy solution to the Riemann problem.\n- Left State: $u_L = 2.3$.\n- Right State: $u_R = -1.1$.\n\n**Step 2: Validate Using Extracted Givens**\n- The problem is **scientifically grounded**. The inviscid Burgers' equation is a canonical model for nonlinear hyperbolic conservation laws. The concepts of Riemann problems, shocks, rarefactions, the Rankine-Hugoniot condition, the Lax entropy condition, and the Godunov flux are fundamental and well-established principles in the theory and numerical solution of such equations.\n- The problem is **well-posed**. The Riemann problem for the Burgers' equation with constant initial data has a unique, stable, and physically meaningful entropy solution.\n- The problem is **objective**. All terms are defined mathematically, and the provided data are precise numerical values.\n- The problem is **complete and consistent**. It provides all the necessary information (the PDE, the left/right states, the location of interest) to determine the Godunov flux. There are no contradictions.\n\n**Verdict:** The problem is valid. A full solution will be provided.\n\nThe given conservation law is the inviscid Burgers' equation:\n$$ u_t + \\frac{\\partial}{\\partial x} \\left( \\frac{1}{2} u^2 \\right) = 0 $$\nThis is a hyperbolic conservation law of the form $u_t + f(u)_x = 0$, where the flux function is $f(u) = \\frac{1}{2} u^2$.\n\nThe characteristic speed of the system is given by the derivative of the flux function:\n$$ c(u) = f'(u) = \\frac{d}{du} \\left( \\frac{1}{2} u^2 \\right) = u $$\nThe second derivative of the flux is $f''(u) = 1$. Since $f''(u) > 0$ for all $u$, the flux is strictly convex.\n\nThe solution to the Riemann problem with initial data\n$$ u(x,0) = \\begin{cases} u_L  x  0 \\\\ u_R  x > 0 \\end{cases} $$\ndepends on the relationship between $u_L$ and $u_R$. For a strictly convex flux, the entropy solution consists of:\n1. A shock wave if $u_L > u_R$.\n2. A rarefaction wave if $u_L  u_R$.\n\nIn this problem, we are given $u_L = 2.3$ and $u_R = -1.1$. Since $2.3 > -1.1$, which means $u_L > u_R$, the solution to the Riemann problem is a shock wave.\n\nThe speed of this shock, denoted by $s$, is determined by the Rankine-Hugoniot condition, which ensures that the jump in flux across the discontinuity is consistent with the jump in the conserved quantity:\n$$ s = \\frac{f(u_R) - f(u_L)}{u_R - u_L} $$\nSubstituting the flux function $f(u) = \\frac{1}{2}u^2$:\n$$ s = \\frac{\\frac{1}{2}u_R^2 - \\frac{1}{2}u_L^2}{u_R - u_L} = \\frac{1}{2} \\frac{(u_R - u_L)(u_R + u_L)}{u_R - u_L} = \\frac{1}{2}(u_L + u_R) $$\nPlugging in the given values for $u_L$ and $u_R$:\n$$ s = \\frac{1}{2}(2.3 + (-1.1)) = \\frac{1}{2}(1.2) = 0.6 $$\nFor a shock to be physically admissible (an \"entropy solution\"), it must satisfy the Lax entropy condition. For a convex flux, this condition is $f'(u_L) > s > f'(u_R)$.\nUsing $f'(u) = u$, we check if $u_L > s > u_R$:\n$$ 2.3 > 0.6 > -1.1 $$\nThe inequality holds, so the shock is a valid entropy solution.\n\nThe solution to the Riemann problem is a function of the similarity variable $\\xi = x/t$. For a shock wave, the solution is constant on either side of the shock path $x=st$:\n$$ u(x,t) = u(\\xi) = \\begin{cases} u_L,  \\text{if } \\xi  s \\\\ u_R,  \\text{if } \\xi > s \\end{cases} $$\nThe Godunov flux at the interface $x=0$ is defined as the physical flux evaluated at the state of the exact Riemann solution at that interface. The interface corresponds to the similarity coordinate $\\xi = x/t = 0/t = 0$.\n\nWe must determine the value of $u(\\xi=0)$. This depends on the comparison between $\\xi=0$ and the shock speed $s=0.6$.\nSince $0  0.6$, we have $\\xi  s$. According to the shock solution structure, the state at the interface is $u_L$.\n$$ u(x=0, t) = u_L = 2.3 $$\nThe Godunov flux, $f^G(u_L, u_R)$, is the physical flux $f(u)$ evaluated at this interface state:\n$$ f^G(u_L, u_R) = f(u(x=0, t)) = f(u_L) = f(2.3) $$\nWe now compute this value:\n$$ f^G = \\frac{1}{2} (2.3)^2 $$\n$$ (2.3)^2 = 5.29 $$\n$$ f^G = \\frac{1}{2} (5.29) = 2.645 $$\nThis is the Godunov flux value at the interface $x=0$.", "answer": "$$\\boxed{2.645}$$", "id": "3364344"}, {"introduction": "While the Godunov flux is exact, it can be complex to derive for systems of equations. The Rusanov (or Local Lax-Friedrichs) flux offers a simpler, more general alternative by introducing a carefully calibrated amount of numerical dissipation. This practice [@problem_id:3364336] explores the application of the Rusanov flux to the shallow water equations, focusing on the derivation of the characteristic wave speeds that govern the dissipation. You will gain insight into the critical trade-off between numerical stability, accuracy, and the preservation of physical properties like water positivity.", "problem": "Consider the one-dimensional shallow water equations without bottom topography, written in conservative form for water height $h$ and discharge $m = h u$ as\n$$\n\\partial_{t} \\begin{pmatrix} h \\\\ m \\end{pmatrix} + \\partial_{x} \\begin{pmatrix} m \\\\ \\dfrac{m^{2}}{h} + \\dfrac{1}{2} g h^{2} \\end{pmatrix} = 0,\n$$\nwhere $u$ is the depth-averaged velocity and $g$ is the gravitational acceleration. In a Discontinuous Galerkin (DG) method, the interface numerical flux is taken to be the Local Lax–Friedrichs (LLF, also called Rusanov) flux, with a stabilization parameter $\\alpha$ that must bound the fastest signal speed crossing the interface.\n\nStarting from the fundamental hyperbolic character of the system and its characteristic structure, derive the minimal admissible choice of $\\alpha$ at an interface in terms of the left and right states. Then, for a specific interface with left trace state $(h_{L}, u_{L})$ and right trace state $(h_{R}, u_{R})$, with\n$$\nh_{L} = 2.0,\\quad u_{L} = 1.5,\\quad h_{R} = 0.5,\\quad u_{R} = -0.3,\\quad g = 9.81,\n$$\nevaluate $\\alpha$ numerically. Express the final value of $\\alpha$ in meters per second and round your answer to four significant figures.\n\nFinally, explain, using first principles of hyperbolic conservation laws and invariant-region arguments, how the magnitude of $\\alpha$ influences positivity preservation of the water height $h$ in high-order DG schemes, and articulate the trade-off between choosing $\\alpha$ too small versus sufficiently large in relation to Courant-Friedrichs-Lewy (CFL) constraints and numerical diffusion. Your explanation must be qualitative; only $\\alpha$ needs to be computed numerically.", "solution": "The problem requires the derivation and calculation of the Local Lax–Friedrichs (LLF) stabilization parameter $\\alpha$ for the one-dimensional shallow water equations, followed by a qualitative discussion of its role in a Discontinuous Galerkin (DG) numerical scheme.\n\nThe problem statement is first validated.\n**Step 1: Extract Givens**\n-   Governing equations: $\\partial_{t} \\begin{pmatrix} h \\\\ m \\end{pmatrix} + \\partial_{x} \\begin{pmatrix} m \\\\ \\dfrac{m^{2}}{h} + \\dfrac{1}{2} g h^{2} \\end{pmatrix} = 0$.\n-   State vector: $\\mathbf{q} = \\begin{pmatrix} h \\\\ m \\end{pmatrix}$, where $h$ is water height and $m=hu$ is discharge.\n-   Flux vector: $\\mathbf{f}(\\mathbf{q}) = \\begin{pmatrix} m \\\\ \\frac{m^{2}}{h} + \\frac{1}{2} g h^{2} \\end{pmatrix}$.\n-   Numerical flux: Local Lax–Friedrichs (LLF) or Rusanov flux.\n-   Stabilization parameter: $\\alpha$, which must bound the fastest signal speed.\n-   Interface states (Left and Right traces):\n    -   $h_{L} = 2.0$\n    -   $u_{L} = 1.5$\n    -   $h_{R} = 0.5$\n    -   $u_{R} = -0.3$\n-   Constant: $g = 9.81$.\n-   Tasks:\n    1.  Derive the minimal admissible choice of $\\alpha$ in terms of left and right states.\n    2.  Evaluate $\\alpha$ numerically to four significant figures.\n    3.  Qualitatively explain the influence of $\\alpha$ on positivity preservation and the trade-off involving CFL constraints and numerical diffusion.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, as it deals with the well-established shallow water equations and a standard numerical method (DG with LLF flux). It is well-posed, providing all necessary data and clear objectives. The language is objective and unambiguous. The given values are physically plausible. The problem is a standard exercise in the field of numerical methods for hyperbolic conservation laws and is not trivial or ill-structured.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A full solution will be provided.\n\n**Part 1: Derivation of the LLF parameter $\\alpha$**\n\nThe shallow water equations are a system of hyperbolic conservation laws of the form $\\partial_{t}\\mathbf{q} + \\partial_{x}\\mathbf{f}(\\mathbf{q}) = 0$. The characteristic speeds of the system, which represent the speeds at which information propagates, are given by the eigenvalues of the flux Jacobian matrix, $A(\\mathbf{q}) = \\frac{\\partial \\mathbf{f}}{\\partial \\mathbf{q}}$.\n\nThe state vector is $\\mathbf{q} = \\begin{pmatrix} h \\\\ m \\end{pmatrix}$ and the flux vector is $\\mathbf{f}(\\mathbf{q}) = \\begin{pmatrix} m \\\\ \\frac{m^{2}}{h} + \\frac{1}{2} g h^{2} \\end{pmatrix}$. We compute the partial derivatives of the flux components with respect to the state variables:\n$$\nA(\\mathbf{q}) = \\frac{\\partial \\mathbf{f}}{\\partial \\mathbf{q}} = \\begin{pmatrix} \\frac{\\partial f_1}{\\partial h}  \\frac{\\partial f_1}{\\partial m} \\\\ \\frac{\\partial f_2}{\\partial h}  \\frac{\\partial f_2}{\\partial m} \\end{pmatrix}\n$$\nThe components are:\n-   $\\frac{\\partial f_1}{\\partial h} = \\frac{\\partial m}{\\partial h} = 0$\n-   $\\frac{\\partial f_1}{\\partial m} = \\frac{\\partial m}{\\partial m} = 1$\n-   $\\frac{\\partial f_2}{\\partial h} = \\frac{\\partial}{\\partial h} \\left(\\frac{m^2}{h} + \\frac{1}{2}gh^2\\right) = -\\frac{m^2}{h^2} + gh$. Substituting $m=hu$, this becomes $-\\frac{(hu)^2}{h^2} + gh = gh - u^2$.\n-   $\\frac{\\partial f_2}{\\partial m} = \\frac{\\partial}{\\partial m} \\left(\\frac{m^2}{h} + \\frac{1}{2}gh^2\\right) = \\frac{2m}{h}$. Substituting $m=hu$, this becomes $\\frac{2hu}{h} = 2u$.\n\nThe Jacobian matrix is therefore:\n$$\nA(\\mathbf{q}) = \\begin{pmatrix} 0  1 \\\\ gh - u^2  2u \\end{pmatrix}\n$$\nThe eigenvalues $\\lambda$ are the roots of the characteristic equation $\\det(A - \\lambda I) = 0$:\n$$\n\\det \\begin{pmatrix} -\\lambda  1 \\\\ gh - u^2  2u - \\lambda \\end{pmatrix} = (-\\lambda)(2u - \\lambda) - (1)(gh - u^2) = 0\n$$\n$$\n\\lambda^2 - 2u\\lambda - (gh - u^2) = 0\n$$\n$$\n\\lambda^2 - 2u\\lambda + u^2 - gh = 0\n$$\n$$\n(\\lambda - u)^2 - gh = 0\n$$\n$$\n(\\lambda - u)^2 = gh\n$$\nTaking the square root of both sides gives $\\lambda - u = \\pm\\sqrt{gh}$. The eigenvalues, or characteristic speeds, are:\n$$\n\\lambda_{1,2} = u \\pm \\sqrt{gh}\n$$\nThese represent the speeds of the gravity waves propagating on the water surface. Let $c = \\sqrt{gh}$ be the wave celerity.\n\nThe Local Lax–Friedrichs (or Rusanov) numerical flux at an interface between a left state $\\mathbf{q}_L$ and a right state $\\mathbf{q}_R$ is given by:\n$$\n\\mathbf{f}_{LLF}(\\mathbf{q}_L, \\mathbf{q}_R) = \\frac{1}{2} \\left[ \\mathbf{f}(\\mathbf{q}_L) + \\mathbf{f}(\\mathbf{q}_R) \\right] - \\frac{\\alpha}{2} \\left[ \\mathbf{q}_R - \\mathbf{q}_L \\right]\n$$\nThe parameter $\\alpha$ is a stabilization term that introduces numerical diffusion. For the numerical scheme to be stable, the numerical domain of dependence must contain the physical domain of dependence. This requires $\\alpha$ to be an upper bound on the magnitude of the fastest signal speed propagating away from the interface. The signal speeds are the eigenvalues evaluated at the local states.\n\nThe maximum absolute eigenvalue for any given state $(h, u)$ is:\n$$\nS(h,u) = \\max(|\\lambda_1|, |\\lambda_2|) = \\max(|u + \\sqrt{gh}|, |u - \\sqrt{gh}|) = |u| + \\sqrt{gh}\n$$\nsince $\\sqrt{gh} \\ge 0$.\n\nAt an interface between states $(h_L, u_L)$ and $(h_R, u_R)$, the stabilization parameter $\\alpha$ must be greater than or equal to the fastest possible signal speed originating from either side of the interface. The minimal admissible choice for $\\alpha$ is therefore the maximum of the fastest signal speeds of the left and right states:\n$$\n\\alpha = \\max(S(h_L, u_L), S(h_R, u_R)) = \\max(|u_L| + \\sqrt{gh_L}, |u_R| + \\sqrt{gh_R})\n$$\nThis is the derived expression for the minimal admissible choice of $\\alpha$.\n\n**Part 2: Numerical Evaluation of $\\alpha$**\n\nUsing the given data:\n-   $h_{L} = 2.0$, $u_{L} = 1.5$\n-   $h_{R} = 0.5$, $u_{R} = -0.3$\n-   $g = 9.81$\n\nWe compute the maximum signal speed for the left state, $S_L$:\n$$\nS_L = |u_L| + \\sqrt{gh_L} = |1.5| + \\sqrt{9.81 \\times 2.0} = 1.5 + \\sqrt{19.62}\n$$\n$$\nS_L \\approx 1.5 + 4.4294469 = 5.9294469 \\, \\text{m/s}\n$$\nNext, we compute the maximum signal speed for the right state, $S_R$:\n$$\nS_R = |u_R| + \\sqrt{gh_R} = |-0.3| + \\sqrt{9.81 \\times 0.5} = 0.3 + \\sqrt{4.905}\n$$\n$$\nS_R \\approx 0.3 + 2.2147235 = 2.5147235 \\, \\text{m/s}\n$$\nThe minimal value for $\\alpha$ is the maximum of these two speeds:\n$$\n\\alpha = \\max(S_L, S_R) = \\max(5.9294469, 2.5147235) = 5.9294469\n$$\nRounding the result to four significant figures, we get:\n$$\n\\alpha \\approx 5.929 \\, \\text{m/s}\n$$\n\n**Part 3: Qualitative Explanation**\n\nThe magnitude of the LLF parameter $\\alpha$ has profound implications for the properties of the DG scheme, particularly regarding positivity preservation, stability, and accuracy.\n\n**Influence on Positivity Preservation:**\nThe water height $h$ is a physically positive quantity. A numerical scheme is \"positivity-preserving\" if it guarantees that $h$ will remain positive, given a positive initial state. For high-order DG schemes, which represent the solution as a polynomial within each cell, ensuring positivity is challenging because the polynomial can develop undershoots and become negative at certain points, even if the cell average remains positive. These undershoots are often associated with strong, non-physical oscillations (Gibbs phenomenon) near sharp gradients or discontinuities.\n\nThe LLF flux introduces a numerical diffusion term proportional to $\\alpha$ and the jump in the solution, $-\\frac{\\alpha}{2}(\\mathbf{q}_R - \\mathbf{q}_L)$. This term acts analogously to a physical diffusion or viscosity. A larger value of $\\alpha$ corresponds to stronger diffusion. This diffusion has a smoothing or smearing effect on the solution, which is crucial for damping the high-frequency oscillations that cause undershoots. By sufficiently damping these oscillations, a large enough $\\alpha$ helps prevent the solution for $h$ from dropping below zero. In essence, the added dissipation helps enforce a local extremum-diminishing property, making the scheme more robust and more likely to maintain the positivity of $h$. For a DG scheme to be provably positivity-preserving, a sufficiently large $\\alpha$ is often required in conjunction with a suitably restrictive time-step constraint.\n\n**Trade-off between Small and Large $\\alpha$:**\n\nChoosing the magnitude of $\\alpha$ involves a critical trade-off between numerical diffusion (accuracy) and stability (robustness), which also impacts the CFL-based time-step constraint.\n\n1.  **Choosing $\\alpha$ too small:** If $\\alpha$ is chosen smaller than the minimally required value derived above, the numerical scheme fails to account for all physical wave speeds. The numerical domain of dependence becomes smaller than the physical one, leading to a violation of the fundamental requirement for convergence (the Courant-Friedrichs-Lewy condition) and resulting in catastrophic instability. The solution will typically diverge with exponential error growth.\n\n2.  **Choosing a minimal but sufficient $\\alpha$:** Using the minimal admissible value, $\\alpha = \\max(|u_L|+\\sqrt{gh_L}, |u_R|+\\sqrt{gh_R})$, provides exactly the amount of diffusion needed to ensure stability at the interface. This choice generally leads to the most accurate results possible with an LLF flux, as it minimizes numerical smearing. However, it provides the least \"safety margin\" for robustness. The scheme might still exhibit significant, albeit bounded, oscillations near shocks and may struggle with positivity preservation in extreme cases.\n\n3.  **Choosing $\\alpha$ larger than necessary:**\n    -   **Disadvantage (Numerical Diffusion and Accuracy):** A larger $\\alpha$ increases the amount of numerical diffusion. This excessive diffusion smears sharp features in the solution, such as shock fronts and contact discontinuities, making them appear more spread out and less steep. This reduces the formal accuracy of the scheme, particularly for problems with discontinuous solutions. The solution becomes overly blurry.\n    -   **Disadvantage (CFL Constraint and Cost):** For an explicit time-stepping scheme, the maximum stable time step $\\Delta t$ is limited by a CFL condition, which is roughly of the form $\\Delta t \\le C \\frac{\\Delta x}{\\lambda_{\\text{max, global}}}$. In a scheme using an LLF flux, the effective maximum signal speed is governed by $\\alpha$. A larger $\\alpha$ thus leads to a more restrictive CFL condition, forcing the use of a smaller $\\Delta t$. This increases the total number of time steps required to reach a given simulation time, making the computation more expensive.\n    -   **Advantage (Robustness):** The primary benefit of a larger $\\alpha$ is enhanced robustness. The increased diffusion is very effective at damping numerical oscillations, preventing positivity failures, and stabilizing the computation in the presence of very strong shocks or complex wave interactions.\n\nIn summary, the trade-off is stark: a smaller (but sufficient) $\\alpha$ prioritizes accuracy and computational efficiency at the risk of lower robustness and potential positivity issues. A larger $\\alpha$ prioritizes robustness and stability at the cost of reduced accuracy and increased computational expense. The optimal choice of $\\alpha$ depends on the specific problem and the desired balance between these competing factors.", "answer": "$$\n\\boxed{5.929}\n$$", "id": "3364336"}, {"introduction": "Moving to more sophisticated methods, the Harten-Lax-van Leer-Contact (HLLC) solver improves upon simpler fluxes by accurately resolving the contact wave, which is crucial in many fluid dynamics problems. This exercise [@problem_id:3364315] takes you from theory to practice by guiding you through the implementation of a robust HLLC solver for the shallow water equations. You will tackle the challenging real-world problem of wetting and drying, learning to incorporate positivity-preserving techniques like special wave speed estimates and fallback mechanisms into your numerical code.", "problem": "Consider the one-dimensional shallow water equations, which form a system of hyperbolic conservation laws without source terms, given by the conserved variables vector $U = [h, q]^\\top$, where $h$ is the water depth in meters and $q = h u$ is the discharge in $\\mathrm{m}^2/\\mathrm{s}$, with velocity $u$ in $\\mathrm{m}/\\mathrm{s}$. The flux vector $F(U)$ is defined as $F(U) = [q, q^2/h + \\tfrac{1}{2} g h^2]^\\top$, where $g$ is the gravitational acceleration in $\\mathrm{m}/\\mathrm{s}^2$. In the spectral and discontinuous Galerkin methods setting, use the discontinuous Galerkin method with piecewise constant basis (equivalently, a finite volume method) on a uniform mesh of two elements and periodic boundary conditions. The semidiscrete update for the cell-average in element $i$ is derived from the weak form as\n$$\n\\frac{d}{dt} U_i(t) = -\\frac{1}{\\Delta x} \\left( \\widehat{F}_{i+1/2} - \\widehat{F}_{i-1/2} \\right),\n$$\nwhere $\\Delta x$ is the cell width in meters and $\\widehat{F}$ is a consistent numerical flux obtained from an approximate Riemann solver at each interface, using left trace $U^-$ and right trace $U^+$ at the element boundaries.\n\nYour task is to implement a dry-state-aware Harten-Lax-van Leer-Contact (HLLC) approximate Riemann solver for the shallow water equations and compare, in terms of positivity preservation of the water depth $h$, against the Lax-Friedrichs (Rusanov) flux under dam-break scenarios approaching dry states. Proceed from the following fundamental base:\n\n- The shallow water equations conservation form and flux $F(U)$ as defined above.\n- The wave celerity $c = \\sqrt{g h}$ and characteristic speeds approximately bounded by $u \\pm c$.\n- The Rankine-Hugoniot jump conditions across waves in hyperbolic systems.\n\nYou must derive a dry-state-aware estimate of the left and right bounding wave speeds $S_L$ and $S_R$ suitable for use in the HLL/HLLC family under near-vacuum states, ensuring robustness when $h \\to 0$. Start from the classical estimates $S_L = \\min(u_L - c_L, u_R - c_R)$ and $S_R = \\max(u_L + c_L, u_R + c_R)$, where subscripts $L$ and $R$ denote left and right states, respectively, and $c = \\sqrt{g h}$. Then, analytically argue and specify a modification when one side is dry ($h \\approx 0$), using only the above fundamental base, that widens the speeds to maintain positivity in the intermediate states; for example, by using $S_L = u_{\\mathrm{wet}} - 2 c_{\\mathrm{wet}}$ and $S_R = u_{\\mathrm{wet}} + 2 c_{\\mathrm{wet}}$ on the wet side when the other side is dry.\n\nNext, use the Rankine-Hugoniot condition to derive the contact (middle) wave speed $S_*$ in the HLLC solver for shallow water in terms of $S_L$, $S_R$, $U_L$, and $U_R$, where the hydrostatic \"pressure\" analog $p = \\tfrac{1}{2} g h^2$ is used:\n$$\nS_* = \\frac{p_R - p_L + q_L (S_L - u_L) - q_R (S_R - u_R)}{h_L (S_L - u_L) - h_R (S_R - u_R)}.\n$$\nShow how to construct the intermediate states $U_{*L} = [h_{*L}, q_{*L}]^\\top$ and $U_{*R} = [h_{*R}, q_{*R}]^\\top$ as\n$$\nh_{*L} = h_L \\frac{S_L - u_L}{S_L - S_*}, \\quad h_{*R} = h_R \\frac{S_R - u_R}{S_R - S_*}, \\quad q_{*L} = h_{*L} S_*, \\quad q_{*R} = h_{*R} S_*,\n$$\nand specify a mathematically consistent fallback to the Harten-Lax-van Leer (HLL) two-wave flux whenever the intermediate depths $h_{*L}$ or $h_{*R}$ become non-positive or the denominator in the calculation of $S_*$ degenerates, in order to preserve positivity.\n\nImplement two numerical fluxes:\n\n1. The dry-state-aware HLLC flux, which uses the above $S_L$, $S_R$, and $S_*$, with fallback to HLL when necessary. The final flux is given by the usual HLLC case distinction:\n   - If $S_L \\ge 0$, use $F(U_L)$.\n   - If $S_R \\le 0$, use $F(U_R)$.\n   - Else if $S_L  0 \\le S_*$, use $F(U_L) + S_L (U_{*L} - U_L)$.\n   - Else, use $F(U_R) + S_R (U_{*R} - U_R)$.\n2. The Rusanov (Lax-Friedrichs) flux\n$$\n\\widehat{F}_{\\mathrm{Rus}} = \\frac{1}{2} \\left( F(U_L) + F(U_R) \\right) - \\frac{1}{2} a_{\\max} (U_R - U_L), \\quad a_{\\max} = \\max\\left( |u_L| + c_L, |u_R| + c_R \\right).\n$$\n\nUse forward Euler time stepping for a single time step applied to two periodic cells. Specifically, for cells $i = 0$ and $i = 1$, with states $U_0^n$ and $U_1^n$, and two interfaces located at $x_{1/2}$ between $U_0$ and $U_1$, and at $x_{3/2}$ between $U_1$ and $U_0$ (due to periodicity), the update is\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x} \\left( \\widehat{F}_{i+1/2} - \\widehat{F}_{i-1/2} \\right).\n$$\nSet the gravitational acceleration to $g = 9.81$ in $\\mathrm{m}/\\mathrm{s}^2$. For each test case, set the cell width to $\\Delta x = 1$ meter and choose the time step $\\Delta t$ by the Courant-Friedrichs-Lewy (CFL) condition $\\Delta t = \\mathrm{CFL} \\cdot \\Delta x / a_{\\max}$ with $\\mathrm{CFL} = 0.9$, where $a_{\\max}$ is computed from the interface states of the case under consideration. In all computations, treat any depth $h$ less than a machine threshold $\\epsilon$ as dry, with $\\epsilon = 10^{-12}$ meters, and ensure that the numerical implementation avoids division by zero.\n\nTest Suite:\nFor each test case, initialize the two periodic cells $(U_0, U_1)$ with the dam-break type states given as $(h_0, u_0; h_1, u_1)$, where the discharge is $q = h u$. All depths are in meters and velocities in $\\mathrm{m}/\\mathrm{s}$.\n\n- Case A (left wet, right dry): $(h_0 = 1.0, u_0 = 0.0; h_1 = 10^{-12}, u_1 = 0.0)$.\n- Case B (left very wet, right dry): $(h_0 = 10.0, u_0 = 0.0; h_1 = 10^{-12}, u_1 = 0.0)$.\n- Case C (left dry, right wet): $(h_0 = 10^{-12}, u_0 = 0.0; h_1 = 1.0, u_1 = 0.0)$.\n- Case D (both dry): $(h_0 = 0.0, u_0 = 0.0; h_1 = 0.0, u_1 = 0.0)$.\n- Case E (near-dry left, dry right): $(h_0 = 10^{-6}, u_0 = 0.0; h_1 = 0.0, u_1 = 0.0)$.\n\nFor each case, perform one forward Euler update using both the HLLC flux and the Rusanov flux, and evaluate whether the updated depths in both cells are nonnegative (greater or equal to zero). Use the logical result per solver per case.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each entry corresponds to one test case and should itself be a two-element list $[b_{\\mathrm{HLLC}}, b_{\\mathrm{Rus}}]$ where $b_{\\mathrm{HLLC}}$ and $b_{\\mathrm{Rus}}$ are booleans indicating whether the depths remain nonnegative after the update for the HLLC and Rusanov fluxes, respectively. For example, a possible output may look like $[[\\mathrm{True},\\mathrm{True}],[\\mathrm{True},\\mathrm{True}],\\dots]$.", "solution": "The tasked objective is to implement and compare two approximate Riemann solvers—a dry-state-aware Harten-Lax-van Leer-Contact (HLLC) flux and a Rusanov (Lax-Friedrichs) flux—for the one-dimensional shallow water equations. The comparison is focused on the property of preserving the positivity of water depth $h$ under dam-break scenarios involving dry or near-dry states. The numerical framework specified is a two-cell, periodic, piecewise constant discontinuous Galerkin (equivalent to a finite volume) method with a single forward Euler time step.\n\n### 1. Governing Equations\nThe one-dimensional shallow water equations in conservative form are given by:\n$$ \\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0 $$\nwhere $U$ is the vector of conserved variables and $F(U)$ is the flux vector:\n$$ U = \\begin{pmatrix} h \\\\ q \\end{pmatrix}, \\quad F(U) = \\begin{pmatrix} q \\\\ \\frac{q^2}{h} + \\frac{1}{2}gh^2 \\end{pmatrix} $$\nHere, $h$ is the water depth, $q = hu$ is the discharge, $u$ is the fluid velocity, and $g$ is the gravitational acceleration, set to $g=9.81 \\, \\mathrm{m/s^2}$. A key quantity is the wave celerity, $c = \\sqrt{gh}$, which determines the characteristic speeds of the system, $\\lambda_{1,2} = u \\pm c$. Any water depth $h$ below a threshold $\\epsilon = 10^{-12} \\, \\mathrm{m}$ is treated as a dry state.\n\n### 2. Numerical Discretization\nA finite volume method on two cells, indexed $i=0$ and $i=1$, with periodic boundary conditions is employed. The cell width is $\\Delta x = 1 \\, \\mathrm{m}$. The semi-discrete update for the cell-averaged state $U_i$ is:\n$$ \\frac{dU_i}{dt} = -\\frac{1}{\\Delta x} \\left( \\widehat{F}_{i+1/2} - \\widehat{F}_{i-1/2} \\right) $$\nwhere $\\widehat{F}_{i+1/2}$ is the numerical flux at the interface between cell $i$ and cell $i+1$. For our two-cell periodic domain, the updates for $U_0$ and $U_1$ are:\n$$ U_0^{n+1} = U_0^n - \\frac{\\Delta t}{\\Delta x} \\left( \\widehat{F}(U_0^n, U_1^n) - \\widehat{F}(U_1^n, U_0^n) \\right) $$\n$$ U_1^{n+1} = U_1^n - \\frac{\\Delta t}{\\Delta x} \\left( \\widehat{F}(U_1^n, U_0^n) - \\widehat{F}(U_0^n, U_1^n) \\right) $$\nTime integration is performed using a single forward Euler step. The time step $\\Delta t$ is determined by the Courant-Friedrichs-Lewy (CFL) condition with a CFL number of $0.9$:\n$$ \\Delta t = \\mathrm{CFL} \\frac{\\Delta x}{a_{\\max}} $$\nwhere $a_{\\max} = \\max(|u_0| + c_0, |u_1| + c_1)$ is the maximum signal speed across all initial states.\n\n### 3. Rusanov (Lax-Friedrichs) Flux\nThe Rusanov flux is a simple, robust, but diffusive Riemann solver. For a left state $U_L$ and a right state $U_R$, it is defined as:\n$$ \\widehat{F}_{\\mathrm{Rus}}(U_L, U_R) = \\frac{1}{2} \\left( F(U_L) + F(U_R) \\right) - \\frac{1}{2} a_{\\max}^{LR} (U_R - U_L) $$\nThe dissipation term is controlled by the local maximum signal speed at the interface, $a_{\\max}^{LR} = \\max(|u_L| + c_L, |u_R| + c_R)$. While robust, its strong dissipation can sometimes lead to the generation of non-physical negative depths in extreme cases like dam-breaks into dry areas.\n\n### 4. HLLC Approximate Riemann Solver\nThe HLLC solver is an extension of the Harten-Lax-van Leer (HLL) solver. It models the Riemann fan with three waves—two outer nonlinear waves and a contact wave in the middle.\n\n#### 4.1. Wave Speed Estimation ($S_L, S_R$)\nThe performance of HLL-type solvers critically depends on the estimates for the leftmost ($S_L$) and rightmost ($S_R$) wave speeds.\n- For two wet states ($h_L, h_R \\ge \\epsilon$), classical estimates based on characteristic speeds are used:\n$$ S_L = \\min(u_L - c_L, u_R - c_R), \\quad S_R = \\max(u_L + c_L, u_R + c_R) $$\n- For a wet-dry interface, the exact solution of the Riemann problem involves a rarefaction wave expanding into the vacuum. The head of this wave travels at $u_{\\mathrm{wet}}-c_{\\mathrm{wet}}$ and the tail at $u_{\\mathrm{wet}}+2c_{\\mathrm{wet}}$. To ensure the numerical wave fan robustly encompasses the physical one and to enhance positivity, the problem specifies a modification to widen the wave speed estimates. If one state is wet and the other is dry, the speeds are estimated using only the wet state's properties:\n$$ S_L = u_{\\mathrm{wet}} - 2 c_{\\mathrm{wet}}, \\quad S_R = u_{\\mathrm{wet}} + 2 c_{\\mathrm{wet}} $$\nThis analytic modification is crucial for robustness in near-vacuum conditions. If both states are dry, all velocities and celerities are zero, resulting in $S_L=S_R=0$.\n\n#### 4.2. HLLC Intermediate States and Contact Speed ($S_*$)\nThe HLLC model introduces two intermediate states, $U_{*L}$ and $U_{*R}$, separated by a contact discontinuity moving at speed $S_*$. The known states $U_L$ and $U_R$ are connected to these star states by waves with speeds $S_L$ and $S_R$. Applying the Rankine-Hugoniot jump condition, $F(U_2) - F(U_1) = S(U_2 - U_1)$, across these waves yields expressions for the intermediate states and the contact speed.\n\nAcross the contact wave, velocity and pressure ($p = \\frac{1}{2}gh^2$ for SWE) are continuous in the analogous Euler system. For SWE, the corresponding conditions are continuity of velocity $u$ and depth $h$. However, the HLLC Riemann solver for SWE is derived by analogy to the Euler equations, where pressure is continuous across the contact. This leads to $p_{*L} = p_{*R}$. The velocity in the star region is constant and equal to the contact speed, $u_{*L} = u_{*R} = S_*$.\nFrom the jump condition for mass conservation across the left wave, $q_{*L} - q_L = S_L(h_{*L} - h_L)$, and using $q_{*L} = h_{*L}S_*$, we derive the depth in the left intermediate state:\n$$ h_{*L} S_* - h_L u_L = S_L (h_{*L} - h_L) \\implies h_{*L}(S_* - S_L) = h_L(u_L - S_L) \\implies h_{*L} = h_L \\frac{S_L-u_L}{S_L-S_*} $$\nA similar derivation for the right wave gives $h_{*R} = h_R \\frac{S_R-u_R}{S_R-S_*}$. The discharges are then $q_{*L} = h_{*L}S_*$ and $q_{*R} = h_{*R}S_*$.\n\nThe contact speed $S_*$ is found by imposing continuity of `pressure' $p = \\frac{1}{2}gh^2$ across the contact, $p_{*L} = p_{*R}$, after expressing $p_{*L}$ and $p_{*R}$ using the momentum jump conditions. This yields the provided formula:\n$$ S_* = \\frac{p_R - p_L + q_L (S_L - u_L) - q_R (S_R - u_R)}{h_L (S_L - u_L) - h_R (S_R - u_R)} $$\nwhere $p_K = \\frac{1}{2}gh_K^2$ for $K=L,R$.\n\n#### 4.3. Positivity Preservation and HLL Fallback\nThe expressions for $h_{*L}$ and $h_{*R}$ can yield negative depths if the wave speed estimates are not appropriate, or due to numerical inaccuracies. For positivity, the solver must check if $h_{*L} > 0$ and $h_{*R} > 0$. If either is non-positive, or if the denominator in the $S_*$ calculation is close to zero, the HLLC model is invalid for that Riemann problem. In such cases, a fallback to the more robust (but more diffusive) two-wave HLL solver is necessary. The HLL flux is:\n$$ \\widehat{F}_{\\mathrm{HLL}} = \\frac{S_R F(U_L) - S_L F(U_R) + S_L S_R (U_R - U_L)}{S_R - S_L} $$\nThis fallback ensures robustness while retaining the accuracy of HLLC where it is valid.\n\n#### 4.4. Final HLLC Flux\nThe HLLC flux is selected based on the location of the interface (at $x=0$ in the Riemann problem's frame) relative to the wave fan structure:\n- If $S_L \\ge 0$: The interface is in the left region. $\\widehat{F}_{\\mathrm{HLLC}} = F(U_L)$.\n- If $S_R \\le 0$: The interface is in the right region. $\\widehat{F}_{\\mathrm{HLLC}} = F(U_R)$.\n- If $S_L  0 \\le S_*$: The interface is in the left star-region. $\\widehat{F}_{\\mathrm{HLLC}} = F(U_L) + S_L(U_{*L} - U_L)$.\n- If $S_*  0  S_R$: The interface is in the right star-region. $\\widehat{F}_{\\mathrm{HLLC}} = F(U_R) + S_R(U_{*R} - U_R)$.\nIf a fallback to HLL is triggered, $\\widehat{F}_{\\mathrm{HLL}}$ is used instead.\n\nThis combination of dry-state aware wave speeds and a robust fallback mechanism makes the HLLC solver a strong candidate for accurately and positively simulating shallow water flows with dry beds.", "answer": "```python\nimport numpy as np\n\n# A small tolerance for floating point comparisons and dry state checks\nTOL = 1e-12\n\ndef physical_flux(U, g):\n    \"\"\"\n    Calculates the physical flux F(U) for the shallow water equations.\n    U = [h, q]\n    F(U) = [q, q^2/h + 0.5*g*h^2]\n    \"\"\"\n    h, q = U\n    if h  TOL:\n        return np.array([0.0, 0.0])\n    u = q / h\n    return np.array([q, q**2 / h + 0.5 * g * h**2])\n\ndef rusanov_flux(UL, UR, g):\n    \"\"\"Calculates the Rusanov (Lax-Friedrichs) numerical flux.\"\"\"\n    hL, qL = UL\n    hR, qR = UR\n\n    uL = qL / hL if hL = TOL else 0.0\n    uR = qR / hR if hR = TOL else 0.0\n    \n    cL = np.sqrt(g * hL) if hL = TOL else 0.0\n    cR = np.sqrt(g * hR) if hR = TOL else 0.0\n\n    a_max = max(abs(uL) + cL, abs(uR) + cR)\n    \n    FL = physical_flux(UL, g)\n    FR = physical_flux(UR, g)\n    \n    return 0.5 * (FL + FR) - 0.5 * a_max * (UR - UL)\n\ndef hllc_flux(UL, UR, g):\n    \"\"\"\n    Calculates the dry-state-aware HLLC numerical flux with HLL fallback.\n    \"\"\"\n    hL, qL = UL\n    hR, qR = UR\n    \n    # Handle dry states\n    if hL  TOL:\n        hL = 0.0\n        qL = 0.0\n    if hR  TOL:\n        hR = 0.0\n        qR = 0.0\n    UL = np.array([hL, qL])\n    UR = np.array([hR, qR])\n\n    uL = qL / hL if hL > 0 else 0.0\n    uR = qR / hR if hR > 0 else 0.0\n    \n    cL = np.sqrt(g * hL) if hL > 0 else 0.0\n    cR = np.sqrt(g * hR) if hR > 0 else 0.0\n\n    # Wave speed estimates with dry-state modification\n    is_L_dry = (hL  TOL)\n    is_R_dry = (hR  TOL)\n\n    if is_L_dry and not is_R_dry: # L-dry, R-wet\n        SL = uR - 2 * cR\n        SR = uR + 2 * cR\n    elif not is_L_dry and is_R_dry: # L-wet, R-dry\n        SL = uL - 2 * cL\n        SR = uL + 2 * cL\n    elif is_L_dry and is_R_dry: # both dry\n        SL = 0.0\n        SR = 0.0\n    else: # both wet\n        SL = min(uL - cL, uR - cR)\n        SR = max(uL + cL, uR + cR)\n\n    FL = physical_flux(UL, g)\n    FR = physical_flux(UR, g)\n\n    if SL = 0:\n        return FL\n    if SR = 0:\n        return FR\n    \n    # Check for HLL fallback condition\n    fallback_to_hll = False\n    \n    denom_S_star = hL * (SL - uL) - hR * (SR - uR)\n    \n    if abs(denom_S_star)  TOL:\n        fallback_to_hll = True\n    else:\n        pL = 0.5 * g * hL**2\n        pR = 0.5 * g * hR**2\n        num_S_star = pR - pL + qL * (SL - uL) - qR * (SR - uR)\n        S_star = num_S_star / denom_S_star\n\n        if abs(SL - S_star)  TOL or abs(SR - S_star)  TOL:\n            fallback_to_hll = True\n        else:\n            h_star_L = hL * (SL - uL) / (SL - S_star)\n            h_star_R = hR * (SR - uR) / (SR - S_star)\n            if h_star_L  0 or h_star_R  0:\n                fallback_to_hll = True\n    \n    if fallback_to_hll:\n        if abs(SR - SL)  TOL: # Should not happen if SL0 and SR0\n             return 0.5 * (FL + FR) # Degenerate HLL - average flux\n        return (SR * FL - SL * FR + SL * SR * (UR - UL)) / (SR - SL)\n\n    # Standard HLLC flux calculation\n    if S_star = 0:\n        h_star_L = hL * (SL - uL) / (SL - S_star)\n        q_star_L = h_star_L * S_star\n        U_star_L = np.array([h_star_L, q_star_L])\n        return FL + SL * (U_star_L - UL)\n    else: # S_star  0\n        h_star_R = hR * (SR - uR) / (SR - S_star)\n        q_star_R = h_star_R * S_star\n        U_star_R = np.array([h_star_R, q_star_R])\n        return FR + SR * (U_star_R - UR)\n\n\ndef solve():\n    \"\"\"Main solver function to run test cases and generate output.\"\"\"\n    test_cases = [\n        # Case A: (h0=1.0, u0=0.0; h1=1e-12, u1=0.0)\n        (1.0, 0.0, 1e-12, 0.0),\n        # Case B: (h0=10.0, u0=0.0; h1=1e-12, u1=0.0)\n        (10.0, 0.0, 1e-12, 0.0),\n        # Case C: (h0=1e-12, u0=0.0; h1=1.0, u1=0.0)\n        (1e-12, 0.0, 1.0, 0.0),\n        # Case D: (h0=0.0, u0=0.0; h1=0.0, u1=0.0)\n        (0.0, 0.0, 0.0, 0.0),\n        # Case E: (h0=1e-6, u0=0.0; h1=0.0, u1=0.0)\n        (1e-6, 0.0, 0.0, 0.0),\n    ]\n\n    g = 9.81\n    dx = 1.0\n    cfl = 0.9\n\n    results = []\n\n    for h0, u0, h1, u1 in test_cases:\n        U0_n = np.array([h0, h0 * u0])\n        U1_n = np.array([h1, h1 * u1])\n        \n        c0 = np.sqrt(g * h0) if h0 = 0 else 0.0\n        c1 = np.sqrt(g * h1) if h1 = 0 else 0.0\n        a_max = max(abs(u0) + c0, abs(u1) + c1)\n\n        if a_max  TOL:\n            dt = 0.1 # Any small dt, as update will be zero anyway\n        else:    \n            dt = cfl * dx / a_max\n        \n        # --- HLLC Solver ---\n        F01_hllc = hllc_flux(U0_n, U1_n, g)\n        F10_hllc = hllc_flux(U1_n, U0_n, g)\n        \n        U0_hllc_np1 = U0_n - (dt / dx) * (F01_hllc - F10_hllc)\n        U1_hllc_np1 = U1_n - (dt / dx) * (F10_hllc - F01_hllc)\n        \n        positivity_hllc = U0_hllc_np1[0] = -TOL and U1_hllc_np1[0] = -TOL\n        \n        # --- Rusanov Solver ---\n        F01_rus = rusanov_flux(U0_n, U1_n, g)\n        F10_rus = rusanov_flux(U1_n, U0_n, g)\n        \n        U0_rus_np1 = U0_n - (dt / dx) * (F01_rus - F10_rus)\n        U1_rus_np1 = U1_n - (dt / dx) * (F10_rus - F01_rus)\n        \n        positivity_rus = U0_rus_np1[0] = -TOL and U1_rus_np1[0] = -TOL\n        \n        results.append([positivity_hllc, positivity_rus])\n\n    # Format output string\n    def format_inner_list(lst):\n        return f\"[{lst[0]},{lst[1]}]\"\n\n    formatted_strings = [format_inner_list(r).replace('True', 'True').replace('False', 'False') for r in results]\n    final_output = f\"[{','.join(formatted_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "3364315"}]}