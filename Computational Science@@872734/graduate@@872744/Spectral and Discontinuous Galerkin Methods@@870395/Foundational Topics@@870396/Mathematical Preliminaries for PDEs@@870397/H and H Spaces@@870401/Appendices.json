{"hands_on_practices": [{"introduction": "A crucial first step in applying spectral methods is the construction of a suitable polynomial basis for the function space of interest. This practice guides you through building a conforming basis for the $H(\\mathrm{curl})$ space on a reference hexahedron using tensor products of one-dimensional orthonormal polynomials. By analyzing the resulting mass matrix, you will gain hands-on insight into how the choice of basis directly influences the structure and sparsity of the discrete system, a fundamental concept for designing efficient numerical algorithms. [@problem_id:3389511]", "problem": "Consider the reference hexahedron $\\hat{K}=[-1,1]^{3}$ and the Sobolev space $H(\\operatorname{curl};\\hat{K})$ of square-integrable vector fields with square-integrable curl. Let $\\{\\psi_{n}\\}_{n\\ge 0}$ denote the one-dimensional Legendre polynomials scaled to be $L^{2}(-1,1)$-orthonormal, i.e., $\\int_{-1}^{1}\\psi_{m}(\\xi)\\,\\psi_{n}(\\xi)\\,d\\xi=\\delta_{mn}$. Build a spectral $H(\\operatorname{curl})$-conforming basis on $\\hat{K}$ by tensor products that realize the first family of Nédélec spaces on hexahedra with possibly anisotropic polynomial orders $p_{x},p_{y},p_{z}\\in\\mathbb{N}$. Specifically, define the orientation-wise basis families\n- $x$-oriented: $\\boldsymbol{\\Phi}^{(x)}_{i,j,k}(x,y,z)=\\psi_{i}(x)\\,\\psi_{j}(y)\\,\\psi_{k}(z)\\,\\boldsymbol{e}_{x}$ for $i=0,\\dots,p_{x}-1$, $j=0,\\dots,p_{y}$, $k=0,\\dots,p_{z}$,\n- $y$-oriented: $\\boldsymbol{\\Phi}^{(y)}_{i,j,k}(x,y,z)=\\psi_{i}(x)\\,\\psi_{j}(y)\\,\\psi_{k}(z)\\,\\boldsymbol{e}_{y}$ for $i=0,\\dots,p_{x}$, $j=0,\\dots,p_{y}-1$, $k=0,\\dots,p_{z}$,\n- $z$-oriented: $\\boldsymbol{\\Phi}^{(z)}_{i,j,k}(x,y,z)=\\psi_{i}(x)\\,\\psi_{j}(y)\\,\\psi_{k}(z)\\,\\boldsymbol{e}_{z}$ for $i=0,\\dots,p_{x}$, $j=0,\\dots,p_{y}$, $k=0,\\dots,p_{z}-1$,\nwhere $\\boldsymbol{e}_{x},\\boldsymbol{e}_{y},\\boldsymbol{e}_{z}$ are the Cartesian unit vectors.\n\nLet the element-wise $H(\\operatorname{curl})$ mass matrix $\\boldsymbol{M}$ be defined by the $L^{2}$ inner product,\n$$\nM_{\\alpha\\beta}=\\int_{\\hat{K}}\\boldsymbol{\\Phi}_{\\alpha}(\\boldsymbol{x})\\cdot \\boldsymbol{\\Phi}_{\\beta}(\\boldsymbol{x})\\,d\\boldsymbol{x},\n$$\nwith a global basis index $\\alpha$ that ranges over the union of all three orientation-wise families. Using only the following foundational facts: (i) the definition of $H(\\operatorname{curl};\\hat{K})$ and the above polynomial subspace characterization of the first family of Nédélec spaces on hexahedra, (ii) orthogonality of the one-dimensional Legendre basis in $L^{2}(-1,1)$, and (iii) the exactness of tensor-product Gauss–Legendre (GL) quadrature in each coordinate direction for polynomials up to the appropriate degree, perform the following steps:\n- Derive the block structure of $\\boldsymbol{M}$ induced by the orientation-wise basis families and reduce each block to a tensor-product of one-dimensional mass matrices.\n- Using $L^{2}$ orthogonality of $\\{\\psi_{n}\\}$ and the exactness of tensor-product GL quadrature, determine the sparsity pattern within each block.\n\nFinally, give a closed-form expression for the exact total number of nonzero entries of $\\boldsymbol{M}$ as a function of $p_{x}$, $p_{y}$, and $p_{z}$. Your final answer must be a single analytic expression. No rounding is required, and no units are involved.", "solution": "The problem is valid as it is scientifically grounded in the theory of finite element methods and Sobolev spaces, is well-posed, and all terms are objectively and precisely defined.\n\nThe total set of basis functions, which we denote by $\\mathcal{B}$, is the union of the three orientation-wise families:\n$$\n\\mathcal{B} = \\left\\{\\boldsymbol{\\Phi}^{(x)}_{i,j,k}\\right\\} \\cup \\left\\{\\boldsymbol{\\Phi}^{(y)}_{i,j,k}\\right\\} \\cup \\left\\{\\boldsymbol{\\Phi}^{(z)}_{i,j,k}\\right\\}\n$$\nwith indices spanning the ranges specified in the problem statement. The element-wise $H(\\operatorname{curl})$ mass matrix $\\boldsymbol{M}$ has entries given by the $L^2(\\hat{K})$ inner product of these basis functions. Let $\\boldsymbol{\\Phi}_{\\alpha}$ and $\\boldsymbol{\\Phi}_{\\beta}$ be two generic basis functions from $\\mathcal{B}$, where $\\alpha$ and $\\beta$ are global indices. The corresponding matrix entry is\n$$\nM_{\\alpha\\beta} = \\int_{\\hat{K}}\\boldsymbol{\\Phi}_{\\alpha}(\\boldsymbol{x})\\cdot \\boldsymbol{\\Phi}_{\\beta}(\\boldsymbol{x})\\,d\\boldsymbol{x}\n$$\n\nFirst, we derive the block structure of $\\boldsymbol{M}$. The basis functions are defined as a scalar polynomial multiplied by a constant Cartesian unit vector $\\boldsymbol{e}_d$, where $d \\in \\{x,y,z\\}$. Let's consider the inner product of two basis functions with different orientations, for instance, $\\boldsymbol{\\Phi}_{\\alpha} = \\boldsymbol{\\Phi}^{(x)}_{i,j,k}$ and $\\boldsymbol{\\Phi}_{\\beta} = \\boldsymbol{\\Phi}^{(y)}_{i',j',k'}$. Their dot product is:\n$$\n\\boldsymbol{\\Phi}^{(x)}_{i,j,k} \\cdot \\boldsymbol{\\Phi}^{(y)}_{i',j',k'} = \\left(\\psi_{i}(x)\\psi_{j}(y)\\psi_{k}(z)\\boldsymbol{e}_{x}\\right) \\cdot \\left(\\psi_{i'}(x)\\psi_{j'}(y)\\psi_{k'}(z)\\boldsymbol{e}_{y}\\right)\n$$\n$$\n= \\left(\\psi_{i}(x)\\psi_{i'}(x)\\psi_{j}(y)\\psi_{j'}(y)\\psi_{k}(z)\\psi_{k'}(z)\\right) (\\boldsymbol{e}_{x} \\cdot \\boldsymbol{e}_{y})\n$$\nSince the Cartesian unit vectors are orthogonal, $\\boldsymbol{e}_{x} \\cdot \\boldsymbol{e}_{y} = 0$. Therefore, the integrand is identically zero, and the resulting matrix entry is $M_{\\alpha\\beta} = 0$. The same reasoning applies to the pairs $(\\boldsymbol{e}_{x}, \\boldsymbol{e}_{z})$ and $(\\boldsymbol{e}_{y}, \\boldsymbol{e}_{z})$. This demonstrates that the mass matrix $\\boldsymbol{M}$ is block-diagonal, with coupling only between basis functions of the same orientation.\n$$\n\\boldsymbol{M} =\n\\begin{pmatrix}\n\\boldsymbol{M}^{(x)} & \\boldsymbol{0} & \\boldsymbol{0} \\\\\n\\boldsymbol{0} & \\boldsymbol{M}^{(y)} & \\boldsymbol{0} \\\\\n\\boldsymbol{0} & \\boldsymbol{0} & \\boldsymbol{M}^{(z)}\n\\end{pmatrix}\n$$\nwhere each block $\\boldsymbol{M}^{(d)}$ corresponds to the inner products of the $d$-oriented basis functions.\n\nNext, we analyze the structure of each block, for example, $\\boldsymbol{M}^{(x)}$. The basis functions for this block are $\\boldsymbol{\\Phi}^{(x)}_{i,j,k}$ and $\\boldsymbol{\\Phi}^{(x)}_{i',j',k'}$. The corresponding matrix entry is:\n$$\nM^{(x)}_{(i,j,k), (i',j',k')} = \\int_{\\hat{K}} \\boldsymbol{\\Phi}^{(x)}_{i,j,k} \\cdot \\boldsymbol{\\Phi}^{(x)}_{i',j',k'} \\,d\\boldsymbol{x}\n$$\n$$\n= \\int_{-1}^{1} \\int_{-1}^{1} \\int_{-1}^{1} \\left(\\psi_{i}(x)\\psi_{j}(y)\\psi_{k}(z)\\boldsymbol{e}_{x}\\right) \\cdot \\left(\\psi_{i'}(x)\\psi_{j'}(y)\\psi_{k'}(z)\\boldsymbol{e}_{x}\\right) \\,dx\\,dy\\,dz\n$$\nUsing $\\boldsymbol{e}_{x} \\cdot \\boldsymbol{e}_{x} = 1$ and applying Fubini's theorem to separate the integral over the tensor-product domain $\\hat{K} = [-1,1]^3$, we obtain:\n$$\nM^{(x)}_{(i,j,k), (i',j',k')} = \\left( \\int_{-1}^{1} \\psi_i(x)\\psi_{i'}(x) \\,dx \\right) \\left( \\int_{-1}^{1} \\psi_j(y)\\psi_{j'}(y) \\,dy \\right) \\left( \\int_{-1}^{1} \\psi_k(z)\\psi_{k'}(z) \\,dz \\right)\n$$\nThe problem states that the one-dimensional basis functions $\\{\\psi_n\\}$ are $L^2(-1,1)$-orthonormal, which means $\\int_{-1}^{1}\\psi_{m}(\\xi)\\psi_{n}(\\xi)\\,d\\xi = \\delta_{mn}$, where $\\delta_{mn}$ is the Kronecker delta. Applying this property to each of the three integrals yields:\n$$\nM^{(x)}_{(i,j,k), (i',j',k')} = \\delta_{ii'} \\delta_{jj'} \\delta_{kk'}\n$$\nThis result implies that the matrix entry is $1$ if and only if $(i,j,k) = (i',j',k')$, and $0$ otherwise. Therefore, the block $\\boldsymbol{M}^{(x)}$ is an identity matrix. The same logic applies to $\\boldsymbol{M}^{(y)}$ and $\\boldsymbol{M}^{(z)}$, which are also identity matrices. The full mass matrix $\\boldsymbol{M}$ is therefore a large identity matrix.\n\nThe problem requires a justification using the exactness of Gauss-Legendre (GL) quadrature. An $N_q$-point GL rule on $[-1,1]$ is exact for any polynomial of degree up to $2N_q-1$. The integrand in the $x$-direction is $\\psi_i(x)\\psi_{i'}(x)$, which is a polynomial of degree $i+i'$. For the $x$-oriented block, the maximum value for $i$ and $i'$ is $p_x-1$, so the maximum degree is $2(p_x-1)$. To ensure exactness, we need $2N_{q,x}-1 \\ge 2(p_x-1)$, or $N_{q,x} \\ge p_x-1/2$, implying $N_{q,x} \\ge p_x$ since $N_{q,x}$ must be an integer. Similarly, for the $y$ and $z$ directions, the maximum polynomial degrees are $2p_y$ and $2p_z$, requiring $N_{q,y} \\ge p_y+1$ and $N_{q,z} \\ge p_z+1$ points. With a sufficient number of quadrature points, the tensor-product GL quadrature rule computes the integrals exactly, reaffirming that $M^{(x)}_{(i,j,k), (i',j',k')} = \\delta_{ii'} \\delta_{jj'} \\delta_{kk'}$.\n\nSince $\\boldsymbol{M}$ is an identity matrix, its non-zero entries are all on the diagonal and have a value of $1$. The total number of non-zero entries is equal to the total number of basis functions, which is the dimension of the matrix. We calculate this by summing the number of functions in each orientation family.\n\nNumber of $x$-oriented functions, $N_x$:\nThe indices are $i \\in \\{0, \\dots, p_x-1\\}$, $j \\in \\{0, \\dots, p_y\\}$, $k \\in \\{0, \\dots, p_z\\}$. The number of choices is $p_x$, $p_y+1$, and $p_z+1$ respectively.\n$$\nN_x = p_x (p_y+1) (p_z+1)\n$$\n\nNumber of $y$-oriented functions, $N_y$:\nThe indices are $i \\in \\{0, \\dots, p_x\\}$, $j \\in \\{0, \\dots, p_y-1\\}$, $k \\in \\{0, \\dots, p_z\\}$. The number of choices is $p_x+1$, $p_y$, and $p_z+1$.\n$$\nN_y = (p_x+1) p_y (p_z+1)\n$$\n\nNumber of $z$-oriented functions, $N_z$:\nThe indices are $i \\in \\{0, \\dots, p_x\\}$, $j \\in \\{0, \\dots, p_y\\}$, $k \\in \\{0, \\dots, p_z-1\\}$. The number of choices is $p_x+1$, $p_y+1$, and $p_z$.\n$$\nN_z = (p_x+1) (p_y+1) p_z\n$$\n\nThe total number of non-zero entries is the sum $N = N_x + N_y + N_z$. We expand each term:\n$N_x = p_x(p_y p_z + p_y + p_z + 1) = p_x p_y p_z + p_x p_y + p_x p_z + p_x$\n$N_y = p_y(p_x p_z + p_x + p_z + 1) = p_x p_y p_z + p_x p_y + p_y p_z + p_y$\n$N_z = p_z(p_x p_y + p_x + p_y + 1) = p_x p_y p_z + p_x p_z + p_y p_z + p_z$\n\nSumming these expressions and collecting like terms:\n- The $p_x p_y p_z$ terms: $p_x p_y p_z + p_x p_y p_z + p_x p_y p_z = 3p_x p_y p_z$.\n- The $p_x p_y$ terms: $p_x p_y + p_x p_y = 2p_x p_y$.\n- The $p_x p_z$ terms: $p_x p_z + p_x p_z = 2p_x p_z$.\n- The $p_y p_z$ terms: $p_y p_z + p_y p_z = 2p_y p_z$.\n- The linear terms: $p_x, p_y, p_z$.\n\nThe total number of non-zero entries is:\n$$\nN = 3p_x p_y p_z + 2(p_x p_y + p_x p_z + p_y p_z) + p_x + p_y + p_z\n$$\nThis is the final closed-form expression for the total number of non-zero entries in the mass matrix $\\boldsymbol{M}$.", "answer": "$$\n\\boxed{3p_{x}p_{y}p_{z} + 2(p_{x}p_{y} + p_{x}p_{z} + p_{y}p_{z}) + p_{x} + p_{y} + p_{z}}\n$$", "id": "3389511"}, {"introduction": "The properties of $H(\\mathrm{curl})$ and $H(\\mathrm{div})$ spaces are intricately linked to the topology of the underlying domain. This exercise moves beyond simple domains to explore a multiply connected cylindrical annulus, a geometry with a non-contractible loop. You will construct a special 'harmonic' vector field that is both curl-free and divergence-free, yet, due to the domain's topology, cannot be represented as a simple gradient or curl of another potential. [@problem_id:3389501] This exploration reveals the existence of non-trivial cohomology classes, providing a deep, tangible understanding of why certain vector fields require special treatment in both theory and numerical simulation.", "problem": "Let $\\Omega \\subset \\mathbb{R}^{3}$ be the coaxial cylindrical annulus defined in cylindrical coordinates $(r,\\theta,z)$ by $\\Omega=\\{(r,\\theta,z): a<r<b,\\ 0<z<L,\\ 0\\le \\theta<2\\pi\\}$, where $a$, $b$, and $L$ are fixed real numbers with $0<a<b$ and $L>0$. This domain is multiply connected because any closed loop homologous to the circle $\\{(r,\\theta,z): r=\\rho,\\ \\theta\\in[0,2\\pi),\\ z=z_{0}\\}$, with fixed $\\rho\\in(a,b)$ and $z_{0}\\in(0,L)$, cannot be contracted to a point within $\\Omega$.\n\nConsider the following tasks grounded in the definitions of the Sobolev space of square-integrable vector fields with square-integrable curl $H(\\mathrm{curl},\\Omega)$ and the Sobolev space of square-integrable vector fields with square-integrable divergence $H(\\mathrm{div},\\Omega)$, and using only fundamental vector calculus operations and the classical theorems of Green and Stokes as the starting point:\n\n1. Propose a vector field $h_{C}:\\Omega\\to\\mathbb{R}^{3}$, depending on a scalar constant $C\\in\\mathbb{R}$, that is everywhere tangent to circles around the $z$-axis, and whose magnitude depends only on the radius $r$. Prove from first principles that the proposed $h_{C}$ belongs to $H(\\mathrm{curl},\\Omega)\\cap H(\\mathrm{div},\\Omega)$ by verifying that $h_{C}\\in L^{2}(\\Omega)$ and that both $\\nabla\\times h_{C}$ and $\\nabla\\cdot h_{C}$ belong to $L^{2}(\\Omega)$.\n\n2. Prove that your $h_{C}$ is nontrivial, i.e., not the zero field almost everywhere in $\\Omega$, and that it is a harmonic field in the sense that $\\nabla\\times h_{C}=\\mathbf{0}$ and $\\nabla\\cdot h_{C}=0$ in the strong (pointwise) sense.\n\n3. Using the fundamental theorem for line integrals and Stokes’ theorem, prove that $h_{C}$ is not a gradient of any scalar potential in $H^{1}(\\Omega)$ by exhibiting a closed curve $\\gamma\\subset\\Omega$ for which the circulation $\\int_{\\gamma} h_{C}\\cdot \\mathrm{d}\\ell\\neq 0$.\n\n4. Let $\\mathbf{n}$ denote the outward unit normal on $\\partial\\Omega$. Show that $h_{C}$ cannot be written as the curl of any vector potential $A\\in H(\\mathrm{curl},\\Omega)$ satisfying the homogeneous tangential boundary condition $A\\times \\mathbf{n}=\\mathbf{0}$ on $\\partial\\Omega$ (the perfect electric conductor condition that arises in compatible spectral and Discontinuous Galerkin (DG) formulations). Your argument must be based on Stokes’ theorem applied to a surface $S\\subset\\overline{\\Omega}$ whose boundary $\\partial S$ lies on $\\partial\\Omega$.\n\n5. Finally, determine the unique constant $C>0$ such that the $L^{2}$-norm of $h_{C}$ equals $1$, i.e., such that $\\|h_{C}\\|_{L^{2}(\\Omega)}=1$. Your final answer must be a single closed-form analytic expression for $C$ in terms of $a$, $b$, and $L$.\n\nYour answer must be a single analytic expression. No rounding is required, and no units are involved.", "solution": "The problem is well-posed and scientifically sound, grounded in the fundamental theory of vector calculus and Sobolev spaces on a multiply connected domain. We proceed by addressing each of the five parts sequentially.\n\nLet the domain be $\\Omega=\\{(r,\\theta,z): a<r<b,\\ 0<z<L,\\ 0\\le \\theta<2\\pi\\}$ in cylindrical coordinates $(r,\\theta,z)$. The standard unit vectors in the cylindrical system are $\\hat{r}$, $\\hat{\\theta}$, and $\\hat{z}$. The volume element is $dV = r\\,dr\\,d\\theta\\,dz$.\n\n**1. Proposal and Verification of $h_C \\in H(\\mathrm{curl},\\Omega)\\cap H(\\mathrm{div},\\Omega)$**\n\nWe are asked to propose a vector field $h_C$ that is tangent to circles around the z-axis and whose magnitude depends only on the radius $r$. This structure implies that $h_C$ must be of the form $h_C(r,\\theta,z) = f(r)\\hat{\\theta}$ for some scalar function $f$. A canonical choice for such a field, which will be shown to be harmonic, is one where the magnitude is inversely proportional to the radius. Let us propose:\n$$\nh_C = C\\frac{1}{r}\\hat{\\theta}\n$$\nwhere $C \\in \\mathbb{R}$ is a scalar constant.\n\nTo prove that $h_C \\in H(\\mathrm{curl},\\Omega)\\cap H(\\mathrm{div},\\Omega)$, we must verify that $h_C \\in L^2(\\Omega)$, $\\nabla \\times h_C \\in L^2(\\Omega)$, and $\\nabla \\cdot h_C \\in L^2(\\Omega)$.\n\nFirst, we check if $h_C \\in L^2(\\Omega)$ by computing its squared $L^2$-norm:\n$$\n\\|h_C\\|_{L^2(\\Omega)}^2 = \\int_\\Omega |h_C|^2 \\, dV\n$$\nThe squared magnitude of $h_C$ is $|h_C|^2 = h_C \\cdot h_C = \\left(C\\frac{1}{r}\\hat{\\theta}\\right) \\cdot \\left(C\\frac{1}{r}\\hat{\\theta}\\right) = \\frac{C^2}{r^2}$.\n$$\n\\|h_C\\|_{L^2(\\Omega)}^2 = \\int_0^L \\int_0^{2\\pi} \\int_a^b \\frac{C^2}{r^2} (r\\,dr\\,d\\theta\\,dz) = C^2 \\int_0^L dz \\int_0^{2\\pi} d\\theta \\int_a^b \\frac{1}{r} dr\n$$\n$$\n= C^2 (L)(2\\pi) [\\ln(r)]_a^b = 2\\pi L C^2 (\\ln(b) - \\ln(a)) = 2\\pi L C^2 \\ln\\left(\\frac{b}{a}\\right)\n$$\nSince $0 < a < b$ and $L > 0$, the quantity $2\\pi L \\ln(b/a)$ is a finite positive number. Thus, for any finite constant $C$, the integral is finite. This confirms that $h_C \\in L^2(\\Omega)$.\n\nNext, we compute the curl of $h_C$. In cylindrical coordinates, the curl of a vector field $F = F_r\\hat{r} + F_\\theta\\hat{\\theta} + F_z\\hat{z}$ is given by:\n$$\n\\nabla \\times F = \\frac{1}{r}\\left(\\frac{\\partial F_z}{\\partial \\theta} - \\frac{\\partial (rF_\\theta)}{\\partial z}\\right)\\hat{r} + \\left(\\frac{\\partial F_r}{\\partial z} - \\frac{\\partial F_z}{\\partial r}\\right)\\hat{\\theta} + \\frac{1}{r}\\left(\\frac{\\partial (rF_\\theta)}{\\partial r} - \\frac{\\partial F_r}{\\partial \\theta}\\right)\\hat{z}\n$$\nFor $h_C$, we have $F_r=0$, $F_\\theta = C/r$, and $F_z=0$. The components are independent of $\\theta$ and $z$.\n$$\n\\nabla \\times h_C = \\frac{1}{r}(0-0)\\hat{r} + (0-0)\\hat{\\theta} + \\frac{1}{r}\\left(\\frac{\\partial}{\\partial r}\\left(r \\cdot \\frac{C}{r}\\right) - 0\\right)\\hat{z} = \\frac{1}{r}\\left(\\frac{\\partial C}{\\partial r}\\right)\\hat{z} = \\mathbf{0}\n$$\nThe curl is the zero vector field, $\\mathbf{0}$. The $L^2$-norm of the zero vector field is $\\|\\mathbf{0}\\|_{L^2(\\Omega)} = 0$, which is finite. Thus, $\\nabla \\times h_C \\in L^2(\\Omega)$.\n\nFinally, we compute the divergence of $h_C$. In cylindrical coordinates, the divergence is:\n$$\n\\nabla \\cdot F = \\frac{1}{r}\\frac{\\partial (rF_r)}{\\partial r} + \\frac{1}{r}\\frac{\\partial F_\\theta}{\\partial \\theta} + \\frac{\\partial F_z}{\\partial z}\n$$\nFor $h_C$, this becomes:\n$$\n\\nabla \\cdot h_C = \\frac{1}{r}\\frac{\\partial (r \\cdot 0)}{\\partial r} + \\frac{1}{r}\\frac{\\partial (C/r)}{\\partial \\theta} + \\frac{\\partial 0}{\\partial z} = 0 + 0 + 0 = 0\n$$\nThe divergence is the zero scalar field, $0$. The $L^2$-norm of the zero scalar field is $\\|0\\|_{L^2(\\Omega)} = 0$, which is finite. Therefore, $\\nabla \\cdot h_C \\in L^2(\\Omega)$.\nSince all three conditions are satisfied, we have proven that $h_C \\in H(\\mathrm{curl},\\Omega)\\cap H(\\mathrm{div},\\Omega)$.\n\n**2. Nontriviality and Harmonic Property of $h_C$**\n\nFor any $C \\neq 0$, the magnitude of $h_C$ is $|h_C| = |C|/r$. Since $r \\in (a,b)$ within $\\Omega$, $|h_C|$ is strictly positive everywhere in the domain. Thus, $h_C$ is not the zero vector field almost everywhere, i.e., it is nontrivial.\n\nA vector field $u$ is defined as harmonic if it is both curl-free and divergence-free. From the calculations in Part 1, we found that:\n\\begin{enumerate}\n    \\item $\\nabla \\times h_C = \\mathbf{0}$\n    \\item $\\nabla \\cdot h_C = 0$\n\\end{enumerate}\nThese relations hold pointwise for all points in $\\Omega$, not just in a weak or distributional sense. Therefore, $h_C$ is a harmonic field in the strong sense.\n\n**3. Proof that $h_C$ is not a Gradient**\n\nAccording to the fundamental theorem for line integrals (a consequence of Stokes' theorem), if a vector field $v$ is the gradient of a scalar potential $\\phi \\in H^1(\\Omega)$ (i.e., $v = \\nabla\\phi$), then its circulation around any closed curve $\\gamma \\subset \\Omega$ must be zero: $\\oint_\\gamma v \\cdot d\\ell = 0$.\n\nTo prove that $h_C$ is not a gradient of any such $\\phi$, we must find a closed curve $\\gamma$ in $\\Omega$ for which the circulation is non-zero. Let's choose the curve suggested by the problem's description of the domain's topology: a circle of radius $\\rho$ at a constant height $z_0$, where $a < \\rho < b$ and $0 < z_0 < L$.\nThis curve $\\gamma$ can be parametrized in cylindrical coordinates as $r=\\rho$, $z=z_0$, with $\\theta$ varying from $0$ to $2\\pi$. The differential line element is $d\\ell = \\rho\\,d\\theta\\,\\hat{\\theta}$.\n\nThe circulation of $h_C$ around $\\gamma$ is:\n$$\n\\oint_\\gamma h_C \\cdot d\\ell = \\int_0^{2\\pi} \\left(C\\frac{1}{\\rho}\\hat{\\theta}\\right) \\cdot (\\rho\\,d\\theta\\,\\hat{\\theta}) = \\int_0^{2\\pi} C \\, d\\theta = C[\\theta]_0^{2\\pi} = 2\\pi C\n$$\nFor any choice of $C \\neq 0$, the circulation is non-zero. This non-zero result proves that $h_C$ cannot be expressed as the gradient of any single-valued scalar potential $\\phi \\in H^1(\\Omega)$. Such fields are known as non-exact harmonic fields and are generators of the first de Rham cohomology group of the domain $\\Omega$.\n\n**4. Proof that $h_C$ is not a Curl of a Potential with Tangential Boundary Conditions**\n\nWe want to show that $h_C$ cannot be written as $\\nabla \\times A$ for a vector potential $A \\in H(\\mathrm{curl},\\Omega)$ that satisfies the boundary condition $A \\times \\mathbf{n} = \\mathbf{0}$ on $\\partial\\Omega$. We use an argument by contradiction.\n\nAssume such a vector potential $A$ exists, so $h_C = \\nabla \\times A$.\nLet's consider a surface $S \\subset \\overline{\\Omega}$ that cuts through the annulus. A convenient choice is a radial cross-section at a fixed angle, say $\\theta=0$:\n$$\nS = \\{(r, \\theta, z) : a \\le r \\le b, 0 \\le z \\le L, \\theta=0\\}\n$$\nThe unit normal to this surface (in the direction of increasing $\\theta$) is $\\mathbf{n}_S = \\hat{\\theta}$. The boundary of this surface, $\\partial S$, is a rectangle that lies entirely on the boundary of the domain $\\partial \\Omega$.\n\nFirst, let's compute the flux of $h_C$ through $S$:\n$$\n\\Phi = \\int_S h_C \\cdot \\mathbf{n}_S \\, dS\n$$\nThe area element is $dS = dr\\,dz$.\n$$\n\\Phi = \\int_0^L \\int_a^b \\left(C\\frac{1}{r}\\hat{\\theta}\\right) \\cdot \\hat{\\theta} \\, dr \\, dz = C \\int_0^L dz \\int_a^b \\frac{1}{r} dr = C(L)[\\ln(r)]_a^b = C L \\ln\\left(\\frac{b}{a}\\right)\n$$\nFor any $C \\neq 0$, this flux is non-zero.\n\nNow, by our assumption $h_C = \\nabla \\times A$, we can apply Stokes' theorem to relate this flux to a line integral of $A$ over the boundary $\\partial S$:\n$$\n\\Phi = \\int_S (\\nabla \\times A) \\cdot \\mathbf{n}_S \\, dS = \\oint_{\\partial S} A \\cdot d\\ell\n$$\nThe path of integration $\\partial S$ lies on the boundary of the domain, $\\partial\\Omega$. The boundary condition on $A$ is $A \\times \\mathbf{n} = \\mathbf{0}$ for every point on $\\partial\\Omega$, where $\\mathbf{n}$ is the outward unit normal to $\\partial\\Omega$. This condition implies that the vector $A$ is parallel to $\\mathbf{n}$ (i.e., $A$ is normal to the boundary surface).\n\nThe differential path element $d\\ell$ along the curve $\\partial S$ is, by its nature, tangent to the boundary surface $\\partial\\Omega$. Therefore, at every point along the integration path $\\partial S$, the vector $A$ is orthogonal to the vector $d\\ell$. Their dot product is zero:\n$$\nA \\cdot d\\ell = 0 \\quad \\text{for all points on } \\partial S\n$$\nThis implies that the line integral is zero:\n$$\n\\oint_{\\partial S} A \\cdot d\\ell = 0\n$$\nWe have thus arrived at a contradiction:\n$$\nC L \\ln\\left(\\frac{b}{a}\\right) = 0\n$$\nGiven that $L>0$ and $b>a>0$, this equation can only be true if $C=0$. However, we are interested in nontrivial fields where $C\\neq 0$. This contradiction shows that our initial assumption was false. Therefore, for any $C \\neq 0$, $h_C$ cannot be written as the curl of a vector potential $A$ satisfying the specified tangential boundary condition. Such fields are related to the second de Rham cohomology group of the domain relative to its boundary.\n\n**5. Determination of the Normalization Constant $C$**\n\nWe need to find the unique constant $C>0$ such that the $L^2$-norm of $h_C$ is equal to $1$.\n$$\n\\|h_C\\|_{L^2(\\Omega)} = 1\n$$\nFrom Part 1, we calculated the squared norm:\n$$\n\\|h_C\\|_{L^2(\\Omega)}^2 = 2\\pi L C^2 \\ln\\left(\\frac{b}{a}\\right)\n$$\nSetting this equal to $1^2=1$:\n$$\n2\\pi L C^2 \\ln\\left(\\frac{b}{a}\\right) = 1\n$$\nSolving for $C^2$:\n$$\nC^2 = \\frac{1}{2\\pi L \\ln\\left(\\frac{b}{a}\\right)}\n$$\nSince we require $C>0$, we take the positive square root:\n$$\nC = \\sqrt{\\frac{1}{2\\pi L \\ln\\left(\\frac{b}{a}\\right)}} = \\frac{1}{\\sqrt{2\\pi L \\ln\\left(\\frac{b}{a}\\right)}}\n$$\nThis provides the unique positive constant $C$ that normalizes the field $h_C$ in the $L^2$ sense.", "answer": "$$\\boxed{\\frac{1}{\\sqrt{2\\pi L \\ln\\left(\\frac{b}{a}\\right)}}}$$", "id": "3389501"}, {"introduction": "A cornerstone of robust scientific computing is the verification that a numerical method correctly reproduces the fundamental properties of the continuous equations. This practice brings the theoretical concepts of $H(\\mathrm{div})$ and $H(\\mathrm{curl})$ into a computational setting through the method of manufactured solutions. You will design and implement a numerical test to verify that a Fourier spectral method preserves the divergence-free and curl-free constraints to within machine precision. [@problem_id:3389520] This hands-on coding exercise demonstrates a critical skill in computational science and reinforces the importance of using discretizations that respect the intrinsic structure of the underlying physics.", "problem": "You are asked to implement a verification program for constraints associated with the Sobolev spaces of square-integrable divergence (denoted as $H(\\mathrm{div},\\Omega)$) and square-integrable curl (denoted as $H(\\mathrm{curl},\\Omega)$) for vector fields discretized by a spectral method. Work on the periodic square domain $\\Omega = [0,2\\pi)\\times[0,2\\pi)$, and use a Fourier collocation discretization to approximate spatial derivatives. The purpose is to design manufactured vector fields that are either exactly divergence-free or exactly curl-free and then confirm that the discrete spectral derivative operators preserve these constraints to within prescribed tolerances. This verification problem targets advanced understanding of spectral and Discontinuous Galerkin (DG) methods; you will use a spectral discretization to emulate the ideal constraint-preservation behavior that $H(\\mathrm{div},\\Omega)$ and $H(\\mathrm{curl},\\Omega)$ conforming methods aim to achieve.\n\nStart from the following definitions and facts as the only permitted base:\n- A vector field $\\boldsymbol{v}=(v_1,v_2)$ belongs to $H(\\mathrm{div},\\Omega)$ if $\\boldsymbol{v}\\in L^2(\\Omega)^2$ and $\\mathrm{div}\\,\\boldsymbol{v}=\\partial_x v_1+\\partial_y v_2\\in L^2(\\Omega)$.\n- A vector field $\\boldsymbol{v}=(v_1,v_2)$ belongs to $H(\\mathrm{curl},\\Omega)$ if $\\boldsymbol{v}\\in L^2(\\Omega)^2$ and $\\mathrm{curl}\\,\\boldsymbol{v}=\\partial_x v_2-\\partial_y v_1\\in L^2(\\Omega)$.\n- On a periodic domain, the Fourier collocation method computes discrete derivatives by multiplying Fourier coefficients by the appropriate wavenumbers.\n- For a scalar potential $\\phi$, the gradient field $\\boldsymbol{v}=\\nabla \\phi$ is curl-free, and for a scalar streamfunction $\\psi$, the field $\\boldsymbol{v}=(\\partial_y\\psi,-\\partial_x\\psi)$ is divergence-free.\n\nYour program must:\n- Use a uniform $N\\times N$ grid of points $(x_i,y_j)$ with $x_i = \\frac{2\\pi i}{N}$ and $y_j = \\frac{2\\pi j}{N}$ for $i,j\\in\\{0,\\dots,N-1\\}$.\n- Construct manufactured fields of two types:\n  - Divergence-free fields from a streamfunction $\\psi(x,y)=A\\cos(k_x x)\\cos(k_y y)$ via $\\boldsymbol{v}(x,y)=\\left(\\partial_y\\psi(x,y),-\\partial_x\\psi(x,y)\\right)$.\n  - Curl-free fields from a potential $\\phi(x,y)=A\\cos(k_x x)\\cos(k_y y)$ via $\\boldsymbol{v}(x,y)=\\nabla \\phi(x,y)$.\n- Compute discrete derivatives using the Fourier collocation method with the Fast Fourier Transform (FFT), i.e., for any scalar grid field $f$, compute $\\widehat{f}$ via a two-dimensional FFT and apply $\\partial_x f = \\mathcal{F}^{-1}\\left\\{ \\mathrm{i}k_x \\widehat{f}\\right\\}$ and $\\partial_y f = \\mathcal{F}^{-1}\\left\\{ \\mathrm{i}k_y \\widehat{f}\\right\\}$, where $k_x$ and $k_y$ are the discrete Fourier wavenumbers consistent with the grid and domain length $2\\pi$.\n- Evaluate the discrete divergence and discrete curl:\n  - $\\mathrm{div}_h\\,\\boldsymbol{v} = \\partial_x v_1 + \\partial_y v_2$,\n  - $\\mathrm{curl}_h\\,\\boldsymbol{v} = \\partial_x v_2 - \\partial_y v_1$.\n- Quantify the residuals with relative $L^2$ norms:\n  - $r_{\\mathrm{div}} = \\dfrac{\\|\\mathrm{div}_h\\,\\boldsymbol{v}\\|_{L^2}}{\\|\\boldsymbol{v}\\|_{L^2}+\\varepsilon}$,\n  - $r_{\\mathrm{curl}} = \\dfrac{\\|\\mathrm{curl}_h\\,\\boldsymbol{v}\\|_{L^2}}{\\|\\boldsymbol{v}\\|_{L^2}+\\varepsilon}$,\n  where $\\varepsilon$ is a tiny positive number to avoid division by zero if $\\boldsymbol{v}$ is identically zero.\n- Compare each residual against a supplied tolerance and return a boolean indicating whether the constraint is preserved within that tolerance.\n\nImplement and run the following test suite of input parameter sets. Each test case specifies how to manufacture the field, the grid size, the wavenumbers, the amplitude, which constraint to check, and the tolerance:\n- Test $1$ (resolved divergence-free): type $=$ divergence-free, $N=32$, $k_x=3$, $k_y=4$, $A=1$, check $=$ divergence, tolerance $=10^{-12}$.\n- Test $2$ (resolved curl-free): type $=$ curl-free, $N=48$, $k_x=5$, $k_y=7$, $A=0.7$, check $=$ curl, tolerance $=10^{-12}$.\n- Test $3$ (under-resolved divergence-free): type $=$ divergence-free, $N=16$, $k_x=25$, $k_y=10$, $A=1$, check $=$ divergence, tolerance $=10^{-8}$.\n- Test $4$ (constant field, both constraints): type $=$ constant, $N=8$, constant vector $\\boldsymbol{v}=(2.5,-1.25)$, check $=$ both, tolerance $=10^{-15}$.\n- Test $5$ (near-Nyquist, resolved curl-free): type $=$ curl-free, $N=36$, $k_x=17$, $k_y=0$, $A=0.9$, check $=$ curl, tolerance $=10^{-12}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the tests above. For example, if all tests pass, output should look like $[\\mathrm{True},\\mathrm{True},\\mathrm{True},\\mathrm{True},\\mathrm{True}]$.\n\nNo physical units or angle units beyond the implicit radians of the periodic domain are required. All numeric computations must be purely mathematical. The final output for each test case must be a boolean indicating whether the corresponding constraint is preserved within the specified tolerance.", "solution": "The task is to verify constraint preservation for $H(\\mathrm{div},\\Omega)$ and $H(\\mathrm{curl},\\Omega)$ fields using a Fourier spectral collocation method on a periodic square. The fundamental base is the definition of divergence and curl, the membership definitions of $H(\\mathrm{div},\\Omega)$ and $H(\\mathrm{curl},\\Omega)$, and the Fourier differentiation principle on periodic domains.\n\nStep $1$ (domain and grid): Consider $\\Omega=[0,2\\pi)\\times[0,2\\pi)$. For a given integer $N\\ge 1$, define a uniform grid by $x_i=\\frac{2\\pi i}{N}$ and $y_j=\\frac{2\\pi j}{N}$ for $i,j\\in\\{0,\\dots,N-1\\}$. This choice ensures compatibility with discrete Fourier transforms and periodicity.\n\nStep $2$ (manufactured fields):\n- Divergence-free fields are constructed via a scalar streamfunction $\\psi(x,y)=A\\cos(k_x x)\\cos(k_y y)$, defining $\\boldsymbol{v}(x,y)=\\left(\\partial_y\\psi(x,y),-\\partial_x\\psi(x,y)\\right)$. Analytically, $\\mathrm{div}\\,\\boldsymbol{v}=\\partial_x\\partial_y\\psi-\\partial_y\\partial_x\\psi=0$, so $\\boldsymbol{v}\\in H(\\mathrm{div},\\Omega)$ with zero divergence.\n- Curl-free fields are constructed via a scalar potential $\\phi(x,y)=A\\cos(k_x x)\\cos(k_y y)$, defining $\\boldsymbol{v}(x,y)=\\nabla \\phi(x,y)$. Analytically, $\\mathrm{curl}\\,\\boldsymbol{v}=\\partial_x\\partial_y\\phi-\\partial_y\\partial_x\\phi=0$, so $\\boldsymbol{v}\\in H(\\mathrm{curl},\\Omega)$ with zero curl.\n- A constant vector field $\\boldsymbol{v}=(c_1,c_2)$ is both divergence-free and curl-free, providing an edge case test; the derivatives vanish exactly.\n\nStep $3$ (spectral differentiation): On a periodic grid consistent with the length $2\\pi$ in each direction, the Fourier wavenumbers associated with the sampling are integers when scaled by $2\\pi$. Specifically, if $d=\\frac{2\\pi}{N}$ is the grid spacing, the physical wavenumbers used in the discrete Fourier derivative are $k=\\;2\\pi\\,\\mathrm{fftfreq}(N,d)$, where $\\mathrm{fftfreq}$ is the frequency grid in cycles per unit length. For any grid function $f(x_i,y_j)$, compute the two-dimensional Fast Fourier Transform (FFT) $\\widehat{f}$, then apply the derivative in Fourier space:\n- $\\partial_x f = \\mathcal{F}^{-1}\\{\\mathrm{i}k_x \\widehat{f}\\}$,\n- $\\partial_y f = \\mathcal{F}^{-1}\\{\\mathrm{i}k_y \\widehat{f}\\}$,\nwhere $k_x$ and $k_y$ are combined by a tensor product to obtain the two-dimensional wavenumber arrays.\n\nStep $4$ (discrete divergence and curl): For a vector field $\\boldsymbol{v}=(v_1,v_2)$ on the grid, compute\n- $\\mathrm{div}_h\\,\\boldsymbol{v} = \\partial_x v_1 + \\partial_y v_2$,\n- $\\mathrm{curl}_h\\,\\boldsymbol{v} = \\partial_x v_2 - \\partial_y v_1$,\nusing the spectral differentiation described in step $3$.\n\nStep $5$ (norms and residuals): To produce dimensionless, scale-invariant measures, compute relative $L^2$ residuals\n- $r_{\\mathrm{div}} = \\dfrac{\\|\\mathrm{div}_h\\,\\boldsymbol{v}\\|_{L^2}}{\\|\\boldsymbol{v}\\|_{L^2}+\\varepsilon}$,\n- $r_{\\mathrm{curl}} = \\dfrac{\\|\\mathrm{curl}_h\\,\\boldsymbol{v}\\|_{L^2}}{\\|\\boldsymbol{v}\\|_{L^2}+\\varepsilon}$,\nwith a tiny $\\varepsilon>0$ preventing division by zero in constant-zero cases. The discrete $L^2$ norm is computed as the square root of the average of the squared field values, which is consistent up to a constant with the continuous norm on the uniform grid.\n\nStep $6$ (theoretical expectation): For trigonometric polynomials whose wavenumbers are resolved by the grid, the Fourier collocation derivative is exact up to round-off, because the discrete Fourier transform exactly represents those modes and the multiplication by wavenumbers implements the derivative exactly in the discrete setting. Thus, a divergence-free field manufactured from a streamfunction, when sampled and differentiated spectrally, should yield $\\mathrm{div}_h\\,\\boldsymbol{v}\\approx 0$ up to machine accuracy. Similarly, a curl-free field manufactured from a potential should yield $\\mathrm{curl}_h\\,\\boldsymbol{v}\\approx 0$. For under-resolved fields, aliasing leads to representation errors that manifest as nonzero residuals, potentially exceeding a tight tolerance.\n\nStep $7$ (algorithm):\n- For each test case, construct the vector field on the $N\\times N$ grid according to its type and parameters $(k_x,k_y,A)$ or as a constant field.\n- Compute the spectral derivatives and then $\\mathrm{div}_h$ and $\\mathrm{curl}_h$.\n- Compute $r_{\\mathrm{div}}$ and $r_{\\mathrm{curl}}$.\n- Compare the appropriate residual(s) against the given tolerance to yield a boolean pass or fail.\n\nStep $8$ (test suite and outputs): Execute the five specified tests:\n- Test $1$ uses $(N,k_x,k_y,A)=(32,3,4,1)$ for a divergence-free field and checks $r_{\\mathrm{div}}\\le 10^{-12}$.\n- Test $2$ uses $(N,k_x,k_y,A)=(48,5,7,0.7)$ for a curl-free field and checks $r_{\\mathrm{curl}}\\le 10^{-12}$.\n- Test $3$ uses $(N,k_x,k_y,A)=(16,25,10,1)$ for a divergence-free field and checks $r_{\\mathrm{div}}\\le 10^{-8}$, which is expected to be more challenging due to under-resolution and aliasing.\n- Test $4$ uses $(N,\\boldsymbol{v})=(8,(2.5,-1.25))$ and checks both $r_{\\mathrm{div}}\\le 10^{-15}$ and $r_{\\mathrm{curl}}\\le 10^{-15}$.\n- Test $5$ uses $(N,k_x,k_y,A)=(36,17,0,0.9)$ for a curl-free field and checks $r_{\\mathrm{curl}}\\le 10^{-12}$.\n\nFinally, aggregate the five boolean results into a single list and print them on a single line in the exact format $[b_1,b_2,b_3,b_4,b_5]$ with no additional text. This verifies, through manufactured solutions and spectral differentiation, whether discretization preserves $H(\\mathrm{div},\\Omega)$ and $H(\\mathrm{curl},\\Omega)$ constraints within the prescribed tolerances.", "answer": "[True,True,True,True,True]", "id": "3389520"}]}