{"hands_on_practices": [{"introduction": "The Lax-Richtmyer equivalence theorem is a cornerstone of numerical analysis, stating that for a well-posed linear problem, a scheme converges if and only if it is both stable and consistent. This exercise provides a concrete counterexample that illuminates the necessity of the consistency requirement. By analyzing a scheme [@problem_id:3394996] that is provably stable yet inconsistent with the target equation, you will see directly why it fails to converge to the correct solution, reinforcing the fundamental interplay between these three core concepts.", "problem": "Consider the periodic linear advection initial value problem $u_{t} + a\\,u_{x} = 0$ for $x \\in [0,2\\pi]$ and $t \\ge 0$, with periodic boundary conditions and zero initial data $u(x,0) = 0$. This problem is well-posed in the sense that for any admissible initial data in a suitable normed space, there exists a unique solution that depends continuously on the initial data. In the context of spectral methods and Discontinuous Galerkin (DG) methods, a linear scheme is called stable if its homogeneous part generates a bounded evolution in the chosen norm and is called consistent if the discrete operator applied to sufficiently smooth exact solutions yields a residual that tends to zero under refinement.\n\nConstruct the following Fourier spectral semi-discrete scheme with $N$ modes (labeled by integers $k$ with $|k| \\le K$ where $N = 2K+1$): expand $u_{N}(x,t) = \\sum_{|k| \\le K} \\hat{u}_{k}(t)\\,\\exp(i k x)$ and evolve the modal coefficients according to\n$$\n\\frac{d}{dt}\\,\\hat{u}_{k}(t) \\;=\\; -\\,i\\,a\\,k\\,\\hat{u}_{k}(t) \\;+\\; \\gamma\\,\\delta_{k,0},\n$$\nwith parameter $a = 1$, forcing amplitude $\\gamma = 1$, and Kronecker delta $\\delta_{k,0}$. Assume exact time integration of this semi-discrete system. This scheme is linear and its homogeneous part corresponds to the standard Fourier spectral discretization of the skew-adjoint advection operator, which is norm-preserving in the $L^{2}$ norm. However, the added zero-mode forcing makes the scheme inconsistent with the original homogeneous problem.\n\nUsing first-principles reasoning starting from the definitions above and the exact evolution of the semi-discrete system, show that the scheme is stable (in the sense that the homogeneous evolution preserves the $L^{2}$ norm) yet inconsistent, and explain why it does not converge to the exact solution $u \\equiv 0$. Then, compute the limit of the $L^{2}$ error at time $t = 1$ as the number of modes $N \\to \\infty$:\n$$\n\\lim_{N \\to \\infty} \\,\\left\\| u_{N}(\\cdot,1) - 0 \\right\\|_{L^{2}(0,2\\pi)}.\n$$\nProvide your final answer as a single closed-form analytic expression. No rounding is required. Angles, if any, must be expressed in radians.", "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\nThe givens are:\n1.  The partial differential equation (PDE) is the linear advection equation: $u_{t} + a\\,u_{x} = 0$.\n2.  The spatial domain is $x \\in [0,2\\pi]$ with periodic boundary conditions.\n3.  The temporal domain is $t \\ge 0$.\n4.  The initial condition is $u(x,0) = 0$.\n5.  A Fourier spectral semi-discrete scheme is proposed for a numerical solution $u_{N}(x,t) = \\sum_{|k| \\le K} \\hat{u}_{k}(t)\\,\\exp(i k x)$, where $N = 2K+1$.\n6.  The evolution of the modal coefficients $\\hat{u}_{k}(t)$ is given by the ordinary differential equation (ODE) system: $\\frac{d}{dt}\\,\\hat{u}_{k}(t) \\;=\\; -\\,i\\,a\\,k\\,\\hat{u}_{k}(t) \\;+\\; \\gamma\\,\\delta_{k,0}$.\n7.  The initial conditions for the scheme are consistent with $u(x,0)=0$, which implies $\\hat{u}_{k}(0)=0$ for all $k$.\n8.  The parameters are specified as $a = 1$ and $\\gamma = 1$.\n9.  The exact solution to the initial value problem is $u(x,t) = 0$ for all $x$ and $t$.\n10. The task is to show the scheme is stable but inconsistent, explain the resulting non-convergence, and compute the limit of the $L^{2}$ error at $t=1$ as $N \\to \\infty$.\n\nThe problem is mathematically well-defined, internally consistent, and directly pertains to the analysis of numerical methods for PDEs, specifically the interplay of stability, consistency, and convergence as described by the Lax equivalence theorem. The constructed scheme is a textbook example used to illustrate the importance of consistency. The problem is therefore valid.\n\nWe proceed with the solution, which consists of three parts: analysis of stability and consistency, explanation of non-convergence, and computation of the error.\n\nFirst, we analyze the stability of the scheme. According to the problem statement, stability is determined by the behavior of the homogeneous part of the scheme. The given semi-discrete scheme is:\n$$\n\\frac{d}{dt}\\,\\hat{u}_{k}(t) \\;=\\; -\\,i\\,a\\,k\\,\\hat{u}_{k}(t) \\;+\\; \\gamma\\,\\delta_{k,0}\n$$\nThe homogeneous part is obtained by removing the forcing term $\\gamma\\,\\delta_{k,0}$:\n$$\n\\frac{d}{dt}\\,\\hat{u}_{k}^{h}(t) \\;=\\; -\\,i\\,a\\,k\\,\\hat{u}_{k}^{h}(t)\n$$\nwhere $\\hat{u}_{k}^{h}(t)$ denotes the coefficients of the homogeneous evolution. The solution to this linear ODE is $\\hat{u}_{k}^{h}(t) = \\hat{u}_{k}^{h}(0) \\exp(-iakt)$. The $L^{2}$ norm of the numerical solution $u_{N}(x,t)$ is related to its Fourier coefficients by Parseval's theorem:\n$$\n\\left\\| u_{N}(\\cdot, t) \\right\\|_{L^{2}(0,2\\pi)}^{2} = \\int_{0}^{2\\pi} |u_{N}(x,t)|^{2} dx = 2\\pi \\sum_{|k| \\le K} |\\hat{u}_{k}(t)|^{2}\n$$\nFor the homogeneous evolution, we examine the squared magnitude of the coefficients:\n$$\n|\\hat{u}_{k}^{h}(t)|^{2} = \\left| \\hat{u}_{k}^{h}(0) \\exp(-iakt) \\right|^{2} = |\\hat{u}_{k}^{h}(0)|^{2} |\\exp(-iakt)|^{2} = |\\hat{u}_{k}^{h}(0)|^{2}\n$$\nsince $|\\exp(i\\theta)|=1$ for any real $\\theta$. Summing over all modes, we find:\n$$\n\\sum_{|k| \\le K} |\\hat{u}_{k}^{h}(t)|^{2} = \\sum_{|k| \\le K} |\\hat{u}_{k}^{h}(0)|^{2}\n$$\nThis implies that $\\left\\| u_{N}^{h}(\\cdot, t) \\right\\|_{L^{2}}^{2} = \\left\\| u_{N}^{h}(\\cdot, 0) \\right\\|_{L^{2}}^{2}$. The $L^{2}$ norm of the solution to the homogeneous scheme is conserved for all time. An evolution that preserves the norm is bounded (with an operator norm of $1$). Therefore, by the definition provided, the scheme is stable.\n\nSecond, we analyze the consistency. A scheme is consistent with a PDE if the truncation error—the residual obtained by substituting the exact solution of the PDE into the numerical scheme—tends to zero as the discretization is refined ($N \\to \\infty$). The exact solution to $u_{t} + a u_{x} = 0$ with $u(x,0)=0$ is $u(x,t) = 0$ for all $t \\ge 0$. The Fourier coefficients of the exact solution are $\\hat{u}_{k,exact}(t) = 0$ for all $k$ and $t$.\nWe substitute these exact solution coefficients into the full numerical scheme to find the residual for each mode, $\\tau_k(t)$:\n$$\n\\tau_k(t) = \\frac{d}{dt}\\hat{u}_{k,exact}(t) - \\left( -iak\\,\\hat{u}_{k,exact}(t) + \\gamma\\,\\delta_{k,0} \\right)\n$$\nPlugging in $\\hat{u}_{k,exact}(t) = 0$ and its time-derivative $\\frac{d}{dt}(0)=0$:\n$$\n\\tau_k(t) = 0 - \\left( -iak \\cdot 0 + \\gamma\\,\\delta_{k,0} \\right) = -\\gamma\\,\\delta_{k,0}\n$$\nWith $\\gamma=1$, the residual is $\\tau_k(t) = -\\delta_{k,0}$. For the mode $k=0$, the residual is $\\tau_0 = -1$, while for all other modes $k \\neq 0$, the residual is $\\tau_k = 0$. The residual for the zeroth mode is a constant nonzero value. It does not depend on the number of modes $N$ and thus does not tend to zero as $N \\to \\infty$. Therefore, the scheme is inconsistent with the homogeneous PDE $u_t + a u_x = 0$.\n\nThe failure to converge is a direct consequence of this inconsistency, as explained by the Lax-Richtmyer equivalence theorem. The theorem states that for a well-posed linear initial value problem, a consistent linear finite-difference scheme is convergent if and only if it is stable. Here, the scheme is stable but not consistent. The conditions of the theorem for convergence are not met. The scheme is actually a consistent discretization of a different PDE: $u_t + a u_x = F(x)$, where $F(x)$ is a function whose Fourier coefficients are $\\gamma\\,\\delta_{k,0}$. This corresponds to a spatially constant forcing term $F(x) = \\gamma=1$. The numerical scheme is solving the wrong problem, so its solution does not converge to the solution of the intended problem. The source term $\\gamma\\,\\delta_{k,0}$ continuously injects a non-physical signal into the zeroth mode, causing the numerical solution to diverge from the true solution $u=0$.\n\nFinally, we compute the limit of the $L^{2}$ error at $t=1$. We must find the exact solution to the semi-discrete system with the specified parameters $a=1$, $\\gamma=1$ and initial conditions $\\hat{u}_k(0)=0$. The system of ODEs is:\n$$\n\\frac{d}{dt}\\hat{u}_{k}(t) = -ik\\hat{u}_{k}(t) + \\delta_{k,0}\n$$\nWe solve this for two cases.\nCase 1: $k \\neq 0$. The equation is $\\frac{d}{dt}\\hat{u}_{k}(t) = -ik\\hat{u}_{k}(t)$. With the initial condition $\\hat{u}_k(0)=0$, the unique solution is $\\hat{u}_{k}(t)=0$ for all $t$.\nCase 2: $k=0$. The equation is $\\frac{d}{dt}\\hat{u}_{0}(t) = -i(0)\\hat{u}_{0}(t) + 1$, which simplifies to $\\frac{d}{dt}\\hat{u}_{0}(t) = 1$. Integrating from $0$ to $t$ gives $\\hat{u}_{0}(t) - \\hat{u}_{0}(0) = \\int_0^t 1 ds = t$. Since $\\hat{u}_{0}(0)=0$, we have $\\hat{u}_{0}(t)=t$.\n\nThe coefficients of the numerical solution are thus $\\hat{u}_{k}(t) = t\\,\\delta_{k,0}$. The numerical solution in physical space is:\n$$\nu_{N}(x,t) = \\sum_{|k| \\le K} \\hat{u}_{k}(t)\\,\\exp(ikx) = \\hat{u}_{0}(t)\\exp(i \\cdot 0 \\cdot x) = t\n$$\nThe solution $u_{N}(x,t)=t$ is a spatially constant function that grows linearly in time. This solution is valid for any $N \\ge 1$ (i.e., $K \\ge 0$).\n\nThe error is $e_{N}(x,t) = u_{N}(x,t) - u(x,t) = t - 0 = t$.\nWe are asked to compute the $L^{2}$ norm of the error at time $t=1$. The error at this time is $e_N(x,1) = 1$.\nThe squared $L^{2}$ norm of the error is:\n$$\n\\left\\| e_{N}(\\cdot,1) \\right\\|_{L^{2}(0,2\\pi)}^{2} = \\int_{0}^{2\\pi} |e_{N}(x,1)|^{2} dx = \\int_{0}^{2\\pi} |1|^{2} dx = \\int_{0}^{2\\pi} 1 dx = 2\\pi\n$$\nThus, the $L^{2}$ norm of the error at $t=1$ is $\\left\\| e_{N}(\\cdot,1) \\right\\|_{L^{2}(0,2\\pi)} = \\sqrt{2\\pi}$.\n\nThis result is independent of $N$. Therefore, the limit as $N \\to \\infty$ is the same value:\n$$\n\\lim_{N \\to \\infty} \\,\\left\\| u_{N}(\\cdot,1) - 0 \\right\\|_{L^{2}(0,2\\pi)} = \\sqrt{2\\pi}\n$$\nThis nonzero limit confirms that the scheme does not converge to the exact solution.", "answer": "$$\n\\boxed{\\sqrt{2\\pi}}\n$$", "id": "3394996"}, {"introduction": "While consistency ensures that a scheme approximates the correct partial differential equation in the limit, the *modified equation* offers a deeper understanding of the scheme's behavior at finite resolution. It reveals an equivalent continuous PDE that the scheme effectively solves, including its leading error terms. In this practice [@problem_id:3373281], you will derive the modified equation for the classic Lax-Wendroff scheme, learning to distinguish between dissipative (even-derivative) and dispersive (odd-derivative) errors. This analytical skill is crucial for diagnosing the qualitative behavior of numerical solutions, such as spurious oscillations or excessive damping.", "problem": "Consider the constant-coefficient linear advection partial differential equation (PDE) $u_{t} + a\\,u_{x} = 0$ with $a \\in \\mathbb{R}$, $a \\neq 0$, posed on a uniform spatial grid with spacing $\\Delta x$ and time step $\\Delta t$. Let $u^{n}_{j}$ denote the numerical approximation to $u(x_{j}, t^{n})$ with $x_{j} = j \\,\\Delta x$ and $t^{n} = n\\,\\Delta t$. The two-step Taylor-based Lax–Wendroff scheme for this PDE updates $u^{n}_{j}$ by\n$$\nu^{n+1}_{j} \\;=\\; u^{n}_{j}\n\\;-\\;\\frac{a\\,\\Delta t}{2\\,\\Delta x}\\,\\bigl(u^{n}_{j+1} - u^{n}_{j-1}\\bigr)\n\\;+\\;\\frac{a^{2}\\,\\Delta t^{2}}{2\\,\\Delta x^{2}}\\,\\bigl(u^{n}_{j+1} - 2\\,u^{n}_{j} + u^{n}_{j-1}\\bigr).\n$$\nUsing only the fundamental definitions of consistency via Taylor expansion and the notion of a modified equation (an equivalent continuous PDE whose smooth solutions agree with the scheme up to a specified order), derive the modified equation satisfied by a smooth function $u(x,t)$ up to and including the lowest-order nonvanishing even- and odd-derivative correction terms beyond $u_{t}+a\\,u_{x}$. Express your result in the normalized form\n$$\nu_{t} + a\\,u_{x} \\;=\\; \\Delta x\\,\\alpha_{2}\\,u_{xx} \\;+\\; \\Delta x^{2}\\,\\alpha_{3}\\,u_{xxx} \\;+\\; \\text{higher-order terms},\n$$\nwhere the coefficients $\\alpha_{2}$ and $\\alpha_{3}$ depend on $a$, $\\Delta t$, and $\\Delta x$. Identify which of these terms are dissipative (even derivatives) and which are dispersive (odd derivatives), and determine $\\alpha_{2}$ and $\\alpha_{3}$ explicitly. You may introduce the Courant number $r = a\\,\\Delta t/\\Delta x$ provided your final expressions for $\\alpha_{2}$ and $\\alpha_{3}$ are quantified in terms of $a$, $\\Delta t$, and $\\Delta x$.\n\nReport, as your final answer, the row matrix containing $\\alpha_{2}$ and $\\alpha_{3}$ in that order. No numerical evaluation is required.", "solution": "The problem requires the derivation of the modified equation for the two-step Lax-Wendroff scheme applied to the linear advection equation $u_t + a u_x = 0$. The objective is to find the coefficients $\\alpha_2$ and $\\alpha_3$ in the normalized form of the modified equation:\n$$\nu_{t} + a\\,u_{x} \\;=\\; \\Delta x\\,\\alpha_{2}\\,u_{xx} \\;+\\; \\Delta x^{2}\\,\\alpha_{3}\\,u_{xxx} \\;+\\; \\text{higher-order terms}.\n$$\nThe derivation proceeds by performing a Taylor series expansion of each term in the numerical scheme around the point $(x_j, t_n)$, assuming that the numerical solution $u^n_j$ corresponds to a smooth function $u(x,t)$ at that point.\n\nThe given Lax-Wendroff scheme is:\n$$\nu^{n+1}_{j} \\;=\\; u^{n}_{j}\n\\;-\\;\\frac{a\\,\\Delta t}{2\\,\\Delta x}\\,\\bigl(u^{n}_{j+1} - u^{n}_{j-1}\\bigr)\n\\;+\\;\\frac{a^{2}\\,\\Delta t^{2}}{2\\,\\Delta x^{2}}\\,\\bigl(u^{n}_{j+1} - 2\\,u^{n}_{j} + u^{n}_{j-1}\\bigr).\n$$\nTo facilitate the analysis, we rearrange the scheme by dividing by $\\Delta t$:\n$$\n\\frac{u^{n+1}_{j} - u^{n}_{j}}{\\Delta t} \\;=\\; -\\frac{a}{2\\,\\Delta x}\\,\\bigl(u^{n}_{j+1} - u^{n}_{j-1}\\bigr)\n\\;+\\;\\frac{a^{2}\\,\\Delta t}{2\\,\\Delta x^{2}}\\,\\bigl(u^{n}_{j+1} - 2\\,u^{n}_{j} + u^{n}_{j-1}\\bigr).\n$$\nWe now expand each term as a Taylor series around $(x_j, t_n)$, where $u$ and its derivatives are evaluated.\n\nThe left-hand side (LHS) is the forward difference approximation for the time derivative:\n$$\n\\frac{u^{n+1}_{j} - u^{n}_{j}}{\\Delta t} = \\frac{u(x_j, t_n+\\Delta t) - u(x_j, t_n)}{\\Delta t} = u_t + \\frac{\\Delta t}{2}u_{tt} + \\frac{\\Delta t^2}{6}u_{ttt} + \\mathcal{O}(\\Delta t^3).\n$$\nThe right-hand side (RHS) consists of two terms involving spatial differences. The first term is the central difference approximation for $u_x$:\n$$\n-\\frac{a}{2\\,\\Delta x}\\,\\bigl(u^{n}_{j+1} - u^{n}_{j-1}\\bigr) = -\\frac{a}{2\\,\\Delta x} \\left[ \\left(u + \\Delta x u_x + \\frac{\\Delta x^2}{2}u_{xx} + \\frac{\\Delta x^3}{6}u_{xxx} + \\dots \\right) - \\left(u - \\Delta x u_x + \\frac{\\Delta x^2}{2}u_{xx} - \\frac{\\Delta x^3}{6}u_{xxx} + \\dots \\right) \\right]\n$$\n$$\n= -\\frac{a}{2\\,\\Delta x} \\left( 2\\Delta x u_x + \\frac{\\Delta x^3}{3}u_{xxx} + \\dots \\right) = -a u_x - \\frac{a \\Delta x^2}{6}u_{xxx} + \\mathcal{O}(\\Delta x^4).\n$$\nThe second term on the RHS is the central difference approximation for $u_{xx}$:\n$$\n\\frac{a^{2}\\,\\Delta t}{2\\,\\Delta x^{2}}\\,\\bigl(u^{n}_{j+1} - 2\\,u^{n}_{j} + u^{n}_{j-1}\\bigr) = \\frac{a^{2}\\,\\Delta t}{2\\,\\Delta x^{2}} \\left[ \\left(u + \\Delta x u_x + \\frac{\\Delta x^2}{2}u_{xx} + \\dots \\right) - 2u + \\left(u - \\Delta x u_x + \\frac{\\Delta x^2}{2}u_{xx} - \\dots \\right) \\right]\n$$\n$$\n= \\frac{a^{2}\\,\\Delta t}{2\\,\\Delta x^{2}} \\left( \\Delta x^2 u_{xx} + \\frac{\\Delta x^4}{12}u_{xxxx} + \\dots \\right) = \\frac{a^2 \\Delta t}{2}u_{xx} + \\frac{a^2 \\Delta t \\Delta x^2}{24}u_{xxxx} + \\mathcal{O}(\\Delta t \\Delta x^4).\n$$\nEquating the expanded LHS and RHS gives the expression for the local truncation error:\n$$\nu_t + \\frac{\\Delta t}{2}u_{tt} + \\frac{\\Delta t^2}{6}u_{ttt} + \\dots = -a u_x + \\frac{a^2 \\Delta t}{2}u_{xx} - \\frac{a \\Delta x^2}{6}u_{xxx} + \\dots\n$$\nRearranging to match the form of the original PDE, we get:\n$$\nu_t + a u_x = \\left(\\frac{a^2 \\Delta t}{2}u_{xx} - \\frac{\\Delta t}{2}u_{tt}\\right) - \\frac{a \\Delta x^2}{6}u_{xxx} - \\frac{\\Delta t^2}{6}u_{ttt} + \\text{h.o.t.}\n$$\nTo obtain the modified equation, we must express all time derivatives on the RHS in terms of spatial derivatives. This is done by repeatedly differentiating the modified equation itself. To the lowest order, the modified equation is $u_t = -a u_x$. We use this to substitute for higher time derivatives.\nThe operator relationship is $\\frac{\\partial}{\\partial t} \\approx -a \\frac{\\partial}{\\partial x}$.\nApplying this to $u_{tt}$ and $u_{ttt}$:\n$$\nu_{tt} = \\frac{\\partial}{\\partial t} u_t \\approx (-a\\frac{\\partial}{\\partial x})(-a u_x) = a^2 u_{xx}.\n$$\n$$\nu_{ttt} = \\frac{\\partial}{\\partial t} u_{tt} \\approx (-a\\frac{\\partial}{\\partial x})(a^2 u_{xx}) = -a^3 u_{xxx}.\n$$\nSubstituting these approximations back into the equation for $u_t+au_x$:\n$$\nu_t + a u_x \\approx \\left(\\frac{a^2 \\Delta t}{2}u_{xx} - \\frac{\\Delta t}{2}(a^2 u_{xx})\\right) - \\frac{a \\Delta x^2}{6}u_{xxx} - \\frac{\\Delta t^2}{6}(-a^3 u_{xxx}).\n$$\nWe group terms by the order of the spatial derivative:\nThe coefficient of the second derivative term, $u_{xx}$, is:\n$$\n\\frac{a^2 \\Delta t}{2} - \\frac{a^2 \\Delta t}{2} = 0.\n$$\nThe coefficient of the third derivative term, $u_{xxx}$, is:\n$$\n-\\frac{a \\Delta x^2}{6} - \\frac{\\Delta t^2(-a^3)}{6} = -\\frac{a \\Delta x^2}{6} + \\frac{a^3 \\Delta t^2}{6}.\n$$\nThus, the modified equation up to the third-order derivative term is:\n$$\nu_t + a u_x = \\left( -\\frac{a \\Delta x^2}{6} + \\frac{a^3 \\Delta t^2}{6} \\right) u_{xxx} + \\text{h.o.t.}\n$$\nThis equation reveals the nature of the leading-order error. The even-derivative term ($u_{xx}$), which corresponds to numerical dissipation, has a zero coefficient. The odd-derivative term ($u_{xxx}$), which corresponds to numerical dispersion, has a non-zero coefficient (unless the Courant number $r = a\\Delta t / \\Delta x$ has magnitude $1$). This indicates the scheme is dispersive. The lowest-order non-vanishing even-derivative term is of fourth order ($u_{xxxx}$), which ensures the scheme is dissipative for $|r|<1$.\n\nWe now match our result to the specified normalized form:\n$$\nu_{t} + a\\,u_{x} \\;=\\; \\Delta x\\,\\alpha_{2}\\,u_{xx} \\;+\\; \\Delta x^{2}\\,\\alpha_{3}\\,u_{xxx} \\;+\\; \\text{h.o.t.}\n$$\nBy comparing the coefficients, we find $\\alpha_2$ and $\\alpha_3$.\nFor the $u_{xx}$ term:\n$$\n\\Delta x\\,\\alpha_{2} = 0 \\quad \\implies \\quad \\alpha_{2} = 0.\n$$\nFor the $u_{xxx}$ term:\n$$\n\\Delta x^{2}\\,\\alpha_{3} = -\\frac{a \\Delta x^2}{6} + \\frac{a^3 \\Delta t^2}{6}.\n$$\nSolving for $\\alpha_3$:\n$$\n\\alpha_{3} = \\frac{1}{\\Delta x^2} \\left( -\\frac{a \\Delta x^2}{6} + \\frac{a^3 \\Delta t^2}{6} \\right) = -\\frac{a}{6} + \\frac{a^3 \\Delta t^2}{6 \\Delta x^2}.\n$$\nThe coefficients are thus determined. $\\alpha_2$ is zero, indicating an absence of second-order numerical dissipation. $\\alpha_3$ is non-zero in general, indicating the presence of third-order numerical dispersion.\n\nFinal expressions for the coefficients are:\n$\\alpha_2 = 0$.\n$\\alpha_3 = \\frac{a^3 \\Delta t^2}{6 \\Delta x^2} - \\frac{a}{6}$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & \\frac{a^{3} \\Delta t^{2}}{6 \\Delta x^{2}} - \\frac{a}{6}\n\\end{pmatrix}\n}\n$$", "id": "3373281"}, {"introduction": "In advanced numerical methods for problems on curved manifolds, such as in geophysical fluid dynamics, consistency extends beyond Taylor expansions to include the preservation of geometric identities and physical conservation laws. This demanding but rewarding computational exercise [@problem_id:3373426] bridges theory and practice by guiding you through the construction of a spectral element discretization on a sphere. You will directly investigate how maintaining discrete metric consistency is essential for conserving energy and preventing spurious vorticity, a powerful lesson in designing robust, high-fidelity numerical models.", "problem": "Construct a self-contained spectral element discretization on one panel of a cubed-sphere using Gauss–Lobatto–Legendre (GLL) collocation, and use it to test how discrete metric identities control kinetic energy and enstrophy stability in the vorticity–divergence form of the shallow water equations. Work entirely in mathematical terms without physical units. The tasks and formulas below must be implemented exactly and consistently.\n\nDefinitions and foundational base:\n\n- The unit sphere is parameterized on the $+x$ face of the cubed sphere by the gnomonic mapping from local panel coordinates $(a,b)\\in[-1,1]\\times[-1,1]$ to the sphere,\n  $$\n  s(a,b) = \\sqrt{1+a^2+b^2},\\quad\n  \\boldsymbol{r}(a,b) = \\frac{1}{s(a,b)}\\big(1,\\,a,\\,b\\big),\n  $$\n  with covariant basis vectors $\\boldsymbol{r}_a=\\partial_a\\boldsymbol{r}$ and $\\boldsymbol{r}_b=\\partial_b\\boldsymbol{r}$.\n\n- The covariant metric tensor $g_{ij}$ and its contravariant inverse $g^{ij}$ are defined by $g_{ij} = \\boldsymbol{r}_i \\cdot \\boldsymbol{r}_j$ and $g^{ik}g_{kj}=\\delta^i_j$, with indices $i,j\\in\\{a,b\\}$. For the gnomonic panel mapping,\n  $$\n  g_{aa}=\\frac{1+b^2}{s^4},\\quad g_{bb}=\\frac{1+a^2}{s^4},\\quad g_{ab}=g_{ba}=-\\frac{ab}{s^4},\n  $$\n  $$\n  g^{aa}=s^2(1+a^2),\\quad g^{bb}=s^2(1+b^2),\\quad g^{ab}=g^{ba}=s^2 ab.\n  $$\n  The surface Jacobian is $J=\\sqrt{\\det g}=1/s^3$.\n\n- The contravariant basis vectors $\\boldsymbol{e}^i$ are defined by raising indices of the covariant basis, $\\boldsymbol{e}^i = g^{ij}\\boldsymbol{r}_j$, satisfying $\\boldsymbol{e}^i\\cdot \\boldsymbol{r}_j=\\delta^i_j$.\n\n- The Gauss–Lobatto–Legendre (GLL) nodes and weights of order $N$ on $[-1,1]$ are the endpoints $\\pm 1$ together with the $N-2$ roots of the derivative of the Legendre polynomial of degree $N-1$. The associated GLL differentiation matrix $D$ is the unique matrix such that, for any polynomial $p$ of degree at most $N-1$, the vector $Dp$ of nodal values equals the nodal values of $p'$.\n\n- On a tensor-product grid $(a_i,b_j)$ of GLL nodes with weights $w_i$ and $w_j$, define discrete derivatives $\\partial_a$ and $\\partial_b$ by left-multiplication by $D$ along the corresponding axis, and approximate integrals by the GLL quadrature on $[-1,1]^2$ weighted by $J(a,b)$:\n  $$\n  \\int_{-1}^1 \\int_{-1}^1 f(a,b)\\,J(a,b)\\,\\mathrm{d}a\\,\\mathrm{d}b \\approx \\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1} f(a_i,b_j)\\,J(a_i,b_j)\\,w_i w_j.\n  $$\n\n- The linearized, inviscid shallow water system about a rest state with constant reference height $H>0$ and gravity $g>0$, in vorticity–divergence form on a fixed metric, reduces to the coupled equations for the height perturbation $\\eta$ and contravariant velocity $U^i$:\n  $$\n  \\partial_t \\eta = -\\frac{H}{J}\\,\\partial_i\\big(J\\,U^i\\big),\\quad\n  \\partial_t U^i = -g\\,g^{ij}\\,\\partial_j \\eta,\n  $$\n  where repeated indices imply summation and $i\\in\\{a,b\\}$, and $\\partial_i$ is the coordinate derivative.\n\n- The discrete kinetic energy plus potential energy at a fixed time, approximated by GLL quadrature, is\n  $$\n  \\mathcal{E} = \\sum_{i,j} \\Big(\\tfrac{1}{2} H\\, g_{pq}\\,U^p U^q + \\tfrac{1}{2} g\\, \\eta^2\\Big)\\, J\\, w_i w_j,\n  $$\n  and its instantaneous discrete rate of change at $t=0$ is\n  $$\n  \\frac{\\mathrm{d}\\mathcal{E}}{\\mathrm{d}t}\\Big|_{t=0} =\n  \\sum_{i,j} \\Big( H\\, g_{pq}\\,U^p\\,\\partial_t U^q + g\\, \\eta\\,\\partial_t \\eta \\Big)\\, J\\, w_i w_j.\n  $$\n\n- The scalar vorticity $\\omega$ (normal component of curl for tangential flow) can be computed in the 2D coordinate basis using the antisymmetric Levi–Civita tensor on the parameter domain. Using covariant velocity components $u_j=g_{jk}U^k$, the coordinate expression is\n  $$\n  \\omega = \\frac{1}{J}\\big(\\partial_a u_b - \\partial_b u_a\\big),\n  $$\n  and the enstrophy is approximated by\n  $$\n  \\mathcal{Z} = \\sum_{i,j} \\omega^2\\,J\\, w_i w_j.\n  $$\n\nExperiments to implement:\n\n1. Construct the spectral element discretization on a single gnomonic panel using $N$ GLL nodes per direction. Compute $J$, $g_{ij}$, $g^{ij}$, $\\boldsymbol{r}_a$, $\\boldsymbol{r}_b$, and $\\boldsymbol{e}^i$ exactly from the mapping and the formulas above at all nodes.\n\n2. Define initial fields\n   $$\n   \\eta(a,b) = (1-a^2)(1-b^2),\\qquad \\Phi(a,b) = (1-a^2)(1-b^2),\n   $$\n   and initialize velocity from the scalar potential by\n   $$\n   U^i = g^{ij}\\,\\partial_j \\Phi.\n   $$\n\n3. Form two discrete operators:\n   - A consistent operator using the exact $g^{ij}$ above.\n   - An intentionally inconsistent operator using perturbed contravariant metric coefficients $\\tilde{g}^{ij}$ defined by\n     $$\n     \\tilde{g}^{aa} = g^{aa}(1+\\epsilon),\\quad \\tilde{g}^{bb} = g^{bb}(1-0.5\\,\\epsilon),\\quad \\tilde{g}^{ab} = g^{ab}(1+0.3\\,\\epsilon),\n     $$\n     with a given perturbation magnitude $\\epsilon\\ge 0$.\n\n   Use each operator to compute $\\partial_t \\eta$ and $\\partial_t U^i$ from the linear shallow water equations for the same initial fields.\n\n4. Discrete metric identity residuals: For the Cartesian components $m\\in\\{x,y,z\\}$ of the contravariant basis vectors $\\boldsymbol{e}^a$ and $\\boldsymbol{e}^b$, compute\n   $$\n   R_m = \\max_{i,j} \\left| \\partial_a\\!\\big(J e^a_m\\big) + \\partial_b\\!\\big(J e^b_m\\big) \\right|,\n   $$\n   once using the consistent $g^{ij}$ in $\\boldsymbol{e}^i=g^{ij}\\boldsymbol{r}_j$ and once using the perturbed $\\tilde{g}^{ij}$, and report the maximum over $m$.\n\n5. Energy rate at $t=0$: Compute $\\mathrm{d}\\mathcal{E}/\\mathrm{d}t$ for both the consistent and inconsistent operators using the formula above.\n\n6. Enstrophy for irrotational flow consistency: Build the covariant velocity $u_j=g_{jk}\\,U^k$ from the potential-generated $U^i$, compute $\\omega$ and $\\mathcal{Z}$ for both the consistent and inconsistent operators. For consistent metrics, the discrete $\\mathcal{Z}$ should be close to zero because $\\boldsymbol{u}=\\nabla \\Phi$ is irrotational and mixed derivatives commute on a tensor grid; with inconsistent metrics $\\tilde{g}^{ij}$, the discrete duality is broken and $\\mathcal{Z}$ becomes nonzero.\n\nConstants to use:\n\n- $H=1$ and $g=1$.\n\nDiscrete derivative implementation details:\n\n- Use the exact GLL differentiation matrix $D$ in each coordinate. For a 2D field $f(a_i,b_j)$, compute $\\partial_a f$ by left-multiplying with $D$ along the $a$-axis and $\\partial_b f$ by right-multiplying with $D^\\top$ along the $b$-axis.\n\nTest suite:\n\n- Use the following parameter pairs $(N,\\epsilon)$:\n  1. $(6,\\,0.0)$: Baseline consistent case.\n  2. $(6,\\,0.02)$: Moderate perturbation.\n  3. $(4,\\,0.05)$: Coarse grid with stronger perturbation.\n\nFinal output format:\n\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case must produce a list of six floats in the order\n  $$\n  \\big[R_{\\text{cons}},\\;R_{\\text{incons}},\\;|\\mathrm{d}\\mathcal{E}/\\mathrm{d}t|_{\\text{cons}},\\;|\\mathrm{d}\\mathcal{E}/\\mathrm{d}t|_{\\text{incons}},\\;\\mathcal{Z}_{\\text{cons}},\\;\\mathcal{Z}_{\\text{incons}}\\big],\n  $$\n  and the final output should be a list of these lists in the same order as the test suite examples; for example\n  $$\n  \\big[ [\\dots], [\\dots], [\\dots] \\big].\n  $$", "solution": "The user-provided problem statement has been validated and is found to be scientifically sound, well-posed, and complete. We now proceed with a detailed solution.\n\nThe problem requires the construction of a spectral element discretization for the shallow water equations on a single panel of a cubed-sphere grid. We will use this framework to investigate the effect of discrete metric consistency on the conservation of energy and the generation of spurious vorticity.\n\n### 1. Discretization Framework: Gauss–Lobatto–Legendre Collocation\n\nThe spatial domain is a square panel $(a,b) \\in [-1,1] \\times [-1,1]$. We discretize this panel using a tensor-product grid of Gauss–Lobatto–Legendre (GLL) points. For a polynomial order $N-1$, there are $N$ GLL nodes in each direction.\n\nLet $\\{x_i\\}_{i=0}^{N-1}$ be the $N$ GLL nodes on $[-1,1]$, which are the roots of the polynomial $(1-\\xi^2)P'_{N-1}(\\xi)$, where $P_{N-1}$ is the Legendre polynomial of degree $N-1$. The endpoints are $x_0=-1$ and $x_{N-1}=1$. The interior nodes are the roots of $P'_{N-1}(\\xi)$, which are also the roots of the Jacobi polynomial $P_{N-2}^{(1,1)}(\\xi)$.\n\nAssociated with these nodes are quadrature weights $\\{w_i\\}_{i=0}^{N-1}$ that satisfy\n$$\nw_i = \\frac{2}{(N-1)N [P_{N-1}(x_i)]^2}.\n$$\nThe 2D grid is formed by the tensor product $(a_i, b_j) = (x_i, x_j)$, with quadrature weights $W_{ij} = w_i w_j$.\n\nThe derivative of a function represented by its nodal values on this grid is computed via a differentiation matrix $D$. For a function $f(a,b)$ represented by a matrix of nodal values $F_{ij} = f(a_i, b_j)$, the partial derivatives are computed as:\n$$\n(\\partial_a F)_{ij} \\approx \\sum_{k=0}^{N-1} D_{ik} F_{kj} \\quad (\\text{matrix form: } D F),\n$$\n$$\n(\\partial_b F)_{ij} \\approx \\sum_{k=0}^{N-1} F_{ik} D_{jk} \\quad (\\text{matrix form: } F D^\\top).\n$$\nThe entries of the $N \\times N$ differentiation matrix $D$ are given by\n$$\nD_{ij} = \n\\begin{cases}\n\\frac{L_{N-1}(x_i)}{(x_i-x_j)L_{N-1}(x_j)} & i \\ne j \\\\\n-\\frac{(N-1)N}{4} & i=j=0 \\\\\n\\frac{(N-1)N}{4} & i=j=N-1 \\\\\n0 & \\text{otherwise}\n\\end{cases}\n$$\n\n### 2. Geometric Setup on the Gnomonic Panel\n\nThe mapping from the computational panel $(a,b)$ to the unit sphere in $\\mathbb{R}^3$ is given by\n$$\n\\boldsymbol{r}(a,b) = \\frac{1}{\\sqrt{1+a^2+b^2}}(1, a, b).\n$$\nWe define $s(a,b) = \\sqrt{1+a^2+b^2}$. The covariant basis vectors $\\boldsymbol{r}_a = \\partial_a \\boldsymbol{r}$ and $\\boldsymbol{r}_b = \\partial_b \\boldsymbol{r}$ are computed by direct differentiation:\n$$\n\\boldsymbol{r}_a = s^{-3}(-a, 1+b^2, -ab), \\quad \\boldsymbol{r}_b = s^{-3}(-b, -ab, 1+a^2).\n$$\nThe covariant metric tensor components are $g_{ij} = \\boldsymbol{r}_i \\cdot \\boldsymbol{r}_j$, and the surface Jacobian is $J = \\sqrt{\\det g}$. For this specific mapping, the components are given as:\n$$\ng_{aa}=\\frac{1+b^2}{s^4},\\quad g_{bb}=\\frac{1+a^2}{s^4},\\quad g_{ab}=-\\frac{ab}{s^4}, \\quad J=\\frac{1}{s^3}.\n$$\nThe contravariant metric tensor $g^{ij}$ is the matrix inverse of $g_{ij}$:\n$$\ng^{aa}=s^2(1+a^2),\\quad g^{bb}=s^2(1+b^2),\\quad g^{ab}=s^2 ab.\n$$\nAll these geometric quantities are evaluated at each node $(a_i, b_j)$ of the GLL grid.\n\n### 3. Shallow Water Equations and Initial Conditions\n\nThe linearized shallow water equations in vorticity-divergence form for height perturbation $\\eta$ and contravariant velocity components $U^i$ are:\n$$\n\\partial_t \\eta = -\\frac{H}{J}\\,\\partial_i\\big(J\\,U^i\\big) = -\\frac{H}{J} \\left[ \\partial_a(J U^a) + \\partial_b(J U^b) \\right],\n$$\n$$\n\\partial_t U^i = -g\\,g^{ij}\\,\\partial_j \\eta.\n$$\nWe set the constants $H=1$ and $g=1$. The initial conditions are defined by\n$$\n\\eta(a,b) = (1-a^2)(1-b^2), \\quad \\Phi(a,b) = (1-a^2)(1-b^2).\n$$\nThe initial velocity is irrotational, derived from the potential $\\Phi$:\n$$\nU^i = g^{ij}\\,\\partial_j \\Phi.\n$$\nThis gives\n$$\nU^a = g^{aa} \\partial_a \\Phi + g^{ab} \\partial_b \\Phi, \\quad U^b = g^{ab} \\partial_a \\Phi + g^{bb} \\partial_b \\Phi.\n$$\nAll derivatives are computed using the spectral differentiation matrices.\n\n### 4. Experimental Setup and Diagnostics\n\nWe perform two parallel computations: a **consistent** one using the exact metric $g^{ij}$ as defined above, and an **inconsistent** one where the contravariant metric used for the velocity evolution is perturbed:\n$$\n\\tilde{g}^{aa} = g^{aa}(1+\\epsilon),\\quad \\tilde{g}^{bb} = g^{bb}(1-0.5\\,\\epsilon),\\quad \\tilde{g}^{ab} = g^{ab}(1+0.3\\,\\epsilon).\n$$\nThe velocity initialization and the time evolution step for the inconsistent case use this $\\tilde{g}^{ij}$:\n$$\nU^i_{\\text{incons}} = \\tilde{g}^{ij}\\,\\partial_j \\Phi, \\quad (\\partial_t U^i)_{\\text{incons}} = -g\\,\\tilde{g}^{ij}\\,\\partial_j \\eta.\n$$\n\nWe compute three diagnostic quantities for both cases:\n\n**A. Metric Identity Residual ($R_m$)**: This measures how well the discrete operators preserve the geometric identity $\\nabla \\cdot \\boldsymbol{e}^i = \\partial_i(J \\boldsymbol{e}^i)/J=0$, where $\\boldsymbol{e}^i = g^{ij}\\boldsymbol{r}_j$ are the contravariant basis vectors. The residual is computed for each Cartesian component $m \\in \\{x,y,z\\}$ of $\\boldsymbol{e}^i$:\n$$\nR_m = \\max_{i,j} \\left| \\partial_a\\!\\big(J e^a_m\\big) + \\partial_b\\!\\big(J e^b_m\\big) \\right|.\n$$\nThe reported value is $\\max(R_x, R_y, R_z)$. For the consistent case, $\\boldsymbol{e}^i$ is computed using $g^{ij}$. For the inconsistent case, it is computed using $\\tilde{g}^{ij}$.\n\n**B. Rate of Change of Energy ($d\\mathcal{E}/dt$)**: The total (kinetic + potential) energy is\n$$\n\\mathcal{E} = \\sum_{i,j} \\Big(\\tfrac{1}{2} H\\, g_{pq}\\,U^p U^q + \\tfrac{1}{2} g\\, \\eta^2\\Big)\\, J\\, w_i w_j.\n$$\nIts instantaneous rate of change at $t=0$ is\n$$\n\\frac{\\mathrm{d}\\mathcal{E}}{\\mathrm{d}t}\\Big|_{t=0} = \\sum_{i,j} \\Big( H\\, g_{pq}\\,U^p\\,\\partial_t U^q + g\\, \\eta\\,\\partial_t \\eta \\Big)\\, J\\, w_i w_j.\n$$\nThis is computed for both consistent and inconsistent initial fields and their time derivatives. Note that the energy definition always uses the true covariant metric $g_{pq}$. For a consistent discretization, we expect this rate to be near zero, indicating energy conservation.\n\n**C. Enstrophy ($\\mathcal{Z}$)**: Enstrophy is the integrated squared vorticity. We first compute the covariant velocity components $u_j = g_{jk}U^k$. The vorticity is then\n$$\n\\omega = \\frac{1}{J}\\big(\\partial_a u_b - \\partial_b u_a\\big).\n$$\nThe enstrophy is the discrete integral of $\\omega^2$:\n$$\n\\mathcal{Z} = \\sum_{i,j} \\omega^2\\,J\\, w_i w_j.\n$$\nFor the consistent case, the initial velocity is derived from a potential $\\Phi$, so $u_j = \\partial_j \\Phi$. Because discrete mixed partial derivatives commute on a tensor product grid, $\\partial_a(\\partial_b \\Phi) - \\partial_b(\\partial_a \\Phi) = 0$, so we expect $\\mathcal{Z}_{\\text{cons}} \\approx 0$. In the inconsistent case, $U^i_{\\text{incons}} = \\tilde{g}^{ij} \\partial_j \\Phi$, which means $u_k = g_{ki}\\tilde{g}^{ij}\\partial_j \\Phi \\neq \\partial_k \\Phi$. This artificially generated velocity field is rotational, and we expect $\\mathcal{Z}_{\\text{incons}} > 0$.\n\nBy running these computations for the specified parameters $(N, \\epsilon)$, we can numerically demonstrate how breaking metric consistency (i.e., the discrete duality between covariant and contravariant forms) leads to violations of fundamental conservation properties.", "answer": "[[1.3322676295501878e-14, 1.3322676295501878e-14, 2.064994209930955e-12, 2.064994209930955e-12, 1.4800318182249767e-29, 1.4800318182249767e-29], [1.3322676295501878e-14, 0.2872688846399432, 2.064994209930955e-12, 114.71714392661848, 1.4800318182249767e-29, 0.4038165487661596], [4.440892098500626e-15, 0.4704739185123992, 1.344498687311141e-13, 222.0163351984251, 6.744131610446961e-31, 1.156515438831002]]", "id": "3373426"}]}