{"hands_on_practices": [{"introduction": "The power of exponential integrators stems from their sophisticated treatment of the integral in the variation-of-constants formula. This exercise provides a foundational look into this mechanism by guiding you through the derivation of the method's quadrature weights. By constructing an exponential collocation scheme based on Legendre-Gauss-Lobatto nodes, you will see how these weights are explicitly expressed in terms of the core $\\varphi$-functions, providing direct insight into how these celebrated schemes are built from first principles [@problem_id:3386138].", "problem": "Consider the semilinear stiff ordinary differential equation (ODE) $u'(t) = A\\,u(t) + N(u(t))$ on a single time step $[t_n, t_{n+1}]$ with step size $h = t_{n+1} - t_n$, where $A \\in \\mathbb{R}^{d \\times d}$ is a constant stiff linear operator and $N: \\mathbb{R}^d \\to \\mathbb{R}^d$ is a polynomial nonlinearity. Starting from the variation-of-constants formula, construct an exponential collocation method that uses Discontinuous Galerkin (DG) nodal points chosen as the three Legendre–Gauss–Lobatto (LGL) points on $[0,1]$, namely $c_0 = 0$, $c_1 = \\tfrac{1}{2}$, and $c_2 = 1$, as temporal collocation nodes for $\\varphi$-function quadrature. Let $L_i(\\theta)$, $i=0,1,2$, denote the Lagrange basis polynomials associated with $\\{c_0,c_1,c_2\\}$ on the unit interval, and define the exponential quadrature weights\n$$\nb_i(hA) = \\int_0^1 \\exp\\!\\big((1-\\theta)\\,hA\\big)\\,L_i(\\theta)\\,d\\theta,\\quad i=0,1,2,\n$$\nin terms of the operator $\\varphi$-functions $\\varphi_k(hA)$, $k \\in \\mathbb{N}$, where $\\varphi_1(X) = ( \\exp(X) - I ) X^{-1}$ and, recursively, $\\varphi_{k+1}(X) = \\big( \\varphi_k(X) - \\tfrac{1}{k!} I \\big) X^{-1}$ for $k \\geq 1$. Derive explicit closed-form expressions for $b_0(hA)$, $b_1(hA)$, and $b_2(hA)$ in terms of $\\varphi_1(hA)$, $\\varphi_2(hA)$, and $\\varphi_3(hA)$, and from first principles determine the condition under which the resulting exponential collocation method is exact on the time step when $N(u)$ is polynomial and $A$ is stiff linear. Your final answer must be the single row vector containing the three weights $\\big(b_0(hA),\\,b_1(hA),\\,b_2(hA)\\big)$ as a closed-form analytical expression using only $\\varphi_1(hA)$, $\\varphi_2(hA)$, and $\\varphi_3(hA)$.", "solution": "The derivation proceeds in three main steps. First, the Lagrange basis polynomials $L_i(\\theta)$ for the given Legendre-Gauss-Lobatto nodes $\\{0, 1/2, 1\\}$ are explicitly constructed. Second, a general relationship between integrals of the form $\\int_0^1 \\exp((1-\\theta)Z) \\theta^k d\\theta$ and the $\\varphi$-functions is established for $k=0, 1, 2$ using integration by parts and the recursive definition of $\\varphi_k$. Finally, the explicit expressions for the Lagrange polynomials are substituted into the integral definitions of the weights $b_i(Z)$, and the resulting integrals are expressed as linear combinations of $\\varphi_1(Z)$, $\\varphi_2(Z)$, and $\\varphi_3(Z)$. The condition for exactness arises from recognizing that the exponential collocation method is exact if and only if the nonlinearity term $s \\mapsto N(u(t_n+sh))$ is a polynomial in $s$ of degree no greater than the degree of the interpolating polynomial (in this case, 2).", "answer": "$$\n\\boxed{\\begin{pmatrix} \\varphi_1(hA) - 3\\varphi_2(hA) + 4\\varphi_3(hA)  4\\varphi_2(hA) - 8\\varphi_3(hA)  -\\varphi_2(hA) + 4\\varphi_3(hA) \\end{pmatrix}}\n$$", "id": "3386138"}, {"introduction": "Moving from theory to practice, this exercise challenges you to implement a complete exponential integrator for a stiff partial differential equation. You will apply a second-order Lawson method to a Discontinuous Galerkin (DG) semi-discretization of the advection-diffusion equation, a canonical stiff problem [@problem_id:3386153]. This hands-on task demonstrates not only how to split the system into stiff and non-stiff components but also how to efficiently compute the action of the matrix exponential using the Fast Fourier Transform (FFT), a crucial technique for problems with periodic boundary conditions.", "problem": "Consider the one-dimensional linear advection–diffusion partial differential equation posed on the periodic interval $[0,1]$,\n$$\nu_t + a\\,u_x = \\nu\\,u_{xx},\n$$\nwith constant advection speed $a \\in \\mathbb{R}$ and constant diffusion coefficient $\\nu \\ge 0$. Discretize the spatial domain with a uniform mesh of $K$ elements of width $h = 1/K$, and let $u_j(t)$ denote the element-wise constant approximation (piecewise polynomial of degree $p=0$) of $u$ in cell $j$ for $j=0,1,\\dots,K-1$. Use periodic boundary conditions, that is, index arithmetic is performed modulo $K$.\n\nThe discontinuous Galerkin (DG) semi-discretization at degree $p=0$ for this equation can be formulated using interface numerical fluxes for advection and diffusion. Define the upwind numerical flux for advection at interface $j+\\tfrac{1}{2}$ by\n$$\nF^{\\mathrm{adv}}_{j+\\frac{1}{2}}(u) =\n\\begin{cases}\na\\,u_j,  \\text{if } a \\ge 0,\\\\\na\\,u_{j+1},  \\text{if } a  0,\n\\end{cases}\n$$\nand the central gradient-based numerical flux for diffusion by\n$$\nF^{\\mathrm{diff}}_{j+\\frac{1}{2}}(u) = -\\nu\\,\\frac{u_{j+1}-u_j}{h}.\n$$\nThe semi-discrete balance in cell $j$ (with periodic indexing) is then\n$$\n\\frac{d}{dt}u_j = -\\frac{1}{h}\\left(F^{\\mathrm{adv}}_{j+\\frac{1}{2}}(u) - F^{\\mathrm{adv}}_{j-\\frac{1}{2}}(u)\\right) - \\frac{1}{h}\\left(F^{\\mathrm{diff}}_{j+\\frac{1}{2}}(u) - F^{\\mathrm{diff}}_{j-\\frac{1}{2}}(u)\\right).\n$$\nThis yields a system of ordinary differential equations in vector form,\n$$\n\\frac{d}{dt}\\mathbf{u} = L\\,\\mathbf{u} + N(\\mathbf{u}),\n$$\nwhere:\n- $\\mathbf{u} \\in \\mathbb{R}^K$ collects the $K$ cell values $u_j$,\n- $L \\in \\mathbb{R}^{K \\times K}$ is the linear diffusion operator originating from the diffusion flux, specifically\n$$\n(L\\,\\mathbf{u})_j = \\nu\\,\\frac{u_{j+1} - 2u_j + u_{j-1}}{h^2},\n$$\nwith periodic wrap-around $u_{-1} \\equiv u_{K-1}$ and $u_K \\equiv u_0$,\n- $N(\\mathbf{u}) \\in \\mathbb{R}^K$ encodes the explicit advection contribution via the upwind numerical flux,\n$$\nN(\\mathbf{u})_j = -\\frac{1}{h}\\left(F^{\\mathrm{adv}}_{j+\\frac{1}{2}}(\\mathbf{u}) - F^{\\mathrm{adv}}_{j-\\frac{1}{2}}(\\mathbf{u})\\right).\n$$\n\nYour task is to implement a single time step of a second-order Lawson method for the semi-discrete system $\\,\\mathbf{u}' = L\\,\\mathbf{u} + N(\\mathbf{u})\\,$ by expressing the algorithm exclusively in terms of the action of the matrix exponential $e^{\\Delta t\\,L}$ on vectors and evaluations of the numerical advection flux $N(\\cdot)$. The second-order method to be used is the explicit midpoint Runge–Kutta scheme formulated in Lawson variables. You must not assume any simplifications beyond the definitions given above, and your implementation must work for any $K \\ge 3$, any real $a$, any $\\nu \\ge 0$, and any $\\Delta t > 0$.\n\nUse the following test suite, with the initial condition defined by sampling $u(x,0) = \\sin(2\\pi x)$ at cell centers $x_j = (j+\\tfrac{1}{2})h$:\n1. $K = 64$, $a = 1.0$, $\\nu = 0.05$, $\\Delta t = 10^{-3}$.\n2. $K = 64$, $a = 0.0$, $\\nu = 0.05$, $\\Delta t = 10^{-3}$.\n3. $K = 64$, $a = 3.0$, $\\nu = 0.0$, $\\Delta t = 10^{-1}$.\n\nFor each of the three test cases, after performing exactly one Lawson step starting from the given initial condition, compute and report the following scalar quantities:\n- For case 1: the discrete $L^2$ norm of the updated solution, defined by\n$$\n\\left\\|\\mathbf{u}\\right\\|_{2,h} = \\sqrt{h\\,\\sum_{j=0}^{K-1} u_j^2}.\n$$\n- For case 2: the discrete $L^2$ norm of the difference between your Lawson update and the purely diffusive update $e^{\\Delta t\\,L}\\,\\mathbf{u}$, that is,\n$$\n\\sqrt{h\\,\\sum_{j=0}^{K-1} \\left(u^{\\mathrm{Lawson}}_j - u^{\\mathrm{diffusion}}_j\\right)^2}.\n$$\n- For case 3: the maximum absolute value over all cells of the updated solution, $\\max_{0 \\le j \\le K-1} |u_j|$.\n\nFinal output format requirement: Your program should produce a single line of output containing the three results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\") in this exact order corresponding to the test cases above. No additional text should be printed. No physical units or angle units are involved; all quantities are dimensionless real numbers.", "solution": "The problem requires the implementation of a single time step for the semi-discrete advection-diffusion equation using a second-order exponential integrator. The system of ODEs is given by\n$$ \\frac{d\\mathbf{u}}{dt} = L\\mathbf{u} + N(\\mathbf{u}) $$\nwhere $L$ is a linear operator representing diffusion, and $N(\\mathbf{u})$ is a (in this case, linear) operator representing advection. The splitting isolates the stiff diffusion term, which contains derivatives scaled by $1/h^2$, into the linear part $L\\mathbf{u}$ that will be handled exactly by the matrix exponential.\n\n#### The Second-Order Lawson-Midpoint Method\n\nThe Lawson method transforms the variable to filter out the fast dynamics of the linear part. Let $\\mathbf{v}(t) = e^{-tL} \\mathbf{u}(t)$. Differentiating with respect to time $t$ yields the transformed ODE for $\\mathbf{v}$:\n$$ \\frac{d\\mathbf{v}}{dt} = e^{-tL} N(e^{tL} \\mathbf{v}(t)) $$\nWe solve this transformed equation for one step $\\Delta t$ using the explicit midpoint Runge-Kutta method. The algorithmic steps to get from $\\mathbf{u}_n$ to $\\mathbf{u}_{n+1}$ are:\n1.  Compute the intermediate state for the midpoint evaluation:\n    $$ \\mathbf{u}_{mid} = e^{\\frac{\\Delta t}{2} L} \\mathbf{u}_n + \\frac{\\Delta t}{2} e^{\\frac{\\Delta t}{2} L} N(\\mathbf{u}_n) $$\n2.  Evaluate the nonlinear term at the intermediate state:\n    $$ N_{mid} = N(\\mathbf{u}_{mid}) $$\n3.  Combine to form the final update:\n    $$ \\mathbf{u}_{n+1} = e^{\\frac{\\Delta t}{2} L} \\mathbf{u}_{mid} + \\frac{\\Delta t}{2} e^{\\frac{\\Delta t}{2} L} N_{mid} $$\nThis can be shown to be equivalent to the more compact formula:\n$$ \\mathbf{u}_{n+1} = e^{\\Delta t L} \\mathbf{u}_n + \\Delta t\\, e^{\\frac{\\Delta t}{2} L} N\\left(e^{\\frac{\\Delta t}{2} L} \\mathbf{u}_n + \\frac{\\Delta t}{2} e^{\\frac{\\Delta t}{2} L} N(\\mathbf{u}_n)\\right) $$\n\n#### Implementation Strategy\n\n**1. The Operators $L$ and $N$**\nThe linear operator $L$ represents the periodic centered difference approximation of $\\nu \\frac{\\partial^2}{\\partial x^2}$. The advection operator $N(\\mathbf{u})$ is a first-order upwind finite difference stencil. These can be implemented using vector shifts (e.g., `numpy.roll`).\n\n**2. Action of the Matrix Exponential**\nThe action of the matrix exponential $e^{\\tau L}$ on a vector $\\mathbf{v}$ can be computed efficiently in Fourier space. Since $L$ is a circulant matrix, it is diagonalized by the Discrete Fourier Transform (DFT). The eigenvalues $\\lambda_k$ of the operator $L$ corresponding to the $k$-th Fourier mode are:\n$$ \\lambda_k = -\\frac{4\\nu}{h^2} \\sin^2\\left(\\frac{\\pi k}{K}\\right), \\quad k = 0, 1, \\dots, K-1 $$\nThe action $e^{\\tau L}\\mathbf{v}$ is computed via the following steps:\n1.  Compute the DFT of the vector $\\mathbf{v}$: $\\hat{\\mathbf{v}} = \\text{DFT}(\\mathbf{v})$.\n2.  Multiply each component $\\hat{v}_k$ by the corresponding exponential factor $e^{\\tau \\lambda_k}$.\n3.  Compute the inverse DFT of the result: $\\mathbf{w} = \\text{IDFT}(e^{\\tau \\Lambda} \\hat{\\mathbf{v}})$.\nThis process is highly efficient using the Fast Fourier Transform (FFT) and avoids explicit matrix operations.", "answer": "```python\nimport numpy as np\nfrom numpy.fft import fft, ifft, fftfreq\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the second-order Lawson method.\n    \"\"\"\n    test_cases = [\n        {'K': 64, 'a': 1.0, 'nu': 0.05, 'dt': 1e-3, 'task': 1},\n        {'K': 64, 'a': 0.0, 'nu': 0.05, 'dt': 1e-3, 'task': 2},\n        {'K': 64, 'a': 3.0, 'nu': 0.0,  'dt': 1e-1, 'task': 3},\n    ]\n\n    results = []\n    for params in test_cases:\n        result = run_one_case(**params)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15g}' for r in results)}]\")\n\ndef run_one_case(K, a, nu, dt, task):\n    \"\"\"\n    Sets up and solves a single test case.\n    \"\"\"\n    # 1. Setup grid and initial condition\n    h = 1.0 / K\n    x = (np.arange(K) + 0.5) * h\n    u0 = np.sin(2 * np.pi * x)\n\n    # 2. Perform one step of the Lawson-Midpoint method\n    u1 = lawson_midpoint_step(u0, K, a, nu, dt, h)\n    \n    # 3. Compute the required metric for the task\n    if task == 1:\n        # Discrete L2 norm ||u||_{2,h}\n        return np.sqrt(h * np.sum(u1**2))\n    elif task == 2:\n        # L2 norm of the difference ||u_lawson - u_diffusion||_{2,h}\n        # For a=0, N=0, and the Lawson method should reduce to the exact solution\n        # of the linear part. The difference should be zero up to machine precision.\n        u_diffusion = exp_L_action(u0, dt, K, nu, h)\n        diff = u1 - u_diffusion\n        return np.sqrt(h * np.sum(diff**2))\n    elif task == 3:\n        # Max absolute value max|u|\n        return np.max(np.abs(u1))\n    else:\n        raise ValueError(\"Invalid task number.\")\n\ndef lawson_midpoint_step(u_n, K, a, nu, dt, h):\n    \"\"\"\n    Performs one step of the second-order Lawson method (based on explicit midpoint RK).\n    u_{n+1} = exp(dt*L)u_n + dt*exp(dt/2*L)*N(exp(dt/2*L)u_n + dt/2*exp(dt/2*L)N(u_n))\n    \"\"\"\n    \n    # Define the nonlinear advection operator N(u)\n    def N(u, a_val, h_val):\n        if a_val >= 0:\n            # Upwind flux difference for a > 0\n            flux_diff = u - np.roll(u, 1)\n        else:\n            # Upwind flux difference for a  0\n            flux_diff = np.roll(u, -1) - u\n        return -a_val / h_val * flux_diff\n        \n    # --- Algorithm Steps ---\n    \n    # 1. Compute initial nonlinear term\n    N_n = N(u_n, a, h)\n    \n    # 2. Evolve u_n and N_n by a half-step under the linear operator L\n    u_n_half_evolved = exp_L_action(u_n, dt / 2.0, K, nu, h)\n    N_n_half_evolved = exp_L_action(N_n, dt / 2.0, K, nu, h)\n    \n    # 3. Form the intermediate state for the midpoint evaluation\n    u_mid = u_n_half_evolved + (dt / 2.0) * N_n_half_evolved\n    \n    # 4. Evaluate nonlinear term at the intermediate state\n    N_mid = N(u_mid, a, h)\n    \n    # 5. Evolve u_n by a full step and N_mid by a half-step\n    # We can reuse u_n_half_evolved to get the full-step evolution\n    # exp(dt*L)u_n = exp(dt/2*L) * exp(dt/2*L)u_n\n    u_n_full_evolved = exp_L_action(u_n_half_evolved, dt / 2.0, K, nu, h)\n    N_mid_half_evolved = exp_L_action(N_mid, dt / 2.0, K, nu, h)\n    \n    # 6. Combine to form the final solution\n    u_np1 = u_n_full_evolved + dt * N_mid_half_evolved\n    \n    return u_np1\n\ndef exp_L_action(v, tau, K, nu, h):\n    \"\"\"\n    Computes the action of the matrix exponential exp(tau*L) on a vector v\n    using the Fourier spectral method.\n    \"\"\"\n    # If nu=0, L is the zero matrix, so exp(tau*L) is the identity\n    if nu == 0.0:\n        return v\n    \n    # Calculate eigenvalues of the operator L in Fourier space.\n    # fftfreq provides the correct frequency ordering for numpy's FFT.\n    # The term k/K in the sin argument corresponds to freq*h, where freq are the wavenumbers.\n    k_indices = fftfreq(K) * K\n    lambda_k = -4.0 * nu / h**2 * np.sin(np.pi * k_indices / K)**2\n    \n    # Apply the operator in Fourier space\n    v_hat = fft(v)\n    v_hat_evolved = np.exp(tau * lambda_k) * v_hat\n    v_evolved = ifft(v_hat_evolved)\n    \n    # The result should be real since the operator and input are real.\n    return np.real(v_evolved)\n\nsolve()\n```", "id": "3386153"}, {"introduction": "A successful implementation must also be a stable one, especially when dealing with high-frequency modes introduced by spectral or DG methods. This practice focuses on a crucial aspect of practical application: stability analysis. By deriving the one-step amplification factor for a combined Exponential Time Differencing Runge-Kutta (ETDRK) scheme and a modal filter, you will explore how this common stabilization technique works to control high-frequency instabilities and ensure the robustness of the overall method [@problem_id:3386194].", "problem": "Consider a semilinear stiff system arising from a spectral or Discontinuous Galerkin (DG) discretization of a one-dimensional parabolic partial differential equation, written in modal coordinates as the ordinary differential equation (ODE) system $y'(t) = L y(t) + g(y(t))$, where $L \\in \\mathbb{C}^{M \\times M}$ is a linear operator with spectrum located in the left half-plane and $g$ represents the nonlinear remainder. Let the modes be indexed by $m = 0, 1, \\dots, K$, where $K$ is the highest polynomial degree per element, and assume the linear operator $L$ is diagonalizable in the modal basis with eigenvalues $\\lambda_{m}$. Assume that the highest modal coefficient ($m = K$) is associated with the eigenvalue $\\lambda_{K}$ with $\\Re(\\lambda_{K})  0$. An Exponential Time Differencing Runge–Kutta (ETDRK) scheme integrates the linear part via exponentials and advances $y$ by one step of size $h  0$. After each ETDRK step, a diagonal modal filter $F$ is applied, whose transfer function is given by $\\sigma_{m} = \\exp\\!\\big(-\\alpha (m/K)^{p}\\big)$ with $\\alpha  0$ and $p \\geq 1$, so that $F$ multiplies the $m$-th modal coefficient by $\\sigma_{m}$.\n\nStarting from the variation-of-constants formula and the property that Exponential Time Differencing Runge–Kutta schemes integrate the homogeneous linear part exactly, derive the one-step amplification factor $G_{K}(h)$ for the highest modal coefficient $a_{n} = y_{n, K}$ under the combined operation “ETDRK step followed by modal filter application,” i.e., $a_{n+1} = G_{K}(h) a_{n}$. Based on this derivation, determine the condition on the time step $h$ under which the combined operation is contractive on the highest mode, in the sense that $\\lvert G_{K}(h) \\rvert  1$. Express the final amplification factor $G_{K}(h)$ in closed form as your final answer.", "solution": "The user-provided problem is assessed to be valid. It is a well-posed problem in the field of numerical analysis for stiff differential equations, resting on established scientific principles. The setup is self-contained and free of contradictions, although it requires the standard interpretation that finding a scalar amplification factor implies a linear stability analysis.\n\nThe problem asks for the one-step amplification factor for the highest modal coefficient of a semilinear ODE system solved using an Exponential Time Differencing Runge-Kutta (ETDRK) scheme followed by a modal filter.\n\nTo derive this amplification factor, we perform a linear stability analysis, which involves studying the behavior of the numerical scheme on the homogeneous linear part of the system:\n$$y'(t) = L y(t)$$\nThe problem states that the ETDRK scheme integrates the homogeneous linear part exactly. This means that one step of the ETDRK scheme from time $t_n$ to $t_{n+1}$ yields the exact solution:\n$$y_{n+1}^{\\text{pre-filter}} = e^{L h} y_n$$\nwhere $y_{n+1}^{\\text{pre-filter}}$ is the solution after the ETDRK step, before the filter is applied.\n\nThe linear operator $L$ is diagonalizable in the modal basis. The update equation for the highest modal coefficient, $a_n = y_{n,K}$, whose corresponding eigenvalue is $\\lambda_K$, is:\n$$a_{n+1}^{\\text{pre-filter}} = e^{\\lambda_K h} a_n$$\nFollowing the ETDRK step, a modal filter $F$ is applied. For the highest mode, $m=K$, the filter factor is:\n$$\\sigma_K = \\exp\\left(-\\alpha \\left(\\frac{K}{K}\\right)^p\\right) = \\exp(-\\alpha)$$\nThe final value of the highest modal coefficient at step $n+1$, denoted $a_{n+1}$, is obtained by applying this filter factor to the post-ETDRK value:\n$$a_{n+1} = \\sigma_K \\cdot a_{n+1}^{\\text{pre-filter}} = \\exp(-\\alpha) \\cdot (e^{\\lambda_K h} a_n) = (\\exp(-\\alpha) e^{\\lambda_K h}) a_n$$\nBy combining the exponents, we identify the one-step amplification factor $G_K(h)$ as:\n$$G_K(h) = \\exp(\\lambda_K h - \\alpha)$$\nNext, we determine the condition for the combined operation to be contractive, which means $|G_K(h)|  1$.\n$$|\\exp(\\lambda_K h - \\alpha)|  1$$\nLet $\\lambda_K = \\Re(\\lambda_K) + i \\Im(\\lambda_K)$. The magnitude of the amplification factor is:\n$$|G_K(h)| = |\\exp(\\Re(\\lambda_K)h - \\alpha)| = \\exp(\\Re(\\lambda_K)h - \\alpha)$$\nThe condition becomes:\n$$\\exp(\\Re(\\lambda_K)h - \\alpha)  1$$\nTaking the natural logarithm of both sides gives:\n$$\\Re(\\lambda_K)h - \\alpha  0$$\nGiven the problem constraints ($\\Re(\\lambda_K)  0$, $h > 0$, $\\alpha > 0$), the term $\\Re(\\lambda_K)h$ is negative and the term $-\\alpha$ is negative. Their sum is always negative. Therefore, the inequality is satisfied for all positive time steps $h > 0$. The combined operation is unconditionally contractive on the highest mode.", "answer": "$$\\boxed{\\exp(\\lambda_{K} h - \\alpha)}$$", "id": "3386194"}]}