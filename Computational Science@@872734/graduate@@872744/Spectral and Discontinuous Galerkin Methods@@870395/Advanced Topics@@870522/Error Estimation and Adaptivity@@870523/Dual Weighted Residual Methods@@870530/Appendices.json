{"hands_on_practices": [{"introduction": "At the core of the Dual Weighted Residual (DWR) method for goal-oriented adaptive mesh refinement (AMR) is a simple but powerful idea: not all errors are created equal. This first exercise strips away the complexity of solving partial differential equations to focus on the fundamental calculation that drives DWR-based adaptivity. By computing error indicators from given hypothetical residuals and dual solution weights, you will practice the essential step of identifying which regions of a computational mesh contribute most significantly to the error in your quantity of interest, and thus, where refinement is most needed [@problem_id:3514494].", "problem": "Consider a goal-oriented Adaptive Mesh Refinement (AMR) procedure for a Finite Element Method (FEM) discretization of a linearized multiphysics coupled system, where a scalar output functional $J(u)$ is of interest. Let $u$ be the exact solution and $u_h$ the discrete solution. In the Dual Weighted Residual (DWR) framework, the signed elementwise contributions to the error in $J(u)$ are determined by weighting the elementwise residuals by samples of the adjoint (dual) solution that resolves the sensitivity of $J(u)$ to perturbations in $u$. Assume a conforming discretization and piecewise smooth coefficients so that elementwise residuals are well-defined as linear functionals on test spaces, and the dual solution is sufficiently regular to be sampled elementwise.\n\nYou are given three elements $K=1,2,3$ that contribute to $J(u)$ with element residual values $\\{R_K\\} = \\{1.2, -0.5, 0.8\\}$ and corresponding sampled dual weights $\\{z_{h,K}\\} = \\{0.4, 1.1, 0.2\\}$. Under the standard DWR locality assumption, take the signed contribution of each element $K$ to be obtained by weighting its residual by its dual sample, and rank the elements by priority for refinement by sorting in descending order of the absolute magnitude of their signed contributions. In the event of an exact tie, break ties by choosing the smaller element index first.\n\nCompute the three signed contributions and provide the ranking of the three element indices in descending order of absolute contribution. Express your final answer as a single row matrix with six entries: first list the three signed contributions in the order $K=1,2,3$, followed by the three element indices in the requested ranking. No rounding is required; report exact decimal values. The quantities are dimensionless.", "solution": "The user has provided a problem concerning goal-oriented Adaptive Mesh Refinement (AMR) using the Dual Weighted Residual (DWR) method.\n\n### Step 1: Extract Givens\n- **Methodology**: Goal-oriented AMR for a Finite Element Method (FEM) discretization using the Dual Weighted Residual (DWR) framework.\n- **Quantity of Interest**: A scalar output functional $J(u)$.\n- **Elements**: Three elements indexed as $K=1, 2, 3$.\n- **Element Residuals**: The set of element residual values is $\\{R_K\\} = \\{1.2, -0.5, 0.8\\}$, where $R_1=1.2$, $R_2=-0.5$, and $R_3=0.8$.\n- **Sampled Dual Weights**: The set of corresponding sampled dual weights is $\\{z_{h,K}\\} = \\{0.4, 1.1, 0.2\\}$, where $z_{h,1}=0.4$, $z_{h,2}=1.1$, and $z_{h,3}=0.2$.\n- **Error Indicator Calculation**: The signed contribution of each element $K$ to the error is obtained by weighting its residual by its dual sample. Let this contribution be denoted by $\\eta_K$. Thus, $\\eta_K = R_K \\cdot z_{h,K}$. This is based on the DWR locality assumption.\n- **Ranking Criterion**: Elements are to be ranked in descending order of the absolute magnitude of their signed contributions, $|\\eta_K|$.\n- **Tie-Breaking Rule**: In case of a tie in $|\\eta_K|$, the element with the smaller index $K$ is prioritized.\n- **Required Output**: A single row matrix containing six entries: the three signed contributions $\\eta_1, \\eta_2, \\eta_3$ in order, followed by the three element indices $K$ ranked in descending order of refinement priority.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, as the DWR method is a standard and well-established technique for a posteriori error estimation and mesh adaptivity in computational engineering and science. The problem is well-posed, providing all necessary data ($R_K$, $z_{h,K}$) and a clear, unambiguous procedure for calculation and ranking. The language is objective and technical. The problem does not violate any of the invalidity criteria. It is a direct and valid application of a key concept in numerical analysis for partial differential equations.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Solution\nThe problem requires the calculation of signed error contributions for three finite elements and their subsequent ranking for mesh refinement based on the DWR method.\n\nThe signed contribution, or error indicator, $\\eta_K$ for each element $K$ is given by the product of the element's residual, $R_K$, and the corresponding sampled value from the dual (adjoint) solution, $z_{h,K}$. The formula is:\n$$\n\\eta_K = R_K \\cdot z_{h,K}\n$$\n\nWe are given the following values for elements $K=1, 2, 3$:\n- For element $K=1$: $R_1 = 1.2$ and $z_{h,1} = 0.4$.\n- For element $K=2$: $R_2 = -0.5$ and $z_{h,2} = 1.1$.\n- For element $K=3$: $R_3 = 0.8$ and $z_{h,3} = 0.2$.\n\nFirst, we compute the signed contribution $\\eta_K$ for each element.\n\nFor element $K=1$:\n$$\n\\eta_1 = R_1 \\cdot z_{h,1} = (1.2) \\cdot (0.4) = 0.48\n$$\n\nFor element $K=2$:\n$$\n\\eta_2 = R_2 \\cdot z_{h,2} = (-0.5) \\cdot (1.1) = -0.55\n$$\n\nFor element $K=3$:\n$$\n\\eta_3 = R_3 \\cdot z_{h,3} = (0.8) \\cdot (0.2) = 0.16\n$$\n\nThe three signed contributions in the order of element index ($K=1, 2, 3$) are $\\{0.48, -0.55, 0.16\\}$.\n\nNext, we rank the elements for refinement priority. The ranking is based on the absolute magnitude of these contributions, $|\\eta_K|$, sorted in descending order.\n\nWe calculate the absolute magnitude for each contribution:\n- For $K=1$: $|\\eta_1| = |0.48| = 0.48$.\n- For $K=2$: $|\\eta_2| = |-0.55| = 0.55$.\n- For $K=3$: $|\\eta_3| = |0.16| = 0.16$.\n\nNow, we sort these absolute magnitudes in descending order:\n$$\n0.55 > 0.48 > 0.16\n$$\nThe values correspond to the following elements:\n- The largest value, $0.55$, corresponds to element $K=2$.\n- The second largest value, $0.48$, corresponds to element $K=1$.\n- The smallest value, $0.16$, corresponds to element $K=3$.\n\nThere are no ties in the absolute magnitudes, so the tie-breaking rule is not invoked.\n\nThe ranking of element indices in descending order of refinement priority is therefore $2, 1, 3$.\n\nThe final answer requires a single row matrix with six entries: the three signed contributions ($\\eta_1, \\eta_2, \\eta_3$) followed by the three ranked element indices.\nThe entries are: $0.48, -0.55, 0.16, 2, 1, 3$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.48  -0.55  0.16  2  1  3\n\\end{pmatrix}\n}\n$$", "id": "3514494"}, {"introduction": "Building on the basic mechanics, this practice provides a complete, hands-on walkthrough of the DWR method on a classic one-dimensional Poisson problem. You will solve for a simple finite element approximation, determine the corresponding exact adjoint solution, and then compute the DWR error indicators. This exercise is designed to illuminate a cornerstone concept of the method: Galerkin orthogonality, and why it necessitates enriching the approximation space for the adjoint problem to obtain a meaningful, non-zero error estimate [@problem_id:3330525].", "problem": "Consider the one-dimensional Poisson problem on the domain $\\Omega=(0,1)$ with homogeneous Dirichlet boundary conditions, where the primal variable $u$ satisfies the strong form $-u''=f$ in $\\Omega$, $u(0)=u(1)=0$, with a constant source $f(x)=1$. The goal functional is $J(u)=\\int_{0}^{1} u\\,dx$. The corresponding weak form is: find $u\\in H_{0}^{1}(\\Omega)$ such that $\\int_{0}^{1} u' v'\\,dx = \\int_{0}^{1} f v\\,dx$ for all $v\\in H_{0}^{1}(\\Omega)$. The Dual Weighted Residual (DWR) method seeks $z\\in H_{0}^{1}(\\Omega)$ solving the adjoint problem induced by the Gateaux derivative of $J$, namely, find $z\\in H_{0}^{1}(\\Omega)$ such that $\\int_{0}^{1} v' z'\\,dx = \\int_{0}^{1} v\\,dx$ for all $v\\in H_{0}^{1}(\\Omega)$.\n\nOn a uniform mesh with two elements $K_{1}=(0,\\tfrac{1}{2})$ and $K_{2}=(\\tfrac{1}{2},1)$, consider the continuous finite element (FE) approximation $u_{h}\\in V_{h}\\subset H_{0}^{1}(\\Omega)$ with $V_{h}$ the space of continuous piecewise-linear functions vanishing at $x=0$ and $x=1$. The discrete adjoint $z_{h}\\in V_{h}$ is defined analogously by $\\int_{0}^{1} v_{h}' z_{h}'\\,dx = \\int_{0}^{1} v_{h}\\,dx$ for all $v_{h}\\in V_{h}$. For the Dual Weighted Residual, the weak residual of the primal approximation is $R(u_{h})(w):=\\int_{0}^{1} f w\\,dx - \\int_{0}^{1} u_{h}' w'\\,dx$ for any $w\\in H_{0}^{1}(\\Omega)$, and the elementwise indicators (using an adjoint weight) are associated with the decomposition $R(u_{h})(w)=\\sum_{K\\in\\{K_{1},K_{2}\\}} \\Big(\\int_{K} f w\\,dx - \\int_{K} u_{h}' w'\\,dx\\Big)$.\n\nTasks:\n- Compute the continuous FE solution $u_{h}$ on the given two-element mesh.\n- Compute the exact adjoint $z$ and use it as an enriched adjoint weight to define the elementwise indicators $\\eta_{K}:=\\int_{K} f z\\,dx - \\int_{K} u_{h}' z'\\,dx$ for $K\\in\\{K_{1},K_{2}\\}$.\n- Using the cheap estimator philosophy of enriching only the adjoint space, take the global estimator to be $\\mathcal{E}_{\\text{cheap}}:=\\eta_{K_{1}}+\\eta_{K_{2}}=R(u_{h})(z)$ and compute its value.\n\nFinally, explain conceptually what happens to $R(u_{h})(z_{h})$ when the adjoint is not enriched (i.e., $z_{h}\\in V_{h}$) and compare this with enriching only the adjoint space. In your explanation, briefly comment on how the same idea extends to the discontinuous Galerkin (DG) setting, where the element interior residual $f+\\nabla\\cdot(\\nabla u_{h})$ and the interelement flux jumps would enter the indicators. Express the final numerical value of $\\mathcal{E}_{\\text{cheap}}$ as an exact fraction; no rounding is required.", "solution": "The problem statement is validated as scientifically grounded, well-posed, and objective. It presents a standard exercise in the a posteriori error analysis of finite element methods using the Dual Weighted Residual (DWR) technique, which is a core topic in computational science. All data and definitions are provided and are consistent. We may therefore proceed with the solution.\n\nThe solution involves three main computational steps followed by a conceptual explanation.\n\nFirst, we compute the continuous piecewise-linear finite element (FE) solution $u_h$ on the specified mesh. The mesh consists of two elements, $K_1 = (0, \\frac{1}{2})$ and $K_2 = (\\frac{1}{2}, 1)$. The FE space $V_h$ is composed of continuous functions that are linear on each element and vanish at the domain boundaries $x=0$ and $x=1$. This leaves a single degree of freedom, which is the value of the solution at the interior node $x=\\frac{1}{2}$. Let $\\phi(x)$ be the standard linear \"hat\" basis function associated with this node:\n$$\n\\phi(x) = \\begin{cases}\n2x  \\text{if } x \\in [0, \\frac{1}{2}] \\\\\n2(1-x)  \\text{if } x \\in [\\frac{1}{2}, 1]\n\\end{cases}\n$$\nThe FE solution $u_h$ can be written as $u_h(x) = U \\phi(x)$, where $U = u_h(\\frac{1}{2})$ is the unknown coefficient to be determined. The derivative is $u_h'(x) = U \\phi'(x)$, where\n$$\n\\phi'(x) = \\begin{cases}\n2  \\text{if } x \\in (0, \\frac{1}{2}) \\\\\n-2  \\text{if } x \\in (\\frac{1}{2}, 1)\n\\end{cases}\n$$\nThe unknown $U$ is found by solving the discrete weak form with $v_h = \\phi(x)$:\n$$\n\\int_{0}^{1} u_h'(x) \\phi'(x) \\,dx = \\int_{0}^{1} f(x) \\phi(x) \\,dx\n$$\nSubstituting $u_h'(x) = U \\phi'(x)$ and $f(x)=1$, we get:\n$$\nU \\int_{0}^{1} (\\phi'(x))^2 \\,dx = \\int_{0}^{1} \\phi(x) \\,dx\n$$\nWe compute the integrals:\nThe left-hand side integral is:\n$$\n\\int_{0}^{1} (\\phi'(x))^2 \\,dx = \\int_{0}^{1/2} (2)^2 \\,dx + \\int_{1/2}^{1} (-2)^2 \\,dx = 4 \\cdot \\frac{1}{2} + 4 \\cdot \\frac{1}{2} = 4\n$$\nThe right-hand side integral is:\n$$\n\\int_{0}^{1} \\phi(x) \\,dx = \\int_{0}^{1/2} 2x \\,dx + \\int_{1/2}^{1} 2(1-x) \\,dx = [x^2]_0^{1/2} + [2x - x^2]_{1/2}^1 = \\frac{1}{4} + \\left( (2-1) - (1 - \\frac{1}{4}) \\right) = \\frac{1}{4} + \\frac{1}{4} = \\frac{1}{2}\n$$\nThe equation for $U$ becomes $4U = \\frac{1}{2}$, which yields $U = \\frac{1}{8}$.\nThus, the FE solution is:\n$$\nu_h(x) = \\frac{1}{8} \\phi(x) = \\begin{cases}\n\\frac{x}{4}  \\text{if } x \\in [0, \\frac{1}{2}] \\\\\n\\frac{1-x}{4}  \\text{if } x \\in [\\frac{1}{2}, 1]\n\\end{cases}\n$$\nThe derivative is:\n$$\nu_h'(x) = \\begin{cases}\n\\frac{1}{4}  \\text{if } x \\in (0, \\frac{1}{2}) \\\\\n-\\frac{1}{4}  \\text{if } x \\in (\\frac{1}{2}, 1)\n\\end{cases}\n$$\n\nSecond, we compute the exact adjoint solution $z$. The weak form for $z$ is $\\int_{0}^{1} v' z'\\,dx = \\int_{0}^{1} v\\,dx$ for all $v\\in H_{0}^{1}(\\Omega)$. This corresponds to the strong form $-z'' = 1$ in $\\Omega=(0,1)$ with homogeneous Dirichlet boundary conditions $z(0)=z(1)=0$. Integrating twice gives $z(x) = -\\frac{x^2}{2} + C_1 x + C_2$. The boundary conditions $z(0)=0$ and $z(1)=0$ yield $C_2=0$ and $C_1=\\frac{1}{2}$. The exact adjoint solution is:\n$$\nz(x) = \\frac{x}{2} - \\frac{x^2}{2} = \\frac{1}{2}x(1-x)\n$$\nIts derivative is $z'(x) = \\frac{1}{2} - x$.\n\nThird, we compute the elementwise indicators $\\eta_K$ and the global estimator $\\mathcal{E}_{\\text{cheap}}$. The indicator for an element $K$ is defined as $\\eta_K = \\int_K f z \\,dx - \\int_K u_h' z' \\,dx$.\n\nFor element $K_1 = (0, \\frac{1}{2})$:\n$$\n\\eta_{K_1} = \\int_{0}^{1/2} (1) \\left(\\frac{x}{2} - \\frac{x^2}{2}\\right) \\,dx - \\int_{0}^{1/2} \\left(\\frac{1}{4}\\right) \\left(\\frac{1}{2} - x\\right) \\,dx\n$$\nThe first integral is $\\frac{1}{2} [\\frac{x^2}{2} - \\frac{x^3}{3}]_0^{1/2} = \\frac{1}{2} \\left(\\frac{1}{8} - \\frac{1}{24}\\right) = \\frac{1}{2} \\left(\\frac{2}{24}\\right) = \\frac{1}{24}$.\nThe second integral is $\\frac{1}{4} [\\frac{x}{2} - \\frac{x^2}{2}]_0^{1/2} = \\frac{1}{4} \\left(\\frac{1}{4} - \\frac{1}{8}\\right) = \\frac{1}{4} \\left(\\frac{1}{8}\\right) = \\frac{1}{32}$.\nSo, $\\eta_{K_1} = \\frac{1}{24} - \\frac{1}{32} = \\frac{4-3}{96} = \\frac{1}{96}$.\n\nFor element $K_2 = (\\frac{1}{2}, 1)$:\n$$\n\\eta_{K_2} = \\int_{1/2}^{1} (1) \\left(\\frac{x}{2} - \\frac{x^2}{2}\\right) \\,dx - \\int_{1/2}^{1} \\left(-\\frac{1}{4}\\right) \\left(\\frac{1}{2} - x\\right) \\,dx\n$$\nThe first integral is $\\frac{1}{2} [\\frac{x^2}{2} - \\frac{x^3}{3}]_{1/2}^{1} = \\frac{1}{2} \\left[ \\left(\\frac{1}{2} - \\frac{1}{3}\\right) - \\left(\\frac{1}{8} - \\frac{1}{24}\\right) \\right] = \\frac{1}{2} \\left[ \\frac{1}{6} - \\frac{2}{24} \\right] = \\frac{1}{2} \\left[ \\frac{1}{6} - \\frac{1}{12} \\right] = \\frac{1}{24}$.\nThe second integral is $\\frac{1}{4} \\int_{1/2}^{1} \\left(x - \\frac{1}{2}\\right) \\,dx = \\frac{1}{4} [\\frac{x^2}{2} - \\frac{x}{2}]_{1/2}^{1} = \\frac{1}{4} \\left[ \\left(\\frac{1}{2} - \\frac{1}{2}\\right) - \\left(\\frac{1}{8} - \\frac{1}{4}\\right) \\right] = \\frac{1}{4} \\left[ - \\left(-\\frac{1}{8}\\right) \\right] = \\frac{1}{32}$.\nSo, $\\eta_{K_2} = \\frac{1}{24} - \\frac{1}{32} = \\frac{4-3}{96} = \\frac{1}{96}$.\n\nThe global estimator is the sum of the element indicators:\n$$\n\\mathcal{E}_{\\text{cheap}} = \\eta_{K_1} + \\eta_{K_2} = \\frac{1}{96} + \\frac{1}{96} = \\frac{2}{96} = \\frac{1}{48}\n$$\n\nFinally, we provide the conceptual explanation. The weak residual is defined as $R(u_{h})(w) = \\int_{0}^{1} f w\\,dx - \\int_{0}^{1} u_{h}' w'\\,dx$. The definition of the FE solution $u_h \\in V_h$ is precisely that this residual is zero for any test function $v_h \\in V_h$. This property is known as Galerkin orthogonality. If the adjoint approximation $z_h$ is sought in the same space $V_h$ as the primal approximation $u_h$ (i.e., no enrichment), then $z_h$ is a valid test function for the primal problem. Consequently, $R(u_h)(z_h) = 0$. An error estimator based on $R(u_h)(z_h)$ would always be zero, regardless of the actual error, rendering it useless for adaptivity or error quantification.\n\nThis highlights the core principle of the DWR method: to obtain a non-zero, meaningful error estimate, the adjoint problem must be approximated in a space that is \"richer\" than the primal FE space $V_h$. By \"enriching\" the adjoint space (e.g., using higher-order polynomials or a finer mesh), we obtain an approximate adjoint $z_{h, \\text{rich}}$ that is not in $V_h$. The residual $R(u_h)(z_{h, \\text{rich}})$ is then non-zero and provides an estimate of the error in the goal functional, $J(u) - J(u_h)$. In this problem, we use the exact solution $z$ as the ultimate form of enrichment. A key result of DWR theory states that the exact error in the functional is precisely the residual weighted by the exact adjoint error, $J(u)-J(u_h) = R(u_h)(z-z_h)$. Since $R(u_h)(z_h)=0$, this simplifies to $J(u)-J(u_h) = R(u_h)(z)$. Our calculation $\\mathcal{E}_{\\text{cheap}} = R(u_h)(z) = \\frac{1}{48}$ is therefore not an estimate but the exact error in the functional $J(u)$.\n\nThis concept extends directly to discontinuous Galerkin (DG) methods. In a DG setting, the solution space allows for discontinuities at element faces. The corresponding weak forms include not only integrals over element interiors but also integrals over element faces (flux terms) that penalize jumps. After integration by parts, the element DWR indicators $\\eta_K$ for a DG method would contain contributions from both the element interior residual (e.g., $f + \\Delta_h u_h$) and the inter-element jump residuals (e.g., jumps in the value or the normal flux of $u_h$). As in the continuous case, Galerkin orthogonality ensures that the sum of all these weighted residuals is zero if the adjoint test function is chosen from the same DG space as the primal solution. Thus, enrichment of the adjoint space is equally crucial in the DG context to obtain a non-trivial and effective error estimator for driving adaptive mesh refinement.", "answer": "$$\n\\boxed{\\frac{1}{48}}\n$$", "id": "3330525"}, {"introduction": "This final, advanced practice transitions from analytical calculations to a computational investigation of the deeper mechanisms of the DWR method. By implementing a numerical experiment, you will explore how the spectral characteristics of the primal residual and the dual solution interact to determine the final error in the goal functional. This exercise powerfully demonstrates that large local residuals do not necessarily lead to a large global error, showcasing how DWR provides crucial insight into which errors actually matter for a given computational goal [@problem_id:3381923].", "problem": "Consider the one-dimensional steady elliptic boundary value problem on the interval $[0,1]$ with homogeneous Dirichlet boundary conditions: find the exact solution $u$ such that\n$$\n-\\frac{d^2 u}{dx^2} = f \\quad \\text{in } (0,1), \\qquad u(0)=u(1)=0,\n$$\nwhere the source term $f$ is induced by a prescribed exact solution $u$ via the operator $L u = -u'' = f$. Let the quantity of interest be the linear functional\n$$\nJ(u) = \\int_0^1 \\psi(x)\\,u(x)\\,dx,\n$$\nwith a given weight function $\\psi$. The Dual Weighted Residual (DWR) method evaluates the error in $J$ via the adjoint (dual) problem for the weight $z$, defined by\n$$\n-\\frac{d^2 z}{dx^2} = \\psi(x) \\quad \\text{in } (0,1), \\qquad z(0)=z(1)=0.\n$$\nIn the discontinuous Galerkin setting with a partition of the domain into elements $\\{K\\}$, the elementwise residual $R_K$ is the restriction of the primal residual $R = L(u_h) - f$ to $K$, where $u_h$ is an approximation of $u$. The DWR error representation aggregates local weighted contributions $\\langle R_K, z\\rangle = \\int_K R(x)\\,z(x)\\,dx$. Your task is to construct and quantify a scenario exhibiting large local residuals $R_K$ but small adjoint weight $z$, leading to near cancellation in the global sum $\\sum_K \\langle R_K, z\\rangle$, and then interpret the mechanism by which the error in $J(u)$ is negligible.\n\nYou must implement a spectral construction and an elementwise aggregation consistent with the above model. Use the following setup.\n\n1. Domain and operator:\n   - Domain is $[0,1]$.\n   - Operator is $L = -\\frac{d^2}{dx^2}$ with homogeneous Dirichlet boundary conditions.\n\n2. Exact solution $u$:\n   - Define $u(x)$ by a finite sine series that satisfies the boundary conditions:\n     $$\n     u(x) = \\sum_{n\\in \\{1,2,10,15\\}} a_n \\sin(n\\pi x),\n     $$\n     with coefficients $a_1=0.5$, $a_2=0.3$, $a_{10}=1.0$, $a_{15}=0.8$.\n   - The source term $f$ is then $f(x) = \\sum_{n\\in \\{1,2,10,15\\}} (n\\pi)^2 a_n \\sin(n\\pi x)$.\n\n3. Approximate solution $u_h$ (under-resolved spectral discretization):\n   - Define $u_h(x)$ by truncating and perturbing low frequencies:\n     $$\n     u_h(x) = \\sum_{n\\in \\{1,2\\}} b_n \\sin(n\\pi x),\n     $$\n     with $b_1=0.48$, $b_2=0.28$.\n\n4. Residual and adjoint:\n   - Define the primal residual $R(x) = L(u_h)(x) - f(x) = -u_h''(x) - f(x)$.\n   - For each test case, solve the adjoint problem $-z'' = \\psi$ with $z(0)=z(1)=0$. You will use closed-form $z$ corresponding to chosen $\\psi$.\n\n5. Elementwise aggregation:\n   - Partition $[0,1]$ into $N_{\\mathrm{el}}=20$ elements $K_j = \\left[\\frac{j}{N_{\\mathrm{el}}}, \\frac{j+1}{N_{\\mathrm{el}}}\\right]$, $j=0,\\dots,19$.\n   - For each element $K$, compute $\\langle R_K, z\\rangle = \\int_K R(x)\\,z(x)\\,dx$ using Gaussian quadrature with $Q=100$ points per element.\n   - Compute the global weighted residual sum $E = \\sum_K \\langle R_K, z\\rangle$.\n   - Compute the total magnitude of local contributions $S = \\sum_K \\left|\\langle R_K, z\\rangle\\right|$.\n   - Define the cancellation ratio $C = \\frac{|E|}{S}$, with the convention $C=0$ if $S=0$.\n\n6. Quantity of interest error:\n   - Compute $J(u)-J(u_h)$ via numerical quadrature over $[0,1]$ using a sufficiently accurate Gaussian quadrature (use $Q_{\\mathrm{global}}=2000$ points). This provides an independent check of the weighted residual sum $E$ for a self-adjoint operator with homogeneous boundary conditions.\n\n7. Test suite:\n   - Case 1 (low-frequency weight plus a small high-frequency perturbation): $\\psi_1(x) = \\sin(\\pi x) + \\alpha \\sin(10\\pi x)$ with $\\alpha = 0.01$.\n     The expected mechanism is that high-frequency components of $R$ align weakly with $z$ so that local contributions oscillate in sign and largely cancel, while small low-frequency mismatch drives a small net error.\n   - Case 2 (high-frequency weight matching residual): $\\psi_2(x) = \\sin(10\\pi x)$.\n     The expected mechanism is that $z$ matches the dominant missing mode in $u_h$, so local contributions add constructively, leading to a large error with minimal cancellation.\n   - Case 3 (smooth non-oscillatory weight): $\\psi_3(x) = 1$ (the constant function).\n     In this case, $z(x)$ is quadratic and smooth. The expected mechanism is that $R$ oscillates rapidly and its product with smooth $z$ averages out locally, producing strong cancellation and a negligible net error.\n\n8. Output requirements:\n   - For each test case, compute two floats: the DWR error $E$ and the cancellation ratio $C$.\n   - Your program should produce a single line of output containing the six results in a comma-separated list enclosed in square brackets, in the order $[E_1,C_1,E_2,C_2,E_3,C_3]$, where $E_i$ and $C_i$ correspond to test case $i=1,2,3$.\n\nAll quantities are dimensionless; no physical units are involved. Angles are in radians where applicable. Ensure numerical stability and accuracy with the specified quadrature orders and element partitions. The scenario must be scientifically realistic and derived from the fundamental setup provided above. Implement the program so that it is entirely self-contained, requires no input, and adheres to the output specification.", "solution": "The problem is assessed to be valid as it is scientifically grounded in the principles of numerical analysis and a posteriori error estimation, is well-posed with all necessary information provided, and is formulated objectively. The provided setup is a self-consistent and well-defined numerical experiment to demonstrate the mechanisms of the Dual Weighted Residual (DWR) method.\n\nThe solution proceeds as follows. First, we establish the analytical forms of all relevant functions: the exact solution $u$, the approximate solution $u_h$, the resulting residual $R$, and the dual solutions $z$ for each test case. Second, we describe the numerical procedure for computing the element-wise weighted residuals and aggregating them to find the total estimated error $E$ and the cancellation ratio $C$. Finally, we analyze each test case, connecting the mathematical structure of the functions to the expected numerical results.\n\n**1. Analytical Framework**\n\nThe problem revolves around the one-dimensional Poisson equation with homogeneous Dirichlet boundary conditions on the interval $[0,1]$:\n$$\nL u = -\\frac{d^2 u}{dx^2} = f(x) \\quad \\text{for } x \\in (0,1), \\quad u(0)=u(1)=0.\n$$\nThe quantity of interest is a linear functional $J(u) = \\int_0^1 \\psi(x) u(x) dx$. The associated dual (or adjoint) problem is given by:\n$$\nL^* z = -\\frac{d^2 z}{dx^2} = \\psi(x) \\quad \\text{for } x \\in (0,1), \\quad z(0)=z(1)=0.\n$$\nSince the operator $L$ with these boundary conditions is self-adjoint ($L^*=L$), the error in the quantity of interest, $J(u) - J(u_h)$, can be related to the primal residual $R(x)$ and the dual solution $z(x)$. Let $e(x) = u(x) - u_h(x)$ be the approximation error.\n$$\nJ(u) - J(u_h) = J(e) = \\int_0^1 \\psi(x) e(x) dx = \\int_0^1 (-z''(x)) e(x) dx.\n$$\nIntegrating by parts twice and using the homogeneous boundary conditions for $e$ and $z$ yields:\n$$\nJ(e) = \\int_0^1 z(x) (-e''(x)) dx = \\int_0^1 z(x) (-u''(x) + u_h''(x)) dx.\n$$\nUsing $-u''(x)=f(x)$, this becomes:\n$$\nJ(e) = \\int_0^1 z(x) (f(x) + u_h''(x)) dx = - \\int_0^1 z(x) (-u_h''(x) - f(x)) dx.\n$$\nThe problem defines the primal residual as $R(x) = L(u_h)(x) - f(x) = -u_h''(x) - f(x)$. Therefore, the exact error representation is:\n$$\nJ(u) - J(u_h) = -\\int_0^1 R(x) z(x) dx.\n$$\nThe problem asks to compute the quantity $E = \\sum_K \\langle R_K, z \\rangle = \\int_0^1 R(x) z(x) dx$. Thus, $E$ represents the negative of the error in the quantity of interest, i.e., $E = -(J(u)-J(u_h))$. This sign convention is followed throughout the calculation.\n\n**2. Function Definitions**\n\n- **Exact Solution $u(x)$**:\n  $u(x) = \\sum_{n \\in \\{1,2,10,15\\}} a_n \\sin(n\\pi x)$ with coefficients $a_1=0.5$, $a_2=0.3$, $a_{10}=1.0$, $a_{15}=0.8$.\n  $$u(x) = 0.5 \\sin(\\pi x) + 0.3 \\sin(2\\pi x) + 1.0 \\sin(10\\pi x) + 0.8 \\sin(15\\pi x)$$\n\n- **Source Term $f(x)$**:\n  $f(x) = -u''(x) = \\sum_{n \\in \\{1,2,10,15\\}} (n\\pi)^2 a_n \\sin(n\\pi x)$.\n\n- **Approximate Solution $u_h(x)$**:\n  $u_h(x) = \\sum_{n \\in \\{1,2\\}} b_n \\sin(n\\pi x)$ with coefficients $b_1=0.48$, $b_2=0.28$.\n  $$u_h(x) = 0.48 \\sin(\\pi x) + 0.28 \\sin(2\\pi x)$$\n\n- **Primal Residual $R(x)$**:\n  $R(x) = -u_h''(x) - f(x) = \\sum_{n \\in \\{1,2\\}} (n\\pi)^2 (b_n - a_n) \\sin(n\\pi x) - \\sum_{n \\in \\{10,15\\}} (n\\pi)^2 a_n \\sin(n\\pi x)$.\n  Substituting the coefficients:\n  $$R(x) = -(0.02)\\pi^2\\sin(\\pi x) - (0.02)(2\\pi)^2\\sin(2\\pi x) - (1.0)(10\\pi)^2\\sin(10\\pi x) - (0.8)(15\\pi)^2\\sin(15\\pi x)$$\n  The residual consists of small-amplitude, low-frequency modes due to errors in the resolved components of the solution, and large-amplitude, high-frequency modes due to the unresolved components.\n\n- **Dual Solutions $z(x)$**: We solve $-z''=\\psi$ with $z(0)=z(1)=0$ for each case. For a right-hand side of $\\sin(k\\pi x)$, the solution is $z(x) = \\frac{1}{(k\\pi)^2}\\sin(k\\pi x)$. For $\\psi=1$, the solution is $z(x)=\\frac{x}{2}(1-x)$.\n  - **Case 1**: $\\psi_1(x) = \\sin(\\pi x) + 0.01 \\sin(10\\pi x)$\n    $$z_1(x) = \\frac{1}{\\pi^2}\\sin(\\pi x) + \\frac{0.01}{(10\\pi)^2}\\sin(10\\pi x)$$\n  - **Case 2**: $\\psi_2(x) = \\sin(10\\pi x)$\n    $$z_2(x) = \\frac{1}{(10\\pi)^2}\\sin(10\\pi x)$$\n  - **Case 3**: $\\psi_3(x) = 1$\n    $$z_3(x) = \\frac{x}{2}(1-x)$$\n\n**3. Numerical Computation and Analysis**\n\nThe domain $[0,1]$ is divided into $N_{\\mathrm{el}}=20$ elements $K_j$. On each element, we compute the local weighted residual $\\langle R_K, z \\rangle_j = \\int_{K_j} R(x)z(x)dx$ using Gaussian quadrature with $Q=100$ points. These local values are aggregated to form:\n- The global weighted residual sum: $E = \\sum_{j=0}^{N_{\\mathrm{el}}-1} \\langle R_K, z \\rangle_j$.\n- The total magnitude of local contributions: $S = \\sum_{j=0}^{N_{\\mathrm{el}}-1} |\\langle R_K, z \\rangle_j|$.\n- The cancellation ratio: $C = \\frac{|E|}{S}$.\n\nThe ratio $C$ measures the degree of cancellation among the local weighted residuals. A value of $C \\approx 1$ indicates that all local contributions have the same sign and add up constructively, implying no cancellation. A value of $C \\ll 1$ indicates that the local contributions oscillate in sign and largely cancel each other out, resulting in a global error estimate $|E|$ that is much smaller than the sum of the magnitudes of local indicators $S$.\n\n- **Analysis of Case 1**: The dual solution $z_1(x)$ is dominated by its low-frequency component. The residual $R(x)$ has large high-frequency components. The product $R(x)z_1(x)$ contains terms like $\\sin(10\\pi x)\\sin(\\pi x)$, which oscillate rapidly. When integrated over each element, these terms yield small values that tend to change sign from element to element, leading to significant cancellation in the global sum $E_1$. The net error is primarily determined by the product of the small low-frequency parts of both $R(x)$ and $z_1(x)$. Consequently, we expect a small error $E_1$ and a small cancellation ratio $C_1$.\n\n- **Analysis of Case 2**: The dual solution $z_2(x)$ is a single high-frequency mode that directly corresponds to the largest unresolved mode in the approximate solution $u_h$ (the $\\sin(10\\pi x)$ term). The integrand $R(x)z_2(x)$ has a dominant term of $-(\\sin(10\\pi x))^2 \\cdot (10\\pi)^2 / (10\\pi)^2 = -\\sin^2(10\\pi x)$. This term is non-positive everywhere, so the local integrals $\\langle R_K, z_2 \\rangle_j$ are all negative. They add up constructively. This leads to a large global error $E_2$ and a cancellation ratio $C_2 \\approx 1$.\n\n- **Analysis of Case 3**: The dual solution $z_3(x)$ is a smooth, non-oscillatory quadratic function. The residual $R(x)$ is highly oscillatory. The product $R(x)z_3(x)$ is a rapidly oscillating function modulated by the smooth shape of $z_3(x)$. On each element, the integral of this product tends to be small due to local averaging. Furthermore, the sign of these small local integrals is likely to flip across element boundaries due to the phase progression of the modes in $R(x)$. This results in strong global cancellation. We expect a small error $E_3$ and a very small cancellation ratio $C_3$.\n\nThe following Python code implements this procedure to compute $E$ and $C$ for each case.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes DWR error estimates and cancellation ratios for three test cases\n    of a 1D elliptic problem.\n    \"\"\"\n    # 1. Setup of problem parameters and analytical functions\n\n    # Coefficients for exact solution u(x)\n    a_coeffs = {1: 0.5, 2: 0.3, 10: 1.0, 15: 0.8}\n    # Coefficients for approximate solution u_h(x)\n    b_coeffs = {1: 0.48, 2: 0.28}\n\n    # Numerical parameters\n    N_el = 20  # Number of elements\n    Q = 100    # Quadrature points per element\n\n    # Define the residual function R(x) = -u_h''(x) - f(x)\n    # R(x) = sum_{n} (n*pi)^2 * (b_n - a_n) * sin(n*pi*x)\n    # Note: b_n is zero for n=10, 15\n    def R_func(x):\n        res = 0.0\n        pi = np.pi\n        \n        # Low frequency errors\n        res += (1 * pi)**2 * (b_coeffs[1] - a_coeffs[1]) * np.sin(1 * pi * x)\n        res += (2 * pi)**2 * (b_coeffs[2] - a_coeffs[2]) * np.sin(2 * pi * x)\n        \n        # High frequency (unresolved) errors\n        res += (10 * pi)**2 * (0 - a_coeffs[10]) * np.sin(10 * pi * x)\n        res += (15 * pi)**2 * (0 - a_coeffs[15]) * np.sin(15 * pi * x)\n        \n        return res\n\n    # Define the dual solutions z(x) for each case\n    pi = np.pi\n    alpha = 0.01\n\n    def z1_func(x):\n        # Corresponds to psi_1(x) = sin(pi*x) + alpha*sin(10*pi*x)\n        return (1 / pi**2) * np.sin(pi * x) + (alpha / (10 * pi)**2) * np.sin(10 * pi * x)\n\n    def z2_func(x):\n        # Corresponds to psi_2(x) = sin(10*pi*x)\n        return (1 / (10 * pi)**2) * np.sin(10 * pi * x)\n\n    def z3_func(x):\n        # Corresponds to psi_3(x) = 1\n        return 0.5 * x * (1 - x)\n\n    test_z_funcs = [z1_func, z2_func, z3_func]\n    \n    # 2. Gaussian Quadrature helper function\n    \n    # Pre-calculate Gauss-Legendre points and weights for [-1, 1]\n    gauss_points, gauss_weights = np.polynomial.legendre.leggauss(Q)\n\n    def gauss_quadrature(func, a, b):\n        \"\"\"\n        Integrates a function from a to b using pre-calculated Gauss points.\n        \"\"\"\n        # Map points from [-1, 1] to [a, b]\n        mapped_points = 0.5 * (b - a) * gauss_points + 0.5 * (a + b)\n        \n        # Evaluate the function at mapped points\n        func_vals = func(mapped_points)\n        \n        # Compute the integral\n        integral = 0.5 * (b - a) * np.sum(gauss_weights * func_vals)\n        return integral\n\n    # 3. Main computation loop for each test case\n    \n    results = []\n    \n    for z_func in test_z_funcs:\n        \n        E = 0.0  # Global weighted residual sum\n        S = 0.0  # Sum of absolute local contributions\n        \n        # Define the integrand for this case\n        integrand = lambda x: R_func(x) * z_func(x)\n        \n        # Loop over elements\n        for j in range(N_el):\n            x_left = j / N_el\n            x_right = (j + 1) / N_el\n            \n            # Compute local weighted residual\n            local_integral = gauss_quadrature(integrand, x_left, x_right)\n            \n            E += local_integral\n            S += np.abs(local_integral)\n            \n        # Compute cancellation ratio\n        # Use a small tolerance for floating point comparison to zero\n        C = np.abs(E) / S if S  1e-15 else 0.0\n        \n        results.extend([E, C])\n\n    # 4. Final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3381923"}]}