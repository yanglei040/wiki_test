{"hands_on_practices": [{"introduction": "The heart of a well-balanced scheme lies in its ability to exactly replicate the physical balance between flux gradients and source terms at the discrete level. For Discontinuous Galerkin methods, this often translates into a specific requirement on the accuracy of the numerical quadrature used to evaluate integrals within each element. This first exercise [@problem_id:3428768] provides a foundational, hands-on calculation to determine the minimal quadrature accuracy needed to preserve the 'lake-at-rest' steady state in the shallow water equations, connecting the polynomial degree of the approximation to the required number of integration points.", "problem": "Consider the one-dimensional shallow water balance law on a domain partitioned into elements with straight interfaces,\n$$\n\\partial_{t}\\begin{pmatrix} h \\\\ hu \\end{pmatrix}\n+ \\partial_{x}\\begin{pmatrix} hu \\\\ \\displaystyle \\frac{(hu)^{2}}{h} + \\frac{g}{2}h^{2} \\end{pmatrix}\n= \\begin{pmatrix} 0 \\\\ -g\\,h\\,\\partial_{x}b(x) \\end{pmatrix},\n$$\nwhere $h(x,t)$ is the water height, $u(x,t)$ is the velocity, $g$ is the gravitational acceleration (constant), and $b(x)$ is the bottom topography. The lake-at-rest steady state is given by $u(x,t)=0$ and $h(x,t)+b(x)=H$ with $H$ a constant.\n\nA Discontinuous Galerkin (DG) method of polynomial degree $p=1$ is used on each element, with test functions $\\varphi(x)$ that are polynomials of degree at most $1$. Assume the bottom $b(x)$ is piecewise linear per element, so that $\\partial_{x}b$ is constant within each element and may jump across interfaces. The DG formulation applies the standard integration by parts to the flux term within each element (yielding a volume integral involving $f(q)$ and the gradient of the test function, and a boundary flux term at interfaces), and discretizes the source term in the volume. To achieve exact well-balancing of the lake-at-rest state, one follows a path-conservative interpretation at interfaces for the nonconservative coupling induced by the topography: the interface contribution that enforces exact cancellation can be written as a one-dimensional path integral in an abstract path variable $s\\in[0,1]$ traversing a straight segment in state space between left and right traces, of the form\n$$\n\\int_{0}^{1} B\\big(q(s)\\big)\\,\\partial_{s}b(s)\\,ds,\n$$\nwith $B(q)=g\\,h$ and $b(s)$ linear along the path. In the lake-at-rest configuration, $h(s)=H-b(s)$ along the path.\n\nYou are to determine the minimal Gauss–Legendre quadrature orders required to exactly integrate:\n- the element interior (volume) integrals needed by the DG scheme to preserve the lake-at-rest equilibrium, and\n- the interface path integrals needed to ensure exact well-balancing at interfaces.\n\nUse the following fundamental bases:\n- The lake-at-rest state satisfies $u=0$ and $h+b=H$, so $h$ is piecewise linear if $b$ is piecewise linear.\n- Within each element for $p=1$, the gradient of any test function $\\varphi$ is constant.\n- The momentum flux reduces to the hydrostatic term $\\frac{g}{2}h^{2}$ when $u=0$.\n- Gauss–Legendre quadrature with $N$ points integrates exactly any polynomial of degree at most $2N-1$ on its interval of application.\n\nAssume each element mapping is affine so that polynomial degrees are preserved under the mapping and that the interface path $b(s)$ is linear. Express your final answer as a pair giving the minimal number of Gauss–Legendre points for volume integrals per element and for interface path integrals per interface, respectively. Provide the pair as a row matrix using integers. No rounding is needed and no units are involved.", "solution": "The problem requires determining the minimal number of Gauss-Legendre quadrature points necessary to achieve exact integration for two types of integrals in a Discontinuous Galerkin (DG) method for the shallow water equations, specifically to preserve the lake-at-rest steady state. The polynomial degree of the approximation space is $p=1$.\n\nThe lake-at-rest steady state is defined by a fluid velocity of zero, $u(x,t)=0$, and a constant total water surface level, $h(x,t)+b(x)=H$, where $h$ is the water height, $b$ is the bottom topography, and $H$ is a constant.\n\nA Gauss-Legendre quadrature rule with $N$ points integrates a polynomial of degree at most $2N-1$ exactly. To find the minimal $N$, we must find the maximal polynomial degree $d$ of the integrands and solve the inequality $2N-1 \\ge d$ for the smallest integer $N$.\n\n### Part 1: Element Interior (Volume) Integrals\n\nTo preserve the steady state, the numerical scheme must exactly balance the discretized flux gradient and source terms within each element. At the lake-at-rest state ($u=0$), the momentum equation simplifies. The terms that must be integrated over an element volume $K$ are derived from the weak formulation of the momentum equation:\n$$\n\\int_K \\partial_x \\left( \\frac{g}{2}h^2 \\right) \\varphi \\, dx = \\int_K -g h (\\partial_x b) \\varphi \\, dx\n$$\nAfter integration by parts, the relevant volume integrals that require numerical quadrature are:\n1.  The flux integral: $\\int_K \\frac{g}{2}h(x)^2 (\\partial_x \\varphi(x)) \\, dx$\n2.  The source term integral: $\\int_K g h(x) (\\partial_x b(x)) \\varphi(x) \\, dx$\n\nWe must determine the polynomial degree of the integrands on a given element $K$.\n-   The DG method uses polynomial basis and test functions of degree at most $p=1$. Thus, the test function $\\varphi(x)$ is a polynomial of degree at most $1$. Consequently, its derivative, $\\partial_x \\varphi(x)$, is a polynomial of degree at most $0$ (a constant).\n-   The numerical solution for the water height, $h(x)$, is also represented by a polynomial of degree at most $p=1$.\n-   The bottom topography $b(x)$ is given as piecewise linear. This means that on any single element $K$, $b(x)$ is a polynomial of degree at most $1$, and its derivative, $\\partial_x b(x)$, is a polynomial of degree at most $0$ (a constant).\n\nNow, let's analyze the degree of each integrand:\n1.  **Flux integrand**: The term is $\\frac{g}{2}h(x)^2 (\\partial_x \\varphi(x))$.\n    -   The degree of $h(x)^2$ is $2 \\times (\\text{degree of } h) = 2 \\times 1 = 2$.\n    -   The degree of $\\partial_x \\varphi(x)$ is $0$.\n    -   The degree of the product is $2+0=2$. So, the first integrand is a polynomial of degree at most $2$.\n\n2.  **Source integrand**: The term is $g h(x) (\\partial_x b(x)) \\varphi(x)$.\n    -   The degree of $h(x)$ is at most $1$.\n    -   The degree of $\\partial_x b(x)$ is at most $0$.\n    -   The degree of $\\varphi(x)$ is at most $1$.\n    -   The degree of the product is $1+0+1=2$. So, the second integrand is a polynomial of degree at most $2$.\n\nBoth integrands are polynomials of degree at most $d=2$. To integrate them exactly, we need a Gauss-Legendre rule with $N$ points such that:\n$$\n2N-1 \\ge 2 \\implies 2N \\ge 3 \\implies N \\ge 1.5\n$$\nSince $N$ must be an integer, the minimal number of points required is $N_{vol} = 2$.\n\n### Part 2: Interface Path Integrals\n\nThe problem specifies an interface contribution in the form of a path integral, which is essential for achieving a well-balanced scheme for the nonconservative system:\n$$\nI = \\int_{0}^{1} B\\big(q(s)\\big)\\,\\partial_{s}b(s)\\,ds\n$$\nwhere $s \\in [0,1]$ is the path parameter. We need to find the polynomial degree of the integrand with respect to $s$.\n\n-   The function $B(q)$ is given as $B(q) = g\\,h$.\n-   The path in state space, $q(s)$, is a straight segment connecting the left state $q_L$ and the right state $q_R$. This means each component of $q(s)$ is a linear function of $s$. In particular, for the water height $h$, we have $h(s) = (1-s)h_L + s h_R$, which is a polynomial of degree at most $1$ in $s$.\n-   The problem states that the path for the bottom topography, $b(s)$, is linear in $s$. This means $b(s) = (1-s)b_L + s b_R$ for some values $b_L$ and $b_R$.\n-   Consequently, the derivative $\\partial_s b(s) = b_R - b_L$ is a constant, i.e., a polynomial of degree $0$ in $s$.\n-   The integrand is $B(q(s)) \\partial_s b(s) = g h(s) \\partial_s b(s)$.\n    -   $g$ is a constant.\n    -   $h(s)$ is a polynomial of degree at most $1$.\n    -   $\\partial_s b(s)$ is a polynomial of degree $0$.\n    -   The product is a polynomial of degree at most $1+0=1$.\n\nThe problem also provides a consistency condition for the lake-at-rest state: $h(s) = H - b(s)$ along the path. This confirms the relationship between the paths and doesn't alter the degree calculation. If $h(s)$ is linear, then $b(s)=H-h(s)$ must also be linear, which is consistent with the problem statement.\n\nThe integrand is therefore a polynomial of degree at most $d=1$ in the integration variable $s$. To integrate it exactly, we need a Gauss-Legendre rule with $N$ points such that:\n$$\n2N-1 \\ge 1 \\implies 2N \\ge 2 \\implies N \\ge 1\n$$\nThe minimal number of points required is $N_{int} = 1$.\n\nThe minimal number of Gauss-Legendre points are $2$ for the volume integrals and $1$ for the interface path integrals.", "answer": "$$\n\\boxed{\n\\begin{pmatrix} 2 & 1 \\end{pmatrix}\n}\n$$", "id": "3428768"}, {"introduction": "A scheme that perfectly preserves a steady state is only useful if it also accurately simulates the dynamics of small perturbations around that state, such as ripples on a calm lake. This practice [@problem_id:3428747] delves into this question by using Fourier analysis to study the evolution of small-amplitude waves in a simple well-balanced DG scheme. By deriving the scheme's dispersion and dissipation errors, you will gain insight into how the numerical method affects wave propagation speed and amplitude, a critical aspect for the physical fidelity of any simulation.", "problem": "Consider the one-dimensional scalar balance law\n$$\nu_{t} + f(u)_{x} = s(x),\n$$\nposed on a periodic domain with uniform mesh of cells of width $h$. Assume a smooth steady state $u_{0}(x)$ is exactly preserved by the discretization and satisfies the balance relation\n$$\n\\frac{d}{dx} f(u_{0}(x)) = s(x).\n$$\nA Discontinuous Galerkin (DG) method is said to be well balanced if the semi-discrete residual vanishes when $u = u_{0}$ for any mesh resolution.\n\nLet $f(u) = a u$ with constant advection speed $a > 0$, and let the numerical flux at cell interfaces be the upwind flux $F^{*} = a u^{-}$, where $u^{-}$ denotes the left trace. Assume the source term is discretized in a path-conservative manner so that the semi-discrete operator is exactly zero for the discrete representation of $u_{0}$. Consider the DG scheme with polynomial degree $p=0$ (piecewise constant within each cell). Linearize the semi-discrete scheme around the preserved steady state, by writing $u = u_{0} + v$ and neglecting $O(|v|^{2})$ terms. Treat $v$ as a small-amplitude perturbation evolving under the linearized semi-discrete operator.\n\nUsing a spatial Fourier mode $v_{j}(t) = \\hat{v} \\exp(i \\theta j + \\lambda(\\theta) t)$ on the uniform mesh (cell index $j \\in \\mathbb{Z}$ and nondimensional wavenumber $\\theta \\in \\mathbb{R}$), derive the exact semi-discrete Fourier symbol $\\lambda(\\theta)$ for the perturbation evolution. Then, for small $|\\theta|$, expand $\\lambda(\\theta)$ and identify the leading-order dispersion and dissipation errors by defining the dimensionless coefficients $C_{\\mathrm{disp}}$ and $C_{\\mathrm{diss}}$ through the asymptotic relations\n$$\n\\operatorname{Im}(\\lambda(\\theta)) = -\\frac{a}{h}\\,\\theta + C_{\\mathrm{disp}}\\,\\frac{a}{h}\\,\\theta^{3} + o(\\theta^{3}),\n\\qquad\n-\\operatorname{Re}(\\lambda(\\theta)) = C_{\\mathrm{diss}}\\,\\frac{a}{h}\\,\\theta^{2} + o(\\theta^{2}).\n$$\nReport the pair of leading-order coefficients $\\big(C_{\\mathrm{disp}},\\,C_{\\mathrm{diss}}\\big)$ as your final answer. The coefficients are dimensionless, so no units are required. Express your final answer exactly; no rounding is needed.", "solution": "The user wants to analyze a Discontinuous Galerkin (DG) scheme.\n\n### Step 1: Problem Validation\n\n**1.1. Extract Givens**\n\n*   **Governing Equation:** The one-dimensional scalar balance law is $u_{t} + f(u)_{x} = s(x)$.\n*   **Flux Function:** The flux is linear, $f(u) = a u$, where $a > 0$ is a constant advection speed.\n*   **Domain and Mesh:** The problem is posed on a periodic domain with a uniform mesh of cells $I_j = [x_{j-1/2}, x_{j+1/2}]$ of width $h = x_{j+1/2} - x_{j-1/2}$.\n*   **Steady State:** A smooth steady state $u_{0}(x)$ is exactly preserved, satisfying the balance relation $\\frac{d}{dx} f(u_{0}(x)) = s(x)$, which for the given flux becomes $a \\frac{du_0}{dx} = s(x)$.\n*   **Numerical Method:** A Discontinuous Galerkin (DG) method with polynomial degree $p=0$. This implies the solution is approximated as a piecewise constant function, $u_h(x,t) = u_j(t)$ for $x \\in I_j$.\n*   **Numerical Flux:** The interfacial flux is the upwind flux. Since $a > 0$, the flux at an interface is determined by the state on the left, so $F^{*}(u_L, u_R) = f(u_L) = a u_L$. In the context of cell $I_j$, the flux at $x_{j-1/2}$ is $F^*(u_{j-1}, u_j) = a u_{j-1}$ and at $x_{j+1/2}$ is $F^*(u_j, u_{j+1}) = a u_j$.\n*   **Well-Balanced Property:** The scheme is well-balanced, meaning \"the semi-discrete residual vanishes when $u = u_0$ for any mesh resolution\". It is also stated that \"the source term is discretized in a path-conservative manner so that the semi-discrete operator is exactly zero for the discrete representation of $u_0$\".\n*   **Linearization:** A perturbation analysis is to be performed by setting $u = u_{0} + v$ and neglecting terms of order $O(|v|^2)$.\n*   **Fourier Analysis:** A spatial Fourier mode $v_{j}(t) = \\hat{v} \\exp(i \\theta j + \\lambda(\\theta) t)$ is used for the perturbation $v$, where $j$ is the cell index and $\\theta$ is the non-dimensional wavenumber.\n*   **Objective:** Derive the semi-discrete Fourier symbol $\\lambda(\\theta)$ and find the leading-order dispersion coefficient $C_{\\mathrm{disp}}$ and dissipation coefficient $C_{\\mathrm{diss}}$ from the small-$\\theta$ expansion:\n    $$ \\operatorname{Im}(\\lambda(\\theta)) = -\\frac{a}{h}\\,\\theta + C_{\\mathrm{disp}}\\,\\frac{a}{h}\\,\\theta^{3} + o(\\theta^{3}) $$\n    $$ -\\operatorname{Re}(\\lambda(\\theta)) = C_{\\mathrm{diss}}\\,\\frac{a}{h}\\,\\theta^{2} + o(\\theta^{2}) $$\n\n**1.2. Validate Using Extracted Givens**\n\n*   **Scientific Grounding:** The problem is firmly rooted in the field of numerical analysis for partial differential equations, a core topic in applied mathematics and computational science. The concepts of DG methods, well-balancing, linearization, and Fourier stability analysis are standard and scientifically rigorous. There is no pseudoscience or factual unsoundness.\n*   **Well-Posedness:** The problem is well-posed. It provides a clear setup and a specific, calculable objective. All necessary information is provided. The assumption about the well-balanced source term discretization, while not specifying the exact form of the discrete source term, provides its crucial property, which is sufficient for the subsequent linearization.\n*   **Objectivity:** The problem is stated in precise, objective mathematical language.\n*   **Overall Verdict:** The problem is a standard, valid exercise in the numerical analysis of conservation laws.\n\n**1.3. Verdict and Action**\n\nThe problem is valid. The solution will proceed.\n\n### Step 2: Derivation of the Linearized Scheme\n\nThe Discontinuous Galerkin (DG) method with polynomial degree $p=0$ is formulated by multiplying the PDE by a test function $\\phi(x)$ (which is constant, $\\phi=1$, on each cell $I_j$) and integrating over the cell:\n$$\n\\int_{x_{j-1/2}}^{x_{j+1/2}} u_t \\,dx + \\int_{x_{j-1/2}}^{x_{j+1/2}} f(u)_x \\,dx = \\int_{x_{j-1/2}}^{x_{j+1/2}} s(x) \\,dx\n$$\nFor a piecewise constant approximation $u_h(x,t) = u_j(t)$ on cell $I_j$, the first term becomes $h \\frac{du_j}{dt}$. Integrating the flux term by parts and introducing the numerical flux $F^*$ gives:\n$$\nh \\frac{du_j}{dt} + F^*(u_h(x_{j+1/2}^-), u_h(x_{j+1/2}^+)) - F^*(u_h(x_{j-1/2}^-), u_h(x_{j-1/2}^+)) = \\int_{x_{j-1/2}}^{x_{j+1/2}} s(x) \\,dx\n$$\nWith $u_h(x_{j+1/2}^-) = u_j$, $u_h(x_{j+1/2}^+) = u_{j+1}$, and the upwind flux $F^*(u_L, u_R) = a u_L$ for $a>0$, the flux contributions are $F^*(u_j, u_{j+1}) = a u_j$ and $F^*(u_{j-1}, u_j) = a u_{j-1}$. The semi-discrete scheme is:\n$$\nh \\frac{du_j}{dt} + a u_j - a u_{j-1} = \\int_{x_{j-1/2}}^{x_{j+1/2}} s(x) \\,dx\n$$\nLet's denote the discrete source term as $S_j = \\frac{1}{h} \\int_{x_{j-1/2}}^{x_{j+1/2}} s(x) \\,dx$. The scheme is:\n$$\n\\frac{du_j}{dt} = -\\frac{a}{h}(u_j - u_{j-1}) + S_j\n$$\nThe problem states that the scheme is well-balanced for a discrete representation of the steady state, which we denote as $u_{0,j}$. This means that when $u_j = u_{0,j}$, the time derivative is zero:\n$$\n0 = -\\frac{a}{h}(u_{0,j} - u_{0,j-1}) + S_j\n$$\nThis is the discrete steady-state condition.\n\nNow, we linearize the scheme around this steady state by substituting $u_j(t) = u_{0,j} + v_j(t)$, where $v_j$ is a small perturbation. Since the problem is linear, this is an exact decomposition, not an approximation.\n$$\n\\frac{d}{dt}(u_{0,j} + v_j(t)) = -\\frac{a}{h}((u_{0,j} + v_j(t)) - (u_{0,j-1} + v_{j-1}(t))) + S_j\n$$\nSince $u_{0,j}$ is time-independent, $\\frac{du_{0,j}}{dt}=0$. Expanding the right-hand side:\n$$\n\\frac{dv_j}{dt} = \\left[ -\\frac{a}{h}(u_{0,j} - u_{0,j-1}) + S_j \\right] - \\frac{a}{h}(v_j - v_{j-1})\n$$\nThe term in the square brackets is exactly zero due to the well-balanced property of the scheme. Thus, the evolution equation for the perturbation $v_j$ is independent of the steady state $u_0$ and the source term $s(x)$:\n$$\n\\frac{dv_j}{dt} = -\\frac{a}{h}(v_j - v_{j-1})\n$$\n\n### Step 3: Fourier Analysis\n\nWe now analyze the evolution of the perturbation by substituting the Fourier mode $v_j(t) = \\hat{v} \\exp(i \\theta j + \\lambda(\\theta) t)$ into the linearized equation.\nThe left-hand side becomes:\n$$\n\\frac{dv_j}{dt} = \\lambda(\\theta) v_j\n$$\nThe right-hand side terms are:\n$$\nv_j = \\hat{v} \\exp(i \\theta j + \\lambda(\\theta) t)\n$$\n$$\nv_{j-1} = \\hat{v} \\exp(i \\theta (j-1) + \\lambda(\\theta) t) = \\exp(-i\\theta) v_j\n$$\nSubstituting these into the perturbation equation gives:\n$$\n\\lambda(\\theta) v_j = -\\frac{a}{h}(v_j - \\exp(-i\\theta) v_j)\n$$\nDividing by $v_j$ (which is non-zero) yields the exact semi-discrete Fourier symbol $\\lambda(\\theta)$:\n$$\n\\lambda(\\theta) = -\\frac{a}{h}(1 - \\exp(-i\\theta))\n$$\n\n### Step 4: Asymptotic Expansion and Coefficient Identification\n\nTo find the dispersion and dissipation coefficients, we perform a Taylor series expansion of $\\lambda(\\theta)$ for small $|\\theta|$. We use the expansion of the exponential function:\n$$\n\\exp(-i\\theta) = 1 - i\\theta + \\frac{(-i\\theta)^2}{2!} + \\frac{(-i\\theta)^3}{3!} + O(\\theta^4) = 1 - i\\theta - \\frac{\\theta^2}{2} + i\\frac{\\theta^3}{6} + O(\\theta^4)\n$$\nSubstituting this into the expression for $\\lambda(\\theta)$:\n$$\n\\lambda(\\theta) = -\\frac{a}{h} \\left[ 1 - \\left(1 - i\\theta - \\frac{\\theta^2}{2} + i\\frac{\\theta^3}{6} + O(\\theta^4)\\right) \\right]\n$$\n$$\n\\lambda(\\theta) = -\\frac{a}{h} \\left( i\\theta + \\frac{\\theta^2}{2} - i\\frac{\\theta^3}{6} + O(\\theta^4) \\right)\n$$\n$$\n\\lambda(\\theta) = -\\frac{a}{h}\\frac{\\theta^2}{2} - i\\frac{a}{h}\\theta + i\\frac{a}{h}\\frac{\\theta^3}{6} + O(\\theta^4)\n$$\nWe now separate the real and imaginary parts of $\\lambda(\\theta)$:\n$$\n\\operatorname{Re}(\\lambda(\\theta)) = -\\frac{a}{2h}\\theta^2 + O(\\theta^4)\n$$\n$$\n\\operatorname{Im}(\\lambda(\\theta)) = -\\frac{a}{h}\\theta + \\frac{a}{6h}\\theta^3 + O(\\theta^5)\n$$\nThe problem defines the dissipation and dispersion coefficients through the following asymptotic relations.\n\n**Dissipation Coefficient ($C_{\\mathrm{diss}}$):**\nThe relation for dissipation is given by:\n$$\n-\\operatorname{Re}(\\lambda(\\theta)) = C_{\\mathrm{diss}}\\frac{a}{h}\\theta^{2} + o(\\theta^{2})\n$$\nFrom our expansion, we have:\n$$\n-\\operatorname{Re}(\\lambda(\\theta)) = - \\left(-\\frac{a}{2h}\\theta^2\\right) = \\frac{1}{2}\\frac{a}{h}\\theta^2\n$$\nComparing the leading-order terms, we find:\n$$\nC_{\\mathrm{diss}}\\frac{a}{h}\\theta^{2} = \\frac{1}{2}\\frac{a}{h}\\theta^2 \\implies C_{\\mathrm{diss}} = \\frac{1}{2}\n$$\n\n**Dispersion Coefficient ($C_{\\mathrm{disp}}$):**\nThe relation for dispersion is given by:\n$$\n\\operatorname{Im}(\\lambda(\\theta)) = -\\frac{a}{h}\\theta + C_{\\mathrm{disp}}\\frac{a}{h}\\theta^{3} + o(\\theta^{3})\n$$\nFrom our expansion, we have:\n$$\n\\operatorname{Im}(\\lambda(\\theta)) = -\\frac{a}{h}\\theta + \\frac{1}{6}\\frac{a}{h}\\theta^3 + O(\\theta^5)\n$$\nComparing the $\\theta^3$ terms, we find:\n$$\nC_{\\mathrm{disp}}\\frac{a}{h}\\theta^{3} = \\frac{1}{6}\\frac{a}{h}\\theta^3 \\implies C_{\\mathrm{disp}} = \\frac{1}{6}\n$$\n\nThe pair of leading-order coefficients is $(C_{\\mathrm{disp}}, C_{\\mathrm{diss}}) = (\\frac{1}{6}, \\frac{1}{2})$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{6} & \\frac{1}{2}\n\\end{pmatrix}\n}\n$$", "id": "3428747"}, {"introduction": "Building a robust, multi-dimensional, high-order well-balanced scheme requires synthesizing several key concepts into a coherent algorithm. This final practice [@problem_id:3428781] moves beyond isolated calculations to the high-level design of a complete 2D shallow water solver. You are tasked with selecting a correct and internally consistent workflow, considering everything from the choice of evolved variables and data structures to the crucial implementation of hydrostatic reconstruction at interfaces and well-balanced limiters for handling shocks.", "problem": "Consider the two-dimensional shallow water equations with bathymetry in conservative form\n$$\n\\partial_t \\boldsymbol{U} + \\nabla \\cdot \\boldsymbol{F}(\\boldsymbol{U}) = \\boldsymbol{S}(\\boldsymbol{U},\\nabla b),\n$$\nwhere $\\boldsymbol{U} = \\begin{bmatrix} h \\\\ h u \\\\ h v \\end{bmatrix}$, $\\boldsymbol{F}(\\boldsymbol{U}) = \\begin{bmatrix} h u & h v \\\\ h u^2 + \\tfrac{1}{2} g h^2 & h u v \\\\ h u v & h v^2 + \\tfrac{1}{2} g h^2 \\end{bmatrix}$, $\\boldsymbol{S}(\\boldsymbol{U},\\nabla b) = \\begin{bmatrix} 0 \\\\ - g h \\, \\partial_x b \\\\ - g h \\, \\partial_y b \\end{bmatrix}$, $h$ is the water depth, $\\boldsymbol{u} = (u,v)$ is the velocity, $g$ is gravitational acceleration, and $b$ is the bathymetry. A well-balanced scheme is one that exactly preserves the lake-at-rest steady state defined by $u = 0$, $v = 0$, and $\\eta \\equiv h + b = \\eta_0$ with $\\eta_0$ constant.\n\nA Discontinuous Galerkin (DG) method is to be implemented on a shape-regular mesh. You must decide on an algorithmic workflow that guarantees the well-balanced property at the semi-discrete level for smooth $b$ under exact quadrature, specifies concrete data structures for equilibrium variables, quadrature, and limiters, and provides a correct leading-order complexity analysis per time step as a function of the number of elements $N_e$ and the polynomial degree $p$.\n\nSelect the option that provides a correct and internally consistent workflow, including:\n- the choice of primary variables and how equilibrium variables are represented and stored,\n- the construction of volume and surface terms (including any reconstruction or flux modification) to achieve exact balance for the lake-at-rest state,\n- the limiter strategy and its interaction with the equilibrium state,\n- the data structures for unknowns, geometry, and quadrature needed for an efficient implementation,\n- and the correct leading-order computational complexity per time step (and dominant memory footprint) as a function of $N_e$ and $p$ on a tensor-product quadrilateral mesh using nodal DG with sum-factorization.\n\nOptions:\n\nA) Use the free-surface elevation $\\eta = h + b$ and momenta $(h u, h v)$ as primary polynomial fields per element on a tensor-product quadrilateral mesh with a nodal basis at Gauss–Legendre–Lobatto (GLL) nodes. Store, for each element index $e \\in \\{1,\\dots,N_e\\}$, variables in arrays $\\widehat{\\boldsymbol{U}}[e, v, i, j]$ with $v \\in \\{1,2,3\\}$ and $(i,j) \\in \\{0,\\dots,p\\}^2$ holding nodal coefficients for $(\\eta, h u, h v)$; store bathymetry as a nodal field $b[e,i,j]$ on the same nodes; store geometric Jacobians and metric terms $\\mathcal{J}[e,i,j]$, $(x_\\xi, x_\\eta, y_\\xi, y_\\eta)[e,i,j]$. Use volume quadrature collocated at the GLL nodes and surface quadrature at GLL nodes on faces. In each Runge–Kutta stage: evaluate flux divergence with a split-form DG operator that is consistent with the nodal quadrature; discretize the source term using the same quadrature and metric terms so that for $u=v=0$ and $\\eta$ constant, the discrete flux divergence exactly cancels the discrete source contribution at all nodes; at interfaces, apply a hydrostatic reconstruction in the approximate Riemann solver that reconstructs left/right water depths by $h^\\pm = \\max(0, \\eta^\\pm - \\max(b^\\pm_L, b^\\pm_R))$ to ensure exact preservation of the lake-at-rest state even with discontinuous $b$. For limiting, decompose the state into an equilibrium part and a fluctuation: compute a per-element equilibrium $\\eta_{eq} = \\overline{\\eta}$ and zero momenta, form fluctuations $\\eta' = \\eta - \\eta_{eq}$, $(h u)' = h u$, $(h v)' = h v$, apply a Total Variation Bounded (TVB) limiter and a positivity-preserving limiter to the fluctuations only, and reconstruct by adding back the equilibrium; this preserves the steady state. Use sum-factorization for tensor-product evaluation so that the per-step cost scales as $\\mathcal{O}(N_e\\, p^3)$ for volume terms and $\\mathcal{O}(N_e\\, p^2)$ for surface terms, with memory footprint $\\mathcal{O}(N_e\\, p^2)$ for solution and geometry storage. \n\nB) Use water depth $h$ and velocities $(u,v)$ as primary unknowns in a modal orthonormal basis on quadrilateral elements. Store bathymetry $b$ only as a cell-average $b[e]$. Compute volume integrals using a single Gauss–Legendre rule of order $p+1$ and surface integrals with midpoint fluxes, and discretize the source term by replacing $\\nabla b$ with a centered finite-difference reconstruction from neighboring cell-averages. Do not modify the Riemann solver at interfaces. Apply a Total Variation Diminishing (TVD) limiter directly to $\\eta = h + b$ nodal reconstructions after each time stage. The per-step cost is $\\mathcal{O}(N_e\\, p^2)$ and memory $\\mathcal{O}(N_e\\, p)$.\n\nC) Use the free-surface elevation $\\eta$ and momenta $(h u, h v)$ as modal fields on triangular elements with a hierarchical basis. Store bathymetry $b$ at interpolation points only on faces to reduce memory. Compute the source term by projecting $-g h \\nabla b$ onto degree $p$ using volume quadrature exact for degree $p$, and compute fluxes with a standard Rusanov solver with no hydrostatic reconstruction. Apply a positivity-preserving limiter to $h$ by clipping negative nodal values and adjusting $\\eta$ accordingly, but do not decompose into equilibrium and fluctuation. Assume sum-factorization to claim a per-step cost $\\mathcal{O}(N_e\\, p^3)$ and memory $\\mathcal{O}(N_e\\, p^2)$.\n\nD) Use water depth $h$ and momenta as primary fields but maintain a separate nodal field for the free-surface elevation $\\eta$ to support equilibrium detection. Store bathymetry at GLL nodes. Compute fluxes and sources using collocated GLL quadrature, and at faces use standard Harten–Lax–van Leer (HLL) fluxes without modification. Apply a TVB limiter to $(h u, h v)$ and a positivity-preserving limiter to $\\eta$ before evaluating the source term, to ensure nonnegativity. Complexity per step is $\\mathcal{O}(N_e\\, p^3)$ with sum-factorization, memory $\\mathcal{O}(N_e\\, p^2)$.\n\nWhich option satisfies all of the specified requirements?", "solution": "The user requires a critical validation of the problem statement, followed by a detailed derivation and evaluation of the provided options for constructing a well-balanced Discontinuous Galerkin (DG) scheme for the two-dimensional shallow water equations.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- **Governing Equations:** The two-dimensional shallow water equations with bathymetry are given in conservative form as $\\partial_t \\boldsymbol{U} + \\nabla \\cdot \\boldsymbol{F}(\\boldsymbol{U}) = \\boldsymbol{S}(\\boldsymbol{U},\\nabla b)$.\n- **State Vector:** $\\boldsymbol{U} = \\begin{bmatrix} h \\\\ h u \\\\ h v \\end{bmatrix}$, where $h$ is the water depth and $(u,v)$ is the velocity.\n- **Flux Tensor:** $\\boldsymbol{F}(\\boldsymbol{U}) = \\begin{bmatrix} h u & h v \\\\ h u^2 + \\tfrac{1}{2} g h^2 & h u v \\\\ h u v & h v^2 + \\tfrac{1}{2} g h^2 \\end{bmatrix}$, where $g$ is the gravitational acceleration.\n- **Source Term:** $\\boldsymbol{S}(\\boldsymbol{U},\\nabla b) = \\begin{bmatrix} 0 \\\\ - g h \\, \\partial_x b \\\\ - g h \\, \\partial_y b \\end{bmatrix}$, where $b$ is the bathymetry.\n- **Steady State:** The \"lake-at-rest\" steady state is defined by $u = 0$, $v = 0$, and $\\eta \\equiv h + b = \\eta_0$, where $\\eta_0$ is a constant free-surface elevation.\n- **Numerical Method:** A Discontinuous Galerkin (DG) method on a shape-regular mesh.\n- **Objective:** To select an algorithmic workflow that:\n    1. Is well-balanced for the lake-at-rest state at the semi-discrete level for smooth $b$ under exact quadrature.\n    2. Specifies data structures for variables, quadrature, and limiters.\n    3. Provides a correct leading-order complexity analysis per time step as a function of the number of elements $N_e$ and polynomial degree $p$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding:** The problem is firmly grounded in established principles of fluid dynamics (shallow water equations) and numerical analysis (Discontinuous Galerkin methods, well-balanced schemes). The equations, definitions, and concepts are standard in the field of computational hydraulics and numerical methods for hyperbolic balance laws. The problem is scientifically and mathematically sound.\n- **Well-Posedness:** The problem asks to identify a correct and consistent algorithmic description from a set of options. This is a well-defined task with a unique and meaningful solution based on established theory and practice in the specified field.\n- **Objectivity:** The language is precise, technical, and free of subjective or ambiguous terminology. All terms used have specific, formal meanings within the context of DG methods.\n- **Conclusion:** The problem statement does not violate any of the invalidity criteria. It is scientifically sound, well-posed, objective, self-contained, and non-trivial. It poses a valid and substantive question in computational science.\n\n**Step 3: Verdict and Action**\n- **Verdict:** The problem is **VALID**.\n- **Action:** Proceed with the solution and option evaluation.\n\n### Derivation of a Correct Workflow\n\nA well-balanced DG scheme for the shallow water equations must exactly preserve the lake-at-rest steady state, where the velocity is zero and the free-surface elevation $\\eta = h+b$ is constant. This state is characterized by a precise balance between the pressure gradient term arising from the flux divergence and the source term due to the bathymetry gradient.\n\nThe momentum equations can be rewritten to make this balance explicit. For the $x$-momentum, the flux divergence and source term combine:\n$$\n\\partial_x \\left( \\frac{1}{2} g h^2 \\right) - S_x = g h \\, \\partial_x h - (-g h \\, \\partial_x b) = g h (\\partial_x h + \\partial_x b) = g h \\, \\partial_x \\eta\n$$\nA numerical scheme is well-balanced if its discrete approximation of this term is zero when $\\eta$ is constant. This requires careful, consistent discretization of all components.\n\nA robust well-balanced DG scheme comprises the following key elements:\n\n1.  **Choice of Variables:** Using the free-surface elevation $\\eta$ and momentum components $(hu, hv)$ as the primary evolved polynomial variables is highly advantageous. In this formulation, the lake-at-rest condition simplifies to $\\eta$ being a constant polynomial and the momenta being zero polynomials within each element. This naturally leads to the term $g h \\, \\partial_x \\eta$ being zero within an element, as the derivative of a constant is zero.\n\n2.  **Discretization of Source and Flux Terms:** To maintain balance locally within an element, the discretization of the flux divergence and the source term must be compatible. A common and effective method for nodal DG schemes is to represent the bathymetry $b$ with a polynomial of the same degree $p$ as the solution, typically by storing its values at the solution nodes (e.g., Gauss-Legendre-Lobatto nodes). Then, the water depth $h = \\eta - b$ is also a polynomial of degree $p$. With this, terms like $g h \\, \\partial_x \\eta$ are computed. If $\\eta$ is represented as a constant, $\\partial_x \\eta$ is identically zero at all quadrature points, ensuring the balance.\n\n3.  **Interface Flux Treatment:** Standard approximate Riemann solvers (e.g., Rusanov, HLL, HLLC) will fail at interfaces. For a lake-at-rest state, $\\eta_L = \\eta_R = \\eta_0$, but if $b_L \\neq b_R$, then $h_L \\neq h_R$. A standard solver would see a jump in the pressure term $\\frac{1}{2} g h^2$ and generate a spurious momentum flux, destroying the steady state. This is corrected by a **hydrostatic reconstruction**. Before calling the Riemann solver, the left and right states $(\\boldsymbol{U}_L, \\boldsymbol{U}_R)$ are modified. A common reconstruction defines new water depths $h_L^* = \\eta_L - b^*$ and $h_R^* = \\eta_R - b^*$ where $b^*$ is a single, carefully chosen value for the bathymetry at the interface (e.g., $b^*=\\max(b_L, b_R)$). In the lake-at-rest state, this yields $h_L^* = h_R^*$. With equal depths and zero momenta, the Riemann solver for the homogeneous SWE correctly produces zero momentum flux across the interface.\n\n4.  **Limiting Strategy:** To handle shocks without corrupting the steady state, limiters must be applied in a well-balanced manner. Applying a standard TVD/TVB limiter to the conserved variables $(h, hu, hv)$ or the primitive variables will destroy the delicate $h+b=\\text{const}$ balance. The correct procedure is to decompose the solution $\\boldsymbol{U}$ into an equilibrium part $\\boldsymbol{U}_{eq}$ and a fluctuation $\\boldsymbol{U}'$. The equilibrium is typically defined element-wise by $\\eta_{eq} = \\overline{\\eta}$ (the cell average of $\\eta$) and zero momenta. The fluctuations are then $\\eta' = \\eta - \\eta_{eq}$ and $(hu)' = hu, (hv)' = hv$. The slope limiter is applied *only* to the fluctuations $\\boldsymbol{U}'$. The final limited solution is reconstructed by adding the equilibrium part back. This ensures that the limiter does not activate on the equilibrium state itself.\n\n5.  **Complexity and Data Structures:** For a 2D nodal DG scheme on a tensor-product quadrilateral mesh with $(p+1)$ nodes in each direction, efficient implementation relies on **sum-factorization**.\n    - **Memory:** Solution variables ($\\eta, hu, hv$), bathymetry ($b$), and geometric factors (Jacobian, metric terms) must be stored at each of the $N_e \\times (p+1)^2$ nodes. The dominant memory footprint is thus $\\mathcal{O}(N_e p^2)$.\n    - **Computational Cost:**\n        - **Volume terms:** Evaluating operators like divergence involves applying 1D differentiation matrices along each tensor direction. Using sum-factorization, this costs $\\mathcal{O}(p^3)$ per element, leading to a total volume cost of $\\mathcal{O}(N_e p^3)$.\n        - **Surface terms:** These involve computations on the $4$ faces of each element. Each face has $(p+1)$ quadrature points. The \"lifting\" operation, which communicates surface integrals to the volume, involves matrix-vector products of size $(p+1) \\times (p+1)$ on each face. This leads to a cost of $\\mathcal{O}(p^2)$ per element and a total surface cost of $\\mathcal{O}(N_e p^2)$.\n    - The total cost per time step is dominated by the volume term for $p>1$, scaling as $\\mathcal{O}(N_e p^3)$.\n\n### Option-by-Option Analysis\n\n**Option A)**\nThis option proposes a workflow that aligns perfectly with the principles derived above.\n- **Variables & Data Structures:** Correctly chooses $(\\eta, hu, hv)$ as nodal fields on GLL nodes, with bathymetry $b$ also stored as a nodal field. This is optimal.\n- **Discretization:** Correctly identifies the need for consistent discretization of source and flux terms to achieve balance.\n- **Interface Flux:** Correctly specifies the use of a hydrostatic reconstruction, providing a valid formula $h^\\pm = \\max(0, \\eta^\\pm - \\max(b^\\pm_L, b^\\pm_R))$, which is a standard and effective method.\n- **Limiter:** Correctly describes the state-of-the-art well-balanced limiting procedure: decomposition into equilibrium and fluctuation, limiting only the fluctuation, and subsequent reconstruction.\n- **Complexity:** Correctly states the volume cost as $\\mathcal{O}(N_e p^3)$, surface cost as $\\mathcal{O}(N_e p^2)$, and memory as $\\mathcal{O}(N_e p^2)$ for a nodal DG scheme on quads with sum-factorization.\n- **Verdict:** **Correct**.\n\n**Option B)**\nThis option contains multiple fundamental errors.\n- **Variables & Data Structures:** Using $(h, u, v)$ is suboptimal. Storing bathymetry $b$ as only a cell average ($p=0$ representation) is incompatible with a high-order ($p>0$) method and makes preserving a steady state with a sloped bottom impossible.\n- **Discretization:** Using a finite difference-style reconstruction for $\\nabla b$ is inconsistent with the DG framework and will not produce a well-balanced scheme.\n- **Interface Flux:** Explicitly states \"Do not modify the Riemann solver,\" which is a fatal flaw for a well-balanced scheme.\n- **Limiter:** The proposed limiting strategy is non-standard and does not use the required equilibrium-fluctuation decomposition.\n- **Complexity:** The memory complexity of $\\mathcal{O}(N_e p)$ is incorrect for a 2D method of polynomial degree $p$; it should be $\\mathcal{O}(N_e p^2)$.\n- **Verdict:** **Incorrect**.\n\n**Option C)**\nThis option also has several major flaws.\n- **Data Structures:** Storing bathymetry only on element faces is insufficient to balance the volume terms, which requires a representation of $b$ inside the element.\n- **Interface Flux:** Proposes a standard Rusanov solver with \"no hydrostatic reconstruction,\" which, as established, breaks the well-balanced property.\n- **Limiter:** Fails to use the equilibrium-fluctuation decomposition, which is necessary for a well-balanced limiter.\n- **Complexity:** Incorrectly applies the term \"sum-factorization\" to triangular elements, for which it is not designed, indicating a conceptual error. While fast methods for triangles exist, this justification is technically wrong.\n- **Verdict:** **Incorrect**.\n\n**Option D)**\nThis option contains critical errors in its core algorithmic choices.\n- **Variables & Data Structures:** The proposed variable set is redundant and awkward. More importantly, using $h$ as a primary variable complicates the well-balancing.\n- **Interface Flux:** Falls into the same trap as options B and C by using a standard, unmodified HLL flux, which is not well-balanced.\n- **Limiter:** Proposes a limiting strategy that does not incorporate the equilibrium-fluctuation decomposition and is therefore not well-balanced. Limiting $\\eta$ for positivity is also conceptually misguided; positivity applies to $h$.\n- **Verdict:** **Incorrect**.", "answer": "$$\\boxed{A}$$", "id": "3428781"}]}