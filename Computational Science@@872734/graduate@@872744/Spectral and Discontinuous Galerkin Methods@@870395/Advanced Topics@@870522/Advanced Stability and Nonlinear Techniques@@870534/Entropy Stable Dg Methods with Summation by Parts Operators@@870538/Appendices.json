{"hands_on_practices": [{"introduction": "The concept of entropy stability can seem abstract when presented theoretically. This first exercise provides a concrete, hands-on verification of the principle by guiding you through a step-by-step calculation. By applying a Strong Stability Preserving Runge-Kutta (SSPRK) time-stepper to a simple two-element Discontinuous Galerkin (DG) system with an entropy-stable flux, you will directly compute the change in discrete entropy and confirm that it is non-positive, grounding the theory in a tangible result [@problem_id:3384653].", "problem": "Consider the linear scalar conservation law $u_{t} + a\\,u_{x} = 0$ on a periodic domain partitioned into two uniform elements of length $h$, with piecewise constant unknowns (polynomial degree $p=0$). Use a discontinuous Galerkin (DG) spatial discretization written in Summation By Parts (SBP) form with diagonal mass matrix $M = h I$ and interface coupling via a symmetric Lax–Friedrichs (Rusanov) flux with dissipation parameter $\\alpha = |a|$. Take the strictly convex quadratic entropy $U(u) = \\tfrac{1}{2} u^{2}$ and its associated discrete entropy $S(u) = \\tfrac{1}{2} u^{\\top} M u$. Assume periodic boundary conditions and an upwind-biased choice consistent with $\\alpha = |a|$, which is known to yield an entropy stable flux for the quadratic entropy.\n\nLet $a = 1$ and $h = 1$. Initialize with the element-averaged state $u_{1}^{n} = 1$ and $u_{2}^{n} = 0$. Advance one time step using the third-order Strong Stability Preserving Runge–Kutta method (SSPRK(3)):\n- $u^{(1)} = u^{n} + \\Delta t\\,L(u^{n})$,\n- $u^{(2)} = \\tfrac{3}{4} u^{n} + \\tfrac{1}{4}\\big(u^{(1)} + \\Delta t\\,L(u^{(1)})\\big)$,\n- $u^{n+1} = \\tfrac{1}{3} u^{n} + \\tfrac{2}{3}\\big(u^{(2)} + \\Delta t\\,L(u^{(2)})\\big)$,\n\nwhere $L(\\cdot)$ denotes the SBP-DG semidiscrete operator with the entropy stable Rusanov flux. Choose the time step so that the Courant–Friedrichs–Lewy (CFL) number $\\lambda = a\\,\\Delta t/h$ equals $\\lambda = 1$.\n\nCompute the change in discrete entropy over this one SSPRK(3) time step,\n$\\Delta S \\equiv S(u^{n+1}) - S(u^{n})$,\nand verify that it is nonpositive. Provide the exact value of $\\Delta S$ (no rounding is required). Your final answer must be a single real number with no units.", "solution": "Start with the problem definition: PDE, domain, discretization.\nThe semi-discrete system is $M \\frac{d\\vec{u}}{dt} = \\vec{L}(\\vec{u})$.\nFor $p=0$ DG, this is a finite volume method: $h_k \\frac{du_k}{dt} + f^*_{k+1/2} - f^*_{k-1/2} = 0$.\nHere, $k \\in \\{1, 2\\}$, $h_k=h$.\nThe domain is periodic. For element $1$, interfaces are $1+1/2$ (right) and $1-1/2$ (left). The left neighbor is element $2$, right neighbor is element $2$.\nState at right interface: $u_L = u_1$, $u_R = u_2$. Flux is $f^*(u_1, u_2)$.\nState at left interface: $u_L = u_2$, $u_R = u_1$. Flux is $f^*(u_2, u_1)$.\nEquation for $u_1$: $h \\frac{du_1}{dt} + f^*(u_1, u_2) - f^*(u_2, u_1) = 0$.\nEquation for $u_2$: $h \\frac{du_2}{dt} + f^*(u_2, u_1) - f^*(u_1, u_2) = 0$.\nThis shows $\\frac{d}{dt}(u_1+u_2)=0$.\nThe numerical flux is the Rusanov flux for $f(u) = au$: $f^*(u_L, u_R) = \\frac{a u_L + a u_R}{2} - \\frac{\\alpha}{2}(u_R-u_L)$.\nGiven $\\alpha = |a|$ and $a=1$, this becomes $f^*(u_L, u_R) = \\frac{u_L + u_R}{2} - \\frac{1}{2}(u_R-u_L) = u_L$. This is the upwind flux.\nThus, $f^*(u_1, u_2) = u_1$ and $f^*(u_2, u_1) = u_2$.\nThe ODE system is:\n$h \\frac{du_1}{dt} + u_1 - u_2 = 0 \\implies \\frac{du_1}{dt} = \\frac{1}{h}(u_2-u_1)$.\n$h \\frac{du_2}{dt} + u_2 - u_1 = 0 \\implies \\frac{du_2}{dt} = \\frac{1}{h}(u_1-u_2)$.\nIn vector form, $\\frac{d\\vec{u}}{dt} = L(\\vec{u})$ where $\\vec{u} = \\begin{pmatrix} u_1 \\\\ u_2 \\end{pmatrix}$ and $L(\\vec{u}) = \\frac{1}{h} \\begin{pmatrix} -1  1 \\\\ 1  -1 \\end{pmatrix} \\vec{u}$.\nThe mass matrix is $M=hI$. The problem states the semi-discrete equations are in SBP form $M \\frac{d\\vec{u}}{dt} = \\text{...}$. My derivation is $\\frac{d\\vec{u}}{dt} = L(\\vec{u})$ with $M=I$, which is consistent since the problem states $M=hI$ and $h=1$. Let's be careful. The standard DG form is $\\int \\phi_i u_t ... = 0$. With $p=0$, $\\phi=1$, this gives $h \\frac{du_k}{dt} ... = 0$. So my derivation is correct. The problem's $L(\\cdot)$ in $u^{n+1} = ... + \\Delta t L(...)$ must be the right-hand side of $\\frac{d\\vec{u}}{dt} = L(\\vec{u})$. So my operator $L(\\vec{u})$ is the one to be used.\n\nGiven parameters $a=1$, $h=1$. This gives $L(\\vec{u}) = \\begin{pmatrix} -1  1 \\\\ 1  -1 \\end{pmatrix} \\vec{u}$.\nThe CFL number $\\lambda = a \\Delta t/h = 1 \\cdot \\Delta t/1 = 1$, so $\\Delta t=1$.\nInitial state: $\\vec{u}^n = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$.\n\nSSPRK(3) stages:\n1. $\\vec{u}^{(1)} = \\vec{u}^n + \\Delta t L(\\vec{u}^n)$.\n   $L(\\vec{u}^n) = \\begin{pmatrix} -1  1 \\\\ 1  -1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}$.\n   $\\vec{u}^{(1)} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} + 1 \\cdot \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$.\n\n2. $\\vec{u}^{(2)} = \\frac{3}{4} \\vec{u}^n + \\frac{1}{4}(\\vec{u}^{(1)} + \\Delta t L(\\vec{u}^{(1)}))$.\n   $L(\\vec{u}^{(1)}) = \\begin{pmatrix} -1  1 \\\\ 1  -1 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$.\n   $\\vec{u}^{(2)} = \\frac{3}{4} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} + \\frac{1}{4} \\left( \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} + 1 \\cdot \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} \\right) = \\frac{3}{4} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} + \\frac{1}{4} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$.\n\n3. $\\vec{u}^{n+1} = \\frac{1}{3} \\vec{u}^n + \\frac{2}{3}(\\vec{u}^{(2)} + \\Delta t L(\\vec{u}^{(2)}))$.\n   $\\vec{u}^{(2)} = \\vec{u}^n$, so $L(\\vec{u}^{(2)}) = L(\\vec{u}^n) = \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}$.\n   $\\vec{u}^{n+1} = \\frac{1}{3} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} + \\frac{2}{3} \\left( \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} + 1 \\cdot \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix} \\right) = \\frac{1}{3} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} + \\frac{2}{3} \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 1/3 \\\\ 2/3 \\end{pmatrix}$.\n\nEntropy calculation:\nDiscrete entropy is $S(\\vec{u}) = \\frac{1}{2}\\vec{u}^T M \\vec{u}$.\nWith $h=1$, $M=I$, so $S(\\vec{u}) = \\frac{1}{2} \\vec{u}^T \\vec{u} = \\frac{1}{2} (u_1^2 + u_2^2)$.\nInitial entropy: $S(\\vec{u}^n) = \\frac{1}{2}(1^2 + 0^2) = \\frac{1}{2}$.\nFinal entropy: $S(\\vec{u}^{n+1}) = \\frac{1}{2} \\left( (\\frac{1}{3})^2 + (\\frac{2}{3})^2 \\right) = \\frac{1}{2} \\left( \\frac{1}{9} + \\frac{4}{9} \\right) = \\frac{1}{2} \\frac{5}{9} = \\frac{5}{18}$.\nChange in entropy: $\\Delta S = S(\\vec{u}^{n+1}) - S(\\vec{u}^n) = \\frac{5}{18} - \\frac{1}{2} = \\frac{5}{18} - \\frac{9}{18} = -\\frac{4}{18} = -\\frac{2}{9}$.\nThe result $\\Delta S = -2/9$ is nonpositive, consistent with the entropy stability of the SSPRK scheme applied to an entropy stable semi-discretization under the appropriate CFL condition.", "answer": "$$\n\\boxed{-\\frac{2}{9}}\n$$", "id": "3384653"}, {"introduction": "A crucial insight in designing numerical methods for conservation laws is that a scheme's conservation property is not universal; it is specific to the chosen entropy function. This practice explores this subtlety by tasking you with implementing a Summation-By-Parts (SBP) scheme for the Burgers' equation that is designed to conserve the discrete $L^2$ energy, corresponding to the entropy $U(u) = \\frac{u^2}{2}$. Through this numerical experiment, you will observe that while the $L^2$ energy remains constant, a different convex entropy, such as $U(u) = \\frac{u^4}{4}$, is not conserved, demonstrating why the specific choice of entropy and a compatible numerical flux are fundamental to achieving a desired stability property [@problem_id:3384658].", "problem": "Consider the scalar inviscid Burgers equation on a periodic domain,\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(\\frac{u^2}{2}\\right) = 0,\n$$\nwith $x \\in [0,2\\pi)$ and periodic boundary conditions. Use a nodal Summation By Parts (SBP) discretization with a diagonal norm to construct a semi-discrete approximation that reveals distinct behavior of discrete $L^2$ energy and a non-quadratic entropy under the same numerical method. Specifically, adopt an equispaced partition of the domain into $N$ nodes with spacing $\\Delta x = \\frac{2\\pi}{N}$, a diagonal SBP norm $H = \\Delta x \\, I$, and a central difference SBP derivative operator $D$ which is skew-symmetric with respect to $H$, i.e.,\n$$\nH D + D^\\top H = 0.\n$$\nTo ensure high-quality discrete conservation properties, use a flux differencing (two-point) formulation with a symmetric, consistent two-point flux for Burgers,\n$$\nf_S(u_L,u_R) = \\frac{1}{6}\\left(u_L^2 + u_L u_R + u_R^2\\right),\n$$\nwhich satisfies $f_S(u,u) = \\frac{u^2}{2}$ and $f_S(u_L,u_R) = f_S(u_R,u_L)$.\n\nThe semi-discrete discretization is\n$$\n\\frac{d u_j}{d t} + \\frac{F_{j+\\frac{1}{2}} - F_{j-\\frac{1}{2}}}{\\Delta x} = 0, \\quad j = 0,\\ldots,N-1,\n$$\nwhere the numerical flux at cell interfaces is defined by\n$$\nF_{j+\\frac{1}{2}} = f_S(u_j,u_{j+1}),\n$$\nwith periodic indexing $u_N \\equiv u_0$ and $u_{-1} \\equiv u_{N-1}$. Evolve the semi-discrete system with the third-order Strong Stability Preserving Runge–Kutta method (SSP-RK3).\n\nDefine the discrete $L^2$ energy and a non-quadratic convex entropy by\n$$\nE(t) = \\sum_{j=0}^{N-1} \\Delta x \\, \\frac{u_j(t)^2}{2}, \\qquad U(u) = \\frac{u^4}{4}, \\qquad S(t) = \\sum_{j=0}^{N-1} \\Delta x \\, U\\big(u_j(t)\\big).\n$$\nFor the specified discretization, measure the changes\n$$\n\\Delta E = E(T) - E(0), \\qquad \\Delta S = S(T) - S(0),\n$$\nover a finite time interval $[0,T]$ for several initial conditions. Use an adaptive time step based on a Courant–Friedrichs–Lewy (CFL) condition $0  \\text{CFL} \\leq 0.3$:\n$$\n\\Delta t = \\text{CFL} \\frac{\\Delta x}{\\max_j |u_j|},\n$$\nwith the convention that if $\\max_j |u_j| = 0$, then $\\Delta t = \\text{CFL}\\,\\Delta x$.\n\nImplement the following test suite, covering smooth cases, multi-frequency cases, and a constant solution for a boundary condition check. For each test case, the initial condition is periodic and defined on $x_j = j \\Delta x$:\n1. $N = 128$, $T = 0.5$, $u(x,0) = 0.5 \\sin(x)$.\n2. $N = 128$, $T = 0.3$, $u(x,0) = 0.9 \\sin(2x)$.\n3. $N = 32$, $T = 0.4$, $u(x,0) = 0.3$ (constant state).\n4. $N = 256$, $T = 0.2$, $u(x,0) = 0.8 \\sin(x) + 0.2 \\sin(3x)$.\n\nYour program should compute $(\\Delta E, \\Delta S)$ for each case. The required final output format is a single line containing the results as a comma-separated list enclosed in square brackets, with values ordered as\n$[\\Delta E_1,\\Delta S_1,\\Delta E_2,\\Delta S_2,\\Delta E_3,\\Delta S_3,\\Delta E_4,\\Delta S_4]$.\nNo physical units are required since the problem is posed in non-dimensional form, and all angles are expressed in radians. All numbers in the output must be decimal floats.", "solution": "The user has provided a valid, well-posed problem in the field of numerical analysis for partial differential equations. The task is to implement a specific numerical scheme for the scalar inviscid Burgers' equation and to observe the evolution of two distinct quantities: the discrete $L^2$ energy and a non-quadratic entropy.\n\n### Problem Formulation\nThe governing partial differential equation (PDE) is the inviscid Burgers' equation:\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(\\frac{u^2}{2}\\right) = 0\n$$\nThis equation is solved on a one-dimensional periodic domain $x \\in [0, 2\\pi)$.\n\n### Spatial Discretization\nThe spatial domain is discretized using $N$ equispaced nodes $x_j = j \\Delta x$ for $j = 0, \\ldots, N-1$, with grid spacing $\\Delta x = 2\\pi/N$. The problem specifies a conservative finite difference (or flux-differencing) scheme for the semi-discretization:\n$$\n\\frac{d u_j}{dt} + \\frac{F_{j+\\frac{1}{2}} - F_{j-\\frac{1}{2}}}{\\Delta x} = 0\n$$\nwhere $u_j(t)$ is the numerical approximation to $u(x_j, t)$. Periodicity is handled by index arithmetic, e.g., $u_N = u_0$. The numerical flux $F_{j+\\frac{1}{2}}$ at the interface between nodes $j$ and $j+1$ is given by the specific two-point symmetric flux:\n$$\nF_{j+\\frac{1}{2}} = f_S(u_j, u_{j+1}) = \\frac{1}{6}\\left(u_j^2 + u_j u_{j+1} + u_{j+1}^2\\right)\n$$\nThis flux is consistent with the physical flux $f(u) = u^2/2$, since $f_S(u, u) = \\frac{1}{6}(u^2 + u^2 + u^2) = \\frac{u^2}{2}$.\n\n### Analysis of Discrete Conservation Properties\nThe core of the problem lies in analyzing how the chosen scheme affects two different quantities derived from the solution.\n\n#### 1. Discrete $L^2$ Energy\nThe discrete $L^2$ energy is defined as:\n$$\nE(t) = \\sum_{j=0}^{N-1} \\Delta x \\frac{u_j(t)^2}{2}\n$$\nThe rate of change of this energy under the semi-discrete scheme is:\n$$\n\\frac{dE}{dt} = \\sum_{j=0}^{N-1} \\Delta x \\, u_j \\frac{du_j}{dt} = \\sum_{j=0}^{N-1} u_j \\left( - (F_{j+\\frac{1}{2}} - F_{j-\\frac{1}{2}}) \\right) = -\\sum_{j=0}^{N-1} u_j (F_{j+\\frac{1}{2}} - F_{j-\\frac{1}{2}})\n$$\nUsing summation by parts on a periodic domain, this becomes:\n$$\n\\frac{dE}{dt} = \\sum_{j=0}^{N-1} (u_{j+1} - u_j) F_{j+\\frac{1}{2}}\n$$\nSubstituting the definition of the numerical flux $F_{j+\\frac{1}{2}}$:\n$$\n\\frac{dE}{dt} = \\sum_{j=0}^{N-1} (u_{j+1} - u_j) \\frac{1}{6}\\left(u_j^2 + u_j u_{j+1} + u_{j+1}^2\\right)\n$$\nUsing the identity $a^3 - b^3 = (a-b)(a^2+ab+b^2)$, the term inside the summation simplifies:\n$$\n\\frac{dE}{dt} = \\frac{1}{6} \\sum_{j=0}^{N-1} \\left(u_{j+1}^3 - u_j^3\\right)\n$$\nThis is a telescoping sum. Due to the periodic boundary conditions ($u_N = u_0$), the sum is zero:\n$$\n\\sum_{j=0}^{N-1} (u_{j+1}^3 - u_j^3) = (u_1^3 - u_0^3) + (u_2^3 - u_1^3) + \\ldots + (u_N^3 - u_{N-1}^3) = u_N^3 - u_0^3 = u_0^3 - u_0^3 = 0\n$$\nTherefore, $\\frac{dE}{dt} = 0$. The semi-discretization exactly conserves the discrete $L^2$ energy. Any computed change $\\Delta E = E(T) - E(0)$ will be solely due to the time-integration error and floating-point precision limitations.\n\n#### 2. Non-Quadratic Entropy\nA non-quadratic convex entropy is defined with $U(u) = u^4/4$. The total discrete entropy is:\n$$\nS(t) = \\sum_{j=0}^{N-1} \\Delta x \\, U(u_j) = \\sum_{j=0}^{N-1} \\Delta x \\frac{u_j(t)^4}{4}\n$$\nThe entropy variable associated with $U(u)$ is $v(u) = U'(u) = u^3$. The rate of change of the total entropy is:\n$$\n\\frac{dS}{dt} = \\sum_{j=0}^{N-1} \\Delta x \\, U'(u_j) \\frac{du_j}{dt} = -\\sum_{j=0}^{N-1} u_j^3 (F_{j+\\frac{1}{2}} - F_{j-\\frac{1}{2}})\n$$\nAgain, using summation by parts:\n$$\n\\frac{dS}{dt} = \\sum_{j=0}^{N-1} (u_{j+1}^3 - u_j^3) F_{j+\\frac{1}{2}} = \\sum_{j=0}^{N-1} (u_{j+1}^3 - u_j^3) \\frac{1}{6}\\left(u_j^2 + u_j u_{j+1} + u_{j+1}^2\\right)\n$$\nThis expression does not simplify to a telescoping sum and is not generally zero. Thus, the numerical scheme does not conserve the entropy $S(t)$. We expect $\\Delta S = S(T) - S(0)$ to be non-zero, its magnitude depending on the solution's properties and the grid resolution. This illustrates a key concept in designing numerical methods for conservation laws: a scheme may conserve one quantity (like energy) but not another (like a different entropy).\n\n### Time Integration\nThe semi-discrete system of ordinary differential equations is evolved in time using the third-order Strong Stability Preserving Runge-Kutta (SSP-RK3) method. For a system $\\frac{d\\mathbf{u}}{dt} = \\mathbf{L}(\\mathbf{u})$, one step from $t^n$ to $t^{n+1}=t^n+\\Delta t$ is:\n$$\n\\begin{align*}\n\\mathbf{u}^{(1)} = \\mathbf{u}^n + \\Delta t \\mathbf{L}(\\mathbf{u}^n) \\\\\n\\mathbf{u}^{(2)} = \\frac{3}{4} \\mathbf{u}^n + \\frac{1}{4} \\mathbf{u}^{(1)} + \\frac{1}{4} \\Delta t \\mathbf{L}(\\mathbf{u}^{(1)}) \\\\\n\\mathbf{u}^{n+1} = \\frac{1}{3} \\mathbf{u}^n + \\frac{2}{3} \\mathbf{u}^{(2)} + \\frac{2}{3} \\Delta t \\mathbf{L}(\\mathbf{u}^{(2)})\n\\end{align*}\n$$\nThe time step $\\Delta t$ is adapted at each step based on a CFL condition with $\\text{CFL} = 0.3$:\n$$\n\\Delta t = \\text{CFL} \\frac{\\Delta x}{\\max_j |u_j|}\n$$\nThe final step size is adjusted to ensure the simulation ends exactly at the final time $T$.\n\n### Implementation\nThe implementation proceeds by first setting up the spatial grid and initial condition for each test case. A time-stepping loop evolves the solution vector `u` until the final time $T$ is reached. Within the loop, the adaptive time step is computed, followed by one SSP-RK3 step. The spatial operator $\\mathbf{L}(\\mathbf{u})$ is implemented using vectorized `numpy` operations, leveraging `numpy.roll` for efficient handling of periodic boundary conditions. After the time evolution is complete, the final energy $E(T)$ and entropy $S(T)$ are computed and compared to their initial values to find $\\Delta E$ and $\\Delta S$.", "answer": "[-1.1102230246251565e-16,-0.0003050489958742468,0.0,-0.003923309062363162,0.0,0.0,0.0,-0.007621415053738019]", "id": "3384658"}, {"introduction": "High-order collocation methods, such as the Discontinuous Galerkin Spectral Element Method (DGSEM), can suffer from aliasing errors when dealing with nonlinear fluxes, leading to spurious entropy production and potential instability. This exercise delves into the mechanics of modern entropy-stable schemes by comparing a naive strong-form discretization with a more sophisticated flux-differencing approach [@problem_id:3384682]. By implementing both for the Burgers' equation, you will numerically verify that the flux-differencing formulation, equipped with an entropy-conservative two-point flux, eliminates the volume aliasing error at the semi-discrete level, providing a practical understanding of how these advanced methods ensure robustness.", "problem": "Consider the one-dimensional scalar conservation law $u_t + \\partial_x f(u) = 0$ on the reference interval $[-1,1]$ with periodic boundary conditions. Let $f(u)$ denote the physical flux. You will study the Discontinuous Galerkin Spectral Element Method (DGSEM) in collocation form using Summation-By-Parts (SBP) operators, and evaluate how volume aliasing is eliminated by flux differencing when a two-point entropy conservative flux is used. You will compare discrete entropy budgets computed under Gauss-Legendre-Lobatto (GLL) versus Gauss-Legendre (Gauss) quadrature rules.\n\nUse the inviscid Burgers equation, where $f(u) = \\frac{1}{2}u^2$. Equip it with the standard convex entropy $U(u) = \\frac{1}{2}u^2$, entropy variable $v(u) = U'(u) = u$, entropy flux $F(u) = \\frac{1}{3}u^3$, and flux potential $\\psi(u) = v(u) f(u) - F(u) = \\frac{1}{6}u^3$. For flux differencing, use the two-point entropy conservative flux\n$$\nf^{ec}(u_L,u_R) = \\frac{1}{6}\\left(u_L^2 + u_L u_R + u_R^2\\right).\n$$\n\nWork on a single spectral element on $[-1,1]$. For a chosen polynomial degree $N$, construct either $N+1$ Gauss-Legendre-Lobatto nodes and weights, or $N+1$ Gauss-Legendre nodes and weights. Build the SBP operators using:\n- the diagonal mass matrix $M = \\operatorname{diag}(w_1,\\dots,w_{N+1})$ with quadrature weights $w_i$,\n- the nodal differentiation matrix $D$ associated with Lagrange interpolation at the selected nodes,\n- the SBP operator $Q = M D$.\n\nDefine the periodic initial condition sampled at the collocation nodes to be\n$u(x) = a \\sin(\\pi x) + b \\cos(3\\pi x)$,\nwhere $a$ and $b$ are real parameters. For this $u$, evaluate the semi-discrete volume contributions to the entropy budget using two different formulations:\n\n1. The naive strong-form volume discretization:\n$$\n\\frac{d}{dt} \\sum_{i=1}^{N+1} w_i U(u_i) \\bigg|_{\\text{naive}} = - v^T Q f(u),\n$$\nwhere $u_i = u(x_i)$, $v_i = v(u_i)$, and $f(u_i) = \\frac{1}{2}u_i^2$.\n\n2. The flux-differencing volume discretization with the two-point entropy conservative flux:\n$$\n\\frac{d}{dt} \\sum_{i=1}^{N+1} w_i U(u_i) \\bigg|_{\\text{fd}} = -2 \\sum_{i=1}^{N+1}\\sum_{j=1}^{N+1} v_i \\, Q_{ij} \\, f^{ec}(u_i,u_j).\n$$\n\nUnder periodic boundary conditions, the entropy-conservative flux-differencing formulation is expected to produce a discrete entropy rate that is identically zero in exact arithmetic for the volume terms, while the naive strong form can produce nonzero discrete entropy production due to aliasing introduced by nonlinear fluxes evaluated at collocation points. You will numerically evaluate the magnitude of the discrete entropy rate in both formulations and compare behavior under GLL versus Gauss quadrature rules.\n\nImplement the following steps in a complete and runnable program:\n- Construct nodes and weights for both Gauss-Legendre-Lobatto quadrature (with $N+1$ points) and Gauss-Legendre quadrature (with $N+1$ points).\n- Compute the Lagrange nodal differentiation matrix $D$ via barycentric weights for the given nodes.\n- Form $M$ and $Q = M D$.\n- For each test case, sample $u(x)$ and compute:\n  - the absolute value of the naive strong-form discrete entropy rate $| - v^T Q f(u) |$ under GLL,\n  - the absolute value of the flux-differencing discrete entropy rate $| -2 \\sum_{i,j} v_i Q_{ij} f^{ec}(u_i,u_j) |$ under GLL,\n  - the same two absolute values computed under Gauss quadrature.\n\nDesign a test suite that explores variability in polynomial degree and nonlinearity amplitude:\n- Test case $1$ (happy path): $N=5$, $a=1.0$, $b=0.1$.\n- Test case $2$ (low degree boundary case): $N=1$, $a=1.0$, $b=0.5$.\n- Test case $3$ (high degree aliasing stress): $N=12$, $a=1.0$, $b=1.0$.\n- Test case $4$ (strong nonlinearity): $N=8$, $a=2.5$, $b=2.0$.\n\nFor each test case, your program must return a list of four floating-point numbers:\n- $| - v^T Q f(u) |$ under GLL,\n- $| -2 \\sum_{i,j} v_i Q_{ij} f^{ec}(u_i,u_j) |$ under GLL,\n- $| - v^T Q f(u) |$ under Gauss,\n- $| -2 \\sum_{i,j} v_i Q_{ij} f^{ec}(u_i,u_j) |$ under Gauss.\n\nYour program should produce a single line of output containing the results as a comma-separated list of these four-number lists for all test cases, enclosed in square brackets. That is, the final output must be of the form\n$$\n\\texttt{[[r_{11},r_{12},r_{13},r_{14}],[r_{21},r_{22},r_{23},r_{24}],[r_{31},r_{32},r_{33},r_{34}],[r_{41},r_{42},r_{43},r_{44}]]}\n$$\nwith all entries printed as standard Python floating-point literals. No physical units or angle units are involved in this problem; all quantities are dimensionless.", "solution": "The problem is assessed to be valid. It is scientifically grounded in the theory of numerical methods for conservation laws, well-posed with a unique computable-answer, and objectively formulated. All-necessary data and definitions are provided.\n\nThe objective is to numerically investigate a key property of modern Discontinuous Galerkin Spectral Element Methods (DGSEM): the role of flux differencing in achieving entropy stability. We compare a standard, or \"naive,\" strong-form discretization with an entropy-conservative flux-differencing formulation. The comparison is performed for the one-dimensional inviscid Burgers' equation, $u_t + \\partial_x (\\frac{1}{2}u^2) = 0$, on a single element with periodic boundary conditions, using both Gauss-Legendre-Lobatto (GLL) and Gauss-Legendre (Gauss) quadrature points.\n\n### 1. Continuous and Discrete Entropy Conservation\n\nFor a scalar conservation law $u_t + f(u)_x = 0$, the rate of change of a convex entropy function $U(u)$ is governed by the entropy inequality $U(u)_t + F(u)_x \\le 0$, where $F(u)$ is the entropy flux, defined by $F'(u) = U'(u)f'(u)$. For the smooth solutions considered at the semi-discrete level, this holds as an equality, $U(u)_t + F(u)_x = 0$. Integrating over a domain $[-1, 1]$ gives\n$$\n\\frac{d}{dt} \\int_{-1}^1 U(u) \\, dx = - \\int_{-1}^1 F(u)_x \\, dx = -[F(u(1)) - F(u(-1))]\n$$\nFor periodic boundary conditions, $u(-1) = u(1)$, which implies $F(u(-1)) = F(u(1))$, and thus the total entropy is conserved.\n\nA numerical scheme is deemed entropy-conservative if it satisfies a discrete analogue of this conservation property. We approximate the solution as a polynomial of degree $N$ and represent it by its values $u_i$ at a set of $N+1$ collocation points $x_i$. The total discrete entropy is $\\mathcal{U} = \\sum_{i=1}^{N+1} w_i U(u_i)$, where $w_i$ are the quadrature weights.\n\nThe DGSEM-SBP formulation uses a discrete differentiation operator $D$ and a diagonal mass matrix $M = \\operatorname{diag}(w_i)$ to form a Summation-By-Parts (SBP) operator $Q=MD$. A key property of such operators is $Q+Q^T=B$, where $B$ is a boundary matrix with non-zero entries only corresponding to the domain endpoints. For GLL nodes, $B=\\operatorname{diag}(-1, 0, \\dots, 0, 1)$. For any SBP operator, we also have $D\\mathbf{1}=\\mathbf{0}$, which implies $Q\\mathbf{1}=\\mathbf{0}$.\n\n### 2. Analysis of the Naive Strong-Form Discretization\n\nThe semi-discretization in strong form is $\\frac{d u_h}{dt} = -D f(u_h)$, where $u_h$ is the vector of nodal values. The rate of change of total discrete entropy is:\n$$\n\\frac{d\\mathcal{U}}{dt} = \\frac{d}{dt} \\sum_i w_i U(u_i) = \\sum_i w_i U'(u_i) \\frac{du_i}{dt} = v^T M \\frac{du_h}{dt}\n$$\nwhere $v_i = U'(u_i)$ is the entropy variable. For Burgers' equation with $U(u) = \\frac{1}{2}u^2$, we have $v(u)=u$. Substituting the semi-discretization, we get the expression to be evaluated:\n$$\n\\frac{d\\mathcal{U}}{dt} \\bigg|_{\\text{naive}} = v^T M (-D f(u_h)) = -v^T Q f(u_h)\n$$\nThis formulation is generally not entropy-conservative. The product $v^T Q f(u_h)$ is a discrete approximation of the integral $\\int_{-1}^1 v(u) \\partial_x f(u) \\, dx$. The term $f(u_h)$ involves a nonlinear function of $u_h$. If $u_h$ is represented by a polynomial of degree $N$, $f(u_h) = \\frac{1}{2}u_h^2$ is a polynomial of degree $2N$. The overall expression involves a product of terms whose polynomial degree can exceed the degree for which the underlying quadrature rule ($GLL$ or $Gauss$) is exact. This inexactness in the discrete integration, known as aliasing, leads to a non-zero entropy production rate, violating the conservation principle.\n\n### 3. Analysis of the Flux-Differencing Discretization\n\nThe flux-differencing approach re-formulates the spatial operator to build in the conservation property. The rate of change of total discrete entropy is given as:\n$$\n\\frac{d\\mathcal{U}}{dt} \\bigg|_{\\text{fd}} = -2 \\sum_{i=1}^{N+1}\\sum_{j=1}^{N+1} v_i \\, Q_{ij} \\, f^{ec}(u_i,u_j)\n$$\nwhere $f^{ec}(u_L, u_R)$ is a two-point entropy-conservative flux. It is symmetric, $f^{ec}(u_L, u_R) = f^{ec}(u_R, u_L)$, and consistent, $f^{ec}(u,u) = f(u)$. Most importantly, it satisfies the relationship $(v(u_L) - v(u_R))f^{ec}(u_L, u_R) = \\psi(u_L) - \\psi(u_R)$, where $\\psi(u)$ is the entropy flux potential.\n\nTo show this formulation is conservative, we manipulate the double summation. We use the identity $2v_i = (v_i+v_j) + (v_i-v_j)$.\n$$\n\\begin{aligned}\n\\sum_{i,j} v_i Q_{ij} f^{ec}(u_i, u_j) = \\frac{1}{2} \\sum_{i,j} \\left( v_i Q_{ij} f^{ec}(u_i, u_j) + v_j Q_{ji} f^{ec}(u_j, u_i) \\right) \\quad (\\text{by swapping indices } i,j) \\\\\n= \\frac{1}{2} \\sum_{i,j} \\left( v_i Q_{ij} + v_j Q_{ji} \\right) f^{ec}(u_i, u_j) \\quad (\\text{by symmetry of } f^{ec})\n\\end{aligned}\n$$\nUsing the SBP property in a skew-symmetric form for the volume, suitable for periodic problems, $Q_{ji} \\approx -Q_{ij}$, the term becomes:\n$$\n\\frac{1}{2} \\sum_{i,j} (v_i-v_j) Q_{ij} f^{ec}(u_i,u_j) = \\frac{1}{2} \\sum_{i,j} Q_{ij} (v_i-v_j) f^{ec}(u_i,u_j)\n$$\nUsing the property of the EC flux, $(v_i-v_j)f^{ec}(u_i,u_j) = \\psi_i - \\psi_j$:\n$$\n= \\frac{1}{2} \\sum_{i,j} Q_{ij} (\\psi_i - \\psi_j) = \\frac{1}{2} \\left( \\sum_{i,j} Q_{ij}\\psi_i - \\sum_{i,j} Q_{ij}\\psi_j \\right)\n$$\nThe first sum is $\\sum_i \\psi_i \\left( \\sum_j Q_{ij} \\right)$. Since $Q\\mathbf{1}=\\mathbf{0}$, the row sums $\\sum_j Q_{ij}$ are zero. This term vanishes. The second sum is $\\sum_j \\psi_j \\left( \\sum_i Q_{ij} \\right)$. This is $\\sum_j \\psi_j (\\mathbf{1}^T Q)_j = \\psi^T (Q^T\\mathbf{1})$. From $Q+Q^T=B$ and $Q\\mathbf{1}=0$, we have $Q^T\\mathbf{1}=(B-Q)\\mathbf{1}=B\\mathbf{1}-Q\\mathbf{1}=B\\mathbf{1}$.\nThus, the sum evaluates to:\n$$\n\\frac{d\\mathcal{U}}{dt} \\bigg|_{\\text{fd}} = -2 \\left( -\\frac{1}{2} \\psi^T B \\mathbf{1} \\right) = \\psi^T B \\mathbf{1}\n$$\nFor GLL nodes, $B\\mathbf{1}$ is the vector $[ -1, 0, \\dots, 0, 1 ]^T$. This gives $\\psi^T B \\mathbf{1} = \\psi_{N+1} - \\psi_1$. A similar result holds for Gauss-based SBP operators, where the boundary operator $B$ extracts values at the element boundaries. For periodic boundary conditions, $u(-1)=u(1)$, which means $u_1=u_{N+1}$ and thus $\\psi_1 = \\psi_{N+1}$. The boundary term cancels, and the entropy rate is identically zero. This holds for both GLL and Gauss-based SBP operators, irrespective of the polynomial degree.\n\n### 4. Implementation and Expected Results\n\nThe implementation calculates these two rates for the given test cases.\n- **Naive Rate**: Expected to be non-zero due to aliasing, demonstrating a failure to conserve entropy. The magnitude of this error may be smaller for Gauss quadrature than GLL, as Gauss rules are exact for higher degree polynomials.\n- **Flux-Differencing Rate**: Expected to be zero (or within machine precision) for all cases, demonstrating the success of the entropy-conservative formulation.\n\nThe code will perform the following for each test case:\n1.  Generate nodes ($x_i$) and weights ($w_i$) for GLL and Gauss quadratures for a given degree $N$.\n2.  Construct the barycentric differentiation matrix $D$ for these nodes.\n3.  Form the mass matrix $M=\\operatorname{diag}(w_i)$ and SBP operator $Q=MD$.\n4.  Sample the initial condition $u(x) = a \\sin(\\pi x) + b \\cos(3\\pi x)$ at the nodes.\n5.  Compute the naive entropy rate, $|-v^T Q f(u)|$.\n6.  Compute the flux-differencing entropy rate, $|-2 \\sum_{i,j} v_i Q_{ij} f^{ec}(u_i,u_j)|$.\n7.  Return these four values (two for GLL, two for Gauss) for each test case.", "answer": "[[1.5746356795499236e-15,1.7763568394002505e-15,0.015099399127393444,8.881784197001252e-16],[0.3702133104381738,1.3877787807814457e-16,0.2221389814421453,2.220446049250313e-16],[10.133664053915093,1.5987211554602254e-14,7.039265218451842,5.329070518200751e-15],[52.28785721833593,5.684341886080802e-14,35.04543788730873,2.842170943040401e-14]]", "id": "3384682"}]}