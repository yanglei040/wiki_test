{"hands_on_practices": [{"introduction": "The most direct and classic evidence for nuclear shell structure comes from systematic trends in fundamental nuclear properties. This practice guides you through the analysis of three complementary experimental signatures of the well-established $Z=50$ proton shell closure: a sharp discontinuity in two-proton separation energies ($S_{2p}$), an unusually high first excited $2^+$ state energy ($E(2^+)$), and an anomaly in mirror displacement energies. By combining these observables, you will construct a composite, quantitative score that captures the strength of this magic number [@problem_id:3558348].", "problem": "You are given synthetic, self-consistent binding energy data to analyze proton shell closures using two-proton separation energies across several isotonic chains, and to compare the inferred closure with even-even first excited quadrupole state energies and mirror displacement energy systematics. Work from the following foundational bases: the definition of nuclear binding energy, the definition of separation energy as an energy difference, and the fact that shell closures manifest as enhanced curvature (a “kink”) in separation-energy systematics, as well as large first $2^{+}$ excitation energies in even-even nuclei and anomalous trends in mirror displacement energies due to changes in charge radii and level spacings.\n\nDefinitions:\n- The nuclear binding energy $B(Z,N)$ is the energy required to separate a nucleus into its constituent $Z$ protons and $N$ neutrons.\n- The two-proton separation energy is $S_{2p}(Z,N)=B(Z,N)-B(Z-2,N)$.\n- A discrete second difference in a sequence $f(z)$ at $z=z_{0}$ is $\\Delta^{(2)} f(z_{0})=f(z_{0}+2)-2 f(z_{0})+f(z_{0}-2)$, which detects local curvature (“kinks”).\n\nData set A (binding energies at fixed neutron numbers for even $Z$; all $B$ in $\\mathrm{MeV}$):\n- For $N=78$:\n  - $B(46,78)=973.0$, $B(48,78)=985.9$, $B(50,78)=998.1$, $B(52,78)=1006.0$, $B(54,78)=1013.2$.\n- For $N=80$:\n  - $B(46,80)=989.0$, $B(48,80)=1002.2$, $B(50,80)=1014.7$, $B(52,80)=1022.8$, $B(54,80)=1030.2$.\n- For $N=82$:\n  - $B(46,82)=1005.0$, $B(48,82)=1018.5$, $B(50,82)=1031.3$, $B(52,82)=1039.7$, $B(54,82)=1047.3$.\n- For $N=84$:\n  - $B(46,84)=1021.0$, $B(48,84)=1034.8$, $B(50,84)=1047.8$, $B(52,84)=1056.5$, $B(54,84)=1064.5$.\n\nData set B (even-even first $2^{+}$ excitation energies, all in $\\mathrm{MeV}$, at $N=82$):\n- $E_{2^{+}}(Z=48,N=82)=1.20$, $E_{2^{+}}(Z=50,N=82)=4.10$, $E_{2^{+}}(Z=52,N=82)=1.25$.\n\nData set C (mirror binding energies for isobaric pairs with isospin $T=\\frac{1}{2}$ near $Z\\approx 50$; all $B$ in $\\mathrm{MeV}$):\n- For $A=97$ (pairs $(Z,N)=(49,48)$ and $(48,49)$): $B(49,48)=824.0$, $B(48,49)=832.0$.\n- For $A=101$ (pairs $(Z,N)=(51,50)$ and $(50,51)$): $B(51,50)=860.5$, $B(50,51)=869.5$.\n- For $A=105$ (pairs $(Z,N)=(53,52)$ and $(52,53)$): $B(53,52)=896.0$, $B(52,53)=904.2$.\n\nTasks:\n1. Using data set A, compute $S_{2p}(Z,N)$ for $Z\\in\\{48,50,52\\}$ and $N\\in\\{78,80,82,84\\}$. Then compute, for each $N$, the discrete second difference at $Z=50$,\n   $$\\Delta^{(2)} S_{2p}(Z=50,N)=S_{2p}(52,N)-2\\,S_{2p}(50,N)+S_{2p}(48,N).$$\n   Average these four values over $N$ to obtain $C_{S}$. Define the separation-energy closure strength as $Q_{S}=-C_{S}$.\n2. Using data set B, compute the curvature of the first $2^{+}$ excitation energy at $Z=50$,\n   $$C_{E}=E_{2^{+}}(50,82)-\\frac{E_{2^{+}}(48,82)+E_{2^{+}}(52,82)}{2}.$$\n   Define the $E_{2^{+}}$ closure strength as $Q_{E}=C_{E}$.\n3. Define the mirror displacement energy (MDE) for $T=\\frac{1}{2}$ mirror pairs at fixed $A$ as\n   $$\\Delta_{\\mathrm{MDE}}(A)=B(Z+1,Z)-B(Z,Z+1),\\quad A=2Z+1.$$\n   Using data set C, compute $\\Delta_{\\mathrm{MDE}}(97)$, $\\Delta_{\\mathrm{MDE}}(101)$, and $\\Delta_{\\mathrm{MDE}}(105)$. Then form the anomaly curvature at $A=101$,\n   $$C_{M}=\\Delta_{\\mathrm{MDE}}(101)-\\frac{\\Delta_{\\mathrm{MDE}}(97)+\\Delta_{\\mathrm{MDE}}(105)}{2}.$$\n   Define the mirror-energy closure strength as $Q_{M}=-C_{M}$.\n4. The composite, dimensionally homogeneous closure score is defined as\n   $$Q=Q_{S}+Q_{E}+Q_{M}.$$\n   This $Q$ aggregates the kink in two-proton separation energies, the high $2^{+}$ excitation energy, and the mirror displacement energy anomaly into a single quantitative measure of a proton shell closure centered at $Z=50$.\n5. Identify, from the signs and magnitudes of $C_{S}$, $C_{E}$, and $C_{M}$, the proton shell closure suggested by these systematics. Then compute and report the single numeric value $Q$. Express the final energy in $\\mathrm{MeV}$ and round your answer to three significant figures. Do not include units in your final boxed answer.", "solution": "The problem requires the calculation of a composite closure score, $Q$, which aggregates three independent experimental signatures of a nuclear shell closure at proton number $Z=50$. The calculation proceeds by analyzing synthetic data for binding energies, first $2^+$ excitation energies, and mirror displacement energies. The analysis is performed in a series of sequential tasks.\n\nFirst, as part of Task 5, we identify the proton shell closure. A key signature of a shell closure at a proton number $Z_0$ is a sharp drop in the two-proton separation energy, $S_{2p}$, for nuclei with $Z > Z_0$. The second-difference analysis is designed to detect this \"kink\". A negative second difference, $C_S0$, at $Z_0$ indicates such a feature. Another signature is an anomalously high energy for the first excited $2^+$ state, $E_{2^+}$, in even-even nuclei at the magic number $Z_0$. This corresponds to a large positive curvature, $C_E > 0$. Finally, changes in nuclear charge radii at a shell closure cause an anomaly in the otherwise smooth trend of mirror displacement energies, $\\Delta_{\\mathrm{MDE}}$, leading to a non-zero curvature $C_M$. The signs of the calculated quantities $C_S$, $C_E$, and $C_M$ will confirm the presence and location of the shell closure being investigated. The problem centers all calculations on $Z=50$, implicitly postulating the closure is there. The calculations will verify this postulate.\n\nThe solution will now proceed through the specified computational tasks.\n\n**Task 1: Calculation of the Separation-Energy Closure Strength $Q_S$**\n\nThe two-proton separation energy is defined as $S_{2p}(Z,N)=B(Z,N)-B(Z-2,N)$. We compute this for $Z\\in\\{48,50,52\\}$ across the four isotonic chains ($N=78, 80, 82, 84$). All energies are in $\\mathrm{MeV}$.\n\nFor $N=78$:\n$S_{2p}(48,78) = B(48,78) - B(46,78) = 985.9 - 973.0 = 12.9$\n$S_{2p}(50,78) = B(50,78) - B(48,78) = 998.1 - 985.9 = 12.2$\n$S_{2p}(52,78) = B(52,78) - B(50,78) = 1006.0 - 998.1 = 7.9$\n\nFor $N=80$:\n$S_{2p}(48,80) = B(48,80) - B(46,80) = 1002.2 - 989.0 = 13.2$\n$S_{2p}(50,80) = B(50,80) - B(48,80) = 1014.7 - 1002.2 = 12.5$\n$S_{2p}(52,80) = B(52,80) - B(50,80) = 1022.8 - 1014.7 = 8.1$\n\nFor $N=82$:\n$S_{2p}(48,82) = B(48,82) - B(46,82) = 1018.5 - 1005.0 = 13.5$\n$S_{2p}(50,82) = B(50,82) - B(48,82) = 1031.3 - 1018.5 = 12.8$\n$S_{2p}(52,82) = B(52,82) - B(50,82) = 1039.7 - 1031.3 = 8.4$\n\nFor $N=84$:\n$S_{2p}(48,84) = B(48,84) - B(46,84) = 1034.8 - 1021.0 = 13.8$\n$S_{2p}(50,84) = B(50,84) - B(48,84) = 1047.8 - 1034.8 = 13.0$\n$S_{2p}(52,84) = B(52,84) - B(50,84) = 1056.5 - 1047.8 = 8.7$\n\nNext, we compute the discrete second difference $\\Delta^{(2)} S_{2p}(Z=50,N)=S_{2p}(52,N)-2\\,S_{2p}(50,N)+S_{2p}(48,N)$ for each $N$:\n$\\Delta^{(2)} S_{2p}(50,78) = 7.9 - 2(12.2) + 12.9 = 7.9 - 24.4 + 12.9 = -3.6$\n$\\Delta^{(2)} S_{2p}(50,80) = 8.1 - 2(12.5) + 13.2 = 8.1 - 25.0 + 13.2 = -3.7$\n$\\Delta^{(2)} S_{2p}(50,82) = 8.4 - 2(12.8) + 13.5 = 8.4 - 25.6 + 13.5 = -3.7$\n$\\Delta^{(2)} S_{2p}(50,84) = 8.7 - 2(13.0) + 13.8 = 8.7 - 26.0 + 13.8 = -3.5$\n\nThe average curvature $C_S$ is the mean of these values:\n$$C_S = \\frac{(-3.6) + (-3.7) + (-3.7) + (-3.5)}{4} = \\frac{-14.5}{4} = -3.625 \\, \\mathrm{MeV}$$\nThe strongly negative value of $C_S$ indicates a significant kink at $Z=50$, characteristic of a shell closure.\nThe separation-energy closure strength is $Q_S = -C_S$:\n$$Q_S = -(-3.625) = 3.625 \\, \\mathrm{MeV}$$\n\n**Task 2: Calculation of the $E_{2^{+}}$ Closure Strength $Q_E$**\n\nThe curvature of the first $2^{+}$ excitation energy at $Z=50$ for the $N=82$ isotones is given by $C_{E}=E_{2^{+}}(50,82)-\\frac{E_{2^{+}}(48,82)+E_{2^{+}}(52,82)}{2}$. Using the provided data from Data set B:\n$$C_{E} = 4.10 - \\frac{1.20 + 1.25}{2} = 4.10 - \\frac{2.45}{2} = 4.10 - 1.225 = 2.875 \\, \\mathrm{MeV}$$\nThe large positive value of $C_E$ reflects the exceptionally high $E_{2^+}$ energy at $Z=50$, a classic signature of a magic nucleus.\nThe $E_{2^{+}}$ closure strength is $Q_E = C_E$:\n$$Q_E = 2.875 \\, \\mathrm{MeV}$$\n\n**Task 3: Calculation of the Mirror-Energy Closure Strength $Q_M$**\n\nThe mirror displacement energy (MDE) is given by $\\Delta_{\\mathrm{MDE}}(A)=B(Z+1,Z)-B(Z,Z+1)$ for isobaric mass $A=2Z+1$. We compute this for the three given isobaric pairs from Data set C.\n\nFor $A=97$, $Z=48$:\n$\\Delta_{\\mathrm{MDE}}(97) = B(49,48) - B(48,49) = 824.0 - 832.0 = -8.0 \\, \\mathrm{MeV}$\n\nFor $A=101$, $Z=50$:\n$\\Delta_{\\mathrm{MDE}}(101) = B(51,50) - B(50,51) = 860.5 - 869.5 = -9.0 \\, \\mathrm{MeV}$\n\nFor $A=105$, $Z=52$:\n$\\Delta_{\\mathrm{MDE}}(105) = B(53,52) - B(52,53) = 896.0 - 904.2 = -8.2 \\, \\mathrm{MeV}$\n\nThe anomaly curvature at $A=101$ (which straddles the $Z=50$ shell) is $C_{M}=\\Delta_{\\mathrm{MDE}}(101)-\\frac{\\Delta_{\\mathrm{MDE}}(97)+\\Delta_{\\mathrm{MDE}}(105)}{2}$:\n$$C_{M} = -9.0 - \\frac{(-8.0) + (-8.2)}{2} = -9.0 - \\frac{-16.2}{2} = -9.0 - (-8.1) = -0.9 \\, \\mathrm{MeV}$$\nThe negative value of $C_M$ indicates an anomaly in the MDE trend around $Z=50$.\nThe mirror-energy closure strength is $Q_M = -C_M$:\n$$Q_M = -(-0.9) = 0.9 \\, \\mathrm{MeV}$$\n\n**Task 4 and 5: Calculation of the Composite Closure Score $Q$**\n\nThe three independent metrics, $Q_S > 0$, $Q_E > 0$, and $Q_M > 0$, all consistently indicate the presence of a strong proton shell closure at $Z=50$. We now combine them into the composite, dimensionally homogeneous closure score $Q = Q_{S}+Q_{E}+Q_{M}$:\n$$Q = 3.625 + 2.875 + 0.9 = 7.4 \\, \\mathrm{MeV}$$\nThe problem requires the final answer to be rounded to three significant figures. The exact value is $7.4$. To express this with three significant figures, we write $7.40$.\n\nFinal numeric value:\n$$Q = 7.40 \\, \\mathrm{MeV}$$", "answer": "$$\\boxed{7.40}$$", "id": "3558348"}, {"introduction": "Beyond bulk properties, the microscopic foundation of the shell model lies in the single-particle nature of nucleons occupying discrete orbitals. This exercise simulates the analysis of a neutron-adding $(d,p)$ transfer reaction, a primary experimental tool used to probe the character of these orbitals. You will learn to extract the spectroscopic factor, $C^2S$, from a measured angular distribution by fitting it with a reaction model, providing a quantitative link between experimental data and the theoretical shell-model picture of nuclear structure [@problem_id:3558390].", "problem": "Consider neutron-adding transfer reactions of the type $(d,p)$ used to probe single-particle structure around a putative shell gap. In the one-step factorization widely used in transfer reaction analysis, the measured differential cross section at angle $\\theta$ is modeled as\n$$\n\\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{meas}}(\\theta) \\approx C^2S \\times \\sigma_{\\text{sp}}(\\theta),\n$$\nwhere $C^2S$ is the spectroscopic factor (dimensionless) for the populated state and $\\sigma_{\\text{sp}}(\\theta)$ is the single-particle cross section (in millibarn per steradian, denoted $\\text{mb/sr}$) computed in a chosen reaction framework. Two standard frameworks are the Distorted Wave Born Approximation (DWBA) and the Adiabatic Distorted Wave Approximation (ADWA). To isolate the role of angular momentum transfer $l$ in the angular distribution, assume the following simplified, l-dependent “toy” single-particle model that captures the dominant shape variation with $l$:\n$$\n\\sigma_{\\text{sp}}^{(\\text{method})}(\\theta; l) = D_{\\text{method}} \\, M_l \\, \\left[P_l\\big(\\cos(\\theta_{\\text{rad}})\\big)\\right]^2,\n$$\nwhere $P_l$ is the Legendre polynomial of degree $l$, $\\theta_{\\text{rad}}$ is the scattering angle in radians, $M_l$ is an $l$-dependent scale (in $\\text{mb/sr}$), and $D_{\\text{method}}$ is a method-dependent renormalization factor (dimensionless) that encodes global distortions. Use $D_{\\text{DWBA}}=1.0$ and $D_{\\text{ADWA}}=0.85$. The transfer is assumed to populate a single state characterized by a known $l$, and the measured angular distribution is provided at a small set of laboratory angles. You are to extract $C^2S$ by a weighted linear least-squares fit of the model to the measurements for each method independently, and then compare the extracted $C^2S$ (from ADWA) to shell-model predictions for $C^2S$ for the same state.\n\nFundamental base to use:\n- Linear response and Born approximation reasoning: the measured amplitude is proportional to a single-particle amplitude, with proportionality given by the spectroscopic factor.\n- Weighted least squares as the statistically efficient linear estimator under independent Gaussian errors: given data $\\{(\\theta_i, y_i, \\delta y_i)\\}$ and a model $y_i \\approx a \\, m_i$ with known $m_i$, the best-fit amplitude $a$ minimizes $\\sum_i w_i (y_i - a m_i)^2$ with $w_i = 1/(\\delta y_i)^2$.\n\nYour task:\n1) For each test case listed below, compute the single-particle model values $m_i = \\sigma_{\\text{sp}}^{(\\text{method})}(\\theta_i; l)$ at the provided angles for each method (DWBA and ADWA). Angles are given in degrees and must be converted to radians when evaluating $P_l(\\cos\\theta)$.\n2) Perform a weighted linear least-squares fit to determine $C^2S$ (the amplitude $a$) for each method separately:\n   - Inputs: measured values $y_i$ in $\\text{mb/sr}$ and their standard uncertainties $\\delta y_i$ in $\\text{mb/sr}$.\n   - Output: best-fit $C^2S$ (dimensionless) and the unweighted root-mean-square (RMS) residual,\n     $$\n     \\text{RMS} = \\sqrt{\\frac{1}{N}\\sum_{i=1}^N \\left(y_i - C^2S \\cdot m_i\\right)^2},\n     $$\n     expressed in $\\text{mb/sr}$, where $N$ is the number of angles in the test case.\n3) For each test case, compare the ADWA-extracted $C^2S$ to the provided shell-model prediction $\\left(C^2S\\right)_{\\text{SM}}$. Report whether the relative deviation is within a tolerance of $0.15$ (fifteen percent expressed as a decimal), i.e.,\n   $$\n   \\frac{\\left|C^2S_{\\text{ADWA}} - \\left(C^2S\\right)_{\\text{SM}}\\right|}{\\left(C^2S\\right)_{\\text{SM}}} \\le 0.15.\n   $$\n   Return a boolean for this comparison.\n\nPhysical and numerical units:\n- Cross sections must be treated in $\\text{mb/sr}$.\n- Angles are provided in degrees; use radians when evaluating trigonometric functions.\n- Spectroscopic factors $C^2S$ are dimensionless.\n\nTest suite:\nUse the following three test cases. In all cases, the angle grid is $\\theta = [10,20,30,40,50]$ degrees, i.e., $\\theta = [10,20,30,40,50]$ in degrees, with the understanding that trigonometric evaluations use radians. The state’s angular momentum $l$ and the model scale $M_l$ are case-specific. Uncertainties are one standard deviation.\n\n- Case A (near a closed shell, $l=3$ “$f$-like” transfer):\n  - $l = 3$, $M_3 = 60.0$ $\\text{mb/sr}$.\n  - Angles (degrees): $[10,20,30,40,50]$.\n  - Measured $\\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{meas}}$ in $\\text{mb/sr}$: $[38.0567,\\,20.2910,\\,4.8412,\\,0.02923,\\,4.1371]$.\n  - Uncertainties $\\delta y$ in $\\text{mb/sr}$: $[0.5,\\,0.3,\\,0.1,\\,0.02,\\,0.1]$.\n  - Shell-model predicted $C^2S$: $0.88$.\n\n- Case B (fragmented strength scenario, $l=1$ “$p$-like” transfer):\n  - $l = 1$, $M_1 = 12.0$ $\\text{mb/sr}$.\n  - Angles (degrees): $[10,20,30,40,50]$.\n  - Measured $\\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{meas}}$ in $\\text{mb/sr}$: $[3.462,\\,3.153,\\,2.678,\\,2.095,\\,1.475]$.\n  - Uncertainties $\\delta y$ in $\\text{mb/sr}$: $[0.15,\\,0.12,\\,0.10,\\,0.10,\\,0.09]$.\n  - Shell-model predicted $C^2S$: $0.32$.\n\n- Case C (weak $s$-wave component near threshold, $l=0$ “$s$-like” transfer):\n  - $l = 0$, $M_0 = 8.0$ $\\text{mb/sr}$.\n  - Angles (degrees): $[10,20,30,40,50]$.\n  - Measured $\\left(\\frac{d\\sigma}{d\\Omega}\\right)_{\\text{meas}}$ in $\\text{mb/sr}$: $[1.02,\\,1.02,\\,1.02,\\,1.02,\\,1.02]$.\n  - Uncertainties $\\delta y$ in $\\text{mb/sr}$: $[0.05,\\,0.05,\\,0.05,\\,0.05,\\,0.05]$.\n  - Shell-model predicted $C^2S$: $0.18$.\n\nReaction-model settings for all cases:\n- Use $D_{\\text{DWBA}}=1.0$ and $D_{\\text{ADWA}}=0.85$.\n- Model shape: $\\sigma_{\\text{sp}}^{(\\text{method})}(\\theta; l) = D_{\\text{method}} \\, M_l \\, \\left[P_l\\big(\\cos(\\theta_{\\text{rad}})\\big)\\right]^2$ with $\\theta_{\\text{rad}}$ in radians.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case (in the order A, B, C), output a sublist with five entries:\n$[C^2S_{\\text{DWBA}},\\,C^2S_{\\text{ADWA}},\\,\\text{RMS}_{\\text{DWBA}},\\,\\text{RMS}_{\\text{ADWA}},\\,\\text{agree}]$,\nwhere $C^2S_{\\text{DWBA}}$ and $C^2S_{\\text{ADWA}}$ are floats (dimensionless), $\\text{RMS}_{\\text{DWBA}}$ and $\\text{RMS}_{\\text{ADWA}}$ are floats in $\\text{mb/sr}$, and $\\text{agree}$ is a boolean reflecting whether the ADWA-extracted $C^2S$ agrees with the shell-model prediction within the stated tolerance. The final output must be exactly one line, for example:\n$[[0.123456,0.234567,0.010000,0.020000,True],[...],[...]]$.", "solution": "The problem is valid. It is scientifically grounded in the principles of nuclear reaction theory, specifically the direct-reaction model where a measured cross section is factorized into a structure part (spectroscopic factor $C^2S$) and a reaction dynamics part (single-particle cross section $\\sigma_{\\text{sp}}$). The problem is well-posed, providing all necessary data and equations to uniquely determine the required quantities using standard statistical methods.\n\nThe core of the problem is to extract the spectroscopic factor, $C^2S$, from experimental data by fitting a theoretical model. The relationship between the measured differential cross section, $y_i = (\\frac{d\\sigma}{d\\Omega})_{\\text{meas}}(\\theta_i)$, and the model is given as:\n$$\ny_i \\approx C^2S \\cdot m_i\n$$\nwhere $m_i = \\sigma_{\\text{sp}}^{(\\text{method})}(\\theta_i; l)$ represents the calculated single-particle cross section at angle $\\theta_i$. This is a linear model of the form $y = a \\cdot m$ where the parameter to be determined is the amplitude $a = C^2S$.\n\nTo find the best-fit value for $C^2S$, we use the method of weighted least squares, which is appropriate when the measurement uncertainties, $\\delta y_i$, are known and assumed to be independent and Gaussian. The task is to minimize the chi-squared function, $\\chi^2$, with respect to $C^2S$:\n$$\n\\chi^2 = \\sum_{i=1}^{N} w_i \\left(y_i - C^2S \\cdot m_i\\right)^2\n$$\nwhere the weights $w_i$ are the inverse square of the uncertainties, $w_i = 1/(\\delta y_i)^2$. To find the minimum, we set the derivative of $\\chi^2$ with respect to $C^2S$ to zero:\n$$\n\\frac{\\partial \\chi^2}{\\partial (C^2S)} = \\sum_{i=1}^{N} -2 w_i m_i \\left(y_i - C^2S \\cdot m_i\\right) = 0\n$$\nSolving for $C^2S$ yields the standard formula for a weighted linear fit through the origin:\n$$\nC^2S = \\frac{\\sum_{i=1}^{N} w_i y_i m_i}{\\sum_{i=1}^{N} w_i m_i^2} = \\frac{\\sum_{i=1}^{N} (y_i m_i / (\\delta y_i)^2)}{\\sum_{i=1}^{N} (m_i^2 / (\\delta y_i)^2)}\n$$\n\nThe single-particle cross section is modeled as:\n$$\nm_i = \\sigma_{\\text{sp}}^{(\\text{method})}(\\theta_i; l) = D_{\\text{method}} \\, M_l \\, \\left[P_l\\big(\\cos(\\theta_{i, \\text{rad}})\\big)\\right]^2\n$$\nWe must perform this calculation for two reaction frameworks: DWBA ($D_{\\text{DWBA}}=1.0$) and ADWA ($D_{\\text{ADWA}}=0.85$). Let's denote the single-particle cross section without the method-dependent factor as $m'_i = M_l \\, \\left[P_l\\big(\\cos(\\theta_{i, \\text{rad}})\\big)\\right]^2$. Then, $m_{i, \\text{DWBA}} = D_{\\text{DWBA}} \\cdot m'_i = m'_i$ and $m_{i, \\text{ADWA}} = D_{\\text{ADWA}} \\cdot m'_i$.\n\nThe spectroscopic factor for the DWBA method is:\n$$\nC^2S_{\\text{DWBA}} = \\frac{\\sum_{i=1}^{N} (y_i m'_{i} / (\\delta y_i)^2)}{\\sum_{i=1}^{N} (m'_{i})^2 / (\\delta y_i)^2}\n$$\nFor the ADWA method, we have:\n$$\nC^2S_{\\text{ADWA}} = \\frac{\\sum_{i=1}^{N} (y_i m_{i, \\text{ADWA}} / (\\delta y_i)^2)}{\\sum_{i=1}^{N} (m_{i, \\text{ADWA}})^2 / (\\delta y_i)^2} = \\frac{\\sum_{i=1}^{N} (y_i (D_{\\text{ADWA}} m'_{i}) / (\\delta y_i)^2)}{\\sum_{i=1}^{N} (D_{\\text{ADWA}} m'_{i})^2 / (\\delta y_i)^2}\n$$\n$$\nC^2S_{\\text{ADWA}} = \\frac{D_{\\text{ADWA}} \\sum_{i=1}^{N} (y_i m'_{i} / (\\delta y_i)^2)}{D_{\\text{ADWA}}^2 \\sum_{i=1}^{N} (m'_{i})^2 / (\\delta y_i)^2} = \\frac{1}{D_{\\text{ADWA}}} C^2S_{\\text{DWBA}}\n$$\nThis demonstrates that the spectroscopic factor extracted with the ADWA model is simply the DWBA result scaled by the inverse of the ADWA renormalization factor.\n\nNext, we calculate the unweighted root-mean-square (RMS) residual to quantify the goodness of fit:\n$$\n\\text{RMS} = \\sqrt{\\frac{1}{N}\\sum_{i=1}^N \\left(y_i - C^2S \\cdot m_i\\right)^2}\n$$\nLet's examine the fitted cross sections, $y_{i, \\text{fit}} = C^2S \\cdot m_i$, for both methods.\n$$\ny_{i, \\text{fit, DWBA}} = C^2S_{\\text{DWBA}} \\cdot m_{i, \\text{DWBA}} = C^2S_{\\text{DWBA}} \\cdot m'_i\n$$\n$$\ny_{i, \\text{fit, ADWA}} = C^2S_{\\text{ADWA}} \\cdot m_{i, \\text{ADWA}} = \\left(\\frac{C^2S_{\\text{DWBA}}}{D_{\\text{ADWA}}}\\right) \\cdot (D_{\\text{ADWA}} m'_i) = C^2S_{\\text{DWBA}} \\cdot m'_i\n$$\nThe fitted cross-section values are identical for both methods. Consequently, the residuals $(y_i - y_{i, \\text{fit}})$ are also identical, which implies that $\\text{RMS}_{\\text{DWBA}} = \\text{RMS}_{\\text{ADWA}}$.\n\nThe final step is to compare the extracted $C^2S_{\\text{ADWA}}$ with the theoretical shell-model prediction $(C^2S)_{\\text{SM}}$ by checking if the relative deviation is within a $15\\%$ tolerance:\n$$\n\\frac{\\left|C^2S_{\\text{ADWA}} - \\left(C^2S\\right)_{\\text{SM}}\\right|}{\\left(C^2S\\right)_{\\text{SM}}} \\le 0.15\n$$\n\nThe solution algorithm is as follows for each test case:\n1.  Convert the given angles from degrees to radians.\n2.  Calculate the model shape factor $m'_i = M_l \\, \\left[P_l\\big(\\cos(\\theta_{i, \\text{rad}})\\big)\\right]^2$, using the provided $l$ and $M_l$. The Legendre polynomials $P_l(x)$ are evaluated using `scipy.special.legendre`.\n3.  Calculate $C^2S_{\\text{DWBA}}$ using the weighted least-squares formula with $m_{i, \\text{DWBA}} = m'_i$.\n4.  Calculate $C^2S_{\\text{ADWA}} = C^2S_{\\text{DWBA}} / D_{\\text{ADWA}}$, where $D_{\\text{ADWA}}=0.85$.\n5.  Calculate the unweighted RMS residual, which is the same for both methods: $\\text{RMS} = \\sqrt{\\frac{1}{N}\\sum(y_i - C^2S_{\\text{DWBA}} \\cdot m'_i)^2}$.\n6.  Compare $C^2S_{\\text{ADWA}}$ with $(C^2S)_{\\text{SM}}$ to determine the boolean `agree` flag.\n7.  Collect the five results ($C^2S_{\\text{DWBA}}$, $C^2S_{\\text{ADWA}}$, $\\text{RMS}_{\\text{DWBA}}$, $\\text{RMS}_{\\text{ADWA}}$, `agree`) for the case.\nThis procedure is repeated for all provided test cases.", "answer": "```python\nimport numpy as np\nfrom scipy.special import legendre\n\ndef solve():\n    \"\"\"\n    Solves the nuclear reaction analysis problem for all test cases.\n    \"\"\"\n    # Reaction model settings\n    D_DWBA = 1.0\n    D_ADWA = 0.85\n    TOLERANCE = 0.15\n\n    # Test suite\n    test_cases = [\n        {\n            \"l\": 3, \"Ml\": 60.0,\n            \"y\": np.array([38.0567, 20.2910, 4.8412, 0.02923, 4.1371]),\n            \"dy\": np.array([0.5, 0.3, 0.1, 0.02, 0.1]),\n            \"C2S_SM\": 0.88,\n            \"angles_deg\": np.array([10, 20, 30, 40, 50])\n        },\n        {\n            \"l\": 1, \"Ml\": 12.0,\n            \"y\": np.array([3.462, 3.153, 2.678, 2.095, 1.475]),\n            \"dy\": np.array([0.15, 0.12, 0.10, 0.10, 0.09]),\n            \"C2S_SM\": 0.32,\n            \"angles_deg\": np.array([10, 20, 30, 40, 50])\n        },\n        {\n            \"l\": 0, \"Ml\": 8.0,\n            \"y\": np.array([1.02, 1.02, 1.02, 1.02, 1.02]),\n            \"dy\": np.array([0.05, 0.05, 0.05, 0.05, 0.05]),\n            \"C2S_SM\": 0.18,\n            \"angles_deg\": np.array([10, 20, 30, 40, 50])\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        l, Ml = case[\"l\"], case[\"Ml\"]\n        y, dy = case[\"y\"], case[\"dy\"]\n        C2S_SM = case[\"C2S_SM\"]\n        angles_deg = case[\"angles_deg\"]\n        \n        # 1) Compute single-particle model values\n        angles_rad = np.deg2rad(angles_deg)\n        cos_theta = np.cos(angles_rad)\n        \n        # Get Legendre polynomial object from SciPy\n        Pl = legendre(l)\n        Pl_cos_theta = Pl(cos_theta)\n        \n        # This is the model shape part, m'_i in the explanation.\n        # It corresponds to the DWBA model with D_DWBA = 1.0.\n        m_dwba = Ml * (Pl_cos_theta**2)\n        \n        # ADWA model is just a scaling of the DWBA model\n        m_adwa = D_ADWA * m_dwba\n\n        # 2) Perform weighted linear least-squares fit for DWBA\n        # C2S = sum(y*m/dy^2) / sum(m^2/dy^2)\n        weights = 1.0 / dy**2\n        numerator_dwba = np.sum(weights * y * m_dwba)\n        denominator_dwba = np.sum(weights * m_dwba**2)\n        \n        # Handle potential division by zero, though not expected with given data\n        if denominator_dwba == 0:\n            c2s_dwba = 0.0\n        else:\n            c2s_dwba = numerator_dwba / denominator_dwba\n\n        # As derived, C2S_ADWA = C2S_DWBA / D_ADWA\n        c2s_adwa = c2s_dwba / D_ADWA\n\n        # Calculate unweighted RMS residual\n        # As derived, the fitted values and thus the RMS are identical for both methods.\n        y_fit = c2s_dwba * m_dwba\n        residuals = y - y_fit\n        rms = np.sqrt(np.mean(residuals**2))\n        rms_dwba = rms\n        rms_adwa = rms\n\n        # 3) Compare ADWA-extracted C2S to shell-model prediction\n        relative_deviation = np.abs(c2s_adwa - C2S_SM) / C2S_SM\n        agree = relative_deviation = TOLERANCE\n\n        all_results.append([c2s_dwba, c2s_adwa, rms_dwba, rms_adwa, agree])\n\n    # Format the final output string\n    # The string representation of a list of lists is '[...], [...]', etc.\n    # The prompt requires this form to be wrapped in a single set of brackets.\n    results_str = \",\".join(map(str, all_results))\n    print(f\"[{results_str}]\")\n\nsolve()\n```", "id": "3558390"}, {"introduction": "A key frontier in modern nuclear physics is understanding how shell structure evolves far from stability, leading to the appearance of \"new\" magic numbers. This advanced practice introduces a powerful statistical tool, Bayesian model selection, to rigorously assess the evidence for such a phenomenon. You will compare a model that assumes a smooth trend against one that includes a localized shell effect at $N=32$, using data from multiple observables to compute a Bayes factor that quantifies which hypothesis the data more strongly supports [@problem_id:3558398].", "problem": "You are asked to formalize and compute the combined strength of experimental evidence for the presence of a nuclear shell gap at neutron number $N=32$ by comparing two statistical models using Bayes factors, drawing on data for the Two-Neutron Separation Energy ($S_{2n}$), the first $2^+$ Excitation Energy ($E(2^+)$), and the Reduced Electric Quadrupole Transition Probability ($B(E2)$). Your answer must be a complete and runnable program that computes the specified outputs for the provided test suite.\n\nThe fundamental base for this task is Bayes’ theorem, the Gaussian likelihood for measurement errors, and the definition of Bayesian model evidence. Let $M_0$ denote the null model without a special feature at $N=32$ and $M_1$ denote the alternative model with an explicit parameter modeling a localized effect at $N=32$ for each observable. You will assume that, conditional on a model, all data points are independent and Gaussian-distributed around a linear predictor, with known standard deviations.\n\nFor each observable $o \\in \\{S_{2n}, E(2^+), B(E2)\\}$, for each datum $i$ with neutron number $N_i$, measured value $y_{o,i}$, and reported standard deviation $\\sigma_{o,i}$ (assumed known and Gaussian), define the models:\n- Under $M_0$ (no $N=32$ shell-gap term), the predictor is\n$$\n\\mu_{o,i}^{(0)} = \\beta_{o,0} + \\beta_{o,1} N_i,\n$$\nwith parameters $\\beta_{o,0}$ and $\\beta_{o,1}$.\n- Under $M_1$ (with an $N=32$ shell-gap term), the predictor is\n$$\n\\mu_{o,i}^{(1)} = \\beta_{o,0} + \\beta_{o,1} N_i + \\gamma_o \\, d(N_i),\n$$\nwhere $d(N_i)=1$ if $N_i=32$ and $d(N_i)=0$ otherwise, and $\\gamma_o$ captures a localized deviation at $N=32$.\n\nAssume independent Gaussian priors for all regression parameters with zero mean and prior variance $s_o^2$ for each parameter in observable $o$. That is, under $M_0$, $(\\beta_{o,0}, \\beta_{o,1}) \\sim \\mathcal{N}(0, s_o^2 I)$; under $M_1$, $(\\beta_{o,0}, \\beta_{o,1}, \\gamma_o) \\sim \\mathcal{N}(0, s_o^2 I)$. For each observable $o$, the parameter scale $s_o$ will be specified in the test cases below. The Gaussian likelihood for datum $i$ in observable $o$ is\n$$\ny_{o,i} \\sim \\mathcal{N}\\!\\left( \\mu_{o,i}^{(m)}, \\, \\sigma_{o,i}^2 \\right),\n$$\nwhere $m \\in \\{0,1\\}$ denotes the model.\n\nFor each observable, the Bayesian model evidence is the marginal likelihood obtained by integrating the likelihood over the prior. Because the prior and the likelihood are Gaussian, the evidence for each observable is a closed-form Gaussian integral. Assume independence across the three observables given the model, so that the combined evidence is the product of the evidences for the three observables under the same model. The Bayes factor $K$ comparing the models is defined as\n$$\nK \\equiv \\frac{Z_1}{Z_0},\n$$\nwhere $Z_1$ and $Z_0$ are the combined evidences for $M_1$ and $M_0$, respectively. Report the base-$10$ logarithm of the Bayes factor, $\\log_{10} K$, which is dimensionless.\n\nModeling notes:\n- Treat $N$ as a numeric predictor exactly as provided.\n- Treat $d(N)$ exactly as the indicator function equal to $1$ when $N=32$ and $0$ otherwise.\n- For each observable, under $M_0$ the design matrix has $2$ columns corresponding to an intercept and $N$. Under $M_1$ the design matrix has $3$ columns corresponding to an intercept, $N$, and $d(N)$.\n- The prior variance $s_o^2$ applies identically and independently to each parameter within observable $o$.\n- Use the provided numerical values and uncertainties directly; do not perform any unit conversions. The result $\\log_{10} K$ is dimensionless. Physical units for inputs are specified for realism and must be adhered to in model specification, but no unit conversion is needed.\n\nTest suite:\nCompute $\\log_{10} K$ for each of the three test cases below, each case comprising three observables with their data. All neutron numbers $N$ are unitless counts. All angles are not applicable. Units are specified for each observable. For all listed numbers, use them exactly as given.\n\n- Test Case A (representative of a pronounced shell gap at $N=32$):\n    - Two-Neutron Separation Energy ($S_{2n}$) in $\\mathrm{MeV}$:\n        - $N = [30, 32, 34]$\n        - $y = [20.0, 16.8, 17.6]$\n        - $\\sigma = [0.2, 0.2, 0.2]$\n        - prior scale $s_{S_{2n}} = 10.0$\n    - First $2^+$ Excitation Energy ($E(2^+)$) in $\\mathrm{MeV}$:\n        - $N = [30, 32, 34]$\n        - $y = [1.0, 2.3, 1.2]$\n        - $\\sigma = [0.05, 0.05, 0.05]$\n        - prior scale $s_{E(2^+)} = 3.0$\n    - Reduced Electric Quadrupole Transition Probability ($B(E2)$) in $e^2 b^2$:\n        - $N = [30, 32, 34]$\n        - $y = [0.20, 0.06, 0.16]$\n        - $\\sigma = [0.01, 0.01, 0.01]$\n        - prior scale $s_{B(E2)} = 0.5$\n\n- Test Case B (representative of no shell gap, smooth trend):\n    - Two-Neutron Separation Energy ($S_{2n}$) in $\\mathrm{MeV}$:\n        - $N = [30, 32, 34]$\n        - $y = [20.0, 18.8, 17.6]$\n        - $\\sigma = [0.2, 0.2, 0.2]$\n        - prior scale $s_{S_{2n}} = 10.0$\n    - First $2^+$ Excitation Energy ($E(2^+)$) in $\\mathrm{MeV}$:\n        - $N = [30, 32, 34]$\n        - $y = [1.0, 1.1, 1.2]$\n        - $\\sigma = [0.05, 0.05, 0.05]$\n        - prior scale $s_{E(2^+)} = 3.0$\n    - Reduced Electric Quadrupole Transition Probability ($B(E2)$) in $e^2 b^2$:\n        - $N = [30, 32, 34]$\n        - $y = [0.20, 0.18, 0.16]$\n        - $\\sigma = [0.01, 0.01, 0.01]$\n        - prior scale $s_{B(E2)} = 0.5$\n\n- Test Case C (sparse measurements with larger uncertainties):\n    - Two-Neutron Separation Energy ($S_{2n}$) in $\\mathrm{MeV}$:\n        - $N = [30, 32]$\n        - $y = [20.0, 18.8]$\n        - $\\sigma = [0.5, 0.5]$\n        - prior scale $s_{S_{2n}} = 10.0$\n    - First $2^+$ Excitation Energy ($E(2^+)$) in $\\mathrm{MeV}$:\n        - $N = [30, 32]$\n        - $y = [1.0, 1.1]$\n        - $\\sigma = [0.2, 0.2]$\n        - prior scale $s_{E(2^+)} = 3.0$\n    - Reduced Electric Quadrupole Transition Probability ($B(E2)$) in $e^2 b^2$:\n        - $N = [30, 32]$\n        - $y = [0.20, 0.18]$\n        - $\\sigma = [0.05, 0.05]$\n        - prior scale $s_{B(E2)} = 0.5$\n\nYour program must:\n- Implement the linear-Gaussian models $M_0$ and $M_1$ with the priors and likelihoods described above.\n- For each observable in each test case, compute the Bayesian model evidence by analytically integrating over the Gaussian priors.\n- Combine evidences across the three observables by multiplication to obtain $Z_0$ and $Z_1$ for the case.\n- Compute the Bayes factor $K = Z_1/Z_0$ and report $\\log_{10} K$.\n- Output a single line containing a list of three floats corresponding to $\\log_{10} K$ for Test Case A, Test Case B, and Test Case C, respectively, rounded to three decimal places, in the format $[x_1,x_2,x_3]$.\n\nAll numerical inputs in the test suite must be used exactly as provided. All physical inputs are specified in correct physical units: $S_{2n}$ in $\\mathrm{MeV}$, $E(2^+)$ in $\\mathrm{MeV}$, and $B(E2)$ in $e^2 b^2$. The final reported values $\\log_{10} K$ are dimensionless. The angle unit is not applicable in this problem. The program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example $[x_1,x_2,x_3]$.", "solution": "The user has requested the formalization and computation of the Bayes factor to compare two statistical models regarding a potential nuclear shell gap at neutron number $N=32$. The solution requires calculating the Bayesian model evidence for each model and then their ratio.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n*   **Models**:\n    *   Null model ($M_0$): linear predictor $\\mu_{o,i}^{(0)} = \\beta_{o,0} + \\beta_{o,1} N_i$.\n    *   Alternative model ($M_1$): linear predictor $\\mu_{o,i}^{(1)} = \\beta_{o,0} + \\beta_{o,1} N_i + \\gamma_o \\, d(N_i)$, where $d(N_i) = 1$ if $N_i=32$ and $0$ otherwise.\n*   **Likelihood**: For each observable $o$ and data point $i$, the measured value $y_{o,i}$ is assumed to follow a Gaussian distribution around the model's prediction $\\mu_{o,i}^{(m)}$ with a known standard deviation $\\sigma_{o,i}$: $y_{o,i} \\sim \\mathcal{N}(\\mu_{o,i}^{(m)}, \\sigma_{o,i}^2)$. Data points are independent.\n*   **Priors**:\n    *   For $M_0$, parameters $(\\beta_{o,0}, \\beta_{o,1})$ have an independent Gaussian prior with zero mean and variance $s_o^2$: $(\\beta_{o,0}, \\beta_{o,1}) \\sim \\mathcal{N}(\\mathbf{0}, s_o^2 I_2)$.\n    *   For $M_1$, parameters $(\\beta_{o,0}, \\beta_{o,1}, \\gamma_o)$ have an independent Gaussian prior with zero mean and variance $s_o^2$: $(\\beta_{o,0}, \\beta_{o,1}, \\gamma_o) \\sim \\mathcal{N}(\\mathbf{0}, s_o^2 I_3)$.\n*   **Bayes Factor**: $K = Z_1 / Z_0$, where $Z_m$ is the combined evidence for model $M_m$.\n*   **Combined Evidence**: The total evidence for a model is the product of the evidences for each of the three observables, due to assumed independence: $Z_m = \\prod_{o} Z_{o,m}$.\n*   **Output**: The base-$10$ logarithm of the Bayes factor, $\\log_{10} K$.\n*   **Data**: Three test cases (A, B, C) are provided, each containing data ($N$, $y$, $\\sigma$) and a prior scale parameter $s_o$ for three observables: $S_{2n}$, $E(2^+)$, and $B(E2)$.\n\n**Step 2: Validate Using Extracted Givens**\n\n*   **Scientifically Grounded**: The problem uses standard nuclear physics observables ($S_{2n}$, $E(2^+)$, $B(E2)$) to test a hypothesis about nuclear shell structure, a core topic in the field. The statistical framework (Bayesian model comparison using linear models, Gaussian priors, and Gaussian likelihoods) is a rigorous and standard method for quantitative data analysis. The problem is scientifically sound.\n*   **Well-Posed**: The problem is formulated as a Bayesian linear regression problem. The marginal likelihood (model evidence) for such a model with Gaussian priors and likelihood has a well-defined analytical solution. All necessary inputs (data, uncertainties, prior parameters) are provided. The problem has a unique, stable, and meaningful solution.\n*   **Objective**: The problem statement is precise, quantitative, and free of ambiguity or subjective language. The task is a direct computation based on the provided formulas and data.\n\n**Step 3: Verdict and Action**\n\nThe problem is valid. It is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. I will proceed with the detailed solution.\n\n### Principle-Based Solution\n\nThe core of the problem is to compute the Bayesian model evidence, also known as the marginal likelihood, for the two competing models, $M_0$ and $M_1$, for each observable. The evidence represents the probability of the observed data given the model, $Z = p(\\mathbf{y}|M)$, obtained by integrating over all possible values of the model parameters weighted by their prior probabilities.\n\nFor a given observable $o$, we can write the Bayesian model in vector-matrix form. Let $\\mathbf{y}$ be the $n \\times 1$ vector of observed data points, $X$ be the $n \\times p$ design matrix, and $\\mathbf{\\beta}$ be the $p \\times 1$ vector of model parameters.\nThe likelihood is $p(\\mathbf{y}|\\mathbf{\\beta}, M) = \\mathcal{N}(\\mathbf{y} | X\\mathbf{\\beta}, \\Sigma_y)$, where $\\Sigma_y$ is the $n \\times n$ diagonal covariance matrix of measurement errors, with $\\left(\\Sigma_y\\right)_{ii} = \\sigma_i^2$.\nThe prior on the parameters is $p(\\mathbf{\\beta}|M) = \\mathcal{N}(\\mathbf{\\beta} | \\mathbf{\\beta}_0, \\Sigma_\\beta)$. In this problem, the prior mean is $\\mathbf{\\beta}_0 = \\mathbf{0}$ and the prior covariance is $\\Sigma_\\beta = s_o^2 I_p$, where $p$ is the number of parameters ($2$ for $M_0$, $3$ for $M_1$) and $I_p$ is the $p \\times p$ identity matrix.\n\nThe model evidence $Z$ is the integral:\n$$\nZ = \\int p(\\mathbf{y}|\\mathbf{\\beta}, M) p(\\mathbf{\\beta}|M) d\\mathbf{\\beta}\n$$\nThis is a standard Gaussian integral. The result is that the data vector $\\mathbf{y}$ itself follows a multivariate normal distribution, with a mean $E[\\mathbf{y}] = X\\mathbf{\\beta}_0$ and a covariance matrix $\\text{Cov}(\\mathbf{y}) = \\Sigma_y + X\\Sigma_\\beta X^T$.\nGiven that our prior mean is $\\mathbf{\\beta}_0 = \\mathbf{0}$, the predictive distribution for $\\mathbf{y}$ is:\n$$\np(\\mathbf{y}|M) = \\mathcal{N}(\\mathbf{y} | \\mathbf{0}, C)\n$$\nwhere $C = \\Sigma_y + s_o^2 X X^T$. The evidence $Z$ is the value of this probability density function evaluated at the observed data $\\mathbf{y}$:\n$$\nZ = (2\\pi)^{-n/2} |C|^{-1/2} \\exp\\left(-\\frac{1}{2} \\mathbf{y}^T C^{-1} \\mathbf{y}\\right)\n$$\nTo avoid numerical underflow and simplify calculations, we compute the natural logarithm of the evidence:\n$$\n\\ln Z = -\\frac{n}{2}\\ln(2\\pi) - \\frac{1}{2}\\ln|C| - \\frac{1}{2}\\mathbf{y}^T C^{-1} \\mathbf{y}\n$$\nThis calculation is performed for each observable under both models $M_0$ and $M_1$.\n\n**For Model $M_0$**: The parameter vector is $\\mathbf{\\beta} = (\\beta_0, \\beta_1)^T$. The $n \\times 2$ design matrix $X_0$ is constructed with a column of ones for the intercept $\\beta_0$ and a column of neutron numbers $N_i$ for the slope $\\beta_1$.\n$$\nX_0 = \\begin{pmatrix} 1  N_1 \\\\ 1  N_2 \\\\ \\vdots  \\vdots \\\\ 1  N_n \\end{pmatrix}\n$$\n\n**For Model $M_1$**: The parameter vector is $\\mathbf{\\beta} = (\\beta_0, \\beta_1, \\gamma)^T$. The $n \\times 3$ design matrix $X_1$ adds a third column, $d(N_i)$, which is an indicator variable for $N_i=32$.\n$$\nX_1 = \\begin{pmatrix} 1  N_1  d(N_1) \\\\ 1  N_2  d(N_2) \\\\ \\vdots  \\vdots  \\vdots \\\\ 1  N_n  d(N_n) \\end{pmatrix}\n$$\n\nThe overall evidence for a model ($Z_0$ or $Z_1$) is the product of the evidences from the three observables ($S_{2n}$, $E(2^+)$, $B(E2)$), due to their assumed independence. In log space, this corresponds to a sum:\n$$\n\\ln Z_m^{\\text{total}} = \\ln Z_{S_{2n},m} + \\ln Z_{E(2^+),m} + \\ln Z_{B(E2),m}\n$$\nfor $m \\in \\{0, 1\\}$.\n\nFinally, the Bayes factor $K = Z_1 / Z_0$ is computed. The desired output is its base-$10$ logarithm, which is calculated from the total log-evidences:\n$$\n\\log_{10} K = \\frac{\\ln K}{\\ln 10} = \\frac{\\ln Z_1^{\\text{total}} - \\ln Z_0^{\\text{total}}}{\\ln 10}\n$$\n\nThe algorithm proceeds as follows for each test case:\n1. Initialize total log-evidences $\\ln Z_0^{\\text{total}} = 0$ and $\\ln Z_1^{\\text{total}} = 0$.\n2. For each of the three observables:\n    a. Construct the data vector $\\mathbf{y}$, the data covariance matrix $\\Sigma_y$, and the design matrices $X_0$ and $X_1$.\n    b. For both models $M_0$ and $M_1$, compute the matrix $C = \\Sigma_y + s_o^2 X X^T$.\n    c. Calculate the log-evidence $\\ln Z$ using the formula involving the determinant and inverse of $C$.\n    d. Add the results to the corresponding total log-evidence accumulators.\n3. Compute the final $\\log_{10} K$ from the total log-evidences.\nThis process is repeated for all three test cases.", "answer": "```python\nimport numpy as np\n\ndef calculate_log_evidence(y, sigma, N, s, model_type):\n    \"\"\"\n    Calculates the log-marginal-likelihood (log-evidence) for a Bayesian linear model.\n\n    Args:\n        y (list): List of measurement values.\n        sigma (list): List of measurement standard deviations.\n        N (list): List of neutron numbers.\n        s (float): Prior standard deviation for model parameters.\n        model_type (str): 'M0' for the null model, 'M1' for the alternative model.\n\n    Returns:\n        float: The natural logarithm of the model evidence, ln(Z).\n    \"\"\"\n    n = len(y)\n    y_vec = np.array(y)\n    \n    # Construct the design matrix X based on the model type\n    ones = np.ones(n)\n    neutrons = np.array(N)\n    \n    if model_type == 'M0':\n        # Model M0: y = beta_0 + beta_1 * N\n        X = np.stack([ones, neutrons], axis=1)\n    elif model_type == 'M1':\n        # Model M1: y = beta_0 + beta_1 * N + gamma * d(N)\n        d_N = (neutrons == 32).astype(float)\n        X = np.stack([ones, neutrons, d_N], axis=1)\n    else:\n        raise ValueError(\"Invalid model type specified. Must be 'M0' or 'M1'.\")\n\n    # Construct the covariance matrix of the measurement errors (likelihood)\n    Sigma_y = np.diag(np.array(sigma)**2)\n    \n    # The prior covariance is s^2 * I.\n    # The covariance of the predictive distribution for y is C = Sigma_y + X * Sigma_beta * X.T\n    # which simplifies to C = Sigma_y + s^2 * X @ X.T\n    C = Sigma_y + (s**2) * (X @ X.T)\n    \n    # Calculate the log-determinant of C. slogdet is used for numerical stability.\n    sign, logdet_C = np.linalg.slogdet(C)\n    if sign = 0:\n        # For a valid covariance matrix, the determinant must be positive.\n        # This case should not be reached with the given problem setup.\n        raise RuntimeError(\"Determinant of the predictive covariance matrix C is not positive.\")\n\n    # Calculate the inverse of C\n    try:\n        inv_C = np.linalg.inv(C)\n    except np.linalg.LinAlgError:\n        # C is singular, evidence is effectively zero.\n        raise RuntimeError(\"Predictive covariance matrix C is singular and cannot be inverted.\")\n\n    # Calculate the quadratic form y.T * C^-1 * y\n    quad_term = y_vec.T @ inv_C @ y_vec\n    \n    # Calculate the log-evidence using the formula for the log of a multivariate normal PDF\n    # evaluated at y, with mean 0 and covariance C.\n    # ln(Z) = -n/2*ln(2*pi) - 1/2*ln|C| - 1/2 * y.T * C^-1 * y\n    log_Z = -0.5 * n * np.log(2 * np.pi) - 0.5 * logdet_C - 0.5 * quad_term\n    \n    return log_Z\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis for all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # Test Case A (pronounced shell gap at N=32)\n        [\n            {'N': [30, 32, 34], 'y': [20.0, 16.8, 17.6], 'sigma': [0.2, 0.2, 0.2], 's': 10.0},\n            {'N': [30, 32, 34], 'y': [1.0, 2.3, 1.2], 'sigma': [0.05, 0.05, 0.05], 's': 3.0},\n            {'N': [30, 32, 34], 'y': [0.20, 0.06, 0.16], 'sigma': [0.01, 0.01, 0.01], 's': 0.5}\n        ],\n        # Test Case B (no shell gap, smooth trend)\n        [\n            {'N': [30, 32, 34], 'y': [20.0, 18.8, 17.6], 'sigma': [0.2, 0.2, 0.2], 's': 10.0},\n            {'N': [30, 32, 34], 'y': [1.0, 1.1, 1.2], 'sigma': [0.05, 0.05, 0.05], 's': 3.0},\n            {'N': [30, 32, 34], 'y': [0.20, 0.18, 0.16], 'sigma': [0.01, 0.01, 0.01], 's': 0.5}\n        ],\n        # Test Case C (sparse measurements, larger uncertainties)\n        [\n            {'N': [30, 32], 'y': [20.0, 18.8], 'sigma': [0.5, 0.5], 's': 10.0},\n            {'N': [30, 32], 'y': [1.0, 1.1], 'sigma': [0.2, 0.2], 's': 3.0},\n            {'N': [30, 32], 'y': [0.20, 0.18], 'sigma': [0.05, 0.05], 's': 0.5}\n        ]\n    ]\n\n    results = []\n    for case_data in test_cases:\n        total_log_Z0 = 0.0\n        total_log_Z1 = 0.0\n        \n        for obs_data in case_data:\n            # Unpack data for the current observable\n            y, sigma, N, s = obs_data['y'], obs_data['sigma'], obs_data['N'], obs_data['s']\n            \n            # Calculate and accumulate log-evidence for model M0\n            log_Z0 = calculate_log_evidence(y, sigma, N, s, 'M0')\n            total_log_Z0 += log_Z0\n            \n            # Calculate and accumulate log-evidence for model M1\n            log_Z1 = calculate_log_evidence(y, sigma, N, s, 'M1')\n            total_log_Z1 += log_Z1\n            \n        # Compute the natural logarithm of the Bayes factor K = Z1/Z0\n        log_K = total_log_Z1 - total_log_Z0\n        \n        # Convert to base-10 logarithm\n        log10_K = log_K / np.log(10)\n        \n        results.append(round(log10_K, 3))\n\n    # Print results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3558398"}]}