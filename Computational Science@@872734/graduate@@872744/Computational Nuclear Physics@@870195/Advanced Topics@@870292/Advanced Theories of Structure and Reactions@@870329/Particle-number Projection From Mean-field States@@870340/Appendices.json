{"hands_on_practices": [{"introduction": "The first step in numerically implementing particle-number projection is to replace the continuous gauge-angle integral with a discrete sum. This naturally raises a crucial question: how many points must we use in our discretization to obtain a correct result? This exercise [@problem_id:3579450] guides you through determining the minimum number of grid points required to accurately capture the particle-number distribution, connecting the problem to fundamental principles of the Discrete Fourier Transform.", "problem": "Consider a Hartree-Fock-Bogoliubov (HFB) mean-field state with broken particle-number symmetry. The particle-number projection operator onto the sector with particle number $N$ is defined by the gauge-angle integral\n$$\n\\hat P_N = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} d\\phi \\, e^{i\\phi(\\hat N - N)},\n$$\nwhere $\\hat N$ is the number operator. For a general mean-field state $|\\Phi\\rangle$, the corresponding generating function\n$$\nG(\\phi) \\equiv \\langle\\Phi|e^{i\\phi \\hat N}|\\Phi\\rangle\n$$\nis $2\\pi$-periodic in $\\phi$, and the probability distribution for particle number $n$ in the state $|\\Phi\\rangle$ can be obtained as the inverse Fourier transform,\n$$\nw_n \\equiv \\langle\\Phi|\\hat P_n|\\Phi\\rangle = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} d\\phi \\, e^{-i \\phi n} \\, G(\\phi).\n$$\nIn computation, the gauge-angle integral is replaced by a discrete quadrature over angles. Assume $G(\\phi)$ is sufficiently band-limited in Fourier space such that its non-negligible Fourier components $w_n$ lie within a contiguous integer range $n \\in [N_{\\min}, N_{\\max}]$ with span $L \\equiv N_{\\max} - N_{\\min} + 1$. You are asked to propose a discrete quadrature for evaluating $\\hat P_N$ and to justify the minimal number of points required to resolve the particle-number distribution without aliasing by appealing to the discrete Fourier transform (DFT) of the sampled $G(\\phi)$.\n\nWhich option correctly states a discrete quadrature rule using equally spaced gauge angles with equal weights, and gives the minimal requirement on the number of quadrature points based on the maximum resolvable particle-number range via the DFT, including the numerical consequence for a case with $N_{\\min} = 116$ and $N_{\\max} = 128$?\n\nA. Choose $M$ points $\\phi_m = \\dfrac{2\\pi m}{M}$ for $m = 0,1,\\dots,M-1$ with equal weights $\\dfrac{1}{M}$, and require $M \\geq N_{\\max} - N_{\\min} + 1$ to avoid aliasing in the DFT of $G(\\phi_m)$; for $N_{\\min} = 116$ and $N_{\\max} = 128$, the minimal $M$ is $13$.\n\nB. Choose $M$ points $\\phi_m = \\dfrac{2\\pi m}{M-1}$ for $m = 0,1,\\dots,M-1$ with equal weights $\\dfrac{1}{M}$, and require $M \\geq N_{\\max}$ to avoid aliasing; for $N_{\\min} = 116$ and $N_{\\max} = 128$, the minimal $M$ is $128$.\n\nC. Choose $M$ points $\\phi_m = \\dfrac{2\\pi (m + 1/2)}{M}$ for $m = 0,1,\\dots,M-1$ with equal weights $\\dfrac{1}{M}$, and $M$ can be arbitrary because the trapezoidal rule is exact for periodic analytic functions; for $N_{\\min} = 116$ and $N_{\\max} = 128$, any $M$ suffices.\n\nD. Choose $M$ points $\\phi_m = \\dfrac{2\\pi m}{M}$ for $m = 0,1,\\dots,M-1$ with weights $\\dfrac{2\\pi}{M}$, and require $M$ to be even to correctly capture even-number parity states; for $N_{\\min} = 116$ and $N_{\\max} = 128$, the minimal even $M$ is $14$.\n\nE. Choose $M$ points $\\phi_m = \\dfrac{2\\pi m}{M}$ for $m = 0,1,\\dots,M-1$ with equal weights $\\dfrac{1}{M}$, and require $M = 2\\big(N_{\\max} - N_{\\min}\\big) + 1$ by a Nyquist criterion; for $N_{\\min} = 116$ and $N_{\\max} = 128$, the minimal $M$ is $25$.", "solution": "The problem statement is critically validated as follows.\n\n### Step 1: Extract Givens\n- The particle-number projection operator is $\\hat P_N = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} d\\phi \\, e^{i\\phi(\\hat N - N)}$.\n- The mean-field state is $|\\Phi\\rangle$.\n- The generating function is $G(\\phi) \\equiv \\langle\\Phi|e^{i\\phi \\hat N}|\\Phi\\rangle$, which is $2\\pi$-periodic.\n- The probability distribution for particle number $n$ is $w_n \\equiv \\langle\\Phi|\\hat P_n|\\Phi\\rangle = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} d\\phi \\, e^{-i \\phi n} \\, G(\\phi)$.\n- Assumption: The non-negligible Fourier components $w_n$ of $G(\\phi)$ are within a contiguous range $n \\in [N_{\\min}, N_{\\max}]$.\n- The span of this range is $L \\equiv N_{\\max} - N_{\\min} + 1$.\n- Task: Propose a discrete quadrature for $\\hat P_N$ and find the minimal number of quadrature points $M$ to avoid aliasing.\n- Specific case: $N_{\\min} = 116$ and $N_{\\max} = 128$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem describes particle-number projection via gauge-angle integration. This is a standard, well-established method in computational nuclear physics and many-body theory, used to restore a symmetry broken at the mean-field level (e.g., in Hartree-Fock-Bogoliubov theory). The mathematical formulation using a Fourier integral is correct. The problem is scientifically sound.\n- **Well-Posed:** The problem asks for the minimum number of sample points required to correctly compute a set of Fourier coefficients of a band-limited periodic function. This is a classic problem in signal processing with a unique, well-defined answer based on the sampling theorem. The problem is well-posed.\n- **Objective:** The problem is stated in precise mathematical and physical language, free of any subjectivity or ambiguity.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid** as it is scientifically sound, well-posed, and objective. Proceeding with the solution.\n\n### Derivation\nThe probability $w_n$ of finding $n$ particles in the state $|\\Phi\\rangle$ is given by the integral\n$$\nw_n = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} d\\phi \\, e^{-i \\phi n} \\, G(\\phi).\n$$\nThis expression is precisely the formula for the $n$-th coefficient of the Fourier series expansion of the $2\\pi$-periodic generating function $G(\\phi)$:\n$$\nG(\\phi) = \\sum_{k=-\\infty}^{\\infty} w_k e^{i k \\phi}.\n$$\nThe problem states that $G(\\phi)$ is effectively band-limited, meaning its Fourier coefficients $w_n$ are non-negligible only for $n$ within the integer range $[N_{\\min}, N_{\\max}]$. Thus, the sum can be approximated as:\n$$\nG(\\phi) \\approx \\sum_{n=N_{\\min}}^{N_{\\max}} w_n e^{i n \\phi}.\n$$\nTo compute the coefficients $w_n$ numerically, we discretize the integral. We sample the function $G(\\phi)$ at $M$ equally spaced points $\\phi_m = \\frac{2\\pi m}{M}$ for $m = 0, 1, \\dots, M-1$. Let the samples be $g_m = G(\\phi_m)$.\nThe integral for $w_n$ is approximated using the trapezoidal rule, which for a periodic function integrated over its period simplifies to an equally weighted sum:\n$$\nw_n \\approx \\frac{1}{2\\pi} \\sum_{m=0}^{M-1} G(\\phi_m) e^{-i n \\phi_m} \\Delta\\phi,\n$$\nwhere the step size is $\\Delta\\phi = \\frac{2\\pi}{M}$. Substituting $\\phi_m$ and $\\Delta\\phi$:\n$$\nw_n \\approx \\frac{1}{2\\pi} \\sum_{m=0}^{M-1} g_m e^{-i n \\frac{2\\pi m}{M}} \\frac{2\\pi}{M} = \\frac{1}{M} \\sum_{m=0}^{M-1} g_m e^{-i n \\frac{2\\pi m}{M}}.\n$$\nThis is the definition of the Discrete Fourier Transform (DFT) of the sequence $\\{g_m\\}_{m=0}^{M-1}$, which yields a sequence of approximated coefficients $\\{\\tilde{w}_k\\}_{k=0}^{M-1}$. Let us analyze the effect of this discretization. The computed coefficient $\\tilde{w}_k$ is:\n$$\n\\tilde{w}_k = \\frac{1}{M} \\sum_{m=0}^{M-1} G(\\phi_m) e^{-i k \\frac{2\\pi m}{M}} = \\frac{1}{M} \\sum_{m=0}^{M-1} \\left( \\sum_{n=N_{\\min}}^{N_{\\max}} w_n e^{i n \\frac{2\\pi m}{M}} \\right) e^{-i k \\frac{2\\pi m}{M}}.\n$$\nSwapping the order of summation:\n$$\n\\tilde{w}_k = \\sum_{n=N_{\\min}}^{N_{\\max}} w_n \\left( \\frac{1}{M} \\sum_{m=0}^{M-1} e^{i (n-k) \\frac{2\\pi m}{M}} \\right).\n$$\nThe term in the parenthesis is a discrete sum of roots of unity, which equals $1$ if $n-k$ is an integer multiple of $M$ (i.e., $n \\equiv k \\pmod M$) and $0$ otherwise. Therefore, the computed DFT coefficient $\\tilde{w}_k$ is a sum of all true Fourier coefficients $w_n$ whose indices $n$ are congruent to $k$ modulo $M$:\n$$\n\\tilde{w}_k = \\sum_{j=-\\infty}^{\\infty} w_{k+jM}.\n$$\nThis phenomenon is known as aliasing. To avoid aliasing and recover the true coefficients $w_n$ for $n \\in [N_{\\min}, N_{\\max}]$, we must choose $M$ large enough such that for any two distinct indices $n_1, n_2$ in this range, they are not congruent modulo $M$. That is, $n_1 \\not\\equiv n_2 \\pmod M$ for all $n_1 \\neq n_2$ where $n_1, n_2 \\in [N_{\\min}, N_{\\max}]$.\nThis condition is equivalent to requiring $n_1 - n_2 \\neq jM$ for any non-zero integer $j$. The magnitude of the difference $|n_1 - n_2|$ is at most $N_{\\max} - N_{\\min}$. To prevent any non-zero difference from being a multiple of $M$, we must choose $M$ to be larger than the maximum possible difference:\n$$\nM > N_{\\max} - N_{\\min}.\n$$\nAlternatively, consider the number of distinct integer indices in the support of our signal, which is $L = N_{\\max} - N_{\\min} + 1$. If we choose $M < L$, then by the pigeonhole principle, at least two distinct indices from the set $\\{N_{\\min}, \\dots, N_{\\max}\\}$ must map to the same value modulo $M$, causing aliasing. Therefore, we must have $M \\geq L$.\nThe minimum integer value of $M$ that satisfies this is:\n$$\nM_{\\min} = L = N_{\\max} - N_{\\min} + 1.\n$$\nWith this choice, for any $n_1, n_2 \\in [N_{\\min}, N_{\\max}]$, if $n_1 \\equiv n_2 \\pmod{M_{\\min}}$, then $|n_1 - n_2|$ must be a multiple of $M_{\\min}$. But $|n_1 - n_2| \\leq N_{\\max} - N_{\\min} = M_{\\min} - 1$. The only multiple of $M_{\\min}$ with magnitude less than $M_{\\min}$ is $0$. Thus, $n_1-n_2=0$, which implies $n_1=n_2$. No aliasing occurs between the desired components.\n\nThe discrete approximation of the projection operator $\\hat P_N$ is\n$$\n\\hat P_N \\approx \\frac{1}{M} \\sum_{m=0}^{M-1} e^{i\\phi_m(\\hat N - N)} = \\frac{1}{M} \\sum_{m=0}^{M-1} e^{i\\frac{2\\pi m}{M}(\\hat N - N)}.\n$$\nThis corresponds to a quadrature rule with points $\\phi_m = \\frac{2\\pi m}{M}$ and equal weights $\\frac{1}{M}$.\n\nFor the specific case given, $N_{\\min} = 116$ and $N_{\\max} = 128$:\nThe minimal number of quadrature points is\n$$\nM_{\\min} = N_{\\max} - N_{\\min} + 1 = 128 - 116 + 1 = 12 + 1 = 13.\n$$\n\n### Option-by-Option Analysis\n\n**A. Choose $M$ points $\\phi_m = \\dfrac{2\\pi m}{M}$ for $m = 0,1,\\dots,M-1$ with equal weights $\\dfrac{1}{M}$, and require $M \\geq N_{\\max} - N_{\\min} + 1$ to avoid aliasing in the DFT of $G(\\phi_m)$; for $N_{\\min} = 116$ and $N_{\\max} = 128$, the minimal $M$ is $13$.**\n- The choice of points corresponds to the standard setup for DFT on a periodic function.\n- The weights $\\frac{1}{M}$ are correct for the discretized operator $\\hat P_N$, resulting from the $\\frac{1}{2\\pi}$ prefactor and the trapezoidal rule step size $\\Delta\\phi = \\frac{2\\pi}{M}$.\n- The condition $M \\geq N_{\\max} - N_{\\min} + 1$ is precisely the condition derived to avoid aliasing.\n- The calculation for the minimal $M$ yields $128 - 116 + 1 = 13$, which matches the statement.\n- **Verdict: Correct.**\n\n**B. Choose $M$ points $\\phi_m = \\dfrac{2\\pi m}{M-1}$ for $m = 0,1,\\dots,M-1$ with equal weights $\\dfrac{1}{M}$, and require $M \\geq N_{\\max}$ to avoid aliasing; for $N_{\\min} = 116$ and $N_{\\max} = 128$, the minimal $M$ is $128$.**\n- The choice of points $\\phi_m = \\frac{2\\pi m}{M-1}$ means that $\\phi_0 = 0$ and $\\phi_{M-1} = 2\\pi$. Since $G(\\phi)$ is periodic, $G(\\phi_0) = G(\\phi_{M-1})$, so this sampling scheme is redundant and does not align with the standard $M$-point DFT.\n- The requirement $M \\geq N_{\\max}$ is incorrect. The sampling requirement depends on the bandwidth ($N_{\\max} - N_{\\min}$), not the maximum frequency index ($N_{\\max}$). For a bandpass signal far from zero, this condition is grossly excessive.\n- **Verdict: Incorrect.**\n\n**C. Choose $M$ points $\\phi_m = \\dfrac{2\\pi (m + 1/2)}{M}$ for $m = 0,1,\\dots,M-1$ with equal weights $\\dfrac{1}{M}$, and $M$ can be arbitrary because the trapezoidal rule is exact for periodic analytic functions; for $N_{\\min} = 116$ and $N_{\\max} = 128$, any $M$ suffices.**\n- While the midpoint rule is a valid quadrature, the claim that \"$M$ can be arbitrary\" is false. The trapezoidal rule (and related rules) is exact for a trigonometric polynomial of degree $K$ only if the number of points is sufficiently large (e.g., $M > 2K$). For a band-limited function, if $M$ is less than the number of non-zero Fourier components, aliasing occurs and the integral is not computed correctly. The minimal number of points is determined by the bandwidth, as derived above.\n- **Verdict: Incorrect.**\n\n**D. Choose $M$ points $\\phi_m = \\dfrac{2\\pi m}{M}$ for $m = 0,1,\\dots,M-1$ with weights $\\dfrac{2\\pi}{M}$, and require $M$ to be even to correctly capture even-number parity states; for $N_{\\min} = 116$ and $N_{\\max} = 128$, the minimal even $M$ is $14$.**\n- The weights $\\frac{2\\pi}{M}$ would be for the integral itself, but the operator $\\hat P_N$ includes a $\\frac{1}{2\\pi}$ prefactor, making the effective weights $\\frac{1}{M}$. This is a minor ambiguity.\n- The crucial error is the requirement that \"$M$ to be even\". There is no such general requirement for particle number projection. An odd number of points is perfectly valid. Indeed, for the given case, the minimal number of points is $13$, which is odd. The ability to resolve different particle numbers $n$ depends on the number of points $M$, not its parity.\n- **Verdict: Incorrect.**\n\n**E. Choose $M$ points $\\phi_m = \\dfrac{2\\pi m}{M}$ for $m = 0,1,\\dots,M-1$ with equal weights $\\dfrac{1}{M}$, and require $M = 2\\big(N_{\\max} - N_{\\min}\\big) + 1$ by a Nyquist criterion; for $N_{\\min} = 116$ and $N_{\\max} = 128$, the minimal $M$ is $25$.**\n- This is a misapplication of the Nyquist-Shannon sampling theorem. The theorem, in its simplest form, applies to real-valued low-pass signals. The signal here is complex and band-pass. The number of degrees of freedom to determine is the number of complex Fourier coefficients, which is $L = N_{\\max} - N_{\\min} + 1$. This requires at least $L$ complex samples. The condition $M \\geq L$ is the correct one. The proposed condition $M \\geq 2(N_{\\max} - N_{\\min}) + 1 = 2(L-1)+1 = 2L-1$ is overly stringent and incorrect.\n- For the given case, this incorrect formula yields $M=2(12)+1 = 25$, whereas the true minimum is $13$.\n- **Verdict: Incorrect.**", "answer": "$$\\boxed{A}$$", "id": "3579450"}, {"introduction": "Once we know how to correctly discretize the projection integral, the next practical consideration is computational efficiency. A viable algorithm must be fast enough for large-scale calculations involving many canonical pairs, $K$, and gauge-angle points, $M$. This practice [@problem_id:3579480] challenges you to derive the asymptotic complexity of the projection calculation, which is essential for designing scalable codes that can tackle realistic, computationally demanding problems.", "problem": "Consider a Hartree-Fock-Bogoliubov (HFB) vacuum in the canonical basis with $K$ time-reversed canonical pairs labeled by $k=1,\\dots,K$, each characterized by real Bogoliubov amplitudes $u_k$ and $v_k$ satisfying $u_k^{2}+v_k^{2}=1$. Let $\\hat{R}(\\phi)=\\exp(i\\phi \\hat{N})$ be the gauge rotation generated by the particle-number operator $\\hat{N}$, with gauge angle $\\phi$ measured in radians. The gauge-angle overlap generating function is defined as $G(\\phi)=\\langle \\Phi|\\hat{R}(\\phi)|\\Phi\\rangle$, which factorizes in the canonical basis as\n$$\nG(\\phi)=\\prod_{k=1}^{K}\\left(u_k^{2}+v_k^{2}\\,\\exp\\!\\left(i\\,2\\phi\\right)\\right).\n$$\nDiscretize the gauge angle on the uniform mesh $\\phi_m=\\frac{2\\pi m}{M}$ for $m=0,1,\\dots,M-1$, and define the discrete number-projected weights\n$$\nn_{N}=\\frac{1}{M}\\sum_{m=0}^{M-1}\\exp\\!\\left(-i\\,N\\,\\phi_m\\right)\\,G(\\phi_m),\\quad N=0,1,\\dots,M-1,\n$$\nwhich constitute the discrete Fourier transform of the samples $G(\\phi_m)$. Assume a unit-cost arithmetic model in which each complex multiplication and each complex addition has cost $1$, precomputation of $\\exp(i\\,2\\phi_m)$ over all $m$ has cost proportional to $M$, and that no reuse across different $m$ beyond this precomputation is possible when forming $G(\\phi_m)$.\n\nStarting from these definitions and cost-model assumptions only, and using the well-established arithmetic complexity of the Fast Fourier Transform (FFT) for a length-$M$ transform, derive the asymptotic arithmetic operation count required to compute all $G(\\phi_m)$ and then all $n_N$ for $N=0,\\dots,M-1$ by:\n- first forming all $G(\\phi_m)$ directly from the canonical-factor product, and\n- then computing all $n_N$ using a single length-$M$ FFT.\n\nExpress your final answer as a single asymptotic complexity in Big-$\\mathcal{O}$ notation as a function of $M$ and $K$. No numerical rounding is required, and no physical units apply to the final answer. The angle $\\phi$ is in radians.", "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded in the established theory of Hartree-Fock-Bogoliubov (HFB) mean-field models and the standard technique of particle-number projection. The problem is well-posed, objective, and provides a clear computational task with a self-contained cost model.\n\nThe objective is to determine the asymptotic arithmetic operation count required to compute a set of number-projected weights, $\\{n_N\\}$, from an HFB state. The computation is specified to proceed in two distinct stages:\n1.  Direct computation of the gauge-angle overlap generating function $G(\\phi_m)$ for $M$ discrete gauge angles $\\phi_m$.\n2.  Computation of the weights $n_N$ from the values of $G(\\phi_m)$ using a single Fast Fourier Transform (FFT).\n\nWe will analyze the arithmetic complexity of each stage separately and then sum them to find the total complexity. The analysis will strictly adhere to the provided unit-cost model for complex arithmetic, where each complex multiplication and each complex addition incurs a cost of $1$.\n\n**Stage 1: Computation of the Generating Function $G(\\phi_m)$**\n\nThe generating function is given by the product over $K$ canonical pairs:\n$$\nG(\\phi_m) = \\prod_{k=1}^{K}\\left(u_k^{2}+v_k^{2}\\,\\exp\\!\\left(i\\,2\\phi_m\\right)\\right)\n$$\nwhere $\\phi_m = \\frac{2\\pi m}{M}$ for $m=0, 1, \\dots, M-1$.\n\nThe problem specifies that these values are to be computed by directly evaluating the product for each value of $m$. The values of $\\exp(i\\,2\\phi_m)$ are precomputed for all $m$ at a total cost stated to be proportional to $M$, which is $\\mathcal{O}(M)$. Let us denote the precomputed complex numbers as $W_m = \\exp(i\\,2\\phi_m)$. Furthermore, the real-valued squares of the Bogoliubov amplitudes, $u_k^2$ and $v_k^2$, can be precomputed for all $k=1, \\dots, K$. This requires $2K$ real multiplications, which is a cost of $\\mathcal{O}(K)$.\n\nWe first analyze the cost to compute a single value $G(\\phi_m)$ for a fixed $m$. The computation involves calculating $K$ terms of the form $T_{k,m} = u_k^2 + v_k^2 W_m$ and then multiplying them together.\n\nFor a fixed $k$ and $m$:\n1.  The product $v_k^2 W_m$ involves multiplying a real number ($v_k^2$) by a complex number ($W_m$). Under the specified cost model, this is counted as $1$ complex multiplication.\n2.  The sum $u_k^2 + (v_k^2 W_m)$ involves adding a real number ($u_k^2$) to the resulting complex number. This is counted as $1$ complex addition.\n\nThus, computing one term $T_{k,m}$ requires $2$ arithmetic operations. To compute all $K$ terms for a fixed $m$, the cost is $2K$ operations.\n\nNext, these $K$ complex terms must be multiplied together to form $G(\\phi_m)$. This requires $K-1$ complex multiplications.\nThe total cost to compute a single $G(\\phi_m)$ is therefore $(2K) + (K-1) = 3K-1$ operations. In asymptotic notation, the cost for a single $G(\\phi_m)$ is $\\mathcal{O}(K)$.\n\nThe problem states that this calculation must be performed for each $m=0, 1, \\dots, M-1$, and explicitly prohibits any reuse of intermediate calculations across different values of $m$. Therefore, we must multiply the cost for a single point by the number of points, $M$. The total cost for computing all $\\{G(\\phi_m)\\}_{m=0}^{M-1}$ is $M \\times \\mathcal{O}(K) = \\mathcal{O}(MK)$.\n\nThe total cost for Stage 1 is the sum of costs for precomputation and the main calculation: $\\mathcal{O}(M) + \\mathcal{O}(K) + \\mathcal{O}(MK)$. Since $K \\ge 1$ and $M \\ge 1$ for a non-trivial problem, the $\\mathcal{O}(MK)$ term is dominant. The asymptotic complexity of Stage 1 is $\\mathcal{O}(MK)$.\n\n**Stage 2: Computation of the Projected Weights $n_N$ via FFT**\n\nThe discrete number-projected weights are defined by:\n$$\nn_{N}=\\frac{1}{M}\\sum_{m=0}^{M-1}G(\\phi_m)\\,\\exp\\!\\left(-i\\,N\\,\\phi_m\\right) = \\frac{1}{M}\\sum_{m=0}^{M-1}G(\\phi_m)\\,\\exp\\!\\left(-\\frac{2\\pi i}{M} Nm\\right)\n$$\nfor $N=0, 1, \\dots, M-1$. This expression is precisely the definition of the Discrete Fourier Transform (DFT) of the sequence $\\{G(\\phi_m)\\}_{m=0}^{M-1}$, followed by a scaling of all components by $\\frac{1}{M}$.\n\nThe problem instructs to use the Fast Fourier Transform (FFT) algorithm. The arithmetic complexity of a length-$M$ FFT is well-established to be $\\mathcal{O}(M \\log M)$. This single transform computes the value of the sum for all $N=0, 1, \\dots, M-1$.\n\nAfter the FFT computes the sums, each of the $M$ resulting values must be multiplied by the scalar factor $\\frac{1}{M}$. This final scaling step requires $M$ additional multiplications, which corresponds to a cost of $\\mathcal{O}(M)$.\n\nThe total complexity for Stage 2 is the sum of the FFT cost and the scaling cost: $\\mathcal{O}(M \\log M) + \\mathcal{O}(M)$. The logarithmic term is dominant, so the asymptotic complexity of Stage 2 is $\\mathcal{O}(M \\log M)$.\n\n**Total Asymptotic Complexity**\n\nThe total arithmetic complexity of the entire procedure is the sum of the complexities of the two stages:\n$$\n\\text{Total Cost} = \\text{Cost(Stage 1)} + \\text{Cost(Stage 2)} = \\mathcal{O}(MK) + \\mathcal{O}(M \\log M)\n$$\nThis can be written more compactly by factoring out $M$:\n$$\n\\text{Total Cost} = \\mathcal{O}(M(K + \\log M))\n$$\nThis final expression represents the total asymptotic arithmetic operation count as a function of the number of canonical pairs, $K$, and the number of discretization points, $M$.", "answer": "$$\n\\boxed{\\mathcal{O}\\left(M\\left(K+\\log M\\right)\\right)}\n$$", "id": "3579480"}, {"introduction": "In realistic scenarios, such as systems with weak pairing, a naive implementation of the projection formulas can fail spectacularly due to the limitations of floating-point arithmetic. This final exercise [@problem_id:3579469] delves into the advanced topic of numerical stability, asking you to diagnose potential pitfalls like cancellation error and underflow. You will then evaluate and justify robust algorithms, a critical skill for developing production-quality scientific software.", "problem": "Consider an even-particle Hartree–Fock–Bogoliubov (HFB) quasiparticle vacuum in the canonical basis with time-reversed pairs indexed by $k$, and Bogoliubov amplitudes $\\{u_k,v_k\\}$ satisfying $u_k^2+v_k^2=1$. Let the particle-number operator be $\\hat{N}$, and define the gauge-angle generating function $G(\\phi)$ and the particle-number probability $n_N$ by the fundamental projection relations\n$$\nG(\\phi)\\equiv \\langle\\Phi|e^{i\\phi \\hat{N}}|\\Phi\\rangle,\\qquad\nn_N\\equiv \\frac{1}{2\\pi}\\int_{0}^{2\\pi} d\\phi\\, e^{-iN\\phi}\\, G(\\phi),\n$$\nwhere $|\\Phi\\rangle$ is the HFB vacuum. Assume a large system with $K$ canonical pairs (typical of medium–heavy nuclei), where many pairs are weakly paired in the sense that either $v_k\\ll 1$ or $u_k\\ll 1$ for a significant fraction of $k$. The mean particle number is $\\langle \\hat{N}\\rangle = \\sum_k 2 v_k^2$.\n\nYou will analyze the sensitivity of $n_N$ to floating-point roundoff and cancellation when evaluated numerically in double precision, and identify algorithms that ensure stable particle-number projection in weak-pairing regimes.\n\nUsing only the stated definitions and the standard properties of the HFB canonical product state\n$$\n|\\Phi\\rangle \\propto \\prod_{k} \\left(u_k + v_k\\, a_k^\\dagger a_{\\bar{k}}^\\dagger\\right)|0\\rangle,\n$$\nwhere $a_k^\\dagger$ creates a particle in single-particle state $k$ and $a_{\\bar{k}}^\\dagger$ creates its time-reversed partner, address the following:\n\n1. Derive from first principles how $G(\\phi)$ factorizes over canonical pairs, and express it in terms of $\\{u_k,v_k\\}$ and $\\phi$. Use this to write $n_N$ as a Fourier coefficient of a product over $k$.\n2. In the weak-pairing limit for a subset $\\mathcal{W}$ of pairs with $v_k\\ll 1$, show that each pair-wise factor contributing to $G(\\phi)$ can be written as $1+\\epsilon_k(\\phi)$ with $\\epsilon_k(\\phi)$ small, and deduce how direct multiplication of many such near-unity complex factors in double precision can accumulate relative error of order $\\mathcal{O}(K\\,\\epsilon_{\\mathrm{mach}})$, where $\\epsilon_{\\mathrm{mach}}$ is the machine epsilon. Explain why subsequent Fourier integration over $\\phi$ can suffer severe cancellation leading to large relative errors in the tails of $n_N$.\n3. Propose and justify algorithmic strategies that control underflow/overflow and cancellation while preserving normalization $\\sum_N n_N = 1$ and the mean $\\sum_N N\\,n_N = \\langle \\hat{N}\\rangle$.\n\nWhich of the following strategies are correct for ensuring numerical stability of $n_N$ in weak-pairing regimes, while maintaining physical fidelity?\n\nA. Compute $G(\\phi)$ by direct multiplication in double precision and evaluate $n_N$ using a uniform discrete Fourier transform over $\\phi$ without any rescaling, because all pair factors have magnitude bounded by $1$ so the product remains numerically well-behaved.\n\nB. Accumulate $G(\\phi)$ in the logarithmic domain, computing for each $\\phi$ the sums $S(\\phi)=\\sum_k \\ln\\!\\left\\lvert u_k^2 + v_k^2 e^{i 2\\phi}\\right\\rvert$ and $\\Theta(\\phi)=\\sum_k \\arg\\!\\left(u_k^2 + v_k^2 e^{i 2\\phi}\\right)$ using numerically stable primitives (such as $\\ln(1+z)$ for small $z$ and the two-argument arctangent), reconstruct $G(\\phi)=\\exp\\!\\big(S(\\phi)\\big)\\,e^{i\\Theta(\\phi)}$, and perform the Fourier transform on a rescaled array $\\tilde{G}(\\phi)=G(\\phi)/\\max_{\\phi}\\lvert G(\\phi)\\rvert$ to avoid underflow/overflow and cancellation.\n\nC. Replace any amplitude with $v_k<10^{-12}$ or $u_k<10^{-12}$ by exactly zero to eliminate roundoff errors; this thresholding has negligible impact on $n_N$ compared to machine precision and improves stability without bias.\n\nD. Use the equivalence of $n_N$ to coefficients of a generating polynomial in $x$ for pair occupancies, computing $n_N$ via stable discrete convolution of polynomials $\\prod_k \\left(u_k^2 + v_k^2 x^2\\right)$ with per-step normalization and compensated summation; this avoids oscillatory integrals and controls dynamic range across the full support of $n_N$.\n\nE. Order the pair-wise factors by descending magnitude and multiply in that order; this guarantees removal of floating-point roundoff error down to machine precision regardless of how small $v_k$ or $u_k$ are.\n\nSelect all correct options.", "solution": "The user wants a detailed analysis of a problem concerning the numerical stability of particle-number projection in computational nuclear physics, followed by an evaluation of proposed strategies.\n\n### Step 1: Extract Givens\n- **State**: An even-particle Hartree–Fock–Bogoliubov (HFB) quasiparticle vacuum, $|\\Phi\\rangle$, in the canonical basis with time-reversed pairs indexed by $k$.\n- **Amplitudes**: Bogoliubov amplitudes $\\{u_k, v_k\\}$ for each pair $k$, satisfying the normalization $u_k^2 + v_k^2 = 1$.\n- **Operators and Definitions**:\n    - Particle-number operator: $\\hat{N}$.\n    - Gauge-angle generating function: $G(\\phi) \\equiv \\langle\\Phi|e^{i\\phi \\hat{N}}|\\Phi\\rangle$.\n    - Particle-number probability: $n_N \\equiv \\frac{1}{2\\pi}\\int_{0}^{2\\pi} d\\phi\\, e^{-iN\\phi}\\, G(\\phi)$.\n- **State Structure**: The HFB vacuum is a product state of the form $|\\Phi\\rangle \\propto \\prod_{k} (u_k + v_k a_k^\\dagger a_{\\bar{k}}^\\dagger)|0\\rangle$.\n- **System Properties**: The system is large with $K$ canonical pairs. A significant fraction of pairs are weakly paired, meaning $v_k \\ll 1$ or $u_k \\ll 1$.\n- **Mean Particle Number**: $\\langle \\hat{N}\\rangle = \\sum_k 2 v_k^2$.\n- **Precision**: Numerical evaluation is performed in double precision.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientific or Factual Unsoundness**: The problem is firmly grounded in the theory of nuclear structure, specifically the HFB many-body method and the technique of particle-number projection. The definitions of $G(\\phi)$ and $n_N$ are standard in this field. The numerical stability issues described (roundoff error, cancellation, underflow/overflow) are real challenges in scientific computing. The problem is free of pseudoscience or factual errors.\n2.  **Non-Formalizable or Irrelevant**: The problem is highly formal and directly relevant to the topic of particle-number projection from mean-field states within computational nuclear physics.\n3.  **Incomplete or Contradictory Setup**: The problem is self-contained. It provides the explicit form of the HFB state, the definitions for the quantities to be calculated, and the physical context (weak pairing). The normalization $u_k^2+v_k^2=1$ is standard for real amplitudes in the canonical basis. The setup is consistent.\n4.  **Unrealistic or Infeasible**: The conditions described are not only realistic but typical for calculations in medium-to-heavy nuclei, where the pairing interaction creates a diffuse Fermi surface characterized by many weakly paired states (small $v_k$ or small $u_k$).\n5.  **Ill-Posed or Poorly Structured**: The problem is well-posed. The questions asked are precise and lead to a definite analysis of numerical algorithms. The terms are standard and unambiguous in the context of computational physics.\n6.  **Pseudo-Profound, Trivial, or Tautological**: The problem addresses a genuine and non-trivial challenge in computational physics. Achieving stable and accurate particle-number projection, especially for systems with a large particle-number variance or in weak-pairing regimes, requires sophisticated numerical techniques beyond a naive implementation.\n7.  **Outside Scientific Verifiability**: The claims about algorithm stability are scientifically verifiable through both theoretical error analysis and numerical experiments.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid**. It is a well-formulated, scientifically sound, and relevant problem in computational nuclear physics. I will proceed with the solution.\n\n### Derivations and Analysis\n\nAs directed by the problem prompt, I will first derive the necessary expressions and analyze the numerical challenges before evaluating the options.\n\n#### 1. Derivation of $G(\\phi)$ and $n_N$\nThe HFB vacuum state in the canonical basis is a product state over pairs $(k, \\bar{k})$:\n$$|\\Phi\\rangle = \\prod_k |\\Phi_k\\rangle = \\prod_k (u_k + v_k a_k^\\dagger a_{\\bar{k}}^\\dagger)|0\\rangle$$\nAssuming real amplitudes, the normalization $\\langle\\Phi_k|\\Phi_k\\rangle = u_k^2\\langle0|0\\rangle + v_k^2\\langle0|a_{\\bar{k}} a_k a_k^\\dagger a_{\\bar{k}}^\\dagger|0\\rangle = u_k^2 + v_k^2 = 1$ ensures that the total state $|\\Phi\\rangle$ is normalized.\n\nThe particle-number operator $\\hat{N} = \\sum_j a_j^\\dagger a_j$ is additive, so its exponential is multiplicative: $e^{i\\phi \\hat{N}} = \\prod_j e^{i\\phi a_j^\\dagger a_j}$. The operator for a given pair $k$ is $e^{i\\phi (\\hat{N}_k + \\hat{N}_{\\bar{k}})}$, where $\\hat{N}_k = a_k^\\dagger a_k$.\n\nThe matrix element $G(\\phi)$ factorizes over the pairs due to the product structure of both the state and the operator:\n$$G(\\phi) = \\langle\\Phi|e^{i\\phi \\hat{N}}|\\Phi\\rangle = \\prod_k \\langle\\Phi_k|e^{i\\phi (\\hat{N}_k + \\hat{N}_{\\bar{k}})}|\\Phi_k\\rangle$$\nLet's evaluate the factor for a single pair $k$. The state $|\\Phi_k\\rangle$ is a superposition of a $0$-particle component $u_k|0\\rangle$ and a $2$-particle component $v_k a_k^\\dagger a_{\\bar{k}}^\\dagger|0\\rangle$. The number operator is diagonal in the Fock basis:\n$$e^{i\\phi (\\hat{N}_k + \\hat{N}_{\\bar{k}})}|\\Phi_k\\rangle = e^{i\\phi (\\hat{N}_k + \\hat{N}_{\\bar{k}})}(u_k|0\\rangle + v_k a_k^\\dagger a_{\\bar{k}}^\\dagger|0\\rangle) = u_k e^{i\\phi \\cdot 0}|0\\rangle + v_k e^{i\\phi \\cdot 2}a_k^\\dagger a_{\\bar{k}}^\\dagger|0\\rangle$$\nThe matrix element for one pair is then:\n$$\\langle\\Phi_k|\\dots|\\Phi_k\\rangle = \\langle0|(u_k+v_k a_{\\bar{k}}a_k) (u_k|0\\rangle + v_k e^{i2\\phi} a_k^\\dagger a_{\\bar{k}}^\\dagger|0\\rangle) = u_k^2 + v_k^2 e^{i2\\phi}$$\nThus, the generating function is a product of these pair-wise complex factors:\n$$G(\\phi) = \\prod_{k=1}^K \\left(u_k^2 + v_k^2 e^{i2\\phi}\\right)$$\nThe particle-number probability $n_N$ is the Fourier coefficient of this function:\n$$n_N = \\frac{1}{2\\pi}\\int_0^{2\\pi} d\\phi\\, e^{-iN\\phi} \\prod_{k=1}^K \\left(u_k^2 + v_k^2 e^{i2\\phi}\\right)$$\n\n#### 2. Numerical Stability Analysis for Weak Pairing\nIn the weak-pairing limit for a pair $k$, we have either $v_k \\ll 1$ (and $u_k^2 = 1 - v_k^2 \\approx 1$) or $u_k \\ll 1$ (and $v_k^2 = 1 - u_k^2 \\approx 1$).\n\nCase 1: $v_k \\ll 1$. The pair-wise factor is $g_k(\\phi) = u_k^2 + v_k^2 e^{i2\\phi} = (1-v_k^2) + v_k^2 e^{i2\\phi} = 1 + v_k^2(e^{i2\\phi}-1)$. This is of the form $1+\\epsilon_k(\\phi)$, where $|\\epsilon_k(\\phi)| = |v_k^2(e^{i2\\phi}-1)| \\leq 2v_k^2 \\ll 1$. Evaluating this expression as `1 + term` in floating-point arithmetic can suffer from loss of significance if `$term$` is close to or smaller than the machine epsilon $\\epsilon_{\\mathrm{mach}}$.\n\nWhen multiplying many such near-unity complex factors, say $G_m = \\prod_{k=1}^m g_k(\\phi)$, the floating-point computation is $\\tilde{G}_m = \\tilde{G}_{m-1} \\otimes g_m(\\phi) \\approx (G_{m-1} \\prod_{j=1}^{m-1}(1+\\delta_j)) \\times g_m(\\phi) (1+\\delta_m)$, where $|\\delta_j| \\le \\epsilon_{\\mathrm{mach}}$. The accumulated relative error after $K$ multiplications is approximately $\\sum_{j=1}^{K-1} \\delta_j$, which in the worst case is of order $\\mathcal{O}(K\\,\\epsilon_{\\mathrm{mach}})$. This can be significant for large $K$.\n\nThe Fourier integral $n_N = \\frac{1}{2\\pi}\\int_0^{2\\pi} d\\phi\\, e^{-iN\\phi} G(\\phi)$ computes a small number (for $N$ in the tails of the distribution) by integrating a highly oscillatory function. The magnitude of $G(\\phi)$ can vary drastically. $|G(0)|=1$. The minimum can be very small. For example, if there are many pairs with $u_k \\approx v_k$, $|G(\\pi/2)| = \\prod_k |u_k^2-v_k^2|$ can easily underflow. Numerically evaluating the integral (e.g., via Discrete Fourier Transform) involves summing many complex numbers of comparable magnitude that cancel each other out to produce a much smaller result. This is a classic example of catastrophic cancellation, leading to a large relative error in the computed $n_N$.\n\n#### 3. Algorithmic Strategies\nTo combat these issues, stable algorithms must be employed.\n- **To control underflow/overflow and roundoff in the product**: Instead of computing the product $G(\\phi) = \\prod_k g_k(\\phi)$ directly, it is far more stable to compute its logarithm: $\\ln G(\\phi) = \\sum_k \\ln g_k(\\phi)$. This converts a product over a large dynamic range into a sum, which is numerically stable.\n- **To control cancellation in factor evaluation**: To compute $\\ln g_k(\\phi) = \\ln(1 + v_k^2(e^{i2\\phi}-1))$ for small $v_k$, one should use a stable `log1p(z)` function, which computes $\\ln(1+z)$ accurately for small $|z|$.\n- **To avoid Fourier transform cancellation**: A completely different approach is to recognize that $G(\\phi)$ is a polynomial in $z=e^{i\\phi}$. Let $x=z^2=e^{i2\\phi}$. Then $G(\\phi) = \\prod_k (u_k^2 + v_k^2 x)$. The probability $n_N$ is non-zero only for even $N=2m$, and $n_{2m}$ is the coefficient of $x^m$ in this polynomial product. These coefficients can be computed recursively via polynomial convolution:\n$$P^{(k)}(x) = P^{(k-1)}(x) \\cdot (u_k^2 + v_k^2 x)$$\nIf $c_m^{(k)}$ is the coefficient of $x^m$ in $P^{(k)}(x)$, the recurrence relation is:\n$$c_m^{(k)} = c_m^{(k-1)} u_k^2 + c_{m-1}^{(k-1)} v_k^2$$\nstarting with $c_0^{(0)}=1$. This involves only sums and products of positive real numbers, completely avoiding oscillatory integrals and complex arithmetic. The dynamic range of the coefficients $c_m^{(k)}$ can be controlled by normalizing the coefficient vector at each step $k$. This is a highly stable and accurate method.\n\n### Evaluation of Options\n\n**A. Compute $G(\\phi)$ by direct multiplication in double precision and evaluate $n_N$ using a uniform discrete Fourier transform over $\\phi$ without any rescaling, because all pair factors have magnitude bounded by $1$ so the product remains numerically well-behaved.**\nThis describes the most naive approach. The premise that $|g_k(\\phi)| \\le 1$ is true, which prevents overflow. However, it does not prevent underflow. For $\\phi$ away from $0$, $|G(\\phi)|$ can become smaller than the smallest representable double-precision number. Furthermore, this approach ignores the accumulation of relative error in the product and the catastrophic cancellation in both the evaluation of the factors `1 + small_term` and the final Fourier transform. The claim that the product is \"numerically well-behaved\" is false.\n**Verdict: Incorrect.**\n\n**B. Accumulate $G(\\phi)$ in the logarithmic domain, computing for each $\\phi$ the sums $S(\\phi)=\\sum_k \\ln\\!\\left\\lvert u_k^2 + v_k^2 e^{i 2\\phi}\\right\\rvert$ and $\\Theta(\\phi)=\\sum_k \\arg\\!\\left(u_k^2 + v_k^2 e^{i 2\\phi}\\right)$ using numerically stable primitives (such as $\\ln(1+z)$ for small $z$ and the two-argument arctangent), reconstruct $G(\\phi)=\\exp\\!\\big(S(\\phi)\\big)\\,e^{i\\Theta(\\phi)}$, and perform the Fourier transform on a rescaled array $\\tilde{G}(\\phi)=G(\\phi)/\\max_{\\phi}\\lvert G(\\phi)\\rvert$ to avoid underflow/overflow and cancellation.**\nThis strategy addresses several key problems correctly. Accumulating in the logarithmic domain prevents underflow/overflow in the product calculation. Using primitives like `ln(1+z)` (often called `log1p()`) and `atan2()` ensures the terms $\\ln(g_k(\\phi))$ are computed accurately, avoiding the cancellation issue for near-unity factors. The final reconstruction and Fourier transform step still faces inherent cancellation, but the inputs to this step are computed with high fidelity. The rescaling described is trivial since $\\max_\\phi |G(\\phi)| = |G(0)| = 1$, but the overall set of techniques (log-accumulation, stable primitives) represents a valid and significant improvement for numerical stability and maintains physical fidelity.\n**Verdict: Correct.**\n\n**C. Replace any amplitude with $v_k<10^{-12}$ or $u_k<10^{-12}$ by exactly zero to eliminate roundoff errors; this thresholding has negligible impact on $n_N$ compared to machine precision and improves stability without bias.**\nThis strategy introduces a systematic error, or bias. Setting $v_k=0$ implies the pair $(k,\\bar{k})$ is always unoccupied, reducing the mean particle number by $2v_k^2$. Setting $u_k=0$ (so $v_k=1$) implies the pair is always occupied, artificially forcing its two particles into every component of the projected wave function. While the change from a single pair might be small, the cumulative effect can be significant, and it fundamentally alters the physics of the HFB state. A robust numerical method should reduce error without introducing bias. The claim that this is done \"without bias\" is false.\n**Verdict: Incorrect.**\n\n**D. Use the equivalence of $n_N$ to coefficients of a generating polynomial in $x$ for pair occupancies, computing $n_N$ via stable discrete convolution of polynomials $\\prod_k \\left(u_k^2 + v_k^2 x^2\\right)$ with per-step normalization and compensated summation; this avoids oscillatory integrals and controls dynamic range across the full support of $n_N$.**\nThis describes an alternative, highly stable algorithm. By reformulating the problem algebraically, it completely bypasses the evaluation of $G(\\phi)$ and its oscillatory Fourier transform. The recursive convolution involves only positive numbers, eliminating the primary source of cancellation error. The proposed techniques—per-step normalization to control dynamic range and compensated summation to minimize roundoff—are hallmarks of a professionally designed numerical algorithm. This approach is known to be superior in stability for this problem. It is a correct and powerful strategy.\n**Verdict: Correct.**\n\n**E. Order the pair-wise factors by descending magnitude and multiply in that order; this guarantees removal of floating-point roundoff error down to machine precision regardless of how small $v_k$ or $u_k$ are.**\nThis strategy is based on a weak heuristic and makes grossly exaggerated claims. While sorting can sometimes help in reducing error for sums (specifically by summing from smallest to largest), it is not a general panacea for products and certainly does not \"guarantee removal\" of roundoff error. The error in a product accumulates multiplicatively, and simple reordering does not eliminate this. Moreover, this strategy fails to address the root causes of instability: the subtractive cancellation in calculating the factors $g_k(\\phi)$ themselves and the catastrophic cancellation in the Fourier integral. The claim is demonstrably false.\n**Verdict: Incorrect.**", "answer": "$$\\boxed{BD}$$", "id": "3579469"}]}