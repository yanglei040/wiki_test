{"hands_on_practices": [{"introduction": "The first practical step in any CDCC calculation is to define a finite model space that is large enough to ensure converged results. This exercise explores the convergence of scattering observables as a function of the truncation limits on the projectile's internal angular momentum, $l_{\\max}$, and the projectile-target relative angular momentum, $L_{\\max}$ [@problem_id:3552265]. By working with a simplified, analytically solvable model, you will develop a physical intuition for how these fundamental cutoffs are chosen and how they impact the accuracy of the calculation.", "problem": "Consider a simplified implementation of the Continuum-Discretized Coupled-Channel (CDCC) method for a two-body projectile scattering on a structureless target. The continuum-discretized coupled-channel method expands the full scattering wave function in a coupled-channel basis built from projectile internal states and center-of-mass (c.m.) partial waves. In this problem, you will implement truncation schemes in the projectile internal orbital angular momentum $l$ and the c.m. orbital angular momentum $L$, justify the chosen cutoffs on physical grounds using semiclassical and centrifugal barrier arguments, and assess their impact on elastic and breakup observables by examining convergence trends as the truncation bounds increase.\n\nStart from the following fundamental bases:\n\n- The Lippmann-Schwinger equation for the transition matrix $T$: $$T(E) = V + V G_0(E) T(E),$$ where $G_0(E)$ is the free resolvent and $V$ is the interaction.\n- The definition of the reactance matrix $K$ (also known as the $K$-matrix) via principal value integration, leading to a unitary scattering matrix $S$ given by $$S = (I - i K)(I + i K)^{-1},$$ with $I$ the identity matrix.\n- The partial-wave expansion for the c.m. motion, where a given c.m. orbital angular momentum $L$ corresponds semiclassically to an impact parameter $b \\approx (L + 1/2)/k$ for c.m. wave number $k$, and large $L$ probe large $b$ where the interaction is weak.\n- The centrifugal barrier for projectile internal motion, where for an internal orbital angular momentum $l$ and projectile size scale $a_{\\text{proj}}$, the centrifugal energy scale at radius $a_{\\text{proj}}$ is approximately $$E_{\\text{cent}}(l) \\approx \\frac{l(l+1)\\hbar^2}{2 \\mu a_{\\text{proj}}^2},$$ with reduced mass $\\mu$.\n\nTo make the computation tractable while preserving unitarity and the spirit of CDCC, adopt a rank-one separable coupling model per c.m. partial wave $L$, with a channel basis comprised of one elastic channel (projectile ground state) and a set of discretized continuum channels indexed by $(l,n)$, where $l$ is the projectile internal orbital angular momentum and $n$ enumerates bins in internal continuum energy. For each fixed $L$, define a coupling vector $v^{(L)}$ whose components are\n$$v^{(L)}_0 = g_0 f_L(L), \\quad v^{(L)}_{(l,n)} = g_0 \\beta f_L(L) f_l(l) b_n,$$\nwhere $g_0$ is a base coupling strength, $\\beta$ is a dimensionless ratio controlling elastic-to-breakup coupling balance, $f_L(L)$ and $f_l(l)$ are physically motivated form factors enforcing the decay of couplings with increasing $L$ and $l$, and $b_n$ are bin weights satisfying $\\sum_n b_n^2 = 1$ for each $l$. Use the rank-one $K$-matrix\n$$K^{(L)} = v^{(L)} \\left(v^{(L)}\\right)^{\\mathrm{T}}$$\nto construct the unitary $S$-matrix for each $L$ via\n$$S^{(L)} = \\left(I - i K^{(L)}\\right)\\left(I + i K^{(L)}\\right)^{-1}.$$\n\nDefine the form factors using semiclassical and barrier arguments:\n- For c.m. partial waves, use $$f_L(L) = \\exp\\left(-\\left(\\frac{L}{L_c}\\right)^2\\right), \\quad L_c \\equiv k R_{\\text{int}},$$ where $R_{\\text{int}}$ is an effective interaction radius for c.m. dynamics and $k$ is the c.m. wavenumber. This enforces negligible coupling at impact parameters $b \\gg R_{\\text{int}}$, i.e., $L \\gg k R_{\\text{int}}$.\n- For projectile internal motion, use $$f_l(l) = \\exp\\left(-\\left(\\frac{l}{l_c}\\right)^2\\right), \\quad l_c \\equiv a_{\\text{proj}} \\sqrt{2 \\mu E_{\\max}}/\\hbar,$$ where $E_{\\max}$ is the maximum internal continuum energy included, $\\mu$ is the projectile reduced mass, and $a_{\\text{proj}}$ is a characteristic projectile size. This enforces suppression of couplings for $l$ whose centrifugal barrier at $a_{\\text{proj}}$ greatly exceeds $E_{\\max}$.\n\nFor each $L$, define the elastic survival probability and breakup probability from the unitary $S$-matrix elements:\n$$P_{\\text{el}}^{(L)} = \\left|S^{(L)}_{00}\\right|^2, \\quad P_{\\text{bu}}^{(L)} = \\sum_{\\alpha \\neq 0} \\left|S^{(L)}_{\\alpha 0}\\right|^2,$$\nwhere $0$ denotes the elastic channel and $\\alpha$ runs over the discretized continuum channels $(l,n)$. Because $S^{(L)}$ is unitary in this model, one has $P_{\\text{el}}^{(L)} + P_{\\text{bu}}^{(L)} = 1$ for every $L$.\n\nAggregate observables across c.m. partial waves using the usual $(2L+1)$ weight:\n$$\\overline{P}_{\\text{el}} = \\frac{\\sum_{L=0}^{L_{\\max}} (2L+1) P_{\\text{el}}^{(L)}}{\\sum_{L=0}^{L_{\\max}} (2L+1)}, \\quad \\overline{P}_{\\text{bu}} = \\frac{\\sum_{L=0}^{L_{\\max}} (2L+1) P_{\\text{bu}}^{(L)}}{\\sum_{L=0}^{L_{\\max}} (2L+1)}.$$\n\nImplement truncation schemes by restricting the internal orbital angular momentum to $0 \\le l \\le l_{\\max}$ and the c.m. orbital angular momentum to $0 \\le L \\le L_{\\max}$. Physically justify the cutoffs using:\n- The c.m. semiclassical argument $L_{\\text{phys}} \\approx \\lceil k R_{\\text{int}} \\rceil$, suggesting negligible contributions for $L \\gg k R_{\\text{int}}$.\n- The internal centrifugal barrier argument $l_{\\text{phys}} \\approx \\lceil a_{\\text{proj}} \\sqrt{2 \\mu E_{\\max}}/\\hbar \\rceil$, suggesting negligible couplings to $l$ beyond the point where $E_{\\text{cent}}(l)$ exceeds $E_{\\max}$.\n\nUse natural units with $\\hbar = 1$, $\\mu = 1$, and express all final observables as dimensionless decimals. The discretized continuum uses $N_{\\text{bins}}$ bins per $l$ with equal weights $b_n = 1/\\sqrt{N_{\\text{bins}}}$.\n\nYou must implement the program with the following fixed physical and model parameters (constant across all test cases):\n- c.m. wavenumber $k = 0.7$,\n- interaction radius $R_{\\text{int}} = 5.0$,\n- projectile size $a_{\\text{proj}} = 2.0$,\n- reduced mass $\\mu = 1.0$,\n- maximum internal continuum energy $E_{\\max} = 2.0$,\n- base coupling strength $g_0 = 0.5$,\n- elastic-to-breakup ratio $\\beta = 1.0$,\n- number of bins per $l$: $N_{\\text{bins}} = 6$.\n\nDefine the following test suite of truncations, which probes different regimes (below physical cutoffs, at cutoffs, and well above), and includes an edge case with insufficient internal $l_{\\max}$ but saturated $L_{\\max}$:\n- Test Case 1: $(l_{\\max}, L_{\\max}) = (0, 2)$,\n- Test Case 2: $(l_{\\max}, L_{\\max}) = (4, 4)$,\n- Test Case 3: $(l_{\\max}, L_{\\max}) = (8, 20)$,\n- Test Case 4: $(l_{\\max}, L_{\\max}) = (1, 10)$.\n\nFor each test case, compute $\\overline{P}_{\\text{el}}$ and $\\overline{P}_{\\text{bu}}$ as defined above. Additionally, assess convergence by computing, for each test case, the scalar difference to a reference with the largest truncations in the suite (take $(l_{\\max}, L_{\\max}) = (8, 20)$ as the reference):\n$$D_{\\text{ref}} = \\left|\\overline{P}_{\\text{el}} - \\overline{P}_{\\text{el}}^{\\text{ref}}\\right| + \\left|\\overline{P}_{\\text{bu}} - \\overline{P}_{\\text{bu}}^{\\text{ref}}\\right|,$$\nwhich is dimensionless.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain, in order for Test Cases 1 through 4: the triple $(\\overline{P}_{\\text{el}}, \\overline{P}_{\\text{bu}}, D_{\\text{ref}})$ for each test case. For example, the output format must be\n$$[\\overline{P}_{\\text{el}}^{(1)}, \\overline{P}_{\\text{bu}}^{(1)}, D_{\\text{ref}}^{(1)}, \\overline{P}_{\\text{el}}^{(2)}, \\overline{P}_{\\text{bu}}^{(2)}, D_{\\text{ref}}^{(2)}, \\overline{P}_{\\text{el}}^{(3)}, \\overline{P}_{\\text{bu}}^{(3)}, D_{\\text{ref}}^{(3)}, \\overline{P}_{\\text{el}}^{(4)}, \\overline{P}_{\\text{bu}}^{(4)}, D_{\\text{ref}}^{(4)}],$$\nwith all values as dimensionless decimals.", "solution": "The problem requires the implementation of a simplified Continuum-Discretized Coupled-Channel (CDCC) model to study projectile scattering. The validation confirms that the problem statement is scientifically grounded, self-contained, and well-posed. We proceed with a principled derivation of the solution.\n\nThe core of the problem lies in calculating scattering observables for a system described by a set of coupled Schrödinger equations, truncated to a finite model space. Our model simplifies this by using a rank-one separable reactance matrix ($K$-matrix) for each center-of-mass (c.m.) partial wave, indexed by orbital angular momentum $L$. This approach guarantees a unitary scattering matrix ($S$-matrix), which is essential for preserving probability conservation.\n\nFirst, we establish the physical scales of the problem using the provided parameters in natural units ($\\hbar=1$, $\\mu=1$).\nThe c.m. wavenumber is $k=0.7$, and the interaction radius is $R_{\\text{int}}=5.0$. The characteristic c.m. angular momentum, $L_c$, which defines the form factor $f_L(L)$, is given by $L_c \\equiv k R_{\\text{int}}$.\n$$L_c = (0.7) \\times (5.0) = 3.5$$\nSemiclassically, this corresponds to an impact parameter $b \\approx L_c/k = R_{\\text{int}}$. For $L \\gg L_c$, the projectile-target separation is large, and the interaction becomes negligible. A reasonable physical cutoff for the $L$ summation is $L_{\\text{phys}} \\approx \\lceil L_c \\rceil = \\lceil 3.5 \\rceil = 4$. The form factor $f_L(L) = \\exp(-(L/L_c)^2)$ implements this physical intuition by suppressing couplings for $L  L_c$.\n\nSimilarly, for the projectile's internal motion, we have projectile size $a_{\\text{proj}}=2.0$, reduced mass $\\mu=1.0$, and maximum internal continuum energy $E_{\\max}=2.0$. The characteristic internal angular momentum, $l_c$, is determined by the point at which the centrifugal barrier energy equals $E_{\\max}$.\n$$l_c \\equiv a_{\\text{proj}} \\sqrt{2 \\mu E_{\\max}}/\\hbar = (2.0) \\sqrt{2 \\times 1.0 \\times 2.0} / 1 = 4.0$$\nA reasonable physical cutoff for the internal angular momentum is $l_{\\text{phys}} \\approx \\lceil l_c \\rceil = \\lceil 4.0 \\rceil = 4$. Couplings to internal states with $l  l_c$ are strongly suppressed by the centrifugal barrier, a feature captured by the form factor $f_l(l) = \\exp(-(l/l_c)^2)$. The chosen test cases properly explore truncations below, at, and above these physical cutoffs ($l_{\\text{phys}}=4$, $L_{\\text{phys}}=4$).\n\nFor each partial wave $L$ and a given internal truncation $l_{\\max}$, the channel space consists of one elastic channel (indexed by $0$) and a set of discretized continuum (breakup) channels. The breakup channels are indexed by $(\\alpha = (l,n))$, where $l \\in [0, 1, \\dots, l_{\\max}]$ and $n \\in [0, 1, \\dots, N_{\\text{bins}}-1]$. The total number of channels is $N_{\\text{ch}} = 1 + (l_{\\max}+1) \\times N_{\\text{bins}}$.\n\nThe model defines a rank-one $K$-matrix for each $L$:\n$$K^{(L)} = v^{(L)} \\left(v^{(L)}\\right)^{\\mathrm{T}}$$\nwhere $v^{(L)}$ is a real vector of dimension $N_{\\text{ch}}$. Its components are given by:\n$$v^{(L)}_0 = g_0 f_L(L)$$\n$$v^{(L)}_{(l,n)} = g_0 \\beta f_L(L) f_l(l) b_n$$\nwith constants $g_0=0.5$, $\\beta=1.0$, and $b_n = 1/\\sqrt{N_{\\text{bins}}} = 1/\\sqrt{6}$.\n\nThe $S$-matrix is related to the $K$-matrix by $S = (I - iK)(I + iK)^{-1}$. This can be simplified to $S = I - 2iK(I+iK)^{-1}$. For a rank-one matrix $K = vv^{\\mathrm{T}}$, the inverse $(I+iK)^{-1}$ can be found using the Sherman-Morrison formula: $(I+ivv^{\\mathrm{T}})^{-1} = I - \\frac{i}{1+iv^{\\mathrm{T}}v}vv^{\\mathrm{T}}$. Substituting this yields a simple expression for $S^{(L)}$:\n$$S^{(L)} = I - 2i(v^{(L)} (v^{(L)})^{\\mathrm{T}}) \\left(I - \\frac{i}{1+i\\|v^{(L)}\\|^2} v^{(L)} (v^{(L)})^{\\mathrm{T}}\\right)$$\n$$S^{(L)} = I - 2i v^{(L)} (v^{(L)})^{\\mathrm{T}} \\left(1 - \\frac{i\\|v^{(L)}\\|^2}{1+i\\|v^{(L)}\\|^2}\\right) = I - 2i v^{(L)} (v^{(L)})^{\\mathrm{T}} \\left(\\frac{1}{1+i\\|v^{(L)}\\|^2}\\right)$$\n$$S^{(L)} = I - \\frac{2i}{1+i\\|v^{(L)}\\|^2} v^{(L)} (v^{(L)})^{\\mathrm{T}}$$\nwhere $\\|v^{(L)}\\|^2 = (v^{(L)})^{\\mathrm{T}}v^{(L)}$ is the squared norm of the coupling vector. The elements of the $S$-matrix are thus:\n$$S^{(L)}_{ij} = \\delta_{ij} - \\frac{2i}{1+i\\|v^{(L)}\\|^2} v^{(L)}_i v^{(L)}_j$$\n\nFrom this, we derive the elastic and breakup probabilities for partial wave $L$.\nThe elastic probability is $P_{\\text{el}}^{(L)} = |S^{(L)}_{00}|^2$:\n$$S^{(L)}_{00} = 1 - \\frac{2i (v^{(L)}_0)^2}{1+i\\|v^{(L)}\\|^2} = \\frac{1+i\\|v^{(L)}\\|^2 - 2i(v^{(L)}_0)^2}{1+i\\|v^{(L)}\\|^2} = \\frac{1 + i\\left(\\|v^{(L)}\\|_{\\text{bu}}^2 - (v^{(L)}_0)^2\\right)}{1+i\\|v^{(L)}\\|^2}$$\nwhere we define $\\|v^{(L)}\\|_{\\text{bu}}^2 = \\sum_{\\alpha \\neq 0} (v^{(L)}_\\alpha)^2$. The probability is then:\n$$P_{\\text{el}}^{(L)} = |S^{(L)}_{00}|^2 = \\frac{1 + \\left(\\|v^{(L)}\\|_{\\text{bu}}^2 - (v^{(L)}_0)^2\\right)^2}{1 + (\\|v^{(L)}\\|^2)^2}$$\nThe total breakup probability $P_{\\text{bu}}^{(L)} = \\sum_{\\alpha \\neq 0} |S^{(L)}_{\\alpha 0}|^2$ is:\n$$S^{(L)}_{\\alpha 0} = -\\frac{2i v^{(L)}_\\alpha v^{(L)}_0}{1+i\\|v^{(L)}\\|^2}$$\n$$P_{\\text{bu}}^{(L)} = \\sum_{\\alpha \\neq 0} \\left|-\\frac{2i v^{(L)}_\\alpha v^{(L)}_0}{1+i\\|v^{(L)}\\|^2}\\right|^2 = \\frac{4 (v^{(L)}_0)^2}{|1+i\\|v^{(L)}\\|^2|^2} \\sum_{\\alpha \\neq 0}(v^{(L)}_\\alpha)^2 = \\frac{4 (v^{(L)}_0)^2 \\|v^{(L)}\\|_{\\text{bu}}^2}{1 + (\\|v^{(L)}\\|^2)^2}$$\nAs shown in the validation thought process, these expressions satisfy $P_{\\text{el}}^{(L)} + P_{\\text{bu}}^{(L)} = 1$, confirming unitarity.\n\nThe calculation for a given truncation $(l_{\\max}, L_{\\max})$ proceeds as follows:\n1. For each $L \\in [0, 1, \\dots, L_{\\max}]$:\n    a. Calculate $f_L(L) = \\exp(-(L/L_c)^2)$.\n    b. Calculate $(v_0^{(L)})^2 = (g_0 f_L(L))^2$.\n    c. Calculate $\\|v^{(L)}\\|^2_{\\text{bu}} = \\sum_{l=0}^{l_{\\max}} \\sum_{n=0}^{N_{\\text{bins}}-1} (g_0 \\beta f_L(L) f_l(l) b_n)^2$. Since $\\sum_n b_n^2 = 1$, this simplifies to $\\|v^{(L)}\\|^2_{\\text{bu}} = (g_0 \\beta f_L(L))^2 \\sum_{l=0}^{l_{\\max}} (f_l(l))^2$.\n    d. Calculate $\\|v^{(L)}\\|^2 = (v_0^{(L)})^2 + \\|v^{(L)}\\|^2_{\\text{bu}}$.\n    e. Compute $P_{\\text{el}}^{(L)}$ and $P_{\\text{bu}}^{(L)}$ using the formulas above.\n2. The total observables are obtained by summing over partial waves with weight $(2L+1)$:\n$$\\overline{P}_{\\text{el}} = \\frac{\\sum_{L=0}^{L_{\\max}} (2L+1) P_{\\text{el}}^{(L)}}{\\sum_{L=0}^{L_{\\max}} (2L+1)}, \\quad \\overline{P}_{\\text{bu}} = 1 - \\overline{P}_{\\text{el}}$$\nThe denominator is simply $(L_{\\max}+1)^2$.\n\nFinally, we assess convergence. The reference calculation uses $(l_{\\max}, L_{\\max}) = (8, 20)$, which is well above the physical cutoffs, yielding $\\overline{P}_{\\text{el}}^{\\text{ref}}$ and $\\overline{P}_{\\text{bu}}^{\\text{ref}}$. For each test case, we compute the difference metric:\n$$D_{\\text{ref}} = |\\overline{P}_{\\text{el}} - \\overline{P}_{\\text{el}}^{\\text{ref}}| + |\\overline{P}_{\\text{bu}} - \\overline{P}_{\\text{bu}}^{\\text{ref}}|$$\nDue to unitarity ($\\overline{P}_{\\text{el}} + \\overline{P}_{\\text{bu}} = 1$), this simplifies to $D_{\\text{ref}} = 2|\\overline{P}_{\\text{el}} - \\overline{P}_{\\text{el}}^{\\text{ref}}|$. For the reference case itself, $D_{\\text{ref}}$ is definitionally $0$. The implementation will follow this logic to calculate the required triples $(\\overline{P}_{\\text{el}}, \\overline{P}_{\\text{bu}}, D_{\\text{ref}})$ for each test case.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the simplified CDCC problem for a given set of test cases.\n    \"\"\"\n\n    # --- Fixed Physical and Model Parameters ---\n    k = 0.7          # c.m. wavenumber\n    R_int = 5.0      # interaction radius\n    a_proj = 2.0     # projectile size\n    mu = 1.0         # reduced mass\n    E_max = 2.0      # maximum internal continuum energy\n    g0 = 0.5         # base coupling strength\n    beta = 1.0       # elastic-to-breakup ratio\n    N_bins = 6       # number of bins per l\n    hbar = 1.0       # Planck constant (natural units)\n    \n    # --- Characteristic Angular Momenta ---\n    L_c = k * R_int\n    l_c = a_proj * np.sqrt(2 * mu * E_max) / hbar\n\n    # --- Test Suite ---\n    test_cases = [\n        (0, 2),   # Test Case 1\n        (4, 4),   # Test Case 2\n        (8, 20),  # Test Case 3 (Reference)\n        (1, 10),  # Test Case 4\n    ]\n\n    def calculate_observables(l_max, L_max):\n        \"\"\"\n        Calculates integrated probabilities for given truncations.\n        \n        Args:\n            l_max (int): Maximum internal orbital angular momentum.\n            L_max (int): Maximum c.m. orbital angular momentum.\n            \n        Returns:\n            tuple: A tuple containing (P_el_bar, P_bu_bar).\n        \"\"\"\n        sum_pel_num = 0.0\n        sum_pbu_num = 0.0\n\n        # Pre-calculate sum over f_l(l)^2 as it's independent of L\n        f_l_sq_sum = 0.0\n        for l_val in range(l_max + 1):\n            f_l = np.exp(-((l_val / l_c)**2))\n            f_l_sq_sum += f_l**2\n        \n        for L_val in range(L_max + 1):\n            f_L = np.exp(-((L_val / L_c)**2))\n            \n            # v0^2: elastic channel part of coupling norm squared\n            v0_sq = (g0 * f_L)**2\n            \n            # Sum over breakup channels. The sum over bins 'n' gives 1.\n            # v_bu^2: breakup channels part of coupling norm squared\n            v_bu_sq = (g0 * beta * f_L)**2 * f_l_sq_sum\n            \n            # Total norm squared of the coupling vector v^(L)\n            v_norm_sq = v0_sq + v_bu_sq\n\n            if v_norm_sq  1e-15: # Negligible coupling for very high L\n                P_el_L = 1.0\n                P_bu_L = 0.0\n            else:\n                # Calculate partial wave probabilities using derived formulas\n                numerator_pel = 1 + (v_bu_sq - v0_sq)**2\n                denominator = 1 + v_norm_sq**2\n                P_el_L = numerator_pel / denominator\n                P_bu_L = 1.0 - P_el_L # By unitarity\n            \n            # Weight by (2L+1)\n            weight = 2 * L_val + 1\n            sum_pel_num += weight * P_el_L\n            sum_pbu_num += weight * P_bu_L\n            \n        # Normalization factor for the sums\n        norm_factor = (L_max + 1)**2\n\n        if norm_factor == 0:\n            return 1.0, 0.0\n\n        P_el_bar = sum_pel_num / norm_factor\n        P_bu_bar = sum_pbu_num / norm_factor\n        \n        return P_el_bar, P_bu_bar\n\n    # --- Main Calculation Loop ---\n    \n    # First, calculate reference values from the case with largest truncations\n    ref_l_max, ref_L_max = 8, 20\n    P_el_ref, P_bu_ref = calculate_observables(ref_l_max, ref_L_max)\n    \n    all_results = []\n    \n    for l_max, L_max in test_cases:\n        P_el, P_bu = calculate_observables(l_max, L_max)\n        \n        # Calculate the convergence metric D_ref\n        # D_ref = |P_el - P_el_ref| + |P_bu - P_bu_ref| = 2 * |P_el - P_el_ref|\n        D_ref = 2.0 * np.abs(P_el - P_el_ref)\n        \n        all_results.extend([P_el, P_bu, D_ref])\n\n    # Format output as a single comma-separated list in brackets\n    output_str = f\"[{','.join(f'{val:.8f}' for val in all_results)}]\"\n    print(output_str)\n\nsolve()\n```", "id": "3552265"}, {"introduction": "Moving beyond conceptual models, realistic CDCC calculations require the direct numerical solution of the coupled Schrödinger equations. This practice guides you through implementing a numerical solver to study how truncating the multipole expansion of the coupling potentials, controlled by $\\lambda_{\\max}$, affects scattering probabilities and the unitarity of the $S$-matrix [@problem_id:3552310]. This provides foundational experience with the numerical machinery of coupled-channel methods and demonstrates the importance of the interaction's structure in determining reaction dynamics.", "problem": "Consider a simplified Continuum-Discretized Coupled-Channel (CDCC) scattering problem in one partial wave where the projectile-target relative motion is described by coupled radial equations derived from the time-independent Schrödinger equation. Work in natural units such that $\\hbar^2/(2\\mu)=1$, so that energies and potentials have the same units as inverse length squared. Assume $s$-wave scattering (orbital angular momentum $L=0$) and $N=3$ channels: a ground-state channel labeled $i=0$ and two discretized continuum bins labeled $i=1$ and $i=2$. The total energy in the entrance channel is $E$, and the intrinsic excitation energies of the bins are $\\epsilon_0=0$, $\\epsilon_1$, and $\\epsilon_2$, leading to channel wave numbers $k_i=\\sqrt{E-\\epsilon_i}$, which you must assume are real and positive (all channels open). The coupled equations for the reduced radial wave functions $u_i(R)$ are\n$$\nu_i''(R) \\;=\\; \\sum_{j=0}^{N-1} \\left[V_{ij}(R) - k_i^2 \\delta_{ij}\\right] u_j(R),\n$$\nwith regular boundary conditions at the origin. The coupling potential matrix is a multipole expansion truncated at multipole order $\\lambda_{\\max}$,\n$$\nV(R;\\lambda_{\\max}) \\;=\\; \\sum_{\\lambda=0}^{\\lambda_{\\max}} F_{\\lambda}(R)\\, C^{(\\lambda)},\n$$\nwhere $F_{\\lambda}(R)$ are short-ranged radial form factors and $C^{(\\lambda)}$ are real symmetric structure matrices encoding the channel couplings for multipole $\\lambda$. The multipole truncation index $\\lambda_{\\max}$ controls how many multipoles are retained. The goal is to perform a sensitivity study on $\\lambda_{\\max}$ and quantify its effect on the unitarity of the scattering matrix and on observable predictions.\n\nStarting points and definitions you must use:\n- The time-independent multichannel Schrödinger equation in matrix form with real Hermitian potential leads to unitary scattering for open channels.\n- For $L=0$, the asymptotic free solutions of the reduced radial equation in each open channel are proportional to the Riccati-Hankel functions, which for $L=0$ reduce to $\\hat{h}_0^{\\pm}(x)=e^{\\pm i x}$, with derivatives $\\mathrm{d}\\hat{h}_0^{\\pm}/\\mathrm{d}R = \\pm i k\\, e^{\\pm i k R}$.\n- The physical scattering solution for an incoming wave in channel $c$ can be written asymptotically as a superposition of incoming and outgoing waves, and the scattering matrix $S$ can be extracted by matching the numerically propagated regular solutions to these asymptotic forms at a large radius where the potential is negligible.\n\nIn this problem, use the following specific, scientifically plausible and self-consistent model ingredients:\n- Number of channels $N=3$.\n- Total energy $E = 4.0$.\n- Intrinsic energies $\\epsilon_0=0.0$, $\\epsilon_1=0.5$, $\\epsilon_2=1.0$, so that $k_0=\\sqrt{4.0}$, $k_1=\\sqrt{3.5}$, $k_2=\\sqrt{3.0}$.\n- Radial form factors\n$$\nF_{\\lambda}(R) \\;=\\; V_0\\, \\alpha^{\\lambda}\\, \\left(\\frac{R}{R_0}\\right)^{\\lambda} \\exp\\!\\left(-\\left(\\frac{R}{R_0}\\right)^{2}\\right),\n$$\nwith $V_0 = 1.0$, $\\alpha=0.4$, and $R_0=2.0$.\n- Real symmetric structure matrices $C^{(\\lambda)}$ for $\\lambda=0,1,2,3,4$ defined as:\n    - $C^{(0)} = \\mathrm{diag}(-0.5,-0.45,-0.4)$.\n    - $C^{(1)}$ has nonzero off-diagonals $(0,1)=(1,0)=0.2$ and $(1,2)=(2,1)=0.2$, zeros elsewhere.\n    - $C^{(2)}$ has diagonal $(0.05,0.04,0.03)$ and off-diagonals $(0,2)=(2,0)=0.1$, zeros elsewhere.\n    - $C^{(3)}$ has off-diagonals $(0,1)=(1,0)=0.05$ and $(1,2)=(2,1)=-0.05$, zeros elsewhere.\n    - $C^{(4)}$ has diagonal $(0.02,0.02,0.02)$ and off-diagonals $(0,2)=(2,0)=0.03$, zeros elsewhere.\n- For $\\lambda\\lambda_{\\max}$, $C^{(\\lambda)}$ are not included in the sum.\n- Propagate the fundamental matrix of $N$ linearly independent regular solutions from $R_{\\min}$ to $R_{\\max}$ using the first-order system\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}R}\\begin{pmatrix}U\\\\ U'\\end{pmatrix} \\;=\\; \\begin{pmatrix} U' \\\\ Q(R)\\, U \\end{pmatrix}, \\quad Q(R) \\equiv V(R;\\lambda_{\\max}) - K^2,\\quad K^2=\\mathrm{diag}(k_0^2,k_1^2,k_2^2),\n$$\nwith initial conditions at small radius $R_{\\min}$ given by $U(R_{\\min}) = R_{\\min}\\, I$ and $U'(R_{\\min}) = I$, where $I$ is the $N\\times N$ identity.\n- At the matching radius $R_{\\max}$ where the potential is negligible, construct the logarithmic derivative matrix $Y=U'(R_{\\max})\\, U(R_{\\max})^{-1}$, and define the diagonal matrices $H^{\\pm}=\\mathrm{diag}(e^{\\pm i k_i R_{\\max}})$ and $(H^{\\pm})'=\\mathrm{diag}(\\pm i k_i e^{\\pm i k_i R_{\\max}})$. The scattering matrix $S$ for the open channels satisfies the linear system\n$$\n\\left[-Y H^{+} + (H^{+})'\\right] S \\;=\\; (H^{-})' - Y H^{-}.\n$$\n- Consider an incoming wave in channel $c=0$. Define the elastic probability $P_{\\mathrm{el}}=|S_{00}|^2$, the inelastic probabilities $P_{01}=|S_{10}|^2$ and $P_{02}=|S_{20}|^2$, and the unitarity defect $D=\\left|1 - \\left(P_{\\mathrm{el}} + P_{01} + P_{02}\\right)\\right|$.\n\nYour task is to write a complete program that:\n- Implements the above model and numerical procedure.\n- Uses the following numerical parameters: $R_{\\min}=1\\times 10^{-5}$, $R_{\\max}=30.0$, and integrates with a robust ordinary differential equation solver with absolute tolerance $\\mathrm{atol}=1\\times 10^{-12}$ and relative tolerance $\\mathrm{rtol}=1\\times 10^{-9}$.\n- Computes, for each $\\lambda_{\\max}$ in the test suite $\\{\\;0,\\;1,\\;2,\\;3,\\;4\\;\\}$, the quantities $D$, $P_{\\mathrm{el}}$, $P_{01}$, and $P_{02}$ as defined above.\n\nExpress all outputs as unitless floating-point numbers. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered by increasing $\\lambda_{\\max}$, and flattened as\n$$\n[\\;D(\\lambda_{\\max}{=}0),\\; P_{\\mathrm{el}}(\\lambda_{\\max}{=}0),\\; P_{01}(\\lambda_{\\max}{=}0),\\; P_{02}(\\lambda_{\\max}{=}0),\\; \\dots,\\; D(\\lambda_{\\max}{=}4),\\; P_{\\mathrm{el}}(\\lambda_{\\max}{=}4),\\; P_{01}(\\lambda_{\\max}{=}4),\\; P_{02}(\\lambda_{\\max}{=}4)\\;].\n$$\n\nThe test suite is therefore the set of parameter values $\\lambda_{\\max}\\in\\{\\,0,\\,1,\\,2,\\,3,\\,4\\,\\}$. The expected data types for each entry in the final list are floating-point numbers. Angles are implicitly in radians through the plane-wave factors $e^{\\pm i k_i R}$, and you must use radians consistently. All quantities are dimensionless in the chosen units.", "solution": "The problem requires the numerical solution of a set of coupled radial Schrödinger equations to model a simplified nuclear scattering process within the Continuum-Discretized Coupled-Channel (CDCC) framework. The objective is to analyze the sensitivity of scattering observables to the truncation of the multipole expansion of the coupling potential. The analysis is performed for a $3$-channel system with all channels open, considering only $s$-wave ($L=0$) scattering.\n\nThe governing equations are a system of $N=3$ coupled second-order ordinary differential equations (ODEs) for the reduced radial wave functions $u_i(R)$, where $R$ is the projectile-target separation:\n$$\nu_i''(R) \\;=\\; \\sum_{j=0}^{N-1} \\left[V_{ij}(R) - k_i^2 \\delta_{ij}\\right] u_j(R)\n$$\nHere, $k_i = \\sqrt{E - \\epsilon_i}$ is the wave number in channel $i$, with $E$ being the total energy and $\\epsilon_i$ the intrinsic excitation energy of the channel. The problem specifies $E=4.0$ and $\\{\\epsilon_0, \\epsilon_1, \\epsilon_2\\} = \\{0.0, 0.5, 1.0\\}$, which results in real channel wave numbers $k_0=2.0$, $k_1=\\sqrt{3.5}$, and $k_2=\\sqrt{3.0}$. The units are chosen such that $\\hbar^2/(2\\mu)=1$.\n\nThe coupling potential matrix $V(R)$ is constructed from a truncated multipole expansion:\n$$\nV(R;\\lambda_{\\max}) \\;=\\; \\sum_{\\lambda=0}^{\\lambda_{\\max}} F_{\\lambda}(R)\\, C^{(\\lambda)}\n$$\nwhere $\\lambda_{\\max}$ is the maximum multipole order included. The radial form factors $F_{\\lambda}(R)$ are given by a Gaussian functional form, and the structure matrices $C^{(\\lambda)}$ are provided as real, symmetric constant matrices. This ensures the total potential $V(R;\\lambda_{\\max})$ is Hermitian (real and symmetric), a condition for flux conservation and a unitary scattering matrix ($S$-matrix).\n\nThe numerical solution is obtained by recasting the second-order system into a first-order system for a $3 \\times 3$ matrix of fundamental solutions, $U(R)$, and its derivative, $U'(R)$. The columns of $U(R)$ represent three linearly independent solutions that are regular at the origin. The first-order system is:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}R}\\begin{pmatrix} U(R) \\\\ U'(R) \\end{pmatrix} \\;=\\; \\begin{pmatrix} 0  I \\\\ Q(R)  0 \\end{pmatrix} \\begin{pmatrix} U(R) \\\\ U'(R) \\end{pmatrix} \\;=\\; \\begin{pmatrix} U'(R) \\\\ Q(R)\\, U(R) \\end{pmatrix}\n$$\nwhere $I$ is the $3 \\times 3$ identity matrix and $Q(R) = V(R;\\lambda_{\\max}) - K^2$, with $K^2 = \\mathrm{diag}(k_0^2, k_1^2, k_2^2)$. For $s$-wave scattering, regular solutions behave as $u_i(R) \\propto R$ near $R=0$. This dictates the initial conditions for the fundamental matrix solution at a small radius $R_{\\min}$:\n$$\nU(R_{\\min}) = R_{\\min} \\cdot I, \\quad U'(R_{\\min}) = I\n$$\nThis system of $2N^2 = 18$ coupled first-order ODEs is integrated numerically from $R=R_{\\min}$ to a large matching radius $R=R_{\\max}$, where the short-range potential $V(R)$ is negligible. For this problem, $R_{\\min}=10^{-5}$ and $R_{\\max}=30.0$. We use a high-precision ODE solver (`scipy.integrate.solve_ivp`) to obtain $U(R_{\\max})$ and $U'(R_{\\max})$.\n\nAt $R_{\\max}$, the numerical solution is matched to the known asymptotic form of the scattering wave functions to extract the $S$-matrix. The asymptotic solution is a linear combination of incoming and outgoing waves, which for $L=0$ are simple plane waves, $e^{-ik_i R}$ and $e^{+ik_i R}$, respectively. This matching is conveniently performed using the logarithmic derivative matrix, $Y$, defined as:\n$$\nY = U'(R_{\\max}) [U(R_{\\max})]^{-1}\n$$\nThe $S$-matrix is then found by solving the following linear matrix equation:\n$$\n\\left[ (H^{+})' - Y H^{+} \\right] S \\;=\\; (H^{-})' - Y H^{-}\n$$\nwhere $H^{\\pm} = \\mathrm{diag}(e^{\\pm i k_i R_{\\max}})$ and $(H^{\\pm})' = \\mathrm{diag}(\\pm i k_i e^{\\pm i k_i R_{\\max}})$ are diagonal matrices containing the values and derivatives of the asymptotic basis functions at the matching radius. This is a system of the form $A S = B$, which is solved for the complex matrix $S$.\n\nThe analysis is conducted for an incoming wave in the ground state (channel $c=0$). The relevant scattering observables are determined from the first column of the resulting $S$-matrix ($S_{j0}$):\n- Elastic probability: $P_{\\mathrm{el}} = |S_{00}|^2$\n- Inelastic probabilities: $P_{01} = |S_{10}|^2$ and $P_{02} = |S_{20}|^2$\n- Unitarity defect: $D = |1 - (P_{\\mathrm{el}} + P_{01} + P_{02})| = \\left|1 - \\sum_{j=0}^{2} |S_{j0}|^2\\right|$. This quantity measures the deviation from flux conservation. For an exact unitary calculation, $D$ would be zero.\n\nThe described procedure is implemented for each value of the truncation parameter $\\lambda_{\\max}$ in the set $\\{0, 1, 2, 3, 4\\}$. The resulting four observables ($D$, $P_{\\mathrm{el}}$, $P_{01}$, $P_{02}$) are calculated for each $\\lambda_{\\max}$ and presented in a flattened list as the final result.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the CDCC scattering problem for a range of multipole truncations.\n    \"\"\"\n    # === Problem Parameters ===\n    N = 3  # Number of channels\n    E = 4.0  # Total energy\n    epsilons = np.array([0.0, 0.5, 1.0])  # Intrinsic energies\n    \n    # Form factor parameters\n    V0 = 1.0\n    R0 = 2.0\n    alpha = 0.4\n\n    # Numerical integration parameters\n    R_min = 1e-5\n    R_max = 30.0\n    atol = 1e-12\n    rtol = 1e-9\n\n    # Derived constants\n    k_squared = E - epsilons\n    k = np.sqrt(k_squared)\n    K2_mat = np.diag(k_squared)\n\n    # Structure Matrices C^(lambda)\n    C0 = np.diag([-0.5, -0.45, -0.4])\n    C1 = np.array([[0.0, 0.2, 0.0], [0.2, 0.0, 0.2], [0.0, 0.2, 0.0]])\n    C2 = np.array([[0.05, 0.0, 0.1], [0.0, 0.04, 0.0], [0.1, 0.0, 0.03]])\n    C3 = np.array([[0.0, 0.05, 0.0], [0.05, 0.0, -0.05], [0.0, -0.05, 0.0]])\n    C4 = np.array([[0.02, 0.0, 0.03], [0.0, 0.02, 0.0], [0.03, 0.0, 0.02]])\n    C_matrices = [C0, C1, C2, C3, C4]\n\n    # Test cases for lambda_max\n    test_cases = [0, 1, 2, 3, 4]\n    \n    final_results = []\n\n    for lambda_max in test_cases:\n        \n        def get_potential(R):\n            \"\"\"Computes the potential matrix V(R) for a given lambda_max.\"\"\"\n            V_mat = np.zeros((N, N))\n            # Avoid R=0 issues, though R_min  0\n            if R == 0:\n                # Only lambda=0 contributes at R=0\n                V_mat += V0 * C_matrices[0]\n                return V_mat\n\n            R_over_R0_sq = (R / R0)**2\n            exp_term = np.exp(-R_over_R0_sq)\n\n            # F_lambda(R) = V0 * alpha^lambda * (R/R0)^lambda * exp(-(R/R0)^2)\n            # F_lambda = F_{lambda-1} * alpha * (R/R0)\n            F_lambda_val = V0 * exp_term\n            for lam in range(lambda_max + 1):\n                V_mat += F_lambda_val * C_matrices[lam]\n                # Prepare for next iteration\n                F_lambda_val *= alpha * (R / R0)\n            return V_mat\n\n        def ode_system(R, y):\n            \"\"\"Defines the first-order system dy/dR for the ODE solver.\"\"\"\n            # y contains flattened U and U' matrices\n            # y = [u11, u12, ..., u33, u'11, u'12, ..., u'33]\n            U = y[:N*N].reshape((N, N))\n            U_prime = y[N*N:].reshape((N, N))\n            \n            # dU/dR = U'\n            dU_dR = U_prime\n            \n            # dU'/dR = (V(R) - K^2) U(R)\n            V_R = get_potential(R)\n            Q_R = V_R - K2_mat\n            dU_prime_dR = Q_R @ U\n            \n            # Return flattened derivatives\n            return np.concatenate((dU_dR.flatten(), dU_prime_dR.flatten()))\n\n        # Initial conditions at R_min\n        U0 = R_min * np.identity(N)\n        U_prime0 = np.identity(N)\n        y0 = np.concatenate((U0.flatten(), U_prime0.flatten()))\n        \n        # Integrate the ODE system\n        solution = solve_ivp(\n            ode_system, \n            [R_min, R_max], \n            y0, \n            method='DOP853',  # A robust high-order method\n            atol=atol, \n            rtol=rtol\n        )\n        \n        # Extract solution at R_max\n        y_max = solution.y[:, -1]\n        U_max = y_max[:N*N].reshape((N, N))\n        U_prime_max = y_max[N*N:].reshape((N, N))\n        \n        # Calculate logarithmic derivative matrix Y\n        Y = U_prime_max @ np.linalg.inv(U_max)\n        \n        # Calculate S-matrix\n        H_plus = np.diag(np.exp(1j * k * R_max))\n        H_minus = np.diag(np.exp(-1j * k * R_max))\n        H_plus_prime = np.diag(1j * k * np.exp(1j * k * R_max))\n        H_minus_prime = np.diag(-1j * k * np.exp(-1j * k * R_max))\n        \n        # Solve [ (H^+)' - Y H^+ ] S = (H^-)' - Y H^-\n        A = H_plus_prime - Y @ H_plus\n        B = H_minus_prime - Y @ H_minus\n        S_matrix = np.linalg.solve(A, B)\n        \n        # Calculate observables for incoming wave in channel 0\n        S_col0 = S_matrix[:, 0]\n        P_el = np.abs(S_col0[0])**2\n        P_01 = np.abs(S_col0[1])**2\n        P_02 = np.abs(S_col0[2])**2\n        \n        # Unitarity defect\n        total_prob = P_el + P_01 + P_02\n        D = np.abs(1.0 - total_prob)\n        \n        final_results.extend([D, P_el, P_01, P_02])\n\n    # Print results in the specified format\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n\n```", "id": "3552310"}, {"introduction": "The \"discretized\" aspect of CDCC is crucial for accurately representing the continuous spectrum of breakup states, and the choice of discretization scheme is not trivial. This hands-on problem focuses on the heart of continuum discretization by comparing two common strategies: equal-energy and equal-momentum bins [@problem_id:3552257]. By quantifying how each method resolves a narrow continuum resonance, you will gain a deeper understanding of how the choice of binning scheme can significantly impact the accuracy of computed observables.", "problem": "Consider a simplified model for the Continuum-Discretized Coupled-Channel (CDCC) method in computational nuclear physics where the breakup strength into the projectile-target continuum is dominated by a single, narrow resonance in the relative motion. The continuum is approximated by bins constructed either with equal-energy width or equal-momentum width. Your task is to implement and compare these binning schemes by quantifying how they resolve a narrow resonance and how they impact a discretized evaluation of a breakup observable.\n\nStarting point assumptions and definitions:\n- The relative motion is non-relativistic and $s$-wave dominated, with reduced mass $\\mu$ and momentum $k$ related to energy $E$ by\n$$\nE(k) = \\frac{(\\hbar c)^2 k^2}{2 \\mu},\n$$\nwith $\\hbar c = 197.3269804\\,\\text{MeV}\\cdot\\text{fm}$ and $\\mu$ in $\\text{MeV}$ (using $c = 1$).\n- The breakup strength as a function of energy $E$ is modeled by a Breit-Wigner (Lorentzian) line shape centered at a resonance energy $E_R$ with width $\\Gamma$,\n$$\nB(E) = \\frac{(\\Gamma/2)^2}{(E - E_R)^2 + (\\Gamma/2)^2}.\n$$\nThis function is dimensionless and bounded by $B(E_R) = 1$.\n\nBinning schemes:\n- Equal-energy binning: Partition the energy interval $[E_{\\min}, E_{\\max}]$ into $N$ bins of equal width $\\Delta E = (E_{\\max} - E_{\\min})/N$, with bin $i$ spanning $[E_i, E_{i+1}]$ and $E_i = E_{\\min} + i \\Delta E$.\n- Equal-momentum binning: Partition the momentum interval $[k_{\\min}, k_{\\max}]$ into $N$ bins of equal width $\\Delta k$, with $k_{\\min} = \\sqrt{2\\mu E_{\\min}}/(\\hbar c)$ and $k_{\\max} = \\sqrt{2\\mu E_{\\max}}/(\\hbar c)$, bin $j$ spanning $[k_j, k_{j+1}]$ and $k_j = k_{\\min} + j \\Delta k$.\n\nFor each scheme, define:\n1. The bin-averaged resonance strength in bin $i$ (energy bin) as\n$$\n\\overline{B}^{(E)}_i = \\frac{1}{\\Delta E} \\int_{E_i}^{E_{i+1}} B(E)\\, dE,\n$$\nand in bin $j$ (momentum bin) as\n$$\n\\overline{B}^{(k)}_j = \\frac{1}{\\Delta k} \\int_{k_j}^{k_{j+1}} B(E(k))\\, dk.\n$$\n2. The resonance peak resolution metric for each scheme defined by the maximum bin-averaged height ratio\n$$\nH_E = \\frac{\\max_i \\overline{B}^{(E)}_i}{B(E_R)}, \\quad H_k = \\frac{\\max_j \\overline{B}^{(k)}_j}{B(E_R)}.\n$$\n3. The centroid of the most resonant bin (the bin achieving the maximum average) expressed in energy units. For energy bin $i^\\star$,\n$$\nE_{\\text{centroid}}^{(E)} = \\frac{\\int_{E_{i^\\star}}^{E_{i^\\star+1}} E\\, B(E)\\, dE}{\\int_{E_{i^\\star}}^{E_{i^\\star+1}} B(E)\\, dE},\n$$\nand for momentum bin $j^\\star$,\n$$\nE_{\\text{centroid}}^{(k)} = \\frac{\\int_{k_{j^\\star}}^{k_{j^\\star+1}} E(k)\\, B(E(k))\\, dk}{\\int_{k_{j^\\star}}^{k_{j^\\star+1}} B(E(k))\\, dk}.\n$$\nReport the centroid shifts\n$$\n\\Delta E_E = E_{\\text{centroid}}^{(E)} - E_R,\\quad \\Delta E_k = E_{\\text{centroid}}^{(k)} - E_R,\n$$\nexpressed in $\\text{MeV}$.\n4. A discretized approximation to the total breakup strength over $[E_{\\min}, E_{\\max}]$ computed by a Riemann sum of bin-center evaluations. For the energy-binned scheme, use\n$$\nS_E^{\\text{disc}} = \\sum_{i=0}^{N-1} B\\!\\left(E_i + \\frac{\\Delta E}{2}\\right) \\Delta E,\n$$\nand for the momentum-binned scheme, approximate the same energy-domain integral by transforming via the Jacobian,\n$$\n\\frac{dE}{dk} = \\frac{(\\hbar c)^2 k}{\\mu},\n$$\nso that\n$$\nS_k^{\\text{disc}} = \\sum_{j=0}^{N-1} B\\!\\left(E\\!\\left(k_j + \\frac{\\Delta k}{2}\\right)\\right) \\left.\\frac{dE}{dk}\\right|_{k = k_j + \\Delta k/2} \\Delta k.\n$$\nCompare each discretized result to the exact energy-domain integral\n$$\nS_{\\text{exact}} = \\int_{E_{\\min}}^{E_{\\max}} B(E)\\, dE,\n$$\nand report the absolute errors\n$$\n\\varepsilon_E = \\left|S_E^{\\text{disc}} - S_{\\text{exact}}\\right|,\\quad \\varepsilon_k = \\left|S_k^{\\text{disc}} - S_{\\text{exact}}\\right|.\n$$\nExpress $\\varepsilon_E$ and $\\varepsilon_k$ in $\\text{MeV}$.\n\nScientific basis constraints:\n- Begin from the non-relativistic kinematics relating $E$ and $k$ and the standard Breit-Wigner resonance form for $B(E)$.\n- Make all transformations between $k$ and $E$ through $E(k)$ and the Jacobian $dE/dk$.\n\nTest suite:\nUse the following test cases, each a tuple $(\\mu, E_R, \\Gamma, E_{\\min}, E_{\\max}, N)$ with $\\mu$ in $\\text{MeV}$, energies in $\\text{MeV}$, and $N$ dimensionless:\n- Case A (narrow resonance, moderate bin count): $(470.0, 2.0, 0.05, 0.0, 5.0, 50)$.\n- Case B (very narrow, near threshold): $(470.0, 0.2, 0.01, 0.0, 1.0, 40)$.\n- Case C (broader resonance, coarse bins): $(470.0, 2.5, 0.5, 0.0, 5.0, 10)$.\n\nOutput specification:\n- For each case, compute and return a list of six floats in the fixed order\n$$\n\\left[ H_E,\\; H_k,\\; \\varepsilon_E,\\; \\varepsilon_k,\\; \\Delta E_E,\\; \\Delta E_k \\right],\n$$\nwhere $H_E$ and $H_k$ are dimensionless, and $\\varepsilon_E$, $\\varepsilon_k$, $\\Delta E_E$, and $\\Delta E_k$ must be expressed in $\\text{MeV}$.\n- Your program should produce a single line of output containing the results for all cases as a comma-separated list enclosed in square brackets, with each case encoded as its own bracketed list and each float formatted to six digits after the decimal point. For example,\n$$\n\\left[ [h_{E,1}, h_{k,1}, \\varepsilon_{E,1}, \\varepsilon_{k,1}, \\Delta E_{E,1}, \\Delta E_{k,1}], [h_{E,2}, \\dots], [h_{E,3}, \\dots] \\right].\n$$\nNo other text should be printed.\n\nNumerical angle units are not used in this problem. All energies must be handled and reported in $\\text{MeV}$ and all momenta in $\\text{fm}^{-1}$.", "solution": "The user-provided problem is valid as it is scientifically grounded in computational nuclear physics, mathematically well-posed, and free of contradictions or ambiguities. The solution proceeds by implementing the specified calculations for two different continuum binning schemes.\n\n### Principle-Based Design\n\nThe solution implements and compares two common discretization schemes used in the Continuum-Discretized Coupled-Channel (CDCC) method: equal-energy binning and equal-momentum binning. The core of the problem is to quantify how well each scheme represents a sharp physical feature—a Breit-Wigner resonance—when the continuum is discretized into a finite number of bins.\n\nThe following steps detail the logical and mathematical procedure for solving the problem for a single test case $(\\mu, E_R, \\Gamma, E_{\\min}, E_{\\max}, N)$. This procedure is then applied to each test case provided.\n\n#### 1. Foundational Models\n\nFirst, we define the fundamental physics and mathematics of the model.\n- **Kinematics**: The non-relativistic relationship between the continuum energy $E$ and the relative momentum $k$ is given by $E(k) = \\frac{(\\hbar c)^2 k^2}{2 \\mu}$, where $\\mu$ is the reduced mass (in units of $\\text{MeV}/c^2$) and $\\hbar c = 197.3269804\\,\\text{MeV}\\cdot\\text{fm}$. The inverse relation is $k(E) = \\frac{\\sqrt{2 \\mu E}}{\\hbar c}$. The Jacobian of the transformation is $\\frac{dE}{dk} = \\frac{(\\hbar c)^2 k}{\\mu}$.\n- **Resonance Shape**: The breakup strength is modeled by a dimensionless Breit-Wigner function of energy, $B(E) = \\frac{(\\Gamma/2)^2}{(E - E_R)^2 + (\\Gamma/2)^2}$, where $E_R$ is the resonance energy and $\\Gamma$ is its width. By construction, the maximum value is $B(E_R) = 1$.\n\n#### 2. Equal-Energy Binning Scheme\n\nIn this scheme, the energy interval $[E_{\\min}, E_{\\max}]$ is divided into $N$ bins of equal width $\\Delta E = (E_{\\max} - E_{\\min})/N$. The $i$-th bin covers the range $[E_i, E_{i+1}]$, where $E_i = E_{\\min} + i\\Delta E$.\n\n- **Bin-Averaged Strength $\\overline{B}^{(E)}_i$ and Peak Resolution $H_E$**: The average strength in bin $i$ is $\\overline{B}^{(E)}_i = \\frac{1}{\\Delta E} \\int_{E_i}^{E_{i+1}} B(E)\\, dE$. The integral of the Breit-Wigner function is computed analytically for high precision:\n$$ \\int B(E)\\, dE = \\frac{\\Gamma}{2} \\arctan\\left(\\frac{E-E_R}{\\Gamma/2}\\right) $$\nThe definite integral over $[E_i, E_{i+1}]$ is found by evaluating this antiderivative at the limits. The peak resolution metric $H_E$ is then the maximum value found among all bin averages, $H_E = \\max_i \\{\\overline{B}^{(E)}_i\\}$.\n\n- **Centroid Shift $\\Delta E_E$**: We first identify the bin $i^\\star$ that has the maximum average strength $\\overline{B}^{(E)}_{i^\\star}$. The energy centroid of this bin is $E_{\\text{centroid}}^{(E)} = \\frac{\\int_{E_{i^\\star}}^{E_{i^\\star+1}} E B(E) dE}{\\int_{E_{i^\\star}}^{E_{i^\\star+1}} B(E) dE}$. The integrals in both the numerator and denominator are also computed analytically. The denominator is calculated as above, and the numerator's antiderivative is:\n$$ \\int E B(E) dE = \\frac{(\\Gamma/2)^2}{2} \\ln\\left((E-E_R)^2+(\\Gamma/2)^2\\right) + E_R \\frac{\\Gamma}{2} \\arctan\\left(\\frac{E-E_R}{\\Gamma/2}\\right) $$\nThe centroid shift is then $\\Delta E_E = E_{\\text{centroid}}^{(E)} - E_R$.\n\n- **Discretization Error $\\varepsilon_E$**: The total breakup strength over the energy range is approximated by a midpoint Riemann sum: $S_E^{\\text{disc}} = \\sum_{i=0}^{N-1} B(E_i + \\frac{\\Delta E}{2}) \\Delta E$. The exact value, $S_{\\text{exact}} = \\int_{E_{\\min}}^{E_{\\max}} B(E) dE$, is computed using the analytical integral. The absolute error is $\\varepsilon_E = |S_E^{\\text{disc}} - S_{\\text{exact}}|$.\n\n#### 3. Equal-Momentum Binning Scheme\n\nHere, the momentum interval $[k_{\\min}, k_{\\max}]$ is divided into $N$ bins of equal width $\\Delta k = (k_{\\max} - k_{\\min})/N$, where $k_{\\min/max}$ are derived from $E_{\\min/max}$. The $j$-th bin is $[k_j, k_{j+1}]$, where $k_j = k_{\\min} + j\\Delta k$. Note that this results in energy bins of non-uniform width.\n\n- **Bin-Averaged Strength $\\overline{B}^{(k)}_j$ and Peak Resolution $H_k$**: The average strength is defined as $\\overline{B}^{(k)}_j = \\frac{1}{\\Delta k} \\int_{k_j}^{k_{j+1}} B(E(k)) dk$. The integrand $B(E(k))$ is a complex function of $k$, so the integral is computed numerically using the adaptive quadrature routine `scipy.integrate.quad`. The peak resolution $H_k$ is the maximum value, $H_k = \\max_j \\{\\overline{B}^{(k)}_j\\}$.\n\n- **Centroid Shift $\\Delta E_k$**: For the most resonant momentum bin $j^\\star$, the energy centroid is $E_{\\text{centroid}}^{(k)} = \\frac{\\int_{k_{j^\\star}}^{k_{j^\\star+1}} E(k) B(E(k)) dk}{\\int_{k_{j^\\star}}^{k_{j^\\star+1}} B(E(k)) dk}$. Both integrals are computed numerically via `scipy.integrate.quad`. The shift is $\\Delta E_k = E_{\\text{centroid}}^{(k)} - E_R$.\n\n- **Discretization Error $\\varepsilon_k$**: The total strength is found by transforming the integral $\\int B(E) dE$ to momentum space: $\\int B(E(k)) \\frac{dE}{dk} dk$. A midpoint Riemann sum approximates this integral: $S_k^{\\text{disc}} = \\sum_{j=0}^{N-1} B(E(k_j + \\frac{\\Delta k}{2})) \\left.\\frac{dE}{dk}\\right|_{k_j+\\Delta k/2} \\Delta k$. The error relative to the same $S_{\\text{exact}}$ is $\\varepsilon_k = |S_k^{\\text{disc}} - S_{\\text{exact}}|$.\n\nBy comparing the resulting metrics ($H$, $\\varepsilon$, $\\Delta E$) for both schemes across various physical scenarios (test cases), one can draw conclusions about the suitability of each discretization method for resolving narrow continuum resonances.", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes and compares metrics for equal-energy and equal-momentum binning\n    schemes in a simplified CDCC model for three test cases.\n    \"\"\"\n    # Physical constant\n    hbar_c = 197.3269804  # MeV fm\n\n    # Test suite: (mu, E_R, Gamma, E_min, E_max, N)\n    test_cases = [\n        (470.0, 2.0, 0.05, 0.0, 5.0, 50),   # Case A\n        (470.0, 0.2, 0.01, 0.0, 1.0, 40),   # Case B\n        (470.0, 2.5, 0.5, 0.0, 5.0, 10),    # Case C\n    ]\n\n    all_results = []\n    for case in test_cases:\n        mu, E_R, Gamma, E_min, E_max, N = case\n        g2 = Gamma / 2.0\n        g2_sq = g2**2\n\n        # --- Common Model Functions ---\n\n        def B(E):\n            \"\"\"Breit-Wigner resonance shape.\"\"\"\n            return g2_sq / ((E - E_R)**2 + g2_sq)\n\n        def E_of_k(k):\n            \"\"\"Energy as a function of momentum.\"\"\"\n            return (hbar_c * k)**2 / (2 * mu)\n\n        def dE_dk(k):\n            \"\"\"Jacobian dE/dk.\"\"\"\n            return (hbar_c**2 * k) / mu\n\n        # --- Analytic Integrals for Energy Bins ---\n        \n        def integral_B_E(E):\n            \"\"\"Antiderivative of B(E).\"\"\"\n            return g2 * np.arctan((E - E_R) / g2)\n\n        def definite_integral_B_E(E1, E2):\n            \"\"\"Definite integral of B(E) from E1 to E2.\"\"\"\n            return integral_B_E(E2) - integral_B_E(E1)\n\n        def integral_E_B_E(E):\n            \"\"\"Antiderivative of E*B(E).\"\"\"\n            term1 = 0.5 * g2_sq * np.log((E - E_R)**2 + g2_sq)\n            term2 = E_R * g2 * np.arctan((E - E_R) / g2)\n            return term1 + term2\n\n        def definite_integral_E_B_E(E1, E2):\n            \"\"\"Definite integral of E*B(E) from E1 to E2.\"\"\"\n            return integral_E_B_E(E2) - integral_E_B_E(E1)\n        \n        S_exact = definite_integral_B_E(E_min, E_max)\n\n        # --- 1. Equal-Energy Binning ---\n\n        delta_E = (E_max - E_min) / N\n        E_bins = np.linspace(E_min, E_max, N + 1)\n        \n        B_bar_E_i = np.array([(definite_integral_B_E(E_bins[i], E_bins[i+1])) / delta_E for i in range(N)])\n        \n        # H_E (B(E_R) = 1)\n        H_E = np.max(B_bar_E_i)\n        \n        i_star = np.argmax(B_bar_E_i)\n        E_i_star, E_i1_star = E_bins[i_star], E_bins[i_star+1]\n        \n        # Centroid and shift for energy bins\n        num_E_centroid = definite_integral_E_B_E(E_i_star, E_i1_star)\n        den_E_centroid = definite_integral_B_E(E_i_star, E_i1_star)\n        E_centroid_E = num_E_centroid / den_E_centroid if den_E_centroid != 0 else E_R\n        delta_E_E = E_centroid_E - E_R\n        \n        # Discretized sum and error for energy bins\n        E_centers = E_bins[:-1] + delta_E / 2.0\n        S_E_disc = np.sum(B(E_centers)) * delta_E\n        epsilon_E = abs(S_E_disc - S_exact)\n\n        # --- 2. Equal-Momentum Binning ---\n\n        k_min = np.sqrt(2 * mu * E_min) / hbar_c if E_min  0 else 0.0\n        k_max = np.sqrt(2 * mu * E_max) / hbar_c\n        delta_k = (k_max - k_min) / N\n        k_bins = np.linspace(k_min, k_max, N + 1)\n        \n        # Integrands for momentum space\n        def B_of_E_k(k):\n            return B(E_of_k(k))\n        \n        def E_k_B_of_E_k(k):\n            return E_of_k(k) * B_of_E_k(k)\n        \n        B_bar_k_j = np.array([quad(B_of_E_k, k_bins[j], k_bins[j+1])[0] / delta_k for j in range(N)])\n\n        # H_k (B(E_R) = 1)\n        H_k = np.max(B_bar_k_j)\n        \n        j_star = np.argmax(B_bar_k_j)\n        k_j_star, k_j1_star = k_bins[j_star], k_bins[j_star+1]\n        \n        # Centroid and shift for momentum bins\n        num_k_centroid, _ = quad(E_k_B_of_E_k, k_j_star, k_j1_star, limit=100)\n        den_k_centroid, _ = quad(B_of_E_k, k_j_star, k_j1_star, limit=100)\n        E_centroid_k = num_k_centroid / den_k_centroid if den_k_centroid != 0 else E_R\n        delta_E_k = E_centroid_k - E_R\n        \n        # Discretized sum and error for momentum bins\n        k_centers = k_bins[:-1] + delta_k / 2.0\n        sum_integrand = B(E_of_k(k_centers)) * dE_dk(k_centers)\n        S_k_disc = np.sum(sum_integrand) * delta_k\n        epsilon_k = abs(S_k_disc - S_exact)\n\n        all_results.append([H_E, H_k, epsilon_E, epsilon_k, delta_E_E, delta_E_k])\n\n    # Format and print the final output\n    formatted_rows = []\n    for row in all_results:\n        formatted_floats = [f\"{val:.6f}\" for val in row]\n        formatted_rows.append(f\"[{','.join(formatted_floats)}]\")\n    final_output = f\"[{','.join(formatted_rows)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "3552257"}]}