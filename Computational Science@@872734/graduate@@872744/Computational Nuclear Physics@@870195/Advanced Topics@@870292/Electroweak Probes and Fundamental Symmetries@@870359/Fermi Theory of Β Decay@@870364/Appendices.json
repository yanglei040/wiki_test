{"hands_on_practices": [{"introduction": "To master Fermi's theory, one must first understand how to predict and analyze the energy distribution of the emitted electrons. This foundational exercise guides you through deriving the allowed $\\beta$-spectrum shape from Fermi's Golden Rule and relativistic phase-space considerations. By implementing a numerical model, you will compute key observables and use the classic Kurie plot to extract the decay's endpoint energy, a technique central to experimental beta-spectroscopy [@problem_id:3559128].", "problem": "Consider an allowed nuclear beta decay in the framework of Fermi's theory of beta decay. Use Fermi's Golden Rule and relativistic phase-space reasoning for an electron and an antineutrino to derive the electron spectrum and the Kurie representation, starting from the following fundamental bases:\n\n- The transition rate from Fermi's Golden Rule is proportional to the squared transition matrix element and the available phase space. For allowed transitions, the transition matrix element is momentum-independent.\n- The relativistic energy-momentum relation for the electron is given by $E^2 = p^2 + m_e^2$, where $E$ is the total electron energy, $p$ is the electron momentum, and $m_e$ is the electron mass. Use units where $c = 1$.\n- Energy conservation between the leptons imposes that the electron and the antineutrino share the available $Q$-value. With nuclear recoil neglected, the antineutrino energy is $E_\\nu = E_0 - E$, where $E_0$ is the endpoint total energy of the electron.\n- The Coulomb interaction between the outgoing electron and the daughter nucleus modifies the electron density of states by a multiplicative factor known as the Fermi function. In the point-nucleus, Sommerfeld-factor approximation, this is\n$$\nF(Z, E) = \\frac{2 \\pi \\eta}{1 - e^{-2 \\pi \\eta}}, \\quad \\eta = \\alpha\\, Z\\, \\frac{E}{p},\n$$\nwhere $Z$ is the daughter nuclear charge number, $\\alpha$ is the fine-structure constant, $E$ is the total electron energy, and $p$ is the electron momentum. For $\\beta^-$ decay, take $\\eta > 0$.\n\nFrom these bases, derive that the differential spectrum shape for allowed decays is proportional to a specific product of kinematic factors and $F(Z,E)$, and that the Kurie plot variable can be defined by\n$$\nK(E) \\equiv \\sqrt{\\frac{N(E)}{p\\,E\\,F(Z,E)}},\n$$\nso that for an allowed decay without shape-factor or radiative corrections, $K(E)$ exhibits a linear dependence on $E$ whose zero crossing yields the endpoint $E_0$.\n\nYour task is to implement a program that, for each test case below, performs the following computations using the derived expressions:\n\n1. Compute the unnormalized phase-space integral\n$$\nI_0 = \\int_{m_e}^{E_0} p\\,E\\,(E_0 - E)^2\\,F(Z, E)\\,dE,\n$$\nexpressed in units of $\\mathrm{MeV}^5$.\n2. Compute the normalization constant $C = 1/I_0$ so that the normalized spectrum $N(E)$ integrates to unity over $[m_e, E_0]$. Then compute the mean electron kinetic energy\n$$\n\\langle T \\rangle = \\int_{m_e}^{E_0} \\left(E - m_e\\right)\\, N(E)\\, dE,\n$$\nexpressed in $\\mathrm{MeV}$.\n3. Construct the Kurie plot using the normalized spectrum $N(E)$ and the definition of $K(E)$ given above. Using linear least-squares regression of $K(E)$ versus $E$ over a dense grid in $[m_e, E_0]$, estimate the endpoint energy $\\widehat{E}_0$ as the zero of the best-fit line and report it in $\\mathrm{MeV}$.\n\nPhysical constants to use:\n- Electron mass $m_e = 0.51099895\\,\\mathrm{MeV}$.\n- Fine-structure constant $\\alpha = 1/137.035999084$.\n\nNumerical requirements:\n- Perform all integrals numerically over $E \\in [m_e, E_0]$. Handle endpoint behavior robustly; any internal regularization you introduce must not change the continuum limit. Use sufficient quadrature accuracy that your results are stable to at least six decimal places.\n- For the Kurie fit, use a uniform grid of at least $400$ points in $E$ over the open interval $(m_e, E_0)$, exclude only an infinitesimal neighborhood of the endpoints necessary to avoid floating-point singularities, and fit a straight line $K(E) \\approx a + b\\,E$. Report $\\widehat{E}_0 = -a/b$.\n\nTest suite (each case is specified by daughter charge $Z$, mass number $A$ which you may ignore for the chosen Fermi function approximation, and electron endpoint total energy $E_0$ in $\\mathrm{MeV}$):\n- Case 1: $Z = 1$, $A = 3$, $E_0 = 0.52959895$.\n- Case 2: $Z = 8$, $A = 14$, $E_0 = 1.50000000$.\n- Case 3: $Z = 50$, $A = 120$, $E_0 = 3.50000000$.\n\nRequired output:\n- For each case, output three numbers in the following order: $I_0$ in $\\mathrm{MeV}^5$, $\\langle T \\rangle$ in $\\mathrm{MeV}$, and $\\widehat{E}_0$ in $\\mathrm{MeV}$.\n- Your program should produce a single line of output containing the nine results for the three cases, rounded to six decimal places, as a comma-separated list enclosed in square brackets, in the order of the test cases above. For example: \"[I01,meanT1,E0hat1,I02,meanT2,E0hat2,I03,meanT3,E0hat3]\".", "solution": "The user-provided problem is assessed to be **valid**. It is a well-posed, scientifically grounded problem in computational nuclear physics that requests both a theoretical derivation and a numerical implementation based on standard Fermi theory of $\\beta$-decay. All necessary physical constants, function definitions, and parameters are provided, and the tasks are clear and computationally feasible.\n\n### Theoretical Derivation\n\nThe primary objective is to derive the shape of the electron energy spectrum for an allowed $\\beta$-decay and subsequently demonstrate the linear relationship of the Kurie plot.\n\n**1. Electron Energy Spectrum**\n\nAccording to Fermi's Golden Rule, the differential transition rate, $d\\lambda$, for a decay process is proportional to the squared transition matrix element, $|M_{fi}|^2$, and the density of final states, $d\\rho$:\n$$d\\lambda = \\frac{2\\pi}{\\hbar} |M_{fi}|^2 d\\rho$$\nFor an allowed $\\beta$-decay, the lepton wavefunctions can be approximated by plane waves, and the transition matrix element $|M_{fi}|^2$ can be considered independent of the lepton momenta. It is typically written as a product of the square of the Fermi constant $G_F$ and a nuclear matrix element $|M_{nucl}|^2$, which are constants for a given transition.\n\nThe final state consists of the daughter nucleus, an electron ($e^-$), and an antineutrino ($\\bar{\\nu}_e$). Neglecting the recoil of the heavy daughter nucleus, the total energy released in the decay, the $Q$-value, is shared between the electron and the antineutrino. The total energy available to the leptons is $E_0$, the endpoint energy of the electron, which includes its rest mass energy. Energy conservation dictates:\n$$E_0 = E + E_\\nu$$\nwhere $E$ is the total energy of the electron and $E_\\nu$ is the energy of the antineutrino. The relativistic energy-momentum relations are $E^2 = p^2 + m_e^2$ for the electron (using units where $c=1$) and $E_\\nu = p_\\nu$ for the effectively massless antineutrino.\n\nThe density of final states $d\\rho$ depends on the momenta of the outgoing electron and antineutrino. The number of available quantum states for an electron with momentum between $p$ and $p+dp$ and an antineutrino with momentum between $p_\\nu$ and $p_\\nu+dp_\\nu$ is given by the product of their individual phase-space volumes (with $\\hbar=1$):\n$$d^2N_{states} = \\frac{d^3p}{(2\\pi)^3} \\frac{d^3p_\\nu}{(2\\pi)^3} = \\frac{(4\\pi p^2 dp)}{(2\\pi)^3} \\frac{(4\\pi p_\\nu^2 dp_\\nu)}{(2\\pi)^3}$$\nThe electron energy spectrum, $N(E)dE$, is found by integrating over all possible antineutrino states consistent with energy conservation for a given electron energy $E$. The density of states available for a fixed electron energy $E$ is proportional to the phase space of the antineutrino, constrained by $E_\\nu = E_0 - E$:\n$$d\\rho(E) \\propto d^3p \\int \\delta(E_0 - E - E_\\nu) d^3p_\\nu$$\nThe integral over the antineutrino phase space gives:\n$$\\int \\delta(E_0 - E - p_\\nu) 4\\pi p_\\nu^2 dp_\\nu = 4\\pi(E_0 - E)^2$$\nThe electron phase-space factor is $d^3p = 4\\pi p^2 dp$. Combining these factors, the momentum spectrum is:\n$$N(p)dp \\propto |M_{fi}|^2 p^2 (E_0-E)^2 dp$$\nTo find the energy spectrum $N(E)dE$, we use the relation $E^2=p^2+m_e^2 \\implies 2EdE = 2pdp \\implies p dp = E dE$. Substituting $dp = (E/p)dE$:\n$$N(E)dE \\propto |M_{fi}|^2 p^2 (E/p) (E_0-E)^2 dE = |M_{fi}|^2 p E (E_0-E)^2 dE$$\nFinally, we must account for the Coulomb interaction between the emitted electron (charge $-e$) and the daughter nucleus (charge $+Ze$). This is done by multiplying the spectrum by the Fermi function, $F(Z,E)$, which corrects the electron's wavefunction density at the nucleus. For an allowed transition, the resulting electron energy spectrum shape is:\n$$N(E) \\propto p\\, E\\, (E_0 - E)^2 F(Z,E)$$\nThis completes the first part of the derivation.\n\n**2. Kurie Plot**\n\nThe Kurie plot is a tool used to analyze the $\\beta$-spectrum and determine the endpoint energy $E_0$. The Kurie variable, $K(E)$, is defined in the problem as:\n$$K(E) \\equiv \\sqrt{\\frac{N(E)}{p\\,E\\,F(Z,E)}}$$\nLet the full expression for the spectrum be $N(E) = C_{norm} \\cdot p\\,E\\,(E_0-E)^2 F(Z,E)$, where $C_{norm}$ is a normalization constant that includes $|M_{fi}|^2$ and other factors. Substituting this into the definition of $K(E)$:\n$$K(E) = \\sqrt{\\frac{C_{norm} \\cdot p\\,E\\,(E_0-E)^2 F(Z,E)}{p\\,E\\,F(Z,E)}}$$\n$$K(E) = \\sqrt{C_{norm} (E_0-E)^2} = \\sqrt{C_{norm}} (E_0 - E)$$\nThis equation shows that $K(E)$ is a linear function of the electron total energy $E$:\n$$K(E) = \\sqrt{C_{norm}} E_0 - \\sqrt{C_{norm}} E$$\nA plot of $K(E)$ versus $E$ yields a straight line with a negative slope. The intercept with the energy axis (where $K(E)=0$) occurs at $E=E_0$, providing a direct method to determine the endpoint energy from experimental data.\n\n### Computational Implementation\n\nThe problem requires the implementation of three computational tasks for each test case.\n\n**1. Phase-Space Integral $I_0$**\n\nThe unnormalized phase-space integral is given by:\n$$I_0 = \\int_{m_e}^{E_0} p\\,E\\,(E_0 - E)^2\\,F(Z, E)\\,dE$$\nThe integrand is the derived spectral shape factor. The Fermi function $F(Z,E)$ and momentum $p(E)$ introduce numerical challenges at the lower integration limit $E=m_e$, where $p=0$. The integrand can be made more robust for numerical quadrature by combining the $p$ from the phase space factor with the $1/p$ dependence within the Fermi function. The factor $p \\cdot F(Z,E)$ is:\n$$p \\cdot F(Z,E) = p \\cdot \\frac{2\\pi\\eta}{1 - e^{-2\\pi\\eta}} = p \\cdot \\frac{2\\pi(\\alpha Z E/p)}{1 - e^{-2\\pi\\eta}} = \\frac{2\\pi\\alpha Z E}{1 - e^{-2\\pi\\alpha Z E/p(E)}}$$\nThis expression is finite and well-behaved as $E \\to m_e^+$ (since $p(E) \\to 0^+$), where it approaches the limit $2\\pi\\alpha Z m_e$. The integrand for $I_0$ is therefore implemented as $E(E_0-E)^2$ multiplied by this numerically stable form. The integral is computed using the `scipy.integrate.quad` function, which is a high-precision adaptive quadrature method suitable for this type of problem.\n\n**2. Mean Electron Kinetic Energy $\\langle T \\rangle$**\n\nFirst, the normalization constant $C = 1/I_0$ is computed. The normalized probability distribution for the electron energy is $N(E) = C \\cdot p E (E_0 - E)^2 F(Z,E)$. The mean kinetic energy $T = E-m_e$ is then calculated by the integral:\n$$\\langle T \\rangle = \\int_{m_e}^{E_0} (E - m_e) N(E) dE = C \\int_{m_e}^{E_0} (E-m_e) p E (E_0-E)^2 F(Z,E) dE$$\nThe integral in this expression is computed numerically using `scipy.integrate.quad` with the same stable integrand formulation as for $I_0$, but with an additional factor of $(E-m_e)$.\n\n**3. Kurie Plot Endpoint Estimate $\\widehat{E}_0$**\n\nThe Kurie plot variable $K(E)$ is constructed using the normalized spectrum $N(E)=C/I_0$. From our derivation, $K(E) = \\sqrt{C} (E_0-E)$. A fine grid of at least $400$ energy points is generated over the open interval $(m_e, E_0)$. A small offset from $m_e$ is used to avoid any potential floating-point issues with $p=0$, although the algebraic simplification makes this robust. For each energy $E_i$ on the grid, the corresponding value $K_i = \\sqrt{C}(E_0 - E_i)$ is computed.\nA linear model $K(E) = a + bE$ is fitted to the generated data points $(E_i, K_i)$ using linear least-squares regression, for which `numpy.polyfit` is employed. The slope and intercept determined by the fit are denoted $b$ and $a$, respectively. From the linear equation, the x-intercept is found by setting $K(E)=0$, which yields the estimated endpoint energy $\\widehat{E}_0 = -a/b$. Due to the exact linearity of the underlying model, this calculation is expected to recover the input $E_0$ with high precision.", "answer": "```python\nimport numpy as np\nfrom scipy import integrate\n\n# GLOBAL CONSTANTS (as required by the problem)\n# Electron mass in MeV\nM_E = 0.51099895\n# Fine-structure constant\nALPHA = 1 / 137.035999084\n\ndef calculate_p_times_fermi(E, Z, me, alpha):\n    \"\"\"\n    Calculates the numerically stable product p * F(Z, E).\n    p * F(Z,E) = (2 * pi * alpha * Z * E) / (1 - exp(-2 * pi * alpha * Z * E / p))\n    This form avoids the p/p cancellation issue near E=me.\n    This function is designed to work with scalar E, as expected by scipy.quad.\n    \"\"\"\n    if E <= me:\n        return 0.0\n\n    p_val = np.sqrt((E - me) * (E + me))\n    \n    # The limit as E -> me (p -> 0) is finite.\n    if p_val == 0.0:\n        return 2 * np.pi * alpha * Z * me\n\n    exp_arg = -2 * np.pi * alpha * Z * E / p_val\n    \n    # Handle underflow for large negative arguments to exp\n    if exp_arg < -709:  # Below this, np.exp underflows to 0.0\n        denominator = 1.0\n    else:\n        denominator = 1.0 - np.exp(exp_arg)\n        \n    numerator = 2 * np.pi * alpha * Z * E\n    \n    return numerator / denominator\n\ndef integrand_for_i0(E, Z, E0, me, alpha):\n    \"\"\"The integrand for the I_0 integral: E * (E0-E)^2 * (p*F)\"\"\"\n    if E <= me or E >= E0:\n        return 0.0\n    pf_val = calculate_p_times_fermi(E, Z, me, alpha)\n    return E * (E0 - E)**2 * pf_val\n\ndef integrand_for_mean_t(E, Z, E0, me, alpha):\n    \"\"\"The integrand for the numerator of the <T> calculation\"\"\"\n    return (E - me) * integrand_for_i0(E, Z, E0, me, alpha)\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test cases.\n    \"\"\"\n    # Test cases: (daughter charge Z, mass number A, endpoint energy E0 in MeV)\n    # A is ignored as per the problem statement.\n    test_cases = [\n        (1, 3, 0.52959895),\n        (8, 14, 1.50000000),\n        (50, 120, 3.50000000),\n    ]\n\n    results = []\n    # Set high precision for numerical integration\n    integration_kwargs = {'epsabs': 1e-13, 'epsrel': 1e-13}\n\n    for Z, A, E0 in test_cases:\n        # Task 1: Compute the unnormalized phase-space integral I_0\n        i0, _ = integrate.quad(integrand_for_i0, M_E, E0, args=(Z, E0, M_E, ALPHA), **integration_kwargs)\n\n        # Task 2: Compute the mean electron kinetic energy <T>\n        C = 1.0 / i0\n        mean_t_numerator, _ = integrate.quad(integrand_for_mean_t, M_E, E0, args=(Z, E0, M_E, ALPHA), **integration_kwargs)\n        mean_t = C * mean_t_numerator\n\n        # Task 3: Estimate the endpoint energy E0_hat from a Kurie plot fit\n        num_points = 401\n        \n        # Create a grid over the open interval (m_e, E_0] to avoid p=0 singularity.\n        # The small epsilon avoids any floating point issues right at the lower boundary.\n        epsilon = 1e-9 * M_E\n        E_grid = np.linspace(M_E + epsilon, E0, num_points)\n        \n        # As derived, K(E) = sqrt(C) * (E0 - E), which is a perfect line.\n        # We generate the data points for the fit directly from this relation.\n        K_grid = np.sqrt(C) * (E0 - E_grid)\n        \n        # Perform a linear least-squares regression: K(E) = b*E + a\n        # np.polyfit returns coefficients [b, a] for degree 1.\n        b, a = np.polyfit(E_grid, K_grid, 1)\n        \n        # The estimated endpoint is the x-intercept of the fit: E0_hat = -a/b\n        e0_hat = -a / b\n\n        results.extend([i0, mean_t, e0_hat])\n\n    # Format the final output as a single comma-separated list string\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3559128"}, {"introduction": "While the spectral shape is governed by kinematics, the absolute decay rate is determined by the nuclear structure. This practice bridges that gap by introducing the calculation of Fermi (vector) and Gamow-Teller (axial-vector) nuclear matrix elements from simplified shell-model wavefunctions. You will combine these matrix elements with phase-space integrals to compute partial decay rates and branching ratios, thereby connecting the quantum mechanics of the nucleus to observable decay properties [@problem_id:3559156].", "problem": "You are asked to design and implement a complete computational pipeline that, starting from shell-model wavefunctions, computes allowed beta-decay nuclear matrix elements for the vector (Fermi) and axial-vector (Gamow–Teller) channels, evaluates phase-space integrals within the allowed approximation, and uses Fermi's theory to predict partial decay rates, total decay rates, and branching ratios for multiple decay channels. The program must be fully self-contained and must produce numerical outputs for a prescribed test suite.\n\nBegin from a fundamental base appropriate to weak nuclear beta decay: use Fermi's Golden Rule and the effective low-energy four-fermion Hamiltonian with one-body nuclear operators. In the allowed approximation, the hadronic current reduces to two leading contributions: the Fermi operator and the Gamow–Teller operator. For a transition from an initial nuclear state to a final state that differs only in isospin and spin quantum numbers appropriate for allowed beta decay, the nuclear matrix elements are defined as\n$$\nM_\\mathrm{F} \\equiv \\langle f \\Vert \\sum_{n} \\tau^{(+)}(n) \\Vert i \\rangle,\\quad\n\\vec{M}_\\mathrm{GT} \\equiv \\langle f \\Vert \\sum_{n} \\vec{\\sigma}(n)\\,\\tau^{(+)}(n) \\Vert i \\rangle,\n$$\nwhere $\\tau^{(+)}$ is the isospin-raising operator and $\\vec{\\sigma}$ is the Pauli spin operator acting on nucleon $n$. In a simplified computational model, assume the decay is dominated by a single valence nucleon and compute these matrix elements from spinor components of shell-model wavefunctions by treating the isospin change as allowed and focusing on the spin-space overlap. Represent the initial and final state spin wavefunctions as normalized two-component complex spinors,\n$$\n\\vert i \\rangle \\equiv \\begin{pmatrix} c_{i,\\uparrow} \\\\ c_{i,\\downarrow} \\end{pmatrix},\\quad\n\\vert f \\rangle \\equiv \\begin{pmatrix} c_{f,\\uparrow} \\\\ c_{f,\\downarrow} \\end{pmatrix},\n$$\nwith $\\sum_{s\\in\\{\\uparrow,\\downarrow\\}} |c_{i,s}|^2 = \\sum_{s} |c_{f,s}|^2 = 1$. In this single-particle reduction, compute\n$$\nM_\\mathrm{F} = \\langle f \\vert i \\rangle = c_{f,\\uparrow}^*\\,c_{i,\\uparrow} + c_{f,\\downarrow}^*\\,c_{i,\\downarrow},\n$$\nand\n$$\n\\vec{M}_\\mathrm{GT} = \\big(\\langle f \\vert \\sigma_x \\vert i \\rangle,\\ \\langle f \\vert \\sigma_y \\vert i \\rangle,\\ \\langle f \\vert \\sigma_z \\vert i \\rangle\\big),\n$$\nusing the Pauli matrices $\\sigma_x$, $\\sigma_y$, $\\sigma_z$. Use the squared magnitudes $|M_\\mathrm{F}|^2$ and $|\\vec{M}_\\mathrm{GT}|^2 \\equiv \\sum_{k=x,y,z} |\\langle f \\vert \\sigma_k \\vert i \\rangle|^2$ as the nuclear factors entering rates.\n\nWithin the allowed approximation for beta minus ($\\beta^-$) decay and neglecting recoil and radiative corrections, the differential rate is proportional to a phase-space factor involving the electron total energy $E$, electron momentum $p=\\sqrt{E^2-m_e^2}$, endpoint energy $E_0=Q+m_e$ (with $Q$ the nuclear $Q$-value expressed as energy available to leptons), and the Fermi function $F(Z,E)$ that encodes Coulomb distortion for a daughter nucleus of charge number $Z$:\n$$\n\\text{integrand}(E; Z, Q) \\propto p\\,E\\,(E_0 - E)^2\\,F(Z,E).\n$$\nUse the standard approximation for the Fermi function in beta minus decay,\n$$\nF(Z,E) \\approx \\frac{2\\pi\\eta}{1-e^{-2\\pi\\eta}},\\quad \\eta = \\alpha\\,Z\\,\\frac{E}{p},\n$$\nwhere $\\alpha$ is the fine-structure constant. The phase-space integral runs over $E \\in [m_e, E_0]$ and yields a quantity with dimensions of energy to the fifth power. Combine it with the square of the Fermi constant and the appropriate couplings to obtain partial decay rates. Take the vector coupling $g_V$ and axial-vector coupling $g_A$ as constants. Include the up–down Cabibbo–Kobayashi–Maskawa matrix element $V_{ud}$ in the leptonic coupling. All constants must be used in consistent units and the final total rate must be expressed in $\\mathrm{s}^{-1}$, rounded to machine precision as a standard floating-point value.\n\nYour task:\n\n- Implement the computation of $|M_\\mathrm{F}|^2$ and $|\\vec{M}_\\mathrm{GT}|^2$ from provided shell-model spinors for initial and final states for each decay channel.\n- Numerically evaluate the phase-space integral for each channel using the given $Q$-values and daughter charge numbers with the Fermi function approximation defined above. Use electron rest mass $m_e$ and the endpoint energy $E_0=Q+m_e$ as specified.\n- Use Fermi's theory to compute partial rates for Fermi and Gamow–Teller components and then obtain the total partial rate per channel as the sum of the two. Sum over channels to get the total rate for the nucleus. Compute branching ratios per channel as the ratio of that channel's partial total rate to the total rate.\n- Physical units: express energies in $\\mathrm{MeV}$, use $\\alpha$ dimensionless, and return the final total rates in $\\mathrm{s}^{-1}$. The branching ratios must be decimal fractions in the range $[0,1]$.\n- Angle unit specification: wherever angles are used in the test suite for defining spinors via trigonometric functions, they are given in radians.\n\nConstants to use (fixed across all test cases): fine-structure constant $\\alpha = 1/137.035999084$, Fermi constant $G_\\mathrm{F} = 1.1663787\\times 10^{-5}\\ \\mathrm{GeV}^{-2}$ converted consistently to $\\mathrm{MeV}^{-2}$, Cabibbo–Kobayashi–Maskawa matrix element $V_{ud}=0.97420$, electron mass $m_e = 0.51099895\\ \\mathrm{MeV}$, reduced Planck constant $\\hbar = 6.582119569\\times 10^{-22}\\ \\mathrm{MeV\\cdot s}$, vector coupling $g_V = 1.0$, axial-vector coupling $g_A = 1.2723$.\n\nTest Suite:\n\nFor each test case, the parent nucleus charge $Z_\\mathrm{parent}$, daughter charge $Z_\\mathrm{daughter}$ for beta minus decay ($Z_\\mathrm{daughter}=Z_\\mathrm{parent}+1$), the list of $Q$-values $[Q_1,Q_2,\\dots]$ in $\\mathrm{MeV}$ for the different final states, and the shell-model spinors for the initial state and for each final state channel are provided. All spinors are normalized and angles below are in radians.\n\n- Test Case 1 (mixed Fermi and Gamow–Teller, mid-$Z$):\n  - $Z_\\mathrm{parent} = 20$, so $Z_\\mathrm{daughter}=21$.\n  - $Q$-values: $[3.5,\\ 2.0,\\ 1.0]\\ \\mathrm{MeV}$.\n  - Initial spinor: $\\vert i \\rangle = \\big(\\sqrt{0.6},\\ i\\sqrt{0.4}\\big)$.\n  - Final spinors per channel:\n    - Channel 1: $\\vert f_1 \\rangle = \\big(\\sqrt{0.5},\\ \\sqrt{0.5}\\big)$.\n    - Channel 2: $\\vert f_2 \\rangle = \\big(\\sqrt{0.8},\\ -i\\sqrt{0.2}\\big)$.\n    - Channel 3: $\\vert f_3 \\rangle = \\big(\\sqrt{0.3},\\ \\sqrt{0.7}\\big)$.\n\n- Test Case 2 (Gamow–Teller suppressed by spinor mismatch, low-$Z$):\n  - $Z_\\mathrm{parent} = 10$, so $Z_\\mathrm{daughter}=11$.\n  - $Q$-values: $[2.5,\\ 1.2]\\ \\mathrm{MeV}$.\n  - Initial spinor: $\\vert i \\rangle = \\big(\\cos(0.15),\\ \\sin(0.15)\\big)$.\n  - Final spinors per channel:\n    - Channel 1: $\\vert f_1 \\rangle = \\big(\\cos(0.10),\\ i\\sin(0.10)\\big)$.\n    - Channel 2: $\\vert f_2 \\rangle = \\big(\\cos(0.70),\\ \\sin(0.70)\\big)$.\n\n- Test Case 3 (high-$Z$ Coulomb effects with a near-threshold branch):\n  - $Z_\\mathrm{parent} = 52$, so $Z_\\mathrm{daughter}=53$.\n  - $Q$-values: $[4.0,\\ 0.3]\\ \\mathrm{MeV}$.\n  - Initial spinor: $\\vert i \\rangle = \\big(\\sqrt{0.55},\\ e^{i\\,0.3}\\sqrt{0.45}\\big)$.\n  - Final spinors per channel:\n    - Channel 1: $\\vert f_1 \\rangle = \\big(e^{i\\,0.2}\\sqrt{0.60},\\ \\sqrt{0.40}\\big)$.\n    - Channel 2: $\\vert f_2 \\rangle = \\big(\\sqrt{0.20},\\ e^{i\\,0.5}\\sqrt{0.80}\\big)$.\n\nRequired final output format:\n\nYour program must process all three test cases and produce a single line of output containing a list of three sublists, one per test case. Each sublist must contain the total decay rate in $\\mathrm{s}^{-1}$ followed by the branching ratios for each channel in that test case, in order of the $Q$-values provided. The output must be exactly a single line in the format\n$$\n[\\,[\\lambda_\\mathrm{tot}^{(1)},\\,\\mathrm{BR}_1^{(1)},\\,\\mathrm{BR}_2^{(1)},\\,\\mathrm{BR}_3^{(1)}],\\ [\\lambda_\\mathrm{tot}^{(2)},\\,\\mathrm{BR}_1^{(2)},\\,\\mathrm{BR}_2^{(2)}],\\ [\\lambda_\\mathrm{tot}^{(3)},\\,\\mathrm{BR}_1^{(3)},\\,\\mathrm{BR}_2^{(3)}]\\,],\n$$\nwith no additional text. All numerical values must be standard decimal floats.", "solution": "The user has provided a well-defined computational physics problem concerning the calculation of beta-decay rates. The problem statement has been validated and found to be scientifically sound, self-contained, and well-posed. It requires the implementation of a computational pipeline based on Fermi's theory of allowed beta decay. I will proceed with a step-by-step solution.\n\n### Principle-Based Design\n\nThe solution will be designed based on the fundamental principles of weak interaction physics as applied to nuclear beta decay, using the specific model and approximations requested in the problem statement. The computational pipeline can be decomposed into three primary stages for each decay channel:\n\n1.  **Nuclear Matrix Element Calculation**: The core of the nuclear transition's dynamics is captured by the nuclear matrix elements for the Fermi (vector) and Gamow-Teller (axial-vector) operators. As specified, the problem simplifies the complex many-body nuclear state to a single-particle two-component spinor. The matrix elements are then overlaps between the initial and final state spinors, with the Gamow-Teller part involving insertions of the Pauli spin matrices $\\vec{\\sigma}$.\n    - The initial and final state spinors, $\\vert i \\rangle$ and $\\vert f \\rangle$, are represented as $2 \\times 1$ column vectors of complex numbers. In Python, these will be implemented as NumPy arrays of `dtype=complex`.\n    - The Fermi matrix element is $M_{\\mathrm{F}} = \\langle f \\vert i \\rangle$. The bra-vector $\\langle f \\vert$ is the conjugate transpose of the ket $\\vert f \\rangle$. The squared magnitude to be used in the rate calculation is $|M_{\\mathrm{F}}|^2$. Computationally, this is the squared absolute value of the vector dot product, specifically `np.vdot(f, i)` which correctly handles the conjugation of the first vector.\n    - The Gamow-Teller matrix elements are $\\vec{M}_{\\mathrm{GT}} = (\\langle f \\vert \\sigma_x \\vert i \\rangle, \\langle f \\vert \\sigma_y \\vert i \\rangle, \\langle f \\vert \\sigma_z \\vert i \\rangle)$. The Pauli matrices, $\\sigma_k$, will be defined as $2 \\times 2$ complex NumPy arrays. The calculation for each component involves a matrix-vector product followed by a vector dot product, e.g., `np.vdot(f, sigma_x @ i)`. The squared magnitude is the sum of the squared absolute values of these three components: $|\\vec{M}_{\\mathrm{GT}}|^2 = \\sum_{k=x,y,z} |\\langle f \\vert \\sigma_k \\vert i \\rangle|^2$.\n\n2.  **Phase-Space Integral Evaluation**: The decay rate is proportional to the available phase space for the emitted leptons (electron and anti-neutrino). This is quantified by an integral over the electron's energy, $E$.\n    - The phase-space integral, which we denote as $f(Z, Q)$, is given by:\n      $$ f(Z, Q) = \\int_{m_e}^{E_0} p E (E_0 - E)^2 F(Z, E) \\, dE $$\n      where $p = \\sqrt{E^2 - m_e^2}$ is the electron momentum, $E_0 = Q + m_e$ is the endpoint energy, and $F(Z, E)$ is the Fermi function. All energies ($E, m_e, Q, E_0$) are in $\\mathrm{MeV}$.\n    - The Fermi function, $F(Z, E)$, accounts for the Coulomb interaction between the emitted electron and the daughter nucleus of charge $Z$. The specified approximation is:\n      $$ F(Z,E) \\approx \\frac{2\\pi\\eta}{1-e^{-2\\pi\\eta}} \\quad \\text{with} \\quad \\eta = \\alpha Z \\frac{E}{p} $$\n      This integral does not have a simple analytical closed form and must be evaluated numerically. The `scipy.integrate.quad` function is ideal for this task, as it provides a robust and accurate method for numerical quadrature. The integrand is well-behaved, being finite at the lower integration limit $E=m_e$ (where $p=0$).\n\n3.  **Decay Rate and Branching Ratio Calculation**: The final step is to combine the nuclear matrix elements and the phase-space factor with fundamental constants to calculate the decay rates.\n    - According to Fermi's Golden Rule, the partial decay rate $\\lambda_{\\text{channel}}$ for a single channel is given by:\n      $$ \\lambda_{\\text{channel}} = \\frac{(G_\\mathrm{F} V_{ud})^2}{2\\pi^3\\hbar} \\left( g_V^2 |M_\\mathrm{F}|^2 + g_A^2 |\\vec{M}_\\mathrm{GT}|^2 \\right) f(Z, Q) $$\n      All constants ($G_\\mathrm{F}, V_{ud}, \\hbar, g_V, g_A$) are provided. Care must be taken to ensure consistent units. With $G_\\mathrm{F}$ in $\\mathrm{MeV}^{-2}$, $\\hbar$ in $\\mathrm{MeV} \\cdot \\mathrm{s}$, and the integral $f(Z,Q)$ in $\\mathrm{MeV}^5$, the resulting rate $\\lambda$ will be in $\\mathrm{s}^{-1}$, as required.\n    - The total decay rate for the parent nucleus, $\\lambda_{\\text{tot}}$, is the sum of the partial rates over all possible decay channels: $\\lambda_{\\text{tot}} = \\sum_j \\lambda_{\\text{channel}, j}$.\n    - The branching ratio for a specific channel $j$ is the fraction of total decays that proceed through that channel: $\\mathrm{BR}_j = \\lambda_{\\text{channel}, j} / \\lambda_{\\text{tot}}$.\n\nThe overall algorithm will process each test case by iterating through its specified decay channels. For each channel, it will compute $|M_\\mathrm{F}|^2$, $|\\vec{M}_\\mathrm{GT}|^2$, and $f(Z, Q)$, and combine them to find the partial rate. After all channels for a given nucleus are processed, the total rate and branching ratios are calculated and stored. The final output will be formatted as a list of lists, adhering to the specified structure.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Computes beta-decay rates and branching ratios based on Fermi's theory.\n    \"\"\"\n\n    # Physical Constants based on problem statement\n    # Fine-structure constant\n    ALPHA = 1 / 137.035999084\n    # Fermi constant in GeV^-2\n    G_F_GEV = 1.1663787e-5\n    # Converted Fermi constant to MeV^-2 (1 GeV = 1000 MeV)\n    G_F = G_F_GEV * 1e-6\n    # CKM matrix element\n    V_UD = 0.97420\n    # Electron rest mass in MeV\n    M_E = 0.51099895\n    # Reduced Planck constant in MeV*s\n    HBAR = 6.582119569e-22\n    # Vector and axial-vector coupling constants\n    G_V = 1.0\n    G_A = 1.2723\n\n    # Pauli matrices\n    SIGMA_X = np.array([[0, 1], [1, 0]], dtype=complex)\n    SIGMA_Y = np.array([[0, -1j], [1j, 0]], dtype=complex)\n    SIGMA_Z = np.array([[1, 0], [0, -1]], dtype=complex)\n\n    # Pre-calculated constant factor for the decay rate lambda\n    # lambda = RATE_PREFACTOR * (g_V^2 |M_F|^2 + g_A^2 |M_GT|^2) * f(Z, Q)\n    RATE_PREFACTOR = (G_F * V_UD)**2 / (2 * np.pi**3 * HBAR)\n\n    def calculate_nuclear_matrix_elements(spinor_i, spinor_f):\n        \"\"\"\n        Computes the squared magnitudes of the Fermi and Gamow-Teller matrix elements.\n        \"\"\"\n        # Fermi matrix element: M_F = <f|i>\n        m_f = np.vdot(spinor_f, spinor_i)\n        m_f_sq = np.abs(m_f)**2\n\n        # Gamow-Teller matrix elements: M_GT_k = <f|sigma_k|i>\n        m_gt_x = np.vdot(spinor_f, SIGMA_X @ spinor_i)\n        m_gt_y = np.vdot(spinor_f, SIGMA_Y @ spinor_i)\n        m_gt_z = np.vdot(spinor_f, SIGMA_Z @ spinor_i)\n        m_gt_sq = np.abs(m_gt_x)**2 + np.abs(m_gt_y)**2 + np.abs(m_gt_z)**2\n        \n        return m_f_sq, m_gt_sq\n\n    def phase_space_integrand(E, Z, Q, E0):\n        \"\"\"\n        Defines the integrand for the phase-space integral.\n        \"\"\"\n        # Integrand is zero outside the physical energy range\n        if E <= M_E or E >= E0:\n            return 0.0\n\n        p_sq = E**2 - M_E**2\n        if p_sq <= 0: # Should not happen due to E > M_E check, but for safety\n            return 0.0\n        p = np.sqrt(p_sq)\n        \n        # Fermi function F(Z, E)\n        eta = ALPHA * Z * E / p\n        \n        # The denominator 1 - exp(-2*pi*eta) can be approximated by 1 for large eta,\n        # which is common. np.exp handles underflow to zero gracefully.\n        fermi_func_denom = 1.0 - np.exp(-2 * np.pi * eta)\n        if fermi_func_denom == 0.0:\n            # This case corresponds to eta -> 0 (i.e., Z=0), making F(Z,E) -> 1.\n            # No test cases have Z=0, so this is for completeness.\n            fermi_func = 1.0\n        else:\n            fermi_func = (2 * np.pi * eta) / fermi_func_denom\n        \n        return p * E * (E0 - E)**2 * fermi_func\n\n    def calculate_phase_space_integral(Z_daughter, Q):\n        \"\"\"\n        Numerically computes the phase-space integral f(Z, Q).\n        \"\"\"\n        if Q <= 0:\n            return 0.0\n        \n        E0 = Q + M_E\n        \n        # Numerically integrate using scipy.integrate.quad\n        integral_val, _ = integrate.quad(\n            phase_space_integrand,\n            M_E,  # Lower limit\n            E0,   # Upper limit\n            args=(Z_daughter, Q, E0)\n        )\n        return integral_val\n\n    def process_case(Z_parent, Q_values, spinor_i, spinors_f):\n        \"\"\"\n        Processes a single test case to find the total decay rate and branching ratios.\n        \"\"\"\n        Z_daughter = Z_parent + 1\n        \n        partial_rates = []\n        for Q, spinor_f in zip(Q_values, spinors_f):\n            # Step 1: Compute nuclear matrix elements\n            m_f_sq, m_gt_sq = calculate_nuclear_matrix_elements(spinor_i, spinor_f)\n            \n            # Step 2: Compute phase-space integral\n            f_integral = calculate_phase_space_integral(Z_daughter, Q)\n            \n            # Step 3: Compute partial rate for this channel\n            nuclear_factor = G_V**2 * m_f_sq + G_A**2 * m_gt_sq\n            rate = RATE_PREFACTOR * nuclear_factor * f_integral\n            partial_rates.append(rate)\n            \n        # Step 4: Compute total rate and branching ratios\n        total_rate = sum(partial_rates)\n        \n        if total_rate == 0.0:\n            branching_ratios = [0.0] * len(partial_rates)\n        else:\n            branching_ratios = [rate / total_rate for rate in partial_rates]\n        \n        return [total_rate] + branching_ratios\n        \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test Case 1\n        {\n            \"Z_parent\": 20,\n            \"Q_values\": [3.5, 2.0, 1.0],\n            \"spinor_i\": np.array([np.sqrt(0.6), 1j * np.sqrt(0.4)], dtype=complex),\n            \"spinors_f\": [\n                np.array([np.sqrt(0.5), np.sqrt(0.5)], dtype=complex),\n                np.array([np.sqrt(0.8), -1j * np.sqrt(0.2)], dtype=complex),\n                np.array([np.sqrt(0.3), np.sqrt(0.7)], dtype=complex),\n            ],\n        },\n        # Test Case 2\n        {\n            \"Z_parent\": 10,\n            \"Q_values\": [2.5, 1.2],\n            \"spinor_i\": np.array([np.cos(0.15), np.sin(0.15)], dtype=complex),\n            \"spinors_f\": [\n                np.array([np.cos(0.10), 1j * np.sin(0.10)], dtype=complex),\n                np.array([np.cos(0.70), np.sin(0.70)], dtype=complex),\n            ],\n        },\n        # Test Case 3\n        {\n            \"Z_parent\": 52,\n            \"Q_values\": [4.0, 0.3],\n            \"spinor_i\": np.array([np.sqrt(0.55), np.exp(1j * 0.3) * np.sqrt(0.45)], dtype=complex),\n            \"spinors_f\": [\n                np.array([np.exp(1j * 0.2) * np.sqrt(0.60), np.sqrt(0.40)], dtype=complex),\n                np.array([np.sqrt(0.20), np.exp(1j * 0.5) * np.sqrt(0.80)], dtype=complex),\n            ],\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = process_case(\n            case[\"Z_parent\"], case[\"Q_values\"], case[\"spinor_i\"], case[\"spinors_f\"]\n        )\n        all_results.append(result)\n\n    # Final print statement in the exact required format.\n    print(all_results)\n\nsolve()\n```", "id": "3559156"}, {"introduction": "Beyond allowed decays, forbidden transitions offer deeper insights into nuclear structure, distinguished by their unique spectral shapes. This exercise advances into that territory, focusing on unique forbidden decays where the shape factor $C(E)$ is modified by the lepton angular momentum $L$. You will generate synthetic spectral data and then apply maximum likelihood methods to recover the multipole order $L$, mirroring the process of inferring nuclear properties from experimental data and highlighting the predictive power of Fermi's theory [@problem_id:3559165].", "problem": "You are to implement a complete program that uses Fermi’s theory of beta decay to generate synthetic datasets for unique forbidden decays, where interference terms vanish, and then recovers the multipole orders from fits to the energy dependence. The problem is framed in purely mathematical and algorithmic terms with explicit physical context, and all quantities must be handled consistently. Use natural units with $c = \\hbar = 1$, so energy and momentum share the same unit. All energies must be expressed in mega-electronvolts (MeV), and all momenta in mega-electronvolts (MeV). The electron rest mass is $m_e = 0.511\\,\\mathrm{MeV}$ and the fine-structure constant is $\\alpha = 1/137.036$.\n\nStarting from the fundamental Fermi theory of beta decay, the differential spectrum for beta-minus emission for electron total energy $E$ (including rest mass) takes the generic form\n$$\n\\frac{dN}{dE} \\propto F(Z,E)\\, p\\, E\\, (E_0 - E)^2\\, C(E),\n$$\nwhere $Z$ is the daughter nuclear charge number, $E_0$ is the endpoint electron energy, $p = \\sqrt{E^2 - m_e^2}$ is the electron momentum, $E_0 - E$ is the neutrino energy in the zero neutrino mass limit, and $F(Z,E)$ is the Coulomb correction (Fermi function). In the leading approximation valid for moderate $Z$ and relativistic leptons, take\n$$\nF(Z,E) = \\frac{2\\pi \\eta}{1 - e^{-2\\pi \\eta}}, \\quad \\eta = \\frac{\\alpha Z E}{p}.\n$$\nConsider unique forbidden transitions of multipole order $L \\in \\{1,2,3\\}$, for which interference between distinct nuclear matrix elements vanishes. In the long-wavelength limit of Fermi theory for lepton kinematics, model the shape factor as\n$$\nC_L(E) = p^{2L} + q^{2L}, \\quad q = E_0 - E,\n$$\nso that the energy dependence is determined by the single multipole order $L$ without cross-term interference. Assume zero neutrino mass and neglect recoil.\n\nYour program must:\n- Construct binned energy spectra on a uniform grid in $E$ from $E_{\\min} = m_e + \\delta$ to $E_{\\max} = E_0 - \\delta$, where $E_0 = m_e + Q$, $Q$ is the decay $Q$-value, and $\\delta$ is a small exclusion margin to avoid singular endpoints. Use $\\delta = 10^{-6}\\,\\mathrm{MeV}$.\n- For each bin center $E_i$, compute the unnormalized spectrum weight\n$$\nw_i = F(Z,E_i)\\, p_i\\, E_i\\, (E_0 - E_i)^2\\, C_L(E_i),\n$$\nwith $p_i = \\sqrt{E_i^2 - m_e^2}$ and $C_L(E_i)$ as above.\n- Normalize the weights so that the expected total counts equal a prescribed $N_{\\mathrm{tot}}$, and draw synthetic counts $y_i$ from a Poisson distribution with mean $\\lambda_i = A\\, w_i$, where $A$ is the overall normalization chosen to satisfy $\\sum_i \\lambda_i = N_{\\mathrm{tot}}$. Use a fixed random seed for reproducibility.\n- For model selection, treat the counts as independent Poisson-distributed. For each candidate multipole order $L \\in \\{1,2,3\\}$, compute the corresponding theoretical weights $\\tilde{w}_i^{(L)}$ on the same energy grid, estimate the maximum likelihood normalization $\\hat{A}^{(L)}$ under the Poisson model, and evaluate the negative log-likelihood\n$$\n\\mathcal{L}^{(L)} = \\sum_i \\left(\\hat{\\lambda}_i^{(L)} - y_i \\ln \\hat{\\lambda}_i^{(L)}\\right),\n$$\nwhere $\\hat{\\lambda}_i^{(L)} = \\hat{A}^{(L)} \\tilde{w}_i^{(L)}$ and bins with $y_i = 0$ contribute only the $\\hat{\\lambda}_i^{(L)}$ term. Select the $L$ that minimizes $\\mathcal{L}^{(L)}$.\n\nImplement the above for the following test suite, covering differing regimes and edge conditions:\n- Case $1$: $Z = 30$, $Q = 3.5\\,\\mathrm{MeV}$, $L_{\\mathrm{true}} = 1$, $N_{\\mathrm{tot}} = 100000$, $n_{\\mathrm{bins}} = 80$.\n- Case $2$: $Z = 10$, $Q = 1.0\\,\\mathrm{MeV}$, $L_{\\mathrm{true}} = 2$, $N_{\\mathrm{tot}} = 50000$, $n_{\\mathrm{bins}} = 60$.\n- Case $3$: $Z = 50$, $Q = 6.0\\,\\mathrm{MeV}$, $L_{\\mathrm{true}} = 3$, $N_{\\mathrm{tot}} = 200000$, $n_{\\mathrm{bins}} = 100$.\n- Case $4$ (near-threshold): $Z = 5$, $Q = 0.2\\,\\mathrm{MeV}$, $L_{\\mathrm{true}} = 1$, $N_{\\mathrm{tot}} = 50000$, $n_{\\mathrm{bins}} = 50$.\n- Case $5$ (low statistics): $Z = 20$, $Q = 2.0\\,\\mathrm{MeV}$, $L_{\\mathrm{true}} = 2$, $N_{\\mathrm{tot}} = 5000$, $n_{\\mathrm{bins}} = 80$.\n\nYour program should produce a single line of output containing the inferred multipole orders for all cases in order, as a comma-separated list enclosed in square brackets. For example, the output format must be exactly like\n$$\n[\\ell_1,\\ell_2,\\ell_3,\\ell_4,\\ell_5],\n$$\nwhere each $\\ell_k$ is the integer estimate of $L$ for case $k$.", "solution": "The construction and inference follow from Fermi’s theory of beta decay and standard statistical modeling. We begin with the fundamental beta spectrum formula of Enrico Fermi, which, for beta-minus decay and under the zero neutrino mass, no-recoil, plane-wave approximations, is\n$$\n\\frac{dN}{dE} \\propto F(Z,E)\\, p\\, E\\, (E_0 - E)^2\\, C(E),\n$$\nwhere $E$ is the electron total energy (including rest mass), $p = \\sqrt{E^2 - m_e^2}$ is the electron momentum, and $E_0$ is the electron endpoint energy. The factor $(E_0 - E)^2$ arises from the neutrino phase space when the neutrino mass is negligible. The Coulomb correction $F(Z,E)$, called the Fermi function, accounts for the interaction of the outgoing electron with the nuclear charge $Z$. In the widely used approximation for moderate $Z$ and relativistic electrons,\n$$\nF(Z,E) = \\frac{2\\pi \\eta}{1 - e^{-2\\pi \\eta}}, \\quad \\eta = \\frac{\\alpha Z E}{p},\n$$\nwith fine-structure constant $\\alpha$.\n\nFor unique forbidden transitions of multipole order $L$, only a single nuclear operator contributes to the spectrum, and interference terms between different operators vanish. In the long-wavelength limit for lepton kinematics, the shape factor is modeled by\n$$\nC_L(E) = p^{2L} + q^{2L}, \\quad q = E_0 - E,\n$$\nwhich captures the characteristic energy dependence of unique transitions through the lepton momenta $p$ and $q$. The endpoint energy satisfies $E_0 = m_e + Q$, where $Q$ is the decay energy released to leptons.\n\nTo generate synthetic data we discretize energies uniformly over $[E_{\\min}, E_{\\max}]$ with $E_{\\min} = m_e + \\delta$ and $E_{\\max} = E_0 - \\delta$ and a small margin $\\delta$ to avoid singular behavior at the endpoints. At each bin center $E_i$ we compute\n$$\nw_i = F(Z,E_i)\\, p_i\\, E_i\\, (E_0 - E_i)^2\\, C_L(E_i), \\quad p_i = \\sqrt{E_i^2 - m_e^2},\n$$\nwhich provides the unnormalized expected spectral weight in that bin. We then choose a normalization $A$ such that the expected total counts equal a specified $N_{\\mathrm{tot}}$:\n$$\nA = \\frac{N_{\\mathrm{tot}}}{\\sum_i w_i}, \\quad \\lambda_i = A\\, w_i.\n$$\nObservations $y_i$ are drawn independently from the Poisson distribution with mean $\\lambda_i$, which is consistent with counting statistics in nuclear experiments.\n\nFor inference of $L$, we employ Maximum Likelihood Estimation (MLE). Under the Poisson model, given candidate $L$ and corresponding theoretical weights $\\tilde{w}_i^{(L)}$, the likelihood for counts $\\{y_i\\}$ is\n$$\n\\mathcal{L}(\\{y_i\\}\\,|\\,A,L) = \\prod_i \\frac{(A\\, \\tilde{w}_i^{(L)})^{y_i} e^{-A\\, \\tilde{w}_i^{(L)}}}{y_i!}.\n$$\nThe log-likelihood is\n$$\n\\ln \\mathcal{L}(A,L) = \\sum_i \\left(y_i \\ln (A\\, \\tilde{w}_i^{(L)}) - A\\, \\tilde{w}_i^{(L)} - \\ln(y_i!)\\right).\n$$\nMaximizing with respect to $A$ yields\n$$\n\\hat{A}^{(L)} = \\frac{\\sum_i y_i}{\\sum_i \\tilde{w}_i^{(L)}},\n$$\nwhich is the standard MLE normalization for a known shape. Substituting $\\hat{A}^{(L)}$ back, and ignoring the constant $\\sum_i \\ln(y_i!)$ that does not depend on $L$, we minimize the negative log-likelihood\n$$\n\\mathcal{L}^{(L)} = \\sum_i \\left(\\hat{\\lambda}_i^{(L)} - y_i \\ln \\hat{\\lambda}_i^{(L)}\\right), \\quad \\hat{\\lambda}_i^{(L)} = \\hat{A}^{(L)} \\tilde{w}_i^{(L)}.\n$$\nThe bins with $y_i = 0$ contribute only $\\hat{\\lambda}_i^{(L)}$ since $y_i \\ln \\hat{\\lambda}_i^{(L)}$ vanishes. We select the $L \\in \\{1,2,3\\}$ that minimizes $\\mathcal{L}^{(L)}$.\n\nAlgorithmic steps:\n- Fix constants $m_e = 0.511\\,\\mathrm{MeV}$, $\\alpha = 1/137.036$, and margin $\\delta = 10^{-6}\\,\\mathrm{MeV}$.\n- For each test case $(Z, Q, L_{\\mathrm{true}}, N_{\\mathrm{tot}}, n_{\\mathrm{bins}})$:\n  - Compute $E_0 = m_e + Q$ and define a uniform grid of $n_{\\mathrm{bins}}$ points from $E_{\\min}$ to $E_{\\max}$.\n  - Compute $p_i$, $q_i$, $F(Z,E_i)$, and $w_i$ using the formulas above for $L_{\\mathrm{true}}$ and generate Poisson counts with $\\sum_i \\lambda_i = N_{\\mathrm{tot}}$ using a fixed random seed.\n  - For each candidate $L \\in \\{1,2,3\\}$, compute $\\tilde{w}_i^{(L)}$, $\\hat{A}^{(L)}$, $\\hat{\\lambda}_i^{(L)}$, and $\\mathcal{L}^{(L)}$.\n  - Choose the $L$ that minimizes $\\mathcal{L}^{(L)}$ as the recovered multipole order.\n- Aggregate the recovered orders in the order of cases and print a single line formatted as $[\\ell_1,\\ell_2,\\ell_3,\\ell_4,\\ell_5]$.\n\nThis procedure tests different regimes: moderate $Z$ and large $Q$ with high statistics (case $1$), lower $Q$ (case $2$), strong Coulomb corrections at larger $Z$ and $Q$ (case $3$), near-threshold kinematics (case $4$), and low-statistics conditions (case $5$). With the specified seed and model, the fit should correctly identify the unique forbidden multipole order by its characteristic energy dependence embedded in $C_L(E)$ and filtered by the Fermi function and phase-space factors.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Constants in natural units (c = ħ = 1)\nME = 0.511  # MeV, electron rest mass\nALPHA = 1.0 / 137.036  # fine-structure constant\nDELTA = 1e-6  # MeV, endpoint exclusion margin for numerical stability\nPI = np.pi\n\nrng = np.random.default_rng(seed=123456789)  # fixed seed for reproducibility\n\n\ndef fermi_function(Z: int, E: np.ndarray, p: np.ndarray) -> np.ndarray:\n    \"\"\"\n    Leading-order Fermi function approximation:\n    F(Z,E) = 2*pi*eta / (1 - exp(-2*pi*eta)),  eta = alpha*Z*E/p.\n    Clip p away from zero to avoid division issues at endpoints.\n    \"\"\"\n    p_safe = np.clip(p, 1e-15, None)\n    eta = ALPHA * Z * E / p_safe\n    # Avoid overflow in exp for large eta by clipping\n    x = 2.0 * PI * eta\n    # Use stable computation for 1 - exp(-x)\n    denom = 1.0 - np.exp(-np.clip(x, None, 700.0))\n    # Ensure denom is not zero\n    denom = np.where(denom == 0.0, np.finfo(float).tiny, denom)\n    F = x / denom\n    return F\n\n\ndef shape_factor_unique(L: int, p: np.ndarray, q: np.ndarray) -> np.ndarray:\n    \"\"\"\n    Unique forbidden shape factor (long-wavelength lepton kinematics):\n    C_L(E) = p^{2L} + q^{2L}\n    \"\"\"\n    return np.power(p, 2 * L) + np.power(q, 2 * L)\n\n\ndef compute_energy_grid(E0: float, n_bins: int) -> np.ndarray:\n    \"\"\"\n    Uniform grid in E from E_min to E_max excluding endpoints by DELTA.\n    \"\"\"\n    Emin = ME + DELTA\n    Emax = E0 - DELTA\n    return np.linspace(Emin, Emax, n_bins)\n\n\ndef compute_weights(Z: int, Q: float, L: int, n_bins: int) -> tuple[np.ndarray, np.ndarray]:\n    \"\"\"\n    Compute energy grid and unnormalized spectral weights for given parameters.\n    Returns (E_grid, weights).\n    \"\"\"\n    E0 = ME + Q\n    E = compute_energy_grid(E0, n_bins)\n    p = np.sqrt(np.clip(E**2 - ME**2, 0.0, None))\n    q = E0 - E\n    F = fermi_function(Z, E, p)\n    C = shape_factor_unique(L, p, q)\n    w = F * p * E * (q**2) * C\n    # Clip weights to avoid zeros\n    w = np.clip(w, 1e-300, None)\n    return E, w\n\n\ndef simulate_counts(weights: np.ndarray, N_tot: int) -> np.ndarray:\n    \"\"\"\n    Normalize weights to N_tot and draw Poisson counts.\n    \"\"\"\n    total_w = np.sum(weights)\n    if not np.isfinite(total_w) or total_w <= 0.0:\n        raise ValueError(\"Invalid total weight for simulation.\")\n    A = N_tot / total_w\n    lam = A * weights\n    y = rng.poisson(lam)\n    return y\n\n\ndef nll_poisson(y: np.ndarray, lam: np.ndarray) -> float:\n    \"\"\"\n    Negative log-likelihood for independent Poisson counts ignoring constant terms.\n    NLL = sum(lam - y * log(lam)), with convention y*log(lam)=0 for y=0.\n    \"\"\"\n    lam_safe = np.clip(lam, 1e-300, None)\n    term = lam_safe - y * np.log(lam_safe)\n    return float(np.sum(term))\n\n\ndef fit_multipole_order(Z: int, Q: float, y: np.ndarray, E: np.ndarray, candidate_Ls=(1, 2, 3)) -> int:\n    \"\"\"\n    Fit candidate multipole orders by minimizing Poisson NLL and return best L.\n    \"\"\"\n    best_L = candidate_Ls[0]\n    best_nll = np.inf\n    E0 = ME + Q\n    p = np.sqrt(np.clip(E**2 - ME**2, 0.0, None))\n    q = E0 - E\n    F = fermi_function(Z, E, p)\n\n    for L in candidate_Ls:\n        C = shape_factor_unique(L, p, q)\n        w = F * p * E * (q**2) * C\n        w = np.clip(w, 1e-300, None)\n        sum_w = np.sum(w)\n        if not np.isfinite(sum_w) or sum_w <= 0.0:\n            nll = np.inf\n        else:\n            A_hat = np.sum(y) / sum_w\n            lam = A_hat * w\n            nll = nll_poisson(y, lam)\n        if nll < best_nll:\n            best_nll = nll\n            best_L = L\n    return best_L\n\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (Z, Q [MeV], L_true, N_tot, n_bins)\n    test_cases = [\n        (30, 3.5, 1, 100000, 80),\n        (10, 1.0, 2, 50000, 60),\n        (50, 6.0, 3, 200000, 100),\n        (5, 0.2, 1, 50000, 50),\n        (20, 2.0, 2, 5000, 80),\n    ]\n\n    results = []\n    for Z, Q, L_true, N_tot, n_bins in test_cases:\n        # Generate synthetic data\n        E, w_true = compute_weights(Z, Q, L_true, n_bins)\n        y = simulate_counts(w_true, N_tot)\n        # Fit candidate L values\n        L_fit = fit_multipole_order(Z, Q, y, E, candidate_Ls=(1, 2, 3))\n        results.append(L_fit)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3559165"}]}