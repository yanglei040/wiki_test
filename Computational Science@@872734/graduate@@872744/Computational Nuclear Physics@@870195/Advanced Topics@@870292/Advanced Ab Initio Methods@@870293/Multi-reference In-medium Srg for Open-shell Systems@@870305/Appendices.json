{"hands_on_practices": [{"introduction": "Before deploying sophisticated many-body techniques, it is essential to diagnose when they are truly necessary. This first exercise provides a clear, quantitative look at the breakdown of the single-reference picture, which is the primary motivation for methods like MR-IMSRG. By diagonalizing a simple two-level shell-model Hamiltonian, you will directly compute the degree of configuration mixing and see how even simple interactions can lead to a ground state that cannot be described by a single Slater determinant [@problem_id:3571469].", "problem": "Consider a schematic two-level shell-model for an open-shell nucleus with two valence nucleons, designed to probe the suitability of a single Slater determinant reference in the context of multi-reference in-medium Similarity Renormalization Group (MR-IMSRG). The model space consists of two single-particle orbitals, labeled $a$ and $b$, with single-particle energies $\\varepsilon_a$ and $\\varepsilon_b$, respectively. Each orbital supports a paired, seniority-zero configuration in which both valence nucleons occupy the same orbital. Let the seniority-zero basis be $\\{|aa\\rangle, |bb\\rangle\\}$, where $|aa\\rangle$ denotes both valence nucleons occupying orbital $a$, and similarly for $|bb\\rangle$.\n\nStart from the second-quantized Hamiltonian\n$$\n\\hat{H} = \\sum_{i} \\varepsilon_i \\hat{n}_i + \\frac{1}{4} \\sum_{ij,kl} \\bar{v}_{ij,kl}\\, a_i^\\dagger a_j^\\dagger a_l a_k,\n$$\nwhere $\\varepsilon_i$ are single-particle energies, $\\hat{n}_i$ are number operators, and $\\bar{v}_{ij,kl}$ are antisymmetrized two-body matrix elements. In the reduced seniority-zero subspace spanned by $\\{|aa\\rangle, |bb\\rangle\\}$, assume a schematic interaction that couples these two paired configurations with a real mixing parameter $V$ and neglects additional diagonal correlation shifts (a constant energy shift common to both basis states does not affect configuration weights). Under these assumptions, the Hamiltonian in this subspace is a real, symmetric $2\\times 2$ matrix determined by $\\varepsilon_a$, $\\varepsilon_b$, and $V$.\n\nLet the \"single Slater determinant reference\" be defined as the noninteracting ground configuration: the paired configuration that minimizes the one-body energy, i.e., $|\\text{ref}\\rangle = |aa\\rangle$ if $\\varepsilon_a \\le \\varepsilon_b$ and $|\\text{ref}\\rangle = |bb\\rangle$ otherwise. Denote the exact normalized ground state of the $2\\times 2$ Hamiltonian by $|\\Psi_0\\rangle$. The quantity that measures the failure of a single Slater determinant reference in this schematic model is the leading-configuration weight\n$$\nw_{\\text{ref}} = \\left| \\langle \\text{ref} | \\Psi_0 \\rangle \\right|^2.\n$$\nA value $w_{\\text{ref}} \\approx 1$ indicates that a single-reference description is adequate, while $w_{\\text{ref}} \\ll 1$ signals strong multi-configurational character and motivates a multi-reference treatment such as MR-IMSRG.\n\nTask: For each parameter set $(\\varepsilon_a, \\varepsilon_b, V)$ provided in the test suite below, construct the associated $2\\times 2$ seniority-zero Hamiltonian, perform an exact diagonalization to obtain $|\\Psi_0\\rangle$, identify the appropriate $|\\text{ref}\\rangle$ based on $(\\varepsilon_a, \\varepsilon_b)$, and compute $w_{\\text{ref}}$.\n\nYou must produce the results for the following test suite:\n- Test $1$: $(\\varepsilon_a, \\varepsilon_b, V) = (0.0, 1.0, 0.3)$.\n- Test $2$: $(\\varepsilon_a, \\varepsilon_b, V) = (0.0, 0.2, 0.15)$.\n- Test $3$: $(\\varepsilon_a, \\varepsilon_b, V) = (0.0, 0.0, 0.5)$.\n- Test $4$: $(\\varepsilon_a, \\varepsilon_b, V) = (0.0, 0.5, 0.0)$.\n- Edge Test $5$: $(\\varepsilon_a, \\varepsilon_b, V) = (0.0, 0.01, 0.05)$.\n\nAll quantities are dimensionless in this schematic model, so no physical units are required.\n\nYour program should output a single line containing the list of $w_{\\text{ref}}$ values for the test suite, each rounded to six decimal places, aggregated as a comma-separated list enclosed in square brackets. For example, the required output format is $[\\text{result}_1,\\text{result}_2,\\ldots,\\text{result}_5]$, where each $\\text{result}_k$ is a float rounded to six decimal places.", "solution": "The problem is assessed to be valid. It is scientifically grounded in the principles of quantum mechanics and nuclear shell model theory, well-posed with a unique and meaningful solution, objective, and self-contained. The provided parameters and definitions are sufficient and consistent for constructing and solving the problem.\n\nThe task is to compute the leading-configuration weight $w_{\\text{ref}}$ for a schematic two-level system describing two valence nucleons. This involves constructing and diagonalizing a $2\\times 2$ Hamiltonian matrix for several sets of parameters.\n\n### Step 1: Constructing the Hamiltonian Matrix\n\nThe model space is spanned by two seniority-zero basis states, $|aa\\rangle$ and $|bb\\rangle$, where both nucleons occupy orbital $a$ or orbital $b$, respectively. We can represent these orthonormal basis states by the standard basis vectors in $\\mathbb{R}^2$:\n$$\n|aa\\rangle \\rightarrow \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}, \\quad |bb\\rangle \\rightarrow \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}\n$$\nThe Hamiltonian $\\hat{H}$ in this basis is a $2\\times 2$ matrix $\\mathbf{H}$ with elements $H_{ij} = \\langle \\phi_i | \\hat{H} | \\phi_j \\rangle$ for $i,j \\in \\{a, b\\}$.\n\nThe diagonal elements represent the energies of the pure configurations. The one-body part of the Hamiltonian, $\\sum_k \\varepsilon_k \\hat{n}_k$, contributes to these energies. For the state $|aa\\rangle$, two nucleons are in orbital $a$, so its one-body energy is $2\\varepsilon_a$. For $|bb\\rangle$, the energy is $2\\varepsilon_b$. The problem states that we can neglect any additional diagonal shifts from the two-body interaction, which are assumed to be zero or contribute a constant shift to both states. Since a global energy shift does not affect the eigenvectors, we can write the diagonal matrix elements as:\n$$\nH_{11} = \\langle aa | \\hat{H} | aa \\rangle = 2\\varepsilon_a\n$$\n$$\nH_{22} = \\langle bb | \\hat{H} | bb \\rangle = 2\\varepsilon_b\n$$\nThe off-diagonal elements, $H_{12} = \\langle aa | \\hat{H} | bb \\rangle$, represent the mixing between the two configurations due to the two-body interaction. The problem specifies this mixing with a single real parameter $V$. Since the Hamiltonian is Hermitian (and real-symmetric in this case), we have $H_{12} = H_{21} = V$.\n\nThus, the Hamiltonian matrix in the basis ($|aa\\rangle, |bb\\rangle$) is:\n$$\n\\mathbf{H} = \\begin{pmatrix} 2\\varepsilon_a & V \\\\ V & 2\\varepsilon_b \\end{pmatrix}\n$$\n\n### Step 2: Diagonalization of the Hamiltonian\n\nTo find the exact ground state $|\\Psi_0\\rangle$, we must find the eigenvector corresponding to the lowest eigenvalue of $\\mathbf{H}$. The eigenvalues $E$ are the roots of the characteristic equation $\\det(\\mathbf{H} - E\\mathbf{I}) = 0$:\n$$\n(2\\varepsilon_a - E)(2\\varepsilon_b - E) - V^2 = 0\n$$\nThe ground state energy $E_0$ is the lower of the two eigenvalues.\nThe corresponding normalized eigenvector $|\\Psi_0\\rangle$ can be written as a linear combination of the basis states:\n$$\n|\\Psi_0\\rangle = c_a |aa\\rangle + c_b |bb\\rangle, \\quad \\text{with } |c_a|^2 + |c_b|^2 = 1\n$$\nIn our matrix representation, this eigenvector is $\\begin{pmatrix} c_a \\\\ c_b \\end{pmatrix}$. This vector can be found efficiently using standard numerical linear algebra routines, such as those available in `numpy`. These routines typically return the eigenvalues and a matrix whose columns are the corresponding normalized eigenvectors. We select the eigenvector column that corresponds to the minimum eigenvalue.\n\n### Step 3: Identification of the Reference State\n\nThe single Slater determinant reference state, $|\\text{ref}\\rangle$, is defined as the non-interacting ground configuration, i.e., the basis state with the lower one-body energy.\n- If $\\varepsilon_a \\le \\varepsilon_b$, the state $|aa\\rangle$ has lower or equal energy ($2\\varepsilon_a \\le 2\\varepsilon_b$). Therefore, $|\\text{ref}\\rangle = |aa\\rangle$.\n- If $\\varepsilon_a > \\varepsilon_b$, the state $|bb\\rangle$ has lower energy. Therefore, $|\\text{ref}\\rangle = |bb\\rangle$.\n\n### Step 4: Calculation of the Leading-Configuration Weight\n\nThe leading-configuration weight, $w_{\\text{ref}}$, measures the overlap squared between the exact ground state $|\\Psi_0\\rangle$ and the reference state $|\\text{ref}\\rangle$:\n$$\nw_{\\text{ref}} = \\left| \\langle \\text{ref} | \\Psi_0 \\rangle \\right|^2\n$$\nUsing the coefficient expansion of $|\\Psi_0\\rangle$:\n- If $|\\text{ref}\\rangle = |aa\\rangle$, then $\\langle \\text{ref} | \\Psi_0 \\rangle = \\langle aa | (c_a |aa\\rangle + c_b |bb\\rangle) = c_a$. The weight is $w_{\\text{ref}} = |c_a|^2 = c_a^2$, as the coefficients can be chosen to be real.\n- If $|\\text{ref}\\rangle = |bb\\rangle$, then $\\langle \\text{ref} | \\Psi_0 \\rangle = \\langle bb | (c_a |aa\\rangle + c_b |bb\\rangle) = c_b$. The weight is $w_{\\text{ref}} = |c_b|^2 = c_b^2$.\n\nThe procedure for each given set of parameters $(\\varepsilon_a, \\varepsilon_b, V)$ is as follows:\n1.  Construct the matrix $\\mathbf{H} = \\begin{pmatrix} 2\\varepsilon_a & V \\\\ V & 2\\varepsilon_b \\end{pmatrix}$.\n2.  Numerically diagonalize $\\mathbf{H}$ to find its eigenvalues and eigenvectors.\n3.  Identify the eigenvector $\\begin{pmatrix} c_a \\\\ c_b \\end{pmatrix}$ corresponding to the lowest eigenvalue.\n4.  Determine the reference state based on the comparison of $\\varepsilon_a$ and $\\varepsilon_b$.\n5.  If $\\varepsilon_a \\le \\varepsilon_b$, calculate $w_{\\text{ref}} = c_a^2$.\n6.  If $\\varepsilon_a > \\varepsilon_b$, calculate $w_{\\text{ref}} = c_b^2$.\nThis procedure is applied to all test cases to generate the final list of results.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the schematic two-level shell model problem for a given test suite.\n\n    For each parameter set (eps_a, eps_b, V), this function:\n    1. Constructs the 2x2 Hamiltonian matrix.\n    2. Diagonalizes the Hamiltonian to find the ground state eigenvector.\n    3. Identifies the appropriate single Slater determinant reference state.\n    4. Computes the leading-configuration weight w_ref.\n    \"\"\"\n\n    # Test suite from the problem statement.\n    # Each tuple is in the format (eps_a, eps_b, V).\n    test_cases = [\n        (0.0, 1.0, 0.3),   # Test 1\n        (0.0, 0.2, 0.15),  # Test 2\n        (0.0, 0.0, 0.5),   # Test 3\n        (0.0, 0.5, 0.0),   # Test 4\n        (0.0, 0.01, 0.05)  # Edge Test 5\n    ]\n\n    results = []\n    for eps_a, eps_b, V in test_cases:\n        # Step 1: Construct the 2x2 Hamiltonian matrix H.\n        # The basis is {|aa>, |bb>}.\n        # H_11 = 2*eps_a, H_22 = 2*eps_b, H_12 = H_21 = V.\n        hamiltonian = np.array([\n            [2 * eps_a, V],\n            [V, 2 * eps_b]\n        ], dtype=float)\n\n        # Step 2: Diagonalize the Hamiltonian.\n        # numpy.linalg.eigh is suitable for Hermitian matrices. It returns\n        # eigenvalues sorted in ascending order and corresponding eigenvectors\n        # as columns of a matrix.\n        eigenvalues, eigenvectors = np.linalg.eigh(hamiltonian)\n\n        # The ground state is the eigenvector corresponding to the lowest eigenvalue.\n        # This is the first column of the eigenvectors matrix.\n        ground_state_vector = eigenvectors[:, 0]\n        c_a, c_b = ground_state_vector[0], ground_state_vector[1]\n\n        # Step 3: Identify the reference state |ref>.\n        # |ref> is |aa> if eps_a <= eps_b, otherwise |ref> is |bb>.\n        # The basis state |aa> corresponds to index 0.\n        # The basis state |bb> corresponds to index 1.\n        if eps_a <= eps_b:\n            ref_index = 0  # Reference state is |aa>\n        else:\n            ref_index = 1  # Reference state is |bb>\n\n        # Step 4: Compute the leading-configuration weight w_ref.\n        # w_ref = |<ref|Psi_0>|^2.\n        # If ref is |aa> (index 0), weight is c_a^2.\n        # If ref is |bb> (index 1), weight is c_b^2.\n        w_ref = ground_state_vector[ref_index]**2\n        \n        results.append(w_ref)\n\n    # Format the final output as a comma-separated list of strings,\n    # with each result rounded to six decimal places, enclosed in brackets.\n    output_str = f\"[{','.join([f'{r:.6f}' for r in results])}]\"\n    print(output_str)\n\n# Execute the main function.\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3571469"}, {"introduction": "Having established the need for a multi-reference framework, we now turn to the core mathematical machinery: generalized normal ordering. This practice moves beyond the simple Slater determinant reference and introduces the one-body density matrix $\\gamma$ and two-body cumulant $\\lambda$ to describe a correlated state [@problem_id:3571488]. By calculating the normal-ordered components of a Hamiltonian with respect to this general reference, you will gain a concrete understanding of how the reference state's correlations are absorbed into the effective operators.", "problem": "Consider a two-body Hamiltonian in second quantization,\n$$\\hat{V} \\equiv \\frac{1}{4} \\sum_{p q r s} v_{p q, r s}\\, a_{p}^{\\dagger} a_{q}^{\\dagger} a_{s} a_{r},$$\nwith real antisymmetrized two-body matrix elements $v_{p q, r s}$ that satisfy $v_{p q, r s} = - v_{q p, r s} = - v_{p q, s r} = v_{q p, s r}$ and $v_{p q, r s} = v_{r s, p q}$. Work in a model space of three orthonormal single-particle orbitals labeled $1,2,3$, and assume the only nonzero two-body matrix elements (in energy units of mega-electron-volts, MeV) are\n$v_{12,12} = 2.0$, $v_{13,13} = 0.8$, $v_{23,23} = 1.6$,\nwith all other $v_{p q, r s}$ equal to zero (the stated antisymmetries are implied). Let the reference for generalized normal ordering be a correlated state suitable for an open-shell system in the Multi-Reference In-Medium Similarity Renormalization Group (IMSRG), characterized by the one-body reduced density matrix $\\gamma_{i j} \\equiv \\langle a_{j}^{\\dagger} a_{i} \\rangle$ and the two-body cumulant $\\lambda_{i j, k l}$, where the two-body reduced density matrix $\\Gamma^{(2)}$ decomposes as $\\Gamma^{(2)}_{i j, k l} = \\gamma_{i k}\\gamma_{j l} - \\gamma_{i l}\\gamma_{j k} + \\lambda_{i j, k l}$. Take the nonzero elements of the reference densities to be\n$\\gamma_{11} = 1.0$, $\\gamma_{22} = 0.6$, $\\gamma_{33} = 0.4$,\nand\n$\\lambda_{12,12} = -0.02$, $\\lambda_{13,13} = +0.02$, $\\lambda_{23,23} = +0.02$,\nwith all other $\\gamma_{i j}$ and $\\lambda_{i j, k l}$ equal to zero, and with the usual antisymmetry and Hermiticity properties understood. For comparison to single-reference normal ordering, use the Slater-determinant reference with orbitals $1$ and $2$ occupied and orbital $3$ empty, for which $\\gamma^{\\mathrm{SR}}_{11} = \\gamma^{\\mathrm{SR}}_{22} = 1$, $\\gamma^{\\mathrm{SR}}_{33} = 0$, off-diagonal $\\gamma^{\\mathrm{SR}}_{i j} = 0$ when $i \\neq j$, and $\\lambda^{\\mathrm{SR}}_{i j, k l} = 0$.\n\nStarting from the fundamental second-quantized definitions of normal ordering relative to a general correlated reference and the generalized Wick theorem, derive the multi-reference normal-ordered zero-body energy $E^{(0)}_{\\mathrm{MR}}$ and one-body operator coefficients $f^{p}_{q,\\mathrm{MR}}$ of $\\hat{V}$ in terms of $v_{p q, r s}$, $\\gamma$, and $\\lambda$, and identify the normal-ordered two-body part. Evaluate the multi-reference zero-, one-, and two-body parts numerically for the data given above. Then, perform the analogous single-reference normal ordering with the stated Slater determinant and compute the single-reference zero-body energy $E^{(0)}_{\\mathrm{SR}}$. Finally, report the difference\n$$\\Delta E \\equiv E^{(0)}_{\\mathrm{MR}} - E^{(0)}_{\\mathrm{SR}}.$$\nExpress the final result for $\\Delta E$ in MeV and round your answer to four significant figures.", "solution": "The user wants me to solve a computational nuclear physics problem involving multi-reference in-medium Similarity Renormalization Group (IMSRG).\n\n### Step 1: Extract Givens\n\n1.  **Two-body Hamiltonian**:\n    $$ \\hat{V} \\equiv \\frac{1}{4} \\sum_{p q r s} v_{p q, r s}\\, a_{p}^{\\dagger} a_{q}^{\\dagger} a_{s} a_{r} $$\n2.  **Model Space**: Three orthonormal single-particle orbitals labeled $1, 2, 3$.\n3.  **Two-body Matrix Elements ($v_{pq,rs}$)**:\n    -   Real, antisymmetrized: $v_{p q, r s} = - v_{q p, r s} = - v_{p q, s r} = v_{q p, s r}$.\n    -   Hermitian: $v_{p q, r s} = v_{r s, p q}$.\n    -   Nonzero values (in MeV): $v_{12,12} = 2.0$, $v_{13,13} = 0.8$, $v_{23,23} = 1.6$. All other elements are zero, with stated symmetries implied. For example, $v_{21,21} = v_{12,12} = 2.0$, and $v_{12,21} = -v_{12,12} = -2.0$.\n4.  **Multi-Reference (MR) State Characterization**:\n    -   One-body reduced density matrix (1-RDM): $\\gamma_{i j} \\equiv \\langle a_{j}^{\\dagger} a_{i} \\rangle$.\n    -   Nonzero 1-RDM elements: $\\gamma_{11} = 1.0$, $\\gamma_{22} = 0.6$, $\\gamma_{33} = 0.4$. All off-diagonal elements $\\gamma_{ij}$ ($i \\neq j$) are zero.\n    -   Two-body cumulant ($\\lambda$): Decomposes the two-body reduced density matrix (2-RDM) $\\Gamma^{(2)}_{i j, k l} = \\langle a_{i}^{\\dagger} a_{j}^{\\dagger} a_{l} a_{k} \\rangle$ via $\\Gamma^{(2)}_{i j, k l} = \\gamma_{i k}\\gamma_{j l} - \\gamma_{i l}\\gamma_{j k} + \\lambda_{i j, k l}$.\n    -   Nonzero $\\lambda$ elements: $\\lambda_{12,12} = -0.02$, $\\lambda_{13,13} = +0.02$, $\\lambda_{23,23} = +0.02$. Antisymmetry and Hermiticity are implied.\n5.  **Single-Reference (SR) State Characterization**:\n    -   Slater determinant with orbitals $1, 2$ occupied, $3$ empty.\n    -   1-RDM: $\\gamma^{\\mathrm{SR}}_{11} = 1$, $\\gamma^{\\mathrm{SR}}_{22} = 1$, $\\gamma^{\\mathrm{SR}}_{33} = 0$. Off-diagonal elements are zero.\n    -   2-body cumulant: $\\lambda^{\\mathrm{SR}}_{i j, k l} = 0$ for all indices.\n6.  **Task**:\n    -   Derive the multi-reference normal-ordered zero-body energy $E^{(0)}_{\\mathrm{MR}}$, one-body coefficients $f^{p}_{q,\\mathrm{MR}}$, and identify the two-body part of $\\hat{V}$.\n    -   Numerically evaluate the MR zero-, one-, and two-body parts.\n    -   Compute the single-reference zero-body energy $E^{(0)}_{\\mathrm{SR}}$.\n    -   Report the difference $\\Delta E \\equiv E^{(0)}_{\\mathrm{MR}} - E^{(0)}_{\\mathrm{SR}}$ in MeV, rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\n\nThe problem is scientifically grounded, rooted in the standard formalism of quantum many-body theory, specifically the normal-ordering technique with respect to a general correlated reference state as used in frameworks like IMSRG. All terms ($\\hat{V}$, $\\gamma$, $\\lambda$, normal ordering) are well-defined within this context. The provided data is self-contained and consistent; for instance, the diagonal elements of the 1-RDM, representing occupation numbers, are all within the physically required range $[0, 1]$. The problem is well-posed, asking for a specific, calculable quantity based on the provided data and theoretical framework. There are no contradictions, ambiguities, or scientifically unsound premises.\n\n### Step 3: Verdict and Action\n\nThe problem is valid. I will proceed with the solution.\n\n### Derivation of Normal-Ordered Components\n\nThe normal ordering of an operator $\\hat{O}$ with respect to a general correlated reference state $|\\Psi\\rangle$ decomposes the operator into its expectation value (zero-body part), a one-body normal-ordered part, a two-body normal-ordered part, and so on.\n$$ \\hat{O} = \\langle \\hat{O} \\rangle + :\\hat{O}:^{(1)} + :\\hat{O}:^{(2)} + \\dots $$\nThe normal-ordered operators are defined such that their expectation value with respect to the reference state is zero.\n\nFor the given two-body Hamiltonian $\\hat{V}$, the decomposition is:\n$$ \\hat{V} = E^{(0)}_{\\mathrm{MR}} + \\sum_{p q} f^{p}_{q,\\mathrm{MR}} :a_{p}^{\\dagger} a_{q}: + \\frac{1}{4} \\sum_{p q r s} v_{pq,rs,\\mathrm{MR}} :a_{p}^{\\dagger} a_{q}^{\\dagger} a_{s} a_{r}: $$\n\n**1. Zero-Body Part ($E^{(0)}_{\\mathrm{MR}}$)**\nThe zero-body part is the expectation value of the Hamiltonian in the reference state:\n$$ E^{(0)}_{\\mathrm{MR}} = \\langle \\hat{V} \\rangle = \\frac{1}{4} \\sum_{p q r s} v_{p q, r s} \\langle a_{p}^{\\dagger} a_{q}^{\\dagger} a_{s} a_{r} \\rangle $$\nThe expectation value term is the two-body reduced density matrix (2-RDM), $\\Gamma^{(2)}_{pq,rs}$. Using the provided decomposition:\n$$ \\Gamma^{(2)}_{pq,rs} = \\gamma_{pr}\\gamma_{qs} - \\gamma_{ps}\\gamma_{qr} + \\lambda_{pq,rs} $$\nThus, the expression for the zero-body energy is:\n$$ E^{(0)}_{\\mathrm{MR}} = \\frac{1}{4} \\sum_{p q r s} v_{p q, r s} (\\gamma_{pr}\\gamma_{qs} - \\gamma_{ps}\\gamma_{qr} + \\lambda_{pq,rs}) $$\n\n**2. One-Body Part ($f^{p}_{q,\\mathrm{MR}}$)**\nThe one-body part arises from applying the generalized Wick theorem and collecting all terms with one normal-ordered pair $:a_p^\\dagger a_q:$. This corresponds to performing one contraction on the operator string $a_p^\\dagger a_q^\\dagger a_s a_r$. The standard result for the coefficients $f^{p}_{q,\\mathrm{MR}}$ is given by contracting $\\hat{V}$ with the 1-RDM:\n$$ f^{p}_{q,\\mathrm{MR}} = \\sum_{r,s} v_{pr,qs} \\gamma_{sr} $$\nwhere $\\gamma_{sr} = \\langle a_r^\\dagger a_s \\rangle$.\n\n**3. Two-Body Part ($v_{pq,rs,\\mathrm{MR}}$)**\nThe operator $\\hat{V}$ is itself a two-body operator. Since there are no higher-body operators in the Hamiltonian to be contracted down, the normal-ordered two-body part retains the same coefficients as the original Hamiltonian.\n$$ v_{pq,rs,\\mathrm{MR}} = v_{pq,rs} $$\n\n### Numerical Evaluation for Multi-Reference Case\n\n**1. Zero-Body Energy $E^{(0)}_{\\mathrm{MR}}$**\nThe interaction $v_{pq,rs}$ is non-zero only if $\\{p,q\\} = \\{r,s\\}$ and this pair is one of $\\{1,2\\}, \\{1,3\\},$ or $\\{2,3\\}$. This block-diagonal structure simplifies the summation. The contribution from each block $\\{a,b\\}$ is $v_{ab,ab}\\Gamma^{(2)}_{ab,ab}$.\n$$ E^{(0)}_{\\mathrm{MR}} = v_{12,12} \\Gamma^{(2)}_{12,12} + v_{13,13} \\Gamma^{(2)}_{13,13} + v_{23,23} \\Gamma^{(2)}_{23,23} $$\nThe 2-RDM elements are:\n$$ \\Gamma^{(2)}_{12,12} = \\gamma_{11}\\gamma_{22} - \\gamma_{12}\\gamma_{21} + \\lambda_{12,12} $$\n$$ \\Gamma^{(2)}_{13,13} = \\gamma_{11}\\gamma_{33} - \\gamma_{13}\\gamma_{31} + \\lambda_{13,13} $$\n$$ \\Gamma^{(2)}_{23,23} = \\gamma_{22}\\gamma_{33} - \\gamma_{23}\\gamma_{32} + \\lambda_{23,23} $$\nSince the given 1-RDM $\\gamma$ is diagonal ($\\gamma_{ij}=0$ for $i \\neq j$):\n$$ \\Gamma^{(2)}_{12,12} = \\gamma_{11}\\gamma_{22} + \\lambda_{12,12} = (1.0)(0.6) + (-0.02) = 0.6 - 0.02 = 0.58 $$\n$$ \\Gamma^{(2)}_{13,13} = \\gamma_{11}\\gamma_{33} + \\lambda_{13,13} = (1.0)(0.4) + (0.02) = 0.4 + 0.02 = 0.42 $$\n$$ \\Gamma^{(2)}_{23,23} = \\gamma_{22}\\gamma_{33} + \\lambda_{23,23} = (0.6)(0.4) + (0.02) = 0.24 + 0.02 = 0.26 $$\nNow, we compute $E^{(0)}_{\\mathrm{MR}}$:\n$$ E^{(0)}_{\\mathrm{MR}} = (2.0)(0.58) + (0.8)(0.42) + (1.6)(0.26) = 1.16 + 0.336 + 0.416 = 1.912 \\, \\text{MeV} $$\n\n**2. One-Body Coefficients $f^{p}_{q,\\mathrm{MR}}$**\nSince $\\gamma$ is diagonal, $\\gamma_{sr} = \\gamma_{ss}\\delta_{sr}$. The formula becomes:\n$$ f^{p}_{q,\\mathrm{MR}} = \\sum_{r,s} v_{pr,qs} \\gamma_{ss}\\delta_{sr} = \\sum_{s} v_{ps,qs} \\gamma_{ss} $$\nFor this to be non-zero, the set of indices $\\{p,s\\}$ must equal $\\{q,s\\}$, which implies $p=q$. Thus, $f^{p}_{q,\\mathrm{MR}}$ is diagonal. The diagonal elements are:\n$$ f^{p}_{p,\\mathrm{MR}} = \\sum_{s \\neq p} v_{ps,ps} \\gamma_{ss} $$\n(The term $s=p$ is excluded because $v_{pp,pp}=0$ due to antisymmetry).\n$$ f^{1}_{1,\\mathrm{MR}} = v_{12,12}\\gamma_{22} + v_{13,13}\\gamma_{33} = (2.0)(0.6) + (0.8)(0.4) = 1.2 + 0.32 = 1.52 \\, \\text{MeV} $$\n$$ f^{2}_{2,\\mathrm{MR}} = v_{21,21}\\gamma_{11} + v_{23,23}\\gamma_{33} = v_{12,12}\\gamma_{11} + v_{23,23}\\gamma_{33} = (2.0)(1.0) + (1.6)(0.4) = 2.0 + 0.64 = 2.64 \\, \\text{MeV} $$\n$$ f^{3}_{3,\\mathrm{MR}} = v_{31,31}\\gamma_{11} + v_{32,32}\\gamma_{22} = v_{13,13}\\gamma_{11} + v_{23,23}\\gamma_{22} = (0.8)(1.0) + (1.6)(0.6) = 0.8 + 0.96 = 1.76 \\, \\text{MeV} $$\nThe off-diagonal elements $f^{p}_{q,\\mathrm{MR}}$ are all zero for $p \\neq q$.\n\n**3. Two-Body Part $v_{pq,rs,\\mathrm{MR}}$**\nThe non-zero coefficients are identical to the original Hamiltonian:\n$$ v_{12,12,\\mathrm{MR}} = 2.0 \\, \\text{MeV}, \\quad v_{13,13,\\mathrm{MR}} = 0.8 \\, \\text{MeV}, \\quad v_{23,23,\\mathrm{MR}} = 1.6 \\, \\text{MeV} $$\n\n### Single-Reference Calculation\n\nFor the single-reference case, the reference is a Slater determinant with orbitals 1 and 2 occupied. The densities are:\n$\\gamma^{\\mathrm{SR}}_{11} = 1$, $\\gamma^{\\mathrm{SR}}_{22} = 1$, $\\gamma^{\\mathrm{SR}}_{33} = 0$, and $\\lambda^{\\mathrm{SR}}_{ijkl}=0$.\n\nThe zero-body energy $E^{(0)}_{\\mathrm{SR}}$ is the expectation value of $\\hat{V}$ in this Slater determinant. We use the general formula for $E^{(0)}$ with the SR densities.\n$$ \\Gamma^{(2),\\mathrm{SR}}_{12,12} = \\gamma^{\\mathrm{SR}}_{11}\\gamma^{\\mathrm{SR}}_{22} + \\lambda^{\\mathrm{SR}}_{12,12} = (1)(1) + 0 = 1 $$\n$$ \\Gamma^{(2),\\mathrm{SR}}_{13,13} = \\gamma^{\\mathrm{SR}}_{11}\\gamma^{\\mathrm{SR}}_{33} + \\lambda^{\\mathrm{SR}}_{13,13} = (1)(0) + 0 = 0 $$\n$$ \\Gamma^{(2),\\mathrm{SR}}_{23,23} = \\gamma^{\\mathrm{SR}}_{22}\\gamma^{\\mathrm{SR}}_{33} + \\lambda^{\\mathrm{SR}}_{23,23} = (1)(0) + 0 = 0 $$\nSubstituting these into the energy expression:\n$$ E^{(0)}_{\\mathrm{SR}} = v_{12,12} \\Gamma^{(2),\\mathrm{SR}}_{12,12} + v_{13,13} \\Gamma^{(2),\\mathrm{SR}}_{13,13} + v_{23,23} \\Gamma^{(2),\\mathrm{SR}}_{23,23} $$\n$$ E^{(0)}_{\\mathrm{SR}} = (2.0)(1) + (0.8)(0) + (1.6)(0) = 2.0 \\, \\text{MeV} $$\nThis result is expected, as the energy of a Slater determinant for this specific diagonal interaction is the sum over occupied pairs $\\{i,j\\}$ of $v_{ij,ij}$, which here is just $v_{12,12}$.\n\n### Final Difference\n\nFinally, we compute the difference $\\Delta E = E^{(0)}_{\\mathrm{MR}} - E^{(0)}_{\\mathrm{SR}}$:\n$$ \\Delta E = 1.912 \\, \\text{MeV} - 2.0 \\, \\text{MeV} = -0.088 \\, \\text{MeV} $$\nRounding to four significant figures gives $-0.08800$.", "answer": "$$\\boxed{-0.08800}$$", "id": "3571488"}, {"introduction": "This final practice synthesizes the concepts of a correlated reference and a dynamic flow by guiding you through the implementation of a toy MR-IMSRG calculation. You will solve the differential flow equations for a schematic pairing Hamiltonian, a classic model that captures key features of open-shell nuclei [@problem_id:3571475]. This exercise provides a hands-on experience in how the SRG transformation systematically suppresses off-diagonal couplings, which is the central goal of the IMSRG method.", "problem": "You are to implement and analyze a toy flow for the Multi-Reference In-Medium Similarity Renormalization Group (MR-IM-SRG) applied to an open-shell two-level pairing Hamiltonian. Begin from the following foundational elements.\n\n1. Flow equation and truncation. The Similarity Renormalization Group (SRG) flow is defined by the differential equation\n$$\n\\frac{d \\hat{H}(s)}{ds} = [\\hat{\\eta}(s), \\hat{H}(s)],\n$$\nwhere $s$ is the continuous flow parameter, $\\hat{H}(s)$ is the $s$-dependent Hamiltonian, and $\\hat{\\eta}(s)$ is an anti-Hermitian generator. In the In-Medium Similarity Renormalization Group (IM-SRG), operators are normal-ordered with respect to a reference state. In the Multi-Reference (MR) extension, the reference encodes fractional occupation numbers to represent open-shell correlations. In this problem, you will consider a truncation at the normal-ordered two-body level, often denoted MR-IM-SRG(2), and restrict the dynamics to a seniority-zero two-state subspace so that the Hamiltonian reduces to a $2\\times 2$ effective problem in this subspace.\n\n2. Toy two-level pairing Hamiltonian and normal ordering. Consider two single-particle levels with single-particle energies $\\epsilon_1$ and $\\epsilon_2$ (in $\\mathrm{MeV}$), a pairing strength $G$ (in $\\mathrm{MeV}$), and fractional occupation numbers $n_1, n_2 \\in [0,1]$ encoding the multi-reference open-shell state. Adopt the following well-motivated mean-field plus pairing closure to define the initial, normal-ordered $2\\times 2$ Hamiltonian in the pair-subspace as\n$$\n\\hat{H}(0) \\mapsto H(0) = \n\\begin{pmatrix}\ne_1 & v_0 \\\\\nv_0 & e_2\n\\end{pmatrix},\n$$\nwith\n$e_i = 2 \\epsilon_i - G\\, n_i$,\n$\\kappa_i = \\sqrt{n_i(1-n_i)}$,\n$v_0 = -G \\,\\kappa_1 \\kappa_2$.\nThis closure reflects that the diagonal normal-ordered one-body field acquires a contribution linear in the occupation numbers and that the off-diagonal pair-transfer amplitude scales with the anomalous densities $\\kappa_i$. All energies are in $\\mathrm{MeV}$. This definition yields a consistent, self-contained initial value problem in the seniority-zero subspace.\n\n3. Generators. Consider the following two standard SRG generators:\n- Wegner generator: $\\hat{\\eta}_\\mathrm{Wegner}(s) = [H_\\mathrm{d}(s), H_\\mathrm{od}(s)]$, where $H_\\mathrm{d}(s)$ is the diagonal part of $H(s)$ and $H_\\mathrm{od}(s)$ is its off-diagonal part. In the present $2\\times 2$ setting, write $H(s) = \\begin{pmatrix} e_1(s) & v(s) \\\\ v(s) & e_2(s) \\end{pmatrix}$ and split $H(s)=H_\\mathrm{d}(s)+H_\\mathrm{od}(s)$ in the canonical way.\n- White generator: $\\eta_{ij}(s) = H_{ij}(s)/\\Delta_{ij}(s)$ for $i\\neq j$, with $\\Delta_{ij}(s)$ an energy denominator, taken here as the difference of instantaneous diagonal matrix elements, i.e., $\\Delta_{12}(s)=e_1(s)-e_2(s)$. In $2\\times 2$, take $\\eta_{12}(s)=v(s)/\\Delta_{12}(s)$ and $\\eta_{21}(s)=-\\eta_{12}(s)$.\n\n4. Derive the closed $2\\times 2$ flow at MR-IM-SRG(2) level in this subspace. Using only the flow equation $\\frac{dH}{ds}=[\\eta,H]$ and the definitions above, and restricting to the $2\\times 2$ pair-subspace, show that the off-diagonal flow equations become:\n- For the Wegner generator,\n$$\n\\frac{dv}{ds} = -\\Delta^2\\, v,\\quad\n\\frac{de_1}{ds} = 2 v^2 \\Delta,\\quad\n\\frac{de_2}{ds} = -2 v^2 \\Delta,\\quad\n\\Delta \\equiv e_1-e_2.\n$$\n- For the White generator (with the canonical denominator $\\Delta$),\n$$\n\\frac{dv}{ds} = -v,\\quad\n\\frac{de_1}{ds} = \\frac{2 v^2}{\\Delta},\\quad\n\\frac{de_2}{ds} = -\\frac{2 v^2}{\\Delta},\\quad\n\\Delta \\equiv e_1-e_2,\n$$\nwith the convention that when $|\\Delta|$ is numerically negligible, the diagonal flows are set to zero to avoid division by zero. These equations are the exact $2\\times 2$ consequences of the commutator dynamics under the chosen generators and are consistent with MR-IM-SRG(2) truncation in this reduced subspace.\n\n5. Suppression metric. Define the suppression factor of the off-diagonal matrix element as\n$R(s) = |v(s)|/|v(0)|$.\n\n6. Units. All energies $\\epsilon_i, G, e_i, v$ are in $\\mathrm{MeV}$. For the Wegner generator, the flow parameter $s$ carries units of $\\mathrm{MeV}^{-2}$ so that the product $\\Delta^2 s$ is dimensionless. For the White generator, $s$ is dimensionless. The requested output, $R(s)$, is dimensionless.\n\n7. Programming task. Write a complete, runnable program that:\n- Constructs $H(0)$ from $(\\epsilon_1,\\epsilon_2,G,n_1,n_2)$ using the closure in item $2$.\n- Evolves the flow to $s=s_\\mathrm{end}$ using the ordinary differential equations in item $4$ for the specified generator.\n- Returns the suppression $R(s_\\mathrm{end})$ for each test case below.\n\n8. Test suite. Use the following four test cases, each specified as a $7$-tuple $(\\text{generator}, \\epsilon_1, \\epsilon_2, G, n_1, n_2, s_\\mathrm{end})$, where the generator is the string “Wegner” or “White”, all energies are in $\\mathrm{MeV}$, and $s_\\mathrm{end}$ is in $\\mathrm{MeV}^{-2}$ for “Wegner” and dimensionless for “White”:\n- Case A (general, Wegner): $(\\text{\"Wegner\"},\\, 0.0,\\, 1.0,\\, 0.5,\\, 0.7,\\, 0.3,\\, 5.0)$\n- Case B (general, White): $(\\text{\"White\"},\\, 0.0,\\, 1.0,\\, 0.5,\\, 0.7,\\, 0.3,\\, 5.0)$\n- Case C (degenerate, Wegner): $(\\text{\"Wegner\"},\\, 0.0,\\, 0.0,\\, 0.3,\\, 0.5,\\, 0.5,\\, 10.0)$\n- Case D (large $s$, Wegner): $(\\text{\"Wegner\"},\\, 0.0,\\, 2.0,\\, 1.0,\\, 0.6,\\, 0.4,\\, 40.0)$\n\n9. Final output format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For the four cases above, the output must be of the form\n$$\n[\\;R_A, R_B, R_C, R_D\\;],\n$$\nwhere each $R_\\bullet$ is a floating-point number. No additional text should be printed.", "solution": "The user has provided a well-defined problem in computational nuclear physics, asking for the implementation of a simplified Multi-Reference In-Medium Similarity Renormalization Group (MR-IM-SRG) flow for a $2\\times 2$ pairing Hamiltonian. The problem statement is scientifically sound, self-contained, and algorithmically specified. The core task is to solve a system of coupled ordinary differential equations (ODEs) that describe the evolution of the Hamiltonian's matrix elements under two different choices of SRG generator.\n\nFirst, we must validate the problem against the stipulated criteria.\n\n### Problem Validation\n**Step 1: Extract Givens**\n-   SRG flow equation: $\\frac{d \\hat{H}(s)}{ds} = [\\hat{\\eta}(s), \\hat{H}(s)]$.\n-   Model space: A seniority-zero two-state subspace.\n-   Initial Hamiltonian: $H(0) = \\begin{pmatrix} e_1 & v_0 \\\\ v_0 & e_2 \\end{pmatrix}$, with matrix elements defined by the inputs $(\\epsilon_1, \\epsilon_2, G, n_1, n_2)$ as $e_i = 2 \\epsilon_i - G\\, n_i$ and $v_0 = -G \\,\\sqrt{n_1(1-n_1)} \\sqrt{n_2(1-n_2)}$.\n-   Evolving Hamiltonian: $H(s) = \\begin{pmatrix} e_1(s) & v(s) \\\\ v(s) & e_2(s) \\end{pmatrix}$.\n-   Wegner generator: $\\hat{\\eta}_\\mathrm{Wegner}(s) = [H_\\mathrm{d}(s), H_\\mathrm{od}(s)]$.\n-   White generator: A specific form for the $2 \\times 2$ case, with $\\eta_{12}(s) = v(s)/\\Delta_{12}(s)$ where $\\Delta_{12}(s) = e_1(s) - e_2(s)$.\n-   Flow equations (Wegner): $\\frac{dv}{ds} = -\\Delta^2 v$, $\\frac{de_1}{ds} = 2 v^2 \\Delta$, $\\frac{de_2}{ds} = -2 v^2 \\Delta$, with $\\Delta \\equiv e_1-e_2$.\n-   Flow equations (White): $\\frac{dv}{ds} = -v$, $\\frac{de_1}{ds} = \\frac{2 v^2}{\\Delta}$, $\\frac{de_2}{ds} = -\\frac{2 v^2}{\\Delta}$, with a convention to set diagonal flows to zero if $|\\Delta|$ is negligible.\n-   Suppression metric: $R(s) = |v(s)|/|v(0)|$.\n-   Test cases:\n    -   A: $(\\text{\"Wegner\"},\\, 0.0,\\, 1.0,\\, 0.5,\\, 0.7,\\, 0.3,\\, 5.0)$\n    -   B: $(\\text{\"White\"},\\, 0.0,\\, 1.0,\\, 0.5,\\, 0.7,\\, 0.3,\\, 5.0)$\n    -   C: $(\\text{\"Wegner\"},\\, 0.0,\\, 0.0,\\, 0.3,\\, 0.5,\\, 0.5,\\, 10.0)$\n    -   D: $(\\text{\"Wegner\"},\\, 0.0,\\, 2.0,\\, 1.0,\\, 0.6,\\, 0.4,\\, 40.0)$\n-   Units: All energies are in $\\mathrm{MeV}$. $s$ is in $\\mathrm{MeV}^{-2}$ for Wegner and dimensionless for White.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, drawing upon established methods (IM-SRG) and models (pairing Hamiltonian) in theoretical nuclear physics. The provided flow equations are the correct result of the commutator $[\\eta, H]$ for the $2\\times 2$ case for both specified generators. The problem is well-posed; it is a standard initial value problem for a system of ODEs with all necessary parameters and initial conditions supplied. The language is objective and precise. The problem is free from all invalidating flaws listed in the prompt.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid**. A solution will be provided.\n\n### Principle-Based Solution Design\nThe fundamental task is to solve the system of ordinary differential equations (ODEs) that govern the evolution of the Hamiltonian matrix elements $e_1(s)$, $e_2(s)$, and $v(s)$ from an initial flow parameter $s=0$ to a final value $s = s_\\mathrm{end}$.\n\nThe system of three ODEs can be simplified. Note that for both the Wegner and White generators, the flow equations for the diagonal elements satisfy $\\frac{de_1}{ds} + \\frac{de_2}{ds} = 0$. This implies that the sum of the diagonal elements, which is the trace of the Hamiltonian, is a constant of motion: $e_1(s) + e_2(s) = e_1(0) + e_2(0)$. This is a general property of SRG flows, as $\\text{Tr}([\\eta, H]) = 0$.\n\nWe can therefore reduce the problem to a system of two coupled ODEs by tracking the off-diagonal element $v(s)$ and the difference of the diagonal elements, $\\Delta(s) \\equiv e_1(s) - e_2(s)$. The flow equation for $\\Delta(s)$ is derived as $\\frac{d\\Delta}{ds} = \\frac{de_1}{ds} - \\frac{de_2}{ds}$.\n\nThis leads to the following two distinct systems of ODEs:\n\n**1. Wegner Generator:**\nThe system to be solved is:\n$$\n\\begin{cases}\n\\frac{dv}{ds} = -v(s) \\Delta(s)^2 \\\\\n\\frac{d\\Delta}{ds} = 4v(s)^2 \\Delta(s)\n\\end{cases}\n$$\nwith initial conditions $v(0) = v_0$ and $\\Delta(0) = e_1(0) - e_2(0)$. Note that if $\\Delta(0)=0$, then $\\frac{d\\Delta}{ds}|_{s=0}=0$ and $\\frac{dv}{ds}|_{s=0}=0$, which implies that $\\Delta(s)=0$ and $v(s)=v_0$ for all $s$. The flow stalls immediately.\n\n**2. White Generator:**\nThe system to be solved is:\n$$\n\\begin{cases}\n\\frac{dv}{ds} = -v(s) \\\\\n\\frac{d\\Delta}{ds} = \\frac{4v(s)^2}{\\Delta(s)}\n\\end{cases}\n$$\nwith initial conditions $v(0) = v_0$ and $\\Delta(0) = e_1(0) - e_2(0)$. For this generator, the evolution of $v(s)$ is independent of $\\Delta(s)$. The first equation can be solved analytically: $\\int \\frac{dv}{v} = \\int -ds \\implies \\ln(v) = -s + C$. Applying the initial condition $v(0)=v_0$ gives $v(s) = v_0 e^{-s}$. The suppression factor is therefore simply $R(s) = |v(s)|/|v_0| = e^{-s}$. The second equation for $\\Delta(s)$ is only problematic if $\\Delta(s)$ approaches zero. The problem specifies a practical convention: if $|\\Delta|$ is numerically negligible, we set its evolution to zero, i.e., $\\frac{d\\Delta}{ds} = 0$.\n\n**Numerical Implementation:**\nThe general approach is to implement a numerical ODE solver. The `scipy.integrate.solve_ivp` function is well-suited for this purpose, as it provides robust and adaptive algorithms (like RK45) for solving initial value problems.\n\nThe algorithm for each test case is as follows:\n1.  Parse the input parameters $(\\text{generator}, \\epsilon_1, \\epsilon_2, G, n_1, n_2, s_\\mathrm{end})$.\n2.  Calculate the initial Hamiltonian matrix elements at $s=0$: $v_0$, $e_{1,0}$, and $e_{2,0}$. From these, determine the initial state vector for the ODE system, $\\vec{y}(0) = [v(0), \\Delta(0)]^T$.\n3.  If $|v_0|$ is numerically zero, the suppression factor is trivially $1.0$ (as the starting reference is zero), and no evolution occurs. This is a safe edge case to handle, although not encountered in the test suite.\n4.  Define a function that computes the right-hand side of the ODE system, $\\frac{d\\vec{y}}{ds} = f(s, \\vec{y})$, selecting the appropriate equations based on the generator type. This function will include the specified safety check for the White generator when $|\\Delta| \\approx 0$.\n5.  Invoke `scipy.integrate.solve_ivp` to integrate the system from $s=0$ to $s=s_\\mathrm{end}$ using the initial state from step 2.\n6.  Extract the final value of the off-diagonal element, $v(s_\\mathrm{end})$, from the solver's output.\n7.  Compute the final suppression factor $R(s_\\mathrm{end}) = |v(s_\\mathrm{end})| / |v_0|$.\n8.  The results for all test cases are collected and formatted as requested.\n\nThis procedure constitutes a complete and correct method for solving the problem as stated.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to run the MR-IM-SRG flow for the specified test cases.\n    \"\"\"\n\n    # Test suite from the problem statement.\n    # Format: (generator_type, epsilon1, epsilon2, G, n1, n2, s_end)\n    test_cases = [\n        (\"Wegner\", 0.0, 1.0, 0.5, 0.7, 0.3, 5.0),    # Case A\n        (\"White\", 0.0, 1.0, 0.5, 0.7, 0.3, 5.0),     # Case B\n        (\"Wegner\", 0.0, 0.0, 0.3, 0.5, 0.5, 10.0),   # Case C\n        (\"Wegner\", 0.0, 2.0, 1.0, 0.6, 0.4, 40.0)    # Case D\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_srg_flow(case)\n        results.append(result)\n\n    # Format the final output as a comma-separated list in brackets.\n    # The map to str ensures floating point numbers are correctly represented.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_srg_flow(case):\n    \"\"\"\n    Calculates the suppression factor R(s_end) for a single test case.\n    \"\"\"\n    generator, eps1, eps2, G, n1, n2, s_end = case\n    \n    # 1. Calculate initial conditions for H(0)\n    # Check for valid occupation numbers to avoid domain errors with sqrt\n    if not (0.0 <= n1 <= 1.0 and 0.0 <= n2 <= 1.0):\n        raise ValueError(\"Occupation numbers n1 and n2 must be in [0, 1].\")\n\n    kappa1 = np.sqrt(n1 * (1.0 - n1))\n    kappa2 = np.sqrt(n2 * (1.0 - n2))\n    \n    v0 = -G * kappa1 * kappa2\n    e1_0 = 2.0 * eps1 - G * n1\n    e2_0 = 2.0 * eps2 - G * n2\n    Delta0 = e1_0 - e2_0\n\n    # If v0 is numerically zero, the off-diagonal coupling is absent from the start.\n    # The suppression ratio is ill-defined, but we can consider it 1.0\n    # as there is no change from its initial (zero) value.\n    if np.isclose(v0, 0.0):\n        return 1.0\n\n    # 2. Define the system of ODEs\n    # The state vector y is [v, Delta]\n    def ode_system(s, y, gen_type, delta_cutoff=1e-9):\n        v, Delta = y\n        \n        if gen_type == \"Wegner\":\n            dv_ds = -v * Delta**2\n            dDelta_ds = 4.0 * v**2 * Delta\n        elif gen_type == \"White\":\n            dv_ds = -v\n            # Avoid division by zero as per problem statement\n            if abs(Delta) < delta_cutoff:\n                dDelta_ds = 0.0\n            else:\n                dDelta_ds = 4.0 * v**2 / Delta\n        else:\n            raise ValueError(f\"Unknown generator type: {gen_type}\")\n            \n        return [dv_ds, dDelta_ds]\n\n    # Special analytical cases for verification and efficiency\n    # Case C (degenerate Wegner): Delta(0)=0 implies flow stalls.\n    if generator == \"Wegner\" and np.isclose(Delta0, 0.0):\n        return 1.0\n\n    # While Case B (White) has an analytical solution for v(s),\n    # we use the numerical solver for consistency and generality.\n    \n    # 3. Solve the ODE system\n    y0 = [v0, Delta0]\n    sol = solve_ivp(\n        ode_system, \n        (0.0, s_end), \n        y0, \n        args=(generator,),\n        method='RK45', \n        dense_output=False,\n        rtol=1e-8,\n        atol=1e-8\n    )\n    \n    # 4. Extract the final value of v(s)\n    # sol.y contains the solution at different time points, the last column is at s_end\n    v_final = sol.y[0, -1]\n    \n    # 5. Compute the suppression factor R(s_end)\n    R = np.abs(v_final) / np.abs(v0)\n    \n    return R\n\n# Execute the main function\nsolve()\n```", "id": "3571475"}]}