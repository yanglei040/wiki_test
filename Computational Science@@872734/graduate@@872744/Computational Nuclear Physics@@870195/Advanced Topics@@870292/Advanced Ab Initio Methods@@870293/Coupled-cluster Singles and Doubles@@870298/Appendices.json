{"hands_on_practices": [{"introduction": "The complexity of the Coupled-Cluster equations stems from the nested commutators of the Baker-Campbell-Hausdorff expansion. This first exercise [@problem_id:3553610] invites you to unpack this structure by hand, using the powerful tools of normal ordering and Wick's theorem. Understanding the operator ranks that emerge from these commutators is key to grasping the full structure of the CCSD amplitude equations.", "problem": "Consider a closed-shell nuclear reference Slater determinant $|\\Phi\\rangle$ built from orthonormal single-particle orbitals that span an active single-particle basis. Let the nuclear many-body Hamiltonian in second quantization contain up to two-body interactions and be written in an arbitrary operator ordering as\n$$\n\\hat{H} \\equiv \\sum_{pq} t_{pq}\\, a_{p}^{\\dagger} a_{q} \\;+\\; \\frac{1}{4}\\sum_{pqrs} \\bar{v}_{pqrs}\\, a_{p}^{\\dagger} a_{q}^{\\dagger} a_{s} a_{r},\n$$\nwhere $a_{p}^{\\dagger}$ and $a_{q}$ are creation and annihilation operators, $t_{pq}$ are one-body matrix elements, and $\\bar{v}_{pqrs}$ are antisymmetrized two-body matrix elements. Normal ordering with respect to the reference $|\\Phi\\rangle$ is defined via Wick’s theorem relative to the contractions implied by the one-body density matrix of $|\\Phi\\rangle$.\n\nYou will work within Coupled-Cluster Singles and Doubles (CCSD), with the cluster operator truncated at singles and doubles,\n$$\n\\hat{T} \\equiv \\hat{T}_{1} + \\hat{T}_{2}, \\quad \\hat{T}_{1} = \\sum_{ai} t_{i}^{a}\\, a_{a}^{\\dagger} a_{i}, \\quad \\hat{T}_{2} = \\frac{1}{4}\\sum_{abij} t_{ij}^{ab}\\, a_{a}^{\\dagger} a_{b}^{\\dagger} a_{j} a_{i},\n$$\nwhere indices $i,j,\\ldots$ denote orbitals occupied in $|\\Phi\\rangle$ and $a,b,\\ldots$ denote unoccupied (virtual) orbitals.\n\nTasks:\n1. Using Wick’s theorem relative to $|\\Phi\\rangle$ and the definition of normal ordering, justify the decomposition of $\\hat{H}$ into normal-ordered zero-, one-, and two-body parts with respect to $|\\Phi\\rangle$, and explain physically why this normal ordering is advantageous in nuclear many-body calculations that employ CCSD.\n2. Define the particle-rank $r(\\hat{O})$ of a normal-ordered operator $\\hat{O}$ as the number of creation operators (which equals the number of annihilation operators) in any monomial term of $\\hat{O}$. With this definition, and using connected-contraction counting implied by Wick’s theorem, determine the maximum particle-rank generated by the following commutators and double commutators of the one-body part $\\hat{H}_{1}$ and the two-body part $\\hat{H}_{2}$ of the normal-ordered Hamiltonian with $\\hat{T}_{1}$ and $\\hat{T}_{2}$:\n$$\n[\\hat{H}_{1}, \\hat{T}_{1}],\\; [\\hat{H}_{1}, \\hat{T}_{2}],\\; [\\hat{H}_{2}, \\hat{T}_{1}],\\; [\\hat{H}_{2}, \\hat{T}_{2}],\n$$\nand\n$$\n[[\\hat{H}_{1}, \\hat{T}_{1}], \\hat{T}_{1}],\\; [[\\hat{H}_{1}, \\hat{T}_{1}], \\hat{T}_{2}],\\; [[\\hat{H}_{1}, \\hat{T}_{2}], \\hat{T}_{1}],\\; [[\\hat{H}_{1}, \\hat{T}_{2}], \\hat{T}_{2}],\n$$\n$$\n[[\\hat{H}_{2}, \\hat{T}_{1}], \\hat{T}_{1}],\\; [[\\hat{H}_{2}, \\hat{T}_{1}], \\hat{T}_{2}],\\; [[\\hat{H}_{2}, \\hat{T}_{2}], \\hat{T}_{1}],\\; [[\\hat{H}_{2}, \\hat{T}_{2}], \\hat{T}_{2}].\n$$\nPresent your final answer as a single row matrix whose $12$ entries are the maximum particle-ranks for the above commutators in the exact order they are listed. No units are required. The answer must be a calculation yielding integers only, and no rounding is needed.", "solution": "This problem consists of two tasks related to the Coupled-Cluster Singles and Doubles (CCSD) formalism in nuclear many-body theory. The first task is to justify the normal ordering of the Hamiltonian and explain its utility. The second task is to determine the maximum particle-rank of a series of commutators involving components of the normal-ordered Hamiltonian and the cluster operator.\n\n**Task 1: Normal-Ordered Hamiltonian and its Advantage in CCSD**\n\nThe nuclear many-body Hamiltonian is initially given in an arbitrary operator ordering:\n$$\n\\hat{H} \\equiv \\sum_{pq} t_{pq}\\, a_{p}^{\\dagger} a_{q} \\;+\\; \\frac{1}{4}\\sum_{pqrs} \\bar{v}_{pqrs}\\, a_{p}^{\\dagger} a_{q}^{\\dagger} a_{s} a_{r}\n$$\nwhere $p,q,r,s$ span a complete orthonormal single-particle basis. Normal ordering with respect to a reference Slater determinant $|\\Phi\\rangle$ is a procedure to rewrite any product of creation and annihilation operators as a sum of terms, where each term is a c-number (a scalar) times a normal-ordered product of operators. A product of operators is in normal order, denoted by $\\{\\ldots\\}$, if all creation operators are placed to the left of all annihilation operators.\n\nThis rewriting is achieved through the generalized Wick's theorem, which states that any string of operators is equal to its normal-ordered product plus the sum over all possible single, double, and higher-order contractions. A contraction of two operators is their expectation value in the reference state, which is a c-number. For a Slater determinant reference $|\\Phi\\rangle$ composed of occupied orbitals (indices $i,j,\\dots$), the only non-zero elementary contraction is:\n$$\n\\overline{a_{p}^{\\dagger} a_{q}} = \\langle \\Phi | a_{p}^{\\dagger} a_{q} | \\Phi \\rangle = \\rho_{qp}\n$$\nwhere $\\rho_{qp}$ is an element of the one-body density matrix of the reference state. $\\rho_{qp} = \\delta_{qp}$ if $p, q$ are both occupied orbitals, and $0$ otherwise.\n\nApplying Wick's theorem to $\\hat{H}$ systematically decomposes it into its normal-ordered components:\n$1$. **One-body term:**\n$$\na_{p}^{\\dagger} a_{q} = \\{a_{p}^{\\dagger} a_{q}\\} + \\overline{a_{p}^{\\dagger} a_{q}} = \\{a_{p}^{\\dagger} a_{q}\\} + \\rho_{qp}\n$$\nSumming over $p, q$ gives:\n$$\n\\sum_{pq} t_{pq} a_{p}^{\\dagger} a_{q} = \\sum_{pq} t_{pq} \\{a_{p}^{\\dagger} a_{q}\\} + \\sum_{pq} t_{pq} \\rho_{qp} = \\sum_{pq} t_{pq} \\{a_{p}^{\\dagger} a_{q}\\} + \\sum_{i} t_{ii}\n$$\nThe first term is a normal-ordered one-body operator. The second term, $\\sum_{i} t_{ii}$, is a scalar (a zero-body operator).\n\n$2$. **Two-body term:**\nThe product $a_{p}^{\\dagger} a_{q}^{\\dagger} a_{s} a_{r}$ is decomposed as follows:\n$$\na_{p}^{\\dagger} a_{q}^{\\dagger} a_{s} a_{r} = \\{a_{p}^{\\dagger} a_{q}^{\\dagger} a_{s} a_{r}\\} + \\sum_{\\text{1-contractions}} + \\sum_{\\text{2-contractions}}\n$$\nThe one-contraction terms, after summing over all indices, yield a normal-ordered one-body operator. For example, a term like $\\overline{a_p^\\dagger a_r} \\{a_q^\\dagger a_s\\} = \\rho_{rp} \\{a_q^\\dagger a_s\\}$ contributes to the one-body part. The two-contraction terms yield a scalar. For example, $(\\overline{a_p^\\dagger a_r}\\overline{a_q^\\dagger a_s} - \\overline{a_p^\\dagger a_s}\\overline{a_q^\\dagger a_r}) = (\\rho_{rp}\\rho_{sq} - \\rho_{sp}\\rho_{rq})$ contributes to the zero-body part.\n\nCollecting all terms with the same number of uncontracted operators (i.e., the same particle-rank), the Hamiltonian can be written in normal-ordered form:\n$$\n\\hat{H} = H_{0} + \\hat{H}_{1} + \\hat{H}_{2}\n$$\nwhere:\n- $H_{0} = \\langle \\Phi | \\hat{H} | \\Phi \\rangle$ is the scalar reference energy (zero-body part).\n- $\\hat{H}_{1} = \\sum_{pq} f_{pq} \\{a_{p}^{\\dagger} a_{q}\\}$ is the normal-ordered one-body part, where $f_{pq}$ are the Fock matrix elements incorporating contributions from both $t_{pq}$ and contractions from $\\bar{v}_{pqrs}$.\n- $\\hat{H}_{2} = \\frac{1}{4} \\sum_{pqrs} \\bar{v}_{pqrs} \\{a_{p}^{\\dagger} a_{q}^{\\dagger} a_{s} a_{r}\\}$ is the normal-ordered two-body part (since $\\bar{v}$ is antisymmetrized, contractions within it do not survive).\n\nThe **physical advantage** of this normal ordering in CCSD calculations is profound:\nFirst, it separates the total energy into the reference energy $H_0$ and the correlation energy. The problem reduces to finding the correlation energy from the normal-ordered Hamiltonian $\\hat{H}_N = \\hat{H}_1 + \\hat{H}_2$.\nSecond, and most importantly, the reference state $|\\Phi\\rangle$ acts as a true vacuum for normal-ordered operators, meaning the expectation value of any non-scalar normal-ordered operator with respect to $|\\Phi\\rangle$ is zero. For example, $\\langle \\Phi | \\{a_{p}^{\\dagger} a_{q}\\} | \\Phi \\rangle = 0$. The cluster operators $\\hat{T}_1$ and $\\hat{T}_2$ are themselves defined as normal-ordered particle-hole excitation operators. This property drastically simplifies the coupled-cluster equations. The core CC energy and amplitude equations are derived from projections of the similarity-transformed Hamiltonian $\\bar{H} = e^{-\\hat{T}} \\hat{H} e^{\\hat{T}}$:\n$$\nE_{\\text{corr}} = \\langle \\Phi | \\bar{H}_N | \\Phi \\rangle = \\langle \\Phi | (\\hat{H}_N e^{\\hat{T}})_C | \\Phi \\rangle\n$$\n$$\n0 = \\langle \\Phi_{\\mu} | \\bar{H}_N | \\Phi \\rangle = \\langle \\Phi_{\\mu} | (\\hat{H}_N e^{\\hat{T}})_C | \\Phi \\rangle\n$$\nwhere $|\\Phi_{\\mu}\\rangle$ are excited determinants and the subscript $C$ indicates that only connected diagrams (terms) contribute. The use of normal ordering is what ensures the linked-diagram theorem holds, leading to the connected-only expansion. Evaluating the matrix elements on the right-hand side using Wick's theorem is greatly simplified because any term that is not fully contracted (i.e., results in a scalar) vanishes, dramatically reducing the number of terms to compute and ensuring size-extensivity.\n\n**Task 2: Maximum Particle-Rank of Commutators**\n\nThe particle-rank $r(\\hat{O})$ of a normal-ordered operator $\\hat{O}$ is the number of creation operators it contains. The operators involved have the following ranks:\n- $\\hat{H}_{1}$: A one-body operator, $r(\\hat{H}_{1}) = 1$.\n- $\\hat{H}_{2}$: A two-body operator, $r(\\hat{H}_{2}) = 2$.\n- $\\hat{T}_{1}$: A one-particle-one-hole ($1p1h$) excitation operator, $r(\\hat{T}_{1}) = 1$.\n- $\\hat{T}_{2}$: A two-particle-two-hole ($2p2h$) excitation operator, $r(\\hat{T}_{2}) = 2$.\n\nThe commutator of two normal-ordered operators $\\hat{A}$ and $\\hat{B}$ can be evaluated using Wick's theorem. The product $\\hat{A}\\hat{B}$ is a sum of the normal-ordered product $\\{\\hat{A}\\hat{B}\\}$ and terms with one or more contractions between operators from $\\hat{A}$ and $\\hat{B}$. Since $\\{\\hat{A}\\hat{B}\\} = \\{\\hat{B}\\hat{A}\\}$ (as both operators have an even number of fermions), these parts cancel in the commutator $[\\hat{A}, \\hat{B}] = \\hat{A}\\hat{B} - \\hat{B}\\hat{A}$. The result is a sum of terms originating from at least one contraction.\n\nA single contraction reduces the total number of creation operators by one and annihilation operators by one, thus reducing the particle-rank by one. The maximum possible rank of the resulting operator corresponds to making the minimum number of connections required for a non-zero result. For \"connected-contraction counting\" as specified:\n- The maximum particle-rank of a single commutator $[\\hat{A}, \\hat{B}]$ is generated by terms with one contraction. Its rank is $r([\\hat{A}, \\hat{B}])_{\\text{max}} = r(\\hat{A}) + r(\\hat{B}) - 1$.\n- The maximum particle-rank of a double commutator $[[\\hat{A}, \\hat{B}], \\hat{C}]$ is generated by terms where all three operators are connected, which requires at least two contractions. Its rank is $r([[\\hat{A}, \\hat{B}], \\hat{C}])_{\\text{max}} = r(\\hat{A}) + r(\\hat{B}) + r(\\hat{C}) - 2$.\n\nUsing these rules, we calculate the maximum particle-rank for each specified commutator.\n\n**Single Commutators:**\n$1$. $[\\hat{H}_{1}, \\hat{T}_{1}]$: $r(\\hat{H}_{1}) + r(\\hat{T}_{1}) - 1 = 1 + 1 - 1 = 1$.\n$2$. $[\\hat{H}_{1}, \\hat{T}_{2}]$: $r(\\hat{H}_{1}) + r(\\hat{T}_{2}) - 1 = 1 + 2 - 1 = 2$.\n$3$. $[\\hat{H}_{2}, \\hat{T}_{1}]$: $r(\\hat{H}_{2}) + r(\\hat{T}_{1}) - 1 = 2 + 1 - 1 = 2$.\n$4$. $[\\hat{H}_{2}, \\hat{T}_{2}]$: $r(\\hat{H}_{2}) + r(\\hat{T}_{2}) - 1 = 2 + 2 - 1 = 3$.\n\n**Double Commutators:**\n$5$. $[[\\hat{H}_{1}, \\hat{T}_{1}], \\hat{T}_{1}]$: $r(\\hat{H}_{1}) + r(\\hat{T}_{1}) + r(\\hat{T}_{1}) - 2 = 1 + 1 + 1 - 2 = 1$.\n$6$. $[[\\hat{H}_{1}, \\hat{T}_{1}], \\hat{T}_{2}]$: $r(\\hat{H}_{1}) + r(\\hat{T}_{1}) + r(\\hat{T}_{2}) - 2 = 1 + 1 + 2 - 2 = 2$.\n$7$. $[[\\hat{H}_{1}, \\hat{T}_{2}], \\hat{T}_{1}]$: $r(\\hat{H}_{1}) + r(\\hat{T}_{2}) + r(\\hat{T}_{1}) - 2 = 1 + 2 + 1 - 2 = 2$.\n$8$. $[[\\hat{H}_{1}, \\hat{T}_{2}], \\hat{T}_{2}]$: $r(\\hat{H}_{1}) + r(\\hat{T}_{2}) + r(\\hat{T}_{2}) - 2 = 1 + 2 + 2 - 2 = 3$.\n$9$. $[[\\hat{H}_{2}, \\hat{T}_{1}], \\hat{T}_{1}]$: $r(\\hat{H}_{2}) + r(\\hat{T}_{1}) + r(\\hat{T}_{1}) - 2 = 2 + 1 + 1 - 2 = 2$.\n$10$. $[[\\hat{H}_{2}, \\hat{T}_{1}], \\hat{T}_{2}]$: $r(\\hat{H}_{2}) + r(\\hat{T}_{1}) + r(\\hat{T}_{2}) - 2 = 2 + 1 + 2 - 2 = 3$.\n$11$. $[[\\hat{H}_{2}, \\hat{T}_{2}], \\hat{T}_{1}]$: $r(\\hat{H}_{2}) + r(\\hat{T}_{2}) + r(\\hat{T}_{1}) - 2 = 2 + 2 + 1 - 2 = 3$.\n$12$. $[[\\hat{H}_{2}, \\hat{T}_{2}], \\hat{T}_{2}]$: $r(\\hat{H}_{2}) + r(\\hat{T}_{2}) + r(\\hat{T}_{2}) - 2 = 2 + 2 + 2 - 2 = 4$.\n\nThe sequence of maximum particle-ranks for the $12$ commutators is $\\{1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4\\}$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 & 2 & 2 & 3 & 1 & 2 & 2 & 3 & 2 & 3 & 3 & 4\n\\end{pmatrix}\n}\n$$", "id": "3553610"}, {"introduction": "A direct, 'naive' implementation of the CCSD equations would have a computational cost that scales poorly with system size, rendering it impractical for most nuclei. This practice [@problem_id:3553631] introduces the crucial concept of 'intermediates,' which are pre-computed quantities that dramatically reduce the scaling of the most intensive steps. By constructing one such intermediate and analyzing its effect on the computational scaling, you will gain insight into the algorithmic engineering that makes modern CC calculations feasible.", "problem": "Consider a closed-shell atomic nucleus described in a single-particle basis obtained from a self-consistent mean-field calculation. The many-body Hamiltonian is normal-ordered with respect to the mean-field Slater determinant reference state and contains one-body and antisymmetrized two-body parts. Let the antisymmetrized two-body matrix elements be denoted by $\\langle pq||rs\\rangle$, where $p,q,r,s$ label general single-particle states. In a Coupled-Cluster method truncated at single and double excitations (Coupled-Cluster Singles and Doubles, CCSD), the cluster operator is $T=T_{1}+T_{2}$ with $T_{1}=\\sum_{i,a}t_{i}^{a}a_{a}^{\\dagger}a_{i}$ and $T_{2}=\\frac{1}{4}\\sum_{i,j,a,b}t_{ij}^{ab}a_{a}^{\\dagger}a_{b}^{\\dagger}a_{j}a_{i}$, where indices $i,j,k,\\dots$ denote occupied states and $a,b,c,\\dots$ denote unoccupied states in the reference.\n\nThe similarity-transformed Hamiltonian is $\\bar{H}=\\exp(-T)H\\exp(T)$, and the doubles residual $R_{ij}^{ab}$ is obtained by projecting $\\bar{H}$ onto the doubly excited determinants, $R_{ij}^{ab}=\\langle \\Phi_{ij}^{ab}|\\bar{H}|\\Phi_{0}\\rangle$, where $|\\Phi_{0}\\rangle$ is the reference and $|\\Phi_{ij}^{ab}\\rangle=a_{a}^{\\dagger}a_{b}^{\\dagger}a_{j}a_{i}|\\Phi_{0}\\rangle$.\n\n- Task 1: Starting from the formal Baker–Campbell–Hausdorff expansion for $\\bar{H}$ and the CCSD truncation, construct a standard two-body “dressed interaction” intermediate $W_{ij}^{ab}$ by collecting all contributions to the doubles residual that are formed by a single contraction of the antisymmetrized two-body interaction $\\langle pq||rs\\rangle$ with the singles amplitudes $t_{i}^{a}$. Write $W_{ij}^{ab}$ explicitly up to and including linear order in the singles amplitudes $t_{i}^{a}$, using permutation antisymmetrizers $P(ij)$ and $P(ab)$ where needed to enforce antisymmetry in occupied and unoccupied index pairs.\n\n- Task 2: Using the intermediate $W_{ij}^{ab}$ from Task 1, rewrite the part of the doubles residual $R_{ij}^{ab}$ that contains these linear-in-singles two-body contributions solely in terms of $W_{ij}^{ab}$, without any explicit inner summations over occupied or unoccupied indices in the residual expression.\n\n- Task 3: Let $n_{o}$ be the number of occupied single-particle states and $n_{v}$ the number of unoccupied single-particle states. By counting index loops, determine the leading-order computational scaling, in big-$\\mathcal{O}$ notation, to assemble this linear-in-singles two-body contribution to $R_{ij}^{ab}$ over all $\\{i,j,a,b\\}$ in two ways: (i) when evaluated naively by performing the inner sums for each quadruple $(i,j,a,b)$ directly in $R_{ij}^{ab}$, and (ii) when evaluated using your precomputed $W_{ij}^{ab}$ from Task 1. Provide the reduced scaling from case (ii) as your final answer.\n\nExpress your final scaling in big-$\\mathcal{O}$ notation as a single analytic expression. No numerical evaluation is required.", "solution": "This problem requires the derivation and analysis of specific terms within the Coupled-Cluster Singles and Doubles (CCSD) amplitude equations. The tasks involve algebraic manipulation using second quantization, diagrammatic concepts, and an analysis of computational complexity.\n\n### Problem Validation\nThe problem statement is scientifically grounded, well-posed, and objective. It is based on standard, non-controversial Coupled-Cluster theory, a fundamental method in computational quantum physics and chemistry. All variables, operators, and objectives are defined using standard nomenclature of the field. The tasks are specific and lead to a unique, verifiable solution. The problem is deemed **valid**.\n\n### Task 1: Construction of the Intermediate $W_{ij}^{ab}$\n\nThe doubles residual $R_{ij}^{ab}$ is given by $R_{ij}^{ab} = \\langle \\Phi_{ij}^{ab} | \\bar{H} | \\Phi_0 \\rangle$, where $\\bar{H} = \\exp(-T)H\\exp(T)$ and $|\\Phi_0\\rangle$ is the reference Slater determinant. The requested contributions to $R_{ij}^{ab}$ are those linear in the singles amplitudes $t_k^c$ and involving the two-body interaction part of the Hamiltonian, $V_N$. These terms arise from the single commutator of $V_N$ with the singles cluster operator $T_1$ in the Baker-Campbell-Hausdorff (BCH) expansion of $\\bar{H}$:\n$$\n\\bar{H} = H + [H, T] + \\frac{1}{2}[[H, T], T] + \\dots\n$$\nThe relevant part of $\\bar{H}$ containing terms linear in $T_1$ and involving $V_N$ is $[V_N, T_1]$. Thus, the contribution to the residual is $\\langle \\Phi_{ij}^{ab} | [V_N, T_1] | \\Phi_0 \\rangle$.\n\nSince $V_N$ is a number-conserving two-body operator (in its normal-ordered form, it can change up to two particles and two holes), $V_N|\\Phi_0\\rangle$ contains at most doubly-excited determinants. The operator $T_1 = \\sum_{k,c} t_k^c a_c^\\dagger a_k$ is a de-excitation operator when acting to the left. Therefore, the term $\\langle \\Phi_{ij}^{ab} | T_1 V_N | \\Phi_0 \\rangle$ vanishes, as $T_1$ cannot de-excite a state with at most two excitations into a specific four-excitation state (relative to the state annihilated by $\\langle \\Phi_{ij}^{ab} |$).\n\nWe are left with evaluating $\\langle \\Phi_{ij}^{ab} | V_N T_1 | \\Phi_0 \\rangle$.\n$$\n\\langle \\Phi_{ij}^{ab} | V_N T_1 | \\Phi_0 \\rangle = \\sum_{k,c} t_k^c \\langle \\Phi_{ij}^{ab} | V_N | \\Phi_k^c \\rangle\n$$\nwhere $|\\Phi_k^c \\rangle = a_c^\\dagger a_k |\\Phi_0\\rangle$. Evaluating the matrix element $\\langle \\Phi_{ij}^{ab} | V_N | \\Phi_k^c \\rangle$ using Wick's theorem or diagrammatic techniques yields four types of non-zero contributions, which correspond to connecting the external lines $\\{i, j, a, b\\}$ with the lines $\\{k, c\\}$ through the two-body interaction vertex $V_N$. These are standard terms in the CCSD doubles amplitude equations:\n\n1.  A contribution from the $V_{hvvv}$ part of the interaction (one hole, three particles): $\\sum_c t_i^c \\langle cj || ab \\rangle$. After antisymmetrizing with respect to the occupied indices $i$ and $j$, this gives $P(ij) \\sum_c t_i^c \\langle cj || ab \\rangle = \\sum_c t_i^c \\langle cj || ab \\rangle - \\sum_c t_j^c \\langle ci || ab \\rangle$.\n2.  A contribution from the $V_{ohho}$ part of the interaction (one particle, three holes): $-\\sum_k t_k^a \\langle ik || jb \\rangle$. After antisymmetrizing with respect to the unoccupied indices $a$ and $b$, this gives $-P(ab) \\sum_k t_k^a \\langle ik || jb \\rangle = - \\sum_k t_k^a \\langle ik || jb \\rangle + \\sum_k t_k^b \\langle ik || ja \\rangle$.\n\nThe permutation operator $P(pq)$ is defined as $P(pq)f(p,q) = f(p,q) - f(q,p)$.\n\nThe \"dressed interaction\" intermediate $W_{ij}^{ab}$ is formed by collecting all these contributions:\n$$\nW_{ij}^{ab} = P(ij) \\sum_c t_i^c \\langle cj || ab \\rangle - P(ab) \\sum_k t_k^a \\langle ik || jb \\rangle\n$$\nExpanding the permutation operators yields the four distinct terms:\n$$\nW_{ij}^{ab} = \\left( \\sum_c t_i^c \\langle cj || ab \\rangle - \\sum_c t_j^c \\langle ci || ab \\rangle \\right) - \\left( \\sum_k t_k^a \\langle ik || jb \\rangle - \\sum_k t_k^b \\langle ik || ja \\rangle \\right)\n$$\n\n### Task 2: Rewriting the Residual Contribution\n\nTask 1 defined the intermediate $W_{ij}^{ab}$ as the collection of all linear-in-$T_1$ two-body contributions to the doubles residual. Task 2 asks to express this part of the residual, which we denote $\\Delta R_{ij}^{ab}(V, T_1)$, in terms of $W_{ij}^{ab}$. Based on the construction in Task 1, this is a direct substitution. The expression for $W_{ij}^{ab}$ already contains the inner summations over the hole index $k$ and the particle index $c$. By pre-computing the entire $W_{ij}^{ab}$ tensor, its contribution to the full residual $R_{ij}^{ab}$ is simply an addition.\n$$\n\\Delta R_{ij}^{ab}(V, T_1) = W_{ij}^{ab}\n$$\nThis formulation fulfills the requirement that the residual expression itself contains no explicit inner summations, as those are subsumed into the definition and computation of the intermediate $W_{ij}^{ab}$.\n\n### Task 3: Computational Scaling Analysis\n\nLet $n_o$ be the number of occupied states and $n_v$ be the number of unoccupied states. The computational scaling is estimated by counting the number of floating-point operations, which is determined by the number of nested loops in a direct implementation.\n\n**(i) Naive Evaluation:**\nIn a naive evaluation, the contribution to each specific residual element $R_{ij}^{ab}$ is calculated directly by performing the summations over $k$ and $c$ for each of the $n_o^2 n_v^2$ quadruples $(i,j,a,b)$.\n\n*   Consider the term $\\sum_c t_i^c \\langle cj || ab \\rangle$: For each $(i,j,a,b)$, this requires a sum over $n_v$ elements. The total cost for this type of term (including the permuted part) across all residuals is proportional to $n_o^2 \\times n_v^2 \\times n_v = n_o^2 n_v^3$.\n*   Consider the term $\\sum_k t_k^a \\langle ik || jb \\rangle$: For each $(i,j,a,b)$, this requires a sum over $n_o$ elements. The total cost for this type of term (including the permuted part) across all residuals is proportional to $n_o^2 \\times n_v^2 \\times n_o = n_o^3 n_v^2$.\n\nThe total scaling for the naive evaluation is the sum of these costs, dominated by the most expensive step:\n$$\n\\mathcal{O}_{\\text{naive}} = \\mathcal{O}(n_o^2 n_v^3 + n_o^3 n_v^2)\n$$\n\n**(ii) Evaluation using the precomputed intermediate $W_{ij}^{ab}$:**\nThis approach implies a two-stage process. First, the entire tensor $W_{ij}^{ab}$ is computed and stored. Second, this precomputed tensor is used to update the full residual tensor $R_{ij}^{ab}$.\n\n1.  **Computation of $W_{ij}^{ab}$:** The cost to compute all elements of the $W_{ij}^{ab}$ tensor is identical to the naive evaluation cost, as it involves the exact same summations: $\\mathcal{O}(n_o^2 n_v^3 + n_o^3 n_v^2)$.\n2.  **Use of $W_{ij}^{ab}$:** Once $W_{ij}^{ab}$ is fully computed, \"evaluating\" the contribution to the residual simply means adding the elements of $W_{ij}^{ab}$ to the corresponding elements of $R_{ij}^{ab}$. This is a tensor addition: $R \\leftarrow R + W$. This operation requires looping over all four indices $i, j, a, b$ once with no inner summations.\n\nThe cost of this second step is determined by the size of the tensor, which is $n_o^2 n_v^2$.\n\nThe question asks for the \"reduced scaling from case (ii)\". This phrasing is interpreted as asking for the scaling of the part of the algorithm that is simplified by having precomputed the intermediate. While the overall process cost is dominated by the computation of $W_{ij}^{ab}$, the step of *using* the precomputed intermediate to assemble the final residual has a scaling that is reduced compared to the naive, all-in-one evaluation. This reduced scaling corresponds to the cost of the final tensor addition.\n\nThe reduced scaling for assembling the residual from the precomputed intermediate is:\n$$\n\\mathcal{O}_{\\text{reduced}} = \\mathcal{O}(n_o^2 n_v^2)\n$$\nThis is the scaling for the final update step, which is significantly lower than the scaling of the direct, un-factorized evaluation of the contribution for each residual element.", "answer": "$$\n\\boxed{\\mathcal{O}(n_o^2 n_v^2)}\n$$", "id": "3553631"}, {"introduction": "The ultimate test of a nuclear structure theory is its ability to predict or reproduce experimental data. This final exercise [@problem_id:3553638] bridges the gap between a completed CCSD calculation and a fundamental observable: the nuclear charge radius. You will learn how to use the calculated one-body density matrix, along with essential physical corrections for the center-of-mass motion and relativistic effects, to compute a value that can be directly compared with experimental measurements.", "problem": "You are given a formulation task firmly rooted in many-body theory for nuclear structure as applied to coupled-cluster singles and doubles (CCSD). Starting only from fundamental definitions and well-tested formulas, design and implement an algorithm that computes the nuclear charge radius from CCSD one-body proton densities in a harmonic-oscillator single-particle basis. Your program must output the charge radius in femtometers (fm) for a small set of test cases.\n\nBegin from the following fundamental base.\n\n- The mean-square charge radius is defined as the ground-state expectation value of the intrinsic charge-density operator. For a nucleus with proton number $Z$, neutron number $N$, and mass number $A = Z + N$, the mean-square charge radius is\n$$\nr_{\\mathrm{ch}}^2 \\equiv \\frac{1}{Z}\\sum_{i \\in p} \\left\\langle \\left(\\mathbf{r}_i - \\mathbf{R}_{\\mathrm{cm}}\\right)^2 \\right\\rangle + \\Delta_{\\mathrm{em}},\n$$\nwhere $\\mathbf{R}_{\\mathrm{cm}}$ is the center-of-mass coordinate operator for all $A$ nucleons, and $\\Delta_{\\mathrm{em}}$ collects electromagnetic and relativistic effective-operator contributions.\n\n- In coupled-cluster singles and doubles (CCSD), the expectation value of a one-body operator $\\hat{O}$ is given by the trace of the product of the CCSD one-body density matrix $\\gamma$ with the one-body matrix representation $O$ of the operator in the chosen single-particle basis,\n$$\n\\langle \\hat{O} \\rangle = \\mathrm{Tr}\\left(\\gamma \\, O\\right).\n$$\nFor the point-proton mean-square radius in the laboratory frame this gives\n$$\nr_{pp,\\mathrm{lab}}^2 = \\frac{1}{Z}\\mathrm{Tr}\\left(\\gamma^{(p)} \\, R^2\\right),\n$$\nwhere $\\gamma^{(p)}$ is the proton-sector CCSD one-body density matrix and $R^2$ is the one-body matrix of the operator $\\hat{r}^{\\,2}$ in the basis.\n\n- In a harmonic-oscillator basis with oscillator length $b$, assuming ground-state factorization into an intrinsic part and a $0s$ center-of-mass part, the expectation value of the center-of-mass mean-square radius is\n$$\n\\left\\langle R_{\\mathrm{cm}}^2 \\right\\rangle = \\frac{3 b^2}{2 A}.\n$$\nUse this to obtain the intrinsic point-proton mean-square radius $r_{pp}^2$ from $r_{pp,\\mathrm{lab}}^2$.\n\n- The electromagnetic and relativistic corrections required are the leading finite-size proton correction $R_p^2$, the neutron mean-square charge radius $R_n^2$ entering with the factor $N/Z$, the Darwin–Foldy term $r_{\\mathrm{DF}}^2$, and a spin–orbit correction $r_{\\mathrm{SO}}^2$. These corrections define\n$$\n\\Delta_{\\mathrm{em}} = R_p^2 + \\frac{N}{Z} R_n^2 + r_{\\mathrm{DF}}^2 + r_{\\mathrm{SO}}^2.\n$$\n\nYour task is to compute the charge radius $r_{\\mathrm{ch}}$ in femtometers for each of the following test cases, using the above physically justified starting points and no other assumptions. In all cases, the one-body density matrix $\\gamma^{(p)}$ is Hermitian and its trace equals $Z$. The one-body operator matrix $R^2$ is real symmetric, with entries in $\\mathrm{fm}^2$. The harmonic-oscillator length $b$ is given in $\\mathrm{fm}$, and $R_p^2$, $R_n^2$, $r_{\\mathrm{DF}}^2$, and $r_{\\mathrm{SO}}^2$ are in $\\mathrm{fm}^2$. The final answer for each case must be the charge radius $r_{\\mathrm{ch}}$ in $\\mathrm{fm}$, rounded to $6$ decimal places.\n\nTest suite to implement:\n\n- Case $1$:\n  - $A = 16$, $Z = 8$, $N = 8$, $b = 1.76$.\n  - $\\gamma^{(p)} = \\begin{bmatrix} 6.8 & 0.1 \\\\ 0.1 & 1.2 \\end{bmatrix}$.\n  - $R^2 = \\begin{bmatrix} 5.0 & 0.2 \\\\ 0.2 & 7.0 \\end{bmatrix}$.\n  - $R_p^2 = 0.770$, $R_n^2 = -0.1161$, $r_{\\mathrm{DF}}^2 = 0.033$, $r_{\\mathrm{SO}}^2 = -0.080$.\n\n- Case $2$:\n  - $A = 40$, $Z = 20$, $N = 20$, $b = 1.97$.\n  - $\\gamma^{(p)} = \\begin{bmatrix} 10.0 & 0.2 & 0.0 \\\\ 0.2 & 8.5 & 0.1 \\\\ 0.0 & 0.1 & 1.5 \\end{bmatrix}$.\n  - $R^2 = \\begin{bmatrix} 5.5 & 0.1 & 0.0 \\\\ 0.1 & 8.0 & 0.2 \\\\ 0.0 & 0.2 & 10.5 \\end{bmatrix}$.\n  - $R_p^2 = 0.770$, $R_n^2 = -0.1161$, $r_{\\mathrm{DF}}^2 = 0.033$, $r_{\\mathrm{SO}}^2 = -0.050$.\n\n- Case $3$:\n  - $A = 4$, $Z = 2$, $N = 2$, $b = 1.40$.\n  - $\\gamma^{(p)} = \\begin{bmatrix} 2.0 \\end{bmatrix}$.\n  - $R^2 = \\begin{bmatrix} 2.94 \\end{bmatrix}$.\n  - $R_p^2 = 0.770$, $R_n^2 = -0.1161$, $r_{\\mathrm{DF}}^2 = 0.033$, $r_{\\mathrm{SO}}^2 = 0.000$.\n\n- Case $4$:\n  - $A = 48$, $Z = 20$, $N = 28$, $b = 2.00$.\n  - $\\gamma^{(p)} = \\begin{bmatrix} 15.5 & -0.3 \\\\ -0.3 & 4.5 \\end{bmatrix}$.\n  - $R^2 = \\begin{bmatrix} 5.6 & 0.15 \\\\ 0.15 & 9.5 \\end{bmatrix}$.\n  - $R_p^2 = 0.770$, $R_n^2 = -0.1161$, $r_{\\mathrm{DF}}^2 = 0.033$, $r_{\\mathrm{SO}}^2 = -0.060$.\n\nImplementation and output requirements:\n\n- Compute, for each case, the charge radius $r_{\\mathrm{ch}}$ in $\\mathrm{fm}$ implied by the base definitions above. Use only the given data and standard linear-algebra operations.\n- Your program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[x_1,x_2,x_3,x_4]$, where each $x_i$ is the charge radius for case $i$ in $\\mathrm{fm}$, rounded to $6$ decimal places.", "solution": "The problem is valid as it is scientifically grounded in the principles of nuclear many-body theory, specifically coupled-cluster theory, and provides a well-posed, objective, and complete set of data and definitions for the calculation of the nuclear charge radius. All provided equations and constants are standard within the field of computational nuclear physics.\n\nThe objective is to compute the nuclear charge radius, $r_{\\mathrm{ch}}$, for several test cases. The calculation proceeds by determining the mean-square charge radius, $r_{\\mathrm{ch}}^2$, from which $r_{\\mathrm{ch}}$ is found by taking the square root.\n\nThe mean-square charge radius is defined as the sum of the intrinsic point-proton mean-square radius, denoted here as $r_{pp}^2$, and a collection of electromagnetic and relativistic corrections, $\\Delta_{\\mathrm{em}}$:\n$$\nr_{\\mathrm{ch}}^2 = r_{pp}^2 + \\Delta_{\\mathrm{em}}\n$$\nwhere $r_{pp}^2 = \\frac{1}{Z}\\sum_{i \\in p} \\left\\langle \\left(\\mathbf{r}_i - \\mathbf{R}_{\\mathrm{cm}}\\right)^2 \\right\\rangle$. The algorithm to compute $r_{\\mathrm{ch}}^2$ can be broken down into the following steps:\n\n1.  **Calculate the lab-frame point-proton mean-square radius ($r_{pp,\\mathrm{lab}}^2$)**:\n    The expectation value of the squared radius operator in the laboratory frame is computed using the provided coupled-cluster singles and doubles (CCSD) one-body proton density matrix, $\\gamma^{(p)}$, and the matrix representation of the squared position operator, $R^2$. The formula is:\n    $$\n    r_{pp,\\mathrm{lab}}^2 = \\frac{1}{Z}\\mathrm{Tr}\\left(\\gamma^{(p)} R^2\\right)\n    $$\n    where $Z$ is the proton number and $\\mathrm{Tr}(M)$ denotes the trace of a matrix $M$. The trace of the matrix product $\\gamma^{(p)} R^2$ is calculated as $\\sum_i \\sum_j (\\gamma^{(p)})_{ij} (R^2)_{ji}$.\n\n2.  **Calculate the center-of-mass (CM) contribution ($\\langle R_{\\mathrm{cm}}^2 \\rangle$)**:\n    The motion of the center of mass contributes to the lab-frame radius. To obtain the intrinsic radius, this effect must be removed. Using the provided formula for a harmonic oscillator basis, the expectation value of the squared CM coordinate is:\n    $$\n    \\left\\langle R_{\\mathrm{cm}}^2 \\right\\rangle = \\frac{3 b^2}{2 A}\n    $$\n    where $b$ is the harmonic oscillator length and $A$ is the total number of nucleons.\n\n3.  **Calculate the intrinsic point-proton mean-square radius ($r_{pp}^2$)**:\n    The intrinsic radius is obtained by subtracting the CM contribution from the lab-frame radius. This correction is a standard procedure in nuclear structure calculations when using basis sets that do not separate the CM and intrinsic coordinates.\n    $$\n    r_{pp}^2 = r_{pp,\\mathrm{lab}}^2 - \\left\\langle R_{\\mathrm{cm}}^2 \\right\\rangle\n    $$\n\n4.  **Calculate the electromagnetic and relativistic corrections ($\\Delta_{\\mathrm{em}}$)**:\n    The measured charge radius is not solely determined by the spatial distribution of point-like protons. Several other effects an contribute, which are collected in the term $\\Delta_{\\mathrm{em}}$. These include the finite size of the proton ($R_p^2$), the charge distribution of the neutron ($R_n^2$), and relativistic effects, namely the Darwin-Foldy ($r_{\\mathrm{DF}}^2$) and spin-orbit ($r_{\\mathrm{SO}}^2$) terms. The total correction is given by:\n    $$\n    \\Delta_{\\mathrm{em}} = R_p^2 + \\frac{N}{Z} R_n^2 + r_{\\mathrm{DF}}^2 + r_{\\mathrm{SO}}^2\n    $$\n    where $N$ is the neutron number.\n\n5.  **Calculate the final charge radius ($r_{\\mathrm{ch}}$)**:\n    By summing the intrinsic point-proton mean-square radius and the corrections, we obtain the total mean-square charge radius:\n    $$\n    r_{\\mathrm{ch}}^2 = r_{pp}^2 + \\Delta_{\\mathrm{em}} = \\left( \\frac{1}{Z}\\mathrm{Tr}\\left(\\gamma^{(p)} R^2\\right) - \\frac{3 b^2}{2 A} \\right) + \\left( R_p^2 + \\frac{N}{Z} R_n^2 + r_{\\mathrm{DF}}^2 + r_{\\mathrm{SO}}^2 \\right)\n    $$\n    The charge radius is the square root of this value:\n    $$\n    r_{\\mathrm{ch}} = \\sqrt{r_{\\mathrm{ch}}^2}\n    $$\nThis sequence of calculations is applied to each test case using the provided data. The final result for each case is rounded to $6$ decimal places.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the nuclear charge radius from CCSD one-body proton densities\n    in a harmonic-oscillator single-particle basis for a set of test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"A\": 16, \"Z\": 8, \"N\": 8, \"b\": 1.76,\n            \"gamma_p\": np.array([[6.8, 0.1], [0.1, 1.2]]),\n            \"R2\": np.array([[5.0, 0.2], [0.2, 7.0]]),\n            \"R_p_sq\": 0.770, \"R_n_sq\": -0.1161, \"r_DF_sq\": 0.033, \"r_SO_sq\": -0.080,\n        },\n        {\n            \"A\": 40, \"Z\": 20, \"N\": 20, \"b\": 1.97,\n            \"gamma_p\": np.array([[10.0, 0.2, 0.0], [0.2, 8.5, 0.1], [0.0, 0.1, 1.5]]),\n            \"R2\": np.array([[5.5, 0.1, 0.0], [0.1, 8.0, 0.2], [0.0, 0.2, 10.5]]),\n            \"R_p_sq\": 0.770, \"R_n_sq\": -0.1161, \"r_DF_sq\": 0.033, \"r_SO_sq\": -0.050,\n        },\n        {\n            \"A\": 4, \"Z\": 2, \"N\": 2, \"b\": 1.40,\n            \"gamma_p\": np.array([[2.0]]),\n            \"R2\": np.array([[2.94]]),\n            \"R_p_sq\": 0.770, \"R_n_sq\": -0.1161, \"r_DF_sq\": 0.033, \"r_SO_sq\": 0.000,\n        },\n        {\n            \"A\": 48, \"Z\": 20, \"N\": 28, \"b\": 2.00,\n            \"gamma_p\": np.array([[15.5, -0.3], [-0.3, 4.5]]),\n            \"R2\": np.array([[5.6, 0.15], [0.15, 9.5]]),\n            \"R_p_sq\": 0.770, \"R_n_sq\": -0.1161, \"r_DF_sq\": 0.033, \"r_SO_sq\": -0.060,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack variables for clarity\n        A, Z, N = case[\"A\"], case[\"Z\"], case[\"N\"]\n        b = case[\"b\"]\n        gamma_p = case[\"gamma_p\"]\n        R2 = case[\"R2\"]\n        R_p_sq, R_n_sq, r_DF_sq, r_SO_sq = case[\"R_p_sq\"], case[\"R_n_sq\"], case[\"r_DF_sq\"], case[\"r_SO_sq\"]\n\n        # Step 1: Calculate the lab-frame point-proton mean-square radius\n        # Tr(gamma * R^2) can be calculated as Tr(gamma @ R2)\n        tr_gamma_R2 = np.trace(gamma_p @ R2)\n        r_pp_lab_sq = tr_gamma_R2 / Z\n\n        # Step 2: Calculate the center-of-mass contribution\n        r_cm_sq = (3 * b**2) / (2 * A)\n\n        # Step 3: Calculate the intrinsic point-proton mean-square radius\n        r_pp_sq = r_pp_lab_sq - r_cm_sq\n\n        # Step 4: Calculate the electromagnetic and relativistic corrections\n        delta_em = R_p_sq + (N / Z) * R_n_sq + r_DF_sq + r_SO_sq\n\n        # Step 5: Calculate the total mean-square charge radius and the charge radius\n        r_ch_sq = r_pp_sq + delta_em\n        r_ch = np.sqrt(r_ch_sq)\n        \n        # Append the result rounded to 6 decimal places\n        results.append(round(r_ch, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3553638"}]}