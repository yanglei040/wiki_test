{"hands_on_practices": [{"introduction": "Mastering the finite element method begins with understanding its core efficiency: performing calculations on a simple, standardized \"reference\" element, $\\hat{\\Omega}$, and then mapping them to the real-world \"physical\" mesh element, $\\Omega_e$. This practice focuses on this fundamental procedure for the Spectral Element Method (SEM). By deriving the scaling relationship between the reference and physical mass and stiffness matrices, you will gain a concrete understanding of how the geometry of an element, encapsulated by the Jacobian of the transformation, directly influences the discrete wave operator [@problem_id:3594501].", "problem": "Consider the one-dimensional acoustic wave equation $u_{tt} = c^{2} u_{xx}$ posed on a single physical element $\\Omega_{e} = [x_{a}, x_{b}]$ of length $L = x_{b} - x_{a}$, and its standard weak form obtained by multiplying by a test function $v$ and integrating over $\\Omega_{e}$. Using the Spectral Element Method (SEM) with polynomial degree $N=4$ on the reference element $\\hat{\\Omega} = [-1,1]$, construct the element-level mass and stiffness matrices on $\\hat{\\Omega}$ and then map them to $\\Omega_{e}$ via the isoparametric affine transformation $x(\\xi) = \\frac{x_{a}+x_{b}}{2} + \\frac{x_{b}-x_{a}}{2}\\,\\xi$ so that the Jacobian is $J = \\partial x / \\partial \\xi = L/2$.\n\nWork in the collocation formulation with Gauss–Lobatto–Legendre (GLL) nodes and weights. Let $\\{\\xi_{i}\\}_{i=0}^{4}$ denote the five GLL nodes and $\\{w_{i}\\}_{i=0}^{4}$ their GLL quadrature weights for $N=4$. Define the Lagrange interpolants $\\{\\ell_{i}(\\xi)\\}_{i=0}^{4}$ associated with the nodes such that $\\ell_{i}(\\xi_{j}) = \\delta_{ij}$. The SEM element mass and stiffness matrices on $\\hat{\\Omega}$ are given by\n$$\nM_{\\text{ref},ij} = \\int_{-1}^{1} \\ell_{i}(\\xi)\\,\\ell_{j}(\\xi)\\,d\\xi, \\qquad\nK_{\\text{ref},ij} = \\int_{-1}^{1} \\ell'_{i}(\\xi)\\,\\ell'_{j}(\\xi)\\,d\\xi,\n$$\nwhere primes denote differentiation with respect to $\\xi$. In the SEM collocation approach, approximate these integrals with GLL quadrature so that\n$$\nM_{\\text{ref}} = W, \\quad W = \\operatorname{diag}(w_{0},w_{1},w_{2},w_{3},w_{4}), \\qquad\nK_{\\text{ref}} = D^{\\top} W D,\n$$\nwhere $D_{ki} = \\ell'_{i}(\\xi_{k})$ is the differentiation matrix evaluated at the nodes.\n\nFirst, identify explicitly the GLL nodes $\\xi_{i}$ and weights $w_{i}$ for $N=4$ by using properties of Legendre polynomials $P_{4}(\\xi)$. Then, write explicit formulas for the entries of $D$ in terms of barycentric weights, and assemble $M_{\\text{ref}}$ and $K_{\\text{ref}}$ symbolically. Next, use the affine map to express the physical-element matrices $M_{\\text{phys}}$ and $K_{\\text{phys}}$ in terms of $M_{\\text{ref}}$, $K_{\\text{ref}}$, and $J$. Finally, determine the scalar $s$ such that the generalized discrete operator on $\\Omega_{e}$ satisfies\n$$\nM_{\\text{phys}}^{-1} K_{\\text{phys}} \\;=\\; s\\, M_{\\text{ref}}^{-1} K_{\\text{ref}}.\n$$\n\nProvide $s$ as a single closed-form analytic expression in terms of the element length $L$. No rounding is required.", "solution": "The problem statement is validated and found to be scientifically grounded, well-posed, objective, and self-contained. It describes a standard procedure in computational mechanics and the Spectral Element Method (SEM). All data and definitions are consistent with established theory. Therefore, we proceed with the solution.\n\nThe objective is to find a scalar constant $s$ such that the relationship $M_{\\text{phys}}^{-1} K_{\\text{phys}} = s\\, M_{\\text{ref}}^{-1} K_{\\text{ref}}$ holds, where $M_{\\text{phys}}$ and $K_{\\text{phys}}$ are the mass and stiffness matrices on a physical element $\\Omega_{e} = [x_a, x_b]$, and $M_{\\text{ref}}$ and $K_{\\text{ref}}$ are the corresponding matrices on the reference element $\\hat{\\Omega} = [-1, 1]$.\n\nThe physical element matrices are defined by integrals over the physical domain $\\Omega_{e}$:\n$$\nM_{\\text{phys},ij} = \\int_{x_{a}}^{x_{b}} \\phi_{i}(x)\\,\\phi_{j}(x)\\,dx\n$$\n$$\nK_{\\text{phys},ij} = \\int_{x_{a}}^{x_{b}} \\frac{d\\phi_{i}}{dx}(x)\\,\\frac{d\\phi_{j}}{dx}(x)\\,dx\n$$\nwhere $\\{\\phi_{i}(x)\\}$ are the basis functions on the physical element.\n\nThe problem specifies an isoparametric affine transformation from the reference coordinate $\\xi \\in [-1,1]$ to the physical coordinate $x \\in [x_a, x_b]$:\n$$\nx(\\xi) = \\frac{x_{a}+x_{b}}{2} + \\frac{x_{b}-x_{a}}{2}\\,\\xi\n$$\nThe Jacobian of this transformation, $J$, is a constant:\n$$\nJ = \\frac{dx}{d\\xi} = \\frac{x_{b}-x_{a}}{2} = \\frac{L}{2}\n$$\nwhere $L = x_{b} - x_{a}$ is the length of the physical element.\n\nTo relate the physical matrices to the reference matrices, we perform a change of variables in the integrals. The physical basis functions $\\phi_i(x)$ are related to the reference Lagrange interpolants $\\ell_i(\\xi)$ by the composition $\\phi_i(x(\\xi)) = \\ell_i(\\xi)$.\n\nFirst, let's transform the mass matrix. The differential element transforms as $dx = J\\,d\\xi$.\n$$\nM_{\\text{phys},ij} = \\int_{x_{a}}^{x_{b}} \\phi_{i}(x)\\,\\phi_{j}(x)\\,dx = \\int_{-1}^{1} \\phi_{i}(x(\\xi))\\,\\phi_{j}(x(\\xi))\\,J\\,d\\xi\n$$\nSubstituting the basis function relationship, we get:\n$$\nM_{\\text{phys},ij} = J \\int_{-1}^{1} \\ell_{i}(\\xi)\\,\\ell_{j}(\\xi)\\,d\\xi\n$$\nThe integral on the right is the definition of the reference mass matrix entry, $M_{\\text{ref},ij} = \\int_{-1}^{1} \\ell_{i}(\\xi)\\,\\ell_{j}(\\xi)\\,d\\xi$. Thus, the matrix relationship is:\n$$\nM_{\\text{phys}} = J \\cdot M_{\\text{ref}}\n$$\nNext, we transform the stiffness matrix. This requires transforming the derivative operator $d/dx$ using the chain rule:\n$$\n\\frac{d}{dx} = \\frac{d\\xi}{dx} \\frac{d}{d\\xi} = \\left(\\frac{dx}{d\\xi}\\right)^{-1} \\frac{d}{d\\xi} = \\frac{1}{J} \\frac{d}{d\\xi}\n$$\nApplying this to the stiffness matrix integral:\n$$\nK_{\\text{phys},ij} = \\int_{x_{a}}^{x_{b}} \\left(\\frac{d\\phi_{i}}{dx}\\right)\\left(\\frac{d\\phi_{j}}{dx}\\right)\\,dx = \\int_{-1}^{1} \\left(\\frac{1}{J}\\frac{d\\ell_{i}}{d\\xi}\\right)\\left(\\frac{1}{J}\\frac{d\\ell_{j}}{d\\xi}\\right)\\,J\\,d\\xi\n$$\nSince $J$ is a constant, we can factor it out of the integral:\n$$\nK_{\\text{phys},ij} = \\frac{J}{J^2} \\int_{-1}^{1} \\frac{d\\ell_{i}}{d\\xi}\\,\\frac{d\\ell_{j}}{d\\xi}\\,d\\xi = \\frac{1}{J} \\int_{-1}^{1} \\ell'_{i}(\\xi)\\,\\ell'_{j}(\\xi)\\,d\\xi\n$$\nThe integral on the right defines the reference stiffness matrix entry, $K_{\\text{ref},ij} = \\int_{-1}^{1} \\ell'_{i}(\\xi)\\,\\ell'_{j}(\\xi)\\,d\\xi$. The matrix relationship is therefore:\n$$\nK_{\\text{phys}} = \\frac{1}{J} \\cdot K_{\\text{ref}}\n$$\nIt is important to note that these scaling laws are purely geometric and independent of the polynomial degree $N$ or the specific choice of nodes and weights for the quadrature. The problem's definitions, $M_{\\text{ref}} = W$ and $K_{\\text{ref}} = D^{\\top} W D$, are specific instances of reference matrices, but the derived scaling relations hold for any consistent definition.\n\nNow, we construct the operator $M_{\\text{phys}}^{-1} K_{\\text{phys}}$. First, we find the inverse of the physical mass matrix:\n$$\nM_{\\text{phys}} = J \\cdot M_{\\text{ref}} \\implies M_{\\text{phys}}^{-1} = (J \\cdot M_{\\text{ref}})^{-1} = \\frac{1}{J} M_{\\text{ref}}^{-1}\n$$\nwhere we have used the property that the inverse of a scalar-matrix product is the product of the scalar's reciprocal and the matrix's inverse.\n\nNext, we pre-multiply the physical stiffness matrix by this inverse:\n$$\nM_{\\text{phys}}^{-1} K_{\\text{phys}} = \\left(\\frac{1}{J} M_{\\text{ref}}^{-1}\\right) \\left(\\frac{1}{J} K_{\\text{ref}}\\right)\n$$\nSince scalars commute with matrices, we can group the scalar terms:\n$$\nM_{\\text{phys}}^{-1} K_{\\text{phys}} = \\frac{1}{J^2} \\left(M_{\\text{ref}}^{-1} K_{\\text{ref}}\\right)\n$$\nWe are asked to find the scalar $s$ such that $M_{\\text{phys}}^{-1} K_{\\text{phys}} = s\\, M_{\\text{ref}}^{-1} K_{\\text{ref}}$. By direct comparison of the derived expression with the target form, we identify $s$ as:\n$$\ns = \\frac{1}{J^2}\n$$\nFinally, we substitute the given expression for the Jacobian, $J = L/2$:\n$$\ns = \\frac{1}{(L/2)^2} = \\frac{1}{L^2/4} = \\frac{4}{L^2}\n$$\nThis is the final analytical expression for the scalar $s$ in terms of the element length $L$.", "answer": "$$\n\\boxed{\\frac{4}{L^2}}\n$$", "id": "3594501"}, {"introduction": "Once a spatial discretization is established, solving a hyperbolic problem requires advancing the solution in time. For explicit schemes, this introduces a critical stability constraint linking the time step $\\Delta t$ to the spatial grid size $\\Delta x$. This exercise guides you through a spectral stability analysis to derive this constraint, known as the Courant-Friedrichs-Lewy (CFL) condition, for a standard P1 finite element method [@problem_id:3594567]. Understanding this process is essential for ensuring your simulations do not become unstable.", "problem": "Consider the one-dimensional scalar acoustic wave equation $u_{tt}(x,t) = c^{2} u_{xx}(x,t)$ on a periodic domain of length $L$, where $c$ is a positive constant wave speed. Discretize the spatial domain with a uniform mesh of $N$ elements and spacing $\\Delta x = L/N$, and approximate $u(x,t)$ using continuous, piecewise-linear ($P1$) finite elements. Use the standard Galerkin formulation in space with the consistent mass matrix. Advance the resulting semi-discrete equations in time using the explicit second-order central difference scheme.\n\nStarting from the variational form of the scalar wave equation and the definitions of the mass and stiffness matrices implied by the chosen basis, perform a spectral (Fourier) analysis on the resulting uniform, periodic discrete system to determine the maximum stable timestep $\\Delta t_{\\max}$ for the explicit time discretization. Your derivation should identify the discrete Fourier symbols and the worst-case discrete angular frequency, and it should lead to an expression for $\\Delta t_{\\max}$ purely in terms of $\\Delta x$ and $c$.\n\nProvide your final answer as a single closed-form symbolic expression in terms of $\\Delta x$ and $c$. Do not include units in your final answer.", "solution": "The problem is to determine the maximum stable timestep for a specific numerical scheme applied to the one-dimensional scalar acoustic wave equation. The process involves deriving the semi-discrete equations using the finite element method, and then performing a Fourier stability analysis on the fully discrete system.\n\nThe governing partial differential equation (PDE) is the scalar wave equation:\n$$ \\frac{\\partial^2 u}{\\partial t^2}(x,t) = c^{2} \\frac{\\partial^2 u}{\\partial x^2}(x,t) $$\non a periodic domain of length $L$, where $c$ is the constant wave speed.\n\nFirst, we establish the variational (or weak) formulation. We multiply the PDE by a sufficiently smooth test function $v(x)$ and integrate over the domain $[0, L]$:\n$$ \\int_{0}^{L} \\frac{\\partial^2 u}{\\partial t^2} v \\,dx = c^2 \\int_{0}^{L} \\frac{\\partial^2 u}{\\partial x^2} v \\,dx $$\nIntegrating the right-hand side by parts yields:\n$$ \\int_{0}^{L} \\frac{\\partial^2 u}{\\partial t^2} v \\,dx = c^2 \\left[ \\frac{\\partial u}{\\partial x} v \\right]_{0}^{L} - c^2 \\int_{0}^{L} \\frac{\\partial u}{\\partial x} \\frac{\\partial v}{\\partial x} \\,dx $$\nThe boundary term $\\left[ c^2 \\frac{\\partial u}{\\partial x} v \\right]_{0}^{L}$ vanishes due to the periodic boundary conditions on both $u$ and $v$. This leads to the weak form: find $u(x,t)$ such that for all valid test functions $v(x)$,\n$$ \\int_{0}^{L} \\frac{\\partial^2 u}{\\partial t^2} v \\,dx + c^2 \\int_{0}^{L} \\frac{\\partial u}{\\partial x} \\frac{\\partial v}{\\partial x} \\,dx = 0 $$\n\nNext, we perform the spatial discretization. The domain is divided into $N$ elements of uniform size $\\Delta x = L/N$. We approximate the solution $u(x,t)$ using continuous, piecewise-linear ($P1$) basis functions, $\\phi_j(x)$:\n$$ u_h(x,t) = \\sum_{j=1}^{N} u_j(t) \\phi_j(x) $$\nwhere $u_j(t)$ are the time-dependent coefficients representing the solution at the nodes $x_j = j\\Delta x$, and $u_h(x,t)$ is the finite element approximation. In the Galerkin method, the test functions $v$ are chosen from the same space as the basis functions, so we set $v(x) = \\phi_i(x)$ for $i=1, \\dots, N$. Substituting the expansion for $u_h$ into the weak form gives a system of ordinary differential equations (ODEs):\n$$ \\sum_{j=1}^{N} \\left( \\int_{0}^{L} \\phi_i \\phi_j \\,dx \\right) \\frac{d^2 u_j}{dt^2} + c^2 \\sum_{j=1}^{N} \\left( \\int_{0}^{L} \\frac{d\\phi_i}{dx} \\frac{d\\phi_j}{dx} \\,dx \\right) u_j = 0 \\quad \\text{for } i=1, \\dots, N $$\nThis can be written in matrix form as:\n$$ \\mathbf{M} \\ddot{\\mathbf{u}}(t) + \\mathbf{K} \\mathbf{u}(t) = \\mathbf{0} $$\nwhere $\\mathbf{u}(t)$ is the vector of nodal values $[u_1(t), \\dots, u_N(t)]^T$. The consistent mass matrix $\\mathbf{M}$ and stiffness matrix $\\mathbf{K}$ have entries:\n$$ M_{ij} = \\int_{0}^{L} \\phi_i \\phi_j \\,dx $$\n$$ K_{ij} = c^2 \\int_{0}^{L} \\frac{d\\phi_i}{dx} \\frac{d\\phi_j}{dx} \\,dx $$\n\nFor uniform $P1$ elements, the basis function $\\phi_j(x)$ is a \"hat\" function centered at $x_j$ and non-zero only on $[x_{j-1}, x_{j+1}]$. The integrals evaluate to:\n$M_{j,j} = \\int_{x_{j-1}}^{x_{j+1}} \\phi_j^2 \\,dx = \\frac{2\\Delta x}{3}$\n$M_{j, j\\pm 1} = \\int_{x_{j}}^{x_{j\\pm 1}} \\phi_j \\phi_{j\\pm 1} \\,dx = \\frac{\\Delta x}{6}$\n$K_{j,j} = c^2 \\int_{x_{j-1}}^{x_{j+1}} (\\phi'_j)^2 \\,dx = \\frac{2c^2}{\\Delta x}$\n$K_{j, j\\pm 1} = c^2 \\int_{x_{j}}^{x_{j\\pm 1}} \\phi'_j \\phi'_{j\\pm 1} \\,dx = -\\frac{c^2}{\\Delta x}$\nAll other entries are zero. The $i$-th row of the matrix system corresponds to the stencil operations:\n$$ \\frac{\\Delta x}{6}(\\ddot{u}_{i-1} + 4\\ddot{u}_i + \\ddot{u}_{i+1}) + \\frac{c^2}{\\Delta x}(-u_{i-1} + 2u_i - u_{i+1}) = 0 $$\n\nTo perform a spectral analysis, we seek a grid-scale Fourier mode solution of the form $u_j(t) = \\hat{u}_k(t) e^{i k x_j}$, where $k$ is the wavenumber and $x_j = j \\Delta x$. Substituting this into the stencil equation, we can find the Fourier symbols (eigenvalues) of the matrices $\\mathbf{M}$ and $\\mathbf{K}$.\nFor the mass matrix term:\n$\\frac{\\Delta x}{6}(\\ddot{\\hat{u}}_k e^{ik(j-1)\\Delta x} + 4\\ddot{\\hat{u}}_k e^{ikj\\Delta x} + \\ddot{\\hat{u}}_k e^{ik(j+1)\\Delta x}) = \\ddot{\\hat{u}}_k e^{ikj\\Delta x} \\frac{\\Delta x}{6}(e^{-ik\\Delta x} + 4 + e^{ik\\Delta x}) = \\ddot{\\hat{u}}_k e^{ikj\\Delta x} \\frac{\\Delta x}{3}(2 + \\cos(k\\Delta x))$.\nThe Fourier symbol of the mass matrix operator is $\\hat{M}(k) = \\frac{\\Delta x}{3}(2 + \\cos(k\\Delta x))$.\n\nFor the stiffness matrix term:\n$\\frac{c^2}{\\Delta x}(-u_{i-1} + 2u_i - u_{i+1}) \\to \\hat{u}_k e^{ikj\\Delta x} \\frac{c^2}{\\Delta x}(-e^{-ik\\Delta x} + 2 - e^{ik\\Delta x}) = \\hat{u}_k e^{ikj\\Delta x} \\frac{2c^2}{\\Delta x}(1 - \\cos(k\\Delta x))$.\nThe Fourier symbol of the stiffness matrix operator is $\\hat{K}(k) = \\frac{2c^2}{\\Delta x}(1 - \\cos(k\\Delta x))$.\n\nThe semi-discrete system transforms into a scalar ODE for each mode $k$:\n$$ \\hat{M}(k) \\ddot{\\hat{u}}_k(t) + \\hat{K}(k) \\hat{u}_k(t) = 0 \\implies \\ddot{\\hat{u}}_k(t) + \\omega_d^2(k) \\hat{u}_k(t) = 0 $$\nwhere $\\omega_d(k)$ is the discrete angular frequency, given by the discrete dispersion relation:\n$$ \\omega_d^2(k) = \\frac{\\hat{K}(k)}{\\hat{M}(k)} = \\frac{\\frac{2c^2}{\\Delta x}(1 - \\cos(k\\Delta x))}{\\frac{\\Delta x}{3}(2 + \\cos(k\\Delta x))} = \\frac{6c^2}{(\\Delta x)^2} \\frac{1 - \\cos(k\\Delta x)}{2 + \\cos(k\\Delta x)} $$\n\nNow we discretize in time using the explicit second-order central difference scheme for $\\ddot{\\hat{u}}_k$. Let $\\hat{u}_k^n$ denote the solution at time $t_n = n\\Delta t$:\n$$ \\frac{\\hat{u}_k^{n+1} - 2\\hat{u}_k^n + \\hat{u}_k^{n-1}}{(\\Delta t)^2} + \\omega_d^2(k) \\hat{u}_k^n = 0 $$\nWe analyze stability by assuming a solution of the form $\\hat{u}_k^n = g^n$, where $g$ is the amplification factor.\n$$ g^{n-1}(g^2 - 2g + 1) + \\omega_d^2(k)(\\Delta t)^2 g^n = 0 $$\n$$ g^2 - (2 - (\\omega_d(k)\\Delta t)^2)g + 1 = 0 $$\nFor the scheme to be stable, the magnitude of the roots of this quadratic equation must be no greater than unity, i.e., $|g| \\le 1$. This condition is met if and only if the time step $\\Delta t$ satisfies:\n$$ |\\omega_d(k) \\Delta t| \\le 2 $$\nThis must hold for all possible wavenumbers $k$. To guarantee stability, we must bound the time step based on the maximum possible discrete frequency:\n$$ \\Delta t \\le \\frac{2}{\\max_k |\\omega_d(k)|} \\implies \\Delta t_{\\max} = \\frac{2}{\\omega_{d,\\max}} $$\n\nWe find $\\omega_{d,\\max}$ by maximizing $\\omega_d^2(k)$. Let $\\theta = k\\Delta x$. The range of physically distinct grid-scale modes is $\\theta \\in [-\\pi, \\pi]$. We need to maximize the function:\n$$ f(\\theta) = \\frac{1 - \\cos\\theta}{2 + \\cos\\theta} $$\nThe derivative of $f(\\theta)$ with respect to $\\cos\\theta$ is $\\frac{d}{d(\\cos\\theta)}\\left(\\frac{1 - \\cos\\theta}{2 + \\cos\\theta}\\right) = \\frac{-(2+\\cos\\theta) - (1-\\cos\\theta)(1)}{(2+\\cos\\theta)^2} = \\frac{-3}{(2+\\cos\\theta)^2}$, which is always negative. Thus, $f(\\theta)$ is a monotonically decreasing function of $\\cos\\theta$. The maximum of $f(\\theta)$ occurs at the minimum value of $\\cos\\theta$, which is $-1$ at $\\theta = \\pm\\pi$. This corresponds to the highest frequency mode representable on the grid (wavelength $2\\Delta x$).\nThe maximum value is:\n$$ f_{\\max} = f(\\pi) = \\frac{1 - (-1)}{2 + (-1)} = \\frac{2}{1} = 2 $$\nThe maximum squared discrete angular frequency is:\n$$ \\omega_{d,\\max}^2 = \\frac{6c^2}{(\\Delta x)^2} f_{\\max} = \\frac{6c^2}{(\\Delta x)^2} \\cdot 2 = \\frac{12c^2}{(\\Delta x)^2} $$\nThe maximum discrete angular frequency is:\n$$ \\omega_{d,\\max} = \\sqrt{\\frac{12c^2}{(\\Delta x)^2}} = \\frac{2\\sqrt{3}c}{\\Delta x} $$\nFinally, we substitute this into the stability condition to find the maximum stable timestep:\n$$ \\Delta t_{\\max} = \\frac{2}{\\omega_{d,\\max}} = \\frac{2}{\\frac{2\\sqrt{3}c}{\\Delta x}} = \\frac{\\Delta x}{\\sqrt{3}c} $$\nThis result can also be expressed as a Courant–Friedrichs–Lewy (CFL) number, $\\mathcal{C} = \\frac{c\\Delta t}{\\Delta x}$, where the stability limit is $\\mathcal{C} \\le \\frac{1}{\\sqrt{3}}$.", "answer": "$$\\boxed{\\frac{\\Delta x}{\\sqrt{3} c}}$$", "id": "3594567"}, {"introduction": "We now apply our understanding to a practical challenge in computational geophysics: simulating seismic waves in anisotropic media using Discontinuous Galerkin (DG) methods. Unlike standard FEM, DG methods require a carefully designed \"numerical flux\" to communicate information between elements and ensure stability. This coding practice will guide you through the design of an energy-stable flux by computing directional wave speeds from the material's Christoffel matrix, a technique central to modern seismic modeling codes [@problem_id:3594473].", "problem": "You are asked to design and verify energy-stable numerical fluxes for Discontinuous Galerkin Finite Element (DG FE) discretizations of the two-dimensional anisotropic elastic wave equations in the first-order symmetric hyperbolic form. The objective is to tune interface flux penalty parameters using directional characteristic speeds to balance accuracy and stability in the presence of strong anisotropy. Your task is to derive from first principles a computable criterion for energy stability and implement a program that, for a set of test interfaces, computes the minimal penalty required for stability and a balanced recommendation using quasi-compressional and quasi-shear wave speeds.\n\nStart from the linear elastodynamics in the absence of body forces with displacement field $u_j$, velocity field $v_j = \\partial_t u_j$, stress tensor $\\sigma_{ij}$, mass density $\\rho$, and fourth-order stiffness tensor $C_{ijkl}$:\n$$\n\\rho \\, \\partial_t v_j = \\partial_i \\sigma_{ij}, \\quad \\sigma_{ij} = C_{ijkl} \\, \\partial_l u_k.\n$$\nOn a material interface with unit normal vector $n$ and tangential direction orthogonal to $n$, define the Christoffel matrix in direction $n$ by\n$$\n\\Gamma_{jk}(n) = C_{j i k l} \\, n_i \\, n_l,\n$$\nand the directional quasi-wave speeds squared as the eigenvalues of the generalized eigenproblem\n$$\n\\Gamma(n) \\, q = \\rho \\, v^2 \\, q,\n$$\nso that the two eigenvalues $v_1^2 \\le v_2^2$ give the quasi-shear speed $V_s = v_1$ and quasi-compressional speed $V_p = v_2$ along $n$.\n\nConsider a DG FE interface numerical flux for the first-order system written as a central term minus a jump-penalization term with scalar penalty parameter $\\alpha$ on the appropriate energy norm of the jump. Using the energy method for symmetric hyperbolic systems, the interface term is stable if the penalization dominates the contribution of the physical flux Jacobian in the normal direction. Specifically, the sufficient energy-stability condition for a single-parameter scalar penalty is that\n$$\n\\alpha \\ge \\max\\left\\{ V_p^{(L)}(n), V_s^{(L)}(n), V_p^{(R)}(n), V_s^{(R)}(n) \\right\\},\n$$\nwhere the superscripts $(L)$ and $(R)$ denote the left and right materials across the interface. Motivated by balancing numerical dissipation for quasi-compressional and quasi-shear wave families, a practical balanced penalty recommendation is\n$$\n\\alpha_{\\mathrm{bal}} = \\frac{1}{2} \\left( \\max\\{ V_p^{(L)}(n), V_p^{(R)}(n) \\} + \\max\\{ V_s^{(L)}(n), V_s^{(R)}(n) \\} \\right).\n$$\n\nAssume an orthotropic medium in two-dimensional plane-strain with material axes aligned with coordinate axes, no normal-shear coupling, and Voigt notation stiffness parameters $\\{ C_{11}, C_{22}, C_{12}, C_{66} \\}$, corresponding to physical stiffness components $C_{xxxx} = C_{11}$, $C_{yyyy} = C_{22}$, $C_{xxyy} = C_{12}$, and $C_{xyxy} = C_{66}$. For a unit normal direction $n = (\\cos\\theta, \\sin\\theta)$ with angle $\\theta$ measured in radians, the Christoffel matrix in this orthotropic case reduces to\n$$\n\\Gamma(n) = \\begin{bmatrix}\nC_{11} \\, n_x^2 + C_{66} \\, n_y^2 & (C_{12} + C_{66}) \\, n_x \\, n_y \\\\\n(C_{12} + C_{66}) \\, n_x \\, n_y & C_{22} \\, n_y^2 + C_{66} \\, n_x^2\n\\end{bmatrix},\n$$\nwhere $n_x = \\cos\\theta$ and $n_y = \\sin\\theta$. The directional speeds are $V_{p,s}(n) = \\sqrt{\\lambda_{p,s} / \\rho}$ where $\\lambda_{p,s}$ are the eigenvalues of $\\Gamma(n)$.\n\nYour program must, for each test interface, compute:\n- the minimal energy-stable penalty $\\alpha_{\\min}$ in $\\mathrm{m/s}$,\n- determine if a given candidate penalty $\\alpha_{\\mathrm{cand}}$ in $\\mathrm{m/s}$ satisfies energy stability as a boolean,\n- the balanced recommendation $\\alpha_{\\mathrm{bal}}$ in $\\mathrm{m/s}$ as defined above.\n\nPhysical units must be respected as follows: material densities are in $\\mathrm{kg/m^3}$, stiffnesses are in $\\mathrm{Pa}$, speeds and penalties are in $\\mathrm{m/s}$. The angle $\\theta$ must be interpreted in radians. All outputs for speeds and penalties must be expressed in $\\mathrm{m/s}$.\n\nTest suite of interfaces (each case is a tuple of left and right material properties, angle, and candidate penalty):\n1. Case A (isotropic baseline, happy path): left and right densities $\\rho^{(L)} = \\rho^{(R)} = 2500$ $\\mathrm{kg/m^3}$, isotropic Lamé parameters $\\lambda = 4 \\cdot 10^9$ $\\mathrm{Pa}$ and $\\mu = 3 \\cdot 10^9$ $\\mathrm{Pa}$ mapped to orthotropic parameters $C_{11} = \\lambda + 2\\mu = 10 \\cdot 10^9$ $\\mathrm{Pa}$, $C_{22} = 10 \\cdot 10^9$ $\\mathrm{Pa}$, $C_{12} = \\lambda = 4 \\cdot 10^9$ $\\mathrm{Pa}$, $C_{66} = \\mu = 3 \\cdot 10^9$ $\\mathrm{Pa}$; angle $\\theta = 0.0$; candidate penalty $\\alpha_{\\mathrm{cand}} = 6000.0$ $\\mathrm{m/s}$.\n2. Case B (strong anisotropy on left, mixed interface): left density $\\rho^{(L)} = 2700$ $\\mathrm{kg/m^3}$, left stiffness $C_{11}^{(L)} = 20 \\cdot 10^9$ $\\mathrm{Pa}$, $C_{22}^{(L)} = 5 \\cdot 10^9$ $\\mathrm{Pa}$, $C_{12}^{(L)} = 3 \\cdot 10^9$ $\\mathrm{Pa}$, $C_{66}^{(L)} = 2 \\cdot 10^9$ $\\mathrm{Pa}$; right isotropic as in Case A; angle $\\theta = 0.7853981633974483$; candidate penalty $\\alpha_{\\mathrm{cand}} = 2500.0$ $\\mathrm{m/s}$.\n3. Case C (near-degenerate shear, edge case): left and right densities $\\rho^{(L)} = \\rho^{(R)} = 2600$ $\\mathrm{kg/m^3}$, stiffnesses $C_{11}^{(\\cdot)} = 12 \\cdot 10^9$ $\\mathrm{Pa}$, $C_{22}^{(\\cdot)} = 12 \\cdot 10^9$ $\\mathrm{Pa}$, $C_{12}^{(\\cdot)} = 5 \\cdot 10^9$ $\\mathrm{Pa}$, $C_{66}^{(\\cdot)} = 0.1 \\cdot 10^9$ $\\mathrm{Pa}$; angle $\\theta = 1.5707963267948966$; candidate penalty $\\alpha_{\\mathrm{cand}} = 1800.0$ $\\mathrm{m/s}$.\n4. Case D (very strong anisotropy and heterogeneous interface, boundary condition): left density $\\rho^{(L)} = 2400$ $\\mathrm{kg/m^3}$, left stiffnesses $C_{11}^{(L)} = 30 \\cdot 10^9$ $\\mathrm{Pa}$, $C_{22}^{(L)} = 8 \\cdot 10^9$ $\\mathrm{Pa}$, $C_{12}^{(L)} = 4 \\cdot 10^9$ $\\mathrm{Pa}$, $C_{66}^{(L)} = 1 \\cdot 10^9$ $\\mathrm{Pa}$; right density $\\rho^{(R)} = 2900$ $\\mathrm{kg/m^3}$, right stiffnesses $C_{11}^{(R)} = 15 \\cdot 10^9$ $\\mathrm{Pa}$, $C_{22}^{(R)} = 7 \\cdot 10^9$ $\\mathrm{Pa}$, $C_{12}^{(R)} = 2 \\cdot 10^9$ $\\mathrm{Pa}$, $C_{66}^{(R)} = 3 \\cdot 10^9$ $\\mathrm{Pa}$; angle $\\theta = 0.001$; candidate penalty $\\alpha_{\\mathrm{cand}} = 3500.0$ $\\mathrm{m/s}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each result corresponds to one test case and must itself be a list of four entries in the exact order\n$$\n[\\alpha_{\\min}, \\alpha_{\\mathrm{cand}}, \\text{is\\_stable}, \\alpha_{\\mathrm{bal}}],\n$$\nwhere $\\alpha_{\\min}$ and $\\alpha_{\\mathrm{bal}}$ are floats in $\\mathrm{m/s}$, $\\alpha_{\\mathrm{cand}}$ is the candidate float in $\\mathrm{m/s}$, and $\\text{is\\_stable}$ is a boolean indicating whether $\\alpha_{\\mathrm{cand}} \\ge \\alpha_{\\min}$ holds. The final output must therefore have the format\n$$\n[[a_1,c_1,b_1,r_1],[a_2,c_2,b_2,r_2],[a_3,c_3,b_3,r_3],[a_4,c_4,b_4,r_4]],\n$$\nwith no spaces anywhere in the line.", "solution": "The problem requires the design and verification of energy-stable numerical flux penalty parameters for a Discontinuous Galerkin Finite Element (DG-FE) method applied to the two-dimensional anisotropic elastic wave equations. The core of the task is to derive and compute penalty parameters from first principles, specifically using directional wave speeds obtained from the Christoffel matrix of the material.\n\nThe governing equations of linear elastodynamics in a first-order symmetric hyperbolic form are given by:\n$$\n\\rho \\, \\partial_t v_j = \\partial_i \\sigma_{ij}\n$$\n$$\n\\partial_t \\epsilon_{kl} = \\frac{1}{2}(\\partial_l v_k + \\partial_k v_l)\n$$\nwhere $v_j$ is the velocity, $\\rho$ is the mass density, and $\\sigma_{ij}$ is the stress tensor. The stress is related to the strain tensor $\\epsilon_{kl}$ via the constitutive relation $\\sigma_{ij} = C_{ijkl} \\epsilon_{kl}$, where $C_{ijkl}$ is the fourth-order stiffness tensor.\n\nIn a DG-FE framework, the domain is partitioned into elements, and the solution is allowed to be discontinuous across element interfaces. The coupling between elements is established through a numerical flux. For a symmetric hyperbolic system, a common choice is a flux that combines a central average and a penalty term proportional to the jump in the solution variables. The stability of such a scheme, assessed using the energy method, depends critically on the magnitude of this penalty.\n\nThe penalty must be large enough to dissipate any energy growth that arises from the interface terms. A sufficient condition for energy stability is that the penalty parameter, $\\alpha$, must be greater than or equal to the maximum characteristic speed of the system in the direction normal to the interface. These characteristic speeds are the physical wave propagation speeds.\n\nFor anisotropic elasticity, wave speeds are direction-dependent. They are derived from the Christoffel matrix, $\\Gamma(n)$, which is defined for a given direction with unit normal vector $n$:\n$$\n\\Gamma_{jk}(n) = C_{j i k l} \\, n_i \\, n_l\n$$\nThe eigenvalues of the generalized eigenproblem $\\Gamma(n) q = \\rho v^2 q$ yield the squared wave speeds, $v^2$, for waves propagating in the direction $n$. For a two-dimensional problem, there are two such speeds for each direction: the quasi-compressional speed, $V_p(n)$, and the quasi-shear speed, $V_s(n)$. These correspond to the larger and smaller eigenvalues, respectively.\n\nThe problem specializes to a two-dimensional orthotropic medium in plane strain, with material axes aligned with the coordinate axes. The interface normal is $n = (n_x, n_y) = (\\cos\\theta, \\sin\\theta)$. The $2 \\times 2$ Christoffel matrix is given as:\n$$\n\\Gamma(n) = \\begin{bmatrix}\nC_{11} n_x^2 + C_{66} n_y^2 & (C_{12} + C_{66}) n_x n_y \\\\\n(C_{12} + C_{66}) n_x n_y & C_{22} n_y^2 + C_{66} n_x^2\n\\end{bmatrix}\n$$\nThe eigenvalues of $\\Gamma(n)$, let's call them $\\lambda_1$ and $\\lambda_2$ with $\\lambda_1 \\le \\lambda_2$, must be computed. They are the roots of the characteristic equation $\\det(\\Gamma(n) - \\lambda I) = 0$, where $I$ is the identity matrix. If we denote the components of $\\Gamma(n)$ as $A = \\Gamma_{11}$, $D = \\Gamma_{22}$, and $B = \\Gamma_{12}$, the characteristic equation is $\\lambda^2 - (A+D)\\lambda + (AD-B^2) = 0$. The roots are:\n$$\n\\lambda_{1,2} = \\frac{(A+D) \\pm \\sqrt{(A+D)^2 - 4(AD - B^2)}}{2} = \\frac{(A+D) \\pm \\sqrt{(A-D)^2 + 4B^2}}{2}\n$$\nThe directional wave speeds are then found by relating these eigenvalues to the density $\\rho$:\n$$\nV_s(n) = \\sqrt{\\frac{\\lambda_1}{\\rho}} = \\sqrt{\\frac{(A+D) - \\sqrt{(A-D)^2 + 4B^2}}{2\\rho}}\n$$\n$$\nV_p(n) = \\sqrt{\\frac{\\lambda_2}{\\rho}} = \\sqrt{\\frac{(A+D) + \\sqrt{(A-D)^2 + 4B^2}}{2\\rho}}\n$$\nAn interface separates two materials, denoted by superscripts $(L)$ and $(R)$. Each material has its own properties ($\\rho, C_{ijkl}$) and thus its own set of directional wave speeds, $V_s^{(L)}(n), V_p^{(L)}(n)$ and $V_s^{(R)}(n), V_p^{(R)}(n)$.\n\nThe problem defines three quantities to be computed based on these speeds:\n1.  The minimal energy-stable penalty, $\\alpha_{\\min}$. This is the maximum characteristic speed across the interface, ensuring the penalty is sufficient for both wave families in both materials. Since $V_p \\ge V_s$, this simplifies to the maximum of the quasi-compressional speeds.\n    $$\n    \\alpha_{\\min} = \\max\\left\\{ V_p^{(L)}(n), V_s^{(L)}(n), V_p^{(R)}(n), V_s^{(R)}(n) \\right\\} = \\max\\left\\{ V_p^{(L)}(n), V_p^{(R)}(n) \\right\\}\n    $$\n2.  A stability check, which is a boolean `is_stable` that is true if a given candidate penalty $\\alpha_{\\mathrm{cand}}$ satisfies the stability condition:\n    $$\n    \\text{is\\_stable} \\iff \\alpha_{\\mathrm{cand}} \\ge \\alpha_{\\min}\n    $$\n3.  A balanced penalty recommendation, $\\alpha_{\\mathrm{bal}}$, which averages the maximum speeds of the p-wave and s-wave families, aiming to balance accuracy and dissipation.\n    $$\n    \\alpha_{\\mathrm{bal}} = \\frac{1}{2} \\left( \\max\\{ V_p^{(L)}(n), V_p^{(R)}(n) \\} + \\max\\{ V_s^{(L)}(n), V_s^{(R)}(n) \\} \\right)\n    $$\n\nThe computational procedure for each test case is as follows:\n1.  For the given interface angle $\\theta$, compute the components $n_x = \\cos\\theta$ and $n_y = \\sin\\theta$.\n2.  For the material on the left side $(L)$, use its properties ($\\rho^{(L)}$, $C_{ij}^{(L)}$) and $n$ to construct its Christoffel matrix $\\Gamma^{(L)}(n)$. Calculate its eigenvalues $\\lambda_1^{(L)}, \\lambda_2^{(L)}$ and thereby the wave speeds $V_s^{(L)}$ and $V_p^{(L)}$.\n3.  Repeat step 2 for the material on the right side $(R)$ to find $V_s^{(R)}$ and $V_p^{(R)}$.\n4.  Use these four speeds ($V_s^{(L)}, V_p^{(L)}, V_s^{(R)}, V_p^{(R)}$) and the given $\\alpha_{\\mathrm{cand}}$ to compute $\\alpha_{\\min}$, `is_stable`, and $\\alpha_{\\mathrm{bal}}$ using their respective formulas.\n\nThis process is applied to each of the four test cases provided. All physical quantities are given in SI units ($\\mathrm{kg/m^3}$, $\\mathrm{Pa}$), so the computed speeds and penalties will naturally be in $\\mathrm{m/s}$.", "answer": "```python\nimport numpy as np\n\ndef compute_wave_speeds(rho, C11, C22, C12, C66, theta):\n    \"\"\"\n    Computes the quasi-shear and quasi-compressional wave speeds for a 2D\n    orthotropic material in a given propagation direction theta.\n\n    Args:\n        rho (float): Density in kg/m^3.\n        C11, C22, C12, C66 (float): Stiffness parameters in Pa.\n        theta (float): Propagation angle in radians.\n\n    Returns:\n        tuple[float, float]: A tuple containing (Vs, Vp) in m/s.\n    \"\"\"\n    n_x = np.cos(theta)\n    n_y = np.sin(theta)\n\n    # Components of the 2x2 Christoffel matrix Gamma(n)\n    G11 = C11 * n_x**2 + C66 * n_y**2\n    G22 = C22 * n_y**2 + C66 * n_x**2\n    G12 = (C12 + C66) * n_x * n_y\n\n    # Eigenvalues lambda of Gamma(n) are found from the characteristic equation:\n    # lambda^2 - tr(G_ij)*lambda + det(G_ij) = 0\n    # The solution is lambda = (tr +/- sqrt(tr^2 - 4*det)) / 2\n    # The term under the sqrt simplifies to (G11 - G22)^2 + 4 * G12^2\n    trace = G11 + G22\n    discriminant_sqrt = np.sqrt((G11 - G22)**2 + 4 * G12**2)\n    \n    # The two eigenvalues, sorted as lambda1 <= lambda2\n    lambda1 = (trace - discriminant_sqrt) / 2.0\n    lambda2 = (trace + discriminant_sqrt) / 2.0\n    \n    # Wave speeds v are related by lambda = rho * v^2, so v = sqrt(lambda / rho).\n    # Vs (quasi-shear) corresponds to the smaller eigenvalue, Vp (quasi-compressional) to the larger.\n    Vs = np.sqrt(lambda1 / rho)\n    Vp = np.sqrt(lambda2 / rho)\n\n    return Vs, Vp\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test suite of interfaces.\n    \"\"\"\n    test_cases = [\n        # Case A\n        {\n            \"left\": {\"rho\": 2500.0, \"C11\": 10e9, \"C22\": 10e9, \"C12\": 4e9, \"C66\": 3e9},\n            \"right\": {\"rho\": 2500.0, \"C11\": 10e9, \"C22\": 10e9, \"C12\": 4e9, \"C66\": 3e9},\n            \"theta\": 0.0,\n            \"alpha_cand\": 6000.0,\n        },\n        # Case B\n        {\n            \"left\": {\"rho\": 2700.0, \"C11\": 20e9, \"C22\": 5e9, \"C12\": 3e9, \"C66\": 2e9},\n            \"right\": {\"rho\": 2500.0, \"C11\": 10e9, \"C22\": 10e9, \"C12\": 4e9, \"C66\": 3e9},\n            \"theta\": 0.7853981633974483,  # pi/4\n            \"alpha_cand\": 2500.0,\n        },\n        # Case C\n        {\n            \"left\": {\"rho\": 2600.0, \"C11\": 12e9, \"C22\": 12e9, \"C12\": 5e9, \"C66\": 0.1e9},\n            \"right\": {\"rho\": 2600.0, \"C11\": 12e9, \"C22\": 12e9, \"C12\": 5e9, \"C66\": 0.1e9},\n            \"theta\": 1.5707963267948966,  # pi/2\n            \"alpha_cand\": 1800.0,\n        },\n        # Case D\n        {\n            \"left\": {\"rho\": 2400.0, \"C11\": 30e9, \"C22\": 8e9, \"C12\": 4e9, \"C66\": 1e9},\n            \"right\": {\"rho\": 2900.0, \"C11\": 15e9, \"C22\": 7e9, \"C12\": 2e9, \"C66\": 3e9},\n            \"theta\": 0.001,\n            \"alpha_cand\": 3500.0,\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        # Unpack properties for the left and right materials\n        left_props = case[\"left\"]\n        right_props = case[\"right\"]\n        theta = case[\"theta\"]\n        alpha_cand = case[\"alpha_cand\"]\n        \n        # Calculate wave speeds for left and right materials\n        Vs_L, Vp_L = compute_wave_speeds(\n            left_props[\"rho\"], left_props[\"C11\"], left_props[\"C22\"],\n            left_props[\"C12\"], left_props[\"C66\"], theta\n        )\n        \n        Vs_R, Vp_R = compute_wave_speeds(\n            right_props[\"rho\"], right_props[\"C11\"], right_props[\"C22\"],\n            right_props[\"C12\"], right_props[\"C66\"], theta\n        )\n        \n        # 1. Minimal stable penalty alpha_min\n        # Since Vp >= Vs, this is the maximum of the two p-wave speeds.\n        alpha_min = max(Vp_L, Vp_R)\n        \n        # 2. Stability check for the candidate penalty\n        is_stable = alpha_cand >= alpha_min\n        \n        # 3. Balanced penalty recommendation alpha_bal\n        max_Vp = max(Vp_L, Vp_R)\n        max_Vs = max(Vs_L, Vs_R)\n        alpha_bal = 0.5 * (max_Vp + max_Vs)\n\n        all_results.append([alpha_min, alpha_cand, is_stable, alpha_bal])\n\n    # Format the final output string according to the problem specification.\n    # The boolean must be converted to a lowercase string 'true' or 'false'.\n    result_strings = []\n    for res in all_results:\n        # res[0]: alpha_min, res[1]: alpha_cand, res[2]: is_stable, res[3]: alpha_bal\n        bool_str = str(res[2]).lower()\n        result_strings.append(f\"[{res[0]},{res[1]},{bool_str},{res[3]}]\")\n    \n    final_output = f\"[{','.join(result_strings)}]\"\n    print(final_output)\n\nsolve()\n\n```", "id": "3594473"}]}