{"hands_on_practices": [{"introduction": "Understanding the fundamental dynamics of tsunami propagation begins with an idealized case. Before tackling complex numerical models, it's invaluable to grasp the core physics through an analytical lens. This exercise guides you through solving the linear shallow-water equations for an initial surface uplift, using d'Alembert's classic formula. By deriving the exact solution, you will develop a concrete intuition for how an initial disturbance splits into two counter-propagating waves, a foundational concept in tsunami science [@problem_id:3618013].", "problem": "A one-dimensional (1D) tsunami wave train in the deep ocean can be approximated by the linear shallow-water equations for a horizontally uniform depth. Consider an idealized, infinite 1D domain with constant depth and no boundaries, where the free-surface displacement $\\,\\eta(x,t)\\,$ and the depth-averaged horizontal velocity $\\,u(x,t)\\,$ satisfy the linear shallow-water system\n$$\\eta_{t}(x,t)+h\\,u_{x}(x,t)=0,\\qquad u_{t}(x,t)+g\\,\\eta_{x}(x,t)=0,$$\nwith constant depth $\\,h\\,$ and gravitational acceleration $\\,g\\,$. The water is initially at rest and the surface has a localized uplift:\n$$\\eta(x,0)=\\eta_{0}(x)=A\\,\\exp\\!\\left(-\\frac{(x-x_{0})^{2}}{2\\,\\sigma^{2}}\\right),\\qquad u(x,0)=0.$$\nStarting from these equations, derive the governing equation for $\\,\\eta(x,t)\\,$ and obtain the appropriate propagation solution for $\\,\\eta(x,t)\\,$ consistent with the given initial conditions, expressed in closed form in terms of $\\,\\eta_{0}\\,$. Then, for the parameter values $\\,A=1.5\\,$ meters, $\\,x_{0}=0\\,$ meters, $\\,\\sigma=3.0\\times 10^{4}\\,$ meters, $\\,h=4.0\\times 10^{3}\\,$ meters, and $\\,g=9.81\\,$ meters per second squared, evaluate $\\,\\eta(x,t)\\,$ at $\\,x=1.0\\times 10^{5}\\,$ meters and $\\,t=6.0\\times 10^{2}\\,$ seconds. Express the final displacement in meters and round your answer to four significant figures.", "solution": "The problem is valid as it is scientifically grounded, well-posed, and objective. It describes a standard initial value problem for the linear shallow-water equations, a fundamental model in geophysical fluid dynamics. All parameters and conditions are physically realistic and mathematically consistent.\n\nThe governing equations for the free-surface displacement $\\eta(x,t)$ and the depth-averaged horizontal velocity $u(x,t)$ are the linear shallow-water equations:\n$$ \\eta_{t}(x,t)+h\\,u_{x}(x,t)=0 \\quad (1) $$\n$$ u_{t}(x,t)+g\\,\\eta_{x}(x,t)=0 \\quad (2) $$\nwhere $h$ is the constant depth and $g$ is the gravitational acceleration. The subscripts denote partial differentiation.\n\nTo derive a single governing equation for $\\eta(x,t)$, we differentiate equation $(1)$ with respect to $t$ and equation $(2)$ with respect to $x$:\n$$ \\eta_{tt}+h\\,u_{xt}=0 \\quad (3) $$\n$$ u_{tx}+g\\,\\eta_{xx}=0 \\quad (4) $$\nAssuming $\\eta$ and $u$ are sufficiently smooth, the mixed partial derivatives are equal (Clairaut's theorem), i.e., $u_{xt}=u_{tx}$. We can substitute $u_{xt}$ from $(4)$ into $(3)$:\n$$ \\eta_{tt} - g h\\,\\eta_{xx} = 0 $$\nThis is the one-dimensional linear wave equation for $\\eta(x,t)$:\n$$ \\eta_{tt} = c^{2}\\eta_{xx} $$\nwhere the wave propagation speed is $c=\\sqrt{gh}$.\n\nThe general solution to this wave equation is given by d'Alembert's formula:\n$$ \\eta(x,t) = \\frac{1}{2}\\left[\\eta(x-ct,0) + \\eta(x+ct,0)\\right] + \\frac{1}{2c}\\int_{x-ct}^{x+ct} \\eta_{t}(s,0) \\,ds $$\nWe are given the initial conditions:\n$$ \\eta(x,0) = \\eta_{0}(x) = A\\,\\exp\\!\\left(-\\frac{(x-x_{0})^{2}}{2\\,\\sigma^{2}}\\right) $$\n$$ u(x,0) = 0 $$\nTo use d'Alembert's formula, we need the initial condition for $\\eta_t(x,0)$. From equation $(1)$, we have $\\eta_{t} = -h\\,u_{x}$. At $t=0$:\n$$ \\eta_{t}(x,0) = -h\\,u_{x}(x,0) $$\nSince $u(x,0)=0$ for all $x$, its spatial derivative must also be zero: $u_{x}(x,0)=0$. Therefore, the second initial condition is $\\eta_{t}(x,0)=0$.\n\nSubstituting the initial conditions $\\eta(x,0)=\\eta_{0}(x)$ and $\\eta_{t}(x,0)=0$ into d'Alembert's formula, the integral term vanishes, and the solution simplifies to:\n$$ \\eta(x,t) = \\frac{1}{2}\\left[\\eta_{0}(x-ct) + \\eta_{0}(x+ct)\\right] $$\nThis solution describes the initial Gaussian profile splitting into two identical waves, each with half the initial amplitude, propagating in opposite directions at speed $c$.\n\nSubstituting the specific form of $\\eta_{0}(x)$:\n$$ \\eta(x,t) = \\frac{A}{2}\\left[\\exp\\!\\left(-\\frac{(x-ct-x_{0})^{2}}{2\\,\\sigma^{2}}\\right) + \\exp\\!\\left(-\\frac{(x+ct-x_{0})^{2}}{2\\,\\sigma^{2}}\\right)\\right] $$\nNow, we evaluate this expression for the given parameter values:\n$A=1.5$ m\n$x_{0}=0$ m\n$\\sigma=3.0\\times 10^{4}$ m\n$h=4.0\\times 10^{3}$ m\n$g=9.81$ m/s$^{2}$\n$x=1.0\\times 10^{5}$ m\n$t=6.0\\times 10^{2}$ s\n\nFirst, calculate the wave speed $c$:\n$$ c = \\sqrt{gh} = \\sqrt{(9.81\\,\\text{m/s}^2)(4.0\\times 10^{3}\\,\\text{m})} = \\sqrt{39240} \\approx 198.090888\\,\\text{m/s} $$\nNext, calculate the term $ct$:\n$$ ct \\approx (198.090888\\,\\text{m/s})(6.0\\times 10^{2}\\,\\text{s}) \\approx 118854.5329\\,\\text{m} $$\nThe denominator in the exponent is $2\\sigma^2$:\n$$ 2\\sigma^{2} = 2(3.0\\times 10^{4}\\,\\text{m})^{2} = 2(9.0\\times 10^{8}\\,\\text{m}^2) = 1.8\\times 10^{9}\\,\\text{m}^2 $$\nThe solution with $x_0=0$ is:\n$$ \\eta(x,t) = \\frac{1.5}{2}\\left[\\exp\\!\\left(-\\frac{(x-ct)^{2}}{2\\sigma^{2}}\\right) + \\exp\\!\\left(-\\frac{(x+ct)^{2}}{2\\sigma^{2}}\\right)\\right] $$\nNow, evaluate the arguments of the exponential functions:\nFor the first term (right-propagating wave):\n$$ x-ct \\approx (1.0\\times 10^{5} - 118854.5329)\\,\\text{m} = -18854.5329\\,\\text{m} $$\n$$ -\\frac{(x-ct)^{2}}{2\\sigma^{2}} \\approx -\\frac{(-18854.5329)^{2}}{1.8\\times 10^{9}} \\approx -0.1974963 $$\nFor the second term (left-propagating wave):\n$$ x+ct \\approx (1.0\\times 10^{5} + 118854.5329)\\,\\text{m} = 218854.5329\\,\\text{m} $$\n$$ -\\frac{(x+ct)^{2}}{2\\sigma^{2}} \\approx -\\frac{(218854.5329)^{2}}{1.8\\times 10^{9}} \\approx -26.60964 $$\nNow substitute these into the expression for $\\eta(x,t)$:\n$$ \\eta(1.0\\times 10^5, 6.0\\times 10^2) \\approx \\frac{1.5}{2}\\left[\\exp(-0.1974963) + \\exp(-26.60964)\\right] $$\n$$ \\eta(1.0\\times 10^5, 6.0\\times 10^2) \\approx 0.75\\left[0.8207914 + 2.77 \\times 10^{-12}\\right] $$\nThe second exponential term is negligible.\n$$ \\eta(1.0\\times 10^5, 6.0\\times 10^2) \\approx 0.75 \\times 0.8207914 \\approx 0.61559355\\,\\text{m} $$\nRounding to four significant figures, the displacement is $0.6156$ meters.", "answer": "$$ \\boxed{0.6156} $$", "id": "3618013"}, {"introduction": "Moving from analytical solutions to numerical simulations introduces a critical practical constraint: numerical stability. Explicit time-stepping schemes, popular for their simplicity, are only stable if the time step, $\\Delta t$, is small enough to resolve the fastest-moving waves in the domain. This practice explores the Courant–Friedrichs–Lewy (CFL) condition in a more realistic setting with spatially varying bathymetry and currents, requiring you to determine the single global time step that ensures a stable simulation for the entire computational domain [@problem_id:3618044].", "problem": "Consider one-dimensional tsunami wave propagation over a shelf-to-deep-ocean transect modeled by the nonlinear shallow-water equations in conservative form, with horizontal coordinate $x \\in [0,L]$ and constant grid spacing $\\Delta x$. The domain length is $L = 2.0 \\times 10^{5}\\,\\mathrm{m}$, and the grid spacing is $\\Delta x = 2.0 \\times 10^{3}\\,\\mathrm{m}$. The gravitational acceleration is $g = 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$. The still-water depth varies linearly from shelf to deep ocean as $h(x) = h_{0} + \\alpha x$, where $h_{0} = 50\\,\\mathrm{m}$ and $\\alpha = \\dfrac{4000 - 50}{L}\\,\\mathrm{m}\\,\\mathrm{m}^{-1}$. A background current is present, $u(x) = u_{0} + \\beta x$, with $u_{0} = 0.2\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$ and $\\beta = \\dfrac{1.0 - 0.2}{L}\\,\\mathrm{(m\\,s^{-1})\\,m^{-1}}$, so that $u(L) = 1.0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$. Assume an explicit conservative finite-volume discretization with a single-step time integrator and numerical flux consistent with the characteristic signal speeds of the governing equations. The stability of such explicit schemes is controlled by the Courant–Friedrichs–Lewy (CFL) condition, with a chosen CFL number $C = 0.45$.\n\nStarting from the governing equations and the definition of characteristic wave propagation speeds, derive the local stability-limited timestep $\\Delta t(x)$ implied by the CFL criterion for this model. Then, analyze how $\\Delta t(x)$ varies across the spatially heterogeneous domain and determine the globally stable timestep $\\Delta t^{\\ast} = \\min_{x \\in [0,L]} \\Delta t(x)$ that must be used for the entire simulation. Express the final numerical value of $\\Delta t^{\\ast}$ in seconds and round your answer to four significant figures.", "solution": "The appropriate starting point is the one-dimensional nonlinear shallow-water system in conservative variables. Denote the conserved state vector by $\\boldsymbol{q} = \\begin{pmatrix} h \\\\ m \\end{pmatrix}$, where $h$ is the fluid depth and $m = h u$ is the depth-integrated momentum. The flux vector is $\\boldsymbol{f}(\\boldsymbol{q}) = \\begin{pmatrix} m \\\\ \\dfrac{m^{2}}{h} + \\dfrac{1}{2} g h^{2} \\end{pmatrix}$. The conservation law reads\n$$\n\\partial_{t} \\boldsymbol{q} + \\partial_{x} \\boldsymbol{f}(\\boldsymbol{q}) = \\boldsymbol{0}.\n$$\nLinearizing about a local state $(h,u)$ yields a flux Jacobian $\\boldsymbol{A} = \\dfrac{\\partial \\boldsymbol{f}}{\\partial \\boldsymbol{q}}$ whose eigenvalues are the characteristic speeds of the system. A standard calculation gives\n$$\n\\lambda_{\\pm} = u \\pm \\sqrt{g h}.\n$$\nThese are the propagation speeds of nonlinear shallow-water gravity waves relative to the ground. For an explicit conservative finite-volume method with a single-step time integrator, the Courant–Friedrichs–Lewy (CFL) condition states that the timestep must be small enough that the fastest characteristic does not traverse more than a fraction $C$ of a cell in one step. With uniform grid spacing $\\Delta x$, this implies the local constraint\n$$\n\\Delta t(x) \\leq C \\,\\frac{\\Delta x}{\\max\\{|\\lambda_{+}(x)|,\\,|\\lambda_{-}(x)|\\}}.\n$$\nSince $\\sqrt{g h(x)} \\geq 0$ for $h(x) > 0$, and the two eigenvalues are symmetric about $u(x)$, it follows that\n$$\n\\max\\{|\\lambda_{+}(x)|,\\,|\\lambda_{-}(x)|\\} = |u(x)| + \\sqrt{g\\,h(x)}.\n$$\nTherefore, the local stability-limited timestep is\n$$\n\\Delta t(x) = C \\,\\frac{\\Delta x}{\\,|u(x)| + \\sqrt{g\\,h(x)}\\,}.\n$$\n\nWe are given $h(x) = h_{0} + \\alpha x$ with $h_{0} = 50\\,\\mathrm{m}$ and $\\alpha = \\dfrac{4000 - 50}{L}$, and $u(x) = u_{0} + \\beta x$ with $u_{0} = 0.2\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$ and $\\beta = \\dfrac{1.0 - 0.2}{L}$. The domain length is $L = 2.0 \\times 10^{5}\\,\\mathrm{m}$, the grid spacing is $\\Delta x = 2.0 \\times 10^{3}\\,\\mathrm{m}$, and $g = 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$. The CFL number is $C = 0.45$.\n\nFirst, compute $\\alpha$ and $\\beta$:\n$$\n\\alpha = \\frac{4000 - 50}{2.0 \\times 10^{5}} = \\frac{3950}{2.0 \\times 10^{5}} = 1.975 \\times 10^{-2}\\,\\mathrm{m}\\,\\mathrm{m}^{-1},\n$$\n$$\n\\beta = \\frac{1.0 - 0.2}{2.0 \\times 10^{5}} = \\frac{0.8}{2.0 \\times 10^{5}} = 4.0 \\times 10^{-6}\\,\\mathrm{(m\\,s^{-1})\\,m^{-1}}.\n$$\nThus, $h(x)$ and $u(x)$ increase linearly with $x$. Since $\\sqrt{g h(x)}$ is monotonically increasing in $h(x)$ and $|u(x)|$ is monotonically increasing in $u(x)$ for the given positive values, the denominator $|u(x)| + \\sqrt{g h(x)}$ increases with $x$, making $\\Delta t(x)$ a monotonically decreasing function of $x$. Consequently, the global minimum of $\\Delta t(x)$ occurs at the right boundary $x = L$.\n\nEvaluate the quantities at $x=L$:\n$$\nh(L) = h_{0} + \\alpha L = 50 + 1.975 \\times 10^{-2} \\times 2.0 \\times 10^{5} = 50 + 3950 = 4000\\,\\mathrm{m},\n$$\n$$\nu(L) = u_{0} + \\beta L = 0.2 + 4.0 \\times 10^{-6} \\times 2.0 \\times 10^{5} = 0.2 + 0.8 = 1.0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}.\n$$\nCompute the gravity wave speed at $x=L$:\n$$\nc(L) = \\sqrt{g\\,h(L)} = \\sqrt{9.81 \\times 4000} = \\sqrt{39240}.\n$$\nA high-accuracy evaluation gives\n$$\n\\sqrt{39240} \\approx 198.09089\\,\\mathrm{m}\\,\\mathrm{s}^{-1}.\n$$\nTherefore, the maximum local characteristic speed is\n$$\ns_{\\max}(L) = |u(L)| + c(L) \\approx 1.0 + 198.09089 = 199.09089\\,\\mathrm{m}\\,\\mathrm{s}^{-1}.\n$$\nThe globally stable timestep is then\n$$\n\\Delta t^{\\ast} = C \\,\\frac{\\Delta x}{s_{\\max}(L)} \\approx 0.45 \\times \\frac{2.0 \\times 10^{3}}{199.09089}\\,\\mathrm{s}.\n$$\nCompute the quotient:\n$$\n\\frac{2.0 \\times 10^{3}}{199.09089} \\approx 10.04566\\,\\mathrm{s},\n$$\nso\n$$\n\\Delta t^{\\ast} \\approx 0.45 \\times 10.04566 \\approx 4.52055\\,\\mathrm{s}.\n$$\nRounded to four significant figures and expressed in seconds, the global timestep is\n$$\n\\Delta t^{\\ast} \\approx 4.521\\,\\mathrm{s}.\n$$\n\nIn terms of variation across the domain, the local timestep $\\Delta t(x) = C \\,\\dfrac{\\Delta x}{\\,|u(x)| + \\sqrt{g\\,h(x)}\\,}$ decreases with $x$ because both $h(x)$ and $u(x)$ increase linearly. Near the shelf ($x \\approx 0$), the smaller depth yields a smaller gravity wave speed and thus a larger $\\Delta t(x)$; toward deep ocean ($x \\approx L$), the much larger depth produces a substantially larger $\\sqrt{g h}$, reducing $\\Delta t(x)$. Therefore, the most restrictive timestep arises in the deepest, fastest-flow portion of the domain, consistent with the monotonic analysis above.", "answer": "$$\\boxed{4.521}$$", "id": "3618044"}, {"introduction": "Advanced tsunami modeling often involves inverting observational data to infer unknown source characteristics. A critical challenge in this process is accounting for model bias—the systematic error that arises when an overly simplified model is used to interpret data generated by a more complex physical reality. This practice delves into this issue by having you quantify the bias that occurs when non-dispersive shallow-water equations are used to invert synthetic data generated by a more realistic, dispersive Boussinesq model, a crucial exercise in avoiding \"inverse crime\" and understanding model limitations [@problem_id:3618072].", "problem": "You are tasked with designing and implementing a program that quantifies modeling bias in tsunami wave propagation by avoiding inverse crime. Specifically, you must generate synthetic sea-surface elevation data using a weakly dispersive Boussinesq model and invert for an initial sea-surface displacement using the linearized Shallow-Water Equations (SWE), then compute an aggregate misfit norm across multiple observation stations.\n\nThe fundamental base for this problem is as follows. For linear long waves in constant depth, the linearized Shallow-Water Equations (SWE) reduce to the one-dimensional wave equation for the free-surface elevation $\\,\\eta(x,t)\\,$,\n$$\n\\eta_{tt}(x,t) \\;=\\; c^2\\,\\eta_{xx}(x,t),\n$$\nwhere $c = \\sqrt{g h}$ is the non-dispersive phase speed, $g$ is gravitational acceleration, and $h$ is uniform water depth. For a periodic domain and zero initial velocity, all spatial Fourier modes evolve as\n$$\n\\eta_k(x,t) \\;=\\; \\left[A_k \\cos(k x) + B_k \\sin(k x)\\right] \\cos\\!\\left(c\\,|k|\\,t\\right),\n$$\nwhere $A_k$ and $B_k$ are the Fourier cosine and sine coefficients of the initial displacement $\\eta_0(x) = \\eta(x,0)$, with $k$ the angular wavenumber.\n\nFor the weakly dispersive Boussinesq model, a commonly used linear dispersion relation modifies the SWE by reducing the angular frequency for higher wavenumbers. In this problem, the Boussinesq angular frequency is defined by\n$$\n\\omega_{\\mathrm{B}}^2(k) \\;=\\; \\frac{g h\\,k^2}{1 + \\frac{1}{3} h^2 k^2},\n$$\nwhich implies\n$$\n\\omega_{\\mathrm{B}}(k) \\;=\\; \\frac{c\\,|k|}{\\sqrt{1 + \\frac{1}{3} h^2 k^2}}.\n$$\nUnder zero initial velocity, the Boussinesq time evolution is then\n$$\n\\eta^{\\mathrm{true}}(x,t) \\;=\\; \\sum_{k} \\hat{\\eta}_0(k)\\,\\cos\\!\\left(\\omega_{\\mathrm{B}}(k)\\,t\\right)\\,e^{i k x},\n$$\nwhere $\\hat{\\eta}_0(k)$ are the complex Fourier coefficients of the true initial displacement $\\eta_0(x)$ in a periodic domain.\n\nYour program must proceed as follows:\n\n1. Domain and initial condition.\n   - Consider a one-dimensional periodic domain of length $L$ discretized with $N$ uniformly spaced points. Use angular wavenumbers $k_n = 2\\pi n/L$ for integer $n$ given by the discrete Fourier transform convention.\n   - Construct a physically plausible initial sea-surface displacement $\\eta_0(x)$ as a superposition of two Gaussian humps:\n     $$\n     \\eta_0(x) \\;=\\; A_1 \\exp\\!\\left(-\\frac{(x-x_1)^2}{2\\,\\sigma_1^2}\\right) \\;+\\; A_2 \\exp\\!\\left(-\\frac{(x-x_2)^2}{2\\,\\sigma_2^2}\\right),\n     $$\n     where $A_1$ and $A_2$ are amplitudes in meters, $x_1$ and $x_2$ are centers in meters, and $\\sigma_1$ and $\\sigma_2$ are standard deviations in meters.\n\n2. Data generation with the Boussinesq model.\n   - Define $S$ station positions $\\{x_s\\}_{s=1}^S$ aligned to grid points and a uniform time grid $\\{t_n\\}_{n=0}^{M-1}$ with time step $\\Delta t$.\n   - Generate synthetic “true” sea-surface elevation time series at stations, $\\eta^{\\mathrm{true}}(x_s,t_n)$, by evolving the initial condition with the Boussinesq dispersion relation as given above. Use discrete Fourier transforms to implement the periodic spectral evolution in time.\n\n3. Inversion with the Shallow-Water Equations (SWE).\n   - Invert the synthetic data to estimate a band-limited initial displacement using the linearized SWE model. Parametrize the estimated initial displacement in a truncated real Fourier series up to wavenumber index $K_{\\max}$:\n     $$\n     \\eta_0^{\\mathrm{inv}}(x) \\;=\\; a_0 \\;+\\; \\sum_{k=1}^{K_{\\max}} \\left[a_k \\cos\\!\\left(\\frac{2\\pi k}{L} x\\right) + b_k \\sin\\!\\left(\\frac{2\\pi k}{L} x\\right)\\right],\n     $$\n     with unknown real coefficients $\\{a_0, a_k, b_k\\}$.\n   - Under the SWE model and zero initial velocity, the predicted station time series are\n     $$\n     \\eta^{\\mathrm{SWE}}(x_s,t_n) \\;=\\; a_0 \\;+\\; \\sum_{k=1}^{K_{\\max}} \\left[a_k \\cos\\!\\left(\\frac{2\\pi k}{L} x_s\\right) + b_k \\sin\\!\\left(\\frac{2\\pi k}{L} x_s\\right)\\right] \\cos\\!\\left(c\\,\\frac{2\\pi k}{L}\\,t_n\\right).\n     $$\n   - Collect all station-time pairs into a linear least-squares system and solve for the coefficients $\\{a_0, a_k, b_k\\}$ that minimize the sum of squared differences between $\\eta^{\\mathrm{SWE}}(x_s,t_n)$ and $\\eta^{\\mathrm{true}}(x_s,t_n)$.\n\n4. Bias quantification.\n   - Define the aggregate bias norm across stations and times as the root-mean-square (RMS) difference\n     $$\n     \\|\\eta_{\\mathrm{true}} - \\eta_{\\mathrm{inv}}\\| \\;=\\; \\sqrt{\\frac{1}{S\\,M}\\sum_{s=1}^S \\sum_{n=0}^{M-1} \\left[\\eta^{\\mathrm{true}}(x_s,t_n) - \\eta^{\\mathrm{SWE}}(x_s,t_n)\\right]^2 }.\n     $$\n   - Express the bias norm in meters as a floating-point number.\n\nYour program should implement the above steps and evaluate the bias norm for the following three test cases. Each test case comprises physically meaningful parameters that vary the degree of dispersion and the inversion subspace to test different facets of the problem.\n\nTest Suite:\n- Case 1 (baseline, adequate bandwidth):\n  - $L = 200{,}000$ meters, $N = 1024$.\n  - $h = 4{,}000$ meters, $g = 9.81$ meters per second squared.\n  - Initial condition: $A_1 = 1.0$ meters, $x_1 = 50{,}000$ meters, $\\sigma_1 = 5{,}000$ meters; $A_2 = 0.5$ meters, $x_2 = 150{,}000$ meters, $\\sigma_2 = 8{,}000$ meters.\n  - Stations: $S = 5$ at $x_s \\in \\{20{,}000, 60{,}000, 100{,}000, 140{,}000, 180{,}000\\}$ meters.\n  - Time grid: $M = 256$, $\\Delta t = 2.0$ seconds.\n  - Truncation: $K_{\\max} = 16$.\n\n- Case 2 (underparameterized inversion subspace):\n  - Same as Case 1, except $K_{\\max} = 4$.\n\n- Case 3 (narrower source, deeper water, more samples):\n  - $L = 200{,}000$ meters, $N = 2048$.\n  - $h = 6{,}000$ meters, $g = 9.81$ meters per second squared.\n  - Initial condition: $A_1 = 1.0$ meters, $x_1 = 50{,}000$ meters, $\\sigma_1 = 2{,}000$ meters; $A_2 = 0.6$ meters, $x_2 = 150{,}000$ meters, $\\sigma_2 = 3{,}000$ meters.\n  - Stations: $S = 6$ at $x_s \\in \\{20{,}000, 50{,}000, 80{,}000, 110{,}000, 140{,}000, 170{,}000\\}$ meters.\n  - Time grid: $M = 400$, $\\Delta t = 1.5$ seconds.\n  - Truncation: $K_{\\max} = 24$.\n\nFinal Output Format:\n- Your program should produce a single line of output containing the three bias norms, each in meters, as a comma-separated list enclosed in square brackets (for example, [result1,result2,result3]), with each result expressed as a float. No additional text should be printed.\n\nAll physical quantities must be treated in their correct International System of Units (SI units). All angles in trigonometric functions are in radians. The bias norm must be reported in meters.", "solution": "The problem requires the quantification of modeling bias that arises when inverting synthetic tsunami data. The data are generated using a physically more complex, weakly dispersive Boussinesq model, while the inversion is performed using a simpler, non-dispersive linearized Shallow-Water Equations (SWE) model. This procedure, which avoids \"inverse crime\" (using the same model for data generation and inversion), provides a measure of the systematic error, or bias, inherent in the simpler inversion model. The solution is implemented by following a four-step process for each test case.\n\n### 1. Synthetic Data Generation: The Boussinesq Forward Model\n\nThe first step is to generate synthetic \"true\" sea-surface elevation data, $\\eta^{\\mathrm{true}}(x, t)$. This is achieved by numerically solving the Boussinesq model equations for a given initial sea-surface displacement, $\\eta_0(x)$.\n\nThe problem is defined on a one-dimensional periodic domain of length $L$, discretized into $N$ grid points $x_j = j L/N$ for $j = 0, 1, \\dots, N-1$. The initial condition $\\eta_0(x)$ is given as a superposition of two Gaussian functions:\n$$\n\\eta_0(x) = A_1 \\exp\\left(-\\frac{(x-x_1)^2}{2\\sigma_1^2}\\right) + A_2 \\exp\\left(-\\frac{(x-x_2)^2}{2\\sigma_2^2}\\right)\n$$\nThe evolution of the wavefield is most efficiently computed in the spectral domain using the Discrete Fourier Transform (DFT). First, the complex Fourier coefficients, $\\hat{\\eta}_0(k_n)$, of the initial condition $\\eta_0(x_j)$ are computed:\n$$\n\\hat{\\eta}_0(k_n) = \\mathcal{F}[\\eta_0(x)]\n$$\nwhere $\\mathcal{F}$ denotes the DFT, and $k_n = 2\\pi n/L$ are the angular wavenumbers corresponding to the discrete grid.\n\nThe Boussinesq model is characterized by its dispersion relation, which relates the angular frequency $\\omega_{\\mathrm{B}}$ to the wavenumber $k$:\n$$\n\\omega_{\\mathrm{B}}(k) = \\frac{c|k|}{\\sqrt{1 + \\frac{1}{3}h^2 k^2}}\n$$\nwhere $c = \\sqrt{gh}$ is the shallow-water wave speed, $g$ is the acceleration due to gravity, and $h$ is the water depth. For a zero initial velocity field, each Fourier mode evolves in time as $\\cos(\\omega_{\\mathrm{B}}(k)t)$. Thus, the Fourier coefficients at time $t$ are given by:\n$$\n\\hat{\\eta}(k, t) = \\hat{\\eta}_0(k) \\cos(\\omega_{\\mathrm{B}}(k)t)\n$$\nThe sea-surface elevation in physical space, $\\eta(x, t)$, is then recovered by applying the inverse DFT:\n$$\n\\eta^{\\mathrm{true}}(x, t) = \\mathcal{F}^{-1}[\\hat{\\eta}(k, t)]\n$$\nThis calculation is performed for each time step $t_n$ in the specified time grid $\\{t_n\\}_{n=0}^{M-1}$. The resulting wavefield is then sampled at the specified station locations $\\{x_s\\}_{s=1}^S$ to produce the synthetic time series data, which we denote as a data vector $\\mathbf{d}$ of length $S \\times M$.\n\n### 2. Inversion for Initial Conditions: The SWE Inverse Model\n\nThe second step is to use the generated data $\\mathbf{d}$ to infer the initial sea-surface displacement, but this time using the simpler linearized SWE model. The initial displacement is parameterized by a truncated real Fourier series with $1 + 2K_{\\max}$ unknown coefficients, $\\mathbf{m} = [a_0, a_1, b_1, \\dots, a_{K_{\\max}}, b_{K_{\\max}}]^T$:\n$$\n\\eta_0^{\\mathrm{inv}}(x) = a_0 + \\sum_{k=1}^{K_{\\max}} \\left[a_k \\cos\\left(\\frac{2\\pi k}{L} x\\right) + b_k \\sin\\left(\\frac{2\\pi k}{L} x\\right)\\right]\n$$\nUnder the SWE model, the dispersion relation is non-dispersive: $\\omega_{\\mathrm{SWE}}(k) = c|k|$. The time evolution of the parameterized initial condition at a station location $x_s$ and time $t_n$ is:\n$$\n\\eta^{\\mathrm{SWE}}(x_s, t_n) = a_0 + \\sum_{j=1}^{K_{\\max}} \\left[ a_j \\cos\\left(k_j x_s\\right) + b_j \\sin\\left(k_j x_s\\right) \\right] \\cos\\left(c k_j t_n\\right)\n$$\nwhere $k_j = 2\\pi j/L$. This equation establishes a linear relationship between the predicted data at all station-time pairs, $\\mathbf{d}_{\\mathrm{pred}}$, and the unknown model coefficients $\\mathbf{m}$:\n$$\n\\mathbf{d}_{\\mathrm{pred}} = \\mathbf{G}\\mathbf{m}\n$$\nHere, $\\mathbf{G}$ is the design matrix (or forward operator) of size $(S \\times M) \\times (1 + 2K_{\\max})$. Each row of $\\mathbf{G}$ corresponds to a specific station-time pair $(x_s, t_n)$, and its entries are the basis functions evaluated at that pair. Specifically, for a row corresponding to $(x_s, t_n)$:\n-   The first column (for coefficient $a_0$) is $1$.\n-   For $j=1, \\dots, K_{\\max}$, the column for $a_j$ is $\\cos(k_j x_s) \\cos(c k_j t_n)$.\n-   For $j=1, \\dots, K_{\\max}$, the column for $b_j$ is $\\sin(k_j x_s) \\cos(c k_j t_n)$.\n\n### 3. Solving the Linear System\n\nThe inverse problem consists of finding the model vector $\\mathbf{m}$ that best fits the synthetic data $\\mathbf{d}$. This is formulated as a linear least-squares problem:\n$$\n\\min_{\\mathbf{m}} \\|\\mathbf{G}\\mathbf{m} - \\mathbf{d}\\|_2^2\n$$\nwhere $\\|\\cdot\\|_2$ is the Euclidean norm. For the given test cases, the system is overdetermined ($S \\times M > 1 + 2K_{\\max}$), ensuring a stable and unique solution. The solution $\\mathbf{m}_{\\mathrm{inv}}$ is found using standard numerical linear algebra routines, such as those provided by `numpy.linalg.lstsq`.\n\n### 4. Quantifying the Modeling Bias\n\nThe modeling bias is the discrepancy between the \"true\" data and the best-fit data from the simpler model. The predicted data from the inverted coefficients is $\\mathbf{d}_{\\mathrm{inv}} = \\mathbf{G}\\mathbf{m}_{\\mathrm{inv}}$. The misfit is quantified by the root-mean-square (RMS) of the residuals, $r_i = d_i - d_{\\mathrm{inv},i}$:\n$$\n\\|\\eta_{\\mathrm{true}} - \\eta_{\\mathrm{inv}}\\| = \\sqrt{\\frac{1}{S M} \\sum_{i=1}^{S \\times M} (d_i - d_{\\mathrm{inv},i})^2}\n$$\nThis quantity is the square root of the mean of the squared residuals. The sum of squared residuals, $\\sum r_i^2$, is a direct output of the `numpy.linalg.lstsq` function, which allows for an efficient computation of the final bias norm in meters. The entire procedure is repeated for each of the three test cases provided.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_bias_norm(L, N, h, g, ic_params, station_locs, M, dt, K_max):\n    \"\"\"\n    Calculates the modeling bias norm for a single test case.\n\n    Args:\n        L (float): Length of the periodic domain in meters.\n        N (int): Number of grid points for spatial discretization.\n        h (float): Uniform water depth in meters.\n        g (float): Gravitational acceleration in m/s^2.\n        ic_params (tuple): Parameters for the initial condition (A1, x1, s1, A2, x2, s2).\n        station_locs (list): List of station locations in meters.\n        M (int): Number of time steps.\n        dt (float): Time step size in seconds.\n        K_max (int): Truncation wavenumber index for the inversion.\n\n    Returns:\n        float: The calculated aggregate bias norm in meters.\n    \"\"\"\n    # Unpack initial condition parameters\n    A1, x1, sigma1, A2, x2, sigma2 = ic_params\n    S = len(station_locs)\n\n    # Step 1: Define domain and construct initial condition\n    x_grid = np.linspace(0, L, N, endpoint=False)\n    eta0 = (A1 * np.exp(-(x_grid - x1)**2 / (2 * sigma1**2)) +\n            A2 * np.exp(-(x_grid - x2)**2 / (2 * sigma2**2)))\n\n    # Step 2: Generate \"true\" data using the Boussinesq model\n    eta0_hat = np.fft.fft(eta0)\n    k_vec = 2 * np.pi * np.fft.fftfreq(N, d=L / N)\n    \n    # Boussinesq angular frequency. This is numerically stable for k=0.\n    k_vec_sq = k_vec**2\n    omega_B_sq = (g * h * k_vec_sq) / (1 + (h**2 * k_vec_sq) / 3.0)\n    omega_B = np.sqrt(omega_B_sq)\n\n    t_grid = np.arange(M) * dt\n    \n    # Find grid indices for station locations\n    dx = L / N\n    station_indices = np.round(np.array(station_locs) / dx).astype(int)\n\n    eta_true_at_stations = np.zeros((S, M), dtype=float)\n    for i, tn in enumerate(t_grid):\n        # Evolve spectrum in time\n        eta_hat_t = eta0_hat * np.cos(omega_B * tn)\n        # Inverse FFT to get physical space solution\n        eta_t = np.fft.ifft(eta_hat_t).real\n        # Sample at station locations\n        eta_true_at_stations[:, i] = eta_t[station_indices]\n\n    # Step 3: Invert data using the Shallow-Water Equations (SWE) model\n    # 3a. Construct the linear system G*m = d\n    d_vec = eta_true_at_stations.flatten()\n    \n    num_data_points = S * M\n    num_model_params = 1 + 2 * K_max\n    \n    G = np.zeros((num_data_points, num_model_params))\n    \n    # Generate coordinate vectors for all (station, time) data points\n    t_coords = np.tile(t_grid, S)\n    x_coords = np.repeat(np.array(station_locs), M)\n    \n    # Column for a_0 (DC offset coefficient)\n    G[:, 0] = 1.0\n    \n    c = np.sqrt(g * h) # SWE phase speed\n\n    # Columns for a_k and b_k coefficients\n    for k_idx in range(1, K_max + 1):\n        wavenumber = 2 * np.pi * k_idx / L\n        \n        spatial_cos = np.cos(wavenumber * x_coords)\n        spatial_sin = np.sin(wavenumber * x_coords)\n        temporal_cos = np.cos(c * wavenumber * t_coords)\n        \n        # Column for a_k\n        G[:, 2 * k_idx - 1] = spatial_cos * temporal_cos\n        # Column for b_k\n        G[:, 2 * k_idx] = spatial_sin * temporal_cos\n        \n    # 3b. Solve the least-squares problem\n    _, residuals_sum_sq_array, _, _ = np.linalg.lstsq(G, d_vec, rcond=None)\n    \n    # Step 4: Quantify the modeling bias\n    if residuals_sum_sq_array.size > 0:\n        residuals_sum_sq = residuals_sum_sq_array[0]\n    else:\n        # Fallback for non-overdetermined systems (not expected here)\n        m_inv = np.linalg.lstsq(G, d_vec, rcond=None)[0]\n        d_pred = G @ m_inv\n        residuals_sum_sq = np.sum((d_vec - d_pred)**2)\n        \n    mean_squared_error = residuals_sum_sq / num_data_points\n    bias_norm = np.sqrt(mean_squared_error)\n    \n    return bias_norm\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (baseline, adequate bandwidth)\n        {\n            'L': 200000.0, 'N': 1024, 'h': 4000.0, 'g': 9.81,\n            'ic_params': (1.0, 50000.0, 5000.0, 0.5, 150000.0, 8000.0),\n            'station_locs': [20000.0, 60000.0, 100000.0, 140000.0, 180000.0],\n            'M': 256, 'dt': 2.0, 'K_max': 16\n        },\n        # Case 2 (underparameterized inversion subspace)\n        {\n            'L': 200000.0, 'N': 1024, 'h': 4000.0, 'g': 9.81,\n            'ic_params': (1.0, 50000.0, 5000.0, 0.5, 150000.0, 8000.0),\n            'station_locs': [20000.0, 60000.0, 100000.0, 140000.0, 180000.0],\n            'M': 256, 'dt': 2.0, 'K_max': 4\n        },\n        # Case 3 (narrower source, deeper water, more samples)\n        {\n            'L': 200000.0, 'N': 2048, 'h': 6000.0, 'g': 9.81,\n            'ic_params': (1.0, 50000.0, 2000.0, 0.6, 150000.0, 3000.0),\n            'station_locs': [20000.0, 50000.0, 80000.0, 110000.0, 140000.0, 170000.0],\n            'M': 400, 'dt': 1.5, 'K_max': 24\n        },\n    ]\n\n    results = []\n    for params in test_cases:\n        bias_norm = calculate_bias_norm(**params)\n        results.append(bias_norm)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3618072"}]}