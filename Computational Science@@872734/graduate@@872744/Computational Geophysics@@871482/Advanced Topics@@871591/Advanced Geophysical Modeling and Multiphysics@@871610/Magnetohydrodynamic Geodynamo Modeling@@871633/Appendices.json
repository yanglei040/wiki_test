{"hands_on_practices": [{"introduction": "The first step in analyzing any complex physical system is to understand the relative importance of the various forces at play. This practice guides you through the fundamental process of non-dimensionalizing the rotating MHD equations, which form the basis of geodynamo theory [@problem_id:3608743]. By scaling the equations appropriately, you will derive the key dimensionless numbers that govern the dynamics of Earth's core and learn how to classify the system's behavior into distinct physical regimes, such as geostrophic or magnetostrophic balance.", "problem": "You are tasked with deriving and then programmatically evaluating non-dimensional groups that arise in the incompressible, rotating magnetohydrodynamic geodynamo equations in a spherical shell under the Boussinesq approximation. Begin from fundamental conservation laws and definitions, and design a computation that produces diagnostic dimensionless numbers and regime classifications for multiple parameter sets.\n\nGiven the following dimensional governing equations for an incompressible, electrically conducting fluid of constant density inside a rotating spherical shell:\n\n- Momentum conservation (in a frame rotating at angular frequency $\\Omega$ about a fixed axis):\n$$\n\\rho\\left(\\frac{\\partial \\mathbf{u}}{\\partial t} + \\mathbf{u}\\cdot\\nabla \\mathbf{u} + 2\\,\\boldsymbol{\\Omega}\\times \\mathbf{u}\\right)\n= -\\nabla p + \\rho \\alpha g T' \\,\\hat{\\mathbf{r}} + \\frac{1}{\\mu_0}(\\nabla\\times \\mathbf{B}) \\times \\mathbf{B} + \\rho \\nu \\nabla^2 \\mathbf{u},\n$$\nwhere $\\rho$ is density, $\\mathbf{u}$ is velocity, $t$ is time, $\\boldsymbol{\\Omega}$ is the rotation vector of magnitude $\\Omega$, $p$ is pressure, $\\alpha$ is the thermal expansion coefficient, $g$ is the gravitational acceleration magnitude, $T'$ is the temperature perturbation, $\\hat{\\mathbf{r}}$ is the radial unit vector, $\\mu_0$ is the magnetic permeability of free space, $\\mathbf{B}$ is magnetic flux density, and $\\nu$ is the kinematic viscosity.\n\n- Induction equation:\n$$\n\\frac{\\partial \\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{u}\\times \\mathbf{B}) + \\eta \\nabla^2 \\mathbf{B},\n$$\nwith magnetic diffusivity $\\eta$.\n\n- Thermal equation for perturbation temperature (linearized Boussinesq form):\n$$\n\\frac{\\partial T'}{\\partial t} + \\mathbf{u}\\cdot \\nabla T' + u_r \\frac{\\mathrm{d} \\bar{T}}{\\mathrm{d} r} = \\kappa \\nabla^2 T',\n$$\nwith thermal diffusivity $\\kappa$, mean background temperature $\\bar{T}$, and radial velocity $u_r$. Assume a fixed temperature contrast $\\Delta T$ across the shell thickness.\n\n- Solenoidal constraints:\n$$\n\\nabla \\cdot \\mathbf{u} = 0,\\quad \\nabla\\cdot \\mathbf{B} = 0.\n$$\n\nNon-dimensionalize these equations using the shell thickness as the characteristic length scale $L$, a characteristic speed $U$, the rotation time scale $1/\\Omega$, magnetic field scale $B_0$, and temperature scale $\\Delta T$. Carefully identify each emergent dimensionless group from first principles. The expected non-dimensional groups to be expressed and then computed are:\n- Ekman number $\\mathrm{E}$,\n- Magnetic Prandtl number $\\mathrm{Pm}$,\n- Rayleigh number $\\mathrm{Ra}$,\n- Rossby number $\\mathrm{Ro}$,\n- Magnetic Reynolds number $\\mathrm{Rm}$,\n- Elsasser number $\\Lambda$.\n\nAll quantities and parameters are to be expressed in the International System of Units (SI): meters, kilograms, seconds, kelvin, tesla. Your final program must compute the six non-dimensional numbers for each test case using your derived definitions and must classify the dominant force balance regime using the following logic:\n- Inertia-dominated (code $2$): if $\\mathrm{Ro} \\geq 1$.\n- Magnetostrophic (code $1$): if $\\mathrm{Ro} < 0.1$, $\\mathrm{E} < 10^{-4}$, and $0.1 \\le \\Lambda \\le 10$.\n- Geostrophic (code $0$): if $\\mathrm{Ro} < 0.1$, $\\mathrm{E} < 10^{-4}$, and $\\Lambda < 0.1$.\nIf a case does not satisfy any of the above, you may assume it is transitional; however, the provided test suite is chosen to avoid transitional classification.\n\nDesign parameter sweeps that emphasize changes in a single target non-dimensional group, subject to unavoidable algebraic couplings inherent to the definitions. Use the following parameter sets (test suite), each provided as a tuple\n$$\n(L,\\ \\rho,\\ \\Omega,\\ \\nu,\\ \\eta,\\ \\kappa,\\ \\alpha,\\ g,\\ \\Delta T,\\ U,\\ B_0),\n$$\nin SI units:\n- Case $1$ (geostrophic baseline): $(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-6},\\ 8\\times 10^{-1},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 1\\times 10^{-4})$.\n- Case $2$ (magnetostrophic via $\\Lambda$ increase): $(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-6},\\ 8\\times 10^{-1},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 2\\times 10^{-3})$.\n- Case $3$ (inertia-dominated via $\\mathrm{Ro}$ increase with slow rotation): $(1\\times 10^{5},\\ 7\\times 10^{3},\\ 1\\times 10^{-6},\\ 1\\times 10^{-6},\\ 8\\times 10^{-1},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-1},\\ 1\\times 10^{-4})$.\n- Case $4$ (Ekman sweep via $\\nu$ increase): $(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-3},\\ 8\\times 10^{-1},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 1\\times 10^{-4})$.\n- Case $5$ (magnetic Prandtl sweep via $\\eta$ decrease): $(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-6},\\ 8\\times 10^{-2},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 1\\times 10^{-4})$.\n- Case $6$ (zero Elsasser via $B_0 = 0$): $(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-6},\\ 8\\times 10^{-1},\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 0)$.\n- Case $7$ (low magnetic Reynolds via large $\\eta$): $(2.2\\times 10^{6},\\ 1.1\\times 10^{4},\\ 7.292\\times 10^{-5},\\ 1\\times 10^{-6},\\ 8,\\ 1\\times 10^{-5},\\ 1\\times 10^{-5},\\ 1\\times 10^{1},\\ 1\\times 10^{3},\\ 2\\times 10^{-4},\\ 1\\times 10^{-4})$.\n\nYour program must, for each case, compute the six non-dimensional numbers and the regime code, and then output a single line string representing a list of seven sublists. Each sublist must contain the six numbers followed by the integer regime code, in the order\n$$\n[\\mathrm{E},\\ \\mathrm{Pm},\\ \\mathrm{Ra},\\ \\mathrm{Ro},\\ \\mathrm{Rm},\\ \\Lambda,\\ \\text{code}],\n$$\nwith each floating-point value rendered to exactly six significant figures. The output must contain no spaces. For example, a valid overall output format is\n$$\n[[x_{11},x_{12},\\dots,x_{17}],[x_{21},x_{22},\\dots,x_{27}],\\dots,[x_{71},x_{72},\\dots,x_{77}]].\n$$\n\nAll outputs are unitless. Angles, if any were used, must be in radians; however, there are no angles in the required outputs.\n\nYour implementation must be a complete, runnable program that uses only the specified libraries and prints exactly one line in the specified format.", "solution": "The problem requires the derivation and computation of six key dimensionless numbers in magnetohydrodynamics (MHD) for geodynamo modeling, followed by a classification of the dynamical regime. This process begins by non-dimensionalizing the governing equations of an incompressible, electrically conducting fluid in a rotating frame under the Boussinesq approximation.\n\nThe governing equations are provided for momentum, magnetic field (induction), and temperature, along with solenoidal constraints. We will non-dimensionalize these equations using the characteristic scales provided:\n- Length: $L$ (shell thickness)\n- Velocity: $U$ (a characteristic speed)\n- Time: $1/\\Omega$ (inverse of the rotation rate)\n- Magnetic Field: $B_0$ (a characteristic field strength)\n- Temperature Perturbation: $\\Delta T$ (a characteristic temperature contrast)\n\nWe define dimensionless variables (denoted with a hat) as follows:\n$$ \\hat{\\mathbf{r}} = \\frac{\\mathbf{r}}{L}, \\quad \\hat{t} = t\\Omega, \\quad \\hat{\\mathbf{u}} = \\frac{\\mathbf{u}}{U}, \\quad \\hat{\\mathbf{B}} = \\frac{\\mathbf{B}}{B_0}, \\quad \\hat{T'} = \\frac{T'}{\\Delta T} $$\nThe spatial derivative operator scales as $\\nabla = \\frac{1}{L}\\hat{\\nabla}$. The pressure is scaled based on a geostrophic balance, where the pressure gradient balances the Coriolis force: $p_0 = \\rho_0 \\Omega U L$. Thus, $\\hat{p} = p/p_0$.\n\n**1. Non-dimensionalization of the Momentum Equation**\n\nThe dimensional momentum equation is:\n$$\n\\rho\\left(\\frac{\\partial \\mathbf{u}}{\\partial t} + \\mathbf{u}\\cdot\\nabla \\mathbf{u} + 2\\,\\boldsymbol{\\Omega}\\times \\mathbf{u}\\right)\n= -\\nabla p + \\rho \\alpha g T' \\,\\hat{\\mathbf{r}} + \\frac{1}{\\mu_0}(\\nabla\\times \\mathbf{B}) \\times \\mathbf{B} + \\rho \\nu \\nabla^2 \\mathbf{u}\n$$\nSubstituting the scaled variables and their corresponding dimensional scales:\n$$\n\\rho\\left(U\\Omega \\frac{\\partial \\hat{\\mathbf{u}}}{\\partial \\hat{t}} + \\frac{U^2}{L} \\hat{\\mathbf{u}}\\cdot\\hat{\\nabla} \\hat{\\mathbf{u}} + 2\\Omega U (\\hat{\\mathbf{z}}\\times \\hat{\\mathbf{u}})\\right)\n= - \\frac{\\rho \\Omega U L}{L} \\hat{\\nabla} \\hat{p} + \\rho \\alpha g \\Delta T \\hat{T'} \\,\\hat{\\mathbf{r}} + \\frac{B_0^2}{\\mu_0 L}(\\hat{\\nabla}\\times \\hat{\\mathbf{B}}) \\times \\hat{\\mathbf{B}} + \\frac{\\rho \\nu U}{L^2} \\hat{\\nabla}^2 \\hat{\\mathbf{u}}\n$$\nWe normalize the equation by dividing all terms by the magnitude of the Coriolis force scale, $\\rho \\Omega U$:\n$$\n\\frac{\\partial \\hat{\\mathbf{u}}}{\\partial \\hat{t}} + \\left(\\frac{U}{\\Omega L}\\right) \\hat{\\mathbf{u}}\\cdot\\hat{\\nabla} \\hat{\\mathbf{u}} + 2(\\hat{\\mathbf{z}}\\times \\hat{\\mathbf{u}})\n= - \\hat{\\nabla} \\hat{p} + \\left(\\frac{\\alpha g \\Delta T}{\\Omega U}\\right) \\hat{T'} \\hat{\\mathbf{r}} + \\left(\\frac{B_0^2}{\\mu_0 \\rho \\Omega U L}\\right)(\\hat{\\nabla}\\times \\hat{\\mathbf{B}}) \\times \\hat{\\mathbf{B}} + \\left(\\frac{\\nu}{\\Omega L^2}\\right) \\hat{\\nabla}^2 \\hat{\\mathbf{u}}\n$$\nFrom the coefficients of the terms, we identify two dimensionless numbers directly:\n- The **Rossby number**, $\\mathrm{Ro}$, is the coefficient of the inertial term, representing the ratio of inertial to Coriolis forces: $\\mathrm{Ro} = \\frac{U}{\\Omega L}$.\n- The **Ekman number**, $\\mathrm{E}$, is the coefficient of the viscous term, representing the ratio of viscous to Coriolis forces: $\\mathrm{E} = \\frac{\\nu}{\\Omega L^2}$.\n\n**2. Non-dimensionalization of the Induction Equation**\n\nThe dimensional induction equation is:\n$$\n\\frac{\\partial \\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{u}\\times \\mathbf{B}) + \\eta \\nabla^2 \\mathbf{B}\n$$\nSubstituting the scaled variables:\n$$\nB_0 \\Omega \\frac{\\partial \\hat{\\mathbf{B}}}{\\partial \\hat{t}} = \\frac{U B_0}{L} \\hat{\\nabla} \\times (\\hat{\\mathbf{u}}\\times \\hat{\\mathbf{B}}) + \\frac{\\eta B_0}{L^2} \\hat{\\nabla}^2 \\hat{\\mathbf{B}}\n$$\nDividing by $B_0 \\Omega$:\n$$\n\\frac{\\partial \\hat{\\mathbf{B}}}{\\partial \\hat{t}} = \\left(\\frac{U}{\\Omega L}\\right) \\hat{\\nabla} \\times (\\hat{\\mathbf{u}}\\times \\hat{\\mathbf{B}}) + \\left(\\frac{\\eta}{\\Omega L^2}\\right) \\hat{\\nabla}^2 \\hat{\\mathbf{B}}\n$$\nThe coefficient of the induction term is the Rossby number, $\\mathrm{Ro}$. The coefficient of the magnetic diffusion term, $\\frac{\\eta}{\\Omega L^2}$, can be related to other numbers. By introducing the **Magnetic Reynolds number**, $\\mathrm{Rm} = \\frac{UL}{\\eta}$, which measures the ratio of magnetic field advection to magnetic diffusion, we can write the coefficient as $\\frac{\\eta}{UL} \\frac{U}{\\Omega L} = \\frac{\\mathrm{Ro}}{\\mathrm{Rm}}$.\n\n**3. Definitions of the Required Dimensionless Groups**\n\nBased on the above derivations and standard physical definitions, we establish the formulas for the six required numbers.\n\n- **Ekman number, E**: Ratio of viscous to Coriolis forces.\n$$ \\mathrm{E} = \\frac{\\nu}{\\Omega L^2} $$\n- **Magnetic Prandtl number, Pm**: Ratio of kinematic viscosity (momentum diffusivity) to magnetic diffusivity. It is a fluid property and does not emerge from scaling a single equation, but from comparing the two respective diffusion terms in the momentum and induction equations.\n$$ \\mathrm{Pm} = \\frac{\\nu}{\\eta} $$\n- **Rayleigh number, Ra**: Represents the ratio of buoyant driving forces to dissipative forces (viscous and thermal). Its standard definition, which is dimensionally consistent, is:\n$$ \\mathrm{Ra} = \\frac{\\alpha g \\Delta T L^3}{\\nu \\kappa} $$\n- **Rossby number, Ro**: Ratio of inertial to Coriolis forces.\n$$ \\mathrm{Ro} = \\frac{U}{\\Omega L} $$\n- **Magnetic Reynolds number, Rm**: Ratio of magnetic field advection to magnetic diffusion.\n$$ \\mathrm{Rm} = \\frac{UL}{\\eta} $$\n- **Elsasser number, $\\Lambda$**: Ratio of Lorentz forces to Coriolis forces. The standard definition in geodynamo theory, which we will use, incorporates magnetic diffusivity. The magnetic permeability of free space, $\\mu_0$, is taken as $4\\pi\\times 10^{-7} \\, \\mathrm{H/m}$.\n$$ \\Lambda = \\frac{B_0^2}{\\rho \\mu_0 \\eta \\Omega} $$\n\nThese formulas are implemented to compute the dimensionless numbers for each parameter set. The dynamical regime is then classified based on the provided thresholds for $\\mathrm{Ro}$, $\\mathrm{E}$, and $\\Lambda$.\n- **Inertia-dominated (code $2$)**: $\\mathrm{Ro} \\ge 1$.\n- **Magnetostrophic (code $1$)**: $\\mathrm{Ro} < 0.1$, $\\mathrm{E} < 10^{-4}$, and $0.1 \\le \\Lambda \\le 10$.\n- **Geostrophic (code $0$)**: $\\mathrm{Ro} < 0.1$, $\\mathrm{E} < 10^{-4}$, and $\\Lambda < 0.1$.\n\nThe algorithm will iterate through each test case, apply these definitions, determine the regime code, and format the output as a single-line string representing a list of lists, with each floating-point number formatted to six significant figures using scientific notation.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes non-dimensional groups for magnetohydrodynamic \n    geodynamo equations and classifies the dynamical regime.\n    \"\"\"\n    \n    # Fundamental constant: magnetic permeability of free space (H/m)\n    MU_0 = 4 * np.pi * 1e-7\n\n    # Each test case is a tuple:\n    # (L, rho, Omega, nu, eta, kappa, alpha, g, DeltaT, U, B0)\n    test_cases = [\n        # Case 1 (geostrophic baseline)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-6, 8e-1, 1e-5, 1e-5, 10, 1e3, 2e-4, 1e-4),\n        # Case 2 (magnetostrophic via Lambda increase)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-6, 8e-1, 1e-5, 1e-5, 10, 1e3, 2e-4, 2e-3),\n        # Case 3 (inertia-dominated via Ro increase)\n        (1e5, 7e3, 1e-6, 1e-6, 8e-1, 1e-5, 1e-5, 10, 1e3, 2e-1, 1e-4),\n        # Case 4 (Ekman sweep via nu increase)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-3, 8e-1, 1e-5, 1e-5, 10, 1e3, 2e-4, 1e-4),\n        # Case 5 (magnetic Prandtl sweep via eta decrease)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-6, 8e-2, 1e-5, 1e-5, 10, 1e3, 2e-4, 1e-4),\n        # Case 6 (zero Elsasser via B0 = 0)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-6, 8e-1, 1e-5, 1e-5, 10, 1e3, 2e-4, 0),\n        # Case 7 (low magnetic Reynolds via large eta)\n        (2.2e6, 1.1e4, 7.292e-5, 1e-6, 8.0, 1e-5, 1e-5, 10, 1e3, 2e-4, 1e-4),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        L, rho, Omega, nu, eta, kappa, alpha, g, DeltaT, U, B0 = case\n\n        # Compute the six non-dimensional numbers\n        E = nu / (Omega * L**2)\n        Pm = nu / eta\n        Ra = (alpha * g * DeltaT * L**3) / (nu * kappa)\n        Ro = U / (Omega * L)\n        Rm = (U * L) / eta\n        \n        # Handle B0=0 case for Lambda to avoid division by zero if rho, eta or Omega is zero (not in tests)\n        if B0 == 0:\n            Lambda = 0.0\n        else:\n            Lambda = B0**2 / (rho * MU_0 * eta * Omega)\n\n        # Classify the regime\n        code = -1 # Default/transitional, though problem states this won't happen\n        if Ro >= 1:\n            code = 2  # Inertia-dominated\n        elif Ro  0.1 and E  1e-4 and 0.1 = Lambda = 10:\n            code = 1  # Magnetostrophic\n        elif Ro  0.1 and E  1e-4 and Lambda  0.1:\n            code = 0  # Geostrophic\n\n        # Store results for this case\n        case_results = [E, Pm, Ra, Ro, Rm, Lambda, code]\n        all_results.append(case_results)\n\n    # Format the final output string\n    # Each float must be rendered to exactly six significant figures in scientific notation.\n    # The integer code is rendered as is.\n    output_sublists = []\n    for result_set in all_results:\n        formatted_floats = [f\"{v:.5e}\" for v in result_set[:6]]\n        code_str = str(result_set[6])\n        sublist_str = f\"[{','.join(formatted_floats + [code_str])}]\"\n        output_sublists.append(sublist_str)\n        \n    final_output_str = f\"[{','.join(output_sublists)}]\"\n    \n    print(final_output_str)\n\nsolve()\n```", "id": "3608743"}, {"introduction": "The engine of the geodynamo is the nonlinear interaction between the fluid flow and the magnetic field. In spectral models, which represent fields as sums of spherical harmonics, this nonlinearity manifests as a complex web of triadic interactions between modes. This exercise delves into the structure of these interactions, requiring you to implement the fundamental selection rules that determine which modes can couple and to analyze the computational scaling of the problem [@problem_id:3608698]. This provides crucial insight into the computational cost and complexity of spectral geodynamo simulations.", "problem": "You are modeling the spectral form of the magnetohydrodynamic induction equation for a geodynamo in a spherical shell. The nonlinear term in the induction equation couples spectral modes through triadic interactions. In a spectral truncation defined by maximum spherical harmonic degree and order, you will count all admissible triadic interactions under angular momentum coupling constraints and estimate computational scaling with truncation.\n\nStarting point: The induction equation is given by $\\,\\partial \\mathbf{B} / \\partial t = \\nabla \\times (\\mathbf{u} \\times \\mathbf{B}) + \\eta \\nabla^2 \\mathbf{B}\\,$, where $\\,\\mathbf{u}\\,$ is the velocity field, $\\,\\mathbf{B}\\,$ is the magnetic field, and $\\,\\eta\\,$ is the magnetic diffusivity. In a pseudospectral representation on the sphere using spherical harmonics, the product of fields induces a convolution in spectral space mediated by angular momentum coupling coefficients (Gaunt integrals or equivalently Wigner $\\,3j\\,$ symbols). For scalar spherical harmonics $\\,Y_{\\ell}^{m}\\,$, the following selection rules summarize when the triple integral of three spherical harmonics is nonzero (and the same constraints control which mode triplets can interact in the induction nonlinearity when expressed in a spherical harmonic basis of appropriate parity):\n\n- Triangle inequality on degrees: $\\,|\\ell_1 - \\ell_2| \\le L \\le \\ell_1 + \\ell_2\\,$.\n- Azimuthal order conservation: $\\,m_1 + m_2 = M\\,$.\n- Parity (evenness) constraint: $\\,\\ell_1 + \\ell_2 + L\\,$ is even.\n\nAssume these selection rules hold for the angular part of the coupling, independent of radial structure, and that truncation limits which modes exist. Consider a spectral truncation characterized by $\\,(\\ell_{\\max}, m_{\\max})\\,$ with the set of retained modes\n$$\n\\mathcal{S}(\\ell_{\\max}, m_{\\max}) = \\left\\{ (\\ell, m) \\,\\middle|\\, 0 \\le \\ell \\le \\ell_{\\max},\\; -\\min(m_{\\max}, \\ell) \\le m \\le \\min(m_{\\max}, \\ell) \\right\\}.\n$$\nDefine a triadic interaction as an ordered pair of input modes $\\,(\\ell_1, m_1), (\\ell_2, m_2) \\in \\mathcal{S}\\,$ producing an output mode $\\,(\\!L, M)\\,$ that also lies in $\\,\\mathcal{S}\\,$ and satisfies the three constraints above. Count each ordered input pair separately, and for each such ordered pair count all admissible output degrees $\\,L\\,$ in the allowed range that satisfy the parity and azimuthal constraints.\n\nTasks:\n\n1. Starting from the orthogonality of spherical harmonics, the addition theorem, and conservation of angular momentum in the representation of products of spherical harmonics, explain why the three selection rules above are necessary for nonzero angular couplings in the triadic interactions of the induction equation.\n\n2. Design an algorithm that, for given truncation limits $\\,(\\ell_{\\max}, m_{\\max})\\,$, enumerates the set $\\,\\mathcal{S}\\,$, iterates over all ordered input pairs $\\,(\\ell_1,m_1),(\\ell_2,m_2)\\,$, and counts all admissible outputs $\\,(\\!L, M)\\,$ with $\\,M=m_1+m_2\\,$ and $\\,L\\,$ satisfying the triangle inequality, the truncation bound $\\,L \\le \\ell_{\\max}\\,$, the azimuthal bound $\\,|M| \\le L\\,$, and the parity constraint. Denote the total number of triads by $\\,T(\\ell_{\\max}, m_{\\max})\\,$, the number of modes by $\\,N(\\ell_{\\max}, m_{\\max}) = \\lvert \\mathcal{S} \\rvert\\,$, and the average number of couplings per output mode by $\\,\\bar{C} = T / N\\,$.\n\n3. For the special case $\\,m_{\\max} = \\ell_{\\max}\\,$ (full azimuthal bandwidth), argue the asymptotic computational complexity of a naive triad enumeration in terms of $\\,\\ell_{\\max}\\,$ using first-principles counting. Provide a principled estimate of the power-law exponent $\\,p\\,$ such that $\\,T(\\ell_{\\max}, \\ell_{\\max}) \\sim \\text{const} \\times \\ell_{\\max}^{\\,p}\\,$ as $\\,\\ell_{\\max} \\to \\infty\\,$, and explain how this compares to the operation count implied by your algorithmic loops.\n\n4. Implement a complete program that:\n   - Uses the selection rules and counting procedure described above.\n   - Computes $\\,N\\,$, $\\,T\\,$, and $\\,\\bar{C}\\,$ for each test case in the suite below.\n   - For the subset of test cases with $\\,m_{\\max} = \\ell_{\\max}  0\\,$, performs a least-squares fit of $\\,\\log T\\,$ versus $\\,\\log \\ell_{\\max}\\,$ to estimate the empirical exponent $\\,p\\,$.\n   - Produces a single line of output containing a comma-separated list enclosed in square brackets, where each test case contributes a list $[N, T, \\bar{C}]$ in order, and the final element of the outer list is the fitted exponent $\\,p\\,$ as a floating-point number. For example, the format must be exactly\n     $$\n     \\big[ [N_1, T_1, \\bar{C}_1], [N_2, T_2, \\bar{C}_2], \\dots, p \\big].\n     $$\n\nTest suite:\n- Case $\\,1\\,$: $(\\ell_{\\max}, m_{\\max}) = (0, 0)$.\n- Case $\\,2\\,$: $(\\ell_{\\max}, m_{\\max}) = (1, 0)$.\n- Case $\\,3\\,$: $(\\ell_{\\max}, m_{\\max}) = (2, 2)$.\n- Case $\\,4\\,$: $(\\ell_{\\max}, m_{\\max}) = (4, 4)$.\n- Case $\\,5\\,$: $(\\ell_{\\max}, m_{\\max}) = (8, 8)$.\n- Case $\\,6\\,$: $(\\ell_{\\max}, m_{\\max}) = (12, 12)$.\n- Case $\\,7\\,$: $(\\ell_{\\max}, m_{\\max}) = (10, 3)$.\n\nAll answers are dimensionless counts and ratios; no physical units are required. Angles, if any, are internal to the spherical harmonics and need not be output. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets as specified above. The numerical outputs must be real numbers or integers as defined, with no additional text.", "solution": "The problem is valid as it is scientifically grounded in magnetohydrodynamics, well-posed with clear definitions and objectives, and free of contradictions or ambiguities.\n\n### 1. Theoretical Origin of Selection Rules\n\nThe nonlinear term $\\nabla \\times (\\mathbf{u} \\times \\mathbf{B})$ in the induction equation, when transformed into a spectral basis of spherical harmonics, involves products of fields. The angular dependence of these products is governed by integrals of products of three spherical harmonics, known as Gaunt integrals:\n$$\nI = \\int_{\\Omega} Y_{L}^{M*}(\\theta, \\phi) Y_{\\ell_1}^{m_1}(\\theta, \\phi) Y_{\\ell_2}^{m_2}(\\theta, \\phi) d\\Omega\n$$\nwhere $d\\Omega = \\sin\\theta d\\theta d\\phi$ is the solid angle element, and the asterisk denotes complex conjugation. The selection rules define the conditions under which this integral is non-zero, thereby determining which spectral modes $(\\ell_1, m_1)$ and $(\\ell_2, m_2)$ can interact to produce a mode $(L, M)$.\n\n**1. Azimuthal Order Conservation ($m_1 + m_2 = M$):**\nThe spherical harmonic function $Y_{\\ell}^{m}(\\theta, \\phi)$ has an azimuthal dependence given by $e^{im\\phi}$. The integral over the azimuthal angle $\\phi$ is:\n$$\n\\int_0^{2\\pi} (e^{iM\\phi})^* (e^{im_1\\phi}) (e^{im_2\\phi}) d\\phi = \\int_0^{2\\pi} e^{-iM\\phi} e^{im_1\\phi} e^{im_2\\phi} d\\phi = \\int_0^{2\\pi} e^{i(m_1 + m_2 - M)\\phi} d\\phi\n$$\nDue to the orthogonality of the complex exponential functions $\\{e^{ik\\phi}\\}_{k \\in \\mathbb{Z}}$ on the interval $[0, 2\\pi]$, this integral evaluates to $2\\pi$ if the exponent is zero, i.e., $m_1 + m_2 - M = 0$, and is zero otherwise. This establishes the selection rule $m_1 + m_2 = M$.\n\n**2. Parity Constraint ($\\ell_1 + \\ell_2 + L$ is even):**\nSpherical harmonics have a defined parity under the inversion operation $\\mathbf{r} \\to -\\mathbf{r}$, which in spherical coordinates is $(\\theta, \\phi) \\to (\\pi - \\theta, \\phi + \\pi)$. The transformation rule is $Y_{\\ell}^{m}(\\pi - \\theta, \\phi + \\pi) = (-1)^{\\ell} Y_{\\ell}^{m}(\\theta, \\phi)$. Applying this to the entire integrand gives:\n$$\n(-1)^{L} Y_{L}^{M*} \\cdot (-1)^{\\ell_1} Y_{\\ell_1}^{m_1} \\cdot (-1)^{\\ell_2} Y_{\\ell_2}^{m_2} = (-1)^{\\ell_1 + \\ell_2 + L} \\left( Y_{L}^{M*} Y_{\\ell_1}^{m_1} Y_{\\ell_2}^{m_2} \\right)\n$$\nThe integral is performed over the entire sphere $\\Omega$, which is a domain symmetric with respect to inversion. If the integrand is an odd function under this transformation (i.e., if the parity factor $(-1)^{\\ell_1 + \\ell_2 + L} = -1$), the integral over one hemisphere will be exactly cancelled by the integral over the other, yielding a total of zero. Therefore, for the Gaunt integral to be non-zero, the integrand must be an even function, which requires the sum of the degrees $\\ell_1 + \\ell_2 + L$ to be an even integer.\n\n**3. Triangle Inequality ($|\\ell_1 - \\ell_2| \\le L \\le \\ell_1 + \\ell_2$):**\nThis rule arises from the principles of angular momentum addition in quantum mechanics, which are mathematically analogous to the composition of spherical harmonics. The product of two spherical harmonics can be expanded into a sum of single spherical harmonics:\n$$\nY_{\\ell_1}^{m_1} Y_{\\ell_2}^{m_2} = \\sum_{\\ell', m'} C(\\ell_1, m_1, \\ell_2, m_2; \\ell', m') Y_{\\ell'}^{m'}\n$$\nwhere the coefficients $C$ are proportional to Clebsch-Gordan coefficients (or Wigner $3j$-symbols). These coefficients are non-zero only if $m' = m_1 + m_2$ and the degrees satisfy the triangle inequality $|\\ell_1 - \\ell_2| \\le \\ell' \\le \\ell_1 + \\ell_2$. When this expansion is substituted into the Gaunt integral, the orthogonality property of spherical harmonics, $\\int Y_{L}^{M*} Y_{\\ell'}^{m'} d\\Omega = \\delta_{L\\ell'} \\delta_{Mm'}$, selects only the terms from the sum where $\\ell' = L$ and $m' = M$. Consequently, the integral can be non-zero only if the triplet $(\\ell_1, \\ell_2, L)$ satisfies the triangle inequality conditions inherited from the non-zero Clebsch-Gordan coefficients. This is a direct expression of the conservation of angular momentum for the interacting modes.\n\n### 2. Algorithm Design\n\nThe algorithm to compute the number of modes $N$, the total number of triadic interactions $T$, and the average number of couplings per mode $\\bar{C}$ for given truncation parameters $(\\ell_{\\max}, m_{\\max})$ is designed as follows.\n\n**Step 1: Generate Mode Set $\\mathcal{S}$ and Compute $N$**\nFirst, we enumerate all modes $(\\ell, m)$ that satisfy the truncation criteria and store them.\n-   Initialize an empty list, `modes`.\n-   Iterate through spherical harmonic degree $\\ell$ from $0$ to $\\ell_{\\max}$.\n-   For each $\\ell$, iterate through azimuthal order $m$ from $-\\min(m_{\\max}, \\ell)$ to $\\min(m_{\\max}, \\ell)$.\n-   Add the tuple $(\\ell, m)$ to the `modes` list.\n-   The total number of modes, $N$, is the final size of this list, $N = |\\mathcal{S}|$.\n\n**Step 2: Enumerate Triads and Compute $T$**\nNext, we systematically count all valid triadic interactions. A direct enumeration approach involves iterating through all possible ordered pairs of input modes and, for each pair, counting the number of valid output modes.\n-   Initialize a counter for the total number of triads, $T = 0$.\n-   Loop through each input mode $(\\ell_1, m_1) \\in \\mathcal{S}$.\n-   Inside this loop, nest another loop through each input mode $(\\ell_2, m_2) \\in \\mathcal{S}$.\n-   For each ordered pair $((\\ell_1, m_1), (\\ell_2, m_2))$:\n    a. Calculate the azimuthal order of the output mode from the conservation rule: $M = m_1 + m_2$.\n    b. Apply the truncation constraint on $M$. The output mode $(L, M)$ must belong to $\\mathcal{S}$, which requires $|M| \\le \\min(m_{\\max}, L)$. Since this must hold for some $L$, a necessary condition is $|M| \\le m_{\\max}$. If $|M|  m_{\\max}$, no valid output mode exists, so we continue to the next pair of input modes.\n    c. Determine the valid range for the output degree $L$ by combining all constraints:\n        -   Triangle inequality: $|\\ell_1 - \\ell_2| \\le L \\le \\ell_1 + \\ell_2$\n        -   Truncation limit: $L \\le \\ell_{\\max}$\n        -   Spherical harmonic requirement: $|M| \\le L$\n        This gives a lower bound $L_{\\min} = \\max(|\\ell_1 - \\ell_2|, |M|)$ and an upper bound $L_{\\max} = \\min(\\ell_1 + \\ell_2, \\ell_{\\max})$.\n    d. If $L_{\\min}  L_{\\max}$, no value of $L$ can satisfy all constraints, so we continue.\n    e. Count the number of integers $L$ in the range $[L_{\\min}, L_{\\max}]$ that also satisfy the parity constraint: $\\ell_1 + \\ell_2 + L$ must be even. This is equivalent to $L$ having the same parity as $\\ell_1 + \\ell_2$. This count can be calculated arithmetically without an explicit loop:\n        i. Find the first valid $L$ in the range, let it be $L_{start}$. $L_{start} = L_{\\min}$ if $(\\ell_1 + \\ell_2 + L_{\\min})$ is even, otherwise $L_{start} = L_{\\min} + 1$.\n        ii. If $L_{start}  L_{\\max}$, there are no valid $L$ values.\n        iii. Otherwise, the number of valid $L$ values (which are spaced by $2$) is $(L_{\\max} - L_{start}) / 2 + 1$.\n    f. Add this count to the total $T$.\n\n**Step 3: Compute $\\bar{C}$**\nFinally, calculate the average number of couplings per output mode.\n-   $\\bar{C} = T / N$. A check for $N=0$ is necessary, though for any valid $\\ell_{\\max} \\ge 0$, $N \\ge 1$.\n\n### 3. Asymptotic Complexity Analysis\n\nWe analyze the computational complexity for the case of a full triangular truncation, where $m_{\\max} = \\ell_{\\max}$. We want to find the exponent $p$ in the scaling relation $T(\\ell_{\\max}, \\ell_{\\max}) \\sim \\text{const} \\times \\ell_{\\max}^{\\,p}$ as $\\ell_{\\max} \\to \\infty$.\n\n**Number of Modes ($N$):**\nFor $m_{\\max} = \\ell_{\\max}$, the set of modes is $\\mathcal{S} = \\{(\\ell, m) \\mid 0 \\le \\ell \\le \\ell_{\\max}, -\\ell \\le m \\le \\ell\\}$. For each degree $\\ell$, there are $2\\ell+1$ possible values for $m$. The total number of modes is:\n$$\nN = \\sum_{\\ell=0}^{\\ell_{\\max}} (2\\ell+1) = (\\ell_{\\max}+1)^2\n$$\nThus, for large $\\ell_{\\max}$, the number of modes scales as $N \\sim \\ell_{\\max}^2$.\n\n**Number of Triads ($T$):**\nThe total number of triads $T$ is the result of a sum over all pairs of input modes, where each term in the sum is the number of valid output degrees $L$.\n$$\nT = \\sum_{(\\ell_1, m_1) \\in \\mathcal{S}} \\sum_{(\\ell_2, m_2) \\in \\mathcal{S}} (\\text{Number of valid } L\\text{ for this pair})\n$$\nWe can estimate the scaling by considering the dominant contributions from high-wavenumber modes, where $\\ell_1, \\ell_2 \\sim O(\\ell_{\\max})$.\n-   The number of ordered pairs of input modes is $N^2 \\sim (\\ell_{\\max}^2)^2 = \\ell_{\\max}^4$.\n-   For a typical interaction between modes with $\\ell_1 \\sim O(\\ell_{\\max})$ and $\\ell_2 \\sim O(\\ell_{\\max})$, the range of possible output degrees $L$ is given by $L \\in [|\\ell_1 - \\ell_2|, \\ell_1 + \\ell_2]$, constrained by the truncation $L \\le \\ell_{\\max}$. The lower bound $|\\ell_1 - \\ell_2|$ can be small, while the upper bound of the allowed range is $\\ell_{\\max}$. The length of this interval for $L$ is therefore on the order of $\\ell_{\\max}$.\n-   The number of valid $L$ values is proportional to the length of this interval. On average, the number of valid $L$s for a given input pair is $O(\\ell_{\\max})$.\n\nCombining these estimates, the total number of triads scales as the product of the number of pairs and the average number of completions per pair:\n$$\nT \\sim (\\text{Number of pairs}) \\times (\\text{Average number of } L\\text{s}) \\sim \\ell_{\\max}^4 \\times \\ell_{\\max} = \\ell_{\\max}^5\n$$\nTherefore, the predicted asymptotic scaling exponent is $p=5$. The naive triad enumeration algorithm designed in the previous section has a structure of nested loops that reflects this scaling: two nested loops over modes give $O(N^2) = O(\\ell_{\\max}^4)$, and the inner calculation over $L$ contributes an effective $O(\\ell_{\\max})$ factor in terms of the number of interactions counted, leading to the same overall scaling.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import stats\n\ndef count_interactions(l_max, m_max):\n    \"\"\"\n    Counts modes and triadic interactions for a given spectral truncation.\n\n    Args:\n        l_max (int): Maximum spherical harmonic degree.\n        m_max (int): Maximum spherical harmonic order.\n\n    Returns:\n        tuple: A tuple containing:\n            - N (int): Total number of modes.\n            - T (int): Total number of triadic interactions.\n            - C_bar (float): Average number of couplings per mode.\n    \"\"\"\n    # Step 1: Generate the set of modes S and count them for N.\n    modes = []\n    for l_val in range(l_max + 1):\n        m_limit = min(m_max, l_val)\n        for m_val in range(-m_limit, m_limit + 1):\n            modes.append((l_val, m_val))\n    \n    N = len(modes)\n    \n    if N == 0:\n        return 0, 0, 0.0\n\n    # Step 2: Enumerate triads and compute T.\n    T = 0\n    # Iterate over all ordered pairs of input modes.\n    for l1, m1 in modes:\n        for l2, m2 in modes:\n            # Calculate output azimuthal order M from conservation rule.\n            M = m1 + m2\n            \n            # Check truncation on M. If |M| > m_max, no valid output mode (L, M)\n            # can exist in the set S, since S requires |M| = min(m_max, L).\n            if abs(M) > m_max:\n                continue\n                \n            # Determine the range for the output degree L from selection rules and truncation.\n            L_min = max(abs(l1 - l2), abs(M))\n            L_max = min(l1 + l2, l_max)\n            \n            # If the range is invalid, no L is possible.\n            if L_min > L_max:\n                continue\n                \n            # Count the number of integers L in [L_min, L_max] that satisfy the\n            # parity constraint: (l1 + l2 + L) must be even.\n            # This is equivalent to L having the same parity as (l1 + l2).\n            # This count can be calculated arithmetically.\n            \n            # Find the first valid L in the range.\n            first_L = L_min\n            if (l1 + l2 + first_L) % 2 != 0:\n                first_L += 1\n            \n            # If the first valid L is outside the range, no triads are formed.\n            if first_L > L_max:\n                continue\n            \n            # The valid L values are {first_L, first_L + 2, ...}.\n            # The number of terms in this arithmetic progression is calculated.\n            num_valid_L = (L_max - first_L) // 2 + 1\n            T += num_valid_L\n\n    # Step 3: Calculate C_bar = T / N.\n    C_bar = T / N if N > 0 else 0.0\n    \n    return N, T, C_bar\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite, perform analysis, and print the final result.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0, 0),    # Case 1\n        (1, 0),    # Case 2\n        (2, 2),    # Case 3\n        (4, 4),    # Case 4\n        (8, 8),    # Case 5\n        (12, 12),  # Case 6\n        (10, 3)    # Case 7\n    ]\n\n    results = []\n    log_l_max_data = []\n    log_T_data = []\n\n    for l_max, m_max in test_cases:\n        N, T, C_bar = count_interactions(l_max, m_max)\n        results.append([N, int(T), float(C_bar)])\n        \n        # Collect data for least-squares fit for cases where l_max = m_max > 0.\n        if l_max == m_max and l_max > 0:\n            log_l_max_data.append(np.log(l_max))\n            log_T_data.append(np.log(T))\n            \n    # Perform a linear least-squares fit of log(T) vs log(l_max) to find the exponent p.\n    # The model is log(T) = p * log(l_max) + const. The slope of the line is p.\n    p_fit = 0.0\n    if len(log_l_max_data) > 1:\n        # Using scipy.stats.linregress to get the slope.\n        slope, _, _, _, _ = stats.linregress(log_l_max_data, log_T_data)\n        p_fit = slope\n\n    # Format the final output string precisely as required.\n    # The output is a single line: [[N1,T1,C1],[N2,T2,C2],...,p] with no spaces.\n    output_parts = []\n    for N_i, T_i, C_bar_i in results:\n        output_parts.append(f\"[{N_i},{T_i},{C_bar_i}]\")\n    \n    # Join the parts for each test case, and append the fitted exponent p.\n    full_output_str = f\"[{','.join(output_parts)},{p_fit}]\"\n    \n    # Final print statement in the exact required format.\n    print(full_output_str)\n\nsolve()\n```", "id": "3608698"}, {"introduction": "A major challenge in simulating the geodynamo is the presence of physical processes occurring on vastly different timescales, from fast-moving Alfvén waves to the slow convective overturn. Such \"stiff\" systems demand specialized numerical techniques for stable and efficient time integration. In this practice, you will implement a first-order Implicit-Explicit (IMEX) time integrator to solve a simplified MHD system, learning how to selectively treat fast waves implicitly for stability while handling other terms explicitly for efficiency [@problem_id:3608672]. This is a cornerstone technique for modern long-term geodynamo simulations.", "problem": "You are asked to design and evaluate a first-order Implicit-Explicit (IMEX) time integrator for a simplified magnetohydrodynamic geodynamo model that stabilizes fast Alfvén and inertial waves by treating linear wave dynamics implicitly while treating nonlinear advection explicitly. Starting from the linearized, incompressible, rotating Magnetohydrodynamics (MHD) equations about a uniform magnetic field, pose the model in Fourier space for a single wavevector aligned with the rotation and magnetic field axis. Build from first principles a performance model for explicit Courant-Friedrichs-Lewy (CFL) limits across parameter regimes, and quantify an accuracy-limited time step based on the fastest linear waves.\n\nFundamental base and model specification:\n- Begin from the incompressible, rotating MHD equations with uniform background magnetic field. The momentum equation is\n$$\n\\rho \\, \\frac{\\partial \\mathbf{v}}{\\partial t} = - \\nabla p - 2 \\rho \\, \\mathbf{\\Omega} \\times \\mathbf{v} + \\frac{1}{\\mu_0} (\\nabla \\times \\mathbf{b}) \\times \\mathbf{B}_0 + \\rho \\, \\nu \\nabla^2 \\mathbf{v},\n$$\nand the induction equation is\n$$\n\\frac{\\partial \\mathbf{b}}{\\partial t} = \\nabla \\times (\\mathbf{v} \\times \\mathbf{B}_0) + \\eta \\nabla^2 \\mathbf{b},\n$$\nwhere $\\,\\mathbf{v}\\,$ is velocity, $\\,\\mathbf{b}\\,$ is magnetic field perturbation, $\\,p\\,$ is pressure, $\\,\\rho\\,$ is density, $\\,\\nu\\,$ is kinematic viscosity, $\\,\\eta\\,$ is magnetic diffusivity, $\\,\\mu_0\\,$ is the magnetic permeability of free space, and $\\,\\mathbf{\\Omega}\\,$ is the rotation vector. Assume $\\,\\nabla \\cdot \\mathbf{v} = 0\\,$ and $\\,\\nabla \\cdot \\mathbf{b} = 0\\,$.\n\n- Consider a single Fourier mode with wavevector $\\,\\mathbf{k} = k \\, \\hat{\\mathbf{z}}\\,$ aligned with the uniform background magnetic field $\\,\\mathbf{B}_0 = B_0 \\, \\hat{\\mathbf{z}}\\,$ and rotation $\\,\\mathbf{\\Omega} = \\Omega \\, \\hat{\\mathbf{z}}\\,$. For perturbations transverse to $\\,\\hat{\\mathbf{z}}\\,$, the linearized system in Fourier space for the $\\,x\\,$ and $\\,y\\,$ components is\n$$\n\\frac{\\partial v_x}{\\partial t} = + 2 \\Omega v_y + i \\frac{k B_0}{\\mu_0 \\rho} \\, b_x - \\nu k^2 v_x, \\quad\n\\frac{\\partial v_y}{\\partial t} = - 2 \\Omega v_x + i \\frac{k B_0}{\\mu_0 \\rho} \\, b_y - \\nu k^2 v_y,\n$$\n$$\n\\frac{\\partial b_x}{\\partial t} = i k B_0 \\, v_x - \\eta k^2 b_x, \\quad\n\\frac{\\partial b_y}{\\partial t} = i k B_0 \\, v_y - \\eta k^2 b_y.\n$$\nDefine the state vector $\\,\\mathbf{U} = [v_x, v_y, b_x, b_y]^\\top\\,$ and write the system as $\\,\\partial_t \\mathbf{U} = \\mathbf{L} \\mathbf{U} + \\mathbf{N}(\\mathbf{U})\\,$, where $\\,\\mathbf{L}\\,$ is the linear operator containing Coriolis, Alfvén, and diffusive terms. In a single-mode truncation, the explicit advection term $\\,\\mathbf{N}(\\mathbf{U})\\,$ does not contribute to the same Fourier mode; for the purposes of stability modeling, you may set $\\,\\mathbf{N}(\\mathbf{U}) = \\mathbf{0}\\,$ while still imposing the explicit CFL constraint using the velocity amplitude.\n\n- Implement the first-order IMEX Euler scheme:\n$$\n\\mathbf{U}^{n+1} = \\left( \\mathbf{I} - \\Delta t \\, \\mathbf{L} \\right)^{-1} \\left[ \\mathbf{U}^{n} + \\Delta t \\, \\mathbf{N}(\\mathbf{U}^{n}) \\right],\n$$\nwith $\\,\\mathbf{N}(\\mathbf{U}) = \\mathbf{0}\\,$ as justified above. Treating $\\,\\mathbf{L}\\,$ implicitly stabilizes fast inertial and Alfvén waves.\n\nPerformance model:\n- Define the explicit advection CFL time step as\n$$\n\\Delta t_{\\text{adv}} = C_{\\text{cfl}} \\, \\frac{\\Delta x}{\\max(|v_x|,|v_y|)},\n$$\nwith $\\,C_{\\text{cfl}} \\in (0,1)\\,$ the Courant factor and $\\,\\Delta x\\,$ a grid spacing.\n\n- Define an accuracy-oriented time step based on the fastest linear waves (with diffusion neglected) as\n$$\n\\Delta t_{\\text{acc}} = \\frac{C_{\\text{acc}}}{\\omega_{\\max}},\n$$\nwhere $\\,C_{\\text{acc}} \\in (0,1)\\,$ is an accuracy factor and $\\,\\omega_{\\max}\\,$ is the maximum absolute value of the imaginary part of the eigenvalues of the diffusionless linear operator $\\,\\mathbf{L}_0\\,$ obtained from $\\,\\mathbf{L}\\,$ by setting the diffusive terms to zero. The fastest waves include Alfvén waves with frequency $\\,\\omega_A = k v_A\\,$ where $\\,v_A = B_0/\\sqrt{\\mu_0 \\rho}\\,$ and inertial waves with frequency $\\,\\omega_I = 2 \\Omega\\,$ for the alignment assumed.\n\n- Choose the model time step $\\,\\Delta t_{\\text{model}} = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{acc}})\\,$. For stability verification with the IMEX Euler scheme, compute the amplification matrix $\\,\\mathbf{G} = \\left( \\mathbf{I} - \\Delta t_{\\text{model}} \\, \\mathbf{L} \\right)^{-1}\\,$ and its spectral radius. Additionally, compute the total energy\n$$\nE = \\frac{1}{2} \\rho \\left( |v_x|^2 + |v_y|^2 \\right) + \\frac{1}{2 \\mu_0} \\left( |b_x|^2 + |b_y|^2 \\right),\n$$\nbefore and after one IMEX step, and use $\\,E^{n+1} \\le E^n\\,$ as a practical check of monotonic damping for this implicit scheme.\n\nNumerical units:\n- Use $\\,\\rho\\,$ in $\\mathrm{kg/m^3}$, $\\,B_0\\,$ in $\\mathrm{T}$, $\\,\\Omega\\,$ in $\\mathrm{s^{-1}}$, $\\,k\\,$ in $\\mathrm{m^{-1}}$, $\\,\\nu\\,$ and $\\,\\eta\\,$ in $\\mathrm{m^2/s}$, $\\,\\Delta x\\,$ in $\\mathrm{m}$, and velocities in $\\mathrm{m/s}$. Report all time steps in seconds.\n\nTest suite:\nImplement the above with the following four parameter regimes, using $\\,\\mu_0 = 4 \\pi \\times 10^{-7}\\,$ in $\\mathrm{H/m}$, $\\,C_{\\text{cfl}} = 0.5\\,$, $\\,C_{\\text{acc}} = 0.2\\,$, and initial state $\\,v_x(0) = U_0\\,$, $\\,v_y(0) = 0.4 U_0\\,$, $\\,b_x(0) = 0\\,$, $\\,b_y(0) = 0\\,$:\n\n- Case $\\,1\\,$ (advection-limited): $\\,\\rho = 10^4\\,$, $\\,B_0 = 5 \\times 10^{-3}\\,$, $\\,\\Omega = 10^{-3}\\,$, $\\,k = 10\\,$, $\\,\\nu = 10^{-6}\\,$, $\\,\\eta = 1\\,$, $\\,\\Delta x = 0.1\\,$, $\\,U_0 = 0.5\\,$.\n- Case $\\,2\\,$ (Alfvén accuracy-limited): $\\,\\rho = 10^4\\,$, $\\,B_0 = 5 \\times 10^{-1}\\,$, $\\,\\Omega = 10^{-3}\\,$, $\\,k = 10\\,$, $\\,\\nu = 10^{-6}\\,$, $\\,\\eta = 1\\,$, $\\,\\Delta x = 0.1\\,$, $\\,U_0 = 0.5\\,$.\n- Case $\\,3\\,$ (inertial accuracy-limited): $\\,\\rho = 10^4\\,$, $\\,B_0 = 5 \\times 10^{-3}\\,$, $\\,\\Omega = 50\\,$, $\\,k = 10\\,$, $\\,\\nu = 10^{-6}\\,$, $\\,\\eta = 1\\,$, $\\,\\Delta x = 0.1\\,$, $\\,U_0 = 0.5\\,$.\n- Case $\\,4\\,$ (weak advection, long waves): $\\,\\rho = 10^4\\,$, $\\,B_0 = 5 \\times 10^{-2}\\,$, $\\,\\Omega = 10^{-4}\\,$, $\\,k = 1\\,$, $\\,\\nu = 10^{-6}\\,$, $\\,\\eta = 1\\,$, $\\,\\Delta x = 0.1\\,$, $\\,U_0 = 10^{-3}\\,$.\n\nRequired outputs and format:\n- For each case, compute and return the list $\\, [\\Delta t_{\\text{adv}}, \\Delta t_{\\text{acc}}, \\Delta t_{\\text{model}}, \\text{stable}] \\,$, where the first three entries are floats in seconds rounded to six decimal places, and the last entry is a boolean indicating whether the spectral radius of $\\,\\mathbf{G}\\,$ is at most $\\,1\\,$ and $\\,E^{n+1} \\le E^n\\,$ holds after one step. Your program should produce a single line of output containing the results as a comma-separated list of these four-element lists enclosed in square brackets (for example, $\\,[[0.05,0.00448,0.00448,True],\\ldots]\\,$).", "solution": "The problem requires an analysis of a first-order Implicit-Explicit (IMEX) time integration scheme for a simplified magnetohydrodynamic (MHD) system relevant to geodynamo modeling. The analysis involves deriving time-step constraints, implementing the numerical scheme for a single Fourier mode, and verifying its stability properties across different physical regimes.\n\n### **Problem Validation**\n\nThe problem is scientifically and mathematically well-posed. The governing equations are the standard, linearized, incompressible, rotating MHD equations. The simplification to a single Fourier mode aligned with the rotation vector and background magnetic field is a common and valid analytical approach for studying fundamental wave dynamics (Alfvén and inertial waves). The IMEX Euler scheme is a standard numerical method, and its application here is clearly defined. All necessary parameters, constants, and initial conditions are provided. The analysis tasks, including the calculation of time-step limits and stability verification through spectral radius and energy evolution, are standard procedures in computational physics. Therefore, the problem is valid and a solution can be formulated.\n\n### **Theoretical Formulation**\n\nThe system of equations governs the evolution of the state vector $\\mathbf{U} = [v_x, v_y, b_x, b_y]^\\top$, representing the complex Fourier amplitudes of the transverse velocity and magnetic field perturbations. The evolution is described by $\\partial_t \\mathbf{U} = \\mathbf{L} \\mathbf{U}$, where nonlinear advection terms $\\mathbf{N}(\\mathbf{U})$ are neglected for this single-mode linear analysis.\n\nFrom the provided equations:\n$$\n\\frac{\\partial v_x}{\\partial t} = + 2 \\Omega v_y + i \\frac{k B_0}{\\mu_0 \\rho} \\, b_x - \\nu k^2 v_x \\\\\n\\frac{\\partial v_y}{\\partial t} = - 2 \\Omega v_x + i \\frac{k B_0}{\\mu_0 \\rho} \\, b_y - \\nu k^2 v_y \\\\\n\\frac{\\partial b_x}{\\partial t} = i k B_0 \\, v_x - \\eta k^2 b_x \\\\\n\\frac{\\partial b_y}{\\partial t} = i k B_0 \\, v_y - \\eta k^2 b_y\n$$\n\nThe linear operator $\\mathbf{L}$ is a $4 \\times 4$ complex matrix:\n$$\n\\mathbf{L} = \\begin{pmatrix}\n-\\nu k^2  2\\Omega  i \\frac{k B_0}{\\mu_0 \\rho}  0 \\\\\n-2\\Omega  -\\nu k^2  0  i \\frac{k B_0}{\\mu_0 \\rho} \\\\\ni k B_0  0  -\\eta k^2  0 \\\\\n0  i k B_0  0  -\\eta k^2\n\\end{pmatrix}\n$$\n\n### **Time-Step Calculation**\n\nThe model time step $\\Delta t_{\\text{model}}$ is determined by two constraints: an advective CFL condition and an accuracy condition based on linear wave frequencies.\n\n1.  **Advective Time Step, $\\Delta t_{\\text{adv}}$**: This is an explicit CFL-type constraint, relevant for the explicit treatment of advection. Even though $\\mathbf{N}(\\mathbf{U}) = \\mathbf{0}$ in our linear model, we compute this for performance modeling.\n    $$\n    \\Delta t_{\\text{adv}} = C_{\\text{cfl}} \\, \\frac{\\Delta x}{\\max(|v_x|,|v_y|)}\n    $$\n    Given $C_{\\text{cfl}} = 0.5$ and initial velocities $v_x(0) = U_0$ and $v_y(0) = 0.4 U_0$, this becomes $\\Delta t_{\\text{adv}} = 0.5 \\frac{\\Delta x}{U_0}$.\n\n2.  **Accuracy Time Step, $\\Delta t_{\\text{acc}}$**: This step ensures that the fastest linear waves are temporally resolved. It is defined as:\n    $$\n    \\Delta t_{\\text{acc}} = \\frac{C_{\\text{acc}}}{\\omega_{\\max}}\n    $$\n    Here, $C_{\\text{acc}} = 0.2$, and $\\omega_{\\max}$ is the maximum absolute frequency (imaginary part of the eigenvalues) of the non-dissipative linear operator $\\mathbf{L}_0$ (where $\\nu = 0$ and $\\eta = 0$).\n\nTo find $\\omega_{\\max}$, we analyze the eigenvalues of $\\mathbf{L}_0$. The system can be decoupled using circularly polarized variables. The eigenvalues of $\\mathbf{L}_0$ are found to be purely imaginary, $\\lambda = i\\omega$, where the frequencies $\\omega$ satisfy the dispersion relation:\n$$\n\\omega = \\pm \\left( \\Omega \\pm \\sqrt{\\Omega^2 + \\omega_A^2} \\right)\n$$\nwhere $\\omega_A = k v_A = k B_0 / \\sqrt{\\mu_0 \\rho}$ is the Alfvén frequency. The maximum absolute frequency is therefore:\n$$\n\\omega_{\\max} = \\Omega + \\sqrt{\\Omega^2 + \\omega_A^2}\n$$\n\n3.  **Model Time Step, $\\Delta t_{\\text{model}}$**: The final time step used for the integration is the minimum of the two constraints:\n    $$\n    \\Delta t_{\\text{model}} = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{acc}})\n    $$\n\n### **Numerical Scheme and Stability Analysis**\n\nThe first-order IMEX Euler scheme with $\\mathbf{N}(\\mathbf{U})=\\mathbf{0}$ reduces to the first-order implicit Euler (or Backward Euler) scheme for the linear system:\n$$\n\\mathbf{U}^{n+1} = (\\mathbf{I} - \\Delta t_{\\text{model}} \\mathbf{L})^{-1} \\mathbf{U}^{n}\n$$\nThe stability of this scheme is assessed using two criteria:\n\n1.  **Spectral Radius**: The amplification matrix is $\\mathbf{G} = (\\mathbf{I} - \\Delta t_{\\text{model}} \\mathbf{L})^{-1}$. The scheme is numerically stable if the spectral radius $\\rho(\\mathbf{G}) = \\max_i |\\lambda_i(\\mathbf{G})| \\le 1$. Since the physical system is dissipative (eigenvalues of $\\mathbf{L}$ have non-positive real parts) and the implicit Euler scheme is A-stable, we expect $\\rho(\\mathbf{G}) \\le 1$ for any $\\Delta t  0$.\n\n2.  **Energy Evolution**: The total energy per unit volume for the mode is:\n    $$\n    E = \\frac{1}{2} \\rho \\left( |v_x|^2 + |v_y|^2 \\right) + \\frac{1}{2 \\mu_0} \\left( |b_x|^2 + |b_y|^2 \\right)\n    $$\n    For a dissipative system integrated with a stable implicit scheme, the energy should not grow. We check if $E^{n+1} \\le E^n$ after one time step.\n\nA case is deemed 'stable' if both $\\rho(\\mathbf{G}) \\le 1$ and $E^{n+1} \\le E^n$ are true.\n\n### **Algorithm and Implementation for Test Cases**\n\nFor each of the four test cases, the following steps are executed:\n1.  Define all physical and numerical parameters: $\\rho$, $B_0$, $\\Omega$, $k$, $\\nu$, $\\eta$, $\\Delta x$, $U_0$, $\\mu_0$, $C_{\\text{cfl}}$, $C_{\\text{acc}}$.\n2.  Calculate $\\Delta t_{\\text{adv}} = C_{\\text{cfl}} \\Delta x / U_0$.\n3.  Calculate the Alfvén frequency $\\omega_A = k B_0 / \\sqrt{\\mu_0 \\rho}$.\n4.  Calculate the maximum wave frequency $\\omega_{\\max} = \\Omega + \\sqrt{\\Omega^2 + \\omega_A^2}$.\n5.  Calculate $\\Delta t_{\\text{acc}} = C_{\\text{acc}} / \\omega_{\\max}$.\n6.  Set $\\Delta t_{\\text{model}} = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{acc}})$.\n7.  Construct the $4 \\times 4$ complex matrix $\\mathbf{L}$ using the case parameters.\n8.  Compute the amplification matrix $\\mathbf{G} = (\\mathbf{I} - \\Delta t_{\\text{model}} \\mathbf{L})^{-1}$.\n9.  Calculate the eigenvalues of $\\mathbf{G}$ and find the spectral radius $\\rho(\\mathbf{G})$.\n10. Set the initial state vector $\\mathbf{U}^0 = [U_0, 0.4 U_0, 0, 0]^\\top$.\n11. Compute the state after one step: $\\mathbf{U}^1 = \\mathbf{G} \\mathbf{U}^0$.\n12. Calculate the initial energy $E^0$ from $\\mathbf{U}^0$ and the final energy $E^1$ from $\\mathbf{U}^1$.\n13. Determine the stability flag based on $\\rho(\\mathbf{G}) \\le 1$ and $E^1 \\le E^0$.\n14. Store the list $[\\Delta t_{\\text{adv}}, \\Delta t_{\\text{acc}}, \\Delta t_{\\text{model}}, \\text{stable}]$, with float values rounded to six decimal places.\n\nThis process is repeated for all four cases to generate the final output.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the IMEX geodynamo model problem for the given test cases.\n    \"\"\"\n    \n    # Define physical and numerical constants\n    MU_0 = 4 * np.pi * 1e-7  # H/m\n    C_CFL = 0.5\n    C_ACC = 0.2\n    \n    # (rho, B0, Omega, k, nu, eta, dx, U0)\n    test_cases = [\n        # Case 1 (advection-limited)\n        (1e4, 5e-3, 1e-3, 10, 1e-6, 1, 0.1, 0.5),\n        # Case 2 (Alfvén accuracy-limited)\n        (1e4, 5e-1, 1e-3, 10, 1e-6, 1, 0.1, 0.5),\n        # Case 3 (inertial accuracy-limited)\n        (1e4, 5e-3, 50, 10, 1e-6, 1, 0.1, 0.5),\n        # Case 4 (weak advection, long waves)\n        (1e4, 5e-2, 1e-4, 1, 1e-6, 1, 0.1, 1e-3),\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        rho, B0, Omega, k, nu, eta, dx, U0 = case\n\n        # Initial state\n        u0_vec = np.array([U0, 0.4 * U0, 0, 0], dtype=np.complex128)\n\n        # 1. Calculate advective time step\n        max_v = max(np.abs(u0_vec[0]), np.abs(u0_vec[1]))\n        dt_adv = C_CFL * dx / max_v\n\n        # 2. Calculate accuracy time step\n        omega_A = k * B0 / np.sqrt(MU_0 * rho)\n        omega_max = Omega + np.sqrt(Omega**2 + omega_A**2)\n        dt_acc = C_ACC / omega_max\n\n        # 3. Determine model time step\n        dt_model = min(dt_adv, dt_acc)\n\n        # 4. Construct linear operator L\n        L = np.zeros((4, 4), dtype=np.complex128)\n        \n        # Diagonal terms\n        L[0, 0] = -nu * k**2\n        L[1, 1] = -nu * k**2\n        L[2, 2] = -eta * k**2\n        L[3, 3] = -eta * k**2\n        \n        # Coriolis terms\n        L[0, 1] = 2 * Omega\n        L[1, 0] = -2 * Omega\n        \n        # Lorentz force terms\n        L[0, 2] = 1j * k * B0 / (MU_0 * rho)\n        L[1, 3] = 1j * k * B0 / (MU_0 * rho)\n        \n        # Induction terms\n        L[2, 0] = 1j * k * B0\n        L[3, 1] = 1j * k * B0\n\n        # 5. Stability Analysis\n        I = np.identity(4)\n        G = np.linalg.inv(I - dt_model * L)\n        \n        # Spectral radius check\n        eigenvalues_G = np.linalg.eigvals(G)\n        spectral_radius = np.max(np.abs(eigenvalues_G))\n        stable_spectral = spectral_radius = 1.0 + 1e-9\n\n        # Energy check\n        def calculate_energy(U):\n            vx, vy, bx, by = U\n            kinetic_energy = 0.5 * rho * (np.abs(vx)**2 + np.abs(vy)**2)\n            magnetic_energy = 0.5 / MU_0 * (np.abs(bx)**2 + np.abs(by)**2)\n            return kinetic_energy + magnetic_energy\n\n        energy_0 = calculate_energy(u0_vec)\n        u1_vec = G @ u0_vec\n        energy_1 = calculate_energy(u1_vec)\n        stable_energy = energy_1 = energy_0 + 1e-9\n\n        is_stable = stable_spectral and stable_energy\n        \n        result = [dt_adv, dt_acc, dt_model, is_stable]\n        all_results.append(result)\n\n    # Format output string\n    str_results = []\n    for r in all_results:\n        # Format floats to 6 decimal places, boolean as is\n        s = f\"[{r[0]:.6f},{r[1]:.6f},{r[2]:.6f},{str(r[3]).lower()}]\"\n        # The prompt shows `True` not `true`. Correcting.\n        s = f\"[{r[0]:.6f},{r[1]:.6f},{r[2]:.6f},{r[3]}]\"\n        str_results.append(s)\n        \n    print(f\"[{','.join(str_results)}]\")\n\nsolve()\n```", "id": "3608672"}]}