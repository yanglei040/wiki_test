{"hands_on_practices": [{"introduction": "This practice grounds our computational work in fundamental physics. We will begin by deriving the governing equation for controlled-source electromagnetic (CSEM) fields in conductive media directly from Maxwell's equations. This exercise reveals the diffusive nature of low-frequency EM propagation and naturally leads to the concept of skin depth, an essential scaling parameter for survey design and data interpretation [@problem_id:3582341].", "problem": "Consider a controlled-source electromagnetic (CSEM) forward-modeling setting in a homogeneous, isotropic, electrically conducting medium characterized by magnetic permeability $\\mu$ and electrical conductivity $\\sigma$. Assume time-harmonic sources with angular frequency $\\omega$, negligible displacement current, and no free charges in the region of interest away from the source. Starting from Maxwell’s equations and standard constitutive relations, formulate the governing equation for the electric field $\\mathbf{E}$ in this conduction-dominated regime. From this base, restrict attention to a one-dimensional vertical variation and deduce the form of the depth-dependent solution. Introduce a rescaled depth variable $\\zeta = z / \\ell$ and choose the length scale $\\ell$ so that the canonical plane-wave solution in the rescaled coordinate has the normalized form $E(\\zeta) = E_{0} \\exp\\!\\big(-(1+i)\\,\\zeta\\big)$, where $E_{0}$ is a constant amplitude and $i$ is the imaginary unit. Derive $\\ell$ explicitly as a function of $\\omega$, $\\mu$, and $\\sigma$.\n\nFinally, use this diffusive scaling length to design a survey: for seawater with conductivity $\\sigma = 0.5\\,\\mathrm{S/m}$ and permeability $\\mu = \\mu_{0}$, where $\\mu_{0} = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$, choose the source frequency so that the non-dimensional horizontal source–receiver offset $L/\\ell$ equals $10$ for a physical offset $L = 7.5\\,\\mathrm{km}$. Compute the corresponding frequency $f$ in Hertz. Round your answer to three significant figures. Express the frequency in $\\mathrm{Hz}$.", "solution": "The user wants me to solve a multi-part problem in computational geophysics, specifically related to controlled-source electromagnetic (CSEM) forward modeling.\n\nHere's my plan:\n1.  **Validate the problem statement**:\n    *   **Extract Givens**: I'll list all the given parameters, equations, and conditions.\n        *   Homogeneous, isotropic, conducting medium.\n        *   Magnetic permeability: $\\mu$.\n        *   Electrical conductivity: $\\sigma$.\n        *   Time-harmonic sources with angular frequency $\\omega$.\n        *   Negligible displacement current.\n        *   No free charges away from the source ($\\rho = 0$).\n        *   Constitutive relations assumed standard (e.g., $\\mathbf{D} = \\epsilon \\mathbf{E}$, $\\mathbf{B} = \\mu \\mathbf{H}$, $\\mathbf{J} = \\sigma \\mathbf{E}$).\n        *   Task 1: Derive the governing equation for the electric field $\\mathbf{E}$.\n        *   Task 2: Restrict to 1D vertical variation and find the form of the depth-dependent solution.\n        *   Task 3: Introduce a rescaled depth variable $\\zeta = z / \\ell$.\n        *   Task 4: Find the length scale $\\ell$ such that the solution is $E(\\zeta) = E_{0} \\exp(-(1+i)\\zeta)$.\n        *   Task 5: Use this scaling length for a survey design.\n            *   Seawater conductivity: $\\sigma = 0.5\\,\\mathrm{S/m}$.\n            *   Seawater permeability: $\\mu = \\mu_0 = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$.\n            *   Non-dimensional offset: $L/\\ell = 10$.\n            *   Physical offset: $L = 7.5\\,\\mathrm{km}$.\n            *   Task 6: Compute the source frequency $f$ in Hz.\n            *   Final answer requirement: Rounded to three significant figures.\n\n    *   **Validate**:\n        *   **Scientifically Grounded**: The problem is based on Maxwell's equations and their application in geophysics (CSEM). This is a standard and well-established field. The assumptions (homogeneous medium, quasi-static approximation) are common simplifying assumptions in this context. The physics is sound.\n        *   **Well-Posed**: The problem guides the derivation step-by-step and asks for a specific numerical calculation based on the derived relationships. Each step seems to have a clear, unique outcome. The final calculation is straightforward.\n        *   **Objective**: The language is precise and technical. No subjective elements.\n        *   **Flaws check**:\n            1.  Scientific Unsoundness: None. The physics is standard electromagnetism.\n            2.  Non-Formalizable: The problem is perfectly formalizable. It is directly related to CSEM modeling.\n            3.  Incomplete/Contradictory: The problem provides all necessary information to proceed from the fundamental equations to the final numerical answer.\n            4.  Unrealistic/Infeasible: The values given ($\\sigma=0.5$ S/m for seawater, $L=7.5$ km for a CSEM survey) are realistic. The neglect of displacement currents is the quasi-static approximation, which is valid for the low frequencies typically used in marine CSEM.\n            5.  Ill-Posed: The problem is well-posed.\n            6.  Pseudo-Profound/Trivial: The problem is a standard textbook-style derivation and application. It is not trivial, as it requires understanding Maxwell's equations and the concept of skin depth, but it is not contrived.\n            7.  Outside Verifiability: The results are verifiable through standard physics calculations.\n\n    *   **Verdict**: The problem is **valid**.\n\n2.  **Solve the problem**: I'll follow the steps outlined in the problem statement.\n\n    *   **Part 1: Governing Equation for E**\n        *   Start with the time-harmonic form of Maxwell's equations. Assume $\\exp(i\\omega t)$ time dependence.\n            1.  $\\nabla \\cdot \\mathbf{D} = \\rho$\n            2.  $\\nabla \\cdot \\mathbf{B} = 0$\n            3.  $\\nabla \\times \\mathbf{E} = -\\frac{\\partial \\mathbf{B}}{\\partial t} = -i\\omega \\mathbf{B}$\n            4.  $\\nabla \\times \\mathbf{H} = \\mathbf{J} + \\frac{\\partial \\mathbf{D}}{\\partial t} = \\mathbf{J} + i\\omega \\mathbf{D}$\n        *   Apply the given conditions and constitutive relations:\n            *   $\\rho = 0$ away from the source.\n            *   $\\mathbf{B} = \\mu \\mathbf{H}$\n            *   $\\mathbf{J} = \\sigma \\mathbf{E}$ (Ohm's law)\n            *   Displacement current is negligible: $\\frac{\\partial \\mathbf{D}}{\\partial t}$ is much smaller than $\\mathbf{J}$. This means $|\\omega \\epsilon| \\ll \\sigma$. This is the quasi-static or diffusive approximation.\n        *   The equations become:\n            1.  $\\nabla \\cdot \\mathbf{E} = 0$ (since $\\rho = 0/\\epsilon$)\n            2.  $\\nabla \\cdot \\mathbf{B} = 0$\n            3.  $\\nabla \\times \\mathbf{E} = -i\\omega \\mu \\mathbf{H}$\n            4.  $\\nabla \\times \\mathbf{H} = \\sigma \\mathbf{E}$\n        *   Now, derive the equation for $\\mathbf{E}$. Take the curl of Faraday's law (Eq. 3):\n            $\\nabla \\times (\\nabla \\times \\mathbf{E}) = -i\\omega \\mu (\\nabla \\times \\mathbf{H})$\n        *   Use the vector identity $\\nabla \\times (\\nabla \\times \\mathbf{E}) = \\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^2 \\mathbf{E}$.\n        *   Substitute Ampere's law (Eq. 4) and the divergence condition (Eq. 1):\n            $\\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^2 \\mathbf{E} = -i\\omega \\mu (\\sigma \\mathbf{E})$\n            $\\nabla(0) - \\nabla^2 \\mathbf{E} = -i\\omega \\mu \\sigma \\mathbf{E}$\n            $-\\nabla^2 \\mathbf{E} = -i\\omega \\mu \\sigma \\mathbf{E}$\n        *   So, the governing equation is the vector Helmholtz equation (or diffusion equation in the frequency domain):\n            $\\nabla^2 \\mathbf{E} - i\\omega \\mu \\sigma \\mathbf{E} = 0$\n            or\n            $\\nabla^2 \\mathbf{E} = i\\omega \\mu \\sigma \\mathbf{E}$\n            Let's define the complex wavenumber $k^2 = i\\omega \\mu \\sigma$.\n            $\\nabla^2 \\mathbf{E} - k^2 \\mathbf{E} = 0$.\n\n    *   **Part 2: 1D Solution**\n        *   Assume variation only in the vertical direction, $z$. Let's consider a single component of the electric field, say $E_x(z)$, which is a valid simplification for a plane wave propagating in the $z$ direction.\n        *   The Laplacian becomes $\\nabla^2 \\rightarrow \\frac{d^2}{dz^2}$.\n        *   The equation for $E_x(z)$ is:\n            $\\frac{d^2 E_x}{dz^2} - i\\omega \\mu \\sigma E_x = 0$\n        *   This is a second-order linear homogeneous ODE with constant coefficients. The general solution is:\n            $E_x(z) = A \\exp(\\sqrt{i\\omega \\mu \\sigma} \\, z) + B \\exp(-\\sqrt{i\\omega \\mu \\sigma} \\, z)$\n        *   We need to handle $\\sqrt{i}$.\n            $i = \\exp(i\\pi/2)$.\n            $\\sqrt{i} = \\exp(i\\pi/4) = \\cos(\\pi/4) + i\\sin(\\pi/4) = \\frac{1}{\\sqrt{2}} + i\\frac{1}{\\sqrt{2}} = \\frac{1+i}{\\sqrt{2}}$.\n        *   So, $\\sqrt{i\\omega \\mu \\sigma} = \\sqrt{i} \\sqrt{\\omega \\mu \\sigma} = \\frac{1+i}{\\sqrt{2}} \\sqrt{\\omega \\mu \\sigma} = (1+i) \\sqrt{\\frac{\\omega \\mu \\sigma}{2}}$.\n        *   The solution is:\n            $E_x(z) = A \\exp\\left((1+i)\\sqrt{\\frac{\\omega \\mu \\sigma}{2}} z\\right) + B \\exp\\left(-(1+i)\\sqrt{\\frac{\\omega \\mu \\sigma}{2}} z\\right)$\n        *   Physically, we are interested in a wave that attenuates as it propagates into the medium (increasing $z$). So we discard the growing exponential term (set $A=0$). The solution form is:\n            $E_x(z) = E_0 \\exp\\left(-(1+i)\\sqrt{\\frac{\\omega \\mu \\sigma}{2}} z\\right)$. This is the expected form for a plane wave propagating into a conductive medium.\n\n    *   **Part 3 & 4: Rescaled Depth and Length Scale $\\ell$**\n        *   We are given the rescaled variable $\\zeta = z/\\ell$.\n        *   The solution in the rescaled coordinate is given as $E(\\zeta) = E_0 \\exp(-(1+i)\\zeta)$.\n        *   Let's substitute $\\zeta = z/\\ell$ into this target form:\n            $E(z) = E_0 \\exp\\left(-(1+i)\\frac{z}{\\ell}\\right)$.\n        *   Now, compare this to the form we derived from physics:\n            $E_x(z) = E_0 \\exp\\left(-(1+i)\\sqrt{\\frac{\\omega \\mu \\sigma}{2}} z\\right)$.\n        *   By comparing the exponents, we can equate the coefficients of $z$:\n            $-(1+i)\\frac{1}{\\ell} = -(1+i)\\sqrt{\\frac{\\omega \\mu \\sigma}{2}}$\n        *   This immediately gives:\n            $\\frac{1}{\\ell} = \\sqrt{\\frac{\\omega \\mu \\sigma}{2}}$\n        *   Solving for $\\ell$:\n            $\\ell = \\sqrt{\\frac{2}{\\omega \\mu \\sigma}}$\n        *   This length scale $\\ell$ is the classic electromagnetic skin depth (or sometimes called the diffusive length scale).\n\n    *   **Part 5 & 6: Survey Design and Frequency Calculation**\n        *   Now we apply this to the specific survey problem.\n        *   Given data:\n            *   $\\sigma = 0.5\\,\\mathrm{S/m}$\n            *   $\\mu = \\mu_0 = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$\n            *   $L = 7.5\\,\\mathrm{km} = 7500\\,\\mathrm{m}$\n            *   $L/\\ell = 10$\n        *   The problem uses $L$ as a horizontal offset. The derivation of $\\ell$ was for vertical propagation ($z$). However, the problem statement says \"use this diffusive scaling length\". This implies that the characteristic length scale for attenuation is the same, regardless of the specific geometry (horizontal vs vertical), as long as the medium is homogeneous and isotropic. This is a reasonable physical assumption. The skin depth defines the e-folding distance for EM fields in a conductor.\n        *   From the survey design constraint, we can find the required value of $\\ell$:\n            $L/\\ell = 10 \\implies \\ell = L/10$.\n            $\\ell = 7500\\,\\mathrm{m} / 10 = 750\\,\\mathrm{m}$.\n        *   Now we use the expression for $\\ell$ derived earlier and solve for the frequency.\n            $\\ell = \\sqrt{\\frac{2}{\\omega \\mu \\sigma}}$\n        *   Square both sides:\n            $\\ell^2 = \\frac{2}{\\omega \\mu \\sigma}$\n        *   Solve for $\\omega$:\n            $\\omega = \\frac{2}{\\ell^2 \\mu \\sigma}$\n        *   The problem asks for the frequency $f$ in Hertz. We know $\\omega = 2\\pi f$.\n            $2\\pi f = \\frac{2}{\\ell^2 \\mu \\sigma}$\n            $f = \\frac{1}{\\pi \\ell^2 \\mu \\sigma}$\n        *   Now, substitute the numerical values:\n            *   $\\ell = 750\\,\\mathrm{m}$\n            *   $\\sigma = 0.5\\,\\mathrm{S/m}$\n            *   $\\mu = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$\n        *   Calculation:\n            $f = \\frac{1}{\\pi (750)^2 (4\\pi \\times 10^{-7}) (0.5)}$\n            $f = \\frac{1}{\\pi (562500) (4\\pi \\times 10^{-7}) (0.5)}$\n            $f = \\frac{1}{4 \\pi^2 \\times (562500 \\times 0.5 \\times 10^{-7})}$\n            $f = \\frac{1}{4 \\pi^2 \\times (281250 \\times 10^{-7})}$\n            $f = \\frac{1}{4 \\pi^2 \\times (2.8125 \\times 10^{-2})}$\n            $f = \\frac{100}{4 \\pi^2 \\times 2.8125}$\n            $f = \\frac{100}{11.25 \\pi^2}$\n            Let's use a calculator for the denominator.\n            Denominator = $\\pi \\times (750)^2 \\times (4\\pi \\times 10^{-7}) \\times 0.5$\n            = $\\pi \\times 562500 \\times (2\\pi \\times 10^{-7})$\n            = $2 \\pi^2 \\times 562500 \\times 10^{-7}$\n            = $2 \\pi^2 \\times 5.625 \\times 10^5 \\times 10^{-7}$\n            = $2 \\pi^2 \\times 5.625 \\times 10^{-2}$\n            = $11.25 \\pi^2 \\times 10^{-2}$\n            $f = \\frac{1}{11.25 \\pi^2 \\times 10^{-2}} = \\frac{100}{11.25 \\pi^2}$\n            $\\pi^2 \\approx (3.14159)^2 \\approx 9.8696$\n            $f \\approx \\frac{100}{11.25 \\times 9.8696} \\approx \\frac{100}{111.033}$\n            $f \\approx 0.90063...$\n        *   The problem asks to round the answer to three significant figures.\n            $f \\approx 0.901$ Hz.\n\n3.  **Final formatting**:\n    *   The solution part must be written in a single block with LaTeX for all math.\n    *   The final answer must be in a `\\boxed{...}` environment.\n    *   I need to be careful with the derivation steps, ensuring they are logical and well-explained.\n\n    *   **Reviewing the derivation**:\n        *   Maxwell's equations: OK.\n        *   Time-harmonic form: OK.\n        *   Constitutive relations and approximations: OK.\n        *   Derivation of the vector Helmholtz equation (diffusive form): OK.\n            $\\nabla \\times (\\nabla \\times \\mathbf{E}) = -i\\omega\\mu(\\nabla \\times \\mathbf{H}) \\implies \\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^2\\mathbf{E} = -i\\omega\\mu(\\sigma\\mathbf{E})$.\n            Since $\\nabla \\cdot \\mathbf{D} = 0 \\implies \\nabla \\cdot \\mathbf{E} = 0$, we get $\\nabla^2\\mathbf{E} = i\\omega\\mu\\sigma\\mathbf{E}$. Looks correct.\n        *   1D plane wave solution:\n            $\\frac{d^2 E}{dz^2} = i\\omega\\mu\\sigma E$.\n            Solution is $E(z) = E_0 \\exp(-kz)$ for a wave attenuating in the $+z$ direction, where $k^2 = i\\omega\\mu\\sigma$.\n            $k = \\sqrt{i\\omega\\mu\\sigma} = \\sqrt{i}\\sqrt{\\omega\\mu\\sigma} = \\frac{1+i}{\\sqrt{2}}\\sqrt{\\omega\\mu\\sigma} = (1+i)\\sqrt{\\frac{\\omega\\mu\\sigma}{2}}$.\n            So $E(z) = E_0 \\exp\\left( -(1+i)\\sqrt{\\frac{\\omega\\mu\\sigma}{2}} z \\right)$. Correct.\n        *   Derivation of $\\ell$:\n            Comparing $E(z) = E_0 \\exp(-(1+i)z/\\ell)$ with the derived form.\n            $\\frac{1}{\\ell} = \\sqrt{\\frac{\\omega\\mu\\sigma}{2}}$.\n            $\\ell = \\sqrt{\\frac{2}{\\omega\\mu\\sigma}}$. This is the skin depth, correct.\n        *   Numerical calculation:\n            $\\ell = L/10 = 7500/10 = 750$ m.\n            From $\\ell^2 = \\frac{2}{\\omega\\mu\\sigma}$, we get $\\omega = \\frac{2}{\\ell^2\\mu\\sigma}$.\n            $f = \\frac{\\omega}{2\\pi} = \\frac{1}{2\\pi} \\frac{2}{\\ell^2\\mu\\sigma} = \\frac{1}{\\pi\\ell^2\\mu\\sigma}$.\n            $f = \\frac{1}{\\pi (750)^2 (4\\pi \\times 10^{-7}) (0.5)} = \\frac{1}{2 \\pi^2 (750)^2 (10^{-7})}$.\n            $f = \\frac{1}{2 \\pi^2 (562500) (10^{-7})} = \\frac{1}{2 \\pi^2 (5.625 \\times 10^5) (10^{-7})} = \\frac{1}{2 \\pi^2 (5.625 \\times 10^{-2})} = \\frac{100}{11.25 \\pi^2}$.\n            $f \\approx 0.90063...$ Hz.\n            Rounding to three significant figures gives $0.901$.\n\nThe logic and calculations seem sound. The interpretation of using the 1D scaling length for a horizontal offset is standard in this context, where $\\ell$ represents the characteristic scale of attenuation in the homogeneous medium. The problem is well-posed and the solution path is clear. I will now write out the full solution as per the required format. All mathematical symbols and numbers will be in LaTeX. I will not use any markdown headers. The final answer will be a single number in the specified box.", "answer": "$$ \\boxed{0.901} $$", "id": "3582341"}, {"introduction": "Moving from theory to practice requires rigorous verification of our numerical code. This exercise bridges the analytical and computational realms by first deriving a semi-analytic solution for a canonical problem: a horizontal electric dipole on a conductive half-space. We will then use this \"ground truth\" to perform a grid refinement study, a fundamental technique to confirm that our finite-difference approximation converges at the theoretically expected rate, thereby building confidence in our numerical implementation [@problem_id:3582350].", "problem": "Consider Controlled-Source Electromagnetics (CSEM) in the electroquasistatic limit for a homogeneous conducting half-space occupying $z \\ge 0$, with air above ($z < 0$) being electrically insulating. A horizontal electric dipole (two point electrodes of equal magnitude and opposite sign) lies on the surface at $z = 0$, separated along the $x$-axis by a distance $a$. Let the positive electrode inject current $+I$ at $(x,y) = (a/2,0)$ and the negative electrode withdraw current $-I$ at $(x,y) = (-a/2,0)$. Assume an isotropic, homogeneous conductivity $\\sigma$ in the half-space, with resistivity $\\rho = 1/\\sigma$, and magnetic permeability equal to that of free space $\\mu_0$. Neglect displacement currents and time variation so that the electroquasistatic approximation is valid.\n\nStarting from Maxwell’s equations and conservation of charge, one may reduce the governing equations for the scalar electric potential $\\Phi(x,y,z)$ to the diffusion-type equation in the conducting half-space and appropriate boundary conditions at $z=0$ (no normal current flow into air except at the electrodes, where point-source singularities apply). From this fundamental base, derive a semi-analytic reference expression for the surface electric field component $E_x(x,y)$ in volts per meter ($\\mathrm{V/m}$) generated by the described horizontal electric dipole. Your derivation must proceed from first principles without invoking pre-packaged target formulas.\n\nDesign a numerical grid refinement study to verify the convergence rate of a chosen discretization. Specifically, approximate $E_x(x,y)$ on the surface using a second-order centered finite-difference approximation applied to the surface potential $\\Phi(x,y,0)$ in the $x$-direction with grid spacing $h$, and quantify the pointwise absolute error by comparing against the semi-analytic reference solution. Estimate the empirical convergence rate $p$ by performing a linear least-squares fit of $\\log(\\text{error})$ versus $\\log(h)$ across a refinement sequence, where the error is expected to behave as $C h^p$ for sufficiently small $h$.\n\nPhysical units: express $E_x$ in $\\mathrm{V/m}$, $I$ in amperes ($\\mathrm{A}$), distances in meters ($\\mathrm{m}$), and $\\sigma$ in siemens per meter ($\\mathrm{S/m}$). Angles are not involved. The final estimated convergence rates $p$ are dimensionless.\n\nYour program must implement the semi-analytic reference solution and the finite-difference approximation described above, carry out the refinement study, and produce the empirical convergence rates for the following test suite. For each case, use the listed refinement sequence of $h$ values:\n\n- Case 1 (general happy path): $I = 1.0\\,\\mathrm{A}$, $\\sigma = 1.0\\,\\mathrm{S/m}$, $\\rho = 1.0\\,\\Omega\\cdot\\mathrm{m}$, $a = 50\\,\\mathrm{m}$, receiver at $x = 200\\,\\mathrm{m}$, $y = 0\\,\\mathrm{m}$, refinement sequence $h \\in \\{50, 25, 12.5, 6.25, 3.125\\}\\,\\mathrm{m}$.\n- Case 2 (nearer to the electrodes, stronger field gradients): $I = 1.0\\,\\mathrm{A}$, $\\sigma = 2.0\\,\\mathrm{S/m}$, $\\rho = 0.5\\,\\Omega\\cdot\\mathrm{m}$, $a = 10\\,\\mathrm{m}$, receiver at $x = 30\\,\\mathrm{m}$, $y = 0\\,\\mathrm{m}$, refinement sequence $h \\in \\{20, 10, 5, 2.5, 1.25\\}\\,\\mathrm{m}$.\n- Case 3 (off-axis receiver and lower conductivity): $I = 0.5\\,\\mathrm{A}$, $\\sigma = 0.1\\,\\mathrm{S/m}$, $\\rho = 10.0\\,\\Omega\\cdot\\mathrm{m}$, $a = 20\\,\\mathrm{m}$, receiver at $x = 40\\,\\mathrm{m}$, $y = 20\\,\\mathrm{m}$, refinement sequence $h \\in \\{20, 10, 5, 2.5, 1.25\\}\\,\\mathrm{m}$.\n\nYour program should produce a single line of output containing the three estimated convergence rates $p$ for the cases above as a comma-separated list enclosed in square brackets, for example $\\, [p_1,p_2,p_3] \\,$. The quantities $p_1, p_2, p_3$ must be floating-point numbers.", "solution": "The problem is assessed to be valid. It is scientifically grounded in the principles of electromagnetism, specifically the electroquasistatic approximation for DC resistivity surveying. The problem is well-posed, objective, and provides all necessary information to derive a semi-analytic solution and perform the subsequent numerical verification. It constitutes a standard exercise in computational geophysics.\n\n### Part 1: Derivation of the Semi-Analytic Expression for $E_x$\n\nWe begin from the fundamental equations governing steady-state current flow in the electroquasistatic limit.\n\n1.  **Governing Equations**: In this limit, time derivatives are negligible ($\\partial/\\partial t \\approx 0$). Maxwell's equations simplify accordingly. Faraday's law becomes $\\nabla \\times \\mathbf{E} = 0$, which implies that the electric field $\\mathbf{E}$ is conservative and can be expressed as the negative gradient of a scalar potential $\\Phi$:\n    $$ \\mathbf{E} = -\\nabla \\Phi $$\n    Ohm's law relates the current density $\\mathbf{J}$ to the electric field $\\mathbf{E}$ through the medium's conductivity $\\sigma$:\n    $$ \\mathbf{J} = \\sigma \\mathbf{E} = -\\sigma \\nabla \\Phi $$\n    The conservation of charge for steady currents requires that the divergence of the current density equals the volume source density, $q_v$:\n    $$ \\nabla \\cdot \\mathbf{J} = q_v $$\n    Combining these equations for a homogeneous medium where $\\sigma$ is constant, we obtain Poisson's equation for the electric potential:\n    $$ \\nabla \\cdot (-\\sigma \\nabla \\Phi) = q_v \\implies \\nabla^2 \\Phi = -\\frac{q_v}{\\sigma} $$\n    Using resistivity $\\rho = 1/\\sigma$, this is $\\nabla^2 \\Phi = -\\rho q_v$.\n\n2.  **Source Representation**: The source is a pair of point electrodes on the surface injecting and withdrawing current. A point electrode injecting current $I$ at a location $\\mathbf{r}_s$ can be represented by a delta function source term $q_v(\\mathbf{r}) = I \\delta(\\mathbf{r} - \\mathbf{r}_s)$.\n\n3.  **Half-Space Solution using Method of Images**: We are considering a conducting half-space for $z \\ge 0$ and an insulating half-space (air) for $z < 0$. The boundary condition at the surface $z=0$ is that no current flows into the air, meaning the normal component of the current density is zero: $J_z|_{z=0} = 0$. Since $J_z = -\\sigma \\frac{\\partial \\Phi}{\\partial z}$, this implies a Neumann boundary condition on the potential:\n    $$ \\frac{\\partial \\Phi}{\\partial z} \\bigg|_{z=0} = 0 $$\n    To solve Poisson's equation in a half-space with this boundary condition, we use the method of images. For a point source $I$ at $\\mathbf{r}_s = (x_s, y_s, z_s)$ in the conducting medium, we place an image source of the same strength and sign at $\\mathbf{r}_i = (x_s, y_s, -z_s)$ in the \"image\" region. The potential in the conducting medium ($z \\ge 0$) is the superposition of the potentials from the real and image sources in an unbounded medium.\n\n    The fundamental solution (Green's function) for $\\nabla^2 \\Phi = -\\rho I \\delta(\\mathbf{r} - \\mathbf{r}_s)$ in an unbounded 3D space is $\\Phi(\\mathbf{r}) = \\frac{\\rho I}{4\\pi |\\mathbf{r} - \\mathbf{r}_s|}$.\n\n    In our specific problem, the sources are located on the surface, $z_s=0$. In this case, the image source is coincident with the real source. The standard method of images needs careful application. A source on the boundary injects current only into the conducting half-space. The total current flux integrated over a hemisphere enclosing the source must be $I$. The full-space solution provides a flux of $I/2$ over a hemisphere. To satisfy the total flux condition, the potential must be doubled. Therefore, the potential at a point $\\mathbf{r}=(x,y,z)$ in the half-space due to a single current source $I$ at $\\mathbf{r}_s$ on the surface is:\n    $$ \\Phi_{\\text{single}}(\\mathbf{r}) = \\frac{\\rho I}{2\\pi |\\mathbf{r} - \\mathbf{r}_s|} $$\n\n4.  **Superposition for the Dipole**: Our source is a horizontal electric dipole consisting of a source $+I$ at $\\mathbf{r}_+ = (a/2, 0, 0)$ and a sink $-I$ at $\\mathbf{r}_- = (-a/2, 0, 0)$. By the principle of superposition, the total potential is the sum of the potentials from each source:\n    $$ \\Phi(x, y, z) = \\frac{\\rho}{2\\pi} \\left( \\frac{+I}{|\\mathbf{r} - \\mathbf{r}_+|} + \\frac{-I}{|\\mathbf{r} - \\mathbf{r}_-|} \\right) $$\n    $$ \\Phi(x, y, z) = \\frac{I\\rho}{2\\pi} \\left( \\frac{1}{\\sqrt{(x - a/2)^2 + y^2 + z^2}} - \\frac{1}{\\sqrt{(x + a/2)^2 + y^2 + z^2}} \\right) $$\n\n5.  **Electric Field Calculation**: The electric field component $E_x$ is found by differentiating the potential with respect to $x$:\n    $$ E_x = -\\frac{\\partial \\Phi}{\\partial x} $$\n    Differentiating the potential expression term by term yields:\n    $$ E_x(x,y,z) = -\\frac{I\\rho}{2\\pi} \\frac{\\partial}{\\partial x} \\left[ \\left((x - a/2)^2 + y^2 + z^2\\right)^{-1/2} - \\left((x + a/2)^2 + y^2 + z^2\\right)^{-1/2} \\right] $$\n    $$ E_x(x,y,z) = -\\frac{I\\rho}{2\\pi} \\left[ -\\frac{x-a/2}{\\left((x-a/2)^2+y^2+z^2\\right)^{3/2}} + \\frac{x+a/2}{\\left((x+a/2)^2+y^2+z^2\\right)^{3/2}} \\right] $$\n    $$ E_x(x,y,z) = \\frac{I\\rho}{2\\pi} \\left( \\frac{x-a/2}{\\left((x-a/2)^2+y^2+z^2\\right)^{3/2}} - \\frac{x+a/2}{\\left((x+a/2)^2+y^2+z^2\\right)^{3/2}} \\right) $$\n    The problem asks for the surface electric field, so we evaluate this expression at $z=0$:\n    $$ E_x(x,y) = \\frac{I\\rho}{2\\pi} \\left( \\frac{x - a/2}{\\left((x - a/2)^2 + y^2\\right)^{3/2}} - \\frac{x + a/2}{\\left((x + a/2)^2 + y^2\\right)^{3/2}} \\right) $$\n    This is the semi-analytic reference solution for the surface electric field component $E_x$.\n\n### Part 2: Numerical Grid Refinement Study\n\nThe objective is to verify the convergence rate of a finite-difference approximation for $E_x$.\n\n1.  **Numerical Approximation**: We approximate $E_x = -\\partial \\Phi / \\partial x$ at the surface location $(x_r, y_r)$ using a second-order centered finite-difference formula with grid spacing $h$:\n    $$ E_{x,h}(x_r, y_r) \\approx -\\frac{\\Phi(x_r+h, y_r, 0) - \\Phi(x_r-h, y_r, 0)}{2h} $$\n    Here, $\\Phi(x,y,0)$ is the semi-analytic potential on the surface derived previously:\n    $$ \\Phi(x, y, 0) = \\frac{I\\rho}{2\\pi} \\left( \\frac{1}{\\sqrt{(x - a/2)^2 + y^2}} - \\frac{1}{\\sqrt{(x + a/2)^2 + y^2}} \\right) $$\n    This scheme is expected to have a truncation error of order $h^2$, meaning it is second-order accurate.\n\n2.  **Error Analysis and Convergence Rate**: The pointwise absolute error $\\epsilon(h)$ at the receiver location is the difference between the true (semi-analytic) value $E_x$ and the numerical approximation $E_{x,h}$:\n    $$ \\epsilon(h) = |E_x(x_r, y_r) - E_{x,h}(x_r, y_r)| $$\n    For a method with a convergence rate $p$, the error is expected to behave as $\\epsilon(h) \\approx C h^p$ for some constant $C$ and sufficiently small $h$. To determine $p$ empirically, we take the logarithm of this relationship:\n    $$ \\log(\\epsilon) = \\log(C) + p \\log(h) $$\n    This reveals a linear relationship between $\\log(\\epsilon)$ and $\\log(h)$, where the slope of the line is the convergence rate $p$.\n\n3.  **Procedure**: For each test case:\n    a. Calculate the \"true\" value $E_{x,\\text{true}} = E_x(x_r, y_r)$ using the derived semi-analytic formula.\n    b. For each grid spacing $h$ in the specified refinement sequence, calculate the numerical approximation $E_{x,h}$ and the corresponding error $\\epsilon(h)$.\n    c. Perform a linear least-squares regression on the set of points $\\{(\\log(h), \\log(\\epsilon))\\}$.\n    d. The slope of the resulting regression line is the empirically estimated convergence rate $p$.\n\nThe implementation will follow this procedure for each of the three specified test cases. Given the use of a second-order centered difference scheme on a sufficiently smooth function (the potential is smooth away from the source singularities), the expected empirical convergence rate $p$ is $2$.", "answer": "```python\nimport numpy as np\nfrom scipy.stats import linregress\n\ndef solve():\n    \"\"\"\n    Solves the CSEM problem by deriving an analytic solution, implementing a\n    numerical approximation, and performing a grid refinement study to find\n    the empirical convergence rate for three test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1 (general happy path): I, sigma, a, rx, ry, h_vals\n        (1.0, 1.0, 50.0, 200.0, 0.0, [50.0, 25.0, 12.5, 6.25, 3.125]),\n        # Case 2 (nearer to electrodes): I, sigma, a, rx, ry, h_vals\n        (1.0, 2.0, 10.0, 30.0, 0.0, [20.0, 10.0, 5.0, 2.5, 1.25]),\n        # Case 3 (off-axis and low conductivity): I, sigma, a, rx, ry, h_vals\n        (0.5, 0.1, 20.0, 40.0, 20.0, [20.0, 10.0, 5.0, 2.5, 1.25])\n    ]\n\n    def get_surface_potential(x: float, y: float, I: float, rho: float, a: float) -> float:\n        \"\"\"\n        Calculates the semi-analytic electric potential on the surface z=0.\n\n        Args:\n            x (float): x-coordinate of the observation point.\n            y (float): y-coordinate of the observation point.\n            I (float): Source current in Amperes.\n            rho (float): Resistivity of the half-space in Ohm-meters.\n            a (float): Separation distance of the dipole electrodes in meters.\n\n        Returns:\n            float: The scalar electric potential in Volts.\n        \"\"\"\n        a_half = a / 2.0\n        # Distance from the positive electrode at (a/2, 0)\n        r_plus = np.sqrt((x - a_half)**2 + y**2)\n        # Distance from the negative electrode at (-a/2, 0)\n        r_minus = np.sqrt((x + a_half)**2 + y**2)\n\n        # The problem setup ensures observation points are not on the sources,\n        # so r_plus and r_minus will be non-zero.\n        potential = (I * rho / (2.0 * np.pi)) * (1.0 / r_plus - 1.0 / r_minus)\n        return potential\n\n    def get_analytic_Ex(x: float, y: float, I: float, rho: float, a: float) -> float:\n        \"\"\"\n        Calculates the semi-analytic E_x component on the surface z=0.\n\n        Args:\n            x (float): x-coordinate of the observation point.\n            y (float): y-coordinate of the observation point.\n            I (float): Source current in Amperes.\n            rho (float): Resistivity of the half-space in Ohm-meters.\n            a (float): Separation distance of the dipole electrodes in meters.\n\n        Returns:\n            float: The x-component of the electric field in V/m.\n        \"\"\"\n        a_half = a / 2.0\n        \n        # Numerator and denominator for the term from the positive electrode\n        term_plus_num = x - a_half\n        term_plus_den = ((x - a_half)**2 + y**2)**1.5\n        \n        # Numerator and denominator for the term from the negative electrode\n        term_minus_num = x + a_half\n        term_minus_den = ((x + a_half)**2 + y**2)**1.5\n\n        term_plus = term_plus_num / term_plus_den\n        term_minus = term_minus_num / term_minus_den\n\n        ex = (I * rho / (2.0 * np.pi)) * (term_plus - term_minus)\n        return ex\n\n    convergence_rates = []\n    for case in test_cases:\n        I, sigma, a, rx, ry, h_vals = case\n        rho = 1.0 / sigma\n        \n        # 1. Calculate the \"true\" analytic value for the electric field\n        ex_true = get_analytic_Ex(rx, ry, I, rho, a)\n        \n        errors = []\n        for h in h_vals:\n            # 2. Calculate the numerical approximation using a centered finite difference\n            pot_plus_h = get_surface_potential(rx + h, ry, I, rho, a)\n            pot_minus_h = get_surface_potential(rx - h, ry, I, rho, a)\n            \n            ex_numerical = -(pot_plus_h - pot_minus_h) / (2.0 * h)\n            \n            # 3. Calculate the pointwise absolute error\n            error = np.abs(ex_true - ex_numerical)\n            errors.append(error)\n\n        # 4. Perform a linear least-squares fit of log(error) vs. log(h)\n        # The relationship is log(error) = p * log(h) + log(C)\n        # We need the slope 'p' of this linear relationship.\n        log_h = np.log(h_vals)\n        log_errors = np.log(errors)\n        \n        # linregress(x, y) where x=log_h, y=log_errors\n        slope, _, _, _, _ = linregress(log_h, log_errors)\n        \n        convergence_rates.append(slope)\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, convergence_rates))}]\")\n\nsolve()\n```", "id": "3582350"}, {"introduction": "With verified numerical operators, we can construct a complete solver for more complex, heterogeneous geological models. This practice involves building a two-dimensional finite-difference solver and introducing a powerful method for its validation: the principle of electromagnetic reciprocity. By numerically demonstrating that swapping the source and receiver positions yields the same result, we can validate the correctness and symmetry of our entire simulation framework, a crucial check for models where no analytic solution exists [@problem_id:3582367].", "problem": "Consider a two-dimensional controlled-source electromagnetic problem with spatially varying electrical conductivity $\\sigma(\\mathbf{x})$ on a rectangular domain $\\Omega = [0,L_x] \\times [0,L_y]$. Assume invariance along the $z$-axis and time-harmonic fields with $e^{i\\omega t}$ convention. Begin from Maxwell's equations in the frequency domain ($\\nabla \\times \\mathbf{E} = -i\\omega\\mu\\mathbf{H}$ and $\\nabla \\times \\mathbf{H} = \\sigma \\mathbf{E} + i\\omega \\epsilon \\mathbf{E} + \\mathbf{J}_s$), and invoke the quasi-static conduction regime where displacement currents are negligible compared to conduction currents (i.e., $|\\omega \\epsilon| \\ll \\sigma$ everywhere in $\\Omega$). Under a Transverse Electric (TE) and Transverse Magnetic (TM) reduction with fields polarized such that either $E_z$ or $H_z$ is the nonzero component, derive scalar partial differential equations governing $E_z(\\mathbf{x})$ and $H_z(\\mathbf{x})$ in the presence of an impressed source $\\mathbf{J}_s(\\mathbf{x})$.\n\nYour derivation should start from these fundamental laws and definitions:\n- Maxwell's equations in the frequency domain under the $e^{i\\omega t}$ convention.\n- The constitutive relations for a linear, isotropic medium: $\\mathbf{B} = \\mu \\mathbf{H}$ and $\\mathbf{D} = \\epsilon \\mathbf{E}$.\n- The quasi-static conduction assumption $|\\omega \\epsilon| \\ll \\sigma$, with $\\mu(\\mathbf{x}) = \\mu_0$ constant and $\\epsilon(\\mathbf{x})$ neglected.\n\nFrom these, show that both TE ($E_z$) and TM ($H_z$) scalar formulations lead to second-order linear differential operators of the generic form $\\nabla \\cdot (a(\\mathbf{x}) \\nabla u(\\mathbf{x})) + c(\\mathbf{x}) u(\\mathbf{x}) = s(\\mathbf{x})$, and identify the coefficient functions $a(\\mathbf{x})$ and $c(\\mathbf{x})$ for each formulation in terms of $\\sigma(\\mathbf{x})$, $\\mu_0$, and $\\omega$.\n\nDiscretize both scalar equations on a uniform Cartesian grid using the Finite Difference Method (FDM) with homogeneous Dirichlet boundary conditions ($u=0$ on $\\partial \\Omega$). Use a five-point stencil for the operator $\\nabla \\cdot (a(\\mathbf{x}) \\nabla u(\\mathbf{x}))$, and apply harmonic averaging for face-centered values of $a(\\mathbf{x})$ between neighboring cells to ensure a symmetric discrete operator. Model the impressed source $s(\\mathbf{x})$ as a grid-based point source localized to one interior node, represented as a discrete delta with amplitude scaled consistently with the grid spacing.\n\nDefine the Green's function $G(\\mathbf{x}_r,\\mathbf{x}_s)$ for each formulation (electric and magnetic) as the field at the receiver location $\\mathbf{x}_r$ due to a unit point source at $\\mathbf{x}_s$. Construct a numerical reciprocity test by swapping source and receiver positions and verifying the symmetry $G(\\mathbf{x}_r,\\mathbf{x}_s) = G(\\mathbf{x}_s,\\mathbf{x}_r)$ for both the electric and magnetic formulations. Implement a complex-valued linear solver to compute the discrete fields.\n\nUse the following physical constants and units and adhere to them in your derivation and discretization:\n- Magnetic permeability $\\mu_0 = 4\\pi \\times 10^{-7}$ in henry per meter (H/m).\n- Lengths in meters (m).\n- Frequency in hertz (Hz).\n- Conductivity in siemens per meter (S/m).\nNo angles are involved. The final program output consists of boolean values and therefore does not require physical units.\n\nTest Suite:\nFor each case below, build the conductivity model $\\sigma(\\mathbf{x})$ and evaluate reciprocity for both formulations. The domain is $L_x = 1.0$ m, $L_y = 1.0$ m, discretized on a $(N_x,N_y)$ grid with $N_x = N_y = 41$ nodes. The grid spacing is uniform and equal along $x$ and $y$. Receiver and source positions are specified in meters and must be mapped to the nearest interior grid node. For each case, test reciprocity by computing $G(\\mathbf{x}_r,\\mathbf{x}_s)$ and $G(\\mathbf{x}_s,\\mathbf{x}_r)$ and returning a boolean indicating whether their absolute difference, normalized by the maximum magnitude of the two, is less than a tolerance of $10^{-7}$.\n\n- Case 1 (general inhomogeneous): Frequency $f = 10$ Hz. Background conductivity $\\sigma = 1.0$ S/m. A circular low-conductivity inclusion with $\\sigma = 0.1$ S/m centered at $(0.6,0.4)$ of radius $0.15$ m, and a vertical high-conductivity strip with $\\sigma = 10.0$ S/m for $x \\in [0.2,0.25]$ for all $y$. Source at $\\mathbf{x}_s = (0.10,0.10)$ m. Receiver at $\\mathbf{x}_r = (0.80,0.90)$ m.\n- Case 2 (adjacent nodes near contrast): Frequency $f = 1$ Hz. Background conductivity $\\sigma = 0.5$ S/m. A circular high-conductivity inclusion with $\\sigma = 5.0$ S/m centered at $(0.5,0.5)$ of radius $0.20$ m. Source at $\\mathbf{x}_s = (0.50,0.70)$ m. Receiver at $\\mathbf{x}_r = (0.525,0.70)$ m.\n- Case 3 (strong checkerboard contrast, near-boundary points): Frequency $f = 100$ Hz. Checkerboard conductivity with base $\\sigma = 0.1$ S/m, and cells where $\\lfloor i/5 \\rfloor + \\lfloor j/5 \\rfloor$ is even have $\\sigma = 50.0$ S/m, where $(i,j)$ are the grid indices. Source at $\\mathbf{x}_s = (0.02,0.95)$ m. Receiver at $\\mathbf{x}_r = (0.98,0.05)$ m.\n\nAlgorithmic Requirements:\n- Assemble the discrete operator for the electric formulation using $a_E(\\mathbf{x})$ and $c_E(\\mathbf{x})$ derived from first principles, and similarly for the magnetic formulation with $a_H(\\mathbf{x})$ and $c_H(\\mathbf{x})$.\n- Use harmonic averaging at cell faces to compute face-centered $a(\\mathbf{x})$ values.\n- Impose homogeneous Dirichlet boundary conditions by excluding boundary nodes from the system of equations and properly accounting for boundary-adjacent fluxes in the diagonal.\n- Represent the source as a unit discrete delta at the source node, scaled by the square of the grid spacing if appropriate to approximate a physical delta distribution.\n- Solve the resulting complex-valued linear systems to obtain the field at the receiver.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as $[\\text{E1},\\text{H1},\\text{E2},\\text{H2},\\text{E3},\\text{H3}]$, where each entry is a boolean indicating whether reciprocity holds in the specified case for the electric (E) or magnetic (H) formulation. For example, \"[True,False,True,True,False,True]\". The output must be the only text printed by the program.", "solution": "The user wants to solve a computational geophysics problem.\nMy analysis of the user's request is as follows:\n1.  **Derive the Governing Equations**: Start from Maxwell's equations in the frequency domain and derive the scalar partial differential equations (PDEs) for the Transverse Electric (TE) and Transverse Magnetic (TM) modes under the quasi-static approximation.\n2.  **Identify Coefficients**: For each mode, cast the derived PDE into the generic form $\\nabla \\cdot (a(\\mathbf{x}) \\nabla u(\\mathbf{x})) + c(\\mathbf{x}) u(\\mathbf{x}) = s(\\mathbf{x})$ and identify the coefficients $a(\\mathbf{x})$ and $c(\\mathbf{x})$.\n3.  **Discretize**: Apply the Finite Difference Method (FDM) on a uniform Cartesian grid to discretize the PDEs. This involves using a five-point stencil and harmonic averaging for the coefficient $a(\\mathbf{x})$ to ensure the resulting discrete operator is symmetric.\n4.  **Implement Reciprocity Test**: The problem defines the Green's function $G(\\mathbf{x}_r, \\mathbf{x}_s)$ and asks to numerically verify the reciprocity relation $G(\\mathbf{x}_r, \\mathbf{x}_s) = G(\\mathbf{x}_s, \\mathbf{x}_r)$. This test relies on the symmetry of the assembled discrete operator.\n5.  **Code Implementation**: Write a self-contained Python script to perform these steps for three distinct test cases, solving the resulting complex-valued linear systems and reporting whether reciprocity holds for each case and mode.\n\nBased on this, I will structure my response by first presenting the theoretical derivation and numerical methodology, followed by the complete Python implementation.\n\n---\nWe begin by validating the problem statement.\n\n### Step 1: Extract Givens\n- **Fundamental Equations**: $\\nabla \\times \\mathbf{E} = -i\\omega\\mu\\mathbf{H}$ and $\\nabla \\times \\mathbf{H} = \\sigma \\mathbf{E} + i\\omega \\epsilon \\mathbf{E} + \\mathbf{J}_s$.\n- **Constitutive Relations**: $\\mathbf{B} = \\mu \\mathbf{H}$ and $\\mathbf{D} = \\epsilon \\mathbf{E}$.\n- **Assumptions**: 2D domain $\\Omega = [0,L_x] \\times [0,L_y]$; invariance along $z$-axis ($\\partial/\\partial z = 0$); time-harmonic fields with $e^{i\\omega t}$ convention; quasi-static regime $|\\omega \\epsilon| \\ll \\sigma$; constant magnetic permeability $\\mu(\\mathbf{x}) = \\mu_0$; $\\epsilon(\\mathbf{x})$ is neglected.\n- **Field Decompositions**: Transverse Electric (TE) mode with $\\mathbf{E} = (0, 0, E_z)$ and Transverse Magnetic (TM) mode with $\\mathbf{H} = (0, 0, H_z)$.\n- **Target PDE Form**: $\\nabla \\cdot (a(\\mathbf{x}) \\nabla u(\\mathbf{x})) + c(\\mathbf{x}) u(\\mathbf{x}) = s(\\mathbf{x})$.\n- **Numerical Method**: Finite Difference Method (FDM) on a uniform Cartesian grid; homogeneous Dirichlet boundary conditions ($u=0$ on $\\partial\\Omega$); five-point stencil; harmonic averaging for face-centered coefficients; grid-based point source.\n- **Reciprocity Test**: Verify symmetry $G(\\mathbf{x}_r, \\mathbf{x}_s) = G(\\mathbf{x}_s, \\mathbf{x}_r)$ with a relative difference tolerance of $10^{-7}$.\n- **Constants**: $\\mu_0 = 4\\pi \\times 10^{-7}$ H/m.\n- **Test Suite**: Three cases are defined with specific domain size ($L_x=L_y=1.0$ m), grid size ($N_x=N_y=41$), frequency, conductivity models, and source/receiver locations.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in Maxwell's theory and standard approximations. It is well-posed, objective, and self-contained, providing all necessary information for a unique solution. The numerical methods specified (FDM with harmonic averaging) are standard and appropriate for the task. The reciprocity principle is a fundamental property of the physical system, and testing it numerically is a valid method for verifying the symmetry of the discrete operator. The problem is a non-trivial but standard exercise in computational electromagnetics.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. We proceed with the solution.\n\n### Derivation of the Governing Equations\n\nThe analysis starts from Maxwell's equations in the frequency domain, assuming a time-harmonic dependency of $e^{i\\omega t}$. Under the quasi-static approximation, where conduction currents dominate displacement currents ($\\sigma \\gg |\\omega\\epsilon|$), Maxwell's equations simplify to:\n$$\n\\nabla \\times \\mathbf{E} = -i\\omega\\mu_0\\mathbf{H} \\quad (1)\n$$\n$$\n\\nabla \\times \\mathbf{H} = \\sigma(\\mathbf{x}) \\mathbf{E} + \\mathbf{J}_s \\quad (2)\n$$\nHere, $\\mathbf{E}$ is the electric field, $\\mathbf{H}$ is the magnetic field, $\\omega$ is the angular frequency, $\\mu_0$ is the magnetic permeability of free space, $\\sigma(\\mathbf{x})$ is the spatially varying electrical conductivity, and $\\mathbf{J}_s$ is the impressed electric current source density. The problem is $2$D, implying all fields and properties are constant along the $z$-axis ($\\partial/\\partial z = 0$).\n\n**Transverse Electric (TE) Mode**\nIn the TE mode, the electric field is polarized purely in the $z$-direction: $\\mathbf{E} = E_z(\\mathbf{x}) \\hat{\\mathbf{z}}$. Consequently, the magnetic field lies in the $xy$-plane: $\\mathbf{H} = H_x(\\mathbf{x}) \\hat{\\mathbf{x}} + H_y(\\mathbf{x}) \\hat{\\mathbf{y}}$. For this mode to be sustained, the source must also be $z$-directed, $\\mathbf{J}_s = J_{sz}(\\mathbf{x}) \\hat{\\mathbf{z}}$.\n\nFrom Equation ($1$), we take the curl of $\\mathbf{E}$:\n$$\n\\nabla \\times \\mathbf{E} = \\left(\\frac{\\partial E_z}{\\partial y}, -\\frac{\\partial E_z}{\\partial x}, 0\\right) = -i\\omega\\mu_0(H_x, H_y, 0)\n$$\nThis allows us to express the magnetic field components in terms of $E_z$:\n$$\nH_x = \\frac{i}{\\omega\\mu_0}\\frac{\\partial E_z}{\\partial y}, \\qquad H_y = -\\frac{i}{\\omega\\mu_0}\\frac{\\partial E_z}{\\partial x}\n$$\nNext, we take the curl of $\\mathbf{H}$ and consider its $z$-component, using Equation ($2$):\n$$\n(\\nabla \\times \\mathbf{H})_z = \\frac{\\partial H_y}{\\partial x} - \\frac{\\partial H_x}{\\partial y} = \\sigma E_z + J_{sz}\n$$\nSubstituting the expressions for $H_x$ and $H_y$:\n$$\n\\frac{\\partial}{\\partial x}\\left(-\\frac{i}{\\omega\\mu_0}\\frac{\\partial E_z}{\\partial x}\\right) - \\frac{\\partial}{\\partial y}\\left(\\frac{i}{\\omega\\mu_0}\\frac{\\partial E_z}{\\partial y}\\right) = \\sigma E_z + J_{sz}\n$$\nSince $\\mu_0$ and $\\omega$ are constants, this simplifies to:\n$$\n-\\frac{i}{\\omega\\mu_0}\\left(\\frac{\\partial^2 E_z}{\\partial x^2} + \\frac{\\partial^2 E_z}{\\partial y^2}\\right) = \\sigma E_z + J_{sz}\n$$\nRearranging gives the final scalar PDE for $E_z$:\n$$\n\\nabla^2 E_z - i\\omega\\mu_0\\sigma(\\mathbf{x}) E_z = i\\omega\\mu_0 J_{sz}(\\mathbf{x})\n$$\nThis equation is of the generic form $\\nabla \\cdot (a(\\mathbf{x}) \\nabla u(\\mathbf{x})) + c(\\mathbf{x}) u(\\mathbf{x}) = s(\\mathbf{x})$ with $u=E_z$, and the coefficients are identified as:\n- $a_E(\\mathbf{x}) = 1$\n- $c_E(\\mathbf{x}) = -i\\omega\\mu_0\\sigma(\\mathbf{x})$\n- The scalar source $s_E(\\mathbf{x})$ is related to the physical current source by $s_E = i\\omega\\mu_0 J_{sz}$.\n\n**Transverse Magnetic (TM) Mode**\nIn the TM mode, the magnetic field is polarized purely in the $z$-direction: $\\mathbf{H} = H_z(\\mathbf{x}) \\hat{\\mathbf{z}}$. The electric field is in the $xy$-plane: $\\mathbf{E} = E_x(\\mathbf{x}) \\hat{\\mathbf{x}} + E_y(\\mathbf{x}) \\hat{\\mathbf{y}}$. The source current must also lie in the $xy$-plane, $\\mathbf{J}_s = J_{sx}(\\mathbf{x}) \\hat{\\mathbf{x}} + J_{sy}(\\mathbf{x}) \\hat{\\mathbf{y}}$.\n\nFrom Equation ($2$), we express the electric field in terms of $H_z$ and the source $\\mathbf{J}_s$:\n$$\n\\sigma \\mathbf{E} = \\nabla \\times \\mathbf{H} - \\mathbf{J}_s = \\left(\\frac{\\partial H_z}{\\partial y} - J_{sx}, -\\frac{\\partial H_z}{\\partial x} - J_{sy}, 0\\right)\n$$\n$$\nE_x = \\frac{1}{\\sigma}\\left(\\frac{\\partial H_z}{\\partial y} - J_{sx}\\right), \\qquad E_y = \\frac{1}{\\sigma}\\left(-\\frac{\\partial H_z}{\\partial x} - J_{sy}\\right)\n$$\nNext, we take the curl of $\\mathbf{E}$ and consider its $z$-component, using Equation ($1$):\n$$\n(\\nabla \\times \\mathbf{E})_z = \\frac{\\partial E_y}{\\partial x} - \\frac{\\partial E_x}{\\partial y} = -i\\omega\\mu_0 H_z\n$$\nSubstituting the expressions for $E_x$ and $E_y$:\n$$\n\\frac{\\partial}{\\partial x}\\left(\\frac{1}{\\sigma}\\left(-\\frac{\\partial H_z}{\\partial x} - J_{sy}\\right)\\right) - \\frac{\\partial}{\\partial y}\\left(\\frac{1}{\\sigma}\\left(\\frac{\\partial H_z}{\\partial y} - J_{sx}\\right)\\right) = -i\\omega\\mu_0 H_z\n$$\nExpanding and grouping terms involving $H_z$:\n$$\n-\\frac{\\partial}{\\partial x}\\left(\\frac{1}{\\sigma}\\frac{\\partial H_z}{\\partial x}\\right) - \\frac{\\partial}{\\partial y}\\left(\\frac{1}{\\sigma}\\frac{\\partial H_z}{\\partial y}\\right) - i\\omega\\mu_0 H_z = \\frac{\\partial}{\\partial x}\\left(\\frac{J_{sy}}{\\sigma}\\right) - \\frac{\\partial}{\\partial y}\\left(\\frac{J_{sx}}{\\sigma}\\right)\n$$\nThis gives the final scalar PDE for $H_z$:\n$$\n\\nabla \\cdot \\left(\\frac{1}{\\sigma(\\mathbf{x})} \\nabla H_z\\right) - i\\omega\\mu_0 H_z = -\\left(\\nabla \\times \\frac{\\mathbf{J}_s}{\\sigma}\\right)_z\n$$\nThis equation is of the generic form with $u=H_z$, and the coefficients are identified as:\n- $a_H(\\mathbf{x}) = 1/\\sigma(\\mathbf{x})$\n- $c_H(\\mathbf{x}) = -i\\omega\\mu_0$\n- The scalar source $s_H(\\mathbf{x})$ is related to the curl of the physical source current. For a point source, this term becomes complex. The problem permits us to model the entire right-hand side as a simple scalar point source $s(\\mathbf{x})$.\n\n### Discretization and Reciprocity\n\nWe discretize the generic equation $\\nabla \\cdot (a \\nabla u) + c u = s$ on a uniform Cartesian grid with spacing $h$. Using a five-point finite-difference stencil at an interior node $(i,j)$, the equation becomes:\n$$\n\\frac{1}{h^2} \\left( a_{i+\\frac{1}{2},j}(u_{i+1,j}-u_{i,j}) - a_{i-\\frac{1}{2},j}(u_{i,j}-u_{i-1,j}) \\right) + \\frac{1}{h^2} \\left( a_{i,j+\\frac{1}{2}}(u_{i,j+1}-u_{i,j}) - a_{i,j-\\frac{1}{2}}(u_{i,j}-u_{i,j-1}) \\right) + c_{i,j}u_{i,j} = s_{i,j}\n$$\nwhere $u_{i,j} \\approx u(ih, jh)$. The coefficients $a$ are evaluated at cell faces (half-indices). To ensure the discrete operator is symmetric, which is a prerequisite for numerical reciprocity, we use harmonic averaging for these face-centered values:\n$$\na_{i+\\frac{1}{2},j} = \\frac{2 a_{i,j} a_{i+1,j}}{a_{i,j} + a_{i+1,j}} \\quad \\text{and} \\quad a_{i,j+\\frac{1}{2}} = \\frac{2 a_{i,j} a_{i,j+1}}{a_{i,j} + a_{i,j+1}}\n$$\nThis discretization, along with homogeneous Dirichlet boundary conditions ($u=0$ on $\\partial\\Omega$), leads to a complex-valued linear system of equations $\\mathbf{A}\\mathbf{u} = \\mathbf{b}$, where $\\mathbf{u}$ is the vector of unknown field values at interior grid nodes. The matrix $\\mathbf{A}$ assembled with harmonic averaging is symmetric ($\\mathbf{A} = \\mathbf{A}^T$).\n\nThe discrete Green's function, $G_{rk} = (\\mathbf{A}^{-1})_{rk}$, represents the field at node $r$ due to a unit source at node $k$. The symmetry of $\\mathbf{A}$ implies the symmetry of its inverse, $\\mathbf{A}^{-1} = (\\mathbf{A}^{-1})^T$, so $(\\mathbf{A}^{-1})_{rk} = (\\mathbf{A}^{-1})_{kr}$. This means the field at receiver $\\mathbf{x}_r$ due to a source at $\\mathbf{x}_s$ is identical to the field at $\\mathbf{x}_s$ due to a source at $\\mathbf{x}_r$. This is the principle of reciprocity, which we will test numerically. The source $\\mathbf{b}$ is modeled as a vector with a single non-zero entry (a value of $1$) at the source node, corresponding to a discrete delta function.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csc_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main function to run the CSEM reciprocity tests.\n    \"\"\"\n    \n    # --- Physical and Numerical Parameters ---\n    MU_0 = 4 * np.pi * 1e-7  # H/m\n    TOLERANCE = 1e-7\n    \n    # Grid parameters\n    LX, LY = 1.0, 1.0  # m\n    NX, NY = 41, 41\n\n    # --- Test Cases ---\n    test_cases = [\n        {\n            # Case 1: General inhomogeneous model\n            \"f\": 10.0,\n            \"sigma_params\": {\n                \"background\": 1.0,\n                \"inclusion1\": {\"type\": \"circle\", \"center\": (0.6, 0.4), \"radius\": 0.15, \"sigma\": 0.1},\n                \"inclusion2\": {\"type\": \"strip\", \"x_range\": [0.2, 0.25], \"sigma\": 10.0}\n            },\n            \"xs\": (0.10, 0.10),\n            \"xr\": (0.80, 0.90)\n        },\n        {\n            # Case 2: Adjacent nodes near contrast\n            \"f\": 1.0,\n            \"sigma_params\": {\n                \"background\": 0.5,\n                \"inclusion1\": {\"type\": \"circle\", \"center\": (0.5, 0.5), \"radius\": 0.20, \"sigma\": 5.0}\n            },\n            \"xs\": (0.50, 0.70),\n            \"xr\": (0.525, 0.70)\n        },\n        {\n            # Case 3: Strong checkerboard contrast, near-boundary points\n            \"f\": 100.0,\n            \"sigma_params\": {\n                \"background\": 0.1,\n                \"inclusion1\": {\"type\": \"checkerboard\", \"block_size\": 5, \"sigma\": 50.0}\n            },\n            \"xs\": (0.02, 0.95),\n            \"xr\": (0.98, 0.05)\n        }\n    ]\n\n    def build_conductivity_model(params, x_coords, y_coords):\n        \"\"\"Builds the conductivity grid based on model parameters.\"\"\"\n        sigma = np.full((NX, NY), params[\"background\"], dtype=np.float64)\n        for key in sorted(params.keys()):\n            if \"inclusion\" in key:\n                inc = params[key]\n                if inc[\"type\"] == \"circle\":\n                    cx, cy = inc[\"center\"]\n                    r2 = inc[\"radius\"]**2\n                    for i in range(NX):\n                        for j in range(NY):\n                            if (x_coords[i] - cx)**2 + (y_coords[j] - cy)**2 < r2:\n                                sigma[i, j] = inc[\"sigma\"]\n                elif inc[\"type\"] == \"strip\":\n                    x_min, x_max = inc[\"x_range\"]\n                    for i in range(NX):\n                        if x_min <= x_coords[i] <= x_max:\n                            sigma[i, :] = inc[\"sigma\"]\n                elif inc[\"type\"] == \"checkerboard\":\n                    block_size = inc[\"block_size\"]\n                    for i in range(NX):\n                        for j in range(NY):\n                            if (i // block_size + j // block_size) % 2 == 0:\n                                sigma[i, j] = inc[\"sigma\"]\n        return sigma\n\n    def check_reciprocity(mode, f, sigma, xs_pos, xr_pos):\n        \"\"\"Assembles and solves the system for a given mode and checks reciprocity.\"\"\"\n        \n        # Grid setup\n        hx = LX / (NX - 1)\n        hy = LY / (NY - 1)\n        \n        # Angular frequency\n        omega = 2 * np.pi * f\n        \n        # Map physical coordinates to nearest interior grid indices\n        def map_to_interior_idx(pos):\n            i = np.clip(np.rint(pos[0] / hx).astype(int), 1, NX - 2)\n            j = np.clip(np.rint(pos[1] / hy).astype(int), 1, NY - 2)\n            return i, j\n\n        is_s, js_s = map_to_interior_idx(xs_pos)\n        is_r, js_r = map_to_interior_idx(xr_pos)\n\n        # Number of interior nodes\n        num_unknowns = (NX - 2) * (NY - 2)\n        \n        # PDE coefficients based on the mode\n        if mode == 'TE':\n            a_grid = np.ones((NX, NY), dtype=np.float64)\n            c_grid = -1j * omega * MU_0 * sigma\n        elif mode == 'TM':\n            a_grid = 1.0 / sigma\n            c_grid = np.full((NX, NY), -1j * omega * MU_0, dtype=np.complex128)\n        else:\n            raise ValueError(\"Mode must be 'TE' or 'TM'\")\n\n        # Assembly of the sparse system matrix A\n        A = lil_matrix((num_unknowns, num_unknowns), dtype=np.complex128)\n        \n        for i in range(1, NX - 1):\n            for j in range(1, NY - 1):\n                k = (j - 1) * (NX - 2) + (i - 1)  # 1D index\n                \n                # Diagonal contribution from c * u term\n                A[k, k] = c_grid[i, j]\n                \n                # West neighbor (i-1, j)\n                a_w = 2 * a_grid[i, j] * a_grid[i - 1, j] / (a_grid[i, j] + a_grid[i - 1, j])\n                A[k, k] -= a_w / hx**2\n                if i > 1:\n                    A[k, k - 1] += a_w / hx**2\n\n                # East neighbor (i+1, j)\n                a_e = 2 * a_grid[i, j] * a_grid[i + 1, j] / (a_grid[i, j] + a_grid[i + 1, j])\n                A[k, k] -= a_e / hx**2\n                if i < NX - 2:\n                    A[k, k + 1] += a_e / hx**2\n\n                # South neighbor (i, j-1)\n                a_s = 2 * a_grid[i, j] * a_grid[i, j - 1] / (a_grid[i, j] + a_grid[i, j - 1])\n                A[k, k] -= a_s / hy**2\n                if j > 1:\n                    A[k, k - (NX - 2)] += a_s / hy**2\n                    \n                # North neighbor (i, j+1)\n                a_n = 2 * a_grid[i, j] * a_grid[i, j + 1] / (a_grid[i, j] + a_grid[i, j + 1])\n                A[k, k] -= a_n / hy**2\n                if j < NY - 2:\n                    A[k, k + (NX - 2)] += a_n / hy**2\n        \n        A_csc = A.tocsc()\n        \n        ks = (js_s - 1) * (NX - 2) + (is_s - 1)\n        kr = (js_r - 1) * (NX - 2) + (is_r - 1)\n\n        # --- First solve: source at xs, receiver at xr ---\n        b_s = np.zeros(num_unknowns, dtype=np.complex128)\n        b_s[ks] = 1.0\n        u_s = spsolve(A_csc, b_s)\n        G1 = u_s[kr]\n\n        # --- Second solve: source at xr, receiver at xs ---\n        b_r = np.zeros(num_unknowns, dtype=np.complex128)\n        b_r[kr] = 1.0\n        u_r = spsolve(A_csc, b_r)\n        G2 = u_r[ks]\n        \n        # --- Reciprocity check ---\n        abs_G1 = np.abs(G1)\n        abs_G2 = np.abs(G2)\n        max_val = max(abs_G1, abs_G2)\n        \n        if max_val == 0:\n            # If both are zero, difference is zero, reciprocity holds.\n            return True\n        \n        norm_diff = np.abs(G1 - G2) / max_val\n        return norm_diff < TOLERANCE\n\n    # --- Main loop to run all tests ---\n    results = []\n    x_coords = np.linspace(0, LX, NX)\n    y_coords = np.linspace(0, LY, NY)\n    \n    for case in test_cases:\n        sigma_model = build_conductivity_model(case[\"sigma_params\"], x_coords, y_coords)\n        \n        # TE mode test\n        reciprocity_E = check_reciprocity('TE', case[\"f\"], sigma_model, case[\"xs\"], case[\"xr\"])\n        results.append(reciprocity_E)\n        \n        # TM mode test\n        reciprocity_H = check_reciprocity('TM', case[\"f\"], sigma_model, case[\"xs\"], case[\"xr\"])\n        results.append(reciprocity_H)\n\n    # Print results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3582367"}]}