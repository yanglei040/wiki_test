{"hands_on_practices": [{"introduction": "Understanding how deep electromagnetic fields penetrate the Earth is the first principle of magnetotelluric (MT) survey design. This exercise grounds this concept by guiding you through the derivation of the electromagnetic skin depth, $\\delta$, directly from Maxwell's equations in the quasi-static limit [@problem_id:3609004]. By calculating $\\delta$ for different frequencies, you will build a practical intuition for the fundamental trade-off between resolution and depth of investigation.", "problem": "Consider the one-dimensional plane-wave magnetotelluric (MT) forward-modeling scenario of a uniform, electrically conducting half-space occupying $z \\ge 0$, with time-harmonic source fields varying as $\\exp(i \\omega t)$ and horizontal electric and magnetic fields depending only on depth $z$. Start from Maxwell’s equations in the conduction-current dominated limit, assuming $\\sigma \\gg \\omega \\epsilon_0$, where $\\sigma$ is the electrical conductivity, $\\epsilon_0$ is the vacuum permittivity, and $\\omega$ is the angular frequency. The magnetic permeability is $\\mu = \\mu_0$, with $\\mu_0 = 4 \\pi \\times 10^{-7} \\,\\mathrm{H/m}$. Derive the depth-dependent attenuation of the fields in the conducting half-space and obtain the expression for the electromagnetic skin depth $\\delta$ in terms of $\\sigma$, $\\mu$, and $\\omega$.\n\nUsing the derived expression, compute the skin depth $\\delta$ for $\\sigma = 0.1 \\,\\mathrm{S/m}$ at frequencies $\\omega/2\\pi = f = 0.1$, $1$, and $10$ Hz. Then, estimate a physically motivated sensitivity window for MT at each frequency by adopting the heuristic that the dominant sensitivity to subsurface conductivity spans the interval $[0.5 \\,\\delta, 2 \\,\\delta]$.\n\nRound all numerical values to three significant figures. Express all distances in kilometers (km). Report the final answer as a single row matrix containing nine entries in the order $[\\delta_{0.1}, z_{\\min,0.1}, z_{\\max,0.1}, \\delta_{1}, z_{\\min,1}, z_{\\max,1}, \\delta_{10}, z_{\\min,10}, z_{\\max,10}]$, where $\\delta_{f}$ is the skin depth at frequency $f$, and $z_{\\min,f}$, $z_{\\max,f}$ are the corresponding lower and upper bounds of the sensitivity window at frequency $f$.", "solution": "The problem asks for the derivation of the electromagnetic skin depth in a conducting medium under the magnetotelluric (MT) approximation, followed by numerical calculations for specific parameters.\n\nFirst, we derive the governing equation for electromagnetic fields in the conductor. We start with Maxwell's equations in a linear, isotropic, homogeneous conducting medium with no free charges. For time-harmonic fields with time dependence $\\exp(i \\omega t)$, the phasor forms of Faraday's law and Ampere's law are:\n$$\n\\nabla \\times \\mathbf{E} = -i \\omega \\mathbf{B}\n$$\n$$\n\\nabla \\times \\mathbf{H} = \\mathbf{J} + i \\omega \\mathbf{D}\n$$\nThe constitutive relations are $\\mathbf{B} = \\mu \\mathbf{H}$, $\\mathbf{D} = \\epsilon \\mathbf{E}$, and Ohm's law is $\\mathbf{J} = \\sigma \\mathbf{E}$. The problem specifies the medium has magnetic permeability $\\mu = \\mu_0$. Ampere's law becomes:\n$$\n\\nabla \\times \\mathbf{H} = \\sigma \\mathbf{E} + i \\omega \\epsilon \\mathbf{E} = (\\sigma + i \\omega \\epsilon) \\mathbf{E}\n$$\nThe problem states we are in the conduction-current dominated limit, also known as the quasistatic approximation, where $\\sigma \\gg \\omega \\epsilon$. This allows us to neglect the displacement current term, $i \\omega \\epsilon \\mathbf{E}$, compared to the conduction current term, $\\sigma \\mathbf{E}$. Ampère's law simplifies to:\n$$\n\\nabla \\times \\mathbf{H} \\approx \\sigma \\mathbf{E}\n$$\nTo obtain a wave equation for the electric field, we take the curl of Faraday's law:\n$$\n\\nabla \\times (\\nabla \\times \\mathbf{E}) = \\nabla \\times (-i \\omega \\mathbf{B}) = -i \\omega \\mu_0 (\\nabla \\times \\mathbf{H})\n$$\nUsing the vector identity $\\nabla \\times (\\nabla \\times \\mathbf{E}) = \\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^2 \\mathbf{E}$ and substituting the simplified Ampère's law, we get:\n$$\n\\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^2 \\mathbf{E} = -i \\omega \\mu_0 \\sigma \\mathbf{E}\n$$\nIn a homogeneous conductor, there is no spatial variation in conductivity $\\sigma$, so assuming no net charge density, Gauss's law gives $\\nabla \\cdot \\mathbf{E} = 0$. The equation reduces to a vector Helmholtz-like equation, often called the diffusion equation in this context:\n$$\n\\nabla^2 \\mathbf{E} = i \\omega \\mu_0 \\sigma \\mathbf{E}\n$$\nThe problem considers a plane wave where fields depend only on depth $z$, with the conducting medium occupying $z \\ge 0$. For a horizontal electric field component, say $E_x(z)$, the Laplacian operator $\\nabla^2$ simplifies to the second derivative with respect to $z$, $\\frac{d^2}{dz^2}$. The equation for $E_x$ is:\n$$\n\\frac{d^2 E_x}{dz^2} = i \\omega \\mu_0 \\sigma E_x\n$$\nThis is a second-order linear ordinary differential equation. We can write it as $\\frac{d^2 E_x}{dz^2} - k^2 E_x = 0$, where $k^2 = i \\omega \\mu_0 \\sigma$. The general solution is $E_x(z) = A \\exp(-kz) + B \\exp(kz)$. For the field to be physically realistic, its amplitude must remain bounded as $z \\to \\infty$. This requires the coefficient $B$ to be $0$. The solution is therefore a downward-propagating wave:\n$$\nE_x(z) = E_x(0) \\exp(-kz)\n$$\nwhere $E_x(0)$ is the field at the surface $z=0$. The complex propagation constant $k$ is given by:\n$$\nk = \\sqrt{i \\omega \\mu_0 \\sigma}\n$$\nTo understand the attenuation, we express $k$ in terms of its real and imaginary parts. We use the identity $\\sqrt{i} = \\frac{1+i}{\\sqrt{2}}$.\n$$\nk = \\sqrt{\\omega \\mu_0 \\sigma} \\cdot \\sqrt{i} = \\sqrt{\\omega \\mu_0 \\sigma} \\left( \\frac{1+i}{\\sqrt{2}} \\right) = \\sqrt{\\frac{\\omega \\mu_0 \\sigma}{2}} + i \\sqrt{\\frac{\\omega \\mu_0 \\sigma}{2}}\n$$\nSubstituting this back into the solution for $E_x(z)$:\n$$\nE_x(z) = E_x(0) \\exp\\left(-\\left(\\sqrt{\\frac{\\omega \\mu_0 \\sigma}{2}}\\right) z\\right) \\exp\\left(-i \\left(\\sqrt{\\frac{\\omega \\mu_0 \\sigma}{2}}\\right) z\\right)\n$$\nThe amplitude of the field is $|E_x(z)| = |E_x(0)| \\exp\\left(-\\frac{z}{\\delta}\\right)$, where the term $\\exp\\left(-\\left(\\sqrt{\\frac{\\omega \\mu_0 \\sigma}{2}}\\right) z\\right)$ describes the exponential attenuation of the field with depth. The electromagnetic skin depth, $\\delta$, is defined as the depth at which the amplitude decays to $1/e$ of its surface value. This occurs when the argument of the real exponential is $-1$, which means $z \\cdot \\sqrt{\\frac{\\omega \\mu_0 \\sigma}{2}} = 1$. Thus, the expression for the skin depth is:\n$$\n\\delta = \\frac{1}{\\sqrt{\\frac{\\omega \\mu_0 \\sigma}{2}}} = \\sqrt{\\frac{2}{\\omega \\mu_0 \\sigma}}\n$$\nGiven the relationship between angular frequency $\\omega$ and frequency $f$ as $\\omega = 2 \\pi f$, the formula can be expressed as:\n$$\n\\delta = \\sqrt{\\frac{2}{2 \\pi f \\mu_0 \\sigma}} = \\sqrt{\\frac{1}{\\pi f \\mu_0 \\sigma}}\n$$\nThis is the required expression for the skin depth.\n\nNow, we compute the numerical values. We are given:\n$\\sigma = 0.1 \\,\\mathrm{S/m}$\n$\\mu_0 = 4 \\pi \\times 10^{-7} \\,\\mathrm{H/m}$\nFrequencies $f$ are $0.1 \\,\\mathrm{Hz}$, $1 \\,\\mathrm{Hz}$, and $10 \\,\\mathrm{Hz}$.\n\nWe calculate $\\delta$ in meters and then convert to kilometers ($1\\,\\mathrm{km} = 1000\\,\\mathrm{m}$).\nThe formula for calculation is $\\delta = \\sqrt{\\frac{1}{\\pi f \\sigma \\mu_0}}$.\n$\\delta \\approx \\sqrt{\\frac{1}{\\pi f (0.1) (4\\pi \\times 10^{-7})}} = \\sqrt{\\frac{1}{0.4 \\pi^2 f \\times 10^{-7}}} = \\frac{1}{\\sqrt{f}}\\sqrt{\\frac{10^7}{0.4 \\pi^2}} \\approx \\frac{1591.55}{\\sqrt{f}} \\, \\mathrm{m}$.\n\nFor $f = 0.1 \\,\\mathrm{Hz}$:\n$\\delta_{0.1} \\approx \\frac{1591.55}{\\sqrt{0.1}} \\approx 5032.9 \\,\\mathrm{m} \\approx 5.0329 \\,\\mathrm{km}$.\nRounding to three significant figures, $\\delta_{0.1} = 5.03 \\,\\mathrm{km}$.\nThe sensitivity window is $[0.5 \\delta_{0.1}, 2 \\delta_{0.1}]$:\n$z_{\\min,0.1} = 0.5 \\times 5.0329 \\,\\mathrm{km} \\approx 2.5165 \\,\\mathrm{km}$. Rounded to three significant figures, $z_{\\min,0.1} = 2.52 \\,\\mathrm{km}$.\n$z_{\\max,0.1} = 2 \\times 5.0329 \\,\\mathrm{km} \\approx 10.0658 \\,\\mathrm{km}$. Rounded to three significant figures, $z_{\\max,0.1} = 10.1 \\,\\mathrm{km}$.\n\nFor $f = 1 \\,\\mathrm{Hz}$:\n$\\delta_{1} \\approx \\frac{1591.55}{\\sqrt{1}} \\approx 1591.55 \\,\\mathrm{m} \\approx 1.59155 \\,\\mathrm{km}$.\nRounding to three significant figures, $\\delta_{1} = 1.59 \\,\\mathrm{km}$.\nThe sensitivity window is $[0.5 \\delta_{1}, 2 \\delta_{1}]$:\n$z_{\\min,1} = 0.5 \\times 1.59155 \\,\\mathrm{km} \\approx 0.79578 \\,\\mathrm{km}$. Rounded to three significant figures, $z_{\\min,1} = 0.796 \\,\\mathrm{km}$.\n$z_{\\max,1} = 2 \\times 1.59155 \\,\\mathrm{km} \\approx 3.1831 \\,\\mathrm{km}$. Rounded to three significant figures, $z_{\\max,1} = 3.18 \\,\\mathrm{km}$.\n\nFor $f = 10 \\,\\mathrm{Hz}$:\n$\\delta_{10} \\approx \\frac{1591.55}{\\sqrt{10}} \\approx 503.29 \\,\\mathrm{m} \\approx 0.50329 \\,\\mathrm{km}$.\nRounding to three significant figures, $\\delta_{10} = 0.503 \\,\\mathrm{km}$.\nThe sensitivity window is $[0.5 \\delta_{10}, 2 \\delta_{10}]$:\n$z_{\\min,10} = 0.5 \\times 0.50329 \\,\\mathrm{km} \\approx 0.25165 \\,\\mathrm{km}$. Rounded to three significant figures, $z_{\\min,10} = 0.252 \\,\\mathrm{km}$.\n$z_{\\max,10} = 2 \\times 0.50329 \\,\\mathrm{km} \\approx 1.00658 \\,\\mathrm{km}$. Rounded to three significant figures, $z_{\\max,10} = 1.01 \\,\\mathrm{km}$.\n\nThe final nine values, in the specified order are:\n$\\delta_{0.1} = 5.03$, $z_{\\min,0.1} = 2.52$, $z_{\\max,0.1} = 10.1$\n$\\delta_{1} = 1.59$, $z_{\\min,1} = 0.796$, $z_{\\max,1} = 3.18$\n$\\delta_{10} = 0.503$, $z_{\\min,10} = 0.252$, $z_{\\max,10} = 1.01$\nAll values are in kilometers.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n5.03 & 2.52 & 10.1 & 1.59 & 0.796 & 3.18 & 0.503 & 0.252 & 1.01\n\\end{pmatrix}\n}\n$$", "id": "3609004"}, {"introduction": "Moving from one-dimensional theory to multi-dimensional simulation requires us to make critical design choices about the computational domain. This practice addresses how to construct a robust 3D modeling grid and implement absorbing boundaries using Perfectly Matched Layers (PMLs) [@problem_id:3608939]. You will apply the concept of skin depth to define an appropriate mesh resolution and design a PML to minimize non-physical boundary reflections, thereby learning the essential steps for setting up a realistic forward simulation.", "problem": "You are tasked with designing a three-dimensional computational mesh and a Perfectly Matched Layer (PML) for magnetotelluric forward modeling, starting from first principles. Magnetotelluric forward modeling is governed by Maxwell’s equations for time-harmonic fields. Assume a homogeneous, isotropic half-space with constant electrical conductivity. You must derive your design from the following fundamentals and compute the quantitative impact of the absorbing boundary on the magnetotelluric impedance.\n\nFundamental base:\n- Maxwell’s equations in the frequency domain for an isotropic, linear medium are\n$$\\nabla \\times \\mathbf{E} = - i \\omega \\mu \\mathbf{H}, \\quad \\nabla \\times \\mathbf{H} = \\left(\\sigma + i \\omega \\epsilon\\right) \\mathbf{E},$$\nwhere $\\mathbf{E}$ is the electric field, $\\mathbf{H}$ is the magnetic field, $\\omega$ is angular frequency, $\\mu$ is magnetic permeability, $\\sigma$ is electrical conductivity, and $\\epsilon$ is permittivity.\n- For a homogeneous half-space, a plane wave solution propagating in the $z$-direction has a complex propagation constant\n$$\\gamma = \\alpha + i \\beta = \\sqrt{i \\omega \\mu \\left(\\sigma + i \\omega \\epsilon\\right)},$$\nwhere $\\alpha$ is the attenuation constant and $\\beta$ is the phase constant. The amplitude decays as $e^{-\\alpha z}$ and the phase advances as $e^{i \\beta z}$.\n- The skin depth is defined as\n$$\\delta = \\frac{1}{\\alpha},$$\nand in the conduction-dominated regime where $\\sigma \\gg \\omega \\epsilon$, the approximation\n$$\\delta \\approx \\sqrt{\\frac{2}{\\mu \\sigma \\omega}}$$\nholds.\n- The magnetotelluric surface impedance (ratio of tangential electric to magnetic field) for the homogeneous half-space is\n$$Z_{\\text{exact}} = \\sqrt{\\frac{i \\omega \\mu}{\\sigma + i \\omega \\epsilon}}.$$\n\nAbsorbing boundary modeling:\n- To truncate the computational domain, you will attach a matched absorbing layer (Perfectly Matched Layer (PML)) of thickness $L_{\\text{pml}}$. Assume the PML is matched to the interior medium to eliminate reflection at the entry interface and that its effective conductivity is scaled by a factor $s_{\\text{pml}} \\geq 1$, i.e., $\\sigma_{\\text{pml}} = s_{\\text{pml}} \\sigma$, while keeping the same $\\mu$ and $\\epsilon$. The complex propagation constant in the PML is\n$$\\gamma_{\\text{pml}} = \\alpha_{\\text{pml}} + i \\beta_{\\text{pml}} = \\sqrt{i \\omega \\mu \\left(\\sigma_{\\text{pml}} + i \\omega \\epsilon\\right)}.$$\n- The far end of the PML is terminated by a hard boundary that yields a reflection of the electric field with a phase shift of $\\pi$ radians (perfect electric conductor behavior for the tangential electric field). The wave enters the PML without reflection, propagates to the hard termination, reflects, and propagates back. The round-trip amplitude attenuation factor is\n$$r = e^{-2 \\alpha_{\\text{pml}} L_{\\text{pml}}}.$$\n- The round-trip phase accumulation is\n$$\\theta = 2 \\beta_{\\text{pml}} L_{\\text{pml}} + \\pi.$$\n- The forward and backward plane waves superpose at the observation point. Because the magnetic field reverses sign for the backward-propagating wave relative to the electric field, the perturbed impedance at the surface due to the residual reflection is\n$$Z_{\\text{num}} = Z_{\\text{exact}} \\, \\frac{1 + r e^{i \\theta}}{1 - r e^{i \\theta}}.$$\n\nDesign requirements:\n- Design the mesh spacing $h$ using the smallest skin depth at the given frequency in the interior medium, with the rule\n$$h = \\frac{\\delta_{\\text{base}}}{N}, \\quad \\delta_{\\text{base}} = \\frac{1}{\\alpha_{\\text{base}}}, \\quad \\alpha_{\\text{base}} = \\Re\\left(\\sqrt{i \\omega \\mu \\left(\\sigma + i \\omega \\epsilon\\right)}\\right),$$\nwhere $N$ is a positive integer specifying the resolution per skin depth. Use $N = 10$.\n- Choose the PML thickness $L_{\\text{pml}}$ to ensure a target reflection magnitude strictly less than $1\\%$, i.e., $r \\leq 0.01$. Derive $L_{\\text{pml}}$ as a function of $\\alpha_{\\text{pml}}$ and the target $r$. Use the natural logarithm. Place PMLs on both sides of each Cartesian direction. You must compute the total number of cells in each direction as\n$$N_x = \\left\\lceil \\frac{L_x}{h} \\right\\rceil + 2 \\left\\lceil \\frac{L_{\\text{pml}}}{h} \\right\\rceil, \\quad N_y = \\left\\lceil \\frac{L_y}{h} \\right\\rceil + 2 \\left\\lceil \\frac{L_{\\text{pml}}}{h} \\right\\rceil, \\quad N_z = \\left\\lceil \\frac{L_z}{h} \\right\\rceil + 2 \\left\\lceil \\frac{L_{\\text{pml}}}{h} \\right\\rceil.$$\n\nQuantify the impact:\n- Compute $Z_{\\text{exact}}$ and $Z_{\\text{num}}$. Report the relative magnitude error\n$$\\varepsilon_{\\text{mag}} = \\frac{\\left|\\,|Z_{\\text{num}}| - |Z_{\\text{exact}}|\\,\\right|}{|Z_{\\text{exact}}|},$$\nand the absolute phase error in radians\n$$\\varepsilon_{\\phi} = \\left| \\arg\\left(Z_{\\text{num}}\\right) - \\arg\\left(Z_{\\text{exact}}\\right) \\right|.$$\n\nUnits and numerical specifications:\n- All lengths must be computed and reported in meters.\n- Frequencies must be in Hertz.\n- Angles must be in radians.\n- Use $\\mu = \\mu_0 = 4 \\pi \\times 10^{-7}$ Henry per meter and $\\epsilon = \\epsilon_0 = 8.854187817 \\times 10^{-12}$ Farad per meter.\n- Express final numeric outputs as floating-point numbers or integers as specified.\n- The mesh spacing $h$ and the PML thickness $L_{\\text{pml}}$ must be reported in meters.\n\nTest suite:\n- Use the following three test cases, each defined by $(f, \\sigma, L_x, L_y, L_z, s_{\\text{pml}}, r_{\\text{target}})$:\n    1. $(1.0, 0.1, 20000.0, 20000.0, 30000.0, 1.0, 0.01)$\n    2. $(10.0, 1.0, 10000.0, 10000.0, 15000.0, 2.0, 0.01)$\n    3. $(0.001, 0.01, 50000.0, 50000.0, 80000.0, 1.0, 0.01)$\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case’s result must itself be a list in the following order:\n$$[h, L_{\\text{pml}}, N_x, N_y, N_z, \\Re(Z_{\\text{exact}}), \\Im(Z_{\\text{exact}}), \\Re(Z_{\\text{num}}), \\Im(Z_{\\text{num}}), \\varepsilon_{\\text{mag}}, \\varepsilon_{\\phi}].$$\n- For example, the final printed line must look like a single bracketed list of three bracketed lists, with numeric entries and no units shown in the printed list.", "solution": "The user has provided a scientifically sound and well-posed problem. The task is to design a computational mesh and a Perfectly Matched Layer (PML) for magnetotelluric (MT) forward modeling and to quantify the numerical error introduced by the PML boundary condition. The provided framework is based on fundamental electromagnetic theory. The following solution presents the derivation of the required parameters and the procedure for calculating the specified error metrics.\n\nThe problem begins with Maxwell's equations in the frequency domain for a linear, isotropic medium with permittivity $\\epsilon$, magnetic permeability $\\mu$, and electrical conductivity $\\sigma$:\n$$ \\nabla \\times \\mathbf{E} = - i \\omega \\mu \\mathbf{H} $$\n$$ \\nabla \\times \\mathbf{H} = (\\sigma + i \\omega \\epsilon) \\mathbf{E} $$\nHere, $\\mathbf{E}$ and $\\mathbf{H}$ are the complex phasors for the electric and magnetic fields, respectively, and $\\omega$ is the angular frequency.\n\nFor a plane wave propagating in the $z$-direction in a homogeneous medium, the fields vary as $e^{-\\gamma z}$, where $\\gamma$ is the complex propagation constant given by:\n$$ \\gamma = \\sqrt{i \\omega \\mu (\\sigma + i \\omega \\epsilon)} $$\nThe propagation constant is decomposed into its real and imaginary parts, $\\gamma = \\alpha + i\\beta$, where $\\alpha$ is the attenuation constant and $\\beta$ is the phase constant.\n\nThe design process for the computational mesh and PML, along with the error analysis, proceeds through the following steps.\n\n**1. Mesh Spacing Design**\n\nThe resolution of a numerical simulation must be sufficient to accurately represent the wave phenomena. In MT, this is governed by the skin depth, $\\delta$, which is the distance over which the wave amplitude decays by a factor of $1/e$. It is defined as the reciprocal of the attenuation constant. For the interior computational domain (the \"base\" medium), the attenuation constant is:\n$$ \\alpha_{\\text{base}} = \\Re(\\gamma_{\\text{base}}) = \\Re\\left(\\sqrt{i \\omega \\mu (\\sigma + i \\omega \\epsilon)}\\right) $$\nThe corresponding skin depth is:\n$$ \\delta_{\\text{base}} = \\frac{1}{\\alpha_{\\text{base}}} $$\nTo ensure adequate sampling of the fields, the mesh spacing, $h$, is set to be a fraction of this skin depth, controlled by an integer resolution factor, $N$. The problem specifies $N=10$, yielding a mesh spacing of:\n$$ h = \\frac{\\delta_{\\text{base}}}{N} $$\n\n**2. Perfectly Matched Layer (PML) Design**\n\nTo simulate an infinite half-space on a finite computational grid, absorbing boundary conditions are required to prevent non-physical reflections from the domain boundaries. The problem specifies a simplified PML model where the layer is matched to the interior medium ($\\mu$ and $\\epsilon$ are the same) but has a scaled electrical conductivity, $\\sigma_{\\text{pml}} = s_{\\text{pml}} \\sigma$, where $s_{\\text{pml}} \\geq 1$. This increases attenuation within the PML.\n\nThe propagation constant inside the PML is:\n$$ \\gamma_{\\text{pml}} = \\sqrt{i \\omega \\mu (\\sigma_{\\text{pml}} + i \\omega \\epsilon)} $$\nThe attenuation constant in the PML, $\\alpha_{\\text{pml}} = \\Re(\\gamma_{\\text{pml}})$, determines the layer's absorption efficiency. The PML is terminated by a perfect electric conductor (PEC) boundary, which reflects the incident wave. The wave traverses the PML of thickness $L_{\\text{pml}}$, reflects off the PEC, and travels back through the PML. The total round-trip attenuation of the wave's amplitude is given by the factor $r = e^{-2 \\alpha_{\\text{pml}} L_{\\text{pml}}}$.\n\nTo achieve a desired level of absorption, we require this reflection magnitude $r$ to be less than or equal to a target value, $r_{\\text{target}}$. To find the minimum required PML thickness, we solve for $L_{\\text{pml}}$ by setting $r = r_{\\text{target}}$:\n$$ r_{\\text{target}} = e^{-2 \\alpha_{\\text{pml}} L_{\\text{pml}}} $$\nTaking the natural logarithm of both sides gives:\n$$ \\ln(r_{\\text{target}}) = -2 \\alpha_{\\text{pml}} L_{\\text{pml}} $$\n$$ L_{\\text{pml}} = -\\frac{\\ln(r_{\\text{target}})}{2 \\alpha_{\\text{pml}}} $$\nSince $r_{\\text{target}} < 1$, $\\ln(r_{\\text{target}})$ is negative, ensuring $L_{\\text{pml}}$ is positive.\n\n**3. Total Mesh Dimensions**\n\nThe computational domain consists of a central region of interest with dimensions $L_x \\times L_y \\times L_z$, surrounded on both sides in each direction by PMLs of thickness $L_{\\text{pml}}$. The total number of cells in each direction is calculated by summing the cells for the central region and the two PML regions. Using the ceiling function $\\lceil \\cdot \\rceil$ ensures the entire physical domain is covered by an integer number of cells:\n$$ N_x = \\left\\lceil \\frac{L_x}{h} \\right\\rceil + 2 \\left\\lceil \\frac{L_{\\text{pml}}}{h} \\right\\rceil $$\n$$ N_y = \\left\\lceil \\frac{L_y}{h} \\right\\rceil + 2 \\left\\lceil \\frac{L_{\\text{pml}}}{h} \\right\\rceil $$\n$$ N_z = \\left\\lceil \\frac{L_z}{h} \\right\\rceil + 2 \\left\\lceil \\frac{L_{\\text{pml}}{h} \\right\\rceil $$\nNote that the problem applies the PML to all six faces of the cubic domain, including the top ($z=0$ side) and bottom.\n\n**4. Impedance and Error Calculation**\n\nThe primary quantity of interest in MT is the surface impedance, $Z$, which is the ratio of the tangential electric field to the tangential magnetic field. For a homogeneous half-space, the exact analytical Cagniard impedance is:\n$$ Z_{\\text{exact}} = \\sqrt{\\frac{i \\omega \\mu}{\\sigma + i \\omega \\epsilon}} $$\nThe finite computational domain with an imperfect absorbing boundary introduces a numerical error. The residual reflected wave from the PML's hard-wall termination superimposes with the forward wave. The superposition at the surface gives a perturbed numerical impedance, $Z_{\\text{num}}$. This perturbation is a function of the reflection amplitude, $r$, and the round-trip phase accumulation, $\\theta$. The phase accumulation includes the propagation path and the $\\pi$ radian phase shift upon reflection from the PEC boundary:\n$$ \\theta = 2 \\beta_{\\text{pml}} L_{\\text{pml}} + \\pi $$\nwhere $\\beta_{\\text{pml}} = \\Im(\\gamma_{\\text{pml}})$ is the phase constant in the PML. The numerical impedance is then given by:\n$$ Z_{\\text{num}} = Z_{\\text{exact}} \\, \\frac{1 + r e^{i \\theta}}{1 - r e^{i \\theta}} $$\nwhere we use $r = r_{\\text{target}}$ as the worst-case reflection magnitude.\n\nThe impact of the PML is quantified by comparing $Z_{\\text{num}}$ to $Z_{\\text{exact}}$ through the relative magnitude error $\\varepsilon_{\\text{mag}}$ and the absolute phase error $\\varepsilon_{\\phi}$:\n$$ \\varepsilon_{\\text{mag}} = \\frac{\\left|\\,|Z_{\\text{num}}| - |Z_{\\text{exact}}|\\,\\right|}{|Z_{\\text{exact}}|} $$\n$$ \\varepsilon_{\\phi} = \\left| \\arg\\left(Z_{\\text{num}}\\right) - \\arg\\left(Z_{\\text{exact}}\\right) \\right| $$\nwhere $|z|$ denotes the magnitude of a complex number $z$ and $\\arg(z)$ its phase angle.\n\n**Computational Procedure Summary**\n\nFor each test case defined by $(f, \\sigma, L_x, L_y, L_z, s_{\\text{pml}}, r_{\\text{target}})$:\n1.  Set constants $\\mu_0 = 4\\pi \\times 10^{-7}$ and $\\epsilon_0 = 8.854187817 \\times 10^{-12}$.\n2.  Calculate angular frequency $\\omega = 2\\pi f$.\n3.  Compute the base propagation constant $\\gamma_{\\text{base}}$ and attenuation constant $\\alpha_{\\text{base}}$.\n4.  Calculate base skin depth $\\delta_{\\text{base}} = 1/\\alpha_{\\text{base}}$ and mesh spacing $h = \\delta_{\\text{base}}/10$.\n5.  Determine PML conductivity $\\sigma_{\\text{pml}}$, propagation constant $\\gamma_{\\text{pml}}$, and attenuation constant $\\alpha_{\\text{pml}}$.\n6.  Calculate the required PML thickness $L_{\\text{pml}}$ using $r_{\\text{target}}$.\n7.  Compute the total number of cells $N_x$, $N_y$, and $N_z$.\n8.  Calculate the exact impedance $Z_{\\text{exact}}$.\n9.  Calculate the round-trip phase shift $\\theta$ and use it with $r_{\\text{target}}$ to find the numerical impedance $Z_{\\text{num}}$.\n10. Determine the errors $\\varepsilon_{\\text{mag}}$ and $\\varepsilon_{\\phi}$.\n11. Collate the $11$ required output values: $h, L_{\\text{pml}}, N_x, N_y, N_z, \\Re(Z_{\\text{exact}}), \\Im(Z_{\\text{exact}}), \\Re(Z_{\\text{num}}), \\Im(Z_{\\text{num}}), \\varepsilon_{\\text{mag}}, \\varepsilon_{\\phi}$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes mesh parameters, PML design, and resulting impedance errors for\n    magnetotelluric forward modeling based on the provided problem statement.\n    \"\"\"\n    # Physical constants\n    MU_0 = 4 * np.pi * 1e-7  # Magnetic permeability of free space (H/m)\n    EPS_0 = 8.854187817e-12 # Electric permittivity of free space (F/m)\n    \n    # Design parameters\n    N_RESOLUTION = 10 # Cells per skin depth\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (f, sigma, Lx, Ly, Lz, s_pml, r_target)\n    test_cases = [\n        (1.0, 0.1, 20000.0, 20000.0, 30000.0, 1.0, 0.01),\n        (10.0, 1.0, 10000.0, 10000.0, 15000.0, 2.0, 0.01),\n        (0.001, 0.01, 50000.0, 50000.0, 80000.0, 1.0, 0.01),\n    ]\n\n    results = []\n    for case in test_cases:\n        f, sigma, Lx, Ly, Lz, s_pml, r_target = case\n\n        # 1. Calculate base medium properties and mesh spacing\n        omega = 2 * np.pi * f\n        \n        # Propagation constant in the base medium\n        gamma_base_sq = 1j * omega * MU_0 * (sigma + 1j * omega * EPS_0)\n        gamma_base = np.sqrt(gamma_base_sq)\n        alpha_base = gamma_base.real\n        \n        # Skin depth and mesh spacing\n        delta_base = 1.0 / alpha_base\n        h = delta_base / N_RESOLUTION\n\n        # 2. Design the Perfectly Matched Layer (PML)\n        sigma_pml = s_pml * sigma\n        \n        # Propagation constant in the PML\n        gamma_pml_sq = 1j * omega * MU_0 * (sigma_pml + 1j * omega * EPS_0)\n        gamma_pml = np.sqrt(gamma_pml_sq)\n        alpha_pml = gamma_pml.real\n        beta_pml = gamma_pml.imag\n        \n        # Required PML thickness\n        L_pml = -np.log(r_target) / (2 * alpha_pml)\n\n        # 3. Calculate total number of cells\n        # The number of cells must be an integer.\n        Nx = int(np.ceil(Lx / h) + 2 * np.ceil(L_pml / h))\n        Ny = int(np.ceil(Ly / h) + 2 * np.ceil(L_pml / h))\n        Nz = int(np.ceil(Lz / h) + 2 * np.ceil(L_pml / h))\n        \n        # 4. Calculate impedances\n        # Exact impedance for the homogeneous half-space\n        Z_exact_sq = (1j * omega * MU_0) / (sigma + 1j * omega * EPS_0)\n        Z_exact = np.sqrt(Z_exact_sq)\n\n        # Numerical impedance considering the reflection from the PML boundary\n        r = r_target\n        theta = 2 * beta_pml * L_pml + np.pi\n        \n        # Correction factor due to reflection\n        correction_factor = (1 + r * np.exp(1j * theta)) / (1 - r * np.exp(1j * theta))\n        Z_num = Z_exact * correction_factor\n\n        # 5. Quantify the errors\n        # Relative magnitude error\n        eps_mag = np.abs(np.abs(Z_num) - np.abs(Z_exact)) / np.abs(Z_exact)\n        \n        # Absolute phase error in radians\n        eps_phi = np.abs(np.angle(Z_num) - np.angle(Z_exact))\n\n        # 6. Collate results in the required order\n        case_results = [\n            h, L_pml, Nx, Ny, Nz,\n            Z_exact.real, Z_exact.imag,\n            Z_num.real, Z_num.imag,\n            eps_mag, eps_phi\n        ]\n        results.append(case_results)\n\n    # Format the final output string exactly as required, creating a list of lists.\n    # e.g., [[...],[...],[...]]\n    outer_list_str = []\n    for res_list in results:\n        # Convert each float/int in the inner list to a string\n        inner_list_str_parts = [f\"{x:.12g}\" for x in res_list]\n        # Join them with commas and enclose in brackets\n        inner_list_str = \"[\" + \",\".join(inner_list_str_parts) + \"]\"\n        outer_list_str.append(inner_list_str)\n    \n    final_output = \"[\" + \",\".join(outer_list_str) + \"]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```", "id": "3608939"}, {"introduction": "Geological structures exhibit complexity across many scales, often far smaller than the cells in a computational mesh. This exercise introduces homogenization theory as a powerful tool to represent this sub-grid heterogeneity through an effective conductivity [@problem_id:3608984]. You will use the classic Voigt and Reuss bounds to estimate the range of possible impedance responses and analyze the sensitivity of the impedance to the properties of the underlying micro-layers, providing a bridge between rock physics and large-scale geophysical modeling.", "problem": "You are to analyze the sensitivity of the complex magnetotelluric impedance $Z$ to sub-grid conductivity using homogenization for layered microstructures, and compute rigorous bounds on the effective impedance via Voigt and Reuss averages. The physical setting is one-dimensional magnetotellurics with horizontally layered microstructures whose characteristic thicknesses are much smaller than the electromagnetic skin depth, so that homogenization applies.\n\nStart from the frequency-domain Maxwell equations and the constitutive laws in a linear, isotropic, conductive medium:\n- Faraday’s law: $\\nabla \\times \\mathbf{E} = - i \\omega \\mathbf{B}$,\n- Ampère’s law (quasi-static magnetotellurics, neglecting displacement current): $\\nabla \\times \\mathbf{H} = \\sigma \\mathbf{E}$,\n- Constitutive relations: $\\mathbf{B} = \\mu_0 \\mathbf{H}$, $\\mathbf{J} = \\sigma \\mathbf{E}$,\nwhere $\\omega$ is the angular frequency, $\\sigma$ the electrical conductivity, $\\mu_0$ the permeability of free space, $\\mathbf{E}$ the electric field, $\\mathbf{H}$ the magnetic field, and $\\mathbf{B}$ the magnetic flux density.\n\nUnder one-dimensional variation with depth (coordinate $z$), plane-wave excitation, and horizontal fields ($\\mathbf{E} = E_x(z) \\hat{\\mathbf{x}}$, $\\mathbf{H} = H_y(z) \\hat{\\mathbf{y}}$), derive the surface impedance $Z = E_x(0)/H_y(0)$ for a homogeneous half-space in terms of $\\omega$, $\\mu_0$, and $\\sigma$. Explain how the diffusion equation for $\\mathbf{H}$ leads to a complex propagation constant and thus to a complex impedance.\n\nNow consider a sub-grid layered microstructure within a macro-cell occupying a large-scale half-space. Let there be $m$ layers within the microstructure, each isotropic with conductivity $\\sigma_i$ and volume fraction $\\phi_i$ such that $\\sum_{i=1}^{m} \\phi_i = 1$ and $\\sigma_i > 0$. For horizontally layered microstructures, the Voigt (parallel) and Reuss (series) homogenization provide bounds on the effective conductivity:\n- Voigt bound (arithmetic average): $\\sigma_{\\mathrm{V}} = \\sum_{i=1}^{m} \\phi_i \\sigma_i$,\n- Reuss bound (harmonic average): $\\sigma_{\\mathrm{R}} = \\left(\\sum_{i=1}^{m} \\frac{\\phi_i}{\\sigma_i}\\right)^{-1}$.\nUsing these effective conductivities as surrogates for the homogeneous half-space, produce two bounding impedances for each test case by substituting $\\sigma_{\\mathrm{V}}$ and $\\sigma_{\\mathrm{R}}$ into the homogeneous half-space impedance.\n\nDefine the sensitivity of the impedance with respect to sub-grid conductivities as the vector of partial derivatives $\\left(\\frac{\\partial Z}{\\partial \\sigma_1}, \\dots, \\frac{\\partial Z}{\\partial \\sigma_m}\\right)$. Derive expressions for $\\frac{\\partial Z}{\\partial \\sigma_i}$ under both homogenization rules using the chain rule, i.e., $\\frac{\\partial Z}{\\partial \\sigma_i} = \\frac{\\partial Z}{\\partial \\sigma_{\\mathrm{eff}}} \\frac{\\partial \\sigma_{\\mathrm{eff}}}{\\partial \\sigma_i}$ with $\\sigma_{\\mathrm{eff}} \\in \\{\\sigma_{\\mathrm{V}}, \\sigma_{\\mathrm{R}}\\}$. For reporting a scalar measure, use the Euclidean norm of the complex sensitivity vector, defined by $\\left\\|\\frac{\\partial Z}{\\partial \\boldsymbol{\\sigma}}\\right\\|_2 = \\sqrt{\\sum_{i=1}^{m} \\left|\\frac{\\partial Z}{\\partial \\sigma_i}\\right|^2}$.\n\nNumerical requirements:\n- Use $\\mu_0 = 4 \\pi \\times 10^{-7}\\ \\mathrm{H/m}$.\n- All conductivities $\\sigma_i$ are in $\\mathrm{S/m}$.\n- Frequencies $f$ are given in $\\mathrm{Hz}$ and related to angular frequency by $\\omega = 2 \\pi f$.\n- Report impedances $Z$ in $\\mathrm{\\Omega}$, with both real and imaginary parts.\n- Report sensitivity norms in $\\mathrm{\\Omega}\\,(\\mathrm{S/m})^{-1}$.\n- Angles, if any, must be in radians, but you will not need to report any angles.\n\nTest suite:\nYou must evaluate the following four test cases:\n1. Case A (balanced fractions, moderate contrast): $f = 0.1$ with $m = 2$, $\\boldsymbol{\\sigma} = [0.01, 1.0]$, $\\boldsymbol{\\phi} = [0.5, 0.5]$.\n2. Case B (broad contrast, skewed fractions): $f = 1.0$ with $m = 3$, $\\boldsymbol{\\sigma} = [0.001, 0.1, 10.0]$, $\\boldsymbol{\\phi} = [0.2, 0.3, 0.5]$.\n3. Case C (low frequency, dominant resistive fraction): $f = 0.01$ with $m = 2$, $\\boldsymbol{\\sigma} = [0.01, 1.0]$, $\\boldsymbol{\\phi} = [0.9, 0.1]$.\n4. Case D (high frequency, equal properties): $f = 10.0$ with $m = 3$, $\\boldsymbol{\\sigma} = [0.05, 0.05, 0.05]$, $\\boldsymbol{\\phi} = [1/3, 1/3, 1/3]$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a six-element list $[ \\Re(Z_{\\mathrm{V}}), \\Im(Z_{\\mathrm{V}}), \\Re(Z_{\\mathrm{R}}), \\Im(Z_{\\mathrm{R}}), \\lVert \\partial Z / \\partial \\boldsymbol{\\sigma} \\rVert_{2,\\mathrm{V}}, \\lVert \\partial Z / \\partial \\boldsymbol{\\sigma} \\rVert_{2,\\mathrm{R}} ]$. The entries are ordered according to the test cases listed above. For example, the overall output must look like $[[a_1,b_1,c_1,d_1,e_1,g_1],[a_2,b_2,c_2,d_2,e_2,g_2],[a_3,b_3,c_3,d_3,e_3,g_3],[a_4,b_4,c_4,d_4,e_4,g_4]]$, with all values in $\\mathrm{\\Omega}$ for impedance components and in $\\mathrm{\\Omega}\\,(\\mathrm{S/m})^{-1}$ for sensitivity norms.", "solution": "We begin from first principles appropriate to magnetotelluric forward modeling. In the frequency domain, the governing relations are Faraday’s law $\\nabla \\times \\mathbf{E} = - i \\omega \\mathbf{B}$ and Ampère’s law in the quasi-static regime $\\nabla \\times \\mathbf{H} = \\sigma \\mathbf{E}$, together with the constitutive relation $\\mathbf{B} = \\mu_0 \\mathbf{H}$ and Ohm’s law $\\mathbf{J} = \\sigma \\mathbf{E}$. For one-dimensional variation with depth coordinate $z$, and horizontally polarized fields $\\mathbf{E} = E_x(z) \\hat{\\mathbf{x}}$, $\\mathbf{H} = H_y(z) \\hat{\\mathbf{y}}$, these equations reduce to coupled ordinary differential equations.\n\nFrom Ampère’s law, the $x$-component of the electric field relates to the derivative of the magnetic field by $E_x = \\frac{1}{\\sigma} \\left(\\nabla \\times \\mathbf{H}\\right)_x = \\frac{1}{\\sigma} \\frac{\\partial H_y}{\\partial z}$. From Faraday’s law and $\\mathbf{B} = \\mu_0 \\mathbf{H}$, the curl of the electric field satisfies $\\left(\\nabla \\times \\mathbf{E}\\right)_y = - i \\omega \\mu_0 H_y$. Differentiating $E_x$ with respect to $z$ and substituting into Faraday’s law yields the diffusion equation for the magnetic field:\n$$\n\\frac{d^2 H_y}{d z^2} = i \\omega \\mu_0 \\sigma H_y.\n$$\nThis linear equation admits exponential solutions $H_y(z) = H_0 \\exp(-k z)$ with complex propagation constant $k$ satisfying $k^2 = i \\omega \\mu_0 \\sigma$. Choosing the branch with positive real part to ensure decay into the half-space, we have $k = (1 + i) \\sqrt{\\frac{\\omega \\mu_0 \\sigma}{2}}$.\n\nThe surface impedance $Z$ is defined as the ratio of the horizontal electric field to the horizontal magnetic field at the surface ($z = 0$):\n$$\nZ = \\frac{E_x(0)}{H_y(0)}.\n$$\nUsing $E_x = \\frac{1}{\\sigma} \\frac{d H_y}{d z}$ and the exponential solution, $\\frac{d H_y}{d z} = - k H_y$, we obtain\n$$\nZ = - \\frac{k}{\\sigma}.\n$$\nWith the choice of $k$ above, this yields the canonical homogeneous half-space impedance\n$$\nZ(\\sigma) = (1 + i) \\sqrt{\\frac{\\omega \\mu_0}{2 \\sigma}},\n$$\nwhich is purely determined by the angular frequency $\\omega$, the free-space permeability $\\mu_0$, and the conductivity $\\sigma$. The real and imaginary parts are equal and positive, representing a $45^\\circ$ phase lead of the electric field relative to the magnetic field in radians.\n\nWe now incorporate sub-grid layered microstructures via homogenization. Consider $m$ layers with conductivities $\\sigma_i$ and volume fractions $\\phi_i$ such that $\\sum_{i=1}^{m} \\phi_i = 1$ and $\\sigma_i > 0$. For horizontally layered microstructures, two classical bounds on the effective conductivity are provided by Voigt and Reuss averages:\n- Voigt average (parallel arrangement, arithmetic mean):\n$$\n\\sigma_{\\mathrm{V}} = \\sum_{i=1}^{m} \\phi_i \\sigma_i.\n$$\n- Reuss average (series arrangement, harmonic mean):\n$$\n\\sigma_{\\mathrm{R}} = \\left(\\sum_{i=1}^{m} \\frac{\\phi_i}{\\sigma_i}\\right)^{-1}.\n$$\nUsing these effective conductivities in the homogeneous half-space impedance expression gives two bounding impedances:\n$$\nZ_{\\mathrm{V}} = Z(\\sigma_{\\mathrm{V}}), \\quad Z_{\\mathrm{R}} = Z(\\sigma_{\\mathrm{R}}).\n$$\n\nTo analyze sensitivity to sub-grid conductivities, define the sensitivity vector of $Z$ with respect to $\\boldsymbol{\\sigma} = (\\sigma_1, \\dots, \\sigma_m)$ as\n$$\n\\left(\\frac{\\partial Z}{\\partial \\sigma_1}, \\dots, \\frac{\\partial Z}{\\partial \\sigma_m}\\right).\n$$\nApplying the chain rule through the homogenization mapping gives\n$$\n\\frac{\\partial Z}{\\partial \\sigma_i} = \\frac{\\partial Z}{\\partial \\sigma_{\\mathrm{eff}}} \\frac{\\partial \\sigma_{\\mathrm{eff}}}{\\partial \\sigma_i}, \\quad \\sigma_{\\mathrm{eff}} \\in \\{\\sigma_{\\mathrm{V}}, \\sigma_{\\mathrm{R}}\\}.\n$$\nThe derivative of the homogeneous impedance with respect to conductivity is obtained directly from $Z(\\sigma)$:\n$$\n\\frac{d Z}{d \\sigma} = \\frac{d}{d \\sigma} \\left[(1 + i) \\sqrt{\\frac{\\omega \\mu_0}{2}} \\sigma^{-1/2} \\right] = - \\frac{1}{2} (1 + i) \\sqrt{\\frac{\\omega \\mu_0}{2}} \\sigma^{-3/2}.\n$$\nFor the Voigt average, since $\\sigma_{\\mathrm{V}} = \\sum_{i=1}^{m} \\phi_i \\sigma_i$, we have\n$$\n\\frac{\\partial \\sigma_{\\mathrm{V}}}{\\partial \\sigma_i} = \\phi_i,\n$$\nand hence\n$$\n\\left(\\frac{\\partial Z}{\\partial \\sigma_i}\\right)_{\\mathrm{V}} = \\left.\\frac{d Z}{d \\sigma}\\right|_{\\sigma = \\sigma_{\\mathrm{V}}} \\phi_i.\n$$\nFor the Reuss average, let $S = \\sum_{j=1}^{m} \\frac{\\phi_j}{\\sigma_j}$ so that $\\sigma_{\\mathrm{R}} = S^{-1}$. Then\n$$\n\\frac{\\partial \\sigma_{\\mathrm{R}}}{\\partial \\sigma_i} = - S^{-2} \\frac{\\partial S}{\\partial \\sigma_i} = - S^{-2} \\left( - \\frac{\\phi_i}{\\sigma_i^2} \\right) = \\frac{\\phi_i}{\\sigma_i^2} S^{-2} = \\phi_i \\frac{\\sigma_{\\mathrm{R}}^2}{\\sigma_i^2},\n$$\nand thus\n$$\n\\left(\\frac{\\partial Z}{\\partial \\sigma_i}\\right)_{\\mathrm{R}} = \\left.\\frac{d Z}{d \\sigma}\\right|_{\\sigma = \\sigma_{\\mathrm{R}}} \\phi_i \\frac{\\sigma_{\\mathrm{R}}^2}{\\sigma_i^2}.\n$$\nTo report a scalar sensitivity magnitude, we use the Euclidean norm of the complex-valued sensitivity vector,\n$$\n\\left\\|\\frac{\\partial Z}{\\partial \\boldsymbol{\\sigma}}\\right\\|_2 = \\sqrt{\\sum_{i=1}^{m} \\left| \\frac{\\partial Z}{\\partial \\sigma_i} \\right|^2 },\n$$\nwhich is in units of $\\mathrm{\\Omega}\\,(\\mathrm{S/m})^{-1}$.\n\nAlgorithmic procedure for each test case:\n1. Compute $\\omega = 2 \\pi f$ from the given frequency $f$.\n2. Compute $\\sigma_{\\mathrm{V}}$ and $\\sigma_{\\mathrm{R}}$ from $(\\sigma_i, \\phi_i)$.\n3. Evaluate $Z_{\\mathrm{V}} = (1 + i) \\sqrt{\\frac{\\omega \\mu_0}{2 \\sigma_{\\mathrm{V}}}}$ and $Z_{\\mathrm{R}} = (1 + i) \\sqrt{\\frac{\\omega \\mu_0}{2 \\sigma_{\\mathrm{R}}}}$.\n4. Compute $\\left.\\frac{d Z}{d \\sigma}\\right|_{\\sigma = \\sigma_{\\mathrm{V}}}$ and $\\left.\\frac{d Z}{d \\sigma}\\right|_{\\sigma = \\sigma_{\\mathrm{R}}}$.\n5. Form sensitivity vectors using the chain rule for Voigt and Reuss and compute their Euclidean norms.\n6. Report $[ \\Re(Z_{\\mathrm{V}}), \\Im(Z_{\\mathrm{V}}), \\Re(Z_{\\mathrm{R}}), \\Im(Z_{\\mathrm{R}}), \\lVert \\partial Z / \\partial \\boldsymbol{\\sigma} \\rVert_{2,\\mathrm{V}}, \\lVert \\partial Z / \\partial \\boldsymbol{\\sigma} \\rVert_{2,\\mathrm{R}} ]$ for each case in the specified order.\n\nScientific realism and edge cases:\n- All $\\sigma_i$ must be strictly positive to avoid division by zero in the Reuss average.\n- The volume fractions must sum to $1$; any small numerical deviation should be corrected or checked.\n- The bounds $\\sigma_{\\mathrm{R}} \\le \\sigma_{\\mathrm{eff}} \\le \\sigma_{\\mathrm{V}}$ for layered microstructures translate to $|Z_{\\mathrm{V}}| \\le |Z_{\\mathrm{eff}}| \\le |Z_{\\mathrm{R}}|$ because $|Z| \\propto \\sigma^{-1/2}$, providing a physically consistent bracket.\n\nUnits:\n- $\\mu_0 = 4 \\pi \\times 10^{-7}\\ \\mathrm{H/m}$,\n- $\\omega$ in $\\mathrm{rad/s}$ via $\\omega = 2 \\pi f$ with $f$ in $\\mathrm{Hz}$,\n- $Z$ in $\\mathrm{\\Omega}$,\n- sensitivity norms in $\\mathrm{\\Omega}\\,(\\mathrm{S/m})^{-1}$.\n\nThe program implements this procedure for the specified test suite and outputs a single line listing the six-element results for each case, as required.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\nMU0 = 4.0 * np.pi * 1e-7  # H/m\n\ndef homogeneous_impedance(omega, sigma):\n    \"\"\"\n    Compute the homogeneous half-space magnetotelluric impedance:\n    Z(sigma) = (1 + i) * sqrt(omega * mu0 / (2 * sigma))\n    \"\"\"\n    return (1.0 + 1.0j) * np.sqrt((omega * MU0) / (2.0 * sigma))\n\ndef dZ_dsigma(omega, sigma):\n    \"\"\"\n    Derivative of Z with respect to sigma for the homogeneous half-space:\n    dZ/dsigma = - (1 + i) * 0.5 * sqrt(omega * mu0 / 2) * sigma^{-3/2}\n    \"\"\"\n    return -(1.0 + 1.0j) * 0.5 * np.sqrt(omega * MU0 / 2.0) * (sigma ** (-1.5))\n\ndef voigt_average(sigmas, phis):\n    return float(np.sum(np.array(phis) * np.array(sigmas)))\n\ndef reuss_average(sigmas, phis):\n    sigmas = np.array(sigmas, dtype=float)\n    phis = np.array(phis, dtype=float)\n    return float(1.0 / np.sum(phis / sigmas))\n\ndef sensitivity_norm_voigt(omega, sigmas, phis):\n    \"\"\"\n    Sensitivity vector under Voigt homogenization:\n    dZ/dsigma_i = (dZ/dsigma)|_{sigma_V} * phi_i\n    Return Euclidean norm of the complex sensitivity vector.\n    \"\"\"\n    sigma_V = voigt_average(sigmas, phis)\n    dZ = dZ_dsigma(omega, sigma_V)\n    sens = np.array(phis, dtype=float) * dZ  # complex vector\n    # Euclidean norm with complex magnitudes\n    return float(np.sqrt(np.sum(np.abs(sens) ** 2)))\n\ndef sensitivity_norm_reuss(omega, sigmas, phis):\n    \"\"\"\n    Sensitivity vector under Reuss homogenization:\n    dZ/dsigma_i = (dZ/dsigma)|_{sigma_R} * phi_i * (sigma_R^2 / sigma_i^2)\n    Return Euclidean norm of the complex sensitivity vector.\n    \"\"\"\n    sigmas = np.array(sigmas, dtype=float)\n    phis = np.array(phis, dtype=float)\n    sigma_R = reuss_average(sigmas, phis)\n    dZ = dZ_dsigma(omega, sigma_R)\n    weights = phis * (sigma_R ** 2) / (sigmas ** 2)\n    sens = weights * dZ  # complex vector\n    return float(np.sqrt(np.sum(np.abs(sens) ** 2)))\n\ndef compute_case(frequency_hz, sigmas, phis):\n    \"\"\"\n    Compute [Re(Z_V), Im(Z_V), Re(Z_R), Im(Z_R), ||sens_V||2, ||sens_R||2]\n    for a given test case.\n    \"\"\"\n    # Validate volume fractions sum\n    phis = np.array(phis, dtype=float)\n    sigmas = np.array(sigmas, dtype=float)\n    if not np.all(sigmas > 0.0):\n        raise ValueError(\"All conductivities must be strictly positive.\")\n    # Normalize fractions if small numerical drift\n    sphi = float(np.sum(phis))\n    if not np.isclose(sphi, 1.0):\n        phis = phis / sphi\n\n    omega = 2.0 * np.pi * float(frequency_hz)\n\n    sigma_V = voigt_average(sigmas, phis)\n    sigma_R = reuss_average(sigmas, phis)\n\n    Z_V = homogeneous_impedance(omega, sigma_V)\n    Z_R = homogeneous_impedance(omega, sigma_R)\n\n    sens_V = sensitivity_norm_voigt(omega, sigmas, phis)\n    sens_R = sensitivity_norm_reuss(omega, sigmas, phis)\n\n    return [float(np.real(Z_V)), float(np.imag(Z_V)),\n            float(np.real(Z_R)), float(np.imag(Z_R)),\n            sens_V, sens_R]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: f=0.1 Hz, m=2, sigmas=[0.01, 1.0], phis=[0.5, 0.5]\n        {\"f\": 0.1, \"sigmas\": [0.01, 1.0], \"phis\": [0.5, 0.5]},\n        # Case B: f=1.0 Hz, m=3, sigmas=[0.001, 0.1, 10.0], phis=[0.2, 0.3, 0.5]\n        {\"f\": 1.0, \"sigmas\": [0.001, 0.1, 10.0], \"phis\": [0.2, 0.3, 0.5]},\n        # Case C: f=0.01 Hz, m=2, sigmas=[0.01, 1.0], phis=[0.9, 0.1]\n        {\"f\": 0.01, \"sigmas\": [0.01, 1.0], \"phis\": [0.9, 0.1]},\n        # Case D: f=10.0 Hz, m=3, sigmas=[0.05, 0.05, 0.05], phis=[1/3, 1/3, 1/3]\n        {\"f\": 10.0, \"sigmas\": [0.05, 0.05, 0.05], \"phis\": [1.0/3.0, 1.0/3.0, 1.0/3.0]},\n    ]\n\n    results = []\n    for case in test_cases:\n        res = compute_case(case[\"f\"], case[\"sigmas\"], case[\"phis\"])\n        results.append(res)\n\n    # Final print statement in the exact required format.\n    # Print as nested lists with scientific notation for clarity.\n    def fmt_list(lst):\n        return \"[\" + \",\".join(f\"{x:.10e}\" for x in lst) + \"]\"\n    print(\"[\" + \",\".join(fmt_list(r) for r in results) + \"]\")\n\nsolve()\n```", "id": "3608984"}]}