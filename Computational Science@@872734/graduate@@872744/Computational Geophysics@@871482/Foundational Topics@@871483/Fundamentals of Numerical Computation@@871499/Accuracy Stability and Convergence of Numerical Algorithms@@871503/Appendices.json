{"hands_on_practices": [{"introduction": "An essential skill in computational geophysics is determining whether a numerical scheme is stable. This practice introduces the foundational Von Neumann stability analysis by applying it to the heat equation, $u_t = \\kappa u_{xx}$, which models processes like thermal diffusion in the lithosphere. You will derive the famous Courant–Friedrichs–Lewy (CFL) stability condition from first principles, gaining a deep understanding of how discretization choices constrain the time step [@problem_id:3573133].", "problem": "In computational geophysics, thermal diffusion in a homogeneous lithospheric column can be idealized by the one-dimensional heat equation $u_{t}=\\kappa u_{xx}$ on a periodic domain $x\\in[0,L]$, where $u(x,t)$ is temperature and $\\kappa>0$ is the thermal diffusivity. Consider a uniform spatial grid with spacing $\\Delta x$ and a discrete time step $\\Delta t$. Let $u_{j}^{n}$ denote the numerical approximation to $u(x_{j},t_{n})$ at grid location $x_{j}=j\\,\\Delta x$ and time $t_{n}=n\\,\\Delta t$. The time derivative $u_{t}$ is approximated by forward Euler, and the second spatial derivative $u_{xx}$ is approximated by the second-order central difference:\n$$\nu_{t}(x_{j},t_{n})\\approx \\frac{u_{j}^{n+1}-u_{j}^{n}}{\\Delta t}, \\qquad\nu_{xx}(x_{j},t_{n})\\approx \\frac{u_{j+1}^{n}-2u_{j}^{n}+u_{j-1}^{n}}{\\Delta x^{2}}.\n$$\nStarting from these fundamental approximations and the governing equation $u_{t}=\\kappa u_{xx}$, derive the fully discrete update relation for $u_{j}^{n}$. Then, using periodic boundary conditions and a Fourier mode representation $u_{j}^{n}=\\hat{u}^{n}\\exp(\\mathrm{i}k x_{j})$ with real wavenumber $k$, perform a Von Neumann (Fourier) stability analysis to obtain the amplification factor as a function of $k$. From the requirement that all Fourier modes be non-growing in magnitude, deduce the maximum admissible time step $\\Delta t_{\\max}$ in terms of $\\kappa$ and $\\Delta x$ that ensures stability for the forward Euler and second-order central difference scheme.\n\nProvide two closed-form symbolic expressions: (i) the amplification factor as a function of $k$, $\\Delta x$, $\\Delta t$, and $\\kappa$, and (ii) the maximum stable time step $\\Delta t_{\\max}$ in terms of $\\kappa$ and $\\Delta x$. Do not express the stability condition as an inequality.", "solution": "The governing equation is the one-dimensional heat equation $u_{t}=\\kappa u_{xx}$ with periodic boundary conditions. On a uniform grid with spacing $\\Delta x$ and time step $\\Delta t$, we use the forward Euler approximation for $u_{t}$ and the second-order central difference for $u_{xx}$. Substituting these into $u_{t}=\\kappa u_{xx}$ gives the fully discrete update:\n$$\n\\frac{u_{j}^{n+1}-u_{j}^{n}}{\\Delta t}=\\kappa\\,\\frac{u_{j+1}^{n}-2u_{j}^{n}+u_{j-1}^{n}}{\\Delta x^{2}}.\n$$\nSolving for $u_{j}^{n+1}$ yields\n$$\nu_{j}^{n+1}=u_{j}^{n}+\\frac{\\kappa\\,\\Delta t}{\\Delta x^{2}}\\left(u_{j+1}^{n}-2u_{j}^{n}+u_{j-1}^{n}\\right).\n$$\nTo analyze stability via the Von Neumann method, we consider a single Fourier mode on the periodic grid:\n$$\nu_{j}^{n}=\\hat{u}^{n}\\exp\\!\\left(\\mathrm{i}k x_{j}\\right), \\qquad x_{j}=j\\,\\Delta x,\n$$\nwhere $k\\in\\mathbb{R}$ is the wavenumber and $\\hat{u}^{n}$ is the mode amplitude at time level $n$. Substituting this representation into the update formula, we compute each term:\n$$\nu_{j+1}^{n}=\\hat{u}^{n}\\exp\\!\\left(\\mathrm{i}k x_{j+1}\\right)=\\hat{u}^{n}\\exp\\!\\left(\\mathrm{i}k x_{j}\\right)\\exp\\!\\left(\\mathrm{i}k\\Delta x\\right),\n$$\n$$\nu_{j-1}^{n}=\\hat{u}^{n}\\exp\\!\\left(\\mathrm{i}k x_{j-1}\\right)=\\hat{u}^{n}\\exp\\!\\left(\\mathrm{i}k x_{j}\\right)\\exp\\!\\left(-\\mathrm{i}k\\Delta x\\right),\n$$\nand $u_{j}^{n}=\\hat{u}^{n}\\exp\\!\\left(\\mathrm{i}k x_{j}\\right)$. Therefore\n$$\nu_{j+1}^{n}-2u_{j}^{n}+u_{j-1}^{n}=\\hat{u}^{n}\\exp\\!\\left(\\mathrm{i}k x_{j}\\right)\\left[\\exp\\!\\left(\\mathrm{i}k\\Delta x\\right)-2+\\exp\\!\\left(-\\mathrm{i}k\\Delta x\\right)\\right].\n$$\nDefine the amplification factor $G(k)$ by $\\hat{u}^{n+1}=G(k)\\,\\hat{u}^{n}$. Substituting the Fourier mode into the update and factoring out $\\hat{u}^{n}\\exp\\!\\left(\\mathrm{i}k x_{j}\\right)$ yields\n$$\n\\hat{u}^{n+1}\\exp\\!\\left(\\mathrm{i}k x_{j}\\right)=\\hat{u}^{n}\\exp\\!\\left(\\mathrm{i}k x_{j}\\right)\\left\\{1+\\frac{\\kappa\\,\\Delta t}{\\Delta x^{2}}\\left[\\exp\\!\\left(\\mathrm{i}k\\Delta x\\right)-2+\\exp\\!\\left(-\\mathrm{i}k\\Delta x\\right)\\right]\\right\\}.\n$$\nCanceling $\\exp\\!\\left(\\mathrm{i}k x_{j}\\right)$ and dividing by $\\hat{u}^{n}$ gives\n$$\nG(k)=1+\\frac{\\kappa\\,\\Delta t}{\\Delta x^{2}}\\left[\\exp\\!\\left(\\mathrm{i}k\\Delta x\\right)-2+\\exp\\!\\left(-\\mathrm{i}k\\Delta x\\right)\\right].\n$$\nUsing the identity $\\exp(\\mathrm{i}\\theta)+\\exp(-\\mathrm{i}\\theta)=2\\cos\\theta$, we simplify:\n$$\nG(k)=1+\\frac{\\kappa\\,\\Delta t}{\\Delta x^{2}}\\left[2\\cos(k\\Delta x)-2\\right]=1+\\frac{2\\kappa\\,\\Delta t}{\\Delta x^{2}}\\left[\\cos(k\\Delta x)-1\\right].\n$$\nEmploying the trigonometric identity $\\cos\\theta-1=-2\\sin^{2}\\!\\left(\\frac{\\theta}{2}\\right)$, we obtain the canonical form\n$$\nG(k)=1-4\\,\\frac{\\kappa\\,\\Delta t}{\\Delta x^{2}}\\,\\sin^{2}\\!\\left(\\frac{k\\Delta x}{2}\\right).\n$$\nIntroduce the dimensionless diffusive Courant–Friedrichs–Lewy (CFL) number $r=\\frac{\\kappa\\,\\Delta t}{\\Delta x^{2}}$. Then\n$$\nG(k)=1-4r\\,\\sin^{2}\\!\\left(\\frac{k\\Delta x}{2}\\right),\n$$\nwith $\\sin^{2}\\!\\left(\\frac{k\\Delta x}{2}\\right)\\in[0,1]$ for real $k$. For stability of the explicit scheme, we require that all Fourier modes do not grow in magnitude, i.e., $|G(k)|\\leq 1$ for all $k$. The extremal values of $G(k)$ over $k$ occur at $\\sin^{2}\\!\\left(\\frac{k\\Delta x}{2}\\right)=0$ and $\\sin^{2}\\!\\left(\\frac{k\\Delta x}{2}\\right)=1$, giving\n$$\nG_{\\max}=1 \\quad \\text{at} \\quad \\sin^{2}\\!\\left(\\frac{k\\Delta x}{2}\\right)=0, \\qquad G_{\\min}=1-4r \\quad \\text{at} \\quad \\sin^{2}\\!\\left(\\frac{k\\Delta x}{2}\\right)=1.\n$$\nThe stability condition $|G(k)|\\leq 1$ reduces to $|1-4r|\\leq 1$, which is equivalent to\n$$\n-1\\leq 1-4r\\leq 1 \\quad \\Longrightarrow \\quad 0\\leq r\\leq \\frac{1}{2}.\n$$\nBecause $\\kappa>0$ and $\\Delta x>0$, the admissible time steps satisfy\n$$\n\\Delta t\\leq \\frac{\\Delta x^{2}}{2\\kappa}.\n$$\nTherefore, the maximum stable time step is\n$$\n\\Delta t_{\\max}=\\frac{\\Delta x^{2}}{2\\kappa}.\n$$\nCollecting the requested expressions: the amplification factor as a function of $k$ is $G(k)=1-4\\,\\frac{\\kappa\\,\\Delta t}{\\Delta x^{2}}\\,\\sin^{2}\\!\\left(\\frac{k\\Delta x}{2}\\right)$, and the maximum admissible time step ensuring stability is $\\Delta t_{\\max}=\\frac{\\Delta x^{2}}{2\\kappa}$.", "answer": "$$\\boxed{\\begin{pmatrix}\n1-4\\,\\frac{\\kappa\\,\\Delta t}{\\Delta x^{2}}\\,\\sin^{2}\\!\\left(\\frac{k\\,\\Delta x}{2}\\right) & \\frac{\\Delta x^{2}}{2\\,\\kappa}\n\\end{pmatrix}}$$", "id": "3573133"}, {"introduction": "Beyond stability, numerical accuracy is paramount. This exercise tackles catastrophic cancellation, a critical source of error that occurs when subtracting two nearly equal floating-point numbers, such as $t_1 \\approx t_2$. Using the practical geophysical problem of calculating differential seismic travel times $\\Delta t = t_1 - t_2$, you will analyze the loss of precision and derive a stable algebraic reformulation, a crucial technique for robust scientific code [@problem_id:3573094].", "problem": "Consider a homogeneous, isotropic acoustic medium with constant wavespeed $v$ and a point source located at depth $h$ beneath the surface. The first-arrival travel time from the source to a receiver located at horizontal offset $r$ is modeled by the Euclidean path length divided by speed, $t(r) = \\frac{1}{v}\\sqrt{r^{2} + h^{2}}$. Two receivers are placed at offsets $r_{1} = r + \\delta$ and $r_{2} = r - \\delta$, where $r > 0$ and $0 < \\delta \\ll r$. Let $t_{1} = t(r_{1})$ and $t_{2} = t(r_{2})$. The quantity of interest is the differential travel time $\\Delta t = t_{1} - t_{2}$, which is used in waveform residuals and moveout estimators in computational geophysics.\n\nAssume that floating-point computations obey the standard model of rounding to nearest in Institute of Electrical and Electronics Engineers (IEEE) 754 double precision: for any basic arithmetic operation applied to normalized operands, $\\operatorname{fl}(x \\,\\mathrm{op}\\, y) = (x \\,\\mathrm{op}\\, y)(1 + \\delta)$ with $|\\delta| \\leq u$, where $u$ is the unit roundoff. Neglect underflow and overflow. Also adopt the standard definition of forward condition number for a function $f$ at input $x$, $\\kappa_{f}(x) = \\lim_{\\epsilon \\to 0} \\sup_{\\|\\Delta x\\| \\leq \\epsilon \\|x\\|} \\frac{\\|f(x + \\Delta x) - f(x)\\| / \\|f(x)\\|}{\\|\\Delta x\\|/\\|x\\|}$, and the scalar specialization for subtraction.\n\nYour tasks are:\n- Starting from these base models and definitions, analyze the sensitivity of computing $\\Delta t$ by naive subtraction of $t_{1}$ and $t_{2}$ in IEEE 754 double precision. Derive the forward relative error bound in terms of $u$ and the appropriate subtraction condition number, and express this condition number explicitly in terms of $t_{1}$ and $t_{2}$.\n- Propose and derive, from first principles and algebraic identities, a numerically stable reformulation of $\\Delta t$ that avoids catastrophic cancellation for the given travel-time model. Simplify the reformulation into a closed-form expression in terms of $r$, $\\delta$, $h$, and $v$.\n\nProvide the final answer as the single simplified analytical expression for the numerically stable reformulation of $\\Delta t$ in terms of $r$, $\\delta$, $h$, and $v$.", "solution": "**Part 1: Sensitivity Analysis of Naive Subtraction**\n\nThe quantity of interest is $\\Delta t = t_{1} - t_{2}$. Given the travel time model $t(r) = \\frac{1}{v}\\sqrt{r^{2} + h^{2}}$ and the receiver offsets $r_1=r+\\delta$ and $r_2=r-\\delta$, the specific expressions for $t_1$ and $t_2$ are:\n$$\nt_{1} = \\frac{1}{v}\\sqrt{(r+\\delta)^{2} + h^{2}} \\quad \\text{and} \\quad t_{2} = \\frac{1}{v}\\sqrt{(r-\\delta)^{2} + h^{2}}\n$$\nThe constraint $0 < \\delta \\ll r$ implies that $r_1 \\approx r$ and $r_2 \\approx r$, and consequently, $t_1 \\approx t_2$. The direct computation of $\\Delta t$ involves the subtraction of two nearly equal numbers, an operation known to be prone to catastrophic cancellation.\n\nTo analyze the error, we consider the standard model of floating-point arithmetic. The values $t_1$ and $t_2$ are not computed exactly. Let their computed floating-point representations be $\\hat{t}_1$ and $\\hat{t}_2$. These will have some accumulated error from the operations used to calculate them. We can model this as $\\hat{t}_1 = t_1(1+\\epsilon_1)$ and $\\hat{t}_2 = t_2(1+\\epsilon_2)$, where $|\\epsilon_1|$ and $|\\epsilon_2|$ are small multiples of the unit roundoff $u$.\n\nThe final operation is the subtraction:\n$$\n\\widehat{\\Delta t} = \\operatorname{fl}(\\hat{t}_1 - \\hat{t}_2) = (\\hat{t}_1 - \\hat{t}_2)(1 + \\zeta)\n$$\nwhere $|\\zeta| \\le u$.\n\nThe forward relative error is given by $\\frac{|\\widehat{\\Delta t} - \\Delta t|}{|\\Delta t|}$.\n$$\n\\widehat{\\Delta t} - \\Delta t = (t_1(1+\\epsilon_1) - t_2(1+\\epsilon_2))(1+\\zeta) - (t_1 - t_2)\n$$\nExpanding and retaining only first-order terms in $\\epsilon_1$, $\\epsilon_2$, and $\\zeta$:\n$$\n\\widehat{\\Delta t} - \\Delta t \\approx (t_1 - t_2)\\zeta + t_1\\epsilon_1 - t_2\\epsilon_2\n$$\nThe relative error is thus:\n$$\n\\frac{\\widehat{\\Delta t} - \\Delta t}{\\Delta t} \\approx \\frac{(t_1 - t_2)\\zeta + t_1\\epsilon_1 - t_2\\epsilon_2}{t_1 - t_2} = \\zeta + \\frac{t_1\\epsilon_1 - t_2\\epsilon_2}{t_1 - t_2}\n$$\nTaking the absolute value, we can establish a bound:\n$$\n\\left| \\frac{\\widehat{\\Delta t} - \\Delta t}{\\Delta t} \\right| \\lesssim u + \\frac{|t_1\\epsilon_1| + |t_2\\epsilon_2|}{|t_1 - t_2|} \\le u + \\frac{t_1|\\epsilon_1| + t_2|\\epsilon_2|}{|t_1 - t_2|}\n$$\nAssuming the input relative errors are bounded, $|\\epsilon_1|, |\\epsilon_2| \\le \\epsilon_{\\text{in}}$, the bound becomes:\n$$\n\\left| \\frac{\\widehat{\\Delta t} - \\Delta t}{\\Delta t} \\right| \\lesssim u + \\left(\\frac{t_1 + t_2}{|t_1 - t_2|}\\right) \\epsilon_{\\text{in}}\n$$\nThe term multiplying the input error bound $\\epsilon_{\\text{in}}$ is the relative condition number of the subtraction operation $f(x,y) = x-y$. For positive inputs $x=t_1$ and $y=t_2$, the condition number $\\kappa$ is:\n$$\n\\kappa = \\frac{t_1 + t_2}{t_1 - t_2}\n$$\nSince $t_1 \\approx t_2$, the denominator $t_1 - t_2$ is small, causing $\\kappa$ to be very large. This amplifies the input errors $\\epsilon_1, \\epsilon_2$, leading to a large relative error in the final result, a phenomenon known as catastrophic cancellation. The forward relative error is bounded by a quantity proportional to $\\kappa u$, which can be many orders of magnitude larger than $u$.\n\n**Part 2: Numerically Stable Reformulation**\n\nTo avoid this numerical instability, we must reformulate the expression for $\\Delta t$ to eliminate the subtraction of nearly equal terms. The expression is of the form $\\sqrt{A} - \\sqrt{B}$. A standard algebraic technique is to multiply and divide by the conjugate, $\\sqrt{A} + \\sqrt{B}$.\n\nStarting from the definition of $\\Delta t$:\n$$\n\\Delta t = t_1 - t_2 = \\frac{1}{v}\\left( \\sqrt{(r+\\delta)^{2} + h^{2}} - \\sqrt{(r-\\delta)^{2} + h^{2}} \\right)\n$$\nWe multiply the term in the parenthesis by $\\frac{\\sqrt{(r+\\delta)^{2} + h^{2}} + \\sqrt{(r-\\delta)^{2} + h^{2}}}{\\sqrt{(r+\\delta)^{2} + h^{2}} + \\sqrt{(r-\\delta)^{2} + h^{2}}}$.\nThe numerator becomes a difference of squares:\n$$\n\\left((r+\\delta)^{2} + h^{2}\\right) - \\left((r-\\delta)^{2} + h^{2}\\right)\n$$\nExpanding the squared terms:\n$$\n= (r^2 + 2r\\delta + \\delta^2 + h^2) - (r^2 - 2r\\delta + \\delta^2 + h^2)\n$$\n$$\n= r^2 + 2r\\delta + \\delta^2 + h^2 - r^2 + 2r\\delta - \\delta^2 - h^2 = 4r\\delta\n$$\nThis simplification is exact and does not introduce any approximation. The expression for $\\Delta t$ now is:\n$$\n\\Delta t = \\frac{1}{v} \\frac{4r\\delta}{\\sqrt{(r+\\delta)^{2} + h^{2}} + \\sqrt{(r-\\delta)^{2} + h^{2}}}\n$$\nThe final simplified, closed-form expression is:\n$$\n\\Delta t = \\frac{4r\\delta}{v\\left(\\sqrt{(r+\\delta)^{2} + h^{2}} + \\sqrt{(r-\\delta)^{2} + h^{2}}\\right)}\n$$\nThis reformulated expression is numerically stable. The term that was previously a subtraction of two nearly equal numbers, $t_1 - t_2$, has been eliminated. The new denominator contains the sum of two nearly equal positive numbers, $v(t_1+t_2)$. The addition of two numbers with the same sign is always a well-conditioned operation, thus preventing catastrophic cancellation. All operations in this new formula (additions, multiplications, division, square root) are numerically benign.", "answer": "$$\n\\boxed{\\frac{4r\\delta}{v\\left(\\sqrt{(r+\\delta)^{2} + h^{2}} + \\sqrt{(r-\\delta)^{2} + h^{2}}\\right)}}\n$$", "id": "3573094"}, {"introduction": "Geophysical systems like elastic wave propagation are often conservative, possessing invariants like energy $E$. This computational practice explores how the choice of time integrator affects the long-term preservation of such quantities. By implementing and comparing the classical Runge-Kutta method against a symplectic integrator (Störmer-Verlet), you will observe firsthand the superior long-term fidelity of geometric integrators for simulating Hamiltonian systems [@problem_id:3573143].", "problem": "Consider the one-dimensional linear elastic wave equation on a periodic domain of length $L$,\n$$\\rho\\,\\frac{\\partial^2 u}{\\partial t^2} = T\\,\\frac{\\partial^2 u}{\\partial x^2},$$\nwhere $u(x,t)$ is the displacement field, $\\rho$ is the mass density, and $T$ is the tension. Define the wave speed $c$ by $c = \\sqrt{T/\\rho}$. Assume the physical units $\\rho$ in $\\mathrm{kg/m}$, $T$ in $\\mathrm{N}$, $c$ in $\\mathrm{m/s}$, $x$ in $\\mathrm{m}$, $t$ in $\\mathrm{s}$, and $u$ in $\\mathrm{m}$. In the semi-discrete (space-discretized) approximation, use $N$ equally spaced grid points with spacing $\\Delta x = L/N$ and periodic boundary conditions, and the standard second-order central difference for the spatial second derivative,\n$$\\left(\\frac{\\partial^2 u}{\\partial x^2}\\right)_i \\approx \\frac{u_{i-1} - 2u_i + u_{i+1}}{\\Delta x^2},$$\nwhich yields the semi-discrete system\n$$\\frac{d^2 u_i}{dt^2} = c^2\\,\\frac{u_{i-1} - 2u_i + u_{i+1}}{\\Delta x^2},\\quad i=0,\\dots,N-1,$$\nwith indices interpreted modulo $N$ to enforce periodicity. The discrete energy consistent with the continuum energy density $E = \\tfrac{1}{2}\\int (\\rho\\,u_t^2 + T\\,u_x^2)\\,dx$ is\n$$E_{\\mathrm{d}}(t) = \\frac{1}{2}\\sum_{i=0}^{N-1}\\Delta x\\left[\\rho\\,v_i(t)^2 + T\\left(\\frac{u_{i+1}(t)-u_i(t)}{\\Delta x}\\right)^2\\right],$$\nwhere $v_i(t) = \\frac{d u_i}{dt}$ and $T = \\rho\\,c^2$. Let the initial condition be a single Fourier mode with zero initial velocity,\n$$u(x,0) = A\\,\\sin\\left(2\\pi m_0 \\frac{x}{L}\\right),\\quad \\frac{\\partial u}{\\partial t}(x,0) = 0,$$\nsampled on the grid. The exact semi-discrete dynamics of each Fourier mode is a harmonic oscillator with angular frequency\n$$\\omega_m = c\\,\\frac{2\\sin\\left(\\pi m/N\\right)}{\\Delta x},$$\ncorresponding to the discrete Laplacian eigenvalue $-4\\sin^2(\\pi m/N)/\\Delta x^2$.\n\nImplement two time integrators for the semi-discrete system:\n- The symplectic Störmer–Verlet (SV) method in its velocity-Verlet form (define the half-step velocity update, full-step position update, and final half-step velocity update per step).\n- The classical fourth-order Runge–Kutta (RK4) method applied to the first-order system in $(u,v)$, where $u' = v$ and $v' = c^2 \\Delta_x^2 u$.\n\nFor each time integrator, propagate the semi-discrete system for a long time and measure:\n1. The long-time energy drift $\\Delta E(t) = E_{\\mathrm{d}}(t) - E_{\\mathrm{d}}(0)$, reported in $\\mathrm{J}$.\n2. The phase error accumulation for the excited Fourier mode $m_0$, reported in radians. Estimate the numerical phase $\\phi_{\\mathrm{num}}(t)$ from the projected modal coordinates $(a(t),\\dot{a}(t))$ via\n$$\\phi_{\\mathrm{num}}(t) = \\mathrm{atan2}\\left(-\\frac{\\dot{a}(t)}{A\\,\\omega_{m_0}}, \\frac{a(t)}{A}\\right),$$\nwhere $a(t)$ and $\\dot{a}(t)$ are obtained by projecting $(u(t),v(t))$ onto the discrete basis vector $\\sin(2\\pi m_0 x/L)$ using the $\\Delta x$-weighted inner product. The exact phase is $\\phi_{\\mathrm{exact}}(t) = \\omega_{m_0}\\,t$; report the wrapped difference $\\delta\\phi(t) = \\mathrm{wrap}_{[-\\pi,\\pi]}(\\phi_{\\mathrm{num}}(t) - \\phi_{\\mathrm{exact}}(t))$ in radians. Angles must be expressed in radians.\n\nThe Courant–Friedrichs–Lewy (CFL) condition provides a stability bound for the symplectic Störmer–Verlet method in terms of the maximum modal frequency $\\omega_{\\max}$, which for the semi-discrete operator is $\\omega_{\\max} = c\\,\\frac{2}{\\Delta x}$. Explore accuracy, stability, and convergence by comparing Störmer–Verlet against Runge–Kutta over different time step sizes and spatial resolutions.\n\nUse the following physical and numerical parameters for the test suite:\n- $L = 1$ (in $\\mathrm{m}$), $\\rho = 1$ (in $\\mathrm{kg/m}$), $c = 1$ (in $\\mathrm{m/s}$), hence $T = 1$ (in $\\mathrm{N}$).\n- $A = 10^{-3}$ (in $\\mathrm{m}$), $m_0 = 3$.\n- $t_{\\mathrm{final}} = 20$ (in $\\mathrm{s}$).\n- Six test cases $(\\text{integrator}, N, \\Delta t)$:\n    1. $\\text{SV}$, $N=128$, $\\Delta t = 0.002$ (happy path, small time step).\n    2. $\\text{RK4}$, $N=128$, $\\Delta t = 0.002$ (same as $1$ for comparison).\n    3. $\\text{SV}$, $N=128$, $\\Delta t = 0.0075$ (near the symplectic stability limit, since the CFL bound suggests $\\Delta t_{\\max} \\approx 1/N = 0.0078125$).\n    4. $\\text{RK4}$, $N=128$, $\\Delta t = 0.0075$ (non-symplectic at larger time step).\n    5. $\\text{SV}$, $N=64$, $\\Delta t = 1/64 = 0.015625$ (borderline CFL for coarser grid).\n    6. $\\text{RK4}$, $N=64$, $\\Delta t = 1/64 = 0.015625$ (non-symplectic at borderline time step).\n\nYour program must:\n- Construct the semi-discrete system and advance it using each specified integrator and parameters.\n- Compute $E_{\\mathrm{d}}(0)$ and $E_{\\mathrm{d}}(t_{\\mathrm{final}})$, then report $\\Delta E(t_{\\mathrm{final}})$ in $\\mathrm{J}$.\n- Compute the phase error $\\delta\\phi(t_{\\mathrm{final}})$ in radians for the single excited mode $m_0$ using the projection and angle definition above.\n- Produce a single line of output containing the results as a comma-separated list of lists in the form\n\"[[\\Delta E_1,\\delta\\phi_1],[\\Delta E_2,\\delta\\phi_2],\\dots,[\\Delta E_6,\\delta\\phi_6]]\",\nwith all $\\Delta E_k$ in $\\mathrm{J}$ and all $\\delta\\phi_k$ in radians.\n\nAll angles must be in radians. All physical quantities must be reported in the units specified above. No external input or files are permitted; the program must be self-contained and deterministic.", "solution": "The problem presented requires the numerical simulation of the one-dimensional linear elastic wave equation,\n$$\n\\rho\\,\\frac{\\partial^2 u}{\\partial t^2} = T\\,\\frac{\\partial^2 u}{\\partial x^2}\n$$\non a periodic domain of length $L$. The physical parameters are the mass density $\\rho$ and tension $T$, which define the wave speed $c = \\sqrt{T/\\rho}$. The problem is well-posed, scientifically grounded, and provides all necessary parameters and definitions for a unique, verifiable numerical experiment. We will implement and compare two time integration schemes: the symplectic Störmer–Verlet (SV) method and the classical fourth-order Runge–Kutta (RK4) method. The comparison will focus on long-term energy conservation and phase accuracy.\n\nFirst, we discretize the spatial domain. We use $N$ grid points $x_i = i\\,\\Delta x$ for $i=0, \\dots, N-1$, with a grid spacing of $\\Delta x = L/N$. The second spatial derivative is approximated using a second-order central difference stencil, which, under periodic boundary conditions, yields the semi-discrete system of ordinary differential equations (ODEs):\n$$\n\\frac{d^2 u_i}{dt^2} = \\frac{c^2}{\\Delta x^2} (u_{i-1} - 2u_i + u_{i+1})\n$$\nwhere indices are taken modulo $N$. This can be written in vector form as $\\frac{d^2 \\mathbf{u}}{dt^2} = \\mathbf{a}(\\mathbf{u})$, where $\\mathbf{u} = [u_0, u_1, \\dots, u_{N-1}]^T$ is the vector of displacements at the grid points, and $\\mathbf{a}(\\mathbf{u})$ is the acceleration vector.\n\nThe initial condition is a single sinusoidal mode with zero initial velocity:\n$$\nu(x,0) = A\\,\\sin\\left(2\\pi m_0 \\frac{x}{L}\\right), \\quad \\frac{\\partial u}{\\partial t}(x,0) = 0\n$$\nSampled on the grid, this gives the initial state vectors:\n$$\nu_i(0) = A\\,\\sin\\left(2\\pi m_0 \\frac{i}{N}\\right), \\quad v_i(0) = 0 \\quad \\text{for } i=0, \\dots, N-1\n$$\nwhere $v_i = du_i/dt$.\n\nWe will now detail the two numerical integrators used to solve this system from $t=0$ to $t=t_{\\mathrm{final}}$.\n\n1.  **Störmer–Verlet (SV) Method**: This integrator is specifically designed for second-order ODEs of the form $\\ddot{\\mathbf{u}} = \\mathbf{a}(\\mathbf{u})$. It is a member of the class of geometric integrators, specifically symplectic integrators, which are known for their excellent long-term energy conservation properties for Hamiltonian systems. We use the velocity-Verlet formulation, which advances the solution from time $t_n$ to $t_{n+1} = t_n + \\Delta t$ in three steps:\n    \\begin{enumerate}\n        \\item Compute the velocity at the half-step: $\\mathbf{v}_{n+1/2} = \\mathbf{v}_n + \\mathbf{a}(\\mathbf{u}_n) \\frac{\\Delta t}{2}$\n        \\item Update the position using the half-step velocity: $\\mathbf{u}_{n+1} = \\mathbf{u}_n + \\mathbf{v}_{n+1/2} \\Delta t$\n        \\item Compute the final velocity using the new acceleration: $\\mathbf{v}_{n+1} = \\mathbf{v}_{n+1/2} + \\mathbf{a}(\\mathbf{u}_{n+1}) \\frac{\\Delta t}{2}$\n    \\end{enumerate}\n    The stability of this scheme for the wave equation is governed by the Courant–Friedrichs–Lewy (CFL) condition. For this specific discretization, the condition is $c \\frac{\\Delta t}{\\Delta x} \\le 1$.\n\n2.  **Fourth-Order Runge–Kutta (RK4) Method**: This is a general-purpose, high-accuracy explicit integrator. To apply it, we first convert our second-order system into a first-order system. Let the state vector be $\\mathbf{y} = [\\mathbf{u}^T, \\mathbf{v}^T]^T$. The system becomes $\\frac{d\\mathbf{y}}{dt} = F(\\mathbf{y})$, where $F(\\mathbf{y}) = [\\mathbf{v}^T, \\mathbf{a}(\\mathbf{u})^T]^T$. The RK4 algorithm advances the solution from $\\mathbf{y}_n$ to $\\mathbf{y}_{n+1}$ as follows:\n    \\begin{enumerate}\n        \\item $\\mathbf{k}_1 = \\Delta t \\, F(\\mathbf{y}_n)$\n        \\item $\\mathbf{k}_2 = \\Delta t \\, F(\\mathbf{y}_n + \\mathbf{k}_1/2)$\n        \\item $\\mathbf{k}_3 = \\Delta t \\, F(\\mathbf{y}_n + \\mathbf{k}_2/2)$\n        \\item $\\mathbf{k}_4 = \\Delta t \\, F(\\mathbf{y}_n + \\mathbf{k}_3)$\n        \\item $\\mathbf{y}_{n+1} = \\mathbf{y}_n + \\frac{1}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)$\n    \\end{enumerate}\n    While highly accurate for a single step, RK4 is not symplectic and is expected to exhibit secular energy drift (dissipation or growth) over long integration times.\n\nTo evaluate the performance, we measure two key quantities at $t=t_{\\mathrm{final}}$:\n\n-   **Energy Drift**: The discrete energy of the system is given by:\n    $$\n    E_{\\mathrm{d}}(t) = \\frac{1}{2}\\sum_{i=0}^{N-1}\\Delta x\\left[\\rho\\,v_i(t)^2 + T\\left(\\frac{u_{i+1}(t)-u_i(t)}{\\Delta x}\\right)^2\\right]\n    $$\n    We compute the energy drift $\\Delta E = E_{\\mathrm{d}}(t_{\\mathrm{final}}) - E_{\\mathrm{d}}(0)$. For the symplectic SV method, we expect $|\\Delta E|$ to remain bounded and small, oscillating around zero. For the non-symplectic RK4 method, we expect $\\Delta E$ to grow over time.\n\n-   **Phase Error**: For the initial condition chosen, only the single Fourier mode $m_0$ is excited. The exact solution to the semi-discrete system for this mode is a harmonic oscillation with angular frequency $\\omega_{m_0} = c \\frac{2\\sin(\\pi m_0/N)}{\\Delta x}$. The exact phase at time $t$ is $\\phi_{\\mathrm{exact}}(t) = \\omega_{m_0} t$. To measure the numerical phase, we project the numerical solution $(\\mathbf{u}(t), \\mathbf{v}(t))$ back onto the basis vector for mode $m_0$. The projected amplitude $a(t)$ and its time derivative $\\dot{a}(t)$ are calculated using the discrete inner product:\n    $$\n    a(t) = \\frac{\\langle \\mathbf{u}(t), \\boldsymbol{\\phi}_{m_0} \\rangle}{\\langle \\boldsymbol{\\phi}_{m_0}, \\boldsymbol{\\phi}_{m_0} \\rangle}, \\quad \\dot{a}(t) = \\frac{\\langle \\mathbf{v}(t), \\boldsymbol{\\phi}_{m_0} \\rangle}{\\langle \\boldsymbol{\\phi}_{m_0}, \\boldsymbol{\\phi}_{m_0} \\rangle}\n    $$\n    where $\\boldsymbol{\\phi}_{m_0}$ is the vector with components $\\sin(2\\pi m_0 x_i / L)$ and the inner product is $\\langle \\mathbf{f}, \\mathbf{g} \\rangle = \\sum_i f_i g_i \\Delta x$. The normalization factor is $\\langle \\boldsymbol{\\phi}_{m_0}, \\boldsymbol{\\phi}_{m_0} \\rangle = L/2$. The numerical phase is then $\\phi_{\\mathrm{num}}(t) = \\mathrm{atan2}\\left(-\\dot{a}(t) / (A\\,\\omega_{m_0}), a(t)/A\\right)$. The phase error is the wrapped difference $\\delta\\phi(t) = \\mathrm{wrap}_{[-\\pi,\\pi]}(\\phi_{\\mathrm{num}}(t) - \\phi_{\\mathrm{exact}}(t))$.\n\nThe simulation is run for the six specified test cases, and the results for energy drift and phase error are compiled. The parameters used are $L=1$, $\\rho=1$, $c=1$, $A=10^{-3}$, $m_0=3$, and $t_{\\mathrm{final}}=20$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D wave equation using Störmer-Verlet and RK4 integrators,\n    and reports energy drift and phase error for a set of test cases.\n    \"\"\"\n    \n    # Define physical and numerical parameters from the problem statement.\n    L = 1.0  # m\n    rho = 1.0  # kg/m\n    c = 1.0  # m/s\n    T = rho * c**2  # N\n    A = 1e-3  # m\n    m0 = 3\n    t_final = 20.0  # s\n\n    # Define the six test cases\n    test_cases = [\n        # (integrator_name, N, dt)\n        ('SV', 128, 0.002),\n        ('RK4', 128, 0.002),\n        ('SV', 128, 0.0075),\n        ('RK4', 128, 0.0075),\n        ('SV', 64, 1/64),\n        ('RK4', 64, 1/64),\n    ]\n\n    results = []\n\n    for integrator_name, N, dt in test_cases:\n        # --- Setup for the current test case ---\n        dx = L / N\n        x = np.linspace(0, L, N, endpoint=False)\n        \n        # Initial conditions\n        u = A * np.sin(2 * np.pi * m0 * x / L)\n        v = np.zeros(N)\n        \n        u0, v0 = np.copy(u), np.copy(v)\n\n        def get_accel(u_state, c_val, dx_val):\n            \"\"\"Computes acceleration using central difference for the 2nd derivative.\"\"\"\n            u_left = np.roll(u_state, 1)\n            u_right = np.roll(u_state, -1)\n            return (c_val**2 / dx_val**2) * (u_left - 2 * u_state + u_right)\n\n        def calculate_energy(u_state, v_state, rho_val, T_val, dx_val):\n            \"\"\"Computes the discrete energy of the system.\"\"\"\n            u_diff = np.roll(u_state, -1) - u_state\n            potential_energy = 0.5 * T_val * np.sum((u_diff / dx_val)**2) * dx_val\n            kinetic_energy = 0.5 * rho_val * np.sum(v_state**2) * dx_val\n            return potential_energy + kinetic_energy\n\n        E0 = calculate_energy(u0, v0, rho, T, dx)\n        \n        # --- Time integration loop ---\n        num_steps = int(round(t_final / dt))\n        actual_t_final = num_steps * dt\n\n        if integrator_name == 'SV':\n            accel = get_accel(u, c, dx)\n            for _ in range(num_steps):\n                v_half = v + 0.5 * dt * accel\n                u = u + dt * v_half\n                accel = get_accel(u, c, dx)\n                v = v_half + 0.5 * dt * accel\n        \n        elif integrator_name == 'RK4':\n            state = np.concatenate((u, v))\n            \n            def F(y):\n                u_part = y[:N]\n                v_part = y[N:]\n                accel_part = get_accel(u_part, c, dx)\n                return np.concatenate((v_part, accel_part))\n\n            for _ in range(num_steps):\n                k1 = dt * F(state)\n                k2 = dt * F(state + 0.5 * k1)\n                k3 = dt * F(state + 0.5 * k2)\n                k4 = dt * F(state + k3)\n                state += (k1 + 2*k2 + 2*k3 + k4) / 6\n            \n            u = state[:N]\n            v = state[N:]\n\n        # --- Post-processing and analysis ---\n        \n        # 1. Energy Drift Calculation\n        Ef = calculate_energy(u, v, rho, T, dx)\n        delta_E = Ef - E0\n\n        # 2. Phase Error Calculation\n        # Exact angular frequency of the semi-discrete system for mode m0\n        omega_m0 = c * (2 * np.sin(np.pi * m0 / N) / dx)\n        phi_exact = omega_m0 * actual_t_final\n\n        # Project numerical solution onto the basis vector for mode m0\n        basis_vec = np.sin(2 * np.pi * m0 * x / L)\n        norm_factor = np.sum(basis_vec**2) * dx # Should be L/2 for m0 != 0, N/2\n\n        a_t = np.sum(u * basis_vec) * dx / norm_factor\n        adot_t = np.sum(v * basis_vec) * dx / norm_factor\n\n        # Numerical phase from projected coordinates\n        phi_num = np.arctan2(-adot_t / (A * omega_m0), a_t / A)\n\n        # Phase error, wrapped to [-pi, pi]\n        delta_phi = phi_num - phi_exact\n        delta_phi = (delta_phi + np.pi) % (2 * np.pi) - np.pi\n\n        results.append([delta_E, delta_phi])\n\n    # Format the final output string\n    result_str = \"[\" + \",\".join([f\"[{e:.15e},{p:.15e}]\" for e, p in results]) + \"]\"\n    print(result_str)\n\nsolve()\n```", "id": "3573143"}]}