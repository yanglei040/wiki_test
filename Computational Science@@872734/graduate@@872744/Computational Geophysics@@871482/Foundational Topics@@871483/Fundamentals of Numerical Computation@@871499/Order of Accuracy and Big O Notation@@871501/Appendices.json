{"hands_on_practices": [{"introduction": "The bedrock of analyzing any finite difference method is understanding its local truncation error. This practice takes you back to first principles, using the Taylor series expansion—a fundamental tool in numerical analysis—to formally quantify the error of the standard centered difference approximation for the second derivative. By completing this derivation, you will gain a concrete understanding of what it means for a scheme to be second-order accurate, or $O(h^2)$, and identify the source of its leading error term. [@problem_id:3612404]", "problem": "In one-dimensional seismic wave propagation modeling, the spatial second derivative of the displacement field $u(x)$ appears in the acoustic wave equation and is commonly approximated using finite differences on a uniform grid. Let $u(x)$ be a scalar field representing displacement, assumed to be sufficiently smooth with at least four continuous derivatives in an open interval containing a grid node $x_{i}$. On a uniform grid of spacing $h>0$, the standard centered second-order finite difference operator $\\mathcal{L}_{h}$ for the second derivative is defined at node $x_{i}$ by\n$$\n\\mathcal{L}_{h}u(x_{i}) \\equiv \\frac{u(x_{i}+h) - 2u(x_{i}) + u(x_{i}-h)}{h^{2}}.\n$$\nThe continuous operator $\\mathcal{L}$ is $\\mathcal{L}u(x) \\equiv u''(x)$. The local truncation error (LTE), denoted by $\\tau(x_{i};h)$, is defined as $\\tau(x_{i};h) \\equiv \\mathcal{L}_{h}u(x_{i}) - \\mathcal{L}u(x_{i})$. Using the Taylor series expansion as the fundamental base and the definition of Big O notation (where $f(h) = O(h^{p})$ as $h \\to 0$ means there exist constants $C>0$ and $h_{0}>0$ such that $|f(h)| \\leq C h^{p}$ for all $0<h<h_{0}$), derive the leading-order term of $\\tau(x_{i};h)$ and show that the leading error is $O(h^{2})$ with a coefficient involving the fourth derivative $u^{(4)}(x_{i})$. Provide your final answer as the explicit symbolic expression for the leading term of $\\tau(x_{i};h)$ in terms of $h$ and $u^{(4)}(x_{i})$. No numerical evaluation is required, and no units are to be included. The final answer must be a single closed-form analytic expression.", "solution": "The problem requires the derivation of the leading-order term of the local truncation error (LTE) for the standard centered finite difference approximation of the second derivative. The LTE, denoted by $\\tau(x_{i};h)$, is defined as the difference between the finite difference operator, $\\mathcal{L}_{h}$, and the continuous differential operator, $\\mathcal{L}$, applied to a sufficiently smooth function $u(x)$.\n\nThe given operators are:\nThe continuous operator: $\\mathcal{L}u(x_{i}) = u''(x_{i})$.\nThe discrete finite difference operator:\n$$\n\\mathcal{L}_{h}u(x_{i}) = \\frac{u(x_{i}+h) - 2u(x_{i}) + u(x_{i}-h)}{h^{2}}\n$$\nThe local truncation error is therefore:\n$$\n\\tau(x_{i};h) = \\mathcal{L}_{h}u(x_{i}) - \\mathcal{L}u(x_{i}) = \\frac{u(x_{i}+h) - 2u(x_{i}) + u(x_{i}-h)}{h^{2}} - u''(x_{i})\n$$\nTo analyze this expression, we employ Taylor series expansions for the terms $u(x_{i}+h)$ and $u(x_{i}-h)$ around the point $x_{i}$. The problem states that the function $u(x)$ has at least four continuous derivatives, which allows us to expand the series to include the term involving the fourth derivative and a remainder of higher order.\n\nThe Taylor series expansion for $u(x_{i}+h)$ around $x_{i}$ is:\n$$\nu(x_{i}+h) = u(x_{i}) + h u'(x_{i}) + \\frac{h^{2}}{2!} u''(x_{i}) + \\frac{h^{3}}{3!} u'''(x_{i}) + \\frac{h^{4}}{4!} u^{(4)}(x_{i}) + O(h^{5})\n$$\nThe Taylor series expansion for $u(x_{i}-h)$ around $x_{i}$ is:\n$$\nu(x_{i}-h) = u(x_{i}) - h u'(x_{i}) + \\frac{h^{2}}{2!} u''(x_{i}) - \\frac{h^{3}}{3!} u'''(x_{i}) + \\frac{h^{4}}{4!} u^{(4)}(x_{i}) - O(h^{5})\n$$\nWe substitute these expansions into the numerator of the finite difference operator, $u(x_{i}+h) - 2u(x_{i}) + u(x_{i}-h)$:\n\\begin{align*}\n& \\left( u(x_{i}) + h u'(x_{i}) + \\frac{h^{2}}{2} u''(x_{i}) + \\frac{h^{3}}{6} u'''(x_{i}) + \\frac{h^{4}}{24} u^{(4)}(x_{i}) + O(h^{5}) \\right) \\\\\n- & 2u(x_{i}) \\\\\n+ & \\left( u(x_{i}) - h u'(x_{i}) + \\frac{h^{2}}{2} u''(x_{i}) - \\frac{h^{3}}{6} u'''(x_{i}) + \\frac{h^{4}}{24} u^{(4)}(x_{i}) - O(h^{5}) \\right)\n\\end{align*}\nCombining like terms by their derivatives:\n- Zeroth derivative terms: $u(x_{i}) - 2u(x_{i}) + u(x_{i}) = 0$.\n- First derivative terms: $h u'(x_{i}) - h u'(x_{i}) = 0$.\n- Second derivative terms: $\\frac{h^{2}}{2} u''(x_{i}) + \\frac{h^{2}}{2} u''(x_{i}) = h^{2} u''(x_{i})$.\n- Third derivative terms: $\\frac{h^{3}}{6} u'''(x_{i}) - \\frac{h^{3}}{6} u'''(x_{i}) = 0$.\n- Fourth derivative terms: $\\frac{h^{4}}{24} u^{(4)}(x_{i}) + \\frac{h^{4}}{24} u^{(4)}(x_{i}) = \\frac{2h^{4}}{24} u^{(4)}(x_{i}) = \\frac{h^{4}}{12} u^{(4)}(x_{i})$.\n- Higher-order terms: The odd-powered terms, such as those involving $u^{(5)}(x_{i})$, will cancel in a similar fashion to the first and third derivative terms. The next non-zero term in the combined series will be from the sixth derivative, which is of order $h^{6}$. Thus, the remainder is $O(h^{6})$.\n\nThe numerator simplifies to:\n$$\nu(x_{i}+h) - 2u(x_{i}) + u(x_{i}-h) = h^{2} u''(x_{i}) + \\frac{h^{4}}{12} u^{(4)}(x_{i}) + O(h^{6})\n$$\nNow, we substitute this back into the expression for the discrete operator $\\mathcal{L}_{h}u(x_{i})$:\n$$\n\\mathcal{L}_{h}u(x_{i}) = \\frac{1}{h^{2}} \\left( h^{2} u''(x_{i}) + \\frac{h^{4}}{12} u^{(4)}(x_{i}) + O(h^{6}) \\right) = u''(x_{i}) + \\frac{h^{2}}{12} u^{(4)}(x_{i}) + O(h^{4})\n$$\nFinally, we compute the local truncation error $\\tau(x_{i};h)$:\n$$\n\\tau(x_{i};h) = \\mathcal{L}_{h}u(x_{i}) - u''(x_{i}) = \\left( u''(x_{i}) + \\frac{h^{2}}{12} u^{(4)}(x_{i}) + O(h^{4}) \\right) - u''(x_{i})\n$$\n$$\n\\tau(x_{i};h) = \\frac{h^{2}}{12} u^{(4)}(x_{i}) + O(h^{4})\n$$\nFrom this result, we can make two conclusions as requested. First, the leading-order term of the truncation error is $\\frac{h^{2}}{12} u^{(4)}(x_{i})$. Second, according to the definition of Big O notation, since the error is dominated by the term proportional to $h^{2}$ as $h \\to 0$ (assuming $u^{(4)}(x_{i}) \\neq 0$), the local truncation error is of order $h^{2}$, i.e., $\\tau(x_{i};h) = O(h^{2})$. This confirms that the finite difference scheme is second-order accurate.\n\nThe explicit symbolic expression for the leading term of the local truncation error is the term that determines the order of accuracy.", "answer": "$$\\boxed{\\frac{h^{2}}{12} u^{(4)}(x_{i})}$$", "id": "3612404"}, {"introduction": "While the order of accuracy provides a powerful local measure, it does not capture the full behavior of a scheme, especially for wave propagation phenomena critical to geophysics. This exercise explores a crucial subtlety: two schemes can share the same formal order of accuracy yet exhibit vastly different performance due to their dispersive properties. Through Fourier analysis, you will investigate how the numerical phase velocity of two different second-order schemes deviates from the true velocity, revealing the origins of numerical dispersion that can compromise the fidelity of wavefield simulations. [@problem_id:3612459]", "problem": "Consider a one-dimensional narrowband acoustic wave packet whose envelope transport along a preferred direction in a heterogeneous crust can be locally approximated by the linear advection equation $u_{t} + a\\,u_{x} = 0$, where $a>0$ is a constant group velocity. Let the computational domain be discretized on a uniform grid with spatial step $\\Delta x$ and time step $\\Delta t$, and define the Courant-Friedrichs-Lewy (CFL) number $\\nu = a\\,\\Delta t / \\Delta x$. Construct two explicit finite-difference schemes that both have second-order global truncation error $\\mathcal{O}(\\Delta t^{2}, \\Delta x^{2})$ but produce different modified equations:\n- Scheme $\\mathrm{LW}$ (Lax–Wendroff): \n$$u_{i}^{n+1} = u_{i}^{n} - \\frac{a\\,\\Delta t}{2\\,\\Delta x}\\left(u_{i+1}^{n} - u_{i-1}^{n}\\right) + \\frac{a^{2}\\,\\Delta t^{2}}{2\\,\\Delta x^{2}}\\left(u_{i+1}^{n} - 2\\,u_{i}^{n} + u_{i-1}^{n}\\right).$$\n- Scheme $\\mathrm{BW}$ (Beam–Warming upwind, for $a>0$):\n$$u_{i}^{n+1} = u_{i}^{n} - \\frac{a\\,\\Delta t}{2\\,\\Delta x}\\left(3\\,u_{i}^{n} - 4\\,u_{i-1}^{n} + u_{i-2}^{n}\\right) + \\frac{a^{2}\\,\\Delta t^{2}}{2\\,\\Delta x^{2}}\\left(u_{i}^{n} - 2\\,u_{i-1}^{n} + u_{i-2}^{n}\\right).$$\nStarting from the plane-wave ansatz $u_{i}^{n} = \\hat{u}\\,\\exp\\!\\big(i\\,k\\,i\\,\\Delta x\\big)$ and the definition of $\\nu$, perform a von Neumann Fourier analysis and a small-wavenumber expansion to derive the leading-order phase speed error for each scheme. Specifically, show that the numerical phase velocity has the form\n$$\\frac{c_{\\mathrm{num}}(k)}{a} = 1 + \\beta_{s}(\\nu)\\,(k\\,\\Delta x)^{2} + \\mathcal{O}\\big((k\\,\\Delta x)^{4}\\big),$$\nwith $s\\in\\{\\mathrm{LW},\\mathrm{BW}\\}$ and scheme-dependent coefficient $\\beta_{s}(\\nu)$, and explain how different $\\beta_{s}(\\nu)$ induce different phase errors and thus different geophysical wavefield fidelity for dispersive wave packets. Finally, compute the exact analytic expression for the difference of these coefficients,\n$$\\Delta\\beta(\\nu) = \\beta_{\\mathrm{BW}}(\\nu) - \\beta_{\\mathrm{LW}}(\\nu).$$\nExpress your final answer as a closed-form expression in $\\nu$. No rounding is required.", "solution": "We begin from the linear advection equation $u_{t} + a\\,u_{x} = 0$, whose exact plane-wave solution for wavenumber $k$ is $u(x,t) = \\hat{u}\\,\\exp\\!\\big(i\\,(k\\,x - \\omega\\,t)\\big)$ with exact dispersion relation $\\omega = a\\,k$ and exact phase speed $c = \\omega/k = a$. A discrete scheme updates $u_{i}^{n}$ to $u_{i}^{n+1}$ by a linear operator whose amplification factor $G(\\theta)$ for a Fourier mode with nondimensional wavenumber $\\theta = k\\,\\Delta x$ determines the numerical frequency via $G(\\theta) = \\exp\\!\\big(-i\\,\\omega_{\\mathrm{num}}\\,\\Delta t\\big)$. Thus, for small $\\theta$, the phase speed $c_{\\mathrm{num}}(k) = \\omega_{\\mathrm{num}}/k$ can be extracted from the argument of $G(\\theta)$ and expanded as $c_{\\mathrm{num}}(k)/a = 1 + \\beta(\\nu)\\,\\theta^{2} + \\mathcal{O}(\\theta^{4})$.\n\nFor the Lax–Wendroff scheme, substituting $u_{i}^{n} = \\hat{u}\\,e^{i\\,i\\,\\theta}$ yields the amplification factor\n$$G_{\\mathrm{LW}}(\\theta) = 1 - i\\,\\nu\\,\\sin\\theta + \\nu^{2}\\,(\\cos\\theta - 1).$$\nExpanding $\\sin\\theta$ and $\\cos\\theta$ for small $\\theta$,\n$$\\sin\\theta = \\theta - \\frac{\\theta^{3}}{6} + \\mathcal{O}(\\theta^{5}), \\quad \\cos\\theta = 1 - \\frac{\\theta^{2}}{2} + \\frac{\\theta^{4}}{24} + \\mathcal{O}(\\theta^{6}),$$\ngives\n$$G_{\\mathrm{LW}}(\\theta) = 1 - i\\,\\nu\\,\\theta - \\frac{\\nu^{2}}{2}\\,\\theta^{2} + i\\,\\frac{\\nu}{6}\\,\\theta^{3} + \\mathcal{O}(\\theta^{4}).$$\nLet $A = G_{\\mathrm{LW}} - 1 = x + i\\,y$ with $x = -(\\nu^{2}/2)\\,\\theta^{2} + \\mathcal{O}(\\theta^{4})$, $y = -\\nu\\,\\theta + (\\nu/6)\\,\\theta^{3} + \\mathcal{O}(\\theta^{5})$. The argument satisfies $\\arg(G) = \\Im\\ln(1 + A) = y - x\\,y - y^{3}/3 + \\mathcal{O}(\\theta^{5})$. Using $x\\,y = (\\nu^{3}/2)\\,\\theta^{3} + \\mathcal{O}(\\theta^{5})$ and $y^{3} = -\\nu^{3}\\,\\theta^{3} + \\mathcal{O}(\\theta^{5})$, we obtain\n$$\\arg(G_{\\mathrm{LW}}) = -\\nu\\,\\theta + \\left(\\frac{\\nu}{6} - \\frac{\\nu^{3}}{6}\\right)\\theta^{3} + \\mathcal{O}(\\theta^{5}).$$\nSince $G = \\exp(-i\\,\\omega_{\\mathrm{num}}\\,\\Delta t)$, we have $\\omega_{\\mathrm{num}}\\,\\Delta t = -\\arg(G)$, hence\n$$\\frac{\\omega_{\\mathrm{num}}\\,\\Delta t}{\\theta} = \\nu - \\frac{\\nu\\,(1 - \\nu^{2})}{6}\\,\\theta^{2} + \\mathcal{O}(\\theta^{4}).$$\nMultiplying by $(\\Delta x/\\Delta t)$ yields\n$$\\frac{c_{\\mathrm{num,LW}}(k)}{a} = 1 - \\frac{1 - \\nu^{2}}{6}\\,\\theta^{2} + \\mathcal{O}(\\theta^{4}).$$\nTherefore, the Lax–Wendroff phase error coefficient is\n$$\\beta_{\\mathrm{LW}}(\\nu) = -\\frac{1}{6} + \\frac{\\nu^{2}}{6}.$$\n\nFor the Beam–Warming scheme with $a>0$, substituting the same Fourier ansatz gives\n$$G_{\\mathrm{BW}}(\\theta) = 1 - \\frac{\\nu}{2}\\left(3 - 4\\,e^{-i\\theta} + e^{-2i\\theta}\\right) + \\frac{\\nu^{2}}{2}\\left(1 - 2\\,e^{-i\\theta} + e^{-2i\\theta}\\right).$$\nUsing $e^{-i\\theta} = \\cos\\theta - i\\,\\sin\\theta$ and $e^{-2 i \\theta} = \\cos(2\\theta) - i\\,\\sin(2\\theta)$, expand for small $\\theta$:\n$$3 - 4\\,e^{-i\\theta} + e^{-2i\\theta} = 2\\,i\\,\\theta + \\frac{2}{3}\\,i\\,\\theta^{3} + \\frac{1}{2}\\,\\theta^{4} + \\mathcal{O}(\\theta^{5}),$$\n$$1 - 2\\,e^{-i\\theta} + e^{-2i\\theta} = -\\theta^{2} + i\\,\\theta^{3} + \\frac{7}{12}\\,\\theta^{4} + \\mathcal{O}(\\theta^{5}).$$\nThus,\n$$G_{\\mathrm{BW}}(\\theta) = 1 - i\\,\\nu\\,\\theta - \\frac{\\nu^{2}}{2}\\,\\theta^{2} + i\\left(-\\frac{\\nu}{3} + \\frac{\\nu^{2}}{2}\\right)\\theta^{3} + \\mathcal{O}(\\theta^{4}).$$\nLet $A = G_{\\mathrm{BW}} - 1 = x + i\\,y$ with $x = -(\\nu^{2}/2)\\,\\theta^{2} + \\mathcal{O}(\\theta^{4})$, $y = -\\nu\\,\\theta + \\left(-\\frac{\\nu}{3} + \\frac{\\nu^{2}}{2}\\right)\\theta^{3} + \\mathcal{O}(\\theta^{5})$. As before,\n$$\\arg(G_{\\mathrm{BW}}) = y - x\\,y - y^{3}/3 + \\mathcal{O}(\\theta^{5}) = -\\nu\\,\\theta + \\left(-\\frac{\\nu}{3} + \\frac{\\nu^{2}}{2} - \\frac{\\nu^{3}}{6}\\right)\\theta^{3} + \\mathcal{O}(\\theta^{5}).$$\nTherefore,\n$$\\frac{\\omega_{\\mathrm{num}}\\,\\Delta t}{\\theta} = \\nu + \\left(\\frac{\\nu}{3} - \\frac{\\nu^{2}}{2} + \\frac{\\nu^{3}}{6}\\right)\\theta^{2} + \\mathcal{O}(\\theta^{4}),$$\nand hence\n$$\\frac{c_{\\mathrm{num,BW}}(k)}{a} = 1 + \\left(\\frac{1}{3} - \\frac{\\nu}{2} + \\frac{\\nu^{2}}{6}\\right)\\theta^{2} + \\mathcal{O}(\\theta^{4}).$$\nThus, the Beam–Warming phase error coefficient is\n$$\\beta_{\\mathrm{BW}}(\\nu) = \\frac{1}{3} - \\frac{\\nu}{2} + \\frac{\\nu^{2}}{6}.$$\n\nThese two schemes have identical formal truncation order $\\mathcal{O}(\\Delta t^{2}, \\Delta x^{2})$ by Taylor expansion of their discrete operators, but their modified equations differ at the leading dispersive order $\\mathcal{O}(\\theta^{2})$. Specifically, scheme $\\mathrm{LW}$ introduces a phase lag for small $\\theta$ when $\\nu \\neq 1$ (negative coefficient for small $\\nu$), while scheme $\\mathrm{BW}$ introduces a phase lead for small $\\theta$ at modest $\\nu$, and also upwinding induces dissipation at higher orders. In computational geophysics, where accurate phase is critical for wavefield interference, migration, and inversion, these distinct $\\beta_{s}(\\nu)$ lead to markedly different fidelity: the sign and magnitude of $\\beta_{s}$ control numerical dispersion of wave packets, altering arrival times and phase coherence even though both methods are second-order by big-$\\mathcal{O}$ truncation order.\n\nFinally, the requested difference in leading phase error coefficients is\n$$\\Delta\\beta(\\nu) = \\beta_{\\mathrm{BW}}(\\nu) - \\beta_{\\mathrm{LW}}(\\nu) = \\left(\\frac{1}{3} - \\frac{\\nu}{2} + \\frac{\\nu^{2}}{6}\\right) - \\left(-\\frac{1}{6} + \\frac{\\nu^{2}}{6}\\right) = \\frac{1 - \\nu}{2}.$$\nThis closed-form expression quantifies, for a given $\\nu$, how two schemes with identical truncation order nevertheless induce different leading-order numerical dispersion in the geophysical wavefield.", "answer": "$$\\boxed{\\frac{1-\\nu}{2}}$$", "id": "3612459"}, {"introduction": "Theoretical error analysis often describes behavior in an \"asymptotic\" regime of infinitesimally small grid spacing, which may not be representative of performance in practical simulations with finite resolution and complex media. This computational practice bridges the gap between theory and application by modeling how material interfaces can introduce pre-asymptotic errors that temporarily lower the observed convergence rate. You will implement a numerical experiment and a step-doubling estimator to measure the effective order of accuracy, a vital skill for code verification and for understanding simulation results in realistic geological settings. [@problem_id:3612385]", "problem": "Consider one-dimensional acoustic wave propagation through a horizontally layered medium with piecewise constant wave speed. Let there be $N$ layers with wave speeds $c_i$ (in $\\mathrm{m/s}$) and thicknesses $L_i$ (in $\\mathrm{m}$), indexed by $i=1,\\dots,N$. For a time-harmonic signal with frequency $f$ (in $\\mathrm{Hz}$), define the layer wavenumbers by $k_i = 2\\pi f / c_i$ (in $\\mathrm{rad/m}$). The exact phase accumulation across the stack is $\\Phi = \\sum_{i=1}^N k_i L_i$.\n\nA finite-difference (FD) discretization of the one-dimensional Helmholtz operator leads to a numerical (discrete) layer wavenumber $k_{h,i}$ that depends on the grid spacing $h$ (in $\\mathrm{m}$) and the method’s stencil. For the standard second-order central difference approximation of $u''$ in the Helmholtz equation $u'' + k^2 u = 0$, the discrete dispersion relation for a plane wave $u_j = e^{\\mathrm{i} j \\xi}$ yields\n$$\n\\cos(\\xi_i) = 1 - \\frac{(k_i h)^2}{2}, \\quad k_{h,i} = \\frac{\\xi_i}{h}, \\quad \\xi_i \\in [0,\\pi].\n$$\nFor the standard fourth-order five-point approximation of $u''$, the corresponding discrete dispersion relation yields\n$$\n4 \\chi_i^2 - 32 \\chi_i + 28 - 12 (k_i h)^2 = 0,\\quad \\chi_i = \\cos(\\xi_i),\\quad k_{h,i} = \\frac{\\xi_i}{h},\\quad \\xi_i \\in [0,\\pi],\n$$\nwhere the physically relevant root is the one with $\\chi_i$ closest to $1$ for small $k_i h$.\n\nDefine the numerical phase accumulation by $\\Phi_h = \\sum_{i=1}^N k_{h,i} L_i$ and the dispersion phase error by\n$$\nE_{\\mathrm{disp}}(h) = \\left|\\Phi_h - \\Phi\\right|.\n$$\n\nIn a realistic layered medium with coefficient discontinuities at interfaces, grid-to-interface misalignment and local non-smoothness can produce an interface-localized pre-asymptotic error that decays as one power of $h$ slower than the nominal method order. Model this effect by an additive interface error term\n$$\nE_{\\mathrm{int}}(h) = \\alpha\\, h^{p-1}\\, \\sum_{i=1}^{N-1} \\left|k_{i+1} - k_i\\right|,\n$$\nwhere $p \\in \\{2,4\\}$ is the nominal order of accuracy of the FD stencil, and $\\alpha \\in [0,1]$ is a dimensionless misalignment factor.\n\nDefine the total phase error by\n$$\nE(h) = E_{\\mathrm{disp}}(h) + E_{\\mathrm{int}}(h).\n$$\n\nYour tasks are:\n1. Using only the above fundamental definitions and relations, implement a step-doubling estimator that, given a nominal order $p$ and a base grid spacing $h_0$, computes $E(h)$ at $h \\in \\{h_0, h_0/2, h_0/4\\}$ and uses these three values to estimate the dominant observed order $\\hat{m}$ of $E(h)$ with respect to $h$. To this end, use the following construction:\n   - Compute $q_1 = \\log_2\\big(E(h_0)/E(h_0/2)\\big)$ and $q_2 = \\log_2\\big(E(h_0/2)/E(h_0/4)\\big)$.\n   - Perform a least-squares fit of $\\log E(h)$ versus $\\log h$ using the three pairs $\\{(h_0,E(h_0)),(h_0/2,E(h_0/2)),(h_0/4,E(h_0/4))\\}$ to obtain the slope $q_{\\mathrm{lsq}}$.\n   - Define the robust observed order by $\\hat{m} = \\mathrm{median}\\{q_1,q_2,q_{\\mathrm{lsq}}\\}$, and then round to the nearest integer.\n\n2. Apply your estimator to the test suite below. For each case, compute the observed dominant order $\\hat{m}$ as an integer. No physical unit is required for $\\hat{m}$.\n\nAll trigonometric functions must use radians. Ensure that any intermediate inverse cosine argument is clamped to the interval $[-1,1]$ to avoid non-physical values for $\\xi_i$.\n\nTest suite (each case is a tuple $(c,L,f,p,\\alpha,h_0)$):\n- Case A (pre-asymptotic interface-dominated for a second-order method at relatively fine grids): $c = [1800, 2400, 2200]$ in $\\mathrm{m/s}$, $L = [400, 600, 500]$ in $\\mathrm{m}$, $f = 8$ in $\\mathrm{Hz}$, $p = 2$, $\\alpha = 0.8$, $h_0 = 5$ in $\\mathrm{m}$.\n- Case B (nominal second-order regime with small interface misalignment): $c = [1800, 2400, 2200]$ in $\\mathrm{m/s}$, $L = [400, 600, 500]$ in $\\mathrm{m}$, $f = 8$ in $\\mathrm{Hz}$, $p = 2$, $\\alpha = 0.05$, $h_0 = 20$ in $\\mathrm{m}$.\n- Case C (pre-asymptotic interface-dominated for a fourth-order method): $c = [1500, 2500, 3000, 2000]$ in $\\mathrm{m/s}$, $L = [300, 400, 500, 300]$ in $\\mathrm{m}$, $f = 12$ in $\\mathrm{Hz}$, $p = 4$, $\\alpha = 0.7$, $h_0 = 5$ in $\\mathrm{m}$.\n- Case D (homogeneous fourth-order reference): $c = [2200, 2200, 2200]$ in $\\mathrm{m/s}$, $L = [300, 300, 300]$ in $\\mathrm{m}$, $f = 10$ in $\\mathrm{Hz}$, $p = 4$, $\\alpha = 0.3$, $h_0 = 10$ in $\\mathrm{m}$.\n\nYour program must produce a single line of output containing the four integer results as a comma-separated list enclosed in square brackets, in the order of the cases A, B, C, D, for example, $[\\hat{m}_A,\\hat{m}_B,\\hat{m}_C,\\hat{m}_D]$.", "solution": "The solution requires implementing a procedure to estimate the observed order of convergence for a numerical error model. This model combines two types of errors in finite-difference simulations of wave propagation: a volume-based dispersion error, $E_{\\mathrm{disp}}(h)$, and a localized interface error, $E_{\\mathrm{int}}(h)$. The total phase error is their sum, $E(h) = E_{\\mathrm{disp}}(h) + E_{\\mathrm{int}}(h)$. The dominant observed order, $\\hat{m}$, is estimated from the behavior of $E(h)$ as the grid spacing $h$ is refined.\n\nThe overall algorithm proceeds as follows: for each test case, we will first compute the total error $E(h)$ at three grid spacings: $h_0$, $h_0/2$, and $h_0/4$. Then, we will use these three error values to compute three estimates of the convergence order and select the median as a robust estimate, which is then rounded to the nearest integer.\n\nFirst, we define a function that calculates the total error $E(h)$ for a given grid spacing $h$. This function requires several intermediate quantities.\n\n1.  **Exact Phase Accumulation, $\\Phi$**: This serves as the reference solution. For a medium with $N$ layers, each with thickness $L_i$ and wave speed $c_i$, the exact wavenumber in layer $i$ for a signal of frequency $f$ is $k_i = 2\\pi f / c_i$. The total phase accumulation across all layers is the sum of phase shifts in each layer:\n    $$\n    \\Phi = \\sum_{i=1}^N k_i L_i\n    $$\n\n2.  **Numerical Phase Accumulation, $\\Phi_h$**: This is the phase accumulated in the numerical simulation. It depends on the numerical wavenumber $k_{h,i}$, which is an approximation of $k_i$ that is affected by the discretization. For each layer $i$, we must compute $k_{h,i}$ based on the nominal order $p$ of the finite-difference stencil.\n    -   For a second-order stencil ($p=2$), the discrete dispersion relation is $\\cos(\\xi_i) = 1 - \\frac{(k_i h)^2}{2}$. The phase angle $\\xi_i$ is found by taking the inverse cosine of the right-hand side. To prevent domain errors from floating-point inaccuracies, the argument is clamped to the interval $[-1, 1]$.\n        $$\n        \\xi_i = \\arccos\\left(\\mathrm{clip}\\left(1 - \\frac{(k_i h)^2}{2}, -1, 1\\right)\\right)\n        $$\n        The numerical wavenumber is then $k_{h,i} = \\xi_i / h$.\n\n    -   For a fourth-order stencil ($p=4$), the relation is a quadratic equation for $\\chi_i = \\cos(\\xi_i)$: $4 \\chi_i^2 - 32 \\chi_i + 28 - 12 (k_i h)^2 = 0$. Applying the quadratic formula for $A\\chi^2+B\\chi+C=0$ with $A=4$, $B=-32$, and $C=28 - 12(k_i h)^2$, we obtain two roots for $\\chi_i$: $\\chi_i = 4 \\pm \\sqrt{9 + 3(k_i h)^2}$. The physically relevant root is the one that approaches $1$ as $k_i h \\to 0$, which corresponds to taking the minus sign.\n        $$\n        \\chi_i = 4 - \\sqrt{9 + 3(k_i h)^2}\n        $$\n        The phase angle $\\xi_i$ is then found via $\\xi_i = \\arccos(\\mathrm{clip}(\\chi_i, -1, 1))$, and the numerical wavenumber is $k_{h,i} = \\xi_i / h$.\n\n    The total numerical phase accumulation is then the sum over all layers:\n    $$\n    \\Phi_h = \\sum_{i=1}^N k_{h,i} L_i\n    $$\n\n3.  **Error Components and Total Error $E(h)$**:\n    -   The dispersion error is the absolute difference between the numerical and exact phase accumulations:\n        $$\n        E_{\\mathrm{disp}}(h) = \\left|\\Phi_h - \\Phi\\right|\n        $$\n        The nominal order of this error is $O(h^p)$.\n    -   The interface error models pre-asymptotic effects at material discontinuities:\n        $$\n        E_{\\mathrm{int}}(h) = \\alpha\\, h^{p-1}\\, \\sum_{i=1}^{N-1} \\left|k_{i+1} - k_i\\right|\n        $$\n        This error is of order $O(h^{p-1})$, one order lower than the dispersion error. In homogeneous media, where all $k_i$ are equal, this term is zero.\n    -   The total error is the sum of these two components:\n        $$\n        E(h) = E_{\\mathrm{disp}}(h) + E_{\\mathrm{int}}(h)\n        $$\n\nNext, we implement the order estimation procedure. For a base grid spacing $h_0$, we compute $E(h_0)$, $E(h_0/2)$, and $E(h_0/4)$.\nIf the error behaves as $E(h) \\approx C h^m$, then the ratio of errors for successive refinements is $E(h)/E(h/2) \\approx (Ch^m)/(C(h/2)^m) = 2^m$. Thus, the order $m$ can be estimated by $m \\approx \\log_2(E(h)/E(h/2))$.\n\nThe problem specifies a three-part robust estimation:\n1.  Compute the order estimate from the two coarsest grids: $q_1 = \\log_2\\big(E(h_0)/E(h_0/2)\\big)$.\n2.  Compute the order estimate from the two finest grids: $q_2 = \\log_2\\big(E(h_0/2)/E(h_0/4)\\big)$.\n3.  Perform a linear least-squares fit to the model $\\log E(h) = m \\log h + b$ using the three data points $\\{(\\log(h_0), \\log(E(h_0)))$, $(\\log(h_0/2), \\log(E(h_0/2)))$, $(\\log(h_0/4), \\log(E(h_0/4)))\\}$. The slope of this fit gives a third estimate, $q_{\\mathrm{lsq}}$.\n\nThe final observed order, $\\hat{m}$, is the median of these three estimates, rounded to the nearest integer:\n$$\n\\hat{m} = \\mathrm{round}(\\mathrm{median}\\{q_1, q_2, q_{\\mathrm{lsq}}\\})\n$$\nThis procedure is applied to each of the four test cases specified in the problem statement to obtain the integer results.\n```python\nimport numpy as np\n\ndef calculate_order(c, L, f, p, alpha, h0):\n    \"\"\"\n    Calculates the observed order of convergence for the total phase error.\n\n    Args:\n        c (list): Wave speeds in m/s for each layer.\n        L (list): Thicknesses in m for each layer.\n        f (float): Frequency in Hz.\n        p (int): Nominal order of accuracy (2 or 4).\n        alpha (float): Dimensionless misalignment factor.\n        h0 (float): Base grid spacing in m.\n\n    Returns:\n        int: The estimated dominant order, rounded to the nearest integer.\n    \"\"\"\n    c = np.array(c, dtype=float)\n    L = np.array(L, dtype=float)\n\n    # 1. Define grid spacings for step-doubling\n    h_vals = np.array([h0, h0 / 2.0, h0 / 4.0])\n\n    # 2. Calculate the exact phase accumulation (reference solution)\n    k_exact = 2.0 * np.pi * f / c\n    phi_exact = np.sum(k_exact * L)\n\n    # 3. Calculate interface term component that is independent of h\n    if len(c) > 1:\n        interface_k_diff_sum = np.sum(np.abs(np.diff(k_exact)))\n    else:\n        interface_k_diff_sum = 0.0\n\n    E_vals = []\n    for h in h_vals:\n        # Calculate numerical wavenumber k_h for each layer\n        if p == 2:\n            arg = 1.0 - (k_exact * h)**2 / 2.0\n            arg = np.clip(arg, -1.0, 1.0)\n            xi = np.arccos(arg)\n            k_h = xi / h\n        elif p == 4:\n            kh_sq = (k_exact * h)**2\n            # Solve 4*chi^2 - 32*chi + (28 - 12*(k*h)^2) = 0\n            # The physically relevant root is chi = 4 - sqrt(9 + 3*(k*h)^2)\n            arg_sqrt = 9.0 + 3.0 * kh_sq\n            chi = 4.0 - np.sqrt(arg_sqrt)\n            chi = np.clip(chi, -1.0, 1.0)\n            xi = np.arccos(chi)\n            k_h = xi / h\n        else:\n            raise ValueError(\"Nominal order p must be 2 or 4.\")\n        \n        # Calculate numerical phase accumulation\n        phi_h = np.sum(k_h * L)\n\n        # Calculate dispersion and interface errors\n        E_disp = np.abs(phi_h - phi_exact)\n        E_int = alpha * (h**(p - 1)) * interface_k_diff_sum\n        \n        # Calculate total error\n        E_total = E_disp + E_int\n        E_vals.append(E_total)\n\n    E_vals = np.array(E_vals)\n\n    # 5. Estimate the order of convergence\n    # q1 is order estimate from h0, h0/2\n    q1 = np.log2(E_vals[0] / E_vals[1])\n    # q2 is order estimate from h0/2, h0/4\n    q2 = np.log2(E_vals[1] / E_vals[2])\n\n    # q_lsq is order from least-squares fit on log-log plot\n    log_h = np.log(h_vals)\n    log_E = np.log(E_vals)\n    # Fit log(E) = m*log(h) + b; polyfit returns [m, b]\n    p_fit = np.polyfit(log_h, log_E, 1)\n    q_lsq = p_fit[0]\n\n    # Robust observed order is the median of the three estimates\n    m_hat = np.median([q1, q2, q_lsq])\n    \n    # Round to the nearest integer as required\n    m_hat_rounded = int(np.round(m_hat))\n    \n    return m_hat_rounded\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: (c, L, f, p, alpha, h0)\n        ([1800, 2400, 2200], [400, 600, 500], 8, 2, 0.8, 5),\n        # Case B\n        ([1800, 2400, 2200], [400, 600, 500], 8, 2, 0.05, 20),\n        # Case C\n        ([1500, 2500, 3000, 2000], [300, 400, 500, 300], 12, 4, 0.7, 5),\n        # Case D\n        ([2200, 2200, 2200], [300, 300, 300], 10, 4, 0.3, 10),\n    ]\n\n    results = []\n    for case in test_cases:\n        c, L, f, p, alpha, h0 = case\n        result = calculate_order(c, L, f, p, alpha, h0)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "answer": "[1,2,3,4]", "id": "3612385"}]}