{"hands_on_practices": [{"introduction": "Before exploring the nuances of accuracy and physical realism, we must first address the most fundamental requirement of any explicit finite-difference simulation: numerical stability. An unstable scheme produces solutions that grow exponentially, rendering the simulation useless. This first practice guides you through a von Neumann stability analysis, a cornerstone technique for determining the conditions under which a numerical scheme remains bounded. By applying this analysis to the standard second-order scheme for the 1D acoustic wave equation, you will derive the celebrated Courant–Friedrichs–Lewy (CFL) condition, which provides an essential upper limit on the time step size.", "problem": "Consider the one-dimensional acoustic wave equation for a scalar field $u(x,t)$ under constant density and constant wavespeed $c$, given by $u_{tt}(x,t) = c^{2} u_{xx}(x,t)$. Let the spatial domain be discretized on a uniform grid $x_{i} = i\\,\\Delta x$ and time be discretized as $t^{n} = n\\,\\Delta t$, where $i$ and $n$ are integers, and $\\Delta x$ and $\\Delta t$ are positive constants. Using second-order centered finite differences in both time and space to construct an explicit update scheme at each interior grid point, perform a von Neumann (Fourier) stability analysis under periodic boundary conditions to determine the condition under which all Fourier modes remain bounded in time. Define the Courant number $\\lambda = \\dfrac{c\\,\\Delta t}{\\Delta x}$ and derive the Courant–Friedrichs–Lewy (CFL) condition of the form $c\\,\\Delta t / \\Delta x \\le \\lambda_{\\max}$. Compute the exact value of $\\lambda_{\\max}$. Express your final answer as a single real number. No rounding is required and no units should be included in the final answer.", "solution": "The problem statement is valid. It is a standard, well-posed problem in computational physics that is scientifically grounded, objective, and contains all necessary information for a unique solution.\n\nThe one-dimensional acoustic wave equation is given by:\n$$\n\\frac{\\partial^2 u}{\\partial t^2} = c^2 \\frac{\\partial^2 u}{\\partial x^2}\n$$\nwhere $u(x,t)$ is the scalar field, and $c$ is the constant wavespeed.\n\nWe discretize the domain with a uniform grid, such that $x_i = i\\,\\Delta x$ and $t^n = n\\,\\Delta t$. The numerical approximation of $u(x_i, t^n)$ is denoted by $u_i^n$. We use second-order centered finite differences to approximate the partial derivatives.\n\nThe second partial derivative with respect to time, $u_{tt}$, at $(x_i, t^n)$ is approximated as:\n$$\n\\frac{\\partial^2 u}{\\partial t^2}\\bigg|_{i,n} \\approx \\frac{u_i^{n+1} - 2u_i^n + u_i^{n-1}}{(\\Delta t)^2}\n$$\nThe second partial derivative with respect to space, $u_{xx}$, at $(x_i, t^n)$ is approximated as:\n$$\n\\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{i,n} \\approx \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{(\\Delta x)^2}\n$$\nSubstituting these approximations into the wave equation gives the finite difference equation:\n$$\n\\frac{u_i^{n+1} - 2u_i^n + u_i^{n-1}}{(\\Delta t)^2} = c^2 \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{(\\Delta x)^2}\n$$\nTo create an explicit update scheme, we solve for $u_i^{n+1}$:\n$$\nu_i^{n+1} = 2u_i^n - u_i^{n-1} + \\frac{c^2 (\\Delta t)^2}{(\\Delta x)^2} (u_{i+1}^n - 2u_i^n + u_{i-1}^n)\n$$\nWe introduce the Courant number, $\\lambda = \\frac{c\\,\\Delta t}{\\Delta x}$. The equation becomes:\n$$\nu_i^{n+1} = 2u_i^n - u_i^{n-1} + \\lambda^2 (u_{i+1}^n - 2u_i^n + u_{i-1}^n)\n$$\nFor the von Neumann stability analysis, we consider a single Fourier mode solution of the form:\n$$\nu_i^n = \\xi^n e^{j k x_i} = \\xi^n e^{j k i \\Delta x}\n$$\nwhere $k$ is the wavenumber, $j = \\sqrt{-1}$, and $\\xi = \\xi(k)$ is the amplification factor. For the scheme to be stable, the magnitude of the amplification factor must satisfy $|\\xi| \\le 1$ for all possible wavenumbers $k$.\n\nSubstituting the Fourier mode into the finite difference scheme:\n$$\n\\xi^{n+1} e^{j k i \\Delta x} = 2\\xi^n e^{j k i \\Delta x} - \\xi^{n-1} e^{j k i \\Delta x} + \\lambda^2 \\left( \\xi^n e^{j k (i+1) \\Delta x} - 2\\xi^n e^{j k i \\Delta x} + \\xi^n e^{j k (i-1) \\Delta x} \\right)\n$$\nDividing the entire equation by the common factor $\\xi^{n-1} e^{j k i \\Delta x}$ yields:\n$$\n\\xi^2 = 2\\xi - 1 + \\lambda^2 \\left( \\xi e^{j k \\Delta x} - 2\\xi + \\xi e^{-j k \\Delta x} \\right)\n$$\nWe can factor out $\\xi$ on the right-hand side and use Euler's formula, $e^{j\\theta} + e^{-j\\theta} = 2\\cos(\\theta)$, with $\\theta = k\\Delta x$:\n$$\n\\xi^2 = 2\\xi - 1 + \\lambda^2 \\xi (e^{j k \\Delta x} + e^{-j k \\Delta x} - 2)\n$$\n$$\n\\xi^2 = 2\\xi - 1 + \\lambda^2 \\xi (2\\cos(k\\Delta x) - 2)\n$$\n$$\n\\xi^2 = 2\\xi - 1 - 2\\lambda^2 \\xi (1 - \\cos(k\\Delta x))\n$$\nUsing the half-angle identity $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$:\n$$\n\\xi^2 = 2\\xi - 1 - 4\\lambda^2 \\xi \\sin^2\\left(\\frac{k\\Delta x}{2}\\right)\n$$\nRearranging this into a standard quadratic equation for $\\xi$:\n$$\n\\xi^2 - \\left( 2 - 4\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\right)\\xi + 1 = 0\n$$\nThis is a quadratic equation of the form $a\\xi^2 + b\\xi + c = 0$, where $a=1$, $b = -2P$, and $c=1$, with $P = 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right)$. The roots are given by the quadratic formula:\n$$\n\\xi = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a} = P \\pm \\sqrt{P^2 - 1}\n$$\nFor the solution to remain bounded, we require $|\\xi| \\le 1$.\nLet's analyze the roots based on the value of $P$:\n1. If $P^2 > 1$ (i.e., $|P| > 1$), the term $\\sqrt{P^2-1}$ is real and positive. One of the roots will have a magnitude greater than $1$. For example, if $P > 1$, then $\\xi_+ = P + \\sqrt{P^2-1} > 1$. If $P  -1$, then $\\xi_- = P - \\sqrt{P^2-1}  -1$, so $|\\xi_-| > 1$. In both cases, the scheme is unstable.\n2. If $P^2 \\le 1$ (i.e., $|P| \\le 1$), the term $P^2-1$ is non-positive. The roots are $\\xi = P \\pm j\\sqrt{1-P^2}$. The magnitude of these complex roots is:\n$$\n|\\xi| = \\sqrt{P^2 + \\left(\\sqrt{1-P^2}\\right)^2} = \\sqrt{P^2 + 1 - P^2} = \\sqrt{1} = 1\n$$\nIn this case, the amplitude of the Fourier modes is conserved, and the scheme is stable. The boundary case $P^2=1$ gives a single real root $\\xi=P$ with $|\\xi|=1$, which is also stable.\n\nThus, the condition for stability for all wavenumbers $k$ is $|P| \\le 1$:\n$$\n\\left| 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\right| \\le 1\n$$\nThis inequality can be written as:\n$$\n-1 \\le 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 1\n$$\nLet's analyze the two parts of the inequality. The right-hand side is:\n$$\n1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 1 \\implies -2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 0\n$$\nSince $\\lambda^2 \\ge 0$ and $\\sin^2(\\cdot) \\ge 0$, this part is always satisfied.\nThe left-hand side gives the definitive stability constraint:\n$$\n-1 \\le 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\implies 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 2\n$$\n$$\n\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 1\n$$\nThis condition must hold for all wavenumbers $k$. To ensure this, we must consider the \"worst-case\" scenario, which corresponds to the value of $k$ that maximizes the term $\\sin^2\\left(\\frac{k\\Delta x}{2}\\right)$. The maximum value of $\\sin^2(\\cdot)$ is $1$. This occurs for the highest frequency mode that can be represented on the grid, $k = \\pi / \\Delta x$, which makes the argument of the sine $\\pi/2$.\nEnforcing the condition for this worst case gives:\n$$\n\\lambda^2 \\cdot \\max_{k}\\left[\\sin^2\\left(\\frac{k\\Delta x}{2}\\right)\\right] \\le 1 \\implies \\lambda^2 \\cdot 1 \\le 1\n$$\n$$\n\\lambda^2 \\le 1\n$$\nSince the Courant number $\\lambda = \\frac{c\\Delta t}{\\Delta x}$ is defined with positive constants $\\Delta t$ and $\\Delta x$, and the wavespeed $c$ is also positive, $\\lambda$ is a non-negative quantity. Therefore, the stability condition simplifies to:\n$$\n0 \\le \\lambda \\le 1\n$$\nThe problem asks for the Courant–Friedrichs–Lewy (CFL) condition in the form $\\frac{c\\,\\Delta t}{\\Delta x} \\le \\lambda_{\\max}$. This corresponds to $\\lambda \\le \\lambda_{\\max}$, so we can identify $\\lambda_{\\max}$ as the upper bound of the stable range.\n$$\n\\lambda_{\\max} = 1\n$$", "answer": "$$\\boxed{1}$$", "id": "3592805"}, {"introduction": "Having established the stability limits of a basic scheme ([@problem_id:3592805]), we now transition from one-dimensional theory to two-dimensional implementation. This practice explores the principle of reciprocity, a profound physical symmetry stating that swapping a source and receiver leaves the recorded signal unchanged. You will build a 2D FDTD solver to act as a computational laboratory, empirically investigating how this symmetry is preserved or broken by different numerical choices. This exercise provides a tangible link between the abstract mathematical property of a self-adjoint operator and the physical fidelity of your simulation.", "problem": "Consider the two-dimensional acoustic wave equation for pressure $p(\\mathbf{x},t)$ in a homogeneous medium with constant wave speed $c$,\n$$\n\\partial_{tt} p(\\mathbf{x},t) - c^2 \\nabla^2 p(\\mathbf{x},t) = s(t)\\,\\delta(\\mathbf{x}-\\mathbf{x}_s),\n$$\nwhere $\\mathbf{x} = (x,y)$ denotes position, $t$ denotes time, $c$ denotes wave speed, $\\nabla^2$ denotes the Laplacian operator in space, $s(t)$ denotes a temporally compact source wavelet, and $\\delta(\\cdot)$ denotes the Dirac delta distribution. Under suitable boundary conditions and for linear, time-invariant, self-adjoint spatial operators, the Green's function $G(\\mathbf{x}_s,\\mathbf{x}_r,t)$, defined as the pressure recorded at receiver location $\\mathbf{x}_r$ due to an impulsive source at $\\mathbf{x}_s$, is symmetric with respect to source and receiver exchange,\n$$\nG(\\mathbf{x}_s,\\mathbf{x}_r,t) = G(\\mathbf{x}_r,\\mathbf{x}_s,t).\n$$\nThis property is known as reciprocity. In computational geophysics, finite difference discretization of the acoustic wave equation must preserve operator symmetry to maintain discrete reciprocity. Non-symmetric stencils and damping layers, such as those used in Perfectly Matched Layer (PML) boundary treatments, can violate reciprocity because they render the discrete operator non-self-adjoint.\n\nStarting only from the acoustic wave equation, the definition of reciprocity, and the concept of self-adjointness, derive how discrete reciprocity is expected to hold when using symmetric central differences under reflecting boundaries, and explain how it can be violated when using non-symmetric stencils or spatially varying first-order damping terms that approximate PML behavior. Then, implement a two-dimensional finite difference time-domain solver for the acoustic wave equation to empirically test discrete reciprocity in three cases:\n- Case A: Symmetric central-difference Laplacian without damping.\n- Case B: Non-symmetric forward-difference Laplacian without damping.\n- Case C: Symmetric central-difference Laplacian with a boundary damping layer (a PML-like sponge) implemented as an additional term $+\\sigma(\\mathbf{x})\\,\\partial_t p$ in the equation.\n\nUse the following scientifically self-consistent parameters and units:\n- Grid size: $N_x = 64$, $N_y = 64$ spatial samples.\n- Spatial sampling: $\\Delta x = 10\\,\\mathrm{m}$, $\\Delta y = 10\\,\\mathrm{m}$.\n- Constant wave speed: $c = 1500\\,\\mathrm{m/s}$.\n- Time step: $\\Delta t = 0.45\\,\\Delta x/(c\\sqrt{2})\\,\\mathrm{s}$.\n- Number of time steps: $N_t = 400$.\n- Source wavelet: Ricker wavelet with peak frequency $f_0 = 5\\,\\mathrm{Hz}$ and peak time $t_0 = 1.5/f_0\\,\\mathrm{s}$,\n$$\ns(t) = \\left(1 - 2\\pi^2 f_0^2 (t-t_0)^2\\right)\\,\\exp\\left(-\\pi^2 f_0^2 (t-t_0)^2\\right).\n$$\n- Boundary condition for non-damped cases: homogeneous Dirichlet boundaries implemented by setting $p=0$ at the domain edges after each update.\n- Boundary damping for Case C: sponge profile of thickness $N_{\\mathrm{pml}} = 12$ grid points with\n$$\n\\sigma(\\mathbf{x}) = \\begin{cases}\n\\sigma_{\\max}\\left(1 - \\frac{d(\\mathbf{x})}{N_{\\mathrm{pml}}}\\right)^2  \\text{if } d(\\mathbf{x})  N_{\\mathrm{pml}}, \\\\\n0  \\text{otherwise},\n\\end{cases}\n$$\nwhere $d(\\mathbf{x})$ is the minimum distance in grid points from $\\mathbf{x}$ to any domain boundary, and $\\sigma_{\\max} = 50\\,\\mathrm{s}^{-1}$.\n- Source and receiver index pairs given in grid indices $(i,j)$ with $i\\in\\{0,\\dots,N_x-1\\}$, $j\\in\\{0,\\dots,N_y-1\\}$:\n    - Case A: $\\mathbf{x}_s = (32,20)$, $\\mathbf{x}_r = (42,44)$.\n    - Case B: $\\mathbf{x}_s = (32,20)$, $\\mathbf{x}_r = (42,44)$.\n    - Case C: $\\mathbf{x}_s = (14,14)$, $\\mathbf{x}_r = (50,40)$.\n\nImplement the discrete time stepping using the second-order leapfrog method for time and the specified spatial stencil for each case. For Case C, discretize the damping term $+\\sigma(\\mathbf{x})\\,\\partial_t p$ using a first-order backward difference in time at each grid point to obtain a fully explicit update.\n\nFor each case, compute the two receiver time series $g_A[n]$ and $g_B[n]$ with $n\\in\\{0,\\dots,N_t-1\\}$, corresponding to the pressure recorded at $\\mathbf{x}_r$ when sourcing at $\\mathbf{x}_s$, and the pressure recorded at $\\mathbf{x}_s$ when sourcing at $\\mathbf{x}_r$, respectively. Quantify reciprocity through the normalized residual\n$$\n\\rho = \\frac{\\left\\|\\mathbf{g}_A - \\mathbf{g}_B\\right\\|_2}{\\max\\left(\\left\\|\\mathbf{g}_A\\right\\|_2,\\,\\left\\|\\mathbf{g}_B\\right\\|_2\\right)},\n$$\nwhich is dimensionless. Report one $\\rho$ value per case.\n\nYour program should produce a single line of output containing the three residuals as a comma-separated list enclosed in square brackets, with no spaces, in dimensionless units. For example, the format must be exactly like $[\\rho_A,\\rho_B,\\rho_C]$. The output type must be a list of three floats. The test suite is the three cases specified above, which together test the happy path (Case A, symmetric stencil and no damping), a significant edge case (Case B, non-symmetric stencil violating self-adjointness), and boundary damping effects (Case C, PML-like $\\sigma(\\mathbf{x})$ layer breaking reciprocity via non-self-adjointness). No user input is allowed; all parameters are fixed as provided.", "solution": "The problem requires a theoretical derivation concerning discrete reciprocity in finite-difference schemes for the acoustic wave equation, followed by a numerical implementation to verify the derived principles.\n\nThe two-dimensional acoustic wave equation for pressure $p(\\mathbf{x},t)$ in a homogeneous medium is given by:\n$$\n\\partial_{tt} p(\\mathbf{x},t) - c^2 \\nabla^2 p(\\mathbf{x},t) = s(t)\\,\\delta(\\mathbf{x}-\\mathbf{x}_s)\n$$\nHere, $\\partial_{tt}$ is the second partial derivative with respect to time $t$, $c$ is the constant wave speed, $\\nabla^2$ is the spatial Laplacian operator, $s(t)$ is the source time function, and $\\delta(\\mathbf{x}-\\mathbf{x}_s)$ represents a point source at location $\\mathbf{x}_s$.\n\nReciprocity is the principle that the recorded wavefield at a receiver location $\\mathbf{x}_r$ due to a source at $\\mathbf{x}_s$ is identical to the wavefield recorded at $\\mathbf{x}_s$ due to a source at $\\mathbf{x}_r$. In the context of the Green's function $G(\\mathbf{x}_s, \\mathbf{x}_r, t)$, this is expressed as:\n$$\nG(\\mathbf{x}_s,\\mathbf{x}_r,t) = G(\\mathbf{x}_r,\\mathbf{x}_s,t)\n$$\nThis property arises from the self-adjointness of the spatial operator (here, $-c^2\\nabla^2$) and the time-reversal symmetry of the wave equation. When we discretize the equation, these properties must be preserved in the discrete operators to maintain discrete reciprocity.\n\nLet the pressure field be discretized on a grid as $p_{i,j}^n \\approx p(i\\Delta x, j\\Delta y, n\\Delta t)$. A general explicit finite-difference scheme can be written in matrix-vector form. Let $\\mathbf{p}^n$ be a vector containing the pressure values at all grid points at time step $n$. The standard second-order leapfrog discretization in time is:\n$$\n\\frac{\\mathbf{p}^{n+1} - 2\\mathbf{p}^n + \\mathbf{p}^{n-1}}{\\Delta t^2} - c^2 \\mathbf{L} \\mathbf{p}^n = \\mathbf{s}^n\n$$\nwhere $\\mathbf{L}$ is the matrix representing the discrete Laplacian operator and $\\mathbf{s}^n$ is the discrete source vector. Rearranging for the time-stepping update gives:\n$$\n\\mathbf{p}^{n+1} = 2\\mathbf{p}^n - \\mathbf{p}^{n-1} + c^2 \\Delta t^2 \\mathbf{L} \\mathbf{p}^n + \\Delta t^2 \\mathbf{s}^n\n$$\nDiscrete reciprocity holds if and only if the discrete spatial operator, represented by the matrix $\\mathbf{L}$, is symmetric, i.e., $\\mathbf{L} = \\mathbf{L}^T$. This is the discrete analogue of the self-adjoint property.\n\nLet's analyze the three cases presented in the problem.\n\nCase A: Symmetric Central-Difference Laplacian\nThe second-order central-difference approximation for the Laplacian at grid point $(i,j)$ is:\n$$\n(\\nabla^2 p)_{i,j} \\approx \\frac{p_{i+1,j} - 2p_{i,j} + p_{i-1,j}}{\\Delta x^2} + \\frac{p_{i,j+1} - 2p_{i,j} + p_{i,j-1}}{\\Delta y^2}\n$$\nWhen assembling the matrix $\\mathbf{L}$ from this stencil, the entry $L_{uv}$ representing the contribution of grid point $v$ to the Laplacian at grid point $u$ is non-zero only if $u$ and $v$ are neighbors. Due to the stencil's symmetry, the contribution of point $j$ to the equation for point $i$ is identical to the contribution of point $i$ to the equation for point $j$. For instance, for two horizontally adjacent points $u=(i,j)$ and $v=(i+1,j)$, the coefficient in the row for $u$ corresponding to the column for $v$ is $1/\\Delta x^2$, and the coefficient in the row for $v$ corresponding to the column for $u$ is also $1/\\Delta x^2$. This ensures that the matrix $\\mathbf{L}$ is symmetric. The homogeneous Dirichlet boundary conditions, implemented by forcing pressure to zero at the boundaries, also respect this symmetry. Therefore, the discrete operator is self-adjoint, and we expect discrete reciprocity to hold to within machine precision. The reciprocity residual $\\rho$ should be close to zero.\n\nCase B: Non-Symmetric Forward-Difference Laplacian\nA non-symmetric approximation for the Laplacian can be constructed by applying a forward difference operator twice. The forward-difference approximation for the second derivative in $x$ is:\n$$\n(\\partial_{xx} p)_{i,j} \\approx \\frac{p_{i+2,j} - 2p_{i+1,j} + p_{i,j}}{\\Delta x^2}\n$$\nThe resulting discrete Laplacian operator $\\mathbf{L}$ is no longer symmetric. The equation for $p_{i,j}$ depends on values at $p_{i,j}$, $p_{i+1,j}$, and $p_{i+2,j}$. In the matrix $\\mathbf{L}$, the row corresponding to point $(i,j)$ will have non-zero entries for columns corresponding to points $(i,j)$, $(i+1,j)$, and $(i+2,j)$. However, the row for point $(i+1,j)$ will not contain a corresponding contribution from point $(i,j)$ in the same manner. The resulting matrix is non-symmetric ($\\mathbf{L} \\neq \\mathbf{L}^T$), typically being a banded matrix with non-zero entries on diagonals other than those symmetric about the main diagonal. This breaks the self-adjointness of the discrete operator, and thus, discrete reciprocity is expected to be violated. The residual $\\rho$ should be significantly greater than zero.\n\nCase C: Symmetric Laplacian with Damping\nThe wave equation is modified with a first-order damping term:\n$$\n\\partial_{tt} p + \\sigma(\\mathbf{x})\\,\\partial_t p - c^2 \\nabla^2 p = s(t)\\,\\delta(\\mathbf{x}-\\mathbf{x}_s)\n$$\nThis term is intended to absorb outgoing waves at the boundary, mimicking a Perfectly Matched Layer (PML). We use a symmetric stencil for $\\nabla^2 p$, but the new term $\\sigma(\\mathbf{x})\\,\\partial_t p$ breaks the overall operator symmetry. Discretizing this term with a first-order backward difference, $\\partial_t p \\approx (p^n - p^{n-1})/\\Delta t$, maintains an explicit update scheme. The full discrete equation for point $(i,j)$ is:\n$$\n\\frac{p_{i,j}^{n+1} - 2p_{i,j}^n + p_{i,j}^{n-1}}{\\Delta t^2} + \\sigma_{i,j} \\frac{p_{i,j}^n - p_{i,j}^{n-1}}{\\Delta t} - c^2 (\\nabla^2 p^n)_{i,j} = s_{i,j}^n\n$$\nSolving for $p_{i,j}^{n+1}$:\n$$\np_{i,j}^{n+1} = (2 - \\sigma_{i,j}\\Delta t) p_{i,j}^n - (1 - \\sigma_{i,j}\\Delta t) p_{i,j}^{n-1} + c^2 \\Delta t^2 (\\nabla^2 p^n)_{i,j} + \\Delta t^2 s_{i,j}^n\n$$\nThe damping term introduces dissipation, which breaks the time-reversal symmetry of the system. A system with dissipation is non-conservative. This loss of time-reversal symmetry is fundamentally linked to the loss of self-adjointness. The operator governing the evolution is no longer self-adjoint, even if the spatial Laplacian part $\\mathbf{L}$ is symmetric. Consequently, reciprocity is violated. The violation will be most pronounced for wave paths that interact with the damping layer where $\\sigma(\\mathbf{x}) > 0$. We expect the residual $\\rho$ to be substantially non-zero.\n\nThe numerical implementation below will compute the reciprocity residual $\\rho$ for these three cases to confirm these theoretical expectations.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 2D acoustic wave equation using finite differences to test\n    the principle of discrete reciprocity under three different conditions.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    Nx = 64  # Grid points in x\n    Ny = 64  # Grid points in y\n    dx = 10.0  # Spatial step in x (m)\n    dy = 10.0  # Spatial step in y (m)\n    c = 1500.0  # Wave speed (m/s)\n    Nt = 400  # Number of time steps\n    f0 = 5.0  # Peak frequency of Ricker wavelet (Hz)\n    Npml = 12 # Thickness of sponge layer (grid points)\n    sigma_max = 50.0 # Maximum damping coefficient (s^-1)\n\n    # Stability condition (CFL)\n    # dt = dx / (c * sqrt(2)) for dx=dy\n    # A factor of 0.45 is used, well within the stable limit of 1.\n    dt = 0.45 * dx / (c * np.sqrt(2))\n\n    t0 = 1.5 / f0  # Peak time of Ricker wavelet\n\n    # --- Test Case Definitions ---\n    test_cases = [\n        # Case A: Symmetric stencil, no damping\n        ('A', (32, 20), (42, 44)),\n        # Case B: Non-symmetric stencil, no damping\n        ('B', (32, 20), (42, 44)),\n        # Case C: Symmetric stencil, damping\n        ('C', (14, 14), (50, 40)),\n    ]\n\n    # --- Helper Functions ---\n    def ricker_wavelet(t, f0, t0):\n        \"\"\"Generates a Ricker wavelet.\"\"\"\n        arg = (np.pi * f0 * (t - t0))**2\n        return (1.0 - 2.0 * arg) * np.exp(-arg)\n\n    # Pre-calculate source time series\n    time_vec = np.arange(Nt) * dt\n    source_ts = ricker_wavelet(time_vec, f0, t0)\n    \n    # Pre-calculate damping profile for Case C\n    sigma = np.zeros((Nx, Ny), dtype=np.float64)\n    xx, yy = np.meshgrid(np.arange(Nx), np.arange(Ny), indexing='ij')\n    dist_to_left = xx\n    dist_to_right = Nx - 1 - xx\n    dist_to_top = yy\n    dist_to_bottom = Ny - 1 - yy\n    d = np.minimum.reduce([dist_to_left, dist_to_right, dist_to_top, dist_to_bottom])\n    pml_zone = d  Npml\n    sigma[pml_zone] = sigma_max * (1 - d[pml_zone] / Npml)**2\n\n    def run_simulation(src_pos, rec_pos, case_type):\n        \"\"\"\n        Runs a single FDTD simulation for a given setup.\n        \"\"\"\n        p_prev = np.zeros((Nx, Ny), dtype=np.float64)\n        p_now = np.zeros((Nx, Ny), dtype=np.float64)\n        p_next = np.zeros((Nx, Ny), dtype=np.float64)\n        \n        seismogram = np.zeros(Nt, dtype=np.float64)\n        \n        src_ix, src_iy = src_pos\n        rec_ix, rec_iy = rec_pos\n\n        # Source scaling to approximate Dirac delta\n        source_amp_scaled = source_ts / (dx * dy)\n\n        # Time-stepping loop\n        for n in range(Nt):\n            # Record pressure at receiver\n            seismogram[n] = p_now[rec_ix, rec_iy]\n            \n            # --- Calculate Laplacian ---\n            lap_p = np.zeros_like(p_now)\n            if case_type == 'A' or case_type == 'C':\n                # 5-point symmetric central-difference stencil\n                p_ip1 = p_now[2:, 1:-1]\n                p_im1 = p_now[0:-2, 1:-1]\n                p_jp1 = p_now[1:-1, 2:]\n                p_jm1 = p_now[1:-1, 0:-2]\n                p_cen = p_now[1:-1, 1:-1]\n                lap_p[1:-1, 1:-1] = (p_ip1 + p_im1 + p_jp1 + p_jm1 - 4 * p_cen) / dx**2\n            \n            elif case_type == 'B':\n                # Non-symmetric forward-difference second derivative\n                lap_p_x = np.zeros_like(p_now)\n                lap_p_y = np.zeros_like(p_now)\n                \n                # The ranges must match: p_x needs to be computed up to Nx-3, from i=0\n                # Using slices: p_now[2:Nx,:] - 2*p_now[1:Nx-1,:] + p_now[0:Nx-2,:]\n                # and assigning to lap_p_x[0:Nx-2, :] is correct\n                lap_p_x[0:Nx-2, :] = (p_now[2:Nx, :] - 2 * p_now[1:Nx-1, :] + p_now[0:Nx-2, :]) / dx**2\n                lap_p_y[:, 0:Ny-2] = (p_now[:, 2:Ny] - 2 * p_now[:, 1:Ny-1] + p_now[:, 0:Ny-2]) / dy**2\n                lap_p = lap_p_x + lap_p_y\n\n            # --- Time update ---\n            c_eff = c * dt\n            if case_type == 'C':\n                # Update with damping\n                p_next = (2.0 - sigma * dt) * p_now - (1.0 - sigma * dt) * p_prev + c_eff**2 * lap_p\n            else:\n                # Standard leapfrog update\n                p_next = 2.0 * p_now - p_prev + c_eff**2 * lap_p\n            \n            # --- Add source ---\n            p_next[src_ix, src_iy] += source_amp_scaled[n] * dt**2\n            \n            # --- Apply boundary conditions ---\n            if case_type == 'A' or case_type == 'B':\n                # Homogeneous Dirichlet BC\n                p_next[0, :] = 0.0\n                p_next[-1, :] = 0.0\n                p_next[:, 0] = 0.0\n                p_next[:, -1] = 0.0\n            \n            # --- Update pressure fields ---\n            p_prev, p_now = p_now, p_next\n            \n        return seismogram\n\n    results = []\n    for case, src_pos, rec_pos in test_cases:\n        # Run simulation for (source, receiver)\n        g_A = run_simulation(src_pos, rec_pos, case)\n        \n        # Run simulation for (receiver, source)\n        g_B = run_simulation(rec_pos, src_pos, case)\n        \n        # Calculate normalized residual\n        norm_g_A = np.linalg.norm(g_A)\n        norm_g_B = np.linalg.norm(g_B)\n        norm_diff = np.linalg.norm(g_A - g_B)\n        \n        if max(norm_g_A, norm_g_B) == 0:\n            rho = 0.0\n        else:\n            rho = norm_diff / max(norm_g_A, norm_g_B)\n        \n        results.append(rho)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```", "id": "3592795"}, {"introduction": "While the second-order schemes discussed previously ([@problem_id:3592805], [@problem_id:3592795]) are stable and convergent, achieving high accuracy can require very fine grids. To overcome this, we often turn to high-order methods, but this introduces a new layer of design choices regarding the interplay between spatial and temporal discretization. This advanced practice challenges you to analyze and compare the performance of different time-stepping schemes when paired with a fixed high-order spatial stencil. By deriving and evaluating the numerical group velocity—the speed at which wave energy propagates—you will learn to make informed trade-offs to minimize dispersion errors and select the optimal scheme for a given modeling task.", "problem": "Consider the one-dimensional constant-coefficient acoustic wave equation $u_{tt} = c^2 u_{xx}$ on an infinite, uniform grid of spacing $\\Delta x$ with constant wave speed $c$. Adopt a fixed fourth-order accurate five-point central difference stencil for the spatial second derivative,\n$$\n\\partial_{xx} u(x_j) \\approx \\frac{-u_{j+2} + 16 u_{j+1} - 30 u_j + 16 u_{j-1} - u_{j-2}}{12\\,\\Delta x^2},\n$$\nand compare three explicit time integration strategies under this fixed spatial discretization:\n- Leapfrog (second-order centered in time),\n- Lax-Wendroff obtained by a Taylor expansion in time truncated after terms of order $\\Delta t^4$ with substitution of time derivatives using the governing equation to express them in space operators of the fixed stencil,\n- Classical fourth-order Runge-Kutta (Runge-Kutta (RK4)) applied to the first-order system $u_t = v$, $v_t = c^2 u_{xx}$ using the same spatial operator.\n\nStarting only from the partial differential equation, the chosen spatial stencil, and the plane-wave ansatz $u_j^n = \\exp\\{i(j\\,\\theta - n\\,\\Omega)\\}$ with $\\theta = k\\,\\Delta x$ and $\\Omega = \\tilde{\\omega}\\,\\Delta t$ where all angles are in radians, derive for each time integrator the combined space-time numerical dispersion relation connecting the dimensionless temporal frequency $\\Omega$ and the dimensionless wavenumber $\\theta$. Then, for each integrator, differentiate this relation to obtain the numerical group velocity $v_g = d\\tilde{\\omega}/dk$ and express the normalized group velocity $v_g/c$ as a function of $\\theta$ and the Courant-Friedrichs-Lewy (CFL) number $r = c\\,\\Delta t/\\Delta x$.\n\nYour program must implement these derivations to evaluate, for a fixed nondimensional wavenumber $k \\Delta x = \\theta = 0.6$ radians, which time integrator choice minimizes the absolute normalized group-velocity error $|v_g/c - 1|$ for several values of the Courant-Friedrichs-Lewy number $r$. Use the following test suite of CFL numbers:\n- $r = 0.05$ (very small step),\n- $r = 0.40$ (moderate step),\n- $r = 0.70$ (large but stable step),\n- $r = 0.85$ (near the explicit stability limit for the leapfrog scheme with the fourth-order stencil).\n\nScientific and numerical requirements:\n- Treat all angles in radians.\n- The output quantities $v_g/c$ and the errors $|v_g/c - 1|$ are dimensionless.\n- For the Lax-Wendroff time integrator, you must construct it by truncating the time Taylor series at order $\\Delta t^4$ and replacing time derivatives using the spatial operator built from the fixed fourth-order stencil. Do not introduce any alternative spatial stencil.\n- For the Runge-Kutta (RK4) integrator, apply the method to the first-order system in time with the given spatial discretization, and use the resulting one-step amplification factor to extract the numerical phase and group velocity.\n\nFinal output specification:\n- Label the three time integrators as integers: leapfrog $= 0$, Lax-Wendroff $= 1$, Runge-Kutta (RK4) $= 2$.\n- For each $r$ in the test suite, compute the absolute normalized group-velocity error for each integrator at $\\theta = 0.6$, select the integrator with the smallest error, and report a two-element list $[b, e]$ where $b$ is the best integrator label and $e$ is the corresponding minimal absolute error rounded to ten decimal places as a decimal number.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the exact order of the given $r$ values. For example, a valid output format is\n\"[ [b1,e1],[b2,e2],[b3,e3],[b4,e4] ]\"\nbut without any spaces; the required exact format is \"[[b1,e1],[b2,e2],[b3,e3],[b4,e4]]\".", "solution": "The problem requires a comparative analysis of three time integration schemes for the one-dimensional acoustic wave equation, $u_{tt} = c^2 u_{xx}$, discretized in space with a specific fourth-order, five-point stencil. The goal is to determine which integrator—Leapfrog, a fourth-order Lax-Wendroff-type scheme, or classical fourth-order Runge-Kutta (RK4)—minimizes the numerical group velocity error for a fixed dimensionless wavenumber $\\theta = k\\Delta x = 0.6$ and various Courant-Friedrichs-Lewy (CFL) numbers $r = c\\Delta t/\\Delta x$.\n\nFirst, we analyze the spatial discretization. The given five-point central difference stencil approximates the second spatial derivative $\\partial_{xx} u$ at a grid point $x_j$ as:\n$$ \\mathcal{L}_{xx}(u_j) = \\frac{-u_{j+2} + 16 u_{j+1} - 30 u_j + 16 u_{j-1} - u_{j-2}}{12\\,\\Delta x^2} $$\nThe semi-discretized wave equation is $\\frac{d^2 u_j}{dt^2} = c^2 \\mathcal{L}_{xx}(u_j)$. To analyze its behavior, we substitute the plane-wave ansatz $u_j(t) = \\hat{u}(t) \\exp(ij\\theta)$, where $\\theta=k\\Delta x$ is the dimensionless wavenumber. Applying the operator $\\mathcal{L}_{xx}$ to $\\exp(ij\\theta)$ yields:\n$$ \\mathcal{L}_{xx}(\\exp(ij\\theta)) = \\frac{\\exp(ij\\theta)}{12\\Delta x^2} \\left( -e^{i2\\theta} + 16e^{i\\theta} - 30 + 16e^{-i\\theta} - e^{-i2\\theta} \\right) $$\n$$ = \\frac{\\exp(ij\\theta)}{12\\Delta x^2} (-2\\cos(2\\theta) + 32\\cos\\theta - 30) $$\nThis expression can be written as $\\mathcal{L}_{xx} \\rightarrow \\frac{S(\\theta)}{\\Delta x^2}$, where $S(\\theta)$ is the symbol of the spatial operator (scaled by $1/\\Delta x^2$):\n$$ S(\\theta) = \\frac{-2\\cos(2\\theta) + 32\\cos\\theta - 30}{12} = \\frac{-\\cos^2\\theta + 8\\cos\\theta - 7}{3} $$\nFor this stencil to be consistent with $\\partial_{xx} \\rightarrow -k^2$, $S(\\theta)$ must be non-positive, which holds since for $|\\cos\\theta|\\le 1$, the quadratic $-x^2+8x-7$ with roots at $x=1$ and $x=7$ is non-positive. The semi-discretized equation in Fourier space becomes $\\frac{d^2\\hat{u}}{dt^2} = \\frac{c^2 S(\\theta)}{\\Delta x^2} \\hat{u}$. The numerical frequency of this semi-discretized system is $\\omega_{num} = \\sqrt{-c^2 S(\\theta)/\\Delta x^2} = \\frac{c}{\\Delta x}\\sqrt{-S(\\theta)}$.\n\nWe now combine this spatial discretization with each time integrator, using the full plane-wave ansatz $u_j^n = \\exp(i(j\\theta - n\\Omega))$, where $\\Omega = \\tilde{\\omega}\\Delta t$ is the dimensionless temporal frequency. The amplification factor for one time step is $G = \\exp(-i\\Omega)$. The numerical group velocity is $v_g = d\\tilde{\\omega}/dk$, which normalizes to $\\frac{v_g}{c} = \\frac{1}{r}\\frac{d\\Omega}{d\\theta}$.\n\n**1. Leapfrog Integrator (Label $0$)**\nThe second-order leapfrog scheme for $u_{tt} = c^2 u_{xx}$ is:\n$$ \\frac{u_j^{n+1} - 2u_j^n + u_j^{n-1}}{\\Delta t^2} = c^2 \\mathcal{L}_{xx}(u_j^n) $$\nSubstituting the ansatz gives the dispersion relation:\n$$ e^{-i\\Omega} - 2 + e^{i\\Omega} = \\frac{(c\\Delta t)^2}{\\Delta x^2} S(\\theta) \\implies 2\\cos\\Omega - 2 = r^2 S(\\theta) $$\n$$ -4\\sin^2(\\Omega/2) = r^2 S(\\theta) \\implies \\sin(\\Omega/2) = \\frac{r}{2}\\sqrt{-S(\\theta)} $$\nThe dimensionless frequency is $\\Omega_{LF} = 2\\arcsin\\left(\\frac{r}{2}\\sqrt{-S(\\theta)}\\right)$. Differentiating with respect to $\\theta$ gives $\\frac{d\\Omega_{LF}}{d\\theta}$. A more direct way is to differentiate the $\\cos\\Omega$ relation implicitly:\n$$ -2\\sin\\Omega \\frac{d\\Omega}{d\\theta} = r^2 S'(\\theta) \\implies \\frac{d\\Omega}{d\\theta} = -\\frac{r^2 S'(\\theta)}{2\\sin\\Omega} $$\nwhere $S'(\\theta) = \\frac{d}{d\\theta}S(\\theta) = \\frac{2\\sin\\theta}{3}(\\cos\\theta - 4)$ and $\\sin\\Omega = 2\\sin(\\Omega/2)\\cos(\\Omega/2) = 2\\left(\\frac{r}{2}\\sqrt{-S}\\right)\\sqrt{1-\\left(\\frac{r}{2}\\sqrt{-S}\\right)^2} = r\\sqrt{-S(1+r^2S/4)}$.\nThus, the normalized group velocity is:\n$$ \\left(\\frac{v_g}{c}\\right)_{LF} = \\frac{1}{r}\\left( -\\frac{r^2 S'(\\theta)}{2r\\sqrt{-S(\\theta)(1+r^2S(\\theta)/4)}} \\right) = \\frac{-S'(\\theta)}{2\\sqrt{-S(\\theta)(1 + r^2 S(\\theta)/4)}} $$\n\n**2. Lax-Wendroff-type Integrator (Label $1$)**\nThis scheme is constructed from the centered difference formula corrected to fourth-order accuracy in time:\n$$ u^{n+1} - 2u^n + u^{n-1} = \\Delta t^2 u^n_{tt} + \\frac{\\Delta t^4}{12}u^n_{tttt} + O(\\Delta t^6) $$\nUsing $u_{tt} = c^2 u_{xx}$ and $u_{tttt} = c^4 u_{xxxx}$, and approximating the spatial derivatives with the operator $\\mathcal{L}_{xx}$, we obtain:\n$$ \\frac{u_j^{n+1} - 2u_j^n + u_j^{n-1}}{\\Delta t^2} = c^2 \\mathcal{L}_{xx}(u_j^n) + \\frac{c^2\\Delta t^2}{12} c^2 \\mathcal{L}_{xx}(\\mathcal{L}_{xx}(u_j^n)) $$\nSubstituting the ansatz yields the dispersion relation:\n$$ 2\\cos\\Omega - 2 = r^2 S(\\theta) + \\frac{r^4}{12}S(\\theta)^2 $$\nImplicit differentiation gives $-2\\sin\\Omega \\frac{d\\Omega}{d\\theta} = r^2 S'(\\theta) + \\frac{r^4}{6}S(\\theta)S'(\\theta)$.\n$$ \\frac{d\\Omega}{d\\theta} = -\\frac{S'(\\theta)(r^2 + r^4 S(\\theta)/6)}{2\\sin\\Omega} $$\nThe normalized group velocity is:\n$$ \\left(\\frac{v_g}{c}\\right)_{LW} = \\frac{1}{r} \\frac{d\\Omega}{d\\theta} = \\frac{-S'(\\theta)}{\\sin\\Omega} \\left(\\frac{r}{2} + \\frac{r^3 S(\\theta)}{12}\\right) $$\nwhere $\\cos\\Omega = 1 + \\frac{1}{2}r^2 S(\\theta) + \\frac{1}{24}r^4 S(\\theta)^2$ and we take $\\sin\\Omega = \\sqrt{1-\\cos^2\\Omega}$ for stable propagation.\n\n**3. Runge-Kutta (RK4) Integrator (Label $2$)**\nWe apply RK4 to the first-order system $u_t=v$ and $v_t=c^2 u_{xx}$. In Fourier space, this is $\\frac{d}{dt}\\hat{U} = \\mathbf{M}\\hat{U}$, where $\\hat{U}=[\\hat{u}, \\hat{v}]^T$ and $\\mathbf{M} = \\begin{pmatrix} 0  1 \\\\ c^2 S(\\theta)/\\Delta x^2  0 \\end{pmatrix}$. The eigenvalues of $\\mathbf{M}$ are $\\lambda_{\\pm} = \\pm i\\omega_{num} = \\pm i\\frac{c}{\\Delta x}\\sqrt{-S(\\theta)}$.\nThe RK4 amplification factor for an ODE $y'=\\lambda y$ is $g(\\lambda\\Delta t) = 1 + z + z^2/2! + z^3/3! + z^4/4!$, where $z=\\lambda\\Delta t$. Our $z$ is purely imaginary: $z = \\pm i r \\sqrt{-S(\\theta)}$. Let $y=r\\sqrt{-S(\\theta)}$, so $z = \\pm iy$.\nThe amplification factor is $G = e^{-i\\Omega} = g(iy) = (1-y^2/2+y^4/24) + i(y-y^3/6)$.\nThe physical frequency corresponds to the phase of $G$. For a forward-propagating wave, we expect $\\Omega0$, so $e^{-i\\Omega}$ should have a negative imaginary part. However, $y-y^3/6  0$ for stable $y$. We define the physically relevant frequency as the magnitude of the phase, $\\Omega_{RK4} = |\\arg(G^{-1})| = |\\arg(\\bar{G})| = \\arg(g(iy))$. Let $g(iy) = X+iY$.\n$$ \\Omega_{RK4} = \\arctan(Y/X) = \\arctan\\left(\\frac{y - y^3/6}{1 - y^2/2 + y^4/24}\\right) $$\nTo find the group velocity, we differentiate $\\Omega_{RK4}$ with respect to $\\theta$:\n$$ \\frac{d\\Omega_{RK4}}{d\\theta} = \\frac{d}{d\\theta}\\arctan\\left(\\frac{Y(y(\\theta))}{X(y(\\theta))}\\right) = \\frac{X\\frac{dY}{d\\theta} - Y\\frac{dX}{d\\theta}}{X^2+Y^2} = \\frac{X\\frac{dY}{dy} - Y\\frac{dX}{dy}}{X^2+Y^2} \\frac{dy}{d\\theta} $$\nWith $X' = dX/dy = -y+y^3/6$ and $Y' = dY/dy = 1-y^2/2$, the numerator becomes $XY'-YX' = 1 - y^4/24 + y^6/144$. The denominator is $|g(iy)|^2=X^2+Y^2 = 1 - y^6/72 + y^8/576$. Also, $\\frac{dy}{d\\theta} = r\\frac{-S'(\\theta)}{2\\sqrt{-S(\\theta)}} = y \\frac{-S'(\\theta)}{2S(\\theta)}$.\nThe normalized group velocity is:\n$$ \\left(\\frac{v_g}{c}\\right)_{RK4} = \\frac{1}{r} \\frac{d\\Omega_{RK4}}{d\\theta} = \\frac{1}{r} \\left(\\frac{1 - y^4/24 + y^6/144}{1 - y^6/72 + y^8/576} \\right) \\left( y \\frac{-S'(\\theta)}{2S(\\theta)} \\right) $$\n$$ = \\frac{-S'(\\theta)}{2\\sqrt{-S(\\theta)}} \\left(\\frac{1 - y^4/24 + y^6/144}{1 - y^6/72 + y^8/576}\\right) $$\nThese derived expressions are implemented to compute the errors $|v_g/c - 1|$ for the specified parameters.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and compares the numerical group velocity for three time integration\n    schemes applied to the 1D acoustic wave equation with a fixed 4th-order\n    spatial stencil. It identifies the scheme with the minimum group velocity\n    error for a given set of CFL numbers.\n    \"\"\"\n    # Define problem parameters\n    theta = 0.6\n    cfl_numbers = [0.05, 0.40, 0.70, 0.85]\n    \n    # Pre-calculate spatial terms S(theta) and S'(theta) which are independent of r.\n    # The symbol of the spatial operator is S(theta).\n    c_theta = np.cos(theta)\n    s_theta = np.sin(theta)\n    \n    # S(theta) = (-cos(theta)^2 + 8*cos(theta) - 7) / 3\n    S_theta = (-c_theta**2 + 8 * c_theta - 7) / 3.0\n    \n    # S'(theta) is the derivative of S(theta) with respect to theta.\n    # S'(theta) = (2*sin(theta)/3) * (cos(theta) - 4)\n    S_prime_theta = (2.0 * s_theta / 3.0) * (c_theta - 4.0)\n\n    final_results = []\n\n    for r in cfl_numbers:\n        errors = []\n        \n        # --- Integrator 0: Leapfrog ---\n        # The argument of the square root must be non-negative for stability.\n        arg_sqrt_lf = -S_theta * (1.0 + r**2 * S_theta / 4.0)\n        if arg_sqrt_lf  0:\n            err_lf = float('inf')  # Unstable case, error is effectively infinite\n        else:\n            denominator_lf = 2.0 * np.sqrt(arg_sqrt_lf)\n            vg_c_lf = -S_prime_theta / denominator_lf\n            err_lf = np.abs(vg_c_lf - 1.0)\n        errors.append(err_lf)\n\n        # --- Integrator 1: Lax-Wendroff-type (4th order time) ---\n        cos_Omega = 1.0 + 0.5 * r**2 * S_theta + (r**4 * S_theta**2) / 24.0\n        # The scheme is stable if |cos(Omega)| = 1.\n        if not (-1.0 = cos_Omega = 1.000000000001): # Add tolerance for float error\n            err_lw = float('inf')\n        else:\n            # Clamp cos_Omega to handle potential floating point inaccuracies near +/-1\n            cos_Omega = max(-1.0, min(1.0, cos_Omega))\n            sin_Omega = np.sqrt(1.0 - cos_Omega**2)\n            # The formula for vg/c is numerically unstable if sin(Omega) is zero.\n            if sin_Omega  1e-15:\n                 err_lw = float('inf')\n            else:\n                 numerator_lw = -S_prime_theta * (r / 2.0 + r**3 * S_theta / 12.0)\n                 vg_c_lw = numerator_lw / sin_Omega\n                 err_lw = np.abs(vg_c_lw - 1.0)\n        errors.append(err_lw)\n\n        # --- Integrator 2: Runge-Kutta 4 (RK4) ---\n        y = r * np.sqrt(-S_theta)\n        # Stability limit for RK4 on imaginary axis: |y| = 2*sqrt(2)\n        if y  2*np.sqrt(2):\n           err_rk4 = float('inf')\n        else:\n            y2 = y**2\n            y4 = y2**2\n            y6 = y2 * y4\n            y8 = y4**2\n            \n            # The factor modifying the semi-discretized group velocity\n            num_rk4_factor = 1.0 - y4 / 24.0 + y6 / 144.0\n            den_rk4_factor = 1.0 - y6 / 72.0 + y8 / 576.0\n            \n            # Base semi-discretized group velocity\n            vg_c_semi = -S_prime_theta / (2.0 * np.sqrt(-S_theta))\n            \n            vg_c_rk4 = vg_c_semi * (num_rk4_factor / den_rk4_factor)\n            err_rk4 = np.abs(vg_c_rk4 - 1.0)\n        errors.append(err_rk4)\n\n        # Find the integrator with the minimum error for the current r.\n        min_error = min(errors)\n        best_integrator_idx = errors.index(min_error)\n        \n        # Format the result [b, e] as specified.\n        # The error e must be rounded to ten decimal places as a decimal number.\n        rounded_error_str = f\"{min_error:.10f}\"\n        final_results.append(f\"[{best_integrator_idx},{rounded_error_str}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(final_results)}]\")\n\nsolve()\n```", "id": "3592801"}]}