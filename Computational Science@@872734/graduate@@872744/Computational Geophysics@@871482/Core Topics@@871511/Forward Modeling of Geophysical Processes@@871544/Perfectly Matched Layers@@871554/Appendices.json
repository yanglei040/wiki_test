{"hands_on_practices": [{"introduction": "This practice delves into the core of numerical stability for time-domain simulations using a Perfectly Matched Layer. By performing a von Neumann stability analysis for the 2D acoustic equations with a Convolutional PML (C-PML), you will derive the Courant–Friedrichs–Lewy (CFL) condition from first principles [@problem_id:3612714]. This exercise is essential for understanding the direct impact of PML parameters not just on wave absorption, but also on the maximum stable time step, a crucial constraint in any finite-difference time-domain (FDTD) code.", "problem": "Consider the two-dimensional linear acoustic equations in a homogeneous medium of constant density $\\rho$ and bulk modulus $K$, with wave speed $c = \\sqrt{K/\\rho}$. The equations in first-order form are\n$$\n\\frac{\\partial p}{\\partial t} = -K\\left(\\frac{\\partial v_x}{\\partial x} + \\frac{\\partial v_y}{\\partial y}\\right), \\quad\n\\frac{\\partial v_x}{\\partial t} = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x}, \\quad\n\\frac{\\partial v_y}{\\partial t} = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial y}.\n$$\nAssume the entire computational domain is filled with a homogeneous Convolutional Perfectly Matched Layer (C-PML) characterized by constant stretching parameters $\\kappa_x \\ge 1$, $\\kappa_y \\ge 1$, constant damping profiles $\\sigma_x = \\sigma_y = \\sigma \\ge 0$, and set $\\alpha_x = \\alpha_y = 0$. In the frequency domain, the C-PML coordinate stretching modifies spatial derivatives by $s_x^{-1}\\partial/\\partial x$ and $s_y^{-1}\\partial/\\partial y$, where $s_x(\\omega) = \\kappa_x + \\sigma_x/(i\\omega)$ and $s_y(\\omega) = \\kappa_y + \\sigma_y/(i\\omega)$.\n\nDiscretize the equations on a uniform staggered grid (pressure $p$ at integer time levels $n\\Delta t$ and integer spatial nodes, velocities $v_x, v_y$ at half time steps $(n+\\tfrac{1}{2})\\Delta t$ and staggered spatial locations) using second-order accurate central differences in space with spacings $(\\Delta x,\\Delta y)$ and the standard leapfrog time stepping. Perform a von Neumann analysis under the assumption that $\\kappa_x$, $\\kappa_y$, and $\\sigma$ are constant throughout space and time. Use a plane-wave ansatz for the discrete fields of the form\n$$\np^n_{j,k} = P\\,G^n \\exp\\!\\left(i k_x j \\Delta x + i k_y k \\Delta y\\right), \\quad v_x^{n+\\frac{1}{2}}{}_{j+\\frac{1}{2},k} = V_x\\,G^{n+\\frac{1}{2}} \\exp\\!\\left(i k_x \\left(j+\\tfrac{1}{2}\\right) \\Delta x + i k_y k \\Delta y\\right),\n$$\nand similarly for $v_y$, where $G$ is the amplification factor and $(k_x,k_y)$ are spatial wavenumbers.\n\nStarting from the fundamental acoustic equations and the definition of the C-PML stretch operators, derive the discrete dispersion relation for $G$ and establish the Courant–Friedrichs–Lewy (CFL) stability condition by requiring $|G| \\le 1$ for all $(k_x,k_y)$ in the first Brillouin zone. Show explicitly how the C-PML parameters $(\\kappa_x,\\kappa_y,\\sigma)$ enter the symbol of the spatial operator and explain the role of $\\sigma$ in the stability bound. Then, compute the maximum allowable time step $\\Delta t_{\\max}$ as a closed-form function of $c$, $\\Delta x$, $\\Delta y$, and the PML parameters $(\\kappa_x,\\kappa_y)$ under the stated assumptions.\n\nExpress the final $\\Delta t_{\\max}$ in seconds. No numerical substitution is required; provide a single closed-form analytic expression. Do not round.", "solution": "The problem asks for the derivation of the Courant–Friedrichs–Lewy (CFL) stability condition for the two-dimensional acoustic equations discretized with a finite-difference scheme in a domain governed by a Convolutional Perfectly Matched Layer (C-PML).\n\nFirst, we must validate the problem statement.\n\n### Step 1: Extract Givens\n-   **Governing Equations**:\n    $$\n    \\frac{\\partial p}{\\partial t} = -K\\left(\\frac{\\partial v_x}{\\partial x} + \\frac{\\partial v_y}{\\partial y}\\right), \\quad\n    \\frac{\\partial v_x}{\\partial t} = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x}, \\quad\n    \\frac{\\partial v_y}{\\partial t} = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial y}.\n    $$\n-   **Medium Properties**: Homogeneous, with constant density $\\rho$ and bulk modulus $K$.\n-   **Wave Speed**: $c = \\sqrt{K/\\rho}$.\n-   **PML Model**: Convolutional PML (C-PML) with constant parameters.\n-   **PML Parameters**: Stretching factors $\\kappa_x \\ge 1$, $\\kappa_y \\ge 1$. Damping profiles $\\sigma_x = \\sigma_y = \\sigma \\ge 0$. $\\alpha_x = \\alpha_y = 0$.\n-   **PML Stretch Operators (Frequency Domain)**: The spatial derivative $\\partial/\\partial x$ is modified by a factor $s_x(\\omega)^{-1}$ and $\\partial/\\partial y$ by $s_y(\\omega)^{-1}$, where $s_x(\\omega) = \\kappa_x + \\sigma_x/(i\\omega)$ and $s_y(\\omega) = \\kappa_y + \\sigma_y/(i\\omega)$.\n-   **Discretization Scheme**:\n    -   Grid: Uniform staggered grid. Pressure $p$ at integer time levels $n\\Delta t$ and integer spatial nodes $(j\\Delta x, k\\Delta y)$. Velocities $v_x, v_y$ at half-integer time levels $(n+\\tfrac{1}{2})\\Delta t$ and staggered spatial locations $((j+\\tfrac{1}{2})\\Delta x, k\\Delta y)$ and $(j\\Delta x, (k+\\tfrac{1}{2})\\Delta y)$, respectively.\n    -   Spatial Discretization: Second-order accurate central differences with spacings $\\Delta x, \\Delta y$.\n    -   Temporal Discretization: Standard leapfrog time stepping.\n-   **Analysis Method**: von Neumann stability analysis using a plane-wave ansatz.\n-   **Plane-Wave Ansatz**:\n    $$\n    p^n_{j,k} = P\\,G^n \\exp\\!\\left(i k_x j \\Delta x + i k_y k \\Delta y\\right)\n    $$\n    $$\n    v_x^{n+\\frac{1}{2}}{}_{j+\\frac{1}{2},k} = V_x\\,G^{n+\\frac{1}{2}} \\exp\\!\\left(i k_x \\left(j+\\tfrac{1}{2}\\right) \\Delta x + i k_y k \\Delta y\\right)\n    $$\n    and a similar form for $v_y$, where $G$ is the amplification factor and $(k_x, k_y)$ are the spatial wavenumbers.\n-   **Objective**: Derive the discrete dispersion relation for $G$, find the CFL stability condition by requiring $|G| \\le 1$, explain the role of $\\sigma$, and find the maximum allowable time step $\\Delta t_{\\max}$ as a function of $c$, $\\Delta x$, $\\Delta y$, $\\kappa_x$, and $\\kappa_y$.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is based on the standard acoustic wave equation and the widely used C-PML formulation for absorbing boundary conditions in finite-difference time-domain (FDTD) simulations. The methodology is a cornerstone of numerical analysis for partial differential equations. The problem is factually and scientifically sound.\n-   **Well-Posed**: The problem is clearly defined, with all necessary components provided to derive the stability condition. The objective is specific and achievable.\n-   **Objective**: The language is precise and technical, free of any subjectivity or ambiguity.\n-   **Completeness and Consistency**: The provided information is self-contained and sufficient. The description of the staggered grid, time-stepping scheme, and C-PML model is consistent with standard practices in computational wave physics.\n-   **Other Flaws**: The problem is not trivial, unrealistic, or otherwise flawed.\n\n### Step 3: Verdict and Action\nThe problem is valid. We proceed with the solution.\n\n#### Derivation of the Discrete Dispersion Relation\n\nThe leapfrog time-stepping scheme for the given staggered grid can be written as:\n$$\n\\frac{p^{n+1}_{j,k} - p^{n}_{j,k}}{\\Delta t} = -K\\left[ (D_x^{PML} v_x^{n+1/2})_{j,k} + (D_y^{PML} v_y^{n+1/2})_{j,k} \\right] \\quad (1)\n$$\n$$\n\\frac{v_x^{n+\\frac{1}{2}}{}_{j+\\frac{1}{2},k} - v_x^{n-\\frac{1}{2}}{}_{j+\\frac{1}{2},k}}{\\Delta t} = -\\frac{1}{\\rho} (D_x^{PML} p^{n})_{j+\\frac{1}{2},k} \\quad (2)\n$$\n$$\n\\frac{v_y^{n+\\frac{1}{2}}{}_{j,k+\\frac{1}{2}} - v_y^{n-\\frac{1}{2}}{}_{j,k+\\frac{1}{2}}}{\\Delta t} = -\\frac{1}{\\rho} (D_y^{PML} p^{n})_{j,k+\\frac{1}{2}} \\quad (3)\n$$\nwhere $D_x^{PML}$ and $D_y^{PML}$ represent the PML-modified discrete spatial derivative operators.\n\nFor the von Neumann analysis, we substitute the plane-wave ansatz into these equations. The standard second-order central difference operators acting on the plane-wave ansatz become multiplicative factors (symbols). For a field $f$, the symbol $\\hat{D}_x$ of the operator $D_x$ at wavenumber $k_x$ is:\n$$\n\\hat{D}_x f = \\frac{\\exp(i k_x \\Delta x/2) - \\exp(-i k_x \\Delta x/2)}{\\Delta x} f = \\frac{2i}{\\Delta x}\\sin\\left(\\frac{k_x \\Delta x}{2}\\right) f\n$$\nSimilarly, for the $y$-derivative:\n$$\n\\hat{D}_y f = \\frac{2i}{\\Delta y}\\sin\\left(\\frac{k_y \\Delta y}{2}\\right) f\n$$\nThe problem states that the C-PML modifies the spatial derivatives by factors of $s_x(\\omega)^{-1}$ and $s_y(\\omega)^{-1}$ in the frequency domain. In the context of von Neumann analysis, the continuous frequency $\\omega$ is identified with the numerical frequency of the discrete mode, which is related to the amplification factor $G$ by $G = \\exp(-i\\omega\\Delta t)$. Thus, the symbols for the PML-modified operators become:\n$$\n\\hat{D}^{PML}_x = \\frac{\\hat{D}_x}{s_x(\\omega)}, \\quad \\hat{D}^{PML}_y = \\frac{\\hat{D}_y}{s_y(\\omega)}\n$$\nSubstituting the ansatz and these symbols into equations $(1)-(3)$:\nEquation $(1)$ becomes:\n$P G^n \\frac{G-1}{\\Delta t} = -K \\left[ V_x G^{n+\\frac{1}{2}} \\frac{\\hat{D}_x}{s_x} + V_y G^{n+\\frac{1}{2}} \\frac{\\hat{D}_y}{s_y} \\right]$\nDividing by $G^n$ yields:\n$$\nP(G-1) = -K \\Delta t G^{\\frac{1}{2}} \\left( V_x \\frac{\\hat{D}_x}{s_x} + V_y \\frac{\\hat{D}_y}{s_y} \\right) \\quad (1')\n$$\nEquation $(2)$ becomes:\n$V_x G^{n-\\frac{1}{2}} \\frac{G-1}{\\Delta t} = -\\frac{1}{\\rho} P G^n \\frac{\\hat{D}_x}{s_x}$\nDividing by $G^{n-\\frac{1}{2}}$ yields:\n$$\nV_x(G-1) = -\\frac{\\Delta t}{\\rho} G^{\\frac{1}{2}} P \\frac{\\hat{D}_x}{s_x} \\quad (2')\n$$\nSimilarly, equation $(3)$ becomes:\n$$\nV_y(G-1) = -\\frac{\\Delta t}{\\rho} G^{\\frac{1}{2}} P \\frac{\\hat{D}_y}{s_y} \\quad (3')\n$$\nFrom $(2')$ and $(3')$, we express $V_x$ and $V_y$ in terms of $P$:\n$$\nV_x = -\\frac{\\Delta t}{\\rho} \\frac{G^{\\frac{1}{2}}}{G-1} P \\frac{\\hat{D}_x}{s_x}, \\quad V_y = -\\frac{\\Delta t}{\\rho} \\frac{G^{\\frac{1}{2}}}{G-1} P \\frac{\\hat{D}_y}{s_y}\n$$\nSubstituting these into $(1')$:\n$$\nP(G-1) = -K \\Delta t G^{\\frac{1}{2}} \\left[ \\left(-\\frac{\\Delta t}{\\rho} \\frac{G^{\\frac{1}{2}}}{G-1} P \\frac{\\hat{D}_x}{s_x}\\right) \\frac{\\hat{D}_x}{s_x} + \\left(-\\frac{\\Delta t}{\\rho} \\frac{G^{\\frac{1}{2}}}{G-1} P \\frac{\\hat{D}_y}{s_y}\\right) \\frac{\\hat{D}_y}{s_y} \\right]\n$$\nFor a non-trivial solution ($P \\ne 0$), we can cancel $P$ and simplify:\n$$\n(G-1) = \\frac{K \\Delta t^2}{\\rho} \\frac{G}{G-1} \\left( \\frac{\\hat{D}_x^2}{s_x^2} + \\frac{\\hat{D}_y^2}{s_y^2} \\right)\n$$\nUsing $c^2 = K/\\rho$, this gives the discrete dispersion relation for $G$:\n$$\n(G-1)^2 = G c^2 \\Delta t^2 \\left( \\frac{\\hat{D}_x^2}{s_x(\\omega)^2} + \\frac{\\hat{D}_y^2}{s_y(\\omega)^2} \\right)\n$$\nSubstitute the expressions for $\\hat{D}_x^2$ and $\\hat{D}_y^2$:\n$$\n(G-1)^2 = G c^2 \\Delta t^2 \\left[ \\frac{-4\\sin^2(k_x\\Delta x/2)}{s_x(\\omega)^2 \\Delta x^2} + \\frac{-4\\sin^2(k_y\\Delta y/2)}{s_y(\\omega)^2 \\Delta y^2} \\right]\n$$\nThis can be rewritten using the relation $G=\\exp(-i\\omega\\Delta t)$. The term $(G-1)^2/G = (G^{1/2}-G^{-1/2})^2 = (\\exp(-i\\omega\\Delta t/2) - \\exp(i\\omega\\Delta t/2))^2 = (-2i\\sin(\\omega\\Delta t/2))^2 = -4\\sin^2(\\omega\\Delta t/2)$.\n$$\n-4\\sin^2\\left(\\frac{\\omega\\Delta t}{2}\\right) = -4 c^2 \\Delta t^2 \\left[ \\frac{\\sin^2(k_x\\Delta x/2)}{s_x(\\omega)^2 \\Delta x^2} + \\frac{\\sin^2(k_y\\Delta y/2)}{s_y(\\omega)^2 \\Delta y^2} \\right]\n$$\nThus, the dispersion relation relating the numerical frequency $\\omega$ to the wavenumbers $(k_x, k_y)$ is:\n$$\n\\sin^2\\left(\\frac{\\omega\\Delta t}{2}\\right) = c^2 \\Delta t^2 \\left[ \\frac{\\sin^2(k_x\\Delta x/2)}{s_x(\\omega)^2 \\Delta x^2} + \\frac{\\sin^2(k_y\\Delta y/2)}{s_y(\\omega)^2 \\Delta y^2} \\right]\n$$\n\n#### CFL Stability Condition and Role of $\\sigma$\n\nThe stability condition is $|G| \\le 1$ for all wavenumbers. Since $G = \\exp(-i\\omega\\Delta t)$, this is equivalent to requiring that the imaginary part of the numerical frequency be non-negative, $\\text{Im}(\\omega) \\ge 0$.\n\nThe C-PML parameters are given by $s_x(\\omega) = \\kappa_x + \\sigma/(i\\omega)$ and $s_y(\\omega) = \\kappa_y + \\sigma/(i\\omega)$. The stability limit on the time step $\\Delta t$ is determined by the most unstable (or least stable) mode. We examine the behavior of the dispersion relation in limiting cases.\n\nConsider high-frequency modes, where $|\\omega| \\to \\infty$. In this limit, the term $\\sigma/(i\\omega) \\to 0$. The stretch factors approach their real, frequency-independent parts:\n$$\n\\lim_{|\\omega|\\to\\infty} s_x(\\omega) = \\kappa_x, \\quad \\lim_{|\\omega|\\to\\infty} s_y(\\omega) = \\kappa_y\n$$\nIn this limit, the dispersion relation simplifies to:\n$$\n\\sin^2\\left(\\frac{\\omega\\Delta t}{2}\\right) = c^2 \\Delta t^2 \\left[ \\frac{\\sin^2(k_x\\Delta x/2)}{\\kappa_x^2 \\Delta x^2} + \\frac{\\sin^2(k_y\\Delta y/2)}{\\kappa_y^2 \\Delta y^2} \\right]\n$$\nFor a solution $\\omega$ to be real, the right-hand side, which is real and non-negative, must not exceed $1$. If the right-hand side is greater than $1$, $\\sin(\\omega\\Delta t/2)$ becomes greater than $1$, implying that $\\omega\\Delta t/2$ is complex. A complex $\\omega$ in this non-dissipative case leads to one growing and one decaying mode ($|G|>1$ and $|G|<1$), hence instability. Therefore, for stability of all modes, we must require:\n$$\nc^2 \\Delta t^2 \\left[ \\frac{\\sin^2(k_x\\Delta x/2)}{\\kappa_x^2 \\Delta x^2} + \\frac{\\sin^2(k_y\\Delta y/2)}{\\kappa_y^2 \\Delta y^2} \\right] \\le 1\n$$\nThis condition must hold for all wavenumbers $(k_x, k_y)$ in the first Brillouin zone, i.e., $k_x \\in [-\\pi/\\Delta x, \\pi/\\Delta x]$ and $k_y \\in [-\\pi/\\Delta y, \\pi/\\Delta y]$. To find the most restrictive condition on $\\Delta t$, we must maximize the left-hand side with respect to $k_x$ and $k_y$. The maximum value of $\\sin^2(\\cdot)$ is $1$, which occurs at the Nyquist wavenumbers $k_x = \\pm \\pi/\\Delta x$ and $k_y = \\pm \\pi/\\Delta y$.\nThe stability condition thus becomes:\n$$\nc^2 \\Delta t^2 \\left[ \\frac{1}{\\kappa_x^2 \\Delta x^2} + \\frac{1}{\\kappa_y^2 \\Delta y^2} \\right] \\le 1\n$$\n\nThe role of $\\sigma$: The parameter $\\sigma \\ge 0$ introduces dissipation into the system for finite frequencies. The term $\\sigma/(i\\omega)$ adds an imaginary component to the stretch factors $s_x$ and $s_y$, which in turn makes the numerical frequency $\\omega$ complex with $\\text{Im}(\\omega) > 0$ for propagating waves. This corresponds to an amplification factor $|G| = \\exp(\\text{Im}(\\omega)\\Delta t) < 1$, causing the desired attenuation of waves within the PML. The high-frequency limit, which dictates the stability bound, is unaffected by $\\sigma$. Dissipation cannot make a stable scheme unstable, so the stability limit derived from the undamped ($\\sigma=0$ or $\\omega \\to \\infty$) case remains the correct CFL condition for the full C-PML system. The parameters $\\kappa_x \\ge 1$ and $\\kappa_y \\ge 1$ act to stretch the computational grid, increasing the effective phase velocity of high-frequency numerical waves, which necessitates a smaller time step for stability.\n\n#### Maximum Allowable Time Step\nFrom the stability inequality, we solve for the maximum allowable time step, $\\Delta t_{\\max}$:\n$$\n\\Delta t^2 \\le \\frac{1}{c^2 \\left( \\frac{1}{(\\kappa_x \\Delta x)^2} + \\frac{1}{(\\kappa_y \\Delta y)^2} \\right)}\n$$\n$$\n\\Delta t_{\\max} = \\frac{1}{c \\sqrt{\\frac{1}{(\\kappa_x \\Delta x)^2} + \\frac{1}{(\\kappa_y \\Delta y)^2}}}\n$$\nThis is the final closed-form expression for the maximum time step.", "answer": "$$\\boxed{\\frac{1}{c \\sqrt{\\frac{1}{(\\kappa_x \\Delta x)^{2}} + \\frac{1}{(\\kappa_y \\Delta y)^{2}}}}}$$", "id": "3612714"}, {"introduction": "While PMLs are designed to absorb energy, their interaction with physically dissipative media can lead to unexpected instabilities. This advanced exercise explores such a scenario by analyzing a PML applied to a one-dimensional poroelastic wave equation, which includes a viscous drag term [@problem_id:3612676]. By determining the conditions under which the PML causes spurious wave growth instead of decay, you will gain critical insight into the limitations of standard PML formulations and the importance of careful analysis when modeling complex, realistic geophysical systems.", "problem": "Consider a one-dimensional, homogeneous, isotropic poroelastic medium in the low-frequency regime, modeled by the fast compressional mode after eliminating fluid relative motion via Darcy’s law. The effective linear momentum balance for the solid displacement field $u(x,t)$ is taken as\n$$\n\\rho\\,\\frac{\\partial^{2}u}{\\partial t^{2}} + b\\,\\frac{\\partial u}{\\partial t} = K\\,\\frac{\\partial^{2}u}{\\partial x^{2}},\n$$\nwhere $\\rho$ is the effective mass density, $b$ is the viscous drag coefficient arising from fluid-solid interaction (e.g., $b = \\eta/\\kappa$ from Darcy friction, with fluid viscosity $\\eta$ and permeability $\\kappa$), and $K$ is the drained bulk modulus of the composite frame. In the frequency-domain plane-wave stability analysis, assume a time-harmonic plane wave $u(x,t) = U\\,\\exp(\\mathrm{i}k x - \\mathrm{i}\\omega t)$ with angular frequency $\\omega > 0$, where $k$ is the complex wavenumber $k = k' + \\mathrm{i}k''$ with $k' \\ge 0$ and $k'' \\ge 0$ describing propagation and attenuation, respectively.\n\nTo absorb outgoing waves without reflection, a Perfectly Matched Layer (PML) is applied via complex coordinate stretching. In a homogeneous PML segment with constant conductivity $\\sigma > 0$, the stretch factor in the $x$-direction is\n$$\ns_x(\\omega) = 1 + \\frac{\\sigma}{\\mathrm{i}\\omega} = 1 - \\mathrm{i}\\,\\frac{\\sigma}{\\omega},\n$$\nso that the plane-wave phase becomes $k\\,s_x(\\omega)\\,x$. Spurious growth inside the PML occurs if the imaginary part of the stretched wavenumber becomes negative, leading to exponential amplification instead of decay.\n\nStarting only from the given governing equation and the plane-wave ansatz, perform the plane-wave stability analysis to derive the dispersion relation in the physical (non-PML) medium and the corresponding complex wavenumber $k_0(\\omega)$. Then apply the PML stretching to obtain the complex wavenumber inside the PML, $k_{\\mathrm{pml}}(\\omega) = s_x(\\omega)\\,k_0(\\omega)$, and express the condition for non-amplifying solutions in terms of the sign of $\\operatorname{Im}(k_{\\mathrm{pml}})$. In the low-frequency limit where $\\rho\\,\\omega \\ll b$, determine the leading-order behavior of $k'(\\omega)$ and $k''(\\omega)$ and, from it, deduce the critical PML conductivity $\\sigma_{\\mathrm{crit}}(\\omega)$ at which the attenuation switches sign in the PML. Report $\\sigma_{\\mathrm{crit}}(\\omega)$ as a single closed-form analytical expression. Express the final result in $\\mathrm{s}^{-1}$. No numerical rounding is required.", "solution": "The problem requires the determination of the critical Perfectly Matched Layer (PML) conductivity $\\sigma_{\\mathrm{crit}}(\\omega)$ for a one-dimensional poroelastic wave equation in the low-frequency limit. The analysis shall proceed by first establishing the dispersion relation in the physical medium, then analyzing the wave behavior within the PML.\n\nThe governing equation for the solid displacement field $u(x,t)$ is given as:\n$$\n\\rho\\,\\frac{\\partial^{2}u}{\\partial t^{2}} + b\\,\\frac{\\partial u}{\\partial t} = K\\,\\frac{\\partial^{2}u}{\\partial x^{2}}\n$$\nwhere $\\rho$, $b$, and $K$ are positive real constants representing effective mass density, viscous drag coefficient, and drained bulk modulus, respectively.\n\nFirst, we derive the dispersion relation in the physical (non-PML) medium. We substitute the plane-wave ansatz, $u(x,t) = U\\,\\exp(\\mathrm{i}k_0 x - \\mathrm{i}\\omega t)$, into the governing equation. Here, $k_0$ is the complex wavenumber in the physical medium and $\\omega > 0$ is the angular frequency. The required derivatives are:\n$$\n\\frac{\\partial u}{\\partial t} = -\\mathrm{i}\\omega u\n$$\n$$\n\\frac{\\partial^{2} u}{\\partial t^{2}} = (-\\mathrm{i}\\omega)^{2} u = -\\omega^{2} u\n$$\n$$\n\\frac{\\partial^{2} u}{\\partial x^{2}} = (\\mathrm{i}k_0)^{2} u = -k_0^{2} u\n$$\nSubstituting these into the governing equation yields:\n$$\n\\rho(-\\omega^{2} u) + b(-\\mathrm{i}\\omega u) = K(-k_0^{2} u)\n$$\nAssuming a non-trivial solution ($u \\neq 0$), we can divide by $u$ to obtain the algebraic dispersion relation:\n$$\n-\\rho\\omega^{2} - \\mathrm{i}b\\omega = -Kk_0^{2}\n$$\nSolving for $k_0^2$, we find:\n$$\nk_0^2 = \\frac{\\rho\\omega^{2} + \\mathrm{i}b\\omega}{K}\n$$\nThe problem specifies the analysis is to be performed in the low-frequency limit, where $\\rho\\omega \\ll b$. This condition implies that $\\rho\\omega^2 \\ll b\\omega$. Consequently, we can neglect the $\\rho\\omega^2$ term in the numerator as it is much smaller than the $\\mathrm{i}b\\omega$ term. The dispersion relation simplifies to its leading-order behavior in this limit:\n$$\nk_0^2 \\approx \\mathrm{i}\\frac{b\\omega}{K}\n$$\nTo find the complex wavenumber $k_0(\\omega) = k'(\\omega) + \\mathrm{i}k''(\\omega)$, we must take the square root of this expression. We recall the principal square root of the imaginary unit, $\\sqrt{\\mathrm{i}} = \\exp(\\mathrm{i}\\pi/4) = \\frac{1+\\mathrm{i}}{\\sqrt{2}}$. Choosing this root ensures that the real part $k'$ (related to propagation) and the imaginary part $k''$ (related to attenuation) are both non-negative, consistent with a forward-propagating, attenuating wave as required by physical convention.\n$$\nk_0(\\omega) \\approx \\sqrt{\\frac{b\\omega}{K}} \\sqrt{\\mathrm{i}} = \\sqrt{\\frac{b\\omega}{K}} \\left(\\frac{1+\\mathrm{i}}{\\sqrt{2}}\\right) = \\sqrt{\\frac{b\\omega}{2K}} (1+\\mathrm{i})\n$$\nFrom this expression, we identify the leading-order behavior of the real and imaginary parts of the wavenumber:\n$$\nk'(\\omega) \\approx \\sqrt{\\frac{b\\omega}{2K}}\n$$\n$$\nk''(\\omega) \\approx \\sqrt{\\frac{b\\omega}{2K}}\n$$\nNext, we analyze the wave inside the PML. The wavenumber in the PML, $k_{\\mathrm{pml}}$, is obtained by multiplying the physical wavenumber $k_0$ by the complex stretch factor $s_x(\\omega)$:\n$$\nk_{\\mathrm{pml}}(\\omega) = s_x(\\omega) k_0(\\omega)\n$$\nGiven $s_x(\\omega) = 1 - \\mathrm{i}\\frac{\\sigma}{\\omega}$ and $k_0(\\omega) = k'(\\omega) + \\mathrm{i}k''(\\omega)$, we have:\n$$\nk_{\\mathrm{pml}} = \\left(1 - \\mathrm{i}\\frac{\\sigma}{\\omega}\\right) (k' + \\mathrm{i}k'') = k' + \\mathrm{i}k'' - \\mathrm{i}\\frac{\\sigma}{\\omega}k' - \\mathrm{i}^2\\frac{\\sigma}{\\omega}k'' = \\left(k' + \\frac{\\sigma}{\\omega}k''\\right) + \\mathrm{i}\\left(k'' - \\frac{\\sigma}{\\omega}k'\\right)\n$$\nThe wave amplitude inside the PML evolves according to the factor $\\exp(\\mathrm{i}k_{\\mathrm{pml}}x) = \\exp(-\\operatorname{Im}(k_{\\mathrm{pml}})x)\\exp(\\mathrm{i}\\operatorname{Re}(k_{\\mathrm{pml}})x)$. For the wave to be attenuated (non-amplifying) for $x>0$, the imaginary part of $k_{\\mathrm{pml}}$ must be non-negative:\n$$\n\\operatorname{Im}(k_{\\mathrm{pml}}) = k'' - \\frac{\\sigma}{\\omega}k' \\ge 0\n$$\nThe critical conductivity, $\\sigma_{\\mathrm{crit}}$, is the value of $\\sigma$ at which the attenuation term vanishes, i.e., where the stability condition becomes an equality:\n$$\nk'' - \\frac{\\sigma_{\\mathrm{crit}}}{\\omega}k' = 0\n$$\nSolving for $\\sigma_{\\mathrm{crit}}$ gives:\n$$\n\\sigma_{\\mathrm{crit}}(\\omega) = \\omega \\frac{k''(\\omega)}{k'(\\omega)}\n$$\nThe problem instructs us to deduce this value from the leading-order behavior of $k'(\\omega)$ and $k''(\\omega)$ derived previously. Substituting the expressions for $k'(\\omega)$ and $k''(\\omega)$ in the low-frequency limit:\n$$\n\\sigma_{\\mathrm{crit}}(\\omega) \\approx \\omega \\frac{\\sqrt{\\frac{b\\omega}{2K}}}{\\sqrt{\\frac{b\\omega}{2K}}} = \\omega \\times 1\n$$\nThus, the critical PML conductivity is simply the angular frequency.\n$$\n\\sigma_{\\mathrm{crit}}(\\omega) = \\omega\n$$\nThe unit of angular frequency $\\omega$ is radians per second, which is dimensionally equivalent to $\\mathrm{s}^{-1}$, matching the required units. This result indicates that in the diffusive limit, the PML becomes unstable if the conductivity parameter $\\sigma$ exceeds the wave's angular frequency $\\omega$.", "answer": "$$\\boxed{\\omega}$$", "id": "3612676"}, {"introduction": "The choice of an absorbing boundary condition is not just a matter of implementation, but of strategic design. This practice compares the versatile PML with an exact analytical alternative, the Dirichlet-to-Neumann (DtN) map, in the context of a horizontally layered medium [@problem_id:3612644]. By evaluating their performance and computational cost across various scenarios—including normal, grazing, and evanescent wavefields—you will learn to weigh the trade-offs between a general-purpose tool and a problem-specific, exact solution, honing your skills in efficient model design.", "problem": "Consider the two-dimensional, time-harmonic acoustic Helmholtz equation in a horizontally layered half-space,\n$$\\nabla^2 u(x,z) + k(z)^2 u(x,z) = 0,$$\nwith angular frequency $\\omega$, where the wavenumber in layer $j$ is $k_j = \\omega / c_j$ for acoustic speed $c_j$. Assume horizontal invariance (no lateral variation of material properties), and represent fields by horizontal plane-wave components with horizontal wavenumber $k_x$. For a given $k_x$, define the vertical wavenumber in layer $j$ by\n$$k_{z,j} = \\sqrt{k_j^2 - k_x^2},$$\nwith branch choice satisfying $\\operatorname{Im}(k_{z,j}) \\ge 0$.\n\nWe compare two truncation strategies for the semi-infinite computational domain:\n\n1. The exact Dirichlet-to-Neumann (DtN) map: At a truncation boundary located at the top of a layered half-space, the exact vertical derivative-to-value relation is a nonlocal operator in $x$ but is diagonal in the horizontal Fourier basis. For a single half-space, the exact map reduces to $\\partial u / \\partial z = i k_{z,\\text{last}} u$ at the boundary, where $k_{z,\\text{last}}$ is the vertical wavenumber in the semi-infinite last layer. For a finite stack of $J-1$ finite-thickness layers over a half-space, the exact map can be expressed by a layer-recursive transfer-matrix that produces an input impedance $Z_{\\text{top}}(k_x)$ and sets $\\partial u / \\partial z = Z_{\\text{top}}(k_x) u$; in all cases, the continuous DtN is exact and introduces zero reflection error per mode $k_x$.\n\n2. A perfectly matched layer (PML): Introduce a complex coordinate stretch in the last (semi-infinite) layer,\n$$s = 1 + i \\frac{\\sigma}{\\omega},$$\nwith constant damping parameter $\\sigma$ and truncate after a finite thickness $L$ using a homogeneous Dirichlet termination. In the continuous setting, the amplitude of a single plane-wave mode penetrating into the PML decays approximately as\n$$\\exp\\left(-\\left[\\operatorname{Re}(k_{z,\\text{last}})\\operatorname{Im}(s) + \\operatorname{Im}(k_{z,\\text{last}})\\operatorname{Re}(s)\\right] z\\right),$$\nso the back-reflection amplitude after a round-trip of thickness $L$ is modeled by\n$$R_{\\text{pml}}(k_x) \\approx \\exp\\left(-2\\left[\\operatorname{Re}(k_{z,\\text{last}})\\operatorname{Im}(s) + \\operatorname{Im}(k_{z,\\text{last}})\\operatorname{Re}(s)\\right] L\\right).$$\nFor propagating modes with $\\operatorname{Re}(k_{z,\\text{last}}) > 0$ and $\\operatorname{Im}(k_{z,\\text{last}}) = 0$, this reduces to $R_{\\text{pml}} \\approx \\exp\\left(-2 \\operatorname{Re}(k_{z,\\text{last}}) \\frac{\\sigma}{\\omega} L\\right)$; for evanescent modes with $\\operatorname{Re}(k_{z,\\text{last}}) = 0$ and $\\operatorname{Im}(k_{z,\\text{last}}) > 0$, this reduces to $R_{\\text{pml}} \\approx \\exp\\left(-2 \\operatorname{Im}(k_{z,\\text{last}}) L\\right)$, showing that the perfectly matched layer does not accelerate the decay of evanescent components beyond the physical decay in the absence of damping.\n\nWe adopt a simple and scientifically defensible discretization error model for a finite-difference discretization of order $p$ in the PML layer with grid spacing $\\Delta z$:\n$$R_{\\text{fd}}(k_x) \\approx C_{\\text{fd}} \\left(|k_{z,\\text{last}}| \\Delta z\\right)^p,$$\nwhere $C_{\\text{fd}}$ is a scheme-dependent constant. The total PML error per mode is modeled by\n$$E_{\\text{pml}}(k_x) \\approx R_{\\text{pml}}(k_x) + R_{\\text{fd}}(k_x).$$\n\nFor cost models, we consider per-mode costs that reflect algorithmic complexity to achieve a specified target error $\\tau$:\n\n- PML per-mode cost is dominated by the number of grid points in the absorbing layer,\n$$C_{\\text{pml}} = N_{\\text{pml}} = \\left\\lceil \\frac{L}{\\Delta z} \\right\\rceil,$$\nwhere $L$ is chosen minimally to satisfy $R_{\\text{pml}}(k_x) \\le \\tau/2$ while simultaneously requiring $R_{\\text{fd}}(k_x) \\le \\tau/2$.\n\n- Exact DtN per-mode cost for a layered half-space with $J$ layers (including the semi-infinite last layer) is taken as\n$$C_{\\text{dtn}} = J,$$\nrepresenting the cost of one upward recursion over layers per mode (the continuous DtN map is exact, so we set the DtN error per mode to $E_{\\text{dtn}}(k_x) = 0$).\n\nGiven these models, for each test case we ask you to compute the minimal absorbing-layer thickness $L_{\\min}$ needed to satisfy $R_{\\text{pml}}(k_x) \\le \\tau/2$, verify $R_{\\text{fd}}(k_x) \\le \\tau/2$ for the supplied $\\Delta z$ and $p$, and then compute the per-mode cost ratio\n$$\\rho = \\frac{C_{\\text{pml}}}{C_{\\text{dtn}}}.$$\nA value $\\rho > 1$ indicates that the perfectly matched layer underperforms the exact Dirichlet-to-Neumann map in terms of cost to meet the same target error for the given mode; $\\rho < 1$ indicates the opposite.\n\nAll physical units must be applied consistently: speeds $c_j$ in meters per second (m/s), frequency $f$ in Hertz (Hz), thicknesses $H_j$ and $L$ in meters (m), and grid spacing $\\Delta z$ in meters (m). The angle unit is not used. You must express the output as dimensionless floats rounded to six decimal places.\n\nTest suite and parameters:\n- Adopt $C_{\\text{fd}} = 10^{-4}$ and $p = 4$ in all cases.\n- The damping coefficient $\\sigma$ is constant across the perfectly matched layer.\n- For all cases, the last layer is semi-infinite; when $J > 1$, the first $J-1$ layers are finite-thickness and overlie the last layer, but only $J$ enters the cost model.\n\nDefine the following four test cases, each as a tuple specifying $(J, \\{c_j\\}, f, \\chi, \\sigma, L_{\\text{init}}, \\Delta z, \\tau)$ where $\\chi$ sets $k_x = \\chi k_1$ with $k_1 = \\omega / c_1$:\n1. Case A (many layers, normal incidence): $J = 50$, $\\{c_j\\} = [2000]$, $f = 20\\ \\text{Hz}$, $\\chi = 0.0$, $\\sigma = 800\\ \\text{s}^{-1}$, $L_{\\text{init}} = 200\\ \\text{m}$, $\\Delta z = 4\\ \\text{m}$, $\\tau = 10^{-6}$.\n2. Case B (two layers, grazing incidence): $J = 2$, $\\{c_j\\} = [2000, 2000]$, $f = 20\\ \\text{Hz}$, $\\chi = 0.99$, $\\sigma = 800\\ \\text{s}^{-1}$, $L_{\\text{init}} = 200\\ \\text{m}$, $\\Delta z = 2\\ \\text{m}$, $\\tau = 10^{-6}$.\n3. Case C (two layers, slightly evanescent): $J = 2$, $\\{c_j\\} = [2000, 2000]$, $f = 20\\ \\text{Hz}$, $\\chi = 1.01$, $\\sigma = 800\\ \\text{s}^{-1}$, $L_{\\text{init}} = 200\\ \\text{m}$, $\\Delta z = 2\\ \\text{m}$, $\\tau = 10^{-6}$.\n4. Case D (many layers, higher frequency, near grazing but propagating): $J = 50$, $\\{c_j\\} = [2000]$, $f = 60\\ \\text{Hz}$, $\\chi = 0.95$, $\\sigma = 800\\ \\text{s}^{-1}$, $L_{\\text{init}} = 200\\ \\text{m}$, $\\Delta z = 4\\ \\text{m}$, $\\tau = 10^{-6}$.\n\nAlgorithmic requirements:\n- For each case, compute $\\omega = 2\\pi f$ and $k_1 = \\omega / c_1$, then set $k_x = \\chi k_1$ and $k_{\\text{last}} = \\omega / c_{\\text{last}}$ with $c_{\\text{last}}$ the speed in the last layer.\n- Compute $k_{z,\\text{last}} = \\sqrt{k_{\\text{last}}^2 - k_x^2}$ with branch choice satisfying $\\operatorname{Im}(k_{z,\\text{last}}) \\ge 0$.\n- Let $b = \\sigma / \\omega$ and $s = 1 + i b$. Define\n$$\\alpha = \\operatorname{Re}(k_{z,\\text{last}})\\operatorname{Im}(s) + \\operatorname{Im}(k_{z,\\text{last}})\\operatorname{Re}(s) = \\operatorname{Re}(k_{z,\\text{last}})\\frac{\\sigma}{\\omega} + \\operatorname{Im}(k_{z,\\text{last}}).$$\n- If $\\alpha = 0$, set $L_{\\min} = +\\infty$ and report $\\rho = +\\infty$. Otherwise,\n$$L_{\\min} = \\frac{\\log(2/\\tau)}{2\\alpha}, \\quad N_{\\text{pml}} = \\left\\lceil \\frac{L_{\\min}}{\\Delta z} \\right\\rceil, \\quad \\rho = \\frac{N_{\\text{pml}}}{J}.$$\n- Independently verify $R_{\\text{fd}}(k_x) \\le \\tau/2$, where\n$$R_{\\text{fd}}(k_x) = C_{\\text{fd}} \\left(|k_{z,\\text{last}}| \\Delta z\\right)^p.$$\nIf this fails, set $\\rho = +\\infty$ to indicate that with the provided $\\Delta z$ and $p$ the perfectly matched layer cannot reach the target error.\n\nYour program should produce a single line of output containing the four cost ratios $\\rho$ for Cases A–D, as a comma-separated list enclosed in square brackets, e.g., $[\\rho_A,\\rho_B,\\rho_C,\\rho_D]$. The output is dimensionless and must contain no other text.", "solution": "The problem requires a comparative cost analysis between two methods for truncating a semi-infinite computational domain in the context of the two-dimensional acoustic Helmholtz equation, $\\nabla^2 u(x,z) + k(z)^2 u(x,z) = 0$. The two methods are the exact Dirichlet-to-Neumann (DtN) map and the Perfectly Matched Layer (PML). The analysis is performed on a per-mode basis for a given horizontal wavenumber $k_x$. The objective is to compute the cost ratio $\\rho = C_{\\text{pml}} / C_{\\text{dtn}}$ for four distinct test cases, where a ratio $\\rho > 1$ indicates that the PML is less efficient than the DtN map for the specified mode and error tolerance.\n\nThe cost models are defined as follows:\n1.  The DtN cost, $C_{\\text{dtn}} = J$, represents the number of layers $J$ in the model, reflecting the recursive nature of the DtN calculation. The DtN map is analytically exact, so its error is $E_{\\text{dtn}}(k_x) = 0$.\n2.  The PML cost, $C_{\\text{pml}} = N_{\\text{pml}} = \\left\\lceil L_{\\min}/\\Delta z \\right\\rceil$, is the number of grid points required to discretize the PML of minimal thickness $L_{\\min}$ with grid spacing $\\Delta z$.\n\nThe total error budget for the PML is $\\tau$. This budget is split equally between two error sources: continuous reflection from the back of the PML, $R_{\\text{pml}}(k_x)$, and numerical reflection from discretization, $R_{\\text{fd}}(k_x)$. We must satisfy both $R_{\\text{pml}}(k_x) \\le \\tau/2$ and $R_{\\text{fd}}(k_x) \\le \\tau/2$.\n\nFirst, we determine the minimal PML thickness $L_{\\min}$ needed to suppress continuous reflections to the required level. The reflection amplitude is modeled as:\n$$R_{\\text{pml}}(k_x) \\approx \\exp\\left(-2\\left[\\operatorname{Re}(k_{z,\\text{last}})\\operatorname{Im}(s) + \\operatorname{Im}(k_{z,\\text{last}})\\operatorname{Re}(s)\\right] L\\right)$$\nHere, $k_{z,\\text{last}} = \\sqrt{k_{\\text{last}}^2 - k_x^2}$ is the vertical wavenumber in the semi-infinite bottom layer (with $\\operatorname{Im}(k_{z,\\text{last}}) \\ge 0$), and $s = 1 + i (\\sigma/\\omega)$ is the complex coordinate stretching factor. Let us define the attenuation rate within the PML as:\n$$\\alpha = \\operatorname{Re}(k_{z,\\text{last}})\\operatorname{Im}(s) + \\operatorname{Im}(k_{z,\\text{last}})\\operatorname{Re}(s) = \\operatorname{Re}(k_{z,\\text{last}})\\frac{\\sigma}{\\omega} + \\operatorname{Im}(k_{z,\\text{last}})$$\nThe reflection formula simplifies to $R_{\\text{pml}}(k_x) \\approx \\exp(-2\\alpha L)$. The condition $R_{\\text{pml}}(k_x) \\le \\tau/2$ thus requires $\\exp(-2\\alpha L_{\\min}) \\le \\tau/2$. Solving for $L_{\\min}$ (assuming $\\alpha > 0$) yields:\n$$L_{\\min} = \\frac{-\\log(\\tau/2)}{2\\alpha} = \\frac{\\log(2/\\tau)}{2\\alpha}$$\nIf $\\alpha \\le 0$, effective attenuation is not possible, and we consider the PML to have failed, setting $\\rho = +\\infty$.\n\nSecond, we must verify that the chosen grid spacing $\\Delta z$ is sufficient to control the discretization error. The model for this error is:\n$$R_{\\text{fd}}(k_x) = C_{\\text{fd}} \\left(|k_{z,\\text{last}}| \\Delta z\\right)^p$$\nIf $R_{\\text{fd}}(k_x) > \\tau/2$, the grid is too coarse to meet the error target, regardless of the PML thickness $L$. In this case, the PML method is considered to have failed for the given parameters, and we set $\\rho = +\\infty$.\n\nThe overall algorithm for each test case is as follows:\n1.  Calculate physical parameters: angular frequency $\\omega = 2\\pi f$, wavenumbers $k_1 = \\omega/c_1$, $k_x = \\chi k_1$, and $k_{\\text{last}} = \\omega/c_{\\text{last}}$.\n2.  Compute the vertical wavenumber $k_{z,\\text{last}} = \\sqrt{k_{\\text{last}}^2 - k_x^2}$ using the branch choice $\\operatorname{Im}(k_{z,\\text{last}}) \\ge 0$.\n3.  Check the discretization error constraint: compute $R_{\\text{fd}}(k_x)$ with $C_{\\text{fd}} = 10^{-4}$ and $p=4$. If $R_{\\text{fd}}(k_x) > \\tau/2$, set $\\rho=+\\infty$ and stop.\n4.  If the discretization error is acceptable, calculate the attenuation rate $\\alpha$. If $\\alpha \\le 0$, set $\\rho=+\\infty$ and stop.\n5.  Calculate the minimal PML thickness $L_{\\min}$ and the required number of grid points $N_{\\text{pml}} = \\lceil L_{\\min}/\\Delta z \\rceil$.\n6.  Compute the cost ratio $\\rho = N_{\\text{pml}} / J$.\n\nWe now apply this procedure to the four test cases. All cases use $\\tau = 10^{-6}$, so $\\tau/2 = 5 \\times 10^{-7}$. The constant parameters are $C_{\\text{fd}} = 10^{-4}$ and $p=4$.\n\n**Case A: Many layers, normal incidence**\nParameters: $J=50$, $c_j=[2000]\\ \\text{m/s}$, $f=20\\ \\text{Hz}$, $\\chi=0.0$, $\\sigma=800\\ \\text{s}^{-1}$, $\\Delta z=4\\ \\text{m}$.\n1.  $c_1 = c_{\\text{last}} = 2000$. $\\omega = 2\\pi(20) = 40\\pi\\ \\text{rad/s}$. $k_{\\text{last}} = 40\\pi/2000 = \\pi/50\\ \\text{m}^{-1}$.\n2.  $k_x = 0.0 \\cdot k_1 = 0$. Thus, $k_{z,\\text{last}} = \\sqrt{k_{\\text{last}}^2 - 0^2} = k_{\\text{last}} = \\pi/50 \\approx 0.06283\\ \\text{m}^{-1}$. This is a purely propagating mode.\n3.  Discretization error: $R_{\\text{fd}} = 10^{-4} (|\\pi/50| \\cdot 4)^4 = 10^{-4} (4\\pi/50)^4 \\approx 3.985 \\times 10^{-7}$. This is less than $\\tau/2 = 5 \\times 10^{-7}$, so the grid is adequate.\n4.  Attenuation rate: $\\operatorname{Re}(k_{z,\\text{last}}) = \\pi/50$, $\\operatorname{Im}(k_{z,\\text{last}}) = 0$.\n    $\\alpha = (\\pi/50) \\cdot (\\sigma/\\omega) + 0 = (\\pi/50) \\cdot (800/(40\\pi)) = (\\pi/50) \\cdot (20/\\pi) = 0.4\\ \\text{m}^{-1}$.\n5.  PML thickness and cost: $\\log(2/\\tau) = \\log(2 \\times 10^6) \\approx 14.50866$.\n    $L_{\\min} = 14.50866 / (2 \\cdot 0.4) \\approx 18.136\\ \\text{m}$.\n    $N_{\\text{pml}} = \\lceil 18.136 / 4 \\rceil = \\lceil 4.534 \\rceil = 5$.\n6.  Cost ratio: $\\rho_A = N_{\\text{pml}}/J = 5/50 = 0.1$.\n\n**Case B: Two layers, grazing incidence**\nParameters: $J=2$, $c_j=[2000, 2000]\\ \\text{m/s}$, $f=20\\ \\text{Hz}$, $\\chi=0.99$, $\\sigma=800\\ \\text{s}^{-1}$, $\\Delta z=2\\ \\text{m}$.\n1.  $c_1 = c_{\\text{last}} = 2000$. $\\omega = 40\\pi\\ \\text{rad/s}$. $k_1 = k_{\\text{last}} = \\pi/50\\ \\text{m}^{-1}$.\n2.  $k_x = 0.99 \\cdot (\\pi/50)$. $k_{z,\\text{last}} = \\sqrt{(\\pi/50)^2 - (0.99 \\pi/50)^2} = (\\pi/50)\\sqrt{1 - 0.99^2} = (\\pi/50)\\sqrt{0.0199} \\approx 0.00886\\ \\text{m}^{-1}$. This mode is propagating.\n3.  Discretization error: $R_{\\text{fd}} = 10^{-4} (0.00886 \\cdot 2)^4 \\approx 9.86 \\times 10^{-12}$. This is far below $\\tau/2$, so the grid is adequate.\n4.  Attenuation rate: $\\alpha = \\operatorname{Re}(k_{z,\\text{last}}) \\cdot (\\sigma/\\omega) = 0.00886 \\cdot (20/\\pi) \\approx 0.05643\\ \\text{m}^{-1}$.\n5.  PML thickness and cost: $L_{\\min} = 14.50866 / (2 \\cdot 0.05643) \\approx 128.55\\ \\text{m}$.\n    $N_{\\text{pml}} = \\lceil 128.55 / 2 \\rceil = \\lceil 64.275 \\rceil = 65$.\n6.  Cost ratio: $\\rho_B = N_{\\text{pml}}/J = 65/2 = 32.5$.\n\n**Case C: Two layers, slightly evanescent**\nParameters: $J=2$, $c_j=[2000, 2000]\\ \\text{m/s}$, $f=20\\ \\text{Hz}$, $\\chi=1.01$, $\\sigma=800\\ \\text{s}^{-1}$, $\\Delta z=2\\ \\text{m}$.\n1.  $c_1 = c_{\\text{last}} = 2000$. $\\omega = 40\\pi\\ \\text{rad/s}$. $k_1 = k_{\\text{last}} = \\pi/50\\ \\text{m}^{-1}$.\n2.  $k_x = 1.01 \\cdot (\\pi/50)$. $k_{z,\\text{last}}^2 = (\\pi/50)^2 - (1.01 \\pi/50)^2 < 0$.\n    $k_{z,\\text{last}} = i \\cdot (\\pi/50)\\sqrt{1.01^2 - 1} = i \\cdot (\\pi/50)\\sqrt{0.0201} \\approx i \\cdot 0.00891\\ \\text{m}^{-1}$. This mode is evanescent.\n3.  Discretization error: $|k_{z,\\text{last}}| \\approx 0.00891$. $R_{\\text{fd}} = 10^{-4} (0.00891 \\cdot 2)^4 \\approx 1.008 \\times 10^{-11}$. This is far below $\\tau/2$, so the grid is adequate.\n4.  Attenuation rate: $\\operatorname{Re}(k_{z,\\text{last}}) = 0$.\n    $\\alpha = 0 \\cdot (\\sigma/\\omega) + \\operatorname{Im}(k_{z,\\text{last}}) = \\operatorname{Im}(k_{z,\\text{last}}) \\approx 0.00891\\ \\text{m}^{-1}$. The PML does not accelerate the natural decay of the evanescent wave.\n5.  PML thickness and cost: $L_{\\min} = 14.50866 / (2 \\cdot 0.00891) \\approx 814.34\\ \\text{m}$.\n    $N_{\\text{pml}} = \\lceil 814.34 / 2 \\rceil = \\lceil 407.17 \\rceil = 408$.\n6.  Cost ratio: $\\rho_C = N_{\\text{pml}}/J = 408/2 = 204.0$.\n\n**Case D: Many layers, higher frequency, near grazing**\nParameters: $J=50$, $c_j=[2000]\\ \\text{m/s}$, $f=60\\ \\text{Hz}$, $\\chi=0.95$, $\\sigma=800\\ \\text{s}^{-1}$, $\\Delta z=4\\ \\text{m}$.\n1.  $c_1 = c_{\\text{last}} = 2000$. $\\omega = 2\\pi(60) = 120\\pi\\ \\text{rad/s}$. $k_{\\text{last}} = 120\\pi/2000 = 3\\pi/50\\ \\text{m}^{-1}$.\n2.  $k_x = 0.95 \\cdot (3\\pi/50)$. $k_{z,\\text{last}} = (3\\pi/50)\\sqrt{1 - 0.95^2} = (3\\pi/50)\\sqrt{0.0975} \\approx 0.05885\\ \\text{m}^{-1}$. This is a propagating mode.\n3.  Discretization error: $R_{\\text{fd}} = 10^{-4} (0.05885 \\cdot 4)^4 \\approx 3.07 \\times 10^{-7}$. This is less than $\\tau/2 = 5 \\times 10^{-7}$, so the grid is adequate.\n4.  Attenuation rate: $\\alpha = \\operatorname{Re}(k_{z,\\text{last}}) \\cdot (\\sigma/\\omega) = 0.05885 \\cdot (800/(120\\pi)) = 0.05885 \\cdot (20/(3\\pi)) \\approx 0.12488\\ \\text{m}^{-1}$.\n5.  PML thickness and cost: $L_{\\min} = 14.50866 / (2 \\cdot 0.12488) \\approx 58.09\\ \\text{m}$.\n    $N_{\\text{pml}} = \\lceil 58.09 / 4 \\rceil = \\lceil 14.5225 \\rceil = 15$.\n6.  Cost ratio: $\\rho_D = N_{\\text{pml}}/J = 15/50 = 0.3$.\n\nFinal results for the cost ratios are $\\rho_A=0.1$, $\\rho_B=32.5$, $\\rho_C=204.0$, and $\\rho_D=0.3$.", "answer": "[0.100000,32.500000,204.000000,0.300000]", "id": "3612644"}]}