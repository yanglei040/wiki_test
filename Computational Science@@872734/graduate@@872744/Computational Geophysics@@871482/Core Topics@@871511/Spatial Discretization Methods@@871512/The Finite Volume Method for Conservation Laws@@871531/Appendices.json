{"hands_on_practices": [{"introduction": "The finite volume method's power lies in its local conservation property and its applicability to complex geometries. This begins with correctly defining the discrete control volumes and their geometric properties. This exercise [@problem_id:3616607] focuses on the fundamental geometric calculations for an unstructured tetrahedral cell, including face areas and outward-pointing normals, which are essential for accurately summing fluxes at the boundaries. Mastering these low-level geometric computations is a crucial first step toward implementing any finite volume code on the unstructured grids frequently used in geophysical modeling.", "problem": "Consider a single control volume defined by a tetrahedral cell in a triangulated domain. The vertices of the tetrahedron are given by $V_{0}=(0,0,0)$, $V_{1}=(2,0,0)$, $V_{2}=(0,3,0)$, and $V_{3}=(0,0,6)$, with coordinates in $\\mathrm{m}$. Treat this tetrahedron as a control volume in the Finite Volume Method (FVM) for a conservation law of the form $\\nabla \\cdot \\boldsymbol{u} = s$ with $\\boldsymbol{u}$ a prescribed velocity field and $s$ a source term. The volumetric flux through the control volume boundary is given by the surface integral of $\\boldsymbol{u} \\cdot \\boldsymbol{n}$ over the boundary, where $\\boldsymbol{n}$ is the outward unit normal.\n\nA divergence-conforming discretization requires the following geometric and orientation steps for each triangular face $f$ of the tetrahedron: compute the face centroid, the face area $A_{f}$, and the outward unit normal $\\boldsymbol{n}_{f}$ using only the vertex coordinates. Use the following geometric construction to ensure correct orientation: for a face with ordered vertices $(\\boldsymbol{v}_{1},\\boldsymbol{v}_{2},\\boldsymbol{v}_{3})$, define the oriented area vector by $\\boldsymbol{S}_{f}=\\tfrac{1}{2}[(\\boldsymbol{v}_{2}-\\boldsymbol{v}_{1}) \\times (\\boldsymbol{v}_{3}-\\boldsymbol{v}_{1})]$, and flip the sign of $\\boldsymbol{S}_{f}$ if necessary so that $\\boldsymbol{S}_{f} \\cdot (\\boldsymbol{x}_{f}-\\boldsymbol{x}_{c})0$, where $\\boldsymbol{x}_{f}$ is the face centroid and $\\boldsymbol{x}_{c}$ is the cell centroid. Then $A_{f}=|\\boldsymbol{S}_{f}|$ and $\\boldsymbol{n}_{f}=\\boldsymbol{S}_{f}/|\\boldsymbol{S}_{f}|$.\n\nLet the velocity field be $\\boldsymbol{u}(x,y,z)=(\\alpha x,\\, \\beta y,\\, \\gamma z)$ with $\\alpha=1\\,\\mathrm{s}^{-1}$, $\\beta=2\\,\\mathrm{s}^{-1}$, and $\\gamma=2\\,\\mathrm{s}^{-1}$. For each face $f$, evaluate $\\boldsymbol{u}$ at the face centroid $\\boldsymbol{x}_{f}$, compute the oriented face flux $\\Phi_{f}=\\boldsymbol{u}(\\boldsymbol{x}_{f}) \\cdot \\boldsymbol{n}_{f}\\,A_{f}=\\boldsymbol{u}(\\boldsymbol{x}_{f}) \\cdot \\boldsymbol{S}_{f}$, and sum over all faces to obtain the net outward volumetric flux through the tetrahedron boundary.\n\nStarting from the integral form of conservation (net outward flux equals the surface integral of $\\boldsymbol{u}\\cdot \\boldsymbol{n}$ over the boundary), and using only the definitions above, carry out the computation explicitly from vertex coordinates. Provide the final numerical value of the net outward volumetric flux. Express your answer in $\\mathrm{m}^{3}/\\mathrm{s}$ and round to four significant figures.", "solution": "The problem is found to be valid as it is scientifically grounded, well-posed, and objective. It provides a complete and consistent setup for a standard numerical analysis problem in the context of the Finite Volume Method. We may proceed with the solution.\n\nThe objective is to compute the net outward volumetric flux through the boundary of a tetrahedral control volume. The problem specifies that this is to be done by summing the fluxes over the four faces of the tetrahedron, where each face flux is approximated using a midpoint rule. The net flux $\\Phi_{\\text{net}}$ is given by:\n$$\n\\Phi_{\\text{net}} = \\sum_{f} \\Phi_f = \\sum_{f} \\boldsymbol{u}(\\boldsymbol{x}_f) \\cdot \\boldsymbol{S}_f\n$$\nwhere the sum is over the four faces of the tetrahedron, $\\boldsymbol{x}_f$ is the centroid of face $f$, and $\\boldsymbol{S}_f$ is the oriented area vector of face $f$.\n\nThe tetrahedron vertices are given as $V_{0}=(0,0,0)$, $V_{1}=(2,0,0)$, $V_{2}=(0,3,0)$, and $V_{3}=(0,0,6)$, with coordinates in meters.\nThe velocity field is $\\boldsymbol{u}(x,y,z) = (\\alpha x, \\beta y, \\gamma z)$ with constants $\\alpha = 1\\,\\mathrm{s}^{-1}$, $\\beta = 2\\,\\mathrm{s}^{-1}$, and $\\gamma = 2\\,\\mathrm{s}^{-1}$.\n\nFirst, we compute the centroid of the tetrahedral cell, $\\boldsymbol{x}_c$:\n$$\n\\boldsymbol{x}_c = \\frac{1}{4} (V_0 + V_1 + V_2 + V_3) = \\frac{1}{4} ((0,0,0) + (2,0,0) + (0,3,0) + (0,0,6))\n$$\n$$\n\\boldsymbol{x}_c = \\frac{1}{4} (2, 3, 6) = (0.5, 0.75, 1.5)\n$$\n\nThe four faces of the tetrahedron are:\n1.  $f_1$: The face on the $xy$-plane with vertices $(V_0, V_1, V_2)$.\n2.  $f_2$: The face on the $xz$-plane with vertices $(V_0, V_1, V_3)$.\n3.  $f_3$: The face on the $yz$-plane with vertices $(V_0, V_2, V_3)$.\n4.  $f_4$: The slant face with vertices $(V_1, V_2, V_3)$.\n\nWe will now compute the flux for each face according to the specified procedure.\n\n**Face 1: vertices $(V_0, V_1, V_2)$**\nLet's order the vertices as $(\\boldsymbol{v}_1, \\boldsymbol{v}_2, \\boldsymbol{v}_3) = (V_0, V_1, V_2)$.\nThe initial oriented area vector $\\boldsymbol{S}_{f_1}'$ is:\n$$\n\\boldsymbol{S}_{f_1}' = \\frac{1}{2} ( (V_1 - V_0) \\times (V_2 - V_0) ) = \\frac{1}{2} ( (2,0,0) \\times (0,3,0) ) = \\frac{1}{2} (0,0,6) = (0,0,3)\n$$\nThe face centroid $\\boldsymbol{x}_{f_1}$ is:\n$$\n\\boldsymbol{x}_{f_1} = \\frac{1}{3} (V_0 + V_1 + V_2) = \\frac{1}{3} (2,3,0)\n$$\nTo determine the outward orientation, we check the sign of $\\boldsymbol{S}_{f_1}' \\cdot (\\boldsymbol{x}_{f_1} - \\boldsymbol{x}_c)$:\n$$\n(0,0,3) \\cdot \\left( \\frac{1}{3}(2,3,0) - \\frac{1}{4}(2,3,6) \\right) = (0,0,3) \\cdot \\left( \\frac{2}{3} - \\frac{1}{2}, 1 - \\frac{3}{4}, 0 - \\frac{3}{2} \\right) = (0,0,3) \\cdot \\left( \\frac{1}{6}, \\frac{1}{4}, -\\frac{3}{2} \\right) = -4.5\n$$\nSince the result is negative, we must flip the sign. The correctly oriented area vector is $\\boldsymbol{S}_{f_1} = -\\boldsymbol{S}_{f_1}' = (0,0,-3)$.\nThe velocity at the face centroid is $\\boldsymbol{u}(\\boldsymbol{x}_{f_1}) = (\\alpha \\frac{2}{3}, \\beta \\cdot 1, \\gamma \\cdot 0) = (1 \\cdot \\frac{2}{3}, 2 \\cdot 1, 2 \\cdot 0) = (\\frac{2}{3}, 2, 0)$.\nThe flux through face $f_1$ is:\n$$\n\\Phi_{f_1} = \\boldsymbol{u}(\\boldsymbol{x}_{f_1}) \\cdot \\boldsymbol{S}_{f_1} = (\\frac{2}{3}, 2, 0) \\cdot (0,0,-3) = 0\n$$\n\n**Face 2: vertices $(V_0, V_1, V_3)$**\nLet's order the vertices as $(\\boldsymbol{v}_1, \\boldsymbol{v}_2, \\boldsymbol{v}_3) = (V_0, V_3, V_1)$.\nThe initial oriented area vector $\\boldsymbol{S}_{f_2}'$ is:\n$$\n\\boldsymbol{S}_{f_2}' = \\frac{1}{2} ( (V_3 - V_0) \\times (V_1 - V_0) ) = \\frac{1}{2} ( (0,0,6) \\times (2,0,0) ) = \\frac{1}{2} (0,12,0) = (0,6,0)\n$$\nThe face centroid $\\boldsymbol{x}_{f_2}$ is:\n$$\n\\boldsymbol{x}_{f_2} = \\frac{1}{3} (V_0 + V_1 + V_3) = \\frac{1}{3} (2,0,6)\n$$\nCheck orientation:\n$$\n(0,6,0) \\cdot \\left( \\frac{1}{3}(2,0,6) - \\frac{1}{4}(2,3,6) \\right) = (0,6,0) \\cdot \\left( \\frac{2}{3} - \\frac{1}{2}, 0 - \\frac{3}{4}, 2 - \\frac{3}{2} \\right) = (0,6,0) \\cdot \\left( \\frac{1}{6}, -\\frac{3}{4}, \\frac{1}{2} \\right) = -4.5\n$$\nThe result is negative, so $\\boldsymbol{S}_{f_2} = -\\boldsymbol{S}_{f_2}' = (0,-6,0)$.\nThe velocity at the face centroid is $\\boldsymbol{u}(\\boldsymbol{x}_{f_2}) = (\\alpha \\frac{2}{3}, \\beta \\cdot 0, \\gamma \\cdot 2) = (1 \\cdot \\frac{2}{3}, 2 \\cdot 0, 2 \\cdot 2) = (\\frac{2}{3}, 0, 4)$.\nThe flux through face $f_2$ is:\n$$\n\\Phi_{f_2} = \\boldsymbol{u}(\\boldsymbol{x}_{f_2}) \\cdot \\boldsymbol{S}_{f_2} = (\\frac{2}{3}, 0, 4) \\cdot (0,-6,0) = 0\n$$\n\n**Face 3: vertices $(V_0, V_2, V_3)$**\nLet's order the vertices as $(\\boldsymbol{v}_1, \\boldsymbol{v}_2, \\boldsymbol{v}_3) = (V_0, V_2, V_3)$.\nThe initial oriented area vector $\\boldsymbol{S}_{f_3}'$ is:\n$$\n\\boldsymbol{S}_{f_3}' = \\frac{1}{2} ( (V_2 - V_0) \\times (V_3 - V_0) ) = \\frac{1}{2} ( (0,3,0) \\times (0,0,6) ) = \\frac{1}{2} (18,0,0) = (9,0,0)\n$$\nThe face centroid $\\boldsymbol{x}_{f_3}$ is:\n$$\n\\boldsymbol{x}_{f_3} = \\frac{1}{3} (V_0 + V_2 + V_3) = \\frac{1}{3} (0,3,6) = (0,1,2)\n$$\nCheck orientation:\n$$\n(9,0,0) \\cdot \\left( (0,1,2) - (0.5, 0.75, 1.5) \\right) = (9,0,0) \\cdot (-0.5, 0.25, 0.5) = -4.5\n$$\nThe result is negative, so $\\boldsymbol{S}_{f_3} = -\\boldsymbol{S}_{f_3}' = (-9,0,0)$.\nThe velocity at the face centroid is $\\boldsymbol{u}(\\boldsymbol{x}_{f_3}) = (\\alpha \\cdot 0, \\beta \\cdot 1, \\gamma \\cdot 2) = (1 \\cdot 0, 2 \\cdot 1, 2 \\cdot 2) = (0,2,4)$.\nThe flux through face $f_3$ is:\n$$\n\\Phi_{f_3} = \\boldsymbol{u}(\\boldsymbol{x}_{f_3}) \\cdot \\boldsymbol{S}_{f_3} = (0,2,4) \\cdot (-9,0,0) = 0\n$$\nThe fluxes through the three faces on the coordinate planes are zero because for each such face, the component of velocity normal to the face is zero everywhere on that face.\n\n**Face 4: vertices $(V_1, V_2, V_3)$**\nLet's order the vertices as $(\\boldsymbol{v}_1, \\boldsymbol{v}_2, \\boldsymbol{v}_3) = (V_1, V_2, V_3)$.\nThe initial oriented area vector $\\boldsymbol{S}_{f_4}'$ is:\n$$\n\\boldsymbol{S}_{f_4}' = \\frac{1}{2} ( (V_2 - V_1) \\times (V_3 - V_1) ) = \\frac{1}{2} ( (-2,3,0) \\times (-2,0,6) ) = \\frac{1}{2} (18,12,6) = (9,6,3)\n$$\nThe face centroid $\\boldsymbol{x}_{f_4}$ is:\n$$\n\\boldsymbol{x}_{f_4} = \\frac{1}{3} (V_1 + V_2 + V_3) = \\frac{1}{3} (2,3,6)\n$$\nCheck orientation:\n$$\n(9,6,3) \\cdot \\left( \\frac{1}{3}(2,3,6) - \\frac{1}{4}(2,3,6) \\right) = (9,6,3) \\cdot \\left( \\frac{1}{12}(2,3,6) \\right) = \\frac{1}{12} (18+18+18) = \\frac{54}{12} = 4.5\n$$\nThe result is positive, so the orientation is already outward: $\\boldsymbol{S}_{f_4} = \\boldsymbol{S}_{f_4}' = (9,6,3)$.\nThe velocity at the face centroid is $\\boldsymbol{u}(\\boldsymbol{x}_{f_4}) = (\\alpha \\frac{2}{3}, \\beta \\cdot 1, \\gamma \\cdot 2) = (1 \\cdot \\frac{2}{3}, 2 \\cdot 1, 2 \\cdot 2) = (\\frac{2}{3}, 2, 4)$.\nThe flux through face $f_4$ is:\n$$\n\\Phi_{f_4} = \\boldsymbol{u}(\\boldsymbol{x}_{f_4}) \\cdot \\boldsymbol{S}_{f_4} = (\\frac{2}{3}, 2, 4) \\cdot (9,6,3) = (\\frac{2}{3})(9) + (2)(6) + (4)(3) = 6 + 12 + 12 = 30\n$$\n\n**Total Net Flux**\nThe net outward volumetric flux is the sum of the fluxes through all four faces:\n$$\n\\Phi_{\\text{net}} = \\Phi_{f_1} + \\Phi_{f_2} + \\Phi_{f_3} + \\Phi_{f_4} = 0 + 0 + 0 + 30 = 30\n$$\nThe units are $\\mathrm{m}^3/\\mathrm{s}$. The problem asks to round to four significant figures, so the answer is $30.00\\,\\mathrm{m}^3/\\mathrm{s}$.\n\nAs a verification, we can use the divergence theorem. The exact net flux is the volume integral of the divergence of the velocity field:\n$$\n\\Phi_{\\text{net, exact}} = \\int_V (\\nabla \\cdot \\boldsymbol{u}) \\, dV\n$$\nThe divergence of $\\boldsymbol{u}$ is:\n$$\n\\nabla \\cdot \\boldsymbol{u} = \\frac{\\partial}{\\partial x}(\\alpha x) + \\frac{\\partial}{\\partial y}(\\beta y) + \\frac{\\partial}{\\partial z}(\\gamma z) = \\alpha + \\beta + \\gamma = 1 + 2 + 2 = 5\\,\\mathrm{s}^{-1}\n$$\nSince the divergence is constant, the flux is $(\\alpha + \\beta + \\gamma)$ times the volume of the tetrahedron, $\\mathcal{V}$:\n$$\n\\mathcal{V} = \\frac{1}{6} |(V_1-V_0) \\cdot ((V_2-V_0) \\times (V_3-V_0))| = \\frac{1}{6} |(2,0,0) \\cdot ((0,3,0) \\times (0,0,6))| = \\frac{1}{6} |(2,0,0) \\cdot (18,0,0)| = \\frac{36}{6} = 6\\,\\mathrm{m}^3\n$$\nThus, the exact flux is:\n$$\n\\Phi_{\\text{net, exact}} = (5\\,\\mathrm{s}^{-1}) \\times (6\\,\\mathrm{m}^3) = 30\\,\\mathrm{m}^3/\\mathrm{s}\n$$\nThe numerical method prescribed in the problem (midpoint rule for the face integral) is exact for a linear velocity field over a polygonal/polyhedral domain, hence our calculated result matches the exact analytical solution.\n\nFinal answer, rounded to four significant figures, is $30.00\\,\\mathrm{m}^3/\\mathrm{s}$.", "answer": "$$\\boxed{30.00}$$", "id": "3616607"}, {"introduction": "A numerical scheme for a conservation law rarely solves the original partial differential equation exactly; instead, it solves a \"modified\" equation that includes higher-order error terms which dictate the scheme's behavior. This practice [@problem_id:3616566] uses Taylor series analysis to derive the modified equation for the common Lax-Friedrichs scheme, revealing an artificial viscosity term that is responsible for numerically stabilizing and capturing shock waves. By connecting the numerical diffusion coefficient to grid resolution and shock thickness, you will gain a quantitative understanding of how dissipative schemes handle discontinuities, a vital concept in modeling phenomena like seismic waves or hydraulic jumps.", "problem": "Consider the scalar conservation law Partial Differential Equation (PDE) $u_{t} + f(u)_{x} = 0$ on a uniform one-dimensional mesh with spacing $\\Delta x$, discretized by the conservative Finite Volume (FV) method. Let $u_{i}(t)$ denote the cell average in cell $i$. The semi-discrete FV scheme reads\n$$\n\\frac{d u_{i}}{d t} = -\\frac{1}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right),\n$$\nwhere the numerical flux is the Global Lax–Friedrichs (GLF) flux\n$$\nF_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(f(u_{i}) + f(u_{i+1})\\right) - \\frac{1}{2}\\,\\alpha\\,(u_{i+1} - u_{i}),\n$$\nwith a constant $\\alpha \\ge \\sup_{u} |f'(u)|$, chosen to bound the characteristic speed globally. Assume $u(x,t)$ is smooth on scales of $\\Delta x$ so that Taylor expansions are valid.\n\n(a) Starting from the semi-discrete FV scheme and the GLF flux above, derive the leading-order spatial modified equation, i.e., the PDE that $u(x,t)$ solves up to $\\mathcal{O}(\\Delta x^{2})$ terms, and identify the coefficient $\\nu$ in the artificial viscosity term $\\nu\\,u_{xx}$.\n\n(b) Now specialize to the inviscid Burgers flux $f(u) = \\frac{1}{2}u^{2}$ and consider a single steady traveling shock connecting constant left and right states $u_{L}  u_{R}$, with jump magnitude $\\Delta u = u_{L} - u_{R}  0$. Using the viscous traveling-wave analysis of the modified equation in part (a), define the characteristic shock thickness $\\delta$ to be the inverse of the coefficient in the hyperbolic tangent argument of the steady viscous Burgers shock profile. Show that $\\delta$ scales linearly with the artificial viscosity coefficient and express $\\delta$ in terms of $\\nu$ and $\\Delta u$. Then, relate this thickness to the grid resolution by defining the number of grid cells spanning the shock as $N_{\\text{shock}} = \\delta/\\Delta x$, and express $N_{\\text{shock}}$ purely in terms of $\\alpha$ and $\\Delta u$.\n\nYour final answer must be the single closed-form analytical expression for $N_{\\text{shock}}$ in terms of $\\alpha$ and $\\Delta u$. No numerical evaluation is required. If you introduce any angular quantities, express them in radians. Do not include units in your final answer.", "solution": "The user wants me to solve a problem in two parts. First, I need to derive the modified equation for a finite volume scheme with a Global Lax-Friedrichs flux. Second, I need to apply this to the Burgers' equation to determine the number of grid cells that resolve a steady shock wave.\n\nThe problem is scientifically and mathematically well-posed, providing all necessary information and definitions for a rigorous derivation. It is a standard exercise in the numerical analysis of conservation laws. Thus, the problem is valid, and I will proceed with the solution.\n\n(a) Derivation of the leading-order spatial modified equation.\n\nWe start with the semi-discrete finite volume scheme given by\n$$\n\\frac{d u_{i}}{d t} = -\\frac{1}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right)\n$$\nwhere $u_i(t)$ is the cell average of the solution $u(x,t)$ in cell $i$, which is centered at $x_i$. For a smooth solution, $u_i(t) = u(x_i, t) + \\mathcal{O}(\\Delta x^2)$, and so $\\frac{du_i}{dt} = u_t(x_i, t) + \\mathcal{O}(\\Delta x^2)$. We denote $u(x_i, t)$ as $u_i$, its spatial derivatives as $u_x, u_{xx}$, etc., all evaluated at $x_i$. The flux $F_{i+1/2}$ is the Global Lax-Friedrichs flux:\n$$\nF_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(f(u_{i}) + f(u_{i+1})\\right) - \\frac{1}{2}\\,\\alpha\\,(u_{i+1} - u_{i})\n$$\nTo find the modified equation, we perform a Taylor series expansion of the right-hand side of the scheme around the point $x_i$. The right-hand side is\n$$\n-\\frac{1}{\\Delta x} \\left[ \\left(\\frac{1}{2}(f_i + f_{i+1}) - \\frac{\\alpha}{2}(u_{i+1} - u_i)\\right) - \\left(\\frac{1}{2}(f_{i-1} + f_i) - \\frac{\\alpha}{2}(u_i - u_{i-1})\\right) \\right]\n$$\n$$\n= -\\frac{1}{2\\Delta x}(f_{i+1} - f_{i-1}) + \\frac{\\alpha}{2\\Delta x}(u_{i+1} - 2u_i + u_{i-1})\n$$\nWe expand the terms $u_{i\\pm1}$ and $f_{i\\pm1} = f(u_{i\\pm1})$ around $x_i$:\n$$\nu_{i\\pm1} = u(x_i \\pm \\Delta x) = u_i \\pm \\Delta x u_x + \\frac{\\Delta x^2}{2} u_{xx} \\pm \\frac{\\Delta x^3}{6} u_{xxx} + \\mathcal{O}(\\Delta x^4)\n$$\nThe term $u_{i+1} - 2u_i + u_{i-1}$ is the standard second-order central difference approximation to $\\Delta x^2 u_{xx}$:\n$$\nu_{i+1} - 2u_i + u_{i-1} = \\Delta x^2 u_{xx} + \\mathcal{O}(\\Delta x^4)\n$$\nThe term $f_{i+1} - f_{i-1}$ is a central difference for the flux function $f(u)$.\nWe expand it as:\n$$\nf_{i+1} = f(u(x_i+\\Delta x)) = f(u_i) + \\Delta x (f(u))_x + \\frac{\\Delta x^2}{2} (f(u))_{xx} + \\mathcal{O}(\\Delta x^3)\n$$\n$$\nf_{i-1} = f(u(x_i-\\Delta x)) = f(u_i) - \\Delta x (f(u))_x + \\frac{\\Delta x^2}{2} (f(u))_{xx} - \\mathcal{O}(\\Delta x^3)\n$$\nSo, $f_{i+1} - f_{i-1} = 2\\Delta x (f(u))_x + \\mathcal{O}(\\Delta x^3) = 2\\Delta x f'(u)u_x + \\mathcal{O}(\\Delta x^3)$.\n\nSubstituting these expansions back into the right-hand side of the scheme:\n$$\n-\\frac{1}{2\\Delta x}(2\\Delta x f'(u)u_x + \\mathcal{O}(\\Delta x^3)) + \\frac{\\alpha}{2\\Delta x}(\\Delta x^2 u_{xx} + \\mathcal{O}(\\Delta x^4))\n$$\n$$\n= -f'(u)u_x + \\frac{\\alpha \\Delta x}{2} u_{xx} + \\mathcal{O}(\\Delta x^2)\n$$\nEquating the left-hand side ($u_t$) with this expression gives the modified equation:\n$$\nu_t = -f'(u)u_x + \\frac{\\alpha \\Delta x}{2} u_{xx}\n$$\nwhich can be rewritten as\n$$\nu_t + f(u)_x = \\frac{\\alpha \\Delta x}{2} u_{xx}\n$$\nThis is the leading-order spatial modified equation. The term on the right is an artificial viscosity term $\\nu u_{xx}$, with the coefficient of artificial viscosity given by\n$$\n\\nu = \\frac{\\alpha \\Delta x}{2}\n$$\n\n(b) Shock thickness for the inviscid Burgers' equation.\n\nWe specialize to the inviscid Burgers flux $f(u) = \\frac{1}{2}u^2$. The modified equation becomes the viscous Burgers' equation:\n$$\nu_t + u u_x = \\nu u_{xx}\n$$\nWe seek a steady traveling wave solution of the form $u(x,t) = U(\\xi)$, where $\\xi = x - st$ and $s$ is the constant wave speed. The partial derivatives become ordinary derivatives with respect to $\\xi$: $u_t = -sU'$ and $u_x = U'$. Substituting into the PDE, we get an ODE for the profile $U(\\xi)$:\n$$\n-sU' + UU' = \\nu U''\n$$\nWe integrate this equation once with respect to $\\xi$:\n$$\n-sU + \\frac{1}{2}U^2 = \\nu U' + C_1\n$$\nwhere $C_1$ is an integration constant. The shock connects a constant left state $u_L$ as $\\xi \\to -\\infty$ and a constant right state $u_R$ as $\\xi \\to +\\infty$. At these limits, the solution is constant, so its derivative $U'$ must be zero. Applying these boundary conditions:\nAs $\\xi \\to -\\infty$, $U \\to u_L$ and $U' \\to 0$, so $-su_L + \\frac{1}{2}u_L^2 = C_1$.\nAs $\\xi \\to +\\infty$, $U \\to u_R$ and $U' \\to 0$, so $-su_R + \\frac{1}{2}u_R^2 = C_1$.\nEquating the expressions for $C_1$ gives the Rankine-Hugoniot shock speed $s$:\n$$\n-su_L + \\frac{1}{2}u_L^2 = -su_R + \\frac{1}{2}u_R^2 \\implies s(u_L - u_R) = \\frac{1}{2}(u_L^2 - u_R^2) = \\frac{1}{2}(u_L - u_R)(u_L + u_R)\n$$\nSince $u_L \\ne u_R$, we find $s = \\frac{1}{2}(u_L + u_R)$.\n\nThe ODE for the profile is $\\nu U' = -sU + \\frac{1}{2}U^2 - C_1$. Factoring the quadratic on the right side:\n$$\n\\nu U' = \\frac{1}{2}(U^2 - 2sU - 2C_1) = \\frac{1}{2}(U^2 - (u_L+u_R)U + u_L u_R) = \\frac{1}{2}(U-u_L)(U-u_R)\n$$\nThis is a separable ODE. We solve it by separating variables, for $u_R  U  u_L$:\n$$\n\\frac{dU}{(U-u_L)(U-u_R)} = \\frac{1}{2\\nu} d\\xi\n$$\nUsing partial fraction decomposition, $\\frac{1}{(U-u_L)(U-u_R)} = \\frac{1}{u_L-u_R}\\left(\\frac{1}{U-u_L} - \\frac{1}{U-u_R}\\right)$, we integrate:\n$$\n\\frac{1}{u_L-u_R}\\int\\left(\\frac{1}{U-u_L} - \\frac{1}{U-u_R}\\right)dU = \\int\\frac{1}{2\\nu}d\\xi\n$$\n$$\n\\frac{1}{u_L-u_R}\\left(\\ln|U-u_L| - \\ln|U-u_R|\\right) = \\frac{\\xi}{2\\nu} + C_2 \\implies \\ln\\left(\\frac{u_L-U}{U-u_R}\\right) = \\frac{u_L-u_R}{2\\nu}\\xi + C_3\n$$\nSolving for $U$ and setting the origin $\\xi=0$ at $U = (u_L+u_R)/2$ to fix the integration constant, we arrive at the classic hyperbolic tangent profile:\n$$\nU(\\xi) = \\frac{u_L+u_R}{2} - \\frac{u_L-u_R}{2} \\tanh\\left(\\frac{u_L-u_R}{4\\nu}\\xi\\right)\n$$\nThe problem defines the characteristic shock thickness $\\delta$ as the inverse of the coefficient of $\\xi$ in the argument of the hyperbolic tangent. The coefficient is $\\frac{u_L-u_R}{4\\nu}$.\nTherefore, the shock thickness is\n$$\n\\delta = \\left( \\frac{u_L - u_R}{4\\nu} \\right)^{-1} = \\frac{4\\nu}{u_L - u_R}\n$$\nUsing the definition of the jump magnitude $\\Delta u = u_L - u_R$, we have $\\delta = \\frac{4\\nu}{\\Delta u}$. This shows that $\\delta$ scales linearly with $\\nu$.\n\nFinally, we relate this thickness to the grid resolution. The number of grid cells spanning the shock is defined as $N_{\\text{shock}} = \\delta/\\Delta x$. Substituting the expressions for $\\delta$ and $\\nu = \\frac{\\alpha\\Delta x}{2}$:\n$$\nN_{\\text{shock}} = \\frac{1}{\\Delta x} \\delta = \\frac{1}{\\Delta x} \\frac{4\\nu}{\\Delta u} = \\frac{1}{\\Delta x} \\frac{4}{\\Delta u} \\left(\\frac{\\alpha \\Delta x}{2}\\right)\n$$\nThe $\\Delta x$ terms cancel out, leaving:\n$$\nN_{\\text{shock}} = \\frac{2\\alpha}{\\Delta u}\n$$\nThis expression gives the number of grid cells within the shock purely in terms of the Global Lax-Friedrichs parameter $\\alpha$ and the shock jump magnitude $\\Delta u$.", "answer": "$$\n\\boxed{\\frac{2\\alpha}{\\Delta u}}\n$$", "id": "3616566"}, {"introduction": "Many geophysical systems, such as reactive contaminant transport, involve multiple physical processes with vastly different time scales, posing a significant challenge for numerical methods. This advanced practice [@problem_id:3616608] guides you through the design of a complete, high-order, positivity-preserving finite volume scheme for a stiff advection-reaction problem. You will use an Implicit-Explicit (IMEX) time-stepping strategy to handle the stiff reaction term efficiently while treating the advection term explicitly. Implementing this scheme provides hands-on experience with several state-of-the-art techniques—including MUSCL reconstruction, slope limiting, and operator splitting—that are essential for developing robust and accurate models of complex geophysical phenomena.", "problem": "Design and implement a one-dimensional finite volume method for a reactive transport conservation law with a stiff source term that is both positivity-preserving and of high order. Consider the scalar concentration field $c(x,t)$ in a periodic domain $[0,L]$ that satisfies the conservation law\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(u\\,c\\right) = R(c),\n$$\nwhere $u$ is a constant advection velocity and $R(c)$ is a source term modeling reaction. For this problem, take a linear relaxation source\n$$\nR(c) = k\\left(c_{\\mathrm{eq}} - c\\right),\n$$\nwhere $k0$ is a stiffness parameter (reaction rate) and $c_{\\mathrm{eq}}\\ge 0$ is an equilibrium concentration satisfying $R(c^\\ast)=0$ when $c^\\ast = c_{\\mathrm{eq}}$. The goal is to devise and implement an Implicit-Explicit (IMEX) scheme that is second order in time and uses a positivity-preserving high-order reconstruction in space for the advection term. Specifically:\n\n- Use a finite volume method with second-order spatial accuracy based on a limited linear reconstruction (e.g., Monotonic Upstream-centered Schemes for Conservation Laws (MUSCL) with a minmod slope limiter), and enforce positivity at the reconstructed interface states via a multiplicative scaling of slopes so that left and right interface states remain nonnegative whenever the cell average is nonnegative.\n- Use Implicit-Explicit time integration: treat the advection term explicitly with a Strong Stability Preserving Runge-Kutta second-order method (SSPRK2), and treat the stiff source term implicitly with backward Euler. To obtain second-order overall accuracy, employ Strang-type splitting (half-step implicit source, full-step explicit advection, half-step implicit source).\n- Ensure that the scheme preserves positivity of $c$ at all times provided the initial data are nonnegative and a Courant–Friedrichs–Lewy (CFL) time step restriction is satisfied for the explicit advection update, namely use $\\Delta t = \\mathrm{CFL}\\,\\Delta x/|u|$ with a fixed $\\mathrm{CFL}$ constant strictly less than $1$.\n- Demonstrate that equilibrium states satisfying $R(c^\\ast)=0$ are preserved exactly by the IMEX scheme, i.e., if $c(x,0)=c_{\\mathrm{eq}}$ is constant, then $c(x,t)=c_{\\mathrm{eq}}$ for all times by construction of the scheme.\n\nDiscretization details to implement:\n\n- Spatial grid: $N$ uniform finite volume cells covering $[0,L]$ with periodic boundary conditions. The cell averages $c_i^n$ approximate $\\frac{1}{\\Delta x}\\int_{x_{i-1/2}}^{x_{i+1/2}} c(x,t^n)\\,dx$, where $\\Delta x=L/N$ and $t^n$ is the $n$-th time.\n- Reconstruction: compute slopes with a minmod limiter and then scale each slope by a factor in $[0,1]$ so that the reconstructed left and right interface states in each cell are nonnegative when the cell average is nonnegative. The flux for advection should be an upwind flux consistent with the sign of $u$ evaluated at the reconstructed interface states.\n- Time integration: perform a Strang splitting step per time step of size $\\Delta t$, consisting of\n  1. An implicit backward Euler half-step for the source term over $\\Delta t/2$,\n  2. An explicit SSPRK2 full-step for the advection term over $\\Delta t$,\n  3. An implicit backward Euler half-step for the source term over $\\Delta t/2$.\n  For the specified linear relaxation source $R(c)=k(c_{\\mathrm{eq}}-c)$, the backward Euler update at each half-step should be solved exactly. The advection step should use the positivity-preserving limited reconstruction and upwind fluxes.\n\nUnits:\n\n- $x$ in meters ($\\mathrm{m}$),\n- $t$ in seconds ($\\mathrm{s}$),\n- $u$ in meters per second ($\\mathrm{m/s}$),\n- $c$ and $c_{\\mathrm{eq}}$ in moles per cubic meter ($\\mathrm{mol/m^3}$),\n- $k$ in inverse seconds ($\\mathrm{s^{-1}}$).\n\nYour program should implement the above scheme and run the following test suite. For each test case, simulate until the final time $T$ with a time step determined by $\\Delta t = \\mathrm{CFL}\\,\\Delta x/|u|$ where $\\mathrm{CFL}=0.45$. Use periodic boundary conditions. For each test, return the requested quantitative measure.\n\nTest suite:\n\n1. Happy path positivity under stiff relaxation:\n   - Parameters: $L=1\\,\\mathrm{m}$, $N=200$, $u=0.5\\,\\mathrm{m/s}$, $k=1000\\,\\mathrm{s^{-1}}$, $c_{\\mathrm{eq}}=1.0\\,\\mathrm{mol/m^3}$, $T=0.1\\,\\mathrm{s}$.\n   - Initial condition: $c(x,0)=0.5+0.5\\sin(2\\pi x/L)\\,\\mathrm{mol/m^3}$.\n   - Output: the minimum of $c(x,T)$ over the domain, expressed in $\\mathrm{mol/m^3}$ as a floating-point number.\n\n2. Exact preservation of equilibrium state:\n   - Parameters: $L=1\\,\\mathrm{m}$, $N=100$, $u=1.0\\,\\mathrm{m/s}$, $k=10^6\\,\\mathrm{s^{-1}}$, $c_{\\mathrm{eq}}=0.3\\,\\mathrm{mol/m^3}$, $T=0.05\\,\\mathrm{s}$.\n   - Initial condition: $c(x,0)=c_{\\mathrm{eq}}$ (constant).\n   - Output: $\\max_{x}|c(x,T)-c_{\\mathrm{eq}}|$ in $\\mathrm{mol/m^3}$ as a floating-point number.\n\n3. Edge case near zero concentration:\n   - Parameters: $L=1\\,\\mathrm{m}$, $N=200$, $u=0.2\\,\\mathrm{m/s}$, $k=500\\,\\mathrm{s^{-1}}$, $c_{\\mathrm{eq}}=0.0\\,\\mathrm{mol/m^3}$, $T=0.05\\,\\mathrm{s}$.\n   - Initial condition: $c(x,0)=10^{-12}+10^{-3}\\exp\\left(-\\frac{(x-0.5L)^2}{(0.05L)^2}\\right)\\,\\mathrm{mol/m^3}$.\n   - Output: the minimum of $c(x,T)$ over the domain, expressed in $\\mathrm{mol/m^3}$ as a floating-point number.\n\n4. Strong advection with triangular initial profile:\n   - Parameters: $L=1\\,\\mathrm{m}$, $N=150$, $u=2.0\\,\\mathrm{m/s}$, $k=1000\\,\\mathrm{s^{-1}}$, $c_{\\mathrm{eq}}=0.5\\,\\mathrm{mol/m^3}$, $T=0.02\\,\\mathrm{s}$.\n   - Initial condition: $c(x,0)=\\max\\left(0, 1 - 2\\left|\\frac{x}{L}-0.5\\right|\\right)\\,\\mathrm{mol/m^3}$ (a unit-amplitude triangle centered at $x=L/2$).\n   - Output: the minimum of $c(x,T)$ over the domain, expressed in $\\mathrm{mol/m^3}$ as a floating-point number.\n\nFinal output format:\n\n- Your program should produce a single line of output containing the results for the four test cases as a comma-separated list of floating-point numbers enclosed in square brackets, for example $[r_1,r_2,r_3,r_4]$, where each $r_i$ is the case-specific output defined above. No additional text should be printed.", "solution": "The problem requires the design and implementation of a one-dimensional finite volume scheme for a scalar reactive transport equation. The scheme must be second-order accurate, positivity-preserving, and employ an Implicit-Explicit (IMEX) time integration strategy suitable for stiff source terms. The problem is well-posed, scientifically sound, and provides sufficient detail for a unique implementation.\n\nThe governing conservation law is:\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(u\\,c\\right) = R(c)\n$$\nwhere $c(x,t)$ is the concentration, $u$ is a constant advection velocity, and $R(c) = k(c_{\\mathrm{eq}} - c)$ is a linear relaxation source term. The stiffness is controlled by the rate $k  0$, and the equilibrium state is $c_{\\mathrm{eq}} \\ge 0$.\n\nThe overall numerical method is constructed using operator splitting, specifically Strang splitting, which is a second-order accurate technique. This method decouples the advection and reaction processes. A single time step from $t^n$ to $t^{n+1} = t^n + \\Delta t$ is computed as:\n$$\nc^{n+1} = \\mathcal{L}_{\\mathcal{S}}^{\\Delta t/2} \\circ \\mathcal{L}_{\\mathcal{A}}^{\\Delta t} \\circ \\mathcal{L}_{\\mathcal{S}}^{\\Delta t/2} (c^n)\n$$\nwhere $\\mathcal{L}_{\\mathcal{S}}^{\\tau}$ is the operator that solves the reaction equation $\\frac{\\partial c}{\\partial t} = R(c)$ for a time duration $\\tau$, and $\\mathcal{L}_{\\mathcal{A}}^{\\tau}$ is the operator that solves the advection equation $\\frac{\\partial c}{\\partial t} + \\frac{\\partial (uc)}{\\partial x} = 0$ for a time duration $\\tau$.\n\n1.  **Implicit Source Step ($\\mathcal{L}_{\\mathcal{S}}^{\\Delta t/2}$)**\n    The reaction term is stiff, which necessitates an implicit time integration method to avoid prohibitively small time steps. The backward Euler method is used as specified. For the equation $\\frac{dc_i}{dt} = k(c_{\\mathrm{eq}} - c_i)$, the update over a time step $\\Delta \\tau$ from $c_i^{\\text{in}}$ to $c_i^{\\text{out}}$ is:\n    $$\n    \\frac{c_i^{\\text{out}} - c_i^{\\text{in}}}{\\Delta \\tau} = k(c_{\\mathrm{eq}} - c_i^{\\text{out}})\n    $$\n    This is a linear equation for $c_i^{\\text{out}}$, which can be solved exactly:\n    $$\n    c_i^{\\text{out}} (1 + k \\Delta \\tau) = c_i^{\\text{in}} + k \\Delta \\tau c_{\\mathrm{eq}} \\quad \\implies \\quad c_i^{\\text{out}} = \\frac{c_i^{\\text{in}} + k \\Delta \\tau c_{\\mathrm{eq}}}{1 + k \\Delta \\tau}\n    $$\n    This update is applied for $\\Delta \\tau = \\Delta t/2$. If $c_i^{\\text{in}} \\ge 0$, and given $k, \\Delta \\tau, c_{\\mathrm{eq}} \\ge 0$, it is clear that $c_i^{\\text{out}} \\ge 0$. Thus, this step is unconditionally positivity-preserving.\n\n2.  **Explicit Advection Step ($\\mathcal{L}_{\\mathcal{A}}^{\\Delta t}$)**\n    The advection part is handled by a finite volume method on a uniform grid of $N$ cells of width $\\Delta x = L/N$. The cell-averaged concentration in cell $i$ is denoted by $c_i$. The semi-discrete form of the advection equation is:\n    $$\n    \\frac{dc_i}{dt} = -\\frac{1}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n    $$\n    where $F_{i+1/2}$ is the numerical flux at the interface between cell $i$ and cell $i+1$. To achieve second-order spatial accuracy, a MUSCL-type reconstruction is used.\n\n    *   **Piecewise Linear Reconstruction:** Within each cell $i$, the solution is reconstructed as a linear function:\n        $$\n        p_i(x) = c_i + \\frac{\\sigma_i}{\\Delta x} (x - x_i)\n        $$\n        where $x_i$ is the cell center and $\\sigma_i$ is the slope (as a difference in concentration over the cell). The values at the cell interfaces $x_{i \\pm 1/2}$ are then:\n        $$\n        c_{i-1/2, R} = c_i - \\frac{\\sigma_i}{2}, \\quad c_{i+1/2, L} = c_i + \\frac{\\sigma_i}{2}\n        $$\n\n    *   **Slope Limiting (minmod):** To prevent spurious oscillations, the slope $\\sigma_i$ is limited. It is computed using the minmod function applied to the forward and backward differences:\n        $$\n        \\sigma_i^{\\text{orig}} = \\text{minmod}(c_{i+1} - c_i, c_i - c_{i-1})\n        $$\n        where the minmod function is defined as:\n        $$\n        \\text{minmod}(a, b) = \\begin{cases} \\text{sgn}(a) \\min(|a|, |b|)  \\text{if } ab  0 \\\\ 0  \\text{otherwise} \\end{cases}\n        $$\n        Periodic boundary conditions are used to find neighboring values for cells $i=0$ and $i=N-1$.\n\n    *   **Positivity-Preserving Slope Scaling:** To ensure the reconstructed interface values are non-negative, the slope $\\sigma_i^{\\text{orig}}$ is scaled by a factor $\\theta_i \\in [0, 1]$. We require $c_i \\pm \\sigma_i/2 \\ge 0$ whenever $c_i \\ge 0$. This is equivalent to $|\\sigma_i| \\le 2c_i$. The scaled slope is $\\sigma_i = \\theta_i \\sigma_i^{\\text{orig}}$, where the scaling factor is chosen to be maximal while satisfying the constraint:\n        $$\n        \\theta_i = \\min\\left(1, \\frac{2c_i}{|\\sigma_i^{\\text{orig}}|}\\right)\n        $$\n        This scaling is applied only if $|\\sigma_i^{\\text{orig}}|  0$ and $c_i \\ge 0$.\n\n    *   **Upwind Flux:** The numerical flux is an upwind flux evaluated at the reconstructed interface states.\n        $$\n        F_{i+1/2} = u^+ c_{i+1/2, L} + u^- c_{i+1/2, R}\n        $$\n        where $u^+ = \\max(u, 0)$ and $u^- = \\min(u, 0)$. Note that $c_{i+1/2, R}$ is computed from data in cell $i+1$.\n\n    *   **SSPRK2 Time Integration:** The semi-discrete system is advanced in time using the second-order Strong Stability Preserving Runge-Kutta (SSPRK2) method. Denoting the right-hand side of the semi-discrete system as $\\mathcal{A}(c)_i$, the update from $c^{\\text{in}}$ to $c^{\\text{out}}$ over $\\Delta t$ is:\n        $$\n        \\begin{aligned}\n        c^* = c^{\\text{in}} + \\Delta t \\, \\mathcal{A}(c^{\\text{in}}) \\\\\n        c^{\\text{out}} = \\frac{1}{2}c^{\\text{in}} + \\frac{1}{2}\\left(c^* + \\Delta t \\, \\mathcal{A}(c^*)\\right)\n        \\end{aligned}\n        $$\n        This method is positivity-preserving for the advection equation under the CFL condition $|u|\\Delta t / \\Delta x \\le 1/2$. The specified CFL constraint of $0.45$ satisfies this.\n\n3.  **Equilibrium Preservation**\n    The scheme must preserve constant equilibrium states, i.e., if $c_i^n = c_{\\mathrm{eq}}$ for all $i$, then $c_i^{n+1} = c_{\\mathrm{eq}}$.\n    *   **First Source Step:** With $c_i^{\\text{in}} = c_{\\mathrm{eq}}$, the update gives $c_i^{\\text{out}} = \\frac{c_{\\mathrm{eq}} + k(\\Delta t/2)c_{\\mathrm{eq}}}{1 + k(\\Delta t/2)} = c_{\\mathrm{eq}}$.\n    *   **Advection Step:** The input is a constant field $c_i = c_{\\mathrm{eq}}$. The forward and backward differences are zero, so the minmod limiter yields zero slopes, $\\sigma_i=0$. The reconstruction is flat, $p_i(x) = c_{\\mathrm{eq}}$. The interface fluxes are all $F_{i\\pm 1/2} = u c_{\\mathrm{eq}}$. The RHS is $\\mathcal{A}(c)_i = -\\frac{1}{\\Delta x}(u c_{\\mathrm{eq}} - u c_{\\mathrm{eq}}) = 0$. The SSPRK2 method, when applied with a zero RHS, results in no change to the solution.\n    *   **Second Source Step:** Similar to the first step, this step also preserves the constant state $c_{\\mathrm{eq}}$.\n    Therefore, the entire Strang splitting scheme is proven to preserve constant equilibrium states exactly.\n\nThe combination of these components provides a complete numerical method that meets all requirements of the problem statement.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the specified test cases and print the results.\n    \"\"\"\n\n    def minmod(a, b):\n        \"\"\"\n        Element-wise minmod function for two numpy arrays.\n        \"\"\"\n        out = np.zeros_like(a, dtype=float)\n        mask = (a * b) > 0\n        signs = np.sign(a)\n        out[mask] = signs[mask] * np.minimum(np.abs(a[mask]), np.abs(b[mask]))\n        return out\n\n    def calculate_rhs_adv(c, u, dx):\n        \"\"\"\n        Calculates the right-hand side of the semi-discrete advection equation\n        using a positivity-preserving MUSCL scheme with a minmod limiter.\n        \"\"\"\n        # Periodic boundary conditions for neighbors\n        c_im1 = np.roll(c, 1)\n        c_ip1 = np.roll(c, -1)\n\n        # 1. Slope calculation with minmod limiter\n        delta_plus = c_ip1 - c\n        delta_minus = c - c_im1\n        slopes_orig = minmod(delta_plus, delta_minus)\n\n        # 2. Positivity-preserving slope scaling\n        slopes = np.copy(slopes_orig)\n        abs_slopes = np.abs(slopes_orig)\n        # Avoid division by zero or scaling very small numbers\n        mask = (c > 1e-15)  (abs_slopes > 1e-15)\n        \n        if np.any(mask):\n            theta = np.minimum(1.0, 2.0 * c[mask] / abs_slopes[mask])\n            slopes[mask] *= theta\n            \n        # Ensure slopes for cells with c=0 are zero\n        slopes[c = 1e-15] = 0.0\n\n        # 3. Reconstruction at interfaces\n        # c_L[i] is the left state at interface i+1/2 (from cell i)\n        # c_R[i] is the right state at interface i-1/2 (from cell i)\n        c_L = c + slopes / 2.0\n        c_R = c - slopes / 2.0\n\n        # 4. Upwind flux calculation\n        u_plus = max(u, 0.0)\n        u_minus = min(u, 0.0)\n        \n        # c_R_ip1 is the right state at interface i+1/2 (from cell i+1)\n        c_R_ip1 = np.roll(c_R, -1)\n        fluxes = u_plus * c_L + u_minus * c_R_ip1\n\n        # 5. Divergence calculation\n        fluxes_im12 = np.roll(fluxes, 1)\n        rhs = -(fluxes - fluxes_im12) / dx\n        return rhs\n\n    def advection_step(c_in, dt, u, dx):\n        \"\"\"\n        Performs one full advection step over dt using SSPRK2.\n        \"\"\"\n        # SSPRK2 Stage 1\n        rhs1 = calculate_rhs_adv(c_in, u, dx)\n        c_star = c_in + dt * rhs1\n\n        # SSPRK2 Stage 2\n        rhs2 = calculate_rhs_adv(c_star, u, dx)\n        c_out = 0.5 * c_in + 0.5 * (c_star + dt * rhs2)\n        \n        # Enforce positivity due to potential floating point errors\n        c_out[c_out  0] = 0.0\n        return c_out\n\n    def source_step(c_in, dt_source, k, c_eq):\n        \"\"\"\n        Performs one implicit source step over dt_source using backward Euler.\n        \"\"\"\n        c_out = (c_in + k * dt_source * c_eq) / (1.0 + k * dt_source)\n        return c_out\n\n    def strang_split_step(c_n, dt, u, dx, k, c_eq):\n        \"\"\"\n        Performs one full time step using Strang splitting.\n        \"\"\"\n        # Half step for the source term\n        c_1 = source_step(c_n, dt / 2.0, k, c_eq)\n        # Full step for the advection term\n        c_2 = advection_step(c_1, dt, u, dx)\n        # Another half step for the source term\n        c_np1 = source_step(c_2, dt / 2.0, k, c_eq)\n        return c_np1\n\n    def run_simulation(params):\n        \"\"\"\n        Runs a simulation for a given set of parameters.\n        \"\"\"\n        L = params['L']\n        N = params['N']\n        u = params['u']\n        k = params['k']\n        c_eq = params['c_eq']\n        T = params['T']\n        ic_func = params['ic_func']\n        output_metric = params['output_metric']\n        CFL = 0.45\n\n        # Spatial grid\n        dx = L / N\n        x = np.linspace(0, L, N, endpoint=False) + dx / 2.0\n\n        # Time stepping\n        if abs(u) > 1e-12:\n            dt = CFL * dx / abs(u)\n        else: # If u is zero, advection step is trivial. Set a reasonable dt.\n            dt = T / 10.0 \n\n        # Initial condition\n        c = ic_func(x, L, c_eq)\n\n        # Main time loop\n        t = 0.0\n        while t  T:\n            dt_actual = min(dt, T - t)\n            c = strang_split_step(c, dt_actual, u, dx, k, c_eq)\n            t += dt_actual\n        \n        # Post-processing to get the required output\n        if output_metric == 'min':\n            return np.min(c)\n        elif output_metric == 'max_abs_err':\n            return np.max(np.abs(c - c_eq))\n        \n        return None\n\n\n    test_cases = [\n        {\n            'L': 1.0, 'N': 200, 'u': 0.5, 'k': 1000.0, 'c_eq': 1.0, 'T': 0.1,\n            'ic_func': lambda x, L, c_eq: 0.5 + 0.5 * np.sin(2 * np.pi * x / L),\n            'output_metric': 'min'\n        },\n        {\n            'L': 1.0, 'N': 100, 'u': 1.0, 'k': 1e6, 'c_eq': 0.3, 'T': 0.05,\n            'ic_func': lambda x, L, c_eq: np.full_like(x, c_eq),\n            'output_metric': 'max_abs_err'\n        },\n        {\n            'L': 1.0, 'N': 200, 'u': 0.2, 'k': 500.0, 'c_eq': 0.0, 'T': 0.05,\n            'ic_func': lambda x, L, c_eq: 1e-12 + 1e-3 * np.exp(-((x - 0.5 * L)**2) / ((0.05 * L)**2)),\n            'output_metric': 'min'\n        },\n        {\n            'L': 1.0, 'N': 150, 'u': 2.0, 'k': 1000.0, 'c_eq': 0.5, 'T': 0.02,\n            'ic_func': lambda x, L, c_eq: np.maximum(0.0, 1.0 - 2.0 * np.abs(x / L - 0.5)),\n            'output_metric': 'min'\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        result = run_simulation(params)\n        results.append(result)\n\n    print(f\"[{','.join(f'{r:.15g}' for r in results)}]\")\n\nsolve()\n```", "id": "3616608"}]}