{"hands_on_practices": [{"introduction": "In an ideal world, we could solve all coupled physics simultaneously. In practice, operator splitting discretizes the problem by solving for each physical process sequentially. A fundamental question immediately arises: does the order of operations matter? This exercise explores this question in a dramatic context of chemo-mechanical failure. By simulating a material whose strength and stiffness are degraded by a diffusing chemical [@problem_id:3519243], you will directly observe how the first-order splitting error, arising from the non-commutativity of the physics operators, can lead to different predictions for the time of fracture. This practice provides a tangible lesson on the importance of operator ordering and motivates the use of higher-order symmetric splitting schemes.", "problem": "Consider a one-dimensional bar occupying the spatial interval $[0,L]$ with a concentration field $c(x,t)$ of a diffusing reactant and a displacement field $u(x,t)$ of a small-strain linear elastic solid. The chemo-mechanical coupling is such that the elastic modulus depends on concentration via $E(c)=E_0\\,(1-\\alpha\\,c)$, and the tensile strength depends on concentration via $\\sigma_c(c)=\\sigma_0\\,(1-\\beta\\,c)$. The diffusion step is denoted by operator $A$, and the mechanical equilibrium step is denoted by operator $B$. Your task is to assess ordering sensitivity of a Lie-type operator splitting scheme by comparing the onset time of fracture predicted by ordering $AB$ versus $BA$ for specific parameter sets.\n\nStart from the following fundamental base:\n- Diffusion is governed by Fick's Second Law (which follows from Fick's First Law together with conservation of mass): $\\partial_t c = D\\,\\partial_{xx} c$, where $D$ is the diffusivity, with boundary conditions $c(0,t)=c_{\\text{inlet}}$ and $c(L,t)=0$, and initial condition $c(x,0)=0$.\n- Small-strain linear elasticity for a one-dimensional bar under quasi-static loading enforces force balance (no body forces) as $\\partial_x \\sigma = 0$, so the Cauchy stress $\\sigma$ is spatially constant at each time. Displacement boundary conditions are $u(0,t)=0$ and $u(L,t)=U(t)$, with a monotonically increasing ramp $U(t)=\\dot{U}\\,t$. Compatibility yields $\\int_0^L \\varepsilon(x,t)\\,dx = U(t)$, with $\\varepsilon=\\partial_x u$. The linear constitutive relation is $\\sigma(x,t) = E(c(x,t))\\,\\varepsilon(x,t)$.\n- Using force balance (constant $\\sigma$) and compatibility, derive from first principles that the global stress under displacement control is\n$$\n\\sigma(t) \\;=\\; \\frac{U(t)}{\\displaystyle \\int_0^L \\frac{dx}{E(c(x,t))}}.\n$$\n- Fracture onset is defined by the path-dependent criterion\n$$\n\\sigma(t) \\;\\ge\\; \\min_{x\\in[0,L]} \\sigma_c(c(x,t)).\n$$\n\nDefine two first-order Lie splittings over a time step $\\Delta t$:\n- Ordering $AB$: First advance diffusion for one time step to new time $t^{n+1}$ to obtain $c^{n+1}(x)$, then evaluate mechanics at $t^{n+1}$ with $U^{n+1} = \\dot{U}\\,t^{n+1}$ and $c^{n+1}(x)$ to compute $\\sigma^{n+1}$ and check fracture using $\\min_x \\sigma_c(c^{n+1}(x))$.\n- Ordering $BA$: First evaluate mechanics at $t^{n+1}$ with $U^{n+1}=\\dot{U}\\,t^{n+1}$ but using $c^n(x)$, compute $\\sigma^{n+1}$ and check fracture using $\\min_x \\sigma_c(c^n(x))$, then advance diffusion from $t^n$ to $t^{n+1}$.\n\nImplement the diffusion step numerically by an explicit finite difference method on a uniform grid with $N$ nodes over $[0,L]$, grid spacing $\\Delta x = L/(N-1)$, and forward Euler time stepping:\n$$\nc_i^{n+1} \\;=\\; c_i^n \\;+\\; D\\,\\frac{\\Delta t}{(\\Delta x)^2}\\,\\big(c_{i-1}^n - 2c_i^n + c_{i+1}^n\\big),\n$$\nfor interior nodes $i=2,\\dots,N-1$, imposing Dirichlet boundary conditions $c_1^n = c_{\\text{inlet}}$ and $c_N^n=0$ for all $n$. Ensure scientific realism by using $0 \\le c \\le 1$ and parameters such that $E(c)0$. Use the explicit scheme with the specified $\\Delta t$; do not alter the time step.\n\nImplement the mechanical step by evaluating\n$$\nE_i^n \\;=\\; E_0\\,(1-\\alpha\\,c_i^n),\\quad\n\\Big(\\int_0^L \\frac{dx}{E(c)}\\Big)^n \\;\\approx\\; \\sum_{i=1}^{N} \\frac{\\Delta x}{E_i^n},\\quad\n\\sigma^{n+1} \\;=\\; \\frac{U^{n+1}}{\\sum_{i=1}^{N} \\frac{\\Delta x}{E_i^{\\star}}},\n$$\nwhere for ordering $AB$ use $E_i^{\\star}=E_0(1-\\alpha c_i^{n+1})$, and for ordering $BA$ use $E_i^{\\star}=E_0(1-\\alpha c_i^n)$. Evaluate the fracture threshold as\n$$\n\\sigma_{\\min}^{\\text{th},\\,AB} = \\min_i \\big[\\sigma_0(1-\\beta\\,c_i^{n+1})\\big],\\qquad\n\\sigma_{\\min}^{\\text{th},\\,BA} = \\min_i \\big[\\sigma_0(1-\\beta\\,c_i^{n})\\big].\n$$\nTrigger fracture at the earliest time step $n$ for which $\\sigma^{n+1} \\ge \\sigma_{\\min}^{\\text{th}}$ for the respective ordering. If no fracture occurs by the final time $T_{\\max}$, report no fracture.\n\nNumerical implementation requirements:\n- Use a uniform grid with $N$ nodes.\n- Initialize $c_i^0=0$ for all nodes.\n- Enforce $c_1^n = c_{\\text{inlet}}$ and $c_N^n=0$ at every time step.\n- Use $U(t)=\\dot{U}\\,t$ with $\\dot{U}$ specified. Use the same $\\Delta t$ for both $AB$ and $BA$ comparisons.\n- For numerical robustness, if needed, clamp $E(c)$ from below by a small positive floor to avoid division by zero, but ensure that model parameters satisfy $1-\\alpha c  0$ for all $c \\in [0,1]$ so that the floor is not active in normal operation.\n\nTest suite:\nRun your program for the following parameter sets (all in International System of Units (SI)):\n- Case $1$ (general coupled case):\n  - $L=1.0$, $N=101$, $D=1.0\\times 10^{-4}$, $\\Delta t=0.05$, $T_{\\max}=10.0$, $E_0=1.0\\times 10^{11}$, $\\alpha=0.5$, $\\sigma_0=1.0\\times 10^{9}$, $\\beta=0.8$, $c_{\\text{inlet}}=1.0$, $\\dot{U}=1.0\\times 10^{-3}$.\n- Case $2$ (no diffusion edge case):\n  - $L=1.0$, $N=101$, $D=0.0$, $\\Delta t=0.05$, $T_{\\max}=10.0$, $E_0=1.0\\times 10^{11}$, $\\alpha=0.5$, $\\sigma_0=1.0\\times 10^{9}$, $\\beta=0.8$, $c_{\\text{inlet}}=1.0$, $\\dot{U}=1.0\\times 10^{-3}$.\n- Case $3$ (strong strength sensitivity and faster diffusion):\n  - $L=1.0$, $N=101$, $D=5.0\\times 10^{-4}$, $\\Delta t=0.05$, $T_{\\max}=10.0$, $E_0=1.0\\times 10^{11}$, $\\alpha=0.7$, $\\sigma_0=1.0\\times 10^{9}$, $\\beta=1.2$, $c_{\\text{inlet}}=1.0$, $\\dot{U}=1.0\\times 10^{-3}$.\n- Case $4$ (low load rate, likely no fracture within horizon):\n  - $L=1.0$, $N=101$, $D=1.0\\times 10^{-4}$, $\\Delta t=0.05$, $T_{\\max}=5.0$, $E_0=1.0\\times 10^{11}$, $\\alpha=0.3$, $\\sigma_0=1.0\\times 10^{9}$, $\\beta=0.2$, $c_{\\text{inlet}}=1.0$, $\\dot{U}=2.0\\times 10^{-4}$.\n\nFor each case, compute:\n- The earliest fracture onset time under ordering $AB$ in seconds.\n- The earliest fracture onset time under ordering $BA$ in seconds.\n- The difference $\\Delta t_{\\text{fract}} = t_{\\text{fract}}^{BA} - t_{\\text{fract}}^{AB}$ in seconds if both fracture times are finite; otherwise, set $\\Delta t_{\\text{fract}}=-1.0$.\n\nIf no fracture occurs by $T_{\\max}$ for an ordering, report the corresponding time as $-1.0$ seconds.\n\nYour program should produce a single line of output containing the results for the four cases as a comma-separated list of lists enclosed in square brackets, with each inner list being $[t_{AB}, t_{BA}, \\Delta t_{\\text{fract}}]$ expressed in seconds as floating-point numbers. For example: $[[1.234000,1.280000,0.046000],[\\dots],\\dots]$.", "solution": "The problem statement is evaluated to be valid. It is scientifically grounded, well-posed, objective, and internally consistent. The physical model, while simplified, is based on established principles of continuum mechanics and transport phenomena. Fick's Second Law for diffusion and linear elasticity for mechanical response are standard models. The chemo-mechanical coupling, where the elastic modulus $E$ and tensile strength $\\sigma_c$ depend on a concentration field $c$, represents a valid and common scenario in multiphysics modeling. The derivation of the stress expression $\\sigma(t)$ is correct, arising directly from the 1D quasi-static force balance ($\\partial_x \\sigma = 0$) and kinematic compatibility ($\\int_0^L \\varepsilon(x,t)\\,dx = U(t)$). The numerical scheme, based on an explicit finite difference method for diffusion and a Lie-type operator splitting for the coupling, is a standard approach. All parameters, boundary conditions, and initial conditions are fully specified for each test case, making the problem solvable. The stability of the specified explicit diffusion scheme, defined by the Courant-Friedrichs-Lewy (CFL) condition $D\\Delta t/(\\Delta x)^2 \\le 0.5$, is satisfied for all test cases, ensuring the numerical simulation will not suffer from unphysical oscillations. The problem is a well-defined exercise in implementing and comparing operator splitting schemes for a coupled multiphysics system.\n\nThe core of the task is to implement a time-stepping simulation to solve for the evolution of the concentration field $c(x,t)$ and, at each step, to evaluate the mechanical stress $\\sigma(t)$ and check for fracture. This process is performed for two different operator splitting schemes, denoted $AB$ and $BA$.\n\nLet the state of the system at time $t^n = n\\,\\Delta t$ be represented by the discrete concentration field $c^n = \\{c_i^n\\}_{i=1}^N$. The goal is to find the state at the next time step, $t^{n+1}$.\n\nFirst, we define the operators.\n- Operator $A$: This operator advances the diffusion equation $\\partial_t c = D\\,\\partial_{xx} c$ over a single time step $\\Delta t$. Using the provided explicit forward Euler in time and second-order central difference in space discretization, the update for the interior nodes is:\n$$\nc_i^{n+1} = c_i^n + \\frac{D\\,\\Delta t}{(\\Delta x)^2} (c_{i-1}^n - 2c_i^n + c_{i+1}^n) \\quad \\text{for } i=2, \\dots, N-1\n$$\nThe Dirichlet boundary conditions are enforced as $c_1^{n+1} = c_{\\text{inlet}}$ and $c_N^{n+1} = 0$.\n- Operator $B$: This operator performs the quasi-static mechanical analysis and checks for fracture. It takes a concentration field $c(x)$ and an applied displacement $U(t)$ to compute the stress $\\sigma(t)$ and the fracture threshold $\\sigma_{\\min}^{\\text{th}}$.\nThe stress is computed as:\n$$\n\\sigma(t) = \\frac{U(t)}{\\displaystyle \\int_0^L \\frac{dx}{E(c(x,t))}} \\approx \\frac{U(t)}{\\displaystyle \\sum_{i=1}^{N} \\frac{\\Delta x}{E_0(1-\\alpha\\,c_i)}}\n$$\nThe fracture criterion is checked by comparing this stress to the minimum tensile strength in the bar:\n$$\n\\sigma(t) \\ge \\min_{x \\in [0,L]} \\sigma_c(c(x,t)) \\approx \\min_{i} \\left[ \\sigma_0(1-\\beta\\,c_i) \\right]\n$$\n\nThe two Lie splitting schemes differ in the order these operators are applied within a time step from $t^n$ to $t^{n+1}$:\n\n**1. Ordering $AB$ (Diffusion-Mechanics)**\n\nFor each time step, starting with the concentration field $c^n$:\n1.  **Apply Operator A (Diffusion):** An intermediate concentration field, let us call it $c^{n+1}$, is computed by applying the diffusion operator to $c^n$. This represents the state after diffusion over the interval $[t^n, t^{n+1}]$.\n    $$\n    c^{n+1} = A(c^n)\n    $$\n2.  **Apply Operator B (Mechanics):** The mechanical response is evaluated at the new time $t^{n+1}$. Crucially, this evaluation uses the just-computed concentration field $c^{n+1}$ and the displacement at the new time, $U^{n+1} = \\dot{U}\\,t^{n+1}$.\n    - The stress is calculated as $\\sigma_{AB}^{n+1} = \\frac{U^{n+1}}{\\sum_{i=1}^{N} \\frac{\\Delta x}{E_0(1-\\alpha\\,c_i^{n+1})}}$.\n    - The fracture threshold is $\\sigma_{\\min, AB}^{\\text{th}} = \\min_i [\\sigma_0(1-\\beta\\,c_i^{n+1})]$.\n    - Fracture occurs if $\\sigma_{AB}^{n+1} \\ge \\sigma_{\\min, AB}^{\\text{th}}$. The first time $t^{n+1}$ this condition is met is the fracture time $t_{\\text{fract}}^{AB}$.\n3.  The state for the next time step is $c^{n+1}$.\n\n**2. Ordering $BA$ (Mechanics-Diffusion)**\n\nFor each time step, starting with the concentration field $c^n$:\n1.  **Apply Operator B (Mechanics):** The mechanical response is evaluated at the new time $t^{n+1}$. However, this evaluation uses the old concentration field $c^n$ from the beginning of the time step, but with the displacement at the new time, $U^{n+1} = \\dot{U}\\,t^{n+1}$. This is a common feature of splitting schemes where one operator acts on the state of the other operator from the previous step.\n    - The stress is calculated as $\\sigma_{BA}^{n+1} = \\frac{U^{n+1}}{\\sum_{i=1}^{N} \\frac{\\Delta x}{E_0(1-\\alpha\\,c_i^{n})}}$.\n    - The fracture threshold is $\\sigma_{\\min, BA}^{\\text{th}} = \\min_i [\\sigma_0(1-\\beta\\,c_i^{n})]$.\n    - Fracture occurs if $\\sigma_{BA}^{n+1} \\ge \\sigma_{\\min, BA}^{\\text{th}}$. The first time $t^{n+1}$ this condition is met is the fracture time $t_{\\text{fract}}^{BA}$.\n2.  **Apply Operator A (Diffusion):** The concentration field is advanced from $c^n$ to $c^{n+1}$ using the diffusion operator, identical to the step in the $AB$ scheme.\n    $$\n    c^{n+1} = A(c^n)\n    $$\n3.  The state for the next time step is $c^{n+1}$.\n\nThe key difference lies in which concentration field is used for the mechanical calculation at time $t^{n+1}$: the $AB$ scheme uses the \"post-diffusion\" concentration $c^{n+1}$, while the $BA$ scheme uses the \"pre-diffusion\" concentration $c^n$. This introduces a first-order-in-time error known as the splitting error, and the goal is to quantify its effect on the predicted fracture time.\n\nThe implementation will consist of a main loop that iterates through the provided test cases. For each case, two separate simulations are run, one for each ordering ($AB$ and $BA$). The simulation proceeds step-by-step in time from $t=0$ to $t=T_{\\max}$. In each step, the appropriate scheme is applied, and the fracture condition is checked. If fracture is detected, the current time is recorded, and the simulation for that ordering terminates. If the loop finishes without fracture, a time of $-1.0$ is recorded. Finally, the difference in fracture times $\\Delta t_{\\text{fract}} = t_{\\text{fract}}^{BA} - t_{\\text{fract}}^{AB}$ is calculated.", "answer": "```python\nimport numpy as np\n\ndef run_simulation(params, ordering):\n    \"\"\"\n    Runs a single chemo-mechanical simulation for a given ordering.\n    \"\"\"\n    L = params['L']\n    N = params['N']\n    D = params['D']\n    dt = params['dt']\n    T_max = params['T_max']\n    E_0 = params['E_0']\n    alpha = params['alpha']\n    sigma_0 = params['sigma_0']\n    beta = params['beta']\n    c_inlet = params['c_inlet']\n    U_dot = params['U_dot']\n\n    # Discretization parameters\n    dx = L / (N - 1)\n    num_steps = int(round(T_max / dt))\n    \n    # CFL constant for diffusion stability\n    cfl = D * dt / dx**2\n    # The problem parameters are chosen such that cfl = 0.5, so the scheme is stable.\n\n    # Initialize concentration array\n    c = np.zeros(N)\n    c[0] = c_inlet  # Enforce BC at t=0\n\n    # Time-stepping loop\n    for n in range(num_steps):\n        t_n_plus_1 = (n + 1) * dt\n        U_n_plus_1 = U_dot * t_n_plus_1\n\n        c_n = c.copy()\n\n        # --- Operator Splitting Logic ---\n        if ordering == 'AB':\n            # A: Diffusion step first\n            c_new = c_n.copy()\n            # Vectorized update for interior nodes\n            c_new[1:-1] = c_n[1:-1] + cfl * (c_n[0:-2] - 2 * c_n[1:-1] + c_n[2:])\n            c_new[0] = c_inlet\n            c_new[-1] = 0.0\n            c = c_new.copy()\n\n            # B: Mechanics step with new concentration c\n            E = E_0 * (1 - alpha * c)\n            # Add a small floor for numerical stability, though parameters should prevent activation\n            E = np.maximum(E, 1e-9) \n            integral_inv_E = np.sum(dx / E)\n            sigma_n_plus_1 = U_n_plus_1 / integral_inv_E\n            sigma_crit = np.min(sigma_0 * (1 - beta * c))\n            \n            if sigma_n_plus_1 = sigma_crit:\n                return t_n_plus_1\n\n        elif ordering == 'BA':\n            # B: Mechanics step first with old concentration c_n\n            E = E_0 * (1 - alpha * c_n)\n            E = np.maximum(E, 1e-9)\n            integral_inv_E = np.sum(dx / E)\n            sigma_n_plus_1 = U_n_plus_1 / integral_inv_E\n            sigma_crit = np.min(sigma_0 * (1 - beta * c_n))\n\n            fracture_triggered = sigma_n_plus_1 = sigma_crit\n\n            # A: Diffusion step second\n            c_new = c_n.copy()\n            c_new[1:-1] = c_n[1:-1] + cfl * (c_n[0:-2] - 2 * c_n[1:-1] + c_n[2:])\n            c_new[0] = c_inlet\n            c_new[-1] = 0.0\n            c = c_new.copy()\n\n            if fracture_triggered:\n                return t_n_plus_1\n                \n    # If loop completes without fracture\n    return -1.0\n\n\ndef solve():\n    \"\"\"\n    Main solver function that iterates through test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1 (general coupled case)\n        {\n            'L': 1.0, 'N': 101, 'D': 1.0e-4, 'dt': 0.05, 'T_max': 10.0,\n            'E_0': 1.0e11, 'alpha': 0.5, 'sigma_0': 1.0e9, 'beta': 0.8,\n            'c_inlet': 1.0, 'U_dot': 1.0e-3\n        },\n        # Case 2 (no diffusion edge case)\n        {\n            'L': 1.0, 'N': 101, 'D': 0.0, 'dt': 0.05, 'T_max': 10.0,\n            'E_0': 1.0e11, 'alpha': 0.5, 'sigma_0': 1.0e9, 'beta': 0.8,\n            'c_inlet': 1.0, 'U_dot': 1.0e-3\n        },\n        # Case 3 (strong strength sensitivity and faster diffusion)\n        {\n            'L': 1.0, 'N': 101, 'D': 5.0e-4, 'dt': 0.05, 'T_max': 10.0,\n            'E_0': 1.0e11, 'alpha': 0.7, 'sigma_0': 1.0e9, 'beta': 1.2,\n            'c_inlet': 1.0, 'U_dot': 1.0e-3\n        },\n        # Case 4 (low load rate, likely no fracture within horizon)\n        {\n            'L': 1.0, 'N': 101, 'D': 1.0e-4, 'dt': 0.05, 'T_max': 5.0,\n            'E_0': 1.0e11, 'alpha': 0.3, 'sigma_0': 1.0e9, 'beta': 0.2,\n            'c_inlet': 1.0, 'U_dot': 2.0e-4\n        }\n    ]\n\n    all_results = []\n    for params in test_cases:\n        t_ab = run_simulation(params, 'AB')\n        t_ba = run_simulation(params, 'BA')\n\n        if t_ab  0 and t_ba  0:\n            dt_fract = t_ba - t_ab\n        else:\n            dt_fract = -1.0\n        \n        all_results.append(f\"[{t_ab:.6f},{t_ba:.6f},{dt_fract:.6f}]\")\n\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```", "id": "3519243"}, {"introduction": "Operator splitting finds one of its most prominent applications in computational fluid dynamics (CFD) through fractional step or projection methods for the incompressible Navier-Stokes equations. These methods elegantly decouple the computation of velocity and pressure but introduce a non-physical pressure variable whose boundary conditions are not immediately obvious. This practice [@problem_id:3519215] tackles this crucial implementation challenge by guiding you through the derivation of a pressure boundary condition that is mathematically consistent with a physical outflow condition on the velocity. You will then quantify the spurious, non-physical reflections that arise from a seemingly plausible but incorrect boundary condition, reinforcing the need for rigorous analysis when dealing with the artificial variables created by splitting schemes.", "problem": "Consider an incompressible Newtonian fluid modeled by the incompressible Navier–Stokes equations in a straight channel occupying the spatial domain $\\Omega = \\{(x,y) \\in \\mathbb{R}^{2} : 0 \\le x \\le L,\\, 0 \\le y \\le H\\}$, with density $\\rho$ and dynamic viscosity $\\mu$. Let the outward normal at the outflow boundary $\\Gamma_{\\text{out}} = \\{x=L\\}$ be $\\mathbf{n} = \\mathbf{e}_{x}$. The flow is predominantly aligned with $\\mathbf{e}_{x}$ and has a steady outflow speed $U_{b}  0$ at $\\Gamma_{\\text{out}}$. A first-order pressure-projection fractional step (also called operator splitting) scheme advances the velocity via\n$$\n\\rho \\frac{\\mathbf{u}^{*} - \\mathbf{u}^{n}}{\\Delta t} = - \\rho (\\mathbf{u}^{n} \\cdot \\nabla)\\mathbf{u}^{n} + \\mu \\nabla^{2}\\mathbf{u}^{n} + \\mathbf{f}^{n},\n$$\nand then enforces incompressibility by solving the pressure subproblem\n$$\n\\nabla^{2} p^{n+1} = \\frac{\\rho}{\\Delta t} \\nabla \\cdot \\mathbf{u}^{*},\n$$\nfollowed by the velocity correction\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{*} - \\frac{\\Delta t}{\\rho} \\nabla p^{n+1}.\n$$\nYou may assume a smooth solution and that viscous normal stresses at the outflow are negligible compared to convective transport, a regime typical of moderate to high Reynolds number channel outflows.\n\nTask 1 (derivation): Starting from the incompressible Navier–Stokes momentum equation and the above fractional-step framework, linearize the normal component of the momentum balance at $\\Gamma_{\\text{out}}$ around the steady outflow speed $U_{b}$, and impose a convective radiation condition for the velocity at the outflow,\n$$\n\\frac{\\partial u_{n}}{\\partial t} + U_{b}\\frac{\\partial u_{n}}{\\partial n} = 0 \\quad \\text{on } \\Gamma_{\\text{out}},\n$$\nwhere $u_{n} = \\mathbf{u} \\cdot \\mathbf{n}$. Under the stated assumptions, derive the corresponding pressure boundary condition at $\\Gamma_{\\text{out}}$ that is consistent with the fractional-step projection, expressed as a Neumann condition for $p^{n+1}$.\n\nTask 2 (quantification of spurious reflection under mis-specification): Consider a one-dimensional surrogate of the pressure subproblem along the streamwise direction $x \\in [0,L]$ with the right-hand side chosen as a single Fourier mode representative of the divergence of the intermediate velocity field,\n$$\n\\frac{\\mathrm{d}^{2} p}{\\mathrm{d} x^{2}} = G \\sin\\!\\left(\\frac{\\pi x}{L}\\right),\n$$\nwith $G$ a constant. At the inflow boundary $x=0$, take a reference pressure condition $p(0) = 0$. For the outflow boundary $x=L$:\n- Case A (physically consistent outflow): Impose the Neumann boundary condition derived in Task 1 and compute $\\left.\\frac{\\mathrm{d} p}{\\mathrm{d} x}\\right|_{x=L}$.\n- Case B (mis-specified outflow): Impose a Dirichlet condition $p(L) = 0$ instead of the Neumann condition and compute $\\left.\\frac{\\mathrm{d} p}{\\mathrm{d} x}\\right|_{x=L}$.\n\nDefine the reflection coefficient $\\mathcal{R}$ as the ratio of the magnitude of the outflow-normal velocity correction induced by the mis-specified Dirichlet condition in Case B to the magnitude of the inflow-normal velocity correction in Case A, both measured at the boundaries. Using the velocity correction relation\n$$\nu_{n}^{\\text{corr}}(x) = - \\frac{\\Delta t}{\\rho} \\left.\\frac{\\mathrm{d} p}{\\mathrm{d} x}\\right|_{x},\n$$\nexpress $\\mathcal{R}$ as\n$$\n\\mathcal{R} = \\frac{\\left|\\left.\\frac{\\mathrm{d} p}{\\mathrm{d} x}\\right|_{x=L,\\ \\text{Case B}}\\right|}{\\left|\\left.\\frac{\\mathrm{d} p}{\\mathrm{d} x}\\right|_{x=0,\\ \\text{Case A}}\\right|}.\n$$\n\nAnswer specification: Provide your final answer as a two-entry row matrix containing, in order, the outflow pressure Neumann boundary condition value from Task 1 (as a number or closed-form expression evaluated at $x=L$) and the reflection coefficient $\\mathcal{R}$ from Task 2. No rounding is required. The reflection coefficient is dimensionless. Do not include units in your final boxed answer.", "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It is a standard analysis of numerical boundary conditions for projection methods in computational fluid dynamics. I will now proceed with the solution.\n\nThe problem consists of two tasks. Task 1 is to derive a Neumann boundary condition for the pressure at the outflow boundary of a channel flow simulation that uses a fractional-step projection method. Task 2 is to quantify the spurious reflection at the outflow caused by using an incorrect pressure boundary condition, analyzed through a simplified one-dimensional model.\n\n### Task 1: Derivation of the Outflow Pressure Boundary Condition\n\nThe goal is to find a boundary condition for the pressure $p^{n+1}$ at the outflow boundary $\\Gamma_{\\text{out}} = \\{x=L\\}$ that is consistent with the imposed convective radiation condition for the velocity. The normal vector at this boundary is $\\mathbf{n} = \\mathbf{e}_{x}$, so the normal direction corresponds to the $x$-direction, and the normal velocity is $u_{n} = \\mathbf{u} \\cdot \\mathbf{n} = u_{x}$. The normal derivative is $\\frac{\\partial}{\\partial n} = \\frac{\\partial}{\\partial x}$.\n\nThe velocity correction step of the fractional-step method is given by:\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{*} - \\frac{\\Delta t}{\\rho} \\nabla p^{n+1}\n$$\nTaking the dot product with the outward normal $\\mathbf{n}$ at the boundary $\\Gamma_{\\text{out}}$ yields the normal velocity component at the new time step $n+1$:\n$$\nu_{n}^{n+1} = u_{n}^{*} - \\frac{\\Delta t}{\\rho} \\frac{\\partial p^{n+1}}{\\partial n} \\quad \\text{on } \\Gamma_{\\text{out}}\n$$\nThis equation relates the desired pressure Neumann condition, $\\frac{\\partial p^{n+1}}{\\partial n}$, to the velocities at the boundary. To solve for it, we need an expression for $u_n^{n+1}$ on $\\Gamma_{\\text{out}}$.\n\nThe problem imposes a convective radiation condition for the velocity at the outflow:\n$$\n\\frac{\\partial u_{n}}{\\partial t} + U_{b}\\frac{\\partial u_{n}}{\\partial n} = 0 \\quad \\text{on } \\Gamma_{\\text{out}}\n$$\nWe can discretize this equation in time using a first-order explicit scheme (forward Euler for the time derivative, evaluation at time $n$ for the spatial derivative) consistent with the overall first-order temporal accuracy of the given projection scheme:\n$$\n\\frac{u_{n}^{n+1} - u_{n}^{n}}{\\Delta t} + U_{b}\\frac{\\partial u_{n}^{n}}{\\partial n} = 0\n$$\nSolving for $u_{n}^{n+1}$ gives the target normal velocity at the outflow for the new time step:\n$$\nu_{n}^{n+1} = u_{n}^{n} - \\Delta t \\, U_{b} \\frac{\\partial u_{n}^{n}}{\\partial n}\n$$\nNow, we substitute this expression for $u_n^{n+1}$ into the normal component of the velocity correction equation:\n$$\nu_{n}^{n} - \\Delta t \\, U_{b} \\frac{\\partial u_{n}^{n}}{\\partial n} = u_{n}^{*} - \\frac{\\Delta t}{\\rho} \\frac{\\partial p^{n+1}}{\\partial n}\n$$\nRearranging to solve for the pressure gradient gives:\n$$\n\\frac{\\Delta t}{\\rho} \\frac{\\partial p^{n+1}}{\\partial n} = (u_{n}^{*} - u_{n}^{n}) + \\Delta t \\, U_{b} \\frac{\\partial u_{n}^{n}}{\\partial n}\n$$\n$$\n\\frac{\\partial p^{n+1}}{\\partial n} = \\frac{\\rho}{\\Delta t}(u_{n}^{*} - u_{n}^{n}) + \\rho \\, U_{b} \\frac{\\partial u_{n}^{n}}{\\partial n}\n$$\nThe term $(u_{n}^{*} - u_{n}^{n})$ is determined by the momentum predictor step:\n$$\n\\rho \\frac{\\mathbf{u}^{*} - \\mathbf{u}^{n}}{\\Delta t} = - \\rho (\\mathbf{u}^{n} \\cdot \\nabla)\\mathbf{u}^{n} + \\mu \\nabla^{2}\\mathbf{u}^{n} + \\mathbf{f}^{n}\n$$\nTaking the normal component of this equation gives:\n$$\n\\frac{\\rho}{\\Delta t}(u_{n}^{*} - u_{n}^{n}) = \\left[ - \\rho (\\mathbf{u}^{n} \\cdot \\nabla)\\mathbf{u}^{n} + \\mu \\nabla^{2}\\mathbf{u}^{n} + \\mathbf{f}^{n} \\right] \\cdot \\mathbf{n}\n$$\nSubstituting this into our expression for the pressure gradient:\n$$\n\\frac{\\partial p^{n+1}}{\\partial n} = \\left[ - \\rho (\\mathbf{u}^{n} \\cdot \\nabla)u_{n}^{n} + \\mu (\\nabla^{2}\\mathbf{u}^{n}) \\cdot \\mathbf{n} + f_{n}^{n} \\right] + \\rho \\, U_{b} \\frac{\\partial u_{n}^{n}}{\\partial n}\n$$\nNow, we apply the assumptions provided in the problem statement, evaluated at time level $n$ and on the boundary $\\Gamma_{\\text{out}}$:\n1.  Linearization of the convective term around the steady outflow speed $U_b$: $(\\mathbf{u}^{n} \\cdot \\nabla)u_{n}^{n} \\approx U_{b}\\frac{\\partial u_{n}^{n}}{\\partial n}$.\n2.  Viscous normal stresses are negligible: This implies that the normal component of the viscous force term at the outflow is negligible, so $\\mu (\\nabla^{2}\\mathbf{u}^{n}) \\cdot \\mathbf{n} \\approx 0$.\n\nApplying these assumptions to the equation for the pressure gradient:\n$$\n\\frac{\\partial p^{n+1}}{\\partial n} \\approx \\left[ - \\rho \\left( U_{b}\\frac{\\partial u_{n}^{n}}{\\partial n} \\right) + 0 + f_{n}^{n} \\right] + \\rho \\, U_{b} \\frac{\\partial u_{n}^{n}}{\\partial n}\n$$\n$$\n\\frac{\\partial p^{n+1}}{\\partial n} = - \\rho \\, U_{b}\\frac{\\partial u_{n}^{n}}{\\partial n} + f_{n}^{n} + \\rho \\, U_{b}\\frac{\\partial u_{n}^{n}}{\\partial n}\n$$\nThe convective terms cancel out, leaving:\n$$\n\\frac{\\partial p^{n+1}}{\\partial n} = f_{n}^{n}\n$$\nThe problem does not specify the body force $\\mathbf{f}^{n}$. In typical applications and model problems of this nature, body forces are often assumed to be zero unless stated otherwise. For the result to be a specific value and to ensure consistency with Task 2 (which implicitly has no body force term), we assume $\\mathbf{f}^{n} = \\mathbf{0}$. Therefore, $f_n^n = 0$.\nThe resulting Neumann boundary condition for the pressure at the outflow is:\n$$\n\\left.\\frac{\\partial p^{n+1}}{\\partial x}\\right|_{x=L} = 0\n$$\n\n### Task 2: Quantification of Spurious Reflection\n\nWe analyze the one-dimensional surrogate problem for the pressure, given by the ordinary differential equation:\n$$\n\\frac{\\mathrm{d}^{2} p}{\\mathrm{d} x^{2}} = G \\sin\\left(\\frac{\\pi x}{L}\\right)\n$$\nThe general solution can be found by integrating twice with respect to $x$:\n$$\n\\frac{\\mathrm{d} p}{\\mathrm{d} x} = \\int G \\sin\\left(\\frac{\\pi x}{L}\\right) \\mathrm{d}x = -G \\frac{L}{\\pi} \\cos\\left(\\frac{\\pi x}{L}\\right) + C_1\n$$\n$$\np(x) = \\int \\left(-G \\frac{L}{\\pi} \\cos\\left(\\frac{\\pi x}{L}\\right) + C_1\\right) \\mathrm{d}x = -G \\left(\\frac{L}{\\pi}\\right)^2 \\sin\\left(\\frac{\\pi x}{L}\\right) + C_1 x + C_2\n$$\n\n**Case A: Physically consistent outflow**\nThe boundary conditions are $p(0) = 0$ (inflow) and $\\left.\\frac{\\mathrm{d} p}{\\mathrm{d} x}\\right|_{x=L} = 0$ (outflow, from Task 1).\n\nApplying $p(0) = 0$:\n$$\np(0) = -G \\left(\\frac{L}{\\pi}\\right)^2 \\sin(0) + C_1(0) + C_2 = 0 \\implies C_2=0\n$$\nApplying $\\left.\\frac{\\mathrm{d} p}{\\mathrm{d} x}\\right|_{x=L} = 0$:\n$$\n\\left.\\frac{\\mathrm{d} p}{\\mathrm{d} x}\\right|_{x=L} = -G \\frac{L}{\\pi} \\cos\\left(\\frac{\\pi L}{L}\\right) + C_1 = -G \\frac{L}{\\pi} \\cos(\\pi) + C_1 = 0\n$$\n$$\n-G \\frac{L}{\\pi} (-1) + C_1 = 0 \\implies C_1 = -G \\frac{L}{\\pi}\n$$\nThe pressure gradient for Case A is $\\frac{\\mathrm{d} p_A}{\\mathrm{d} x} = -G \\frac{L}{\\pi} \\cos\\left(\\frac{\\pi x}{L}\\right) - G \\frac{L}{\\pi}$.\n\n**Case B: Mis-specified outflow**\nThe boundary conditions are $p(0) = 0$ (inflow) and $p(L) = 0$ (outflow).\n\nApplying $p(0) = 0$ gives $C_2 = 0$, as before.\nApplying $p(L) = 0$:\n$$\np(L) = -G \\left(\\frac{L}{\\pi}\\right)^2 \\sin\\left(\\frac{\\pi L}{L}\\right) + C_1 L = -G \\left(\\frac{L}{\\pi}\\right)^2 \\sin(\\pi) + C_1 L = 0\n$$\n$$\n0 + C_1 L = 0 \\implies C_1 = 0\n$$\nThe pressure gradient for Case B is $\\frac{\\mathrm{d} p_B}{\\mathrmd} x} = -G \\frac{L}{\\pi} \\cos\\left(\\frac{\\pi x}{L}\\right)$.\n\n**Calculation of the Reflection Coefficient $\\mathcal{R}$**\nThe reflection coefficient is defined as:\n$$\n\\mathcal{R} = \\frac{\\left|\\left.\\frac{\\mathrm{d} p}{\\mathrm{d} x}\\right|_{x=L,\\ \\text{Case B}}\\right|}{\\left|\\left.\\frac{\\mathrm{d} p}{\\mathrm{d} x}\\right|_{x=0,\\ \\text{Case A}}\\right|}\n$$\nFirst, we evaluate the numerator:\n$$\n\\left.\\frac{\\mathrm{d} p}{\\mathrm{d} x}\\right|_{x=L,\\ \\text{Case B}} = \\left. \\left( -G \\frac{L}{\\pi} \\cos\\left(\\frac{\\pi x}{L}\\right) \\right) \\right|_{x=L} = -G \\frac{L}{\\pi} \\cos(\\pi) = G \\frac{L}{\\pi}\n$$\nNext, we evaluate the denominator:\n$$\n\\left.\\frac{\\mathrm{d} p}{\\mathrm{d} x}\\right|_{x=0,\\ \\text{Case A}} = \\left. \\left( -G \\frac{L}{\\pi} \\cos\\left(\\frac{\\pi x}{L}\\right) - G \\frac{L}{\\pi} \\right) \\right|_{x=0} = -G \\frac{L}{\\pi} \\cos(0) - G \\frac{L}{\\pi} = -G \\frac{L}{\\pi} - G \\frac{L}{\\pi} = -2G \\frac{L}{\\pi}\n$$\nNow, we compute the ratio of their magnitudes:\n$$\n\\mathcal{R} = \\frac{\\left| G \\frac{L}{\\pi} \\right|}{\\left| -2G \\frac{L}{\\pi} \\right|} = \\frac{|G| \\frac{L}{\\pi}}{2|G| \\frac{L}{\\pi}} = \\frac{1}{2}\n$$\n\nThe final answer requires the outflow pressure Neumann boundary condition value from Task 1, which is $0$, and the reflection coefficient $\\mathcal{R}$ from Task 2, which is $\\frac{1}{2}$. These are provided in a two-entry row matrix.", "answer": "$$\n\\boxed{\\begin{pmatrix} 0  \\frac{1}{2} \\end{pmatrix}}\n$$", "id": "3519215"}, {"introduction": "A ubiquitous challenge in multiphysics simulation is stiffness, where different physical processes evolve on vastly different timescales, such as slow transport coupled with rapid chemical reactions. This exercise [@problem_id:3519207] confronts stiffness head-on by comparing operator splitting with a closely related and powerful alternative: Implicit-Explicit (IMEX) methods. You will implement and test these schemes on a reactive-advection problem, discovering how an explicit treatment of a stiff source term can fail catastrophically by violating physical constraints like the positivity of species concentrations. This hands-on comparison will illuminate the concept of numerical stability, the role of implicit methods in preserving physical laws through properties like entropy stability, and the subtle yet important differences between splitting and IMEX approaches.", "problem": "You are asked to analyze and implement first-order operator splitting and implicit–explicit (IMEX) integration for a one-dimensional reactive advection equation that models a single species mass fraction. The mathematical model is the scalar conservation law with linear relaxation source on the periodic domain $x \\in [0,1)$:\n$$\n\\partial_t y(x,t) + a\\,\\partial_x y(x,t) = -k\\,(y(x,t) - y_{\\mathrm{eq}}),\n$$\nwhere $a0$ is a constant advection speed, $k0$ is a stiffness parameter, and $y_{\\mathrm{eq}}0$ is a constant equilibrium state. The state $y$ is dimensionless and represents a species mass fraction, so physical realism demands $y \\ge 0$. To assess thermodynamic consistency of the source term, use the convex mathematical entropy density\n$$\n\\eta(y) = y \\ln\\!\\left(\\frac{y}{y_{\\mathrm{eq}}}\\right) - (y - y_{\\mathrm{eq}}), \\quad y  0,\n$$\nand the discrete entropy functional\n$$\nH(\\mathbf{y}) = \\sum_{i=0}^{N-1} \\eta(y_i)\\,\\Delta x,\n$$\nwhere $\\mathbf{y} = (y_0,\\dots,y_{N-1})^\\top$ is the vector of cell averages on a uniform periodic grid with $N$ cells and spacing $\\Delta x = 1/N$.\n\nStarting from the fundamental base of conservation laws and standard finite volume discretization, proceed as follows.\n\n- Discretize the advection operator $B$ using a first-order upwind flux consistent with the sign of $a$ and forward Euler time stepping. Use periodic boundary conditions.\n\n- Discretize the stiff chemistry operator $A$ using two options: backward Euler (fully implicit) and forward Euler (fully explicit) time stepping applied to the linear relaxation ordinary differential equation $\\dot{y} = -k(y - y_{\\mathrm{eq}})$ independently at each cell.\n\n- Construct two first-order Lie operator-split methods over a time step $\\Delta t$: $A \\circ B$ with $A$ implemented by backward Euler for the chemistry step, and $A \\circ B$ with $A$ implemented by forward Euler for the chemistry step. In each case, apply the chemistry substep over $\\Delta t$ followed by the advection substep over $\\Delta t$.\n\n- Construct a first-order IMEX Euler method in which the advection term is treated explicitly and the chemistry term is treated implicitly within the same full time step $\\Delta t$.\n\nYour tasks:\n\n1) From the definitions of forward Euler, backward Euler, and first-order upwind finite volume discretization for $a0$, derive the update formulas for each method (both operator-split and IMEX) in terms of the grid function values. Use the facts that forward Euler applied to $\\dot{y} = f(y)$ gives $y^{n+1} = y^n + \\Delta t\\,f(y^n)$ and backward Euler gives $y^{n+1} = y^n + \\Delta t\\,f(y^{n+1})$. Show that backward Euler applied to the linear relaxation is unconditionally positivity-preserving for $y^n \\ge 0$, while forward Euler can produce negative values when $k \\Delta t$ is sufficiently large relative to $y^n$ and $y_{\\mathrm{eq}}$.\n\n2) Prove that the entropy density $\\eta$ is strictly convex for $y0$ and attains its unique minimum at $y = y_{\\mathrm{eq}}$. Conclude that any time integrator for the chemistry that is a contraction towards $y_{\\mathrm{eq}}$ is entropy dissipative in the sense that $H$ does not increase over that substep. Explain why, for the linear relaxation, the backward Euler chemistry step is entropy stable for any $\\Delta t0$.\n\n3) Implement and compare three methods on a uniform periodic grid with $N = 100$, $\\Delta x = 1/N$, $a = 0.5$, $y_{\\mathrm{eq}} = 0.05$, and final time $T = 0.2$. Use the initial condition\n$$\ny(x,0) = y_{\\mathrm{eq}} + 0.4\\,\\exp\\big(-200\\,(x-0.25)^2\\big) + 0.2\\,\\exp\\big(-400\\,(x-0.75)^2\\big).\n$$\nEvolve to $T$ by repeating steps of size $\\Delta t$ and, if $T/\\Delta t$ is not an integer, use a final shortened step so that the total simulated time equals $T$ exactly.\n\n4) For the following test suite of $(k,\\Delta t)$ pairs, run all three methods:\n   - Case A (happy path): $(k,\\Delta t) = (1000, 0.001)$.\n   - Case B (very stiff): $(k,\\Delta t) = (8000, 0.01)$.\n   - Case C (CFL boundary): $(k,\\Delta t) = (500, 0.02)$.\n\nFor each case, compute the following seven outputs:\n   - $p_{\\mathrm{BE}}$: a boolean indicating whether all degrees of freedom remain nonnegative after the final time using operator splitting with backward Euler chemistry.\n   - $e_{\\mathrm{BE}}$: a boolean indicating whether the discrete entropy $H$ after each chemistry substep does not increase relative to immediately before that substep, throughout the simulation with backward Euler chemistry.\n   - $p_{\\mathrm{IMEX}}$: a boolean indicating whether all degrees of freedom remain nonnegative after the final time using the IMEX Euler method.\n   - $e_{\\mathrm{IMEX}}$: a boolean indicating whether the discrete entropy $H$ after each full IMEX step does not increase relative to immediately before that step, throughout the simulation.\n   - $p_{\\mathrm{EE}}$: a boolean indicating whether all degrees of freedom remain nonnegative after the final time using operator splitting with forward Euler chemistry.\n   - $e_{\\mathrm{EE}}$: a boolean indicating whether the discrete entropy $H$ after each forward Euler chemistry substep does not increase relative to immediately before that substep, throughout the simulation.\n   - $d_{\\mathrm{L1}}$: the discrete $\\ell^1$ difference between the IMEX and backward-Euler-split final states, defined as $\\sum_i |y^{\\mathrm{IMEX}}_i - y^{\\mathrm{BE-split}}_i|\\,\\Delta x$ as a floating-point number.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each case contributes a sublist of the form $[p_{\\mathrm{BE}}, e_{\\mathrm{BE}}, p_{\\mathrm{IMEX}}, e_{\\mathrm{IMEX}}, p_{\\mathrm{EE}}, e_{\\mathrm{EE}}, d_{\\mathrm{L1}}]$. For example, the final output format must be like\n$[[\\text{case A outputs}],[\\text{case B outputs}],[\\text{case C outputs}]]$.", "solution": "The problem avers a one-dimensional reactive advection equation, a standard partial differential equation (PDE) in transport phenomena. All parameters, initial conditions, and numerical methods are well-defined within the established mathematical and computational sciences literature. The problem is scientifically sound, self-contained, and well-posed. The tasks involve standard derivations and the implementation of canonical numerical schemes (operator splitting, IMEX) for such equations. The problem is therefore deemed valid.\n\n### Task 1: Derivation of Numerical Schemes\n\nThe governing PDE is $\\partial_t y + a\\,\\partial_x y = -k(y - y_{\\mathrm{eq}})$, which can be written in the form $\\partial_t y = A(y) + B(y)$, where $A(y) = -k(y - y_{\\mathrm{eq}})$ is the chemistry operator and $B(y) = -a\\,\\partial_x y$ is the advection operator.\n\nWe discretize the spatial domain $[0,1)$ into $N$ cells of width $\\Delta x = 1/N$. Let $y_i(t)$ be the cell-averaged value in cell $i$.\n\n**Advection Operator ($B$) Discretization**\nThe advection operator $B(y) = -a\\,\\partial_x y$ is discretized using a first-order upwind finite volume method. Since $a0$, the flux at the interface $i+1/2$ between cells $i$ and $i+1$ is $F_{i+1/2} = a y_i$. The semi-discrete equation for cell $i$ is:\n$$\n\\frac{d y_i}{dt} = -\\frac{F_{i+1/2} - F_{i-1/2}}{\\Delta x} = -\\frac{a y_i - a y_{i-1}}{\\Delta x}\n$$\nApplying a forward Euler step over a time step $\\Delta t$ to the equation $\\dot{\\mathbf{y}} = \\mathcal{B}(\\mathbf{y})$, where $\\mathcal{B}$ is the discrete advection operator, gives the update:\n$$\ny_i^* = y_i^n - \\frac{a \\Delta t}{\\Delta x}(y_i^n - y_{i-1}^n)\n$$\nwhere periodic boundary conditions imply $y_{-1}^n = y_{N-1}^n$.\n\n**Chemistry Operator ($A$) Discretization**\nThe chemistry operator $A(y) = -k(y - y_{\\mathrm{eq}})$ corresponds to the ordinary differential equation (ODE) $\\dot{y} = -k(y-y_{\\mathrm{eq}})$ applied independently in each cell.\n\n- **Forward Euler (FE) Discretization**:\n  The update rule is $y^{n+1} = y^n + \\Delta t \\, f(y^n)$, where $f(y) = -k(y - y_{\\mathrm{eq}})$.\n  $$\n  y^{n+1} = y^n + \\Delta t(-k(y^n - y_{\\mathrm{eq}})) = y^n(1 - k \\Delta t) + k \\Delta t y_{\\mathrm{eq}}\n  $$\n  For positivity, if $y^n \\ge 0$, we require $y^{n+1} \\ge 0$. If $k\\Delta t  1$, the term $(1-k\\Delta t)$ is negative. Positivity can be violated. For example, if $k\\Delta t=2$ and $y^n  2y_{\\mathrm{eq}}$, then $y^{n+1} = -y^n+2y_{\\mathrm{eq}}  0$. Thus, the FE scheme for this reaction is not unconditionally positivity-preserving.\n\n- **Backward Euler (BE) Discretization**:\n  The update rule is $y^{n+1} = y^n + \\Delta t \\, f(y^{n+1})$.\n  $$\n  y^{n+1} = y^n + \\Delta t(-k(y^{n+1} - y_{\\mathrm{eq}}))\n  $$\n  Solving for $y^{n+1}$:\n  $y^{n+1}(1 + k \\Delta t) = y^n + k \\Delta t y_{\\mathrm{eq}}$\n  $$\n  y^{n+1} = \\frac{y^n + k \\Delta t y_{\\mathrm{eq}}}{1 + k \\Delta t}\n  $$\n  Since $y^n \\ge 0$, $k  0$, $\\Delta t  0$, and $y_{\\mathrm{eq}}  0$, both the numerator and the denominator are strictly positive. Thus, $y^{n+1}  0$. The BE scheme is unconditionally positivity-preserving.\n\n**Construction of Full Schemes**\n\n1.  **Operator-Split, Backward Euler Chemistry ($A \\circ B$)**:\n    This is a first-order Lie-Trotter splitting where the chemistry substep is applied first, followed by the advection substep.\n    -   Step 1 (Chemistry, BE): For each cell $i=0, \\dots, N-1$:\n        $$\n        y_i^{**} = \\frac{y_i^n + k \\Delta t y_{\\mathrm{eq}}}{1 + k \\Delta t}\n        $$\n    -   Step 2 (Advection, FE): For each cell $i=0, \\dots, N-1$:\n        $$\n        y_i^{n+1} = y_i^{**} - \\frac{a \\Delta t}{\\Delta x}(y_i^{**} - y_{i-1}^{**})\n        $$\n\n2.  **Operator-Split, Forward Euler Chemistry ($A \\circ B$)**:\n    Similar to the above, but the chemistry substep uses Forward Euler.\n    -   Step 1 (Chemistry, FE): For each cell $i=0, \\dots, N-1$:\n        $$\n        y_i^{**} = y_i^n(1 - k \\Delta t) + k \\Delta t y_{\\mathrm{eq}}\n        $$\n    -   Step 2 (Advection, FE): For each cell $i=0, \\dots, N-1$:\n        $$\n        y_i^{n+1} = y_i^{**} - \\frac{a \\Delta t}{\\Delta x}(y_i^{**} - y_{i-1}^{**})\n        $$\n\n3.  **IMEX Euler Method**:\n    The IMEX Euler method treats the non-stiff advection term explicitly and the stiff chemistry term implicitly within a single step.\n    $$\n    \\frac{y_i^{n+1} - y_i^n}{\\Delta t} = \\underbrace{-k(y_i^{n+1} - y_{\\mathrm{eq}})}_{\\text{Implicit}} + \\underbrace{\\left(-\\frac{a}{\\Delta x}(y_i^n - y_{i-1}^n)\\right)}_{\\text{Explicit}}\n    $$\n    Rearranging to solve for $y_i^{n+1}$:\n    $y_i^{n+1} - y_i^n = -k \\Delta t y_i^{n+1} + k \\Delta t y_{\\mathrm{eq}} - \\frac{a \\Delta t}{\\Delta x}(y_i^n - y_{i-1}^n)$\n    $y_i^{n+1}(1 + k \\Delta t) = y_i^n - \\frac{a \\Delta t}{\\Delta x}(y_i^n - y_{i-1}^n) + k \\Delta t y_{\\mathrm{eq}}$\n    $$\n    y_i^{n+1} = \\frac{1}{1 + k \\Delta t} \\left( y_i^n - \\frac{a \\Delta t}{\\Delta x}(y_i^n - y_{i-1}^n) + k \\Delta t y_{\\mathrm{eq}} \\right)\n    $$\n\n### Task 2: Entropy Analysis\n\nThe mathematical entropy density is given by $\\eta(y) = y \\ln(y/y_{\\mathrm{eq}}) - (y - y_{\\mathrm{eq}})$ for $y0$.\n\n**Convexity and Minimum of $\\eta(y)$**\nFirst, we find the first and second derivatives of $\\eta(y)$ with respect to $y$:\n$$\n\\eta'(y) = \\frac{d}{dy} \\left( y \\ln y - y \\ln y_{\\mathrm{eq}} - y + y_{\\mathrm{eq}} \\right) = (\\ln y + 1) - \\ln y_{\\mathrm{eq}} - 1 = \\ln\\left(\\frac{y}{y_{\\mathrm{eq}}}\\right)\n$$\n$$\n\\eta''(y) = \\frac{d}{dy} \\left( \\ln y - \\ln y_{\\mathrm{eq}} \\right) = \\frac{1}{y}\n$$\nFor the physical domain of the mass fraction $y  0$, the second derivative $\\eta''(y) = 1/y$ is strictly positive. This proves that $\\eta(y)$ is a strictly convex function for $y0$.\n\nThe unique minimum of a strictly convex function occurs where its first derivative is zero.\n$$\n\\eta'(y) = 0 \\implies \\ln\\left(\\frac{y}{y_{\\mathrm{eq}}}\\right) = 0 \\implies \\frac{y}{y_{\\mathrm{eq}}} = 1 \\implies y = y_{\\mathrm{eq}}\n$$\nThus, $\\eta(y)$ attains its unique global minimum at the equilibrium state $y = y_{\\mathrm{eq}}$. The minimum value is $\\eta(y_{\\mathrm{eq}}) = y_{\\mathrm{eq}} \\ln(1) - (y_{\\mathrm{eq}} - y_{\\mathrm{eq}}) = 0$.\n\n**Entropy Dissipation and Contractions**\nThe discrete entropy is $H(\\mathbf{y}) = \\sum_i \\eta(y_i) \\Delta x$. An integrator for the chemistry ODE is entropy dissipative (or entropy stable) if $H$ does not increase over one step. Since $\\eta(y)$ is convex with its minimum at $y_{\\mathrm{eq}}$, any update $y^n \\to y^{n+1}$ that moves the state closer to $y_{\\mathrm{eq}}$ (i.e., is a contraction towards $y_{\\mathrm{eq}}$) will result in $\\eta(y^{n+1}) \\le \\eta(y^n)$. If this holds for all cells $i$, then $H(\\mathbf{y}^{n+1}) \\le H(\\mathbf{y}^n)$.\n\n**Entropy Stability of the Backward Euler Chemistry Step**\nLet us analyze the distance from equilibrium for the BE update $y^* = \\frac{y^n + k \\Delta t y_{\\mathrm{eq}}}{1 + k \\Delta t}$.\n$$\ny^* - y_{\\mathrm{eq}} = \\frac{y^n + k \\Delta t y_{\\mathrm{eq}}}{1 + k \\Delta t} - y_{\\mathrm{eq}} = \\frac{y^n + k \\Delta t y_{\\mathrm{eq}} - y_{\\mathrm{eq}}(1 + k \\Delta t)}{1 + k \\Delta t} = \\frac{y^n - y_{\\mathrm{eq}}}{1 + k \\Delta t}\n$$\nTaking the absolute value:\n$$\n|y^* - y_{\\mathrm{eq}}| = \\frac{1}{1 + k \\Delta t} |y^n - y_{\\mathrm{eq}}|\n$$\nSince $k0$ and $\\Delta t0$, the factor $1/(1+k\\Delta t)$ is strictly less than $1$. This shows that the BE step is a strict contraction mapping towards the equilibrium point $y_{\\mathrm{eq}}$ for any time step $\\Delta t  0$. Consequently, $\\eta(y^*)  \\eta(y^n)$ for any $y^n \\neq y_{\\mathrm{eq}}$, and $\\eta(y^*) = \\eta(y^n)$ if $y^n = y_{\\mathrm{eq}}$. Therefore, the BE chemistry step is unconditionally entropy stable.\n\nA similar analysis for the IMEX scheme shows that it can be interpreted as an explicit upwind advection step, which is entropy stable due to the convexity of $\\eta$, followed by an unconditionally entropy-stable BE reaction step. We therefore expect the full IMEX step to be entropy stable. The explicit FE chemistry step, however, is not a contraction for $k \\Delta t  2$ and is expected to violate entropy stability in stiff regimes.\n\n### Implementation and Comparison\nThe three numerical methods—operator splitting with backward Euler chemistry (Split-BE), operator splitting with forward Euler chemistry (Split-FE), and IMEX Euler—are implemented. The system is evolved from the specified initial condition up to time $T=0.2$. For each of the three test cases $(k, \\Delta t)$, the simulation is run with each method. During the simulation, we track two properties:\n1.  **Positivity**: Whether the solution vector $\\mathbf{y}$ remains non-negative at all grid points. This is checked at the final time $T$.\n2.  **Entropy Stability**: For each relevant step (chemistry substep for split methods, full step for IMEX), we compute the discrete entropy $H(\\mathbf{y})$ before and after the step and verify that it does not increase. A boolean flag, initialized to true, is set to false upon the first violation.\nThe final state of the Split-BE and IMEX methods are compared using a discrete $\\ell^1$-norm to quantify their difference. The results are systematically collected for each test case as per the problem specification. The implementation details are provided in the final answer code block.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the reactive advection problem using three different numerical methods\n    and reports on their stability properties and differences.\n    \"\"\"\n    # Global parameters\n    N = 100\n    L = 1.0\n    dx = L / N\n    a = 0.5\n    y_eq = 0.05\n    T = 0.2\n    x = np.linspace(0, L, N, endpoint=False)\n\n    # Initial condition\n    y0 = y_eq + 0.4 * np.exp(-200 * (x - 0.25)**2) + 0.2 * np.exp(-400 * (x - 0.75)**2)\n\n    # Entropy function eta(y)\n    # Define eta(0) = y_eq for continuity as y*ln(y) - 0 for y-0+\n    def eta(y, y_eq_val):\n        # Use np.where to handle y=0 case to avoid log(0) warnings\n        y_safe = np.where(y  0, y, 1.0) # a dummy value for log, result not used\n        log_term = np.where(y  0, y_safe * np.log(y_safe / y_eq_val), 0)\n        return log_term - (y - y_eq_val)\n\n    # Discrete entropy functional H(y)\n    def discrete_entropy(y, y_eq_val, dx_val):\n        return np.sum(eta(y, y_eq_val)) * dx_val\n\n    # --- Method Implementations ---\n\n    def run_split_be(y_init, k, dt, T_final, a_val, y_eq_val, dx_val):\n        y = y_init.copy()\n        cfl = a_val * dt / dx_val\n        entropy_stable = True\n        \n        num_steps = int(T_final / dt)\n        remaining_time = T_final - num_steps * dt\n\n        time_steps = [dt] * num_steps\n        if remaining_time  1e-12:\n            time_steps.append(remaining_time)\n\n        for t_step in time_steps:\n            # Chemistry substep (Backward Euler)\n            H_before_chem = discrete_entropy(y, y_eq_val, dx_val)\n            y_star = (y + k * t_step * y_eq_val) / (1.0 + k * t_step)\n            H_after_chem = discrete_entropy(y_star, y_eq_val, dx_val)\n            if H_after_chem  H_before_chem + 1e-12: # Check with tolerance\n                entropy_stable = False\n            \n            # Advection substep (Forward Euler, Upwind)\n            cfl_step = a_val * t_step / dx_val\n            y = y_star - cfl_step * (y_star - np.roll(y_star, 1))\n        \n        positivity = np.all(y = 0)\n        return y, positivity, entropy_stable\n\n    def run_split_fe(y_init, k, dt, T_final, a_val, y_eq_val, dx_val):\n        y = y_init.copy()\n        entropy_stable = True\n\n        num_steps = int(T_final / dt)\n        remaining_time = T_final - num_steps * dt\n\n        time_steps = [dt] * num_steps\n        if remaining_time  1e-12:\n            time_steps.append(remaining_time)\n\n        for t_step in time_steps:\n            # Chemistry substep (Forward Euler)\n            H_before_chem = discrete_entropy(y, y_eq_val, dx_val)\n            y_star = y * (1.0 - k * t_step) + k * t_step * y_eq_val\n            H_after_chem = discrete_entropy(y_star, y_eq_val, dx_val)\n            if H_after_chem  H_before_chem + 1e-12:\n                entropy_stable = False\n            \n            # Advection substep (Forward Euler, Upwind)\n            cfl_step = a_val * t_step / dx_val\n            y = y_star - cfl_step * (y_star - np.roll(y_star, 1))\n\n        positivity = np.all(y = 0)\n        return y, positivity, entropy_stable\n\n    def run_imex(y_init, k, dt, T_final, a_val, y_eq_val, dx_val):\n        y = y_init.copy()\n        entropy_stable = True\n        \n        num_steps = int(T_final / dt)\n        remaining_time = T_final - num_steps * dt\n\n        time_steps = [dt] * num_steps\n        if remaining_time  1e-12:\n            time_steps.append(remaining_time)\n        \n        for t_step in time_steps:\n            H_before = discrete_entropy(y, y_eq_val, dx_val)\n            \n            # IMEX update\n            cfl_step = a_val * t_step / dx_val\n            advection_term = y - cfl_step * (y - np.roll(y, 1))\n            numerator = advection_term + k * t_step * y_eq_val\n            denominator = 1.0 + k * t_step\n            y = numerator / denominator\n            \n            H_after = discrete_entropy(y, y_eq_val, dx_val)\n            if H_after  H_before + 1e-12:\n                entropy_stable = False\n        \n        positivity = np.all(y = 0)\n        return y, positivity, entropy_stable\n\n    # Test cases\n    test_cases = [\n        (1000, 0.001),  # Case A\n        (8000, 0.01),   # Case B\n        (500, 0.02),    # Case C\n    ]\n    \n    all_results = []\n\n    for k_val, dt_val in test_cases:\n        y_be, p_be, e_be = run_split_be(y0, k_val, dt_val, T, a, y_eq, dx)\n        y_imex, p_imex, e_imex = run_imex(y0, k_val, dt_val, T, a, y_eq, dx)\n        y_ee, p_ee, e_ee = run_split_fe(y0, k_val, dt_val, T, a, y_eq, dx)\n        \n        d_l1 = np.sum(np.abs(y_imex - y_be)) * dx\n        \n        case_results = [p_be, e_be, p_imex, e_imex, p_ee, e_ee, d_l1]\n        all_results.append(case_results)\n\n    # Format output string\n    def format_val(v):\n        if isinstance(v, bool):\n            return str(v)\n        if isinstance(v, np.bool_):\n            return str(v)\n        return f\"{v:.15g}\"\n\n    sublist_strs = []\n    for res in all_results:\n        sublist_strs.append(f\"[{','.join(format_val(v) for v in res)}]\")\n    \n    final_output_str = f\"[{','.join(sublist_strs)}]\"\n\n    print(final_output_str)\n\nsolve()\n```", "id": "3519207"}]}