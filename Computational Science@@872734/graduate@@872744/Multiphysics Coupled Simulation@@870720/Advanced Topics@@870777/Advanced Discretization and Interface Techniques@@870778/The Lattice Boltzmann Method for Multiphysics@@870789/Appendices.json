{"hands_on_practices": [{"introduction": "A key question for the Lattice Boltzmann Method (LBM) is how a discrete, grid-based algorithm can accurately represent the physics of an isotropic continuum fluid. The answer lies in the careful choice of the discrete velocities and weights, which are designed to recover the correct macroscopic behavior through moment matching. This practice takes you under the hood to verify this foundational principle by examining the lattice's moment tensors, demonstrating how rotational invariance is achieved and why LBM is a valid fluid dynamics solver [@problem_id:3528782].", "problem": "You are tasked with deriving and coding a quantitative test for aliasing in lattice quadrature associated with the Lattice Boltzmann Method (LBM) in the context of multiphysics coupled simulation. Consider the three-dimensional nineteen-velocity model (D3Q19) with discrete velocities and weights chosen to approximate low-order moments of the Boltzmann distribution. Your goal is to derive a rigorous measure of discrete fourth-order isotropy and use it to predict the angular dependence of the effective shear viscosity in a rotated shear-driven cavity, all in lattice units.\n\nBegin from the following fundamental base:\n- The Lattice Boltzmann Method (LBM) approximates the Boltzmann equation using a finite set of discrete velocities and weights to reproduce low-order moments of the Maxwell-Boltzmann equilibrium. The discrete velocity set for D3Q19 is given by the set of vectors with components $c_{i\\alpha} \\in \\{-1,0,1\\}$ for $i \\in \\{0,\\dots,18\\}$ consisting of one rest vector, six axis-aligned face-centered vectors, and twelve edge-centered vectors. Explicitly:\n  - Rest vector: $c_0 = (0,0,0)$ with weight $w_0 = \\frac{1}{3}$.\n  - Axis-aligned vectors: $c = (\\pm 1,0,0)$, $c = (0,\\pm 1,0)$, $c = (0,0,\\pm 1)$ with weight $w = \\frac{1}{18}$ for each of the six.\n  - Edge-centered vectors: $c = (\\pm 1,\\pm 1,0)$, $c = (\\pm 1,0,\\pm 1)$, $c = (0,\\pm 1,\\pm 1)$ with weight $w = \\frac{1}{36}$ for each of the twelve. These vectors represent the directions along the edges of a cube and are formed by all permutations of two nonzero components equal to $\\pm 1$ and one zero component.\n- The lattice sound speed squared for D3Q19 is $c_s^2 = \\frac{1}{3}$, which is a well-tested property of the standard D3Q19 lattice with the above weights.\n\nDefine the discrete fourth-order moment tensor by\n$$\nL_{\\alpha\\beta\\gamma\\delta} = \\sum_{i=0}^{18} w_i \\, c_{i\\alpha} c_{i\\beta} c_{i\\gamma} c_{i\\delta}.\n$$\nFor an isotropic continuum, the fourth-order moment associated with the Maxwell-Boltzmann equilibrium is\n$$\nL_{\\alpha\\beta\\gamma\\delta}^{\\mathrm{iso}} = c_s^4 \\left( \\delta_{\\alpha\\beta}\\delta_{\\gamma\\delta} + \\delta_{\\alpha\\gamma}\\delta_{\\beta\\delta} + \\delta_{\\alpha\\delta}\\delta_{\\beta\\gamma} \\right),\n$$\nwhere $\\delta_{\\alpha\\beta}$ is the Kronecker delta.\n\nConsider a unit vector $\\mathbf{n}$ representing the direction of the primary shear wavevector in a shear-driven cavity rotated by an angle $\\theta$ around the $z$-axis. Use the rotation to define $\\mathbf{n}(\\theta) = (\\cos\\theta, \\sin\\theta, 0)$ in the $xy$-plane, where $\\theta$ is measured in radians. In lattice units, the effective shear viscosity $\\nu$ of the LBM model for small wavevectors is controlled by the relaxation dynamics, but angular dependence can arise from deviations of the discrete lattice quadrature from perfect isotropy. To quantify this, define the scalar discrete fourth-order contraction along $\\mathbf{n}$ by\n$$\nM_4(\\mathbf{n}) = \\sum_{i=0}^{18} w_i \\, (\\mathbf{c}_i \\cdot \\mathbf{n})^4,\n$$\nand compare it to the isotropic continuum value\n$$\nM_4^{\\mathrm{iso}} = 3 c_s^4,\n$$\nwhich follows from contracting $L_{\\alpha\\beta\\gamma\\delta}^{\\mathrm{iso}}$ with $n_\\alpha n_\\beta n_\\gamma n_\\delta$ for a unit vector $\\mathbf{n}$.\n\nYour tasks:\n1. Derive from first principles a discrete fourth-order isotropy measure $\\mathcal{I}_4(\\theta)$ that quantifies the relative deviation of $M_4(\\mathbf{n}(\\theta))$ from $M_4^{\\mathrm{iso}}$. This measure must be dimensionless and must equal $0$ if the discrete quadrature reproduces the isotropic contraction exactly along $\\mathbf{n}(\\theta)$.\n2. Using a leading-order small-wavevector Chapman-Enskog consistency argument, obtain a linearized prediction for the angular dependence of the effective shear viscosity $\\nu_{\\mathrm{eff}}(\\theta)$ in lattice units as a function of a base viscosity $\\nu_0$ and your derived measure $\\mathcal{I}_4(\\theta)$. Your prediction must reduce to $\\nu_{\\mathrm{eff}}(\\theta) = \\nu_0$ when $\\mathcal{I}_4(\\theta)=0$.\n3. Implement a complete, runnable program that:\n   - Constructs the D3Q19 velocity set and weights exactly as specified.\n   - Computes $\\mathcal{I}_4(\\theta)$ for given angles $\\theta$ by evaluating $M_4(\\mathbf{n}(\\theta))$ and normalizing against $M_4^{\\mathrm{iso}}$.\n   - Computes $\\nu_{\\mathrm{eff}}(\\theta)$ using your linearized prediction, in lattice units.\n   - Rounds all floating-point outputs to $10^{-12}$.\n   - Produces a single line of output containing the aggregated results for a test suite of angles and base viscosities, in the exact format described below.\n\nAngle unit requirement: express angles $\\theta$ in radians. Viscosity unit requirement: express viscosity in lattice units, assuming lattice spacing $\\Delta x = 1$ and time step $\\Delta t = 1$, so that kinematic viscosity $\\nu$ is dimensionless.\n\nTest suite:\n- Case $1$: base viscosity $\\nu_0 = 0.1$, angle $\\theta = 0$.\n- Case $2$: base viscosity $\\nu_0 = 0.1$, angle $\\theta = \\frac{\\pi}{8}$.\n- Case $3$: base viscosity $\\nu_0 = 0.1$, angle $\\theta = \\frac{\\pi}{4}$.\n- Case $4$: base viscosity $\\nu_0 = 0$, angle $\\theta = \\frac{\\pi}{3}$.\n\nFor each case, your program must compute the pair of floats $\\left[\\mathcal{I}_4(\\theta), \\nu_{\\mathrm{eff}}(\\theta)\\right]$ and aggregate all pairs into a single flat list ordered by case. Final Output Format: your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with pairs flattened in order, for example, $\\left[\\mathcal{I}_4(\\theta_1),\\nu_{\\mathrm{eff}}(\\theta_1),\\mathcal{I}_4(\\theta_2),\\nu_{\\mathrm{eff}}(\\theta_2),\\dots\\right]$.", "solution": "The problem requires the derivation and implementation of a quantitative test for lattice quadrature aliasing in the D3Q19 Lattice Boltzmann model. This involves deriving a measure of fourth-order isotropy, $\\mathcal{I}_4(\\theta)$, and using it to predict the angular dependence of the effective shear viscosity, $\\nu_{\\mathrm{eff}}(\\theta)$.\n\n### Validation of Problem Statement\n\nThe problem statement has been validated and is deemed sound. It is a well-posed problem rooted in the established theory of the Lattice Boltzmann Method. All provided data, including the D3Q19 velocity set, weights ($w_0 = 1/3, w_s = 1/18, w_d = 1/36$), and the lattice sound speed ($c_s^2 = 1/3$), are standard and internally consistent. The task is to apply fundamental principles of LBM theory to derive the quantities of interest, which is a valid scientific exercise. The problem appears designed to test the rigorous application of these principles, including the calculation of tensor moments and their physical implications.\n\n### Task 1: Derivation of the Discrete Fourth-Order Isotropy Measure $\\mathcal{I}_4(\\theta)$\n\nThe isotropy measure $\\mathcal{I}_4(\\theta)$ is defined as the dimensionless relative deviation of the discrete fourth-order scalar contraction, $M_4(\\mathbf{n}(\\theta))$, from its value in an isotropic continuum, $M_4^{\\mathrm{iso}}$.\nThe definition is thus:\n$$\n\\mathcal{I}_4(\\theta) = \\frac{M_4(\\mathbf{n}(\\theta)) - M_4^{\\mathrm{iso}}}{M_4^{\\mathrm{iso}}}\n$$\nThe isotropic value is given by $M_4^{\\mathrm{iso}} = 3 c_s^4$. With the lattice sound speed squared $c_s^2 = 1/3$, we have:\n$$\nM_4^{\\mathrm{iso}} = 3 \\left(\\frac{1}{3}\\right)^2 = 3 \\left(\\frac{1}{9}\\right) = \\frac{1}{3}\n$$\nThe discrete contraction $M_4(\\mathbf{n}(\\theta))$ is defined by:\n$$\nM_4(\\mathbf{n}(\\theta)) = \\sum_{i=0}^{18} w_i (\\mathbf{c}_i \\cdot \\mathbf{n}(\\theta))^4\n$$\nwhere $\\mathbf{n}(\\theta) = (\\cos\\theta, \\sin\\theta, 0)$. Let $n_x = \\cos\\theta$ and $n_y = \\sin\\theta$. The dot product is $\\mathbf{c}_i \\cdot \\mathbf{n}(\\theta) = c_{ix} n_x + c_{iy} n_y$. We can compute the sum by considering each class of velocity vectors in the D3Q19 set.\n\n1.  **Rest vector** ($\\mathbf{c}_0 = (0,0,0)$, weight $w_0 = 1/3$): The contribution is $w_0 (0)^4 = 0$.\n\n2.  **Axis-aligned vectors** (6 vectors, weight $w_s = 1/18$):\n    - For $\\mathbf{c} = (\\pm 1, 0, 0)$, the dot product is $\\pm n_x$. There are two such vectors. Contribution: $2 \\cdot \\frac{1}{18} (\\pm n_x)^4 = \\frac{1}{9} n_x^4$.\n    - For $\\mathbf{c} = (0, \\pm 1, 0)$, the dot product is $\\pm n_y$. There are two such vectors. Contribution: $2 \\cdot \\frac{1}{18} (\\pm n_y)^4 = \\frac{1}{9} n_y^4$.\n    - For $\\mathbf{c} = (0, 0, \\pm 1)$, the dot product is $0$. Contribution is $0$.\n    Total contribution from this set is $\\frac{1}{9}(n_x^4 + n_y^4)$.\n\n3.  **Edge-centered vectors** (12 vectors, weight $w_d = 1/36$):\n    - For $\\mathbf{c} = (\\pm 1, \\pm 1, 0)$, the dot products are $\\pm n_x \\pm n_y$. There are four such vectors. Contribution: $\\frac{1}{36} [ (n_x+n_y)^4 + (n_x-n_y)^4 + (-n_x+n_y)^4 + (-n_x-n_y)^4 ]$.\n      This simplifies to $\\frac{1}{36} [ 2(n_x+n_y)^4 + 2(n_x-n_y)^4 ] = \\frac{2}{36} [ (n_x^4 + 4n_x^3 n_y + 6n_x^2 n_y^2 + \\dots) + (n_x^4 - 4n_x^3 n_y + 6n_x^2 n_y^2 - \\dots) ] = \\frac{1}{18} [2n_x^4 + 12n_x^2 n_y^2 + 2n_y^4] = \\frac{1}{9}(n_x^4 + 6n_x^2 n_y^2 + n_y^4)$.\n    - For $\\mathbf{c} = (\\pm 1, 0, \\pm 1)$, the dot product is $\\pm n_x$. There are four such vectors. Contribution: $4 \\cdot \\frac{1}{36} (\\pm n_x)^4 = \\frac{1}{9} n_x^4$.\n    - For $\\mathbf{c} = (0, \\pm 1, \\pm 1)$, the dot product is $\\pm n_y$. There are four such vectors. Contribution: $4 \\cdot \\frac{1}{36} (\\pm n_y)^4 = \\frac{1}{9} n_y^4$.\n\nSumming all contributions:\n$$\nM_4(\\mathbf{n}(\\theta)) = 0 + \\frac{1}{9}(n_x^4 + n_y^4) + \\frac{1}{9}(n_x^4 + 6n_x^2 n_y^2 + n_y^4) + \\frac{1}{9} n_x^4 + \\frac{1}{9} n_y^4\n$$\n$$\nM_4(\\mathbf{n}(\\theta)) = \\frac{1}{9} [ (n_x^4 + n_y^4) + (n_x^4 + 6n_x^2 n_y^2 + n_y^4) + n_x^4 + n_y^4 ]\n$$\n$$\nM_4(\\mathbf{n}(\\theta)) = \\frac{1}{9} [ 3n_x^4 + 3n_y^4 + 6n_x^2 n_y^2 ] = \\frac{3}{9} [ n_x^4 + 2n_x^2 n_y^2 + n_y^4 ]\n$$\n$$\nM_4(\\mathbf{n}(\\theta)) = \\frac{1}{3} (n_x^2 + n_y^2)^2\n$$\nSince $\\mathbf{n}(\\theta)$ is a unit vector, $n_x^2 + n_y^2 = \\cos^2\\theta + \\sin^2\\theta = 1$. Therefore:\n$$\nM_4(\\mathbf{n}(\\theta)) = \\frac{1}{3}\n$$\nThis result shows that for the D3Q19 lattice, the discrete scalar contraction $M_4$ is constant for any direction $\\mathbf{n}$ in the $xy$-plane and is exactly equal to the isotropic continuum value, $M_4^{\\mathrm{iso}}$.\n\nSubstituting this result into the definition of $\\mathcal{I}_4(\\theta)$:\n$$\n\\mathcal{I}_4(\\theta) = \\frac{1/3 - 1/3}{1/3} = 0\n$$\nThe fourth-order isotropy measure is identically zero for all angles $\\theta$. This indicates the absence of fourth-order anisotropy for shear directions in the $xy$-plane for the standard D3Q19 model.\n\n### Task 2: Prediction of the Effective Shear Viscosity $\\nu_{\\mathrm{eff}}(\\theta)$\n\nThe problem requires a linearized prediction for $\\nu_{\\mathrm{eff}}(\\theta)$ as a function of a base viscosity $\\nu_0$ and the isotropy measure $\\mathcal{I}_4(\\theta)$. The relationship must satisfy $\\nu_{\\mathrm{eff}}(\\theta) = \\nu_0$ when $\\mathcal{I}_4(\\theta) = 0$.\nIn the Chapman-Enskog expansion, corrections to the viscosity arise from deviations of the discrete moments from their continuum isotropic counterparts. The relative correction to the viscosity, $\\frac{\\nu_{\\mathrm{eff}} - \\nu_0}{\\nu_0}$, is a function of these deviations. For small deviations, a linear relationship is a reasonable first-order approximation. We can postulate that the relative change in viscosity is directly proportional to our measure of anisotropy, $\\mathcal{I}_4(\\theta)$.\n$$\n\\frac{\\nu_{\\mathrm{eff}}(\\theta) - \\nu_0}{\\nu_0} \\approx k \\cdot \\mathcal{I}_4(\\theta)\n$$\nwhere $k$ is a constant of proportionality. Without a more detailed derivation to determine $k$, the most direct and simplest linearized model assumes $k=1$. This yields the prediction:\n$$\n\\nu_{\\mathrm{eff}}(\\theta) = \\nu_0 (1 + \\mathcal{I}_4(\\theta))\n$$\nThis model is dimensionally correct and satisfies the specified boundary condition.\n\nGiven our finding from Task 1 that $\\mathcal{I}_4(\\theta) = 0$ for all $\\theta$, the prediction for the effective viscosity becomes:\n$$\n\\nu_{\\mathrm{eff}}(\\theta) = \\nu_0 (1 + 0) = \\nu_0\n$$\nThis implies that, at the level of approximation associated with fourth-order moment tensors, the effective shear viscosity of the D3Q19 model is isotropic and equal to the base viscosity $\\nu_0$ for shear flows in the $xy$-plane.\n\n### Task 3: Implementation and Test Cases\n\nThe program will implement the derived formulas. For each test case, it will calculate $\\mathcal{I}_4(\\theta)$ and $\\nu_{\\mathrm{eff}}(\\theta)$. Based on our derivation, the result for $\\mathcal{I}_4(\\theta)$ will always be $0.0$, and the result for $\\nu_{\\mathrm{eff}}(\\theta)$ will be $\\nu_0$.\n\n-   **Case 1**: $\\nu_0 = 0.1$, $\\theta = 0$.\n    $\\mathcal{I}_4(0) = 0.0$.\n    $\\nu_{\\mathrm{eff}}(0) = 0.1(1 + 0) = 0.1$.\n-   **Case 2**: $\\nu_0 = 0.1$, $\\theta = \\pi/8$.\n    $\\mathcal{I}_4(\\pi/8) = 0.0$.\n    $\\nu_{\\mathrm{eff}}(\\pi/8) = 0.1(1 + 0) = 0.1$.\n-   **Case 3**: $\\nu_0 = 0.1$, $\\theta = \\pi/4$.\n    $\\mathcal{I}_4(\\pi/4) = 0.0$.\n    $\\nu_{\\mathrm{eff}}(\\pi/4) = 0.1(1 + 0) = 0.1$.\n-   **Case 4**: $\\nu_0 = 0.0$, $\\theta = \\pi/3$.\n    $\\mathcal{I}_4(\\pi/3) = 0.0$.\n    $\\nu_{\\mathrm{eff}}(\\pi/3) = 0.0(1 + 0) = 0.0$.\n\nThe program will compute these values and format them as requested.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes a fourth-order isotropy measure and the effective\n    shear viscosity for the D3Q19 Lattice Boltzmann model.\n    \"\"\"\n\n    # Define the D3Q19 lattice constants as specified in the problem.\n    # Velocities (c) and weights (w).\n    # Shell 0: rest particle\n    c = [(0, 0, 0)]\n    w = [1/3]\n    # Shell 1: axis-aligned vectors\n    c_s1 = [(1, 0, 0), (-1, 0, 0), (0, 1, 0), (0, -1, 0), (0, 0, 1), (0, 0, -1)]\n    c.extend(c_s1)\n    w.extend([1/18] * 6)\n    # Shell 2: edge-centered vectors\n    c_s2 = [\n        (1, 1, 0), (1, -1, 0), (-1, 1, 0), (-1, -1, 0),\n        (1, 0, 1), (1, 0, -1), (-1, 0, 1), (-1, 0, -1),\n        (0, 1, 1), (0, 1, -1), (0, -1, 1), (0, -1, -1),\n    ]\n    c.extend(c_s2)\n    w.extend([1/36] * 12)\n    \n    C = np.array(c, dtype=np.float64)\n    W = np.array(w, dtype=np.float64)\n\n    # Lattice sound speed squared and isotropic fourth moment contraction\n    c_s_sq = 1/3\n    M4_iso = 3 * c_s_sq**2\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0.1, 0.0),            # Case 1: nu_0 = 0.1, theta = 0\n        (0.1, np.pi / 8),    # Case 2: nu_0 = 0.1, theta = pi/8\n        (0.1, np.pi / 4),    # Case 3: nu_0 = 0.1, theta = pi/4\n        (0.0, np.pi / 3),    # Case 4: nu_0 = 0,   theta = pi/3\n    ]\n\n    results = []\n    \n    for nu_0, theta in test_cases:\n        # Define the unit vector n in the xy-plane\n        n = np.array([np.cos(theta), np.sin(theta), 0.0], dtype=np.float64)\n\n        # Task 1: Compute the discrete fourth-order isotropy measure I_4(theta)\n        \n        # Compute the discrete fourth-order scalar contraction M_4(n)\n        # M_4(n) = sum_{i} w_i * (c_i . n)^4\n        dot_products = C @ n\n        M4_n = np.sum(W * (dot_products**4))\n\n        # Compute the relative deviation I_4\n        # I_4(theta) = (M_4(n) - M_4_iso) / M_4_iso\n        I_4_theta = (M4_n / M4_iso) - 1\n\n        # Task 2: Compute the effective shear viscosity nu_eff(theta)\n        \n        # Using the derived linearized prediction: nu_eff = nu_0 * (1 + I_4)\n        nu_eff_theta = nu_0 * (1 + I_4_theta)\n\n        # Round results to 10^-12 as required\n        rounded_I_4 = round(I_4_theta, 12)\n        rounded_nu_eff = round(nu_eff_theta, 12)\n\n        results.extend([rounded_I_4, rounded_nu_eff])\n\n    # Final print statement in the exact required format.\n    # np.format_float_positional is used to prevent scientific notation for 0.0\n    formatted_results = [\n        np.format_float_positional(r, precision=12, fractional=False, trim='k')\n        for r in results\n    ]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3528782"}, {"introduction": "While LBM is powerful for multiphase flows, numerical errors can arise at the interface between phases, generating non-physical \"spurious\" currents. These currents are a direct consequence of the discretization of the forces that produce surface tension, and their magnitude depends on interface curvature, surface tension strength, and fluid viscosity. This exercise guides you through a scaling analysis to derive a predictive model for these artifacts, a vital skill for validating and improving the accuracy of multiphysics simulations [@problem_id:3528746].", "problem": "Consider a two-dimensional lattice Boltzmann method (LBM) for a multiphase fluid using a non-ideal equation of state, such that an interface separates two phases and a macroscopic surface tension is induced by the non-ideal pressure tensor. The method employs a single-relaxation-time Bhatnagar-Gross-Krook (BGK) collision operator, a standard D2Q9 discrete velocity set, and a pseudopotential-based forcing scheme. In practice, discrete anisotropy of the force reconstruction combined with the non-ideal equation of state generates interface-normal and interface-tangential discretization errors that manifest as spurious currents near curved interfaces.\n\nStarting from the continuum, low-Reynolds-number, steady momentum balance, combine mechanical equilibrium at a curved interface and the discrete-force anisotropy scaling to derive an explicit asymptotic scaling for the maximum spurious speed near a circular interface. Use the following bases:\n\n- The steady Stokes momentum balance for a Newtonian fluid, $0 = -\\nabla p + \\mu \\nabla^2 \\mathbf{u} + \\mathbf{f}$, where $\\mu$ is the dynamic viscosity and $\\mathbf{f}$ is a body-force density.\n- The Young–Laplace relation between the pressure jump across a curved interface and surface tension, $\\Delta p = \\sigma \\kappa$, where $\\sigma$ is the surface tension and $\\kappa$ is the curvature. For a circle of radius $R$, $\\kappa = 1/R$.\n- The lattice Boltzmann mapping between relaxation time and kinematic viscosity in physical units for D2Q9 with lattice spacing $dx$ and time step $dt$, namely $\\nu = \\dfrac{dx^2}{3\\,dt}\\left(\\tau - \\dfrac{1}{2}\\right)$, and $\\mu = \\rho \\nu$, where $\\rho$ is mass density.\n- A second-order accurate discrete-force anisotropy characterized by a dimensionless coefficient $\\alpha$, which is defined as the amplitude of the leading-order relative error in the interface capillary force reconstruction. Assume the interface thickness $w$ scales as $w \\sim \\mathcal{O}(dx)$.\n\nYour derivation must identify how the non-ideal equation of state influences the strength of spurious currents through the induced surface tension and explain why the predicted spurious currents vanish in the planar-interface limit. The result should be an explicit formula for the maximum spurious speed at the interface in terms of $\\alpha$, $\\sigma$, $dx$, $\\mu$, and $R$, expressed in meters per second.\n\nThen, implement a program that computes the predicted maximum spurious speed for a set of test cases. The program should accept, for each case, either direct specification of $\\mu$ or specification of $\\tau$, $dx$, $dt$, and $\\rho$, from which $\\mu$ must be computed. If $R = 0$ is specified, interpret this as the planar-interface limit and return the spurious speed as exactly zero.\n\nPhysical units and output requirements:\n\n- Express all speeds in meters per second (m/s), rounded to six decimal places.\n- Angles do not appear in this problem.\n- No percentages are used.\n\nTest suite and parameter coverage:\n\n- Case 1 (general curved-interface case; viscosity computed from relaxation time): $\\alpha = 0.5$, $\\sigma = 0.072$ N/m, $dx = 1.0 \\times 10^{-5}$ m, $R = 1.0 \\times 10^{-3}$ m, $\\tau = 0.8$, $\\rho = 1000$ kg/m$^3$, $dt = 5.0 \\times 10^{-7}$ s.\n- Case 2 (planar-interface boundary case): $\\alpha = 0.5$, $\\sigma = 0.072$ N/m, $dx = 1.0 \\times 10^{-5}$ m, $R = 0$ m (planar-interface limit), $\\mu = 0.02$ Pa·s.\n- Case 3 (small-radius edge case; viscosity computed from relaxation time): $\\alpha = 0.5$, $\\sigma = 0.072$ N/m, $dx = 1.0 \\times 10^{-5}$ m, $R = 5.0 \\times 10^{-5}$ m, $\\tau = 0.8$, $\\rho = 1000$ kg/m$^3$, $dt = 5.0 \\times 10^{-7}$ s.\n- Case 4 (high-viscosity case; direct viscosity): $\\alpha = 0.5$, $\\sigma = 0.072$ N/m, $dx = 1.0 \\times 10^{-5}$ m, $R = 1.0 \\times 10^{-3}$ m, $\\mu = 0.1$ Pa·s.\n- Case 5 (zero-anisotropy edge case): $\\alpha = 0.0$, $\\sigma = 0.072$ N/m, $dx = 1.0 \\times 10^{-5}$ m, $R = 5.0 \\times 10^{-4}$ m, $\\mu = 0.02$ Pa·s.\n\nFinal output format:\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result1,result2,...]$), with each result rounded to six decimal places in m/s, in the same order as the above test cases.", "solution": "The problem is valid as it is scientifically grounded in the principles of computational fluid dynamics, specifically the analysis of numerical artifacts in the lattice Boltzmann method (LBM) for multiphase flows. It is well-posed, objective, and provides a complete and consistent set of information for deriving the requested scaling law and performing the required calculations.\n\nThe derivation of the asymptotic scaling for the maximum spurious speed, denoted as $u_{max}$, proceeds as follows.\n\n1.  **Governing Momentum Balance:** The spurious currents are a steady-state flow phenomenon driven by numerical errors in the implementation of the capillary force, $\\delta \\mathbf{f}$. In the low-Reynolds-number limit, this flow is governed by the steady Stokes equation:\n    $$ 0 = -\\nabla p_{err} + \\mu \\nabla^2 \\mathbf{u} + \\delta \\mathbf{f} $$\n    Here, $\\mathbf{u}$ is the spurious velocity field, $p_{err}$ is an associated error pressure field, and $\\mu$ is the dynamic viscosity. From this equation, we can establish a balance between the viscous dissipation term and the driving error force term:\n    $$ |\\mu \\nabla^2 \\mathbf{u}| \\sim |\\delta \\mathbf{f}| $$\n\n2.  **Characterization of the Capillary Force:** The non-ideal equation of state gives rise to a surface tension $\\sigma$ at the interface between the two fluid phases. This surface tension maintains a pressure jump $\\Delta p$ across a curved interface, as described by the Young–Laplace relation:\n    $$ \\Delta p = \\sigma \\kappa $$\n    For a circular interface of radius $R$, the curvature is $\\kappa = 1/R$. In numerical methods like LBM, this force is not a true surface force but is smeared over a diffuse interface of finite thickness $w$. The magnitude of the corresponding force density, $f_{\\sigma}$, can be estimated by distributing the pressure jump across this thickness:\n    $$ f_{\\sigma} \\sim \\frac{\\Delta p}{w} = \\frac{\\sigma \\kappa}{w} = \\frac{\\sigma}{R w} $$\n\n3.  **Characterization of the Error Force:** The problem states that spurious currents arise from a discrete-force anisotropy, which introduces a relative error in the reconstruction of the capillary force. The magnitude of this error is given by a dimensionless coefficient $\\alpha$. Thus, the magnitude of the error force density, $\\delta f = |\\delta \\mathbf{f}|$, is proportional to the magnitude of the physical force density:\n    $$ \\delta f \\sim \\alpha f_{\\sigma} \\sim \\frac{\\alpha \\sigma}{R w} $$\n\n4.  **Scaling Analysis:** We now substitute the force estimate into the momentum balance. To estimate the viscous term, let $u_{max}$ be the characteristic spurious speed. The error force $\\delta \\mathbf{f}$ is active within the interface region of thickness $w$. The resulting flow field's sharpest velocity gradients will occur across this same length scale. Therefore, the characteristic length for the spatial derivatives of velocity is $L \\sim w$. The viscous term scales as:\n    $$ |\\mu \\nabla^2 \\mathbf{u}| \\sim \\mu \\frac{u_{max}}{L^2} \\sim \\mu \\frac{u_{max}}{w^2} $$\n    Equating the scaled viscous and force terms:\n    $$ \\mu \\frac{u_{max}}{w^2} \\sim \\frac{\\alpha \\sigma}{R w} $$\n\n5.  **Derivation of the Speed Scaling:** Solving the above relation for $u_{max}$ yields:\n    $$ u_{max} \\sim \\frac{\\alpha \\sigma w^2}{\\mu R w} = \\frac{\\alpha \\sigma w}{\\mu R} $$\n\n6.  **Incorporation of Lattice Discretization:** The problem states that the interface thickness $w$ scales with the lattice spacing $dx$, i.e., $w \\sim \\mathcal{O}(dx)$. This is a fundamental property of many diffuse-interface LBM schemes. Substituting this dependency into our scaling for $u_{max}$:\n    $$ u_{max} \\propto \\frac{\\alpha \\sigma \\, dx}{\\mu R} $$\n    For an explicit asymptotic formula, we assume a leading-order proportionality constant of unity. This is a common practice in scaling analysis when the precise prefactor, which depends on the specific numerical stencils used, is not provided. The final formula is:\n    $$ u_{max} = \\frac{\\alpha \\sigma \\, dx}{\\mu R} $$\n    The units of this expression are $(\\text{N}/\\text{m}) \\cdot \\text{m} / ((\\text{Pa} \\cdot \\text{s}) \\cdot \\text{m}) = ((\\text{kg} \\cdot \\text{m}/\\text{s}^2)/\\text{m}) \\cdot \\text{m} / ((\\text{kg}/(\\text{m} \\cdot \\text{s})) \\cdot \\text{m}) = (\\text{kg}/\\text{s}^2) / (\\text{kg}/\\text{m}^2 \\cdot \\text{s}) = \\text{m}/\\text{s}$, which is correctly a velocity.\n\n7.  **Influence of the Equation of State (EOS) and Planar Limit:**\n    - The non-ideal EOS is the physical origin of phase separation and, consequently, the surface tension $\\sigma$. A stronger intermolecular potential in the EOS leads to a larger $\\sigma$. The derived formula $u_{max} \\propto \\sigma$ shows that a stronger surface tension results in proportionally larger spurious currents, assuming all other parameters are constant.\n    - In the limit of a planar interface, the radius of curvature $R \\to \\infty$. The formula correctly predicts that the spurious currents vanish:\n      $$ \\lim_{R \\to \\infty} u_{max} = \\lim_{R \\to \\infty} \\frac{\\alpha \\sigma \\, dx}{\\mu R} = 0 $$\n      This is physically correct because for a planar interface, the curvature $\\kappa=0$, meaning the driving capillary force is zero, and thus any error in computing this force must also be zero.\n\n8.  **Calculation of Viscosity:** When the dynamic viscosity $\\mu$ is not directly provided, it must be calculated from the LBM parameters. The kinematic viscosity $\\nu$ is given by:\n    $$ \\nu = \\frac{dx^2}{3\\,dt}\\left(\\tau - \\frac{1}{2}\\right) $$\n    The dynamic viscosity is then $\\mu = \\rho \\nu$, where $\\rho$ is the fluid density.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the maximum spurious speed in a lattice Boltzmann simulation\n    for a set of test cases based on a derived asymptotic scaling law.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: General curved-interface, viscosity from LBM params\n        {'alpha': 0.5, 'sigma': 0.072, 'dx': 1.0e-5, 'R': 1.0e-3, 'tau': 0.8, 'rho': 1000, 'dt': 5.0e-7},\n        # Case 2: Planar-interface limit\n        {'alpha': 0.5, 'sigma': 0.072, 'dx': 1.0e-5, 'R': 0, 'mu': 0.02},\n        # Case 3: Small-radius edge case\n        {'alpha': 0.5, 'sigma': 0.072, 'dx': 1.0e-5, 'R': 5.0e-5, 'tau': 0.8, 'rho': 1000, 'dt': 5.0e-7},\n        # Case 4: High-viscosity case, direct mu\n        {'alpha': 0.5, 'sigma': 0.072, 'dx': 1.0e-5, 'R': 1.0e-3, 'mu': 0.1},\n        # Case 5: Zero-anisotropy edge case\n        {'alpha': 0.0, 'sigma': 0.072, 'dx': 1.0e-5, 'R': 5.0e-4, 'mu': 0.02},\n    ]\n\n    results = []\n    for case in test_cases:\n        alpha = case['alpha']\n        sigma = case['sigma']\n        dx = case['dx']\n        R = case['R']\n\n        # Handle special cases that result in zero spurious speed.\n        # R=0 is defined as the planar-interface limit.\n        # alpha=0 means no anisotropy error.\n        if R == 0 or alpha == 0:\n            u_max = 0.0\n            results.append(f\"{u_max:.6f}\")\n            continue\n\n        # Determine dynamic viscosity mu\n        if 'mu' in case:\n            mu = case['mu']\n        else:\n            # Calculate mu from LBM parameters\n            tau = case['tau']\n            rho = case['rho']\n            dt = case['dt']\n            # Kinematic viscosity: nu = c_s^2 * (tau - 0.5) * dt\n            # For D2Q9, c_s^2 = (dx/dt)^2 / 3, so nu = (dx^2 / (3*dt)) * (tau - 0.5)\n            nu = (dx**2 / (3 * dt)) * (tau - 0.5)\n            mu = rho * nu\n\n        # Calculate maximum spurious speed using the derived formula\n        # u_max = (alpha * sigma * dx) / (mu * R)\n        u_max = (alpha * sigma * dx) / (mu * R)\n        \n        # Round and format the result\n        results.append(f\"{u_max:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3528746"}, {"introduction": "Many advanced multiphysics applications involve complex, non-Newtonian fluids like polymer solutions. This practice challenges you to build a hybrid solver that couples the LBM for the fluid solvent with a finite-difference scheme for the polymer stress, described by the Oldroyd-B model. By simulating the dramatic coil-stretch transition in an extensional flow, you will gain hands-on experience in coupling different numerical methods to capture a hallmark phenomenon in complex fluid dynamics, showcasing the versatility of LBM in a true multiphysics framework [@problem_id:3528785].", "problem": "Construct a complete, runnable program that implements a two-dimensional hybrid Lattice Boltzmann Method (LBM) for an isothermal, incompressible, viscoelastic fluid modeled by the Oldroyd–B constitutive law. The goal is to capture and classify the coil–stretch transition in a periodically forced, spatially periodic flow as the Weissenberg number increases. All mathematical entities must be expressed in LaTeX. All quantities are nondimensional (lattice units), so no physical unit conversions are required.\n\nThe fundamental base you must start from consists of:\n- The isothermal, incompressible Navier–Stokes equations with an extra polymer stress,\n$$\\rho\\left(\\partial_t \\mathbf{u} + \\mathbf{u}\\cdot\\nabla\\mathbf{u}\\right) = -\\nabla p + \\eta_s \\nabla^2 \\mathbf{u} + \\nabla\\cdot\\mathbf{\\tau} + \\mathbf{f}_{\\text{ext}}, \\quad \\nabla\\cdot\\mathbf{u} = 0$$\nwhere $\\rho$ is the mass density, $\\mathbf{u}$ is the velocity field, $p$ is the pressure, $\\eta_s$ is the solvent viscosity, $\\mathbf{\\tau}$ is the polymer extra-stress tensor, and $\\mathbf{f}_{\\text{ext}}$ is an externally imposed body force density.\n\n- The Oldroyd–B constitutive equation for the polymer stress with the upper-convected derivative,\n$$\\overset{\\nabla}{\\mathbf{\\tau}} + \\frac{1}{\\lambda}\\mathbf{\\tau} = \\frac{\\eta_p}{\\lambda}\\left(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\top}\\right), \\quad \\text{with} \\quad \\overset{\\nabla}{\\mathbf{\\tau}} \\equiv \\partial_t \\mathbf{\\tau} + \\mathbf{u}\\cdot\\nabla \\mathbf{\\tau} - \\left(\\nabla \\mathbf{u}\\right)^{\\top}\\cdot \\mathbf{\\tau} - \\mathbf{\\tau}\\cdot \\left(\\nabla \\mathbf{u}\\right)$$\nwhere $\\lambda$ is the polymer relaxation time and $\\eta_p$ is the polymer contribution to the viscosity.\n\n- The single-relaxation-time Bhatnagar–Gross–Krook (BGK) Lattice Boltzmann Method (LBM) on a D2Q9 lattice for the solvent momentum dynamics. In lattice units with lattice spacing $\\Delta x = 1$ and time step $\\Delta t = 1$, the equilibrium distribution uses the standard second-order expansion, and the kinematic viscosity is related to the relaxation time by\n$$\\nu = c_s^2\\left(\\tau_s - \\frac{1}{2}\\right), \\quad c_s^2 = \\frac{1}{3}$$\nExternal and polymer forces are incorporated via a consistent forcing scheme that adds a body force density $\\mathbf{F} = \\mathbf{f}_{\\text{ext}} + \\nabla\\cdot \\mathbf{\\tau}$ to the momentum equation.\n\n- The coil–stretch transition of Hookean dumbbells in planar extensional flow occurs at the critical Weissenberg number\n$$Wi_c = \\lambda \\dot{\\epsilon}_0 = \\frac{1}{2}$$\nwhere $\\dot{\\epsilon}_0$ is the local extensional rate near a stagnation point.\n\nYou must design and implement the following in your program:\n\n1) Domain and discretization. Use a square periodic domain discretized on a D2Q9 lattice with $N \\times N$ nodes. All fields are periodic in both directions. Use $N = 32$. Define the wavenumber\n$$k = m \\frac{2\\pi}{N}$$\nwith $m = 4$.\n\n2) External forcing. Drive a four-roll-mill-type periodic flow using a body force density\n$$\\mathbf{f}_{\\text{ext}}(x,y) = f_0 \\begin{bmatrix} \\sin\\left(k x\\right)\\cos\\left(k y\\right) \\\\ -\\cos\\left(k x\\right)\\sin\\left(k y\\right) \\end{bmatrix}$$\nFor Stokes flow balance with this forcing, the steady-state velocity field has the form\n$$\\mathbf{u}(x,y) \\approx U_0 \\begin{bmatrix} \\sin\\left(k x\\right)\\cos\\left(k y\\right) \\\\ -\\cos\\left(k x\\right)\\sin\\left(k y\\right) \\end{bmatrix}$$\nwith an extensional rate near a stagnation point given by $\\dot{\\epsilon}_0 \\approx k U_0$ and, for the Stokes limit, the amplitude obeys\n$$U_0 \\approx \\frac{f_0}{2\\nu k^2}$$\nChoose a target velocity amplitude $U_0^\\star = 0.05$ and determine $f_0$ from\n$$f_0 = 2 \\nu k^2 U_0^\\star$$\n\n3) LBM solvent solver. Implement a D2Q9 BGK LBM with relaxation time $\\tau_s = 0.6$ so that\n$$\\nu = \\frac{1}{3}\\left(\\tau_s - \\frac{1}{2}\\right)$$\nUse the Guo forcing scheme or an equivalent consistent method to incorporate the total body force density $\\mathbf{F} = \\mathbf{f}_{\\text{ext}} + \\nabla\\cdot \\mathbf{\\tau}$. Compute macroscopic velocity using the standard momentum update with the half-step force correction,\n$$\\rho \\mathbf{u} = \\sum_i \\mathbf{c}_i f_i + \\frac{1}{2}\\mathbf{F}, \\quad \\rho = \\sum_i f_i$$\nwhere $f_i$ are the populations and $\\mathbf{c}_i$ are the discrete lattice velocities.\n\n4) Polymer stress evolution. Evolve the polymer stress $\\mathbf{\\tau}$ using an explicit time integrator for the Oldroyd–B model in lattice units,\n$$\\partial_t \\mathbf{\\tau} = - \\mathbf{u}\\cdot\\nabla \\mathbf{\\tau} + \\left(\\nabla \\mathbf{u}\\right)^{\\top}\\cdot \\mathbf{\\tau} + \\mathbf{\\tau}\\cdot \\left(\\nabla \\mathbf{u}\\right) - \\frac{1}{\\lambda}\\mathbf{\\tau} + \\frac{\\eta_p}{\\lambda}\\left(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\top}\\right)$$\nDiscretize spatial derivatives by centered finite differences under periodic boundary conditions. For numerical regularization, include a small, uniform artificial stress diffusion $\\kappa \\nabla^2 \\mathbf{\\tau}$ with a constant $\\kappa$ satisfying $\\kappa \\ll 1$. Use $\\kappa = 10^{-4}$. Use $\\eta_p = 0.02$ and initialize $\\mathbf{\\tau} = \\mathbf{0}$ everywhere.\n\n5) Coil–stretch detection. Let the extensional rate near the stagnation point be approximated by $\\dot{\\epsilon}_0 \\approx k U_0^\\star$. The critical relaxation time is\n$$\\lambda_c = \\frac{1}{2 \\dot{\\epsilon}_0} = \\frac{1}{2 k U_0^\\star}$$\nDefine a test suite of three relaxation times,\n$$\\lambda_1 = 0.8\\,\\lambda_c, \\quad \\lambda_2 = 1.0\\,\\lambda_c, \\quad \\lambda_3 = 1.4\\,\\lambda_c$$\nFor each $\\lambda_j$, run the coupled LBM–Oldroyd–B simulation for $T$ time steps with $T = 2000$. At each step, compute\n$$M(t) = \\max_{x,y} \\operatorname{tr}\\left(\\mathbf{\\tau}(x,y,t)\\right)$$\nand record $M(t)$. After discarding an initial transient of $T_b$ steps with $T_b = 500$, estimate the exponential growth rate by fitting a straight line to $\\log\\left(M(t) + \\delta\\right)$ over the last $W$ steps, with $W = 400$ and $\\delta = 10^{-12}$ to avoid the logarithm of zero. Classify the state as stretched if the fitted slope $s$ satisfies $s > s_{\\text{th}}$ with $s_{\\text{th}} = 5\\times 10^{-4}$, otherwise classify as coiled. If $\\max_t M(t)$ exceeds a large cutoff $M_{\\max} = 10^6$ at any time, immediately classify as stretched for that case.\n\n6) Test suite and final output. Use the fixed parameters $N = 32$, $m = 4$, $\\tau_s = 0.6$, $\\eta_p = 0.02$, $\\kappa = 10^{-4}$, $U_0^\\star = 0.05$, $T = 2000$, $T_b = 500$, $W = 400$, $\\delta = 10^{-12}$, $s_{\\text{th}} = 5\\times 10^{-4}$, $M_{\\max} = 10^6$, and $\\rho = 1$. The three test cases are the relaxation times $\\lambda_1$, $\\lambda_2$, $\\lambda_3$ defined above. Your program should produce a single line of output containing the results as a comma-separated list of booleans enclosed in square brackets (e.g., \"[False,False,True]\"), corresponding to the coil–stretch classification for $\\lambda_1$, $\\lambda_2$, and $\\lambda_3$, respectively. All outputs are dimensionless.", "solution": "The user has requested the construction of a hybrid numerical simulation for a viscoelastic fluid. The problem is well-posed, scientifically grounded, and provides all necessary parameters and equations to formulate a unique solution. The methodology will combine the Lattice Boltzmann Method (LBM) for the solvent hydrodynamics with a finite difference method (FDM) for the evolution of the polymer extra-stress tensor, governed by the Oldroyd-B constitutive model.\n\nThe simulation proceeds as follows:\n\nFirst, we establish the computational domain and initial conditions. A two-dimensional square domain of size $N \\times N$ with $N=32$ is used, with periodic boundary conditions in both directions. The lattice positions are represented by integer coordinates $(i,j)$ where $i, j \\in \\{0, 1, \\dots, N-1\\}$. The corresponding physical coordinates are $(x, y) = (i \\Delta x, j \\Delta y)$, where the lattice spacing is set to $\\Delta x = \\Delta y = 1$. All fields are initialized to a quiescent state: velocity $\\mathbf{u}(x,y,0) = \\mathbf{0}$, constant density $\\rho(x,y,0) = \\rho_0=1$, and zero polymer stress $\\mathbf{\\tau}(x,y,0) = \\mathbf{0}$.\n\nThe flow is driven by a time-independent external body force, creating a four-roll mill pattern:\n$$\n\\mathbf{f}_{\\text{ext}}(x,y) = f_0 \\begin{bmatrix} \\sin(kx)\\cos(ky) \\\\ -\\cos(kx)\\sin(ky) \\end{bmatrix}\n$$\nwhere the wavenumber is $k = m \\frac{2\\pi}{N}$ with $m=4$. The force amplitude $f_0$ is chosen to match a target velocity amplitude $U_0^\\star = 0.05$ in the Stokes flow limit, given by $f_0 = 2\\nu k^2 U_0^\\star$. The kinematic viscosity of the solvent is determined by the LBM relaxation parameter $\\tau_s=0.6$ as $\\nu = c_s^2(\\tau_s - 1/2)$, where the lattice speed of sound squared is $c_s^2 = 1/3$.\n\nThe simulation evolves in discrete time steps of $\\Delta t=1$. At each time step, the following sequence of calculations is performed:\n\n1.  **Polymer Force Calculation**: The polymer stress tensor $\\mathbf{\\tau}$ exerts a force on the fluid, given by its divergence $\\mathbf{F}_p = \\nabla \\cdot \\mathbf{\\tau}$. The components of this force are:\n    $$\n    (\\mathbf{F}_p)_x = \\frac{\\partial \\tau_{xx}}{\\partial x} + \\frac{\\partial \\tau_{xy}}{\\partial y} \\quad \\text{and} \\quad (\\mathbf{F}_p)_y = \\frac{\\partial \\tau_{yx}}{\\partial x} + \\frac{\\partial \\tau_{yy}}{\\partial y}\n    $$\n    Assuming symmetry of the stress tensor ($\\tau_{xy} = \\tau_{yx}$), these derivatives are computed on the grid using a second-order centered finite difference scheme with periodic boundary conditions. For a generic field $\\phi(x,y)$, the derivatives are approximated as:\n    $$\n    \\frac{\\partial \\phi}{\\partial x}\\bigg|_{(i,j)} \\approx \\frac{\\phi_{i+1,j} - \\phi_{i-1,j}}{2\\Delta x}, \\quad \\frac{\\partial \\phi}{\\partial y}\\bigg|_{(i,j)} \\approx \\frac{\\phi_{i,j+1} - \\phi_{i,j-1}}{2\\Delta y}\n    $$\n\n2.  **LBM Solver for Solvent Dynamics**: The motion of the solvent is modeled using a D2Q9 Lattice Boltzmann scheme with the Bhatnagar-Gross-Krook (BGK) collision operator. The evolution of the discrete particle distribution functions $f_i(\\mathbf{x}, t)$ for each of the $9$ lattice velocities $\\mathbf{c}_i$ is split into collision and streaming steps. The total force density on the fluid is $\\mathbf{F} = \\mathbf{f}_{\\text{ext}} + \\mathbf{F}_p$.\n\n    a. **Macroscopic Variables**: The macroscopic fluid density $\\rho$ and velocity $\\mathbf{u}$ are recovered from the distribution functions. The velocity calculation includes the Guo forcing term correction:\n    $$\n    \\rho = \\sum_{i=0}^{8} f_i, \\quad \\rho \\mathbf{u} = \\sum_{i=0}^{8} \\mathbf{c}_i f_i + \\frac{\\Delta t}{2}\\mathbf{F}\n    $$\n\n    b. **Collision**: The post-collision distribution functions $f_i^*$ are computed by relaxing the current distributions $f_i$ towards a local equilibrium $f_i^{\\text{eq}}$ and adding a force term $S_i$:\n    $$\n    f_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x}, t) - \\frac{\\Delta t}{\\tau_s} \\left(f_i(\\mathbf{x}, t) - f_i^{\\text{eq}}(\\rho, \\mathbf{u})\\right) + \\Delta t \\, S_i\n    $$\n    The equilibrium distribution function $f_i^{\\text{eq}}$ is a second-order polynomial in velocity:\n    $$\n    f_i^{\\text{eq}} = w_i \\rho \\left( 1 + \\frac{\\mathbf{c}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})^2}{2c_s^4} - \\frac{\\mathbf{u} \\cdot \\mathbf{u}}{2c_s^2} \\right)\n    $$\n    where $w_i$ are the standard D2Q9 weights. The Guo forcing term $S_i$ is given by:\n    $$\n    S_i = \\left(1 - \\frac{1}{2\\tau_s}\\right) w_i \\left[ \\frac{\\mathbf{c}_i - \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})\\mathbf{c}_i}{c_s^4} \\right] \\cdot \\mathbf{F}\n    $$\n\n    c. **Streaming**: The distribution functions are propagated to neighboring lattice sites according to their discrete velocities:\n    $$\n    f_i(\\mathbf{x} + \\mathbf{c}_i \\Delta t, t + \\Delta t) = f_i^*(\\mathbf{x}, t)\n    $$\n\n3.  **FDM Solver for Polymer Stress**: The polymer stress tensor $\\mathbf{\\tau}$ is evolved according to the Oldroyd-B constitutive equation, which is explicitly integrated in time using a first-order forward Euler scheme. The equation provided in the problem is:\n    $$\n    \\partial_t \\mathbf{\\tau} = - \\mathbf{u}\\cdot\\nabla \\mathbf{\\tau} + \\left(\\nabla \\mathbf{u}\\right)^{\\top}\\cdot \\mathbf{\\tau} + \\mathbf{\\tau}\\cdot \\left(\\nabla \\mathbf{u}\\right) - \\frac{1}{\\lambda}\\mathbf{\\tau} + \\frac{\\eta_p}{\\lambda}\\left(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\top}\\right) + \\kappa \\nabla^2 \\mathbf{\\tau}\n    $$\n    Here, $\\lambda$ is the polymer relaxation time, $\\eta_p=0.02$ is the polymer viscosity, and $\\kappa=10^{-4}$ is an artificial stress diffusivity for numerical stabilization. The velocity $\\mathbf{u}$ and its gradient tensor $\\nabla \\mathbf{u}$ are obtained from the LBM step. All spatial derivatives on the right-hand side (convective term $\\mathbf{u}\\cdot\\nabla \\mathbf{\\tau}$, velocity gradients in $\\nabla \\mathbf{u}$, and the Laplacian $\\nabla^2 \\mathbf{\\tau}$) are computed using centered finite differences. Since $\\mathbf{\\tau}$ is symmetric, only its components $\\tau_{xx}$, $\\tau_{yy}$, and $\\tau_{xy}$ are evolved.\n\n4.  **Coil-Stretch Transition Analysis**: The simulation is performed for three different values of the relaxation time $\\lambda$, determined relative to the critical value $\\lambda_c$ for coil-stretch transition in an ideal extensional flow. The characteristic strain rate is estimated as $\\dot{\\epsilon}_0 \\approx k U_0^\\star$, which gives $\\lambda_c = (2\\dot{\\epsilon}_0)^{-1}$. The test cases are $\\lambda_1 = 0.8\\lambda_c$, $\\lambda_2 = 1.0\\lambda_c$, and $\\lambda_3 = 1.4\\lambda_c$.\n\n    For each case, the simulation runs for $T=2000$ time steps. The maximum trace of the stress tensor, $M(t) = \\max_{x,y} \\operatorname{tr}(\\mathbf{\\tau}(x,y,t))$, is recorded at each step. A state is immediately classified as \"stretched\" if $M(t)$ exceeds a blow-up threshold $M_{\\max}=10^6$. Otherwise, after the full simulation, the time series $\\log(M(t)+\\delta)$ for $t \\in [T-W, T-1)$ is analyzed, where the transient period is $T_b=500$ steps and the analysis window is $W=400$ steps. A linear regression is performed on this data, and if the resulting slope $s$ is greater than a threshold $s_{\\text{th}}=5 \\times 10^{-4}$, the state is classified as \"stretched\". Otherwise, it is \"coiled\". The boolean results for the three cases are then reported.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a hybrid LBM-FDM solver for a 2D viscoelastic fluid (Oldroyd-B model)\n    to study the coil-stretch transition in a four-roll mill flow.\n    \"\"\"\n\n    # 1) Domain and discretization parameters\n    N = 32\n    m = 4\n    k = m * 2.0 * np.pi / N\n\n    # Simulation and analysis parameters\n    T = 2000\n    T_b = 500  # Burn-in/transient time\n    W = 400    # Analysis window size\n    delta_log = 1e-12\n    s_th = 5e-4\n    M_max = 1e6\n    assert T > T_b + W\n\n    # LBM parameters\n    rho0 = 1.0\n    tau_s = 0.6\n    c_s_sq = 1.0 / 3.0\n    nu = c_s_sq * (tau_s - 0.5)  # Kinematic viscosity eta_s / rho\n    \n    # D2Q9 lattice parameters\n    c = np.array([[0, 0], [1, 0], [0, 1], [-1, 0], [0, -1],\n                  [1, 1], [-1, 1], [-1, -1], [1, -1]], dtype=np.int32)\n    w = np.array([4.0/9.0, 1.0/9.0, 1.0/9.0, 1.0/9.0, 1.0/9.0,\n                  1.0/36.0, 1.0/36.0, 1.0/36.0, 1.0/36.0])\n\n    # Fluid and polymer parameters\n    U0_star = 0.05\n    f0 = 2.0 * nu * k**2 * U0_star\n    eta_p = 0.02\n    kappa = 1e-4\n\n    # 2) External forcing setup\n    x = np.arange(N)\n    y = np.arange(N)\n    X, Y = np.meshgrid(x, y)\n    \n    f_ext = np.zeros((2, N, N))\n    f_ext[0, :, :] = f0 * np.sin(k * X) * np.cos(k * Y)\n    f_ext[1, :, :] = -f0 * np.cos(k * X) * np.sin(k * Y)\n\n    # 5) Coil–stretch detection parameters\n    epsilon0_dot = k * U0_star\n    lambda_c = 0.5 / epsilon0_dot\n    lambdas = [0.8 * lambda_c, 1.0 * lambda_c, 1.4 * lambda_c]\n\n    results = []\n\n    # Helper functions for finite differences (periodic BCs, dx=dy=1)\n    def grad_x(field):\n        return (np.roll(field, -1, axis=1) - np.roll(field, 1, axis=1)) / 2.0\n\n    def grad_y(field):\n        return (np.roll(field, -1, axis=0) - np.roll(field, 1, axis=0)) / 2.0\n\n    def laplacian(field):\n        return (np.roll(field, 1, axis=1) + np.roll(field, -1, axis=1) +\n                np.roll(field, 1, axis=0) + np.roll(field, -1, axis=0) - 4.0 * field)\n\n    for lam in lambdas:\n        # Initialization for each simulation run\n        # LBM fields\n        f = np.zeros((9, N, N))\n        for i in range(9):\n            f[i, :, :] = w[i] * rho0\n        \n        rho = np.full((N, N), rho0)\n        u = np.zeros((2, N, N))\n        \n        # Polymer stress fields (symmetric tensor)\n        tau_xx = np.zeros((N, N))\n        tau_yy = np.zeros((N, N))\n        tau_xy = np.zeros((N, N))\n\n        max_trace_history = np.zeros(T)\n        is_stretched = False\n\n        for t in range(T):\n            # Compute polymer force F_p = div(tau)\n            Fp_x = grad_x(tau_xx) + grad_y(tau_xy)\n            Fp_y = grad_x(tau_xy) + grad_y(tau_yy)\n            \n            # Total force F = f_ext + F_p\n            F = f_ext.copy()\n            F[0] += Fp_x\n            F[1] += Fp_y\n\n            # LBM Step\n            # Macroscopic properties\n            rho = np.sum(f, axis=0)\n            u[0] = (np.sum(f * c[:, 0, np.newaxis, np.newaxis], axis=0) + 0.5 * F[0]) / rho\n            u[1] = (np.sum(f * c[:, 1, np.newaxis, np.newaxis], axis=0) + 0.5 * F[1]) / rho\n\n            # Collision\n            f_eq = np.zeros_like(f)\n            u_dot_u = u[0]**2 + u[1]**2\n            for i in range(9):\n                cu = c[i, 0] * u[0] + c[i, 1] * u[1]\n                f_eq[i] = w[i] * rho * (1 + cu / c_s_sq + cu**2 / (2 * c_s_sq**2) - u_dot_u / (2 * c_s_sq))\n            \n            # Guo forcing term\n            S = np.zeros_like(f)\n            force_factor = 1.0 - 0.5 / tau_s\n            for i in range(9):\n                cu = c[i, 0] * u[0] + c[i, 1] * u[1]\n                force_term_dot_F = ( (c[i,0]-u[0])*F[0] + (c[i,1]-u[1])*F[1] ) / c_s_sq \\\n                                 + ( cu*(c[i,0]*F[0]+c[i,1]*F[1]) ) / (c_s_sq**2)\n                S[i] = force_factor * w[i] * force_term_dot_F\n            \n            f_coll = f - (1.0 / tau_s) * (f - f_eq) + S\n            \n            # Streaming\n            for i in range(9):\n                f[i] = np.roll(f_coll[i], shift=(c[i, 1], c[i, 0]), axis=(0, 1))\n\n            # FDM Step for Polymer Stress (Forward Euler)\n            # Velocity gradients\n            duxdx = grad_x(u[0])\n            duxdy = grad_y(u[0])\n            duydx = grad_x(u[1])\n            duydy = grad_y(u[1])\n            \n            # Terms from Oldroyd-B equation\n            # Convection term: -u . grad(tau)\n            conv_xx = -(u[0] * grad_x(tau_xx) + u[1] * grad_y(tau_xx))\n            conv_yy = -(u[0] * grad_x(tau_yy) + u[1] * grad_y(tau_yy))\n            conv_xy = -(u[0] * grad_x(tau_xy) + u[1] * grad_y(tau_xy))\n            \n            # Stretching/rotation term in problem statement\n            # (nabla u)^T . tau + tau . (nabla u)\n            stretch_rot_xx = 2 * (duxdx * tau_xx + duydx * tau_xy)\n            stretch_rot_yy = 2 * (duxdy * tau_xy + duydy * tau_yy)\n            stretch_rot_xy = (duxdx + duydy) * tau_xy + duxdy * tau_xx + duydx * tau_yy\n            \n            # Relaxation term: -tau / lambda\n            relax_xx = -tau_xx / lam\n            relax_yy = -tau_yy / lam\n            relax_xy = -tau_xy / lam\n            \n            # Strain term: (eta_p/lambda) * (nabla u + (nabla u)^T)\n            strain_rate_factor = eta_p / lam\n            strain_xx = strain_rate_factor * (2 * duxdx)\n            strain_yy = strain_rate_factor * (2 * duydy)\n            strain_xy = strain_rate_factor * (duxdy + duydx)\n            \n            # Artificial diffusion: kappa * laplacian(tau)\n            diff_xx = kappa * laplacian(tau_xx)\n            diff_yy = kappa * laplacian(tau_yy)\n            diff_xy = kappa * laplacian(tau_xy)\n\n            # Update stress tensor (dt=1)\n            tau_xx += conv_xx + stretch_rot_xx + relax_xx + strain_xx + diff_xx\n            tau_yy += conv_yy + stretch_rot_yy + relax_yy + strain_yy + diff_yy\n            tau_xy += conv_xy + stretch_rot_xy + relax_xy + strain_xy + diff_xy\n\n            # Analysis\n            trace_tau = tau_xx + tau_yy\n            max_trace_history[t] = np.max(trace_tau)\n\n            if max_trace_history[t] > M_max:\n                is_stretched = True\n                break\n        \n        if not is_stretched:\n            # Perform linear regression on log(M(t)) for t in [T-W, T)\n            analysis_time = np.arange(T - W, T)\n            analysis_data = np.log(max_trace_history[T - W:T] + delta_log)\n            # numpy.polyfit fits a polynomial p(x) = p[0] * x**deg + ... + p[deg]\n            # For deg=1, p[0] is the slope.\n            slope, _ = np.polyfit(analysis_time, analysis_data, 1)\n            if slope > s_th:\n                is_stretched = True\n        \n        results.append(is_stretched)\n\n    print(f\"[{','.join(map(str, results))}]\".replace(\"True\", \"True\").replace(\"False\", \"False\"))\n\nsolve()\n\n```", "id": "3528785"}]}