{"hands_on_practices": [{"introduction": "The foundation of any finite element method lies in the construction of local element matrices from the weak form of a governing equation. This exercise guides you through this fundamental process for a space-time element, using the heat equation as a model problem. By deriving the matrix contributions from a tensor-product basis, you will gain a concrete understanding of how spatial and temporal discretizations are coupled and how to select appropriate quadrature rules for exact integration [@problem_id:3525793].", "problem": "Consider the heat equation as a model for diffusion of temperature in a one-dimensional spatial domain coupled with time, governed by the partial differential equation (PDE) $u_{t} - \\kappa u_{xx} = f$ on $\\Omega \\times (0,T)$, where $\\Omega \\subset \\mathbb{R}$ is an interval, $\\kappa > 0$ is the thermal diffusivity, and $f$ is a source term. Using the Finite Element Method (FEM), formulate a space-time discretization over a single prismatic element $K = [x_{e},x_{e+1}] \\times [t_{n},t_{n+1}]$ by seeking a solution $u_{h}(x,t)$ in a tensor-product polynomial trial space and testing against a tensor-product polynomial test space of the same degrees. Let the spatial basis be $\\{\\phi_{i}(\\hat{x})\\}_{i=0}^{p_{x}}$ on the reference interval $\\hat{x} \\in [-1,1]$ and the temporal basis be $\\{\\psi_{j}(\\hat{t})\\}_{j=0}^{p_{t}}$ on the reference interval $\\hat{t} \\in [-1,1]$. Assume an affine mapping $x = x_{c} + (h_{x}/2)\\hat{x}$ and $t = t_{c} + (h_{t}/2)\\hat{t}$, where $h_{x} = x_{e+1}-x_{e}$ and $h_{t} = t_{n+1}-t_{n}$.\n\nStarting from the weak form corresponding to the PDE $u_{t} - \\kappa u_{xx} = f$ without integrating by parts in time, derive the local element bilinear form on $K$ and show how it separates into tensor-product contributions from space and time. Compute the expressions for the four one-dimensional matrices that enter this bilinear form: the spatial mass matrix, the spatial stiffness matrix, the temporal mass matrix, and the temporal time-derivative coupling matrix. Then, determine sufficient tensor-product Gauss–Legendre quadrature rules in space and in time to exactly integrate all polynomial terms appearing in these matrices for affine mappings and constant coefficients.\n\nExpress the minimal number of Gauss–Legendre points in space and in time needed for exactness as analytic functions of the polynomial degrees $p_{x}$ and $p_{t}$. As your final answer, provide these two numbers as a single row matrix using the LaTeX $\\mathrm{pmatrix}$ environment, with entries ordered as $(n_{x}, n_{t})$, where $n_{x}$ is the minimal number of points in space and $n_{t}$ is the minimal number of points in time. No rounding is required and no units should be reported.", "solution": "We begin with the partial differential equation (PDE) for heat diffusion:\n$$\nu_{t} - \\kappa u_{xx} = f\n$$\nTo derive the weak form on a single space-time element $K = [x_e, x_{e+1}] \\times [t_n, t_{n+1}]$, we multiply the PDE by a test function $v(x,t)$ and integrate over $K$:\n$$\n\\int_{t_n}^{t_{n+1}} \\int_{x_e}^{x_{e+1}} (u_t - \\kappa u_{xx})v \\, dx \\, dt = \\int_{t_n}^{t_{n+1}} \\int_{x_e}^{x_{e+1}} f v \\, dx \\, dt\n$$\nIntegrating the second-order spatial derivative term by parts yields:\n$$\n\\int_{K} (u_t v + \\kappa u_x v_x) \\, d(x,t) - \\int_{t_n}^{t_{n+1}} [\\kappa u_x v]_{x_e}^{x_{e+1}} \\, dt = \\int_{K} f v \\, d(x,t)\n$$\nThe boundary term $\\int_{t_n}^{t_{n+1}} [\\kappa u_x v]_{x_e}^{x_{e+1}} \\, dt$ is handled during the global assembly of element matrices. The local element bilinear form, $B_K(u,v)$, is the portion of the weak form integrated over the element's interior:\n$$\nB_K(u,v) = \\int_{K} (u_t v + \\kappa u_x v_x) \\, d(x,t)\n$$\nWe now map this integral to the reference element $\\hat{K} = [-1,1] \\times [-1,1]$ using the given affine mappings:\n$x(\\hat{x}) = x_c + \\frac{h_x}{2}\\hat{x}$ and $t(\\hat{t}) = t_c + \\frac{h_t}{2}\\hat{t}$.\nThe derivatives transform according to the chain rule:\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial \\hat{u}}{\\partial \\hat{t}} \\frac{d\\hat{t}}{dt} = \\frac{2}{h_t} \\frac{\\partial \\hat{u}}{\\partial \\hat{t}}\n\\quad \\text{and} \\quad\n\\frac{\\partial u}{\\partial x} = \\frac{\\partial \\hat{u}}{\\partial \\hat{x}} \\frac{d\\hat{x}}{dx} = \\frac{2}{h_x} \\frac{\\partial \\hat{u}}{\\partial \\hat{x}}\n$$\nThe differential element transforms as $d(x,t) = dx \\, dt = \\frac{h_x}{2} \\frac{h_t}{2} \\, d\\hat{x} \\, d\\hat{t}$.\nSubstituting these into the bilinear form, we get:\n$$\nB_K(u,v) = \\int_{-1}^{1} \\int_{-1}^{1} \\left( \\left(\\frac{2}{h_t} \\frac{\\partial \\hat{u}}{\\partial \\hat{t}}\\right) \\hat{v} + \\kappa \\left(\\frac{2}{h_x} \\frac{\\partial \\hat{u}}{\\partial \\hat{x}}\\right) \\left(\\frac{2}{h_x} \\frac{\\partial \\hat{v}}{\\partial \\hat{x}}\\right) \\right) \\frac{h_x h_t}{4} \\, d\\hat{x} \\, d\\hat{t}\n$$\n$$\nB_K(u,v) = \\int_{-1}^{1} \\int_{-1}^{1} \\left( \\frac{h_x}{2} \\frac{\\partial \\hat{u}}{\\partial \\hat{t}} \\hat{v} + \\kappa \\frac{h_t}{h_x} \\frac{\\partial \\hat{u}}{\\partial \\hat{x}} \\frac{\\partial \\hat{v}}{\\partial \\hat{x}} \\right) \\, d\\hat{x} \\, d\\hat{t}\n$$\nThe discrete solution $\\hat{u}_h(\\hat{x},\\hat{t})$ on the reference element is approximated as a finite sum over the tensor-product basis:\n$$\n\\hat{u}_h(\\hat{x},\\hat{t}) = \\sum_{k=0}^{p_x} \\sum_{l=0}^{p_t} u_{kl} \\phi_k(\\hat{x}) \\psi_l(\\hat{t})\n$$\nThe test function $v$ is chosen from the same basis, $\\hat{v}_h(\\hat{x},\\hat{t}) = \\phi_i(\\hat{x})\\psi_j(\\hat{t})$ for $i \\in \\{0, \\dots, p_x\\}$ and $j \\in \\{0, \\dots, p_t\\}$. Substituting these into the bilinear form yields the entries of the local element matrix $A$:\n$$\nA_{(ij)(kl)} = \\int_{-1}^{1} \\int_{-1}^{1} \\left( \\frac{h_x}{2} \\left[ \\phi_k \\frac{d\\psi_l}{d\\hat{t}} \\right] \\left[ \\phi_i \\psi_j \\right] + \\kappa \\frac{h_t}{h_x} \\left[ \\frac{d\\phi_k}{d\\hat{x}} \\psi_l \\right] \\left[ \\frac{d\\phi_i}{d\\hat{x}} \\psi_j \\right] \\right) \\, d\\hat{x} \\, d\\hat{t}\n$$\nThe integrals can be separated due to the tensor-product structure of the basis functions:\n$$\nA_{(ij)(kl)} = \\frac{h_x}{2} \\left(\\int_{-1}^{1} \\phi_k(\\hat{x})\\phi_i(\\hat{x}) \\, d\\hat{x}\\right) \\left(\\int_{-1}^{1} \\psi_j(\\hat{t})\\frac{d\\psi_l}{d\\hat{t}} \\, d\\hat{t}\\right) + \\kappa \\frac{h_t}{h_x} \\left(\\int_{-1}^{1} \\frac{d\\phi_k}{d\\hat{x}}\\frac{d\\phi_i}{d\\hat{x}} \\, d\\hat{x}\\right) \\left(\\int_{-1}^{1} \\psi_l(\\hat{t})\\psi_j(\\hat{t}) \\, d\\hat{t}\\right)\n$$\nThis expression shows the separation of the bilinear form into tensor products of one-dimensional matrices. We can now identify the four one-dimensional matrices:\n\n1.  **Spatial mass matrix ($M^x$):**\n    $$ M^x_{ik} = \\int_{-1}^{1} \\phi_i(\\hat{x})\\phi_k(\\hat{x}) \\, d\\hat{x} $$\n2.  **Spatial stiffness matrix ($K^x$):**\n    $$ K^x_{ik} = \\int_{-1}^{1} \\frac{d\\phi_i}{d\\hat{x}}\\frac{d\\phi_k}{d\\hat{x}} \\, d\\hat{x} $$\n3.  **Temporal mass matrix ($M^t$):**\n    $$ M^t_{jl} = \\int_{-1}^{1} \\psi_j(\\hat{t})\\psi_l(\\hat{t}) \\, d\\hat{t} $$\n4.  **Temporal time-derivative coupling matrix ($C^t$):**\n    $$ C^t_{jl} = \\int_{-1}^{1} \\psi_j(\\hat{t})\\frac{d\\psi_l}{d\\hat{t}} \\, d\\hat{t} $$\nUsing these definitions, the matrix entry is $A_{(ij)(kl)} = \\frac{h_x}{2} M^x_{ik} C^t_{jl} + \\kappa \\frac{h_t}{h_x} K^x_{ik} M^t_{jl}$.\n\nNext, we determine the minimal number of Gauss-Legendre quadrature points required to integrate these matrices exactly. A Gauss-Legendre rule with $n$ points is exact for polynomials of degree up to $2n-1$.\n\nFor the spatial matrices:\n- The integrand of $M^x_{ik}$, $\\phi_i(\\hat{x})\\phi_k(\\hat{x})$, is a polynomial of degree at most $p_x + p_x = 2p_x$. For exact integration, we need $2n_x - 1 \\ge 2p_x$, which implies $n_x \\ge p_x + 1/2$. The minimum integer value is $n_x = p_x + 1$.\n- The basis function $\\phi_k(\\hat{x})$ has degree at most $p_x$, so its derivative $\\frac{d\\phi_k}{d\\hat{x}}$ has degree at most $p_x - 1$. The integrand of $K^x_{ik}$, $\\frac{d\\phi_i}{d\\hat{x}}\\frac{d\\phi_k}{d\\hat{x}}$, is a polynomial of degree at most $(p_x - 1) + (p_x - 1) = 2p_x - 2$. For exact integration, we need $2n_x - 1 \\ge 2p_x - 2$, which implies $n_x \\ge p_x - 1/2$. The minimum integer value is $n_x = p_x$.\n\nTo integrate all spatial terms exactly, we must satisfy the more stringent condition, which comes from the mass matrix. Thus, the minimal number of spatial Gauss points is $n_x = p_x + 1$.\n\nFor the temporal matrices:\n- The integrand of $M^t_{jl}$, $\\psi_j(\\hat{t})\\psi_l(\\hat{t})$, is a polynomial of degree at most $p_t + p_t = 2p_t$. For exact integration, we require $2n_t - 1 \\ge 2p_t$, which implies $n_t \\ge p_t + 1/2$. The minimum integer value is $n_t = p_t + 1$.\n- The basis functions $\\psi_j$ and $\\psi_l$ have degree at most $p_t$. The derivative $\\frac{d\\psi_l}{d\\hat{t}}$ has degree at most $p_t - 1$. The integrand of $C^t_{jl}$, $\\psi_j(\\hat{t})\\frac{d\\psi_l}{d\\hat{t}}$, is a polynomial of degree at most $p_t + (p_t - 1) = 2p_t - 1$. For exact integration, we need $2n_t - 1 \\ge 2p_t - 1$, which implies $n_t \\ge p_t$. The minimum integer value is $n_t = p_t$.\n\nTo integrate all temporal terms exactly, we must satisfy the stricter condition, which comes from the temporal mass matrix. Thus, the minimal number of temporal Gauss points is $n_t = p_t + 1$.\n\nThe minimal number of Gauss-Legendre points needed for exact integration are $n_x = p_x + 1$ in space and $n_t = p_t + 1$ in time.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\np_{x} + 1 & p_{t} + 1\n\\end{pmatrix}\n}\n$$", "id": "3525793"}, {"introduction": "Standard Galerkin methods often fail for advection-dominated problems, producing unstable, oscillatory solutions that are physically meaningless. This practice moves from pure theory to computational implementation by tasking you with stabilizing an advection-diffusion-reaction equation using a residual-based technique like Streamline-Upwind/Petrov-Galerkin (SUPG). You will verify the effectiveness of your implementation by analyzing the discrete entropy stability of the system, a crucial skill for developing robust numerical schemes for transport phenomena [@problem_id:3525752].", "problem": "Consider the scalar advection–diffusion–reaction equation posed on the space–time slab $Q = \\Omega \\times (0,T)$ with $\\Omega = (0,L)$ and $T &gt; 0$, given by\n$$\n\\partial_t u + a \\, \\partial_x u - \\varepsilon \\, \\partial_{xx} u + c \\, u = 0 \\quad \\text{in } Q,\n$$\nwhere $a \\in \\mathbb{R}$ is a constant advection speed, $\\varepsilon \\ge 0$ is a diffusion coefficient, and $c \\ge 0$ is a reaction coefficient. Assume homogeneous source and no external forcing. The space–time weak form seeks $u \\in H^1(Q)$ such that, for all $v \\in H^1(Q)$,\n$$\n\\int_Q \\left( \\partial_t u \\, v + a \\, \\partial_x u \\, v + \\varepsilon \\, \\partial_x u \\, \\partial_x v + c \\, u \\, v \\right) \\, dx \\, dt = 0.\n$$\n\nYou are to construct a space–time finite element method on a uniform tensor-product mesh with bilinear ($Q_1$) basis functions that is stabilized via Streamline-Upwind/Petrov–Galerkin (SUPG) or Galerkin/Least-Squares (GLS) residual-based terms over elements. On each rectangular space–time element $K \\subset Q$, let the residual operator be\n$$\nR(u) = \\partial_t u + a \\, \\partial_x u + c \\, u,\n$$\nand add a stabilization contribution of the form\n$$\n\\sum_{K} \\int_K \\tau_K \\, R(u_h) \\, R(v_h) \\, dx \\, dt,\n$$\nwhere $\\tau_K &gt; 0$ is a tunable parameter that may depend on local mesh sizes and coefficients but must be chosen to ensure discrete entropy stability in the sense described below.\n\nDefine the discrete bilinear form $B(\\cdot,\\cdot)$ on the finite-dimensional space as\n$$\nB(u_h,v_h) = \\sum_K \\int_K \\left( \\partial_t u_h \\, v_h + a \\, \\partial_x u_h \\, v_h + \\varepsilon \\, \\partial_x u_h \\, \\partial_x v_h + c \\, u_h \\, v_h \\right) \\, dx \\, dt + \\sum_K \\int_K \\tau_K \\, R(u_h) \\, R(v_h) \\, dx \\, dt.\n$$\n\nConsider the discrete entropy functional\n$$\n\\mathcal{E}(u_h) = \\frac{1}{2} \\int_Q u_h^2 \\, dx \\, dt,\n$$\nand the symmetric part of the bilinear operator\n$$\nB_{\\mathrm{sym}}(u_h,u_h) = \\frac{1}{2} \\left( B(u_h,u_h) + B(u_h,u_h) \\right) = B(u_h,u_h).\n$$\nUsing the finite element matrices corresponding to the bilinear form $B(\\cdot,\\cdot)$ and the space–time mass matrix corresponding to $\\mathcal{E}(\\cdot)$, you must quantify discrete entropy stability by computing the smallest generalized eigenvalue of the symmetric part of the stabilized operator with respect to the mass matrix. Specifically, let $\\mathsf{B}$ be the assembled matrix for $B(\\cdot,\\cdot)$ and $\\mathsf{M}$ be the assembled mass matrix; define\n$$\n\\lambda_{\\min} = \\min_{\\mathbf{u} \\neq \\mathbf{0}} \\frac{\\mathbf{u}^\\top \\left( \\frac{\\mathsf{B} + \\mathsf{B}^\\top}{2} \\right) \\mathbf{u}}{\\mathbf{u}^\\top \\mathsf{M} \\, \\mathbf{u}}.\n$$\nEntropy stability is deemed achieved if $\\lambda_{\\min} \\ge 0$ (to within a numerical tolerance of $10^{-10}$).\n\nYour task is to:\n- Assemble the space–time finite element matrices on a uniform grid with $N_x$ elements in space and $N_t$ elements in time, using bilinear ($Q_1$) basis functions and exact integration via Gaussian quadrature.\n- Implement the residual-based stabilization term with element-wise parameter $\\tau_K$ using a scientifically justified choice that scales with local mesh sizes and coefficients. The parameterization must include a user-tunable scalar $\\alpha &gt; 0$ that controls the overall magnitude of stabilization.\n- For each test case below, compute $\\lambda_{\\min}$ and report whether discrete entropy stability is achieved (boolean true if $\\lambda_{\\min} \\ge 0$ within tolerance, else false).\n\nAll quantities are dimensionless. Angles do not appear. Percentages do not apply.\n\nTest Suite:\n- Case 1 (happy path, strong advection and weak diffusion): $L = 1$, $T = 1$, $a = 10$, $\\varepsilon = 10^{-6}$, $c = 0$, $N_x = 6$, $N_t = 6$, $\\alpha = 0.2$.\n- Case 2 (increased stabilization): $L = 1$, $T = 1$, $a = 10$, $\\varepsilon = 10^{-6}$, $c = 0$, $N_x = 6$, $N_t = 6$, $\\alpha = 1.0$.\n- Case 3 (coarser mesh, stronger advection): $L = 1$, $T = 1$, $a = 20$, $\\varepsilon = 10^{-6}$, $c = 0$, $N_x = 3$, $N_t = 2$, $\\alpha = 2.0$.\n- Case 4 (reaction-dominated stabilization assistance): $L = 1$, $T = 1$, $a = 5$, $\\varepsilon = 10^{-3}$, $c = 1.0$, $N_x = 8$, $N_t = 8$, $\\alpha = 0.3$.\n- Case 5 (edge case with zero diffusion and zero reaction, no stabilization): $L = 1$, $T = 1$, $a = 7$, $\\varepsilon = 0$, $c = 0$, $N_x = 8$, $N_t = 8$, $\\alpha = 0.0$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5]\"), where each result is a boolean indicating whether entropy stability is achieved for the corresponding test case.", "solution": "The task is to determine the discrete entropy stability of a space-time finite element method for a scalar advection-diffusion-reaction equation. This stability is quantified by computing the minimum generalized eigenvalue, $\\lambda_{\\min}$, of the symmetric part of the discrete operator matrix $\\mathsf{B}$ with respect to the mass matrix $\\mathsf{M}$. Stability is achieved if $\\lambda_{\\min} \\ge 0$.\n\nThe following steps outline the solution methodology:\n\n1.  **Finite Element Discretization**: The space-time domain $Q = (0,L) \\times (0,T)$ is discretized into a uniform mesh of $N_x \\times N_t$ rectangular elements, each of size $h_x \\times h_t$, where $h_x = L/N_x$ and $h_t = T/N_t$. On each element, the solution $u_h$ is approximated using bilinear ($Q_1$) basis functions $\\phi_i$ in a space-time formulation. A local solution on an element $K$ is $u_h|_K = \\sum_{j=1}^{4} u_j \\phi_j(\\xi, \\eta)$, where $(\\xi, \\eta)$ are coordinates on the reference element $[-1, 1] \\times [-1, 1]$.\n\n2.  **Bilinear Form and Element Matrices**: The discrete bilinear form $B(u_h, v_h)$ is composed of the standard Galerkin terms and a stabilization term. For each element $K$, we compute a $4 \\times 4$ element matrix $\\mathsf{B}^e$ and an element mass matrix $\\mathsf{M}^e$. Their entries are given by:\n    $$\n    \\mathsf{M}^e_{ij} = \\int_K \\phi_i \\phi_j \\, dx \\, dt\n    $$\n    $$\n    \\mathsf{B}^e_{ij} = \\int_K \\left( \\partial_t \\phi_j \\, \\phi_i + a \\, \\partial_x \\phi_j \\, \\phi_i + \\varepsilon \\, \\partial_x \\phi_j \\, \\partial_x \\phi_i + c \\, \\phi_j \\, \\phi_i \\right) \\, dx \\, dt + \\int_K \\tau_K \\, R(\\phi_j) \\, R(\\phi_i) \\, dx \\, dt\n    $$\n    where $i$ and $j$ are local node indices from $1$ to $4$. The integrals are computed over the reference element using a change of variables and numerical quadrature. The Jacobian of the mapping from the reference element $[-1, 1]^2$ to a physical element of size $h_x \\times h_t$ is $J = h_x h_t / 4$. The derivatives transform as $\\partial_x = (2/h_x)\\partial_\\xi$ and $\\partial_t = (2/h_t)\\partial_\\eta$. All integrands are polynomials of degree at most $(2,2)$ in $(\\xi, \\eta)$, thus a $2 \\times 2$ Gaussian quadrature rule is sufficient for exact integration.\n\n3.  **Stabilization Parameter $\\tau_K$**: The problem requires a scientifically justified choice for $\\tau_K$. For an advection-diffusion-reaction problem, a standard choice for the Galerkin/Least-Squares (GLS) stabilization parameter is based on the inverse of the norms of the differential operator's components. We adopt the following widely used form, incorporating the tunable parameter $\\alpha$:\n    $$\n    \\tau_K = \\alpha \\left( \\left(\\frac{2}{h_t}\\right)^2 + \\left(\\frac{2a}{h_x}\\right)^2 + c^2 \\right)^{-1/2}\n    $$\n    This form correctly scales with the mesh sizes ($h_x, h_t$) and the physical coefficients ($a, c$), and is dimensionally consistent (assuming a non-dimensionalized system as stated). The factors of $2$ arise from the derivatives of linear basis functions over an interval of length $2$. If the denominator is close to zero (e.g., $a=c=0$ and very large $h_t$), $\\tau_K$ should be handled carefully; in a practical implementation, the formula is robust for the provided test cases.\n\n4.  **Matrix Assembly**: The element matrices $\\mathsf{B}^e$ and $\\mathsf{M}^e$ for each element in the mesh are computed and assembled into global matrices $\\mathsf{B}$ and $\\mathsf{M}$ of size $(N_x+1)(N_t+1) \\times (N_x+1)(N_t+1)$. A mapping from local element node numbers to global degree-of-freedom indices is established to correctly place the element contributions into the global system.\n\n5.  **Eigenvalue Analysis**: The core of the stability analysis is the solution of the generalized eigenvalue problem:\n    $$\n    \\mathsf{B}_{\\mathrm{sym}} \\mathbf{u} = \\lambda \\mathsf{M} \\mathbf{u}\n    $$\n    where $\\mathsf{B}_{\\mathrm{sym}} = (\\mathsf{B} + \\mathsf{B}^\\top)/2$ is the symmetric part of the operator matrix $\\mathsf{B}$. The mass matrix $\\mathsf{M}$ is symmetric positive-definite. This problem is solved for all eigenvalues $\\lambda$, and the minimum eigenvalue, $\\lambda_{\\min}$, is identified.\n\n6.  **Stability Verdict**: The discrete system is deemed entropy stable if $\\lambda_{\\min} \\ge 0$, within a specified numerical tolerance of $10^{-10}$. For each test case, this condition is checked and a boolean result (`true` or `false`) is reported. This approach is implemented for the provided test suite.", "answer": "```python\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    It iterates through predefined test cases, computes entropy stability,\n    and prints the results in the specified format.\n    \"\"\"\n    test_cases = [\n        # Case 1: Happy path, strong advection, weak diffusion\n        {'L': 1.0, 'T': 1.0, 'a': 10.0, 'eps': 1e-6, 'c': 0.0, 'Nx': 6, 'Nt': 6, 'alpha': 0.2},\n        # Case 2: Increased stabilization\n        {'L': 1.0, 'T': 1.0, 'a': 10.0, 'eps': 1e-6, 'c': 0.0, 'Nx': 6, 'Nt': 6, 'alpha': 1.0},\n        # Case 3: Coarser mesh, stronger advection\n        {'L': 1.0, 'T': 1.0, 'a': 20.0, 'eps': 1e-6, 'c': 0.0, 'Nx': 3, 'Nt': 2, 'alpha': 2.0},\n        # Case 4: Reaction-dominated stabilization assistance\n        {'L': 1.0, 'T': 1.0, 'a': 5.0, 'eps': 1e-3, 'c': 1.0, 'Nx': 8, 'Nt': 8, 'alpha': 0.3},\n        # Case 5: Edge case, no stabilization\n        {'L': 1.0, 'T': 1.0, 'a': 7.0, 'eps': 0.0, 'c': 0.0, 'Nx': 8, 'Nt': 8, 'alpha': 0.0},\n    ]\n\n    results = []\n    for case in test_cases:\n        is_stable = compute_stability(**case)\n        results.append(is_stable)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(str(r).lower() for r in results)}]\")\n\n\ndef compute_stability(L, T, a, eps, c, Nx, Nt, alpha):\n    \"\"\"\n    Assembles space-time finite element matrices and computes the minimum generalized\n    eigenvalue to determine discrete entropy stability for a single test case.\n\n    Args:\n        L, T, a, eps, c, Nx, Nt, alpha: Parameters defining the problem instance.\n\n    Returns:\n        bool: True if stable (lambda_min >= -1e-10), False otherwise.\n    \"\"\"\n    # 1. Setup: Mesh properties, stabilization parameter\n    hx = L / Nx\n    ht = T / Nt\n    num_dofs = (Nx + 1) * (Nt + 1)\n\n    denom_sq = (2.0 / ht)**2 + (2.0 * a / hx)**2 + c**2\n    tau_k = alpha / np.sqrt(denom_sq) if denom_sq > 1e-16 else 0.0\n\n    # 2. Quadrature a-priori computations (2x2 rule is sufficient)\n    n_gauss = 2\n    gp, gw = np.polynomial.legendre.leggauss(n_gauss)\n\n    # 3. Basis functions and their derivatives on the reference element [-1, 1]^2\n    # Node ordering: (0) (-1,-1), (1) (1,-1), (2) (1,1), (3) (-1,1) (CCW)\n    def phi_at(xi, eta):\n        return np.array([\n            (1.0 - xi) * (1.0 - eta) / 4.0, (1.0 + xi) * (1.0 - eta) / 4.0,\n            (1.0 + xi) * (1.0 + eta) / 4.0, (1.0 - xi) * (1.0 + eta) / 4.0\n        ])\n\n    def dphidxi_at(xi, eta):\n        return np-array([\n            -(1.0 - eta) / 4.0, (1.0 - eta) / 4.0,\n            (1.0 + eta) / 4.0, -(1.0 + eta) / 4.0\n        ])\n\n    def dphideta_at(xi, eta):\n        return np-array([\n            -(1.0 - xi) / 4.0, -(1.0 + xi) / 4.0,\n            (1.0 + xi) / 4.0, (1.0 - xi) / 4.0\n        ])\n\n    # 4. Assembly of global matrices B and M\n    B_global = np.zeros((num_dofs, num_dofs))\n    M_global = np.zeros((num_dofs, num_dofs))\n    detJ = (hx * ht) / 4.0\n\n    for ex in range(Nx):\n        for et in range(Nt):\n            Be = np.zeros((4, 4))\n            Me = np.zeros((4, 4))\n\n            for i_gauss in range(n_gauss):\n                for j_gauss in range(n_gauss):\n                    xi_q, eta_q = gp[i_gauss], gp[j_gauss]\n                    w_q = gw[i_gauss] * gw[j_gauss]\n                    \n                    phi = phi_at(xi_q, eta_q)\n                    dphidxi = dphidxi_at(xi_q, eta_q)\n                    dphideta = dphideta_at(xi_q, eta_q)\n\n                    dphidx = dphidxi * (2.0 / hx)\n                    dphidt = dphideta * (2.0 / ht)\n                    \n                    common_factor = detJ * w_q\n                    \n                    Me += np.outer(phi, phi) * common_factor\n\n                    B_time = np.outer(phi, dphidt)\n                    B_adv = a * np.outer(phi, dphidx)\n                    B_diff = eps * np.outer(dphidx, dphidx)\n                    B_react = c * np.outer(phi, phi)\n                    \n                    R_trial = dphidt + a * dphidx + c * phi\n                    B_stab = tau_k * np.outer(R_trial, R_trial)\n\n                    Be += (B_time + B_adv + B_diff + B_react + B_stab) * common_factor\n\n            g_idx = [et * (Nx + 1) + ex, et * (Nx + 1) + (ex + 1),\n                     (et + 1) * (Nx + 1) + (ex + 1), (et + 1) * (Nx + 1) + ex]\n            \n            B_global[np.ix_(g_idx, g_idx)] += Be\n            M_global[np.ix_(g_idx, g_idx)] += Me\n\n    # 5. Solve the generalized eigenvalue problem\n    B_sym = (B_global + B_global.T) / 2.0\n    \n    try:\n        eigenvalues = linalg.eigh(B_sym, M_global, eigvals_only=True)\n        lambda_min = np.min(eigenvalues)\n    except np.linalg.LinAlgError:\n        return False\n\n    # 6. Check for discrete entropy stability\n    return lambda_min >= -1e-10\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3525752"}, {"introduction": "To perform efficient and reliable simulations, computational effort must be focused on regions where the solution error is largest. This practice delves into the theory behind adaptive mesh refinement by having you derive a residual-based a posteriori error estimator from first principles. You will learn to identify and quantify different sources of error—such as interior element residuals and jumps across element faces in both space and time—which serve as the essential indicators for guiding an adaptive simulation [@problem_id:3525812].", "problem": "Consider the heat equation in conservation form on a bounded Lipschitz domain $\\Omega \\subset \\mathbb{R}^{d}$ for $d \\in \\{1,2,3\\}$ and final time $T>0$:\n$$\nc(\\boldsymbol{x})\\,\\partial_{t} u(\\boldsymbol{x},t) - \\nabla \\cdot \\big(\\kappa(\\boldsymbol{x}) \\nabla u(\\boldsymbol{x},t)\\big) = f(\\boldsymbol{x},t) \\quad \\text{in } \\Omega \\times (0,T),\n$$\nwith homogeneous Dirichlet boundary condition $u(\\boldsymbol{x},t)=0$ on $\\partial \\Omega \\times (0,T)$ and initial condition $u(\\boldsymbol{x},0)=u_{0}(\\boldsymbol{x})$ in $\\Omega$. Assume the material parameters satisfy $c \\in L^{\\infty}(\\Omega)$ with $c(\\boldsymbol{x}) \\ge c_{0} > 0$ and $\\kappa \\in L^{\\infty}(\\Omega)$ with $\\kappa(\\boldsymbol{x}) \\ge \\kappa_{0} > 0$ almost everywhere.\n\nLet $0 = t_{0} < t_{1} < \\cdots < t_{N} = T$ be a partition of $(0,T)$ into time-slabs $I_{n} := (t_{n-1}, t_{n}]$ of length $\\tau_{n} := t_{n} - t_{n-1}$, and let $\\mathcal{T}_{h}^{n}$ be a conforming simplicial triangulation of $\\Omega$ on $I_{n}$. For each space-time slab $\\Omega \\times I_{n}$, define the element set $\\mathcal{T}_{h}^{n}$ with elements $K \\in \\mathcal{T}_{h}^{n}$, spatial mesh size $h_{K} := \\operatorname{diam}(K)$, and interior faces $\\mathcal{F}_{h}^{n,\\circ}$ with face size $h_{F} := \\operatorname{diam}(F)$. Consider a space-time finite element approximation $u_{h}$ that is piecewise polynomial on $K \\times I_{n}$ for each $K \\in \\mathcal{T}_{h}^{n}$ and may be discontinuous across temporal interfaces $t_{n}$.\n\nStarting only from the governing conservation law, its variational formulation on $\\Omega \\times (0,T)$, and the definition of the energy norm induced by the diffusion operator, derive a residual-based a posteriori error estimator that (i) separates spatial element residuals and temporal residuals on each $K \\times I_{n}$, (ii) includes jump terms across spatial interior faces within each time-slab, and (iii) includes jump terms across temporal interfaces at $t_{n}$. Define local space-time indicators $\\eta_{K,n}$ suitable for adaptive refinement. Your derivation must introduce and rigorously define the following quantities on each $K \\times I_{n}$:\n- the spatial strong residual,\n- the temporal strong residual,\n- the spatial flux jump across interior faces $F \\in \\mathcal{F}_{h}^{n,\\circ}$,\n- the temporal jump across interfaces $t_{n}$ on each spatial element $K$,\ntogether with mesh-dependent weights that are dimensionally consistent with the diffusion energy norm. Assume standard inverse, trace, and stability inequalities apply on shape-regular meshes, but do not assume any pre-existing a posteriori estimator formula.\n\nProvide the final analytic expression of the global estimator expressed as a sum of the squared local indicators $\\eta_{K,n}^{2}$ over all space-time cells. The final answer must be given as a single closed-form expression. No numerical evaluation is required.", "solution": "The derivation of a residual-based a posteriori error estimator begins with the governing partial differential equation and an exact identity for the error, $e(\\boldsymbol{x},t) = u(\\boldsymbol{x},t) - u_h(\\boldsymbol{x},t)$, where $u$ is the exact solution and $u_h$ is the finite element approximation.\n\nThe strong form of the heat equation is:\n$$ c(\\boldsymbol{x})\\,\\partial_{t} u - \\nabla \\cdot \\big(\\kappa(\\boldsymbol{x}) \\nabla u\\big) = f(\\boldsymbol{x},t) $$\nThe error $e$ therefore satisfies the error equation on each space-time element $K \\times I_n$:\n$$ c\\,\\partial_{t} e - \\nabla \\cdot (\\kappa \\nabla e) = f - \\big(c\\,\\partial_{t} u_h - \\nabla \\cdot (\\kappa \\nabla u_h)\\big) $$\nThe right-hand side is the element residual, which is not well-defined in this strong form since derivatives of the discrete solution $u_h$ may not exist. A weak formulation is necessary. A more direct path to an error identity for parabolic problems, which correctly handles the discontinuous-in-time nature of the approximation, is as follows.\n\nMultiplying the error equation by $e$ and integrating over a spatial element $K$ and a time slab $I_n = (t_{n-1}, t_n]$ yields:\n$$ \\int_{I_n} \\int_K (c\\,\\partial_t e) e \\, d\\boldsymbol{x} dt - \\int_{I_n} \\int_K (\\nabla \\cdot (\\kappa \\nabla e)) e \\, d\\boldsymbol{x} dt = \\int_{I_n} \\int_K \\big(f - c\\,\\partial_{t} u_h + \\nabla \\cdot (\\kappa \\nabla u_h)\\big) e \\, d\\boldsymbol{x} dt $$\n\nWe analyze each term. The first term on the left-hand side (LHS) can be written as:\n$$ \\int_{I_n} \\int_K \\frac{1}{2}\\frac{\\partial}{\\partial t}(c e^2) \\, d\\boldsymbol{x} dt = \\frac{1}{2} \\int_K c(\\boldsymbol{x}) e(\\boldsymbol{x}, t_n^-)^2 \\, d\\boldsymbol{x} - \\frac{1}{2} \\int_K c(\\boldsymbol{x}) e(\\boldsymbol{x}, t_{n-1}^+)^2 \\, d\\boldsymbol{x} $$\nwhere $t_n^-$ and $t_{n-1}^+$ denote the limits from below and above, respectively.\n\nThe second term on the LHS, after integration by parts over the spatial element $K$, becomes:\n$$ - \\int_{I_n} \\int_K (\\nabla \\cdot (\\kappa \\nabla e)) e \\, d\\boldsymbol{x} dt = \\int_{I_n} \\int_K \\kappa \\nabla e \\cdot \\nabla e \\, d\\boldsymbol{x} dt - \\int_{I_n} \\int_{\\partial K} (\\kappa \\nabla e \\cdot \\boldsymbol{n}_K) e \\, dS dt $$\nwhere $\\boldsymbol{n}_K$ is the outward unit normal to the boundary $\\partial K$.\n\nSumming over all elements $K \\in \\mathcal{T}_h^n$ for a fixed time slab $I_n$, the contributions from the interior face integrals combine. For an interior face $F=\\partial K_1 \\cap \\partial K_2$, the sum is $\\int_{I_n}\\int_F \\kappa(\\nabla e|_1 \\cdot \\boldsymbol{n}_1 + \\nabla e|_2 \\cdot \\boldsymbol{n}_2) e \\, dS dt$. Since $\\boldsymbol{n}_2 = -\\boldsymbol{n}_1$, this becomes $\\int_{I_n}\\int_F [[\\kappa \\nabla e \\cdot \\boldsymbol{n}]]_F e \\, dS dt$. As the exact flux is continuous ($[[\\kappa \\nabla u \\cdot \\boldsymbol{n}]]_F = 0$), this jump equals $-[[\\kappa \\nabla u_h \\cdot \\boldsymbol{n}]]_F$. The boundary integrals over $\\partial \\Omega$ vanish since $e=0$ there.\n\nThe RHS element residual term after integration by parts on each $K$ becomes:\n$$ \\sum_{K \\in \\mathcal{T}_h^n} \\int_{I_n} \\int_K \\big(f - c\\,\\partial_{t} u_h\\big) e \\,d\\boldsymbol{x}dt - \\sum_{K \\in \\mathcal{T}_h^n} \\int_{I_n} \\int_K \\kappa \\nabla u_h \\cdot \\nabla e \\, d\\boldsymbol{x}dt $$\nCombining the sides and summing over all $K \\in \\mathcal{T}_h^n$ and then over all $n=1, \\dots, N$:\n$$ \\sum_{n=1}^N \\left( \\frac{1}{2}\\|c^{1/2}e(t_n^-)\\|^2_{L^2(\\Omega)} - \\frac{1}{2}\\|c^{1/2}e(t_{n-1}^+)\\|^2_{L^2(\\Omega)} \\right) + \\int_0^T \\|\\kappa^{1/2}\\nabla e\\|^2_{L^2(\\Omega)} dt = \\mathcal{R}(e) $$\nwhere $\\mathcal{R}(e)$ is the work done by the residuals on the error:\n$$ \\mathcal{R}(e) = \\sum_{n=1}^N \\sum_{K \\in \\mathcal{T}_h^n} \\int_{I_n} \\int_K (f - c\\partial_t u_h + \\nabla\\cdot(\\kappa\\nabla u_h)) e \\, d\\boldsymbol{x} dt - \\sum_{n=1}^N \\sum_{F \\in \\mathcal{F}_h^{n,\\circ}} \\int_{I_n} \\int_F [[\\kappa\\nabla u_h \\cdot \\boldsymbol{n}]]_F e \\, dS dt $$\nThe sum on the LHS can be rewritten by observing that $e(t_{n-1}^-) - e(t_{n-1}^+) = [u_h]_{n-1}$, where $[w]_{n-1} = w(t_{n-1}^+) - w(t_{n-1}^-)$.\n$$ \\|c^{1/2}e(t_{n-1}^-)\\|^2 - \\|c^{1/2}e(t_{n-1}^+)\\|^2 = \\|c^{1/2}(e(t_{n-1}^+) + [u_h]_{n-1})\\|^2 - \\|c^{1/2}e(t_{n-1}^+)\\|^2 $$\n$$ = 2\\int_\\Omega c [u_h]_{n-1} e(t_{n-1}^+) d\\boldsymbol{x} + \\|c^{1/2}[u_h]_{n-1}\\|^2_{L^2(\\Omega)} $$\nAssuming $e(t_0^-)=0$ since $u_h(t_0^-)=u_0$, the error identity becomes:\n$$ \\frac{1}{2}\\|c^{1/2}e(T^-)\\|^2 + \\int_0^T \\|\\kappa^{1/2}\\nabla e\\|^2 dt + \\frac{1}{2}\\sum_{n=1}^N \\|c^{1/2}[u_h]_{n-1}\\|^2_{L^2(\\Omega)} = \\mathcal{R}(e) - \\sum_{n=1}^N \\int_\\Omega c [u_h]_{n-1} e(t_{n-1}^+) d\\boldsymbol{x} $$\nThe total error, measured in a natural energy norm, is on the LHS. The RHS contains terms that can be evaluated using the computed solution $u_h$. To form an estimator, we bound the RHS terms (which depend on the unknown error $e$) by computable residual terms. Using Cauchy-Schwarz inequality, standard interpolation estimates (e.g., Clément), and trace inequalities on shape-regular meshes, each term on the RHS can be bounded. This process introduces mesh-dependent weights.\n\nWe now define the residual quantities as requested:\n1.  **Temporal Strong Residual:** On each $K \\times I_n$, $R_{T,K,n} := f - c(\\boldsymbol{x})\\,\\partial_{t} u_{h}$.\n2.  **Spatial Strong Residual:** On each $K \\times I_n$, $R_{S,K,n} := \\nabla \\cdot (\\kappa(\\boldsymbol{x}) \\nabla u_{h})$.\n3.  **Spatial Flux Jump:** Across each interior face $F \\in \\mathcal{F}_{h}^{n,\\circ}$, $J_{F,n} := [[\\kappa(\\boldsymbol{x}) \\nabla u_h \\cdot \\boldsymbol{n}]]_F$, where $\\boldsymbol{n}$ is a fixed normal on $F$.\n4.  **Temporal Jump:** On each element $K$ at time $t_{n-1}$, $J_{K,n-1} := c(\\boldsymbol{x}) [u_h]_{n-1} = c(\\boldsymbol{x})(u_h(\\boldsymbol{x},t_{n-1}^+) - u_h(\\boldsymbol{x},t_{n-1}^-))$. For $n=1$, $u_h(t_0^-) := u_0$.\n\nThe RHS of the error identity defines the estimator. By applying Cauchy-Schwarz and standard approximation properties, we obtain (up to generic constants which are omitted) an upper bound of the form $\\mathcal{E}^2$, where $\\mathcal{E}$ is the global error estimator. The weights for each residual term are determined through this bounding process to ensure dimensional consistency with the energy norm.\n- The element residuals ($R_{S,K,n}$, $R_{T,K,n}$) are weighted by a factor proportional to $h_K / \\sqrt{\\kappa_0}$.\n- The spatial flux jumps ($J_{F,n}$) are weighted by a factor proportional to $\\sqrt{h_F / \\kappa_0}$.\n- The temporal jumps ($J_{K,n-1}$) are weighted by a factor proportional to $1 / \\sqrt{c_0}$.\n\nThe problem requests to separate spatial and temporal element residuals. This can be done by using the triangle inequality on the element residual term $R_{K,n} = R_{T,K,n} + R_{S,K,n}$. Using $(a+b)^2 \\le 2(a^2+b^2)$, we can write the estimator with separate terms.\n\nThe squared local space-time indicator $\\eta_{K,n}^2$ for an element $K$ and time slab $I_n$ is defined as:\n$$ \\eta_{K,n}^2 := \\frac{h_K^2}{\\kappa_0} \\| R_{T,K,n} \\|_{L^2(K \\times I_n)}^2 + \\frac{h_K^2}{\\kappa_0} \\| R_{S,K,n} \\|_{L^2(K \\times I_n)}^2 + \\frac{1}{2}\\sum_{F \\in \\partial K \\cap \\mathcal{F}_h^{n,\\circ}} \\frac{h_F}{\\kappa_0} \\| J_{F,n} \\|_{L^2(F \\times I_n)}^2 + \\frac{1}{c_0} \\| J_{K,n-1} \\|_{L^2(K)}^2 $$\nThe factor of $1/2$ on the face term is included so that summing $\\eta_{K,n}^2$ over all $K$ correctly counts each interior face contribution once.\n\nThe global error estimator $\\mathcal{E}^2$ is the sum of these squared local indicators over all space-time cells:\n$$ \\mathcal{E}^2 = \\sum_{n=1}^N \\sum_{K \\in \\mathcal{T}_h^n} \\eta_{K,n}^2 $$\nSubstituting the definition of $\\eta_{K,n}^2$ and combining the sums yields the final expression for the global estimator.", "answer": "$$ \\boxed{ \\sum_{n=1}^{N} \\left( \\sum_{K \\in \\mathcal{T}_{h}^{n}} \\left( \\frac{h_{K}^{2}}{\\kappa_{0}} \\left( \\| f - c\\partial_{t} u_{h} \\|_{L^{2}(K \\times I_{n})}^{2} + \\| \\nabla \\cdot (\\kappa \\nabla u_{h}) \\|_{L^{2}(K \\times I_{n})}^{2} \\right) + \\frac{1}{c_{0}} \\| c[u_{h}]_{n-1} \\|_{L^{2}(K)}^{2} \\right) + \\sum_{F \\in \\mathcal{F}_{h}^{n,\\circ}} \\frac{h_{F}}{\\kappa_{0}} \\| [[\\kappa \\nabla u_{h} \\cdot \\boldsymbol{n}]]_{F} \\|_{L^{2}(F \\times I_{n})}^{2} \\right) } $$", "id": "3525812"}]}