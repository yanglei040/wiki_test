{"hands_on_practices": [{"introduction": "Mastering field-split preconditioning begins with a solid grasp of its fundamental building block: the Schur complement. This first exercise provides a direct, hands-on calculation to demystify the process of block elimination. By working through a small, concrete numerical system, you will form the Schur complement operator and solve the reduced system for one of the fields, building foundational intuition for how these methods decouple complex multiphysics problems [@problem_id:3522005].", "problem": "Consider a two-field linear system arising from a physics-based field-split formulation of a coupled multiphysics problem, where a primary field $x_{1} \\in \\mathbb{R}^{2}$ (e.g., a discretized velocity or temperature vector) is coupled to a secondary scalar field $x_{2} \\in \\mathbb{R}$ (e.g., a discretized pressure or Lagrange multiplier). The block-structured discrete system is\n$$\n\\begin{pmatrix}\nA_{11} & A_{12} \\\\\nA_{21} & A_{22}\n\\end{pmatrix}\n\\begin{pmatrix}\nx_{1} \\\\\nx_{2}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\nb_{1} \\\\\nb_{2}\n\\end{pmatrix},\n$$\nwhere $A_{11} \\in \\mathbb{R}^{2 \\times 2}$, $A_{12} \\in \\mathbb{R}^{2 \\times 1}$, $A_{21} \\in \\mathbb{R}^{1 \\times 2}$, and $A_{22} \\in \\mathbb{R}^{1 \\times 1}$. In a physics-based preconditioning strategy that leverages field-splitting, the reduced equation for the secondary field is obtained by eliminating the primary field through block elimination, producing a scalar reduced operator that characterizes the coupling. For the specific numerical matrices\n$$\nA_{11}=\\begin{pmatrix}2&0\\\\0&3\\end{pmatrix},\\quad\nA_{12}=\\begin{pmatrix}1\\\\-1\\end{pmatrix},\\quad\nA_{21}=\\begin{pmatrix}4&2\\end{pmatrix},\\quad\nA_{22}=(5),\n$$\nand the right-hand side vectors\n$$\nb_{1}=\\begin{pmatrix}7\\\\-1\\end{pmatrix},\\quad b_{2}=(6),\n$$\ncarry out the elimination to form the scalar reduced equation for $x_{2}$, compute the corresponding reduced operator (the Schur complement), and solve for $x_{2}$. Express the final answer as the exact value of $x_{2}$ with no rounding and no units.", "solution": "The problem presents a linear system in block form, which is a common structure in the numerical simulation of coupled multiphysics problems. The system is given by:\n$$\n\\begin{pmatrix}\nA_{11} & A_{12} \\\\\nA_{21} & A_{22}\n\\end{pmatrix}\n\\begin{pmatrix}\nx_{1} \\\\\nx_{2}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\nb_{1} \\\\\nb_{2}\n\\end{pmatrix}\n$$\nThis block matrix equation corresponds to two coupled equations:\n$$\nA_{11} x_{1} + A_{12} x_{2} = b_{1} \\quad (1)\n$$\n$$\nA_{21} x_{1} + A_{22} x_{2} = b_{2} \\quad (2)\n$$\nThe problem asks for the solution of the secondary field $x_2$ using a block elimination strategy, which leads to the Schur complement system. This is a standard procedure in field-split preconditioning. The first step is to formally solve for the primary field $x_1$ from equation $(1)$. This is possible if and only if the matrix block $A_{11}$ is invertible.\n$$\nA_{11} x_{1} = b_{1} - A_{12} x_{2}\n$$\n$$\nx_{1} = A_{11}^{-1} (b_{1} - A_{12} x_{2}) \\quad (3)\n$$\nNext, we substitute this expression for $x_1$ into equation $(2)$:\n$$\nA_{21} \\left( A_{11}^{-1} (b_{1} - A_{12} x_{2}) \\right) + A_{22} x_{2} = b_{2}\n$$\nDistributing the term $A_{21}A_{11}^{-1}$ yields:\n$$\nA_{21} A_{11}^{-1} b_{1} - A_{21} A_{11}^{-1} A_{12} x_{2} + A_{22} x_{2} = b_{2}\n$$\nWe then rearrange this equation to isolate the terms involving the unknown $x_2$ on one side:\n$$\n(A_{22} - A_{21} A_{11}^{-1} A_{12}) x_{2} = b_{2} - A_{21} A_{11}^{-1} b_{1}\n$$\nThis is the reduced equation for the secondary field $x_2$. The operator on the left-hand side is the Schur complement of the block $A_{11}$ in the full system matrix, denoted as $S$:\n$$\nS = A_{22} - A_{21} A_{11}^{-1} A_{12}\n$$\nThe right-hand side of the reduced equation is the modified right-hand side vector, $\\hat{b}_{2}$:\n$$\n\\hat{b}_{2} = b_{2} - A_{21} A_{11}^{-1} b_{1}\n$$\nThe reduced system to be solved is thus $S x_{2} = \\hat{b}_{2}$.\n\nNow, we apply this formalism to the specific numerical matrices provided:\n$$\nA_{11}=\\begin{pmatrix}2&0\\\\0&3\\end{pmatrix},\\quad\nA_{12}=\\begin{pmatrix}1\\\\-1\\end{pmatrix},\\quad\nA_{21}=\\begin{pmatrix}4&2\\end{pmatrix},\\quad\nA_{22}=(5)\n$$\n$$\nb_{1}=\\begin{pmatrix}7\\\\-1\\end{pmatrix},\\quad b_{2}=(6)\n$$\nFirst, we check if $A_{11}$ is invertible. The determinant is $\\det(A_{11}) = (2)(3) - (0)(0) = 6 \\neq 0$, so the inverse exists. Since $A_{11}$ is a diagonal matrix, its inverse is easily found by taking the reciprocal of its diagonal elements:\n$$\nA_{11}^{-1} = \\begin{pmatrix} \\frac{1}{2} & 0 \\\\ 0 & \\frac{1}{3} \\end{pmatrix}\n$$\nNow, we compute the components of the Schur complement $S$. We calculate the product $A_{21} A_{11}^{-1}$:\n$$\nA_{21} A_{11}^{-1} = \\begin{pmatrix} 4 & 2 \\end{pmatrix} \\begin{pmatrix} \\frac{1}{2} & 0 \\\\ 0 & \\frac{1}{3} \\end{pmatrix} = \\begin{pmatrix} 4 \\cdot \\frac{1}{2} + 2 \\cdot 0 & 4 \\cdot 0 + 2 \\cdot \\frac{1}{3} \\end{pmatrix} = \\begin{pmatrix} 2 & \\frac{2}{3} \\end{pmatrix}\n$$\nNext, we compute the term $A_{21} A_{11}^{-1} A_{12}$:\n$$\nA_{21} A_{11}^{-1} A_{12} = \\begin{pmatrix} 2 & \\frac{2}{3} \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\left( 2 \\cdot 1 + \\left(\\frac{2}{3}\\right) \\cdot (-1) \\right) = 2 - \\frac{2}{3} = \\frac{6}{3} - \\frac{2}{3} = \\frac{4}{3}\n$$\nNow we can compute the Schur complement operator $S$:\n$$\nS = A_{22} - A_{21} A_{11}^{-1} A_{12} = (5) - \\left(\\frac{4}{3}\\right) = \\frac{15}{3} - \\frac{4}{3} = \\frac{11}{3}\n$$\nThe reduced operator is the scalar $S = \\frac{11}{3}$.\n\nNext, we compute the modified right-hand side $\\hat{b}_{2}$. We already have $A_{21} A_{11}^{-1}$, so we compute the product $A_{21} A_{11}^{-1} b_{1}$:\n$$\nA_{21} A_{11}^{-1} b_{1} = \\begin{pmatrix} 2 & \\frac{2}{3} \\end{pmatrix} \\begin{pmatrix} 7 \\\\ -1 \\end{pmatrix} = \\left( 2 \\cdot 7 + \\left(\\frac{2}{3}\\right) \\cdot (-1) \\right) = 14 - \\frac{2}{3} = \\frac{42}{3} - \\frac{2}{3} = \\frac{40}{3}\n$$\nNow we can compute $\\hat{b}_{2}$:\n$$\n\\hat{b}_{2} = b_{2} - A_{21} A_{11}^{-1} b_{1} = (6) - \\left(\\frac{40}{3}\\right) = \\frac{18}{3} - \\frac{40}{3} = -\\frac{22}{3}\n$$\nThe reduced scalar equation $S x_{2} = \\hat{b}_{2}$ is therefore:\n$$\n\\frac{11}{3} x_{2} = -\\frac{22}{3}\n$$\nSolving for $x_{2}$, we multiply both sides by $3$ to get $11 x_{2} = -22$, which yields:\n$$\nx_{2} = \\frac{-22}{11} = -2\n$$\nThe value of the secondary field variable is $x_{2} = -2$.", "answer": "$$\n\\boxed{-2}\n$$", "id": "3522005"}, {"introduction": "In practice, the exact Schur complement is rarely computed or inverted directly. Instead, physics-based approximations are used, but these must be chosen with care to ensure stability. This practice problem [@problem_id:3521944] uses a carefully constructed counterexample to illustrate a critical failure mode: the breakdown of a common preconditioner when the underlying discretization violates the discrete inf-sup condition. You will not only diagnose the failure by analyzing the operator's spectrum but also implement a stabilization technique to restore robustness, providing a crucial lesson on the interplay between numerical stability and preconditioning.", "problem": "Consider a linearized, steady, mixed formulation of an incompressible subproblem within a multiphysics coupled simulation. The discrete algebraic system has the $2 \\times 2$ block structure\n$$\n\\begin{pmatrix}\nA & B^{\\top} \\\\\nB & 0\n\\end{pmatrix}\n\\begin{pmatrix}\nu \\\\\np\n\\end{pmatrix}\n=\n\\begin{pmatrix}\nf \\\\\ng\n\\end{pmatrix},\n$$\nwhere $A \\in \\mathbb{R}^{m \\times m}$ represents the velocity (or flux) block and is symmetric positive definite (SPD), $B \\in \\mathbb{R}^{n \\times m}$ is the discrete divergence operator, and $p \\in \\mathbb{R}^{n}$ is the pressure vector. A widely used field-split preconditioner replaces the (negative) Schur complement $S := - B A^{-1} B^{\\top}$ acting on the pressure space by the pressure mass matrix $M_{p}$, i.e., it uses $M_{p}$ as a physics-based approximation to $-S$.\n\nConstruct an explicit finite-dimensional counterexample showing the breakdown of this mass-based pressure preconditioner when the discrete inf-sup condition is violated, and then propose a minimal augmentation that recovers stability. To that end, consider the specific choice\n$$\nA := \\alpha \\in \\mathbb{R}, \\quad \\alpha > 0, \\qquad B := \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} \\in \\mathbb{R}^{2 \\times 1}, \\qquad M_{p} := I_{2} \\in \\mathbb{R}^{2 \\times 2}.\n$$\nPerform the following steps:\n\n1. Starting from the definition of the discrete inf-sup condition in terms of the surjectivity of $B$, demonstrate the existence of a nonzero pressure vector $p \\in \\mathbb{R}^{2}$ that lies in the kernel of $B^{\\top}$, and explain why this shows a violation of the discrete inf-sup condition for the given pair.\n\n2. Using the definition of the Schur complement, derive the eigenvalues of the mass-preconditioned negative Schur complement $M_{p}^{-1} \\left( B A^{-1} B^{\\top} \\right)$ for the given $A$, $B$, and $M_{p}$. Explain why the result illustrates the breakdown of the naive mass-based pressure preconditioner.\n\n3. Propose an augmentation of the $(2,2)$ block of the saddle-point system by adding a stabilization term of the form $\\tau M_{p}$ with $\\tau > 0$, which corresponds to a pressure stabilization or artificial compressibility. Derive the eigenvalues of the augmented mass-preconditioned negative Schur complement $M_{p}^{-1} \\left( B A^{-1} B^{\\top} + \\tau M_{p} \\right)$ and then derive the spectral condition number of this $2 \\times 2$ symmetric positive definite matrix as a function of $\\alpha$ and $\\tau$.\n\nYour final answer must be a single closed-form analytic expression for the spectral condition number as a function of $\\alpha$ and $\\tau$. This is a dimensionless quantity; do not include units. No rounding is required.", "solution": "We start from the mixed saddle-point system and the definition of the Schur complement. The full block system is\n$$\n\\begin{pmatrix}\nA & B^{\\top} \\\\\nB & 0\n\\end{pmatrix}\n\\begin{pmatrix}\nu \\\\\np\n\\end{pmatrix}\n=\n\\begin{pmatrix}\nf \\\\\ng\n\\end{pmatrix},\n$$\nwith $A$ symmetric positive definite (SPD). Eliminating $u$ formally yields the Schur complement equation in $p$:\n$$\n- B A^{-1} B^{\\top} \\, p = g - B A^{-1} f,\n$$\nwhere $S := - B A^{-1} B^{\\top}$ is symmetric negative semidefinite in general. In a field-split preconditioning strategy, a common physics-based approximation is to replace $-S$ by the pressure mass matrix $M_{p}$.\n\nStep $1$: We analyze discrete inf-sup stability for the specific choice\n$$\nA := \\alpha > 0, \\qquad B := \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} \\in \\mathbb{R}^{2 \\times 1}, \\qquad M_{p} := I_{2}.\n$$\nThe discrete inf-sup condition, expressed in terms of surjectivity, requires that $B$ has full row rank, which for $B \\in \\mathbb{R}^{n \\times m}$ means $\\operatorname{rank}(B) = n$. Equivalently, there should be no nontrivial vector $p \\in \\mathbb{R}^{n}$ such that $B^{\\top} p = 0$. Here $B^{\\top} \\in \\mathbb{R}^{1 \\times 2}$ is\n$$\nB^{\\top} = \\begin{pmatrix} 1 & -1 \\end{pmatrix}.\n$$\nLet $p = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$. Then\n$$\nB^{\\top} p = \\begin{pmatrix} 1 & -1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} = 1 - 1 = 0.\n$$\nThus, there exists a nonzero pressure vector $p \\neq 0$ in $\\ker(B^{\\top})$. This exhibits a violation of the discrete inf-sup condition. Physically, $p = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$ represents a checkerboard-like pressure mode that is not seen by the discrete divergence, a hallmark of unstable equal-order discretizations.\n\nStep $2$: We form the negative Schur complement and its mass preconditioning. Since $A = \\alpha$, we have $A^{-1} = \\alpha^{-1}$. The product $B A^{-1} B^{\\top}$ is\n$$\nB A^{-1} B^{\\top} = \\alpha^{-1} \\, B B^{\\top} = \\alpha^{-1} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} \\begin{pmatrix} 1 & -1 \\end{pmatrix} = \\alpha^{-1} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}.\n$$\nDefine the $2 \\times 2$ matrix\n$$\nL := \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}.\n$$\nIt is well known, and easily verified, that $L$ has eigenpairs $(\\lambda, v)$ given by\n$$\n\\lambda_{1} = 0, \\quad v_{1} = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}, \\qquad \\lambda_{2} = 2, \\quad v_{2} = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}.\n$$\nTherefore, the spectrum of $B A^{-1} B^{\\top}$ is $\\{ 0, \\, 2 \\alpha^{-1} \\}$. With the mass-based preconditioner $M_{p} = I_{2}$, the preconditioned negative Schur complement is\n$$\nM_{p}^{-1} \\left( B A^{-1} B^{\\top} \\right) = \\alpha^{-1} L,\n$$\nwhich has eigenvalues $\\{ 0, \\, 2 \\alpha^{-1} \\}$. The presence of the zero eigenvalue shows that the mass-based approximation $M_{p}$ is not spectrally equivalent to the true (negative) Schur complement on this discrete space, hence the preconditioner is not robust: the spectrum touches zero, leading to possible stagnation or arbitrarily slow convergence for iterative methods and a breakdown of stability in the preconditioned Schur solve.\n\nStep $3$: To recover stability, we augment the $(2,2)$ block by a stabilization term corresponding to a pressure penalization (also interpretable as artificial compressibility), replacing the zero block with $- \\tau M_{p}$ for some $\\tau > 0$. At the Schur level, this yields the augmented negative Schur operator\n$$\nB A^{-1} B^{\\top} + \\tau M_{p} = \\alpha^{-1} L + \\tau I_{2}.\n$$\nSince $L$ and $I_{2}$ commute and share eigenvectors, the eigenvalues of the augmented operator are simply shifted by $\\tau$:\n$$\n\\lambda_{1}^{\\mathrm{aug}} = \\tau + 0 = \\tau, \\qquad \\lambda_{2}^{\\mathrm{aug}} = \\tau + 2 \\alpha^{-1}.\n$$\nWith the same mass preconditioner $M_{p} = I_{2}$, the preconditioned augmented negative Schur complement is $M_{p}^{-1} \\left( B A^{-1} B^{\\top} + \\tau M_{p} \\right) = \\alpha^{-1} L + \\tau I_{2}$, which is symmetric positive definite for any $\\tau > 0$. Its spectral condition number, defined as the ratio of the largest to the smallest eigenvalue, is therefore\n$$\n\\kappa(\\alpha, \\tau) = \\frac{\\tau + 2 \\alpha^{-1}}{\\tau}.\n$$\nThis closed-form expression shows that the augmentation removes the zero eigenvalue and restores a finite condition number. Moreover, for fixed $\\alpha$, increasing $\\tau$ improves the condition number, while for fixed $\\tau$, increasing $\\alpha$ (stronger $A$) also improves it by reducing $\\alpha^{-1}$.\n\nThus, the counterexample demonstrates breakdown of the naive mass-based pressure preconditioner under violation of the discrete inf-sup condition, and the proposed augmentation by $\\tau M_{p}$ recovers stability with spectral condition number given above.", "answer": "$$\\boxed{\\frac{\\tau + 2\\,\\alpha^{-1}}{\\tau}}$$", "id": "3521944"}, {"introduction": "Ultimately, the effectiveness of a preconditioning strategy is judged by its performance in a real-world simulation, which depends on the computational cost per iteration. This final exercise [@problem_id:3521946] bridges the gap from abstract block operators to the concrete realities of a finite element simulation for fluid dynamics. By applying formulas for counting degrees of freedom and analyzing the structure of different field-split preconditioners, you will learn to estimate the relative sizes of system blocks and, most importantly, the number and type of linear solves required at each step of an iterative solver. This skill is essential for making informed decisions when designing efficient solvers for complex multiphysics problems.", "problem": "Consider a two-field, mixed finite element discretization of a coupled saddle-point system with a block structure arising from incompressible Stokes flow on a two-dimensional domain. The discrete linear system has the form\n$$\n\\begin{bmatrix}\nK & B^{\\top} \\\\\nB & -C\n\\end{bmatrix}\n\\begin{bmatrix}\nu \\\\\np\n\\end{bmatrix}\n=\n\\begin{bmatrix}\nf \\\\\ng\n\\end{bmatrix},\n$$\nwhere $K \\in \\mathbb{R}^{n_u \\times n_u}$ is the velocity block, $B \\in \\mathbb{R}^{n_p \\times n_u}$ is the discrete divergence operator, and $C \\in \\mathbb{R}^{n_p \\times n_p}$ is a stabilization or coupling block (for incompressible Stokes, $C = 0$). The discrete problem is built on a uniform structured mesh of the unit square into $N_x \\times N_y$ axis-aligned rectangles, each split into two triangles by a consistent diagonal. Let the spatial dimension be $d = 2$. For the finite element spaces, consider either the Taylor–Hood pair (velocity $P2$, pressure $P1$) or the MINI element (velocity $P1$ enriched with one bubble per triangle, pressure $P1$). Assume pressures are constrained to have zero mean, effectively reducing the pressure space dimension by $1$. Ignore strong enforcement of Dirichlet boundary conditions for the purpose of degree-of-freedom counting; that is, count all assembled unknowns prior to boundary elimination. For preconditioning, consider three field-split strategies applied inside a Krylov method, each defined by how the preconditioner application uses subsolves:\n- Block-diagonal (BD): apply one approximate solve with $K$ and one with the pressure Schur complement approximation $\\tilde S$ per iteration. \n- Block lower-triangular (BT): apply one approximate solve with $K$ and one with $\\tilde S$ per iteration.\n- Schur via inner $K$ solves (INNERS with parameter $k$): apply one approximate solve with $K$ for the velocity block and approximate the Schur complement action for the pressure field using $k$ applications of an approximate $K^{-1}$, with no direct pressure solve.\n\nYour task is to, for each specified test case, compute:\n- The total number of unknowns $n = n_u + n_p$.\n- The ratio $r = n_u / n_p$, rounded to $6$ decimal places.\n- The number of $K$-block linear solves invoked per preconditioned Krylov iteration (as an integer).\n- The number of pressure Schur-complement solves invoked per iteration (as an integer; for the INNERS variant this is $0$ by definition).\n- A boolean indicating whether the $K$-block subsolve is Symmetric Positive Definite (SPD) on its constrained subspace (assume $\\text{True}$ for the diffusion-dominated $K$ with standard no-slip conditions).\n- A boolean indicating whether the pressure Schur-complement subsolve is SPD (assume $\\text{True}$ for BD and BT when using a pressure Poisson approximation with mean-zero constraint; $\\text{False}$ for INNERS since no direct Schur solve is invoked).\n\nBase your derivation on the following well-tested facts for a simply connected planar triangulation of a rectangle with consistent splitting:\n- The number of vertices is $V = (N_x + 1)(N_y + 1)$.\n- The number of triangles is $T = 2 N_x N_y$.\n- By Euler’s formula for a planar triangulation with a single exterior face, $V - E + T = 1$, so the number of edges is $E = V + T - 1$.\n- For a continuous scalar $P1$ space, the number of degrees of freedom is $V$.\n- For a continuous scalar $P2$ space on triangles, the number of degrees of freedom is $V + E$.\n- For a scalar $P1$ enriched with one bubble per triangle (MINI), the number of degrees of freedom is $V + T$.\n- For a vector-valued velocity in $d = 2$ dimensions, multiply the scalar count by $d$.\n- Enforcing the mean-zero pressure constraint reduces the pressure dimension by $1$, so $n_p = V - 1$.\n\nUse the above to derive the relative sizes of the subblocks and the per-iteration subsolve counts under each preconditioner. Then implement a program that, for each test case, computes a result list with the following structure:\n- `[n, r, n_K, n_S, isKSPD, isSSPD]`,\nwhere $n$ is an integer, $r$ is a float rounded to $6$ decimals, $n_K$ and $n_S$ are integers, and `isKSPD` and `isSSPD` are booleans.\n\nTest suite to evaluate:\n- Case $1$: $N_x = 2$, $N_y = 2$, element $=$ Taylor–Hood ($P2$–$P1$), preconditioner $=$ BD.\n- Case $2$: $N_x = 1$, $N_y = 1$, element $=$ MINI ($P1$ plus bubble for velocity; $P1$ for pressure), preconditioner $=$ BT.\n- Case $3$: $N_x = 3$, $N_y = 2$, element $=$ Taylor–Hood ($P2$–$P1$), preconditioner $=$ INNERS with $k = 2$.\n- Case $4$: $N_x = 5$, $N_y = 1$, element $=$ MINI ($P1$ plus bubble for velocity; $P1$ for pressure), preconditioner $=$ BD.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry corresponds to one test case and is itself a list in the exact order `[n,r,n_K,n_S,isKSPD,isSSPD]`. For example, the final line should look like `[[...],[...],[...],[...]]` with no additional text.", "solution": "The problem statement has been critically examined and is determined to be **valid**. It is a self-contained, scientifically grounded, and well-posed problem in the field of numerical analysis for computational fluid dynamics. The definitions, formulas, and assumptions provided are consistent and sufficient for deriving a unique solution. We may therefore proceed with a formal solution.\n\nThe problem requires an analysis of a discrete linear system arising from a mixed finite element formulation of the incompressible Stokes equations. The system is given by the block matrix equation:\n$$\n\\begin{bmatrix}\nK & B^{\\top} \\\\\nB & -C\n\\end{bmatrix}\n\\begin{bmatrix}\nu \\\\\np\n\\end{bmatrix}\n=\n\\begin{bmatrix}\nf \\\\\ng\n\\end{bmatrix}\n$$\nHere, $K$ represents the velocity-velocity coupling (viscous and convective terms), $B$ is the discrete divergence operator (continuity equation), and $C$ is a pressure stabilization term, which is null ($C=0$) for the standard formulation considered here. We are tasked with determining key characteristics of this system for several configurations defined by mesh resolution, element choice, and preconditioner strategy.\n\nOur analysis will proceed in two stages. First, we will derive general formulas for the number of degrees of freedom (DoFs) based on the provided mesh and finite element space definitions. Second, we will analyze the computational cost, in terms of sub-solves per iteration, for each specified preconditioning strategy. Finally, we will apply these derived formulas to each test case.\n\n**1. Derivation of Degrees of Freedom ($n_u, n_p$)**\n\nThe total number of unknowns is $n = n_u + n_p$, where $n_u$ is the dimension of the velocity space and $n_p$ is the dimension of the pressure space. The problem specifies a two-dimensional domain ($d=2$) discretized into $N_x \\times N_y$ rectangular cells, with each cell subdivided into two triangles.\n\nThe fundamental quantities for DoF counting are the number of vertices ($V$), edges ($E$), and triangles ($T$) in the mesh. According to the problem statement:\n- Number of vertices: $V = (N_x + 1)(N_y + 1)$\n- Number of triangles: $T = 2 N_x N_y$\n- Number of edges: $E = V + T - 1$\n\nThe pressure space for both element pairs is the continuous piecewise linear space ($P1$), with an additional constraint that the pressure has a zero mean.\n- The number of DoFs for a scalar continuous $P1$ field is equal to the number of vertices, $V$.\n- The mean-zero constraint, $\\int p \\,d\\Omega = 0$, removes one degree of freedom.\n- Therefore, the number of pressure DoFs is $n_p = V - 1$.\n\nThe number of velocity DoFs, $n_u$, depends on the chosen finite element space for velocity.\n\n**Case A: Taylor–Hood Elements ($P2$ Velocity)**\nThe velocity is approximated using continuous piecewise quadratic ($P2$) elements.\n- The number of DoFs for a scalar $P2$ field on a triangular mesh is given as $V + E$.\n- For a vector-valued velocity field in $d=2$ dimensions, we multiply the scalar count by $d$.\n- Thus, $n_u = d \\times (V + E) = 2(V + E)$.\n- Substituting the given expression for $E$:\n  $$n_u = 2(V + (V + T - 1)) = 2(2V + T - 1)$$\n\n**Case B: MINI Elements ($P1$ + Bubble Velocity)**\nThe velocity is approximated using continuous piecewise linear elements enriched with a cubic bubble function per element ($P1_b$).\n- The number of DoFs for a scalar $P1_b$ field is given as $V + T$.\n- For a vector-valued velocity field in $d=2$ dimensions:\n- Thus, $n_u = d \\times (V + T) = 2(V + T)$.\n\n**2. Analysis of Preconditioner Work**\n\nWe are asked to determine the number of $K$-block solves ($n_K$) and pressure Schur complement solves ($n_S$) per iteration of a preconditioned Krylov method. The pressure Schur complement is $S = B K^{-1} B^{\\top} + C$. With $C=0$, $S = B K^{-1} B^{\\top}$. The preconditioners use approximations $\\tilde{K} \\approx K$ and $\\tilde{S} \\approx S$.\n\n- **Block-Diagonal (BD) Preconditioner:**\n  The preconditioner is $\\mathcal{P}_{BD} = \\text{diag}(\\tilde{K}, \\tilde{S})$. One application of $\\mathcal{P}_{BD}^{-1}$ involves solving one system with $\\tilde{K}$ and one system with $\\tilde{S}$.\n  Therefore, $n_K = 1$ and $n_S = 1$.\n\n- **Block Lower-Triangular (BT) Preconditioner:**\n  The preconditioner is $\\mathcal{P}_{BT} = \\begin{bmatrix} \\tilde{K} & 0 \\\\ B & -\\tilde{S} \\end{bmatrix}$. Applying its inverse requires a block forward substitution, which involves one solve with $\\tilde{K}$ followed by one solve with $\\tilde{S}$.\n  Therefore, $n_K = 1$ and $n_S = 1$.\n\n- **Schur via inner $K$ solves (INNERS) Preconditioner:**\n  This strategy avoids forming and directly inverting an approximation $\\tilde{S}$. Instead, the action of $S^{-1}$ is approximated using an inner iterative method. A common approach, consistent with the problem description, is to use a block upper-triangular preconditioner $\\mathcal{P}_{INNERS} = \\begin{bmatrix} \\tilde{K} & B^{\\top} \\\\ 0 & -\\tilde{S} \\end{bmatrix}$. Applying its inverse, $\\mathcal{P}_{INNERS}^{-1}$, involves a block backward substitution:\n  1. Solve for the pressure component $w_p$ from $-\\tilde{S}w_p = r_p$. This is done by solving $(B \\tilde{K}^{-1} B^{\\top}) w_p \\approx -r_p$ with an inner Krylov solver (e.g., Conjugate Gradients) for a fixed number of iterations, $k$. Each iteration requires one matrix-vector product with the operator $B \\tilde{K}^{-1} B^{\\top}$, which necessitates one solve with $\\tilde{K}$. This step thus costs $k$ solves with $\\tilde{K}$.\n  2. Solve for the velocity component $w_u$ from $\\tilde{K} w_u = r_u - B^{\\top} w_p$. This costs one solve with $\\tilde{K}$.\n  The total number of $\\tilde{K}$ solves is the sum from both steps. Per the problem, no direct solve with a pressure matrix occurs.\n  Therefore, $n_K = k + 1$ and $n_S = 0$.\n\nThe SPD properties are given as assumptions: `isKSPD` is always `True`. `isSSPD` is `True` for BD and BT, and `False` for INNERS.\n\n**3. Application to Test Cases**\n\nWe now apply these formulas to the specific cases.\n\n**Case 1: $N_x = 2, N_y = 2$, Taylor–Hood, BD**\n- Mesh: $N_x=2, N_y=2 \\implies V=(2+1)(2+1)=9, T=2(2)(2)=8, E=9+8-1=16$.\n- DoFs:\n  - $n_p = V - 1 = 9 - 1 = 8$.\n  - $n_u = 2(2V + T - 1) = 2(2(9) + 8 - 1) = 2(18+7) = 50$.\n  - $n = n_u + n_p = 50 + 8 = 58$.\n- Ratio: $r = n_u / n_p = 50 / 8 = 6.25$.\n- Preconditioner (BD): $n_K = 1, n_S = 1$. `isKSPD`=True, `isSSPD`=True.\n- Result: $[58, 6.250000, 1, 1, \\text{True}, \\text{True}]$.\n\n**Case 2: $N_x = 1, N_y = 1$, MINI, BT**\n- Mesh: $N_x=1, N_y=1 \\implies V=(1+1)(1+1)=4, T=2(1)(1)=2$.\n- DoFs:\n  - $n_p = V - 1 = 4 - 1 = 3$.\n  - $n_u = 2(V + T) = 2(4 + 2) = 12$.\n  - $n = n_u + n_p = 12 + 3 = 15$.\n- Ratio: $r = n_u / n_p = 12 / 3 = 4.0$.\n- Preconditioner (BT): $n_K = 1, n_S = 1$. `isKSPD`=True, `isSSPD`=True.\n- Result: $[15, 4.000000, 1, 1, \\text{True}, \\text{True}]$.\n\n**Case 3: $N_x = 3, N_y = 2$, Taylor–Hood, INNERS ($k=2$)**\n- Mesh: $N_x=3, N_y=2 \\implies V=(3+1)(2+1)=12, T=2(3)(2)=12, E=12+12-1=23$.\n- DoFs:\n  - $n_p = V - 1 = 12 - 1 = 11$.\n  - $n_u = 2(2V + T - 1) = 2(2(12) + 12 - 1) = 2(24 + 11) = 70$.\n  - $n = n_u + n_p = 70 + 11 = 81$.\n- Ratio: $r = n_u / n_p = 70 / 11 \\approx 6.363636...$\n- Preconditioner (INNERS, $k=2$): $n_K = k+1 = 3, n_S = 0$. `isKSPD`=True, `isSSPD`=False.\n- Result: $[81, 6.363636, 3, 0, \\text{True}, \\text{False}]$.\n\n**Case 4: $N_x = 5, N_y = 1$, MINI, BD**\n- Mesh: $N_x=5, N_y=1 \\implies V=(5+1)(1+1)=12, T=2(5)(1)=10$.\n- DoFs:\n  - $n_p = V - 1 = 12 - 1 = 11$.\n  - $n_u = 2(V + T) = 2(12 + 10) = 44$.\n  - $n = n_u + n_p = 44 + 11 = 55$.\n- Ratio: $r = n_u / n_p = 44 / 11 = 4.0$.\n- Preconditioner (BD): $n_K = 1, n_S = 1$. `isKSPD`=True, `isSSPD`=True.\n- Result: $[55, 4.000000, 1, 1, \\text{True}, \\text{True}]$.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes system properties for specified finite element discretizations\n    of the Stokes equations.\n    \"\"\"\n    test_cases = [\n        {'nx': 2, 'ny': 2, 'element': 'Taylor-Hood', 'precond': 'BD', 'k': None},\n        {'nx': 1, 'ny': 1, 'element': 'MINI', 'precond': 'BT', 'k': None},\n        {'nx': 3, 'ny': 2, 'element': 'Taylor-Hood', 'precond': 'INNERS', 'k': 2},\n        {'nx': 5, 'ny': 1, 'element': 'MINI', 'precond': 'BD', 'k': None},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        nx = case['nx']\n        ny = case['ny']\n        element = case['element']\n        precond = case['precond']\n        k = case['k']\n        \n        # d is the spatial dimension, fixed at 2\n        d = 2\n\n        # 1. Mesh property calculation\n        V = (nx + 1) * (ny + 1)  # Number of vertices\n        T = 2 * nx * ny          # Number of triangles\n\n        # 2. Degree-of-freedom (DoF) calculation\n        # Pressure DoFs (P1 elements with mean-zero constraint)\n        n_p = V - 1\n        \n        # Velocity DoFs depend on the element type\n        if element == 'Taylor-Hood': # P2 velocity\n            E = V + T - 1 # Number of edges\n            # Scalar P2 DoFs = V + E\n            # Vector velocity DoFs = d * (scalar DoFs)\n            n_u = d * (V + E)\n        elif element == 'MINI': # P1 + bubble velocity\n            # Scalar P1b DoFs = V + T\n            # Vector velocity DoFs = d * (scalar DoFs)\n            n_u = d * (V + T)\n        \n        n = n_u + n_p  # Total number of unknowns\n        \n        # Ensure n_p is not zero to avoid division by zero error\n        if n_p > 0:\n            r = n_u / n_p\n        else:\n            r = 0.0 # Or handle as an error case, though not expected here.\n\n        # 3. Preconditioner analysis\n        if precond == 'BD': # Block-diagonal\n            n_K = 1\n            n_S = 1\n            isSSPD = True\n        elif precond == 'BT': # Block lower-triangular\n            n_K = 1\n            n_S = 1\n            isSSPD = True\n        elif precond == 'INNERS': # Schur complement via inner K-solves\n            n_K = k + 1\n            n_S = 0\n            isSSPD = False\n        \n        isKSPD = True # Assumed True for all cases\n        \n        # 4. Assemble the result list\n        # We build the string representation manually to match the required format.\n        # Python's bool `True`/`False` string representation is correct.\n        # The float must be formatted to 6 decimal places.\n        result_str = f\"[{n},{r:.6f},{n_K},{n_S},{isKSPD},{isSSPD}]\"\n        results.append(result_str)\n\n    # Final print statement in the exact required format.\n    # The requirement is [[..],[..]], so we join the pre-formatted strings\n    # and add the outer brackets.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3521946"}]}