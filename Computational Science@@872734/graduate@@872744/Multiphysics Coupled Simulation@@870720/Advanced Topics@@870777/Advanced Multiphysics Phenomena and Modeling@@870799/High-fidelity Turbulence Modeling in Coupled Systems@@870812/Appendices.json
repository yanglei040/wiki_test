{"hands_on_practices": [{"introduction": "The dynamic Smagorinsky model represents a significant advance in Large Eddy Simulation (LES) by automatically calculating the model coefficient, but this adaptivity comes at a cost: the computed eddy viscosity can become locally negative, leading to numerical instability. This exercise [@problem_id:3509289] provides a hands-on opportunity to explore this critical issue. By simulating the evolution of the model coefficient along a fluid pathline, you will first diagnose the cause of instability and then implement a robust fix using Lagrangian averaging, a technique widely used in production-level codes to ensure simulation stability.", "problem": "Consider an incompressible flow used for Large-Eddy Simulation (LES), where the filtered Navier–Stokes equations contain a subgrid-scale stress modeled by an eddy viscosity closure. In the dynamic model, the coefficient can be locally negative under coarse resolution, which induces anti-diffusion and can trigger numerical blow-up. Your task is to analyze numerical stability under such conditions and to construct a Lagrangian averaging approach that regularizes negative eddy viscosity. Work from first principles and widely accepted facts. Use only the definitions provided here and do not assume any undocumented formulas.\n\nYou are given the following base for modeling and stability:\n\n- The filtered momentum equation of an incompressible fluid has the viscous term proportional to the effective viscosity. The subgrid-scale (SGS) eddy viscosity model defines an eddy viscosity as $\\nu_t(t) = C_d(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert$, where $\\Delta$ is the filter width, $C_d(t)$ is the dynamic coefficient, and $\\lvert S(t)\\rvert$ is the magnitude of the resolved strain rate tensor.\n- The total effective viscosity is $\\nu_{\\mathrm{eff}}(t) = \\nu + \\nu_t(t)$, where $\\nu$ is the molecular kinematic viscosity.\n- For an explicit time-stepping scheme on a uniform grid of spacing $\\Delta x$, stability requires a Courant-Friedrichs-Lewy (CFL) condition for advection and a diffusive condition for the viscous term. With a characteristic uniform speed magnitude $\\lvert u\\rvert$, define the advection time-step limit as $\\Delta t_{\\mathrm{adv}} = c_{\\mathrm{adv}}\\;\\Delta x/\\lvert u\\rvert$, where $c_{\\mathrm{adv}}$ is a constant in $(0,1]$. For the viscous term, define the diffusive time-step limit as $\\Delta t_{\\mathrm{diff}}(t) = c_{\\mathrm{diff}}\\;\\Delta x^2/\\nu_{\\mathrm{eff}}(t)$ when $\\nu_{\\mathrm{eff}}(t)  0$, and $\\Delta t_{\\mathrm{diff}}(t) = 0$ when $\\nu_{\\mathrm{eff}}(t) \\le 0$, where $c_{\\mathrm{diff}}$ is a constant in $(0,1]$. The overall stable time step at time $t$ is the minimum of the two limits.\n\nTo construct a Lagrangian averaging regularization for the dynamic coefficient, use a pathline-based exponential relaxation:\n- Let the Lagrangian-averaged dynamic coefficient $C_L(t)$ satisfy the first-order ordinary differential equation $\\mathrm{d} C_L/\\mathrm{d}t = \\left(C_d(t) - C_L(t)\\right)/T_L$, with $C_L(0) = C_d(0)$ and $T_L  0$ being a Lagrangian relaxation time scale.\n- Define the regularized eddy viscosity $\\nu_{t,\\mathrm{reg}}(t) = \\max\\left(C_L(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert,\\,-\\nu\\right)$, which guarantees $\\nu_{\\mathrm{eff,reg}}(t) = \\nu + \\nu_{t,\\mathrm{reg}}(t) \\ge 0$.\n- With regularization, define $\\Delta t_{\\mathrm{diff,reg}}(t) = c_{\\mathrm{diff}}\\;\\Delta x^2/\\nu_{\\mathrm{eff,reg}}(t)$ when $\\nu_{\\mathrm{eff,reg}}(t)  0$, and interpret $\\Delta t_{\\mathrm{diff,reg}}(t)$ as $+\\infty$ when $\\nu_{\\mathrm{eff,reg}}(t) = 0$. The overall stable time step at time $t$ after regularization is the minimum of the two limits.\n\nParameters for the temporal signals along a single pathline and numerical evaluation are specified as follows:\n- The resolved strain magnitude is $\\lvert S(t)\\rvert = S_0\\left(1 + a_s \\sin(2\\pi f_s t)\\right)$.\n- The dynamic coefficient is $C_d(t) = C_0 + \\epsilon \\sin(2\\pi f_c t)$.\n- The pathline velocity magnitude $\\lvert u\\rvert$ is constant, and the spatial filter width equals the grid spacing, $\\Delta = \\Delta x$.\n- The evaluation horizon is $T_{\\mathrm{end}}$, and the evaluation increment is $\\delta t$, over which you must compute the minimum diffusive limit across time. The program should set the overall pre-regularization stable time step $\\Delta t_{\\mathrm{stable,before}} = \\min\\left(\\Delta t_{\\mathrm{adv}},\\;\\min_{t\\in[0,T_{\\mathrm{end}}]} \\Delta t_{\\mathrm{diff}}(t)\\right)$ and the post-regularization stable time step $\\Delta t_{\\mathrm{stable,after}} = \\min\\left(\\Delta t_{\\mathrm{adv}},\\;\\min_{t\\in[0,T_{\\mathrm{end}}]} \\Delta t_{\\mathrm{diff,reg}}(t)\\right)$, interpreting $+\\infty$ in the minimum accordingly.\n\nUse the following constants, units, and test suite:\n- Use $c_{\\mathrm{adv}} = 0.5$ and $c_{\\mathrm{diff}} = 0.5$.\n- Express all lengths in $\\mathrm{m}$, viscosities in $\\mathrm{m}^2/\\mathrm{s}$, times in $\\mathrm{s}$, frequencies in $\\mathrm{Hz}$, and strain in $\\mathrm{s}^{-1}$.\n- Evaluate over $t \\in [0, T_{\\mathrm{end}}]$ with step $\\delta t$.\n- Test suite parameters:\n  1. Case $1$: $\\Delta x = 0.05$, $\\nu = 1.0\\times 10^{-5}$, $\\lvert u\\rvert = 1.0$, $\\Delta = \\Delta x$, $S_0 = 50$, $a_s = 0.5$, $f_s = 1.0$, $C_0 = -0.12$, $\\epsilon = 0.08$, $f_c = 2.0$, $T_L = 0.20$, $T_{\\mathrm{end}} = 1.0$, $\\delta t = 0.001$.\n  2. Case $2$: $\\Delta x = 0.20$, $\\nu = 5.0\\times 10^{-6}$, $\\lvert u\\rvert = 4.0$, $\\Delta = \\Delta x$, $S_0 = 100$, $a_s = 0.3$, $f_s = 0.5$, $C_0 = -0.30$, $\\epsilon = 0.20$, $f_c = 1.0$, $T_L = 0.01$, $T_{\\mathrm{end}} = 1.0$, $\\delta t = 0.001$.\n  3. Case $3$: $\\Delta x = 0.01$, $\\nu = 1.0\\times 10^{-6}$, $\\lvert u\\rvert = 10.0$, $\\Delta = \\Delta x$, $S_0 = 80$, $a_s = 0.4$, $f_s = 3.0$, $C_0 = -0.005$, $\\epsilon = 0.010$, $f_c = 4.0$, $T_L = 2.0$, $T_{\\mathrm{end}} = 1.0$, $\\delta t = 0.001$.\n\nYour program must:\n- Compute $\\Delta t_{\\mathrm{stable,before}}$ and $\\Delta t_{\\mathrm{stable,after}}$ for each case.\n- Produce as output a single line containing a comma-separated list enclosed in square brackets, with the six floating-point results in seconds, ordered as $[\\Delta t_{\\mathrm{stable,before}}^{(1)}, \\Delta t_{\\mathrm{stable,after}}^{(1)}, \\Delta t_{\\mathrm{stable,before}}^{(2)}, \\Delta t_{\\mathrm{stable,after}}^{(2)}, \\Delta t_{\\mathrm{stable,before}}^{(3)}, \\Delta t_{\\mathrm{stable,after}}^{(3)}]$. Each value must be rounded to $6$ decimal places.", "solution": "The objective is to analyze the numerical stability of a Large-Eddy Simulation (LES) using a dynamic eddy viscosity model and to construct a Lagrangian averaging method to regularize it. The analysis is performed by calculating the maximum stable time step for an explicit numerical scheme, both before and after applying the regularization.\n\nThe problem is grounded in the established principles of computational fluid dynamics, specifically turbulence modeling and numerical analysis of partial differential equations. The provided definitions and parameters are scientifically consistent and sufficient for a well-posed analysis.\n\n### 1. Analysis of Numerical Stability without Regularization\n\nFor an explicit time-stepping scheme, the maximum allowable time step, $\\Delta t$, is constrained by stability criteria. The problem specifies two such constraints: one for advection and one for diffusion.\n\nThe advection time-step limit is given as:\n$$\n\\Delta t_{\\mathrm{adv}} = c_{\\mathrm{adv}}\\;\\frac{\\Delta x}{\\lvert u\\rvert}\n$$\nwhere $c_{\\mathrm{adv}} \\in (0, 1]$ is the advective Courant-Friedrichs-Lewy (CFL) number, $\\Delta x$ is the grid spacing, and $\\lvert u\\rvert$ is a characteristic velocity magnitude. This limit is constant for each test case since its constituent parameters are constant.\n\nThe diffusive time-step limit depends on the effective viscosity, $\\nu_{\\mathrm{eff}}(t)$. The subgrid-scale (SGS) eddy viscosity is modeled as:\n$$\n\\nu_t(t) = C_d(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert\n$$\nwhere $C_d(t)$ is the dynamic model coefficient, $\\Delta$ is the filter width, and $\\lvert S(t)\\rvert$ is the magnitude of the resolved strain rate tensor. The total effective viscosity is the sum of the molecular viscosity, $\\nu$, and the eddy viscosity, $\\nu_t(t)$:\n$$\n\\nu_{\\mathrm{eff}}(t) = \\nu + \\nu_t(t) = \\nu + C_d(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert\n$$\nThe diffusive time-step limit is then defined as:\n$$\n\\Delta t_{\\mathrm{diff}}(t) = \\begin{cases} c_{\\mathrm{diff}}\\;\\frac{\\Delta x^2}{\\nu_{\\mathrm{eff}}(t)}  \\text{if } \\nu_{\\mathrm{eff}}(t)  0 \\\\ 0  \\text{if } \\nu_{\\mathrm{eff}}(t) \\le 0 \\end{cases}\n$$\nwhere $c_{\\mathrm{diff}} \\in (0, 1]$ is the diffusive CFL number.\n\nThe overall stable time step at any instant $t$ is $\\min(\\Delta t_{\\mathrm{adv}}, \\Delta t_{\\mathrm{diff}}(t))$. To ensure stability for the entire simulation up to time $T_{\\mathrm{end}}$, the time step must be smaller than the minimum value encountered over the interval $t \\in [0, T_{\\mathrm{end}}]$. The overall stable time step before regularization is therefore:\n$$\n\\Delta t_{\\mathrm{stable,before}} = \\min\\left(\\Delta t_{\\mathrm{adv}},\\;\\min_{t\\in[0,T_{\\mathrm{end}}]} \\Delta t_{\\mathrm{diff}}(t)\\right)\n$$\nThe dynamic model allows $C_d(t)$ to become negative. If $C_d(t)$ is sufficiently negative, the eddy viscosity $\\nu_t(t)$ can become negative enough to make the total effective viscosity $\\nu_{\\mathrm{eff}}(t)$ non-positive. Specifically, if $\\nu + C_d(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert \\le 0$, then $\\nu_{\\mathrm{eff}}(t) \\le 0$. According to the definition of $\\Delta t_{\\mathrm{diff}}(t)$, this immediately forces $\\Delta t_{\\mathrm{diff}}(t) = 0$. If this condition occurs for even a single instant in time, then $\\min_{t} \\Delta t_{\\mathrm{diff}}(t) = 0$, leading to $\\Delta t_{\\mathrm{stable,before}} = 0$. This signifies a catastrophic failure of the numerical scheme (a \"blow-up\"), as no forward progress in time is possible with an explicit method.\n\nThe functions for the dynamic coefficient and strain rate are given by:\n$$\nC_d(t) = C_0 + \\epsilon \\sin(2\\pi f_c t)\n$$\n$$\n\\lvert S(t)\\rvert = S_0\\left(1 + a_s \\sin(2\\pi f_s t)\\right)\n$$\nFor the given test cases, the parameters are such that $C_d(t)$ typically attains negative values, causing $\\nu_{\\mathrm{eff}}(t)$ to become non-positive at certain times, which will result in $\\Delta t_{\\mathrm{stable,before}} = 0$.\n\n### 2. Construction of the Lagrangian Regularization Method\n\nTo prevent numerical blow-up, the dynamic coefficient $C_d(t)$ is regularized using a Lagrangian pathline-based averaging approach. A new coefficient, $C_L(t)$, is introduced, which represents a time-relaxed lagging average of $C_d(t)$ along a fluid particle's path. Its evolution is governed by the first-order ordinary differential equation (ODE):\n$$\n\\frac{\\mathrm{d} C_L}{\\mathrm{d}t} = \\frac{C_d(t) - C_L(t)}{T_L}\n$$\nwith the initial condition $C_L(0) = C_d(0)$, and where $T_L  0$ is the Lagrangian relaxation time scale. This equation causes $C_L(t)$ to track $C_d(t)$ with a delay and smoothing determined by $T_L$.\n\nFor numerical implementation, this ODE is discretized over small time increments $\\delta t$. Using the first-order forward Euler method, we approximate the derivative as $(\\mathrm{d} C_L/\\mathrm{d}t)|_t \\approx (C_L(t+\\delta t) - C_L(t))/\\delta t$. This yields the iterative scheme:\n$$\nC_L(t+\\delta t) \\approx C_L(t) + \\frac{\\delta t}{T_L}\\left(C_d(t) - C_L(t)\\right)\n$$\nStarting with $C_L(0) = C_d(0)$, this formula is applied iteratively to compute the time series for $C_L(t)$ over the interval $[0, T_{\\mathrm{end}}]$.\n\n### 3. Analysis of Stability with Regularization\n\nThe Lagrangian-averaged coefficient $C_L(t)$ is then used to define a regularized eddy viscosity, $\\nu_{t,\\mathrm{reg}}(t)$. A critical step is introduced to clip the eddy viscosity from below, preventing it from becoming more negative than the molecular viscosity:\n$$\n\\nu_{t,\\mathrm{reg}}(t) = \\max\\left(C_L(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert,\\,-\\nu\\right)\n$$\nThis clipping is the core of the stabilization. The regularized effective viscosity, $\\nu_{\\mathrm{eff,reg}}(t)$, is then:\n$$\n\\nu_{\\mathrm{eff,reg}}(t) = \\nu + \\nu_{t,\\mathrm{reg}}(t) = \\nu + \\max\\left(C_L(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert,\\,-\\nu\\right)\n$$\nBy construction, $\\nu_{\\mathrm{eff,reg}}(t)$ is guaranteed to be non-negative.\n- If $C_L(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert \\ge -\\nu$, then $\\nu_{\\mathrm{eff,reg}}(t) = \\nu + C_L(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert \\ge 0$.\n- If $C_L(t)\\,\\Delta^2\\,\\lvert S(t)\\rvert  -\\nu$, then $\\nu_{\\mathrm{eff,reg}}(t) = \\nu - \\nu = 0$.\n\nWith a non-negative effective viscosity, the regularized diffusive time-step limit is defined as:\n$$\n\\Delta t_{\\mathrm{diff,reg}}(t) = \\begin{cases} c_{\\mathrm{diff}}\\;\\frac{\\Delta x^2}{\\nu_{\\mathrm{eff,reg}}(t)}  \\text{if } \\nu_{\\mathrm{eff,reg}}(t)  0 \\\\ +\\infty  \\text{if } \\nu_{\\mathrm{eff,reg}}(t) = 0 \\end{cases}\n$$\nThe interpretation of an infinite time-step limit when $\\nu_{\\mathrm{eff,reg}}(t) = 0$ is that the viscous term vanishes, and thus imposes no stability constraint. The overall stable time step after regularization is then computed over the entire time horizon:\n$$\n\\Delta t_{\\mathrm{stable,after}} = \\min\\left(\\Delta t_{\\mathrm{adv}},\\;\\min_{t\\in[0,T_{\\mathrm{end}}]} \\Delta t_{\\mathrm{diff,reg}}(t)\\right)\n$$\nSince $\\nu_{\\mathrm{eff,reg}}(t)$ is never negative, $\\min_{t} \\Delta t_{\\mathrm{diff,reg}}(t)$ will be a non-zero, positive value (or $+\\infty$), as long as $\\nu_{\\mathrm{eff,reg}}(t)$ is not identically zero over a finite time interval, which is the case here. This ensures that $\\Delta t_{\\mathrm{stable,after}}$ is a finite, non-zero value, representing a stable numerical scheme. The most stringent constraint on $\\Delta t_{\\mathrm{diff,reg}}(t)$ arises from the maximum value of $\\nu_{\\mathrm{eff,reg}}(t)$, giving $\\min_{t} \\Delta t_{\\mathrm{diff,reg}}(t) = c_{\\mathrm{diff}}\\;\\Delta x^2 / (\\max_{t} \\nu_{\\mathrm{eff,reg}}(t))$, assuming $\\max_{t} \\nu_{\\mathrm{eff,reg}}(t)  0$.\n\n### 4. Computational Algorithm\n\nFor each test case, the following procedure is executed:\n1.  Define the time array $t_i = i \\cdot \\delta t$ for $i=0, 1, \\dots, N$, where $N = T_{\\mathrm{end}}/\\delta t$.\n2.  Calculate the constant advection time-step limit, $\\Delta t_{\\mathrm{adv}}$.\n3.  Generate the discrete time series for $\\lvert S(t_i)\\rvert$ and $C_d(t_i)$.\n4.  **Pre-regularization analysis**:\n    a. Compute the effective viscosity time series $\\nu_{\\mathrm{eff}}(t_i) = \\nu + C_d(t_i)\\,\\Delta^2\\,\\lvert S(t_i)\\rvert$.\n    b. Check if any $\\nu_{\\mathrm{eff}}(t_i) \\le 0$. If so, $\\min_t \\Delta t_{\\mathrm{diff}}(t) = 0$, and $\\Delta t_{\\mathrm{stable,before}}=0$. Otherwise, calculate $\\min_t \\Delta t_{\\mathrm{diff}}(t) = c_{\\mathrm{diff}}\\;\\Delta x^2 / (\\max_i \\nu_{\\mathrm{eff}}(t_i))$ and subsequently $\\Delta t_{\\mathrm{stable,before}}$.\n5.  **Post-regularization analysis**:\n    a. Initialize $C_L(t_0) = C_d(t_0)$.\n    b. Iteratively compute the $C_L(t_i)$ series using the forward Euler method.\n    c. Compute the regularized eddy viscosity series $\\nu_{t,\\mathrm{reg}}(t_i) = \\max\\left(C_L(t_i)\\,\\Delta^2\\,\\lvert S(t_i)\\rvert,\\,-\\nu\\right)$.\n    d. Compute the regularized effective viscosity series $\\nu_{\\mathrm{eff,reg}}(t_i) = \\nu + \\nu_{t,\\mathrm{reg}}(t_i)$.\n    e. Find the maximum value of the series, $\\max_i \\nu_{\\mathrm{eff,reg}}(t_i)$.\n    f. If $\\max_i \\nu_{\\mathrm{eff,reg}}(t_i)  0$, calculate the minimum diffusive limit, $\\min_t \\Delta t_{\\mathrm{diff,reg}}(t) = c_{\\mathrm{diff}}\\;\\Delta x^2 / (\\max_i \\nu_{\\mathrm{eff,reg}}(t_i))$. If $\\max_i \\nu_{\\mathrm{eff,reg}}(t_i) = 0$, this limit is $+\\infty$.\n    g. Determine the final stable time step $\\Delta t_{\\mathrm{stable,after}} = \\min(\\Delta t_{\\mathrm{adv}}, \\min_t \\Delta t_{\\mathrm{diff,reg}}(t))$.\n6.  The results for each case, $\\Delta t_{\\mathrm{stable,before}}$ and $\\Delta t_{\\mathrm{stable,after}}$, are then collected.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_stability(params):\n    \"\"\"\n    Computes stable time steps before and after Lagrangian regularization.\n\n    Args:\n        params (dict): A dictionary containing all parameters for a single case.\n\n    Returns:\n        tuple: A tuple containing (dt_stable_before, dt_stable_after).\n    \"\"\"\n    dx = params['dx']\n    nu = params['nu']\n    u_mag = params['u_mag']\n    Delta = params['Delta']\n    S0 = params['S0']\n    a_s = params['a_s']\n    f_s = params['f_s']\n    C0 = params['C0']\n    epsilon = params['epsilon']\n    f_c = params['f_c']\n    T_L = params['T_L']\n    T_end = params['T_end']\n    dt_eval = params['dt_eval']\n\n    c_adv = 0.5\n    c_diff = 0.5\n\n    # Create time array for evaluation\n    t_series = np.arange(0, T_end + dt_eval, dt_eval)\n\n    # Calculate constant advective time-step limit\n    dt_adv = c_adv * dx / u_mag\n\n    # Calculate time-dependent quantities\n    S_mag_t = S0 * (1 + a_s * np.sin(2 * np.pi * f_s * t_series))\n    C_d_t = C0 + epsilon * np.sin(2 * np.pi * f_c * t_series)\n\n    # --- Pre-regularization Analysis ---\n    nu_eff_t = nu + C_d_t * (Delta**2) * S_mag_t\n\n    # Check for non-positive effective viscosity\n    if np.any(nu_eff_t = 0):\n        min_dt_diff_before = 0.0\n    else:\n        # This branch is not expected for the given test cases but included for completeness\n        max_nu_eff = np.max(nu_eff_t)\n        min_dt_diff_before = c_diff * dx**2 / max_nu_eff\n    \n    dt_stable_before = min(dt_adv, min_dt_diff_before)\n\n    # --- Post-regularization Analysis ---\n    \n    # 1. Solve ODE for C_L(t) using Forward Euler\n    C_L_t = np.zeros_like(t_series)\n    C_L_t[0] = C_d_t[0]\n    for i in range(1, len(t_series)):\n        # C_L(t + dt) = C_L(t) + (dt/T_L) * (C_d(t) - C_L(t))\n        C_L_t[i] = C_L_t[i-1] + (dt_eval / T_L) * (C_d_t[i-1] - C_L_t[i-1])\n\n    # 2. Compute regularized viscosities\n    nu_t_reg = np.maximum(C_L_t * (Delta**2) * S_mag_t, -nu)\n    nu_eff_reg = nu + nu_t_reg\n\n    # 3. Compute stable time step after regularization\n    max_nu_eff_reg = np.max(nu_eff_reg)\n    \n    if max_nu_eff_reg  0:\n        min_dt_diff_after = c_diff * dx**2 / max_nu_eff_reg\n    else:\n        # If max effective viscosity is 0, all values must be 0.\n        # This means dt_diff_reg is +inf for all t, so the min is +inf.\n        min_dt_diff_after = np.inf\n\n    dt_stable_after = min(dt_adv, min_dt_diff_after)\n\n    return dt_stable_before, dt_stable_after\n    \ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1\n        {\n            'dx': 0.05, 'nu': 1.0e-5, 'u_mag': 1.0, 'Delta': 0.05,\n            'S0': 50, 'a_s': 0.5, 'f_s': 1.0, \n            'C0': -0.12, 'epsilon': 0.08, 'f_c': 2.0,\n            'T_L': 0.20, 'T_end': 1.0, 'dt_eval': 0.001\n        },\n        # Case 2\n        {\n            'dx': 0.20, 'nu': 5.0e-6, 'u_mag': 4.0, 'Delta': 0.20,\n            'S0': 100, 'a_s': 0.3, 'f_s': 0.5,\n            'C0': -0.30, 'epsilon': 0.20, 'f_c': 1.0,\n            'T_L': 0.01, 'T_end': 1.0, 'dt_eval': 0.001\n        },\n        # Case 3\n        {\n            'dx': 0.01, 'nu': 1.0e-6, 'u_mag': 10.0, 'Delta': 0.01,\n            'S0': 80, 'a_s': 0.4, 'f_s': 3.0,\n            'C0': -0.005, 'epsilon': 0.010, 'f_c': 4.0,\n            'T_L': 2.0, 'T_end': 1.0, 'dt_eval': 0.001\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        before, after = compute_stability(case)\n        all_results.extend([before, after])\n\n    # Format the final output string with rounding to 6 decimal places.\n    print(f\"[{','.join(f'{x:.6f}' for x in all_results)}]\")\n\nsolve()\n```", "id": "3509289"}, {"introduction": "Accurately capturing the physics of wall-bounded turbulence is a central challenge in high-fidelity simulation, as resolving the near-wall region is often computationally intractable. This practice [@problem_id:3509370] guides you through the construction of an equilibrium wall-stress model, a cornerstone of modern LES for high-Reynolds-number flows. Starting from the fundamental assumption of a constant-stress layer, you will derive and apply a model that connects the unresolved wall shear stress to the resolved velocity field, providing invaluable insight into the principles of wall modeling.", "problem": "A compressible fluid at uniform temperature is part of a conjugate heat transfer simulation, but over the time window of interest the temperature is effectively uniform so that the dynamic viscosity is constant and the flow can be modeled as incompressible with constant kinematic viscosity. Consider a statistically steady, fully developed turbulent boundary layer over a smooth, planar wall, computed using Large Eddy Simulation (LES). You will construct a near-wall equilibrium wall-stress model that returns a friction velocity $u_{\\tau}$ consistent with the resolved shear, using a reconstruction of the mean velocity over the first two off-wall cells.\n\nStarting from the filtered, incompressible Navier–Stokes equations, assume the following modeling and physical assumptions that are standard in near-wall equilibrium wall-stress modeling:\n- Statistical stationarity and negligible streamwise pressure gradient over the near-wall control layer, so that the wall-normal derivative of the total shear stress is approximately zero in the equilibrium layer adjacent to the wall.\n- The total mean shear stress at a wall-normal location $y$ can be represented as the sum of viscous and turbulent contributions, with the turbulent part modeled by an eddy viscosity closure.\n- The eddy viscosity is given by Prandtl’s mixing-length hypothesis with van Driest damping; for this problem, assume the damping is fully saturated over the first off-wall cell so that the damping factor is effectively unity. Thus, the mixing length reduces to $l_{m}=\\kappa y$, where $\\kappa$ is the von Kármán constant.\n\nTo make the model consistent with the resolved LES field, estimate the mean shear at the first off-wall location $y_{1}$ by a linear least-squares reconstruction of the mean velocity profile through the no-slip wall point using the first two off-wall cell-center values. Specifically, fit $U(y)\\approx a\\,y$ in a least-squares sense through the points $(0,0)$, $(y_{1},U_{1})$, and $(y_{2},U_{2})$, where $U(y)$ is the mean streamwise velocity. Use the resulting slope $a$ as the estimate of the mean shear $\\left.\\frac{dU}{dy}\\right|_{y_{1}}\\approx a$.\n\nUsing the above assumptions and the near-wall equilibrium momentum balance, derive an expression for the friction velocity $u_{\\tau}$ in terms of the reconstructed shear $a$, the kinematic viscosity $\\nu$, the von Kármán constant $\\kappa$, and $y_{1}$. Then evaluate $u_{\\tau}$ numerically for the following data:\n- $y_{1}=0.004\\ \\mathrm{m}$,\n- $y_{2}=0.012\\ \\mathrm{m}$,\n- $U_{1}=3.00\\ \\mathrm{m/s}$,\n- $U_{2}=5.50\\ \\mathrm{m/s}$,\n- $\\nu=1.5\\times 10^{-5}\\ \\mathrm{m}^2/\\mathrm{s}$,\n- $\\kappa=0.41$.\n\nExpress your final answer for the friction velocity in $\\mathrm{m/s}$ and round to four significant figures.", "solution": "The problem is valid as it is scientifically grounded in established principles of turbulence modeling for Large Eddy Simulation (LES), is well-posed with sufficient and consistent data, and is formulated objectively. We can therefore proceed with the derivation and solution.\n\nThe goal is to find the friction velocity, $u_{\\tau}$, using a near-wall equilibrium model. The solution requires several steps: first, determining the mean velocity gradient from the given cell-centered velocities using a least-squares fit; second, formulating the equilibrium momentum balance including the specified turbulence model; and third, solving the resulting equation for $u_{\\tau}$.\n\nFirst, we determine the slope $a$ of the linear velocity profile, $U(y) = ay$, that provides a best fit in the least-squares sense to the data points $(y_i, U_i)$. The given points are $(0,0)$, $(y_{1}, U_{1})$, and $(y_{2}, U_{2})$. The sum of the squared errors, $S$, is given by:\n$$S(a) = \\sum_{i=0}^{2} (U_{i} - a y_{i})^{2} = (U_{0} - a y_{0})^{2} + (U_{1} - a y_{1})^{2} + (U_{2} - a y_{2})^{2}$$\nGiven that $(y_{0}, U_{0}) = (0,0)$, the expression simplifies to:\n$$S(a) = (U_{1} - a y_{1})^{2} + (U_{2} - a y_{2})^{2}$$\nTo minimize the error, we set the derivative of $S$ with respect to $a$ equal to zero:\n$$\\frac{dS}{da} = 2(U_{1} - a y_{1})(-y_{1}) + 2(U_{2} - a y_{2})(-y_{2}) = 0$$\n$$-U_{1}y_{1} + a y_{1}^{2} - U_{2}y_{2} + a y_{2}^{2} = 0$$\nSolving for $a$, we obtain the expression for the reconstructed mean velocity gradient:\n$$a(y_{1}^{2} + y_{2}^{2}) = U_{1}y_{1} + U_{2}y_{2}$$\n$$a = \\frac{U_{1}y_{1} + U_{2}y_{2}}{y_{1}^{2} + y_{2}^{2}}$$\nThis value of $a$ will be used as the estimate for the mean shear at the first off-wall location, i.e., $\\left.\\frac{dU}{dy}\\right|_{y_{1}} \\approx a$.\n\nNext, we establish the momentum balance in the near-wall equilibrium layer. The core assumption is that the total shear stress, $\\tau_{\\text{total}}$, is constant in the wall-normal direction and equal to the wall shear stress, $\\tau_{w}$.\n$$\\tau_{\\text{total}} = \\tau_{w}$$\nThe friction velocity $u_{\\tau}$ is defined by $\\tau_{w} = \\rho u_{\\tau}^{2}$, where $\\rho$ is the fluid density. Therefore:\n$$\\tau_{\\text{total}} = \\rho u_{\\tau}^{2}$$\nThe total shear stress is the sum of the viscous stress and the turbulent (Reynolds) stress, which is modeled using an eddy viscosity, $\\nu_{t}$:\n$$\\tau_{\\text{total}} = \\rho(\\nu + \\nu_{t}) \\frac{dU}{dy}$$\nwhere $\\nu$ is the kinematic viscosity. Equating the two expressions for $\\tau_{\\text{total}}$ and dividing by $\\rho$ gives:\n$$u_{\\tau}^{2} = (\\nu + \\nu_{t}) \\frac{dU}{dy}$$\nThe problem specifies using Prandtl's mixing-length model for the eddy viscosity, with the mixing length $l_{m} = \\kappa y$, where $\\kappa$ is the von Kármán constant. The eddy viscosity is thus:\n$$\\nu_{t} = l_{m}^{2} \\left| \\frac{dU}{dy} \\right| = (\\kappa y)^{2} \\frac{dU}{dy}$$\nWe assume $\\frac{dU}{dy}  0$ for a boundary layer velocity profile.\n\nNow, we evaluate the equilibrium balance at the first off-wall location, $y=y_{1}$:\n$$u_{\\tau}^{2} = \\left(\\nu + \\nu_{t}|_{y_{1}}\\right) \\left.\\frac{dU}{dy}\\right|_{y_{1}}$$\nSubstituting the expressions for $\\nu_{t}|_{y_{1}}$ and $\\left.\\frac{dU}{dy}\\right|_{y_{1}} \\approx a$:\n$$\\nu_{t}|_{y_{1}} = (\\kappa y_{1})^{2} a$$\nThus, the equation for $u_{\\tau}^{2}$ becomes:\n$$u_{\\tau}^{2} = (\\nu + (\\kappa y_{1})^{2} a) a = \\nu a + (\\kappa y_{1} a)^{2}$$\nThis is the final symbolic expression for $u_{\\tau}^{2}$. The friction velocity is:\n$$u_{\\tau} = \\sqrt{\\nu a + (\\kappa y_{1} a)^{2}}$$\n\nWe now substitute the given numerical values to compute $u_{\\tau}$. The data are:\n$y_{1} = 0.004 \\ \\mathrm{m}$\n$y_{2} = 0.012 \\ \\mathrm{m}$\n$U_{1} = 3.00 \\ \\mathrm{m/s}$\n$U_{2} = 5.50 \\ \\mathrm{m/s}$\n$\\nu = 1.5 \\times 10^{-5} \\ \\mathrm{m}^2/\\mathrm{s}$\n$\\kappa = 0.41$\n\nFirst, calculate the reconstructed shear, $a$:\n$$a = \\frac{(3.00)(0.004) + (5.50)(0.012)}{(0.004)^{2} + (0.012)^{2}} = \\frac{0.012 + 0.066}{0.000016 + 0.000144} = \\frac{0.078}{0.000160} = 487.5 \\ \\mathrm{s^{-1}}$$\nNow, calculate the two terms in the expression for $u_{\\tau}^{2}$:\nThe viscous contribution to the stress (scaled) is:\n$$\\nu a = (1.5 \\times 10^{-5}) (487.5) = 0.0073125 \\ \\mathrm{m^{2}/s^{2}}$$\nThe turbulent velocity scale is:\n$$\\kappa y_{1} a = (0.41)(0.004)(487.5) = 0.7995 \\ \\mathrm{m/s}$$\nThe turbulent contribution to the stress (scaled) is the square of this value:\n$$(\\kappa y_{1} a)^{2} = (0.7995)^{2} = 0.63920025 \\ \\mathrm{m^{2}/s^{2}}$$\nNow, we find $u_{\\tau}^{2}$ by summing the contributions:\n$$u_{\\tau}^{2} = 0.0073125 + 0.63920025 = 0.64651275 \\ \\mathrm{m^{2}/s^{2}}$$\nFinally, we take the square root to find $u_{\\tau}$:\n$$u_{\\tau} = \\sqrt{0.64651275} \\approx 0.80406016... \\ \\mathrm{m/s}$$\nRounding to four significant figures, as required by the problem statement:\n$$u_{\\tau} \\approx 0.8041 \\ \\mathrm{m/s}$$\nThis completes the solution.", "answer": "$$\\boxed{0.8041}$$", "id": "3509370"}, {"introduction": "When coupling different physics solvers, a primary challenge is ensuring the numerical stability of the overall system, especially when using explicit time-marching schemes. This exercise [@problem_id:3509332] addresses this fundamental issue within the context of fluid-structure interaction (FSI). You will determine the critical time step for a coupled simulation by analyzing the stability constraints of the fluid (LES) and structural solvers independently, learning how the most restrictive condition dictates the stability of the entire partitioned system.", "problem": "A flexible, tensioned plate is immersed in an incompressible turbulent channel flow that is resolved using Large-Eddy Simulation (LES), within a multiphysics fluid–structure interaction framework. The coupling is performed by a loosely coupled partitioned algorithm with a single global time step. The fluid solver uses an explicit time integrator, and the structural solver uses explicit central differences on a membrane model for the plate. The density ratio is unity, that is, $\\rho_{s}/\\rho_{f} = 1$. The flow and structure are discretized with the following parameters:\n\n- Fluid side (LES): maximum resolved velocity $U_{\\max} = 12\\,\\mathrm{m/s}$, minimum grid spacing $\\Delta = 1.0 \\times 10^{-3}\\,\\mathrm{m}$, and fluid Courant–Friedrichs–Lewy (CFL) limit $C_{\\mathrm{CFL},f} = 0.5$.\n- Structural side (membrane plate): in-plane tension per unit length $T = 1000\\,\\mathrm{N/m}$, plate thickness $t = 1.0 \\times 10^{-3}\\,\\mathrm{m}$, mass density $\\rho_{f} = \\rho_{s} = 1000\\,\\mathrm{kg/m^{3}}$ (by the given ratio), structural element size $h_{s} = 5.0 \\times 10^{-3}\\,\\mathrm{m}$, and structural Courant limit $C_{\\mathrm{Courant},s} = 0.9$.\n\nStarting from the incompressible Navier–Stokes equations and their explicit time-discrete stability requirement expressed by the fluid CFL condition, and from the membrane wave equation and its explicit stability expressed by the structural Courant condition, derive the critical global time step $\\Delta t_{\\mathrm{crit}}$ that ensures stability of both solvers under loose partitioned coupling. Compute its value using the data above.\n\nExpress the final time step in microseconds and round your answer to four significant figures.", "solution": "The problem requires finding the critical global time step, $\\Delta t_{\\mathrm{crit}}$, for a loosely coupled partitioned fluid-structure interaction (FSI) simulation. This critical time step is the maximum value that ensures numerical stability for both the fluid and the structural solvers, which are both using explicit time integration schemes. For such a setup with a single global time step, the overall stability is governed by the most restrictive (i.e., the smallest) time step limit of the individual sub-problems. Therefore, the critical global time step is given by the minimum of the maximum stable time step for the fluid solver, $\\Delta t_{f}$, and the maximum stable time step for the structural solver, $\\Delta t_{s}$.\n$$\n\\Delta t_{\\mathrm{crit}} = \\min(\\Delta t_{f}, \\Delta t_{s})\n$$\n\nFirst, we determine the stability limit for the fluid solver. The problem specifies that the fluid dynamics are resolved using Large-Eddy Simulation (LES) with an explicit time integrator. The stability of such a scheme is governed by the Courant–Friedrichs–Lewy (CFL) condition, which relates the time step $\\Delta t_{f}$, the fluid velocity $U$, and the grid spacing $\\Delta$. The condition is given by:\n$$\nC_{\\mathrm{CFL},f} = \\frac{U \\Delta t_{f}}{\\Delta}\n$$\nThe simulation is stable if $C_{\\mathrm{CFL},f}$ is below a certain limit, provided as $C_{\\mathrm{CFL},f} = 0.5$. To find the maximum allowable time step, we use the most restrictive case, which involves the maximum velocity, $U_{\\max}$, and the minimum grid spacing, $\\Delta$.\nThe given values for the fluid side are:\n- Maximum resolved velocity: $U_{\\max} = 12 \\, \\mathrm{m/s}$\n- Minimum grid spacing: $\\Delta = 1.0 \\times 10^{-3} \\, \\mathrm{m}$\n- Fluid CFL limit: $C_{\\mathrm{CFL},f} = 0.5$\n\nRearranging the CFL condition to solve for the maximum allowable time step for the fluid solver, $\\Delta t_{f}$:\n$$\n\\Delta t_{f} \\le \\frac{C_{\\mathrm{CFL},f} \\cdot \\Delta}{U_{\\max}}\n$$\nSubstituting the given values:\n$$\n\\Delta t_{f} \\le \\frac{0.5 \\cdot (1.0 \\times 10^{-3} \\, \\mathrm{m})}{12 \\, \\mathrm{m/s}} = \\frac{5.0 \\times 10^{-4}}{12} \\, \\mathrm{s} \\approx 4.1667 \\times 10^{-5} \\, \\mathrm{s}\n$$\nSo, the maximum stable time step for the fluid solver is $\\Delta t_{f} = 4.166\\overline{6} \\times 10^{-5} \\, \\mathrm{s}$.\n\nNext, we determine the stability limit for the structural solver. The structure is a flexible plate modeled as a membrane, and its dynamics are solved using an explicit central difference scheme. The governing equation for a tensioned membrane is the wave equation. The stability of an explicit scheme for the wave equation is determined by a Courant-type condition. The speed of wave propagation, $c_s$, in the membrane must first be calculated. It is given by the formula:\n$$\nc_s = \\sqrt{\\frac{T}{\\rho_s t}}\n$$\nwhere $T$ is the in-plane tension per unit length, $\\rho_s$ is the mass density of the plate material, and $t$ is the plate thickness. Note that the product $\\rho_s t$ represents the mass per unit area of the membrane.\nThe given values for the structural side are:\n- Tension per unit length: $T = 1000 \\, \\mathrm{N/m}$\n- Plate thickness: $t = 1.0 \\times 10^{-3} \\, \\mathrm{m}$\n- Mass density: $\\rho_s = 1000 \\, \\mathrm{kg/m^3}$\n- Structural element size: $h_s = 5.0 \\times 10^{-3} \\, \\mathrm{m}$\n- Structural Courant limit: $C_{\\mathrm{Courant},s} = 0.9$\n\nWe calculate the wave speed $c_s$:\n$$\nc_s = \\sqrt{\\frac{1000 \\, \\mathrm{N/m}}{(1000 \\, \\mathrm{kg/m^3}) \\cdot (1.0 \\times 10^{-3} \\, \\mathrm{m})}} = \\sqrt{\\frac{1000}{1}} \\, \\mathrm{m/s} = \\sqrt{1000} \\, \\mathrm{m/s}\n$$\n$c_s = 10\\sqrt{10} \\, \\mathrm{m/s} \\approx 31.6228 \\, \\mathrm{m/s}$.\n\nThe Courant condition for the structural solver is:\n$$\nC_{\\mathrm{Courant},s} = \\frac{c_s \\Delta t_{s}}{h_s}\n$$\nFor stability, this value must not exceed the given limit, $C_{\\mathrm{Courant},s} = 0.9$. We rearrange to find the maximum allowable time step for the structural solver, $\\Delta t_{s}$:\n$$\n\\Delta t_{s} \\le \\frac{C_{\\mathrm{Courant},s} \\cdot h_s}{c_s}\n$$\nSubstituting the values:\n$$\n\\Delta t_{s} \\le \\frac{0.9 \\cdot (5.0 \\times 10^{-3} \\, \\mathrm{m})}{\\sqrt{1000} \\, \\mathrm{m/s}} = \\frac{4.5 \\times 10^{-3}}{\\sqrt{1000}} \\, \\mathrm{s} \\approx 1.423 \\times 10^{-4} \\, \\mathrm{s}\n$$\nSo, the maximum stable time step for the structural solver is $\\Delta t_{s} \\approx 1.423 \\times 10^{-4} \\, \\mathrm{s}$.\n\nFinally, we determine the critical global time step $\\Delta t_{\\mathrm{crit}}$ for the coupled system. This is the minimum of the two individual time step limits:\n$$\n\\Delta t_{\\mathrm{crit}} = \\min(\\Delta t_{f}, \\Delta t_{s})\n$$\n$$\n\\Delta t_{\\mathrm{crit}} = \\min(4.166\\overline{6} \\times 10^{-5} \\, \\mathrm{s}, \\, 1.423 \\times 10^{-4} \\, \\mathrm{s})\n$$\nComparing the two values, it is clear that the fluid solver imposes the stricter constraint on the time step.\n$$\n\\Delta t_{\\mathrm{crit}} = \\Delta t_{f} = 4.166\\overline{6} \\times 10^{-5} \\, \\mathrm{s}\n$$\nThe problem asks for the result to be expressed in microseconds ($\\mu\\mathrm{s}$) and rounded to four significant figures. We convert the unit from seconds to microseconds ($1 \\, \\mathrm{s} = 10^6 \\, \\mu\\mathrm{s}$):\n$$\n\\Delta t_{\\mathrm{crit}} = (4.166\\overline{6} \\times 10^{-5}) \\times 10^6 \\, \\mu\\mathrm{s} = 41.66\\overline{6} \\, \\mu\\mathrm{s}\n$$\nRounding to four significant figures, we get:\n$$\n\\Delta t_{\\mathrm{crit}} = 41.67 \\, \\mu\\mathrm{s}\n$$\nThis is the critical global time step that ensures the stability of both solvers in the loosely coupled FSI simulation.", "answer": "$$\n\\boxed{41.67}\n$$", "id": "3509332"}]}