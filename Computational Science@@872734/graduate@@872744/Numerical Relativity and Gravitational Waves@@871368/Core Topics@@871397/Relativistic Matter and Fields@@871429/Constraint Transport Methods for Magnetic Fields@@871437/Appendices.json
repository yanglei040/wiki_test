{"hands_on_practices": [{"introduction": "The power of Constraint Transport (CT) methods lies in a fundamental mathematical property of their underlying staggered-grid structure. This exercise provides a foundational, pen-and-paper proof that demonstrates why CT schemes maintain the divergence-free constraint, $\\nabla \\cdot \\boldsymbol{B} = 0$, to machine precision. By algebraically manipulating the discrete update equations, you will show that the discrete divergence of the magnetic field is exactly preserved from one time step to the next, a crucial feature for any stable magnetohydrodynamics simulation [@problem_id:3469558].", "problem": "Consider a local patch of a binary neutron star simulation evolved with resistive General Relativistic Magnetohydrodynamics (GRMHD), specialized to a flat spacetime patch so that the lapse is $\\,\\alpha=1\\,$, the shift is $\\,\\beta^{i}=0\\,$, and the spatial metric is $\\,\\gamma_{ij}=\\delta_{ij}\\,$. Work in Heaviside–Lorentz units with $\\,c=1\\,$ and $\\,\\mu_{0}=1\\,$. The electromagnetic evolution is governed by the integral form of Faraday’s law, which in differential form reduces in this setting to $\\,\\partial_{t}\\boldsymbol{B}=-\\nabla\\times\\boldsymbol{E}\\,$. The current is defined by Ampère’s law in the magnetoquasistatic limit $\\,\\boldsymbol{J}=\\nabla\\times\\boldsymbol{B}\\,$, and the electric field obeys the resistive Ohm’s law in the nonrelativistic limit $\\,\\boldsymbol{E}=-\\boldsymbol{v}\\times\\boldsymbol{B}+\\eta\\,\\boldsymbol{J}\\,$, where $\\,\\eta>0\\,$ is a constant resistivity and $\\,\\boldsymbol{v}\\,$ is the fluid three-velocity.\n\nYou discretize on a two-dimensional uniform Cartesian Yee lattice in the $\\,x$–$y\\,$ plane with spacings $\\,\\Delta x=\\Delta y=\\Delta\\,$ and periodic boundary conditions. Magnetic field components $\\,B_{x}\\,$ and $\\,B_{y}\\,$ are stored as face-averaged values at locations $\\,\\left(i+\\tfrac{1}{2},j\\right)\\,$ and $\\,\\left(i,j+\\tfrac{1}{2}\\right)\\,$, respectively, and the out-of-plane electric field component $\\,E_{z}\\,$ is stored as edge-averaged values at locations $\\,\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)\\,$. The constrained transport (CT) update of the magnetic field is defined via Stokes’ theorem as a discrete curl of the edge-centered electromotive force (EMF) $\\,E_{z}\\,$:\n$$\nB_{x}^{\\,n+1}\\!\\left(i+\\tfrac{1}{2},j\\right)\n=\nB_{x}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j\\right)\n-\n\\frac{\\Delta t}{\\Delta}\n\\Big(\nE_{z}^{\\,n+\\theta}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)\n-\nE_{z}^{\\,n+\\theta}\\!\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right)\n\\Big),\n$$\n$$\nB_{y}^{\\,n+1}\\!\\left(i,j+\\tfrac{1}{2}\\right)\n=\nB_{y}^{\\,n}\\!\\left(i,j+\\tfrac{1}{2}\\right)\n+\n\\frac{\\Delta t}{\\Delta}\n\\Big(\nE_{z}^{\\,n+\\theta}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)\n-\nE_{z}^{\\,n+\\theta}\\!\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)\n\\Big),\n$$\nwhere $\\,\\theta\\in[0,1]\\,$ represents any time centering consistent with an implicit–explicit (IMEX) treatment of the resistive source. The edge-centered EMF is constructed from resistive Ohm’s law with $\\,\\boldsymbol{v}=\\boldsymbol{0}\\,$ so that $\\,E_{z}=\\eta\\,J_{z}\\,$, and the discrete current $\\,J_{z}\\,$ is computed using the same Stokes-compatible discrete curl operator applied to the face-centered magnetic field:\n$$\nJ_{z}^{\\,n+\\varphi}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)\n=\n\\frac{1}{\\Delta}\n\\Big(\nB_{y}^{\\,n+\\varphi}\\!\\left(i+1,j+\\tfrac{1}{2}\\right)\n-\nB_{y}^{\\,n+\\varphi}\\!\\left(i,j+\\tfrac{1}{2}\\right)\n-\nB_{x}^{\\,n+\\varphi}\\!\\left(i+\\tfrac{1}{2},j+1\\right)\n+\nB_{x}^{\\,n+\\varphi}\\!\\left(i+\\tfrac{1}{2},j\\right)\n\\Big),\n$$\nwith any stage index $\\,\\varphi\\,$ compatible with the chosen IMEX integrator, and $\\,E_{z}^{\\,n+\\theta}=\\eta\\,J_{z}^{\\,n+\\varphi}\\,$.\n\nDefine the cell-centered discrete divergence operator consistent with Gauss’ law as\n$$\n\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n}\\!(i,j)\n=\n\\frac{B_{x}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j\\right)-B_{x}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j\\right)}{\\Delta}\n+\n\\frac{B_{y}^{\\,n}\\!\\left(i,j+\\tfrac{1}{2}\\right)-B_{y}^{\\,n}\\!\\left(i,j-\\tfrac{1}{2}\\right)}{\\Delta}.\n$$\n\nAssume the initial magnetic field is constructed from a discrete vector potential $\\,A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)=\\dfrac{B_{0}}{k}\\cos\\!\\big(k\\,x_{i+\\frac{1}{2}}\\big)\\cos\\!\\big(k\\,y_{j+\\frac{1}{2}}\\big)\\,$ via the discrete curl\n$$\nB_{x}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j\\right)\n=\n\\frac{A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right)}{\\Delta},\n\\quad\nB_{y}^{\\,0}\\!\\left(i,j+\\tfrac{1}{2}\\right)\n=\n-\\frac{A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-A_{z}^{\\,0}\\!\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)}{\\Delta},\n$$\nso that the initial discrete divergence vanishes cellwise by construction.\n\nUsing only the integral statements of Faraday’s and Ampère’s laws and the above discrete operators on the Yee lattice, derive an expression for the updated cell-centered discrete divergence $\\,\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n+1}\\!(i,j)\\,$ after a single forward Euler step of duration $\\,\\Delta t\\,$ with the constrained transport update and resistive EMF as defined. Then, evaluate the resulting value of $\\,\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n+1}\\!(i,j)\\,$. Your final answer must be a single real number. No units are required. Do not round.", "solution": "The user wants to find the value of the discrete, cell-centered magnetic field divergence, $\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n+1}\\!\\!(i,j)$, after a single forward Euler time step.\n\nFirst, we must validate the problem statement.\n\n### Step 1: Extract Givens\n- **Spacetime**: Flat, with lapse $\\alpha=1$, shift $\\beta^{i}=0$, and spatial metric $\\gamma_{ij}=\\delta_{ij}$.\n- **Units**: Heaviside–Lorentz with $c=1$ and $\\mu_{0}=1$.\n- **Governing Equations (continuum)**:\n    - Faraday's Law: $\\partial_{t}\\boldsymbol{B}=-\\nabla\\times\\boldsymbol{E}$.\n    - Ampère's Law (magnetoquasistatic): $\\boldsymbol{J}=\\nabla\\times\\boldsymbol{B}$.\n    - Ohm's Law (resistive, non-relativistic limit): $\\boldsymbol{E}=-\\boldsymbol{v}\\times\\boldsymbol{B}+\\eta\\,\\boldsymbol{J}$, with constant resistivity $\\eta>0$ and fluid velocity $\\boldsymbol{v}=\\boldsymbol{0}$, simplifying to $\\boldsymbol{E}=\\eta\\,\\boldsymbol{J}$.\n- **Discretization**:\n    - A 2D uniform Cartesian Yee lattice in the $x$–$y$ plane with spacing $\\Delta x=\\Delta y=\\Delta$.\n    - $B_{x}$ is at face-centers $\\left(i+\\tfrac{1}{2},j\\right)$.\n    - $B_{y}$ is at face-centers $\\left(i,j+\\tfrac{1}{2}\\right)$.\n    - $E_{z}$ is at edge-centers $\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)$.\n- **Discrete Operators**:\n    - **Constrained Transport (CT) update**:\n      $$B_{x}^{\\,n+1}\\!\\left(i+\\tfrac{1}{2},j\\right) = B_{x}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j\\right) - \\frac{\\Delta t}{\\Delta} \\Big( E_{z}^{\\,n+\\theta}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) - E_{z}^{\\,n+\\theta}\\!\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right) \\Big)$$\n      $$B_{y}^{\\,n+1}\\!\\left(i,j+\\tfrac{1}{2}\\right) = B_{y}^{\\,n}\\!\\left(i,j+\\tfrac{1}{2}\\right) + \\frac{\\Delta t}{\\Delta} \\Big( E_{z}^{\\,n+\\theta}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) - E_{z}^{\\,n+\\theta}\\!\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) \\Big)$$\n    - **Discrete Current ($z$-component)**:\n      $$J_{z}^{\\,n+\\varphi}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) = \\frac{1}{\\Delta} \\Big( B_{y}^{\\,n+\\varphi}\\!\\left(i+1,j+\\tfrac{1}{2}\\right) - B_{y}^{\\,n+\\varphi}\\!\\left(i,j+\\tfrac{1}{2}\\right) - B_{x}^{\\,n+\\varphi}\\!\\left(i+\\tfrac{1}{2},j+1\\right) + B_{x}^{\\,n+\\varphi}\\!\\left(i+\\tfrac{1}{2},j\\right) \\Big)$$\n    - **Electric Field**: $E_{z}^{\\,n+\\theta}=\\eta\\,J_{z}^{\\,n+\\varphi}$.\n    - **Discrete Divergence**:\n      $$\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n}\\!(i,j) = \\frac{B_{x}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j\\right)-B_{x}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j\\right)}{\\Delta} + \\frac{B_{y}^{\\,n}\\!\\left(i,j+\\tfrac{1}{2}\\right)-B_{y}^{\\,n}\\!\\left(i,j-\\tfrac{1}{2}\\right)}{\\Delta}$$\n- **Initial Conditions**:\n    - The initial magnetic field $\\boldsymbol{B}^0$ is derived from a discrete vector potential $A_{z}^{0}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)$ via:\n      $$B_{x}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j\\right) = \\frac{A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right)}{\\Delta}$$\n      $$B_{y}^{\\,0}\\!\\left(i,j+\\tfrac{1}{2}\\right) = -\\frac{A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-A_{z}^{\\,0}\\!\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)}{\\Delta}$$\n    - The initial discrete divergence is stated to vanish: $\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{0}\\!(i,j)=0$.\n- **Task**:\n    - Derive an expression for $\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n+1}\\!(i,j)$ after a single forward Euler step ($\\Delta t$).\n    - Evaluate its value. For a forward Euler step, we take the time centering parameter $\\theta=0$ and the stage index for the right-hand-side evaluation as $\\varphi=n$. We are interested in the first step, so we evolve from $n=0$ to $n+1=1$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective. It describes a standard numerical method (Constrained Transport on a Yee lattice) for solving a simplified set of resistive MHD equations. The physics, while simplified, is self-consistent and standard for such numerical tests. All definitions and discrete operators are explicitly provided and are standard in the field of computational electromagnetism and MHD. The initial conditions are well-defined. The question is specific and answerable through rigorous derivation. The problem does not violate any of the specified invalidity criteria.\n\n### Step 3: Verdict and Action\nThe problem is valid. We proceed with the solution.\n\nThe goal is to calculate the discrete divergence of the magnetic field at time step $n+1$, denoted $\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n+1}\\!(i,j)$. We begin with its definition:\n$$\n\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n+1}\\!(i,j) = \\frac{B_{x}^{\\,n+1}\\!\\left(i+\\tfrac{1}{2},j\\right)-B_{x}^{\\,n+1}\\!\\left(i-\\tfrac{1}{2},j\\right)}{\\Delta} + \\frac{B_{y}^{\\,n+1}\\!\\left(i,j+\\tfrac{1}{2}\\right)-B_{y}^{\\,n+1}\\!\\left(i,j-\\tfrac{1}{2}\\right)}{\\Delta}\n$$\nWe can rewrite this as:\n$$\n\\Delta\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n+1}\\!(i,j) = \\Big[ B_{x}^{\\,n+1}\\!\\left(i+\\tfrac{1}{2},j\\right)-B_{x}^{\\,n+1}\\!\\left(i-\\tfrac{1}{2},j\\right) \\Big] + \\Big[ B_{y}^{\\,n+1}\\!\\left(i,j+\\tfrac{1}{2}\\right)-B_{y}^{\\,n+1}\\!\\left(i,j-\\tfrac{1}{2}\\right) \\Big]\n$$\nNow, substitute the given Constrained Transport (CT) update equations for $B_{x}^{\\,n+1}$ and $B_{y}^{\\,n+1}$ into this expression. The problem specifies a forward Euler step, so we use $\\theta=0$ and compute the electric field at time step $n$.\nFor the $x$-component difference:\n$$\nB_{x}^{\\,n+1}\\!\\left(i+\\tfrac{1}{2},j\\right)-B_{x}^{\\,n+1}\\!\\left(i-\\tfrac{1}{2},j\\right) = \\\\\n\\left[ B_{x}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j\\right) - \\frac{\\Delta t}{\\Delta} \\Big( E_{z}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) - E_{z}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right) \\Big) \\right] - \\\\\n\\left[ B_{x}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j\\right) - \\frac{\\Delta t}{\\Delta} \\Big( E_{z}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) - E_{z}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j-\\tfrac{1}{2}\\right) \\Big) \\right]\n$$\nGrouping terms by timestep:\n$$\n= \\Big[ B_{x}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j\\right) - B_{x}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j\\right) \\Big] - \\frac{\\Delta t}{\\Delta} \\Big[ E_{z}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) - E_{z}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right) - E_{z}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) + E_{z}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j-\\tfrac{1}{2}\\right) \\Big]\n$$\nFor the $y$-component difference:\n$$\nB_{y}^{\\,n+1}\\!\\left(i,j+\\tfrac{1}{2}\\right)-B_{y}^{\\,n+1}\\!\\left(i,j-\\tfrac{1}{2}\\right) = \\\\\n\\left[ B_{y}^{\\,n}\\!\\left(i,j+\\tfrac{1}{2}\\right) + \\frac{\\Delta t}{\\Delta} \\Big( E_{z}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) - E_{z}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) \\Big) \\right] - \\\\\n\\left[ B_{y}^{\\,n}\\!\\left(i,j-\\tfrac{1}{2}\\right) + \\frac{\\Delta t}{\\Delta} \\Big( E_{z}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right) - E_{z}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j-\\tfrac{1}{2}\\right) \\Big) \\right]\n$$\nGrouping terms by timestep:\n$$\n= \\Big[ B_{y}^{\\,n}\\!\\left(i,j+\\tfrac{1}{2}\\right) - B_{y}^{\\,n}\\!\\left(i,j-\\tfrac{1}{2}\\right) \\Big] + \\frac{\\Delta t}{\\Delta} \\Big[ E_{z}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) - E_{z}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) - E_{z}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right) + E_{z}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j-\\tfrac{1}{2}\\right) \\Big]\n$$\nNow, we sum the $x$-component and $y$-component differences to obtain $\\Delta\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n+1}\\!(i,j)$:\n$$\n\\Delta\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n+1}\\!(i,j) = \\Big[ B_{x}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j\\right) - B_{x}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j\\right) \\Big] + \\Big[ B_{y}^{\\,n}\\!\\left(i,j+\\tfrac{1}{2}\\right) - B_{y}^{\\,n}\\!\\left(i,j-\\tfrac{1}{2}\\right) \\Big] \\\\\n- \\frac{\\Delta t}{\\Delta} \\Big[ E_{z}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) - E_{z}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right) - E_{z}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) + E_{z}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j-\\tfrac{1}{2}\\right) \\Big] \\\\\n+ \\frac{\\Delta t}{\\Delta} \\Big[ E_{z}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) - E_{z}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) - E_{z}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right) + E_{z}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j-\\tfrac{1}{2}\\right) \\Big]\n$$\nThe first line on the right-hand side is exactly $\\Delta\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n}\\!(i,j)$. Let's examine the terms involving $E_{z}^{\\,n}$. Let's collect all coefficients of $E_{z}^{\\,n}$ at each of the four vertices of the cell $(i,j)$:\n- $E_{z}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)$: coefficient is $-\\frac{\\Delta t}{\\Delta}(1) + \\frac{\\Delta t}{\\Delta}(1) = 0$.\n- $E_{z}^{\\,n}\\!\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right)$: coefficient is $-\\frac{\\Delta t}{\\Delta}(-1) + \\frac{\\Delta t}{\\Delta}(-1) = 0$.\n- $E_{z}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)$: coefficient is $-\\frac{\\Delta t}{\\Delta}(-1) + \\frac{\\Delta t}{\\Delta}(-1) = 0$.\n- $E_{z}^{\\,n}\\!\\left(i-\\tfrac{1}{2},j-\\tfrac{1}{2}\\right)$: coefficient is $-\\frac{\\Delta t}{\\Delta}(1) + \\frac{\\Delta t}{\\Delta}(1) = 0$.\nAll terms involving $E_{z}^{\\,n}$ cancel out exactly. This is a fundamental property of the Yee lattice, where the discrete divergence of a discrete curl is identically zero. Thus, the equation simplifies to:\n$$\n\\Delta\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n+1}\\!(i,j) = \\Delta\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n}\\!(i,j)\n$$\nDividing by $\\Delta$, we get the expression for the updated divergence:\n$$\n\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n+1}\\!(i,j) = \\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n}\\!(i,j)\n$$\nThis demonstrates that the Constrained Transport scheme exactly preserves the initial discrete divergence of the magnetic field at every time step, irrespective of the timestep size $\\Delta t$, the form of the electric field $E_z$, or the time-centering parameter $\\theta$.\n\nThe problem asks for the value of the divergence after a single forward Euler step, which means we need to evaluate $\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{1}\\!(i,j)$. Based on our derived relation, this is equal to the initial divergence:\n$$\n\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{1}\\!(i,j) = \\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{0}\\!(i,j)\n$$\nThe problem states that the initial field is constructed such that the initial divergence vanishes. We can verify this claim. Starting with the definition of the divergence at $n=0$:\n$$\n\\Delta\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{0}\\!(i,j) = B_{x}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j\\right)-B_{x}^{\\,0}\\!\\left(i-\\tfrac{1}{2},j\\right) + B_{y}^{\\,0}\\!\\left(i,j+\\tfrac{1}{2}\\right)-B_{y}^{\\,0}\\!\\left(i,j-\\tfrac{1}{2}\\right)\n$$\nSubstitute the definitions of $B_{x}^{\\,0}$ and $B_{y}^{\\,0}$ from the discrete vector potential $A_{z}^{\\,0}$:\n$$\n\\Delta\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{0}\\!(i,j) = \\frac{A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right)}{\\Delta} - \\frac{A_{z}^{\\,0}\\!\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-A_{z}^{\\,0}\\!\\left(i-\\tfrac{1}{2},j-\\tfrac{1}{2}\\right)}{\\Delta} \\\\\n- \\frac{A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-A_{z}^{\\,0}\\!\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)}{\\Delta} - \\left(-\\frac{A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right)-A_{z}^{\\,0}\\!\\left(i-\\tfrac{1}{2},j-\\tfrac{1}{2}\\right)}{\\Delta}\\right)\n$$\nMultiplying by $\\Delta$ and collecting terms:\n$$\n\\Delta^2\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{0}\\!(i,j) = \\\\\n\\big[ A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right) - A_{z}^{\\,0}\\!\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)+A_{z}^{\\,0}\\!\\left(i-\\tfrac{1}{2},j-\\tfrac{1}{2}\\right) \\big] \\\\\n+ \\big[ -A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)+A_{z}^{\\,0}\\!\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) +A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right)-A_{z}^{\\,0}\\!\\left(i-\\tfrac{1}{2},j-\\tfrac{1}{2}\\right) \\big]\n$$\nSumming the terms shows that they cancel exactly. For example, $A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) - A_{z}^{\\,0}\\!\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right) = 0$. This holds for all four vertex locations of the cell $(i,j)$. Therefore,\n$$\n\\Delta^2\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{0}\\!(i,j) = 0 \\implies \\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{0}\\!(i,j) = 0\n$$\nSince the initial divergence is zero and the CT scheme preserves this value at every step, the divergence after one forward Euler step (or any number of steps) will also be zero.\n\nThe value of $\\left(\\nabla_{h}\\cdot\\boldsymbol{B}\\right)^{n+1}\\!(i,j)$ after a single step is $0$.", "answer": "$$\\boxed{0}$$", "id": "3469558"}, {"introduction": "Having established the theoretical foundation of divergence preservation, we now zoom in on the practical mechanics of a CT update step. The accuracy of the simulation hinges on how the electromotive force (EMF), $\\boldsymbol{E}$, is calculated at the grid edges from surrounding field values. This problem guides you through an analytical calculation of a single time step for a simplified 2D system, revealing how field reconstruction and the update stencil work in concert to evolve the magnetic field [@problem_id:3469588].", "problem": "Consider a local Riemann-normal coordinate patch of a dynamical spacetime arising in numerical relativity, where over a small region the metric is approximately Minkowski and the shift and lapse are negligible. In this patch, ideal magnetohydrodynamics (Magnetohydrodynamics (MHD)) is assumed, with the ideal Ohm’s law giving the electric field as the negative cross product of the fluid velocity and magnetic field. Specifically, the Electromotive Force (EMF) is defined as $E_{i} = - \\epsilon_{ijk} v^{j} B^{k}$, where $\\epsilon_{ijk}$ is the Levi-Civita symbol. In two spatial dimensions ($2$-D, coordinates $x$ and $y$) with nonzero components $v_{x}$, $v_{y}$, $B_{x}$, and $B_{y}$, the out-of-plane EMF is $E_{z} = - (v_{x} B_{y} - v_{y} B_{x})$.\n\nYou are given a uniform Cartesian mesh with cell centers at $(x_{i}, y_{j})$, face centers at $(x_{i \\pm 1/2}, y_{j})$ and $(x_{i}, y_{j \\pm 1/2})$, and edge centers at $(x_{i \\pm 1/2}, y_{j \\pm 1/2})$. The spacings are $\\Delta x$ and $\\Delta y$. Over the patch, the primitive fields are globally linear and given by\n$$\nv_{x}(x,y) = a_{0} + a_{1} y, \\quad v_{y}(x,y) = b_{0} + b_{1} x, \\quad B_{x}(x,y) = c_{0} + c_{1} x, \\quad B_{y}(x,y) = d_{0} + d_{1} y,\n$$\nwhere $a_{0}$, $a_{1}$, $b_{0}$, $b_{1}$, $c_{0}$, $c_{1}$, $d_{0}$, and $d_{1}$ are constants. The magnetic field is evolved using Constrained Transport (CT), which proceeds from the Maxwell–Faraday law in its $3+1$ split, yielding the evolution equation $\\partial_{t} B_{i} = - (\\nabla \\times \\mathbf{E})_{i}$. In this $2$-D setting, the $x$-component obeys\n$$\n\\partial_{t} B_{x} = - \\frac{\\partial E_{z}}{\\partial y}.\n$$\n\nAssume a second-order accurate CT scheme that updates the face-centered $B_{x}$ at $(x_{i+1/2}, y_{j})$ by integrating the Maxwell–Faraday law over the face area and approximating the $\\partial_{y}$ derivative with a centered difference of edge-centered EMFs:\n$$\nB_{x}^{n+1}(x_{i+1/2}, y_{j}) = B_{x}^{n}(x_{i+1/2}, y_{j}) - \\frac{\\Delta t}{\\Delta y} \\left[ E_{z}(x_{i+1/2}, y_{j+1/2}) - E_{z}(x_{i+1/2}, y_{j-1/2}) \\right].\n$$\nHere, $\\Delta t$ is the time step. To obtain the edge-centered EMFs $E_{z}(x_{i+1/2}, y_{j \\pm 1/2})$, use a bilinear piecewise-linear reconstruction of $\\mathbf{v}$ and $\\mathbf{B}$ from surrounding cell-centered values and then perform arithmetic centering (i.e., average the four one-sided reconstructions that meet at the edge) to form the EMF at the edge. Because the fields are globally linear, this process recovers the pointwise values of $\\mathbf{v}$ and $\\mathbf{B}$ at the edge centers.\n\nStarting from the Maxwell–Faraday law, derive the update for $B_{x}$ at $(x_{i+1/2}, y_{j})$ over one time step $\\Delta t$ in terms of the given constants and mesh locations. Express your final answer as a single closed-form analytic expression for $B_{x}^{n+1}(x_{i+1/2}, y_{j})$ in terms of $c_{0}$, $c_{1}$, $x_{i+1/2}$, $y_{j}$, $\\Delta t$, $a_{0}$, $a_{1}$, $d_{0}$, and $d_{1}$. Do not substitute numerical values. No rounding is required.", "solution": "The user has requested the derivation of a numerical update for the magnetic field component $B_x$ using a constrained transport (CT) scheme in two dimensions under the assumption of globally linear fields in an ideal magnetohydrodynamics (MHD) setting.\n\nThe problem statement has been validated and is deemed a sound, well-posed problem in computational physics. It requires a direct application of the provided numerical update rule to the given analytical field configurations.\n\nThe CT update equation for the face-centered magnetic field component $B_{x}$ at location $(x_{i+1/2}, y_{j})$ is given as:\n$$\nB_{x}^{n+1}(x_{i+1/2}, y_{j}) = B_{x}^{n}(x_{i+1/2}, y_{j}) - \\frac{\\Delta t}{\\Delta y} \\left[ E_{z}(x_{i+1/2}, y_{j+1/2}) - E_{z}(x_{i+1/2}, y_{j-1/2}) \\right]\n$$\nwhere $B_{x}^{n}$ is the value at the current time step $n$, $\\Delta t$ is the time step, $\\Delta y$ is the grid spacing in the $y$-direction, and $E_z$ is the out-of-plane component of the electromotive force (EMF).\n\nThe derivation proceeds in three main steps:\n1.  Evaluate the initial magnetic field term, $B_{x}^{n}(x_{i+1/2}, y_{j})$.\n2.  Evaluate the EMF term, which involves calculating $E_z$ at the two specified edge-centers and finding their difference.\n3.  Combine these results into the update equation to find the final expression for $B_{x}^{n+1}(x_{i+1/2}, y_{j})$.\n\n**Step 1: Evaluation of the Initial Magnetic Field**\nThe problem specifies the global form for the $x$-component of the magnetic field as $B_{x}(x,y) = c_{0} + c_{1} x$. At time step $n$, the value of this field at the face-center $(x_{i+1/2}, y_{j})$ is:\n$$\nB_{x}^{n}(x_{i+1/2}, y_{j}) = c_{0} + c_{1} x_{i+1/2}\n$$\nThis expression is independent of $y_{j}$, as given by the field's definition.\n\n**Step 2: Evaluation of the EMF Difference Term**\nThe EMF $E_z$ is defined by the ideal Ohm's law in two dimensions as $E_{z} = - (v_{x} B_{y} - v_{y} B_{x})$. The primitive fields are given as:\n$v_{x}(x,y) = a_{0} + a_{1} y$\n$v_{y}(x,y) = b_{0} + b_{1} x$\n$B_{x}(x,y) = c_{0} + c_{1} x$\n$B_{y}(x,y) = d_{0} + d_{1} y$\n\nSubstituting these into the definition of $E_z$ gives its analytical form:\n$$\nE_{z}(x,y) = - \\left[ (a_{0} + a_{1} y)(d_{0} + d_{1} y) - (b_{0} + b_{1} x)(c_{0} + c_{1} x) \\right]\n$$\nThe problem states that the numerical method for finding edge-centered values recovers the pointwise values exactly for these linear fields. Thus, we can directly evaluate $E_z(x,y)$ at the required locations. We need to compute the difference $E_{z}(x_{i+1/2}, y_{j+1/2}) - E_{z}(x_{i+1/2}, y_{j-1/2})$.\n\nLet's evaluate $E_z$ at the two points.\nAt $(x_{i+1/2}, y_{j+1/2})$:\n$$\nE_{z}(x_{i+1/2}, y_{j+1/2}) = - \\left[ (a_{0} + a_{1} y_{j+1/2})(d_{0} + d_{1} y_{j+1/2}) - (b_{0} + b_{1} x_{i+1/2})(c_{0} + c_{1} x_{i+1/2}) \\right]\n$$\nAt $(x_{i+1/2}, y_{j-1/2})$:\n$$\nE_{z}(x_{i+1/2}, y_{j-1/2}) = - \\left[ (a_{0} + a_{1} y_{j-1/2})(d_{0} + d_{1} y_{j-1/2}) - (b_{0} + b_{1} x_{i+1/2})(c_{0} + c_{1} x_{i+1/2}) \\right]\n$$\nWhen we take the difference, the term $(b_{0} + b_{1} x_{i+1/2})(c_{0} + c_{1} x_{i+1/2})$ is common to both expressions and cancels out:\n\\begin{align*}\n&E_{z}(x_{i+1/2}, y_{j+1/2}) - E_{z}(x_{i+1/2}, y_{j-1/2}) \\\\\n&= -\\left[ (a_{0} + a_{1} y_{j+1/2})(d_{0} + d_{1} y_{j+1/2}) \\right] - \\left( -\\left[ (a_{0} + a_{1} y_{j-1/2})(d_{0} + d_{1} y_{j-1/2}) \\right] \\right) \\\\\n&= - \\left[ (a_{0} + a_{1} y_{j+1/2})(d_{0} + d_{1} y_{j+1/2}) - (a_{0} + a_{1} y_{j-1/2})(d_{0} + d_{1} y_{j-1/2}) \\right]\n\\end{align*}\nLet's expand the products inside the brackets. Let $P(y) = (a_{0} + a_{1} y)(d_{0} + d_{1} y) = a_{1}d_{1}y^2 + (a_{0}d_{1} + a_{1}d_{0})y + a_{0}d_{0}$. The difference is $P(y_{j+1/2}) - P(y_{j-1/2})$.\n\\begin{align*}\nP(y_{j+1/2}) - P(y_{j-1/2}) &= \\left[ a_{1}d_{1}y_{j+1/2}^2 + (a_{0}d_{1} + a_{1}d_{0})y_{j+1/2} \\right] - \\left[ a_{1}d_{1}y_{j-1/2}^2 + (a_{0}d_{1} + a_{1}d_{0})y_{j-1/2} \\right] \\\\\n&= a_{1}d_{1}(y_{j+1/2}^2 - y_{j-1/2}^2) + (a_{0}d_{1} + a_{1}d_{0})(y_{j+1/2} - y_{j-1/2})\n\\end{align*}\nThe grid coordinates are defined such that $y_{j \\pm 1/2} = y_{j} \\pm \\frac{\\Delta y}{2}$. This means:\n$y_{j+1/2} - y_{j-1/2} = (y_{j} + \\frac{\\Delta y}{2}) - (y_{j} - \\frac{\\Delta y}{2}) = \\Delta y$.\n$y_{j+1/2}^2 - y_{j-1/2}^2 = (y_{j+1/2} - y_{j-1/2})(y_{j+1/2} + y_{j-1/2}) = (\\Delta y)( (y_{j} + \\frac{\\Delta y}{2}) + (y_{j} - \\frac{\\Delta y}{2}) ) = 2 y_{j} \\Delta y$.\n\nSubstituting these relations back into the expression for the difference of products:\n$$\nP(y_{j+1/2}) - P(y_{j-1/2}) = a_{1}d_{1}(2 y_{j} \\Delta y) + (a_{0}d_{1} + a_{1}d_{0})(\\Delta y) = \\Delta y (2 a_{1}d_{1} y_{j} + a_{0}d_{1} + a_{1}d_{0})\n$$\nTherefore, the difference of EMFs is:\n$$\nE_{z}(x_{i+1/2}, y_{j+1/2}) - E_{z}(x_{i+1/2}, y_{j-1/2}) = - \\Delta y (a_{0}d_{1} + a_{1}d_{0} + 2 a_{1}d_{1} y_{j})\n$$\n\n**Step 3: Assemble the Final Expression**\nNow, substitute this result and the expression for $B_x^n$ into the original update equation:\n\\begin{align*}\nB_{x}^{n+1}(x_{i+1/2}, y_{j}) &= (c_{0} + c_{1} x_{i+1/2}) - \\frac{\\Delta t}{\\Delta y} \\left[ - \\Delta y (a_{0}d_{1} + a_{1}d_{0} + 2 a_{1}d_{1} y_{j}) \\right] \\\\\n&= c_{0} + c_{1} x_{i+1/2} + \\Delta t (a_{0}d_{1} + a_{1}d_{0} + 2 a_{1}d_{1} y_{j})\n\\end{align*}\nThis is the final closed-form analytic expression for the updated magnetic field component $B_{x}^{n+1}$ at the specified location. It is expressed solely in terms of the constants and grid locations requested in the problem statement. The expression shows that the update to $B_x$ at $(x_{i+1/2}, y_j)$ depends on the initial value of $B_x$ at that face and on an update term which is constant in $x$ but linear in $y_j$. This is consistent with the exact time evolution, $\\partial_{t} B_{x} = a_{0}d_{1} + a_{1}d_{0} + 2 a_{1}d_{1} y$, as the second-order spatial discretization is exact for the quadratic form of the EMF.", "answer": "$$\n\\boxed{c_{0} + c_{1} x_{i+1/2} + \\Delta t(a_{0} d_{1} + a_{1} d_{0} + 2 a_{1} d_{1} y_{j})}\n$$", "id": "3469588"}, {"introduction": "Theory and analytical exercises are essential, but the ultimate test of a numerical method is its performance in a concrete implementation. This final practice is a coding benchmark designed to let you see the stark difference between a properly constructed CT scheme and a naive, cell-centered approach. By implementing both and measuring the resulting divergence error for the conserved quantity $\\sqrt{\\gamma} \\boldsymbol{B}$, you will gain a practical appreciation for why the careful staggering of variables in CT is not just an arbitrary choice, but a necessity for robustly simulating magnetized fluids in curved spacetime [@problem_id:3469592].", "problem": "Consider the magnetic induction constraint in the three-plus-one split of General Relativity (GR), where the magnetic field measured by Eulerian observers is denoted by $B^i$ and the spatial metric has determinant $\\gamma$. The fundamental base is the Maxwell equations and the Bianchi identity in curved spacetime, which imply that the magnetic field must satisfy the divergence-free constraint in conservative form\n$$\n\\partial_i\\left(\\sqrt{\\gamma}\\,B^i\\right)=0,\n$$\nwhere $\\sqrt{\\gamma}$ is the square root of the determinant of the spatial metric. In numerical relativity and magnetohydrodynamics, Constraint Transport (CT) schemes are designed to enforce a discrete analog of this constraint.\n\nYou will construct a benchmark on a weakly curved, time-dependent background metric, specify an analytic magnetic field $B^i(t,\\mathbf{x})$ that satisfies the continuum constraint exactly, and compare two discrete divergence computations:\n- a CT-like, staggered-grid construction based on a discrete curl of a vector potential $A_i$ that yields face-centered fluxes $\\tilde{B}^i \\equiv \\sqrt{\\gamma}\\,B^i$ whose discrete divergence vanishes to machine precision, and\n- a naive, cell-centered construction that approximates face-centered fluxes by simple averages of adjacent cell-centered values, which will not preserve the discrete constraint and will drift at the level of truncation error.\n\nUse the following scientifically consistent setup.\n\n1) Domain, coordinates, and grid.\n- Use a periodic cubic domain with coordinates $(x,y,z)\\in [0,1)\\times[0,1)\\times[0,1)$.\n- Use a uniform Cartesian grid with $N$ cells per dimension, cell centers at\n$$\nx_i=\\frac{i+\\tfrac{1}{2}}{N},\\quad y_j=\\frac{j+\\tfrac{1}{2}}{N},\\quad z_k=\\frac{k+\\tfrac{1}{2}}{N},\n$$\nfor $i,j,k\\in\\{0,1,\\dots,N-1\\}$, and spacings $\\Delta x=\\Delta y=\\Delta z=1/N$.\n- Use periodic boundary conditions.\n\n2) Weakly curved background (perturbative metric).\n- Define a time-dependent diagonal perturbation $h_{ij}(t,\\mathbf{x})$ of amplitude $\\varepsilon$ and angular frequency $\\omega$ by\n$$\nh_{xx}(t,\\mathbf{x})=\\sin\\!\\left(2\\pi x\\right)\\sin\\!\\left(\\omega t\\right),\\quad\nh_{yy}(t,\\mathbf{x})=\\sin\\!\\left(2\\pi y\\right)\\sin\\!\\left(\\omega t\\right),\\quad\nh_{zz}(t,\\mathbf{x})=\\sin\\!\\left(2\\pi z\\right)\\sin\\!\\left(\\omega t\\right),\n$$\nand $h_{ij}=0$ for $i\\neq j$. The spatial metric is\n$$\n\\gamma_{ij}(t,\\mathbf{x}) = \\delta_{ij} + \\varepsilon\\, h_{ij}(t,\\mathbf{x}).\n$$\nBecause $\\gamma_{ij}$ is diagonal, its determinant is\n$$\n\\gamma(t,\\mathbf{x})=\\left(1+\\varepsilon\\,h_{xx}\\right)\\left(1+\\varepsilon\\,h_{yy}\\right)\\left(1+\\varepsilon\\,h_{zz}\\right),\n$$\nand $\\sqrt{\\gamma}$ is the positive square root of this product. Assume $\\varepsilon$ is small enough that $\\gamma$ remains positive everywhere for the given times.\n\n3) Analytic vector potential and magnetic field.\n- Choose a time-independent vector potential with only a $z$-component,\n$$\nA_x=0,\\quad A_y=0,\\quad A_z(\\mathbf{x})=\\cos\\!\\left(2\\pi x\\right)\\cos\\!\\left(2\\pi y\\right)\\cos\\!\\left(2\\pi z\\right).\n$$\n- Using the contravariant Levi-Civita symbol density $\\tilde{\\epsilon}^{ijk}$ with $\\tilde{\\epsilon}^{xyz}=+1$ and its permutations, define the conserved magnetic flux density\n$$\n\\tilde{B}^i(t,\\mathbf{x}) \\equiv \\sqrt{\\gamma}\\,B^i(t,\\mathbf{x}) = \\tilde{\\epsilon}^{ijk}\\,\\partial_j A_k(\\mathbf{x}).\n$$\nBecause $A_i$ is time-independent, the right-hand side is time-independent, and thus the continuum constraint follows from antisymmetry and commutativity of partial derivatives:\n$$\n\\partial_i\\left(\\sqrt{\\gamma}\\,B^i\\right) = \\partial_i\\left(\\tilde{\\epsilon}^{ijk}\\,\\partial_j A_k\\right)=0.\n$$\nExplicitly,\n$$\n\\tilde{B}^x(\\mathbf{x})=\\partial_y A_z = -2\\pi \\sin\\!\\left(2\\pi y\\right)\\cos\\!\\left(2\\pi x\\right)\\cos\\!\\left(2\\pi z\\right),\n$$\n$$\n\\tilde{B}^y(\\mathbf{x})=-\\partial_x A_z = 2\\pi \\sin\\!\\left(2\\pi x\\right)\\cos\\!\\left(2\\pi y\\right)\\cos\\!\\left(2\\pi z\\right),\n$$\n$$\n\\tilde{B}^z(\\mathbf{x})=0.\n$$\nThe analytic magnetic field is then\n$$\nB^i(t,\\mathbf{x})=\\frac{\\tilde{B}^i(\\mathbf{x})}{\\sqrt{\\gamma}(t,\\mathbf{x})},\n$$\nand satisfies $\\partial_i\\left(\\sqrt{\\gamma}B^i\\right)=0$ exactly in the continuum for all $t$.\n\n4) Two discrete divergence computations on the grid.\n\n4a) CT-like, face-centered fluxes from a discrete curl of staggered $A_i$:\n- Stagger $A_i$ on edges in a Yee-like arrangement and compute face-centered $\\tilde{B}^i$ by discrete curls:\n  - Place $A_z$ at edge centers along the $z$-direction at $(x_{i+\\tfrac{1}{2}}, y_{j+\\tfrac{1}{2}}, z_k)$ and evaluate $A_z$ analytically there.\n  - Compute face-centered fluxes\n  $$\n  \\tilde{B}^x\\Big|_{(x_{i+\\tfrac{1}{2}},y_j,z_k)} = \\frac{A_z\\big(x_{i+\\tfrac{1}{2}},y_{j+\\tfrac{1}{2}},z_k\\big)-A_z\\big(x_{i+\\tfrac{1}{2}},y_{j-\\tfrac{1}{2}},z_k\\big)}{\\Delta y},\n  $$\n  $$\n  \\tilde{B}^y\\Big|_{(x_i,y_{j+\\tfrac{1}{2}},z_k)} = -\\,\\frac{A_z\\big(x_{i+\\tfrac{1}{2}},y_{j+\\tfrac{1}{2}},z_k\\big)-A_z\\big(x_{i-\\tfrac{1}{2}},y_{j+\\tfrac{1}{2}},z_k\\big)}{\\Delta x},\n  $$\n  and $\\tilde{B}^z=0$.\n- Define the discrete divergence at cell centers $(x_i,y_j,z_k)$ as the finite-volume flux difference\n  $$\n  \\left[\\nabla\\cdot\\tilde{\\mathbf{B}}\\right]_{i,j,k} \\equiv \\frac{\\tilde{B}^x_{i,j,k}-\\tilde{B}^x_{i-1,j,k}}{\\Delta x}+\\frac{\\tilde{B}^y_{i,j,k}-\\tilde{B}^y_{i,j-1,k}}{\\Delta y}+\\frac{\\tilde{B}^z_{i,j,k}-\\tilde{B}^z_{i,j,k-1}}{\\Delta z},\n  $$\n  with periodic indexing. Show numerically that this discrete divergence is zero to round-off because it is a discrete divergence of a discrete curl.\n\n4b) Naive, cell-centered reconstruction:\n- Compute cell-centered analytic $B^i_{i,j,k}(t)$ by evaluating $\\tilde{B}^i(\\mathbf{x})$ at cell centers and dividing by $\\sqrt{\\gamma}(t,\\mathbf{x})$ at cell centers:\n  $$\n  B^i_{i,j,k}(t)=\\frac{\\tilde{B}^i(x_i,y_j,z_k)}{\\sqrt{\\gamma}(t,x_i,y_j,z_k)}.\n  $$\n- Approximate face-centered fluxes by simple averaging of adjacent cell-centered values:\n  $$\n  \\tilde{B}^x_{\\text{naive},\\,i,j,k} \\equiv \\left[\\frac{\\sqrt{\\gamma}_{i,j,k}+\\sqrt{\\gamma}_{i+1,j,k}}{2}\\right]\\left[\\frac{B^x_{i,j,k}+B^x_{i+1,j,k}}{2}\\right],\n  $$\n  $$\n  \\tilde{B}^y_{\\text{naive},\\,i,j,k} \\equiv \\left[\\frac{\\sqrt{\\gamma}_{i,j,k}+\\sqrt{\\gamma}_{i,j+1,k}}{2}\\right]\\left[\\frac{B^y_{i,j,k}+B^y_{i,j+1,k}}{2}\\right],\n  $$\n  $$\n  \\tilde{B}^z_{\\text{naive},\\,i,j,k} \\equiv \\left[\\frac{\\sqrt{\\gamma}_{i,j,k}+\\sqrt{\\gamma}_{i,j,k+1}}{2}\\right]\\left[\\frac{B^z_{i,j,k}+B^z_{i,j,k+1}}{2}\\right],\n  $$\n  with periodic indexing.\n- Compute the same discrete divergence operator as in $4\\text{a}$ using these naive face-centered fluxes. This naive divergence does not vanish exactly and exhibits truncation error that depends on $\\Delta x$ and on the spatial variation of $\\sqrt{\\gamma}$.\n\n5) Error metrics.\n- For each scheme, compute the root-mean-square (RMS) discrete divergence over all cells,\n$$\nE \\equiv \\sqrt{\\frac{1}{N^3}\\sum_{i,j,k}\\left(\\left[\\nabla\\cdot\\tilde{\\mathbf{B}}\\right]_{i,j,k}\\right)^2}.\n$$\n\n6) Test suite.\nEvaluate the RMS errors for the following parameter sets $(N,\\varepsilon,\\omega,t)$:\n- Case A (happy path): $(N=\\;16,\\;\\varepsilon=\\;0.05,\\;\\omega=\\;2.0,\\;t=\\;0.30)$.\n- Case B (boundary in time where perturbation vanishes): $(N=\\;16,\\;\\varepsilon=\\;0.05,\\;\\omega=\\;2.0,\\;t=\\;0.00)$.\n- Case C (refinement with stronger curvature): $(N=\\;32,\\;\\varepsilon=\\;0.10,\\;\\omega=\\;2.0,\\;t=\\;0.30)$.\n- Case D (different frequency and time): $(N=\\;24,\\;\\varepsilon=\\;0.10,\\;\\omega=\\;3.0,\\;t=\\;0.73)$.\n\nFor each case, compute two floats: $E_{\\mathrm{CT}}$ for the CT-like staggered discrete curl and $E_{\\mathrm{naive}}$ for the naive cell-centered reconstruction.\n\n7) Required final output format.\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order\n$$\n\\left[E_{\\mathrm{CT}}^{\\mathrm{A}},\\,E_{\\mathrm{naive}}^{\\mathrm{A}},\\,E_{\\mathrm{CT}}^{\\mathrm{B}},\\,E_{\\mathrm{naive}}^{\\mathrm{B}},\\,E_{\\mathrm{CT}}^{\\mathrm{C}},\\,E_{\\mathrm{naive}}^{\\mathrm{C}},\\,E_{\\mathrm{CT}}^{\\mathrm{D}},\\,E_{\\mathrm{naive}}^{\\mathrm{D}}\\right],\n$$\nwith each float printed in scientific notation with exactly $10$ significant digits (for example, $1.234567890\\text{e-}04$). No units are needed because all quantities are dimensionless by construction. Angles are in radians by definition of the trigonometric arguments. Percentages are not used in this problem.\n\nYour task is to implement this entire procedure in a self-contained, runnable program that performs all computations and prints the final list exactly in the specified format. No user input, external files, or network access are allowed.", "solution": "The problem as stated is valid. It is scientifically grounded in the principles of numerical relativity and magnetohydrodynamics, well-posed with a clear and complete set of definitions, and objective in its formulation. We will proceed to construct the solution.\n\nThe core of this problem lies in the numerical enforcement of the magnetic field divergence-free constraint, $\\partial_i(\\sqrt{\\gamma}\\,B^i)=0$, a fundamental law derived from Maxwell's equations in curved spacetime. This constraint must be maintained in any numerical simulation to avoid unphysical phenomena, such as the generation of magnetic monopoles. We will implement and compare two distinct numerical schemes for calculating the discrete divergence of the magnetic flux density, $\\tilde{\\mathbf{B}} \\equiv \\sqrt{\\gamma}\\,\\mathbf{B}$.\n\nThe problem provides a specific analytical setup on a periodic domain with a time-dependent, weakly curved metric. The magnetic field is derived from a vector potential $A_k$, which guarantees that the divergence constraint is satisfied exactly in the continuum. The conserved flux density is $\\tilde{B}^i = \\tilde{\\epsilon}^{ijk}\\,\\partial_j A_k$. Its divergence is $\\partial_i \\tilde{B}^i = \\partial_i (\\tilde{\\epsilon}^{ijk}\\,\\partial_j A_k)$, which vanishes identically due to the antisymmetry of $\\tilde{\\epsilon}^{ijk}$ and the commutativity of partial derivatives, $\\partial_i \\partial_j = \\partial_j \\partial_i$. Our task is to see how well this property is preserved at the discrete level by two different numerical schemes.\n\nWe will use a uniform Cartesian grid with $N^3$ cells and spacing $\\Delta x = \\Delta y = \\Delta z = 1/N$.\n\n**1. The Constraint Transport (CT) Method**\n\nThe first method is a \"Constraint Transport\" (CT) scheme, also known as a Yee-staggered grid method. The central principle of CT methods is to discretize differential operators in a way that preserves key vector identities of continuum calculus at the discrete level. Here, we exploit the identity $\\nabla \\cdot (\\nabla \\times \\mathbf{A}) = 0$. By defining the magnetic field as the discrete curl of a discrete vector potential, its discrete divergence will be mathematically zero, up to machine floating-point precision.\n\nThe problem specifies $A_k = (0, 0, A_z)$ with $A_z(\\mathbf{x})=\\cos(2\\pi x)\\cos(2\\pi y)\\cos(2\\pi z)$. The conserved fluxes are $\\tilde{B}^x = \\partial_y A_z$, $\\tilde{B}^y = -\\partial_x A_z$, and $\\tilde{B}^z = 0$.\n\nTo implement this, we discretize $A_z$ on the grid. Following the Yee-like staggering, we evaluate $A_z$ at the centers of the $z$-directed edges of the grid cells. For a cell indexed by $(i,j,k)$, these edge centers are located at coordinates $(x_{i+1/2}, y_{j+1/2}, z_k)$. Let's denote the value of $A_z$ at this location as $A_z(i+1/2, j+1/2, k)$.\n\nThe face-centered fluxes are then computed using second-order centered finite differences, which act as a discrete curl operator:\n- The $x$-component of the flux, $\\tilde{B}^x$, lives on the center of $x$-faces, at locations $(x_{i+1/2}, y_j, z_k)$. We compute it as:\n$$\n\\tilde{B}^x_{i,j,k} \\equiv \\tilde{B}^x\\Big|_{(x_{i+1/2}, y_j, z_k)} = \\frac{A_z(i+1/2, j+1/2, k) - A_z(i+1/2, j-1/2, k)}{\\Delta y}\n$$\n- The $y$-component, $\\tilde{B}^y$, lives on the center of $y$-faces, at $(x_i, y_{j+1/2}, z_k)$:\n$$\n\\tilde{B}^y_{i,j,k} \\equiv \\tilde{B}^y\\Big|_{(x_i, y_{j+1/2}, z_k)} = -\\frac{A_z(i+1/2, j+1/2, k) - A_z(i-1/2, j+1/2, k)}{\\Delta x}\n$$\n- $\\tilde{B}^z$ is zero everywhere. The adopted index notation is common, where $\\tilde{B}^x_{i,j,k}$ denotes flux on the face at $x_{i+1/2}$, and so on.\n\nThe discrete divergence is computed at cell centers $(x_i, y_j, z_k)$ using a finite-volume approach, which is a centered difference of the face-centered fluxes:\n$$\n\\left[\\nabla\\cdot\\tilde{\\mathbf{B}}\\right]_{i,j,k} = \\frac{\\tilde{B}^x_{i,j,k} - \\tilde{B}^x_{i-1,j,k}}{\\Delta x} + \\frac{\\tilde{B}^y_{i,j,k} - \\tilde{B}^y_{i,j-1,k}}{\\Delta y} + 0\n$$\nIf we substitute the definitions of the discrete fluxes into this expression, we find that the terms cancel exactly. The first term becomes:\n$$\n\\frac{1}{\\Delta x \\Delta y} \\left[ \\left( A_z(i+\\frac{1}{2}, j+\\frac{1}{2}, k) - A_z(i+\\frac{1}{2}, j-\\frac{1}{2}, k) \\right) - \\left( A_z(i-\\frac{1}{2}, j+\\frac{1}{2}, k) - A_z(i-\\frac{1}{2}, j-\\frac{1}{2}, k) \\right) \\right]\n$$\nAnd the second term:\n$$\n-\\frac{1}{\\Delta y \\Delta x} \\left[ \\left( A_z(i+\\frac{1}{2}, j+\\frac{1}{2}, k) - A_z(i-\\frac{1}{2}, j+\\frac{1}{2}, k) \\right) - \\left( A_z(i+\\frac{1}{2}, j-\\frac{1}{2}, k) - A_z(i-\\frac{1}{2}, j-\\frac{1}{2}, k) \\right) \\right]\n$$\nRearranging terms shows that these two expressions are equal and opposite. Their sum is identically zero. Thus, the discrete divergence of a discrete curl is zero. The resulting error, $E_{\\mathrm{CT}}$, will be non-zero only due to floating-point round-off, and is expected to be on the order of machine precision. This demonstrates the power of the CT method. Note that the metric $\\gamma_{ij}$ does not enter this calculation at all, because we are working with the conserved quantity $\\tilde{B}^i$, which is defined via the curl of $A_k$ independently of the metric.\n\n**2. The Naive Cell-Centered Method**\n\nThe second method is a more straightforward, but less robust, approach. It begins by computing all quantities at cell centers.\n- First, we evaluate the cell-centered physical magnetic field $B^i_{i,j,k} = B^i(t, x_i, y_j, z_k)$. This involves:\n  1. Evaluating the analytic conserved flux density, $\\tilde{B}^i(x_i, y_j, z_k)$.\n  2. Evaluating the metric components $h_{ll}(t, x_i, y_j, z_k)$ and then $\\sqrt{\\gamma(t, x_i, y_j, z_k)}$.\n  3. Dividing to get $B^i_{i,j,k} = \\tilde{B}^i(x_i,y_j,z_k) / \\sqrt{\\gamma(t, x_i,y_j,z_k)}$.\n\n- Next, we need to reconstruct the fluxes on the cell faces. The naive scheme does this by separately averaging the metric factor $\\sqrt{\\gamma}$ and the field component $B^i$ from adjacent cells. For the flux through the $x$-face at $x_{i+1/2}$, this is:\n$$\n\\tilde{B}^x_{\\text{naive},\\,i,j,k} = \\left[\\frac{\\sqrt{\\gamma}_{i,j,k}+\\sqrt{\\gamma}_{i+1,j,k}}{2}\\right]\\left[\\frac{B^x_{i,j,k}+B^x_{i+1,j,k}}{2}\\right]\n$$\nand similarly for the other components.\n\n- Finally, we compute the discrete divergence using the same finite-volume formula as before, but with these naively constructed fluxes.\n\nThis method introduces errors. The product of averages is not the same as the average of products. A better second-order approximation to the face-centered flux $(\\sqrt{\\gamma} B^x)|_{i+1/2}$ would be $\\frac{1}{2}((\\sqrt{\\gamma} B^x)_i + (\\sqrt{\\gamma} B^x)_{i+1})$. The chosen scheme introduces an additional error term proportional to $(\\sqrt{\\gamma}_{i+1}-\\sqrt{\\gamma}_i)(B^x_{i+1}-B^x_i)$, which is of order $O(\\Delta x^2)$. When these flux approximations are used in the discrete divergence formula, the terms no longer cancel. The resulting discrete divergence is non-zero, representing a source of magnetic monopoles at the level of the scheme's truncation error. This error $E_{\\mathrm{naive}}$ will be proportional to the grid spacing (specifically, $O(\\Delta x^2)$ for this second-order scheme) and the magnitude of the spatial variations in $\\sqrt{\\gamma}$ and $B^i$. We expect $E_{\\mathrm{naive}}$ to be significantly larger than $E_{\\mathrm{CT}}$ and to decrease with grid refinement.\n\n**3. Implementation and Error Calculation**\n\nThe implementation will follow these steps for each test case $(N,\\varepsilon,\\omega,t)$. We will use `numpy` for efficient array computations, with `np.roll` handling the periodic boundary conditions.\n- For the CT method, we generate a staggered grid for $A_z$, compute face-centered fluxes $\\tilde{B}^i$ via finite differences, and then compute the divergence of this field.\n- For the naive method, we generate a cell-centered grid, compute all quantities ($B^i$, $\\sqrt{\\gamma}$) on it, reconstruct face fluxes by averaging, and then compute the divergence.\n- For both schemes, the root-mean-square (RMS) value of the resulting discrete divergence field is calculated over all $N^3$ cells to quantify the error.\n\nThe final output will be a list of these RMS errors, $E_{\\mathrm{CT}}$ and $E_{\\mathrm{naive}}$, for each test case, formatted as requested.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the benchmark problem for constraint transport methods.\n    \n    This function iterates through a set of predefined test cases. For each case, it computes\n    the discrete magnetic field divergence using two different numerical schemes:\n    1. A Constraint-Transport (CT) like staggered-grid method.\n    2. A naive cell-centered averaging method.\n    \n    It then calculates the root-mean-square (RMS) error of the divergence for each scheme\n    and prints the results in a comma-separated list as specified.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple is (N, epsilon, omega, t)\n    test_cases = [\n        (16, 0.05, 2.0, 0.30),  # Case A\n        (16, 0.05, 2.0, 0.00),  # Case B\n        (32, 0.10, 2.0, 0.30),  # Case C\n        (24, 0.10, 3.0, 0.73),  # Case D\n    ]\n\n    results = []\n    for N, epsilon, omega, t in test_cases:\n        # ---- Grid setup ----\n        dx = dy = dz = 1.0 / N\n        \n        # ---- Analytic function definitions ----\n        def A_z(x, y, z):\n            return np.cos(2 * np.pi * x) * np.cos(2 * np.pi * y) * np.cos(2 * np.pi * z)\n\n        def tilde_B_x(x, y, z):\n            return -2 * np.pi * np.sin(2 * np.pi * y) * np.cos(2 * np.pi * x) * np.cos(2 * np.pi * z)\n\n        def tilde_B_y(x, y, z):\n            return 2 * np.pi * np.sin(2 * np.pi * x) * np.cos(2 * np.pi * y) * np.cos(2 * np.pi * z)\n\n        def h_pert(t_val, omega_val, coord_val):\n            return np.sin(2 * np.pi * coord_val) * np.sin(omega_val * t_val)\n\n        # ---- 1) CT-like, face-centered fluxes from discrete curl of staggered A_i ----\n\n        # Grid for A_z (z-edge centers: x_{i+1/2}, y_{j+1/2}, z_k)\n        i_idx, j_idx, k_idx = np.arange(N), np.arange(N), np.arange(N)\n        z_edge_x_coords = (i_idx + 1.0) / N\n        z_edge_y_coords = (j_idx + 1.0) / N\n        z_edge_z_coords = (k_idx + 0.5) / N\n        x_ffc, y_ffc, z_ffc = np.meshgrid(z_edge_x_coords, z_edge_y_coords, z_edge_z_coords, indexing='ij')\n\n        A_z_staggered = A_z(x_ffc, y_ffc, z_ffc)\n\n        # Compute face-centered fluxes via discrete curl\n        B_tilde_x_ct = (A_z_staggered - np.roll(A_z_staggered, 1, axis=1)) / dy\n        B_tilde_y_ct = -(A_z_staggered - np.roll(A_z_staggered, 1, axis=0)) / dx\n        # B_tilde_z is zero.\n\n        # Compute discrete divergence at cell centers\n        div_x_ct = (B_tilde_x_ct - np.roll(B_tilde_x_ct, 1, axis=0)) / dx\n        div_y_ct = (B_tilde_y_ct - np.roll(B_tilde_y_ct, 1, axis=1)) / dy\n        div_B_ct = div_x_ct + div_y_ct\n\n        E_ct = np.sqrt(np.mean(div_B_ct**2))\n        results.append(f\"{E_ct:.10e}\")\n        \n        # ---- 2) Naive, cell-centered reconstruction ----\n\n        # Grid for cell-centered quantities (x_i, y_j, z_k)\n        cell_x_coords = (i_idx + 0.5) / N\n        cell_y_coords = (j_idx + 0.5) / N\n        cell_z_coords = (k_idx + 0.5) / N\n        x_ccc, y_ccc, z_ccc = np.meshgrid(cell_x_coords, cell_y_coords, cell_z_coords, indexing='ij')\n\n        h_xx_ccc = h_pert(t, omega, x_ccc)\n        h_yy_ccc = h_pert(t, omega, y_ccc)\n        h_zz_ccc = h_pert(t, omega, z_ccc)\n        \n        sqrt_gamma_ccc = np.sqrt(\n            (1 + epsilon * h_xx_ccc) *\n            (1 + epsilon * h_yy_ccc) *\n            (1 + epsilon * h_zz_ccc)\n        )\n        \n        tilde_B_x_ccc = tilde_B_x(x_ccc, y_ccc, z_ccc)\n        tilde_B_y_ccc = tilde_B_y(x_ccc, y_ccc, z_ccc)\n        \n        B_x_ccc = tilde_B_x_ccc / sqrt_gamma_ccc\n        B_y_ccc = tilde_B_y_ccc / sqrt_gamma_ccc\n        # B_z_ccc is zero.\n\n        # Approximate face-centered fluxes by simple averaging\n        # x-fluxes at (i+1/2, j, k)\n        sqrt_gamma_avg_x = 0.5 * (sqrt_gamma_ccc + np.roll(sqrt_gamma_ccc, -1, axis=0))\n        B_x_avg = 0.5 * (B_x_ccc + np.roll(B_x_ccc, -1, axis=0))\n        B_tilde_x_naive = sqrt_gamma_avg_x * B_x_avg\n        \n        # y-fluxes at (i, j+1/2, k)\n        sqrt_gamma_avg_y = 0.5 * (sqrt_gamma_ccc + np.roll(sqrt_gamma_ccc, -1, axis=1))\n        B_y_avg = 0.5 * (B_y_ccc + np.roll(B_y_ccc, -1, axis=1))\n        B_tilde_y_naive = sqrt_gamma_avg_y * B_y_avg\n\n        # z-fluxes are zero.\n\n        # Compute discrete divergence using naive fluxes\n        div_x_naive = (B_tilde_x_naive - np.roll(B_tilde_x_naive, 1, axis=0)) / dx\n        div_y_naive = (B_tilde_y_naive - np.roll(B_tilde_y_naive, 1, axis=1)) / dy\n        div_B_naive = div_x_naive + div_y_naive\n        \n        E_naive = np.sqrt(np.mean(div_B_naive**2))\n        results.append(f\"{E_naive:.10e}\")\n        \n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3469592"}]}