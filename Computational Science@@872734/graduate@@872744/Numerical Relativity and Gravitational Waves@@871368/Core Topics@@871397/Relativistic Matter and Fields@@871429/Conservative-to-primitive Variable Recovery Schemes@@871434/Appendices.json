{"hands_on_practices": [{"introduction": "Before tackling the \"inverse problem\" of recovering primitive variables, one must first master the \"forward\" transformation from primitives to conservatives. This exercise grounds your understanding in the fundamental definitions of the Valencia formulation. You will derive the expressions for the conservative variables $D$, $S_i$, and $\\tau$ and then compute them for a given fluid state, reinforcing their physical and mathematical meaning [@problem_id:3468862].", "problem": "In computational general relativistic hydrodynamics as applied in numerical relativity for gravitational-wave source modeling, the Valencia formulation rewrites the perfect-fluid equations in terms of conservative variables constructed from a $3+1$ split of spacetime and projections onto Eulerian observers. Consider a uniform fluid cell in special relativistic Minkowski spacetime with metric $g_{\\mu\\nu}=\\mathrm{diag}(-1,1,1,1)$, lapse $\\alpha=1$, shift $\\beta^{i}=0$, and spatial metric $\\gamma_{ij}=\\delta_{ij}$. The fluid is described by its rest-mass density $\\rho$, specific internal energy $\\epsilon$, spatial $3$-velocity $v^{i}$ measured by Eulerian observers, and an ideal-gas equation of state (EOS) $p=(\\Gamma-1)\\rho\\,\\epsilon$, with $p$ the pressure and $\\Gamma$ the adiabatic index. The specific enthalpy is defined as $h=1+\\epsilon+\\frac{p}{\\rho}$, and the Lorentz factor associated with the $3$-velocity is $W=(1-v^{2})^{-1/2}$, where $v^{2}=\\gamma_{ij}v^{i}v^{j}$.\n\nStarting only from the fundamental definitions of the rest-mass current $J^{\\mu}=\\rho\\,u^{\\mu}$, the perfect-fluid stress-energy tensor $T^{\\mu\\nu}=\\rho\\,h\\,u^{\\mu}u^{\\nu}+p\\,g^{\\mu\\nu}$, and the $3+1$ decomposition with Eulerian observers $n^{\\mu}$, derive the expressions for the Valencia conservative variables in Minkowski spacetime and then compute them for the following primitive data:\n- $\\rho=1$,\n- $v^{i}=(0.3,\\,0,\\,0)$,\n- $\\epsilon=0.5$,\n- $\\Gamma=2$.\n\nIn your derivation, explicitly show the intermediate steps for the Lorentz factor $W$, the pressure $p$, and the specific enthalpy $h$ before computing the conservative triplet consisting of the rest-mass density $D$, the momentum density $S_{i}$, and the energy variable $\\tau$. Round your final numerical values for $D$, $S_{x}$, $S_{y}$, $S_{z}$, and $\\tau$ to six significant figures. Express the final answer in geometrized units with the speed of light $c=1$ and Newton’s constant $G=1$, and provide the five quantities as a single row vector in the order $(D,\\,S_{x},\\,S_{y},\\,S_{z},\\,\\tau)$.", "solution": "The problem requires the derivation of the Valencia conservative variables in a simplified flat spacetime setting and their subsequent calculation for a given set of primitive fluid variables. The validation of the problem statement finds it to be scientifically grounded, well-posed, and objective, with all necessary information provided for a unique solution.\n\nFirst, we establish the framework. The problem is set in Minkowski spacetime, with the metric given by $g_{\\mu\\nu}=\\mathrm{diag}(-1,1,1,1)$ and hence $g^{\\mu\\nu}=\\mathrm{diag}(-1,1,1,1)$. The $3+1$ decomposition is trivial, with a lapse function $\\alpha=1$, a zero shift vector $\\beta^{i}=0$, and a flat spatial metric $\\gamma_{ij}=\\delta_{ij}$. This implies that the determinant of the spatial metric is $\\gamma = \\det(\\gamma_{ij}) = 1$. The Eulerian observers, who are at rest in this coordinate system, have a $4$-velocity given by $n^{\\mu} = (1/\\alpha, -\\beta^i/\\alpha) = (1,0,0,0)$. The corresponding covariant vector is $n_{\\mu} = g_{\\mu\\nu}n^{\\nu} = (-1,0,0,0)$.\n\nThe fluid's $4$-velocity, $u^{\\mu}$, is related to its $3$-velocity $v^{i}$ as measured by the Eulerian observers via the Lorentz factor $W$. The components are $u^{\\mu} = W(1, v^1, v^2, v^3)$. The Lorentz factor is defined as $W=(1-v^{2})^{-1/2}$, where $v^{2} = \\gamma_{ij}v^{i}v^{j}$. This definition correctly normalizes the $4$-velocity, since $u^{\\mu}u_{\\mu} = g_{\\mu\\nu}u^{\\mu}u^{\\nu} = W^2(-1 + v^2) = (1-v^2)^{-1}(-1+v^2) = -1$.\n\nThe Valencia conservative variables ($D$, $S_i$, $\\tau$) are defined by projecting the fundamental relativistic hydrodynamics tensors—the rest-mass current $J^{\\mu}$ and the stress-energy tensor $T^{\\mu\\nu}$—using the Eulerian observer's $4$-velocity $n^\\mu$ and the spatial metric $\\gamma_{ij}$.\n\n1.  **Derivation of the Conservative Rest-Mass Density, $D$**:\n    $D$ is defined as the rest-mass density measured by the Eulerian observer, scaled by the square root of the determinant of the spatial metric, $\\sqrt{\\gamma}$. It is obtained by projecting the rest-mass current $J^{\\mu}=\\rho\\,u^{\\mu}$ along the normal direction $n_{\\mu}$:\n    $$D = -\\sqrt{\\gamma} n_{\\mu} J^{\\mu}$$\n    Substituting the known quantities in our simplified spacetime ($\\sqrt{\\gamma}=1$, $n_{\\mu}=(-1,0,0,0)$, and $J^{\\mu}=\\rho W(1, v^i)$):\n    $$D = -1 \\cdot [(-1)(\\rho W) + (0)(\\rho W v^1) + (0)(\\rho W v^2) + (0)(\\rho W v^3)] = \\rho W$$\n\n2.  **Derivation of the Conservative Momentum Density, $S_i$**:\n    $S_i$ is the momentum density as measured by the Eulerian observer. It is obtained by projecting the stress-energy tensor $T^{\\mu\\nu}$ onto the spatial hypersurface in the direction of the observer's worldline. The stress-energy tensor for a perfect fluid is $T^{\\mu\\nu}=\\rho\\,h\\,u^{\\mu}u^{\\nu}+p\\,g^{\\mu\\nu}$, where $h$ is the specific enthalpy and $p$ is the pressure.\n    The definition of $S_i$ is:\n    $$S_i = \\alpha \\sqrt{\\gamma} \\, T_{i\\mu} n^{\\mu}$$\n    In our case, $\\alpha=1$ and $\\sqrt{\\gamma}=1$. The components $T_{i\\mu}$ are $T_{i\\mu}=g_{i\\nu}T^{\\nu\\mu} = \\delta_{i\\nu}T^{\\nu\\mu} = T^{i\\mu}$. With $n^{\\mu}=(1,0,0,0)$, the expression simplifies to:\n    $$S_i = T^{i0}$$\n    Now we compute the component $T^{i0}$ of the stress-energy tensor:\n    $$T^{i0} = \\rho h u^i u^0 + p g^{i0}$$\n    Since $g^{i0}=0$, and we have $u^i = W v^i$ and $u^0 = W$, this becomes:\n    $$S_i = \\rho h (W v^i) (W) = \\rho h W^2 v^i$$\n    Since the spatial metric is Cartesian, the covariant components $v_i = \\gamma_{ij}v^j = \\delta_{ij}v^j$ are numerically identical to the contravariant components $v^i$. Thus, we can write $S_i = \\rho h W^2 v_i$.\n\n3.  **Derivation of the Conservative Energy Variable, $\\tau$**:\n    $\\tau$ represents the total energy density measured by the Eulerian observer, minus the rest-mass energy density $D$. The total energy density, $E$, is obtained by doubly projecting $T^{\\mu\\nu}$ along $n_{\\mu}$:\n    $$E = \\alpha^2 \\sqrt{\\gamma} T^{\\mu\\nu} n_{\\mu} n_{\\nu}$$\n    The variable $\\tau$ is then defined as $\\tau = E - D$. With $\\alpha=1$ and $\\sqrt{\\gamma}=1$:\n    $$E = T^{\\mu\\nu}n_{\\mu}n_{\\nu} = T^{00}(-1)(-1) = T^{00}$$\n    We compute the component $T^{00}$:\n    $$T^{00} = \\rho h u^0 u^0 + p g^{00} = \\rho h W^2 - p$$\n    Therefore, the expression for $\\tau$ is:\n    $$\\tau = E - D = (\\rho h W^2 - p) - \\rho W$$\n\nNow we proceed to compute these quantities for the given primitive data: $\\rho=1$, $v^{i}=(0.3,\\,0,\\,0)$, $\\epsilon=0.5$, and $\\Gamma=2$.\n\nFirst, we compute the intermediate quantities:\n-   The squared magnitude of the $3$-velocity is $v^2 = \\gamma_{ij}v^{i}v^{j} = \\delta_{ij}v^{i}v^{j} = (0.3)^2 + 0^2 + 0^2 = 0.09$.\n-   The Lorentz factor is $W = (1-v^2)^{-1/2} = (1-0.09)^{-1/2} = (0.91)^{-1/2} \\approx 1.0482848367$.\n-   The pressure $p$ is given by the ideal-gas EOS: $p = (\\Gamma-1)\\rho\\,\\epsilon = (2-1)(1)(0.5) = 0.5$.\n-   The specific enthalpy $h$ is $h = 1+\\epsilon+\\frac{p}{\\rho} = 1+0.5+\\frac{0.5}{1} = 2.0$.\n\nUsing these values, we compute the conservative variables:\n-   The rest-mass density $D$:\n    $$D = \\rho W = 1 \\times (0.91)^{-1/2} \\approx 1.0482848367$$\n    Rounding to six significant figures, $D \\approx 1.04828$.\n\n-   The momentum density $S_i$: We need to compute $S_x$, $S_y$, and $S_z$.\n    $$S_i = \\rho h W^2 v_i = (1)(2.0)(0.91)^{-1} v_i = \\frac{2}{0.91}v_i$$\n    For $S_x = S_1$:\n    $$S_x = \\frac{2}{0.91} \\times 0.3 = \\frac{0.6}{0.91} \\approx 0.6593406593$$\n    Rounding to six significant figures, $S_x \\approx 0.659341$.\n    For $S_y = S_2$ and $S_z = S_3$, since $v_y=0$ and $v_z=0$:\n    $$S_y = 0$$\n    $$S_z = 0$$\n\n-   The energy variable $\\tau$:\n    $$\\tau = \\rho h W^2 - p - D = (1)(2.0)(0.91)^{-1} - 0.5 - 1.0482848367$$\n    $$\\tau = \\frac{2}{0.91} - 0.5 - (0.91)^{-1/2} \\approx 2.1978021978 - 0.5 - 1.0482848367$$\n    $$\\tau \\approx 0.6495173611$$\n    Rounding to six significant figures, $\\tau \\approx 0.649517$.\n\nThe final computed conservative variables, rounded to six significant figures, are:\n$D \\approx 1.04828$\n$S_x \\approx 0.659341$\n$S_y = 0$\n$S_z = 0$\n$\\tau \\approx 0.649517$", "answer": "$$ \\boxed{ \\begin{pmatrix} 1.04828  0.659341  0  0  0.649517 \\end{pmatrix} } $$", "id": "3468862"}, {"introduction": "Most general recovery schemes rely on iterative root-finding methods like the Newton-Raphson algorithm. The heart of this method is the Jacobian, the derivative of the residual function that guides the solver toward a solution. This practice focuses on deriving this analytical Jacobian for a standard recovery scheme, a crucial skill for implementing and debugging numerical solvers in relativistic hydrodynamics [@problem_id:3468841].", "problem": "In the Valencia formulation of special-relativistic hydrodynamics used in numerical relativity for compact-object simulations relevant to gravitational-wave sources, the conserved variables are defined in terms of the primitive variables. Let $W$ denote the Lorentz factor, $D$ the conserved rest-mass density, $S_i$ the conserved momentum density, and $\\tau$ the conserved energy variable. The primitive variables are the rest-mass density $\\rho$, the three-velocity $v^i$, the pressure $p$, and the specific internal energy $\\epsilon$. The specific enthalpy is $h \\equiv 1 + \\epsilon + p/\\rho$. Units are chosen such that the speed of light is $1$.\n\nThe fundamental relations are:\n- $W \\equiv (1 - v^2)^{-1/2}$, where $v^2 \\equiv \\delta_{ij} v^i v^j$,\n- $D \\equiv \\rho W$,\n- $S_i \\equiv \\rho h W^2 v_i$, so $S^2 \\equiv \\delta^{ij} S_i S_j$,\n- $\\tau \\equiv \\rho h W^2 - p - D$.\n\nAn ideal-gas Equation of State (EOS) is assumed: $p = (\\Gamma - 1)\\rho \\epsilon$, where $\\Gamma  1$ is the adiabatic index. The EOS implies $h = 1 + \\Gamma \\epsilon$, and hence $\\epsilon = (h - 1)/\\Gamma$ and $p = \\rho (\\Gamma - 1)(h - 1)/\\Gamma$.\n\nA widely used conservative-to-primitive variable recovery scheme solves, via Newton-Raphson, the scalar residual\n$$\nR(W) \\equiv \\rho h W^2 - p - D - \\tau,\n$$\nfor the unknown $W$, given known $(D, S^2, \\tau, \\Gamma)$. Treat $S^2$ as the squared magnitude $S^2 \\equiv \\delta^{ij} S_i S_j$.\n\nStarting strictly from the definitions above and without invoking any unintroduced shortcut formulas, derive the closed-form analytic expression for the Jacobian needed by Newton-Raphson, $\\partial R/\\partial W$, by differentiating consistently through $\\rho = D/W$, the enthalpy $h$, and the ideal-gas EOS $p = (\\Gamma - 1)\\rho \\epsilon$. Express your final result solely in terms of $W$, $D$, $S^2$, and $\\Gamma$.\n\nYour final answer must be a single analytic expression. No numerical approximation is required.", "solution": "The problem as stated constitutes a valid, self-contained, and well-posed mathematical derivation task grounded in the principles of special-relativistic hydrodynamics. It is free from any scientific or logical inconsistencies. The provided definitions and equations are standard in the field of numerical relativity. Therefore, I will proceed with the derivation of the requested Jacobian.\n\nThe objective is to compute the Jacobian $\\frac{\\partial R}{\\partial W}$ of the scalar residual function $R(W)$, which is given by:\n$$\nR(W) \\equiv \\rho h W^2 - p - D - \\tau\n$$\nThe differentiation is performed with respect to the Lorentz factor $W$, treating the conserved quantities $D$, $S^2$, and $\\tau$, as well as the adiabatic index $\\Gamma$, as known constants. The variables $\\rho$, $h$, and $p$ are functions of $W$.\n\nThe partial derivative of $R(W)$ with respect to $W$ is:\n$$\n\\frac{\\partial R}{\\partial W} = \\frac{\\partial}{\\partial W} (\\rho h W^2) - \\frac{\\partial p}{\\partial W}\n$$\nsince $D$ and $\\tau$ are constants with respect to $W$.\n\nTo evaluate this expression, we must first establish the functional dependence of $\\rho$, $h$, and $p$ on $W$ and the known constants.\n\n1.  **Expressing $\\rho$ as a function of $W$:**\n    From the definition of the conserved rest-mass density, $D \\equiv \\rho W$, we can write $\\rho$ as:\n    $$\n    \\rho(W) = \\frac{D}{W}\n    $$\n\n2.  **Expressing $h$ as a function of $W$:**\n    The squared magnitude of the conserved momentum density, $S^2 \\equiv \\delta^{ij} S_i S_j$, is given by:\n    $$\n    S^2 = (\\rho h W^2)^2 \\delta^{ij} v_i v_j = (\\rho h W^2)^2 v^2\n    $$\n    The Lorentz factor definition, $W \\equiv (1-v^2)^{-1/2}$, implies $v^2 = 1 - W^{-2} = \\frac{W^2-1}{W^2}$. Substituting this into the expression for $S^2$:\n    $$\n    S^2 = (\\rho h W^2)^2 \\left(\\frac{W^2-1}{W^2}\\right) = \\rho^2 h^2 W^2 (W^2-1)\n    $$\n    Now, substituting $\\rho = D/W$:\n    $$\n    S^2 = \\left(\\frac{D}{W}\\right)^2 h^2 W^2 (W^2-1) = D^2 h^2 (W^2-1)\n    $$\n    Solving for the specific enthalpy $h$, which must be positive, yields:\n    $$\n    h(W) = \\frac{\\sqrt{S^2}}{D\\sqrt{W^2-1}}\n    $$\n    This relation is valid for $W  1$, which corresponds to non-zero velocity, the domain in which the Newton-Raphson solver is typically employed.\n\n3.  **Expressing $p$ in terms of $\\rho$ and $h$:**\n    The ideal-gas Equation of State (EOS) is given as $p = (\\Gamma - 1)\\rho\\epsilon$. Using the provided relation $\\epsilon = (h-1)/\\Gamma$, the pressure can be written as:\n    $$\n    p(\\rho, h) = \\rho \\frac{\\Gamma-1}{\\Gamma}(h-1)\n    $$\n    Thus, $p$ is a function of $W$ through its dependence on $\\rho(W)$ and $h(W)$.\n\nWe can now compute the required derivatives. A useful simplification is to first differentiate the term $\\rho h W^2$:\n$$\n\\rho h W^2 = \\left(\\frac{D}{W}\\right) h W^2 = D h W\n$$\nUsing the product rule, its derivative is:\n$$\n\\frac{\\partial}{\\partial W} (\\rho h W^2) = \\frac{\\partial}{\\partial W} (D h W) = D \\left( \\frac{\\partial h}{\\partial W} W + h \\right)\n$$\nThe derivative of $h$ with respect to $W$ is:\n$$\n\\frac{\\partial h}{\\partial W} = \\frac{\\partial}{\\partial W} \\left( \\frac{\\sqrt{S^2}}{D} (W^2-1)^{-1/2} \\right) = \\frac{\\sqrt{S^2}}{D} \\left(-\\frac{1}{2}\\right) (W^2-1)^{-3/2} (2W) = -\\frac{W\\sqrt{S^2}}{D(W^2-1)^{3/2}}\n$$\nWe can express $\\frac{\\partial h}{\\partial W}$ in terms of $h$ itself for simplification:\n$$\n\\frac{\\partial h}{\\partial W} = -\\frac{W}{W^2-1} \\left( \\frac{\\sqrt{S^2}}{D\\sqrt{W^2-1}} \\right) = -\\frac{W h}{W^2-1}\n$$\nSubstituting this back into the derivative of $\\rho h W^2$:\n$$\n\\frac{\\partial}{\\partial W} (\\rho h W^2) = D \\left( \\left(-\\frac{W h}{W^2-1}\\right) W + h \\right) = D h \\left( 1 - \\frac{W^2}{W^2-1} \\right) = D h \\left( \\frac{W^2-1-W^2}{W^2-1} \\right) = -\\frac{D h}{W^2-1}\n$$\nNext, we compute the derivative of the pressure term, $\\frac{\\partial p}{\\partial W}$:\n$$\np = \\rho \\frac{\\Gamma-1}{\\Gamma}(h-1) = \\frac{D}{W} \\frac{\\Gamma-1}{\\Gamma}(h-1)\n$$\nUsing the product rule for differentiation:\n$$\n\\frac{\\partial p}{\\partial W} = \\frac{D(\\Gamma-1)}{\\Gamma} \\frac{\\partial}{\\partial W} \\left( \\frac{h-1}{W} \\right) = \\frac{D(\\Gamma-1)}{\\Gamma} \\left( \\frac{W\\frac{\\partial h}{\\partial W} - (h-1)}{W^2} \\right)\n$$\nSubstituting $\\frac{\\partial h}{\\partial W} = -\\frac{W h}{W^2-1}$:\n$$\n\\frac{\\partial p}{\\partial W} = \\frac{D(\\Gamma-1)}{\\Gamma W^2} \\left( W \\left(-\\frac{W h}{W^2-1}\\right) - h + 1 \\right) = \\frac{D(\\Gamma-1)}{\\Gamma W^2} \\left( -\\frac{W^2 h}{W^2-1} - h + 1 \\right)\n$$\n$$\n\\frac{\\partial p}{\\partial W} = \\frac{D(\\Gamma-1)}{\\Gamma W^2} \\left( h\\left(-\\frac{W^2}{W^2-1} - 1\\right) + 1 \\right) = \\frac{D(\\Gamma-1)}{\\Gamma W^2} \\left( h\\left(\\frac{-2W^2+1}{W^2-1}\\right) + 1 \\right)\n$$\nCombining the parts to find $\\frac{\\partial R}{\\partial W}$:\n$$\n\\frac{\\partial R}{\\partial W} = -\\frac{D h}{W^2-1} - \\frac{\\partial p}{\\partial W} = -\\frac{D h}{W^2-1} - \\frac{D(\\Gamma-1)}{\\Gamma W^2} \\left( h\\left(\\frac{1-2W^2}{W^2-1}\\right) + 1 \\right)\n$$\n$$\n\\frac{\\partial R}{\\partial W} = -\\frac{D h}{W^2-1} - \\frac{D(\\Gamma-1)h(1-2W^2)}{\\Gamma W^2(W^2-1)} - \\frac{D(\\Gamma-1)}{\\Gamma W^2}\n$$\nGroup the terms containing $h$:\n$$\n\\frac{\\partial R}{\\partial W} = D h \\left( -\\frac{1}{W^2-1} - \\frac{(\\Gamma-1)(1-2W^2)}{\\Gamma W^2(W^2-1)} \\right) - \\frac{D(\\Gamma-1)}{\\Gamma W^2}\n$$\nThe term in the parenthesis simplifies to:\n$$\n\\frac{-\\Gamma W^2 - (\\Gamma - 1 - 2\\Gamma W^2 + 2W^2)}{\\Gamma W^2(W^2-1)} = \\frac{-\\Gamma W^2 - \\Gamma + 1 + 2\\Gamma W^2 - 2W^2}{\\Gamma W^2(W^2-1)} = \\frac{\\Gamma W^2 - 2W^2 - (\\Gamma-1)}{\\Gamma W^2(W^2-1)}\n$$\n$$\n= \\frac{(\\Gamma-2)W^2 - (\\Gamma-1)}{\\Gamma W^2(W^2-1)}\n$$\nSo, the expression for the Jacobian becomes:\n$$\n\\frac{\\partial R}{\\partial W} = D h \\left( \\frac{(\\Gamma-2)W^2 - (\\Gamma-1)}{\\Gamma W^2(W^2-1)} \\right) - \\frac{D(\\Gamma-1)}{\\Gamma W^2}\n$$\nFinally, we substitute $h = \\frac{\\sqrt{S^2}}{D\\sqrt{W^2-1}}$ to express the result solely in terms of $W, D, S^2, \\Gamma$:\n$$\n\\frac{\\partial R}{\\partial W} = D \\left( \\frac{\\sqrt{S^2}}{D\\sqrt{W^2-1}} \\right) \\left( \\frac{(\\Gamma-2)W^2 - (\\Gamma-1)}{\\Gamma W^2(W^2-1)} \\right) - \\frac{D(\\Gamma-1)}{\\Gamma W^2}\n$$\n$$\n\\frac{\\partial R}{\\partial W} = \\frac{\\sqrt{S^2} \\left[ (\\Gamma-2)W^2 - (\\Gamma-1) \\right]}{\\Gamma W^2 (W^2-1)^{3/2}} - \\frac{D(\\Gamma-1)}{\\Gamma W^2}\n$$\nThis is the final closed-form analytic expression for the Jacobian.", "answer": "$$\n\\boxed{\\frac{\\sqrt{S^2} \\left[ (\\Gamma-2)W^2 - (\\Gamma-1) \\right]}{\\Gamma W^2 (W^2-1)^{3/2}} - \\frac{D(\\Gamma-1)}{\\Gamma W^2}}\n$$", "id": "3468841"}, {"introduction": "For certain equations of state, the recovery problem simplifies, allowing for exceptionally robust and efficient solutions. This practice explores the case of a cold polytropic fluid, where the inversion reduces to solving a single monotonic equation for the Lorentz factor $W$. You will derive this relationship, implement a complete solver using the bisection method, and critically, add a diagnostic to check when the underlying physical assumptions are violated, such as by shock heating [@problem_id:3468855].", "problem": "Consider the special relativistic hydrodynamics Valencia formulation in flat spacetime with the speed of light set to unity. Let the conserved variables be defined by the rest mass density $D = \\rho W$, the momentum density $S_i = \\rho h W^2 v_i$, and the energy variable $\\tau = \\rho h W^2 - p - D$, where $\\rho$ is the rest-mass density, $p$ is the pressure, $v_i$ are the spatial components of the three-velocity with squared magnitude $v^2 = v_i v^i$, $W = 1/\\sqrt{1 - v^2}$ is the Lorentz factor, and $h = 1 + \\epsilon + p/\\rho$ is the specific enthalpy with the specific internal energy $\\epsilon$. Assume a cold polytropic equation of state (EOS) $p = K \\rho^\\Gamma$ together with the cold assumption $\\epsilon = p/((\\Gamma - 1)\\rho)$, with constants $K  0$ and $\\Gamma  1$. All quantities are dimensionless in geometrized units.\n\nYour tasks are as follows.\n\n1) Starting from the above definitions, express all primitive variables in terms of $W$ and $D$ only, using the cold polytropic EOS. Then, derive an explicit scalar equation for a single unknown $W$ that enforces consistency with the momentum magnitude, i.e., an equation whose root is the physical $W$ for a given $D$ and $S^2 = \\delta^{ij} S_i S_j$. Prove that, for any fixed $D  0$, $K  0$, and $\\Gamma \\in (1, 2]$, this scalar equation defines a strictly increasing function of $W \\in [1, \\infty)$, ensuring existence and uniqueness of the solution. Your derivation must rely only on the given definitions, the cold EOS specification, and the identity $v^2 = 1 - 1/W^2$. Do not assume any auxiliary formula that is not implied by these fundamentals.\n\n2) Based on your derivation, design a robust numerical algorithm that, given $(D, S^2, \\tau, K, \\Gamma)$, recovers the primitive variables by first solving a one-dimensional equation for $W$ using bracketing and bisection. Then compute $\\rho = D/W$, $p = K \\rho^\\Gamma$, and $\\tau_{\\text{pred}} = \\rho h W^2 - p - D$, all under the cold EOS assumption. Use the comparison of $\\tau_{\\text{pred}}$ to the given $\\tau$ as a diagnostic for violation of the cold EOS (e.g., shock heating). Define a boolean diagnostic `breakdown` = `True` if $|\\tau - \\tau_{\\text{pred}}|$ exceeds a small numerical tolerance, and `False` otherwise.\n\n3) Implement the algorithm as a complete, runnable program. For each test case below, compute the recovered Lorentz factor $W$ and the breakdown diagnostic. Report each $W$ rounded to eight decimal places. Use the following constants and test suite:\n- Use $\\Gamma = 2.0$ and $K = 1.0$ for all cases.\n- Test case A (happy path): choose $\\rho = 1.0 \\times 10^{-3}$ and a one-dimensional velocity with magnitude $v = 0.3$. From these primitives, compute $D$, $S^2$, and $\\tau$ using the definitions.\n- Test case B (boundary case, vanishing momentum): choose $\\rho = 1.0 \\times 10^{-2}$ and $v = 0.0$. From these primitives, compute $D$, $S^2$, and $\\tau$.\n- Test case C (ultra-relativistic): choose $\\rho = 1.0 \\times 10^{-3}$ and $v = 0.99$. From these primitives, compute $D$, $S^2$, and $\\tau$.\n- Test case D (shock heating violation): reuse the conserved variables computed in test case A, but replace $\\tau$ by $\\tau + \\Delta$ with $\\Delta = 0.05$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a two-element list `[W, breakdown]`. For example, a valid output with two hypothetical results would look like $[[1.23456789,\\text{False}],[2.34567890,\\text{True}]]$. Ensure the printed $W$ values are rounded to eight decimal places and the booleans are unquoted.", "solution": "The problem requires the derivation and implementation of a conservative-to-primitive variable recovery scheme for special relativistic hydrodynamics under the assumption of a cold polytropic equation of state. The process involves two primary tasks: first, deriving a single scalar equation for the Lorentz factor $W$ and proving the existence and uniqueness of its solution; second, designing and implementing a numerical algorithm to solve this equation and compute a diagnostic quantity.\n\nLet us begin by formalizing the relationship between the primitive variables $(\\rho, v_i, \\epsilon, p)$ and the conserved variables $(D, S_i, \\tau)$. The given definitions are:\n- Rest-mass density: $D = \\rho W$\n- Momentum density: $S_i = \\rho h W^2 v_i$\n- Energy variable: $\\tau = \\rho h W^2 - p - D$\n\nHere, $\\rho$ is the rest-mass density, $p$ is the pressure, $v_i$ is the 3-velocity, $W = (1 - v^2)^{-1/2}$ is the Lorentz factor where $v^2 = \\delta^{ij}v_i v_j$, and $h$ is the specific enthalpy.\nThe system is closed by a cold polytropic equation of state (EOS):\n- Pressure: $p = K \\rho^\\Gamma$\n- Specific internal energy: $\\epsilon = \\frac{p}{(\\Gamma - 1)\\rho}$\n\nThe specific enthalpy $h$ is defined as $h = 1 + \\epsilon + p/\\rho$. Using the cold EOS, we can express $h$ in terms of $\\rho$:\n$$h = 1 + \\frac{p}{(\\Gamma - 1)\\rho} + \\frac{p}{\\rho} = 1 + \\left(\\frac{1}{\\Gamma-1} + 1\\right)\\frac{p}{\\rho} = 1 + \\frac{\\Gamma}{\\Gamma-1}\\frac{p}{\\rho}$$\nSubstituting the expression for $p$:\n$$h = 1 + \\frac{\\Gamma K \\rho^\\Gamma}{(\\Gamma-1)\\rho} = 1 + \\frac{\\Gamma K}{\\Gamma-1} \\rho^{\\Gamma-1}$$\nThis equation connects the specific enthalpy to the rest-mass density.\n\nOur first goal is to derive a scalar equation for $W$ using the known quantities $D$ and $S^2 = \\delta^{ij}S_i S_j$. To do this, we express all primitive variables in terms of $D$ and $W$.\nFrom the definition of $D$, we immediately have:\n$$\\rho = \\frac{D}{W}$$\nSubstituting this into the expressions for $p$ and $h$:\n$$p = K \\left(\\frac{D}{W}\\right)^\\Gamma$$\n$$h = 1 + \\frac{\\Gamma K}{\\Gamma-1} \\left(\\frac{D}{W}\\right)^{\\Gamma-1}$$\nNow, we consider the magnitude squared of the momentum density, $S^2$:\n$$S^2 = \\delta^{ij}S_i S_j = (\\rho h W^2)^2 \\delta^{ij}v_i v_j = (\\rho h W^2)^2 v^2$$\nUsing the identity $v^2 = 1 - 1/W^2 = (W^2 - 1)/W^2$, we get:\n$$S^2 = (\\rho h W^2)^2 \\frac{W^2-1}{W^2} = (\\rho h)^2 W^2 (W^2-1)$$\nNow, we substitute the expressions for $\\rho$ and $h$ in terms of $D$ and $W$:\n$$S^2 = \\left(\\frac{D}{W} \\left(1 + \\frac{\\Gamma K}{\\Gamma-1} \\left(\\frac{D}{W}\\right)^{\\Gamma-1}\\right)\\right)^2 W^2 (W^2-1)$$\n$$S^2 = \\frac{D^2}{W^2} \\left(1 + \\frac{\\Gamma K D^{\\Gamma-1}}{(\\Gamma-1)W^{\\Gamma-1}}\\right)^2 W^2 (W^2-1)$$\nThis simplifies to the desired scalar equation for $W$:\n$$S^2 = D^2 (W^2 - 1) \\left(1 + \\frac{\\Gamma K D^{\\Gamma-1}}{(\\Gamma-1)W^{\\Gamma-1}}\\right)^2$$\nLet us define the function $F(W)$ as the right-hand side of this equation:\n$$F(W) = D^2 (W^2 - 1) \\left(1 + C W^{1-\\Gamma}\\right)^2$$\nwhere $C = \\frac{\\Gamma K D^{\\Gamma-1}}{\\Gamma-1}$ is a positive constant for $D0$, $K0$, and $\\Gamma1$. The problem is now reduced to finding the root of $F(W)-S^2=0$ for $W \\in [1, \\infty)$.\n\nNext, we must prove that for any fixed $D  0$, $K  0$, and $\\Gamma \\in (1, 2]$, $F(W)$ is a strictly increasing function of $W$ for $W \\in [1, \\infty)$. This will guarantee that for any given $S^2 \\ge 0$, a unique solution for $W$ exists.\nWe compute the derivative of $F(W)$ with respect to $W$ for $W1$:\n$$F'(W) = \\frac{d}{dW} \\left[ D^2 (W^2 - 1) \\left(1 + C W^{1-\\Gamma}\\right)^2 \\right]$$\nUsing the product rule, with $u(W) = W^2 - 1$ and $v(W) = (1 + C W^{1-\\Gamma})^2$:\n$$u'(W) = 2W$$\n$$v'(W) = 2(1 + C W^{1-\\Gamma}) \\cdot C(1-\\Gamma)W^{-\\Gamma} = -2C(\\Gamma-1)W^{-\\Gamma}(1 + C W^{1-\\Gamma})$$\n$$F'(W) = D^2 [u'v + uv'] = D^2 \\left[ 2W(1 + C W^{1-\\Gamma})^2 - (W^2 - 1) \\cdot 2C(\\Gamma-1)W^{-\\Gamma}(1 + C W^{1-\\Gamma}) \\right]$$\nFactoring out the common term $2D^2(1 + C W^{1-\\Gamma})$:\n$$F'(W) = 2D^2(1 + C W^{1-\\Gamma}) \\left[ W(1 + C W^{1-\\Gamma}) - (W^2 - 1)C(\\Gamma-1)W^{-\\Gamma} \\right]$$\nLet's analyze the sign of each term for $W1$, $D0$, $K0$, and $\\Gamma \\in (1,2]$.\nThe pre-factor $2D^2(1 + C W^{1-\\Gamma})$ is strictly positive, as $C0$ and $W^{1-\\Gamma}0$.\nWe examine the term in the square brackets:\n$$ \\text{Bracket term} = W + C W^{2-\\Gamma} - C(\\Gamma-1)W^{2-\\Gamma} + C(\\Gamma-1)W^{-\\Gamma} $$\n$$ = W + C(1 - (\\Gamma-1))W^{2-\\Gamma} + C(\\Gamma-1)W^{-\\Gamma} $$\n$$ = W + C(2-\\Gamma)W^{2-\\Gamma} + C(\\Gamma-1)W^{-\\Gamma} $$\nWe analyze each term in this sum:\n1.  $W$: strictly positive since $W1$.\n2.  $C(2-\\Gamma)W^{2-\\Gamma}$: Since $\\Gamma \\le 2$, we have $2-\\Gamma \\ge 0$. As $C0$ and $W0$, this term is non-negative.\n3.  $C(\\Gamma-1)W^{-\\Gamma}$: Since $\\Gamma  1$, we have $\\Gamma-1  0$. As $C0$ and $W0$, this term is strictly positive.\n\nThe sum of a strictly positive term ($W$), a non-negative term, and a strictly positive term is strictly positive. Therefore, the term in the brackets is positive.\nSince $F'(W)$ is the product of two strictly positive terms, $F'(W)  0$ for all $W  1$. This proves that $F(W)$ is a strictly increasing function on the interval $(1, \\infty)$.\nAt the boundary, $W=1$, we have $F(1) = 0$. Since $S^2 \\ge 0$, and as $W \\to \\infty$, $W^{1-\\Gamma} \\to 0$ and $F(W) \\approx D^2 W^2 \\to \\infty$, the Intermediate Value Theorem guarantees that for any given value of $S^2 \\ge 0$, there exists a unique solution $W \\in [1, \\infty)$. The case $S^2=0$ uniquely corresponds to $W=1$.\n\nBased on this proof, we can design a robust numerical algorithm. The strict monotonicity of $F(W)$ makes the bisection method an ideal choice for finding the root of $f(W) = F(W) - S^2 = 0$.\n\nThe algorithm is as follows:\n1.  **Input:** Conserved variables $(D, S^2, \\tau)$, EOS parameters $(K, \\Gamma)$.\n2.  **Solve for W:**\n    a. Handle the trivial case: if $S^2$ is below a machine precision tolerance, the velocity is zero, so $W=1$.\n    b. For $S^2  0$, find a bracketing interval $[W_L, W_R]$ for the bisection method, such that $f(W_L) \\le 0$ and $f(W_R)  0$.\n       i. Set the lower bound $W_L = 1$. This gives $f(1) = 0 - S^2 \\le 0$.\n       ii. Find an upper bound $W_R$ by starting with a guess (e.g., $W_R=2$) and doubling it until $f(W_R)  0$. This is guaranteed to terminate as $F(W) \\to \\infty$.\n    c. Apply the bisection method to the interval $[W_L, W_R]$ to find the root $W$ of $f(W)=0$ to a desired numerical tolerance.\n3.  **Compute Primitives and Predicted Energy:** Once the unique $W$ is found, compute the primitive variables:\n    a. Rest-mass density: $\\rho = D/W$\n    b. Pressure: $p = K \\rho^\\Gamma$\n4.  **Compute Diagnostic:** The cold EOS assumption implies a specific relationship between the conserved variables. We can verify this by computing a predicted energy variable, $\\tau_{\\text{pred}}$, using the recovered primitives and comparing it to the input $\\tau$.\n    a. Calculate the specific enthalpy: $h = 1 + \\frac{\\Gamma K}{\\Gamma-1} \\rho^{\\Gamma-1}$.\n    b. Calculate the predicted energy: $\\tau_{\\text{pred}} = \\rho h W^2 - p - D$.\n    c. Define the breakdown diagnostic: `breakdown` = `True` if $|\\tau - \\tau_{\\text{pred}}|$ exceeds a predefined numerical tolerance (e.g., $10^{-9}$), and `False` otherwise. A `True` value indicates that the state is not consistent with the cold EOS, which may be caused by physical processes like shock heating not captured by the simple model.\n5.  **Output:** Return the recovered Lorentz factor $W$ and the breakdown diagnostic.\n\nThis completes the principled design of the algorithm. The implementation will follow these steps to solve for the specific test cases provided.", "answer": "```python\nimport numpy as np\n\ndef recover_primitives(D, S2, tau_in, K, Gamma, tol_bisection=1e-12, tol_breakdown=1e-9):\n    \"\"\"\n    Recovers primitive variables from conserved variables for a cold polytropic EOS.\n\n    Args:\n        D (float): Conserved rest-mass density.\n        S2 (float): Magnitude squared of conserved momentum.\n        tau_in (float): Conserved energy variable.\n        K (float): Polytropic constant.\n        Gamma (float): Polytropic index.\n        tol_bisection (float): Numerical tolerance for the bisection solver.\n        tol_breakdown (float): Numerical tolerance for the breakdown diagnostic.\n\n    Returns:\n        tuple[float, bool]: The recovered Lorentz factor W and the breakdown diagnostic.\n    \"\"\"\n    # If momentum vanishes, velocity is zero and W=1.\n    if S2  tol_bisection**2:\n        W = 1.0\n    else:\n        # Define the function g(W) = F(W) - S^2 whose root we need to find.\n        # F(W) = D^2 * (W^2 - 1) * (1 + (Gamma*K)/(Gamma-1) * (D/W)**(Gamma-1))**2\n        def g(W_val):\n            # This is to prevent division by zero or log(0) issues at W=1, although handled by bracketing.\n            if W_val = 1.0:\n                return -S2\n            \n            # For numerical stability with large Gamma, calculate log of base first, but for Gamma=2 it's simple.\n            h_term_base = D / W_val\n            h = 1.0 + (Gamma * K) / (Gamma - 1.0) * h_term_base**(Gamma - 1.0)\n            \n            # The function F(W) from the derivation\n            f_W = D**2 * (W_val**2 - 1.0) * h**2\n            return f_W - S2\n\n        # Bisection Method\n        # 1. Find a valid bracket [W_low, W_high]\n        W_low = 1.0\n        W_high = 2.0\n        \n        # g(W_low) is guaranteed to be = 0. We need to find W_high such that g(W_high) > 0.\n        # The bracket is expanded exponentially until the function sign changes.\n        # This is robust because we proved the function is monotonic and unbounded.\n        max_expansion_iter = 60 # 2^60 is astronomical, a safe upper limit\n        for _ in range(max_expansion_iter):\n            if g(W_high) > 0:\n                break\n            W_high *= 2.0\n        else:\n            # This would indicate a failure to find a bracket, which shouldn't happen for valid physics.\n            return np.nan, True\n\n        # 2. Bisection iterations\n        max_bisection_iter = 100 # Provides precision far beyond what's needed for double.\n        for _ in range(max_bisection_iter):\n            if W_high - W_low  tol_bisection:\n                break\n            W_mid = (W_low + W_high) / 2.0\n            if g(W_mid)  0:\n                W_low = W_mid\n            else:\n                W_high = W_mid\n        W = (W_low + W_high) / 2.0\n\n    # With W recovered, calculate primitives and the predicted tau.\n    rho = D / W\n    p = K * rho**Gamma\n    \n    # Calculate specific enthalpy h using the derived formula\n    h = 1.0 + (Gamma * K) / (Gamma - 1.0) * rho**(Gamma - 1.0)\n\n    # Calculate predicted tau value assuming a cold EOS\n    tau_pred = rho * h * W**2 - p - D\n\n    # Compare predicted tau with input tau for the breakdown diagnostic\n    breakdown = abs(tau_in - tau_pred) > tol_breakdown\n    \n    return W, breakdown\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    K_val = 1.0\n    Gamma_val = 2.0\n\n    # --- Generate Test Cases ---\n    \n    # Test Case A: Happy path\n    rho_A = 1.0e-3\n    v_A = 0.3\n    W_A = 1.0 / np.sqrt(1.0 - v_A**2)\n    D_A = rho_A * W_A\n    p_A = K_val * rho_A**Gamma_val\n    h_A = 1.0 + (Gamma_val * K_val) / (Gamma_val - 1.0) * rho_A**(Gamma_val - 1.0)\n    S2_A = (rho_A * h_A)**2 * W_A**2 * (W_A**2 - 1.0)\n    tau_A = rho_A * h_A * W_A**2 - p_A - D_A\n    \n    # Test Case B: Boundary case (zero momentum)\n    rho_B = 1.0e-2\n    v_B = 0.0\n    W_B = 1.0 / np.sqrt(1.0 - v_B**2)\n    D_B = rho_B * W_B\n    p_B = K_val * rho_B**Gamma_val\n    h_B = 1.0 + (Gamma_val * K_val) / (Gamma_val - 1.0) * rho_B**(Gamma_val - 1.0)\n    S2_B = (rho_B * h_B)**2 * W_B**2 * (W_B**2 - 1.0)\n    tau_B = rho_B * h_B * W_B**2 - p_B - D_B\n    \n    # Test Case C: Ultra-relativistic\n    rho_C = 1.0e-3\n    v_C = 0.99\n    W_C = 1.0 / np.sqrt(1.0 - v_C**2)\n    D_C = rho_C * W_C\n    p_C = K_val * rho_C**Gamma_val\n    h_C = 1.0 + (Gamma_val * K_val) / (Gamma_val - 1.0) * rho_C**(Gamma_val - 1.0)\n    S2_C = (rho_C * h_C)**2 * W_C**2 * (W_C**2 - 1.0)\n    tau_C = rho_C * h_C * W_C**2 - p_C - D_C\n    \n    # Test Case D: Shock heating violation\n    D_D = D_A\n    S2_D = S2_A\n    tau_D = tau_A + 0.05\n    \n    test_cases = [\n        (D_A, S2_A, tau_A),\n        (D_B, S2_B, tau_B),\n        (D_C, S2_C, tau_C),\n        (D_D, S2_D, tau_D)\n    ]\n    \n    results = []\n    for D, S2, tau in test_cases:\n        W, breakdown = recover_primitives(D, S2, tau, K_val, Gamma_val)\n        # Format the result for the current test case as specified: [W,breakdown]\n        # round() is used for final value, but formatting to .8f ensures trailing zeros.\n        W_rounded = round(W, 8)\n        results.append(f\"[{W_rounded:.8f},{breakdown}]\")\n    \n    # Print the final list of results in the exact specified format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3468855"}]}