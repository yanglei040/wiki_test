{"hands_on_practices": [{"introduction": "In a finite-volume approach, fluid states are known at cell centers, but the fluxes that drive the evolution are needed at cell interfaces. This requires us to \"reconstruct\" the values of primitive variables at these boundaries from the discrete cell-centered data. This hands-on practice [@problem_id:3496822] delves into implementing and comparing two foundational high-resolution schemes—the Total Variation Diminishing (TVD) MUSCL scheme and the high-order Weighted Essentially Non-Oscillatory (WENO) scheme. Mastering these techniques is critical for developing a hydrodynamics code that can accurately capture both the smooth features of a flow and the sharp discontinuities of shocks, which are ubiquitous in astrophysical phenomena like neutron star mergers.", "problem": "Consider the hyperbolic conservation law form used in the Valencia formulation of relativistic hydrodynamics for a single spatial dimension, where conserved fields require flux evaluations computed from reconstructed primitive fields at cell faces. In practice, numerical relativity and gravitational wave simulations reconstruct primitive variables, such as rest-mass density, from cell-centered estimates to the left and right states at interfaces. The goal of this problem is to design and implement two high-resolution nonoscillatory reconstruction schemes and to assess their nonoscillatory behavior and accuracy using well-chosen tests that reflect the needs of the Valencia formulation.\n\nStart from the following fundamental base:\n- A scalar field $q(x)$ representing a primitive variable is approximated on a uniform grid by values $q_i$ at cell centers $x_i$, where $x_i = i \\Delta x$ and $\\Delta x = L/N$ for domain length $L$ and number of cells $N$. The periodic boundary condition is imposed so that $q_{i+N} = q_i$ for all integer $i$.\n- In a finite volume method, left and right reconstructed states $(q_{i+1/2}^{L}, q_{i+1/2}^{R})$ at interface $x_{i+1/2} = x_i + \\Delta x/2$ are supplied to a Riemann solver to obtain the numerical flux. Well-posed numerical hydrodynamics in the Valencia formulation requires reconstructions that are high-order accurate in smooth regions and nonoscillatory near discontinuities.\n- Nonoscillatory behavior is assessed through control of total variation, defined for a grid function by $\\mathrm{TV}(q) = \\sum_{i} |q_{i+1} - q_i|$, and by the absence of Gibbs-like overshoots near discontinuities, measured relative to local bounds.\n\nYour task is to implement two reconstruction schemes and compute quantitative diagnostics on four test cases:\n1. A Monotonic Upstream-centered Scheme for Conservation Laws (MUSCL) with a Monotonized Central (MC) limiter. This is a Total Variation Diminishing (TVD) scheme. You must ensure the reconstructed states obey a local discrete maximum principle, projecting the reconstructed interface values to lie within the local neighbor bounds so that $q_{i+1/2}^{L} \\in [\\min(q_{i-1}, q_i, q_{i+1}), \\max(q_{i-1}, q_i, q_{i+1})]$ and $q_{i+1/2}^{R}$ obeys the analogous bound using neighbors of $q_{i+1}$.\n2. A fifth-order Weighted Essentially Non-Oscillatory scheme (WENO5) with WENO-Z weights built from smoothness indicators. This scheme should adapt weights to stencil smoothness and achieve high-order accuracy on smooth data without explicit limiting.\n\nImplementation requirements:\n- The grid is uniform on $[0,1]$ with periodic boundaries and cell centers $x_i = (i+0.5)\\Delta x$, for $i = 0, 1, \\dots, N-1$, where $\\Delta x = 1/N$.\n- Reconstruct both $q_{i+1/2}^{L}$ and $q_{i+1/2}^{R}$ for each interface $i+1/2$ from cell-centered values $q_i$.\n- For the MUSCL scheme, implement the Monotonized Central limiter using a three-argument minmod operation to obtain a slope at each cell and then project reconstructed states into local bounds as described above.\n- For the WENO5-Z scheme, implement nonlinear weights that depend on smoothness indicators and a global smoothness measure, and reconstruct left and right interface states at every face.\n\nDiagnostics to compute:\n- For a smooth function test, define $q(x) = \\sin(2\\pi x)$ on $[0,1]$. Using $N = 200$, compute the maximum-norm reconstruction error for the left states for each scheme as $E_{\\infty} = \\max_i |q_{i+1/2}^{L} - q(x_{i+1/2})|$. Report the two errors as floats.\n- For a discontinuity (shock tube-like) test, define $q(x) = 1$ for $x  0.5$ and $q(x) = 0$ otherwise, with $N = 200$. Compute the overshoot magnitude for the left reconstructed states for each scheme as $O = \\max\\left(\\max_i \\max(q_{i+1/2}^{L} - 1, 0), \\max_i \\max(-q_{i+1/2}^{L}, 0)\\right)$ and report the two overshoot magnitudes as floats.\n- For a constant state test, define $q(x) = 0.7$ with $N = 200$. Compute the sum of absolute deviations of the WENO5-Z left reconstructed states from the constant value, $R = \\sum_i |q_{i+1/2}^{L} - 0.7|$, and report $R$ as a float.\n- For a near-vacuum smooth test, define $q(x) = 10^{-12} + 10^{-13}\\sin(2\\pi x)$ with $N = 200$. Check positivity of all reconstructed left and right states for each scheme: report two booleans indicating whether all reconstructed states are nonnegative for MUSCL with local bound projection and for WENO5-Z without explicit positivity enforcement.\n\nUnits and data types:\n- All reported numerical values are unitless floats or booleans. Angles used in trigonometric functions are in radians.\n- The final output should be a single line containing a comma-separated list enclosed in square brackets of the seven results in the order: smooth-case WENO5-Z error (float), smooth-case MUSCL error (float), step-case WENO5-Z overshoot (float), step-case MUSCL overshoot (float), constant-case WENO5-Z residual (float), near-vacuum MUSCL positivity (boolean), near-vacuum WENO5-Z positivity (boolean).\n\nTest suite specification:\n- Smooth case: $N = 200$, $q(x) = \\sin(2\\pi x)$, report two floats as described.\n- Discontinuity case: $N = 200$, $q(x) = 1$ for $x  0.5$, $q(x) = 0$ otherwise, report two floats as described.\n- Constant case: $N = 200$, $q(x) = 0.7$, report one float as described.\n- Near-vacuum case: $N = 200$, $q(x) = 10^{-12} + 10^{-13}\\sin(2\\pi x)$, report two booleans as described.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, \"[result1,result2,result3,result4,result5,result6,result7]\"). No other text should be printed.", "solution": "The solution proceeds by first implementing the two required reconstruction schemes:\n1.  A Monotonic Upstream-centered Scheme for Conservation Laws (MUSCL) is implemented. This scheme achieves second-order accuracy in smooth regions. To control oscillations near discontinuities, a slope limiter is necessary. As specified, the Monotonized Central (MC) limiter is used. The slope $\\delta q_i$ for each cell $i$ is calculated by applying a `minmod` function to the central-difference slope and twice the one-sided difference slopes:\n    $$\n    \\delta q_i = \\mathrm{minmod}\\left(\\frac{q_{i+1} - q_{i-1}}{2}, 2(q_{i+1} - q_i), 2(q_i - q_{i-1})\\right)\n    $$\n    The `minmod` function returns its argument with the smallest absolute value if all arguments have the same sign, and $0$ otherwise. The left and right reconstructed states at the interface $x_{i+1/2}$ are then computed as:\n    $$\n    q_{i+1/2}^{L, \\text{raw}} = q_i + \\frac{1}{2}\\delta q_i \\\\\n    q_{i+1/2}^{R, \\text{raw}} = q_{i+1} - \\frac{1}{2}\\delta q_{i+1}\n    $$\n    A crucial step, mandated by the problem, is the enforcement of a local discrete maximum principle. The computed raw states are projected into the interval defined by the local neighboring cell values. For $q_{i+1/2}^{L}$, this is:\n    $$\n    q_{i+1/2}^{L} = \\max\\left( \\min(q_{i-1}, q_i, q_{i+1}), \\min(\\max(q_{i-1}, q_i, q_{i+1}), q_{i+1/2}^{L, \\text{raw}}) \\right)\n    $$\n    An analogous projection is applied to $q_{i+1/2}^{R}$ using the neighbors of cell $i+1$, namely $q_i, q_{i+1}, q_{i+2}$. This procedure ensures the scheme is non-oscillatory.\n\n2.  A fifth-order Weighted Essentially Non-Oscillatory (WENO5) scheme is implemented, specifically with WENO-Z weights. This scheme achieves high-order accuracy by combining three third-order reconstructions, $\\hat{q}^{(k)}$, which are based on three different 3-cell stencils. The combination is a weighted average, $q_{i+1/2} = \\sum_{k=0}^2 \\omega_k \\hat{q}^{(k)}$. The key idea of WENO is that the weights $\\omega_k$ depend on smoothness indicators, $\\beta_k$, for each stencil. The standard WENO weights are $\\omega_k \\propto d_k/(\\beta_k + \\epsilon)^2$, where $d_k$ are optimal weights that yield fifth-order accuracy in smooth regions and $\\epsilon$ is a small number to prevent division by zero. The problem specifies WENO-Z weights, which are a modification designed to improve accuracy near critical points. The Z-weights are given by:\n    $$\n    \\alpha_k^Z = d_k \\left(1 + \\left(\\frac{\\tau_5}{\\beta_k + \\epsilon}\\right)^p\\right), \\quad \\omega_k^Z = \\frac{\\alpha_k^Z}{\\sum_j \\alpha_j^Z}\n    $$\n    where $\\tau_5 = |\\beta_0 - \\beta_2|$ is a global smoothness measure and $p=1$ is a typical choice. The left state $q_{i+1/2}^{L}$ is reconstructed using stencils centered around cell $i$, while the right state $q_{i+1/2}^{R}$ is reconstructed using stencils centered around cell $i+1$.\n\nFollowing the implementation of these two schemes, the four specified diagnostic tests are performed on a grid of $N=200$ cells on the domain $[0,1]$ with periodic boundaries.\n-   **Smooth Test**: $q(x) = \\sin(2\\pi x)$. The maximum-norm error, $E_{\\infty} = \\max_i |q_{i+1/2}^{L} - q(x_{i+1/2})|$, is computed for both schemes.\n-   **Discontinuity Test**: $q(x) = 1$ for $x  0.5$ and $q(x) = 0$ otherwise. The overshoot magnitude, $O$, is computed for both schemes to quantify non-oscillatory performance.\n-   **Constant State Test**: $q(x) = 0.7$. The sum of absolute deviations from the constant, $R = \\sum_i |q_{i+1/2}^{L} - 0.7|$, is computed for the WENO5-Z scheme to verify its ability to preserve a constant state.\n-   **Near-Vacuum Test**: $q(x) = 10^{-12} + 10^{-13}\\sin(2\\pi x)$. The positivity of all reconstructed states ($q^L$ and $q^R$) is checked for both schemes. The MUSCL scheme with local bound projection is expected to preserve positivity, while the standard WENO5-Z scheme is not guaranteed to do so.\n\nAll computations are performed using vectorized `numpy` operations for efficiency. The results are collected and formatted into the required output string.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements MUSCL and WENO5-Z reconstruction schemes, runs four test cases,\n    and computes the specified diagnostics.\n    \"\"\"\n    # Grid and problem parameters\n    N = 200\n    DX = 1.0 / N\n    X_CELLS = (np.arange(N) + 0.5) * DX\n    X_FACES = (np.arange(N) + 1.0) * DX\n\n    def vectorized_minmod(data_list):\n        \"\"\"\n        Vectorized minmod function for multiple arguments.\n        \"\"\"\n        matrix = np.array(data_list)\n        s = np.sign(matrix)\n        # Check if all elements in a column have the same sign.\n        # This is true if the absolute value of the sum of signs equals the number of arguments.\n        all_same_sign = np.abs(np.sum(s, axis=0)) == len(data_list)\n        # The sign of the result is the sign of the arguments, or 0 if they differ.\n        signs = np.sign(np.sum(s, axis=0)) * all_same_sign\n        mags = np.min(np.abs(matrix), axis=0)\n        return signs * mags\n    \n    def muscl_reconstruction(q):\n        \"\"\"\n        MUSCL reconstruction with MC limiter and local bound projection.\n        \"\"\"\n        q_pad = np.pad(q, (2, 2), 'wrap')\n\n        # Slices for vectorized computation\n        q_im2 = q_pad[0:-4]\n        q_im1 = q_pad[1:-3]\n        q_i   = q_pad[2:-2]\n        q_ip1 = q_pad[3:-1]\n        q_ip2 = q_pad[4:]\n\n        # Compute slopes with Monotonized Central (MC) limiter\n        delta_plus = q_ip1 - q_i\n        delta_minus = q_i - q_im1\n        delta_central = (q_ip1 - q_im1) / 2.0\n        \n        limited_slopes = vectorized_minmod([delta_central, 2.0 * delta_plus, 2.0 * delta_minus])\n        \n        # Raw reconstruction\n        qL_raw = q_i + 0.5 * limited_slopes\n        slopes_ip1 = np.roll(limited_slopes, -1)\n        qR_raw = q_ip1 - 0.5 * slopes_ip1\n        \n        # Projection to local bounds\n        min_bound_L = np.minimum(q_im1, np.minimum(q_i, q_ip1))\n        max_bound_L = np.maximum(q_im1, np.maximum(q_i, q_ip1))\n        qL = np.maximum(min_bound_L, np.minimum(max_bound_L, qL_raw))\n\n        min_bound_R = np.minimum(q_i, np.minimum(q_ip1, q_ip2))\n        max_bound_R = np.maximum(q_i, np.maximum(q_ip1, q_ip2))\n        qR = np.maximum(min_bound_R, np.minimum(max_bound_R, qR_raw))\n        \n        return qL, qR\n\n    def weno5z_reconstruction(q):\n        \"\"\"\n        Fifth-order WENO reconstruction with WENO-Z weights.\n        \"\"\"\n        epsilon = 1e-40\n        p = 1.0\n        \n        q_pad = np.pad(q, (3, 3), 'wrap')\n        \n        d_L = np.array([0.1, 0.6, 0.3])\n        d_R = np.array([0.3, 0.6, 0.1])\n        \n        # --- Left states qL_{i+1/2} ---\n        v1, v2, v3, v4, v5 = (q_pad[shift:shift+N] for shift in range(1, 6))\n\n        beta0_L = (13./12.)*(v1 - 2*v2 + v3)**2 + (1./4.)*(v1 - 4*v2 + 3*v3)**2\n        beta1_L = (13./12.)*(v2 - 2*v3 + v4)**2 + (1./4.)*(v2 - v4)**2\n        beta2_L = (13./12.)*(v3 - 2*v4 + v5)**2 + (1./4.)*(3*v3 - 4*v4 + v5)**2\n\n        tau5_L = np.abs(beta0_L - beta2_L)\n        alpha0_L = d_L[0] * (1. + (tau5_L / (beta0_L + epsilon))**p)\n        alpha1_L = d_L[1] * (1. + (tau5_L / (beta1_L + epsilon))**p)\n        alpha2_L = d_L[2] * (1. + (tau5_L / (beta2_L + epsilon))**p)\n        alpha_sum_L = alpha0_L + alpha1_L + alpha2_L\n        w0_L, w1_L, w2_L = alpha0_L/alpha_sum_L, alpha1_L/alpha_sum_L, alpha2_L/alpha_sum_L\n        \n        q_hat0_L = (2.*v1 - 7.*v2 + 11.*v3) / 6.\n        q_hat1_L = (-v2 + 5.*v3 + 2.*v4) / 6.\n        q_hat2_L = (2.*v3 + 5.*v4 - v5) / 6.\n        \n        qL = w0_L * q_hat0_L + w1_L * q_hat1_L + w2_L * q_hat2_L\n\n        # --- Right states qR_{i+1/2} ---\n        v0, v1, v2, v3, v4 = (q_pad[shift:shift+N] for shift in range(2, 7))\n\n        beta0_R = (13./12.)*(v0-2*v1+v2)**2 + (1./4.)*(v0-4*v1+3*v2)**2\n        beta1_R = (13./12.)*(v1-2*v2+v3)**2 + (1./4.)*(v1-v3)**2\n        beta2_R = (13./12.)*(v2-2*v3+v4)**2 + (1./4.)*(3*v2-4*v3+v4)**2\n        \n        tau5_R = np.abs(beta0_R - beta2_R)\n        alpha0_R = d_R[0] * (1. + (tau5_R / (beta0_R + epsilon))**p)\n        alpha1_R = d_R[1] * (1. + (tau5_R / (beta1_R + epsilon))**p)\n        alpha2_R = d_R[2] * (1. + (tau5_R / (beta2_R + epsilon))**p)\n        alpha_sum_R = alpha0_R + alpha1_R + alpha2_R\n        w0_R, w1_R, w2_R = alpha0_R/alpha_sum_R, alpha1_R/alpha_sum_R, alpha2_R/alpha_sum_R\n\n        q_hat0_R = (-v0 + 5.*v1 + 2.*v2) / 6.\n        q_hat1_R = (2.*v1 + 5.*v2 - v3) / 6.\n        q_hat2_R = (11.*v2 - 7.*v3 + 2.*v4) / 6.\n        \n        qR = w0_R * q_hat0_R + w1_R * q_hat1_R + w2_R * q_hat2_R\n\n        return qL, qR\n\n    # --- Run Test Cases and Collect Results ---\n    results = []\n\n    # 1. Smooth case: q(x) = sin(2*pi*x)\n    q_smooth = np.sin(2 * np.pi * X_CELLS)\n    q_exact_faces = np.sin(2 * np.pi * X_FACES)\n    \n    qL_weno_smooth, _ = weno5z_reconstruction(q_smooth)\n    err_weno_smooth = np.max(np.abs(qL_weno_smooth - q_exact_faces))\n    \n    qL_muscl_smooth, _ = muscl_reconstruction(q_smooth)\n    err_muscl_smooth = np.max(np.abs(qL_muscl_smooth - q_exact_faces))\n    results.extend([err_weno_smooth, err_muscl_smooth])\n\n    # 2. Discontinuity case\n    q_step = np.where(X_CELLS  0.5, 1.0, 0.0)\n    \n    qL_weno_step, _ = weno5z_reconstruction(q_step)\n    overshoot_pos_weno = np.max(np.maximum(qL_weno_step - 1.0, 0.0))\n    overshoot_neg_weno = np.max(np.maximum(-qL_weno_step, 0.0))\n    overshoot_weno = np.max([overshoot_pos_weno, overshoot_neg_weno])\n\n    qL_muscl_step, _ = muscl_reconstruction(q_step)\n    overshoot_pos_muscl = np.max(np.maximum(qL_muscl_step - 1.0, 0.0))\n    overshoot_neg_muscl = np.max(np.maximum(-qL_muscl_step, 0.0))\n    overshoot_muscl = np.max([overshoot_pos_muscl, overshoot_neg_muscl])\n    results.extend([overshoot_weno, overshoot_muscl])\n    \n    # 3. Constant case\n    q_const = np.full(N, 0.7)\n    qL_weno_const, _ = weno5z_reconstruction(q_const)\n    residual_weno = np.sum(np.abs(qL_weno_const - 0.7))\n    results.append(residual_weno)\n    \n    # 4. Near-vacuum case\n    q_vac = 1e-12 + 1e-13 * np.sin(2 * np.pi * X_CELLS)\n    \n    qL_muscl_vac, qR_muscl_vac = muscl_reconstruction(q_vac)\n    positivity_muscl = np.all(qL_muscl_vac = 0) and np.all(qR_muscl_vac = 0)\n    \n    qL_weno_vac, qR_weno_vac = weno5z_reconstruction(q_vac)\n    positivity_weno = np.all(qL_weno_vac = 0) and np.all(qR_weno_vac = 0)\n    results.extend([positivity_muscl, positivity_weno])\n\n    # Final output formatting\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3496822"}, {"introduction": "After reconstructing the primitive variables to obtain left and right states at a cell interface, the next crucial step in a finite-volume method is to calculate the numerical flux across that boundary. This flux is determined by solving a local Riemann problem. This exercise [@problem_id:3496789] guides you through the derivation and implementation of the Harten–Lax–van Leer–Einfeldt (HLLE) scheme, a robust and popular approximate Riemann solver. By calculating the physical fluxes and using characteristic speeds to build the HLLE formula, you will gain practical experience with the engine that drives the evolution in a conservative Godunov-type scheme.", "problem": "Consider one-dimensional special-relativistic hydrodynamics in flat spacetime within the Valencia formulation used in numerical relativity. In geometrized units where the speed of light is $c=1$, model a perfect fluid with a gamma-law equation of state. Let the fluid primitive variables be the rest-mass density $\\,\\rho\\,$, the pressure $\\,p\\,$, and the Eulerian three-velocity $\\,v\\,$ along the $x$ direction. Assume a gamma-law equation of state with constant adiabatic index $\\,\\gamma\\,$, and define the specific internal energy $\\,\\epsilon\\,$ and specific enthalpy $\\,h\\,$ by $\\,\\epsilon = \\dfrac{p}{(\\gamma - 1)\\rho}\\,$ and $\\,h = 1 + \\epsilon + \\dfrac{p}{\\rho}\\,$. Let the Lorentz factor be $\\,W = \\dfrac{1}{\\sqrt{1 - v^2}}\\,.$\n\nThe Valencia formulation introduces conservative variables $\\,D\\,$, $\\,S_x\\,$, and $\\,\\tau\\,$, defined from the primitive variables, and the corresponding physical fluxes $\\,F^x(D)\\,$, $\\,F^x(S_x)\\,$, and $\\,F^x(\\tau)\\,$ along the $x$-direction. Starting from mass conservation $\\,\\nabla_\\mu(\\rho u^\\mu)=0\\,$ and energy-momentum conservation $\\,\\nabla_\\mu T^{\\mu\\nu}=0\\,$ with the perfect-fluid stress-energy tensor $\\,T^{\\mu\\nu} = \\rho h u^\\mu u^\\nu + p g^{\\mu\\nu}\\,$ in Minkowski spacetime, derive an algorithm that computes the Harten–Lax–van Leer–Einfeldt (HLLE) numerical flux at an interface between two states. Your derivation must identify the physical flux vector components in terms of the conservative variables and estimate the left and right limiting characteristic speeds in special relativity using the local sound speed.\n\nImplement the derived algorithm as a complete, runnable program that, for each test case, takes a left state $(\\rho_L, p_L, v_L)$ and a right state $(\\rho_R, p_R, v_R)$ together with $\\,\\gamma\\,$, and outputs the HLLE numerical flux vector $[F_D, F_{S_x}, F_{\\tau}]$ at the interface. Use the special-relativistic sound speed $\\,c_s\\,$ of a gamma-law ideal fluid and the appropriate relativistic formula for signal speeds along $x$ based on $\\,v\\,$ and $\\,c_s\\,$. Ensure all states are physically admissible: $\\,\\rho  0\\,$, $\\,p  0\\,$, and $\\,|v|  1\\,$.\n\nUnits: use geometrized units with $\\,c=1\\,$. Angles are not used. Express each flux component as a float rounded to eight decimal places.\n\nTest suite:\n- Case A (moderate subsonic states):\n  - Left: $\\,\\rho_L = 1.0\\,$, $\\,p_L = 1.0\\,$, $\\,v_L = 0.0\\,$.\n  - Right: $\\,\\rho_R = 0.125\\,$, $\\,p_R = 0.1\\,$, $\\,v_R = 0.0\\,$.\n  - Adiabatic index: $\\,\\gamma = 1.4\\,$.\n- Case B (supersonic left state toward higher pressure):\n  - Left: $\\,\\rho_L = 1.0\\,$, $\\,p_L = 0.1\\,$, $\\,v_L = 0.8\\,$.\n  - Right: $\\,\\rho_R = 1.0\\,$, $\\,p_R = 1.0\\,$, $\\,v_R = 0.0\\,$.\n  - Adiabatic index: $\\,\\gamma = 1.4\\,$.\n- Case C (near-vacuum right state):\n  - Left: $\\,\\rho_L = 0.5\\,$, $\\,p_L = 0.5\\,$, $\\,v_L = 0.3\\,$.\n  - Right: $\\,\\rho_R = 10^{-6}\\,$, $\\,p_R = 10^{-8}\\,$, $\\,v_R = 0.0\\,$.\n  - Adiabatic index: $\\,\\gamma = 1.4\\,$.\n- Case D (strongly relativistic opposing flows):\n  - Left: $\\,\\rho_L = 1.0\\,$, $\\,p_L = 10.0\\,$, $\\,v_L = 0.9\\,$.\n  - Right: $\\,\\rho_R = 1.0\\,$, $\\,p_R = 1.0\\,$, $\\,v_R = -0.5\\,$.\n  - Adiabatic index: $\\,\\gamma = 1.4\\,$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a list of three floats $[F_D, F_{S_x}, F_{\\tau}]$ rounded to eight decimal places. For example, the output should look like $[[f_{D,A}, f_{S,A}, f_{\\tau,A}], [f_{D,B}, f_{S,B}, f_{\\tau,B}], [f_{D,C}, f_{S,C}, f_{\\tau,C}], [f_{D,D}, f_{S,D}, f_{\\tau,D}]]$, where $\\,f_{D,A}\\,$ is the $\\,F_D\\,$ value for Case A, etc.", "solution": "The system of one-dimensional special-relativistic hydrodynamic equations can be written in conservation-law form:\n$$\n\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}}{\\partial x} = 0\n$$\nwhere $\\mathbf{U}$ is the vector of conserved variables and $\\mathbf{F}$ is the vector of their corresponding fluxes.\n\n**1. Conserved Variables and Fluxes**\n\nIn the Valencia formulation for flat spacetime, the conserved variables $\\mathbf{U} = [D, S_x, \\tau]^T$ are defined in terms of the primitive variables $(\\rho, p, v)$.\n\n-   **Conserved Rest-Mass Density ($D$)**: $D = \\rho W$\n-   **Conserved Momentum Density ($S_x$)**: $S_x = \\rho h W^2 v$\n-   **Conserved Energy Density ($\\tau$)**: $\\tau = \\rho h W^2 - p - \\rho W$\n\nwhere the specific enthalpy $h$ for a gamma-law gas is $h = 1 + \\frac{\\gamma p}{(\\gamma-1)\\rho}$.\n\nThe flux vector $\\mathbf{F}(\\mathbf{U}) = [F_D, F_{S_x}, F_\\tau]^T$ is derived from the spatial components of the corresponding tensors.\n-   **Mass Flux ($F_D$)**: $F_D = D v$\n-   **Momentum Flux ($F_{S_x}$)**: $F_{S_x} = S_x v + p$\n-   **Energy Flux ($F_\\tau$)**: $F_\\tau = S_x - D v$, or equivalently, $F_\\tau = (\\tau+p)v$.\n\n**2. HLLE Numerical Flux**\n\nThe Harten–Lax–van Leer–Einfeldt (HLLE) numerical flux $\\mathbf{F}^{\\text{HLLE}}$ at an interface between a left state $(\\mathbf{U}_L, \\mathbf{F}_L)$ and a right state $(\\mathbf{U}_R, \\mathbf{F}_R)$ is given by:\n$$\n\\mathbf{F}^{\\text{HLLE}} = \\frac{S_R \\mathbf{F}_L - S_L \\mathbf{F}_R + S_L S_R (\\mathbf{U}_R - \\mathbf{U}_L)}{S_R - S_L}\n$$\nHere, $S_L$ and $S_R$ are estimates for the fastest left-going and right-going signal speeds in the Riemann fan emerging from the interface.\n\n**3. Signal Speed Estimation**\n\nThe characteristic speeds of the system are the eigenvalues of the Jacobian matrix $\\partial \\mathbf{F} / \\partial \\mathbf{U}$. For 1D special-relativistic hydrodynamics, the sound wave speeds as measured in the lab frame are given by the relativistic velocity addition formula:\n$$\n\\lambda_\\pm = \\frac{v \\pm c_s}{1 \\pm v c_s}\n$$\nwhere $c_s$ is the sound speed in the fluid's rest frame. For a gamma-law gas, the sound speed squared is:\n$$\nc_s^2 = \\frac{\\gamma p}{\\rho h}\n$$\nThe signal speeds $S_L$ and $S_R$ are estimated by taking the minimum and maximum characteristic speeds over the left and right states:\n$$\nS_L = \\min(0, \\lambda_{-,L}, \\lambda_{-,R})\n$$\n$$\nS_R = \\max(0, \\lambda_{+,L}, \\lambda_{+,R})\n$$\nwhere $\\lambda_{\\pm,L}$ and $\\lambda_{\\pm,R}$ are the sound wave speeds calculated for the left and right states, respectively.\n\n**4. Algorithm**\n\nThe algorithm to compute the HLLE flux vector for a given left state $(\\rho_L, p_L, v_L)$ and right state $(\\rho_R, p_R, v_R)$ is as follows:\n\n1.  **For both Left and Right States**:\n    a.  Calculate the Lorentz factor $W$, specific enthalpy $h$, and sound speed $c_{s}$.\n    b.  Calculate the characteristic speeds $\\lambda_{\\pm}$.\n    c.  Calculate the conserved state vector $\\mathbf{U}$ and the flux vector $\\mathbf{F}$.\n\n2.  **Estimate Signal Speeds**: Compute $S_L$ and $S_R$ from the characteristic speeds of the left and right states.\n\n3.  **Calculate HLLE Flux**: If $S_R - S_L$ is non-zero, apply the HLLE formula. If $S_R - S_L$ is close to zero, the flux is taken as the simple average of the left and right fluxes.\n\n4.  **Output**: Return the resulting flux vector $\\mathbf{F}^{\\text{HLLE}} = [F_D, F_{S_x}, F_\\tau]$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_hlle_flux(rho_L, p_L, v_L, rho_R, p_R, v_R, gamma):\n    \"\"\"\n    Calculates the HLLE numerical flux for 1D special relativistic hydrodynamics.\n\n    Args:\n        rho_L (float): Rest-mass density of the left state.\n        p_L (float): Pressure of the left state.\n        v_L (float): Velocity of the left state.\n        rho_R (float): Rest-mass density of the right state.\n        p_R (float): Pressure of the right state.\n        v_R (float): Velocity of the right state.\n        gamma (float): Adiabatic index.\n\n    Returns:\n        list[float]: The HLLE flux vector [F_D, F_Sx, F_tau].\n    \"\"\"\n\n    def get_state_properties(rho, p, v, gamma):\n        \"\"\"\n        Computes derived physical quantities from primitive variables.\n        \"\"\"\n        # Ensure physical admissibility of the state\n        if rho = 0 or p = 0 or abs(v) = 1:\n            raise ValueError(f\"Physically inadmissible state: rho={rho}, p={p}, v={v}\")\n\n        # Lorentz factor\n        W = 1.0 / np.sqrt(1.0 - v**2)\n        \n        # Specific enthalpy\n        h = 1.0 + gamma * p / ((gamma - 1.0) * rho)\n        \n        # Sound speed squared and sound speed\n        # This must be  1 for a causal EOS\n        cs2 = (gamma * p) / (rho * h)\n        if cs2 = 1.0:\n            raise ValueError(f\"Acausal sound speed detected: cs^2 = {cs2} = 1\")\n        cs = np.sqrt(cs2)\n        \n        # Characteristic speeds (eigenvalues)\n        lambda_p = (v + cs) / (1.0 + v * cs)\n        lambda_m = (v - cs) / (1.0 - v * cs)\n        \n        # Conservative variables\n        D = rho * W\n        Sx = rho * h * W**2 * v\n        tau = rho * h * W**2 - p - D\n        \n        U = np.array([D, Sx, tau])\n        \n        # Flux vector\n        F_D = D * v\n        F_Sx = Sx * v + p\n        F_tau = (tau + p) * v # Equivalent to Sx - D*v\n        \n        F = np.array([F_D, F_Sx, F_tau])\n        \n        return lambda_p, lambda_m, U, F\n\n    # Calculate properties for Left and Right states\n    lambda_p_L, lambda_m_L, U_L, F_L = get_state_properties(rho_L, p_L, v_L, gamma)\n    lambda_p_R, lambda_m_R, U_R, F_R = get_state_properties(rho_R, p_R, v_R, gamma)\n    \n    # Estimate signal speeds\n    S_L = min(0.0, lambda_m_L, lambda_m_R)\n    S_R = max(0.0, lambda_p_L, lambda_p_R)\n    \n    # Denominator of the HLLE flux formula\n    S_R_minus_S_L = S_R - S_L\n    \n    # Handle the case where S_R == S_L to avoid division by zero\n    if np.isclose(S_R_minus_S_L, 0.0):\n        # This occurs if all waves are stationary or all move in one direction.\n        # If S_L=S_R=0, implies subsonic flow split. A simple average can be taken.\n        # If S_L, S_R are not zero, the upwinding part of HLLE handles this.\n        # S_L = 0, S_R = 0 by definition, so S_R-S_L=0 only if S_L=S_R=0\n        # Given this suggests all eigenvalues are zero, F should be zero if v=0.\n        # A more general choice is to average the fluxes.\n        return (0.5 * (F_L + F_R)).tolist()\n\n    # Calculate the HLLE flux\n    F_HLLE = (S_R * F_L - S_L * F_R + S_L * S_R * (U_R - U_L)) / S_R_minus_S_L\n    \n    return F_HLLE.tolist()\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (moderate subsonic states)\n        {'L': (1.0, 1.0, 0.0), 'R': (0.125, 0.1, 0.0), 'gamma': 1.4},\n        # Case B (supersonic left state toward higher pressure)\n        {'L': (1.0, 0.1, 0.8), 'R': (1.0, 1.0, 0.0), 'gamma': 1.4},\n        # Case C (near-vacuum right state)\n        {'L': (0.5, 0.5, 0.3), 'R': (1e-6, 1e-8, 0.0), 'gamma': 1.4},\n        # Case D (strongly relativistic opposing flows)\n        {'L': (1.0, 10.0, 0.9), 'R': (1.0, 1.0, -0.5), 'gamma': 1.4},\n    ]\n\n    results = []\n    for case in test_cases:\n        rho_L, p_L, v_L = case['L']\n        rho_R, p_R, v_R = case['R']\n        gamma = case['gamma']\n        \n        flux_vector = calculate_hlle_flux(rho_L, p_L, v_L, rho_R, p_R, v_R, gamma)\n        \n        # Format each component to 8 decimal places\n        formatted_flux = [f\"{x:.8f}\" for x in flux_vector]\n        results.append(f\"[{','.join(formatted_flux)}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3496789"}, {"introduction": "The Valencia formulation evolves a set of conserved variables ($D, S_i, \\tau$), but the equation of state and physical intuition are rooted in the primitive variables ($\\rho, v^i, p$). A critical step in the numerical loop is therefore converting the evolved conserved quantities back to their primitive counterparts at the end of each timestep. This practice [@problem_id:3496801] challenges you to tackle this \"conserved-to-primitive\" recovery problem from first principles by deriving the underlying nonlinear algebraic equation that connects the pressure to the known conserved quantities. Successfully completing this derivation provides a deep understanding of the algebraic backbone of general relativistic hydrodynamics and the transformations essential to any numerical implementation.", "problem": "Consider General Relativistic Hydrodynamics (GRHD) in a $3+1$ split on Minkowski spacetime with lapse $\\alpha=1$, shift $\\beta^{i}=0$, and spatial metric $\\gamma_{ij}=\\delta_{ij}$, in geometrized code units where the speed of light $c$ and the gravitational constant $G$ are unity. In the Valencia formulation, the conserved variables are defined by the rest-mass density $D$, momentum density $S_{i}$, and energy variable $\\tau$, built from the primitive variables rest-mass density $\\rho$, Eulerian three-velocity $v^{i}$, pressure $p$, and specific internal energy $\\epsilon$, together with the Lorentz factor $W$. The core definitions are:\n$$\nD = \\rho W,\\quad S_{i} = \\rho h W^{2} v_{i},\\quad \\tau = \\rho h W^{2} - p - D,\n$$\nwhere the specific enthalpy $h$ is given by an Equation of State (EOS). Adopt a gamma-law EOS,\n$$\np = (\\Gamma - 1)\\,\\rho\\,\\epsilon,\\quad h = 1 + \\epsilon + \\frac{p}{\\rho}.\n$$\nStarting from these definitions alone, and without introducing any additional specialized formulas, carry out the following:\n\n1. Eliminate the primitive variables $\\rho$ and $v^{i}$ to derive a single scalar algebraic relation that connects the unknown pressure $p$ to the conserved variables through the scalars $D$, $\\tau$, and $S^{2} \\equiv \\gamma^{ij} S_{i} S_{j}$, together with the Lorentz factor $W$. Then further eliminate $W$ to produce an equation involving only $p$ and the known conserved quantities $D$, $\\tau$, $S^{2}$, and the adiabatic index $\\Gamma$.\n\n2. For a particular conserved state specified by\n$$\nD = 2,\\quad S_{x} = 6\\sqrt{3},\\quad S_{y} = 0,\\quad S_{z} = 0,\\quad \\tau = 9,\\quad \\Gamma = 2,\n$$\nsolve your derived equation to recover the pressure $p$ in this state. Express the final pressure in dimensionless code units. If an approximation is required at any step, justify it; otherwise, give the exact value. No rounding instruction is necessary unless an approximation is made.", "solution": "The solution proceeds in two parts as requested.\n\nPart 1: Derivation of the algebraic equation for pressure $p$.\n\nWe are given the definitions for the conserved variables in the Valencia formulation on a flat background ($\\gamma_{ij} = \\delta_{ij}$, $\\alpha=1$, $\\beta^i=0$):\n$$\nD = \\rho W\n$$\n$$\nS_{i} = \\rho h W^{2} v_{i}\n$$\n$$\n\\tau = \\rho h W^{2} - p - D\n$$\nand a gamma-law equation of state:\n$$\np = (\\Gamma - 1)\\,\\rho\\,\\epsilon\n$$\n$$\nh = 1 + \\epsilon + \\frac{p}{\\rho}\n$$\nHere, $\\rho$ is the rest-mass density, $W$ is the Lorentz factor, $h$ is the specific enthalpy, $v_i$ is the three-velocity, $p$ is the pressure, $\\epsilon$ is the specific internal energy, and $\\Gamma$ is the adiabatic index.\n\nFirst, we express the specific enthalpy $h$ in terms of $p$, $\\rho$, and $\\Gamma$. From the EOS, we have $\\epsilon = \\frac{p}{(\\Gamma-1)\\rho}$. Substituting this into the definition of $h$:\n$$\nh = 1 + \\frac{p}{(\\Gamma - 1)\\rho} + \\frac{p}{\\rho} = 1 + \\frac{p}{\\rho} \\left( \\frac{1}{\\Gamma-1} + 1 \\right) = 1 + \\frac{p}{\\rho} \\left( \\frac{\\Gamma}{\\Gamma-1} \\right)\n$$\nThis gives us a direct relation between $h$, $p$, and $\\rho$:\n$$\n\\rho h = \\rho + \\frac{\\Gamma p}{\\Gamma-1}\n$$\n\nNext, we manipulate the conserved variable definitions. Let's define an auxiliary variable $A$ for convenience:\n$$\nA \\equiv \\tau + D + p\n$$\nFrom the definition of $\\tau$, we can see that:\n$$\nA = (\\rho h W^2 - p - D) + D + p = \\rho h W^2\n$$\nNow consider the momentum density $S_i$. Its magnitude squared is $S^2 \\equiv S_i S^i = \\delta^{ij} S_i S_j = S_i S_i$.\n$$\nS^2 = (\\rho h W^2 v_i) (\\rho h W^2 v_i) = (\\rho h W^2)^2 (v_i v_i) = A^2 v^2\n$$\nwhere $v^2 = v_i v_i$. The Lorentz factor is defined as $W = (1-v^2)^{-1/2}$, which implies $v^2 = 1 - W^{-2}$. Substituting this into the expression for $S^2$:\n$$\nS^2 = A^2 (1 - W^{-2})\n$$\nRearranging this equation gives the requested relation between $p$, the conserved scalars $D, \\tau, S^2$ (which are part of $A$), and the Lorentz factor $W$:\n$$\nS^2 = (\\tau + D + p)^2 \\left(1 - \\frac{1}{W^2}\\right)\n$$\nThis equation fulfills the first requirement of Part $1$.\n\nTo eliminate $W$, we need another relation. We can derive an expression for $W$ from the definitions. From $S^2 = A^2(1 - W^{-2})$, we can solve for $W$:\n$$\n\\frac{S^2}{A^2} = 1 - \\frac{1}{W^2} \\implies \\frac{1}{W^2} = 1 - \\frac{S^2}{A^2} = \\frac{A^2 - S^2}{A^2}\n$$\nSince $W \\ge 1$, we must have $A^2 - S^2 \\ge 0$. Also, since relativistic velocities require $A > |S|$, both $A$ and $\\sqrt{A^2-S^2}$ are real and non-negative. Taking the positive square root:\n$$\nW = \\frac{A}{\\sqrt{A^2 - S^2}}\n$$\nNow, we find an alternative expression for $W$ involving the EOS. Let's combine $A = \\rho h W^2$ and $D=\\rho W$:\n$$\nh = \\frac{A}{\\rho W^2} = \\frac{A}{(D/W) W^2} = \\frac{A}{DW}\n$$\nNow we equate the two expressions we have for $h$:\n$$\n1 + \\frac{\\Gamma}{\\Gamma-1} \\frac{p}{\\rho} = \\frac{A}{DW}\n$$\nSubstitute $\\rho = D/W$:\n$$\n1 + \\frac{\\Gamma}{\\Gamma-1} \\frac{p}{D/W} = \\frac{A}{DW} \\implies 1 + \\frac{\\Gamma p W}{(\\Gamma-1)D} = \\frac{A}{DW}\n$$\nMultiply by $DW$:\n$$\nDW + \\frac{\\Gamma p}{\\Gamma-1} W^2 = A\n$$\nNow we substitute our expression $W = A/\\sqrt{A^2 - S^2}$ into this equation to eliminate $W$:\n$$\nD \\left(\\frac{A}{\\sqrt{A^2 - S^2}}\\right) + \\frac{\\Gamma p}{\\Gamma-1} \\left(\\frac{A^2}{A^2 - S^2}\\right) = A\n$$\nAssuming $A \\neq 0$ (which is physically required), we divide by $A$:\n$$\n\\frac{D}{\\sqrt{A^2-S^2}} + \\frac{\\Gamma p A}{(\\Gamma-1)(A^2 - S^2)} = 1\n$$\nTo eliminate the square root from the denominator, multiply the entire equation by $A^2 - S^2$:\n$$\nD \\sqrt{A^2 - S^2} + \\frac{\\Gamma p A}{\\Gamma-1} = A^2 - S^2\n$$\nRearranging gives the final equation involving only $p$, the knowns $D, \\tau, S^2$, and $\\Gamma$ (with $A = \\tau+D+p$):\n$$\n(\\tau+D+p)^2 - S^2 - D\\sqrt{(\\tau+D+p)^2 - S^2} - \\frac{\\Gamma p (\\tau+D+p)}{\\Gamma-1} = 0\n$$\nThis is the desired algebraic equation for $p$.\n\nPart 2: Solving for pressure $p$.\n\nWe are given the specific conserved state:\n$D = 2$\n$S_x = 6\\sqrt{3}$, $S_y = 0$, $S_z = 0$. So, $S^2 = S_x^2 + S_y^2 + S_z^2 = (6\\sqrt{3})^2 = 36 \\times 3 = 108$.\n$\\tau = 9$\n$\\Gamma = 2$\n\nFor $\\Gamma=2$, the term $\\frac{\\Gamma}{\\Gamma-1} = \\frac{2}{2-1} = 2$.\nThe auxiliary quantity $A$ is $A = \\tau+D+p = 9+2+p = 11+p$.\nSubstituting these values into the derived equation:\n$$\n((11+p)^2 - 108) - 2\\sqrt{(11+p)^2 - 108} - 2p(11+p) = 0\n$$\nLet's simplify the terms inside the parentheses and the square root:\n$$\n(11+p)^2 - 108 = (121 + 22p + p^2) - 108 = p^2 + 22p + 13\n$$\nThe term $2p(11+p) = 22p + 2p^2$.\nThe equation becomes:\n$$\n(p^2 + 22p + 13) - 2\\sqrt{p^2 + 22p + 13} - (22p + 2p^2) = 0\n$$\nSimplifying by collecting terms:\n$$\n-p^2 + 13 - 2\\sqrt{p^2 + 22p + 13} = 0\n$$\n$$\n13 - p^2 = 2\\sqrt{p^2 + 22p + 13}\n$$\nTo solve for $p$, we square both sides. This may introduce extraneous solutions. A necessary condition for a valid solution is that the right-hand side is non-negative, which implies $13-p^2 \\ge 0$. As pressure must be non-negative ($p \\ge 0$), this restricts potential solutions to the range $0 \\le p \\le \\sqrt{13}$.\nSquaring both sides yields:\n$$\n(13-p^2)^2 = 4(p^2 + 22p + 13)\n$$\n$$\n169 - 26p^2 + p^4 = 4p^2 + 88p + 52\n$$\nRearranging into a standard polynomial form:\n$$\np^4 - 30p^2 - 88p + 117 = 0\n$$\nWe seek roots of this quartic polynomial. Let's test for simple integer roots. For $p=1$:\n$$\n(1)^4 - 30(1)^2 - 88(1) + 117 = 1 - 30 - 88 + 117 = 118 - 118 = 0\n$$\nSo, $p=1$ is a root. Let's check if it is valid. It is in the required range $0 \\le 1 \\le \\sqrt{13}$. We must verify it in the equation before squaring:\nLeft side: $13-p^2 = 13 - 1^2 = 12$.\nRight side: $2\\sqrt{p^2+22p+13} = 2\\sqrt{1^2+22(1)+13} = 2\\sqrt{1+22+13} = 2\\sqrt{36} = 2(6) = 12$.\nSince $12=12$, $p=1$ is a valid solution.\n\nTo check for other solutions, we perform polynomial division of $p^4 - 30p^2 - 88p + 117$ by $(p-1)$ to get the cubic factor:\n$$\n(p-1)(p^3 + p^2 - 29p - 117) = 0\n$$\nLet $g(p) = p^3 + p^2 - 29p - 117$. We search for other real roots. Analysis of $g(p)$ shows it has only one real root, which lies between $p=6$ and $p=7$. Any root $p  \\sqrt{13} \\approx 3.606$ would violate the condition $13-p^2 \\ge 0$ and is therefore an extraneous solution introduced by squaring. Thus, no other valid physical solutions exist.\n\nThe unique physically acceptable pressure is $p=1$.", "answer": "$$\n\\boxed{1}\n$$", "id": "3496801"}]}