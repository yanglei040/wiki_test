{"hands_on_practices": [{"introduction": "This first exercise serves as a fundamental check of the Arnowitt-Deser-Misner (ADM) constraint equations, which are at the heart of the XCTS formalism. By considering the simplest possible case—a flat spatial slice with no time evolution—we can directly verify that it represents a valid vacuum solution. This practice [@problem_id:3490428] solidifies the meaning of the spatial metric $ \\gamma_{ij} $ and extrinsic curvature $ K_{ij} $ and confirms that our framework correctly identifies Minkowski spacetime as the trivial, non-dynamic ground state.", "problem": "Consider the Extended Conformal Thin-Sandwich (XCTS) formalism for constructing initial data in the Arnowitt-Deser-Misner (ADM) $3+1$ decomposition of general relativity. Let the spatial metric be $ \\gamma_{ij} = \\delta_{ij} $ in Cartesian coordinates, the extrinsic curvature be $ K_{ij} = 0 $, and the matter fields be vacuum such that the energy density and momentum density vanish, $ \\rho = 0 $ and $ S^{i} = 0 $. Using the definitions of the Levi-Civita connection associated with $ \\gamma_{ij} $, the Ricci tensor $ R_{ij} $ and scalar curvature $ R $ of the spatial slice, and the covariant derivative $ D_{i} $ compatible with $ \\gamma_{ij} $, compute the scalar curvature $ R $ and the momentum constraint source term $ D_{j}\\!\\left(K^{ij} - \\gamma^{ij} K\\right) $, where $ K = \\gamma^{ij} K_{ij} $ is the trace of the extrinsic curvature. Then, verify that the Hamiltonian and momentum constraints are satisfied for this data and provide a brief physical interpretation of the resulting initial data in the context of numerical relativity and gravitational waves.\n\nExpress your final answer as a row matrix $ \\left(R,\\, D_{j}\\!\\left(K^{ij} - \\gamma^{ij} K\\right)\\right) $. No rounding is required, and no physical units are necessary in your final answer.", "solution": "The problem asks for the computation of the scalar curvature $R$ and the momentum constraint source term $D_{j}\\!\\left(K^{ij} - \\gamma^{ij} K\\right)$, a verification that the ADM Hamiltonian and momentum constraints are satisfied, and a physical interpretation of the given initial data. The initial data are specified for a vacuum spacetime ($ \\rho = 0 $, $ S^{i} = 0 $) as a spatial metric $ \\gamma_{ij} = \\delta_{ij} $ and an extrinsic curvature $ K_{ij} = 0 $.\n\nFirst, we address the calculation of the scalar curvature $R$ of the spatial slice. The scalar curvature is derived from the Ricci tensor $R_{ij}$, which in turn is derived from the Christoffel symbols (components of the Levi-Civita connection $D_i$). The Christoffel symbols of the second kind, $\\Gamma^k_{ij}$, are defined as:\n$$ \\Gamma^k_{ij} = \\frac{1}{2} \\gamma^{kl} (\\partial_i \\gamma_{jl} + \\partial_j \\gamma_{il} - \\partial_l \\gamma_{ij}) $$\nThe given spatial metric is $ \\gamma_{ij} = \\delta_{ij} $, the Kronecker delta, which represents a flat Euclidean metric in Cartesian coordinates. The components of this metric are constant values ($1$ if $i=j$, $0$ if $i \\neq j$). Therefore, all partial derivatives of the metric components are zero:\n$$ \\partial_k \\gamma_{ij} = 0 $$\nfor all $i, j, k$. Substituting this into the definition of the Christoffel symbols, we find that all Christoffel symbols vanish:\n$$ \\Gamma^k_{ij} = \\frac{1}{2} \\gamma^{kl} (0 + 0 - 0) = 0 $$\nThe Ricci tensor $R_{ij}$ is defined in terms of the Christoffel symbols as:\n$$ R_{ij} = \\partial_k \\Gamma^k_{ij} - \\partial_j \\Gamma^k_{ik} + \\Gamma^k_{kl} \\Gamma^l_{ij} - \\Gamma^l_{ik} \\Gamma^k_{jl} $$\nSince all components $ \\Gamma^k_{ij} $ are zero, every term in the expression for $R_{ij}$ is zero. This implies that the Ricci tensor is identically zero:\n$$ R_{ij} = 0 $$\nThe scalar curvature $R$ is the trace of the Ricci tensor, computed as $R = \\gamma^{ij} R_{ij}$. Since $R_{ij} = 0$, the scalar curvature must also be zero:\n$$ R = \\gamma^{ij} (0) = 0 $$\n\nNext, we compute the momentum constraint source term, which is the divergence of a tensor related to the extrinsic curvature, $D_{j}\\!\\left(K^{ij} - \\gamma^{ij} K\\right)$.\nWe are given that the extrinsic curvature is zero, $K_{ij} = 0$.\nThe trace of the extrinsic curvature is $K = \\gamma^{ij} K_{ij}$. With the flat metric $\\gamma^{ij} = \\delta^{ij}$ and $K_{ij}=0$, the trace is:\n$$ K = \\delta^{ij} (0) = 0 $$\nThe contravariant form of the extrinsic curvature tensor is $K^{ij} = \\gamma^{ik} \\gamma^{jl} K_{kl}$. With $K_{kl}=0$, this gives:\n$$ K^{ij} = \\gamma^{ik} \\gamma^{jl} (0) = 0 $$\nNow we can evaluate the term inside the covariant derivative:\n$$ K^{ij} - \\gamma^{ij} K = 0 - \\gamma^{ij} (0) = 0 $$\nThe expression to be computed is therefore the covariant derivative of the zero tensor, which is the zero vector:\n$$ D_{j}\\!\\left(K^{ij} - \\gamma^{ij} K\\right) = D_j (0) = 0^i $$\nThus, this vector term is zero for all components $i$.\n\nNow, we verify that the ADM constraint equations are satisfied for this data set in vacuum.\nThe Hamiltonian constraint in vacuum ($ \\rho = 0 $) is:\n$$ R + K^2 - K_{ij} K^{ij} = 0 $$\nSubstituting the values we have found ($ R=0 $, $ K=0 $) and given ($ K_{ij}=0 $, which implies $K^{ij}=0$ and thus $K_{ij}K^{ij}=0$):\n$$ 0 + (0)^2 - 0 = 0 $$\nThe equation $0=0$ is satisfied. The Hamiltonian constraint is met.\n\nThe momentum constraint in vacuum ($ S^i = 0 $) is:\n$$ D_j (K^{ij} - \\gamma^{ij} K) = 0 $$\nWe explicitly calculated the left-hand side and found it to be the zero vector, $0^i$. Thus, the equation becomes:\n$$ 0^i = 0 $$\nThis is satisfied for all components $i$. The momentum constraint is met.\n\nFinally, we provide a physical interpretation. The initial data consists of a spatial metric $ \\gamma_{ij} = \\delta_{ij} $ and an extrinsic curvature $ K_{ij} = 0 $.\n$ \\gamma_{ij} = \\delta_{ij} $ means that the spatial hypersurface is perfectly flat; it is a three-dimensional Euclidean space.\n$ K_{ij} = 0 $ measures the embedding of this slice in the $4$-dimensional spacetime. It is proportional to the time rate of change of the spatial metric. A zero value implies that the geometry of the spatial slice is instantaneously unchanging.\nThe combination of a flat spatial slice that is not changing in time, in a vacuum, corresponds to the initial conditions for Minkowski spacetime—the flat spacetime of special relativity. Since the ADM constraints are satisfied, this is a valid initial data set for the Einstein field equations. The evolution of this data will simply be Minkowski spacetime itself. In the context of numerical relativity and gravitational waves, this initial data represents the trivial case of an empty, non-dynamic universe. It is the ground state, devoid of matter, black holes, gravitational waves, or any other gravitational features. It serves as a fundamental and crucial test case for numerical relativity codes, as any stable code must be able to evolve this trivial solution without generating numerical errors or spurious dynamics.\n\nThe quantities requested for the final answer are $R$ and $ D_{j}\\!\\left(K^{ij} - \\gamma^{ij} K\\right) $. We found $R=0$ and the vector $D_{j}\\!\\left(K^{ij} - \\gamma^{ij} K\\right)$ to be the zero vector, represented by $0$.", "answer": "$$ \\boxed{ \\begin{pmatrix} 0 & 0 \\end{pmatrix} } $$", "id": "3490428"}, {"introduction": "Moving from flat space to curved spacetime, this practice demonstrates the power of the XCTS formalism to construct initial data for a black hole. By imposing physically motivated symmetries such as spherical symmetry and time symmetry, the complex system of partial differential equations reduces to a solvable set of ordinary differential equations. This exercise [@problem_id:3490493] guides you through deriving the famous Schwarzschild solution in isotropic coordinates, connecting the abstract equations to a tangible physical object and introducing crucial concepts like excision boundaries and Arnowitt-Deser-Misner (ADM) mass.", "problem": "Consider vacuum, time-symmetric, spherically symmetric initial data for general relativity formulated within the extended conformal thin-sandwich (XCTS) formalism. Work in geometric units with $G=c=1$. Adopt a $3+1$ decomposition and a conformal decomposition with physical spatial metric $g_{ij} = \\psi^{4} \\tilde{\\gamma}_{ij}$, where the conformal metric is chosen to be flat, $\\tilde{\\gamma}_{ij} = \\delta_{ij}$. Assume maximal slicing with $K=0$, vanishing shift $\\beta^{i}=0$, and time symmetry so that the trace-free part of the extrinsic curvature vanishes. Let the conformal factor $\\psi$ and the lapse $\\alpha$ depend only on the isotropic radius $r$. Define the conformal lapse combination $U(r) \\equiv \\alpha(r)\\,\\psi(r)$.\n\nStarting from the vacuum Hamiltonian and momentum constraints and the XCTS lapse equation, proceed as follows:\n\n- Use time symmetry, maximal slicing, conformal flatness, and spherical symmetry to reduce the Hamiltonian constraint and the XCTS lapse equation to ordinary differential equations in the single radial coordinate $r$ for $\\psi(r)$ and $U(r)$.\n\n- Impose asymptotic flatness at spatial infinity: $\\psi(r) \\to 1$ and $\\alpha(r) \\to 1$ as $r \\to \\infty$.\n\n- Excise a spherical inner boundary at isotropic radius $r=a > 0$ representing a black hole in quasi-equilibrium. Impose the following inner-boundary conditions:\n  1. For time-symmetric data, the excision surface is a marginally outer trapped surface whose mean curvature vanishes. This yields the Robin-type condition on the conformal factor at $r=a$: $\\partial_{r}\\psi|_{r=a} = -\\psi(a)/(2a)$.\n  2. The quasi-equilibrium (Killing horizon) condition at the excision surface requires $\\alpha = \\beta^{i}s_{i}$ on the surface, where $s^{i}$ is the outward unit normal to the excision sphere. With $\\beta^{i}=0$, this reduces to the Dirichlet condition $\\alpha(a)=0$.\n\n- Solve the reduced equations with the stated boundary conditions to obtain explicit expressions for $\\psi(r)$ and $\\alpha(r)$.\n\nFinally, compute the Arnowitt-Deser-Misner (ADM) mass $M_{\\mathrm{ADM}}$ of the slice from the standard surface integral definition\n$$\nM_{\\mathrm{ADM}}=\\frac{1}{16\\pi}\\lim_{R\\to\\infty}\\oint_{S_{R}}\\left(\\partial_{j}h_{ij}-\\partial_{i}h_{jj}\\right)n^{i}\\,\\mathrm{d}S,\n$$\nwhere $h_{ij}\\equiv g_{ij}-\\delta_{ij}$, $n^{i}$ is the outward unit normal on the coordinate sphere $S_{R}$ of radius $R$, and $\\mathrm{d}S$ is the surface element induced by the Euclidean background. Express your final answer as a single closed-form analytic expression for $M_{\\mathrm{ADM}}$ in terms of $a$, in geometric units.", "solution": "The problem requires us to find the Arnowitt-Deser-Misner (ADM) mass of a spherically symmetric, time-symmetric, vacuum spacetime slice described within the extended conformal thin-sandwich (XCTS) formalism. We begin by simplifying the relevant gravitational constraint equations.\n\nThe general vacuum Hamiltonian constraint in the $3+1$ formalism is given by:\n$$\nR + K^2 - K_{ij}K^{ij} = 0\n$$\nwhere $R$ is the Ricci scalar of the $3$-dimensional spatial slice, $K$ is the trace of the extrinsic curvature $K_{ij}$, and all indices are raised and lowered with the physical spatial metric $g_{ij}$. Using the conformal decomposition $g_{ij} = \\psi^4 \\tilde{\\gamma}_{ij}$ and the decomposition of the extrinsic curvature into its trace $K$ and trace-free part $\\tilde{A}^{ij}$ ($K_{ij} = A_{ij} + \\frac{1}{3}K g_{ij}$), the Hamiltonian constraint becomes:\n$$\n\\tilde{R} - 8\\tilde{\\Delta}\\psi\\psi^{-1} - (\\tilde{A}_{ij}\\tilde{A}^{ij})\\psi^{-12} + \\frac{2}{3}K^2 = 0\n$$\nHere, tilded quantities refer to the conformal metric $\\tilde{\\gamma}_{ij}$. The problem specifies several simplifying conditions:\n1.  **Conformal flatness**: $\\tilde{\\gamma}_{ij} = \\delta_{ij}$. This implies the Ricci scalar of the conformal metric, $\\tilde{R}$, is zero.\n2.  **Maximal slicing**: $K=0$.\n3.  **Time symmetry**: This implies the trace-free part of the extrinsic curvature vanishes, $A_{ij}=0$ and thus $\\tilde{A}_{ij}=0$.\n\nApplying these conditions to the Hamiltonian constraint reduces it to:\n$$\n0 - 8 \\tilde{\\Delta}\\psi \\psi^{-1} - 0 + 0 = 0 \\implies \\tilde{\\Delta}\\psi = 0\n$$\nwhere $\\tilde{\\Delta} \\equiv \\delta^{ij}\\partial_i\\partial_j$ is the flat-space Laplacian.\n\nNext, we consider the XCTS lapse equation. In its general form for a conformally flat background, it is:\n$$\n\\tilde{\\Delta}(\\alpha\\psi) - (\\alpha\\psi) \\left( \\frac{1}{8}\\tilde{R} + \\frac{5}{12}K^2\\psi^{4} - \\frac{7}{8}\\tilde{A}_{ij}\\tilde{A}^{ij}\\psi^{-12} \\right) = 0\n$$\nApplying the same conditions ($\\tilde{R}=0$, $K=0$, $\\tilde{A}_{ij}=0$) simplifies this equation drastically. The term in the parentheses vanishes entirely. Defining the conformal lapse combination $U(r) \\equiv \\alpha(r)\\psi(r)$, the lapse equation becomes:\n$$\n\\tilde{\\Delta}U = 0\n$$\nBoth the conformal factor $\\psi$ and the conformal lapse $U$ obey the flat-space Laplace equation. Since the problem assumes spherical symmetry, we can write the Laplacian in spherical coordinates. For a function $f(r)$ that depends only on the isotropic radius $r$, the equation $\\tilde{\\Delta}f=0$ becomes:\n$$\n\\frac{1}{r^2}\\frac{d}{dr}\\left(r^2 \\frac{df}{dr}\\right) = 0\n$$\nThe general solution to this ordinary differential equation is:\n$$\nf(r) = C_2 - \\frac{C_1}{r}\n$$\nwhere $C_1$ and $C_2$ are integration constants.\n\nFirst, we solve for the conformal factor $\\psi(r)$. The boundary conditions for $\\psi$ are:\n1.  Asymptotic flatness: $\\psi(r) \\to 1$ as $r \\to \\infty$.\n2.  Marginally outer trapped surface (MOTS) at the inner boundary $r=a$: $\\partial_r\\psi|_{r=a} = -\\frac{\\psi(a)}{2a}$.\n\nFrom the general solution $\\psi(r) = C_2 - C_1/r$, the condition $\\psi(\\infty)=1$ immediately gives $C_2=1$. So, $\\psi(r) = 1 - C_1/r$. The derivative is $\\partial_r\\psi = C_1/r^2$.\nApplying the inner boundary condition:\n$$\n\\frac{C_1}{a^2} = -\\frac{1}{2a}\\left(1 - \\frac{C_1}{a}\\right)\n$$\nMultiplying by $2a^2$ gives $2C_1 = -a(1-C_1/a) = -a + C_1$. This simplifies to $C_1 = -a$.\nSubstituting the constant back into the solution for $\\psi(r)$, we get:\n$$\n\\psi(r) = 1 - \\frac{(-a)}{r} = 1 + \\frac{a}{r}\n$$\n\nNext, we solve for the conformal lapse $U(r)$. The boundary conditions for $U$ are derived from those on $\\alpha$ and $\\psi$:\n1.  At $r\\to\\infty$: $\\alpha(r)\\to 1$ and $\\psi(r)\\to 1$, so $U(r) = \\alpha(r)\\psi(r) \\to 1$.\n2.  At the inner boundary $r=a$: $\\alpha(a)=0$, which implies $U(a) = \\alpha(a)\\psi(a) = 0$.\n\nUsing the general solution $U(r) = D_2 - D_1/r$, the condition $U(\\infty)=1$ gives $D_2=1$. Thus, $U(r) = 1 - D_1/r$.\nApplying the inner boundary condition:\n$$\nU(a) = 1 - \\frac{D_1}{a} = 0 \\implies D_1 = a\n$$\nThe solution for the conformal lapse is:\n$$\nU(r) = 1 - \\frac{a}{r}\n$$\nFrom these, we can find the lapse function itself: $\\alpha(r) = U(r)/\\psi(r) = (1-a/r)/(1+a/r) = (r-a)/(r+a)$.\n\nFinally, we compute the ADM mass, $M_{\\mathrm{ADM}}$, using the provided formula:\n$$\nM_{\\mathrm{ADM}}=\\frac{1}{16\\pi}\\lim_{R\\to\\infty}\\oint_{S_{R}}\\left(\\partial_{j}h_{ij}-\\partial_{i}h_{jj}\\right)n^{i}\\,\\mathrm{d}S\n$$\nThe physical metric is $g_{ij} = \\psi^4 \\delta_{ij}$. The perturbation from the flat metric is $h_{ij} = g_{ij} - \\delta_{ij} = (\\psi^4 - 1)\\delta_{ij}$.\nLet's compute the terms in the integrand.\nThe trace of $h_{ij}$ is $h_{jj} = \\sum_j h_{jj} = 3(\\psi^4-1)$.\nThe divergence term is $\\partial_j h_{ij} = \\partial_j ((\\psi^4-1)\\delta_{ij}) = \\partial_i(\\psi^4-1)$.\nThe gradient term is $\\partial_i h_{jj} = \\partial_i(3(\\psi^4-1)) = 3\\partial_i(\\psi^4-1)$.\nThe expression in the parenthesis becomes:\n$$\n\\partial_j h_{ij} - \\partial_i h_{jj} = \\partial_i(\\psi^4-1) - 3\\partial_i(\\psi^4-1) = -2\\partial_i(\\psi^4-1)\n$$\nThe integrand is $(-2\\partial_i(\\psi^4-1))n^i$. On a large coordinate sphere $S_R$, the outward unit normal is $n^i = x^i/R$, and for a spherically symmetric function $f(r)$, the contraction $\\partial_i f(r) n^i$ is simply the radial derivative $\\partial_r f(r)$.\nThe integral becomes:\n$$\nM_{\\mathrm{ADM}} = \\frac{1}{16\\pi}\\lim_{R\\to\\infty}\\oint_{S_{R}} \\left(-2\\frac{\\partial(\\psi^4-1)}{\\partial r}\\right)_{r=R} \\mathrm{d}S\n$$\nSince the integrand is constant over the sphere $S_R$, the integral evaluates to the integrand multiplied by the area of the sphere, which is $4\\pi R^2$ (as $\\mathrm{d}S$ is the Euclidean surface element).\n$$\nM_{\\mathrm{ADM}} = \\frac{-2(4\\pi)}{16\\pi} \\lim_{R\\to\\infty} \\left(R^2 \\left.\\frac{\\partial(\\psi^4-1)}{\\partial r}\\right|_{r=R}\\right) = -\\frac{1}{2} \\lim_{R\\to\\infty} \\left(R^2 \\left.\\frac{\\partial(\\psi^4)}{\\partial r}\\right|_{r=R}\\right)\n$$\nWe have $\\psi(r) = 1+a/r$. Let's compute $\\psi^4$ and its derivative.\n$$\n\\psi^4 = \\left(1+\\frac{a}{r}\\right)^4 = 1 + \\frac{4a}{r} + \\frac{6a^2}{r^2} + O\\left(\\frac{1}{r^3}\\right)\n$$\n$$\n\\frac{\\partial(\\psi^4)}{\\partial r} = -\\frac{4a}{r^2} - \\frac{12a^2}{r^3} + O\\left(\\frac{1}{r^4}\\right)\n$$\nNow we evaluate the limit:\n$$\n\\lim_{R\\to\\infty} R^2 \\frac{\\partial(\\psi^4)}{\\partial r}|_{r=R} = \\lim_{R\\to\\infty} R^2 \\left(-\\frac{4a}{R^2} - \\frac{12a^2}{R^3} + \\dots\\right) = \\lim_{R\\to\\infty} \\left(-4a - \\frac{12a^2}{R} + \\dots\\right) = -4a\n$$\nSubstituting this result into the expression for $M_{\\mathrm{ADM}}$:\n$$\nM_{\\mathrm{ADM}} = -\\frac{1}{2} (-4a) = 2a\n$$\nThe ADM mass of the spacetime slice is $2a$.", "answer": "$$\n\\boxed{2a}\n$$", "id": "3490493"}, {"introduction": "Constructing general initial data requires solving the XCTS equations numerically, which presents unique challenges. This computational practice focuses on the vector elliptic equation arising from the momentum constraint and its primary difficulty: the existence of a kernel that can make the system singular. You will implement a spectral solver to explore how to handle this singularity through constraint projection and regularization, gaining practical insight into the robust numerical methods required for generating initial data in realistic astrophysical scenarios [@problem_id:3490456].", "problem": "You will implement and test a computational model of the vector equation that arises in the Extended Conformal Thin-Sandwich (XCTS) formalism of numerical relativity. In the XCTS formalism, the momentum constraint can be written as an elliptic equation for a vector field $W^i$ on a spatial slice with conformal metric $\\tilde{\\gamma}_{ij}$. The canonical elliptic operator is the conformal vector Laplacian $\\tilde{\\Delta}_L$ defined by\n$$\n\\tilde{\\Delta}_L W^i \\equiv \\tilde{D}_j (\\tilde{L} W)^{ij},\n$$\nwith the longitudinal operator\n$$\n(\\tilde{L} W)^{ij} \\equiv \\tilde{D}^i W^j + \\tilde{D}^j W^i - \\tfrac{2}{3} \\tilde{\\gamma}^{ij} \\tilde{D}_k W^k,\n$$\nwhere $\\tilde{D}_i$ is the Levi-Civita derivative associated with $\\tilde{\\gamma}_{ij}$ and indices are raised by $\\tilde{\\gamma}^{ij}$. In the case of a flat conformal metric on a periodic domain, this operator is linear, self-adjoint, and non-negative. It fails to be invertible when the right-hand side has components in the kernel spanned by conformal Killing vectors; on a flat two-dimensional torus, the kernel consists of constant vectors, which are nontrivial solutions of the homogeneous equation.\n\nYou will study solvability and regularization for the model problem\n$$\n\\tilde{\\Delta}_L W^i = F^i,\n$$\non the two-dimensional periodic unit square domain $[0,1)\\times[0,1)$ with flat conformal metric $\\tilde{\\gamma}_{ij} = \\delta_{ij}$. The field $W^i$ and the source $F^i$ are two-component vector fields on the domain. You will implement the operator using a spectral method consistent with the above definition, and you will explore:\n- solvability when the right-hand side $F^i$ is orthogonal to the kernel (i.e., has zero spatial mean in each component),\n- constraint projection that removes the kernel component from $F^i$ by subtracting its spatial mean,\n- a small symmetry-breaking perturbation (Tikhonov-like regularization) that adds a term $-\\varepsilon W^i$ to the left-hand side, making the operator strictly invertible for $\\varepsilon>0$.\n\nYour implementation must adhere to the following fundamental base:\n- Use the momentum constraint structure in the Extended Conformal Thin-Sandwich (XCTS) formalism to motivate the vector operator $\\tilde{\\Delta}_L$ and its appearance in solving for a vector potential on a spatial slice.\n- Use properties of linear, self-adjoint elliptic operators on periodic domains to state and check a solvability condition: the right-hand side must be orthogonal to the kernel of the operator.\n- Use the periodic Fourier series on $[0,1)\\times[0,1)$ to construct a consistent spectral discretization of derivatives that respects the periodic boundary conditions, without relying on any pre-derived inversion formula for the operator.\n\nImplement the following tasks:\n1. Implement a spectral representation on a uniform $N\\times N$ grid of the periodic domain $[0,1)\\times[0,1)$ with $N=64$. Use angular wave numbers $k_x$ and $k_y$ consistent with the standard discrete Fourier transform on this interval such that differentiation is represented by multiplication by $i k_x$ and $i k_y$.\n2. Construct the action of the operator $\\tilde{\\Delta}_L$ on a vector field $W^i$ in Fourier space for the flat metric case. Then, given a source $F^i$, solve for $W^i$ when possible. When the operator is not invertible at the zero mode due to the kernel, enforce the solvability condition either by:\n   - projecting $F^i$ to have zero mean (subtract spatial averages component-wise), or\n   - adding a small symmetry-breaking perturbation $-\\varepsilon W^i$ to the left-hand side, with a specified positive parameter $\\varepsilon$.\n3. Verify solvability conditions by checking the spatial averages of $F^i$.\n4. Quantify accuracy by computing the relative discrete $L^2$ residual norm defined by\n$$\n\\frac{\\left\\|\\tilde{\\Delta}_L W^i - F^i\\right\\|_2}{\\left\\|F^i\\right\\|_2},\n$$\nwhere for a vector field $V^i$ on the grid the discrete $L^2$ norm is\n$$\n\\left\\|V^i\\right\\|_2 \\equiv \\left( \\frac{1}{N^2} \\sum_{n,m} \\sum_{i=1}^2 \\left| V^i(x_n,y_m) \\right|^2 \\right)^{1/2}.\n$$\n\nUse the following test suite. In each test, the domain is $[0,1)\\times[0,1)$ with periodic boundary conditions, $N=64$, and angles are in radians. There are no physical units in this problem.\n\n- Test 1 (happy path, zero-mean solvable): Let\n  $$\n  F_1^x(x,y) = \\sin(2\\pi x) + \\sin(2\\pi y), \\quad\n  F_1^y(x,y) = \\cos(4\\pi x) - \\sin(2\\pi x + 2\\pi y).\n  $$\n  Solve $\\tilde{\\Delta}_L W^i = F_1^i$ by inverting all nonzero Fourier modes and setting the zero mode of $W^i$ to zero. Output a single float equal to the relative discrete $L^2$ residual norm as defined above.\n\n- Test 2 (boundary case, non-solvable without projection): Let\n  $$\n  F_2^x(x,y) = 1.0 + 0.2 \\sin(2\\pi x), \\quad\n  F_2^y(x,y) = -0.5 + 0.2 \\cos(2\\pi y).\n  $$\n  Determine whether the solvability condition holds by checking whether the spatial means of $F_2^x$ and $F_2^y$ are both zero. Output a single boolean that is true if and only if the condition holds.\n\n- Test 3 (regularization with small symmetry breaking): Using the same $F_2^i$ as in Test 2, solve the regularized equation\n  $$\n  \\left(\\tilde{\\Delta}_L - \\varepsilon I\\right) W_\\varepsilon^i = F_2^i,\n  $$\n  with $\\varepsilon = 10^{-4}$, by inverting all Fourier modes including the zero mode. Let $\\langle V^i \\rangle$ denote the spatial mean of $V^i$. For the regularized problem, the zero-mode relation implies a prediction for the mean,\n  $$\n  \\langle W_\\varepsilon^i \\rangle = - \\frac{\\langle F_2^i \\rangle}{\\varepsilon}.\n  $$\n  Output a single float equal to the Euclidean norm of the difference between the computed mean vector $\\langle W_\\varepsilon^i \\rangle$ and the theoretical prediction $-\\langle F_2^i \\rangle/\\varepsilon$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\"). The three entries must be, in order: the Test 1 residual float, the Test 2 boolean, and the Test 3 mean error float.", "solution": "### 1. Theoretical Formulation\nThe governing equation is $\\tilde{\\Delta}_L W^i = F^i$, where $W^i$ is the unknown vector field, $F^i$ is a source vector field, and $\\tilde{\\Delta}_L$ is the conformal vector Laplacian. For a flat conformal metric $\\tilde{\\gamma}_{ij} = \\delta_{ij}$ on a Cartesian grid, the covariant derivative $\\tilde{D}_i$ becomes the partial derivative $\\partial_i$. The operator simplifies to:\n$$\n\\tilde{\\Delta}_L W^i = \\Delta W^i + \\frac{1}{3} \\partial_i (\\partial_j W^j)\n$$\nwhere $\\Delta = \\partial_j \\partial_j$ is the standard scalar Laplacian.\n\nWe solve this equation on a periodic domain $[0,1) \\times [0,1)$ using a spectral method based on the Discrete Fourier Transform (DFT). A function $f(x,y)$ is represented by its Fourier coefficients $\\hat{f}(k_x, k_y)$. In Fourier space, partial derivatives $\\partial_x$ and $\\partial_y$ transform into multiplication by $i k_x$ and $i k_y$, respectively, where $k_x$ and $k_y$ are the angular wavenumbers. For a grid of size $N \\times N$ on the unit square, the wavenumbers are $k_x = 2\\pi n_x$ and $k_y = 2\\pi n_y$, where $n_x, n_y$ are integer frequencies from $-N/2$ to $N/2-1$.\n\nThe operator equation in Fourier space becomes an algebraic equation for the Fourier coefficients $\\hat{W}^i(\\vec{k})$ for each wavevector $\\vec{k}=(k_x, k_y)$:\n$$\n-|\\vec{k}|^2 \\hat{W}^i - \\frac{1}{3} k_i (k_j \\hat{W}^j) = \\hat{F}^i\n$$\nwhere $|\\vec{k}|^2 = k_x^2 + k_y^2$, and summation over the index $j \\in \\{x,y\\}$ is implied.\n\nThis represents a $2 \\times 2$ linear system for $(\\hat{W}^x, \\hat{W}^y)$ at each mode $\\vec{k}$.\n\n### 2. Solving the System in Fourier Space\n\n#### Standard Problem (Test 1)\nFor $\\vec{k} \\ne \\vec{0}$, this system can be solved for $\\hat{W}^i$. By first solving for the term $k_j\\hat{W}^j$, we find:\n$$\nk_j \\hat{W}^j = -\\frac{3}{4} \\frac{k_j \\hat{F}^j}{|\\vec{k}|^2}\n$$\nSubstituting this back gives the solution for $\\hat{W}^i$:\n$$\n\\hat{W}^i(\\vec{k}) = -\\frac{\\hat{F}^i(\\vec{k})}{|\\vec{k}|^2} + \\frac{k_i (k_j \\hat{F}^j(\\vec{k}))}{4 |\\vec{k}|^4}\n$$\nFor the zero mode, $\\vec{k}=\\vec{0}$, the operator is singular. The left side of the equation becomes zero, leading to the solvability condition $\\hat{F}^i(\\vec{0}) = \\vec{0}$. This means the source $F^i$ must have a zero spatial average. If this condition is met, there is a family of solutions for $W^i$ (any constant vector can be added). We select a unique solution by setting the zero mode $\\hat{W}^i(\\vec{0}) = \\vec{0}$.\n\n#### Solvability Check (Test 2)\nThe solvability condition $\\hat{F}^i(\\vec{0}) = \\vec{0}$ is equivalent to requiring the spatial average, or mean, of each component of $F^i$ to be zero. This is because the spatial average of a function on the grid is proportional to its $\\vec{k}=\\vec{0}$ Fourier coefficient: $\\langle F^i \\rangle = \\frac{1}{N^2} \\hat{F}^i(\\vec{0})$. We verify this condition by computing the mean of the given source $F_2^i$.\n\n#### Regularized Problem (Test 3)\nTo handle sources with non-zero means, the operator can be regularized by adding a symmetry-breaking term $-\\varepsilon W^i$. The equation becomes $(\\tilde{\\Delta}_L - \\varepsilon I) W^i = F^i$. In Fourier space, this is:\n$$\n- (|\\vec{k}|^2 + \\varepsilon) \\hat{W}^i - \\frac{1}{3} k_i(k_j \\hat{W}^j) = \\hat{F}^i\n$$\nThe term $|\\vec{k}|^2+\\varepsilon$ is strictly positive for $\\varepsilon > 0$, making the operator invertible for all modes, including $\\vec{k}=\\vec{0}$. The solution for $\\hat{W}^i$ becomes:\n$$\n\\hat{W}^i(\\vec{k}) = - \\frac{\\hat{F}^i(\\vec{k})}{|\\vec{k}|^2 + \\varepsilon} + \\frac{k_i (k_j \\hat{F}^j(\\vec{k}))}{(|\\vec{k}|^2 + \\varepsilon)(4|\\vec{k}|^2 + 3\\varepsilon)}\n$$\nFor the zero mode $\\vec{k}=\\vec{0}$, this simplifies to $\\hat{W}^i(\\vec{0}) = -\\hat{F}^i(\\vec{0})/\\varepsilon$. This implies a direct relationship between the mean of the solution and the mean of the source: $\\langle W_\\varepsilon^i \\rangle = -\\langle F^i \\rangle / \\varepsilon$. This prediction is used for verification.\n\n### 3. Implementation and Verification\nThe implementation follows these steps:\n1.  **Grid Setup**: An $N \\times N$ grid ($N=64$) is created for the spatial domain $[0,1) \\times [0,1)$, along with corresponding grids of wavenumbers $(k_x, k_y)$ for Fourier space.\n2.  **Source Definition**: The source functions $F^i(x,y)$ for each test case are evaluated on the spatial grid.\n3.  **Spectral Solution**: The source fields are transformed to Fourier space using `numpy.fft.fft2`. The algebraic solutions for $\\hat{W}^i$ derived above are applied element-wise on the wavenumber grids. For Test 1, the singularity at $\\vec{k}=\\vec{0}$ is handled separately. The resulting $\\hat{W}^i$ is transformed back to real space using `numpy.fft.ifft2`.\n4.  **Residual Calculation**: To assess accuracy, the operator $\\tilde{\\Delta}_L$ is applied to the computed solution $W^i$ in Fourier space. The result is transformed back to real space and subtracted from the original source $F^i$. The relative discrete $L^2$ norm of this residual is computed as per the problem's definition.\n5.  **Mean Value Analysis**: For Tests 2 and 3, spatial means are computed using `np.mean()`, which is equivalent to extracting the zero-frequency Fourier mode and normalizing. These are used to check the solvability and verify the prediction from the regularization theory.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a spectral solver for the XCTS vector elliptic equation on a 2D torus,\n    and runs three verification tests.\n    \"\"\"\n    # --- General Setup ---\n    N = 64\n    epsilon = 1e-4\n\n    # Grid in real space for the domain [0,1) x [0,1)\n    grid_pts = np.arange(N) / N\n    XX, YY = np.meshgrid(grid_pts, grid_pts, indexing='ij')\n\n    # Wavenumbers in Fourier space. For a domain of length L=1, the integer\n    # frequencies n are given by np.fft.fftfreq(N) * N. The angular\n    # wavenumbers are k = 2*pi*n.\n    k_int = np.fft.fftfreq(N) * N\n    kx_vals = 2 * np.pi * k_int\n    ky_vals = 2 * np.pi * k_int\n    KX, KY = np.meshgrid(kx_vals, ky_vals, indexing='ij')\n    \n    K_sq = KX**2 + KY**2\n\n    # --- Helper function for the discrete L2 norm ---\n    def l2_norm(V_x, V_y):\n        \"\"\"Computes the discrete L2 norm as defined in the problem.\"\"\"\n        return np.sqrt(np.mean(V_x**2 + V_y**2))\n\n    # --- Helper function for applying the operator in Fourier space ---\n    def apply_op(Wx_hat, Wy_hat):\n        \"\"\"\n        Applies the tilde{Delta}_L operator to a vector field in Fourier space.\n        result_hat^i = -|k|^2 W_hat^i - (1/3) k_i (k_j W_hat^j)\n        \"\"\"\n        k_dot_W = KX * Wx_hat + KY * Wy_hat\n        op_Wx_hat = -K_sq * Wx_hat - (1 / 3.0) * KX * k_dot_W\n        op_Wy_hat = -K_sq * Wy_hat - (1 / 3.0) * KY * k_dot_W\n        return op_Wx_hat, op_Wy_hat\n\n    # --- Test 1: Solvable case with zero-mean source ---\n    # Define source function F_1\n    F1x = np.sin(2 * np.pi * XX) + np.sin(2 * np.pi * YY)\n    F1y = np.cos(4 * np.pi * XX) - np.sin(2 * np.pi * XX + 2 * np.pi * YY)\n\n    # Transform source to Fourier space\n    F1x_hat = np.fft.fft2(F1x)\n    F1y_hat = np.fft.fft2(F1y)\n    \n    # Solve for W_hat for k!=0. Set W_hat(0)=0.\n    W1x_hat = np.zeros_like(F1x_hat, dtype=complex)\n    W1y_hat = np.zeros_like(F1y_hat, dtype=complex)\n\n    nonzero_k = K_sq > 0\n    k_sq_safe = np.where(nonzero_k, K_sq, 1.0) # Avoid division by zero\n    \n    k_dot_F1 = KX * F1x_hat + KY * F1y_hat\n    \n    W1x_hat[nonzero_k] = -F1x_hat[nonzero_k] / k_sq_safe[nonzero_k] \\\n                         + KX[nonzero_k] * k_dot_F1[nonzero_k] / (4.0 * k_sq_safe[nonzero_k]**2)\n    W1y_hat[nonzero_k] = -F1y_hat[nonzero_k] / k_sq_safe[nonzero_k] \\\n                         + KY[nonzero_k] * k_dot_F1[nonzero_k] / (4.0 * k_sq_safe[nonzero_k]**2)\n\n    # Calculate residual: Res = op(W) - F\n    op_W1x_hat, op_W1y_hat = apply_op(W1x_hat, W1y_hat)\n    \n    # Transform operator action back to real space\n    op_W1x = np.fft.ifft2(op_W1x_hat).real\n    op_W1y = np.fft.ifft2(op_W1y_hat).real\n    \n    # Residual field in real space\n    res_x = op_W1x - F1x\n    res_y = op_W1y - F1y\n\n    # Compute the relative L2 residual norm\n    norm_res = l2_norm(res_x, res_y)\n    norm_F1 = l2_norm(F1x, F1y)\n    \n    result1 = norm_res / norm_F1 if norm_F1 > 0 else 0.0\n\n    # --- Test 2: Check solvability for a source with non-zero mean ---\n    # Define source function F_2\n    F2x = 1.0 + 0.2 * np.sin(2 * np.pi * XX)\n    F2y = -0.5 + 0.2 * np.cos(2 * np.pi * YY)\n    \n    # Check if spatial means are zero\n    mean_F2x = np.mean(F2x)\n    mean_F2y = np.mean(F2y)\n    \n    # The solvability condition is that both means are zero\n    solvable = np.isclose(mean_F2x, 0.0) and np.isclose(mean_F2y, 0.0)\n    result2 = solvable\n\n    # --- Test 3: Regularized solution ---\n    # Using F2 from Test 2, solve the regularized equation\n    F2x_hat = np.fft.fft2(F2x)\n    F2y_hat = np.fft.fft2(F2y)\n    \n    # Apply the solution formula for the regularized problem\n    denom1 = K_sq + epsilon\n    denom2 = 4.0 * K_sq + 3.0 * epsilon\n    \n    k_dot_F2 = KX * F2x_hat + KY * F2y_hat\n    \n    W_eps_x_hat = -F2x_hat / denom1 + KX * k_dot_F2 / (denom1 * denom2)\n    W_eps_y_hat = -F2y_hat / denom1 + KY * k_dot_F2 / (denom1 * denom2)\n    \n    # Transform solution back to real space\n    W_eps_x = np.fft.ifft2(W_eps_x_hat).real\n    W_eps_y = np.fft.ifft2(W_eps_y_hat).real\n    \n    # Compute mean of the numerical solution\n    mean_Wx_computed = np.mean(W_eps_x)\n    mean_Wy_computed = np.mean(W_eps_y)\n    \n    # Theoretical prediction: <W_eps> = -<F2> / eps\n    # The means of F2 were computed in Test 2\n    mean_Wx_predicted = -mean_F2x / epsilon\n    mean_Wy_predicted = -mean_F2y / epsilon\n    \n    # Calculate the Euclidean norm of the difference vector\n    diff_mean_x = mean_Wx_computed - mean_Wx_predicted\n    diff_mean_y = mean_Wy_computed - mean_Wy_predicted\n    \n    result3 = np.sqrt(diff_mean_x**2 + diff_mean_y**2)\n    \n    # --- Final Output ---\n    results = [result1, result2, result3]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3490456"}]}