{"hands_on_practices": [{"introduction": "The momentum constraint provides an elliptic equation for the vector potential $W^i$, which determines the longitudinal part of the extrinsic curvature. On periodic domains, this equation has a solvability condition that the net momentum of the sources must vanish. This practice demonstrates the essential numerical procedure for satisfying this condition, which corresponds to ensuring the initial data has zero total linear momentum, thereby preventing spurious center-of-mass drift in a simulation [@problem_id:3468520].", "problem": "Consider the conformal transverse-traceless (TT) decomposition for constructing initial data in numerical relativity on a flat conformal background with maximal slicing. Let the conformal metric be $\\delta_{ij}$, the mean curvature be $K = 0$, and the extrinsic curvature decompose as $A^{ij} = (L W)^{ij} + S^{ij}$, where $W^{i}$ is a vector potential and $(L W)^{ij} := \\partial^{i} W^{j} + \\partial^{j} W^{i} - \\tfrac{2}{3} \\delta^{ij} \\partial_{k} W^{k}$ is the conformal longitudinal operator. The momentum constraint of Arnowitt–Deser–Misner (ADM) reads $\\partial_{j} A^{ij} = 8 \\pi j^{i}$ for matter current density $j^{i}$. Define the source field $f^{i} := 8 \\pi j^{i} - \\partial_{j} S^{ij}$. The momentum constraint is then $\\partial_{j} (L W)^{ij} = f^{i}$.\n\nOn a periodic cubic domain of side length $L$ and volume $V = L^{3}$, Fourier analysis shows that the operator $\\partial_{j} (L \\cdot)^{ij}$ has a zero mode at wave vector $k = 0$, implying a solvability condition $\\int f^{i} \\, dV = 0$. A nonzero volume integral $\\int f^{i} \\, dV$ represents a spurious net momentum and indicates center-of-mass drift in the constructed data. To eliminate it, one can adjust the TT seed or the zero mode of the source by subtracting its spatial mean, thereby enforcing zero global linear momentum.\n\nYour task is to implement the following pipeline in geometrized units where $G = c = 1$:\n\n1) Work on a periodic cubic grid of size $L = 1$ with $N = 32$ points in each direction. The domain volume is $V = 1$. Use a pseudospectral method (Fast Fourier Transform) to compute derivatives and to solve the vector Poisson-type equation in Fourier space.\n\n2) For each specified test case, define a matter current field $j^{i}(x,y,z)$ and a TT seed constructed from a scalar field $\\psi(x,y,z)$ as $S^{ij} = \\partial^{i} \\partial^{j} \\psi - \\tfrac{1}{3} \\delta^{ij} \\Delta \\psi$. Since the domain is periodic, the divergence of $S^{ij}$ must be computed spectrally. Define\n$$\nf^{i} = 8 \\pi j^{i} - \\partial_{j} S^{ij},\n$$\nand compute the integrated residual\n$$\nR^{i} = \\int f^{i} \\, dV = V \\, \\langle f^{i} \\rangle,\n$$\nwhere $\\langle \\cdot \\rangle$ denotes the spatial mean.\n\n3) Quantify the pre-correction global linear momentum magnitude\n$$\nP_{\\mathrm{before}} = \\frac{\\|R\\|_{2}}{8 \\pi}.\n$$\n\n4) Enforce zero global linear momentum by subtracting the mean from $f^{i}$, i.e. define the corrected source\n$$\n\\tilde{f}^{i} = f^{i} - \\langle f^{i} \\rangle,\n$$\nwhich corresponds to adjusting the TT seed to remove the zero mode and ensures $\\int \\tilde{f}^{i} \\, dV = 0$.\n\n5) Solve $\\partial_{j} (L W)^{ij} = \\tilde{f}^{i}$ in Fourier space for all nonzero wave vectors. In Fourier space, for wave vector $k^{i}$ with squared norm $k^{2} = k_{i} k^{i}$, the equation becomes\n$$\n\\left[-k^{2} \\delta^{i}{}_{m} - \\frac{1}{3} k^{i} k_{m}\\right] \\widehat{W}^{m}(k) = \\widehat{\\tilde{f}}^{i}(k).\n$$\nDecompose $\\widehat{\\tilde{f}}^{i}(k)$ into longitudinal and transverse parts relative to $k^{i}$ and invert the operator to obtain\n- for the transverse component: $\\widehat{W}^{i}_{\\mathrm{T}}(k) = - \\widehat{\\tilde{f}}^{i}_{\\mathrm{T}}(k) / k^{2}$,\n- for the longitudinal component: $\\widehat{W}^{i}_{\\mathrm{L}}(k) = - \\tfrac{3}{4} \\, \\widehat{\\tilde{f}}^{i}_{\\mathrm{L}}(k) / k^{2}$,\nand set $\\widehat{W}^{i}(0) = 0$. Use the inverse Fast Fourier Transform to obtain $W^{i}(x)$.\n\n6) Define the post-correction global linear momentum magnitude by recomputing the integrated residual from the corrected source:\n$$\nP_{\\mathrm{after}} = \\frac{\\|\\int \\tilde{f}^{i} \\, dV\\|_{2}}{8 \\pi}.\n$$\nBy construction, $P_{\\mathrm{after}}$ should be numerically close to zero.\n\nUse the following test suite with $L = 1$, $N = 32$:\n\n- Test case $1$:\n  - $j^{x}(x,y,z) = 0.02 + 0.03 \\sin(2 \\pi x)$,\n  - $j^{y}(x,y,z) = -0.01 + 0.03 \\sin(2 \\pi y)$,\n  - $j^{z}(x,y,z) = 0.015 + 0.03 \\sin(2 \\pi z)$,\n  - $\\psi(x,y,z) = 0$ (so $S^{ij} = 0$).\n- Test case $2$:\n  - $j^{x}(x,y,z) = 0.05 \\sin(2 \\pi x) \\cos(2 \\pi y)$,\n  - $j^{y}(x,y,z) = 0.05 \\sin(2 \\pi y) \\cos(2 \\pi z)$,\n  - $j^{z}(x,y,z) = 0.05 \\sin(2 \\pi z) \\cos(2 \\pi x)$,\n  - $\\psi(x,y,z) = 0.2 \\cos(2 \\pi x) \\cos(2 \\pi y) \\cos(2 \\pi z)$.\n- Test case $3$:\n  - $j^{x}(x,y,z) = -0.03 + 0.02 \\sin(4 \\pi x) \\sin(2 \\pi y)$,\n  - $j^{y}(x,y,z) = 0.04 + 0.02 \\sin(2 \\pi y) \\sin(2 \\pi z)$,\n  - $j^{z}(x,y,z) = 0.0 + 0.02 \\sin(2 \\pi z) \\sin(2 \\pi x)$,\n  - $\\psi(x,y,z) = 0.1 \\cos(2 \\pi x) \\cos(2 \\pi y) \\cos(2 \\pi z)$.\n\nAll trigonometric arguments are in radians. All fields are dimensionless in geometrized units. For each test case, compute $P_{\\mathrm{before}}$ and $P_{\\mathrm{after}}$ as defined above. Express each output as a floating-point number in geometrized units, rounded to $8$ decimal places.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order\n$$\n[\\;P_{\\mathrm{before}}^{(1)}, \\; P_{\\mathrm{after}}^{(1)}, \\; P_{\\mathrm{before}}^{(2)}, \\; P_{\\mathrm{after}}^{(2)}, \\; P_{\\mathrm{before}}^{(3)}, \\; P_{\\mathrm{after}}^{(3)}\\;].\n$$", "solution": "The user has provided a valid, well-posed problem in numerical relativity. The task is to implement a numerical pipeline to enforce the momentum constraint for initial data construction on a periodic domain. The core of the problem involves using pseudospectral methods to compute derivatives and analyze the source of the momentum constraint equations.\n\nThe solution proceeds by implementing the steps outlined in the problem statement for each of the three test cases. All mathematical entities are typeset in LaTeX as per the formatting requirements.\n\n1.  **Discretization and Fourier-Space Representation**:\n    The problem is defined on a periodic cubic domain of side length $L=1$ with volume $V=1$. This domain is discretized into a uniform grid with $N=32$ points along each Cartesian direction ($x, y, z$). The grid spacing is $h = L/N = 1/32$. The discrete grid coordinates are $x_i = i \\cdot h$, $y_j = j \\cdot h$, $z_k = k \\cdot h$ for $i,j,k \\in \\{0, 1, \\dots, N-1\\}$.\n\n    Pseudospectral methods rely on the Fast Fourier Transform (FFT). A function $g(x,y,z)$ on the grid is transformed into its Fourier representation $\\widehat{g}(k_x, k_y, k_z)$. Spatial derivatives are computed by multiplying the Fourier coefficients by the corresponding wavevector components. The wavevectors for a periodic domain of length $L$ are given by $k = 2\\pi m/L$, where $m$ is an integer. For our discrete grid, the angular wavevectors components are $k_x, k_y, k_z$, which are arrays corresponding to the discrete frequencies provided by `numpy.fft.fftfreq`. Specifically, for a given axis, the wavevector components are $k_{\\alpha} = 2\\pi \\cdot f_{\\alpha}$, where $f_{\\alpha}$ is the frequency array returned by `np.fft.fftfreq(N, d=h)`. We denote the squared magnitude of the wavevector as $k^2 = k_x^2 + k_y^2 + k_z^2$.\n\n2.  **Source Field Construction**:\n    The source field $f^i$ for the momentum constraint is defined as:\n    $$\n    f^{i} = 8 \\pi j^{i} - \\partial_{j} S^{ij}\n    $$\n    where $j^i$ is the matter current density and $S^{ij}$ is the seed transverse-traceless part of the extrinsic curvature. The tensor $S^{ij}$ is constructed from a scalar potential $\\psi$ as:\n    $$\n    S^{ij} = \\partial^{i} \\partial^{j} \\psi - \\tfrac{1}{3} \\delta^{ij} \\Delta \\psi\n    $$\n    where $\\Delta = \\partial_k \\partial^k$ is the Laplacian operator.\n\n    The divergence $\\partial_{j} S^{ij}$ must be computed spectrally. We first derive its form in Fourier space. Applying the divergence operator $\\partial_j$ to $S^{ij}$ and using the commutativity of partial derivatives gives:\n    $$\n    \\partial_j S^{ij} = \\partial_j (\\partial^i \\partial^j \\psi) - \\partial_j (\\tfrac{1}{3} \\delta^{ij} \\Delta \\psi) = \\partial^i (\\partial_j \\partial^j \\psi) - \\tfrac{1}{3} \\partial^i (\\Delta \\psi) = \\partial^i(\\Delta \\psi) - \\tfrac{1}{3} \\partial^i(\\Delta \\psi) = \\tfrac{2}{3} \\partial^i(\\Delta \\psi)\n    $$\n    In Fourier space, a partial derivative $\\partial^i$ corresponds to multiplication by $i k^i$, and the Laplacian $\\Delta$ corresponds to multiplication by $-k^2$. Therefore, the Fourier transform of the divergence is:\n    $$\n    \\widehat{\\partial_j S^{ij}}(k) = \\tfrac{2}{3} (i k^i) \\widehat{(\\Delta\\psi)}(k) = \\tfrac{2}{3} (i k^i) (-k^2 \\widehat{\\psi}(k)) = -\\tfrac{2}{3} i k^i k^2 \\widehat{\\psi}(k)\n    $$\n    Numerically, we compute $\\widehat{\\psi} = \\text{FFT}(\\psi)$, multiply by the factor $-\\tfrac{2}{3} i k^i k^2$ for each component $i \\in \\{x,y,z\\}$, and then apply the inverse FFT to obtain $\\partial_j S^{ij}$ in real space.\n\n3.  **Pre-Correction Momentum ($P_{\\mathrm{before}}$)**:\n    The total linear momentum in the initial data is proportional to the volume integral of the source field, $R^i = \\int f^i dV$. On a discrete grid, this integral is approximated by $R^i = V \\langle f^i \\rangle$, where $\\langle \\cdot \\rangle$ is the spatial mean over the grid points. Since $V=1$, we have $R^i = \\langle f^i \\rangle$.\n\n    The mean of the divergence term $\\langle \\partial_j S^{ij} \\rangle$ is calculated from the $k=0$ (DC) mode of its Fourier transform. From the formula above, $\\widehat{\\partial_j S^{ij}}(k=0) = 0$ because it is proportional to $k^i$. This confirms the analytical result from the divergence theorem on a periodic domain: the spatial average of a derivative of any periodic function is zero.\n    Therefore, the integrated residual depends only on the mean of the matter current:\n    $$\n    R^i = \\langle f^i \\rangle = \\langle 8 \\pi j^i - \\partial_j S^{ij} \\rangle = 8 \\pi \\langle j^i \\rangle - \\langle \\partial_j S^{ij} \\rangle = 8 \\pi \\langle j^i \\rangle\n    $$\n    The pre-correction momentum magnitude is then calculated as:\n    $$\n    P_{\\mathrm{before}} = \\frac{\\|R\\|_{2}}{8 \\pi} = \\frac{\\sqrt{(R^x)^2 + (R^y)^2 + (R^z)^2}}{8 \\pi} = \\|\\langle j \\rangle\\|_{2}\n    $$\n    For each test case, we compute the mean of each component of $j^i$ and use this formula to find $P_{\\mathrm{before}}$.\n\n4.  **Post-Correction Momentum ($P_{\\mathrm{after}}$)**:\n    To enforce the solvability condition $\\int f^i dV = 0$, the source field is corrected by subtracting its mean:\n    $$\n    \\tilde{f}^{i} = f^{i} - \\langle f^{i} \\rangle = f^{i} - R^i\n    $$\n    The integrated residual of this corrected source, $\\tilde{R}^i = \\int \\tilde{f}^i dV$, is evaluated. By construction:\n    $$\n    \\tilde{R}^i = \\langle \\tilde{f}^i \\rangle = \\langle f^i - R^i \\rangle = \\langle f^i \\rangle - \\langle R^i \\rangle = R^i - R^i = 0\n    $$\n    In numerical computation, this result will be zero up to floating-point precision. The post-correction momentum magnitude is then:\n    $$\n    P_{\\mathrm{after}} = \\frac{\\|\\tilde{R}\\|_{2}}{8 \\pi}\n    $$\n    which is expected to be numerically indistinguishable from $0$. The problem asks for this value to be computed explicitly to verify the correction procedure. After rounding to $8$ decimal places, this value becomes $0.00000000$.\n\nThe following code implements this procedure for the test cases provided.", "answer": "```python\nimport numpy as np\n\ndef compute_momenta(j_funcs, psi_func):\n    \"\"\"\n    Implements the pipeline to calculate pre- and post-correction momentum.\n\n    Args:\n        j_funcs (list): A list of three lambda functions for j^x, j^y, j^z.\n        psi_func (lambda): A lambda function for the scalar potential psi.\n\n    Returns:\n        list: A list containing [p_before, p_after].\n    \"\"\"\n    # 1) Grid setup in geometrized units\n    L = 1.0\n    N = 32\n    h = L / N\n    V = L**3\n\n    x = np.arange(N) * h\n    # Use 'ij' indexing for consistency with mathematical notation (index i, j, k)\n    X, Y, Z = np.meshgrid(x, x, x, indexing='ij')\n\n    # Fourier space wavevectors\n    k_freq = np.fft.fftfreq(N, d=h)\n    k_wave = 2 * np.pi * k_freq\n    Kx, Ky, Kz = np.meshgrid(k_wave, k_wave, k_wave, indexing='ij')\n    K2 = Kx**2 + Ky**2 + Kz**2\n\n    # 2) Define source fields\n    # Matter current j^i\n    jx = j_funcs[0](X, Y, Z)\n    jy = j_funcs[1](X, Y, Z)\n    jz = j_funcs[2](X, Y, Z)\n\n    # Scalar potential psi and S^ij\n    psi = psi_func(X, Y, Z)\n\n    # Compute divergence of S^ij spectrally\n    # The contribution from psi=0 is zero, so we can optimize\n    if np.all(psi == 0):\n        div_S_x, div_S_y, div_S_z = 0.0, 0.0, 0.0\n    else:\n        # FFT of psi\n        psi_hat = np.fft.fftn(psi)\n        \n        # Fourier transform of div(S) has components:\n        # hat(div S)_i = - (2/3) * i * k_i * k^2 * hat(psi)\n        div_S_x_hat = (-2./3.) * 1j * Kx * K2 * psi_hat\n        div_S_y_hat = (-2./3.) * 1j * Ky * K2 * psi_hat\n        div_S_z_hat = (-2./3.) * 1j * Kz * K2 * psi_hat\n\n        # Inverse FFT to get real-space divergence components\n        # The result must be real; .real discards negligible imaginary parts\n        div_S_x = np.fft.ifftn(div_S_x_hat).real\n        div_S_y = np.fft.ifftn(div_S_y_hat).real\n        div_S_z = np.fft.ifftn(div_S_z_hat).real\n\n    # Source field f^i = 8*pi*j^i - div(S)^i\n    fx = 8 * np.pi * jx - div_S_x\n    fy = 8 * np.pi * jy - div_S_y\n    fz = 8 * np.pi * jz - div_S_z\n\n    # 3) Compute pre-correction momentum\n    # R^i = V * f^i. Since V=1, R^i = f^i\n    Rx = np.mean(fx)\n    Ry = np.mean(fy)\n    Rz = np.mean(fz)\n    \n    R_norm = np.sqrt(Rx**2 + Ry**2 + Rz**2)\n    p_before = R_norm / (8 * np.pi)\n\n    # 4  6) Correct the source and compute post-correction momentum\n    # Corrected source f_tilde^i = f^i - f^i\n    f_tilde_x = fx - Rx\n    f_tilde_y = fy - Ry\n    f_tilde_z = fz - Rz\n\n    # Integrated residual of f_tilde\n    R_tilde_x = np.mean(f_tilde_x)\n    R_tilde_y = np.mean(f_tilde_y)\n    R_tilde_z = np.mean(f_tilde_z)\n    \n    R_tilde_norm = np.sqrt(R_tilde_x**2 + R_tilde_y**2 + R_tilde_z**2)\n    p_after = R_tilde_norm / (8 * np.pi)\n\n    return [p_before, p_after]\n\n\ndef solve():\n    \"\"\"\n    Main solver function that runs all test cases and prints the final result.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"j_funcs\": [\n                lambda x, y, z: 0.02 + 0.03 * np.sin(2 * np.pi * x),\n                lambda x, y, z: -0.01 + 0.03 * np.sin(2 * np.pi * y),\n                lambda x, y, z: 0.015 + 0.03 * np.sin(2 * np.pi * z)\n            ],\n            \"psi_func\": lambda x, y, z: 0.0\n        },\n        {\n            \"j_funcs\": [\n                lambda x, y, z: 0.05 * np.sin(2 * np.pi * x) * np.cos(2 * np.pi * y),\n                lambda x, y, z: 0.05 * np.sin(2 * np.pi * y) * np.cos(2 * np.pi * z),\n                lambda x, y, z: 0.05 * np.sin(2 * np.pi * z) * np.cos(2 * np.pi * x)\n            ],\n            \"psi_func\": lambda x, y, z: 0.2 * np.cos(2 * np.pi * x) * np.cos(2 * np.pi * y) * np.cos(2 * np.pi * z)\n        },\n        {\n            \"j_funcs\": [\n                lambda x, y, z: -0.03 + 0.02 * np.sin(4 * np.pi * x) * np.sin(2 * np.pi * y),\n                lambda x, y, z: 0.04 + 0.02 * np.sin(2 * np.pi * y) * np.sin(2 * np.pi * z),\n                lambda x, y, z: 0.0 + 0.02 * np.sin(2 * np.pi * z) * np.sin(2 * np.pi * x)\n            ],\n            \"psi_func\": lambda x, y, z: 0.1 * np.cos(2 * np.pi * x) * np.cos(2 * np.pi * y) * np.cos(2 * np.pi * z)\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        p_before, p_after = compute_momenta(case[\"j_funcs\"], case[\"psi_func\"])\n        results.extend([p_before, p_after])\n\n    # Format the results to 8 decimal places as required.\n    formatted_results = [f'{r:.8f}' for r in results]\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3468520"}, {"introduction": "Simulating spacetimes containing black holes requires excising the singularity and imposing boundary conditions on the remaining computational domain. This exercise guides you through deriving the appropriate physical boundary conditions for the conformal factor $\\psi$ and the vector potential $W^i$ on an excision surface representing an isolated horizon. By translating these analytical conditions into a numerical check, you will gain hands-on experience with a critical step in preparing initial data for black hole evolutions [@problem_id:3468539].", "problem": "Consider the conformal transverse-traceless (CTT) decomposition of vacuum initial data in General Relativity under the following assumptions: the conformal metric is flat, denoted by $\\tilde{g}_{ij} = \\delta_{ij}$, the trace of the extrinsic curvature is zero (maximal slicing), and the domain is the exterior of a sphere of coordinate radius $R$ in Euclidean three-space. Work in geometrized units where $G=c=1$ so that all quantities are dimensionless. Let $\\tilde{\\nabla}_i$ denote the Levi-Civita connection of $\\tilde{g}_{ij}$. The trace-free part of the extrinsic curvature is represented via a vector potential $W^i$ as $\\tilde{A}^{ij} = (\\tilde{\\mathbb{L}} W)^{ij}$, where the conformal longitudinal operator (also called the conformal Killing operator) is defined by\n$$(\\tilde{\\mathbb{L}} W)^{ij} = \\tilde{\\nabla}^i W^j + \\tilde{\\nabla}^j W^i - \\frac{2}{3} \\tilde{g}^{ij} \\tilde{\\nabla}_k W^k.$$\nOn an excision surface approximating an apparent horizon, with outward-pointing unit normal $s^i$ (pointing from the excised region into the computational domain), impose the transverse-traceless (TT) boundary condition\n$$s_i (\\tilde{\\mathbb{L}} W)^{ij} = 0 \\quad \\text{on } r=R.$$\nAdditionally, the Hamiltonian constraint for the conformal factor $\\psi$ reduces (for vacuum and maximal slicing) to a Laplace equation on the exterior domain, with the isolated-horizon inner boundary condition\n$$s^i \\tilde{\\nabla}_i \\psi + \\frac{\\psi}{4} \\tilde{H} = 0 \\quad \\text{on } r=R,$$\nwhere $\\tilde{H}$ is the mean curvature of the excision surface embedded in the conformal metric. For a round sphere of radius $R$ in flat space, $\\tilde{H} = 2/R$. The asymptotic condition is $\\psi \\to 1$ as $r \\to \\infty$.\n\nTasks:\n1) Starting from the above definitions and using only the properties of the Euclidean metric and derivatives, consider a spherically symmetric ansatz $W^i = f(r) s^i$ with $s^i = x^i / r$. Derive a scalar condition equivalent to the vector boundary condition $s_i (\\tilde{\\mathbb{L}} W)^{ij} = 0$ on $r=R$ by projecting along $s^j$. Show that the boundary constraint reduces to a Robin-type condition of the form\n$$f'(R) = \\frac{f(R)}{R}.$$\n2) Under the same geometric assumptions, use the Hamiltonian constraint and the isolated-horizon boundary condition to determine the spherically symmetric solution for the conformal factor of the form $\\psi(r) = 1 + C/r$ in the exterior domain. Determine the constant $C$ in terms of $R$ by enforcing the inner boundary condition. State the explicit value of $C$.\n3) For numerical verification, adopt the parameterized forms $f(r) = A\\, r^p$ and $\\psi(r) = 1 + C/r$. Using your derivations from parts (1) and (2), construct the following two residuals evaluated at $r=R$:\n- The TT boundary residual projected along $s^j$,\n$$\\mathcal{B}(R) \\equiv s_j s_i (\\tilde{\\mathbb{L}} W)^{ij} = \\frac{4}{3}\\left(f'(R) - \\frac{f(R)}{R}\\right),$$\nexpressed in terms of $A$, $p$, and $R$.\n- The isolated-horizon boundary residual for the conformal factor,\n$$\\mathcal{R}_\\psi(R) \\equiv \\left.s^i \\partial_i \\psi + \\frac{\\psi}{2R}\\right|_{r=R},$$\nexpressed in terms of $C$ and $R$.\n4) Implement a program that, for a given test suite of parameter values $(R, A, p, C)$, evaluates and returns the pair of floats $(\\mathcal{B}(R), \\mathcal{R}_\\psi(R))$ for each test case. Use the following test suite:\n- Case 1 (happy path): $R=2.0$, $A=3.0$, $p=1.0$, $C=2.0$.\n- Case 2 (violates TT only): $R=2.0$, $A=3.0$, $p=0.0$, $C=2.0$.\n- Case 3 (violates isolated-horizon only): $R=1.5$, $A=1.0$, $p=1.0$, $C=1.0$.\n- Case 4 (small radius, both satisfied): $R=0.5$, $A=2.0$, $p=1.0$, $C=0.5$.\n- Case 5 (sign-flipped amplitude, violates TT): $R=1.0$, $A=-1.0$, $p=2.0$, $C=1.0$.\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, flattened in the order $[\\mathcal{B}_1,\\mathcal{R}_{\\psi,1},\\mathcal{B}_2,\\mathcal{R}_{\\psi,2},\\dots]$. All outputs are real numbers in geometrized units (dimensionless).", "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It represents a standard exercise in setting up initial data for numerical relativity within the conformal transverse-traceless (CTT) framework. All definitions and conditions are consistent with the established literature. We proceed with a step-by-step solution.\n\nThe core of the problem lies in the CTT decomposition of the vacuum initial data constraints. We operate under the assumptions of a conformally flat metric, $\\tilde{g}_{ij} = \\delta_{ij}$, and maximal slicing, $K=0$. In this context, the connection $\\tilde{\\nabla}_i$ becomes the ordinary partial derivative $\\partial_i$, and indices can be raised and lowered using the Kronecker delta $\\delta_{ij}$.\n\n**Part 1: Derivation of the Transverse-Traceless (TT) Boundary Condition**\n\nWe are given the vector potential ansatz $W^i = f(r) s^i = f(r) \\frac{x^i}{r}$, where $r = \\sqrt{x_k x^k}$ is the coordinate radius. We need to evaluate the expression $s_i (\\tilde{\\mathbb{L}} W)^{ij}$ on the spherical boundary at $r=R$. The conformal Killing operator is defined as $(\\tilde{\\mathbb{L}} W)^{ij} = \\partial^i W^j + \\partial^j W^i - \\frac{2}{3} \\delta^{ij} \\partial_k W^k$.\n\nFirst, we compute the gradient of $W^i$:\n$$ \\partial_j W^i = \\partial_j \\left( f(r) \\frac{x^i}{r} \\right) = (\\partial_j f) \\frac{x^i}{r} + f \\partial_j \\left( \\frac{x^i}{r} \\right) $$\nUsing the chain rule, $\\partial_j f = f'(r) \\partial_j r = f'(r) \\frac{x_j}{r}$. The derivatives of the radial vector components are $\\partial_j(x^i/r) = \\frac{\\delta^i_j}{r} - \\frac{x^i x_j}{r^3}$.\nSubstituting these results, we get:\n$$ \\partial_j W^i = f'(r) \\frac{x_j x^i}{r^2} + f(r) \\left( \\frac{\\delta^i_j}{r} - \\frac{x^i x_j}{r^3} \\right) = \\left( \\frac{f'(r)}{r} - \\frac{f(r)}{r^2} \\right) \\frac{x^i x_j}{r} + \\frac{f(r)}{r} \\delta^i_j $$\nNext, we compute the divergence $\\partial_k W^k$:\n$$ \\partial_k W^k = \\left( \\frac{f'}{r} - \\frac{f}{r^2} \\right) \\frac{x^k x_k}{r} + \\frac{f}{r} \\delta^k_k $$\nUsing $x^k x_k = r^2$ and $\\delta^k_k = 3$, this simplifies to:\n$$ \\partial_k W^k = \\left( \\frac{f'}{r} - \\frac{f}{r^2} \\right) r + 3 \\frac{f}{r} = f' - \\frac{f}{r} + \\frac{3f}{r} = f'(r) + \\frac{2f(r)}{r} $$\nNow we assemble the operator $(\\tilde{\\mathbb{L}} W)^{ij}$:\n$$ (\\tilde{\\mathbb{L}} W)^{ij} = \\partial^i W^j + \\partial^j W^i - \\frac{2}{3} \\delta^{ij} \\left( f' + \\frac{2f}{r} \\right) $$\n$$ (\\tilde{\\mathbb{L}} W)^{ij} = 2 \\left[ \\left( \\frac{f'}{r} - \\frac{f}{r^2} \\right) \\frac{x^i x^j}{r} + \\frac{f}{r} \\delta^{ij} \\right] - \\frac{2}{3} \\delta^{ij} \\left( f' + \\frac{2f}{r} \\right) $$\n$$ (\\tilde{\\mathbb{L}} W)^{ij} = 2 \\left( \\frac{f'}{r} - \\frac{f}{r^2} \\right) s^i s^j r + \\delta^{ij} \\left( \\frac{2f}{3r} - \\frac{2f'}{3} \\right) $$\nThe TT boundary condition is $s_i (\\tilde{\\mathbb{L}} W)^{ij} = 0$. We contract with the normal vector $s_i = x_i/r$:\n$$ s_i (\\tilde{\\mathbb{L}} W)^{ij} = \\frac{x_i}{r} (\\tilde{\\mathbb{L}} W)^{ij} = 2 \\left( \\frac{f'}{r} - \\frac{f}{r^2} \\right) \\frac{(x_i x^i) x^j}{r^2} + \\frac{x_k \\delta^{kj}}{r} \\left( \\frac{2f}{3r} - \\frac{2f'}{3} \\right) $$\nSince $x_i x^i = r^2$ and $x_k \\delta^{kj} = x^j$:\n$$ s_i (\\tilde{\\mathbb{L}} W)^{ij} = 2 \\left( f' - \\frac{f}{r} \\right) \\frac{x^j}{r} + \\frac{x^j}{r} \\left( \\frac{2f}{3r} - \\frac{2f'}{3} \\right) $$\n$$ s_i (\\tilde{\\mathbb{L}} W)^{ij} = s^j \\left[ 2f' - \\frac{2f}{r} + \\frac{2f}{3r} - \\frac{2f'}{3} \\right] = s^j \\left[ \\frac{4}{3} f' - \\frac{4}{3} \\frac{f}{r} \\right] = \\frac{4}{3} s^j \\left( f' - \\frac{f}{r} \\right) $$\nThe vector condition $s_i (\\tilde{\\mathbb{L}} W)^{ij} = 0$ requires the scalar coefficient of $s^j$ to be zero. Thus, at $r=R$:\n$$ f'(R) - \\frac{f(R)}{R} = 0 \\implies f'(R) = \\frac{f(R)}{R} $$\nThis is the required Robin-type condition. Projecting this result along $s^j$ gives the scalar residual $\\mathcal{B}(R)$:\n$$ \\mathcal{B}(R) = s_j \\left( s_i (\\tilde{\\mathbb{L}} W)^{ij} \\right) = s_j \\left( \\frac{4}{3} s^j \\left( f' - \\frac{f}{r} \\right) \\right) = \\frac{4}{3} (s_j s^j) \\left( f'(R) - \\frac{f(R)}{R} \\right) $$\nSince $s^j$ is a unit vector, $s_j s^j = 1$. This confirms the provided definition: $\\mathcal{B}(R) = \\frac{4}{3} (f'(R) - \\frac{f(R)}{R})$.\n\n**Part 2: Solution for the Conformal Factor**\n\nThe Hamiltonian constraint for vacuum, maximal slicing, and conformally flat space reduces to the Laplace equation, $\\tilde{\\nabla}^2 \\psi = 0$. For a spherically symmetric ansatz in flat space, this is $\\frac{1}{r^2} \\frac{d}{dr} (r^2 \\frac{d\\psi}{dr}) = 0$. The general solution is $\\psi(r) = D + C/r$. Applying the asymptotic condition $\\psi \\to 1$ as $r \\to \\infty$ fixes the constant $D=1$, giving the form $\\psi(r) = 1 + C/r$.\n\nThe isolated-horizon boundary condition at $r=R$ is $s^i \\tilde{\\nabla}_i \\psi + \\frac{\\psi}{4} \\tilde{H} = 0$. For a spherically symmetric function, $s^i \\tilde{\\nabla}_i \\psi = \\frac{d\\psi}{dr}$. With $\\tilde{H} = 2/R$, the condition becomes:\n$$ \\left. \\frac{d\\psi}{dr} \\right|_{r=R} + \\frac{\\psi(R)}{2R} = 0 $$\nWe substitute $\\psi(r) = 1 + C/r$ and its derivative $\\frac{d\\psi}{dr} = -C/r^2$:\n$$ -\\frac{C}{R^2} + \\frac{1 + C/R}{2R} = 0 $$\nMultiplying by $2R^2$ to clear denominators:\n$$ -2C + R(1 + C/R) = 0 $$\n$$ -2C + R + C = 0 \\implies -C + R = 0 \\implies C=R $$\nTherefore, the constant $C$ is equal to the coordinate radius of the boundary, $R$.\n\n**Part 3: Construction of Residuals**\n\nWe now construct the explicit expressions for the residuals using the given parameterizations.\n\n- **TT Residual $\\mathcal{B}(R)$**:\nWe use the parameterized form $f(r) = A r^p$. Its derivative is $f'(r) = A p r^{p-1}$.\nSubstituting into the definition $\\mathcal{B}(R) = \\frac{4}{3}\\left(f'(R) - \\frac{f(R)}{R}\\right)$:\n$$ \\mathcal{B}(R) = \\frac{4}{3} \\left( A p R^{p-1} - \\frac{A R^p}{R} \\right) = \\frac{4}{3} \\left( A p R^{p-1} - A R^{p-1} \\right) $$\n$$ \\mathcal{B}(R) = \\frac{4A}{3} R^{p-1} (p - 1) $$\n\n- **Isolated-Horizon Residual $\\mathcal{R}_\\psi(R)$**:\nWe use the parameterized form $\\psi(r) = 1 + C/r$. Its derivative is $\\frac{d\\psi}{dr} = -C/r^2$.\nThe residual is defined as $\\mathcal{R}_\\psi(R) = \\left.s^i \\partial_i \\psi + \\frac{\\psi}{2R}\\right|_{r=R} = \\left.\\frac{d\\psi}{dr}\\right|_{r=R} + \\frac{\\psi(R)}{2R}$.\nSubstituting the expressions for $\\psi$ and its derivative evaluated at $r=R$:\n$$ \\mathcal{R}_\\psi(R) = -\\frac{C}{R^2} + \\frac{1 + C/R}{2R} = -\\frac{C}{R^2} + \\frac{1}{2R} + \\frac{C}{2R^2} $$\n$$ \\mathcal{R}_\\psi(R) = \\frac{1}{2R} - \\frac{C}{2R^2} = \\frac{R - C}{2R^2} $$\n\nThese expressions are used in the numerical implementation below.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates residuals for the Conformal Transverse-Traceless (CTT) and \n    Isolated-Horizon boundary conditions based on a set of test parameters.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (R, A, p, C)\n    test_cases = [\n        (2.0, 3.0, 1.0, 2.0),   # Case 1: happy path\n        (2.0, 3.0, 0.0, 2.0),   # Case 2: violates TT only\n        (1.5, 1.0, 1.0, 1.0),   # Case 3: violates isolated-horizon only\n        (0.5, 2.0, 1.0, 0.5),   # Case 4: small radius, both satisfied\n        (1.0, -1.0, 2.0, 1.0),  # Case 5: sign-flipped amplitude, violates TT\n    ]\n\n    results = []\n    for case in test_cases:\n        R, A, p, C = case\n        \n        # Calculate the TT boundary residual, B(R).\n        # Formula: B(R) = (4*A/3) * R^(p-1) * (p-1)\n        # np.power is used for robust handling of potential non-integer exponents,\n        # although here p-1 is integer. It is good practice.\n        if R == 0:\n            # Avoid division by zero or 0**negative power if R=0, although test cases prevent this.\n            B_R = np.inf if p  1 else 0\n        else:\n            B_R = (4.0 * A / 3.0) * np.power(R, p - 1.0) * (p - 1.0)\n        \n        # Calculate the isolated-horizon boundary residual, R_psi(R).\n        # Formula: R_psi(R) = (R - C) / (2 * R^2)\n        if R == 0:\n            R_psi = np.inf\n        else:\n            R_psi = (R - C) / (2.0 * R**2)\n            \n        results.append(B_R)\n        results.append(R_psi)\n\n    # Final print statement in the exact required format.\n    # The format is a comma-separated list of floats enclosed in square brackets.\n    # e.g., [B_1,R_psi_1,B_2,R_psi_2,...]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3468539"}, {"introduction": "The conformal transverse-traceless decomposition offers degrees of freedom that can be exploited to improve the physical quality of the initial data. A key goal is to minimize the initial burst of non-physical \"junk radiation\" that can contaminate a numerical simulation. This advanced practice introduces a method to tune the conformal vector potential $W^i$ by numerically minimizing a proxy for this junk radiation, illustrating how the mathematical structure of the constraints can be used to construct more quiescent and physically realistic initial states [@problem_id:3468531].", "problem": "You are given the task of constructing a numerical experiment to tune the conformal vector potential $W^i$ in the conformal transverse-traceless decomposition of the $3+1$ Einstein equations to reduce a proxy for initial junk radiation while holding the mean curvature $K$ and the conformal metric $\\tilde g_{ij}$ fixed. Work in vacuum, with conformal flatness $\\tilde g_{ij} = \\delta_{ij}$, maximal slicing $K = 0$, and a periodic cubic domain of side length $L = 1$ in dimensionless units.\n\nStart from the following foundational elements and definitions:\n\n- The $3+1$ decomposition splits the extrinsic curvature $K_{ij}$ into a trace part and a traceless part. Under the conformal transverse-traceless decomposition, the conformally related traceless extrinsic curvature $\\tilde A_{ij}$ is specified as\n$$\n\\tilde A_{ij} = \\tilde A^{\\mathrm{TT}}_{ij} + (L W)_{ij},\n$$\nwhere $\\tilde A^{\\mathrm{TT}}_{ij}$ is the transverse-traceless part chosen as free data and $(L W)_{ij}$ is the longitudinal part constructed from the conformal vector potential $W^i$ via the conformal Killing operator\n$$\n(L W)_{ij} = \\tilde D_i W_j + \\tilde D_j W_i - \\frac{2}{3} \\tilde g_{ij} \\tilde D_k W^k,\n$$\nwith $\\tilde D_i$ the covariant derivative compatible with $\\tilde g_{ij}$. In the present setting $\\tilde g_{ij} = \\delta_{ij}$, so $\\tilde D_i$ reduces to partial derivatives.\n\n- The Hamiltonian constraint for vacuum under conformal decompositions is\n$$\n\\tilde \\Delta \\psi - \\frac{1}{8} \\tilde A_{ij} \\tilde A^{ij} \\, \\psi^{-7} = 0,\n$$\nwhere $\\psi$ is the conformal factor, $\\tilde \\Delta$ is the flat Laplacian, and $\\tilde A^{ij} = \\tilde g^{ik} \\tilde g^{jl} \\tilde A_{kl}$. In this problem, to construct a controlled and computationally tractable proxy, approximate the solution for $\\psi$ by solving the linear Poisson equation\n$$\n\\tilde \\Delta \\psi = \\frac{1}{8} \\tilde A_{ij} \\tilde A^{ij},\n$$\nwith periodic boundary conditions and zero mean for $\\psi$, and then define the physical conformal factor as $\\psi_{\\mathrm{phys}} = 1 + \\psi$. The physical traceless extrinsic curvature is then approximated as\n$$\nA^{\\mathrm{phys}}_{ij} = \\psi_{\\mathrm{phys}}^{-10} \\, \\tilde A_{ij}.\n$$\n\n- The Transverse-Traceless (TT) projection in Fourier space for a symmetric tensor field $S_{ij}$ at wavevector $k_i$ (with $k^2 = k_i k_i$) is given by\n$$\nP_{ij} = \\delta_{ij} - \\frac{k_i k_j}{k^2}, \\quad S^{\\mathrm{TT}}_{ij}(k) = \\left(P_{ik} P_{jl} - \\frac{1}{2} P_{ij} P_{kl}\\right) S_{kl}(k),\n$$\nand $S^{\\mathrm{TT}}_{ij}(k=0) \\equiv 0$.\n\n- In the linearized regime, the Newman-Penrose scalar $\\Psi_4$ is proportional to second time derivatives of the transverse-traceless metric perturbation. As a practical, dimensionless proxy for the integral $\\int |\\Psi_4|^2 \\, dt$ over an initial time window, use the spatial integral (volume-normalized) of the squared TT norm of $A^{\\mathrm{phys}}_{ij}$ at the initial time,\n$$\nJ_{\\mathrm{TT}}[W] = \\left\\langle A^{\\mathrm{TT}}_{ij} A^{\\mathrm{TT}}_{ij} \\right\\rangle,\n$$\nwhere angle brackets denote the spatial average over the periodic domain, and $A^{\\mathrm{TT}}_{ij}$ is the TT projection (computed spectrally in Fourier space) of $A^{\\mathrm{phys}}_{ij}$. The target functional to be minimized balances the TT content against a smoothness regularization of $W^i$:\n$$\nJ[W] = J_{\\mathrm{TT}}[W] + \\lambda \\, \\left\\langle \\tilde D_i W_j \\, \\tilde D_i W_j \\right\\rangle,\n$$\nwhere $\\lambda$ is a dimensionless regularization parameter.\n\nYour program must implement the following setup and computation:\n\n1. Domain and discretization:\n   - Use a periodic cubic domain with side length $L = 1$.\n   - Use a uniform grid with $N_x = 16$, $N_y = 16$, and $N_z = 32$ points along the $x$, $y$, and $z$ directions, respectively.\n   - All quantities are dimensionless.\n\n2. Free-data specification:\n   - Choose the conformal transverse-traceless seed $\\tilde A^{\\mathrm{TT}}_{ij}$ to represent a plus-polarized standing wave along the $z$-direction:\n     $$\n     \\tilde A^{\\mathrm{TT}}_{xx}(x,y,z) = A_0 \\cos(2\\pi k z), \\quad \\tilde A^{\\mathrm{TT}}_{yy}(x,y,z) = -A_0 \\cos(2\\pi k z),\n     $$\n     and all other components of $\\tilde A^{\\mathrm{TT}}_{ij}$ are zero.\n   - Here $A_0$ and $k$ are dimensionless amplitude and integer wavenumber, respectively.\n\n3. Vector potential parameterization:\n   - Restrict $W^i$ to the two-parameter family\n     $$\n     W^x(x,y,z) = a_x \\cos(2\\pi k z), \\quad W^y(x,y,z) = a_y \\sin(2\\pi k z), \\quad W^z(x,y,z) = 0,\n     $$\n     where $(a_x,a_y)$ are real parameters to be tuned. Construct $(L W)_{ij}$ using spectral derivatives on the periodic grid:\n     $$\n     (L W)_{ij} = \\partial_i W_j + \\partial_j W_i - \\frac{2}{3} \\delta_{ij} \\, \\partial_m W_m.\n     $$\n\n4. Conformal factor and physical extrinsic curvature:\n   - Compute $\\tilde A_{ij} = \\tilde A^{\\mathrm{TT}}_{ij} + (L W)_{ij}$.\n   - Solve the linear Poisson equation $\\tilde \\Delta \\psi = \\frac{1}{8} \\tilde A_{ij} \\tilde A^{ij}$ for $\\psi$ in Fourier space with periodic boundary conditions, setting the $\\vec k = \\vec 0$ mode to zero to enforce zero mean. Construct $\\psi_{\\mathrm{phys}} = 1 + \\psi$ and clamp $\\psi_{\\mathrm{phys}}$ pointwise to be at least $0.5$ to maintain positivity.\n   - Construct $A^{\\mathrm{phys}}_{ij} = \\psi_{\\mathrm{phys}}^{-10} \\, \\tilde A_{ij}$.\n\n5. TT projection and objective:\n   - Compute the TT projection $A^{\\mathrm{TT}}_{ij}$ of $A^{\\mathrm{phys}}_{ij}$ by spectral projection in Fourier space using the projector $P_{ij}$ described above, setting the zero mode to zero.\n   - Compute $J_{\\mathrm{TT}}[W] = \\left\\langle A^{\\mathrm{TT}}_{ij} A^{\\mathrm{TT}}_{ij} \\right\\rangle$ using the Euclidean index contraction, i.e.,\n     $$\n     A^{\\mathrm{TT}}_{ij} A^{\\mathrm{TT}}_{ij} = A^{\\mathrm{TT}}_{xx}{}^2 + A^{\\mathrm{TT}}_{yy}{}^2 + A^{\\mathrm{TT}}_{zz}{}^2 + 2\\left( A^{\\mathrm{TT}}_{xy}{}^2 + A^{\\mathrm{TT}}_{xz}{}^2 + A^{\\mathrm{TT}}_{yz}{}^2 \\right).\n     $$\n   - Compute the regularization term $\\left\\langle \\tilde D_i W_j \\, \\tilde D_i W_j \\right\\rangle$ by spectral derivatives in all directions $x$, $y$, and $z$, and form $J[W]$.\n\n6. Optimization:\n   - For each test case, start from the provided initial guess $(a_x,a_y)$, compute the initial $J_{\\mathrm{TT}}[W]$, and then minimize $J[W]$ over $(a_x,a_y)$ using a derivative-free method. After obtaining the optimizer’s $(a_x,a_y)$, recompute $J_{\\mathrm{TT}}[W]$ for the optimized parameters. If the initial $J_{\\mathrm{TT}}[W]$ is zero, define the reduction ratio as $1.0$ to avoid division by zero; otherwise, define the reduction ratio as $J_{\\mathrm{TT}}^{\\mathrm{opt}} / J_{\\mathrm{TT}}^{\\mathrm{init}}$.\n\nProduce the final output as a single line containing a comma-separated list of nine floats in square brackets, in the following order for the three test cases:\n$$\n\\left[ J_{\\mathrm{TT}}^{\\mathrm{init},(1)}, J_{\\mathrm{TT}}^{\\mathrm{opt},(1)}, r^{(1)}, J_{\\mathrm{TT}}^{\\mathrm{init},(2)}, J_{\\mathrm{TT}}^{\\mathrm{opt},(2)}, r^{(2)}, J_{\\mathrm{TT}}^{\\mathrm{init},(3)}, J_{\\mathrm{TT}}^{\\mathrm{opt},(3)}, r^{(3)} \\right].\n$$\nAll quantities are dimensionless.\n\nTest suite:\n- Case $(1)$: $A_0 = 0.05$, $k = 1$, $\\lambda = 0.01$, $(a_x,a_y) = (0,0)$.\n- Case $(2)$: $A_0 = 0.10$, $k = 2$, $\\lambda = 0.005$, $(a_x,a_y) = (0,0)$.\n- Case $(3)$ (edge case with no initial TT seed): $A_0 = 0.00$, $k = 1$, $\\lambda = 0.01$, $(a_x,a_y) = (0,0)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[x_1,x_2,\\dots,x_9]$). No additional text should be printed.", "solution": "The problem statement constitutes a valid, well-posed numerical experiment in the field of computational general relativity. It outlines a procedure for constructing initial data for Einstein's equations by tuning free parameters in the conformal transverse-traceless (CTT) decomposition to minimize a proxy for spurious gravitational radiation. All physical quantities, mathematical equations, and numerical procedures are clearly defined and scientifically grounded. We shall therefore proceed with the solution.\n\nThe core of the problem is to minimize the objective functional $J[W]$ with respect to the parameters $(a_x, a_y)$ that define the conformal vector potential $W^i$. The functional is given by\n$$\nJ[W] = J_{\\mathrm{TT}}[W] + \\lambda \\, \\left\\langle \\tilde D_i W_j \\, \\tilde D_i W_j \\right\\rangle.\n$$\nWe will implement a numerical function that, for a given pair $(a_x, a_y)$ and fixed case parameters $(A_0, k, \\lambda)$, computes the value of $J[W]$ and its primary component, the junk radiation proxy $J_{\\mathrm{TT}}[W]$. This function will then be passed to a numerical optimizer.\n\nThe procedure is executed on a discrete grid representing a periodic cubic domain of side length $L=1$. The grid dimensions are $N_x=16$, $N_y=16$, and $N_z=32$. Spectral methods utilizing the Fast Fourier Transform (FFT) are ideal for this periodic setup, particularly for computing derivatives and solving the specified Poisson equation.\n\nA step-by-step description of the computation for a given $(a_x, a_y)$ is as follows:\n\n1.  **Construct the Conformal Traceless Extrinsic Curvature $\\tilde A_{ij}$**:\n    This tensor is the sum of a fixed seed part, $\\tilde A^{\\mathrm{TT}}_{ij}$, and a tunable longitudinal part, $(L W)_{ij}$.\n    \n    The seed $\\tilde A^{\\mathrm{TT}}_{ij}$ is a plus-polarized standing wave:\n    $$\n    \\tilde A^{\\mathrm{TT}}_{xx}(x,y,z) = A_0 \\cos(2\\pi k z), \\quad \\tilde A^{\\mathrm{TT}}_{yy}(x,y,z) = -A_0 \\cos(2\\pi k z),\n    $$\n    with all other components being zero. These are evaluated on the $3$D numerical grid.\n\n    The vector potential $W^i$ is parameterized as:\n    $$\n    W^x(x,y,z) = a_x \\cos(2\\pi k z), \\quad W^y(x,y,z) = a_y \\sin(2\\pi k z), \\quad W^z(x,y,z) = 0.\n    $$\n    Since the problem specifies a conformally flat background ($\\tilde g_{ij} = \\delta_{ij}$), the covariant derivative $\\tilde D_i$ becomes the partial derivative $\\partial_i$. The divergence of the vector potential, $\\tilde D_k W^k = \\partial_k W^k$, is zero due to the chosen functional form of $W^i$ (no dependence on $x$ or $y$, and $W^z=0$). The longitudinal part thus simplifies:\n    $$\n    (L W)_{ij} = \\partial_i W_j + \\partial_j W_i.\n    $$\n    The only non-zero derivatives are $\\partial_z W_x$ and $\\partial_z W_y$, leading to the only non-zero components of $(LW)_{ij}$ being:\n    $$\n    (L W)_{xz} = (L W)_{zx} = \\partial_z W_x = -a_x (2\\pi k) \\sin(2\\pi k z) \\\\\n    (L W)_{yz} = (L W)_{zy} = \\partial_z W_y =  a_y (2\\pi k) \\cos(2\\pi k z)\n    $$\n    Finally, we sum the seed and longitudinal parts to obtain the components of $\\tilde A_{ij} = \\tilde A^{\\mathrm{TT}}_{ij} + (L W)_{ij}$ on the grid.\n\n2.  **Solve the Poisson Equation for the Conformal Factor Perturbation $\\psi$**:\n    We must solve the linear Poisson equation $\\tilde \\Delta \\psi = \\frac{1}{8} \\tilde A_{ij} \\tilde A^{ij}$, where $\\tilde \\Delta$ is the flat Laplacian and $\\tilde A^{ij} = \\delta^{ik}\\delta^{jl} \\tilde A_{kl} = \\tilde A_{ij}$. The source term is $S(x,y,z) = \\frac{1}{8} \\tilde A_{ij} \\tilde A_{ij}$.\n    This is solved efficiently in Fourier space. Let $\\hat{f}$ denote the FFT of a function $f$. The equation becomes:\n    $$\n    \\widehat{(\\tilde \\Delta \\psi)} = - (k_x^2 + k_y^2 + k_z^2) \\hat{\\psi}(\\vec k) = \\hat{S}(\\vec k).\n    $$\n    Here, $\\vec k = (k_x, k_y, k_z)$ is the wavevector. The solution for the Fourier modes of $\\psi$ is:\n    $$\n    \\hat{\\psi}(\\vec k) = -\\frac{\\hat{S}(\\vec k)}{k^2}, \\quad \\text{for } \\vec k \\neq \\vec 0,\n    $$\n    where $k^2 = k_x^2 + k_y^2 + k_z^2$. The $\\vec k = \\vec 0$ mode (the DC component) is set to zero, $\\hat{\\psi}(\\vec 0) = 0$, to enforce the zero-mean condition. Applying an inverse FFT yields $\\psi(x,y,z)$.\n\n3.  **Construct the Physical Extrinsic Curvature $A^{\\mathrm{phys}}_{ij}$**:\n    The physical conformal factor is $\\psi_{\\mathrm{phys}} = 1 + \\psi$. To ensure numerical stability and physical relevance (avoiding spacetime singularities where the metric would vanish), $\\psi_{\\mathrm{phys}}$ is pointwise clamped to a minimum value of $0.5$. The physical traceless extrinsic curvature is then constructed by a conformal rescaling:\n    $$\n    A^{\\mathrm{phys}}_{ij} = \\psi_{\\mathrm{phys}}^{-10} \\tilde A_{ij}.\n    $$\n    This operation is performed pointwise on the grid.\n\n4.  **Compute the Junk Radiation Proxy $J_{\\mathrm{TT}}[W]$**:\n    This requires performing a transverse-traceless projection on $A^{\\mathrm{phys}}_{ij}$. This projection is most easily done in Fourier space. First, we compute the FFT of each component, $\\hat{A}^{\\mathrm{phys}}_{ij}(\\vec k)$.\n\n    Next, we apply the TT projector at each point in the Fourier domain. The projector is defined in terms of the projection tensor $P_{ij}(\\vec k) = \\delta_{ij} - k_i k_j / k^2$ (for $k \\neq 0$). The full TT projection operator on a symmetric tensor $S_{kl}$ is $\\mathcal{P}_{ijkl} = P_{ik} P_{jl} - \\frac{1}{2} P_{ij} P_{kl}$. The TT part of $\\hat{A}^{\\mathrm{phys}}$ is thus:\n    $$\n    \\hat{A}^{\\mathrm{TT}}_{ij}(\\vec k) = \\left(P_{ik} P_{jl} - \\frac{1}{2} P_{ij} P_{kl}\\right) \\hat{A}^{\\mathrm{phys}}_{kl}(\\vec k).\n    $$\n    For $\\vec k=0$, we set $\\hat{A}^{\\mathrm{TT}}_{ij}(\\vec 0) = 0$.\n\n    The junk radiation proxy is the volume-averaged squared norm $J_{\\mathrm{TT}}[W] = \\left\\langle A^{\\mathrm{TT}}_{ij} A^{\\mathrm{TT}}_{ij} \\right\\rangle$. We can compute this efficiently using Parseval's theorem, which relates the sum of squares in real space to the sum of squared magnitudes in Fourier space. For a grid with $N=N_x N_y N_z$ total points:\n    $$\n    J_{\\mathrm{TT}}[W] = \\frac{1}{N^2} \\sum_{\\vec k} \\left( \\hat{A}^{\\mathrm{TT}}_{ij}(\\vec k) \\left(\\hat{A}^{\\mathrm{TT}}_{ij}(\\vec k)\\right)^* \\right),\n    $$\n    where the sum is over all components $i,j$ respecting symmetry ($A_{ij}A_{ij} = A_{xx}^2+A_{yy}^2+A_{zz}^2+2(A_{xy}^2+A_{xz}^2+A_{yz}^2)$) and all wavevectors $\\vec k$.\n\n5.  **Compute the Regularization Term**:\n    The regularization term is $\\left\\langle \\tilde D_i W_j \\, \\tilde D_i W_j \\right\\rangle = \\left\\langle \\partial_i W_j \\, \\partial_i W_j \\right\\rangle$. Given the simple analytical form of $W^i$, this term can be computed analytically. The only non-zero derivatives are $\\partial_z W_x$ and $\\partial_z W_y$. The term to be averaged is $(\\partial_z W_x)^2 + (\\partial_z W_y)^2$:\n    $$\n    (2\\pi k)^2 \\left[ a_x^2 \\sin^2(2\\pi k z) + a_y^2 \\cos^2(2\\pi k z) \\right].\n    $$\n    Since the grid represents an integer number of wavelengths, the spatial average of $\\sin^2(\\cdot)$ and $\\cos^2(\\cdot)$ is exactly $1/2$. The regularization term simplifies to a simple quadratic function of the parameters:\n    $$\n    \\left\\langle \\tilde D_i W_j \\, \\tilde D_i W_j \\right\\rangle = \\frac{(2\\pi k)^2}{2} (a_x^2 + a_y^2).\n    $$\n\n6.  **Optimization**:\n    For each test case, we define an objective function of $(a_x, a_y)$ that computes $J[W]$ as described above. We first evaluate $J_{\\mathrm{TT}}[W]$ at the initial guess $(a_x,a_y)=(0,0)$ to get $J_{\\mathrm{TT}}^{\\mathrm{init}}$. Then, we use a derivative-free optimization algorithm ('Nelder-Mead' from `scipy.optimize`) to find the parameters $(a_x, a_y)_{\\text{opt}}$ that minimize $J[W]$. Finally, we compute $J_{\\mathrm{TT}}^{\\mathrm{opt}}$ using these optimal parameters and calculate the reduction ratio $r = J_{\\mathrm{TT}}^{\\mathrm{opt}} / J_{\\mathrm{TT}}^{\\mathrm{init}}$ (with the special case $r=1.0$ if $J_{\\mathrm{TT}}^{\\mathrm{init}}=0$). The results for all test cases are collected and printed.", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Main function to solve the numerical relativity initial data tuning problem.\n    \"\"\"\n\n    # --- Problem Definition ---\n    # Discretization\n    Nx, Ny, Nz = 16, 16, 32\n    L = 1.0\n\n    # Test cases: (A0, k, lambda, (ax_init, ay_init))\n    test_cases = [\n        (0.05, 1, 0.01, (0.0, 0.0)),\n        (0.10, 2, 0.005, (0.0, 0.0)),\n        (0.00, 1, 0.01, (0.0, 0.0)),\n    ]\n\n    # --- Precompute Grid-Dependent Quantities ---\n    # Real-space grid (only z is needed for inputs)\n    z = np.linspace(0, L, Nz, endpoint=False)\n    _, _, Z = np.meshgrid(np.zeros(Nx), np.zeros(Ny), z, indexing='ij')\n\n    # Fourier-space grid\n    kx_modes = np.fft.fftfreq(Nx) * Nx\n    ky_modes = np.fft.fftfreq(Ny) * Ny\n    kz_modes = np.fft.fftfreq(Nz) * Nz\n    Kx_m, Ky_m, Kz_m = np.meshgrid(kx_modes, ky_modes, kz_modes, indexing='ij')\n\n    Kx = (2 * np.pi / L) * Kx_m\n    Ky = (2 * np.pi / L) * Ky_m\n    Kz = (2 * np.pi / L) * Kz_m\n\n    K_sq = Kx**2 + Ky**2 + Kz**2\n\n    # Fourier-space projector P_ij = delta_ij - k_i k_j / k^2\n    P = np.zeros((3, 3, Nx, Ny, Nz))\n    is_nonzero_k = K_sq  1e-12\n    K_sq_inv_safe = np.zeros_like(K_sq)\n    K_sq_inv_safe[is_nonzero_k] = 1.0 / K_sq[is_nonzero_k]\n\n    K_vec = np.array([Kx, Ky, Kz])\n    P = np.identity(3)[:, :, np.newaxis, np.newaxis, np.newaxis] - \\\n        np.einsum('i...,j...-ij...', K_vec, K_vec) * K_sq_inv_safe\n    P[:, :, ~is_nonzero_k] = 0.0 # Set projector to zero at k=0\n\n    grid_data = {\n        'Z': Z, 'K_sq': K_sq, 'P': P,\n        'Nx': Nx, 'Ny': Ny, 'Nz': Nz\n    }\n\n    # --- Main Calculation Function ---\n    def calculate_J(params, case_data, grid_data, return_J_only=False):\n        ax, ay = params\n        A0, k_wavenum, lambda_reg = case_data\n        \n        Z = grid_data['Z']\n        K_sq = grid_data['K_sq']\n        P = grid_data['P']\n        Nx, Ny, Nz = grid_data['Nx'], grid_data['Ny'], grid_data['Nz']\n        N_total = Nx * Ny * Nz\n\n        # 1. Construct A_tilde_ij on the grid\n        cos_kz = np.cos(2 * np.pi * k_wavenum * Z)\n        sin_kz = np.sin(2 * np.pi * k_wavenum * Z)\n\n        A_tilde = np.zeros((3, 3, Nx, Ny, Nz))\n        A_tilde[0, 0] = A0 * cos_kz  # xx\n        A_tilde[1, 1] = -A0 * cos_kz # yy\n        \n        # Add (LW)_ij part\n        two_pi_k = 2 * np.pi * k_wavenum\n        LW_xz = -ax * two_pi_k * sin_kz\n        LW_yz = ay * two_pi_k * cos_kz\n        A_tilde[0, 2] = LW_xz\n        A_tilde[2, 0] = LW_xz\n        A_tilde[1, 2] = LW_yz\n        A_tilde[2, 1] = LW_yz\n\n        # 2. Solve for psi\n        A_tilde_sq = A_tilde[0,0]**2 + A_tilde[1,1]**2 + A_tilde[2,2]**2 + \\\n                     2 * (A_tilde[0,1]**2 + A_tilde[0,2]**2 + A_tilde[1,2]**2)\n        \n        source = (1. / 8.) * A_tilde_sq\n        source_hat = np.fft.fftn(source)\n        \n        K_sq_inv = np.zeros_like(K_sq)\n        K_sq_inv[K_sq  0] = 1.0 / K_sq[K_sq  0]\n        \n        psi_hat = -source_hat * K_sq_inv\n        psi = np.real(np.fft.ifftn(psi_hat))\n\n        # 3. Construct A_phys_ij\n        psi_phys = 1.0 + psi\n        np.maximum(psi_phys, 0.5, out=psi_phys)\n        psi_inv10 = psi_phys**(-10)\n\n        A_phys = A_tilde * psi_inv10\n\n        # 4. TT projection of A_phys in Fourier space\n        A_phys_hat = np.array([[np.fft.fftn(A_phys[0, 0]), np.fft.fftn(A_phys[0, 1]), np.fft.fftn(A_phys[0, 2])],\n                               [np.fft.fftn(A_phys[1, 0]), np.fft.fftn(A_phys[1, 1]), np.fft.fftn(A_phys[1, 2])],\n                               [np.fft.fftn(A_phys[2, 0]), np.fft.fftn(A_phys[2, 1]), np.fft.fftn(A_phys[2, 2])]])\n        \n        # Apply projector: A_TT_hat = P A_phys_hat P - 0.5 * P * Tr(P A_phys_hat)\n        tr_PA = np.einsum('ij...,ij...-...', P, A_phys_hat)\n        PAP = np.einsum('ik...,kl...,lj...-ij...', P, A_phys_hat, P)\n        A_TT_hat = PAP - 0.5 * P * tr_PA[np.newaxis, np.newaxis, ...]\n        A_TT_hat[:, :, 0, 0, 0] = 0.0\n\n        # 5. Compute J_TT using Parseval's theorem\n        A_TT_hat_norm_sq = np.abs(A_TT_hat[0, 0])**2 + np.abs(A_TT_hat[1, 1])**2 + np.abs(A_TT_hat[2, 2])**2 + \\\n                            2 * (np.abs(A_TT_hat[0, 1])**2 + np.abs(A_TT_hat[0, 2])**2 + np.abs(A_TT_hat[1, 2])**2)\n        \n        J_TT = np.sum(A_TT_hat_norm_sq) / (N_total**2)\n        \n        if return_J_only:\n            return J_TT\n            \n        # 6. Compute regularization term and total J\n        reg_term = ((2 * np.pi * k_wavenum)**2 / 2.0) * (ax**2 + ay**2)\n        J_total = J_TT + lambda_reg * reg_term\n        \n        return J_total\n\n    # --- Loop through test cases ---\n    all_results = []\n    for A0, k, lam, (ax_init, ay_init) in test_cases:\n        case_data = (A0, k, lam)\n        \n        # Calculate initial J_TT\n        J_TT_init = calculate_J((ax_init, ay_init), case_data, grid_data, return_J_only=True)\n        \n        # Define objective function for the optimizer\n        objective_function = lambda p: calculate_J(p, case_data, grid_data)\n        \n        # Minimize J\n        res = minimize(objective_function, x0=[ax_init, ay_init], method='Nelder-Mead')\n        ax_opt, ay_opt = res.x\n        \n        # Calculate optimized J_TT\n        J_TT_opt = calculate_J((ax_opt, ay_opt), case_data, grid_data, return_J_only=True)\n        \n        # Calculate reduction ratio\n        if J_TT_init  1e-18: # Avoid division by zero\n            ratio = J_TT_opt / J_TT_init\n        else:\n            ratio = 1.0\n            \n        all_results.extend([J_TT_init, J_TT_opt, ratio])\n        \n    print(f\"[{','.join(f'{x:.8f}' for x in all_results)}]\")\n\nsolve()\n\n```", "id": "3468531"}]}