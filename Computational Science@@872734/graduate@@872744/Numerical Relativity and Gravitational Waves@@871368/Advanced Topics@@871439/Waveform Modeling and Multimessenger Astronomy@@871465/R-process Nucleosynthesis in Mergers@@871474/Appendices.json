{"hands_on_practices": [{"introduction": "Before r-process nucleosynthesis can occur in a black hole-neutron star merger, a fundamental condition must be met: the neutron star must be tidally torn apart outside the black hole's event horizon. This exercise explores the critical boundary for this process, where the outcome hinges on a delicate balance between the black hole's tidal forces and its powerful gravity, which is strongly influenced by its spin. By combining a classic Newtonian estimate for tidal disruption with the general relativistic description of the innermost stable circular orbit (ISCO), you will determine the critical black hole spin that dictates whether a merger will produce the ejecta needed to synthesize heavy elements or simply swallow the neutron star whole [@problem_id:3484898].", "problem": "A black hole–neutron star binary is modeled in the late inspiral phase assuming a quasi-circular, equatorial, prograde orbit in the Kerr spacetime of the black hole. Consider a black hole (BH) of gravitational mass $M_{\\mathrm{BH}}$ and dimensionless spin parameter $a_{\\ast}$ aligned with the orbital angular momentum, and a neutron star (NS) of gravitational mass $M_{\\mathrm{NS}}$ and circumferential radius $R_{\\mathrm{NS}}$. In the simplest Newtonian estimate, tidal disruption of the NS occurs when the magnitude of the BH’s differential gravitational acceleration across the NS equals the NS surface gravity. Treat the NS as a self-gravitating fluid body and the BH as a point mass source of the tidal field. Under these assumptions, derive the tidal disruption radius $r_{t}$ by equating the leading-order tidal acceleration across the star to the NS surface gravity using only the definitions of gravitational acceleration and its radial gradient.\n\nIn order for dynamically significant ejecta to be launched and an accretion disk to form that can seed rapid neutron-capture process (r-process) nucleosynthesis, the disruption must occur outside the innermost stable circular orbit (ISCO) of the Kerr black hole. Let $r_{\\mathrm{ISCO}}(a_{\\ast})$ denote the prograde equatorial ISCO radius in the Kerr metric. Work in geometric units for the orbital radii comparison by normalizing lengths with the gravitational radius of the BH. Specifically, compare the dimensionless quantity $\\hat{r}_{t} \\equiv r_{t} c^{2}/(G M_{\\mathrm{BH}})$ with the Kerr function $\\hat{r}_{\\mathrm{ISCO}}(a_{\\ast}) \\equiv r_{\\mathrm{ISCO}}(a_{\\ast}) c^{2}/(G M_{\\mathrm{BH}})$. The threshold for disruption outside the ISCO is set by the condition $\\hat{r}_{t} = \\hat{r}_{\\mathrm{ISCO}}(a_{\\ast}^{\\mathrm{crit}})$, which defines the critical spin $a_{\\ast}^{\\mathrm{crit}}$.\n\nAssume the following physically realistic parameters: $M_{\\mathrm{BH}} = 7.0\\,M_{\\odot}$, $M_{\\mathrm{NS}} = 1.40\\,M_{\\odot}$, and $R_{\\mathrm{NS}} = 12.0\\,\\mathrm{km}$. Use the solar mass length scale $G M_{\\odot}/c^{2} = 1.476625\\,\\mathrm{km}$. You may assume the standard general-relativistic expression for the prograde equatorial ISCO radius $\\hat{r}_{\\mathrm{ISCO}}(a_{\\ast})$ in the Kerr metric.\n\nCompute the critical spin $a_{\\ast}^{\\mathrm{crit}}$ such that $\\hat{r}_{t} = \\hat{r}_{\\mathrm{ISCO}}(a_{\\ast}^{\\mathrm{crit}})$ for the given system. Round your answer to four significant figures. The final answer must be expressed as a unitless number.", "solution": "The problem is well-posed and scientifically grounded, resting on fundamental principles of Newtonian gravity for tidal estimates and general relativity for orbital dynamics near a compact object. All provided parameters are physically realistic and sufficient for a unique solution.\n\nThe central task is to find the critical dimensionless spin parameter of the black hole, $a_{\\ast}^{\\mathrm{crit}}$, for a given black hole-neutron star (BH-NS) system. This critical spin is defined by the condition that the tidal disruption radius, $r_t$, is exactly equal to the radius of the innermost stable circular orbit (ISCO), $r_{\\mathrm{ISCO}}$. The problem specifies a simplified Newtonian model for the tidal disruption and the standard general relativistic formula for the ISCO radius of a prograde equatorial orbit in the Kerr metric. The condition is expressed in terms of dimensionless radii, normalized by the black hole's gravitational radius: $\\hat{r}_{t} = \\hat{r}_{\\mathrm{ISCO}}(a_{\\ast}^{\\mathrm{crit}})$.\n\nFirst, we derive the tidal disruption radius, $r_t$, under the given assumptions. We model the black hole as a point mass $M_{\\mathrm{BH}}$ and the neutron star as a self-gravitating fluid body of mass $M_{\\mathrm{NS}}$ and radius $R_{\\mathrm{NS}}$. The gravitational acceleration produced by the black hole at a distance $r$ is given by the Newtonian formula:\n$$a_{\\mathrm{BH}}(r) = \\frac{G M_{\\mathrm{BH}}}{r^2}$$\nThe problem states that tidal disruption occurs when the BH's differential gravitational acceleration across the NS equals the NS's own surface gravity. The \"leading-order tidal acceleration across the star\" is interpreted as the difference in acceleration between the center of the NS and its surface, along the line connecting the two bodies. For a small displacement $R_{\\mathrm{NS}}$ from the center of the NS at an orbital distance $r$, this tidal acceleration can be approximated by the first term in a Taylor series:\n$$\\Delta a_{\\mathrm{tidal}} \\approx R_{\\mathrm{NS}} \\left| \\frac{d a_{\\mathrm{BH}}}{dr} \\right| = R_{\\mathrm{NS}} \\left| \\frac{d}{dr} \\left( \\frac{G M_{\\mathrm{BH}}}{r^2} \\right) \\right| = R_{\\mathrm{NS}} \\left| -\\frac{2 G M_{\\mathrm{BH}}}{r^3} \\right| = \\frac{2 G M_{\\mathrm{BH}} R_{\\mathrm{NS}}}{r^3}$$\nThe surface gravity of the neutron star, which holds it together, is:\n$$g_{\\mathrm{NS}} = \\frac{G M_{\\mathrm{NS}}}{R_{\\mathrm{NS}}^2}$$\nTidal disruption occurs at the radius $r_t$ where these two accelerations are equal:\n$$\\frac{2 G M_{\\mathrm{BH}} R_{\\mathrm{NS}}}{r_t^3} = \\frac{G M_{\\mathrm{NS}}}{R_{\\mathrm{NS}}^2}$$\nSolving for $r_t$, we find:\n$$r_t^3 = \\frac{2 M_{\\mathrm{BH}} R_{\\mathrm{NS}}^3}{M_{\\mathrm{NS}}}$$\n$$r_t = R_{\\mathrm{NS}} \\left( \\frac{2 M_{\\mathrm{BH}}}{M_{\\mathrm{NS}}} \\right)^{1/3}$$\nThis is a simplified form of the Roche limit.\n\nNext, we calculate the dimensionless tidal disruption radius, $\\hat{r}_t = r_t c^2 / (G M_{\\mathrm{BH}})$. We substitute the given physical parameters: $M_{\\mathrm{BH}} = 7.0\\,M_{\\odot}$, $M_{\\mathrm{NS}} = 1.40\\,M_{\\odot}$, and $R_{\\mathrm{NS}} = 12.0\\,\\mathrm{km}$. The mass ratio is $q = M_{\\mathrm{BH}}/M_{\\mathrm{NS}} = 7.0/1.40 = 5$.\n$$r_t = (12.0\\,\\mathrm{km}) \\left( 2 \\times 5 \\right)^{1/3} = 12.0 \\times 10^{1/3}\\,\\mathrm{km}$$\nTo make this dimensionless, we divide by the gravitational radius of the black hole, $R_g = G M_{\\mathrm{BH}}/c^2$. We use the given conversion factor $G M_{\\odot}/c^2 = 1.476625\\,\\mathrm{km}$.\n$$ \\frac{G M_{\\mathrm{BH}}}{c^2} = M_{\\mathrm{BH}} \\left(\\frac{G}{c^2}\\right) = (7.0\\,M_{\\odot}) \\left(\\frac{G}{c^2}\\right) = 7.0 \\left(\\frac{G M_{\\odot}}{c^2}\\right) = 7.0 \\times 1.476625\\,\\mathrm{km} = 10.336375\\,\\mathrm{km} $$\nNow we can compute $\\hat{r}_t$:\n$$\\hat{r}_t = \\frac{r_t}{G M_{\\mathrm{BH}}/c^2} = \\frac{12.0 \\times 10^{1/3}\\,\\mathrm{km}}{10.336375\\,\\mathrm{km}} \\approx 2.50143$$\n\nThe final step is to solve for the critical spin $a_{\\ast}^{\\mathrm{crit}}$ using the condition $\\hat{r}_{\\mathrm{ISCO}}(a_{\\ast}^{\\mathrm{crit}}) = \\hat{r}_t$. The dimensionless radius of the prograde equatorial ISCO in the Kerr metric is given by:\n$$\\hat{r}_{\\mathrm{ISCO}}(a_{\\ast}) = 3 + Z_2 - \\sqrt{(3-Z_1)(3+Z_1+2Z_2)}$$\nwhere\n$$Z_1 = 1 + (1-a_{\\ast}^2)^{1/3} \\left[ (1+a_{\\ast})^{1/3} + (1-a_{\\ast})^{1/3} \\right]$$\n$$Z_2 = \\sqrt{3a_{\\ast}^2 + Z_1^2}$$\nWe must solve the equation $\\hat{r}_{\\mathrm{ISCO}}(a_{\\ast}^{\\mathrm{crit}}) = 2.50143$. This equation is highly non-linear and must be solved numerically. The function $\\hat{r}_{\\mathrm{ISCO}}(a_{\\ast})$ is monotonic for prograde orbits ($a_{\\ast} \\ge 0$), decreasing from $\\hat{r}_{\\mathrm{ISCO}}(0)=6$ (Schwarzschild) to $\\hat{r}_{\\mathrm{ISCO}}(1)=1$ (maximal Kerr). Since our target value $\\hat{r}_t \\approx 2.50143$ lies within this range, a unique solution for $a_{\\ast}^{\\mathrm{crit}} \\in (0,1)$ exists.\n\nWe can solve this by numerical iteration. For example, testing $a_{\\ast} = 0.8$ yields $\\hat{r}_{\\mathrm{ISCO}}(0.8) \\approx 2.906$, and testing $a_{\\ast} = 0.9$ yields $\\hat{r}_{\\mathrm{ISCO}}(0.9) \\approx 2.321$. This brackets the solution between $a_{\\ast}=0.8$ and $a_{\\ast}=0.9$. A more refined numerical search (e.g., using a bisection or Newton-Raphson method) is required.\n\nLet's test a value in this range, such as $a_{\\ast} = 0.8718$:\nFor $a_{\\ast}=0.8718$:\n$a_{\\ast}^2 \\approx 0.760035$\n$1-a_{\\ast}^2 \\approx 0.239965$\n$1+a_{\\ast} = 1.8718$\n$1-a_{\\ast} = 0.1282$\n$Z_1 = 1 + (0.239965)^{1/3} \\left[ (1.8718)^{1/3} + (0.1282)^{1/3} \\right] \\approx 1 + (0.62139) \\left[ 1.23227 + 0.50424 \\right] \\approx 2.07886$\n$Z_2 = \\sqrt{3(0.760035) + (2.07886)^2} \\approx \\sqrt{2.28011 + 4.32169} \\approx 2.56939$\n$\\hat{r}_{\\mathrm{ISCO}}(0.8718) = 3 + 2.56939 - \\sqrt{(3-2.07886)(3+2.07886+2 \\times 2.56939)} \\approx 5.56939 - \\sqrt{(0.92114)(10.21764)} \\approx 5.56939 - \\sqrt{9.4121} \\approx 5.56939 - 3.06792 \\approx 2.50147$\nThis value, $\\hat{r}_{\\mathrm{ISCO}}(0.8718) \\approx 2.50147$, is in excellent agreement with our calculated $\\hat{r}_t \\approx 2.50143$. The difference is negligible.\n\nTherefore, the critical spin value, rounded to four significant figures, is $0.8718$.", "answer": "$$\\boxed{0.8718}$$", "id": "3484898"}, {"introduction": "Numerical relativity simulations produce vast datasets tracking the evolution of matter, but not all outflowing material is destined to escape the system's gravitational pull. This practice introduces the crucial post-processing task of identifying genuinely unbound ejecta using criteria derived from first principles in General Relativity [@problem_id:3484886]. You will implement and compare two standard methods: a simple geodesic criterion suitable for pressureless matter, and a more comprehensive Bernoulli criterion that accounts for the fluid's thermal and pressure energy. This exercise provides direct, hands-on experience in analyzing simulation tracer data and reveals how the choice of unbound criterion can alter predictions for the total ejected mass and its nucleosynthetic potential.", "problem": "You are given discrete tracer data representative of matter elements in post-merger outflows from compact object mergers as modeled in Numerical Relativity (NR). In General Relativity (GR), a common task is to determine whether a fluid element is gravitationally unbound according to two criteria derived from fundamental conservation laws in a stationary spacetime: a geodesic criterion and a hydrodynamic Bernoulli criterion. From a nuclear astrophysics perspective, you must then estimate how these different unboundness criteria change the predicted unbound mass and a proxy for composition relevant to rapid neutron capture (r-process) nucleosynthesis.\n\nFundamental base:\n- In a stationary spacetime with a timelike Killing vector, the covariant time component of the four-velocity, $u_t$, is linked to a conserved energy per unit rest mass for test particles. For ballistic (pressureless) motion, an element is unbound if its specific energy at infinity exceeds unity (in units with the speed of light $c$ equal to $1$), which yields the geodesic unbound condition $u_t lt; -1$.\n- For an adiabatic relativistic fluid where pressure and internal energy are significant, the relativistic Bernoulli constant implies approximate conservation of $h u_t$, where $h$ is the specific enthalpy. In this setting, a fluid element is considered unbound if $h u_t lt; -1$.\n- The specific enthalpy is defined by $h = 1 + \\epsilon + p/\\rho$, where $\\epsilon$ is the specific internal energy, $p$ is the pressure, and $\\rho$ is the rest-mass density. All quantities are measured in relativistic units with $c=G=1$.\n\nDefinitions and tasks:\n- For each tracer $i$ you are given the tuple $(m_i, u_{t,i}, \\epsilon_i, p_i, \\rho_i, Y_{e,i})$, where $m_i$ is the rest-mass weight in solar masses, $u_{t,i}$ is the covariant time component of the four-velocity, $\\epsilon_i$ is the specific internal energy, $p_i$ is the pressure, $\\rho_i$ is the rest-mass density, and $Y_{e,i}$ is the electron fraction. The specific enthalpy is $h_i = 1 + \\epsilon_i + p_i/\\rho_i$.\n- Two unbound flags must be computed per tracer:\n  - Geodesic: $u_{t,i} lt; -1$.\n  - Bernoulli: $h_i u_{t,i} lt; -1$.\n  The inequalities are strict; if equality holds, treat the tracer as bound.\n- For each criterion $C \\in \\{\\mathrm{geodesic}, \\mathrm{Bernoulli}\\}$, compute:\n  1. The total unbound mass $M^{(C)}_{\\mathrm{unb}} = \\sum_{i \\in U_C} m_i$ in solar masses, where $U_C$ is the set of indices flagged unbound by criterion $C$.\n  2. The mass-weighted mean electron fraction $\\langle Y_e \\rangle^{(C)} = \\left(\\sum_{i \\in U_C} m_i Y_{e,i}\\right) \\Big/ \\left(\\sum_{i \\in U_C} m_i\\right)$. If $\\sum_{i \\in U_C} m_i = 0$, define $\\langle Y_e \\rangle^{(C)} = 0$.\n  3. A lanthanide-producing mass fraction proxy $f_{\\mathrm{lan}}^{(C)}$, defined as the fraction of $M^{(C)}_{\\mathrm{unb}}$ with $Y_{e,i} lt; Y_e^{\\mathrm{lan}}$, where $Y_e^{\\mathrm{lan}} = 0.25$. If $\\sum_{i \\in U_C} m_i = 0$, define $f_{\\mathrm{lan}}^{(C)} = 0$.\n- Also compute the mass difference $\\Delta M = M^{(\\mathrm{Bernoulli})}_{\\mathrm{unb}} - M^{(\\mathrm{geodesic})}_{\\mathrm{unb}}$.\n\nPhysical units and numerical conventions:\n- All masses must be expressed in solar masses $M_\\odot$.\n- Use natural units with $c=G=1$.\n- Numerical outputs must be rounded to six decimal places.\n\nTest suite:\n- For each dataset below, the tracer list is a list of tuples of the form $(m_i, u_{t,i}, \\epsilon_i, p_i, \\rho_i, Y_{e,i})$. Your program must compute metrics for each dataset independently.\n\nDataset A (happy path with both criteria differing):\n- Tracers:\n  - (2e-5, -0.95, 0.6, 0.3, 1.0, 0.20)\n  - (1e-5, -1.02, 0.1, 0.05, 1.0, 0.30)\n  - (5e-6, -0.99, 0.8, 0.4, 1.0, 0.18)\n  - (3e-5, -1.10, 0.0, 0.0, 1.0, 0.27)\n  - (8e-6, -0.92, 0.2, 0.1, 1.0, 0.40)\n  - (1.5e-5, -0.88, 0.05, 0.05, 1.0, 0.50)\n  - (4e-6, -1.005, 0.3, 0.2, 1.0, 0.22)\n  - (6e-6, -0.97, 0.6, 0.5, 1.0, 0.24)\n\nDataset B (boundary and near-boundary behavior):\n- Tracers:\n  - (1e-5, -1.0, 0.0, 0.0, 1.0, 0.25)\n  - (1.5e-5, -0.909, 0.05, 0.05, 1.0, 0.24)\n  - (2e-5, -1.001, 0.0, 0.0, 1.0, 0.30)\n  - (8e-6, -0.95, 0.7, 0.3, 1.0, 0.10)\n  - (5e-6, -0.85, 0.2, 0.1, 1.0, 0.35)\n  - (4e-6, -0.8, 0.0, 0.0, 1.0, 0.50)\n\nDataset C (edge case with no unbound ejecta):\n- Tracers:\n  - (1e-5, -0.95, 0.02, 0.01, 1.0, 0.20)\n  - (2e-5, -0.97, 0.0, 0.0, 1.0, 0.28)\n  - (1.2e-5, -0.92, 0.03, 0.02, 1.0, 0.22)\n  - (8e-6, -0.88, 0.10, 0.0, 1.0, 0.40)\n  - (5e-6, -0.80, 0.0, 0.0, 1.0, 0.18)\n\nRequired final output format:\n- For each dataset, produce a list $[M^{(\\mathrm{geod})}_{\\mathrm{unb}}, M^{(\\mathrm{bern})}_{\\mathrm{unb}}, \\Delta M, \\langle Y_e \\rangle^{(\\mathrm{geod})}, \\langle Y_e \\rangle^{(\\mathrm{bern})}, f_{\\mathrm{lan}}^{(\\mathrm{geod})}, f_{\\mathrm{lan}}^{(\\mathrm{bern})}]$, with all floats rounded to six decimal places.\n- Your program should produce a single line of output containing the results for all datasets as a comma-separated list of these per-dataset lists enclosed in square brackets, for example: $[[\\dots],[\\dots],[\\dots]]$.", "solution": "The problem as stated is scientifically sound, self-contained, and well-posed. It presents a standard analysis task in the field of numerical relativity and relativistic astrophysics, specifically concerning the analysis of outflow properties from compact binary mergers. The physical principles, definitions, and computational tasks are clear and based on established literature. We may therefore proceed with a solution.\n\nThe core of the problem is to distinguish between two criteria for identifying gravitationally unbound matter and to quantify the impact of this choice on astrophysical observables relevant to r-process nucleosynthesis. These criteria arise from fundamental conservation laws in General Relativity.\n\nFirst, let us establish the theoretical foundation. In a stationary spacetime, which is a reasonable approximation for the post-merger environment at late times, there exists a timelike Killing vector field, typically denoted as $\\xi^{\\mu}$. In standard coordinate systems far from the central object, this vector is $\\xi^{\\mu} = (1, 0, 0, 0)$. The four-momentum of a particle or fluid element is $p^{\\mu} = m_0 u^{\\mu}$, where $m_0$ is the rest mass and $u^{\\mu}$ is the four-velocity. The quantity $E = -p_{\\mu}\\xi^{\\mu}$ is conserved along the worldline of a test particle. The specific energy (energy per unit rest mass) is therefore $e = -u_{\\mu}\\xi^{\\mu}$. In our chosen coordinates, this simplifies to $e = -u_t$, where $u_t$ is the covariant time component of the four-velocity. For a particle to escape to infinity and have non-negative kinetic energy, its specific energy must be greater than unity (in units where $c=1$). This leads to the condition $e  1$, or $-u_t  1$, which is equivalent to the **geodesic unbound criterion**:\n$$\nu_t  -1\n$$\nThis criterion is appropriate for \"test particles\" or \"ballistic\" ejecta, where pressure and thermal energy are negligible.\n\nHowever, matter ejected from a merger is a hot, dense fluid. The total energy includes contributions from the rest mass, internal (thermal) energy, and the work done by pressure forces. A more general conserved quantity for an adiabatic relativistic fluid, derived from the relativistic Euler equations, is related to the relativistic Bernoulli equation. This conserved quantity along a fluid streamline is approximately $h u_t$, where $h$ is the specific enthalpy. The specific enthalpy is defined as:\n$$\nh = 1 + \\epsilon + \\frac{p}{\\rho}\n$$\nHere, $\\epsilon$ is the specific internal energy, $p$ is the fluid pressure, and $\\rho$ is the rest-mass density. The term $\\epsilon$ accounts for thermal energy, and $p/\\rho$ accounts for the \"potential energy\" of pressure. For a fluid element to be unbound, its total specific energy, including these contributions, must exceed unity at infinity. This gives the **hydrodynamic or Bernoulli unbound criterion**:\n$$\nh u_t  -1\n$$\nSince $\\epsilon$, $p$, and $\\rho$ are non-negative, the specific enthalpy $h \\ge 1$. Consequently, if a fluid element is unbound by the geodesic criterion ($u_t  -1$), it is automatically unbound by the Bernoulli criterion ($h u_t \\le u_t  -1$). The reverse is not true; a fluid element can be geodesically bound ($u_t \\ge -1$) but have sufficient thermal and pressure energy to become unbound via the Bernoulli criterion. This is why we expect $M^{(\\mathrm{Bernoulli})}_{\\mathrm{unb}} \\ge M^{(\\mathrm{geodesic})}_{\\mathrm{unb}}$.\n\nThe problem asks us to compute several quantities for a given set of tracer particles, each representing a fluid element with mass $m_i$. For each criterion $C \\in \\{\\mathrm{geodesic}, \\mathrm{Bernoulli}\\}$, we must compute:\n$1$. The total unbound mass, $M^{(C)}_{\\mathrm{unb}} = \\sum_{i \\in U_C} m_i$, where $U_C$ is the set of tracers satisfying criterion $C$.\n$2$. The mass-weighted mean electron fraction, $\\langle Y_e \\rangle^{(C)}$, which is a proxy for the resulting nucleosynthetic abundance pattern. It is calculated as $\\langle Y_e \\rangle^{(C)} = (\\sum_{i \\in U_C} m_i Y_{e,i}) / M^{(C)}_{\\mathrm{unb}}$.\n$3$. A proxy for the mass fraction of lanthanide-producing material, $f_{\\mathrm{lan}}^{(C)}$. This is the fraction of unbound mass with an electron fraction $Y_{e,i}$ below a threshold $Y_e^{\\mathrm{lan}} = 0.25$, as very neutron-rich conditions ($Y_e  0.25$) are required to produce the heaviest r-process elements (lanthanides and actinides). It is calculated as $f_{\\mathrm{lan}}^{(C)} = (\\sum_{i \\in U_C, Y_{e,i}  Y_e^{\\mathrm{lan}}} m_i) / M^{(C)}_{\\mathrm{unb}}$.\n\nThe computational procedure is as follows:\n$1$. For each dataset, initialize accumulators for the total unbound mass, the mass-weighted $Y_e$ numerator, and the lanthanide-producing mass for both the geodesic and Bernoulli criteria. All are initialized to $0$.\n$2$. Iterate through each tracer $i$ with its properties $(m_i, u_{t,i}, \\epsilon_i, p_i, \\rho_i, Y_{e,i})$.\n$3$. For each tracer, evaluate the two unbound criteria. The problem specifies strict inequalities.\n    a. **Geodesic criterion**: Check if $u_{t,i}  -1$. If true, the tracer is geodesically unbound.\n    b. **Bernoulli criterion**: First compute the specific enthalpy $h_i = 1 + \\epsilon_i + p_i/\\rho_i$. Then, check if $h_i u_{t,i}  -1$. If true, the tracer is unbound according to the Bernoulli criterion.\n$4$. If a tracer is found to be unbound by the geodesic criterion, its mass $m_i$ is added to $M^{(\\mathrm{geodesic})}_{\\mathrm{unb}}$, the product $m_i Y_{e,i}$ is added to the corresponding $Y_e$ numerator, and if $Y_{e,i}  0.25$, its mass $m_i$ is also added to the lanthanide mass accumulator for the geodesic criterion.\n$5$. The same procedure is followed independently for the Bernoulli criterion.\n$6$. After all tracers in a dataset have been processed, calculate the final quantities. For each criterion $C$:\n    a. If $M^{(C)}_{\\mathrm{unb}}  0$, compute $\\langle Y_e \\rangle^{(C)}$ and $f_{\\mathrm{lan}}^{(C)}$ by dividing the accumulated sums by $M^{(C)}_{\\mathrm{unb}}$.\n    b. If $M^{(C)}_{\\mathrm{unb}} = 0$, both $\\langle Y_e \\rangle^{(C)}$ and $f_{\\mathrm{lan}}^{(C)}$ are defined to be $0$.\n$7$. Compute the difference in unbound mass: $\\Delta M = M^{(\\mathrm{Bernoulli})}_{\\mathrm{unb}} - M^{(\\mathrm{geodesic})}_{\\mathrm{unb}}$.\n$8$. Collect the seven values ($M^{(\\mathrm{geod})}_{\\mathrm{unb}}, M^{(\\mathrm{bern})}_{\\mathrm{unb}}, \\Delta M, \\langle Y_e \\rangle^{(\\mathrm{geod})}, \\langle Y_e \\rangle^{(\\mathrm{bern})}, f_{\\mathrm{lan}}^{(\\mathrm{geod})}, f_{\\mathrm{lan}}^{(\\mathrm{bern})}$), round each to six decimal places, and format them as required. This process is repeated for all provided datasets.", "answer": "```python\nimport numpy as np\n# from scipy import ... # Not required for this problem.\n\ndef solve():\n    \"\"\"\n    Processes tracer data from numerical relativity simulations to\n    calculate unbound mass and composition proxies based on two\n    different unboundness criteria.\n    \"\"\"\n    datasets = [\n        # Dataset A\n        [\n            (2e-5, -0.95, 0.6, 0.3, 1.0, 0.20),\n            (1e-5, -1.02, 0.1, 0.05, 1.0, 0.30),\n            (5e-6, -0.99, 0.8, 0.4, 1.0, 0.18),\n            (3e-5, -1.10, 0.0, 0.0, 1.0, 0.27),\n            (8e-6, -0.92, 0.2, 0.1, 1.0, 0.40),\n            (1.5e-5, -0.88, 0.05, 0.05, 1.0, 0.50),\n            (4e-6, -1.005, 0.3, 0.2, 1.0, 0.22),\n            (6e-6, -0.97, 0.6, 0.5, 1.0, 0.24),\n        ],\n        # Dataset B\n        [\n            (1e-5, -1.0, 0.0, 0.0, 1.0, 0.25),\n            (1.5e-5, -0.909, 0.05, 0.05, 1.0, 0.24),\n            (2e-5, -1.001, 0.0, 0.0, 1.0, 0.30),\n            (8e-6, -0.95, 0.7, 0.3, 1.0, 0.10),\n            (5e-6, -0.85, 0.2, 0.1, 1.0, 0.35),\n            (4e-6, -0.8, 0.0, 0.0, 1.0, 0.50),\n        ],\n        # Dataset C\n        [\n            (1e-5, -0.95, 0.02, 0.01, 1.0, 0.20),\n            (2e-5, -0.97, 0.0, 0.0, 1.0, 0.28),\n            (1.2e-5, -0.92, 0.03, 0.02, 1.0, 0.22),\n            (8e-6, -0.88, 0.10, 0.0, 1.0, 0.40),\n            (5e-6, -0.80, 0.0, 0.0, 1.0, 0.18),\n        ],\n    ]\n\n    Y_e_lan_threshold = 0.25\n    all_results = []\n\n    for tracers in datasets:\n        # Initialize accumulators for geodesic criterion\n        m_unb_geod = 0.0\n        m_ye_num_geod = 0.0\n        m_lan_geod = 0.0\n\n        # Initialize accumulators for Bernoulli criterion\n        m_unb_bern = 0.0\n        m_ye_num_bern = 0.0\n        m_lan_bern = 0.0\n\n        for m_i, u_t_i, eps_i, p_i, rho_i, Ye_i in tracers:\n            # Geodesic unbound criterion: u_t  -1\n            if u_t_i  -1.0:\n                m_unb_geod += m_i\n                m_ye_num_geod += m_i * Ye_i\n                if Ye_i  Y_e_lan_threshold:\n                    m_lan_geod += m_i\n\n            # Bernoulli unbound criterion: h * u_t  -1\n            h_i = 1.0 + eps_i + p_i / rho_i\n            if h_i * u_t_i  -1.0:\n                m_unb_bern += m_i\n                m_ye_num_bern += m_i * Ye_i\n                if Ye_i  Y_e_lan_threshold:\n                    m_lan_bern += m_i\n\n        # --- Final calculations for the dataset ---\n\n        # Geodesic metrics\n        if m_unb_geod  0:\n            avg_Ye_geod = m_ye_num_geod / m_unb_geod\n            f_lan_geod = m_lan_geod / m_unb_geod\n        else:\n            avg_Ye_geod = 0.0\n            f_lan_geod = 0.0\n\n        # Bernoulli metrics\n        if m_unb_bern  0:\n            avg_Ye_bern = m_ye_num_bern / m_unb_bern\n            f_lan_bern = m_lan_bern / m_unb_bern\n        else:\n            avg_Ye_bern = 0.0\n            f_lan_bern = 0.0\n        \n        # Mass difference\n        delta_M = m_unb_bern - m_unb_geod\n\n        dataset_results = [\n            m_unb_geod,\n            m_unb_bern,\n            delta_M,\n            avg_Ye_geod,\n            avg_Ye_bern,\n            f_lan_geod,\n            f_lan_bern,\n        ]\n        all_results.append(dataset_results)\n\n    # Format the final output string according to the specification\n    formatted_dataset_strings = []\n    for res_list in all_results:\n        # Format each number to 6 decimal places as a fixed-point string\n        formatted_numbers = [f\"{num:.6f}\" for num in res_list]\n        formatted_dataset_strings.append(f\"[{','.join(formatted_numbers)}]\")\n    \n    final_output_string = f\"[{','.join(formatted_dataset_strings)}]\"\n    print(final_output_string)\n\nsolve()\n```", "id": "3484886"}, {"introduction": "The matter ejected from a neutron star merger is not a monolithic outflow but a complex mixture of components launched by different physical mechanisms, each with its own thermodynamic history and nucleosynthetic fate. This exercise simulates the research task of dissecting simulation data to separate the cold, neutron-rich \"tidal\" ejecta from the hot, less neutron-rich \"shock-driven\" ejecta [@problem_id:3484926]. By developing a classification algorithm based on physical proxies like entropy and ejection angle, you will quantify the contribution of each channel and map them to distinct r-process abundance patterns. This practice illuminates the direct link between merger dynamics and the diverse nucleosynthetic signatures observed in kilonovae.", "problem": "You are given idealized tracer particle summaries from three independent Numerical Relativity (NR) simulations of binary neutron star mergers with specified mass ratios. Your task is to design and implement a principled algorithm that separates ejecta into tidally stripped versus shock-driven contributions using tracer particle properties, then map each channel onto a distinct rapid neutron capture (r-process) abundance pattern category using a physically motivated diagnostic based on the electron fraction. The scenario is framed within numerical relativity and gravitational-wave astrophysics, focusing on how the merger dynamics and mass ratio influence the thermodynamic conditions of the ejected matter and thereby the r-process yields.\n\nFundamental base and constraints to be used:\n- Fluid shocks across a discontinuity obey conservation of mass, momentum, and energy and produce irreversible entropy increases. Therefore, shock-processed material tends to have higher entropy than tidally stripped material. Let the per-particle specific entropy be denoted by $s$ in units of Boltzmann constant per baryon.\n- Tidal ejecta are launched primarily from the equatorial plane due to gravitational and centrifugal forces and are typically cooler and of lower entropy, while shock-driven ejecta can emerge more strongly toward the polar directions and undergo higher peak temperatures due to shock heating. Let the polar angle of ejection be denoted by $\\theta$ in radians, with $\\theta = 0$ at the north pole and $\\theta = \\pi$ at the south pole, and the equatorial plane at $\\theta = \\pi/2$.\n- The electron fraction $Y_e$ sets the proton fraction under charge neutrality and thus the neutron-to-seed ratio available for rapid neutron capture. Heavy r-process up to the third peak requires a sufficiently neutron-rich composition, which is attainable for low $Y_e$. Use this principle to define a category map based on mass-weighted mean $Y_e$ for each ejecta channel.\n- Assume the provided tracer particle sets represent unbound ejecta (so no bound/unbound filtering is needed). Each tracer has properties: mass $m$ (in solar masses $M_\\odot$), electron fraction $Y_e$ (dimensionless), specific entropy $s$ (in $k_B$ per baryon), peak temperature $T_{\\mathrm{peak}}$ (in giga-Kelvin), polar angle $\\theta$ (in radians), and an asymptotic velocity $v$ (in kilometers per second). Angles must be used in radians.\n\nClassification rules to implement from first principles:\n- A tracer is classified as shock-driven if any of the following conditions is met, reflecting shock heating and/or polar emergence:\n  1. $s \\ge s_{\\mathrm{thr}}$, where $s_{\\mathrm{thr}} = 12$.\n  2. $T_{\\mathrm{peak}} \\ge T_{\\mathrm{thr}}$, where $T_{\\mathrm{thr}} = 5$ (in giga-Kelvin).\n  3. The tracer emerges within a polar cap: $\\min(\\theta, |\\pi - \\theta|) \\le \\theta_{\\mathrm{polar}}$, where $\\theta_{\\mathrm{polar}} = 0.35$ (radians).\n- Otherwise, classify the tracer as tidally stripped.\n\nR-process abundance pattern mapping using $Y_e$:\n- For each channel (tidal or shock), compute the mass-weighted mean electron fraction $\\langle Y_e \\rangle$ from the tracers in that channel. Define three discrete abundance pattern categories:\n  - Heavy r-process (robust, third-peak capable): if $\\langle Y_e \\rangle  0.25$, encode as integer $2$.\n  - Weak r-process (up to second peak): if $0.25 \\le \\langle Y_e \\rangle  0.35$, encode as integer $1$.\n  - Negligible heavy r-process (light trans-iron only): if $\\langle Y_e \\rangle \\ge 0.35$, encode as integer $0$.\n- If a channel contains zero mass, encode the category as integer $-1$.\n\nOutputs to produce per test case:\n- The mass fraction of tidally stripped ejecta $f_{\\mathrm{tidal}} = M_{\\mathrm{tidal}} / M_{\\mathrm{tot}}$ and shock-driven ejecta $f_{\\mathrm{shock}} = M_{\\mathrm{shock}} / M_{\\mathrm{tot}}$, where $M_{\\mathrm{tot}} = M_{\\mathrm{tidal}} + M_{\\mathrm{shock}}$.\n- The abundance category codes for the tidal channel $C_{\\mathrm{tidal}}$ and shock channel $C_{\\mathrm{shock}}$ as defined above.\n- Express $f_{\\mathrm{tidal}}$ and $f_{\\mathrm{shock}}$ as decimals rounded to six decimal places. The category codes are integers. Angles must be interpreted in radians. No output units are required for the final list as fractions and codes are dimensionless.\n\nTest suite:\nProvide the following three test cases, each containing a mass ratio $q$ and an explicit list of tracers. Your program must only use the tracer properties and the rules above; $q$ is provided for context and should not be used directly in computations. All angles $\\theta$ are in radians; all temperatures $T_{\\mathrm{peak}}$ are in giga-Kelvin; velocities $v$ are in kilometers per second; masses $m$ are in solar masses $M_\\odot$.\n\n- Test case $1$, mass ratio $q = 1.0$:\n  Tracers $\\{(m, Y_e, s, T_{\\mathrm{peak}}, \\theta, v)\\}$:\n  1. (6e-5, 0.32, 22, 7.0, 0.25, 15000)\n  2. (4e-5, 0.30, 18, 6.0, 0.40, 14000)\n  3. (5e-5, 0.36, 25, 8.0, 2.90, 16000)\n  4. (3e-5, 0.28, 15, 5.5, 0.50, 13500)\n  5. (2e-5, 0.40, 20, 6.5, 3.00, 17000)\n  6. (2e-5, 0.18, 8, 3.5, 1.50, 9000)\n  7. (3e-5, 0.22, 10, 4.0, 1.60, 9500)\n  8. (1.5e-5, 0.20, 9, 3.8, 1.70, 9200)\n  9. (1.2e-5, 0.15, 7, 3.2, 1.55, 8800)\n  10. (1e-5, 0.24, 11, 4.2, 1.57, 9100)\n\n- Test case $2$, mass ratio $q = 0.85$:\n  Tracers:\n  1. (2.5e-5, 0.33, 19, 6.2, 0.30, 14500)\n  2. (1.8e-5, 0.31, 16, 5.4, 2.95, 15000)\n  3. (3.0e-5, 0.21, 9, 3.6, 1.45, 9400)\n  4. (2.2e-5, 0.17, 7, 3.2, 1.60, 8700)\n  5. (2.8e-5, 0.23, 10, 4.0, 1.70, 9600)\n  6. (2.0e-5, 0.19, 8, 3.7, 1.55, 9300)\n  7. (1.6e-5, 0.27, 11, 4.5, 1.60, 9800)\n  8. (1.2e-5, 0.20, 9, 3.9, 1.50, 9100)\n  9. (0.9e-5, 0.22, 10, 4.1, 1.58, 9000)\n\n- Test case $3$, mass ratio $q = 0.60$:\n  Tracers:\n  1. (0.7e-5, 0.34, 18, 5.2, 0.20, 15500)\n  2. (4.0e-5, 0.12, 6, 3.0, 1.60, 8800)\n  3. (3.5e-5, 0.20, 9, 3.8, 1.50, 9200)\n  4. (2.8e-5, 0.25, 10, 4.1, 1.57, 9400)\n  5. (2.2e-5, 0.18, 8, 3.6, 1.45, 9000)\n  6. (1.5e-5, 0.10, 5, 2.8, 1.70, 8500)\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case in order, append the four values $[f_{\\mathrm{tidal}}, f_{\\mathrm{shock}}, C_{\\mathrm{tidal}}, C_{\\mathrm{shock}}]$, using six-decimal rounding for the fractions and integers for the codes, so that the final output aggregates all test cases into one flat list (for three test cases, $12$ values total).", "solution": "The problem requires the development of a principled algorithm to analyze tracer particle data from numerical relativity simulations of binary neutron star mergers. The objective is to partition the ejecta into two distinct formation channels—tidally stripped and shock-driven—and subsequently to classify the nucleosynthetic output of each channel. This analysis is to be performed on three provided test cases, each representing a merger with a different mass ratio. The entire procedure must be based on fundamental physical principles of hydrodynamics and nuclear astrophysics, as codified by a set of explicit rules.\n\nThe algorithmic approach is structured in three primary stages, which directly map the physical principles onto computational steps.\n\n1.  **Ejecta Channel Classification:** The first stage involves classifying each tracer particle as either part of the tidal ejecta or the shock-driven ejecta. This distinction is physically motivated by the different mechanisms that unbind matter from the system.\n    -   **Tidal Ejecta:** During the late inspiral and merger, gravitational tidal forces can strip matter from the outer layers of the neutron stars. This material is typically flung out into the equatorial plane, and because it does not undergo strong shock compression, it remains relatively cold and has low specific entropy.\n    -   **Shock-Driven Ejecta:** At the point of collision, or in the post-merger remnant, strong hydrodynamic shocks can form. Matter passing through these shocks is heated to high temperatures, resulting in an irreversible increase in its specific entropy, denoted by $s$. This hot, high-entropy material is often ejected in bipolar, off-equatorial directions.\n\n    Based on these principles, we establish a set of quantitative criteria. A tracer particle with properties ($m_i$, $Y_{e,i}$, $s_i$, $T_{\\mathrm{peak},i}$, $\\theta_i$, $v_i$) is classified as **shock-driven** if it satisfies any of the following conditions, which are proxies for having experienced significant shock heating or a polar ejection trajectory:\n    1.  The specific entropy $s_i$ is greater than or equal to a threshold $s_{\\mathrm{thr}} = 12$ $k_B$ per baryon.\n    2.  The peak temperature experienced by the fluid element, $T_{\\mathrm{peak},i}$, is greater than or equal to a threshold $T_{\\mathrm{thr}} = 5$ giga-Kelvin.\n    3.  The ejection angle $\\theta_i$ is within a specified polar cone. The condition is given as $\\min(\\theta_i, |\\pi - \\theta_i|) \\le \\theta_{\\mathrm{polar}}$, where the polar angle cutoff is $\\theta_{\\mathrm{polar}} = 0.35$ radians. This is equivalent to being ejected near the north pole ($\\theta_i \\le \\theta_{\\mathrm{polar}}$) or the south pole ($\\theta_i \\ge \\pi - \\theta_{\\mathrm{polar}}$).\n\n    Any tracer particle that does not meet any of these conditions is, by exclusion, classified as **tidally stripped**. This process partitions the full set of tracers into two disjoint subsets, $S_{\\mathrm{tidal}}$ and $S_{\\mathrm{shock}}$.\n\n2.  **Mass Fraction Computation:** Once all tracers are classified, the next step is to compute the total mass associated with each channel and their respective fractions relative to the total ejecta mass.\n    -   The total mass of tidal ejecta is $M_{\\mathrm{tidal}} = \\sum_{i \\in S_{\\mathrm{tidal}}} m_i$.\n    -   The total mass of shock-driven ejecta is $M_{\\mathrm{shock}} = \\sum_{i \\in S_{\\mathrm{shock}}} m_i$.\n    -   The total ejecta mass is $M_{\\mathrm{tot}} = M_{\\mathrm{tidal}} + M_{\\mathrm{shock}}$.\n    -   The corresponding mass fractions are $f_{\\mathrm{tidal}} = M_{\\mathrm{tidal}} / M_{\\mathrm{tot}}$ and $f_{\\mathrm{shock}} = M_{\\mathrm{shock}} / M_{\\mathrm{tot}}$. By definition, $f_{\\mathrm{tidal}} + f_{\\mathrm{shock}} = 1$.\n\n3.  **R-Process Abundance Pattern Mapping:** The final stage connects the thermodynamic history of the ejecta to its expected nucleosynthetic yield. The key parameter governing the outcome of the rapid neutron-capture process (r-process) is the electron fraction, $Y_e$, which is the number of protons per baryon. In charge-neutral, neutron-rich matter, a low $Y_e$ implies a high neutron-to-proton ratio, which is essential for synthesizing the heaviest r-process elements up to the third peak (e.g., gold, platinum).\n    -   We calculate the mass-weighted mean electron fraction for each channel:\n        $$ \\langle Y_e \\rangle_{\\mathrm{channel}} = \\frac{\\sum_{i \\in S_{\\mathrm{channel}}} m_i Y_{e,i}}{\\sum_{i \\in S_{\\mathrm{channel}}} m_i} $$\n    -   Based on this single diagnostic quantity, we map each channel to one of three r-process categories, which are assigned integer codes. The thresholds are physically motivated:\n        -   **Heavy r-process (Code $2$):** If $\\langle Y_e \\rangle  0.25$. Such neutron-rich conditions robustly produce all r-process elements up to the third peak.\n        -   **Weak r-process (Code $1$):** If $0.25 \\le \\langle Y_e \\rangle  0.35$. These less neutron-rich conditions typically produce elements up to the second r-process peak but fail to produce significant quantities of the heaviest elements.\n        -   **Negligible heavy r-process (Code $0$):** If $\\langle Y_e \\rangle \\ge 0.35$. In such proton-rich matter, the r-process is suppressed, and only lighter, trans-iron elements are synthesized.\n    -   A special code of $-1$ is assigned if a channel contains zero mass, i.e., if $M_{\\mathrm{tidal}} = 0$ or $M_{\\mathrm{shock}} = 0$.\n\nThe algorithm consists of applying these three steps sequentially to each test case. For each case, we iterate through its list of tracer particles, perform the classification, compute the total masses and fractions, calculate the mass-weighted mean electron fractions for the tidal and shock subsets, and finally determine the integer category codes. The required outputs for each test case are the tuple ($f_{\\mathrm{tidal}}$, $f_{\\mathrm{shock}}$, $C_{\\mathrm{tidal}}$, $C_{\\mathrm{shock}}$), with the fractions rounded to six decimal places. The final result is an aggregation of these tuples from all test cases into a single flat list.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of classifying ejecta and mapping r-process patterns\n    for given tracer particle data from binary neutron star merger simulations.\n    \"\"\"\n    \n    # Fundamental constant and thresholds from the problem statement\n    s_thr = 12.0  # k_B per baryon\n    T_thr = 5.0   # Giga-Kelvin\n    theta_polar = 0.35  # radians\n\n    # Test suite data: Each case is a list of tuples, where each tuple represents\n    # a tracer particle: (m, Y_e, s, T_peak, theta, v)\n    test_cases = [\n        # Test case 1, q = 1.0\n        [\n            (6e-5, 0.32, 22, 7.0, 0.25, 15000),\n            (4e-5, 0.30, 18, 6.0, 0.40, 14000),\n            (5e-5, 0.36, 25, 8.0, 2.90, 16000),\n            (3e-5, 0.28, 15, 5.5, 0.50, 13500),\n            (2e-5, 0.40, 20, 6.5, 3.00, 17000),\n            (2e-5, 0.18, 8, 3.5, 1.50, 9000),\n            (3e-5, 0.22, 10, 4.0, 1.60, 9500),\n            (1.5e-5, 0.20, 9, 3.8, 1.70, 9200),\n            (1.2e-5, 0.15, 7, 3.2, 1.55, 8800),\n            (1e-5, 0.24, 11, 4.2, 1.57, 9100)\n        ],\n        # Test case 2, q = 0.85\n        [\n            (2.5e-5, 0.33, 19, 6.2, 0.30, 14500),\n            (1.8e-5, 0.31, 16, 5.4, 2.95, 15000),\n            (3.0e-5, 0.21, 9, 3.6, 1.45, 9400),\n            (2.2e-5, 0.17, 7, 3.2, 1.60, 8700),\n            (2.8e-5, 0.23, 10, 4.0, 1.70, 9600),\n            (2.0e-5, 0.19, 8, 3.7, 1.55, 9300),\n            (1.6e-5, 0.27, 11, 4.5, 1.60, 9800),\n            (1.2e-5, 0.20, 9, 3.9, 1.50, 9100),\n            (0.9e-5, 0.22, 10, 4.1, 1.58, 9000)\n        ],\n        # Test case 3, q = 0.60\n        [\n            (0.7e-5, 0.34, 18, 5.2, 0.20, 15500),\n            (4.0e-5, 0.12, 6, 3.0, 1.60, 8800),\n            (3.5e-5, 0.20, 9, 3.8, 1.50, 9200),\n            (2.8e-5, 0.25, 10, 4.1, 1.57, 9400),\n            (2.2e-5, 0.18, 8, 3.6, 1.45, 9000),\n            (1.5e-5, 0.10, 5, 2.8, 1.70, 8500)\n        ]\n    ]\n\n    final_results = []\n    \n    for case_tracers in test_cases:\n        tidal_tracers = []\n        shock_tracers = []\n\n        # Step 1: Classify each tracer\n        for tracer in case_tracers:\n            m, Ye, s, T_peak, theta, v = tracer\n            # Condition for being shock-driven\n            is_shock = (s = s_thr) or \\\n                       (T_peak = T_thr) or \\\n                       (min(theta, abs(np.pi - theta)) = theta_polar)\n            \n            if is_shock:\n                shock_tracers.append(tracer)\n            else:\n                tidal_tracers.append(tracer)\n        \n        # Step 2: Compute mass fractions\n        M_tidal = sum(t[0] for t in tidal_tracers)\n        M_shock = sum(t[0] for t in shock_tracers)\n        M_tot = M_tidal + M_shock\n\n        if M_tot  0:\n            f_tidal = M_tidal / M_tot\n            f_shock = M_shock / M_tot\n        else: # Handle case with no tracers\n            f_tidal, f_shock = 0.0, 0.0\n\n        # Step 3: Determine R-process category codes\n        def get_category_code(tracers, total_mass):\n            if total_mass == 0:\n                return -1\n            \n            # Calculate mass-weighted mean electron fraction\n            sum_m_Ye = sum(t[0] * t[1] for t in tracers)\n            mean_Ye = sum_m_Ye / total_mass\n            \n            if mean_Ye  0.25:\n                return 2  # Heavy r-process\n            elif mean_Ye  0.35:\n                return 1  # Weak r-process\n            else:\n                return 0  # Negligible heavy r-process\n\n        C_tidal = get_category_code(tidal_tracers, M_tidal)\n        C_shock = get_category_code(shock_tracers, M_shock)\n        \n        # Append results for this case to the final list\n        final_results.extend([\n            round(f_tidal, 6),\n            round(f_shock, 6),\n            C_tidal,\n            C_shock\n        ])\n\n    # Print the final aggregated list in the required format\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```", "id": "3484926"}]}