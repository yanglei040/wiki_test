## Introduction
The formation and evolution of galaxies are among the most complex processes in the cosmos, governed by an intricate dance between gravity, gas dynamics, star formation, and powerful [feedback mechanisms](@entry_id:269921). Modern [cosmological simulations](@entry_id:747925) are our primary tool for untangling this complexity, but they face a fundamental challenge: the physics driving feedback from [supernovae](@entry_id:161773) (SN) and [active galactic nuclei](@entry_id:158029) (AGN) occurs on scales millions of times smaller than the galaxies themselves. Directly resolving these events is computationally impossible, leading to numerical artifacts like the "overcooling problem" where feedback energy is lost before it can do its work. This knowledge gap necessitates the use of [subgrid models](@entry_id:755601)â€”sophisticated algorithmic descriptions of unresolved physics that are essential for creating realistic virtual universes.

This article provides a comprehensive overview of the theory, implementation, and application of these crucial models. In the following chapters, you will gain a deep understanding of this vital area of [computational astrophysics](@entry_id:145768). "Principles and Mechanisms" will dissect the core physics of SN and AGN feedback and the numerical strategies used to model them, from [energy coupling](@entry_id:137595) to tackling resolution-dependent effects. "Applications and Interdisciplinary Connections" will demonstrate how these models are used to investigate the [baryon cycle](@entry_id:158799), the multiphase interstellar medium, and galactic [chemical evolution](@entry_id:144713), bridging theory with observation. Finally, "Hands-On Practices" will offer practical exercises to solidify your understanding of key numerical challenges and modeling techniques, equipping you with the foundational knowledge to critically assess and develop the next generation of feedback models.

## Principles and Mechanisms

The successful modeling of galaxy formation hinges on accurately capturing the complex interplay between gravitational collapse, gas cooling, star formation, and feedback processes. As introduced in the previous chapter, feedback from supernovae (SN) and [active galactic nuclei](@entry_id:158029) (AGN) is crucial for regulating [star formation](@entry_id:160356), driving galactic outflows, and shaping the observed properties of galaxies. However, the physical processes governing feedback occur on scales far smaller than what can be directly resolved in large-scale [cosmological simulations](@entry_id:747925). This fundamental scale mismatch necessitates the development of **[subgrid models](@entry_id:755601)**: physically-motivated, parameterized descriptions of unresolved physics that can be incorporated into the numerical framework of a simulation. This chapter delves into the core principles and mechanisms underlying these essential models.

### The Scale Mismatch: Why Subgrid Models are Essential

A central challenge in [computational cosmology](@entry_id:747605) is the immense [dynamic range](@entry_id:270472) of scales involved. A simulation might model a cubic volume hundreds of megaparsecs on a side, while the crucial physics of feedback originates on scales of parsecs or smaller. For instance, the evolution of a single [supernova](@entry_id:159451) remnant is a complex hydrodynamic process. In its initial, energy-conserving phase, its expansion is described by the **Sedov-Taylor [similarity solution](@entry_id:152126)**. This analytical model predicts that the radius $R(t)$ of the [blast wave](@entry_id:199561) evolves as $R(t) \propto (E_{\mathrm{SN}}/\rho)^{1/5} t^{2/5}$, where $E_{\mathrm{SN}}$ is the explosion energy and $\rho$ is the ambient density [@problem_id:3491430]. A typical [supernova](@entry_id:159451) remnant reaches a radius of a few parsecs in about 100 years. In a galaxy-scale simulation where the spatial resolution $\Delta x$ might be hundreds of parsecs and the timestep $\Delta t$ is thousands or millions of years, the entire Sedov-Taylor phase is unresolved. A naive injection of thermal energy into a single grid cell would be numerically and physically inaccurate.

This issue is compounded by the **overcooling problem**. In dense regions of the interstellar medium (ISM), the [radiative cooling](@entry_id:754014) time can be extremely short. If feedback energy is injected in small increments or into a medium that can radiate it away faster than it can do mechanical work, the feedback becomes numerically inefficient. The injected energy is lost from the system without producing the desired physical effect, such as driving an outflow. This artificial loss of energy can lead to runaway star formation and overly massive, compact galaxies that starkly disagree with observations.

Subgrid models are the essential bridge across this scale gap. They are not merely "fudge factors," but rather algorithmic implementations of physical laws and phenomenological relations that encapsulate the net effect of unresolved processes on the resolved scales of the simulation.

### Fundamental Components of Feedback Models

A subgrid feedback model can be deconstructed into two primary components: a prescription for the source of energy and momentum, and a prescription for how these quantities are coupled to the resolved gas in the simulation.

#### Sources of Energy and Momentum

**Supernovae (SN):** Core-collapse [supernovae](@entry_id:161773) mark the end of life for [massive stars](@entry_id:159884) ($M \gtrsim 8 M_{\odot}$). They are a primary source of feedback in star-forming galaxies. For a given stellar population formed in a simulation, the total energy and momentum injected can be estimated by integrating over an initial [mass function](@entry_id:158970) (IMF).
-   **Energy:** A typical core-collapse [supernova](@entry_id:159451) releases approximately $E_{\mathrm{SN}} \approx 10^{51}$ ergs ($10^{44}$ J) of kinetic energy. The expected number of [supernovae](@entry_id:161773) per unit [stellar mass](@entry_id:157648) formed, $\xi_{\mathrm{SN}}$, is of order $1$ per $100\, M_{\odot}$, or $\xi_{\mathrm{SN}} \approx 0.01\, M_{\odot}^{-1}$. This yields a [specific energy](@entry_id:271007) budget of $e_{\mathrm{SN}} \approx 10^{49}\, \mathrm{erg}\, M_{\odot}^{-1}$ ($10^{42}\, \mathrm{J}\, M_{\odot}^{-1}$) [@problem_id:3491419].
-   **Momentum:** While the initial ejecta have enormous momentum, the most dynamically important quantity is the terminal momentum of the [supernova](@entry_id:159451) remnant after it has swept up a significant amount of ambient ISM. This momentum is substantially larger than the ejecta's initial momentum due to the work done by the hot, pressurized bubble. The terminal radial momentum is often quoted as a key parameter, with typical values around $p_0 \approx 3 \times 10^5 \, M_{\odot} \, \mathrm{km \, s^{-1}}$ per event [@problem_id:3491419].

**Active Galactic Nuclei (AGN):** Supermassive black holes (SMBHs) at the centers of galaxies can release colossal amounts of energy as they accrete matter. The luminosity is related to the [mass accretion rate](@entry_id:161925) $\dot{M}_{\mathrm{BH}}$ by $L = \epsilon_r \dot{M}_{\mathrm{BH}} c^2$, where $\epsilon_r$ is the **radiative efficiency**, typically taken to be around $0.1$ for a standard thin [accretion disk](@entry_id:159604).

A fundamental limit on the luminosity of an accreting object is the **Eddington luminosity**, $L_{\mathrm{Edd}}$. This is the luminosity at which the outward force of [radiation pressure](@entry_id:143156) on the surrounding gas balances the inward force of gravity. By considering the [force balance](@entry_id:267186) on an electron-proton pair (which dominates the [opacity](@entry_id:160442) and mass in a [fully ionized plasma](@entry_id:200884)), we can derive this limit [@problem_id:3491442]. The outward radiation force on an electron is the momentum flux of the [radiation field](@entry_id:164265) times the electron's scattering cross-section, $F_r = \frac{L}{4\pi r^2 c} \sigma_T$, where $\sigma_T$ is the Thomson scattering cross-section. The inward gravitational force on the associated proton (which holds most of the mass) is $F_g = G M_{\mathrm{BH}} m_p / r^2$. Equating these forces yields:

$L_{\mathrm{Edd}} = \frac{4 \pi G c m_p}{\sigma_T} M_{\mathrm{BH}}$

Notably, the $r^2$ terms cancel, making this a fundamental limit independent of distance. For a $10^8 M_{\odot}$ black hole, the Eddington luminosity is immense, on the order of $1.3 \times 10^{46} \, \mathrm{erg \, s^{-1}}$ ($1.3 \times 10^{39} \, \mathrm{W}$). Even coupling a small fraction of this energy to the surrounding gas can have a profound impact. For instance, if a coupling efficiency of $\epsilon_f = 0.05$ is assumed, the feedback power would be over $6 \times 10^{37} \, \mathrm{W}$ [@problem_id:3491442]. AGN feedback also imparts momentum, both from the radiation field ($p_{\mathrm{rad}} \approx L/c$) and from any kinetic jets or winds.

#### Coupling Mechanisms: From Energy to Action

The heart of a subgrid model lies in the **coupling scheme**, which dictates how the raw energy and momentum from SN or AGN are transferred to the resolved gas cells or particles.

A primary choice is between **thermal feedback**, where the internal energy (and thus temperature) of gas elements is increased, and **kinetic feedback**, where gas is given a velocity kick. A model may use one, the other, or a hybrid approach.

A powerful method for determining the split between thermal and kinetic energy for SN feedback is to demand that the subgrid model reproduces the known physics of a [blast wave](@entry_id:199561) at the [resolution limit](@entry_id:200378) [@problem_id:3491430]. The idea is to match the properties of the simulated remnant at time $t=\Delta t$ and scale $\Delta x$ to the Sedov-Taylor solution. The model calculates the required kinetic energy $E_{\mathrm{k,req}} = \frac{1}{2} M_{\mathrm{c}} v_{\mathrm{s}}(\Delta t)^2$, where $v_{\mathrm{s}}(\Delta t)$ is the Sedov-Taylor shock speed and $M_{\mathrm{c}}$ is the mass within the coupling volume (the larger of the remnant volume and the cell volume). The remaining energy, $E_{\mathrm{SN}} - E_{\mathrm{k,req}}$, is then deposited as thermal energy. This creates a physically grounded, resolution-aware partition of energy.

Once the total injected kinetic energy $E_k$ and momentum $p_{\mathrm{tot}}$ are determined (potentially from multiple sources like SN and AGN), basic conservation laws can be used to determine the properties of the resulting outflow. If this energy and momentum are imparted to a single shell of swept-up gas of mass $M_w$, its launch velocity will be $v = p_{\mathrm{tot}} / M_w$. Its kinetic energy is $E_k = \frac{1}{2} M_w v^2$. Combining these two relations gives a powerful result for the total mass of the outflow [@problem_id:3491419]:

$M_w = \frac{p_{\mathrm{tot}}^2}{2 E_k}$

This equation is fundamental to many kinetic feedback models. It determines the **[mass loading](@entry_id:751706) factor** $\eta = \dot{M}_w / \dot{M}_{\star}$, a key diagnostic of feedback efficiency. It shows that for a fixed [energy budget](@entry_id:201027), imparting more momentum (e.g., by accounting for the pressure-driven phase of a [blast wave](@entry_id:199561)) results in a more massive outflow.

Finally, these outflows carry not just mass and energy, but also metals synthesized in [supernovae](@entry_id:161773). The metallicity of an outflow can be calculated by mixing the newly produced metals from SN ejecta with the metals pre-existing in the swept-up ambient gas, providing a crucial link between feedback and galactic [chemical evolution](@entry_id:144713) [@problem_id:3491419].

### Numerical Implementation and Advanced Techniques

The abstract principles of feedback must be translated into [robust numerical algorithms](@entry_id:754393). This involves confronting several practical challenges and employing sophisticated techniques to ensure the models are both stable and physically meaningful.

#### Stochasticity versus Continuity in Feedback Events

Supernova explosions are discrete, stochastic events. However, many early [subgrid models](@entry_id:755601) employed a **continuous approximation**, smearing the total expected energy and momentum from a stellar population over time [@problem_id:3491462]. This is computationally simple and can be a reasonable approximation for massive galaxies with very high star formation rates (SFRs), where thousands of supernovae occur per timestep.

However, in dwarf galaxies or in the early Universe, the SFR can be low enough that the number of supernovae per timestep is small and subject to significant Poisson fluctuations. In this regime, a **stochastic model** is more physically realistic. Instead of injecting the average energy, the number of SN events in a timestep is drawn from a Poisson distribution whose mean is the expected number. This introduces "burstiness" into the feedback process. Simulations show that stochastic feedback can lead to a more variable [star formation](@entry_id:160356) history and can sometimes drive more powerful outflows compared to a continuous model, because the energy is concentrated in discrete, powerful bursts rather than a continuous drizzle [@problem_id:3491462].

#### Tackling Numerical Challenges: Overcooling and Particle Dynamics

As mentioned, the overcooling problem can render thermal feedback ineffective. A widely used and effective solution is the **energy reservoir** or **delayed cooling** model [@problem_id:3491447]. Instead of injecting thermal energy directly into a gas cell where it might be immediately radiated away, the energy is first accumulated in a non-physical reservoir associated with a star particle or black hole. The energy is only released into the surrounding gas cells when the accumulated amount $E_{\mathrm{res}}$ exceeds a predetermined threshold, $E_{\mathrm{th}}$. This threshold is chosen to be large enough to heat the gas by a significant temperature jump $\Delta T_{\mathrm{min}}$, ensuring the post-heating cooling time is long enough for the energy to have a dynamical impact.

An interesting consequence of this scheme is a [systematic bias](@entry_id:167872). Because the energy injections themselves are stochastic (e.g., exponentially distributed with mean $\bar{E}$), the reservoir energy at the moment of release will typically *overshoot* the threshold $E_{\mathrm{th}}$. For an exponential distribution of energy inputs, the memoryless property leads to the elegant result that the expected overshoot is exactly the mean of the input distribution, $\bar{E}$. The expected deposited energy is thus $\langle E_{\mathrm{dep}} \rangle = E_{\mathrm{th}} + \bar{E}$. This results in a theoretical relative bias in the temperature jump of $\delta_{\mathrm{th}} = \bar{E} / E_{\mathrm{th}}$, a predictable feature that must be accounted for when analyzing the model's behavior [@problem_id:3491447].

A separate set of numerical challenges arises from modeling the black holes themselves, which are represented as massive collisionless particles.
-   **Seeding:** BHs are not primordial. Subgrid models must have a prescription for "seeding" them. A common approach is to place a seed BH of a certain mass (e.g., $10^5 M_{\odot}$) in [dark matter halos](@entry_id:147523) that grow above a certain mass threshold. This threshold must be chosen carefully to ensure the halo is well-resolved (e.g., contains at least 100-1000 dark matter particles) to have a well-defined potential minimum [@problem_id:3491427].
-   **Repositioning:** Due to limited resolution, two-body gravitational interactions are noisy, and [dynamical friction](@entry_id:159616) can be underestimated. This can cause BH particles to wander artificially from the galactic center. To counteract this, many models include a **repositioning scheme**, which applies a small, non-gravitational velocity kick to the BH, nudging it towards the local potential minimum. This must be done carefully, with the drift velocity capped by local dynamical speeds (like the velocity dispersion $\sigma$) and numerical stability limits (e.g., not moving more than a cell size per timestep) to maintain physical plausibility [@problem_id:3491427].
-   **Merging:** When two galaxies merge, their central BHs should eventually merge. Simulations cannot resolve the complex dynamics leading to [gravitational wave emission](@entry_id:160840). Instead, a numerical criterion is used: if two BH particles are within a certain distance (of order the spatial resolution) *and* are gravitationally bound (i.e., their relative velocity is less than their mutual escape speed in the simulation's softened potential), they are merged into a single particle conserving mass and momentum [@problem_id:3491427].

#### The Quest for Resolution Convergence

A critical goal in designing [subgrid models](@entry_id:755601) is to achieve **resolution convergence**, meaning that the simulation's results for macroscopic galaxy properties do not change significantly as the resolution is increased. This requires that the physical impact of the subgrid model remains consistent across different mass and spatial resolutions.

Consider a thermal feedback model where a fixed amount of energy is injected into a fixed number of neighboring cells. If the [mass resolution](@entry_id:197946) is increased, each cell's mass becomes smaller. Injecting the same amount of energy would produce a much higher, physically different temperature jump. To maintain an invariant temperature jump, the total injected thermal energy must be rescaled in direct proportion to the cell mass [@problem_id:3491464]. For example, if the cell mass is reduced by a factor of 4 (i.e., refinement factor $r=0.25$), the thermal coupling efficiency (e.g., $f_{\mathrm{th,SN}}$ or $\epsilon_f$) must also be reduced by a factor of 4. This explicit rescaling is a simple but vital step towards achieving convergence. The aforementioned strategy of calibrating feedback to the Sedov-Taylor solution is another, more physically sophisticated, path towards resolution-invariant feedback [@problem_id:3491430].

### Emergent Properties and Modern Paradigms

When implemented correctly, collections of subgrid rules can give rise to complex, emergent behaviors that regulate galaxy evolution on a global scale. Furthermore, the field is continuously evolving with new theoretical ideas for how feedback operates.

#### Self-Regulation and Effective Equations of State

In the dense, star-forming ISM, a dynamic equilibrium can be established. Star formation injects turbulent energy via [supernovae](@entry_id:161773), which in turn provides pressure support that resists gravitational collapse and moderates the star formation rate. This is a classic **self-regulation loop**. The properties of this equilibrium state can be derived from the subgrid model itself.

For example, consider a model where the [star formation](@entry_id:160356) rate depends on the gas density (e.g., $\dot{\rho}_{\star} \propto \rho^{1.5}$), SN feedback injects turbulent energy, and this turbulence dissipates on a crossing time. By combining the equations for these processes in a steady state, one can derive an **effective [equation of state](@entry_id:141675)** for the turbulent medium [@problem_id:3491445]. This analysis often reveals that the turbulent pressure scales with density as a [polytrope](@entry_id:161798), $P_{\mathrm{t}} \propto \rho^{\gamma_{\mathrm{eff}}}$. A common result for such models is $\gamma_{\mathrm{eff}} = 4/3$, demonstrating how micro-scale physics encoded in the subgrid model leads to a predictable, large-scale thermodynamic behavior of the ISM [@problem_id:3491445].

#### Precipitation-Regulated AGN Feedback

While traditional AGN feedback models often tie the feedback energy directly to the BH's accretion rate, a modern paradigm suggests that in massive halos, feedback is regulated by the [thermodynamic state](@entry_id:200783) of the [circumgalactic medium](@entry_id:747361) (CGM). This is often called **precipitation-regulated** or **cold feedback**. The core idea is that the hot CGM ($T \sim 10^7-10^8$ K) is in a state of quasi-[hydrostatic equilibrium](@entry_id:146746). If this hot atmosphere becomes thermally unstable, cold clouds can "precipitate" out of it and rain down onto the central galaxy, fueling star formation and accretion onto the SMBH.

The trigger for this [thermal instability](@entry_id:151762) is often encapsulated in the ratio of the gas cooling time, $t_{\mathrm{cool}}$, to the [free-fall time](@entry_id:261377), $t_{\mathrm{ff}}$. When this ratio drops below a critical threshold, $t_{\mathrm{cool}}/t_{\mathrm{ff}}  \chi$, the gas is deemed unstable, and AGN feedback is triggered to reheat the gas and restore stability. The value of $\chi$ is a key parameter, often found to be of order 10 in idealized studies.

Calibrating $\chi$ in a realistic, turbulent medium requires a statistical approach [@problem_id:3491420]. The density in a turbulent medium is not uniform but follows a distribution, often approximated as lognormal. The condition $t_{\mathrm{cool}}/t_{\mathrm{ff}}  \chi$ is therefore a probabilistic one. Since $t_{\mathrm{cool}} \propto 1/\rho$, this is equivalent to a condition on density, $\rho  K/\chi$ for some constant $K$. By demanding that a certain fraction of the gas mass should be in this unstable state, one can use the properties of the lognormal density distribution (specifically its variance, which depends on the turbulent Mach number) to derive a calibrated value for $\chi$. This sophisticated approach connects gravity, thermodynamics, and [turbulence statistics](@entry_id:200093) into a self-regulating feedback loop on the scale of the entire galactic halo [@problem_id:3491420].

In summary, [subgrid models](@entry_id:755601) for feedback are a rich and vital component of modern astrophysics. They range from simple energy budget calculations to complex, multi-physics algorithms that tackle numerical artifacts and aim for resolution independence. These models are not static; they evolve as our understanding of the underlying physics and our computational methods improve, continuously pushing the frontier of simulating our Universe.