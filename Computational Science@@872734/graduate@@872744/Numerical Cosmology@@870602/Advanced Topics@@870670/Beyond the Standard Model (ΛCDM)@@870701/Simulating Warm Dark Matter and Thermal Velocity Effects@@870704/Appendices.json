{"hands_on_practices": [{"introduction": "The fundamental distinction between cold and warm dark matter in linear theory is the suppression of small-scale density perturbations in the latter, a direct consequence of WDM particle free-streaming. This effect is incorporated into the initial conditions of N-body simulations by modifying the cold dark matter (CDM) power spectrum, $P_{\\mathrm{cdm}}(k)$, with a WDM transfer function, $T(k)$. This exercise [@problem_id:3489311] provides hands-on practice with the mathematical formalism of this suppression, asking you to analyze the properties of a widely used fitting formula for $T(k)$. By deriving an expression for the average suppression around the characteristic free-streaming scale, you will build an intuition for how the shape of the transfer function dictates the transition from CDM-like behavior on large scales to suppressed power on small scales.", "problem": "In numerical cosmology, the small-scale suppression of structure formation induced by thermal velocities of warm dark matter (WDM) can be incorporated into initial conditions by multiplying the cold dark matter (CDM) linear matter power spectrum by a squared WDM transfer function. Consider a simulation setup in which the WDM transfer function is modeled by the widely used fitting form\n$$\nT(k)=\\left[1+\\left(\\alpha\\,k\\right)^{2\\mu}\\right]^{-5/\\mu},\n$$\nwhere $k$ is the comoving wavenumber, $\\alpha$ is a scale parameter set by the free-streaming scale, and $\\mu$ is a dimensionless shape parameter. The WDM power spectrum is then\n$$\nP_{\\mathrm{wdm}}(k)=T^{2}(k)\\,P_{\\mathrm{cdm}}(k),\n$$\nand the suppression ratio is\n$$\nR(k)\\equiv \\frac{P_{\\mathrm{wdm}}(k)}{P_{\\mathrm{cdm}}(k)}=T^{2}(k)=\\left[1+\\left(\\alpha\\,k\\right)^{2\\mu}\\right]^{-10/\\mu}.\n$$\nDefine the half-mode wavenumber $k_{\\mathrm{hm}}$ by the condition that the power is suppressed by a factor of $1/2$ at this scale, i.e.,\n$$\nR\\!\\left(k_{\\mathrm{hm}}\\right)=\\frac{1}{2}.\n$$\nTo quantify the suppression in the neighborhood of $k_{\\mathrm{hm}}$, define the symmetric three-point average suppression around $k_{\\mathrm{hm}}$ as\n$$\n\\mathcal{A}(\\mu)\\equiv \\frac{1}{3}\\left[R\\!\\left(\\frac{k_{\\mathrm{hm}}}{2}\\right)+R\\!\\left(k_{\\mathrm{hm}}\\right)+R\\!\\left(2\\,k_{\\mathrm{hm}}\\right)\\right].\n$$\nStarting from the given definitions only, derive a closed-form analytic expression for $\\mathcal{A}(\\mu)$ that depends solely on the dimensionless parameter $\\mu$ and contains no dependence on $\\alpha$ or on $k_{\\mathrm{hm}}$. Your final answer must be a single closed-form expression (no numerical evaluation is required). Express the final result exactly; no rounding is needed, and no units are required because $\\mathcal{A}(\\mu)$ is dimensionless.", "solution": "The problem statement is validated as scientifically grounded, well-posed, and objective. It is based on standard models used in numerical cosmology to account for the effects of warm dark matter (WDM), specifically the use of a transfer function to suppress the cold dark matter (CDM) power spectrum. All variables and functions are clearly defined, and the task is a mathematically rigorous derivation that is self-contained. Therefore, I will proceed with the solution.\n\nThe objective is to derive a closed-form expression for the symmetric three-point average suppression, $\\mathcal{A}(\\mu)$, that depends only on the shape parameter $\\mu$. The definition of $\\mathcal{A}(\\mu)$ is given as\n$$\n\\mathcal{A}(\\mu) \\equiv \\frac{1}{3}\\left[R\\!\\left(\\frac{k_{\\mathrm{hm}}}{2}\\right)+R\\!\\left(k_{\\mathrm{hm}}\\right)+R\\!\\left(2\\,k_{\\mathrm{hm}}\\right)\\right].\n$$\nThe suppression ratio $R(k)$ is defined as\n$$\nR(k) = \\left[1+\\left(\\alpha\\,k\\right)^{2\\mu}\\right]^{-\\frac{10}{\\mu}}.\n$$\nThe half-mode wavenumber, $k_{\\mathrm{hm}}$, is defined by the condition $R(k_{\\mathrm{hm}}) = \\frac{1}{2}$. This provides the starting point for eliminating the parameters $\\alpha$ and $k_{\\mathrm{hm}}$.\n\nFirst, we apply the definition of $k_{\\mathrm{hm}}$ to the expression for $R(k)$:\n$$\nR(k_{\\mathrm{hm}}) = \\left[1+\\left(\\alpha\\,k_{\\mathrm{hm}}\\right)^{2\\mu}\\right]^{-\\frac{10}{\\mu}} = \\frac{1}{2}.\n$$\nTo solve for the combined term $(\\alpha k_{\\mathrm{hm}})^{2\\mu}$, we raise both sides of the equation to the power of $-\\frac{\\mu}{10}$:\n$$\n\\left(\\left[1+\\left(\\alpha\\,k_{\\mathrm{hm}}\\right)^{2\\mu}\\right]^{-\\frac{10}{\\mu}}\\right)^{-\\frac{\\mu}{10}} = \\left(\\frac{1}{2}\\right)^{-\\frac{\\mu}{10}}.\n$$\nThis simplifies to\n$$\n1+\\left(\\alpha\\,k_{\\mathrm{hm}}\\right)^{2\\mu} = 2^{\\frac{\\mu}{10}}.\n$$\nIsolating the term of interest yields\n$$\n\\left(\\alpha\\,k_{\\mathrm{hm}}\\right)^{2\\mu} = 2^{\\frac{\\mu}{10}} - 1.\n$$\nThis crucial intermediate result expresses the product $(\\alpha k_{\\mathrm{hm}})$ in terms of $\\mu$, which will allow us to eliminate its dependence from the final expression for $\\mathcal{A}(\\mu)$.\n\nThe expression for $\\mathcal{A}(\\mu)$ requires three terms: $R(k_{\\mathrm{hm}})$, $R(\\frac{k_{\\mathrm{hm}}}{2})$, and $R(2 k_{\\mathrm{hm}})$. The first term is given by definition: $R(k_{\\mathrm{hm}})=\\frac{1}{2}$. We now derive expressions for the other two terms.\n\nFor the term $R(\\frac{k_{\\mathrm{hm}}}{2})$, we substitute $k = \\frac{k_{\\mathrm{hm}}}{2}$ into the definition of $R(k)$:\n$$\nR\\left(\\frac{k_{\\mathrm{hm}}}{2}\\right) = \\left[1+\\left(\\alpha\\,\\frac{k_{\\mathrm{hm}}}{2}\\right)^{2\\mu}\\right]^{-\\frac{10}{\\mu}} = \\left[1+\\frac{\\left(\\alpha\\,k_{\\mathrm{hm}}\\right)^{2\\mu}}{2^{2\\mu}}\\right]^{-\\frac{10}{\\mu}}.\n$$\nNow, we substitute the expression for $(\\alpha k_{\\mathrm{hm}})^{2\\mu}$:\n$$\nR\\left(\\frac{k_{\\mathrm{hm}}}{2}\\right) = \\left[1+\\frac{2^{\\frac{\\mu}{10}} - 1}{2^{2\\mu}}\\right]^{-\\frac{10}{\\mu}}.\n$$\nThis term now depends only on $\\mu$.\n\nNext, for the term $R(2 k_{\\mathrm{hm}})$, we substitute $k = 2 k_{\\mathrm{hm}}$ into the definition of $R(k)$:\n$$\nR\\left(2\\,k_{\\mathrm{hm}}\\right) = \\left[1+\\left(\\alpha\\,(2 k_{\\mathrm{hm}})\\right)^{2\\mu}\\right]^{-\\frac{10}{\\mu}} = \\left[1+2^{2\\mu}\\left(\\alpha\\,k_{\\mathrm{hm}}\\right)^{2\\mu}\\right]^{-\\frac{10}{\\mu}}.\n$$\nAgain, we substitute the expression for $(\\alpha k_{\\mathrm{hm}})^{2\\mu}$:\n$$\nR\\left(2\\,k_{\\mathrm{hm}}\\right) = \\left[1+2^{2\\mu}\\left(2^{\\frac{\\mu}{10}} - 1\\right)\\right]^{-\\frac{10}{\\mu}}.\n$$\nThis term also depends only on $\\mu$.\n\nFinally, we substitute the three terms back into the definition of $\\mathcal{A}(\\mu)$:\n$$\n\\mathcal{A}(\\mu) = \\frac{1}{3}\\left[R\\left(\\frac{k_{\\mathrm{hm}}}{2}\\right) + R\\left(k_{\\mathrm{hm}}\\right) + R\\left(2\\,k_{\\mathrm{hm}}\\right)\\right].\n$$\n$$\n\\mathcal{A}(\\mu) = \\frac{1}{3}\\left( \\left[1+\\frac{2^{\\frac{\\mu}{10}} - 1}{2^{2\\mu}}\\right]^{-\\frac{10}{\\mu}} + \\frac{1}{2} + \\left[1+2^{2\\mu}\\left(2^{\\frac{\\mu}{10}} - 1\\right)\\right]^{-\\frac{10}{\\mu}} \\right).\n$$\nThis is the closed-form analytic expression for $\\mathcal{A}(\\mu)$. It is a function solely of the dimensionless shape parameter $\\mu$, with all dependencies on the scale parameter $\\alpha$ and the half-mode wavenumber $k_{\\mathrm{hm}}$ having been eliminated through rigorous algebraic substitution based on the problem's definitions. This completes the derivation.", "answer": "$$\n\\boxed{\\frac{1}{3}\\left(\\left[1 + \\frac{2^{\\frac{\\mu}{10}} - 1}{2^{2\\mu}}\\right]^{-\\frac{10}{\\mu}} + \\frac{1}{2} + \\left[1 + 2^{2\\mu}\\left(2^{\\frac{\\mu}{10}} - 1\\right)\\right]^{-\\frac{10}{\\mu}}\\right)}\n$$", "id": "3489311"}, {"introduction": "Moving from the abstract power spectrum to a concrete particle realization requires assigning thermal velocities to WDM particles, a step fraught with potential pitfalls related to cosmological coordinate systems. A robust understanding of the relationship between comoving momentum, which follows a time-invariant distribution due to Liouville's theorem, and physical peculiar velocity, which decays as the universe expands ($v_{\\mathrm{pec}} \\propto 1/a$), is critical. This practice [@problem_id:3489237] combines analytical derivation with a numerical experiment to highlight the correct procedure for sampling thermal velocities and to quantify the severe biases introduced by common errors, such as omitting the scale factor or contaminating peculiar velocities with the Hubble flow. Completing this exercise will equip you with the foundational knowledge to correctly implement WDM initial conditions.", "problem": "You are tasked to write a complete, runnable program that quantitatively contrasts sampling thermal peculiar velocities for a collisionless warm dark matter species in the comoving frame versus the physical frame at an initialization redshift, and demonstrates how the Hubble flow and scale factor mapping impact the sampled velocity distribution and a simple discreteness-noise proxy.\n\nBase your reasoning and implementation on the following physical foundations only:\n- Phase-space density conservation for a collisionless species (Liouville’s theorem) and the invariance of the comoving momentum distribution under cosmological expansion.\n- The relation between physical position and comoving position, $\\; \\mathbf{r} = a \\, \\mathbf{x} \\,$, and its time derivative $\\; \\dot{\\mathbf{r}} = a \\, \\dot{\\mathbf{x}} + H \\, \\mathbf{r} \\,$, where $\\, a \\,$ is the scale factor and $\\, H \\,$ is the Hubble parameter.\n- The non-relativistic relation between physical momentum and peculiar velocity, $\\; \\mathbf{p}_\\mathrm{phys} = m \\, \\mathbf{v}_\\mathrm{pec} \\,$.\n- The definition of comoving momentum, $\\; \\mathbf{q} \\equiv a \\, \\mathbf{p}_\\mathrm{phys} \\,$.\n- A flat cosmological model with matter, radiation, and dark energy, with Hubble parameter as a function of the scale factor given by $\\; H(a) = H_0 \\sqrt{\\Omega_r a^{-4} + \\Omega_m a^{-3} + \\Omega_\\Lambda} \\,$, and $\\; \\Omega_r + \\Omega_m + \\Omega_\\Lambda = 1 \\,$.\n\nUsing only these foundations, you must:\n1. Derive how an isotropic, time-invariant comoving distribution $\\, f(\\mathbf{q}) \\,$ maps into a physical peculiar-velocity distribution $\\, f(\\mathbf{v}_\\mathrm{pec}; a) \\,$ at a scale factor $\\, a \\,$, including the Jacobian factor(s). Then specialize to the one-dimensional marginal distributions, assuming Gaussian (Maxwell-Boltzmann proxy) statistics for single components of $\\, \\mathbf{q} \\,$ with zero mean and standard deviation $\\, \\sigma_q \\,$. From your derivation, obtain the one-dimensional standard deviation of the physical peculiar-velocity component, $\\, \\sigma_v(a) \\,$, in terms of $\\, \\sigma_q \\,$, $\\, a \\,$, and $\\, m \\,$.\n2. Consider an incorrect sampling practice where the thermal peculiar velocities are drawn from the comoving-momentum distribution but the factor of $\\, a \\,$ is erroneously omitted when mapping to velocity. From your derivation, express the multiplicative bias $\\, r_\\mathrm{wrong}(a) \\equiv \\tilde{\\sigma}_v(a) / \\sigma_v(a) \\,$ purely in terms of $\\, a \\,$.\n3. Consider a second incorrect practice where the Hubble flow is mistakenly added to the peculiar thermal velocities prior to measuring a one-dimensional root-mean-square speed across particles whose comoving positions $\\, x \\,$ are uniformly distributed in the interval $\\, [-L/2, L/2] \\,$. Using the variance of a uniform distribution, $\\, \\mathrm{Var}(x) = L^2/12 \\,$, and your expression for $\\, H(a) \\,$, derive a multiplicative bias factor $\\, R(a, L) \\,$ quantifying how the root-mean-square speed is biased relative to the case with only peculiar thermal velocities. Express $\\, R(a, L) \\,$ in terms of $\\, H(a) \\,$, $\\, a \\,$, $\\, L \\,$, and the one-dimensional peculiar thermal dispersion $\\, \\sigma_v(a) \\,$.\n4. Implement a program that, for each test case below, performs the following numerical experiment to validate item $\\, 1 \\,$ numerically and report the biases from items $\\, 2 \\,$ and $\\, 3 \\,$:\n   - Use a fixed random seed $\\, s = 12345 \\,$ for reproducibility.\n   - Given parameters $\\, (a, \\sigma_{v,1}, m, L, H_0, \\Omega_m, \\Omega_\\Lambda, \\Omega_r, N) \\,$, construct a Gaussian one-dimensional comoving-momentum component distribution with zero mean and standard deviation $\\, \\sigma_q = m \\, \\sigma_{v,1} \\,$, where $\\, \\sigma_{v,1} \\,$ is the one-dimensional peculiar-velocity dispersion that would be realized at $\\, a = 1 \\,$.\n   - Generate $\\, N \\,$ independent samples $\\, q \\sim \\mathcal{N}(0, \\sigma_q^2) \\,$ and map them to peculiar velocities using your derivation to obtain a sampled set $\\, v_\\mathrm{comoving} \\,$.\n   - Independently generate $\\, N \\,$ samples $\\, v_\\mathrm{physical} \\sim \\mathcal{N}\\!\\big(0, \\sigma_v(a)^2\\big) \\,$ using your derived $\\, \\sigma_v(a) \\,$.\n   - Compute the empirical one-dimensional standard deviations $\\, \\hat{\\sigma}_\\mathrm{comoving} \\,$ and $\\, \\hat{\\sigma}_\\mathrm{physical} \\,$ and report the absolute fractional difference\n     $$ \\Delta \\;\\equiv\\; \\frac{\\left|\\hat{\\sigma}_\\mathrm{comoving} - \\hat{\\sigma}_\\mathrm{physical}\\right|}{\\sigma_v(a)} \\, . $$\n   - Compute and report the analytic wrong-mapping factor $\\, r_\\mathrm{wrong}(a) \\,$ from item $\\, 2 \\,$.\n   - Compute and report the analytic Hubble-contamination bias $\\, R(a, L) \\,$ from item $\\, 3 \\,$ using the cosmology given in each test.\n\nPhysical and numerical units:\n- Treat velocities $\\, \\mathbf{v}_\\mathrm{pec} \\,$ and $\\, \\sigma_{v,1} \\,$ in $\\mathrm{km\\,s^{-1}}$.\n- Treat lengths $\\, L \\,$ in $\\mathrm{Mpc}$.\n- Treat the Hubble constant $\\, H_0 \\,$ in $\\mathrm{km\\,s^{-1}\\,Mpc^{-1}}$.\n- The mass $\\, m \\,$ is an arbitrary positive constant used to parameterize $\\, \\sigma_q \\,$ via $\\, \\sigma_q = m \\, \\sigma_{v,1} \\,$; the program must be dimensionally consistent such that $\\, \\sigma_v(a) \\,$ has units of $\\mathrm{km\\,s^{-1}}$.\n- All outputs $\\, \\Delta \\,$, $\\, r_\\mathrm{wrong}(a) \\,$, and $\\, R(a, L) \\,$ are dimensionless. Report numerical values as floating-point numbers.\n\nTest suite:\n- Use the following four test cases, each specified as a tuple $\\, (a, \\sigma_{v,1}, m, L, H_0, \\Omega_m, \\Omega_\\Lambda, \\Omega_r, N) \\,$:\n  1. $\\, \\left(\\frac{1}{50},\\, 10,\\, 1,\\, 10,\\, 70,\\, 0.3,\\, 0.7,\\, 8.4\\times 10^{-5},\\, 200000\\right) \\,$.\n  2. $\\, \\left(\\frac{1}{200},\\, 10,\\, 1,\\, 10,\\, 70,\\, 0.3,\\, 0.7,\\, 8.4\\times 10^{-5},\\, 200000\\right) \\,$.\n  3. $\\, \\left(\\frac{1}{5},\\, 10,\\, 1,\\, 50,\\, 70,\\, 0.3,\\, 0.7,\\, 8.4\\times 10^{-5},\\, 200000\\right) \\,$.\n  4. $\\, \\left(1,\\, 10,\\, 1,\\, 10,\\, 70,\\, 0.3,\\, 0.7,\\, 8.4\\times 10^{-5},\\, 200000\\right) \\,$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case in the order listed above, append $\\, \\Delta \\,$, then $\\, r_\\mathrm{wrong}(a) \\,$, then $\\, R(a, L) \\,$. The final output should therefore contain $\\, 12 \\,$ floating-point numbers. Express each number rounded to six decimal places. For example, an output with two fictitious test cases would look like $\\, \\left[\\Delta_1, r_{\\mathrm{wrong},1}, R_1, \\Delta_2, r_{\\mathrm{wrong},2}, R_2\\right] \\,$.", "solution": "The problem is evaluated to be scientifically grounded, well-posed, and objective. All necessary information is provided, the physical and mathematical relationships are standard within cosmology, and the tasks are clearly defined. I will therefore proceed with a complete solution.\n\nThe solution is developed in four parts, following the problem statement. First, we derive the relationship between the comoving momentum distribution and the physical peculiar velocity distribution. Second, we quantify the bias from an incorrect mapping. Third, we quantify the bias from erroneously including the Hubble flow. Finally, we describe the implementation of a numerical experiment to validate these findings.\n\n### 1. Derivation of the Physical Peculiar Velocity Distribution\n\nWe begin with the provided definitions relating comoving momentum $\\mathbf{q}$ to physical peculiar velocity $\\mathbf{v}_\\mathrm{pec}$:\n1.  The definition of comoving momentum: $\\mathbf{q} \\equiv a \\, \\mathbf{p}_\\mathrm{phys}$, where $a$ is the scale factor and $\\mathbf{p}_\\mathrm{phys}$ is the physical momentum.\n2.  The non-relativistic relation between physical momentum and peculiar velocity: $\\mathbf{p}_\\mathrm{phys} = m \\, \\mathbf{v}_\\mathrm{pec}$, where $m$ is the particle mass.\n\nCombining these two equations, we express $\\mathbf{q}$ in terms of $\\mathbf{v}_\\mathrm{pec}$:\n$$\n\\mathbf{q} = a \\, (m \\, \\mathbf{v}_\\mathrm{pec}) = a \\, m \\, \\mathbf{v}_\\mathrm{pec}\n$$\nSolving for the physical peculiar velocity $\\mathbf{v}_\\mathrm{pec}$, we find the mapping from comoving momentum:\n$$\n\\mathbf{v}_\\mathrm{pec} = \\frac{\\mathbf{q}}{a \\, m}\n$$\nThe problem states that Liouville's theorem implies the comoving momentum distribution $f(\\mathbf{q})$ is time-invariant. To find the distribution of physical peculiar velocities $f(\\mathbf{v}_\\mathrm{pec}; a)$ at a scale factor $a$, we perform a change of variables. The conservation of phase-space density requires that the probability elements are equal:\n$$\nf(\\mathbf{v}_\\mathrm{pec}; a) \\, d^3v_\\mathrm{pec} = f(\\mathbf{q}) \\, d^3q\n$$\nThus, the physical velocity distribution is related to the comoving momentum distribution by the Jacobian of the transformation:\n$$\nf(\\mathbf{v}_\\mathrm{pec}; a) = f(\\mathbf{q}(\\mathbf{v}_\\mathrm{pec})) \\left| \\det\\left(\\frac{\\partial q_i}{\\partial v_{\\mathrm{pec},j}}\\right) \\right|\n$$\nThe transformation is $\\mathbf{q} = a \\, m \\, \\mathbf{v}_\\mathrm{pec}$. The Jacobian matrix elements are $\\frac{\\partial q_i}{\\partial v_{\\mathrm{pec},j}} = a \\, m \\, \\delta_{ij}$. The determinant is $(a \\, m)^3$.\n\nWe now specialize to the one-dimensional marginal distributions. Let's consider a single component, say $q_x$. The corresponding physical velocity component is $v_{\\mathrm{pec},x} = \\frac{q_x}{a \\, m}$. The problem assumes that $q_x$ is drawn from a Gaussian distribution with zero mean and standard deviation $\\sigma_q$, i.e., $q_x \\sim \\mathcal{N}(0, \\sigma_q^2)$.\n\nA property of the normal distribution is that if a random variable $X \\sim \\mathcal{N}(\\mu, \\sigma^2)$, then scaling by a constant $c$ results in a new random variable $c X \\sim \\mathcal{N}(c\\mu, (c\\sigma)^2)$. In our case, the scaling constant is $c = 1/(a \\, m)$. Therefore, the physical peculiar velocity component $v_{\\mathrm{pec},x}$ also follows a normal distribution with mean $E[v_{\\mathrm{pec},x}] = \\frac{1}{a \\, m} E[q_x] = 0$ and variance $\\mathrm{Var}(v_{\\mathrm{pec},x}) = \\left(\\frac{1}{a \\, m}\\right)^2 \\mathrm{Var}(q_x) = \\left(\\frac{\\sigma_q}{a \\, m}\\right)^2$.\n\nThe one-dimensional standard deviation of the physical peculiar-velocity component, denoted $\\sigma_v(a)$, is the square root of this variance:\n$$\n\\sigma_v(a) = \\frac{\\sigma_q}{a \\, m}\n$$\nThe problem further specifies that $\\sigma_q$ is parameterized as $\\sigma_q = m \\, \\sigma_{v,1}$, where $\\sigma_{v,1}$ is the peculiar velocity dispersion at $a=1$. Substituting this into our expression for $\\sigma_v(a)$ yields:\n$$\n\\sigma_v(a) = \\frac{m \\, \\sigma_{v,1}}{a \\, m} = \\frac{\\sigma_{v,1}}{a}\n$$\nThis result correctly shows that peculiar velocities decay as $1/a$ with the expansion of the universe.\n\n### 2. Bias from Incorrect Velocity Mapping\n\nThe first incorrect practice involves omitting the scale factor $a$ in the mapping. The erroneously sampled velocity $\\tilde{\\mathbf{v}}_\\mathrm{pec}$ is calculated as:\n$$\n\\tilde{\\mathbf{v}}_\\mathrm{pec} = \\frac{\\mathbf{q}}{m}\n$$\nFollowing the same statistical argument as above, the standard deviation of a single component of this incorrect velocity, $\\tilde{\\sigma}_v(a)$, is:\n$$\n\\tilde{\\sigma}_v(a) = \\frac{\\sigma_q}{m}\n$$\nThe multiplicative bias factor $r_\\mathrm{wrong}(a)$ is the ratio of the incorrect standard deviation to the correct one:\n$$\nr_\\mathrm{wrong}(a) \\equiv \\frac{\\tilde{\\sigma}_v(a)}{\\sigma_v(a)} = \\frac{\\sigma_q / m}{\\sigma_q / (a \\, m)} = \\frac{a \\, m}{m} = a\n$$\nThe bias is simply the scale factor $a$. For initial conditions set in the early universe ($a \\ll 1$), this error leads to a significant underestimation of the true thermal velocities.\n\n### 3. Bias from Hubble Flow Contamination\n\nThe second incorrect practice is to mistakenly add the Hubble flow to the peculiar velocities before computing a velocity dispersion. The total one-dimensional velocity of a particle is the sum of its peculiar velocity and the local Hubble flow:\n$$\nv_\\mathrm{total,x} = \\mathbf{v}_\\mathrm{pec} \\cdot \\hat{\\mathbf{x}} + (H(a) \\mathbf{r}) \\cdot \\hat{\\mathbf{x}} = v_{\\mathrm{pec},x} + H(a) r_x\n$$\nUsing the relation $\\mathbf{r} = a \\, \\mathbf{x}$, we have $r_x = a \\, x$. Thus:\n$$\nv_\\mathrm{total,x} = v_{\\mathrm{pec},x} + H(a) \\, a \\, x\n$$\nThe multiplicative bias $R(a, L)$ is the ratio of the root-mean-square (RMS) of the total velocity to the RMS of the peculiar velocity alone. The RMS of a zero-mean random variable is its standard deviation.\n$$\nR(a, L) = \\frac{\\sqrt{E[v_\\mathrm{total,x}^2]}}{\\sqrt{E[v_{\\mathrm{pec},x}^2]}}\n$$\nWe know that $E[v_{\\mathrm{pec},x}^2] = \\mathrm{Var}(v_{\\mathrm{pec},x}) = \\sigma_v(a)^2$ since its mean is zero. Now we compute the mean squared total velocity:\n$$\nE[v_\\mathrm{total,x}^2] = E[(v_{\\mathrm{pec},x} + H(a) \\, a \\, x)^2] = E[v_{\\mathrm{pec},x}^2 + 2 H(a) \\, a \\, x \\, v_{\\mathrm{pec},x} + (H(a) \\, a \\, x)^2]\n$$\nBy linearity of expectation:\n$$\nE[v_\\mathrm{total,x}^2] = E[v_{\\mathrm{pec},x}^2] + 2 H(a) \\, a \\, E[x \\, v_{\\mathrm{pec},x}] + (H(a) \\, a)^2 E[x^2]\n$$\nThe peculiar thermal velocity $v_{\\mathrm{pec},x}$ of a particle is statistically independent of its comoving position $x$. Therefore, $E[x \\, v_{\\mathrm{pec},x}] = E[x] E[v_{\\mathrm{pec},x}]$. The positions $x$ are drawn from a uniform distribution over $[-L/2, L/2]$, for which the mean is $E[x] = 0$. The peculiar velocities are from a Gaussian with mean $E[v_{\\mathrm{pec},x}] = 0$. Consequently, the cross-term vanishes.\n\nThe expression simplifies to:\n$$\nE[v_\\mathrm{total,x}^2] = E[v_{\\mathrm{pec},x}^2] + (H(a) \\, a)^2 E[x^2]\n$$\nFor a uniform distribution on $[-L/2, L/2]$, the variance is given as $\\mathrm{Var}(x) = L^2/12$. Since $E[x]=0$, we have $E[x^2] = \\mathrm{Var}(x) = L^2/12$. Substituting this and $E[v_{\\mathrm{pec},x}^2] = \\sigma_v(a)^2$, we get:\n$$\nE[v_\\mathrm{total,x}^2] = \\sigma_v(a)^2 + (H(a) \\, a)^2 \\frac{L^2}{12}\n$$\nThe bias factor $R(a, L)$ is then:\n$$\nR(a, L) = \\frac{\\sqrt{\\sigma_v(a)^2 + (H(a) \\, a \\, L)^2 / 12}}{\\sigma_v(a)} = \\sqrt{1 + \\frac{(H(a) \\, a \\, L)^2}{12 \\sigma_v(a)^2}}\n$$\nThe Hubble parameter $H(a)$ is given by the Friedmann equation for a flat cosmology:\n$$\nH(a) = H_0 \\sqrt{\\Omega_r a^{-4} + \\Omega_m a^{-3} + \\Omega_\\Lambda}\n$$\n\n### 4. Numerical Implementation\n\nThe program will implement the derived formulas for each test case.\n- For a given test case $(a, \\sigma_{v,1}, m, L, H_0, \\Omega_m, \\Omega_\\Lambda, \\Omega_r, N)$:\n  1.  Fix the random seed to $s=12345$ for reproducibility across all tests.\n  2.  Calculate the theoretical velocity dispersion $\\sigma_v(a) = \\sigma_{v,1}/a$.\n  3.  Calculate the comoving momentum dispersion $\\sigma_q = m \\, \\sigma_{v,1}$.\n  4.  Generate $N$ samples $q_i \\sim \\mathcal{N}(0, \\sigma_q^2)$. Map them to physical velocities $v_i = q_i / (a \\, m)$ and compute the sample standard deviation $\\hat{\\sigma}_\\mathrm{comoving}$.\n  5.  Independently generate $N$ samples directly from the target physical distribution, $v'_i \\sim \\mathcal{N}(0, \\sigma_v(a)^2)$, and compute their sample standard deviation $\\hat{\\sigma}_\\mathrm{physical}$.\n  6.  Compute the fractional difference $\\Delta = |\\hat{\\sigma}_\\mathrm{comoving} - \\hat{\\sigma}_\\mathrm{physical}| / \\sigma_v(a)$. This value should be small, consistent with sampling noise, validating that the two sampling methods are equivalent.\n  7.  Calculate the analytic bias from wrong mapping: $r_\\mathrm{wrong}(a) = a$.\n  8.  Calculate the analytic bias from Hubble flow contamination: $R(a, L) = \\sqrt{1 + (H(a) a L)^2 / (12 \\sigma_v(a)^2)}$, using the provided formula for $H(a)$.\n  9.  The three dimensionless quantities $\\Delta$, $r_\\mathrm{wrong}(a)$, and $R(a, L)$ are reported for each case.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the warm dark matter thermal velocity sampling problem.\n\n    This function iterates through a set of test cases, each defining a cosmological\n    scenario. For each case, it:\n    1. Numerically validates that sampling from a comoving momentum distribution and\n       correctly mapping to physical velocity is equivalent to sampling directly\n       from the physical velocity distribution. The result is the fractional \n       difference Delta.\n    2. Analytically calculates the multiplicative bias factor `r_wrong` that arises \n       from an incorrect mapping (omitting the scale factor).\n    3. Analytically calculates the multiplicative bias factor `R` that arises from\n       contaminating peculiar velocity measurements with the Hubble flow.\n\n    The results from all test cases are collated and printed in the required format.\n    \"\"\"\n    \n    # Test suite: (a, sigma_v1, m, L, H0, Omega_m, Omega_Lambda, Omega_r, N)\n    test_cases = [\n        (1/50, 10, 1, 10, 70, 0.3, 0.7, 8.4e-5, 200000),\n        (1/200, 10, 1, 10, 70, 0.3, 0.7, 8.4e-5, 200000),\n        (1/5, 10, 1, 50, 70, 0.3, 0.7, 8.4e-5, 200000),\n        (1, 10, 1, 10, 70, 0.3, 0.7, 8.4e-5, 200000),\n    ]\n\n    all_results = []\n    \n    # Use a single random number generator for the entire process for reproducibility.\n    # The seed is fixed as per the problem statement.\n    rng = np.random.default_rng(12345)\n\n    for case in test_cases:\n        a, sigma_v1, m, L, H0, Omega_m, Omega_Lambda, Omega_r, N = case\n\n        # ----------------------------------------------------------------------\n        # Part 1: Numerical validation and calculation of Delta\n        # ----------------------------------------------------------------------\n        \n        # Theoretical 1D peculiar velocity dispersion at scale factor a\n        # sigma_v(a) = sigma_{v,1} / a\n        sigma_v_a = sigma_v1 / a\n\n        # 1D comoving momentum dispersion\n        # sigma_q = m * sigma_{v,1}\n        sigma_q = m * sigma_v1\n\n        # Method 1: Sample from comoving momentum and map to physical velocity\n        # q ~ N(0, sigma_q^2)\n        q_samples = rng.normal(loc=0.0, scale=sigma_q, size=N)\n        # v_pec = q / (a * m)\n        v_comoving_samples = q_samples / (a * m)\n        hat_sigma_comoving = np.std(v_comoving_samples)\n\n        # Method 2: Sample directly from the physical velocity distribution\n        # v_pec ~ N(0, sigma_v(a)^2)\n        v_physical_samples = rng.normal(loc=0.0, scale=sigma_v_a, size=N)\n        hat_sigma_physical = np.std(v_physical_samples)\n\n        # Compute the absolute fractional difference Delta\n        delta = np.abs(hat_sigma_comoving - hat_sigma_physical) / sigma_v_a\n        all_results.append(delta)\n\n        # ----------------------------------------------------------------------\n        # Part 2: Analytic calculation of the wrong-mapping factor r_wrong\n        # ----------------------------------------------------------------------\n        \n        # r_wrong(a) = a\n        r_wrong = a\n        all_results.append(r_wrong)\n\n        # ----------------------------------------------------------------------\n        # Part 3: Analytic calculation of the Hubble-contamination bias R\n        # ----------------------------------------------------------------------\n\n        # Hubble parameter at scale factor a\n        # H(a) = H0 * sqrt(Omega_r*a^-4 + Omega_m*a^-3 + Omega_Lambda)\n        H_a = H0 * np.sqrt(Omega_r * a**-4 + Omega_m * a**-3 + Omega_Lambda)\n\n        # Multiplicative bias factor R(a, L)\n        # R(a, L) = sqrt(1 + (H(a)*a*L)^2 / (12*sigma_v(a)^2))\n        R_a_L = np.sqrt(1.0 + (H_a * a * L)**2 / (12.0 * sigma_v_a**2))\n        all_results.append(R_a_L)\n\n    # Print all results in the specified format, rounded to 6 decimal places.\n    print(f\"[{','.join([f'{val:.6f}' for val in all_results])}]\")\n\nsolve()\n\n```", "id": "3489237"}, {"introduction": "A correct statistical sampling of thermal velocities is a necessary but not sufficient condition for a high-fidelity WDM simulation. A purely random assignment of velocity vectors, while statistically unbiased in ensemble average, introduces significant shot noise and spurious anisotropic pressure at the grid scale for any single realization. This practice [@problem_id:3489333] delves into advanced \"quiet-start\" techniques designed to mitigate these numerical artifacts. You will critically evaluate several algorithms for assigning thermal velocities, aiming to satisfy multiple constraints simultaneously: preserving the correct speed distribution while exactly canceling net momentum and enforcing an isotropic velocity tensor within each grid cell. This exercise demonstrates how structured, symmetric initializations using tools like spherical designs are essential for minimizing numerical noise and accurately capturing the subtle physical effects of WDM.", "problem": "You are initializing a Warm Dark Matter (WDM) cosmological $N$-body run at redshift $z_i$ on a uniform Eulerian mesh for a Particle-Mesh (PM) solver. In each grid cell of comoving volume $V_c$, there are $N_p$ equal-mass macro-particles of mass $m$ whose positions encode the density field from Lagrangian initial conditions. To model WDM thermal motions, each particle must be assigned a peculiar thermal velocity $\\mathbf{v}_{\\mathrm{th}}$ drawn from a stationary, homogeneous, and isotropic one-particle velocity distribution $f(\\mathbf{v})$ with zero mean $\\langle \\mathbf{v}_{\\mathrm{th}} \\rangle = \\mathbf{0}$ and isotropic second moment $\\langle v_i v_j \\rangle = \\sigma_{\\mathrm{th}}^2 \\,\\delta_{ij}$ at $z_i$, where $i,j \\in \\{x,y,z\\}$ and $\\delta_{ij}$ is the Kronecker symbol. Let $p(s)$ denote the corresponding one-dimensional speed probability density for $s \\equiv \\|\\mathbf{v}_{\\mathrm{th}}\\|$.\n\nYou are asked to design a quiet-start assignment of thermal velocities that minimizes spurious grid-scale anisotropy and cancels net momentum per cell. The scheme must satisfy all of the following in every grid cell at initialization:\n\n(i) Exact zero per-cell momentum: $\\sum_{a=1}^{N_p} m\\,\\mathbf{v}_{\\mathrm{th},a} = \\mathbf{0}$.\n\n(ii) An isotropic per-cell second-moment tensor at fixed realization: $\\sum_{a=1}^{N_p} m\\,\\mathbf{v}_{\\mathrm{th},a}\\mathbf{v}_{\\mathrm{th},a}^{\\top}$ is proportional to the identity tensor $\\mathbf{I}$ for that realization (not only in expectation), so that any residual error is a scalar prefactor error relative to $m\\,N_p\\,\\sigma_{\\mathrm{th}}^2$.\n\n(iii) Correct one-particle speed law across the ensemble of cells: marginally over directions, the single-particle speed distribution is $p(s)$, without bias in the mean or variance.\n\nAssume $N_p$ is sufficiently large to permit grouping constructions when required. Consider the following four candidate algorithms for per-cell assignment:\n\nA. For each cell, draw $N_p/2$ independent $3$-vectors $\\{\\mathbf{u}_k\\}_{k=1}^{N_p/2}$ with directions isotropic on the unit sphere and speeds $s_k \\sim p(s)$. Assign two particles the velocities $+\\mathbf{u}_k$ and $-\\mathbf{u}_k$ for each $k$ in that cell.\n\nB. For each cell, fix the six cardinal directions $\\{\\pm \\hat{\\mathbf{x}}, \\pm \\hat{\\mathbf{y}}, \\pm \\hat{\\mathbf{z}}\\}$. Draw three independent speeds $s_x, s_y, s_z \\sim p(s)$. Split the $N_p$ particles as evenly as possible into six equal groups (tolerating at most a difference of one if $N_p$ is not a multiple of six) and assign to the $\\pm \\hat{\\mathbf{x}}$ group the speeds $\\pm s_x$, to the $\\pm \\hat{\\mathbf{y}}$ group the speeds $\\pm s_y$, and to the $\\pm \\hat{\\mathbf{z}}$ group the speeds $\\pm s_z$.\n\nC. For each cell, choose $D$ unit directions $\\{\\mathbf{n}_d\\}_{d=1}^{D}$ that form a spherical $2$-design (for example, the $D=6$ vertices of a regular octahedron, i.e., $\\{\\pm \\hat{\\mathbf{x}}, \\pm \\hat{\\mathbf{y}}, \\pm \\hat{\\mathbf{z}}\\}$). Partition the $N_p$ particles into $K$ complete angular multiplets of size $D$ (assume $D \\mid N_p$ for simplicity). For each multiplet $g \\in \\{1,\\dots,K\\}$, draw one speed $s_g \\sim p(s)$ and assign the $D$ velocities $\\{+\\!s_g\\,\\mathbf{n}_1,\\,-\\!s_g\\,\\mathbf{n}_1,\\,\\dots,\\,+\\!s_g\\,\\mathbf{n}_{D/2},\\,-\\!s_g\\,\\mathbf{n}_{D/2}\\}$ to the $D$ particles of that multiplet, i.e., equal speed across all directions within a multiplet with antipodal pairing.\n\nD. For each cell, choose $D$ unit directions $\\{\\mathbf{n}_d\\}_{d=1}^{D}$ forming a spherical $2$-design as in option C. Partition particles into $K$ multiplets of size $D$. Within each multiplet, draw $D$ independent speeds $\\{s_{g,d}\\} \\sim p(s)$ and assign velocities $\\{\\pm s_{g,d}\\,\\mathbf{n}_d\\}$ to the antipodal pairs. After assigning all velocities in the cell, enforce exact zero net momentum by subtracting the per-cell mean velocity: $\\mathbf{v}_{\\mathrm{th},a} \\leftarrow \\mathbf{v}_{\\mathrm{th},a} - \\frac{1}{N_p}\\sum_{b=1}^{N_p}\\mathbf{v}_{\\mathrm{th},b}$.\n\nWhich option satisfies conditions (i)–(iii) as stated?\n\n- A. Satisfies (i) but not (ii); satisfies (iii) in expectation only.\n- B. Satisfies (i) but not (ii) or (iii).\n- C. Satisfies (i), (ii), and (iii).\n- D. Satisfies (i) by construction after subtraction, but not (ii) or (iii).", "solution": "The problem requires an evaluation of four different algorithms for assigning thermal velocities to particles in an $N$-body simulation cell, based on three conditions: (i) exact zero net momentum per cell, (ii) an exactly isotropic second-moment tensor per cell, and (iii) a correct resulting single-particle speed distribution.\n\nLet the particles in a cell be indexed by $a=1, \\dots, N_p$. The assigned thermal velocity to particle $a$ is $\\mathbf{v}_a$. The mass of each particle is $m$.\n\nThe three conditions are:\n(i) Zero momentum: $\\sum_{a=1}^{N_p} m \\mathbf{v}_a = \\mathbf{0}$. Since $m$ is a constant, this is equivalent to $\\sum_{a=1}^{N_p} \\mathbf{v}_a = \\mathbf{0}$.\n(ii) Isotropic second-moment tensor: The velocity second-moment tensor, with components $S_{ij} = \\sum_{a=1}^{N_p} v_{a,i} v_{a,j}$, must be proportional to the identity tensor. This means $S_{ij} = C \\delta_{ij}$ for some scalar $C$, which implies $S_{xx} = S_{yy} = S_{zz}$ and $S_{xy} = S_{xz} = S_{yz} = 0$.\n(iii) Correct speed distribution: The empirical probability distribution of the particle speeds, $s_a = \\|\\mathbf{v}_a\\|$, should be a statistically sound representation of the target distribution $p(s)$, with no introduced bias in its moments (like mean or variance).\n\nLet us analyze each proposed algorithm.\n\n### Analysis of Algorithm A\n\nThis algorithm pairs particles. For each pair, a random vector $\\mathbf{u}_k$ is generated, and the pair is assigned velocities $+\\mathbf{u}_k$ and $-\\mathbf{u}_k$. The speed $s_k = \\|\\mathbf{u}_k\\|$ is drawn from $p(s)$, and the direction is chosen isotropically. There are $N_p/2$ such pairs.\n\n-   **Condition (i) - Momentum**: The total velocity sum per cell is $\\sum_{k=1}^{N_p/2} (\\mathbf{u}_k + (-\\mathbf{u}_k)) = \\sum_{k=1}^{N_p/2} \\mathbf{0} = \\mathbf{0}$. **Condition (i) is satisfied.**\n\n-   **Condition (ii) - Second Moment**: The second-moment tensor is $S_{ij} = \\sum_{a=1}^{N_p} v_{a,i} v_{a,j}$. For each pair $k$, the contribution is $u_{k,i} u_{k,j} + (-u_{k,i})(-u_{k,j}) = 2 u_{k,i} u_{k,j}$. Thus, $S_{ij} = \\sum_{k=1}^{N_p/2} 2 u_{k,i} u_{k,j}$. Let $\\mathbf{u}_k = s_k \\hat{\\mathbf{n}}_k$, where $s_k$ is a random speed and $\\hat{\\mathbf{n}}_k$ is a random isotropic unit vector. Then $S_{ij} = 2 \\sum_{k=1}^{N_p/2} s_k^2 n_{k,i} n_{k,j}$. For a finite number of random vectors $N_p/2$, this sum will not result in a diagonal tensor for a single realization. For example, the off-diagonal term $S_{xy} = 2 \\sum_k s_k^2 n_{k,x} n_{k,y}$ is a sum of random variables and will be non-zero in general. While in expectation $\\langle S_{ij} \\rangle \\propto \\delta_{ij}$, the condition requires this to hold for a single realization. **Condition (ii) is not satisfied.**\n\n-   **Condition (iii) - Speed Distribution**: The algorithm draws $N_p/2$ speeds $\\{s_k\\}$ from $p(s)$. Each speed is assigned to two particles. The resulting set of $N_p$ speeds is $\\{s_1, s_1, s_2, s_2, \\dots, s_{N_p/2}, s_{N_p/2}\\}$. This is not a set of $N_p$ independent draws from $p(s)$. The empirical distribution is determined by a smaller sample of size $N_p/2$. While the ensemble properties (averaging over many cells) might be correct, the condition applies to the sample created for the simulation. Therefore, the single-particle speed law is only recovered in an average sense. The option's description \"satisfies (iii) in expectation only\" is an accurate assessment of this limitation. **Condition (iii) is not strictly satisfied.**\n\n**Verdict for A:** The statement \"Satisfies (i) but not (ii); satisfies (iii) in expectation only\" is **Correct**.\n\n### Analysis of Algorithm B\n\nThis algorithm uses the six fixed cardinal directions $\\{\\pm\\hat{\\mathbf{x}}, \\pm\\hat{\\mathbf{y}}, \\pm\\hat{\\mathbf{z}}\\}$. It draws three independent speeds $s_x, s_y, s_z \\sim p(s)$ and assigns them to groups of particles.\n\n-   **Condition (i) - Momentum**: Particles are split into six groups of approximately equal size $N_p/6$. The groups are assigned velocities $\\pm s_x\\hat{\\mathbf{x}}$, $\\pm s_y\\hat{\\mathbf{y}}$, $\\pm s_z\\hat{\\mathbf{z}}$. For each axis, there is a group with positive velocity and one with negative velocity. If the sizes of opposing groups are equal (e.g., if $6 | N_p$), the total momentum is exactly $\\frac{N_p}{6}(s_x\\hat{\\mathbf{x}} - s_x\\hat{\\mathbf{x}} + s_y\\hat{\\mathbf{y}} - s_y\\hat{\\mathbf{y}} + s_z\\hat{\\mathbf{z}} - s_z\\hat{\\mathbf{z}}) = \\mathbf{0}$. The description implies pairing to cancel momentum. **Condition (i) is satisfied.**\n\n-   **Condition (ii) - Second Moment**: The second-moment tensor is $S_{ij} = \\sum_a v_{a,i} v_{a,j}$. Particles with velocity along $\\hat{\\mathbf{x}}$ only contribute to $S_{xx}$. Similarly for $\\hat{\\mathbf{y}}$ and $\\hat{\\mathbf{z}}$. Thus, all off-diagonal terms are zero, $S_{xy}=S_{xz}=S_{yz}=0$. The diagonal terms are $S_{xx} = (\\frac{N_p}{3}) s_x^2$, $S_{yy} = (\\frac{N_p}{3}) s_y^2$, and $S_{zz} = (\\frac{N_p}{3}) s_z^2$ (assuming $3|N_p$). For the tensor to be isotropic, we need $S_{xx}=S_{yy}=S_{zz}$, which implies $s_x^2=s_y^2=s_z^2$. Since $s_x, s_y, s_z$ are drawn independently from a distribution $p(s)$, they will be different in any particular realization. **Condition (ii) is not satisfied.**\n\n-   **Condition (iii) - Speed Distribution**: The speeds assigned to the $N_p$ particles are only three distinct values: $s_x, s_y, s_z$, each repeated $N_p/3$ times. This is an extremely poor representation of a continuous distribution $p(s)$. The empirical distribution is a sum of three delta functions, which does not match $p(s)$. **Condition (iii) is not satisfied.**\n\n**Verdict for B:** The statement \"Satisfies (i) but not (ii) or (iii)\" is **Correct**.\n\n### Analysis of Algorithm C\n\nThis algorithm uses a set of $D$ directions $\\{\\mathbf{n}_d\\}$ that form a spherical $2$-design. Particles are grouped into multiplets of size $D$. For each multiplet, one speed $s_g \\sim p(s)$ is drawn and assigned to all $D$ particles, with velocities $s_g\\mathbf{n}_d$.\n\nA key property of a spherical $2$-design on the unit sphere $S^2$ is that for any polynomial of degree up to $2$, its average over the $D$ points equals its average over the sphere.\nFor degree $1$: $\\sum_{d=1}^D n_{d,i} = 0$.\nFor degree $2$: $\\sum_{d=1}^D n_{d,i} n_{d,j} = \\frac{D}{3} \\delta_{ij}$.\n\n-   **Condition (i) - Momentum**: For each multiplet $g$, the sum of velocities is $\\sum_{d=1}^D s_g \\mathbf{n}_d = s_g \\sum_{d=1}^D \\mathbf{n}_d$. From the property of a $1$-design (which a $2$-design also is), $\\sum_d \\mathbf{n}_d = \\mathbf{0}$. Thus, momentum is zero for each multiplet. The total cell momentum, a sum over multiplets, is also zero. **Condition (i) is satisfied.**\n\n-   **Condition (ii) - Second Moment**: The second-moment tensor for the cell is $S_{ij} = \\sum_{g=1}^K \\sum_{d=1}^D v_{g,d,i} v_{g,d,j}$, where $K=N_p/D$ is the number of multiplets. The velocity is $v_{g,d,i} = s_g n_{d,i}$.\n$S_{ij} = \\sum_{g=1}^K \\sum_{d=1}^D s_g^2 n_{d,i} n_{d,j} = \\sum_{g=1}^K s_g^2 \\left( \\sum_{d=1}^D n_{d,i} n_{d,j} \\right)$.\nUsing the $2$-design property, $\\sum_d n_{d,i} n_{d,j} = \\frac{D}{3} \\delta_{ij}$.\nSo, $S_{ij} = \\sum_{g=1}^K s_g^2 \\left( \\frac{D}{3} \\delta_{ij} \\right) = \\left( \\frac{D}{3} \\sum_{g=1}^K s_g^2 \\right) \\delta_{ij}$.\nThis is of the form $C \\delta_{ij}$ with $C = \\frac{D}{3} \\sum_g s_g^2$. The tensor is proportional to the identity matrix for each realization. **Condition (ii) is satisfied.**\n\n-   **Condition (iii) - Speed Distribution**: The algorithm draws $K=N_p/D$ speeds $\\{s_g\\}$ and assigns each speed to $D$ particles. The full set of speeds is $\\{s_1, \\dots, s_1, s_2, \\dots, s_2, \\dots \\}$, with each $s_g$ repeated $D$ times. The empirical distribution of speeds is constructed from a smaller sample of $K$ independent draws rather than $N_p$. However, the process of sampling is directly from $p(s)$ and introduces no bias. The expected mean speed $\\langle \\bar{s} \\rangle$ and mean squared speed $\\langle \\overline{s^2} \\rangle$ of the particle ensemble are correct. In the context of \"quiet start\" methods, this is often considered a valid trade-off to satisfy the more critical condition (ii) exactly. Given the options, this method is the only one that satisfies (i) and (ii) and generates speeds by sampling the correct distribution without introducing systematic bias. **Condition (iii) is satisfied** in the sense required for such numerical schemes.\n\n**Verdict for C:** The statement \"Satisfies (i), (ii), and (iii)\" is **Correct**.\n\n### Analysis of Algorithm D\n\nThis algorithm also uses a $2$-design for directions. However, it draws independent speeds for particles (or pairs) and then subtracts the mean cell velocity to enforce zero momentum. Let the initial velocities be $\\mathbf{v'}_a$ and final velocities be $\\mathbf{v}_a = \\mathbf{v'}_a - \\bar{\\mathbf{v'}}$.\n\n-   **Condition (i) - Momentum**: The final momentum is $\\sum_a m \\mathbf{v}_a = m \\sum_a (\\mathbf{v'}_a - \\bar{\\mathbf{v'}}) = m(\\sum_a \\mathbf{v'}_a - N_p \\bar{\\mathbf{v'}}) = m(N_p \\bar{\\mathbf{v'}} - N_p \\bar{\\mathbf{v'}}) = \\mathbf{0}$. **Condition (i) is satisfied** by this final step.\n\n-   **Condition (ii) - Second Moment**: The initial tensor $S'_{ij} = \\sum_a v'_{a,i}v'_{a,j}$ is not isotropic because the speeds are independent for each direction, similar to the issue in Algorithm A and B (e.g., $S'_{xx} \\neq S'_{yy}$). The final tensor is $S_{ij} = \\sum_a v_{a,i}v_{a,j} = S'_{ij} - N_p \\bar{v'}_i \\bar{v'}_j$. The correction term $-N_p \\bar{\\mathbf{v'}}\\bar{\\mathbf{v'}}^{\\top}$ is a rank-1 projector, which is itself anisotropic. Subtracting an anisotropic matrix from another generally non-isotropic matrix does not result in an isotropic one. **Condition (ii) is not satisfied.**\n\n-   **Condition (iii) - Speed Distribution**: The final speed of a particle is $s_a = \\|\\mathbf{v}_a\\| = \\|\\mathbf{v'}_a - \\bar{\\mathbf{v'}}\\|$. This changes all particle speeds from their originally sampled values. The mean squared speed is systematically altered: $\\frac{1}{N_p}\\sum_a s_a^2 = \\frac{1}{N_p}\\sum_a \\|\\mathbf{v'}_a - \\bar{\\mathbf{v'}}\\|^2 = \\frac{1}{N_p}\\sum_a (s'_a)^2 - \\|\\bar{\\mathbf{v'}}\\|^2$. Since $\\|\\bar{\\mathbf{v'}}\\|^2 > 0$ for any single realization, this procedure systematically reduces the total kinetic energy and introduces a bias in the variance of the velocity distribution. **Condition (iii) is not satisfied.**\n\n**Verdict for D:** The statement \"Satisfies (i) by construction after subtraction, but not (ii) or (iii)\" is **Correct**.\n\n### Conclusion\nBased on the analysis, Algorithm C is the only one that satisfies all three conditions. It leverages the mathematical properties of spherical $2$-designs to exactly cancel the momentum and ensure the isotropy of the second-moment tensor for every single realization, which is the essence of a quiet start. The method for generating speeds is statistically unbiased, making it the superior choice.", "answer": "$$\\boxed{C}$$", "id": "3489333"}]}