{"hands_on_practices": [{"introduction": "Before a region of space can undergo gravitational collapse, the tiny initial overdensity it contains must first grow under the influence of gravity. This exercise explores the linear growth equation, which governs how small density fluctuations amplify in an expanding universe. By deriving and numerically solving this equation for the simple Einstein-de Sitter model, you will master a foundational concept for understanding how the seeds of structure planted in the early universe evolve over cosmic time. [@problem_id:3498601]", "problem": "Consider the linear growth of small, spherically symmetric matter overdensities in a flat, matter-only Einstein–de Sitter background universe, which is relevant to the spherical collapse model. The background contains a pressureless, non-relativistic fluid with mass density $\\rho_{\\mathrm{m}}(t)$ and Hubble expansion rate $H(t) = \\dot{a}/a$, where $a$ is the scale factor. In the Newtonian sub-horizon regime, the linear overdensity $\\delta(\\mathbf{x}, t)$ obeys the standard linearized continuity, Euler, and Poisson equations for a dust fluid coupled to gravity, together with the Friedmann equations for the background. These combine to give a second-order ordinary differential equation for the homogeneous linear growth factor $D(a)$ defined by $\\delta(\\mathbf{x}, a) = D(a)\\,\\delta(\\mathbf{x}, a_{\\mathrm{ini}})$ in the growing mode.\n\nTask A (derivation from fundamentals): Starting from the linearized fluid equations and Poisson equation for a pressureless fluid and the Friedmann equation for the Einstein–de Sitter case, derive the ordinary differential equation for the linear growth factor $D$ as a function of the logarithmic scale factor $x \\equiv \\ln a$. Your derivation must begin with the cosmic-time equation for linear growth in the sub-horizon regime,\n$$\n\\ddot{\\delta} + 2 H \\dot{\\delta} - 4 \\pi G \\rho_{\\mathrm{m}} \\delta = 0,\n$$\ntogether with the Einstein–de Sitter identities $H^2 = \\tfrac{8\\pi G}{3}\\rho_{\\mathrm{m}}$ and $\\rho_{\\mathrm{m}} \\propto a^{-3}$. Then transform to $x = \\ln a$ and express the resulting equation solely in terms of $D(x)$ and its derivatives with respect to $x$. Based on the small-$a$ asymptotics of this differential equation, determine a consistent set of initial conditions at a very early scale factor $a_{\\mathrm{ini}}$ that isolate the growing mode and fix the overall normalization.\n\nTask B (numerical computation and verification): Implement a robust initial value problem solver to integrate the differential equation for $D(x)$ from $a_{\\mathrm{ini}} = 10^{-8}$ to a set of final scale factors $a_{\\mathrm{end}}$ drawn from the test suite below. Use a high-order, adaptive-step ordinary differential equation method with tight absolute and relative tolerances to control numerical error. For each $a_{\\mathrm{end}}$ in the test suite, compute $D_{\\mathrm{num}}(a_{\\mathrm{end}})$ and compare it to the analytic growing-mode solution you derived in Task A. Report the relative error\n$$\n\\varepsilon(a_{\\mathrm{end}}) \\equiv \\frac{\\left| D_{\\mathrm{num}}(a_{\\mathrm{end}}) - D_{\\mathrm{ana}}(a_{\\mathrm{end}}) \\right|}{\\left| D_{\\mathrm{ana}}(a_{\\mathrm{end}}) \\right|}.\n$$\nYour implementation must target and achieve $\\varepsilon(a_{\\mathrm{end}})  10^{-6}$ for all test points.\n\nTest suite: Use the final scale factors\n$$\n\\left[ 10^{-6},\\, 10^{-4},\\, 10^{-2},\\, 10^{-1},\\, 1,\\, 2 \\right].\n$$\n\nFinal output format: Your program should produce a single line of output containing the six relative errors, in the same order as the test suite, as a comma-separated list enclosed in square brackets (e.g., \"[e1,e2,e3,e4,e5,e6]\"). No units are required because $a$ and $D$ are dimensionless. Angles are not involved. The output values must be real numbers (floating-point).", "solution": "The user has provided a well-posed problem from the field of physical cosmology, specifically concerning the linear theory of structure formation. The task is to first derive the governing ordinary differential equation (ODE) for the linear growth factor in an Einstein–de Sitter universe and find its analytic solution, and second, to numerically solve this ODE and verify its accuracy against the analytic result.\n\n### Task A: Derivation and Analytic Solution\n\nThe starting point is the equation for the evolution of the linear density contrast, $\\delta$, in cosmic time, $t$:\n$$\n\\ddot{\\delta} + 2 H \\dot{\\delta} - 4 \\pi G \\rho_{\\mathrm{m}} \\delta = 0\n$$\nwhere a dot represents a derivative with respect to $t$, $H$ is the Hubble parameter, $G$ is the gravitational constant, and $\\rho_{\\mathrm{m}}$ is the background matter density.\n\nFor a flat, matter-only Einstein–de Sitter (EdS) universe, the first Friedmann equation simplifies to $H^2 = \\frac{8\\pi G}{3}\\rho_{\\mathrm{m}}$. We can use this to replace the term $4 \\pi G \\rho_{\\mathrm{m}}$:\n$$\n4 \\pi G \\rho_{\\mathrm{m}} = \\frac{3}{2} H^2\n$$\nSubstituting this into the growth equation yields:\n$$\n\\ddot{\\delta} + 2 H \\dot{\\delta} - \\frac{3}{2} H^2 \\delta = 0\n$$\nThe problem requires an equation in terms of the logarithmic scale factor, $x \\equiv \\ln a$. We perform a change of variables from $t$ to $x$. The chain rule gives the time derivative operator as:\n$$\n\\frac{d}{dt} = \\frac{da}{dt} \\frac{d}{da} = \\dot{a} \\frac{d}{da} = a H \\frac{d}{da}\n$$\nFurther, with $x = \\ln a$, we have $\\frac{d}{da} = \\frac{dx}{da} \\frac{d}{dx} = \\frac{1}{a} \\frac{d}{dx}$. Therefore:\n$$\n\\frac{d}{dt} = H \\frac{d}{dx}\n$$\n Applying this to $\\delta$, we get the first derivative:\n$$\n\\dot{\\delta} = H \\frac{d\\delta}{dx}\n$$\nThe second derivative is:\n$$\n\\ddot{\\delta} = \\frac{d}{dt}\\left(H \\frac{d\\delta}{dx}\\right) = \\dot{H} \\frac{d\\delta}{dx} + H \\frac{d}{dt}\\left(\\frac{d\\delta}{dx}\\right) = \\dot{H} \\frac{d\\delta}{dx} + H^2 \\frac{d^2\\delta}{dx^2}\n$$\nFor an EdS universe, matter density scales as $\\rho_{\\mathrm{m}} \\propto a^{-3}$, and from the Friedmann equation, $H^2 \\propto \\rho_{\\mathrm{m}} \\propto a^{-3}$. Thus $H \\propto a^{-3/2}$. Taking the time derivative, $\\dot{H} = \\frac{dH}{da}\\dot{a} = (-\\frac{3}{2}a^{-5/2})\\dot{a} = -\\frac{3}{2}a^{-5/2}(aH) = -\\frac{3}{2}a^{-3/2}H$. Since $H \\propto a^{-3/2}$, we have $\\dot{H} = -\\frac{3}{2}H^2$. Substituting this into the expression for $\\ddot{\\delta}$:\n$$\n\\ddot{\\delta} = -\\frac{3}{2}H^2 \\frac{d\\delta}{dx} + H^2 \\frac{d^2\\delta}{dx^2}\n$$\nNow, we substitute the expressions for $\\dot{\\delta}$ and $\\ddot{\\delta}$ into the growth equation:\n$$\n\\left(-\\frac{3}{2}H^2 \\frac{d\\delta}{dx} + H^2 \\frac{d^2\\delta}{dx^2}\\right) + 2H \\left(H \\frac{d\\delta}{dx}\\right) - \\frac{3}{2}H^2 \\delta = 0\n$$\nDividing by $H^2$ (which is non-zero) and collecting terms:\n$$\n\\frac{d^2\\delta}{dx^2} + \\left(2 - \\frac{3}{2}\\right)\\frac{d\\delta}{dx} - \\frac{3}{2}\\delta = 0\n$$\nThis gives the final ODE for the growth factor $D(x)$, where $\\delta(\\mathbf{x}, x) \\propto D(x)$:\n$$\n\\frac{d^2 D}{dx^2} + \\frac{1}{2}\\frac{d D}{dx} - \\frac{3}{2} D = 0\n$$\nThis is a second-order linear homogeneous ODE with constant coefficients. We seek a solution of the form $D(x) = e^{\\lambda x}$. The characteristic equation is:\n$$\n\\lambda^2 + \\frac{1}{2}\\lambda - \\frac{3}{2} = 0\n$$\nMultiplying by $2$ gives $2\\lambda^2 + \\lambda - 3 = 0$, which factors as $(2\\lambda+3)(\\lambda-1)=0$. The roots are $\\lambda_1 = 1$ and $\\lambda_2 = -3/2$.\n\nThe general solution is a linear combination of the two independent solutions:\n$$\nD(x) = c_1 e^x + c_2 e^{-3x/2}\n$$\nTranslating back to the scale factor $a = e^x$:\n$$\nD(a) = c_1 a + c_2 a^{-3/2}\n$$\nThe term $D_+(a) \\propto a$ is the **growing mode**, which dominates at late times ($a \\to \\infty$). The term $D_-(a) \\propto a^{-3/2}$ is the **decaying mode**, which dominates at early times ($a \\to 0$).\n\nTo study structure formation, we are interested in the growing mode. We isolate it by setting $c_2 = 0$. The solution is $D(a) = c_1 a$. The normalization is fixed by the problem's definition, $\\delta(\\mathbf{x}, a) = D(a)\\,\\delta(\\mathbf{x}, a_{\\mathrm{ini}})$, which implies $D(a_{\\mathrm{ini}}) = 1$. Applying this condition:\n$$\nD(a_{\\mathrm{ini}}) = c_1 a_{\\mathrm{ini}} = 1 \\quad \\implies \\quad c_1 = \\frac{1}{a_{\\mathrm{ini}}}\n$$\nThus, the analytic growing-mode solution is:\n$$\nD_{\\mathrm{ana}}(a) = \\frac{a}{a_{\\mathrm{ini}}} \\quad \\text{or} \\quad D_{\\mathrm{ana}}(x) = \\frac{e^x}{e^{x_{\\mathrm{ini}}}} = e^{x-x_{\\mathrm{ini}}}\n$$\nTo set up the numerical solver, we need initial conditions for $D(x)$ and its derivative $D'(x) = \\frac{dD}{dx}$ at $x_{\\mathrm{ini}} = \\ln(a_{\\mathrm{ini}})$. Based on the analytic solution $D_{\\mathrm{ana}}(x) = e^{x-x_{\\mathrm{ini}}}$:\n$$\nD(x_{\\mathrm{ini}}) = e^{x_{\\mathrm{ini}}-x_{\\mathrm{ini}}} = e^0 = 1\n$$\n$$\nD'(x) = \\frac{d}{dx}e^{x-x_{\\mathrm{ini}}} = e^{x-x_{\\mathrm{ini}}} \\quad \\implies \\quad D'(x_{\\mathrm{ini}}) = e^{x_{\\mathrm{ini}}-x_{\\mathrm{ini}}} = 1\n$$\nThe required initial conditions at $x_{\\mathrm{ini}}$ are $D(x_{\\mathrm{ini}}) = 1$ and $D'(x_{\\mathrm{ini}}) = 1$.\n\n### Task B: Numerical Implementation and Verification\n\nThe numerical task is to solve the ODE and compare it with the derived analytic solution. We use a robust initial value problem solver. The second-order ODE must first be converted into a system of two first-order ODEs. Let the state vector be $\\mathbf{Y}(x) = [y_0(x), y_1(x)]^T$, where $y_0 = D(x)$ and $y_1 = D'(x)$. The system is:\n$$\n\\frac{d\\mathbf{Y}}{dx} = \n\\begin{pmatrix} y_0' \\\\ y_1' \\end{pmatrix} = \n\\begin{pmatrix} y_1 \\\\ -\\frac{1}{2}y_1 + \\frac{3}{2}y_0 \\end{pmatrix}\n$$\nThis system is integrated from the initial point $x_{\\mathrm{ini}} = \\ln(a_{\\mathrm{ini}}) = \\ln(10^{-8})$ to each final point $x_{\\mathrm{end}} = \\ln(a_{\\mathrm{end}})$ from the test suite. The initial state vector is $\\mathbf{Y}(x_{\\mathrm{ini}}) = [1, 1]^T$.\n\nThe implementation will use the `scipy.integrate.solve_ivp` function, which provides high-order adaptive-step methods. To achieve the required accuracy of $\\varepsilon(a_{\\mathrm{end}})  10^{-6}$, we will use a high-order method (e.g., `DOP853`) with tight absolute and relative tolerances, such as $10^{-12}$.\n\nFor each $a_{\\mathrm{end}}$ in the test suite, we compute the numerical solution $D_{\\mathrm{num}}(a_{\\mathrm{end}})$ from the solver. This is then compared to the analytic solution $D_{\\mathrm{ana}}(a_{\\mathrm{end}}) = a_{\\mathrm{end}}/a_{\\mathrm{ini}}$ by calculating the relative error:\n$$\n\\varepsilon(a_{\\mathrm{end}}) \\equiv \\frac{\\left| D_{\\mathrm{num}}(a_{\\mathrm{end}}) - D_{\\mathrm{ana}}(a_{\\mathrm{end}}) \\right|}{\\left| D_{\\mathrm{ana}}(a_{\\mathrm{end}}) \\right|}\n$$\nThe final output will be a list of these relative errors for the specified test points.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Computes the relative error between the numerical and analytical solutions\n    for the linear growth factor in an Einstein-de Sitter universe.\n    \"\"\"\n\n    # Define the first-order ODE system for the growth factor D(x).\n    # The state vector is Y = [D, dD/dx].\n    # The independent variable is x = ln(a).\n    def ode_system(x, Y):\n        \"\"\"\n        The ODE system is dY/dx = F(x, Y).\n        dD/dx = y1\n        d^2D/dx^2 = -0.5 * dD/dx + 1.5 * D\n        \"\"\"\n        D, D_prime = Y\n        D_double_prime = 1.5 * D - 0.5 * D_prime\n        return [D_prime, D_double_prime]\n\n    # Problem parameters\n    a_ini = 1.0e-8\n    test_cases = [1.0e-6, 1.0e-4, 1.0e-2, 1.0e-1, 1.0, 2.0]\n\n    # Convert scale factors to the logarithmic variable x = ln(a)\n    x_ini = np.log(a_ini)\n    \n    # Initial conditions at x_ini that isolate the growing mode, normalized\n    # such that D(a_ini) = 1.\n    # D(x_ini) = 1, D'(x_ini) = 1\n    y_ini = [1.0, 1.0]\n\n    # Set stringent tolerances for the ODE solver to ensure high accuracy.\n    # This is required to meet the error target of  1e-6.\n    rtol = 1.0e-12\n    atol = 1.0e-12\n\n    results = []\n    for a_end in test_cases:\n        x_end = np.log(a_end)\n\n        # The integration interval in terms of x\n        t_span = (x_ini, x_end)\n        \n        # We need the solution only at the final point x_end.\n        # Using t_eval=[x_end] is an efficient way to get this.\n        # 'DOP853' is a high-order method suitable for high-precision integration.\n        sol = solve_ivp(\n            fun=ode_system,\n            t_span=t_span,\n            y0=y_ini,\n            method='DOP853',\n            rtol=rtol,\n            atol=atol,\n            t_eval=[x_end]\n        )\n\n        # Extract the numerical result for D at a_end.\n        # sol.y has shape (number_of_states, number_of_t_eval_points).\n        # Here, it will be (2, 1), and we need the first state's value.\n        D_num = sol.y[0, 0]\n\n        #\n        # Calculate the analytic solution for comparison.\n        # The growing mode solution, normalized as D(a_ini)=1, is D_ana(a) = a / a_ini.\n        D_ana = a_end / a_ini\n\n        # Calculate the relative error as specified in the problem statement.\n        relative_error = np.abs(D_num - D_ana) / np.abs(D_ana)\n        results.append(relative_error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3498601"}, {"introduction": "Once an overdensity becomes sufficiently large, its evolution detaches from the background Hubble expansion and its dynamics become fully non-linear. This practice delves into the classic analytical solution for this process, modeling the overdense region as a \"top-hat\" patch in an Einstein-de Sitter universe. You will verify the elegant cycloid-like parametric solution that describes the shell's trajectory from expansion to collapse, gaining deep insight into the lifecycle of a forming dark matter halo. [@problem_id:3498610]", "problem": "Consider a spherically symmetric, pressureless top-hat overdensity of fixed mass $M$ embedded in an Einstein–de Sitter (EdS) universe, defined as a spatially flat matter-only Friedmann–Lemaître–Robertson–Walker (FLRW) cosmology with matter density parameter $\\Omega_{m}=1$ and cosmological constant $\\Omega_{\\Lambda}=0$. In the spherical collapse model, the physical radius $R(t)$ of the overdense patch obeys Newtonian gravity with radial equation of motion $d^{2}R/dt^{2}=-G M/R^{2}$ and admits a bound solution for sufficiently large initial overdensity. \n\nStarting from the energy integral of Newtonian gravity for radial motion, \n$$\\frac{1}{2}\\,\\dot{R}^{2}-\\frac{G M}{R}=E,$$ \nwith constant specific energy $E0$, show that the bound trajectory can be represented by the cycloid-like parametric solution\n$$R(\\theta)=a\\left(1-\\cos\\theta\\right),\\qquad t(\\theta)=\\sqrt{\\frac{a^{3}}{G M}}\\left(\\theta-\\sin\\theta\\right),$$\nwhere $a0$ is a constant determined by the energy $E$ and mass $M$, $G$ is the gravitational constant, and the time origin is chosen such that $t=0$ at $\\theta=0$. Define the turnaround time $t_{\\text{ta}}$ as the first time at which $dR/dt=0$ and the collapse time $t_{\\text{coll}}$ as the first time at which $R(t)$ returns to zero radius after turnaround. Compute the ratio $t_{\\text{coll}}/t_{\\text{ta}}$ as a single real number. No rounding is required, and no units are needed because the final answer is dimensionless.", "solution": "The problem asks us to first validate a proposed parametric solution for the radial motion of a spherical overdensity and then to compute the ratio of its collapse time to its turnaround time.\n\nFirst, we verify that the parametric solution solves the given energy integral. The problem provides the energy integral for the radial motion of the overdense patch of mass $M$ and radius $R(t)$:\n$$ \\frac{1}{2}\\dot{R}^{2} - \\frac{G M}{R} = E $$\nwhere $\\dot{R} = dR/dt$ and $E  0$ is the constant specific energy for a bound solution.\n\nThe proposed parametric solution is given by:\n$$ R(\\theta) = a(1 - \\cos\\theta) $$\n$$ t(\\theta) = \\sqrt{\\frac{a^{3}}{G M}}(\\theta - \\sin\\theta) $$\nwhere $a$ is a positive constant. The parameter $\\theta$ evolves over time.\n\nTo verify this solution, we must compute $\\dot{R}$ and substitute it along with $R(\\theta)$ into the energy equation. We use the chain rule to find $\\dot{R}$:\n$$ \\dot{R} = \\frac{dR}{dt} = \\frac{dR/d\\theta}{dt/d\\theta} $$\nFirst, we find the derivatives of $R$ and $t$ with respect to $\\theta$:\n$$ \\frac{dR}{d\\theta} = \\frac{d}{d\\theta} \\left[a(1 - \\cos\\theta)\\right] = a\\sin\\theta $$\n$$ \\frac{dt}{d\\theta} = \\frac{d}{d\\theta} \\left[\\sqrt{\\frac{a^{3}}{G M}}(\\theta - \\sin\\theta)\\right] = \\sqrt{\\frac{a^{3}}{G M}}(1 - \\cos\\theta) $$\nNow, we compute their ratio to find $\\dot{R}$:\n$$ \\dot{R} = \\frac{a\\sin\\theta}{\\sqrt{\\frac{a^{3}}{G M}}(1 - \\cos\\theta)} = \\frac{a}{\\sqrt{\\frac{a^{3}}{G M}}} \\frac{\\sin\\theta}{1 - \\cos\\theta} = \\sqrt{\\frac{G M}{a}} \\frac{\\sin\\theta}{1 - \\cos\\theta} $$\nUsing the half-angle trigonometric identities $\\sin\\theta = 2\\sin(\\theta/2)\\cos(\\theta/2)$ and $1 - \\cos\\theta = 2\\sin^{2}(\\theta/2)$, the expression for $\\dot{R}$ simplifies:\n$$ \\dot{R} = \\sqrt{\\frac{G M}{a}} \\frac{2\\sin(\\theta/2)\\cos(\\theta/2)}{2\\sin^{2}(\\theta/2)} = \\sqrt{\\frac{G M}{a}} \\frac{\\cos(\\theta/2)}{\\sin(\\theta/2)} = \\sqrt{\\frac{G M}{a}} \\cot\\left(\\frac{\\theta}{2}\\right) $$\nNext, we substitute $R(\\theta)$ and this expression for $\\dot{R}$ into the energy integral:\n$$ \\frac{1}{2} \\left( \\sqrt{\\frac{G M}{a}} \\cot\\left(\\frac{\\theta}{2}\\right) \\right)^{2} - \\frac{G M}{a(1 - \\cos\\theta)} = E $$\n$$ \\frac{1}{2} \\frac{G M}{a} \\cot^{2}\\left(\\frac{\\theta}{2}\\right) - \\frac{G M}{a(2\\sin^{2}(\\theta/2))} = E $$\nExpressing the cotangent in terms of sine and cosine:\n$$ \\frac{G M}{2a} \\frac{\\cos^{2}(\\theta/2)}{\\sin^{2}(\\theta/2)} - \\frac{G M}{2a\\sin^{2}(\\theta/2)} = E $$\n$$ \\frac{G M}{2a\\sin^{2}(\\theta/2)} \\left( \\cos^{2}(\\frac{\\theta}{2}) - 1 \\right) = E $$\nUsing the identity $\\cos^{2}(x) - 1 = -\\sin^{2}(x)$:\n$$ \\frac{G M}{2a\\sin^{2}(\\theta/2)} \\left( -\\sin^{2}(\\frac{\\theta}{2}) \\right) = E $$\n$$ -\\frac{G M}{2a} = E $$\nThis result shows that the energy $E$ is indeed constant and independent of the parameter $\\theta$ (and thus of time $t$). The constant $a$ is determined by the energy and mass as $a = -GM/(2E)$. Since $E0$ for a bound orbit, $a$ is positive, consistent with the problem statement. This validates the given parametric form as a correct solution to the equation of motion.\n\nNext, we compute the turnaround time, $t_{\\text{ta}}$. Turnaround is defined as the first time at which the expansion halts and the velocity becomes zero, i.e., $\\dot{R}=0$. From our expression for $\\dot{R}$:\n$$ \\dot{R} = \\sqrt{\\frac{G M}{a}} \\cot\\left(\\frac{\\theta}{2}\\right) = 0 $$\nThis requires $\\cot(\\theta/2) = 0$. The initial condition is $t=0$ at $\\theta=0$, which corresponds to $R=0$. The shell expands for $\\theta \\in (0, \\pi)$, where $\\dot{R}0$. The first time after $t=0$ that $\\dot{R}=0$ occurs when $\\theta/2 = \\pi/2$, so $\\theta_{\\text{ta}} = \\pi$.\nThe turnaround time $t_{\\text{ta}}$ is the time corresponding to $\\theta = \\pi$:\n$$ t_{\\text{ta}} = t(\\pi) = \\sqrt{\\frac{a^{3}}{G M}}(\\pi - \\sin\\pi) = \\sqrt{\\frac{a^{3}}{G M}}(\\pi - 0) = \\pi\\sqrt{\\frac{a^{3}}{G M}} $$\nAt this time, the radius reaches its maximum value, $R_{\\text{ta}} = R(\\pi) = a(1 - \\cos\\pi) = 2a$.\n\nFinally, we compute the collapse time, $t_{\\text{coll}}$. This is defined as the first time at which the radius returns to zero after turnaround. We need to find the value of $\\theta  \\theta_{\\text{ta}} = \\pi$ for which $R(\\theta) = 0$:\n$$ R(\\theta) = a(1 - \\cos\\theta) = 0 $$\nSince $a  0$, this implies $1 - \\cos\\theta = 0$, or $\\cos\\theta = 1$. The solutions are $\\theta = 2k\\pi$ for any integer $k$. The initial state is at $k=0$ ($\\theta=0$). The first time the radius returns to zero after turnaround ($\\theta=\\pi$) corresponds to $k=1$, so $\\theta_{\\text{coll}} = 2\\pi$.\nThe collapse time $t_{\\text{coll}}$ is the time corresponding to $\\theta = 2\\pi$:\n$$ t_{\\text{coll}} = t(2\\pi) = \\sqrt{\\frac{a^{3}}{G M}}(2\\pi - \\sin(2\\pi)) = \\sqrt{\\frac{a^{3}}{G M}}(2\\pi - 0) = 2\\pi\\sqrt{\\frac{a^{3}}{G M}} $$\n\nThe problem asks for the ratio $t_{\\text{coll}}/t_{\\text{ta}}$:\n$$ \\frac{t_{\\text{coll}}}{t_{\\text{ta}}} = \\frac{2\\pi\\sqrt{\\frac{a^{3}}{G M}}}{\\pi\\sqrt{\\frac{a^{3}}{G M}}} = 2 $$\nThe ratio is exactly $2$. This indicates that the time taken for the overdensity to collapse back to a point singularity is twice the time it took to expand to its maximum radius. The duration of the collapse phase ($t_{\\text{coll}} - t_{\\text{ta}}$) is equal to the duration of the expansion phase ($t_{\\text{ta}}$).", "answer": "$$\\boxed{2}$$", "id": "3498610"}, {"introduction": "While idealized models provide crucial insights, a realistic description of structure formation must account for the actual components of our Universe, including both matter and dark energy ($\\Lambda$). This final exercise challenges you to build a powerful numerical tool to solve the full equation of spherical collapse in a general Friedmann-Lemaître-Robertson-Walker cosmology. You will learn to handle the stiff differential equations that arise and implement event detection to pinpoint crucial moments like turnaround and collapse, equipping you with a practical code similar to those used in modern cosmological research. [@problem_id:3498600]", "problem": "Consider a spherically symmetric top-hat overdensity embedded in an expanding Friedmann–Lemaître–Robertson–Walker background. Let the background cosmology be characterized by present-day matter density parameter $\\Omega_{\\mathrm{m}0}$, cosmological constant density parameter $\\Omega_{\\Lambda 0}$, and Hubble parameter $H_{0}$. Let the scale factor be $a$, and define the dimensionless Hubble function $E(a) \\equiv H(a)/H_{0}$, with\n$$\nE(a) = \\sqrt{\\Omega_{\\mathrm{m}0}\\,a^{-3} + \\Omega_{k0}\\,a^{-2} + \\Omega_{\\Lambda 0}}, \\quad \\Omega_{k0} \\equiv 1 - \\Omega_{\\mathrm{m}0} - \\Omega_{\\Lambda 0}.\n$$\nLet the initial scale factor be $a_{i}$, and the initial top-hat overdensity be $\\delta_{i}$ at $a=a_{i}$. Denote the physical radius of the top-hat by $R(t)$, and define the dimensionless radius variable\n$$\ny(a) \\equiv \\frac{R(a)}{R(a_{i})},\n$$\nso that $y(a_{i}) = 1$. The mass inside the top-hat is conserved, $M = \\frac{4\\pi}{3} R^{3} \\rho_{\\mathrm{b}}(a) [1+\\delta(a)]$, with background matter density $\\rho_{\\mathrm{b}}(a) = \\rho_{\\mathrm{c}0}\\,\\Omega_{\\mathrm{m}0}\\,a^{-3}$ and critical density $\\rho_{\\mathrm{c}0} = 3 H_{0}^{2}/(8\\pi G)$. The spherical top-hat evolves under the Newtonian equation of motion with a cosmological constant,\n$$\n\\ddot{R} = -\\frac{G M}{R^{2}} + \\frac{\\Lambda}{3} R, \\quad \\Lambda = 3 H_{0}^{2} \\Omega_{\\Lambda 0},\n$$\nwhere overdots denote derivatives with respect to cosmic time $t$.\n\nYour tasks are:\n1. Derive a second-order ordinary differential equation in the independent variable $a$ for $y(a)$ that is suitable for numerical integration as a stiff system. You must start from the equation of motion above and the chain rule $d/dt = a H(a) d/da$, where $H(a) = H_{0} E(a)$. Express your final equation entirely in terms of $a$, $y$, $\\Omega_{\\mathrm{m}0}$, $\\Omega_{\\Lambda 0}$, $a_{i}$, and $\\delta_{i}$, and constants. Do not assume a specific gauge beyond the Newtonian treatment appropriate for sub-horizon spherical collapse.\n2. Specify initial conditions at $a=a_{i}$ for $y(a)$ and $dy/da$. Your initial conditions must be given explicitly in terms of $a_{i}$ and $\\delta_{i}$.\n3. Design an adaptive-step integrator with event detection for:\n   - Turnaround, defined by the condition $dy/da = 0$ (equivalently $\\dot{R} = 0$).\n   - Collapse, defined by the condition $y(a) = y_{\\mathrm{thr}}$, with a prescribed small threshold $y_{\\mathrm{thr}}$ representing practical collapse ($y_{\\mathrm{thr}} \\ll 1$).\n   The integrator must be robust for stiff behavior near collapse and must terminate at collapse or at a maximum scale factor $a_{\\max}$ if the collapse event does not occur.\n4. Implement the above as a complete, runnable program that:\n   - Integrates the system in the independent variable $a$ using an implicit, stiff solver with adaptive step-size.\n   - Implements event detection for both turnaround and collapse.\n   - Returns, for each test input, a pair of floating-point numbers `[a_ta, a_coll]` where $a_{\\mathrm{ta}}$ is the turnaround scale factor and $a_{\\mathrm{coll}}$ is the collapse scale factor (using the threshold), or $-1.0$ if not attained by $a_{\\max}$.\n   - Uses dimensionless units for all quantities. No physical units should appear in the output.\n   - Uses radians for any angle if applicable, although angles are not explicitly required here.\n\nUse the following system form for numerical integration. Introduce the state vector $u(a) = (y(a), v(a))$, where $v(a) \\equiv dy/da$. Your system must have the form\n$$\n\\frac{dy}{da} = v, \\quad \\frac{dv}{da} = F(a, y, v; \\Omega_{\\mathrm{m}0}, \\Omega_{\\Lambda 0}, a_{i}, \\delta_{i}),\n$$\nwith $F$ derived from first principles.\n\nThe initial conditions at $a=a_{i}$ are:\n$$\ny(a_{i}) = 1, \\quad \\left.\\frac{dy}{da}\\right|_{a=a_{i}} = \\frac{1}{a_{i}}\\left[1 - \\frac{2}{3}\\,\\delta_{i}\\right]\n$$\n\nNumerical details:\n- Use an adaptive stiff solver with event detection. The turnaround event is $v(a)=0$ with negative-going direction, and the collapse event is $y(a)-y_{\\mathrm{thr}}=0$ with negative-going direction.\n- Use $y_{\\mathrm{thr}} = 10^{-3}$ as the collapse threshold.\n- If an event does not occur by $a_{\\max}$, report $-1.0$ for that quantity.\n- The independent variable $a$ is dimensionless, and all other quantities are dimensionless. No physical units are required in the output.\n\nTest suite:\n- Case $1$: $\\Omega_{\\mathrm{m}0} = 1.0$, $\\Omega_{\\Lambda 0} = 0.0$, $\\delta_{i} = 0.01$, $a_{i} = 10^{-3}$, $a_{\\max} = 1.0$.\n- Case $2$: $\\Omega_{\\mathrm{m}0} = 0.3$, $\\Omega_{\\Lambda 0} = 0.7$, $\\delta_{i} = 0.005$, $a_{i} = 10^{-3}$, $a_{\\max} = 3.0$.\n- Case $3$: $\\Omega_{\\mathrm{m}0} = 0.2$, $\\Omega_{\\Lambda 0} = 0.0$, $\\delta_{i} = 0.001$, $a_{i} = 10^{-3}$, $a_{\\max} = 10.0$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for the three cases as a comma-separated list of lists enclosed in square brackets, for example\n\"[[a_ta1,a_coll1],[a_ta2,a_coll2],[a_ta3,a_coll3]]\",\nwhere each $a_{\\mathrm{ta}}$ and $a_{\\mathrm{coll}}$ is a floating-point number and any missing event is marked by $-1.0$.", "solution": "The user has provided a well-posed problem from the field of physical cosmology, specifically concerning the numerical solution of the spherical collapse model. The problem statement is scientifically grounded, self-contained, and internally consistent. All necessary parameters and initial conditions for a unique solution are provided. We shall proceed with the derivation and numerical implementation.\n\nThe solution is structured as follows:\n$1$. Derivation of the second-order ordinary differential equation (ODE) for the dimensionless radius $y(a)$ with respect to the scale factor $a$.\n$2$. Formulation of the initial value problem, including the system of first-order ODEs and the specified initial conditions.\n$3$. Description of the numerical integration strategy, including the choice of solver and the implementation of event detection for turnaround and collapse.\n\n### 1. Derivation of the Equation of Motion\n\nThe starting point is the Newtonian equation of motion for the physical radius $R(t)$ of the spherical top-hat, including the effect of a cosmological constant $\\Lambda$:\n$$\n\\ddot{R} = -\\frac{G M}{R^{2}} + \\frac{\\Lambda}{3} R\n$$\nwhere overdots denote derivatives with respect to cosmic time $t$, $G$ is the gravitational constant, and $M$ is the mass enclosed within the radius $R$, which is conserved.\n\nThe mass $M$ can be expressed in terms of the initial conditions at scale factor $a_i$. The density inside the shell is $\\rho(a_i) = \\rho_{\\mathrm{b}}(a_i) (1+\\delta_i)$, where $\\rho_{\\mathrm{b}}(a)$ is the background matter density and $\\delta_i$ is the initial overdensity.\n$$\nM = \\frac{4\\pi}{3} R(a_i)^3 \\rho_{\\mathrm{b}}(a_i) (1+\\delta_i)\n$$\nUsing the definitions $\\rho_{\\mathrm{b}}(a) = \\rho_{\\mathrm{c}0}\\,\\Omega_{\\mathrm{m}0}\\,a^{-3}$ and $\\rho_{\\mathrm{c}0} = 3 H_{0}^{2}/(8\\pi G)$, we can write the mass as:\n$$\nM = \\frac{4\\pi}{3} R(a_i)^3 \\left( \\frac{3 H_0^2}{8\\pi G} \\Omega_{\\mathrm{m}0} a_i^{-3} \\right) (1+\\delta_i) = \\frac{H_0^2 \\Omega_{\\mathrm{m}0} (1+\\delta_i) R(a_i)^3}{2 G a_i^3}\n$$\nThe cosmological constant is given by $\\Lambda = 3 H_{0}^{2} \\Omega_{\\Lambda 0}$. Substituting the expressions for $M$ and $\\Lambda$ into the equation of motion yields:\n$$\n\\ddot{R} = -\\frac{G}{R^2} \\left( \\frac{H_0^2 \\Omega_{\\mathrm{m}0} (1+\\delta_i) R(a_i)^3}{2 G a_i^3} \\right) + \\frac{3 H_0^2 \\Omega_{\\Lambda 0}}{3} R\n$$\n$$\n\\ddot{R} = -\\frac{H_0^2 \\Omega_{\\mathrm{m}0} (1+\\delta_i)}{2 a_i^3} \\frac{R(a_i)^3}{R^2} + H_0^2 \\Omega_{\\Lambda 0} R\n$$\nWe introduce the dimensionless radius $y(a) \\equiv R(a)/R(a_i)$, which implies $R(a) = R(a_i) y(a)$. Differentiating with respect to time gives $\\ddot{R} = R(a_i) \\ddot{y}$. Substituting this into the equation and dividing by $R(a_i)$ gives an equation for $y$:\n$$\n\\ddot{y} = -\\frac{H_0^2 \\Omega_{\\mathrm{m}0} (1+\\delta_i)}{2 a_i^3 y^2} + H_0^2 \\Omega_{\\Lambda 0} y\n$$\nNext, we change the independent variable from cosmic time $t$ to the scale factor $a$. The chain rule for time derivatives is $\\frac{d}{dt} = \\frac{da}{dt} \\frac{d}{da} = \\dot{a} \\frac{d}{da}$. Since $H = \\dot{a}/a$, we have $\\dot{a} = a H(a) = a H_0 E(a)$. Thus, $\\frac{d}{dt} = a H_0 E(a) \\frac{d}{da}$.\nThe first derivative of $y$ is:\n$$\n\\dot{y} = \\frac{dy}{dt} = a H_0 E(a) \\frac{dy}{da}\n$$\nThe second derivative is:\n$$\n\\ddot{y} = \\frac{d\\dot{y}}{dt} = a H_0 E(a) \\frac{d}{da} \\left( a H_0 E(a) \\frac{dy}{da} \\right)\n$$\n$$\n\\ddot{y} = a H_0^2 E(a) \\left[ \\frac{d(a E(a))}{da} \\frac{dy}{da} + a E(a) \\frac{d^2y}{da^2} \\right]\n$$\n$$\n\\ddot{y} = a H_0^2 E(a) \\left[ \\left(E(a) + a \\frac{dE}{da}\\right) \\frac{dy}{da} + a E(a) \\frac{d^2y}{da^2} \\right]\n$$\nEquating the two expressions for $\\ddot{y}$ and cancelling $H_0^2$:\n$$\na E(a) \\left[ \\left(E(a) + a \\frac{dE}{da}\\right) \\frac{dy}{da} + a E(a) \\frac{d^2y}{da^2} \\right] = -\\frac{\\Omega_{\\mathrm{m}0} (1+\\delta_i)}{2 a_i^3 y^2} + \\Omega_{\\Lambda 0} y\n$$\nWe now solve for $\\frac{d^2y}{da^2}$. Let $v(a) \\equiv \\frac{dy}{da}$.\n$$\na^2 E(a)^2 \\frac{d^2y}{da^2} = -a E(a) \\left(E(a) + a \\frac{dE}{da}\\right) v + \\Omega_{\\Lambda 0} y - \\frac{\\Omega_{\\mathrm{m}0} (1+\\delta_i)}{2 a_i^3 y^2}\n$$\nTo simplify the coefficient of $v$, we evaluate the term $a \\frac{d(a E^2)}{da} / 2 = a(E^2 + a \\cdot 2 E \\frac{dE}{da})/2 = aE^2 + a^2 E \\frac{dE}{da}$.\nFrom $E(a)^2 = \\Omega_{\\mathrm{m}0} a^{-3} + \\Omega_{k0} a^{-2} + \\Omega_{\\Lambda 0}$, we have:\n$$\na E(a)^2 = \\Omega_{\\mathrm{m}0} a^{-2} + \\Omega_{k0} a^{-1} + \\Omega_{\\Lambda 0} a\n$$\nAnd $2 E \\frac{dE}{da} = -3 \\Omega_{\\mathrm{m}0} a^{-4} - 2 \\Omega_{k0} a^{-3}$, which gives $a^2 E \\frac{dE}{da} = \\frac{a^2}{2}(-3 \\Omega_{\\mathrm{m}0} a^{-4} - 2 \\Omega_{k0} a^{-3}) = -\\frac{3}{2}\\Omega_{\\mathrm{m}0}a^{-2} - \\Omega_{k0}a^{-1}$.\nThe coefficient of $v$ involves the sum:\n$$\n-\\left( a E(a)^2 + a^2 E \\frac{dE}{da} \\right) = - \\left( (\\Omega_{\\mathrm{m}0} a^{-2} - \\frac{3}{2}\\Omega_{\\mathrm{m}0}a^{-2}) + (\\Omega_{k0} a^{-1} - \\Omega_{k0}a^{-1}) + \\Omega_{\\Lambda 0} a \\right) = \\frac{1}{2}\\Omega_{\\mathrm{m}0}a^{-2} - \\Omega_{\\Lambda 0}a\n$$\nSubstituting this back, we get the equation for $\\frac{d^2y}{da^2}$:\n$$\n\\frac{d^2y}{da^2} = \\frac{1}{a^2 E(a)^2} \\left[ \\left( \\frac{1}{2}\\Omega_{\\mathrm{m}0}a^{-2} - \\Omega_{\\Lambda 0}a \\right)v + \\Omega_{\\Lambda 0} y - \\frac{\\Omega_{\\mathrm{m}0}(1+\\delta_i)}{2 a_i^3 y^2} \\right]\n$$\nThis is the required second-order ODE for $y(a)$.\n\n### 2. Initial Value Problem Formulation\n\nTo solve this numerically, we convert the second-order ODE into a system of two first-order ODEs. Let the state vector be $u(a) = \\begin{pmatrix} y(a) \\\\ v(a) \\end{pmatrix}$, where $v(a) = \\frac{dy}{da}$. The system is:\n$$\n\\frac{du}{da} = \n\\begin{pmatrix} \\frac{dy}{da} \\\\ \\frac{dv}{da} \\end{pmatrix}\n=\n\\begin{pmatrix} v \\\\ F(a, y, v) \\end{pmatrix}\n$$\nwhere\n$$\nF(a, y, v) = \\frac{1}{a^2 E(a)^2} \\left[ \\left( \\frac{1}{2}\\Omega_{\\mathrm{m}0}a^{-2} - \\Omega_{\\Lambda 0}a \\right)v + \\Omega_{\\Lambda 0} y - \\frac{\\Omega_{\\mathrm{m}0}(1+\\delta_i)}{2 a_i^3 y^2} \\right]\n$$\nwith $E(a)^2 = \\Omega_{\\mathrm{m}0}a^{-3} + (1-\\Omega_{\\mathrm{m}0}-\\Omega_{\\Lambda 0})a^{-2} + \\Omega_{\\Lambda 0}$.\n\nThe problem specifies the initial conditions at $a=a_i$:\n- $y(a_i) = 1$\n- $v(a_i) = \\left.\\frac{dy}{da}\\right|_{a=a_i} = \\frac{1}{a_i} \\left[ 1 - \\frac{2}{3} \\delta_i \\right]$\nThe initial state vector is therefore $u(a_i) = \\left( 1, \\frac{1}{a_i} [1 - \\frac{2}{3}\\delta_i] \\right)$.\n\n### 3. Numerical Integration Strategy\n\nThe ODE system exhibits stiff behavior, particularly near collapse ($y \\to 0$) where the term proportional to $1/y^2$ causes the derivatives to become very large. An implicit solver with adaptive step-sizing is required for a robust and efficient solution. We will use `scipy.integrate.solve_ivp` with the `Radau` method, which is designed for stiff problems.\n\nThe problem requires detecting two specific events during the integration:\n1.  **Turnaround**: Occurs when the shell reaches its maximum radius and begins to contract. This corresponds to the physical velocity $\\dot{R}$ changing sign from positive to negative. Since $\\dot{y} = a H_0 E(a) v(a)$, and both $a$ and $E(a)$ are positive, this is equivalent to $v(a) = \\frac{dy}{da}$ crossing zero from positive to negative. The event function is $v(a) = 0$, and we seek a root where the function is decreasing (direction = $-1$). This event is non-terminal.\n2.  **Collapse**: Defined as the point where the dimensionless radius $y(a)$ shrinks to a small threshold value $y_{\\mathrm{thr}} = 10^{-3}$. The event function is $y(a) - y_{\\mathrm{thr}} = 0$. Since the shell is collapsing, $y(a)$ is decreasing, so we seek a root where the function is decreasing (direction = $-1$). This event is terminal, halting the integration.\n\nThe integration for each test case will proceed from $a=a_i$ up to a maximum scale factor $a_{\\max}$. The times (scale factors) of any detected events are recorded. If an event is not detected by $a_{\\max}$, its corresponding scale factor is reported as $-1.0$.\n\nThe implementation combines these components into a single function that iterates through the provided test cases, solves the initial value problem for each, extracts the turnaround and collapse scale factors, and formats the output as specified.", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the spherical collapse model ODE for given cosmological parameters.\n    \"\"\"\n\n    test_cases = [\n        # (Omega_m0, Omega_L0, delta_i, a_i, a_max)\n        (1.0, 0.0, 0.01, 1e-3, 1.0),\n        (0.3, 0.7, 0.005, 1e-3, 3.0),\n        (0.2, 0.0, 0.001, 1e-3, 10.0),\n    ]\n\n    y_thr = 1e-3\n    results = []\n\n    for params in test_cases:\n        Omega_m0, Omega_L0, delta_i, a_i, a_max = params\n        Omega_k0 = 1.0 - Omega_m0 - Omega_L0\n\n        def spherical_collapse_ode(a, u, p):\n            \"\"\"\n            Defines the system of ODEs for the spherical collapse model.\n            u = [y, v] where y is the dimensionless radius and v = dy/da.\n            p = [Omega_m0, Omega_L0, Omega_k0, delta_i, a_i]\n            \"\"\"\n            y, v = u\n            Omega_m0_p, Omega_L0_p, Omega_k0_p, delta_i_p, a_i_p = p\n            \n            # Avoid division by zero if y is non-positive, though the solver\n            # and collapse event should prevent this.\n            if y = 0:\n                # Return large derivatives to signify a problematic state\n                return [v, -1e100]\n\n            # E(a)^2 = H(a)^2 / H0^2\n            E_sq = Omega_m0_p * a**-3 + Omega_k0_p * a**-2 + Omega_L0_p\n\n            # dv/da = F(a, y, v)\n            # F = (1/(a^2 E^2)) * [ term_v * v + term_y * y + term_const ]\n            \n            # Coefficient of v in the numerator of dv/da\n            v_coeff = 0.5 * Omega_m0_p * a**-2 - Omega_L0_p * a\n            \n            # term with y\n            y_term = Omega_L0_p * y\n\n            # term independent of v and y (inside the bracket)\n            const_term = -0.5 * Omega_m0_p * (1.0 + delta_i_p) / (a_i_p**3 * y**2)\n\n            dv_da = (v_coeff * v + y_term + const_term) / (a**2 * E_sq)\n            \n            return [v, dv_da]\n\n        # Initial conditions\n        y0 = 1.0\n        v0 = (1.0 / a_i) * (1.0 - (2.0 / 3.0) * delta_i)\n        u0 = [y0, v0]\n\n        # Event: Turnaround (dy/da = v = 0)\n        def turnaround(a, u, p):\n            return u[1]\n        turnaround.terminal = False\n        turnaround.direction = -1  # Event triggers when v goes from positive to negative\n\n        # Event: Collapse (y = y_thr)\n        def collapse(a, u, p):\n            return u[0] - y_thr\n        collapse.terminal = True\n        collapse.direction = -1   # Event triggers when y decreases through y_thr\n\n        # Integration span\n        t_span = (a_i, a_max)\n\n        # Solve the ODE\n        sol = solve_ivp(\n            fun=spherical_collapse_ode,\n            t_span=t_span,\n            y0=u0,\n            method='Radau',\n            args=([Omega_m0, Omega_L0, Omega_k0, delta_i, a_i],),\n            events=[turnaround, collapse],\n            dense_output=True,\n            atol=1e-9,  # Absolute tolerance\n            rtol=1e-9,  # Relative tolerance\n        )\n        \n        # Extract results\n        a_ta = -1.0\n        if sol.t_events[0].size  0:\n            a_ta = sol.t_events[0][0]\n\n        a_coll = -1.0\n        if sol.t_events[1].size  0:\n            a_coll = sol.t_events[1][0]\n        # In case the terminal event didn't trigger correctly but integration stopped\n        elif sol.status == 1 and sol.y[0, -1] = y_thr:\n            a_coll = sol.t[-1]\n\n        results.append([a_ta, a_coll])\n\n    # Format the final output string\n    str_results = [f\"[{r[0]},{r[1]}]\" for r in results]\n    print(f\"[{','.join(str_results)}]\")\n\n\nsolve()\n```", "id": "3498600"}]}