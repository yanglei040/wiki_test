{"hands_on_practices": [{"introduction": "Any stable explicit numerical simulation must respect causality, a principle captured by the Courant–Friedrichs–Lewy (CFL) condition. Artificial viscosity introduces a numerical signal speed to handle shocks, which in turn imposes a strict limit on the simulation's time step. This first exercise will guide you through calculating this fundamental time step limit, connecting the abstract stability condition to concrete SPH parameters. [@problem_id:3465304]", "problem": "In Smoothed Particle Hydrodynamics (SPH) used for numerical cosmology, artificial viscosity introduces a characteristic pairwise signal velocity that bounds the speed at which compressive disturbances propagate between neighbors. For an explicitly time-integrated method, stability and causality impose that information must not traverse more than an order-unity fraction of the local resolution scale in a single time step, a requirement commonly captured by the Courant–Friedrichs–Lewy (CFL) condition. Consider a single SPH particle evolving under hydrodynamics and gravity in a cosmological setting, with local smoothing length $h$ and an estimate of the maximum pairwise artificial-viscosity signal speed over its neighbors, $v_{\\text{sig}}$. Assume a standard explicit scheme in which the only relevant bound is that set by finite signal propagation over the kernel scale, modulated by a dimensionless Courant factor $C_{\\text{CFL}} \\in (0,1)$.\n\nStarting from these principles and definitions, derive a general expression for the particle’s maximum allowed time step $\\Delta t_{\\max}$ in terms of $h$, $v_{\\text{sig}}$, and $C_{\\text{CFL}}$. Then evaluate this maximum time step for a particle with $h = 0.005$, neighbor-maximum $v_{\\text{sig}} = 30$, and $C_{\\text{CFL}} = 0.25$. All quantities are given in consistent code units so that the resulting time step is in code time units. Round your final numerical answer to $4$ significant figures. Finally, based on your derivation, discuss the implications of this bound for local time-stepping strategies in cosmological simulations, particularly in regions with strong shocks and large density contrasts. Your final reported answer must be the single numerical value of $\\Delta t_{\\max}$ in code time units.", "solution": "The relevant starting point is the stability constraint for explicit time integration in hyperbolic systems with finite signal propagation speeds. In such systems, the Courant–Friedrichs–Lewy (CFL) condition enforces that in one time step, the fastest signal should not traverse more than an order-unity fraction of the local resolution scale. In Smoothed Particle Hydrodynamics (SPH), the local resolution scale is set by the smoothing length $h$, while the maximal neighbor-to-neighbor propagation speed of compressive disturbances in the presence of artificial viscosity is captured by an estimate $v_{\\text{sig}}$ constructed from pairwise interactions.\n\nThe fundamental requirement is that the distance traversed by the fastest relevant signal during a time step $\\Delta t$ is bounded by a fraction of the resolution length. Writing this causality and stability constraint,\n$$\nv_{\\text{sig}} \\, \\Delta t \\lesssim C_{\\text{CFL}} \\, h,\n$$\nwhere $C_{\\text{CFL}} \\in (0,1)$ is a dimensionless Courant factor that encodes the geometric constants of the kernel support, details of the explicit scheme, and a safety margin for nonlinearities and multi-dimensional effects. Solving this for the time step bound gives the general expression\n$$\n\\Delta t_{\\max} = \\frac{C_{\\text{CFL}} \\, h}{v_{\\text{sig}}}.\n$$\n\nThis follows directly from (i) the definition of the SPH smoothing length $h$ as the characteristic kernel scale over which interactions are resolved, (ii) the identification of $v_{\\text{sig}}$ as an upper bound to the neighbor-to-neighbor information speed introduced by artificial viscosity to capture compressive shocks, and (iii) the stability requirement of explicit methods that the domain of dependence of the discrete scheme must contain that of the continuum problem.\n\nWe now evaluate this expression for the specified particle data. Given $h = 0.005$, $v_{\\text{sig}} = 30$, and $C_{\\text{CFL}} = 0.25$, all in consistent code units, we substitute into\n$$\n\\Delta t_{\\max} = \\frac{C_{\\text{CFL}} \\, h}{v_{\\text{sig}}}.\n$$\nCompute the numerator:\n$$\nC_{\\text{CFL}} \\, h = 0.25 \\times 0.005 = 0.00125.\n$$\nDivide by $v_{\\text{sig}}$:\n$$\n\\Delta t_{\\max} = \\frac{0.00125}{30} = 0.000041666\\ldots = 4.166666\\ldots \\times 10^{-5}.\n$$\nRounding to $4$ significant figures yields\n$$\n\\Delta t_{\\max} = 4.167 \\times 10^{-5},\n$$\nin code time units.\n\nImplications for local time-stepping in cosmological simulations: The derived bound shows that $\\Delta t_{\\max} \\propto h / v_{\\text{sig}}$. In cosmological structure formation, high-density regions such as virialized halos and shock fronts typically have smaller $h$ (due to Lagrangian adaptivity concentrating resolution) and larger $v_{\\text{sig}}$ (due to enhanced sound speeds and relative velocities across compressive flows that trigger stronger artificial viscosity). Consequently, $\\Delta t_{\\max}$ can decrease by orders of magnitude in these regions compared to the diffuse intergalactic medium. Local time-stepping schemes exploit this by assigning smaller time steps only where needed, thus maintaining accuracy and stability near shocks while avoiding a global time step limited by a tiny subset of particles. However, this introduces challenges: synchronization between hydrodynamics and long-range gravity solvers, conservation errors if neighboring particles evolve with disparate time steps, and the need for time-step limiters to prevent large disparities across interacting neighbors. In comoving formulations, care must also be taken that $v_{\\text{sig}}$ and $h$ are consistently defined in the same (physical or comoving) frame so that the CFL bound remains meaningful. Overall, the scaling $\\Delta t_{\\max} \\sim h / v_{\\text{sig}}$ motivates hierarchical local time-stepping with neighbor-aware limiters in realistic cosmological flows.", "answer": "$$\\boxed{4.167 \\times 10^{-5}}$$", "id": "3465304"}, {"introduction": "While essential for capturing shocks, artificial viscosity can be a blunt instrument, introducing unwanted dissipation in purely rotational or shear flows. To refine its application, modern SPH codes employ 'switches' that modulate the viscosity based on local flow kinematics. In this practice, you will derive a common switch from first principles, learning how to distinguish between compressive and vortical motion to apply viscosity intelligently. [@problem_id:3465306]", "problem": "In cosmological Smoothed Particle Hydrodynamics (SPH), artificial viscosity is introduced to capture shocks while avoiding spurious dissipation in vortical or shear-dominated flows. A common strategy is to modulate the artificial viscosity coefficient by a switch factor that suppresses viscosity in regions where vorticity dominates over compression. Consider a switch function $f$ that multiplies a base artificial viscosity coefficient $\\alpha$, so that the effective coefficient is $f \\alpha$. The switch $f$ should satisfy the following principles derived from first principles and dimensional analysis:\n\n- It depends only on kinematic invariants that distinguish compression from rotation, namely the divergence magnitude $\\left|\\nabla \\cdot \\mathbf{v}\\right|$ and the vorticity magnitude $\\left|\\nabla \\times \\mathbf{v}\\right|$.\n- It is dimensionless, bounded between $0$ and $1$, increases monotonically with $\\left|\\nabla \\cdot \\mathbf{v}\\right|$ at fixed $\\left|\\nabla \\times \\mathbf{v}\\right|$, and decreases monotonically with $\\left|\\nabla \\times \\mathbf{v}\\right|$ at fixed $\\left|\\nabla \\cdot \\mathbf{v}\\right|$.\n- It remains well-defined in quiescent flows by including a regularizing term constructed from the local signal speed $c$ and smoothing length $h$, combined with a small dimensionless parameter $\\epsilon0$, such that the combination has the same dimensions as $\\left|\\nabla \\cdot \\mathbf{v}\\right|$ and $\\left|\\nabla \\times \\mathbf{v}\\right|$.\n\n(a) Using these requirements, construct the simplest admissible form of $f$ built from nonnegative linear contributions of the admissible invariants that respects the stated monotonicity, boundedness, and dimensional constraints.\n\n(b) For a locally vortical flow in a cosmological SPH calculation with $\\left|\\nabla \\cdot \\mathbf{v}\\right|=0.01$, $\\left|\\nabla \\times \\mathbf{v}\\right|=10$, $c=1$, $h=0.05$, $\\epsilon=0.1$, and base coefficient $\\alpha=1$, evaluate the switch $f$ and the effective artificial viscosity coefficient $f\\alpha$.\n\nRound your numerical results for $f$ and $f\\alpha$ to four significant figures. Report your final answers as two numbers without units in the order $\\left(f, f\\alpha\\right)$.", "solution": "(a) To construct the switch function $f$, we follow the given principles. It must be a dimensionless function of the divergence magnitude, $D = |\\nabla \\cdot \\mathbf{v}|$, and the vorticity magnitude, $W = |\\nabla \\times \\mathbf{v}|$, that increases with $D$ and decreases with $W$. The simplest rational function form satisfying these is $f = D / (D + W)$. To ensure it is well-defined in quiescent flows ($D, W \\to 0$), we add a regularization term in the denominator. This term must have the dimensions of divergence, $[T^{-1}]$, and is constructed from the sound speed $c$, smoothing length $h$, and dimensionless parameter $\\epsilon$. The combination $\\epsilon c / h$ has the correct dimensions. Thus, the final form of the switch, commonly known as the Balsara switch, is:\n$$f = \\frac{|\\nabla \\cdot \\mathbf{v}|}{|\\nabla \\cdot \\mathbf{v}| + |\\nabla \\times \\mathbf{v}| + \\epsilon \\frac{c}{h}}$$\nThis function is bounded between 0 and 1 and satisfies all the required constraints.\n\n(b) We evaluate this function with the given parameters: $|\\nabla \\cdot \\mathbf{v}|=0.01$, $|\\nabla \\times \\mathbf{v}|=10$, $c=1$, $h=0.05$, $\\epsilon=0.1$, and base coefficient $\\alpha=1$. First, we compute the regularization term:\n$$ \\epsilon \\frac{c}{h} = 0.1 \\times \\frac{1}{0.05} = 2.0 $$\nSubstituting into the expression for $f$:\n$$ f = \\frac{0.01}{0.01 + 10 + 2} = \\frac{0.01}{12.01} \\approx 0.000832639... $$\nRounding to four significant figures, $f = 0.0008326$. The effective viscosity coefficient is $f\\alpha$. Since $\\alpha = 1$, we have $f\\alpha = 0.0008326$. The reported answer is $(0.0008326, 0.0008326)$. This extremely low value for the switch function is expected, as the flow is strongly dominated by vorticity over compression, which is precisely the situation where artificial viscosity should be suppressed.", "answer": "$$ \\boxed{ \\begin{pmatrix} 0.0008326  0.0008326 \\end{pmatrix} } $$", "id": "3465306"}, {"introduction": "Numerical schemes often have unintended physical consequences, and artificial viscosity is no exception. The term introduced for shock capturing also acts as an effective shear viscosity, setting a numerical dissipation scale that can influence physical phenomena like turbulence. This final exercise bridges the gap between numerical parameters and fluid dynamics by calculating the effective Reynolds number of the simulated flow, offering a profound insight into the resolving power of an SPH simulation. [@problem_id:3465305]", "problem": "In a three-dimensional isothermal turbulent flow modeled with Smooth Particle Hydrodynamics (SPH), consider a periodic domain of characteristic size $L$ and a characteristic turbulent velocity $U$. The gas is isothermal with sound speed $c_s$, and the SPH smoothing length is $h$. Artificial viscosity is included using the standard Monaghan form with linear parameter $\\alpha$ and quadratic parameter $\\beta$, but assume a transonic regime and weak shocks so that the quadratic term can be neglected and the Balsara switch is ineffective in suppressing shear. The SPH momentum equation includes the artificial viscosity contribution through a pairwise term $\\Pi_{ij}$ added to the pressure term.\n\nStarting from the continuum limit of the SPH momentum equation and interpreting the linear artificial viscosity as an effective Navier–Stokes shear viscosity, argue how a kinematic viscosity of the form $\\nu_{\\text{eff}} = C\\,\\alpha\\,c_s\\,h$ arises, where $C$ is a dimensionless constant determined by the kernel’s second moment. For the three-dimensional cubic spline kernel, take $C=\\frac{1}{10}$.\n\nUsing this effective viscosity model, compute the effective Reynolds number\n$$\nRe \\equiv \\frac{U\\,L}{\\nu_{\\text{eff}}}\n$$\nfor the parameter choices $U=1$, $L=1$, $c_s=1$, $h=0.01$, and $\\alpha=0.1$. Express your final Reynolds number as a dimensionless number in standard scientific notation, rounded to four significant figures.\n\nThen, based on your result and the numerical dissipation scale set by $h$, briefly discuss in words whether an extended inertial range can be resolved in such an SPH calculation when $L/h=100$. Your discussion should not be included in the final numerical answer.", "solution": "The linear term of the Monaghan artificial viscosity acts as a numerical dissipation term. In the continuum limit, this term can be shown to correspond to an effective physical viscosity in the Navier-Stokes equations. The resulting effective kinematic shear viscosity, $\\nu_{\\text{eff}}$, for SPH with a linear viscosity parameter $\\alpha$ is standardly derived to be proportional to the product of the sound speed $c_s$ and the smoothing length $h$. The specific form is:\n$$\n\\nu_{\\text{eff}} = C\\,\\alpha\\,c_s\\,h\n$$\nwhere $C$ is a dimensionless constant that depends on the SPH kernel. For the 3D cubic spline kernel, $C = \\frac{1}{10}$.\n\nGiven the parameters $C=0.1$, $\\alpha=0.1$, $c_s=1$, and $h=0.01$, we can compute the effective viscosity:\n$$\n\\nu_{\\text{eff}} = (0.1) \\times (0.1) \\times (1) \\times (0.01) = 0.0001 = 1 \\times 10^{-4}\n$$\nThe effective Reynolds number, $Re$, is defined by the characteristic velocity $U$, the characteristic size $L$, and the effective kinematic viscosity $\\nu_{\\text{eff}}$:\n$$\nRe = \\frac{U\\,L}{\\nu_{\\text{eff}}}\n$$\nUsing the provided values $U=1$ and $L=1$:\n$$\nRe = \\frac{1 \\times 1}{1 \\times 10^{-4}} = 10^4\n$$\nIn standard scientific notation rounded to four significant figures, this is $1.000 \\times 10^4$.\n\n**Discussion:** A Reynolds number of $10^4$ indicates a turbulent flow. For a simulation to resolve the inertial range of turbulence, the energy injection scale $L$ must be significantly larger than the numerical dissipation scale, set by the SPH smoothing length $h$. Here, the ratio is $L/h = 1/0.01 = 100$. This separation of two orders of magnitude is generally sufficient to resolve a portion of the inertial cascade, allowing for the study of turbulent properties, although it may not capture the full extent of the cascade down to the physical Kolmogorov scale, which would be $\\eta_K \\sim L Re^{-3/4} = 10^{-3}$, a scale smaller than $h$.", "answer": "$$\\boxed{1.000 \\times 10^{4}}$$", "id": "3465305"}]}