{"hands_on_practices": [{"introduction": "This problem serves as a foundational exercise, connecting the abstract statistical description of the cosmic density field to a tangible, physical quantity. Before we can write code to generate these fields, we must be fluent in the language used to describe them, particularly the power spectrum $P(k)$, the dimensionless power spectrum $\\Delta^2(k)$, and the variance of the smoothed field $\\sigma^2(R)$. This practice will guide you through the derivation of these relationships from first principles, with a crucial emphasis on tracking the conventional units used in cosmology to ensure your calculations are physically meaningful [@problem_id:3473819].", "problem": "Consider a statistically homogeneous and isotropic Gaussian matter overdensity field $\\delta(\\mathbf{x})$ in comoving coordinates, used to generate initial conditions in numerical cosmology. Let the Fourier transform convention be $\\delta(\\mathbf{x}) = \\int \\frac{d^{3}k}{(2\\pi)^{3}}\\,\\delta(\\mathbf{k})\\,\\exp(i\\,\\mathbf{k}\\cdot\\mathbf{x})$, and define the power spectrum $P(k)$ via the two-point function $\\langle \\delta(\\mathbf{k})\\,\\delta^{*}(\\mathbf{k}') \\rangle = (2\\pi)^{3}\\,\\delta_{\\mathrm{D}}(\\mathbf{k}-\\mathbf{k}')\\,P(k)$, where $\\delta_{\\mathrm{D}}$ denotes the Dirac delta distribution. In this context, wave number $k$ is measured in $h/\\mathrm{Mpc}$ and $P(k)$ is measured in $(\\mathrm{Mpc}/h)^{3}$.\n\nYou smooth the field with a spherically symmetric Gaussian window in real space, whose Fourier-space form is $W(kR) = \\exp\\!\\left(-\\frac{(kR)^{2}}{2}\\right)$, where the smoothing scale $R$ is measured in $\\mathrm{Mpc}/h$. The smoothed variance is defined as $\\sigma^{2}(R) \\equiv \\langle \\delta_{R}^{2} \\rangle$, where $\\delta_{R}$ is the smoothed field.\n\nStarting from the above core definitions and the Fourier convention, do the following:\n\n- Derive, from first principles, an expression for the contribution to $\\sigma^{2}$ per logarithmic interval in $k$, and thereby obtain the dimensionless power per logarithmic interval $\\Delta^{2}(k)$. Carefully track units to explain how $P(k)$ with units $(\\mathrm{Mpc}/h)^{3}$ and $k$ with units $h/\\mathrm{Mpc}$ combine to yield a dimensionless $\\Delta^{2}(k)$.\n- For the toy isotropic power spectrum $P(k) = A\\,\\exp\\!\\left(-\\frac{k^{2}}{k_{c}^{2}}\\right)$ with $A = 4.0\\times 10^{3}\\,(\\mathrm{Mpc}/h)^{3}$ and cutoff $k_{c} = 5\\,h/\\mathrm{Mpc}$, compute the smoothed variance $\\sigma^{2}(R)$ using the Gaussian window $W(kR)$ above at smoothing scale $R = 5\\,\\mathrm{Mpc}/h$. Your derivation must show explicitly how the units propagate through the integral to yield a dimensionless $\\sigma^{2}(R)$.\n\nRound your final numerical answer for $\\sigma^{2}(R)$ to four significant figures. Express your final answer as a pure number (dimensionless).", "solution": "The user wants me to validate the problem statement according to the specified rules.\n\n### Step 1: Extract Givens\n- Field: Statistically homogeneous and isotropic Gaussian matter overdensity field $\\delta(\\mathbf{x})$.\n- Fourier transform convention: $\\delta(\\mathbf{x}) = \\int \\frac{d^{3}k}{(2\\pi)^{3}}\\,\\delta(\\mathbf{k})\\,\\exp(i\\,\\mathbf{k}\\cdot\\mathbf{x})$.\n- Power spectrum definition: $\\langle \\delta(\\mathbf{k})\\,\\delta^{*}(\\mathbf{k}') \\rangle = (2\\pi)^{3}\\,\\delta_{\\mathrm{D}}(\\mathbf{k}-\\mathbf{k}')\\,P(k)$.\n- Units of wave number: $k$ is in $h/\\mathrm{Mpc}$.\n- Units of power spectrum: $P(k)$ is in $(\\mathrm{Mpc}/h)^{3}$.\n- Fourier-space Gaussian window function: $W(kR) = \\exp\\!\\left(-\\frac{(kR)^{2}}{2}\\right)$.\n- Units of smoothing scale: $R$ is in $\\mathrm{Mpc}/h$.\n- Definition of smoothed variance: $\\sigma^{2}(R) \\equiv \\langle \\delta_{R}^{2} \\rangle$, where $\\delta_{R}$ is the smoothed field.\n- Toy power spectrum for calculation: $P(k) = A\\,\\exp\\!\\left(-\\frac{k^{2}}{k_{c}^{2}}\\right)$.\n- Constant $A$: $A = 4.0\\times 10^{3}\\,(\\mathrm{Mpc}/h)^{3}$.\n- Cutoff wave number $k_c$: $k_{c} = 5\\,h/\\mathrm{Mpc}$.\n- Smoothing scale for calculation $R$: $R = 5\\,\\mathrm{Mpc}/h$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem uses standard definitions and formalism from the theory of large-scale structure in cosmology. The concepts of a Gaussian random field, its power spectrum, Fourier transforms, and smoothing with window functions are fundamental to generating initial conditions for cosmological simulations. The units provided are conventional in the field. The setup is scientifically sound.\n- **Well-Posed:** The problem is clearly stated with all necessary definitions, constants, and functional forms provided. The tasks—a derivation and a specific calculation—are well-defined. The integrals involved are standard Gaussian integrals, which are convergent and lead to a unique, meaningful solution.\n- **Objective:** The problem is stated using precise, objective, and formal scientific language. There are no subjective or opinion-based elements.\n- **Completeness and Consistency:** The problem is self-contained. All required variables and constants are defined and their values are provided. The units are consistent: for example, the argument of the window function $kR$ is dimensionless since $[k]=L^{-1}$ and $[R]=L$, using $L=\\mathrm{Mpc}/h$ as the length unit. The product $k^3 P(k)$ is also dimensionless: $[k^3 P(k)] = (h/\\mathrm{Mpc})^3 (\\mathrm{Mpc}/h)^3 = 1$. No contradictions are present.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is scientifically sound, well-posed, and all necessary information is consistently provided. I will now proceed with the solution.\n\nThe solution is divided into two parts as requested: first, the derivation of the dimensionless power spectrum $\\Delta^2(k)$, and second, the calculation of the smoothed variance $\\sigma^2(R)$.\n\n**Part 1: Derivation of the dimensionless power spectrum $\\Delta^2(k)$**\n\nThe smoothed overdensity field $\\delta_R(\\mathbf{x})$ is obtained by convolving the field $\\delta(\\mathbf{x})$ with a real-space window function. In Fourier space, this convolution becomes a multiplication. The Fourier transform of the smoothed field is:\n$$ \\delta_R(\\mathbf{k}) = \\delta(\\mathbf{k}) W(kR) $$\nThe smoothed variance is defined as $\\sigma^2(R) \\equiv \\langle \\delta_R^2(\\mathbf{x}) \\rangle$. Due to statistical homogeneity, this quantity is independent of position $\\mathbf{x}$, so we can conveniently evaluate it at $\\mathbf{x} = 0$. Since the field $\\delta(\\mathbf{x})$ is real, the smoothed field $\\delta_R(\\mathbf{x})$ is also real, and we can write $\\delta_R^2 = \\delta_R \\delta_R^*$.\n$$ \\sigma^2(R) = \\langle \\delta_R(0)^2 \\rangle = \\langle \\delta_R(0) \\delta_R^*(0) \\rangle $$\nWe express $\\delta_R(0)$ using its Fourier transform:\n$$ \\delta_R(0) = \\int \\frac{d^3k}{(2\\pi)^3} \\delta_R(\\mathbf{k}) = \\int \\frac{d^3k}{(2\\pi)^3} \\delta(\\mathbf{k}) W(kR) $$\nSubstituting this into the expression for the variance:\n$$ \\sigma^2(R) = \\left\\langle \\left( \\int \\frac{d^3k}{(2\\pi)^3} \\delta(\\mathbf{k}) W(kR) \\right) \\left( \\int \\frac{d^3k'}{(2\\pi)^3} \\delta(\\mathbf{k}') W(k'R) \\right)^* \\right\\rangle $$\nThe window function $W(kR)$ is real. The complex conjugate acts on $\\delta(\\mathbf{k}')$.\n$$ \\sigma^2(R) = \\int \\frac{d^3k}{(2\\pi)^3} \\int \\frac{d^3k'}{(2\\pi)^3} \\langle \\delta(\\mathbf{k}) \\delta^*(\\mathbf{k}') \\rangle W(kR) W(k'R) $$\nWe use the definition of the power spectrum, $\\langle \\delta(\\mathbf{k})\\,\\delta^{*}(\\mathbf{k}') \\rangle = (2\\pi)^{3}\\,\\delta_{\\mathrm{D}}(\\mathbf{k}-\\mathbf{k}')\\,P(k)$:\n$$ \\sigma^2(R) = \\int \\frac{d^3k}{(2\\pi)^3} \\int \\frac{d^3k'}{(2\\pi)^3} (2\\pi)^3 \\delta_{\\mathrm{D}}(\\mathbf{k}-\\mathbf{k}') P(k) W(kR) W(k'R) $$\nThe integral over $\\mathbf{k}'$ is resolved by the Dirac delta function $\\delta_{\\mathrm{D}}(\\mathbf{k}-\\mathbf{k}')$, which sets $\\mathbf{k}' = \\mathbf{k}$:\n$$ \\sigma^2(R) = \\int \\frac{d^3k}{(2\\pi)^3} P(k) |W(kR)|^2 $$\nTo proceed, we switch to spherical coordinates in Fourier space, where $d^3k = k^2 dk \\, d\\Omega = k^2 dk \\sin\\theta d\\theta d\\phi$. Since the integrand depends only on the magnitude $k = |\\mathbf{k}|$, the integral over the solid angle $d\\Omega$ yields $4\\pi$.\n$$ \\sigma^2(R) = \\int_0^\\infty \\frac{4\\pi k^2}{(2\\pi)^3} P(k) |W(kR)|^2 dk = \\int_0^\\infty \\frac{k^2 P(k)}{2\\pi^2} |W(kR)|^2 dk $$\nTo find the contribution per logarithmic interval, we change the integration variable from $k$ to $\\ln k$. Let $u = \\ln k$, so $k = \\exp(u)$ and $dk = k \\, d(\\ln k)$.\n$$ \\sigma^2(R) = \\int_{-\\infty}^\\infty \\frac{k^2 P(k)}{2\\pi^2} |W(kR)|^2 \\cdot (k \\, d(\\ln k)) = \\int_{-\\infty}^\\infty \\left[ \\frac{k^3 P(k)}{2\\pi^2} |W(kR)|^2 \\right] d(\\ln k) $$\nThe term in the square brackets is the contribution to the variance per logarithmic interval in $k$. The dimensionless power per logarithmic interval, denoted $\\Delta^2(k)$, is conventionally defined as this contribution in the absence of smoothing (i.e., for a window function $W=1$).\n$$ \\Delta^2(k) \\equiv \\frac{k^3 P(k)}{2\\pi^2} $$\nLet's analyze the units. The wave number $k$ has units of $[k] = h/\\mathrm{Mpc}$, and the power spectrum $P(k)$ has units of $[P(k)] = (\\mathrm{Mpc}/h)^3$. The factor $2\\pi^2$ is dimensionless.\n$$ [\\Delta^2(k)] = [k]^3 [P(k)] = \\left(\\frac{h}{\\mathrm{Mpc}}\\right)^3 \\left(\\frac{\\mathrm{Mpc}}{h}\\right)^3 = 1 $$\nThus, $\\Delta^2(k)$ is a dimensionless quantity.\n\n**Part 2: Calculation of the smoothed variance $\\sigma^2(R)$**\n\nWe use the derived integral expression for $\\sigma^2(R)$:\n$$ \\sigma^2(R) = \\int_0^\\infty \\frac{k^2 P(k)}{2\\pi^2} |W(kR)|^2 dk $$\nWe are given the toy power spectrum $P(k) = A\\,\\exp\\!\\left(-\\frac{k^{2}}{k_{c}^{2}}\\right)$ and the Gaussian window function $W(kR) = \\exp\\!\\left(-\\frac{(kR)^{2}}{2}\\right)$. The squared magnitude of the window function is $|W(kR)|^2 = \\exp(-(kR)^2)$.\nSubstituting these into the integral:\n$$ \\sigma^2(R) = \\int_0^\\infty \\frac{k^2}{2\\pi^2} \\left( A\\exp\\!\\left(-\\frac{k^{2}}{k_{c}^{2}}\\right) \\right) \\exp\\left(-(kR)^2\\right) dk $$\n$$ \\sigma^2(R) = \\frac{A}{2\\pi^2} \\int_0^\\infty k^2 \\exp\\left(-\\frac{k^2}{k_c^2} - k^2 R^2\\right) dk = \\frac{A}{2\\pi^2} \\int_0^\\infty k^2 \\exp\\left(-k^2 \\left(\\frac{1}{k_c^2} + R^2\\right)\\right) dk $$\nThis is a standard Gaussian integral of the form $\\int_0^\\infty x^{2n} \\exp(-ax^2) dx$. For $n=1$, we have $\\int_0^\\infty x^2 \\exp(-ax^2) dx = \\frac{\\sqrt{\\pi}}{4a^{3/2}}$.\nIn our case, the integration variable is $k$ and the coefficient $a$ is:\n$$ a = \\frac{1}{k_c^2} + R^2 $$\nThe integral evaluates to $\\frac{\\sqrt{\\pi}}{4a^{3/2}}$. Substituting this result:\n$$ \\sigma^2(R) = \\frac{A}{2\\pi^2} \\left( \\frac{\\sqrt{\\pi}}{4a^{3/2}} \\right) = \\frac{A}{8\\pi^{3/2}} a^{-3/2} = \\frac{A}{8\\pi^{3/2}} \\left(\\frac{1}{k_c^2} + R^2\\right)^{-3/2} $$\nThis expression for $\\sigma^2(R)$ is dimensionless, as the units of $A$ are $(\\mathrm{Mpc}/h)^3$ and the units of $a^{3/2}$ are $((\\mathrm{Mpc}/h)^2)^{3/2} = (\\mathrm{Mpc}/h)^3$.\n\nNow we substitute the given numerical values:\n$A = 4.0 \\times 10^3 \\, (\\mathrm{Mpc}/h)^3$\n$k_c = 5 \\, h/\\mathrm{Mpc}$\n$R = 5 \\, \\mathrm{Mpc}/h$\n\nFirst, we compute the term $a$:\n$$ a = \\frac{1}{(5 \\, h/\\mathrm{Mpc})^2} + (5 \\, \\mathrm{Mpc}/h)^2 = \\left(\\frac{1}{25} + 25\\right) (\\mathrm{Mpc}/h)^2 = (0.04 + 25) \\, (\\mathrm{Mpc}/h)^2 = 25.04 \\, (\\mathrm{Mpc}/h)^2 $$\nNow we compute $\\sigma^2(R)$:\n$$ \\sigma^2(R) = \\frac{4.0 \\times 10^3}{8\\pi^{3/2}} (25.04)^{-3/2} = \\frac{500}{\\pi^{3/2}} (25.04)^{-3/2} $$\nNumerically evaluating this expression:\n$$ \\pi^{3/2} \\approx 5.568328 $$\n$$ (25.04)^{-3/2} \\approx (125.30015)^{-1} \\approx 0.007980824 $$\n$$ \\sigma^2(R) \\approx \\frac{500}{5.568328} \\times 0.007980824 \\approx 89.79351 \\times 0.007980824 \\approx 0.7166336 $$\nRounding to four significant figures, we get $0.7166$.", "answer": "$$\\boxed{0.7166}$$", "id": "3473819"}, {"introduction": "Moving from the continuous formalism to the discrete world of a computational grid introduces practical challenges that are critical for a correct implementation. A key constraint is that the density field $\\delta(\\mathbf{x})$ must be real, which imposes a specific Hermitian symmetry on its Fourier coefficients, $\\delta_{-\\mathbf{k}} = \\delta_{\\mathbf{k}}^{\\ast}$. This exercise focuses on the implications of this symmetry for the \"self-conjugate\" modes on a discrete grid, forcing you to derive how to sample them correctly to produce a valid, real-valued Gaussian random field [@problem_id:3473758].", "problem": "You are generating initial conditions for a statistically homogeneous and isotropic Gaussian density contrast field $\\delta(\\mathbf{x})$ in a periodic, cubic box of side length $L$ and volume $V=L^{3}$, sampled on an even-sized grid of $N\\times N\\times N$ points with $N$ even. The allowed discrete wavevectors are $\\mathbf{k}=\\frac{2\\pi}{L}(n_{x},n_{y},n_{z})$ with integer indices $n_{i}\\in\\{0,1,\\dots,N-1\\}$, which can be mapped to the symmetric set $n_{i}\\in\\{-\\frac{N}{2}+1,\\dots,\\frac{N}{2}\\}$ for Hermitian symmetry bookkeeping. Define the discrete Fourier transform by\n$$\n\\delta(\\mathbf{x})=\\frac{1}{V}\\sum_{\\mathbf{k}}\\delta_{\\mathbf{k}}\\exp(i\\mathbf{k}\\cdot\\mathbf{x}),\\qquad \\delta_{\\mathbf{k}}=\\int_{V}\\delta(\\mathbf{x})\\exp(-i\\mathbf{k}\\cdot\\mathbf{x})\\,d^{3}x.\n$$\nAssume the following well-tested statistical facts:\n- The field $\\delta(\\mathbf{x})$ is real, so it obeys the Hermitian constraint $\\delta_{-\\mathbf{k}}=\\delta_{\\mathbf{k}}^{\\ast}$.\n- The two-point statistics are characterized by the power spectrum $P(k)$ via\n$$\n\\langle \\delta_{\\mathbf{k}}\\delta_{\\mathbf{k}'}^{\\ast}\\rangle=V\\,P(k)\\,\\delta_{\\mathbf{k},\\mathbf{k}'},\n$$\nwhere $\\delta_{\\mathbf{k},\\mathbf{k}'}$ is the Kronecker delta and $k=|\\mathbf{k}|$.\n\nOn an even grid, there are special self-conjugate modes that satisfy $\\mathbf{k}\\equiv -\\mathbf{k}$ modulo the grid, which occurs if and only if each component index is either $0$ or $N/2$. These include the zero mode $\\mathbf{k}=\\mathbf{0}$ and the Nyquist modes with one or more components at the Nyquist index. In generating a Gaussian random field consistent with the above definitions, you must ensure both the reality of $\\delta(\\mathbf{x})$ and the correct Gaussian statistics of Fourier modes.\n\nStarting from the definitions and facts given above (and no other formulas), derive the correct variance to assign to the single real Gaussian variate used to sample $\\delta_{\\mathbf{k}}$ for any nonzero self-conjugate mode (i.e., for $\\mathbf{k}\\neq\\mathbf{0}$ with each component either $0$ or the Nyquist wavenumber), so that the resulting field maintains reality and has the target power spectrum. Express your answer as a closed-form analytic expression in terms of $V$ and $P(k)$. You should also justify, within your derivation, how the zero mode is handled to maintain a physically meaningful density contrast. Your final answer must be a single analytic expression. No rounding is required, and no units should be included in the final expression since $\\delta$ is dimensionless by construction.", "solution": "The problem statement has been meticulously validated and is determined to be valid. It is scientifically grounded in the principles of numerical cosmology, well-posed, objective, and internally consistent. All necessary information for a rigorous derivation is provided.\n\nThe objective is to determine the variance of the real-valued Gaussian random variate used to sample the Fourier mode $\\delta_{\\mathbf{k}}$ for a nonzero self-conjugate mode $\\mathbf{k}$. A self-conjugate mode is defined as a mode for which $\\mathbf{k} \\equiv -\\mathbf{k}$ modulo the grid reciprocal vectors. On an even-sized grid of $N\\times N\\times N$ points, these are the modes for which each component of the integer index vector $(n_x, n_y, n_z)$ is either $0$ or $N/2$. The problem asks for the variance for such modes where $\\mathbf{k} \\neq \\mathbf{0}$.\n\nWe begin with the fundamental properties of the density contrast field $\\delta(\\mathbf{x})$ and its Fourier transform $\\delta_{\\mathbf{k}}$.\n\nFirst, the field $\\delta(\\mathbf{x})$ is a real-valued function. This imposes a Hermitian symmetry constraint on its Fourier coefficients:\n$$\n\\delta_{-\\mathbf{k}} = \\delta_{\\mathbf{k}}^{\\ast}\n$$\nwhere the asterisk denotes complex conjugation.\n\nSecond, the statistical properties of the Gaussian random field are defined by the power spectrum, $P(k)$, through the two-point correlation function of the Fourier modes:\n$$\n\\langle \\delta_{\\mathbf{k}}\\delta_{\\mathbf{k}'}^{\\ast}\\rangle = V\\,P(k)\\,\\delta_{\\mathbf{k},\\mathbf{k}'}\n$$\nwhere $V$ is the volume of the box, $k=|\\mathbf{k}|$, and $\\delta_{\\mathbf{k},\\mathbf{k}'}$ is the Kronecker delta. The angle brackets $\\langle\\dots\\rangle$ denote an ensemble average.\n\nLet us now consider a nonzero self-conjugate mode $\\mathbf{k}$. For such a mode, the wavevector $\\mathbf{k}$ is its own negative, up to a reciprocal lattice vector which is irrelevant for the discrete modes on the grid. Therefore, the Hermitian symmetry constraint becomes:\n$$\n\\delta_{\\mathbf{k}} = \\delta_{-\\mathbf{k}} = \\delta_{\\mathbf{k}}^{\\ast}\n$$\nA complex number that is equal to its own conjugate must be purely real. If we write $\\delta_{\\mathbf{k}}$ in terms of its real and imaginary parts, $\\delta_{\\mathbf{k}} = \\text{Re}(\\delta_{\\mathbf{k}}) + i\\,\\text{Im}(\\delta_{\\mathbf{k}})$, the condition $\\delta_{\\mathbf{k}} = \\delta_{\\mathbf{k}}^{\\ast}$ implies that $\\text{Im}(\\delta_{\\mathbf{k}}) = 0$. Thus, for any self-conjugate mode, the Fourier coefficient $\\delta_{\\mathbf{k}}$ is a real number.\n\nTo generate the field, we sample $\\delta_{\\mathbf{k}}$ from a Gaussian distribution. Since $\\delta_{\\mathbfk}$ must be real for a self-conjugate mode, it is drawn from a real Gaussian distribution. The problem asks for the variance of this distribution. By definition, the variance of a zero-mean random variable $X$ is $\\langle X^2 \\rangle$. The Fourier modes of a zero-mean random field also have zero mean, $\\langle \\delta_{\\mathbf{k}} \\rangle = 0$. Therefore, we need to calculate $\\langle \\delta_{\\mathbf{k}}^2 \\rangle$.\n\nWe apply the given power spectrum definition for the specific case where $\\mathbf{k}' = \\mathbf{k}$:\n$$\n\\langle \\delta_{\\mathbf{k}}\\delta_{\\mathbf{k}}^{\\ast}\\rangle = V\\,P(k)\n$$\nSince we have established that $\\delta_{\\mathbf{k}}$ is real for a self-conjugate mode, we have $\\delta_{\\mathbf{k}}^{\\ast} = \\delta_{\\mathbf{k}}$. Substituting this into the equation above yields:\n$$\n\\langle \\delta_{\\mathbf{k}}\\delta_{\\mathbf{k}}\\rangle = \\langle \\delta_{\\mathbf{k}}^2 \\rangle = V\\,P(k)\n$$\nThis result is precisely the variance of the single real Gaussian variate used to sample the mode $\\delta_{\\mathbf{k}}$. This holds for any nonzero self-conjugate mode.\n\nFor contrast, for a general non-self-conjugate mode $\\mathbf{k}$ (where $\\mathbf{k} \\neq -\\mathbf{k}$), $\\delta_{\\mathbf{k}}$ is a complex number, $\\delta_{\\mathbf{k}} = A_{\\mathbf{k}} + iB_{\\mathbf{k}}$, where $A_{\\mathbf{k}}$ and $B_{\\mathbf{k}}$ are independent real Gaussian variates. In this case, $\\langle \\delta_{\\mathbf{k}}\\delta_{\\mathbf{k}}^{\\ast} \\rangle = \\langle (A_{\\mathbf{k}} + iB_{\\mathbf{k}})(A_{\\mathbf{k}} - iB_{\\mathbf{k}}) \\rangle = \\langle A_{\\mathbf{k}}^2 + B_{\\mathbf{k}}^2 \\rangle$. Due to statistical isotropy, the variances of the real and imaginary parts are equal, $\\langle A_{\\mathbf{k}}^2 \\rangle = \\langle B_{\\mathbf{k}}^2 \\rangle$. Therefore, $2\\langle A_{\\mathbf{k}}^2 \\rangle = V P(k)$, which gives $\\langle A_{\\mathbf{k}}^2 \\rangle = \\langle B_{\\mathbf{k}}^2 \\rangle = \\frac{1}{2}V P(k)$. The variance assigned to the real and imaginary parts of a general complex mode is half of the variance assigned to the purely real self-conjugate modes.\n\nFinally, the problem requires justification for the handling of the zero mode, $\\mathbf{k}=\\mathbf{0}$. The zero mode is the most fundamental self-conjugate mode. Its value is given by the Fourier transform definition:\n$$\n\\delta_{\\mathbf{k}=\\mathbf{0}} = \\int_{V} \\delta(\\mathbf{x}) \\exp(-i\\mathbf{0} \\cdot \\mathbf{x})\\,d^3x = \\int_{V} \\delta(\\mathbf{x})\\,d^3x\n$$\nThis is the integral of the density contrast field over the entire volume. The density contrast is defined as $\\delta(\\mathbf{x}) = (\\rho(\\mathbf{x}) - \\bar{\\rho})/\\bar{\\rho}$, where $\\bar{\\rho}$ is the mean density of the universe. By definition, the spatial average of $\\delta(\\mathbf{x})$ over a fair, representative volume must be zero. Our simulation box is assumed to be such a volume. Therefore, we must enforce:\n$$\n\\frac{1}{V}\\int_{V}\\delta(\\mathbf{x})\\,d^3x = 0 \\implies \\int_{V}\\delta(\\mathbf{x})\\,d^3x = 0\n$$\nThis implies that $\\delta_{\\mathbf{k}=\\mathbf{0}}$ must be set to $0$ by construction. It is not a random variable to be drawn from a distribution; its value is fixed to maintain consistency with the definition of the density contrast. This physical constraint is why the problem correctly asks for the variance of *nonzero* self-conjugate modes.\n\nIn summary, for any nonzero self-conjugate mode $\\mathbf{k}$, its Fourier coefficient $\\delta_{\\mathbf{k}}$ must be real, and the variance of the Gaussian distribution from which it is drawn is $V P(k)$.", "answer": "$$\\boxed{V P(k)}$$", "id": "3473758"}, {"introduction": "N-body simulations evolve particles, not continuous fields, so a crucial step in generating initial conditions is to sample the density field with a set of tracers. This process of discretization, however, is not perfect and introduces its own statistical signature known as \"shot noise\". This practice explores the origin of this noise floor, guiding you to derive its expected amplitude for a Poisson particle sample and consider how it must be handled when measuring the power spectrum from a particle distribution [@problem_id:3473824].", "problem": "Consider a periodic cubic domain of side length $L$ used to generate cosmological initial conditions for $N$ collisionless dark matter particles. The initial particle load is sampled from a spatially uniform Poisson point process, upon which correlated displacements sourced by a Gaussian random field are later imposed. The density field is measured on a mesh using the Cloud-In-Cell (CIC) mass assignment scheme and Fourier transformed using the Discrete Fourier Transform (DFT) to estimate the power spectrum. Starting from the definitions of the two-point correlation function and the power spectrum for a point process in a finite periodic volume $V$, derive the expected amplitude of the white-noise contribution to the estimated power spectrum that arises purely from the discreteness of the Poisson sampling. Then, evaluate this amplitude for the case $L=1000\\,\\mathrm{Mpc}/h$ and $N=512^{3}$.\n\nIn your derivation, use only fundamental properties of the Poisson point process and the standard definition of the power spectrum in a periodic box, and treat the mesh mass assignment and Fourier transform consistently. Finally, discuss how this discreteness contribution should be subtracted or otherwise mitigated in practice when estimating the power spectrum of the Gaussian random field used to set the initial conditions, noting any caveats related to mass-assignment windows, aliasing, and non-Poisson pre-initial loads.\n\nExpress your final numerical result for the discreteness (shot-noise) amplitude in $(\\mathrm{Mpc}/h)^{3}$ and round your answer to four significant figures.", "solution": "The appropriate starting point is the definition of the number density field for a set of $N$ points at positions $\\{\\mathbf{x}_{i}\\}$ in a finite periodic volume $V=L^{3}$:\n$$\nn(\\mathbf{x}) \\equiv \\sum_{i=1}^{N} \\delta_{D}(\\mathbf{x}-\\mathbf{x}_{i}),\n$$\nwhere $\\delta_{D}$ denotes the Dirac delta distribution and the ensemble average of $n(\\mathbf{x})$ over realizations of a homogeneous process is $\\langle n(\\mathbf{x}) \\rangle = \\bar{n}$ with $\\bar{n} \\equiv N/V$ the mean number density. The overdensity field is\n$$\n\\delta(\\mathbf{x}) \\equiv \\frac{n(\\mathbf{x})}{\\bar{n}} - 1.\n$$\nFor a statistically homogeneous and isotropic field in a periodic box, the Fourier transform convention yielding a power spectrum with dimensions of volume is\n$$\n\\delta(\\mathbf{k}) \\equiv \\int_{V} d^{3}\\mathbf{x}\\, \\delta(\\mathbf{x}) \\exp(-i\\mathbf{k}\\cdot\\mathbf{x}), \\quad \\langle \\delta(\\mathbf{k}) \\delta^{*}(\\mathbf{k}') \\rangle = (2\\pi)^{3} \\delta_{D}(\\mathbf{k}-\\mathbf{k}') P(\\mathbf{k}),\n$$\nwhere $P(\\mathbf{k})$ is the power spectrum. In a finite box with discrete wavevectors $\\mathbf{k}$ compatible with periodic boundary conditions, the analogous relation becomes\n$$\n\\langle |\\delta(\\mathbf{k})|^{2} \\rangle = V\\, P(\\mathbf{k}).\n$$\nTo connect to a point process, we use the well-tested fact about Poisson sampling of a continuous field: the second moment of $n(\\mathbf{x})$ has a contact term embodying the discreteness. Specifically, for a homogeneous Poisson point process with no intrinsic clustering, the two-point function is\n$$\n\\langle n(\\mathbf{x}) n(\\mathbf{y}) \\rangle = \\bar{n}^{2} + \\bar{n}\\, \\delta_{D}(\\mathbf{x}-\\mathbf{y}).\n$$\nThe first term corresponds to the mean density product, while the second is the shot-noise term. Transforming to Fourier space, we compute the two-point function of $\\delta(\\mathbf{k})$:\n\\begin{align*}\n\\delta(\\mathbf{k}) &= \\frac{1}{\\bar{n}} \\int_{V} d^{3}\\mathbf{x}\\, n(\\mathbf{x}) \\exp(-i\\mathbf{k}\\cdot\\mathbf{x}) - \\int_{V} d^{3}\\mathbf{x}\\, \\exp(-i\\mathbf{k}\\cdot\\mathbf{x}) \\\\\n&= \\frac{1}{\\bar{n}} n(\\mathbf{k}) - (2\\pi)^{3} \\delta_{D}(\\mathbf{k})\\,,\n\\end{align*}\nwith $n(\\mathbf{k}) \\equiv \\int_{V} d^{3}\\mathbf{x}\\, n(\\mathbf{x}) \\exp(-i\\mathbf{k}\\cdot\\mathbf{x})$. For nonzero $\\mathbf{k}$ modes in a finite box, the mean mode is absent and we may focus on the variance of $\\delta(\\mathbf{k})$:\n\\begin{align*}\n\\langle |\\delta(\\mathbf{k})|^{2} \\rangle &= \\frac{1}{\\bar{n}^{2}} \\langle |n(\\mathbf{k})|^{2} \\rangle \\\\\n&= \\frac{1}{\\bar{n}^{2}} \\int_{V} d^{3}\\mathbf{x} \\int_{V} d^{3}\\mathbf{y}\\, \\langle n(\\mathbf{x}) n(\\mathbf{y}) \\rangle \\exp\\!\\left[-i\\mathbf{k}\\cdot(\\mathbf{x}-\\mathbf{y})\\right] \\\\\n&= \\frac{1}{\\bar{n}^{2}} \\left[ \\int_{V} d^{3}\\mathbf{x} \\int_{V} d^{3}\\mathbf{y}\\, \\bar{n}^{2} \\exp\\!\\left[-i\\mathbf{k}\\cdot(\\mathbf{x}-\\mathbf{y})\\right] + \\int_{V} d^{3}\\mathbf{x}\\, \\bar{n} \\right] \\\\\n&= \\frac{1}{\\bar{n}^{2}} \\left[ \\bar{n}^{2} \\left| \\int_{V} d^{3}\\mathbf{x}\\, \\exp(-i\\mathbf{k}\\cdot\\mathbf{x}) \\right|^{2} + \\bar{n}\\, V \\right].\n\\end{align*}\nFor nonzero $\\mathbf{k}$ modes in a periodic box, $\\int_{V} d^{3}\\mathbf{x}\\, \\exp(-i\\mathbf{k}\\cdot\\mathbf{x})=0$, so the first term vanishes and one is left with\n$$\n\\langle |\\delta(\\mathbf{k})|^{2} \\rangle = \\frac{V}{\\bar{n}}.\n$$\nComparing to the finite-volume normalization $\\langle |\\delta(\\mathbf{k})|^{2} \\rangle = V\\, P(\\mathbf{k})$, the shot-noise contribution is a $k$-independent term\n$$\nP_{\\mathrm{shot}} = \\frac{1}{\\bar{n}} = \\frac{V}{N}.\n$$\nThis is the expected white-noise floor added by the Poisson sampling of a continuous field.\n\nWe now evaluate this for the given parameters. The volume is\n$$\nV = L^{3} = \\left(1000\\,\\mathrm{Mpc}/h\\right)^{3} = 10^{9}\\,(\\mathrm{Mpc}/h)^{3}.\n$$\nThe number of particles is\n$$\nN = 512^{3} = 134{,}217{,}728.\n$$\nTherefore,\n$$\nP_{\\mathrm{shot}} = \\frac{V}{N} = \\frac{10^{9}}{134{,}217{,}728}\\,(\\mathrm{Mpc}/h)^{3} \\approx 7.4505805969\\,(\\mathrm{Mpc}/h)^{3}.\n$$\nRounded to four significant figures as requested, this is\n$$\nP_{\\mathrm{shot}} \\approx 7.451\\,(\\mathrm{Mpc}/h)^{3}.\n$$\n\nFinally, we discuss subtraction or mitigation in practice. When estimating the power spectrum from a density field assigned to a mesh via Cloud-In-Cell (CIC), the measured Fourier modes are convolved by the mass-assignment window $W_{\\mathrm{CIC}}(\\mathbf{k})$, and the discrete sampling induces aliasing from modes beyond the Nyquist frequency. The measured spectrum can be modeled as\n$$\nP_{\\mathrm{meas}}(\\mathbf{k}) \\approx |W_{\\mathrm{CIC}}(\\mathbf{k})|^{2} P_{\\mathrm{true}}(\\mathbf{k}) + |W_{\\mathrm{CIC}}(\\mathbf{k})|^{2} P_{\\mathrm{shot}} + P_{\\mathrm{alias}}(\\mathbf{k}),\n$$\nwhere $P_{\\mathrm{alias}}(\\mathbf{k})$ encodes contributions from replicated spectra due to finite sampling. To recover the underlying $P_{\\mathrm{true}}(\\mathbf{k})$, one should:\n- Deconvolve the mass-assignment window by dividing the measured spectrum by $|W_{\\mathrm{CIC}}(\\mathbf{k})|^{2}$ wherever reliable, and subtract the appropriately windowed shot noise before deconvolution, i.e., subtract $|W_{\\mathrm{CIC}}(\\mathbf{k})|^{2} P_{\\mathrm{shot}}$ from $P_{\\mathrm{meas}}(\\mathbf{k})$ and then divide by $|W_{\\mathrm{CIC}}(\\mathbf{k})|^{2}$.\n- Reduce aliasing by using techniques such as interlacing and higher-order assignment kernels (e.g., Triangular Shaped Cloud) and by restricting analysis to wavenumbers well below the Nyquist frequency.\n- Prefer non-Poisson pre-initial loads (e.g., a regular lattice or a \"glass\" configuration) to suppress shot noise at low $k$. In such cases, the discreteness contribution deviates from the simple white Poisson form, and one should account for the specific windowed spectrum of the pre-initial arrangement rather than subtracting $1/\\bar{n}$.\n- Increase $N$ (reducing $P_{\\mathrm{shot}}$ as $V/N$) or use cross-power spectra between independent tracers of the same field to eliminate or reduce shot-noise bias, noting that for independent samples the cross shot-noise term vanishes.\n\nUnder the assumptions stated here (Poisson load, CIC assignment, periodic box), the baseline subtraction for the discreteness floor in the deconvolved estimate is $P_{\\mathrm{shot}} = V/N$ evaluated above.", "answer": "$$\\boxed{7.451}$$", "id": "3473824"}]}