{"hands_on_practices": [{"introduction": "The cornerstone of designing modern shock-capturing schemes is the separation of the underlying dynamics into a non-dissipative component and a stabilizing dissipative component. This first exercise guides you through this fundamental process for the quintessential nonlinear model, the Burgers’ equation [@problem_id:3314743]. You will start by deriving a two-point numerical flux that is *entropy-conservative*, meaning it perfectly mimics the entropy dynamics of the continuous PDE in a discrete setting, and then add a minimal amount of numerical dissipation to create a provably *entropy-stable* scheme that correctly captures shocks.", "problem": "You are given the scalar conservation law known as Burgers’ equation, written as $u_t + (f(u))_x = 0$ with $f(u) = \\tfrac{1}{2} u^2$. Consider a convex entropy pair $(U(u), F(u))$ with $U(u) = \\tfrac{1}{2} u^2$, entropy variables $v(u) = \\tfrac{dU}{du} = u$, and entropy flux $F(u)$ defined by the requirement that $\\tfrac{dF}{du} = v(u) \\tfrac{df}{du}$. Let the entropy potential be $\\psi(u) = v(u) f(u) - F(u)$. Assume a uniform grid and a two-point numerical flux at an interface between left and right states $u_L$ and $u_R$.\n\nYour tasks are:\n- Starting from the entropy inequality at the continuous level, the definition of entropy variables, and the discrete telescoping needed for conservation, derive a two-point entropy-conservative (EC) flux $f^{ec}(u_L, u_R)$ that is symmetric in its arguments and consistent with $f(u)$.\n- Construct an entropy-stable (ES) flux by adding a dissipative term that is symmetric positive definite in entropy variables: $f^{es}(u_L, u_R) = f^{ec}(u_L, u_R) - \\tfrac{1}{2} \\alpha(u_L, u_R) \\, (v_R - v_L)$, where $\\alpha(u_L, u_R) \\ge 0$ is a scalar dissipation coefficient and $v_L = v(u_L)$, $v_R = v(u_R)$. Show that the discrete entropy production at a single interface equals a nonpositive quadratic form in $(v_R - v_L)$ and give its explicit expression for Burgers’ equation.\n- Analyze the eigenvalue-based scaling needed for $\\alpha(u_L, u_R)$ near shocks. Use the fact that the characteristic speed is $\\lambda(u) = f'(u) = u$. Derive a sufficient condition on $\\alpha(u_L, u_R)$ for monotonicity of the resulting two-point flux and specialize it to Burgers’ equation as a bound involving $u_L$ and $u_R$. Compare the following two scalings: Roe scaling $\\alpha_{\\mathrm{roe}} = \\left|\\tfrac{u_L + u_R}{2}\\right|$ and Rusanov (local Lax–Friedrichs) scaling $\\alpha_{\\max} = \\max(|u_L|, |u_R|)$. Explain, in terms of the strictness of entropy dissipation and monotonicity, why transonic shocks require the larger scaling.\n\nImplementation requirements:\n- Implement functions for:\n  - The entropy-conservative flux $f^{ec}(u_L, u_R)$.\n  - The entropy potential $\\psi(u)$ and entropy variables $v(u)$.\n  - The dissipation scalings $\\alpha_{\\mathrm{roe}}(u_L, u_R)$ and $\\alpha_{\\max}(u_L, u_R)$.\n  - The per-interface discrete entropy production $\\Sigma(u_L, u_R; \\alpha) = (v_R - v_L)\\, f^{es}(u_L,u_R) - (\\psi_R - \\psi_L)$.\n- For each interface state pair, compute:\n  - The entropy-conservative flux value $f^{ec}(u_L, u_R)$ as a float rounded to six ($6$) decimals.\n  - The discrete entropy production using Rusanov scaling, $\\Sigma(u_L, u_R; \\alpha_{\\max})$, as a float rounded to six ($6$) decimals.\n  - A boolean indicating whether Roe scaling is strictly positive definite for non-identical states, i.e., whether $\\alpha_{\\mathrm{roe}}(u_L, u_R) > 0$ when $u_L \\ne u_R$ (and treated as true if $u_L = u_R$).\n  - A boolean indicating whether Roe scaling satisfies the sufficient monotonicity bound, i.e., whether $\\alpha_{\\mathrm{roe}}(u_L, u_R) \\ge \\alpha_{\\max}(u_L, u_R)$.\n  - A boolean verifying the symmetry of the entropy-conservative flux, i.e., $f^{ec}(u_L, u_R) = f^{ec}(u_R, u_L)$ up to a tolerance of $10^{-12}$.\n\nTest suite:\n- Use the following interface state pairs $(u_L, u_R)$:\n  - $(0.2, 0.3)$\n  - $(1.0, -1.0)$\n  - $(0.5, 0.1)$\n  - $(0.7, 0.7)$\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case result must be a list of the form $[f^{ec}, \\Sigma_{\\max}, \\mathrm{SPD}_{\\mathrm{roe}}, \\mathrm{MONO}_{\\mathrm{roe}}, \\mathrm{SYM}_{ec}]$, where the first two entries are floats and the remaining entries are booleans. For example: $[[0.123456,-0.001234,True,False,True],[\\dots],\\dots]$.", "solution": "The problem requires the derivation and implementation of entropy-conservative and entropy-stable numerical fluxes for the scalar Burgers’ equation, $u_t + (f(u))_x = 0$, where the flux is $f(u) = \\tfrac{1}{2} u^2$. This analysis is foundational in the design of modern shock-capturing schemes for hyperbolic conservation laws.\n\nWe are given the convex entropy function $U(u) = \\tfrac{1}{2} u^2$. From this, we derive the associated quantities. The entropy variable $v(u)$ is defined as the derivative of the entropy function with respect to the conserved variable $u$:\n$$\nv(u) = \\frac{dU}{du} = \\frac{d}{du} \\left(\\frac{1}{2} u^2\\right) = u\n$$\nThe entropy flux $F(u)$ is defined by the compatibility condition $\\tfrac{dF}{du} = v(u) \\tfrac{df}{du}$. Substituting our specific functions:\n$$\n\\frac{dF}{du} = (u) \\frac{d}{du}\\left(\\frac{1}{2} u^2\\right) = u \\cdot u = u^2\n$$\nIntegrating with respect to $u$ yields the entropy flux, where we can set the constant of integration to zero without loss of generality:\n$$\nF(u) = \\int u^2 du = \\frac{1}{3}u^3\n$$\nFinally, the entropy potential $\\psi(u)$ is defined as $\\psi(u) = v(u) f(u) - F(u)$:\n$$\n\\psi(u) = (u) \\left(\\frac{1}{2} u^2\\right) - \\frac{1}{3} u^3 = \\frac{1}{2} u^3 - \\frac{1}{3} u^3 = \\frac{1}{6} u^3\n$$\n\nA two-point numerical flux $f^{ec}(u_L, u_R)$ is entropy-conservative if it satisfies the discrete entropy identity, which balances the jump in entropy variables with the jump in the entropy potential across an interface:\n$$\n(v_R - v_L) f^{ec}(u_L, u_R) = \\psi_R - \\psi_L\n$$\nHere, $v_L = v(u_L)$, $v_R = v(u_R)$, $\\psi_L = \\psi(u_L)$, and $\\psi_R = \\psi(u_R)$. Let $\\llbracket \\cdot \\rrbracket$ denote the jump operator, e.g., $\\llbracket v \\rrbracket = v_R - v_L$. The condition is $\\llbracket v \\rrbracket f^{ec} = \\llbracket \\psi \\rrbracket$.\n\nSolving for $f^{ec}(u_L, u_R)$ for the case where $\\llbracket v \\rrbracket \\ne 0$:\n$$\nf^{ec}(u_L, u_R) = \\frac{\\psi_R - \\psi_L}{v_R - v_L} = \\frac{\\frac{1}{6} u_R^3 - \\frac{1}{6} u_L^3}{u_R - u_L}\n$$\nUsing the algebraic identity for the difference of cubes, $a^3 - b^3 = (a-b)(a^2+ab+b^2)$, we simplify the expression:\n$$\nf^{ec}(u_L, u_R) = \\frac{1}{6} \\frac{(u_R - u_L)(u_R^2 + u_R u_L + u_L^2)}{u_R - u_L} = \\frac{1}{6} (u_L^2 + u_L u_R + u_R^2)\n$$\nThis expression is also well-defined for the case $u_L = u_R = u$ by taking the limit, which gives $f^{ec}(u, u) = \\frac{1}{6}(3u^2) = \\frac{1}{2}u^2 = f(u)$, showing consistency. The formula is manifestly symmetric in its arguments, i.e., $f^{ec}(u_L, u_R) = f^{ec}(u_R, u_L)$.\n\nAn entropy-stable (ES) flux, $f^{es}$, is constructed by adding a numerical dissipation term to the entropy-conservative flux. The added term must be symmetric positive definite in the entropy variables. The general form is:\n$$\nf^{es}(u_L, u_R) = f^{ec}(u_L, u_R) - \\frac{1}{2} \\mathbf{R} (v_R - v_L)\n$$\nwhere $\\mathbf{R}$ is a symmetric positive-definite matrix. For a scalar equation, this simplifies to:\n$$\nf^{es}(u_L, u_R) = f^{ec}(u_L, u_R) - \\frac{1}{2} \\alpha(u_L, u_R) (v_R - v_L)\n$$\nwith a scalar dissipation coefficient $\\alpha(u_L, u_R) \\ge 0$.\n\nThe discrete entropy production (or dissipation) at the interface, $\\Sigma$, is defined as the amount by which the discrete entropy identity is violated:\n$$\n\\Sigma(u_L, u_R; \\alpha) = (v_R - v_L) f^{es}(u_L, u_R) - (\\psi_R - \\psi_L)\n$$\nSubstituting the definition of $f^{es}$:\n$$\n\\Sigma = (v_R - v_L) \\left[f^{ec}(u_L, u_R) - \\frac{1}{2} \\alpha (v_R - v_L)\\right] - (\\psi_R - \\psi_L)\n$$\nRearranging terms:\n$$\n\\Sigma = \\left[(v_R-v_L)f^{ec}(u_L, u_R) - (\\psi_R - \\psi_L)\\right] - \\frac{1}{2}\\alpha(v_R-v_L)^2\n$$\nThe term in square brackets is zero by the definition of the entropy-conservative flux. This leaves:\n$$\n\\Sigma(u_L, u_R; \\alpha) = -\\frac{1}{2} \\alpha(u_L, u_R) (v_R - v_L)^2\n$$\nSince $\\alpha \\ge 0$, we have $\\Sigma \\le 0$. The entropy production is a nonpositive quadratic form in the jump of the entropy variables. This ensures that the scheme satisfies a discrete entropy inequality, making it entropy stable. For Burgers' equation with our chosen entropy, $v(u)=u$, so $\\Sigma = -\\frac{1}{2} \\alpha(u_L, u_R) (u_R - u_L)^2$.\n\nThe choice of the dissipation coefficient $\\alpha$ is critical. It must be large enough to ensure stability and enforce physical solution properties like monotonicity near shocks, but not so large as to excessively smear (\"diffuse\") the solution.\nThe characteristic speed of Burgers' equation is $\\lambda(u) = f'(u) = u$. Two common choices for $\\alpha$ are based on eigenvalues:\n1.  Roe scaling: $\\alpha_{\\mathrm{roe}} = \\left|\\frac{f(u_R)-f(u_L)}{u_R-u_L}\\right| = \\left|\\frac{\\frac{1}{2}u_R^2 - \\frac{1}{2}u_L^2}{u_R-u_L}\\right| = \\left|\\frac{u_L+u_R}{2}\\right|$. This is proportional to the Roe-averaged wavespeed.\n2.  Rusanov (local Lax-Friedrichs) scaling: $\\alpha_{\\max} = \\max(|\\lambda(u_L)|, |\\lambda(u_R)|) = \\max(|u_L|, |u_R|)$. This is the maximum local wavespeed magnitude.\n\nA sufficient condition for monotonicity of a first-order scheme is often that the numerical viscosity is large enough to dominate any anti-diffusive terms. The problem posits a specific check for a sufficient monotonicity bound: $\\alpha \\ge \\alpha_{\\max}(u_L, u_R)$. We are asked to test if Roe scaling meets this bound, i.e., whether $\\alpha_{\\mathrm{roe}} \\ge \\alpha_{\\max}$. By the triangle inequality, $|u_L+u_R| \\le |u_L|+|u_R|$, so $\\alpha_{\\mathrm{roe}} = |\\frac{u_L+u_R}{2}| \\le \\frac{|u_L|+|u_R|}{2}$. Also, $\\max(|u_L|, |u_R|) \\ge \\frac{|u_L|+|u_R|}{2}$. Therefore, $\\alpha_{\\mathrm{roe}} \\le \\alpha_{\\max}$. The equality holds only in special cases (e.g., $u_L=u_R$), but in general, Roe scaling provides less dissipation than Rusanov scaling and does not satisfy this strong monotonicity condition.\n\nThe need for a larger scaling like $\\alpha_{\\max}$ is most evident at transonic shocks. For Burgers' equation, a transonic shock is one where the characteristic speed $\\lambda(u)=u$ changes sign, i.e., $u_L > 0$ and $u_R < 0$ (for a shock) or vice-versa. A critical case is the stationary shock, where the shock speed $\\frac{u_L+u_R}{2}=0$, meaning $u_L = -u_R$.\nIn this situation, Roe scaling gives $\\alpha_{\\mathrm{roe}} = |\\frac{u_L-u_L}{2}| = 0$. With zero dissipation, the entropy production $\\Sigma = 0$. The scheme becomes entropy-conservative, which is incorrect for a shock, as a physical shock must strictly dissipate entropy. This failure to introduce dissipation, a so-called \"entropy glitch,\" allows for non-physical solutions like expansion shocks to form.\nIn contrast, Rusanov scaling gives $\\alpha_{\\max} = \\max(|u_L|, |-u_L|) = |u_L| > 0$ for a non-trivial shock. This ensures that $\\Sigma < 0$, providing the strict entropy dissipation required by the second law of thermodynamics (in its fluid mechanical guise as the Lax entropy condition), thus stabilizing the numerical solution and selecting the physically correct shock. This demonstrates why a larger scaling, insensitive to the shock speed becoming zero, is required for robustness, especially for capturing transonic phenomena correctly.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of analyzing entropy-stable fluxes for Burgers' equation.\n    \"\"\"\n\n    test_cases = [\n        (0.2, 0.3),\n        (1.0, -1.0),\n        (0.5, 0.1),\n        (0.7, 0.7)\n    ]\n\n    def f_ec(u_L, u_R):\n        \"\"\"\n        Computes the entropy-conservative (EC) flux for Burgers' equation.\n        f_ec(u_L, u_R) = (1/6) * (u_L^2 + u_L*u_R + u_R^2)\n        \"\"\"\n        return (1/6) * (u_L**2 + u_L * u_R + u_R**2)\n\n    def v(u):\n        \"\"\"\n        Computes the entropy variable v(u) = u.\n        \"\"\"\n        return u\n\n    def psi(u):\n        \"\"\"\n        Computes the entropy potential psi(u) = (1/6) * u^3.\n        \"\"\"\n        return (1/6) * u**3\n\n    def alpha_roe(u_L, u_R):\n        \"\"\"\n        Computes the Roe dissipation scaling.\n        alpha_roe = |(u_L + u_R) / 2|\n        \"\"\"\n        return np.abs((u_L + u_R) / 2)\n\n    def alpha_max(u_L, u_R):\n        \"\"\"\n        Computes the Rusanov (local Lax-Friedrichs) dissipation scaling.\n        alpha_max = max(|u_L|, |u_R|)\n        \"\"\"\n        return np.maximum(np.abs(u_L), np.abs(u_R))\n\n    def sigma(u_L, u_R, alpha_func):\n        \"\"\"\n        Computes the per-interface discrete entropy production Sigma.\n        Sigma = -0.5 * alpha(u_L, u_R) * (v_R - v_L)^2\n        For the chosen entropy, v(u) = u.\n        \"\"\"\n        diss_coeff = alpha_func(u_L, u_R)\n        v_L, v_R = v(u_L), v(u_R)\n        return -0.5 * diss_coeff * (v_R - v_L)**2\n\n    results = []\n    for u_L, u_R in test_cases:\n        # 1. Compute the entropy-conservative flux value\n        f_ec_val = round(f_ec(u_L, u_R), 6)\n\n        # 2. Compute the discrete entropy production using Rusanov scaling\n        sigma_max_val = round(sigma(u_L, u_R, alpha_max), 6)\n        # Handle potential -0.0\n        if sigma_max_val == -0.0:\n            sigma_max_val = 0.0\n\n        # 3. Check if Roe scaling is strictly positive definite for non-identical states\n        # The condition is alpha_roe > 0 if u_L != u_R. This is true unless u_L + u_R = 0.\n        # It is also defined as True if u_L == u_R.\n        spd_roe = (u_L == u_R) or (u_L + u_R != 0)\n\n        # 4. Check if Roe scaling satisfies the sufficient monotonicity bound\n        # The problem defines this bound as alpha_max.\n        ar = alpha_roe(u_L, u_R)\n        am = alpha_max(u_L, u_R)\n        # Use a small tolerance for floating point comparison\n        mono_roe = ar >= am or np.isclose(ar, am)\n\n        # 5. Verify the symmetry of the entropy-conservative flux\n        sym_ec = np.isclose(f_ec(u_L, u_R), f_ec(u_R, u_L), atol=1e-12, rtol=0)\n\n        results.append([f_ec_val, sigma_max_val, spd_roe, mono_roe, sym_ec])\n    \n    # Format the final output string exactly as required, handling lists within lists\n    # by converting each inner list to its string representation.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3314743"}, {"introduction": "While constructing a scheme from scratch is instructive, it is equally important to analyze common, off-the-shelf numerical fluxes. This practice focuses on the widely-used Local Lax-Friedrichs (LLF) or Rusanov flux, which adds a simple but effective dissipation to a central flux approximation [@problem_id:3386414]. By deriving the exact formula for the numerical entropy production, you will discover the precise conditions under which insufficient dissipation can lead to a violation of the second law of thermodynamics, and you will use this insight to engineer a robust dissipation coefficient that guarantees stability.", "problem": "Consider the one-dimensional scalar conservation law with the Burgers flux. Let the conserved variable be $u \\in \\mathbb{R}$ and the flux be $f(u) = \\tfrac{1}{2}u^{2}$. Consider the convex entropy $U(u) = \\tfrac{1}{2}u^{2}$ with entropy flux $G(u)$ chosen to satisfy the compatibility condition for entropy pairs. Let the entropy variable be $v = \\dfrac{\\mathrm{d}U}{\\mathrm{d}u}$ and the entropy potential be $\\psi(u) = v(u) f(u) - G(u)$. At a single interface between left and right states $u_{L}$ and $u_{R}$, define the discrete entropy production (interface contribution) as the scalar quantity\n$$\n\\sigma = \\big(v_{R} - v_{L}\\big) \\, \\widehat{f}(u_{L},u_{R}) - \\big(\\psi(u_{R}) - \\psi(u_{L})\\big),\n$$\nwhere $\\widehat{f}$ is a two-point numerical flux.\n\nYour task is to analyze how insufficient numerical dissipation in the Local Lax-Friedrichs (LLF) flux impacts the sign of the interface entropy production $\\sigma$, and to propose a robust estimator for the interface dissipation coefficient which guarantees a non-positive discrete entropy production for the Burgers equation. You must proceed from fundamental laws and core definitions only, without using shortcut formulas not derived from first principles.\n\nSpecifically:\n\n- Use $f(u) = \\tfrac{1}{2}u^{2}$, $U(u) = \\tfrac{1}{2}u^{2}$, and verify $v(u) = u$ and $\\psi(u)$ from the entropy pair definitions. Use the standard LLF flux defined by a central part and a symmetric dissipation term scaled by a coefficient $\\alpha \\ge 0$ based on the local wave speed. The LLF flux central part must use only $f(u_{L})$ and $f(u_{R})$ and the antisymmetric dissipation must depend on the jump between states. From these definitions, derive the expression for $\\sigma$ at an interface as a function of $u_{L}$, $u_{R}$, and $\\alpha$.\n\n- Determine analytically the conditions under which $\\sigma$ becomes strictly positive when the dissipation coefficient $\\alpha$ is underestimated relative to the required bound in the LLF flux for Burgers. Quantify this condition in terms of $u_{L}$ and $u_{R}$.\n\n- Propose a robust estimator $\\alpha_{\\mathrm{rob}}(u_{L},u_{R})$ for the interface dissipation coefficient that guarantees $\\sigma \\le 0$ for all $u_{L}$ and $u_{R}$ for the Burgers equation when using the LLF flux. Your estimator must be expressed purely in terms of the two states $u_{L}$ and $u_{R}$ and standard characteristics of $f$; it must not rely on any external tuning parameters.\n\n- Implement a program that, for a given set of test cases, evaluates the sign of $\\sigma$ for the LLF flux with an underestimated dissipation $\\alpha_{\\mathrm{under}} = k \\cdot \\max\\{|f'(u_{L})|,|f'(u_{R})|\\}$, where $0 < k < 1$, and compares this with the sign of $\\sigma$ when using your robust estimator $\\alpha_{\\mathrm{rob}}(u_{L},u_{R})$. The program must return, for each test case, a list of two boolean values indicating whether $\\sigma \\le 0$ under the underestimated dissipation and under the robust dissipation, respectively.\n\nUse the following test suite of parameter triples $(u_{L},u_{R},k)$ to comprehensively assess different scenarios:\n\n1. $(0,2,0.1)$: a positive jump with a strongly underestimated dissipation.\n2. $(1,5,0.1)$: a larger positive jump with a strongly underestimated dissipation.\n3. $(5,1,0.1)$: a negative jump with a strongly underestimated dissipation.\n4. $(2,2,0.1)$: zero jump.\n5. $(-1,2,0.1)$: a positive jump crossing through zero with a strongly underestimated dissipation.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is a two-entry list of boolean values corresponding to the two dissipation choices for the same test case (e.g., \"[[true_case1_under,true_case1_rob],[...],...]\"). The booleans must be printed using the programming language’s native boolean literals.\n\nNo physical units or angle units are involved. All answers are dimensionless.", "solution": "The problem statement is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n### Step 1: Extract Givens\n- **Conservation Law**: One-dimensional scalar conservation law $\\partial_t u + \\partial_x f(u) = 0$.\n- **Flux Function**: $f(u) = \\tfrac{1}{2}u^{2}$ (Burgers' equation).\n- **Conserved Variable**: $u \\in \\mathbb{R}$.\n- **Entropy Function**: A convex entropy $U(u) = \\tfrac{1}{2}u^{2}$.\n- **Entropy Flux**: $G(u)$, defined by the compatibility condition $\\dfrac{\\mathrm{d}G}{\\mathrm{d}u} = v(u) \\dfrac{\\mathrm{d}f}{\\mathrm{d}u}$.\n- **Entropy Variable**: $v = \\dfrac{\\mathrm{d}U}{\\mathrm{d}u}$.\n- **Entropy Potential**: $\\psi(u) = v(u) f(u) - G(u)$.\n- **Interface States**: $u_{L}$ and $u_{R}$.\n- **Discrete Entropy Production**: $\\sigma = \\big(v_{R} - v_{L}\\big) \\, \\widehat{f}(u_{L},u_{R}) - \\big(\\psi(u_{R}) - \\psi(u_{L})\\big)$.\n- **Numerical Flux**: Local Lax-Friedrichs (LLF) flux, $\\widehat{f}(u_L, u_R)$, with a central part based on $f(u_L)$ and $f(u_R)$, and an antisymmetric dissipation term scaled by a coefficient $\\alpha \\ge 0$.\n- **Underestimated Dissipation**: $\\alpha_{\\mathrm{under}} = k \\cdot \\max\\{|f'(u_{L})|,|f'(u_{R})|\\}$ for $0 < k < 1$.\n- **Task**:\n    1.  Derive the expression for $\\sigma$ as a function of $u_L$, $u_R$, and $\\alpha$.\n    2.  Find the analytical condition for $\\sigma > 0$.\n    3.  Propose a robust estimator $\\alpha_{\\mathrm{rob}}(u_{L},u_{R})$ that guarantees $\\sigma \\le 0$.\n    4.  Implement a program to test $\\sigma \\le 0$ with $\\alpha_{\\mathrm{under}}$ and $\\alpha_{\\mathrm{rob}}$ for given test cases.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, dealing with established concepts of entropy stability for numerical methods for conservation laws. It is well-posed, with all necessary definitions provided to derive a unique solution. The language is objective and formal. The setup is complete and internally consistent. The task is a standard exercise in the analysis of numerical schemes and is entirely verifiable through mathematical derivation and computation.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A complete solution will be provided.\n\n---\n\nThe solution is developed from first principles as requested.\n\n### Derivation of Entropy-Related Quantities\nGiven the flux $f(u) = \\tfrac{1}{2}u^2$ and the entropy function $U(u) = \\tfrac{1}{2}u^2$.\n\n1.  **Entropy Variable $v(u)$**: The entropy variable is the derivative of the entropy function with respect to the conserved variable.\n    $$\n    v(u) = \\frac{\\mathrm{d}U}{\\mathrm{d}u} = \\frac{\\mathrm{d}}{\\mathrm{d}u}\\left(\\frac{1}{2}u^2\\right) = u\n    $$\n    Thus, $v_L = u_L$ and $v_R = u_R$.\n\n2.  **Entropy Flux $G(u)$**: The entropy flux is determined by the compatibility condition $\\dfrac{\\mathrm{d}G}{\\mathrm{d}u} = v(u) \\dfrac{\\mathrm{d}f}{\\mathrm{d}u}$. The derivative of the physical flux is $\\dfrac{\\mathrm{d}f}{\\mathrm{d}u} = \\dfrac{\\mathrm{d}}{\\mathrm{d}u}(\\tfrac{1}{2}u^2) = u$.\n    $$\n    \\frac{\\mathrm{d}G}{\\mathrm{d}u} = v(u) \\frac{\\mathrm{d}f}{\\mathrm{d}u} = u \\cdot u = u^2\n    $$\n    Integrating with respect to $u$ yields the entropy flux (the constant of integration is set to zero without loss of generality):\n    $$\n    G(u) = \\int u^2 \\, \\mathrm{d}u = \\frac{1}{3}u^3\n    $$\n\n3.  **Entropy Potential $\\psi(u)$**: The entropy potential is defined as $\\psi(u) = v(u)f(u) - G(u)$.\n    $$\n    \\psi(u) = (u)\\left(\\frac{1}{2}u^2\\right) - \\left(\\frac{1}{3}u^3\\right) = \\frac{1}{2}u^3 - \\frac{1}{3}u^3 = \\frac{1}{6}u^3\n    $$\n    Thus, the jump in the entropy potential across the interface is $\\psi(u_R) - \\psi(u_L) = \\tfrac{1}{6}u_R^3 - \\tfrac{1}{6}u_L^3$.\n\n### Derivation of Interface Entropy Production $\\sigma$\n\n1.  **Local Lax-Friedrichs (LLF) Flux**: The LLF flux is defined as the average of the fluxes plus a dissipation term proportional to the jump in the states.\n    $$\n    \\widehat{f}(u_L, u_R) = \\frac{f(u_L) + f(u_R)}{2} - \\frac{\\alpha}{2}(u_R - u_L)\n    $$\n    Substituting $f(u) = \\tfrac{1}{2}u^2$:\n    $$\n    \\widehat{f}(u_L, u_R) = \\frac{\\frac{1}{2}u_L^2 + \\frac{1}{2}u_R^2}{2} - \\frac{\\alpha}{2}(u_R - u_L) = \\frac{1}{4}(u_L^2 + u_R^2) - \\frac{\\alpha}{2}(u_R - u_L)\n    $$\n\n2.  **Expression for $\\sigma$**: Substitute the derived quantities into the definition of $\\sigma$.\n    $$\n    \\sigma = (v_R - v_L) \\widehat{f}(u_L, u_R) - (\\psi_R - \\psi_L)\n    $$\n    $$\n    \\sigma = (u_R - u_L) \\left[ \\frac{1}{4}(u_L^2 + u_R^2) - \\frac{\\alpha}{2}(u_R - u_L) \\right] - \\left( \\frac{1}{6}u_R^3 - \\frac{1}{6}u_L^3 \\right)\n    $$\n    To simplify, let us use the algebraic identity $u_R^3 - u_L^3 = (u_R - u_L)(u_R^2 + u_R u_L + u_L^2)$.\n    $$\n    \\sigma = (u_R - u_L) \\left[ \\frac{1}{4}(u_L^2 + u_R^2) \\right] - \\frac{\\alpha}{2}(u_R - u_L)^2 - \\frac{1}{6}(u_R - u_L)(u_R^2 + u_R u_L + u_L^2)\n    $$\n    Factor out the term $(u_R - u_L)$:\n    $$\n    \\sigma = (u_R - u_L) \\left[ \\frac{1}{4}(u_L^2 + u_R^2) - \\frac{1}{6}(u_R^2 + u_R u_L + u_L^2) \\right] - \\frac{\\alpha}{2}(u_R - u_L)^2\n    $$\n    Combine the terms within the brackets with a common denominator of $12$:\n    $$\n    \\frac{3(u_L^2 + u_R^2) - 2(u_R^2 + u_R u_L + u_L^2)}{12} = \\frac{3u_L^2 + 3u_R^2 - 2u_R^2 - 2u_R u_L - 2u_L^2}{12} = \\frac{u_L^2 - 2u_L u_R + u_R^2}{12} = \\frac{(u_R - u_L)^2}{12}\n    $$\n    Substituting this back into the expression for $\\sigma$:\n    $$\n    \\sigma = (u_R - u_L) \\left[ \\frac{(u_R - u_L)^2}{12} \\right] - \\frac{\\alpha}{2}(u_R - u_L)^2 = \\frac{(u_R - u_L)^3}{12} - \\frac{\\alpha}{2}(u_R - u_L)^2\n    $$\n    This expression can be factored to facilitate analysis:\n    $$\n    \\sigma = (u_R - u_L)^2 \\left[ \\frac{u_R - u_L}{12} - \\frac{\\alpha}{2} \\right]\n    $$\n\n### Condition for Positive Entropy Production ($\\sigma > 0$)\n\nThe discrete entropy condition requires that the numerical scheme does not generate entropy, i.e., $\\sigma \\le 0$. We analyze the conditions under which this is violated.\nThe term $(u_R - u_L)^2$ is always non-negative. If $u_L = u_R$, $\\sigma = 0$. For $u_L \\neq u_R$, the sign of $\\sigma$ is determined by the term in the brackets.\nViolation of the entropy condition ($\\sigma > 0$) occurs if and only if:\n$$\n\\frac{u_R - u_L}{12} - \\frac{\\alpha}{2} > 0 \\implies \\frac{u_R - u_L}{6} > \\alpha\n$$\nThis inequality can only be satisfied if $u_R - u_L > 0$, which corresponds to an expansion fan in the exact solution. A numerical scheme producing a positive $\\sigma$ for such a case is admitting an unphysical \"expansion shock\". Thus, insufficient dissipation ($\\alpha$ being too small) can lead to a violation of the second law of thermodynamics for states where $u_L < u_R$. For physical shocks ($u_L > u_R$), $u_R - u_L < 0$, making the bracketed term negative (since $\\alpha \\ge 0$), so $\\sigma < 0$, which is physically correct (entropy is dissipated).\n\n### Robust Dissipation Estimator $\\alpha_{\\mathrm{rob}}$\n\nTo guarantee that the entropy condition $\\sigma \\le 0$ is always satisfied, we must choose $\\alpha$ such that the bracketed term is always non-positive.\n$$\n\\frac{u_R - u_L}{12} - \\frac{\\alpha}{2} \\le 0 \\implies \\alpha \\ge \\frac{u_R - u_L}{6}\n$$\nThis condition must hold for all possible states $(u_L, u_R)$.\n- If $u_R - u_L \\le 0$, the right-hand side is non-positive. Since $\\alpha \\ge 0$ is required, any valid $\\alpha$ satisfies the condition.\n- If $u_R - u_L > 0$, we must enforce $\\alpha \\ge \\frac{u_R - u_L}{6}$.\n\nTo satisfy this for all cases, we must choose $\\alpha$ to be at least the maximum possible value of the right-hand side. A robust estimator $\\alpha_{\\mathrm{rob}}$ can be defined as the minimum value that satisfies this condition universally.\n$$\n\\alpha_{\\mathrm{rob}}(u_L, u_R) = \\max\\left(0, \\frac{u_R - u_L}{6}\\right)\n$$\nThis estimator guarantees $\\sigma \\le 0$. Specifically, if $u_L \\ge u_R$, $\\alpha_{\\mathrm{rob}} = 0$ and $\\sigma = \\frac{(u_R - u_L)^3}{12} \\le 0$. If $u_L < u_R$, $\\alpha = \\frac{u_R - u_L}{6}$, which results in $\\sigma = (u_R - u_L)^2 \\left[ \\frac{u_R - u_L}{12} - \\frac{1}{2}\\left(\\frac{u_R - u_L}{6}\\right) \\right] = 0$. Thus, for any pair $(u_L, u_R)$, this choice of dissipation ensures $\\sigma \\le 0$. This estimator depends only on the states $u_L$ and $u_R$, and its derivation is fundamentally linked to the properties of both $f(u)$ and $U(u)$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes the interface entropy production for the Burgers equation\n    with an LLF numerical flux, comparing an underestimated dissipation\n    with a robustly derived one.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (u_L, u_R, k).\n    test_cases = [\n        (0.0, 2.0, 0.1),  # Positive jump, strongly underestimated dissipation\n        (1.0, 5.0, 0.1),  # Larger positive jump, strongly underestimated dissipation\n        (5.0, 1.0, 0.1),  # Negative jump (physical shock)\n        (2.0, 2.0, 0.1),  # Zero jump\n        (-1.0, 2.0, 0.1), # Positive jump crossing zero\n    ]\n\n    results = []\n    \n    # A small tolerance for floating point comparisons to zero.\n    TOL = 1e-12\n\n    for u_L, u_R, k in test_cases:\n        # This function calculates the interface entropy production sigma\n        # based on the derived formula:\n        # sigma = (u_R - u_L)^3 / 12 - alpha / 2 * (u_R - u_L)^2\n        def calculate_sigma(alpha):\n            du = u_R - u_L\n            sigma = (du**3) / 12.0 - (alpha / 2.0) * (du**2)\n            return sigma\n\n        # --- Case 1: Underestimated Dissipation ---\n        \n        # Characteristic speeds are f'(u) = u for Burgers' equation.\n        f_prime_L = u_L\n        f_prime_R = u_R\n        \n        # Standard LLF dissipation coefficient is max(|f'(u_L)|, |f'(u_R)|).\n        # We use an underestimated version scaled by k.\n        alpha_under = k * max(abs(f_prime_L), abs(f_prime_R))\n        \n        sigma_under = calculate_sigma(alpha_under)\n        \n        # Check if the entropy condition sigma <= 0 is satisfied.\n        is_entropy_stable_under = (sigma_under <= TOL)\n\n        # --- Case 2: Robust Dissipation ---\n        \n        # Robust estimator derived from first principles to guarantee sigma <= 0.\n        # alpha_rob = max(0, (u_R - u_L) / 6)\n        alpha_rob = max(0.0, (u_R - u_L) / 6.0)\n        \n        sigma_rob = calculate_sigma(alpha_rob)\n\n        # Check if the entropy condition sigma <= 0 is satisfied.\n        is_entropy_stable_rob = (sigma_rob <= TOL)\n        \n        # Store the boolean results as a formatted string.\n        # The problem asks for lowercase boolean literals in the output.\n        result_str = f\"[{str(is_entropy_stable_under).lower()},{str(is_entropy_stable_rob).lower()}]\"\n        results.append(result_str)\n\n    # Final print statement in the exact required format.\n    # Example: [[false,true],[false,true],...]\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3386414"}, {"introduction": "A key drawback of simple entropy-stable schemes like the LLF flux is that their dissipation acts uniformly, often smearing smooth features of the solution. This final practice introduces a more sophisticated and practical approach: an adaptive artificial viscosity model [@problem_id:3386455]. You will design a 'shock sensor' based on the local entropy residual to ensure that numerical dissipation is applied selectively—strongest near shocks and weakest in smooth regions—leading to a more accurate and efficient scheme while rigorously maintaining the entropy stability proven in the previous exercises.", "problem": "Consider the one-dimensional scalar conservation law $u_t + f(u)_x = 0$ on a periodic domain with cell-centered finite volume discretization. Focus on the inviscid Burgers equation with $f(u) = \\frac{1}{2}u^2$ and the strictly convex mathematical entropy $\\eta(u) = \\frac{1}{2}u^2$ with corresponding entropy flux $q(u) = \\frac{1}{3}u^3$. Let the entropy variable be $v(u) = \\eta'(u) = u$ and the entropy potential be $\\psi(u) = v(u) f(u) - q(u) = \\frac{1}{6}u^3$. Use a uniform grid of $N$ cells with spacing $h$, and denote $u_i$ as the cell average in cell $i$.\n\nA finite volume semi-discrete scheme with a two-point numerical flux $F_{i+\\frac{1}{2}}$ at faces $x_{i+\\frac{1}{2}}$ evolves the solution via\n$$\n\\frac{d u_i}{dt} = -\\frac{1}{h}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right).\n$$\nAn entropy conservative (EC) numerical flux $F^{\\mathrm{ec}}(u_L,u_R)$ for the inviscid Burgers equation is based on Tadmor's path integral definition and in closed form equals\n$$\nF^{\\mathrm{ec}}(u_L,u_R) = \\frac{1}{6}\\left(u_L^2 + u_L u_R + u_R^2\\right),\n$$\nwhich satisfies the discrete chain rule property with the entropy potential $\\psi(u)$.\n\nYou are to:\n1) Derive an artificial viscosity model proportional to a discrete entropy residual $\\mathcal{R}_{\\eta}$. Define the discrete entropy residual at cell $i$ by the steady surrogate\n$$\n\\mathcal{R}_{\\eta,i} = \\left|\\frac{q(u_{i+1}) - q(u_{i-1})}{2h}\\right|,\n$$\nwith $q(u) = \\frac{1}{3}u^3$ and periodic indexing. Normalize it as\n$$\n\\alpha_i = \\frac{\\mathcal{R}_{\\eta,i}}{\\max_j \\mathcal{R}_{\\eta,j} + \\varepsilon},\n$$\nwith a small $\\varepsilon > 0$, and define face indicators by\n$$\n\\alpha_{i+\\frac{1}{2}} = \\max\\left(\\alpha_i,\\alpha_{i+1}\\right).\n$$\nPropose a face viscosity $\\nu_{i+\\frac{1}{2}}$ of the form\n$$\n\\nu_{i+\\frac{1}{2}} = C_{\\mathrm{av}}\\, h\\, \\alpha_{i+\\frac{1}{2}},\n$$\nwhere $C_{\\mathrm{av}} \\ge 0$ is a calibration constant. Use the dissipative flux\n$$\nF^{\\mathrm{diss}}_{i+\\frac{1}{2}} = -\\frac{\\nu_{i+\\frac{1}{2}}}{h}\\left(v(u_{i+1}) - v(u_i)\\right),\n$$\nand the combined numerical flux\n$$\nF_{i+\\frac{1}{2}} = F^{\\mathrm{ec}}(u_i,u_{i+1}) + F^{\\mathrm{diss}}_{i+\\frac{1}{2}}.\n$$\n\n2) Prove that the resulting semi-discrete scheme satisfies the discrete entropy inequality\n$$\n\\frac{d}{dt}\\left(h \\sum_{i=0}^{N-1} \\eta(u_i)\\right) \\le 0\n$$\nfor periodic boundaries, assuming $C_{\\mathrm{av}} \\ge 0$ and $\\varepsilon > 0$.\n\n3) Calibrate $C_{\\mathrm{av}}$ to control shock thickness. Consider the viscous Burgers traveling wave connecting $u_L > u_R$ when a constant viscosity $\\nu > 0$ is present. Using the known traveling wave solution structure, define the characteristic thickness length scale $L$ by the inverse slope scale of the hyperbolic tangent profile, namely\n$$\nL = \\frac{4 \\nu}{\\Delta u}, \\quad \\Delta u = u_L - u_R.\n$$\nIf a target shock thickness spanning $M$ grid cells is desired, set $L = M h$ and obtain a target viscosity\n$$\n\\nu_{\\mathrm{target}} = \\frac{1}{4}\\, \\Delta u \\, M \\, h,\n$$\nand choose $C_{\\mathrm{av}} = \\nu_{\\mathrm{target}}/h$ provided $\\max_{i+\\frac{1}{2}} \\alpha_{i+\\frac{1}{2}} = 1$.\n\nYour program must implement the above for the inviscid Burgers equation and produce results for the following test suite. All computations are non-dimensional, so no physical units are required.\n\nTest suite and required outputs:\n- Test $1$ (entropy conservation of EC flux): Let $N=64$, $h=1/N$, $x_i = \\left(i+\\frac{1}{2}\\right)h$, and $u_i = 0.5 + 0.4 \\sin(2\\pi x_i)$ for $i=0,\\dots,N-1$. Compute the semi-discrete entropy production rate\n$$\n\\frac{dH}{dt} = h \\sum_{i=0}^{N-1} v(u_i) \\frac{d u_i}{dt},\n$$\nwith $F_{i+\\frac{1}{2}} = F^{\\mathrm{ec}}(u_i,u_{i+1})$ alone (i.e., $\\nu_{i+\\frac{1}{2}}=0$). Output the absolute value $|dH/dt|$ as a float.\n\n- Test $2$ (entropy-stability with residual-based viscosity): Let $N=100$, $h=1/N$, and\n$$\nu_i = \\begin{cases}\n1.0, & x_i < 0.5,\\\\\n0.2, & x_i \\ge 0.5,\n\\end{cases}\n$$\nwith $x_i = \\left(i+\\frac{1}{2}\\right)h$. Build $\\alpha_{i+\\frac{1}{2}}$ from the discrete entropy residual, take $M=4$, compute $\\nu_{\\mathrm{target}}$ using $u_L=1.0$ and $u_R=0.2$, set $C_{\\mathrm{av}} = \\nu_{\\mathrm{target}}/h$, and $\\nu_{i+\\frac{1}{2}} = C_{\\mathrm{av}} h \\alpha_{i+\\frac{1}{2}}$. Using $F_{i+\\frac{1}{2}} = F^{\\mathrm{ec}} + F^{\\mathrm{diss}}$, compute $dH/dt$ as above and output a boolean indicating whether $dH/dt \\le 10^{-13}$.\n\n- Test $3$ (target viscosity): For $u_L=1.0$, $u_R=0.2$, $h=0.01$, and $M=4$, compute and output $\\nu_{\\mathrm{target}}$ as a float.\n\n- Test $4$ (calibrated $C_{\\mathrm{av}}$): Using the parameters of Test $3$, compute and output $C_{\\mathrm{av}} = \\nu_{\\mathrm{target}}/h$ as a float.\n\n- Test $5$ (smoothness activation level): Using the sine-wave data from Test $1$ and $C_{\\mathrm{av}}$ from Test $4$, build $\\alpha_{i+\\frac{1}{2}}$ and $\\nu_{i+\\frac{1}{2}} = C_{\\mathrm{av}} h \\alpha_{i+\\frac{1}{2}}$ and output the mean value of the face viscosity $\\frac{1}{N}\\sum_{i=0}^{N-1} \\nu_{i+\\frac{1}{2}}$ as a float.\n\nFinal output format requirement:\nYour program should produce a single line of output containing the results of Tests $1$–$5$ as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5]\").", "solution": "The problem requires the formulation and analysis of an entropy-stable finite volume scheme for the inviscid Burgers' equation, along with its numerical implementation for a set of test cases. The solution is presented in three parts: first, the construction of the numerical scheme; second, a formal proof of its entropy stability; and third, the rationale for calibrating the artificial viscosity.\n\nAn entropy-stable finite volume scheme for the scalar conservation law $\\partial_t u + \\partial_x f(u) = 0$ is constructed by combining an entropy-conservative (EC) flux with a carefully designed numerical dissipation term. The semi-discrete equation for the cell average $u_i$ in cell $i$ is\n$$\n\\frac{d u_i}{dt} = -\\frac{1}{h}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right)\n$$\nwhere $h$ is the uniform cell width and $F_{i+\\frac{1}{2}}$ is the numerical flux at the interface between cell $i$ and cell $i+1$. The total numerical flux is given by\n$$\nF_{i+\\frac{1}{2}} = F^{\\mathrm{ec}}(u_i, u_{i+1}) + F^{\\mathrm{diss}}_{i+\\frac{1}{2}}.\n$$\n\nFor the inviscid Burgers' equation, where the physical flux is $f(u) = \\frac{1}{2}u^2$, we use the strictly convex entropy function $\\eta(u) = \\frac{1}{2}u^2$. The corresponding entropy variable is $v(u) = \\eta'(u) = u$ and the entropy flux is $q(u) = \\frac{1}{3}u^3$. The entropy potential is $\\psi(u) = v(u)f(u) - q(u) = \\frac{1}{6}u^3$.\n\nThe entropy-conservative flux $F^{\\mathrm{ec}}$ is defined to satisfy the discrete entropy identity $(v(u_{i+1})-v(u_i)) F^{\\mathrm{ec}}(u_i, u_{i+1}) = \\psi(u_{i+1}) - \\psi(u_i)$. For the Burgers' equation, this flux has the closed form:\n$$\nF^{\\mathrm{ec}}(u_i, u_{i+1}) = \\frac{1}{6}\\left(u_i^2 + u_i u_{i+1} + u_{i+1}^2\\right).\n$$\nThis flux discretizes the advection part of the dynamics without introducing numerical entropy production or dissipation.\n\nTo ensure stability and capture shocks correctly, a dissipative flux $F^{\\mathrm{diss}}$ is added. This term acts as an artificial viscosity. Its form is\n$$\nF^{\\mathrm{diss}}_{i+\\frac{1}{2}} = -\\frac{\\nu_{i+\\frac{1}{2}}}{h}\\left(v(u_{i+1}) - v(u_i)\\right) = -\\frac{\\nu_{i+\\frac{1}{2}}}{h}\\left(u_{i+1} - u_i\\right)\n$$\nwhere $\\nu_{i+\\frac{1}{2}} \\ge 0$ is the face-based viscosity coefficient. To confine the dissipation to regions where it is needed (i.e., near shocks or steep gradients), $\\nu_{i+\\frac{1}{2}}$ is made proportional to a shock sensor. The problem proposes a sensor based on the discrete entropy residual, which measures the local failure to satisfy the entropy conservation equation at the discrete level. The entropy residual in cell $i$ is defined as\n$$\n\\mathcal{R}_{\\eta,i} = \\left|\\frac{q(u_{i+1}) - q(u_{i-1})}{2h}\\right|.\n$$\nThis residual is normalized to create a scaling factor $\\alpha_i \\in [0, 1]$:\n$$\n\\alpha_i = \\frac{\\mathcal{R}_{\\eta,i}}{\\max_j \\mathcal{R}_{\\eta,j} + \\varepsilon},\n$$\nwhere $\\varepsilon > 0$ is a small parameter to prevent division by zero in smooth regions. The face-based indicator $\\alpha_{i+\\frac{1}{2}}$ is taken as the maximum of its neighboring cell values to ensure the stencil of the dissipation is sufficiently wide:\n$$\n\\alpha_{i+\\frac{1}{2}} = \\max\\left(\\alpha_i, \\alpha_{i+1}\\right).\n$$\nFinally, the face viscosity is defined as\n$$\n\\nu_{i+\\frac{1}{2}} = C_{\\mathrm{av}}\\, h\\, \\alpha_{i+\\frac{1}{2}},\n$$\nwhere $C_{\\mathrm{av}} \\ge 0$ is a user-defined constant that controls the overall amount of viscosity.\n\n**Proof of Entropy Stability**\n\nWe must prove that the semi-discrete scheme satisfies the cell-wise discrete entropy inequality, which upon summation leads to the global entropy inequality $\\frac{d}{dt}\\left(h \\sum_{i} \\eta(u_i)\\right) \\le 0$. The rate of change of the total discrete entropy $H = h \\sum_{i=0}^{N-1} \\eta(u_i)$ is\n$$\n\\frac{dH}{dt} = \\frac{d}{dt} \\left(h \\sum_{i=0}^{N-1} \\eta(u_i)\\right) = h \\sum_{i=0}^{N-1} \\frac{d\\eta(u_i)}{dt}.\n$$\nUsing the chain rule, $\\frac{d\\eta(u_i)}{dt} = \\eta'(u_i) \\frac{du_i}{dt} = v_i \\frac{du_i}{dt}$, where $v_i = v(u_i)$.\n$$\n\\frac{dH}{dt} = h \\sum_{i=0}^{N-1} v_i \\frac{du_i}{dt}.\n$$\nSubstituting the finite volume scheme, $\\frac{du_i}{dt} = -\\frac{1}{h}(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}})$:\n$$\n\\frac{dH}{dt} = - \\sum_{i=0}^{N-1} v_i \\left( F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}} \\right).\n$$\nApplying summation by parts for the periodic domain (where boundary terms cancel):\n$$\n\\sum_{i=0}^{N-1} v_i \\left( F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}} \\right) = \\sum_{i=0}^{N-1} (v_i - v_{i+1}) F_{i+\\frac{1}{2}}.\n$$\nTherefore,\n$$\n\\frac{dH}{dt} = - \\sum_{i=0}^{N-1} (v_i - v_{i+1}) F_{i+\\frac{1}{2}} = \\sum_{i=0}^{N-1} (v_{i+1} - v_i) F_{i+\\frac{1}{2}}.\n$$\nNow, we substitute the full numerical flux $F_{i+\\frac{1}{2}} = F^{\\mathrm{ec}}(u_i, u_{i+1}) + F^{\\mathrm{diss}}_{i+\\frac{1}{2}}$:\n$$\n\\frac{dH}{dt} = \\sum_{i=0}^{N-1} (v_{i+1} - v_i) F^{\\mathrm{ec}}(u_i, u_{i+1}) + \\sum_{i=0}^{N-1} (v_{i+1} - v_i) F^{\\mathrm{diss}}_{i+\\frac{1}{2}}.\n$$\nThe first term, involving the EC flux, is a telescoping sum due to the defining property of $F^{\\mathrm{ec}}$:\n$$\n\\sum_{i=0}^{N-1} (v_{i+1} - v_i) F^{\\mathrm{ec}}(u_i, u_{i+1}) = \\sum_{i=0}^{N-1} (\\psi(u_{i+1}) - \\psi(u_i)) = \\psi(u_N) - \\psi(u_0).\n$$\nWith periodic boundary conditions, $u_N = u_0$, which implies $\\psi(u_N) = \\psi(u_0)$, so this sum is exactly zero. This demonstrates the \"entropy conservative\" nature of the first part of the flux.\n\nThe second term involves the dissipative flux:\n$$\n\\sum_{i=0}^{N-1} (v_{i+1} - v_i) F^{\\mathrm{diss}}_{i+\\frac{1}{2}} = \\sum_{i=0}^{N-1} (v_{i+1} - v_i) \\left( -\\frac{\\nu_{i+\\frac{1}{2}}}{h}(v_{i+1} - v_i) \\right) = -\\frac{1}{h} \\sum_{i=0}^{N-1} \\nu_{i+\\frac{1}{2}} (v_{i+1} - v_i)^2.\n$$\nThe problem specifies that $C_{\\mathrm{av}} \\ge 0$, $h > 0$, and $\\varepsilon > 0$. The construction of the viscosity coefficient $\\nu_{i+\\frac{1}{2}}$ ensures it is non-negative:\n$$\n\\nu_{i+\\frac{1}{2}} = C_{\\mathrm{av}}\\, h\\, \\underbrace{\\max(\\alpha_i, \\alpha_{i+1})}_{\\ge 0} \\ge 0.\n$$\nSince $\\nu_{i+\\frac{1}{2}} \\ge 0$ and $(v_{i+1} - v_i)^2 \\ge 0$, each term in the sum is non-negative. Thus, the entire sum is non-negative:\n$$\n\\sum_{i=0}^{N-1} \\nu_{i+\\frac{1}{2}} (v_{i+1} - v_i)^2 \\ge 0.\n$$\nCombined with the factor $-\\frac{1}{h} < 0$, the contribution from the dissipative flux is non-positive:\n$$\n-\\frac{1}{h} \\sum_{i=0}^{N-1} \\nu_{i+\\frac{1}{2}} (v_{i+1} - v_i)^2 \\le 0.\n$$\nPutting the two parts together, we have:\n$$\n\\frac{dH}{dt} = 0 + \\left( -\\frac{1}{h} \\sum_{i=0}^{N-1} \\nu_{i+\\frac{1}{2}} (v_{i+1} - v_i)^2 \\right) \\le 0.\n$$\nThis concludes the proof that the semi-discrete scheme is entropy stable.\n\n**Calibration of the Artificial Viscosity**\n\nThe constant $C_{\\mathrm{av}}$ must be calibrated to provide an appropriate amount of viscosity. The goal is to add enough viscosity to stabilize the scheme and capture shocks over a desired number of grid cells, but not so much as to excessively smear smooth features of the solution.\n\nThe calibration strategy is based on matching the numerical viscosity to the physical viscosity in the analytical traveling wave solution of the viscous Burgers' equation, $u_t + (\\frac{1}{2}u^2)_x = \\nu u_{xx}$. This equation has a steady traveling wave solution connecting a left state $u_L$ to a right state $u_R$ (with $u_L > u_R$) given by a hyperbolic tangent profile. The characteristic thickness of this wave, $L$, is defined by the inverse of the maximum slope, which scales as $L = \\frac{4\\nu}{\\Delta u}$, where $\\Delta u = u_L - u_R$.\n\nTo resolve a shock over approximately $M$ grid cells, we set the target thickness to $L = M h$. By equating the two expressions for $L$, we can solve for the required physical viscosity $\\nu$ that would produce such a shock profile:\n$$\nMh = \\frac{4\\nu}{\\Delta u} \\implies \\nu = \\frac{1}{4} \\Delta u M h.\n$$\nThis value, $\\nu_{\\mathrm{target}} = \\frac{1}{4} \\Delta u M h$, becomes the target for our artificial viscosity coefficient $\\nu_{i+\\frac{1}{2}}$ in the vicinity of a shock.\n\nThe numerical viscosity is $\\nu_{i+\\frac{1}{2}} = C_{\\mathrm{av}} h \\alpha_{i+\\frac{1}{2}}$. At the center of a sharp, fully developed shock, the entropy residual is expected to be maximal, leading to $\\alpha_{i+\\frac{1}{2}} \\approx 1$. Assuming $\\max \\alpha_{i+\\frac{1}{2}} = 1$ at the shock, the numerical viscosity becomes $\\nu_{i+\\frac{1}{2}} \\approx C_{\\mathrm{av}} h$. We set this equal to the target viscosity:\n$$\nC_{\\mathrm{av}} h = \\nu_{\\mathrm{target}} \\implies C_{\\mathrm{av}} = \\frac{\\nu_{\\mathrm{target}}}{h} = \\frac{1}{4} \\Delta u M.\n$$\nThis provides a principled way to choose $C_{\\mathrm{av}}$ based on the desired shock resolution $M$ and the strength of the shock $\\Delta u$.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by running a suite of five tests on an entropy-stable\n    finite volume scheme for the inviscid Burgers' equation.\n    \"\"\"\n    \n    # Define entropy-related functions for Burgers' equation\n    def q(u):\n        \"\"\"Entropy flux for eta(u) = u^2/2.\"\"\"\n        return u**3 / 3.0\n\n    def v(u):\n        \"\"\"Entropy variable for eta(u) = u^2/2.\"\"\"\n        return u\n\n    def F_ec(uL, uR):\n        \"\"\"Entropy-conservative flux for Burgers' equation.\"\"\"\n        return (uL**2 + uL * uR + uR**2) / 6.0\n\n    results = []\n    \n    # A small constant for normalization to avoid division by zero.\n    epsilon = np.finfo(float).eps\n\n    # --- Test 1: Entropy conservation of EC flux ---\n    N1 = 64\n    h1 = 1.0 / N1\n    x1 = (np.arange(N1) + 0.5) * h1\n    u1 = 0.5 + 0.4 * np.sin(2 * np.pi * x1)\n\n    u1_p1 = np.roll(u1, -1)  # u_{i+1}\n    \n    # Calculate EC flux at i+1/2 interfaces\n    F_ec_half_p1 = F_ec(u1, u1_p1)\n    # Flux at i-1/2 is the rolled version of flux at i+1/2\n    F_ec_half_m1 = np.roll(F_ec_half_p1, 1)\n\n    dudt1 = -(F_ec_half_p1 - F_ec_half_m1) / h1\n    dHdt1 = h1 * np.sum(v(u1) * dudt1)\n    results.append(np.abs(dHdt1))\n\n    # --- Test 2: Entropy-stability with residual-based viscosity ---\n    N2 = 100\n    h2 = 1.0 / N2\n    x2 = (np.arange(N2) + 0.5) * h2\n    u2 = np.ones(N2)\n    u2[x2 >= 0.5] = 0.2\n\n    # Neighbors for residual calculation\n    u2_p1 = np.roll(u2, -1)  # u_{i+1}\n    u2_m1 = np.roll(u2, 1)   # u_{i-1}\n    \n    # 1. Discrete entropy residual\n    R_eta_i = np.abs((q(u2_p1) - q(u2_m1)) / (2.0 * h2))\n    \n    # 2. Normalized residual\n    max_R = np.max(R_eta_i)\n    alpha_i = R_eta_i / (max_R + epsilon)\n    \n    # 3. Face indicator\n    alpha_i_p1 = np.roll(alpha_i, -1)\n    alpha_half = np.maximum(alpha_i, alpha_i_p1)\n\n    # 4. Calibration constant\n    uL_2, uR_2, M2 = 1.0, 0.2, 4.0\n    delta_u2 = uL_2 - uR_2\n    nu_target2 = 0.25 * delta_u2 * M2 * h2\n    C_av2 = nu_target2 / h2 # = 0.25 * delta_u2 * M2\n    \n    # 5. Face viscosity\n    nu_half2 = C_av2 * h2 * alpha_half\n\n    # 6. Total numerical flux\n    F_ec_half2 = F_ec(u2, u2_p1)\n    F_diss_half2 = -nu_half2 / h2 * (v(u2_p1) - v(u2))\n    F_total_half2 = F_ec_half2 + F_diss_half2\n    \n    # 7. Entropy production rate\n    F_total_half_m2 = np.roll(F_total_half2, 1)\n    dudt2 = -(F_total_half2 - F_total_half_m2) / h2\n    dHdt2 = h2 * np.sum(v(u2) * dudt2)\n    \n    results.append(dHdt2 <= 1e-13)\n\n    # --- Test 3: Target viscosity calculation ---\n    uL_3, uR_3, h3, M3 = 1.0, 0.2, 0.01, 4.0\n    delta_u3 = uL_3 - uR_3\n    nu_target3 = 0.25 * delta_u3 * M3 * h3\n    results.append(nu_target3)\n\n    # --- Test 4: Calibrated C_av calculation ---\n    C_av4 = nu_target3 / h3 # Using parameters from Test 3\n    results.append(C_av4)\n\n    # --- Test 5: Smoothness activation level ---\n    # Use sine wave from Test 1 and C_av from Test 4\n    u_p1_T5 = np.roll(u1, -1)\n    u_m1_T5 = np.roll(u1, 1)\n\n    R_eta_i_T5 = np.abs((q(u_p1_T5) - q(u_m1_T5)) / (2.0 * h1))\n    max_R_T5 = np.max(R_eta_i_T5)\n    \n    alpha_i_T5 = R_eta_i_T5 / (max_R_T5 + epsilon)\n    alpha_i_p1_T5 = np.roll(alpha_i_T5, -1)\n    alpha_half_T5 = np.maximum(alpha_i_T5, alpha_i_p1_T5)\n    \n    C_av5 = C_av4 # C_av from Test 4\n    nu_half5 = C_av5 * h1 * alpha_half_T5\n    \n    mean_nu5 = np.mean(nu_half5)\n    results.append(mean_nu5)\n    \n    # Print results in the required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3386455"}]}