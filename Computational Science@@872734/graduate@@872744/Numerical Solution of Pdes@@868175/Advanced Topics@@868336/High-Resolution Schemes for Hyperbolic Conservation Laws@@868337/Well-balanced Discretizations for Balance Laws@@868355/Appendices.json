{"hands_on_practices": [{"introduction": "To appreciate the necessity of well-balanced schemes, it is instructive to first see how a naive discretization can fail. This exercise demonstrates the fundamental principle by analyzing the \"lake-at-rest\" steady state of the shallow water equations. You will directly compute and compare the numerical residuals produced by a simple pointwise source term discretization versus a thoughtfully constructed well-balanced one, revealing how the latter achieves a perfect cancellation of numerical flux gradients and source terms [@problem_id:3462989].", "problem": "Consider the one-dimensional shallow water equations (SWE) with bottom topography in conservative form for partial differential equations (PDEs):\n$$\nh_{t} + (hu)_{x} = 0, \\qquad (hu)_{t} + \\left(hu^{2} + \\tfrac{1}{2} g h^{2}\\right)_{x} = - g h b_{x},\n$$\nwhere $h$ is the water depth, $u$ is the velocity, $g$ is the gravitational acceleration, and $b(x)$ is the bottom elevation. A lake-at-rest steady state is defined by $u(x) \\equiv 0$ and $\\eta(x) \\equiv h(x) + b(x) \\equiv H$, with $H$ a constant.\n\nOn a uniform grid with cell centers $x_{i}$ and spacing $\\Delta x$, consider a finite volume discretization of the momentum equation with the following interface numerical flux for the hydrostatic pressure term, evaluated on piecewise-constant cell states at the lake-at-rest condition (so $u \\equiv 0$):\n$$\nF_{i+\\tfrac{1}{2}} = \\tfrac{1}{4} g \\left(h_{i}^{2} + h_{i+1}^{2}\\right), \\qquad F_{i-\\tfrac{1}{2}} = \\tfrac{1}{4} g \\left(h_{i-1}^{2} + h_{i}^{2}\\right),\n$$\nand define the discrete residual of the momentum equation in cell $i$ as\n$\nR_{i} = -\\dfrac{F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}}{\\Delta x} + S_{i},\n$\nwith two different source discretizations:\n- Naive pointwise source evaluation:\n$$\nS_{i}^{\\mathrm{naive}} = - g \\, h_{i} \\, \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}.\n$$\n- A well-balanced discretization that uses a centered average of neighboring water depths to multiply a centered difference of the bottom slope:\n$$\nS_{i}^{\\mathrm{wb}} = - g \\, \\frac{h_{i+1} + h_{i-1}}{2} \\, \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}.\n$$\n\nAssume the lake-at-rest state with $h_{j} = H - b_{j}$ for all $j \\in \\{i-1, i, i+1\\}$. Derive the discrete residuals $R_{i}^{\\mathrm{naive}}$ and $R_{i}^{\\mathrm{wb}}$ in terms of $g$, $\\Delta x$, and the local bathymetry samples $b_{i-1}$, $b_{i}$, $b_{i+1}$. Provide your final result as the row matrix $\\bigl(R_{i}^{\\mathrm{naive}} \\;\\; R_{i}^{\\mathrm{wb}}\\bigr)$, simplified as far as possible. Do not include any units and do not approximate; give an exact analytic expression.", "solution": "The problem statement is critically validated before attempting a solution.\n\n### Step 1: Extract Givens\n- **Governing Equations (Shallow Water Equations):**\n$$\nh_{t} + (hu)_{x} = 0\n$$\n$$\n(hu)_{t} + \\left(hu^{2} + \\tfrac{1}{2} g h^{2}\\right)_{x} = - g h b_{x}\n$$\n- **Variables:** $h$ is water depth, $u$ is velocity, $g$ is gravitational acceleration, $b(x)$ is bottom elevation.\n- **Steady State Condition (Lake-at-Rest):** $u(x) \\equiv 0$ and $\\eta(x) \\equiv h(x) + b(x) \\equiv H$, where $H$ is a constant.\n- **Discretization:** Uniform grid with cell centers $x_{i}$ and spacing $\\Delta x$.\n- **Interface Flux (Hydrostatic Pressure Term):**\n$$\nF_{i+\\tfrac{1}{2}} = \\tfrac{1}{4} g \\left(h_{i}^{2} + h_{i+1}^{2}\\right)\n$$\n$$\nF_{i-\\tfrac{1}{2}} = \\tfrac{1}{4} g \\left(h_{i-1}^{2} + h_{i}^{2}\\right)\n$$\n- **Discrete Residual:**\n$$\nR_{i} = -\\dfrac{F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}}{\\Delta x} + S_{i}\n$$\n- **Source Term Discretizations:**\n  - Naive: $S_{i}^{\\mathrm{naive}} = - g \\, h_{i} \\, \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}$\n  - Well-balanced: $S_{i}^{\\mathrm{wb}} = - g \\, \\frac{h_{i+1} + h_{i-1}}{2} \\, \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}$\n- **Condition for Evaluation:** The lake-at-rest condition holds at the discrete level, i.e., $h_{j} = H - b_{j}$ for all relevant cell indices $j$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed for validity.\n- **Scientifically Grounded:** The problem uses the shallow water equations, a standard model in fluid dynamics. The numerical methods presented (finite volume, well-balanced schemes) are established concepts in computational physics and numerical analysis for PDEs. The problem is a standard exercise in verifying the well-balanced property of a scheme. It is scientifically and mathematically sound.\n- **Well-Posed:** The task is a direct algebraic derivation based on a complete set of given formulae and conditions. A unique result is guaranteed.\n- **Objective:** The problem is formulated using precise mathematical language, with no ambiguity or subjective elements.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A full solution will be provided.\n\n### Solution Derivation\nThe goal is to compute the discrete residuals $R_{i}^{\\mathrm{naive}}$ and $R_{i}^{\\mathrm{wb}}$ under the lake-at-rest condition. Both residuals share the same flux divergence term but differ in their source term discretizations.\n\nFirst, we analyze the flux divergence contribution to the residual, which is common to both cases. This term, which discretizes the pressure gradient $\\left(\\frac{1}{2}gh^2\\right)_x$, is given by:\n$$\n-\\frac{F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}}{\\Delta x} = -\\frac{1}{\\Delta x} \\left[ \\frac{1}{4} g \\left(h_{i}^{2} + h_{i+1}^{2}\\right) - \\frac{1}{4} g \\left(h_{i-1}^{2} + h_{i}^{2}\\right) \\right]\n$$\nSimplifying the expression inside the brackets:\n$$\n-\\frac{g}{4\\Delta x} \\left[ (h_{i}^{2} + h_{i+1}^{2}) - (h_{i-1}^{2} + h_{i}^{2}) \\right] = -\\frac{g}{4\\Delta x} \\left(h_{i+1}^{2} - h_{i-1}^{2}\\right)\n$$\nThis term represents the net pressure force on cell $i$.\n\nNow, we evaluate this expression under the lake-at-rest condition, $h_{j} = H - b_{j}$ for any index $j$.\n$$\nh_{i+1}^{2} - h_{i-1}^{2} = (H - b_{i+1})^{2} - (H - b_{i-1})^{2}\n$$\nExpanding the squares:\n$$\n= (H^{2} - 2Hb_{i+1} + b_{i+1}^{2}) - (H^{2} - 2Hb_{i-1} + b_{i-1}^{2})\n$$\n$$\n= 2H(b_{i-1} - b_{i+1}) + b_{i+1}^{2} - b_{i-1}^{2}\n$$\nFactoring the difference of squares $b_{i+1}^{2} - b_{i-1}^{2} = (b_{i+1} - b_{i-1})(b_{i+1} + b_{i-1})$ and noting that $b_{i-1} - b_{i+1} = -(b_{i+1} - b_{i-1})$:\n$$\n= -2H(b_{i+1} - b_{i-1}) + (b_{i+1} - b_{i-1})(b_{i+1} + b_{i-1})\n$$\n$$\n= (b_{i+1} - b_{i-1}) (b_{i+1} + b_{i-1} - 2H)\n$$\nSubstituting this back into the flux divergence term:\n$$\n-\\frac{g}{4\\Delta x}(h_{i+1}^{2} - h_{i-1}^{2}) = -\\frac{g}{4\\Delta x} (b_{i+1} - b_{i-1})(b_{i+1} + b_{i-1} - 2H)\n$$\n\nNow we are ready to compute the total residual for each case.\n\n**1. Naive Discretization ($R_{i}^{\\mathrm{naive}}$)**\nThe residual is $R_{i}^{\\mathrm{naive}} = -\\frac{F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}}{\\Delta x} + S_{i}^{\\mathrm{naive}}$.\nThe naive source term is $S_{i}^{\\mathrm{naive}} = - g h_{i} \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}$.\nUnder the lake-at-rest condition, $h_{i} = H - b_{i}$, so the source term becomes:\n$$\nS_{i}^{\\mathrm{naive}} = -g(H - b_{i}) \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x}\n$$\nCombining the flux and source terms:\n$$\nR_{i}^{\\mathrm{naive}} = -\\frac{g(b_{i+1} - b_{i-1})(b_{i+1} + b_{i-1} - 2H)}{4\\Delta x} - \\frac{g(H - b_{i})(b_{i+1} - b_{i-1})}{2 \\Delta x}\n$$\nFactor out the common term $\\frac{g(b_{i+1} - b_{i-1})}{4\\Delta x}$:\n$$\nR_{i}^{\\mathrm{naive}} = \\frac{g(b_{i+1} - b_{i-1})}{4\\Delta x} \\left[ -(b_{i+1} + b_{i-1} - 2H) - 2(H - b_{i}) \\right]\n$$\n$$\nR_{i}^{\\mathrm{naive}} = \\frac{g(b_{i+1} - b_{i-1})}{4\\Delta x} \\left[ -b_{i+1} - b_{i-1} + 2H - 2H + 2b_{i} \\right]\n$$\n$$\nR_{i}^{\\mathrm{naive}} = \\frac{g(b_{i+1} - b_{i-1})}{4\\Delta x} \\left( 2b_{i} - b_{i+1} - b_{i-1} \\right)\n$$\nThis expression can be written more suggestively as:\n$$\nR_{i}^{\\mathrm{naive}} = -\\frac{g(b_{i+1} - b_{i-1})(b_{i+1} - 2b_{i} + b_{i-1})}{4\\Delta x}\n$$\nThis residual is non-zero for a non-flat bottom, indicating that the naive scheme generates spurious momentum at rest, which is a known numerical artifact.\n\n**2. Well-Balanced Discretization ($R_{i}^{\\mathrm{wb}}$)**\nThe residual is $R_{i}^{\\mathrm{wb}} = -\\frac{F_{i+\\tfrac{1}{2}} - F_{i-\\tfrac{1}{2}}}{\\Delta x} + S_{i}^{\\mathrm{wb}}$.\nThe well-balanced source term is $S_{i}^{\\mathrm{wb}} = -g \\frac{h_{i+1} + h_{i-1}}{2} \\frac{b_{i+1} - b_{i-1}}{2 \\Delta x} = -\\frac{g(h_{i+1} + h_{i-1})(b_{i+1} - b_{i-1})}{4 \\Delta x}$.\nThe total residual is:\n$$\nR_{i}^{\\mathrm{wb}} = -\\frac{g(h_{i+1}^{2} - h_{i-1}^{2})}{4\\Delta x} - \\frac{g(h_{i+1} + h_{i-1})(b_{i+1} - b_{i-1})}{4\\Delta x}\n$$\nFactor out $-\\frac{g}{4\\Delta x}$:\n$$\nR_{i}^{\\mathrm{wb}} = -\\frac{g}{4\\Delta x} \\left[ (h_{i+1}^{2} - h_{i-1}^{2}) + (h_{i+1} + h_{i-1})(b_{i+1} - b_{i-1}) \\right]\n$$\nUsing the identity $h_{i+1}^{2} - h_{i-1}^{2} = (h_{i+1} - h_{i-1})(h_{i+1} + h_{i-1})$:\n$$\nR_{i}^{\\mathrm{wb}} = -\\frac{g}{4\\Delta x} \\left[ (h_{i+1} - h_{i-1})(h_{i+1} + h_{i-1}) + (h_{i+1} + h_{i-1})(b_{i+1} - b_{i-1}) \\right]\n$$\nFactor out the common term $(h_{i+1} + h_{i-1})$:\n$$\nR_{i}^{\\mathrm{wb}} = -\\frac{g(h_{i+1} + h_{i-1})}{4\\Delta x} \\left[ (h_{i+1} - h_{i-1}) + (b_{i+1} - b_{i-1}) \\right]\n$$\nNow, we apply the lake-at-rest condition, $h_j = H - b_j$, to the term in the square brackets:\n$$\n(h_{i+1} - h_{i-1}) + (b_{i+1} - b_{i-1}) = \\left( (H - b_{i+1}) - (H - b_{i-1}) \\right) + (b_{i+1} - b_{i-1})\n$$\n$$\n= (-b_{i+1} + b_{i-1}) + (b_{i+1} - b_{i-1}) = 0\n$$\nSince this term is exactly zero, the entire residual becomes zero:\n$$\nR_{i}^{\\mathrm{wb}} = -\\frac{g(h_{i+1} + h_{i-1})}{4\\Delta x} \\times 0 = 0\n$$\nThis demonstrates that the \"well-balanced\" discretization perfectly preserves the lake-at-rest steady state, as its residual is identically zero.\n\nThe final result is the row matrix containing the simplified expressions for $R_{i}^{\\mathrm{naive}}$ and $R_{i}^{\\mathrm{wb}}$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix} -\\dfrac{g(b_{i+1}-b_{i-1})(b_{i+1}-2b_{i}+b_{i-1})}{4\\Delta x} & 0 \\end{pmatrix}\n}\n$$", "id": "3462989"}, {"introduction": "A scheme that is perfectly balanced in the interior of a domain can still be spoiled by improper handling of boundary conditions, leading to the generation of spurious waves. This practice problem tackles this crucial issue by examining reflecting (solid wall) boundaries for the shallow water equations [@problem_id:3462951]. By analyzing the behavior of the widely-used HLL numerical flux in conjunction with a ghost-cell boundary implementation, you will verify that a consistent treatment preserves the \"lake-at-rest\" state across the entire domain, demonstrating a key principle for robust numerical simulations.", "problem": "Consider the one-dimensional shallow water equations with bottom topography, a prototypical balance law for free-surface flows,\n$$\n\\partial_{t} U(x,t) + \\partial_{x} F\\!\\left(U(x,t)\\right) = S\\!\\left(U(x,t),\\partial_{x} z(x)\\right),\n$$\nwhere the conserved variables are $U=(h,\\,q)^{\\top}$ with water depth $h(x,t)$ and discharge $q(x,t)=h(x,t)\\,u(x,t)$, the physical flux is\n$$\nF(U) = \\begin{pmatrix} q \\\\ \\dfrac{q^{2}}{h} + \\dfrac{1}{2}\\,g\\,h^{2} \\end{pmatrix},\n$$\nand the source term modeling gravity over topography $z(x)$ is\n$$\nS(U,\\partial_{x}z) = \\begin{pmatrix} 0 \\\\ -\\,g\\,h\\,\\partial_{x} z \\end{pmatrix},\n$$\nwith $g>0$ the gravitational acceleration. A lake-at-rest configuration is defined by a constant free-surface elevation $\\eta(x)=h(x)+z(x)\\equiv H$ and zero velocity $u(x,t)\\equiv 0$. The spatial domain is the channel $[a,b]$ with reflecting (solid) walls at $x=a$ and $x=b$, meaning zero normal velocity at both boundaries.\n\nYou discretize the domain into $N$ uniform finite volumes of width $\\Delta x$, with cell centers $x_{i}$, $i=1,\\dots,N$, and adopt a first-order finite volume semi-discretization\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} U_{i}(t) = -\\,\\frac{1}{\\Delta x}\\,\\Big(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\Big) + S_{i},\n$$\nwhere $F_{i+\\frac{1}{2}}$ is a two-point numerical flux at the interface between cells $i$ and $i+1$, and $S_{i}$ is a consistent discrete source term. The numerical flux is taken to be the Harten–Lax–van Leer (HLL) flux, defined for left and right states $U_{L},U_{R}$ as\n$$\nF_{\\mathrm{HLL}}(U_{L},U_{R})=\n\\begin{cases}\nF(U_{L}), & S_{L}\\ge 0,\\\\\n\\dfrac{S_{R}\\,F(U_{L}) - S_{L}\\,F(U_{R}) + S_{L}\\,S_{R}\\,\\big(U_{R}-U_{L}\\big)}{S_{R}-S_{L}}, & S_{L}<0<S_{R},\\\\\nF(U_{R}), & S_{R}\\le 0.\n\\end{cases}\n$$\nwith one-sided signal speeds\n$$\nS_{L}=\\min\\!\\big(u_{L}-c_{L},\\,u_{R}-c_{R}\\big),\\qquad S_{R}=\\max\\!\\big(u_{L}+c_{L},\\,u_{R}+c_{R}\\big),\\qquad c=\\sqrt{g\\,h}.\n$$\nReflecting walls are imposed with ghost cells using the mirror condition: at the left boundary $x=a$, take the ghost state $U_{0}=(h_{1},-q_{1})^{\\top}$; at the right boundary $x=b$, take the ghost state $U_{N+1}=(h_{N},-q_{N})^{\\top}$.\n\nAssume the initial condition is an exact lake-at-rest state with $\\eta(x)\\equiv H$ and $u(x,0)\\equiv 0$, and assume a well-balanced source discretization $S_{i}$ that exactly preserves the lake-at-rest steady state in the interior. Let $h_{1}$ and $h_{N}$ denote the depths in the first and last cells, respectively, so that $q_{1}=q_{N}=0$ at $t=0$.\n\nTasks:\n- Using only the definitions above and the stated boundary treatment, compute the boundary numerical fluxes $F_{1/2}=F_{\\mathrm{HLL}}(U_{0},U_{1})$ and $F_{N+1/2}=F_{\\mathrm{HLL}}(U_{N},U_{N+1})$ in terms of $g$, $h_{1}$, and $h_{N}$ under the lake-at-rest configuration.\n- Then verify, from first principles and the structure of the semi-discrete update, that the wall fluxes you computed cannot generate spurious motion at $t=0^{+}$ in the cells adjacent to the boundaries when the interior discretization is well-balanced. Your verification must argue directly from the governing balance law and the structure of the discretization, not by appeal to external theorems.\n\nAnswer specification:\n- Report your final answer as a single row matrix with four entries equal to the components of the two boundary flux vectors in the order $\\big(F_{1/2}^{(1)},\\,F_{1/2}^{(2)},\\,F_{N+1/2}^{(1)},\\,F_{N+1/2}^{(2)}\\big)$.\n- No rounding is required.", "solution": "The problem is well-posed and scientifically grounded in the theory of numerical methods for hyperbolic balance laws. All required definitions and conditions are provided for a complete analysis.\n\nThe analysis consists of two parts as requested: first, the computation of the numerical fluxes at the domain boundaries under lake-at-rest initial conditions; second, a verification that these boundary conditions, combined with a well-balanced interior discretization, do not generate spurious motion in the boundary-adjacent cells at the initial time.\n\n**Part 1: Computation of Boundary Numerical Fluxes**\n\nWe are tasked with computing the numerical fluxes $F_{1/2} = F_{\\mathrm{HLL}}(U_{0}, U_{1})$ and $F_{N+1/2} = F_{\\mathrm{HLL}}(U_{N}, U_{N+1})$ at time $t=0$. The initial condition is a lake-at-rest state, meaning the velocity $u(x,0) \\equiv 0$, which implies the discharge $q(x,0) = h(x,0)u(x,0) \\equiv 0$. For the discrete states, this means $q_{i}(0) = 0$ for all $i=1, \\dots, N$.\n\n**Computation of $F_{1/2}$**\nThe flux at the left boundary interface, $x_{1/2}$, is given by $F_{1/2} = F_{\\mathrm{HLL}}(U_{L}, U_{R})$ with the left state $U_{L}$ being the ghost state $U_{0}$ and the right state $U_{R}$ being the state in the first cell, $U_{1}$.\n\nThe ghost state is defined by the reflecting wall condition: $U_{0} = (h_{1}, -q_{1})^{\\top}$.\nThe state in cell $1$ is $U_{1} = (h_{1}, q_{1})^{\\top}$.\n\nAt the initial time $t=0$, we have $q_{1}(0) = 0$. Therefore, the states for the Riemann problem at $x_{1/2}$ are:\n$$\nU_{L} = U_{0}(0)=\\begin{pmatrix} h_{1} \\\\ -0 \\end{pmatrix} = \\begin{pmatrix} h_{1} \\\\ 0 \\end{pmatrix}\n$$\n$$\nU_{R} = U_{1}(0)=\\begin{pmatrix} h_{1} \\\\ 0 \\end{pmatrix}\n$$\nThe left and right states are identical: $U_{L} = U_{R} = U_{1}(0)$.\n\nWhen the input states to the HLL flux are identical, i.e., $U_{L}=U_{R}=U$, the HLL flux is consistent and reduces to the physical flux, $F(U)$. We can show this from the definition. The signal speeds are $S_{L} = \\min(u-c, u-c) = u-c$ and $S_{R} = \\max(u+c, u+c) = u+c$. As long as the flow is subcritical ($|u|<c$), we have $S_{L}<0<S_{R}$, and the middle formula for $F_{\\mathrm{HLL}}$ applies:\n$$\nF_{\\mathrm{HLL}}(U,U) = \\frac{S_{R}F(U) - S_{L}F(U) + S_{L}S_{R}(U-U)}{S_{R}-S_{L}} = \\frac{(S_{R}-S_{L})F(U)}{S_{R}-S_{L}} = F(U).\n$$\nIn our case, $u=0$ and $c=\\sqrt{g h_{1}}>0$, so the condition holds. Thus, the numerical flux at the left boundary is:\n$$\nF_{1/2} = F(U_{1}(0)) = F\\left(\\begin{pmatrix} h_{1} \\\\ 0 \\end{pmatrix}\\right).\n$$\nUsing the definition of the physical flux $F(U) = \\left(q, \\frac{q^{2}}{h} + \\frac{1}{2}gh^{2}\\right)^{\\top}$:\n$$\nF_{1/2} = \\begin{pmatrix} 0 \\\\ \\dfrac{0^{2}}{h_{1}} + \\dfrac{1}{2}g h_{1}^{2} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ \\dfrac{1}{2}g h_{1}^{2} \\end{pmatrix}.\n$$\n\n**Computation of $F_{N+1/2}$**\nThe same logic applies to the right boundary interface, $x_{N+1/2}$. The flux is $F_{N+1/2} = F_{\\mathrm{HLL}}(U_{L}, U_{R})$ with $U_{L}=U_{N}$ and $U_{R}=U_{N+1}$.\n\nThe ghost state at the right boundary is $U_{N+1} = (h_{N}, -q_{N})^{\\top}$. At $t=0$, $q_{N}(0)=0$.\nThe states for the Riemann problem at $x_{N+1/2}$ are:\n$$\nU_{L} = U_{N}(0) = \\begin{pmatrix} h_{N} \\\\ 0 \\end{pmatrix}\n$$\n$$\nU_{R} = U_{N+1}(0) = \\begin{pmatrix} h_{N} \\\\ -0 \\end{pmatrix} = \\begin{pmatrix} h_{N} \\\\ 0 \\end{pmatrix}\n$$\nAgain, $U_{L}=U_{R}$, so the HLL flux reduces to the physical flux:\n$$\nF_{N+1/2} = F(U_{N}(0)) = F\\left(\\begin{pmatrix} h_{N} \\\\ 0 \\end{pmatrix}\\right) = \\begin{pmatrix} 0 \\\\ \\dfrac{1}{2}g h_{N}^{2} \\end{pmatrix}.\n$$\n\n**Part 2: Verification of No Spurious Motion**\n\nWe must verify that $\\frac{\\mathrm{d}}{\\mathrm{d}t}U_{1}(0) = \\mathbf{0}$ and $\\frac{\\mathrm{d}}{\\mathrm{d}t}U_{N}(0) = \\mathbf{0}$. This property is known as well-balancing at the boundaries.\n\nThe semi-discrete update for cell $i$ is:\n$$\n\\frac{\\mathrm{d}U_{i}}{\\mathrm{d}t} = -\\frac{1}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right) + S_{i}.\n$$\nFor the solution to remain stationary, we need the right-hand side to be zero. That is, we must show $\\Delta x S_{i} = F_{i+1/2} - F_{i-1/2}$ for $i=1$ and $i=N$ when the system is in a lake-at-rest state.\n\nThe problem states that the discrete source term, $S_{i}$, is formulated such that it is well-balanced for the interior cells ($i=2, \\dots, N-1$). This is a definitional property of the numerical scheme. Let the source term be given by a function of the local states and geometry, $S_{i} = \\mathcal{S}(U_{i-1}, U_{i}, U_{i+1}, z_{i-1}, z_{i}, z_{i+1})$. The well-balanced property for interior cells means that for any set of states $\\{U_{j}\\}$ corresponding to a lake at rest, the following identity holds for $i=2, \\dots, N-1$:\n$$\n\\Delta x \\, \\mathcal{S}(U_{i-1}, U_{i}, U_{i+1}, \\dots) = F_{\\mathrm{HLL}}(U_{i}, U_{i+1}) - F_{\\mathrm{HLL}}(U_{i-1}, U_{i}). \\quad (*)\n$$\n\n**Verification for Cell 1:**\nThe update for cell $1$ at $t=0$ is:\n$$\n\\frac{\\mathrm{d}U_{1}}{\\mathrm{d}t}(0) = -\\frac{1}{\\Delta x} \\left( F_{3/2}(0) - F_{1/2}(0) \\right) + S_{1}(0).\n$$\nWe need to show the right-hand side is zero.\nThe fluxes at $t=0$ are $F_{1/2}(0) = F_{\\mathrm{HLL}}(U_{0}(0), U_{1}(0))$ and $F_{3/2}(0) = F_{\\mathrm{HLL}}(U_{1}(0), U_{2}(0))$.\nThe source term is $S_{1}(0) = \\mathcal{S}(U_{0}(0), U_{1}(0), U_{2}(0), \\dots)$.\n\nFrom Part 1, we established that the reflecting boundary condition for $q_1(0)=0$ results in $U_0(0) = U_1(0) = (h_1, 0)^\\top$.\nConsequently, $F_{1/2}(0) = F_{\\mathrm{HLL}}(U_{1}(0), U_{1}(0)) = F(U_1(0))$.\n\nThe well-balanced property $(*)$ must hold for any lake-at-rest configuration, including one where the topography is locally flat, such that $z_{i-1}=z_i$. In this case, $h_{i-1}=h_i$ and thus $U_{i-1}=U_i$. For such a configuration, the identity $(*)$ becomes:\n$$\n\\Delta x \\, \\mathcal{S}(U_{i}, U_{i}, U_{i+1}, \\dots) = F_{\\mathrm{HLL}}(U_{i}, U_{i+1}) - F_{\\mathrm{HLL}}(U_{i}, U_{i}).\n$$\nSince $F_{\\mathrm{HLL}}(U_{i}, U_{i}) = F(U_{i})$, the property is:\n$$\n\\Delta x \\, \\mathcal{S}(U_{i}, U_{i}, U_{i+1}, \\dots) = F_{\\mathrm{HLL}}(U_{i}, U_{i+1}) - F(U_{i}). \\quad (**)\n$$\nThis identity is a consequence of the scheme being well-balanced in the interior.\n\nNow, we evaluate the terms for the update of cell $1$ at $t=0$. The states are $U_0(0)=U_1(0)$ and $U_2(0)$, which are part of a lake-at-rest configuration.\nThe source term is $S_1(0) = \\mathcal{S}(U_0(0), U_1(0), U_2(0), \\dots) = \\mathcal{S}(U_1(0), U_1(0), U_2(0), \\dots)$.\nApplying the identity $(**)$ with $i=1$, we get:\n$$\n\\Delta x \\, S_{1}(0) = F_{\\mathrm{HLL}}(U_{1}(0), U_{2}(0)) - F(U_1(0)).\n$$\nWe recognize that $F_{3/2}(0) = F_{\\mathrm{HLL}}(U_1(0), U_2(0))$ and $F_{1/2}(0) = F(U_1(0))$.\nSo, $\\Delta x \\, S_{1}(0) = F_{3/2}(0) - F_{1/2}(0)$.\n\nSubstituting this into the semi-discrete equation for cell $1$:\n$$\n\\frac{\\mathrm{d}U_{1}}{\\mathrm{d}t}(0) = -\\frac{1}{\\Delta x} \\left( F_{3/2}(0) - F_{1/2}(0) \\right) + \\frac{1}{\\Delta x} \\left( F_{3/2}(0) - F_{1/2}(0) \\right) = \\mathbf{0}.\n$$\nThis verifies that no spurious motion is generated in cell $1$. The crucial step is recognizing that the boundary condition at $t=0$ makes the state at the boundary interface ($U_0, U_1$) equivalent to an interior interface with a locally flat bottom, for which the well-balanced property of the interior scheme must hold.\n\n**Verification for Cell N:**\nAn analogous argument applies to cell $N$. We need to show $\\frac{\\mathrm{d}}{\\mathrm{d}t}U_{N}(0) = \\mathbf{0}$.\nThe update is $\\frac{\\mathrm{d}U_{N}}{\\mathrm{d}t}(0) = -\\frac{1}{\\Delta x} \\left( F_{N+1/2}(0) - F_{N-1/2}(0) \\right) + S_{N}(0)$.\nAt $t=0$, the ghost state is $U_{N+1}(0) = U_N(0) = (h_N, 0)^\\top$.\nThus, $F_{N+1/2}(0) = F_{\\mathrm{HLL}}(U_{N}(0), U_{N}(0)) = F(U_{N}(0))$.\nThe source term is $S_N(0) = \\mathcal{S}(U_{N-1}(0), U_N(0), U_{N+1}(0), \\dots) = \\mathcal{S}(U_{N-1}(0), U_N(0), U_N(0), \\dots)$.\n\nThe well-balanced property $(*)$ must also hold for a configuration where $z_i=z_{i+1}$, which implies $U_i=U_{i+1}$. In this case, the identity becomes:\n$$\n\\Delta x \\, \\mathcal{S}(U_{i-1}, U_{i}, U_{i}, \\dots) = F_{\\mathrm{HLL}}(U_{i}, U_{i}) - F_{\\mathrm{HLL}}(U_{i-1}, U_{i}) = F(U_i) - F_{\\mathrm{HLL}}(U_{i-1}, U_{i}). \\quad (***)\n$$\nApplying identity $(***)$ to cell $N$ at $t=0$:\n$$\n\\Delta x \\, S_{N}(0) = F(U_N(0)) - F_{\\mathrm{HLL}}(U_{N-1}(0), U_{N}(0)).\n$$\nWe have $F_{N+1/2}(0) = F(U_N(0))$ and $F_{N-1/2}(0) = F_{\\mathrm{HLL}}(U_{N-1}(0), U_N(0))$.\nSo, $\\Delta x \\, S_{N}(0) = F_{N+1/2}(0) - F_{N-1/2}(0)$.\n\nSubstituting this into the semi-discrete equation for cell $N$:\n$$\n\\frac{\\mathrm{d}U_{N}}{\\mathrm{d}t}(0) = -\\frac{1}{\\Delta x} \\left( F_{N+1/2}(0) - F_{N-1/2}(0) \\right) + \\frac{1}{\\Delta x} \\left( F_{N+1/2}(0) - F_{N-1/2}(0) \\right) = \\mathbf{0}.\n$$\nThis verifies that the scheme is well-balanced at the right boundary as well. The combination of the reflecting wall boundary condition and a well-balanced interior scheme preserves the lake-at-rest state throughout the entire domain, including the boundary cells.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & \\frac{1}{2} g h_{1}^{2} & 0 & \\frac{1}{2} g h_{N}^{2}\n\\end{pmatrix}\n}\n$$", "id": "3462951"}, {"introduction": "Well-balanced schemes can exhibit surprisingly rich behavior when applied to balance laws with nonconvex flux functions, where a single equilibrium condition can correspond to multiple physical states. This advanced exercise delves into this fascinating area, showing that an exactly well-balanced scheme may be indifferent to which steady state solution is chosen [@problem_id:3462931]. Through a constructive coding problem, you will implement different reconstruction operators that act as selection principles, demonstrating how the choice of numerical method can deterministically select a specific physical equilibrium from a set of possibilities.", "problem": "Consider the scalar balance law for a one-dimensional Partial Differential Equation (PDE)\n$$\n\\partial_t u(x,t) + \\partial_x f(u(x,t)) = a(x),\n$$\nwith a smooth flux function $f$ and a source term $a$. A well-balanced finite volume discretization is called exact for a target family of steady states if its discrete update vanishes exactly whenever the continuous steady-state condition for that family holds, without introducing spurious transients. In particular, for steady states satisfying\n$$\n\\partial_x f(u(x)) = a(x),\n$$\nthe primitive quantity $w(x) \\equiv f(u(x))$ obeys\n$$\n\\partial_x w(x) = a(x),\n$$\nso that $w$ is determined (up to an additive constant) by integrating $a$. In a discrete mesh with uniform spacing $\\Delta x$, exact well-balancing for this family can be realized by matching the discrete fluxes to a discrete antiderivative of $a$, so that the discrete equation for the cell averages $\\{\\bar u_i\\}$ telescopes. This lifts the steady-state condition from $u$ to $w=f(u)$ and, in the case of a nonconvex flux $f$, introduces a multi-valued inversion from $w$ back to $u$.\n\nYou are asked to demonstrate, constructively and quantitatively, that for a class of nonconvex fluxes the exact well-balancing mechanism can select among multiple steady states via the choice of reconstruction used to invert $w=f(u)$. Your task has three parts:\n\n1) Starting from the definitions above and the steady-state condition, derive why, for a nonconvex flux $f$, the condition $w(x)=f(u(x))=Q(x)$ with a prescribed $Q(x)$ can admit multiple pointwise solutions $u(x)$, and why a discrete scheme that is exactly well-balanced in $w$ remains indifferent to which branch of the inverse $f^{-1}$ is chosen at each grid point. Explain how reconstruction choices constitute a selection mechanism among the admissible steady states.\n\n2) For the specific nonconvex flux\n$$\nf(u) = u^3 - u,\n$$\nand source\n$$\na(x) \\equiv 0,\n$$\nthe steady states satisfy $f(u(x)) \\equiv Q(x)$ with $Q$ constant or spatially varying. For this flux, when $Q$ lies in the interval\n$$\n\\left(-\\frac{2}{3\\sqrt{3}}, \\frac{2}{3\\sqrt{3}}\\right),\n$$\nthe algebraic equation $u^3 - u = Q$ has three distinct real roots, while outside this interval it has a unique real root. Define two reconstruction operators that map a given $Q$ to a pointwise steady state $u$:\n- $\\mathcal{R}_{\\mathrm{L}}(Q)$ selects the smallest real root of $u^3 - u = Q$.\n- $\\mathcal{R}_{\\mathrm{R}}(Q)$ selects the largest real root of $u^3 - u = Q$.\nWhen there is only one real root, both $\\mathcal{R}_{\\mathrm{L}}$ and $\\mathcal{R}_{\\mathrm{R}}$ return that unique root.\n\n3) Implement a complete, runnable program that, for a uniform mesh of $N$ cells on the interval $[0,1]$ with cell centers $x_i = (i+1/2)\\Delta x$ and $\\Delta x = 1/N$, constructs the following four steady-state tests (angles must be in radians):\n- Test A (happy path, maximally nonunique): $Q(x)\\equiv 0$.\n- Test B (multi-root but biased): $Q(x)\\equiv 0.3$.\n- Test C (single-root regime): $Q(x)\\equiv 0.5$.\n- Test D (spatially varying within the multi-root regime): $Q(x)=0.35\\sin(2\\pi x)$.\n\nFor each test, compute the two reconstructed steady states\n$$\nu^{\\mathrm{L}}_i = \\mathcal{R}_{\\mathrm{L}}(Q(x_i)), \\quad u^{\\mathrm{R}}_i = \\mathcal{R}_{\\mathrm{R}}(Q(x_i)),\n$$\nand then report the following three floats:\n- The arithmetic mean $\\overline{u}^{\\mathrm{L}} = \\frac{1}{N}\\sum_{i=0}^{N-1} u^{\\mathrm{L}}_i$.\n- The arithmetic mean $\\overline{u}^{\\mathrm{R}} = \\frac{1}{N}\\sum_{i=0}^{N-1} u^{\\mathrm{R}}_i$.\n- The discrete $L^2$-norm of the difference, defined by\n$$\n\\left\\|u^{\\mathrm{L}} - u^{\\mathrm{R}}\\right\\|_{2,\\Delta x} = \\sqrt{\\Delta x \\sum_{i=0}^{N-1} \\left(u^{\\mathrm{L}}_i - u^{\\mathrm{R}}_i\\right)^2}.\n$$\n\nYour program must:\n- Use $N=200$.\n- Compute the real roots of $u^3-u=Q$ exactly via robust algebraic formulas for cubics (no external network access or files).\n- Implement both $\\mathcal{R}_{\\mathrm{L}}$ and $\\mathcal{R}_{\\mathrm{R}}$ as defined above.\n- Produce a single line of output containing the results for Tests A, B, C, and D, in this order, each test contributing the triplet of floats in the order specified above, aggregated into one flat list. That is, the final output must be a single line of the form\n$$\n[\\overline{u}^{\\mathrm{L}}_{\\mathrm{A}},\\overline{u}^{\\mathrm{R}}_{\\mathrm{A}},\\|u^{\\mathrm{L}}-u^{\\mathrm{R}}\\|_{2,\\Delta x,\\mathrm{A}},\\overline{u}^{\\mathrm{L}}_{\\mathrm{B}},\\overline{u}^{\\mathrm{R}}_{\\mathrm{B}},\\|u^{\\mathrm{L}}-u^{\\mathrm{R}}\\|_{2,\\Delta x,\\mathrm{B}},\\overline{u}^{\\mathrm{L}}_{\\mathrm{C}},\\overline{u}^{\\mathrm{R}}_{\\mathrm{C}},\\|u^{\\mathrm{L}}-u^{\\mathrm{R}}\\|_{2,\\Delta x,\\mathrm{C}},\\overline{u}^{\\mathrm{L}}_{\\mathrm{D}},\\overline{u}^{\\mathrm{R}}_{\\mathrm{D}},\\|u^{\\mathrm{L}}-u^{\\mathrm{R}}\\|_{2,\\Delta x,\\mathrm{D}}]\n$$\nwith no spaces, where all angles are in radians and all quantities are dimensionless real numbers.\n\nDesign the implementation so that each test is reproducible and numerically stable. The final printed list must be the only output of the program. The outputs are floats; no units are involved. The program must not accept any input. The numerical results should reflect the branch-selection differences induced by $\\mathcal{R}_{\\mathrm{L}}$ versus $\\mathcal{R}_{\\mathrm{R}}$, including agreement in the single-root regime and divergence when three real roots are available.", "solution": "The problem as stated is scientifically sound, mathematically well-posed, and provides a complete set of specifications for a quantitative demonstration. It is grounded in the established theory of numerical methods for hyperbolic balance laws, specifically concerning well-balanced schemes and the challenges posed by nonconvex flux functions. The definitions are precise, the parameters are unambiguous, and the required computations are clearly defined. Therefore, the problem is valid and a full solution follows.\n\nThe core of the problem lies at the intersection of continuous PDE theory and discrete numerical approximation. We are asked to demonstrate how a numerical scheme, designed to be \"well-balanced\" for a family of steady states, can paradoxically admit multiple distinct discrete solutions, and how this ambiguity is resolved.\n\n### Part 1: The Principle of Well-Balancing and Nonconvexity\n\nWe begin with the one-dimensional scalar balance law:\n$$\n\\partial_t u(x,t) + \\partial_x f(u(x,t)) = a(x)\n$$\nHere, $u(x,t)$ is a conserved quantity, $f(u)$ is the flux function, and $a(x)$ is a spatially dependent source term. A steady state, by definition, is a solution that does not change in time, i.e., $\\partial_t u = 0$. For a solution to be a steady state, it must satisfy the ordinary differential equation:\n$$\n\\partial_x f(u(x)) = a(x)\n$$\nIntegrating this equation with respect to $x$ yields an algebraic condition on the solution $u(x)$:\n$$\nf(u(x)) = \\int a(x) \\, dx + C \\equiv Q(x)\n$$\nwhere $Q(x)$ is any antiderivative of the source term $a(x)$, with the integration constant $C$ determined by a boundary condition. This means that any steady-state solution $u(x)$ must satisfy $f(u(x)) = Q(x)$ for some function $Q(x)$ whose derivative is $a(x)$.\n\nA finite volume method for this PDE discretizes the domain into cells and evolves cell averages, $u_i(t)$. A general update formula is:\n$$\n\\frac{u_i^{n+1} - u_i^n}{\\Delta t} + \\frac{F_{i+1/2} - F_{i-1/2}}{\\Delta x} = A_i\n$$\nwhere $F_{i\\pm1/2}$ are numerical fluxes at cell interfaces and $A_i$ is a discrete representation of the source term in cell $i$. A scheme is called **well-balanced** for the family of steady states satisfying $\\partial_x f(u) = a(x)$ if the discrete update vanishes exactly when the scheme is initialized with such a state. That is, the discrete divergence of the flux must exactly cancel the discrete source:\n$$\n\\frac{F_{i+1/2} - F_{i-1/2}}{\\Delta x} = A_i\n$$\nA powerful technique to achieve this, known as an **exact well-balancing**, is to construct the scheme around the primitive quantity $w(x) = f(u(x))$. The numerical fluxes and source terms are designed such that the discrete balance is a perfect analogue of the continuous one. For instance, the numerical flux $F_{i+1/2}$ can be defined to contain the value $Q(x_{i+1/2})$, ensuring that the flux difference telescopes and matches a consistent discretization of the source term, typically $A_i = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} a(x) dx = \\frac{Q(x_{i+1/2}) - Q(x_{i-1/2})}{\\Delta x}$.\n\nThe crux of the matter arises when the flux function $f(u)$ is **nonconvex**, meaning its derivative $f'(u)$ is not monotonic. In such cases, the inverse function $u = f^{-1}(w)$ can be multi-valued. For a given value of $w = Q(x)$, there might be multiple distinct values of $u$ that satisfy $f(u) = w$.\n\nThe well-balanced scheme, by its construction, is concerned only with the balance of $w=f(u)$. It ensures that the discrete representation of $\\partial_x w$ matches the discrete source. Consequently, any discrete solution $\\{u_i\\}$ that satisfies $f(u_i) = Q(x_i)$ for all $i$ will be perfectly preserved as a steady state. The scheme is indifferent to which of the possible roots of $u_i = f^{-1}(Q(x_i))$ is chosen at each grid point $i$.\n\nThis indifference creates a family of admissible steady states for a single profile $Q(x)$. A specific steady state can only be uniquely identified by imposing an additional **selection principle**. In the context of a numerical scheme, this selection is made through the reconstruction process, which maps the underlying equilibrium data $Q(x)$ to a specific solution profile $u(x)$. The problem defines two such reconstruction operators, $\\mathcal{R}_{\\mathrm{L}}$ and $\\mathcal{R}_{\\mathrm{R}}$, which select the smallest and largest real roots, respectively. These operators resolve the ambiguity and select one unique, globally defined steady state from the manifold of possibilities.\n\n### Part 2: Analysis of the Specific Flux $f(u) = u^3 - u$\n\nThe problem provides the specific nonconvex flux $f(u) = u^3 - u$. To find the region of non-invertibility, we examine its critical points by finding the roots of its derivative:\n$$\nf'(u) = \\frac{d}{du}(u^3 - u) = 3u^2 - 1 = 0\n$$\nThe critical points are $u = \\pm 1/\\sqrt{3}$. The values of the flux at these local extrema are:\n$$\nf\\left(\\frac{1}{\\sqrt{3}}\\right) = \\left(\\frac{1}{\\sqrt{3}}\\right)^3 - \\frac{1}{\\sqrt{3}} = \\frac{1}{3\\sqrt{3}} - \\frac{1}{\\sqrt{3}} = -\\frac{2}{3\\sqrt{3}}\n$$\n$$\nf\\left(-\\frac{1}{\\sqrt{3}}\\right) = \\left(-\\frac{1}{\\sqrt{3}}\\right)^3 - \\left(-\\frac{1}{\\sqrt{3}}\\right) = -\\frac{1}{3\\sqrt{3}} + \\frac{1}{\\sqrt{3}} = \\frac{2}{3\\sqrt{3}}\n$$\nThus, for any given value of $Q$ in the open interval $(-\\frac{2}{3\\sqrt{3}}, \\frac{2}{3\\sqrt{3}})$, the horizontal line $w=Q$ intersects the graph of $f(u)$ three times. This means the equation $u^3 - u = Q$ has three distinct real roots. For $|Q| > \\frac{2}{3\\sqrt{3}}$, there is only one real root. For $|Q| = \\frac{2}{3\\sqrt{3}}$, there are two distinct real roots, one of which has multiplicity two.\n\nThe reconstruction operators $\\mathcal{R}_{\\mathrm{L}}(Q)$ and $\\mathcal{R}_{\\mathrm{R}}(Q)$ are defined to select the smallest and largest real roots of $u^3 - u - Q = 0$. When three distinct real roots exist, $\\mathcal{R}_{\\mathrm{L}}(Q) \\neq \\mathcal{R}_{\\mathrm{R}}(Q)$, leading to two different steady-state solutions, $u^{\\mathrm{L}}(x)$ and $u^{\\mathrm{R}}(x)$, for the same equilibrium profile $Q(x)$. When only one real root exists, $\\mathcal{R}_{\\mathrm{L}}(Q) = \\mathcal{R}_{\\mathrm{R}}(Q)$, and the resulting steady state is unique.\n\n### Part 3: Computational Implementation Strategy\n\nThe task requires the implementation of this selection mechanism for four test cases. The overall computational procedure is as follows:\n\n1.  **Discretization**: The spatial domain $[0, 1]$ is discretized using $N=200$ uniform cells of width $\\Delta x = 1/N$. The cell centers are $x_i = (i+1/2)\\Delta x$ for $i=0, 1, \\dots, N-1$.\n\n2.  **Equilibrium Profile Generation**: For each of the four tests (A, B, C, D), a vector of $N$ values, $\\{Q_i\\} = \\{Q(x_i)\\}$, is generated according to the specified formula for $Q(x)$.\n\n3.  **Cubic Root Finding**: A core component is a robust solver for the real roots of the depressed cubic equation $u^3 - u - Q_i = 0$ for each $Q_i$. This is achieved by implementing the standard analytical formulas. The method depends on the sign of the discriminant related term $D = Q_i^2/4 - 1/27$:\n    -   If $D > 0$, corresponding to $|Q_i| > 2/(3\\sqrt{3})$, there is one real root, found using Cardano's formula.\n    -   If $D < 0$, corresponding to $|Q_i| < 2/(3\\sqrt{3})$, there are three distinct real roots, found using the trigonometric/Vieta's substitution method.\n    -   If $D = 0$, corresponding to $|Q_i| = 2/(3\\sqrt{3})$, there are multiple roots which can be calculated directly.\n\n4.  **Reconstruction**: For each $i$, the list of real roots of $u^3 - u - Q_i = 0$ is computed and sorted. The reconstruction operators $\\mathcal{R}_{\\mathrm{L}}$ and $\\mathcal{R}_{\\mathrm{R}}$ are applied by selecting the first (smallest) and last (largest) elements of the sorted list, respectively. This produces two vectors of solution values, $u^{\\mathrm{L}}$ and $u^{\\mathrm{R}}$, each of size $N$.\n\n5.  **Analysis**: For each test case, the following three quantities are computed from the reconstructed solution vectors:\n    -   The arithmetic mean of the 'left' state: $\\overline{u}^{\\mathrm{L}} = \\frac{1}{N}\\sum_{i=0}^{N-1} u^{\\mathrm{L}}_i$.\n    -   The arithmetic mean of the 'right' state: $\\overline{u}^{\\mathrm{R}} = \\frac{1}{N}\\sum_{i=0}^{N-1} u^{\\mathrm{R}}_i$.\n    -   The discrete $L^2$-norm of the difference: $\\|u^{\\mathrm{L}} - u^{\\mathrm{R}}\\|_{2,\\Delta x} = \\sqrt{\\Delta x \\sum_{i=0}^{N-1} (u^{\\mathrm{L}}_i - u^{\\mathrm{R}}_i)^2}$.\n\n6.  **Output**: The twelve resulting floating-point numbers (a triplet for each of the four tests) are collected into a single list and printed in the specified format. The results will quantitatively demonstrate the selection mechanism: for Tests A, B, and D, where $Q(x)$ enters the multi-root regime, the two reconstructed solutions will differ, yielding a non-zero norm. For Test C, where $Q(x)$ is in the single-root regime, the solutions will be identical, and the norm of their difference will be zero.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of reconstructing steady states for a balance law with a nonconvex flux.\n    \"\"\"\n\n    N = 200\n    DX = 1.0 / N\n    x = (np.arange(N) + 0.5) * DX\n    \n    # Define the four test cases for the equilibrium profile Q(x).\n    test_cases = [\n        (\"A\", lambda x_vals: np.full_like(x_vals, 0.0)),\n        (\"B\", lambda x_vals: np.full_like(x_vals, 0.3)),\n        (\"C\", lambda x_vals: np.full_like(x_vals, 0.5)),\n        (\"D\", lambda x_vals: 0.35 * np.sin(2 * np.pi * x_vals)),\n    ]\n\n    all_results = []\n\n    def solve_cubic_real_roots(q_val):\n        \"\"\"\n        Computes the real roots of u^3 - u - q = 0 using analytical formulas.\n        The equation is in depressed cubic form u^3 + p*u + q' = 0 with p=-1, q'=-q_val.\n        \n        The method selection is based on the sign of the discriminant.\n        \"\"\"\n        # Using the formulation for x^3 + px + q = 0\n        p, q_prime = -1.0, -q_val\n        \n        # Discriminant term from Cardano's formula: D = (q'/2)^2 + (p/3)^3\n        d = (q_prime / 2.0)**2 + (p / 3.0)**3\n        \n        # Machine epsilon for floating point comparison\n        epsilon = 1e-12\n\n        if d > epsilon:\n            # One real root\n            term = np.sqrt(d)\n            root = np.cbrt(-q_prime / 2.0 + term) + np.cbrt(-q_prime / 2.0 - term)\n            return [root]\n        elif d  -epsilon:\n            # Three distinct real roots (trigonometric solution)\n            # Roots are 2*sqrt(-p/3)*cos((1/3)*acos((3q')/(2p*sqrt(-p/3))) - 2*pi*k/3) for k=0,1,2\n            term_mul = 2.0 * np.sqrt(-p / 3.0) # 2/sqrt(3)\n            arg_acos = (3.0 * q_prime) / (2.0 * p * np.sqrt(-p / 3.0))\n            \n            # Clip argument to arccos to handle potential floating point inaccuracies\n            arg_acos = np.clip(arg_acos, -1.0, 1.0)\n            \n            phi = np.arccos(arg_acos)\n            \n            root1 = term_mul * np.cos(phi / 3.0)\n            root2 = term_mul * np.cos((phi - 2.0 * np.pi) / 3.0)\n            root3 = term_mul * np.cos((phi + 2.0 * np.pi) / 3.0)\n            \n            return sorted([root1, root2, root3])\n        else: # d is close to zero\n            # Three real roots with at least two equal\n            # For D=0, q_val^2 = 4/27\n            # Roots are 2*A, -A, -A where A = sgn(q_val)/sqrt(3)\n            # If q_val is also zero, roots are -1, 0, 1\n            if abs(q_val)  epsilon:\n                return sorted([-1.0, 0.0, 1.0])\n\n            A = np.sign(q_val) / np.sqrt(3.0)\n            root_single = 2.0*A\n            root_double = -A\n            \n            return sorted([root_single, root_double, root_double])\n\n\n    for test_name, q_func in test_cases:\n        Q_vals = q_func(x)\n        \n        u_L = np.zeros(N)\n        u_R = np.zeros(N)\n\n        for i in range(N):\n            q_i = Q_vals[i]\n            roots = solve_cubic_real_roots(q_i)\n            \n            # R_L selects the smallest real root\n            u_L[i] = roots[0]\n            # R_R selects the largest real root\n            u_R[i] = roots[-1]\n\n        # Compute the required metrics\n        mean_u_L = np.mean(u_L)\n        mean_u_R = np.mean(u_R)\n        l2_diff_norm = np.sqrt(DX * np.sum((u_L - u_R)**2))\n        \n        all_results.extend([mean_u_L, mean_u_R, l2_diff_norm])\n\n    # Format the final output string exactly as specified\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "3462931"}]}