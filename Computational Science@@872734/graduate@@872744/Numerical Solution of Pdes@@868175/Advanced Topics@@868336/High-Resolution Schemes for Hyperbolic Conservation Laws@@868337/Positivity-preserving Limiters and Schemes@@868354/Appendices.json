{"hands_on_practices": [{"introduction": "High-order numerical methods for conservation laws can produce solutions that violate physical bounds, such as positivity, even when the cell average is correct. The Zhang–Shu scaling limiter is a foundational technique that corrects these violations by scaling the solution polynomial towards its cell average, thereby enforcing an invariant region. This first practice [@problem_id:3433642] provides a direct, hands-on calculation of the scaling factor $\\theta$, which is the core component of the limiter, giving you a concrete understanding of its mechanism.", "problem": "Consider the one-dimensional scalar conservation law $u_{t} + f(u)_{x} = 0$ on a uniform mesh of cells, with initial data satisfying an invariant-region (maximum-principle) bound $u(x,0) \\in [m,M]$ for all $x$. Assume the exact solution remains in $[m,M]$ for all time. On a given cell $K$, let the high-order Discontinuous Galerkin (DG) polynomial representation be $u_{h}(x)$ with cell average $\\bar{u}_{K}$.\n\nThe Zhang–Shu bound-preserving scaling limiter modifies $u_{h}(x)$ to a limited polynomial $\\tilde{u}_{h}(x)$ inside $K$ by a linear scaling around the cell average with an unknown factor $\\theta \\in [0,1]$ chosen to enforce $m \\le \\tilde{u}_{h}(x) \\le M$ at a prescribed set of points $S \\subset K$. Specifically, define\n$$\n\\tilde{u}_{h}(x) = \\theta\\big(u_{h}(x) - \\bar{u}_{K}\\big) + \\bar{u}_{K}, \\quad x \\in K,\n$$\nand take $S$ to be the three Legendre–Gauss–Lobatto (LGL) nodes in $K$. The limiter must enforce\n$$\nm \\le \\tilde{u}_{h}(x_{q}) \\le M \\quad \\text{for all } x_{q} \\in S.\n$$\n\nSuppose on a particular cell $K$ you are given the following data:\n- Cell average: $\\bar{u}_{K} = 1.0$.\n- Invariant-region bounds: $m = 0.2$ and $M = 1.5$.\n- Pointwise values of the high-order polynomial at the LGL nodes $S = \\{x_{1},x_{2},x_{3}\\}$ are $u_{h}(x_{1}) = 0.05$, $u_{h}(x_{2}) = 1.90$, and $u_{h}(x_{3}) = 1.05$.\n\nUsing only the definitions above and first principles about convex scaling and extremal constraints, determine the minimal $\\theta \\in [0,1]$ that guarantees $m \\le \\tilde{u}_{h}(x_{q}) \\le M$ at all three nodes $x_{q} \\in S$. Round your answer to four significant figures. The final answer must be a single real number with no units.", "solution": "The problem requires the determination of the scaling factor $\\theta$ for the Zhang–Shu bound-preserving limiter, as applied to a high-order polynomial representation $u_{h}(x)$ of a numerical solution within a cell $K$. The objective is to enforce an invariant-region property, specifically $m \\le \\tilde{u}_{h}(x) \\le M$, at a set of prescribed quadrature points.\n\nThe limited polynomial, $\\tilde{u}_{h}(x)$, is defined by a linear scaling of the original polynomial, $u_{h}(x)$, toward the cell average, $\\bar{u}_{K}$:\n$$\n\\tilde{u}_{h}(x) = \\theta\\big(u_{h}(x) - \\bar{u}_{K}\\big) + \\bar{u}_{K}\n$$\nwhere the scaling factor $\\theta$ is restricted to the interval $[0,1]$. The limiting procedure must select a $\\theta$ that guarantees the bounds are satisfied at all specified points $x_q$ in the set $S$. The constraints are:\n$$\nm \\le \\tilde{u}_{h}(x_{q}) \\le M \\quad \\text{for all } x_{q} \\in S\n$$\nSubstituting the definition of $\\tilde{u}_{h}(x_q)$, we obtain a pair of inequalities for each point $x_q$:\n$$\nm \\le \\theta\\big(u_{h}(x_{q}) - \\bar{u}_{K}\\big) + \\bar{u}_{K}\n$$\n$$\n\\theta\\big(u_{h}(x_{q}) - \\bar{u}_{K}\\big) + \\bar{u}_{K} \\le M\n$$\nThese inequalities can be rearranged to find conditions on $\\theta$.\n\nFor the lower-bound constraint:\n$m - \\bar{u}_{K} \\le \\theta\\big(u_{h}(x_{q}) - \\bar{u}_{K}\\big)$\n\nFor the upper-bound constraint:\n$\\theta\\big(u_{h}(x_{q}) - \\bar{u}_{K}\\big) \\le M - \\bar{u}_{K}$\n\nTo isolate $\\theta$, we must consider the sign of the term $u_{h}(x_{q}) - \\bar{u}_{K}$.\n\nCase 1: $u_{h}(x_{q})  \\bar{u}_{K}$.\nThe term $u_{h}(x_{q}) - \\bar{u}_{K}$ is positive. The inequalities become:\n$$\n\\theta \\ge \\frac{m - \\bar{u}_{K}}{u_{h}(x_{q}) - \\bar{u}_{K}}\n$$\n$$\n\\theta \\le \\frac{M - \\bar{u}_{K}}{u_{h}(x_{q}) - \\bar{u}_{K}}\n$$\nThe problem is concerned with solutions that may violate the bounds, which implies $m \\le \\bar{u}_{K} \\le M$. Given this, $m - \\bar{u}_{K} \\le 0$. Thus, the first inequality, $\\theta \\ge \\text{a non-positive number}$, is trivially satisfied for any $\\theta \\in [0,1]$. The only active constraint in this case comes from the upper bound. This is particularly relevant if $u_{h}(x_q)$ is an overshoot, i.e., $u_{h}(x_q)  M$.\n\nCase 2: $u_{h}(x_{q})  \\bar{u}_{K}$.\nThe term $u_{h}(x_{q}) - \\bar{u}_{K}$ is negative. When we divide by it, the inequality signs must be reversed:\n$$\n\\theta \\le \\frac{m - \\bar{u}_{K}}{u_{h}(x_{q}) - \\bar{u}_{K}}\n$$\n$$\n\\theta \\ge \\frac{M - \\bar{u}_{K}}{u_{h}(x_{q}) - \\bar{u}_{K}}\n$$\nHere, $M - \\bar{u}_{K} \\ge 0$, so the second inequality, $\\theta \\ge \\text{a non-positive number}$, is trivially satisfied for any $\\theta \\in [0,1]$. The active constraint comes from the lower bound, which is relevant if $u_{h}(x_q)$ is an undershoot, i.e., $u_{h}(x_q)  m$.\n\nCase 3: $u_{h}(x_{q}) = \\bar{u}_{K}$.\nThe constraints reduce to $m \\le \\bar{u}_{K}$ and $\\bar{u}_{K} \\le M$. Since the cell average $\\bar{u}_{K}$ is assumed to be within the bounds $[m, M]$, these conditions are satisfied and place no restriction on $\\theta$.\n\nIf a point $x_q$ does not violate the bounds, i.e., $m \\le u_h(x_q) \\le M$, then since $m \\le \\bar{u}_K \\le M$ and $\\tilde{u}_h(x_q)$ is a convex combination of $u_h(x_q)$ and $\\bar{u}_K$, it follows that $m \\le \\tilde{u}_h(x_q) \\le M$ for any $\\theta \\in [0,1]$. Such a point imposes no constraint on $\\theta$ beyond $\\theta \\le 1$.\n\nThe limiter must find a single $\\theta$ that works for all points $x_q \\in S$. The value of $\\theta$ must be less than or equal to the upper bounds derived from all points. To preserve as much high-order information as possible, the largest such $\\theta$ is chosen. The problem asks for the \"minimal $\\theta$ that guarantees\" the bounds, which in the context of this algorithm refers to the most restrictive (smallest) value among the set of upper-bound constraints calculated for each point. If no point violates the bounds, $\\theta=1$.\nThus, the final scaling factor is:\n$$\n\\theta = \\min\\left(1, \\min_{q} \\theta_q\\right)\n$$\nwhere $\\theta_q$ is the upper bound on $\\theta$ derived for each point $x_q$ that violates the bounds.\n\nLet us apply this to the given data:\n- Cell average: $\\bar{u}_{K} = 1.0$.\n- Invariant-region bounds: $m = 0.2$ and $M = 1.5$.\n- Pointwise values: $u_{h}(x_{1}) = 0.05$, $u_{h}(x_{2}) = 1.90$, and $u_{h}(x_{3}) = 1.05$.\n\nWe analyze each point:\n\nPoint 1: $x_{1}$ with $u_{h}(x_{1}) = 0.05$.\nThis value is an undershoot, as $u_{h}(x_{1}) = 0.05  m = 0.2$.\nWe have $u_{h}(x_{1})  \\bar{u}_{K}$, so we are in Case 2. The constraint on $\\theta$ is:\n$$\n\\theta \\le \\frac{m - \\bar{u}_{K}}{u_{h}(x_{1}) - \\bar{u}_{K}} = \\frac{0.2 - 1.0}{0.05 - 1.0} = \\frac{-0.8}{-0.95} = \\frac{80}{95} = \\frac{16}{19}\n$$\nLet's call this constraint $\\theta \\le \\theta_1$, where $\\theta_1 = 16/19$.\n\nPoint 2: $x_{2}$ with $u_{h}(x_{2}) = 1.90$.\nThis value is an overshoot, as $u_{h}(x_{2}) = 1.90  M = 1.5$.\nWe have $u_{h}(x_{2})  \\bar{u}_{K}$, so we are in Case 1. The constraint on $\\theta$ is:\n$$\n\\theta \\le \\frac{M - \\bar{u}_{K}}{u_{h}(x_{2}) - \\bar{u}_{K}} = \\frac{1.5 - 1.0}{1.90 - 1.0} = \\frac{0.5}{0.9} = \\frac{5}{9}\n$$\nLet's call this constraint $\\theta \\le \\theta_2$, where $\\theta_2 = 5/9$.\n\nPoint 3: $x_{3}$ with $u_{h}(x_{3}) = 1.05$.\nThis value is within the invariant region, as $m=0.2 \\le 1.05 \\le 1.5=M$.\nAs established, this point does not require any limiting, so it does not impose any constraint on $\\theta$ in the interval $[0,1]$. Formally, this corresponds to a constraint $\\theta \\le \\theta_3$ where $\\theta_3 \\ge 1$. For example, applying the formula from Case 1 gives $\\theta \\le \\frac{1.5-1.0}{1.05-1.0} = \\frac{0.5}{0.05} = 10$, which is satisfied for all $\\theta \\in [0,1]$. Thus, the effective constraint from this point is $\\theta \\le 1$.\n\nTo satisfy the bounds at all three points simultaneously, $\\theta$ must satisfy all constraints:\n$$\n\\theta \\le \\theta_1 \\quad \\text{and} \\quad \\theta \\le \\theta_2 \\quad \\text{and} \\quad \\theta \\le 1\n$$\nThis means we must choose $\\theta$ such that:\n$$\n\\theta \\le \\min(\\theta_1, \\theta_2, 1) = \\min\\left(\\frac{16}{19}, \\frac{5}{9}, 1\\right)\n$$\nTo find the minimum, we compare the fractions:\n$$\n\\frac{16}{19} \\approx 0.8421...\n$$\n$$\n\\frac{5}{9} = 0.5555...\n$$\nThe minimum of these values is $5/9$. The limiting procedure selects this most restrictive value.\n$$\n\\theta = \\frac{5}{9}\n$$\nThe problem requires the answer to be rounded to four significant figures.\n$$\n\\theta = \\frac{5}{9} \\approx 0.555555...\n$$\nRounding to four significant figures yields $0.5556$.", "answer": "$$\\boxed{0.5556}$$", "id": "3433642"}, {"introduction": "The abstract principle of bound-preserving limiters finds critical use in many physical models, such as the shallow water equations, where maintaining a non-negative water depth ($h \\ge 0$) is essential for physical realism and numerical stability. Handling the interface between wet and dry regions is a classic challenge where these methods are indispensable. This exercise [@problem_id:3433613] tasks you with applying the same scaling limiter concept to a practical scenario, calculating the correction needed to prevent the water depth from becoming unphysically negative.", "problem": "Consider the one-dimensional shallow water equations with bathymetry, where the conserved water depth is defined by $h(x,t) = \\eta(x,t) - b(x)$ and the physical constraint $h(x,t) \\ge 0$ must hold. Near a wet–dry interface, a high-order polynomial reconstruction for the free-surface elevation can locally yield negative pointwise values of $h(x,t)$ even when the cell average is positive, which violates physical admissibility. To enforce $h \\ge 0$ while preserving the cell average, one may apply a linear scaling limiter around the cell average in each cell.\n\nIn a single cell with spatial index $i$, suppose the bathymetry is constant and equal to $b_i = 1.000$ in meters. A polynomial reconstruction of the free-surface elevation $\\eta_i(x)$ is available at three Gauss–Lobatto nodes $\\{x_{i,-1}, x_{i,0}, x_{i,1}\\}$ with nodal values\n$\\eta_i(x_{i,-1}) = 1.020$, $\\eta_i(x_{i,0}) = 0.996$, and $\\eta_i(x_{i,1}) = 1.010$, all in meters. The cell average of the free-surface elevation is $\\bar{\\eta}_i = 1.012$, and the corresponding cell-average water depth is $\\bar{h}_i = \\bar{\\eta}_i - b_i$. Let the dryness threshold be $\\epsilon = 1.0 \\times 10^{-5}$ in meters (i.e., pointwise depths must satisfy $h \\ge \\epsilon$).\n\nDefine the depth reconstruction at the three nodes by $h_i(x_{i,q}) = \\eta_i(x_{i,q}) - b_i$ for $q \\in \\{-1,0,1\\}$. Consider the standard linear scaling positivity-preserving limiter that constructs a limited depth\n$$\nh_i^{\\text{new}}(x) = \\theta \\left(h_i(x) - \\bar{h}_i\\right) + \\bar{h}_i,\n$$\nwith a single parameter $\\theta \\in [0,1]$, chosen minimally so that $h_i^{\\text{new}}(x_{i,q}) \\ge \\epsilon$ for all three nodes $q \\in \\{-1,0,1\\}$ while exactly preserving the cell-average depth $\\bar{h}_i$.\n\nStarting from the definition of $h$ and the requirement of non-negativity at the nodal points together with average preservation, derive the general form of the minimal admissible $\\theta$ as a function of the given data in this cell, and then evaluate it numerically using the provided values. Round your final numerical value of $\\theta$ to $6$ significant figures. The final answer must be a single real number without units.", "solution": "The problem asks for the derivation and numerical evaluation of the parameter $\\theta$ for a linear scaling positivity-preserving limiter applied to a nodal reconstruction of water depth in a single computational cell.\n\nFirst, we must validate the problem statement.\nThe problem provides a self-contained set of data and definitions from the field of numerical methods for partial differential equations, specifically for the shallow water equations.\nGivens are:\n- Water depth definition: $h(x,t) = \\eta(x,t) - b(x)$\n- Bathymetry in cell $i$: $b_i = 1.000$ (constant)\n- Nodal free-surface values: $\\eta_i(x_{i,-1}) = 1.020$, $\\eta_i(x_{i,0}) = 0.996$, $\\eta_i(x_{i,1}) = 1.010$\n- Cell-average free-surface: $\\bar{\\eta}_i = 1.012$\n- Dryness threshold: $\\epsilon = 1.0 \\times 10^{-5}$\n- Limited depth formula: $h_i^{\\text{new}}(x) = \\theta (h_i(x) - \\bar{h}_i) + \\bar{h}_i$\n- Parameter range: $\\theta \\in [0,1]$\n- Constraint: $h_i^{\\text{new}}(x_{i,q}) \\ge \\epsilon$ for $q \\in \\{-1,0,1\\}$\n- Objective: Find the minimal $\\theta$ that satisfies the constraint.\n\nThe problem is scientifically grounded, well-posed, objective, and contains no internal contradictions. The formulation of the linear scaling limiter correctly preserves the cell average, as $\\langle h_i^{\\text{new}}(x) \\rangle = \\langle \\theta (h_i(x) - \\bar{h}_i) + \\bar{h}_i \\rangle = \\theta (\\langle h_i(x) \\rangle - \\bar{h}_i) + \\bar{h}_i = \\theta (\\bar{h}_i - \\bar{h}_i) + \\bar{h}_i = \\bar{h}_i$. The problem is therefore valid.\n\nWe begin the solution by calculating the necessary quantities for cell $i$.\nThe cell-average water depth $\\bar{h}_i$ is:\n$$\n\\bar{h}_i = \\bar{\\eta}_i - b_i = 1.012 - 1.000 = 0.012\n$$\nThe water depths $h_i(x_{i,q})$ at the Gauss-Lobatto nodes are defined by $h_i(x_{i,q}) = \\eta_i(x_{i,q}) - b_i$.\n$$\nh_i(x_{i,-1}) = \\eta_i(x_{i,-1}) - b_i = 1.020 - 1.000 = 0.020\n$$\n$$\nh_i(x_{i,0}) = \\eta_i(x_{i,0}) - b_i = 0.996 - 1.000 = -0.004\n$$\n$$\nh_i(x_{i,1}) = \\eta_i(x_{i,1}) - b_i = 1.010 - 1.000 = 0.010\n$$\nThe minimum value of the reconstructed water depth at the nodes is:\n$$\nm_h = \\min_{q \\in \\{-1,0,1\\}} h_i(x_{i,q}) = \\min(0.020, -0.004, 0.010) = -0.004\n$$\nSince $m_h = -0.004  \\epsilon = 1.0 \\times 10^{-5}$, the original reconstruction violates the positivity requirement, and the limiter must be applied.\n\nThe limiter parameter $\\theta$ is determined by the constraint $h_i^{\\text{new}}(x_{i,q}) \\ge \\epsilon$ for all $q \\in \\{-1,0,1\\}$. Substituting the definition of the limited depth, we get:\n$$\n\\theta \\left(h_i(x_{i,q}) - \\bar{h}_i\\right) + \\bar{h}_i \\ge \\epsilon\n$$\nThis inequality must be solved for $\\theta$. We rearrange it as:\n$$\n\\theta \\left(h_i(x_{i,q}) - \\bar{h}_i\\right) \\ge \\epsilon - \\bar{h}_i\n$$\nThe subsequent step depends on the sign of $(h_i(x_{i,q}) - \\bar{h}_i)$.\n\nCase 1: $h_i(x_{i,q})  \\bar{h}_i$.\nIn this case, $h_i(x_{i,q}) - \\bar{h}_i  0$. Division preserves the inequality:\n$$\n\\theta \\ge \\frac{\\epsilon - \\bar{h}_i}{h_i(x_{i,q}) - \\bar{h}_i}\n$$\nGiven $\\bar{h}_i = 0.012$ and $\\epsilon = 1.0 \\times 10^{-5}$, the numerator is $\\epsilon - \\bar{h}_i  0$. The denominator is positive. Thus, the right-hand side is negative. Since $\\theta \\in [0,1]$, this condition is $\\theta \\ge (\\text{a negative number})$, which is always satisfied. Points above the cell average do not constrain $\\theta$.\n\nCase 2: $h_i(x_{i,q})  \\bar{h}_i$.\nIn this case, $h_i(x_{i,q}) - \\bar{h}_i  0$. Division by this negative quantity reverses the inequality:\n$$\n\\theta \\le \\frac{\\epsilon - \\bar{h}_i}{h_i(x_{i,q}) - \\bar{h}_i} = \\frac{\\bar{h}_i - \\epsilon}{\\bar{h}_i - h_i(x_{i,q})}\n$$\nThis inequality must hold for all nodes where the local depth is less than the average depth. To satisfy all these constraints simultaneously, $\\theta$ must be less than or equal to the minimum of all such upper bounds:\n$$\n\\theta \\le \\min_{q | h_i(x_{i,q})  \\bar{h}_i} \\left( \\frac{\\bar{h}_i - \\epsilon}{\\bar{h}_i - h_i(x_{i,q})} \\right)\n$$\nThe term $\\bar{h}_i - h_i(x_{i,q})$ is positive and becomes largest when $h_i(x_{i,q})$ is smallest. The fraction is minimized when its denominator is maximized. This occurs at the point of minimum depth, $m_h = \\min_q h_i(x_{i,q})$. Therefore, the most restrictive constraint is:\n$$\n\\theta \\le \\frac{\\bar{h}_i - \\epsilon}{\\bar{h}_i - m_h}\n$$\nThe problem asks for the \"minimal\" $\\theta$. This phrasing is ambiguous. Choosing the minimum possible value from the valid range, which is $[0, \\frac{\\bar{h}_i - \\epsilon}{\\bar{h}_i - m_h}]$, would yield $\\theta=0$ (assuming $\\bar{h}_i \\ge \\epsilon$). This would set the solution to the cell average, a trivial result that discards all high-order information. In the context of numerical schemes, \"minimal\" limiting or a \"minimal\" limiter refers to the one that performs the least modification to the original solution, which corresponds to choosing the largest possible $\\theta \\in [0,1]$ that satisfies the positivity constraint. We proceed under this standard interpretation.\n\nIf the original solution is already positive (i.e., $m_h \\ge \\epsilon$), then $\\bar{h}_i - m_h \\le \\bar{h}_i - \\epsilon$, making the fraction $\\ge 1$. Combined with $\\theta \\in [0,1]$, the only choice is $\\theta=1$ (no limiting). If $m_h  \\epsilon$, then $\\bar{h}_i - m_h  \\bar{h}_i - \\epsilon  0$, so the fraction is in $(0, 1)$. The general formula for the limiter parameter which embodies this logic is:\n$$\n\\theta = \\min\\left(1, \\frac{\\bar{h}_i - \\epsilon}{\\bar{h}_i - m_h}\\right)\n$$\nIn our case, $m_h  \\epsilon$, so the formula simplifies to:\n$$\n\\theta = \\frac{\\bar{h}_i - \\epsilon}{\\bar{h}_i - m_h}\n$$\nWe now substitute the numerical values:\n- $\\bar{h}_i = 0.012$\n- $\\epsilon = 0.00001$\n- $m_h = -0.004$\n\n$$\n\\theta = \\frac{0.012 - 0.00001}{0.012 - (-0.004)} = \\frac{0.01199}{0.012 + 0.004} = \\frac{0.01199}{0.016}\n$$\nPerforming the division:\n$$\n\\theta = 0.749375\n$$\nThe problem requires rounding to 6 significant figures. The calculated value $0.749375$ already has exactly 6 significant figures.", "answer": "$$\n\\boxed{0.749375}\n$$", "id": "3433613"}, {"introduction": "The power of the scaling limiter concept lies in its generality, extending beyond simple spatial bounds. In fields like radiative transport, similar constraints must be enforced in other domains, such as the space of angular directions. This final practice [@problem_id:3433621] challenges you to generalize the idea by deriving a limiter that ensures the positivity of radiation intensity $I$ for all discrete angles, while preserving the discrete angular mean intensity.", "problem": "Consider the gray radiative transport equation in $d$ spatial dimensions,\n$$\nI_{t} + \\mathbf{\\Omega}\\cdot\\nabla I \\;=\\; \\sigma_{a}\\,\\big(B - I\\big) \\;+\\; \\sigma_{s}\\,\\big(\\mathcal{S}[I] - I\\big),\n$$\nwhere $I = I(\\mathbf{x},\\mathbf{\\Omega},t)$ is the specific intensity, $\\mathbf{\\Omega}\\in\\mathbb{S}^{d-1}$ is the direction, $\\sigma_{a}\\ge 0$ and $\\sigma_{s}\\ge 0$ are the absorption and scattering coefficients that may be stiff, $B = B(\\mathbf{x},t)\\ge 0$ is the Planckian source, and $\\mathcal{S}$ is the scattering operator. Assume an angular discretization by a quadrature $\\{\\mathbf{\\Omega}_{m},w_{m}\\}_{m=1}^{M}$ with normalized weights $\\sum_{m=1}^{M} w_{m} = 1$, and a cell-averaged finite volume discretization in space over a control volume $K$ with volume $|K|$ and outward unit normals on faces. Let a single-step time integrator be used in which the transport term is treated explicitly and the collisional terms are treated implicitly to handle stiffness, resulting at each time step in an unconstrained cell-averaged, direction-resolved vector $\\{\\tilde{I}_{m}^{n+1}\\}_{m=1}^{M}$ at time $t^{n+1}$, with the discrete angular mean\n$$\n\\bar{I}^{n+1} \\;=\\; \\sum_{m=1}^{M} w_{m}\\,\\tilde{I}_{m}^{n+1}.\n$$\nAssume the implicit collisional update preserves the discrete energy balance in the sense that the evolution equation for $\\bar{I}^{n+1}$ matches the angularly averaged balance, and that $B\\ge 0$. Small negative undershoots in $\\tilde{I}_{m}^{n+1}$ may occur due to transport discretization errors.\n\nYou are tasked with deriving, from first principles, a positivity-preserving algebraic limiter that enforces $I_{m}^{n+1}\\ge 0$ for all directions $m$ while preserving the discrete energy balance encoded in $\\bar{I}^{n+1}$. Use only the following fundamental properties as the base of your derivation: (i) the finite volume balance law for the cell average, (ii) the normalization of the angular quadrature, (iii) the scattering energy invariance $\\sum_{m} w_{m}\\,(\\mathcal{S}[I])_{m} = \\sum_{m} w_{m}\\,I_{m}$ for conservative scattering, and (iv) the fact that convex combinations preserve nonnegativity.\n\nPropose a limiter of the form\n$$\nI_{m}^{n+1} \\;=\\; \\bar{I}^{n+1} \\;+\\; \\theta\\,\\big(\\tilde{I}_{m}^{n+1} - \\bar{I}^{n+1}\\big), \\quad \\theta \\in [0,1],\n$$\nwhich rescales deviations from the discrete angular mean within each cell and time step. Derive the analytic expression for the largest admissible value $\\theta^{\\star}$ such that $I_{m}^{n+1}\\ge 0$ holds for all $m$ and the discrete angular mean $\\sum_{m} w_{m} I_{m}^{n+1}$ is preserved exactly. Your answer must be a single closed-form expression for $\\theta^{\\star}$ in terms of $\\{\\tilde{I}_{m}^{n+1}\\}$ and $\\{w_{m}\\}$, with no inequalities. No numerical evaluation is required. Express your final answer as a symbolic expression. Do not include any units.", "solution": "The user wants to derive a positivity-preserving algebraic limiter for a simplified gray radiative transport equation.\n\n### Step 1: Extract Givens\n\n-   **Equation**: $I_{t} + \\mathbf{\\Omega}\\cdot\\nabla I \\;=\\; \\sigma_{a}\\,\\big(B - I\\big) \\;+\\; \\sigma_{s}\\,\\big(\\mathcal{S}[I] - I\\big)$\n-   **Variables and Constants**:\n    -   Specific intensity: $I = I(\\mathbf{x},\\mathbf{\\Omega},t)$\n    -   Direction: $\\mathbf{\\Omega}\\in\\mathbb{S}^{d-1}$\n    -   Absorption coefficient: $\\sigma_{a}\\ge 0$\n    -   Scattering coefficient: $\\sigma_{s}\\ge 0$\n    -   Planckian source: $B = B(\\mathbf{x},t)\\ge 0$\n    -   Scattering operator: $\\mathcal{S}$\n-   **Discretization and Scheme**:\n    -   Angular quadrature: $\\{\\mathbf{\\Omega}_{m},w_{m}\\}_{m=1}^{M}$ with $\\sum_{m=1}^{M} w_{m} = 1$.\n    -   Spatial discretization: Cell-averaged finite volume over control volume $K$.\n    -   Time integration: Single-step, explicit transport, implicit collision.\n    -   Unconstrained update: $\\{\\tilde{I}_{m}^{n+1}\\}_{m=1}^{M}$ at time $t^{n+1}$.\n-   **Definitions**:\n    -   Discrete angular mean: $\\bar{I}^{n+1} \\;=\\; \\sum_{m=1}^{M} w_{m}\\,\\tilde{I}_{m}^{n+1}$.\n    -   Proposed limiter form: $I_{m}^{n+1} \\;=\\; \\bar{I}^{n+1} \\;+\\; \\theta\\,\\big(\\tilde{I}_{m}^{n+1} - \\bar{I}^{n+1}\\big)$, with $\\theta \\in [0,1]$.\n-   **Assumptions/Properties**:\n    1.  The implicit collisional update preserves the discrete energy balance.\n    2.  $B \\ge 0$.\n    3.  Small negative undershoots in $\\tilde{I}_{m}^{n+1}$ may occur.\n    4.  Quadrature weights are normalized: $\\sum_{m=1}^{M} w_{m} = 1$.\n    5.  Scattering is energy-invariant: $\\sum_{m} w_{m}\\,(\\mathcal{S}[I])_{m} = \\sum_{m} w_{m}\\,I_{m}$.\n    6.  Convex combinations preserve non-negativity.\n-   **Objective**: Derive the analytic expression for the largest admissible value $\\theta^{\\star}$ such that $I_{m}^{n+1}\\ge 0$ for all $m$ and the discrete angular mean $\\sum_{m} w_{m} I_{m}^{n+1}$ is preserved exactly.\n\n### Step 2: Validate Using Extracted Givens\n\n-   **Scientific Groundedness**: The problem is set in the context of numerical methods for radiative transport, a well-established subfield of computational physics and applied mathematics. The concepts of finite volume methods, operator splitting, positivity preservation, and algebraic limiters are standard and rigorously defined. The problem is a textbook exercise in designing such a limiter. It is scientifically sound.\n-   **Well-Posedness**: The problem asks for the maximum value of a parameter $\\theta$ subject to a set of well-defined algebraic constraints. The form of the solution is specified, and the objective is clear. A unique solution for $\\theta^{\\star}$ exists, as will be shown in the derivation. The problem is well-posed.\n-   **Objectivity**: The problem is stated in precise mathematical terms, free of ambiguity or subjective language.\n-   **Completeness**: The problem provides all necessary information (the form of the limiter, the quantities to work with, the properties to use) to derive the solution. While the non-negativity of the mean intensity $\\bar{I}^{n+1}$ is not explicitly stated as a given, it is a necessary precondition for a solution to exist, as a negative total cannot be composed of non-negative parts. A positivity-preserving method's goal is to maintain non-negativity, so it is logically implied that the target mean must be non-negative. Therefore, the problem is not incomplete.\n-   **Other Flaws**: The problem does not violate any of the other invalidity criteria. It is not metaphorical, trivial, or outside the realm of scientific verifiability.\n\n### Step 3: Verdict and Action\n\nThe problem is valid. A rigorous derivation of the solution can proceed.\n\n### Solution Derivation\n\nThe goal is to find the largest value of $\\theta \\in [0,1]$, denoted $\\theta^{\\star}$, such that the limited intensity $I_{m}^{n+1}$ satisfies two conditions for every computational cell at time $t^{n+1}$:\n1.  **Positivity**: $I_{m}^{n+1} \\ge 0$ for all directions $m \\in \\{1, 2, \\dots, M\\}$.\n2.  **Conservation of Mean Intensity**: The discrete angular mean is preserved, i.e., $\\sum_{m=1}^{M} w_{m} I_{m}^{n+1} = \\bar{I}^{n+1}$.\n\nFirst, we verify that the proposed limiter form,\n$$I_{m}^{n+1} \\;=\\; \\bar{I}^{n+1} \\;+\\; \\theta\\,\\big(\\tilde{I}_{m}^{n+1} - \\bar{I}^{n+1}\\big),$$\ninherently satisfies the conservation of mean intensity for any value of $\\theta$. We compute the mean of the limited solution:\n$$\n\\sum_{m=1}^{M} w_{m} I_{m}^{n+1} \\;=\\; \\sum_{m=1}^{M} w_{m} \\left[ \\bar{I}^{n+1} + \\theta \\left( \\tilde{I}_{m}^{n+1} - \\bar{I}^{n+1} \\right) \\right]\n$$\n$$\n\\;=\\; \\sum_{m=1}^{M} w_{m} \\bar{I}^{n+1} + \\theta \\sum_{m=1}^{M} w_{m} \\left( \\tilde{I}_{m}^{n+1} - \\bar{I}^{n+1} \\right)\n$$\n$$\n\\;=\\; \\bar{I}^{n+1} \\left( \\sum_{m=1}^{M} w_{m} \\right) + \\theta \\left( \\sum_{m=1}^{M} w_{m} \\tilde{I}_{m}^{n+1} - \\bar{I}^{n+1} \\sum_{m=1}^{M} w_{m} \\right)\n$$\nUsing the given normalization of quadrature weights, $\\sum_{m=1}^{M} w_{m} = 1$, and the definition of the mean, $\\bar{I}^{n+1} = \\sum_{m=1}^{M} w_{m} \\tilde{I}_{m}^{n+1}$, we get:\n$$\n\\sum_{m=1}^{M} w_{m} I_{m}^{n+1} \\;=\\; \\bar{I}^{n+1} (1) + \\theta \\left( \\bar{I}^{n+1} - \\bar{I}^{n+1} (1) \\right) \\;=\\; \\bar{I}^{n+1} + 0 \\;=\\; \\bar{I}^{n+1}.\n$$\nThus, the mean is preserved for any choice of $\\theta$.\n\nNext, we enforce the positivity constraint, $I_{m}^{n+1} \\ge 0$, for all $m$.\nFor a physically meaningful solution to exist where all components $I_{m}^{n+1}$ are non-negative, their weighted average must also be non-negative. That is, we must have $\\sum_{m=1}^{M} w_{m} I_{m}^{n+1} \\ge 0$. As this sum is equal to $\\bar{I}^{n+1}$, a necessary condition for the problem to have a solution is $\\bar{I}^{n+1} \\ge 0$. If $\\bar{I}^{n+1}$ were negative, it would be impossible to find non-negative $I_{m}^{n+1}$ (for $w_m > 0$) that average to a negative value. We proceed assuming this condition holds.\n\nThe positivity constraint for each direction $m$ is:\n$$\n\\bar{I}^{n+1} + \\theta \\left( \\tilde{I}_{m}^{n+1} - \\bar{I}^{n+1} \\right) \\ge 0\n$$\nThis can be rewritten as:\n$$\n(1-\\theta)\\bar{I}^{n+1} + \\theta \\tilde{I}_{m}^{n+1} \\ge 0\n$$\nSince $\\theta \\in [0,1]$, this expression is a convex combination of $\\bar{I}^{n+1}$ and $\\tilde{I}_{m}^{n+1}$.\nBased on property (iv), a convex combination of non-negative numbers is non-negative. We have assumed $\\bar{I}^{n+1} \\ge 0$. Therefore, if $\\tilde{I}_{m}^{n+1} \\ge 0$, the inequality is automatically satisfied for all $\\theta \\in [0,1]$.\n\nA constraint on $\\theta$ arises only for those directions $m$ where the unconstrained update has an undershoot, i.e., $\\tilde{I}_{m}^{n+1}  0$. Let us analyze the inequality for such a direction $m$:\n$$\n\\bar{I}^{n+1} + \\theta \\left( \\tilde{I}_{m}^{n+1} - \\bar{I}^{n+1} \\right) \\ge 0\n$$\nWe need to solve for $\\theta$.\n$$\n\\theta \\left( \\bar{I}^{n+1} - \\tilde{I}_{m}^{n+1} \\right) \\le \\bar{I}^{n+1}\n$$\nThe term $\\bar{I}^{n+1} - \\tilde{I}_{m}^{n+1}$ must be positive, since $\\bar{I}^{n+1} \\ge 0$ and $\\tilde{I}_{m}^{n+1}  0$. We can thus divide by it without changing the inequality's direction:\n$$\n\\theta \\le \\frac{\\bar{I}^{n+1}}{\\bar{I}^{n+1} - \\tilde{I}_{m}^{n+1}}\n$$\nThis inequality provides an upper bound on $\\theta$ for each direction $m$ where $\\tilde{I}_{m}^{n+1}  0$. To ensure positivity for all such directions simultaneously, $\\theta$ must be less than or equal to the minimum of all these upper bounds.\n$$\n\\theta \\le \\min_{m \\text{ s.t. } \\tilde{I}_{m}^{n+1}  0} \\left\\{ \\frac{\\bar{I}^{n+1}}{\\bar{I}^{n+1} - \\tilde{I}_{m}^{n+1}} \\right\\}\n$$\nWe are looking for the largest admissible value, $\\theta^{\\star}$, which must also satisfy the given constraint $\\theta \\in [0,1]$. Therefore, $\\theta^{\\star}$ must be the minimum of $1$ and the limiting value derived above.\n$$\n\\theta^{\\star} = \\min\\left(1, \\min_{m \\text{ s.t. } \\tilde{I}_{m}^{n+1}  0} \\left\\{ \\frac{\\bar{I}^{n+1}}{\\bar{I}^{n+1} - \\tilde{I}_{m}^{n+1}} \\right\\} \\right)\n$$\nThis expression robustly handles all cases. If there are no negative values (i.e., the set $\\{m \\mid \\tilde{I}_{m}^{n+1}  0\\}$ is empty), the minimum over the empty set is conventionally defined as $+\\infty$. In this case, $\\theta^{\\star} = \\min(1, \\infty) = 1$. This means if the unconstrained solution is already positive, the limiter is inactive ($I_{m}^{n+1} = \\tilde{I}_{m}^{n+1}$), which is the desired behavior. If there are negative values, the term $\\frac{\\bar{I}^{n+1}}{\\bar{I}^{n+1} - \\tilde{I}_{m}^{n+1}}$ is always less than $1$ (since $\\bar{I}^{n+1} \\ge 0$ and $\\tilde{I}_{m}^{n+1}  0$ implies $\\bar{I}^{n+1}  \\bar{I}^{n+1} - \\tilde{I}_{m}^{n+1}$), so the outer $\\min$ with $1$ is redundant but harmless. However, including it yields a single unified formula.\n\nTo provide the final answer solely in terms of $\\{\\tilde{I}_{m}^{n+1}\\}$ and $\\{w_{m}\\}$, we substitute the definition of $\\bar{I}^{n+1}$:\n$$ \\theta^{\\star} = \\min\\left(1, \\min_{m \\text{ s.t. } \\tilde{I}_{m}^{n+1}  0} \\left\\{ \\frac{\\sum_{k=1}^{M} w_k \\tilde{I}_k^{n+1}}{(\\sum_{k=1}^{M} w_k \\tilde{I}_k^{n+1}) - \\tilde{I}_m^{n+1}} \\right\\} \\right) $$\nThis expression represents the largest value of $\\theta$ in the specified range $[0, 1]$ that guarantees non-negativity while preserving the discrete mean intensity.", "answer": "$$\n\\boxed{\\min\\left(1, \\min_{m \\text{ s.t. } \\tilde{I}_{m}^{n+1}  0} \\left\\{ \\frac{\\sum_{k=1}^{M} w_k \\tilde{I}_k^{n+1}}{\\left(\\sum_{k=1}^{M} w_k \\tilde{I}_k^{n+1}\\right) - \\tilde{I}_m^{n+1}} \\right\\} \\right)}\n$$", "id": "3433621"}]}