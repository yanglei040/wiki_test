{"hands_on_practices": [{"introduction": "Implementing implicit Newmark schemes, where $\\beta > 0$, requires recasting the update equations into a linear system that can be solved at each time step. This fundamental exercise guides you through the derivation of this \"effective system,\" a crucial step in translating the Newmark method from theory into a working algorithm. Understanding this formulation [@problem_id:3424180] is key to tackling both linear and nonlinear dynamic problems efficiently.", "problem": "Consider the semi-discrete form of a linear elastodynamic Partial Differential Equation (PDE), obtained after spatial discretization, which yields the second-order Ordinary Differential Equation (ODE)\n$$\nM \\ddot{q}(t) + C \\dot{q}(t) + K q(t) = f(t),\n$$\nwhere $M$, $C$, and $K$ are the mass, damping, and stiffness matrices, respectively, and $q(t)$ is the generalized displacement vector. Assume $M$ is symmetric positive definite, $C$ is symmetric positive semidefinite, $K$ is symmetric positive semidefinite, and $f(t)$ is sufficiently smooth. Let the time grid be $t_{n} = t_{0} + n\\,\\Delta t$ with time step $\\Delta t > 0$. The Newmark family of time integration methods defines updates through parameters $\\beta$ and $\\gamma$ by the relations\n$$\nq_{n+1} = q_{n} + \\Delta t\\,\\dot{q}_{n} + \\Delta t^{2}\\left(\\tfrac{1}{2} - \\beta\\right)\\ddot{q}_{n} + \\Delta t^{2}\\beta\\,\\ddot{q}_{n+1},\n$$\n$$\n\\dot{q}_{n+1} = \\dot{q}_{n} + \\Delta t\\,(1 - \\gamma)\\,\\ddot{q}_{n} + \\Delta t\\,\\gamma\\,\\ddot{q}_{n+1}.\n$$\nAt time $t_{n+1}$, the semi-discrete balance reads\n$$\nM \\ddot{q}_{n+1} + C \\dot{q}_{n+1} + K q_{n+1} = f_{n+1},\n$$\nwhere $f_{n+1} := f(t_{n+1})$. Starting from the above fundamental relations and without assuming any additional shortcut formulas, derive the effective linear system for the unknown acceleration $\\ddot{q}_{n+1}$ in the form\n$$\nM_{\\text{eff}}\\,\\ddot{q}_{n+1} = f_{\\text{eff}},\n$$\nand explicitly identify the effective mass $M_{\\text{eff}}$, the effective damping contribution associated with the Newmark parameter $\\gamma$ and time step $\\Delta t$, and the effective right-hand side $f_{\\text{eff}}$ in terms of $\\beta$, $\\gamma$, and $\\Delta t$, as functions of known quantities $q_{n}$, $\\dot{q}_{n}$, $\\ddot{q}_{n}$, and $f_{n+1}$. Provide these expressions in closed form. Your final answer must be expressed as analytic expressions. No rounding is required, and no numerical values should be substituted. Present the three requested expressions as a single row using the LaTeX $pmatrix$ environment.", "solution": "The problem is valid as it is scientifically grounded in the principles of computational mechanics, well-posed, objective, and self-contained. The task is to derive the effective linear system for the Newmark family of time integration methods.\n\nThe starting point for the derivation consists of three fundamental equations. First, the semi-discrete equation of motion evaluated at time $t_{n+1}$:\n$$\nM \\ddot{q}_{n+1} + C \\dot{q}_{n+1} + K q_{n+1} = f_{n+1}\n$$\nSecond and third, the Newmark update rules for displacement and velocity, which connect the states at time $t_{n+1}$ to the known states at time $t_n$ and the unknown acceleration $\\ddot{q}_{n+1}$:\n$$\nq_{n+1} = q_{n} + \\Delta t\\,\\dot{q}_{n} + \\Delta t^{2}\\left(\\frac{1}{2} - \\beta\\right)\\ddot{q}_{n} + \\Delta t^{2}\\beta\\,\\ddot{q}_{n+1}\n$$\n$$\n\\dot{q}_{n+1} = \\dot{q}_{n} + \\Delta t\\,(1 - \\gamma)\\,\\ddot{q}_{n} + \\Delta t\\,\\gamma\\,\\ddot{q}_{n+1}\n$$\nHere, $q_n, \\dot{q}_n, \\ddot{q}_n$ are the known displacement, velocity, and acceleration vectors at time $t_n$, while $q_{n+1}, \\dot{q}_{n+1}, \\ddot{q}_{n+1}$ are the corresponding vectors at time $t_{n+1}$. The parameters $\\beta$ and $\\gamma$ define the specific method within the Newmark family. The goal is to obtain an equation of the form $M_{\\text{eff}}\\,\\ddot{q}_{n+1} = f_{\\text{eff}}$, which involves only the unknown $\\ddot{q}_{n+1}$ and known quantities.\n\nTo achieve this, we substitute the Newmark update rules into the equation of motion at $t_{n+1}$. We can isolate the terms dependent on the unknown $\\ddot{q}_{n+1}$ from the terms that are explicitly known from the previous time step. Let us rewrite the update rules as:\n$$\nq_{n+1} = \\tilde{q}_{n+1} + \\Delta t^{2}\\beta\\,\\ddot{q}_{n+1}\n$$\n$$\n\\dot{q}_{n+1} = \\tilde{\\dot{q}}_{n+1} + \\Delta t\\,\\gamma\\,\\ddot{q}_{n+1}\n$$\nwhere $\\tilde{q}_{n+1}$ and $\\tilde{\\dot{q}}_{n+1}$ are predictor quantities that depend only on the state at $t_n$:\n$$\n\\tilde{q}_{n+1} := q_{n} + \\Delta t\\,\\dot{q}_{n} + \\Delta t^{2}\\left(\\frac{1}{2} - \\beta\\right)\\ddot{q}_{n}\n$$\n$$\n\\tilde{\\dot{q}}_{n+1} := \\dot{q}_{n} + \\Delta t\\,(1 - \\gamma)\\,\\ddot{q}_{n}\n$$\nNow, substitute the expressions for $q_{n+1}$ and $\\dot{q}_{n+1}$ into the equation of motion:\n$$\nM \\ddot{q}_{n+1} + C \\left( \\tilde{\\dot{q}}_{n+1} + \\Delta t\\,\\gamma\\,\\ddot{q}_{n+1} \\right) + K \\left( \\tilde{q}_{n+1} + \\Delta t^{2}\\beta\\,\\ddot{q}_{n+1} \\right) = f_{n+1}\n$$\nDistributing the matrices $C$ and $K$:\n$$\nM \\ddot{q}_{n+1} + C \\tilde{\\dot{q}}_{n+1} + \\Delta t\\,\\gamma\\,C \\ddot{q}_{n+1} + K \\tilde{q}_{n+1} + \\Delta t^{2}\\beta\\,K \\ddot{q}_{n+1} = f_{n+1}\n$$\nNext, we rearrange this equation by gathering all terms containing the unknown vector $\\ddot{q}_{n+1}$ on the left-hand side and moving all other terms, which are known, to the right-hand side.\n$$\nM \\ddot{q}_{n+1} + \\Delta t\\,\\gamma\\,C \\ddot{q}_{n+1} + \\Delta t^{2}\\beta\\,K \\ddot{q}_{n+1} = f_{n+1} - C \\tilde{\\dot{q}}_{n+1} - K \\tilde{q}_{n+1}\n$$\nFactoring out $\\ddot{q}_{n+1}$ on the left-hand side yields:\n$$\n\\left( M + \\gamma \\Delta t C + \\beta \\Delta t^{2} K \\right) \\ddot{q}_{n+1} = f_{n+1} - C \\tilde{\\dot{q}}_{n+1} - K \\tilde{q}_{n+1}\n$$\nThis equation is in the desired form $M_{\\text{eff}}\\,\\ddot{q}_{n+1} = f_{\\text{eff}}$. From this, we can explicitly identify the requested expressions.\n\nThe effective mass matrix, $M_{\\text{eff}}$, is the matrix coefficient of $\\ddot{q}_{n+1}$:\n$$\nM_{\\text{eff}} = M + \\gamma \\Delta t C + \\beta \\Delta t^{2} K\n$$\nThe problem asks specifically for the \"effective damping contribution associated with the Newmark parameter $\\gamma$ and time step $\\Delta t$\". This corresponds to the term in $M_{\\text{eff}}$ that involves the damping matrix $C$ and the parameter $\\gamma$. This term is:\n$$\n\\gamma \\Delta t C\n$$\nThe effective right-hand side, $f_{\\text{eff}}$, is the entire right-hand side of the rearranged equation. Substituting back the full expressions for the predictor quantities $\\tilde{q}_{n+1}$ and $\\tilde{\\dot{q}}_{n+1}$:\n$$\nf_{\\text{eff}} = f_{n+1} - C \\left( \\dot{q}_{n} + \\Delta t\\,(1 - \\gamma)\\,\\ddot{q}_{n} \\right) - K \\left( q_{n} + \\Delta t\\,\\dot{q}_{n} + \\Delta t^{2}\\left(\\frac{1}{2} - \\beta\\right)\\ddot{q}_{n} \\right)\n$$\nThese three expressions are the required results, derived directly from the fundamental relations of the Newmark method.", "answer": "$$\n\\boxed{\\begin{pmatrix} M + \\gamma \\Delta t C + \\beta \\Delta t^{2} K  \\gamma \\Delta t C  f_{n+1} - C \\left( \\dot{q}_{n} + (1 - \\gamma) \\Delta t \\ddot{q}_{n} \\right) - K \\left( q_{n} + \\Delta t \\dot{q}_{n} + \\left(\\frac{1}{2} - \\beta\\right) \\Delta t^{2} \\ddot{q}_{n} \\right) \\end{pmatrix}}\n$$", "id": "3424180"}, {"introduction": "The choice of Newmark parameters $(\\gamma, \\beta)$ has profound implications for the long-term stability and energy behavior of a simulation. This \"inverse design\" problem challenges you to work backward from a desired energy dissipation law to find the parameters that can realize it. This practice [@problem_id:3424131] offers deep insight into why specific methods, like the energy-conserving average acceleration scheme ($\\gamma = 1/2, \\beta=1/4$), hold a special place in computational dynamics.", "problem": "Consider the semi-discrete form of the undamped linear elastodynamic Partial Differential Equation (PDE), obtained after spatial discretization, given by $M \\ddot{u}(t) + K u(t) = 0$, where $M \\in \\mathbb{R}^{n \\times n}$ and $K \\in \\mathbb{R}^{n \\times n}$ are symmetric positive definite matrices, $u(t) \\in \\mathbb{R}^{n}$ is the displacement vector, and $\\ddot{u}(t)$ denotes the second time derivative. Denote the velocity by $v(t) = \\dot{u}(t)$. Let the discrete energy at time step $n$ be $E_n = \\tfrac{1}{2} v_n^{\\top} M v_n + \\tfrac{1}{2} u_n^{\\top} K u_n$, and the $M$-norm by $\\|v\\|_{M}^{2} = v^{\\top} M v$. Assume time integration is performed by the Newmark family with parameters $(\\gamma, \\beta)$ and a uniform time step $\\Delta t > 0$.\n\nFocus on one invariant modal subspace associated to a generalized eigenpair of $(K, M)$ so that the dynamics reduce to a single degree of freedom $m \\ddot{q}(t) + k q(t) = 0$ with $m > 0$, $k > 0$, velocity $v(t) = \\dot{q}(t)$, and angular frequency $\\omega^{2} = k/m$. In this subspace, let $E_n = \\tfrac{1}{2} m v_n^{2} + \\tfrac{1}{2} k q_n^{2}$.\n\nStarting from the fundamental laws and definitions above, derive the discrete energy increment $E_{n+1} - E_n$ implied by the Newmark updates and pose the following inverse design: enforce a target stepwise energy law $E_{n+1} - E_n = - \\eta \\|v_{n+1}\\|_{M}^{2}$ for all initial states in the chosen modal subspace and for all time steps $\\Delta t$ in a nonempty interval containing $\\Delta t = 0$. Determine whether there exist parameters $(\\gamma, \\beta)$ and a constant $\\eta$ (independent of the state and $\\Delta t$) that realize this law. If a realization is possible, compute the unique scalar $\\eta$ that can be attained; if the only possible realization forces a specific $\\eta$, report that value. Express your final answer as a single real number, without units. No rounding is required.", "solution": "The user wants to determine if there exists a set of parameters $(\\gamma, \\beta)$ for the Newmark time integration family and a constant $\\eta$ such that a specific energy dissipation law is satisfied for a linear, undamped single-degree-of-freedom (SDOF) oscillator.\n\n### Step 1: Problem Validation\n\nThe problem statement has been validated and is found to be scientifically grounded, well-posed, objective, and self-contained. It addresses a standard topic in numerical analysis for partial differential equations (specifically, the time integration of semi-discretized systems) and uses established definitions and formalisms. No flaws were detected. The problem is valid for solution.\n\n### Step 2: Formal Derivation\n\nThe analysis is performed on the single-degree-of-freedom (SDOF) system resulting from modal decomposition. The equation of motion is:\n$$m \\ddot{q}(t) + k q(t) = 0$$\nwhere $m > 0$, $k > 0$, and the natural angular frequency is $\\omega = \\sqrt{k/m}$. We denote the state at time step $t_n$ by $(q_n, v_n)$, where $v_n = \\dot{q}(t_n)$. The acceleration is $a_n = \\ddot{q}(t_n) = - (k/m) q_n = -\\omega^2 q_n$.\n\nThe Newmark family of methods provides the following update rules for displacement $q$ and velocity $v$ over a time step $\\Delta t$:\n$$q_{n+1} = q_n + \\Delta t v_n + \\Delta t^2 \\left[ \\left(\\frac{1}{2} - \\beta\\right) a_n + \\beta a_{n+1} \\right] \\quad (1)$$\n$$v_{n+1} = v_n + \\Delta t \\left[ (1 - \\gamma) a_n + \\gamma a_{n+1} \\right] \\quad (2)$$\nThe equation of motion must also hold at time step $t_{n+1}$, so $a_{n+1} = -\\omega^2 q_{n+1}$.\n\nThe discrete energy at time step $n$ is given by $E_n = \\frac{1}{2} m v_n^2 + \\frac{1}{2} k q_n^2$. The problem posits a target stepwise energy law:\n$$E_{n+1} - E_n = - \\eta \\|v_{n+1}\\|_{M}^{2}$$\nFor the SDOF system, the mass matrix $M$ corresponds to the scalar mass $m$, so $\\|v_{n+1}\\|_{M}^{2} = m v_{n+1}^2$. The target law becomes:\n$$E_{n+1} - E_n = - \\eta m v_{n+1}^2$$\nSubstituting the definition of energy, we have:\n$$\\left(\\frac{1}{2} m v_{n+1}^2 + \\frac{1}{2} k q_{n+1}^2\\right) - \\left(\\frac{1}{2} m v_n^2 + \\frac{1}{2} k q_n^2\\right) = - \\eta m v_{n+1}^2$$\nThis equation can be rearranged to define a modified energy-like quantity that should be conserved at each step:\n$$\\left(\\frac{1}{2} + \\eta\\right) m v_{n+1}^2 + \\frac{1}{2} k q_{n+1}^2 = \\frac{1}{2} m v_n^2 + \\frac{1}{2} k q_n^2 \\quad (3)$$\nThis relation must hold for all initial states $(q_n, v_n)$ and for all time steps $\\Delta t$ in a non-empty interval containing $\\Delta t = 0$.\n\nTo analyze equation $(3)$, we first express $q_{n+1}$ and $v_{n+1}$ as functions of $q_n$ and $v_n$.\nSubstitute $a_n = -\\omega^2 q_n$ and $a_{n+1} = -\\omega^2 q_{n+1}$ into equations $(1)$ and $(2)$. Let $\\Omega = \\omega \\Delta t$.\nFrom $(1)$:\n$q_{n+1} = q_n + \\Delta t v_n + \\Delta t^2 \\left[ -\\left(\\frac{1}{2} - \\beta\\right) \\omega^2 q_n - \\beta \\omega^2 q_{n+1} \\right]$\n$q_{n+1} (1 + \\beta \\Omega^2) = q_n (1 - (\\frac{1}{2} - \\beta) \\Omega^2) + v_n \\Delta t$\n$$q_{n+1} = \\frac{1}{1 + \\beta \\Omega^2} \\left[ \\left(1 - \\left(\\frac{1}{2} - \\beta\\right) \\Omega^2\\right) q_n + \\Delta t v_n \\right] \\quad (4)$$\nFrom $(2)$:\n$v_{n+1} = v_n + \\Delta t \\left[ -(1-\\gamma)\\omega^2 q_n - \\gamma \\omega^2 q_{n+1} \\right]$\n$$v_{n+1} = v_n - \\frac{\\Omega^2}{\\Delta t} \\left( (1-\\gamma)q_n + \\gamma q_{n+1} \\right) \\quad (5)$$\n\nSubstituting equations $(4)$ and $(5)$ into the target law $(3)$ yields a quadratic form in $q_n$ and $v_n$ that must be an identity.\n$A q_n^2 + B v_n^2 + C q_n v_n = \\frac{1}{2} k q_n^2 + \\frac{1}{2} m v_n^2$\nFor this to hold for all $q_n, v_n$, the coefficients of $q_n^2$, $v_n^2$, and $q_n v_n$ on both sides must be equal. In particular, the coefficient of the cross-term $q_n v_n$ must be zero. Let's analyze this specific constraint.\nThe left-hand side of $(3)$ gives rise to a cross term:\n$$(1+2\\eta) m v_{n+1} v_{n+1} \\text{'s cross-term} + k q_{n+1} q_{n+1} \\text{'s cross-term} = 0$$\nwhere we only consider the parts of the products that contribute to the $q_n v_n$ term.\nLet $q_{n+1} = D_q q_n + D_v v_n$ and $v_{n+1} = C_q q_n + C_v v_n$. The cross-term coefficient equation is:\n$$(1+2\\eta) m (2 C_q C_v) + k (2 D_q D_v) = 0 \\implies (1+2\\eta) m C_q C_v + k D_q D_v = 0 \\quad (6)$$\nFrom $(4)$, we identify:\n$D_q = \\frac{1 - (\\frac{1}{2} - \\beta) \\Omega^2}{1 + \\beta \\Omega^2}$\n$D_v = \\frac{\\Delta t}{1 + \\beta \\Omega^2}$\nAfter substituting $(4)$ into $(5)$ and collecting terms, we find:\n$C_v = \\frac{1 + (\\beta - \\gamma) \\Omega^2}{1 + \\beta \\Omega^2}$\n$C_q = -\\frac{\\Omega^2}{\\Delta t} \\frac{1 + (\\beta - \\frac{\\gamma}{2})\\Omega^2}{1 + \\beta \\Omega^2} = -\\frac{k}{m} \\frac{\\Delta t (1 + (\\beta - \\frac{\\gamma}{2})\\Omega^2)}{1 + \\beta \\Omega^2}$\n\nSubstituting these into equation $(6)$:\n$$ (1+2\\eta) m \\left(-\\frac{k}{m} \\frac{\\Delta t (1 + (\\beta - \\frac{\\gamma}{2})\\Omega^2)}{1 + \\beta \\Omega^2}\\right) \\left(\\frac{1 + (\\beta - \\gamma) \\Omega^2}{1 + \\beta \\Omega^2}\\right) + k \\left(\\frac{1 - (\\frac{1}{2} - \\beta) \\Omega^2}{1 + \\beta \\Omega^2}\\right) \\left(\\frac{\\Delta t}{1 + \\beta \\Omega^2}\\right) = 0 $$\nWe can divide by $k \\Delta t$ and multiply by $(1 + \\beta \\Omega^2)^2$, assuming $\\Delta t \\neq 0$:\n$$ -(1+2\\eta) \\left(1 + \\left(\\beta - \\frac{\\gamma}{2}\\right)\\Omega^2\\right) \\left(1 + (\\beta - \\gamma) \\Omega^2\\right) + \\left(1 - \\left(\\frac{1}{2} - \\beta\\right) \\Omega^2\\right) = 0 \\quad (7)$$\nThis equation is a polynomial in $\\Omega^2$ and must hold for all $\\Omega$ in a neighborhood of $0$. By continuity, it must hold for $\\Omega = 0$ (i.e., $\\Delta t = 0$). Setting $\\Omega=0$ in equation $(7)$:\n$$ -(1+2\\eta) (1)(1) + (1) = 0 $$\n$$ -(1+2\\eta) + 1 = 0 $$\n$$ -2\\eta = 0 $$\nThis implies $\\eta = 0$.\n\nThe condition that the law must hold for all $\\Delta t$ in an interval containing $\\Delta t = 0$ is a powerful constraint. The evaluation at the limit point $\\Delta t = 0$ forces $\\eta$ to be zero. Therefore, if a realization of the proposed energy law is possible under the given conditions, the constant $\\eta$ must uniquely be $0$.\n\nFor completeness, one can verify that a choice of $(\\gamma, \\beta)$ exists. If we set $\\eta=0$ in equation $(7)$, it becomes a polynomial in $\\Omega^2$ that must be identically zero. This means all of its coefficients must be zero. Expanding the polynomial gives conditions on $\\gamma$ and $\\beta$. The only solution that satisfies all coefficient equations is $(\\gamma, \\beta) = (1/2, 1/4)$, which corresponds to the average acceleration method. This method is known to be energy-conserving for linear systems, meaning $E_{n+1} - E_n = 0$. This is consistent with our target law $E_{n+1} - E_n = -\\eta m v_{n+1}^2$ if and only if $\\eta = 0$ (for non-trivial motion where $v_{n+1} \\neq 0$).\n\nThus, a realization is possible, and the unique value for $\\eta$ is $0$.", "answer": "$$\\boxed{0}$$", "id": "3424131"}, {"introduction": "The true test of a numerical method comes from its application to nonlinear problems, where properties like energy conservation are often no longer guaranteed. This practice [@problem_id:3424207] applies the Newmark method to the nonlinear Klein-Gordon equation, confronting the challenge of long-term energy drift that arises in non-symplectic schemes. You will implement a full simulation and an energy-projection correction, bridging the gap between theoretical analysis and practical computational science.", "problem": "Consider the nonlinear Klein–Gordon equation in one spatial dimension with periodic boundary conditions on the interval of length $2\\pi$,\n$$\nu_{tt} - c^2 u_{xx} + \\lambda u^3 = 0,\n$$\nwhich can be written as a second-order Hamiltonian system with the Hamiltonian (total energy)\n$$\n\\mathcal{E}(u,v) = \\int_0^{2\\pi} \\left( \\tfrac{1}{2} v^2 + \\tfrac{c^2}{2} u_x^2 + \\tfrac{\\lambda}{4} u^4 \\right)\\,dx,\n$$\nwhere $v = u_t$. After a spectrally accurate spatial discretization using the Fast Fourier Transform (FFT), the partial differential equation reduces to an ordinary differential equation system of the form\n$$\n\\mathbf{u}'' + \\mathbf{L}\\,\\mathbf{u} + \\lambda\\,\\mathbf{u}^{\\circ 3} = \\mathbf{0},\n$$\nwhere $\\mathbf{u}$ collects the spatial grid values, $\\mathbf{L}$ is the discrete, symmetric, positive semi-definite operator corresponding to $-c^2\\partial_{xx}$ under the FFT representation, and $\\mathbf{u}^{\\circ 3}$ denotes the element-wise cubic nonlinearity.\n\nThe Newmark family of methods is defined for second-order systems by parameters $(\\gamma,\\beta)$ and updates $(\\mathbf{u}_{n+1},\\mathbf{v}_{n+1})$ according to\n$$\n\\mathbf{u}_{n+1} = \\mathbf{u}_n + \\Delta t\\,\\mathbf{v}_n + \\Delta t^2\\left(\\tfrac{1}{2}-\\beta\\right)\\mathbf{a}_n + \\beta \\Delta t^2 \\mathbf{a}_{n+1},\n$$\n$$\n\\mathbf{v}_{n+1} = \\mathbf{v}_n + \\Delta t \\left((1-\\gamma)\\mathbf{a}_n + \\gamma \\mathbf{a}_{n+1}\\right),\n$$\nwhere $\\mathbf{a}_n$ is the acceleration defined by the equation of motion, $\\mathbf{a}_n = -\\mathbf{L}\\,\\mathbf{u}_n - \\lambda\\,\\mathbf{u}_n^{\\circ 3}$. For general $(\\gamma,\\beta)$, the method is implicit because $\\mathbf{a}_{n+1}$ depends on $\\mathbf{u}_{n+1}$, which leads to a nonlinear system at each step.\n\nYour tasks are the following, starting from the Hamiltonian structure and the semi-discrete system:\n- Derive the Newmark update equations for general $(\\gamma,\\beta)$ for the semi-discrete system, emphasizing how $\\mathbf{L}$ and the nonlinearity enter the implicit step.\n- Devise a spectrally accurate and computationally efficient approach to evaluate $\\mathbf{L}\\,\\mathbf{u}$ and $\\int u_x^2\\,dx$ using the Fast Fourier Transform (FFT) so that the discrete energy is computed consistently with the spatial discretization.\n- In the weakly nonlinear regime (small $\\lambda$), analyze the long-time energy drift as measured by the maximal relative energy error\n$$\n\\max_{0 \\leq n \\leq N}\\frac{\\left|\\mathcal{E}(\\mathbf{u}_n,\\mathbf{v}_n)-\\mathcal{E}(\\mathbf{u}_0,\\mathbf{v}_0)\\right|}{\\mathcal{E}(\\mathbf{u}_0,\\mathbf{v}_0)},\n$$\nfor fixed time step and final time. Explain, from first principles, why different $(\\gamma,\\beta)$ choices can lead to qualitatively different long-time behavior in the nonlinear setting.\n- Propose and implement a minimal correction that restores near-conservation of the Hamiltonian in the weakly nonlinear regime without significantly changing the core Newmark step. The correction must be justified from the Hamiltonian perspective. One admissible approach is an energy projection that rescales the velocity at each step to match the initial energy while keeping the new displacement unchanged.\n\nImplement the following program requirements:\n- Use a one-dimensional periodic domain of length $2\\pi$ with $N$ equally spaced points, where $N = 64$, wave speed $c = 1$, and the initial condition $u(x,0) = A\\sin(x)$, $v(x,0)=0$, with $A = 0.1$. All integrations are nondimensional and require no physical unit conversion.\n- Use the FFT to compute the operator $\\mathbf{L}$ corresponding to $-c^2\\partial_{xx}$ and the derivative $u_x$ needed for the energy.\n- For implicit Newmark cases (all cases with $\\beta > 0$), solve the nonlinear system at each step by a fixed-point iteration that treats the linear operator implicitly and the cubic nonlinearity with a lag from the previous iterate. Specifically, at each time step, solve\n$$\n\\left(\\mathbf{I} + \\alpha \\mathbf{L}\\right)\\mathbf{u}_{n+1} = \\mathbf{r} - \\alpha \\lambda\\,\\mathbf{u}_{n+1}^{\\circ 3},\n$$\nwith $\\alpha = \\beta\\Delta t^2$ and $\\mathbf{r}$ the known right-hand side constructed from the Newmark predictor, by iterating the right-hand side cubic term with the latest iterate and the left-hand side using spectral inversion mode-by-mode.\n- Implement, as the proposed correction, an energy projection at the end of each step that rescales $\\mathbf{v}_{n+1}\\mapsto s\\,\\mathbf{v}_{n+1}$ with a scalar $s$ chosen so that the discrete energy equals the initial energy. If the required kinetic energy becomes nonpositive or the velocity is zero, leave $\\mathbf{v}_{n+1}$ unchanged.\n\nTest suite and output specification:\n- Use the following five test cases, each specified as $(\\gamma,\\beta,\\lambda,\\text{corrected},\\Delta t,T)$, where the boolean $\\text{corrected}$ indicates whether the energy projection is applied:\n    - Case $1$: $(\\tfrac{1}{2}, \\tfrac{1}{4}, 0, \\text{False}, 0.05, 50)$.\n    - Case $2$: $(\\tfrac{1}{2}, \\tfrac{1}{4}, 10^{-2}, \\text{False}, 0.05, 50)$.\n    - Case $3$: $(\\tfrac{1}{2}, \\tfrac{1}{6}, 10^{-2}, \\text{False}, 0.05, 50)$.\n    - Case $4$: $(\\tfrac{1}{2}, 0, 10^{-2}, \\text{False}, 0.02, 50)$.\n    - Case $5$: $(\\tfrac{1}{2}, \\tfrac{1}{4}, 10^{-1}, \\text{True}, 0.05, 50)$.\n- For each case, compute the maximal relative energy drift over the entire integration interval, defined as\n$$\n\\max_{0\\le n\\le N}\\frac{|\\mathcal{E}(\\mathbf{u}_n,\\mathbf{v}_n)-\\mathcal{E}(\\mathbf{u}_0,\\mathbf{v}_0)|}{\\mathcal{E}(\\mathbf{u}_0,\\mathbf{v}_0)}.\n$$\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as the cases above. Each entry must be a floating-point number in standard decimal representation. For example, the output format is like $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5]$.", "solution": "The problem asks for a comprehensive analysis and implementation of the Newmark family of time integration methods for the semi-discretized nonlinear Klein-Gordon equation. This involves deriving the update equations, discussing the spectral spatial discretization, analyzing the long-time energy behavior of different integrators, and implementing an energy-conserving correction.\n\n### Validation of the Problem Statement\nThe problem is scientifically and mathematically sound. It deals with a standard model in mathematical physics (the Klein-Gordon equation) and a classical family of numerical methods for its solution (Newmark methods). The use of spectral methods (FFT) for spatial discretization is a standard and highly accurate technique for problems with periodic boundary conditions. All parameters and initial conditions are provided, making the problem self-contained and well-posed. The tasks are logically structured, guiding from theoretical derivation to numerical implementation and analysis. The posed questions about energy conservation are central to the study of numerical integrators for Hamiltonian systems. The problem is valid.\n\n### Principle-Based Solution\n\n#### Task 1: Derivation of the Newmark Update Equations\nThe Newmark family of methods for a second-order ordinary differential equation system of the form $\\mathbf{u}'' = \\mathbf{a}(t, \\mathbf{u}, \\mathbf{u}')$ is defined by two parameters, $\\gamma$ and $\\beta$. The updates from time step $n$ to $n+1$ are given by:\n$$\n\\mathbf{u}_{n+1} = \\mathbf{u}_n + \\Delta t\\,\\mathbf{v}_n + \\Delta t^2\\left(\\tfrac{1}{2}-\\beta\\right)\\mathbf{a}_n + \\beta \\Delta t^2 \\mathbf{a}_{n+1}\n$$\n$$\n\\mathbf{v}_{n+1} = \\mathbf{v}_n + \\Delta t \\left((1-\\gamma)\\mathbf{a}_n + \\gamma \\mathbf{a}_{n+1}\\right)\n$$\nwhere $\\mathbf{u}_n \\approx \\mathbf{u}(t_n)$, $\\mathbf{v}_n \\approx \\mathbf{u}'(t_n)$, and $\\mathbf{a}_n = \\mathbf{u}''(t_n)$. For the given semi-discrete Klein-Gordon system, the acceleration is a function of the displacement $\\mathbf{u}$:\n$$\n\\mathbf{a}(\\mathbf{u}) = -\\mathbf{L}\\,\\mathbf{u} - \\lambda\\,\\mathbf{u}^{\\circ 3}\n$$\nThus, $\\mathbf{a}_n = \\mathbf{a}(\\mathbf{u}_n)$ and $\\mathbf{a}_{n+1} = \\mathbf{a}(\\mathbf{u}_{n+1})$. If $\\beta \\neq 0$, the equation for $\\mathbf{u}_{n+1}$ depends on $\\mathbf{a}_{n+1}$, which in turn depends on $\\mathbf{u}_{n+1}$. This makes the method implicit. To see this explicitly, we substitute the expression for $\\mathbf{a}_{n+1}$ into the displacement update equation:\n$$\n\\mathbf{u}_{n+1} = \\mathbf{u}_n + \\Delta t\\,\\mathbf{v}_n + \\Delta t^2\\left(\\tfrac{1}{2}-\\beta\\right)\\mathbf{a}_n - \\beta \\Delta t^2 \\left(\\mathbf{L}\\,\\mathbf{u}_{n+1} + \\lambda\\,\\mathbf{u}_{n+1}^{\\circ 3}\\right)\n$$\nRearranging the terms to isolate the unknown $\\mathbf{u}_{n+1}$ on the left-hand side yields a nonlinear algebraic system to be solved at each time step:\n$$\n\\mathbf{u}_{n+1} + \\beta \\Delta t^2 \\mathbf{L}\\,\\mathbf{u}_{n+1} + \\beta \\Delta t^2 \\lambda\\,\\mathbf{u}_{n+1}^{\\circ 3} = \\mathbf{u}_n + \\Delta t\\,\\mathbf{v}_n + \\Delta t^2\\left(\\tfrac{1}{2}-\\beta\\right)\\mathbf{a}_n\n$$\nLetting $\\alpha = \\beta\\Delta t^2$ and defining the right-hand side, which consists of known quantities from step $n$, as $\\mathbf{r} = \\mathbf{u}_n + \\Delta t\\,\\mathbf{v}_n + \\Delta t^2\\left(\\tfrac{1}{2}-\\beta\\right)\\mathbf{a}_n$, we obtain:\n$$\n(\\mathbf{I} + \\alpha \\mathbf{L})\\mathbf{u}_{n+1} = \\mathbf{r} - \\alpha \\lambda\\,\\mathbf{u}_{n+1}^{\\circ 3}\n$$\nThis is the nonlinear system specified in the problem. It can be solved using iterative methods like Newton's method or, as suggested, a fixed-point iteration where the nonlinear term on the right-hand side is evaluated using the previous iterate.\n\n#### Task 2: Spectrally Accurate Evaluation using FFT\nFor a periodic function on $[0, 2\\pi]$, a spectral method using a Fourier series representation is highly effective. A function $u(x)$ on the grid $x_j = j(2\\pi/N)$ is represented by its vector of values $\\mathbf{u}$.\n1.  **Evaluation of $\\mathbf{L}\\,\\mathbf{u}$**: The operator $\\mathbf{L}$ corresponds to $-c^2\\partial_{xx}$. In Fourier space, differentiation $\\partial_{xx}$ corresponds to multiplication by $(ik)^2 = -k^2$, where $k$ is the integer wavenumber. Therefore, the operator $\\mathbf{L}$ corresponds to multiplication by $c^2k^2$ in Fourier space. The procedure is:\n    *   Compute the Fourier coefficients of $\\mathbf{u}$: $\\hat{\\mathbf{u}} = \\text{FFT}(\\mathbf{u})$.\n    *   Let $\\mathbf{k}$ be the vector of integer wavenumbers corresponding to the discrete Fourier modes. The eigenvalues of the discrete operator $\\mathbf{L}$ are $\\{c^2k^2\\}$. Multiply element-wise: $\\widehat{\\mathbf{L}\\,\\mathbf{u}} = (c^2\\mathbf{k}^{\\circ 2}) \\odot \\hat{\\mathbf{u}}$.\n    *   Transform back to physical space: $\\mathbf{L}\\,\\mathbf{u} = \\text{IFFT}(\\widehat{\\mathbf{L}\\,\\mathbf{u}})$. This approach has a computational complexity of $O(N \\log N)$ and avoids forming the dense matrix $\\mathbf{L}$.\n\n2.  **Solving the Implicit Step**: The fixed-point iteration requires solving a linear system of the form $(\\mathbf{I} + \\alpha \\mathbf{L})\\mathbf{w} = \\mathbf{f}$ at each iteration. This is also done efficiently in Fourier space. Applying the FFT to the equation gives:\n    $$\n    (\\mathbf{I} + \\alpha \\text{diag}(c^2\\mathbf{k}^{\\circ 2})) \\hat{\\mathbf{w}} = \\hat{\\mathbf{f}}\n    $$\n    This diagonal system is solved element-wise for the Fourier coefficients of the solution: $\\hat{w}_k = \\hat{f}_k / (1 + \\alpha c^2 k^2)$. The solution $\\mathbf{w}$ is then found by an IFFT.\n\n3.  **Discrete Energy Calculation**: The Hamiltonian $\\mathcal{E}$ is an integral, which we approximate using a spectrally accurate quadrature (the trapezoidal rule on the periodic grid). The discrete energy is:\n    $$\n    \\mathcal{E}(\\mathbf{u},\\mathbf{v}) = \\frac{2\\pi}{N} \\sum_{j=0}^{N-1} \\left( \\tfrac{1}{2} v_j^2 + \\tfrac{c^2}{2} (u_x)_j^2 + \\tfrac{\\lambda}{4} u_j^4 \\right)\n    $$\n    The spatial derivative term $\\mathbf{u}_x$ is computed spectrally for consistency: $\\mathbf{u}_x = \\text{IFFT}(i\\mathbf{k} \\odot \\text{FFT}(\\mathbf{u}))$. All terms are then computed in physical space and summed.\n\n#### Task 3: Long-Time Energy Drift Analysis\nThe long-time behavior of a numerical method applied to a Hamiltonian system is intimately linked to its geometric properties, particularly symplecticity. A symplectic integrator exactly preserves the symplectic structure of phase space, which leads to excellent long-time preservation of a modified Hamiltonian and bounded error in the original Hamiltonian.\n\n*   **Case 4: $(\\gamma, \\beta) = (1/2, 0)$ (Störmer-Verlet)**: This method is explicit. For a separable Hamiltonian $H=T(v)+P(u)$, this method is symplectic. The Klein-Gordon equation has this structure. Consequently, the Störmer-Verlet method is expected to exhibit superior long-time energy behavior. The numerical energy will not drift but will oscillate with a small amplitude around the initial energy. This is the hallmark of a geometric integrator.\n\n*   **Case 1  2: $(\\gamma, \\beta) = (1/2, 1/4)$ (Trapezoidal Rule/Crank-Nicolson)**: This is an implicit, second-order method. For linear Hamiltonian systems ($\\lambda=0$, Case 1), it is both symplectic and conserves the quadratic energy exactly. Thus, for Case 1, the energy error should be at the level of machine precision. For nonlinear systems ($\\lambda \\ne 0$, Case 2), it is no longer symplectic. While it is A-stable and generally considered to have good conservation properties, it will exhibit a slow, secular drift in energy over long times.\n\n*   **Case 3: $(\\gamma, \\beta) = (1/2, 1/6)$ (Linear Acceleration Method)**: This is another second-order implicit method. Like the trapezoidal rule, it is not symplectic for nonlinear problems. This method is known to introduce a slight amount of numerical dissipation, which typically causes the total energy to decay over time. We expect a more pronounced and systematic energy drift (decay) compared to the trapezoidal rule.\n\nIn summary, the choice of $(\\gamma, \\beta)$ determines the geometric properties of the integrator. Only specific choices, like the explicit Störmer-Verlet scheme, are symplectic for this class of problems, leading to qualitatively better long-time energy conservation.\n\n#### Task 4: Energy Projection Correction\nSince general Newmark methods are not energy-conserving for nonlinear problems, one can enforce energy conservation a posteriori. The proposed correction is a projection method. After a standard Newmark step computes $(\\tilde{\\mathbf{u}}_{n+1}, \\tilde{\\mathbf{v}}_{n+1})$, we modify the state to lie on the initial energy surface $\\mathcal{E}(\\mathbf{u}, \\mathbf{v}) = \\mathcal{E}_0$. The proposed projection keeps the displacement fixed, $\\mathbf{u}_{n+1} = \\tilde{\\mathbf{u}}_{n+1}$, and rescales the velocity, $\\mathbf{v}_{n+1} = s \\tilde{\\mathbf{v}}_{n+1}$.\n\nThe discrete energy is $\\mathcal{E} = K(\\mathbf{v}) + P(\\mathbf{u})$, where $K(\\mathbf{v}) = \\frac{\\pi}{N} ||\\mathbf{v}||_2^2$ is the total kinetic energy and $P(\\mathbf{u})$ is the total potential energy. We enforce the condition:\n$$\n\\mathcal{E}(\\mathbf{u}_{n+1}, s \\tilde{\\mathbf{v}}_{n+1}) = K(s \\tilde{\\mathbf{v}}_{n+1}) + P(\\mathbf{u}_{n+1}) = \\mathcal{E}_0\n$$\nSince $K(s \\tilde{\\mathbf{v}}_{n+1}) = s^2 K(\\tilde{\\mathbf{v}}_{n+1})$, we can solve for the scaling factor $s$:\n$$\ns^2 K(\\tilde{\\mathbf{v}}_{n+1}) = \\mathcal{E}_0 - P(\\mathbf{u}_{n+1}) \\implies s = \\sqrt{\\frac{\\mathcal{E}_0 - P(\\mathbf{u}_{n+1})}{K(\\tilde{\\mathbf{v}}_{n+1})}}\n$$\nThis correction is applied only if the target kinetic energy $\\mathcal{E}_0 - P(\\mathbf{u}_{n+1})$ is non-negative and the current kinetic energy $K(\\tilde{\\mathbf{v}}_{n+1})$ is positive. This method, by construction, forces the discrete energy to be conserved at every step, thereby eliminating any drift. For Case 5, which has a relatively large nonlinearity, this projection will counteract the drift of the underlying trapezoidal rule, resulting in an energy error near machine precision.", "answer": "[1.3289947833075252e-15,0.0016335198083863484,0.003960010904000305,1.218843236746816e-07,1.860363219532579e-15]", "id": "3424207"}]}