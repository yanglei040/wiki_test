{"hands_on_practices": [{"introduction": "When discretizing the diffusion equation $-\\nabla \\cdot (a \\nabla u) = 0$ using a finite volume method, a key challenge is defining the diffusion coefficient $a$ on the faces of the control volumes. This exercise [@problem_id:3393670] guides you through deriving a face-averaging formula that satisfies a crucial accuracy condition: the exact preservation of linear solutions. The resulting weighted average is fundamental for creating reliable numerical methods, particularly on non-uniform grids where simpler averaging techniques can compromise accuracy.", "problem": "Consider the steady variable-coefficient diffusion equation in two spatial dimensions,\n$$\n-\\,\\nabla\\cdot\\big(a(x,y)\\,\\nabla u(x,y)\\big)=0,\n$$\nposed on a rectangular domain with a conforming Cartesian mesh of axis-aligned rectangular control volumes. Let the control volume centered at $\\big(x_i,y_j\\big)$ have widths $\\Delta x_i$ in the $x$-direction and $\\Delta y_j$ in the $y$-direction. A standard two-point finite volume approximation defines the normal flux across a vertical face at $\\big(x_{i+\\frac{1}{2}},y_j\\big)$ by\n$$\nF_{i+\\frac{1}{2},j} \\;\\approx\\; -\\,a_{i+\\frac{1}{2},j}\\,\\frac{u_{i+1,j}-u_{i,j}}{\\Delta x_{i+\\frac{1}{2}}}\\;\\Delta y_j,\n$$\nand similarly for horizontal faces, where $\\Delta x_{i+\\frac{1}{2}}=\\tfrac{1}{2}\\big(\\Delta x_i+\\Delta x_{i+1}\\big)$, and $a_{i+\\frac{1}{2},j}$ is a face-centered coefficient obtained by averaging nearby cell-centered samples $a_{i,j}$ and $a_{i+1,j}$.\n\nStarting from the divergence theorem and the definition of the finite volume method, derive a face-averaging design for $a_{i+\\frac{1}{2},j}$ that guarantees the discrete operator exactly preserves any steady linear solution $u(x,y)=\\alpha x+\\beta y+\\gamma$ when the coefficient $a(x,y)=A x + B y + C$ is linear and satisfies $\\nabla a\\cdot\\nabla u=0$ so that the continuous operator vanishes. Identify the minimal conditions on the averaging weights for $a_{i+\\frac{1}{2},j}$ required for this property on a general nonuniform Cartesian mesh. Your final answer must be the single closed-form analytic expression for $a_{i+\\frac{1}{2},j}$ in terms of $\\Delta x_i$, $\\Delta x_{i+1}$, $a_{i,j}$, and $a_{i+1,j}$, written in LaTeX. No numerical approximation or rounding is needed and no physical units should be included in the final answer.", "solution": "The problem requires the derivation of a face-averaging formula for the coefficient $a(x,y)$ in a finite volume discretization of the steady-state, variable-coefficient diffusion equation,\n$$ -\\nabla \\cdot \\big(a(x,y) \\nabla u(x,y)\\big) = 0. $$\nThis formula for the face-centered coefficient, which we denote as $a_{i+\\frac{1}{2},j}$, must guarantee that the discrete operator exactly preserves any linear solution of the form $u(x,y) = \\alpha x + \\beta y + \\gamma$ when the coefficient $a(x,y) = Ax + By + C$ is also linear and the condition $\\nabla a \\cdot \\nabla u = 0$ holds.\n\nThe finite volume method begins by integrating the partial differential equation over a control volume $V_{i,j}$, which is centered at $(x_i, y_j)$ and has dimensions $\\Delta x_i \\times \\Delta y_j$.\n$$ - \\iint_{V_{i,j}} \\nabla \\cdot (a \\nabla u) \\, dx \\, dy = 0. $$\nApplying the divergence theorem transforms this into an equation for the balance of fluxes across the boundary $\\partial V_{i,j}$ of the control volume:\n$$ - \\oint_{\\partial V_{i,j}} (a \\nabla u) \\cdot \\mathbf{n} \\, dS = 0, $$\nwhere $\\mathbf{n}$ is the outward-pointing unit normal vector. For a rectangular control volume, this equation states that the sum of fluxes across the four faces is zero:\n$$ \\mathcal{F}_{i+\\frac{1}{2}, j} - \\mathcal{F}_{i-\\frac{1}{2}, j} + \\mathcal{G}_{i, j+\\frac{1}{2}} - \\mathcal{G}_{i, j-\\frac{1}{2}} = 0. $$\nHere, $\\mathcal{F}$ and $\\mathcal{G}$ represent the exact total fluxes across the vertical and horizontal faces, respectively. For the vertical face at $x=x_{i+\\frac{1}{2}}$, the flux is given by the integral:\n$$ \\mathcal{F}_{i+\\frac{1}{2}, j} = \\int_{y_j - \\Delta y_j/2}^{y_j + \\Delta y_j/2} \\left(-a(x,y) \\frac{\\partial u}{\\partial x}\\right)\\bigg|_{x=x_{i+\\frac{1}{2}}} dy. $$\nThe problem provides the corresponding numerical approximation for this flux:\n$$ F_{i+\\frac{1}{2},j} = -a_{i+\\frac{1}{2},j}\\,\\frac{u_{i+1,j}-u_{i,j}}{\\Delta x_{i+\\frac{1}{2}}}\\;\\Delta y_j. $$\nThe discrete conservation law is formed by substituting these numerical fluxes into the balance equation:\n$$ (F_{i+\\frac{1}{2},j} - F_{i-\\frac{1}{2},j}) + (G_{i,j+\\frac{1}{2}} - G_{i,j-\\frac{1}{2}}) = 0. $$\nOur objective is to determine the expression for $a_{i+\\frac{1}{2},j}$ that ensures this discrete equation holds exactly for the given linear functions.\n\nFor a linear solution $u(x,y) = \\alpha x + \\beta y + \\gamma$, the nodal values are $u_{i,j} = \\alpha x_i + \\beta y_j + \\gamma$. The finite difference quotient for the gradient, taken between cell centers, is exact:\n$$ \\frac{u_{i+1,j} - u_{i,j}}{x_{i+1} - x_i} = \\frac{(\\alpha x_{i+1} + \\beta y_j + \\gamma) - (\\alpha x_i + \\beta y_j + \\gamma)}{x_{i+1} - x_i} = \\alpha = \\frac{\\partial u}{\\partial x}. $$\nThe problem defines the distance between cell centers as $\\Delta x_{i+\\frac{1}{2}} = \\frac{1}{2}(\\Delta x_i + \\Delta x_{i+1})$. The geometry of the contiguous control volumes implies that $x_{i+1} - x_i = \\frac{1}{2}\\Delta x_i + \\frac{1}{2}\\Delta x_{i+1} = \\Delta x_{i+\\frac{1}{2}}$. Therefore, the discrete derivative term correctly evaluates the constant partial derivative:\n$$ \\frac{u_{i+1,j}-u_{i,j}}{\\Delta x_{i+\\frac{1}{2}}} = \\alpha. $$\nSimilarly, for the $y$-direction, $\\frac{u_{i,j+1}-u_{i,j}}{\\Delta y_{j+\\frac{1}{2}}} = \\beta$.\n\nSubstituting these exact derivatives into the numerical flux expressions yields:\n$$ F_{i+\\frac{1}{2},j} = -a_{i+\\frac{1}{2},j} \\alpha \\Delta y_j \\quad \\text{and} \\quad G_{i,j+\\frac{1}{2}} = -a_{i,j+\\frac{1}{2}} \\beta \\Delta x_i. $$\nThe discrete conservation law for the control volume $(i,j)$ becomes:\n$$ \\alpha \\Delta y_j (a_{i-\\frac{1}{2},j} - a_{i+\\frac{1}{2},j}) + \\beta \\Delta x_i (a_{i,j-\\frac{1}{2}} - a_{i,j+\\frac{1}{2}}) = 0. $$\nTo fulfill this condition, we can enforce that the numerical flux approximation $F_{i+\\frac{1}{2},j}$ be equal to the exact integrated flux $\\mathcal{F}_{i+\\frac{1}{2},j}$. Let's compute this exact flux for the linear coefficient $a(x,y)=Ax+By+C$ and constant gradient $\\partial u / \\partial x = \\alpha$:\n$$ \\mathcal{F}_{i+\\frac{1}{2},j} = -\\alpha \\int_{y_j - \\Delta y_j/2}^{y_j + \\Delta y_j/2} (A x_{i+\\frac{1}{2}} + B y + C) \\, dy. $$\nEvaluating the integral with respect to $y$:\n$$ \\mathcal{F}_{i+\\frac{1}{2},j} = -\\alpha \\left[ (A x_{i+\\frac{1}{2}} + C)y + \\frac{B}{2}y^2 \\right]_{y_j - \\Delta y_j/2}^{y_j + \\Delta y_j/2} = -\\alpha \\left( (A x_{i+\\frac{1}{2}} + C)\\Delta y_j + B y_j \\Delta y_j \\right). $$\n$$ \\mathcal{F}_{i+\\frac{1}{2},j} = -\\alpha (A x_{i+\\frac{1}{2}} + B y_j + C) \\Delta y_j = -\\alpha \\, a\\left(x_{i+\\frac{1}{2}}, y_j\\right) \\Delta y_j. $$\nBy equating the numerical flux $F_{i+\\frac{1}{2},j} = -a_{i+\\frac{1}{2},j} \\alpha \\Delta y_j$ to the exact flux $\\mathcal{F}_{i+\\frac{1}{2},j}$, we find the necessary condition for the face coefficient:\n$$ a_{i+\\frac{1}{2},j} = a\\left(x_{i+\\frac{1}{2}}, y_j\\right). $$\nThis means the numerical coefficient at the face must be the exact value of the continuous coefficient at the geometric center of that face. This choice guarantees that the discrete conservation equation is satisfied, as it becomes proportional to the continuous condition $\\nabla a \\cdot \\nabla u = A\\alpha+B\\beta = 0$.\n\nThe final step is to express $a_{i+\\frac{1}{2},j} = a(x_{i+\\frac{1}{2}}, y_j)$ in terms of the known cell-centered values $a_{i,j} = a(x_i, y_j)$ and $a_{i+1,j} = a(x_{i+1}, y_j)$. Since $a(x,y)$ is linear in its arguments, the function $a(x, y_j)$ is a linear function of $x$. Its value at $x_{i+\\frac{1}{2}}$ can be found by linear interpolation between its values at $x_i$ and $x_{i+1}$. The general one-dimensional linear interpolation formula for a function $f(x)$ between points $x_0$ and $x_1$ is $f(x) = f(x_0) \\frac{x_1-x}{x_1-x_0} + f(x_1) \\frac{x-x_0}{x_1-x_0}$.\nWe set $f(x) = a(x, y_j)$, $x_0=x_i$, $x_1=x_{i+1}$, and $x=x_{i+\\frac{1}{2}}$. The coordinate of the face is $x_{i+\\frac{1}{2}} = x_i + \\frac{\\Delta x_i}{2}$. The relevant distances for the interpolation weights are:\n$x_{i+1} - x_i = \\Delta x_{i+\\frac{1}{2}} = \\frac{\\Delta x_i + \\Delta x_{i+1}}{2}$.\n$x - x_0 = x_{i+\\frac{1}{2}} - x_i = \\frac{\\Delta x_i}{2}$.\n$x_1 - x = x_{i+1} - x_{i+\\frac{1}{2}} = \\frac{\\Delta x_{i+1}}{2}$.\n\nSubstituting these distances into the interpolation formula:\n$$ a_{i+\\frac{1}{2},j} = a_{i,j} \\frac{\\frac{\\Delta x_{i+1}}{2}}{\\frac{\\Delta x_i + \\Delta x_{i+1}}{2}} + a_{i+1,j} \\frac{\\frac{\\Delta x_i}{2}}{\\frac{\\Delta x_i + \\Delta x_{i+1}}{2}}. $$\nSimplifying this expression yields the final face-averaging formula:\n$$ a_{i+\\frac{1}{2},j} = a_{i,j} \\frac{\\Delta x_{i+1}}{\\Delta x_i + \\Delta x_{i+1}} + a_{i+1,j} \\frac{\\Delta x_i}{\\Delta x_i + \\Delta x_{i+1}}. $$\nThis is a weighted arithmetic mean of the adjacent cell-centered coefficients, where the weights are determined by the widths of the cells.\nThe minimal conditions identified for the averaging weights $w_i$ and $w_{i+1}$ in a scheme of the form $a_{i+1/2,j} = w_i a_{i,j} + w_{i+1}a_{i+1,j}$ are that they must satisfy $w_i+w_{i+1}=1$ and $w_i x_i + w_{i+1} x_{i+1} = x_{i+1/2}$. These conditions enforce that the averaging is equivalent to linear interpolation to the face center, which is precisely what the derived formula accomplishes.", "answer": "$$\\boxed{\\frac{\\Delta x_{i+1} a_{i,j} + \\Delta x_i a_{i+1,j}}{\\Delta x_i + \\Delta x_{i+1}}}$$", "id": "3393670"}, {"introduction": "There are multiple ways to discretize the operator $-(a u_x)_x$; one can use a conservative flux-based form or first expand the derivatives into $-a u_{xx} - a_x u_x$. While mathematically equivalent in the continuum, their discrete counterparts can have vastly different stability properties, especially for non-smooth coefficients. This practice [@problem_id:3393728] explores the critical property of *monotonicity*, which prevents unphysical oscillations, and reveals a potential failure in the non-conservative approach. By analyzing the behavior with an oscillatory coefficient, you will gain a deeper appreciation for why conservative schemes are generally preferred for their robustness.", "problem": "Consider the one-dimensional variable-coefficient diffusion operator $L u = -(a(x) u_{x})_{x}$ on the interval $[0,1]$ with homogeneous Dirichlet boundary conditions $u(0)=0$ and $u(1)=0$. Let the interval be partitioned into a uniform grid of $N+2$ nodes with spacing $h = \\frac{1}{N+1}$, interior nodes $x_{i} = i h$, $i=1,2,\\dots,N$, and denote $u_{i} \\approx u(x_{i})$ and $a_{i} = a(x_{i})$.\n\nTwo finite difference discretizations are to be compared:\n\n- A conservative flux-based scheme formed by approximating the diffusive flux at faces by $q_{i+1/2} \\approx - a_{i+1/2} \\frac{u_{i+1}-u_{i}}{h}$, and then $L_{h} u_{i} \\approx \\frac{q_{i-1/2} - q_{i+1/2}}{h}$, where the face coefficient is taken as the arithmetic average $a_{i+1/2} = \\frac{a_{i} + a_{i+1}}{2}$.\n\n- A node-based non-conservative scheme formed by expanding $-(a u_{x})_{x} = -a u_{xx} - a_{x} u_{x}$ and approximating $u_{xx}(x_{i})$ by the centered difference $\\frac{u_{i+1}-2u_{i}+u_{i-1}}{h^{2}}$, $u_{x}(x_{i})$ by $\\frac{u_{i+1}-u_{i-1}}{2h}$, and $a_{x}(x_{i})$ by the centered difference of arithmetic face averages $\\frac{a_{i+1/2} - a_{i-1/2}}{h}$ with $a_{i\\pm 1/2}=\\frac{a_{i} + a_{i\\pm 1}}{2}$.\n\nAssume a smooth oscillatory diffusion coefficient $a(x) = 1 + \\epsilon \\cos(k x)$ with $0  \\epsilon  1$ and $k0$. You may treat $k$ as a free parameter and $N$ as large enough that interior nodes are not affected by boundary closures in the node-based scheme.\n\nStarting from these definitions, derive the three-point stencil of each scheme. Define monotonicity of the discrete operator as the property that, for interior nodes, all off-diagonal stencil coefficients are nonpositive (which is equivalent to the system matrix being a monotone matrix with nonpositive off-diagonal entries). Show that the flux-based scheme is monotone for all $0\\epsilon1$. For the node-based scheme, derive a sharp condition on $\\epsilon$ and $h$ (expressed via $k h$) under which monotonicity is lost because at least one off-diagonal stencil coefficient becomes positive at some interior node.\n\nFinally, by optimizing over the oscillation wavenumber $k$ to produce the smallest possible amplitude $\\epsilon$ that triggers loss of monotonicity in the node-based scheme, determine the minimal amplitude $\\epsilon_{\\mathrm{min}}$ as a single closed-form expression. No numerical rounding is required; express the final answer as a simplified exact expression. The final answer must be the expression for $\\epsilon_{\\mathrm{min}}$.", "solution": "The problem asks for an analysis of two finite difference schemes for the one-dimensional variable-coefficient diffusion operator $L u = -(a(x) u_{x})_{x}$ on $[0,1]$ with homogeneous Dirichlet boundary conditions. We will first derive the stencils for each scheme, then analyze their monotonicity.\n\nThe grid is uniform with spacing $h = \\frac{1}{N+1}$, and interior nodes are $x_i = ih$ for $i=1, \\dots, N$. The analytical diffusion coefficient is given by $a(x) = 1 + \\epsilon \\cos(k x)$ with $0  \\epsilon  1$ and $k0$. This condition on $\\epsilon$ ensures that $a(x) \\ge 1-\\epsilon  0$, which is physically required for a diffusion coefficient.\n\nThe discrete system of equations approximating $L u = f$ can be written as $A\\mathbf{u} = \\mathbf{f}$, where $A$ is a matrix representing the discrete operator. Monotonicity is defined as the property that all off-diagonal entries of this matrix $A$ are nonpositive, i.e., $A_{i,j} \\le 0$ for $i \\ne j$.\n\n**Scheme 1: Conservative Flux-Based Scheme**\n\nThe scheme is defined by approximating the operator $L u = -(a u_x)_x$ by differencing numerical fluxes. The discrete operator $A$ should approximate $L$. The $i$-th equation is given by\n$(A u)_i = \\frac{q_{i-1/2} - q_{i+1/2}}{h}$.\nThe flux at the face $x_{i+1/2}$ is approximated as $q_{i+1/2} \\approx -a_{i+1/2} \\frac{u_{i+1}-u_i}{h}$, with $a_{i+1/2} = \\frac{a_i + a_{i+1}}{2}$.\nSubstituting the flux approximations into the discrete operator:\n$$(A u)_i = \\frac{1}{h} \\left( -a_{i-1/2} \\frac{u_i-u_{i-1}}{h} - \\left(-a_{i+1/2} \\frac{u_{i+1}-u_i}{h}\\right) \\right)$$\n$$(A u)_i = \\frac{1}{h^2} \\left( a_{i-1/2}u_{i-1} - (a_{i-1/2} + a_{i+1/2})u_i + a_{i+1/2}u_{i+1} \\right)$$\nThe off-diagonal coefficients of the matrix $A$ are $A_{i,i-1} = \\frac{a_{i-1/2}}{h^2}$ and $A_{i,i+1} = \\frac{a_{i+1/2}}{h^2}$. For monotonicity, these must be nonpositive.\nHowever, the standard discretization of the negative-definite operator $-(a u_x)_x$ leads to a positive-definite matrix, whose off-diagonal entries should be nonpositive. There is a sign error in the problem's definition of $L_h u_i$. A standard conservative discretization of $-(a u_x)_x$ is:\n$$(A u)_i = -\\frac{q_{i+1/2} - q_{i-1/2}}{h} = -\\frac{1}{h}\\left(-a_{i+1/2} \\frac{u_{i+1}-u_i}{h} - \\left(-a_{i-1/2} \\frac{u_i-u_{i-1}}{h}\\right)\\right)$$\n$$(A u)_i = \\frac{1}{h^2} \\left(-a_{i-1/2} u_{i-1} + (a_{i-1/2} + a_{i+1/2})u_i - a_{i+1/2}u_{i+1}\\right)$$\nThe off-diagonal stencil coefficients are $A_{i,i-1} = -a_{i-1/2}/h^2$ and $A_{i,i+1} = -a_{i+1/2}/h^2$.\nFor monotonicity, these must be nonpositive. Since $a(x) > 0$, the face-averaged coefficients $a_{i \\pm 1/2}$ are also strictly positive. Therefore, the off-diagonal coefficients are always negative, and the conservative flux-based scheme is monotone for all $0  \\epsilon  1$.\n\n**Scheme 2: Node-Based Non-Conservative Scheme**\n\nThis scheme is based on the expansion $-(a u_x)_x = -a u_{xx} - a_x u_x$. The derivatives are approximated using centered differences at node $x_i$:\n$$(A u)_i = -a_i \\left(\\frac{u_{i+1}-2u_i+u_{i-1}}{h^2}\\right) - \\left(\\frac{a_{i+1}-a_{i-1}}{2h}\\right) \\left(\\frac{u_{i+1}-u_{i-1}}{2h}\\right)$$\nHere we used the given approximation for $a_x(x_i) \\approx \\frac{a_{i+1/2}-a_{i-1/2}}{h} = \\frac{(a_i+a_{i+1})/2-(a_{i-1}+a_i)/2}{h} = \\frac{a_{i+1}-a_{i-1}}{2h}$.\nTo find the stencil, we collect coefficients of $u_{i-1}, u_i, u_{i+1}$. The term $-a_i u_{xx}$ contributes $\\frac{1}{h^2}[-a_i u_{i-1} + 2a_i u_i - a_i u_{i+1}]$. The term $-a_x u_x$ contributes $\\frac{1}{4h^2}[-(a_{i+1}-a_{i-1})u_{i+1} + (a_{i+1}-a_{i-1})u_{i-1}]$. Summing them:\nCoefficient of $u_{i-1}$: $A_{i,i-1} = \\frac{1}{h^2}\\left[-a_i + \\frac{1}{4}(a_{i+1}-a_{i-1})\\right]=\\frac{1}{4h^2}(-4a_i+a_{i+1}-a_{i-1})$.\nCoefficient of $u_{i+1}$: $A_{i,i+1} = \\frac{1}{h^2}\\left[-a_i - \\frac{1}{4}(a_{i+1}-a_{i-1})\\right]=\\frac{1}{4h^2}(-4a_i-a_{i+1}+a_{i-1})$.\nCoefficient of $u_i$: $A_{i,i} = \\frac{2a_i}{h^2}$.\nFor monotonicity, the off-diagonal coefficients must be nonpositive.\nCondition 1: $A_{i,i-1} \\le 0 \\implies -4a_i + a_{i+1} - a_{i-1} \\le 0 \\iff a_{i+1} - a_{i-1} \\le 4a_i$.\nCondition 2: $A_{i,i+1} \\le 0 \\implies -4a_i - a_{i+1} + a_{i-1} \\le 0 \\iff a_{i-1} - a_{i+1} \\le 4a_i$.\nThese two conditions combine to $|a_{i+1} - a_{i-1}| \\le 4a_i$. Monotonicity is lost if this condition is violated for any interior node $x_i$, i.e., if $|a_{i+1} - a_{i-1}| > 4a_i$.\n\nNow, we substitute $a(x) = 1 + \\epsilon \\cos(kx)$.\n$a_i = a(x_i) = 1 + \\epsilon \\cos(kx_i)$.\n$a_{i+1} - a_{i-1} = (1+\\epsilon\\cos(k(x_i+h))) - (1+\\epsilon\\cos(k(x_i-h)))$.\nUsing the identity $\\cos(A) - \\cos(B) = -2\\sin(\\frac{A+B}{2})\\sin(\\frac{A-B}{2})$:\n$a_{i+1} - a_{i-1} = \\epsilon(\\cos(kx_i+kh) - \\cos(kx_i-kh)) = -2\\epsilon\\sin(kx_i)\\sin(kh)$.\nThe condition for loss of monotonicity becomes:\n$$|-2\\epsilon\\sin(kx_i)\\sin(kh)| > 4(1 + \\epsilon\\cos(kx_i))$$\n$$2\\epsilon|\\sin(kx_i)||\\sin(kh)| > 4 + 4\\epsilon\\cos(kx_i)$$\n$$\\epsilon|\\sin(kx_i)||\\sin(kh)| > 2 + 2\\epsilon\\cos(kx_i)$$\nLet $\\alpha = kx_i$ and $\\beta = kh$. The inequality is $\\epsilon|\\sin(\\alpha)||\\sin(\\beta)| - 2\\epsilon\\cos(\\alpha) > 2$.\n$$\\epsilon \\left( |\\sin\\alpha||\\sin\\beta| - 2\\cos\\alpha \\right) > 2$$\nFor monotonicity to be lost, this inequality must hold for some node $x_i$ (i.e., for some value of $\\alpha$). This is possible if and only if there is a choice of $\\alpha$ that makes the term in the parenthesis positive. If it is positive, then monotonicity is lost if $\\epsilon > \\frac{2}{|\\sin\\alpha||\\sin\\beta| - 2\\cos\\alpha}$.\nTo find the minimal $\\epsilon$ that triggers this loss, we must maximize the expression $H(\\alpha, \\beta) = |\\sin\\alpha||\\sin\\beta| - 2\\cos\\alpha$. The minimal amplitude will be $\\epsilon_{\\mathrm{min}} = \\frac{2}{\\max_{\\alpha, \\beta} H(\\alpha, \\beta)}$.\n\nWe optimize $H(\\alpha, \\beta)$ over $\\alpha$ (for any location $x_i$) and $\\beta=kh$ (for any wavenumber $k$).\nFirst, we maximize $H(\\alpha, \\beta) = |\\sin\\beta||\\sin\\alpha| - 2\\cos\\alpha$ with respect to $\\alpha$ for a fixed $\\beta$. This is a linear combination of $\\sin\\alpha$ and $\\cos\\alpha$. The maximum value is the amplitude of this combination, which is $\\sqrt{(|\\sin\\beta|)^2 + (-2)^2} = \\sqrt{\\sin^2\\beta + 4}$.\nNext, we maximize this expression with respect to $\\beta=kh$.\n$$\\max_{\\beta0} \\sqrt{\\sin^2\\beta + 4}$$\nThis expression is maximized when $\\sin^2\\beta$ is maximized. The maximum value of $\\sin^2\\beta$ is $1$, which occurs when $\\beta = kh = \\frac{\\pi}{2} + n\\pi$ for any integer $n \\ge 0$.\nThe overall maximum value is $\\max_{\\alpha, \\beta} H(\\alpha, \\beta) = \\sqrt{1+4} = \\sqrt{5}$.\n\nThe sharp condition for loss of monotonicity is that $\\epsilon$ must be larger than the critical value $\\epsilon_c(kh) = \\frac{2}{\\sqrt{\\sin^2(kh)+4}}$.\nThe minimal amplitude $\\epsilon_{\\mathrm{min}}$ over all possible wavenumbers $k$ is found by taking the minimum of this critical value over $k$:\n$$\\epsilon_{\\mathrm{min}} = \\min_{k0} \\epsilon_c(kh) = \\min_{\\beta0} \\frac{2}{\\sqrt{\\sin^2\\beta + 4}}$$\nThis minimum is achieved when the denominator is maximized, which we found to be $\\sqrt{5}$.\nTherefore, the minimal amplitude is:\n$$\\epsilon_{\\mathrm{min}} = \\frac{2}{\\sqrt{5}} = \\frac{2\\sqrt{5}}{5}$$\nFor any $\\epsilon > \\epsilon_{\\mathrm{min}}$, it is possible to choose a wavenumber $k$ (and thus a value of $\\beta=kh$) and find a location $x_i$ such that a non-diagonal stencil coefficient becomes positive. If $\\epsilon  \\epsilon_{\\mathrm{min}}$, the scheme is monotone for all $k$ and all $x_i$.", "answer": "$$\\boxed{\\frac{2\\sqrt{5}}{5}}$$", "id": "3393728"}, {"introduction": "Many physical systems involve diffusion across distinct materials, leading to sharp, discontinuous jumps in the diffusion coefficient at interfaces. Simply averaging the coefficient across such a jump is physically incorrect and leads to large errors, as it fails to enforce flux continuity properly. In this hands-on coding exercise [@problem_id:3393695], you will implement a finite difference method that correctly handles these discontinuities by deriving and using an *effective* conductivity based on the principle of series resistances. By building and validating your solver against an exact analytical solution, you will master a fundamental technique for accurately modeling multi-material interface problems.", "problem": "Consider the one-dimensional steady-state diffusion governed by the conservation of flux and Fick's law: the diffusive flux $q(x)$ satisfies $q(x) = -k(x)\\,u_x(x)$ where $k(x)$ is a spatially varying conductivity, and steady balance implies $q_x(x) = 0$. Together these give the second-order Partial Differential Equation (PDE) $-(k(x)\\,u_x(x))_x = 0$ on the domain $x \\in (0,1)$, with Dirichlet boundary conditions $u(0) = u_L$ and $u(1) = u_R$. The conductivity $k(x)$ is discontinuous across a finite set of interfaces; specifically, there exist ordered interface positions $\\{\\alpha_1,\\alpha_2,\\dots,\\alpha_{m-1}\\}$ with $0 = \\alpha_0  \\alpha_1  \\cdots  \\alpha_{m-1}  \\alpha_m = 1$, such that $k(x) = k_j$ for $x \\in [\\alpha_{j-1},\\alpha_j)$ and $j \\in \\{1,2,\\dots,m\\}$. Across each interface $x = \\alpha_j$, physical consistency requires continuity of the solution $u(x)$ and continuity of the flux $k(x)\\,u_x(x)$.\nYour tasks are:\n- Starting from the conservation law $q_x(x) = 0$, derive a robust finite difference approximation on a uniform grid of $N$ points $x_i = i\\,h$ with $h = 1/(N-1)$. Integrate the PDE over control volumes $V_i = [x_i-h/2, x_i+h/2]$ centered at each interior grid point $x_i$ for $i \\in \\{1,2,\\dots,N-2\\}$ to obtain a discrete balance that conserves flux.\n- Show that the discrete flux across each face can be consistently represented by an effective conductivity $k_{i+1/2}$ multiplying the discrete gradient $(u_{i+1} - u_i)/h$, where $k_{i+1/2}$ arises from a local series composition of conductivities over the subinterval $(x_i,x_{i+1})$. Explicitly, for piecewise constant $k(x)$, the series law for resistances yields\n$$\nk_{i+1/2} = \\frac{h}{\\displaystyle \\int_{x_i}^{x_{i+1}} \\frac{1}{k(x)}\\,dx }.\n$$\n- Assemble the resulting tridiagonal linear system for the interior unknowns $\\{u_i\\}_{i=1}^{N-2}$, incorporating the Dirichlet boundary conditions through the right-hand side.\n- For the zero-source case $-(k(x)\\,u_x(x))_x = 0$ with piecewise constant $k(x)$ and Dirichlet boundary conditions, derive the exact solution in terms of the cumulative integral of $1/k(x)$:\n$$\nu(x) = u_L + (u_R - u_L)\\,\\frac{\\displaystyle \\int_0^x \\frac{1}{k(s)}\\,ds}{\\displaystyle \\int_0^1 \\frac{1}{k(s)}\\,ds}.\n$$\nUse this exact solution to compute the error of your numerical method.\n\nAll variables in this problem are non-dimensional; no physical units are required. Angles are not involved in this problem.\n\nImplement a complete program that:\n- Constructs the uniform grid.\n- Computes the effective face conductivities $k_{i-1/2}$ and $k_{i+1/2}$ from the series law over each face interval $(x_{i-1},x_i)$ and $(x_i,x_{i+1})$ using the given $\\{\\alpha_j\\}$ and $\\{k_j\\}$.\n- Assembles and solves the tridiagonal linear system for the interior unknowns with the given Dirichlet boundary data.\n- Evaluates the exact solution on the grid and computes the maximum absolute error over all grid points.\n- Executes the following test suite of parameter values and outputs the maximum absolute error for each case, in a single line as specified below.\n\nTest suite (each case specified by $(N,\\boldsymbol{\\alpha},\\boldsymbol{k},u_L,u_R)$):\n1. Case A (happy path, single interface): $(N = 201,\\ \\boldsymbol{\\alpha} = [0.37],\\ \\boldsymbol{k} = [1.0,4.0],\\ u_L = 0.0,\\ u_R = 1.0)$.\n2. Case B (interface near boundary): $(N = 201,\\ \\boldsymbol{\\alpha} = [0.001],\\ \\boldsymbol{k} = [2.0,0.5],\\ u_L = 0.0,\\ u_R = 1.0)$.\n3. Case C (extreme contrast ratio): $(N = 401,\\ \\boldsymbol{\\alpha} = [0.7333333],\\ \\boldsymbol{k} = [10^{-6},1.0],\\ u_L = 0.0,\\ u_R = 1.0)$.\n4. Case D (two interfaces): $(N = 301,\\ \\boldsymbol{\\alpha} = [0.2,0.8],\\ \\boldsymbol{k} = [1.0,10.0,0.1],\\ u_L = 0.0,\\ u_R = 1.0)$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For the above four cases, the program must print exactly one line in the format $[e_A,e_B,e_C,e_D]$, where each entry is the maximum absolute error for the corresponding case, represented as a decimal number.", "solution": "We begin from the fundamental balance laws. In steady state diffusion, the diffusive flux $q(x)$ obeys the conservation law $q_x(x) = 0$, and Fick's law relates flux to gradient via $q(x) = -k(x)\\,u_x(x)$, where $k(x)$ is the conductivity. Combining these yields the second-order Partial Differential Equation (PDE)\n$$\n-(k(x)\\,u_x(x))_x = 0 \\quad \\text{for } x \\in (0,1),\n$$\nwith Dirichlet boundary conditions $u(0) = u_L$ and $u(1) = u_R$. At any interface $x=\\alpha_j$ where $k(x)$ is discontinuous, the physical requirements are continuity of $u(x)$ and continuity of the flux $k(x)\\,u_x(x)$. These interface conditions follow from conservation of mass and the absence of singular sources.\n\nTo discretize, we use a finite volume approach. We consider control volumes $V_i = [x_i-h/2, x_i+h/2]$ centered around each interior grid point $x_i$ for $i \\in \\{1, \\dots, N-2\\}$. Integrating the conservation law $q_x(x)=0$ over $V_i$ gives:\n$$\n\\int_{x_i-h/2}^{x_i+h/2} q_x(x) dx = q(x_i+h/2) - q(x_i-h/2) = 0.\n$$\nWe denote the faces as $x_{i\\pm 1/2}$ and the numerical fluxes across them as $q_{i\\pm 1/2}$. The discrete conservation law is $q_{i+1/2} - q_{i-1/2} = 0$. We approximate each face flux using the nodal values on either side:\n$$\nq_{i+1/2} \\approx -k_{i+1/2}\\,\\frac{u_{i+1} - u_i}{h}, \\quad q_{i-1/2} \\approx -k_{i-1/2}\\,\\frac{u_i - u_{i-1}}{h},\n$$\nwhere $k_{i\\pm 1/2}$ are effective face conductivities. Substituting these into the conservation law gives\n$$\n-k_{i+1/2}\\,\\frac{u_{i+1} - u_i}{h} - \\left(-k_{i-1/2}\\,\\frac{u_i - u_{i-1}}{h}\\right) = 0.\n$$\nMultiplying by $h$ and rearranging yields the symmetric tridiagonal stencil\n$$\n-k_{i-1/2}\\,u_{i-1} + \\left(k_{i-1/2} + k_{i+1/2}\\right)\\,u_i - k_{i+1/2}\\,u_{i+1} = 0,\n$$\nvalid for each interior index $i \\in \\{1,2,\\dots,N-2\\}$. Incorporating Dirichlet boundary conditions $u_0 = u_L$ and $u_{N-1} = u_R$ moves the boundary contributions to the right-hand side:\n$$\n-k_{i-1/2}\\,u_{i-1} + \\left(k_{i-1/2} + k_{i+1/2}\\right)\\,u_i - k_{i+1/2}\\,u_{i+1} =\n\\begin{cases}\nk_{1-1/2}\\,u_L  \\text{if } i=1,\\\\\n0  \\text{if } 1  i  N-2,\\\\\nk_{N-2+1/2}\\,u_R  \\text{if } i=N-2.\n\\end{cases}\n$$\nThis linear system is symmetric and strictly diagonally dominant because $k_{i\\pm 1/2} > 0$, ensuring a unique solution and stability.\n\nThe key issue in interface problems is the choice of effective face conductivity. For the flux $q_{i+1/2}$ between nodes $x_i$ and $x_{i+1}$, the correct effective conductivity is obtained from the series law for resistances. Over the interval $(x_i,x_{i+1})$ with length $h$, the flux is constant and the drop in $u$ is the sum of drops across subsegments:\n$$\nu_{i+1} - u_i = \\int_{x_i}^{x_{i+1}} u_x(s)\\,ds = -\\int_{x_i}^{x_{i+1}} \\frac{q}{k(s)}\\,ds = -q\\int_{x_i}^{x_{i+1}} \\frac{1}{k(s)}\\,ds.\n$$\nSolving for the flux $q$ gives\n$$\nq = -\\frac{u_{i+1} - u_i}{\\displaystyle \\int_{x_i}^{x_{i+1}} \\frac{1}{k(s)}\\,ds}.\n$$\nComparing with the discrete flux $q_{i+1/2} \\approx -k_{i+1/2}\\,\\frac{u_{i+1}-u_i}{h}$ yields the effective face conductivity\n$$\nk_{i+1/2} = \\frac{h}{\\displaystyle \\int_{x_i}^{x_{i+1}} \\frac{1}{k(s)}\\,ds}.\n$$\nFor piecewise constant $k(x)$ with interfaces $\\{\\alpha_j\\}$, the integral $\\int_{x_i}^{x_{i+1}} 1/k(s)\\,ds$ decomposes into a finite sum over overlapping subsegments with lengths $\\ell_j$ inside each material:\n$$\n\\int_{x_i}^{x_{i+1}} \\frac{1}{k(s)}\\,ds = \\sum_{j=1}^{m} \\frac{\\ell_j}{k_j}, \\quad \\text{where } \\ell_j = \\max\\{0, \\min(x_{i+1},\\alpha_j) - \\max(x_i,\\alpha_{j-1})\\}.\n$$\nThus,\n$$\nk_{i+1/2} = \\frac{h}{\\displaystyle \\sum_{j=1}^{m} \\frac{\\ell_j}{k_j} }.\n$$\nWhen $(x_i,x_{i+1})$ lies entirely inside a single material, this reduces to $k_{i+1/2} = k_j$. When $(x_i,x_{i+1})$ straddles a single interface and $k$ is piecewise constant on each side, the above formula is the exact series combination of conductivities across the two subsegments, which generalizes the familiar harmonic mean (recovered when the interface lies exactly halfway between the nodes, i.e., $\\ell_{\\text{left}} = \\ell_{\\text{right}} = h/2$).\n\nFor the zero-source governing PDE, an exact solution is available from integrating $u_x = -q/k(x)$ with constant flux $q$ and applying Dirichlet boundary conditions:\n$$\nu(x) = u_L + (u_R - u_L)\\,\\frac{\\displaystyle \\int_0^x \\frac{1}{k(s)}\\,ds}{\\displaystyle \\int_0^1 \\frac{1}{k(s)}\\,ds}.\n$$\nBecause $k(x)$ is piecewise constant, $\\int_0^x \\frac{1}{k(s)}\\,ds$ is a piecewise linear function of $x$ whose slopes are $1/k_j$ within each material interval $[\\alpha_{j-1},\\alpha_j)$, and the denominator $\\int_0^1 \\frac{1}{k(s)}\\,ds$ is the total sum of interval lengths divided by their conductivities.\n\nAlgorithmic steps for the program:\n1. Construct the uniform grid $\\{x_i\\}_{i=0}^{N-1}$ and set Dirichlet values $u_0 = u_L$, $u_{N-1} = u_R$.\n2. For each interior index $i \\in \\{1,\\dots,N-2\\}$, compute $k_{i-1/2}$ and $k_{i+1/2}$ via the series law:\n   - For the face interval $(x_{i-1},x_i)$, compute overlapping subsegment lengths $\\ell_j = \\max\\{0, \\min(x_i,\\alpha_j) - \\max(x_{i-1},\\alpha_{j-1})\\}$, then set $k_{i-1/2} = h / \\sum_j (\\ell_j/k_j)$.\n   - Similarly for $(x_i,x_{i+1})$ to obtain $k_{i+1/2}$.\n3. Assemble the tridiagonal system\n   $$\n   -k_{i-1/2}\\,u_{i-1} + \\left(k_{i-1/2}+k_{i+1/2}\\right)\\,u_i - k_{i+1/2}\\,u_{i+1} = b_i,\n   $$\n   with $b_1 = k_{1/2}\\,u_L$, $b_i=0$ for $1iN-2$, and $b_{N-2} = k_{N-3/2}\\,u_R$.\n4. Solve for the interior unknowns and assemble the full solution vector $\\{u_i\\}$ including boundaries.\n5. Compute the exact solution on the grid using the cumulative integral of $1/k(x)$ and evaluate the maximum absolute error $\\max_i |u_i^{\\text{num}} - u_i^{\\text{exact}}|$.\n6. Apply the above to the four test cases and produce a single-line output in the required format.\n\nThis discretization is consistent with the conservation law and rigorously enforces flux continuity across interfaces through the series-law effective conductivities. The resulting linear system is symmetric positive definite, so numerical solution via direct methods is straightforward. The error measures quantify the method's accuracy in the presence of discontinuous coefficients and varying interface configurations.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef overlap_length(a_start, a_end, b_start, b_end):\n    \"\"\"Length of overlap between intervals [a_start, a_end] and [b_start, b_end].\"\"\"\n    left = max(a_start, b_start)\n    right = min(a_end, b_end)\n    return max(0.0, right - left)\n\ndef effective_conductivity_on_interval(xL, xR, alphas, ks):\n    \"\"\"\n    Compute the effective conductivity over [xL, xR] for piecewise-constant k defined\n    by interfaces 'alphas' (sorted ascending) and values 'ks' per segment.\n    Uses the series law: k_eff = (xR - xL) / sum_j (overlap_j / k_j).\n    \"\"\"\n    # Build segment boundaries: [0, alpha1, alpha2, ..., 1]\n    boundaries = [0.0] + list(alphas) + [1.0]\n    denom = 0.0\n    for j in range(len(ks)):\n        seg_start = boundaries[j]\n        seg_end = boundaries[j + 1]\n        ell = overlap_length(xL, xR, seg_start, seg_end)\n        if ell > 0.0:\n            denom += ell / ks[j]\n    # denom should be positive since xR > xL and ks[j] > 0\n    if denom = 0.0:\n        # This should not happen, but guard against numerical issues.\n        return 0.0\n    return (xR - xL) / denom\n\ndef assemble_and_solve(N, alphas, ks, uL, uR):\n    \"\"\"\n    Assemble the tridiagonal system for -(k u')' = 0 with Dirichlet BCs\n    using effective face conductivities, solve, and return the grid, numerical solution.\n    \"\"\"\n    x = np.linspace(0.0, 1.0, N)\n    h = x[1] - x[0]\n    M = N - 2  # number of interior points\n    if M = 0:\n        # Trivial grid with only boundaries\n        u = np.array([uL, uR]) if N == 2 else np.array([uL])\n        return x, u\n\n    # Precompute face conductivities k_{i-1/2} and k_{i+1/2} for interior stencils\n    k_left_face = np.zeros(M)\n    k_right_face = np.zeros(M)\n    for i in range(1, N - 1):  # i = 1..N-2\n        im = i - 1  # interior index 0..M-1\n        k_left_face[im] = effective_conductivity_on_interval(x[i - 1], x[i], alphas, ks)\n        k_right_face[im] = effective_conductivity_on_interval(x[i], x[i + 1], alphas, ks)\n\n    # Assemble tridiagonal matrix A and RHS b\n    diag = k_left_face + k_right_face\n    lower = -k_left_face[1:]   # subdiagonal A[i,i-1] for i=1..M-1\n    upper = -k_right_face[:-1] # superdiagonal A[i,i+1] for i=0..M-2\n    b = np.zeros(M)\n    # Boundary contributions\n    b[0] += k_left_face[0] * uL\n    b[-1] += k_right_face[-1] * uR\n\n    # Build full matrix for solve (small sizes acceptable)\n    A = np.zeros((M, M))\n    np.fill_diagonal(A, diag)\n    np.fill_diagonal(A[1:], lower)       # subdiagonal\n    np.fill_diagonal(A[:, 1:], upper)    # superdiagonal\n\n    # Solve for interior unknowns\n    u_interior = np.linalg.solve(A, b)\n\n    # Assemble full solution including boundaries\n    u = np.zeros(N)\n    u[0] = uL\n    u[-1] = uR\n    u[1:-1] = u_interior\n    return x, u\n\ndef integral_invk_up_to(x, alphas, ks):\n    \"\"\"\n    Compute S(x) = int_0^x (1/k(s)) ds for piecewise-constant k defined by 'alphas' and 'ks'.\n    \"\"\"\n    boundaries = [0.0] + list(alphas) + [1.0]\n    S = 0.0\n    # Sum contributions from each segment up to x\n    for j in range(len(ks)):\n        seg_start = boundaries[j]\n        seg_end = boundaries[j + 1]\n        if x = seg_start:\n            break\n        contrib_end = min(x, seg_end)\n        length = max(0.0, contrib_end - seg_start)\n        S += length / ks[j]\n        if x  seg_end:\n            break\n    return S\n\ndef exact_solution_on_grid(x, alphas, ks, uL, uR):\n    \"\"\"\n    Exact solution for -(k u')' = 0 with Dirichlet BCs:\n    u(x) = uL + (uR - uL) * S(x) / S(1), where S(x) = int_0^x 1/k(s) ds.\n    \"\"\"\n    S1 = integral_invk_up_to(1.0, alphas, ks)\n    # Handle degenerate case (should not happen for positive ks)\n    if S1 = 0.0:\n        return np.full_like(x, uL)\n    u_exact = np.empty_like(x)\n    for i, xi in enumerate(x):\n        Sx = integral_invk_up_to(xi, alphas, ks)\n        u_exact[i] = uL + (uR - uL) * (Sx / S1)\n    return u_exact\n\ndef max_abs_error(u_num, u_exact):\n    return float(np.max(np.abs(u_num - u_exact)))\n\ndef run_case(N, alphas, ks, uL, uR):\n    x, u_num = assemble_and_solve(N, alphas, ks, uL, uR)\n    u_exact = exact_solution_on_grid(x, alphas, ks, uL, uR)\n    return max_abs_error(u_num, u_exact)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: (N, alphas, ks, uL, uR)\n        (201, [0.37], [1.0, 4.0], 0.0, 1.0),\n        # Case B: interface near boundary\n        (201, [0.001], [2.0, 0.5], 0.0, 1.0),\n        # Case C: extreme contrast ratio\n        (401, [0.7333333], [1.0e-6, 1.0], 0.0, 1.0),\n        # Case D: two interfaces\n        (301, [0.2, 0.8], [1.0, 10.0, 0.1], 0.0, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, alphas, ks, uL, uR = case\n        err = run_case(N, alphas, ks, uL, uR)\n        results.append(err)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3393695"}]}