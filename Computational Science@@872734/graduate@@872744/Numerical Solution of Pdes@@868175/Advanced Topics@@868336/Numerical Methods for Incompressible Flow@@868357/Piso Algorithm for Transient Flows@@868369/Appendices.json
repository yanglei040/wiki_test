{"hands_on_practices": [{"introduction": "Understanding the computational trade-offs between different numerical schemes is a cornerstone of efficient simulation. This practice guides you through a cost-benefit analysis comparing the PISO algorithm to the classic SIMPLE method. By building a cost model based on fundamental operations, you will derive the conditions under which PISO offers a performance advantage, providing a quantitative basis for algorithmic selection. [@problem_id:3432081]", "problem": "Consider a finite-volume discretization of the transient, incompressible Navier–Stokes equations for a flow with velocity field $\\boldsymbol{u}(\\boldsymbol{x},t)$ and pressure $p(\\boldsymbol{x},t)$ on a mesh of $n$ control volumes. Two segregated pressure–velocity coupling strategies are considered at each time step: the Semi-Implicit Method for Pressure-Linked Equations (SIMPLE) and the Pressure-Implicit with Splitting of Operators (PISO) algorithm. In SIMPLE, $N$ outer velocity–pressure coupling iterations are performed per time step. In PISO, a single implicit momentum predictor is followed by $M$ successive pressure correctors per time step.\n\nAssume the following computational cost model per call for the algebraic operations arising in the discretization:\n- Momentum matrix assembly per call costs $C_{A_u} = \\alpha_u n$.\n- Momentum linear solve per call costs $C_{S_u} = \\beta_u n k_u$, where $k_u$ is the iteration count of an iterative solver with fixed preconditioning, and $\\beta_u$ is a per-degree-of-freedom-per-iteration cost constant.\n- Pressure Poisson matrix assembly per call costs $C_{A_p} = \\alpha_p n$.\n- Pressure Poisson linear solve per call costs $C_{S_p} = \\beta_p n k_p$, where $k_p$ is the iteration count of the pressure solver and $\\beta_p$ is the corresponding per-degree-of-freedom-per-iteration cost constant.\n- Explicit velocity correction and flux updates per corrector cost $C_{c} = \\gamma n$.\n\nAssume all assembly and linear-solve costs scale linearly with $n$, and that $k_u$, $k_p$, $\\alpha_u$, $\\alpha_p$, $\\beta_u$, $\\beta_p$, and $\\gamma$ are independent of $N$ and $M$ for the operating regime of interest. Ignore other overheads and communications.\n\nStarting from first principles regarding the algorithmic structure of SIMPLE and PISO, construct a cost-per-time-step model for both schemes in terms of $N$, $M$, $n$, $k_u$, $k_p$, $\\alpha_u$, $\\alpha_p$, $\\beta_u$, $\\beta_p$, and $\\gamma$. Using these models, derive a closed-form expression for the critical number of PISO correctors $M_{\\text{crit}}$ (as a function of the listed parameters and $N$) at which the cost per time step of PISO equals that of SIMPLE. The regime where PISO is computationally superior corresponds to strictly fewer correctors than this critical value. Provide the final expression for $M_{\\text{crit}}$. No rounding is required. Express your answer as a single analytic expression without units.", "solution": "The problem requires the derivation of a closed-form expression for the critical number of PISO correctors, $M_{\\text{crit}}$, at which the computational cost per time step of the PISO algorithm equals that of the SIMPLE algorithm. To achieve this, we must first construct a cost model for each algorithm based on its procedural structure and the provided cost components.\n\nLet $C_{\\text{SIMPLE}}$ and $C_{\\text{PISO}}$ represent the total computational cost per time step for the SIMPLE and PISO algorithms, respectively. The analysis is based on a finite-volume mesh of $n$ control volumes.\n\nFirst, we analyze the Semi-Implicit Method for Pressure-Linked Equations (SIMPLE). The SIMPLE algorithm is an iterative procedure. Within a single time step, it performs $N$ outer iterations to enforce pressure-velocity coupling. Each of these $N$ iterations involves the following sequence of operations:\n1.  Assembly and solution of themomentum equations.\n2.  Assembly and solution of the pressure-correction Poisson equation.\n3.  Correction of velocity and pressure fields.\n\nBased on the provided cost model, the cost of a single SIMPLE outer iteration is the sum of the costs of its constituent parts. The problem states a cost \"per call\" for each operation. A single loop of SIMPLE calls for one momentum matrix assembly, one momentum linear solve, one pressure Poisson matrix assembly, one pressure Poisson linear solve, and one velocity/flux correction. Therefore, the cost of one outer iteration, $C_{\\text{iter,SIMPLE}}$, is:\n$$C_{\\text{iter,SIMPLE}} = C_{A_u} + C_{S_u} + C_{A_p} + C_{S_p} + C_{c}$$\nSubstituting the given expressions for each cost component:\n$$C_{\\text{iter,SIMPLE}} = (\\alpha_u n) + (\\beta_u n k_u) + (\\alpha_p n) + (\\beta_p n k_p) + (\\gamma n)$$\n$$C_{\\text{iter,SIMPLE}} = n (\\alpha_u + \\beta_u k_u + \\alpha_p + \\beta_p k_p + \\gamma)$$\nThe total cost for SIMPLE per time step is the cost of one iteration multiplied by the number of iterations, $N$:\n$$C_{\\text{SIMPLE}} = N \\cdot C_{\\text{iter,SIMPLE}} = N n (\\alpha_u + \\beta_u k_u + \\alpha_p + \\beta_p k_p + \\gamma)$$\n\nNext, we analyze the Pressure-Implicit with Splitting of Operators (PISO) algorithm. For transient problems, PISO is a non-iterative, sequential procedure within a time step. It consists of one momentum predictor step followed by a series of $M$ corrector steps.\n\n1.  **Predictor Step:** This step involves a single, implicit solution of the momentum equations. The cost of this step, $C_{\\text{pred}}$, includes one momentum matrix assembly and one momentum linear solve.\n    $$C_{\\text{pred}} = C_{A_u} + C_{S_u} = \\alpha_u n + \\beta_u n k_u = n(\\alpha_u + \\beta_u k_u)$$\n\n2.  **Corrector Steps:** This is a sequence of $M$ explicit corrections. Each corrector step, as described, involves solving the pressure Poisson equation and subsequently updating the velocity and fluxes. Adhering to the \"cost per call\" model, each of the $M$ corrector steps incurs the cost of assembling the pressure matrix, solving the pressure system, and performing the explicit correction. The cost of one corrector step, $C_{\\text{corr}}$, is:\n    $$C_{\\text{corr}} = C_{A_p} + C_{S_p} + C_{c} = \\alpha_p n + \\beta_p n k_p + \\gamma n = n(\\alpha_p + \\beta_p k_p + \\gamma)$$\n\nThe total cost for PISO per time step is the sum of the predictor cost and the total cost of $M$ corrector steps:\n$$C_{\\text{PISO}} = C_{\\text{pred}} + M \\cdot C_{\\text{corr}}$$\n$$C_{\\text{PISO}} = n(\\alpha_u + \\beta_u k_u) + M n(\\alpha_p + \\beta_p k_p + \\gamma)$$\n$$C_{\\text{PISO}} = n \\left[ (\\alpha_u + \\beta_u k_u) + M (\\alpha_p + \\beta_p k_p + \\gamma) \\right]$$\n\nNow, we can find the critical number of PISO correctors, $M_{\\text{crit}}$, by equating the total costs of the two algorithms: $C_{\\text{PISO}} = C_{\\text{SIMPLE}}$ at $M = M_{\\text{crit}}$.\n$$n \\left[ (\\alpha_u + \\beta_u k_u) + M_{\\text{crit}} (\\alpha_p + \\beta_p k_p + \\gamma) \\right] = N n (\\alpha_u + \\beta_u k_u + \\alpha_p + \\beta_p k_p + \\gamma)$$\nThe common factor of $n$ (the number of control volumes) cancels from both sides, as expected, since the costs are assumed to be linear in $n$:\n$$(\\alpha_u + \\beta_u k_u) + M_{\\text{crit}} (\\alpha_p + \\beta_p k_p + \\gamma) = N (\\alpha_u + \\beta_u k_u + \\alpha_p + \\beta_p k_p + \\gamma)$$\nTo simplify the algebra, let us define two aggregate cost factors (per degree of freedom):\nLet $C_U = \\alpha_u + \\beta_u k_u$, representing the combined cost of the momentum assembly and solve.\nLet $C_P = \\alpha_p + \\beta_p k_p + \\gamma$, representing the combined cost of the pressure-corrector stage.\n\nThe equation becomes:\n$$C_U + M_{\\text{crit}} C_P = N (C_U + C_P)$$\nOur goal is to solve for $M_{\\text{crit}}$.\n$$M_{\\text{crit}} C_P = N C_U + N C_P - C_U$$\n$$M_{\\text{crit}} C_P = (N - 1) C_U + N C_P$$\nSince all cost constants ($\\alpha_u, \\beta_u, \\alpha_p, \\beta_p, \\gamma$) and iteration counts ($k_u, k_p$) are non-negative, and in practice strictly positive, $C_P = \\alpha_p + \\beta_p k_p + \\gamma > 0$. Thus, we can safely divide by $C_P$:\n$$M_{\\text{crit}} = \\frac{(N - 1) C_U}{C_P} + \\frac{N C_P}{C_P}$$\n$$M_{\\text{crit}} = N + \\frac{(N - 1) C_U}{C_P}$$\nSubstituting the original expressions for $C_U$ and $C_P$ back into this equation yields the final expression for $M_{\\text{crit}}$:\n$$M_{\\text{crit}} = N + \\frac{(N - 1) (\\alpha_u + \\beta_u k_u)}{\\alpha_p + \\beta_p k_p + \\gamma}$$\nThis expression represents the number of PISO corrector steps at which the computational cost per time step is identical to that of a SIMPLE algorithm performing $N$ outer iterations. For PISO to be more computationally efficient, the number of correctors used, $M$, must be strictly less than $M_{\\text{crit}}$.", "answer": "$$\\boxed{N + \\frac{(N - 1)(\\alpha_u + \\beta_u k_u)}{\\alpha_p + \\beta_p k_p + \\gamma}}$$", "id": "3432081"}, {"introduction": "Theoretical knowledge becomes powerful only when it can be used to solve practical problems. This exercise places you in the role of a CFD practitioner facing a common and frustrating scenario: a PISO simulation that is numerically unstable and diverging. Your task is to act as a detective, using your understanding of pressure-velocity coupling, boundary conditions, and discretization schemes to diagnose a cascade of errors and identify the comprehensive set of corrections needed to achieve a robust solution. [@problem_id:3432034]", "problem": "Consider an incompressible, constant-density transient flow governed by the incompressible Navier–Stokes equations in a two-dimensional ($2\\mathrm{D}$) channel of length $L$ and height $H$, with density $\\rho$ and kinematic viscosity $\\nu$. The governing equations are\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} + \\nabla \\cdot (\\mathbf{u}\\mathbf{u}) = -\\frac{1}{\\rho}\\nabla p + \\nu \\nabla^2 \\mathbf{u} + \\mathbf{f}, \\qquad \\nabla \\cdot \\mathbf{u} = 0,\n$$\nwhere $\\mathbf{u}$ is the velocity field, $p$ is the kinematic pressure (pressure divided by density), and $\\mathbf{f}$ is a body force. The flow is solved numerically by the Pressure-Implicit with Splitting of Operators (PISO) algorithm within a finite volume method (FVM) framework on a non-orthogonal mesh.\n\nBoundary conditions are prescribed as follows: at $x=0$ (inlet), a time-dependent velocity profile $\\mathbf{u}_{\\text{in}}(t)$ is imposed with zero normal pressure gradient; at $x=L$ (outlet), the kinematic pressure is fixed to $p=p_0$; at $y=0$ and $y=H$ (walls), no-slip and impermeability are enforced, i.e., $\\mathbf{u}=\\mathbf{0}$ and $\\mathbf{u}\\cdot \\mathbf{n}=0$. The inlet velocity is $\\mathbf{u}_{\\text{in}}(t)=\\left(U_0\\sin(\\omega t),\\,0\\right)$ with given $U_0$ and $\\omega$. The Courant number is defined as\n$$\nCo \\equiv \\max\\left(\\frac{|\\mathbf{u}|\\Delta t}{\\Delta x}\\right),\n$$\nwhere $\\Delta t$ is the time step and $\\Delta x$ a characteristic cell size.\n\nA Computational Fluid Dynamics (CFD) practitioner sets up the PISO algorithm as follows: a momentum predictor yields an intermediate velocity $\\mathbf{u}^*$, face fluxes are computed without Rhie–Chow interpolation, and the pressure correction equation is assembled with a homogeneous Neumann condition (zero normal gradient) for the pressure correction at the outlet (where $p=p_0$ is fixed), with no global pressure reference prescribed; central differencing is used for convection, and the time step is chosen such that $Co \\approx 3$. The linear solver for pressure uses a Preconditioned Conjugate Gradient (PCG) method with a simple diagonal preconditioner and a loose tolerance. The PISO corrector count is low. The simulation exhibits divergence characterized by growing pressure correction residuals and unbounded oscillations in $\\mathbf{u}$ and $p$.\n\nStarting from the incompressibility constraint and the definition of the pressure correction equation as it arises in the PISO algorithm, diagnose the primary reason for divergence in terms of boundary condition inconsistency and operator singularity. Then select the set of corrective measures that are necessary and sufficient to restore robust convergence for this transient problem. Your answer should be based on first principles and defensible reasoning regarding discrete continuity, pressure–velocity coupling, temporal stability, and linear solver behavior.\n\nWhich option correctly identifies and remedies the issue?\n\nA. Increase the number of PISO pressure correctors and switch the pressure solver to Algebraic Multigrid (AMG), leaving boundary conditions and time step unchanged. This improves the correction strength and multigrid convergence and will resolve the divergence.\n\nB. Impose a Dirichlet condition for the pressure correction $p'$ at the fixed-pressure outlet ($p'=0$ on the boundary where $p=p_0$), set a single pressure reference to remove the null space, enable Rhie–Chow interpolation for face fluxes, reduce the time step to ensure $Co \\le 0.5$, use a bounded upwind or Total Variation Diminishing scheme for convection, and increase non-orthogonal pressure correctors to ensure consistency on the non-orthogonal mesh. With these changes, the discrete pressure equation is well-posed and the transient coupling is stabilized.\n\nC. Apply strong under-relaxation to pressure in transient PISO, retain the homogeneous Neumann boundary for the pressure correction at the outlet, do not set a pressure reference, and use second-order central differencing for convection to minimize diffusion. The extra accuracy and relaxation will eliminate divergence.\n\nD. Impose zero normal velocity at the outlet to prevent backflow, add an artificial compressibility term $\\beta \\,\\partial p/\\partial t$ with $\\beta0$ to the pressure equation, and increase $\\Delta t$ to average transients. This will regularize the system and stabilize the transient evolution.\n\nE. Add a divergence damping term $\\epsilon \\nabla^2 p$ directly into the momentum equations with $\\epsilon0$, set zero-gradient pressure boundary conditions at all boundaries, and keep $Co \\approx 3$ to avoid excessive computational cost. The added diffusion of pressure will remove oscillations and allow convergence.", "solution": "The user wants me to analyze a Computational Fluid Dynamics (CFD) problem concerning the failure of a PISO simulation for a transient, incompressible flow and to identify the correct set of remedial actions.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n-   **Governing Equations**: Incompressible Navier–Stokes and continuity equations.\n    $$\n    \\frac{\\partial \\mathbf{u}}{\\partial t} + \\nabla \\cdot (\\mathbf{u}\\mathbf{u}) = -\\frac{1}{\\rho}\\nabla p + \\nu \\nabla^2 \\mathbf{u} + \\mathbf{f}\n    $$\n    $$\n    \\nabla \\cdot \\mathbf{u} = 0\n    $$\n-   **Flow Parameters**: Incompressible, constant density $\\rho$, kinematic viscosity $\\nu$.\n-   **Geometry and BCs**: $2\\mathrm{D}$ channel of length $L$, height $H$.\n    -   Inlet ($x=0$): Time-dependent velocity $\\mathbf{u}_{\\text{in}}(t)=\\left(U_0\\sin(\\omega t),\\,0\\right)$, zero normal pressure gradient ($\\partial p / \\partial n = 0$).\n    -   Outlet ($x=L$): Fixed kinematic pressure $p=p_0$.\n    -   Walls ($y=0$, $y=H$): No-slip ($\\mathbf{u}=\\mathbf{0}$).\n-   **Numerical Scheme**: Pressure-Implicit with Splitting of Operators (PISO) algorithm, Finite Volume Method (FVM), non-orthogonal mesh.\n-   **Courant number**: $Co \\equiv \\max\\left(\\frac{|\\mathbf{u}|\\Delta t}{\\Delta x}\\right)$.\n-   **Flawed Simulation Setup**:\n    1.  Face fluxes computed without Rhie–Chow interpolation.\n    2.  The pressure correction equation for $p'$ is solved with a homogeneous Neumann boundary condition ($\\partial p' / \\partial n = 0$) at the outlet ($x=L$).\n    3.  No global pressure reference is prescribed.\n    4.  Central differencing is used for the convection term.\n    5.  Time step is chosen such that $Co \\approx 3$.\n    6.  The linear solver for pressure is a Preconditioned Conjugate Gradient (PCG) method with a diagonal preconditioner and a loose tolerance.\n    7.  The PISO corrector loop count is low.\n-   **Observed Behavior**: Simulation divergence, characterized by growing pressure correction residuals and unbounded oscillations in velocity $\\mathbf{u}$ and pressure $p$.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem statement describes a faulty numerical setup for a well-defined physical problem and asks for a diagnosis and correction. The description of the setup and the resulting numerical failure modes are consistent with known pitfalls in CFD. The purpose of the problem is to test the understanding of these pitfalls. The problem is therefore scientifically grounded, well-posed (in its request), and objective. It does not violate any of the invalidity criteria. The inconsistencies are part of the scenario to be analyzed, not flaws in the problem statement itself.\n\n**Step 3: Verdict and Action**\n\nThe problem statement is **valid**. I will proceed with the derivation and analysis.\n\n### Derivation and Analysis\n\nThe PISO algorithm is a non-iterative method for time-marching solutions of the incompressible Navier–Stokes equations. It involves a predictor step followed by one or more corrector steps.\n\n1.  **Momentum Predictor**: An intermediate velocity field, $\\mathbf{u}^*$, is calculated by solving the momentum equation using the pressure field from the previous time step, $p^n$. The discretized momentum equation is of the form:\n    $$ a_P \\mathbf{u}^*_P = \\sum_{nb} a_{nb} \\mathbf{u}^*_{nb} - V \\frac{\\nabla p^n}{\\rho} + \\mathbf{b} $$\n    Here, $a_P$ and $a_{nb}$ are matrix coefficients, $V$ is the cell volume, and $\\mathbf{b}$ contains source terms and transient terms.\n\n2.  **Pressure Correction**: The predicted velocity $\\mathbf{u}^*$ does not satisfy the continuity constraint $\\nabla \\cdot \\mathbf{u} = 0$. The velocity and pressure are corrected as:\n    $$ \\mathbf{u}^{n+1} = \\mathbf{u}^* + \\mathbf{u}' $$\n    $$ p^{n+1} = p^n + p' $$\n    A simplified relation from the momentum equation links the velocity correction $\\mathbf{u}'$ to the pressure correction gradient $\\nabla p'$:\n    $$ \\mathbf{u}' \\approx -\\frac{\\Delta t}{\\rho a_P} \\nabla p' $$\n    (Note: In a more rigorous FVM context, the term is a discrete gradient operator).\n    By enforcing continuity on the corrected velocity, $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$, we obtain a Poisson equation for the pressure correction, $p'$:\n    $$ \\nabla \\cdot \\left( \\frac{\\Delta t}{\\rho a_P} \\nabla p' \\right) = \\nabla \\cdot \\mathbf{u}^* $$\n    This is the pressure correction equation that must be solved.\n\nNow, let us diagnose the flaws in the practitioner's setup based on this framework.\n\n**Flaw 1: Boundary Condition Inconsistency and Matrix Singularity**\nAt the outlet, the physical boundary condition is for the absolute pressure: $p=p_0$ (a Dirichlet condition). The corrected pressure at the new time step, $p^{n+1}$, must satisfy this condition. From the update formula $p^{n+1} = p^n + p'$, we must enforce $p^{n+1}|_{\\text{outlet}} = p_0$. This implies the boundary condition for the pressure correction $p'$ should be $p'|_{\\text{outlet}} = p_0 - p^n|_{\\text{outlet}}$. This is a **Dirichlet boundary condition** for $p'$. A common and acceptable simplification is to set $p'=0$ at the fixed-pressure boundary.\nThe practitioner, however, imposes a **homogeneous Neumann condition** ($\\partial p' / \\partial n = 0$) at the outlet. This is incorrect and inconsistent with the primary boundary condition. At the inlet and walls, the pressure boundary condition is Neumann, which translates to a Neumann condition for $p'$. By incorrectly specifying a Neumann condition for $p'$ at the outlet as well, the practitioner has set up a Poisson problem for $p'$ with pure Neumann conditions on all boundaries. The resulting linear system is **singular**: its solution is unique only up to an additive constant, and a solution exists only if the source term (the divergence of $\\mathbf{u}^*$) integrates to zero over the domain, a condition not generally met. To solve such a singular system, one must remove the null space, typically by setting the pressure correction value at a reference cell ($p'_{ref}=0$). The problem states \"no global pressure reference prescribed\". This combination is the principal cause of the divergence of the pressure solver and the \"growing pressure correction residuals\".\n\n**Flaw 2: Pressure–Velocity Decoupling**\nOn a collocated grid (where pressure and velocity components are stored at the same location, i.e., cell centers), naive interpolation of cell-center velocities to faces to compute mass fluxes can lead to a loss of coupling between adjacent pressure nodes. This allows for non-physical, high-frequency \"checkerboard\" oscillations to appear in the pressure field without being seen by the momentum equation. **Rhie–Chow interpolation** is the standard remedy. It modifies the face velocity calculation to include a term proportional to the pressure difference across the face, effectively introducing a pressure-smoothing dissipation that prevents these oscillations. The failure to use Rhie-Chow interpolation is a direct cause of the observed \"unbounded oscillations\".\n\n**Flaw 3: Convective and Temporal Instability**\n-   **Central Differencing**: This scheme is second-order accurate but is non-dissipative. For convection-dominated flows (high cell Peclet number, $Pe = |\\mathbf{u}|\\Delta x / \\nu  2$), it notoriously generates unphysical oscillations.\n-   **Courant Number $Co \\approx 3$**: While PISO is semi-implicit and can be stable for $Co  1$, a high Courant number introduces large temporal truncation errors. More critically, when combined with a non-dissipative spatial scheme like central differencing, it creates an unstable formulation where any small perturbation can grow. For robust and accurate transient simulations, especially with complex dynamics, $Co \\le 1$ is a standard guideline. Bounded, high-resolution schemes (e.g., TVD, NVD) or blended/upwind schemes are required to control oscillations when central differencing is not appropriate.\n\n**Flaw 4: Non-Orthogonal Corrections**\nOn non-orthogonal meshes, the discretization of the pressure Laplacian generates cross-derivative terms that are typically treated explicitly as a source term. The PISO algorithm's multiple corrector steps are designed to iteratively account for these terms and other implicitness errors. A \"low PISO corrector count\" is insufficient to achieve this, leading to a violation of discrete mass conservation and contributing to instability.\n\n### Option-by-Option Analysis\n\n**A. Increase the number of PISO pressure correctors and switch the pressure solver to Algebraic Multigrid (AMG), leaving boundary conditions and time step unchanged. This improves the correction strength and multigrid convergence and will resolve the divergence.**\n-   Increasing PISO correctors and using AMG are good practices. AMG is a powerful solver. However, this option fails to address the fundamental flaws: the inconsistent boundary condition for $p'$ (which makes the system singular), the lack of Rhie-Chow interpolation, and the use of an unstable convection scheme at a high Courant number. A better solver cannot fix a fundamentally ill-posed problem; it may just find the non-unique, garbage solution more quickly or diverge more spectacularly.\n-   Verdict: **Incorrect**.\n\n**B. Impose a Dirichlet condition for the pressure correction $p'$ at the fixed-pressure outlet ($p'=0$ on the boundary where $p=p_0$), set a single pressure reference to remove the null space, enable Rhie–Chow interpolation for face fluxes, reduce the time step to ensure $Co \\le 0.5$, use a bounded upwind or Total Variation Diminishing scheme for convection, and increase non-orthogonal pressure correctors to ensure consistency on the non-orthogonal mesh. With these changes, the discrete pressure equation is well-posed and the transient coupling is stabilized.**\n-   This option presents a comprehensive and correct set of remedies.\n    -   `Impose a Dirichlet condition for p'`: Fixes the inconsistent BC and makes the $p'$ matrix non-singular.\n    -   `set a single pressure reference`: While applying the Dirichlet BC for $p'$ makes a reference point redundant, this statement correctly acknowledges the need to address the singularity that existed in the original faulty setup.\n    -   `enable Rhie–Chow interpolation`: Fixes the pressure-velocity decoupling.\n    -   `reduce the time step to ensure Co = 0.5` and `use a bounded ... scheme for convection`: These two actions work together to ensure both temporal accuracy and stability by controlling convective instabilities.\n    -   `increase non-orthogonal pressure correctors`: Addresses the errors on the non-orthogonal mesh.\n-   This set of measures is both necessary and sufficient to ensure a robust and stable simulation.\n-   Verdict: **Correct**.\n\n**C. Apply strong under-relaxation to pressure in transient PISO, retain the homogeneous Neumann boundary for the pressure correction at the outlet, do not set a pressure reference, and use second-order central differencing for convection to minimize diffusion. The extra accuracy and relaxation will eliminate divergence.**\n-   Applying strong under-relaxation to pressure in PISO effectively turns it into a SIMPLE-family algorithm and destroys its transient accuracy, as it is designed to be non-iterative within a time step.\n-   Retaining the Neumann BC for $p'$ and no pressure reference leaves the fatal matrix singularity unresolved.\n-   Retaining central differencing leaves the convective instability issue unresolved. This option is a collection of bad advice.\n-   Verdict: **Incorrect**.\n\n**D. Impose zero normal velocity at the outlet to prevent backflow, add an artificial compressibility term $\\beta \\,\\partial p/\\partial t$ with $\\beta0$ to the pressure equation, and increase $\\Delta t$ to average transients. This will regularize the system and stabilize the transient evolution.**\n-   Imposing zero normal velocity at the outlet fundamentally changes the physical problem from a channel flow to something else and conflicts with the fixed-pressure outlet.\n-   Adding an artificial compressibility term is a valid technique for *certain classes* of methods, but it is not a fix for the PISO algorithm; it changes the system of equations entirely.\n-   Increasing $\\Delta t$ will likely worsen, not improve, stability.\n-   This option proposes abandoning the problem for a different one and using techniques unrelated to fixing PISO.\n-   Verdict: **Incorrect**.\n\n**E. Add a divergence damping term $\\epsilon \\nabla^2 p$ directly into the momentum equations with $\\epsilon0$, set zero-gradient pressure boundary conditions at all boundaries, and keep $Co \\approx 3$ to avoid excessive computational cost. The added diffusion of pressure will remove oscillations and allow convergence.**\n-   Adding an arbitrary $\\epsilon \\nabla^2 p$ term is an ad-hoc, non-physical modification.\n-   Setting zero-gradient pressure on all boundaries for a flow with a net inlet creates an ill-posed physical problem where mass conservation cannot be satisfied globally. It also guarantees a singular pressure matrix.\n-   Keeping $Co \\approx 3$ retains a source of instability. This option is physically and numerically nonsensical.\n-   Verdict: **Incorrect**.", "answer": "$$\\boxed{B}$$", "id": "3432034"}, {"introduction": "The pressure-correction step is the heart of the PISO algorithm, but what is its precise mathematical function? This practice delves into the fundamental nature of the corrector step, revealing it as a projection operator that cleanses the velocity field of its non-physical, compressible components. Using Fourier analysis on a single mode of error introduced by the predictor step, you will derive exactly how this projection redistributes error, showing which parts are eliminated and which persist. [@problem_id:3432037]", "problem": "Consider a transient, incompressible flow of constant density $\\rho$ in a triply periodic domain, advanced in time by the Pressure-Implicit with Splitting of Operators (PISO) algorithm. Let the time step be $\\Delta t$, and denote by $\\mathbf{u}^{*}$ the velocity after the predictor step at time level $n+1$, which differs from the exact divergence-free velocity $\\mathbf{u}^{n+1}$ due to truncation error. Define the predictor truncation error field $\\mathbf{e}_{\\mathrm{pred}}$ by $\\mathbf{u}^{*} = \\mathbf{u}^{n+1} + \\mathbf{e}_{\\mathrm{pred}}$. The pressure correction step updates the velocity by subtracting a pressure-gradient increment to enforce incompressibility at time level $n+1$. Assume viscosity is neglected during the correction step and that the pressure increment is chosen to enforce the divergence-free constraint.\n\nUsing only the incompressibility constraint $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$, the definition of the pressure correction step as a velocity update by a gradient field, and Fourier analysis in a periodic domain, perform an error transport analysis for a single Fourier mode of the predictor truncation error. Specifically, consider $\\mathbf{e}_{\\mathrm{pred}}(\\mathbf{x}) = \\mathbf{a} \\exp(i \\mathbf{k} \\cdot \\mathbf{x})$ with constant amplitude vector $\\mathbf{a} \\in \\mathbb{C}^{3}$ and wavevector $\\mathbf{k} \\in \\mathbb{R}^{3} \\setminus \\{\\mathbf{0}\\}$. Derive the redistribution of $\\mathbf{e}_{\\mathrm{pred}}$ caused by the pressure correction and compute the fraction of the kinetic energy of the error mode that remains in the corrected velocity after the first pressure correction. Express your final answer as a closed-form analytic expression in terms of the angle $\\theta$ between $\\mathbf{a}$ and $\\mathbf{k}$, defined by $\\cos \\theta = \\dfrac{\\mathbf{k} \\cdot \\mathbf{a}}{\\|\\mathbf{k}\\| \\, \\|\\mathbf{a}\\|}$. No numerical approximation is required; provide an exact expression. The final answer should have no units.", "solution": "The user wants me to analyze the effect of the PISO algorithm's first pressure correction step on a single Fourier mode of the predictor-step truncation error.\n\n### Step 1: Extract Givens\n- Flow is transient, incompressible, with constant density $\\rho$.\n- The domain is triply periodic.\n- The time step is $\\Delta t$.\n- The predicted velocity at time level $n+1$ is $\\mathbf{u}^{*}$.\n- The exact, divergence-free velocity at time level $n+1$ is $\\mathbf{u}^{n+1}$.\n- The predictor truncation error is $\\mathbf{e}_{\\mathrm{pred}}$, defined by $\\mathbf{u}^{*} = \\mathbf{u}^{n+1} + \\mathbf{e}_{\\mathrm{pred}}$.\n- The incompressibility constraint is $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$.\n- The pressure correction step updates the velocity by subtracting a pressure-gradient increment to enforce incompressibility. Viscosity is neglected in this step.\n- The predictor truncation error is a single Fourier mode: $\\mathbf{e}_{\\mathrm{pred}}(\\mathbf{x}) = \\mathbf{a} \\exp(i \\mathbf{k} \\cdot \\mathbf{x})$, with $\\mathbf{a} \\in \\mathbb{C}^{3}$ and $\\mathbf{k} \\in \\mathbb{R}^{3} \\setminus \\{\\mathbf{0}\\}$.\n- The angle $\\theta$ between $\\mathbf{a}$ and $\\mathbf{k}$ is defined by $\\cos \\theta = \\dfrac{\\mathbf{k} \\cdot \\mathbf{a}}{\\|\\mathbf{k}\\| \\, \\|\\mathbf{a}\\|}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the principles of computational fluid dynamics, specifically the analysis of projection methods like PISO. The use of Fourier analysis in a periodic domain is a standard technique for studying the properties of numerical schemes. The problem is well-posed, objective, and self-contained, providing all necessary definitions to proceed.\n\nThere is a minor ambiguity in the problem statement. It specifies the amplitude vector $\\mathbf{a} \\in \\mathbb{C}^{3}$ but defines the angle $\\theta$ using a formula, $\\cos \\theta = \\frac{\\mathbf{k} \\cdot \\mathbf{a}}{\\|\\mathbf{k}\\| \\|\\mathbf{a}\\|}$, which is standard for real vectors. If $\\mathbf{a}$ is a general complex vector, the term $\\mathbf{k} \\cdot \\mathbf{a}$ is complex, which implies a complex angle $\\theta$, and the physical interpretation is less direct. However, the structure of the problem strongly suggests a geometric interpretation based on real-vector projection. This ambiguity can be resolved by interpreting the problem as either a case where $\\mathbf{a}$ is a real vector (a subset of $\\mathbb{C}^3$) or by recognizing that the final energy ratio depends on $|\\mathbf{k} \\cdot \\mathbf{a}|^2$. Under the assumption that $\\mathbf{k} \\cdot \\mathbf{a}$ is real, which is necessary for $\\theta$ to be a real angle, the problem is perfectly consistent. This is a reasonable interpretation that aligns with the physical context. Thus, the problem is deemed valid.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will proceed with the solution.\n\n### Solution Derivation\nThe PISO algorithm's pressure correction step is designed to project a velocity field onto the space of divergence-free fields. Let the velocity field after the predictor step be $\\mathbf{u}^{*}$. The first correction step computes a corrected velocity, let's call it $\\mathbf{u}^{**}$, by removing the gradient part of $\\mathbf{u}^{*}$. This is achieved by subtracting the gradient of a scalar field, which we can denote as $\\phi$.\n$$\n\\mathbf{u}^{**} = \\mathbf{u}^{*} - \\nabla\\phi\n$$\nThe scalar field $\\phi$ (proportional to the pressure correction) is determined by enforcing the divergence-free condition on the corrected velocity, $\\nabla \\cdot \\mathbf{u}^{**} = 0$.\n$$\n\\nabla \\cdot (\\mathbf{u}^{*} - \\nabla\\phi) = 0\n$$\nThis leads to a Poisson-type equation for $\\phi$:\n$$\n\\nabla^2\\phi = \\nabla \\cdot \\mathbf{u}^{*}\n$$\nThe problem states the relationship between the predicted velocity $\\mathbf{u}^{*}$, the exact divergence-free velocity $\\mathbf{u}^{n+1}$, and the predictor error $\\mathbf{e}_{\\mathrm{pred}}$:\n$$\n\\mathbf{u}^{*} = \\mathbf{u}^{n+1} + \\mathbf{e}_{\\mathrm{pred}}\n$$\nGiven that the exact velocity is divergence-free, $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$, we can express the divergence of the predicted velocity entirely in terms of the error:\n$$\n\\nabla \\cdot \\mathbf{u}^{*} = \\nabla \\cdot (\\mathbf{u}^{n+1} + \\mathbf{e}_{\\mathrm{pred}}) = \\nabla \\cdot \\mathbf{u}^{n+1} + \\nabla \\cdot \\mathbf{e}_{\\mathrm{pred}} = \\nabla \\cdot \\mathbf{e}_{\\mathrm{pred}}\n$$\nThe Poisson equation for $\\phi$ is thus driven by the divergence of the predictor error:\n$$\n\\nabla^2\\phi = \\nabla \\cdot \\mathbf{e}_{\\mathrm{pred}}\n$$\nThe error in the corrected velocity field, $\\mathbf{e}_{\\mathrm{corr}} = \\mathbf{u}^{**} - \\mathbf{u}^{n+1}$, is found by substituting the expressions for $\\mathbf{u}^{**}$ and $\\mathbf{u}^{*}$:\n$$\n\\mathbf{e}_{\\mathrm{corr}} = (\\mathbf{u}^{*} - \\nabla\\phi) - \\mathbf{u}^{n+1} = (\\mathbf{u}^{n+1} + \\mathbf{e}_{\\mathrm{pred}} - \\nabla\\phi) - \\mathbf{u}^{n+1} = \\mathbf{e}_{\\mathrm{pred}} - \\nabla\\phi\n$$\nThis demonstrates that the pressure correction step modifies the error field by removing its gradient component. We now analyze this process for the given single Fourier mode error, $\\mathbf{e}_{\\mathrm{pred}}(\\mathbf{x}) = \\mathbf{a} \\exp(i \\mathbf{k} \\cdot \\mathbf{x})$.\n\nFirst, we compute the divergence of the error mode:\n$$\n\\nabla \\cdot \\mathbf{e}_{\\mathrm{pred}} = \\nabla \\cdot (\\mathbf{a} \\exp(i \\mathbf{k} \\cdot \\mathbf{x})) = \\mathbf{a} \\cdot \\nabla(\\exp(i \\mathbf{k} \\cdot \\mathbf{x})) = \\mathbf{a} \\cdot (i\\mathbf{k}) \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) = i(\\mathbf{k} \\cdot \\mathbf{a})\\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\nThe Poisson equation becomes:\n$$\n\\nabla^2\\phi = i(\\mathbf{k} \\cdot \\mathbf{a})\\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\nAssuming a solution of the form $\\phi(\\mathbf{x}) = \\hat{\\phi} \\exp(i \\mathbf{k} \\cdot \\mathbf{x})$, where $\\hat{\\phi}$ is the Fourier coefficient, we apply the Laplacian operator:\n$$\n\\nabla^2 (\\hat{\\phi} \\exp(i \\mathbf{k} \\cdot \\mathbf{x})) = \\hat{\\phi} (i\\mathbf{k}) \\cdot (i\\mathbf{k}) \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) = -\\hat{\\phi} \\|\\mathbf{k}\\|^2 \\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\nSubstituting this into the Poisson equation and solving for $\\hat{\\phi}$:\n$$\n-\\hat{\\phi} \\|\\mathbf{k}\\|^2 \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) = i(\\mathbf{k} \\cdot \\mathbf{a})\\exp(i \\mathbf{k} \\cdot \\mathbf{x}) \\implies \\hat{\\phi} = -\\frac{i(\\mathbf{k} \\cdot \\mathbf{a})}{\\|\\mathbf{k}\\|^2}\n$$\nNow we find the gradient term $\\nabla\\phi$ that is removed from the error:\n$$\n\\nabla\\phi = \\nabla(\\hat{\\phi} \\exp(i \\mathbf{k} \\cdot \\mathbf{x})) = i\\mathbf{k} \\hat{\\phi} \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) = i\\mathbf{k} \\left( -\\frac{i(\\mathbf{k} \\cdot \\mathbf{a})}{\\|\\mathbf{k}\\|^2} \\right) \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) = \\frac{(\\mathbf{k} \\cdot \\mathbf{a})}{\\|\\mathbf{k}\\|^2} \\mathbf{k} \\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\nThe corrected error field $\\mathbf{e}_{\\mathrm{corr}}$ is:\n$$\n\\mathbf{e}_{\\mathrm{corr}} = \\mathbf{e}_{\\mathrm{pred}} - \\nabla\\phi = \\mathbf{a} \\exp(i \\mathbf{k} \\cdot \\mathbf{x}) - \\frac{(\\mathbf{k} \\cdot \\mathbf{a})}{\\|\\mathbf{k}\\|^2} \\mathbf{k} \\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\nFactoring out the exponential term, we get the amplitude of the corrected error:\n$$\n\\mathbf{e}_{\\mathrm{corr}} = \\left( \\mathbf{a} - \\frac{(\\mathbf{k} \\cdot \\mathbf{a})}{\\|\\mathbf{k}\\|^2} \\mathbf{k} \\right) \\exp(i \\mathbf{k} \\cdot \\mathbf{x})\n$$\nThe term in parentheses is the original amplitude vector $\\mathbf{a}$ minus its projection onto the wavevector $\\mathbf{k}$. This is the component of $\\mathbf{a}$ orthogonal to $\\mathbf{k}$.\n\nThe kinetic energy of a velocity field represented by a single Fourier mode $\\mathbf{v}(\\mathbf{x}) = \\mathbf{c} \\exp(i \\mathbf{k} \\cdot \\mathbf{x})$ in a periodic domain of volume $V$ is proportional to the integral of its squared norm, $E \\propto \\int_V \\|\\mathbf{v}(\\mathbf{x})\\|^2 dV$. Since $\\|\\mathbf{v}(\\mathbf{x})\\|^2 = (\\mathbf{c}e^{i\\mathbf{k}\\cdot\\mathbf{x}}) \\cdot (\\mathbf{c}^*e^{-i\\mathbf{k}\\cdot\\mathbf{x}}) = \\|\\mathbf{c}\\|^2$, the energy is $E \\propto \\|\\mathbf{c}\\|^2 V$. Therefore, the ratio of kinetic energies is the ratio of the squared norms of their respective amplitude vectors.\n\nThe energy of the predictor error is $E_{\\mathrm{pred}} \\propto \\|\\mathbf{a}\\|^2$.\nThe amplitude of the corrected error is $\\mathbf{a}_{\\perp} = \\mathbf{a} - \\frac{(\\mathbf{k} \\cdot \\mathbf{a})}{\\|\\mathbf{k}\\|^2} \\mathbf{k}$. The energy of the corrected error is $E_{\\mathrm{corr}} \\propto \\|\\mathbf{a}_{\\perp}\\|^2$.\nThe fraction of remaining kinetic energy is:\n$$\n\\frac{E_{\\mathrm{corr}}}{E_{\\mathrm{pred}}} = \\frac{\\|\\mathbf{a}_{\\perp}\\|^2}{\\|\\mathbf{a}\\|^2}\n$$\nThe vector $\\mathbf{a}$ can be decomposed into components parallel and perpendicular to $\\mathbf{k}$: $\\mathbf{a} = \\mathbf{a}_{\\|} + \\mathbf{a}_{\\perp}$, where $\\mathbf{a}_{\\|} = \\frac{(\\mathbf{k} \\cdot \\mathbf{a})}{\\|\\mathbf{k}\\|^2} \\mathbf{k}$. These components are orthogonal. By the Pythagorean theorem, $\\|\\mathbf{a}\\|^2 = \\|\\mathbf{a}_{\\|}\\|^2 + \\|\\mathbf{a}_{\\perp}\\|^2$.\nThus, $\\|\\mathbf{a}_{\\perp}\\|^2 = \\|\\mathbf{a}\\|^2 - \\|\\mathbf{a}_{\\|}\\|^2$.\nWe compute the squared norm of the parallel component. Based on the reasoning in the validation step, we treat $\\mathbf{a}$ as a real vector to be consistent with the definition of $\\theta$.\n$$\n\\|\\mathbf{a}_{\\|}\\|^2 = \\left\\| \\frac{(\\mathbf{k} \\cdot \\mathbf{a})}{\\|\\mathbf{k}\\|^2} \\mathbf{k} \\right\\|^2 = \\frac{(\\mathbf{k} \\cdot \\mathbf{a})^2}{\\|\\mathbf{k}\\|^4} \\|\\mathbf{k}\\|^2 = \\frac{(\\mathbf{k} \\cdot \\mathbf{a})^2}{\\|\\mathbf{k}\\|^2}\n$$\nThe fraction of remaining energy is:\n$$\n\\frac{E_{\\mathrm{corr}}}{E_{\\mathrm{pred}}} = \\frac{\\|\\mathbf{a}\\|^2 - \\|\\mathbf{a}_{\\|}\\|^2}{\\|\\mathbf{a}\\|^2} = 1 - \\frac{\\|\\mathbf{a}_{\\|}\\|^2}{\\|\\mathbf{a}\\|^2} = 1 - \\frac{(\\mathbf{k} \\cdot \\mathbf{a})^2}{\\|\\mathbf{k}\\|^2 \\|\\mathbf{a}\\|^2}\n$$\nThe problem defines $\\cos\\theta = \\dfrac{\\mathbf{k} \\cdot \\mathbf{a}}{\\|\\mathbf{k}\\| \\, \\|\\mathbf{a}\\|}$. Substituting this definition:\n$$\n\\frac{E_{\\mathrm{corr}}}{E_{\\mathrm{pred}}} = 1 - (\\cos\\theta)^2 = 1 - \\cos^2\\theta\n$$\nUsing the fundamental trigonometric identity $\\sin^2\\theta + \\cos^2\\theta = 1$, the fraction simplifies to:\n$$\n\\frac{E_{\\mathrm{corr}}}{E_{\\mathrm{pred}}} = \\sin^2\\theta\n$$\nThis result shows that the pressure-correction projection eliminates the longitudinal part of the error mode (for which $\\theta = 0$) and preserves the transverse, or solenoidal, part of the error mode (for which $\\theta = \\pi/2$).", "answer": "$$\n\\boxed{\\sin^2(\\theta)}\n$$", "id": "3432037"}]}