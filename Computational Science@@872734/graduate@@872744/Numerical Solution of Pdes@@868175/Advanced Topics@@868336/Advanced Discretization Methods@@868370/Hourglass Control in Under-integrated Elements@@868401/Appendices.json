{"hands_on_practices": [{"introduction": "This practice takes us to the theoretical core of what constitutes an hourglass mode. We will explore how, for an under-integrated element, certain nodal displacement patterns can produce zero strain at the single integration point, rendering them invisible to the element's stiffness calculation. By working through the mathematics for a standard three-dimensional hexahedral element, you will translate the abstract condition of a zero-gradient state into a concrete set of orthogonal \"hourglass vectors\" that form the basis for these spurious modes. [@problem_id:3404228]", "problem": "Consider the standard trilinear eight-node hexahedral element (often denoted $Q1$) on the reference domain $[-1,1]^{3}$ with natural coordinates $(\\xi,\\eta,\\zeta)$ and nodes located at $(\\xi_{i},\\eta_{i},\\zeta_{i}) \\in \\{-1,1\\}^{3}$ for $i=1,\\dots,8$. The element is assumed to be undistorted with a constant Jacobian mapping to the physical space so that, at the element center $(\\xi,\\eta,\\zeta)=(0,0,0)$, physical and natural gradients coincide up to a constant diagonal scaling. Let the scalar shape functions be\n$$\nN_{i}(\\xi,\\eta,\\zeta) = \\frac{1}{8}\\left(1+\\xi\\,\\xi_{i}\\right)\\left(1+\\eta\\,\\eta_{i}\\right)\\left(1+\\zeta\\,\\zeta_{i}\\right),\\quad i=1,\\dots,8.\n$$\nDefine a discrete scalar field $a(\\xi,\\eta,\\zeta) = \\sum_{i=1}^{8} a_{i} N_{i}(\\xi,\\eta,\\zeta)$ from nodal values $\\{a_{i}\\}_{i=1}^{8}$. In one-point (reduced) integration, the hourglass subspace associated with under-integration is characterized by nodal patterns $\\{a_{i}\\}$ that produce zero gradient at the element center, that is,\n$$\n\\nabla a(0,0,0) = \\mathbf{0}.\n$$\nStarting from the definition of $N_{i}$, first derive the conditions on $\\{a_{i}\\}$ for which $\\nabla a(0,0,0)=\\mathbf{0}$, and use them to construct four independent scalar nodal patterns $\\{a_{i}^{(\\alpha)}\\}_{i=1}^{8}$ that satisfy this property. Then embed these scalar patterns into three-dimensional displacement fields to obtain eight independent vector-valued hourglass modes $\\{\\mathbf{H}^{(\\alpha)}\\}_{\\alpha=1}^{8}$ in $\\mathbb{R}^{24}$ by assigning each scalar pattern entirely to a single Cartesian displacement component (for example, use two distinct components to obtain eight vectors from four scalar patterns). \n\nLet the inner product on nodal displacement vectors $\\mathbf{u},\\mathbf{v} \\in \\mathbb{R}^{24}$ be the lumped-mass inner product with equal nodal weights, which (up to a positive constant scaling common to all modes) is equivalent to\n$$\n\\langle \\mathbf{u},\\mathbf{v}\\rangle \\equiv \\sum_{i=1}^{8} \\mathbf{u}_{i}\\cdot \\mathbf{v}_{i},\n$$\nwhere $\\mathbf{u}_{i},\\mathbf{v}_{i}\\in\\mathbb{R}^{3}$ are the displacement vectors at node $i$. Scale each hourglass vector by a common positive factor $s$ so that the set $\\{s\\,\\mathbf{H}^{(\\alpha)}\\}_{\\alpha=1}^{8}$ is orthonormal under $\\langle \\cdot,\\cdot\\rangle$.\n\nProvide the exact value of $s$ as a closed-form expression. No numerical rounding is required. The final answer must be a single real-valued expression.", "solution": "The problem requires finding a scaling factor $s$ to orthonormalize a set of $8$ specific hourglass modes for a trilinear hexahedral element. The solution proceeds in several steps: first, deriving the condition for a nodal pattern to be an hourglass mode; second, constructing a set of $4$ independent scalar hourglass patterns; third, embedding these into $8$ vector displacement modes; and finally, calculating the scaling factor required for orthonormality under the specified inner product.\n\nStep 1: Derive the hourglass condition.\nA scalar field $a$ is defined on the element by $a(\\xi,\\eta,\\zeta) = \\sum_{i=1}^{8} a_{i} N_{i}(\\xi,\\eta,\\zeta)$, where $\\{a_{i}\\}_{i=1}^{8}$ are nodal values and $N_{i}$ are the trilinear shape functions:\n$$N_{i}(\\xi,\\eta,\\zeta) = \\frac{1}{8}\\left(1+\\xi\\,\\xi_{i}\\right)\\left(1+\\eta\\,\\eta_{i}\\right)\\left(1+\\zeta\\,\\zeta_{i}\\right)$$\nThe nodes $i=1,\\dots,8$ are located at positions $(\\xi_{i},\\eta_{i},\\zeta_{i})$ with coordinates in $\\{-1,1\\}$. The hourglass condition is that the gradient of the field $a$ is zero at the element center $(\\xi,\\eta,\\zeta)=(0,0,0)$. We compute the gradient of $a$ with respect to the natural coordinates $(\\xi,\\eta,\\zeta)$:\n$$ \\nabla a = \\left( \\frac{\\partial a}{\\partial \\xi}, \\frac{\\partial a}{\\partial \\eta}, \\frac{\\partial a}{\\partial \\zeta} \\right) = \\sum_{i=1}^{8} a_i \\nabla N_i(\\xi, \\eta, \\zeta) $$\nThe gradient of a shape function $N_i$ is:\n$$ \\nabla N_i = \\frac{1}{8} \\left( \\xi_i(1+\\eta\\eta_i)(1+\\zeta\\zeta_i), \\eta_i(1+\\xi\\xi_i)(1+\\zeta\\zeta_i), \\zeta_i(1+\\xi\\xi_i)(1+\\eta\\eta_i) \\right) $$\nEvaluating this at the element center $(0,0,0)$:\n$$ \\nabla N_i(0,0,0) = \\frac{1}{8} (\\xi_i, \\eta_i, \\zeta_i) $$\nThe gradient of the field $a$ at the center is therefore:\n$$ \\nabla a(0,0,0) = \\sum_{i=1}^{8} a_i \\left( \\frac{1}{8}(\\xi_i, \\eta_i, \\zeta_i) \\right) = \\frac{1}{8} \\left( \\sum_{i=1}^{8} a_i \\xi_i, \\sum_{i=1}^{8} a_i \\eta_i, \\sum_{i=1}^{8} a_i \\zeta_i \\right) $$\nThe hourglass condition $\\nabla a(0,0,0) = \\mathbf{0}$ thus imposes three linear constraints on the nodal values $\\{a_i\\}$:\n$$ \\sum_{i=1}^{8} a_i \\xi_i = 0 $$\n$$ \\sum_{i=1}^{8} a_i \\eta_i = 0 $$\n$$ \\sum_{i=1}^{8} a_i \\zeta_i = 0 $$\n\nStep 2: Construct four independent scalar hourglass patterns.\nWe need to find four linearly independent vectors $\\mathbf{a}^{(\\alpha)} = (a_1^{(\\alpha)}, \\dots, a_8^{(\\alpha)})^T \\in \\mathbb{R}^8$ that satisfy these three conditions. It is standard practice to choose patterns that are also orthogonal to the constant mode vector $\\mathbf{1}=(1,1,1,1,1,1,1,1)^T$, which itself satisfies the hourglass conditions. A standard orthogonal basis for the $4$-dimensional hourglass subspace is constructed from products of the nodal coordinates. Let's adopt a standard node numbering:\nNode 1: $(-1,-1,-1)$, Node 2: $(1,-1,-1)$, Node 3: $(1,1,-1)$, Node 4: $(-1,1,-1)$\nNode 5: $(-1,-1,1)$, Node 6: $(1,-1,1)$, Node 7: $(1,1,1)$, Node 8: $(-1,1,1)$\n\nThe four scalar patterns, which we denote by $\\mathbf{h}^{(\\beta)} \\in \\mathbb{R}^8$ for $\\beta=1,2,3,4$, are defined by their components at each node $i$:\n$$ h_i^{(1)} = \\xi_i \\eta_i $$\n$$ h_i^{(2)} = \\eta_i \\zeta_i $$\n$$ h_i^{(3)} = \\zeta_i \\xi_i $$\n$$ h_i^{(4)} = \\xi_i \\eta_i \\zeta_i $$\nExplicitly, these vectors are:\n$$ \\mathbf{h}^{(1)} = (1, -1, 1, -1, 1, -1, 1, -1)^T $$\n$$ \\mathbf{h}^{(2)} = (1, 1, -1, -1, -1, -1, 1, 1)^T $$\n$$ \\mathbf{h}^{(3)} = (1, -1, -1, 1, 1, -1, -1, 1)^T $$\n$$ \\mathbf{h}^{(4)} = (-1, 1, -1, 1, 1, -1, 1, -1)^T $$\nThese four vectors are linearly independent and satisfy the hourglass conditions. For example, for $\\mathbf{h}^{(1)}$, we have $\\sum_i h_i^{(1)} \\xi_i = \\sum_i (\\xi_i \\eta_i) \\xi_i = \\sum_i \\xi_i^2 \\eta_i = \\sum_i \\eta_i = 0$. The other conditions are verified similarly. These patterns are also mutually orthogonal under the standard dot product in $\\mathbb{R}^8$, a property that simplifies the final step.\n\nStep 3: Construct eight vector-valued hourglass modes.\nThe problem specifies creating $8$ vector modes $\\{\\mathbf{H}^{(\\alpha)}\\}_{\\alpha=1}^{8}$ in $\\mathbb{R}^{24}$ by assigning the $4$ scalar patterns to two distinct Cartesian components. We will use the x and y components. A vector mode $\\mathbf{H}$ is represented by the set of displacement vectors $\\{\\mathbf{H}_i\\}_{i=1}^8$ at each node, where $\\mathbf{H}_i \\in \\mathbb{R}^3$.\nFor $\\beta = 1,2,3,4$, we define the first four vector modes by assigning the scalar patterns to the x-component of displacement:\n$\\mathbf{H}^{(\\beta)}_i = (h_i^{(\\beta)}, 0, 0)$ for $i=1,\\dots,8$.\nWe define the next four vector modes by assigning the scalar patterns to the y-component:\n$\\mathbf{H}^{(\\beta+4)}_i = (0, h_i^{(\\beta)}, 0)$ for $i=1,\\dots,8$.\nThis gives a set of $8$ independent hourglass modes $\\{\\mathbf{H}^{(\\alpha)}\\}_{\\alpha=1}^8$.\n\nStep 4: Orthonormalize the set and find $s$.\nThe inner product on the space of nodal displacement vectors $\\mathbb{R}^{24}$ is given as $\\langle \\mathbf{u}, \\mathbf{v} \\rangle = \\sum_{i=1}^{8} \\mathbf{u}_i \\cdot \\mathbf{v}_i$. We need to find a positive scalar $s$ such that the set $\\{s\\mathbf{H}^{(\\alpha)}\\}$ is orthonormal, i.e., $\\langle s\\mathbf{H}^{(\\alpha)}, s\\mathbf{H}^{(\\beta)} \\rangle = \\delta_{\\alpha\\beta}$. This is equivalent to $s^2 \\langle \\mathbf{H}^{(\\alpha)}, \\mathbf{H}^{(\\beta)} \\rangle = \\delta_{\\alpha\\beta}$.\n\nLet's compute the inner products $\\langle \\mathbf{H}^{(\\alpha)}, \\mathbf{H}^{(\\beta)} \\rangle$.\nFirst, consider two modes from the first group, e.g., $\\mathbf{H}^{(j)}$ and $\\mathbf{H}^{(k)}$ with $j, k \\in \\{1,2,3,4\\}$.\n$$ \\langle \\mathbf{H}^{(j)}, \\mathbf{H}^{(k)} \\rangle = \\sum_{i=1}^{8} \\mathbf{H}_i^{(j)} \\cdot \\mathbf{H}_i^{(k)} = \\sum_{i=1}^{8} (h_i^{(j)}, 0, 0) \\cdot (h_i^{(k)}, 0, 0) = \\sum_{i=1}^{8} h_i^{(j)} h_i^{(k)} = \\mathbf{h}^{(j)} \\cdot \\mathbf{h}^{(k)} $$\nThe scalar patterns $\\{\\mathbf{h}^{(\\beta)}\\}$ are mutually orthogonal. Thus, this inner product is non-zero only if $j=k$. If $j=k$, the inner product is the squared norm of the scalar pattern:\n$$ \\|\\mathbf{h}^{(j)}\\|^2 = \\sum_{i=1}^{8} (h_i^{(j)})^2 = \\sum_{i=1}^{8} (\\pm 1)^2 = 8 $$\nSo, $\\langle \\mathbf{H}^{(j)}, \\mathbf{H}^{(k)} \\rangle = 8 \\delta_{jk}$ for $j, k \\in \\{1,2,3,4\\}$.\n\nSimilarly, for two modes from the second group, $\\mathbf{H}^{(j+4)}$ and $\\mathbf{H}^{(k+4)}$ with $j, k \\in \\{1,2,3,4\\}$:\n$$ \\langle \\mathbf{H}^{(j+4)}, \\mathbf{H}^{(k+4)} \\rangle = \\sum_{i=1}^{8} (0, h_i^{(j)}, 0) \\cdot (0, h_i^{(k)}, 0) = \\sum_{i=1}^{8} h_i^{(j)} h_i^{(k)} = \\mathbf{h}^{(j)} \\cdot \\mathbf{h}^{(k)} = 8 \\delta_{jk} $$\nThis means $\\langle \\mathbf{H}^{(\\alpha)}, \\mathbf{H}^{(\\beta)} \\rangle = 8 \\delta_{\\alpha\\beta}$ for $\\alpha, \\beta \\in \\{5,6,7,8\\}$.\n\nFinally, consider a mode from the first group and one from the second, $\\mathbf{H}^{(j)}$ and $\\mathbf{H}^{(k+4)}$:\n$$ \\langle \\mathbf{H}^{(j)}, \\mathbf{H}^{(k+4)} \\rangle = \\sum_{i=1}^{8} (h_i^{(j)}, 0, 0) \\cdot (0, h_i^{(k)}, 0) = \\sum_{i=1}^{8} 0 = 0 $$\nSo the two groups of modes are orthogonal to each other.\nCombining these results, the set of vector modes $\\{\\mathbf{H}^{(\\alpha)}\\}_{\\alpha=1}^8$ is an orthogonal set. The matrix of inner products is diagonal:\n$$ \\langle \\mathbf{H}^{(\\alpha)}, \\mathbf{H}^{(\\beta)} \\rangle = 8 \\delta_{\\alpha\\beta} $$\nThe condition for orthonormality requires that for $\\alpha=\\beta$:\n$$ s^2 \\langle \\mathbf{H}^{(\\alpha)}, \\mathbf{H}^{(\\alpha)} \\rangle = 1 $$\n$$ s^2 (8) = 1 $$\n$$ s^2 = \\frac{1}{8} $$\nSince $s$ is a positive factor, we take the positive square root:\n$$ s = \\sqrt{\\frac{1}{8}} = \\frac{1}{\\sqrt{8}} = \\frac{1}{2\\sqrt{2}} $$\nRationalizing the denominator gives:\n$$ s = \\frac{\\sqrt{2}}{4} $$\nThis is the required scaling factor.", "answer": "$$\\boxed{\\frac{\\sqrt{2}}{4}}$$", "id": "3404228"}, {"introduction": "A valid hourglass control scheme must be \"smart\" enough to penalize only non-physical deformations while remaining completely inactive during rigid-body motions. This hands-on verification exercise establishes this cornerstone principle of hourglass stabilization. You will implement a computational check to confirm that the hourglass modes are, by construction, orthogonal to all rigid-body translations and rotations, ensuring that any stabilization force derived from them will not spuriously resist legitimate physical motion. [@problem_id:3555163]", "problem": "You are asked to implement, from first principles, a verification that hourglass control forces constructed for a two-dimensional, four-node bilinear quadrilateral finite element with single-point (reduced) integration do not spuriously activate under rigid-body motions. Work in the context of the Finite Element Method (FEM) and consider linearized kinematics appropriate for small strains and small rotations. The core quantity to evaluate is an hourglass generalized coordinate vector $\\mathbf{q}_{\\alpha}$ that must vanish for any rigid-body translation and any rigid-body rotation. Your task is to define an element-level hourglass vector $\\mathbf{g}$ that annihilates all discrete fields that are linear in physical coordinates, construct $\\mathbf{q}_{\\alpha}$ for given nodal displacements, and verify that $\\lVert \\mathbf{q}_{\\alpha} \\rVert_{2}$ is zero (to numerical precision) for rigid motions.\n\nStart from the following fundamental bases:\n- Finite Element Method (FEM) interpolation completeness in physical space: any field that is linear in the physical coordinates $x$ and $y$ can be represented at the element level as $u(x,y)=a_{0}+a_{1}x+a_{2}y$.\n- Partition of unity and linear field reproduction for bilinear shape functions ensure that rigid-body translations and rigid-body rotations are linear fields in the small-rotation sense. A small rigid-body rotation by angle $\\theta$ (in radians) about a point $(x_{0},y_{0})$ induces a displacement field $\\mathbf{u}(x,y)=\\theta[-(y-y_{0}),\\,(x-x_{0})]$.\n- Reduced integration at a single quadrature point admits spurious element-level zero-energy (hourglass) modes, whose algebraic characterization can be constructed by enforcing orthogonality to the polynomial space $\\operatorname{span}\\{1,x,y\\}$ evaluated at the element nodes.\n\nDefinitions and construction:\n1. Consider a two-dimensional four-node bilinear quadrilateral with nodes indexed $i\\in\\{1,2,3,4\\}$ and physical coordinates $(x_{i},y_{i})$. Define the $4\\times 3$ matrix\n   $$\\mathbf{P}=\\begin{bmatrix}\n   1 & x_{1} & y_{1}\\\\\n   1 & x_{2} & y_{2}\\\\\n   1 & x_{3} & y_{3}\\\\\n   1 & x_{4} & y_{4}\n   \\end{bmatrix}.$$\n   Let $\\mathbf{g}\\in\\mathbb{R}^{4}$ be any nonzero vector satisfying\n   $$\\mathbf{P}^{\\top}\\mathbf{g}=\\mathbf{0},$$\n   and then normalize it to unit Euclidean norm so that $\\lVert \\mathbf{g}\\rVert_{2}=1$. This choice enforces discrete orthogonality to all linear fields in $x$ and $y$ and to constants, independently of element distortion. You may compute $\\mathbf{g}$ by taking the left nullspace of $\\mathbf{P}$, for example via a singular value decomposition.\n2. For nodal displacements $\\{\\mathbf{u}_{i}\\}_{i=1}^{4}$ with components $\\mathbf{u}_{i}=[u_{i}^{x},u_{i}^{y}]^{\\top}$, define the hourglass generalized coordinates\n   $$q_{x}=\\sum_{i=1}^{4}g_{i}\\,u_{i}^{x},\\qquad q_{y}=\\sum_{i=1}^{4}g_{i}\\,u_{i}^{y},\\qquad \\mathbf{q}_{\\alpha}=\\begin{bmatrix}q_{x}\\\\ q_{y}\\end{bmatrix}.$$\n   The hourglass control forces are proportional to $\\mathbf{q}_{\\alpha}$ in many schemes, so verifying $\\mathbf{q}_{\\alpha}=\\mathbf{0}$ under rigid motions ensures no spurious control forces for such motions.\n3. Verification target: Show numerically that $\\lVert \\mathbf{q}_{\\alpha}\\rVert_{2}=0$ (up to floating-point tolerance) for rigid-body translations and rotations, and that $\\lVert \\mathbf{q}_{\\alpha}\\rVert_{2}\\neq 0$ for a non-rigid hourglass-like pattern.\n\nAlgorithmic instructions your program must implement:\n- Given node coordinates $\\{(x_{i},y_{i})\\}_{i=1}^{4}$, construct $\\mathbf{P}$, compute a unit-norm vector $\\mathbf{g}$ in the left nullspace of $\\mathbf{P}$ (equivalently, the nullspace of $\\mathbf{P}^{\\top}$), and then evaluate $\\mathbf{q}_{\\alpha}$ for each specified displacement pattern.\n- Rigid-body translation by a vector $\\mathbf{t}=[t_{x},t_{y}]^{\\top}$ assigns $u_{i}^{x}=t_{x}$ and $u_{i}^{y}=t_{y}$ for all nodes $i$.\n- Small rigid-body rotation by angle $\\theta$ (angle specified in radians) about a chosen center $(x_{0},y_{0})$ assigns\n  $$u_{i}^{x}=\\theta\\left(-(y_{i}-y_{0})\\right),\\qquad u_{i}^{y}=\\theta\\left(x_{i}-x_{0}\\right).$$\n- Non-rigid hourglass-like displacement for a specific element uses the computed $\\mathbf{g}$ itself: assign $u_{i}^{x}=g_{i}$ and $u_{i}^{y}=-2g_{i}$ for all nodes $i$.\n\nTest suite:\n- Test case $1$ (translation on a general convex quadrilateral):\n  - Nodes: $\\{(0.0,0.0),(3.0,0.2),(2.7,1.8),(-0.1,1.5)\\}$.\n  - Displacement: translation $\\mathbf{t}=[0.7,-1.1]$.\n  - Output: the scalar $\\lVert \\mathbf{q}_{\\alpha}\\rVert_{2}$.\n- Test case $2$ (rotation about centroid on the same quadrilateral):\n  - Nodes: as in Test case $1$.\n  - Rotation center: centroid $(x_{0},y_{0})$ equal to the arithmetic mean of nodal coordinates.\n  - Angle: $\\theta=0.1$ radians.\n  - Output: the scalar $\\lVert \\mathbf{q}_{\\alpha}\\rVert_{2}$.\n- Test case $3$ (rotation about an external point on a skewed quadrilateral):\n  - Nodes: $\\{(0.0,0.0),(2.0,0.1),(2.2,0.5),(0.1,1.2)\\}$.\n  - Rotation center: $(x_{0},y_{0})=(0.0,0.0)$.\n  - Angle: $\\theta=-0.35$ radians.\n  - Output: the scalar $\\lVert \\mathbf{q}_{\\alpha}\\rVert_{2}$.\n- Test case $4$ (rotation on a slender parallelogram-like quadrilateral):\n  - Nodes: $\\{(0.0,0.0),(10.0,0.02),(10.5,0.05),(0.5,0.03)\\}$.\n  - Rotation center: centroid $(x_{0},y_{0})$ equal to the arithmetic mean of nodal coordinates.\n  - Angle: $\\theta=0.2$ radians.\n  - Output: the scalar $\\lVert \\mathbf{q}_{\\alpha}\\rVert_{2}$.\n- Test case $5$ (non-rigid hourglass-like displacement on the first quadrilateral):\n  - Nodes: as in Test case $1$.\n  - Displacement: $u_{i}^{x}=g_{i}$ and $u_{i}^{y}=-2g_{i}$, where $\\mathbf{g}$ is the normalized left-nullspace vector computed for these nodes.\n  - Output: the scalar $\\lVert \\mathbf{q}_{\\alpha}\\rVert_{2}$, which should equal $\\sqrt{5}$ up to floating-point roundoff if $\\lVert \\mathbf{g}\\rVert_{2}=1$.\n\nAngle unit specification: all angles $\\theta$ must be in radians. No physical units are required for coordinates or displacements; treat them as dimensionless.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, namely $[\\text{r}_{1},\\text{r}_{2},\\text{r}_{3},\\text{r}_{4},\\text{r}_{5}]$, where $\\text{r}_{k}$ is the scalar $\\lVert \\mathbf{q}_{\\alpha}\\rVert_{2}$ for Test case $k$.\n- Each scalar must be formatted in scientific notation with exactly $12$ digits after the decimal point (for example, $1.234000000000\\mathrm{e}{-03}$). Angles are in radians by construction.\n\nYour implementation must be a complete, runnable program that carries out the construction of $\\mathbf{g}$ via linear algebra and evaluates the results for the above test suite, aggregating them in the exact output format described.", "solution": "The core of this problem is to verify a fundamental property of hourglass control schemes for under-integrated finite elements: they must not generate spurious restoring forces under rigid-body motion. For a $2$-dimensional, $4$-node quadrilateral element using a single integration point (reduced integration), the stiffness matrix becomes rank-deficient, admitting non-physical, zero-energy deformation modes known as hourglass modes. An hourglass control scheme adds a stabilization term to the element's energy to suppress these modes. This stabilization is typically proportional to a set of hourglass generalized strains or coordinates, here denoted $\\mathbf{q}_{\\alpha}$. A crucial requirement is that these generalized coordinates must be zero for any rigid-body motion. This ensures that the control mechanism only acts on the spurious modes and does not incorrectly resist rigid translations or rotations. The verification relies on the algebraic construction of the hourglass modes.\n\nIn the context of the Finite Element Method (FEM), the shape functions for a bilinear quadrilateral element can exactly represent any displacement field that is a linear function of the spatial coordinates, i.e., of the form $\\mathbf{u}(x,y) = \\mathbf{a}_{0} + \\mathbf{a}_{1}x + \\mathbf{a}_{2}y$. This space of linear fields contains constant fields (rigid-body translations) and, for small deformations, linear fields corresponding to rigid-body rotations. The hourglass modes are, by definition, the modes of nodal displacement that are orthogonal to this space of linear fields.\n\nThe analytical and numerical verification proceeds as follows:\n\nFirst, we establish the basis for the linear fields evaluated at the element nodes. For a $4$-node element with physical coordinates $(x_{i}, y_{i})$ for $i \\in \\{1, 2, 3, 4\\}$, any linear field can be described by its values at the nodes. The matrix $\\mathbf{P}$ is constructed to represent the basis functions $\\{1, x, y\\}$ evaluated at each of the $4$ nodes:\n$$\n\\mathbf{P} = \\begin{bmatrix}\n1 & x_{1} & y_{1} \\\\\n1 & x_{2} & y_{2} \\\\\n1 & x_{3} & y_{3} \\\\\n1 & x_{4} & y_{4}\n\\end{bmatrix}\n$$\nThe columns of this $4 \\times 3$ matrix $\\mathbf{P}$ represent nodal vectors corresponding to a constant field, a field linear in $x$, and a field linear in $y$, respectively. For any non-degenerate quadrilateral, these three vectors are linearly independent, and so $\\mathbf{P}$ has rank $3$.\n\nThe hourglass vector, $\\mathbf{g} \\in \\mathbb{R}^{4}$, is defined as a vector that is discretely orthogonal to all linear fields. This is expressed algebraically by the condition that $\\mathbf{g}$ must be orthogonal to every column of $\\mathbf{P}$:\n$$\n\\mathbf{P}^{\\top}\\mathbf{g} = \\mathbf{0}\n$$\nThis means $\\mathbf{g}$ belongs to the nullspace of $\\mathbf{P}^{\\top}$. Since $\\mathbf{P}^{\\top}$ is a $3 \\times 4$ matrix of rank $3$, its nullspace has dimension $4 - 3 = 1$. This guarantees that the hourglass mode shape is unique up to a scalar multiple. We compute this vector $\\mathbf{g}$ (e.g., via Singular Value Decomposition of $\\mathbf{P}^{\\top}$) and normalize it to have a unit Euclidean norm, $\\lVert\\mathbf{g}\\rVert_{2}=1$.\n\nNext, we define the hourglass generalized coordinates. Given a set of nodal displacements in the $x$ and $y$ directions, collected into vectors $\\mathbf{u}^{x} = [u_{1}^{x}, u_{2}^{x}, u_{3}^{x}, u_{4}^{x}]^{\\top}$ and $\\mathbf{u}^{y} = [u_{1}^{y}, u_{2}^{y}, u_{3}^{y}, u_{4}^{y}]^{\\top}$, the generalized coordinates $q_{x}$ and $q_{y}$ are the projections of these displacement vectors onto the hourglass vector $\\mathbf{g}$:\n$$\nq_{x} = \\sum_{i=1}^{4} g_{i}u_{i}^{x} = \\mathbf{g}^{\\top}\\mathbf{u}^{x}\n$$\n$$\nq_{y} = \\sum_{i=1}^{4} g_{i}u_{i}^{y} = \\mathbf{g}^{\\top}\\mathbf{u}^{y}\n$$\nThese are assembled into the vector $\\mathbf{q}_{\\alpha} = [q_{x}, q_{y}]^{\\top}$. The quantity to be computed is its $L_2$-norm, $\\lVert\\mathbf{q}_{\\alpha}\\rVert_{2}$.\n\nWe now analytically verify the outcome for the specified displacement patterns.\n\n1.  **Rigid-Body Translation**: The displacement is constant across all nodes: $\\mathbf{u}_{i} = \\mathbf{t} = [t_{x}, t_{y}]^{\\top}$. The nodal displacement vectors are $\\mathbf{u}^{x} = t_{x}[1, 1, 1, 1]^{\\top}$ and $\\mathbf{u}^{y} = t_{y}[1, 1, 1, 1]^{\\top}$. The vector $[1, 1, 1, 1]^{\\top}$ is precisely the first column of $\\mathbf{P}$. Let's denote the columns of $\\mathbf{P}$ as $\\mathbf{p}_{1}$, $\\mathbf{p}_{2}$, $\\mathbf{p}_{3}$. The condition $\\mathbf{P}^{\\top}\\mathbf{g}=\\mathbf{0}$ implies $\\mathbf{p}_{j}^{\\top}\\mathbf{g}=0$ for $j=1,2,3$.\n    $$\n    q_{x} = \\mathbf{g}^{\\top}(t_{x}\\mathbf{p}_{1}) = t_{x}(\\mathbf{g}^{\\top}\\mathbf{p}_{1}) = t_{x}(0) = 0\n    $$\n    $$\n    q_{y} = \\mathbf{g}^{\\top}(t_{y}\\mathbf{p}_{1}) = t_{y}(\\mathbf{g}^{\\top}\\mathbf{p}_{1}) = t_{y}(0) = 0\n    $$\n    Therefore, $\\lVert\\mathbf{q}_{\\alpha}\\rVert_{2}=0$.\n\n2.  **Rigid-Body Rotation (Small Angle)**: A rotation by a small angle $\\theta$ about a center $(x_{0}, y_{0})$ induces displacements $u_{i}^{x} = \\theta(-(y_{i}-y_{0}))$ and $u_{i}^{y} = \\theta(x_{i}-x_{0})$. The nodal displacement vectors can be written as linear combinations of the columns of $\\mathbf{P}$:\n    $$\n    \\mathbf{u}^{x} = \\theta(\\mathbf{p}_{1}y_{0} - \\mathbf{p}_{3})\n    $$\n    $$\n    \\mathbf{u}^{y} = \\theta(\\mathbf{p}_{2} - \\mathbf{p}_{1}x_{0})\n    $$\n    Projecting these onto $\\mathbf{g}$:\n    $$\n    q_{x} = \\mathbf{g}^{\\top}(\\theta y_{0}\\mathbf{p}_{1} - \\theta\\mathbf{p}_{3}) = \\theta y_{0}(\\mathbf{g}^{\\top}\\mathbf{p}_{1}) - \\theta(\\mathbf{g}^{\\top}\\mathbf{p}_{3}) = 0 - 0 = 0\n    $$\n    $$\n    q_{y} = \\mathbf{g}^{\\top}(\\theta\\mathbf{p}_{2} - \\theta x_{0}\\mathbf{p}_{1}) = \\theta(\\mathbf{g}^{\\top}\\mathbf{p}_{2}) - \\theta x_{0}(\\mathbf{g}^{\\top}\\mathbf{p}_{1}) = 0 - 0 = 0\n    $$\n    Again, $\\lVert\\mathbf{q}_{\\alpha}\\rVert_{2}=0$. The numerical results for test cases $1, 2, 3, 4$ should be zero up to floating-point precision.\n\n3.  **Non-Rigid Hourglass Displacement**: The specified displacement has the form of the hourglass mode itself: $u_{i}^{x}=g_{i}$ and $u_{i}^{y}=-2g_{i}$. This means $\\mathbf{u}^{x} = \\mathbf{g}$ and $\\mathbf{u}^{y} = -2\\mathbf{g}$.\n    $$\n    q_{x} = \\mathbf{g}^{\\top}\\mathbf{u}^{x} = \\mathbf{g}^{\\top}\\mathbf{g} = \\lVert\\mathbf{g}\\rVert_{2}^{2} = 1\n    $$\n    $$\n    q_{y} = \\mathbf{g}^{\\top}\\mathbf{u}^{y} = \\mathbf{g}^{\\top}(-2\\mathbf{g}) = -2(\\mathbf{g}^{\\top}\\mathbf{g}) = -2\\lVert\\mathbf{g}\\rVert_{2}^{2} = -2\n    $$\n    The norm is therefore:\n    $$\n    \\lVert\\mathbf{q}_{\\alpha}\\rVert_{2} = \\sqrt{q_{x}^{2} + q_{y}^{2}} = \\sqrt{1^{2} + (-2)^{2}} = \\sqrt{1+4} = \\sqrt{5}\n    $$\n    This demonstrates that the hourglass generalized coordinates are non-zero for a displacement pattern that matches the hourglass mode, confirming the control mechanism would be activated.\n\nThe algorithm implemented in the code follows these steps for each test case: construct $\\mathbf{P}$, compute $\\mathbf{g}$ via the nullspace of $\\mathbf{P}^{\\top}$, define the nodal displacement vectors $\\mathbf{u}^{x}$ and $\\mathbf{u}^{y}$ for the given motion, calculate $\\mathbf{q}_{\\alpha}$, and finally compute its norm.", "answer": "[8.881784197001e-16,1.110223024625e-16,5.551115123126e-17,4.440892098501e-16,2.236067977500e+00]", "id": "3555163"}, {"introduction": "What are the tangible consequences of leaving hourglass modes unchecked, particularly in a dynamic simulation? This exercise provides a vivid answer by simulating wave propagation in a one-dimensional bar using a numerical scheme designed to exhibit hourglass instability. You will implement an explicit time integration algorithm to observe the uncontrolled, catastrophic growth of a spurious hourglass mode, and then see how adding a simple stabilization term effectively tames this non-physical behavior. [@problem_id:3404226]", "problem": "Consider one-dimensional linear elastodynamics on a bar of length $L$ with displacement field $u(x,t)$ governed by the partial differential equation\n$$\\rho A \\,\\frac{\\partial^2 u}{\\partial t^2} = \\frac{\\partial}{\\partial x}\\left(E A \\,\\frac{\\partial u}{\\partial x}\\right),$$\nwhere $\\rho$ is the mass density, $A$ is the cross-sectional area, and $E$ is Young's modulus. Impose homogeneous Dirichlet boundary conditions $u(0,t)=0$ and $u(L,t)=0$.\n\nTo mimic the hourglass behavior of under-integrated bilinear quadrilateral four-node elements (Q4) in a tractable one-dimensional surrogate, discretize the domain into $N$ equally spaced nodes with spacing $h = L/(N-1)$, and define overlapping four-node macro-elements $\\{i,i+1,i+2,i+3\\}$ for $i=0,1,\\dots,N-4$. For each macro-element, define a reduced-integration strain surrogate at the element center by\n$$\\varepsilon_e = g^\\top u_e,\\quad g = \\frac{1}{2h}[-1,-1,1,1]^\\top,$$\nwhere $u_e \\in \\mathbb{R}^4$ collects the nodal displacements of the macro-element. The associated under-integrated elemental stiffness is\n$$K_e^{\\text{RI}} = E A (2h)\\, g g^\\top,$$\nwhich produces a rank-deficient global stiffness matrix when assembled over all macro-elements. The nullspace corresponds to hourglass modes $u_e$ satisfying $g^\\top u_e = 0$, namely oscillatory patterns internal to each macro-element that do not contribute to the center strain. A convenient set of hourglass basis vectors for each macro-element is\n$$h_1 = [1,-1,0,0]^\\top,\\quad h_2=[0,0,1,-1]^\\top,\\quad h_3=[1,-1,-1,1]^\\top.$$\nIntroduce an hourglass control stabilization by adding, for each element, the stiffness\n$$K_e^{\\text{HG}} = s \\sum_{j=1}^3 h_j h_j^\\top,\\quad s = \\beta\\,\\frac{E A}{h},$$\nwhere $\\beta \\ge 0$ is a dimensionless stabilization coefficient. The total global stiffness is the assembly of $K_e^{\\text{RI}}$ for all elements, optionally augmented with $K_e^{\\text{HG}}$ if $\\beta>0$.\n\nUse explicit central difference time stepping with lumped mass matrix $M=\\operatorname{diag}(m_i)$, $m_i=\\rho A h$ for interior nodes, zero external traction, and initial conditions $u(x,0)=0$ and an hourglass-dominated initial velocity $v(x,0)$ proportional to the alternating nodal pattern. For free (interior) degrees of freedom, the update is\n$$u^{n+1} = 2u^n - u^{n-1} + \\Delta t^2 M^{-1}\\left(-K\\,u^n\\right),$$\nwith the first step\n$$u^1 = u^0 + \\Delta t\\,v^0 + \\frac{1}{2}\\Delta t^2 M^{-1}\\left(-K\\,u^0\\right).$$\nFix boundary nodes to zero at all times by direct imposition after each update. Choose a stable time step by\n$$\\Delta t = \\alpha\\,\\frac{2}{\\sqrt{\\lambda_{\\max}(M^{-1/2} K M^{-1/2})}},$$\nwhere $\\lambda_{\\max}(\\cdot)$ denotes the largest eigenvalue and $0<\\alpha<1$ is a safety factor.\n\nDefine the global hourglass pattern vector $\\phi \\in \\mathbb{R}^N$ by $\\phi_i = (-1)^i$ for interior nodes and $\\phi$ equals zero at the boundary nodes. Quantify the hourglass amplitude at time $t$ by the scalar projection in the mass inner product,\n$$a(t) = \\left|\\frac{\\phi^\\top M u(t)}{\\phi^\\top M \\phi}\\right|,$$\nwhich has units of meters.\n\nYour task is to write a complete, runnable program that:\n- Assembles $K$ using the reduced-integration surrogate and optional hourglass control.\n- Computes an explicit central difference time integration to time $T$, starting from $u(0)=0$ and $v(0)$ equal to the alternating hourglass pattern with a prescribed amplitude.\n- Outputs the final hourglass amplitude $a(T)$ in meters for each test case.\n\nAll physical quantities must be handled in base SI units: meters (m), seconds (s), kilograms (kg), Pascals (Pa), and Newtons (N). Angles are not involved. The outputs are floats representing $a(T)$ in meters.\n\nImplement the following test suite. Each test case is a tuple $(N, L, E, \\rho, A, V_0, T, \\beta, \\alpha)$ where:\n- $N$: number of nodes,\n- $L$: bar length in meters,\n- $E$: Young's modulus in Pascals,\n- $\\rho$: density in kilograms per cubic meter,\n- $A$: area in square meters,\n- $V_0$: initial hourglass velocity amplitude in meters per second,\n- $T$: final time in seconds,\n- $\\beta$: stabilization coefficient (dimensionless),\n- $\\alpha$: safety factor for the time step (dimensionless).\n\nUse the following parameter values:\n- Case 1 (no stabilization, observe growth): $(N,L,E,\\rho,A,V_0,T,\\beta,\\alpha) = (\\,41,\\,1.0,\\,200\\times 10^9,\\,7800,\\,1.0\\times 10^{-2},\\,1.0\\times 10^{-1},\\,2.0\\times 10^{-3},\\,0.0,\\,0.80\\,)$.\n- Case 2 (moderate stabilization): $(\\,41,\\,1.0,\\,200\\times 10^9,\\,7800,\\,1.0\\times 10^{-2},\\,1.0\\times 10^{-1},\\,2.0\\times 10^{-3},\\,0.5,\\,0.80\\,)$.\n- Case 3 (strong stabilization): $(\\,41,\\,1.0,\\,200\\times 10^9,\\,7800,\\,1.0\\times 10^{-2},\\,1.0\\times 10^{-1},\\,2.0\\times 10^{-3},\\,2.0,\\,0.80\\,)$.\n- Case 4 (small mesh, moderate stabilization): $(\\,7,\\,1.0,\\,200\\times 10^9,\\,7800,\\,1.0\\times 10^{-2},\\,1.0\\times 10^{-1},\\,2.0\\times 10^{-3},\\,0.5,\\,0.80\\,)$.\n- Case 5 (near-critical time step with moderate stabilization): $(\\,41,\\,1.0,\\,200\\times 10^9,\\,7800,\\,1.0\\times 10^{-2},\\,1.0\\times 10^{-1},\\,2.0\\times 10^{-3},\\,0.5,\\,0.98\\,)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5]\"). Each result must be the final hourglass amplitude $a(T)$ in meters for the corresponding test case, in the order given above.", "solution": "The problem asks for the simulation of one-dimensional elastodynamics using an explicit finite difference scheme. The spatial discretization is specifically designed to mimic hourglass instability, a phenomenon common in under-integrated finite element methods. The solution involves several steps: system discretization, construction of mass and stiffness matrices, determination of a stable time step, time integration of the equations of motion, and calculation of a final metric for the hourglassing amplitude. All calculations are performed in base SI units.\n\n### 1. Discretization and System Matrices\n\nThe continuous bar of length $L$ is discretized into $N$ nodes, with a uniform spacing of $h = L/(N-1)$. The displacement of the $i$-th node at time $t$ is denoted by $u_i(t)$. The system of equations is governed by the matrix equation $M \\ddot{u} + K u = F_{ext}$, where $u$ is the vector of nodal displacements, $M$ is the mass matrix, $K$ is the stiffness matrix, and $F_{ext}$ is the vector of external nodal forces, which is zero in this problem.\n\n**Mass Matrix ($M$)**\nA lumped mass matrix is used, which is diagonal and thus computationally efficient for explicit dynamics. For the $N-2$ interior nodes (from $i=1$ to $N-2$), the mass is $m_i = \\rho A h$. For the boundary nodes ($i=0$ and $i=N-1$), the displacements are fixed to zero, so their mass values do not influence the dynamics of the interior nodes. For implementation purposes, we can assign them any non-zero value to prevent division by zero; using the interior mass value $m_{0}=m_{N-1}=\\rho A h$ is convenient. Thus, $M = \\operatorname{diag}(m_i)$ is an $N \\times N$ matrix.\n\n**Stiffness Matrix ($K$)**\nThe global stiffness matrix $K$ is an $N \\times N$ matrix assembled from elemental stiffness matrices $K_e$. The problem defines overlapping $4$-node macro-elements. For each element $e$ spanning nodes $\\{i, i+1, i+2, i+3\\}$, the elemental stiffness $K_e$ is the sum of a reduced-integration part $K_e^{\\text{RI}}$ and a stabilization part $K_e^{\\text{HG}}$.\n\nThe reduced-integration stiffness is given by:\n$$K_e^{\\text{RI}} = EA(2h) g g^\\top$$\nwhere $g = \\frac{1}{2h}[-1, -1, 1, 1]^\\top$ is the gradient vector for the strain surrogate at the element's center. This matrix is rank-one and has a nullspace corresponding to zero-energy \"hourglass\" modes.\n\nTo control these non-physical modes, a stabilization stiffness is added:\n$$K_e^{\\text{HG}} = s \\sum_{j=1}^3 h_j h_j^\\top$$\nwhere $s = \\beta \\frac{EA}{h}$ is the stabilization parameter magnitude, controlled by the dimensionless coefficient $\\beta$, and $\\{h_j\\}$ are the provided hourglass basis vectors:\n$$h_1 = [1, -1, 0, 0]^\\top, \\quad h_2 = [0, 0, 1, -1]^\\top, \\quad h_3 = [1, -1, -1, 1]^\\top$$\nThe total elemental stiffness is $K_e = K_e^{\\text{RI}} + K_e^{\\text{HG}}$. The global stiffness matrix $K$ is formed by iterating through all $N-3$ macro-elements and adding each $4 \\times 4$ elemental matrix $K_e$ into the appropriate rows and columns of $K$.\n\n### 2. Time Integration\n\nAn explicit central difference scheme is used to integrate the semi-discretized equations of motion, $M \\ddot{u} = -K u$.\n\n**Time Step Determination**\nThe stability of the explicit scheme is governed by the Courant-Friedrichs-Lewy (CFL) condition. The stable time step $\\Delta t$ is calculated based on the maximum natural frequency of the system, which is related to the maximum eigenvalue $\\lambda_{\\max}$ of the dynamically scaled stiffness matrix $D = M^{-1/2} K M^{-1/2}$. Since boundary nodes are fixed, we only consider the sub-system for the free interior degrees of freedom. The formula is:\n$$\\Delta t = \\alpha \\frac{2}{\\sqrt{\\lambda_{\\max}(D_{free})}}$$\nwhere $D_{free}$ is the matrix $D$ corresponding to the free nodes, and $\\alpha$ is a safety factor ($0 < \\alpha < 1$). The eigenvalues of $D_{free}$ are computed numerically.\n\n**Update Scheme**\nThe displacement vector $u^n$ at time step $n$ is updated to $u^{n+1}$ using the central difference formula:\n$$u^{n+1} = 2u^n - u^{n-1} + \\Delta t^2 M^{-1}(-K u^n)$$\nwhere $u^{n-1}$ and $u^n$ are the displacements at the two previous time steps. Since $M$ is diagonal, $M^{-1}$ is simply the element-wise reciprocal of the nodal masses.\n\n**Initial Conditions and First Step**\nThe system starts from rest, $u(x,0)=0$, so $u^0=0$. The initial velocity is an alternating pattern for the interior nodes, $v^0_i = V_0 (-1)^i$ for $i=1, ..., N-2$, and zero at the boundaries. The first time step requires special treatment:\n$$u^1 = u^0 + \\Delta t v^0 + \\frac{1}{2}\\Delta t^2 M^{-1}(-K u^0)$$\nGiven $u^0 = 0$, this simplifies to $u^1 = \\Delta t v^0$.\n\n**Boundary Conditions**\nThe homogeneous Dirichlet boundary conditions, $u(0, t) = 0$ and $u(L, t) = 0$, are enforced directly at each time step by setting the first and last components of the displacement vector to zero, i.e., $u^{n+1}_0 = 0$ and $u^{n+1}_{N-1} = 0$, after each update calculation.\n\n### 3. Hourglass Amplitude Calculation\n\nThe simulation runs for a total time $T$. The final state is the displacement vector $u(T)$ at the end of the last full time step. The amplitude of the hourglass mode at this time is quantified by projecting the displacement solution onto the global hourglass pattern vector $\\phi$, where $\\phi_i = (-1)^i$ for interior nodes and is zero at the boundaries. The projection is performed in the energy inner product defined by the mass matrix:\n$$a(T) = \\left|\\frac{\\phi^\\top M u(T)}{\\phi^\\top M \\phi}\\right| = \\left| \\frac{\\sum_{i=1}^{N-2} \\phi_i m_i u_i(T)}{\\sum_{i=1}^{N-2} \\phi_i m_i \\phi_i} \\right|$$\nThis scalar value $a(T)$, in meters, is the required output for each test case. For the case with no stabilization ($\\beta=0$), the initial velocity profile is a zero-energy mode, leading to a theoretical linear growth in displacement, $a(t)=V_0 t$. With stabilization ($\\beta > 0$), this mode acquires a non-zero stiffness, resulting in oscillatory behavior with a suppressed amplitude.", "answer": "[0.0002, 2.1558e-06, 5.4125e-07, 1.1556e-05, 2.1558e-06]", "id": "3404226"}]}