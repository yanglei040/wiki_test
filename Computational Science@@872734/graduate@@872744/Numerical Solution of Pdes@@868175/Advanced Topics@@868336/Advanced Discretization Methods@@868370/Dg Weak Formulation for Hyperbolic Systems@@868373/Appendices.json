{"hands_on_practices": [{"introduction": "A deep understanding of any numerical method begins with analyzing its behavior on the simplest model problems. This first practice focuses on the one-dimensional linear advection equation, allowing us to dissect the core properties of the Discontinuous Galerkin (DG) method. By performing a Fourier analysis, you will derive the semi-discrete dispersion and dissipation errors, providing direct insight into how the choice of numerical flux affects the propagation of waves of different frequencies [@problem_id:3377316].", "problem": "Consider the one-dimensional linear advection equation $\\partial_t u + a \\,\\partial_x u = 0$ with a constant advection speed $a>0$ on a periodic domain discretized by a uniform mesh of cells of size $h$. Use the Discontinuous Galerkin (DG) method with polynomial degree $p=1$ per element, and the modal basis on the reference element $\\xi \\in [-1,1]$ defined by $\\phi_0(\\xi)=1$ and $\\phi_1(\\xi)=\\xi$, mapped to each physical cell $I_j=[x_{j-1/2},x_{j+1/2}]$ by $x=x_j+(h/2)\\,\\xi$. The flux function is $f(u)=a\\,u$. Two numerical fluxes are to be compared: the upwind flux for $a>0$, and the central flux. Periodic boundary conditions imply that the values from the neighboring cells wrap around the domain.\n\nStarting from the DG weak formulation, derive the semi-discrete system on each cell $I_j$ by testing with $v=\\phi_0$ and $v=\\phi_1$, carefully accounting for volume and surface terms under the chosen basis and mapping. Formulate the semi-discrete system in the form $M\\,\\partial_t \\mathbf{u}_j = \\mathcal{L}_j(\\mathbf{u}_{j-1},\\mathbf{u}_j,\\mathbf{u}_{j+1})$, where $M$ is the local mass matrix and $\\mathbf{u}_j=(u_{j,0},u_{j,1})^\\top$ are the modal coefficients in cell $j$. Then apply the discrete Fourier (Bloch) ansatz $\\mathbf{u}_j(t)=\\hat{\\mathbf{u}}(t)\\,e^{i k x_j}$, where $k$ is the spatial wavenumber in radians per meter, to obtain a $2\\times 2$ Fourier symbol matrix $A(k)$ such that $\\partial_t \\hat{\\mathbf{u}} = A(k)\\,\\hat{\\mathbf{u}}$ for each of the two flux choices. The semi-discrete Fourier symbol is defined by the eigenvalues $\\lambda(k)$ of $A(k)$; select the physical branch as the eigenvalue that approaches $-i\\,a\\,k$ in the limit $k\\to 0$.\n\nDefine the dispersion error as $E_{\\mathrm{disp}}(k) = \\operatorname{Im}(\\lambda(k))/(-a) - k$ in radians per meter, and the dissipation rate as $E_{\\mathrm{diss}}(k) = \\operatorname{Re}(\\lambda(k))$ in inverse seconds. Implement a program that constructs $A(k)$ for both the upwind and central fluxes, computes their eigenvalues, selects the physical branch, and evaluates $E_{\\mathrm{disp}}(k)$ and $E_{\\mathrm{diss}}(k)$.\n\nUse the following test suite with $a=1.0$ meters per second and $h=1.0$ meters, and the wavenumbers in radians per meter (angles in radians):\n- $k_1 = 0.0$\n- $k_2 = 0.2\\,\\pi$\n- $k_3 = 0.5\\,\\pi$\n- $k_4 = 0.9\\,\\pi$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case $k_i$, output a list of four floats $[E_{\\mathrm{disp}}^{\\mathrm{up}}, E_{\\mathrm{diss}}^{\\mathrm{up}}, E_{\\mathrm{disp}}^{\\mathrm{cen}}, E_{\\mathrm{diss}}^{\\mathrm{cen}}]$, where superscripts indicate the flux choice. Aggregate the four test case results into a single list. The required final format is\n$[[d_1,s_1,d_2,s_2],[d_1,s_1,d_2,s_2],[d_1,s_1,d_2,s_2],[d_1,s_1,d_2,s_2]]$\nwith all entries as floating-point numbers, where for each bracketed group the entries are in the order upwind dispersion error, upwind dissipation rate, central dispersion error, central dissipation rate. No units should be printed; all angles must be treated in radians and the dispersion error expressed in radians per meter, the dissipation rate in inverse seconds.", "solution": "The starting point is the one-dimensional linear advection equation $\\partial_t u + a \\,\\partial_x u = 0$ with constant speed $a>0$. The Discontinuous Galerkin (DG) method is constructed by approximating $u$ in each cell $I_j=[x_{j-1/2},x_{j+1/2}]$ using the modal basis on the reference element $\\xi \\in [-1,1]$, $\\phi_0(\\xi)=1$ and $\\phi_1(\\xi)=\\xi$, mapped by $x=x_j+(h/2)\\,\\xi$. The local approximation in cell $j$ is $u_h(x,t) = u_{j,0}(t)\\,\\phi_0(\\xi(x)) + u_{j,1}(t)\\,\\phi_1(\\xi(x))$. The DG weak form for a test function $v$ is\n$$\n\\int_{I_j} \\partial_t u_h\\, v\\, dx \\;-\\; \\int_{I_j} f(u_h)\\,\\partial_x v\\, dx \\;+\\; \\widehat{f}\\big(u_h^{-},u_h^{+}\\big)\\, v\\big|_{x_{j+1/2}} \\;-\\; \\widehat{f}\\big(u_h^{-},u_h^{+}\\big)\\, v\\big|_{x_{j-1/2}} \\;=\\; 0,\n$$\nwhere $f(u)=a\\,u$, and $\\widehat{f}$ is a numerical flux at interfaces. For $p=1$, we test with $v=\\phi_0$ and $v=\\phi_1$. The mapping derivative is $\\partial_x v = (2/h)\\,\\partial_\\xi v$, and the Jacobian is $dx=(h/2)\\,d\\xi$. The mass matrix entries are\n$$\nM_{mn} = \\int_{I_j} \\phi_m \\phi_n\\, dx = \\frac{h}{2}\\int_{-1}^1 \\phi_m(\\xi)\\,\\phi_n(\\xi)\\, d\\xi,\n$$\nwhich yield $M=\\mathrm{diag}(h, h/3)$ because $\\int_{-1}^1 1\\,d\\xi=2$, $\\int_{-1}^1 \\xi\\,d\\xi=0$, and $\\int_{-1}^1 \\xi^2\\,d\\xi=2/3$.\n\nThe volume term involves $-\\int_{I_j} a\\,u_h\\,\\partial_x v\\,dx$. For $v=\\phi_0$, $\\partial_x \\phi_0=0$, so the volume term vanishes. For $v=\\phi_1$, $\\partial_x \\phi_1 = 2/h$, hence\n$$\n-\\int_{I_j} a\\,u_h\\,\\partial_x \\phi_1\\,dx \\;=\\; -\\frac{2a}{h}\\int_{I_j} u_h\\,dx \\;=\\; -\\frac{2a}{h}\\frac{h}{2}\\int_{-1}^1 \\big(u_{j,0}\\,\\phi_0(\\xi) + u_{j,1}\\,\\phi_1(\\xi)\\big)\\, d\\xi \\;=\\; -2a\\,u_{j,0},\n$$\nbecause $\\int_{-1}^1 \\phi_1(\\xi)\\,d\\xi=0$.\n\nThe surface terms evaluate the test function at cell endpoints. At $x_{j+1/2}$, the outward normal is $+1$ and $\\phi_0(1)=1$, $\\phi_1(1)=1$. At $x_{j-1/2}$, the outward normal is $-1$ and $\\phi_0(-1)=1$, $\\phi_1(-1)=-1$. Therefore the boundary contributions for $v=\\phi_0$ and $v=\\phi_1$ are $\\widehat{f}_{j+1/2} - \\widehat{f}_{j-1/2}$ and $\\widehat{f}_{j+1/2} + \\widehat{f}_{j-1/2}$, respectively. The trace values at cell interfaces are $u_j^{+}=u_{j,0}+u_{j,1}$ at $x_{j+1/2}$ and $u_j^{-}=u_{j,0}-u_{j,1}$ at $x_{j-1/2}$.\n\nFor the upwind flux with $a>0$, $\\widehat{f}=a\\,u^{-}$ so that $\\widehat{f}_{j+1/2} = a\\,(u_{j,0}+u_{j,1})$ and $\\widehat{f}_{j-1/2} = a\\,(u_{j-1,0}+u_{j-1,1})$. Combining all terms, the semi-discrete equations become\n$$\nh\\,\\partial_t u_{j,0} \\;+\\; a\\big[(u_{j,0}+u_{j,1}) - (u_{j-1,0}+u_{j-1,1})\\big] \\;=\\; 0,\n$$\n$$\n\\frac{h}{3}\\,\\partial_t u_{j,1} \\;-\\; 2a\\,u_{j,0} \\;+\\; a\\big[(u_{j,0}+u_{j,1}) + (u_{j-1,0}+u_{j-1,1})\\big] \\;=\\; 0.\n$$\n\nFor the central flux, $\\widehat{f}=\\tfrac{a}{2}\\,(u^{-}+u^{+})$, giving $\\widehat{f}_{j+1/2} = \\tfrac{a}{2}\\big((u_{j,0}+u_{j,1}) + (u_{j+1,0}-u_{j+1,1})\\big)$ and $\\widehat{f}_{j-1/2} = \\tfrac{a}{2}\\big((u_{j-1,0}+u_{j-1,1}) + (u_{j,0}-u_{j,1})\\big)$. The semi-discrete equations are\n$$\nh\\,\\partial_t u_{j,0} \\;+\\; \\frac{a}{2}\\Big[\\big(u_{j,0}+u_{j,1}\\big) + \\big(u_{j+1,0}-u_{j+1,1}\\big) - \\big(u_{j-1,0}+u_{j-1,1}\\big) - \\big(u_{j,0}-u_{j,1}\\big)\\Big] \\;=\\; 0,\n$$\n$$\n\\frac{h}{3}\\,\\partial_t u_{j,1} \\;-\\; 2a\\,u_{j,0} \\;+\\; \\frac{a}{2}\\Big[\\big(u_{j,0}+u_{j,1}\\big) + \\big(u_{j+1,0}-u_{j+1,1}\\big) + \\big(u_{j-1,0}+u_{j-1,1}\\big) + \\big(u_{j,0}-u_{j,1}\\big)\\Big] \\;=\\; 0.\n$$\n\nTo obtain the Fourier symbol, apply the Bloch ansatz $\\mathbf{u}_j(t)=\\hat{\\mathbf{u}}(t)\\,e^{i k x_j}$ with $k$ the wavenumber and $x_{j\\pm 1}=x_j\\pm h$. Then $u_{j\\pm1,m}= \\hat{u}_m\\,e^{\\pm i k h}\\,e^{i k x_j}$. Factor $e^{i k x_j}$ and write the semi-discrete system for $\\hat{\\mathbf{u}}=(\\hat{u}_0,\\hat{u}_1)^\\top$ as $\\partial_t \\hat{\\mathbf{u}} = A(k)\\,\\hat{\\mathbf{u}}$. For the upwind flux, introduce $z=e^{-i k h}=\\cos(kh)-i\\sin(kh)$, and obtain\n$$\nA_{\\mathrm{up}}(k) \\;=\\; -\\frac{a}{h}\n\\begin{pmatrix}\n1 - z & \\;1 - z\\\\\n3(z - 1) & \\;3(1 + z)\n\\end{pmatrix}.\n$$\nFor the central flux, using trigonometric identities, obtain\n$$\nA_{\\mathrm{cen}}(k) \\;=\\; -\\frac{a}{h}\n\\begin{pmatrix}\ni\\,\\sin(kh) & \\;1 - \\cos(kh)\\\\\n3\\big(\\cos(kh)-1\\big) & \\;-\\,3\\,i\\,\\sin(kh)\n\\end{pmatrix}.\n$$\nThe semi-discrete Fourier symbol is given by the eigenvalues $\\lambda(k)$ of $A(k)$. The physical branch satisfies $\\lambda(k)\\to -i\\,a\\,k$ as $k\\to 0$, while the second branch corresponds to a spurious mode with magnitude $O(a/h)$.\n\nDefine the dispersion error as $E_{\\mathrm{disp}}(k) = \\operatorname{Im}(\\lambda(k))/(-a) - k$, which compares the numerical phase speed to the exact relation $\\lambda_{\\mathrm{exact}}(k)=-i\\,a\\,k$, and the dissipation rate as $E_{\\mathrm{diss}}(k) = \\operatorname{Re}(\\lambda(k))$, which is zero for the exact continuous advection and non-zero for dissipative discretizations. The algorithm is:\n1. For given $(a,h,k)$, construct $A_{\\mathrm{up}}(k)$ and $A_{\\mathrm{cen}}(k)$ as above.\n2. Compute their eigenvalues.\n3. Select the physical eigenvalue by minimizing $|\\operatorname{Im}(\\lambda)+a\\,k|$ among the computed eigenvalues; if needed, break ties by choosing the eigenvalue with the smaller magnitude $|\\lambda|$.\n4. Compute $E_{\\mathrm{disp}}(k)$ and $E_{\\mathrm{diss}}(k)$ for both fluxes.\n\nWith $a=1.0$ meters per second and $h=1.0$ meters, and the test wavenumbers $k_1=0.0$, $k_2=0.2\\,\\pi$, $k_3=0.5\\,\\pi$, $k_4=0.9\\,\\pi$ (radians per meter), the program produces, for each $k_i$, the four floats $[E_{\\mathrm{disp}}^{\\mathrm{up}}, E_{\\mathrm{diss}}^{\\mathrm{up}}, E_{\\mathrm{disp}}^{\\mathrm{cen}}, E_{\\mathrm{diss}}^{\\mathrm{cen}}]$, aggregated into a single list. Qualitatively, the central flux yields purely imaginary eigenvalues, hence $E_{\\mathrm{diss}}^{\\mathrm{cen}}(k)=0$ for all $k$, reflecting energy conservation in the semi-discrete setting, while the upwind flux introduces negative real parts in $\\lambda(k)$, hence $E_{\\mathrm{diss}}^{\\mathrm{up}}(k)<0$ except at $k=0$, reflecting numerical dissipation. The dispersion errors for both fluxes quantify phase inaccuracies that increase with $kh$; the physical branch approaches the exact $-i\\,a\\,k$ as $k\\to 0$, so $E_{\\mathrm{disp}}(0)=0$ for both fluxes.", "answer": "```python\nimport numpy as np\n\ndef A_upwind(a, h, k):\n    \"\"\"\n    Construct the 2x2 Fourier symbol matrix A(k) for P1 DG with upwind flux (a > 0).\n    Uses z = exp(-i k h).\n    \"\"\"\n    z = np.exp(-1j * k * h)\n    factor = -a / h\n    A11 = (1 - z)\n    A12 = (1 - z)\n    A21 = 3 * (z - 1)\n    A22 = 3 * (1 + z)\n    A = factor * np.array([[A11, A12],\n                           [A21, A22]], dtype=complex)\n    return A\n\ndef A_central(a, h, k):\n    \"\"\"\n    Construct the 2x2 Fourier symbol matrix A(k) for P1 DG with central flux.\n    Uses trig form with sin(kh) and cos(kh).\n    \"\"\"\n    kh = k * h\n    s = np.sin(kh)\n    c = np.cos(kh)\n    factor = -a / h\n    A11 = 1j * s\n    A12 = (1 - c)\n    A21 = 3 * (c - 1)\n    A22 = -3j * s\n    A = factor * np.array([[A11, A12],\n                           [A21, A22]], dtype=complex)\n    return A\n\ndef physical_branch_eigenvalue(eigs, a, k):\n    \"\"\"\n    Select the physical branch eigenvalue: the one whose imaginary part\n    is closest to -a*k. Break ties by smaller magnitude.\n    \"\"\"\n    target_im = -a * k\n    # Compute closeness and magnitude\n    closeness = [abs(np.imag(lam) - target_im) for lam in eigs]\n    # Find indices sorted by closeness then by magnitude\n    indices = sorted(range(len(eigs)),\n                     key=lambda i: (closeness[i], abs(eigs[i])))\n    return eigs[indices[0]]\n\ndef compute_errors(a, h, k, flux_type):\n    \"\"\"\n    Compute dispersion and dissipation errors for given a, h, k, and flux type.\n    flux_type: 'upwind' or 'central'\n    Returns (E_disp, E_diss).\n    \"\"\"\n    if flux_type == 'upwind':\n        A = A_upwind(a, h, k)\n    elif flux_type == 'central':\n        A = A_central(a, h, k)\n    else:\n        raise ValueError(\"Unknown flux type\")\n    eigs = np.linalg.eigvals(A)\n    lam = physical_branch_eigenvalue(eigs, a, k)\n    E_disp = (np.imag(lam) / (-a)) - k  # radians per meter\n    E_diss = np.real(lam)               # inverse seconds\n    return float(E_disp), float(E_diss)\n\ndef solve():\n    # Define parameters\n    a = 1.0  # m/s\n    h = 1.0  # m\n    # Test suite wavenumbers in radians per meter (angles in radians)\n    test_cases = [\n        0.0,\n        0.2 * np.pi,\n        0.5 * np.pi,\n        0.9 * np.pi,\n    ]\n\n    results = []\n    for k in test_cases:\n        disp_up, diss_up = compute_errors(a, h, k, 'upwind')\n        disp_cen, diss_cen = compute_errors(a, h, k, 'central')\n        results.append([disp_up, diss_up, disp_cen, diss_cen])\n\n    # Final print statement in the exact required format.\n    # Single line: list of lists with floats.\n    print(f\"[{','.join(str(r) for r in results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3377316"}, {"introduction": "Real-world hyperbolic systems, such as the shallow water equations, often include source terms that balance the flux gradients in important steady states. A critical property for a numerical scheme is to preserve these balances at the discrete level, a concept known as \"well-balancing\". This practice challenges you to derive a key component of a well-balanced DG formulation, ensuring that a \"lake-at-rest\" state is maintained exactly by the numerics, which is essential for accurately simulating small perturbations on large-scale backgrounds [@problem_id:3377340].", "problem": "Consider the one-dimensional shallow water equations over a fixed bathymetry for height $h(x,t)$, velocity $u(x,t)$, and bed elevation $b(x)$, with gravitational acceleration $g>0$,\n$$\n\\partial_{t} h + \\partial_{x} (h u) = 0, \\qquad \\partial_{t} (h u) + \\partial_{x}\\!\\left(h u^{2} + \\frac{g}{2} h^{2}\\right) = - g h \\,\\partial_{x} b.\n$$\nA lake-at-rest state is defined by $u(x,t) = 0$ and free-surface elevation $H(x) = h(x,t) + b(x)$ equal to a spatial constant $H_{0}$, so that $h(x,t) = H_{0} - b(x)$.\n\nIn a Discontinuous Galerkin (DG) method for the hyperbolic system above, consider the weak formulation for the momentum equation on an element $K = [x_{L}, x_{R}]$ with a test function $\\varphi(x)$, where the hydrostatic pressure flux $\\frac{g}{2} h^{2}$ is integrated by parts and replaced at the element boundary by a consistent numerical flux, while the source $-g h\\,\\partial_{x} b$ is discretized using a path-conservative interface contribution derived from the nonconservative product formalism. Specifically, the face source contribution at an interface with left and right traces $(b_{L}, h_{L})$ and $(b_{R}, h_{R})$ is taken as\n$$\nS_{\\text{face}} = g\\,\\varphi(x_{f})\\,n_{f}\\,\\int_{0}^{1} h(s)\\,\\mathrm{d}b(s),\n$$\nwhere $x_{f}$ is the interface location, $n_{f} \\in \\{-1,+1\\}$ is the outward unit normal of the element at the face, and the straight-line path connects the left and right face states via $b(s) = (1-s)\\,b_{L} + s\\,b_{R}$, with the lake-at-rest relation enforced pointwise along the path, $h(s) = H_{0} - b(s)$.\n\nStarting only from the shallow water model, the lake-at-rest characterization, and the DG weak-form construction above, derive the closed-form analytic expression of the face source contribution for the straight-line path,\n$$\nS_{\\text{face}} = g\\,\\varphi(x_{f})\\,n_{f}\\,\\int_{0}^{1} h(s)\\,\\mathrm{d}b(s),\n$$\nexpressed purely in terms of $g$, $H_{0}$, $b_{L}$, and $b_{R}$. Your final answer must be the single analytical expression for $g\\int_{0}^{1} h(s)\\,\\mathrm{d}b(s)$; do not include $\\varphi(x_{f})$ or $n_{f}$ in the final expression. No numerical rounding is required, and no units should be reported in the final answer.", "solution": "The problem is valid. It is a well-posed mathematical problem grounded in the established theory of numerical methods for hyperbolic partial differential equations. All information required for the derivation is provided.\n\nThe objective is to derive a closed-form analytical expression for the face source contribution term, specifically for the quantity $g\\int_{0}^{1} h(s)\\,\\mathrm{d}b(s)$. This term arises in path-conservative Discontinuous Galerkin schemes for the shallow water equations.\n\nThe problem provides the following definitions for the path connecting the left state $(b_{L}, h_{L})$ and right state $(b_{R}, h_{R})$ at a cell interface:\n1.  A straight-line path for the bed elevation $b(s)$ parameterized by $s \\in [0, 1]$:\n    $$b(s) = (1-s)b_{L} + s\\,b_{R}$$\n2.  The water height $h(s)$ along this path is determined by the lake-at-rest condition, $h(s) + b(s) = H_{0}$, where $H_{0}$ is the constant free-surface elevation. This gives:\n    $$h(s) = H_{0} - b(s)$$\n\nThe quantity to be calculated is the path integral $g\\int_{0}^{1} h(s)\\,\\mathrm{d}b(s)$. This is formally a Riemann-Stieltjes integral. We can evaluate it by changing the variable of integration from the parameter $s$ to the bathymetry variable $b$.\n\nThe path for $b(s)$ starts at $s=0$ and ends at $s=1$. Let us evaluate the corresponding values of $b$:\n-   At $s=0$, the starting point of the path is $b(0) = (1-0)b_{L} + (0)b_{R} = b_{L}$.\n-   At $s=1$, the ending point of the path is $b(1) = (1-1)b_{L} + (1)b_{R} = b_{R}$.\n\nThe integrand is $h(s)$, which is defined in terms of $b(s)$ as $h(s) = H_{0} - b(s)$. Since the integration is with respect to $b$, we can express the integrand directly as a function of $b$, namely $H_{0} - b$.\n\nWith these substitutions, the integral transforms from a Riemann-Stieltjes integral over the parameter $s \\in [0, 1]$ to a standard Riemann integral over the variable $b$ from $b_{L}$ to $b_{R}$:\n$$ \\int_{0}^{1} h(s)\\,\\mathrm{d}b(s) = \\int_{b_{L}}^{b_{R}} (H_{0} - b)\\,\\mathrm{d}b $$\n\nWe now compute this definite integral. The antiderivative of the integrand $(H_{0} - b)$ with respect to $b$ is:\n$$ \\int (H_{0} - b)\\,\\mathrm{d}b = H_{0}b - \\frac{1}{2}b^{2} $$\n\nEvaluating this antiderivative at the upper and lower limits of integration, $b_{R}$ and $b_{L}$, yields:\n$$ \\left[ H_{0}b - \\frac{1}{2}b^{2} \\right]_{b_{L}}^{b_{R}} = \\left(H_{0}b_{R} - \\frac{1}{2}b_{R}^{2}\\right) - \\left(H_{0}b_{L} - \\frac{1}{2}b_{L}^{2}\\right) $$\n\nWe can group terms by $H_{0}$ and the quadratic terms:\n$$ H_{0}(b_{R} - b_{L}) - \\frac{1}{2}(b_{R}^{2} - b_{L}^{2}) $$\n\nTo obtain a more compact form, we use the difference of squares factorization, $b_{R}^{2} - b_{L}^{2} = (b_{R} - b_{L})(b_{R} + b_{L})$:\n$$ H_{0}(b_{R} - b_{L}) - \\frac{1}{2}(b_{R} - b_{L})(b_{R} + b_{L}) $$\n\nFactoring out the common term $(b_{R} - b_{L})$ gives:\n$$ (b_{R} - b_{L}) \\left[ H_{0} - \\frac{1}{2}(b_{R} + b_{L}) \\right] = (b_{R} - b_{L}) \\left( H_{0} - \\frac{b_{L} + b_{R}}{2} \\right) $$\nThis expression represents the value of the integral $\\int_{0}^{1} h(s)\\,\\mathrm{d}b(s)$.\n\nThe problem asks for the complete expression for the face source contribution term, which is $g\\int_{0}^{1} h(s)\\,\\mathrm{d}b(s)$. We multiply the result of the integral by the gravitational acceleration $g$:\n$$ g\\int_{0}^{1} h(s)\\,\\mathrm{d}b(s) = g(b_{R} - b_{L})\\left(H_{0} - \\frac{b_{L} + b_{R}}{2}\\right) $$\nThis is the final analytical expression in terms of the specified variables $g$, $H_{0}$, $b_{L}$, and $b_{R}$.", "answer": "$$\\boxed{g(b_{R} - b_{L})\\left(H_{0} - \\frac{b_{L} + b_{R}}{2}\\right)}$$", "id": "3377340"}, {"introduction": "Beyond analyzing the forward evolution of a system, we often want to understand how specific outputs or \"goals\" depend on the inputs and model parameters. Adjoint methods provide a powerful and efficient framework for this type of sensitivity analysis. In this final practice, you will use the Lagrangian method to derive the discrete adjoint equations corresponding to a DG discretization, a fundamental step in developing goal-oriented error estimators and optimization algorithms [@problem_id:3377328].", "problem": "Consider the linear scalar hyperbolic partial differential equation (PDE) $u_{t} + a\\,u_{x} = 0$ on the periodic interval $[0,L]$ with constant advection speed $a>0$ and final time $T>0$. Partition the domain into $N=2$ uniform cells $K_1$ and $K_2$ of size $h=L/2$. Use the Discontinuous Galerkin (DG) method with piecewise constant trial and test functions on each cell, and use the upwind numerical flux $\\hat{f}(u^{-},u^{+}) = a\\,u^{-}$. Let $u_{i}(t)$ denote the cell average of $u$ on $K_{i}$ for $i=1,2$.\n\nDefine the goal functional $J(u(T)) = \\sum_{i=1}^{2}\\gamma_{i}\\int_{K_{i}} u(x,T)\\,\\mathrm{d}x$, where $\\gamma_{1},\\gamma_{2}\\in\\mathbb{R}$ are fixed weights. Introduce the discrete adjoint variable $\\boldsymbol{\\lambda}(t)\\in\\mathbb{R}^{2}$ associated with $J$ via a Lagrangian construction that enforces the semi-discrete DG weak form in time. Work solely from foundational definitions: the DG weak formulation obtained by multiplying the PDE by a test function, integrating by parts on each cell, and replacing boundary terms by the numerical flux; the Gateaux differential of $J$; and the stationarity of the Lagrangian with respect to variations in the primal and adjoint variables. Do not assume any pre-formed discrete adjoint formulas.\n\nTasks:\n1. Starting from the DG weak formulation, derive the semi-discrete vector ordinary differential equation (ODE) for the cell averages $\\mathbf{u}(t)=(u_1(t),u_2(t))^{\\top}$ under the stated flux and periodic boundary conditions, clearly identifying the element-wise mass contributions and the interface flux couplings.\n2. Using the Lagrangian for the constrained optimization of $J$ subject to the semi-discrete DG dynamics, derive the ODE satisfied by the discrete adjoint $\\boldsymbol{\\lambda}(t)$ and the terminal condition at time $T$, expressed in terms of the fundamental objects appearing in the primal semi-discrete weak form.\n3. Verify adjoint consistency and the symmetry properties of the interior-face contributions of the bilinear form induced by the DG fluxes that are required for goal-oriented error estimation. Your verification should be carried out by demonstrating the equality of the primal and adjoint interface couplings under the appropriate transposition and by explaining how the choice of numerical flux affects these properties in this special two-cell, periodic, piecewise-constant setting.\n4. Finally, provide the explicit closed-form analytical expression for the constant $2\\times 2$ matrix multiplying $\\boldsymbol{\\lambda}(t)$ in the discrete adjoint ODE, expressed in terms of $a$ and $h$ only. Your final answer must be a single analytical expression. No rounding is required.", "solution": "The problem is an application of the Discontinuous Galerkin (DG) method and adjoint-based analysis to a linear scalar hyperbolic equation. The problem statement is validated as scientifically grounded, well-posed, objective, and complete. All necessary components, including the governing PDE, domain, boundary conditions, numerical scheme parameters, and the goal functional, are precisely defined. The tasks are sequential and logically coherent, representing a standard exercise in the numerical analysis of PDEs. We proceed with the solution.\n\nThe problem considers the PDE $u_{t} + a\\,u_{x} = 0$ on the periodic domain $[0,L]$ with constant $a>0$. The domain is discretized into $N=2$ cells, $K_{1} = [0, h]$ and $K_{2} = [h, 2h=L]$, with cell size $h=L/2$. We use piecewise constant ($P^0$) trial and test functions.\n\n**1. Derivation of the Semi-Discrete ODE**\n\nThe DG weak formulation is derived by multiplying the PDE by a test function $v(x)$ and integrating over a cell $K_i$. For $P^0$ elements, we choose the basis function $\\phi_i(x)$ to be $1$ for $x \\in K_i$ and $0$ otherwise. The trial solution on the domain is $u_h(x,t) = \\sum_{j=1}^{2} u_j(t) \\phi_j(x)$, and the test function is $v_h(x) = \\sum_{j=1}^{2} v_j \\phi_j(x)$, where $u_j$ and $v_j$ are coefficients. Since the basis is piecewise constant, $u_j(t)$ is the cell average of $u$ on $K_j$.\n\nFor a test function $v_h=\\phi_i(x)$ (i.e., $v_h=1$ on $K_i$, $0$ elsewhere), the weak form on cell $K_i$ is:\n$$ \\int_{K_i} \\frac{\\partial u_h}{\\partial t} \\phi_i \\,dx + \\int_{K_i} a \\frac{\\partial u_h}{\\partial x} \\phi_i \\,dx = 0 $$\nApplying integration by parts to the second term:\n$$ \\int_{K_i} \\frac{\\partial u_h}{\\partial t} \\phi_i \\,dx - \\int_{K_i} a u_h \\frac{\\partial \\phi_i}{\\partial x} \\,dx + \\left[ a u_h \\phi_i \\right]_{x_{i-1/2}}^{x_{i+1/2}} = 0 $$\nSince $\\phi_i$ is constant on $K_i$, $\\frac{\\partial \\phi_i}{\\partial x} = 0$, and the volume integral of the advection term vanishes. The boundary term becomes $a u_h(x_{i+1/2},t) \\phi_i(x_{i+1/2}^-) - a u_h(x_{i-1/2},t) \\phi_i(x_{i-1/2}^-)$. In the DG method, we replace the actual flux term $a u_h$ at interfaces with a numerical flux $\\hat{f}(u_h^-, u_h^+)$. Since $\\phi_i=1$ inside $K_i$, the weak formulation becomes:\n$$ \\int_{K_i} \\frac{\\partial u_h}{\\partial t} \\,dx + \\hat{f}(u_h(x_{i+1/2}^-), u_h(x_{i+1/2}^+)) - \\hat{f}(u_h(x_{i-1/2}^-), u_h(x_{i-1/2}^+)) = 0 $$\nLet $u_i(t) = \\frac{1}{h} \\int_{K_i} u_h(x,t) dx$. The equation for the cell average $u_i$ is:\n$$ h \\frac{d u_i}{dt} + \\hat{f}_{i+1/2} - \\hat{f}_{i-1/2} = 0 $$\nThe numerical flux is the upwind flux $\\hat{f}(u^-,u^+) = a u^-$ for $a>0$.\n\nFor cell $K_1 = [0,h]$ (i.e., $i=1$), the interfaces are at $x_{1/2}=0$ and $x_{3/2}=h$:\n$$ h \\frac{d u_1}{dt} + \\hat{f}_{3/2} - \\hat{f}_{1/2} = 0 $$\nAt $x_{3/2}=h$, we have $u_h^-=u_1$ and $u_h^+=u_2$. So, $\\hat{f}_{3/2} = \\hat{f}(u_1, u_2) = a u_1$.\nAt $x_{1/2}=0$, due to periodicity, the state to the left is from $x=L=2h$, so $u_h^-=u_2$ and $u_h^+=u_1$. So, $\\hat{f}_{1/2} = \\hat{f}(u_2, u_1) = a u_2$.\nSubstituting these gives the ODE for $u_1$:\n$$ h \\frac{d u_1}{dt} + a u_1 - a u_2 = 0 \\implies h \\frac{d u_1}{dt} = -a u_1 + a u_2 $$\n\nFor cell $K_2 = [h,2h]$ (i.e., $i=2$), the interfaces are at $x_{3/2}=h$ and $x_{5/2}=2h$:\n$$ h \\frac{d u_2}{dt} + \\hat{f}_{5/2} - \\hat{f}_{3/2} = 0 $$\nAt $x_{5/2}=2h$, periodicity means $u_h^-=u_2$ and $u_h^+=u_1$. So, $\\hat{f}_{5/2} = \\hat{f}(u_2, u_1) = a u_2$.\nAt $x_{3/2}=h$, $u_h^-=u_1$ and $u_h^+=u_2$. So, $\\hat{f}_{3/2} = \\hat{f}(u_1, u_2) = a u_1$.\nSubstituting these gives the ODE for $u_2$:\n$$ h \\frac{d u_2}{dt} + a u_2 - a u_1 = 0 \\implies h \\frac{d u_2}{dt} = a u_1 - a u_2 $$\n\nIn vector form, let $\\mathbf{u}(t) = (u_1(t), u_2(t))^{\\top}$. The system of ODEs is $M \\frac{d\\mathbf{u}}{dt} = S\\mathbf{u}$, where the mass matrix is:\n$$ M = \\begin{pmatrix} h & 0 \\\\ 0 & h \\end{pmatrix} $$\nfrom element-wise integration, and the spatial/flux coupling matrix is:\n$$ S = a\\begin{pmatrix} -1 & 1 \\\\ 1 & -1 \\end{pmatrix} $$\n\n**2. Derivation of the Adjoint ODE**\n\nThe goal functional is $J(u(T)) = \\sum_{i=1}^{2}\\gamma_{i}\\int_{K_{i}} u(x,T)\\,\\mathrm{d}x$. For piecewise constant functions, this becomes $J(\\mathbf{u}(T)) = h(\\gamma_1 u_1(T) + \\gamma_2 u_2(T)) = h\\boldsymbol{\\gamma}^{\\top}\\mathbf{u}(T)$, where $\\boldsymbol{\\gamma}=(\\gamma_1, \\gamma_2)^{\\top}$.\n\nWe form the Lagrangian $\\mathcal{L}$ to minimize $J$ subject to the primal ODE constraint $M\\dot{\\mathbf{u}} - S\\mathbf{u}=0$:\n$$ \\mathcal{L}(\\mathbf{u}, \\boldsymbol{\\lambda}) = J(\\mathbf{u}(T)) - \\int_{0}^{T} \\boldsymbol{\\lambda}(t)^{\\top} (M\\dot{\\mathbf{u}}(t) - S\\mathbf{u}(t)) \\,\\mathrm{d}t $$\nThe stationarity condition requires the Gateaux derivative of $\\mathcal{L}$ with respect to $\\mathbf{u}$ in direction $\\mathbf{v}$ to be zero:\n$$ \\delta_{\\mathbf{u}}\\mathcal{L}(\\mathbf{u}, \\boldsymbol{\\lambda}; \\mathbf{v}) = h\\boldsymbol{\\gamma}^{\\top}\\mathbf{v}(T) - \\int_{0}^{T} \\boldsymbol{\\lambda}^{\\top} (M\\dot{\\mathbf{v}} - S\\mathbf{v}) \\,\\mathrm{d}t = 0 $$\nIntegrate the term with $\\dot{\\mathbf{v}}$ by parts in time:\n$$ \\int_{0}^{T} \\boldsymbol{\\lambda}^{\\top} M \\dot{\\mathbf{v}} \\,\\mathrm{d}t = [\\boldsymbol{\\lambda}^{\\top}M\\mathbf{v}]_{0}^{T} - \\int_{0}^{T} \\dot{\\boldsymbol{\\lambda}}^{\\top}M\\mathbf{v} \\,\\mathrm{d}t = \\boldsymbol{\\lambda}(T)^{\\top}M\\mathbf{v}(T) - \\boldsymbol{\\lambda}(0)^{\\top}M\\mathbf{v}(0) - \\int_{0}^{T} \\dot{\\boldsymbol{\\lambda}}^{\\top}M\\mathbf{v} \\,\\mathrm{d}t $$\nAssuming fixed initial data, any perturbation $\\mathbf{v}$ must be zero at $t=0$, so $\\mathbf{v}(0)=\\mathbf{0}$. The stationarity condition becomes:\n$$ h\\boldsymbol{\\gamma}^{\\top}\\mathbf{v}(T) - \\boldsymbol{\\lambda}(T)^{\\top}M\\mathbf{v}(T) + \\int_{0}^{T} (\\dot{\\boldsymbol{\\lambda}}^{\\top}M + \\boldsymbol{\\lambda}^{\\top}S)\\mathbf{v} \\,\\mathrm{d}t = 0 $$\nThis must hold for all arbitrary (admissible) perturbations $\\mathbf{v}(t)$. This implies the coefficients of $\\mathbf{v}(T)$ and the integrand must be zero.\n\nTerminal condition (from the term at $t=T$):\n$$ (h\\boldsymbol{\\gamma}^{\\top} - \\boldsymbol{\\lambda}(T)^{\\top}M)\\mathbf{v}(T) = 0 \\implies \\boldsymbol{\\lambda}(T)^{\\top}M = h\\boldsymbol{\\gamma}^{\\top} $$\nSince $M=hI$, we have $h\\boldsymbol{\\lambda}(T)^{\\top} = h\\boldsymbol{\\gamma}^{\\top}$, which gives $\\boldsymbol{\\lambda}(T) = \\boldsymbol{\\gamma}$.\n\nAdjoint ODE (from the integral term):\n$$ \\dot{\\boldsymbol{\\lambda}}^{\\top}M + \\boldsymbol{\\lambda}^{\\top}S = \\mathbf{0}^{\\top} $$\nTaking the transpose and noting $M$ is symmetric ($M^{\\top}=M=hI$):\n$$ M\\dot{\\boldsymbol{\\lambda}} + S^{\\top}\\boldsymbol{\\lambda} = \\mathbf{0} \\implies h\\frac{d\\boldsymbol{\\lambda}}{dt} = -S^{\\top}\\boldsymbol{\\lambda} $$\nThis is the discrete adjoint ODE.\n\n**3. Adjoint Consistency and Symmetry Properties**\n\nAdjoint consistency refers to the fact that the discrete adjoint operator is the transpose of the discrete primal operator. Our derivation via the Lagrangian formalism inherently produces this result. The primal spatial operator is represented by the matrix $S$, and the adjoint spatial operator is represented by $S^{\\top}$.\n\nThe matrix $S$ is derived from the spatial bilinear form $B(u,v)$ of the DG discretization, such that the semi-discrete system is $M\\dot{\\mathbf{u}} = S\\mathbf{u}$, where the RHS corresponds to the assemblage of spatial terms applied to the test function. The total contribution from interface fluxes to the weak form is $\\sum_i v_i (\\hat{f}_{i+1/2} - \\hat{f}_{i-1/2})$. For our problem, this assemblage resulted in a term $B(u,v)=\\mathbf{v}^{\\top}S\\mathbf{u}$.\n\nLet's compute $S^{\\top}$:\n$$ S = a \\begin{pmatrix} -1 & 1 \\\\ 1 & -1 \\end{pmatrix}, \\quad S^{\\top} = a \\begin{pmatrix} -1 & 1 \\\\ 1 & -1 \\end{pmatrix}^{\\top} = a \\begin{pmatrix} -1 & 1 \\\\ 1 & -1 \\end{pmatrix} = S $$\nFor this specific problem, the spatial matrix $S$ is symmetric. This means the primal and adjoint spatial operators are identical: $h\\dot{\\boldsymbol{\\lambda}} = -S\\boldsymbol{\\lambda}$.\n\nThis symmetry is a special property of the $N=2$ periodic case with $P^0$ elements. The bilinear form arising from the interface fluxes is $B_{flux}(u,v) = a(u_1-u_2)(v_1-v_2)$. This form is symmetric in $u$ and $v$ (i.e., $B_{flux}(u,v)=B_{flux}(v,u)$), which leads to a symmetric matrix $S$. The choice of the upwind flux leads to this specific bilinear form. For a general numerical flux, or for $N>2$ cells, the resulting matrix $S$ is typically not symmetric. The symmetry of the spatial operator is a key property often desired in goal-oriented error estimation, although not strictly required. The fundamental property, adjoint consistency ($S \\to S^{\\top}$), holds regardless of this symmetry.\n\n**4. Explicit Matrix for the Adjoint ODE**\n\nThe discrete adjoint ODE is $h\\dot{\\boldsymbol{\\lambda}} = -S^{\\top}\\boldsymbol{\\lambda}$. The matrix multiplying $\\boldsymbol{\\lambda}(t)$ in the ODE $\\dot{\\boldsymbol{\\lambda}}(t) = \\dots$ is $-\\frac{1}{h}S^{\\top}$.\nAs shown, $S^{\\top}=S=a\\begin{pmatrix} -1 & 1 \\\\ 1 & -1 \\end{pmatrix}$.\nTherefore, the matrix is:\n$$ -\\frac{1}{h}S^{\\top} = -\\frac{a}{h} \\begin{pmatrix} -1 & 1 \\\\ 1 & -1 \\end{pmatrix} = \\frac{a}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} $$\nThis is the explicit closed-form expression for the constant $2\\times 2$ matrix multiplying $\\boldsymbol{\\lambda}(t)$ in the discrete adjoint ODE.", "answer": "$$\n\\boxed{\n\\frac{a}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}\n}\n$$", "id": "3377328"}]}