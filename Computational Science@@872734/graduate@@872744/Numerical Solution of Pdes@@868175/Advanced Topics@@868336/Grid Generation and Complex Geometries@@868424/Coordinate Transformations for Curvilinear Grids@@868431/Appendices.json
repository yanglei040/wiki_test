{"hands_on_practices": [{"introduction": "The first step in analyzing any curvilinear coordinate system is to compute its metric tensor, which mathematically describes the local geometry of the transformation. This foundational exercise guides you through calculating the covariant and contravariant metric tensors ($g_{ij}$ and $g^{ij}$) for the familiar polar coordinate system directly from first principles, providing a concrete link between abstract definitions and a tangible example. [@problem_id:3375279]", "problem": "Consider a two-dimensional curvilinear coordinate mapping from polar coordinates $(r,\\theta)$ to Cartesian coordinates $(x,y)$ given by $(x,y)=(r\\cos\\theta,r\\sin\\theta)$ on the punctured plane $r>0$. In the context of transforming partial differential equations (PDE) between coordinate systems for numerical solution on curvilinear grids, start from the following fundamental base:\n\n- The covariant basis vectors are defined by $\\boldsymbol{a}_{i}=\\partial\\boldsymbol{x}/\\partial\\xi^{i}$, where $\\boldsymbol{x}=(x,y)$ and $\\xi^{1}=r$, $\\xi^{2}=\\theta$.\n- The covariant metric tensor components are defined by $g_{ij}=\\boldsymbol{a}_{i}\\cdot\\boldsymbol{a}_{j}$.\n- The contravariant metric tensor components are defined by $g^{ij}$ such that $g^{ik}g_{kj}=\\delta^{i}_{\\;j}$, where $\\delta^{i}_{\\;j}$ is the Kronecker delta.\n- For orthogonal coordinates, the scale factors are $h_{i}=\\sqrt{g_{ii}}$.\n\nUsing only these definitions, derive the covariant metric tensor $g_{ij}(r,\\theta)$ and its inverse $g^{ij}(r,\\theta)$ for the given mapping, and recover the scale factors $h_{r}$ and $h_{\\theta}$. Assume $\\theta$ is measured in radians. Express your final answer as a single row matrix listing, in order,\n$g_{rr}$, $g_{r\\theta}$, $g_{\\theta r}$, $g_{\\theta\\theta}$, $g^{rr}$, $g^{r\\theta}$, $g^{\\theta r}$, $g^{\\theta\\theta}$, $h_{r}$, $h_{\\theta}$.\nNo rounding is required.", "solution": "The problem is validated as self-contained, scientifically grounded, and well-posed. The task is to derive the covariant and contravariant metric tensors, along with the scale factors, for a polar coordinate system based on fundamental definitions.\n\nThe Cartesian coordinates $(x,y)$ are given as functions of the curvilinear coordinates $(\\xi^{1}, \\xi^{2}) = (r, \\theta)$ by the mapping:\n$$x(r,\\theta) = r\\cos\\theta$$\n$$y(r,\\theta) = r\\sin\\theta$$\nThe position vector $\\boldsymbol{x}$ in the Cartesian basis $(\\boldsymbol{i}, \\boldsymbol{j})$ is therefore:\n$$\\boldsymbol{x}(r, \\theta) = (r\\cos\\theta)\\boldsymbol{i} + (r\\sin\\theta)\\boldsymbol{j}$$\n\nThe covariant basis vectors, $\\boldsymbol{a}_{i} = \\frac{\\partial\\boldsymbol{x}}{\\partial\\xi^{i}}$, are calculated by taking partial derivatives of the position vector with respect to each curvilinear coordinate.\n\nFor $\\xi^{1} = r$:\n$$\\boldsymbol{a}_{1} = \\boldsymbol{a}_{r} = \\frac{\\partial\\boldsymbol{x}}{\\partial r} = \\frac{\\partial}{\\partial r}\\left((r\\cos\\theta)\\boldsymbol{i} + (r\\sin\\theta)\\boldsymbol{j}\\right) = (\\cos\\theta)\\boldsymbol{i} + (\\sin\\theta)\\boldsymbol{j}$$\n\nFor $\\xi^{2} = \\theta$:\n$$\\boldsymbol{a}_{2} = \\boldsymbol{a}_{\\theta} = \\frac{\\partial\\boldsymbol{x}}{\\partial \\theta} = \\frac{\\partial}{\\partial \\theta}\\left((r\\cos\\theta)\\boldsymbol{i} + (r\\sin\\theta)\\boldsymbol{j}\\right) = (-r\\sin\\theta)\\boldsymbol{i} + (r\\cos\\theta)\\boldsymbol{j}$$\n\nThe components of the covariant metric tensor, $g_{ij} = \\boldsymbol{a}_{i} \\cdot \\boldsymbol{a}_{j}$, are found by computing the dot products of these basis vectors.\n\nComponent $g_{11} = g_{rr}$:\n$$g_{rr} = \\boldsymbol{a}_{r} \\cdot \\boldsymbol{a}_{r} = ((\\cos\\theta)\\boldsymbol{i} + (\\sin\\theta)\\boldsymbol{j}) \\cdot ((\\cos\\theta)\\boldsymbol{i} + (\\sin\\theta)\\boldsymbol{j})$$\n$$g_{rr} = \\cos^{2}\\theta + \\sin^{2}\\theta = 1$$\n\nComponent $g_{12} = g_{r\\theta}$:\n$$g_{r\\theta} = \\boldsymbol{a}_{r} \\cdot \\boldsymbol{a}_{\\theta} = ((\\cos\\theta)\\boldsymbol{i} + (\\sin\\theta)\\boldsymbol{j}) \\cdot ((-r\\sin\\theta)\\boldsymbol{i} + (r\\cos\\theta)\\boldsymbol{j})$$\n$$g_{r\\theta} = (\\cos\\theta)(-r\\sin\\theta) + (\\sin\\theta)(r\\cos\\theta) = -r\\cos\\theta\\sin\\theta + r\\sin\\theta\\cos\\theta = 0$$\n\nComponent $g_{21} = g_{\\theta r}$:\nThe metric tensor is symmetric, so $g_{\\theta r} = g_{r\\theta}$.\n$$g_{\\theta r} = 0$$\n\nComponent $g_{22} = g_{\\theta\\theta}$:\n$$g_{\\theta\\theta} = \\boldsymbol{a}_{\\theta} \\cdot \\boldsymbol{a}_{\\theta} = ((-r\\sin\\theta)\\boldsymbol{i} + (r\\cos\\theta)\\boldsymbol{j}) \\cdot ((-r\\sin\\theta)\\boldsymbol{i} + (r\\cos\\theta)\\boldsymbol{j})$$\n$$g_{\\theta\\theta} = (-r\\sin\\theta)^{2} + (r\\cos\\theta)^{2} = r^{2}\\sin^{2}\\theta + r^{2}\\cos^{2}\\theta = r^{2}(\\sin^{2}\\theta + \\cos^{2}\\theta) = r^{2}$$\n\nThe covariant metric tensor, represented as a matrix, is:\n$$[g_{ij}] = \\begin{pmatrix} g_{rr} & g_{r\\theta} \\\\ g_{\\theta r} & g_{\\theta\\theta} \\end{pmatrix} = \\begin{pmatrix} 1 & 0 \\\\ 0 & r^{2} \\end{pmatrix}$$\nSince the off-diagonal components ($g_{r\\theta}$, $g_{\\theta r}$) are zero, the coordinate system is orthogonal.\n\nThe contravariant metric tensor, $[g^{ij}]$, is the inverse of the covariant metric tensor, $[g_{ij}]$. For a $2 \\times 2$ diagonal matrix, the inverse is found by taking the reciprocal of each diagonal element.\n$$[g^{ij}] = [g_{ij}]^{-1} = \\begin{pmatrix} 1 & 0 \\\\ 0 & r^{2} \\end{pmatrix}^{-1} = \\begin{pmatrix} 1^{-1} & 0 \\\\ 0 & (r^{2})^{-1} \\end{pmatrix} = \\begin{pmatrix} 1 & 0 \\\\ 0 & \\frac{1}{r^{2}} \\end{pmatrix}$$\nThe components of the contravariant metric tensor are:\n$$g^{rr} = 1$$\n$$g^{r\\theta} = 0$$\n$$g^{\\theta r} = 0$$\n$$g^{\\theta\\theta} = \\frac{1}{r^{2}}$$\n\nFinally, for orthogonal coordinates, the scale factors $h_{i}$ are defined as $h_{i} = \\sqrt{g_{ii}}$.\nThe scale factor for the $r$-coordinate is:\n$$h_{r} = \\sqrt{g_{rr}} = \\sqrt{1} = 1$$\nThe scale factor for the $\\theta$-coordinate is:\n$$h_{\\theta} = \\sqrt{g_{\\theta\\theta}} = \\sqrt{r^{2}}$$\nGiven the problem statement specifies $r>0$, we have $|r|=r$.\n$$h_{\\theta} = r$$\n\nThe required quantities in the specified order are:\n$g_{rr} = 1$\n$g_{r\\theta} = 0$\n$g_{\\theta r} = 0$\n$g_{\\theta\\theta} = r^{2}$\n$g^{rr} = 1$\n$g^{r\\theta} = 0$\n$g^{\\theta r} = 0$\n$g^{\\theta\\theta} = \\frac{1}{r^{2}}$\n$h_{r} = 1$\n$h_{\\theta} = r$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 & 0 & 0 & r^2 & 1 & 0 & 0 & \\frac{1}{r^2} & 1 & r\n\\end{pmatrix}\n}\n$$", "id": "3375279"}, {"introduction": "Once the grid geometry is described, the next question is how it impacts the accuracy of our numerical scheme. This practice delves into the analysis of truncation error for a derivative approximated on a curvilinear grid. By deriving a metric-weighted finite-difference scheme and examining its leading-order error, you will see explicitly how the grid's curvature, captured by the mapping's derivatives, introduces new terms into the local error formula. [@problem_id:3375257]", "problem": "Let a smooth bijective mapping from computational coordinates $(\\xi,\\eta)$ to physical coordinates $(x,y)$ be given by $(x,y) = (x(\\xi,\\eta), y(\\xi,\\eta))$ with Jacobian determinant $J(\\xi,\\eta) = x_{\\xi} y_{\\eta} - x_{\\eta} y_{\\xi} \\neq 0$. Consider a scalar field $u(x,y)$ satisfying a partial differential equation (PDE) on a curvilinear grid obtained by this mapping. The computational grid is uniform with spacings $h$ in $\\xi$ and $k$ in $\\eta$. Using only the multivariable chain rule and Taylor expansions for central differences, do the following:\n\n- Derive a metric-weighted central-difference approximation to the physical derivative $\\partial_{x} u$ at a grid point $(\\xi,\\eta)$ in terms of the computational derivatives $\\partial_{\\xi} u$ and $\\partial_{\\eta} u$, and the mapping metrics $x_{\\xi}$, $x_{\\eta}$, $y_{\\xi}$, $y_{\\eta}$, and $J$. Assume that the mapping metrics are evaluated exactly at the grid point (no discretization error in metrics), and that $\\partial_{\\xi} u$ and $\\partial_{\\eta} u$ are approximated by standard second-order accurate central differences on the uniform computational grid.\n\n- Specialize to the concrete mapping and field\n$$\nx(\\xi,\\eta) = \\xi + a\\,\\xi^{3}, \\qquad y(\\xi,\\eta) = \\eta + b\\,\\xi\\,\\eta, \\qquad u(x,y) = \\exp(x)\\,\\cos(y),\n$$\nwith fixed real parameters $a$ and $b$. At the computational grid point $(\\xi,\\eta) = (0,0)$, compute the leading-order truncation error of your metric-weighted central-difference approximation to $\\partial_{x} u$, defined as\n$$\n\\text{TE} := \\left(\\partial_{x} u\\right)_{\\text{approx}} - \\left(\\partial_{x} u\\right)_{\\text{exact}},\n$$\nretaining the lowest nonzero power(s) of $h$ and $k$.\n\nProvide your final answer as a single closed-form expression in terms of $a$ and $h$ only. No rounding is required. State no units. Angles, if any, are in radians.", "solution": "The user has provided a valid, well-posed problem in the field of numerical analysis for partial differential equations. The problem will be solved in two parts as requested.\n\n### Part 1: Derivation of the Metric-Weighted Central-Difference Approximation\n\nLet the scalar field be represented as $u(x(\\xi, \\eta), y(\\xi, \\eta))$. The multivariable chain rule relates the derivatives in the computational coordinates $(\\xi, \\eta)$ to the derivatives in the physical coordinates $(x,y)$.\nThe first-order partial derivatives are given by:\n$$\n\\frac{\\partial u}{\\partial \\xi} = \\frac{\\partial u}{\\partial x} \\frac{\\partial x}{\\partial \\xi} + \\frac{\\partial u}{\\partial y} \\frac{\\partial y}{\\partial \\xi}\n$$\n$$\n\\frac{\\partial u}{\\partial \\eta} = \\frac{\\partial u}{\\partial x} \\frac{\\partial x}{\\partial \\eta} + \\frac{\\partial u}{\\partial y} \\frac{\\partial y}{\\partial \\eta}\n$$\nUsing the subscript notation for partial derivatives (e.g., $u_x = \\partial_x u$), this can be written as a linear system for the physical derivatives $(u_x, u_y)$:\n$$\n\\begin{pmatrix}\nx_{\\xi} & y_{\\xi} \\\\\nx_{\\eta} & y_{\\eta}\n\\end{pmatrix}\n\\begin{pmatrix}\nu_x \\\\\nu_y\n\\end{pmatrix}\n=\n\\begin{pmatrix}\nu_{\\xi} \\\\\nu_{\\eta}\n\\end{pmatrix}\n$$\nThe determinant of the coefficient matrix is the Jacobian of the transformation, $J = x_{\\xi} y_{\\eta} - x_{\\eta} y_{\\xi}$. Since the mapping is bijective, $J \\neq 0$, and we can solve this system. Using Cramer's rule to solve for $u_x = \\partial_x u$:\n$$\nu_x = \\frac{\\det \\begin{pmatrix} u_{\\xi} & y_{\\xi} \\\\ u_{\\eta} & y_{\\eta} \\end{pmatrix}}{J} = \\frac{u_{\\xi} y_{\\eta} - u_{\\eta} y_{\\xi}}{J}\n$$\nThis is the exact analytical relationship.\n\nThe problem requires a central-difference approximation. Let the computational grid be uniform with step sizes $h$ in $\\xi$ and $k$ in $\\eta$. The standard second-order central difference operators, which we denote by $\\delta_{\\xi}$ and $\\delta_{\\eta}$, are:\n$$\n\\delta_{\\xi} u(\\xi, \\eta) = \\frac{u(\\xi+h, \\eta) - u(\\xi-h, \\eta)}{2h} \\approx u_{\\xi}\n$$\n$$\n\\delta_{\\eta} u(\\xi, \\eta) = \\frac{u(\\xi, \\eta+k) - u(\\xi, \\eta-k)}{2k} \\approx u_{\\eta}\n$$\nThe metric-weighted central-difference approximation for $\\partial_x u$, denoted $(\\partial_x u)_{\\text{approx}}$, is obtained by substituting these discrete operators into the analytical expression for $u_x$. The metrics $x_{\\xi}, y_{\\xi}, x_{\\eta}, y_{\\eta}$ and the Jacobian $J$ are evaluated exactly at the point $(\\xi, \\eta)$.\n$$\n(\\partial_x u)_{\\text{approx}} = \\frac{y_{\\eta} (\\delta_{\\xi} u) - y_{\\xi} (\\delta_{\\eta} u)}{J}\n$$\nThis completes the first part of the problem.\n\n### Part 2: Leading-Order Truncation Error Calculation\n\nThe truncation error (TE) is defined as $\\text{TE} := (\\partial_{x} u)_{\\text{approx}} - (\\partial_{x} u)_{\\text{exact}}$.\nSubstituting the expressions for the approximate and exact derivatives:\n$$\n\\text{TE} = \\left( \\frac{y_{\\eta} (\\delta_{\\xi} u) - y_{\\xi} (\\delta_{\\eta} u)}{J} \\right) - \\left( \\frac{y_{\\eta} u_{\\xi} - y_{\\xi} u_{\\eta}}{J} \\right)\n$$\n$$\n\\text{TE} = \\frac{1}{J} \\left[ y_{\\eta} (\\delta_{\\xi} u - u_{\\xi}) - y_{\\xi} (\\delta_{\\eta} u - u_{\\eta}) \\right]\n$$\nTo find the leading-order term of the TE, we use Taylor series expansions for the central difference operators. For a sufficiently smooth function $u$:\n$$\n\\delta_{\\xi} u = u_{\\xi} + \\frac{h^2}{6} u_{\\xi\\xi\\xi} + \\frac{h^4}{120} u_{\\xi\\xi\\xi\\xi\\xi} + \\dots\n$$\n$$\n\\delta_{\\eta} u = u_{\\eta} + \\frac{k^2}{6} u_{\\eta\\eta\\eta} + \\frac{k^4}{120} u_{\\eta\\eta\\eta\\eta\\eta} + \\dots\n$$\nThe errors in the difference operators are:\n$$\n\\delta_{\\xi} u - u_{\\xi} = \\frac{h^2}{6} u_{\\xi\\xi\\xi} + O(h^4)\n$$\n$$\n\\delta_{\\eta} u - u_{\\eta} = \\frac{k^2}{6} u_{\\eta\\eta\\eta} + O(k^4)\n$$\nSubstituting these into the expression for TE, the leading-order term is:\n$$\n\\text{TE} \\approx \\frac{1}{6J} \\left( h^2 y_{\\eta} u_{\\xi\\xi\\xi} - k^2 y_{\\xi} u_{\\eta\\eta\\eta} \\right)\n$$\nNow, we must evaluate this expression at the point $(\\xi, \\eta) = (0,0)$ for the given mapping and scalar field.\n\n**Mapping and Field Specifics at $(\\xi, \\eta)=(0,0)$:**\nThe mapping is $x(\\xi,\\eta) = \\xi + a\\,\\xi^{3}$ and $y(\\xi,\\eta) = \\eta + b\\,\\xi\\,\\eta$.\nThe scalar field is $u(x,y) = \\exp(x)\\,\\cos(y)$.\nAt $(\\xi, \\eta) = (0,0)$, the physical location is $(x,y) = (0,0)$.\n\n**Metrics at $(\\xi, \\eta)=(0,0)$:**\n$x_{\\xi} = 1 + 3a\\xi^2 \\implies x_{\\xi}(0,0) = 1$\n$x_{\\eta} = 0 \\implies x_{\\eta}(0,0) = 0$\n$y_{\\xi} = b\\eta \\implies y_{\\xi}(0,0) = 0$\n$y_{\\eta} = 1+b\\xi \\implies y_{\\eta}(0,0) = 1$\nThe Jacobian at $(0,0)$ is $J(0,0) = x_{\\xi}y_{\\eta} - x_{\\eta}y_{\\xi} = (1)(1) - (0)(0) = 1$.\n\nSubstituting these metric values into the TE expression:\n$$\n\\text{TE}|_{(0,0)} \\approx \\frac{1}{6(1)} \\left( h^2 (1) u_{\\xi\\xi\\xi}|_{(0,0)} - k^2 (0) u_{\\eta\\eta\\eta}|_{(0,0)} \\right) = \\frac{h^2}{6} u_{\\xi\\xi\\xi}|_{(0,0)}\n$$\nThe calculation reduces to finding the third partial derivative of $u$ with respect to $\\xi$, evaluated at $(0,0)$.\n\n**Higher-Order Computational Derivatives:**\nWe use the chain rule operator $\\partial_{\\xi} = x_{\\xi} \\partial_x + y_{\\xi} \\partial_y$.\n$\\partial_{\\xi}^2 u = \\partial_{\\xi}(\\partial_{\\xi}u) = \\partial_{\\xi}(x_{\\xi} u_x + y_{\\xi} u_y)$. Applying the product rule and chain rule again:\n$\\partial_{\\xi}^2 u = (\\partial_{\\xi}x_{\\xi}) u_x + x_{\\xi} (\\partial_{\\xi}u_x) + (\\partial_{\\xi}y_{\\xi}) u_y + y_{\\xi} (\\partial_{\\xi}u_y)$\n$\\partial_{\\xi}^2 u = x_{\\xi\\xi} u_x + y_{\\xi\\xi} u_y + x_{\\xi}^2 u_{xx} + 2x_{\\xi}y_{\\xi} u_{xy} + y_{\\xi}^2 u_{yy}$.\n\nTo find $\\partial_{\\xi}^3 u$, we apply $\\partial_{\\xi}$ to $\\partial_{\\xi}^2 u$. This is algebraically intensive, but many terms vanish when evaluated at $(\\xi, \\eta)=(0,0)$, where $y_{\\xi}=0$, $x_{\\xi}=1$, and $\\partial_{\\xi}$ acts as $\\partial_x$.\nLet's find the necessary metric derivatives:\n$x_{\\xi\\xi} = 6a\\xi \\implies x_{\\xi\\xi}(0,0) = 0$\n$x_{\\xi\\xi\\xi} = 6a$\n$y_{\\xi\\xi} = 0$, $y_{\\xi\\xi\\xi}=0$.\n\nLet's evaluate $\\partial_{\\xi}^3 u = \\partial_{\\xi}(\\partial_{\\xi}^2 u)|_{(0,0)}$ term by term:\n$\\partial_{\\xi}^3 u = \\partial_{\\xi}(x_{\\xi\\xi} u_x) + \\partial_{\\xi}(y_{\\xi\\xi} u_y) + \\partial_{\\xi}(x_{\\xi}^2 u_{xx}) + \\partial_{\\xi}(2x_{\\xi}y_{\\xi} u_{xy}) + \\partial_{\\xi}(y_{\\xi}^2 u_{yy})$\nAt $(\\xi, \\eta)=(0,0)$:\n1. $\\partial_{\\xi}(x_{\\xi\\xi} u_x) = (\\partial_{\\xi}x_{\\xi\\xi})u_x + x_{\\xi\\xi}(\\partial_{\\xi}u_x) = x_{\\xi\\xi\\xi}u_x + x_{\\xi\\xi}(x_{\\xi}u_{xx} + y_{\\xi}u_{xy})$.\n   At $(0,0)$: $(6a)u_x|_{(0,0)} + (0)(\\dots) = 6a u_x|_{(0,0)}$.\n2. $y_{\\xi\\xi}=0$, so the term $\\partial_{\\xi}(y_{\\xi\\xi} u_y)$ is zero everywhere.\n3. $\\partial_{\\xi}(x_{\\xi}^2 u_{xx}) = (\\partial_{\\xi}x_{\\xi}^2)u_{xx} + x_{\\xi}^2(\\partial_{\\xi}u_{xx}) = (2x_{\\xi}x_{\\xi\\xi})u_{xx} + x_{\\xi}^2(x_{\\xi}u_{xxx}+y_{\\xi}u_{xxy})$.\n   At $(0,0)$: $(2(1)(0))u_{xx} + (1)^2((1)u_{xxx} + (0)u_{xxy}) = u_{xxx}|_{(0,0)}$.\n4. The terms involving $2x_{\\xi}y_{\\xi}$ and $y_{\\xi}^2$ are zero at $(\\xi, \\eta)=(0,0)$ because $y_{\\xi}(0,0)=0$. Their derivatives with respect to $\\xi$ also vanish at $(0,0)$ since $y_{\\xi\\xi}=0$.\n\nCombining the non-zero contributions:\n$$\nu_{\\xi\\xi\\xi}|_{(0,0)} = 6a u_x|_{(0,0)} + u_{xxx}|_{(0,0)}\n$$\n\n**Physical Derivatives of $u(x,y)$ at $(0,0)$:**\nThe field is $u(x,y) = \\exp(x)\\cos(y)$. At $(x,y)=(0,0)$:\n$u_x = \\exp(x)\\cos(y) \\implies u_x(0,0) = \\exp(0)\\cos(0) = 1$.\n$u_{xxx} = \\exp(x)\\cos(y) \\implies u_{xxx}(0,0) = \\exp(0)\\cos(0) = 1$.\n\nSubstituting these values:\n$$\nu_{\\xi\\xi\\xi}|_{(0,0)} = 6a(1) + 1 = 6a+1\n$$\n\n**Final Truncation Error:**\nFinally, substitute this result into the expression for the truncation error:\n$$\n\\text{TE}|_{(0,0)} \\approx \\frac{h^2}{6} u_{\\xi\\xi\\xi}|_{(0,0)} = \\frac{h^2}{6} (6a+1)\n$$\n$$\n\\text{TE} \\approx a h^2 + \\frac{1}{6}h^2\n$$\nThis is the leading-order truncation error, which is of order $O(h^2)$, and depends on the parameters $a$ and $h$ as requested.", "answer": "$$\\boxed{a h^{2} + \\frac{1}{6}h^{2}}$$", "id": "3375257"}, {"introduction": "Beyond local accuracy, a robust numerical scheme must also preserve fundamental global properties, such as maintaining a uniform flow field (free-stream). This advanced coding exercise introduces the Geometric Conservation Law (GCL), a critical consistency condition that can be violated if metric terms and flux divergences are discretized with different orders of accuracy. Through a combination of analysis and implementation, you will quantify this violation and discover how to correct it, highlighting a crucial aspect of high-fidelity simulations on complex grids. [@problem_id:3375264]", "problem": "Consider the two-dimensional conservative transport of a passive scalar on a smooth curvilinear grid. Let the computational coordinates be $(\\xi,\\eta)\\in[0,1)\\times[0,1)$ with periodic boundaries, and let the mapping to physical space be given by\n$$\nx(\\xi,\\eta) = \\xi + \\alpha \\sin(2\\pi \\xi)\\sin(2\\pi \\eta),\\qquad\ny(\\xi,\\eta) = \\eta + \\alpha \\cos(2\\pi \\xi)\\sin(2\\pi \\eta),\n$$\nfor a prescribed distortion amplitude $\\alpha\\in\\mathbb{R}$. The Jacobian is\n$$\nJ(\\xi,\\eta) = x_\\xi y_\\eta - x_\\eta y_\\xi.\n$$\nFor a constant physical advection velocity $(u,v)\\in\\mathbb{R}^2$ and a conservative formulation in computational space, the equation for a scalar field $q(\\xi,\\eta,t)$ is\n$$\n\\frac{\\partial q}{\\partial t} + \\frac{1}{J}\\left(\\frac{\\partial}{\\partial \\xi}\\big(\\tilde U\\,q\\big)+\\frac{\\partial}{\\partial \\eta}\\big(\\tilde V\\,q\\big)\\right)=0,\n$$\nwhere the contravariant metric-weighted velocity components are\n$$\n\\tilde U = u\\,y_\\eta - v\\,x_\\eta,\\qquad \\tilde V = -u\\,y_\\xi + v\\,x_\\xi.\n$$\nA uniform solution $q(\\xi,\\eta,t)\\equiv q_0$ should be preserved exactly by a consistent discrete scheme; this is known as Free-Stream Preservation (FSP). On a nodal grid with uniform spacing $h_\\xi=h_\\eta=1/N$, let $D_\\xi^{(p)}$ and $D_\\eta^{(p)}$ be periodic central-difference derivative operators of order $p\\in\\{2,4,6\\}$ in $\\xi$ and $\\eta$, respectively. Consider the semi-discrete residual for the uniform state $q\\equiv 1$,\n$$\n\\mathcal{R}=\\frac{1}{J}\\left(D_\\xi^{(p_{\\rm flux})}\\,\\tilde U_m + D_\\eta^{(p_{\\rm flux})}\\,\\tilde V_m\\right),\n$$\nwhere the divergence is computed with order $p_{\\rm flux}$ but the metric terms used to build $\\tilde U_m,\\tilde V_m$ are obtained from discrete derivatives of order $p_{\\rm metric}$, i.e.,\n$$\n\\tilde U_m = u\\,\\big(D_\\eta^{(p_{\\rm metric})}y\\big) - v\\,\\big(D_\\eta^{(p_{\\rm metric})}x\\big),\\qquad\n\\tilde V_m = -u\\,\\big(D_\\xi^{(p_{\\rm metric})}y\\big)+ v\\,\\big(D_\\xi^{(p_{\\rm metric})}x\\big).\n$$\nStarting from the core definitions of coordinate transformations and the conservative transport law, and using only the properties of periodic central-difference operators, you must:\n\n- Derive the discrete FSP condition in terms of the discrete metric identity that must hold to ensure $\\mathcal{R}\\equiv 0$ for $q\\equiv 1$.\n- Explain why a mismatch $p_{\\rm metric}\\neq p_{\\rm flux}$ generically violates this condition.\n- Propose a correction that restores discrete FSP without changing $p_{\\rm flux}$ for the flux divergence.\n\nThen, implement a program that:\n\n- Constructs a uniform periodic grid with $N\\times N$ nodes in $(\\xi,\\eta)$ for specified $N$.\n- Implements $D^{(p)}$ as periodic central differences of order $p\\in\\{2,4,6\\}$ using standard nodal stencils and uniform spacing $h=1/N$.\n- Computes $x(\\xi,\\eta)$ and $y(\\xi,\\eta)$ from the given mapping for a specified $\\alpha$.\n- Forms $\\tilde U_m,\\tilde V_m$ using $p_{\\rm metric}$ and computes the residual $\\mathcal{R}$ using $p_{\\rm flux}$.\n- Quantifies the violation of FSP by returning the maximum absolute value $\\|\\mathcal{R}\\|_\\infty$ over the grid as a floating-point number.\n- Implements your proposed correction and computes the corrected residual $\\mathcal{R}_{\\rm corr}$ and its $\\|\\mathcal{R}_{\\rm corr}\\|_\\infty$.\n\nFor normalization, evaluate $J(\\xi,\\eta)$ analytically from the mapping by differentiating $x(\\xi,\\eta)$ and $y(\\xi,\\eta)$ exactly:\n$$\nx_\\xi=1+\\alpha(2\\pi)\\cos(2\\pi\\xi)\\sin(2\\pi\\eta),\\quad\nx_\\eta=\\alpha(2\\pi)\\sin(2\\pi\\xi)\\cos(2\\pi\\eta),\n$$\n$$\ny_\\xi=-\\alpha(2\\pi)\\sin(2\\pi\\xi)\\sin(2\\pi\\eta),\\quad\ny_\\eta=1+\\alpha(2\\pi)\\cos(2\\pi\\xi)\\cos(2\\pi\\eta),\n$$\nand then $J=x_\\xi y_\\eta - x_\\eta y_\\xi$. All trigonometric functions use angles in radians.\n\nTest Suite. Your program must compute and aggregate the following five cases, reporting each result as a floating-point number:\n\n- Case $1$ (mismatch, happy path): $N=64$, $\\alpha=0.2$, $u=1.0$, $v=0.5$, $p_{\\rm flux}=4$, $p_{\\rm metric}=2$. Report $\\|\\mathcal{R}\\|_\\infty$.\n- Case $2$ (matched orders): $N=64$, $\\alpha=0.2$, $u=1.0$, $v=0.5$, $p_{\\rm flux}=4$, $p_{\\rm metric}=4$. Report $\\|\\mathcal{R}\\|_\\infty$.\n- Case $3$ (stronger mismatch on odd grid): $N=63$, $\\alpha=0.3$, $u=-0.8$, $v=0.3$, $p_{\\rm flux}=6$, $p_{\\rm metric}=2$. Report $\\|\\mathcal{R}\\|_\\infty$.\n- Case $4$ (apply your correction to Case $1$): use $N=64$, $\\alpha=0.2$, $u=1.0$, $v=0.5$, $p_{\\rm flux}=4$, and construct $\\tilde U,\\tilde V$ by your correction. Report $\\|\\mathcal{R}_{\\rm corr}\\|_\\infty$.\n- Case $5$ (edge case, straight grid): $N=32$, $\\alpha=0.0$, $u=1.2$, $v=-0.7$, $p_{\\rm flux}=6$, $p_{\\rm metric}=2$. Report $\\|\\mathcal{R}\\|_\\infty$.\n\nFinal Output Format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[{\\rm result}_1,{\\rm result}_2,{\\rm result}_3,{\\rm result}_4,{\\rm result}_5]$). No physical unit conversion is required, and all results must be printed as floating-point numbers.", "solution": "The problem requires a derivation of the condition for Free-Stream Preservation (FSP) for a finite difference scheme on a curvilinear grid, an explanation for its failure when metric and flux derivative operators are inconsistent, and a proposal for a correction. This is to be followed by a numerical implementation to verify the analysis.\n\n### Part 1: Derivation of the Discrete Free-Stream Preservation Condition\n\nThe conservative transport equation for a scalar $q$ in the computational domain $(\\xi,\\eta)$ is given by:\n$$\n\\frac{\\partial q}{\\partial t} + \\frac{1}{J}\\left(\\frac{\\partial}{\\partial \\xi}\\big(\\tilde U\\,q\\big)+\\frac{\\partial}{\\partial \\eta}\\big(\\tilde V\\,q\\big)\\right)=0\n$$\nwhere $\\tilde U = u\\,y_\\eta - v\\,x_\\eta$ and $\\tilde V = -u\\,y_\\xi + v\\,x_\\xi$ are the contravariant metric-weighted velocity components for a constant physical velocity $(u,v)$.\n\nThe principle of Free-Stream Preservation (FSP) requires that a uniform flow field, $q(\\xi,\\eta,t) \\equiv q_0$ (where $q_0$ is a constant), must be an exact steady-state solution to the governing equations. Without loss of generality, we set $q_0=1$. For a steady state, $\\frac{\\partial q}{\\partial t} = 0$. Substituting $q=1$ into the equation yields the continuous FSP condition, often termed the Geometric Conservation Law (GCL):\n$$\n\\frac{1}{J}\\left(\\frac{\\partial \\tilde U}{\\partial \\xi} + \\frac{\\partial \\tilde V}{\\partial \\eta}\\right) = 0 \\implies \\frac{\\partial \\tilde U}{\\partial \\xi} + \\frac{\\partial \\tilde V}{\\partial \\eta} = 0\n$$\nSubstituting the definitions of $\\tilde U$ and $\\tilde V$, and noting that $u$ and $v$ are constants:\n$$\n\\frac{\\partial}{\\partial \\xi}(u\\,y_\\eta - v\\,x_\\eta) + \\frac{\\partial}{\\partial \\eta}(-u\\,y_\\xi + v\\,x_\\xi) = 0\n$$\n$$\nu\\left(\\frac{\\partial y_\\eta}{\\partial \\xi} - \\frac{\\partial y_\\xi}{\\partial \\eta}\\right) - v\\left(\\frac{\\partial x_\\eta}{\\partial \\xi} - \\frac{\\partial x_\\xi}{\\partial \\eta}\\right) = 0\n$$\nBy Clairaut's theorem for smooth mappings $x(\\xi,\\eta)$ and $y(\\xi,\\eta)$, the mixed partial derivatives are equal (e.g., $\\frac{\\partial^2 y}{\\partial \\xi \\partial \\eta} = \\frac{\\partial^2 y}{\\partial \\eta \\partial \\xi}$). This means $\\frac{\\partial y_\\eta}{\\partial \\xi} = \\frac{\\partial y_\\xi}{\\partial \\eta}$ and $\\frac{\\partial x_\\eta}{\\partial \\xi} = \\frac{\\partial x_\\xi}{\\partial \\eta}$. The expression above thus simplifies to $u(0) - v(0) = 0$, which holds true, confirming the continuous GCL.\n\nNow, we analyze the semi-discrete form. The residual for the uniform state $q=1$ is:\n$$\n\\mathcal{R}=\\frac{1}{J}\\left(D_\\xi^{(p_{\\rm flux})}\\,\\tilde U_m + D_\\eta^{(p_{\\rm flux})}\\,\\tilde V_m\\right)\n$$\nwhere $D_\\xi^{(p)}$ and $D_\\eta^{(p)}$ are discrete derivative operators of order $p$, and the discrete metric-weighted velocities are:\n$$\n\\tilde U_m = u\\,\\big(D_\\eta^{(p_{\\rm metric})}y\\big) - v\\,\\big(D_\\eta^{(p_{\\rm metric})}x\\big), \\qquad \\tilde V_m = -u\\,\\big(D_\\xi^{(p_{\\rm metric})}y\\big)+ v\\,\\big(D_\\xi^{(p_{\\rm metric})}x\\big)\n$$\nFor discrete FSP, the residual $\\mathcal{R}$ must be identically zero. This requires the discrete divergence to be zero:\n$$\nD_\\xi^{(p_{\\rm flux})}\\,\\tilde U_m + D_\\eta^{(p_{\\rm flux})}\\,\\tilde V_m = 0\n$$\nSubstituting the expressions for $\\tilde U_m$ and $\\tilde V_m$ and using the linearity of the discrete operators:\n$$\nD_\\xi^{(p_{\\rm flux})}\\left(u(D_\\eta^{(p_{\\rm metric})}y) - v(D_\\eta^{(p_{\\rm metric})}x)\\right) + D_\\eta^{(p_{\\rm flux})}\\left(-u(D_\\xi^{(p_{\\rm metric})}y) + v(D_\\xi^{(p_{\\rm metric})}x)\\right) = 0\n$$\n$$\nu\\left(D_\\xi^{(p_{\\rm flux})}D_\\eta^{(p_{\\rm metric})}y - D_\\eta^{(p_{\\rm flux})}D_\\xi^{(p_{\\rm metric})}y\\right) - v\\left(D_\\xi^{(p_{\\rm flux})}D_\\eta^{(p_{\\rm metric})}x - D_ \\eta^{(p_{\\rm flux})}D_\\xi^{(p_{\\rm metric})}x\\right) = 0\n$$\nSince this relation must hold for any constant velocity $(u,v)$, the coefficients of $u$ and $v$ must be independently zero. This yields the discrete metric identities required for FSP:\n$$\nD_\\xi^{(p_{\\rm flux})}D_\\eta^{(p_{\\rm metric})}y = D_\\eta^{(p_{\\rm flux})}D_\\xi^{(p_{\\rm metric})}y\n$$\n$$\nD_\\xi^{(p_{\\rm flux})}D_\\eta^{(p_{\\rm metric})}x = D_\\eta^{(p_{\\rm flux})}D_\\xi^{(p_{\\rm metric})}x\n$$\nThese equations state that the application of the mixed discrete derivative operators must commute when applied to the grid coordinate functions.\n\n### Part 2: Violation of FSP due to Operator Mismatch\n\nThe discrete metric identities are satisfied if the discrete derivative operators commute. Let's analyze this property. The operators $D_\\xi^{(p)}$ and $D_\\eta^{(p)}$ are linear and act on a periodic grid, so they can be analyzed in Fourier space. A derivative operator $D^{(p)}$ has a Fourier symbol $\\widehat{D^{(p)}}(k,h)$ such that the discrete Fourier transform of $D^{(p)}f$ is $\\widehat{D^{(p)}}(k,h)\\hat{f}(k)$. The symbol for an operator acting along $\\xi$ depends on wavenumber $k_\\xi$, and for an operator along $\\eta$, on $k_\\eta$.\n\nThe operator commutation condition $D_\\xi^{(p_{\\rm flux})}D_\\eta^{(p_{\\rm metric})} = D_\\eta^{(p_{\\rm flux})}D_\\xi^{(p_{\\rm metric})}$ translates in Fourier space to:\n$$\n\\widehat{D^{(p_{\\rm flux})}}(k_\\xi, h)\\widehat{D^{(p_{\\rm metric})}}(k_\\eta, h) = \\widehat{D^{(p_{\\rm flux})}}(k_\\eta, h)\\widehat{D^{(p_{\\rm metric})}}(k_\\xi, h)\n$$\nfor all discrete wavenumbers $k_\\xi, k_\\eta$. Let $F_1(k) = \\widehat{D^{(p_{\\rm flux})}}(k, h)$ and $F_2(k) = \\widehat{D^{(p_{\\rm metric})}}(k, h)$. The condition is $F_1(k_\\xi) F_2(k_\\eta) = F_1(k_\\eta) F_2(k_\\xi)$. This can be rearranged to:\n$$\n\\frac{F_1(k_\\xi)}{F_2(k_\\xi)} = \\frac{F_1(k_\\eta)}{F_2(k_\\eta)}\n$$\nThis equation must hold for all $k_\\xi$ and $k_\\eta$. This is only possible if the ratio $F_1(k)/F_2(k)$ is a constant, independent of the wavenumber $k$.\n\nLet's examine the symbols for the central difference operators of order $p=2, 4$:\n- $p=2$: $\\widehat{D^{(2)}}(k, h) = \\frac{i}{h}\\sin(kh)$\n- $p=4$: $\\widehat{D^{(4)}}(k, h) = \\frac{i}{h}\\left(\\frac{4}{3}\\sin(kh) - \\frac{1}{6}\\sin(2kh)\\right)$\n\nIf $p_{\\rm flux} \\neq p_{\\rm metric}$, say $p_{\\rm flux}=4$ and $p_{\\rm metric}=2$, the ratio is:\n$$\n\\frac{\\widehat{D^{(4)}}(k, h)}{\\widehat{D^{(2)}}(k, h)} = \\frac{\\frac{i}{h}\\left(\\frac{4}{3}\\sin(kh) - \\frac{1}{6}\\sin(2kh)\\right)}{\\frac{i}{h}\\sin(kh)} = \\frac{4}{3} - \\frac{1}{6}\\frac{2\\sin(kh)\\cos(kh)}{\\sin(kh)} = \\frac{4}{3} - \\frac{1}{3}\\cos(kh)\n$$\nThis ratio is a function of the wavenumber $k$ and is not constant. Therefore, the commutation property does not hold, the discrete metric identities are violated, and FSP is lost. A non-zero residual $\\mathcal{R}$ appears, introducing numerical error that can corrupt the solution. FSP is only guaranteed if $p_{\\rm flux} = p_{\\rm metric}$, in which case the ratio is $1$, a constant, and the operators commute trivially.\n\n### Part 3: Correction to Restore FSP\n\nThe issue stems from the fact that the discrete operators used to compute the metrics ($D^{(p_{\\rm metric})}$) and the divergence ($D^{(p_{\\rm flux})}$) are inconsistent, leading to a violation of the discrete GCL. The problem asks for a correction that restores FSP without changing the order of the flux divergence operator, $p_{\\rm flux}$.\n\nThe most direct way to restore FSP is to ensure the discrete metric identities are satisfied. This is achieved by making the operators compatible. My proposed correction is to re-calculate the metric terms using the *same* discrete operator as the one used for the flux divergence. Specifically, we set $p_{\\rm metric} = p_{\\rm flux}$ when constructing the metric-weighted velocities.\n\nThe corrected metric-weighted velocity components, $\\tilde U_{\\rm corr}$ and $\\tilde V_{\\rm corr}$, are thus defined as:\n$$\n\\tilde U_{\\rm corr} = u\\,\\big(D_\\eta^{(p_{\\rm flux})}y\\big) - v\\,\\big(D_\\eta^{(p_{\\rm flux})}x\\big)\n$$\n$$\n\\tilde V_{\\rm corr} = -u\\,\\big(D_\\xi^{(p_{\\rm flux})}y\\big)+ v\\,\\big(D_\\xi^{(p_{\\rm flux})}x\\big)\n$$\nThe residual for the uniform state $q=1$ is then computed as:\n$$\n\\mathcal{R}_{\\rm corr} = \\frac{1}{J}\\left(D_\\xi^{(p_{\\rm flux})}\\,\\tilde U_{\\rm corr} + D_\\eta^{(p_{\\rm flux})}\\,\\tilde V_{\\rm corr}\\right)\n$$\nSubstituting the definitions of the corrected fluxes into the divergence term, we get:\n$$\nu\\left(D_\\xi^{(p_{\\rm flux})}D_\\eta^{(p_{\\rm flux})}y - D_\\eta^{(p_{\\rm flux})}D_\\xi^{(p_{\\rm flux})}y\\right) - v\\left(D_\\xi^{(p_{\\rm flux})}D_\\eta^{(p_{\\rm flux})}x - D_\\eta^{(p_{\\rm flux})}D_\\xi^{(p_{\\rm flux})}x\\right)\n$$\nSince $D_\\xi^{(p_{\\rm flux})}$ and $D_\\eta^{(p_{\\rm flux})}$ are operators of the same type applied along different Cartesian axes of the computational grid, their application commutes: $D_\\xi^{(p)}D_\\eta^{(p)} = D_\\eta^{(p)}D_\\xi^{(p)}$. Therefore, the terms in parentheses are identically zero. The corrected residual $\\mathcal{R}_{\\rm corr}$ will be zero to machine precision, and FSP is restored. This correction does not alter the flux divergence operator $D^{(p_{\\rm flux})}$, but rather modifies its arguments to be consistent with it.\n\nThe following Python code implements this analysis to numerically verify the results.\n```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for Free-Stream Preservation analysis.\n    \"\"\"\n\n    def periodic_central_difference(F, p, axis, h):\n        \"\"\"\n        Computes the periodic central difference of order p on a 2D array F.\n\n        Args:\n            F (np.ndarray): The 2D input field.\n            p (int): The order of accuracy {2, 4, 6}.\n            axis (int): The axis along which to differentiate (0 for xi, 1 for eta).\n            h (float): The uniform grid spacing.\n\n        Returns:\n            np.ndarray: The derivative field.\n        \"\"\"\n        if p == 2:\n            # Stencil weights: [-1/2, 0, 1/2] / h\n            return (np.roll(F, -1, axis=axis) - np.roll(F, 1, axis=axis)) / (2.0 * h)\n        elif p == 4:\n            # Stencil weights: [1/12, -8/12, 0, 8/12, -1/12] / h\n            return (\n                -np.roll(F, -2, axis=axis) + 8 * np.roll(F, -1, axis=axis)\n                - 8 * np.roll(F, 1, axis=axis) + np.roll(F, 2, axis=axis)\n            ) / (12.0 * h)\n        elif p == 6:\n            # Stencil weights: [-1/60, 9/60, -45/60, 0, 45/60, -9/60, 1/60] / h\n            return (\n                np.roll(F, -3, axis=axis)\n                - 9 * np.roll(F, -2, axis=axis)\n                + 45 * np.roll(F, -1, axis=axis)\n                - 45 * np.roll(F, 1, axis=axis)\n                + 9 * np.roll(F, 2, axis=axis)\n                - np.roll(F, 3, axis=axis)\n            ) / (-60.0 * h)\n        else:\n            raise ValueError(f\"Unsupported order p={p}\")\n\n    def compute_fsp_error(N, alpha, u, v, p_flux, p_metric):\n        \"\"\"\n        Computes the maximum absolute FSP residual ||R||_infinity for given parameters.\n        \"\"\"\n        h = 1.0 / N\n        xi_1d = np.arange(N) * h\n        eta_1d = np.arange(N) * h\n        xi, eta = np.meshgrid(xi_1d, eta_1d, indexing='ij')\n\n        # Compute physical coordinates from the mapping\n        x = xi + alpha * np.sin(2 * np.pi * xi) * np.sin(2 * np.pi * eta)\n        y = eta + alpha * np.cos(2 * np.pi * xi) * np.sin(2 * np.pi * eta)\n\n        # Compute analytical Jacobian for normalization\n        x_xi_ana = 1 + alpha * 2 * np.pi * np.cos(2 * np.pi * xi) * np.sin(2 * np.pi * eta)\n        x_eta_ana = alpha * 2 * np.pi * np.sin(2 * np.pi * xi) * np.cos(2 * np.pi * eta)\n        y_xi_ana = -alpha * 2 * np.pi * np.sin(2 * np.pi * xi) * np.sin(2 * np.pi * eta)\n        y_eta_ana = 1 + alpha * 2 * np.pi * np.cos(2 * np.pi * xi) * np.cos(2 * np.pi * eta)\n        J_ana = x_xi_ana * y_eta_ana - x_eta_ana * y_xi_ana\n\n        # Compute discrete metric terms using the specified p_metric operator\n        y_eta_m = periodic_central_difference(y, p_metric, 1, h)\n        x_eta_m = periodic_central_difference(x, p_metric, 1, h)\n        y_xi_m = periodic_central_difference(y, p_metric, 0, h)\n        x_xi_m = periodic_central_difference(x, p_metric, 0, h)\n\n        # Compute discrete contravariant metric-weighted velocity components\n        U_tilde_m = u * y_eta_m - v * x_eta_m\n        V_tilde_m = -u * y_xi_m + v * x_xi_m\n\n        # Compute the divergence term using the specified p_flux operator\n        div_term = (\n            periodic_central_difference(U_tilde_m, p_flux, 0, h) +\n            periodic_central_difference(V_tilde_m, p_flux, 1, h)\n        )\n\n        # Compute the final residual R\n        R = div_term / J_ana\n\n        # Return the infinity norm of the residual\n        return np.max(np.abs(R))\n\n    # Define the test cases from the problem statement.\n    test_cases = {\n        1: {'N': 64, 'alpha': 0.2, 'u': 1.0, 'v': 0.5, 'p_flux': 4, 'p_metric': 2},\n        2: {'N': 64, 'alpha': 0.2, 'u': 1.0, 'v': 0.5, 'p_flux': 4, 'p_metric': 4},\n        3: {'N': 63, 'alpha': 0.3, 'u': -0.8, 'v': 0.3, 'p_flux': 6, 'p_metric': 2},\n        4: {'N': 64, 'alpha': 0.2, 'u': 1.0, 'v': 0.5, 'p_flux': 4}, # Correction Case\n        5: {'N': 32, 'alpha': 0.0, 'u': 1.2, 'v': -0.7, 'p_flux': 6, 'p_metric': 2},\n    }\n\n    results = []\n\n    # Case 1: Mismatch p_flux=4, p_metric=2\n    params = test_cases[1]\n    res1 = compute_fsp_error(**params)\n    results.append(res1)\n\n    # Case 2: Matched orders p_flux=4, p_metric=4\n    params = test_cases[2]\n    res2 = compute_fsp_error(**params)\n    results.append(res2)\n\n    # Case 3: Stronger mismatch p_flux=6, p_metric=2\n    params = test_cases[3]\n    res3 = compute_fsp_error(**params)\n    results.append(res3)\n\n    # Case 4: Corrected version of Case 1.\n    # The proposed correction is to use the same order for metrics as for the flux.\n    # So, we use Case 1's parameters but set p_metric = p_flux.\n    params_case1 = test_cases[1]\n    res4 = compute_fsp_error(\n        N=params_case1['N'],\n        alpha=params_case1['alpha'],\n        u=params_case1['u'],\n        v=params_case1['v'],\n        p_flux=params_case1['p_flux'],\n        p_metric=params_case1['p_flux']  # The correction is applied here\n    )\n    results.append(res4)\n\n    # Case 5: Edge case with a straight grid (alpha=0.0)\n    params = test_cases[5]\n    res5 = compute_fsp_error(**params)\n    results.append(res5)\n    \n    return f\"[{','.join(f'{r:.15e}' for r in results)}]\"\n\n# The output is generated by calling solve()\n# but is placed directly in the answer tag as requested by format.\n```", "answer": "[0.8176602325996024,3.522237889025127e-14,3.550186595514654,3.522237889025127e-14,0.0]", "id": "3375264"}]}