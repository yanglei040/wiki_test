{"hands_on_practices": [{"introduction": "To build a solid understanding of temporal stability, we begin with a foundational analysis of an explicit time-integration scheme. This exercise demonstrates how the stability of the forward Euler method, when applied to a semi-discrete FEM system, is governed by the system's spectral properties. By deriving the maximum stable time step, $\\Delta t_{\\max}$, from first principles, you will gain direct insight into the restrictive condition, often of the form $\\Delta t \\le C h^2$, that links time step size, mesh spacing, and material properties for explicit methods [@problem_id:3447081].", "problem": "Consider the one-dimensional heat equation $u_{t} = \\nu u_{xx}$ on the spatial interval $[0,L]$ with homogeneous Dirichlet boundary conditions $u(0,t) = 0$ and $u(L,t) = 0$, where $\\nu > 0$ is the thermal diffusivity. Discretize the spatial domain into three uniform subintervals of length $h = L/3$ and approximate $u(x,t)$ by continuous, piecewise-linear basis functions associated with the four mesh nodes. Enforce the boundary conditions strongly at $x=0$ and $x=L$, so that the semidiscrete system is written in terms of the two interior nodal degrees of freedom. Use the standard Galerkin Finite Element Method (FEM) with the consistent mass matrix. Denote the resulting semidiscrete system by $M \\dot{\\mathbf{u}}(t) + \\nu K \\mathbf{u}(t) = \\mathbf{0}$, where $M$ is the $2 \\times 2$ mass matrix and $K$ is the $2 \\times 2$ stiffness matrix.\n\nTime-discretize this semidiscrete system using the forward Euler method with uniform time step $\\Delta t$, so that the fully discrete update is $\\mathbf{u}^{n+1} = \\mathbf{u}^{n} - \\Delta t \\,\\nu\\, M^{-1} K \\,\\mathbf{u}^{n}$. Starting from the variational formulation and the element-wise definitions of $M$ and $K$, assemble the global interior matrices and perform a spectral analysis via the generalized eigenvalue problem $K \\mathbf{v} = \\mu M \\mathbf{v}$ to determine the largest admissible time step $\\Delta t_{\\max}$ for which the method is non-amplifying in the $\\ell^{2}$-norm for all modes.\n\nProvide the exact, closed-form symbolic expression for $\\Delta t_{\\max}$ in terms of $L$ and $\\nu$. Express your answer in seconds. Your final answer must be a single closed-form expression and must not contain inequalities or additional conditions.", "solution": "The problem requires finding the maximum stable time step for the forward Euler time discretization of a semidiscrete finite element approximation of the one-dimensional heat equation.\n\nThe governing partial differential equation is the heat equation:\n$$\nu_{t} = \\nu u_{xx}, \\quad x \\in [0,L], t>0\n$$\nwith homogeneous Dirichlet boundary conditions $u(0,t) = 0$ and $u(L,t) = 0$. The parameter $\\nu > 0$ is the thermal diffusivity.\n\nThe standard Galerkin finite element method begins with the variational (or weak) formulation. We seek a solution $u(\\cdot, t)$ in the function space $H^1_0([0,L])$ such that for any test function $v \\in H^1_0([0,L])$:\n$$\n\\int_{0}^{L} u_t v \\,dx = \\int_{0}^{L} (\\nu u_{xx}) v \\,dx\n$$\nIntegrating the right-hand side by parts and applying the homogeneous boundary conditions gives:\n$$\n\\int_{0}^{L} u_t v \\,dx = -\\nu \\int_{0}^{L} u_x v_x \\,dx\n$$\nThe spatial domain $[0,L]$ is discretized into three uniform subintervals, so the mesh size is $h = L/3$. The nodes are located at $x_0=0$, $x_1=L/3$, $x_2=2L/3$, and $x_3=L$. We use continuous, piecewise-linear basis functions $\\phi_i(x)$. The approximate solution is written as a linear combination of these basis functions:\n$$\nu_h(x,t) = \\sum_{j=0}^{3} u_j(t) \\phi_j(x)\n$$\nThe boundary conditions $u(0,t)=0$ and $u(L,t)=0$ are enforced strongly, which means $u_0(t)=0$ and $u_3(t)=0$. The approximation is therefore defined by the two interior nodal values:\n$$\nu_h(x,t) = u_1(t)\\phi_1(x) + u_2(t)\\phi_2(x)\n$$\nWe choose our test functions from the same finite-dimensional space, i.e., $v_h(x) = \\phi_i(x)$ for $i=1,2$. Substituting $u_h$ and $v_h$ into the weak form yields a system of ordinary differential equations for the interior nodal values $\\mathbf{u}(t) = [u_1(t), u_2(t)]^T$:\n$$\nM \\dot{\\mathbf{u}}(t) + \\nu K \\mathbf{u}(t) = \\mathbf{0}\n$$\nwhere $M$ is the consistent mass matrix and $K$ is the stiffness matrix, with entries:\n$$\nM_{ij} = \\int_0^L \\phi_j(x) \\phi_i(x) \\,dx \\quad \\text{and} \\quad K_{ij} = \\int_0^L \\phi'_j(x) \\phi'_i(x) \\,dx\n$$\nTo compute these matrices, we first determine the element mass matrix $M^e$ and element stiffness matrix $K^e$ for a generic element of length $h$. Using linear shape functions $N_1(\\xi) = 1-\\xi/h$ and $N_2(\\xi) = \\xi/h$ on a local domain $[0,h]$, we find:\n$$\nM^e = \\int_0^h \\begin{pmatrix} N_1^2  N_1 N_2 \\\\ N_2 N_1  N_2^2 \\end{pmatrix} d\\xi = \\frac{h}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}\n$$\n$$\nK^e = \\int_0^h \\begin{pmatrix} (N'_1)^2  N'_1 N'_2 \\\\ N'_2 N'_1  (N'_2)^2 \\end{pmatrix} d\\xi = \\frac{1}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}\n$$\nThe global matrices for the two interior degrees of freedom are assembled from the contributions of the three elements: $[x_0, x_1]$, $[x_1, x_2]$, and $[x_2, x_3]$.\nFor the mass matrix $M$:\n$M_{11}$ receives contributions from element $1$ (node $2$) and element $2$ (node $1$): $M_{11} = M^e_{22} + M^e_{11} = h/3 + h/3 = 2h/3$.\n$M_{22}$ receives contributions from element $2$ (node $2$) and element $3$ (node $1$): $M_{22} = M^e_{22} + M^e_{11} = h/3 + h/3 = 2h/3$.\n$M_{12} = M_{21}$ receives a contribution from element $2$: $M_{12} = M^e_{12} = h/6$.\n$$\nM = \\begin{pmatrix} 2h/3  h/6 \\\\ h/6  2h/3 \\end{pmatrix} = \\frac{h}{6} \\begin{pmatrix} 4  1 \\\\ 1  4 \\end{pmatrix}\n$$\nFor the stiffness matrix $K$:\n$K_{11}$ receives contributions from element $1$ (node $2$) and element $2$ (node $1$): $K_{11} = K^e_{22} + K^e_{11} = 1/h + 1/h = 2/h$.\n$K_{22}$ receives contributions from element $2$ (node $2$) and element $3$ (node $1$): $K_{22} = K^e_{22} + K^e_{11} = 1/h + 1/h = 2/h$.\n$K_{12} = K_{21}$ receives a contribution from element $2$: $K_{12} = K^e_{12} = -1/h$.\n$$\nK = \\begin{pmatrix} 2/h  -1/h \\\\ -1/h  2/h \\end{pmatrix} = \\frac{1}{h} \\begin{pmatrix} 2  -1 \\\\ -1  2 \\end{pmatrix}\n$$\nThe semidiscrete system is discretized in time using the forward Euler method with time step $\\Delta t$:\n$$\n\\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^{n}}{\\Delta t} = - \\nu M^{-1} K \\mathbf{u}^{n}\n$$\nThis gives the fully discrete update rule:\n$$\n\\mathbf{u}^{n+1} = (I - \\Delta t \\, \\nu M^{-1} K) \\mathbf{u}^{n}\n$$\nThe matrix $G = I - \\Delta t \\, \\nu M^{-1} K$ is the amplification matrix. For the method to be non-amplifying (stable), the spectral radius of $G$ must satisfy $\\rho(G) \\le 1$.\nThe eigenvalues of $G$, denoted $\\lambda_G$, are related to the eigenvalues of $M^{-1}K$, denoted $\\mu$, by $\\lambda_G = 1 - \\Delta t \\, \\nu \\mu$. The eigenvalues $\\mu$ are the solutions to the generalized eigenvalue problem $K \\mathbf{v} = \\mu M \\mathbf{v}$.\nSince $M$ and $K$ are symmetric positive definite, the eigenvalues $\\mu$ are real and positive. The stability condition $|\\lambda_G| \\le 1$ becomes:\n$$\n|1 - \\Delta t \\, \\nu \\mu| \\le 1 \\implies -1 \\le 1 - \\Delta t \\, \\nu \\mu \\le 1\n$$\nThe right inequality is always satisfied for $\\Delta t, \\nu, \\mu  0$. The left inequality gives:\n$$\n-2 \\le - \\Delta t \\, \\nu \\mu \\implies \\Delta t \\le \\frac{2}{\\nu \\mu}\n$$\nTo ensure stability for all modes, this condition must hold for the largest eigenvalue, $\\mu_{\\max}$. Thus, the maximum stable time step is:\n$$\n\\Delta t_{\\max} = \\frac{2}{\\nu \\mu_{\\max}}\n$$\nWe now solve the generalized eigenvalue problem $\\det(K - \\mu M) = 0$:\n$$\n\\det\\left( \\frac{1}{h} \\begin{pmatrix} 2  -1 \\\\ -1  2 \\end{pmatrix} - \\mu \\frac{h}{6} \\begin{pmatrix} 4  1 \\\\ 1  4 \\end{pmatrix} \\right) = 0\n$$\n$$\n\\det\\begin{pmatrix} \\frac{2}{h} - \\frac{4\\mu h}{6}  -\\frac{1}{h} - \\frac{\\mu h}{6} \\\\ -\\frac{1}{h} - \\frac{\\mu h}{6}  \\frac{2}{h} - \\frac{4\\mu h}{6} \\end{pmatrix} = 0\n$$\nThis yields the characteristic equation:\n$$\n\\left(\\frac{2}{h} - \\frac{2\\mu h}{3}\\right)^2 - \\left(-\\frac{1}{h} - \\frac{\\mu h}{6}\\right)^2 = 0\n$$\nThis is of the form $A^2 - B^2 = 0$, which factors into $(A-B)(A+B) = 0$.\n\nCase 1: $A-B = 0$\n$$\n\\left(\\frac{2}{h} - \\frac{2\\mu h}{3}\\right) - \\left(-\\frac{1}{h} - \\frac{\\mu h}{6}\\right) = 0 \\implies \\frac{3}{h} - \\frac{3\\mu h}{6} = 0 \\implies \\frac{3}{h} = \\frac{\\mu h}{2} \\implies \\mu_1 = \\frac{6}{h^2}\n$$\nCase 2: $A+B = 0$\n$$\n\\left(\\frac{2}{h} - \\frac{2\\mu h}{3}\\right) + \\left(-\\frac{1}{h} - \\frac{\\mu h}{6}\\right) = 0 \\implies \\frac{1}{h} - \\frac{5\\mu h}{6} = 0 \\implies \\frac{1}{h} = \\frac{5\\mu h}{6} \\implies \\mu_2 = \\frac{6}{5h^2}\n$$\nThe eigenvalues are $\\mu_1 = 6/h^2$ and $\\mu_2 = 6/(5h^2)$. The maximum eigenvalue is:\n$$\n\\mu_{\\max} = \\frac{6}{h^2}\n$$\nNow we can compute the maximum stable time step:\n$$\n\\Delta t_{\\max} = \\frac{2}{\\nu \\mu_{\\max}} = \\frac{2}{\\nu (6/h^2)} = \\frac{2h^2}{6\\nu} = \\frac{h^2}{3\\nu}\n$$\nThe problem specifies that the domain $[0,L]$ is divided into three subintervals, so the mesh size is $h = L/3$. Substituting this into the expression for $\\Delta t_{\\max}$:\n$$\n\\Delta t_{\\max} = \\frac{(L/3)^2}{3\\nu} = \\frac{L^2/9}{3\\nu} = \\frac{L^2}{27\\nu}\n$$\nThis is the final expression for the maximum admissible time step.", "answer": "$$\\boxed{\\frac{L^2}{27\\nu}}$$", "id": "3447081"}, {"introduction": "While implicit methods like the second-order Backward Differentiation Formula (BDF2) offer superior stability, their theoretical guarantees can be compromised by practical implementation choices. This practice explores the critical impact of numerical quadrature on the stability of a semi-discrete system [@problem_id:3447128]. By implementing and comparing a consistent mass matrix $M$ with versions assembled using inexact quadrature, you will quantify how under-integration can degrade system coercivity and undermine the A-stability of an otherwise robust scheme.", "problem": "Consider the linear, time-dependent Finite Element Method (FEM) semidiscretization of a one-dimensional diffusion operator on the unit interval with homogeneous Dirichlet boundary conditions. The semidiscrete model reads $M \\dot{u} + K u = f$, where $M$ is the mass matrix and $K$ is the stiffness matrix assembled from continuous, piecewise-linear shape functions on a uniform mesh. Assume $f \\equiv 0$ so that the continuous evolution is contractive relative to the energy induced by the exact $M$. The Backward Differentiation Formula of order two (BDF2) is known to be absolutely stable (A-stable) for the scalar test equation with nonpositive real spectrum.\n\nYour task is to quantify how quadrature errors during the assembly of $M$ impact the observed step-wise absolute stability of BDF2 when applied to $M \\dot{u} + K u = 0$, and to provide a quantitative degradation metric as a function of the quadrature order used for $M$. Work strictly from the following fundamental bases: the Galerkin definition of $M$ and $K$, the definition of BDF2 as a two-step implicit formula for $\\dot{u}$, and the spectral characterization of stability in terms of the spectral radius of the one-step amplification operator.\n\nImplement the following, adhering to all the specifications:\n\n1) Geometry and discretization:\n- Use a uniform partition of the unit interval $[0,1]$ with $N$ elements and continuous, piecewise-linear basis with homogeneous Dirichlet boundary conditions at both endpoints. Use $N = 32$.\n- Assemble the exact stiffness matrix $K$ using exact integration on each element.\n- Assemble two mass matrices: the exact mass matrix $M_{\\text{ex}}$ using exact integration, and an approximate mass matrix $M_q$ assembled by Gauss–Legendre quadrature with $q$ points per element, where $q \\in \\{1,2,3\\}$.\n\n2) Time discretization:\n- Apply the Backward Differentiation Formula of order two (BDF2) to the semidiscrete system $M_q \\dot{u} + K u = 0$ on a uniform timestep $\\Delta t$. Start from the definition of BDF2 as a two-step, linear multistep formula that approximates $\\dot{u}$ at the new time using a linear combination of $u$ at the new and two previous timesteps, without assuming any shortcut formulas.\n\n3) Stability characterization:\n- Derive the linear, time-invariant, one-step amplification operator that maps the block state $[u^n; u^{n-1}]$ to $[u^{n+1}; u^n]$ for the homogeneous problem with $M_q$ in place of $M$. Define the spectral radius of this amplification operator and use it to measure absolute stability at a given $\\Delta t$.\n- Quantify the coercivity degradation of the approximate mass with respect to the exact mass by the smallest generalized eigenvalue $c(q)$ of the pair $(M_q, M_{\\text{ex}})$, that is, the minimum of the Rayleigh quotient $v^\\top M_q v / v^\\top M_{\\text{ex}} v$ over nonzero $v$. This number satisfies $c(q) \\in [0,\\infty)$ and measures the worst-case relative underestimation of mass; values near $0$ indicate loss of coercivity.\n\n4) Test suite and metrics to output:\n- Use $N = 32$ elements.\n- Use quadrature orders $q \\in \\{1,2,3\\}$ for assembling $M_q$.\n- Use the timestep set $\\Delta t \\in \\{10^{-3}, 10^{-1}, 1, 10\\}$.\n- For each $q$, compute two quantities:\n  a) The coercivity ratio $c(q)$ as defined above.\n  b) The maximum spectral radius $\\rho_{\\max}(q)$ of the BDF2 amplification operator over the given $\\Delta t$ values.\n\n5) Output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as $[c(1), \\rho_{\\max}(1), c(2), \\rho_{\\max}(2), c(3), \\rho_{\\max}(3)]$.\n- All outputs must be real numbers in floating-point format.\n\nThere are no physical units involved; all quantities are dimensionless. Angles are not used. Percentages are not used; ratios must be expressed as decimal numbers. The numerical results must be computed directly by your program for the specified test suite; no external input is allowed.", "solution": "We begin from the standard Galerkin Finite Element Method (FEM) semidiscretization for a one-dimensional diffusion operator on $[0,1]$ with homogeneous Dirichlet boundary conditions. Let $N$ be the number of elements, nodes are $x_i = i h$ for $i=0,\\dots,N$ with uniform spacing $h = 1/N$. The piecewise-linear, continuous basis with nodal values at interior nodes defines the mass and stiffness matrices by\n$$\n(M_{\\text{ex}})_{ij} = \\int_0^1 \\varphi_i(x) \\varphi_j(x)\\,dx,\\qquad\nK_{ij} = \\int_0^1 \\varphi_i'(x) \\varphi_j'(x)\\,dx.\n$$\nOn each element of length $h$, the exact local contributions for piecewise-linear basis functions are\n$$\nM_{\\text{loc,ex}} = \\frac{h}{6} \\begin{bmatrix}2  1 \\\\ 1  2 \\end{bmatrix}, \\qquad\nK_{\\text{loc}} = \\frac{1}{h} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}.\n$$\nThe approximate mass matrix $M_q$ is obtained by evaluating the element integrals for the mass using Gauss–Legendre quadrature with $q$ points per element. On a single element with local coordinate $\\xi \\in [0,1]$, the basis functions are $\\varphi_1(\\xi)=1-\\xi$ and $\\varphi_2(\\xi)=\\xi$, the Jacobian is $h$, and the approximate local mass entries are\n$$\n(M_{\\text{loc},q})_{ab} \\approx h \\sum_{\\ell=1}^{q} w_\\ell\\, \\varphi_a(\\xi_\\ell)\\,\\varphi_b(\\xi_\\ell),\n$$\nwhere $(\\xi_\\ell,w_\\ell)$ are the Gauss–Legendre points and weights mapped to $[0,1]$ from $[-1,1]$. The stiffness matrix is assembled exactly using $K_{\\text{loc}}$ above. Dirichlet boundary conditions are enforced by restricting to the interior degrees of freedom.\n\nFor time discretization, consider the semidiscrete system with approximate mass,\n$$\nM_q \\dot{u}(t) + K u(t) = 0.\n$$\nThe Backward Differentiation Formula of order two (BDF2) is a two-step implicit linear multistep method. Starting from the definition for a scalar function $y(t)$ on a uniform grid with timestep $\\Delta t$, the BDF2 approximation to the derivative at time $t_{n+1}$ is\n$$\n\\dot{y}(t_{n+1}) \\approx \\frac{1}{\\Delta t}\\left( \\frac{3}{2} y^{n+1} - 2 y^{n} + \\frac{1}{2} y^{n-1} \\right).\n$$\nApplying this definition to the vector system with $M_q$ and $K$ gives\n$$\nM_q \\frac{1}{\\Delta t}\\left( \\frac{3}{2} u^{n+1} - 2 u^{n} + \\frac{1}{2} u^{n-1} \\right) + K u^{n+1} = 0.\n$$\nRearranging terms, we obtain the linear system determining the new value $u^{n+1}$ from the two previous values:\n$$\n\\left(\\frac{3}{2} M_q + \\Delta t\\, K\\right) u^{n+1} = 2 M_q u^{n} - \\frac{1}{2} M_q u^{n-1}.\n$$\nDefine the matrices\n$$\nA := \\frac{3}{2} M_q + \\Delta t\\, K,\\qquad B := 2 M_q,\\qquad C := -\\frac{1}{2} M_q.\n$$\nThen\n$$\nu^{n+1} = A^{-1} B\\, u^{n} + A^{-1} C\\, u^{n-1}.\n$$\nIntroducing the block state vector $w^n = \\begin{bmatrix} u^n \\\\ u^{n-1} \\end{bmatrix}$, the one-step amplification operator $T(\\Delta t)$ that maps $w^n$ to $w^{n+1}$ is\n$$\nw^{n+1} =\n\\begin{bmatrix}\nA^{-1} B  A^{-1} C \\\\\nI  0\n\\end{bmatrix}\n\\begin{bmatrix}\nu^n \\\\ u^{n-1}\n\\end{bmatrix}\n=: T(\\Delta t)\\, w^n.\n$$\nThe absolute stability at a given $\\Delta t$ is characterized by the spectral radius $\\rho(T(\\Delta t))$, which is the maximum magnitude of the eigenvalues of $T(\\Delta t)$. For the homogeneous problem, non-increasing amplitude under iteration corresponds to $\\rho(T(\\Delta t)) \\le 1$.\n\nTo quantify the effect of quadrature error in $M_q$, we define the coercivity ratio with respect to the exact mass as the minimum generalized eigenvalue of the pair $(M_q, M_{\\text{ex}})$:\n$$\nc(q) := \\min_{v \\ne 0} \\frac{v^\\top M_q v}{v^\\top M_{\\text{ex}} v}.\n$$\nThis is the smallest value in the generalized spectrum of $M_q v = \\lambda M_{\\text{ex}} v$. It measures the worst-case underestimation of the $M_{\\text{ex}}$-norm by the inexact quadrature mass. For exact quadrature on piecewise-linear elements, $M_q = M_{\\text{ex}}$, so $c(q) = 1$. Under-integration can lead to $c(q)$ significantly below $1$, and even $c(q)=0$ if $M_q$ loses coercivity along some directions.\n\nAlgorithmic steps:\n- Assemble $K$ exactly and $M_{\\text{ex}}$ exactly on the interior degrees of freedom for the uniform mesh.\n- For each quadrature order $q \\in \\{1,2,3\\}$, assemble $M_q$ by Gauss–Legendre quadrature with $q$ points per element.\n- Compute the coercivity ratio $c(q)$ as the minimal generalized eigenvalue of $(M_q, M_{\\text{ex}})$.\n- For each $\\Delta t \\in \\{10^{-3}, 10^{-1}, 1, 10\\}$, form $T(\\Delta t)$ and compute its spectral radius $\\rho(T(\\Delta t))$. Let $\\rho_{\\max}(q)$ be the maximum of $\\rho(T(\\Delta t))$ over the given $\\Delta t$ values.\n- Output the list $[c(1), \\rho_{\\max}(1), c(2), \\rho_{\\max}(2), c(3), \\rho_{\\max}(3)]$ as a single line.\n\nRationale:\n- The derivation uses the Galerkin definition of $M$ and $K$ and the fundamental definition of BDF2 to construct the time-stepping operator.\n- The spectral radius of $T(\\Delta t)$ quantifies absolute stability for the linear, autonomous homogeneous system.\n- The generalized eigenvalue problem defining $c(q)$ is a direct mathematical measure of the quadrature-induced loss of coercivity relative to the exact inner product, which is essential in energy-based stability analyses. For example, with $q=1$ (one Gauss point per element), the quadrature is not exact for the quadratic integrand $\\varphi_i \\varphi_j$, which can lead to a semidefinite $M_q$ and $c(1)=0$, while for $q \\ge 2$ it is exact for piecewise-linear bases and yields $c(q)=1$.\n\nThe program implements these steps with $N=32$, $q \\in \\{1,2,3\\}$, and $\\Delta t \\in \\{10^{-3}, 10^{-1}, 1, 10\\}$, and reports the requested aggregated results.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef assemble_matrices(n_elements: int, q_points: int):\n    \"\"\"\n    Assemble stiffness K (exact), exact mass M_ex, and quadrature-based mass M_q\n    for 1D P1 FEM on [0,1] with homogeneous Dirichlet BCs.\n\n    Parameters:\n        n_elements: number of uniform elements (N)\n        q_points: number of Gauss-Legendre points per element for mass quadrature\n\n    Returns:\n        M_q: (n_dof x n_dof) mass matrix with q-point quadrature\n        K:   (n_dof x n_dof) exact stiffness matrix\n        M_ex:(n_dof x n_dof) exact mass matrix\n    \"\"\"\n    N = n_elements\n    h = 1.0 / N\n    n_dof = N - 1  # interior nodes\n\n    # Initialize matrices\n    M_q = np.zeros((n_dof, n_dof), dtype=float)\n    M_ex = np.zeros((n_dof, n_dof), dtype=float)\n    K = np.zeros((n_dof, n_dof), dtype=float)\n\n    # Exact local matrices (P1)\n    Mloc_ex = (h / 6.0) * np.array([[2.0, 1.0],\n                                    [1.0, 2.0]], dtype=float)\n    Kloc = (1.0 / h) * np.array([[1.0, -1.0],\n                                 [-1.0, 1.0]], dtype=float)\n\n    # Gauss-Legendre quadrature nodes/weights on [0,1]\n    # Map from [-1,1] nodes/weights\n    if q_points = 1:\n        xi_gl, w_gl = np.polynomial.legendre.leggauss(q_points)\n        xi = 0.5 * (xi_gl + 1.0)  # to [0,1]\n        w = 0.5 * w_gl\n    else:\n        raise ValueError(\"q_points must be = 1\")\n\n    # Shape functions on reference [0,1]\n    def phi1(xi_ref):\n        return 1.0 - xi_ref\n\n    def phi2(xi_ref):\n        return xi_ref\n\n    # Assemble over elements\n    for e in range(N):\n        # Global node indices\n        left = e\n        right = e + 1\n\n        # Local mass with quadrature\n        Mloc_q = np.zeros((2, 2), dtype=float)\n        for (xip, wp) in zip(xi, w):\n            vals = np.array([phi1(xip), phi2(xip)], dtype=float)\n            Mloc_q += h * wp * np.outer(vals, vals)\n\n        # Add to global matrices with Dirichlet BC handling (interior indices)\n        # Interior indices: i-1 for global node i in 1..N-1\n        li = left - 1\n        ri = right - 1\n\n        # Mass exact\n        if 0 = li  n_dof:\n            M_ex[li, li] += Mloc_ex[0, 0]\n        if 0 = ri  n_dof:\n            M_ex[ri, ri] += Mloc_ex[1, 1]\n        if 0 = li  n_dof and 0 = ri  n_dof:\n            M_ex[li, ri] += Mloc_ex[0, 1]\n            M_ex[ri, li] += Mloc_ex[1, 0]\n\n        # Mass quadrature\n        if 0 = li  n_dof:\n            M_q[li, li] += Mloc_q[0, 0]\n        if 0 = ri  n_dof:\n            M_q[ri, ri] += Mloc_q[1, 1]\n        if 0 = li  n_dof and 0 = ri  n_dof:\n            M_q[li, ri] += Mloc_q[0, 1]\n            M_q[ri, li] += Mloc_q[1, 0]\n\n        # Stiffness exact\n        if 0 = li  n_dof:\n            K[li, li] += Kloc[0, 0]\n        if 0 = ri  n_dof:\n            K[ri, ri] += Kloc[1, 1]\n        if 0 = li  n_dof and 0 = ri  n_dof:\n            K[li, ri] += Kloc[0, 1]\n            K[ri, li] += Kloc[1, 0]\n\n    return M_q, K, M_ex\n\ndef bdf2_step_matrix(M: np.ndarray, K: np.ndarray, dt: float):\n    \"\"\"\n    Construct the BDF2 amplification matrix T(dt) for the homogeneous system\n    M u_dot + K u = 0, using mass matrix M and stiffness K.\n\n    T maps [u^n; u^{n-1}] to [u^{n+1}; u^n].\n\n    Returns:\n        T: (2n x 2n) amplification matrix\n    \"\"\"\n    n = M.shape[0]\n    A = 1.5 * M + dt * K\n    B = 2.0 * M\n    C = -0.5 * M\n\n    # Solve A X = B and A Y = C\n    X = linalg.solve(A, B, assume_a='sym')\n    Y = linalg.solve(A, C, assume_a='sym')\n\n    # Build block matrix\n    T = np.zeros((2 * n, 2 * n), dtype=float)\n    T[:n, :n] = X\n    T[:n, n:] = Y\n    T[n:, :n] = np.eye(n)\n    # T[n:, n:] already zeros\n    return T\n\ndef spectral_radius(mat: np.ndarray) - float:\n    vals = linalg.eig(mat, left=False, right=False)\n    return float(np.max(np.abs(vals)))\n\ndef coercivity_ratio(M_q: np.ndarray, M_ex: np.ndarray) - float:\n    \"\"\"\n    Compute the smallest generalized eigenvalue of (M_q, M_ex).\n    Since M_ex is SPD and M_q is symmetric (possibly semidefinite),\n    use symmetric generalized eigenvalue solver.\n    \"\"\"\n    # Ensure symmetry\n    Mq_sym = 0.5 * (M_q + M_q.T)\n    Mex_sym = 0.5 * (M_ex + M_ex.T)\n    # Generalized symmetric eigenproblem\n    # eigh returns real eigenvalues; handle potential tiny negative due to rounding.\n    vals = linalg.eigh(Mq_sym, Mex_sym, lower=True, eigvals_only=True)\n    # Clean up numerical noise\n    vals_real = np.real(vals)\n    # Minimal eigenvalue\n    lam_min = float(np.min(vals_real))\n    # Clamp tiny negatives to zero\n    if lam_min  0 and abs(lam_min)  1e-12:\n        lam_min = 0.0\n    return lam_min\n\ndef solve():\n    # Define the test cases from the problem statement.\n    N = 32\n    q_list = [1, 2, 3]\n    dt_list = [1e-3, 1e-1, 1.0, 10.0]\n\n    results = []\n    for q in q_list:\n        Mq, K, Mex = assemble_matrices(N, q_points=q)\n        # Coercivity degradation metric\n        c_q = coercivity_ratio(Mq, Mex)\n\n        # Stability metric: maximum spectral radius over dt_list\n        rho_max = 0.0\n        for dt in dt_list:\n            T = bdf2_step_matrix(Mq, K, dt)\n            rho = spectral_radius(T)\n            if rho  rho_max:\n                rho_max = rho\n\n        # Append results in order [c(q), rho_max(q)]\n        # Format to a reasonable number of decimals for stable output\n        results.append(f\"{c_q:.6f}\")\n        results.append(f\"{rho_max:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3447128"}, {"introduction": "The stability of a numerical simulation depends not only on the chosen time-stepping formula but also on the algorithm that adapts the step sizes. This exercise models a common failure mode in adaptive methods, where a lagged error estimate and an aggressive proportional controller induce self-sustaining oscillations [@problem_id:3447103]. By analyzing the dynamics of this step-size sequence, you will learn to identify potential algorithmic instabilities and explore how control-theoretic concepts, like critical damping, can be used to design more robust adaptive controllers.", "problem": "Consider the one-dimensional heat equation on the unit interval with homogeneous Dirichlet boundary conditions,\n$$\nu_{t}(x,t) - u_{xx}(x,t) = 0,\\quad x \\in (0,1),\\ t>0,\\qquad u(0,t)=u(1,t)=0,\\qquad u(x,0)=u_{0}(x).\n$$\nDiscretize in space by the Finite Element Method (FEM) using continuous, piecewise-linear elements on a quasi-uniform mesh to obtain the semi-discrete system\n$$\nM \\dot{U}(t) + K U(t) = 0,\n$$\nwhere $M$ is the symmetric positive-definite mass matrix and $K$ is the symmetric positive-definite stiffness matrix. Advance in time with the backward Euler method,\n$$\n\\left(M + k_{n} K\\right) U^{n} = M U^{n-1},\\qquad n\\ge 1,\n$$\nwhere $k_{n} = t_{n} - t_{n-1}$ is the time step. Assume the initial condition $U^{0}$ is an eigenvector of the generalized eigenproblem $K \\phi = \\lambda M \\phi$ for some $\\lambda>0$, so that $U^{n} = a_{n} \\phi$ for all $n$.\n\nA practitioner implements adaptive time stepping using a residual-type a posteriori estimator that is computed at the start of step $n$ based solely on data from step $n-1$. This introduces a one-step lag that, for this linear invariant-subspace setting, can be modeled as\n$$\nr_{n} = C\\, k_{n-1}^{p},\n$$\nwhere $C>0$ depends on $\\lambda$ and mesh-dependent norms, and $p$ is the local order of consistency of the time-stepping method. For backward Euler, take $p=1$. The practitioner uses an aggressive proportional controller,\n$$\nk_{n+1} = k_{n} \\left(\\frac{\\mathrm{tol}}{r_{n}}\\right)^{1/p},\n$$\nwith a fixed tolerance $\\mathrm{tol}>0$.\n\n1) Using only the model above and the invariance of the solution subspace, show that the aggressive controller combined with the lagged estimator induces an oscillatory step-size sequence that does not decay. Your derivation must start from the discrete update and eigenmode invariance and proceed by transforming to logarithmic variables $x_{n} = \\ln k_{n}$ to obtain a homogeneous linear recurrence for the error $e_{n} = x_{n} - s$, where $s = \\frac{1}{p}(\\ln \\mathrm{tol} - \\ln C)$.\n\n2) To stabilize the step-size dynamics, you propose an under-relaxed power controller\n$$\nk_{n+1} = k_{n} \\left(\\frac{\\mathrm{tol}}{r_{n}}\\right)^{\\beta},\n$$\nwith a relaxation parameter $\\beta \\in (0,1)$ to be chosen. Linearize the induced recurrence in the logarithmic variable $x_{n} = \\ln k_{n}$ about the fixed point $x = s$ and derive the characteristic polynomial for the error $e_{n} = x_{n} - s$. Determine the unique value of $\\beta \\in (0,1)$ that yields critical damping, meaning that the characteristic polynomial has a repeated real root and the error decays to zero without oscillation.\n\nGive your final answer as the exact value of $\\beta$ with no units. No rounding is required. The final answer must be a single number.", "solution": "The problem is divided into two parts. The first part requires demonstrating that an aggressive proportional controller for adaptive time-stepping leads to non-decaying oscillations in the step-size sequence. The second part asks for the derivation of a stabilization parameter $\\beta$ for an under-relaxed controller that achieves critical damping. The analysis will be based on the provided models for the error estimator and the step-size controllers.\n\n**Part 1: Analysis of the Aggressive Controller**\n\nThe step-size control algorithm is defined by two equations: the lagged a posteriori estimator model and the aggressive proportional controller.\nThe estimator for the error at step $n$ is given as a function of the previous time step, $k_{n-1}$:\n$$r_{n} = C k_{n-1}^{p}$$\nwhere $C > 0$ is a constant, and $p$ is the local order of consistency of the time-stepping method. For the backward Euler method, we are given $p=1$.\n\nThe aggressive proportional controller updates the next time step, $k_{n+1}$, based on the current time step, $k_n$, and the error estimate, $r_n$:\n$$k_{n+1} = k_{n} \\left(\\frac{\\mathrm{tol}}{r_{n}}\\right)^{1/p}$$\nwhere $\\mathrm{tol} > 0$ is a specified tolerance.\n\nFirst, we combine these two equations to obtain a recurrence relation for the sequence of time steps $\\{k_n\\}$. Substituting the expression for $r_n$ into the controller equation yields:\n$$k_{n+1} = k_{n} \\left(\\frac{\\mathrm{tol}}{C k_{n-1}^{p}}\\right)^{1/p} = k_{n} \\frac{(\\mathrm{tol})^{1/p}}{C^{1/p} (k_{n-1}^{p})^{1/p}} = k_{n} \\frac{(\\mathrm{tol}/C)^{1/p}}{k_{n-1}}$$\nFor the backward Euler method, we have $p=1$, which simplifies the recurrence to:\n$$k_{n+1} = \\frac{(\\mathrm{tol}/C) k_{n}}{k_{n-1}}$$\nThis is a second-order nonlinear recurrence relation for the time step $k_n$.\n\nTo analyze the dynamics, we transform the recurrence into a linear one using logarithmic variables, as suggested. Let $x_{n} = \\ln k_{n}$. Taking the natural logarithm of both sides of the recurrence for $k_n$:\n$$\\ln k_{n+1} = \\ln\\left(\\frac{(\\mathrm{tol}/C) k_{n}}{k_{n-1}}\\right)$$\n$$x_{n+1} = \\ln(\\mathrm{tol}/C) + \\ln k_{n} - \\ln k_{n-1}$$\n$$x_{n+1} = \\ln(\\mathrm{tol}) - \\ln(C) + x_{n} - x_{n-1}$$\nThis is a second-order linear non-homogeneous recurrence relation for $x_n$.\n\nThe problem defines the error variable $e_{n} = x_{n} - s$, where $s$ is the logarithmic fixed-point step size, given by $s = \\frac{1}{p}(\\ln\\mathrm{tol} - \\ln C)$. For $p=1$, this is $s = \\ln\\mathrm{tol} - \\ln C$. We substitute $x_{n} = e_{n} + s$ into the recurrence for $x_n$:\n$$(e_{n+1} + s) = (\\ln\\mathrm{tol} - \\ln C) + (e_{n} + s) - (e_{n-1} + s)$$\nUsing the definition of $s$:\n$$e_{n+1} + s = s + e_{n} + s - e_{n-1} - s$$\n$$e_{n+1} = e_{n} - e_{n-1}$$\nThis gives the homogeneous linear recurrence for the error $e_n$:\n$$e_{n+1} - e_{n} + e_{n-1} = 0$$\nTo determine the behavior of the error, we analyze the roots of the characteristic polynomial associated with this recurrence:\n$$z^2 - z + 1 = 0$$\nThe roots are found using the quadratic formula:\n$$z = \\frac{-(-1) \\pm \\sqrt{(-1)^2 - 4(1)(1)}}{2(1)} = \\frac{1 \\pm i\\sqrt{3}}{2}$$\nThe roots are a complex conjugate pair. Their magnitude is:\n$$|z| = \\sqrt{\\left(\\frac{1}{2}\\right)^2 + \\left(\\pm\\frac{\\sqrt{3}}{2}\\right)^2} = \\sqrt{\\frac{1}{4} + \\frac{3}{4}} = \\sqrt{1} = 1$$\nSince the roots lie on the unit circle in the complex plane ($z = \\exp(\\pm i\\pi/3)$), the general solution for the error $e_n$ is of the form $e_{n} = A \\cos(n\\pi/3) + B \\sin(n\\pi/3)$ for some constants $A$ and $B$. This solution is purely oscillatory and does not decay to zero as $n \\to \\infty$. Consequently, the logarithmic step size $x_n$ oscillates around the steady state $s$ without converging, and the step size $k_n$ oscillates around its steady state value $k_{ss} = \\exp(s) = \\mathrm{tol}/C$ without decay. This confirms the instability of the aggressive controller.\n\n**Part 2: Stabilization with an Under-Relaxed Controller**\n\nTo stabilize the step-size selection, an under-relaxed power controller is introduced:\n$$k_{n+1} = k_{n} \\left(\\frac{\\mathrm{tol}}{r_{n}}\\right)^{\\beta}$$\nwhere $\\beta \\in (0,1)$ is a relaxation parameter. The estimator model remains $r_{n} = C k_{n-1}^{p}$.\n\nWe follow a similar procedure. First, substitute the estimator into the controller:\n$$k_{n+1} = k_{n} \\left(\\frac{\\mathrm{tol}}{C k_{n-1}^{p}}\\right)^{\\beta} = k_{n} (\\mathrm{tol}/C)^{\\beta} (k_{n-1}^{-p})^{\\beta} = k_n (\\mathrm{tol}/C)^{\\beta} k_{n-1}^{-p\\beta}$$\nNext, we transform to logarithmic variables $x_n = \\ln k_n$:\n$$\\ln k_{n+1} = \\ln k_{n} + \\beta \\ln(\\mathrm{tol}/C) - p\\beta \\ln k_{n-1}$$\n$$x_{n+1} = x_{n} - p\\beta x_{n-1} + \\beta(\\ln\\mathrm{tol} - \\ln C)$$\nThis is a linear (or, more precisely, affine) recurrence relation for $x_n$. The problem asks to linearize it about the fixed point $s = \\frac{1}{p}(\\ln\\mathrm{tol} - \\ln C)$. Since the relation is already affine, the linearization is exact and corresponds to analyzing the dynamics of the error $e_n = x_n - s$.\nSubstituting $x_n = e_n+s$ into the recurrence:\n$$e_{n+1} + s = (e_n+s) + \\beta \\ln(\\mathrm{tol}/C) - p\\beta (e_{n-1}+s)$$\n$$e_{n+1} = e_n - p\\beta e_{n-1} - p\\beta s + \\beta(\\ln\\mathrm{tol} - \\ln C)$$\nUsing the definition of the fixed point $s$, we have $p s = \\ln\\mathrm{tol} - \\ln C$. Substituting this into the equation:\n$$e_{n+1} = e_n - p\\beta e_{n-1} - \\beta(p s) + \\beta(p s)$$\n$$e_{n+1} = e_n - p\\beta e_{n-1}$$\nThis yields the homogeneous linear recurrence for the error:\n$$e_{n+1} - e_{n} + p\\beta e_{n-1} = 0$$\nThe corresponding characteristic polynomial is:\n$$z^2 - z + p\\beta = 0$$\nCritical damping requires that the characteristic polynomial has a repeated real root. This occurs when the discriminant of the quadratic equation is zero.\n$$(\\text{Discriminant}) = (-1)^2 - 4(1)(p\\beta) = 0$$\n$$1 - 4p\\beta = 0$$\nSolving for $\\beta$, we find:\n$$\\beta = \\frac{1}{4p}$$\nThe problem specifies that the time-stepping method is backward Euler, for which the order of consistency is $p=1$. Substituting $p=1$ into our expression for $\\beta$:\n$$\\beta = \\frac{1}{4(1)} = \\frac{1}{4}$$\nThis value of $\\beta = 1/4$ lies in the specified interval $(0,1)$. For this value, the characteristic polynomial becomes $z^2 - z + 1/4 = (z - 1/2)^2 = 0$, which has a repeated real root at $z=1/2$. Because the root satisfies $|z|1$, the error $e_n$ will decay to zero without oscillation, ensuring the stability of the step-size selection sequence.", "answer": "$$\\boxed{\\frac{1}{4}}$$", "id": "3447103"}]}