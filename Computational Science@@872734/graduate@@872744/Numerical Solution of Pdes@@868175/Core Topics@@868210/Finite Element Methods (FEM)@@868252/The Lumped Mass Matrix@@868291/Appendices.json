{"hands_on_practices": [{"introduction": "Understanding the theoretical properties of the lumped mass matrix is one thing; seeing its effect in action is another. This first practice provides a tangible entry point by applying the concept to a classic problem in computational mechanics: determining the natural vibration frequencies of an elastic bar. The resulting finite element formulation leads to a generalized eigenvalue problem of the form $K\\mathbf{u} = \\omega^2 M\\mathbf{u}$, where the accuracy of the computed frequencies $\\omega$ is directly influenced by the mass matrix $M$. By implementing and comparing the results from both consistent and lumped mass matrices against an exact analytical solution, you will gain a quantitative feel for the trade-offs in accuracy and how they are affected by element type and mesh density [@problem_id:3589685].", "problem": "Consider the axial vibration of a uniform, straight, prismatic bar of length $L$, cross-sectional area $A$, Youngâ€™s modulus $E$, and mass density $\\rho$. The governing equation for small-amplitude axial motion is the one-dimensional linear momentum balance, $E A \\, \\frac{\\partial^2 u}{\\partial x^2} + \\rho A \\, \\frac{\\partial^2 u}{\\partial t^2} = 0$, with homogeneous Dirichlet boundary conditions $u(0,t)=0$ and $u(L,t)=0$. The objective is to approximate the first three natural frequencies of this bar using the Finite Element Method (FEM) with polynomial interpolation shape functions, and to rigorously compare the effect of using a consistent mass matrix versus a diagonal lumped mass matrix obtained by either the row-sum technique or nodal quadrature.\n\nStarting from the axial wave equation and the weighted residual statement with the Galerkin choice of weight functions equal to the shape functions, derive the discrete eigenvalue problem in the form $K \\mathbf{u} = \\omega^2 M \\mathbf{u}$, where $K$ is the global stiffness matrix, $M$ is the global mass matrix, $\\mathbf{u}$ is the discrete mode shape vector, and $\\omega$ is the natural circular frequency. Construct $K$ and $M$ using one-dimensional Lagrange polynomial interpolation shape functions of degree one (linear) and degree two (quadratic), on a uniform mesh. For the mass matrix, compute:\n- The consistent mass matrix by exact polynomial integration over each element.\n- The diagonal lumped mass matrix by summing the rows of the global consistent mass matrix (row-sum lumping). You may alternatively implement lumping via nodal quadrature at the element level provided it yields the same diagonal entries.\n\nImplement the assembly procedure on a uniform mesh, enforce the homogeneous Dirichlet boundary conditions by eliminating the boundary degrees of freedom, and solve the generalized symmetric eigenvalue problem for the first three modes. Compare against the exact continuous solution for a fixed-fixed axial bar, whose natural circular frequencies are $\\omega_n = \\frac{n \\pi}{L} \\sqrt{\\frac{E}{\\rho}}$, for integer $n \\ge 1$.\n\nReport the relative error for each mode $n$ defined as $(\\omega_{n}^{\\text{FE}} - \\omega_{n}^{\\text{exact}})/\\omega_{n}^{\\text{exact}}$, expressed as decimal numbers without a percentage sign. The comparison should be presented for both the consistent and lumped mass matrices. Although natural frequencies carry the unit of radians per second, the requested outputs are unitless relative errors.\n\nUse the following scientifically consistent parameter sets as a test suite, spanning interpolation order and mesh density:\n- Case $1$: Linear elements, number of elements $N_e=4$, $L=1.0\\,\\text{m}$, $A=1.0 \\times 10^{-4}\\,\\text{m}^2$, $E=2.00\\times 10^{11}\\,\\text{Pa}$, $\\rho=7800\\,\\text{kg/m}^3$.\n- Case $2$: Linear elements, number of elements $N_e=20$, $L=1.0\\,\\text{m}$, $A=1.0 \\times 10^{-4}\\,\\text{m}^2$, $E=2.00\\times 10^{11}\\,\\text{Pa}$, $\\rho=7800\\,\\text{kg/m}^3$.\n- Case $3$: Quadratic elements, number of elements $N_e=2$, $L=1.0\\,\\text{m}$, $A=1.0 \\times 10^{-4}\\,\\text{m}^2$, $E=2.00\\times 10^{11}\\,\\text{Pa}$, $\\rho=7800\\,\\text{kg/m}^3$.\n- Case $4$: Quadratic elements, number of elements $N_e=5$, $L=1.0\\,\\text{m}$, $A=1.0 \\times 10^{-4}\\,\\text{m}^2$, $E=2.00\\times 10^{11}\\,\\text{Pa}$, $\\rho=7800\\,\\text{kg/m}^3$.\n\nYour program must compute, for each case, the list of six decimal values $[\\varepsilon_{c,1}, \\varepsilon_{l,1}, \\varepsilon_{c,2}, \\varepsilon_{l,2}, \\varepsilon_{c,3}, \\varepsilon_{l,3}]$, where $\\varepsilon_{c,n}$ is the relative error for mode $n$ using the consistent mass matrix, and $\\varepsilon_{l,n}$ is the relative error for mode $n$ using the lumped mass matrix. The final output must aggregate the four case-specific lists into a single line printed as a comma-separated list enclosed in square brackets, for example $[[\\ldots],[\\ldots],[\\ldots],[\\ldots]]$.\n\nNo user input is allowed; all parameters are embedded. The numerical results should be reproducible and scientifically sound. Ensure the construction of the shape functions, element matrices, and assembly is derived from first principles of polynomial interpolation and energy-consistent discretization.", "solution": "The problem of determining the natural frequencies of an axially vibrating bar is a classic eigenvalue problem in structural dynamics. The provided problem is well-posed, scientifically sound, and contains all necessary information to proceed with a solution using the Finite Element Method (FEM).\n\nThe governing partial differential equation for the axial displacement $u(x,t)$ is the one-dimensional wave equation:\n$$ E A \\frac{\\partial^2 u}{\\partial x^2} = \\rho A \\frac{\\partial^2 u}{\\partial t^2} $$\nAssuming a harmonic response of the form $u(x,t) = \\tilde{u}(x)e^{i\\omega t}$, where $\\tilde{u}(x)$ is the mode shape and $\\omega$ is the natural circular frequency, the problem reduces to a time-independent ordinary differential equation:\n$$ E A \\frac{d^2 \\tilde{u}}{dx^2} + \\rho A \\omega^2 \\tilde{u} = 0 $$\nwith homogeneous Dirichlet boundary conditions $\\tilde{u}(0) = 0$ and $\\tilde{u}(L) = 0$.\n\nTo formulate the finite element model, we start with the weighted residual statement. Multiplying the governing ODE by a weight function $w(x)$ and integrating over the domain $[0, L]$ yields:\n$$ \\int_0^L w \\left( E A \\frac{d^2 \\tilde{u}}{dx^2} + \\rho A \\omega^2 \\tilde{u} \\right) dx = 0 $$\nApplying integration by parts to the stiffness term gives the weak form:\n$$ -\\int_0^L E A \\frac{dw}{dx} \\frac{d\\tilde{u}}{dx} dx + \\left[ w E A \\frac{d\\tilde{u}}{dx} \\right]_0^L + \\omega^2 \\int_0^L \\rho A w \\tilde{u} dx = 0 $$\nIn the Galerkin method, the weight functions $w(x)$ are chosen from the same space as the trial functions for $\\tilde{u}(x)$. To satisfy the essential boundary conditions at $x=0$ and $x=L$, we require $w(0)=0$ and $w(L)=0$, which makes the boundary term $\\left[ w E A d\\tilde{u}/dx \\right]_0^L$ vanish. The weak form to be solved is:\nFind $\\tilde{u}(x)$ such that for all admissible $w(x)$:\n$$ \\int_0^L E A \\frac{dw}{dx} \\frac{d\\tilde{u}}{dx} dx = \\omega^2 \\int_0^L \\rho A w \\tilde{u} dx $$\n\nThe domain is discretized into $N_e$ elements. Within each element $\\Omega_e$, the displacement field is approximated using polynomial shape functions $\\mathbf{N}^{(e)}$ and nodal displacements $\\mathbf{d}^{(e)}$:\n$$ \\tilde{u}^{(e)}(x) = \\mathbf{N}^{(e)}(x) \\mathbf{d}^{(e)} $$\nApplying the Galerkin principle, where $w$ is taken to be each shape function in turn, and summing the contributions from all elements leads to the global discrete system, a generalized eigenvalue problem:\n$$ K \\mathbf{d} = \\omega^2 M \\mathbf{d} $$\nwhere $\\mathbf{d}$ is the global vector of nodal displacements, and the global stiffness matrix $K$ and mass matrix $M$ are assembled from the element matrices $K^{(e)}$ and $M^{(e)}$:\n$$ K^{(e)} = \\int_{\\Omega_e} E A (\\mathbf{B}^{(e)})^T \\mathbf{B}^{(e)} dx \\quad , \\quad M^{(e)} = \\int_{\\Omega_e} \\rho A (\\mathbf{N}^{(e)})^T \\mathbf{N}^{(e)} dx $$\nHere, $\\mathbf{B}^{(e)} = d\\mathbf{N}^{(e)}/dx$ is the strain-displacement matrix.\n\nIntegrals are typically evaluated over a standard parent element with local coordinate $\\xi \\in [-1, 1]$. For a uniform mesh with element length $h_e = L/N_e$, the Jacobian of the transformation from $\\xi$ to $x$ is $J = h_e/2$. The element matrices become:\n$$ K^{(e)} = \\frac{EA}{h_e} \\int_{-1}^{1} \\left(\\frac{d\\mathbf{N}}{d\\xi}\\right)^T \\frac{d\\mathbf{N}}{d\\xi} d\\xi $$\n$$ M^{(e)} = \\frac{\\rho A h_e}{2} \\int_{-1}^{1} \\mathbf{N}^T \\mathbf{N} d\\xi $$\n\n**1-D Linear Element (2 nodes)**\nThe element has two nodes at $\\xi = -1$ and $\\xi = 1$. The linear Lagrange shape functions are:\n$$ N_1(\\xi) = \\frac{1-\\xi}{2}, \\quad N_2(\\xi) = \\frac{1+\\xi}{2} $$\nThe element stiffness matrix is:\n$$ K^{(e)} = \\frac{EA}{h_e} \\begin{bmatrix} 1 & -1 \\\\ -1 & 1 \\end{bmatrix} $$\nThe element consistent mass matrix is:\n$$ M_c^{(e)} = \\frac{\\rho A h_e}{6} \\begin{bmatrix} 2 & 1 \\\\ 1 & 2 \\end{bmatrix} $$\nThe diagonal lumped mass matrix is obtained by summing the rows of $M_c^{(e)}$ and placing the sums on the diagonal. This is equivalent to lumping half of the element's mass at each node:\n$$ M_l^{(e)} = \\frac{\\rho A h_e}{2} \\begin{bmatrix} 1 & 0 \\\\ 0 & 1 \\end{bmatrix} $$\n\n**1-D Quadratic Element (3 nodes)**\nThe element has three nodes at $\\xi = -1, 0, 1$. The quadratic Lagrange shape functions are:\n$$ N_1(\\xi) = \\frac{\\xi(\\xi-1)}{2}, \\quad N_2(\\xi) = 1-\\xi^2, \\quad N_3(\\xi) = \\frac{\\xi(\\xi+1)}{2} $$\nThe element stiffness matrix is:\n$$ K^{(e)} = \\frac{EA}{3h_e} \\begin{bmatrix} 7 & -8 & 1 \\\\ -8 & 16 & -8 \\\\ 1 & -8 & 7 \\end{bmatrix} $$\nThe element consistent mass matrix is:\n$$ M_c^{(e)} = \\frac{\\rho A h_e}{30} \\begin{bmatrix} 4 & 2 & -1 \\\\ 2 & 16 & 2 \\\\ -1 & 2 & 4 \\end{bmatrix} $$\nThe diagonal lumped mass matrix from row-summing is:\n$$ M_l^{(e)} = \\frac{\\rho A h_e}{30} \\begin{bmatrix} 5 & 0 & 0 \\\\ 0 & 20 & 0 \\\\ 0 & 0 & 5 \\end{bmatrix} = \\frac{\\rho A h_e}{6} \\begin{bmatrix} 1 & 0 & 0 \\\\ 0 & 4 & 0 \\\\ 0 & 0 & 1 \\end{bmatrix} $$\n\n**Assembly and Boundary Conditions**\nGlobal matrices $K$ and $M$ are constructed by iterating through each element and adding its contributions to the appropriate global degrees of freedom (DOFs). For linear elements, there are $N_n = N_e+1$ nodes. For quadratic elements, $N_n = 2N_e+1$ nodes. The homogeneous Dirichlet boundary conditions $u(0)=u(L)=0$ are enforced by eliminating the rows and columns corresponding to the first and last nodes from the global matrices. This results in reduced matrices $K_{red}$ and $M_{red}$ of size $(N_n-2) \\times (N_n-2)$.\n\n**Eigenvalue Problem and Error Calculation**\nWe solve the reduced generalized eigenvalue problem for both consistent and lumped mass matrices:\n$$ K_{red} \\mathbf{d}_{red} = \\omega_c^2 M_{c,red} \\mathbf{d}_{red} \\quad \\text{and} \\quad K_{red} \\mathbf{d}_{red} = \\omega_l^2 M_{l,red} \\mathbf{d}_{red} $$\nThe eigenvalues $\\omega^2$ are computed, and the natural frequencies are found by taking the square root. The first three computed frequencies, $\\omega_{n}^{\\text{FE}}$, are compared to the exact analytical solution for a fixed-fixed bar:\n$$ \\omega_n^{\\text{exact}} = \\frac{n \\pi}{L} \\sqrt{\\frac{E}{\\rho}}, \\quad n=1, 2, 3, \\dots $$\nThe relative error for each mode $n$ is calculated as:\n$$ \\varepsilon_n = \\frac{\\omega_{n}^{\\text{FE}} - \\omega_{n}^{\\text{exact}}}{\\omega_{n}^{\\text{exact}}} $$\nThis procedure is repeated for each of the four specified test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef compute_errors(elem_type, N_e, L, A, E, rho):\n    \"\"\"\n    Computes the relative errors for the first three natural frequencies of an axial bar\n    using the Finite Element Method.\n\n    Args:\n        elem_type (str): 'linear' or 'quadratic'.\n        N_e (int): Number of elements.\n        L (float): Length of the bar.\n        A (float): Cross-sectional area.\n        E (float): Young's modulus.\n        rho (float): Mass density.\n\n    Returns:\n        list: A list of six float values representing the relative errors:\n              [err_c1, err_l1, err_c2, err_l2, err_c3, err_l3]\n              'c' for consistent mass, 'l' for lumped mass.\n    \"\"\"\n    \n    h_e = L / N_e\n    \n    if elem_type == 'linear':\n        n_nodes_elem = 2\n        n_dof_total = N_e + 1\n        \n        # Element stiffness matrix\n        K_e = (E * A / h_e) * np.array([[1, -1], [-1, 1]])\n        \n        # Element consistent mass matrix\n        M_c_e = (rho * A * h_e / 6.0) * np.array([[2, 1], [1, 2]])\n        \n        # Element lumped mass matrix (row-sum technique)\n        M_l_e = np.diag(M_c_e.sum(axis=1))\n        \n    elif elem_type == 'quadratic':\n        n_nodes_elem = 3\n        n_dof_total = 2 * N_e + 1\n        \n        # Element stiffness matrix\n        K_e = (E * A / (3.0 * h_e)) * np.array([\n            [7, -8, 1],\n            [-8, 16, -8],\n            [1, -8, 7]\n        ])\n        \n        # Element consistent mass matrix\n        M_c_e = (rho * A * h_e / 30.0) * np.array([\n            [4, 2, -1],\n            [2, 16, 2],\n            [-1, 2, 4]\n        ])\n        \n        # Element lumped mass matrix (row-sum technique)\n        M_l_e = np.diag(M_c_e.sum(axis=1))\n        \n    else:\n        raise ValueError(\"Invalid element type specified.\")\n\n    # Initialize global matrices\n    K_global = np.zeros((n_dof_total, n_dof_total))\n    M_c_global = np.zeros((n_dof_total, n_dof_total))\n    M_l_global = np.zeros((n_dof_total, n_dof_total))\n\n    # Assembly\n    nodes_per_elem_minus_1 = n_nodes_elem - 1\n    for i in range(N_e):\n        # Determine global indices for the current element's nodes\n        if elem_type == 'linear': # P1 elements\n            start_idx = i\n        else: # P2 elements\n            start_idx = i * 2\n        \n        dof_map = slice(start_idx, start_idx + n_nodes_elem)\n        \n        K_global[dof_map, dof_map] += K_e\n        M_c_global[dof_map, dof_map] += M_c_e\n        M_l_global[dof_map, dof_map] += M_l_e\n\n    # Apply homogeneous Dirichlet boundary conditions (u(0)=0, u(L)=0)\n    # by removing first and last rows/columns\n    internal_dofs = slice(1, n_dof_total - 1)\n    K_red = K_global[internal_dofs, internal_dofs]\n    M_c_red = M_c_global[internal_dofs, internal_dofs]\n    M_l_red = M_l_global[internal_dofs, internal_dofs]\n\n    # Solve generalized eigenvalue problems\n    # scipy.linalg.eigh returns eigenvalues in ascending order\n    # eigenvalues are omega^2\n    \n    # Consistent mass\n    eigvals_c = eigh(K_red, M_c_red, eigvals_only=True)\n    omega_fe_c = np.sqrt(eigvals_c)\n\n    # Lumped mass\n    eigvals_l = eigh(K_red, M_l_red, eigvals_only=True)\n    omega_fe_l = np.sqrt(eigvals_l)\n\n    # Calculate exact frequencies\n    c = np.sqrt(E / rho)\n    n_modes = 3\n    omega_exact = [(n + 1) * np.pi * c / L for n in range(n_modes)]\n    \n    # Calculate relative errors\n    errors = []\n    for i in range(n_modes):\n        # For small problems (3 DOFs), we only get 3 frequencies.\n        # For larger problems, ensure we don't index out of bounds.\n        if i < len(omega_fe_c):\n            err_c = (omega_fe_c[i] - omega_exact[i]) / omega_exact[i]\n            err_l = (omega_fe_l[i] - omega_exact[i]) / omega_exact[i]\n            errors.extend([err_c, err_l])\n        else:\n            # Should not happen for the given test cases\n            errors.extend([np.nan, np.nan])\n            \n    return errors\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        {'elem_type': 'linear', 'N_e': 4, 'L': 1.0, 'A': 1.0e-4, 'E': 2.0e11, 'rho': 7800},\n        {'elem_type': 'linear', 'N_e': 20, 'L': 1.0, 'A': 1.0e-4, 'E': 2.0e11, 'rho': 7800},\n        {'elem_type': 'quadratic', 'N_e': 2, 'L': 1.0, 'A': 1.0e-4, 'E': 2.0e11, 'rho': 7800},\n        {'elem_type': 'quadratic', 'N_e': 5, 'L': 1.0, 'A': 1.0e-4, 'E': 2.0e11, 'rho': 7800}\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = compute_errors(\n            elem_type=case['elem_type'],\n            N_e=case['N_e'],\n            L=case['L'],\n            A=case['A'],\n            E=case['E'],\n            rho=case['rho']\n        )\n        all_results.append(result)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n\n```", "id": "3589685"}, {"introduction": "One of the most compelling reasons to use a lumped mass matrix is the computational advantage it offers in explicit time-stepping schemes for parabolic and hyperbolic PDEs. By rendering the mass matrix diagonal, its inversion becomes trivial, which is a critical step in advancing the solution in time. This exercise moves beyond eigenvalue problems to explore the impact of mass lumping on the stability of an explicit method for the heat equation. You will analytically derive and compare the maximum stable time step, dictated by the Courant-Friedrichs-Lewy (CFL) condition, for a fully lumped scheme versus one that uses a simple diagonal approximation of the consistent mass matrix [@problem_id:3456072]. This practice provides a rigorous basis for understanding why mass lumping is often indispensable for efficient explicit dynamics.", "problem": "Consider the heat equation with unit thermal diffusivity on a flat two-dimensional torus, $u_t = \\Delta u$, discretized in space by the Finite Element Method (FEM) with continuous, piecewise-linear shape functions on a uniform, periodic triangulation of the plane by congruent equilateral triangles of edge length $\\ell$. Let $K$ denote the assembled stiffness matrix with entries $K_{ij} = \\int_{\\Omega} \\nabla \\phi_i \\cdot \\nabla \\phi_j \\, \\mathrm{d}x$, and let $M$ denote the consistent mass matrix with entries $M_{ij} = \\int_{\\Omega} \\phi_i \\phi_j \\, \\mathrm{d}x$. Define the lumped mass matrix $M_L$ as the diagonal matrix obtained by row-summing $M$. Consider the explicit forward Euler time discretization of the semi-discrete system $M \\dot{u} + K u = 0$, so that $u^{n+1} = u^n - \\Delta t \\, B K u^n$, where $B$ is either $M_L^{-1}$ (lumped mass) or an approximation to $M^{-1}$ obtained by performing a single Jacobi iteration starting from the zero initial guess, i.e., $B = D^{-1}$ with $D = \\operatorname{diag}(M)$.\n\nUsing only the fundamental definitions above and well-tested facts about the stability of forward Euler for linear systems, compute the maximum linearly stable time step $\\Delta t_{\\max}$ for:\n- the lumped mass case $B = M_L^{-1}$,\n- the single-Jacobi-inverted consistent mass case $B = D^{-1}$,\non this periodic equilateral mesh. Express the two values as a closed-form analytic expression in terms of the edge length $\\ell$ only, and provide them in the order $(\\Delta t_{\\max}^{\\mathrm{lump}}, \\Delta t_{\\max}^{\\mathrm{Jacobi}})$.\n\nYour final answer must be a single row matrix containing the two expressions. No rounding is required, and no physical units are to be reported in the final answer.", "solution": "The user wants to find the maximum stable time step for the forward Euler time discretization of the finite element approximation of the heat equation $u_t = \\Delta u$ on a periodic mesh of equilateral triangles. The stability of the explicit scheme $u^{n+1} = (I - \\Delta t \\, B K) u^n$ is determined by the spectral radius of the matrix $BK$. For a symmetric positive semi-definite stiffness matrix $K$ and a symmetric positive definite matrix $B$, the matrix $B^{1/2} K B^{1/2}$ is also symmetric positive semi-definite, and thus has real, non-negative eigenvalues. Since $BK$ is similar to $B^{1/2} K B^{1/2}$, its eigenvalues $\\lambda_j(BK)$ are also real and non-negative.\n\nThe stability condition for the forward Euler method requires that all eigenvalues of the amplification matrix $G = I - \\Delta t B K$ satisfy $|\\mu_j| \\le 1$. The eigenvalues of $G$ are $\\mu_j = 1 - \\Delta t \\lambda_j(BK)$. The condition becomes $|1 - \\Delta t \\lambda_j| \\le 1$, which for real non-negative $\\lambda_j$ simplifies to $-1 \\le 1 - \\Delta t \\lambda_j \\le 1$. This implies $0 \\le \\Delta t \\lambda_j \\le 2$. The critical constraint is determined by the largest eigenvalue, $\\lambda_{\\max}(BK)$, leading to the stability limit:\n$$ \\Delta t \\le \\frac{2}{\\lambda_{\\max}(BK)} $$\nOur task is to compute $\\lambda_{\\max}(BK)$ for the two given choices of $B$. This requires calculating the entries of the stiffness matrix $K$ and the mass-related matrices $B$.\n\nFirst, we compute the local element matrices for a single equilateral triangle of edge length $\\ell$. The area of such a triangle is $A = \\frac{\\sqrt{3}}{4}\\ell^2$. For linear shape functions $\\phi_i$, the local stiffness matrix $K^e$ and consistent mass matrix $M^e$ are given by standard formulas:\n$$ K^e_{ij} = \\int_e \\nabla\\phi_i \\cdot \\nabla\\phi_j \\, \\mathrm{d}x, \\quad M^e_{ij} = \\int_e \\phi_i \\phi_j \\, \\mathrm{d}x $$\nFor an equilateral triangle, these matrices are:\n$$ K^e = \\frac{1}{2\\sqrt{3}} \\begin{pmatrix} 2 & -1 & -1 \\\\ -1 & 2 & -1 \\\\ -1 & -1 & 2 \\end{pmatrix}, \\quad M^e = \\frac{A}{12} \\begin{pmatrix} 2 & 1 & 1 \\\\ 1 & 2 & 1 \\\\ 1 & 1 & 2 \\end{pmatrix} = \\frac{\\sqrt{3}\\ell^2}{48} \\begin{pmatrix} 2 & 1 & 1 \\\\ 1 & 2 & 1 \\\\ 1 & 1 & 2 \\end{pmatrix} $$\nThe uniform triangulation of a torus means every node is topologically identical. Each node is a vertex of $6$ congruent equilateral triangles and has $6$ neighbors. We can determine the stencils for the global matrices $K$ and $M$ by summing the contributions from the elements sharing a node. Let's consider a node $i$.\n\nThe diagonal entry $K_{ii}$ is the sum of $6$ diagonal contributions from $K^e$:\n$K_{ii} = 6 \\times \\left(K^e\\right)_{\\text{diag}} = 6 \\times \\frac{1}{\\sqrt{3}} = 2\\sqrt{3}$.\nThe off-diagonal entry $K_{ij}$ for a neighbor $j$ is the sum of $2$ off-diagonal contributions from the two elements sharing the edge $(i, j)$:\n$K_{ij} = 2 \\times \\left(K^e\\right)_{\\text{off-diag}} = 2 \\times \\left(-\\frac{1}{2\\sqrt{3}}\\right) = -\\frac{1}{\\sqrt{3}}$.\n\nSimilarly for the mass matrix $M$:\n$M_{ii} = 6 \\times \\frac{2A}{12} = A = \\frac{\\sqrt{3}}{4}\\ell^2$.\n$M_{ij} = 2 \\times \\frac{A}{12} = \\frac{A}{6} = \\frac{\\sqrt{3}}{24}\\ell^2$.\n\nDue to the periodic and uniform nature of the grid, the eigenvectors of $K$ and $M$ are discrete plane waves $u_j = \\exp(i\\mathbf{k} \\cdot \\mathbf{x}_j)$, where $\\mathbf{x}_j$ is the position of node $j$. The corresponding eigenvalues (Fourier symbols) are functions of the wave vector $\\mathbf{k}=(k_x, k_y)$.\nLet node $i$ be at the origin. Its neighbors are at positions $\\mathbf{x}_1 = (\\ell, 0)$, $\\mathbf{x}_2 = (\\ell/2, \\ell\\sqrt{3}/2)$, $\\mathbf{x}_3 = (-\\ell/2, \\ell\\sqrt{3}/2)$, and their opposites. The eigenvalue of a matrix with this stencil structure is found by applying it to the eigenvector:\n$\\hat{K}(\\mathbf{k}) = K_{ii} + \\sum_{j \\in N(i)} K_{ij} e^{i\\mathbf{k}\\cdot\\mathbf{x}_j} = 2\\sqrt{3} - \\frac{1}{\\sqrt{3}} \\sum_{j=1}^6 e^{i\\mathbf{k}\\cdot\\mathbf{x}_j}$.\nThe sum evaluates to $\\sum_{j=1}^6 e^{i\\mathbf{k}\\cdot\\mathbf{x}_j} = 2\\cos(k_x \\ell) + 4\\cos(k_x \\ell / 2)\\cos(k_y \\ell \\sqrt{3} / 2)$.\nLet's define $C(\\mathbf{k}) = \\cos(k_x \\ell) + 2\\cos(k_x \\ell/2)\\cos(k_y \\ell\\sqrt{3}/2)$.\nThen $\\hat{K}(\\mathbf{k}) = 2\\sqrt{3} - \\frac{2}{\\sqrt{3}} C(\\mathbf{k}) = \\frac{2}{\\sqrt{3}}(3 - C(\\mathbf{k}))$.\n\nTo find the maximum eigenvalue of $BK$, we need to find the maximum of $\\hat{B}(\\mathbf{k})\\hat{K}(\\mathbf{k})$ over all $\\mathbf{k}$. This requires finding the minimum value of $C(\\mathbf{k})$. Let $\\alpha = k_x\\ell/2$ and $\\beta = k_y\\ell\\sqrt{3}/2$. Then $C(\\mathbf{k})$ becomes $f(\\alpha, \\beta) = \\cos(2\\alpha) + 2\\cos(\\alpha)\\cos(\\beta) = 2\\cos^2(\\alpha) - 1 + 2\\cos(\\alpha)\\cos(\\beta)$. By analyzing this function, its minimum value is found to be $-\\frac{3}{2}$.\n\nNow we analyze the two cases for $B$.\n\n**Case 1: Lumped Mass ($B = M_L^{-1}$)**\nThe lumped mass matrix $M_L$ is diagonal with entries $(M_L)_{ii} = \\sum_j M_{ij}$.\n$(M_L)_{ii} = M_{ii} + 6 \\times M_{ij} = A + 6 \\times \\frac{A}{6} = 2A = \\frac{\\sqrt{3}}{2}\\ell^2$.\nSo, $M_L = \\frac{\\sqrt{3}}{2}\\ell^2 I$, where $I$ is the identity matrix.\nThen $B = M_L^{-1} = \\frac{2}{\\sqrt{3}\\ell^2} I$. This matrix is a scalar multiple of the identity, so its symbol $\\hat{B}$ is constant.\nThe eigenvalues of $BK$ are $\\lambda(\\mathbf{k}) = \\hat{B} \\hat{K}(\\mathbf{k}) = \\frac{2}{\\sqrt{3}\\ell^2} \\cdot \\frac{2}{\\sqrt{3}}(3 - C(\\mathbf{k})) = \\frac{4}{3\\ell^2}(3 - C(\\mathbf{k}))$.\nThe maximum eigenvalue $\\lambda_{\\max}$ occurs when $C(\\mathbf{k})$ is at its minimum, i.e., $C(\\mathbf{k}) = -3/2$.\n$\\lambda_{\\max}(M_L^{-1}K) = \\frac{4}{3\\ell^2}\\left(3 - \\left(-\\frac{3}{2}\\right)\\right) = \\frac{4}{3\\ell^2}\\left(\\frac{9}{2}\\right) = \\frac{6}{\\ell^2}$.\nThe maximum stable time step for the lumped mass case is:\n$\\Delta t_{\\max}^{\\mathrm{lump}} = \\frac{2}{\\lambda_{\\max}} = \\frac{2}{6/\\ell^2} = \\frac{\\ell^2}{3}$.\n\n**Case 2: Single Jacobi Iteration ($B = D^{-1}$)**\nHere, $D = \\operatorname{diag}(M)$. The diagonal entries are $D_{ii} = M_{ii} = A = \\frac{\\sqrt{3}}{4}\\ell^2$.\nSo, $D = \\frac{\\sqrt{3}}{4}\\ell^2 I$.\nThen $B = D^{-1} = \\frac{4}{\\sqrt{3}\\ell^2} I$. Again, a scalar matrix.\nThe eigenvalues of $BK$ are $\\lambda(\\mathbf{k}) = \\hat{B} \\hat{K}(\\mathbf{k}) = \\frac{4}{\\sqrt{3}\\ell^2} \\cdot \\frac{2}{\\sqrt{3}}(3 - C(\\mathbf{k})) = \\frac{8}{3\\ell^2}(3 - C(\\mathbf{k}))$.\nThe maximum eigenvalue again corresponds to the minimum of $C(\\mathbf{k})$:\n$\\lambda_{\\max}(D^{-1}K) = \\frac{8}{3\\ell^2}\\left(3 - \\left(-\\frac{3}{2}\\right)\\right) = \\frac{8}{3\\ell^2}\\left(\\frac{9}{2}\\right) = \\frac{12}{\\ell^2}$.\nThe maximum stable time step for the single-Jacobi-inversion case is:\n$\\Delta t_{\\max}^{\\mathrm{Jacobi}} = \\frac{2}{\\lambda_{\\max}} = \\frac{2}{12/\\ell^2} = \\frac{\\ell^2}{6}$.\n\nThe two requested values are $\\Delta t_{\\max}^{\\mathrm{lump}} = \\frac{\\ell^2}{3}$ and $\\Delta t_{\\max}^{\\mathrm{Jacobi}} = \\frac{\\ell^2}{6}$.", "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{\\ell^2}{3} & \\frac{\\ell^2}{6} \\end{pmatrix} } $$", "id": "3456072"}, {"introduction": "The effects of mass lumping extend into more advanced numerical frameworks, such as stabilized mixed finite element methods. In these methods, which are common for modeling phenomena like fluid flow and wave propagation, the choice of discretization can give rise to non-physical, spurious oscillations in the solution. This final practice delves into this issue within the context of linear acoustics, where equal-order interpolation for pressure and velocity can produce spurious 'checkerboard' pressure modes. You will investigate how replacing the consistent pressure mass matrix with its lumped counterpart affects a stabilization term designed to damp these modes [@problem_id:3456088]. This exercise highlights the subtle but critical interplay between mass matrix formulation and other components of a modern numerical scheme.", "problem": "Consider the one-dimensional linear acoustics system on a periodic domain represented in first-order form by the coupled partial differential equations\n$$\n\\rho \\,\\frac{\\partial u}{\\partial t} + \\frac{\\partial p}{\\partial x} = 0, \\qquad \\kappa^{-1}\\,\\frac{\\partial p}{\\partial t} + \\frac{\\partial u}{\\partial x} = 0,\n$$\nwhere $u$ is the velocity and $p$ is the pressure, $\\rho$ is the density, and $\\kappa$ is the bulk modulus. We will analyze a stabilized equal-order mixed discretization on a uniform mesh with $N$ nodes over the unit interval with periodic boundary conditions. The unknowns $u$ and $p$ are both discretized using the same continuous piecewise-linear basis (equal-order), and the system is stabilized by augmenting the pressure equation with a symmetric diffusion-like term, resulting in the semi-discrete form\n$$\nM_u \\,\\frac{d\\mathbf{u}}{dt} + G\\,\\mathbf{p} = \\mathbf{0}, \\qquad M_p \\,\\frac{d\\mathbf{p}}{dt} + D\\,\\mathbf{u} + \\eta\\,K\\,\\mathbf{p} = \\mathbf{0},\n$$\nwhere $\\mathbf{u}$ and $\\mathbf{p}$ are coefficient vectors of $u$ and $p$, $M_u$ and $M_p$ are the velocity and pressure mass matrices, $G$ approximates the gradient operator, $D$ approximates the divergence operator, $K$ is the standard stiffness matrix associated with the bilinear form $(\\nabla p,\\nabla q)$, and $\\eta \\ge 0$ is the stabilization parameter. Two versions of the pressure mass matrix are considered: the consistent mass matrix $M_p$ obtained from exact element-level integration and the lumped pressure mass matrix $M_\\ell$ obtained by row-sum diagonal approximation of $M_p$.\n\nStarting from the fundamental base of the Galerkin method (weak form, element-level integrals) and standard central-difference representations of gradient and divergence on a uniform periodic grid, perform the following tasks:\n\n1. Construct the discrete gradient operator $G$ acting on nodal pressures via central differences on a periodic grid with $N$ nodes and uniform spacing $h = 1/N$, i.e., \n$$\n(G\\mathbf{p})_i = \\frac{\\mathbf{p}_{i+1} - \\mathbf{p}_{i-1}}{2h},\n$$\nwith periodic indexing. Construct the divergence operator $D$ in the same manner.\n\n2. Assemble the one-dimensional consistent pressure mass matrix $M_p$ using standard continuous piecewise-linear finite elements on a uniform mesh with periodic boundary conditions, by integrating the products of basis functions over each element. Assemble the corresponding lumped pressure mass matrix $M_\\ell$ by diagonal row-sum lumping of $M_p$.\n\n3. Assemble the one-dimensional stiffness matrix $K$ for the pressure using the standard continuous piecewise-linear finite elements on the uniform periodic mesh, by integrating $(\\partial_x \\phi_i)(\\partial_x \\phi_j)$ over each element.\n\n4. Define the checkerboard pressure mode $\\mathbf{p}^{\\mathrm{cb}}$ by $\\mathbf{p}^{\\mathrm{cb}}_i = (-1)^i$ for node indices $i=0,1,\\dots,N-1$. Demonstrate the decoupling of this mode from the velocity update in the equal-order collocated central-difference scheme by computing the discrete quantity $\\|G\\mathbf{p}^{\\mathrm{cb}}\\|_2$ and assessing whether it is numerically zero.\n\n5. For the stabilized pressure-only subdynamics induced by the decoupling of the checkerboard mode, consider the linear ordinary differential equation\n$$\nM \\,\\frac{d\\mathbf{p}}{dt} + \\eta \\,K\\,\\mathbf{p} = \\mathbf{0},\n$$\nwhere $M$ is either $M_p$ (consistent) or $M_\\ell$ (lumped). For the checkerboard mode, compute the decay rate via the Rayleigh quotient\n$$\n\\lambda(M) = \\eta\\,\\frac{(\\mathbf{p}^{\\mathrm{cb}})^{\\top} K\\,\\mathbf{p}^{\\mathrm{cb}}}{(\\mathbf{p}^{\\mathrm{cb}})^{\\top} M\\,\\mathbf{p}^{\\mathrm{cb}}}.\n$$\nReturn the rates $\\lambda(M_p)$ and $\\lambda(M_\\ell)$ as real numbers.\n\nYour program must implement the above assembly and computations and evaluate the following test suite of parameter values:\n- Case 1 (happy path): $N=4$, $\\eta=1.0$.\n- Case 2 (refined grid): $N=8$, $\\eta=1.0$.\n- Case 3 (boundary grid size): $N=2$, $\\eta=1.0$.\n- Case 4 (weaker stabilization): $N=8$, $\\eta=0.25$.\n\nFor each case, produce a result triplet consisting of:\n- A boolean indicating whether $\\|G\\mathbf{p}^{\\mathrm{cb}}\\|_2$ is less than the threshold $10^{-12}$ (interpreted as decoupled if true).\n- The decay rate $\\lambda(M_p)$ computed with the consistent pressure mass matrix.\n- The decay rate $\\lambda(M_\\ell)$ computed with the lumped pressure mass matrix.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list of four triplets, each triplet enclosed in square brackets, and the entire list enclosed in square brackets, with no additional text. For example, a valid output line is of the form\n$$\n[\\,[\\text{bool},\\text{float},\\text{float}],\\,[\\text{bool},\\text{float},\\text{float}],\\,[\\text{bool},\\text{float},\\text{float}],\\,[\\text{bool},\\text{float},\\text{float}]\\,].\n$$", "solution": "The problem is analyzed for validity.\n\n### Step 1: Extract Givens\n- **Governing Equations**:\n  $$\n  \\rho \\,\\frac{\\partial u}{\\partial t} + \\frac{\\partial p}{\\partial x} = 0, \\qquad \\kappa^{-1}\\,\\frac{\\partial p}{\\partial t} + \\frac{\\partial u}{\\partial x} = 0\n  $$\n- **Domain**: One-dimensional unit interval with periodic boundary conditions.\n- **Discretization**: Equal-order continuous piecewise-linear basis for velocity $u$ and pressure $p$. Uniform mesh with $N$ nodes and spacing $h = 1/N$.\n- **Semi-Discrete Form**:\n  $$\n  M_u \\,\\frac{d\\mathbf{u}}{dt} + G\\,\\mathbf{p} = \\mathbf{0}, \\qquad M_p \\,\\frac{d\\mathbf{p}}{dt} + D\\,\\mathbf{u} + \\eta\\,K\\,\\mathbf{p} = \\mathbf{0}\n  $$\n- **Matrix/Vector Definitions**:\n  - $\\mathbf{u}, \\mathbf{p}$: Coefficient vectors for velocity and pressure.\n  - $M_u, M_p$: Velocity and pressure consistent mass matrices.\n  - $M_\\ell$: Lumped pressure mass matrix via row-sum of $M_p$.\n  - $G$: Discrete gradient operator, defined by $(G\\mathbf{p})_i = \\frac{\\mathbf{p}_{i+1} - \\mathbf{p}_{i-1}}{2h}$ with periodic indexing.\n  - $D$: Discrete divergence operator, constructed in the same manner as $G$.\n  - $K$: Stiffness matrix from bilinear form $(\\nabla p, \\nabla q)$.\n  - $\\eta \\ge 0$: Stabilization parameter.\n- **Checkerboard Mode**: $\\mathbf{p}^{\\mathrm{cb}}$ defined by $\\mathbf{p}^{\\mathrm{cb}}_i = (-1)^i$ for $i=0, \\dots, N-1$.\n- **Decay Rate**:\n  $$\n  \\lambda(M) = \\eta\\,\\frac{(\\mathbf{p}^{\\mathrm{cb}})^{\\top} K\\,\\mathbf{p}^{\\mathrm{cb}}}{(\\mathbf{p}^{\\mathrm{cb}})^{\\top} M\\,\\mathbf{p}^{\\mathrm{cb}}}\n  $$\n  for $M$ being either $M_p$ or $M_\\ell$.\n- **Tasks**:\n  1. Construct $G$ and $D$.\n  2. Assemble $M_p$ and $M_\\ell$.\n  3. Assemble $K$.\n  4. Compute $\\|G\\mathbf{p}^{\\mathrm{cb}}\\|_2$ to check for decoupling.\n  5. Compute decay rates $\\lambda(M_p)$ and $\\lambda(M_\\ell)$.\n- **Test Cases**:\n  - Case 1: $N=4$, $\\eta=1.0$.\n  - Case 2: $N=8$, $\\eta=1.0$.\n  - Case 3: $N=2$, $\\eta=1.0$.\n  - Case 4: $N=8$, $\\eta=0.25$.\n- **Output Format**: For each case, a triplet: $[\\text{bool for decoupling}, \\lambda(M_p), \\lambda(M_\\ell)]$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem describes a standard stabilized mixed finite element method for the linear acoustics equations, a fundamental topic in computational physics and engineering. The use of equal-order elements, checkerboard modes, Laplacian stabilization ($\\eta K$), and mass lumping are all established concepts in numerical methods for an PDEs. The problem is scientifically and mathematically sound.\n- **Well-Posed**: The tasks are clearly defined mathematical operations (matrix assembly, norm computation, Rayleigh quotient calculation). The inputs ($N$, $\\eta$) are specified, and the required outputs are unambiguous. A unique, stable, and meaningful solution exists for each task.\n- **Objective**: The problem is stated in precise mathematical language. There are no subjective or opinion-based statements.\n- **No Invalidating Flaws**:\n  1. **Scientific/Factual Unsoundness**: None. The physics and numerics are standard.\n  2. **Non-Formalizable/Irrelevant**: The problem is formal and directly relevant to the topic of numerical PDE solutions.\n  3. **Incomplete/Contradictory Setup**: The problem is self-contained. All necessary definitions for constructing the matrices and performing the calculations are provided or are standard in the field (e.g., piecewise-linear basis functions). The definition of periodic indexing clarifies the boundary conditions.\n  4. **Unrealistic/Infeasible**: The setup is a standard model problem, not a simulation of a real-world physical system with complex constraints. All computations are feasible.\n  5. **Ill-Posed/Poorly Structured**: The tasks are well-defined.\n  6. **Pseudo-Profound/Trivial**: The problem requires a solid understanding of finite element matrix assembly on periodic domains and the behavior of specific numerical modes. While solvable with standard techniques, it is not trivial and tests core concepts.\n  7. **Outside Scientific Verifiability**: All results are mathematically computable and verifiable.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n---\n\nThe solution requires the construction of several discrete operators (matrices) on a one-dimensional periodic domain with $N$ nodes $\\{x_i\\}_{i=0}^{N-1}$ and uniform spacing $h=1/N$. Due to the periodic nature and uniform spacing, all resulting matrices will be circulant. A circulant matrix is fully defined by its first row.\n\n**1. Discrete Gradient Operator ($G$)**\nThe discrete gradient operator $G$ is specified by the central difference formula $(G\\mathbf{p})_i = (\\mathbf{p}_{i+1} - \\mathbf{p}_{i-1})/(2h)$. The indices are periodic, meaning $\\mathbf{p}_{N} = \\mathbf{p}_0$ and $\\mathbf{p}_{-1} = \\mathbf{p}_{N-1}$. For row $i$, the matrix $G$ has a non-zero entry $1/(2h)$ in column $i+1$ (modulo $N$) and $-1/(2h)$ in column $i-1$ (modulo $N$). The first row of $G$, corresponding to $i=0$, will have entries for columns $j=1$ and $j=-1 \\equiv N-1$. Thus, the first row vector is $[0, 1/(2h), 0, \\dots, 0, -1/(2h)]$. This structure defines a skew-symmetric circulant matrix. As the divergence operator $D$ is to be constructed in the same manner, it will have the same form. In a weak formulation, $D$ is often $-G^\\top$, and since $G$ is skew-symmetric ($G^\\top = -G$), this implies $D=G$.\n\n**2. Consistent and Lumped Pressure Mass Matrices ($M_p$, $M_\\ell$)**\nThe consistent mass matrix $M_p$ has entries $M_{p,ij} = \\int_0^1 \\phi_i(x) \\phi_j(x) dx$, where $\\phi_i(x)$ are the standard piecewise-linear \"hat\" basis functions. For a uniform 1D mesh, the local element mass matrix over an element of length $h$ is $\\frac{h}{6} \\begin{pmatrix} 2 & 1 \\\\ 1 & 2 \\end{pmatrix}$. Assembling these contributions over the periodic mesh:\n- A diagonal entry $M_{p,ii}$ receives $\\frac{2h}{6}$ from the element on its right and $\\frac{2h}{6}$ from the element on its left, totaling $\\frac{4h}{6}$.\n- An off-diagonal entry $M_{p,i,i+1}$ receives $\\frac{h}{6}$ from the single element shared by nodes $i$ and $i+1$.\nThe first row of the symmetric circulant matrix $M_p$ is therefore $\\frac{h}{6}[4, 1, 0, \\dots, 0, 1]$.\nThe lumped mass matrix $M_\\ell$ is obtained by the row-sum technique: $M_{\\ell,ii} = \\sum_j M_{p,ij}$. For any row, the sum is $\\frac{h}{6}(1+4+1) = h$. Thus, $M_\\ell$ is a diagonal matrix with all diagonal entries equal to $h$, i.e., $M_\\ell = hI$.\n\n**3. Stiffness Matrix ($K$)**\nThe stiffness matrix $K$ has entries $K_{ij} = \\int_0^1 \\frac{d\\phi_i}{dx} \\frac{d\\phi_j}{dx} dx$. The local element stiffness matrix is $\\frac{1}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}$. Assembling over the periodic mesh:\n- A diagonal entry $K_{ii}$ receives $\\frac{1}{h}$ from the element on its right and $\\frac{1}{h}$ from the element on its left, totaling $\\frac{2}{h}$.\n- An off-diagonal entry $K_{i,i+1}$ receives $-\\frac{1}{h}$ from the shared element.\nThe first row of the symmetric circulant matrix $K$ is therefore $\\frac{1}{h}[2, -1, 0, \\dots, 0, -1]$.\n\n**4. Checkerboard Mode Decoupling**\nThe checkerboard mode is $\\mathbf{p}^{\\mathrm{cb}}_i = (-1)^i$. We test its effect when acted upon by $G$:\n$$(G\\mathbf{p}^{\\mathrm{cb}})_i = \\frac{1}{2h}(\\mathbf{p}^{\\mathrm{cb}}_{i+1} - \\mathbf{p}^{\\mathrm{cb}}_{i-1}) = \\frac{1}{2h}((-1)^{i+1} - (-1)^{i-1})$$\nSince $(-1)^{i+1} = -(-1)^i$ and $(-1)^{i-1} = -(-1)^i$, this becomes:\n$$(G\\mathbf{p}^{\\mathrm{cb}})_i = \\frac{1}{2h}(-(-1)^i - (-(-1)^i)) = 0$$\nThis holds for all $i$ provided the periodic indexing is consistent, which is true for any even $N$. Since all test cases have even $N$, $G\\mathbf{p}^{\\mathrm{cb}} = \\mathbf{0}$, meaning the mode is in the null space of $G$. Thus, $\\|G\\mathbf{p}^{\\mathrm{cb}}\\|_2 = 0$, and the mode is perfectly decoupled from the velocity equation.\n\n**5. Decay Rate Calculation**\nThe decay rate is $\\lambda(M) = \\eta \\frac{(\\mathbf{p}^{\\mathrm{cb}})^\\top K \\mathbf{p}^{\\mathrm{cb}}}{(\\mathbf{p}^{\\mathrm{cb}})^\\top M \\mathbf{p}^{\\mathrm{cb}}}$. We must evaluate the quadratic forms. It can be shown that for an even $N$, $\\mathbf{p}^{\\mathrm{cb}}$ is an eigenvector of all the constructed circulant matrices $K$ and $M_p$.\n- For the stiffness matrix $K$: $(K\\mathbf{p}^{\\mathrm{cb}})_i = \\frac{1}{h}(-p_{i-1} + 2p_i - p_{i+1}) = \\frac{1}{h}(-(-1)^{i-1} + 2(-1)^i - (-1)^{i+1}) = \\frac{1}{h}((-1)^i + 2(-1)^i + (-1)^i) = \\frac{4}{h}(-1)^i$. So $K\\mathbf{p}^{\\mathrm{cb}} = \\frac{4}{h}\\mathbf{p}^{\\mathrm{cb}}$. The quadratic form is $(\\mathbf{p}^{\\mathrm{cb}})^\\top K \\mathbf{p}^{\\mathrm{cb}} = \\frac{4}{h} \\|\\mathbf{p}^{\\mathrm{cb}}\\|_2^2 = \\frac{4}{h}N = 4N^2$.\n- For the consistent mass matrix $M_p$: $(M_p\\mathbf{p}^{\\mathrm{cb}})_i = \\frac{h}{6}(p_{i-1} + 4p_i + p_{i+1}) = \\frac{h}{6}((-1)^{i-1} + 4(-1)^i + (-1)^{i+1}) = \\frac{h}{6}(-(-1)^i + 4(-1)^i - (-1)^i) = \\frac{2h}{6}(-1)^i = \\frac{h}{3}(-1)^i$. So $M_p\\mathbf{p}^{\\mathrm{cb}} = \\frac{h}{3}\\mathbf{p}^{\\mathrm{cb}}$. The quadratic form is $(\\mathbf{p}^{\\mathrm{cb}})^\\top M_p \\mathbf{p}^{\\mathrm{cb}} = \\frac{h}{3} \\|\\mathbf{p}^{\\mathrm{cb}}\\|_2^2 = \\frac{h}{3}N = \\frac{1}{3}$.\n- For the lumped mass matrix $M_\\ell = hI$: The quadratic form is $(\\mathbf{p}^{\\mathrm{cb}})^\\top (hI) \\mathbf{p}^{\\mathrm{cb}} = h \\|\\mathbf{p}^{\\mathrm{cb}}\\|_2^2 = hN=1$.\n\nThe analytical decay rates are:\n$$ \\lambda(M_p) = \\eta \\frac{4N^2}{1/3} = 12 \\eta N^2 $$\n$$ \\lambda(M_\\ell) = \\eta \\frac{4N^2}{1} = 4 \\eta N^2 $$\nThe implementation will construct the matrices numerically and compute these quantities to verify the theory for the given test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef assemble_matrices(N):\n    \"\"\"\n    Assembles the discrete operators G, K, M_p, and M_l for a 1D periodic\n    domain with N nodes.\n    \"\"\"\n    if N % 2 != 0:\n        raise ValueError(\"N must be an even number for the checkerboard mode analysis.\")\n\n    h = 1.0 / N\n\n    # 1. Gradient operator G\n    # First row of circulant matrix for (p_{i+1} - p_{i-1})/(2h)\n    g_row = np.zeros(N)\n    if N > 2:\n        g_row[1] = 1.0 / (2.0 * h)\n        g_row[N - 1] = -1.0 / (2.0 * h)\n    # For N=2, (p_{i+1}-p_{i-1}) is (p_{i+1}-p_{i+1})=0, so G is the zero matrix.\n    G = linalg.circulant(g_row)\n\n    # 2. Stiffness matrix K\n    # First row of circulant matrix for (1/h) * (-p_{i-1} + 2*p_i - p_{i+1})\n    k_row = np.zeros(N)\n    k_row[0] = 2.0 / h\n    if N > 1:\n      # For N=2, i=0, j=1 and j=N-1=1 are the same neighbor\n      k_row[1] = -1.0 / h\n      if N > 2:\n        k_row[N - 1] = -1.0 / h\n      else: # N=2 needs the other contribution to k_row[1]\n        k_row[1] += -1.0 / h\n    K = linalg.circulant(k_row)\n\n    # 3. Consistent Mass matrix M_p\n    # First row of circulant matrix for (h/6) * (p_{i-1} + 4*p_i + p_{i+1})\n    mp_row = np.zeros(N)\n    mp_row[0] = 4.0 / 6.0\n    if N > 1:\n      # Similar to K, for N=2, neighbor i+1 and i-1 are the same node\n      mp_row[1] = 1.0 / 6.0\n      if N > 2:\n        mp_row[N-1] = 1.0 / 6.0\n      else: # N=2\n        mp_row[1] += 1.0/6.0\n        \n    M_p = h * linalg.circulant(mp_row)\n\n    # 4. Lumped Mass matrix M_l\n    # Row-sum lumping of M_p. For a uniform periodic grid, this is h*I.\n    M_l = np.diag(np.sum(M_p, axis=1))\n\n    return G, K, M_p, M_l\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and compute the required triplets.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (4, 1.0),   # Case 1: happy path\n        (8, 1.0),   # Case 2: refined grid\n        (2, 1.0),   # Case 3: boundary grid size\n        (8, 0.25),  # Case 4: weaker stabilization\n    ]\n\n    results = []\n    decoupling_threshold = 1e-12\n\n    for N, eta in test_cases:\n        # Assemble all required matrices for the given N\n        G, K, M_p, M_l = assemble_matrices(N)\n\n        # Define the checkerboard pressure mode\n        p_cb = np.array([(-1)**i for i in range(N)], dtype=float)\n\n        # Task 4: Check for checkerboard mode decoupling\n        Gp_cb = G @ p_cb\n        norm_Gp_cb = np.linalg.norm(Gp_cb)\n        is_decoupled = norm_Gp_cb < decoupling_threshold\n\n        # Task 5: Compute decay rates via Rayleigh quotient\n        # Numerator is common for both rates\n        p_cb_T_K_p_cb = p_cb.T @ K @ p_cb\n\n        # Denominator for consistent mass matrix\n        p_cb_T_Mp_p_cb = p_cb.T @ M_p @ p_cb\n        lambda_Mp = eta * p_cb_T_K_p_cb / p_cb_T_Mp_p_cb\n\n        # Denominator for lumped mass matrix\n        p_cb_T_Ml_p_cb = p_cb.T @ M_l @ p_cb\n        lambda_Ml = eta * p_cb_T_K_p_cb / p_cb_T_Ml_p_cb\n\n        # Store the results as a triplet\n        # Using np.bool_ to ensure the boolean serializes as 'True' or 'False'\n        # which Python's str() does by default for standard bools.\n        result_triplet = [is_decoupled, lambda_Mp, lambda_Ml]\n        results.append(result_triplet)\n\n    # Format the final output string as specified\n    formatted_results = [f\"[{res[0]},{res[1]},{res[2]}]\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n\nsolve()\n```", "id": "3456088"}]}