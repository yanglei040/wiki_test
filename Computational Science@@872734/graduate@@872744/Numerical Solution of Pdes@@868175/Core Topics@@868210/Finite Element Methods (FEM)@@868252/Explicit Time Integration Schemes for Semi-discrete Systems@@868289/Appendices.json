{"hands_on_practices": [{"introduction": "The Butcher tableau provides a compact and elegant way to define any Runge-Kutta method. This exercise guides you through the process of translating this abstract representation into the explicit, step-by-step computations of the classical fourth-order RK4 scheme. By then deriving the method's stability function, you will build a foundational understanding of how a scheme's structure dictates its stability for linear problems [@problem_id:3613986].", "problem": "In computational geophysics, explicit time integration schemes are used to advance semi-discrete systems arising from spatially discretized hyperbolic partial differential equations, such as the constant-coefficient acoustic wave equation. Consider the initial value problem for a system of ordinary differential equations obtained from such a semi-discretization,\n$$\n\\frac{\\mathrm{d}\\mathbf{u}}{\\mathrm{d}t} = \\mathbf{f}(t,\\mathbf{u}(t)), \\quad \\mathbf{u}(t_n) = \\mathbf{u}^n,\n$$\nand let $\\Delta t$ denote the time step. A general $s$-stage Runge–Kutta method is defined in terms of a vector $\\mathbf{c} \\in \\mathbb{R}^s$, a strictly lower-triangular matrix $A \\in \\mathbb{R}^{s \\times s}$ for explicit methods, and a weight vector $\\mathbf{b} \\in \\mathbb{R}^s$, which determine the internal stage evaluations and the one-step update.\n\nYou are given the Butcher tableau of the classic explicit $4$-stage fourth-order Runge–Kutta method:\n$$\n\\begin{array}{c|cccc}\n0 & 0 & 0 & 0 & 0 \\\\\n\\frac{1}{2} & \\frac{1}{2} & 0 & 0 & 0 \\\\\n\\frac{1}{2} & 0 & \\frac{1}{2} & 0 & 0 \\\\\n1 & 0 & 0 & 1 & 0 \\\\\n\\hline\n& \\frac{1}{6} & \\frac{1}{3} & \\frac{1}{3} & \\frac{1}{6}\n\\end{array}\n$$\n\nTasks:\n- Starting only from the core definition of an $s$-stage Runge–Kutta method, write out the explicit stage computations $k_i$ and the update $\\mathbf{u}^{n+1}$ that correspond to this tableau, and identify the vector $\\mathbf{c}$, matrix $A$, and vector $\\mathbf{b}$ encoded by the tableau.\n- Apply this one-step method to the linear test problem $y'(t) = \\lambda y(t)$ with step size $\\Delta t$, and set $z = \\lambda \\Delta t$. Show that the method induces a one-step mapping $y^{n+1} = R(z)\\,y^n$ and derive the polynomial $R(z)$ in closed form.\n\nProvide your final answer as the exact algebraic expression for $R(z)$ in terms of $z$. No rounding is required, and no units are involved. The final answer must be a single closed-form analytic expression.", "solution": "We begin from the core definition of an $s$-stage Runge–Kutta method. For a given step size $\\Delta t$ and state $\\mathbf{u}^n \\approx \\mathbf{u}(t_n)$, define the internal stages $k_i$ for $i \\in \\{1,\\dots,s\\}$ by\n$$\nk_i \\;=\\; \\mathbf{f}\\!\\left(t_n + c_i \\Delta t,\\, \\mathbf{u}^n + \\Delta t \\sum_{j=1}^{s} a_{ij}\\,k_j\\right),\n$$\nand the one-step update by\n$$\n\\mathbf{u}^{n+1} \\;=\\; \\mathbf{u}^n + \\Delta t \\sum_{i=1}^{s} b_i\\,k_i.\n$$\nFor an explicit method, the matrix $A$ is strictly lower-triangular, so that $a_{ij} = 0$ for all $j \\ge i$, and each $k_i$ depends only on $\\{k_1,\\dots,k_{i-1}\\}$.\n\nThe given Butcher tableau explicitly encodes the coefficients. Reading off the entries yields\n$$\n\\mathbf{c} \\;=\\; \\begin{pmatrix} 0 \\\\ \\tfrac{1}{2} \\\\ \\tfrac{1}{2} \\\\ 1 \\end{pmatrix}, \n\\quad\nA \\;=\\; \\begin{pmatrix}\n0 & 0 & 0 & 0 \\\\\n\\tfrac{1}{2} & 0 & 0 & 0 \\\\\n0 & \\tfrac{1}{2} & 0 & 0 \\\\\n0 & 0 & 1 & 0\n\\end{pmatrix},\n\\quad\n\\mathbf{b} \\;=\\; \\begin{pmatrix} \\tfrac{1}{6} \\\\ \\tfrac{1}{3} \\\\ \\tfrac{1}{3} \\\\ \\tfrac{1}{6} \\end{pmatrix}.\n$$\nUsing the defining formulas, the corresponding explicit stage computations are\n$$\nk_1 \\;=\\; \\mathbf{f}\\!\\left(t_n,\\, \\mathbf{u}^n\\right),\n$$\n$$\nk_2 \\;=\\; \\mathbf{f}\\!\\left(t_n + \\tfrac{1}{2}\\Delta t,\\, \\mathbf{u}^n + \\tfrac{1}{2}\\Delta t\\,k_1\\right),\n$$\n$$\nk_3 \\;=\\; \\mathbf{f}\\!\\left(t_n + \\tfrac{1}{2}\\Delta t,\\, \\mathbf{u}^n + \\tfrac{1}{2}\\Delta t\\,k_2\\right),\n$$\n$$\nk_4 \\;=\\; \\mathbf{f}\\!\\left(t_n + \\Delta t,\\, \\mathbf{u}^n + \\Delta t\\,k_3\\right),\n$$\nand the update is\n$$\n\\mathbf{u}^{n+1} \\;=\\; \\mathbf{u}^n + \\Delta t\\left(\\tfrac{1}{6}k_1 + \\tfrac{1}{3}k_2 + \\tfrac{1}{3}k_3 + \\tfrac{1}{6}k_4\\right).\n$$\n\nWe now apply the method to the linear test equation $y'(t) = \\lambda y(t)$, which in geophysical practice arises when the semi-discrete operator of a linear wave problem is diagonalized, yielding scalar modes of the form $\\lambda y$. Let $h = \\Delta t$ and define $z = \\lambda h$. The right-hand side is $f(t,y) = \\lambda y$. The stages become scalars:\n$$\nk_1 \\;=\\; \\lambda\\,y^n,\n$$\n$$\nk_2 \\;=\\; \\lambda\\!\\left(y^n + \\tfrac{1}{2}h\\,k_1\\right) \\;=\\; \\lambda\\,y^n\\left(1 + \\tfrac{z}{2}\\right),\n$$\n$$\nk_3 \\;=\\; \\lambda\\!\\left(y^n + \\tfrac{1}{2}h\\,k_2\\right) \\;=\\; \\lambda\\,y^n\\left(1 + \\tfrac{z}{2} + \\tfrac{z^2}{4}\\right),\n$$\n$$\nk_4 \\;=\\; \\lambda\\!\\left(y^n + h\\,k_3\\right) \\;=\\; \\lambda\\,y^n\\left(1 + z + \\tfrac{z^2}{2} + \\tfrac{z^3}{4}\\right).\n$$\nSubstituting into the update,\n$$\ny^{n+1} \\;=\\; y^n + h\\left(\\tfrac{1}{6}k_1 + \\tfrac{1}{3}k_2 + \\tfrac{1}{3}k_3 + \\tfrac{1}{6}k_4\\right),\n$$\nand dividing by $y^n$ yields the stability function $R(z)$ defined by $y^{n+1} = R(z)\\,y^n$:\n$$\nR(z) \\;=\\; 1 \\;+\\; \\tfrac{1}{6}z \\;+\\; \\tfrac{1}{3}z\\!\\left(1 + \\tfrac{z}{2}\\right) \\;+\\; \\tfrac{1}{3}z\\!\\left(1 + \\tfrac{z}{2} + \\tfrac{z^2}{4}\\right) \\;+\\; \\tfrac{1}{6}z\\!\\left(1 + z + \\tfrac{z^2}{2} + \\tfrac{z^3}{4}\\right).\n$$\nCollecting like powers of $z$,\n$$\nR(z) \\;=\\; 1 \\;+\\; z \\;+\\; \\tfrac{1}{2}z^2 \\;+\\; \\tfrac{1}{6}z^3 \\;+\\; \\tfrac{1}{24}z^4.\n$$\nThis polynomial is the fourth-order Taylor polynomial of $\\exp(z)$ and thus the stability function of the classic explicit $4$-stage fourth-order Runge–Kutta method.", "answer": "$$\\boxed{1 + z + \\tfrac{1}{2}z^{2} + \\tfrac{1}{6}z^{3} + \\tfrac{1}{24}z^{4}}$$", "id": "3613986"}, {"introduction": "In the method of lines, the choice of spatial discretization dictates the properties of the semi-discrete system that our time integrator must solve. This practice explores the crucial link between the spatial operator's eigenvalues and the stability of the time-stepping scheme. By analyzing the centered-difference discretization of the advection equation, you will discover from first principles why the simple Forward Euler method is fundamentally unsuited for this task, a classic and important lesson in numerical stability [@problem_id:3389318].", "problem": "Consider the one-dimensional linear advection partial differential equation (PDE) $u_{t} + a\\,u_{x} = 0$ with constant advection speed $a \\in \\mathbb{R}$ on a periodic domain of length $L > 0$. Let the domain be discretized by a uniform grid with $N \\in \\mathbb{N}$ points and spacing $\\Delta x = L/N$, and let $U(t) \\in \\mathbb{C}^{N}$ collect the nodal values at time $t$. The centered-difference approximation for the spatial derivative is defined by the circulant matrix $D_{0} \\in \\mathbb{R}^{N \\times N}$ corresponding to the stencil $\\left(-\\tfrac{1}{2\\Delta x},\\,0,\\,\\tfrac{1}{2\\Delta x}\\right)$ with periodic wrap-around. The semi-discrete method-of-lines system thus reads $U^{\\prime}(t) = -a\\,D_{0}\\,U(t)$.\n\nUsing only the fundamental facts that (i) circulant matrices are diagonalized by the discrete Fourier basis and (ii) the discrete Fourier mode with grid wavenumber $\\theta \\in \\{2\\pi k/N : k = 0,1,\\dots,N-1\\}$ is $\\varphi^{(\\theta)}_{j} = \\exp(i\\,j\\,\\theta)$ for $j \\in \\{0,1,\\dots,N-1\\}$, do the following:\n\n1. Derive from first principles the eigenvalues $\\lambda(\\theta)$ of the semi-discrete operator $-a\\,D_{0}$ as an explicit function of $a$, $\\Delta x$, and $\\theta$.\n\n2. Consider the Forward Euler (FE) time integrator applied to the semi-discrete system with time step $\\Delta t > 0$, so that $U^{n+1} = U^{n} + \\Delta t\\,(-a\\,D_{0}\\,U^{n})$. Using the eigenvalues you derived, provide a first-principles explanation of why FE is unconditionally unstable for this spatial discretization of advection on the periodic grid.\n\nProvide, as your final answer, the closed-form expression you found in item $1$ for $\\lambda(\\theta)$ in terms of $a$, $\\Delta x$, and $\\theta$. No numerical evaluation is required, and no rounding is needed.", "solution": "We begin with the semi-discrete method-of-lines system $U^{\\prime}(t) = -a\\,D_{0}\\,U(t)$, where $D_{0}$ is the circulant matrix implementing the centered difference approximation of the first derivative with periodic boundary conditions. The discrete Fourier modes form an eigenbasis for circulant matrices. Specifically, for each grid wavenumber $\\theta \\in \\{2\\pi k/N : k = 0,1,\\dots,N-1\\}$, the vector $\\varphi^{(\\theta)} \\in \\mathbb{C}^{N}$ with components $\\varphi^{(\\theta)}_{j} = \\exp(i\\,j\\,\\theta)$ is an eigenvector of any circulant matrix, and the associated eigenvalue is obtained by applying the stencil symbol to this mode.\n\nFor the centered-difference derivative operator $D_{0}$ with stencil $\\left(-\\tfrac{1}{2\\Delta x},\\,0,\\,\\tfrac{1}{2\\Delta x}\\right)$, we compute its action on a discrete Fourier mode. For a fixed $\\theta$, the $j$th component of $D_{0}\\,\\varphi^{(\\theta)}$ is\n\n$$\n\\left(D_{0}\\,\\varphi^{(\\theta)}\\right)_{j} \\;=\\; \\frac{1}{2\\Delta x}\\left(\\varphi^{(\\theta)}_{j+1} - \\varphi^{(\\theta)}_{j-1}\\right)\n\\;=\\; \\frac{1}{2\\Delta x}\\left(\\exp(i\\,(j+1)\\,\\theta) - \\exp(i\\,(j-1)\\,\\theta)\\right).\n$$\n\nFactor out $\\exp(i\\,j\\,\\theta)$ to obtain\n\n$$\n\\left(D_{0}\\,\\varphi^{(\\theta)}\\right)_{j}\n= \\exp(i\\,j\\,\\theta)\\,\\frac{1}{2\\Delta x}\\left(\\exp(i\\,\\theta) - \\exp(-i\\,\\theta)\\right)\n= \\exp(i\\,j\\,\\theta)\\,\\frac{i}{\\Delta x}\\,\\sin(\\theta).\n$$\n\nThus, $\\varphi^{(\\theta)}$ is an eigenvector of $D_{0}$ with eigenvalue\n\n$$\n\\mu(\\theta) \\;=\\; \\frac{i}{\\Delta x}\\,\\sin(\\theta).\n$$\n\nConsequently, the semi-discrete operator $-a\\,D_{0}$ has eigenvalues\n\n$$\n\\lambda(\\theta) \\;=\\; -a\\,\\mu(\\theta) \\;=\\; -\\,i\\,\\frac{a}{\\Delta x}\\,\\sin(\\theta),\n$$\n\nfor each $\\theta \\in \\{2\\pi k/N : k = 0,1,\\dots,N-1\\}$. These eigenvalues are purely imaginary, with $\\lambda(\\theta) \\in i\\,\\mathbb{R}$ for each $\\theta$.\n\nNext, consider the Forward Euler (FE) time integrator applied to $U^{\\prime}(t) = -a\\,D_{0}\\,U(t)$. For the linear test problem $y^{\\prime} = \\lambda\\,y$, the FE update is $y^{n+1} = (1 + \\Delta t\\,\\lambda)\\,y^{n}$, so the amplification factor is $R(z) = 1 + z$ with $z = \\Delta t\\,\\lambda$. Stability for a given mode requires $|1 + \\Delta t\\,\\lambda(\\theta)| \\leq 1$.\n\nSubstitute $\\lambda(\\theta) = -\\,i\\,\\dfrac{a}{\\Delta x}\\,\\sin(\\theta)$:\n\n$$\n1 + \\Delta t\\,\\lambda(\\theta) \\;=\\; 1 - i\\,\\frac{a\\,\\Delta t}{\\Delta x}\\,\\sin(\\theta).\n$$\n\nIts magnitude is\n\n$$\n\\left|1 + \\Delta t\\,\\lambda(\\theta)\\right|\n= \\sqrt{1 + \\left(\\frac{a\\,\\Delta t}{\\Delta x}\\right)^{2}\\,\\sin^{2}(\\theta)}.\n$$\n\nFor any $\\Delta t > 0$ and any wavenumber with $\\sin(\\theta) \\neq 0$, we have $\\left|1 + \\Delta t\\,\\lambda(\\theta)\\right| > 1$. The only modes with $\\left|1 + \\Delta t\\,\\lambda(\\theta)\\right| = 1$ are those with $\\sin(\\theta) = 0$, namely $\\theta \\in \\{0, \\pi\\}$ (modulo $2\\pi$), which correspond to the constant mode and the Nyquist mode. Therefore, there does not exist any $\\Delta t > 0$ that makes all modes non-amplifying, because for any such $\\Delta t$ there are modes with $\\sin(\\theta) \\neq 0$ whose amplification factor exceeds $1$ in magnitude.\n\nEquivalently, the FE absolute stability region $\\{z \\in \\mathbb{C} : |1 + z| \\leq 1\\}$ does not include any nonzero purely imaginary $z = i\\,y$ since $|1 + i\\,y| = \\sqrt{1 + y^{2}} > 1$ for all $y \\neq 0$. Because the semi-discrete spectrum of $-a\\,D_{0}$ is purely imaginary except possibly at the origin, Forward Euler is unconditionally unstable for this centered-difference spatial discretization of advection on the periodic grid.\n\nThe requested closed-form expression for the semi-discrete eigenvalues is thus $\\lambda(\\theta) = -\\,i\\,\\dfrac{a}{\\Delta x}\\,\\sin(\\theta)$.", "answer": "$$\\boxed{-\\,i\\,\\dfrac{a}{\\Delta x}\\,\\sin(\\theta)}$$", "id": "3389318"}, {"introduction": "For many physical systems, such as those modeling concentrations or densities, numerical solutions must remain non-negative to be meaningful. This exercise moves beyond linear stability to investigate the more subtle property of positivity-preservation for the classical RK4 method when applied to an advection problem. By combining analytical derivation with a hands-on coding task, you will see a concrete demonstration of how a high-order scheme can produce unphysical negative values if the time step exceeds a specific, method-dependent threshold [@problem_id:3389375].", "problem": "Consider the one-dimensional linear advection Partial Differential Equation (PDE) $u_t + a\\,u_x = 0$ on the periodic domain $x \\in [0,1]$ with constant advection speed $a > 0$. Discretize the spatial derivative with a first-order upwind conservative semi-discrete scheme on $N$ uniformly spaced cells with grid spacing $\\Delta x = 1/N$, cell averages $u_i(t)$, and periodic indexing. The semi-discrete system is\n$$\n\\frac{d}{dt} u_i(t) = -\\frac{a}{\\Delta x}\\left(u_i(t) - u_{i-1}(t)\\right),\n$$\nwhich can be written as a linear system $\\frac{d}{dt} \\mathbf{u}(t) = \\mathbf{L}\\,\\mathbf{u}(t)$ where $\\mathbf{L}$ is a Toeplitz matrix with entries $L_{ii} = -\\lambda$, $L_{i,i-1} = \\lambda$, and $L_{ij}=0$ otherwise, with $\\lambda = a/\\Delta x$, and periodic wrap-around for indices.\n\nDefinitions:\n- A semi-discrete operator $\\mathbf{L}$ is called monotone if, when combined with Forward Euler time stepping, the update $\\mathbf{u}^{n+1} = \\mathbf{u}^n + \\Delta t\\,\\mathbf{L}\\,\\mathbf{u}^n$ preserves nonnegativity for any nonnegative $\\mathbf{u}^n$, provided the time step $\\Delta t$ satisfies an operator-dependent bound.\n- A time integration scheme is called positivity-preserving on a given semi-discrete system if $\\mathbf{u}^n \\ge 0$ componentwise implies $\\mathbf{u}^{n+1} \\ge 0$ componentwise for the chosen $\\Delta t$.\n- Classical four-stage Runge-Kutta (RK) method (Runge-Kutta of order four, abbreviated as RK4) advances the solution of $\\mathbf{u}' = \\mathbf{L}\\,\\mathbf{u}$ from $\\mathbf{u}^n$ to $\\mathbf{u}^{n+1}$ using four stages and specific convex combinations of stage derivatives.\n\nTasks:\n1. Starting from the semi-discrete upwind scheme and its Forward Euler update, derive the time step bound that guarantees positivity for Forward Euler. Your derivation must begin from the explicit form of the Forward Euler update on each cell and show the resulting convex combination of neighboring cell values.\n2. Consider the classical four-stage Runge-Kutta (RK4) method applied to the same semi-discrete system. Let $\\mathbf{S}$ denote the backward shift operator acting on grid functions by $(\\mathbf{S}\\,\\mathbf{u})_i = u_{i-1}$, and observe that $\\mathbf{L} = \\lambda(\\mathbf{S} - \\mathbf{I})$, where $\\mathbf{I}$ is the identity. By expanding powers of $\\mathbf{L}$ in terms of $\\mathbf{S}$ and $\\mathbf{I}$, write the one-step RK4 update in the form\n$$\nu_i^{n+1} = \\sum_{m=0}^{4} w_m(r)\\,u_{i-m}^n,\n$$\nwhere $r = \\lambda\\,\\Delta t$ is the Courant number (dimensionless) and $w_m(r)$ are scalar weights dependent only on $r$. Derive explicit polynomial expressions for each $w_m(r)$.\n3. Using the derived weights, determine a threshold on $r$ such that all weights are nonnegative for $r$ below or equal to the threshold, and show that at least one weight becomes negative when $r$ exceeds it. Explain why this demonstrates that classical RK4 can violate positivity for a monotone semi-discrete operator when $\\Delta t$ exceeds a method-dependent threshold.\n4. Implement a program that:\n   - Constructs the semi-discrete operator $\\mathbf{L}$ as defined above with parameters $N = 128$ and $a = 1$.\n   - Initializes a nonnegative state $\\mathbf{u}^0$ with a single spike at index $i_0 = 10$: $u_{i_0}^0 = 1$ and $u_i^0 = 0$ for $i \\ne i_0$.\n   - Advances the solution by one RK4 time step for each test value of $r = \\lambda\\,\\Delta t$ in the test suite below, using the exact semi-discrete operator and the standard RK4 stage equations.\n   - Checks whether the resulting $\\mathbf{u}^{1}$ has any negative components (strictly less than $0$, with a numerical tolerance of $10^{-12}$ to ignore roundoff).\n   - Produces a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry is a boolean indicating whether positivity was violated (True if any component is negative, False otherwise).\n\nTest suite (values of the Courant number $r = \\lambda\\,\\Delta t$ to be used):\n- Case 1 (zero step): $r = 0.0$.\n- Case 2 (sub-threshold): $r = 0.5$.\n- Case 3 (boundary): $r = 1.0$.\n- Case 4 (just above threshold): $r = 1.05$.\n- Case 5 (well above threshold): $r = 1.60$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5]\"). No physical units are involved; all quantities are dimensionless. The final outputs for each test case must be booleans indicating whether positivity was violated after one RK4 step.", "solution": "The solution will proceed by addressing the four tasks in the order presented.\n\n### Task 1: Positivity Condition for the Forward Euler Scheme\n\nThe problem considers the one-dimensional linear advection equation $u_t + a\\,u_x = 0$ on a periodic domain, with $a > 0$. The spatial derivative is discretized using a first-order upwind scheme, resulting in the semi-discrete system for the cell averages $u_i(t)$:\n$$\n\\frac{d}{dt} u_i(t) = -\\frac{a}{\\Delta x}\\left(u_i(t) - u_{i-1}(t)\\right)\n$$\nwhere $\\Delta x$ is the uniform grid spacing.\n\nApplying the Forward Euler time integration method, the update from time step $n$ to $n+1$ is given by $\\mathbf{u}^{n+1} = \\mathbf{u}^n + \\Delta t \\, \\frac{d\\mathbf{u}}{dt}\\big|_{\\mathbf{u}=\\mathbf{u}^n}$. For a single cell $i$, this becomes:\n$$\nu_i^{n+1} = u_i^n + \\Delta t \\left( -\\frac{a}{\\Delta x}\\left(u_i^n - u_{i-1}^n\\right) \\right)\n$$\nWe introduce the dimensionless Courant number, defined as $r = \\frac{a\\,\\Delta t}{\\Delta x}$. Substituting this into the update equation gives:\n$$\nu_i^{n+1} = u_i^n - r \\left(u_i^n - u_{i-1}^n\\right)\n$$\nRearranging the terms to express $u_i^{n+1}$ as a linear combination of values at time $n$:\n$$\nu_i^{n+1} = (1 - r)u_i^n + r\\,u_{i-1}^n\n$$\nFor the scheme to be positivity-preserving, we require that if all components of $\\mathbf{u}^n$ are non-negative (i.e., $u_j^n \\ge 0$ for all $j$), then all components of $\\mathbf{u}^{n+1}$ must also be non-negative. From the equation for $u_i^{n+1}$, if $u_i^n \\ge 0$ and $u_{i-1}^n \\ge 0$, then $u_i^{n+1}$ is guaranteed to be non-negative if the coefficients of the linear combination are non-negative.\nThis gives two conditions:\n1. $r \\ge 0$: Since $a > 0$, $\\Delta t > 0$, and $\\Delta x > 0$, this condition is intrinsically satisfied.\n2. $1 - r \\ge 0 \\implies r \\le 1$.\n\nCombining these, the Forward Euler method is positivity-preserving for this semi-discrete system if and only if the Courant number $r$ satisfies $0 \\le r \\le 1$. This corresponds to the time step bound $\\Delta t \\le \\frac{\\Delta x}{a}$, which is the Courant-Friedrichs-Lewy (CFL) condition for this scheme. The provided operator $\\mathbf{L}$ is therefore monotone under this condition.\n\n### Task 2: Derivation of RK4 Stencil Weights\n\nThe classical four-stage Runge-Kutta (RK4) method for an autonomous system $\\mathbf{u}' = \\mathbf{L}\\mathbf{u}$ can be expressed as a polynomial in the operator $\\Delta t \\mathbf{L}$. The one-step update is given by:\n$$\n\\mathbf{u}^{n+1} = \\left( \\mathbf{I} + \\Delta t \\mathbf{L} + \\frac{(\\Delta t \\mathbf{L})^2}{2!} + \\frac{(\\Delta t \\mathbf{L})^3}{3!} + \\frac{(\\Delta t \\mathbf{L})^4}{4!} \\right) \\mathbf{u}^n\n$$\nThe problem specifies the semi-discrete operator as $\\mathbf{L} = \\lambda(\\mathbf{S} - \\mathbf{I})$, where $\\lambda = a/\\Delta x$ and $\\mathbf{S}$ is the backward shift operator, $(\\mathbf{S}\\mathbf{u})_i = u_{i-1}$. We define the Courant number as $r = \\lambda \\Delta t = a \\Delta t / \\Delta x$.\nThe operator term $\\Delta t \\mathbf{L}$ can be written as:\n$$\n\\Delta t \\mathbf{L} = \\Delta t \\lambda (\\mathbf{S} - \\mathbf{I}) = r(\\mathbf{S} - \\mathbf{I})\n$$\nSubstituting this into the RK4 update formula, the one-step update operator $\\mathbf{W}(r)$ is:\n$$\n\\mathbf{W}(r) = \\mathbf{I} + r(\\mathbf{S} - \\mathbf{I}) + \\frac{r^2}{2}(\\mathbf{S} - \\mathbf{I})^2 + \\frac{r^3}{6}(\\mathbf{S} - \\mathbf{I})^3 + \\frac{r^4}{24}(\\mathbf{S} - \\mathbf{I})^4\n$$\nWe need to find the coefficients $w_m(r)$ in the expression $\\mathbf{u}^{n+1} = \\left(\\sum_{m=0}^{4} w_m(r) \\mathbf{S}^m\\right) \\mathbf{u}^n$. This requires expanding the powers of $(\\mathbf{S} - \\mathbf{I})$ using the binomial theorem, $(\\mathbf{A}+\\mathbf{B})^k = \\sum_{j=0}^k \\binom{k}{j} \\mathbf{A}^{k-j}\\mathbf{B}^j$:\n- $(\\mathbf{S} - \\mathbf{I})^1 = \\mathbf{S} - \\mathbf{I}$\n- $(\\mathbf{S} - \\mathbf{I})^2 = \\mathbf{S}^2 - 2\\mathbf{S} + \\mathbf{I}$\n- $(\\mathbf{S} - \\mathbf{I})^3 = \\mathbf{S}^3 - 3\\mathbf{S}^2 + 3\\mathbf{S} - \\mathbf{I}$\n- $(\\mathbf{S} - \\mathbf{I})^4 = \\mathbf{S}^4 - 4\\mathbf{S}^3 + 6\\mathbf{S}^2 - 4\\mathbf{S} + \\mathbf{I}$\n\nWe collect the coefficients of each power of $\\mathbf{S}$ from $\\mathbf{S}^0$ to $\\mathbf{S}^4$.\n\n- Coefficient of $\\mathbf{S}^4$ ($w_4(r)$): The only contribution is from the $(\\mathbf{S} - \\mathbf{I})^4$ term.\n$$ w_4(r) = \\frac{r^4}{24} \\binom{4}{4} = \\frac{r^4}{24} $$\n\n- Coefficient of $\\mathbf{S}^3$ ($w_3(r)$): Contributions from $(\\mathbf{S} - \\mathbf{I})^3$ and $(\\mathbf{S} - \\mathbf{I})^4$.\n$$ w_3(r) = \\frac{r^3}{6} \\binom{3}{3} + \\frac{r^4}{24} \\binom{4}{3}(-1)^1 = \\frac{r^3}{6} - \\frac{4r^4}{24} = \\frac{r^3}{6} - \\frac{r^4}{6} $$\n\n- Coefficient of $\\mathbf{S}^2$ ($w_2(r)$): Contributions from $(\\mathbf{S} - \\mathbf{I})^2$, $(\\mathbf{S} - \\mathbf{I})^3$, and $(\\mathbf{S} - \\mathbf{I})^4$.\n$$ w_2(r) = \\frac{r^2}{2} \\binom{2}{2} + \\frac{r^3}{6} \\binom{3}{2}(-1)^1 + \\frac{r^4}{24} \\binom{4}{2}(-1)^2 = \\frac{r^2}{2} - \\frac{3r^3}{6} + \\frac{6r^4}{24} = \\frac{r^2}{2} - \\frac{r^3}{2} + \\frac{r^4}{4} $$\n\n- Coefficient of $\\mathbf{S}^1$ ($w_1(r)$): Contributions from all powers from $1$ to $4$.\n$$ w_1(r) = r \\binom{1}{1} + \\frac{r^2}{2} \\binom{2}{1}(-1)^1 + \\frac{r^3}{6} \\binom{3}{1}(-1)^2 + \\frac{r^4}{24} \\binom{4}{1}(-1)^3 = r - r^2 + \\frac{r^3}{2} - \\frac{r^4}{6} $$\n\n- Coefficient of $\\mathbf{S}^0 = \\mathbf{I}$ ($w_0(r)$): Contributions from all terms.\n$$ w_0(r) = 1 + r \\binom{1}{0}(-1)^1 + \\frac{r^2}{2} \\binom{2}{0}(-1)^2 + \\frac{r^3}{6} \\binom{3}{0}(-1)^3 + \\frac{r^4}{24} \\binom{4}{0}(-1)^4 = 1 - r + \\frac{r^2}{2} - \\frac{r^3}{6} + \\frac{r^4}{24} $$\n\n### Task 3: Positivity Threshold for RK4\n\nFor the RK4 scheme to be positivity-preserving, the update $u_i^{n+1} = \\sum_{m=0}^{4} w_m(r)\\,u_{i-m}^n$ must yield a non-negative result for any non-negative initial state $\\mathbf{u}^n$. This is guaranteed if all stencil weights $w_m(r)$ are non-negative (given that their sum is $1$, which makes the update a convex combination). Let's analyze the sign of each weight for $r \\ge 0$.\n\n1.  $w_4(r) = \\frac{r^4}{24}$: This is always non-negative for any real $r$.\n2.  $w_3(r) = \\frac{r^3}{6} - \\frac{r^4}{6} = \\frac{r^3}{6}(1-r)$: For $r \\ge 0$, this weight is non-negative if and only if $1-r \\ge 0$, which implies $r \\le 1$. For any $r>1$, $w_3(r)$ is strictly negative.\n3.  $w_2(r) = \\frac{r^2}{2} - \\frac{r^3}{2} + \\frac{r^4}{4} = \\frac{r^2}{4}(2 - 2r + r^2)$: The quadratic term $q(r) = r^2 - 2r + 2$ has a discriminant $\\Delta = (-2)^2 - 4(1)(2) = -4 < 0$. Since its leading coefficient is positive, $q(r)$ is positive for all real $r$. Thus, $w_2(r)$ is always non-negative for $r \\ge 0$.\n4.  $w_1(r) = r - r^2 + \\frac{r^3}{2} - \\frac{r^4}{6}$: For $r \\in [0, 1]$, this weight is non-negative. For instance, at $r=1$, $w_1(1) = 1 - 1 + 1/2 - 1/6 = 1/3 > 0$. The first root of $w_1(r)=0$ for $r>0$ is approximately $r \\approx 1.596$.\n5.  $w_0(r) = 1 - r + \\frac{r^2}{2} - \\frac{r^3}{6} + \\frac{r^4}{24}$: This is the $4^{th}$ order Taylor polynomial for $e^{-r}$. It is a decreasing function on $[0,1]$ and positive throughout this interval ($w_0(0)=1$, $w_0(1) = 9/24 > 0$). The first root of $w_0(r)=0$ for $r>0$ is approximately $r \\approx 2.785$.\n\nThe most restrictive condition for all weights to be non-negative comes from $w_3(r) \\ge 0$, which requires $r \\le 1$. When $r$ exceeds $1$, $w_3(r)$ becomes negative. This violates the condition for positivity. For a single-spike initial condition $u_{i-3}^n > 0$ and all other $u_j^n = 0$, the resulting value $u_i^{n+1} = w_3(r) u_{i-3}^n$ would be negative.\n\nTherefore, the threshold on the Courant number for classical RK4 to be positivity-preserving on this semi-discrete system is $r=1$. Exceeding this threshold, e.g., $r=1.05$, leads to a negative weight ($w_3(1.05) < 0$), demonstrating that the scheme can violate positivity even when applied to a monotone operator if the time step is too large. The method-dependent positivity limit for RK4 ($r \\le 1$) happens to coincide with the CFL limit for Forward Euler ($r \\le 1$) in this specific case.\n\n### Task 4: Numerical Verification\n\nThe provided Python code implements the numerical experiment as described. It sets up the domain with $N=128$ cells, advection speed $a=1$, and calculates $\\lambda = a/\\Delta x = 128$. It initializes a vector $\\mathbf{u}^0$ of size $128$ with a single non-zero entry $u_{10}^0 = 1$. For each Courant number $r$ in the test suite, it computes the corresponding time step $\\Delta t = r/\\lambda$ and advances the solution by one step using the classical RK4 method applied to the semi-discrete operator $\\mathbf{L}\\mathbf{u} = \\lambda(\\mathbf{S}\\mathbf{u} - \\mathbf{u})$. The `numpy.roll` function is used to efficiently implement the periodic shift operator $\\mathbf{S}$. Finally, it checks if any component of the resulting vector $\\mathbf{u}^1$ is negative (below a small tolerance of $-10^{-12}$) and reports a boolean for each case. The results will confirm the theoretical findings from Task 3.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of checking positivity violation for the RK4 scheme\n    applied to a first-order upwind semi-discretization of the linear\n    advection equation.\n    \"\"\"\n\n    # Define problem parameters\n    N = 128  # Number of cells\n    a = 1.0  # Advection speed\n    i_0 = 10 # Index of the initial spike\n\n    # Derived parameters\n    delta_x = 1.0 / N\n    lambda_val = a / delta_x\n\n    # Define the initial condition: a single spike at i_0\n    u0 = np.zeros(N)\n    u0[i_0] = 1.0\n\n    # Define the test cases for the Courant number r = lambda * delta_t\n    test_cases_r = [0.0, 0.5, 1.0, 1.05, 1.60]\n    \n    results = []\n    \n    # Numerical tolerance for checking negativity\n    tolerance = -1e-12\n\n    # Define the semi-discrete operator L such that du/dt = L(u)\n    # L(u)_i = -a/dx * (u_i - u_{i-1}) = -lambda * (u_i - u_{i-1})\n    # This is equivalent to lambda * (u_shifted - u)\n    def L_operator(u_vec):\n        \"\"\"\n        Applies the semi-discrete upwind operator L to a vector u.\n        Uses periodic boundary conditions via np.roll.\n        \"\"\"\n        # np.roll(u, 1) shifts elements to the right, so u_i -> u_{i-1}\n        u_shifted = np.roll(u_vec, 1)\n        return lambda_val * (u_shifted - u_vec)\n\n    for r in test_cases_r:\n        # Calculate the time step delta_t for the current test case\n        if lambda_val > 0:\n            delta_t = r / lambda_val\n        else: # Handle the case of zero advection speed\n            delta_t = 0.0\n\n        # Perform one step of the classical four-stage Runge-Kutta method\n        u_n = u0.copy()\n        \n        # k1 = L(u_n)\n        k1 = L_operator(u_n)\n        \n        # k2 = L(u_n + dt/2 * k1)\n        k2 = L_operator(u_n + (delta_t / 2.0) * k1)\n        \n        # k3 = L(u_n + dt/2 * k2)\n        k3 = L_operator(u_n + (delta_t / 2.0) * k2)\n        \n        # k4 = L(u_n + dt * k3)\n        k4 = L_operator(u_n + delta_t * k3)\n        \n        # u_{n+1} = u_n + dt/6 * (k1 + 2*k2 + 2*k3 + k4)\n        u_next = u_n + (delta_t / 6.0) * (k1 + 2.0 * k2 + 2.0 * k3 + k4)\n        \n        # Check for positivity violation\n        # np.any returns True if any element in the array satisfies the condition\n        violation = np.any(u_next < tolerance)\n        results.append(violation)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3389375"}]}