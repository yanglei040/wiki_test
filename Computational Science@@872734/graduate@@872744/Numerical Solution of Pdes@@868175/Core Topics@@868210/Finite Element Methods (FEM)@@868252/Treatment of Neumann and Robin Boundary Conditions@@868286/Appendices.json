{"hands_on_practices": [{"introduction": "Before attempting to find a numerical solution to a partial differential equation, we must first ask a more fundamental question: does a solution even exist? For the Poisson equation with pure Neumann boundary conditions, a solution only exists if the source term and the boundary flux are in balance. This exercise [@problem_id:3457511] guides you through deriving this critical solvability condition from the divergence theorem, providing a concrete link between the mathematical requirement and its physical interpretation as a conservation law.", "problem": "Consider the Partial Differential Equation (PDE) Neumann problem on the domain $\\Omega \\subset \\mathbb{R}^{2}$ given by the unit disk centered at the origin, defined by $\\Omega = \\{(x,y) \\in \\mathbb{R}^{2} : x^{2} + y^{2}  1\\}$ with boundary $\\partial \\Omega = \\{(x,y) \\in \\mathbb{R}^{2} : x^{2} + y^{2} = 1\\}$. Let $u : \\overline{\\Omega} \\to \\mathbb{R}$ satisfy the PDE\n$$\n-\\Delta u = f \\quad \\text{in } \\Omega, \\qquad \\frac{\\partial u}{\\partial n} = g \\quad \\text{on } \\partial \\Omega,\n$$\nwhere $\\Delta$ is the Laplacian and $\\frac{\\partial u}{\\partial n}$ denotes the outward normal derivative on $\\partial \\Omega$. Starting from the divergence theorem and the fundamental properties of the Laplacian and normal flux, derive the necessary integral compatibility condition for solvability of the Neumann problem.\n\nThen, for the choices $f(x,y) = x$ and boundary data $g(\\theta) = \\cos\\theta$ parameterized by the polar angle $\\theta \\in [0,2\\pi)$ on the unit circle, evaluate whether the derived compatibility condition is satisfied by computing the required integrals exactly. If the compatibility condition is not satisfied, define a minimally invasive adjustment to one datum by adding a constant $\\kappa$ to the Neumann boundary data, i.e., replacing $g$ by $g + \\kappa$, and determine the unique constant $\\kappa^{\\star}$ that enforces the compatibility condition. Provide the value of $\\kappa^{\\star}$.\n\nYour final answer must be a single real number with no units. If any approximation were needed, the instruction would specify significant figures; however, exact evaluation is requested here.", "solution": "The problem as stated is valid. It concerns a classical topic in the theory of partial differential equations, namely the solvability condition for the Poisson equation with Neumann boundary conditions. All provided data and definitions are standard and self-consistent. The query poses a multi-step task that is mathematically well-defined and leads to a unique solution.\n\nThe problem is to find a solution $u$ to the partial differential equation\n$$\n-\\Delta u = f \\quad \\text{in } \\Omega,\n$$\nsubject to the Neumann boundary condition\n$$\n\\frac{\\partial u}{\\partial n} = g \\quad \\text{on } \\partial \\Omega.\n$$\nHere, $\\Omega$ is the unit disk in $\\mathbb{R}^2$, $\\Delta = \\nabla \\cdot \\nabla$ is the Laplace operator, and $\\frac{\\partial u}{\\partial n} = \\nabla u \\cdot \\mathbf{n}$ is the outward normal derivative of $u$ on the boundary $\\partial \\Omega$.\n\nFirst, we derive the necessary compatibility condition for the existence of a solution $u$. We begin by integrating the PDE over the domain $\\Omega$:\n$$\n\\iint_{\\Omega} (-\\Delta u) \\, dA = \\iint_{\\Omega} f \\, dA.\n$$\nThe left-hand side can be transformed using the divergence theorem, which states that for a vector field $\\mathbf{F}$, $\\iint_{\\Omega} (\\nabla \\cdot \\mathbf{F}) \\, dA = \\oint_{\\partial\\Omega} \\mathbf{F} \\cdot \\mathbf{n} \\, ds$. Let us choose the vector field to be the gradient of $u$, i.e., $\\mathbf{F} = \\nabla u$. Then, $\\nabla \\cdot \\mathbf{F} = \\nabla \\cdot (\\nabla u) = \\Delta u$. Applying the divergence theorem, we get:\n$$\n\\iint_{\\Omega} \\Delta u \\, dA = \\oint_{\\partial\\Omega} (\\nabla u \\cdot \\mathbf{n}) \\, ds.\n$$\nFrom the definition of the normal derivative, $\\nabla u \\cdot \\mathbf{n} = \\frac{\\partial u}{\\partial n}$. The boundary condition states that $\\frac{\\partial u}{\\partial n} = g$. Substituting these into the equation gives:\n$$\n\\iint_{\\Omega} \\Delta u \\, dA = \\oint_{\\partial\\Omega} g \\, ds.\n$$\nNow, returning to our integrated PDE, we have:\n$$\n-\\left( \\oint_{\\partial\\Omega} g \\, ds \\right) = \\iint_{\\Omega} f \\, dA.\n$$\nRearranging the terms, we arrive at the solvability or compatibility condition:\n$$\n\\iint_{\\Omega} f \\, dA + \\oint_{\\partial\\Omega} g \\, ds = 0.\n$$\nThis condition represents a physical balance: the total source $f$ within the domain must be balanced by the total flux $g$ through the boundary.\n\nNext, we are asked to find a unique constant $\\kappa^{\\star}$ such that the problem with modified boundary data $g_{\\text{new}} = g + \\kappa^{\\star}$ is solvable. The compatibility condition for this new problem is:\n$$\n\\iint_{\\Omega} f \\, dA + \\oint_{\\partial\\Omega} (g + \\kappa^{\\star}) \\, ds = 0.\n$$\nWe can separate the boundary integral using the linearity of integration:\n$$\n\\iint_{\\Omega} f \\, dA + \\oint_{\\partial\\Omega} g \\, ds + \\oint_{\\partial\\Omega} \\kappa^{\\star} \\, ds = 0.\n$$\nSince $\\kappa^{\\star}$ is a constant, it can be factored out of the integral:\n$$\n\\iint_{\\Omega} f \\, dA + \\oint_{\\partial\\Omega} g \\, ds + \\kappa^{\\star} \\oint_{\\partial\\Omega} ds = 0.\n$$\nSolving for $\\kappa^{\\star}$, we obtain:\n$$\n\\kappa^{\\star} = - \\frac{\\iint_{\\Omega} f \\, dA + \\oint_{\\partial\\Omega} g \\, ds}{\\oint_{\\partial\\Omega} ds}.\n$$\nTo find the value of $\\kappa^{\\star}$, we must evaluate the three integrals for the given data: $f(x,y) = x$, $g(\\theta) = \\cos\\theta$, on the unit disk $\\Omega$.\n\nLet us evaluate the domain integral $\\iint_{\\Omega} f \\, dA$. It is convenient to use polar coordinates, where $x = r\\cos\\theta$, $y = r\\sin\\theta$, and the area element is $dA = r \\, dr \\, d\\theta$. The domain $\\Omega$ is described by $0 \\le r \\le 1$ and $0 \\le \\theta  2\\pi$.\n$$\n\\iint_{\\Omega} f \\, dA = \\iint_{\\Omega} x \\, dA = \\int_{0}^{2\\pi} \\int_{0}^{1} (r\\cos\\theta) \\, r \\, dr \\, d\\theta.\n$$\nWe can separate the integrals:\n$$\n\\iint_{\\Omega} x \\, dA = \\left( \\int_{0}^{1} r^2 \\, dr \\right) \\left( \\int_{0}^{2\\pi} \\cos\\theta \\, d\\theta \\right).\n$$\nThe integral with respect to $r$ is $\\int_{0}^{1} r^2 \\, dr = \\left[ \\frac{r^3}{3} \\right]_{0}^{1} = \\frac{1}{3}$.\nThe integral with respect to $\\theta$ is $\\int_{0}^{2\\pi} \\cos\\theta \\, d\\theta = [\\sin\\theta]_{0}^{2\\pi} = \\sin(2\\pi) - \\sin(0) = 0 - 0 = 0$.\nTherefore, the domain integral is $\\iint_{\\Omega} f \\, dA = \\frac{1}{3} \\times 0 = 0$. This result could also be deduced from the symmetry of the domain $\\Omega$ with respect to the $y$-axis and the integrand $f(x,y)=x$ being an odd function of $x$.\n\nNext, we evaluate the boundary integral $\\oint_{\\partial\\Omega} g \\, ds$. The boundary $\\partial\\Omega$ is the unit circle, $r=1$. The arc length element is $ds = r \\, d\\theta = 1 \\cdot d\\theta = d\\theta$. The function $g$ is given as $g(\\theta) = \\cos\\theta$.\n$$\n\\oint_{\\partial\\Omega} g \\, ds = \\int_{0}^{2\\pi} \\cos\\theta \\, d\\theta.\n$$\nAs calculated before, this integral is $0$.\n\nFinally, we evaluate the integral $\\oint_{\\partial\\Omega} ds$. This integral simply represents the total arc length of the boundary, which is the circumference of the unit circle.\n$$\n\\oint_{\\partial\\Omega} ds = 2\\pi r \\bigg|_{r=1} = 2\\pi.\n$$\n\nWe now substitute these values into our expression for $\\kappa^{\\star}$:\n$$\n\\kappa^{\\star} = - \\frac{0 + 0}{2\\pi} = - \\frac{0}{2\\pi} = 0.\n$$\nThe result $\\kappa^{\\star}=0$ indicates that the original problem with $g(\\theta)=\\cos\\theta$ already satisfies the compatibility condition, and thus no adjustment to the boundary data is necessary for a solution to exist. The \"minimally invasive adjustment\" is to add zero.", "answer": "$$\\boxed{0}$$", "id": "3457511"}, {"introduction": "Translating a continuous PDE into a discrete linear system requires careful attention to ensure the numerical solution retains key physical properties of the original problem, such as positivity. This practice [@problem_id:3457513] delves into the conditions under which a finite difference discretization yields an M-matrix, which guarantees a discrete maximum principle and thus a physically meaningful, non-oscillatory solution. By analyzing a diffusion-convection-reaction equation with both Neumann and Robin boundaries, you will discover the limitations of standard schemes and explore practical remedies like limiters.", "problem": "Consider the steady one-dimensional diffusion–convection–reaction boundary value problem on the interval $\\left[0,L\\right]$,\n$$-\\,\\left(k\\,u_{x}\\right)_{x} \\;+\\; a\\,u_{x} \\;+\\; \\sigma\\,u \\;=\\; f(x), \\qquad x\\in(0,L),$$\nwith the left Neumann boundary condition and right Robin boundary condition\n$$k\\,u_{x}(0)\\;=\\;g_{0}, \\qquad k\\,u_{x}(L)\\;+\\;\\beta\\,u(L)\\;=\\;g_{L}.$$\nAssume that $k0$, $a\\ge 0$, $\\sigma\\ge 0$, $\\beta0$, and that $k$, $a$, $\\sigma$, $\\beta$ are constants. Discretize the problem on a uniform grid $x_{i}=i\\,h$ for $i\\in\\{0,1,\\dots,N\\}$ with $h=L/N$, using second-order centered finite differences for the interior approximations of $u_{xx}$ and $u_{x}$, and second-order ghost-point eliminations for the Neumann/Robin boundary conditions. In particular, use the centered three-point stencil for $u_{xx}$ at all nodes and the centered two-point stencil for $u_{x}$ at all nodes, eliminating boundary ghost values via the given boundary conditions.\n\n1. Assemble the resulting tridiagonal linear system $\\mathbf{A}\\,\\mathbf{u}=\\mathbf{b}$ explicitly, identifying the coefficients in the left boundary row ($i=0$), interior rows ($i=1,\\dots,N-1$), and right boundary row ($i=N$) in terms of $k$, $a$, $\\sigma$, $\\beta$, and $h$. Treat $f$, $g_{0}$, and $g_{L}$ as known data absorbed into $\\mathbf{b}$.\n\n2. Starting from the definition that a Z-matrix is a real matrix with nonpositive off-diagonal entries, and that a sufficient condition for a Z-matrix to be an M-matrix (hence to satisfy a discrete maximum principle) is strict diagonal dominance by rows, derive the conditions on $a$, $k$, $\\sigma$, $\\beta$, and $h$ under which $\\mathbf{A}$ is an M-matrix. Your derivation must explicitly include how the Neumann and Robin boundary contributions affect these conditions.\n\n3. Under the stated assumptions ($a\\ge 0$, $\\sigma\\ge 0$, $\\beta0$), determine the largest admissible convection magnitude $a_{\\max}$ as a function of $k$ and $h$ (and, if relevant, of $\\beta$ and $\\sigma$) such that the assembled matrix is a Z-matrix that is strictly diagonally dominant by rows. Provide your final answer as a closed-form analytic expression for $a_{\\max}$ in terms of $k$, $h$, $\\beta$, and $\\sigma$.\n\n4. When the derived M-matrix conditions are violated, propose two concrete limiter strategies that can be applied at the discrete level to recover the discrete maximum principle. Each strategy must include a formula for the minimal parameter choice that restores the M-matrix property, written in terms of $a$, $k$, $h$, $\\beta$, and $\\sigma$.\n\nExpress the final $a_{\\max}$ in the same units as $a$; do not include units in your final boxed answer. No numerical rounding is required; present an exact analytic expression.", "solution": "The problem asks for the analysis of a finite difference discretization for a one-dimensional steady diffusion-convection-reaction boundary value problem. The analysis involves assembling the discrete linear system, determining the conditions for it to be an M-matrix, finding the maximum convection coefficient for this property to hold, and proposing corrective strategies.\n\nThe governing equation is $-\\left(k u_{x}\\right)_{x} + a u_{x} + \\sigma u = f(x)$ on $x \\in (0, L)$. Since $k$ is a constant, this simplifies to $-k u_{xx} + a u_{x} + \\sigma u = f(x)$. The boundary conditions are $k u_{x}(0) = g_{0}$ (Neumann) and $k u_{x}(L) + \\beta u(L) = g_{L}$ (Robin). The grid is uniform with spacing $h = L/N$, and nodes are $x_i = ih$ for $i \\in \\{0, 1, \\dots, N\\}$. The solution vector is $\\mathbf{u} = [u_0, u_1, \\dots, u_N]^T$.\n\nThe discretization uses second-order centered stencils for all derivatives at all nodes, including boundaries, with ghost points eliminated via the boundary conditions.\n - Second-order centered approximation for $u_{xx}$ at $x_i$: $u_{xx}(x_i) \\approx \\frac{u_{i-1} - 2u_i + u_{i+1}}{h^2}$.\n - Second-order centered approximation for $u_{x}$ at $x_i$: $u_{x}(x_i) \\approx \\frac{u_{i+1} - u_{i-1}}{2h}$.\n\n### 1. Assembly of the Linear System $\\mathbf{A}\\,\\mathbf{u}=\\mathbf{b}$\n\nWe derive the rows of the matrix $\\mathbf{A}$ for the three different cases: the left boundary ($i=0$), interior nodes ($i=1, \\dots, N-1$), and the right boundary ($i=N$).\n\n**Interior Rows ($i=1, \\dots, N-1$):**\nSubstituting the centered difference formulas into the PDE at node $x_i$:\n$$ -k \\left(\\frac{u_{i-1} - 2u_i + u_{i+1}}{h^2}\\right) + a \\left(\\frac{u_{i+1} - u_{i-1}}{2h}\\right) + \\sigma u_i = f_i $$\nGrouping terms by unknown $u_j$:\n$$ \\left(-\\frac{k}{h^2} - \\frac{a}{2h}\\right)u_{i-1} + \\left(\\frac{2k}{h^2} + \\sigma\\right)u_i + \\left(-\\frac{k}{h^2} + \\frac{a}{2h}\\right)u_{i+1} = f_i $$\nThe coefficients of the matrix $\\mathbf{A}$ for the interior rows are:\n$A_{i,i-1} = -\\frac{k}{h^2} - \\frac{a}{2h}$\n$A_{i,i} = \\frac{2k}{h^2} + \\sigma$\n$A_{i,i+1} = -\\frac{k}{h^2} + \\frac{a}{2h}$\n\n**Left Boundary Row ($i=0$):**\nWe apply the PDE at $x_0$, which requires a ghost point $u_{-1}$.\n$$ -k \\left(\\frac{u_{-1} - 2u_0 + u_1}{h^2}\\right) + a \\left(\\frac{u_1 - u_{-1}}{2h}\\right) + \\sigma u_0 = f_0 $$\nThe ghost point $u_{-1}$ is eliminated using the Neumann boundary condition $k u_x(0) = g_0$. A second-order centered approximation for $u_x(0)$ is $u_x(0) \\approx \\frac{u_1 - u_{-1}}{2h}$.\n$$ k \\left(\\frac{u_1 - u_{-1}}{2h}\\right) = g_0 \\implies u_{-1} = u_1 - \\frac{2h g_0}{k} $$\nSubstituting this into the discretized PDE:\n$$ -k \\left(\\frac{(u_1 - \\frac{2h g_0}{k}) - 2u_0 + u_1}{h^2}\\right) + a \\left(\\frac{u_1 - (u_1 - \\frac{2h g_0}{k})}{2h}\\right) + \\sigma u_0 = f_0 $$\n$$ -k \\left(\\frac{2u_1 - 2u_0}{h^2} - \\frac{2g_0}{kh}\\right) + a \\left(\\frac{g_0}{k}\\right) + \\sigma u_0 = f_0 $$\n$$ \\left(\\frac{2k}{h^2} + \\sigma\\right)u_0 - \\frac{2k}{h^2}u_1 + \\frac{2g_0}{h} + \\frac{ag_0}{k} = f_0 $$\nRearranging to the form $\\mathbf{A}\\,\\mathbf{u}=\\mathbf{b}$:\n$$ \\left(\\frac{2k}{h^2} + \\sigma\\right)u_0 - \\frac{2k}{h^2}u_1 = f_0 - \\frac{2g_0}{h} - \\frac{ag_0}{k} $$\nThe coefficients for the first row ($i=0$) are:\n$A_{0,0} = \\frac{2k}{h^2} + \\sigma$\n$A_{0,1} = -\\frac{2k}{h^2}$\n\n**Right Boundary Row ($i=N$):**\nWe apply the PDE at $x_N$, requiring a ghost point $u_{N+1}$.\n$$ -k \\left(\\frac{u_{N-1} - 2u_N + u_{N+1}}{h^2}\\right) + a \\left(\\frac{u_{N+1} - u_{N-1}}{2h}\\right) + \\sigma u_N = f_N $$\nThe Robin condition is $k u_x(L) + \\beta u(L) = g_L$. With $u(L)=u_N$ and $u_x(L) \\approx \\frac{u_{N+1} - u_{N-1}}{2h}$:\n$$ k \\left(\\frac{u_{N+1} - u_{N-1}}{2h}\\right) + \\beta u_N = g_L \\implies u_{N+1} = u_{N-1} + \\frac{2h}{k}(g_L - \\beta u_N) $$\nSubstituting this into the discretized PDE at $x_N$:\n$$ -k \\left(\\frac{u_{N-1} - 2u_N + (u_{N-1} + \\frac{2h}{k}(g_L - \\beta u_N))}{h^2}\\right) + a \\left(\\frac{(u_{N-1} + \\frac{2h}{k}(g_L - \\beta u_N)) - u_{N-1}}{2h}\\right) + \\sigma u_N = f_N $$\nSimplifying term by term:\nDiffusion: $-k(\\frac{2u_{N-1} - 2u_N - \\frac{2h\\beta}{k}u_N}{h^2}) - k(\\frac{2hg_L/k}{h^2}) = -\\frac{2k}{h^2}u_{N-1} + (\\frac{2k}{h^2}+\\frac{2\\beta}{h})u_N - \\frac{2g_L}{h}$.\nConvection: $a(\\frac{g_L}{k} - \\frac{\\beta u_N}{k}) = \\frac{ag_L}{k} - \\frac{a\\beta}{k}u_N$.\nCombining and rearranging:\n$$ -\\frac{2k}{h^2}u_{N-1} + \\left(\\frac{2k}{h^2} + \\frac{2\\beta}{h} - \\frac{a\\beta}{k} + \\sigma\\right)u_N = f_N + \\frac{2g_L}{h} - \\frac{ag_L}{k} $$\nThe coefficients for the last row ($i=N$) are:\n$A_{N,N-1} = -\\frac{2k}{h^2}$\n$A_{N,N} = \\frac{2k}{h^2} + \\frac{2\\beta}{h} - \\frac{a\\beta}{k} + \\sigma$\n\n### 2. M-matrix Conditions\n\nA sufficient condition for a Z-matrix (a real matrix with nonpositive off-diagonal entries) to be an M-matrix is that it is strictly diagonally dominant by rows. We derive the conditions on the parameters for $\\mathbf{A}$ to be a strictly diagonally dominant Z-matrix. We assume parameters $k0$, $a\\ge0$, $\\sigma\\ge0$, $\\beta0$, and $h0$.\n\n**Z-matrix Condition (nonpositive off-diagonals):**\n- $A_{0,1} = -\\frac{2k}{h^2} \\le 0$. This is always true.\n- $A_{i,i-1} = -(\\frac{k}{h^2} + \\frac{a}{2h}) \\le 0$. True for $a \\ge 0$.\n- $A_{i,i+1} = -(\\frac{k}{h^2} - \\frac{a}{2h}) \\le 0$. This requires $\\frac{k}{h^2} \\ge \\frac{a}{2h}$, which simplifies to $a \\le \\frac{2k}{h}$. This is the cell Péclet number condition.\n- $A_{N,N-1} = -\\frac{2k}{h^2} \\le 0$. This is always true.\nThe combined condition for $\\mathbf{A}$ to be a Z-matrix is $a \\le \\frac{2k}{h}$.\n\n**Strict Diagonal Dominance Condition ($|A_{ii}|  \\sum_{j\\neq i} |A_{ij}|$):**\n- **Row 0:** $|A_{0,0}|  |A_{0,1}| \\implies |\\frac{2k}{h^2} + \\sigma|  |-\\frac{2k}{h^2}|$. Since all parameters are non-negative, this is $\\frac{2k}{h^2} + \\sigma  \\frac{2k}{h^2}$, which requires $\\sigma  0$.\n- **Rows $1, \\dots, N-1$:** $|A_{i,i}|  |A_{i,i-1}| + |A_{i,i+1}|$. Assuming the Z-matrix condition ($a \\le 2k/h$) holds, the terms inside the absolute values for off-diagonals are already non-positive, so $|X|=-X$.\n$$ \\frac{2k}{h^2} + \\sigma  \\left(\\frac{k}{h^2} + \\frac{a}{2h}\\right) + \\left(\\frac{k}{h^2} - \\frac{a}{2h}\\right) $$\n$$ \\frac{2k}{h^2} + \\sigma  \\frac{2k}{h^2} $$\nThis again requires $\\sigma  0$.\n- **Row N:** $|A_{N,N}|  |A_{N,N-1}|$. We must have $A_{N,N}  0$.\n$$ \\left|\\frac{2k}{h^2} + \\frac{2\\beta}{h} - \\frac{a\\beta}{k} + \\sigma\\right|  \\left|-\\frac{2k}{h^2}\\right| $$\n$$ \\frac{2k}{h^2} + \\frac{2\\beta}{h} - \\frac{a\\beta}{k} + \\sigma  \\frac{2k}{h^2} $$\nThis simplifies to $\\frac{2\\beta}{h} - \\frac{a\\beta}{k} + \\sigma  0$.\n\nIn summary, for $\\mathbf{A}$ to be a strictly diagonally dominant Z-matrix, we need:\n1. $a \\le \\frac{2k}{h}$  (for Z-matrix property)\n2. $\\sigma  0$  (for strict diagonal dominance in rows $0, \\dots, N-1$)\n3. $\\frac{2\\beta}{h} - \\frac{a\\beta}{k} + \\sigma  0$ (for strict diagonal dominance in row $N$)\n\nIf $a \\le \\frac{2k}{h}$, then $\\frac{a\\beta}{k} \\le \\frac{2\\beta}{h}$. Thus $\\frac{2\\beta}{h} - \\frac{a\\beta}{k} \\ge 0$. Since we also require $\\sigma  0$, the third condition $\\frac{2\\beta}{h} - \\frac{a\\beta}{k} + \\sigma  0$ is automatically satisfied.\nTherefore, the complete set of conditions for $\\mathbf{A}$ to be a strictly diagonally dominant Z-matrix is $a \\le \\frac{2k}{h}$ and $\\sigma  0$.\n\n### 3. Largest Admissible Convection Magnitude $a_{\\max}$\n\nWe are asked for the largest $a_{\\max}$ such that $\\mathbf{A}$ is a strictly diagonally dominant Z-matrix, under the assumptions $a\\ge 0, \\sigma\\ge 0, \\beta0$.\nAs derived in Part 2, the condition for strict diagonal dominance requires $\\sigma  0$. If $\\sigma = 0$, the matrix is at best weakly diagonally dominant in rows $0, \\dots, N-1$ and cannot be strictly diagonally dominant. Therefore, we must assume $\\sigma0$ to satisfy the problem's criterion.\nWith $\\sigma0$, the conditions on $a$ are:\n1. $a \\ge 0$ (given).\n2. $a \\le \\frac{2k}{h}$ (from Z-matrix property).\nThe set of admissible values for $a$ is the interval $[0, \\frac{2k}{h}]$. The largest value in this set is $\\frac{2k}{h}$.\nThus, the largest admissible convection magnitude is $a_{\\max} = \\frac{2k}{h}$. This result is independent of $\\beta$ and $\\sigma$, provided they are positive.\n\n### 4. Limiter Strategies\n\nIf $a  a_{\\max} = 2k/h$, the matrix is not a Z-matrix, and the central difference scheme can produce unphysical oscillations. We can apply limiter strategies at the discrete level to recover the M-matrix property.\n\n**Strategy 1: Artificial Diffusion**\nThe issue arises because the coefficient $A_{i,i+1} = -\\frac{k}{h^2} + \\frac{a}{2h}$ becomes positive. We can restore the Z-matrix property by adding a numerical diffusion term, $D_{num}$, to the physical diffusion $k$. The modified discrete equation for interior nodes becomes:\n$$ - (k+D_{num}) \\left(\\frac{u_{i-1} - 2u_i + u_{i+1}}{h^2}\\right) + a \\left(\\frac{u_{i+1} - u_{i-1}}{2h}\\right) + \\sigma u_i = f_i $$\nThe new coefficient for $u_{i+1}$ is $A'_{i,i+1} = -\\frac{k+D_{num}}{h^2} + \\frac{a}{2h}$. To ensure this is non-positive, we require:\n$$ \\frac{k+D_{num}}{h^2} \\ge \\frac{a}{2h} \\implies k+D_{num} \\ge \\frac{ah}{2} $$\nThe minimal amount of artificial diffusion required is $D_{num} = \\frac{ah}{2} - k$. Since we only add diffusion when needed, the formula for the parameter is:\n$$ D_{num} = \\max\\left(0, \\frac{ah}{2} - k\\right) $$\nThis modification must be applied consistently, including in the boundary condition eliminations which depend on $k$.\n\n**Strategy 2: Hybrid Scheme (Flux Blending)**\nInstead of modifying the physics (i.e., $k$), we can modify the numerical scheme for the convection term. We create a hybrid scheme that blends the second-order central difference (CD) scheme with the first-order upwind (UW) scheme. For $a0$, the upwind direction is from $i-1$ to $i$.\nThe convective term $a u_x$ is approximated by a weighted average controlled by a parameter $\\lambda \\in [0, 1]$:\n$$ a u_x \\approx (1-\\lambda) \\left[a \\frac{u_{i+1}-u_{i-1}}{2h}\\right]_{CD} + \\lambda \\left[a \\frac{u_i-u_{i-1}}{h}\\right]_{UW} $$\nThe resulting coefficient of $u_{i+1}$ in the discrete equation is:\n$$ A_{i,i+1} = -\\frac{k}{h^2} + \\frac{a(1-\\lambda)}{2h} $$\nTo ensure this is non-positive (Z-matrix property), we must have:\n$$ \\frac{k}{h^2} \\ge \\frac{a(1-\\lambda)}{2h} \\implies 1-\\lambda \\le \\frac{2k}{ah} \\implies \\lambda \\ge 1 - \\frac{2k}{ah} $$\nThe minimal choice for $\\lambda$ that restores the M-matrix property for any $a0$ is:\n$$ \\lambda_{min} = \\max\\left(0, 1 - \\frac{2k}{ah}\\right) $$\nAt low convection ($ah \\le 2k$), $\\lambda=0$ and the scheme is purely central difference. As convection increases, $\\lambda$ increases, blending in more of the robust upwind scheme, transitioning fully to upwind as $a \\to \\infty$.", "answer": "$$\\boxed{\\frac{2k}{h}}$$", "id": "3457513"}, {"introduction": "The final and most crucial step in developing a numerical solver is verification: confirming that your code is free of bugs and that it achieves its theoretical order of accuracy. The Method of Manufactured Solutions (MMS) is the gold standard for this process. This hands-on coding exercise [@problem_id:3457485] provides a complete workflow for using MMS to verify a second-order finite difference scheme that incorporates a Robin boundary condition, bridging the gap between theoretical analysis and practical, trustworthy implementation.", "problem": "Consider the one-dimensional steady Poisson boundary value problem posed on the interval $[0,1]$ with a manufactured smooth exact solution. The governing equation is the second-order ordinary differential equation interpreted as a partial differential equation in one dimension,\n$$-u''(x) = f(x), \\quad x \\in [0,1],$$\ntogether with a Robin boundary condition at the left endpoint and a Dirichlet boundary condition at the right endpoint,\n$$a\\,u(0) + b\\,u'(0) = c, \\qquad u(1) = u_{\\mathrm{R}},$$\nwhere $a$ and $b$ are given nonnegative constants with $b0$, the constant $c$ is chosen to match the manufactured exact solution at $x=0$, and $u_{\\mathrm{R}}$ is chosen to match the manufactured exact solution at $x=1$. The method to be implemented is a second-order accurate finite difference scheme on a uniform grid with spacing $h$, using a ghost point to impose the Robin boundary condition so that the central difference approximation for $u'(0)$ maintains second-order accuracy. The goal is to use the Method of Manufactured Solutions (MMS) to verify the observed order of accuracy.\n\nStart from the following context-appropriate fundamental base:\n- The definition of the second derivative and its finite difference approximation on a uniform grid: for interior grid points $x_i = i h$ with $h = 1/N$ and $i$ an integer, the central finite difference approximation of $-u''(x_i)$ is\n$$\\frac{2\\,u_i - u_{i-1} - u_{i+1}}{h^2},$$\nwhere $u_i \\approx u(x_i)$ denotes the numerical approximation to the exact solution $u(x)$ at grid point $x_i$.\n- The Method of Manufactured Solutions (MMS): choose a smooth exact solution $u(x)$, compute $f(x)$ and boundary data so that the exact solution satisfies the boundary value problem, then discretize and compare the numerical solution with the exact solution to measure the error and infer the observed order of accuracy.\n\nYou must implement the following steps without shortcut formulas and without providing intermediate target expressions:\n1. Choose the manufactured exact solution\n$$u(x) = e^{x} + \\sin(2\\pi x),$$\ncompute the derivative $u'(x)$ and second derivative $u''(x)$ analytically, and define the source term by\n$$f(x) = -u''(x).$$\n2. Set the boundary data from the exact solution:\n$$c = a\\,u(0) + b\\,u'(0), \\qquad u_{\\mathrm{R}} = u(1).$$\n3. Discretize the domain with a uniform grid $x_i = i h$ for $i = 0,1,\\dots,N$ where $h = 1/N$. Assemble a second-order accurate finite difference system for the unknowns $\\{u_i\\}_{i=0}^{N-1}$, imposing the Dirichlet boundary at $x=1$ by incorporating $u_N = u_{\\mathrm{R}}$ into the right-hand side of the last equation and imposing the Robin boundary at $x=0$ using a ghost point $u_{-1}$ together with the second-order central difference approximation for $u'(0)$,\n$$u'(0) \\approx \\frac{u_1 - u_{-1}}{2h},$$\nand eliminating the ghost value $u_{-1}$ through the Robin boundary condition to produce a linear equation involving only the unknowns $u_0$ and $u_1$.\n4. Solve the resulting tridiagonal linear system by a direct tridiagonal solver to obtain the numerical solution at the grid points $\\{x_i\\}_{i=0}^{N-1}$.\n5. Compute the error between the numerical solution and the exact solution at the grid points $\\{x_i\\}_{i=0}^{N-1}$ and measure two norms:\n   - The discrete $L^2$ norm\n   $$\\|e\\|_{L^2,h} = \\left( h \\sum_{i=0}^{N-1} \\left|u_i - u(x_i)\\right|^2 \\right)^{1/2},$$\n   - The discrete $L^{\\infty}$ norm\n   $$\\|e\\|_{L^{\\infty},h} = \\max_{0 \\le i \\le N-1} \\left|u_i - u(x_i)\\right|.$$\n6. Using multiple refinements with grid spacings $\\{h_k\\}$, estimate the observed order of accuracy $p$ in each norm by fitting the model $\\|e\\| \\approx C h^p$ via a linear regression on $\\log(\\|e\\|)$ versus $\\log(h)$.\n\nDesign a test suite that covers a general case, a limiting case, and a stiff Robin case:\n- Case $1$: $a = 1.3$, $b = 0.7$, refinements $N \\in \\{32, 64, 128, 256\\}$.\n- Case $2$ (pure Neumann at $x=0$): $a = 0.0$, $b = 1.0$, refinements $N \\in \\{32, 64, 128, 256\\}$.\n- Case $3$ (stiff Robin): $a = 10.0$, $b = 0.5$, refinements $N \\in \\{32, 64, 128, 256\\}$.\n\nFor each case, compute the observed orders of accuracy in the discrete $L^2$ norm and in the discrete $L^{\\infty}$ norm, and round each observed order to $3$ decimal places.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element of the list corresponds to one test case and must itself be a two-element list in the order $\\left[p_{L^2}, p_{L^{\\infty}}\\right]$ for that case. For example, the output format must be\n$$[\\,[p_{L^2}^{(1)},p_{L^{\\infty}}^{(1)}],\\,[p_{L^2}^{(2)},p_{L^{\\infty}}^{(2)}],\\,[p_{L^2}^{(3)},p_{L^{\\infty}}^{(3)}]\\,].$$\nNo physical units are involved, and no angles appear in the problem. All numerical values must be given as dimensionless quantities. The final answers for each test case must be real numbers rounded to three decimals as specified.", "solution": "The problem requires the implementation of a second-order accurate finite difference method to solve a one-dimensional Poisson boundary value problem using the Method of Manufactured Solutions (MMS) to verify the numerical scheme's order of accuracy. The problem is well-defined and grounded in standard numerical analysis principles.\n\nThe governing equation is the one-dimensional Poisson equation on the domain $x \\in [0,1]$:\n$$-u''(x) = f(x)$$\nThis is subject to a Robin boundary condition at the left endpoint ($x=0$) and a Dirichlet boundary condition at the right endpoint ($x=1$):\n$$a\\,u(0) + b\\,u'(0) = c, \\qquad u(1) = u_{\\mathrm{R}}$$\nHere, $a \\ge 0$ and $b  0$ are given constants.\n\nStep 1: Manufactured Solution and Source Term\nThe Method of Manufactured Solutions begins by postulating a smooth exact solution. As specified, we choose:\n$$u(x) = e^{x} + \\sin(2\\pi x)$$\nThe first and second derivatives of this function are computed analytically:\n$$u'(x) = \\frac{d}{dx} \\left( e^{x} + \\sin(2\\pi x) \\right) = e^{x} + 2\\pi\\cos(2\\pi x)$$\n$$u''(x) = \\frac{d^2}{dx^2} \\left( e^{x} + \\sin(2\\pi x) \\right) = e^{x} - (2\\pi)^2\\sin(2\\pi x) = e^{x} - 4\\pi^2\\sin(2\\pi x)$$\nThe source term $f(x)$ is then determined by substituting $u''(x)$ into the governing equation, ensuring that our chosen $u(x)$ is indeed a solution:\n$$f(x) = -u''(x) = -e^{x} + 4\\pi^2\\sin(2\\pi x)$$\n\nStep 2: Boundary Data\nThe boundary data constants, $c$ and $u_{\\mathrm{R}}$, are determined by enforcing that the manufactured solution satisfies the boundary conditions.\nAt the left boundary, $x=0$:\n$$u(0) = e^0 + \\sin(0) = 1$$\n$$u'(0) = e^0 + 2\\pi\\cos(0) = 1 + 2\\pi$$\nThe value of $c$ is therefore a function of the given parameters $a$ and $b$:\n$$c = a\\,u(0) + b\\,u'(0) = a(1) + b(1 + 2\\pi) = a + b(1+2\\pi)$$\nAt the right boundary, $x=1$:\n$$u(1) = e^1 + \\sin(2\\pi) = e$$\nThe Dirichlet value $u_{\\mathrm{R}}$ is thus:\n$$u_{\\mathrm{R}} = u(1) = e$$\n\nStep 3: Finite Difference Discretization\nThe domain $[0,1]$ is discretized into a uniform grid with points $x_i = ih$ for $i=0, 1, \\dots, N$, where $h=1/N$ is the grid spacing. We aim to find the numerical approximations $u_i \\approx u(x_i)$ for the unknowns at nodes $i=0, 1, \\dots, N-1$.\n\nFor any interior grid point $x_i$ where $i \\in \\{1, 2, \\dots, N-2\\}$, the second derivative $-u''(x_i)$ is approximated using the second-order central difference formula:\n$$-u''(x_i) \\approx \\frac{-u_{i-1} + 2u_i - u_{i+1}}{h^2} = f(x_i)$$\nThis gives the equation for each interior node:\n$$-u_{i-1} + 2u_i - u_{i+1} = h^2 f(x_i)$$\n\nAt the right boundary, for the node $x_{N-1}$, the finite difference equation incorporates the known Dirichlet value $u_N=u_{\\mathrm{R}}$:\n$$\\frac{-u_{N-2} + 2u_{N-1} - u_N}{h^2} = f(x_{N-1})$$\nRearranging to move the known quantity to the right-hand side yields:\n$$-u_{N-2} + 2u_{N-1} = h^2 f(x_{N-1}) + u_{\\mathrm{R}}$$\n\nAt the left boundary, $x_0=0$, we use a ghost point at $x_{-1} = -h$ to maintain second-order accuracy. The discretized PDE at $x_0$ is:\n$$\\frac{-u_{-1} + 2u_0 - u_1}{h^2} = f(x_0)$$\nThe derivative $u'(0)$ in the Robin condition is also approximated with a second-order central difference involving the ghost point:\n$$u'(0) \\approx \\frac{u_1 - u_{-1}}{2h}$$\nSubstituting this into the Robin boundary condition $a u_0 + b u'(0) = c$ gives:\n$$a u_0 + b \\left(\\frac{u_1 - u_{-1}}{2h}\\right) = c$$\nThe ghost value $u_{-1}$ is an artifact and must be eliminated. We solve the boundary condition equation for $u_{-1}$:\n$$u_{-1} = u_1 - \\frac{2h}{b}(c - a u_0)$$\nSubstituting this expression for $u_{-1}$ into the discretized PDE at $x_0$ yields:\n$$\\frac{-(u_1 - \\frac{2h}{b}(c - a u_0)) + 2u_0 - u_1}{h^2} = f(x_0)$$\nMultiplying by $h^2$ and simplifying:\n$$ -u_1 + \\frac{2h}{b}(c - a u_0) + 2u_0 - u_1 = h^2 f(x_0)$$\n$$ -2u_1 + \\frac{2h}{b}c - \\frac{2ha}{b}u_0 + 2u_0 = h^2 f(x_0)$$\nFinally, we group terms involving the unknowns $u_0$ and $u_1$ on the left-hand side to obtain the first equation of our linear system:\n$$\\left(2 - \\frac{2ha}{b}\\right)u_0 - 2u_1 = h^2 f(x_0) - \\frac{2h}{b}c$$\n\nStep 4: Linear System Assembly and Solution\nThe $N$ linear equations for the $N$ unknowns $\\vec{U} = [u_0, u_1, \\dots, u_{N-1}]^T$ form a matrix system $A\\vec{U} = \\vec{d}$. The matrix $A$ is an $N \\times N$ tridiagonal matrix, and $\\vec{d}$ is the right-hand side vector of size $N$.\nThe non-zero entries of the matrix $A$ are:\nMain diagonal: $A_{ii} = 2$ for $i=1, \\dots, N-1$, and $A_{00} = 2 - \\frac{2ha}{b}$.\nSub-diagonal: $A_{i,i-1} = -1$ for $i=1, \\dots, N-1$.\nSuper-diagonal: $A_{i,i+1} = -1$ for $i=1, \\dots, N-2$, and $A_{0,1} = -2$.\n\nThe components of the right-hand side vector $\\vec{d}$ are:\n$d_0 = h^2 f(x_0) - \\frac{2h}{b}c$.\n$d_i = h^2 f(x_i)$ for $i=1, \\dots, N-2$.\n$d_{N-1} = h^2 f(x_{N-1}) + u_{\\mathrm{R}}$.\n\nThis tridiagonal system is solved numerically for the vector $\\vec{U}$ using a specialized direct solver for banded matrices.\n\nStep 5  6: Error Calculation and Order of Accuracy\nAfter obtaining the numerical solution $\\{u_i\\}_{i=0}^{N-1}$, the error at each grid point is computed as $e_i = u_i - u(x_i)$. The magnitude of the error is quantified using two discrete norms:\nThe discrete $L^2$ norm: $\\|e\\|_{L^2,h} = \\left( h \\sum_{i=0}^{N-1} |e_i|^2 \\right)^{1/2}$.\nThe discrete $L^{\\infty}$ norm: $\\|e\\|_{L^{\\infty},h} = \\max_{0 \\le i \\le N-1} |e_i|$.\n\nThe theoretical order of accuracy $p$ of the numerical method implies that the error norm scales as $\\|e\\| \\approx C h^p$ for some constant $C$ as the grid spacing $h \\to 0$. Taking the logarithm gives a linear relationship: $\\log(\\|e\\|) \\approx \\log(C) + p \\log(h)$. The order $p$ is therefore estimated as the slope of a line fitted to the data points $(\\log(h_k), \\log(\\|e\\|_k))$, which are generated from a sequence of grid refinements $h_k = 1/N_k$. This procedure is repeated for each of the three test cases specified in the problem.", "answer": "[[2.000, 2.000], [2.000, 2.000], [2.000, 2.000]]", "id": "3457485"}]}