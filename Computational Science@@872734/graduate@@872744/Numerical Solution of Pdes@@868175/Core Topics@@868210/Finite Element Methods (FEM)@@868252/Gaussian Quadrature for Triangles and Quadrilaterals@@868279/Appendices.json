{"hands_on_practices": [{"introduction": "Integrating functions over triangular domains is a common requirement in scientific computing, but standard high-order quadrature rules are most easily constructed for rectangular domains. This exercise introduces the Duffy transformation, an elegant technique to map an integral over a reference triangle to an equivalent integral over a unit square [@problem_id:3398652]. By working through this transformation, you will gain a deeper understanding of the change of variables theorem, the role of the Jacobian determinant, and how to determine the minimum required quadrature order for exact integration.", "problem": "Let $T$ be the reference triangle $T=\\{(x,y)\\in\\mathbb{R}^{2}: x\\ge 0,\\ y\\ge 0,\\ x+y\\le 1\\}$ and let $S=[0,1]^{2}$ be the unit square. Consider the integral\n$$\nI=\\iint_{T} x^{2}\\,y^{5}\\,\\bigl(1-x-y\\bigr)^{3}\\,dx\\,dy.\n$$\nStarting only from the change-of-variables theorem for multivariate integrals and the polynomial exactness of the $m$-point Gauss–Legendre rule on $[-1,1]$ (which is exact for all polynomials up to degree $2m-1$), carry out the following:\n\n(i) Construct a Duffy-type mapping $F:S\\to T$ that collapses one coordinate line in $S$ to a vertex of $T$ and maps edges of $S$ to edges of $T$. Derive its Jacobian determinant $J(u,v)$.\n\n(ii) Use this mapping to transform $I$ into an iterated integral over $S$ and simplify the transformed integrand as much as possible, expressing it as a product of one-dimensional factors in $u$ and $v$ multiplied by $|J(u,v)|$.\n\n(iii) Based on the degrees of the resulting one-dimensional polynomial factors in $u$ and $v$, determine the minimal Gauss–Legendre orders $m_{u}$ and $m_{v}$ so that the tensor-product rule on $S$ is exact for the transformed integrand.\n\n(iv) Evaluate $I$ exactly.\n\nYour final answer must be the exact value of $I$ as a single simplified number or a closed-form analytic expression with no units. Do not round.", "solution": "The problem is assessed to be valid as it is scientifically grounded in the theory of multivariate calculus and numerical analysis, well-posed with a clear objective, and free of any contradictions, ambiguities, or unsound premises.\n\nThe problem asks for the evaluation of the integral\n$$\nI=\\iint_{T} x^{2}\\,y^{5}\\,\\bigl(1-x-y\\bigr)^{3}\\,dx\\,dy\n$$\nover the reference triangle $T=\\{(x,y)\\in\\mathbb{R}^{2}: x\\ge 0,\\ y\\ge 0,\\ x+y\\le 1\\}$, following a specific procedure involving a Duffy-type transformation.\n\n(i) Construction of the mapping and its Jacobian\nA Duffy-type mapping $F:S \\to T$ from the unit square $S=[0,1]^{2}$ to the reference triangle $T$ can be defined by letting the first coordinate map directly to $x$ and then scaling the second coordinate to fit within the remaining triangular region. Let $(u,v) \\in S$. We define the mapping $F(u,v) = (x,y)$ as:\n$$\nx(u,v) = u\n$$\n$$\ny(u,v) = v(1-u)\n$$\nWe verify this mapping. The domain is $(u,v) \\in [0,1] \\times [0,1]$.\nFor any $(u,v) \\in S$:\n- $x=u \\ge 0$.\n- Since $u \\le 1$ and $v \\ge 0$, we have $y = v(1-u) \\ge 0$.\n- $x+y = u+v(1-u)$. Since $v \\le 1$, $x+y \\le u+(1-u)=1$.\nThus, the image of $S$ is contained in $T$.\nLet's check the boundaries:\n- The edge $u=0$ in $S$ maps to $(x,y)=(0,v)$ for $v \\in [0,1]$, which is the vertical edge of $T$.\n- The edge $u=1$ in $S$ maps to $(x,y)=(1,0)$, which is a vertex of $T$. This fulfills the requirement that one coordinate line is collapsed to a vertex.\n- The edge $v=0$ in $S$ maps to $(x,y)=(u,0)$ for $u \\in [0,1]$, which is the horizontal edge of $T$.\n- The edge $v=1$ in $S$ maps to $(x,y)=(u, 1-u)$, which corresponds to the hypotenuse $x+y=1$ of $T$.\nThe mapping is a bijection from the interior of $S$ to the interior of $T$.\n\nTo find the Jacobian determinant, we first compute the Jacobian matrix $\\mathbf{J}_F(u,v)$:\n$$\n\\mathbf{J}_F(u,v) = \\begin{pmatrix} \\frac{\\partial x}{\\partial u}  \\frac{\\partial x}{\\partial v} \\\\ \\frac{\\partial y}{\\partial u}  \\frac{\\partial y}{\\partial v} \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ -v  1-u \\end{pmatrix}\n$$\nThe Jacobian determinant, denoted by $J(u,v)$, is:\n$$\nJ(u,v) = \\det(\\mathbf{J}_F(u,v)) = (1)(1-u) - (0)(-v) = 1-u\n$$\n\n(ii) Transformation of the integral\nUsing the change of variables theorem for multiple integrals, we have $dx\\,dy = |J(u,v)|\\,du\\,dv$. Since $u \\in [0,1]$, $|J(u,v)| = |1-u| = 1-u$.\nThe integral $I$ is transformed as follows:\n$$\nI = \\iint_{S} f(x(u,v), y(u,v)) |J(u,v)| \\,du\\,dv\n$$\nwhere $f(x,y) = x^2 y^5 (1-x-y)^3$. We substitute the expressions for $x$, $y$, and $1-x-y$ in terms of $u$ and $v$:\n- $x = u$\n- $y = v(1-u)$\n- $1-x-y = 1-u-v(1-u) = (1-u)(1-v)$\nThe term $f(x(u,v), y(u,v))$ becomes:\n$$\n(u)^2 [v(1-u)]^5 [(1-u)(1-v)]^3 = u^2 v^5 (1-u)^5 (1-u)^3 (1-v)^3 = u^2 v^5 (1-u)^8 (1-v)^3\n$$\nThe full integrand in the $(u,v)$ coordinates is this expression multiplied by $|J(u,v)| = 1-u$:\n$$\n\\text{Integrand} = \\left( u^2 v^5 (1-u)^8 (1-v)^3 \\right) (1-u) = u^2 v^5 (1-u)^9 (1-v)^3\n$$\nThe integral $I$ over the square $S=[0,1]^2$ is:\n$$\nI = \\int_{0}^{1} \\int_{0}^{1} u^2 (1-u)^9 v^5 (1-v)^3 \\,du\\,dv\n$$\nThe integrand is a product of a function of $u$ and a function of $v$. We can separate the iterated integral into a product of two one-dimensional integrals:\n$$\nI = \\left(\\int_{0}^{1} u^2 (1-u)^9 \\,du\\right) \\left(\\int_{0}^{1} v^5 (1-v)^3 \\,dv\\right)\n$$\n\n(iii) Minimal Gauss-Legendre orders\nA tensor-product quadrature rule will be exact for the transformed integral if the one-dimensional rules are exact for the respective polynomial factors. The $m$-point Gauss-Legendre rule is exact for polynomials of degree up to $2m-1$. The integration domain for the rule is $[-1,1]$, but the degree of exactness is independent of a linear mapping of the interval.\nThe polynomial factor in the $u$-integral is $P_u(u) = u^2(1-u)^9$. Its degree is $2+9=11$.\nFor the $u$-integral to be evaluated exactly by an $m_u$-point Gauss-Legendre rule, we must have:\n$$\n2m_u - 1 \\ge 11 \\implies 2m_u \\ge 12 \\implies m_u \\ge 6\n$$\nThe minimal order for the $u$-direction is $m_u = 6$.\n\nThe polynomial factor in the $v$-integral is $P_v(v) = v^5(1-v)^3$. Its degree is $5+3=8$.\nFor the $v$-integral to be evaluated exactly by an $m_v$-point Gauss-Legendre rule, we must have:\n$$\n2m_v - 1 \\ge 8 \\implies 2m_v \\ge 9 \\implies m_v \\ge 4.5\n$$\nSince the number of points $m_v$ must be an integer, the minimal order for the $v$-direction is $m_v = 5$.\n\n(iv) Exact evaluation of the integral\nThe two one-dimensional integrals are instances of the Euler Beta function, which is defined as:\n$$\nB(z_1, z_2) = \\int_{0}^{1} t^{z_1-1} (1-t)^{z_2-1} \\,dt = \\frac{\\Gamma(z_1)\\Gamma(z_2)}{\\Gamma(z_1+z_2)}\n$$\nwhere $\\Gamma(z)$ is the Gamma function. For positive integers $n$, $\\Gamma(n)=(n-1)!$.\n\nThe integral in $u$ is:\n$$\n\\int_{0}^{1} u^2 (1-u)^9 \\,du = B(3, 10) = \\frac{\\Gamma(3)\\Gamma(10)}{\\Gamma(13)} = \\frac{2!\\,9!}{12!} = \\frac{2 \\cdot 1}{12 \\cdot 11 \\cdot 10} = \\frac{2}{1320} = \\frac{1}{660}\n$$\nThe integral in $v$ is:\n$$\n\\int_{0}^{1} v^5 (1-v)^3 \\,dv = B(6, 4) = \\frac{\\Gamma(6)\\Gamma(4)}{\\Gamma(10)} = \\frac{5!\\,3!}{9!} = \\frac{120 \\cdot 6}{9 \\cdot 8 \\cdot 7 \\cdot 6 \\cdot 5!} = \\frac{720}{362880} = \\frac{1}{504}\n$$\nFinally, the value of $I$ is the product of these two results:\n$$\nI = \\left(\\frac{1}{660}\\right) \\left(\\frac{1}{504}\\right) = \\frac{1}{660 \\times 504}\n$$\nThe product is $660 \\times 504 = 660 \\times (500 + 4) = 330000 + 2640 = 332640$.\nTherefore, the exact value of the integral is:\n$$\nI = \\frac{1}{332640}\n$$\nAlternatively, without canceling common factors early:\n$$\nI = B(3,10) \\cdot B(6,4) = \\frac{\\Gamma(3)\\Gamma(10)}{\\Gamma(13)} \\cdot \\frac{\\Gamma(6)\\Gamma(4)}{\\Gamma(10)} = \\frac{\\Gamma(3)\\Gamma(6)\\Gamma(4)}{\\Gamma(13)} = \\frac{2!\\,5!\\,3!}{12!}\n$$\n$$\nI = \\frac{(2)(120)(6)}{479001600} = \\frac{1440}{479001600} = \\frac{144}{47900160} = \\frac{1}{332640}\n$$", "answer": "$$\\boxed{\\frac{1}{332640}}$$", "id": "3398652"}, {"introduction": "The Divergence Theorem provides a profound link between the behavior of a vector field within a volume and its flux across the boundary. This practice explores a numerical analogue of this theorem in the context of the Finite Element Method [@problem_id:3398695]. You will use Gauss-Lobatto quadrature, a rule that includes element boundary points, to approximate both a volume integral and a boundary flux integral on a bilinearly mapped quadrilateral, demonstrating that for certain polynomial vector fields, the numerical approximations are exact and the theorem holds discretely.", "problem": "Let $Q = [-1,1] \\times [-1,1]$ be the reference square and let $K \\subset \\mathbb{R}^{2}$ be the convex quadrilateral with vertices (listed counterclockwise) $P_{1} = (0,0)$, $P_{2} = (2,0)$, $P_{3} = (2,1)$, $P_{4} = \\left(\\tfrac{1}{2}, \\tfrac{3}{2}\\right)$. Consider the standard bilinear isoparametric mapping $\\Phi : Q \\to K$ defined by the bilinear shape functions\n$$\nN_{1}(\\xi,\\eta) = \\tfrac{1}{4}(1-\\xi)(1-\\eta), \\quad\nN_{2}(\\xi,\\eta) = \\tfrac{1}{4}(1+\\xi)(1-\\eta), \\\\\nN_{3}(\\xi,\\eta) = \\tfrac{1}{4}(1+\\xi)(1+\\eta), \\quad\nN_{4}(\\xi,\\eta) = \\tfrac{1}{4}(1-\\xi)(1+\\eta),\n$$\nso that $\\Phi(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta) P_{i}$. Let $\\mathbf{F}(x,y) = \\big(x^{3} + x y,\\; y - x y^{2}\\big)$ and denote its divergence by $\\nabla \\cdot \\mathbf{F}$.\n\n- Part A. On the interval $[-1,1]$, determine the nodes and weights of the $3$-point Gauss–Lobatto quadrature rule by imposing exactness for polynomials of degree up to $3$. You must derive the weights directly from the exactness conditions.\n\n- Part B. Define the tensor-product quadrature on $Q$ formed from the one-dimensional $3$-point Gauss–Lobatto rule from Part A. Using the change-of-variables formula, define the corresponding volume quadrature $Q_{\\mathrm{vol}}$ for $\\int_{K} (\\nabla \\cdot \\mathbf{F})(x,y)\\, \\mathrm{d}x\\,\\mathrm{d}y$ in terms of the nodes $(\\xi_{i},\\eta_{j})$, the weights, and the Jacobian determinant $\\det D\\Phi(\\xi,\\eta)$.\n\n- Part C. For each physical edge $e \\subset \\partial K$, consider its parametrization $\\gamma_{e}(s) = \\Phi(\\pm 1, s)$ or $\\gamma_{e}(s) = \\Phi(s, \\pm 1)$ with $s \\in [-1,1]$. Using that, for a smooth parametrized curve $\\gamma(s)$, the flux integral satisfies $\\int_{e} \\mathbf{F} \\cdot \\mathbf{n}\\, \\mathrm{d}s = \\int_{-1}^{1} \\mathbf{F}(\\gamma(s)) \\cdot R\\, \\gamma'(s)\\, \\mathrm{d}s$, where $R = \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix}$ is the counterclockwise rotation by angle $\\pi/2$, define the edge quadrature $Q_{\\mathrm{bnd}}$ that applies the $3$-point Gauss–Lobatto rule along each edge (in the parameter $s$) and sums the contributions.\n\n- Part D. Using only degree arguments grounded in the definitions from Parts A–C and the structure of bilinear mappings, show that $Q_{\\mathrm{vol}}$ equals the exact volume integral and $Q_{\\mathrm{bnd}}$ equals the exact boundary flux integral for the given $\\mathbf{F}$ and $K$. Then compute the discrepancy\n$$\nD := Q_{\\mathrm{bnd}}\\big[\\mathbf{F}\\cdot \\mathbf{n}\\big] \\;-\\; Q_{\\mathrm{vol}}\\big[\\nabla \\cdot \\mathbf{F}\\big].\n$$\nProvide the final numerical value of $D$. If any numerical approximation were needed, you would round to four significant figures; however, if an exact value is obtained, report it exactly.", "solution": "The problem is subjected to validation.\n\n### Step 1: Extract Givens\n- Reference square: $Q = [-1,1] \\times [-1,1]$.\n- Physical quadrilateral: $K \\subset \\mathbb{R}^{2}$ is a convex quadrilateral with vertices (counterclockwise) $P_{1} = (0,0)$, $P_{2} = (2,0)$, $P_{3} = (2,1)$, and $P_{4} = \\left(\\frac{1}{2}, \\frac{3}{2}\\right)$.\n- Bilinear shape functions:\n  $N_{1}(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta)$\n  $N_{2}(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta)$\n  $N_{3}(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta)$\n  $N_{4}(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta)$\n- Isoparametric mapping: $\\Phi(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta) P_{i}$.\n- Vector field: $\\mathbf{F}(x,y) = \\left(x^{3} + x y, y - x y^{2}\\right)$.\n- Divergence: $\\nabla \\cdot \\mathbf{F}$.\n- Part A: Determine the nodes and weights of the $3$-point Gauss–Lobatto quadrature rule on $[-1,1]$ by imposing exactness for polynomials of degree up to $3$.\n- Part B: Define the tensor-product quadrature $Q_{\\mathrm{vol}}$ for $\\int_{K} (\\nabla \\cdot \\mathbf{F})(x,y)\\, \\mathrm{d}x\\,\\mathrm{d}y$.\n- Part C: Define the edge quadrature $Q_{\\mathrm{bnd}}$ for the boundary flux $\\int_{\\partial K} \\mathbf{F} \\cdot \\mathbf{n}\\, \\mathrm{d}s$.\n- Part D: Use degree arguments to show the quadratures are exact for the given problem and compute the discrepancy $D := Q_{\\mathrm{bnd}}\\big[\\mathbf{F}\\cdot \\mathbf{n}\\big] - Q_{\\mathrm{vol}}\\big[\\nabla \\cdot \\mathbf{F}\\big]$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the field of numerical analysis and the finite element method. All concepts, such as isoparametric mapping, Gaussian quadrature, and vector calculus, are standard and well-defined. The problem is well-posed; it provides all necessary data and functions and requests a series of well-defined derivations and a final calculation. The language is objective and precise. The problem does not violate any scientific principles, is not incomplete, and is not trivial, as it requires careful application of several connected concepts in numerical integration. The setup is a standard, verifiable exercise in numerical methods for partial differential equations.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Solution\n\nFor Part A, we derive the $3$-point Gauss-Lobatto quadrature rule on the interval $[-1,1]$. This rule uses $n=3$ points and includes the endpoints. Its nodes are thus $x_1 = -1$ and $x_3 = 1$. Let the third node be $x_2$. The rule has the form $\\int_{-1}^{1} f(x) \\,dx \\approx w_1 f(-1) + w_2 f(x_2) + w_3 f(1)$. For a quadrature rule on a symmetric interval with an odd number of points to be of maximal precision, the nodes and weights must be symmetric. Thus, $x_2 = 0$ and $w_1 = w_3$. The rule is $\\int_{-1}^{1} f(x) \\,dx \\approx w_1 f(-1) + w_2 f(0) + w_1 f(1)$. The problem states the rule is exact for polynomials of degree up to $3$. We enforce exactness for the monomials $x^0=1$ and $x^2$. Exactness for odd powers $x$ and $x^3$ is guaranteed by symmetry.\n\nFor $f(x)=1$:\n$$ \\int_{-1}^{1} 1 \\,dx = 2 $$\nThe quadrature gives $w_1(1) + w_2(1) + w_1(1) = 2w_1 + w_2$. Thus, we have the equation $2w_1 + w_2 = 2$.\n\nFor $f(x)=x^2$:\n$$ \\int_{-1}^{1} x^2 \\,dx = \\left[\\frac{x^3}{3}\\right]_{-1}^{1} = \\frac{1}{3} - \\left(-\\frac{1}{3}\\right) = \\frac{2}{3} $$\nThe quadrature gives $w_1(-1)^2 + w_2(0)^2 + w_1(1)^2 = w_1 + 0 + w_1 = 2w_1$. Thus, we have the equation $2w_1 = \\frac{2}{3}$, which implies $w_1 = \\frac{1}{3}$.\n\nSubstituting $w_1 = \\frac{1}{3}$ into the first equation gives $2\\left(\\frac{1}{3}\\right) + w_2 = 2$, which yields $w_2 = 2 - \\frac{2}{3} = \\frac{4}{3}$.\nThe nodes are $\\{-1, 0, 1\\}$ and the corresponding weights are $\\{\\frac{1}{3}, \\frac{4}{3}, \\frac{1}{3}\\}$. A $3$-point Gauss-Lobatto rule is exact for polynomials of degree up to $2n-3 = 2(3)-3 = 3$, which matches the problem statement.\n\nFor Part B, we define the volume quadrature $Q_{\\mathrm{vol}}$. The integral is transformed to the reference square $Q$:\n$$ \\int_{K} g(x,y)\\, \\mathrm{d}x\\,\\mathrm{d}y = \\int_{-1}^{1}\\int_{-1}^{1} g(\\Phi(\\xi,\\eta)) \\det(D\\Phi(\\xi,\\eta)) \\,d\\xi\\,d\\eta $$\nThe tensor-product quadrature rule using the $1$D rule from Part A on $Q$ is given by\n$$ Q_{\\mathrm{vol}}[g] = \\sum_{i=1}^{3} \\sum_{j=1}^{3} w_i w_j g(\\Phi(\\xi_i, \\eta_j)) \\det(D\\Phi(\\xi_i, \\eta_j)) $$\nwhere $(\\xi_i, \\eta_j)$ are the $9$ nodes with $\\xi_i, \\eta_j \\in \\{-1, 0, 1\\}$, and $w_i, w_j$ are the corresponding weights from $\\{\\frac{1}{3}, \\frac{4}{3}\\}$.\nThe specific integrand is the divergence of $\\mathbf{F}$, $\\nabla \\cdot \\mathbf{F}$:\n$$ \\nabla \\cdot \\mathbf{F} = \\frac{\\partial}{\\partial x}(x^3 + xy) + \\frac{\\partial}{\\partial y}(y - xy^2) = (3x^2 + y) + (1 - 2xy) = 3x^2 - 2xy + y + 1 $$\nWe also need the Jacobian determinant of the mapping $\\Phi(\\xi,\\eta) = (x(\\xi,\\eta), y(\\xi,\\eta))$.\nLet's find the explicit form of $\\Phi$. Using $P_1=(0,0)$, $P_2=(2,0)$, $P_3=(2,1)$, $P_4=(\\frac{1}{2}, \\frac{3}{2})$:\n$$ x(\\xi,\\eta) = N_2(2) + N_3(2) + N_4(\\tfrac{1}{2}) = \\tfrac{1}{4}(1+\\xi)(1-\\eta)(2) + \\tfrac{1}{4}(1+\\xi)(1+\\eta)(2) + \\tfrac{1}{4}(1-\\xi)(1+\\eta)(\\tfrac{1}{2}) $$\n$$ y(\\xi,\\eta) = N_3(1) + N_4(\\tfrac{3}{2}) = \\tfrac{1}{4}(1+\\xi)(1+\\eta)(1) + \\tfrac{1}{4}(1-\\xi)(1+\\eta)(\\tfrac{3}{2}) $$\nSimplifying these bilinear polynomials:\n$$ x(\\xi,\\eta) = \\tfrac{1}{2}(1+\\xi)(1-\\eta+1+\\eta) + \\tfrac{1}{8}(1-\\xi)(1+\\eta) = (1+\\xi) + \\tfrac{1}{8}(1-\\xi+\\eta-\\xi\\eta) = \\tfrac{9}{8} + \\tfrac{7}{8}\\xi + \\tfrac{1}{8}\\eta - \\tfrac{1}{8}\\xi\\eta $$\n$$ y(\\xi,\\eta) = \\tfrac{1}{4}(1+\\eta)( (1+\\xi) + \\tfrac{3}{2}(1-\\xi) ) = \\tfrac{1}{4}(1+\\eta)(\\tfrac{5}{2}-\\tfrac{1}{2}\\xi) = \\tfrac{1}{8}(5-\\xi+5\\eta-\\xi\\eta) $$\nThe partial derivatives are:\n$$ \\frac{\\partial x}{\\partial \\xi} = \\frac{7}{8} - \\frac{1}{8}\\eta, \\quad \\frac{\\partial x}{\\partial \\eta} = \\frac{1}{8} - \\frac{1}{8}\\xi $$\n$$ \\frac{\\partial y}{\\partial \\xi} = -\\frac{1}{8} - \\frac{1}{8}\\eta, \\quad \\frac{\\partial y}{\\partial \\eta} = \\frac{5}{8} - \\frac{1}{8}\\xi $$\nThe Jacobian determinant is:\n$$ \\det(D\\Phi) = \\left(\\frac{7}{8} - \\frac{1}{8}\\eta\\right)\\left(\\frac{5}{8} - \\frac{1}{8}\\xi\\right) - \\left(\\frac{1}{8} - \\frac{1}{8}\\xi\\right)\\left(-\\frac{1}{8} - \\frac{1}{8}\\eta\\right) $$\n$$ = \\frac{1}{64} \\left[ (7-\\eta)(5-\\xi) - (1-\\xi)(-1-\\eta) \\right] = \\frac{1}{64} \\left[ (35-7\\xi-5\\eta+\\xi\\eta) + (1+\\eta-\\xi-\\xi\\eta) \\right] $$\n$$ = \\frac{1}{64} (36 - 8\\xi - 4\\eta) = \\frac{1}{16}(9 - 2\\xi - \\eta) $$\n\nFor Part C, we define the boundary quadrature $Q_{\\mathrm{bnd}}$. The boundary $\\partial K$ is composed of four edges, $e_1, e_2, e_3, e_4$, corresponding to the sides of the reference square $\\xi=\\pm 1, \\eta=\\pm 1$. The boundary is traversed counterclockwise.\n- $e_1$ ($P_1 \\to P_2$): $\\eta=-1$, $\\xi$ from $-1$ to $1$. Parametrization $\\gamma_1(s) = \\Phi(s,-1)$ for $s \\in [-1,1]$.\n- $e_2$ ($P_2 \\to P_3$): $\\xi=1$, $\\eta$ from $-1$ to $1$. Parametrization $\\gamma_2(s) = \\Phi(1,s)$ for $s \\in [-1,1]$.\n- $e_3$ ($P_3 \\to P_4$): $\\eta=1$, $\\xi$ from $1$ to $-1$. Parametrization $\\gamma_3(s) = \\Phi(-s,1)$ for $s \\in [-1,1]$.\n- $e_4$ ($P_4 \\to P_1$): $\\xi=-1$, $\\eta$ from $1$ to $-1$. Parametrization $\\gamma_4(s) = \\Phi(-1,-s)$ for $s \\in [-1,1]$.\n\nThe flux integral over an edge $e$ with parametrization $\\gamma(s)$ is $\\int_{-1}^{1} \\mathbf{F}(\\gamma(s)) \\cdot R\\, \\gamma'(s)\\, \\mathrm{d}s$, where $R=\\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix}$.\nThe boundary quadrature $Q_{\\mathrm{bnd}}$ is the sum of the quadratures over the four edges, with each edge integral approximated by the $3$-point Gauss-Lobatto rule from Part A.\n$$ Q_{\\mathrm{bnd}}[\\mathbf{F}\\cdot\\mathbf{n}] = \\sum_{k=1}^4 \\sum_{j=1}^3 w_j \\left( \\mathbf{F}(\\gamma_k(s_j)) \\cdot R\\, \\gamma_k'(s_j) \\right) $$\nwhere $s_j \\in \\{-1,0,1\\}$ are the quadrature nodes and $w_j$ the corresponding weights.\n\nFor Part D, we show exactness and compute the discrepancy $D$.\nExactness of $Q_{\\mathrm{vol}}$: The full integrand in the reference domain is $(\\nabla \\cdot \\mathbf{F})(\\Phi(\\xi,\\eta)) \\det(D\\Phi(\\xi,\\eta))$.\n- $\\nabla \\cdot \\mathbf{F} = 3x^2 - 2xy + y + 1$ is a polynomial of total degree $2$ in $(x,y)$.\n- The mapping components $x(\\xi,\\eta)$ and $y(\\xi,\\eta)$ are bilinear, i.e., of degree $1$ in $\\xi$ and $1$ in $\\eta$.\n- The composition $(\\nabla \\cdot \\mathbf{F})(\\Phi(\\xi,\\eta))$ results in a polynomial in $(\\xi,\\eta)$. The terms $x^2$ and $xy$ will be of degree at most $2$ in $\\xi$ and $2$ in $\\eta$ (e.g., $(\\xi\\eta)^2 = \\xi^2\\eta^2$).\n- The Jacobian determinant $\\det(D\\Phi) = \\frac{1}{16}(9 - 2\\xi - \\eta)$ is a polynomial of degree $1$ in $\\xi$ and $1$ in $\\eta$.\n- The total integrand is a product of these two polynomials. Its degree in $\\xi$ is at most $2+1=3$, and its degree in $\\eta$ is at most $2+1=3$.\n- The tensor product of the $3$-point Gauss-Lobatto rule is exact for all polynomials $P(\\xi,\\eta)$ that are of degree at most $3$ in $\\xi$ and at most $3$ in $\\eta$. Since our integrand matches this condition, the quadrature is exact.\n- Thus, $Q_{\\mathrm{vol}}[\\nabla \\cdot \\mathbf{F}] = \\int_K (\\nabla \\cdot \\mathbf{F})\\, \\mathrm{d}x\\,\\mathrm{d}y$.\n\nExactness of $Q_{\\mathrm{bnd}}$: Consider a single edge, parametrized by $\\gamma(s)$. Since the mapping $\\Phi$ is bilinear, restricting one variable (e.g., $\\eta=-1$) makes the components of $\\gamma(s) = (x(s), y(s))$ linear polynomials in $s$.\n- The vector field is $\\mathbf{F}(x,y) = (x^3+xy, y-xy^2)$.\n- The integrand on an edge is $\\mathbf{F}(\\gamma(s)) \\cdot R \\gamma'(s)$.\n- $\\gamma'(s)$ is a constant vector since $\\gamma(s)$ is linear.\n- The components of $\\mathbf{F}(\\gamma(s))$ are polynomials in $s$. Since $x(s)$ and $y(s)$ are linear in $s$, terms like $x(s)^3$ and $x(s)y(s)^2$ are polynomials of degree $3$ in $s$.\n- The entire integrand, being a linear combination of these terms, is a polynomial of degree at most $3$ in $s$.\n- The $3$-point Gauss-Lobatto rule is exact for polynomials of degree up to $3$.\n- Therefore, the quadrature is exact on each edge. The sum of exact results is exact.\n- Thus, $Q_{\\mathrm{bnd}}[\\mathbf{F}\\cdot\\mathbf{n}] = \\int_{\\partial K} \\mathbf{F}\\cdot\\mathbf{n}\\, \\mathrm{d}s$.\n\nComputation of the discrepancy $D$:\nThe discrepancy is $D = Q_{\\mathrm{bnd}}[\\mathbf{F}\\cdot \\mathbf{n}] - Q_{\\mathrm{vol}}[\\nabla \\cdot \\mathbf{F}]$.\nBased on the exactness analysis above, this is equivalent to:\n$$ D = \\int_{\\partial K} \\mathbf{F}\\cdot\\mathbf{n}\\, \\mathrm{d}s - \\int_K (\\nabla \\cdot \\mathbf{F})\\, \\mathrm{d}x\\,\\mathrm{d}y $$\nThe Divergence Theorem states that for a continuously differentiable vector field $\\mathbf{F}$ on a region $K$ with piecewise smooth boundary $\\partial K$,\n$$ \\int_K (\\nabla \\cdot \\mathbf{F})\\, \\mathrm{d}A = \\int_{\\partial K} \\mathbf{F}\\cdot\\mathbf{n}\\, \\mathrm{d}s $$\nThe vector field $\\mathbf{F}$ has polynomial components, so it is smooth. The domain $K$ is a convex quadrilateral, which is a valid region for the theorem. Therefore, the Divergence Theorem applies directly.\nIt follows that the exact flux integral is equal to the exact volume integral.\n$$ \\int_{\\partial K} \\mathbf{F}\\cdot\\mathbf{n}\\, \\mathrm{d}s = \\int_K (\\nabla \\cdot \\mathbf{F})\\, \\mathrm{d}x\\,\\mathrm{d}y $$\nConsequently, the discrepancy $D$ must be zero.\n$$ D = 0 $$", "answer": "$$\\boxed{0}$$", "id": "3398695"}, {"introduction": "In the Finite Element Method (FEM), the stiffness matrix represents the discrete form of the governing differential operator, and its accurate computation is paramount. This hands-on coding practice investigates how errors in numerical quadrature propagate into the discrete energy, or $H^1$-seminorm, of the finite element solution [@problem_id:3398694]. By implementing the assembly of a stiffness matrix for distorted quadrilateral elements, you will directly observe and quantify how the choice of quadrature order interacts with element geometry to affect the overall accuracy of a simulation.", "problem": "Consider the scalar Poisson equation in two dimensions on a single quadrilateral finite element, where the local stiffness matrix arises from the weak form and the discrete $H^1$-seminorm of a nodal function is represented by the bilinear form induced by the stiffness matrix. The fundamental base for this problem consists of the weak form of the Poisson equation, the isoparametric mapping for quadrilateral elements, and Gaussian quadrature on tensor-product domains. Specifically, starting from the weak form, the element-level stiffness matrix entries are defined by\n$$K_{ij} = \\int_{\\hat{\\Omega}} \\left(\\nabla N_i(\\boldsymbol{x}(\\boldsymbol{\\xi}))\\right) \\cdot \\left(\\nabla N_j(\\boldsymbol{x}(\\boldsymbol{\\xi}))\\right) \\,\\det\\left(J(\\boldsymbol{\\xi})\\right)\\, \\mathrm{d}\\boldsymbol{\\xi},$$\nwhere $\\hat{\\Omega} = [-1,1]\\times[-1,1]$ is the reference square, $\\boldsymbol{\\xi} = (\\xi,\\eta)$ are the reference coordinates, $\\boldsymbol{x}(\\boldsymbol{\\xi})$ is the isoparametric mapping to physical coordinates, $N_i$ are the bilinear ($Q_1$) shape functions on the reference square, and $J(\\boldsymbol{\\xi})$ is the Jacobian matrix of the mapping. The physical gradients satisfy\n$$\\nabla N_i(\\boldsymbol{x}(\\boldsymbol{\\xi})) = J(\\boldsymbol{\\xi})^{-\\top} \\, \\nabla_{\\boldsymbol{\\xi}} N_i(\\boldsymbol{\\xi}),$$\nwith $J(\\boldsymbol{\\xi})$ varying with $\\boldsymbol{\\xi}$ in general. The discrete $H^1$-seminorm of a nodal vector $\\boldsymbol{u}$ on the element is given by\n$$|\\!|\\!|u_h|\\!|\\!|_{H^1(\\Omega_e)}^2 = \\boldsymbol{u}^\\top K \\boldsymbol{u}.$$\nUsing tensor-product Gaussian quadrature rules on $\\hat{\\Omega}$ with $n$ points per coordinate yields the approximation\n$$K_{ij}^{(n)} = \\sum_{a=1}^{n}\\sum_{b=1}^{n} w_a w_b \\left(\\nabla N_i(\\boldsymbol{x}(\\xi_a,\\eta_b))\\right) \\cdot \\left(\\nabla N_j(\\boldsymbol{x}(\\xi_a,\\eta_b))\\right) \\,\\det\\left(J(\\xi_a,\\eta_b)\\right),$$\nwhere $\\{(\\xi_a,w_a)\\}_{a=1}^n$ and $\\{(\\eta_b,w_b)\\}_{b=1}^n$ are the one-dimensional Gaussian quadrature nodes and weights on $[-1,1]$. The quadrature error propagates into the discrete $H^1$-seminorm as the scalar difference\n$$\\Delta_n(\\boldsymbol{u}) = \\left|\\boldsymbol{u}^\\top K \\boldsymbol{u} - \\boldsymbol{u}^\\top K^{(n)} \\boldsymbol{u}\\right|.$$\nYour task is to quantitatively evaluate $\\Delta_n(\\boldsymbol{u})$ for a set of quadrilateral elements with varying distortion, including cases where the Jacobian determinant $\\det(J(\\boldsymbol{\\xi}))$ varies rapidly over $\\hat{\\Omega}$. Use a high-order tensor-product Gaussian quadrature with $n_{\\text{exact}}$ points per coordinate as a surrogate for the exact integral. For $Q_1$ elements, define the reference bilinear basis functions $N_1(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta)$, $N_2(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta)$, $N_3(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta)$, $N_4(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta)$, and compute their reference gradients $\\nabla_{\\boldsymbol{\\xi}} N_i(\\xi,\\eta)$ analytically. Construct the isoparametric mapping by the standard interpolation $\\boldsymbol{x}(\\xi,\\eta) = \\sum_{i=1}^{4} N_i(\\xi,\\eta)\\boldsymbol{x}_i$, where $\\{\\boldsymbol{x}_i\\}_{i=1}^4$ are the physical vertex coordinates listed below in counterclockwise order.\n\nImplement a program that:\n- Assembles the local stiffness matrix $K^{(n)}$ using tensor-product Gaussian quadrature with $n$ points per coordinate.\n- Assembles a high-accuracy reference $K^{(n_{\\text{exact}})}$ using $n_{\\text{exact}} = 20$ points per coordinate.\n- Computes the discrete $H^1$-seminorm difference $\\Delta_n(\\boldsymbol{u}) = \\left|\\boldsymbol{u}^\\top K^{(n_{\\text{exact}})} \\boldsymbol{u} - \\boldsymbol{u}^\\top K^{(n)} \\boldsymbol{u}\\right|$.\n\nUse the following test suite of parameter values, chosen to exercise different behaviors:\n- Test case $1$ (affine, constant function; boundary behavior): element vertices $\\left((0.0,0.0),(1.0,0.0),(1.0,1.0),(0.0,1.0)\\right)$, nodal vector $\\boldsymbol{u} = (1.0,1.0,1.0,1.0)$, quadrature order $n=1$.\n- Test case $2$ (affine, parallelogram; happy path): element vertices $\\left((0.0,0.0),(2.0,0.1),(2.2,1.1),(0.2,1.0)\\right)$, nodal vector $\\boldsymbol{u} = (0.3,0.7,1.1,-0.2)$, quadrature order $n=1$.\n- Test case $3$ (mildly warped; non-affine, rapidly varying Jacobian not present): element vertices $\\left((0.0,0.0),(2.0,0.0),(1.9,1.0),(0.0,1.0)\\right)$, nodal vector $\\boldsymbol{u} = (0.3,0.7,1.1,-0.2)$, quadrature order $n=1$.\n- Test case $4$ (mildly warped; improved quadrature): same vertices as test case $3$, same $\\boldsymbol{u}$, quadrature order $n=2$.\n- Test case $5$ (strongly warped; non-affine with rapidly varying Jacobian): element vertices $\\left((0.0,0.0),(2.0,-0.3),(2.3,1.1),(0.0,1.0)\\right)$, nodal vector $\\boldsymbol{u} = (0.3,0.7,1.1,-0.2)$, quadrature order $n=2$.\n- Test case $6$ (strongly warped; higher-order quadrature): same vertices as test case $5$, same $\\boldsymbol{u}$, quadrature order $n=3$.\n\nFor all test cases, set $n_{\\text{exact}} = 20$ to obtain the reference stiffness matrix. The required final output is a single line containing a comma-separated list of the six scalar errors $\\left[\\Delta_{n}(\\boldsymbol{u})\\right]$ corresponding to the test cases in the given order. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $\\left[ r_1, r_2, r_3, r_4, r_5, r_6 \\right]$). No physical units apply here; return pure real numbers. Angles do not appear. Express each result as a floating-point number.", "solution": "The user-provided problem is validated as being scientifically grounded, well-posed, complete, and objective. It represents a standard numerical verification task within the field of Finite Element Method (FEM) analysis. All necessary data, equations, and definitions are provided. The problem is free of contradictions, ambiguities, or pseudo-scientific claims. We may therefore proceed with the solution.\n\n### Step 1: Theoretical Formulation\n\nThe problem requires the computation of the error in the discrete $H^1$-seminorm on a quadrilateral finite element, where the error arises from the use of numerical quadrature of order $n$ to approximate the element stiffness matrix.\n\nThe element stiffness matrix $K$ is a $4 \\times 4$ matrix for a bilinear quadrilateral ($Q_1$) element, with entries given by the integral over the reference square $\\hat{\\Omega} = [-1,1] \\times [-1,1]$:\n$$\nK_{ij} = \\int_{\\hat{\\Omega}} \\left(\\nabla_{\\boldsymbol{x}} N_i\\right) \\cdot \\left(\\nabla_{\\boldsymbol{x}} N_j\\right) \\det(J(\\boldsymbol{\\xi})) \\, \\mathrm{d}\\boldsymbol{\\xi}\n$$\nHere, $N_i(\\boldsymbol{\\xi})$ are the bilinear shape functions on the reference element, $\\boldsymbol{\\xi} = (\\xi, \\eta)$ are the coordinates on $\\hat{\\Omega}$, $J(\\boldsymbol{\\xi})$ is the Jacobian of the isoparametric mapping $\\boldsymbol{x}(\\boldsymbol{\\xi})$, and $\\nabla_{\\boldsymbol{x}}$ denotes the gradient with respect to the physical coordinates $\\boldsymbol{x}$.\n\nThe isoparametric mapping relates reference coordinates $\\boldsymbol{\\xi}$ to physical coordinates $\\boldsymbol{x}$ using the shape functions themselves:\n$$\n\\boldsymbol{x}(\\boldsymbol{\\xi}) = \\sum_{k=1}^{4} N_k(\\boldsymbol{\\xi}) \\boldsymbol{x}_k\n$$\nwhere $\\boldsymbol{x}_k$ are the physical coordinates of the element's four vertices. The Jacobian matrix of this mapping is:\n$$\nJ(\\boldsymbol{\\xi}) = \\frac{\\partial \\boldsymbol{x}}{\\partial \\boldsymbol{\\xi}} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} = \\begin{pmatrix} \\sum_k \\frac{\\partial N_k}{\\partial \\xi} x_k  \\sum_k \\frac{\\partial N_k}{\\partial \\eta} x_k \\\\ \\sum_k \\frac{\\partial N_k}{\\partial \\xi} y_k  \\sum_k \\frac{\\partial N_k}{\\partial \\eta} y_k \\end{pmatrix}\n$$\nThe chain rule relates the physical gradients $\\nabla_{\\boldsymbol{x}} N_i$ to the reference gradients $\\nabla_{\\boldsymbol{\\xi}} N_i$:\n$$\n\\nabla_{\\boldsymbol{\\xi}} N_i = J(\\boldsymbol{\\xi})^\\top \\nabla_{\\boldsymbol{x}} N_i \\quad \\implies \\quad \\nabla_{\\boldsymbol{x}} N_i = J(\\boldsymbol{\\xi})^{-\\top} \\nabla_{\\boldsymbol{\\xi}} N_i\n$$\nThe reference gradients for the $Q_1$ basis functions $N_1(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta)$, $N_2(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta)$, $N_3(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta)$, and $N_4(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta)$ are calculated analytically:\n\\begin{align*}\n\\nabla_{\\boldsymbol{\\xi}} N_1 = \\frac{1}{4} \\begin{pmatrix} -(1-\\eta) \\\\ -(1-\\xi) \\end{pmatrix},  \\nabla_{\\boldsymbol{\\xi}} N_2 = \\frac{1}{4} \\begin{pmatrix} 1-\\eta \\\\ -(1+\\xi) \\end{pmatrix} \\\\\n\\nabla_{\\boldsymbol{\\xi}} N_3 = \\frac{1}{4} \\begin{pmatrix} 1+\\eta \\\\ 1+\\xi \\end{pmatrix},  \\nabla_{\\boldsymbol{\\xi}} N_4 = \\frac{1}{4} \\begin{pmatrix} -(1+\\eta) \\\\ 1-\\xi \\end{pmatrix}\n\\end{align*}\n\nThe integral for $K_{ij}$ is approximated using an $n \\times n$ tensor-product Gaussian quadrature rule:\n$$\nK_{ij}^{(n)} \\approx \\sum_{a=1}^{n}\\sum_{b=1}^{n} w_a w_b \\left[ \\left( J^{-\\top} \\nabla_{\\boldsymbol{\\xi}} N_i \\right) \\cdot \\left( J^{-\\top} \\nabla_{\\boldsymbol{\\xi}} N_j \\right) \\det(J) \\right]_{\\boldsymbol{\\xi}=(\\xi_a,\\eta_b)}\n$$\nwhere $(\\xi_a, w_a)$ and $(\\eta_b, w_b)$ are the 1D Gauss-Legendre quadrature nodes and weights on $[-1,1]$.\n\nFinally, the discrete $H^1$-seminorm of a function $u_h = \\sum_i u_i N_i$ represented by its nodal vector $\\boldsymbol{u}$ is $|\\!|\\!|u_h|\\!|\\!|_{H^1(\\Omega_e)}^2 = \\boldsymbol{u}^\\top K \\boldsymbol{u}$. The error due to quadrature is the primary quantity of interest:\n$$\n\\Delta_n(\\boldsymbol{u}) = \\left| \\boldsymbol{u}^\\top K^{(n_{\\text{exact}})} \\boldsymbol{u} - \\boldsymbol{u}^\\top K^{(n)} \\boldsymbol{u} \\right|\n$$\nwhere $K^{(n_{\\text{exact}})}$ is a high-accuracy reference matrix computed with $n_{\\text{exact}} = 20$.\n\n### Step 2: Algorithmic Implementation\n\nWe develop a function `assemble_stiffness_matrix(vertices, n)` that implements the quadrature-based assembly of $K^{(n)}$.\n\n1.  **Get Quadrature Rule**: For a given order $n$, retrieve the 1D Gauss-Legendre nodes $\\{\\xi_a\\}_{a=1}^n$ and weights $\\{w_a\\}_{a=1}^n$ on $[-1,1]$. The `numpy.polynomial.legendre.leggauss` function is suitable for this.\n\n2.  **Initialize Matrix**: Create a $4 \\times 4$ matrix $K^{(n)}$ initialized to zeros.\n\n3.  **Iterate over Quadrature Points**: Loop through all $n \\times n$ pairs of quadrature points $(\\xi_a, \\eta_b)$. For each point:\n    a.  **Compute Reference Gradients**: Evaluate the analytical expressions for $\\nabla_{\\boldsymbol{\\xi}} N_i$ for $i=1..4$ at $(\\xi_a, \\eta_b)$. Store these in a $4 \\times 2$ matrix, `ref_grads`, where `ref_grads[i,:]` is the gradient vector for $N_{i+1}$.\n    b.  **Compute Jacobian**: Calculate the $2 \\times 2$ Jacobian matrix $J$. This can be efficiently computed as a matrix product: $J = \\boldsymbol{V}^\\top \\cdot \\boldsymbol{G}_{\\boldsymbol{\\xi}}$, where $\\boldsymbol{V}$ is the $4 \\times 2$ matrix of vertex coordinates and $\\boldsymbol{G}_{\\boldsymbol{\\xi}}$ is the $4 \\times 2$ `ref_grads` matrix.\n    c.  **Transform Gradients**: Compute the inverse of the Jacobian, $J^{-1}$. Transform the reference gradients to physical gradients for all four basis functions using the relation $(\\nabla_{\\boldsymbol{x}} N_i)^\\top = (\\nabla_{\\boldsymbol{\\xi}} N_i)^\\top J^{-1}$. This can be done in a single matrix operation: `phys_grads = ref_grads @ inv_J`.\n    d.  **Form Integrand**: Calculate the matrix of dot products of physical gradients, $D_{ij} = (\\nabla_{\\boldsymbol{x}} N_i) \\cdot (\\nabla_{\\boldsymbol{x}} N_j)$. This is computed as `phys_grads @ phys_grads.T`.\n    e.  **Accumulate**: Get the Jacobian determinant $\\det(J)$ and update the stiffness matrix: $K^{(n)} \\mathrel{+}= D \\times \\det(J) \\times w_a \\times w_b$.\n\n4.  **Main Loop**: For each test case provided:\n    a.  Call `assemble_stiffness_matrix` with the given quadrature order $n$ to get $K^{(n)}$.\n    b.  Call `assemble_stiffness_matrix` with $n_{\\text{exact}}=20$ to get the reference matrix $K^{(n_{\\text{exact}})}$.\n    c.  Compute the two quadratic forms $S_n = \\boldsymbol{u}^\\top K^{(n)} \\boldsymbol{u}$ and $S_{\\text{exact}} = \\boldsymbol{u}^\\top K^{(n_{\\text{exact}})} \\boldsymbol{u}$.\n    d.  Calculate the absolute difference $\\Delta_n(\\boldsymbol{u}) = |S_{\\text{exact}} - S_n|$ and store the result.\n\n5.  **Output**: Format the list of results into the required comma-separated string.\n\nThis procedure is implemented in the provided Python code, which correctly calculates the seminorm differences for the specified test cases, reflecting the impact of element distortion and quadrature order on the accuracy of the stiffness matrix integration.", "answer": "```python\nimport numpy as np\n# The problem can be solved using only numpy. Scipy is not required.\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating quadrature error in the H1-seminorm \n    for 2D quadrilateral finite elements.\n    \"\"\"\n\n    def get_ref_grads(xi, eta):\n        \"\"\"\n        Computes the gradients of the 4 bilinear shape functions on the\n        reference element [-1,1]x[-1,1] at point (xi, eta).\n        Ordering is CCW from (-1,-1).\n        \n        Args:\n            xi (float): First coordinate in the reference domain.\n            eta (float): Second coordinate in the reference domain.\n        \n        Returns:\n            numpy.ndarray: A 4x2 array where row i is [dN_i/dxi, dN_i/deta].\n        \"\"\"\n        dN_dxi = 0.25 * np.array([\n            -(1.0 - eta),\n             (1.0 - eta),\n             (1.0 + eta),\n            -(1.0 + eta)\n        ])\n        dN_deta = 0.25 * np.array([\n            -(1.0 - xi),\n            -(1.0 + xi),\n             (1.0 + xi),\n             (1.0 - xi)\n        ])\n        return np.vstack((dN_dxi, dN_deta)).T\n\n    def assemble_stiffness_matrix(vertices, n):\n        \"\"\"\n        Assembles the 4x4 local stiffness matrix for a Q1 quadrilateral element\n        using n-point tensor-product Gaussian quadrature.\n        \n        Args:\n            vertices (numpy.ndarray): 4x2 array of vertex coordinates in CCW order.\n            n (int): Number of Gaussian quadrature points in each direction.\n        \n        Returns:\n            numpy.ndarray: The 4x4 element stiffness matrix.\n        \"\"\"\n        K = np.zeros((4, 4))\n        \n        if n = 0:\n            return K\n\n        # Get 1D Gauss-Legendre quadrature nodes and weights\n        nodes, weights = np.polynomial.legendre.leggauss(n)\n        \n        # Tensor-product quadrature loops\n        for i in range(n):\n            xi = nodes[i]\n            w_xi = weights[i]\n            for j in range(n):\n                eta = nodes[j]\n                w_eta = weights[j]\n                \n                # Gradients of shape functions in reference coordinates (4x2 matrix)\n                ref_grads = get_ref_grads(xi, eta)\n                \n                # Jacobian matrix of the isoparametric mapping (2x2 matrix)\n                # J = V.T @ G_ref, where V are vertices and G_ref are ref_grads\n                J = np.dot(vertices.T, ref_grads)\n                \n                det_J = np.linalg.det(J)\n                \n                # A negative or zero determinant indicates an invalid mapping\n                # at the quadrature point. We assume this doesn't occur for the\n                # given test cases.\n                if det_J = 0:\n                   # A robust implementation might raise an error or handle this.\n                   # For this problem, we continue, which may lead to nan/inf results\n                   # if the matrix becomes singular, but it doesn't for these cases.\n                   pass\n                \n                inv_J = np.linalg.inv(J)\n                \n                # Gradients in physical coordinates\n                # (grad_phys_i)^T = (grad_ref_i)^T @ J^{-1}\n                # This applies to all shape functions simultaneously.\n                phys_grads = np.dot(ref_grads, inv_J)\n                \n                # Integrand for the stiffness matrix at the current quad point.\n                # The (i,j) element is (grad_phys_i) . (grad_phys_j)\n                integrand_matrix = np.dot(phys_grads, phys_grads.T)\n                \n                # Add weighted contribution to the stiffness matrix\n                K += integrand_matrix * det_J * w_xi * w_eta\n                \n        return K\n\n    # Test cases as defined in the problem statement\n    test_cases = [\n        {'vertices': np.array([[0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0]]),\n         'u': np.array([1.0, 1.0, 1.0, 1.0]), 'n': 1},\n        {'vertices': np.array([[0.0, 0.0], [2.0, 0.1], [2.2, 1.1], [0.2, 1.0]]),\n         'u': np.array([0.3, 0.7, 1.1, -0.2]), 'n': 1},\n        {'vertices': np.array([[0.0, 0.0], [2.0, 0.0], [1.9, 1.0], [0.0, 1.0]]),\n         'u': np.array([0.3, 0.7, 1.1, -0.2]), 'n': 1},\n        {'vertices': np.array([[0.0, 0.0], [2.0, 0.0], [1.9, 1.0], [0.0, 1.0]]),\n         'u': np.array([0.3, 0.7, 1.1, -0.2]), 'n': 2},\n        {'vertices': np.array([[0.0, 0.0], [2.0, -0.3], [2.3, 1.1], [0.0, 1.0]]),\n         'u': np.array([0.3, 0.7, 1.1, -0.2]), 'n': 2},\n        {'vertices': np.array([[0.0, 0.0], [2.0, -0.3], [2.3, 1.1], [0.0, 1.0]]),\n         'u': np.array([0.3, 0.7, 1.1, -0.2]), 'n': 3},\n    ]\n\n    n_exact = 20\n    results = []\n\n    for case in test_cases:\n        vertices = case['vertices']\n        u_vec = case['u']\n        n = case['n']\n\n        # Assemble stiffness matrices: one with order n, one with high order\n        K_n = assemble_stiffness_matrix(vertices, n)\n        K_exact = assemble_stiffness_matrix(vertices, n_exact)\n        \n        # Compute the quadratic forms, u^T * K * u\n        seminorm_sq_n = np.dot(u_vec.T, np.dot(K_n, u_vec))\n        seminorm_sq_exact = np.dot(u_vec.T, np.dot(K_exact, u_vec))\n        \n        # Calculate the absolute difference (error)\n        delta_n = abs(seminorm_sq_exact - seminorm_sq_n)\n        results.append(delta_n)\n\n    # Print the final result in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3398694"}]}