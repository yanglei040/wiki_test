{"hands_on_practices": [{"introduction": "This exercise takes you back to the fundamentals of isogeometric analysis. Before we can solve complex engineering problems, we must be able to compute with our basis functions, and a critical step is calculating their derivatives. This practice guides you through deriving the first derivative of NURBS basis functions from first principles, using the Cox-de Boor recursion and the quotient rule, a skill essential for assembling the stiffness matrix in an IGA code. [@problem_id:3594419]", "problem": "In the setting of isogeometric analysis (IGA) for computational solid mechanics, consider a univariate Non-Uniform Rational B-Splines (NURBS) curve defined over the parameter $u \\in [0,1]$ with an open knot vector $\\Xi = [0,0,0,1,1,1]$ and polynomial degree $p=2$. The associated B-spline basis functions $N_{i,2}(u)$, $i \\in \\{1,2,3\\}$, are defined recursively by the Cox窶電e Boor recursion starting from the piecewise-constant functions and the given knot vector. The NURBS basis functions are defined by\n$$\nR_i(u) = \\frac{w_i N_{i,2}(u)}{\\sum_{j=1}^{3} w_j N_{j,2}(u)},\n$$\nwhere $w_i$ are the positive weights. Such rational bases also arise as local blending functions in T-splines after local refinement reduces to a single tensor-product element, and their derivatives are needed in stiffness matrix assembly.\n\nTasks:\n1) Starting from the Cox窶電e Boor recursion and the given knot vector, derive explicit expressions for the quadratic B-spline basis functions $N_{i,2}(u)$ and their first derivatives $\\partial_u N_{i,2}(u)$ for $u \\in (0,1)$.\n2) Using only the quotient rule applied to the definition of $R_i(u)$ above (and without invoking any pre-memorized derivative formulas for NURBS), derive a general expression for $\\partial_u R_i(u)$ in terms of $N_{i,2}(u)$, $\\partial_u N_{i,2}(u)$, and the weights $\\{w_i\\}_{i=1}^{3}$.\n3) For the weights $w = [1,2,1]$, evaluate the three first derivatives $\\partial_u R_i(u)$ at $u = \\tfrac{1}{2}$.\n\nAnswer specification:\n- Report your final answer as a single $1 \\times 3$ row matrix containing the three values $\\partial_u R_1(\\tfrac{1}{2})$, $\\partial_u R_2(\\tfrac{1}{2})$, $\\partial_u R_3(\\tfrac{1}{2})$ in exact form.\n- Do not include units and do not round; provide exact rational numbers.", "solution": "We proceed from first principles. The B-spline basis functions $N_{i,p}(u)$ are defined by the Cox窶電e Boor recursion. For $p=0$,\n$$\nN_{i,0}(u) =\n\\begin{cases}\n1,  \\xi_i \\le u  \\xi_{i+1}, \\\\\n0,  \\text{otherwise},\n\\end{cases}\n$$\nwith the open knot vector $\\Xi = [\\xi_1,\\ldots,\\xi_6] = [0,0,0,1,1,1]$. For higher degree $p \\ge 1$,\n$$\nN_{i,p}(u) = \\frac{u - \\xi_i}{\\xi_{i+p} - \\xi_i} N_{i,p-1}(u) + \\frac{\\xi_{i+p+1} - u}{\\xi_{i+p+1} - \\xi_{i+1}} N_{i+1,p-1}(u),\n$$\nwith the convention that terms with zero denominators are interpreted as zero.\n\nStep 1: Determine $N_{i,2}(u)$ on $u \\in (0,1)$.\n- For $p=0$ and the given $\\Xi$, the only nondegenerate span is $[\\xi_3,\\xi_4) = [0,1)$, hence $N_{3,0}(u) = 1$ for $u \\in [0,1)$ and $N_{1,0}(u) = N_{2,0}(u) = 0$ on $u \\in (0,1)$.\n- For $p=1$, using the recursion:\n  - For $i=2$,\n  $$\n  N_{2,1}(u) = \\frac{u - \\xi_2}{\\xi_{2+1} - \\xi_2} N_{2,0}(u) + \\frac{\\xi_{2+2} - u}{\\xi_{2+2} - \\xi_{2+1}} N_{3,0}(u)\n  = \\frac{u - 0}{0 - 0} \\cdot 0 + \\frac{1 - u}{1 - 0} \\cdot 1 = 1 - u.\n  $$\n  - For $i=3$,\n  $$\n  N_{3,1}(u) = \\frac{u - \\xi_3}{\\xi_{3+1} - \\xi_3} N_{3,0}(u) + \\frac{\\xi_{3+2} - u}{\\xi_{3+2} - \\xi_{3+1}} N_{4,0}(u)\n  = \\frac{u - 0}{1 - 0} \\cdot 1 + \\frac{1 - u}{1 - 1} \\cdot 0 = u.\n  $$\n  All other $N_{i,1}(u)$ vanish on $u \\in (0,1)$.\n- For $p=2$:\n  - For $i=1$,\n  $$\n  N_{1,2}(u) = \\frac{u - \\xi_1}{\\xi_{1+2} - \\xi_1} N_{1,1}(u) + \\frac{\\xi_{1+2+1} - u}{\\xi_{1+2+1} - \\xi_{1+1}} N_{2,1}(u)\n  = 0 + \\frac{1 - u}{1 - 0} (1 - u) = (1 - u)^{2}.\n  $$\n  - For $i=2$,\n  $$\n  N_{2,2}(u) = \\frac{u - \\xi_2}{\\xi_{2+2} - \\xi_2} N_{2,1}(u) + \\frac{\\xi_{2+2+1} - u}{\\xi_{2+2+1} - \\xi_{2+1}} N_{3,1}(u)\n  = \\frac{u - 0}{1 - 0} (1 - u) + \\frac{1 - u}{1 - 0} u = 2u(1 - u).\n  $$\n  - For $i=3$,\n  $$\n  N_{3,2}(u) = \\frac{u - \\xi_3}{\\xi_{3+2} - \\xi_3} N_{3,1}(u) + \\frac{\\xi_{3+2+1} - u}{\\xi_{3+2+1} - \\xi_{3+1}} N_{4,1}(u)\n  = \\frac{u - 0}{1 - 0} u + 0 = u^{2}.\n  $$\nTherefore, on $u \\in (0,1)$,\n$$\nN_{1,2}(u) = (1 - u)^{2}, \\quad N_{2,2}(u) = 2u(1 - u), \\quad N_{3,2}(u) = u^{2}.\n$$\nTheir first derivatives are\n$$\n\\partial_u N_{1,2}(u) = -2(1 - u) = 2(u - 1), \\quad \\partial_u N_{2,2}(u) = 2(1 - 2u), \\quad \\partial_u N_{3,2}(u) = 2u.\n$$\n\nStep 2: Derive $\\partial_u R_i(u)$ by the quotient rule.\nBy definition,\n$$\nR_i(u) = \\frac{w_i N_{i,2}(u)}{\\sum_{j=1}^{3} w_j N_{j,2}(u)}.\n$$\nDefine the denominator (the NURBS weight function)\n$$\nW(u) = \\sum_{j=1}^{3} w_j N_{j,2}(u),\n$$\nand its derivative\n$$\n\\partial_u W(u) = \\sum_{j=1}^{3} w_j \\partial_u N_{j,2}(u).\n$$\nApplying the quotient rule to $R_i(u) = \\frac{w_i N_{i,2}(u)}{W(u)}$ yields\n$$\n\\partial_u R_i(u) = \\frac{w_i \\partial_u N_{i,2}(u) \\, W(u) - w_i N_{i,2}(u) \\, \\partial_u W(u)}{[W(u)]^{2}}.\n$$\n\nStep 3: Evaluate at $u = \\tfrac{1}{2}$ with $w = [1,2,1]$.\nFirst compute the basis values and derivatives at $u = \\tfrac{1}{2}$:\n$$\nN_{1,2}\\!\\left(\\tfrac{1}{2}\\right) = \\left(1 - \\tfrac{1}{2}\\right)^{2} = \\tfrac{1}{4}, \\quad\nN_{2,2}\\!\\left(\\tfrac{1}{2}\\right) = 2 \\cdot \\tfrac{1}{2} \\cdot \\left(1 - \\tfrac{1}{2}\\right) = \\tfrac{1}{2}, \\quad\nN_{3,2}\\!\\left(\\tfrac{1}{2}\\right) = \\left(\\tfrac{1}{2}\\right)^{2} = \\tfrac{1}{4}.\n$$\n$$\n\\partial_u N_{1,2}\\!\\left(\\tfrac{1}{2}\\right) = 2\\left(\\tfrac{1}{2} - 1\\right) = -1, \\quad\n\\partial_u N_{2,2}\\!\\left(\\tfrac{1}{2}\\right) = 2\\left(1 - 2 \\cdot \\tfrac{1}{2}\\right) = 0, \\quad\n\\partial_u N_{3,2}\\!\\left(\\tfrac{1}{2}\\right) = 2 \\cdot \\tfrac{1}{2} = 1.\n$$\nWith $w_1 = 1$, $w_2 = 2$, $w_3 = 1$,\n$$\nW\\!\\left(\\tfrac{1}{2}\\right) = 1 \\cdot \\tfrac{1}{4} + 2 \\cdot \\tfrac{1}{2} + 1 \\cdot \\tfrac{1}{4} = \\tfrac{1}{4} + 1 + \\tfrac{1}{4} = \\tfrac{3}{2},\n$$\nand\n$$\n\\partial_u W\\!\\left(\\tfrac{1}{2}\\right) = 1 \\cdot (-1) + 2 \\cdot 0 + 1 \\cdot 1 = 0.\n$$\nTherefore, for each $i \\in \\{1,2,3\\}$,\n$$\n\\partial_u R_i\\!\\left(\\tfrac{1}{2}\\right) = \\frac{w_i \\, \\partial_u N_{i,2}\\!\\left(\\tfrac{1}{2}\\right) \\, W\\!\\left(\\tfrac{1}{2}\\right) - w_i \\, N_{i,2}\\!\\left(\\tfrac{1}{2}\\right) \\, \\partial_u W\\!\\left(\\tfrac{1}{2}\\right)}{\\left[W\\!\\left(\\tfrac{1}{2}\\right)\\right]^{2}}\n= \\frac{w_i \\, \\partial_u N_{i,2}\\!\\left(\\tfrac{1}{2}\\right) \\, \\tfrac{3}{2}}{\\left(\\tfrac{3}{2}\\right)^{2}}\n= \\frac{2}{3} \\, w_i \\, \\partial_u N_{i,2}\\!\\left(\\tfrac{1}{2}\\right).\n$$\nThus,\n$$\n\\partial_u R_1\\!\\left(\\tfrac{1}{2}\\right) = \\frac{2}{3} \\cdot 1 \\cdot (-1) = -\\frac{2}{3}, \\quad\n\\partial_u R_2\\!\\left(\\tfrac{1}{2}\\right) = \\frac{2}{3} \\cdot 2 \\cdot 0 = 0, \\quad\n\\partial_u R_3\\!\\left(\\tfrac{1}{2}\\right) = \\frac{2}{3} \\cdot 1 \\cdot 1 = \\frac{2}{3}.\n$$\nCollecting the three values in a $1 \\times 3$ row matrix gives the requested final result in exact rational form.", "answer": "$$\\boxed{\\begin{pmatrix}-\\frac{2}{3}  0  \\frac{2}{3}\\end{pmatrix}}$$", "id": "3594419"}, {"introduction": "Standard B-spline and NURBS technologies offer powerful tools for geometric modeling, but refining a model locally poses a challenge. This practice explores the classical method of h-refinement through knot insertion, governed by Boehm's algorithm. By constructing the refinement matrix that maps the original control points to the refined set, you will gain a deep understanding of how refinement propagates and how fundamental properties like the partition of unity are maintained throughout the process. [@problem_id:3594387]", "problem": "Consider a univariate open Non-Uniform Rational B-Spline (NURBS) curve of degree $p=2$ used within Isogeometric Analysis (IGA) for computational solid mechanics, with an initial open knot vector $\\Xi^{(0)} = [0,0,0, \\tfrac{1}{2}, 1,1,1]$ and a corresponding control vector $\\mathbf{C}^{(0)} \\in \\mathbb{R}^{4}$. Two knots are inserted sequentially with multiplicity one at $\\xi=\\tfrac{1}{4}$ and $\\xi=\\tfrac{3}{4}$ to produce the refined knot vector $\\Xi^{(2)} = [0,0,0, \\tfrac{1}{4}, \\tfrac{1}{2}, \\tfrac{3}{4}, 1,1,1]$ and a refined control vector $\\mathbf{C}^{(2)} \\in \\mathbb{R}^{6}$. Let $\\mathbf{T} \\in \\mathbb{R}^{6 \\times 4}$ denote the global refinement matrix such that $\\mathbf{C}^{(2)} = \\mathbf{T}\\,\\mathbf{C}^{(0)}$, which preserves the geometry under refinement.\n\nStarting from the Cox窶電e Boor recursive definition of B-spline basis functions and the curve-invariance principle under knot insertion, derive the local convex combination relations that update control points during each single-knot insertion step. Use these relations to construct explicitly the two successive local refinement operators that map $\\mathbf{C}^{(0)} \\mapsto \\mathbf{C}^{(1)}$ (after inserting $\\xi=\\tfrac{1}{4}$) and $\\mathbf{C}^{(1)} \\mapsto \\mathbf{C}^{(2)}$ (after inserting $\\xi=\\tfrac{3}{4}$), and form the global refinement matrix $\\mathbf{T}$ as their product.\n\nThen, verify from first principles that every entry of $\\mathbf{T}$ is nonnegative and that each row of $\\mathbf{T}$ sums to $1$, thereby establishing convexity preservation of the control polygon and the partition-of-unity inheritance of the refined basis functions. Finally, compute the scalar\n$$\nS \\;=\\; \\sum_{i=1}^{6} \\sum_{j=1}^{4} T_{ij}.\n$$\nReport $S$ as a single real number with no units. No rounding is required.", "solution": "The problem requires the construction and analysis of a refinement matrix for a B-spline curve under sequential knot insertion. We will proceed by first principles, as requested. The problem refers to a Non-Uniform Rational B-Spline (NURBS), but provides a control vector in $\\mathbb{R}^4$, which corresponds to four scalar control points. This setup describes a B-spline function, which is a special case of a NURBS curve with all weights equal to unity. The standard knot insertion algorithm (Boehm's algorithm) applies directly to the control points in this case.\n\nA B-spline curve of degree $p$ is defined by a set of control points $\\mathbf{P}_i$ and a knot vector $\\Xi$. The curve is guaranteed to be invariant under knot insertion if the control points are updated according to specific local convex combination rules. Let the initial curve be $\\mathbf{C}(\\xi) = \\sum_{i=1}^{n} N_{i,p}(\\xi) \\mathbf{P}_i$ over the knot vector $\\Xi = \\{\\xi_1, \\dots, \\xi_{n+p+1}\\}$. When a new knot $\\bar{\\xi}$ is inserted, such that $\\xi_k \\le \\bar{\\xi}  \\xi_{k+1}$, a new set of $n+1$ control points $\\bar{\\mathbf{P}}_i$ and a new knot vector $\\bar{\\Xi}$ are generated. The curve-invariance principle, combined with the Cox-de Boor recursion for B-spline basis functions, yields the following update rules for the control points, known as Boehm's algorithm:\n$$\n\\bar{\\mathbf{P}}_i = \\begin{cases}\n\\mathbf{P}_i  \\text{for } 1 \\le i \\le k-p \\\\\n(1 - \\alpha_i) \\mathbf{P}_{i-1} + \\alpha_i \\mathbf{P}_i  \\text{for } k-p+1 \\le i \\le k \\\\\n\\mathbf{P}_{i-1}  \\text{for } k+1 \\le i \\le n+1\n\\end{cases}\n$$\nwhere the coefficient $\\alpha_i$ is given by:\n$$\n\\alpha_i = \\frac{\\bar{\\xi} - \\xi_i}{\\xi_{i+p} - \\xi_i}\n$$\nThese formulas define the local convex combination relations. For $k-p+1 \\le i \\le k$, the new control point $\\bar{\\mathbf{P}}_i$ is a convex combination of two adjacent old control points, $\\mathbf{P}_{i-1}$ and $\\mathbf{P}_i$, since $0 \\le \\alpha_i  1$ for a knot $\\bar{\\xi}$ inserted with multiplicity one in the open interval $(\\xi_k, \\xi_{k+1})$.\n\nWe now apply this procedure for the two specified knot insertions.\n\n**Step 1: First Knot Insertion at $\\xi = \\frac{1}{4}$**\nThe initial setup is a degree $p=2$ curve with $n^{(0)}=4$ control points $\\mathbf{C}^{(0)} = [\\mathbf{P}_1^{(0)}, \\mathbf{P}_2^{(0)}, \\mathbf{P}_3^{(0)}, \\mathbf{P}_4^{(0)}]^T$ and knot vector $\\Xi^{(0)} = [\\xi_1, \\dots, \\xi_7] = [0,0,0, \\frac{1}{2}, 1,1,1]$. We insert the knot $\\bar{\\xi} = \\frac{1}{4}$. We must find an index $k$ such that $\\xi_k \\le \\bar{\\xi}  \\xi_{k+1}$. From $\\Xi^{(0)}$, we see that $\\xi_3=0 \\le \\frac{1}{4}  \\frac{1}{2} = \\xi_4$, so $k=3$.\n\nThe new set will have $n^{(1)}=4+1=5$ control points, denoted $\\mathbf{C}^{(1)} = [\\mathbf{P}_1^{(1)}, \\dots, \\mathbf{P}_5^{(1)}]^T$. The affected indices for the old control points are in the range $[k-p, k] = [3-2, 3] = [1, 3]$. The update rules generate the new control points as follows:\n- For $i \\le k-p = 1$: $\\mathbf{P}_1^{(1)} = \\mathbf{P}_1^{(0)}$.\n- For $i \\in [k-p+1, k] = [2, 3]$:\n  - For $i=2$: $\\alpha_2 = \\frac{\\bar{\\xi} - \\xi_2}{\\xi_{2+p} - \\xi_2} = \\frac{\\frac{1}{4} - \\xi_2}{\\xi_4 - \\xi_2} = \\frac{\\frac{1}{4} - 0}{\\frac{1}{2} - 0} = \\frac{1}{2}$.\n    $\\mathbf{P}_2^{(1)} = (1-\\alpha_2)\\mathbf{P}_1^{(0)} + \\alpha_2 \\mathbf{P}_2^{(0)} = \\frac{1}{2}\\mathbf{P}_1^{(0)} + \\frac{1}{2}\\mathbf{P}_2^{(0)}$.\n  - For $i=3$: $\\alpha_3 = \\frac{\\bar{\\xi} - \\xi_3}{\\xi_{3+p} - \\xi_3} = \\frac{\\frac{1}{4} - \\xi_3}{\\xi_5 - \\xi_3} = \\frac{\\frac{1}{4} - 0}{1 - 0} = \\frac{1}{4}$.\n    $\\mathbf{P}_3^{(1)} = (1-\\alpha_3)\\mathbf{P}_2^{(0)} + \\alpha_3 \\mathbf{P}_3^{(0)} = \\frac{3}{4}\\mathbf{P}_2^{(0)} + \\frac{1}{4}\\mathbf{P}_3^{(0)}$.\n- For $i \\ge k+1 = 4$:\n  - For $i=4$: $\\mathbf{P}_4^{(1)} = \\mathbf{P}_{4-1}^{(0)} = \\mathbf{P}_3^{(0)}$.\n  - For $i=5$: $\\mathbf{P}_5^{(1)} = \\mathbf{P}_{5-1}^{(0)} = \\mathbf{P}_4^{(0)}$.\n\nThe relationship $\\mathbf{C}^{(1)} = \\mathbf{T}^{(1)} \\mathbf{C}^{(0)}$ is described by the $5 \\times 4$ local refinement matrix $\\mathbf{T}^{(1)}$:\n$$\n\\mathbf{T}^{(1)} = \\begin{pmatrix}\n1  0  0  0 \\\\\n\\frac{1}{2}  \\frac{1}{2}  0  0 \\\\\n0  \\frac{3}{4}  \\frac{1}{4}  0 \\\\\n0  0  1  0 \\\\\n0  0  0  1\n\\end{pmatrix}\n$$\nThe new knot vector is $\\Xi^{(1)} = [0,0,0, \\frac{1}{4}, \\frac{1}{2}, 1,1,1]$.\n\n**Step 2: Second Knot Insertion at $\\xi = \\frac{3}{4}$**\nWe now refine the curve defined by $n^{(1)}=5$ control points $\\mathbf{C}^{(1)}$ and knot vector $\\Xi^{(1)}$. Let the knots in $\\Xi^{(1)}$ be $\\eta_i$. We have $\\Xi^{(1)} = [\\eta_1, \\dots, \\eta_8] = [0,0,0, \\frac{1}{4}, \\frac{1}{2}, 1,1,1]$. We insert the knot $\\bar{\\xi} = \\frac{3}{4}$. We find $k$ such that $\\eta_k \\le \\bar{\\xi}  \\eta_{k+1}$. From $\\Xi^{(1)}$, we see $\\eta_5 = \\frac{1}{2} \\le \\frac{3}{4}  1 = \\eta_6$, so $k=5$.\n\nThe new set will have $n^{(2)}=5+1=6$ control points, $\\mathbf{C}^{(2)} = [\\mathbf{P}_1^{(2)}, \\dots, \\mathbf{P}_6^{(2)}]^T$. The update rules are:\n- For $i \\le k-p = 3$: $\\mathbf{P}_1^{(2)} = \\mathbf{P}_1^{(1)}$, $\\mathbf{P}_2^{(2)} = \\mathbf{P}_2^{(1)}$, $\\mathbf{P}_3^{(2)} = \\mathbf{P}_3^{(1)}$.\n- For $i \\in [k-p+1, k] = [4, 5]$:\n  - For $i=4$: $\\alpha_4 = \\frac{\\bar{\\xi} - \\eta_4}{\\eta_{4+p} - \\eta_4} = \\frac{\\frac{3}{4} - \\eta_4}{\\eta_6 - \\eta_4} = \\frac{\\frac{3}{4} - \\frac{1}{4}}{1 - \\frac{1}{4}} = \\frac{\\frac{1}{2}}{\\frac{3}{4}} = \\frac{2}{3}$.\n    $\\mathbf{P}_4^{(2)} = (1-\\alpha_4)\\mathbf{P}_3^{(1)} + \\alpha_4 \\mathbf{P}_4^{(1)} = \\frac{1}{3}\\mathbf{P}_3^{(1)} + \\frac{2}{3}\\mathbf{P}_4^{(1)}$.\n  - For $i=5$: $\\alpha_5 = \\frac{\\bar{\\xi} - \\eta_5}{\\eta_{5+p} - \\eta_5} = \\frac{\\frac{3}{4} - \\eta_5}{\\eta_7 - \\eta_5} = \\frac{\\frac{3}{4} - \\frac{1}{2}}{1 - \\frac{1}{2}} = \\frac{\\frac{1}{4}}{\\frac{1}{2}} = \\frac{1}{2}$.\n    $\\mathbf{P}_5^{(2)} = (1-\\alpha_5)\\mathbf{P}_4^{(1)} + \\alpha_5 \\mathbf{P}_5^{(1)} = \\frac{1}{2}\\mathbf{P}_4^{(1)} + \\frac{1}{2}\\mathbf{P}_5^{(1)}$.\n- For $i \\ge k+1 = 6$:\n  - For $i=6$: $\\mathbf{P}_6^{(2)} = \\mathbf{P}_{6-1}^{(1)} = \\mathbf{P}_5^{(1)}$.\n\nThe relationship $\\mathbf{C}^{(2)} = \\mathbf{T}^{(2)} \\mathbf{C}^{(1)}$ is defined by the $6 \\times 5$ local refinement matrix $\\mathbf{T}^{(2)}$:\n$$\n\\mathbf{T}^{(2)} = \\begin{pmatrix}\n1  0  0  0  0 \\\\\n0  1  0  0  0 \\\\\n0  0  1  0  0 \\\\\n0  0  \\frac{1}{3}  \\frac{2}{3}  0 \\\\\n0  0  0  \\frac{1}{2}  \\frac{1}{2} \\\\\n0  0  0  0  1\n\\end{pmatrix}\n$$\nThe final refined knot vector is $\\Xi^{(2)} = [0,0,0, \\frac{1}{4}, \\frac{1}{2}, \\frac{3}{4}, 1,1,1]$, as stated in the problem.\n\n**Global Refinement Matrix $\\mathbf{T}$**\nThe global refinement matrix $\\mathbf{T}$ transforms the initial control vector $\\mathbf{C}^{(0)}$ directly to the final control vector $\\mathbf{C}^{(2)}$. It is the product of the two sequential local refinement operators:\n$\\mathbf{C}^{(2)} = \\mathbf{T}^{(2)}\\mathbf{C}^{(1)} = \\mathbf{T}^{(2)}(\\mathbf{T}^{(1)}\\mathbf{C}^{(0)}) = (\\mathbf{T}^{(2)}\\mathbf{T}^{(1)})\\mathbf{C}^{(0)}$.\nThus, $\\mathbf{T} = \\mathbf{T}^{(2)}\\mathbf{T}^{(1)}$. We compute this $6 \\times 4$ matrix product:\n$$\n\\mathbf{T} = \\begin{pmatrix}\n1  0  0  0  0 \\\\\n0  1  0  0  0 \\\\\n0  0  1  0  0 \\\\\n0  0  \\frac{1}{3}  \\frac{2}{3}  0 \\\\\n0  0  0  \\frac{1}{2}  \\frac{1}{2} \\\\\n0  0  0  0  1\n\\end{pmatrix}\n\\begin{pmatrix}\n1  0  0  0 \\\\\n\\frac{1}{2}  \\frac{1}{2}  0  0 \\\\\n0  \\frac{3}{4}  \\frac{1}{4}  0 \\\\\n0  0  1  0 \\\\\n0  0  0  1\n\\end{pmatrix}\n$$\nPerforming the matrix multiplication row by row:\nRow 1: $[1,0,0,0]$\nRow 2: $[\\frac{1}{2}, \\frac{1}{2}, 0, 0]$\nRow 3: $[0, \\frac{3}{4}, \\frac{1}{4}, 0]$\nRow 4: $\\frac{1}{3}[0, \\frac{3}{4}, \\frac{1}{4}, 0] + \\frac{2}{3}[0, 0, 1, 0] = [0, \\frac{1}{4}, \\frac{1}{12}, 0] + [0, 0, \\frac{2}{3}, 0] = [0, \\frac{1}{4}, \\frac{1+8}{12}, 0] = [0, \\frac{1}{4}, \\frac{3}{4}, 0]$\nRow 5: $\\frac{1}{2}[0, 0, 1, 0] + \\frac{1}{2}[0, 0, 0, 1] = [0, 0, \\frac{1}{2}, \\frac{1}{2}]$\nRow 6: $[0, 0, 0, 1]$\n\nSo, the global refinement matrix is:\n$$\n\\mathbf{T} = \\begin{pmatrix}\n1  0  0  0 \\\\\n\\frac{1}{2}  \\frac{1}{2}  0  0 \\\\\n0  \\frac{3}{4}  \\frac{1}{4}  0 \\\\\n0  \\frac{1}{4}  \\frac{3}{4}  0 \\\\\n0  0  \\frac{1}{2}  \\frac{1}{2} \\\\\n0  0  0  1\n\\end{pmatrix}\n$$\n\n**Verification of Properties of $\\mathbf{T}$**\nWe verify two properties from first principles.\n1.  **Non-negativity ($T_{ij} \\ge 0$):** The entries of a local refinement matrix are non-negative. For rows corresponding to unchanged control points, the entries are $0$ or $1$. for rows corresponding to new control points, the coefficients are $1-\\alpha_i$ and $\\alpha_i$. Since $\\xi_k \\le \\bar{\\xi}  \\xi_{k+1}$, and for the affected control points $\\xi_i \\le \\bar{\\xi}$ and $\\xi_{i+p}  \\bar{\\xi}$, we have $0 \\le \\alpha_i  1$. Thus, all entries in $\\mathbf{T}^{(1)}$ and $\\mathbf{T}^{(2)}$ are non-negative. The product of two non-negative matrices is a non-negative matrix, since its entries are sums of products of non-negative numbers: $T_{ij} = \\sum_k T^{(2)}_{ik} T^{(1)}_{kj} \\ge 0$. Direct inspection of the computed $\\mathbf{T}$ confirms that all its entries are non-negative.\n2.  **Row Sums to Unity ($\\sum_j T_{ij} = 1$):** This property ensures that the basis functions form a partition of unity, a fundamental property inherited through refinement. For any local refinement matrix, say $\\mathbf{A}$, the rows sum to $1$. This is because each new control point is either a copy of an old one (row has a single $1$) or a convex combination $(1-\\alpha)\\mathbf{P}_{j-1} + \\alpha\\mathbf{P}_j$ (row entries are $(1-\\alpha)$ and $\\alpha$, summing to $1$). A matrix whose rows each sum to $1$ is called a row-stochastic matrix. Let $\\mathbf{e}_k$ be a column vector of $k$ ones. The row-sum property is equivalent to $\\mathbf{A}\\mathbf{e}_{n} = \\mathbf{e}_{m}$. For our refinement matrices, $\\mathbf{T}^{(1)}\\mathbf{e}_{4} = \\mathbf{e}_{5}$ and $\\mathbf{T}^{(2)}\\mathbf{e}_{5} = \\mathbf{e}_{6}$. The product of two row-stochastic matrices is also row-stochastic:\n    $(\\mathbf{T}^{(2)}\\mathbf{T}^{(1)})\\mathbf{e}_4 = \\mathbf{T}^{(2)}(\\mathbf{T}^{(1)}\\mathbf{e}_4) = \\mathbf{T}^{(2)}\\mathbf{e}_5 = \\mathbf{e}_6$.\n    Thus, each row of $\\mathbf{T} = \\mathbf{T}^{(2)}\\mathbf{T}^{(1)}$ must sum to $1$. We can verify this explicitly on the computed $\\mathbf{T}$:\n    Row 1: $1+0+0+0=1$\n    Row 2: $\\frac{1}{2}+\\frac{1}{2}+0+0=1$\n    Row 3: $0+\\frac{3}{4}+\\frac{1}{4}+0=1$\n    Row 4: $0+\\frac{1}{4}+\\frac{3}{4}+0=1$\n    Row 5: $0+0+\\frac{1}{2}+\\frac{1}{2}=1$\n    Row 6: $0+0+0+1=1$\n    The verification is successful.\n\n**Final Computation of $S$**\nThe scalar $S$ is the sum of all entries in the matrix $\\mathbf{T}$:\n$$\nS = \\sum_{i=1}^{6} \\sum_{j=1}^{4} T_{ij}\n$$\nThis can be computed as the sum of the row sums:\n$$\nS = \\sum_{i=1}^{6} \\left( \\sum_{j=1}^{4} T_{ij} \\right)\n$$\nAs we have just proven and verified, the sum of each row is $1$. Therefore:\n$$\nS = \\sum_{i=1}^{6} 1 = 6\n$$\nThe value of $S$ is the number of rows in the final refinement matrix $\\mathbf{T}$.", "answer": "$$\\boxed{6}$$", "id": "3594387"}, {"introduction": "The main limitation of standard NURBS refinement is its global nature, which T-splines were designed to overcome. This exercise provides a hands-on look at the core feature of T-splines: true local refinement through the insertion of a T-junction. You will analyze the direct consequences of adding a single T-junction to a mesh, quantifying the changes to the basis and identifying which basis functions are added or modified, thereby revealing the underlying mechanics that grant T-splines their powerful flexibility. [@problem_id:3594368]", "problem": "Consider a quadratic Analysis-Suitable T-spline (ASTS) basis over the parametric domain $\\Omega$ with a uniform initial T-mesh defined by vertical lines at $u=0,1,2,3$ and horizontal lines at $v=0,1,2,3$. The mesh thus contains $3\\times 3$ faces bounded by these lines. For quadratic degree ($p=q=2$), anchors are associated with face centers, and the number of basis functions equals the number of faces. Index the anchors by row-major face ordering with the identifier map $I(i,j)=(j-1)\\cdot 3+i$ for column $i\\in\\{1,2,3\\}$ and row $j\\in\\{1,2,3\\}$, so that the central face $(i=2,j=2)$ has identifier $I(2,2)=5$.\n\nA local refinement inserts a single T-junction by adding a vertical mesh segment at $u=1.5$ inside the central face $(i=2,j=2)$ that starts on the top edge at $v=2$ and terminates on the midpoint of the bottom edge at $v=1$, thereby creating a T-junction at $(u=1.5,v=1)$. This splits the central face into two faces, a left subface $(2\\mathrm{L},2)$ with $u\\in[1,1.5]$ and a right subface $(2\\mathrm{R},2)$ with $u\\in[1.5,2]$. Assign new identifiers to these added anchors as $I(2\\mathrm{L},2)=10$ and $I(2\\mathrm{R},2)=11$. Assume the Analysis-Suitable T-spline extension rule for $p=q=2$ is enforced entirely within the row $j=2$ so that no additional faces are created and no T-junction extensions intersect; the new vertical segment at $u=1.5$ becomes part of the local index selection for anchors adjacent to the central face in the $u$-direction in row $j=2$.\n\nUsing only the defining properties of Analysis-Suitable T-splines for even degree ($p=2$) and the construction of local index vectors from neighboring mesh lines, determine:\n- The change $\\Delta N$ in the total number of basis functions after the refinement.\n- The identifiers of the anchors that are added by the refinement.\n- The identifiers of the anchors whose local index vectors are altered by the insertion of the vertical segment at $u=1.5$ (while they remain present as anchors), specifically within row $j=2$.\n\nExpress your final answer as a single row matrix containing five entries in the following order: $\\Delta N$, $I_{\\text{add},1}$, $I_{\\text{add},2}$, $I_{\\text{alt},1}$, $I_{\\text{alt},2}$. No rounding is required.", "solution": "The problem requires an analysis of a local refinement step on a quadratic Analysis-Suitable T-spline (ASTS) basis. We must determine the change in the number of basis functions, identify the newly added basis functions (via their anchor identifiers), and identify the existing basis functions whose definitions are altered by the refinement.\n\nFirst, we establish the initial state. The problem defines a uniform $3 \\times 3$ T-mesh over the parametric domain $\\Omega$, with knot lines at $u \\in \\{0, 1, 2, 3\\}$ and $v \\in \\{0, 1, 2, 3\\}$. This creates $9$ faces. For quadratic ASTS ($p=q=2$), there is a one-to-one correspondence between faces, anchors, and basis functions. Therefore, the initial number of basis functions is $N_0 = 9$. The anchors are indexed using the map $I(i,j) = (j-1) \\cdot 3 + i$ for column $i$ and row $j$. The anchors in the central row ($j=2$) are:\n- $I(1,2) = (2-1) \\cdot 3 + 1 = 4$\n- $I(2,2) = (2-1) \\cdot 3 + 2 = 5$\n- $I(3,2) = (2-1) \\cdot 3 + 3 = 6$\n\nThe local refinement operation consists of inserting a vertical mesh segment at $u=1.5$ that spans from $v=2$ to $v=1$. This segment bisects the central face, which corresponds to anchor $I(2,2) = 5$. The original face, defined by $u \\in [1,2]$ and $v \\in [1,2]$, is replaced by two new faces: a left subface for $u \\in [1,1.5]$ and a right subface for $u \\in [1.5,2]$, both over $v \\in [1,2]$.\n\n1.  **Change in the Number of Basis Functions ($\\Delta N$)**\n    The number of basis functions is equal to the number of faces (and anchors). The described refinement removes one face (the original central face) and adds two new faces in its place.\n    - Initial number of faces/basis functions: $N_0 = 9$.\n    - Final number of faces/basis functions: $N_f = N_0 - 1 + 2 = 10$.\n    The change in the total number of basis functions is:\n    $$ \\Delta N = N_f - N_0 = 10 - 9 = 1 $$\n\n2.  **Identifiers of Added Anchors ($I_{\\text{add}}$)**\n    The refinement replaces the anchor of the original central face, $I(2,2)=5$, with two new anchors corresponding to the two new subfaces. The problem statement explicitly assigns identifiers to these new anchors:\n    - Anchor for the left subface $(2\\mathrm{L},2)$: $I(2\\mathrm{L},2) = 10$.\n    - Anchor for the right subface $(2\\mathrm{R},2)$: $I(2\\mathrm{R},2) = 11$.\n    Thus, the identifiers of the added anchors are $10$ and $11$.\n\n3.  **Identifiers of Altered Anchors ($I_{\\text{alt}}$)**\n    The definition of a T-spline basis function $N_a$ associated with an anchor $a$ is determined by its local knot vectors. For a quadratic ($p=2$) T-spline, the local knot vector in a given parametric direction (e.g., $u$-direction) is constructed by collecting the knot values of the first $p/2+1 = 2/2+1 = 2$ distinct mesh lines crossed by a ray cast from the anchor in the positive and negative directions. An existing basis function is altered if its local knot vector changes. This occurs if the set of mesh lines it \"sees\" changes.\n\n    The refinement introduces a new vertical segment at $u=1.5$ only on the interval $v \\in [1,2]$. This means that only anchors whose rays are cast at a $v$-coordinate within this interval can be affected. The anchors are located at the centers of their respective faces.\n    - Anchors in row $j=1$ (e.g., $I(1,1)=1$, $I(2,1)=2$, $I(3,1)=3$): These anchors are centered at $v=0.5$. Rays cast from these anchors do not cross the $v$-interval $[1,2]$ and thus do not \"see\" the new line at $u=1.5$. Their local index vectors are unchanged.\n    - Anchors in row $j=3$ (e.g., $I(1,3)=7$, $I(2,3)=8$, $I(3,3)=9$): These anchors are centered at $v=2.5$. For the same reason, their local index vectors are also unchanged.\n    - Anchors in row $j=2$ (e.g., $I(1,2)=4$, $I(3,2)=6$): These anchors are centered at $v=1.5$, which lies within the interval $v \\in [1,2]$. Their local index vectors in the $u$-direction are potentially altered. Let's analyze them.\n\n    **Anchor $I(1,2)=4$**: This anchor is at the center of the face $[0,1] \\times [1,2]$, with coordinates $(0.5, 1.5)$.\n    - We examine the ray cast in the positive $u$-direction from $u=0.5$.\n    - **Before refinement**: The set of vertical mesh lines is $\\{0, 1, 2, 3\\}$. The ray first crosses $u=1$, then $u=2$. The collected lines are $\\{1, 2\\}$.\n    - **After refinement**: The set of vertical mesh lines visible from $v=1.5$ is $\\{0, 1, 1.5, 2, 3\\}$. The ray first crosses $u=1$, then $u=1.5$. The collected lines are $\\{1, 1.5\\}$.\n    - Since the set of lines used to construct the local knot vector has changed, the basis function associated with anchor $4$ is altered.\n\n    **Anchor $I(3,2)=6$**: This anchor is at the center of the face $[2,3] \\times [1,2]$, with coordinates $(2.5, 1.5)$.\n    - We examine the ray cast in the negative $u$-direction from $u=2.5$.\n    - **Before refinement**: The set of vertical mesh lines is $\\{0, 1, 2, 3\\}$. The ray first crosses $u=2$, then $u=1$. The collected lines are $\\{2, 1\\}$.\n    - **After refinement**: The set of vertical mesh lines visible from $v=1.5$ is $\\{0, 1, 1.5, 2, 3\\}$. The ray first crosses $u=2$, then $u=1.5$. The collected lines are $\\{2, 1.5\\}$.\n    - The local knot vector for anchor $6$ is also altered.\n\n    The problem confirms our scope by asking specifically for altered anchors \"within row $j=2$\". The anchor $I(2,2)=5$ is removed, not altered. Therefore, the identifiers of the anchors whose basis functions are altered are $4$ and $6$.\n\n    **Summary of Results:**\n    - Change in number of basis functions: $\\Delta N = 1$.\n    - Identifiers of added anchors: $10$ and $11$.\n    - Identifiers of altered anchors in row $j=2$: $4$ and $6$.\n\n    The final answer is a row matrix containing these five values in the specified order: $(\\Delta N, I_{\\text{add},1}, I_{\\text{add},2}, I_{\\text{alt},1}, I_{\\text{alt},2})$. We will list the added and altered identifiers in increasing order.\n\n    The final set of values is $(1, 10, 11, 4, 6)$.", "answer": "$$ \\boxed{ \\begin{pmatrix} 1  10  11  4  6 \\end{pmatrix} } $$", "id": "3594368"}]}