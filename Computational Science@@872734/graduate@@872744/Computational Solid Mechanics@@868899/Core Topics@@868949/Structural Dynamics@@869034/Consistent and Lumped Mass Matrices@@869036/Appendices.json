{"hands_on_practices": [{"introduction": "To truly grasp the distinction between consistent and lumped mass matrices, the best approach is to derive them from first principles. This foundational exercise guides you through the entire Finite Element Method (FEM) workflow for a simple 1D vibrating bar, from establishing the weak form to solving the final eigenvalue problem. By directly comparing the fundamental frequencies computed with each mass matrix type, you will gain a tangible, quantitative understanding of the classic trade-off between the higher accuracy of the consistent formulation and the computational efficiency of the lumped approach [@problem_id:3551458].", "problem": "Consider axial vibrations of a uniform, prismatic bar of length $L$, cross-sectional area $A$, Young's modulus $E$, and mass density $\\rho$, aligned along the spatial coordinate $x \\in [0, L]$. Assume small-strain linear elasticity, one-dimensional axial motion, and no external loads. The boundary at $x=0$ is fixed (displacement $u(0,t)=0$) and the boundary at $x=L$ is traction-free (natural boundary condition). The continuous governing principle is the balance of linear momentum, and the finite-dimensional model is to be constructed using the Finite Element Method (FEM).\n\nDiscretize the bar into $2$ equal two-node linear elements. Starting from the strong form of the governing equation and its weak (variational) form derived by multiplying with an admissible test function and integrating over the domain, use the Galerkin projection with standard linear shape functions to:\n\n- Derive the element-level consistent mass matrix by integrating the kinetic energy term over each element.\n- Construct the element-level lumped mass matrix by diagonalizing the element mass via nodal mass summation.\n- Assemble the global stiffness and mass matrices for the $2$-element mesh.\n- Impose the essential boundary condition at $x=0$ to obtain the reduced generalized eigenvalue problem for the retained nodal degrees of freedom.\n\nLet $\\omega_{\\text{cons}}$ denote the smallest (fundamental) angular frequency obtained from the reduced generalized eigenproblem using the consistent mass matrix, and let $\\omega_{\\text{lump}}$ denote the smallest angular frequency obtained using the lumped mass matrix. Compute the ratio\n$$\nR \\equiv \\frac{\\omega_{\\text{cons}}}{\\omega_{\\text{lump}}}\n$$\nas an exact closed-form analytic expression in radicals, simplified as far as possible. Provide $R$ as a dimensionless quantity. No numerical rounding is required; express the final answer exactly.", "solution": "### Problem Validation\n\nFirst, I will validate the provided problem statement.\n\n**Step 1: Extract Givens**\n- **System**: A uniform, prismatic bar.\n- **Parameters**: Length $L$, cross-sectional area $A$, Young's modulus $E$, mass density $\\rho$.\n- **Domain**: Spatial coordinate $x \\in [0, L]$.\n- **Physics**: One-dimensional axial small-strain linear elastic vibrations with no external loads.\n- **Boundary Conditions**: Fixed at $x=0$ ($u(0,t)=0$) and traction-free at $x=L$.\n- **Method**: Finite Element Method (FEM) using a discretization of $2$ equal two-node linear elements.\n- **Tasks**:\n    1. Derive the element-level consistent mass matrix.\n    2. Construct the element-level lumped mass matrix via nodal mass summation.\n    3. Assemble the global stiffness and mass matrices.\n    4. Impose the essential boundary condition at $x=0$ to obtain the reduced generalized eigenvalue problem.\n    5. Find the smallest angular frequency from the consistent mass formulation, $\\omega_{\\text{cons}}$.\n    6. Find the smallest angular frequency from the lumped mass formulation, $\\omega_{\\text{lump}}$.\n    7. Compute the ratio $R \\equiv \\frac{\\omega_{\\text{cons}}}{\\omega_{\\text{lump}}}$.\n- **Output Requirement**: The ratio $R$ must be an exact, simplified, closed-form analytic expression in radicals.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem is based on the well-established principles of continuum mechanics, structural dynamics, and the Finite Element Method. The formulation of consistent and lumped mass matrices is a standard topic in computational mechanics. The problem is scientifically sound.\n- **Well-Posed**: The problem is well-posed. It provides all necessary physical parameters ($L, A, E, \\rho$), boundary conditions, and discretization details ($2$ linear elements) to arrive at a unique solution for the discrete frequencies. The fixed boundary condition prevents rigid body motion, ensuring non-zero vibration frequencies.\n- **Objective**: The problem is stated using precise, objective, and standard terminology from engineering and mathematics. There are no subjective or ambiguous statements.\n\n**Step 3: Verdict and Action**\nThe problem is valid as it is scientifically grounded, well-posed, and objective. I will proceed with a full derivation of the solution.\n\n### Solution Derivation\n\nThe analysis of free vibrations of an elastic body using the Finite Element Method leads to the generalized eigenvalue problem:\n$$(\\mathbf{K} - \\omega^2 \\mathbf{M})\\mathbf{d} = \\mathbf{0}$$\nwhere $\\mathbf{K}$ is the global stiffness matrix, $\\mathbf{M}$ is the global mass matrix, $\\omega$ is the angular frequency of vibration, and $\\mathbf{d}$ is the vector of nodal displacement amplitudes.\n\n**1. Element Discretization and Shape Functions**\nThe bar of length $L$ is discretized into $2$ equal elements. The element length is $h_e = L/2$. The nodes are located at $x_1=0$, $x_2=L/2$, and $x_3=L$.\n\nFor a standard two-node linear element of length $h_e$, the axial displacement field $u(x)$ is interpolated from the nodal displacements $u_1$ and $u_2$ using linear shape functions $N_1(x)$ and $N_2(x)$. In a local coordinate system $\\xi \\in [-1, 1]$, the shape functions are:\n$$N_1(\\xi) = \\frac{1-\\xi}{2}, \\quad N_2(\\xi) = \\frac{1+\\xi}{2}$$\nThe relationship between the global coordinate $x$ (within the element, from $0$ to $h_e$) and the local coordinate $\\xi$ is $x = \\frac{h_e}{2}(1+\\xi)$, which gives $dx = \\frac{h_e}{2}d\\xi$. The derivative operator transforms as $\\frac{d}{dx} = \\frac{d\\xi}{dx}\\frac{d}{d\\xi} = \\frac{2}{h_e}\\frac{d}{d\\xi}$.\n\n**2. Element Stiffness Matrix**\nThe element stiffness matrix $\\mathbf{k}^e$ is given by:\n$$k^e_{ij} = \\int_{0}^{h_e} E A \\frac{dN_i}{dx}\\frac{dN_j}{dx} dx$$\nThe derivatives of the shape functions with respect to $x$ are:\n$$\\frac{dN_1}{dx} = -\\frac{1}{h_e}, \\quad \\frac{dN_2}{dx} = \\frac{1}{h_e}$$\nIntegrating gives the well-known stiffness matrix for a 1D bar element:\n$$\\mathbf{k}^e = E A \\int_{0}^{h_e} \\begin{pmatrix} (-1/h_e)^2  (-1/h_e)(1/h_e) \\\\ (1/h_e)(-1/h_e)  (1/h_e)^2 \\end{pmatrix} dx = \\frac{EA}{h_e} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$$\nSince $h_e = L/2$, the element stiffness matrix for both elements is:\n$$\\mathbf{k}^e = \\frac{2EA}{L} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$$\n\n**3. Element Consistent Mass Matrix**\nThe element consistent mass matrix $\\mathbf{m}^e_{\\text{cons}}$ is given by:\n$$m^e_{\\text{cons}, ij} = \\int_{0}^{h_e} \\rho A N_i(x) N_j(x) dx = \\int_{-1}^{1} \\rho A N_i(\\xi) N_j(\\xi) \\frac{h_e}{2} d\\xi$$\nThe integrals evaluate to:\n$$\\int_{-1}^{1} N_1^2(\\xi) \\frac{h_e}{2} d\\xi = \\frac{h_e}{2} \\int_{-1}^{1} \\left(\\frac{1-\\xi}{2}\\right)^2 d\\xi = \\frac{h_e}{3}$$\n$$\\int_{-1}^{1} N_1(\\xi) N_2(\\xi) \\frac{h_e}{2} d\\xi = \\frac{h_e}{2} \\int_{-1}^{1} \\frac{1-\\xi^2}{4} d\\xi = \\frac{h_e}{6}$$\nThus, the element consistent mass matrix is:\n$$\\mathbf{m}^e_{\\text{cons}} = \\frac{\\rho A h_e}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}$$\nWith $h_e = L/2$, this becomes:\n$$\\mathbf{m}^e_{\\text{cons}} = \\frac{\\rho A L}{12} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}$$\n\n**4. Element Lumped Mass Matrix**\nThe lumped mass matrix is typically formed by distributing the total element mass, $M_e = \\rho A h_e$, to the nodes. A common method, row-sum lumping, involves summing the entries of each row of the consistent mass matrix and placing the result on the corresponding diagonal entry.\n$$m^e_{\\text{lump}, ii} = \\sum_{j} m^e_{\\text{cons}, ij}$$\nSum of row 1: $\\frac{\\rho A h_e}{6} (2+1) = \\frac{\\rho A h_e}{2}$.\nSum of row 2: $\\frac{\\rho A h_e}{6} (1+2) = \\frac{\\rho A h_e}{2}$.\nThis gives a diagonal matrix:\n$$\\mathbf{m}^e_{\\text{lump}} = \\frac{\\rho A h_e}{2} \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$$\nWith $h_e = L/2$, this becomes:\n$$\\mathbf{m}^e_{\\text{lump}} = \\frac{\\rho A L}{4} \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$$\n\n**5. Assembly of Global Matrices**\nThe global matrices are assembled by summing the contributions from element $1$ (connecting nodes $1$ and $2$) and element $2$ (connecting nodes $2$ and $3$). The global system has $3$ degrees of freedom ($u_1, u_2, u_3$).\n\nGlobal Stiffness Matrix $\\mathbf{K}$:\n$$\\mathbf{K} = \\frac{2EA}{L} \\begin{pmatrix} 1  -1  0 \\\\ -1  1+1  -1 \\\\ 0  -1  1 \\end{pmatrix} = \\frac{2EA}{L} \\begin{pmatrix} 1  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1 \\end{pmatrix}$$\nGlobal Consistent Mass Matrix $\\mathbf{M}_{\\text{cons}}$:\n$$\\mathbf{M}_{\\text{cons}} = \\frac{\\rho AL}{12} \\begin{pmatrix} 2  1  0 \\\\ 1  2+2  1 \\\\ 0  1  2 \\end{pmatrix} = \\frac{\\rho AL}{12} \\begin{pmatrix} 2  1  0 \\\\ 1  4  1 \\\\ 0  1  2 \\end{pmatrix}$$\nGlobal Lumped Mass Matrix $\\mathbf{M}_{\\text{lump}}$:\n$$\\mathbf{M}_{\\text{lump}} = \\frac{\\rho AL}{4} \\begin{pmatrix} 1  0  0 \\\\ 0  1+1  0 \\\\ 0  0  1 \\end{pmatrix} = \\frac{\\rho AL}{4} \\begin{pmatrix} 1  0  0 \\\\ 0  2  0 \\\\ 0  0  1 \\end{pmatrix}$$\n\n**6. Application of Boundary Condition**\nThe essential boundary condition $u(0,t)=0$ corresponds to $u_1=0$. This is imposed by removing the first row and first column from the global matrices. The remaining degrees of freedom are $u_2$ and $u_3$.\n\nReduced Stiffness Matrix $\\mathbf{K}_{\\text{red}}$:\n$$\\mathbf{K}_{\\text{red}} = \\frac{2EA}{L} \\begin{pmatrix} 2  -1 \\\\ -1  1 \\end{pmatrix}$$\nReduced Consistent Mass Matrix $\\mathbf{M}_{\\text{cons,red}}$:\n$$\\mathbf{M}_{\\text{cons,red}} = \\frac{\\rho AL}{12} \\begin{pmatrix} 4  1 \\\\ 1  2 \\end{pmatrix}$$\nReduced Lumped Mass Matrix $\\mathbf{M}_{\\text{lump,red}}$:\n$$\\mathbf{M}_{\\text{lump,red}} = \\frac{\\rho AL}{4} \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix}$$\n\n**7. Solution of Eigenvalue Problems**\nWe must now solve the reduced eigenvalue problem $\\det(\\mathbf{K}_{\\text{red}} - \\omega^2 \\mathbf{M}_{\\text{red}}) = 0$ for both mass matrix formulations. Let $\\lambda = \\omega^2$.\n\n**Case A: Consistent Mass**\nThe eigenproblem is $\\det(\\mathbf{K}_{\\text{red}} - \\lambda_{\\text{cons}} \\mathbf{M}_{\\text{cons,red}}) = 0$.\n$$\\det\\left( \\frac{2EA}{L} \\begin{pmatrix} 2  -1 \\\\ -1  1 \\end{pmatrix} - \\lambda_{\\text{cons}} \\frac{\\rho AL}{12} \\begin{pmatrix} 4  1 \\\\ 1  2 \\end{pmatrix} \\right) = 0$$\nLet $\\alpha = \\frac{2EA}{L}$ and $\\beta_c = \\frac{\\rho AL}{12}$.\n$$\\det \\begin{pmatrix} 2\\alpha - 4\\lambda_{\\text{cons}}\\beta_c  -\\alpha - \\lambda_{\\text{cons}}\\beta_c \\\\ -\\alpha - \\lambda_{\\text{cons}}\\beta_c  \\alpha - 2\\lambda_{\\text{cons}}\\beta_c \\end{pmatrix} = 0$$\n$$(2\\alpha - 4\\lambda_{\\text{cons}}\\beta_c)(\\alpha - 2\\lambda_{\\text{cons}}\\beta_c) - (-\\alpha - \\lambda_{\\text{cons}}\\beta_c)^2 = 0$$\n$$(2\\alpha^2 - 8\\alpha\\beta_c\\lambda_{\\text{cons}} + 8\\beta_c^2\\lambda_{\\text{cons}}^2) - (\\alpha^2 + 2\\alpha\\beta_c\\lambda_{\\text{cons}} + \\beta_c^2\\lambda_{\\text{cons}}^2) = 0$$\n$$7\\beta_c^2\\lambda_{\\text{cons}}^2 - 10\\alpha\\beta_c\\lambda_{\\text{cons}} + \\alpha^2 = 0$$\nThe roots for $\\lambda_{\\text{cons}}$ are:\n$$\\lambda_{\\text{cons}} = \\frac{10\\alpha\\beta_c \\pm \\sqrt{100\\alpha^2\\beta_c^2 - 4(7\\beta_c^2)(\\alpha^2)}}{14\\beta_c^2} = \\frac{\\alpha}{\\beta_c} \\frac{10 \\pm \\sqrt{72}}{14} = \\frac{\\alpha}{\\beta_c} \\frac{10 \\pm 6\\sqrt{2}}{14} = \\frac{\\alpha}{\\beta_c} \\frac{5 \\pm 3\\sqrt{2}}{7}$$\nThe fundamental frequency corresponds to the smaller eigenvalue:\n$$\\omega_{\\text{cons}}^2 = \\lambda_{\\text{cons,min}} = \\frac{\\alpha}{\\beta_c} \\frac{5 - 3\\sqrt{2}}{7} = \\frac{2EA/L}{\\rho AL/12} \\frac{5 - 3\\sqrt{2}}{7} = \\frac{24E}{\\rho L^2} \\frac{5 - 3\\sqrt{2}}{7}$$\n\n**Case B: Lumped Mass**\nThe eigenproblem is $\\det(\\mathbf{K}_{\\text{red}} - \\lambda_{\\text{lump}} \\mathbf{M}_{\\text{lump,red}}) = 0$.\n$$\\det\\left( \\frac{2EA}{L} \\begin{pmatrix} 2  -1 \\\\ -1  1 \\end{pmatrix} - \\lambda_{\\text{lump}} \\frac{\\rho AL}{4} \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix} \\right) = 0$$\nLet $\\beta_l = \\frac{\\rho AL}{4}$.\n$$\\det \\begin{pmatrix} 2\\alpha - 2\\lambda_{\\text{lump}}\\beta_l  -\\alpha \\\\ -\\alpha  \\alpha - \\lambda_{\\text{lump}}\\beta_l \\end{pmatrix} = 0$$\n$$(2\\alpha - 2\\lambda_{\\text{lump}}\\beta_l)(\\alpha - \\lambda_{\\text{lump}}\\beta_l) - \\alpha^2 = 0$$\n$$2\\alpha^2 - 4\\alpha\\beta_l\\lambda_{\\text{lump}} + 2\\beta_l^2\\lambda_{\\text{lump}}^2 - \\alpha^2 = 0$$\n$$2\\beta_l^2\\lambda_{\\text{lump}}^2 - 4\\alpha\\beta_l\\lambda_{\\text{lump}} + \\alpha^2 = 0$$\nThe roots for $\\lambda_{\\text{lump}}$ are:\n$$\\lambda_{\\text{lump}} = \\frac{4\\alpha\\beta_l \\pm \\sqrt{16\\alpha^2\\beta_l^2 - 4(2\\beta_l^2)(\\alpha^2)}}{4\\beta_l^2} = \\frac{\\alpha}{\\beta_l} \\frac{4 \\pm \\sqrt{8}}{4} = \\frac{\\alpha}{\\beta_l} \\frac{4 \\pm 2\\sqrt{2}}{4} = \\frac{\\alpha}{\\beta_l} \\frac{2 \\pm \\sqrt{2}}{2}$$\nThe fundamental frequency corresponds to the smaller eigenvalue:\n$$\\omega_{\\text{lump}}^2 = \\lambda_{\\text{lump,min}} = \\frac{\\alpha}{\\beta_l} \\frac{2 - \\sqrt{2}}{2} = \\frac{2EA/L}{\\rho AL/4} \\frac{2 - \\sqrt{2}}{2} = \\frac{8E}{\\rho L^2} \\frac{2 - \\sqrt{2}}{2} = \\frac{4E}{\\rho L^2} (2 - \\sqrt{2})$$\n\n**8. Computation of the Ratio R**\nThe required ratio is $R = \\frac{\\omega_{\\text{cons}}}{\\omega_{\\text{lump}}}$. It is simpler to first compute $R^2$.\n$$R^2 = \\frac{\\omega_{\\text{cons}}^2}{\\omega_{\\text{lump}}^2} = \\frac{\\frac{24E}{\\rho L^2} \\frac{5 - 3\\sqrt{2}}{7}}{\\frac{4E}{\\rho L^2} (2 - \\sqrt{2})} = \\frac{24}{4} \\frac{5 - 3\\sqrt{2}}{7(2 - \\sqrt{2})} = \\frac{6}{7} \\frac{5 - 3\\sqrt{2}}{2 - \\sqrt{2}}$$\nTo simplify the fraction, we rationalize the denominator:\n$$\\frac{5 - 3\\sqrt{2}}{2 - \\sqrt{2}} = \\frac{(5 - 3\\sqrt{2})(2 + \\sqrt{2})}{(2 - \\sqrt{2})(2 + \\sqrt{2})} = \\frac{10 + 5\\sqrt{2} - 6\\sqrt{2} - 3(2)}{4 - 2} = \\frac{4 - \\sqrt{2}}{2}$$\nSubstituting this back into the expression for $R^2$:\n$$R^2 = \\frac{6}{7} \\left( \\frac{4 - \\sqrt{2}}{2} \\right) = \\frac{3(4 - \\sqrt{2})}{7}$$\nFinally, taking the square root gives the ratio $R$:\n$$R = \\sqrt{\\frac{3(4 - \\sqrt{2})}{7}}$$\nThis is the exact, simplified, closed-form analytical expression for the ratio.", "answer": "$$\\boxed{\\sqrt{\\frac{3(4 - \\sqrt{2})}{7}}}$$", "id": "3551458"}, {"introduction": "Building on the 1D case, we now generalize our understanding to the three-dimensional elements that form the basis of most industrial simulations. This practice moves beyond direct calculation of frequencies to a more elegant theoretical comparison of four-node tetrahedral and eight-node hexahedral elements. You will explore their intrinsic inertial properties by analyzing the trace of their respective mass matrices, a quantity related to the kinetic energy represented at the nodes [@problem_id:3551408]. This exercise sharpens analytical skills and reveals fundamental differences in how these common element types distribute mass, highlighting the importance of element selection in dynamic analysis.", "problem": "Consider two three-dimensional finite elements used in the Finite Element Method (FEM) for structural dynamics: a four-node linear tetrahedron and an eight-node trilinear hexahedron. Each element occupies a physical domain with uniform mass density $\\rho$, and the discretized displacement field has $3$ translational degrees of freedom per node. The consistent mass matrix is defined by the kinetic energy of the continuum, $T = \\frac{1}{2}\\int_{\\Omega} \\rho \\, \\mathbf{v}(\\mathbf{x})^{\\mathsf{T}} \\mathbf{v}(\\mathbf{x}) \\, \\mathrm{d}V$, where $\\mathbf{v}(\\mathbf{x})$ is the velocity field obtained by interpolating nodal velocities with the element shape functions. The lumped mass matrix is defined by exact nodal row-sum (mass lumping by row-sum) from the consistent mass matrix for each element.\n\nFor the tetrahedral element, use the affine image of the reference tetrahedron with coordinates $(\\xi,\\eta,\\zeta)$ satisfying $\\xi \\ge 0$, $\\eta \\ge 0$, $\\zeta \\ge 0$, and $\\xi + \\eta + \\zeta \\le 1$, and shape functions\n$$\nN_1 = \\xi, \\quad N_2 = \\eta, \\quad N_3 = \\zeta, \\quad N_4 = 1 - \\xi - \\eta - \\zeta.\n$$\nAssume the geometric mapping to the physical element is affine with constant Jacobian determinant, so the physical volume $V_{\\text{tet}}$ equals this determinant times the reference volume.\n\nFor the hexahedral element, use the affine image of the reference cube with $(\\xi,\\eta,\\zeta) \\in [-1,1]^3$ and trilinear shape functions\n$$\nN_i(\\xi,\\eta,\\zeta) = \\frac{1}{8}(1 \\pm \\xi)(1 \\pm \\eta)(1 \\pm \\zeta),\n$$\nwhere the signs enumerate the eight corner nodes. Assume the geometric mapping to the physical element is affine with constant Jacobian determinant, so the physical volume $V_{\\text{hex}}$ equals this determinant times the reference volume.\n\nStarting from the kinetic energy definition and the finite element interpolation of the velocity field, derive the consistent mass matrix for each element as an integral of products of shape functions over the physical domain. Then obtain the lumped mass matrix for each element by exact nodal row-sum of the consistent mass matrix. For each element, compute the ratio\n$$\nR_{\\text{elem}} = \\frac{\\operatorname{tr}(\\mathbf{M}_{c}^{\\text{elem}})}{\\operatorname{tr}(\\mathbf{M}_{l}^{\\text{elem}})},\n$$\nwhere $\\operatorname{tr}(\\cdot)$ denotes the trace and $\\mathbf{M}_{c}^{\\text{elem}}$ and $\\mathbf{M}_{l}^{\\text{elem}}$ are the consistent and lumped element mass matrices, respectively. Finally, evaluate the dimensionless quantity\n$$\n\\mathcal{R} = \\frac{R_{\\text{tet}}}{R_{\\text{hex}}}\n$$\nfor the tetrahedral and hexahedral elements described above.\n\nExpress the final answer as a simplified rational number with no units.", "solution": "The problem requires the computation of a dimensionless ratio $\\mathcal{R}$ derived from the traces of consistent and lumped mass matrices for tetrahedral and hexahedral finite elements. We begin by establishing a general formula for the ratio $R_{\\text{elem}} = \\frac{\\operatorname{tr}(\\mathbf{M}_{c}^{\\text{elem}})}{\\operatorname{tr}(\\mathbf{M}_{l}^{\\text{elem}})}$ for a generic element.\n\nLet the element have $n$ nodes and $3$ translational degrees of freedom per node. The velocity field $\\mathbf{v}(\\mathbf{x})$ within the element domain $\\Omega$ is interpolated from the nodal velocities $\\mathbf{v}_i$ using shape functions $N_i(\\mathbf{x})$:\n$$\n\\mathbf{v}(\\mathbf{x}) = \\sum_{i=1}^{n} N_i(\\mathbf{x}) \\mathbf{v}_i\n$$\nwhere $\\mathbf{v}_i$ is the $3 \\times 1$ velocity vector for node $i$. The kinetic energy $T$ of the element is given by:\n$$\nT = \\frac{1}{2}\\int_{\\Omega} \\rho \\, \\mathbf{v}(\\mathbf{x})^{\\mathsf{T}} \\mathbf{v}(\\mathbf{x}) \\, \\mathrm{d}V = \\frac{1}{2} \\sum_{i=1}^{n} \\sum_{j=1}^{n} \\mathbf{v}_i^{\\mathsf{T}} \\left( \\int_{\\Omega} \\rho N_i N_j \\mathrm{d}V \\right) \\mathbf{I}_3 \\, \\mathbf{v}_j\n$$\nwhere $\\mathbf{I}_3$ is the $3 \\times 3$ identity matrix. This expression defines the element consistent mass matrix, $\\mathbf{M}_c^{\\text{elem}}$, as a $(3n) \\times (3n)$ matrix composed of $n \\times n$ blocks of size $3 \\times 3$. The $(i,j)$-th block is $(\\mathbf{M}_c)_{ij} = m_{ij} \\mathbf{I}_3$, where the scalar mass term $m_{ij}$ is:\n$$\nm_{ij} = \\int_{\\Omega} \\rho N_i(\\mathbf{x}) N_j(\\mathbf{x}) \\, \\mathrm{d}V\n$$\nThe trace of the consistent mass matrix, $\\operatorname{tr}(\\mathbf{M}_c^{\\text{elem}})$, is the sum of its diagonal elements. The diagonal blocks are $(\\mathbf{M}_c)_{ii} = m_{ii} \\mathbf{I}_3$.\n$$\n\\operatorname{tr}(\\mathbf{M}_c^{\\text{elem}}) = \\sum_{i=1}^{n} \\operatorname{tr}(m_{ii} \\mathbf{I}_3) = \\sum_{i=1}^{n} 3 m_{ii} = 3 \\sum_{i=1}^{n} \\int_{\\Omega} \\rho N_i^2 \\, \\mathrm{d}V\n$$\nThe lumped mass matrix, $\\mathbf{M}_l^{\\text{elem}}$, is obtained by the \"exact nodal row-sum\" method. This involves summing all entries in each nodal row of $\\mathbf{M}_c^{\\text{elem}}$ and placing the result on the corresponding diagonal entry, creating a diagonal matrix. For a system with multiple DOFs per node where the mass coupling is through a scalar matrix times an identity matrix, this simplifies to performing a row-sum on the scalar matrix $[m_{ij}]$ and constructing a block-diagonal lumped matrix. The lumped mass at node $i$ is $m_i^l = \\sum_{j=1}^{n} m_{ij}$. The lumped mass matrix is then block-diagonal with blocks $m_i^l \\mathbf{I}_3$.\nThe trace of the lumped mass matrix is:\n$$\n\\operatorname{tr}(\\mathbf{M}_l^{\\text{elem}}) = \\sum_{i=1}^{n} \\operatorname{tr}(m_i^l \\mathbf{I}_3) = \\sum_{i=1}^{n} 3 m_i^l = 3 \\sum_{i=1}^{n} \\sum_{j=1}^{n} m_{ij}\n$$\nThe sum can be simplified using the partition of unity property of shape functions, $\\sum_{k=1}^{n} N_k(\\mathbf{x}) = 1$:\n$$\n\\sum_{i=1}^{n} \\sum_{j=1}^{n} m_{ij} = \\sum_{i=1}^{n} \\sum_{j=1}^{n} \\int_{\\Omega} \\rho N_i N_j \\, \\mathrm{d}V = \\int_{\\Omega} \\rho \\left(\\sum_{i=1}^{n} N_i\\right) \\left(\\sum_{j=1}^{n} N_j\\right) \\mathrm{d}V = \\int_{\\Omega} \\rho (1)(1) \\, \\mathrm{d}V = \\rho V_{\\text{elem}} = M_{\\text{total}}\n$$\nwhere $V_{\\text{elem}}$ is the physical volume and $M_{\\text{total}}$ is the total mass of the element. Thus, the trace of the lumped mass matrix is simply $3$ times the total mass:\n$$\n\\operatorname{tr}(\\mathbf{M}_l^{\\text{elem}}) = 3 \\rho V_{\\text{elem}}\n$$\nThe ratio $R_{\\text{elem}}$ is therefore:\n$$\nR_{\\text{elem}} = \\frac{3 \\sum_{i=1}^{n} \\int_{\\Omega} \\rho N_i^2 \\, \\mathrm{d}V}{3 \\rho V_{\\text{elem}}} = \\frac{\\sum_{i=1}^{n} \\int_{\\Omega} N_i^2 \\, \\mathrm{d}V}{V_{\\text{elem}}}\n$$\nFor an element with an affine mapping from a reference domain $V_{\\text{ref}}$, the Jacobian determinant $|J|$ is constant, and we have $\\mathrm{d}V = |J| \\mathrm{d}V_{\\text{ref}}$ and $V_{\\text{elem}} = |J| V_{\\text{ref}}$. The ratio simplifies to an expression dependent only on the reference element:\n$$\nR_{\\text{elem}} = \\frac{\\sum_{i=1}^{n} \\int_{V_{\\text{ref}}} N_i^2 |J| \\, \\mathrm{d}V_{\\text{ref}}}{|J| V_{\\text{ref}}} = \\frac{\\sum_{i=1}^{n} \\int_{V_{\\text{ref}}} N_i^2 \\, \\mathrm{d}V_{\\text{ref}}}{V_{\\text{ref}}}\n$$\nWe now apply this general formula to the two specified elements.\n\n**1. Four-Node Tetrahedral Element ($R_{\\text{tet}}$)**\nThe reference element is a standard tetrahedron with vertices at $(0,0,0)$, $(1,0,0)$, $(0,1,0)$, and $(0,0,1)$ in the $(\\xi, \\eta, \\zeta)$ coordinate system. Its volume is $V_{\\text{ref, tet}} = \\frac{1}{6}$. The shape functions are the barycentric coordinates: $N_1 = \\xi$, $N_2 = \\eta$, $N_3 = \\zeta$, and $N_4 = 1 - \\xi - \\eta - \\zeta$.\nWe need to compute the integrals $\\int_{V_{\\text{ref, tet}}} N_i^2 \\, \\mathrm{d}V_{\\text{ref}}$. The standard integration formula for monomials over this reference tetrahedron is:\n$$\n\\int_{V_{\\text{ref, tet}}} \\xi^a \\eta^b \\zeta^c \\, \\mathrm{d}V_{\\text{ref}} = \\int_0^1 \\int_0^{1-\\xi} \\int_0^{1-\\xi-\\eta} \\xi^a \\eta^b \\zeta^c \\, \\mathrm{d}\\zeta \\mathrm{d}\\eta \\mathrm{d}\\xi = \\frac{a! b! c!}{(a+b+c+3)!}\n$$\nA more general formula for barycentric coordinates $L_i$ over a $d$-simplex of volume $V$ is $\\int_V \\prod L_i^{a_i} dV = V \\frac{d! \\prod a_i!}{(d+\\sum a_i)!}$. For our case, $d=3$.\nBy symmetry, the integral of $N_i^2$ is the same for all $i=1,2,3,4$. We compute for $N_1$:\n$$\n\\int_{V_{\\text{ref, tet}}} N_1^2 \\, \\mathrm{d}V_{\\text{ref}} = \\int_{V_{\\text{ref, tet}}} \\xi^2 \\, \\mathrm{d}V_{\\text{ref}} = \\frac{2! 0! 0!}{(2+0+0+3)!} = \\frac{2}{5!} = \\frac{2}{120} = \\frac{1}{60}\n$$\nThe sum of the integrals for the four nodes is:\n$$\n\\sum_{i=1}^{4} \\int_{V_{\\text{ref, tet}}} N_i^2 \\, \\mathrm{d}V_{\\text{ref}} = 4 \\times \\frac{1}{60} = \\frac{4}{60} = \\frac{1}{15}\n$$\nThe ratio for the tetrahedron is:\n$$\nR_{\\text{tet}} = \\frac{1/15}{V_{\\text{ref, tet}}} = \\frac{1/15}{1/6} = \\frac{6}{15} = \\frac{2}{5}\n$$\n\n**2. Eight-Node Hexahedral Element ($R_{\\text{hex}}$)**\nThe reference element is a cube defined by $(\\xi, \\eta, \\zeta) \\in [-1, 1]^3$. Its volume is $V_{\\text{ref, hex}} = 2^3 = 8$. The trilinear shape functions are of the form $N_i(\\xi, \\eta, \\zeta) = \\frac{1}{8}(1 \\pm \\xi)(1 \\pm \\eta)(1 \\pm \\zeta)$.\nBy symmetry, the integral $\\int_{V_{\\text{ref, hex}}} N_i^2 \\, \\mathrm{d}V_{\\text{ref}}$ is identical for all $8$ nodes. Let's compute it for the node at $(-1,-1,-1)$, for which $N_1 = \\frac{1}{8}(1-\\xi)(1-\\eta)(1-\\zeta)$.\n$$\n\\int_{V_{\\text{ref, hex}}} N_1^2 \\, \\mathrm{d}V_{\\text{ref}} = \\int_{-1}^1 \\int_{-1}^1 \\int_{-1}^1 \\left(\\frac{1}{8}(1-\\xi)(1-\\eta)(1-\\zeta)\\right)^2 \\, \\mathrm{d}\\xi \\mathrm{d}\\eta \\mathrm{d}\\zeta\n$$\n$$\n= \\frac{1}{64} \\left( \\int_{-1}^1 (1-\\xi)^2 \\, \\mathrm{d}\\xi \\right) \\left( \\int_{-1}^1 (1-\\eta)^2 \\, \\mathrm{d}\\eta \\right) \\left( \\int_{-1}^1 (1-\\zeta)^2 \\, \\mathrm{d}\\zeta \\right)\n$$\nWe evaluate one of these identical integrals:\n$$\n\\int_{-1}^1 (1-x)^2 \\, \\mathrm{d}x = \\left[ -\\frac{(1-x)^3}{3} \\right]_{-1}^1 = -\\frac{(1-1)^3}{3} - \\left(-\\frac{(1-(-1))^3}{3}\\right) = 0 + \\frac{2^3}{3} = \\frac{8}{3}\n$$\nSubstituting this back, we get:\n$$\n\\int_{V_{\\text{ref, hex}}} N_1^2 \\, \\mathrm{d}V_{\\text{ref}} = \\frac{1}{64} \\left(\\frac{8}{3}\\right)^3 = \\frac{1}{64} \\frac{512}{27} = \\frac{8}{27}\n$$\nThe sum of the integrals for all $8$ nodes is:\n$$\n\\sum_{i=1}^{8} \\int_{V_{\\text{ref, hex}}} N_i^2 \\, \\mathrm{d}V_{\\text{ref}} = 8 \\times \\frac{8}{27} = \\frac{64}{27}\n$$\nThe ratio for the hexahedron is:\n$$\nR_{\\text{hex}} = \\frac{64/27}{V_{\\text{ref, hex}}} = \\frac{64/27}{8} = \\frac{8}{27}\n$$\n\n**3. Final Ratio ($\\mathcal{R}$)**\nFinally, we compute the required ratio $\\mathcal{R}$:\n$$\n\\mathcal{R} = \\frac{R_{\\text{tet}}}{R_{\\text{hex}}} = \\frac{2/5}{8/27} = \\frac{2}{5} \\times \\frac{27}{8} = \\frac{1}{5} \\times \\frac{27}{4} = \\frac{27}{20}\n$$", "answer": "$$\\boxed{\\frac{27}{20}}$$", "id": "3551408"}, {"introduction": "Our final practice bridges theory and application by tackling a more realistic computational scenario: the free vibration of a 3D cantilever beam with non-uniform material properties. This problem requires not only a practical FEM implementation but also an engagement with the formal theory of numerical error analysis. You will implement both consistent and lumped mass formulations to compute the vibration spectrum and then connect the observed frequency differences to a rigorous error bound derived from matrix perturbation theory [@problem_id:3551420]. By testing various density distributions, you will develop an intuition for how material heterogeneity impacts the accuracy of mass lumping and learn to quantify the approximation error using a powerful, computable metric.", "problem": "Consider the free vibration of a three-dimensional elastic solid discretized by eight-node hexahedral finite elements under the Finite Element Method (FEM). The governing equation for small-amplitude linear elastodynamics is derived from Newton’s Second Law and the Cauchy momentum balance. In the absence of external body forces, the strong form is given by\n$$\n\\rho(\\mathbf{x}) \\, \\ddot{\\mathbf{u}}(\\mathbf{x},t) = \\nabla \\cdot \\boldsymbol{\\sigma}(\\mathbf{x},t) \\quad \\text{in} \\quad \\Omega ,\n$$\nwith the linear elastic constitutive relation\n$$\n\\boldsymbol{\\sigma}(\\mathbf{x},t) = \\mathbf{C} : \\boldsymbol{\\varepsilon}(\\mathbf{x},t), \\quad \\boldsymbol{\\varepsilon}(\\mathbf{x},t) = \\frac{1}{2}\\left(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\top}\\right) ,\n$$\nwhere $\\rho(\\mathbf{x})$ is the mass density field, $\\mathbf{u}(\\mathbf{x},t)$ is the displacement, $\\boldsymbol{\\varepsilon}$ is the small strain tensor, $\\boldsymbol{\\sigma}$ is the Cauchy stress tensor, and $\\mathbf{C}$ is the fourth-order Hooke tensor for isotropic materials with Young’s modulus $E$ and Poisson’s ratio $\\nu$. The weak form, using the Principle of Virtual Work, leads to the semi-discrete FEM equations\n$$\n\\mathbf{M}\\, \\ddot{\\mathbf{d}}(t) + \\mathbf{K}\\,\\mathbf{d}(t) = \\mathbf{0},\n$$\nwhere $\\mathbf{d}(t)$ is the nodal displacement vector in $\\mathbb{R}^{n}$, $\\mathbf{K} \\in \\mathbb{R}^{n \\times n}$ is the symmetric positive-definite stiffness matrix, and $\\mathbf{M} \\in \\mathbb{R}^{n \\times n}$ is the symmetric positive-definite mass matrix. Free vibration modes satisfy the generalized eigenvalue problem\n$$\n\\mathbf{K} \\, \\boldsymbol{\\phi}_i = \\omega_i^2 \\, \\mathbf{M} \\, \\boldsymbol{\\phi}_i ,\n$$\nwhere $\\omega_i$ are the natural circular frequencies and $\\boldsymbol{\\phi}_i$ are the mode shapes.\n\nIn FEM with eight-node hexahedral elements and linear interpolation functions, the consistent mass matrix $\\mathbf{M}_c$ is defined by\n$$\n(\\mathbf{M}_c)_{IJ} = \\int_{\\Omega} \\rho(\\mathbf{x}) \\, \\mathbf{N}_I(\\mathbf{x})^{\\top} \\mathbf{N}_J(\\mathbf{x}) \\, \\mathrm{d}\\Omega ,\n$$\nwith $\\mathbf{N}_I(\\mathbf{x}) \\in \\mathbb{R}^{3 \\times 3}$ denoting the block-diagonal vector-valued shape function matrix for node $I$. The row-sum lumped mass matrix $\\mathbf{M}_{\\ell}$ is defined by taking the row sums of $\\mathbf{M}_c$ onto the diagonal, that is\n$$\n(\\mathbf{M}_{\\ell})_{II} = \\sum_{J=1}^{n} (\\mathbf{M}_c)_{IJ}, \\quad (\\mathbf{M}_{\\ell})_{IJ} = 0 \\ \\text{for} \\ I \\neq J.\n$$\n\nTask A (derivation): Starting from the weak form and the definitions above, derive a condition on the density field $\\rho(\\mathbf{x})$ that guarantees that the first $k$ natural frequencies computed with $\\mathbf{M}_c$ and with $\\mathbf{M}_{\\ell}$ remain within a specified relative tolerance $\\tau \\in (0,1)$; that is,\n$$\n\\max_{1 \\le i \\le k} \\frac{|\\omega_i^{(\\ell)} - \\omega_i^{(c)}|}{\\omega_i^{(c)}} \\le \\tau .\n$$\nYour condition must be stated in terms of a computable bound involving the perturbation $\\Delta \\mathbf{M} := \\mathbf{M}_{\\ell} - \\mathbf{M}_c$ and quantities derived from $\\rho(\\mathbf{x})$, the shape functions, and the mesh geometry. You may use standard symmetric matrix perturbation results for generalized eigenvalue problems as part of your derivation, provided you clearly identify all assumptions. Express any bound using norms that are standard and computable on the discrete system. Do not use or assume any target formula for the answer; instead derive it from first principles and well-tested facts.\n\nTask B (computation and comparison): Implement a program that constructs and analyzes a three-dimensional rectangular block $\\Omega = [0,L_x] \\times [0,L_y] \\times [0,L_z]$ with $L_x = 1 \\ \\mathrm{m}$, $L_y = 0.1 \\ \\mathrm{m}$, $L_z = 0.1 \\ \\mathrm{m}$, discretized by a structured hexahedral mesh with $2 \\times 1 \\times 1$ eight-node elements. The material is linear elastic isotropic with $E = 70 \\times 10^9 \\ \\mathrm{Pa}$ and $\\nu = 0.34$. Impose homogeneous Dirichlet boundary conditions on the face at $x = 0 \\ \\mathrm{m}$ (fully clamped), and leave all other faces traction-free. Assemble the global stiffness matrix $\\mathbf{K}$ using standard $2 \\times 2 \\times 2$ Gauss quadrature. For the mass matrix, assemble:\n- the fully consistent mass matrix $\\mathbf{M}_c$ using the same quadrature, and\n- the row-sum lumped mass matrix $\\mathbf{M}_{\\ell}$ obtained by summing each row of $\\mathbf{M}_c$ onto its diagonal.\n\nFor each specified density field $\\rho(\\mathbf{x})$, solve the generalized symmetric eigenvalue problems for the first $k$ smallest positive frequencies using both $\\mathbf{M}_c$ and $\\mathbf{M}_{\\ell}$, and compute the relative errors of the first $k$ frequencies. Use the same $\\mathbf{K}$ for both. Frequencies are in radians per second, but you do not need to report them; only relative errors and boolean checks are required, so no unit reporting is needed.\n\nTask C (test suite and output): Use the following three density fields as the test suite, each expressed in $\\mathrm{kg/m^3}$:\n- Case $1$: piecewise constant per element with values $[7800, 7800]$.\n- Case $2$: piecewise constant per element with values $[7800, 8190]$.\n- Case $3$: piecewise constant per element with values $[7800, 19500]$.\n\nFor all cases use $k = 5$ and $\\tau = 0.08$ as the target tolerance. For each case, compute a boolean that is $true$ if and only if the first $k$ frequencies computed with $\\mathbf{M}_{\\ell}$ satisfy the tolerance condition relative to those computed with $\\mathbf{M}_c$, and $false$ otherwise. Additionally, ensure that your implementation computes the spectral-norm-based mass perturbation metric\n$$\n\\epsilon_M := \\left\\| \\mathbf{M}_c^{-1/2} \\, \\Delta \\mathbf{M} \\, \\mathbf{M}_c^{-1/2} \\right\\|_2 ,\n$$\ninternally (you do not need to print it), as it appears in your derivation for Task A.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[\\text{true},\\text{false},\\text{true}]$), corresponding to the three cases in the order listed above. The output values must be lowercase boolean literals $true$ or $false$.\n\nAll physical inputs must be treated in International System of Units (SI). Angles, if needed, must be in radians. Percentages must be expressed as decimals, not with a percentage sign. The final output must be exactly one line in the format specified and must not include any additional text.", "solution": "The comprehensive solution to this problem involves two main parts: a theoretical derivation of an error bound for mass lumping (Task A) and a computational implementation to verify this relationship for a specific engineering problem (Tasks B and C).\n\n### Part A: Derivation of the Frequency Error Bound\n\nThe objective of this task is to derive a condition on the material density field $\\rho(\\mathbf{x})$ that guarantees the natural frequencies computed with a lumped mass matrix ($\\mathbf{M}_{\\ell}$) remain within a specified relative tolerance $\\tau$ of those computed with the consistent mass matrix ($\\mathbf{M}_c$).\n\nThe free vibration analysis is described by the generalized eigenvalue problem:\n$$\n\\mathbf{K} \\boldsymbol{\\phi}_i = \\omega_i^2 \\mathbf{M} \\boldsymbol{\\phi}_i\n$$\nwhere $\\mathbf{K}$ is the stiffness matrix, $\\mathbf{M}$ is the mass matrix, $\\omega_i$ are the natural frequencies, and $\\boldsymbol{\\phi}_i$ are the mode shapes. Let $\\lambda_i = \\omega_i^2$. We have two distinct systems:\n1.  **Consistent System**: $\\mathbf{K} \\boldsymbol{\\phi}_i^{(c)} = \\lambda_i^{(c)} \\mathbf{M}_c \\boldsymbol{\\phi}_i^{(c)}$\n2.  **Lumped System**: $\\mathbf{K} \\boldsymbol{\\phi}_i^{(\\ell)} = \\lambda_i^{(\\ell)} \\mathbf{M}_{\\ell} \\boldsymbol{\\phi}_i^{(\\ell)}$\n\nHere, $\\mathbf{K}$ is symmetric positive semi-definite (positive definite on the space of admissible displacements after applying boundary conditions), and both $\\mathbf{M}_c$ and $\\mathbf{M}_{\\ell}$ are symmetric positive definite for a physically realistic system with positive density $\\rho(\\mathbf{x})  0$. The lumped mass matrix is related to the consistent one by $\\mathbf{M}_{\\ell} = \\mathbf{M}_c + \\Delta\\mathbf{M}$, where $\\Delta\\mathbf{M}$ is the perturbation matrix.\n\nTo analyze the effect of the perturbation $\\Delta\\mathbf{M}$, we can transform the generalized eigenvalue problems into a standard form. Since $\\mathbf{M}_c$ is symmetric and positive definite, it admits a Cholesky factorization $\\mathbf{M}_c = \\mathbf{L}\\mathbf{L}^{\\top}$, where $\\mathbf{L}$ is a lower triangular matrix. We may also use the matrix square root, $\\mathbf{M}_c^{1/2}$, which is also symmetric and positive definite. Let $\\mathbf{M}_c^{1/2}$ denote this matrix square root.\n\nApplying the transformation $\\boldsymbol{\\phi} = \\mathbf{M}_c^{-1/2} \\boldsymbol{\\psi}$ to the consistent system yields:\n$$\n\\mathbf{K} (\\mathbf{M}_c^{-1/2} \\boldsymbol{\\psi}_i^{(c)}) = \\lambda_i^{(c)} \\mathbf{M}_c (\\mathbf{M}_c^{-1/2} \\boldsymbol{\\psi}_i^{(c)})\n$$\nPremultiplying by $\\mathbf{M}_c^{-1/2}$ gives the standard symmetric eigenvalue problem:\n$$\n(\\mathbf{M}_c^{-1/2} \\mathbf{K} \\mathbf{M}_c^{-1/2}) \\boldsymbol{\\psi}_i^{(c)} = \\lambda_i^{(c)} \\boldsymbol{\\psi}_i^{(c)} \\implies \\tilde{\\mathbf{K}} \\boldsymbol{\\psi}_i^{(c)} = \\lambda_i^{(c)} \\boldsymbol{\\psi}_i^{(c)}\n$$\nwhere $\\tilde{\\mathbf{K}} = \\mathbf{M}_c^{-1/2} \\mathbf{K} \\mathbf{M}_c^{-1/2}$ is symmetric.\n\nApplying the same transformation to the lumped system:\n$$\n\\mathbf{K} (\\mathbf{M}_c^{-1/2} \\boldsymbol{\\psi}_i^{(\\ell)}) = \\lambda_i^{(\\ell)} (\\mathbf{M}_c + \\Delta\\mathbf{M}) (\\mathbf{M}_c^{-1/2} \\boldsymbol{\\psi}_i^{(\\ell)})\n$$\nPremultiplying by $\\mathbf{M}_c^{-1/2}$:\n$$\n\\tilde{\\mathbf{K}} \\boldsymbol{\\psi}_i^{(\\ell)} = \\lambda_i^{(\\ell)} (\\mathbf{M}_c^{-1/2}(\\mathbf{M}_c + \\Delta\\mathbf{M})\\mathbf{M}_c^{-1/2}) \\boldsymbol{\\psi}_i^{(\\ell)}\n$$\n$$\n\\tilde{\\mathbf{K}} \\boldsymbol{\\psi}_i^{(\\ell)} = \\lambda_i^{(\\ell)} (\\mathbf{I} + \\mathbf{M}_c^{-1/2} \\Delta\\mathbf{M} \\mathbf{M}_c^{-1/2}) \\boldsymbol{\\psi}_i^{(\\ell)}\n$$\nLet $\\Delta\\tilde{\\mathbf{M}} = \\mathbf{M}_c^{-1/2} \\Delta\\mathbf{M} \\mathbf{M}_c^{-1/2}$. The lumped system is equivalent to the generalized eigenvalue problem $\\tilde{\\mathbf{K}} \\boldsymbol{\\psi} = \\lambda_{\\ell} (\\mathbf{I} + \\Delta\\tilde{\\mathbf{M}}) \\boldsymbol{\\psi}$.\n\nThe Courant-Fischer min-max theorem provides a characterization of the eigenvalues. For the original pencils, the eigenvalues are given by the Rayleigh quotients:\n$$\n\\lambda_i^{(c)} = \\min_{\\text{dim}(S)=i} \\max_{\\mathbf{d} \\in S \\setminus \\{0\\}} \\frac{\\mathbf{d}^{\\top}\\mathbf{K}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}}\n\\quad \\text{and} \\quad\n\\lambda_i^{(\\ell)} = \\min_{\\text{dim}(S)=i} \\max_{\\mathbf{d} \\in S \\setminus \\{0\\}} \\frac{\\mathbf{d}^{\\top}\\mathbf{K}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_{\\ell}\\mathbf{d}}\n$$\nWe can relate the two Rayleigh quotients. Let's analyze the ratio of the denominators:\n$$\n\\frac{\\mathbf{d}^{\\top}\\mathbf{M}_{\\ell}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}} = \\frac{\\mathbf{d}^{\\top}(\\mathbf{M}_c + \\Delta\\mathbf{M})\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}} = 1 + \\frac{\\mathbf{d}^{\\top}\\Delta\\mathbf{M}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}}\n$$\nBy letting $\\mathbf{y} = \\mathbf{M}_c^{1/2}\\mathbf{d}$, the second term becomes the Rayleigh quotient of $\\Delta\\tilde{\\mathbf{M}}$:\n$$\n\\frac{\\mathbf{d}^{\\top}\\Delta\\mathbf{M}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}} = \\frac{(\\mathbf{M}_c^{-1/2}\\mathbf{y})^{\\top} \\Delta\\mathbf{M} (\\mathbf{M}_c^{-1/2}\\mathbf{y})}{(\\mathbf{M}_c^{-1/2}\\mathbf{y})^{\\top} \\mathbf{M}_c (\\mathbf{M}_c^{-1/2}\\mathbf{y})} = \\frac{\\mathbf{y}^{\\top}(\\mathbf{M}_c^{-1/2}\\Delta\\mathbf{M}\\mathbf{M}_c^{-1/2})\\mathbf{y}}{\\mathbf{y}^{\\top}\\mathbf{y}} = \\frac{\\mathbf{y}^{\\top}\\Delta\\tilde{\\mathbf{M}}\\mathbf{y}}{\\mathbf{y}^{\\top}\\mathbf{y}}\n$$\nThe values of this Rayleigh quotient are bounded by the minimum and maximum eigenvalues of $\\Delta\\tilde{\\mathbf{M}}$. Let $\\epsilon_M = \\|\\Delta\\tilde{\\mathbf{M}}\\|_2 = \\max(|\\lambda_{\\min}(\\Delta\\tilde{\\mathbf{M}})|, |\\lambda_{\\max}(\\Delta\\tilde{\\mathbf{M}})|)$. Then for any $\\mathbf{y} \\ne 0$:\n$$\n-\\epsilon_M \\le \\lambda_{\\min}(\\Delta\\tilde{\\mathbf{M}}) \\le \\frac{\\mathbf{y}^{\\top}\\Delta\\tilde{\\mathbf{M}}\\mathbf{y}}{\\mathbf{y}^{\\top}\\mathbf{y}} \\le \\lambda_{\\max}(\\Delta\\tilde{\\mathbf{M}}) \\le \\epsilon_M\n$$\nThus, we have bounds on the ratio of the quadratic forms of the mass matrices:\n$$\n1 - \\epsilon_M \\le \\frac{\\mathbf{d}^{\\top}\\mathbf{M}_{\\ell}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}} \\le 1 + \\epsilon_M\n$$\nThis assumes $\\epsilon_M  1$ to ensure $\\mathbf{M}_{\\ell}$ remains positive definite. Taking the reciprocal:\n$$\n\\frac{1}{1 + \\epsilon_M} \\le \\frac{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_{\\ell}\\mathbf{d}} \\le \\frac{1}{1 - \\epsilon_M}\n$$\nNow, we can bound the Rayleigh quotient for the lumped system:\n$$\n\\frac{\\mathbf{d}^{\\top}\\mathbf{K}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_{\\ell}\\mathbf{d}} = \\left(\\frac{\\mathbf{d}^{\\top}\\mathbf{K}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}}\\right) \\left(\\frac{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_{\\ell}\\mathbf{d}}\\right)\n$$\nApplying the bounds:\n$$\n\\frac{1}{1 + \\epsilon_M} \\left(\\frac{\\mathbf{d}^{\\top}\\mathbf{K}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}}\\right) \\le \\frac{\\mathbf{d}^{\\top}\\mathbf{K}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_{\\ell}\\mathbf{d}} \\le \\frac{1}{1 - \\epsilon_M} \\left(\\frac{\\mathbf{d}^{\\top}\\mathbf{K}\\mathbf{d}}{\\mathbf{d}^{\\top}\\mathbf{M}_c\\mathbf{d}}\\right)\n$$\nBy applying the min-max theorem to this inequality (a result known as Ostrowski's theorem for congruent transformations), we obtain a bound on the eigenvalues:\n$$\n\\frac{1}{1 + \\epsilon_M} \\lambda_i^{(c)} \\le \\lambda_i^{(\\ell)} \\le \\frac{1}{1 - \\epsilon_M} \\lambda_i^{(c)}\n$$\nSince $\\omega_i = \\sqrt{\\lambda_i}$, we can bound the ratio of the natural frequencies:\n$$\n\\frac{1}{\\sqrt{1 + \\epsilon_M}} \\le \\frac{\\omega_i^{(\\ell)}}{\\omega_i^{(c)}} \\le \\frac{1}{\\sqrt{1 - \\epsilon_M}}\n$$\nThe relative error in the frequencies is $\\frac{|\\omega_i^{(\\ell)} - \\omega_i^{(c)}|}{\\omega_i^{(c)}} = \\left|\\frac{\\omega_i^{(\\ell)}}{\\omega_i^{(c)}} - 1\\right|$. The maximum value of this error is bounded by:\n$$\n\\max \\left( 1 - \\frac{1}{\\sqrt{1 + \\epsilon_M}}, \\frac{1}{\\sqrt{1 - \\epsilon_M}} - 1 \\right)\n$$\nFor $\\epsilon_M  0$, the second term is larger. Therefore, for all $i$:\n$$\n\\frac{|\\omega_i^{(\\ell)} - \\omega_i^{(c)}|}{\\omega_i^{(c)}} \\le \\frac{1}{\\sqrt{1 - \\epsilon_M}} - 1\n$$\nWe require this maximum relative error to be no more than a tolerance $\\tau$ for $i=1, \\dots, k$. A sufficient condition is:\n$$\n\\frac{1}{\\sqrt{1 - \\epsilon_M}} - 1 \\le \\tau\n$$\nSolving for $\\epsilon_M$:\n$$\n\\frac{1}{\\sqrt{1-\\epsilon_M}} \\le 1 + \\tau \\implies \\sqrt{1 - \\epsilon_M} \\ge \\frac{1}{1 + \\tau} \\implies 1 - \\epsilon_M \\ge \\frac{1}{(1+\\tau)^2}\n$$\n$$\n\\epsilon_M \\le 1 - \\frac{1}{(1+\\tau)^2} = \\frac{(1+\\tau)^2 - 1}{(1+\\tau)^2} = \\frac{1 + 2\\tau + \\tau^2 - 1}{(1+\\tau)^2} = \\frac{\\tau(2+\\tau)}{(1+\\tau)^2}\n$$\nThe final condition is that the density field $\\rho(\\mathbf{x})$, through its influence on the mass matrices, must satisfy:\n$$\n\\epsilon_M := \\left\\| \\mathbf{M}_c^{-1/2} (\\mathbf{M}_{\\ell} - \\mathbf{M}_c) \\mathbf{M}_c^{-1/2} \\right\\|_2 \\le \\frac{\\tau(2+\\tau)}{(1+\\tau)^2}\n$$\nThis condition links the physical property $\\rho(\\mathbf{x})$ (which determines $\\mathbf{M}_c$ and $\\mathbf{M}_{\\ell}$) to the accuracy of the computed frequencies. Spatial variations in $\\rho(\\mathbf{x})$ will alter the structure of $\\mathbf{M}_c$, thus changing $\\Delta\\mathbf{M}$ and the value of $\\epsilon_M$.\n\n### Part B  C: Computational Procedure and Analysis\n\nThe computational task requires implementing a Finite Element (FE) model to analyze the free vibrations of a 3D cantilever beam. The key steps are:\n1.  **Mesh and Geometry**: A structured mesh of $2 \\times 1 \\times 1$ eight-node hexahedral elements is created for the domain $\\Omega = [0, 1] \\times [0, 0.1] \\times [0, 0.1]$ meters. This results in $12$ unique nodes and $36$ degrees of freedom (DOFs) before applying boundary conditions.\n2.  **Element-level Computations**: For each element, the stiffness matrix $\\mathbf{k}^e$ and consistent mass matrix $\\mathbf{m}_c^e$ are computed using $2\\times2\\times2$ Gauss quadrature.\n    - The element stiffness matrix is $\\mathbf{k}^e = \\int_{V_e} \\mathbf{B}^{\\top}\\mathbf{D}\\mathbf{B} \\, \\mathrm{d}V$, where $\\mathbf{B}$ is the strain-displacement matrix and $\\mathbf{D}$ is the isotropic material constitutive matrix for $E=70 \\times 10^9$ Pa and $\\nu=0.34$.\n    - The element consistent mass matrix is $\\mathbf{m}_c^e = \\int_{V_e} \\rho_e \\mathbf{N}^{\\top}\\mathbf{N} \\, \\mathrm{d}V$, where $\\mathbf{N}$ is the matrix of vector shape functions and $\\rho_e$ is the element's density.\n3.  **Assembly**: The element matrices are assembled into global matrices $\\mathbf{K}$ and $\\mathbf{M}_c$ based on the element connectivity. Three distinct cases are considered by varying the densities of the two elements.\n4.  **Mass Lumping**: The global consistent mass matrix $\\mathbf{M}_c$ is used to compute the global lumped mass matrix $\\mathbf{M}_{\\ell}$ by summing the entries of each row and placing the sum on the corresponding diagonal entry.\n5.  **Boundary Conditions**: Homogeneous Dirichlet boundary conditions (clamped) are applied to the face at $x=0$. This involves fixing the $12$ DOFs associated with the $4$ nodes on this face. The system is then reduced to the $24$ free DOFs.\n6.  **Eigensystem Solution**: For each density case, the two generalized eigenvalue problems, $\\mathbf{K}_{red} \\boldsymbol{\\phi} = \\omega^2 \\mathbf{M}_{c,red} \\boldsymbol{\\phi}$ and $\\mathbf{K}_{red} \\boldsymbol{\\phi} = \\omega^2 \\mathbf{M}_{\\ell,red} \\boldsymbol{\\phi}$, are solved for the reduced (post-BC) matrices to obtain the sets of frequencies $\\{\\omega_i^{(c)}\\}$ and $\\{\\omega_i^{(\\ell)}\\}$.\n7.  **Error Analysis**: The first $k=5$ natural frequencies from both methods are compared. The maximum relative error is computed and checked against the tolerance $\\tau=0.08$. The result is a boolean `true` if the tolerance is met and `false` otherwise. The results for the three density cases are collected for the final output. The spectral perturbation norm $\\epsilon_M$ is also computed internally for each case as part of the analysis.\n\nThe following Python code implements this procedure.", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh, inv, sqrtm\n\ndef solve():\n    \"\"\"\n    Solves the FEM vibration problem for a 3D cantilever beam with different density distributions.\n    \"\"\"\n    # Problem Constants\n    Lx, Ly, Lz = 1.0, 0.1, 0.1\n    E = 70.0e9  # Pa\n    nu = 0.34\n    k = 5\n    tau = 0.08\n    \n    # Test cases: piecewise constant densities [rho_elem1, rho_elem2] in kg/m^3\n    test_cases = [\n        [7800.0, 7800.0],\n        [7800.0, 8190.0],\n        [7800.0, 19500.0]\n    ]\n\n    # Constitutive matrix for 3D isotropic material (Voigt notation)\n    c1 = E / ((1.0 + nu) * (1.0 - 2.0 * nu))\n    c2 = (1.0 - nu)\n    c3 = nu\n    c4 = (1.0 - 2.0 * nu) / 2.0\n    D_mat = c1 * np.array([\n        [c2, c3, c3, 0, 0, 0],\n        [c3, c2, c3, 0, 0, 0],\n        [c3, c3, c2, 0, 0, 0],\n        [0, 0, 0, c4, 0, 0],\n        [0, 0, 0, 0, c4, 0],\n        [0, 0, 0, 0, 0, c4]\n    ])\n\n    # Mesh definition for a 2x1x1 hexahedral grid\n    nx, ny, nz = 2, 1, 1\n    node_coords_x = np.linspace(0, Lx, nx + 1)\n    node_coords_y = np.linspace(0, Ly, ny + 1)\n    node_coords_z = np.linspace(0, Lz, nz + 1)\n    \n    nodes = []\n    for z in node_coords_z:\n        for y in node_coords_y:\n            for x in node_coords_x:\n                nodes.append([x, y, z])\n    nodes = np.array(nodes) # 12 nodes total\n\n    # Element connectivity (0-based node indices)\n    # Standard hex element node ordering\n    connectivity = []\n    for i in range(nx):\n        for j in range(ny):\n            for k_ in range(nz):\n                n0 = k_ * (nx + 1) * (ny + 1) + j * (nx + 1) + i\n                n1 = n0 + 1\n                n2 = n0 + (nx + 1)\n                n3 = n1 + (nx + 1)\n                \n                connectivity.append([n0, n1, n3, n2, n0+(nx+1)*(ny+1), n1+(nx+1)*(ny+1), n3+(nx+1)*(ny+1), n2+(nx+1)*(ny+1)])\n\n    # 8-node hexahedron shape functions and their derivatives in parent coordinates\n    def shape_functions(xi, eta, zeta):\n        N = 0.125 * np.array([\n            (1 - xi) * (1 - eta) * (1 - zeta),\n            (1 + xi) * (1 - eta) * (1 - zeta),\n            (1 + xi) * (1 + eta) * (1 - zeta),\n            (1 - xi) * (1 + eta) * (1 - zeta),\n            (1 - xi) * (1 - eta) * (1 + zeta),\n            (1 + xi) * (1 - eta) * (1 + zeta),\n            (1 + xi) * (1 + eta) * (1 + zeta),\n            (1 - xi) * (1 + eta) * (1 + zeta)\n        ])\n        return N\n\n    def shape_function_derivatives(xi, eta, zeta):\n        dNdxi = 0.125 * np.array([\n            [-(1 - eta) * (1 - zeta), (1 - eta) * (1 - zeta), (1 + eta) * (1 - zeta), -(1 + eta) * (1 - zeta), -(1 - eta) * (1 + zeta), (1 - eta) * (1 + zeta), (1 + eta) * (1 + zeta), -(1 + eta) * (1 + zeta)],\n            [-(1 - xi) * (1 - zeta), -(1 + xi) * (1 - zeta), (1 + xi) * (1 - zeta), (1 - xi) * (1 - zeta), -(1 - xi) * (1 + zeta), -(1 + xi) * (1 + zeta), (1 + xi) * (1 + zeta), (1 - xi) * (1 + zeta)],\n            [-(1 - xi) * (1 - eta), -(1 + xi) * (1 - eta), -(1 + xi) * (1 + eta), -(1 - xi) * (1 + eta), (1 - xi) * (1 - eta), (1 + xi) * (1 - eta), (1 + xi) * (1 + eta), (1 - xi) * (1 + eta)]\n        ])\n        return dNdxi\n\n    # Gauss quadrature points and weights for 2x2x2\n    gp_val = 1.0 / np.sqrt(3.0)\n    gauss_points = [\n        (-gp_val, -gp_val, -gp_val), (gp_val, -gp_val, -gp_val), (gp_val, gp_val, -gp_val), (-gp_val, gp_val, -gp_val),\n        (-gp_val, -gp_val, gp_val), (gp_val, -gp_val, gp_val), (gp_val, gp_val, gp_val), (-gp_val, gp_val, gp_val)\n    ]\n    gauss_weights = [1.0] * 8\n\n    # Main loop over test cases\n    boolean_results = []\n    for densities in test_cases:\n        num_nodes = len(nodes)\n        num_dofs = num_nodes * 3\n        K_global = np.zeros((num_dofs, num_dofs))\n        Mc_global = np.zeros((num_dofs, num_dofs))\n\n        # Assemble global matrices\n        for elem_idx, elem_nodes in enumerate(connectivity):\n            rho_elem = densities[elem_idx]\n            elem_coords = nodes[elem_nodes]\n            Ke_local = np.zeros((24, 24))\n            Mce_local = np.zeros((24, 24))\n\n            for i in range(len(gauss_points)):\n                xi, eta, zeta = gauss_points[i]\n                weight = gauss_weights[i]\n\n                N_vals = shape_functions(xi, eta, zeta)\n                dNdxi_vals = shape_function_derivatives(xi, eta, zeta)\n                \n                J = np.dot(dNdxi_vals, elem_coords)\n                detJ = np.linalg.det(J)\n                invJ = np.linalg.inv(J)\n                \n                dNdxyz = np.dot(invJ, dNdxi_vals)\n                \n                B_mat = np.zeros((6, 24))\n                N_mat = np.zeros((3, 24))\n                for node_idx in range(8):\n                    # B matrix\n                    B_mat[0, node_idx*3] = dNdxyz[0, node_idx]\n                    B_mat[1, node_idx*3+1] = dNdxyz[1, node_idx]\n                    B_mat[2, node_idx*3+2] = dNdxyz[2, node_idx]\n                    B_mat[3, node_idx*3] = dNdxyz[1, node_idx]\n                    B_mat[3, node_idx*3+1] = dNdxyz[0, node_idx]\n                    B_mat[4, node_idx*3+1] = dNdxyz[2, node_idx]\n                    B_mat[4, node_idx*3+2] = dNdxyz[1, node_idx]\n                    B_mat[5, node_idx*3] = dNdxyz[2, node_idx]\n                    B_mat[5, node_idx*3+2] = dNdxyz[0, node_idx]\n                    # N matrix\n                    N_mat[0, node_idx*3] = N_vals[node_idx]\n                    N_mat[1, node_idx*3+1] = N_vals[node_idx]\n                    N_mat[2, node_idx*3+2] = N_vals[node_idx]\n\n                Ke_local += B_mat.T @ D_mat @ B_mat * detJ * weight\n                Mce_local += rho_elem * N_mat.T @ N_mat * detJ * weight\n            \n            # Assemble into global matrices\n            dof_indices = []\n            for node in elem_nodes:\n                dof_indices.extend([3 * node, 3 * node + 1, 3 * node + 2])\n            \n            K_global[np.ix_(dof_indices, dof_indices)] += Ke_local\n            Mc_global[np.ix_(dof_indices, dof_indices)] += Mce_local\n\n        # Lumped mass matrix\n        Ml_global = np.diag(Mc_global.sum(axis=1))\n\n        # Apply Boundary Conditions (clamped at x=0)\n        clamped_nodes = np.where(nodes[:, 0] == 0.0)[0]\n        fixed_dofs = []\n        for node in clamped_nodes:\n            fixed_dofs.extend([3 * node, 3 * node + 1, 3 * node + 2])\n        \n        all_dofs = np.arange(num_dofs)\n        free_dofs = np.setdiff1d(all_dofs, fixed_dofs)\n\n        K_red = K_global[np.ix_(free_dofs, free_dofs)]\n        Mc_red = Mc_global[np.ix_(free_dofs, free_dofs)]\n        Ml_red = Ml_global[np.ix_(free_dofs, free_dofs)]\n\n        # Compute mass perturbation metric epsilon_M\n        delta_M_red = Ml_red - Mc_red\n        # Using eigh for robust matrix square root inverse\n        eigvals_mc, eigvecs_mc = eigh(Mc_red)\n        Mc_inv_sqrt = eigvecs_mc @ np.diag(1.0 / np.sqrt(eigvals_mc)) @ eigvecs_mc.T\n        \n        E_M_matrix = Mc_inv_sqrt @ delta_M_red @ Mc_inv_sqrt\n        epsilon_M = np.linalg.norm(E_M_matrix, 2)\n\n        # Solve eigenvalue problems\n        # Ensure eigenvalues are real and sorted. eigh handles this for symmetric definite pencils.\n        eigvals_c, _ = eigh(K_red, Mc_red)\n        eigvals_l, _ = eigh(K_red, Ml_red)\n        \n        # Frequencies are sqrt of eigenvalues. Get first k.\n        omega_c = np.sqrt(eigvals_c[:k])\n        omega_l = np.sqrt(eigvals_l[:k])\n        \n        # Calculate relative errors and check tolerance\n        rel_errors = np.abs(omega_l - omega_c) / omega_c\n        max_rel_error = np.max(rel_errors)\n        \n        boolean_results.append(str(max_rel_error = tau).lower())\n\n    # Print final results\n    print(f\"[{','.join(boolean_results)}]\")\n\nsolve()\n```", "id": "3551420"}]}