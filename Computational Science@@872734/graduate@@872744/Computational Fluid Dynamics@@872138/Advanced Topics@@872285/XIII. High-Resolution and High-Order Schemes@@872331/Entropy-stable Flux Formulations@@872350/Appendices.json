{"hands_on_practices": [{"introduction": "To build a solid foundation, we begin with the simplest non-trivial hyperbolic conservation law: the inviscid Burgers' equation. This first exercise guides you through the process of deriving an entropy-conservative numerical flux from first principles. By working through this scalar example ([@problem_id:3314692]), you will master the core algebraic condition that underpins entropy conservation, providing an essential theoretical stepping stone before tackling more complex systems of equations.", "problem": "Consider the scalar conservation law for the inviscid Burgers equation in one spatial dimension, $u_t + \\partial_x f(u) = 0$, with physical flux $f(u) = \\tfrac{1}{2} u^2$. Let $(U,F)$ be an entropy pair with entropy $U(u) = \\tfrac{1}{2} u^2$ and entropy flux $F(u)$ defined by the compatibility relation $\\dfrac{\\mathrm{d}F}{\\mathrm{d}u} = \\dfrac{\\mathrm{d}U}{\\mathrm{d}u} \\dfrac{\\mathrm{d}f}{\\mathrm{d}u}$. Define the entropy variables $v(u) = \\dfrac{\\mathrm{d}U}{\\mathrm{d}u}$. Consider a semi-discrete finite volume method using a two-point consistent and symmetric numerical flux $f^{*}(u_L,u_R)$ at a cell interface with left and right states $u_L$ and $u_R$.\n\nStarting from the definitions above and the requirement that the semi-discrete entropy balance obtained by multiplying the finite volume scheme by the entropy variables must telescope into a discrete conservation law for the entropy, derive the necessary two-point interface condition that $f^{*}(u_L,u_R)$ must satisfy to be entropy conservative. Then, specialize to the given $(U,f)$, construct the associated entropy flux $F(u)$ and entropy potential $\\psi(u) \\equiv v(u) f(u) - F(u)$, and compute a closed-form expression for an entropy-conservative numerical flux $f^{*}(u_L,u_R)$.\n\nGive your final answer as a single analytic expression in terms of $u_L$ and $u_R$. No numerical evaluation is required. Express the final result in simplest exact form without units.", "solution": "The problem is well-posed, scientifically grounded, and objective. It presents a standard derivation within the established theoretical framework of entropy-stable numerical methods for hyperbolic conservation laws. All terms are formally defined, and the premises are consistent with the principles of computational fluid dynamics. The problem is therefore valid.\n\nThe problem asks for two main results: first, the general condition for a two-point numerical flux to be entropy conservative, and second, the specific form of this flux for the inviscid Burgers' equation with a particular entropy pair.\n\n**Part 1: Derivation of the General Condition for Entropy Conservation**\n\nWe are given a scalar conservation law in one dimension:\n$$ \\frac{\\partial u}{\\partial t} + \\frac{\\partial f(u)}{\\partial x} = 0 $$\nA semi-discrete finite volume method approximates this equation on a grid with cells $i$ of width $\\Delta x$:\n$$ \\frac{\\mathrm{d}u_i}{\\mathrm{d}t} = -\\frac{1}{\\Delta x} \\left( f^{*}_{i+1/2} - f^{*}_{i-1/2} \\right) $$\nwhere $u_i(t)$ is the cell-averaged solution in cell $i$, and $f^{*}_{i+1/2} = f^{*}(u_i, u_{i+1})$ is the numerical flux at the interface between cells $i$ and $i+1$. The flux is assumed to be two-point, consistent ($f^{*}(u, u) = f(u)$), and symmetric ($f^{*}(u_L, u_R) = f^{*}(u_R, u_L)$).\n\nWe are given a convex entropy function $U(u)$ and a corresponding entropy flux $F(u)$ satisfying the compatibility relation $\\frac{\\mathrm{d}F}{\\mathrm{d}u} = \\frac{\\mathrm{d}U}{\\mathrm{d}u} \\frac{\\mathrm{d}f}{\\mathrm{d}u}$. The entropy variable is defined as $v(u) = \\frac{\\mathrm{d}U}{\\mathrm{d}u}$.\n\nTo derive the condition for entropy conservation, we examine the time evolution of the entropy in cell $i$, $U_i = U(u_i)$. Using the chain rule:\n$$ \\frac{\\mathrm{d}U_i}{\\mathrm{d}t} = \\frac{\\mathrm{d}U(u_i)}{\\mathrm{d}u_i} \\frac{\\mathrm{d}u_i}{\\mathrm{d}t} = v_i \\frac{\\mathrm{d}u_i}{\\mathrm{d}t} $$\nSubstituting the finite volume scheme:\n$$ \\frac{\\mathrm{d}U_i}{\\mathrm{d}t} = -\\frac{v_i}{\\Delta x} \\left( f^{*}_{i+1/2} - f^{*}_{i-1/2} \\right) $$\nA scheme is entropy conservative if this semi-discrete entropy equation can be written in a discrete conservation form:\n$$ \\frac{\\mathrm{d}U_i}{\\mathrm{d}t} = -\\frac{1}{\\Delta x} \\left( F^{*}_{i+1/2} - F^{*}_{i-1/2} \\right) $$\nfor some numerical entropy flux $F^{*}$. If this holds, the total entropy in the domain, $\\sum_i U_i \\Delta x$, is conserved (assuming periodic or appropriate boundary conditions), as the sum $\\sum_i (F^{*}_{i+1/2} - F^{*}_{i-1/2})$ telescopes to zero.\n\nTo find the condition on $f^{*}$ that guarantees this, we sum the entropy evolution over all cells in the domain:\n$$ \\frac{\\mathrm{d}}{\\mathrm{d}t} \\sum_i U_i \\Delta x = -\\sum_i v_i \\left( f^{*}_{i+1/2} - f^{*}_{i-1/2} \\right) $$\nUsing summation by parts on the right-hand side:\n$$ -\\sum_i v_i \\left( f^{*}_{i+1/2} - f^{*}_{i-1/2} \\right) = -\\left( \\sum_i v_i f^{*}_{i+1/2} - \\sum_i v_i f^{*}_{i-1/2} \\right) $$\nBy re-indexing the second sum (letting $j=i-1$), we get $\\sum_j v_{j+1} f^{*}_{j+1/2}$. Relabeling $j$ back to $i$:\n$$ = -\\left( \\sum_i v_i f^{*}_{i+1/2} - \\sum_i v_{i+1} f^{*}_{i+1/2} \\right) = \\sum_i \\left( v_{i+1} - v_i \\right) f^{*}_{i+1/2} $$\nFor the total entropy to be conserved, this sum must telescope to zero. This occurs if the term at each interface can be expressed as the difference of a potential. Let this interface term be written as:\n$$ (v_{i+1} - v_i) f^{*}(u_i, u_{i+1}) = \\Phi(u_{i+1}) - \\Phi(u_i) $$\nfor some function $\\Phi(u)$. To identify $\\Phi(u)$, we check for consistency. For a smooth solution where $u_{i+1} \\to u_i = u$, the condition becomes:\n$$ f^{*}(u, u) = \\lim_{u_{i+1} \\to u_i} \\frac{\\Phi(u_{i+1}) - \\Phi(u_i)}{v_{i+1} - v_i} = \\frac{\\mathrm{d}\\Phi/\\mathrm{d}u}{\\mathrm{d}v/\\mathrm{d}u} $$\nSince we require consistency, $f^{*}(u, u) = f(u)$, we must have $\\frac{\\mathrm{d}\\Phi}{\\mathrm{d}u} = f(u) \\frac{\\mathrm{d}v}{\\mathrm{d}u} = f(u) \\frac{\\mathrm{d}^2 U}{\\mathrm{d}u^2}$.\n\nLet's examine the derivative of the entropy potential $\\psi(u) \\equiv v(u)f(u) - F(u)$:\n$$ \\frac{\\mathrm{d}\\psi}{\\mathrm{d}u} = \\frac{\\mathrm{d}v}{\\mathrm{d}u}f(u) + v(u)\\frac{\\mathrm{d}f}{\\mathrm{d}u} - \\frac{\\mathrm{d}F}{\\mathrm{d}u} $$\nUsing the entropy compatibility relation $\\frac{\\mathrm{d}F}{\\mathrm{d}u} = v(u)\\frac{\\mathrm{d}f}{\\mathrm{d}u}$, this simplifies to:\n$$ \\frac{\\mathrm{d}\\psi}{\\mathrm{d}u} = \\frac{\\mathrm{d}v}{\\mathrm{d}u}f(u) = f(u) \\frac{\\mathrm{d}^2 U}{\\mathrm{d}u^2} $$\nThis matches the required derivative for $\\Phi(u)$. We can therefore identify $\\Phi(u)$ with $\\psi(u)$ (up to an arbitrary constant, which cancels in the difference). The condition for entropy conservation at the interface between states $u_L$ and $u_R$ is:\n$$ (v(u_R) - v(u_L)) f^{*}(u_L, u_R) = \\psi(u_R) - \\psi(u_L) $$\n\n**Part 2: Construction of the Entropy-Conservative Flux for Burgers' Equation**\n\nWe now apply this condition to the specific case given:\n- Physical flux: $f(u) = \\frac{1}{2} u^2$\n- Entropy function: $U(u) = \\frac{1}{2} u^2$\n\nFirst, we compute the necessary components: $v(u)$, $F(u)$, and $\\psi(u)$.\n\n1.  **Entropy variable $v(u)$**:\n    $$ v(u) = \\frac{\\mathrm{d}U}{\\mathrm{d}u} = \\frac{\\mathrm{d}}{\\mathrm{d}u}\\left(\\frac{1}{2} u^2\\right) = u $$\n\n2.  **Entropy flux $F(u)$**:\n    We use the compatibility relation $\\frac{\\mathrm{d}F}{\\mathrm{d}u} = \\frac{\\mathrm{d}U}{\\mathrm{d}u} \\frac{\\mathrm{d}f}{\\mathrm{d}u}$.\n    $$ \\frac{\\mathrm{d}f}{\\mathrm{d}u} = \\frac{\\mathrm{d}}{\\mathrm{d}u}\\left(\\frac{1}{2} u^2\\right) = u $$\n    $$ \\frac{\\mathrm{d}F}{\\mathrm{d}u} = (u)(u) = u^2 $$\n    Integrating with respect to $u$ (and setting the constant of integration to zero):\n    $$ F(u) = \\int u^2 \\, \\mathrm{d}u = \\frac{1}{3} u^3 $$\n\n3.  **Entropy potential $\\psi(u)$**:\n    $$ \\psi(u) = v(u)f(u) - F(u) = (u)\\left(\\frac{1}{2} u^2\\right) - \\left(\\frac{1}{3} u^3\\right) = \\frac{1}{2} u^3 - \\frac{1}{3} u^3 = \\frac{1}{6} u^3 $$\n\nNow, we substitute these expressions into the entropy conservation condition:\n$$ (v(u_R) - v(u_L)) f^{*}(u_L, u_R) = \\psi(u_R) - \\psi(u_L) $$\n$$ (u_R - u_L) f^{*}(u_L, u_R) = \\frac{1}{6} u_R^3 - \\frac{1}{6} u_L^3 $$\nFor $u_L \\neq u_R$, we can solve for $f^{*}(u_L, u_R)$:\n$$ f^{*}(u_L, u_R) = \\frac{1}{6} \\frac{u_R^3 - u_L^3}{u_R - u_L} $$\nUsing the algebraic identity for the difference of cubes, $a^3 - b^3 = (a-b)(a^2+ab+b^2)$:\n$$ f^{*}(u_L, u_R) = \\frac{1}{6} \\frac{(u_R - u_L)(u_R^2 + u_R u_L + u_L^2)}{u_R - u_L} $$\n$$ f^{*}(u_L, u_R) = \\frac{1}{6} (u_L^2 + u_L u_R + u_R^2) $$\nThis expression is the closed-form for the two-point entropy-conservative numerical flux for the given problem. It is symmetric in $u_L$ and $u_R$ and consistent, as $f^{*}(u, u) = \\frac{1}{6}(u^2+u^2+u^2) = \\frac{3}{6}u^2 = \\frac{1}{2}u^2 = f(u)$.", "answer": "$$\\boxed{\\frac{1}{6}(u_L^{2} + u_L u_R + u_R^{2})}$$", "id": "3314692"}, {"introduction": "Having mastered the scalar case, we now extend these principles to a system of equations—the one-dimensional compressible Euler equations. This practice introduces the challenges of vector-valued states and fluxes, requiring a more sophisticated approach to construct the numerical flux. You will implement a widely used entropy-conservative flux based on specific averaging techniques, such as the logarithmic mean, and numerically verify its correctness by confirming it satisfies Tadmor's identity ([@problem_id:3314744]). This exercise is crucial for bridging the gap between abstract theory and practical implementation for real gas dynamics.", "problem": "You are given the one-dimensional compressible Euler equations for an ideal gas with adiabatic index $\\gamma$, formulated in conservative variables $\\mathbf{U} = [\\rho, \\rho u, \\rho E]^{\\top}$, where $\\rho$ is density, $u$ is velocity, and $E$ is the specific total energy. The physical flux is $\\mathbf{f}(\\mathbf{U}) = [\\rho u, \\rho u^{2} + p, u(\\rho E + p)]^{\\top}$ and the equation of state is $p = (\\gamma - 1)\\left(\\rho E - \\frac{1}{2}\\rho u^{2}\\right)$.\n\nConsider the mathematical entropy pair defined by the entropy function $\\eta(\\mathbf{U}) = -\\frac{\\rho}{\\gamma - 1}\\,s$, with the thermodynamic entropy $s = \\ln(p) - \\gamma \\ln(\\rho)$, and the entropy flux $F(\\mathbf{U}) = u\\,\\eta(\\mathbf{U})$. The entropy variables are $\\mathbf{v} = \\frac{\\partial \\eta}{\\partial \\mathbf{U}}$. Tadmor’s identity for an entropy-conservative two-point numerical flux $\\mathbf{f}^{\\mathrm{ec}}(\\mathbf{U}_{L},\\mathbf{U}_{R})$ states that\n$$\n(\\mathbf{v}_{R} - \\mathbf{v}_{L}) \\cdot \\mathbf{f}^{\\mathrm{ec}}(\\mathbf{U}_{L},\\mathbf{U}_{R}) = \\psi(\\mathbf{U}_{R}) - \\psi(\\mathbf{U}_{L}),\n$$\nwhere the entropy potential is $\\psi(\\mathbf{U}) = \\mathbf{v}(\\mathbf{U}) \\cdot \\mathbf{f}(\\mathbf{U}) - F(\\mathbf{U})$.\n\nYour tasks are:\n\n- Starting from the above fundamental laws and core definitions, derive the explicit form of the entropy variables $\\mathbf{v}$ and the entropy potential $\\psi(\\mathbf{U})$ as functions of $(\\rho,u,p)$ and $\\gamma$.\n- Using a path argument consistent with Tadmor’s framework, construct an entropy-conservative flux $\\mathbf{f}^{\\mathrm{ec}}(\\mathbf{U}_{L},\\mathbf{U}_{R})$ that uses the arithmetic mean of the velocity,\n$$\n\\bar{u} = \\frac{u_{L} + u_{R}}{2},\n$$\nand the logarithmic means of density and pressure,\n$$\n\\rho^{\\log} = \\frac{\\rho_{R} - \\rho_{L}}{\\ln(\\rho_{R}) - \\ln(\\rho_{L})},\\quad p^{\\log} = \\frac{p_{R} - p_{L}}{\\ln(p_{R}) - \\ln(p_{L})},\n$$\nwith the convention that if the two arguments are equal, the logarithmic mean equals the common value.\n- Evaluate $\\mathbf{f}^{\\mathrm{ec}}(\\mathbf{U}_{L},\\mathbf{U}_{R})$ numerically for given left and right states $(\\rho_{L},u_{L},p_{L})$ and $(\\rho_{R},u_{R},p_{R})$, and verify Tadmor’s identity by computing both sides to machine precision. Specifically, compute the absolute residual\n$$\nr = \\left|(\\mathbf{v}_{R} - \\mathbf{v}_{L}) \\cdot \\mathbf{f}^{\\mathrm{ec}}(\\mathbf{U}_{L},\\mathbf{U}_{R}) - \\left(\\psi(\\mathbf{U}_{R}) - \\psi(\\mathbf{U}_{L})\\right)\\right|.\n$$\n\nUse nondimensional quantities, so no physical units are required. Angles do not appear, so no angle units are required.\n\nTest suite:\n\n- Case $1$ (general): $(\\rho_{L},u_{L},p_{L}) = (\\,1.2,\\,0.3,\\,1.0\\,)$ and $(\\rho_{R},u_{R},p_{R}) = (\\,0.8,\\,-0.2,\\,0.7\\,)$ with $\\gamma = 1.4$.\n- Case $2$ (equality): $(\\rho_{L},u_{L},p_{L}) = (\\,1.0,\\,0.0,\\,1.0\\,)$ and $(\\rho_{R},u_{R},p_{R}) = (\\,1.0,\\,0.0,\\,1.0\\,)$ with $\\gamma = 1.4$.\n- Case $3$ (extreme contrast): $(\\rho_{L},u_{L},p_{L}) = (\\,10^{-6},\\,100.0,\\,10^{-3}\\,)$ and $(\\rho_{R},u_{R},p_{R}) = (\\,10.0,\\,-50.0,\\,10^{2}\\,)$ with $\\gamma = 1.4$.\n\nYour program must compute the absolute residual $r$ for each case. The final output format must be a single line containing the three residuals as a comma-separated list enclosed in square brackets, for example $[r_1,r_2,r_3]$. Each $r_i$ must be printed as a floating-point number.", "solution": "The user-provided problem is a well-posed and scientifically grounded exercise in computational fluid dynamics, specifically addressing the construction and verification of an entropy-conservative numerical flux for the one-dimensional Euler equations. All provided definitions and equations are standard in the field. The problem is self-contained and free of contradictions. Therefore, a complete solution will be developed.\n\nThe solution proceeds in three stages:\n1.  Derivation of the explicit forms for the entropy variables $\\mathbf{v}$ and the entropy potential $\\psi$.\n2.  Construction of a candidate entropy-conservative numerical flux $\\mathbf{f}^{\\mathrm{ec}}$ based on the specified mean values.\n3.  Specification of the numerical procedure to verify Tadmor's identity for the constructed flux and the given test cases.\n\n### 1. Derivation of Entropy Variables and Entropy Potential\n\nThe conservative state vector is $\\mathbf{U} = [U_1, U_2, U_3]^{\\top} = [\\rho, \\rho u, \\rho E]^{\\top}$. The primitive variables $(\\rho, u, p)$ can be expressed in terms of the conservative variables:\n$\\rho = U_1$\n$u = U_2 / U_1$\n$p = (\\gamma-1)(U_3 - \\frac{1}{2} \\rho u^2) = (\\gamma-1)(U_3 - \\frac{1}{2} \\frac{U_2^2}{U_1})$\n\nThe entropy function is given as $\\eta(\\mathbf{U}) = -\\frac{\\rho}{\\gamma - 1}\\,s$, with the thermodynamic entropy $s = \\ln(p) - \\gamma \\ln(\\rho)$. Substituting the expressions for $\\rho$ and $p$ in terms of $\\mathbf{U}$, we have:\n$$\n\\eta(\\mathbf{U}) = -\\frac{U_1}{\\gamma-1} \\left[ \\ln\\left((\\gamma-1)\\left(U_3 - \\frac{U_2^2}{2U_1}\\right)\\right) - \\gamma \\ln(U_1) \\right]\n$$\n\nThe entropy variables $\\mathbf{v}$ are defined as the gradient of $\\eta$ with respect to $\\mathbf{U}$: $\\mathbf{v} = \\frac{\\partial \\eta}{\\partial \\mathbf{U}}$. We compute each component $v_i = \\frac{\\partial \\eta}{\\partial U_i}$ using the chain rule. For clarity, we will use the expression for $p$ in the derivatives.\n\n**Component $v_3 = \\frac{\\partial \\eta}{\\partial U_3}$:**\n$$\nv_3 = \\frac{\\partial}{\\partial U_3} \\left( -\\frac{U_1}{\\gamma-1} (\\ln p - \\gamma \\ln U_1) \\right) = -\\frac{U_1}{\\gamma-1} \\frac{\\partial(\\ln p)}{\\partial U_3} = -\\frac{U_1}{\\gamma-1} \\frac{1}{p} \\frac{\\partial p}{\\partial U_3}\n$$\nSince $\\frac{\\partial p}{\\partial U_3} = (\\gamma-1)$, we get:\n$$\nv_3 = -\\frac{U_1}{\\gamma-1} \\frac{1}{p} (\\gamma-1) = -\\frac{U_1}{p} = -\\frac{\\rho}{p}\n$$\n\n**Component $v_2 = \\frac{\\partial \\eta}{\\partial U_2}$:**\n$$\nv_2 = \\frac{\\partial}{\\partial U_2} \\left( -\\frac{U_1}{\\gamma-1} (\\ln p - \\gamma \\ln U_1) \\right) = -\\frac{U_1}{\\gamma-1} \\frac{1}{p} \\frac{\\partial p}{\\partial U_2}\n$$\nThe derivative of $p$ with respect to $U_2$ is $\\frac{\\partial p}{\\partial U_2} = (\\gamma-1)(-\\frac{U_2}{U_1})$.\n$$\nv_2 = -\\frac{U_1}{\\gamma-1} \\frac{1}{p} (\\gamma-1) \\left(-\\frac{U_2}{U_1}\\right) = \\frac{U_2}{p} = \\frac{\\rho u}{p}\n$$\n\n**Component $v_1 = \\frac{\\partial \\eta}{\\partial U_1}$:**\nUsing the product rule:\n$$\nv_1 = -\\frac{1}{\\gamma-1}(\\ln p - \\gamma \\ln U_1) - \\frac{U_1}{\\gamma-1} \\left( \\frac{1}{p}\\frac{\\partial p}{\\partial U_1} - \\frac{\\gamma}{U_1} \\right)\n$$\nThe first term is $-\\frac{s}{\\gamma-1}$. The derivative of $p$ is $\\frac{\\partial p}{\\partial U_1} = (\\gamma-1)\\frac{U_2^2}{2U_1^2} = (\\gamma-1)\\frac{u^2}{2}$.\n$$\nv_1 = -\\frac{s}{\\gamma-1} - \\frac{U_1}{\\gamma-1} \\left( \\frac{1}{p}(\\gamma-1)\\frac{u^2}{2} - \\frac{\\gamma}{U_1} \\right) = -\\frac{s}{\\gamma-1} - \\left( \\frac{U_1 u^2}{2p} - \\frac{\\gamma}{\\gamma-1} \\right)\n$$\n$$\nv_1 = \\frac{\\gamma-s}{\\gamma-1} - \\frac{\\rho u^2}{2p}\n$$\nIn summary, the entropy variables are:\n$$\n\\mathbf{v}(\\rho, u, p) = \\begin{bmatrix} \\frac{\\gamma-s}{\\gamma-1} - \\frac{\\rho u^2}{2p} \\\\ \\frac{\\rho u}{p} \\\\ -\\frac{\\rho}{p} \\end{bmatrix}, \\quad \\text{where} \\quad s = \\ln(p) - \\gamma\\ln(\\rho)\n$$\n\nNext, we derive the entropy potential $\\psi(\\mathbf{U}) = \\mathbf{v} \\cdot \\mathbf{f} - F$.\nThe physical flux is $\\mathbf{f} = [\\rho u, \\rho u^2 + p, u(\\rho E + p)]^{\\top}$.\nThe entropy flux is $F = u\\eta = -u \\frac{\\rho s}{\\gamma-1}$.\nWe compute the dot product $\\mathbf{v} \\cdot \\mathbf{f}$:\n$$\n\\mathbf{v} \\cdot \\mathbf{f} = \\left(\\frac{\\gamma-s}{\\gamma-1} - \\frac{\\rho u^2}{2p}\\right)(\\rho u) + \\left(\\frac{\\rho u}{p}\\right)(\\rho u^2 + p) + \\left(-\\frac{\\rho}{p}\\right)(u(\\rho E + p))\n$$\nUsing the relation $\\rho E = \\frac{p}{\\gamma-1} + \\frac{1}{2}\\rho u^2$, the third flux component becomes $u(\\rho E + p) = u(\\frac{\\gamma p}{\\gamma-1} + \\frac{1}{2}\\rho u^2)$.\nSubstituting this into the dot product expression:\n$$\n\\mathbf{v} \\cdot \\mathbf{f} = \\left(\\frac{(\\gamma-s)\\rho u}{\\gamma-1} - \\frac{\\rho^2 u^3}{2p}\\right) + \\left(\\frac{\\rho^2 u^3}{p} + \\rho u\\right) - \\left(\\frac{\\rho u}{p}\\left(\\frac{\\gamma p}{\\gamma-1} + \\frac{1}{2}\\rho u^2\\right)\\right)\n$$\n$$\n\\mathbf{v} \\cdot \\mathbf{f} = \\frac{\\gamma\\rho u}{\\gamma-1} - \\frac{s\\rho u}{\\gamma-1} - \\frac{\\rho^2 u^3}{2p} + \\frac{\\rho^2 u^3}{p} + \\rho u - \\frac{\\gamma\\rho u}{\\gamma-1} - \\frac{\\rho^2 u^3}{2p}\n$$\nCombining terms, we observe that several cancellations occur:\n$$\n\\mathbf{v} \\cdot \\mathbf{f} = \\left(\\frac{\\gamma\\rho u}{\\gamma-1} - \\frac{\\gamma\\rho u}{\\gamma-1}\\right) + \\left(-\\frac{\\rho^2 u^3}{2p} + \\frac{\\rho^2 u^3}{p} - \\frac{\\rho^2 u^3}{2p}\\right) - \\frac{s\\rho u}{\\gamma-1} + \\rho u\n$$\n$$\n\\mathbf{v} \\cdot \\mathbf{f} = \\rho u - \\frac{s\\rho u}{\\gamma-1}\n$$\nNow we compute the entropy potential $\\psi$:\n$$\n\\psi = \\mathbf{v} \\cdot \\mathbf{f} - F = \\left(\\rho u - \\frac{s\\rho u}{\\gamma-1}\\right) - \\left(- \\frac{s\\rho u}{\\gamma-1} \\right) = \\rho u\n$$\nThe entropy potential is remarkably simple for the chosen entropy function:\n$$\n\\psi(\\mathbf{U}) = \\rho u\n$$\n\n### 2. Construction of the Entropy-Conservative Flux\n\nTadmor's framework provides a formal method for constructing entropy-conservative fluxes via path integration in the space of entropy variables. However, the explicit evaluation of these integrals is often intractable. An alternative is to construct a flux by averaging the variables in a way that is known to preserve entropy. The problem specifies the use of the arithmetic mean for velocity $(\\bar{u})$ and logarithmic means for density $(\\rho^{\\log})$ and pressure $(p^{\\log})$.\n\nA reasonable and simple approach to construct a flux candidate is to take the physical flux vector $\\mathbf{f}(\\rho, u, p)$ and replace each primitive variable with its prescribed mean value. This method yields a symmetric and consistent numerical flux. We define our candidate flux $\\mathbf{f}^{\\mathrm{ec}}$ accordingly.\n\nThe physical flux expressed in terms of primitive variables is:\n$$\n\\mathbf{f}(\\rho, u, p) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u\\left(\\frac{\\gamma p}{\\gamma-1} + \\frac{1}{2}\\rho u^2\\right) \\end{bmatrix}\n$$\nWe construct the candidate flux $\\mathbf{f}^{\\mathrm{ec}}$ by replacing $\\rho \\to \\rho^{\\log}$, $u \\to \\bar{u}$, and $p \\to p^{\\log}$:\n$$\nf_1^{\\mathrm{ec}} = \\rho^{\\log} \\bar{u}\n$$\n$$\nf_2^{\\mathrm{ec}} = \\rho^{\\log} \\bar{u}^2 + p^{\\log}\n$$\n$$\nf_3^{\\mathrm{ec}} = \\bar{u}\\left(\\frac{\\gamma p^{\\log}}{\\gamma-1} + \\frac{1}{2}\\rho^{\\log}\\bar{u}^2\\right)\n$$\nThe means are defined as:\n$$\n\\bar{u} = \\frac{u_L + u_R}{2}, \\quad \\rho^{\\log} = \\frac{\\rho_R - \\rho_L}{\\ln(\\rho_R) - \\ln(\\rho_L)}, \\quad p^{\\log} = \\frac{p_R - p_L}{\\ln(p_R) - \\ln(p_L)}\n$$\nwith the special case that if the arguments of a logarithmic mean are equal, the mean is equal to the common value. This construction satisfies the consistency requirement, i.e., $\\mathbf{f}^{\\mathrm{ec}}(\\mathbf{U},\\mathbf{U}) = \\mathbf{f}(\\mathbf{U})$. The validity of this specific flux form as an entropy-conservative flux will be confirmed by numerically verifying that it satisfies Tadmor's identity.\n\n### 3. Numerical Verification\n\nThe final task is to compute the absolute residual $r$ of Tadmor's identity for the derived quantities and the constructed flux:\n$$\nr = \\left|(\\mathbf{v}_{R} - \\mathbf{v}_{L}) \\cdot \\mathbf{f}^{\\mathrm{ec}}(\\mathbf{U}_{L},\\mathbf{U}_{R}) - \\left(\\psi(\\mathbf{U}_{R}) - \\psi(\\mathbf{U}_{L})\\right)\\right|\n$$\nThe procedure for each test case is as follows:\n1.  Given the left $(\\rho_L, u_L, p_L)$ and right $(\\rho_R, u_R, p_R)$ states and $\\gamma$.\n2.  Compute the left entropy variables $\\mathbf{v}_L$ using the formulas derived in Section 1 with the left state variables.\n3.  Compute the right entropy variables $\\mathbf{v}_R$ using the formulas derived in Section 1 with the right state variables.\n4.  Compute the entropy potential for both states: $\\psi_L = \\rho_L u_L$ and $\\psi_R = \\rho_R u_R$.\n5.  Compute the entropy-conservative flux $\\mathbf{f}^{\\mathrm{ec}} = [f_1^{\\mathrm{ec}}, f_2^{\\mathrm{ec}}, f_3^{\\mathrm{ec}}]^{\\top}$ using the formulas from Section 2.\n6.  Calculate the left-hand side (LHS) of the identity: $LHS = (\\mathbf{v}_R - \\mathbf{v}_L) \\cdot \\mathbf{f}^{\\mathrm{ec}} = (v_{1,R} - v_{1,L})f_1^{\\mathrm{ec}} + (v_{2,R} - v_{2,L})f_2^{\\mathrm{ec}} + (v_{3,R} - v_{3,L})f_3^{\\mathrm{ec}}$.\n7.  Calculate the right-hand side (RHS) of the identity: $RHS = \\psi_R - \\psi_L$.\n8.  Compute the absolute residual $r = |LHS - RHS|$.\n\nIf the constructed flux $\\mathbf{f}^{\\mathrm{ec}}$ is indeed entropy-conservative for the given entropy function, the residual $r$ should be zero up to machine precision. The implementation will perform these calculations for the three specified test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of verifying Tadmor's identity for a constructed\n    entropy-conservative flux for the 1D Euler equations.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: General\n        {'rho_L': 1.2, 'u_L': 0.3, 'p_L': 1.0, 'rho_R': 0.8, 'u_R': -0.2, 'p_R': 0.7, 'gamma': 1.4},\n        # Case 2: Equality\n        {'rho_L': 1.0, 'u_L': 0.0, 'p_L': 1.0, 'rho_R': 1.0, 'u_R': 0.0, 'p_R': 1.0, 'gamma': 1.4},\n        # Case 3: Extreme contrast\n        {'rho_L': 1e-6, 'u_L': 100.0, 'p_L': 1e-3, 'rho_R': 10.0, 'u_R': -50.0, 'p_R': 100.0, 'gamma': 1.4},\n    ]\n\n    results = []\n    for case in test_cases:\n        residual = calculate_tadmor_residual(**case)\n        results.append(residual)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef logmean(a: float, b: float) -> float:\n    \"\"\"\n    Computes the logarithmic mean of two numbers a and b.\n    \"\"\"\n    if np.isclose(a, b):\n        return a\n    # Handle positivity for log\n    if a <= 0 or b <= 0:\n        raise ValueError(\"Logarithmic mean is only defined for positive numbers.\")\n    return (b - a) / (np.log(b) - np.log(a))\n\ndef get_entropy_variables(rho: float, u: float, p: float, gamma: float) -> np.ndarray:\n    \"\"\"\n    Computes the entropy variables v from primitive variables (rho, u, p).\n    v = [v1, v2, v3]^T\n    \"\"\"\n    s = np.log(p) - gamma * np.log(rho)\n    v1 = (gamma - s) / (gamma - 1) - (rho * u**2) / (2 * p)\n    v2 = rho * u / p\n    v3 = -rho / p\n    return np.array([v1, v2, v3])\n\ndef get_entropy_potential(rho: float, u: float) -> float:\n    \"\"\"\n    Computes the entropy potential psi.\n    \"\"\"\n    return rho * u\n\ndef get_ec_flux(rho_L: float, u_L: float, p_L: float,\n                rho_R: float, u_R: float, p_R: float,\n                gamma: float) -> np.ndarray:\n    \"\"\"\n    Constructs the entropy-conservative flux f_ec based on specified means.\n    \"\"\"\n    rho_ln = logmean(rho_L, rho_R)\n    p_ln = logmean(p_L, p_R)\n    u_avg = 0.5 * (u_L + u_R)\n\n    f1_ec = rho_ln * u_avg\n    f2_ec = rho_ln * u_avg**2 + p_ln\n    f3_ec = u_avg * (gamma * p_ln / (gamma - 1) + 0.5 * rho_ln * u_avg**2)\n    \n    return np.array([f1_ec, f2_ec, f3_ec])\n\ndef calculate_tadmor_residual(rho_L: float, u_L: float, p_L: float,\n                              rho_R: float, u_R: float, p_R: float,\n                              gamma: float) -> float:\n    \"\"\"\n    Calculates the absolute residual of Tadmor's identity.\n    r = |(v_R - v_L) . f_ec - (psi_R - psi_L)|\n    \"\"\"\n    # 1. Compute entropy variables for left and right states\n    v_L = get_entropy_variables(rho_L, u_L, p_L, gamma)\n    v_R = get_entropy_variables(rho_R, u_R, p_R, gamma)\n    \n    # 2. Compute entropy potential for left and right states\n    psi_L = get_entropy_potential(rho_L, u_L)\n    psi_R = get_entropy_potential(rho_R, u_R)\n    \n    # 3. Compute the entropy-conservative flux\n    f_ec = get_ec_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma)\n    \n    # 4. Calculate the two sides of Tadmor's identity\n    delta_v = v_R - v_L\n    lhs = np.dot(delta_v, f_ec)\n    \n    delta_psi = psi_R - psi_L\n    rhs = delta_psi\n    \n    # 5. Compute the absolute residual\n    residual = np.abs(lhs - rhs)\n    \n    return residual\n\nsolve()\n```", "id": "3314744"}, {"introduction": "Entropy-conservative schemes are perfect for smooth flows, but physical solutions containing shocks or other discontinuities require entropy to be dissipated. This final practice completes the picture by showing how to build a fully entropy-stable scheme capable of capturing shocks robustly. You will augment a baseline entropy-conservative flux with a carefully designed dissipation term that is activated only where needed by a shock sensor ([@problem_id:3314726]). Implementing this mechanism highlights the critical distinction between entropy conservation and entropy stability, equipping you with the tools to construct modern, high-fidelity shock-capturing methods.", "problem": "You are to construct and test an entropy-stable subcell shock sensor within a one-dimensional finite-volume discretization of the inviscid Burgers conservation law. The governing equation is the scalar conservation law $u_t + f(u)_x = 0$ with physical flux $f(u) = \\frac{1}{2} u^2$. Use the mathematical entropy pair $(U(u), F(u))$ defined by $U(u) = \\frac{1}{2} u^2$ and $F(u) = \\frac{1}{3} u^3$. The entropy variable is $v(u) = \\frac{dU}{du} = u$. Employ the two-point entropy-conservative numerical flux at an interface between states $u_L$ and $u_R$ given implicitly by the Tadmor condition $(v_R - v_L)\\, f^{\\mathrm{ec}}(u_L, u_R) = \\psi(u_R) - \\psi(u_L)$ with entropy potential $\\psi(u) = v(u)\\, f(u) - F(u)$. For the inviscid Burgers equation this reduces to the explicit two-point flux $f^{\\mathrm{ec}}(u_L, u_R) = \\frac{u_L^2 + u_L u_R + u_R^2}{6}$. Add dissipation only where indicated by a subcell shock sensor based on the discrete entropy residual across each interface.\n\nDefine the discrete entropy residual across an interface $(i+\\frac{1}{2})$ as\n$$\nR_{i+\\frac{1}{2}} = \\left| F(u_R) - F(u_L) - \\frac{1}{2} (u_L + u_R)\\, \\big(f(u_R) - f(u_L)\\big) \\right|.\n$$\nThis residual measures the local violation of the chain-rule identity $dF = v\\, df$ in a discrete sense; it is small in smooth regions and large near discontinuities. Construct a Boolean shock sensor $S_{i+\\frac{1}{2}}$ that equals $1$ if $R_{i+\\frac{1}{2}} > \\tau$ and equals $0$ otherwise, where $\\tau$ is a user-defined threshold. Use this sensor to gate an entropy-stable dissipation: the numerical flux at each interface is\n$$\nf^{\\mathrm{num}}_{i+\\frac{1}{2}} = f^{\\mathrm{ec}}(u_L, u_R) - \\frac{1}{2} S_{i+\\frac{1}{2}}\\, \\alpha_{i+\\frac{1}{2}}\\, (u_R - u_L),\n$$\nwhere $\\alpha_{i+\\frac{1}{2}} = \\max\\{|u_L|, |u_R|\\}$ is a local characteristic speed. The semi-discrete finite-volume update for cell average $u_i$ is\n$$\n\\frac{d u_i}{d t} = - \\frac{f^{\\mathrm{num}}_{i+\\frac{1}{2}} - f^{\\mathrm{num}}_{i-\\frac{1}{2}}}{\\Delta x}.\n$$\nUse a two-stage Strong Stability Preserving (SSP) Runge–Kutta scheme to march in time with a Courant–Friedrichs–Lewy (CFL) choice $\\Delta t = \\mathrm{CFL}\\, \\frac{\\Delta x}{\\max_i |u_i|}$ and $\\mathrm{CFL} = 0.4$. Spatially discretize on a uniform mesh of $N$ cells over a domain of length $L$ with cell-centered states and interface fluxes. Apply periodic boundary conditions for smooth periodic flows and transmissive (zero-gradient) boundary conditions for Riemann-type problems.\n\nImplement the algorithm with the following test suite of initial conditions and thresholds:\n\n- Test case $\\#1$ (smooth periodic flow): $L = 1$, $N = 256$, $\\mathrm{CFL} = 0.4$, $u(x,0) = a \\sin(2 \\pi k x)$ with $a = 0.4$, $k = 1$, periodic boundary conditions, final time $T = 0.05$, threshold $\\tau = 10^{-6}$.\n- Test case $\\#2$ (shocked Riemann problem): $L = 1$, $N = 256$, $\\mathrm{CFL} = 0.4$, $u(x,0) = u_L$ for $x < 0.5$ and $u(x,0) = u_R$ for $x \\ge 0.5$ with $u_L = 2.0$ and $u_R = 0.0$, transmissive boundary conditions, final time $T = 0.02$, threshold $\\tau = 10^{-6}$.\n- Test case $\\#3$ (mixed smooth/shocked flow): $L = 1$, $N = 256$, $\\mathrm{CFL} = 0.4$, piecewise initial condition\n$$\nu(x,0) = \n\\begin{cases}\n0.2 + 0.2 \\sin(4 \\pi x), & 0 \\le x < 0.5,\\\\\n1.5, & 0.5 \\le x < 0.75,\\\\\n0.0, & 0.75 \\le x \\le 1,\n\\end{cases}\n$$\ntransmissive boundary conditions, final time $T = 0.02$, threshold $\\tau = 10^{-6}$.\n- Test case $\\#4$ (edge case, high threshold on smooth flow): $L = 1$, $N = 256$, $\\mathrm{CFL} = 0.4$, $u(x,0) = a \\sin(2 \\pi k x)$ with $a = 0.1$, $k = 1$, periodic boundary conditions, final time $T = 0.05$, threshold $\\tau = 0.5$.\n\nFor each test case, compute the fraction of all interfaces where the sensor triggers at the final time, i.e., the ratio\n$$\n\\frac{\\sum_{i=0}^{N} S_{i+\\frac{1}{2}}^{\\mathrm{final}}}{N+1}.\n$$\nNo physical units are involved in the outputs. Your program should produce a single line of output containing the results for the four test cases as a comma-separated list of floats enclosed in square brackets, in the order given above (e.g., $[r_1,r_2,r_3,r_4]$). The values $r_j$ must be real numbers in decimal format. The program must be self-contained and must not require any user input.", "solution": "The problem requires the implementation and testing of a finite-volume numerical scheme for the one-dimensional inviscid Burgers' equation, $u_t + f(u)_x = 0$, with the physical flux given by $f(u) = \\frac{1}{2} u^2$. The scheme must be entropy-stable, employing a shock sensor to apply artificial dissipation only where necessary.\n\nFirst, we establish the spatial discretization on a uniform grid of $N$ cells over a domain of length $L$. The width of each cell is $\\Delta x = L/N$. The solution $u_i(t)$ represents the cell-average of the conserved quantity in cell $i$ at time $t$. The semi-discrete finite-volume update for each cell is given by:\n$$\n\\frac{d u_i}{d t} = -\\frac{f^{\\mathrm{num}}_{i+\\frac{1}{2}} - f^{\\mathrm{num}}_{i-\\frac{1}{2}}}{\\Delta x}\n$$\nHere, $f^{\\mathrm{num}}_{i+\\frac{1}{2}}$ is the numerical flux at the interface between cell $i$ and cell $i+1$.\n\nThe numerical flux is constructed to be entropy-stable. For the given entropy pair, $U(u) = \\frac{1}{2} u^2$ (entropy) and $F(u) = \\frac{1}{3} u^3$ (entropy flux), the corresponding entropy variable is $v(u) = dU/du = u$. The numerical flux consists of a baseline entropy-conservative flux, $f^{\\mathrm{ec}}$, augmented with a dissipative term that is activated by a shock sensor, $S_{i+\\frac{1}{2}}$.\n\nThe two-point entropy-conservative flux for the Burgers' equation between a left state $u_L$ and a right state $u_R$ is derived from the Tadmor condition and is explicitly given as:\n$$\nf^{\\mathrm{ec}}(u_L, u_R) = \\frac{u_L^2 + u_L u_R + u_R^2}{6}\n$$\n\nTo detect shocks and other discontinuities where entropy must be dissipated, a shock sensor is constructed based on a discrete entropy residual. The residual, $R_{i+\\frac{1}{2}}$, measures the local deviation from the continuous entropy-flux compatibility condition $dF = v \\, df$. It is defined at the interface between cells with states $u_L$ and $u_R$ as:\n$$\nR_{i+\\frac{1}{2}} = \\left| F(u_R) - F(u_L) - \\frac{1}{2} (u_L + u_R)\\, \\big(f(u_R) - f(u_L)\\big) \\right|\n$$\nFor the specific case of the Burgers' equation, this expression simplifies to the computationally efficient form:\n$$\nR_{i+\\frac{1}{2}} = \\frac{|(u_R - u_L)^3|}{12}\n$$\nThis residual is small in smooth regions of the flow and large across discontinuities. A Boolean shock sensor, $S_{i+\\frac{1}{2}}$, is then defined by comparing the residual to a user-specified threshold $\\tau$:\n$$\nS_{i+\\frac{1}{2}} = \n\\begin{cases}\n1 & \\text{if } R_{i+\\frac{1}{2}} > \\tau \\\\\n0 & \\text{if } R_{i+\\frac{1}{2}} \\le \\tau\n\\end{cases}\n$$\n\nThe full numerical flux, $f^{\\mathrm{num}}_{i+\\frac{1}{2}}$, combines the entropy-conservative flux with an artificial dissipation term scaled by the shock sensor:\n$$\nf^{\\mathrm{num}}_{i+\\frac{1}{2}} = f^{\\mathrm{ec}}(u_L, u_R) - \\frac{1}{2} S_{i+\\frac{1}{2}}\\, \\alpha_{i+\\frac{1}{2}}\\, (u_R - u_L)\n$$\nThe coefficient $\\alpha_{i+\\frac{1}{2}}$ provides the correct amount of viscosity and is based on the local characteristic wave speed:\n$$\n\\alpha_{i+\\frac{1}{2}} = \\max\\{|u_L|, |u_R|\\}\n$$\nThis formulation ensures that dissipation is only added at interfaces flagged by the sensor, preserving the solution's accuracy in smooth regions while stabilizing shocks.\n\nFor time integration of the semi-discrete system, a two-stage Strong Stability Preserving Runge-Kutta (SSP-RK2) scheme is employed. Given the semi-discrete operator $\\mathcal{L}(u)_i = -\\frac{1}{\\Delta x}(f^{\\mathrm{num}}_{i+\\frac{1}{2}} - f^{\\mathrm{num}}_{i-\\frac{1}{2}})$, the update from time level $n$ to $n+1$ proceeds in two stages:\n$$\nu^{(1)} = u^n + \\Delta t \\, \\mathcal{L}(u^n)\n$$\n$$\nu^{n+1} = \\frac{1}{2} u^n + \\frac{1}{2} \\left( u^{(1)} + \\Delta t \\, \\mathcal{L}(u^{(1)}) \\right)\n$$\nThe time step, $\\Delta t$, is determined by the Courant–Friedrichs–Lewy (CFL) condition to ensure numerical stability:\n$$\n\\Delta t = \\mathrm{CFL}\\, \\frac{\\Delta x}{\\max_i |u_i|}\n$$\nwith a specified $\\mathrm{CFL}$ value of $0.4$.\n\nBoundary conditions (periodic or transmissive) are handled using ghost cells. For periodic boundaries, the ghost cells outside one domain boundary are filled with values from the cells at the opposite boundary. For transmissive (zero-gradient) boundaries, ghost cell values are copied from the nearest interior cell.\n\nThe algorithm proceeds by initializing the solution array $u$ according to the specified initial conditions for each test case. The system is then evolved in time using the SSP-RK2 scheme until the final time $T$ is reached. At the conclusion of the simulation, the shock sensor $S_{i+\\frac{1}{2}}$ is computed for all $N+1$ interfaces based on the final solution state. The required output metric is the fraction of interfaces where the sensor is active, calculated as:\n$$\n\\frac{\\sum_{j=0}^{N} S_{j+\\frac{1}{2}}^{\\mathrm{final}}}{N+1}\n$$\nThis process is repeated for each of the four test cases defined in the problem statement.", "answer": "```python\nimport numpy as np\n\ndef run_simulation(L, N, cfl, u0_func, bc_type, T, tau):\n    \"\"\"\n    Runs a 1D Burgers' equation simulation with an entropy-stable scheme.\n    \"\"\"\n    dx = L / N\n    # Cell centers for x\n    x = np.linspace(dx / 2.0, L - dx / 2.0, N)\n    u = u0_func(x)\n    t = 0.0\n\n    while t < T:\n        max_abs_u = np.max(np.abs(u))\n        # Add a small epsilon to prevent division by zero in static cases\n        dt = cfl * dx / (max_abs_u + 1e-12)\n        \n        # Ensure the final time step does not overshoot T\n        if t + dt > T:\n            dt = T - t\n\n        # Standard two-stage SSP Runge-Kutta (SSP-RK2) scheme, also known as Heun's method\n        # Stage 1\n        dudt1 = calculate_rhs(u, N, dx, bc_type, tau)\n        u1 = u + dt * dudt1\n\n        # Stage 2\n        dudt2 = calculate_rhs(u1, N, dx, bc_type, tau)\n        u = 0.5 * u + 0.5 * (u1 + dt * dudt2)\n        \n        t += dt\n\n    # After the loop, calculate the final sensor activation\n    _, final_sensors = calculate_rhs(u, N, dx, bc_type, tau, return_sensors=True)\n    \n    # The problem asks for the fraction over N+1 interfaces\n    sensor_fraction = np.sum(final_sensors) / (N + 1)\n    \n    return sensor_fraction\n\ndef calculate_rhs(u, N, dx, bc_type, tau, return_sensors=False):\n    \"\"\"\n    Calculates the right-hand side of the semi-discrete finite volume scheme.\n    \"\"\"\n    # Create a padded array for ghost cells (1 on each side)\n    u_padded = np.zeros(N + 2)\n    u_padded[1:-1] = u\n\n    # Apply boundary conditions\n    if bc_type == 'periodic':\n        u_padded[0] = u[-1]\n        u_padded[-1] = u[0]\n    elif bc_type == 'transmissive':  # Zero-gradient\n        u_padded[0] = u[0]\n        u_padded[-1] = u[-1]\n\n    # Get left and right states at the N+1 interfaces\n    uL = u_padded[:-1]\n    uR = u_padded[1:]\n\n    # Simplified discrete entropy residual for Burgers' equation: |(u_R - u_L)^3| / 12\n    delta_u = uR - uL\n    residual = np.abs(delta_u**3) / 12.0\n    \n    # Boolean shock sensor\n    sensors = (residual > tau).astype(float)\n    \n    # Entropy-conservative flux: (u_L^2 + u_L*u_R + u_R^2) / 6\n    f_ec = (uL**2 + uL * uR + uR**2) / 6.0\n    \n    # Dissipation coefficient: max(|u_L|, |u_R|)\n    alpha = np.maximum(np.abs(uL), np.abs(uR))\n    \n    # Numerical flux with entropy-stable dissipation\n    f_num = f_ec - 0.5 * sensors * alpha * delta_u\n    \n    # RHS for cells 0 to N-1\n    rhs = -(f_num[1:] - f_num[:-1]) / dx\n    \n    if return_sensors:\n        return rhs, sensors\n    else:\n        return rhs\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run simulations, and print results.\n    \"\"\"\n    # Test case definitions\n    def u0_case1(x):\n        a = 0.4\n        k = 1.0\n        return a * np.sin(2 * np.pi * k * x)\n\n    def u0_case2(x):\n        u = np.zeros_like(x)\n        u[x < 0.5] = 2.0\n        u[x >= 0.5] = 0.0\n        return u\n\n    def u0_case3(x):\n        u = np.zeros_like(x)\n        mask1 = (x >= 0) & (x < 0.5)\n        mask2 = (x >= 0.5) & (x < 0.75)\n        # mask3 is the rest\n        u[mask1] = 0.2 + 0.2 * np.sin(4 * np.pi * x[mask1])\n        u[mask2] = 1.5\n        # u[mask3] is already 0.0\n        return u\n\n    def u0_case4(x):\n        a = 0.1\n        k = 1.0\n        return a * np.sin(2 * np.pi * k * x)\n\n    test_cases = [\n        {'L': 1.0, 'N': 256, 'cfl': 0.4, 'u0_func': u0_case1, 'bc_type': 'periodic', 'T': 0.05, 'tau': 1e-6},\n        {'L': 1.0, 'N': 256, 'cfl': 0.4, 'u0_func': u0_case2, 'bc_type': 'transmissive', 'T': 0.02, 'tau': 1e-6},\n        {'L': 1.0, 'N': 256, 'cfl': 0.4, 'u0_func': u0_case3, 'bc_type': 'transmissive', 'T': 0.02, 'tau': 1e-6},\n        {'L': 1.0, 'N': 256, 'cfl': 0.4, 'u0_func': u0_case4, 'bc_type': 'periodic', 'T': 0.05, 'tau': 0.5},\n    ]\n\n    results = []\n    for params in test_cases:\n        result = run_simulation(**params)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3314726"}]}