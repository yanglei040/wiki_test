{"hands_on_practices": [{"introduction": "The defining characteristic of a Strong Stability Preserving (SSP) time integrator is its construction as a convex combination of stable forward Euler steps. This exercise [@problem_id:3350094] challenges you to apply this foundational principle directly. By recasting the stages of a standard third-order SSP Runge-Kutta scheme, you will derive its stability condition from scratch, revealing how the method inherits the stability properties of its simpler building block.", "problem": "Consider the one-dimensional linear advection equation $u_{t} + a\\,u_{x} = 0$ on a periodic domain discretized on a uniform mesh of spacing $\\Delta x$, with a conservative first-order upwind finite-volume approximation for $a0$. The semi-discrete system at cell centers is\n$$\n\\frac{d u_{i}}{dt} \\;=\\; \\mathcal{N}(u)_i \\;=\\; -\\frac{a}{\\Delta x}\\left(u_{i} - u_{i-1}\\right).\n$$\nLet the numerical solution be advanced in time using the standard three-stage third-order Strong Stability Preserving (SSP) Runge-Kutta (RK) method in Shu-Osher form. Assume that forward Euler is strongly stable (for example, nonincreasing in a convex monotonicity norm such as total variation) under the time-step restriction $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$, where for this spatial discretization $\\Delta t_{\\mathrm{FE}} = \\Delta x/a$.\n\nStarting only from the foundational definition of Strong Stability Preserving (SSP) time integrators as convex combinations of forward Euler steps applied to the semi-discrete operator $\\mathcal{N}(\\cdot)$, do the following:\n\n1. Write the three-stage third-order SSP Runge-Kutta scheme applied to $\\dot{u}=\\mathcal{N}(u)$ in Shu-Osher form.\n2. Recast each stage as an explicit convex combination of either the current state or a forward Euler update with the same time step $\\Delta t$.\n3. Using this representation and the given forward Euler strong-stability bound $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$, derive the largest allowable $\\Delta t$ such that the same strong-stability property is guaranteed for the three-stage third-order SSP Runge-Kutta method.\n4. Evaluate this allowable time step for $a = 1.7\\,\\mathrm{m/s}$ and $\\Delta x = 6.2 \\times 10^{-3}\\,\\mathrm{m}$.\n\nExpress the final allowable time step in seconds and round your answer to four significant figures.", "solution": "The problem requires the derivation of the strong stability time step restriction for a specific three-stage, third-order Strong Stability Preserving (SSP) Runge-Kutta method applied to a semi-discrete system, starting from the foundational definition of SSP methods.\n\nThe problem is first validated.\n\n### Step 1: Extract Givens\n- **Governing Equation**: One-dimensional linear advection equation, $u_{t} + a\\,u_{x} = 0$, with $a  0$.\n- **Domain and Mesh**: Periodic domain, uniform mesh with spacing $\\Delta x$.\n- **Spatial Discretization**: Conservative first-order upwind finite-volume approximation.\n- **Semi-Discrete System**: $\\frac{d u_{i}}{dt} = \\mathcal{N}(u)_i = -\\frac{a}{\\Delta x}\\left(u_{i} - u_{i-1}\\right)$.\n- **Time Integrator**: Standard three-stage third-order SSP Runge-Kutta (SSP(3,3)) method in Shu-Osher form.\n- **Forward Euler Stability**: The forward Euler method, $u^{n+1} = u^n + \\Delta t \\mathcal{N}(u^n)$, is strongly stable (e.g., total variation non-increasing) if its time step $\\Delta t$ satisfies $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$, where $\\Delta t_{\\mathrm{FE}} = \\frac{\\Delta x}{a}$.\n- **Numerical Values**: $a = 1.7\\,\\mathrm{m/s}$ and $\\Delta x = 6.2 \\times 10^{-3}\\,\\mathrm{m}$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is based on standard, well-established concepts in numerical analysis and computational fluid dynamics, including the linear advection equation, finite-volume methods, upwind schemes, and SSP Runge-Kutta methods. The formulation is correct and physically sound.\n- **Well-Posed**: The problem is well-posed. It provides a clear set of definitions and a known stable method (Forward Euler) as a building block. The task is to derive the stability limit for a more complex method constructed from these blocks, which leads to a unique, meaningful solution.\n- **Objective**: The problem is stated in precise, objective mathematical language, free of ambiguity or subjective claims.\n\n### Step 3: Verdict and Action\nThe problem is scientifically grounded, well-posed, objective, and self-contained. It is therefore deemed **valid**. A full solution will be provided.\n\n### Solution Derivation\n\nThe solution proceeds by following the four steps outlined in the problem statement.\n\n**1. The SSP(3,3) Runge-Kutta Scheme in Shu-Osher Form**\n\nThe task is to apply the specified time integrator to the general semi-discrete ordinary differential equation (ODE) system $\\frac{du}{dt} = \\mathcal{N}(u)$, where $u$ represents the vector of cell-centered values $\\{u_i\\}$. The standard three-stage, third-order SSP Runge-Kutta scheme, often denoted SSP(3,3), is given in the Shu-Osher form as follows:\n$$u^{(0)} = u^n$$\n$$u^{(1)} = u^{(0)} + \\Delta t \\, \\mathcal{N}(u^{(0)})$$\n$$u^{(2)} = \\frac{3}{4} u^{(0)} + \\frac{1}{4} \\left( u^{(1)} + \\Delta t \\, \\mathcal{N}(u^{(1)}) \\right)$$\n$$u^{n+1} = \\frac{1}{3} u^{(0)} + \\frac{2}{3} \\left( u^{(2)} + \\Delta t \\, \\mathcal{N}(u^{(2)}) \\right)$$\nwhere $u^n$ is the solution at time $t_n$, and $u^{n+1}$ is the solution at the next time level, $t_{n+1} = t_n + \\Delta t$. The vectors $u^{(1)}$ and $u^{(2)}$ represent intermediate stage values.\n\n**2. Recasting Stages as Convex Combinations of Forward Euler Steps**\n\nThe foundational principle of SSP methods is that they can be expressed as a convex combination of forward Euler steps. A method is a convex combination if it can be written in the form $\\sum_{k} \\alpha_k \\mathcal{O}_k$, where the operators $\\mathcal{O}_k$ are themselves strongly stable and the coefficients satisfy $\\alpha_k \\ge 0$ and $\\sum_k \\alpha_k = 1$. The base stable operator is the forward Euler (FE) step.\n\nLet's define the forward Euler operator with a time step $\\delta t$ as:\n$$E(w; \\delta t) = w + \\delta t \\, \\mathcal{N}(w)$$\nThe problem states that this operator is strongly stable under some convex semi-norm $\\|\\cdot\\|$ (e.g., total variation, $\\|u\\|_{\\text{TV}} = \\sum_i |u_{i+1}-u_i|$), meaning $\\|E(w; \\delta t)\\| \\le \\|w\\|$, provided that $\\delta t \\le \\Delta t_{\\mathrm{FE}}$.\n\nWe now recast each stage of the SSP(3,3) scheme using this operator.\n\n*   **Stage 1:**\n    The first stage is already in the form of a forward Euler step applied to $u^n = u^{(0)}$ with a time step $\\Delta t$:\n    $$u^{(1)} = u^{(0)} + \\Delta t \\, \\mathcal{N}(u^{(0)}) = E(u^{(0)}; \\Delta t)$$\n    This is a trivial convex combination. For this step to be stable, we must have $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$.\n\n*   **Stage 2:**\n    The second stage is:\n    $$u^{(2)} = \\frac{3}{4} u^{(0)} + \\frac{1}{4} \\left( u^{(1)} + \\Delta t \\, \\mathcal{N}(u^{(1)}) \\right)$$\n    Recognizing the term in parentheses as a forward Euler step on $u^{(1)}$ with time step $\\Delta t$, we can write:\n    $$u^{(2)} = \\frac{3}{4} u^{(0)} + \\frac{1}{4} E(u^{(1)}; \\Delta t)$$\n    This expression represents $u^{(2)}$ as a convex combination of the states $u^{(0)}$ and $E(u^{(1)}; \\Delta t)$, since the coefficients are non-negative ($\\frac{3}{4} \\ge 0, \\frac{1}{4} \\ge 0$) and sum to unity ($\\frac{3}{4} + \\frac{1}{4} = 1$). For the overall stage to preserve stability, the operator $E(u^{(1)}; \\Delta t)$ must be stable. This requires its time step $\\Delta t$ to satisfy $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$.\n\n*   **Stage 3 (Final Stage):**\n    The final stage gives the new solution $u^{n+1}$:\n    $$u^{n+1} = \\frac{1}{3} u^{(0)} + \\frac{2}{3} \\left( u^{(2)} + \\Delta t \\, \\mathcal{N}(u^{(2)}) \\right)$$\n    Similarly, we identify the term in parentheses as a forward Euler step on $u^{(2)}$ with time step $\\Delta t$:\n    $$u^{n+1} = \\frac{1}{3} u^{(0)} + \\frac{2}{3} E(u^{(2)}; \\Delta t)$$\n    This expresses $u^{n+1}$ as a convex combination of $u^{(0)}$ and $E(u^{(2)}; \\Delta t)$, with non-negative coefficients ($\\frac{1}{3} \\ge 0, \\frac{2}{3} \\ge 0$) that sum to unity ($\\frac{1}{3} + \\frac{2}{3} = 1$). For this step to preserve stability, the operator $E(u^{(2)}; \\Delta t)$ must be stable, which demands that its time step $\\Delta t$ satisfies $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$.\n\n**3. Derivation of the Largest Allowable Time Step**\n\nThe stability of the entire SSP(3,3) method requires that every forward Euler operation within its structure is stable. We have analyzed each stage and found that the forward Euler operator $E$ is always applied with the full time step $\\Delta t$ of the Runge-Kutta method.\n\n- From Stage 1, we require $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$.\n- From Stage 2, we require $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$.\n- From Stage 3, we require $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$.\n\nTo satisfy all these conditions simultaneously, the time step $\\Delta t$ must be bounded by the most restrictive of these constraints. Since all constraints are identical, the overall stability condition for the SSP(3,3) method is:\n$$\\Delta t \\le \\Delta t_{\\mathrm{FE}}$$\nThe largest allowable time step, $\\Delta t_{\\max}$, is therefore equal to the forward Euler stability limit:\n$$\\Delta t_{\\max} = \\Delta t_{\\mathrm{FE}}$$\nThis result means that the SSP coefficient for this particular third-order Runge-Kutta scheme is $C=1$.\n\n**4. Evaluation of the Allowable Time Step**\n\nThe problem provides the expression for the forward Euler stability limit for the given spatial discretization:\n$$\\Delta t_{\\mathrm{FE}} = \\frac{\\Delta x}{a}$$\nTherefore, the largest allowable time step for the SSP(3,3) method is:\n$$\\Delta t_{\\max} = \\frac{\\Delta x}{a}$$\nWe are given the numerical values $a = 1.7\\,\\mathrm{m/s}$ and $\\Delta x = 6.2 \\times 10^{-3}\\,\\mathrm{m}$. Substituting these values, we get:\n$$\\Delta t_{\\max} = \\frac{6.2 \\times 10^{-3}\\,\\mathrm{m}}{1.7\\,\\mathrm{m/s}}$$\n$$\\Delta t_{\\max} \\approx 3.6470588... \\times 10^{-3}\\,\\mathrm{s}$$\nRounding the result to four significant figures, as requested:\n$$\\Delta t_{\\max} \\approx 3.647 \\times 10^{-3}\\,\\mathrm{s}$$", "answer": "$$\\boxed{3.647 \\times 10^{-3}}$$", "id": "3350094"}, {"introduction": "While the theory behind SSP methods is elegant, their true value is demonstrated in practice. This coding exercise [@problem_id:3287729] is designed to provide a direct, computational comparison between a method that possesses strong stability properties and one that does not. By observing how each scheme handles a sharp discontinuity, you will gain a practical understanding of how SSP integrators preserve physical bounds like the maximum principle, a critical feature for preventing spurious oscillations in CFD simulations.", "problem": "Consider the scalar conservation law $u_t + f(u)_x = 0$ on a periodic one-dimensional domain with $x \\in [0,1]$. Discretize the spatial domain into $N$ uniform cells with $\\Delta x = 1/N$, and denote by $u_j(t)$ the cell-average approximation in cell index $j$ at time $t$, with periodic indexing. Use a finite volume semi-discretization with a monotone numerical flux $\\hat{f}$ so that the semi-discrete operator $L(u)$ is defined componentwise by\n$$\n\\left[L(u)\\right]_j = -\\frac{\\hat{f}_{j+1/2} - \\hat{f}_{j-1/2}}{\\Delta x}.\n$$\nLet the physical flux be $f(u) = a\\,u$, where $a$ is a constant advection speed. Use the local Lax-Friedrichs flux, which for this linear flux reduces to the first-order upwind flux:\n- If $a  0$, set $\\hat{f}_{j+1/2} = a\\,u_j$.\n- If $a  0$, set $\\hat{f}_{j+1/2} = a\\,u_{j+1}$.\nThis yields a monotone semi-discrete operator.\n\nInitialize the data with a single-cell spike respecting the maximum principle bounds:\n$$\nu_j^0 = \\begin{cases}\n1  \\text{if } j = j^\\star,\\\\\n0  \\text{otherwise},\n\\end{cases}\n$$\nwhere $j^\\star = \\lfloor N/2 \\rfloor$.\n\nDefine the Courant-Friedrichs-Lewy number by $r = \\frac{|a|\\,\\Delta t}{\\Delta x}$, and compute the time step $\\Delta t = r\\,\\frac{\\Delta x}{|a|}$.\n\nImplement two explicit Runge-Kutta time integrators for a single time step:\n1. The explicit midpoint method (second-order, non-Strong Stability Preserving):\n   - Stage $1$: $u^{(1)} = u^n + \\Delta t\\,L(u^n)$,\n   - Update: $u^{n+1} = u^n + \\Delta t\\,L(u^{(1)})$.\n2. The Strong Stability Preserving (SSP) Runge-Kutta method of order two (Heun's method):\n   - Stage $1$: $u^{(1)} = u^n + \\Delta t\\,L(u^n)$,\n   - Stage $2$: $\\tilde{u}^{(2)} = u^{(1)} + \\Delta t\\,L(u^{(1)})$,\n   - Update: $u^{n+1} = \\tfrac{1}{2}\\,u^n + \\tfrac{1}{2}\\,\\tilde{u}^{(2)}$.\n\nFor each test case below, perform exactly one time step with each integrator starting from the specified initial data and spatial discretization. For each resulting solution $u^{n+1}$, check the maximum principle with respect to the initial bounds $[0,1]$:\n- Compute $\\min_j u_j^{n+1}$ and $\\max_j u_j^{n+1}$.\n- Declare the maximum principle preserved if $\\min_j u_j^{n+1} \\ge 0$ and $\\max_j u_j^{n+1} \\le 1$ (use a numerical tolerance of $10^{-12}$ for these comparisons).\n\nTest suite:\n- Use $N = 100$ and $j^\\star = \\lfloor N/2 \\rfloor$ for all tests.\n- Consider the following $(a,r)$ pairs:\n  1. $(a,r) = (1.0, 0.25)$,\n  2. $(a,r) = (1.0, 0.50)$,\n  3. $(a,r) = (1.0, 0.60)$,\n  4. $(a,r) = (1.0, 0.95)$,\n  5. $(a,r) = (-1.0, 0.60)$,\n  6. $(a,r) = (1.0, 1.05)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with two boolean entries per test case indicating whether the maximum principle is preserved for the explicit midpoint method and the Strong Stability Preserving (SSP) Runge-Kutta method of order two, respectively. The final output must be in the exact order of the test suite and method pairing, namely:\n$$\n\\left[\\text{MP}_{\\text{midpoint},1},\\text{MP}_{\\text{SSP2},1},\\text{MP}_{\\text{midpoint},2},\\text{MP}_{\\text{SSP2},2},\\ldots,\\text{MP}_{\\text{midpoint},6},\\text{MP}_{\\text{SSP2},6}\\right],\n$$\nwhere $\\text{MP}_{\\text{method},k}$ is the boolean result for the $k$-th test case and the specified method. No physical units are involved; all quantities are dimensionless.", "solution": "The problem requires an analysis of the maximum principle preservation property for two different second-order explicit Runge-Kutta time integration schemes applied to a semi-discretized linear advection equation. The analysis will be performed by implementing the schemes and testing them against a suite of parameters.\n\nThe governing partial differential equation is the scalar linear advection equation, a specific form of a conservation law:\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial f(u)}{\\partial x} = 0\n$$\nwhere the physical flux function is $f(u) = a\\,u$, with $a$ being a constant advection speed. The spatial domain is $x \\in [0,1]$ with periodic boundary conditions.\n\nThe domain is discretized into $N$ uniform cells of width $\\Delta x = 1/N$. The solution within each cell $j$ is represented by its cell average, $u_j(t)$. The semi-discrete form of the equation, using a finite volume method, is:\n$$\n\\frac{du_j}{dt} = L(u)_j = -\\frac{\\hat{f}_{j+1/2} - \\hat{f}_{j-1/2}}{\\Delta x}\n$$\nwhere $\\hat{f}_{j+1/2}$ is the numerical flux at the interface between cell $j$ and cell $j+1$. The problem specifies the first-order upwind flux, which depends on the sign of the advection speed $a$.\n\nCase 1: $a  0$ (advection to the right)\nThe flux at the interface $j+1/2$ is determined by the value in the upwind cell, which is cell $j$.\n$$\n\\hat{f}_{j+1/2} = a\\,u_j\n$$\nThe semi-discrete operator for cell $j$ becomes:\n$$\nL(u)_j = -\\frac{a\\,u_j - a\\,u_{j-1}}{\\Delta x} = -\\frac{a}{\\Delta x}(u_j - u_{j-1})\n$$\n\nCase 2: $a  0$ (advection to the left)\nThe flux at the interface $j+1/2$ is determined by the value in the upwind cell, which is cell $j+1$.\n$$\n\\hat{f}_{j+1/2} = a\\,u_{j+1}\n$$\nThe semi-discrete operator for cell $j$ becomes:\n$$\nL(u)_j = -\\frac{a\\,u_{j+1} - a\\,u_j}{\\Delta x} = -\\frac{a}{\\Delta x}(u_{j+1} - u_j)\n$$\n\nThe time step $\\Delta t$ is defined via the Courant-Friedrichs-Lewy (CFL) number, $r$:\n$$\nr = \\frac{|a|\\,\\Delta t}{\\Delta x} \\implies \\Delta t = r \\frac{\\Delta x}{|a|}\n$$\nThe quantity $\\Delta t \\, L(u)$ appears in the time-stepping schemes. We can simplify this term.\n\nFor $a  0$, $|a|=a$:\n$$\n\\Delta t\\, L(u)_j = \\left(r \\frac{\\Delta x}{a}\\right) \\left(-\\frac{a}{\\Delta x}(u_j - u_{j-1})\\right) = -r(u_j - u_{j-1}) = r(u_{j-1} - u_j)\n$$\n\nFor $a  0$, $|a|=-a$:\n$$\n\\Delta t\\, L(u)_j = \\left(r \\frac{\\Delta x}{-a}\\right) \\left(-\\frac{a}{\\Delta x}(u_{j+1} - u_j)\\right) = r(u_{j+1} - u_j)\n$$\nThese expressions can be implemented efficiently using vector operations with periodic shifts, for which `numpy.roll` is well-suited.\n\nThe initial condition is a discrete spike: $u_j^0 = 1$ for $j=j^\\star = \\lfloor N/2 \\rfloor$ and $u_j^0=0$ otherwise. The initial data lies within the interval $[0,1]$. The maximum principle is said to be preserved if the solution at the next time step, $u_j^{n+1}$, also remains within these bounds for all $j$: $0 \\le u_j^{n+1} \\le 1$. A numerical tolerance of $10^{-12}$ is used for this check.\n\nWe now implement the two specified Runge-Kutta schemes for a single time step from $u^n = u^0$ to $u^{n+1}$.\n\n1.  **Explicit Midpoint Method** (as defined in the problem):\n    - Stage $1$: $u^{(1)} = u^n + \\Delta t\\,L(u^n)$\n    - Update: $u^{n+1} = u^n + \\Delta t\\,L(u^{(1)})$\n    This method is of second-order accuracy but is not generally Strong Stability Preserving (SSP). For the upwind semi-discretization, it preserves the maximum principle only under a restrictive CFL condition, theoretically $r \\le 0.5$.\n\n2.  **Strong Stability Preserving (SSP) Runge-Kutta method of order two (Heun's method)** (as defined in the problem):\n    - Stage $1$: $u^{(1)} = u^n + \\Delta t\\,L(u^n)$\n    - Stage $2$: $\\tilde{u}^{(2)} = u^{(1)} + \\Delta t\\,L(u^{(1)})$\n    - Update: $u^{n+1} = \\tfrac{1}{2}\\,u^n + \\tfrac{1}{2}\\,\\tilde{u}^{(2)}$\n    This method can be interpreted as a convex combination of the initial state and the state after applying two forward Euler steps. The forward Euler method is maximum principle preserving for this semi-discretization if $r \\le 1$. Since this SSP scheme is a convex combination of operations that preserve the maximum principle (under the condition $r \\le 1$), the full scheme is also maximum principle preserving under the same condition $r \\le 1$.\n\nThe solution procedure is as follows: for each $(a, r)$ pair in the test suite, we initialize the state vector $u^0$. Then, for each of the two time integrators, we compute the state $u^{n+1}$ after one time step. We then check if the minimum and maximum values of the resulting vector $u^{n+1}$ lie within $[0,1]$ (with tolerance). The boolean results (True for preserved, False for violated) are collected for each method and test case.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of checking maximum principle preservation for two RK methods.\n    \"\"\"\n    # Define problem parameters\n    N = 100\n    # j_star needs to be an integer for array indexing\n    j_star = int(np.floor(N / 2))\n    # Numerical tolerance for checking the maximum principle\n    tol = 1e-12\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (a, r) pairs\n        (1.0, 0.25),\n        (1.0, 0.50),\n        (1.0, 0.60),\n        (1.0, 0.95),\n        (-1.0, 0.60),\n        (1.0, 1.05),\n    ]\n\n    results = []\n\n    # Define the operator L_op(u, a, r) which computes delta_t * L(u).\n    # This operator directly uses the CFL number r.\n    def apply_L_times_dt(u, a, r):\n        \"\"\"\n        Applies the semi-discrete operator multiplied by the time step.\n        L(u) = - (f_j+1/2 - f_j-1/2) / dx\n        delta_t * L(u) is computed using the CFL number r.\n        \"\"\"\n        if a > 0:\n            # Upwind flux for positive advection (a > 0)\n            # Stencil uses u_j and u_{j-1}. np.roll(u, 1) gets u_{j-1}.\n            return r * (np.roll(u, 1) - u)\n        else: # a  0\n            # Upwind flux for negative advection (a  0)\n            # Stencil uses u_j and u_{j+1}. np.roll(u, -1) gets u_{j+1}.\n            return r * (np.roll(u, -1) - u)\n\n    # Define a helper function to check the maximum principle.\n    def check_mp(u, tolerance):\n        \"\"\"\n        Checks if the solution u respects the maximum principle bounds [0, 1].\n        \"\"\"\n        min_u = np.min(u)\n        max_u = np.max(u)\n        # The condition is that all values u_j must be in [0, 1].\n        # We use a tolerance for floating-point comparisons.\n        is_preserved = (min_u >= -tolerance) and (max_u = 1.0 + tolerance)\n        return is_preserved\n\n    # Main loop over test cases\n    for a, r in test_cases:\n        # Initialize the data with a single-cell spike\n        u0 = np.zeros(N, dtype=float)\n        u0[j_star] = 1.0\n\n        # 1. Explicit Midpoint Method\n        # Stage 1: u^(1) = u^n + dt*L(u^n)\n        u1_mid = u0 + apply_L_times_dt(u0, a, r)\n        # Update: u^{n+1} = u^n + dt*L(u^(1))\n        u_final_mid = u0 + apply_L_times_dt(u1_mid, a, r)\n        results.append(check_mp(u_final_mid, tol))\n\n        # 2. Strong Stability Preserving (SSP) Runge-Kutta method of order two\n        # Stage 1: u^(1) = u^n + dt*L(u^n)\n        u1_ssp = u0 + apply_L_times_dt(u0, a, r)\n        # Stage 2: u_tilde^(2) = u^(1) + dt*L(u^(1))\n        u2_tilde_ssp = u1_ssp + apply_L_times_dt(u1_ssp, a, r)\n        # Update: u^{n+1} = 0.5*u^n + 0.5*u_tilde^(2)\n        u_final_ssp = 0.5 * u0 + 0.5 * u2_tilde_ssp\n        results.append(check_mp(u_final_ssp, tol))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3287729"}, {"introduction": "A robust numerical method requires more than just a stable interior discretization and time integrator; the treatment of boundary conditions is equally critical. This exercise [@problem_id:3366853] delves into this advanced topic, showing how non-conservative boundary implementations can undermine the stability guaranteed by an SSP Runge-Kutta scheme. By numerically testing several boundary condition strategies, you will see how they can lead to a loss of total variation control and learn the correct approach to ensure global stability in your simulations.", "problem": "Consider the one-dimensional linear advection equation $u_t + a u_x = 0$ with constant advection speed $a  0$, discretized on a uniform grid of $N$ cells with spacing $\\Delta x = 1/N$, indexed from $i=0$ to $i=N-1$, and an inflow boundary condition $u(0,t) = u_{\\mathrm{in}}(t)$ for $a0$. Define the semi-discrete conservative upwind flux $f_{i+1/2} = a u_i$ for $a0$ and the semi-discrete operator $L$ acting componentwise by $L_i(u) = -\\frac{1}{\\Delta x}\\left(f_{i+1/2} - f_{i-1/2}\\right)$ for $0 \\le i \\le N-1$, with the inflow boundary face flux $f_{-1/2} = a u_{\\mathrm{in}}(t)$ and the outflow boundary face flux $f_{N-1/2} = a u_{N-1}$. Let the total variation of a vector $u \\in \\mathbb{R}^N$ be evaluated on an inflow-extended vector by \n$$\nTV_{\\mathrm{ext}}(u;u_{\\mathrm{in}}) = \\sum_{i=-1}^{N-2} \\left|u_{i+1} - u_i\\right|, \\quad \\text{where } u_{-1} = u_{\\mathrm{in}} \\text{ and } u_i \\text{ denotes the grid function at cell } i.\n$$\nAssume the stage-accurate Strong Stability Preserving Runge–Kutta of order three with three stages (SSPRK$(3,3)$), applied with a time step $\\Delta t$ satisfying the Courant–Friedrichs–Lewy number $\\lambda = a \\Delta t / \\Delta x$ given in each test case.\n\nThe objective is to demonstrate, by explicit computation, that even when the interior operator is monotone, non-conservative boundary treatments can destroy total variation stability under the Strong Stability Preserving Runge–Kutta scheme. Specifically, you are to implement and compare the following inflow boundary discretizations within one SSPRK$(3,3)$ time step:\n- Conservative flux boundary at every stage: use $f_{-1/2} = a u_{\\mathrm{in}}$ consistently in evaluating $L(u)$ at all stages.\n- Final-stage Dirichlet clamp (non-conservative): evaluate $L(u)$ at all stages with $f_{-1/2} = a u_0$ (i.e., zero net boundary flux in the ODE for $u_0$), then after completing the three-stage SSPRK update set $u_0 \\leftarrow u_{\\mathrm{in}}$.\n- Final-stage overshoot source (non-conservative): as in the previous item, but after the final SSPRK update set $u_0 \\leftarrow u_0 + \\beta\\,(u_{\\mathrm{in}} - u_0)$ with a fixed overshoot parameter $\\beta = 1.5$.\n- Proposed boundary stage update to restore total variation control: apply the conservative flux boundary at every stage (treating the inflow boundary consistently during each stage of the time integrator).\n\nYou must implement a single SSPRK$(3,3)$ step for the following test suite of parameter values and initial data. In all cases, $a$ is dimensionless, and results are dimensionless floats:\n- Test Case A (happy path near stability limit): $N=50$, $a=1$, $\\lambda=1.0$, $u_{\\mathrm{in}}=1$, and the initial condition $u_i^n=0$ for all $i$.\n- Test Case B (interior discontinuity away from boundary): $N=50$, $a=1$, $\\lambda=1.0$, $u_{\\mathrm{in}}=0$, and the initial condition $u_i^n=1$ for $i \\ge \\lfloor N/3 \\rfloor$ and $u_i^n=0$ otherwise.\n- Test Case C (smaller time step): $N=50$, $a=1$, $\\lambda=0.5$, $u_{\\mathrm{in}}=1$, and the initial condition $u_i^n=0$ for all $i$.\n\nFor each test case, compute the change in inflow-extended total variation across the single SSPRK$(3,3)$ time step,\n$$\n\\Delta TV = TV_{\\mathrm{ext}}(u^{n+1};u_{\\mathrm{in}}) - TV_{\\mathrm{ext}}(u^{n};u_{\\mathrm{in}}),\n$$\nfor each of the four boundary discretizations listed above, in the order: conservative, final-stage clamp, final-stage overshoot source with $\\beta=1.5$, and proposed fix. Your program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets, namely\n$$\n[\\Delta TV_{A,\\mathrm{cons}},\\Delta TV_{A,\\mathrm{clamp}},\\Delta TV_{A,\\mathrm{over}},\\Delta TV_{A,\\mathrm{fix}},\\Delta TV_{B,\\mathrm{cons}},\\Delta TV_{B,\\mathrm{clamp}},\\Delta TV_{B,\\mathrm{over}},\\Delta TV_{B,\\mathrm{fix}},\\Delta TV_{C,\\mathrm{cons}},\\Delta TV_{C,\\mathrm{clamp}},\\Delta TV_{C,\\mathrm{over}},\\Delta TV_{C,\\mathrm{fix}}].\n$$\nAll quantities are dimensionless floats. The final line must contain only this bracketed list, with no extra text.", "solution": "The user-provided problem is assessed to be valid. It is scientifically grounded in the field of numerical analysis for partial differential equations, specifically concerning the stability of numerical schemes for hyperbolic conservation laws. The problem is well-posed, objective, and contains all necessary information to proceed with a unique, verifiable, and computational solution. The objective is to demonstrate a known issue with non-conservative boundary condition treatments when using Strong Stability Preserving (SSP) time integrators, which is a standard topic in advanced computational fluid dynamics.\n\nThe solution proceeds as follows:\nFirst, we establish the mathematical framework. The problem considers the one-dimensional linear advection equation:\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0\n$$\nwhere $u(x, t)$ is a scalar quantity and $a > 0$ is a constant advection speed. This partial differential equation (PDE) is semi-discretized in space on a uniform grid with $N$ cells and cell-spacing $\\Delta x$. This results in a system of ordinary differential equations (ODEs) of the form:\n$$\n\\frac{d\\mathbf{u}}{dt} = L(\\mathbf{u})\n$$\nwhere $\\mathbf{u}(t) \\in \\mathbb{R}^N$ is the vector of cell-averaged values $u_i(t)$ and $L$ is the spatial discretization operator. The problem defines $L$ using a conservative finite volume formulation with a first-order upwind flux. The operator $L$ acting on the $i$-th component of $\\mathbf{u}$ is:\n$$\nL_i(\\mathbf{u}) = -\\frac{1}{\\Delta x} \\left( f_{i+1/2} - f_{i-1/2} \\right)\n$$\nThe numerical fluxes $f_{i+1/2}$ at the cell interfaces are given by the upwind-biased formula for $a > 0$: $f_{i+1/2} = a u_i$. The outflow boundary flux is $f_{N-1/2} = a u_{N-1}$, which is consistent with the interior upwind flux. The inflow flux at the $i=-1/2$ face, $f_{-1/2}$, depends on the boundary condition treatment. This leads to the component-wise definition of the operator $L$:\n$$\nL_0(\\mathbf{u}) = -\\frac{1}{\\Delta x}(a u_0 - f_{-1/2})\n$$\n$$\nL_i(\\mathbf{u}) = -\\frac{a}{\\Delta x}(u_i - u_{i-1}) \\quad \\text{for } 1 \\leq i \\leq N-1\n$$\nThe system of ODEs is integrated in time using the three-stage, third-order Strong Stability Preserving Runge-Kutta scheme, SSPRK(3,3). Given a solution $\\mathbf{u}^n$ at time $t_n$, the solution at time $t_{n+1} = t_n + \\Delta t$ is computed via:\n$$\n\\begin{aligned}\n\\mathbf{u}^{(1)} = \\mathbf{u}^n + \\Delta t L(\\mathbf{u}^n) \\\\\n\\mathbf{u}^{(2)} = \\frac{3}{4} \\mathbf{u}^n + \\frac{1}{4} \\left( \\mathbf{u}^{(1)} + \\Delta t L(\\mathbf{u}^{(1)}) \\right) \\\\\n\\mathbf{u}^{n+1} = \\frac{1}{3} \\mathbf{u}^n + \\frac{2}{3} \\left( \\mathbf{u}^{(2)} + \\Delta t L(\\mathbf{u}^{(2)}) \\right)\n\\end{aligned}\n$$\nThe stability of the solution is measured by its total variation (TV). The problem defines an inflow-extended total variation, which accounts for the jump at the boundary:\n$$\nTV_{\\mathrm{ext}}(\\mathbf{u}; u_{\\mathrm{in}}) = \\sum_{i=-1}^{N-2} |u_{i+1} - u_i| = |u_0 - u_{\\mathrm{in}}| + \\sum_{i=0}^{N-2} |u_{i+1} - u_i|\n$$\nwhere $u_{-1}$ is taken to be the inflow boundary value $u_{\\mathrm{in}}$. A numerical scheme is total variation diminishing (TVD) if $TV(\\mathbf{u}^{n+1}) \\le TV(\\mathbfu^n)$. SSP schemes are designed to be TVD if the forward Euler step $\\mathbf{u}' = \\mathbf{u} + \\Delta t L(\\mathbf{u})$ is TVD, under a given Courant–Friedrichs–Lewy (CFL) number constraint, $\\lambda = a \\Delta t / \\Delta x \\le 1$.\n\nThe core of the problem is to compare four different ways of implementing the inflow boundary condition:\n\n1.  **Conservative Flux Boundary**: The inflow flux is set consistently at all RK stages using the given boundary value: $f_{-1/2} = a u_{\\mathrm{in}}$. This is the standard, correct way to implement the boundary condition for a TVD scheme. The operator $L$ is therefore dependent on $u_{\\mathrm{in}}$.\n\n2.  **Final-Stage Dirichlet Clamp**: During the RK stages, the inflow flux is computed as if there were a zero-gradient boundary condition, $f_{-1/2} = a u_0$. This makes the ODE for the first cell $du_0/dt = 0$, decoupling it from the boundary. After the full SSPRK step is completed to find a provisional solution $\\mathbf{u}^*$, the boundary value is \"clamped\" by directly setting $u_0^{n+1} = u_{\\mathrm{in}}$. This procedure is non-conservative.\n\n3.  **Final-Stage Overshoot Source**: This is similar to the clamp. The RK stages are integrated with $f_{-1/2} = a u_0$. After obtaining the provisional solution $\\mathbf{u}^*$, the boundary cell is updated via a source term: $u_0^{n+1} = u_0^* + \\beta(u_{\\mathrm{in}} - u_0^*)$ with $\\beta=1.5$. This is also non-conservative and, with $\\beta>1$, intentionally introduces an overshoot.\n\n4.  **Proposed Fix**: This method is a restatement of the conservative flux boundary approach. It serves as the \"correct\" reference, demonstrating that the fix for non-conservative boundary issues is to apply the boundary data conservatively and consistently within each stage of the time integrator.\n\nFor each of the three test cases, we will initialize the state vector $\\mathbf{u}^n$, calculate its initial extended total variation $TV_{\\mathrm{ext}}(\\mathbf{u}^n; u_{\\mathrm{in}})$, apply a single SSPRK(3,3) time step for each of the four boundary methods to get four different $\\mathbf{u}^{n+1}$ vectors, calculate their respective final extended total variations $TV_{\\mathrm{ext}}(\\mathbf{u}^{n+1}; u_{\\mathrm{in}})$, and report the change $\\Delta TV = TV_{\\mathrm{ext}}(\\mathbf{u}^{n+1}) - TV_{\\mathrm{ext}}(\\mathbf{u}^n)$.\nThe implementation will follow this logic, iterating through the test cases and boundary methods to compute the twelve required $\\Delta TV$ values. The results are expected to show that for the conservative method, $\\Delta TV \\le 0$, whereas for the non-conservative methods, it is possible to have $\\Delta TV > 0$, indicating a loss of stability and the creation of spurious oscillations.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by computing the change in total variation for different\n    boundary condition treatments for the 1D linear advection equation.\n    \"\"\"\n\n    test_cases = [\n        # Test Case A\n        {'N': 50, 'a': 1.0, 'lambda': 1.0, 'u_in': 1.0, 'u_n': np.zeros(50)},\n        # Test Case B\n        {'N': 50, 'a': 1.0, 'lambda': 1.0, 'u_in': 0.0, 'u_n': np.array([0.0 if i  50 // 3 else 1.0 for i in range(50)])},\n        # Test Case C\n        {'N': 50, 'a': 1.0, 'lambda': 0.5, 'u_in': 1.0, 'u_n': np.zeros(50)}\n    ]\n\n    boundary_methods = [\n        'conservative',\n        'final_stage_clamp',\n        'final_stage_overshoot',\n        'proposed_fix'\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        N = case['N']\n        a = case['a']\n        lambda_cfl = case['lambda']\n        u_in = case['u_in']\n        u_n = case['u_n']\n        \n        delta_x = 1.0 / N\n        delta_t = lambda_cfl * delta_x / a\n\n        params = {'a': a, 'delta_t': delta_t, 'delta_x': delta_x}\n\n        def get_L_operator(u, bc_flux_val):\n            \"\"\"Computes the semi-discrete operator L(u).\"\"\"\n            L = np.zeros(N)\n            L[0] = -(a * u[0] - bc_flux_val) / delta_x\n            if N > 1:\n                L[1:] = -a * (u[1:] - u[:-1]) / delta_x\n            return L\n\n        def tv_ext(u, u_in_val):\n            \"\"\"Computes the inflow-extended total variation.\"\"\"\n            u_extended = np.concatenate(([u_in_val], u))\n            return np.sum(np.abs(np.diff(u_extended)))\n\n        tv_initial = tv_ext(u_n, u_in)\n\n        for method in boundary_methods:\n            # --- SSPRK(3,3) Integration ---\n            \n            # Stage 1\n            if method in ['conservative', 'proposed_fix']:\n                f_mhalf_n = a * u_in\n            else: # clamp or overshoot\n                f_mhalf_n = a * u_n[0]\n            \n            L_n = get_L_operator(u_n, f_mhalf_n)\n            u_1 = u_n + delta_t * L_n\n\n            # Stage 2\n            if method in ['conservative', 'proposed_fix']:\n                f_mhalf_1 = a * u_in\n            else:\n                f_mhalf_1 = a * u_1[0]\n                \n            L_1 = get_L_operator(u_1, f_mhalf_1)\n            u_2 = 0.75 * u_n + 0.25 * u_1 + 0.25 * delta_t * L_1\n            \n            # Stage 3\n            if method in ['conservative', 'proposed_fix']:\n                f_mhalf_2 = a * u_in\n            else:\n                f_mhalf_2 = a * u_2[0]\n\n            L_2 = get_L_operator(u_2, f_mhalf_2)\n            u_np1_star = (1.0/3.0) * u_n + (2.0/3.0) * (u_2 + delta_t * L_2)\n            \n            u_np1 = u_np1_star.copy()\n\n            # --- Final boundary adjustment for non-conservative methods ---\n            if method == 'final_stage_clamp':\n                u_np1[0] = u_in\n            elif method == 'final_stage_overshoot':\n                beta = 1.5\n                u_np1[0] = u_np1_star[0] + beta * (u_in - u_np1_star[0])\n            \n            # --- Calculate and store Delta TV ---\n            tv_final = tv_ext(u_np1, u_in)\n            delta_tv = tv_final - tv_initial\n            all_results.append(delta_tv)\n\n    # Format the final output string\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n\n```", "id": "3366853"}]}