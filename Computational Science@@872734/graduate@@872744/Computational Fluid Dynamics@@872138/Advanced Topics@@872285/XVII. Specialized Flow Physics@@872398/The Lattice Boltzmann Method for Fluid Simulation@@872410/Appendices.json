{"hands_on_practices": [{"introduction": "The heart of the Lattice Boltzmann Method lies in the collision step, where particle distributions relax towards a local equilibrium state. This practice solidifies your understanding of this core concept by guiding you through the direct calculation of the equilibrium distribution functions, $f_i^{eq}$, for a given macroscopic state $(\\rho, \\boldsymbol{u})$ on the D2Q9 lattice [@problem_id:3375057]. By verifying that the moments of your calculated $f_i^{eq}$ correctly recover the initial density and momentum, you will build a foundational skill essential for implementing and debugging any LBM solver.", "problem": "Consider the isothermal Lattice Boltzmann Method (LBM) on the two-dimensional nine-velocity lattice (D2Q9) for a single-component, weakly compressible fluid. The discrete velocities are\n$$\\boldsymbol{c}_0 = (0,0),\\ \\boldsymbol{c}_1 = (1,0),\\ \\boldsymbol{c}_2 = (0,1),\\ \\boldsymbol{c}_3 = (-1,0),\\ \\boldsymbol{c}_4 = (0,-1),\\ \\boldsymbol{c}_5 = (1,1),\\ \\boldsymbol{c}_6 = (-1,1),\\ \\boldsymbol{c}_7 = (-1,-1),\\ \\boldsymbol{c}_8 = (1,-1),$$\nwith lattice weights\n$$w_0 = \\frac{4}{9},\\quad w_1=w_2=w_3=w_4 = \\frac{1}{9},\\quad w_5=w_6=w_7=w_8 = \\frac{1}{36},$$\nand lattice speed of sound\n$$c_s^{2} = \\frac{1}{3}.$$\nAssume $|\\boldsymbol{u}|/c_s \\ll 1$ and use the moment-matching principle so that the zeroth, first, and second discrete velocity moments of the equilibrium populations reproduce the isothermal compressible Euler-level hydrodynamic fields to second order in the Mach number. Specifically, require that\n- the zeroth moment recovers the mass density $ \\rho $,\n- the first moment recovers the momentum density $ \\rho \\boldsymbol{u} $,\n- the second moment recovers the isothermal pressure tensor $ \\boldsymbol{\\Pi}^{eq} = \\rho c_s^{2}\\boldsymbol{I} + \\rho \\boldsymbol{u}\\boldsymbol{u} $.\n\nUsing only these constraints, derive the general form of the D2Q9 equilibrium populations $f_i^{eq}(\\rho,\\boldsymbol{u})$ consistent with the above moment conditions up to second order in $|\\boldsymbol{u}|$. Then, for the specific state\n$$\\rho = \\frac{5}{4},\\qquad \\boldsymbol{u} = \\left(\\frac{1}{6},\\,-\\frac{1}{9}\\right),$$\ncompute all nine equilibrium populations $f_i^{eq}$ for $i=0,\\dots,8$. Finally, verify the recovery of density and momentum by explicitly computing $\\sum_{i=0}^{8} f_i^{eq}$ and $\\sum_{i=0}^{8} f_i^{eq}\\boldsymbol{c}_i$, and report the scalar $\\sum_{i} f_i^{eq}$ and the two components of $\\sum_{i} f_i^{eq}\\boldsymbol{c}_i$.\n\nExpress the final answer as a single row matrix containing the $9$ values $f_0^{eq},f_1^{eq},\\dots,f_8^{eq}$, followed by $\\sum_{i} f_i^{eq}$, $\\left(\\sum_{i} f_i^{eq} c_{ix}\\right)$, and $\\left(\\sum_{i} f_i^{eq} c_{iy}\\right)$, in that order. No rounding is required and no units should be included in the final answer.", "solution": "The problem is first validated against the specified criteria.\n\n### Step 1: Extract Givens\n-   **Model**: Isothermal Lattice Boltzmann Method (LBM) on a two-dimensional nine-velocity (D2Q9) lattice for a single-component, weakly compressible fluid.\n-   **Discrete Velocities $\\boldsymbol{c}_i$**:\n    $\\boldsymbol{c}_0 = (0,0),\\ \\boldsymbol{c}_1 = (1,0),\\ \\boldsymbol{c}_2 = (0,1),\\ \\boldsymbol{c}_3 = (-1,0),\\ \\boldsymbol{c}_4 = (0,-1),\\ \\boldsymbol{c}_5 = (1,1),\\ \\boldsymbol{c}_6 = (-1,1),\\ \\boldsymbol{c}_7 = (-1,-1),\\ \\boldsymbol{c}_8 = (1,-1)$, in lattice units where $\\Delta x = 1$ and $\\Delta t = 1$.\n-   **Lattice Weights $w_i$**:\n    $w_0 = \\frac{4}{9},\\quad w_1=w_2=w_3=w_4 = \\frac{1}{9},\\quad w_5=w_6=w_7=w_8 = \\frac{1}{36}$.\n-   **Lattice Speed of Sound $c_s$**:\n    $c_s^{2} = \\frac{1}{3}$.\n-   **Low Mach Number Condition**: $|\\boldsymbol{u}|/c_s \\ll 1$.\n-   **Moment Constraints on Equilibrium Populations $f_i^{eq}$**:\n    1.  Zeroth moment (density): $\\sum_{i=0}^{8} f_i^{eq} = \\rho$.\n    2.  First moment (momentum): $\\sum_{i=0}^{8} f_i^{eq} \\boldsymbol{c}_i = \\rho \\boldsymbol{u}$.\n    3.  Second moment (momentum flux): $\\sum_{i=0}^{8} f_i^{eq} \\boldsymbol{c}_i \\boldsymbol{c}_i = \\boldsymbol{\\Pi}^{eq} = \\rho c_s^{2}\\boldsymbol{I} + \\rho \\boldsymbol{u}\\boldsymbol{u}$.\n-   **Specific State**:\n    $\\rho = \\frac{5}{4},\\qquad \\boldsymbol{u} = \\left(\\frac{1}{6},\\,-\\frac{1}{9}\\right)$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated based on the criteria of being scientifically grounded, well-posed, and objective.\n\n-   **Scientific Grounding**: The problem is a standard derivation and application within the field of computational fluid dynamics, specifically concerning the Lattice Boltzmann Method. The D2Q9 model, its weights, speed of sound, and the moment-matching conditions for the equilibrium distribution are fundamental, well-established concepts in LBM theory. The problem is scientifically sound.\n-   **Well-Posedness**: The problem provides all necessary constraints and data to derive the general form of the equilibrium distribution function up to the specified order and to compute its specific values. The moment conditions uniquely determine the polynomial coefficients of the expansion of $f_i^{eq}$ in velocity. The specific values of density and velocity are well-defined. The problem is self-contained and uniquely solvable.\n-   **Objectivity**: The problem is stated in precise mathematical language, free from any subjective or ambiguous terminology.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. It is a standard, well-posed problem in computational physics that adheres to all validation criteria. A full solution will be provided.\n\n### Derivation of the Equilibrium Distribution Function\n\nThe problem requires deriving the form of $f_i^{eq}(\\rho, \\boldsymbol{u})$ from the moment conditions. A standard way to achieve this is through a truncated expansion in orthogonal polynomials, which for the LBM case are lattice-based Hermite polynomials. We seek an expansion of $f_i^{eq}$ in powers of the macroscopic velocity $\\boldsymbol{u}$ up to second order, which is consistent with the low Mach number assumption.\n\nLet's expand $f_i^{eq}$ as:\n$$f_i^{eq} = w_i \\left( A + B_{\\alpha} c_{i\\alpha} + C_{\\alpha\\beta} c_{i\\alpha} c_{i\\beta} + D_{\\alpha\\beta} \\delta_{\\alpha\\beta} \\right)$$\nwhere repeated Greek indices imply summation over spatial dimensions ($x, y$). The coefficients $A$, $B_\\alpha$, $C_{\\alpha\\beta}$, and $D_{\\alpha\\beta}$ are functions of $\\rho$ and $\\boldsymbol{u}$. To simplify, we'll express them as polynomials in $u$.\nA more direct method is to use a Grad-type moment expansion for $f_i^{eq}$ in terms of its moments. For a second-order expansion, this has the general form:\n$$f_i^{eq} = w_i \\left( a^{(0)} + \\frac{a_{\\alpha}^{(1)} c_{i\\alpha}}{c_s^2} + \\frac{a_{\\alpha\\beta}^{(2)} (c_{i\\alpha}c_{i\\beta} - c_s^2\\delta_{\\alpha\\beta})}{2c_s^4} \\right)$$\nwhere $a^{(0)}$, $a_\\alpha^{(1)}$, and $a_{\\alpha\\beta}^{(2)}$ are the zeroth, first, and second raw moments of $f_i^{eq}$ with respect to velocity.\nThe hydrodynamic moments are given by the constraints:\n-   $a^{(0)} = \\sum_i f_i^{eq} = \\rho$\n-   $a_{\\alpha}^{(1)} = \\sum_i f_i^{eq} c_{i\\alpha} = \\rho u_\\alpha$\n-   $\\sum_i f_i^{eq} c_{i\\alpha}c_{i\\beta} = \\rho c_s^2 \\delta_{\\alpha\\beta} + \\rho u_\\alpha u_\\beta$\n\nFrom the expansion itself, we can also compute the second moment:\n$$ \\sum_i f_i^{eq} c_{i\\alpha} c_{i\\beta} = \\sum_i w_i \\left( a^{(0)} + \\frac{a_{\\gamma}^{(1)} c_{i\\gamma}}{c_s^2} + \\frac{a_{\\gamma\\delta}^{(2)} (c_{i\\gamma}c_{i\\delta} - c_s^2\\delta_{\\gamma\\delta})}{2c_s^4} \\right) c_{i\\alpha} c_{i\\beta} $$\nUsing the lattice isotropy properties $\\sum_i w_i c_{i\\alpha} c_{i\\beta} = c_s^2 \\delta_{\\alpha\\beta}$ and $\\sum_i w_i c_{i\\alpha}c_{i\\beta}c_{i\\gamma} = 0$, we get:\n$$ \\sum_i f_i^{eq} c_{i\\alpha} c_{i\\beta} = a^{(0)} c_s^2 \\delta_{\\alpha\\beta} + \\frac{a_{\\gamma\\delta}^{(2)}}{2c_s^4} \\sum_i w_i (c_{i\\gamma}c_{i\\delta} - c_s^2\\delta_{\\gamma\\delta}) c_{i\\alpha}c_{i\\beta} $$\nThe second term contains fourth-order moments. Since we are matching moments up to second order in $\\boldsymbol{u}$, the term $a_{\\gamma\\delta}^{(2)}$ is itself of order $O(|\\boldsymbol{u}|^2)$. The expansion for $\\sum f_i^{eq} c_{i\\alpha}c_{i\\beta}$ is effectively $\\rho c_s^2 \\delta_{\\alpha\\beta} + a_{\\alpha\\beta}^{(2)}$.\nBy comparing with the constraint $\\rho c_s^2 \\delta_{\\alpha\\beta} + \\rho u_\\alpha u_\\beta$, we can identify the second-order moment coefficient as $a_{\\alpha\\beta}^{(2)} = \\rho u_\\alpha u_\\beta$.\n\nSubstituting $a^{(0)}=\\rho$, $a_{\\alpha}^{(1)}=\\rho u_\\alpha$, and $a_{\\alpha\\beta}^{(2)}=\\rho u_\\alpha u_\\beta$ back into the expansion for $f_i^{eq}$:\n$$ f_i^{eq} = w_i \\left( \\rho + \\frac{(\\rho u_\\alpha) c_{i\\alpha}}{c_s^2} + \\frac{(\\rho u_\\alpha u_\\beta) (c_{i\\alpha}c_{i\\beta} - c_s^2\\delta_{\\alpha\\beta})}{2c_s^4} \\right) $$\nFactoring out $\\rho$:\n$$ f_i^{eq} = w_i \\rho \\left( 1 + \\frac{u_\\alpha c_{i\\alpha}}{c_s^2} + \\frac{u_\\alpha u_\\beta c_{i\\alpha}c_{i\\beta} - u_\\alpha u_\\beta c_s^2 \\delta_{\\alpha\\beta}}{2c_s^4} \\right) $$\nIn vector notation, this is:\n$$ f_i^{eq}(\\rho, \\boldsymbol{u}) = w_i \\rho \\left( 1 + \\frac{\\boldsymbol{c}_i \\cdot \\boldsymbol{u}}{c_s^2} + \\frac{(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^2}{2c_s^4} - \\frac{|\\boldsymbol{u}|^2}{2c_s^2} \\right) $$\nThis is the general form of the D2Q9 equilibrium distribution function consistent with the moment conditions up to second order in $|\\boldsymbol{u}|$.\n\n### Calculation of Specific Equilibrium Populations\n\nWe are given $\\rho = \\frac{5}{4}$, $\\boldsymbol{u} = \\left(\\frac{1}{6}, -\\frac{1}{9}\\right)$, and $c_s^2=\\frac{1}{3}$.\nWe substitute these into the derived formula. First, calculate the common terms:\n$$ \\frac{1}{c_s^2} = 3 $$\n$$ \\frac{1}{2c_s^4} = \\frac{9}{2} $$\n$$ |\\boldsymbol{u}|^2 = u_x^2 + u_y^2 = \\left(\\frac{1}{6}\\right)^2 + \\left(-\\frac{1}{9}\\right)^2 = \\frac{1}{36} + \\frac{1}{81} = \\frac{9+4}{324} = \\frac{13}{324} $$\nThe expression becomes:\n$$ f_i^{eq} = w_i \\left(\\frac{5}{4}\\right) \\left( 1 + 3(\\boldsymbol{c}_i \\cdot \\boldsymbol{u}) + \\frac{9}{2}(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^2 - \\frac{3}{2}\\frac{13}{324} \\right) = w_i \\left(\\frac{5}{4}\\right) \\left( 1 + 3(\\boldsymbol{c}_i \\cdot \\boldsymbol{u}) + \\frac{9}{2}(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^2 - \\frac{13}{216} \\right) $$\nNow, we compute $\\boldsymbol{c}_i \\cdot \\boldsymbol{u}$ for each $i$:\n$\\boldsymbol{c}_0 \\cdot \\boldsymbol{u} = 0$,\n$\\boldsymbol{c}_1 \\cdot \\boldsymbol{u} = \\frac{1}{6}$,\n$\\boldsymbol{c}_2 \\cdot \\boldsymbol{u} = -\\frac{1}{9}$,\n$\\boldsymbol{c}_3 \\cdot \\boldsymbol{u} = -\\frac{1}{6}$,\n$\\boldsymbol{c}_4 \\cdot \\boldsymbol{u} = \\frac{1}{9}$,\n$\\boldsymbol{c}_5 \\cdot \\boldsymbol{u} = \\frac{1}{6}-\\frac{1}{9} = \\frac{1}{18}$,\n$\\boldsymbol{c}_6 \\cdot \\boldsymbol{u} = -\\frac{1}{6}-\\frac{1}{9} = -\\frac{5}{18}$,\n$\\boldsymbol{c}_7 \\cdot \\boldsymbol{u} = -\\frac{1}{6}+\\frac{1}{9} = -\\frac{1}{18}$,\n$\\boldsymbol{c}_8 \\cdot \\boldsymbol{u} = \\frac{1}{6}+\\frac{1}{9} = \\frac{5}{18}$.\n\nLet $S_i = 1 + 3(\\boldsymbol{c}_i \\cdot \\boldsymbol{u}) + \\frac{9}{2}(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^2 - \\frac{13}{216}$. We compute $f_i^{eq} = w_i (\\frac{5}{4}) S_i$:\n-   $i=0$: $S_0 = 1 - \\frac{13}{216} = \\frac{203}{216}$. $f_0^{eq} = \\frac{4}{9} \\frac{5}{4} \\frac{203}{216} = \\frac{5}{9} \\frac{203}{216} = \\frac{1015}{1944}$.\n-   $i=1$: $S_1 = 1 + 3(\\frac{1}{6}) + \\frac{9}{2}(\\frac{1}{36}) - \\frac{13}{216} = 1 + \\frac{1}{2} + \\frac{1}{8} - \\frac{13}{216} = \\frac{216+108+27-13}{216} = \\frac{338}{216} = \\frac{169}{108}$. $f_1^{eq} = \\frac{1}{9} \\frac{5}{4} \\frac{169}{108} = \\frac{5}{36} \\frac{169}{108} = \\frac{845}{3888}$.\n-   $i=2$: $S_2 = 1 + 3(-\\frac{1}{9}) + \\frac{9}{2}(\\frac{1}{81}) - \\frac{13}{216} = 1 - \\frac{1}{3} + \\frac{1}{18} - \\frac{13}{216} = \\frac{216-72+12-13}{216} = \\frac{143}{216}$. $f_2^{eq} = \\frac{1}{9} \\frac{5}{4} \\frac{143}{216} = \\frac{5}{36} \\frac{143}{216} = \\frac{715}{7776}$.\n-   $i=3$: $S_3 = 1 + 3(-\\frac{1}{6}) + \\frac{9}{2}(\\frac{1}{36}) - \\frac{13}{216} = 1 - \\frac{1}{2} + \\frac{1}{8} - \\frac{13}{216} = \\frac{216-108+27-13}{216} = \\frac{122}{216} = \\frac{61}{108}$. $f_3^{eq} = \\frac{1}{9} \\frac{5}{4} \\frac{61}{108} = \\frac{5}{36} \\frac{61}{108} = \\frac{305}{3888}$.\n-   $i=4$: $S_4 = 1 + 3(\\frac{1}{9}) + \\frac{9}{2}(\\frac{1}{81}) - \\frac{13}{216} = 1 + \\frac{1}{3} + \\frac{1}{18} - \\frac{13}{216} = \\frac{216+72+12-13}{216} = \\frac{287}{216}$. $f_4^{eq} = \\frac{1}{9} \\frac{5}{4} \\frac{287}{216} = \\frac{5}{36} \\frac{287}{216} = \\frac{1435}{7776}$.\n-   $i=5$: $S_5 = 1 + 3(\\frac{1}{18}) + \\frac{9}{2}(\\frac{1}{324}) - \\frac{13}{216} = 1 + \\frac{1}{6} + \\frac{1}{72} - \\frac{13}{216} = \\frac{216+36+3-13}{216} = \\frac{242}{216} = \\frac{121}{108}$. $f_5^{eq} = \\frac{1}{36} \\frac{5}{4} \\frac{121}{108} = \\frac{5}{144} \\frac{121}{108} = \\frac{605}{15552}$.\n-   $i=6$: $S_6 = 1 + 3(-\\frac{5}{18}) + \\frac{9}{2}(\\frac{25}{324}) - \\frac{13}{216} = 1 - \\frac{5}{6} + \\frac{25}{72} - \\frac{13}{216} = \\frac{216-180+75-13}{216} = \\frac{98}{216} = \\frac{49}{108}$. $f_6^{eq} = \\frac{1}{36} \\frac{5}{4} \\frac{49}{108} = \\frac{5}{144} \\frac{49}{108} = \\frac{245}{15552}$.\n-   $i=7$: $S_7 = 1 + 3(-\\frac{1}{18}) + \\frac{9}{2}(\\frac{1}{324}) - \\frac{13}{216} = 1 - \\frac{1}{6} + \\frac{1}{72} - \\frac{13}{216} = \\frac{216-36+3-13}{216} = \\frac{170}{216} = \\frac{85}{108}$. $f_7^{eq} = \\frac{1}{36} \\frac{5}{4} \\frac{85}{108} = \\frac{5}{144} \\frac{85}{108} = \\frac{425}{15552}$.\n-   $i=8$: $S_8 = 1 + 3(\\frac{5}{18}) + \\frac{9}{2}(\\frac{25}{324}) - \\frac{13}{216} = 1 + \\frac{5}{6} + \\frac{25}{72} - \\frac{13}{216} = \\frac{216+180+75-13}{216} = \\frac{458}{216} = \\frac{229}{108}$. $f_8^{eq} = \\frac{1}{36} \\frac{5}{4} \\frac{229}{108} = \\frac{5}{144} \\frac{229}{108} = \\frac{1145}{15552}$.\n\n### Verification of Moment Recovery\n\n**Density:** The sum $\\sum_{i=0}^{8} f_i^{eq}$ must equal $\\rho = \\frac{5}{4}$. By construction, the analytical sum of the formula for $f_i^{eq}$ yields $\\rho$. Let's verify with the numerical values. Using a common denominator of $15552$:\n$$ \\sum f_i^{eq} = \\frac{8120 + 3380 + 1430 + 1220 + 2870 + 605 + 245 + 425 + 1145}{15552} = \\frac{19440}{15552} = \\frac{5 \\times 3888}{4 \\times 3888} = \\frac{5}{4} $$\nThe density is correctly recovered.\n\n**Momentum:** The sum $\\sum_{i=0}^{8} f_i^{eq} \\boldsymbol{c}_i$ must equal $\\rho\\boldsymbol{u} = \\frac{5}{4}(\\frac{1}{6}, -\\frac{1}{9}) = (\\frac{5}{24}, -\\frac{5}{36})$.\n-   x-component: $\\sum f_i^{eq} c_{ix} = f_1^{eq}-f_3^{eq}+f_5^{eq}-f_6^{eq}-f_7^{eq}+f_8^{eq}$\n$$ \\sum f_i^{eq} c_{ix} = \\frac{3380 - 1220 + 605 - 245 - 425 + 1145}{15552} = \\frac{3240}{15552} = \\frac{5 \\times 648}{24 \\times 648} = \\frac{5}{24} $$\n-   y-component: $\\sum f_i^{eq} c_{iy} = f_2^{eq}-f_4^{eq}+f_5^{eq}+f_6^{eq}-f_7^{eq}-f_8^{eq}$\n$$ \\sum f_i^{eq} c_{iy} = \\frac{1430 - 2870 + 605 + 245 - 425 - 1145}{15552} = \\frac{-2160}{15552} = \\frac{-5 \\times 432}{36 \\times 432} = -\\frac{5}{36} $$\nThe momentum is also correctly recovered. The computed values are correct.\nSo, the twelve quantities for the final answer are:\n$f_0^{eq} = \\frac{1015}{1944}$, $f_1^{eq} = \\frac{845}{3888}$, $f_2^{eq} = \\frac{715}{7776}$, $f_3^{eq} = \\frac{305}{3888}$, $f_4^{eq} = \\frac{1435}{7776}$, $f_5^{eq} = \\frac{605}{15552}$, $f_6^{eq} = \\frac{245}{15552}$, $f_7^{eq} = \\frac{425}{15552}$, $f_8^{eq} = \\frac{1145}{15552}$, $\\sum f_i^{eq} = \\frac{5}{4}$, $\\sum (f_i^{eq} c_{ix}) = \\frac{5}{24}$, $\\sum (f_i^{eq} c_{iy}) = -\\frac{5}{36}$.", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1015}{1944} & \\frac{845}{3888} & \\frac{715}{7776} & \\frac{305}{3888} & \\frac{1435}{7776} & \\frac{605}{15552} & \\frac{245}{15552} & \\frac{425}{15552}  \\frac{1145}{15552}  \\frac{5}{4}  \\frac{5}{24}  -\\frac{5}{36} \\end{pmatrix}}\n$$", "id": "3375057"}, {"introduction": "Beyond implementation, a deep understanding of a numerical scheme requires analyzing its stability and accuracy. This exercise guides you through a von Neumann stability analysis of the linearized LBM, a fundamental technique for examining how the method handles different physical modes [@problem_id:3375028]. By deriving the dispersion relation for a shear wave, you will uncover the precise relationship between the relaxation time $\\tau$ and the physical viscosity $\\nu$, and identify the source of the method's intrinsic numerical dissipation.", "problem": "Consider the two-dimensional nine-velocity lattice (D2Q9) Bhatnagar–Gross–Krook (BGK) Lattice Boltzmann Method (LBM) for an isothermal fluid. The discrete velocities are $ \\mathbf{c}_{0} = (0,0) $, $ \\mathbf{c}_{1} = (1,0) $, $ \\mathbf{c}_{2} = (0,1) $, $ \\mathbf{c}_{3} = (-1,0) $, $ \\mathbf{c}_{4} = (0,-1) $, $ \\mathbf{c}_{5} = (1,1) $, $ \\mathbf{c}_{6} = (-1,1) $, $ \\mathbf{c}_{7} = (-1,-1) $, $ \\mathbf{c}_{8} = (1,-1) $, with corresponding weights $ w_{0} = \\frac{4}{9} $, $ w_{1,2,3,4} = \\frac{1}{9} $, $ w_{5,6,7,8} = \\frac{1}{36} $. The single-relaxation-time BGK update for the distribution functions $ f_{i}(\\mathbf{x}, t) $ reads\n$$\nf_{i}(\\mathbf{x} + \\mathbf{c}_{i} \\Delta t, t + \\Delta t) = f_{i}(\\mathbf{x}, t) - \\frac{\\Delta t}{\\tau} \\left( f_{i}(\\mathbf{x}, t) - f_{i}^{\\mathrm{eq}}(\\mathbf{x}, t) \\right),\n$$\nwhere $ \\tau $ is the relaxation time and $ f_{i}^{\\mathrm{eq}} $ is the second-order isothermal equilibrium distribution expanded in the fluid velocity $ \\mathbf{u}(\\mathbf{x}, t) $,\n$$\nf_{i}^{\\mathrm{eq}} = w_{i} \\rho \\left[ 1 + \\frac{\\mathbf{c}_{i} \\cdot \\mathbf{u}}{c_{s}^{2}} + \\frac{(\\mathbf{c}_{i} \\cdot \\mathbf{u})^{2}}{2 c_{s}^{4}} - \\frac{\\mathbf{u} \\cdot \\mathbf{u}}{2 c_{s}^{2}} \\right],\n$$\nwith $ \\rho $ the mass density and $ c_{s}^{2} $ the lattice speed of sound. For D2Q9 in lattice units, $ c_{s}^{2} = \\frac{1}{3} $ and $ \\Delta x = \\Delta t = 1 $.\n\nLinearize the D2Q9 BGK LBM around a uniform equilibrium state $ \\rho(\\mathbf{x}, t) = \\rho_{0} $ and $ \\mathbf{u}(\\mathbf{x}, t) = \\mathbf{0} $, and consider a transverse (shear) plane-wave perturbation with wavevector $ \\mathbf{k} = (k, 0) $ so that the only nonzero velocity component is $ u_{y}(x,t) $. Perform a von Neumann (Fourier) stability analysis of the linearized update and derive, to leading order in $ |k| $, the complex angular frequency $ \\omega(k) $ (defined by a time dependence $ \\exp(- i \\omega t) $) for the shear mode. Use the isothermal limit and assume the hydrodynamic (long-wavelength) regime.\n\nIdentify from your dispersion relation which part corresponds to numerical dissipation and which part corresponds to numerical dispersion in the shear mode. Express your final answer as a single closed-form analytical expression for $ \\omega(k) $ in terms of $ k $, $ \\tau $, and $ c_{s}^{2} $. No numerical approximation or rounding is required. The final answer must contain no units inside the expression.", "solution": "The problem requires a von Neumann stability analysis of the D2Q9 BGK Lattice Boltzmann Method (LBM) for a transverse shear wave to find the dispersion relation $\\omega(k)$ in the long-wavelength limit.\n\n### Step 1: Linearization of the BGK Equation\n\nThe LBM describes the evolution of particle distribution functions $f_i(\\mathbf{x}, t)$. The BGK update rule is given as:\n$$\nf_{i}(\\mathbf{x} + \\mathbf{c}_{i} \\Delta t, t + \\Delta t) = f_{i}(\\mathbf{x}, t) - \\frac{\\Delta t}{\\tau} \\left( f_{i}(\\mathbf{x}, t) - f_{i}^{\\mathrm{eq}}(\\mathbf{x}, t) \\right)\n$$\nIn lattice units, $\\Delta t = 1$, so the equation is:\n$$\nf_{i}(\\mathbf{x} + \\mathbf{c}_{i}, t + 1) = \\left(1 - \\frac{1}{\\tau}\\right) f_{i}(\\mathbf{x}, t) + \\frac{1}{\\tau} f_{i}^{\\mathrm{eq}}(\\mathbf{x}, t)\n$$\nWe linearize the system around a uniform rest state defined by constant density $\\rho_0$ and zero velocity $\\mathbf{u}_0 = \\mathbf{0}$. The distribution functions and macroscopic variables are perturbed as:\n$f_i = f_i^{(0)} + \\delta f_i$, where $f_i^{(0)} = w_i \\rho_0$.\n$\\rho = \\rho_0 + \\delta \\rho$.\n$\\mathbf{u} = \\mathbf{0} + \\delta \\mathbf{u}$.\n\nThe macroscopic perturbations are moments of the distribution function perturbations:\n$\\delta \\rho = \\sum_i \\delta f_i$.\n$\\rho_0 \\delta \\mathbf{u} = \\sum_i \\mathbf{c}_i \\delta f_i$.\n\nThe equilibrium distribution $f_i^{\\mathrm{eq}}$ is expanded to first order in the perturbations $\\delta \\rho$ and $\\delta \\mathbf{u}$:\n$$\nf_{i}^{\\mathrm{eq}} = w_{i} (\\rho_0+\\delta\\rho) \\left[ 1 + \\frac{\\mathbf{c}_{i} \\cdot \\delta\\mathbf{u}}{c_{s}^{2}} + \\mathcal{O}(|\\delta\\mathbf{u}|^2) \\right] \\approx w_i \\rho_0 + w_i \\delta\\rho + \\frac{w_i\\rho_0}{c_s^2}(\\mathbf{c}_i \\cdot \\delta\\mathbf{u})\n$$\nThe perturbation in the equilibrium distribution is $\\delta f_i^{\\mathrm{eq}} = f_i^{\\mathrm{eq}} - f_i^{(0)}$:\n$$\n\\delta f_i^{\\mathrm{eq}} = w_i \\delta\\rho + \\frac{w_i\\rho_0}{c_s^2}(\\mathbf{c}_i \\cdot \\delta\\mathbf{u})\n$$\nSubstituting the perturbed quantities into the BGK equation and retaining only first-order terms gives the linearized LBE for the perturbations:\n$$\n\\delta f_{i}(\\mathbf{x} + \\mathbf{c}_{i}, t + 1) = \\left(1 - \\frac{1}{\\tau}\\right) \\delta f_{i}(\\mathbf{x}, t) + \\frac{1}{\\tau} \\delta f_{i}^{\\mathrm{eq}}(\\mathbf{x}, t)\n$$\n\n### Step 2: Fourier Analysis\nWe perform a von Neumann analysis by assuming a plane-wave form for all perturbations, $\\delta A(\\mathbf{x}, t) = \\hat{A} \\exp(i \\mathbf{k} \\cdot \\mathbf{x} - i \\omega t)$. The eigenvalue of the time-stepping operator is $\\lambda = \\exp(-i \\omega \\Delta t) = \\exp(-i\\omega)$. The linearized LBE becomes an algebraic equation for the Fourier amplitudes $\\widehat{\\delta f_i}$:\n$$\n\\lambda e^{i \\mathbf{k} \\cdot \\mathbf{c}_i} \\widehat{\\delta f_i} = \\left(1 - \\frac{1}{\\tau}\\right) \\widehat{\\delta f_i} + \\frac{1}{\\tau} \\widehat{\\delta f_i^{\\mathrm{eq}}}\n$$\nRearranging for $\\widehat{\\delta f_i}$:\n$$\n\\widehat{\\delta f_i} = \\frac{1/\\tau}{\\lambda e^{i \\mathbf{k} \\cdot \\mathbf{c}_i} - (1 - 1/\\tau)} \\widehat{\\delta f_i^{\\mathrm{eq}}}\n$$\nFor the specific case of a transverse shear wave, the wavevector is $\\mathbf{k}=(k, 0)$ and the velocity perturbation is purely transverse, $\\delta\\mathbf{u}=(0, \\delta u_y)$. For a pure shear mode, the density perturbation is zero, $\\delta\\rho = 0$. This is consistent with the Navier-Stokes equations and can be verified to be a consistent decoupling in the LBM equations. Under these conditions, the perturbation in the equilibrium distribution simplifies to:\n$$\n\\widehat{\\delta f_i^{\\mathrm{eq}}} = \\frac{w_i \\rho_0}{c_s^2} c_{iy} \\widehat{\\delta u_y}\n$$\nSubstituting this into the expression for $\\widehat{\\delta f_i}$:\n$$\n\\widehat{\\delta f_i} = \\frac{1/\\tau}{\\lambda e^{i k c_{ix}} - (1 - 1/\\tau)} \\frac{w_i \\rho_0}{c_s^2} c_{iy} \\widehat{\\delta u_y}\n$$\n\n### Step 3: Derivation of the Dispersion Relation\nThe dispersion relation is found by enforcing the self-consistency condition for the velocity moment $\\rho_0 \\widehat{\\delta u_y} = \\sum_i c_{iy} \\widehat{\\delta f_i}$.\n$$\n\\rho_0 \\widehat{\\delta u_y} = \\sum_i c_{iy} \\left( \\frac{1/\\tau}{\\lambda e^{i k c_{ix}} - (1 - 1/\\tau)} \\frac{w_i \\rho_0}{c_s^2} c_{iy} \\widehat{\\delta u_y} \\right)\n$$\nAssuming a non-trivial solution $\\widehat{\\delta u_y} \\neq 0$, we can cancel $\\rho_0 \\widehat{\\delta u_y}$ from both sides to obtain the exact dispersion relation:\n$$\n1 = \\frac{1}{\\tau c_s^2} \\sum_i \\frac{w_i c_{iy}^2}{\\lambda e^{i k c_{ix}} - (1 - 1/\\tau)}\n$$\nWe now analyze this relation in the hydrodynamic limit, where $k$ and $\\omega$ are small. This corresponds to $\\lambda = e^{-i\\omega} \\approx 1-i\\omega$. For a diffusive mode, $\\omega \\sim k^2$. We expand the denominator up to second order in $k$:\n$$\n\\lambda e^{i k c_{ix}} \\approx (1-i\\omega)(1 + i k c_{ix} - \\frac{1}{2} k^2 c_{ix}^2) \\approx 1 - i\\omega + i k c_{ix} - \\frac{1}{2} k^2 c_{ix}^2\n$$\nLet $A = \\lambda - (1 - 1/\\tau)$. The denominator is $A + \\lambda(ik c_{ix} - \\frac{1}{2} k^2 c_{ix}^2)$. We expand the fraction $1/(A+\\dots)$ using a Taylor series:\n$$\n\\frac{1}{A + \\delta} \\approx \\frac{1}{A}\\left(1 - \\frac{\\delta}{A} + \\frac{\\delta^2}{A^2}\\right)\n$$\nwith $\\delta = \\lambda(ik c_{ix} - \\frac{1}{2} k^2 c_{ix}^2)$.\nLet's substitute this into the sum:\n$$\n\\tau c_s^2 = \\sum_i \\frac{w_i c_{iy}^2}{A} \\left[ 1 - \\frac{\\lambda}{A}\\left(ikc_{ix} - \\frac{k^2c_{ix}^2}{2}\\right) + \\frac{\\lambda^2}{A^2}(ik c_{ix})^2 + \\dots \\right]\n$$\nOrganizing terms by powers of $k$:\n$$\n\\tau c_s^2 = \\frac{1}{A}\\sum_i w_i c_{iy}^2 - \\frac{i \\lambda k}{A^2}\\sum_i w_i c_{iy}^2c_{ix} + \\frac{k^2}{A^2}\\left(\\frac{\\lambda}{2}\\sum_i w_i c_{iy}^2c_{ix}^2 - \\frac{\\lambda^2}{A}\\sum_i w_i c_{iy}^2c_{ix}^2\\right) + \\mathcal{O}(k^3)\n$$\nUsing the following isotropy properties of the D2Q9 lattice:\n$\\sum_i w_i c_{iy}^2 = c_s^2$\n$\\sum_i w_i c_{iy}^2 c_{ix} = 0$ (due to symmetry)\n$\\sum_i w_i c_{ix}^2 c_{iy}^2 = c_s^4$ (for D2Q9. In general, $\\sum_i w_i c_{i\\alpha}c_{i\\beta}c_{i\\gamma}c_{i\\delta}=c_s^4(\\delta_{\\alpha\\beta}\\delta_{\\gamma\\delta}+\\delta_{\\alpha\\gamma}\\delta_{\\beta\\delta}+\\delta_{\\alpha\\delta}\\delta_{\\beta\\gamma})$)\n\nThe dispersion relation simplifies to:\n$$\n\\tau c_s^2 = \\frac{c_s^2}{A} + k^2 c_s^4 \\left( \\frac{\\lambda}{2A^2} - \\frac{\\lambda^2}{A^3} \\right)\n$$\nIn the hydrodynamic limit ($k \\to 0, \\omega \\to 0$), $\\lambda \\to 1$ and $A \\to 1 - (1-1/\\tau) = 1/\\tau$.\nWe keep terms to leading order in $\\omega$ and $k^2$.\nLet $A = 1/\\tau - i\\omega$.\n$$\n\\tau c_s^2 = \\frac{c_s^2}{1/\\tau - i\\omega} + k^2 c_s^4 \\left( \\frac{1}{2(1/\\tau)^2} - \\frac{1}{(1/\\tau)^3} \\right) + \\mathcal{O}(\\omega^2, k^4, \\omega k^2)\n$$\n$$\n\\tau c_s^2 \\approx c_s^2 \\tau(1+i\\omega\\tau) + k^2 c_s^4 \\left( \\frac{\\tau^2}{2} - \\tau^3 \\right)\n$$\n$$\n\\tau c_s^2 \\approx \\tau c_s^2 + i\\omega\\tau^2 c_s^2 + k^2 c_s^4 \\tau^2 \\left(\\frac{1}{2}-\\tau\\right)\n$$\nCanceling $\\tau c_s^2$ on both sides:\n$$\n0 \\approx i\\omega\\tau^2 c_s^2 + k^2 c_s^4 \\tau^2 \\left(\\frac{1}{2}-\\tau\\right)\n$$\nSolving for $\\omega(k)$:\n$$\ni\\omega = -k^2 \\frac{c_s^4 \\tau^2}{c_s^2 \\tau^2} \\left(\\frac{1}{2}-\\tau\\right) = -k^2 c_s^2 \\left(\\frac{1}{2}-\\tau\\right) = k^2 c_s^2 \\left(\\tau-\\frac{1}{2}\\right)\n$$\n$$\n\\omega(k) = -i k^2 c_s^2 \\left(\\tau - \\frac{1}{2}\\right)\n$$\n\n### Step 4: Identification of Numerical Dissipation and Dispersion\nThe derived dispersion relation to leading order is $\\omega(k) = -i k^2 c_s^2 (\\tau - \\frac{1}{2})$.\nThe complex frequency $\\omega(k)$ can be split into its real and imaginary parts, $\\omega(k) = \\mathrm{Re}(\\omega) + i\\,\\mathrm{Im}(\\omega)$. The time dependence of the mode is given by $\\exp(-i\\omega t) = \\exp(-i\\mathrm{Re}(\\omega)t) \\exp(\\mathrm{Im}(\\omega)t)$.\n\n1.  **Numerical Dispersion**: The real part, $\\mathrm{Re}(\\omega)$, governs the propagation speed of the mode. For our result, $\\mathrm{Re}(\\omega) = 0$. This is physically correct for a shear mode, which is purely diffusive and non-propagating in the incompressible Navier-Stokes equations. The absence of a real part in the leading-order term means there is no numerical dispersion at this level of approximation. Numerical dispersion would manifest as non-zero real terms, typically of order $\\mathcal{O}(k^3)$ or higher.\n\n2.  **Numerical Dissipation**: The imaginary part, $\\mathrm{Im}(\\omega)$, governs the growth or decay rate of the mode. Here, $\\mathrm{Im}(\\omega) = -k^2 c_s^2 (\\tau - \\frac{1}{2})$. For the mode to be stable (decaying), we need $\\mathrm{Im}(\\omega)  0$, which requires $\\tau  1/2$. The decay rate is $-\\mathrm{Im}(\\omega) = k^2 c_s^2 (\\tau - \\frac{1}{2})$. In the corresponding continuum equation, $\\partial_t u_y = \\nu \\nabla^2 u_y$, the decay rate is $\\nu k^2$. By comparison, the effective kinematic viscosity of the LBM fluid is $\\nu_{\\mathrm{LBM}} = c_s^2 (\\tau - 1/2)$. This effective viscosity can be decomposed into two parts:\n    $$\n    \\nu_{\\mathrm{LBM}} = \\underbrace{c_s^2 \\tau}_{\\text{physical}} - \\underbrace{\\frac{c_s^2}{2}}_{\\text{numerical}}\n    $$\n    The term $c_s^2 \\tau$ arises from the BGK collision model and corresponds to the physical viscosity. The term $-c_s^2/2$ is an artifact of the finite time-step discretization of the streaming operator ($\\mathbf{x} \\to \\mathbf{x}+\\mathbf{c}_i \\Delta t$). It represents a numerical contribution to the dissipation. In this case, it is an anti-dissipative term that reduces the overall effective viscosity. Thus, the part of the dispersion relation corresponding to numerical dissipation is the one related to the $-c_s^2/2$ term in the effective viscosity.\n\nThe final expression for the complex angular frequency is derived from the analysis.", "answer": "$$\n\\boxed{-i k^{2} c_{s}^{2} \\left(\\tau - \\frac{1}{2}\\right)}\n$$", "id": "3375028"}, {"introduction": "This capstone practice challenges you to transition from isolated calculations to building a complete 2D fluid simulator for a classic problem in turbulence: the decay of a Taylor-Green vortex [@problem_id:3375021]. You will implement not only the standard D2Q9-BGK model but also incorporate the Smagorinsky Large Eddy Simulation (LES) model, which requires calculating a spatially-varying effective viscosity. This project provides invaluable hands-on experience in advanced LBM implementation, model validation, and the interpretation of simulation results for complex flows.", "problem": "You are tasked with building, from first principles, a complete numerical simulator in the Lattice Boltzmann Method (LBM) framework to study the decay of a two-dimensional Taylor-Green vortex and the impact of subgrid modeling via the Smagorinsky Large Eddy Simulation (LES) closure on the kinetic energy decay rate. The simulator must be a single program that is fully self-contained and runnable as provided.\n\nThe fundamental starting point is the kinetic representation of fluid dynamics via the Boltzmann equation and its single-relaxation-time Bhatnagar-Gross-Krook (BGK) model in a discrete-velocity setting. In the two-dimensional nine-velocity ($\\mathrm{D2Q9}$) lattice, the discrete particle distribution functions $f_i(\\mathbf{x}, t)$ evolve under the combined action of collision and streaming. The macroscopic density $\\rho(\\mathbf{x}, t)$ and velocity $\\mathbf{u}(\\mathbf{x}, t)$ are recovered by velocity moments of $f_i$. The equilibrium distribution $f_i^{\\mathrm{eq}}$ is defined by matching those moments to the hydrodynamic fields of the isothermal lattice, and the collision step relaxes $f_i$ toward $f_i^{\\mathrm{eq}}$ at a rate controlled by the relaxation time $\\tau$. In lattice units, the kinematic viscosity $\\nu$ is linked to the relaxation time by $\\nu = c_s^2 \\left(\\tau - \\frac{1}{2}\\right)$, where $c_s^2$ is the lattice speed of sound squared. You must model the Smagorinsky LES closure as a local eddy viscosity $\\nu_t$ based on the local rate-of-strain magnitude, defining an effective viscosity $\\nu_{\\mathrm{eff}} = \\nu + \\nu_t$ and therefore a local relaxation time $\\tau_{\\mathrm{eff}} = \\frac{\\nu_{\\mathrm{eff}}}{c_s^2} + \\frac{1}{2}$. The filter width must be taken equal to the lattice spacing.\n\nThe target flow is the two-dimensional Taylor-Green vortex on a periodic square domain with side length $L$, whose initial velocity field is divergence-free and given by\n$$\nu_x(x,y,0) = U_0 \\cos(k x)\\,\\sin(k y), \\qquad\nu_y(x,y,0) = - U_0 \\sin(k x)\\,\\cos(k y),\n$$\nwith fundamental wavenumber $k = \\frac{2\\pi}{L}$. For an incompressible viscous fluid, the mode amplitude decays in time, and the kinetic energy per unit mass,\n$$\nE(t) = \\frac{1}{2}\\left\\langle u_x^2 + u_y^2 \\right\\rangle,\n$$\nhas a known reference evolution that you must use as a Direct Numerical Simulation (DNS) comparison baseline for the case without subgrid modeling. Your implementation must numerically integrate the LBM equations in time, compute the spatially averaged kinetic energy $E_{\\mathrm{LBM}}(t)$ at the final time, and compare it to the analytical reference $E_{\\mathrm{ref}}(t)$ computed from the exact viscous decay of the Taylor-Green vortex in the laminar (no LES) case. The effect of the Smagorinsky constant $C_s$ must be introduced via the eddy viscosity $\\nu_t$ defined from the local strain-rate magnitude.\n\nYou must start your derivations from the following fundamental base:\n- The discrete-velocity Boltzmann equation with Bhatnagar-Gross-Krook (BGK) relaxation in two dimensions.\n- The definition of macroscopic fields by velocity moments of the distribution functions.\n- The isothermal lattice equilibrium distribution obtained by Hermite projection that matches density and momentum up to second order.\n- The relation $\\nu = c_s^2 \\left(\\tau - \\frac{1}{2}\\right)$ in lattice units for the $\\mathrm{D2Q9}$ lattice.\n- The Smagorinsky model for Large Eddy Simulation (LES), where the eddy viscosity is $\\nu_t = \\left(C_s \\Delta\\right)^2 \\left\\lVert S \\right\\rVert$ with $\\Delta$ the filter width, $\\left\\lVert S \\right\\rVert = \\sqrt{2 S_{ij} S_{ij}}$, and $S_{ij} = \\frac{1}{2}\\left(\\partial_j u_i + \\partial_i u_j\\right)$.\n- The exact laminar Taylor-Green vortex decay in two dimensions for the reference comparison.\n\nYour program must implement:\n- A two-dimensional $\\mathrm{D2Q9}$ LBM with periodic boundary conditions on a square lattice.\n- Local relaxation time $\\tau_{\\mathrm{eff}}(\\mathbf{x}, t)$ obtained from $\\nu_{\\mathrm{eff}}(\\mathbf{x}, t) = \\nu + \\nu_t(\\mathbf{x}, t)$ with $\\nu_t$ computed from central differences for velocity gradients and $\\Delta = 1$ (lattice spacing).\n- Initialization by the Taylor-Green vortex velocity field with uniform density.\n\nScientific and numerical parameters and units:\n- Work entirely in lattice units with $\\Delta x = \\Delta y = \\Delta t = 1$, so all quantities are dimensionless in this setting.\n- Lattice size $N_x = N_y = 64$, hence $L = 64$ and $k = \\frac{2\\pi}{64}$.\n- Base kinematic viscosity $\\nu = 0.01$.\n- Initial velocity amplitude $U_0 = 0.05$.\n- Total number of time steps $N_t = 300$.\n- Use the standard $\\mathrm{D2Q9}$ velocities and weights, and $c_s^2 = \\frac{1}{3}$.\n\nTest suite:\n- The program must run four test cases, each specified by a Smagorinsky constant $C_s$: $C_s = 0.0$ (no LES), $C_s = 0.12$, $C_s = 0.18$, and $C_s = 0.24$.\n- For each test case, compute the final-time LBM kinetic energy $E_{\\mathrm{LBM}}(t=N_t)$, the analytical reference energy $E_{\\mathrm{ref}}(t=N_t)$ based on the laminar Taylor-Green decay, and report the dimensionless deviation\n$$\n\\delta(C_s) = \\frac{E_{\\mathrm{LBM}}(N_t)}{E_{\\mathrm{ref}}(N_t)} - 1.\n$$\n\nOutput specification:\n- Your program must produce a single line of output containing the results for the four test cases as a comma-separated list enclosed in square brackets, for example, $\\left[\\delta_1,\\delta_2,\\delta_3,\\delta_4\\right]$.\n- Each $\\delta(C_s)$ must be a decimal number rounded to six decimal places.\n- The output is dimensionless and must be printed exactly in the specified single-line format.\n\nThe solution must derive and justify the numerical procedure and the diagnostic quantities from the fundamental base above, explain why the Taylor-Green vortex decay is an appropriate DNS reference in this context, and elucidate how and why the Smagorinsky constant alters the decay via an increased effective viscosity. In particular, ensure your derivation clearly shows what the LBM update is, why it is correct in this regime, and how the algorithm computes the rate-of-strain and the eddy viscosity in a scientifically consistent way. Avoid nonphysical configurations and ensure stability by maintaining a relaxation time greater than $\\frac{1}{2}$ everywhere.", "solution": "The problem statement is a valid and well-posed numerical experiment in computational fluid dynamics. It requires the development of a Lattice Boltzmann Method (LBM) simulator for a two-dimensional, decaying turbulent flow, specifically the Taylor-Green vortex. The problem includes a comparison with an analytical solution and an investigation into the effects of a subgrid-scale model, the Smagorinsky Large Eddy Simulation (LES) model. All necessary physical and numerical parameters are provided, and the problem is scientifically grounded in established principles of fluid dynamics and numerical methods.\n\nThe solution will be developed from first principles, as requested. We begin with the theoretical foundation of the Lattice Boltzmann Method, then incorporate the Smagorinsky LES model, detail the specifics of the Taylor-Green vortex flow, and finally outline the complete numerical algorithm and the diagnostic quantity to be computed.\n\n**1. The Lattice Boltzmann Equation**\n\nThe LBM describes the evolution of a set of particle distribution functions, $f_i(\\mathbf{x}, t)$, on a discrete lattice. Each function $f_i$ represents the density of particles at position $\\mathbf{x}$ and time $t$ moving with a discrete velocity $\\mathbf{c}_i$. The evolution is governed by the discrete-velocity Boltzmann equation. With the Bhatnagar-Gross-Krook (BGK) approximation for the collision term, this equation is:\n$$\n\\frac{\\partial f_i}{\\partial t} + \\mathbf{c}_i \\cdot \\nabla f_i = -\\frac{1}{\\tau} \\left[ f_i(\\mathbf{x}, t) - f_i^{\\mathrm{eq}}(\\mathbf{x}, t) \\right]\n$$\nwhere $\\tau$ is the single relaxation time, which controls the rate at which the distribution functions relax towards a local equilibrium distribution, $f_i^{\\mathrm{eq}}$. Discretizing this equation in time and space with $\\Delta t = \\Delta x = 1$ (in lattice units) leads to the LBM update rule, which is typically split into two steps: collision and streaming.\n\n**Collision Step**: The right-hand side is treated. The post-collision distribution $f_i^*$ is computed at each lattice node:\n$$\nf_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x}, t) - \\frac{1}{\\tau} \\left[ f_i(\\mathbf{x}, t) - f_i^{\\mathrm{eq}}(\\mathbf{x}, t) \\right]\n$$\n\n**Streaming Step**: The advection on the left-hand side is treated. The post-collision populations move to adjacent nodes according to their discrete velocities:\n$$\nf_i(\\mathbf{x} + \\mathbf{c}_i \\Delta t, t + \\Delta t) = f_i^*(\\mathbf{x}, t)\n$$\nIn our lattice units, this simplifies to $f_i(\\mathbf{x} + \\mathbf{c}_i, t + 1) = f_i^*(\\mathbf{x}, t)$.\n\n**2. The D2Q9 Lattice Model**\n\nFor two-dimensional flows, the D2Q9 model is standard. It uses a square lattice with nine discrete velocities, $\\mathbf{c}_i$ for $i=0, \\dots, 8$.\n-   $\\mathbf{c}_0 = (0, 0)$ (rest particles)\n-   $\\mathbf{c}_{1,2,3,4} = (1, 0), (0, 1), (-1, 0), (0, -1)$ (axial velocities, speed $1$)\n-   $\\mathbf{c}_{5,6,7,8} = (1, 1), (-1, 1), (-1, -1), (1, -1)$ (diagonal velocities, speed $\\sqrt{2}$)\n\nAssociated with each velocity is a weight $w_i$:\n-   $w_0 = 4/9$\n-   $w_{1,2,3,4} = 1/9$\n-   $w_{5,6,7,8} = 1/36$\n\nThese weights and velocities are chosen such that the model recovers the Navier-Stokes equations in the low-Mach number limit. The lattice speed of sound is given by $c_s^2 = \\sum_i w_i (\\mathbf{c}_{ix})^2 = 1/3$.\n\n**3. Macroscopic Hydrodynamic Variables**\n\nThe macroscopic fluid density $\\rho$ and momentum $\\rho \\mathbf{u}$ (and thus velocity $\\mathbf{u}$) are recovered as moments of the distribution functions:\n$$\n\\rho(\\mathbf{x}, t) = \\sum_{i=0}^{8} f_i(\\mathbf{x}, t)\n$$\n$$\n\\rho(\\mathbf{x}, t) \\mathbf{u}(\\mathbf{x}, t) = \\sum_{i=0}^{8} f_i(\\mathbf{x}, t) \\mathbf{c}_i\n$$\n\n**4. Equilibrium Distribution Function**\n\nThe equilibrium distribution $f_i^{\\mathrm{eq}}$ is a function of the local macroscopic density and velocity. For the nearly incompressible (low-Mach number) regime, a second-order expansion of the Maxwell-Boltzmann distribution in terms of velocity $\\mathbf{u}$ is used:\n$$\nf_i^{\\mathrm{eq}}(\\rho, \\mathbf{u}) = w_i \\rho \\left[ 1 + \\frac{\\mathbf{c}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})^2}{2 c_s^4} - \\frac{\\mathbf{u} \\cdot \\mathbf{u}}{2 c_s^2} \\right]\n$$\nThis form ensures that the moments of $f_i^{\\mathrm{eq}}$ return the correct macroscopic $\\rho$ and $\\rho\\mathbf{u}$, and it is crucial for recovering the correct form of the Navier-Stokes equations.\n\n**5. Viscosity and the Smagorinsky LES Model**\n\nThrough a Chapman-Enskog expansion, it can be shown that the LBM-BGK model recovers the Navier-Stokes equations with a kinematic viscosity $\\nu$ related to the relaxation time $\\tau$ by:\n$$\n\\nu = c_s^2 \\left( \\tau - \\frac{1}{2} \\right)\n$$\nThe problem requires simulating a flow that may develop turbulent features at scales smaller than the lattice resolution. Large Eddy Simulation (LES) is a technique for modeling the effect of these unresolved subgrid scales on the resolved flow. The Smagorinsky model is an algebraic subgrid-scale model that introduces an eddy viscosity, $\\nu_t$, which depends on the local strain rate of the resolved flow.\nThe total effective viscosity becomes $\\nu_{\\mathrm{eff}} = \\nu + \\nu_t$, where $\\nu$ is the base molecular viscosity. The eddy viscosity is given by:\n$$\n\\nu_t = (C_s \\Delta)^2 \\left\\lVert S \\right\\rVert\n$$\nHere, $C_s$ is the dimensionless Smagorinsky constant, $\\Delta$ is the filter width (taken to be the lattice spacing, so $\\Delta = 1$), and $\\left\\lVert S \\right\\rVert$ is the magnitude of the resolved-scale strain-rate tensor $S_{ij}$.\n\nThe strain-rate tensor is defined as $S_{ij} = \\frac{1}{2}(\\partial_j u_i + \\partial_i u_j)$, where $\\partial_i \\equiv \\partial/\\partial x_i$. Its magnitude is $\\left\\lVert S \\right\\rVert = \\sqrt{2 S_{ij} S_{ij}}$. In two dimensions, this expands to:\n$$\n\\left\\lVert S \\right\\rVert = \\sqrt{2 \\left( S_{xx}^2 + S_{yy}^2 + 2 S_{xy}^2 \\right)}\n$$\nwith $S_{xx} = \\partial_x u_x$, $S_{yy} = \\partial_y u_y$, and $S_{xy} = \\frac{1}{2}(\\partial_y u_x + \\partial_x u_y)$. These velocity gradients must be computed numerically from the velocity field on the lattice at each time step. We use a second-order central difference scheme, e.g., $\\partial_x \\phi(x,y) \\approx (\\phi(x+1,y) - \\phi(x-1,y))/2$.\n\nThe introduction of $\\nu_t$ implies that the viscosity is no longer uniform. This is incorporated into the LBM by defining a local, time-dependent effective relaxation time, $\\tau_{\\mathrm{eff}}$:\n$$\n\\tau_{\\mathrm{eff}}(\\mathbf{x}, t) = \\frac{\\nu_{\\mathrm{eff}}(\\mathbf{x}, t)}{c_s^2} + \\frac{1}{2} = \\frac{\\nu + \\nu_t(\\mathbf{x}, t)}{c_s^2} + \\frac{1}{2}\n$$\nThe collision step is then performed using this local $\\tau_{\\mathrm{eff}}$:\n$$\nf_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x}, t) - \\frac{1}{\\tau_{\\mathrm{eff}}(\\mathbf{x}, t)} \\left[ f_i(\\mathbf{x}, t) - f_i^{\\mathrm{eq}}(\\mathbf{x}, t) \\right]\n$$\nA larger $C_s$ results in a larger eddy viscosity in regions of high shear, leading to a larger $\\tau_{\\mathrm{eff}}$ and consequently enhanced dissipation of kinetic energy, mimicking the physical effect of turbulent eddies. For stability, it is required that $\\tau_{\\mathrm{eff}}  1/2$ everywhere. Since $\\nu  0$ and $\\nu_t \\ge 0$, this condition is satisfied by the problem parameters ($\\nu=0.01$, so base $\\tau = 0.53  0.5$).\n\n**6. The Taylor-Green Vortex**\n\nThe Taylor-Green vortex is an exact solution to the incompressible Navier-Stokes equations on a doubly-periodic domain. It serves as a canonical problem for verifying numerical schemes for viscous and turbulent flows. The initial velocity field is given by:\n$$\nu_x(x,y,0) = U_0 \\cos(kx)\\sin(ky)\n$$\n$$\nu_y(x,y,0) = -U_0 \\sin(kx)\\cos(ky)\n$$\nwhere $k = 2\\pi/L$ is the fundamental wavenumber for a domain of side length $L$.\nFor the laminar case (i.e., without any turbulence model, corresponding to $C_s=0$), the velocity field decays analytically as:\n$$\nu_x(x,y,t) = U_0 \\cos(kx)\\sin(ky) e^{-2\\nu k^2 t}\n$$\n$$\nu_y(x,y,t) = -U_0 \\sin(kx)\\cos(ky) e^{-2\\nu k^2 t}\n$$\nThe spatially-averaged kinetic energy per unit mass, $E(t) = \\frac{1}{2} \\langle u_x^2 + u_y^2 \\rangle$, provides a single metric to track the flow's evolution. For the analytical solution, this is:\n$$\nE_{\\mathrm{ref}}(t) = \\frac{1}{2} \\left\\langle U_0^2 e^{-4\\nu k^2 t} (\\cos^2(kx)\\sin^2(ky) + \\sin^2(kx)\\cos^2(ky)) \\right\\rangle\n$$\nUsing the fact that $\\langle \\cos^2(\\cdot) \\rangle = \\langle \\sin^2(\\cdot) \\rangle = 1/2$ over a period, the spatially averaged term becomes $\\langle \\dots \\rangle = (1/2)(1/2) + (1/2)(1/2) = 1/2$. Thus, the reference analytical energy decay is:\n$$\nE_{\\mathrm{ref}}(t) = \\frac{U_0^2}{4} e^{-4\\nu k^2 t}\n$$\nThis provides the benchmark (\"DNS reference\") against which the LBM simulation for $C_s=0$ can be validated and the effect of the LES model for $C_s0$ can be quantified.\n\n**7. Numerical Algorithm and Diagnostics**\n\nThe complete algorithm for a single test case is as follows:\n\n-   **Initialization ($t=0$):**\n    1.  Define the lattice grid $(x, y)$ for a domain of size $N_x \\times N_y$. Here $N_x = N_y = L = 64$.\n    2.  Set initial density to a constant, $\\rho(\\mathbf{x}, 0) = \\rho_0 = 1$.\n    3.  Calculate the initial velocity field $\\mathbf{u}(\\mathbf{x}, 0)$ using the Taylor-Green vortex equations.\n    4.  Initialize the distribution functions to their equilibrium values: $f_i(\\mathbf{x}, 0) = f_i^{\\mathrm{eq}}(\\rho(\\mathbf{x}, 0), \\mathbf{u}(\\mathbf{x}, 0))$.\n\n-   **Time Loop (for $t=1$ to $N_t$):**\n    1.  **Streaming**: The populations are moved to neighboring nodes. A pull scheme is computationally efficient: $f_i(\\mathbf{x}, t_{post-stream}) = f_i(\\mathbf{x}-\\mathbf{c}_i, t_{post-collision})$. Periodic boundary conditions are naturally handled using modular arithmetic or `numpy.roll`.\n    2.  **Macroscopic Fields**: Compute $\\rho(\\mathbf{x}, t)$ and $\\mathbf{u}(\\mathbf{x}, t)$ from the streamed populations $f_i$ using the moment summations.\n    3.  **LES Calculation (if $C_s  0$):**\n        a. Compute the velocity-gradient components ($\\partial_x u_x, \\partial_y u_x, \\ldots$) via second-order central differences.\n        b. Assemble the strain-rate tensor components $S_{ij}$ and calculate its magnitude $\\left\\lVert S \\right\\rVert$.\n        c. Compute the eddy viscosity $\\nu_t(\\mathbf{x}, t) = C_s^2 \\left\\lVert S(\\mathbf{x}, t) \\right\\rVert$.\n        d. Determine the local effective relaxation time $\\tau_{\\mathrm{eff}}(\\mathbf{x}, t) = (\\nu + \\nu_t)/c_s^2 + 1/2$.\n    4.  **Collision**:\n        a. Calculate the equilibrium distribution $f_i^{\\mathrm{eq}}(\\mathbf{x}, t)$ from the current macroscopic $\\rho$ and $\\mathbf{u}$.\n        b. Apply the collision step using the local relaxation time $\\tau_{\\mathrm{eff}}$ (or the constant base $\\tau$ if $C_s=0$):\n           $f_i(\\mathbf{x}, t_{post-collision}) = f_i - (1/\\tau_{\\mathrm{eff}})(f_i - f_i^{\\mathrm{eq}})$.\n\n-   **Final Calculation ($t=N_t$):**\n    1.  After the final time step, compute the final velocity field $\\mathbf{u}(\\mathbf{x}, N_t)$.\n    2.  Calculate the numerical kinetic energy by averaging over the domain: $E_{\\mathrm{LBM}}(N_t) = \\frac{1}{2 N_x N_y} \\sum_{\\mathbf{x}} (u_x^2(\\mathbf{x}, N_t) + u_y^2(\\mathbf{x}, N_t))$.\n    3.  Calculate the analytical reference energy $E_{\\mathrm{ref}}(N_t) = (U_0^2/4) \\exp(-4\\nu k^2 N_t)$.\n    4.  Compute the final diagnostic quantity, the dimensionless deviation $\\delta(C_s)$:\n        $$\n        \\delta(C_s) = \\frac{E_{\\mathrm{LBM}}(N_t)}{E_{\\mathrm{ref}}(N_t)} - 1\n        $$\nThis procedure is repeated for each specified value of the Smagorinsky constant $C_s$. The case $C_s=0$ serves as a verification of the underlying solver accuracy, for which we expect $\\delta(0) \\approx 0$. For $C_s0$, the enhanced dissipation due to the eddy viscosity will cause $E_{\\mathrm{LBM}}(N_t)$ to be less than $E_{\\mathrm{ref}}(N_t)$, yielding a negative $\\delta(C_s)$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates the decay of a 2D Taylor-Green vortex using the Lattice Boltzmann Method\n    with a Smagorinsky LES model.\n    \"\"\"\n    \n    # Scientific and numerical parameters in lattice units\n    Nx = 64          # Lattice size in x-direction\n    Ny = 64          # Lattice size in y-direction\n    Nt = 300         # Total number of time steps\n    nu = 0.01        # Base kinematic viscosity\n    U0 = 0.05        # Initial velocity amplitude\n    rho0 = 1.0       # Initial uniform density\n    \n    test_cases_Cs = [0.0, 0.12, 0.18, 0.24] # Smagorinsky constants\n\n    # D2Q9 lattice parameters\n    c = np.array([[0, 0], [1, 0], [0, 1], [-1, 0], [0, -1], \n                  [1, 1], [-1, 1], [-1, -1], [1, -1]], dtype=int)\n    w = np.array([4/9, 1/9, 1/9, 1/9, 1/9, 1/36, 1/36, 1/36, 1/36])\n    cs2 = 1.0 / 3.0  # Speed of sound squared\n\n    # Pre-calculate reference energy decay for comparison\n    k = 2.0 * np.pi / Nx\n    E_ref_final = (U0**2 / 4.0) * np.exp(-4.0 * nu * k**2 * Nt)\n\n    results = []\n    \n    for Cs in test_cases_Cs:\n        \n        # --- Initialization ---\n        # Create lattice grid\n        x = np.arange(Nx)\n        y = np.arange(Ny)\n        X, Y = np.meshgrid(x, y)\n\n        # Initialize velocity field (Taylor-Green vortex)\n        ux = U0 * np.cos(k * X) * np.sin(k * Y)\n        uy = -U0 * np.sin(k * X) * np.cos(k * Y)\n\n        # Initialize density\n        rho = np.full((Ny, Nx), rho0)\n\n        # Initialize distribution functions to equilibrium\n        u_sq = ux**2 + uy**2\n        c_dot_u = np.einsum('ia,yxa-iyx', c, np.stack([ux, uy], axis=-1))\n        \n        feq = np.zeros((9, Ny, Nx))\n        for i in range(9):\n            feq[i, :, :] = w[i] * rho * (1 + c_dot_u[i]/cs2 + (c_dot_u[i]**2)/(2*cs2**2) - u_sq/(2*cs2))\n        \n        f = feq.copy()\n        \n        # Base relaxation time (for Cs=0 case)\n        tau_base = nu / cs2 + 0.5\n        omega_base = 1.0 / tau_base\n\n        # --- Time-stepping loop ---\n        for t in range(Nt):\n            # Streaming (pull scheme)\n            for i in range(9):\n                f[i, :, :] = np.roll(f[i, :, :], c[i], axis=(1, 0))\n\n            # Macroscopic variables from streamed populations\n            rho = np.sum(f, axis=0)\n            ux = np.einsum('iyx,i-yx', f, c[:, 0]) / rho\n            uy = np.einsum('iyx,i-yx', f, c[:, 1]) / rho\n\n            # --- Collision Step ---\n            # Equilibrium distribution\n            u_sq = ux**2 + uy**2\n            c_dot_u = np.einsum('ia,yxa-iyx', c, np.stack([ux, uy], axis=-1))\n            for i in range(9):\n                feq[i, :, :] = w[i] * rho * (1 + c_dot_u[i]/cs2 + (c_dot_u[i]**2)/(2*cs2**2) - u_sq/(2*cs2))\n\n            # Determine relaxation parameter omega\n            if Cs  0:\n                # Calculate strain rate tensor components using central differences\n                # Gradients are calculated using np.roll for periodic boundaries\n                # dux/dx\n                grad_ux_x = (np.roll(ux, -1, axis=1) - np.roll(ux, 1, axis=1)) / 2.0\n                # dux/dy\n                grad_ux_y = (np.roll(ux, -1, axis=0) - np.roll(ux, 1, axis=0)) / 2.0\n                # duy/dx\n                grad_uy_x = (np.roll(uy, -1, axis=1) - np.roll(uy, 1, axis=1)) / 2.0\n                # duy/dy\n                grad_uy_y = (np.roll(uy, -1, axis=0) - np.roll(uy, 1, axis=0)) / 2.0\n                \n                Sxx = grad_ux_x\n                Syy = grad_uy_y\n                Sxy = 0.5 * (grad_ux_y + grad_uy_x)\n\n                # Strain rate magnitude\n                S_mag = np.sqrt(2.0 * (Sxx**2 + Syy**2 + 2.0 * Sxy**2))\n                \n                # Eddy viscosity\n                nu_t = (Cs**2) * S_mag # Delta = 1 in lattice units\n                \n                # Effective relaxation time\n                tau_eff = (nu + nu_t) / cs2 + 0.5\n                omega = 1.0 / tau_eff\n            else:\n                omega = omega_base\n            \n            # Apply collision\n            f += omega * (feq - f)\n            \n        # --- Post-processing ---\n        # Final kinetic energy from LBM simulation\n        final_ux = np.einsum('iyx,i-yx', f, c[:, 0]) / np.sum(f, axis=0)\n        final_uy = np.einsum('iyx,i-yx', f, c[:, 1]) / np.sum(f, axis=0)\n        E_lbm_final = 0.5 * np.mean(final_ux**2 + final_uy**2)\n\n        # Calculate dimensionless deviation\n        deviation = (E_lbm_final / E_ref_final) - 1.0\n        results.append(deviation)\n\n    # Final print statement in the exact required format\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3375021"}]}