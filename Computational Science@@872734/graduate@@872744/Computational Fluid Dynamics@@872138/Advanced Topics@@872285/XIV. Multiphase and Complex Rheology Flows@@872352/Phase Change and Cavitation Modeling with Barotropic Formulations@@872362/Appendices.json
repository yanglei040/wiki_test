{"hands_on_practices": [{"introduction": "One of the most striking features of a two-phase mixture, such as bubbly water, is its dramatically reduced speed of sound compared to either of its pure constituents. This property has profound implications for both the physics and the numerical simulation of cavitating flows. This first exercise [@problem_id:3351428] guides you through deriving the mixture sound speed $c_m$ from first principles and then calculating its value to demonstrate how even a minuscule vapor volume fraction $\\alpha$ can cause a drastic drop in $c_m$. You will then connect this physical property directly to a critical numerical constraint: the Courant–Friedrichs–Lewy (CFL) stability limit for an explicit time-stepping scheme.", "problem": "A barotropic, homogeneous-equilibrium, two-phase mixture model is used to describe cavitating flow in a one-dimensional ($1$-D) explicit finite-volume simulation. Each phase is assumed barotropic with an isentropic speed of sound, and the mixture is assumed to share a common pressure and velocity (no slip, no interfacial pressure disequilibrium). The fundamental mixture ingredients are:\n- Phase bulk modulus definition for each phase $k \\in \\{l,v\\}$: $K_k = \\rho_k c_k^{2}$, where $\\rho_k$ is the phase density and $c_k$ is the isentropic speed of sound of that phase.\n- Mixture density: $\\rho_m = \\alpha \\rho_v + (1-\\alpha)\\rho_l$, where $\\alpha$ is the vapor volume fraction.\n- Mixture bulk compliance additivity under common pressure (small isentropic perturbations and fixed volume fractions during the acoustic time scale): the total volumetric strain equals the volume-fraction-weighted sum of the constituent strains.\n\nStarting from these bases and first principles of isentropic compressibility and mixture volumetric strain additivity, derive the expression for the mixture speed of sound $c_m$ in terms of $\\rho_l$, $c_l$, $\\rho_v$, $c_v$, and $\\alpha$. Then, for the numerical data below, compute $c_m$ and estimate the Courant–Friedrichs–Lewy (CFL) limited time step for a one-dimensional explicit finite-volume update:\n- Liquid density $\\rho_l = 997 \\text{ kg}\\,\\text{m}^{-3}$,\n- Liquid sound speed $c_l = 1482 \\text{ m}\\,\\text{s}^{-1}$,\n- Vapor density $\\rho_v = 0.023 \\text{ kg}\\,\\text{m}^{-3}$,\n- Vapor sound speed $c_v = 430 \\text{ m}\\,\\text{s}^{-1}$,\n- Vapor volume fraction $\\alpha = 0.001$,\n- Cell-centered mixture velocity $u = 10 \\text{ m}\\,\\text{s}^{-1}$,\n- Uniform cell size $\\Delta x = 5.0 \\times 10^{-4} \\text{ m}$,\n- Courant–Friedrichs–Lewy (CFL) number $\\mathrm{CFL} = 0.6$.\n\nAssume the characteristic signal speed controlling the explicit stability bound is the maximum eigenvalue magnitude of the one-dimensional convective–acoustic system, taken as $\\lvert u \\rvert + c_m$. Use the stability requirement\n$$\n\\Delta t \\le \\mathrm{CFL}\\,\\frac{\\Delta x}{\\lvert u \\rvert + c_m}.\n$$\nReport:\n- the mixture sound speed $c_m$ in meters per second,\n- the time step $\\Delta t$ in microseconds.\n\nRound both requested quantities to four significant figures. Provide your final answer as a row vector $\\left(c_m,\\ \\Delta t_{\\mu s}\\right)$ in that order, where $\\Delta t_{\\mu s}$ denotes the time step expressed in microseconds (not seconds).", "solution": "The problem requires the derivation of the mixture speed of sound for a homogeneous-equilibrium two-phase model and subsequent numerical computation of this speed and a corresponding explicit time-step limit. The problem is validated as scientifically grounded, well-posed, and objective.\n\n**Part 1: Derivation of the Mixture Speed of Sound $c_m$**\n\nThe speed of sound $c$ in a medium is defined by the isentropic relationship $c^2 = (\\partial p / \\partial \\rho)_s$, where $p$ is pressure, $\\rho$ is density, and the subscript $s$ denotes constant entropy. This can be expressed using the isentropic bulk modulus, $K$, as $c^2 = K/\\rho$. For the mixture, we have $c_m^2 = K_m / \\rho_m$, where $c_m$, $K_m$, and $\\rho_m$ are the mixture speed of sound, bulk modulus, and density, respectively. Our goal is to find an expression for $c_m$.\n\nThe problem states two key definitions and one core principle:\n1.  The mixture density is a volume-fraction-weighted average of the phase densities:\n    $$ \\rho_m = \\alpha \\rho_v + (1-\\alpha)\\rho_l $$\n    where $\\alpha$ is the vapor volume fraction, and the subscripts $l$ and $v$ denote the liquid and vapor phases, respectively.\n\n2.  The bulk modulus for each phase $k \\in \\{l,v\\}$ is defined as:\n    $$ K_k = \\rho_k c_k^2 $$\n\n3.  The mixture's volumetric strain is the volume-fraction-weighted sum of the constituent strains, under the assumption of common pressure.\n\nLet us formally derive the consequence of this third principle. The total volume $V$ of a mixture parcel with mass $M$ is the sum of the volumes of its constituent phases, $V = V_l + V_v$. The volume fractions are defined as $\\alpha = V_v/V$ and $1-\\alpha = V_l/V$.\n\nA differential change in total volume is $dV = dV_l + dV_v$. The volumetric strain for the mixture is defined as $\\epsilon_m = dV/V$. Dividing the volume change equation by $V$ gives:\n$$ \\epsilon_m = \\frac{dV}{V} = \\frac{dV_l}{V} + \\frac{dV_v}{V} $$\nWe can rewrite this in terms of the constituent strains, $\\epsilon_l = dV_l/V_l$ and $\\epsilon_v = dV_v/V_v$:\n$$ \\epsilon_m = \\left(\\frac{V_l}{V}\\right) \\frac{dV_l}{V_l} + \\left(\\frac{V_v}{V}\\right) \\frac{dV_v}{V_v} = (1-\\alpha)\\epsilon_l + \\alpha\\epsilon_v $$\nThis confirms the statement about the additivity of strains.\n\nThe isentropic bulk modulus $K$ relates a change in pressure $dp$ to the resulting volumetric strain $\\epsilon=dV/V$ by $K = -V(dp/dV)$, which implies $\\epsilon = -dp/K$. Applying this to the mixture and each phase (all experiencing the same pressure change $dp$):\n$$ \\epsilon_m = -\\frac{dp}{K_m}, \\quad \\epsilon_l = -\\frac{dp}{K_l}, \\quad \\epsilon_v = -\\frac{dp}{K_v} $$\nSubstituting these relations into the strain additivity equation:\n$$ -\\frac{dp}{K_m} = (1-\\alpha)\\left(-\\frac{dp}{K_l}\\right) + \\alpha\\left(-\\frac{dp}{K_v}\\right) $$\nAssuming $dp \\ne 0$, we can cancel the $-dp$ term from both sides, which yields the rule for additivity of compliance (the reciprocal of bulk modulus):\n$$ \\frac{1}{K_m} = \\frac{1-\\alpha}{K_l} + \\frac{\\alpha}{K_v} $$\nNow we substitute the definitions for bulk modulus, $K_k = \\rho_k c_k^2$ and $K_m = \\rho_m c_m^2$:\n$$ \\frac{1}{\\rho_m c_m^2} = \\frac{1-\\alpha}{\\rho_l c_l^2} + \\frac{\\alpha}{\\rho_v c_v^2} $$\nSolving for $c_m^2$ gives:\n$$ c_m^2 = \\frac{1}{\\rho_m \\left( \\frac{1-\\alpha}{\\rho_l c_l^2} + \\frac{\\alpha}{\\rho_v c_v^2} \\right)} $$\nFinally, substituting the expression for the mixture density $\\rho_m$ yields the complete formula for the mixture speed of sound:\n$$ c_m = \\left[ (\\alpha \\rho_v + (1-\\alpha)\\rho_l) \\left( \\frac{1-\\alpha}{\\rho_l c_l^2} + \\frac{\\alpha}{\\rho_v c_v^2} \\right) \\right]^{-\\frac{1}{2}} $$\nThis is the required expression.\n\n**Part 2: Numerical Calculation**\n\nWe are given the following numerical data:\n- $\\rho_l = 997 \\text{ kg}\\,\\text{m}^{-3}$\n- $c_l = 1482 \\text{ m}\\,\\text{s}^{-1}$\n- $\\rho_v = 0.023 \\text{ kg}\\,\\text{m}^{-3}$\n- $c_v = 430 \\text{ m}\\,\\text{s}^{-1}$\n- $\\alpha = 0.001$\n- $u = 10 \\text{ m}\\,\\text{s}^{-1}$\n- $\\Delta x = 5.0 \\times 10^{-4} \\text{ m}$\n- $\\mathrm{CFL} = 0.6$\n\nFirst, we calculate the mixture density $\\rho_m$:\n$$ \\rho_m = (0.001)(0.023) + (1-0.001)(997) = 0.000023 + (0.999)(997) = 0.000023 + 996.003 = 996.003023 \\text{ kg}\\,\\text{m}^{-3} $$\n\nNext, we calculate the terms in the compliance summation.\nThe liquid-phase bulk modulus is $K_l = \\rho_l c_l^2 = 997 \\times (1482)^2 = 997 \\times 2196324 = 2189735028 \\text{ Pa}$.\nThe vapor-phase bulk modulus is $K_v = \\rho_v c_v^2 = 0.023 \\times (430)^2 = 0.023 \\times 184900 = 4252.7 \\text{ Pa}$.\nThe compliance sum is:\n$$ \\frac{1-\\alpha}{K_l} + \\frac{\\alpha}{K_v} = \\frac{0.999}{2189735028} + \\frac{0.001}{4252.7} \\approx 4.5621 \\times 10^{-10} + 2.3515 \\times 10^{-7} \\approx 2.3560 \\times 10^{-7} \\text{ Pa}^{-1} $$\nWe see that the compliance is dominated by the vapor phase, even with a tiny volume fraction.\n\nNow, we compute $c_m^2$:\n$$ c_m^2 = \\frac{1}{996.003023 \\times (2.3560 \\times 10^{-7})} \\approx \\frac{1}{0.00023466} \\approx 4261.4 \\text{ m}^2\\,\\text{s}^{-2} $$\nTaking the square root to find $c_m$:\n$$ c_m = \\sqrt{4261.4} \\approx 65.2796 \\text{ m}\\,\\text{s}^{-1} $$\nRounding to four significant figures, the mixture sound speed is $c_m = 65.28 \\text{ m}\\,\\text{s}^{-1}$.\n\nNext, we compute the CFL-limited time step $\\Delta t$. The stability condition is:\n$$ \\Delta t \\le \\mathrm{CFL}\\,\\frac{\\Delta x}{\\lvert u \\rvert + c_m} $$\nThe characteristic signal speed is $|u| + c_m = |10| + 65.2796 = 75.2796 \\text{ m}\\,\\text{s}^{-1}$.\nWe calculate the maximum allowed time step:\n$$ \\Delta t = 0.6 \\times \\frac{5.0 \\times 10^{-4}}{75.2796} = \\frac{3.0 \\times 10^{-4}}{75.2796} \\approx 3.98514 \\times 10^{-6} \\text{ s} $$\nThe problem asks for the time step in microseconds ($\\mu$s). $1 \\text{ s} = 10^6 \\mu$s.\n$$ \\Delta t \\approx 3.98514 \\text{ } \\mu\\text{s} $$\nRounding to four significant figures, the time step is $\\Delta t = 3.985 \\text{ } \\mu\\text{s}$.\n\nThe final answer is presented as a row vector $(c_m, \\Delta t_{\\mu s})$.", "answer": "$$ \\boxed{ \\begin{pmatrix} 65.28  3.985 \\end{pmatrix} } $$", "id": "3351428"}, {"introduction": "The barotropic assumption, where pressure is treated as a function of density only, is a powerful simplification that decouples the energy equation from the system, significantly reducing computational cost. However, this simplification is not without its trade-offs, as it neglects thermal effects like cooling due to evaporation. This coding practice [@problem_id:3351412] challenges you to quantify the modeling error introduced by the barotropic assumption by building and comparing it against a full thermodynamic equilibrium model. By implementing both, you will gain a deeper understanding of the physical regimes where the barotropic model is a valid approximation and where its limitations can lead to significant inaccuracies.", "problem": "You are tasked with quantifying the modeling error introduced by the barotropic assumption (neglecting the energy equation) in cavitation modeling, by comparing against a full thermodynamic homogeneous equilibrium model. Construct a computational program that, for each test case, computes the pressure and the speed of sound for a cavitating mixture using:\n- A barotropic formulation that treats pressure as a function of density only.\n- A full thermodynamic formulation that enforces phase-equilibrium with energy conservation.\n\nStarting point and definitions:\n- Use the homogeneous equilibrium model (HEM), in which phases share a common pressure and temperature, and the mixture is treated as a single continuum.\n- Liquid phase equation of state (Tait equation): $$p + B = B \\left(\\frac{\\rho_l}{\\rho_0}\\right)^n$$ with constants $B$ and $n$ and a reference density $\\rho_0$.\n- Vapor phase equation of state (ideal gas): $$p = \\rho_v R_v T$$ with $R_v$ the specific gas constant for water vapor.\n- Saturation pressure model (Clausius–Clapeyron in integrated form): $$p_{\\mathrm{sat}}(T) = p_{\\mathrm{sat,ref}} \\exp\\left(\\frac{L_0}{R_v}\\left(\\frac{1}{T_{\\mathrm{sat,ref}}} - \\frac{1}{T}\\right)\\right)$$ where $L_0$ is the latent heat of vaporization at the reference state, $p_{\\mathrm{sat,ref}}$ is the reference saturation pressure at $T_{\\mathrm{sat,ref}}$.\n- Mixture density closure under homogeneity: $$\\rho_{\\mathrm{mix}} = \\alpha_l \\rho_l + \\alpha_v \\rho_v$$ where $\\alpha_l$ and $\\alpha_v$ are liquid and vapor volume fractions, with $\\alpha_l + \\alpha_v = 1$.\n- Mixture specific enthalpy closure: $$h_{\\mathrm{mix}} = Y_l h_l(T) + Y_v h_v(T), \\quad Y_v = \\frac{\\alpha_v \\rho_v}{\\rho_{\\mathrm{mix}}}, \\quad Y_l = 1 - Y_v$$ using $h_l(T) = c_{p,l}(T - T_{\\mathrm{h,ref}})$ and $h_v(T) = L_0 + c_{p,v}(T - T_{\\mathrm{h,ref}})$, with $c_{p,l}$ and $c_{p,v}$ the constant specific heats of liquid and vapor, and $T_{\\mathrm{h,ref}}$ the enthalpy reference temperature.\n- Liquid speed of sound from Tait equation: $$c_l^2 = \\frac{\\partial p}{\\partial \\rho_l} = n \\frac{p + B}{\\rho_l}$$\n- Vapor speed of sound (ideal gas): $$c_v^2 = \\gamma_v R_v T$$ with $\\gamma_v$ the ratio of specific heats for vapor.\n- Mixture speed of sound (Wood’s formula): $$\\frac{1}{\\rho_{\\mathrm{mix}} c_{\\mathrm{mix}}^2} = \\frac{\\alpha_l}{\\rho_l c_l^2} + \\frac{\\alpha_v}{\\rho_v c_v^2}$$\n\nBarotropic formulation:\n- Define the barotropic pressure $p_{\\mathrm{bar}}(\\rho_{\\mathrm{mix}})$ as:\n  - If $\\rho_{\\mathrm{mix}} \\ge \\rho_l(p_{\\mathrm{sat}}(T_0))$ (pure liquid), invert Tait: $$p_{\\mathrm{bar}} = B\\left(\\left(\\frac{\\rho_{\\mathrm{mix}}}{\\rho_0}\\right)^n - 1\\right)$$ and $$c_{\\mathrm{bar}} = \\sqrt{n\\frac{p_{\\mathrm{bar}} + B}{\\rho_{\\mathrm{mix}}}}.$$\n  - Else (two-phase plateau), set $$p_{\\mathrm{bar}} = p_{\\mathrm{sat}}(T_0),$$ compute $$\\rho_l^{(0)} = \\rho_l\\left(p_{\\mathrm{sat}}(T_0)\\right), \\quad \\rho_v^{(0)} = \\frac{p_{\\mathrm{sat}}(T_0)}{R_v T_0}, \\quad \\alpha_v^{(0)} = \\frac{\\rho_{\\mathrm{mix}} - \\rho_l^{(0)}}{\\rho_v^{(0)} - \\rho_l^{(0)}},$$ then compute $$c_{\\mathrm{bar}}$$ via Wood’s formula using $c_l$ at $p_{\\mathrm{sat}}(T_0)$ and $c_v$ at $T_0$.\n\nFull thermodynamic equilibrium with energy conservation:\n- Let the upstream all-liquid temperature be $T_0$; the upstream mixture specific enthalpy is $$h_0 = h_l(T_0) = c_{p,l}(T_0 - T_{\\mathrm{h,ref}}).$$\n- If $\\rho_{\\mathrm{mix}} \\ge \\rho_l(p_{\\mathrm{sat}}(T_0))$ (pure liquid), invert Tait to get $$p_{\\mathrm{full}} = B\\left(\\left(\\frac{\\rho_{\\mathrm{mix}}}{\\rho_0}\\right)^n - 1\\right), \\quad c_{\\mathrm{full}} = \\sqrt{n\\frac{p_{\\mathrm{full}} + B}{\\rho_{\\mathrm{mix}}}}.$$\n- Else (two-phase), enforce $p = p_{\\mathrm{sat}}(T)$ and $\\rho_{\\mathrm{mix}} = \\alpha_l \\rho_l + \\alpha_v \\rho_v$ to express $$\\alpha_v(T) = \\frac{\\rho_{\\mathrm{mix}} - \\rho_l\\left(p_{\\mathrm{sat}}(T)\\right)}{\\rho_v\\left(p_{\\mathrm{sat}}(T), T\\right) - \\rho_l\\left(p_{\\mathrm{sat}}(T)\\right)}.$$ Use this to compute $Y_v(T)$ and $h_{\\mathrm{mix}}(T)$; then solve $$h_{\\mathrm{mix}}(T) = h_0$$ for $T$ in a physically reasonable bracket. Set $$p_{\\mathrm{full}} = p_{\\mathrm{sat}}(T)$$ and compute $$c_{\\mathrm{full}}$$ via Wood’s formula using the $(\\alpha_l, \\alpha_v)$ implied by the density closure at the solved temperature.\n\nConstants and units:\n- Use the following constants: $$\\rho_0 = 998 \\, \\mathrm{kg/m^3}, \\quad B = 3.0 \\times 10^8 \\, \\mathrm{Pa}, \\quad n = 7.15, \\quad R_v = 461.5 \\, \\mathrm{J/(kg\\cdot K)}, \\quad \\gamma_v = 1.33,$$ $$c_{p,l} = 4180 \\, \\mathrm{J/(kg\\cdot K)}, \\quad c_{p,v} = 1880 \\, \\mathrm{J/(kg\\cdot K)}, \\quad L_0 = 2.5 \\times 10^6 \\, \\mathrm{J/kg},$$ $$T_{\\mathrm{h,ref}} = 300 \\, \\mathrm{K}, \\quad T_{\\mathrm{sat,ref}} = 373.15 \\, \\mathrm{K}, \\quad p_{\\mathrm{sat,ref}} = 101325 \\, \\mathrm{Pa}.$$\n- All pressures are in Pascals and all speeds of sound are in meters per second. The final reported deviations must be dimensionless decimals.\n\nTest suite:\n- Four test cases specified by upstream temperature $T_0$ and target mixture density $\\rho_{\\mathrm{mix}}$ (both in the International System of Units):\n  1) $T_0 = 450.0 \\, \\mathrm{K}, \\ \\rho_{\\mathrm{mix}} = 100.0 \\, \\mathrm{kg/m^3}$\n  2) $T_0 = 450.0 \\, \\mathrm{K}, \\ \\rho_{\\mathrm{mix}} = 300.0 \\, \\mathrm{kg/m^3}$\n  3) $T_0 = 350.0 \\, \\mathrm{K}, \\ \\rho_{\\mathrm{mix}} = 900.0 \\, \\mathrm{kg/m^3}$\n  4) $T_0 = 300.0 \\, \\mathrm{K}, \\ \\rho_{\\mathrm{mix}} = 995.0 \\, \\mathrm{kg/m^3}$\n\nProgram requirements:\n- For each test case, compute $p_{\\mathrm{bar}}$, $c_{\\mathrm{bar}}$, $p_{\\mathrm{full}}$, and $c_{\\mathrm{full}}$ as defined above.\n- Report, for each case, the two dimensionless deviations:\n  - Pressure deviation: $$\\delta_p = \\frac{p_{\\mathrm{bar}} - p_{\\mathrm{full}}}{p_{\\mathrm{full}}}.$$\n  - Speed-of-sound deviation: $$\\delta_c = \\frac{c_{\\mathrm{bar}} - c_{\\mathrm{full}}}{c_{\\mathrm{full}}}.$$\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a two-element list of the deviations in the order $[\\delta_p,\\delta_c]$. For example: `[[d_{p,1},d_{c,1}],[d_{p,2},d_{c,2}],[d_{p,3},d_{c,3}],[d_{p,4},d_{c,4}]]`.\n\nScientific realism constraints:\n- Ensure the solution method adheres to the stated physical models. The energy-conserving full model must solve the scalar temperature equilibrium consistent with the density closure and saturation pressure law; the barotropic formulation must not incorporate temperature changes.\n- Angle units are not used. No percentages should appear in the output; deviations must be dimensionless decimals.", "solution": "The problem requires a quantitative comparison between a barotropic and a full thermodynamic model for a cavitating liquid-vapor mixture. The comparison is based on the predicted pressure and speed of sound for given upstream conditions (temperature $T_0$) and a specified mixture density $\\rho_{\\mathrm{mix}}$. This is a well-posed problem in computational fluid dynamics, assessing the validity of a common simplifying assumption (the barotropic law) which decouples the momentum and energy equations.\n\nThe solution is implemented by constructing two distinct computational models as per the problem description. All calculations are performed using the provided physical constants for water and water vapor.\n\n### 1. Physical Property Sub-models\n\nFirst, we define functions for the material properties based on the provided equations of state and thermodynamic relations. These functions serve as building blocks for both major models.\n\n-   **Saturation Pressure, $p_{\\mathrm{sat}}(T)$**: Based on the integrated Clausius–Clapeyron equation:\n    $$p_{\\mathrm{sat}}(T) = p_{\\mathrm{sat,ref}} \\exp\\left(\\frac{L_0}{R_v}\\left(\\frac{1}{T_{\\mathrm{sat,ref}}} - \\frac{1}{T}\\right)\\right)$$\n-   **Liquid Density, $\\rho_l(p)$**: Derived by inverting the Tait equation of state:\n    $$p + B = B \\left(\\frac{\\rho_l}{\\rho_0}\\right)^n \\implies \\rho_l(p) = \\rho_0 \\left(\\frac{p + B}{B}\\right)^{1/n}$$\n-   **Vapor Density, $\\rho_v(p, T)$**: From the ideal gas law:\n    $$\\rho_v(p, T) = \\frac{p}{R_v T}$$\n-   **Liquid Speed of Sound, $c_l(p, \\rho_l)$**:\n    $$c_l^2 = n \\frac{p + B}{\\rho_l}$$\n-   **Vapor Speed of Sound, $c_v(T)$**:\n    $$c_v^2 = \\gamma_v R_v T$$\n-   **Phase-Specific Enthalpies, $h_l(T)$ and $h_v(T)$**:\n    $$h_l(T) = c_{p,l}(T - T_{\\mathrm{h,ref}})$$\n    $$h_v(T) = L_0 + c_{p,v}(T - T_{\\mathrm{h,ref}})$$\n\n### 2. Barotropic Formulation\n\nThe barotropic model assumes the fluid process is isothermal, with the temperature fixed at the upstream value $T_0$. The pressure is thus a function of mixture density only, $p_{\\mathrm{bar}} = p(\\rho_{\\mathrm{mix}}; T_0)$.\n\nThe first step is to determine if the state is pure liquid or a two-phase mixture. This is decided by comparing the given mixture density $\\rho_{\\mathrm{mix}}$ with the liquid density at saturation conditions corresponding to $T_0$, which is $\\rho_{l,\\mathrm{sat}}(T_0) = \\rho_l(p_{\\mathrm{sat}}(T_0))$.\n\n-   **Case 1: Pure Liquid ($\\rho_{\\mathrm{mix}} \\ge \\rho_{l,\\mathrm{sat}}(T_0)$)**\n    In this case, the fluid is compressed liquid. The pressure $p_{\\mathrm{bar}}$ is found by directly evaluating the Tait equation with $\\rho_l = \\rho_{\\mathrm{mix}}$:\n    $$p_{\\mathrm{bar}} = B\\left(\\left(\\frac{\\rho_{\\mathrm{mix}}}{\\rho_0}\\right)^n - 1\\right)$$\n    The speed of sound $c_{\\mathrm{bar}}$ is the liquid speed of sound at this state:\n    $$c_{\\mathrm{bar}} = \\sqrt{n\\frac{p_{\\mathrm{bar}} + B}{\\rho_{\\mathrm{mix}}}}$$\n\n-   **Case 2: Two-Phase Mixture ($\\rho_{\\mathrm{mix}}  \\rho_{l,\\mathrm{sat}}(T_0)$)**\n    The pressure is assumed to be constant and equal to the saturation pressure at the fixed temperature $T_0$:\n    $$p_{\\mathrm{bar}} = p_{\\mathrm{sat}}(T_0)$$\n    The phase properties are evaluated at this state $(p_{\\mathrm{bar}}, T_0)$. Let $\\rho_l^{(0)} = \\rho_l(p_{\\mathrm{bar}})$ and $\\rho_v^{(0)} = \\rho_v(p_{\\mathrm{bar}}, T_0)$. The vapor volume fraction $\\alpha_v^{(0)}$ is determined by the mixture density closure:\n    $$\\rho_{\\mathrm{mix}} = (1-\\alpha_v^{(0)})\\rho_l^{(0)} + \\alpha_v^{(0)}\\rho_v^{(0)} \\implies \\alpha_v^{(0)} = \\frac{\\rho_{\\mathrm{mix}} - \\rho_l^{(0)}}{\\rho_v^{(0)} - \\rho_l^{(0)}}$$\n    The speed of sound $c_{\\mathrm{bar}}$ is then calculated using Wood's formula with phase properties evaluated at $(p_{\\mathrm{bar}}, T_0)$:\n    $$\\frac{1}{\\rho_{\\mathrm{mix}} c_{\\mathrm{bar}}^2} = \\frac{1-\\alpha_v^{(0)}}{\\rho_l^{(0)} (c_l^{(0)})^2} + \\frac{\\alpha_v^{(0)}}{\\rho_v^{(0)} (c_v^{(0)})^2}$$\n    where $(c_l^{(0)})^2 = n(p_{\\mathrm{bar}} + B)/\\rho_l^{(0)}$ and $(c_v^{(0)})^2 = \\gamma_v R_v T_0$.\n\n### 3. Full Thermodynamic Formulation\n\nThis model accounts for energy conservation. The fundamental principle is that for an isenthalpic process (like throttling through a valve, which causes cavitation), the specific enthalpy of the mixture remains constant and equal to the upstream specific enthalpy, $h_0 = h_l(T_0)$.\n\nThe logic again splits between pure liquid and two-phase regions.\n\n-   **Case 1: Pure Liquid ($\\rho_{\\mathrm{mix}} \\ge \\rho_{l,\\mathrm{sat}}(T_0)$)**\n    For the pure liquid phase, no phase change has occurred, and the energy equation is trivially satisfied if temperature is unchanged. The calculations for $p_{\\mathrm{full}}$ and $c_{\\mathrm{full}}$ are identical to those for $p_{\\mathrm{bar}}$ and $c_{\\mathrm{bar}}$ in the pure liquid case.\n\n-   **Case 2: Two-Phase Mixture ($\\rho_{\\mathrm{mix}}  \\rho_{l,\\mathrm{sat}}(T_0)$)**\n    In the two-phase region, vaporization occurs, which causes the temperature to drop. The final state is an equilibrium at some temperature $T  T_0$ and corresponding saturation pressure $p_{\\mathrm{full}} = p_{\\mathrm{sat}}(T)$. This equilibrium temperature $T$ is found by solving the nonlinear scalar equation representing energy conservation:\n    $$h_{\\mathrm{mix}}(T) = h_0$$\n    where $h_0 = c_{p,l}(T_0 - T_{\\mathrm{h,ref}})$ is the initial specific enthalpy. The mixture specific enthalpy $h_{\\mathrm{mix}}(T)$ is a function of the unknown temperature $T$:\n    $$h_{\\mathrm{mix}}(T) = Y_l(T) h_l(T) + Y_v(T) h_v(T)$$\n    The mass fractions $Y_l(T)$ and $Y_v(T)$ depend on $T$ through the volume fraction $\\alpha_v(T)$:\n    $$Y_v(T) = \\frac{\\alpha_v(T) \\rho_v(p_{\\mathrm{sat}}(T), T)}{\\rho_{\\mathrm{mix}}}$$\n    And the volume fraction $\\alpha_v(T)$ is also determined by the mixture density closure, but now with phase densities evaluated at the unknown equilibrium temperature $T$:\n    $$\\alpha_v(T) = \\frac{\\rho_{\\mathrm{mix}} - \\rho_l(p_{\\mathrm{sat}}(T))}{\\rho_v(p_{\\mathrm{sat}}(T), T) - \\rho_l(p_{\\mathrm{sat}}(T))}$$\n    The equation $h_{\\mathrm{mix}}(T) - h_0 = 0$ is solved for $T$ using a numerical root-finding algorithm (e.g., Brent's method) within a physically meaningful bracket, such as $[273.16 \\, \\mathrm{K}, T_0]$.\n    Once the equilibrium temperature $T_{eq}$ is found, the full-model pressure is $p_{\\mathrm{full}} = p_{\\mathrm{sat}}(T_{eq})$. The speed of sound $c_{\\mathrm{full}}$ is computed using Wood's formula with all phase properties evaluated at this equilibrium state $(p_{\\mathrm{full}}, T_{eq})$.\n\n### 4. Deviation Calculation\n\nFor each test case $(T_0, \\rho_{\\mathrm{mix}})$, we compute the pair $(p_{\\mathrm{bar}}, c_{\\mathrm{bar}})$ and $(p_{\\mathrm{full}}, c_{\\mathrm{full}})$. The relative deviations are then calculated as specified:\n-   Pressure deviation: $\\delta_p = \\frac{p_{\\mathrm{bar}} - p_{\\mathrm{full}}}{p_{\\mathrm{full}}}$\n-   Speed-of-sound deviation: $\\delta_c = \\frac{c_{\\mathrm{bar}} - c_{\\mathrm{full}}}{c_{\\mathrm{full}}}$\n\nThese steps are implemented for each test case provided in the problem statement to generate the final output.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import optimize\n\ndef solve():\n    \"\"\"\n    Computes pressure and speed-of-sound deviations between a barotropic and a\n    full thermodynamic model for cavitating flow, for a given set of test cases.\n    \"\"\"\n\n    # Physical constants\n    C = {\n        'rho0': 998.0,         # kg/m^3\n        'B': 3.0e8,           # Pa\n        'n': 7.15,            # dimensionless\n        'Rv': 461.5,          # J/(kg.K)\n        'gamma_v': 1.33,      # dimensionless\n        'cp_l': 4180.0,       # J/(kg.K)\n        'cp_v': 1880.0,       # J/(kg.K)\n        'L0': 2.5e6,          # J/kg\n        'T_h_ref': 300.0,     # K (enthalpy reference)\n        'T_sat_ref': 373.15,  # K\n        'p_sat_ref': 101325.0 # Pa\n    }\n\n    # --- Helper functions for physical properties ---\n\n    def p_sat(T, C):\n        \"\"\"Saturation pressure (Pa) as a function of temperature (K).\"\"\"\n        return C['p_sat_ref'] * np.exp((C['L0'] / C['Rv']) * (1/C['T_sat_ref'] - 1/T))\n\n    def rho_l(p, C):\n        \"\"\"Liquid density (kg/m^3) as a function of pressure (Pa).\"\"\"\n        return C['rho0'] * ((p + C['B']) / C['B'])**(1/C['n'])\n\n    def rho_v(p, T, C):\n        \"\"\"Vapor density (kg/m^3) from ideal gas law.\"\"\"\n        return p / (C['Rv'] * T)\n\n    def c_l_sq(p, rho_l_val, C):\n        \"\"\"Squared liquid speed of sound (m^2/s^2).\"\"\"\n        return C['n'] * (p + C['B']) / rho_l_val\n    \n    def c_v_sq(T, C):\n        \"\"\"Squared vapor speed of sound (m^2/s^2).\"\"\"\n        return C['gamma_v'] * C['Rv'] * T\n\n    def h_l(T, C):\n        \"\"\"Liquid specific enthalpy (J/kg).\"\"\"\n        return C['cp_l'] * (T - C['T_h_ref'])\n\n    def h_v(T, C):\n        \"\"\"Vapor specific enthalpy (J/kg).\"\"\"\n        return C['L0'] + C['cp_v'] * (T - C['T_h_ref'])\n\n    # --- Model Solvers ---\n\n    def solve_barotropic(T0, rho_mix, C):\n        \"\"\"Computes pressure and speed of sound using the barotropic model.\"\"\"\n        p_sat_T0 = p_sat(T0, C)\n        rho_l_sat_T0 = rho_l(p_sat_T0, C)\n\n        if rho_mix = rho_l_sat_T0: # Pure liquid\n            p_bar = C['B'] * ((rho_mix / C['rho0'])**C['n'] - 1)\n            c_bar_sq = c_l_sq(p_bar, rho_mix, C)\n            c_bar = np.sqrt(c_bar_sq)\n        else: # Two-phase mixture\n            p_bar = p_sat_T0\n            rho_v_T0 = rho_v(p_bar, T0, C)\n            \n            alpha_v = (rho_mix - rho_l_sat_T0) / (rho_v_T0 - rho_l_sat_T0)\n            alpha_l = 1.0 - alpha_v\n\n            cl2 = c_l_sq(p_bar, rho_l_sat_T0, C)\n            cv2 = c_v_sq(T0, C)\n            \n            # Wood's formula: 1/(rho_mix * c_mix^2) = ...\n            c_bar_sq_inv = (alpha_l / (rho_l_sat_T0 * cl2)) + (alpha_v / (rho_v_T0 * cv2))\n            c_bar = np.sqrt(1 / (rho_mix * c_bar_sq_inv))\n        \n        return p_bar, c_bar\n\n    def solve_full_thermo(T0, rho_mix, C):\n        \"\"\"Computes pressure and speed of sound using the full thermodynamic model.\"\"\"\n        p_sat_T0 = p_sat(T0, C)\n        rho_l_sat_T0 = rho_l(p_sat_T0, C)\n\n        if rho_mix = rho_l_sat_T0: # Pure liquid\n            p_full = C['B'] * ((rho_mix / C['rho0'])**C['n'] - 1)\n            c_full_sq = c_l_sq(p_full, rho_mix, C)\n            c_full = np.sqrt(c_full_sq)\n        else: # Two-phase mixture\n            h0 = h_l(T0, C)\n\n            def residual(T):\n                \"\"\"Objective function for root finding: h_mix(T) - h0 = 0.\"\"\"\n                if T = 0: return np.inf # Avoid unphysical temperatures\n                p = p_sat(T, C)\n                rho_l_T = rho_l(p, C)\n                rho_v_T = rho_v(p, T, C)\n\n                if rho_v_T - rho_l_T == 0: return np.inf # Avoid division by zero\n                alpha_v_T = (rho_mix - rho_l_T) / (rho_v_T - rho_l_T)\n                \n                # Check for physical consistency\n                if not (0  alpha_v_T  1): return np.inf \n\n                Y_v_T = alpha_v_T * rho_v_T / rho_mix\n                \n                h_mix_T = (1 - Y_v_T) * h_l(T, C) + Y_v_T * h_v(T, C)\n                return h_mix_T - h0\n\n            # Solve for equilibrium temperature T_eq\n            try:\n                # Bracket [T_triple_point, T0]\n                T_eq = optimize.brentq(residual, 273.16, T0, xtol=1e-8, rtol=1e-8)\n            except ValueError:\n                # This may happen if the residual does not change sign in the bracket,\n                # indicating the model assumptions or inputs might be at their limits.\n                # For this problem set, a solution is expected to exist.\n                return float('nan'), float('nan')\n\n            # Calculate properties at equilibrium\n            p_full = p_sat(T_eq, C)\n            rho_l_eq = rho_l(p_full, C)\n            rho_v_eq = rho_v(p_full, T_eq, C)\n            alpha_v_eq = (rho_mix - rho_l_eq) / (rho_v_eq - rho_l_eq)\n            alpha_l_eq = 1.0 - alpha_v_eq\n\n            cl2_eq = c_l_sq(p_full, rho_l_eq, C)\n            cv2_eq = c_v_sq(T_eq, C)\n\n            c_full_sq_inv = (alpha_l_eq / (rho_l_eq * cl2_eq)) + \\\n                            (alpha_v_eq / (rho_v_eq * cv2_eq))\n            c_full = np.sqrt(1 / (rho_mix * c_full_sq_inv))\n            \n        return p_full, c_full\n\n    # --- Main computation loop ---\n    \n    test_cases = [\n        (450.0, 100.0),\n        (450.0, 300.0),\n        (350.0, 900.0),\n        (300.0, 995.0),\n    ]\n\n    results = []\n    for T0, rho_mix in test_cases:\n        p_bar, c_bar = solve_barotropic(T0, rho_mix, C)\n        p_full, c_full = solve_full_thermo(T0, rho_mix, C)\n\n        delta_p = (p_bar - p_full) / p_full\n        delta_c = (c_bar - c_full) / c_full\n\n        results.append([delta_p, delta_c])\n\n    # Final print statement in the exact required format\n    # The format '[[dp1,dc1],[dp2,dc2],...]' avoids spaces after commas.\n    print(f\"[{','.join([f'[{r[0]},{r[1]}]' for r in results])}]\")\n\nsolve()\n\n```", "id": "3351412"}, {"introduction": "The low mixture sound speed in cavitating regions, as explored in our first exercise, poses a significant challenge for numerical solvers. While it severely restricts the time step of explicit methods, it also introduces stiffness into the system that can hinder the convergence of implicit methods, especially at low Mach numbers. This advanced coding exercise [@problem_id:3351409] guides you through the implementation of a preconditioned dual-time stepping algorithm, a powerful and widely used technique to overcome this stiffness. By building a solver from the ground up, you will see firsthand how preconditioning can dramatically improve convergence rates for implicit simulations of cavitating flows.", "problem": "You are asked to implement a preconditioned dual-time stepping algorithm for a one-dimensional, barotropic, cavitating flow, and to study how pseudo-time convergence depends on the choice of the physical time step and the presence or absence of preconditioning. The governing equations are the one-dimensional Euler equations for a barotropic fluid, written in conservative form. The conserved variables are density $ \\rho $ and momentum $ m = \\rho u $ with velocity $ u $. The flux function $ F $ is defined by $ F(\\rho, m) = \\left[m,\\; m^2 / \\rho + p(\\rho)\\right] $, where $ p(\\rho) $ is given by a barotropic equation of state. The spatial residual $ R(U) $ for the semi-discrete system is given by a consistent approximation to $ -\\partial_x F $, constructed via a numerical flux. You must use a monotone, consistent numerical flux such as the local Lax-Friedrichs (also called Rusanov) flux, with interface wave speed computed from $ |u| + c $, where $ c $ is the local speed of sound.\n\nThe barotropic equation of state must model cavitation with a low but nonzero speed of sound in the cavitating region to ensure mathematical well-posedness. Use the following physically plausible, piecewise definition:\n- Liquid branch (Tait law): $ p(\\rho) = B \\left( (\\rho / \\rho_\\ell)^\\gamma - 1 \\right) $, with parameters $ \\rho_\\ell $, $ B $, and $ \\gamma $ representing a reference liquid density, a stiffness parameter, and a polytropic exponent, respectively. The corresponding squared speed of sound is $ c^2 = \\dfrac{\\partial p}{\\partial \\rho} = \\gamma (p + B)/\\rho $.\n- Cavitating (mixture) branch: To avoid $ c = 0 $ while capturing high compressibility, impose a linear closure anchored at the vapor pressure $ p_v $ and the liquid-branch density at $ p_v $. Let $ \\rho_{pv} = \\rho_\\ell \\left(1 + p_v/B\\right)^{1/\\gamma} $. Define $ p(\\rho) = p_v + K \\left( \\rho - \\rho_{pv} \\right) $ when the liquid-branch pressure evaluated at $ \\rho $ would be below $ p_v $. Use $ K = c_{\\min}^2 $ for a prescribed minimum speed of sound $ c_{\\min} $, so that $ c = c_{\\min} $ in the cavitating region, and the pressure is continuous at the liquid–mixture transition.\n\nThe unsteady, physically accurate solution over a physical time step $ \\Delta t $ is obtained by an implicit backward-Euler discretization of the semi-discrete equations,\n$$\n\\frac{U^{n+1} - U^n}{\\Delta t} + R\\!\\left( U^{n+1} \\right) = 0,\n$$\nwhere $ U = [\\rho,\\; m]^T $. To obtain $ U^{n+1} $, implement a dual-time stepping iteration in a pseudo-time $ \\tau $,\n$$\n\\frac{\\partial U}{\\partial \\tau} + \\frac{U - U^n}{\\Delta t} + \\beta\\, R(U) = 0,\n$$\nwhere $ \\beta $ is a user-chosen pseudo-time scaling (preconditioning) factor designed to regularize stiffness associated with large disparities in $ c $. For this task, set the preconditioning scaling locally as $ \\beta = c/c_0 $, where $ c_0 $ is a reference speed of sound. When preconditioning is disabled, set $ \\beta = 1 $ everywhere. Advance the pseudo-time equation explicitly with a stable time step. You must maintain physical admissibility $ \\rho  0 $ during the pseudo-iterations.\n\nSpatial discretization requirements:\n- Use a uniform grid of $ N $ cells on a periodic domain of length $ L $. Use a consistent second-order accurate reconstruction-free flux (first-order in space) based on the Rusanov flux. The numerical flux at interface $ i+1/2 $ between left state $ U_L $ and right state $ U_R $ is\n$$\n\\hat{F}_{i+1/2} = \\frac{1}{2}\\left( F(U_L) + F(U_R) \\right) - \\frac{1}{2} a_{i+1/2} \\left( U_R - U_L \\right),\n$$\nwith $ a_{i+1/2} = \\max\\!\\left( |u_L| + c_L,\\; |u_R| + c_R \\right) $.\n\nPseudo-time integration requirements:\n- Use an explicit forward-Euler update in pseudo-time for the dual-time system.\n- Choose a constant pseudo-time step $ \\Delta \\tau $ based on a pseudo-Courant–Friedrichs–Lewy number $ \\mathrm{CFL}_\\tau $ scaled by the reference speed $ c_0 $, i.e., $ \\Delta \\tau = \\mathrm{CFL}_\\tau \\, \\Delta x / c_0 $, where $ \\Delta x $ is the grid spacing. Do not adapt $ \\Delta \\tau $ to local $ c $.\n- Enforce positivity of $ \\rho $ during pseudo-iterations via a conservative step clipping if necessary.\n\nInitialization:\n- Let $ N = 80 $ uniform cells on a domain of length $ L = 1 $ meter with periodic boundaries.\n- Set $ \\rho_\\ell = 1000 $ kilograms per cubic meter, $ B = 3\\times 10^8 $ pascals, and $ \\gamma = 7.15 $. Set $ p_v = 2000 $ pascals and $ c_{\\min} = 25 $ meters per second. The reference speed of sound is $ c_0 = 1500 $ meters per second.\n- Initialize $ \\rho(x) $ with a smooth transition from a cavitating region to a liquid region. Let $ \\rho_{\\text{left}} = \\rho_{pv} - 0.5 $ kilograms per cubic meter and $ \\rho_{\\text{right}} $ be the liquid density corresponding to $ p = p_v + 10^5 $ pascals via the Tait law. Use a hyperbolic tangent transition centered at $ x = L/2 $ with width parameter $ \\delta = 0.05 L $. Set $ m(x) = 0 $ initially.\n\nConvergence criteria in pseudo-time:\n- For a given physical step, start from $ U^n $ as the initial guess for $ U $. Define the dual-time residual vector field\n$$\nG(U) = \\frac{U - U^n}{\\Delta t} + \\beta\\, R(U).\n$$\n- Compute the root-mean-square norm $ \\|G\\|_{\\mathrm{rms}} $ over all cells and both conserved components.\n- Stop when $ \\|G\\|_{\\mathrm{rms}} / \\|G(U^n)\\|_{\\mathrm{rms}} \\le 10^{-6} $, or report failure if either the maximum number of pseudo-iterations is reached without meeting the tolerance or any non-physical state is encountered that cannot be healed by step clipping.\n\nPhysical time step study:\n- Perform a single physical backward-Euler step from $ t^n $ to $ t^{n+1} = t^n + \\Delta t $ for each test case. For each test case, report the number of pseudo-iterations required to reach the stopping criterion; if the method fails to converge, report $ -1 $.\n- Use $ \\mathrm{CFL}_\\tau = 0.5 $ and a maximum of $ 2000 $ pseudo-iterations allowed per physical step.\n\nUnits:\n- All lengths must be expressed in meters, times in seconds, pressures in pascals, densities in kilograms per cubic meter, and speeds in meters per second. Report counts as integers.\n\nTest suite:\n- Evaluate the method for the following six test cases, each specified by a pair $ (\\Delta t, \\text{preconditioning}) $:\n    1. $ \\Delta t = 2\\times 10^{-5} $ seconds, preconditioning disabled.\n    2. $ \\Delta t = 2\\times 10^{-5} $ seconds, preconditioning enabled.\n    3. $ \\Delta t = 10^{-4} $ seconds, preconditioning disabled.\n    4. $ \\Delta t = 10^{-4} $ seconds, preconditioning enabled.\n    5. $ \\Delta t = 5\\times 10^{-4} $ seconds, preconditioning disabled.\n    6. $ \\Delta t = 5\\times 10^{-4} $ seconds, preconditioning enabled.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain the pseudo-iteration counts for the six test cases, in the same order as listed above. Use $ -1 $ for any case that fails to converge under the specified rules. For example, a valid output could be `[125,93,412,275,-1,655]`.", "solution": "The problem requires the implementation of a preconditioned dual-time stepping algorithm to solve the one-dimensional Euler equations for a barotropic, cavitating fluid. The goal is to investigate the convergence performance of this method with respect to the physical time step size $\\Delta t$ and the application of a preconditioning technique.\n\nThe governing equations are the one-dimensional Euler equations in conservative form,\n$$\n\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0,\n$$\nwhere $U = [\\rho, m]^T$ is the vector of conserved variables, with $\\rho$ being the density and $m = \\rho u$ being the momentum, where $u$ is the fluid velocity. The physical domain is periodic with length $L=1$ meter. The flux vector $F(U)$ is given by\n$$\nF(U) = \\begin{bmatrix} m \\\\ \\frac{m^2}{\\rho} + p(\\rho) \\end{bmatrix},\n$$\nwhere the pressure $p$ is determined by a barotropic equation of state (EOS), $p=p(\\rho)$.\n\nThe specified EOS is a piecewise model designed to handle cavitation. It consists of two branches:\n1.  For the liquid phase, the pressure is given by the Tait equation of state:\n    $$\n    p(\\rho) = B \\left( \\left(\\frac{\\rho}{\\rho_\\ell}\\right)^\\gamma - 1 \\right),\n    $$\n    where $\\rho_\\ell = 1000$ kg/m$^3$ is a reference liquid density, $B=3 \\times 10^8$ Pa is a stiffness parameter, and $\\gamma=7.15$ is the polytropic exponent. The squared speed of sound in this regime is $c^2 = \\frac{\\partial p}{\\partial \\rho} = \\frac{\\gamma(p+B)}{\\rho}$.\n2.  To model cavitation, a linear pressure-density relationship is used when the pressure predicted by the Tait law would fall below a specified vapor pressure, $p_v = 2000$ Pa. This transition occurs at a density $\\rho_{pv} = \\rho_\\ell \\left(1 + p_v/B\\right)^{1/\\gamma}$. For densities $\\rho  \\rho_{pv}$, the pressure is defined as:\n    $$\n    p(\\rho) = p_v + K(\\rho - \\rho_{pv}),\n    $$\n    where the stiffness $K$ is set to $c_{\\min}^2$, with $c_{\\min} = 25$ m/s being a prescribed minimum speed of sound. This ensures that the speed of sound $c=\\sqrt{\\partial p / \\partial \\rho}$ is equal to $c_{\\min}$ in the cavitating region, maintaining the hyperbolicity of the governing equations. The pressure and its first derivative (and thus the sound speed) are continuous at the transition density $\\rho_{pv}$.\n\nThe spatial discretization is based on a finite volume method on a uniform grid of $N=80$ cells. The semi-discrete form of the equations is\n$$\n\\frac{dU_i}{dt} + R_i(U) = 0,\n$$\nwhere $U_i$ is the cell-averaged state in cell $i$, and $R_i(U)$ is the spatial residual, approximating $-\\partial_x F$. The residual for cell $i$ is computed as\n$$\nR_i(U) = \\frac{\\hat{F}_{i+1/2} - \\hat{F}_{i-1/2}}{\\Delta x},\n$$\nwhere $\\Delta x=L/N$ is the grid spacing and $\\hat{F}$ is a numerical flux. We use the first-order accurate Rusanov (or local Lax-Friedrichs) flux at the interface $i+1/2$ between cells $i$ and $i+1$:\n$$\n\\hat{F}_{i+1/2} = \\frac{1}{2} \\left( F(U_i) + F(U_{i+1}) \\right) - \\frac{1}{2} a_{i+1/2} \\left( U_{i+1} - U_i \\right).\n$$\nThe wave speed $a_{i+1/2}$ is the maximum local signal velocity at the interface:\n$$\na_{i+1/2} = \\max(|u_i| + c_i, |u_{i+1}| + c_{i+1}).\n$$\nPeriodic boundary conditions are applied at the domain ends.\n\nFor the physical time integration, an implicit backward-Euler scheme is employed for a single time step $\\Delta t$:\n$$\n\\frac{U^{n+1} - U^n}{\\Delta t} + R(U^{n+1}) = 0,\n$$\nwhere $U^n$ is the state at the beginning of the step and $U^{n+1}$ is the unknown state at the end. This nonlinear system for $U^{n+1}$ is solved using a dual-time stepping method. A pseudo-time derivative $\\partial U / \\partial \\tau$ is added to the equation, yielding a pseudo-transient problem:\n$$\n\\frac{\\partial U}{\\partial \\tau} + G(U) = 0.\n$$\nHere, $U(\\tau)$ is the solution in pseudo-time, which converges to $U^{n+1}$ as $\\tau \\to \\infty$. The dual-time residual $G(U)$ is defined as\n$$\nG(U) = \\frac{U - U^n}{\\Delta t} + \\beta R(U).\n$$\nThe factor $\\beta$ is a preconditioning scaling. When preconditioning is disabled, $\\beta=1$. When it is enabled, $\\beta$ is set locally based on the sound speed to balance the eigenvalues of the system: $\\beta = c/c_0$, where $c_0 = 1500$ m/s is a reference sound speed.\n\nThe pseudo-time equation is advanced using an explicit forward-Euler method:\n$$\nU^{k+1} = U^k - \\Delta\\tau G(U^k),\n$$\nwhere $k$ is the pseudo-time iteration index. The pseudo-time step $\\Delta\\tau$ is constant and determined by a pseudo-CFL number, $\\mathrm{CFL}_\\tau = 0.5$:\n$$\n\\Delta\\tau = \\mathrm{CFL}_\\tau \\frac{\\Delta x}{c_0}.\n$$\nThe iteration for a given physical time step starts with the initial guess $U^0 = U^n$. The process continues until the relative root-mean-square (RMS) norm of the dual-time residual $G(U)$ falls below a tolerance of $10^{-6}$:\n$$\n\\frac{\\|G(U^k)\\|_{\\mathrm{rms}}}{\\|G(U^0)\\|_{\\mathrm{rms}}} \\le 10^{-6}.\n$$\nThe RMS norm is computed over both components of $U$ across all $N$ cells. The iteration is considered to have failed if convergence is not achieved within a maximum of $2000$ iterations.\n\nDuring the pseudo-time iterations, physical admissibility must be maintained. Specifically, the density $\\rho$ must remain positive. This is enforced by a conservative step clipping procedure. If an update $U^{k+1} = U^k + \\Delta U^k$ would result in a non-positive density in any cell, the update step $\\Delta U^k$ is scaled by a factor $\\alpha \\in [0,1)$ such that the updated densities $\\rho^{k+1}$ are positive everywhere.\n\nThe initial condition at $t=0$ consists of a stationary fluid ($m(x)=0$) with a density profile transitioning from a cavitating to a liquid state. The profile is given by\n$$\n\\rho(x) = \\rho_{\\text{left}} + \\frac{1}{2}(\\rho_{\\text{right}} - \\rho_{\\text{left}}) \\left(1 + \\tanh\\left(\\frac{x - L/2}{\\delta}\\right)\\right),\n$$\nwhere $L=1$ m, $\\delta=0.05 L$, $\\rho_{\\text{left}} = \\rho_{pv} - 0.5$ kg/m$^3$, and $\\rho_{\\text{right}}$ is the density corresponding to a pressure of $p = p_v + 10^5$ Pa under the Tait EOS.\n\nThe analysis involves running the simulation for one physical time step for six different cases, corresponding to three values of $\\Delta t$ ($2 \\times 10^{-5}$ s, $10^{-4}$ s, $5 \\times 10^{-4}$ s) with preconditioning both disabled and enabled. For each case, the number of pseudo-iterations required for convergence is recorded.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and runs the dual-time stepping algorithm for a 1D cavitating flow.\n    \"\"\"\n    #\n    # --- Problem Parameters ---\n    #\n    \n    # Spatial and Temporal parameters\n    N = 80\n    L = 1.0\n    dx = L / N\n    CFL_tau = 0.5\n    max_iter = 2000\n    conv_tol = 1e-6\n    rho_floor = 1e-6\n\n    # Fluid and EOS parameters (SI units)\n    rho_l = 1000.0  # Reference liquid density (kg/m^3)\n    B = 3.0e8      # Tait law stiffness parameter (Pa)\n    gamma = 7.15   # Tait law polytropic exponent\n    p_v = 2000.0   # Vapor pressure (Pa)\n    c_min = 25.0   # Minimum sound speed (m/s)\n    c_0 = 1500.0   # Reference sound speed for preconditioning and pseudo-time step (m/s)\n\n    # Test cases: (physical_dt, use_preconditioning)\n    test_cases = [\n        (2e-5, False),\n        (2e-5, True),\n        (1e-4, False),\n        (1e-4, True),\n        (5e-4, False),\n        (5e-4, True),\n    ]\n\n    #\n    # --- Derived Parameters and Grid ---\n    #\n    x = (np.arange(N) + 0.5) * dx\n    K_cav = c_min**2\n    # Density at vapor pressure on liquid branch\n    rho_pv = rho_l * (1.0 + p_v / B)**(1.0 / gamma)\n\n    #\n    # --- Core Physics and Numerics Functions ---\n    #\n\n    def get_p_and_c(rho):\n        \"\"\"Computes pressure and sound speed from density (vectorized).\"\"\"\n        p = np.zeros_like(rho)\n        c_sq = np.zeros_like(rho)\n\n        liquid_mask = rho = rho_pv\n        cav_mask = ~liquid_mask\n\n        # Liquid branch\n        if np.any(liquid_mask):\n            rho_l_branch = rho[liquid_mask]\n            p_l_branch = B * ((rho_l_branch / rho_l)**gamma - 1.0)\n            p[liquid_mask] = p_l_branch\n            c_sq[liquid_mask] = gamma * (p_l_branch + B) / rho_l_branch\n\n        # Cavitating branch\n        if np.any(cav_mask):\n            rho_c_branch = rho[cav_mask]\n            p[cav_mask] = p_v + K_cav * (rho_c_branch - rho_pv)\n            c_sq[cav_mask] = K_cav\n            \n        c_sq = np.maximum(c_sq, c_min**2*1e-6) # safety for c\n        return p, np.sqrt(c_sq)\n\n    def get_flux(U):\n        \"\"\"Computes the physical flux F(U).\"\"\"\n        rho, m = U\n        u = m / rho\n        p, _ = get_p_and_c(rho)\n        flux = np.zeros_like(U)\n        flux[0] = m\n        flux[1] = m * u + p\n        return flux\n\n    def get_spatial_residual(U):\n        \"\"\"Computes the spatial residual R(U) using a Rusanov flux.\"\"\"\n        rho, m = U\n        # Avoid division by zero for non-physical states during iteration\n        u = np.divide(m, rho, out=np.zeros_like(m), where=rho  rho_floor)\n        p, c = get_p_and_c(rho)\n        \n        # States at i+1/2 interfaces\n        U_L = U\n        U_R = np.roll(U, -1, axis=1)\n        \n        u_L = u\n        u_R = np.roll(u, -1)\n        c_L = c\n        c_R = np.roll(c, -1)\n        \n        # Rusanov wave speed at i+1/2\n        a_half = np.maximum(np.abs(u_L) + c_L, np.abs(u_R) + c_R)\n\n        # Fluxes at cell centers\n        F_U = get_flux(U)\n        F_L = F_U\n        F_R = np.roll(F_U, -1, axis=1)\n        \n        # Rusanov flux at i+1/2\n        num_flux = 0.5 * (F_L + F_R) - 0.5 * a_half * (U_R - U_L)\n        \n        # Residual R_i = (F_{i+1/2} - F_{i-1/2}) / dx\n        residual = (num_flux - np.roll(num_flux, 1, axis=1)) / dx\n        return residual\n\n    def get_dual_time_residual(U, U_n, dt, use_precon):\n        \"\"\"Computes the dual-time residual G(U).\"\"\"\n        R_of_U = get_spatial_residual(U)\n        \n        if use_precon:\n            _, c = get_p_and_c(U[0])\n            beta = c / c_0\n        else:\n            beta = 1.0\n            \n        G = (U - U_n) / dt + beta * R_of_U\n        return G\n\n    #\n    # --- Initial Condition ---\n    #\n    p_right = p_v + 1.0e5\n    rho_right = rho_l * (1.0 + p_right / B)**(1.0 / gamma)\n    rho_left = rho_pv - 0.5\n    delta_tanh = 0.05 * L\n    \n    rho_init = rho_left + 0.5 * (rho_right - rho_left) * (1.0 + np.tanh((x - L/2) / delta_tanh))\n    m_init = np.zeros(N)\n    U_n = np.array([rho_init, m_init])\n\n    # Pseudo-time step\n    dt_tau = CFL_tau * dx / c_0\n\n    #\n    # --- Main Loop for Test Cases ---\n    #\n    results = []\n    \n    for dt, use_precon in test_cases:\n        U = U_n.copy()\n\n        # Initial residual for normalization\n        G_initial = get_dual_time_residual(U, U_n, dt, use_precon)\n        norm_G_initial = np.sqrt(np.mean(G_initial**2))\n\n        if norm_G_initial  1e-12: # Already converged\n            results.append(0)\n            continue\n            \n        converged = False\n        for k in range(1, max_iter + 1):\n            G_current = get_dual_time_residual(U, U_n, dt, use_precon)\n            \n            norm_G_current = np.sqrt(np.mean(G_current**2))\n            \n            if norm_G_current / norm_G_initial = conv_tol:\n                results.append(k)\n                converged = True\n                break\n\n            # Update step\n            delta_U = -dt_tau * G_current\n\n            # Positivity enforcement (step clipping)\n            alpha = 1.0\n            rho_next_trial = U[0] + delta_U[0]\n            violating_indices = np.where(rho_next_trial = rho_floor)[0]\n            \n            if violating_indices.size  0:\n                delta_rho_viol = delta_U[0, violating_indices]\n                # Filter out cases where delta_rho is non-negative (shouldn't happen for violation)\n                safe_delta_rho_viol = delta_rho_viol[delta_rho_viol  0]\n                if safe_delta_rho_viol.size  0:\n                    rho_viol = U[0, violating_indices][delta_rho_viol  0]\n                    thetas = (rho_floor - rho_viol) / safe_delta_rho_viol\n                    min_theta = np.min(thetas)\n                    alpha = min(1.0, 0.99 * min_theta)\n\n            # Apply update\n            U += alpha * delta_U\n            \n            if np.any(np.isnan(U)):\n                converged = False\n                break\n        \n        if not converged:\n            results.append(-1)\n\n    #\n    # --- Final Output ---\n    #\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3351409"}]}