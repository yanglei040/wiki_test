{"hands_on_practices": [{"introduction": "Before implementing any boundary condition, we must first answer a fundamental question: how many physical quantities must we specify at a boundary for the problem to be well-posed? This exercise grounds your understanding in characteristic theory, connecting the number of incoming waves to the number of required boundary conditions [@problem_id:3387442]. You will rigorously prove the consistency between three different perspectives: the signs of the flux Jacobian eigenvalues, the classification of flow regimes by Mach number, and the activation of van Leer's flux splitting functions.", "problem": "Consider the compressible Euler equations for inviscid flow in one spatial dimension along a boundary-normal direction. Let the outward unit normal be fixed, and denote the primitive variables by density $\\,\\rho\\,$ (in $\\mathrm{kg/m^3}$), normal velocity $\\,u_n\\,$ (in $\\mathrm{m/s}$), and pressure $\\,p\\,$ (in $\\mathrm{Pa}$). Let the ratio of specific heats be denoted by $\\,\\gamma\\,$ (dimensionless). The speed of sound is $\\,a = \\sqrt{\\gamma p / \\rho}\\,$ (in $\\mathrm{m/s}$), and the boundary-normal Mach number is $\\,M_n = u_n / a\\,$ (dimensionless). In Computational Fluid Dynamics (CFD), Flux Vector Splitting (FVS) methods, such as van Leer flux vector splitting, decompose the normal flux vector $\\,F_n\\,$ into positive and negative parts $\\,F_n^+\\,$ and $\\,F_n^-\\,$ that represent contributions associated with waves moving out of and into the computational domain, respectively.\n\nYour task is to:\n- Derive, from the compressible Euler equations and characteristic theory, the classification of incoming versus outgoing characteristics at a boundary in terms of the signs of the eigenvalues associated with the normal flux Jacobian. Use this classification to determine, for a given $\\,M_n\\,$, how many characteristics are incoming and hence how many boundary variables must be imposed for well-posedness.\n- Starting from the physical constraints that govern van Leer flux vector splitting, state the positive and negative splitting functions $\\,g^\\pm(M_n)\\,$ that smoothly recover pure upwinding in supersonic regimes and a consistent split in subsonic regimes. Explain how $\\,g^\\pm(M_n)\\,$ indicate whether $\\,F_n^+\\,$ and $\\,F_n^-\\,$ are active, and connect this to the number of incoming characteristics.\n- Implement characteristic inflow/outflow at subsonic boundaries by assembling the normal mass flux using $\\,F^\\pm\\,$ according to the rule that incoming contributions use exterior (imposed) data while outgoing contributions use interior data. You should implement the $\\,F^\\pm\\,$ split for the normal mass flux component as $\\,F_\\rho^\\pm = \\rho a\\, g^\\pm(M_n)\\,$. You are not required to implement momentum and energy flux components for this task.\n\nProve rigorously that for subsonic boundaries the number of imposed variables equals the number of incoming characteristics derived from the sign pattern of the eigenvalues, and that this count agrees with the regime inferred from $\\,g^\\pm(M_n)\\,$, specifically:\n- Subsonic inflow ($-1  M_n  0$) requires two imposed variables.\n- Subsonic outflow ($0  M_n  1$) requires one imposed variable.\n- Supersonic inflow ($M_n  -1$) requires three imposed variables.\n- Supersonic outflow ($M_n  1$) requires zero imposed variables.\n- Sonic edge cases ($M_n = -1, 0, 1$) follow by counting strictly negative eigenvalues, yielding two, one, and zero imposed variables, respectively.\n\nThen, write a complete program that:\n1. Computes $\\,a\\,$, $\\,M_n\\,$, the number of incoming characteristics by examining the signs of $\\,u_n - a\\,$, $\\,u_n\\,$, and $\\,u_n + a\\,$, the number of imposed boundary variables by regime classification, and the incoming count inferred from $\\,g^\\pm(M_n)\\,$ activation.\n2. For each test case, returns a boolean indicating whether all three counts agree.\n3. Assembles $\\,F_\\rho^+\\,$ and $\\,F_\\rho^-\\,$ for demonstration, using interior versus exterior states consistently with characteristic inflow/outflow, but does not print these fluxes.\n\nUse the following test suite, with all quantities in the units specified above:\n- Case $1$: $\\,\\gamma = 1.4\\,$, $\\,\\rho = 1.0\\,$, $\\,p = 101325\\,$, $\\,u_n = 100\\,$. This is a subsonic outflow with $\\,0  M_n  1\\,$.\n- Case $2$: $\\,\\gamma = 1.4\\,$, $\\,\\rho = 1.0\\,$, $\\,p = 101325\\,$, $\\,u_n = -100\\,$. This is a subsonic inflow with $\\,-1  M_n  0\\,$.\n- Case $3$: $\\,\\gamma = 1.4\\,$, $\\,\\rho = 1.0\\,$, $\\,p = 101325\\,$, $\\,u_n = 500\\,$. This is a supersonic outflow with $\\,M_n  1\\,$.\n- Case $4$: $\\,\\gamma = 1.4\\,$, $\\,\\rho = 1.0\\,$, $\\,p = 101325\\,$, $\\,u_n = -500\\,$. This is a supersonic inflow with $\\,M_n  -1\\,$.\n- Case $5$: $\\,\\gamma = 1.4\\,$, $\\,\\rho = 1.0\\,$, choose $\\,a = 300\\,$ and set $\\,p = \\rho a^2 / \\gamma\\,$, $\\,u_n = a\\,$ so $\\,M_n = 1\\,$ (sonic outflow).\n- Case $6$: Same as Case $5$ but $\\,u_n = -a\\,$ so $\\,M_n = -1\\,$ (sonic inflow).\n- Case $7$: Same as Case $5$ but $\\,u_n = 0\\,$ so $\\,M_n = 0\\,$ (stagnation).\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,...]\"), where each entry is a boolean for the corresponding test case as described above.", "solution": "The problem requires a rigorous validation of the consistency between three methods for determining the number of imposed boundary conditions for the 1D Euler equations: characteristic analysis based on eigenvalues, classification of flow regimes by Mach number, and inference from the activation of van Leer's flux splitting functions.\n\n### Part 1: Characteristic Analysis and Boundary Conditions\n\nThe 1D Euler equations for inviscid, compressible flow can be written in quasilinear form using primitive variables $\\mathbf{W} = [\\rho, u_n, p]^T$. The system is:\n$$\n\\frac{\\partial \\mathbf{W}}{\\partial t} + \\mathbf{A}_p \\frac{\\partial \\mathbf{W}}{\\partial x_n} = 0\n$$\nwhere $x_n$ is the coordinate normal to the boundary. The Jacobian matrix $\\mathbf{A}_p$ for the primitive variables is:\n$$\n\\mathbf{A}_p = \\frac{\\partial \\mathbf{F}_p}{\\partial \\mathbf{W}} = \n\\begin{pmatrix}\nu_n  \\rho  0 \\\\\n0  u_n  1/\\rho \\\\\n0  \\gamma p  u_n\n\\end{pmatrix}\n$$\nThe eigenvalues $\\lambda$ of this matrix determine the speeds of propagation of characteristic waves. They are found by solving $\\det(\\mathbf{A}_p - \\lambda \\mathbf{I}) = 0$:\n$$\n\\det \\begin{pmatrix}\nu_n - \\lambda  \\rho  0 \\\\\n0  u_n - \\lambda  1/\\rho \\\\\n0  \\gamma p  u_n - \\lambda\n\\end{pmatrix} = (u_n - \\lambda) \\left[ (u_n - \\lambda)^2 - \\frac{\\gamma p}{\\rho} \\right] = 0\n$$\nUsing the definition of the speed of sound, $a = \\sqrt{\\gamma p / \\rho}$, this simplifies to:\n$$\n(u_n - \\lambda) [ (u_n - \\lambda)^2 - a^2 ] = 0\n$$\nThe three eigenvalues are:\n$$\n\\lambda_1 = u_n - a, \\quad \\lambda_2 = u_n, \\quad \\lambda_3 = u_n + a\n$$\nThese represent the speeds of an acoustic wave traveling against the flow, an entropy/contact-discontinuity wave traveling with the flow, and an acoustic wave traveling with the flow, respectively.\n\nFor a hyperbolic system at a boundary, the number of boundary conditions that must be specified from the exterior is equal to the number of characteristic waves propagating into the computational domain. A wave is incoming if its propagation speed $\\lambda$ is negative (assuming the outward normal points in the positive direction). Therefore, the number of required boundary conditions is equal to the number of negative eigenvalues of $\\mathbf{A}_p$.\n\nWe can now classify the flow regimes based on the boundary-normal Mach number, $M_n = u_n / a$, and count the number of negative eigenvalues:\n\n1.  **Supersonic Inflow ($M_n  -1$)**: Here, $u_n  -a$. This implies $u_n + a  0$. Since $a  0$, we have $u_n  0$ and $u_n - a  0$. All three eigenvalues, $\\lambda_1 = u_n - a$, $\\lambda_2 = u_n$, and $\\lambda_3 = u_n + a$, are negative.\n    *   Number of incoming characteristics: $3$. All variables must be imposed from the exterior.\n\n2.  **Subsonic Inflow ($-1  M_n  0$)**: Here, $-a  u_n  0$.\n    *   $\\lambda_1 = u_n - a  0$ (since $u_n$ is negative).\n    *   $\\lambda_2 = u_n  0$.\n    *   $\\lambda_3 = u_n + a  0$.\n    *   Number of incoming characteristics: $2$. Two variables must be imposed.\n\n3.  **Subsonic Outflow ($0 \\le M_n  1$)**: Here, $0 \\le u_n  a$.\n    *   $\\lambda_1 = u_n - a  0$.\n    *   $\\lambda_2 = u_n \\ge 0$.\n    *   $\\lambda_3 = u_n + a  0$.\n    *   Number of incoming characteristics (strictly negative eigenvalues): $1$. One variable must be imposed. For the specific case $M_n=0$, eigenvalues are $-a, 0, a$, yielding one strictly negative eigenvalue.\n\n4.  **Supersonic Outflow ($M_n \\ge 1$)**: Here, $u_n \\ge a$.\n    *   $\\lambda_1 = u_n - a \\ge 0$.\n    *   $\\lambda_2 = u_n  0$.\n    *   $\\lambda_3 = u_n + a  0$.\n    *   Number of incoming characteristics (strictly negative eigenvalues): $0$. No variables are imposed; all are determined from the interior. For the specific case $M_n=1$, eigenvalues are $0, a, 2a$, yielding zero strictly negative eigenvalues.\n\n5.  **Sonic Points (per problem statement)**: The counting rule is based on strictly negative eigenvalues.\n    *   $M_n = 1$ ($u_n = a$): Eigenvalues are $0, a, 2a$. Count = $0$.\n    *   $M_n = -1$ ($u_n = -a$): Eigenvalues are $-2a, -a, 0$. Count = $2$.\n    *   $M_n = 0$ ($u_n = 0$): Eigenvalues are $-a, 0, a$. Count = $1$.\n\nThis analysis provides a rigorous proof that the number of required boundary conditions, determined by counting strictly negative eigenvalues, matches the counts specified in the problem for each flow regime.\n\n### Part 2: Van Leer Flux Vector Splitting\n\nVan Leer flux vector splitting decomposes the flux vector $\\mathbf{F}_n$ into $\\mathbf{F}_n^+$ and $\\mathbf{F}_n^-$, where $\\mathbf{F}_n^+$ is associated with information moving in the positive direction (outgoing) and $\\mathbf{F}_n^-$ with information moving in the negative direction (incoming). For a numerical scheme at a boundary, the rule is to evaluate outgoing fluxes using interior data and incoming fluxes using exterior (imposed) data:\n$$\n\\mathbf{F}_{n, \\text{boundary}} = \\mathbf{F}_n^+(\\mathbf{W}_{\\text{interior}}) + \\mathbf{F}_n^-(\\mathbf{W}_{\\text{exterior}})\n$$\nThe splitting is constructed such that the Jacobian of $\\mathbf{F}_n^+$ has non-negative eigenvalues and the Jacobian of $\\mathbf{F}_n^-$ has non-positive eigenvalues, ensuring stability.\n\nFor the mass flux component, $F_\\rho = \\rho u_n = \\rho a M_n$. The van Leer split is given by $F_\\rho = F_\\rho^+ + F_\\rho^- = \\rho a g^+(M_n) + \\rho a g^-(M_n)$, which implies $M_n = g^+(M_n) + g^-(M_n)$. The standard continuous splitting functions $g^\\pm(M_n)$ are:\n$$\ng^+(M_n) = \\begin{cases} 0  \\text{if } M_n \\le -1 \\\\ \\frac{1}{4}(M_n+1)^2  \\text{if } -1  M_n  1 \\\\ M_n  \\text{if } M_n \\ge 1 \\end{cases}\n$$\n$$\ng^-(M_n) = \\begin{cases} M_n  \\text{if } M_n \\le -1 \\\\ -\\frac{1}{4}(M_n-1)^2  \\text{if } -1  M_n  1 \\\\ 0  \\text{if } M_n \\ge 1 \\end{cases}\n$$\nThe \"activation\" of these functions determines the character of the boundary flow:\n-   If $g^-(M_n) = 0$, only the $\\mathbf{F}_n^+$ flux is active. This corresponds to the supersonic outflow regime ($M_n \\ge 1$), where all information leaves the domain. The flux is computed entirely from interior data, requiring $0$ imposed variables. This is consistent with the eigenvalue analysis.\n-   If $g^+(M_n) = 0$, only the $\\mathbf{F}_n^-$ flux is active. This corresponds to the supersonic inflow regime ($M_n \\le -1$), where all information enters the domain. The flux is computed entirely from exterior data, requiring $3$ imposed variables. However, we must distinguish the sonic point $M_n=-1$ (2 variables) from the case $M_n  -1$ (3 variables).\n-   If both $g^+(M_n)$ and $g^-(M_n)$ are non-zero, the flow is subsonic ($|M_n|1$) and has both incoming and outgoing contributions. The number of imposed variables ($1$ or $2$) depends on the sign of $M_n$.\n\nWe can therefore establish a consistent counting method based on the activation of $g^\\pm(M_n)$ that matches the characteristic analysis precisely:\n-   If $g^-(M_n)$ is zero, we are in the supersonic outflow regime ($M_n \\ge 1$). The count of imposed variables is $0$.\n-   If $g^+(M_n)$ is zero, we are in the supersonic inflow regime ($M_n \\le -1$).\n    -   If $M_n = -1$, the count is $2$.\n    -   If $M_n  -1$, the count is $3$.\n-   If both are non-zero, we are in the subsonic regime ($-1  M_n  1$).\n    -   If $M_n  0$ (subsonic inflow), the count is $2$.\n    -   If $M_n \\ge 0$ (subsonic outflow/stagnation), the count is $1$.\n\nThis logic demonstrates that the number of imposed boundary conditions can be inferred consistently from the activation of the van Leer splitting functions, as they are designed to mirror the underlying characteristic structure of the flow regimes. The three counting methods are therefore equivalent.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Validates the consistency of three methods for counting required boundary\n    conditions in 1D compressible flow for a suite of test cases.\n    \"\"\"\n    \n    # Test cases: (gamma, rho, u_n, p, a)\n    # Use None for values to be calculated.\n    test_cases = [\n        # Case 1: Subsonic outflow\n        {'gamma': 1.4, 'rho': 1.0, 'u_n': 100.0, 'p': 101325.0, 'a': None},\n        # Case 2: Subsonic inflow\n        {'gamma': 1.4, 'rho': 1.0, 'u_n': -100.0, 'p': 101325.0, 'a': None},\n        # Case 3: Supersonic outflow\n        {'gamma': 1.4, 'rho': 1.0, 'u_n': 500.0, 'p': 101325.0, 'a': None},\n        # Case 4: Supersonic inflow\n        {'gamma': 1.4, 'rho': 1.0, 'u_n': -500.0, 'p': 101325.0, 'a': None},\n        # Case 5: Sonic outflow M_n = 1\n        {'gamma': 1.4, 'rho': 1.0, 'u_n': 300.0, 'p': None, 'a': 300.0},\n        # Case 6: Sonic inflow M_n = -1\n        {'gamma': 1.4, 'rho': 1.0, 'u_n': -300.0, 'p': None, 'a': 300.0},\n        # Case 7: Stagnation M_n = 0\n        {'gamma': 1.4, 'rho': 1.0, 'u_n': 0.0, 'p': None, 'a': 300.0},\n    ]\n\n    results = []\n    \n    # Define van Leer splitting functions\n    def g_plus(Mn):\n        if Mn >= 1.0:\n            return Mn\n        elif Mn = -1.0:\n            return 0.0\n        else:\n            return 0.25 * (Mn + 1.0)**2\n\n    def g_minus(Mn):\n        if Mn = -1.0:\n            return Mn\n        elif Mn >= 1.0:\n            return 0.0\n        else:\n            return -0.25 * (Mn - 1.0)**2\n\n    for case in test_cases:\n        gamma, rho, u_n = case['gamma'], case['rho'], case['u_n']\n        p, a = case['p'], case['a']\n\n        # Complete the state variables\n        if a is None:\n            a = np.sqrt(gamma * p / rho)\n        if p is None:\n            p = rho * a**2 / gamma\n        \n        # Avoid division by zero if a=0, though not in test cases\n        if a > 1e-9:\n            Mn = u_n / a\n        else:\n            Mn = 0.0\n\n        # Method 1: Count strictly negative eigenvalues\n        eigenvalues = [u_n - a, u_n, u_n + a]\n        count_eigen = sum(1 for lam in eigenvalues if lam  -1e-9)\n\n        # Method 2: Count based on Mach number regime classification\n        if Mn  -1.0 - 1e-9:\n            count_regime = 3\n        elif np.isclose(Mn, -1.0):\n            count_regime = 2\n        elif -1.0  Mn  0.0 - 1e-9:\n            count_regime = 2\n        elif np.isclose(Mn, 0.0):\n            count_regime = 1\n        elif 0.0  Mn  1.0 - 1e-9:\n            count_regime = 1\n        else: # Mn >= 1.0 or isclose(Mn,1.0)\n            count_regime = 0\n\n        # Method 3: Count inferred from van Leer splitting function activation\n        gp = g_plus(Mn)\n        gm = g_minus(Mn)\n        \n        count_vanleer = -1 # Default invalid\n        if np.isclose(gm, 0.0): # Supersonic outflow regime (Mn >= 1)\n            count_vanleer = 0\n        elif np.isclose(gp, 0.0): # Supersonic inflow regime (Mn = -1)\n            if np.isclose(Mn, -1.0):\n                count_vanleer = 2\n            else:\n                count_vanleer = 3\n        else: # Subsonic regime (-1  Mn  1)\n            if Mn  0.0:\n                count_vanleer = 2\n            else: # Mn >= 0\n                count_vanleer = 1\n\n        # Check for agreement among all three methods\n        is_consistent = (count_eigen == count_regime == count_vanleer)\n        results.append(is_consistent)\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3387442"}, {"introduction": "At an impermeable wall, the no-penetration condition ($V_n = 0$) is just one piece of the puzzle for a numerical scheme. This practice explores how the Euler equations themselves impose a powerful constraint on the pressure field, linking the normal pressure gradient to the wall's curvature and the tangential flow velocity [@problem_id:3296213]. By deriving and applying this compatibility condition, you will gain deeper insight into how the local physics directly informs the numerical treatment of solid boundaries.", "problem": "Consider a two-dimensional, steady, inviscid, compressible flow governed by the Euler equations adjacent to an adiabatic, impermeable, slip wall. Let the wall be represented locally by a smooth curve $y(x)$, and introduce a local orthonormal frame with unit tangent $\\mathbf{t}$ and outward unit normal $\\mathbf{n}$, where the coordinate $s$ is the arclength along the wall and $n$ is the distance normal to the wall measured into the fluid. The flow velocity $\\mathbf{V}$ decomposes as $\\mathbf{V} = V_t \\mathbf{t} + V_n \\mathbf{n}$, and the slip, impermeable condition imposes $V_n = 0$ on the wall. For a perfect gas with specific heat ratio $\\gamma$ and specific gas constant $R$, the sound speed is $a = \\sqrt{\\gamma R T}$ and the density is $\\rho = p/(R T)$, where $p$ is the static pressure and $T$ is the static temperature. The tangential flow Mach number at the wall is $M_t = V_t/a$.\n\nStarting from the inviscid momentum balance projected onto the normal direction and the kinematics of motion along a curved streamline, derive a compatibility boundary condition that expresses the magnitude of the normal pressure gradient at the wall, $|\\partial p/\\partial n|$, in terms of the flow and wall geometry. Explicitly relate $|\\partial p/\\partial n|$ to the tangential speed $V_t$ and the wall curvature $\\kappa_w$, where the signed curvature is defined by $\\kappa_w = \\mathrm{d}\\theta/\\mathrm{d}s$ with $\\theta(s)$ the tangent angle; equivalently, for a wall given as a graph $y(x)$, the curvature magnitude is\n$$\n|\\kappa_w(x)| = \\frac{|y''(x)|}{\\left(1 + \\left(y'(x)\\right)^2\\right)^{3/2}}.\n$$\nUse only the inviscid steady Euler equations, Newton’s second law, and the ideal-gas relations as the fundamental base.\n\nAlgorithmic task: Implement a program that, for a set of specified test cases, computes the magnitude of the normal pressure gradient at the wall,\n$$\n\\left|\\frac{\\partial p}{\\partial n}\\right| = \\rho \\, V_t^2 \\, |\\kappa_w|,\n$$\nwith $V_t = M_t \\, a$, $a = \\sqrt{\\gamma R T}$, and $\\rho = \\frac{p}{R T}$, using analytic expressions for $y'(x)$ and $y''(x)$ evaluated at a given point $x_0$. All outputs must be expressed in Pascals per meter ($\\mathrm{Pa/m}$). The final numerical answers must be printed rounded to six decimal places.\n\nTest suite:\n- Case A (happy path, flat wall): $y(x) = 0$, $y'(x) = 0$, $y''(x) = 0$, $\\gamma = 1.4$, $R = 287$, $p = 100000$ $\\mathrm{Pa}$, $T = 300$ $\\mathrm{K}$, $M_t = 0.5$, $x_0 = 0$.\n- Case B (gentle curvature via parabola): $y(x) = \\dfrac{x^2}{2R_c}$, $y'(x) = \\dfrac{x}{R_c}$, $y''(x) = \\dfrac{1}{R_c}$ with $R_c = 2.0$ $\\mathrm{m}$, $\\gamma = 1.4$, $R = 287$, $p = 120000$ $\\mathrm{Pa}$, $T = 320$ $\\mathrm{K}$, $M_t = 0.8$, $x_0 = 0$.\n- Case C (transonic curvature via circle): $y(x) = \\sqrt{R_c^2 - x^2}$, $y'(x) = -\\dfrac{x}{\\sqrt{R_c^2 - x^2}}$, $y''(x) = -\\dfrac{1}{\\sqrt{R_c^2 - x^2}} - \\dfrac{x^2}{\\left(R_c^2 - x^2\\right)^{3/2}}$ with $R_c = 1.5$ $\\mathrm{m}$, $\\gamma = 1.4$, $R = 287$, $p = 100000$ $\\mathrm{Pa}$, $T = 300$ $\\mathrm{K}$, $M_t = 1.0$, $x_0 = 0$.\n- Case D (severe curvature and supersonic, mimicking shock interaction risk): $y(x) = \\dfrac{x^2}{2R_c}$, $y'(x) = \\dfrac{x}{R_c}$, $y''(x) = \\dfrac{1}{R_c}$ with $R_c = 0.05$ $\\mathrm{m}$, $\\gamma = 1.4$, $R = 287$, $p = 200000$ $\\mathrm{Pa}$, $T = 300$ $\\mathrm{K}$, $M_t = 2.5$, $x_0 = 0$.\n- Case E (near-stagnation tangential velocity): $y(x) = \\dfrac{x^2}{2R_c}$, $y'(x) = \\dfrac{x}{R_c}$, $y''(x) = \\dfrac{1}{R_c}$ with $R_c = 0.2$ $\\mathrm{m}$, $\\gamma = 1.4$, $R = 287$, $p = 100000$ $\\mathrm{Pa}$, $T = 300$ $\\mathrm{K}$, $M_t = 0.01$, $x_0 = 0$.\n\nYour program should produce a single line of output containing the results for Cases A through E, in order, as a comma-separated list enclosed in square brackets, for example, $[r_A,r_B,r_C,r_D,r_E]$, where each $r_\\cdot$ is the computed value of $|\\partial p/\\partial n|$ in $\\mathrm{Pa/m}$ rounded to six decimal places.", "solution": "The problem is to derive a compatibility boundary condition for the normal pressure gradient at a solid wall for a steady, inviscid, compressible flow, and then to implement a program to compute this gradient for a given set of test cases.\n\n### Derivation of the Normal Pressure Gradient Boundary Condition\n\nThe derivation begins with the steady-state Euler momentum equation for an inviscid fluid, which is a statement of Newton's second law for a fluid element:\n$$\n\\rho (\\mathbf{V} \\cdot \\nabla) \\mathbf{V} = - \\nabla p\n$$\nwhere $\\rho$ is the fluid density, $\\mathbf{V}$ is the velocity vector, and $p$ is the static pressure.\n\nTo analyze the flow near a curved wall, it is advantageous to use a natural coordinate system $(s, n)$, where $s$ is the arclength along a streamline and $n$ is the coordinate normal to the streamline. The velocity vector is tangential to the streamline, so $\\mathbf{V} = V \\mathbf{t}$, where $V$ is the flow speed and $\\mathbf{t}$ is the unit tangent vector.\n\nThe acceleration term, $(\\mathbf{V} \\cdot \\nabla) \\mathbf{V}$, can be decomposed into tangential and normal components. The convective derivative of the velocity vector is given by:\n$$\n(\\mathbf{V} \\cdot \\nabla) \\mathbf{V} = V \\frac{\\partial (V \\mathbf{t})}{\\partial s} = V \\left( \\frac{\\partial V}{\\partial s} \\mathbf{t} + V \\frac{\\partial \\mathbf{t}}{\\partial s} \\right)\n$$\nFrom differential geometry, the derivative of the tangent vector with respect to arclength is related to the streamline curvature $\\kappa$ and the principal unit normal vector $\\mathbf{n}_{cc}$ (which points towards the center of curvature):\n$$\n\\frac{\\partial \\mathbf{t}}{\\partial s} = \\kappa \\mathbf{n}_{cc}\n$$\nThe curvature $\\kappa$ is the reciprocal of the radius of curvature, $\\kappa = 1/R_c$. Substituting this into the acceleration expression yields:\n$$\n(\\mathbf{V} \\cdot \\nabla) \\mathbf{V} = V \\frac{\\partial V}{\\partial s} \\mathbf{t} + \\kappa V^2 \\mathbf{n}_{cc}\n$$\nThe first term represents the change in speed along the streamline, and the second term is the centripetal acceleration required to keep the fluid particle on its curved path.\n\nThe pressure gradient $\\nabla p$ can also be decomposed in this coordinate system. The Euler momentum equation becomes:\n$$\n\\rho \\left( V \\frac{\\partial V}{\\partial s} \\mathbf{t} + \\kappa V^2 \\mathbf{n}_{cc} \\right) = - \\left( \\frac{\\partial p}{\\partial s} \\mathbf{t} + \\frac{\\partial p}{\\partial n} \\mathbf{n}_{cc} \\right)\n$$\nBy equating the vector components in the normal direction $\\mathbf{n}_{cc}$, we obtain the normal momentum balance equation:\n$$\n\\rho \\kappa V^2 = - \\frac{\\partial p}{\\partial n}\n$$\nor\n$$\n\\frac{\\partial p}{\\partial n} = - \\rho \\kappa V^2\n$$\nThis fundamental relation states that a pressure gradient normal to a streamline is necessary to balance the centrifugal force arising from its curvature. The pressure increases in the direction opposite to the center of curvature.\n\nAt a solid, impermeable wall, the flow cannot pass through it, so the normal component of velocity is zero. For an inviscid flow, this implies the wall itself is a streamline. Therefore, at the wall, the flow velocity is purely tangential, $V = V_t$, and the streamline curvature is equal to the wall curvature, $\\kappa = \\kappa_w$. Substituting these into the normal momentum equation gives:\n$$\n\\left. \\frac{\\partial p}{\\partial n} \\right|_{\\text{wall}} = - \\rho_w \\kappa_w V_{t,w}^2\n$$\nThe problem asks for the magnitude of this gradient, $|\\partial p/\\partial n|$. Taking the absolute value, we get:\n$$\n\\left| \\frac{\\partial p}{\\partial n} \\right| = |-\\rho_w \\kappa_w V_{t,w}^2|\n$$\nSince density $\\rho$ and $V_t^2$ are non-negative, this simplifies to:\n$$\n\\left| \\frac{\\partial p}{\\partial n} \\right| = \\rho_w V_{t,w}^2 |\\kappa_w|\n$$\nThis is the desired compatibility boundary condition, which relates the normal pressure gradient at the wall to the local density, tangential velocity, and wall curvature.\n\n### Algorithmic Computation\n\nThe algorithmic task is to compute $|\\partial p/\\partial n|$ for several test cases. The problem provides all necessary parameters and relations. The calculation proceeds as follows for each case:\n$1$. The wall curvature magnitude, $|\\kappa_w|$, is calculated at the specified point $x_0$ using the provided formula for a curve $y(x)$:\n$$\n|\\kappa_w(x_0)| = \\frac{|y''(x_0)|}{\\left(1 + \\left(y'(x_0)\\right)^2\\right)^{3/2}}\n$$\n$2$. The fluid density $\\rho$ is calculated using the ideal gas law:\n$$\n\\rho = \\frac{p}{R T}\n$$\n$3$. The speed of sound $a$ is calculated for a perfect gas:\n$$\na = \\sqrt{\\gamma R T}\n$$\n$4$. The tangential velocity $V_t$ is determined from the tangential Mach number $M_t$:\n$$\nV_t = M_t a\n$$\n$5$. Finally, these values are substituted into the derived formula:\n$$\n\\left| \\frac{\\partial p}{\\partial n} \\right| = \\rho V_t^2 |\\kappa_w|\n$$\n\nIt is instructive to substitute the expressions for $\\rho$, $a$, and $V_t$ into the final formula to obtain a simplified expression for verification purposes:\n$$\n\\left| \\frac{\\partial p}{\\partial n} \\right| = \\left( \\frac{p}{R T} \\right) (M_t \\sqrt{\\gamma R T})^2 |\\kappa_w| = \\frac{p}{R T} M_t^2 (\\gamma R T) |\\kappa_w|\n$$\nThe terms $R T$ cancel, yielding a compact and elegant relationship:\n$$\n\\left| \\frac{\\partial p}{\\partial n} \\right| = p \\, \\gamma \\, M_t^2 \\, |\\kappa_w|\n$$\nThis simplified form is useful for checking the results. However, the implementation will follow the full chain of calculations as specified in the problem statement to demonstrate each step.\n\nThe implementation will process the provided test cases, calculating $|\\partial p/\\partial n|$ for each and formatting the results as requested. All physical units are in the SI system, so the resulting pressure gradient will be in Pascals per meter ($\\mathrm{Pa/m}$).", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the magnitude of the normal pressure gradient at a wall\n    for several test cases of compressible, inviscid flow.\n    \"\"\"\n\n    # Test cases are defined as tuples with the following structure:\n    # (p, T, Mt, gamma, R, y_prime_at_x0, y_double_prime_at_x0)\n    # where:\n    # p: static pressure (Pa)\n    # T: static temperature (K)\n    # Mt: tangential Mach number\n    # gamma: specific heat ratio\n    # R: specific gas constant (J/(kg*K))\n    # y_prime_at_x0: value of the first derivative of wall shape y(x) at x0\n    # y_double_prime_at_x0: value of the second derivative of wall shape y(x) at x0\n    \n    test_cases = [\n        # Case A: happy path, flat wall\n        (100000, 300, 0.5, 1.4, 287, 0.0, 0.0),\n        # Case B: gentle curvature via parabola (Rc = 2.0 m)\n        (120000, 320, 0.8, 1.4, 287, 0.0, 1.0 / 2.0),\n        # Case C: transonic curvature via circle (Rc = 1.5 m)\n        (100000, 300, 1.0, 1.4, 287, 0.0, -1.0 / 1.5),\n        # Case D: severe curvature and supersonic (Rc = 0.05 m)\n        (200000, 300, 2.5, 1.4, 287, 0.0, 1.0 / 0.05),\n        # Case E: near-stagnation tangential velocity (Rc = 0.2 m)\n        (100000, 300, 0.01, 1.4, 287, 0.0, 1.0 / 0.2),\n    ]\n\n    results = []\n\n    def calculate_dpdn(p, T, Mt, gamma, R, y_prime_val, y_double_prime_val):\n        \"\"\"Calculates |dp/dn| for a single case.\"\"\"\n        # 1. Calculate the magnitude of the wall curvature |kappa_w|\n        # |kappa_w(x)| = |y''(x)| / (1 + (y'(x))^2)^(3/2)\n        kappa_mag = np.abs(y_double_prime_val) / (1 + y_prime_val**2)**1.5\n\n        # If curvature is zero, the gradient is zero.\n        if kappa_mag == 0:\n            return 0.0\n\n        # 2. Calculate density rho\n        # rho = p / (R * T)\n        rho = p / (R * T)\n\n        # 3. Calculate speed of sound a\n        # a = sqrt(gamma * R * T)\n        a = np.sqrt(gamma * R * T)\n\n        # 4. Calculate tangential velocity Vt\n        # Vt = Mt * a\n        V_t = Mt * a\n\n        # 5. Calculate the magnitude of the normal pressure gradient\n        # |dp/dn| = rho * Vt^2 * |kappa_w|\n        dpdn_mag = rho * V_t**2 * kappa_mag\n        \n        return dpdn_mag\n\n    for case in test_cases:\n        p, T, Mt, gamma, R, y_prime_val, y_double_prime_val = case\n        result = calculate_dpdn(p, T, Mt, gamma, R, y_prime_val, y_double_prime_val)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The results are rounded to six decimal places.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "3296213"}, {"introduction": "The choice of an outflow boundary condition can dramatically affect the accuracy and stability of a compressible flow simulation, especially when shocks are present. This comprehensive exercise challenges you to model a shocked flow in a Laval nozzle and directly compare a naive extrapolation boundary condition with a more physically sound characteristic-based approach [@problem_id:3296195]. By analyzing the resulting shock position, pressure recovery, and wave reflections, you will see firsthand the critical importance of implementing boundary treatments that correctly account for outgoing characteristic waves.", "problem": "A one-dimensional quasi-steady analysis of compressible flow through a converging-diverging Laval nozzle is to be implemented to contrast the numerical impact of two outflow boundary conditions on shock placement, post-shock pressure recovery, and wave reflections. The nozzle geometry is specified by an area distribution $A(x)$ along the axial coordinate $x \\in [0,L]$ with throat at $x_{\\mathrm{t}}$ and exit at $x_{\\mathrm{e}}$. The flow is assumed inviscid, calorically perfect gas with constant ratio of specific heats $\\gamma$, and ideal gas constant normalized to unity, so that $a^2 = \\gamma T$ with speed of sound $a$, static temperature $T$, and the static equation of state $p = \\rho T$. Stagnation (total) quantities at the inlet are $p_0$ and $T_0$, with normalized values $p_0 = 1$ and $T_0 = 1$. The nozzle area is given by $A(x) = 1 + 2.2\\,(x - 1.5)^2$ for $x \\in [0,3]$, so that $L = 3$, $x_{\\mathrm{t}} = 1.5$, $A(x_{\\mathrm{t}}) = 1$, and $A(x_{\\mathrm{e}}) = A(3) = 5.95$.\n\nThe algorithm must begin from first principles. Use the one-dimensional inviscid Euler equations and their quasi-one-dimensional specialization with area variation to reason about isentropic flow relations, normal shock relations, and characteristic-based boundary behavior. From the conservation laws and the assumption of locally isentropic regions separated by a single normal shock, construct the area–Mach number relationship for an isentropic streamtube and the stagnation-to-static relations for pressure and temperature. Across a normal shock, use the Rankine–Hugoniot conditions derived from conservation of mass, momentum, and energy to relate upstream Mach number $M_1$ to downstream Mach number $M_2$ and the pressure jump $p_2/p_1$. At an outlet boundary, use linearized one-dimensional acoustics to define the acoustic impedance $Z = \\rho a$ of the outgoing medium and the reflection coefficient $R = (Z_{\\mathrm{b}} - Z)/(Z_{\\mathrm{b}} + Z)$ for a boundary with impedance $Z_{\\mathrm{b}}$, where $Z_{\\mathrm{b}} \\to \\infty$ approximates a hard reflection (supersonic outflow extrapolation acting like a high-impedance termination) and $Z_{\\mathrm{b}} = Z$ approximates a perfectly non-reflecting termination (characteristic outflow that matches the incoming characteristic).\n\nDefine the two boundary conditions to be compared:\n- Supersonic outflow extrapolation boundary condition: approximate the outlet as a high-impedance termination with $Z_{\\mathrm{b}} \\gg Z$, which implies a strong reflection with $R \\approx 1$.\n- Characteristic outflow boundary condition: approximate the outlet as impedance-matched with $Z_{\\mathrm{b}} = Z$, which implies minimal reflection with $R \\approx 0$.\n\nLet the external back pressure be $p_{\\mathrm{b}}$ and let a small-amplitude outgoing acoustic wave of amplitude $p_{\\mathrm{w}}$ impinge on the outlet. Model the effective outlet pressure felt by the internal flow as $p_{\\mathrm{eff}} = p_{\\mathrm{b}} + R\\,p_{\\mathrm{w}}$, where $R$ depends on the chosen boundary condition.\n\nFor a candidate shock location $x_{\\mathrm{s}} \\in (x_{\\mathrm{t}}, x_{\\mathrm{e}})$, compute:\n1. The supersonic upstream Mach number $M_1$ at $x_{\\mathrm{s}}$ using the area–Mach relation on the supersonic branch, taking the isentropic path from the throat ($A^* = A(x_{\\mathrm{t}})$).\n2. The upstream static pressure $p_1$ from $p_0$ and $M_1$ using isentropic relations derived from the Euler equations and the ideal gas law.\n3. The downstream Mach number $M_2$ and static pressure $p_2$ at $x_{\\mathrm{s}}$ by applying the Rankine–Hugoniot relations for a normal shock.\n4. The downstream stagnation pressure $p_{0,2}$ at $x_{\\mathrm{s}}$ from $p_2$ and $M_2$ using isentropic relations in the post-shock region.\n5. The isentropic subsonic evolution from $x_{\\mathrm{s}}$ to the exit $x_{\\mathrm{e}}$: determine the effective post-shock $A^*$ for the subsonic branch from $M_2$ at $A(x_{\\mathrm{s}})$, then find $M_{\\mathrm{e}}$ at $A(x_{\\mathrm{e}})$ on the subsonic branch and compute the exit static pressure $p_{\\mathrm{e}}$ from $p_{0,2}$ and $M_{\\mathrm{e}}$.\n\nDefine the steady shock location $x_{\\mathrm{s}}$ for a given $p_{\\mathrm{eff}}$ as the root of the scalar equation $p_{\\mathrm{e}}(x_{\\mathrm{s}}) - p_{\\mathrm{eff}} = 0$ over the interval $(x_{\\mathrm{t}}, x_{\\mathrm{e}})$, acknowledging that a physically admissible shock exists only when $p_{\\mathrm{eff}}$ exceeds the perfectly expanded supersonic exit pressure obtained from the supersonic branch without a shock.\n\nMeasurements to report for each boundary condition on each test case:\n- Downstream shock location $x_{\\mathrm{s}}$ as a float (use $-1.0$ if no internal shock exists).\n- Pressure recovery across the shock $p_2/p_1$ as a float (use $1.0$ if no internal shock exists).\n- Reflection coefficient magnitude $R$ as a float.\n\nAll quantities are nondimensionalized by the inlet stagnation values, so no physical units are required. Angles are not used.\n\nImplement a complete, runnable program that:\n- Computes the above using numerical root finding for the shock location when it exists, and falls back to reporting no-shock metrics otherwise.\n- Uses the acoustic impedance model to compute $R$ for each boundary condition; approximate $Z_{\\mathrm{b}}$ for supersonic outflow extrapolation as a large multiple of the local medium impedance $Z$ to model a high-impedance termination, and use $Z_{\\mathrm{b}} = Z$ for characteristic outflow.\n- Aggregates the results for the specified test suite into the exact final output format.\n\nTest suite parameters to cover typical, near-boundary, and edge scenarios:\n- Case $1$: $\\gamma = 1.4$, $p_0 = 1$, $p_{\\mathrm{b}} = 0.12$, $p_{\\mathrm{w}} = 0.01$.\n- Case $2$: $\\gamma = 1.4$, $p_0 = 1$, $p_{\\mathrm{b}} = 0.05$, $p_{\\mathrm{w}} = 0.008$.\n- Case $3$: $\\gamma = 1.4$, $p_0 = 1$, $p_{\\mathrm{b}} = 0.03$, $p_{\\mathrm{w}} = 0.005$.\n\nFinal output format requirement:\n- Your program should produce a single line of output containing a list of lists, one sublist per test case, each sublist in the order $[x_{\\mathrm{s}}^{\\mathrm{extrap}}, x_{\\mathrm{s}}^{\\mathrm{char}}, (p_2/p_1)^{\\mathrm{extrap}}, (p_2/p_1)^{\\mathrm{char}}, R^{\\mathrm{extrap}}, R^{\\mathrm{char}}]$, with all numbers printed as Python floats. For example, a single line like $[[v_{11},v_{12},v_{13},v_{14},v_{15},v_{16}],[v_{21},v_{22},v_{23},v_{24},v_{25},v_{26}],[v_{31},v_{32},v_{33},v_{34},v_{35},v_{36}]]$.", "solution": "The problem requires a one-dimensional, quasi-steady analysis of compressible flow in a Laval nozzle to determine the location of a normal shock under different outflow boundary conditions. The solution is constructed from the fundamental principles of gas dynamics.\n\n### I. Governing Principles for Isentropic Flow\nThe flow is modeled as inviscid and for a calorically perfect gas. In regions without shocks, the flow is isentropic. The relationship between stagnation and static properties is governed by the Mach number $M = u/a$, where $u$ is the flow velocity and $a = \\sqrt{\\gamma T}$ is the local speed of sound. Given the normalized inlet stagnation pressure $p_0=1$ and temperature $T_0=1$, the local static pressure $p$ and temperature $T$ are:\n$$ \\frac{p_0}{p} = \\left( 1 + \\frac{\\gamma-1}{2} M^2 \\right)^{\\frac{\\gamma}{\\gamma-1}} \\implies p = \\left( 1 + \\frac{\\gamma-1}{2} M^2 \\right)^{-\\frac{\\gamma}{\\gamma-1}} $$\n$$ \\frac{T_0}{T} = 1 + \\frac{\\gamma-1}{2} M^2 \\implies T = \\left( 1 + \\frac{\\gamma-1}{2} M^2 \\right)^{-1} $$\nwhere $\\gamma$ is the ratio of specific heats.\n\nFor quasi-one-dimensional flow, conservation of mass and momentum under isentropic conditions leads to the area-Mach number relation, which connects the local cross-sectional area $A$ to the Mach number $M$. The relation is referenced to the sonic throat area $A^*$, where $M=1$:\n$$ \\frac{A}{A^*} = \\frac{1}{M} \\left[ \\frac{2}{\\gamma+1} \\left(1 + \\frac{\\gamma-1}{2} M^2 \\right) \\right]^{\\frac{\\gamma+1}{2(\\gamma-1)}} $$\nThis equation is transcendental in $M$ and must be solved numerically. For a given area ratio $A/A^* > 1$, there exist two solutions for $M$: one subsonic ($M1$) and one supersonic ($M>1$). The nozzle geometry is given by $A(x) = 1 + 2.2(x-1.5)^2$, with the throat at $x_{\\mathrm{t}}=1.5$ where $A(x_{\\mathrm{t}})=1$. Since the inlet is a large reservoir, we assume the flow chokes at the throat, so the reference sonic area for the flow upstream of any shock is $A^*=A(x_{\\mathrm{t}})=1$.\n\n### II. Normal Shock Relations\nIf a normal shock occurs, there is an abrupt, non-isentropic change in flow properties. The relationships across the shock (Rankine-Hugoniot conditions) are derived from the conservation of mass, momentum, and energy. Subscript $1$ denotes conditions immediately upstream of the shock, and subscript $2$ denotes conditions immediately downstream.\nThe downstream Mach number $M_2$ is a function of the upstream Mach number $M_1$:\n$$ M_2^2 = \\frac{M_1^2 + \\frac{2}{\\gamma-1}}{\\frac{2\\gamma}{\\gamma-1}M_1^2 - 1} $$\nA shock can only form in supersonic flow ($M_1 > 1$), and the flow downstream is always subsonic ($M_2  1$).\nThe static pressure ratio across the shock, which represents the pressure recovery, is:\n$$ \\frac{p_2}{p_1} = \\frac{2\\gamma}{\\gamma+1}M_1^2 - \\frac{\\gamma-1}{\\gamma+1} $$\nAcross the shock, stagnation pressure is lost. The new downstream stagnation pressure $p_{0,2}$ can be found from the local static properties $(p_2, M_2)$ via the isentropic relation:\n$$ p_{0,2} = p_2 \\left( 1 + \\frac{\\gamma-1}{2} M_2^2 \\right)^{\\frac{\\gamma}{\\gamma-1}} $$\n\n### III. Modeling the Flow with an Internal Shock\nTo find the steady shock location $x_{\\mathrm{s}}$ for a given effective back pressure $p_{\\mathrm{eff}}$, we construct a function $p_{\\mathrm{e}}(x_{\\mathrm{s}})$ that calculates the nozzle exit pressure resulting from a shock at location $x_{\\mathrm{s}}$. The correct $x_{\\mathrm{s}}$ is the root of the equation $p_{\\mathrm{e}}(x_{\\mathrm{s}}) - p_{\\mathrm{eff}} = 0$.\n\nThe algorithm to compute $p_{\\mathrm{e}}(x_{\\mathrm{s}})$ for a candidate shock location $x_{\\mathrm{s}} \\in (x_{\\mathrm{t}}, x_{\\mathrm{e}})$ is as follows:\n1.  **Upstream Isentropic Flow**: For a given $x_{\\mathrm{s}}$, calculate the area $A(x_{\\mathrm{s}})$. Since the flow is isentropic from the throat to the shock, the area ratio is $A(x_{\\mathrm{s}})/A(x_{\\mathrm{t}})$. Solve the area-Mach number relation for the supersonic Mach number $M_1$ at $x_{\\mathrm{s}}$.\n2.  **Pre-Shock Static Pressure**: Calculate the static pressure $p_1$ just before the shock using the isentropic pressure relation with $M_1$ and $p_0=1$.\n3.  **Normal Shock Jump**: Apply the Rankine-Hugoniot relations to find the post-shock Mach number $M_2$ and static pressure $p_2$.\n4.  **Post-Shock Stagnation Pressure**: Calculate the post-shock stagnation pressure $p_{0,2}$ from $p_2$ and $M_2$.\n5.  **Downstream Isentropic Flow**: The flow from $x_{\\mathrm{s}}$ to the exit $x_{\\mathrm{e}}$ is subsonic and isentropic, governed by the stagnation pressure $p_{0,2}$. This new isentropic flow has a different effective sonic area, $A_{2}^*$. We find $A_{2}^*$ by applying the area-Mach relation at $x_{\\mathrm{s}}$ with area $A(x_{\\mathrm{s}})$ and Mach number $M_2$.\n6.  **Exit Conditions**: Using the area ratio $A(x_{\\mathrm{e}})/A_{2}^*$ (where $x_{\\mathrm{e}}=3$), solve the area-Mach relation for the subsonic exit Mach number $M_{\\mathrm{e}}$.\n7.  **Exit Static Pressure**: Calculate the exit pressure $p_{\\mathrm{e}}$ using the isentropic pressure relation with $M_{\\mathrm{e}}$ and the post-shock stagnation pressure $p_{0,2}$. This is the value of $p_{\\mathrm{e}}(x_{\\mathrms})$.\n\n### IV. Outflow Boundary Condition Model\nThe problem introduces an acoustic model for the outlet boundary to determine the effective back pressure $p_{\\mathrm{eff}}$.\n-   **Acoustic Impedance**: $Z = \\rho a$.\n-   **Reflection Coefficient**: $R = (Z_{\\mathrm{b}} - Z)/(Z_{\\mathrm{b}} + Z)$, where $Z_{\\mathrm{b}}$ is the impedance of the external medium.\n-   **Effective Back Pressure**: $p_{\\mathrm{eff}} = p_{\\mathrm{b}} + R \\, p_{\\mathrm{w}}$, where $p_{\\mathrm{b}}$ is the ambient back pressure and $p_{\\mathrm{w}}$ is the amplitude of an outgoing acoustic wave.\n\nThe two boundary conditions are modeled as follows:\n1.  **Supersonic Outflow Extrapolation**: This corresponds to a high-impedance termination, $Z_{\\mathrm{b}} \\gg Z$. We model this by setting $Z_{\\mathrm{b}} = K Z$ with a large constant $K$ (e.g., $K=10^6$). The reflection coefficient is $R^{\\mathrm{extrap}} = (K-1)/(K+1) \\approx 1$.\n2.  **Characteristic Outflow**: This corresponds to a perfectly non-reflecting boundary, $Z_{\\mathrm{b}} = Z$. The reflection coefficient is $R^{\\mathrm{char}} = (1-1)/(1+1) = 0$.\n\n### V. Numerical Solution Algorithm\nFor each test case $(\\gamma, p_{\\mathrm{b}}, p_{\\mathrm{w}})$ and for each boundary condition type:\n1.  **Calculate $R$ and $p_{\\mathrm{eff}}$**: Determine the reflection coefficient $R$ and the effective pressure $p_{\\mathrm{eff}}$ for the boundary condition.\n2.  **Check for Shock Existence**: A normal shock exists inside the diverging section only if $p_{\\mathrm{eff}}$ lies within a specific range.\n    -   The minimum pressure, $p_{\\mathrm{min}}$, corresponds to fully supersonic flow to the exit (shock downstream of exit). This is found by solving the area-Mach relation for the supersonic $M_{\\mathrm{e}}$ at $A(x_{\\mathrm{e}})$ and computing the corresponding isentropic static pressure.\n    -   The maximum pressure, $p_{\\mathrm{max}}$, corresponds to fully subsonic flow throughout the nozzle. This is found by solving the area-Mach relation for the subsonic $M_{\\mathrm{e}}$ at $A(x_{\\mathrm{e}})$ and computing its isentropic static pressure.\n    -   If $p_{\\mathrm{min}}  p_{\\mathrm{eff}}  p_{\\mathrm{max}}$, a shock exists. Otherwise, no internal shock is formed, and we report default values ($x_{\\mathrm{s}} = -1.0, p_2/p_1 = 1.0$).\n3.  **Find Shock Location**: If a shock is expected, solve the nonlinear equation $p_{\\mathrm{e}}(x_{\\mathrm{s}}) - p_{\\mathrm{eff}} = 0$ for $x_{\\mathrms}$ over the interval $(x_{\\mathrm{t}}, x_{\\mathrm{e}})$, i.e., $(1.5, 3.0)$. A numerical root-finding method like the Brent-Dekker method is suitable.\n4.  **Compute Metrics**: Once the shock location $x_{\\mathrms}$ is found, re-evaluate the flow conditions at $x_{\\mathrms}$ to compute the pressure recovery ratio $p_2/p_1$.\n5.  **Aggregate and Report**: Collect the computed values ($x_{\\mathrms}$, $p_2/p_1$, $|R|$) for each boundary condition and test case, and format the output as specified.\n\nThe implementation will rely on numerical root-finders to solve for Mach numbers from the area ratio and for the shock location from the pressure matching condition.", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves the 1D quasi-steady compressible flow problem in a Laval nozzle\n    for different outflow boundary conditions.\n    \"\"\"\n\n    test_cases = [\n        # (gamma, p_b, p_w)\n        (1.4, 0.12, 0.01),\n        (1.4, 0.05, 0.008),\n        (1.4, 0.03, 0.005),\n    ]\n\n    # Nozzle geometry\n    nozzle_area = lambda x: 1.0 + 2.2 * (x - 1.5)**2\n    x_throat = 1.5\n    x_exit = 3.0\n\n    # Approximations for boundary conditions\n    K_extrap = 1e6  # Large factor for high-impedance approximation\n\n    # Helper function for area-Mach relation residual\n    def area_mach_residual(M, A_ratio, gamma):\n        if M == 0:\n            return -np.inf\n        term1 = 2 / (gamma + 1)\n        term2 = 1 + (gamma - 1) / 2 * M**2\n        return (A_ratio**2) - (1 / M**2) * (term1 * term2)**((gamma + 1) / (gamma - 1))\n\n    # Helper function to get Mach from Area Ratio\n    def get_mach_from_area_ratio(A_ratio, gamma, branch='supersonic'):\n        try:\n            if branch == 'supersonic':\n                # Search for M > 1\n                return brentq(area_mach_residual, 1.00001, 10.0, args=(A_ratio, gamma))\n            else: # subsonic\n                # Search for M  1\n                return brentq(area_mach_residual, 1e-6, 0.99999, args=(A_ratio, gamma))\n        except ValueError:\n            return np.nan\n\n    # Main function to calculate exit pressure given a shock location\n    def calculate_exit_pressure(x_s, gamma):\n        p0 = 1.0\n        A_t = nozzle_area(x_throat)\n        \n        # 1. Upstream Isentropic Flow\n        A_s = nozzle_area(x_s)\n        A_ratio_1 = A_s / A_t\n        M1 = get_mach_from_area_ratio(A_ratio_1, gamma, branch='supersonic')\n        if np.isnan(M1): return np.nan\n        \n        # 2. Pre-Shock Static Pressure\n        p1 = p0 * (1 + (gamma - 1) / 2 * M1**2)**(-gamma / (gamma - 1))\n\n        # 3. Normal Shock Jump\n        M1_sq = M1**2\n        M2_sq = (M1_sq + 2 / (gamma - 1)) / (2 * gamma / (gamma - 1) * M1_sq - 1)\n        M2 = np.sqrt(M2_sq)\n        p2 = p1 * (1 + 2 * gamma / (gamma + 1) * (M1_sq - 1))\n\n        # 4. Post-Shock Stagnation Pressure\n        p0_2 = p2 * (1 + (gamma - 1) / 2 * M2**2)**(gamma / (gamma - 1))\n\n        # 5. Downstream Isentropic Flow (find effective A*)\n        # Using area-mach relation at shock location with post-shock conditions\n        gm1 = gamma - 1\n        gp1 = gamma + 1\n        term = (1/M2) * ( (2/gp1) * (1 + gm1/2*M2**2) )**(gp1/(2*gm1))\n        A2_star = A_s / term\n\n        # 6. Exit Conditions\n        A_e = nozzle_area(x_exit)\n        A_ratio_2 = A_e / A2_star\n        M_e = get_mach_from_area_ratio(A_ratio_2, gamma, branch='subsonic')\n        if np.isnan(M_e): return np.nan\n\n        # 7. Exit Static Pressure\n        p_e = p0_2 * (1 + (gamma - 1) / 2 * M_e**2)**(-gamma / (gamma - 1))\n        \n        return p_e\n\n    # Residual for shock location root finding\n    def shock_location_residual(x_s, p_target, gamma):\n        p_e = calculate_exit_pressure(x_s, gamma)\n        if np.isnan(p_e):\n            # Penalize invalid x_s values to guide the solver\n            return 1e9 * (x_s - x_throat)\n        return p_e - p_target\n\n    final_results = []\n    \n    for gamma, p_b, p_w in test_cases:\n        p0 = 1.0\n        A_t = nozzle_area(x_throat)\n        A_e = nozzle_area(x_exit)\n        A_ratio_exit = A_e / A_t\n\n        # Calculate pressure bounds for shock existence\n        M_e_sup = get_mach_from_area_ratio(A_ratio_exit, gamma, branch='supersonic')\n        p_min = p0 * (1 + (gamma - 1) / 2 * M_e_sup**2)**(-gamma / (gamma - 1))\n\n        M_e_sub = get_mach_from_area_ratio(A_ratio_exit, gamma, branch='subsonic')\n        p_max = p0 * (1 + (gamma - 1) / 2 * M_e_sub**2)**(-gamma / (gamma - 1))\n        \n        case_results = []\n        \n        # Define BCs and their parameters\n        bcs = {\n            'extrap': {'K': K_extrap},\n            'char': {'K': 1.0}\n        }\n        \n        results_map = {}\n\n        for name, params in bcs.items():\n            K = params['K']\n            R = (K - 1) / (K + 1)\n            p_eff = p_b + R * p_w\n\n            if not (p_min  p_eff  p_max):\n                x_s_sol = -1.0\n                p_recovery = 1.0\n            else:\n                try:\n                    # Use a narrow but safe interval away from singularities\n                    x_s_sol = brentq(shock_location_residual, x_throat + 1e-6, x_exit - 1e-6, args=(p_eff, gamma))\n\n                    A_s_sol = nozzle_area(x_s_sol)\n                    A_ratio_sol = A_s_sol / A_t\n                    M1_sol = get_mach_from_area_ratio(A_ratio_sol, gamma, branch='supersonic')\n                    p_recovery = 1 + 2 * gamma / (gamma + 1) * (M1_sol**2 - 1)\n                except ValueError:\n                    # Root not bracketed, implies pressure is outside shock regime\n                    x_s_sol = -1.0\n                    p_recovery = 1.0\n            \n            results_map[name] = {\n                'xs': x_s_sol,\n                'pr': p_recovery,\n                'R': abs(R)\n            }\n        \n        # Assemble sublist in the required order\n        case_results.extend([\n            results_map['extrap']['xs'],\n            results_map['char']['xs'],\n            results_map['extrap']['pr'],\n            results_map['char']['pr'],\n            results_map['extrap']['R'],\n            results_map['char']['R']\n        ])\n        \n        final_results.append(case_results)\n\n    print(f\"{final_results}\")\n\nsolve()\n```", "id": "3296195"}]}