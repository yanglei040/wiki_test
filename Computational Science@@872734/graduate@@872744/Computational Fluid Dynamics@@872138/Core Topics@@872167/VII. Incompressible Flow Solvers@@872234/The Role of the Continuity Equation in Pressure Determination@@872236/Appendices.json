{"hands_on_practices": [{"introduction": "In incompressible flow, the continuity equation $\\nabla \\cdot \\mathbf{u} = 0$ acts as a kinematic constraint rather than a prognostic equation for a specific variable. This practice grounds your understanding in the fundamental mechanism used to enforce this constraint: the introduction of a scalar field, physically analogous to pressure, whose gradient corrects a provisional velocity field. By working through the analytical derivation and solution for a simple case ([@problem_id:3380231]), you will see precisely how the requirement of a divergence-free velocity field gives rise to the celebrated Pressure Poisson Equation.", "problem": "Consider a nondimensional, two-dimensional, periodic domain $\\Omega = [0,2\\pi] \\times [0,2\\pi]$ with periodic boundary conditions on all sides. Let $\\boldsymbol{u}(x,y)$ be a prescribed velocity field that is not divergence-free and suppose we wish to determine the pressure-like correction that enforces the incompressible continuity equation. Starting from the incompressible continuity constraint $\\nabla \\cdot \\boldsymbol{u}^{\\star} = 0$ and the fact that pressure acts to enforce this constraint by providing a gradient correction, require that the corrected velocity $\\boldsymbol{u}^{\\star} = \\boldsymbol{u} - \\nabla \\phi$ be divergence-free. Impose periodic boundary conditions and the zero spatial mean constraint $\\int_{\\Omega} \\phi \\, \\mathrm{d}\\boldsymbol{x} = 0$ to fix the uniqueness of $\\phi$.\n\nFor the specific velocity field\n$$\n\\boldsymbol{u}(x,y) = \\begin{pmatrix} A \\cos(x)\\,\\sin(y) \\\\ B \\sin(x)\\,\\cos(y) \\end{pmatrix},\n$$\nwith real constants $A$ and $B$, perform the following:\n\n1. Derive, from the continuity constraint and the stated boundary conditions, the governing equation for the scalar field $\\phi(x,y)$ such that $\\boldsymbol{u}^{\\star} = \\boldsymbol{u} - \\nabla \\phi$ is divergence-free on $\\Omega$.\n2. Solve for the explicit analytic expression of $\\phi(x,y)$ that satisfies the periodic boundary conditions and the zero-mean constraint.\n3. Using the definition of the $L^{2}$ norm $\\|\\nabla \\cdot \\boldsymbol{u}\\|_{L^{2}(\\Omega)} = \\left( \\int_{\\Omega} |\\nabla \\cdot \\boldsymbol{u}|^{2} \\, \\mathrm{d}x\\,\\mathrm{d}y \\right)^{1/2}$, compute the reduction \n$$\n\\Delta = \\|\\nabla \\cdot \\boldsymbol{u}\\|_{L^{2}(\\Omega)} - \\|\\nabla \\cdot \\boldsymbol{u}^{\\star}\\|_{L^{2}(\\Omega)}.\n$$\n\nExpress your final answer as a two-component row vector in analytic form, where the first component is the function $\\phi(x,y)$ and the second component is the scalar $\\Delta$. No rounding is required.", "solution": "### Part 1: Derivation of the Governing Equation for $\\phi(x,y)$\nThe corrected velocity field $\\boldsymbol{u}^{\\star}$ is required to be divergence-free. The definition of $\\boldsymbol{u}^{\\star}$ is given as $\\boldsymbol{u}^{\\star} = \\boldsymbol{u} - \\nabla \\phi$.\nThe continuity constraint is:\n$$\n\\nabla \\cdot \\boldsymbol{u}^{\\star} = 0\n$$\nSubstituting the expression for $\\boldsymbol{u}^{\\star}$:\n$$\n\\nabla \\cdot (\\boldsymbol{u} - \\nabla \\phi) = 0\n$$\nUsing the linearity of the divergence operator:\n$$\n\\nabla \\cdot \\boldsymbol{u} - \\nabla \\cdot (\\nabla \\phi) = 0\n$$\nThe divergence of the gradient of a scalar field is the Laplacian operator, $\\nabla \\cdot (\\nabla \\phi) = \\nabla^2 \\phi$. Therefore, the governing equation for $\\phi$ is the Poisson equation:\n$$\n\\nabla^2 \\phi = \\nabla \\cdot \\boldsymbol{u}\n$$\nNext, we compute the source term, $\\nabla \\cdot \\boldsymbol{u}$, for the given velocity field $\\boldsymbol{u}(x,y) = \\begin{pmatrix} A \\cos(x)\\,\\sin(y) \\\\ B \\sin(x)\\,\\cos(y) \\end{pmatrix}$.\nLet $u_x(x,y) = A \\cos(x)\\,\\sin(y)$ and $u_y(x,y) = B \\sin(x)\\,\\cos(y)$.\n$$\n\\nabla \\cdot \\boldsymbol{u} = \\frac{\\partial u_x}{\\partial x} + \\frac{\\partial u_y}{\\partial y} = \\frac{\\partial}{\\partial x} (A \\cos(x)\\,\\sin(y)) + \\frac{\\partial}{\\partial y} (B \\sin(x)\\,\\cos(y))\n$$\n$$\n\\nabla \\cdot \\boldsymbol{u} = -A \\sin(x)\\,\\sin(y) - B \\sin(x)\\,\\sin(y) = -(A+B) \\sin(x)\\,\\sin(y)\n$$\nThus, the governing equation for $\\phi(x,y)$ is:\n$$\n\\frac{\\partial^2 \\phi}{\\partial x^2} + \\frac{\\partial^2 \\phi}{\\partial y^2} = -(A+B) \\sin(x)\\,\\sin(y)\n$$\n\n### Part 2: Solution for $\\phi(x,y)$\nWe solve the Poisson equation derived above on the domain $\\Omega = [0,2\\pi] \\times [0,2\\pi]$ with periodic boundary conditions and the zero-mean constraint. Given the trigonometric form of the source term, we propose a solution of a similar form (method of undetermined coefficients):\n$$\n\\phi(x,y) = C \\sin(x)\\,\\sin(y)\n$$\nwhere $C$ is a constant to be determined. We compute the Laplacian of this trial solution:\n$$\n\\frac{\\partial \\phi}{\\partial x} = C \\cos(x)\\,\\sin(y) \\implies \\frac{\\partial^2 \\phi}{\\partial x^2} = -C \\sin(x)\\,\\sin(y)\n$$\n$$\n\\frac{\\partial \\phi}{\\partial y} = C \\sin(x)\\,\\cos(y) \\implies \\frac{\\partial^2 \\phi}{\\partial y^2} = -C \\sin(x)\\,\\sin(y)\n$$\n$$\n\\nabla^2 \\phi = \\frac{\\partial^2 \\phi}{\\partial x^2} + \\frac{\\partial^2 \\phi}{\\partial y^2} = -C \\sin(x)\\,\\sin(y) - C \\sin(x)\\,\\sin(y) = -2C \\sin(x)\\,\\sin(y)\n$$\nSubstituting this back into the Poisson equation:\n$$\n-2C \\sin(x)\\,\\sin(y) = -(A+B) \\sin(x)\\,\\sin(y)\n$$\nThis equality must hold for all $(x,y) \\in \\Omega$, which implies:\n$$\n-2C = -(A+B) \\implies C = \\frac{A+B}{2}\n$$\nSo, a particular solution is $\\phi_p(x,y) = \\frac{A+B}{2} \\sin(x)\\,\\sin(y)$. The general solution is this particular solution plus any solution to the homogeneous Laplace equation, $\\nabla^2 \\phi_h = 0$, that satisfies the periodic boundary conditions. The only such solutions are constants, so $\\phi_h(x,y) = K$. The general periodic solution is:\n$$\n\\phi(x,y) = \\frac{A+B}{2} \\sin(x)\\,\\sin(y) + K\n$$\nWe now apply the zero-mean constraint $\\int_{\\Omega} \\phi \\, \\mathrm{d}\\boldsymbol{x} = 0$ to find $K$:\n$$\n\\int_{0}^{2\\pi} \\int_{0}^{2\\pi} \\left( \\frac{A+B}{2} \\sin(x)\\,\\sin(y) + K \\right) \\mathrm{d}x\\,\\mathrm{d}y = 0\n$$\n$$\n\\frac{A+B}{2} \\left(\\int_{0}^{2\\pi} \\sin(x)\\,\\mathrm{d}x\\right) \\left(\\int_{0}^{2\\pi} \\sin(y)\\,\\mathrm{d}y\\right) + K \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} \\mathrm{d}x\\,\\mathrm{d}y = 0\n$$\nThe integral of $\\sin(t)$ over a full period $[0, 2\\pi]$ is $0$.\n$$\n\\int_{0}^{2\\pi} \\sin(t)\\,\\mathrm{d}t = [-\\cos(t)]_{0}^{2\\pi} = -1 - (-1) = 0\n$$\nTherefore, the first term vanishes. The equation simplifies to:\n$$\nK \\cdot (\\text{Area of } \\Omega) = K \\cdot (2\\pi \\cdot 2\\pi) = 4\\pi^2 K = 0\n$$\nThis implies $K=0$. The unique solution for $\\phi(x,y)$ is:\n$$\n\\phi(x,y) = \\frac{A+B}{2} \\sin(x)\\,\\sin(y)\n$$\n\n### Part 3: Computation of the Reduction $\\Delta$\nThe reduction $\\Delta$ is defined as:\n$$\n\\Delta = \\|\\nabla \\cdot \\boldsymbol{u}\\|_{L^{2}(\\Omega)} - \\|\\nabla \\cdot \\boldsymbol{u}^{\\star}\\|_{L^{2}(\\Omega)}\n$$\nBy construction, the corrected field $\\boldsymbol{u}^{\\star}$ is divergence-free, i.e., $\\nabla \\cdot \\boldsymbol{u}^{\\star} = 0$. The norm of a zero function is $0$, so $\\|\\nabla \\cdot \\boldsymbol{u}^{\\star}\\|_{L^{2}(\\Omega)} = 0$. The reduction simplifies to:\n$$\n\\Delta = \\|\\nabla \\cdot \\boldsymbol{u}\\|_{L^{2}(\\Omega)}\n$$\nWe compute this norm using its definition:\n$$\n\\|\\nabla \\cdot \\boldsymbol{u}\\|_{L^{2}(\\Omega)} = \\left( \\int_{\\Omega} |\\nabla \\cdot \\boldsymbol{u}|^{2} \\, \\mathrm{d}x\\,\\mathrm{d}y \\right)^{1/2}\n$$\nFrom Part 1, we have $\\nabla \\cdot \\boldsymbol{u} = -(A+B) \\sin(x)\\,\\sin(y)$. Squaring this gives:\n$$\n|\\nabla \\cdot \\boldsymbol{u}|^{2} = \\left( -(A+B) \\sin(x)\\,\\sin(y) \\right)^2 = (A+B)^2 \\sin^2(x)\\,\\sin^2(y)\n$$\nNow we integrate over the domain $\\Omega$:\n$$\n\\int_{\\Omega} |\\nabla \\cdot \\boldsymbol{u}|^{2} \\, \\mathrm{d}x\\,\\mathrm{d}y = \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} (A+B)^2 \\sin^2(x)\\,\\sin^2(y) \\, \\mathrm{d}x\\,\\mathrm{d}y\n$$\n$$\n= (A+B)^2 \\left( \\int_{0}^{2\\pi} \\sin^2(x) \\, \\mathrm{d}x \\right) \\left( \\int_{0}^{2\\pi} \\sin^2(y) \\, \\mathrm{d}y \\right)\n$$\nWe evaluate the definite integral of $\\sin^2(t)$:\n$$\n\\int_{0}^{2\\pi} \\sin^2(t) \\, \\mathrm{d}t = \\int_{0}^{2pi} \\frac{1-\\cos(2t)}{2} \\, \\mathrm{d}t = \\frac{1}{2} \\left[ t - \\frac{\\sin(2t)}{2} \\right]_{0}^{2\\pi}\n$$\n$$\n= \\frac{1}{2} \\left( (2\\pi - 0) - (0-0) \\right) = \\pi\n$$\nSubstituting this result back, we get:\n$$\n\\int_{\\Omega} |\\nabla \\cdot \\boldsymbol{u}|^{2} \\, \\mathrm{d}x\\,\\mathrm{d}y = (A+B)^2 (\\pi)(\\pi) = (A+B)^2\\pi^2\n$$\nFinally, we take the square root to find the $L^2$ norm:\n$$\n\\Delta = \\|\\nabla \\cdot \\boldsymbol{u}\\|_{L^{2}(\\Omega)} = \\sqrt{(A+B)^2\\pi^2} = \\sqrt{(A+B)^2} \\sqrt{\\pi^2} = |A+B|\\pi\n$$\nThe two components of the final answer are $\\phi(x,y) = \\frac{A+B}{2} \\sin(x)\\sin(y)$ and $\\Delta = |A+B|\\pi$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{A+B}{2} \\sin(x)\\sin(y)  |A+B|\\pi\n\\end{pmatrix}\n}\n$$", "id": "3380231"}, {"introduction": "Moving from continuous theory to numerical practice, this exercise explores how the continuity constraint is managed within the Finite Volume Method (FVM), the workhorse of industrial CFD. When a flow field is discretized, a provisional velocity field will generally result in a non-zero net mass flux, or a 'mass imbalance,' for each control volume. This hands-on calculation ([@problem_id:3380209]) demystifies the pressure-correction equation by having you compute this imbalance and then determine the exact pressure correction needed to restore mass conservation locally, forming the foundational step of iterative algorithms like SIMPLE and PISO.", "problem": "Consider a single internal rectangular control volume in a steady, incompressible flow field discretized by the Finite Volume Method (FVM). The control volume dimensions are $\\Delta x = 0.02$ m, $\\Delta y = 0.03$ m, and $\\Delta z = 0.01$ m. The fluid density is uniform and equal to $\\rho = 1.2$ kg/m$^{3}$. The outward unit normal from the control volume points in $+\\hat{x}$ on the east face, $-\\hat{x}$ on the west face, $+\\hat{y}$ on the north face, and $-\\hat{y}$ on the south face. The predicted face-normal velocities are $u_{e}^{*} = 0.8$ m/s at the east face center, $u_{w}^{*} = -0.7$ m/s at the west face center, $v_{n}^{*} = 0.4$ m/s at the north face center, and $v_{s}^{*} = -0.9$ m/s at the south face center. There are no volumetric mass sources or sinks within the control volume.\n\n1. Using the integral form of the mass conservation (continuity) equation, compute the residual mass imbalance $R_{P}$ defined as the net outward mass flux through the control volume faces when the predicted velocities $u_{e}^{*}$, $u_{w}^{*}$, $v_{n}^{*}$, and $v_{s}^{*}$ are used. The face areas are $A_{e} = \\Delta y \\Delta z$, $A_{w} = \\Delta y \\Delta z$, $A_{n} = \\Delta x \\Delta z$, and $A_{s} = \\Delta x \\Delta z$.\n\n2. Assume a pressure-correction strategy in which the velocity correction is linearly proportional to the pressure-correction gradient in the face-normal direction. Specifically, at each face $f \\in \\{e,w,n,s\\}$, the mass-flux correction is related to the pressure correction by\n$$\n\\delta \\dot{m}_{f} \\;=\\; \\rho \\, A_{f} \\, d_{f} \\,\\frac{p_{P}' - p_{N(f)}'}{\\delta_{f}},\n$$\nwhere $p_{P}'$ is the pressure correction at the control volume center, $p_{N(f)}'$ is the pressure correction at the neighbor cell across face $f$, $d_{f}$ is a given mobility coefficient arising from the linearized momentum equation, and $\\delta_{f}$ is the distance between the two adjacent cell centers along the face-normal direction. For this control volume, take $\\delta_{e} = \\Delta x$, $\\delta_{w} = \\Delta x$, $\\delta_{n} = \\Delta y$, and $\\delta_{s} = \\Delta y$. The mobility coefficients are given as $d_{e} = 1.0 \\times 10^{-4}$ m$^{2}$/Pa$\\cdot$s, $d_{w} = 1.2 \\times 10^{-4}$ m$^{2}$/Pa$\\cdot$s, $d_{n} = 0.8 \\times 10^{-4}$ m$^{2}$/Pa$\\cdot$s, and $d_{s} = 1.5 \\times 10^{-4}$ m$^{2}$/Pa$\\cdot$s.\n\nFormulate the local discrete pressure-correction equation that enforces the continuity equation by requiring the corrected net outward mass flux to be zero in this control volume, and then compute the value of $p_{P}'$ that would drive the residual to zero in one iteration if the neighbor-cell pressure corrections are held at zero in this update, i.e., $p_{E}' = p_{W}' = p_{N}' = p_{S}' = 0$.\n\nExpress the final pressure correction in Pascals and round your answer to four significant figures.", "solution": "### Part 1: Calculation of the Residual Mass Imbalance\n\nThe integral form of the steady-state mass conservation equation over the control volume surface $S$ is:\n$$ \\oint_S \\rho (\\mathbf{v} \\cdot \\mathbf{n}) \\, dS = 0 $$\nIn the Finite Volume Method (FVM), this is approximated by summing the mass fluxes over the faces. The residual mass imbalance, $R_P$, is the net outward mass flux computed with the predicted velocities (denoted by a superscript $*$). Interpreting the given velocities as components in the Cartesian coordinate directions (e.g., $u_w^*$ is the x-velocity at the west face), the net outward flux is calculated as:\n$$ R_P = (\\rho u_e^* A_e) - (\\rho u_w^* A_w) + (\\rho v_n^* A_n) - (\\rho v_s^* A_s) $$\nwhere $A_e=A_w$ and $A_n=A_s$. This simplifies to:\n$$ R_P = \\rho [ A_e (u_e^* - u_w^*) + A_n (v_n^* - v_s^*) ] $$\nFirst, we calculate the face areas using the provided dimensions:\n$\\Delta x = 0.02$ m, $\\Delta y = 0.03$ m, $\\Delta z = 0.01$ m.\n$$ A_e = A_w = \\Delta y \\Delta z = (0.03 \\, \\text{m})(0.01 \\, \\text{m}) = 3 \\times 10^{-4} \\, \\text{m}^2 $$\n$$ A_n = A_s = \\Delta x \\Delta z = (0.02 \\, \\text{m})(0.01 \\, \\text{m}) = 2 \\times 10^{-4} \\, \\text{m}^2 $$\nNext, we use the given fluid density and predicted velocities:\n$\\rho = 1.2$ kg/m$^3$.\n$u_e^* = 0.8$ m/s, $u_w^* = -0.7$ m/s, $v_n^* = 0.4$ m/s, $v_s^* = -0.9$ m/s.\n\nNow, we substitute these values into the equation for $R_P$:\n$$ R_P = (1.2 \\, \\text{kg/m}^3) [ (3 \\times 10^{-4} \\, \\text{m}^2)(0.8 \\, \\text{m/s} - (-0.7 \\, \\text{m/s})) + (2 \\times 10^{-4} \\, \\text{m}^2)(0.4 \\, \\text{m/s} - (-0.9 \\, \\text{m/s})) ] $$\n$$ R_P = 1.2 [ (3 \\times 10^{-4})(1.5) + (2 \\times 10^{-4})(1.3) ] \\, \\text{kg/s} $$\n$$ R_P = 1.2 [ 4.5 \\times 10^{-4} + 2.6 \\times 10^{-4} ] \\, \\text{kg/s} $$\n$$ R_P = 1.2 [ 7.1 \\times 10^{-4} ] \\, \\text{kg/s} $$\n$$ R_P = 8.52 \\times 10^{-4} \\, \\text{kg/s} $$\n\n### Part 2: Formulation and Solution of the Pressure-Correction Equation\n\nThe pressure-correction method aims to find a pressure-correction field, $p'$, that induces velocity corrections such that the corrected velocity field satisfies continuity. This means the sum of the corrected mass fluxes out of the control volume must be zero:\n$$ \\sum_{f} \\dot{m}_{f, \\text{corrected}} = 0 $$\nThe corrected flux is the sum of the predicted flux and the flux correction: $\\dot{m}_{f, \\text{corrected}} = \\dot{m}^*_f + \\delta \\dot{m}_f$. The condition becomes:\n$$ \\left(\\sum_{f} \\dot{m}^*_f\\right) + \\left(\\sum_{f} \\delta \\dot{m}_f\\right) = R_P + \\sum_{f} \\delta \\dot{m}_f = 0 $$\nThe problem provides the formulation for the mass flux correction at each face $f$:\n$$ \\delta \\dot{m}_{f} = \\rho A_{f} d_{f} \\frac{p_{P}' - p_{N(f)}'}{\\delta_{f}} $$\nwhere $p_P'$ is the pressure correction in the central cell $P$, and $p_{N(f)}'$ is the correction in the neighbor cell. Substituting this into the balance equation gives the discrete pressure-correction equation:\n$$ R_P + \\rho A_e d_e \\frac{p_P' - p_E'}{\\delta_e} + \\rho A_w d_w \\frac{p_P' - p_W'}{\\delta_w} + \\rho A_n d_n \\frac{p_P' - p_N'}{\\delta_n} + \\rho A_s d_s \\frac{p_P' - p_S'}{\\delta_s} = 0 $$\nWe are asked to solve for $p_P'$ assuming the neighbor cell pressure-corrections are zero: $p_E' = p_W' = p_N' = p_S' = 0$. The equation simplifies to:\n$$ R_P + p_P' \\left( \\frac{\\rho A_e d_e}{\\delta_e} + \\frac{\\rho A_w d_w}{\\delta_w} + \\frac{\\rho A_n d_n}{\\delta_n} + \\frac{\\rho A_s d_s}{\\delta_s} \\right) = 0 $$\nSolving for $p_P'$:\n$$ p_P' = \\frac{-R_P}{\\frac{\\rho A_e d_e}{\\delta_e} + \\frac{\\rho A_w d_w}{\\delta_w} + \\frac{\\rho A_n d_n}{\\delta_n} + \\frac{\\rho A_s d_s}{\\delta_s}} $$\nLet's compute the terms in the denominator using the given coefficients:\n- $\\delta_e = \\delta_w = \\Delta x = 0.02$ m; $\\delta_n = \\delta_s = \\Delta y = 0.03$ m.\n- $d_e = 1.0 \\times 10^{-4}$ m$^2$/(Pa$\\cdot$s); $d_w = 1.2 \\times 10^{-4}$ m$^2$/(Pa$\\cdot$s); $d_n = 0.8 \\times 10^{-4}$ m$^2$/(Pa$\\cdot$s); $d_s = 1.5 \\times 10^{-4}$ m$^2$/(Pa$\\cdot$s).\n\nLet's calculate the coefficients $a_f = \\frac{\\rho A_f d_f}{\\delta_f}$:\n$$ a_e = \\frac{(1.2)(3 \\times 10^{-4})(1.0 \\times 10^{-4})}{0.02} = 1.8 \\times 10^{-6} \\, \\text{kg/(Pa}\\cdot\\text{s)} $$\n$$ a_w = \\frac{(1.2)(3 \\times 10^{-4})(1.2 \\times 10^{-4})}{0.02} = 2.16 \\times 10^{-6} \\, \\text{kg/(Pa}\\cdot\\text{s)} $$\n$$ a_n = \\frac{(1.2)(2 \\times 10^{-4})(0.8 \\times 10^{-4})}{0.03} = 0.64 \\times 10^{-6} \\, \\text{kg/(Pa}\\cdot\\text{s)} $$\n$$ a_s = \\frac{(1.2)(2 \\times 10^{-4})(1.5 \\times 10^{-4})}{0.03} = 1.2 \\times 10^{-6} \\, \\text{kg/(Pa}\\cdot\\text{s)} $$\nThe sum of these coefficients is:\n$$ \\sum a_f = (1.8 + 2.16 + 0.64 + 1.2) \\times 10^{-6} = 5.8 \\times 10^{-6} \\, \\text{kg/(Pa}\\cdot\\text{s)} $$\nNow, we can find $p_P'$:\n$$ p_P' = \\frac{-8.52 \\times 10^{-4} \\, \\text{kg/s}}{5.8 \\times 10^{-6} \\, \\text{kg/(Pa}\\cdot\\text{s)}} = -\\frac{8.52}{5.8} \\times 10^2 \\, \\text{Pa} $$\n$$ p_P' \\approx -1.4689655... \\times 10^2 \\, \\text{Pa} = -146.89655... \\, \\text{Pa} $$\nRounding the result to four significant figures gives:\n$$ p_P' \\approx -146.9 \\, \\text{Pa} $$\nThe positive mass residual $R_P$ indicates a net mass outflow, which is corrected by a negative pressure correction $p_P'$ that lowers the cell pressure relative to its neighbors, thereby reducing outflows and increasing inflows to achieve mass balance.", "answer": "$$\\boxed{-146.9}$$", "id": "3380209"}, {"introduction": "This final practice elevates the concept of pressure correction to the level of linear algebra and operator theory, revealing its elegant mathematical structure. The entire process of correcting a velocity field to make it divergence-free can be viewed as the action of a projection operator, which filters out any component of the flow that violates mass conservation. By implementing this projection using highly accurate spectral methods ([@problem_id:3380192]), you will not only enforce the continuity constraint globally but also analyze the fundamental properties of the projection operator itself by examining its spectrum, providing a deep insight into the Helmholtz-Hodge decomposition of vector fields.", "problem": "Consider a periodic, incompressible flow on the unit square domain $[0,1]\\times[0,1]$ sampled on a uniform, two-dimensional grid with $N_x$ points in the $x$-direction and $N_y$ points in the $y$-direction. Angles must be interpreted in radians. The incompressible continuity equation requires the velocity field $\\mathbf{u}=(u_x,u_y)$ to satisfy $\\nabla\\cdot\\mathbf{u}=0$. In numerical simulation, a provisional velocity $\\mathbf{u}$ may have nonzero divergence. A pressure correction $p$ is then introduced so that the corrected velocity $\\mathbf{u}^\\star=\\mathbf{u}-\\nabla p$ minimizes the divergence. This problem asks you to derive, implement, and analyze this minimization and the associated pressure projection operator.\n\nStarting from fundamental principles, use the incompressible continuity equation and periodic boundary conditions to formulate the least-squares minimization of the divergence of the corrected velocity. Specifically, define the cost functional\n$$\n\\mathcal{J}(p)=\\left\\|\\nabla\\cdot\\left(\\mathbf{u}-\\nabla p\\right)\\right\\|_{L^2}^2\n$$\nover scalar fields $p$ on $[0,1]\\times[0,1]$ having zero mean, with the norm defined by\n$$\n\\left\\|f\\right\\|_{L^2}=\\left(\\int_{0}^{1}\\int_{0}^{1} f(x,y)^2\\,\\mathrm{d}x\\,\\mathrm{d}y\\right)^{1/2}.\n$$\nDerive the condition that characterizes the minimizer (i.e., the optimal pressure correction), and explain how this condition arises from the continuity equation. Then, implement a spectral algorithm (using the Fast Fourier Transform (FFT)) to compute $p$ and $\\mathbf{u}^\\star$ on a discrete grid with periodic boundary conditions. Compute the discrete $L^2$-norm of the divergence of $\\mathbf{u}$ before correction and of $\\mathbf{u}^\\star$ after correction, using the discrete analogue of the divergence computed spectrally.\n\nDefine the pressure projection operator $\\mathsf{P}$ as the linear map that takes any velocity $\\mathbf{u}$ to the corrected velocity $\\mathbf{u}^\\star$ obtained by minimizing $\\mathcal{J}(p)$. Analyze the spectrum (the set of eigenvalues) of $\\mathsf{P}$ by considering its action in the Fourier domain on each wavevector. Numerically evaluate the eigenvalues of $\\mathsf{P}$ on the provided grids and report the smallest and largest eigenvalues observed across all discrete modes.\n\nYour program must implement the above steps and evaluate the following test suite. For each case, construct the specified synthetic velocity field, apply the spectral pressure correction, and return the discrete divergence norms before and after correction, as well as the minimum and maximum eigenvalues of the pressure projection operator over all modes on the given grid. All trigonometric functions must interpret angles in radians.\n\nTest suite:\n- Case $1$ (general case, square grid): $N_x=32$, $N_y=32$. Define\n  $$\n  u_x(x,y)=\\sin(2\\pi x)+\\tfrac{1}{2}\\sin(4\\pi y),\\quad\n  u_y(x,y)=0.3\\cos(2\\pi y)+0.1\\cos(2\\pi x).\n  $$\n- Case $2$ (rectangular grid, mixed components): $N_x=8$, $N_y=5$. Define\n  $$\n  u_x(x,y)=\\sin(2\\pi x)+0.2\\cos(2\\pi y),\\quad\n  u_y(x,y)=\\sin(2\\pi y)+0.1\\sin(2\\pi x).\n  $$\n- Case $3$ (edge case, divergence-free input): $N_x=3$, $N_y=3$. Define a stream function $\\psi(x,y)=\\sin(2\\pi x)\\sin(2\\pi y)$ and set\n  $$\n  u_x(x,y)=\\frac{\\partial \\psi}{\\partial y}(x,y),\\quad\n  u_y(x,y)=-\\frac{\\partial \\psi}{\\partial x}(x,y).\n  $$\n\nYour program must produce a single line of output containing the results as a comma-separated list of per-case results enclosed in square brackets, where each per-case result is itself a comma-separated list of four floats enclosed in square brackets, in the order\n$$\n\\left[\\left[\\text{before}_1,\\text{after}_1,\\min\\lambda_1,\\max\\lambda_1\\right],\\left[\\text{before}_2,\\text{after}_2,\\min\\lambda_2,\\max\\lambda_2\\right],\\left[\\text{before}_3,\\text{after}_3,\\min\\lambda_3,\\max\\lambda_3\\right]\\right],\n$$\nwhere $\\text{before}_k$ is the discrete $L^2$-norm of $\\nabla\\cdot\\mathbf{u}$ before correction for case $k$, $\\text{after}_k$ is the discrete $L^2$-norm of $\\nabla\\cdot\\mathbf{u}^\\star$ after correction for case $k$, and $\\min\\lambda_k$, $\\max\\lambda_k$ are the smallest and largest eigenvalues of the pressure projection operator on the grid for case $k$. The numerical outputs must be real-valued floats.", "solution": "### Part 1: Derivation of the Pressure Equation\n\nThe problem asks us to find a pressure correction $p$ that minimizes the $L^2$-norm of the divergence of the corrected velocity field $\\mathbf{u}^\\star = \\mathbf{u} - \\nabla p$. The cost functional is:\n$$\n\\mathcal{J}(p)=\\left\\|\\nabla\\cdot\\left(\\mathbf{u}-\\nabla p\\right)\\right\\|_{L^2}^2 = \\left\\|\\nabla\\cdot\\mathbf{u} - \\nabla^2 p\\right\\|_{L^2}^2\n$$\nThe minimum possible value of this functional is zero, which is achieved if we can find a scalar field $p$ such that the argument of the norm is zero everywhere on the domain:\n$$\n\\nabla\\cdot\\mathbf{u} - \\nabla^2 p = 0\n$$\nRearranging this gives the governing equation for the optimal pressure correction, which is the **Pressure Poisson Equation (PPE)**:\n$$\n\\nabla^2 p = \\nabla \\cdot \\mathbf{u}\n$$\nThis equation states that the Laplacian of the pressure correction must be equal to the divergence of the uncorrected velocity field. For a periodic domain, this equation has a solution if the integral of the source term over the domain is zero. This compatibility condition is automatically satisfied: $\\int_{\\Omega} \\nabla \\cdot \\mathbf{u} \\,d\\mathbf{x} = \\oint_{\\partial\\Omega} \\mathbf{u} \\cdot \\mathbf{n} \\,ds = 0$ due to periodic boundary conditions. To ensure a unique solution, we impose the zero-mean constraint $\\int_{\\Omega} p \\,d\\mathbf{x} = 0$. By solving this equation for $p$, we find the correction that enforces the incompressible continuity equation, as the corrected field $\\mathbf{u}^\\star$ will satisfy $\\nabla \\cdot \\mathbf{u}^\\star = \\nabla \\cdot (\\mathbf{u} - \\nabla p) = \\nabla \\cdot \\mathbf{u} - \\nabla^2 p = 0$.\n\n### Part 2: Spectral Algorithm\n\nOn a periodic domain, the Fast Fourier Transform (FFT) provides a highly accurate way to solve the PPE. We represent all fields by their Fourier series. The key property is that differentiation in real space becomes multiplication in Fourier space. Let $\\hat{f}(\\mathbf{k})$ be the Fourier transform of a function $f(\\mathbf{x})$, where $\\mathbf{k}$ is the wavevector. Then:\n- $\\widehat{\\nabla f} = i 2\\pi \\mathbf{k} \\hat{f}$\n- $\\widehat{\\nabla \\cdot \\mathbf{u}} = i 2\\pi \\mathbf{k} \\cdot \\hat{\\mathbf{u}}$\n- $\\widehat{\\nabla^2 p} = (i 2\\pi \\mathbf{k}) \\cdot (i 2\\pi \\mathbf{k}) \\hat{p} = -4\\pi^2 |\\mathbf{k}|^2 \\hat{p}$\n\nTransforming the PPE into Fourier space gives:\n$$\n-4\\pi^2 |\\mathbf{k}|^2 \\hat{p}(\\mathbf{k}) = \\widehat{\\nabla \\cdot \\mathbf{u}}(\\mathbf{k})\n$$\nFor any non-zero wavevector ($\\mathbf{k} \\neq \\mathbf{0}$), we can solve for the Fourier coefficients of the pressure:\n$$\n\\hat{p}(\\mathbf{k}) = \\frac{\\widehat{\\nabla \\cdot \\mathbf{u}}(\\mathbf{k})}{-4\\pi^2 |\\mathbf{k}|^2}\n$$\nFor the zero wavevector ($\\mathbf{k} = \\mathbf{0}$), $|\\mathbf{k}|^2 = 0$. In this case, $\\hat{p}(\\mathbf{0})$ corresponds to the mean value of $p$. The zero-mean constraint $\\int p \\,d\\mathbf{x}=0$ directly implies that $\\hat{p}(\\mathbf{0}) = 0$.\n\nThe algorithm is as follows:\n1.  Compute the 2D FFT of the velocity components $u_x$ and $u_y$ to get $\\hat{u}_x$ and $\\hat{u}_y$.\n2.  Compute the FFT of the divergence, $\\widehat{\\nabla \\cdot \\mathbf{u}}$, and use it to find the \"before\" norm.\n3.  Calculate the FFT of the pressure, $\\hat{p}(\\mathbf{k})$, using the formula above, setting $\\hat{p}(\\mathbf{0}, \\mathbf{0}) = 0$.\n4.  Compute the FFT of the corrected velocity, $\\hat{\\mathbf{u}}^\\star(\\mathbf{k}) = \\hat{\\mathbf{u}}(\\mathbf{k}) - i 2\\pi \\mathbf{k} \\hat{p}(\\mathbf{k})$.\n5.  Compute the FFT of the corrected divergence, $\\widehat{\\nabla \\cdot \\mathbf{u}^\\star}$, and use the inverse FFT to find the \"after\" norm, which should be near machine precision.\n\n### Part 3: Analysis of the Pressure Projection Operator\n\nThe pressure projection operator $\\mathsf{P}$ maps $\\mathbf{u}$ to $\\mathbf{u}^\\star$. In Fourier space, this operator $\\hat{\\mathsf{P}}$ acts on each mode $\\hat{\\mathbf{u}}(\\mathbf{k})$ independently. Substituting the expression for $\\hat{p}(\\mathbf{k})$ into the equation for $\\hat{\\mathbf{u}}^\\star(\\mathbf{k})$:\n$$\n\\hat{\\mathbf{u}}^\\star(\\mathbf{k}) = \\hat{\\mathbf{u}}(\\mathbf{k}) - (i 2\\pi \\mathbf{k}) \\hat{p}(\\mathbf{k}) = \\hat{\\mathbf{u}}(\\mathbf{k}) - (i 2\\pi \\mathbf{k}) \\left( \\frac{i 2\\pi \\mathbf{k} \\cdot \\hat{\\mathbf{u}}(\\mathbf{k})}{-4\\pi^2 |\\mathbf{k}|^2} \\right) = \\hat{\\mathbf{u}}(\\mathbf{k}) - \\frac{\\mathbf{k} (\\mathbf{k} \\cdot \\hat{\\mathbf{u}}(\\mathbf{k}))}{|\\mathbf{k}|^2}\n$$\nThis can be written in matrix form as $\\hat{\\mathbf{u}}^\\star(\\mathbf{k}) = \\left(\\mathbf{I} - \\frac{\\mathbf{k} \\otimes \\mathbf{k}}{|\\mathbf{k}|^2}\\right) \\hat{\\mathbf{u}}(\\mathbf{k})$, where $\\mathbf{I}$ is the identity matrix and $\\otimes$ is the outer product. The matrix $\\hat{\\mathsf{P}}(\\mathbf{k}) = \\mathbf{I} - \\frac{\\mathbf{k} \\otimes \\mathbf{k}}{|\\mathbf{k}|^2}$ is a projection matrix. It projects the vector $\\hat{\\mathbf{u}}(\\mathbf{k})$ onto the subspace orthogonal to the wavevector $\\mathbf{k}$.\n\nA projection operator has eigenvalues of only 0 and 1.\n-   Any vector parallel to $\\mathbf{k}$ (a longitudinal mode) is in the null space of the projector. Its projection is zero, so the eigenvalue is $\\lambda = 0$.\n-   Any vector perpendicular to $\\mathbf{k}$ (a transverse mode) is left unchanged by the projection. The eigenvalue is $\\lambda = 1$.\n\nFor the special case $\\mathbf{k} = \\mathbf{0}$, the operator is not defined by the formula. However, as established, $\\hat{p}(\\mathbf{0})=0$, so $\\hat{\\mathbf{u}}^\\star(\\mathbf{0}) = \\hat{\\mathbf{u}}(\\mathbf{0})$. The operator is the identity for this mode, with eigenvalue 1.\n\nTherefore, the spectrum of the pressure projection operator $\\mathsf{P}$, considering all possible modes on any grid, is the set $\\{0, 1\\}$. The minimum eigenvalue is 0, and the maximum is 1. This holds true for any grid and any input velocity field.", "answer": "[[1.8504313554808388,4.551390317523995e-16,0.0,1.0],[0.7441544436940822,1.3853123847847162e-16,0.0,1.0],[1.4011835158652393e-14,3.064560742188433e-16,0.0,1.0]]", "id": "3380192"}]}