{"hands_on_practices": [{"introduction": "This exercise solidifies the understanding of how the Helmholtz decomposition is realized in Fourier space. By working through a concrete example analytically, you will see how the projection operator isolates the divergence-free component of a vector field. This practice [@problem_id:3328644] provides a foundational, \"pencil-and-paper\" verification of the theory, demonstrating why a field whose Fourier modes are orthogonal to their wavevectors is inherently divergence-free.", "problem": "Consider the two-dimensional velocity field $u(x,y) = \\left( \\cos x \\sin y,\\ -\\sin x \\cos y \\right)$ defined on the doubly periodic domain $[0,2\\pi] \\times [0,2\\pi]$ with periodic Boundary Conditions (BCs). In computational fluid dynamics, the Helmholtz decomposition expresses a sufficiently smooth vector field as the sum of an irrotational (gradient) component and a solenoidal (divergence-free) component. On a periodic domain, this decomposition can be characterized in Fourier space by projecting each Fourier mode onto the subspace orthogonal to the wavevector for the solenoidal part, and onto the subspace parallel to the wavevector for the irrotational part, subject to appropriate mean-zero conditions for uniqueness.\n\nStarting from the incompressibility constraint and the Fourier series representation of periodic fields, derive the modal projection operator associated with the divergence-free subspace. Then compute the Helmholtz decomposition of $u(x,y)$ using this Fourier-space projection: explicitly calculate the Fourier coefficients of $u(x,y)$, apply the derived projection to separate the solenoidal and irrotational components for each mode, and reconstruct the resulting physical-space fields. Finally, represent the solenoidal component by a streamfunction $\\psi(x,y)$ via $u_{\\mathrm{sol}} = \\nabla^{\\perp} \\psi = \\left( \\partial_{y}\\psi,\\ -\\partial_{x}\\psi \\right)$ and the irrotational component by a scalar potential $\\phi(x,y)$ via $u_{\\mathrm{irr}} = \\nabla \\phi$, enforcing the mean-zero condition on $\\psi$ and $\\phi$ to ensure uniqueness.\n\nProvide your final answer as the ordered pair of scalar potentials $(\\psi(x,y),\\ \\phi(x,y))$. No rounding is required, and no physical units are involved in the final expression.", "solution": "The problem requires the Helmholtz decomposition of a given two-dimensional vector field $u(x,y)$ on a doubly periodic domain into its solenoidal (divergence-free) and irrotational (curl-free) components, using Fourier-space projection methods. The final goal is to find the associated streamfunction $\\psi(x,y)$ and scalar potential $\\phi(x,y)$.\n\nFirst, we derive the general modal projection operator for the divergence-free subspace. A vector field $v(x,y)$ on the periodic domain $[0, 2\\pi] \\times [0, 2\\pi]$ can be represented by its complex Fourier series:\n$$ v(x,y) = \\sum_{k \\in \\mathbb{Z}^2} \\hat{v}(k) \\exp(i k \\cdot x) $$\nwhere $x = (x,y)$ is the position vector, $k = (k_x, k_y)$ is the wavevector with integer components, and $\\hat{v}(k)$ is the vector of Fourier coefficients for mode $k$. The divergence operator $\\nabla \\cdot$ in physical space corresponds to multiplication by $i k \\cdot$ in Fourier space. A vector field $v$ is solenoidal if $\\nabla \\cdot v = 0$. In Fourier space, this condition becomes:\n$$ \\widehat{\\nabla \\cdot v}(k) = i k \\cdot \\hat{v}(k) = 0 $$\nThis equation shows that for each wavevector $k \\neq (0,0)$, the Fourier coefficient vector $\\hat{v}(k)$ of a solenoidal field must be orthogonal to $k$.\n\nThe Helmholtz decomposition theorem states that any sufficiently smooth vector field $u$ can be written as the sum of an irrotational part $u_{\\mathrm{irr}}$ and a solenoidal part $u_{\\mathrm{sol}}$: $u = u_{\\mathrm{irr}} + u_{\\mathrm{sol}}$. In Fourier space, this is $\\hat{u}(k) = \\hat{u}_{\\mathrm{irr}}(k) + \\hat{u}_{\\mathrm{sol}}(k)$. The irrotational component is the gradient of a scalar potential, $u_{\\mathrm{irr}} = \\nabla \\phi$, which in Fourier space is $\\hat{u}_{\\mathrm{irr}}(k) = i k \\hat{\\phi}(k)$. This implies that $\\hat{u}_{\\mathrm{irr}}(k)$ is parallel to the wavevector $k$.\n\nGiven an arbitrary Fourier mode $\\hat{u}(k)$, we can project it onto the subspace parallel to $k$ to find its irrotational component. The projection operator onto the direction of $k$ is given by $\\frac{k \\otimes k}{|k|^2}$, where $\\otimes$ denotes the outer product.\n$$ \\hat{u}_{\\mathrm{irr}}(k) = \\left( \\frac{k \\otimes k}{|k|^2} \\right) \\hat{u}(k) = \\frac{k \\cdot \\hat{u}(k)}{|k|^2} k $$\nThe solenoidal component is the remaining part, which is orthogonal to $k$:\n$$ \\hat{u}_{\\mathrm{sol}}(k) = \\hat{u}(k) - \\hat{u}_{\\mathrm{irr}}(k) = \\hat{u}(k) - \\frac{k \\cdot \\hat{u}(k)}{|k|^2} k $$\nThe modal projection operator associated with the divergence-free (solenoidal) subspace is therefore $P_S(k) = I - \\frac{k \\otimes k}{|k|^2}$, where $I$ is the identity matrix. This operator projects a vector $\\hat{u}(k)$ onto the space perpendicular to $k$. This derivation is valid for $k \\ne (0,0)$. For $k=(0,0)$, which represents the mean flow, the divergence is trivially zero.\n\nNext, we compute the Fourier coefficients of the given velocity field $u(x,y) = (\\cos x \\sin y, -\\sin x \\cos y)$. We use the Euler formulas for trigonometric functions:\n$\\cos\\theta = \\frac{1}{2}(\\exp(i\\theta) + \\exp(-i\\theta))$ and $\\sin\\theta = \\frac{1}{2i}(\\exp(i\\theta) - \\exp(-i\\theta))$.\nThe first component of the velocity field is:\n$$ u_x(x,y) = \\cos x \\sin y = \\frac{1}{2}(\\exp(ix) + \\exp(-ix)) \\frac{1}{2i}(\\exp(iy) - \\exp(-iy)) $$\n$$ u_x(x,y) = \\frac{1}{4i} \\left( \\exp(i(x+y)) - \\exp(i(x-y)) + \\exp(i(-x+y)) - \\exp(i(-x-y)) \\right) $$\nThe second component is:\n$$ u_y(x,y) = -\\sin x \\cos y = -\\frac{1}{2i}(\\exp(ix) - \\exp(-ix)) \\frac{1}{2}(\\exp(iy) + \\exp(-iy)) $$\n$$ u_y(x,y) = \\frac{-1}{4i} \\left( \\exp(i(x+y)) + \\exp(i(x-y)) - \\exp(i(-x+y)) - \\exp(i(-x-y)) \\right) $$\nFrom these expressions, we identify the non-zero Fourier coefficients $\\hat{u}(k) = (\\hat{u}_x(k), \\hat{u}_y(k))$ for the wavevectors $k = (k_x, k_y)$:\nFor $k=(1,1)$: $\\hat{u}(1,1) = (\\frac{1}{4i}, \\frac{-1}{4i}) = -\\frac{i}{4}(1, -1)$.\nFor $k=(1,-1)$: $\\hat{u}(1,-1) = (\\frac{-1}{4i}, \\frac{-1}{4i}) = \\frac{i}{4}(1, 1)$.\nFor $k=(-1,1)$: $\\hat{u}(-1,1) = (\\frac{1}{4i}, \\frac{1}{4i}) = -\\frac{i}{4}(1, 1)$.\nFor $k=(-1,-1)$: $\\hat{u}(-1,-1) = (\\frac{-1}{4i}, \\frac{1}{4i}) = \\frac{i}{4}(1, -1)$.\nAll other coefficients $\\hat{u}(k)$ are zero. The mean flow $\\hat{u}(0,0)$ is zero.\n\nNow we apply the projection. For each non-zero mode, we compute the dot product $k \\cdot \\hat{u}(k)$:\nFor $k=(1,1)$: $k \\cdot \\hat{u}(1,1) = (1,1) \\cdot (-\\frac{i}{4}(1, -1)) = -\\frac{i}{4}(1-1) = 0$.\nFor $k=(1,-1)$: $k \\cdot \\hat{u}(1,-1) = (1,-1) \\cdot (\\frac{i}{4}(1, 1)) = \\frac{i}{4}(1-1) = 0$.\nFor $k=(-1,1)$: $k \\cdot \\hat{u}(-1,1) = (-1,1) \\cdot (-\\frac{i}{4}(1, 1)) = -\\frac{i}{4}(-1+1) = 0$.\nFor $k=(-1,-1)$: $k \\cdot \\hat{u}(-1,-1) = (-1,-1) \\cdot (\\frac{i}{4}(1, -1)) = \\frac{i}{4}(-1+1) = 0$.\nSince $k \\cdot \\hat{u}(k) = 0$ for all wavevectors $k$, the projection of $\\hat{u}(k)$ onto $k$ is zero for all modes.\n$$ \\hat{u}_{\\mathrm{irr}}(k) = \\frac{k \\cdot \\hat{u}(k)}{|k|^2} k = 0 \\quad \\text{for all } k $$\nThis implies that the irrotational component of the field is zero, $u_{\\mathrm{irr}}(x,y) = 0$. Consequently, the entire field is solenoidal: $u_{\\mathrm{sol}}(x,y) = u(x,y)$. This can be verified by directly computing the divergence:\n$$ \\nabla \\cdot u = \\partial_x(\\cos x \\sin y) + \\partial_y(-\\sin x \\cos y) = -\\sin x \\sin y + \\sin x \\sin y = 0 $$\nSince $u_{\\mathrm{irr}} = \\nabla \\phi = 0$, the scalar potential $\\phi(x,y)$ must be a constant. The problem requires a mean-zero condition on the potential for uniqueness. If $\\phi(x,y) = C$, its mean value over the domain is $C$. Thus, we must have $C=0$, which gives $\\phi(x,y) = 0$.\n\nNext, we find the streamfunction $\\psi(x,y)$ for the solenoidal component $u_{\\mathrm{sol}} = u$. The streamfunction is defined by $u_{\\mathrm{sol}} = \\nabla^{\\perp} \\psi = (\\partial_y \\psi, -\\partial_x \\psi)$. This provides a system of partial differential equations:\n1) $\\partial_y \\psi = u_{x} = \\cos x \\sin y$\n2) $-\\partial_x \\psi = u_{y} = -\\sin x \\cos y \\implies \\partial_x \\psi = \\sin x \\cos y$\n\nIntegrate the first equation with respect to $y$:\n$$ \\psi(x,y) = \\int \\cos x \\sin y \\, dy = \\cos x \\int \\sin y \\, dy = -\\cos x \\cos y + f(x) $$\nwhere $f(x)$ is an integration \"constant\" with respect to $y$.\nNow, differentiate this expression for $\\psi$ with respect to $x$ and compare it with the second equation:\n$$ \\partial_x \\psi = \\partial_x(-\\cos x \\cos y + f(x)) = \\sin x \\cos y + f'(x) $$\nComparing this to $\\partial_x \\psi = \\sin x \\cos y$, we find that $f'(x) = 0$. This implies that $f(x)$ is a constant, which we denote by $C_0$.\nSo, the general solution for the streamfunction is $\\psi(x,y) = -\\cos x \\cos y + C_0$.\n\nTo ensure a unique solution, the problem imposes a mean-zero condition on $\\psi(x,y)$. We compute the mean value of $\\psi$ over the domain $[0, 2\\pi] \\times [0, 2\\pi]$:\n$$ \\langle \\psi \\rangle = \\frac{1}{(2\\pi)^2} \\int_0^{2\\pi} \\int_0^{2\\pi} (-\\cos x \\cos y + C_0) \\, dx \\, dy $$\n$$ \\langle \\psi \\rangle = -\\left(\\frac{1}{2\\pi}\\int_0^{2\\pi} \\cos x \\, dx\\right) \\left(\\frac{1}{2\\pi}\\int_0^{2\\pi} \\cos y \\, dy\\right) + \\frac{1}{(2\\pi)^2}\\int_0^{2\\pi} \\int_0^{2\\pi} C_0 \\, dx \\, dy $$\nSince $\\int_0^{2\\pi} \\cos\\theta \\, d\\theta = [\\sin\\theta]_0^{2\\pi} = 0$, the first term is zero. The second term evaluates to $C_0$.\nThus, $\\langle \\psi \\rangle = C_0$. The mean-zero condition requires $C_0 = 0$.\nThe unique streamfunction is $\\psi(x,y) = -\\cos x \\cos y$.\n\nThe final answer is the ordered pair of scalar potentials $(\\psi(x,y), \\phi(x,y))$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix} -\\cos x \\cos y & 0 \\end{pmatrix}\n}\n$$", "id": "3328644"}, {"introduction": "While periodic domains are mathematically convenient, many real-world flows involve impermeable boundaries, which introduce new constraints. This thought experiment explores a critical consequence of the incompressibility constraint in such bounded domains: the solvability condition for the pressure-correction Poisson equation. This problem [@problem_id:3328660] reveals the deep connection between the mathematical well-posedness of the projection step and the physical principle of mass conservation, a crucial concept for developing robust CFD solvers.", "problem": "Consider a standard projection method based on the Helmholtz decomposition for incompressible flow in Computational Fluid Dynamics (CFD), where a predictor velocity field is projected onto a divergence-free space via a scalar potential. Let the domain be the unit square $\\Omega = \\left[0,1\\right] \\times \\left[0,1\\right]$ with outward unit normal $\\mathbf{n}$ on $\\partial \\Omega$. Assume all variables are non-dimensional.\n\nA predictor velocity $\\mathbf{u}^{\\ast} : \\Omega \\to \\mathbb{R}^{2}$ is computed from an explicit advection-diffusion step without enforcing no-penetration at the solid walls. Take the specific predictor\n$$\n\\mathbf{u}^{\\ast}(x,y) = \\begin{pmatrix} x \\\\ 0 \\end{pmatrix}.\n$$\nThe projection step seeks a scalar $\\phi$ such that the corrected velocity $\\mathbf{u}^{n+1} = \\mathbf{u}^{\\ast} - \\frac{\\Delta t}{\\rho} \\nabla \\phi$ is divergence-free. The scalar $\\phi$ is obtained by solving a Poisson equation with a Neumann boundary condition determined by the normal component of $\\mathbf{u}^{\\ast}$ and the physical boundary condition. However, suppose an implementer erroneously imposes a homogeneous Neumann boundary condition $\\frac{\\partial \\phi}{\\partial n} = 0$ on $\\partial \\Omega$.\n\nStarting only from the divergence theorem, the incompressibility constraint, and the Helmholtz decomposition structure of the projection method, do the following:\n\n1. Compute the net flux of $\\mathbf{u}^{\\ast}$ through $\\partial \\Omega$, and compute the volume integral of $\\nabla \\cdot \\mathbf{u}^{\\ast}$ over $\\Omega$. Explain the relationship between these two quantities.\n2. Using the Neumann problem solvability condition for the Poisson equation arising in the projection, show precisely how the erroneous homogeneous Neumann boundary condition violates compatibility for this $\\mathbf{u}^{\\ast}$.\n3. To restore global mass conservation at the predictor level by boundary adjustment alone, suppose you decide to modify only the right boundary $x = 1$ by applying a uniform constant offset $\\alpha$ to the normal component of $\\mathbf{u}^{\\ast}$ there, while keeping the other three sides unchanged. That is, replace $q_{R}(y) = \\mathbf{u}^{\\ast} \\cdot \\mathbf{n}\\big|_{x=1,y}$ by $q_{R}^{\\mathrm{corr}}(y) = q_{R}(y) - \\alpha$ for all $y \\in \\left[0,1\\right]$. Determine the unique value of the constant $\\alpha$ that makes the net flux through $\\partial \\Omega$ equal to zero.\n4. State which physical boundary condition must be corrected in the algorithm to avoid incompatibility in the first place.\n\nReport only the value of $\\alpha$ as your final numerical answer (no units are required, and no rounding is needed).", "solution": "Let the domain be the unit square $\\Omega = [0,1] \\times [0,1]$ and the predictor velocity field be $\\mathbf{u}^{\\ast}(x,y) = \\begin{pmatrix} x \\\\ 0 \\end{pmatrix}$.\n\n**1. Net Flux and Divergence Integral of $\\mathbf{u}^{\\ast}$**\n\nFirst, we compute the net flux of $\\mathbf{u}^{\\ast}$ through the boundary $\\partial \\Omega$. The boundary consists of four segments:\n- Left edge ($x=0$, $y \\in [0,1]$): outward normal $\\mathbf{n} = (-1, 0)$. The velocity is $\\mathbf{u}^{\\ast}(0,y) = (0,0)$.\n- Right edge ($x=1$, $y \\in [0,1]$): outward normal $\\mathbf{n} = (1, 0)$. The velocity is $\\mathbf{u}^{\\ast}(1,y) = (1,0)$.\n- Bottom edge ($y=0$, $x \\in [0,1]$): outward normal $\\mathbf{n} = (0, -1)$. The velocity is $\\mathbf{u}^{\\ast}(x,0) = (x,0)$.\n- Top edge ($y=1$, $x \\in [0,1]$): outward normal $\\mathbf{n} = (0, 1)$. The velocity is $\\mathbf{u}^{\\ast}(x,1) = (x,0)$.\n\nThe net flux is the sum of the integrals over these four segments:\n$$\n\\oint_{\\partial\\Omega} \\mathbf{u}^{\\ast} \\cdot \\mathbf{n} \\, dS = \\int_{\\text{left}} \\mathbf{u}^{\\ast} \\cdot \\mathbf{n} \\, dS + \\int_{\\text{right}} \\mathbf{u}^{\\ast} \\cdot \\mathbf{n} \\, dS + \\int_{\\text{bottom}} \\mathbf{u}^{\\ast} \\cdot \\mathbf{n} \\, dS + \\int_{\\text{top}} \\mathbf{u}^{\\ast} \\cdot \\mathbf{n} \\, dS\n$$\nCalculating each term:\n- Left: $\\int_0^1 \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} \\cdot \\begin{pmatrix} -1 \\\\ 0 \\end{pmatrix} dy = \\int_0^1 0 \\, dy = 0$.\n- Right: $\\int_0^1 \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} \\cdot \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} dy = \\int_0^1 1 \\, dy = 1$.\n- Bottom: $\\int_0^1 \\begin{pmatrix} x \\\\ 0 \\end{pmatrix} \\cdot \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix} dx = \\int_0^1 0 \\, dx = 0$.\n- Top: $\\int_0^1 \\begin{pmatrix} x \\\\ 0 \\end{pmatrix} \\cdot \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} dx = \\int_0^1 0 \\, dx = 0$.\n\nThe total net flux is $0 + 1 + 0 + 0 = 1$.\n\nNext, we compute the volume integral of the divergence of $\\mathbf{u}^{\\ast}$ over $\\Omega$. The divergence of $\\mathbf{u}^{\\ast} = \\begin{pmatrix} u^{\\ast} \\\\ v^{\\ast} \\end{pmatrix} = \\begin{pmatrix} x \\\\ 0 \\end{pmatrix}$ is:\n$$\n\\nabla \\cdot \\mathbf{u}^{\\ast} = \\frac{\\partial u^{\\ast}}{\\partial x} + \\frac{\\partial v^{\\ast}}{\\partial y} = \\frac{\\partial(x)}{\\partial x} + \\frac{\\partial(0)}{\\partial y} = 1 + 0 = 1\n$$\nThe integral of the divergence over the domain $\\Omega$ is:\n$$\n\\iint_{\\Omega} (\\nabla \\cdot \\mathbf{u}^{\\ast}) \\, dA = \\int_0^1 \\int_0^1 1 \\, dx \\, dy = 1\n$$\nThe relationship between these two quantities is given by the Divergence Theorem (also known as Gauss's theorem), which states that for a vector field $\\mathbf{F}$ defined on a domain $\\Omega$ with a piecewise smooth boundary $\\partial\\Omega$:\n$$\n\\iint_{\\Omega} (\\nabla \\cdot \\mathbf{F}) \\, dA = \\oint_{\\partial\\Omega} \\mathbf{F} \\cdot \\mathbf{n} \\, dS\n$$\nIn our case, with $\\mathbf{F} = \\mathbf{u}^{\\ast}$, we have found that $\\iint_{\\Omega} (\\nabla \\cdot \\mathbf{u}^{\\ast}) \\, dA = 1$ and $\\oint_{\\partial\\Omega} \\mathbf{u}^{\\ast} \\cdot \\mathbf{n} \\, dS = 1$, which confirms the theorem.\n\n**2. Violation of the Neumann Problem Solvability Condition**\n\nThe projection step corrects the predictor velocity $\\mathbf{u}^{\\ast}$ using a scalar potential $\\phi$:\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{\\ast} - c \\nabla \\phi\n$$\nwhere $c = \\frac{\\Delta t}{\\rho}$ is a constant. The corrected velocity $\\mathbf{u}^{n+1}$ must be divergence-free, i.e., $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$. Taking the divergence of the correction equation gives:\n$$\n\\nabla \\cdot \\mathbf{u}^{n+1} = \\nabla \\cdot \\mathbf{u}^{\\ast} - c \\nabla \\cdot (\\nabla \\phi) = \\nabla \\cdot \\mathbf{u}^{\\ast} - c \\nabla^2 \\phi\n$$\nSetting $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$ yields the Poisson equation for $\\phi$:\n$$\n\\nabla^2 \\phi = \\frac{1}{c} \\nabla \\cdot \\mathbf{u}^{\\ast}\n$$\nThe physical boundary condition for an incompressible fluid at a solid wall is no-penetration, $\\mathbf{u}^{n+1} \\cdot \\mathbf{n} = 0$. Projecting the correction equation onto the normal vector $\\mathbf{n}$ gives:\n$$\n\\mathbf{u}^{n+1} \\cdot \\mathbf{n} = \\mathbf{u}^{\\ast} \\cdot \\mathbf{n} - c (\\nabla \\phi \\cdot \\mathbf{n}) = \\mathbf{u}^{\\ast} \\cdot \\mathbf{n} - c \\frac{\\partial \\phi}{\\partial n}\n$$\nApplying the no-penetration condition yields the proper Neumann boundary condition for $\\phi$:\n$$\n\\frac{\\partial \\phi}{\\partial n} = \\frac{1}{c} (\\mathbf{u}^{\\ast} \\cdot \\mathbf{n})\n$$\nThe solvability condition (a consequence of the Fredholm alternative) for the Neumann problem $\\nabla^2 \\phi = f$ in $\\Omega$ with boundary condition $\\frac{\\partial \\phi}{\\partial n} = g$ on $\\partial\\Omega$ requires that the domain integral of the source term equals the boundary integral of the normal derivative. This is derived from the divergence theorem applied to $\\nabla\\phi$:\n$$\n\\iint_{\\Omega} \\nabla^2 \\phi \\, dA = \\iint_{\\Omega} \\nabla \\cdot (\\nabla \\phi) \\, dA = \\oint_{\\partial \\Omega} \\nabla \\phi \\cdot \\mathbf{n} \\, dS = \\oint_{\\partial \\Omega} \\frac{\\partial \\phi}{\\partial n} \\, dS\n$$\nSubstituting our specific source term $f = \\frac{1}{c} \\nabla \\cdot \\mathbf{u}^{\\ast}$ and the erroneous boundary condition $g=\\frac{\\partial \\phi}{\\partial n} = 0$, the compatibility condition becomes:\n$$\n\\iint_{\\Omega} \\frac{1}{c} (\\nabla \\cdot \\mathbf{u}^{\\ast}) \\, dA = \\oint_{\\partial \\Omega} 0 \\, dS\n$$\nEvaluating both sides:\n- Left-hand side: $\\frac{1}{c} \\iint_{\\Omega} 1 \\, dA = \\frac{1}{c} \\cdot (\\text{Area of } \\Omega) = \\frac{1}{c} \\cdot 1 = \\frac{1}{c}$.\n- Right-hand side: $\\oint_{\\partial \\Omega} 0 \\, dS = 0$.\nThe condition thus reduces to $\\frac{1}{c} = 0$, which is a contradiction since $c = \\frac{\\Delta t}{\\rho}$ is finite and non-zero. This demonstrates that the problem for $\\phi$ with the erroneous homogeneous Neumann boundary condition is ill-posed and has no solution.\n\n**3. Determination of the Boundary Correction $\\alpha$**\n\nGlobal mass conservation at the predictor level implies that the net flux of the predictor velocity through the domain boundary must be zero. The original net flux is $1$. We want to modify the normal component of $\\mathbf{u}^{\\ast}$ on the boundary to make the total flux zero. The modification consists of applying a uniform constant offset $-\\alpha$ to the normal component of $\\mathbf{u}^{\\ast}$ only on the right boundary, $x=1$.\n\nThe original flux on the right boundary is:\n$$\n\\text{Flux}_{\\text{right}} = \\int_0^1 (\\mathbf{u}^{\\ast} \\cdot \\mathbf{n}) \\bigg|_{x=1} \\, dy = \\int_0^1 1 \\, dy = 1\n$$\nThe normal component of velocity on the right boundary is $q_{R}(y) = \\mathbf{u}^{\\ast} \\cdot \\mathbf{n}|_{x=1,y} = 1$. The corrected normal component is $q_{R}^{\\mathrm{corr}}(y) = q_{R}(y) - \\alpha = 1 - \\alpha$.\nThe new flux on the right boundary is:\n$$\n\\text{Flux}_{\\text{right}}^{\\mathrm{corr}} = \\int_0^1 (1-\\alpha) \\, dy = (1-\\alpha) [y]_0^1 = 1-\\alpha\n$$\nThe fluxes on the other three boundaries (left, bottom, top) are all zero and remain unchanged. The new total net flux is:\n$$\n\\text{Flux}_{\\text{net}}^{\\mathrm{corr}} = \\text{Flux}_{\\text{left}} + \\text{Flux}_{\\text{right}}^{\\mathrm{corr}} + \\text{Flux}_{\\text{bottom}} + \\text{Flux}_{\\text{top}} = 0 + (1-\\alpha) + 0 + 0 = 1-\\alpha\n$$\nTo restore global mass conservation, we set the net flux to zero:\n$$\n\\text{Flux}_{\\text{net}}^{\\mathrm{corr}} = 0 \\implies 1-\\alpha = 0 \\implies \\alpha=1\n$$\nTherefore, the unique value of the constant offset is $\\alpha=1$.\n\n**4. Physical Boundary Condition to Correct**\n\nThe incompatibility arises because the predictor velocity $\\mathbf{u}^{\\ast}$ does not satisfy the physical boundary conditions of the flow. Specifically, for impermeable solid walls, the velocity component normal to the boundary must be zero (no-penetration condition), i.e., $\\mathbf{u} \\cdot \\mathbf{n} = 0$.\n\nLet's examine the given predictor field $\\mathbf{u}^{\\ast} = (x,0)$ at the boundaries of the unit square:\n- On the right wall ($x=1$), the outward normal is $\\mathbf{n}=(1,0)$. The normal component of the predictor velocity is $\\mathbf{u}^{\\ast} \\cdot \\mathbf{n} = (1,0) \\cdot (1,0) = 1$. This is non-zero, violating the no-penetration condition.\n- On the other walls (left, top, bottom), the normal component of $\\mathbf{u}^{\\ast}$ is zero, so the condition is satisfied there.\n\nThe fundamental flaw in the algorithm is that the intermediate (predictor) step that computes $\\mathbf{u}^{\\ast}$ (e.g., from an explicit advection-diffusion update) does not enforce the no-penetration boundary condition. The physical boundary condition that must be correctly handled is the **no-penetration condition ($\\mathbf{u} \\cdot \\mathbf{n} = 0$) for the velocity field at solid boundaries**. This condition should be imposed on the predictor field $\\mathbf{u}^{\\ast}$ before the projection step is performed.\n\nThe final answer required is solely the value of $\\alpha$.", "answer": "$$\n\\boxed{1}\n$$", "id": "3328660"}, {"introduction": "Having explored the analytical theory, the next step is to implement the projection method numerically. This hands-on coding exercise guides you through building a spectral projection solver using the Fast Fourier Transform (FFT). By implementing the algorithm for a known irrotational field and verifying the Pythagorean identity of the $L^2$ norms [@problem_id:3328665], you will translate abstract mathematical concepts into a working computational tool and develop essential skills for practical CFD code development.", "problem": "You are given a smooth, $2$-dimensional, periodic vector field $u(x,y)$ on the square domain $[0,2\\pi]^2$ with periodic boundary conditions, defined by\n$$\nu(x,y)=\\begin{pmatrix}\\sin x\\\\ \\sin y\\end{pmatrix},\n$$\nwhere the angles are in radians. The Helmholtz decomposition states that, under suitable conditions on a periodic domain, any vector field can be uniquely decomposed (up to an additive constant for the potential) into the sum of a divergence-free (solenoidal) part and a curl-free (irrotational) part:\n$$\nu = w + \\nabla \\phi,\n$$\nwhere $w$ is divergence-free and $\\nabla \\phi$ is curl-free. On a periodic box, the orthogonality of these subspaces implies that the $L^2$ inner product of $w$ and $\\nabla \\phi$ is zero, and the $L^2$ norm obeys the Pythagorean identity\n$$\n\\|u\\|_{L^2}^2 = \\|w\\|_{L^2}^2 + \\|\\nabla \\phi\\|_{L^2}^2.\n$$\n\nStarting from the incompressibility constraint and the definition of the $L^2$ inner product on $[0,2\\pi]^2$, implement a spectral (Fast Fourier Transform (FFT))-based projection of $u$ onto the divergence-free subspace and its orthogonal gradient complement on a uniform $N\\times N$ grid, where $N$ is an integer resolution parameter. Use the uniform grid points $(x_i,y_j)$ with $x_i=\\frac{2\\pi i}{N}$, $y_j=\\frac{2\\pi j}{N}$ for $i,j\\in\\{0,1,\\ldots,N-1\\}$.\n\nYour program must:\n- Discretize $u$ on the grid, compute its discrete Fourier representation, and construct the orthogonal projection onto the divergence-free subspace that is consistent with the incompressibility constraint on each nonzero Fourier mode.\n- Recover the divergence-free part $w$ and the irrotational part $\\nabla \\phi$ by inverse transforms.\n- Compute the discrete approximations of the $L^2$ norms $\\|w\\|_{L^2}$ and $\\|\\nabla \\phi\\|_{L^2}$ using the trapezoidal rule on the periodic grid. Specifically, approximate\n$$\n\\|v\\|_{L^2}^2 \\approx \\int_{[0,2\\pi]^2} \\|v(x,y)\\|^2\\,\\mathrm{d}x\\,\\mathrm{d}y \\approx (2\\pi)^2 \\cdot \\frac{1}{N^2}\\sum_{i,j}\\|v(x_i,y_j)\\|^2,\n$$\nand then take the square root for the norm.\n- Compute the discrete $L^2$ inner product between $w$ and $\\nabla \\phi$,\n$$\n\\langle w,\\nabla \\phi\\rangle \\approx (2\\pi)^2 \\cdot \\frac{1}{N^2}\\sum_{i,j} w(x_i,y_j)\\cdot (\\nabla \\phi)(x_i,y_j).\n$$\n- Verify numerically the orthogonality $\\lvert\\langle w,\\nabla \\phi\\rangle\\rvert<\\varepsilon$ and the Pythagorean identity $\\left|\\|u\\|_{L^2}^2 - \\|w\\|_{L^2}^2 - \\|\\nabla \\phi\\|_{L^2}^2\\right|<\\varepsilon$ to a given tolerance $\\varepsilon>0$.\n\nTest suite:\n- Use the following grid resolutions and tolerances $(N,\\varepsilon)$:\n  - $(2,10^{-12})$,\n  - $(3,10^{-12})$,\n  - $(8,10^{-12})$,\n  - $(16,10^{-12})$,\n  - $(64,10^{-12})$.\n\nFor each test case $(N,\\varepsilon)$, your program must output a list with the following entries in order:\n- the floating-point value of $\\|w\\|_{L^2}$,\n- the floating-point value of $\\|\\nabla \\phi\\|_{L^2}$,\n- a boolean indicating whether $\\lvert\\langle w,\\nabla \\phi\\rangle\\rvert<\\varepsilon$,\n- a boolean indicating whether $\\left|\\|u\\|_{L^2}^2 - \\|w\\|_{L^2}^2 - \\|\\nabla \\phi\\|_{L^2}^2\\right|<\\varepsilon$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets, where each element is the list for the corresponding test case in the same order as above. For example, a valid output has the form\n$$\n\\bigl[\\,[a_1,b_1,c_1,d_1],[a_2,b_2,c_2,d_2],\\ldots,[a_5,b_5,c_5,d_5]\\,\\bigr]\n$$\nwith each $a_k,b_k$ floating-point numbers and $c_k,d_k$ booleans.", "solution": "We begin from the definition of the Helmholtz decomposition on a periodic domain and the incompressibility constraint. On the square torus $[0,2\\pi]^2$, any sufficiently smooth, mean-zero vector field $u$ admits a unique decomposition (up to an additive constant in the potential) into $u=w+\\nabla\\phi$, where the solenoidal part $w$ satisfies $\\nabla\\cdot w=0$ and the irrotational part $\\nabla\\phi$ satisfies $\\nabla\\times(\\nabla\\phi)=0$. The $L^2$ inner product on vector fields is $\\langle a,b\\rangle=\\int_{[0,2\\pi]^2} a\\cdot b\\,\\mathrm{d}x\\,\\mathrm{d}y$, with norm $\\|a\\|_{L^2}=\\sqrt{\\langle a,a\\rangle}$. Orthogonality of the decomposition follows from integration by parts on a periodic domain:\n$$\n\\langle w,\\nabla\\phi\\rangle = \\int w\\cdot \\nabla\\phi\\,\\mathrm{d}x\\,\\mathrm{d}y = -\\int (\\nabla\\cdot w)\\,\\phi\\,\\mathrm{d}x\\,\\mathrm{d}y = 0,\n$$\nsince $\\nabla\\cdot w=0$ and periodic boundary conditions eliminate boundary terms. Consequently, $\\|u\\|_{L^2}^2=\\|w\\|_{L^2}^2+\\|\\nabla\\phi\\|_{L^2}^2$.\n\nTo compute the decomposition numerically, we use spectral methods based on the Fast Fourier Transform (FFT). On a uniform $N\\times N$ grid with $x_i=\\frac{2\\pi i}{N}$, $y_j=\\frac{2\\pi j}{N}$ for $i,j\\in\\{0,\\ldots,N-1\\}$, we sample $u(x_i,y_j)=(\\sin x_i,\\sin y_j)^{\\top}$. Let $\\widehat{u}(k_x,k_y)$ denote the discrete Fourier coefficients. On each nonzero wavenumber $k=(k_x,k_y)$, write the vector Fourier coefficient $\\widehat{u}(k)$ as the sum of a component parallel to $k$ and a component orthogonal to $k$ with respect to the Euclidean dot product in $\\mathbb{C}^2$. Specifically, the gradient part in Fourier space is aligned with $k$ because the Fourier transform of $\\nabla \\phi$ is $i\\,k\\,\\widehat{\\phi}(k)$, whereas the divergence-free part must satisfy $k\\cdot \\widehat{w}(k)=0$. The unique orthogonal projection of a vector $v\\in\\mathbb{C}^2$ onto the subspace orthogonal to $k$ is given by the matrix\n$$\nP(k) = I - \\frac{k\\,k^{\\top}}{|k|^2},\\quad \\text{for } k\\neq 0,\n$$\nso that $\\widehat{w}(k)=P(k)\\,\\widehat{u}(k)$ and $\\widehat{\\nabla\\phi}(k) = \\widehat{u}(k)-\\widehat{w}(k)$. For the zero mode $k=0$, we take $\\widehat{w}(0)=0$ and $\\widehat{\\nabla\\phi}(0)=0$ because the mean of $u$ over the periodic box is zero. This construction enforces the incompressibility constraint $k\\cdot \\widehat{w}(k)=0$ by design and ensures orthogonality $P(k)$ is an orthogonal projection for each $k\\neq 0$.\n\nThe algorithmic steps are:\n- Construct the grid and compute the sampled field $u_1(x_i,y_j)=\\sin x_i$, $u_2(x_i,y_j)=\\sin y_j$.\n- Compute the two-dimensional discrete Fourier transforms $\\widehat{u}_1(k_x,k_y)$ and $\\widehat{u}_2(k_x,k_y)$ via FFT.\n- Construct the integer wavenumber arrays $(k_x,k_y)$ consistent with the discrete Fourier series on the $2\\pi$-periodic grid. Using $\\mathrm{fftfreq}(N,1/N)$ yields integer wavenumbers $k\\in\\{-\\lfloor N/2\\rfloor,\\ldots,\\lfloor (N-1)/2\\rfloor\\}$ with appropriate ordering. Form the squared magnitude $|k|^2=k_x^2+k_y^2$.\n- For each $(k_x,k_y)\\neq(0,0)$, form $P(k)=I-\\frac{k\\,k^{\\top}}{|k|^2}$, that is,\n$$\nP_{11}=1-\\frac{k_x^2}{k_x^2+k_y^2},\\quad P_{22}=1-\\frac{k_y^2}{k_x^2+k_y^2},\\quad P_{12}=P_{21}=-\\frac{k_x k_y}{k_x^2+k_y^2},\n$$\nand for $(k_x,k_y)=(0,0)$ set $P(0)=I$ but note $\\widehat{u}(0)=0$ in this case. Apply $\\widehat{w}_1=P_{11}\\widehat{u}_1+P_{12}\\widehat{u}_2$, $\\widehat{w}_2=P_{21}\\widehat{u}_1+P_{22}\\widehat{u}_2$, and set $\\widehat{\\nabla\\phi}=\\widehat{u}-\\widehat{w}$.\n- Inverse FFT yields the physical-space fields $w$ and $\\nabla\\phi$.\n- Approximate $L^2$ norms using the trapezoidal rule on the periodic grid:\n$$\n\\|v\\|_{L^2}^2\\approx (2\\pi)^2\\frac{1}{N^2}\\sum_{i,j} (v_1(x_i,y_j)^2+v_2(x_i,y_j)^2),\\quad \\|v\\|_{L^2}=\\sqrt{\\cdot},\n$$\nand the inner product $\\langle w,\\nabla\\phi\\rangle\\approx (2\\pi)^2\\frac{1}{N^2}\\sum_{i,j} w\\cdot \\nabla\\phi$.\n- Verify $\\lvert\\langle w,\\nabla\\phi\\rangle\\rvert<\\varepsilon$ and $\\left|\\|u\\|_{L^2}^2 - \\|w\\|_{L^2}^2 - \\|\\nabla \\phi\\|_{L^2}^2\\right|<\\varepsilon$.\n\nFor the manufactured field $u(x,y)=(\\sin x,\\sin y)^{\\top}$, an analytical observation is that $u=-\\nabla(\\cos x+\\cos y)$, hence the divergence-free component $w$ is identically zero, the irrotational component equals $u$, and the exact norms satisfy\n$$\n\\|w\\|_{L^2}=0,\\quad \\|\\nabla\\phi\\|_{L^2}=\\|u\\|_{L^2}=\\sqrt{\\int_{0}^{2\\pi}\\int_{0}^{2\\pi}(\\sin^2 x+\\sin^2 y)\\,\\mathrm{d}x\\,\\mathrm{d}y} = \\sqrt{4\\pi^2}=2\\pi.\n$$\nThe numerical method should recover these results up to discretization and roundoff error, with exactness for modes representable on the grid. Notably, for $N=2$ the samples of $\\sin$ at $x\\in\\{0,\\pi\\}$ are zero, so the discrete field vanishes identically; this serves as a boundary case where all norms are numerically zero, still satisfying orthogonality and the Pythagorean identity.\n\nThe implementation uses only the NumPy library to compute FFTs and array operations. The result for each test case $(N,\\varepsilon)$ is the list $[\\|w\\|_{L^2},\\|\\nabla\\phi\\|_{L^2},\\text{ortho\\_ok},\\text{energy\\_ok}]$, and the program prints a single line containing the list of these lists for all specified test cases.", "answer": "```python\nimport numpy as np\n\ndef helmholtz_project_and_metrics(N, tol):\n    # Domain and grid\n    L = 2.0 * np.pi\n    x = np.linspace(0.0, L, N, endpoint=False)\n    y = np.linspace(0.0, L, N, endpoint=False)\n    X, Y = np.meshgrid(x, y, indexing='ij')\n\n    # Manufactured field u = (sin x, sin y)\n    u1 = np.sin(X)\n    u2 = np.sin(Y)\n\n    # FFTs of components\n    U1_hat = np.fft.fft2(u1)\n    U2_hat = np.fft.fft2(u2)\n\n    # Integer wavenumbers corresponding to 2Ï€-periodic grid\n    k_vals = np.fft.fftfreq(N, d=1.0 / N)  # integers\n    KX, KY = np.meshgrid(k_vals, k_vals, indexing='ij')\n    K2 = KX**2 + KY**2\n\n    # Build projection matrix P(k) = I - k k^T / |k|^2 for k != 0\n    # Use float arrays for P, then rely on casting to complex in multiplications\n    Pxx = np.ones_like(K2, dtype=float)\n    Pyy = np.ones_like(K2, dtype=float)\n    Pxy = np.zeros_like(K2, dtype=float)\n\n    mask = K2 > 0\n    # Avoid division by zero at k=0; values at k=0 won't matter since U_hat at k=0 is zero for this field.\n    Pxx[mask] = 1.0 - (KX[mask]**2) / K2[mask]\n    Pyy[mask] = 1.0 - (KY[mask]**2) / K2[mask]\n    Pxy[mask] = - (KX[mask] * KY[mask]) / K2[mask]\n\n    # Apply projection in Fourier space\n    W1_hat = Pxx * U1_hat + Pxy * U2_hat\n    W2_hat = Pxy * U1_hat + Pyy * U2_hat\n\n    # Gradient (irrotational) complement\n    G1_hat = U1_hat - W1_hat\n    G2_hat = U2_hat - W2_hat\n\n    # Inverse FFT to get physical-space fields (take real parts due to numerical roundoff)\n    w1 = np.real(np.fft.ifft2(W1_hat))\n    w2 = np.real(np.fft.ifft2(W2_hat))\n    g1 = np.real(np.fft.ifft2(G1_hat))\n    g2 = np.real(np.fft.ifft2(G2_hat))\n\n    # L2 norms via trapezoidal rule on periodic grid\n    area = L * L\n    def l2_norm(v1, v2):\n        sq = v1*v1 + v2*v2\n        mean_sq = np.mean(sq)\n        return np.sqrt(area * mean_sq)\n\n    norm_w = l2_norm(w1, w2)\n    norm_g = l2_norm(g1, g2)\n    norm_u = l2_norm(u1, u2)\n\n    # Inner product <w, g>\n    inner_wg = area * np.mean(w1 * g1 + w2 * g2)\n\n    # Checks\n    ortho_ok = abs(inner_wg) < tol\n    energy_ok = abs(norm_u**2 - (norm_w**2 + norm_g**2)) < tol\n\n    return [float(norm_w), float(norm_g), bool(ortho_ok), bool(energy_ok)]\n\ndef format_no_spaces(obj):\n    if isinstance(obj, list):\n        return \"[\" + \",\".join(format_no_spaces(el) for el in obj) + \"]\"\n    if isinstance(obj, bool):\n        return \"True\" if obj else \"False\"\n    if isinstance(obj, (int, np.integer)):\n        return str(int(obj))\n    # floats\n    return repr(float(obj))\n\ndef solve():\n    # Test suite as specified\n    test_cases = [\n        (2, 1e-12),\n        (3, 1e-12),\n        (8, 1e-12),\n        (16, 1e-12),\n        (64, 1e-12),\n    ]\n    results = []\n    for N, tol in test_cases:\n        results.append(helmholtz_project_and_metrics(N, tol))\n    print(format_no_spaces(results))\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3328665"}]}