{"hands_on_practices": [{"introduction": "The decay of the Taylor-Green vortex is fundamentally a process of kinetic energy dissipation due to viscosity. This exercise challenges you to derive the initial rate of this energy decay directly from the incompressible Navier-Stokes equations. By calculating the vorticity field and applying the exact energy balance, you will obtain a precise analytical prediction that serves as a crucial first validation point for any numerical solver [@problem_id:3370515]. This practice connects the abstract governing equations to a tangible physical quantity, reinforcing the role of enstrophy in viscous dissipation.", "problem": "Consider the incompressible Navier–Stokes equations for a viscous fluid of constant density in a triply periodic cubic domain of side length $2\\pi/k$ with spatial average $\\langle \\cdot \\rangle$ defined by $\\langle f \\rangle = \\frac{1}{V}\\int_{V} f \\,\\mathrm{d}V$, where $V$ is the domain volume. Let the initial condition be the three-dimensional Taylor–Green velocity field\n$$\nu(x,y,z,0) = U_{0}\\,\\sin(kx)\\cos(ky)\\cos(kz),\\quad\nv(x,y,z,0) = -U_{0}\\,\\cos(kx)\\sin(ky)\\cos(kz),\\quad\nw(x,y,z,0) = 0,\n$$\nwhich satisfies $\\nabla\\cdot\\boldsymbol{u}=0$. Define the kinetic energy per unit mass as $E(t)=\\frac{1}{2}\\langle |\\boldsymbol{u}|^{2}\\rangle$ and the vorticity as $\\boldsymbol{\\omega}=\\nabla\\times\\boldsymbol{u}$. Starting from the incompressible Navier–Stokes equations and the above definitions, derive the energy balance and then evaluate the initial energy decay rate $\\left.\\frac{\\mathrm{d}E}{\\mathrm{d}t}\\right|_{t=0}$ for this Taylor–Green initial condition. Express your final answer as a closed-form analytic expression in terms of $U_{0}$, $k$, and the kinematic viscosity $\\nu$. Provide the expression symbolically; if evaluated numerically, use International System of Units (SI), but do not include units in your final expression.", "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It is a standard problem in theoretical fluid dynamics concerning the analysis of the Taylor–Green vortex, a canonical flow used for studying turbulence and for validating numerical solvers for the Navier-Stokes equations. We may therefore proceed with a formal derivation.\n\nThe governing equations for an incompressible fluid with constant density $\\rho$ and kinematic viscosity $\\nu$ are the Navier-Stokes equations. In terms of velocity $\\boldsymbol{u}$ and kinematic pressure $p$ (pressure divided by $\\rho$), the momentum equation is:\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + (\\boldsymbol{u} \\cdot \\nabla) \\boldsymbol{u} = -\\nabla p + \\nu \\nabla^2 \\boldsymbol{u}\n$$\nThe incompressibility constraint is given by:\n$$\n\\nabla \\cdot \\boldsymbol{u} = 0\n$$\nThe kinetic energy per unit mass is defined as $E(t) = \\frac{1}{2}\\langle |\\boldsymbol{u}|^{2}\\rangle$, where the spatial average $\\langle f \\rangle$ over the domain volume $V$ is $\\frac{1}{V}\\int_{V} f \\,\\mathrm{d}V$.\n\nFirst, we derive the general energy balance equation. We take the dot product of the momentum equation with the velocity vector $\\boldsymbol{u}$:\n$$\n\\boldsymbol{u} \\cdot \\frac{\\partial \\boldsymbol{u}}{\\partial t} + \\boldsymbol{u} \\cdot ((\\boldsymbol{u} \\cdot \\nabla) \\boldsymbol{u}) = -\\boldsymbol{u} \\cdot \\nabla p + \\nu \\boldsymbol{u} \\cdot \\nabla^2 \\boldsymbol{u}\n$$\nWe can rewrite the first term as $\\boldsymbol{u} \\cdot \\frac{\\partial \\boldsymbol{u}}{\\partial t} = \\frac{1}{2} \\frac{\\partial}{\\partial t}(\\boldsymbol{u} \\cdot \\boldsymbol{u}) = \\frac{1}{2} \\frac{\\partial |\\boldsymbol{u}|^2}{\\partial t}$. Applying the spatial average to the entire equation yields:\n$$\n\\left\\langle \\frac{1}{2} \\frac{\\partial |\\boldsymbol{u}|^2}{\\partial t} \\right\\rangle + \\left\\langle \\boldsymbol{u} \\cdot ((\\boldsymbol{u} \\cdot \\nabla) \\boldsymbol{u}) \\right\\rangle = -\\left\\langle \\boldsymbol{u} \\cdot \\nabla p \\right\\rangle + \\nu \\left\\langle \\boldsymbol{u} \\cdot \\nabla^2 \\boldsymbol{u} \\right\\rangle\n$$\nThe spatial average and time derivative commute, so the first term is $\\frac{\\mathrm{d}}{\\mathrm{d}t} \\left\\langle \\frac{1}{2} |\\boldsymbol{u}|^2 \\right\\rangle = \\frac{\\mathrm{d}E}{\\mathrm{d}t}$.\n\nWe now analyze each of the remaining terms for a triply periodic domain:\n1.  The advection term: The term $\\boldsymbol{u} \\cdot ((\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u})$ can be written as $\\nabla \\cdot (\\boldsymbol{u} \\frac{|\\boldsymbol{u}|^2}{2})$ by using the vector identity $\\nabla \\cdot (c\\boldsymbol{A}) = c(\\nabla \\cdot \\boldsymbol{A}) + \\boldsymbol{A} \\cdot \\nabla c$ with $c = \\frac{|\\boldsymbol{u}|^2}{2}$, $\\boldsymbol{A} = \\boldsymbol{u}$, and the incompressibility condition $\\nabla \\cdot \\boldsymbol{u} = 0$. The average of this term is $\\langle \\nabla \\cdot (\\boldsymbol{u} \\frac{|\\boldsymbol{u}|^2}{2}) \\rangle$. By the Divergence Theorem, this volume integral is converted to a surface integral over the boundary of the domain. For periodic boundary conditions, the integrals over opposite faces cancel, so this term is zero.\n\n2.  The pressure term: The term $-\\boldsymbol{u} \\cdot \\nabla p$ can be written as $-\\nabla \\cdot (p\\boldsymbol{u})$ using the product rule and the incompressibility condition $\\nabla \\cdot \\boldsymbol{u} = 0$. The average, $-\\langle \\nabla \\cdot (p\\boldsymbol{u}) \\rangle$, is again a volume integral of a divergence, which vanishes for periodic boundary conditions.\n\n3.  The viscous term: We analyze the term $\\nu \\langle \\boldsymbol{u} \\cdot \\nabla^2 \\boldsymbol{u} \\rangle$. We use the vector identity $\\nabla^2 \\boldsymbol{u} = \\nabla(\\nabla \\cdot \\boldsymbol{u}) - \\nabla \\times (\\nabla \\times \\boldsymbol{u})$. With $\\nabla \\cdot \\boldsymbol{u} = 0$, this simplifies to $\\nabla^2 \\boldsymbol{u} = -\\nabla \\times (\\nabla \\times \\boldsymbol{u}) = -\\nabla \\times \\boldsymbol{\\omega}$, where $\\boldsymbol{\\omega} = \\nabla \\times \\boldsymbol{u}$ is the vorticity. The viscous term becomes $-\\nu \\langle \\boldsymbol{u} \\cdot (\\nabla \\times \\boldsymbol{\\omega}) \\rangle$. Using another vector identity, $\\nabla \\cdot (\\boldsymbol{a} \\times \\boldsymbol{b}) = (\\nabla \\times \\boldsymbol{a}) \\cdot \\boldsymbol{b} - \\boldsymbol{a} \\cdot (\\nabla \\times \\boldsymbol{b})$, we let $\\boldsymbol{a}=\\boldsymbol{u}$ and $\\boldsymbol{b}=\\boldsymbol{\\omega}$ to get $\\nabla \\cdot (\\boldsymbol{u} \\times \\boldsymbol{\\omega}) = (\\nabla \\times \\boldsymbol{u}) \\cdot \\boldsymbol{\\omega} - \\boldsymbol{u} \\cdot (\\nabla \\times \\boldsymbol{\\omega}) = |\\boldsymbol{\\omega}|^2 - \\boldsymbol{u} \\cdot (\\nabla \\times \\boldsymbol{\\omega})$. Rearranging, we have $\\boldsymbol{u} \\cdot (\\nabla \\times \\boldsymbol{\\omega}) = |\\boldsymbol{\\omega}|^2 - \\nabla \\cdot (\\boldsymbol{u} \\times \\boldsymbol{\\omega})$. The viscous term is thus $\\nu \\langle -|\\boldsymbol{\\omega}|^2 + \\nabla \\cdot (\\boldsymbol{u} \\times \\boldsymbol{\\omega}) \\rangle$. The average of the divergence part, $\\langle \\nabla \\cdot (\\boldsymbol{u} \\times \\boldsymbol{\\omega}) \\rangle$, vanishes for periodic boundary conditions. We are left with $-\\nu \\langle |\\boldsymbol{\\omega}|^2 \\rangle$.\n\nCombining these results, the energy balance equation simplifies to the rate of energy dissipation:\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}t} = -\\nu \\langle |\\boldsymbol{\\omega}|^2 \\rangle\n$$\nTo find the initial energy decay rate, we must evaluate this expression at $t=0$:\n$$\n\\left.\\frac{\\mathrm{d}E}{\\mathrm{d}t}\\right|_{t=0} = -\\nu \\langle |\\boldsymbol{\\omega}(x,y,z,0)|^2 \\rangle\n$$\nWe compute the initial vorticity field $\\boldsymbol{\\omega}(x,y,z,0)$ from the initial velocity field $\\boldsymbol{u}(x,y,z,0)$:\n$$\n\\boldsymbol{u}(0) = \\begin{pmatrix} U_{0}\\,\\sin(kx)\\cos(ky)\\cos(kz) \\\\ -U_{0}\\,\\cos(kx)\\sin(ky)\\cos(kz) \\\\ 0 \\end{pmatrix}\n$$\nThe components of $\\boldsymbol{\\omega} = \\nabla \\times \\boldsymbol{u} = (\\omega_x, \\omega_y, \\omega_z)$ are:\n$$\n\\omega_x = \\frac{\\partial w}{\\partial y} - \\frac{\\partial v}{\\partial z} = 0 - \\frac{\\partial}{\\partial z}(-U_0 \\cos(kx)\\sin(ky)\\cos(kz)) = -U_0 k \\cos(kx)\\sin(ky)\\sin(kz)\n$$\n$$\n\\omega_y = \\frac{\\partial u}{\\partial z} - \\frac{\\partial w}{\\partial x} = \\frac{\\partial}{\\partial z}(U_0 \\sin(kx)\\cos(ky)\\cos(kz)) - 0 = -U_0 k \\sin(kx)\\cos(ky)\\sin(kz)\n$$\n$$\n\\omega_z = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y} = \\frac{\\partial}{\\partial x}(-U_0 \\cos(kx)\\sin(ky)\\cos(kz)) - \\frac{\\partial}{\\partial y}(U_0 \\sin(kx)\\cos(ky)\\cos(kz))\n$$\n$$\n\\omega_z = U_0 k \\sin(kx)\\sin(ky)\\cos(kz) - (-U_0 k \\sin(kx)\\sin(ky)\\cos(kz)) = 2 U_0 k \\sin(kx)\\sin(ky)\\cos(kz)\n$$\nNext, we calculate the squared magnitude of the vorticity, $|\\boldsymbol{\\omega}|^2 = \\omega_x^2 + \\omega_y^2 + \\omega_z^2$:\n$$\n|\\boldsymbol{\\omega}(0)|^2 = (-U_0 k \\cos(kx)\\sin(ky)\\sin(kz))^2 + (-U_0 k \\sin(kx)\\cos(ky)\\sin(kz))^2 + (2 U_0 k \\sin(kx)\\sin(ky)\\cos(kz))^2\n$$\n$$\n|\\boldsymbol{\\omega}(0)|^2 = (U_0 k)^2 \\left[ \\cos^2(kx)\\sin^2(ky)\\sin^2(kz) + \\sin^2(kx)\\cos^2(ky)\\sin^2(kz) + 4\\sin^2(kx)\\sin^2(ky)\\cos^2(kz) \\right]\n$$\nNow, we compute the spatial average. The domain is a cube of side length $L = 2\\pi/k$. The average of functions $\\sin^2(k\\xi)$ and $\\cos^2(k\\xi)$ over the interval $[0, 2\\pi/k]$ is $\\frac{1}{2}$. That is, $\\langle \\sin^2(kx) \\rangle = 1/2$, $\\langle \\cos^2(kx) \\rangle = 1/2$, and similarly for the $y$ and $z$ coordinates. Due to the separability of the integrals, we can average each trigonometric factor independently:\n$$\n\\langle |\\boldsymbol{\\omega}(0)|^2 \\rangle = (U_0 k)^2 \\left[ \\langle\\cos^2(kx)\\rangle\\langle\\sin^2(ky)\\rangle\\langle\\sin^2(kz)\\rangle + \\langle\\sin^2(kx)\\rangle\\langle\\cos^2(ky)\\rangle\\langle\\sin^2(kz)\\rangle + 4\\langle\\sin^2(kx)\\rangle\\langle\\sin^2(ky)\\rangle\\langle\\cos^2(kz)\\rangle \\right]\n$$\n$$\n\\langle |\\boldsymbol{\\omega}(0)|^2 \\rangle = (U_0 k)^2 \\left[ \\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right) + \\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right) + 4\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right) \\right]\n$$\n$$\n\\langle |\\boldsymbol{\\omega}(0)|^2 \\rangle = (U_0 k)^2 \\left[ \\frac{1}{8} + \\frac{1}{8} + \\frac{4}{8} \\right] = (U_0 k)^2 \\left( \\frac{6}{8} \\right) = \\frac{3}{4} U_0^2 k^2\n$$\nFinally, we substitute this result back into the expression for the initial energy decay rate:\n$$\n\\left.\\frac{\\mathrm{d}E}{\\mathrm{d}t}\\right|_{t=0} = -\\nu \\langle |\\boldsymbol{\\omega}(0)|^2 \\rangle = -\\nu \\left( \\frac{3}{4} U_0^2 k^2 \\right) = -\\frac{3}{4}\\nu k^2 U_0^2\n$$\nThis is the closed-form analytic expression for the initial energy decay rate of the three-dimensional Taylor-Green vortex.", "answer": "$$\n\\boxed{-\\frac{3}{4}\\nu k^{2}U_{0}^{2}}\n$$", "id": "3370515"}, {"introduction": "While the analytical solution to the Taylor-Green vortex provides a clear target, numerical methods introduce their own complexities. This practical exercise explores one of the most significant pitfalls in pseudo-spectral simulations: aliasing error, which generates spurious energy at high wavenumbers. You will implement a simulation of the 2D vortex *without* a de-aliasing filter to directly observe and quantify this numerical contamination, providing a stark illustration of why proper de-aliasing techniques are indispensable for accurate results [@problem_id:3370572].", "problem": "You are asked to design and implement a fully reproducible numerical experiment to quantify spurious high-wavenumber energy growth caused by insufficient de-aliasing in a pseudo-spectral simulation of the Taylor–Green vortex decay. The goal is to start from first principles of computational fluid dynamics and produce a program that computes a measure of spurious energy at high wavenumbers for runs that do not employ the two-thirds de-aliasing rule.\n\nBegin from the incompressible Navier–Stokes equations in two spatial dimensions on a periodic domain,\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + (\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u} = -\\nabla p + \\nu \\nabla^2 \\boldsymbol{u}, \\quad \\nabla\\cdot\\boldsymbol{u} = 0,\n$$\nwhere $\\boldsymbol{u} = (u,v)$ is the velocity field, $p$ is the pressure, and $\\nu$ is the kinematic viscosity. On the square domain of side length $L$, use periodic boundary conditions. Consider the Taylor–Green vortex initial condition\n$$\nu(x,y,0) = U_0 \\cos(k_0 x)\\sin(k_0 y), \\quad v(x,y,0) = -U_0 \\sin(k_0 x)\\cos(k_0 y),\n$$\nwith $k_0 = 1$ and $L = 2\\pi$, so that $x,y\\in[0,2\\pi]$. In the continuous setting, this field is divergence-free and yields cancellation of the nonlinear term by the pressure gradient, leading to purely diffusive decay of the amplitude. Therefore, in the absence of numerical errors, no energy should populate wavenumbers above the initial $k_0$ mode.\n\nTo approximate the dynamics numerically, implement a pseudo-spectral method with the following fundamental steps, expressed using only widely accepted facts and operators:\n- Use the Fast Fourier Transform (FFT) to move between physical and spectral space. Denote spectral wavenumbers by $k_x$ and $k_y$ and define spectral differentiation by multiplication with $i k_x$ or $i k_y$ in Fourier space.\n- Compute the nonlinear convective term $(\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u}$ in physical space by multiplying velocity components with their spatial derivatives and transform back to spectral space.\n- Enforce incompressibility by projecting the nonlinear term onto the divergence-free subspace in spectral space using the orthogonal Leray projection $\\boldsymbol{P}(k)$ that removes the gradient component. For each nonzero wavenumber vector $\\boldsymbol{k}=(k_x,k_y)$, define the projection $\\boldsymbol{P}(k) = \\boldsymbol{I} - \\frac{\\boldsymbol{k}\\boldsymbol{k}^\\top}{|\\boldsymbol{k}|^2}$.\n- Advance in time using an integrating-factor explicit update for diffusion: for each spectral mode with squared magnitude $|\\boldsymbol{k}|^2 = k_x^2 + k_y^2$, update $\\hat{\\boldsymbol{u}}$ by\n$$\n\\hat{\\boldsymbol{u}}^{n+1} = e^{-\\nu |\\boldsymbol{k}|^2 \\Delta t} \\left( \\hat{\\boldsymbol{u}}^{n} + \\Delta t\\,\\widehat{\\boldsymbol{N}}^{n} \\right),\n$$\nwhere $\\widehat{\\boldsymbol{N}}$ is the projected nonlinear term. No de-aliasing should be applied, meaning you must not use the two-thirds truncation rule or any anti-aliasing filter in evaluating products.\n\nDefine the instantaneous spectral energy density at time $t$ by\n$$\nE(\\boldsymbol{k}, t) = \\frac{1}{2}\\left( |\\hat{u}(\\boldsymbol{k},t)|^2 + |\\hat{v}(\\boldsymbol{k},t)|^2 \\right).\n$$\nLet $|\\boldsymbol{k}|_{\\max}$ be the maximum resolvable wavenumber magnitude on the discrete grid. For a fixed fraction $f_h$ with $0  f_h  1$, define the \"high-wavenumber band\" as all modes with $|\\boldsymbol{k}| \\ge f_h |\\boldsymbol{k}|_{\\max}$. The spurious high-wavenumber energy fraction at time $T$ is then\n$$\nR(T) = \\frac{\\sum_{|\\boldsymbol{k}| \\ge f_h |\\boldsymbol{k}|_{\\max}} E(\\boldsymbol{k}, T)}{\\sum_{\\boldsymbol{k}\\ne \\boldsymbol{0}} E(\\boldsymbol{k}, T)}.\n$$\nIn the ideal continuous Taylor–Green vortex decay, $R(T)$ should be zero for all $T$ because energy remains in the initial wavenumber shell. Any nonzero value computed numerically without de-aliasing reflects spurious energy growth at high wavenumbers due to aliasing errors.\n\nAll quantities are to be treated in dimensionless form, and the final answers should be unitless decimal numbers.\n\nImplement the above pseudo-spectral method without any de-aliasing, and compute $R(T)$ for each of the following test cases. Use $k_0 = 1$ and $L = 2\\pi$ in all cases. The angle unit for any trigonometric evaluations is radians. The quantity $f_h$ denotes the fractional threshold for the high-wavenumber band. The test suite parameters are:\n- Case $1$: grid size $N = 32$, viscosity $\\nu = 0.01$, time step $\\Delta t = 0.002$, final time $T = 0.2$, amplitude $U_0 = 1.0$, high-wavenumber fraction $f_h = 0.8$.\n- Case $2$: grid size $N = 32$, viscosity $\\nu = 0.01$, time step $\\Delta t = 0.002$, final time $T = 0.2$, amplitude $U_0 = 4.0$, high-wavenumber fraction $f_h = 0.8$.\n- Case $3$: grid size $N = 32$, viscosity $\\nu = 0.0$, time step $\\Delta t = 0.001$, final time $T = 0.2$, amplitude $U_0 = 1.0$, high-wavenumber fraction $f_h = 0.8$.\n- Case $4$: grid size $N = 64$, viscosity $\\nu = 0.01$, time step $\\Delta t = 0.002$, final time $T = 0.2$, amplitude $U_0 = 1.0$, high-wavenumber fraction $f_h = 0.8$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3,r_4]$), where each $r_i$ is the computed spurious high-wavenumber energy fraction $R(T)$ for the corresponding test case, expressed as a decimal number. No other text should be printed. All computations, including any transformation steps, must be explicitly carried out by your code without using external files or user input.", "solution": "The provided problem is a well-posed and scientifically sound task in computational fluid dynamics. It requires the implementation of a pseudo-spectral numerical simulation to study a fundamental numerical artifact—aliasing error—in the context of a canonical flow, the Taylor–Green vortex. All necessary components, including the governing equations, initial and boundary conditions, a detailed description of the numerical algorithm, and specific parameters for test cases, are provided. The problem is self-contained, consistent, and computationally feasible. Therefore, a solution is warranted.\n\nThe objective is to solve the two-dimensional incompressible Navier–Stokes equations on a doubly periodic square domain $[0, 2\\pi] \\times [0, 2\\pi]$:\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + (\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u} = -\\nabla p + \\nu \\nabla^2 \\boldsymbol{u}\n$$\n$$\n\\nabla\\cdot\\boldsymbol{u} = 0\n$$\nwhere $\\boldsymbol{u} = (u, v)$ is the velocity field, $p$ is the pressure, and $\\nu$ is the kinematic viscosity. The simulation starts with the Taylor–Green vortex initial condition:\n$$\nu(x,y,0) = U_0 \\cos(k_0 x)\\sin(k_0 y)\n$$\n$$\nv(x,y,0) = -U_0 \\sin(k_0 x)\\cos(k_0 y)\n$$\nwith initial wavenumber $k_0=1$ and amplitude $U_0$.\n\nThe numerical solution is constructed using a pseudo-spectral method on a uniform grid of size $N \\times N$.\n\n**1. Discretization and Spectral Representation**\nThe physical domain $[0, 2\\pi] \\times [0, 2\\pi]$ is discretized into an $N \\times N$ grid of points $(x_i, y_j)$, where $x_i = i(2\\pi/N)$ and $y_j = j(2\\pi/N)$ for $i,j = 0, 1, \\dots, N-1$. A function $f(x,y)$ on this grid is represented in Fourier space by its spectral coefficients $\\hat{f}(k_x, k_y)$, obtained via the two-dimensional discrete Fourier transform (DFT). The corresponding integer wavenumbers for a domain of length $L=2\\pi$ are $k_x, k_y \\in \\{-N/2, \\dots, N/2-1\\}$. These are established using standard FFT libraries. We form two-dimensional wavenumber arrays $K_x$ and $K_y$ corresponding to each point on the spectral grid.\n\n**2. Time Integration Scheme**\nThe simulation advances in time from an initial state $\\hat{\\boldsymbol{u}}^n$ at time $t_n$ to $\\hat{\\boldsymbol{u}}^{n+1}$ at time $t_{n+1} = t_n + \\Delta t$. The problem specifies an integrating-factor method, which treats the linear diffusion term implicitly and the nonlinear advection term explicitly. The update rule in spectral space is:\n$$\n\\hat{\\boldsymbol{u}}^{n+1}(\\boldsymbol{k}) = e^{-\\nu |\\boldsymbol{k}|^2 \\Delta t} \\left( \\hat{\\boldsymbol{u}}^{n}(\\boldsymbol{k}) + \\Delta t\\,\\widehat{\\boldsymbol{N}}^{n}(\\boldsymbol{k}) \\right)\n$$\nHere, $|\\boldsymbol{k}|^2 = k_x^2 + k_y^2$, and $\\widehat{\\boldsymbol{N}}$ is the Fourier transform of the divergence-free part of the nonlinear advection term $-(\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u}$. The steps to compute $\\widehat{\\boldsymbol{N}}$ at each time step are as follows.\n\n**2.1. Computing the Nonlinear Term**\nThe term $(\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u}$ is quadratic and thus efficiently computed in physical space (this is the \"pseudo-spectral\" approach).\nFirst, the spatial derivatives required for the gradient $\\nabla\\boldsymbol{u}$ are computed in spectral space. For example, the Fourier coefficients of the derivative $\\partial_x u$ are given by $(i k_x) \\hat{u}(k_x, k_y)$.\nThe algorithm is:\n1. Start with the velocity fields in spectral space, $\\hat{u}^n$ and $\\hat{v}^n$.\n2. Compute the spectral representations of all four gradient components:\n   - $\\widehat{\\partial_x u} = i K_x \\hat{u}^n$\n   - $\\widehat{\\partial_y u} = i K_y \\hat{u}^n$\n   - $\\widehat{\\partial_x v} = i K_x \\hat{v}^n$\n   - $\\widehat{\\partial_y v} = i K_y \\hat{v}^n$\n3. Transform the velocity components and their derivatives to physical space using the inverse 2D-FFT:\n   - $u^n = \\text{IFFT}(\\hat{u}^n)$, $v^n = \\text{IFFT}(\\hat{v}^n)$\n   - $\\partial_x u = \\text{IFFT}(\\widehat{\\partial_x u})$, etc.\n4. In physical space, compute the components of the advection term, which we call $(A_u, A_v)$:\n   - $A_u = u^n (\\partial_x u) + v^n (\\partial_y u)$\n   - $A_v = u^n (\\partial_x v) + v^n (\\partial_y v)$\n5. Transform the advection term back to spectral space: $\\widehat{\\boldsymbol{A}} = (\\widehat{A_u}, \\widehat{A_v}) = \\text{FFT}(A_u, A_v)$.\nAs per the problem specification, no de-aliasing filter (such as the two-thirds rule) is applied to $\\widehat{\\boldsymbol{A}}$. This allows aliasing errors, which arise from the multiplication in physical space, to corrupt all wavenumber modes.\n\n**2.2. Enforcing Incompressibility**\nThe Navier–Stokes equations require the velocity field to remain divergence-free. This is enforced by projecting the nonlinear term $\\widehat{\\boldsymbol{A}}$ onto the divergence-free subspace. The term we require for the time update is $\\widehat{\\boldsymbol{N}} = -\\boldsymbol{P}(\\boldsymbol{k})\\widehat{\\boldsymbol{A}}$, where $\\boldsymbol{P}(\\boldsymbol{k})$ is the Leray projection operator. This operator removes the component of a vector field that can be written as a gradient. In spectral space, for any non-zero wavenumber vector $\\boldsymbol{k}=(k_x,k_y)$, the projection is given by:\n$$\n\\boldsymbol{P}(\\boldsymbol{k}) \\widehat{\\boldsymbol{A}}(\\boldsymbol{k}) = \\widehat{\\boldsymbol{A}}(\\boldsymbol{k}) - \\frac{\\boldsymbol{k} (\\boldsymbol{k} \\cdot \\widehat{\\boldsymbol{A}}(\\boldsymbol{k}))}{|\\boldsymbol{k}|^2}\n$$\nThis projection is applied to the computed spectral advection term $\\widehat{\\boldsymbol{A}}$ for every wavenumber $\\boldsymbol{k} \\ne \\boldsymbol{0}$. For $\\boldsymbol{k} = \\boldsymbol{0}$, the projection is not applied, and its coefficient is typically zero. The total nonlinear term for the update is $\\widehat{\\boldsymbol{N}}^n = -\\boldsymbol{P}(\\boldsymbol{k})\\widehat{\\boldsymbol{A}}^n$.\n\n**3. Measuring Spurious Energy**\nAfter running the simulation for a total time $T$, the final state $\\hat{\\boldsymbol{u}}(T)$ is used to compute the spurious high-wavenumber energy fraction, $R(T)$.\n1. The energy spectrum is computed from the final velocity field in Fourier space:\n   $$\n   E(\\boldsymbol{k}, T) = \\frac{1}{2}\\left( |\\hat{u}(\\boldsymbol{k},T)|^2 + |\\hat{v}(\\boldsymbol{k},T)|^2 \\right)\n   $$\n   Note that the normalization of the FFT does not affect the final ratio $R(T)$, so raw FFT output can be used.\n2. The total energy in all resolved modes (excluding the mean $\\boldsymbol{k}=\\boldsymbol{0}$ mode) is the sum over the spectrum:\n   $$\n   E_{\\text{total}} = \\sum_{\\boldsymbol{k}\\ne \\boldsymbol{0}} E(\\boldsymbol{k}, T)\n   $$\n3. The spurious energy is defined as the energy residing in the high-wavenumber band. This band is defined by modes $\\boldsymbol{k}$ whose magnitude $|\\boldsymbol{k}| = \\sqrt{k_x^2+k_y^2}$ exceeds a certain threshold. The threshold is $f_h |\\boldsymbol{k}|_{\\max}$, where $f_h$ is a given fraction and $|\\boldsymbol{k}|_{\\max}$ is the maximum resolvable wavenumber magnitude. For an $N \\times N$ grid, the maximum wavenumber component is $N/2$, so $|\\boldsymbol{k}|_{\\max} = \\sqrt{(N/2)^2 + (N/2)^2} = N/\\sqrt{2}$. The high-wavenumber energy is:\n   $$\n   E_{\\text{high}} = \\sum_{|\\boldsymbol{k}| \\ge f_h |\\boldsymbol{k}|_{\\max}} E(\\boldsymbol{k}, T)\n   $$\n4. The final metric is the ratio of these two energies:\n   $$\n   R(T) = \\frac{E_{\\text{high}}}{E_{\\text{total}}}\n   $$\nThis procedure is implemented and executed for each of the four test cases specified in the problem statement. The results showcase how factors like the strength of nonlinearity (proportional to $U_0$), viscosity $\\nu$, and grid resolution $N$ influence the generation of spurious energy due to aliasing.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(N, nu, dt, T, U0, fh):\n    \"\"\"\n    Runs a single pseudo-spectral simulation of the 2D Taylor-Green vortex decay.\n\n    Args:\n        N (int): Grid size (N x N).\n        nu (float): Kinematic viscosity.\n        dt (float): Time step.\n        T (float): Final time.\n        U0 (float): Initial velocity amplitude.\n        fh (float): Fractional threshold for high-wavenumber band.\n\n    Returns:\n        float: Spurious high-wavenumber energy fraction R(T).\n    \"\"\"\n    # 1. Setup Grid and Wavenumbers\n    L = 2.0 * np.pi\n    k0 = 1.0\n    dx = L / N\n    x = np.arange(N) * dx\n    X, Y = np.meshgrid(x, x, indexing='ij')\n\n    # Wavenumbers (for a 2*pi domain, these are integers)\n    k = np.fft.fftfreq(N) * N\n    Kx, Ky = np.meshgrid(k, k, indexing='ij')\n    Ksq = Kx**2 + Ky**2\n    \n    # Inverse of Ksq for projection, handling division by zero at k=0\n    Ksq_inv = np.divide(1.0, Ksq, out=np.zeros_like(Ksq), where=Ksq != 0)\n\n    # 2. Initial Conditions\n    u = U0 * np.cos(k0 * X) * np.sin(k0 * Y)\n    v = -U0 * np.sin(k0 * X) * np.cos(k0 * Y)\n\n    u_hat = np.fft.fft2(u)\n    v_hat = np.fft.fft2(v)\n\n    # 3. Time-Stepping Loop\n    num_steps = int(round(T / dt))\n    \n    # Integrating factor for diffusion term\n    integrating_factor = np.exp(-nu * Ksq * dt)\n\n    for _ in range(num_steps):\n        # 3a. Compute nonlinear term in physical space\n        u = np.fft.ifft2(u_hat)\n        v = np.fft.ifft2(v_hat)\n        \n        du_dx_hat = 1j * Kx * u_hat\n        du_dy_hat = 1j * Ky * u_hat\n        dv_dx_hat = 1j * Kx * v_hat\n        dv_dy_hat = 1j * Ky * v_hat\n        \n        du_dx = np.fft.ifft2(du_dx_hat)\n        du_dy = np.fft.ifft2(du_dy_hat)\n        dv_dx = np.fft.ifft2(dv_dx_hat)\n        dv_dy = np.fft.ifft2(dv_dy_hat)\n\n        # Advection term A = (u.grad)u\n        # For the update equation, we need N = -(u.grad)u\n        A_u = u * du_dx + v * du_dy\n        A_v = u * dv_dx + v * dv_dy\n\n        A_u_hat = np.fft.fft2(A_u)\n        A_v_hat = np.fft.fft2(A_v)\n\n        # 3b. Project nonlinear term to be divergence-free\n        # N_hat_projected = -P(A_hat)\n        k_dot_A_hat = Kx * A_u_hat + Ky * A_v_hat\n        \n        N_u_hat = -(A_u_hat - Kx * k_dot_A_hat * Ksq_inv)\n        N_v_hat = -(A_v_hat - Ky * k_dot_A_hat * Ksq_inv)\n\n        # 3c. Update in spectral space\n        u_hat = integrating_factor * (u_hat + dt * N_u_hat)\n        v_hat = integrating_factor * (v_hat + dt * N_v_hat)\n\n    # 4. Compute Spurious Energy Fraction R(T)\n    # Energy spectrum E(k) = 0.5 * (|u_hat|^2 + |v_hat|^2)\n    energy_spectrum = 0.5 * (np.abs(u_hat)**2 + np.abs(v_hat)**2)\n\n    # Maximum resolvable wavenumber magnitude\n    k_max_mag = np.sqrt(2 * (N / 2)**2)\n    \n    # Calculate mask for high-wavenumber band\n    k_mag = np.sqrt(Ksq)\n    high_wavenumber_mask = k_mag >= fh * k_max_mag\n\n    # Calculate total and high-wavenumber energies\n    # Exclude the k=0 mode from total energy\n    total_energy_mask = k_mag > 0\n    total_energy = np.sum(energy_spectrum[total_energy_mask])\n    high_wavenumber_energy = np.sum(energy_spectrum[high_wavenumber_mask])\n\n    if total_energy == 0:\n        return 0.0\n\n    return high_wavenumber_energy / total_energy\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1\n        {'N': 32, 'nu': 0.01, 'dt': 0.002, 'T': 0.2, 'U0': 1.0, 'fh': 0.8},\n        # Case 2\n        {'N': 32, 'nu': 0.01, 'dt': 0.002, 'T': 0.2, 'U0': 4.0, 'fh': 0.8},\n        # Case 3\n        {'N': 32, 'nu': 0.0, 'dt': 0.001, 'T': 0.2, 'U0': 1.0, 'fh': 0.8},\n        # Case 4\n        {'N': 64, 'nu': 0.01, 'dt': 0.002, 'T': 0.2, 'U0': 1.0, 'fh': 0.8},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(\n            N=case['N'],\n            nu=case['nu'],\n            dt=case['dt'],\n            T=case['T'],\n            U0=case['U0'],\n            fh=case['fh']\n        )\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```", "id": "3370572"}, {"introduction": "Having established the theoretical basis for decay and the numerical necessity of de-aliasing, we can now tackle the full complexity of the three-dimensional Taylor-Green vortex. This flow is a classic model for the onset of turbulence, driven by the mechanism of vortex stretching which transfers energy to progressively smaller scales. This advanced practice guides you through a Direct Numerical Simulation (DNS) to capture this forward energy cascade, analyzing the evolution of the energy spectrum to witness a key characteristic of turbulence [@problem_id:3370566].", "problem": "Consider the three-dimensional, incompressible Navier–Stokes equations on a triply periodic cubic domain of side length $L = 2\\pi$ with spatial coordinates $(x,y,z) \\in [0,2\\pi]^3$, and velocity field $\\boldsymbol{u}(x,y,z,t) = (u(x,y,z,t), v(x,y,z,t), w(x,y,z,t))$. The governing equations are\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + (\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u} = -\\nabla p + \\nu \\nabla^2 \\boldsymbol{u}, \\quad \\nabla \\cdot \\boldsymbol{u} = 0,\n$$\nwhere $p$ is the pressure and $\\nu$ is the kinematic viscosity. The initial condition is the classical three-dimensional Taylor–Green vortex:\n$$\nu(x,y,z,0) = U_0 \\sin(x)\\cos(y)\\cos(z), \\quad v(x,y,z,0) = -U_0 \\cos(x)\\sin(y)\\cos(z), \\quad w(x,y,z,0) = 0,\n$$\nwith $U_0$ the characteristic velocity amplitude.\n\nYou will perform a Direct Numerical Simulation (DNS) of the above system using a pseudo-spectral method with periodic boundary conditions on a uniform grid with $N^3$ points, where $N$ is the number of grid points per spatial direction. Use the standard Fourier-based incompressible projection that removes the divergence of the nonlinear term in Fourier space. Time integration must treat the viscous term exactly via an integrating factor and advance the nonlinear term explicitly using a second-order Adams–Bashforth method. Use the $2/3$-rule dealiasing on the nonlinear term in Fourier space.\n\nDefine the one-dimensional, isotropic kinetic energy spectrum $E(k,t)$ by binning the discrete Fourier-space kinetic energy into spherical shells of integer wavenumber magnitude $k \\in \\mathbb{N}$:\n$$\nE(k,t) = \\frac{1}{2}\\sum_{\\boldsymbol{\\kappa} \\in S_k} \\frac{\\left|\\hat{u}(\\boldsymbol{\\kappa},t)\\right|^2 + \\left|\\hat{v}(\\boldsymbol{\\kappa},t)\\right|^2 + \\left|\\hat{w}(\\boldsymbol{\\kappa},t)\\right|^2}{N^3},\n$$\nwhere $\\hat{u}$, $\\hat{v}$, and $\\hat{w}$ are the discrete Fourier transforms of $u$, $v$, and $w$, respectively, and $S_k = \\{\\boldsymbol{\\kappa} : \\|\\boldsymbol{\\kappa}\\| \\approx k\\}$ denotes the shell of modes with magnitude nearest to $k$. The total kinetic energy per unit mass at time $t$ is\n$$\n\\mathcal{K}(t) = \\frac{1}{2}\\left\\langle u^2 + v^2 + w^2 \\right\\rangle = \\frac{1}{2N^3}\\sum_{i,j,\\ell} \\left( u_{i,j,\\ell}^2(t) + v_{i,j,\\ell}^2(t) + w_{i,j,\\ell}^2(t) \\right).\n$$\nDefine the spectral centroid as\n$$\nC(t) = \\frac{\\sum_{k=1}^{k_{\\max}} k\\, E(k,t)}{\\sum_{k=1}^{k_{\\max}} E(k,t)},\n$$\nwhere $k_{\\max}$ is the largest resolvable integer shell index in the discrete grid.\n\nYour program must compute the time evolution of the energy spectrum $E(k,t)$ from the DNS of three-dimensional Taylor–Green vortex decay and verify the expected transfer of energy from low to higher wavenumbers prior to dissipation. Use the following test suite of parameter sets, where all physical quantities must be treated in their specified units. Time should be advanced with a fixed time step. The angle unit is radians, and spatial coordinates are in meters:\n\n- Test Case $1$: $N=32$, $U_0=1.0$ in $\\mathrm{m/s}$, $\\nu=0.01$ in $\\mathrm{m^2/s}$, $\\Delta t=0.005$ in $\\mathrm{s}$, $t_{\\mathrm{mid}}=0.20$ in $\\mathrm{s}$, $t_{\\mathrm{final}}=0.60$ in $\\mathrm{s}$.\n- Test Case $2$: $N=32$, $U_0=1.0$ in $\\mathrm{m/s}$, $\\nu=0.10$ in $\\mathrm{m^2/s}$, $\\Delta t=0.005$ in $\\mathrm{s}$, $t_{\\mathrm{mid}}=0.10$ in $\\mathrm{s}$, $t_{\\mathrm{final}}=0.30$ in $\\mathrm{s}$.\n- Test Case $3$: $N=32$, $U_0=1.0$ in $\\mathrm{m/s}$, $\\nu=0.005$ in $\\mathrm{m^2/s}$, $\\Delta t=0.004$ in $\\mathrm{s}$, $t_{\\mathrm{mid}}=0.30$ in $\\mathrm{s}$, $t_{\\mathrm{final}}=0.80$ in $\\mathrm{s}$.\n\nFor each test case, compute $E(k,t)$ at times $t=0$, $t=t_{\\mathrm{mid}}$, and $t=t_{\\mathrm{final}}$. From these spectra, compute:\n\n- The boolean $B_1$ indicating whether the spectral centroid increases from $t=0$ to $t=t_{\\mathrm{mid}}$, i.e., $C(t_{\\mathrm{mid}}) > C(0)$.\n- The boolean $B_2$ indicating whether the total kinetic energy strictly decreases from $t=0$ to $t=t_{\\mathrm{final}}$, i.e., $\\mathcal{K}(t_{\\mathrm{final}})  \\mathcal{K}(0)$.\n- The integer peak shell indices $K_0$, $K_{\\mathrm{mid}}$, and $K_{\\mathrm{final}}$, defined as the integer $k$ at which $E(k,t)$ attains its maximum at times $t=0$, $t=t_{\\mathrm{mid}}$, and $t=t_{\\mathrm{final}}$, respectively.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with one list per test case in order. Each per-test-case list must be of the form $[B_1,B_2,K_0,K_{\\mathrm{mid}},K_{\\mathrm{final}}]$, where booleans are either $\\mathrm{True}$ or $\\mathrm{False}$ and integers are base-10 numerals. For example, the overall output format is $[[\\cdot],[\\cdot],[\\cdot]]$.", "solution": "The problem requires a Direct Numerical Simulation (DNS) of the three-dimensional Taylor–Green vortex decay. The solution is obtained using a pseudo-spectral method. The process involves initializing the flow field, advancing it in time using a numerical scheme that handles the nonlinear and viscous terms of the Navier–Stokes equations, and finally, analyzing the resulting kinetic energy distribution at specified times.\n\n### 1. Governing Equations in Fourier Space\n\nThe incompressible Navier-Stokes equations are given by:\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + (\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u} = -\\nabla p + \\nu \\nabla^2 \\boldsymbol{u}\n$$\n$$\n\\nabla \\cdot \\boldsymbol{u} = 0\n$$\nFor a periodic domain of side length $L=2\\pi$, a spectral method using Fourier series is appropriate. The velocity field $\\boldsymbol{u}(\\boldsymbol{x},t)$ is represented by its Fourier coefficients $\\hat{\\boldsymbol{u}}(\\boldsymbol{\\kappa},t)$, where $\\boldsymbol{\\kappa} = (k_x, k_y, k_z)$ is the integer wavenumber vector.\n\nApplying the Fourier transform to the Navier-Stokes equations, the spatial derivatives become multiplications by the wavenumber vector. The divergence-free condition $\\nabla \\cdot \\boldsymbol{u} = 0$ becomes $i\\boldsymbol{\\kappa} \\cdot \\hat{\\boldsymbol{u}} = 0$, meaning the Fourier velocity vector is perpendicular to the wavenumber vector. The pressure term $\\nabla p$ is a gradient, so its Fourier transform $i\\boldsymbol{\\kappa}\\hat{p}$ is parallel to $\\boldsymbol{\\kappa}$. This allows us to eliminate the pressure term by projecting the equation onto the space of divergence-free vector fields. The projection operator in Fourier space is $\\mathbb{P}(\\hat{\\boldsymbol{f}}) = \\hat{\\boldsymbol{f}} - (\\hat{\\boldsymbol{f}} \\cdot \\boldsymbol{\\kappa})\\boldsymbol{\\kappa}/|\\boldsymbol{\\kappa}|^2$ for $\\boldsymbol{\\kappa} \\neq \\mathbf{0}$.\n\nThe transformed momentum equation becomes an ordinary differential equation (ODE) for each Fourier mode $\\hat{\\boldsymbol{u}}(\\boldsymbol{\\kappa},t)$:\n$$\n\\frac{d \\hat{\\boldsymbol{u}}}{d t} = \\mathbb{P}\\left(-\\mathcal{F}\\{(\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u}\\}\\right) - \\nu |\\boldsymbol{\\kappa}|^2 \\hat{\\boldsymbol{u}}\n$$\nwhere $\\mathcal{F}\\{\\cdot\\}$ denotes the Fourier transform and $|\\boldsymbol{\\kappa}|^2 = k_x^2 + k_y^2 + k_z^2$. We denote the projected nonlinear term as $\\hat{\\boldsymbol{N}}_{\\text{proj}} = \\mathbb{P}\\left(-\\mathcal{F}\\{(\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u}\\}\\right)$. The set of ODEs is:\n$$\n\\frac{d \\hat{\\boldsymbol{u}}}{d t} = \\hat{\\boldsymbol{N}}_{\\text{proj}}(\\hat{\\boldsymbol{u}}) - \\nu |\\boldsymbol{\\kappa}|^2 \\hat{\\boldsymbol{u}}\n$$\n\n### 2. Numerical Scheme\n\nThe time integration is performed using a semi-implicit scheme as specified. The viscous (linear) term is treated implicitly for stability, and the advective (nonlinear) term is treated explicitly. A second-order Adams-Bashforth scheme is used for the nonlinear term, and a second-order Crank-Nicolson scheme is used for the viscous term. This combination is a standard, stable, and second-order accurate method (AB2/CN).\n\nFor a time step from $t_n$ to $t_{n+1} = t_n + \\Delta t$, the AB2/CN scheme is:\n$$\n\\frac{\\hat{\\boldsymbol{u}}^{n+1} - \\hat{\\boldsymbol{u}}^n}{\\Delta t} = \\left(\\frac{3}{2}\\hat{\\boldsymbol{N}}_{\\text{proj}}^n - \\frac{1}{2}\\hat{\\boldsymbol{N}}_{\\text{proj}}^{n-1}\\right) - \\frac{\\nu |\\boldsymbol{\\kappa}|^2}{2}(\\hat{\\boldsymbol{u}}^{n+1} + \\hat{\\boldsymbol{u}}^n)\n$$\nwhere superscripts denote the time step index. Rearranging to solve for $\\hat{\\boldsymbol{u}}^{n+1}$:\n$$\n\\left(1 + \\frac{\\nu |\\boldsymbol{\\kappa}|^2 \\Delta t}{2}\\right)\\hat{\\boldsymbol{u}}^{n+1} = \\left(1 - \\frac{\\nu |\\boldsymbol{\\kappa}|^2 \\Delta t}{2}\\right)\\hat{\\boldsymbol{u}}^n + \\Delta t \\left(\\frac{3}{2}\\hat{\\boldsymbol{N}}_{\\text{proj}}^n - \\frac{1}{2}\\hat{\\boldsymbol{N}}_{\\text{proj}}^{n-1}\\right)\n$$\nThis scheme requires values from two previous time steps ($\\hat{\\boldsymbol{N}}_{\\text{proj}}^n$ and $\\hat{\\boldsymbol{N}}_{\\text{proj}}^{n-1}$). Therefore, a different method is needed for the first time step. A first-order semi-implicit Euler scheme is employed, which is sufficiently accurate for a single starting step:\n$$\n\\frac{\\hat{\\boldsymbol{u}}^1 - \\hat{\\boldsymbol{u}}^0}{\\Delta t} = \\hat{\\boldsymbol{N}}_{\\text{proj}}^0 - \\nu |\\boldsymbol{\\kappa}|^2 \\hat{\\boldsymbol{u}}^1 \\implies \\left(1 + \\nu |\\boldsymbol{\\kappa}|^2 \\Delta t\\right)\\hat{\\boldsymbol{u}}^1 = \\hat{\\boldsymbol{u}}^0 + \\Delta t \\hat{\\boldsymbol{N}}_{\\text{proj}}^0\n$$\n\n### 3. Pseudo-Spectral Calculation of the Nonlinear Term\n\nThe term $(\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u}$ is nonlinear, creating a convolution in Fourier space. To avoid the expensive convolution, a pseudo-spectral method is used. The steps to compute $\\hat{\\boldsymbol{N}}_{\\text{proj}}$ at each time step are:\n1.  Start with the velocity field in Fourier space, $\\hat{\\boldsymbol{u}}(\\boldsymbol{\\kappa},t)$.\n2.  Compute the Fourier transforms of the spatial derivatives, e.g., $\\mathcal{F}\\{\\partial u/\\partial x\\} = i k_x \\hat{u}$.\n3.  Transform the velocity components and their derivatives to physical space using Inverse Fast Fourier Transforms (IFFTs).\n4.  In physical space, compute the products, e.g., $u(x,y,z) \\cdot \\frac{\\partial u}{\\partial x}(x,y,z)$, and sum them to form the components of $(\\boldsymbol{u} \\cdot \\nabla)\\boldsymbol{u}$.\n5.  Transform the resulting nonlinear advection term vector back to Fourier space using FFTs.\n6.  **Dealiasing**: To prevent aliasing errors from the quadratic nonlinearity, high-frequency modes generated by the products are removed. The $2/3$-rule is applied by setting to zero all Fourier coefficients $\\hat{f}(\\boldsymbol{\\kappa})$ for which any component of the wavenumber vector satisfies $|k_i| > K_c = \\lfloor N/3 \\rfloor$. For $N=32$, the cutoff wavenumber is $K_c=10$. This filtering is applied to the Fourier representation of the nonlinear term.\n7.  **Projection**: The dealiased nonlinear term is projected onto the space of divergence-free fields to enforce the incompressibility constraint, yielding $\\hat{\\boldsymbol{N}}_{\\text{proj}}$.\n\n### 4. Initialization and Post-Processing\n\nThe simulation is initialized with the specified Taylor-Green vortex velocity field at $t=0$:\n$$\nu(x,y,z,0) = U_0 \\sin(x)\\cos(y)\\cos(z) \\\\\nv(x,y,z,0) = -U_0 \\cos(x)\\sin(y)\\cos(z) \\\\\nw(x,y,z,0) = 0\n$$\nThe velocity fields are initialized on the $N^3$ grid and then transformed to Fourier space to obtain $\\hat{\\boldsymbol{u}}(\\boldsymbol{\\kappa},0)$.\n\nAt times $t=0, t_{\\text{mid}}, t_{\\text{final}}$, the following quantities are computed:\n- **Total Kinetic Energy**: Using Parseval's theorem, it is computed in Fourier space. The problem's definition for $\\mathcal{K}(t)$ relates to the sum over Fourier modes as:\n  $$\n  \\mathcal{K}(t) = \\frac{1}{2N^6} \\sum_{\\boldsymbol{\\kappa}} \\left( |\\hat{u}(\\boldsymbol{\\kappa},t)|^2 + |\\hat{v}(\\boldsymbol{\\kappa},t)|^2 + |\\hat{w}(\\boldsymbol{\\kappa},t)|^2 \\right)\n  $$\n- **Kinetic Energy Spectrum $E(k,t)$**: The discrete kinetic energy in Fourier space is binned into spherical shells based on the integer wavenumber magnitude $k = \\text{round}(\\|\\boldsymbol{\\kappa}\\|)$.\n  $$\n  E(k,t) = \\frac{1}{2N^3} \\sum_{\\boldsymbol{\\kappa} \\text{ s.t. round}(\\|\\boldsymbol{\\kappa}\\|)=k} \\left( |\\hat{u}(\\boldsymbol{\\kappa},t)|^2 + |\\hat{v}(\\boldsymbol{\\kappa},t)|^2 + |\\hat{w}(\\boldsymbol{\\kappa},t)|^2 \\right)\n  $$\n- **Spectral Centroid $C(t)$**: This is the energy-weighted average wavenumber:\n  $$\n  C(t) = \\frac{\\sum_{k=1}^{k_{\\max}} k\\, E(k,t)}{\\sum_{k=1}^{k_{\\max}} E(k,t)}\n  $$\n  where $k_{\\max}$ is the largest integer shell index reachable on the dealiased grid, which is $k_{\\max} = \\text{round}(\\sqrt{3 K_c^2})$. For $N=32$, $K_c=10$, so $k_{\\max}=17$.\n- **Peak Shell Index $K$**: The integer wavenumber $k$ at which $E(k,t)$ is maximum.\n\nThese computed quantities are then used to determine the booleans $B_1 = (C(t_{\\mathrm{mid}}) > C(0))$ and $B_2 = (\\mathcal{K}(t_{\\mathrm{final}})  \\mathcal{K}(0))$, and the peak indices $K_0, K_{\\mathrm{mid}}, K_{\\mathrm{final}}$. The initial condition excites only modes with $\\|\\boldsymbol{\\kappa}\\| = \\sqrt{3} \\approx 1.732$, so they fall into shell $k=2$, yielding an expected value of $K_0=2$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef run_dns(N, U0, nu, dt, t_mid, t_final):\n    \"\"\"\n    Performs a Direct Numerical Simulation of the 3D Taylor-Green vortex decay.\n    \"\"\"\n    # 1. Grid and Wavenumber Setup\n    L = 2 * np.pi\n    x = np.linspace(0, L, N, endpoint=False)\n    y = np.linspace(0, L, N, endpoint=False)\n    z = np.linspace(0, L, N, endpoint=False)\n    X, Y, Z = np.meshgrid(x, y, z, indexing='ij')\n\n    k = np.fft.fftfreq(N, d=L / (2 * np.pi * N))\n    Kx, Ky, Kz = np.meshgrid(k, k, k, indexing='ij')\n    K_sq = Kx**2 + Ky**2 + Kz**2\n    \n    # Dealiasing mask (2/3 rule)\n    K_c = math.floor(N / 3.0)\n    dealias_mask = (np.abs(Kx) = K_c)  (np.abs(Ky) = K_c)  (np.abs(Kz) = K_c)\n    \n    # Wavenumber magnitudes for shell binning\n    K_mag = np.sqrt(K_sq)\n    k_max = int(np.round(np.sqrt(3 * K_c**2)))\n    K_mag_rounded = np.round(K_mag).astype(int)\n    \n    # 2. Initial Conditions\n    u0 = U0 * np.sin(X) * np.cos(Y) * np.cos(Z)\n    v0 = -U0 * np.cos(X) * np.sin(Y) * np.cos(Z)\n    w0 = np.zeros_like(u0)\n\n    u_hat = np.fft.fftn(u0)\n    v_hat = np.fft.fftn(v0)\n    w_hat = np.fft.fftn(w0)\n\n    # 3. Helper Functions\n    def calculate_nonlinear_term(u_h, v_h, w_h):\n        ikx, iky, ikz = 1j * Kx, 1j * Ky, 1j * Kz\n\n        u = np.fft.ifftn(u_h)\n        v = np.fft.ifftn(v_h)\n        w = np.fft.ifftn(w_h)\n\n        du_dx = np.fft.ifftn(ikx * u_h)\n        du_dy = np.fft.ifftn(iky * u_h)\n        du_dz = np.fft.ifftn(ikz * u_h)\n        dv_dx = np.fft.ifftn(ikx * v_h)\n        dv_dy = np.fft.ifftn(iky * v_h)\n        dv_dz = np.fft.ifftn(ikz * v_h)\n        dw_dx = np.fft.ifftn(ikx * w_h)\n        dw_dy = np.fft.ifftn(iky * w_h)\n        dw_dz = np.fft.ifftn(ikz * w_h)\n\n        nl_u = u * du_dx + v * du_dy + w * du_dz\n        nl_v = u * dv_dx + v * dv_dy + w * dv_dz\n        nl_w = u * dw_dx + v * dw_dy + w * dw_dz\n\n        nl_u_hat = np.fft.fftn(nl_u) * dealias_mask\n        nl_v_hat = np.fft.fftn(nl_v) * dealias_mask\n        nl_w_hat = np.fft.fftn(nl_w) * dealias_mask\n\n        # Projection\n        k_sq_inv = np.divide(1.0, K_sq, out=np.zeros_like(K_sq), where=K_sq!=0)\n        k_dot_nl = Kx * nl_u_hat + Ky * nl_v_hat + Kz * nl_w_hat\n        \n        N_u_proj_hat = nl_u_hat - k_dot_nl * k_sq_inv * Kx\n        N_v_proj_hat = nl_v_hat - k_dot_nl * k_sq_inv * Ky\n        N_w_proj_hat = nl_w_hat - k_dot_nl * k_sq_inv * Kz\n\n        return -N_u_proj_hat, -N_v_proj_hat, -N_w_proj_hat\n\n    def analyze_state(u_h, v_h, w_h):\n        kin_energy_hat = 0.5 * (np.abs(u_h)**2 + np.abs(v_h)**2 + np.abs(w_h)**2)\n        \n        total_kin_energy = np.sum(kin_energy_hat) / (N**6)\n        \n        E_k = np.zeros(k_max + 1)\n        for k_shell in range(1, k_max + 1):\n            mask = (K_mag_rounded == k_shell)\n            E_k[k_shell] = np.sum(kin_energy_hat[mask]) / (N**3)\n        \n        sum_E_k = np.sum(E_k[1:])\n        if sum_E_k == 0:\n            centroid = 0.0\n        else:\n            k_vals = np.arange(1, k_max + 1)\n            centroid = np.sum(k_vals * E_k[1:]) / sum_E_k\n            \n        if np.all(E_k[1:] == 0):\n             peak_k = 0\n        else:\n             peak_k = np.argmax(E_k[1:]) + 1\n\n        return total_kin_energy, centroid, peak_k\n\n    # 4. Time Integration\n    t = 0.0\n    n_steps = int(np.ceil(t_final / dt))\n    \n    # Analysis at t=0\n    K0, C0, K_peak0 = analyze_state(u_hat, v_hat, w_hat)\n    \n    # Storage for results\n    results = {'K0': K_peak0, 'C0': C0}\n\n    # Starter step (1st-order semi-implicit)\n    Nu0_hat, Nv0_hat, Nw0_hat = calculate_nonlinear_term(u_hat, v_hat, w_hat)\n    \n    # Precompute viscous term factors for starter\n    visc_factor_starter = 1.0 / (1.0 + nu * K_sq * dt)\n    u_hat_n1 = visc_factor_starter * (u_hat + dt * Nu0_hat)\n    v_hat_n1 = visc_factor_starter * (v_hat + dt * Nv0_hat)\n    w_hat_n1 = visc_factor_starter * (w_hat + dt * Nw0_hat)\n\n    # Apply dealiasing to the state\n    u_hat_n1 *= dealias_mask\n    v_hat_n1 *= dealias_mask\n    w_hat_n1 *= dealias_mask\n\n    # Update for next step\n    u_hat = u_hat_n1\n    v_hat = v_hat_n1\n    w_hat = w_hat_n1\n    N_u_hat_old, N_v_hat_old, N_w_hat_old = Nu0_hat, Nv0_hat, Nw0_hat\n    t += dt\n\n    # Check for analysis at step 1\n    if abs(t - t_mid)  dt / 2:\n        _, C_mid, K_mid = analyze_state(u_hat, v_hat, w_hat)\n        results['C_mid'] = C_mid\n        results['K_mid'] = K_mid\n    if abs(t - t_final)  dt / 2:\n        K_final, _, K_peak_final = analyze_state(u_hat, v_hat, w_hat)\n        results['K_final'] = K_final\n        results['K_peak_final'] = K_peak_final\n\n    # Precompute viscous factors for AB2/CN main loop\n    visc_factor1 = (1.0 - 0.5 * nu * K_sq * dt) / (1.0 + 0.5 * nu * K_sq * dt)\n    visc_factor2 = dt / (1.0 + 0.5 * nu * K_sq * dt)\n\n    # Main loop (2nd-order AB2/CN)\n    for n in range(1, n_steps):\n        Nu_hat, Nv_hat, Nw_hat = calculate_nonlinear_term(u_hat, v_hat, w_hat)\n        \n        nl_term_u = 1.5 * Nu_hat - 0.5 * N_u_hat_old\n        nl_term_v = 1.5 * Nv_hat - 0.5 * N_v_hat_old\n        nl_term_w = 1.5 * Nw_hat - 0.5 * N_w_hat_old\n        \n        u_hat_n1 = visc_factor1 * u_hat + visc_factor2 * nl_term_u\n        v_hat_n1 = visc_factor1 * v_hat + visc_factor2 * nl_term_v\n        w_hat_n1 = visc_factor1 * w_hat + visc_factor2 * nl_term_w\n\n        # Apply dealiasing to the state\n        u_hat_n1 *= dealias_mask\n        v_hat_n1 *= dealias_mask\n        w_hat_n1 *= dealias_mask\n\n        # Update for next step\n        u_hat, v_hat, w_hat = u_hat_n1, v_hat_n1, w_hat_n1\n        N_u_hat_old, N_v_hat_old, N_w_hat_old = Nu_hat, Nv_hat, Nw_hat\n        t += dt\n\n        if abs(t - t_mid)  dt / 2:\n            _, C_mid, K_mid = analyze_state(u_hat, v_hat, w_hat)\n            results['C_mid'] = C_mid\n            results['K_mid'] = K_mid\n        if abs(t - t_final)  dt / 2:\n            K_final, _, K_peak_final = analyze_state(u_hat, v_hat, w_hat)\n            results['K_final'] = K_final\n            results['K_peak_final'] = K_peak_final\n\n    # 5. Final Calculations\n    B1 = results.get('C_mid', 0) > results['C0']\n    B2 = results.get('K_final', K0)  K0\n    K0_peak = results['K0']\n    K_mid_peak = results.get('K_mid', 0)\n    K_final_peak = results.get('K_peak_final', 0)\n    \n    return [B1, B2, K0_peak, K_mid_peak, K_final_peak]\n\ndef solve():\n    \"\"\"\n    Main solver function that runs the test suite.\n    \"\"\"\n    test_cases = [\n        {'N': 32, 'U0': 1.0, 'nu': 0.01, 'dt': 0.005, 't_mid': 0.20, 't_final': 0.60},\n        {'N': 32, 'U0': 1.0, 'nu': 0.10, 'dt': 0.005, 't_mid': 0.10, 't_final': 0.30},\n        {'N': 32, 'U0': 1.0, 'nu': 0.005, 'dt': 0.004, 't_mid': 0.30, 't_final': 0.80},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_dns(**case)\n        results.append(result)\n\n    # Convert list of lists to the required string format\n    result_str = ','.join(map(str, results))\n    print(f\"[{result_str}]\")\n\nsolve()\n\n```", "id": "3370566"}]}