{"hands_on_practices": [{"introduction": "This first exercise forms the bedrock of our practical understanding of numerical schemes. We will dissect the classic first-order upwind method, starting from its basic formulation to prove its fundamental property of discrete conservation. Through the powerful technique of modified equation analysis, you will then uncover the scheme's hidden 'artificial diffusion' term, providing a direct mathematical link between the discretization and its actual dissipative behavior [@problem_id:3292605].", "problem": "Consider the one-dimensional linear advection equation $u_{t} + a\\,u_{x} = 0$ with constant wave speed $a0$ on a periodic domain, discretized on a uniform grid $x_{i} = i\\,\\Delta x$ and time levels $t_{n} = n\\,\\Delta t$. Define the Courant–Friedrichs–Lewy (CFL) number $\\nu = a\\,\\Delta t/\\Delta x$. The explicit first-order upwind method for $a0$ updates cell-centered values $u_{i}^{n}$ to $u_{i}^{n+1}$ by differencing in the upstream direction.\n\nStarting from these fundamentals and without invoking any pre-stated flux formula:\n- Derive a flux-difference representation of the update of the form $u_{i}^{n+1} = u_{i}^{n} - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^{\\,n} - F_{i-1/2}^{\\,n}\\right)$ and identify the consistent numerical flux $F_{i+1/2}^{\\,n}$ for $a0$.\n- Using only this flux-difference form and the periodic boundary condition, establish the discrete conservation of the total mass by evaluating $M^{n+1} - M^{n}$, where $M^{n} = \\sum_{i} u_{i}^{n}\\,\\Delta x$, and explain the mechanism responsible for conservation.\n- Perform a formal modified equation analysis up to and including terms of order $\\mathcal{O}(\\Delta x, \\Delta t)$ to determine the leading artificial diffusion coefficient $D_{\\mathrm{art}}$ such that the numerical solution satisfies $u_{t} + a\\,u_{x} = D_{\\mathrm{art}}\\,u_{xx} + \\text{higher-order terms}$.\n\nProvide your final answer as a single closed-form symbolic expression for $D_{\\mathrm{art}}$ in terms of $a$, $\\Delta x$, and $\\Delta t$. Do not include units, and do not evaluate numerically.", "solution": "The problem statement has been validated and is deemed sound. It is a standard, well-posed problem in the field of numerical analysis for partial differential equations, specifically computational fluid dynamics. It is scientifically grounded, objective, and contains all necessary information to proceed with a unique and meaningful solution.\n\nThe analysis proceeds in three parts as requested: derivation of the flux-difference form, demonstration of discrete mass conservation, and a modified equation analysis to find the artificial diffusion coefficient.\n\n### Part 1: Derivation of the Flux-Difference Form\n\nThe one-dimensional linear advection equation is given by:\n$$u_{t} + a\\,u_{x} = 0$$\nwhere the wave speed $a$ is a positive constant ($a0$).\n\nWe discretize this equation on a uniform grid with spacing $\\Delta x$ and time step $\\Delta t$. The value of the solution at grid point $x_i = i\\,\\Delta x$ and time $t_n = n\\,\\Delta t$ is denoted by $u_i^n$.\n\nA forward difference scheme is used for the time derivative:\n$$u_t \\approx \\frac{u_{i}^{n+1} - u_{i}^{n}}{\\Delta t}$$\n\nFor the spatial derivative $u_x$, the first-order upwind method is employed. Since $a  0$, the wave propagates from left to right, so the \"upwind\" direction is to the left of point $x_i$. Therefore, we use a first-order backward difference:\n$$u_x \\approx \\frac{u_{i}^{n} - u_{i-1}^{n}}{\\Delta x}$$\n\nSubstituting these discretizations into the partial differential equation yields the finite difference equation for the first-order upwind scheme:\n$$\\frac{u_{i}^{n+1} - u_{i}^{n}}{\\Delta t} + a\\left(\\frac{u_{i}^{n} - u_{i-1}^{n}}{\\Delta x}\\right) = 0$$\n\nRearranging to solve for $u_i^{n+1}$:\n$$u_{i}^{n+1} = u_{i}^{n} - \\frac{a\\,\\Delta t}{\\Delta x}\\left(u_{i}^{n} - u_{i-1}^{n}\\right)$$\n\nWe are asked to express this in the flux-difference form:\n$$u_{i}^{n+1} = u_{i}^{n} - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^{\\,n} - F_{i-1/2}^{\\,n}\\right)$$\n\nComparing the two expressions for $u_i^{n+1}$, we can equate the terms multiplying $\\frac{\\Delta t}{\\Delta x}$:\n$$F_{i+1/2}^{\\,n} - F_{i-1/2}^{\\,n} = a\\left(u_{i}^{n} - u_{i-1}^{n}\\right) = a\\,u_{i}^{n} - a\\,u_{i-1}^{n}$$\n\nBy inspection, we can identify the numerical flux function $F$ at a cell interface. The flux at the interface $j+1/2$ (between cells $j$ and $j+1$) is given by:\n$$F_{j+1/2}^{\\,n} = a\\,u_{j}^{n}$$\nThis is the upwind flux, which, for $a0$, selects the value from the \"up\" stream state, which is the left state $u_j^n$. Applying this identification to our difference equation:\n- The flux at the right boundary of cell $i$ (interface $i+1/2$) is $F_{i+1/2}^{\\,n} = a\\,u_{i}^{n}$.\n- The flux at the left boundary of cell $i$ (interface $i-1/2$) is $F_{i-1/2}^{\\,n} = a\\,u_{i-1}^{n}$.\n\nSubstituting these into the flux-difference form correctly reproduces the scheme. Thus, the consistent numerical flux for the first-order upwind scheme with $a0$ is $F_{i+1/2}^{\\,n} = a\\,u_{i}^{n}$.\n\n### Part 2: Discrete Mass Conservation\n\nThe total discrete mass at time $t_n$ is defined as $M^{n} = \\sum_{i} u_{i}^{n}\\,\\Delta x$, where the summation is over all grid cells in the periodic domain. Let the domain consist of $N$ cells, indexed from $i=1$ to $N$.\n\nThe change in total mass from time $t_n$ to $t_{n+1}$ is:\n$$M^{n+1} - M^{n} = \\sum_i u_{i}^{n+1}\\,\\Delta x - \\sum_i u_{i}^{n}\\,\\Delta x = \\Delta x \\sum_i \\left(u_{i}^{n+1} - u_{i}^{n}\\right)$$\n\nUsing the flux-difference form derived in Part 1:\n$$u_{i}^{n+1} - u_{i}^{n} = -\\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^{\\,n} - F_{i-1/2}^{\\,n}\\right)$$\n\nSubstituting this into the expression for the change in mass:\n$$M^{n+1} - M^{n} = \\Delta x \\sum_{i=1}^{N} \\left[-\\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^{\\,n} - F_{i-1/2}^{\\,n}\\right)\\right] = -\\Delta t \\sum_{i=1}^{N} \\left(F_{i+1/2}^{\\,n} - F_{i-1/2}^{\\,n}\\right)$$\n\nThe summation on the right-hand side is a telescoping sum:\n$$\\sum_{i=1}^{N} \\left(F_{i+1/2}^{\\,n} - F_{i-1/2}^{\\,n}\\right) = (F_{3/2}^{\\,n} - F_{1/2}^{\\,n}) + (F_{5/2}^{\\,n} - F_{3/2}^{\\,n}) + \\dots + (F_{N+1/2}^{\\,n} - F_{N-1/2}^{\\,n})$$\nThis simplifies to:\n$$\\sum_{i=1}^{N} \\left(F_{i+1/2}^{\\,n} - F_{i-1/2}^{\\,n}\\right) = F_{N+1/2}^{\\,n} - F_{1/2}^{\\,n}$$\n\nThe domain is periodic, which implies that the grid point $i=0$ is equivalent to $i=N$, and $i=N+1$ is equivalent to $i=1$. Thus, the state $u_0^n = u_N^n$. The flux $F_{i+1/2}^{\\,n}$ is defined as $a\\,u_i^n$.\nTherefore:\n-   $F_{N+1/2}^{\\,n} = a\\,u_{N}^{n}$\n-   $F_{1/2}^{\\,n} = a\\,u_{0}^{n}$\n\nDue to the periodic boundary condition $u_0^n = u_N^n$, we have $F_{1/2}^{\\,n} = F_{N+1/2}^{\\,n}$. The telescoping sum evaluates to zero:\n$$\\sum_{i=1}^{N} \\left(F_{i+1/2}^{\\,n} - F_{i-1/2}^{\\,n}\\right) = a\\,u_{N}^{n} - a\\,u_{0}^{n} = 0$$\n\nConsequently, the change in total mass is zero:\n$$M^{n+1} - M^{n} = -\\Delta t \\times 0 = 0$$\nThis proves that $M^{n+1} = M^n$, and the total mass is conserved by the scheme at each time step.\n\nThe mechanism for conservation is the flux-conservative form of the discretization. The change in the quantity $u$ in any cell is exactly accounted for by the net flux of $u$ across its boundaries. When summed over the entire domain, the fluxes at all internal interfaces cancel out. The periodic boundary condition ensures that the flux leaving the domain's end boundary is identical to the flux entering its start boundary, leading to a perfect balance and zero net change in the total integrated quantity.\n\n### Part 3: Modified Equation Analysis\n\nWe start with the discrete update equation:\n$$\\frac{u_{i}^{n+1} - u_{i}^{n}}{\\Delta t} + a \\frac{u_{i}^{n} - u_{i-1}^{n}}{\\Delta x} = 0$$\n\nTo find the modified equation, we perform Taylor series expansions of $u_i^{n+1}$ and $u_{i-1}^n$ around the point $(x_i, t_n)$, assuming $u$ is a sufficiently smooth function. Let $u(x_i, t_n)$ and its derivatives be denoted by $u, u_t, u_x, u_{tt}, u_{xx}$, etc.\n\nExpansion in time for $u_i^{n+1} = u(x_i, t_n + \\Delta t)$:\n$$u_i^{n+1} = u + \\Delta t\\, u_t + \\frac{(\\Delta t)^2}{2} u_{tt} + \\mathcal{O}(\\Delta t^3)$$\n\nExpansion in space for $u_{i-1}^n = u(x_i - \\Delta x, t_n)$:\n$$u_{i-1}^n = u - \\Delta x\\, u_x + \\frac{(\\Delta x)^2}{2} u_{xx} - \\frac{(\\Delta x)^3}{6} u_{xxx} + \\mathcal{O}(\\Delta x^4)$$\n\nSubstitute these expansions into the discrete scheme:\n$$\\frac{1}{\\Delta t}\\left( \\Delta t\\, u_t + \\frac{(\\Delta t)^2}{2} u_{tt} + \\dots \\right) + \\frac{a}{\\Delta x}\\left( u - \\left(u - \\Delta x\\, u_x + \\frac{(\\Delta x)^2}{2} u_{xx} + \\dots \\right) \\right) = 0$$\n$$\\left( u_t + \\frac{\\Delta t}{2} u_{tt} + \\dots \\right) + \\frac{a}{\\Delta x}\\left( \\Delta x\\, u_x - \\frac{(\\Delta x)^2}{2} u_{xx} + \\dots \\right) = 0$$\n$$u_t + \\frac{\\Delta t}{2} u_{tt} + a\\, u_x - \\frac{a\\,\\Delta x}{2} u_{xx} + \\mathcal{O}(\\Delta t^2, (\\Delta x)^2) = 0$$\n\nRearranging the terms gives the \"truncated differential equation\":\n$$u_t + a\\, u_x = \\frac{a\\,\\Delta x}{2} u_{xx} - \\frac{\\Delta t}{2} u_{tt} + \\text{H.O.T.}$$\nwhere H.O.T. stands for higher-order terms. This equation reveals the truncation error of the scheme.\n\nTo obtain the \"modified equation,\" which better represents the behavior of the numerical solution, we must eliminate higher-order time derivatives (like $u_{tt}$) in favor of spatial derivatives. We do this by repeatedly differentiating the equation itself and substituting back.\nFrom the lowest-order approximation of our equation, which is the original PDE, we have $u_t = -a\\,u_x + \\mathcal{O}(\\Delta x, \\Delta t)$.\nDifferentiating with respect to time:\n$$u_{tt} = \\frac{\\partial}{\\partial t} (-a\\,u_x + \\dots) = -a\\,u_{xt} = -a\\,\\frac{\\partial}{\\partial x}(u_t)$$\nNow substitute $u_t = -a\\,u_x + \\dots$ again:\n$$u_{tt} = -a\\,\\frac{\\partial}{\\partial x}(-a\\,u_x + \\dots) = a^2 u_{xx} + \\mathcal{O}(\\Delta x, \\Delta t)$$\n\nNow, we substitute this expression for $u_{tt}$ back into the truncated differential equation:\n$$u_t + a\\, u_x = \\frac{a\\,\\Delta x}{2} u_{xx} - \\frac{\\Delta t}{2} \\left(a^2 u_{xx} + \\mathcal{O}(\\Delta x, \\Delta t)\\right) + \\text{H.O.T.}$$\n$$u_t + a\\, u_x = \\frac{a\\,\\Delta x}{2} u_{xx} - \\frac{a^2 \\Delta t}{2} u_{xx} + \\text{H.O.T.}$$\n\nCombining the terms with the second spatial derivative $u_{xx}$:\n$$u_t + a\\,u_x = \\left(\\frac{a\\,\\Delta x}{2} - \\frac{a^2 \\Delta t}{2}\\right) u_{xx} + \\text{H.O.T.}$$\n\nThis is the modified equation up to the second-order derivative term. The leading error term has the form of a diffusion term, $D_{\\mathrm{art}}\\,u_{xx}$. By comparing our result with the target form $u_t + a\\,u_x = D_{\\mathrm{art}}\\,u_{xx} + \\text{H.O.T.}$, we identify the artificial diffusion coefficient as:\n$$D_{\\mathrm{art}} = \\frac{a\\,\\Delta x}{2} - \\frac{a^2 \\Delta t}{2}$$\nThis term is responsible for the numerical dissipation inherent in the first-order upwind scheme.", "answer": "$$\\boxed{\\frac{a\\,\\Delta x}{2} - \\frac{a^{2}\\,\\Delta t}{2}}$$", "id": "3292605"}, {"introduction": "Building on our analysis, this practice explores how the choice of time integration impacts numerical errors. By deriving and comparing the modified equations for both explicit and implicit versions of the upwind scheme, you will quantify how each approach alters the artificial diffusion. This exercise reveals the crucial trade-offs between numerical stability, computational cost, and the accuracy of the solution, which are central considerations in designing CFD solvers [@problem_id:3292657].", "problem": "Consider the one-dimensional linear advection equation $u_{t} + a\\,u_{x} = 0$ for a constant positive wave speed $a0$ on a uniform grid with spatial step $\\Delta x$ and time step $\\Delta t$. Define the Courant–Friedrichs–Lewy (CFL) number as $r = a\\,\\Delta t / \\Delta x$. Two first-order upwind finite difference schemes are considered:\n\n1. An explicit scheme that uses forward Euler in time and backward (upwind) difference in space, formulated as $u^{n+1}_{i} = u^{n}_{i} - r\\left(u^{n}_{i} - u^{n}_{i-1}\\right)$.\n\n2. An implicit scheme that uses backward Euler in time and backward (upwind) difference in space, formulated as $u^{n+1}_{i} = u^{n}_{i} - r\\left(u^{n+1}_{i} - u^{n+1}_{i-1}\\right)$.\n\nStarting from the continuous advection equation, and using Taylor series expansions consistent with the order of each scheme, derive the modified equation for each scheme by retaining terms up to and including those that multiply $u_{xx}$ and $u_{xxx}$. From these modified equations, identify the leading artificial diffusion coefficients $D_{\\text{exp}}$ and $D_{\\text{imp}}$ (the coefficients of $u_{xx}$) and the leading dispersive coefficients $E_{\\text{exp}}$ and $E_{\\text{imp}}$ (the coefficients of $u_{xxx}$), each expressed in terms of $a$, $\\Delta x$, and $r$.\n\nAt a fixed CFL number $r \\in (0,1]$, compute the ratio $D_{\\text{imp}}/D_{\\text{exp}}$ as a closed-form expression in $r$. Express your final answer as a single analytic expression without units. No rounding is required.", "solution": "The fundamental base is the continuous advection equation $u_{t} + a\\,u_{x} = 0$. The modified equation analysis proceeds by expanding the discrete scheme about a common point in space and time and recasting the discrete update as an equivalent continuous partial differential equation with additional terms that represent truncation errors. These additional terms appear as artificial diffusion (proportional to $u_{xx}$) and dispersion (proportional to $u_{xxx}$).\n\nWe first recall the time derivatives implied by the advection equation. Differentiating $u_{t} = -a\\,u_{x}$ with respect to time and using commutativity of mixed partials gives\n$$\nu_{tt} = \\partial_{t}(-a\\,u_{x}) = -a\\,u_{xt} = -a\\,\\partial_{x}u_{t} = -a\\,\\partial_{x}(-a\\,u_{x}) = a^{2}\\,u_{xx}.\n$$\nSimilarly,\n$$\nu_{ttt} = \\partial_{t}(u_{tt}) = \\partial_{t}(a^{2}\\,u_{xx}) = a^{2}\\,\\partial_{t}u_{xx} = a^{2}\\,\\partial_{x}^{2}u_{t} = a^{2}\\,\\partial_{x}^{2}(-a\\,u_{x}) = -a^{3}\\,u_{xxx}.\n$$\n\nExplicit upwind (forward Euler in time, backward difference in space):\nThe scheme is\n$$\nu^{n+1}_{i} = u^{n}_{i} - r\\left(u^{n}_{i} - u^{n}_{i-1}\\right), \\quad r = \\frac{a\\,\\Delta t}{\\Delta x}.\n$$\nDivide by $\\Delta t$ to write\n$$\n\\frac{u^{n+1}_{i} - u^{n}_{i}}{\\Delta t} = -a\\,\\frac{u^{n}_{i} - u^{n}_{i-1}}{\\Delta x}.\n$$\nExpand the left side about $(x_{i},t_{n})$ using a forward time Taylor series:\n$$\n\\frac{u^{n+1}_{i} - u^{n}_{i}}{\\Delta t} = u_{t} + \\frac{\\Delta t}{2}\\,u_{tt} + \\frac{\\Delta t^{2}}{6}\\,u_{ttt} + \\mathcal{O}(\\Delta t^{3}).\n$$\nExpand the backward spatial difference at time $t_{n}$:\n$$\n\\frac{u^{n}_{i} - u^{n}_{i-1}}{\\Delta x} = u_{x} - \\frac{\\Delta x}{2}\\,u_{xx} + \\frac{\\Delta x^{2}}{6}\\,u_{xxx} + \\mathcal{O}(\\Delta x^{3}).\n$$\nTherefore,\n$$\nu_{t} + \\frac{\\Delta t}{2}\\,u_{tt} + \\frac{\\Delta t^{2}}{6}\\,u_{ttt} = -a\\,u_{x} + \\frac{a\\,\\Delta x}{2}\\,u_{xx} - \\frac{a\\,\\Delta x^{2}}{6}\\,u_{xxx} + \\cdots.\n$$\nSubstitute $u_{tt} = a^{2}\\,u_{xx}$ and $u_{ttt} = -a^{3}\\,u_{xxx}$:\n$$\nu_{t} + \\frac{a^{2}\\,\\Delta t}{2}\\,u_{xx} - \\frac{a^{3}\\,\\Delta t^{2}}{6}\\,u_{xxx} = -a\\,u_{x} + \\frac{a\\,\\Delta x}{2}\\,u_{xx} - \\frac{a\\,\\Delta x^{2}}{6}\\,u_{xxx} + \\cdots.\n$$\nMove $-a\\,u_{x}$ to the left to obtain the modified equation in the canonical form $u_{t} + a\\,u_{x} = D_{\\text{exp}}\\,u_{xx} + E_{\\text{exp}}\\,u_{xxx} + \\cdots$:\n$$\nu_{t} + a\\,u_{x} = \\left(\\frac{a\\,\\Delta x}{2} - \\frac{a^{2}\\,\\Delta t}{2}\\right)u_{xx} + \\left(-\\frac{a\\,\\Delta x^{2}}{6} + \\frac{a^{3}\\,\\Delta t^{2}}{6}\\right)u_{xxx} + \\cdots.\n$$\nUse $a\\,\\Delta t = r\\,\\Delta x$ to express coefficients in terms of $r$:\n$$\nD_{\\text{exp}} = \\frac{a\\,\\Delta x}{2}\\,(1 - r), \\qquad E_{\\text{exp}} = \\frac{a\\,\\Delta x^{2}}{6}\\,(r^{2} - 1).\n$$\n\nImplicit upwind (backward Euler in time, backward difference in space at $t^{n+1}$):\nThe scheme is\n$$\n\\frac{u^{n+1}_{i} - u^{n}_{i}}{\\Delta t} = -a\\,\\frac{u^{n+1}_{i} - u^{n+1}_{i-1}}{\\Delta x}.\n$$\nExpand the left side about $(x_{i},t_{n+1})$ using a backward time Taylor series:\n$$\n\\frac{u^{n+1}_{i} - u^{n}_{i}}{\\Delta t} = u_{t} - \\frac{\\Delta t}{2}\\,u_{tt} + \\frac{\\Delta t^{2}}{6}\\,u_{ttt} + \\mathcal{O}(\\Delta t^{3}).\n$$\nExpand the backward spatial difference at time $t_{n+1}$:\n$$\n\\frac{u^{n+1}_{i} - u^{n+1}_{i-1}}{\\Delta x} = u_{x} - \\frac{\\Delta x}{2}\\,u_{xx} + \\frac{\\Delta x^{2}}{6}\\,u_{xxx} + \\mathcal{O}(\\Delta x^{3}).\n$$\nThus,\n$$\nu_{t} - \\frac{\\Delta t}{2}\\,u_{tt} + \\frac{\\Delta t^{2}}{6}\\,u_{ttt} = -a\\,u_{x} + \\frac{a\\,\\Delta x}{2}\\,u_{xx} - \\frac{a\\,\\Delta x^{2}}{6}\\,u_{xxx} + \\cdots.\n$$\nSubstitute $u_{tt} = a^{2}\\,u_{xx}$ and $u_{ttt} = -a^{3}\\,u_{xxx}$:\n$$\nu_{t} - \\frac{a^{2}\\,\\Delta t}{2}\\,u_{xx} - \\frac{a^{3}\\,\\Delta t^{2}}{6}\\,u_{xxx} = -a\\,u_{x} + \\frac{a\\,\\Delta x}{2}\\,u_{xx} - \\frac{a\\,\\Delta x^{2}}{6}\\,u_{xxx} + \\cdots.\n$$\nMove $-a\\,u_{x}$ to the left and collect terms:\n$$\nu_{t} + a\\,u_{x} = \\left(\\frac{a\\,\\Delta x}{2} + \\frac{a^{2}\\,\\Delta t}{2}\\right)u_{xx} + \\left(-\\frac{a\\,\\Delta x^{2}}{6} + \\frac{a^{3}\\,\\Delta t^{2}}{6}\\right)u_{xxx} + \\cdots.\n$$\nAgain, using $a\\,\\Delta t = r\\,\\Delta x$ gives\n$$\nD_{\\text{imp}} = \\frac{a\\,\\Delta x}{2}\\,(1 + r), \\qquad E_{\\text{imp}} = \\frac{a\\,\\Delta x^{2}}{6}\\,(r^{2} - 1).\n$$\n\nComparison at fixed $r$:\n- Artificial diffusion: $D_{\\text{exp}} = (a\\,\\Delta x/2)(1 - r)$ and $D_{\\text{imp}} = (a\\,\\Delta x/2)(1 + r)$. For $r \\in (0,1]$, $D_{\\text{imp}}  D_{\\text{exp}}$, reflecting the stronger damping of high-frequency content by the implicit upwind scheme.\n- Dispersive term: $E_{\\text{exp}} = E_{\\text{imp}} = (a\\,\\Delta x^{2}/6)(r^{2} - 1)$, so both schemes share the same leading-order dispersive error sign and magnitude at a given $r$.\n\nThe requested ratio is\n$$\n\\frac{D_{\\text{imp}}}{D_{\\text{exp}}} = \\frac{(a\\,\\Delta x/2)(1 + r)}{(a\\,\\Delta x/2)(1 - r)} = \\frac{1 + r}{1 - r}.\n$$\n\nAccuracy and diffusion trade-offs at fixed $r$:\nBoth schemes are first-order accurate in time and space. At fixed $r$, the implicit upwind scheme introduces more artificial diffusion by a factor $(1 + r)/(1 - r)$, which can improve robustness and monotonicity but at the expense of stronger amplitude damping and potential smearing of sharp gradients. Since the leading dispersive coefficients coincide, differences in phase error are dominated by higher-order terms; the primary trade-off at fixed $r$ is between stability robustness (implicit) and reduced numerical diffusion (explicit).", "answer": "$$\\boxed{\\frac{1 + r}{1 - r}}$$", "id": "3292657"}, {"introduction": "Moving from analysis to design, this final practice addresses a key challenge in modern CFD: how to apply stabilization selectively. You will implement and tune a 'smoothness sensor' that can distinguish between sharp, under-resolved features and smooth parts of the solution. This computational exercise provides hands-on experience with the core logic behind high-resolution shock-capturing schemes, which aim to add artificial diffusion intelligently to maintain stability without unnecessarily smearing the solution [@problem_id:3292601].", "problem": "You are given a one-dimensional, uniform, periodic grid of length $L=2\\pi$ with $N=4096$ points and grid spacing $h=L/N$. Consider a scalar field $u_i$ defined at grid indices $i\\in\\{0,1,\\dots,N-1\\}$ and the smoothness sensor\n$$\nS_i(\\epsilon)=\\frac{\\left|u_{i+1}-2u_i+u_{i-1}\\right|}{\\left|u_{i+1}-u_{i-1}\\right|+\\epsilon},\n$$\nwhere periodic indexing is used and $\\epsilon0$ is a tunable parameter. This sensor is intended to blend a centered numerical flux and an upwind numerical flux through a weight $w_i=\\min\\left(1,S_i(\\epsilon)/\\tau\\right)$ for a chosen threshold $\\tau0$, with the goal of adding artificial diffusion only where necessary.\n\nStarting from the finite-difference definitions on a uniform grid and the trigonometric properties of sinusoidal waves, analyze the behavior of $S_i(\\epsilon)$ on smooth oscillatory waves of the form $u(x)=\\sin(kx)$ with $k$ an integer wavenumber. Treat angles in radians. Define the false positive rate for a given triple $(\\epsilon,\\tau,k)$ as the fraction of grid indices $i$ for which $S_i(\\epsilon)\\ge \\tau$ when $u(x)=\\sin(kx)$ is sampled on the grid. The objective is to tune $\\epsilon$ to minimize unnecessary artificial diffusion by reducing the false positive rate on smooth oscillatory data, while preserving sensitivity to discontinuities.\n\nImpose the following detection constraint to ensure that the sensor still responds to a sharp discontinuity. Consider the step-like field $u_i=0$ for $i N/2$ and $u_i=1$ for $i\\ge N/2$. Define the detection window $\\{i_0-1,i_0,i_0+1\\}$ with $i_0=N/2$. The detection constraint requires that $\\max\\{S_{i_0-1}(\\epsilon),S_{i_0}(\\epsilon),S_{i_0+1}(\\epsilon)\\}\\ge \\tau$.\n\nYour program must:\n- Use the domain parameters $L=2\\pi$, $N=4096$, and periodic indexing.\n- Use the smooth oscillatory test suite with integer wavenumbers $k\\in\\{1,8,64,512,1536\\}$.\n- For each threshold $\\tau$ in the set $\\{\\;0.3,\\;0.5,\\;0.7\\;\\}$, find the value $\\epsilon^\\star$ in the interval $\\epsilon\\in[10^{-8},10^{-2}]$ that minimizes the average false positive rate across the listed wavenumbers, subject to the detection constraint described above. Search $\\epsilon$ on a logarithmically spaced grid of $61$ points between $10^{-8}$ and $10^{-2}$ inclusive. If multiple $\\epsilon$ attain the same minimal average false positive rate while satisfying the detection constraint, choose the largest such $\\epsilon$.\n- Angles must be treated in radians everywhere.\n\nDefine the false positive rate for given $(\\epsilon,\\tau,k)$ as the mean over all $i\\in\\{0,1,\\dots,N-1\\}$ of the indicator of $S_i(\\epsilon)\\ge \\tau$ on the sampled wave $u_i=\\sin(k x_i)$ with $x_i=ih$.\n\nFinal output specification:\n- For each threshold $\\tau\\in\\{\\;0.3,\\;0.5,\\;0.7\\;\\}$, compute the pair consisting of the chosen $\\epsilon^\\star$ and the corresponding average false positive rate across $k\\in\\{1,8,64,512,1536\\}$. The final program output must be a single line containing a comma-separated list of these results in the order $\\left[\\epsilon^\\star_{\\tau=0.3},\\;\\overline{\\mathrm{FPR}}_{\\tau=0.3},\\;\\epsilon^\\star_{\\tau=0.5},\\;\\overline{\\mathrm{FPR}}_{\\tau=0.5},\\;\\epsilon^\\star_{\\tau=0.7},\\;\\overline{\\mathrm{FPR}}_{\\tau=0.7}\\right]$ enclosed in square brackets. For example, the printed line must have the form \"[result1,result2,result3,result4,result5,result6]\". There must be no additional output lines or text.\n\nAngle units are radians. No physical units are involved in the final numerical answers. All numerical answers are real-valued and must be reported as plain decimal numbers in the specified single-line format.", "solution": "The user-provided problem is a well-posed numerical optimization task within the field of computational fluid dynamics, specifically concerning the tuning of a smoothness sensor for controlling artificial diffusion in numerical schemes. The problem is scientifically grounded, formally specified, and internally consistent. Therefore, it is deemed valid, and a solution will be provided.\n\nThe objective is to find an optimal value of a parameter $\\epsilon$, denoted $\\epsilon^\\star$, for a given set of thresholds $\\tau \\in \\{0.3, 0.5, 0.7\\}$. The optimality criterion is to minimize the average \"false positive rate\" (FPR) on a suite of smooth sinusoidal waves, subject to a \"detection constraint\" that ensures the sensor remains sensitive to sharp discontinuities.\n\nThe core of the problem lies in the behavior of the smoothness sensor $S_i(\\epsilon)$, defined on a one-dimensional periodic grid with $N=4096$ points over a domain of length $L=2\\pi$. The grid points are $x_i = i h$ for $i \\in \\{0, 1, \\dots, N-1\\}$, where the grid spacing is $h = L/N$. The sensor is given by:\n$$\nS_i(\\epsilon) = \\frac{\\left|u_{i+1} - 2u_i + u_{i-1}\\right|}{\\left|u_{i+1} - u_{i-1}\\right| + \\epsilon}\n$$\nHere, indices are periodic, e.g., $u_N = u_0$ and $u_{-1} = u_{N-1}$. The numerator is a finite difference approximation of the unscaled second derivative, $|h^2 u''|$, measuring local curvature. The denominator is related to the unscaled first derivative, $|2h u'|$, measuring the local gradient. The parameter $\\epsilon  0$ regularizes the expression, preventing division by zero where the gradient is null.\n\nThe solution process involves three main steps for each given threshold $\\tau$:\n1.  Analyzing the detection constraint to find the valid range for $\\epsilon$.\n2.  Defining the procedure to calculate the average false positive rate for a candidate $\\epsilon$.\n3.  Executing a search over the specified grid of $\\epsilon$ values to find the one that minimizes the average FPR while respecting the constraint.\n\n### Step 1: Analysis of the Detection Constraint\n\nThe detection constraint ensures that the sensor correctly identifies a sharp discontinuity. It is tested on a step-like field:\n$$\nu_i = \\begin{cases} 0  \\text{for } i  N/2 \\\\ 1  \\text{for } i \\ge N/2 \\end{cases}\n$$\nGiven $N=4096$, the discontinuity is at index $i_0 = N/2 = 2048$. The constraint must be satisfied within the window $\\{i_0-1, i_0, i_0+1\\} = \\{2047, 2048, 2049\\}$, requiring that $\\max\\{S_{2047}(\\epsilon), S_{2048}(\\epsilon), S_{2049}(\\epsilon)\\} \\ge \\tau$.\n\nLet's evaluate the sensor at these three points:\n-   At $i = 2047$: The field values are $u_{2046}=0$, $u_{2047}=0$, $u_{2048}=1$.\n    $$S_{2047}(\\epsilon) = \\frac{|u_{2048} - 2u_{2047} + u_{2046}|}{|u_{2048} - u_{2046}| + \\epsilon} = \\frac{|1 - 2(0) + 0|}{|1 - 0| + \\epsilon} = \\frac{1}{1 + \\epsilon}$$\n-   At $i = 2048$: The field values are $u_{2047}=0$, $u_{2048}=1$, $u_{2049}=1$.\n    $$S_{2048}(\\epsilon) = \\frac{|u_{2049} - 2u_{2048} + u_{2047}|}{|u_{2049} - u_{2047}| + \\epsilon} = \\frac{|1 - 2(1) + 0|}{|1 - 0| + \\epsilon} = \\frac{|-1|}{1 + \\epsilon} = \\frac{1}{1 + \\epsilon}$$\n-   At $i = 2049$: The field values are $u_{2048}=1$, $u_{2049}=1$, $u_{2050}=1$.\n    $$S_{2049}(\\epsilon) = \\frac{|u_{2050} - 2u_{2049} + u_{2048}|}{|u_{2050} - u_{2048}| + \\epsilon} = \\frac{|1 - 2(1) + 1|}{|1 - 1| + \\epsilon} = \\frac{0}{\\epsilon} = 0$$\n\nThe maximum sensor value in the window is $\\frac{1}{1 + \\epsilon}$. The detection constraint is therefore:\n$$\n\\frac{1}{1 + \\epsilon} \\ge \\tau \\implies 1 \\ge \\tau(1 + \\epsilon) \\implies 1 \\ge \\tau + \\tau\\epsilon \\implies 1 - \\tau \\ge \\tau\\epsilon\n$$\nThis gives an upper bound on $\\epsilon$:\n$$ \\epsilon \\le \\frac{1 - \\tau}{\\tau} $$\nAny candidate $\\epsilon$ from the search space must satisfy this inequality.\n\n### Step 2: Calculation of the Average False Positive Rate\n\nA \"false positive\" occurs when the sensor flags a smooth region as being discontinuous, i.e., when $S_i(\\epsilon) \\ge \\tau$. The analysis is performed on a set of smooth sinusoidal waves $u(x) = \\sin(kx)$ for integer wavenumbers $k \\in \\{1, 8, 64, 512, 1536\\}$. The wave is sampled on the grid as $u_i = \\sin(k x_i)$.\n\nFor a given triplet $(\\epsilon, \\tau, k)$, the false positive rate, $\\mathrm{FPR}_k$, is the fraction of grid points where $S_i(\\epsilon) \\ge \\tau$. Numerically, this is computed as:\n1.  Generate the discrete wave $u_i = \\sin(k x_i)$ for $i = 0, \\dots, N-1$.\n2.  Compute the sensor values $S_i(\\epsilon)$ for all $i$ using the discrete formula and periodic indexing for $u_{i\\pm1}$.\n3.  Count the number of indices $i$ for which $S_i(\\epsilon) \\ge \\tau$.\n4.  $\\mathrm{FPR}_k$ is this count divided by the total number of points, $N$. This is equivalent to the mean of a boolean array indicating where the condition is met.\n\nThe objective function to be minimized is the average of these rates over all specified wavenumbers:\n$$\n\\overline{\\mathrm{FPR}}(\\epsilon, \\tau) = \\frac{1}{|\\mathcal{K}|} \\sum_{k \\in \\mathcal{K}} \\mathrm{FPR}_k\n$$\nwhere $\\mathcal{K} = \\{1, 8, 64, 512, 1536\\}$.\n\n### Step 3: Optimization Algorithm\n\nFor each $\\tau \\in \\{0.3, 0.5, 0.7\\}$, we must find the optimal $\\epsilon^\\star$ from a logarithmically spaced grid of $61$ points in the interval $[10^{-8}, 10^{-2}]$.\n\nThe algorithm is as follows:\n1.  Initialize $\\epsilon^\\star = -1$ and a minimum average FPR, $\\overline{\\mathrm{FPR}}_{\\min} = \\infty$.\n2.  Let $\\epsilon_{\\mathrm{max\\_constraint}} = (1 - \\tau) / \\tau$.\n3.  Iterate through each $\\epsilon$ in the search grid, in increasing order.\n4.  For each $\\epsilon$:\n    a. If $\\epsilon  \\epsilon_{\\mathrm{max\\_constraint}}$, this $\\epsilon$ is invalid. Continue to the next one.\n    b. If $\\epsilon$ is valid, compute $\\overline{\\mathrm{FPR}}(\\epsilon, \\tau)$ by averaging the $\\mathrm{FPR}_k$ over all $k \\in \\mathcal{K}$.\n    c. Compare the computed average FPR with the current minimum: If $\\overline{\\mathrm{FPR}}(\\epsilon, \\tau) \\le \\overline{\\mathrm{FPR}}_{\\min}$, update $\\overline{\\mathrm{FPR}}_{\\min} = \\overline{\\mathrm{FPR}}(\\epsilon, \\tau)$ and $\\epsilon^\\star = \\epsilon$. The use of $\\le$ and the ascending order of $\\epsilon$ traversal correctly handles the tie-breaking rule, which requires selecting the largest $\\epsilon$ in case of a tie.\n5.  After checking all $\\epsilon$ values, the pair $(\\epsilon^\\star, \\overline{\\mathrm{FPR}}_{\\min})$ is the result for the given $\\tau$.\n\nThis procedure is repeated for each value of $\\tau$. The final output will be a list containing the pairs $(\\epsilon^\\star, \\overline{\\mathrm{FPR}}_{\\min})$ for $\\tau=0.3, 0.5, 0.7$, formatted as requested. The numerical implementation will use vectorized operations from the `numpy` library for efficiency.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Finds the optimal epsilon to minimize false positives of a smoothness sensor\n    subject to a discontinuity detection constraint.\n    \"\"\"\n\n    # Define the problem parameters and test cases.\n    L = 2.0 * np.pi\n    N = 4096\n    h = L / N\n    k_values = [1, 8, 64, 512, 1536]\n    tau_values = [0.3, 0.5, 0.7]\n    epsilon_values = np.logspace(-8, -2, 61)\n\n    # Pre-calculate grid points once.\n    x_grid = np.arange(N) * h\n\n    # Pre-calculate all sinusoidal waves to be tested.\n    u_waves = {k: np.sin(k * x_grid) for k in k_values}\n\n    final_results = []\n\n    # Main loop over each threshold tau.\n    for tau in tau_values:\n        # Calculate the maximum allowed epsilon from the analytical detection constraint.\n        epsilon_max_constraint = (1.0 - tau) / tau\n\n        min_avg_fpr = float('inf')\n        optimal_epsilon = -1.0\n\n        # Search for the best epsilon on the specified logarithmic grid.\n        for epsilon in epsilon_values:\n            # 1. Check if the current epsilon satisfies the detection constraint.\n            if epsilon > epsilon_max_constraint:\n                continue\n\n            # 2. If valid, calculate the average false positive rate (FPR).\n            fprs_for_current_epsilon = []\n            for k in k_values:\n                u = u_waves[k]\n\n                # Use np.roll for efficient periodic boundary conditions.\n                u_p1 = np.roll(u, -1)\n                u_m1 = np.roll(u, 1)\n\n                # Calculate the smoothness sensor S_i for all grid points.\n                numerator = np.abs(u_p1 - 2 * u + u_m1)\n                denominator = np.abs(u_p1 - u_m1) + epsilon\n\n                # S is a numpy array of sensor values for the current wave.\n                # Denominator is guaranteed to be positive since epsilon > 0.\n                S = numerator / denominator\n\n                # A false positive occurs where S >= tau on the smooth wave.\n                # np.mean on a boolean array gives the fraction of True values.\n                fpr_k = np.mean(S >= tau)\n                fprs_for_current_epsilon.append(fpr_k)\n\n            avg_fpr = np.mean(fprs_for_current_epsilon)\n\n            # 3. Update the optimal epsilon and minimum FPR.\n            # The problem states: \"If multiple epsilon attain the same minimal average\n            # false positive rate..., choose the largest such epsilon.\"\n            # Since epsilon_values are iterated in increasing order, the '='\n            # condition correctly updates to the largest epsilon in case of a tie.\n            if avg_fpr = min_avg_fpr:\n                min_avg_fpr = avg_fpr\n                optimal_epsilon = epsilon\n        \n        final_results.append(optimal_epsilon)\n        final_results.append(min_avg_fpr)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n\n```", "id": "3292601"}]}