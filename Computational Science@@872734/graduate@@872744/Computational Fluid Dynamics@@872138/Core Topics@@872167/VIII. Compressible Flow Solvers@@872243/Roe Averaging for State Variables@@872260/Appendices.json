{"hands_on_practices": [{"introduction": "The stability of explicit numerical methods for hyperbolic systems, such as the Euler equations, is governed by the Courant-Friedrichs-Lewy (CFL) condition. This condition ensures that the numerical domain of dependence contains the physical one, linking the time step $\\Delta t$ to the grid spacing $\\Delta x$ and the maximum local wave speed. In a Roe-type scheme, this maximum speed is determined by the eigenvalues of the Roe-averaged Jacobian, specifically $|\\tilde{u}| + \\tilde{a}$. This exercise provides direct practice in computing these essential Roe-averaged quantities and using them to determine the maximum stable time step for a given Riemann problem, a fundamental skill in practical CFD simulation. [@problem_id:3359591]", "problem": "Consider the one-dimensional compressible Euler equations for a calorically perfect ideal gas with constant ratio of specific heats $\\gamma$. An explicit finite volume method using the Roe approximate Riemann solver advances the conserved variables in time under a Courant-Friedrichs-Lewy (CFL) constraint. At a particular cell interface in a uniform grid of spacing $\\Delta x$, the left and right primitive states (density $\\rho$, velocity $u$, and pressure $p$) are\n- Left state: $\\rho_{L} = 1.2$ kg/m$^{3}$, $u_{L} = 50$ m/s, $p_{L} = 101325$ Pa,\n- Right state: $\\rho_{R} = 0.8$ kg/m$^{3}$, $u_{R} = -30$ m/s, $p_{R} = 80000$ Pa.\n\nAssume $\\gamma = 1.4$, and that the time step is limited by this interface. A Courant number of $0.7$ is chosen, and the grid spacing is $\\Delta x = 1.0 \\times 10^{-2}$ m. Using the Roe linearization constructed from these left and right states and the Courant-Friedrichs-Lewy (CFL) stability requirement for an explicit method, determine the maximum stable time step $\\Delta t_{\\max}$.\n\nExpress your final answer in seconds and round your result to four significant figures.", "solution": "The problem requires the determination of the maximum stable time step, $\\Delta t_{\\max}$, for an explicit finite volume scheme using the Roe approximate Riemann solver. The stability of such a scheme is governed by the Courant-Friedrichs-Lewy (CFL) condition. For the one-dimensional Euler equations, the CFL condition states that the numerical domain of dependence must contain the physical domain of dependence. This is expressed as:\n$$ C = \\frac{\\Delta t}{\\Delta x} S_{\\max} \\le C_{\\max} $$\nwhere $C$ is the Courant number, $\\Delta t$ is the time step, $\\Delta x$ is the grid spacing, and $S_{\\max}$ is the maximum signal speed (the magnitude of the fastest characteristic wave) at the interface. The problem specifies a Courant number $C = 0.7$. To find the maximum stable time step, we solve for $\\Delta t$:\n$$ \\Delta t_{\\max} = C \\frac{\\Delta x}{S_{\\max}} $$\nFor the Roe solver, the maximum signal speed $S_{\\max}$ is determined by the eigenvalues of the Roe-averaged Jacobian matrix, $\\tilde{A}$. The eigenvalues of $\\tilde{A}$ for the 1D Euler equations are $\\tilde{u}$, $\\tilde{u} + \\tilde{a}$, and $\\tilde{u} - \\tilde{a}$, where $\\tilde{u}$ is the Roe-averaged velocity and $\\tilde{a}$ is the Roe-averaged speed of sound. The maximum magnitude of these eigenvalues is the spectral radius of the matrix, given by:\n$$ S_{\\max} = \\max(|\\tilde{u}|, |\\tilde{u} + \\tilde{a}|, |\\tilde{u} - \\tilde{a}|) = |\\tilde{u}| + \\tilde{a} $$\nThe task thus reduces to calculating the Roe-averaged quantities $\\tilde{u}$ and $\\tilde{a}$ from the given left ($L$) and right ($R$) states.\n\nThe provided primitive variables are:\n- Left state: $\\rho_{L} = 1.2$ kg/m$^3$, $u_{L} = 50$ m/s, $p_{L} = 101325$ Pa.\n- Right state: $\\rho_{R} = 0.8$ kg/m$^3$, $u_{R} = -30$ m/s, $p_{R} = 80000$ Pa.\nThe ratio of specific heats is $\\gamma = 1.4$. The grid spacing is $\\Delta x = 1.0 \\times 10^{-2}$ m.\n\nFirst, we define and calculate the Roe-averaged velocity $\\tilde{u}$. The formula is a weighted average based on the square root of density:\n$$ \\tilde{u} = \\frac{\\sqrt{\\rho_{L}} u_{L} + \\sqrt{\\rho_{R}} u_{R}}{\\sqrt{\\rho_{L}} + \\sqrt{\\rho_{R}}} $$\nPlugging in the given values:\n$$ \\tilde{u} = \\frac{\\sqrt{1.2} (50) + \\sqrt{0.8} (-30)}{\\sqrt{1.2} + \\sqrt{0.8}} \\approx \\frac{(1.095445)(50) + (0.894427)(-30)}{1.095445 + 0.894427} \\approx \\frac{54.77225 - 26.83281}{1.989872} \\approx 14.0408 \\text{ m/s} $$\n\nNext, we calculate the Roe-averaged speed of sound $\\tilde{a}$. This is derived from the Roe-averaged specific total enthalpy, $\\tilde{H}$, using the relation:\n$$ \\tilde{a}^2 = (\\gamma - 1) \\left( \\tilde{H} - \\frac{1}{2} \\tilde{u}^2 \\right) $$\nThe Roe-averaged specific total enthalpy $\\tilde{H}$ is defined similarly to $\\tilde{u}$:\n$$ \\tilde{H} = \\frac{\\sqrt{\\rho_{L}} H_{L} + \\sqrt{\\rho_{R}} H_{R}}{\\sqrt{\\rho_{L}} + \\sqrt{\\rho_{R}}} $$\nwhere $H_L$ and $H_R$ are the specific total enthalpies of the left and right states. For a calorically perfect gas, the specific total enthalpy $H$ is given by:\n$$ H = \\frac{\\gamma}{\\gamma-1} \\frac{p}{\\rho} + \\frac{1}{2} u^2 $$\nWe calculate $H_L$ and $H_R$:\n$$ H_L = \\frac{1.4}{1.4-1} \\frac{101325}{1.2} + \\frac{1}{2} (50)^2 = \\frac{1.4}{0.4} (84437.5) + \\frac{1}{2}(2500) = 295531.25 + 1250 = 296781.25 \\text{ J/kg} $$\n$$ H_R = \\frac{1.4}{1.4-1} \\frac{80000}{0.8} + \\frac{1}{2} (-30)^2 = \\frac{1.4}{0.4} (100000) + \\frac{1}{2}(900) = 350000 + 450 = 350450 \\text{ J/kg} $$\nNow, we can compute $\\tilde{H}$:\n$$ \\tilde{H} = \\frac{\\sqrt{1.2} (296781.25) + \\sqrt{0.8} (350450)}{\\sqrt{1.2} + \\sqrt{0.8}} \\approx \\frac{(1.095445)(296781.25) + (0.894427)(350450)}{1.989872} \\approx \\frac{325102.39 + 313437.49}{1.989872} \\approx 320892.59 \\text{ J/kg} $$\nWith $\\tilde{u}$ and $\\tilde{H}$, we can find $\\tilde{a}$:\n$$ \\tilde{a}^2 = (1.4 - 1) \\left( 320892.59 - \\frac{1}{2} (14.0408)^2 \\right) \\approx 0.4 \\left( 320892.59 - \\frac{1}{2} (197.144) \\right) = 0.4 (320892.59 - 98.572) = 0.4(320794.018) \\approx 128317.61 $$\n$$ \\tilde{a} = \\sqrt{128317.61} \\approx 358.2145 \\text{ m/s} $$\nThe maximum signal speed at the interface is:\n$$ S_{\\max} = |\\tilde{u}| + \\tilde{a} \\approx |14.0408| + 358.2145 = 372.2553 \\text{ m/s} $$\nFinally, we calculate the maximum stable time step $\\Delta t_{\\max}$ using the CFL condition:\n$$ \\Delta t_{\\max} = C \\frac{\\Delta x}{S_{\\max}} = 0.7 \\times \\frac{1.0 \\times 10^{-2}}{372.2553} \\approx \\frac{0.007}{372.2553} \\approx 1.88044 \\times 10^{-5} \\text{ s} $$\nRounding the result to four significant figures, as requested:\n$$ \\Delta t_{\\max} \\approx 1.880 \\times 10^{-5} \\text{ s} $$", "answer": "$$\\boxed{1.880 \\times 10^{-5}}$$", "id": "3359591"}, {"introduction": "A common question when first encountering Roe's method is why the specific, density-weighted averaging formulas are necessary. Why not use a simpler arithmetic average of the primitive variables? This exercise directly addresses this critical question by demonstrating that such a naive approach is inconsistent with the conservative nature of the Euler equations. You will quantify the error introduced by this simplification, known as the wave-speed bias, which arises because the transformation between primitive and conservative variables is nonlinear and does not commute with averaging. This practice is crucial for understanding the theoretical rigor behind the Roe linearization and appreciating why its specific form is essential for correctness. [@problem_id:3359643]", "problem": "Consider the one-dimensional (1D) compressible Euler equations for an ideal gas with specific heat ratio $\\gamma = 1.4$. The conservative variables are $U = [\\rho, \\rho u, \\rho v, \\rho w, E]^{\\mathsf{T}}$ and the primitive variables are $W = [\\rho, u, v, w, p]^{\\mathsf{T}}$. The transformation $U(W)$ is defined by the identities $U_{1} = \\rho$, $U_{2} = \\rho u$, $U_{3} = \\rho v$, $U_{4} = \\rho w$, and $U_{5} = E = \\dfrac{p}{\\gamma - 1} + \\dfrac{1}{2}\\rho\\left(u^{2} + v^{2} + w^{2}\\right)$ (ideal gas closure).\n\nYou are given a Riemann problem with left and right states, with flow aligned with the $x$-axis and no transverse motion:\n- Left state $W_{L}$: $\\rho_{L} = 1.0$, $u_{L} = 200$, $v_{L} = 0$, $w_{L} = 0$, $p_{L} = 100000$.\n- Right state $W_{R}$: $\\rho_{R} = 0.5$, $u_{R} = 0$, $v_{R} = 0$, $w_{R} = 0$, $p_{R} = 50000$.\n\nTasks:\n1) Starting from the Euler conservation laws and the ideal-gas enthalpy relation, construct the Roe-consistent average state characterized by the Roe-averaged velocity $\\tilde{u}$ and Roe-averaged specific total enthalpy $\\tilde{H}$ that satisfy the Roe linearization property. Use these to compute the Roe-averaged acoustic speed $\\tilde{a}$ through the ideal-gas relation between specific enthalpy and acoustic speed.\n\n2) Form the arithmetic average in primitive variables $W_{\\mathrm{avg}} = \\dfrac{1}{2}(W_{L} + W_{R})$, and from it compute the corresponding acoustic speed $a_{\\mathrm{avg}}$ using the ideal-gas relation $a = \\sqrt{\\gamma p/\\rho}$ and the mean velocity $u_{\\mathrm{avg}}$.\n\n3) Demonstrate that, in general, averaging and transforming do not commute by showing that $U\\!\\left(\\dfrac{W_{L} + W_{R}}{2}\\right) \\neq \\dfrac{U(W_{L}) + U(W_{R})}{2}$ for the given data, and explain briefly which nonlinearity is responsible.\n\n4) Define the wave-speed bias as the difference between the right-going characteristic speeds predicted by the two averaging paths,\n$$\nB \\equiv \\left(u_{\\mathrm{avg}} + a_{\\mathrm{avg}}\\right) - \\left(\\tilde{u} + \\tilde{a}\\right).\n$$\nCompute $B$ for the given states. Express the final bias in meters per second and round your answer to four significant figures.", "solution": "## SOLUTION\n\nThe problem requires the calculation and comparison of state variables and wave speeds derived from two different averaging methods for a given Riemann problem in one-dimensional gas dynamics.\n\n### Task 1: Roe-Averaged State Calculation\n\nThe Roe-averaging procedure defines a specific mean state, denoted by a tilde $(\\tilde{\\cdot})$, that linearizes the Riemann problem. The Roe-averaged quantities are constructed to satisfy the property $F(U_R) - F(U_L) = \\tilde{A}(U_R - U_L)$, where $\\tilde{A}$ is the flux Jacobian evaluated at the Roe state. For the Euler equations with an ideal gas, the Roe-averaged density, velocity components, and total enthalpy are given by weighted averages.\n\nThe Roe-averaged density is the geometric mean:\n$$\n\\tilde{\\rho} = \\sqrt{\\rho_{L}\\rho_{R}}\n$$\nAny other variable $q$ is averaged using a density-weighted formula:\n$$\n\\tilde{q} = \\frac{\\sqrt{\\rho_{L}}q_{L} + \\sqrt{\\rho_{R}}q_{R}}{\\sqrt{\\rho_{L}} + \\sqrt{\\rho_{R}}}\n$$\nGiven $\\rho_L = 1.0$ and $\\rho_R = 0.5$, we have $\\sqrt{\\rho_L} = 1.0$ and $\\sqrt{\\rho_R} = \\sqrt{0.5} = \\frac{1}{\\sqrt{2}}$.\n\nThe Roe-averaged velocity $\\tilde{u}$ is:\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_{L}}u_{L} + \\sqrt{\\rho_{R}}u_{R}}{\\sqrt{\\rho_{L}} + \\sqrt{\\rho_{R}}} = \\frac{1.0 \\times 200 + \\frac{1}{\\sqrt{2}} \\times 0}{1.0 + \\frac{1}{\\sqrt{2}}} = \\frac{200}{1 + \\frac{1}{\\sqrt{2}}} = \\frac{200\\sqrt{2}}{\\sqrt{2}+1}\n$$\n$$\n\\tilde{u} = \\frac{200\\sqrt{2}(\\sqrt{2}-1)}{(\\sqrt{2}+1)(\\sqrt{2}-1)} = 200(2 - \\sqrt{2}) \\approx 117.1573 \\, \\text{m/s}\n$$\nTo find the Roe-averaged specific total enthalpy $\\tilde{H}$, we first compute the specific total enthalpies for the left and right states, $H_L$ and $H_R$. The specific total enthalpy $H$ is defined as $H = \\frac{E+p}{\\rho}$. For an ideal gas, this is $H = \\frac{\\gamma}{\\gamma-1}\\frac{p}{\\rho} + \\frac{1}{2}|\\mathbf{u}|^2$.\nGiven $\\gamma = 1.4$, we have $\\gamma-1 = 0.4$.\n$$\nH_L = \\frac{1.4}{0.4}\\frac{p_L}{\\rho_L} + \\frac{1}{2}u_L^2 = 3.5 \\times \\frac{100000}{1.0} + \\frac{1}{2}(200)^2 = 350000 + 20000 = 370000 \\, \\text{J/kg}\n$$\n$$\nH_R = \\frac{1.4}{0.4}\\frac{p_R}{\\rho_R} + \\frac{1}{2}u_R^2 = 3.5 \\times \\frac{50000}{0.5} + \\frac{1}{2}(0)^2 = 3.5 \\times 100000 = 350000 \\, \\text{J/kg}\n$$\nNow, we compute $\\tilde{H}$:\n$$\n\\tilde{H} = \\frac{\\sqrt{\\rho_{L}}H_{L} + \\sqrt{\\rho_{R}}H_{R}}{\\sqrt{\\rho_{L}} + \\sqrt{\\rho_{R}}} = \\frac{1.0 \\times 370000 + \\frac{1}{\\sqrt{2}} \\times 350000}{1.0 + \\frac{1}{\\sqrt{2}}} = \\frac{370000\\sqrt{2} + 350000}{\\sqrt{2}+1}\n$$\n$$\n\\tilde{H} = (370000\\sqrt{2} + 350000)(\\sqrt{2}-1) = 370000 \\times 2 - 370000\\sqrt{2} + 350000\\sqrt{2} - 350000\n$$\n$$\n\\tilde{H} = 740000 - 350000 - 20000\\sqrt{2} = 390000 - 20000\\sqrt{2} \\approx 361715.73 \\, \\text{J/kg}\n$$\nThe Roe-averaged speed of sound $\\tilde{a}$ is derived from the Roe-averaged enthalpy and velocity:\n$$\n\\tilde{a}^2 = (\\gamma-1)\\left(\\tilde{H} - \\frac{1}{2}\\tilde{u}^2\\right)\n$$\nWe need $\\frac{1}{2}\\tilde{u}^2$:\n$$\n\\frac{1}{2}\\tilde{u}^2 = \\frac{1}{2}\\left(200(2-\\sqrt{2})\\right)^2 = \\frac{1}{2} \\times 40000 \\times (4 - 4\\sqrt{2} + 2) = 20000(6 - 4\\sqrt{2}) = 120000 - 80000\\sqrt{2}\n$$\nSubstituting into the expression for $\\tilde{a}^2$:\n$$\n\\tilde{a}^2 = 0.4 \\left( (390000 - 20000\\sqrt{2}) - (120000 - 80000\\sqrt{2}) \\right)\n$$\n$$\n\\tilde{a}^2 = 0.4 (270000 + 60000\\sqrt{2}) = 108000 + 24000\\sqrt{2}\n$$\n$$\n\\tilde{a} = \\sqrt{108000 + 24000\\sqrt{2}} \\approx 376.7508 \\, \\text{m/s}\n$$\n\n### Task 2: Arithmetic Average State Calculation\n\nThe arithmetic average of the primitive variables $W_{\\mathrm{avg}} = \\frac{1}{2}(W_L + W_R)$ is computed as:\n$$\n\\rho_{\\mathrm{avg}} = \\frac{1}{2}(\\rho_L + \\rho_R) = \\frac{1}{2}(1.0 + 0.5) = 0.75\n$$\n$$\nu_{\\mathrm{avg}} = \\frac{1}{2}(u_L + u_R) = \\frac{1}{2}(200 + 0) = 100 \\, \\text{m/s}\n$$\n$$\np_{\\mathrm{avg}} = \\frac{1}{2}(p_L + p_R) = \\frac{1}{2}(100000 + 50000) = 75000 \\, \\text{Pa}\n$$\nThe speed of sound $a_{\\mathrm{avg}}$ corresponding to this arithmetically averaged state is calculated using the standard formula for an ideal gas:\n$$\na_{\\mathrm{avg}} = \\sqrt{\\frac{\\gamma p_{\\mathrm{avg}}}{\\rho_{\\mathrm{avg}}}} = \\sqrt{\\frac{1.4 \\times 75000}{0.75}} = \\sqrt{1.4 \\times 100000} = \\sqrt{140000} = 100\\sqrt{14} \\approx 374.1657 \\, \\text{m/s}\n$$\n\n### Task 3: Non-Commutativity of Averaging and Transformation\n\nWe demonstrate that the transformation from primitive to conservative variables $U(W)$ does not commute with arithmetic averaging. We must show $U(W_{\\mathrm{avg}}) \\neq \\frac{1}{2}(U(W_L) + U(W_R))$.\n\nFirst, we compute the conservative vectors for the left and right states, $U(W_L)$ and $U(W_R)$.\n$E_L = \\frac{p_L}{\\gamma-1} + \\frac{1}{2}\\rho_L u_L^2 = \\frac{100000}{0.4} + \\frac{1}{2}(1.0)(200)^2 = 250000 + 20000 = 270000$.\n$E_R = \\frac{p_R}{\\gamma-1} + \\frac{1}{2}\\rho_R u_R^2 = \\frac{50000}{0.4} + 0 = 125000$.\nSo, $U(W_L) = [1.0, 200, 0, 0, 270000]^{\\mathsf{T}}$ and $U(W_R) = [0.5, 0, 0, 0, 125000]^{\\mathsf{T}}$.\n\nThe arithmetic average of these conservative vectors is:\n$$\n\\frac{1}{2}(U(W_L) + U(W_R)) = \\frac{1}{2}[1.5, 200, 0, 0, 395000]^{\\mathsf{T}} = [0.75, 100, 0, 0, 197500]^{\\mathsf{T}}\n$$\nNow, we transform the arithmetically averaged primitive state $W_{\\mathrm{avg}} = [0.75, 100, 0, 0, 75000]^{\\mathsf{T}}$ to conservative variables $U(W_{\\mathrm{avg}})$:\n$U_1 = \\rho_{\\mathrm{avg}} = 0.75$.\n$U_2 = \\rho_{\\mathrm{avg}} u_{\\mathrm{avg}} = 0.75 \\times 100 = 75$.\n$U_5 = E_{\\mathrm{avg}} = \\frac{p_{\\mathrm{avg}}}{\\gamma-1} + \\frac{1}{2}\\rho_{\\mathrm{avg}} u_{\\mathrm{avg}}^2 = \\frac{75000}{0.4} + \\frac{1}{2}(0.75)(100)^2 = 187500 + 3750 = 191250$.\nSo, $U(W_{\\mathrm{avg}}) = [0.75, 75, 0, 0, 191250]^{\\mathsf{T}}$.\n\nComparing the two results:\n$$\nU(W_{\\mathrm{avg}}) = [0.75, 75, 0, 0, 191250]^{\\mathsf{T}} \\neq [0.75, 100, 0, 0, 197500]^{\\mathsf{T}} = \\frac{1}{2}(U(W_L) + U(W_R))\n$$\nThe inequality holds. This is a direct consequence of the nonlinear nature of the transformation $U(W)$. Specifically, the expressions for momentum ($\\rho u$) and total energy ($E$) involve products of primitive variables. For any two states $W_L$ and $W_R$, the average of the products is not equal to the product of the averages, e.g., $\\frac{1}{2}(\\rho_L u_L + \\rho_R u_R) \\neq \\left(\\frac{\\rho_L+\\rho_R}{2}\\right)\\left(\\frac{u_L+u_R}{2}\\right)$ unless the states are trivially related. The difference for the momentum components is $\\frac{1}{4}(\\rho_L u_L + \\rho_R u_R - \\rho_L u_R - \\rho_R u_L) = \\frac{1}{4}(\\rho_L - \\rho_R)(u_L - u_R)$, which is non-zero for the given data.\n\n### Task 4: Wave-Speed Bias Calculation\n\nThe wave-speed bias $B$ is defined as the difference between the right-going characteristic speeds $\\lambda_{\\max} = u+a$ from the two averaging methods.\n$$\nB = \\left(u_{\\mathrm{avg}} + a_{\\mathrm{avg}}\\right) - \\left(\\tilde{u} + \\tilde{a}\\right)\n$$\nUsing the values computed in the previous tasks:\n$u_{\\mathrm{avg}} + a_{\\mathrm{avg}} = 100 + \\sqrt{140000} \\approx 100 + 374.1657 = 474.1657$ m/s.\n$\\tilde{u} + \\tilde{a} = 200(2-\\sqrt{2}) + \\sqrt{108000 + 24000\\sqrt{2}} \\approx 117.1573 + 376.7508 = 493.9081$ m/s.\n\nThe bias $B$ is:\n$$\nB \\approx 474.1657 - 493.9081 = -19.7424 \\, \\text{m/s}\n$$\nRounding the result to four significant figures, we get $B = -19.74$ m/s.", "answer": "$$\n\\boxed{-19.74}\n$$", "id": "3359643"}, {"introduction": "Translating theoretical fluid dynamics into robust and accurate code is the core activity of a computational scientist. This practice moves from analytical derivations to practical implementation, guiding you to build a program that computes Roe-averaged states. The exercise is designed not only to reinforce the correct formulas but also to highlight and quantify common sources of error, from conceptual mistakes like using static enthalpy instead of total enthalpy, to numerical issues like sensitivity to floating-point precision. By testing your implementation against a suite of physically diverse test cases, you will gain a deeper appreciation for the details that ensure a numerical method is both correct and reliable. [@problem_id:3359619]", "problem": "Consider the one-dimensional compressible Euler equations from Computational Fluid Dynamics (CFD), modeling an ideal gas with specific heat ratio $\\gamma$. The conservative variables are mass density $\\rho$, momentum density $\\rho u$, and total energy density $E$. The inviscid flux $\\mathbf{F}$ and the primitive variables $u$ and $p$ are related through the standard thermodynamic definitions for an ideal gas. The specific static enthalpy $h$ and the specific total enthalpy $H$ must be defined from first principles using the ideal gas law and the decomposition of $E$ into internal and kinetic energies. Roe linearization requires a single state $\\tilde{\\mathbf{U}}$ whose associated flux Jacobian $\\tilde{\\mathbf{A}}$ exactly relates flux differences to state differences through a linear map, and this requirement must be used to derive expressions for the Roe-averaged velocity and enthalpy. You must begin your derivation from the Euler equations, the ideal gas definitions, and the definition of the specific total enthalpy $H$, and produce computable expressions for the Roe averages as the endpoint of that derivation.\n\nYour task is to write a program that, for each given left and right state $(\\rho_L,u_L,p_L)$ and $(\\rho_R,u_R,p_R)$ with a common $\\gamma$, performs all of the following:\n- Derive and compute the Roe-averaged velocity $\\tilde{u}$ and the Roe-averaged specific total enthalpy $\\tilde{H}$, consistent with the linearization requirement.\n- Compute the arithmetic averages $\\bar{u}$ and $\\bar{H}$ constructed from $(u_L,u_R)$ and $(H_L,H_R)$ respectively, where $H_L$ and $H_R$ are the physically correct specific total enthalpies built from $(\\rho,u,p,\\gamma)$ for the left and right states.\n- Quantify the error of using arithmetic averages instead of Roe averages by outputting the absolute differences $|\\tilde{u}-\\bar{u}|$ in $\\mathrm{m/s}$ and $|\\tilde{H}-\\bar{H}|$ in $\\mathrm{J/kg}$.\n- Quantify the error introduced by incorrectly using the static enthalpy $h$ in the Roe enthalpy averaging (omitting the kinetic energy contribution) by computing the absolute difference $|\\tilde{H}-\\tilde{h}|$ in $\\mathrm{J/kg}$, where $\\tilde{h}$ is the enthalpy obtained by the same Roe-averaging procedure applied to $h$ rather than $H$.\n- Estimate sensitivity of $\\tilde{u}$ to finite-precision perturbations in the square-root density weights by applying symmetric relative perturbations of magnitude $\\varepsilon$ to the weights and reporting the induced absolute error $|\\tilde{u}-\\tilde{u}_\\varepsilon|$ in $\\mathrm{m/s}$ for $\\varepsilon=10^{-12}$ and $\\varepsilon=10^{-8}$. Use a worst-case symmetric perturbation by scaling the left weight by $(1+\\varepsilon)$ and the right weight by $(1-\\varepsilon)$.\n\nExpress all velocities in $\\mathrm{m/s}$ and all enthalpies in $\\mathrm{J/kg}$. The final outputs must be floats. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a nested list of five floats in the order $[|\\tilde{u}-\\bar{u}|,|\\tilde{H}-\\bar{H}|,|\\tilde{H}-\\tilde{h}|,|\\tilde{u}-\\tilde{u}_{\\varepsilon=10^{-12}}|,|\\tilde{u}-\\tilde{u}_{\\varepsilon=10^{-8}}|]$. The program must not read any input.\n\nUse the following scientifically consistent test suite to exercise different regimes:\n- Test $1$ (moderate, subsonic-to-transonic contrast): $(\\rho_L,u_L,p_L)=(1.0,200,1.0\\times 10^5)$, $(\\rho_R,u_R,p_R)=(0.8,220,0.9\\times 10^5)$, $\\gamma=1.4$.\n- Test $2$ (strong jump, shock-like): $(\\rho_L,u_L,p_L)=(1.0,800,1.0\\times 10^5)$, $(\\rho_R,u_R,p_R)=(5.0,200,5.0\\times 10^5)$, $\\gamma=1.4$.\n- Test $3$ (near-vacuum on the right, carefully scaled to keep enthalpy finite): $(\\rho_L,u_L,p_L)=(1.225,50,1.0\\times 10^5)$, $(\\rho_R,u_R,p_R)=(1.0\\times 10^{-5},50,1.0)$, $\\gamma=1.4$.\n- Test $4$ (identical states, consistency check): $(\\rho_L,u_L,p_L)=(1.0,300,1.0\\times 10^5)$, $(\\rho_R,u_R,p_R)=(1.0,300,1.0\\times 10^5)$, $\\gamma=1.4$.\n- Test $5$ (extremely disparate densities, scaled pressures): $(\\rho_L,u_L,p_L)=(1.0\\times 10^6,300,1.0\\times 10^9)$, $(\\rho_R,u_R,p_R)=(1.0\\times 10^{-6},300,1.0\\times 10^3)$, $\\gamma=1.4$.\n\nYour program must implement the physically correct enthalpy definitions and the Roe linearization-consistent averages derived from first principles, and then compute the requested error metrics. The final printed output must be a single line of the form $[[\\ldots],[\\ldots],\\ldots]$ containing the five-float lists for the five tests in the order specified above.", "solution": "The problem requires the derivation of Roe-averaged velocity and enthalpy for the one-dimensional Euler equations and the subsequent computation of several error metrics for given test cases. The validation of the problem statement confirms it is scientifically sound, well-posed, and contains all necessary information. We proceed with the solution.\n\nThe one-dimensional compressible Euler equations in conservative form are given by:\n$$\n\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}(\\mathbf{U})}{\\partial x} = 0\n$$\nwhere $\\mathbf{U}$ is the vector of conserved variables and $\\mathbf{F}$ is the flux vector:\n$$\n\\mathbf{U} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}, \\quad\n\\mathbf{F} = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ (E+p)u \\end{pmatrix}\n$$\nHere, $\\rho$ is the mass density, $u$ is the fluid velocity, $p$ is the pressure, and $E$ is the total energy per unit volume.\n\nFor an ideal gas, the pressure $p$ and total energy $E$ are related through the equation of state. The total energy is the sum of internal energy $\\rho e$ and kinetic energy:\n$$\nE = \\rho e + \\frac{1}{2}\\rho u^2\n$$\nThe pressure is related to the specific internal energy $e$ by $p = (\\gamma-1)\\rho e$, where $\\gamma$ is the specific heat ratio. From this, we can express pressure in terms of the conservative variables:\n$$\np = (\\gamma-1) \\left( E - \\frac{1}{2}\\rho u^2 \\right)\n$$\nThe specific static enthalpy $h$ for an ideal gas is defined as $h = e + p/\\rho$. Substituting $e = p/((\\gamma-1)\\rho)$ gives:\n$$\nh = \\frac{p}{(\\gamma-1)\\rho} + \\frac{p}{\\rho} = \\frac{\\gamma p}{(\\gamma-1)\\rho}\n$$\nThe specific total enthalpy $H$ is defined as $H = h + \\frac{1}{2}u^2$. An important relation for the flux vector is obtained by substituting the definitions of $E$ and $p$:\n$$\nH = \\frac{E+p}{\\rho}\n$$\nUsing this, the third component of the flux vector can be written as $F_3 = (E+p)u = \\rho u H$.\n\nThe core of Roe's linearization method is to find an averaged state $\\tilde{\\mathbf{U}}$ such that the difference in fluxes between a left state $\\mathbf{U}_L$ and a right state $\\mathbf{U}_R$ is exactly related by the Jacobian matrix $\\mathbf{A}(\\mathbf{U}) = \\partial\\mathbf{F}/\\partial\\mathbf{U}$ evaluated at this averaged state:\n$$\n\\Delta\\mathbf{F} = \\mathbf{F}_R - \\mathbf{F}_L = \\mathbf{A}(\\tilde{\\mathbf{U}}) (\\mathbf{U}_R - \\mathbf{U}_L) = \\tilde{\\mathbf{A}}\\Delta\\mathbf{U}\n$$\nThis property must hold exactly. A direct algebraic search for such an average state is exceedingly complex. A more elegant and rigorous derivation, as originally shown by Roe and Pike (1984), relies on finding a parameter vector $\\mathbf{q}$ such that both $\\mathbf{U}$ and $\\mathbf{F}$ are quadratic functions of its components.\n\nLet us define the parameter vector $\\mathbf{q}$ as:\n$$\n\\mathbf{q} = \\begin{pmatrix} q_1 \\\\ q_2 \\\\ q_3 \\end{pmatrix} = \\begin{pmatrix} \\sqrt{\\rho} \\\\ \\sqrt{\\rho}u \\\\ \\sqrt{\\rho}H \\end{pmatrix}\n$$\nWe can now express the conservative variables $\\mathbf{U}$ in terms of the components of $\\mathbf{q}$:\n$U_1 = \\rho = q_1^2$\n$U_2 = \\rho u = q_1 q_2$\nTo express $U_3 = E$, we use the relation $\\rho H = E+p = E+(\\gamma-1)(E - \\frac{1}{2}\\rho u^2) = \\gamma E - \\frac{\\gamma-1}{2}\\rho u^2$. Rearranging for $E$ gives $E = \\frac{1}{\\gamma}(\\rho H + \\frac{\\gamma-1}{2}\\rho u^2)$. Substituting the $\\mathbf{q}$ parameters yields:\n$$\nU_3 = E = \\frac{1}{\\gamma}\\left(q_1 q_3 + \\frac{\\gamma-1}{2}q_2^2\\right)\n$$\nThe flux vector $\\mathbf{F}$ can also be expressed in terms of $\\mathbf{q}$:\n$F_1 = \\rho u = q_1 q_2$\n$F_3 = \\rho u H = q_2 q_3$\nThe component $F_2 = \\rho u^2 + p = \\rho u^2 + (\\gamma-1)E - \\frac{\\gamma-1}{2}\\rho u^2 = \\frac{3-\\gamma}{2}\\rho u^2 + (\\gamma-1)E$. Substituting the expressions for $\\rho u^2$ and $E$ in terms of $\\mathbf{q}$ gives:\n$$\nF_2 = \\frac{3-\\gamma}{2}q_2^2 + (\\gamma-1)\\left[\\frac{1}{\\gamma}\\left(q_1 q_3 + \\frac{\\gamma-1}{2}q_2^2\\right)\\right] = \\frac{\\gamma-1}{\\gamma}q_1 q_3 + \\frac{\\gamma+1}{2\\gamma}q_2^2\n$$\nBoth $\\mathbf{U}(\\mathbf{q})$ and $\\mathbf{F}(\\mathbf{q})$ are homogeneous quadratic functions of the components of $\\mathbf{q}$. For any such function $f(\\mathbf{q})$, the mean value theorem provides the exact relation:\n$$\n\\Delta f = f(\\mathbf{q}_R) - f(\\mathbf{q}_L) = \\nabla_{\\mathbf{q}}f(\\bar{\\mathbf{q}}) \\cdot (\\mathbf{q}_R - \\mathbf{q}_L) = \\nabla_{\\mathbf{q}}f(\\bar{\\mathbf{q}}) \\cdot \\Delta\\mathbf{q}\n$$\nwhere $\\bar{\\mathbf{q}} = \\frac{1}{2}(\\mathbf{q}_L + \\mathbf{q}_R)$ is the arithmetic mean. Applying this to our vectors $\\mathbf{U}$ and $\\mathbf{F}$:\n$$\n\\Delta\\mathbf{U} = \\left(\\frac{\\partial \\mathbf{U}}{\\partial \\mathbf{q}}\\right)_{\\bar{\\mathbf{q}}} \\Delta\\mathbf{q} \\equiv \\mathbf{B}_{\\bar{\\mathbf{q}}} \\Delta\\mathbf{q}\n$$\n$$\n\\Delta\\mathbf{F} = \\left(\\frac{\\partial \\mathbf{F}}{\\partial \\mathbf{q}}\\right)_{\\bar{\\mathbf{q}}} \\Delta\\mathbf{q} \\equiv \\mathbf{J}_{\\bar{\\mathbf{q}}} \\Delta\\mathbf{q}\n$$\nFrom the first equation, we can write $\\Delta\\mathbf{q} = \\mathbf{B}_{\\bar{\\mathbf{q}}}^{-1} \\Delta\\mathbf{U}$. Substituting this into the second equation yields:\n$$\n\\Delta\\mathbf{F} = (\\mathbf{J}_{\\bar{\\mathbf{q}}} \\mathbf{B}_{\\bar{\\mathbf{q}}}^{-1}) \\Delta\\mathbf{U}\n$$\nThis construction provides the Roe matrix $\\tilde{\\mathbf{A}} = \\mathbf{J}_{\\bar{\\mathbf{q}}} \\mathbf{B}_{\\bar{\\mathbf{q}}}^{-1}$. The property $\\tilde{\\mathbf{A}} = \\mathbf{A}(\\tilde{\\mathbf{U}})$ requires that the Roe-averaged state $\\tilde{\\mathbf{U}}$ corresponds to the primitive variables derived from the averaged parameter vector $\\bar{\\mathbf{q}}$. Specifically, we identify the Roe-averaged velocity $\\tilde{u}$ and total enthalpy $\\tilde{H}$ from the ratios of the components of $\\bar{\\mathbf{q}}$:\n$$\n\\tilde{u} = \\frac{\\bar{q}_2}{\\bar{q}_1} = \\frac{(\\sqrt{\\rho_L}u_L + \\sqrt{\\rho_R}u_R)/2}{(\\sqrt{\\rho_L} + \\sqrt{\\rho_R})/2} = \\frac{\\sqrt{\\rho_L}u_L + \\sqrt{\\rho_R}u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\n$$\n\\tilde{H} = \\frac{\\bar{q}_3}{\\bar{q}_1} = \\frac{(\\sqrt{\\rho_L}H_L + \\sqrt{\\rho_R}H_R)/2}{(\\sqrt{\\rho_L} + \\sqrt{\\rho_R})/2} = \\frac{\\sqrt{\\rho_L}H_L + \\sqrt{\\rho_R}H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\nThese are the desired expressions for the Roe-averaged velocity and specific total enthalpy, derived from first principles.\n\nThe computational tasks are as follows, for each test case $(\\rho_L, u_L, p_L)$ and $(\\rho_R, u_R, p_R)$:\n1.  Calculate the specific static enthalpies $h_L, h_R$ and specific total enthalpies $H_L, H_R$ for the left and right states using $h = \\frac{\\gamma p}{(\\gamma-1)\\rho}$ and $H = h + \\frac{1}{2}u^2$.\n2.  Compute the Roe-averaged velocity $\\tilde{u}$ and total enthalpy $\\tilde{H}$ using the derived formulas.\n3.  Compute the simple arithmetic averages $\\bar{u} = \\frac{1}{2}(u_L+u_R)$ and $\\bar{H} = \\frac{1}{2}(H_L+H_R)$.\n4.  Compute the Roe-averaged static enthalpy $\\tilde{h} = \\frac{\\sqrt{\\rho_L}h_L + \\sqrt{\\rho_R}h_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}$.\n5.  Compute the perturbed Roe velocity $\\tilde{u}_{\\varepsilon}$ for $\\varepsilon \\in \\{10^{-12}, 10^{-8}\\}$. The perturbed weights are $w_L' = \\sqrt{\\rho_L}(1+\\varepsilon)$ and $w_R' = \\sqrt{\\rho_R}(1-\\varepsilon)$, so $\\tilde{u}_{\\varepsilon} = \\frac{w_L' u_L + w_R' u_R}{w_L' + w_R'}$.\n6.  Calculate the five required absolute differences:\n    -   $|\\tilde{u} - \\bar{u}|$ in $\\mathrm{m/s}$\n    -   $|\\tilde{H} - \\bar{H}|$ in $\\mathrm{J/kg}$\n    -   $|\\tilde{H} - \\tilde{h}|$ in $\\mathrm{J/kg}$\n    -   $|\\tilde{u} - \\tilde{u}_{\\varepsilon=10^{-12}}|$ in $\\mathrm{m/s}$\n    -   $|\\tilde{u} - \\tilde{u}_{\\varepsilon=10^{-8}}|$ in $\\mathrm{m/s}$\n\nThese computations will be implemented for the provided test suite.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Roe averaging problem for a suite of test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: ((rho_L, u_L, p_L), (rho_R, u_R, p_R), gamma)\n    test_cases = [\n        # Test 1: moderate contrast\n        ((1.0, 200.0, 1.0e5), (0.8, 220.0, 0.9e5), 1.4),\n        # Test 2: strong jump (shock-like)\n        ((1.0, 800.0, 1.0e5), (5.0, 200.0, 5.0e5), 1.4),\n        # Test 3: near-vacuum\n        ((1.225, 50.0, 1.0e5), (1.0e-5, 50.0, 1.0), 1.4),\n        # Test 4: identical states\n        ((1.0, 300.0, 1.0e5), (1.0, 300.0, 1.0e5), 1.4),\n        # Test 5: extremely disparate densities\n        ((1.0e6, 300.0, 1.0e9), (1.0e-6, 300.0, 1.0e3), 1.4),\n    ]\n\n    # Perturbation magnitudes\n    epsilons = [1e-12, 1e-8]\n    \n    results = []\n    for case in test_cases:\n        state_L, state_R, gamma = case\n        rho_L, u_L, p_L = state_L\n        rho_R, u_R, p_R = state_R\n\n        # --- Sub-problem 1: Calculate state-dependent enthalpies ---\n        \n        # Specific static enthalpy: h = (gamma * p) / ((gamma - 1) * rho)\n        h_L = (gamma * p_L) / ((gamma - 1.0) * rho_L)\n        h_R = (gamma * p_R) / ((gamma - 1.0) * rho_R)\n\n        # Specific total enthalpy: H = h + 0.5 * u^2\n        H_L = h_L + 0.5 * u_L**2\n        H_R = h_R + 0.5 * u_R**2\n\n        # --- Sub-problem 2: Compute Roe and arithmetic averages ---\n\n        # Weights for Roe averaging\n        sqrt_rho_L = np.sqrt(rho_L)\n        sqrt_rho_R = np.sqrt(rho_R)\n        \n        # Denominator for Roe averages\n        roe_denom = sqrt_rho_L + sqrt_rho_R\n\n        # Roe-averaged velocity: u_roe = (sqrt(rho_L)*u_L + sqrt(rho_R)*u_R) / (sqrt(rho_L)+sqrt(rho_R))\n        u_roe = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / roe_denom\n        \n        # Roe-averaged specific total enthalpy\n        H_roe = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / roe_denom\n\n        # Arithmetic average velocity\n        u_arith = 0.5 * (u_L + u_R)\n        \n        # Arithmetic average specific total enthalpy\n        H_arith = 0.5 * (H_L + H_R)\n\n        # --- Sub-problem 3: Compute errors ---\n        \n        # Error 1: Absolute difference between Roe and arithmetic average velocity\n        err_u_avg = np.abs(u_roe - u_arith)\n        \n        # Error 2: Absolute difference between Roe and arithmetic average total enthalpy\n        err_H_avg = np.abs(H_roe - H_arith)\n        \n        # For error 3, compute Roe-averaged static enthalpy\n        h_roe = (sqrt_rho_L * h_L + sqrt_rho_R * h_R) / roe_denom\n        \n        # Error 3: Absolute difference between Roe total and static enthalpy\n        # This quantifies the kinetic energy component at the Roe-averaged state.\n        err_H_h_roe = np.abs(H_roe - h_roe)\n        \n        # --- Sub-problem 4: Compute sensitivity to weight perturbations ---\n        \n        sensitivity_errors = []\n        for eps in epsilons:\n            # Perturbed weights\n            w_L_eps = sqrt_rho_L * (1.0 + eps)\n            w_R_eps = sqrt_rho_R * (1.0 - eps)\n            \n            # Perturbed Roe velocity\n            u_roe_eps = (w_L_eps * u_L + w_R_eps * u_R) / (w_L_eps + w_R_eps)\n            \n            # Error: Absolute difference between original and perturbed Roe velocity\n            err_u_sens = np.abs(u_roe - u_roe_eps)\n            sensitivity_errors.append(err_u_sens)\n\n        case_results = [\n            err_u_avg, \n            err_H_avg, \n            err_H_h_roe, \n            sensitivity_errors[0], \n            sensitivity_errors[1]\n        ]\n        results.append([f\"{val:.15g}\" for val in case_results])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(['[' + ','.join(res) + ']' for res in results])}]\")\n\nsolve()\n```", "id": "3359619"}]}