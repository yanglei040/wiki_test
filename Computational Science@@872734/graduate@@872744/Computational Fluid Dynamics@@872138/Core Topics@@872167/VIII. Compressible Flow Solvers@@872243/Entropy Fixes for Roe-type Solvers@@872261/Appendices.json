{"hands_on_practices": [{"introduction": "The first step in mastering any numerical correction is to understand precisely when and why it is needed. Roe-type solvers can fail in the presence of transonic rarefactions, producing unphysical 'expansion shocks.' This foundational exercise guides you through the diagnostic process: by calculating the characteristic speeds on either side of a Riemann problem interface, you will learn to identify the tell-tale sign change that signals a potential entropy violation. [@problem_id:3314404]", "problem": "Consider the one-dimensional compressible Euler equations for an ideal gas, which form a strictly hyperbolic system with three characteristic fields. For an ideal gas with ratio of specific heats $\\gamma$, the local sound speed is defined by $a=\\sqrt{\\gamma p/\\rho}$, and the eigenvalues of the flux Jacobian are $u-a$, $u$, and $u+a$, corresponding to the $1$-, $2$-, and $3$-waves, respectively. In computational fluid dynamics (CFD), Roe-type solvers linearize the Riemann problem at an interface using Roe-averaged states, leading to interface eigenvalues that can violate the entropy condition in the presence of transonic rarefactions (expansions). A common entropy fix detects such situations by examining sign changes in the characteristic speeds across the interface.\n\nYou are given the Riemann problem with left state $(\\rho_L,u_L,p_L)=(1,0.1,1)$ and right state $(\\rho_R,u_R,p_R)=(0.125,0.9,0.1)$ for an ideal gas with $\\gamma=1.4$. Starting from the definitions of the Euler eigenstructure and Roe averages, determine whether the $1$-wave or $3$-wave is transonic in the sense that its corresponding characteristic speed changes sign across the interface, and infer whether the Roe flux is prone to produce a non-entropic expansion shock for this data.\n\nUse the following conventions for your final answer:\n- Encode the transonic status of the $1$-wave and $3$-wave as indicators $I_1$ and $I_3$, with $I_k=1$ if the $k$-wave is transonic and $I_k=0$ otherwise.\n- Encode the expansion-shock susceptibility of the Roe flux as $E$, with $E=1$ if the Roe flux is prone to a non-entropic expansion shock for this interface, and $E=0$ otherwise.\n- Express your final answer as a single row matrix $\\begin{pmatrix}I_1  I_3  E\\end{pmatrix}$.\n\nNo rounding is required, and the indicators are dimensionless.", "solution": "The user wants me to solve a problem in computational fluid dynamics (CFD). The problem asks to determine if an entropy fix is needed for a specific Riemann problem when using a Roe-type solver. This involves checking for transonic rarefactions.\n\n### Step 1: Extract Givens\n- System of equations: One-dimensional compressible Euler equations for an ideal gas.\n- Left state: $(\\rho_L, u_L, p_L) = (1, 0.1, 1)$.\n- Right state: $(\\rho_R, u_R, p_R) = (0.125, 0.9, 0.1)$.\n- Ratio of specific heats: $\\gamma = 1.4$.\n- Speed of sound definition: $a = \\sqrt{\\gamma p / \\rho}$.\n- Eigenvalues (characteristic speeds) of the flux Jacobian: $\\lambda_1 = u - a$, $\\lambda_2 = u$, $\\lambda_3 = u + a$.\n- Definition of a transonic wave: A wave is transonic if its corresponding characteristic speed changes sign across the interface.\n- Output indicators:\n    - $I_1$: $1$ if the $1$-wave is transonic, $0$ otherwise.\n    - $I_3$: $1$ if the $3$-wave is transonic, $0$ otherwise.\n    - $E$: $1$ if the Roe flux is prone to produce a non-entropic expansion shock, $0$ otherwise.\n- Final answer format: A single row matrix $\\begin{pmatrix} I_1  I_3  E \\end{pmatrix}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, being a standard analysis in the field of computational fluid dynamics concerning the properties of numerical schemes for hyperbolic conservation laws. It is well-posed, providing all necessary data and definitions for a unique solution. The data are physically consistent, and the terminology is precise and objective. There are no contradictions, ambiguities, or violations of scientific principles. The problem is valid.\n\n### Step 3: Solution\nThe problem requires us to determine if the $1$-wave or $3$-wave is transonic for the given Riemann problem. According to the problem statement, a wave is transonic if its characteristic speed changes sign across the interface between the left and right states. The susceptibility to a non-entropic expansion shock is directly linked to the presence of such a transonic wave.\n\nThe characteristic speeds associated with the $1$-wave and $3$-wave are given by the eigenvalues $\\lambda_1 = u - a$ and $\\lambda_3 = u + a$, respectively. The speed of sound, $a$, is defined as $a = \\sqrt{\\gamma p / \\rho}$. We must calculate these eigenvalues for both the left state $(\\mathbf{U}_L)$ and the right state $(\\mathbf{U}_R)$.\n\nFirst, we calculate the speed of sound for the left state, $a_L$:\n$$a_L = \\sqrt{\\frac{\\gamma p_L}{\\rho_L}}$$\nSubstituting the given values, $\\gamma = 1.4$, $p_L = 1$, and $\\rho_L = 1$:\n$$a_L = \\sqrt{\\frac{1.4 \\times 1}{1}} = \\sqrt{1.4}$$\nNow, we calculate the characteristic speeds for the left state:\n$$ \\lambda_{1,L} = u_L - a_L = 0.1 - \\sqrt{1.4} $$\nTo determine the sign of $\\lambda_{1,L}$, we compare $0.1$ and $\\sqrt{1.4}$. Since $0.1^2 = 0.01$ and $(\\sqrt{1.4})^2 = 1.4$, we have $0.01  1.4$, which implies $0.1  \\sqrt{1.4}$. Therefore, $\\lambda_{1,L}$ is negative.\n$$ \\lambda_{3,L} = u_L + a_L = 0.1 + \\sqrt{1.4} $$\nSince both terms are positive, $\\lambda_{3,L}$ is positive.\n\nNext, we calculate the speed of sound for the right state, $a_R$:\n$$a_R = \\sqrt{\\frac{\\gamma p_R}{\\rho_R}}$$\nSubstituting the given values, $\\gamma = 1.4$, $p_R = 0.1$, and $\\rho_R = 0.125$:\n$$a_R = \\sqrt{\\frac{1.4 \\times 0.1}{0.125}} = \\sqrt{\\frac{0.14}{0.125}} = \\sqrt{1.12}$$\nNow, we calculate the characteristic speeds for the right state:\n$$ \\lambda_{1,R} = u_R - a_R = 0.9 - \\sqrt{1.12} $$\nTo determine the sign of $\\lambda_{1,R}$, we compare $0.9$ and $\\sqrt{1.12}$. Since $0.9^2 = 0.81$ and $(\\sqrt{1.12})^2 = 1.12$, we have $0.81  1.12$, which implies $0.9  \\sqrt{1.12}$. Therefore, $\\lambda_{1,R}$ is negative.\n$$ \\lambda_{3,R} = u_R + a_R = 0.9 + \\sqrt{1.12} $$\nSince both terms are positive, $\\lambda_{3,R}$ is positive.\n\nNow we can determine the transonic status of each wave. A wave is transonic if its characteristic speed changes sign across the interface, which mathematically means $\\lambda_k(\\mathbf{U}_L) \\cdot \\lambda_k(\\mathbf{U}_R)  0$.\n\nFor the $1$-wave:\nWe found $\\lambda_{1,L}  0$ and $\\lambda_{1,R}  0$. Since both are negative, there is no sign change. The product $\\lambda_{1,L} \\lambda_{1,R}$ is positive.\nTherefore, the $1$-wave is not transonic, and the indicator $I_1$ is $0$.\n$$I_1 = 0$$\n\nFor the $3$-wave:\nWe found $\\lambda_{3,L}  0$ and $\\lambda_{3,R}  0$. Since both are positive, there is no sign change. The product $\\lambda_{3,L} \\lambda_{3,R}$ is positive.\nTherefore, the $3$-wave is not transonic, and the indicator $I_3$ is $0$.\n$$I_3 = 0$$\n\nFinally, we determine the susceptibility to an expansion shock, $E$. The problem states that the Roe flux is prone to producing a non-entropic expansion shock in the presence of transonic rarefactions, which are detected by a sign change in characteristic speeds. Since we have found that neither the $1$-wave nor the $3$-wave is transonic ($I_1 = 0$ and $I_3 = 0$), the condition that leads to this numerical artifact is not met for the given Riemann problem. Thus, the Roe flux is not prone to an expansion shock *for this reason*.\nTherefore, the indicator $E$ is $0$.\n$$E = 0$$\n\nThe final answer is required as a row matrix $\\begin{pmatrix} I_1  I_3  E \\end{pmatrix}$. Substituting the values we found:\n$$ \\begin{pmatrix} 0  0  0 \\end{pmatrix} $$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  0  0\n\\end{pmatrix}\n}\n$$", "id": "3314404"}, {"introduction": "Having learned to diagnose the transonic anomaly, we now turn to developing a cure. To simplify the analysis, we first study the problem in the context of the inviscid Burgers' equation, a valuable scalar model for the full Euler equations. This practice challenges you to derive the minimum dissipation required by a Harten-Hyman entropy fix to prevent the anomaly, and then to confirm your analytical bound with a short numerical program, illustrating a powerful synergy between theory and computation. [@problem_id:3314395]", "problem": "Consider the scalar conservation law given by the inviscid Burgers’ equation $u_t + f(u)_x = 0$ with convex flux $f(u) = \\tfrac{1}{2} u^2$. A Roe-type approximate Riemann solver for a two-point numerical flux at an interface with left state $u_L$ and right state $u_R$ uses the linearized wave speed $a = \\tfrac{f(u_R) - f(u_L)}{u_R - u_L}$ for $u_L \\ne u_R$, which for Burgers’ equation reduces to $a = \\tfrac{1}{2} (u_L + u_R)$. The Roe flux takes the form\n$$\nF_{\\mathrm{Roe}}(u_L,u_R) \\;=\\; \\tfrac{1}{2}\\big(f(u_L)+f(u_R)\\big) \\;-\\; \\tfrac{1}{2}\\,|a|\\,(u_R-u_L).\n$$\nIt is known that in transonic rarefaction configurations where $u_L  0  u_R$, the Roe flux may produce an entropy-violating nonphysical stationary discontinuity (the transonic anomaly). A standard remedy is to apply an entropy fix that increases the dissipation near sonic conditions. Consider the Harten–Hyman entropy fix, which replaces $|a|$ by a modified magnitude $|a|_{\\delta}$ defined using a threshold parameter $\\delta  0$:\n$$\n|a|_{\\delta} \\;=\\; \\begin{cases}\n|a|,  |a| \\ge \\delta, \\\\\n\\tfrac{1}{2}\\left(\\dfrac{a^2}{\\delta} + \\delta\\right),  |a|  \\delta.\n\\end{cases}\n$$\nThe Godunov flux for the Burgers’ equation is the exact Riemann flux. For convex flux and a rarefaction with $u_L \\le u_R$, it is given by:\n- If $u_L \\ge 0$, then $F_{\\mathrm{God}} = f(u_L)$.\n- If $u_R \\le 0$, then $F_{\\mathrm{God}} = f(u_R)$.\n- If $u_L  0  u_R$, then $F_{\\mathrm{God}} = f(0) = 0$.\n\nYour tasks are:\n1. Starting from the above definitions and without invoking any undocumented formulas, derive a lower bound on the entropy-fix threshold $\\delta$ such that, in the transonic case $u_L  0  u_R$, the Harten–Hyman modified Roe flux $F_{\\mathrm{Roe,HH}} = \\tfrac{1}{2}(f(u_L)+f(u_R)) - \\tfrac{1}{2}|a|_{\\delta}(u_R-u_L)$ satisfies $F_{\\mathrm{Roe,HH}} \\le F_{\\mathrm{God}}$ for Burgers’ equation. Interpret this bound as a minimum entropy production requirement at the interface and express it explicitly in terms of $u_L$ and $u_R$. Your derivation must begin from the conservation law, the convexity of $f$, the Roe linearization, and the Harten–Hyman entropy fix definition. Use the quadratic mathematical entropy $U(u) = \\tfrac{1}{2}u^2$ for interpretation, and make clear any inequality you enforce to prevent the entropy-violating stationary expansion shock.\n2. Map the scalar bound you obtained to the one-dimensional compressible Euler equations linearized about a local state, by considering the behavior along a single characteristic field with eigenvalue $\\lambda$ that crosses zero. Explain how the scalar result applies to each characteristic wave in a Roe-type solver for Euler by replacing $u$ with the characteristic speed and interpreting the jump accordingly. No specific numerical values for Euler need be computed, but the mapping logic must be clear and consistent with linearization.\n3. Confirm the scalar bound numerically for Burgers’ equation by computing, for each provided test case, the minimum threshold $\\delta_{\\min}$ implied by your derived formula. Then verify numerically that the corresponding Harten–Hyman modified Roe flux at that threshold satisfies $F_{\\mathrm{Roe,HH}} \\le F_{\\mathrm{God}}$, with equality allowed at the bound. Your program must compute and report only the values of $\\delta_{\\min}$.\n\nTest suite:\n- Case A (symmetric transonic): $(u_L,u_R) = (-1.0,\\,1.0)$.\n- Case B (asymmetric transonic): $(u_L,u_R) = (-0.2,\\,1.3)$.\n- Case C (near-sonic left, strong right): $(u_L,u_R) = (-10^{-6},\\,2.0)$.\n- Case D (non-transonic rarefaction, both positive): $(u_L,u_R) = (1.0,\\,2.0)$.\n- Case E (asymmetric transonic, stronger left): $(u_L,u_R) = (-2.0,\\,0.5)$.\n\nAll quantities are nondimensional; no physical units are required. Angles are not involved. Each test case yields a single real number $\\delta_{\\min}$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of the $\\delta_{\\min}$ values for Cases A–E, in that order, enclosed in square brackets and with each value rounded to ten decimal places (e.g., $[0.1234567890,0.0000000000,\\dots]$).", "solution": "The problem requires the derivation of an entropy-fix threshold for a Roe-type numerical scheme for the inviscid Burgers' equation, its conceptual extension to the Euler equations, and a numerical confirmation of the derived bound. The validation of the problem statement confirms that it is scientifically sound, well-posed, and contains all necessary information to proceed.\n\n### Part 1: Derivation of the Entropy Fix Threshold\n\nWe are given the inviscid Burgers' equation, a scalar conservation law of the form $u_t + f(u)_x = 0$, with the convex flux function $f(u) = \\tfrac{1}{2}u^2$. The analysis focuses on a Roe-type approximate Riemann solver at an interface between a left state $u_L$ and a right state $u_R$.\n\nThe Roe-linearized wave speed for Burgers' equation is $a = \\tfrac{1}{2}(u_L + u_R)$. The standard Roe flux is $F_{\\mathrm{Roe}}(u_L, u_R) = \\tfrac{1}{2}\\big(f(u_L)+f(u_R)\\big) - \\tfrac{1}{2}|a|(u_R-u_L)$.\n\nA nonphysical, entropy-violating stationary discontinuity can arise in transonic rarefaction cases, where $u_L  0  u_R$. In such cases, the exact physical solution is a centered rarefaction fan, for which the Godunov flux (the exact Riemann flux) is $F_{\\mathrm{God}} = f(0) = 0$.\n\nTo prevent the entropy violation, the numerical flux must satisfy the entropy condition. For a stationary wave, this means the flux should not select a state that allows information to propagate away from the\ndiscontinuity on both sides, which is what happens with an expansion shock. The condition that guarantees the correct weak solution is that the numerical flux must be less than or equal to the flux at the sonic point, which for Burgers' equation is $f(0)$. Thus, the numerical flux must satisfy $F \\le f(0)=0$.\n\nWe are tasked to find a lower bound on the threshold $\\delta  0$ for the Harten-Hyman entropy fix, such that the modified Roe flux, $F_{\\mathrm{Roe,HH}}$, satisfies this condition. The modified flux is:\n$$F_{\\mathrm{Roe,HH}} = \\tfrac{1}{2}\\big(f(u_L)+f(u_R)\\big) - \\tfrac{1}{2}|a|_{\\delta}(u_R-u_L)$$\nwhere $|a|_{\\delta}$ is given by:\n$$|a|_{\\delta} = \\begin{cases}\n|a|,  |a| \\ge \\delta, \\\\\n\\tfrac{1}{2}\\left(\\dfrac{a^2}{\\delta} + \\delta\\right),  |a|  \\delta.\n\\end{cases}$$\nThe entropy condition to enforce is $F_{\\mathrm{Roe,HH}} \\le F_{\\mathrm{God}}$. For the transonic case $u_L  0  u_R$, this becomes $F_{\\mathrm{Roe,HH}} \\le 0$:\n$$\\tfrac{1}{2}\\big(f(u_L)+f(u_R)\\big) - \\tfrac{1}{2}|a|_{\\delta}(u_R-u_L) \\le 0$$\nSince $u_R - u_L  0$ for a rarefaction, we can rearrange the inequality to solve for $|a|_{\\delta}$:\n$$|a|_{\\delta}(u_R-u_L) \\ge f(u_L)+f(u_R)$$\n$$|a|_{\\delta} \\ge \\frac{f(u_L)+f(u_R)}{u_R-u_L}$$\nSubstituting $f(u) = \\tfrac{1}{2}u^2$:\n$$|a|_{\\delta} \\ge \\frac{\\tfrac{1}{2}u_L^2 + \\tfrac{1}{2}u_R^2}{u_R-u_L} = \\frac{u_L^2 + u_R^2}{2(u_R-u_L)}$$\nLet's denote the right-hand side as $K = \\frac{u_L^2 + u_R^2}{2(u_R-u_L)}$. The entropy fix is designed to be active when $|a|$ is small, i.e., $|a|  \\delta$. Assuming this condition holds, we substitute the second case of the definition of $|a|_{\\delta}$:\n$$\\tfrac{1}{2}\\left(\\dfrac{a^2}{\\delta} + \\delta\\right) \\ge K$$\nSince $\\delta  0$, we can multiply by $2\\delta$ without changing the inequality direction:\n$$a^2 + \\delta^2 \\ge 2K\\delta$$\n$$\\delta^2 - 2K\\delta + a^2 \\ge 0$$\nThis is a quadratic inequality for $\\delta$. The roots of the corresponding equation $\\delta^2 - 2K\\delta + a^2 = 0$ are $\\delta = K \\pm \\sqrt{K^2 - a^2}$. The inequality holds for $\\delta$ outside these roots. Let's compute the term under the square root:\n$$K^2 - a^2 = \\left(\\frac{u_L^2 + u_R^2}{2(u_R-u_L)}\\right)^2 - \\left(\\frac{u_L+u_R}{2}\\right)^2 = \\frac{(u_L^2+u_R^2)^2 - (u_L+u_R)^2(u_R-u_L)^2}{4(u_R-u_L)^2}$$\nThe numerator simplifies to $(u_L^2+u_R^2)^2 - (u_R^2-u_L^2)^2 = 4u_L^2 u_R^2$. Thus,\n$$K^2 - a^2 = \\frac{4u_L^2 u_R^2}{4(u_R-u_L)^2} = \\left(\\frac{u_L u_R}{u_R-u_L}\\right)^2$$\nSince we are in the transonic case $u_L  0  u_R$, we have $u_L u_R  0$, so $\\sqrt{K^2 - a^2} = \\frac{-u_L u_R}{u_R-u_L}$. The two roots are:\n$$\\delta_1 = K - \\frac{-u_L u_R}{u_R-u_L} = \\frac{u_L^2+u_R^2+2u_Lu_R}{2(u_R-u_L)} = \\frac{(u_L+u_R)^2}{2(u_R-u_L)}$$\n$$\\delta_2 = K + \\frac{-u_L u_R}{u_R-u_L} = \\frac{u_L^2+u_R^2-2u_Lu_R}{2(u_R-u_L)} = \\frac{(u_R-u_L)^2}{2(u_R-u_L)} = \\frac{u_R-u_L}{2}$$\nThe inequality $\\delta^2 - 2K\\delta + a^2 \\ge 0$ is satisfied if $\\delta \\ge \\delta_2$ or $\\delta \\le \\delta_1$. We must check which solution is consistent with our assumption $|a|  \\delta$.\n\nLet's check consistency for $\\delta \\ge \\delta_2$. We need to ensure that choosing $\\delta = \\delta_2$ is compatible with $|a|  \\delta$.\nThe condition is $|a|  \\delta_2$, which is $|\\tfrac{1}{2}(u_L+u_R)|  \\tfrac{1}{2}(u_R-u_L)$, or $|u_L+u_R|  u_R-u_L$. Squaring both sides yields $(u_L+u_R)^2  (u_R-u_L)^2$, which simplifies to $4u_Lu_R  0$, or $u_Lu_R  0$. This is true by definition of the transonic case. Thus, the choice $\\delta \\ge \\delta_2$ is consistent.\n\nThe condition $\\delta \\le \\delta_1$ is not a valid choice for a lower bound on $\\delta$. We seek the minimum $\\delta$ that guarantees the entropy condition, which corresponds to the smallest value satisfying $\\delta \\ge \\delta_2$.\n\nThe minimum threshold is therefore $\\delta_{\\min} = \\delta_2 = \\frac{u_R-u_L}{2}$.\n\nThis lower bound represents a minimum entropy production requirement. The dissipation term in the modified Roe flux is $\\tfrac{1}{2}|a|_{\\delta}(u_R-u_L)$. Enforcing the condition $F_{\\mathrm{Roe,HH}} \\le 0$ requires that this dissipation term be large enough to overwhelm the anti-dissipative term $\\tfrac{1}{2}(f(u_L)+f(u_R))$. By setting $\\delta \\ge \\delta_{\\min}$, we ensure that sufficient numerical dissipation (i.e., entropy production) is introduced at the sonic point to prevent the formation of the unphysical stationary expansion shock and select the physically correct rarefaction wave. The mathematical entropy $U(u)=\\tfrac{1}{2}u^2$ for the correct weak solution must satisfy an entropy inequality; our enforcement of $F_{\\mathrm{Roe,HH}} \\le F_{\\mathrm{God}}$ is a sufficient condition to satisfy this inequality at the discrete level for this specific anomaly.\n\n### Part 2: Mapping to the 1D Compressible Euler Equations\n\nThe 1D compressible Euler equations form a system of conservation laws, $\\mathbf{U}_t + \\mathbf{F}(\\mathbf{U})_x = 0$. A Roe solver for this system diagonalizes the problem by projecting the jump in conserved variables, $\\Delta\\mathbf{U} = \\mathbf{U}_R - \\mathbf{U}_L$, onto the eigenvectors of a Roe-averaged Jacobian matrix, $\\tilde{A}$. The flux is given by:\n$$F_{\\mathrm{Roe}} = \\tfrac{1}{2}(\\mathbf{F}_L + \\mathbf{F}_R) - \\tfrac{1}{2} \\sum_{k=1}^3 |\\tilde{\\lambda}_k| \\alpha_k \\tilde{\\mathbf{r}}_k$$\nHere, $\\tilde{\\lambda}_k$ are the eigenvalues of $\\tilde{A}$ (the wave speeds), $\\tilde{\\mathbf{r}}_k$ are the right eigenvectors, and $\\alpha_k$ are the wave strengths. This formulation treats the system as a superposition of three scalar advection problems, one for each characteristic field.\n\nAn entropy-violating expansion shock can occur for any characteristic field $k$ if its corresponding eigenvalue crosses zero across the interface, while the wave itself is a rarefaction. For a given field $k$, let its characteristic speed be $\\lambda_k$. The condition for a transonic rarefaction is $\\lambda_{k,L}  0  \\lambda_{k,R}$, where $\\lambda_{k,L}$ and $\\lambda_{k,R}$ are the eigenvalues of the Jacobian matrix evaluated at the left and right states, respectively.\n\nThe scalar analysis from Part 1 can be applied to each characteristic field independently. The mapping is as follows:\n- The scalar velocity $u$ is analogous to the characteristic speed $\\lambda_k$.\n- The Roe-averaged speed $a$ is analogous to the Roe-averaged eigenvalue $\\tilde{\\lambda}_k$.\n- The states $u_L$ and $u_R$ map to the characteristic speeds at the left and right states, $\\lambda_{k,L}$ and $\\lambda_{k,R}$.\n\nThe scalar bound $\\delta_{\\min} = \\frac{u_R-u_L}{2}$ is based on the jump in wave propagation speed across the interface. Applying this logic to the $k$-th characteristic field of the Euler equations, the jump is $\\lambda_{k,R}-\\lambda_{k,L}$. Therefore, the minimum entropy-fix threshold for the $k$-th field, $\\delta_{k,\\min}$, is:\n$$\\delta_{k,\\min} = C(\\lambda_{k,R} - \\lambda_{k,L})$$\nwhere $C$ is a constant, and our scalar derivation suggests $C = \\tfrac{1}{2}$. In practice, different practitioners may use slightly different formulations, but the principle is that the threshold should scale with the difference in characteristic speeds across the interface. The Harten-Hyman fix is then applied to each $|\\tilde{\\lambda}_k|$ individually using its own threshold $\\delta_k$, constructed based on $\\lambda_{k,L}$ and $\\lambda_{k,R}$.\n\n### Part 3: Numerical Confirmation\n\nThe derived formula for the minimum threshold required to fix the transonic anomaly in Burgers' equation is $\\delta_{\\min} = \\tfrac{1}{2}(u_R-u_L)$. This formula was derived under the condition that the flow is a transonic rarefaction, i.e., $u_L  0  u_R$.\n\nFor the given test cases, we apply this formula if the conditions are met.\n- **Transonic Cases (A, B, C, E):** For these cases, $u_L  0  u_R$. The derived formula applies directly.\n- **Non-Transonic Case (D):** For case D, $(u_L, u_R) = (1.0, 2.0)$, we have $0 \\le u_L  u_R$. This is a rarefaction, but it is entirely supersonic. For such cases, the standard Roe flux is known to be exact and entropy-satisfying ($F_{\\mathrm{Roe}} = F_{\\mathrm{God}} = f(u_L)$). Since there is no entropy violation to correct, no modification to the flux is necessary. Therefore, the *minimum* required threshold $\\delta_{\\min}$ is $0$. Any choice of $\\delta \\in [0, |a|]$ would result in the unmodified, correct Roe flux. The minimum of this set is $0$.\n\nThe computation proceeds as follows for each pair $(u_L, u_R)$:\n1. If $u_L  0$ and $u_R  0$, calculate $\\delta_{\\min} = \\frac{u_R - u_L}{2}$.\n2. Otherwise, set $\\delta_{\\min} = 0$.\n\nApplying this logic to the test suite:\n- **Case A:** $(u_L, u_R) = (-1.0, 1.0)$. Transonic. $\\delta_{\\min} = \\frac{1.0 - (-1.0)}{2} = 1.0$.\n- **Case B:** $(u_L, u_R) = (-0.2, 1.3)$. Transonic. $\\delta_{\\min} = \\frac{1.3 - (-0.2)}{2} = 0.75$.\n- **Case C:** $(u_L, u_R) = (-10^{-6}, 2.0)$. Transonic. $\\delta_{\\min} = \\frac{2.0 - (-10^{-6})}{2} = 1.0000005$.\n- **Case D:** $(u_L, u_R) = (1.0, 2.0)$. Non-transonic. $\\delta_{\\min} = 0.0$.\n- **Case E:** $(u_L, u_R) = (-2.0, 0.5)$. Transonic. $\\delta_{\\min} = \\frac{0.5 - (-2.0)}{2} = 1.25$.\n\nThe following code calculates these values.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the minimum Harten-Hyman entropy-fix threshold delta_min\n    for several test cases of the Burgers' equation.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (u_L, u_R).\n    test_cases = [\n        (-1.0, 1.0),          # Case A\n        (-0.2, 1.3),          # Case B\n        (-1e-6, 2.0),         # Case C\n        (1.0, 2.0),           # Case D\n        (-2.0, 0.5),          # Case E\n    ]\n\n    results = []\n    for case in test_cases:\n        u_L, u_R = case\n\n        # The derived lower bound for the threshold delta is applicable only\n        # in the transonic rarefaction case (u_L  0  u_R), where the\n        # standard Roe solver may fail. The formula derived is\n        # delta_min = (u_R - u_L) / 2.\n        if u_L  0 and u_R  0:\n            delta_min = (u_R - u_L) / 2.0\n        else:\n            # For other rarefaction cases (like u_L, u_R  0 or u_L, u_R  0)\n            # or shock cases (u_L  u_R), the standard Roe solver does not\n            # exhibit this particular entropy failure. Therefore, no correction\n            # is needed, and the minimum required threshold is 0.\n            delta_min = 0.0\n            \n        results.append(delta_min)\n\n    # Format the results as a comma-separated list of strings,\n    # with each value rounded to 10 decimal places, enclosed in brackets.\n    formatted_results = [f\"{res:.10f}\" for res in results]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3314395"}, {"introduction": "The final step is to synthesize our understanding into a working implementation for a physically relevant system. This culminating practice guides you through the construction of a complete Roe solver for the one-dimensional Euler equations, integrating the Harten-Hyman entropy fix on a per-eigenvalue basis. You will translate the theoretical components—from Roe averages to the eigenstructure and the entropy-fix logic—into a functional numerical tool capable of handling a variety of gas dynamics problems. [@problem_id:3314345]", "problem": "You are asked to design and implement, from first principles, the one-dimensional Roe approximate Riemann solver with a per-eigenvalue Harten–Hyman entropy fix for the compressible Euler equations of gas dynamics with ideal gas closure. Begin from the conservation form of the one-dimensional Euler equations and derive the cell-face numerical flux needed by a cell-centered finite-volume scheme. Then define and compute the eigenstructure at the Roe-averaged state needed for the Roe linearization, and apply the Harten–Hyman entropy fix per eigenvalue using left and right physical eigenvalues to detect transonic rarefactions. Your implementation must explicitly construct the right-eigenvector matrix $R$, compute its inverse $R^{-1}$ numerically, and build the dissipative flux using the modified spectral radii $\\phi_{\\delta}(\\lambda)$ at each face. The final program must compute requested scalar outputs for a provided test suite of left/right states.\n\nFundamental base and definitions to use:\n- The one-dimensional Euler equations in conservation form are\n$$\n\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\frac{\\partial \\boldsymbol{F}(\\boldsymbol{U})}{\\partial x} = 0,\n$$\nwith conserved state $\\boldsymbol{U} = [\\rho,\\ \\rho u,\\ E]^{\\top}$ and flux\n$$\n\\boldsymbol{F}(\\boldsymbol{U}) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E + p) \\end{bmatrix}.\n$$\n- Ideal gas closure with ratio of specific heats $\\gamma$: \n$$\np = (\\gamma - 1)\\left(E - \\tfrac{1}{2} \\rho u^2\\right), \\quad a = \\sqrt{\\gamma \\frac{p}{\\rho}},\n$$\nwhere $a$ is the speed of sound, and total enthalpy $H$ is\n$$\nH = \\frac{E + p}{\\rho}.\n$$\n- Roe averages for left and right primitive states $(\\rho_L,u_L,p_L)$ and $(\\rho_R,u_R,p_R)$ are defined as follows. Let $\\tilde{\\rho} = \\sqrt{\\rho_L}\\sqrt{\\rho_R}$ and $w_L = \\sqrt{\\rho_L}$, $w_R = \\sqrt{\\rho_R}$. Then\n$$\n\\tilde{u} = \\frac{w_L u_L + w_R u_R}{w_L + w_R}, \\quad H_L = \\frac{E_L + p_L}{\\rho_L}, \\quad H_R = \\frac{E_R + p_R}{\\rho_R}, \\quad \\tilde{H} = \\frac{w_L H_L + w_R H_R}{w_L + w_R},\n$$\nand the Roe-averaged speed of sound is\n$$\n\\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\tfrac{1}{2} \\tilde{u}^2\\right)}.\n$$\n- Roe eigenstructure at the Roe state $(\\tilde{u}, \\tilde{a}, \\tilde{H})$:\n  - Eigenvalues (characteristic speeds)\n  $$\n  \\tilde{\\lambda}_1 = \\tilde{u} - \\tilde{a}, \\quad \\tilde{\\lambda}_2 = \\tilde{u}, \\quad \\tilde{\\lambda}_3 = \\tilde{u} + \\tilde{a}.\n  $$\n  - Right eigenvector matrix $R$ with columns corresponding to these waves:\n  $$\n  R = \\begin{bmatrix}\n  1  1  1 \\\\\n  \\tilde{u} - \\tilde{a}  \\tilde{u}  \\tilde{u} + \\tilde{a} \\\\\n  \\tilde{H} - \\tilde{u}\\tilde{a}  \\tfrac{1}{2}\\tilde{u}^2  \\tilde{H} + \\tilde{u}\\tilde{a}\n  \\end{bmatrix},\n  $$\n  and $R^{-1}$ is the inverse of $R$.\n- Harten–Hyman entropy fix per eigenvalue modifies the spectral radius by replacing $|\\tilde{\\lambda}_k|$ with the function $\\phi_{\\delta_k}(\\tilde{\\lambda}_k)$:\n  $$\n  \\phi_{\\delta}(\\lambda) = \n  \\begin{cases}\n  \\tfrac{1}{2}\\left(\\dfrac{\\lambda^2}{\\delta} + \\delta\\right),  \\text{if } |\\lambda|  \\delta, \\\\\n  |\\lambda|,  \\text{if } |\\lambda| \\ge \\delta,\n  \\end{cases}\n  $$\n  where the transonic detection and per-wave threshold $\\delta_k$ are taken from the left and right physical eigenvalues\n  $$\n  \\lambda_{k,L} = u_L + s_k a_L, \\quad \\lambda_{k,R} = u_R + s_k a_R, \\quad s_1 = -1,\\ s_2 = 0,\\ s_3 = +1,\n  $$\n  via\n  $$\n  \\delta_k = \n  \\begin{cases}\n  \\lambda_{k,R} - \\lambda_{k,L},  \\text{if } \\lambda_{k,L}  0 \\text{ and } \\lambda_{k,R}  0, \\\\\n  0,  \\text{otherwise}.\n  \\end{cases}\n  $$\n- Roe numerical flux with entropy fix at a face is\n  $$\n  \\widehat{\\boldsymbol{F}}(\\boldsymbol{U}_L,\\boldsymbol{U}_R) = \\tfrac{1}{2} \\left[\\boldsymbol{F}(\\boldsymbol{U}_L) + \\boldsymbol{F}(\\boldsymbol{U}_R)\\right] - \\tfrac{1}{2} \\, R \\, \\left|\\Lambda\\right|_{\\phi} \\, R^{-1} \\, \\left(\\boldsymbol{U}_R - \\boldsymbol{U}_L\\right),\n  $$\n  where $\\left|\\Lambda\\right|_{\\phi} = \\mathrm{diag}\\left(\\phi_{\\delta_1}(\\tilde{\\lambda}_1), \\phi_{\\delta_2}(\\tilde{\\lambda}_2), \\phi_{\\delta_3}(\\tilde{\\lambda}_3)\\right)$.\n\nTask:\n- Implement a program that, for each test case specified below, computes:\n  1. The three entropy-corrected spectral radii $\\phi_{\\delta_k}(\\tilde{\\lambda}_k)$ for $k = 1,2,3$ in the order $(\\tilde{\\lambda}_1,\\tilde{\\lambda}_2,\\tilde{\\lambda}_3)$.\n  2. The second (momentum) component of the Roe numerical flux $\\widehat{\\boldsymbol{F}}$.\n- All variables are nondimensional, so no physical units are required. All angles are irrelevant. No percentages are involved.\n- For numerical reporting, round each floating-point result to $8$ decimal places.\n\nTest suite:\nFor each case, the input is $(\\rho_L,u_L,p_L)$ and $(\\rho_R,u_R,p_R)$ with $\\gamma = 1.4$.\n- Case A (smooth contact, no transonic crossing): $(\\rho_L,u_L,p_L) = (1.0, 0.0, 1.0)$, $(\\rho_R,u_R,p_R) = (2.0, 0.0, 1.0)$.\n- Case B (transonic rarefaction in left-going acoustic wave): $(\\rho_L,u_L,p_L) = (1.0, -0.2, 0.4)$, $(\\rho_R,u_R,p_R) = (0.5, 1.8, 0.4)$.\n- Case C (strong shock-like jump, no transonic crossing): $(\\rho_L,u_L,p_L) = (1.0, 3.0, 1.0)$, $(\\rho_R,u_R,p_R) = (3.0, 0.0, 4.0)$.\n- Case D (near-zero crossing in contact wave): $(\\rho_L,u_L,p_L) = (1.0, -10^{-6}, 1.0)$, $(\\rho_R,u_R,p_R) = (1.0, 10^{-6}, 1.0)$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is itself a list of four floats corresponding to a test case:\n  - The three values $\\left[\\phi_{\\delta_1}(\\tilde{\\lambda}_1), \\phi_{\\delta_2}(\\tilde{\\lambda}_2), \\phi_{\\delta_3}(\\tilde{\\lambda}_3)\\right]$, followed by the momentum flux component $\\left[\\widehat{\\boldsymbol{F}}\\right]_2$.\n- Precisely, the printed line must look like\n$$\n\\left[\\left[\\phi_1^{(A)},\\phi_2^{(A)},\\phi_3^{(A)},\\widehat{F}_2^{(A)}\\right],\\left[\\phi_1^{(B)},\\phi_2^{(B)},\\phi_3^{(B)},\\widehat{F}_2^{(B)}\\right],\\left[\\phi_1^{(C)},\\phi_2^{(C)},\\phi_3^{(C)},\\widehat{F}_2^{(C)}\\right],\\left[\\phi_1^{(D)},\\phi_2^{(D)},\\phi_3^{(D)},\\widehat{F}_2^{(D)}\\right]\\right],\n$$\nwith every float rounded to $8$ decimal places.", "solution": "The problem is valid. It presents a clear, self-contained, and scientifically sound task within the field of computational fluid dynamics, specifically concerning the implementation of the Roe approximate Riemann solver with a Harten-Hyman entropy fix for the one-dimensional Euler equations. All necessary physical laws, equations, and numerical definitions are provided, and the test cases are standard benchmarks for such a numerical scheme.\n\nThe following solution details the derivation and implementation of the required numerical flux. The methodology proceeds from first principles, as requested.\n\nA cell-centered finite-volume method for the one-dimensional Euler equations,\n$$\n\\frac{\\partial \\boldsymbol{U}}{\\partial t} + \\frac{\\partial \\boldsymbol{F}(\\boldsymbol{U})}{\\partial x} = 0,\n$$\nrequires the computation of a numerical flux, $\\widehat{\\boldsymbol{F}}$, at each cell interface. The Roe solver approximates the solution to the Riemann problem at an interface between a left state, $\\boldsymbol{U}_L$, and a right state, $\\boldsymbol{U}_R$.\n\nThe state vector of conserved variables is $\\boldsymbol{U} = [\\rho,\\ \\rho u,\\ E]^{\\top}$, and the flux vector is $\\boldsymbol{F}(\\boldsymbol{U}) = [\\rho u, \\rho u^2 + p, u(E + p)]^{\\top}$. The system is closed by the ideal gas equation of state, $p = (\\gamma - 1)(E - \\frac{1}{2} \\rho u^2)$, where $\\gamma$ is the ratio of specific heats. From these primitives, we also define the speed of sound $a = \\sqrt{\\gamma p / \\rho}$ and the total enthalpy $H = (E + p) / \\rho$. Given the primitive variables $(\\rho, u, p)$, the total energy per unit volume $E$ is computed as $E = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho u^2$.\n\nThe core idea of the Roe solver is to linearize the system by introducing a constant matrix, the Roe matrix $\\tilde{A}$, that satisfies the property $\\boldsymbol{F}(\\boldsymbol{U}_R) - \\boldsymbol{F}(\\boldsymbol{U}_L) = \\tilde{A}(\\boldsymbol{U}_R - \\boldsymbol{U}_L)$. This matrix is the flux Jacobian $A = \\partial \\boldsymbol{F}/\\partial \\boldsymbol{U}$ evaluated at a specially constructed \"Roe-averaged\" state. The Roe averages are computed from the left and right states $(\\rho_L, u_L, p_L)$ and $(\\rho_R, u_R, p_R)$:\nLet $w_L = \\sqrt{\\rho_L}$ and $w_R = \\sqrt{\\rho_R}$.\n$$\n\\tilde{u} = \\frac{w_L u_L + w_R u_R}{w_L + w_R}\n$$\n$$\n\\tilde{H} = \\frac{w_L H_L + w_R H_R}{w_L + w_R}, \\quad \\text{where } H_L = \\frac{E_L+p_L}{\\rho_L} \\text{ and } H_R = \\frac{E_R+p_R}{\\rho_R}\n$$\nThe Roe-averaged speed of sound is then derived:\n$$\n\\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\tfrac{1}{2} \\tilde{u}^2\\right)}\n$$\nThe Roe matrix $\\tilde{A}$ has a complete set of real eigenvalues (the characteristic speeds) and corresponding right eigenvectors, evaluated at the Roe-averaged state:\n$$\n\\tilde{\\lambda}_1 = \\tilde{u} - \\tilde{a}, \\quad \\tilde{\\lambda}_2 = \\tilde{u}, \\quad \\tilde{\\lambda}_3 = \\tilde{u} + \\tilde{a}\n$$\nThe matrix of right eigenvectors, $R$, whose columns are the eigenvectors corresponding to $(\\tilde{\\lambda}_1, \\tilde{\\lambda}_2, \\tilde{\\lambda}_3)$, is given as:\n$$\nR = \\begin{bmatrix}\n1  1  1 \\\\\n\\tilde{u} - \\tilde{a}  \\tilde{u}  \\tilde{u} + \\tilde{a} \\\\\n\\tilde{H} - \\tilde{u}\\tilde{a}  \\tfrac{1}{2}\\tilde{u}^2  \\tilde{H} + \\tilde{u}\\tilde{a}\n\\end{bmatrix}\n$$\nThe Roe flux is a centered flux plus a dissipation term based on the upwinded characteristic information. The dissipation is proportional to $|\\tilde{A}|(\\boldsymbol{U}_R - \\boldsymbol{U}_L)$, where $|\\tilde{A}| = R |\\Lambda| R^{-1}$ and $|\\Lambda| = \\mathrm{diag}(|\\tilde{\\lambda}_1|, |\\tilde{\\lambda}_2|, |\\tilde{\\lambda}_3|)$. This yields the standard Roe flux:\n$$\n\\widehat{\\boldsymbol{F}}(\\boldsymbol{U}_L, \\boldsymbol{U}_R) = \\frac{1}{2} \\left[\\boldsymbol{F}(\\boldsymbol{U}_L) + \\boldsymbol{F}(\\boldsymbol{U}_R)\\right] - \\frac{1}{2} R |\\Lambda| R^{-1} (\\boldsymbol{U}_R - \\boldsymbol{U}_L)\n$$\nThe standard Roe solver does not correctly handle transonic rarefactions, which are smooth wave phenomena that the solver may incorrectly capture as a non-physical \"rarefaction shock.\" The Harten-Hyman entropy fix addresses this by modifying the dissipation. The fix identifies when a wave is crossing the sonic point across the interface. This is done by checking the signs of the physical eigenvalues at the left and right states:\n$$\n\\lambda_{k,L} = u_L + s_k a_L, \\quad \\lambda_{k,R} = u_R + s_k a_R, \\quad \\text{for } s_1 = -1, s_2 = 0, s_3 = 1\n$$\nA transonic crossing for the $k$-th wave is detected if $\\lambda_{k,L}  0$ and $\\lambda_{k,R}  0$. In this case, a positive threshold $\\delta_k$ is defined:\n$$\n\\delta_k = \\lambda_{k,R} - \\lambda_{k,L}\n$$\nOtherwise, $\\delta_k = 0$. If a transonic crossing is detected, the absolute value of the Roe eigenvalue, $|\\tilde{\\lambda}_k|$, is replaced by a smoother function $\\phi_{\\delta_k}(\\tilde{\\lambda}_k)$ to add numerical viscosity inside the sonic region:\n$$\n\\phi_{\\delta_k}(\\tilde{\\lambda}_k) = \n\\begin{cases}\n  \\tfrac{1}{2}\\left(\\dfrac{\\tilde{\\lambda}_k^2}{\\delta_k} + \\delta_k\\right),  \\text{if } |\\tilde{\\lambda}_k|  \\delta_k, \\\\\n  |\\tilde{\\lambda}_k|,  \\text{if } |\\tilde{\\lambda}_k| \\ge \\delta_k.\n\\end{cases}\n$$\nIf $\\delta_k = 0$, then $\\phi_0(\\tilde{\\lambda}_k) = |\\tilde{\\lambda}_k|$, and the standard Roe dissipation is recovered for that wave.\n\nThe final Roe numerical flux with the per-eigenvalue Harten-Hyman entropy fix is:\n$$\n\\widehat{\\boldsymbol{F}}(\\boldsymbol{U}_L,\\boldsymbol{U}_R) = \\tfrac{1}{2} \\left[\\boldsymbol{F}(\\boldsymbol{U}_L) + \\boldsymbol{F}(\\boldsymbol{U}_R)\\right] - \\tfrac{1}{2} \\, R \\, \\left|\\Lambda\\right|_{\\phi} \\, R^{-1} \\, \\left(\\boldsymbol{U}_R - \\boldsymbol{U}_L\\right)\n$$\nwhere $\\left|\\Lambda\\right|_{\\phi} = \\mathrm{diag}\\left(\\phi_{\\delta_1}(\\tilde{\\lambda}_1), \\phi_{\\delta_2}(\\tilde{\\lambda}_2), \\phi_{\\delta_3}(\\tilde{\\lambda}_3)\\right)$.\n\nThe implementation proceeds by computing, for each test case:\n1.  The left and right state vectors $\\boldsymbol{U}_L, \\boldsymbol{U}_R$ and flux vectors $\\boldsymbol{F}_L, \\boldsymbol{F}_R$ from the given primitives $(\\rho, u, p)$.\n2.  The Roe-averaged quantities $\\tilde{u}$, $\\tilde{H}$, and $\\tilde{a}$.\n3.  The Roe eigenvalues $\\tilde{\\lambda}_1, \\tilde{\\lambda}_2, \\tilde{\\lambda}_3$.\n4.  The physical eigenvalues $\\lambda_{k,L}, \\lambda_{k,R}$ and the thresholds $\\delta_k$ for $k \\in \\{1,2,3\\}$.\n5.  The entropy-corrected spectral radii $\\phi_{\\delta_k}(\\tilde{\\lambda}_k)$, which constitute the first part of the required output.\n6.  The right eigenvector matrix $R$ and its numerical inverse $R^{-1}$.\n7.  The diagonal matrix $|\\Lambda|_{\\phi}$ with the corrected spectral radii.\n8.  The full numerical flux vector $\\widehat{\\boldsymbol{F}}$ and its second (momentum) component, which is the final part of the required output.\nAll floating-point results are rounded to $8$ decimal places for final reporting.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the specified test cases for the Roe solver with Harten-Hyman entropy fix.\n    \"\"\"\n    gamma = 1.4\n\n    test_cases = [\n        # Case A: Smooth contact\n        {'L': (1.0, 0.0, 1.0), 'R': (2.0, 0.0, 1.0)},\n        # Case B: Transonic rarefaction\n        {'L': (1.0, -0.2, 0.4), 'R': (0.5, 1.8, 0.4)},\n        # Case C: Strong shock-like jump\n        {'L': (1.0, 3.0, 1.0), 'R': (3.0, 0.0, 4.0)},\n        # Case D: Near-zero crossing contact\n        {'L': (1.0, -1e-6, 1.0), 'R': (1.0, 1e-6, 1.0)},\n    ]\n\n    results = []\n    for case_data in test_cases:\n        rho_L, u_L, p_L = case_data['L']\n        rho_R, u_R, p_R = case_data['R']\n        \n        result_tuple = compute_roe_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma)\n        \n        # Format the result list with 8 decimal places for each float\n        formatted_result = [f\"{x:.8f}\" for x in result_tuple]\n        results.append(f\"[{','.join(formatted_result)}]\")\n\n    # Print the final result in the exact required format\n    print(f\"[{','.join(results)}]\")\n\ndef compute_roe_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma):\n    \"\"\"\n    Computes the Roe flux with Harten-Hyman entropy fix for given left and right states.\n\n    Returns:\n        A tuple containing (phi_1, phi_2, phi_3, F_momentum).\n    \"\"\"\n    # Step 1: Compute derived quantities for left and right states\n    # Total energy E = p/(gamma-1) + 0.5 * rho * u^2\n    E_L = p_L / (gamma - 1) + 0.5 * rho_L * u_L**2\n    E_R = p_R / (gamma - 1) + 0.5 * rho_R * u_R**2\n\n    # Conserved state vector U = [rho, rho*u, E]\n    U_L = np.array([rho_L, rho_L * u_L, E_L])\n    U_R = np.array([rho_R, rho_R * u_R, E_R])\n\n    # Flux vector F = [rho*u, rho*u^2 + p, u*(E+p)]\n    F_L = np.array([rho_L * u_L, rho_L * u_L**2 + p_L, u_L * (E_L + p_L)])\n    F_R = np.array([rho_R * u_R, rho_R * u_R**2 + p_R, u_R * (E_R + p_R)])\n    \n    # Speed of sound a = sqrt(gamma*p/rho)\n    a_L = np.sqrt(gamma * p_L / rho_L)\n    a_R = np.sqrt(gamma * p_R / rho_R)\n\n    # Total enthalpy H = (E+p)/rho\n    H_L = (E_L + p_L) / rho_L\n    H_R = (E_R + p_R) / rho_R\n\n    # Step 2: Compute Roe averages\n    sqrt_rho_L = np.sqrt(rho_L)\n    sqrt_rho_R = np.sqrt(rho_R)\n    \n    u_tilde = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / (sqrt_rho_L + sqrt_rho_R)\n    H_tilde = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / (sqrt_rho_L + sqrt_rho_R)\n    a_tilde = np.sqrt((gamma - 1) * (H_tilde - 0.5 * u_tilde**2))\n\n    # Step 3: Compute Roe eigenvalues\n    lambda_tilde_vals = np.array([u_tilde - a_tilde, u_tilde, u_tilde + a_tilde])\n\n    # Step 4: Harten-Hyman entropy fix\n    s_vals = np.array([-1, 0, 1])\n    delta_vals = np.zeros(3)\n    phi_vals = np.zeros(3)\n\n    for k in range(3):\n        lambda_kL = u_L + s_vals[k] * a_L\n        lambda_kR = u_R + s_vals[k] * a_R\n        \n        delta_k = 0.0\n        if lambda_kL  0  lambda_kR:\n            delta_k = lambda_kR - lambda_kL\n        delta_vals[k] = delta_k\n        \n        lambda_tilde_k = lambda_tilde_vals[k]\n        if delta_k > 0 and abs(lambda_tilde_k)  delta_k:\n            phi_vals[k] = 0.5 * (lambda_tilde_k**2 / delta_k + delta_k)\n        else:\n            phi_vals[k] = abs(lambda_tilde_k)\n\n    # Step 5: Construct matrices and compute the numerical flux\n    # Right eigenvector matrix R\n    R = np.array([\n        [1, 1, 1],\n        [u_tilde - a_tilde, u_tilde, u_tilde + a_tilde],\n        [H_tilde - u_tilde * a_tilde, 0.5 * u_tilde**2, H_tilde + u_tilde * a_tilde]\n    ])\n    \n    # Numerical inverse of R\n    R_inv = np.linalg.inv(R)\n\n    # Diagonal matrix of modified spectral radii\n    Lambda_phi = np.diag(phi_vals)\n\n    # Jump in conserved variables\n    dU = U_R - U_L\n\n    # Dissipation term\n    dissipation = 0.5 * (R @ Lambda_phi @ R_inv @ dU)\n    \n    # Final Roe flux with entropy fix\n    F_hat = 0.5 * (F_L + F_R) - dissipation\n\n    # Extract required outputs\n    phi_1, phi_2, phi_3 = phi_vals\n    F_momentum = F_hat[1]\n    \n    return phi_1, phi_2, phi_3, F_momentum\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3314345"}]}