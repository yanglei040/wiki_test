{"hands_on_practices": [{"introduction": "To begin our hands-on exploration, we first simplify the full Euler system to a single scalar conservation law. This exercise focuses on implementing the Godunov numerical flux for the inviscid Burgers' equation, which serves as an essential prototype for nonlinear hyperbolic systems. By coding the logic to resolve local Riemann problems, you will gain direct experience with how the exact wave structure, including shocks and rarefactions, informs the construction of a robust numerical scheme, paying special attention to the critical case of a sonic point where characteristic speeds change sign. [@problem_id:3138345]", "problem": "Consider the scalar conservation law $u_t + f(u)_x = 0$ with the convex flux $f(u) = \\tfrac{1}{2}u^2$ on the real line. The characteristic speed is $f'(u) = u$, so the sonic point is $u = 0$. The Godunov finite volume method for such a scalar law uses, at each cell interface, the exact solution of the local Riemann problem with left state $u_L$ and right state $u_R$ to compute a numerical flux. The numerical flux is the physical flux evaluated at the trace of the exact self-similar solution at the interface, that is, at $x/t = 0$. Pathologies near the sonic point arise when the self-similar Riemann fan degenerates, for example when a rarefaction includes the sonic point or a shock moves with zero speed.\n\nStarting from the fundamental base that defines the exact Riemann solution for a scalar conservation law with convex flux:\n- If $u_L \\le u_R$, the exact solution is a centered rarefaction, which is composed of characteristics with speeds $f'(u)$. The state observed at $x/t = 0$ is determined by whether $0$ lies below, inside, or above the fan of characteristic speeds.\n- If $u_L > u_R$, the exact solution contains a shock satisfying the Rankine–Hugoniot condition with shock speed $s = \\dfrac{f(u_L) - f(u_R)}{u_L - u_R}$, and the admissibility condition that selects the entropy-satisfying solution. The state observed at $x/t = 0$ equals the left state if $s > 0$, equals the right state if $s < 0$, and is stationary if $s = 0$.\n\nYour task is to implement a complete program that, for a specified test suite of Riemann initial data pairs $(u_L, u_R)$, computes the Godunov numerical flux at the interface using the exact Riemann solution at $x/t = 0$. You must specifically handle sonic degeneracy cases where $f'(u) = 0$ is within the rarefaction fan or where the shock speed $s$ is zero.\n\nImplement the program to produce, for each test case, a single real number equal to the Godunov flux $G(u_L, u_R)$ for $f(u) = \\tfrac{1}{2}u^2$, rounded to exactly six decimal places. The program should aggregate all results into a single line containing a comma-separated list enclosed in square brackets.\n\nUse the following test suite of left–right states:\n- Case $1$: $u_L = -1.0$, $u_R = 1.0$.\n- Case $2$: $u_L = 0.2$, $u_R = 1.5$.\n- Case $3$: $u_L = -1.5$, $u_R = -0.2$.\n- Case $4$: $u_L = 1.0$, $u_R = 0.2$.\n- Case $5$: $u_L = -0.2$, $u_R = -1.0$.\n- Case $6$: $u_L = 0.5$, $u_R = -0.5$.\n- Case $7$: $u_L = 0.0$, $u_R = 0.5$.\n- Case $8$: $u_L = -0.5$, $u_R = 0.0$.\n- Case $9$: $u_L = 0.0$, $u_R = 0.0$.\n- Case $10$: $u_L = -10^{-12}$, $u_R = 10^{-12}$.\n\nDesign for coverage:\n- Cases $1$, $7$, $8$, and $10$ probe sonic rarefaction degeneracy where the fan includes $u = 0$.\n- Cases $2$ and $3$ probe rarefaction waves entirely on one side of the sonic point.\n- Cases $4$ and $5$ probe shocks with positive and negative speeds.\n- Case $6$ probes a stationary shock with speed $s = 0$.\n- Case $9$ probes the trivial equilibrium state at the sonic point.\n\nFinal output format:\n- The program must print exactly one line containing a single list of the computed fluxes, rounded to six decimal places, as a comma-separated list enclosed in square brackets. For example, a valid output line has the form $[a_1,a_2,\\dots,a_{10}]$ with each $a_k$ shown to six decimals.", "solution": "The problem is valid. It is scientifically grounded in the theory of hyperbolic conservation laws, specifically the Riemann problem for the inviscid Burgers' equation. The problem is well-posed, providing a complete and consistent set of rules to determine a unique Godunov numerical flux for any given pair of left and right states. The language is objective and the task is computationally feasible.\n\nThe problem requires the computation of the Godunov numerical flux, $G(u_L, u_R)$, for the scalar conservation law $u_t + f(u)_x = 0$ with the convex flux function $f(u) = \\frac{1}{2}u^2$. The Godunov flux is defined as the physical flux evaluated at the state $u(x/t=0)$ which arises from the exact solution to the Riemann problem with initial data $(u_L, u_R)$.\n\nThe state at the interface, $u_{God} = u(x/t=0)$, is determined by analyzing the self-similar solution of the Riemann problem. The characteristic speed for this flux function is $f'(u) = u$. The sonic point, where the characteristic speed is zero, is at $u=0$. We must analyze two primary cases based on the initial states $u_L$ and $u_R$.\n\n**Case 1: Rarefaction Wave ($u_L \\le u_R$)**\n\nWhen $u_L \\le u_R$, the exact solution is a centered rarefaction wave. The solution within the wave is continuous and consists of characteristics originating from the origin with speeds in the range $[f'(u_L), f'(u_R)] = [u_L, u_R]$. The state observed at the interface line $x/t = 0$ corresponds to the value of $u$ for which the characteristic speed is zero, i.e., $f'(u) = u = 0$, provided this speed is part of the rarefaction fan.\n\n*   If $u_L \\le 0 \\le u_R$, the fan of characteristic speeds $[u_L, u_R]$ includes $0$. The state at the interface is the sonic state, $u_{God} = 0$. The flux is $G(u_L, u_R) = f(0) = \\frac{1}{2}(0)^2 = 0$. This handles sonic degeneracy where the rarefaction fan straddles the sonic point.\n\n*   If $0 < u_L \\le u_R$, the entire fan of characteristic speeds is positive. The rarefaction wave moves to the right. The region at and to the left of the wave (including $x/t=0$) retains the left state. Thus, $u_{God} = u_L$. The flux is $G(u_L, u_R) = f(u_L) = \\frac{1}{2}u_L^2$.\n\n*   If $u_L \\le u_R < 0$, the entire fan of characteristic speeds is negative. The rarefaction wave moves to the left. The region at and to the right of the wave (including $x/t=0$) is occupied by the right state. Thus, $u_{God} = u_R$. The flux is $G(u_L, u_R) = f(u_R) = \\frac{1}{2}u_R^2$.\n\n**Case 2: Shock Wave ($u_L > u_R$)**\n\nWhen $u_L > u_R$, the solution is a discontinuous shock wave. The shock's speed, $s$, is given by the Rankine-Hugoniot condition:\n$$s = \\frac{f(u_L) - f(u_R)}{u_L - u_R}$$\nFor the flux $f(u) = \\frac{1}{2}u^2$, this simplifies to:\n$$s = \\frac{\\frac{1}{2}u_L^2 - \\frac{1}{2}u_R^2}{u_L - u_R} = \\frac{\\frac{1}{2}(u_L - u_R)(u_L + u_R)}{u_L - u_R} = \\frac{u_L + u_R}{2}$$\nThe state at the interface $x/t=0$ depends on the direction of the shock's movement, which is determined by the sign of $s$.\n\n*   If $s > 0$, the shock moves to the right. The state at the interface is the state to the left of the shock, which is $u_L$. Thus, $u_{God} = u_L$. The flux is $G(u_L, u_R) = f(u_L) = \\frac{1}{2}u_L^2$.\n\n*   If $s < 0$, the shock moves to the left. The state at the interface is the state to the right of the shock, which is $u_R$. Thus, $u_{God} = u_R$. The flux is $G(u_L, u_R) = f(u_R) = \\frac{1}{2}u_R^2$.\n\n*   If $s = 0$, the shock is stationary. This occurs when $u_L + u_R = 0$, i.e., $u_R = -u_L$. The states $u_L$ and $u_R$ persist for $x<0$ and $x>0$ respectively. The flux must be continuous across a stationary shock, which is indeed the case: $f(u_L) = \\frac{1}{2}u_L^2 = \\frac{1}{2}(-u_R)^2 = f(u_R)$. The Godunov flux is this constant value, $G(u_L, u_R) = f(u_L) = f(u_R)$. We can unify this with the $s>0$ case by adopting the convention that if $s \\ge 0$, we use the left state $u_L$ to compute the flux.\n\nApplying this logic to the provided test cases:\n*   **Case 1:** ($u_L = -1.0, u_R = 1.0$) $\\implies u_L \\le 0 \\le u_R$, rarefaction. $u_{God} = 0$. Flux $G = f(0) = 0$.\n*   **Case 4:** ($u_L = 1.0, u_R = 0.2$) $\\implies u_L > u_R$, shock. $s = (1.0 + 0.2)/2 = 0.6 > 0$. $u_{God} = u_L = 1.0$. Flux $G = f(1.0) = 0.5$.\n*   **Case 6:** ($u_L = 0.5, u_R = -0.5$) $\\implies u_L > u_R$, shock. $s = (0.5 - 0.5)/2 = 0$. Stationary shock. $u_{God} = u_L = 0.5$. Flux $G = f(0.5) = 0.125$.\n\nThe implementation will follow this case-by-case analysis for each pair $(u_L, u_R)$ in the test suite.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the Godunov flux for a series of Riemann problems\n    for the inviscid Burgers' equation.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (-1.0, 1.0),       # Case 1\n        (0.2, 1.5),        # Case 2\n        (-1.5, -0.2),      # Case 3\n        (1.0, 0.2),        # Case 4\n        (-0.2, -1.0),      # Case 5\n        (0.5, -0.5),       # Case 6\n        (0.0, 0.5),        # Case 7\n        (-0.5, 0.0),       # Case 8\n        (0.0, 0.0),        # Case 9\n        (-1e-12, 1e-12),   # Case 10\n    ]\n\n    results = []\n    for u_L, u_R in test_cases:\n        flux = compute_godunov_flux(u_L, u_R)\n        # Format to exactly six decimal places as required.\n        results.append(f\"{flux:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef flux_function(u: float) -> float:\n    \"\"\"\n    Computes the physical flux f(u) = 0.5 * u^2.\n    \"\"\"\n    return 0.5 * u**2\n\ndef compute_godunov_flux(u_L: float, u_R: float) -> float:\n    \"\"\"\n    Calculates the Godunov numerical flux G(u_L, u_R) for the convex\n    flux f(u) = 0.5 * u^2.\n\n    The logic is based on the exact solution to the Riemann problem at x/t = 0.\n    The characteristic speed is f'(u) = u. The sonic point is u = 0.\n\n    Args:\n        u_L: The left state of the Riemann problem.\n        u_R: The right state of the Riemann problem.\n\n    Returns:\n        The Godunov numerical flux.\n    \"\"\"\n    u_god = 0.0\n\n    # Case 1: Rarefaction wave (u_L <= u_R)\n    if u_L <= u_R:\n        # If the fan of characteristics [u_L, u_R] includes the sonic point speed 0,\n        # the state at the interface is the sonic state.\n        if u_L <= 0.0 and u_R >= 0.0:\n            u_god = 0.0\n        # If the fan is entirely to the right (positive speeds), the wave moves right.\n        # The state at x/t=0 is the left state.\n        elif u_L > 0.0:\n            u_god = u_L\n        # If the fan is entirely to the left (negative speeds), the wave moves left.\n        # The state at x/t=0 is the right state.\n        else:  # This implies u_R < 0\n            u_god = u_R\n\n    # Case 2: Shock wave (u_L > u_R)\n    else:\n        # Shock speed s = (f(u_L) - f(u_R)) / (u_L - u_R) = 0.5 * (u_L + u_R)\n        s = 0.5 * (u_L + u_R)\n        \n        # If shock is stationary (s=0) or moves right (s>0),\n        # the state at x/t=0 is the left state.\n        if s >= 0.0:\n            u_god = u_L\n        # If shock moves left (s<0), the state at x/t=0 is the right state.\n        else:\n            u_god = u_R\n            \n    return flux_function(u_god)\n\nsolve()\n```", "id": "3138345"}, {"introduction": "While the Godunov flux uses an exact Riemann solution, many practical schemes employ more computationally efficient approximate Riemann solvers. This practice introduces the widely-used Roe solver, which is based on a local linearization of the governing equations. You will implement a complete finite-difference scheme and confront a classic pathology of simple Roe solvers: their tendency to produce non-physical expansion shocks. The core of this exercise is to implement and calibrate a Harten-style \"entropy fix,\" providing deep insight into the delicate balance between numerical dissipation and the physical entropy condition required for accurate shock-capturing. [@problem_id:3380629]", "problem": "Implement a complete program that constructs, analyzes, and calibrates a finite-difference Roe scheme with an entropy fix for the scalar, inviscid Burgers conservation law. The goal is to remove non-physical expansion shocks in transonic rarefactions while preserving accuracy on weak shocks through systematic calibration of the added dissipation. Begin from core definitions and well-tested facts about hyperbolic conservation laws, the Riemann problem, and conservative discretizations.\n\nConsider the scalar hyperbolic conservation law\n$$\nu_t + f(u)_x = 0,\n$$\nwith Burgers flux\n$$\nf(u) = \\tfrac{1}{2}u^2.\n$$\nUse a uniform grid on the domain $[-1,1]$ with $N$ cells of width $\\Delta x = 2/N$ and cell centers $x_i = -1 + \\left(i + \\tfrac{1}{2}\\right)\\Delta x$ for $i=0,1,\\dots,N-1$. Let the initial condition be a Riemann problem\n$$\nu(x,0) = \n\\begin{cases}\nu_L, & x < 0,\\\\\nu_R, & x \\ge 0,\n\\end{cases}\n$$\nwith transmissive (zero-gradient) boundary conditions. Evolve to a final time $T>0$ using explicit forward Euler time stepping constrained by the Courant–Friedrichs–Lewy (CFL) condition: at each time step, choose\n$$\n\\Delta t = \\nu \\frac{\\Delta x}{\\max_i |u_i| + \\varepsilon_{\\text{safe}}},\n$$\nwhere $\\nu \\in (0,1)$ is the Courant–Friedrichs–Lewy number and $\\varepsilon_{\\text{safe}}$ is a tiny positive number to avoid division by zero.\n\nUse a conservative, semi-discrete finite-difference method based on a numerical flux at cell interfaces:\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right).\n$$\nImplement the Roe flux with an entropy fix. For the scalar case, the Roe linearization speed is\n$$\n\\tilde{\\lambda}(u_L,u_R) = \\frac{f(u_R)-f(u_L)}{u_R-u_L} = \\tfrac{1}{2}(u_L+u_R),\n$$\nfor $u_L \\neq u_R$ (and any consistent value when $u_L = u_R$). The Roe numerical flux is\n$$\nF_{\\text{Roe}}(u_L,u_R) = \\tfrac{1}{2}\\left(f(u_L)+f(u_R)\\right) - \\tfrac{1}{2}\\,|\\tilde{\\lambda}|\\, (u_R-u_L).\n$$\nTo enforce the entropy condition and remove the non-physical expansion shock in transonic rarefactions ($u_L < 0 < u_R$), replace $|\\tilde{\\lambda}|$ by a smoothed dissipation function that increases the dissipation near sonic points. Use the Harten entropy fix form:\n$$\n\\phi(\\tilde{\\lambda};\\delta) = \n\\begin{cases}\n|\\tilde{\\lambda}|, & |\\tilde{\\lambda}| \\ge \\delta,\\\\\n\\tfrac{1}{2}\\left(\\frac{\\tilde{\\lambda}^2}{\\delta} + \\delta\\right), & |\\tilde{\\lambda}| < \\delta,\n\\end{cases}\n$$\nwith a local threshold\n$$\n\\delta = \\epsilon \\,\\max\\left(|u_L|,|u_R|,|\\tilde{\\lambda}|\\right) + \\varepsilon_{\\min},\n$$\nwhere $\\epsilon > 0$ is a dimensionless calibration parameter and $\\varepsilon_{\\min}$ is a tiny positive number. The entropy-fixed Roe flux is then\n$$\nF_{\\text{Roe+EF}}(u_L,u_R;\\epsilon) = \\tfrac{1}{2}\\left(f(u_L)+f(u_R)\\right) - \\tfrac{1}{2}\\,\\phi(\\tilde{\\lambda};\\delta)\\,(u_R-u_L).\n$$\n\nCompute the exact self-similar solution of the Burgers Riemann problem at time $t>0$ to quantify numerical error:\n- If $u_L < u_R$ (rarefaction), then\n$$\nu(x,t) = \n\\begin{cases}\nu_L, & \\xi \\le u_L,\\\\\n\\xi, & u_L < \\xi < u_R,\\\\\nu_R, & \\xi \\ge u_R,\n\\end{cases}\n\\qquad \\text{with } \\xi = \\frac{x}{t}.\n$$\n- If $u_L > u_R$ (shock), then the shock speed is $s = \\frac{f(u_L)-f(u_R)}{u_L-u_R} = \\tfrac{1}{2}(u_L+u_R)$ and\n$$\nu(x,t) = \n\\begin{cases}\nu_L, & x < s t,\\\\\nu_R, & x \\ge s t.\n\\end{cases}\n$$\n\nDefine the discrete $L^1$ error at time $T$ by\n$$\nE_1 = \\sum_{i=0}^{N-1} |u_i(T) - u_{\\text{exact}}(x_i,T)|\\,\\Delta x.\n$$\n\nCalibration task. Select $\\epsilon$ from the candidate set\n$$\n\\mathcal{E} = \\{0.02, 0.05, 0.10, 0.20\\}\n$$\nby minimizing the discrete $L^1$ error $E_1$ on a weak shock test case. Break ties by choosing the smallest $\\epsilon$ that attains the minimum error.\n\nTest suite. Use the following three Riemann problems with a common grid and time step selection:\n- Case A (transonic rarefaction): $u_L = -1.0$, $u_R = 1.0$, $T = 0.20$, $N = 400$, $\\nu = 0.45$.\n- Case B (weak shock, for calibration): $u_L = 1.05$, $u_R = 1.00$, $T = 0.20$, $N = 400$, $\\nu = 0.45$.\n- Case C (moderate shock): $u_L = 1.00$, $u_R = 0.00$, $T = 0.20$, $N = 400$, $\\nu = 0.45$.\n\nProgram requirements:\n- Implement the entropy-fixed Roe scheme as described, using explicit forward Euler time stepping and transmissive boundary conditions.\n- Calibrate $\\epsilon$ by minimizing $E_1$ on Case B over $\\mathcal{E}$.\n- With the calibrated $\\epsilon$, compute the discrete $L^1$ errors on Cases A, B, and C.\n- Final output format: Your program should produce a single line of output containing a list of four decimal numbers in the format\n$$\n[\\epsilon_{\\text{opt}}, E_1^{\\text{A}}, E_1^{\\text{B}}, E_1^{\\text{C}}],\n$$\nwhere $\\epsilon_{\\text{opt}} \\in \\mathcal{E}$ is the selected calibration value, and $E_1^{\\text{A}}$, $E_1^{\\text{B}}$, $E_1^{\\text{C}}$ are the corresponding $L^1$ errors for Cases A, B, and C. No units are involved, and no angles are used. Express all numbers as decimal floating-point values. The output must be exactly one line containing the list, with values separated by commas and enclosed in square brackets.", "solution": "The user-provided problem is assessed to be **valid**. It is a well-posed, scientifically grounded problem in the field of numerical analysis for partial differential equations. The problem is self-contained, with all necessary data, equations, and conditions clearly specified. The task is to implement a standard numerical method (Roe scheme with Harten entropy fix) for a classic model equation (inviscid Burgers' equation) and perform a calibration and error analysis. The requirements are formal, objective, and internally consistent.\n\nThe solution is implemented by following these steps, which directly correspond to the problem's specifications.\n\n### 1. Problem Formulation and Governing Equations\n\nThe problem addresses the numerical solution of the scalar, nonlinear hyperbolic conservation law given by:\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial f(u)}{\\partial x} = 0\n$$\nwhere $u(x,t)$ is the conserved quantity and $f(u)$ is the flux function. For the inviscid Burgers' equation, the flux is:\n$$\nf(u) = \\frac{1}{2}u^2\n$$\nThe problem is posed on a spatial domain $x \\in [-1, 1]$ with an initial condition defined by a Riemann problem:\n$$\nu(x,0) = \n\\begin{cases}\nu_L, & x < 0 \\\\\nu_R, & x \\ge 0\n\\end{cases}\n$$\n\n### 2. Numerical Discretization\n\nA uniform grid with $N$ cells is used. The width of each cell is $\\Delta x = 2/N$, and the cell centers are located at $x_i = -1 + (i + 1/2)\\Delta x$ for $i=0, 1, \\dots, N-1$.\n\nA semi-discrete, conservative finite-difference method is employed. The time evolution of the solution in cell $i$ is governed by:\n$$\n\\frac{du_i}{dt} = - \\frac{1}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right)\n$$\nwhere $u_i(t)$ is the cell-averaged value of the solution in cell $i$, and $F_{i\\pm1/2}$ are the numerical fluxes at the cell interfaces.\n\nFor time integration, the explicit forward Euler method is used:\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right)\n$$\nwhere $u_i^n$ is the solution at time $t_n$. The time step $\\Delta t$ is dynamically chosen to satisfy the Courant–Friedrichs–Lewy (CFL) stability condition:\n$$\n\\Delta t = \\nu \\frac{\\Delta x}{\\max_i |u_i^n| + \\varepsilon_{\\text{safe}}}\n$$\nHere, $\\nu \\in (0,1)$ is the CFL number, and $\\varepsilon_{\\text{safe}}$ is a small positive constant to prevent division by zero.\n\nTransmissive (zero-gradient) boundary conditions are applied at $x = \\pm 1$. This is implemented by setting the solution in ghost cells equal to the value in the adjacent interior cell, e.g., $u_{-1} = u_0$ and $u_N = u_{N-1}$.\n\n### 3. Entropy-Fixed Roe Flux\n\nThe core of the spatial discretization is the numerical flux, for which the Roe scheme with a Harten-style entropy fix is specified.\n\nThe standard Roe flux for a scalar problem is:\n$$\nF_{\\text{Roe}}(u_L, u_R) = \\frac{1}{2}\\left(f(u_L) + f(u_R)\\right) - \\frac{1}{2}|\\tilde{\\lambda}(u_L, u_R)|(u_R - u_L)\n$$\nwhere $u_L$ and $u_R$ are the states to the left and right of an interface, respectively. The Roe-linearized speed $\\tilde{\\lambda}$ for the Burgers' equation is the arithmetic mean of the characteristic speeds $u_L$ and $u_R$:\n$$\n\\tilde{\\lambda}(u_L, u_R) = \\frac{f(u_R) - f(u_L)}{u_R - u_L} = \\frac{\\frac{1}{2}u_R^2 - \\frac{1}{2}u_L^2}{u_R - u_L} = \\frac{1}{2}(u_L + u_R)\n$$\nThe standard Roe flux can incorrectly admit non-physical expansion shocks where the solution should be a smooth rarefaction wave (i.e., when $u_L < 0 < u_R$). To remedy this, an entropy fix is introduced by modifying the dissipation term $|\\tilde{\\lambda}|$. The absolute value function is replaced by a smoothed function $\\phi(\\tilde{\\lambda}; \\delta)$:\n$$\n\\phi(\\tilde{\\lambda};\\delta) = \n\\begin{cases}\n|\\tilde{\\lambda}|, & \\text{if } |\\tilde{\\lambda}| \\ge \\delta \\\\\n\\frac{1}{2}\\left(\\frac{\\tilde{\\lambda}^2}{\\delta} + \\delta\\right), & \\text{if } |\\tilde{\\lambda}| < \\delta\n\\end{cases}\n$$\nThis modification increases the numerical dissipation near \"sonic points\" where $\\tilde{\\lambda} \\approx 0$. The threshold $\\delta$ is set locally for each interface:\n$$\n\\delta = \\epsilon \\,\\max\\left(|u_L|,|u_R|,|\\tilde{\\lambda}|\\right) + \\varepsilon_{\\min}\n$$\nwhere $\\epsilon$ is a tunable parameter and $\\varepsilon_{\\min}$ is a small positive constant. The final entropy-fixed Roe flux is:\n$$\nF_{\\text{Roe+EF}}(u_L, u_R) = \\frac{1}{2}\\left(f(u_L) + f(u_R)\\right) - \\frac{1}{2}\\phi(\\tilde{\\lambda};\\delta)(u_R - u_L)\n$$\n\n### 4. Calibration and Error Analysis\n\nThe parameter $\\epsilon$ controls the amount of added dissipation. It must be calibrated. The problem specifies a calibration procedure based on minimizing the discrete $L^1$ error on a weak shock test case (Case B). The $L^1$ error is defined as:\n$$\nE_1 = \\sum_{i=0}^{N-1} |u_i(T) - u_{\\text{exact}}(x_i, T)| \\Delta x\n$$\nwhere $u_{\\text{exact}}$ is the analytical solution to the Riemann problem. The candidate set for $\\epsilon$ is $\\mathcal{E} = \\{0.02, 0.05, 0.10, 0.20\\}$. The value $\\epsilon_{\\text{opt}} \\in \\mathcal{E}$ is chosen that yields the minimum $E_1$ for Case B, with ties broken by selecting the smallest $\\epsilon$.\n\nThe exact self-similar solution $u_{\\text{exact}}(x,t)$ depends on the initial states:\n- **Rarefaction ($u_L < u_R$)**: The solution depends on $\\xi = x/t$.\n$$\nu(x,t) = \n\\begin{cases}\nu_L, & \\xi \\le u_L \\\\\n\\xi, & u_L < \\xi < u_R \\\\\nu_R, & \\xi \\ge u_R\n\\end{cases}\n$$\n- **Shock ($u_L > u_R$)**: The solution is a travelling step-wave with shock speed $s = \\frac{1}{2}(u_L+u_R)$.\n$$\nu(x,t) = \n\\begin{cases}\nu_L, & x < s t \\\\\nu_R, & x \\ge s t\n\\end{cases}\n$$\n\n### 5. Implementation Plan\n\nThe overall algorithm is as follows:\n1.  Define the parameters for the three test cases (A, B, C) and the set of candidate $\\epsilon$ values.\n2.  **Calibration**: Iterate through each $\\epsilon \\in \\mathcal{E}$. For each `eps`, run a simulation for Case B until the final time $T$. Compute the $L^1$ error against the exact solution.\n3.  Select $\\epsilon_{\\text{opt}}$ as the value that minimized the error in the previous step, respecting the tie-breaking rule.\n4.  **Evaluation**: With the determined $\\epsilon_{\\text{opt}}$, run simulations for all three cases (A, B, and C).\n5.  Compute and store the $L^1$ error for each case.\n6.  Format the final output as a list containing $\\epsilon_{\\text{opt}}$ and the three calculated errors for cases A, B, and C.\n\nThe implementation uses `numpy` for efficient vectorized operations, particularly in the flux calculation across all cell interfaces.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Execution Environment:\n# language: Python\n# version: 3.12\n# libraries:\n#     - name: numpy, version: 1.23.5\n#     - name: scipy, version: 1.11.4\n\ndef roe_flux_vectorized(u_l, u_r, epsilon):\n    \"\"\"\n    Computes the entropy-fixed Roe flux for the Burgers' equation in a \n    vectorized manner.\n    \"\"\"\n    epsilon_min = 1e-12\n\n    # Burgers flux f(u) = 0.5 * u^2\n    f_l = 0.5 * u_l**2\n    f_r = 0.5 * u_r**2\n    \n    # Roe average speed\n    lambda_tilde = 0.5 * (u_l + u_r)\n    \n    # Harten entropy fix threshold (delta)\n    max_val = np.maximum(np.abs(u_l), np.abs(u_r))\n    max_val = np.maximum(max_val, np.abs(lambda_tilde))\n    delta = epsilon * max_val + epsilon_min\n\n    # Modified dissipation term (phi)\n    abs_lambda = np.abs(lambda_tilde)\n    phi = np.where(abs_lambda >= delta, \n                   abs_lambda, \n                   0.5 * (lambda_tilde**2 / delta + delta))\n\n    # Final entropy-fixed Roe flux\n    return 0.5 * (f_l + f_r) - 0.5 * phi * (u_r - u_l)\n\ndef run_simulation(u_L, u_R, T, N, nu, epsilon):\n    \"\"\"\n    Runs a simulation of the Burgers' equation for a given Riemann problem.\n    \"\"\"\n    dx = 2.0 / N\n    x = -1.0 + (np.arange(N) + 0.5) * dx\n    \n    # Initial condition\n    u = np.where(x < 0, u_L, u_R)\n    \n    t = 0.0\n    epsilon_safe = 1e-12\n    \n    while t < T:\n        # CFL-based time step\n        max_speed = np.max(np.abs(u))\n        dt = nu * dx / (max_speed + epsilon_safe)\n        \n        # Ensure we don't step over the final time T\n        if t + dt > T:\n            dt = T - t\n            \n        # Padded array for transmissive (zero-gradient) boundary conditions\n        u_padded = np.empty(N + 2)\n        u_padded[0] = u[0]\n        u_padded[N+1] = u[N-1]\n        u_padded[1:-1] = u\n        \n        # Left and right states at interfaces\n        u_ls = u_padded[:-1]\n        u_rs = u_padded[1:]\n        \n        # Calculate fluxes at N+1 interfaces\n        fluxes = roe_flux_vectorized(u_ls, u_rs, epsilon)\n        \n        # Update solution using forward Euler\n        u = u - (dt / dx) * (fluxes[1:] - fluxes[:-1])\n        \n        t += dt\n        \n    return u, x, dx\n\ndef exact_solution(x, t, u_l, u_r):\n    \"\"\"\n    Computes the exact solution of the Burgers' Riemann problem.\n    \"\"\"\n    if u_l < u_r:  # Rarefaction\n        if t == 0:\n            return np.where(x < 0, u_l, u_r)\n        xi = x / t\n        sol = np.full_like(x, xi)\n        sol = np.where(xi <= u_l, u_l, sol)\n        sol = np.where(xi >= u_r, u_r, sol)\n        return sol\n    else:  # Shock\n        s = 0.5 * (u_l + u_r)\n        return np.where(x < s * t, u_l, u_r)\n\ndef solve():\n    \"\"\"\n    Main function to perform calibration and evaluation.\n    \"\"\"\n    test_cases = {\n        'A': {'uL': -1.0, 'uR': 1.0, 'T': 0.20, 'N': 400, 'nu': 0.45},\n        'B': {'uL': 1.05, 'uR': 1.00, 'T': 0.20, 'N': 400, 'nu': 0.45},\n        'C': {'uL': 1.00, 'uR': 0.00, 'T': 0.20, 'N': 400, 'nu': 0.45},\n    }\n    \n    epsilon_candidates = [0.02, 0.05, 0.10, 0.20]\n\n    # --- Calibration Phase ---\n    # Calibrate epsilon using Case B (weak shock)\n    errors_B_calib = []\n    calib_params = test_cases['B']\n    for eps in epsilon_candidates:\n        u_num, x_grid, dx = run_simulation(\n            calib_params['uL'], calib_params['uR'], calib_params['T'],\n            calib_params['N'], calib_params['nu'], eps\n        )\n        u_exact_val = exact_solution(\n            x_grid, calib_params['T'], calib_params['uL'], calib_params['uR']\n        )\n        error = np.sum(np.abs(u_num - u_exact_val)) * dx\n        errors_B_calib.append(error)\n        \n    # Find optimal epsilon: minimizing L1 error on Case B.\n    # .index() finds the first occurrence, breaking ties by choosing smallest epsilon.\n    min_error = min(errors_B_calib)\n    chosen_index = errors_B_calib.index(min_error)\n    epsilon_opt = epsilon_candidates[chosen_index]\n    \n    # --- Evaluation Phase ---\n    # Compute L1 errors for all cases using the optimal epsilon\n    final_errors = {}\n    for case_name, params in test_cases.items():\n        u_num, x_grid, dx = run_simulation(\n            params['uL'], params['uR'], params['T'],\n            params['N'], params['nu'], epsilon_opt\n        )\n        u_exact_val = exact_solution(\n            x_grid, params['T'], params['uL'], params['uR']\n        )\n        error = np.sum(np.abs(u_num - u_exact_val)) * dx\n        final_errors[case_name] = error\n\n    # Prepare and print final output\n    results = [\n        epsilon_opt, \n        final_errors['A'], \n        final_errors['B'], \n        final_errors['C']\n    ]\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3380629"}, {"introduction": "Having built foundational skills with scalar models, we now return to the full system of Euler equations. This capstone practice guides you through the process of creating a complete, exact Riemann solver from first principles. You will implement a robust root-finding algorithm to determine the constant pressure and velocity in the \"star region\" and then develop the logic to sample the solution across the entire wave fan, including shocks, contact discontinuities, and rarefactions. Completing this exercise demonstrates a comprehensive mastery of the Riemann problem's structure and its analytical solution, a cornerstone of modern computational gas dynamics. [@problem_id:3379532]", "problem": "Consider the one-dimensional Riemann problem for the Euler equations of gas dynamics with an ideal gas equation of state, within the field of Computational Fluid Dynamics (CFD). The unknowns are the mass density $\\rho(x,t)$, the velocity $u(x,t)$, and the pressure $p(x,t)$. The governing conservation laws are the Euler equations, written in primitive-variable form as the system\n$$\n\\frac{\\partial}{\\partial t}\n\\begin{pmatrix}\n\\rho \\\\\nu \\\\\np\n\\end{pmatrix}\n+\n\\frac{\\partial}{\\partial x}\n\\begin{pmatrix}\n\\rho u \\\\\n\\rho u^2 + p \\\\\nu (E + p)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 \\\\\n0 \\\\\n0\n\\end{pmatrix},\n$$\nwhere the total energy density satisfies $E = \\frac{p}{\\gamma - 1} + \\frac{1}{2} \\rho u^2$, and $\\gamma$ is the ratio of specific heats. The constitutive relation is the ideal gas law, and the local sound speed satisfies $c = \\sqrt{\\gamma p / \\rho}$. At time $t = 0$, the initial data are two constant states separated by a single discontinuity at $x = 0$:\n$$\n(\\rho, u, p)(x,0) =\n\\begin{cases}\n(\\rho_L, u_L, p_L), & x < 0, \\\\\n(\\rho_R, u_R, p_R), & x > 0.\n\\end{cases}\n$$\nThe exact self-similar solution for $t > 0$ consists of two nonlinear waves (each a shock or a centered rarefaction) separated by a material contact discontinuity, with constant pressure and velocity in the intermediate star region. This problem asks you to derive and implement an exact Riemann solver based on first principles and the Rankine–Hugoniot conditions, and to use it to produce verification metrics and sampled solution values.\n\nFundamental base for the derivation:\n- Conservation of mass, momentum, and energy as encoded in the Euler equations.\n- The ideal gas closure with constant ratio of specific heats $\\gamma$.\n- The definition of the local sound speed $c = \\sqrt{\\gamma p / \\rho}$.\n- The Rankine–Hugoniot jump conditions across a shock and the isentropic relations across a centered rarefaction.\n\nTarget derivation and numerical algorithm:\n1. Show, without assuming any pre-derived solver formulas, that the star-region pressure $p^*$ can be determined as the unique root of a strictly monotone nonlinear function constructed from the Rankine–Hugoniot relations in the shock case and the isentropic self-similar relations in the rarefaction case. Define, for each side $k \\in \\{L,R\\}$, the wave function $f_k(p)$ that gives the velocity change required to connect the initial state $(\\rho_k,u_k,p_k)$ to a state with pressure $p$ through either a shock (using the Rankine–Hugoniot jump relations) or a centered rarefaction (using the self-similar characteristics and isentropic invariants). Then derive that the equation\n$$\n\\Phi(p) = f_L(p) + f_R(p) + (u_R - u_L) = 0\n$$\nhas a unique solution $p = p^*$ under non-vacuum conditions.\n2. Show that, once $p^*$ is known, the star-region velocity $u^*$ follows from conservation and compatibility as\n$$\nu^* = \\frac{1}{2} \\left( u_L + u_R \\right) + \\frac{1}{2} \\left( f_R(p^*) - f_L(p^*) \\right).\n$$\n3. Show how to compute the left and right star-region densities $\\rho_L^*$ and $\\rho_R^*$ using either the shock compression ratio from the Rankine–Hugoniot conditions (shock case) or the isentropic relation linked through the sound speed ratio (rarefaction case).\n4. Determine the nonlinear wave speeds. For a left shock, derive the shock speed $S_L$ from the Rankine–Hugoniot relations and the sound speed $c_L$; for a left rarefaction, derive the head speed $S_{L,\\mathrm{head}} = u_L - c_L$ and the tail speed $S_{L,\\mathrm{tail}} = u^* - c_L^*$, where $c_L^* = c_L \\left( \\frac{p^*}{p_L} \\right)^{(\\gamma - 1)/(2 \\gamma)}$. Analogous formulas hold for the right wave: shock speed $S_R$ or rarefaction head $S_{R,\\mathrm{head}} = u_R + c_R$ and tail $S_{R,\\mathrm{tail}} = u^* + c_R^*$ with $c_R^* = c_R \\left( \\frac{p^*}{p_R} \\right)^{(\\gamma - 1)/(2 \\gamma)}$.\n5. Derive the self-similar sampling formulas inside a rarefaction fan using the characteristic invariants $u \\pm \\frac{2 c}{\\gamma - 1}$ and the relations $s = \\frac{x}{t} = u \\mp c$ (minus for a left rarefaction, plus for a right rarefaction). Show that inside the left rarefaction fan,\n$$\nu(s) = \\frac{\\gamma - 1}{\\gamma + 1} u_L + \\frac{2}{\\gamma + 1} \\left( c_L + s \\right), \\quad\nc(s) = u(s) - s, \\quad\n\\frac{p(s)}{p_L} = \\left( \\frac{c(s)}{c_L} \\right)^{\\frac{2 \\gamma}{\\gamma - 1}}, \\quad\n\\frac{\\rho(s)}{\\rho_L} = \\left( \\frac{c(s)}{c_L} \\right)^{\\frac{2}{\\gamma - 1}}.\n$$\nSimilarly, inside the right rarefaction fan,\n$$\nu(s) = \\frac{\\gamma - 1}{\\gamma + 1} u_R + \\frac{2}{\\gamma + 1} \\left( - c_R + s \\right), \\quad\nc(s) = s - u(s), \\quad\n\\frac{p(s)}{p_R} = \\left( \\frac{c(s)}{c_R} \\right)^{\\frac{2 \\gamma}{\\gamma - 1}}, \\quad\n\\frac{\\rho(s)}{\\rho_R} = \\left( \\frac{c(s)}{c_R} \\right)^{\\frac{2}{\\gamma - 1}}.\n$$\n6. Construct a robust root-finding method (for example, bisection) for $p^*$ using the monotonicity of $\\Phi(p)$, and then implement the sampling logic that, given $s = x/t$, selects the appropriate region (left initial, left rarefaction, left star, contact, right star, right rarefaction, right initial) and computes $(\\rho, u, p)(s)$ accordingly.\n\nVerification metrics:\n- For each shock wave present, compute the mass-flux consistency metric using the Rankine–Hugoniot conditions. For the left shock, verify $\\rho_L (u_L - S_L) = \\rho_L^* (u^* - S_L)$; for the right shock, verify $\\rho_R (S_R - u_R) = \\rho_R^* (S_R - u^*)$. Report the maximum absolute mismatch across the two sides as a nonnegative scalar.\n- Sample the exact self-similar solution at a specified similarity coordinate $s = x/t$ and report the primitive variables $(\\rho, u, p)$ in each test case.\n\nUnits and output specification:\n- All quantities are nondimensional; report all outputs in dimensionless units.\n- Your program must produce a single line of output containing the aggregated results of all test cases as a comma-separated list enclosed in square brackets. For each test case, output the four values $[\\rho(s), u(s), p(s), \\mathrm{res}]$, where $\\mathrm{res}$ is the maximum mass-flux mismatch across shocks as described above. The overall output must therefore be a flat list of $4 N$ floating-point values, where $N$ is the number of test cases, printed in a single line in the exact format $[v_1,v_2,\\dots,v_{4N}]$.\n\nTest suite:\nProvide the following test cases, each specified by $(\\gamma, \\rho_L, u_L, p_L, \\rho_R, u_R, p_R, t, x)$, with $s = x/t$:\n\n- Case 1: $(\\gamma, \\rho_L, u_L, p_L, \\rho_R, u_R, p_R, t, x) = (1.4, 0.9, 0.0, 1.2, 0.3, 0.0, 0.9, 0.18, 0.03)$. Thus $s = x/t = 0.166\\overline{6}$.\n- Case 2: $(\\gamma, \\rho_L, u_L, p_L, \\rho_R, u_R, p_R, t, x) = (1.3, 1.0, 0.5, 1.0, 0.7, -0.2, 0.4, 0.12, 0.04)$. Thus $s = x/t = 0.333\\overline{3}$.\n- Case 3: $(\\gamma, \\rho_L, u_L, p_L, \\rho_R, u_R, p_R, t, x) = (1.67, 1.0, -1.0, 0.2, 0.5, 1.5, 0.2, 0.10, -0.05)$. Thus $s = x/t = -0.5$.\n- Case 4: $(\\gamma, \\rho_L, u_L, p_L, \\rho_R, u_R, p_R, t, x) = (1.4, 3.0, 15.0, 50.0, 1.0, -5.0, 5.0, 0.02, 0.0)$. Thus $s = x/t = 0.0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test cases, where each test contributes $[\\rho(s), u(s), p(s), \\mathrm{res}]$ with $\\mathrm{res} \\ge 0$ a floating-point number.", "solution": "The user-provided problem is a well-posed and scientifically sound exercise in computational fluid dynamics, specifically the exact solution of the Riemann problem for the one-dimensional Euler equations. The problem is valid and all necessary data and constraints are provided. We proceed with a complete solution.\n\nThe solution to the Riemann problem for the Euler equations is self-similar, meaning the primitive variables $(\\rho, u, p)$ depend only on the similarity coordinate $s=x/t$. The solution structure consists of five constant or self-similar regions separated by four waves: a left-traveling wave (shock or rarefaction), a contact discontinuity, and a right-traveling wave (shock or rarefaction). The regions are: the initial left state (L), the left star state (L*), the right star state (R*), and the initial right state (R). Across the contact discontinuity, pressure and velocity are continuous, so $p_L^* = p_R^* = p^*$ and $u_L^* = u_R^* = u^*$. The densities are discontinuous, $\\rho_L^* \\ne \\rho_R^*$. The contact travels at speed $u^*$.\n\nOur first goal is to determine the unknown pressure $p^*$ and velocity $u^*$ in the star region. These are found by enforcing the condition that the velocity of the fluid on either side of the contact discontinuity must be equal, $u_L^* = u_R^*$. The velocity on each side is a function of the pressure jump from the initial state to the star state pressure $p^*$.\n\n### 1. Derivation of the Star-Region Pressure Equation\n\nLet us derive the relationship between the star-region velocity $u^*$ and pressure $p^*$, separately for the left and right sides. The functions $f_L(p)$ and $f_R(p)$ are defined such that $u^* = u_L - f_L(p^*)$ and $u^* = u_R + f_R(p^*)$. Equating these gives $u_L - f_L(p^*) = u_R + f_R(p^*)$, which rearranges to the nonlinear equation for $p^*$:\n$$\n\\Phi(p) = f_L(p) + f_R(p) + u_R - u_L = 0\n$$\nThe functions $f_k(p)$ depend on whether the wave is a shock or a rarefaction, determined by the sign of $p - p_k$.\n\n**Wave Functions $f_k(p)$ for $k \\in \\{L, R\\}$**\n\nLet $c_k = \\sqrt{\\gamma p_k / \\rho_k}$ be the sound speed in state $k$.\n\n__Case A: Shock Wave ($p > p_k$)__\nThe Rankine-Hugoniot jump conditions relate the states across a shock. For a shock moving into a quiescent medium (state $k$), a key derived relation for the velocity jump is:\n$$\n(u - u_k)^2 = (p - p_k) \\left( \\frac{1}{\\rho_k} - \\frac{1}{\\rho_k^*} \\right)\n$$\nThe density ratio across the shock is also given by the Rankine-Hugoniot conditions:\n$$\n\\frac{\\rho_k^*}{\\rho_k} = \\frac{(\\gamma+1)p + (\\gamma-1)p_k}{(\\gamma-1)p + (\\gamma+1)p_k} = \\frac{\\frac{p}{p_k} + \\frac{\\gamma-1}{\\gamma+1}}{\\frac{\\gamma-1}{\\gamma+1}\\frac{p}{p_k} + 1}\n$$\nSubstituting this into the velocity jump equation yields:\n$$\n(u - u_k)^2 = (p - p_k) \\frac{1}{\\rho_k} \\left( 1 - \\frac{(\\gamma-1)p + (\\gamma+1)p_k}{(\\gamma+1)p + (\\gamma-1)p_k} \\right) = (p - p_k) \\frac{1}{\\rho_k} \\frac{2(p-p_k)}{(\\gamma+1)p + (\\gamma-1)p_k}\n$$\n$$\n|u - u_k| = (p-p_k) \\sqrt{\\frac{2/\\rho_k}{(\\gamma+1)p + (\\gamma-1)p_k}}\n$$\nThis gives the magnitude of the velocity change. For a left-moving shock, $u^* < u_L$, so $u^* - u_L < 0$. For a right-moving shock, $u^* > u_R$, so $u^* - u_R > 0$. The functions $f_L$ and $f_R$ are defined to be positive for shocks:\n$$\nf_k(p) = (p - p_k) \\sqrt{\\frac{2/(\\rho_k(\\gamma+1))}{p + \\frac{\\gamma-1}{\\gamma+1}p_k}} \\quad \\text{for } p > p_k\n$$\nThis choice is consistent with $u^* = u_L - f_L(p^*)$ and $u^* = u_R + f_R(p^*)$.\n\n__Case B: Rarefaction Wave ($p \\le p_k$)__\nAcross a rarefaction wave, the flow is isentropic, i.e., $p/\\rho^\\gamma = \\mathrm{const}$. The Riemann invariants are constant along characteristics.\nFor a left-traveling rarefaction, $u + \\frac{2c}{\\gamma-1}$ is invariant.\n$$\nu_L + \\frac{2c_L}{\\gamma-1} = u^* + \\frac{2c_L^*}{\\gamma-1} \\implies u^* - u_L = \\frac{2}{\\gamma-1}(c_L - c_L^*)\n$$\nFor a right-traveling rarefaction, $u - \\frac{2c}{\\gamma-1}$ is invariant.\n$$\nu_R - \\frac{2c_R}{\\gamma-1} = u^* - \\frac{2c_R^*}{\\gamma-1} \\implies u^* - u_R = -\\frac{2}{\\gamma-1}(c_R - c_R^*)\n$$\nFrom the isentropic relation, $p_k/\\rho_k^\\gamma = p/(\\rho_k^*)^\\gamma$, the sound speed in the star region is $c_k^* = c_k(p/p_k)^{(\\gamma-1)/(2\\gamma)}$.\nSubstituting this, we get:\n$u^* - u_L = \\frac{2c_L}{\\gamma-1}\\left(1 - \\left(\\frac{p}{p_L}\\right)^{(\\gamma-1)/(2\\gamma)}\\right)$\n$u^* - u_R = \\frac{2c_R}{\\gamma-1}\\left(\\left(\\frac{p}{p_R}\\right)^{(\\gamma-1)/(2\\gamma)} - 1\\right)$\nThe functions $f_k(p)$ are defined to be negative for rarefactions:\n$$\nf_k(p) = \\frac{2c_k}{\\gamma-1}\\left( \\left(\\frac{p}{p_k}\\right)^{(\\gamma-1)/(2\\gamma)} - 1 \\right) \\quad \\text{for } p \\le p_k\n$$\nThis is consistent with $u_L - f_L > u_L$ and $u_R + f_R < u_R$.\n\nThe function $\\Phi(p) = f_L(p) + f_R(p) + u_R - u_L$ is a sum of monotonically increasing functions of $p$ (which can be verified by taking derivatives) and is therefore itself strictly monotonically increasing. This guarantees a unique root $p^*$ for $\\Phi(p)=0$ under non-vacuum conditions.\n\n### 2. Derivation of the Star-Region Velocity\n\nOnce the star pressure $p^*$ is found by solving $\\Phi(p^*)=0$, the star velocity $u^*$ can be computed from either of the two-star state relations:\n$$\nu^* = u_L - f_L(p^*)\n$$\n$$\nu^* = u_R + f_R(p^*)\n$$\nA numerically robust approach is to average the two expressions. Since $f_L(p^*) + f_R(p^*) = u_L - u_R$, we have $f_R(p^*) = u_L - u_R - f_L(p^*)$. Adding the two equations for $u^*$ gives:\n$$\n2u^* = u_L - f_L(p^*) + u_R + f_R(p^*) = u_L + u_R + (f_R(p^*) - f_L(p^*))\n$$\n$$\nu^* = \\frac{1}{2}(u_L + u_R) + \\frac{1}{2}(f_R(p^*) - f_L(p^*))\n$$\nThis is the expression required in the problem.\n\n### 3. Computation of Star-Region Densities\n\nThe densities in the star region, $\\rho_L^*$ and $\\rho_R^*$, depend on the wave type. For each side $k \\in \\{L, R\\}$:\n- If $p^* > p_k$ (shock), the density is found using the Rankine-Hugoniot relation for density:\n$$\n\\rho_k^* = \\rho_k \\frac{\\frac{p^*}{p_k} + \\frac{\\gamma-1}{\\gamma+1}}{\\frac{\\gamma-1}{\\gamma+1}\\frac{p^*}{p_k} + 1}\n$$\n- If $p^* \\le p_k$ (rarefaction), the density is found using the isentropic relation $p/\\rho^\\gamma = \\mathrm{const}$:\n$$\n\\rho_k^* = \\rho_k \\left( \\frac{p^*}{p_k} \\right)^{1/\\gamma}\n$$\n\n### 4. Determination of Wave Speeds\n\nThe speeds of the waves demarcating the five regions are as follows:\n\n- **Left Wave:**\n  - If a shock ($p^* > p_L$), its speed $S_L$ is:\n    $$\n    S_L = u_L - c_L \\sqrt{\\frac{\\gamma+1}{2\\gamma}\\frac{p^*}{p_L} + \\frac{\\gamma-1}{2\\gamma}}\n    $$\n  - If a rarefaction ($p^* \\le p_L$), it spans a region. The head travels at $S_{L, \\mathrm{head}} = u_L - c_L$ and the tail at $S_{L, \\mathrm{tail}} = u^* - c_L^*$, where $c_L^* = c_L (p^*/p_L)^{(\\gamma-1)/(2\\gamma)}$.\n\n- **Contact Discontinuity:** Travels at speed $S_C = u^*$.\n\n- **Right Wave:**\n  - If a shock ($p^* > p_R$), its speed $S_R$ is:\n    $$\n    S_R = u_R + c_R \\sqrt{\\frac{\\gamma+1}{2\\gamma}\\frac{p^*}{p_R} + \\frac{\\gamma-1}{2\\gamma}}\n    $$\n  - If a rarefaction ($p^* \\le p_R$), its head travels at $S_{R, \\mathrm{head}} = u_R + c_R$ and its tail at $S_{R, \\mathrm{tail}} = u^* + c_R^*$, where $c_R^* = c_R (p^*/p_R)^{(\\gamma-1)/(2\\gamma)}$.\n\n### 5. Self-Similar Solution within a Rarefaction Fan\n\nInside a rarefaction fan, the solution is not constant but varies smoothly with $s=x/t$. The relations are derived from the characteristic equations.\n\n- **Inside the Left Rarefaction Fan** ($S_{L, \\mathrm{head}} \\le s \\le S_{L, \\text{tail}}$):\nThe characteristic relation is $s = u - c$, and the Riemann invariant is $u + \\frac{2c}{\\gamma-1} = u_L + \\frac{2c_L}{\\gamma-1}$. Solving this system for $u$ and $c$ as functions of $s$:\n$$\nu(s) = \\frac{\\gamma-1}{\\gamma+1}u_L + \\frac{2}{\\gamma+1}(s+c_L)\n$$\n$$\nc(s) = u(s) - s\n$$\nThe isentropic relations give $p$ and $\\rho$:\n$$\n\\frac{p(s)}{p_L} = \\left(\\frac{c(s)}{c_L}\\right)^{\\frac{2\\gamma}{\\gamma-1}}, \\quad \\frac{\\rho(s)}{\\rho_L} = \\left(\\frac{c(s)}{c_L}\\right)^{\\frac{2}{\\gamma-1}}\n$$\n- **Inside the Right Rarefaction Fan** ($S_{R, \\text{tail}} \\le s \\le S_{R, \\mathrm{head}}$):\nThe relations are $s=u+c$ and $u - \\frac{2c}{\\gamma-1} = u_R - \\frac{2c_R}{\\gamma-1}$. Solving yields:\n$$\nu(s) = \\frac{\\gamma-1}{\\gamma+1}u_R + \\frac{2}{\\gamma+1}(s-c_R)\n$$\n$$\nc(s) = s - u(s)\n$$\nAnd the isentropic relations give:\n$$\n\\frac{p(s)}{p_R} = \\left(\\frac{c(s)}{c_R}\\right)^{\\frac{2\\gamma}{\\gamma-1}}, \\quad \\frac{\\rho(s)}{\\rho_R} = \\left(\\frac{c(s)}{c_R}\\right)^{\\frac{2}{\\gamma-1}}\n$$\n\n### 6. Numerical Algorithm and Sampling\n\nThe overall algorithm to find the solution $(\\rho, u, p)$ at a given $s=x/t$ is:\n1.  Solve the nonlinear equation $\\Phi(p^*) = 0$ for the star pressure $p^*$ using a robust root-finding method like bisection. A suitable search interval $[p_\\min, p_\\max]$ must be established, for instance, by checking that $\\Phi(p_\\min) < 0$ and $\\Phi(p_\\max) > 0$.\n2.  Calculate the star velocity $u^*$ using the formula from Part 2.\n3.  Calculate all wave speeds ($S_L$ or S_L,head/tail, $S_R$ or S_R,head/tail, and $u^*$).\n4.  Determine the fluid region in which $s$ lies by comparing it to the wave speeds.\n5.  Return the values of $(\\rho, u, p)$ for that region:\n    - If $s$ is in the L or R initial state, return $(\\rho_k, u_k, p_k)$.\n    - If $s$ is in the L* or R* star state, return $(\\rho_k^*, u^*, p^*)$.\n    - If $s$ is within a rarefaction fan, use the self-similar sampling formulas from Part 5.\n\nThe verification metric for mass-flux consistency across shocks is computed by evaluating the absolute difference in mass flux, $|\\rho(u-S) - \\rho^*(u^*-S)|$, for each shock and taking the maximum.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef wave_function(p, pk, rhok, ck, gamma):\n    \"\"\"\n    Computes the wave function f_k(p) used to find the star pressure.\n    This corresponds to the function f(p, p_k, rho_k) in many textbooks.\n    \"\"\"\n    if p > pk:  # Shock wave\n        # Based on (p-pk)*sqrt(A_k / (p + B_k))\n        g_minus_1 = gamma - 1.0\n        g_plus_1 = gamma + 1.0\n        A_k = 2.0 / (g_plus_1 * rhok)\n        B_k = g_minus_1 / g_plus_1 * pk\n        return (p - pk) * np.sqrt(A_k / (p + B_k))\n    else:  # Rarefaction wave\n        g_minus_1 = gamma - 1.0\n        exponent = g_minus_1 / (2.0 * gamma)\n        return (2.0 * ck / g_minus_1) * ((p / pk)**exponent - 1.0)\n\ndef pressure_function(p_star, gamma, rho_l, u_l, p_l, rho_r, u_r, p_r):\n    \"\"\"\n    The nonlinear function Phi(p) = 0 whose root is the star pressure.\n    \"\"\"\n    c_l = np.sqrt(gamma * p_l / rho_l)\n    c_r = np.sqrt(gamma * p_r / rho_r)\n    f_l = wave_function(p_star, p_l, rho_l, c_l, gamma)\n    f_r = wave_function(p_star, p_r, rho_r, c_r, gamma)\n    return f_l + f_r + u_r - u_l\n\ndef solve_riemann(gamma, rho_l, u_l, p_l, rho_r, u_r, p_r, s_sample):\n    \"\"\"\n    An exact Riemann solver for the 1D Euler equations.\n    \"\"\"\n    # 1. Solve for star pressure p_star\n    # Non-vacuum condition check\n    c_l = np.sqrt(gamma * p_l / rho_l)\n    c_r = np.sqrt(gamma * p_r / rho_r)\n    if u_r - u_l > (2.0 / (gamma - 1.0)) * (c_l + c_r):\n        # Vacuum is generated, not handled by this solver as per problem constraints.\n        return np.nan, np.nan, np.nan, np.nan\n\n    # Bisection root-finding for p_star\n    p_min_search = 1e-6\n    p_max_search = max(p_l, p_r) * 10.0\n    for _ in range(20): # Ensure p_max_search brackets the root\n        if pressure_function(p_max_search, gamma, rho_l, u_l, p_l, rho_r, u_r, p_r) > 0:\n            break\n        p_max_search *= 2.0\n\n    p_star = 0.5 * (p_min_search + p_max_search)\n    for _ in range(100): # Bisection iterations\n        phi_star = pressure_function(p_star, gamma, rho_l, u_l, p_l, rho_r, u_r, p_r)\n        if pressure_function(p_min_search, gamma, rho_l, u_l, p_l, rho_r, u_r, p_r) * phi_star < 0:\n            p_max_search = p_star\n        else:\n            p_min_search = p_star\n        p_star_new = 0.5 * (p_min_search + p_max_search)\n        if abs(p_star_new - p_star) < 1e-12:\n            break\n        p_star = p_star_new\n\n    # 2. Solve for star velocity u_star\n    f_l = wave_function(p_star, p_l, rho_l, c_l, gamma)\n    f_r = wave_function(p_star, p_r, rho_r, c_r, gamma)\n    u_star = 0.5 * (u_l + u_r) + 0.5 * (f_r - f_l)\n\n    # 3. Sample the solution at s_sample\n    rho_s, u_s, p_s = 0.0, 0.0, 0.0\n    g_m_1 = gamma - 1.0\n    g_p_1 = gamma + 1.0\n\n    if s_sample < u_star:  # Left of contact\n        if p_star > p_l:  # Left shock\n            S_L = u_l - c_l * np.sqrt(g_p_1 / (2.0 * gamma) * (p_star / p_l) + g_m_1 / (2.0 * gamma))\n            if s_sample < S_L:\n                rho_s, u_s, p_s = rho_l, u_l, p_l\n            else:\n                rho_l_star = rho_l * (p_star / p_l + g_m_1 / g_p_1) / (g_m_1 / g_p_1 * p_star / p_l + 1.0)\n                rho_s, u_s, p_s = rho_l_star, u_star, p_star\n        else:  # Left rarefaction\n            S_L_head = u_l - c_l\n            rho_l_star = rho_l * (p_star / p_l)**(1.0 / gamma)\n            c_l_star = np.sqrt(gamma * p_star / rho_l_star)\n            S_L_tail = u_star - c_l_star\n            if s_sample < S_L_head:\n                rho_s, u_s, p_s = rho_l, u_l, p_l\n            elif s_sample > S_L_tail:\n                rho_s, u_s, p_s = rho_l_star, u_star, p_star\n            else: # Inside fan\n                u_s = (g_m_1 * u_l + 2.0 * (c_l + s_sample)) / g_p_1\n                c_s = u_s - s_sample\n                p_s = p_l * (c_s / c_l)**(2.0 * gamma / g_m_1)\n                rho_s = rho_l * (c_s / c_l)**(2.0 / g_m_1)\n    else:  # Right of contact\n        if p_star > p_r:  # Right shock\n            S_R = u_r + c_r * np.sqrt(g_p_1 / (2.0 * gamma) * (p_star / p_r) + g_m_1 / (2.0 * gamma))\n            if s_sample > S_R:\n                rho_s, u_s, p_s = rho_r, u_r, p_r\n            else:\n                rho_r_star = rho_r * (p_star / p_r + g_m_1 / g_p_1) / (g_m_1 / g_p_1 * p_star / p_r + 1.0)\n                rho_s, u_s, p_s = rho_r_star, u_star, p_star\n        else:  # Right rarefaction\n            S_R_head = u_r + c_r\n            rho_r_star = rho_r * (p_star / p_r)**(1.0 / gamma)\n            c_r_star = np.sqrt(gamma * p_star / rho_r_star)\n            S_R_tail = u_star + c_r_star\n            if s_sample > S_R_head:\n                rho_s, u_s, p_s = rho_r, u_r, p_r\n            elif s_sample < S_R_tail:\n                rho_s, u_s, p_s = rho_r_star, u_star, p_star\n            else: # Inside fan\n                u_s = (g_m_1 * u_r + 2.0 * (s_sample - c_r)) / g_p_1\n                c_s = s_sample - u_s\n                p_s = p_r * (c_s / c_r)**(2.0 * gamma / g_m_1)\n                rho_s = rho_r * (c_s / c_r)**(2.0 / g_m_1)\n\n    # 4. Calculate mass flux residual\n    res = 0.0\n    if p_star > p_l: # Left shock\n        S_L = u_l - c_l * np.sqrt(g_p_1 / (2.0 * gamma) * (p_star / p_l) + g_m_1 / (2.0 * gamma))\n        rho_l_star = rho_l * (p_star / p_l + g_m_1 / g_p_1) / (g_m_1 / g_p_1 * p_star / p_l + 1.0)\n        res_l = abs(rho_l * (u_l - S_L) - rho_l_star * (u_star - S_L))\n        res = max(res, res_l)\n    if p_star > p_r: # Right shock\n        S_R = u_r + c_r * np.sqrt(g_p_1 / (2.0 * gamma) * (p_star / p_r) + g_m_1 / (2.0 * gamma))\n        rho_r_star = rho_r * (p_star / p_r + g_m_1 / g_p_1) / (g_m_1 / g_p_1 * p_star / p_r + 1.0)\n        res_r = abs(rho_r * (S_R - u_r) - rho_r_star * (S_R - u_star))\n        res = max(res, res_r)\n\n    return rho_s, u_s, p_s, res\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (gamma, rho_L, u_L, p_L, rho_R, u_R, p_R, s_sample)\n        (1.4, 0.9, 0.0, 1.2, 0.3, 0.0, 0.9, 0.03 / 0.18),\n        (1.3, 1.0, 0.5, 1.0, 0.7, -0.2, 0.4, 0.04 / 0.12),\n        (1.67, 1.0, -1.0, 0.2, 0.5, 1.5, 0.2, -0.05 / 0.10),\n        (1.4, 3.0, 15.0, 50.0, 1.0, -5.0, 5.0, 0.0 / 0.02),\n    ]\n\n    results = []\n    for case in test_cases:\n        gamma, rho_l, u_l, p_l, rho_r, u_r, p_r, s_sample = case\n        rho_s, u_s, p_s, res = solve_riemann(gamma, rho_l, u_l, p_l, rho_r, u_r, p_r, s_sample)\n        results.extend([rho_s, u_s, p_s, res])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{v:.15f}' for v in results)}]\")\n\nsolve()\n```", "id": "3379532"}]}