{"hands_on_practices": [{"introduction": "Verifying the accuracy of a numerical implementation is a cornerstone of computational mechanics. This first exercise provides a foundational test case by examining a simple one-dimensional bar under creep conditions. By deriving the exact analytical solution for a Perzyna-type viscoplastic material and comparing it to a numerical solution obtained via the Backward Euler method [@problem_id:3521801], you will gain direct experience with time integration schemes and the essential practice of quantifying numerical error.", "problem": "Consider a uniaxial bar made of a linear elastic-overstress viscoplastic solid following the Perzyna model of rate-dependent plasticity with linear isotropic hardening. Assume small strains, isothermal conditions, and uniaxial stress. The total strain $\\varepsilon$ admits the additive decomposition $\\varepsilon = \\varepsilon^{e} + \\varepsilon^{p}$. The uniaxial elastic constitutive relation is $\\sigma = E \\, \\varepsilon^{e}$ with Young’s modulus $E$. The viscoplastic flow is governed by the Perzyna overstress rule with exponent $n=1$,\n$\\dot{\\varepsilon}^{p} = \\frac{1}{\\eta} \\left\\langle f(\\sigma,\\varepsilon^{p}) \\right\\rangle$,\nwhere $\\eta$ is the viscosity parameter, $\\langle \\cdot \\rangle$ denotes the Macaulay bracket $\\langle x \\rangle = \\max(x,0)$, and the uniaxial yield function with linear isotropic hardening is $f(\\sigma,\\varepsilon^{p}) = |\\sigma| - \\sigma_{y} - H \\, \\varepsilon^{p}$ with initial yield stress $\\sigma_{y}$ and hardening modulus $H$. The bar is suddenly loaded at $t=0$ into tension and then held at a constant uniaxial stress $\\sigma(t) = \\sigma_{0}0$ for all $t \\ge 0$. The initial condition is $\\varepsilon^{p}(0)=0$.\n\nTasks:\n1) Starting only from the above definitions and balance of linear momentum in the quasi-static limit (no inertia), derive the analytical expression for the viscoplastic strain $\\varepsilon^{p}(t)$ and the total strain $\\varepsilon(t)$ for $t \\ge 0$ under the constant stress $\\sigma(t)=\\sigma_{0}$, assuming $\\sigma_{0}  \\sigma_{y}$.\n2) Construct the fully implicit Backward Euler (BE) time discretization for the evolution of $\\varepsilon^{p}$ with a constant time step $\\Delta t$, and derive a closed-form expression for $\\varepsilon^{p}$ after $N$ steps, i.e., at $t_{N} = N \\Delta t$, in terms of $E$, $H$, $\\eta$, $\\sigma_{y}$, $\\sigma_{0}$, $\\Delta t$, and $N$.\n3) Using your analytical solution from Task 1 and your BE solution from Task 2, evaluate the absolute error in total strain at the final time $T$,\n$\\left|\\varepsilon_{\\text{exact}}(T) - \\varepsilon_{\\text{BE}}(T)\\right|$,\nfor the following data (International System of Units): $E = 30\\,\\mathrm{GPa}$, $H = 2\\,\\mathrm{GPa}$, $\\eta = 2 \\times 10^{14}\\,\\mathrm{Pa\\,s}$, $\\sigma_{y} = 40\\,\\mathrm{MPa}$, $\\sigma_{0} = 60\\,\\mathrm{MPa}$, $T = 2.0 \\times 10^{5}\\,\\mathrm{s}$, $\\Delta t = 2.5 \\times 10^{4}\\,\\mathrm{s}$, and $N = T/\\Delta t$. Report the error as a pure strain (dimensionless) and round your answer to four significant figures. Express the final number without units.", "solution": "The problem statement is validated as scientifically sound, well-posed, and complete. It describes a standard problem in computational viscoplasticity. All necessary constitutive relations, parameters, and boundary/initial conditions are provided.\n\nThe assumption of quasi-static loading implies that inertial forces are negligible. For a uniaxial bar, this ensures that the axial stress $\\sigma$ is spatially uniform, allowing it to be prescribed as a function of time, $\\sigma(t)$. The problem states that a constant stress $\\sigma(t) = \\sigma_{0}$ is applied for $t \\ge 0$, with $\\sigma_{0}  \\sigma_{y}$.\n\nThe analysis proceeds in three parts as requested.\n\n**Task 1: Analytical solution for strain evolution**\n\nThe total strain $\\varepsilon$ is the sum of the elastic strain $\\varepsilon^{e}$ and the plastic strain $\\varepsilon^{p}$:\n$$\n\\varepsilon(t) = \\varepsilon^{e}(t) + \\varepsilon^{p}(t)\n$$\nThe elastic strain is given by Hooke's law, $\\sigma(t) = E \\, \\varepsilon^{e}(t)$. Since the stress is constant, $\\sigma(t) = \\sigma_{0}$, the elastic strain is also constant:\n$$\n\\varepsilon^{e}(t) = \\frac{\\sigma_{0}}{E}\n$$\nThe evolution of the viscoplastic strain $\\varepsilon^{p}$ is governed by the Perzyna flow rule:\n$$\n\\dot{\\varepsilon}^{p} = \\frac{1}{\\eta} \\left\\langle f(\\sigma,\\varepsilon^{p}) \\right\\rangle\n$$\nwhere the yield function $f$ is given by $f(\\sigma,\\varepsilon^{p}) = |\\sigma| - \\sigma_{y} - H \\, \\varepsilon^{p}$.\nGiven that $\\sigma(t) = \\sigma_{0}  0$, we have $|\\sigma| = \\sigma_{0}$. The yield function becomes $f(\\sigma_{0},\\varepsilon^{p}) = \\sigma_{0} - \\sigma_{y} - H \\, \\varepsilon^{p}$.\nThe initial condition is $\\varepsilon^{p}(0)=0$. At $t=0$, the value of the yield function is $f(\\sigma_0, 0) = \\sigma_0 - \\sigma_y$. Since it is given that $\\sigma_{0}  \\sigma_{y}$, this value is positive. By continuity, $f$ will remain positive for some time interval after $t=0$. The Macaulay bracket can be dropped, $\\left\\langle f \\right\\rangle = f$, as long as $f \\ge 0$. The governing equation for $\\varepsilon^{p}$ is thus a linear first-order ordinary differential equation (ODE):\n$$\n\\frac{d\\varepsilon^{p}}{dt} = \\frac{1}{\\eta} (\\sigma_{0} - \\sigma_{y} - H \\, \\varepsilon^{p})\n$$\nThis can be rearranged into the standard form:\n$$\n\\frac{d\\varepsilon^{p}}{dt} + \\frac{H}{\\eta} \\varepsilon^{p} = \\frac{\\sigma_{0} - \\sigma_{y}}{\\eta}\n$$\nThe solution to this ODE with the initial condition $\\varepsilon^{p}(0)=0$ is found by standard methods. The general solution is the sum of a homogeneous solution $\\varepsilon^{p}_{h}(t) = C \\exp\\left(-\\frac{H}{\\eta}t\\right)$ and a particular solution $\\varepsilon^{p}_{p}(t) = \\frac{\\sigma_{0} - \\sigma_{y}}{H}$.\nThe full solution is $\\varepsilon^{p}(t) = \\frac{\\sigma_{0} - \\sigma_{y}}{H} + C \\exp\\left(-\\frac{H}{\\eta}t\\right)$.\nApplying the initial condition $\\varepsilon^{p}(0)=0$:\n$$\n0 = \\frac{\\sigma_{0} - \\sigma_{y}}{H} + C \\implies C = -\\frac{\\sigma_{0} - \\sigma_{y}}{H}\n$$\nSubstituting $C$ back, we obtain the analytical expression for the viscoplastic strain:\n$$\n\\varepsilon^{p}(t) = \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\exp\\left(-\\frac{H}{\\eta}t\\right) \\right)\n$$\nAs $t \\to \\infty$, $\\varepsilon^{p}(t) \\to \\frac{\\sigma_{0} - \\sigma_{y}}{H}$, which makes $f \\to \\sigma_{0} - \\sigma_{y} - H \\frac{\\sigma_{0} - \\sigma_{y}}{H} = 0$. So the condition $f \\ge 0$ is satisfied for all $t \\ge 0$.\nThe total strain $\\varepsilon(t)$ is then:\n$$\n\\varepsilon(t) = \\frac{\\sigma_{0}}{E} + \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\exp\\left(-\\frac{H}{\\eta}t\\right) \\right)\n$$\n\n**Task 2: Backward Euler (BE) discretization**\n\nWe discretize the time domain with a constant step $\\Delta t$, such that $t_{k} = k \\Delta t$. The Backward Euler scheme approximates the rate $\\dot{\\varepsilon}^{p}$ at time $t_{k+1}$ as $\\frac{\\varepsilon^{p}_{k+1} - \\varepsilon^{p}_{k}}{\\Delta t}$, and evaluates the right-hand side of the ODE at $t_{k+1}$:\n$$\n\\frac{\\varepsilon^{p}_{k+1} - \\varepsilon^{p}_{k}}{\\Delta t} = \\frac{1}{\\eta} \\left\\langle \\sigma_{0} - \\sigma_{y} - H \\varepsilon^{p}_{k+1} \\right\\rangle\n$$\nHere, $\\varepsilon^{p}_{k}$ denotes the numerical approximation of $\\varepsilon^{p}(t_k)$. Assuming plastic flow occurs at step $k+1$ (a consistent assumption given the loading), we can drop the Macaulay bracket:\n$$\n\\frac{\\varepsilon^{p}_{k+1} - \\varepsilon^{p}_{k}}{\\Delta t} = \\frac{1}{\\eta} (\\sigma_{0} - \\sigma_{y} - H \\varepsilon^{p}_{k+1})\n$$\nWe solve for $\\varepsilon^{p}_{k+1}$:\n$$\n\\varepsilon^{p}_{k+1} - \\varepsilon^{p}_{k} = \\frac{\\Delta t}{\\eta} (\\sigma_{0} - \\sigma_{y}) - \\frac{H \\Delta t}{\\eta} \\varepsilon^{p}_{k+1}\n$$\n$$\n\\varepsilon^{p}_{k+1} \\left(1 + \\frac{H \\Delta t}{\\eta}\\right) = \\varepsilon^{p}_{k} + \\frac{\\Delta t}{\\eta} (\\sigma_{0} - \\sigma_{y})\n$$\n$$\n\\varepsilon^{p}_{k+1} = \\frac{1}{1 + \\frac{H \\Delta t}{\\eta}} \\varepsilon^{p}_{k} + \\frac{\\frac{\\Delta t}{\\eta}(\\sigma_{0} - \\sigma_{y})}{1 + \\frac{H \\Delta t}{\\eta}}\n$$\nThis is a linear recurrence relation of the form $\\varepsilon^{p}_{k+1} = A \\varepsilon^{p}_{k} + B$, with $\\varepsilon^{p}_{0}=0$. The solution after $N$ steps is given by $\\varepsilon^{p}_{N} = B \\sum_{k=0}^{N-1} A^k = B \\frac{1 - A^N}{1 - A}$.\nLet's compute the term $\\frac{B}{1-A}$:\n$$\n1 - A = 1 - \\frac{1}{1 + \\frac{H \\Delta t}{\\eta}} = \\frac{H \\Delta t/\\eta}{1 + H \\Delta t/\\eta}\n$$\n$$\n\\frac{B}{1 - A} = \\frac{\\frac{\\frac{\\Delta t}{\\eta}(\\sigma_{0} - \\sigma_{y})}{1 + \\frac{H \\Delta t}{\\eta}}}{\\frac{\\frac{H \\Delta t}{\\eta}}{1 + \\frac{H \\Delta t}{\\eta}}} = \\frac{\\sigma_{0} - \\sigma_{y}}{H}\n$$\nTherefore, the closed-form expression for $\\varepsilon^{p}_{N}$ is:\n$$\n\\varepsilon^{p}_{N} = \\frac{\\sigma_{0} - \\sigma_{y}}{H} (1 - A^N) = \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\left(\\frac{1}{1 + \\frac{H \\Delta t}{\\eta}}\\right)^N \\right)\n$$\nThis can also be written as:\n$$\n\\varepsilon^{p}_{N} = \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\left(1 + \\frac{H \\Delta t}{\\eta}\\right)^{-N} \\right)\n$$\n\n**Task 3: Error calculation**\n\nWe need to evaluate the absolute error in the total strain at time $T = N \\Delta t$:\n$Error = \\left|\\varepsilon_{\\text{exact}}(T) - \\varepsilon_{\\text{BE}}(T)\\right|$.\nThe exact total strain at $T$ is $\\varepsilon_{\\text{exact}}(T) = \\varepsilon^{e}(T) + \\varepsilon^{p}_{\\text{exact}}(T)$.\nThe BE approximated total strain at $T$ is $\\varepsilon_{\\text{BE}}(T) = \\varepsilon^{e}(T) + \\varepsilon^{p}_{N}$.\nThe elastic strain term $\\varepsilon^{e}(T) = \\sigma_{0}/E$ is common to both expressions and cancels out in the difference. The error is solely in the viscoplastic strain component:\n$$\nError = \\left| \\varepsilon^{p}_{\\text{exact}}(T) - \\varepsilon^{p}_{N} \\right|\n$$\nSubstituting the expressions derived in Tasks 1 and 2, with $T=N\\Delta t$:\n$$\nError = \\left| \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\exp\\left(-\\frac{H T}{\\eta}\\right) \\right) - \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left( 1 - \\left(1 + \\frac{H \\Delta t}{\\eta}\\right)^{-N} \\right) \\right|\n$$\n$$\nError = \\frac{\\sigma_{0} - \\sigma_{y}}{H} \\left| \\left(1 + \\frac{H \\Delta t}{\\eta}\\right)^{-N} - \\exp\\left(-\\frac{H T}{\\eta}\\right) \\right|\n$$\nNow, we substitute the given numerical values:\n$E = 30 \\times 10^{9}\\,\\mathrm{Pa}$\n$H = 2 \\times 10^{9}\\,\\mathrm{Pa}$\n$\\eta = 2 \\times 10^{14}\\,\\mathrm{Pa\\,s}$\n$\\sigma_{y} = 40 \\times 10^{6}\\,\\mathrm{Pa}$\n$\\sigma_{0} = 60 \\times 10^{6}\\,\\mathrm{Pa}$\n$T = 2.0 \\times 10^{5}\\,\\mathrm{s}$\n$\\Delta t = 2.5 \\times 10^{4}\\,\\mathrm{s}$\n$N = T/\\Delta t = (2.0 \\times 10^{5}) / (2.5 \\times 10^{4}) = 8$\n\nFirst, calculate the prefactor:\n$$\n\\frac{\\sigma_{0} - \\sigma_{y}}{H} = \\frac{60 \\times 10^{6}\\,\\mathrm{Pa} - 40 \\times 10^{6}\\,\\mathrm{Pa}}{2 \\times 10^{9}\\,\\mathrm{Pa}} = \\frac{20 \\times 10^{6}}{2 \\times 10^{9}} = 1 \\times 10^{-2} = 0.01\n$$\nNext, calculate the arguments of the terms inside the absolute value:\n$$\n\\frac{H \\Delta t}{\\eta} = \\frac{(2 \\times 10^{9}\\,\\mathrm{Pa}) \\times (2.5 \\times 10^{4}\\,\\mathrm{s})}{2 \\times 10^{14}\\,\\mathrm{Pa\\,s}} = \\frac{5 \\times 10^{13}}{2 \\times 10^{14}} = 0.25\n$$\n$$\n\\frac{H T}{\\eta} = \\frac{(2 \\times 10^{9}\\,\\mathrm{Pa}) \\times (2.0 \\times 10^{5}\\,\\mathrm{s})}{2 \\times 10^{14}\\,\\mathrm{Pa\\,s}} = \\frac{4 \\times 10^{14}}{2 \\times 10^{14}} = 2\n$$\nNote that $\\frac{HT}{\\eta} = \\frac{H(N\\Delta t)}{\\eta} = N \\left(\\frac{H\\Delta t}{\\eta}\\right) = 8 \\times 0.25 = 2$, which is consistent.\n\nNow, substitute these into the error formula:\n$$\nError = 0.01 \\times \\left| \\left(1 + 0.25\\right)^{-8} - \\exp(-2) \\right|\n$$\n$$\nError = 0.01 \\times \\left| (1.25)^{-8} - \\exp(-2) \\right|\n$$\n$$\nError = 0.01 \\times \\left| \\left(\\frac{5}{4}\\right)^{-8} - \\exp(-2) \\right| = 0.01 \\times \\left| \\left(\\frac{4}{5}\\right)^{8} - \\exp(-2) \\right|\n$$\n$$\nError = 0.01 \\times \\left| (0.8)^{8} - \\exp(-2) \\right|\n$$\nNow we compute the numerical values:\n$(0.8)^{8} \\approx 0.16777216$\n$\\exp(-2) \\approx 0.13533528$\n$$\nError \\approx 0.01 \\times |0.16777216 - 0.13533528|\n$$\n$$\nError \\approx 0.01 \\times 0.03243688\n$$\n$$\nError \\approx 0.0003243688\n$$\nRounding to four significant figures, the error is $0.0003244$. In scientific notation, this is $3.244 \\times 10^{-4}$.", "answer": "$$\n\\boxed{3.244 \\times 10^{-4}}\n$$", "id": "3521801"}, {"introduction": "Realistic geomaterial models like Mohr-Coulomb introduce a significant numerical challenge: the yield surface is not smooth, featuring sharp edges and corners where the gradient is not uniquely defined. This practice [@problem_id:3521788] delves into the solution to this problem using the mathematical framework of subdifferentials. You will implement an algorithm to detect the stress state's location on the yield surface and compute a unique plastic flow direction, a crucial skill for developing robust return mapping algorithms for advanced constitutive models.", "problem": "Consider a three-dimensional stress state with principal stresses denoted by the vector $\\boldsymbol{\\sigma} = [\\sigma_1,\\sigma_2,\\sigma_3]$ with the convention that no ordering is assumed. In the Mohr-Coulomb model, the yield condition can be expressed in principal stress space using the friction angle $\\varphi$ and cohesion $c$ through the convex function\n$$\nf(\\boldsymbol{\\sigma};\\varphi,c) = \\max(\\sigma_1,\\sigma_2,\\sigma_3) - K(\\varphi)\\,\\min(\\sigma_1,\\sigma_2,\\sigma_3) - 2\\,c\\,\\sqrt{K(\\varphi)},\n$$\nwhere $K(\\theta) = \\dfrac{1+\\sin\\theta}{1-\\sin\\theta}$. For Elasto-Viscoplasticity (EVP), the rate of plastic flow is governed by a plastic potential $g$ constructed analogously from the dilation angle $\\psi$,\n$$\ng(\\boldsymbol{\\sigma};\\psi) = \\max(\\sigma_1,\\sigma_2,\\sigma_3) - K(\\psi)\\,\\min(\\sigma_1,\\sigma_2,\\sigma_3).\n$$\nBecause $g$ is nondifferentiable on edges and corners corresponding to ties among principal stresses, the plastic flow direction must be defined using the subdifferential $\\partial g(\\boldsymbol{\\sigma};\\psi)$. The return mapping algorithm in EVP requires detecting whether the stress state lies on a smooth facet (edge) or on a corner and selecting a consistent subgradient direction.\n\nStarting from the fundamental definitions of convex subdifferentials of pointwise maximum and minimum functions, derive an algorithm that:\n- Detects the active edge or corner set in principal stress space for the Mohr-Coulomb EVP update using a tolerance $\\varepsilon$ to identify ties, and classifies the state as an \"edge\" when both the maximum and minimum sets are singletons or as a \"corner\" otherwise.\n- Computes a well-defined subgradient direction $\\mathbf{n}_p \\in \\partial g(\\boldsymbol{\\sigma};\\psi)$ for plastic flow in principal stress space by selecting the minimal-norm element of the subdifferential (use uniform convex weights over the tied indices in the maximum and minimum sets).\n- Normalizes the subgradient direction to unit Euclidean norm when its norm is nonzero, leaving it as the zero vector if the norm is zero.\n\nUse the following fundamental bases:\n- The definition of the Mohr-Coulomb yield function in principal stress space and the plastic potential $g$ as convex functions of principal stresses.\n- The subdifferential of the pointwise maximum and minimum of linear functionals, and the characterization of the subgradient on nondifferentiable points via convex hulls.\n- The principle that selecting uniform convex weights over tied active sets yields the minimal Euclidean norm subgradient due to symmetry.\n\nImplement the derived algorithm in a complete, runnable program that, for each test case, returns:\n- An integer classification code $c_{\\text{class}}$ with $0$ for edge and $1$ for corner.\n- The list of indices of the active maximum set $\\mathcal{I}_{\\max} \\subset \\{0,1,2\\}$.\n- The list of indices of the active minimum set $\\mathcal{J}_{\\min} \\subset \\{0,1,2\\}$.\n- The normalized subgradient direction vector $\\mathbf{n}_p$ for plastic flow computed from $g(\\boldsymbol{\\sigma};\\psi)$.\n- The yield overstress $f(\\boldsymbol{\\sigma};\\varphi,c)$ in $\\mathrm{MPa}$.\n\nAngles must be provided in degrees and converted to radians internally before applying the sine function. Stress quantities must be handled in megapascals ($\\mathrm{MPa}$). The normalized subgradient direction is dimensionless, and the yield overstress must be reported in $\\mathrm{MPa}$. The program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets.\n\nTest Suite:\nUse the following parameter sets to validate the algorithm, expressed as tuples $(\\boldsymbol{\\sigma}\\ \\mathrm{in}\\ \\mathrm{MPa},\\ c\\ \\mathrm{in}\\ \\mathrm{MPa},\\ \\varphi\\ \\mathrm{in}\\ \\mathrm{degrees},\\ \\psi\\ \\mathrm{in}\\ \\mathrm{degrees},\\ \\varepsilon\\ \\mathrm{in}\\ \\mathrm{MPa})$:\n1. $\\left([100.0, 70.0, 30.0],\\ 5.0,\\ 30.0,\\ 5.0,\\ 10^{-3}\\right)$: distinct principal stresses, typical edge case.\n2. $\\left([100.0, 100.0 - 10^{-4}, 40.0],\\ 5.0,\\ 30.0,\\ 10.0,\\ 10^{-3}\\right)$: near tie on the maximum, corner case.\n3. $\\left([50.0, 50.0, 50.0],\\ 0.0,\\ 25.0,\\ 5.0,\\ 10^{-6}\\right)$: hydrostatic stress, corner at apex, zero cohesion.\n4. $\\left([90.0, 30.0, 30.0],\\ 10.0,\\ 35.0,\\ 5.0,\\ 10^{-6}\\right)$: tie on the minimum, corner case.\n5. $\\left([-10.0, -20.0, -30.0],\\ 2.0,\\ 30.0,\\ 0.0,\\ 10^{-4}\\right)$: tensile regime with zero dilation angle, edge case.\n6. Let $K(\\varphi)$ at $\\varphi=30.0^\\circ$ be used; choose $\\sigma_3=30.0$, then set $\\sigma_1 = K(\\varphi)\\,\\sigma_3 + 2\\,c\\,\\sqrt{K(\\varphi)}$, and $\\sigma_2=50.0$ with $c=5.0$, $\\varphi=30.0^\\circ$, $\\psi=10.0^\\circ$, $\\varepsilon=10^{-6}$: stress on the yield surface to test overstress near zero.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is itself a list in the form\n$$\n\\left[c_{\\text{class}},\\ \\mathcal{I}_{\\max},\\ \\mathcal{J}_{\\min},\\ \\mathbf{n}_p,\\ f(\\boldsymbol{\\sigma};\\varphi,c)\\right].\n$$\nAll lists must use zero-based indices for principal stress positions. The normalized subgradient vector $\\mathbf{n}_p$ must be reported as a list of three floats, and $f(\\boldsymbol{\\sigma};\\varphi,c)$ must be a float in $\\mathrm{MPa}$.", "solution": "The problem requires the derivation and implementation of an algorithm to determine the plastic flow direction for an elasto-viscoplastic material governed by a non-associated Mohr-Coulomb model. This is a fundamental task in computational geomechanics, particularly for stress-update procedures known as return mapping algorithms. The core challenge lies in handling the non-differentiability of the plastic potential function $g(\\boldsymbol{\\sigma};\\psi)$ at stress states where principal stresses are tied, corresponding to edges and corners of the yield surface in principal stress space.\n\nThe solution proceeds by applying the principles of convex analysis to the plastic potential function. The plastic flow direction is given by the gradient of the plastic potential, $\\nabla g$. However, where $g$ is not differentiable, the gradient is not uniquely defined. In its place, we use the subdifferential, denoted $\\partial g$, which is the set of all valid subgradients.\n\nThe plastic potential is given by:\n$$\ng(\\boldsymbol{\\sigma};\\psi) = \\max(\\sigma_1, \\sigma_2, \\sigma_3) - K(\\psi)\\,\\min(\\sigma_1, \\sigma_2, \\sigma_3)\n$$\nwhere $\\boldsymbol{\\sigma} = [\\sigma_1, \\sigma_2, \\sigma_3]$ is the vector of principal stresses, $\\psi$ is the dilation angle, and $K(\\psi) = \\frac{1+\\sin\\psi}{1-\\sin\\psi}$. Let us define $\\sigma_{\\max} = \\max_i\\{\\sigma_i\\}$ and $\\sigma_{\\min} = \\min_i\\{\\sigma_i\\}$. The function $g$ can be written as $g(\\boldsymbol{\\sigma}) = \\sigma_{\\max} - K(\\psi)\\sigma_{\\min}$.\n\nBoth $\\sigma_{\\max}$ and $\\sigma_{\\min}$ are convex functions of $\\boldsymbol{\\sigma}$. The subdifferential of a sum of convex functions is the Minkowski sum of their individual subdifferentials. Therefore, the subdifferential of $g$ is:\n$$\n\\partial g(\\boldsymbol{\\sigma}) = \\partial(\\sigma_{\\max}) - K(\\psi)\\,\\partial(\\sigma_{\\min})\n$$\nThe subdifferential of the pointwise maximum of a set of functions is the convex hull of the gradients of the active functions. Let $\\mathcal{I}_{\\max} = \\{i \\in \\{1,2,3\\} \\mid \\sigma_i = \\sigma_{\\max}\\}$ be the set of indices corresponding to the maximum principal stress. The gradients of the individual functions $\\sigma_i$ are the standard basis vectors $\\mathbf{e}_i$. Thus, the subdifferential of $\\sigma_{\\max}$ is:\n$$\n\\partial(\\sigma_{\\max}) = \\text{conv}\\{\\mathbf{e}_i \\mid i \\in \\mathcal{I}_{\\max}\\} = \\left\\{ \\sum_{i \\in \\mathcal{I}_{\\max}} \\alpha_i \\mathbf{e}_i \\mid \\alpha_i \\ge 0, \\sum_{i \\in \\mathcal{I}_{\\max}} \\alpha_i = 1 \\right\\}\n$$\nSimilarly, let $\\mathcal{J}_{\\min} = \\{j \\in \\{1,2,3\\} \\mid \\sigma_j = \\sigma_{\\min}\\}$ be the set of indices corresponding to the minimum principal stress. The subdifferential of $\\sigma_{\\min}$ is:\n$$\n\\partial(\\sigma_{\\min}) = \\text{conv}\\{\\mathbf{e}_j \\mid j \\in \\mathcal{J}_{\\min}\\} = \\left\\{ \\sum_{j \\in \\mathcal{J}_{\\min}} \\beta_j \\mathbf{e}_j \\mid \\beta_j \\ge 0, \\sum_{j \\in \\mathcal{J}_{\\min}} \\beta_j = 1 \\right\\}\n$$\nAny subgradient $\\mathbf{m} \\in \\partial g(\\boldsymbol{\\sigma})$ can be expressed as $\\mathbf{m} = \\mathbf{a} - K(\\psi)\\mathbf{b}$, where $\\mathbf{a} \\in \\partial(\\sigma_{\\max})$ and $\\mathbf{b} \\in \\partial(\\sigma_{\\min})$.\n\nTo ensure a unique plastic flow direction, we select the subgradient with the minimum Euclidean norm, which is a unique vector as $\\partial g(\\boldsymbol{\\sigma})$ is a closed convex set. This minimal-norm element is found by selecting uniform convex weights for the active gradients. This choice is justified by the symmetry of the convex hulls. Let $N_{\\max} = |\\mathcal{I}_{\\max}|$ and $N_{\\min} = |\\mathcal{J}_{\\min}|$ be the number of tied maximum and minimum principal stresses, respectively. The weights are $\\alpha_i = 1/N_{\\max}$ and $\\beta_j = 1/N_{\\min}$.\n\nThe resulting minimal-norm subgradient, denoted $\\mathbf{m}_p$, is:\n$$\n\\mathbf{m}_p = \\left( \\frac{1}{N_{\\max}} \\sum_{i \\in \\mathcal{I}_{\\max}} \\mathbf{e}_i \\right) - K(\\psi) \\left( \\frac{1}{N_{\\min}} \\sum_{j \\in \\mathcal{J}_{\\min}} \\mathbf{e}_j \\right)\n$$\nThis vector $\\mathbf{m}_p$ represents the direction of plastic flow. For consistency in constitutive models, it is normalized to have a unit Euclidean norm, provided it is not a zero vector. The normalized plastic flow direction $\\mathbf{n}_p$ is:\n$$\n\\mathbf{n}_p = \\begin{cases} \\frac{\\mathbf{m}_p}{\\|\\mathbf{m}_p\\|_2}  \\text{if } \\|\\mathbf{m}_p\\|_2 \\neq 0 \\\\ \\mathbf{0}  \\text{if } \\|\\mathbf{m}_p\\|_2 = 0 \\end{cases}\n$$\nThe norm $\\|\\mathbf{m}_p\\|_2$ is zero only under the specific conditions of a hydrostatic stress state ($\\sigma_1 = \\sigma_2 = \\sigma_3$, so $\\mathcal{I}_{\\max} = \\mathcal{J}_{\\min} = \\{1,2,3\\}$) and a zero dilation angle ($\\psi=0$, so $K(\\psi)=1$).\n\nThe algorithmic procedure is as follows:\n1.  Given a stress vector $\\boldsymbol{\\sigma}$, find $\\sigma_{\\max}$ and $\\sigma_{\\min}$.\n2.  Using a numerical tolerance $\\varepsilon  0$, identify the active index sets:\n    $\\mathcal{I}_{\\max} = \\{i \\in \\{0,1,2\\} \\mid \\sigma_i \\ge \\sigma_{\\max} - \\varepsilon\\}$\n    $\\mathcal{J}_{\\min} = \\{j \\in \\{0,1,2\\} \\mid \\sigma_j \\le \\sigma_{\\min} + \\varepsilon\\}$\n3.  Classify the stress state. If $N_{\\max} = 1$ and $N_{\\min} = 1$, the state is on a smooth face ('edge'), and the classification code is $c_{\\text{class}} = 0$. Otherwise, it is on a non-smooth intersection ('corner'), and $c_{\\text{class}} = 1$.\n4.  Compute the components of the vector $\\mathbf{m}_p = [m_{p,1}, m_{p,2}, m_{p,3}]$. For each component $k \\in \\{1,2,3\\}$:\n    $$\n    m_{p,k} = \\begin{cases} 1/N_{\\max}  \\text{if } k-1 \\in \\mathcal{I}_{\\max} \\text{ and } k-1 \\notin \\mathcal{J}_{\\min} \\\\ -K(\\psi)/N_{\\min}  \\text{if } k-1 \\notin \\mathcal{I}_{\\max} \\text{ and } k-1 \\in \\mathcal{J}_{\\min} \\\\ 1/N_{\\max} - K(\\psi)/N_{\\min}  \\text{if } k-1 \\in \\mathcal{I}_{\\max} \\text{ and } k-1 \\in \\mathcal{J}_{\\min} \\\\ 0  \\text{otherwise} \\end{cases}\n    $$\n    Note that we use $0$-based indices $\\{0,1,2\\}$ in the implementation.\n5.  Calculate the Euclidean norm $\\|\\mathbf{m}_p\\|_2$ and normalize to find $\\mathbf{n}_p$.\n6.  Finally, compute the yield overstress $f(\\boldsymbol{\\sigma};\\varphi,c)$ using the Mohr-Coulomb yield function:\n    $$\n    f(\\boldsymbol{\\sigma};\\varphi,c) = \\sigma_{\\max} - K(\\varphi)\\,\\sigma_{\\min} - 2\\,c\\,\\sqrt{K(\\varphi)}\n    $$\nThis algorithm provides a complete and robust method for determining the classification, active sets, plastic flow direction, and yield overstress, which are essential components for numerical integration of elasto-viscoplastic constitutive models.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements an algorithm to compute the plastic flow direction\n    for a non-associated Mohr-Coulomb model in principal stress space.\n    \"\"\"\n\n    # Pre-calculate stress for test case 6\n    # phi = 30.0 degrees, c = 5.0 MPa, sigma_3 = 30.0 MPa\n    k_phi_30 = (1 + np.sin(np.deg2rad(30.0))) / (1 - np.sin(np.deg2rad(30.0)))\n    sigma1_tc6 = k_phi_30 * 30.0 + 2 * 5.0 * np.sqrt(k_phi_30)\n\n    test_cases = [\n        ([100.0, 70.0, 30.0], 5.0, 30.0, 5.0, 1e-3),\n        ([100.0, 100.0 - 1e-4, 40.0], 5.0, 30.0, 10.0, 1e-3),\n        ([50.0, 50.0, 50.0], 0.0, 25.0, 5.0, 1e-6),\n        ([90.0, 30.0, 30.0], 10.0, 35.0, 5.0, 1e-6),\n        ([-10.0, -20.0, -30.0], 2.0, 30.0, 0.0, 1e-4),\n        ([sigma1_tc6, 50.0, 30.0], 5.0, 30.0, 10.0, 1e-6),\n    ]\n\n    results = []\n    for case in test_cases:\n        sigma_vec, c, phi_deg, psi_deg, eps = case\n        sigma = np.array(sigma_vec, dtype=float)\n        \n        # Convert angles to radians\n        phi_rad = np.deg2rad(phi_deg)\n        psi_rad = np.deg2rad(psi_deg)\n        \n        # Calculate K coefficients\n        # Handle the case where sin(theta) is 1.0, though unlikely with typical angles.\n        if np.isclose(np.sin(phi_rad), 1.0):\n            k_phi = np.inf\n        else:\n            k_phi = (1 + np.sin(phi_rad)) / (1 - np.sin(phi_rad))\n\n        if np.isclose(np.sin(psi_rad), 1.0):\n            k_psi = np.inf\n        else:\n            k_psi = (1 + np.sin(psi_rad)) / (1 - np.sin(psi_rad))\n        \n        # Find max and min principal stresses\n        sigma_max = np.max(sigma)\n        sigma_min = np.min(sigma)\n        \n        # Identify active sets using tolerance\n        I_max_indices = np.where(sigma >= sigma_max - eps)[0]\n        J_min_indices = np.where(sigma = sigma_min + eps)[0]\n        \n        N_max = len(I_max_indices)\n        N_min = len(J_min_indices)\n        \n        # Classify as edge or corner\n        if N_max == 1 and N_min == 1:\n            c_class = 0  # Edge\n        else:\n            c_class = 1  # Corner\n\n        # Compute minimal-norm subgradient m_p\n        m_p = np.zeros(3)\n        if N_max > 0:\n            m_p[I_max_indices] += 1.0 / N_max\n        if N_min > 0:\n            m_p[J_min_indices] -= k_psi / N_min\n            \n        # Normalize the subgradient to get plastic flow direction n_p\n        norm_mp = np.linalg.norm(m_p)\n        if norm_mp > 1e-12: # Use a machine epsilon for floating point comparison\n            n_p = m_p / norm_mp\n        else:\n            n_p = np.zeros(3)\n            \n        # Compute yield overstress f\n        if np.isinf(k_phi):\n            # This is a special case (tension cut-off) not formally handled by the formula\n            # For this problem, it's safe to assume phi  90 deg.\n            pass\n        f_overstress = sigma_max - k_phi * sigma_min - 2 * c * np.sqrt(k_phi)\n\n        result_tuple = [\n            c_class,\n            I_max_indices.tolist(),\n            J_min_indices.tolist(),\n            n_p.tolist(),\n            f_overstress\n        ]\n        results.append(result_tuple)\n\n    # Format the final output string\n    # Using str(list) automatically creates the desired output format '[...]'\n    output_str = f\"[{','.join(map(str, results))}]\"\n    # Replace spaces after commas inside each list for a more compact representation, optional but cleaner.\n    output_str = output_str.replace(\", \", \",\")\n    print(output_str)\n\nsolve()\n\n```", "id": "3521788"}, {"introduction": "A robust constitutive model is only useful if it can be correctly integrated into a finite element framework. This final exercise bridges the gap between the material point and the structural scale by focusing on the derivation of element-level quantities for a 1D viscoplastic bar [@problem_id:3521706]. You will derive the element's internal residual vector and, most critically, the consistent algorithmic tangent stiffness matrix, which is essential for achieving the rapid convergence of the global nonlinear solution procedure.", "problem": "Consider a small-strain, one-dimensional, two-node ($2$-node) bar finite element of length $L$ and cross-sectional area $A$, with linear shape functions and constant strain over the element. The bar follows an Elasto-Viscoplastic (EVP) constitutive model of Perzyna type with linear isotropic hardening. Assume quasi-static conditions and use the standard principle of virtual work to derive the element internal residual vector and consistent element stiffness matrix contributions, starting from first principles.\n\nFundamental base:\n- Small-strain kinematics: for a $1$D bar element, the total strain is $\\varepsilon = B u$, where $u$ is the nodal displacement vector and $B = \\left[-\\dfrac{1}{L},\\dfrac{1}{L}\\right]$ is the constant strain-displacement matrix for the element.\n- Principle of virtual work: the internal virtual work is $\\delta W_{\\mathrm{int}} = \\int_{\\Omega_e} \\sigma \\, \\delta \\varepsilon \\, \\mathrm{d}\\Omega$, where $\\sigma$ is the Cauchy stress and $\\Omega_e$ is the element domain.\n- Linear isotropic Hooke’s law for the elastic part: $\\sigma = E (\\varepsilon - \\varepsilon^p)$, where $E$ is the Young’s modulus and $\\varepsilon^p$ is the scalar plastic strain.\n- Perzyna viscoplasticity (overstress formulation): the yield function at the previous step is $f_n = |\\sigma_{\\mathrm{tr}}| - \\sigma_y(\\kappa_n)$ with $\\sigma_{\\mathrm{tr}} = E(\\varepsilon_{n+1} - \\varepsilon_n^p)$, $\\kappa_n = |\\varepsilon_n^p|$, and $\\sigma_y(\\kappa_n) = \\sigma_{y0} + H \\kappa_n$. The viscoplastic strain increment uses a viscosity parameter $\\eta$ and a stress normalization $s_0$ with exponent $m \\ge 1$, and is given by a forward-Euler update:\n$$\n\\Delta \\varepsilon^p = \\dfrac{\\Delta t}{\\eta \\, s_0^m} \\left\\langle |\\sigma_{\\mathrm{tr}}| - \\sigma_y(\\kappa_n) \\right\\rangle^m \\, \\mathrm{sign}(\\sigma_{\\mathrm{tr}}),\n$$\nwhere $\\langle \\cdot \\rangle$ denotes the Macaulay bracket.\n\nTask A (derivation):\n1. Starting from the principle of virtual work and small-strain kinematics, derive the internal force (residual) contribution at the element level:\n$$\nr_e^{\\mathrm{int}} = \\int_{\\Omega_e} B^T \\, \\sigma \\, \\mathrm{d}\\Omega.\n$$\nShow that for the $1$D bar with constant strain and stress, this reduces to\n$$\nr_e^{\\mathrm{int}} = A \\, \\sigma \\begin{bmatrix} -1 \\\\ 1 \\end{bmatrix}.\n$$\n2. Derive the consistent algorithmic tangent modulus $D_{\\mathrm{alg}} = \\dfrac{\\partial \\sigma_{n+1}}{\\partial \\varepsilon_{n+1}}$ corresponding to the Perzyna update above. Use the chain rule on the stress update\n$$\n\\sigma_{n+1} = E\\left(\\varepsilon_{n+1} - \\varepsilon_n^p - \\Delta \\varepsilon^p\\right),\n$$\nand the forward Euler update for $\\Delta \\varepsilon^p$ to obtain $D_{\\mathrm{alg}}$ for the active flow case $\\left(|\\sigma_{\\mathrm{tr}}| - \\sigma_y(\\kappa_n)  0\\right)$ and for the inactive case $\\left(|\\sigma_{\\mathrm{tr}}| - \\sigma_y(\\kappa_n) \\le 0\\right)$. Then, linearize the internal force to obtain the element stiffness matrix contribution\n$$\nK_e^{\\mathrm{int}} = \\int_{\\Omega_e} B^T \\, D_{\\mathrm{alg}} \\, B \\, \\mathrm{d}\\Omega,\n$$\nand show that for the $1$D bar with constant $B$ and constant $D_{\\mathrm{alg}}$, this reduces to\n$$\nK_e^{\\mathrm{int}} = \\dfrac{A \\, D_{\\mathrm{alg}}}{L} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}.\n$$\n3. Explain how to assemble element contributions into global residual and global stiffness consistently with the algorithmic tangent in a Newton–Raphson procedure: place $r_e^{\\mathrm{int}}$ into the appropriate global residual entries and $K_e^{\\mathrm{int}}$ into the appropriate global stiffness submatrix, using $D_{\\mathrm{alg}}$ computed by the same algorithm used to update $\\sigma_{n+1}$ and $\\varepsilon_{n+1}^p$.\n\nTask B (numerical implementation):\nImplement a program that, for a single $1$D bar element, computes the element internal residual vector and consistent element stiffness matrix for the following test suite (each test case specifies parameters, units, and nodal displacements). The program must compute the total strain as $\\varepsilon_{n+1} = B u$, use the EVP update described above, and then output the internal residual and stiffness.\n\nUnits:\n- Use the International System of Units (SI).\n- Young’s modulus $E$ in $\\mathrm{Pa}$.\n- Isotropic hardening modulus $H$ in $\\mathrm{Pa}$.\n- Initial yield stress $\\sigma_{y0}$ in $\\mathrm{Pa}$.\n- Stress normalization $s_0$ in $\\mathrm{Pa}$.\n- Viscosity parameter $\\eta$ in $\\mathrm{Pa}\\cdot \\mathrm{s}$.\n- Time step $\\Delta t$ in $\\mathrm{s}$.\n- Cross-sectional area $A$ in $\\mathrm{m}^2$.\n- Length $L$ in $\\mathrm{m}$.\n- Nodal displacements $u$ in $\\mathrm{m}$.\n- The element internal residual entries must be expressed in $\\mathrm{N}$.\n- The element stiffness entries must be expressed in $\\mathrm{N}/\\mathrm{m}$.\n\nTest suite:\n- Case $1$ (elastic regime, inactive viscoplastic flow):\n  - $E = 30 \\cdot 10^{9}\\ \\mathrm{Pa}$, $H = 1 \\cdot 10^{8}\\ \\mathrm{Pa}$, $\\sigma_{y0} = 5 \\cdot 10^{6}\\ \\mathrm{Pa}$, $s_0 = 5 \\cdot 10^{6}\\ \\mathrm{Pa}$, $\\eta = 1 \\cdot 10^{9}\\ \\mathrm{Pa}\\cdot \\mathrm{s}$, $\\Delta t = 1 \\cdot 10^{-1}\\ \\mathrm{s}$, $A = 1 \\cdot 10^{0}\\ \\mathrm{m}^2$, $L = 2 \\cdot 10^{0}\\ \\mathrm{m}$, $u = [0.0, 1 \\cdot 10^{-4}]\\ \\mathrm{m}$, $\\varepsilon_n^p = 0.0$.\n- Case $2$ (active viscoplastic flow, moderate softening, $m = 1$):\n  - $E = 30 \\cdot 10^{9}\\ \\mathrm{Pa}$, $H = 1 \\cdot 10^{8}\\ \\mathrm{Pa}$, $\\sigma_{y0} = 5 \\cdot 10^{6}\\ \\mathrm{Pa}$, $s_0 = 5 \\cdot 10^{6}\\ \\mathrm{Pa}$, $\\eta = 1 \\cdot 10^{6}\\ \\mathrm{Pa}\\cdot \\mathrm{s}$, $\\Delta t = 1 \\cdot 10^{2}\\ \\mathrm{s}$, $A = 1 \\cdot 10^{0}\\ \\mathrm{m}^2$, $L = 2 \\cdot 10^{0}\\ \\mathrm{m}$, $u = [0.0, 8 \\cdot 10^{-4}]\\ \\mathrm{m}$, $\\varepsilon_n^p = 0.0$, $m = 1$.\n- Case $3$ (boundary case at yield, inactive flow, $m = 2$):\n  - $E = 30 \\cdot 10^{9}\\ \\mathrm{Pa}$, $H = 1 \\cdot 10^{8}\\ \\mathrm{Pa}$, $\\sigma_{y0} = 5 \\cdot 10^{6}\\ \\mathrm{Pa}$, $s_0 = 5 \\cdot 10^{6}\\ \\mathrm{Pa}$, $\\eta = 1 \\cdot 10^{6}\\ \\mathrm{Pa}\\cdot \\mathrm{s}$, $\\Delta t = 1 \\cdot 10^{-1}\\ \\mathrm{s}$, $A = 1 \\cdot 10^{0}\\ \\mathrm{m}^2$, $L = 2 \\cdot 10^{0}\\ \\mathrm{m}$, $u = [0.0, 3.333333333333333 \\cdot 10^{-4}]\\ \\mathrm{m}$, $\\varepsilon_n^p = 0.0$, $m = 2$.\n- Case $4$ (edge case with large time step causing negative algorithmic tangent, $m = 1$):\n  - $E = 30 \\cdot 10^{9}\\ \\mathrm{Pa}$, $H = 1 \\cdot 10^{8}\\ \\mathrm{Pa}$, $\\sigma_{y0} = 5 \\cdot 10^{6}\\ \\mathrm{Pa}$, $s_0 = 5 \\cdot 10^{6}\\ \\mathrm{Pa}$, $\\eta = 1 \\cdot 10^{6}\\ \\mathrm{Pa}\\cdot \\mathrm{s}$, $\\Delta t = 2 \\cdot 10^{2}\\ \\mathrm{s}$, $A = 1 \\cdot 10^{0}\\ \\mathrm{m}^2$, $L = 2 \\cdot 10^{0}\\ \\mathrm{m}$, $u = [0.0, 1 \\cdot 10^{-3}]\\ \\mathrm{m}$, $\\varepsilon_n^p = 0.0$, $m = 1$.\n\nFinal output specification:\n- For each test case, compute the element internal residual vector $r_e^{\\mathrm{int}}$ and the element stiffness matrix $K_e^{\\mathrm{int}}$ using the EVP update and the consistent algorithmic tangent $D_{\\mathrm{alg}}$ derived from the same update.\n- Your program should produce a single line of output containing the results for all test cases as an outer list of per-case sublists, with each sublist formatted as $[r_1,r_2,K_{00},K_{01},K_{10},K_{11}]$ using SI units ($\\mathrm{N}$ for $r_i$ and $\\mathrm{N}/\\mathrm{m}$ for $K_{ij}$), all as decimal floats. For example:\n$[ [r_1,r_2,K_{00},K_{01},K_{10},K_{11}], [r_1,r_2,K_{00},K_{01},K_{10},K_{11}], \\dots ]$.", "solution": "The problem is assessed to be valid. It is a well-posed, scientifically grounded problem from the field of computational geomechanics, with a complete and consistent set of definitions, parameters, and objectives. It presents a standard, albeit detailed, task of deriving and implementing the element-level residual and stiffness for a Perzyna-type elasto-viscoplastic model.\n\nThe solution is presented in two parts, consistent with the problem statement. Task A comprises the analytical derivations, and Task B describes the numerical implementation, which is provided in the `answer` section.\n\n### Task A: Analytical Derivations\n\nThe derivations follow from the fundamental principles of continuum mechanics and the finite element method, as specified in the problem statement.\n\n#### 1. Element Internal Residual Vector, $r_e^{\\mathrm{int}}$\n\nThe principle of virtual work states that the internal virtual work, $\\delta W_{\\mathrm{int}}$, is the integral of the stress, $\\sigma$, acting over the virtual strain, $\\delta \\varepsilon$, throughout the element domain, $\\Omega_e$.\n$$\n\\delta W_{\\mathrm{int}} = \\int_{\\Omega_e} \\sigma \\, \\delta \\varepsilon \\, \\mathrm{d}\\Omega\n$$\nThe problem uses small-strain kinematics, where the total strain $\\varepsilon$ is related to the nodal displacement vector $u$ by the strain-displacement matrix $B$. For a $1$D, $2$-node bar element of length $L$ with linear shape functions, where $u = [u_1, u_2]^T$, the strain is constant and given by:\n$$\n\\varepsilon = \\frac{u_2 - u_1}{L} = \\begin{bmatrix} -\\frac{1}{L}  \\frac{1}{L} \\end{bmatrix} \\begin{bmatrix} u_1 \\\\ u_2 \\end{bmatrix} = B u\n$$\nThe virtual strain is then $\\delta \\varepsilon = B \\delta u$. Substituting this into the virtual work expression:\n$$\n\\delta W_{\\mathrm{int}} = \\int_{\\Omega_e} \\sigma (B \\delta u) \\, \\mathrm{d}\\Omega = \\int_{\\Omega_e} (\\delta u)^T B^T \\sigma \\, \\mathrm{d}\\Omega\n$$\nSince the virtual displacements $\\delta u$ are arbitrary and not functions of the spatial coordinates, they can be moved outside the integral:\n$$\n\\delta W_{\\mathrm{int}} = (\\delta u)^T \\left( \\int_{\\Omega_e} B^T \\sigma \\, \\mathrm{d}\\Omega \\right)\n$$\nBy definition, the internal virtual work is also expressed as $\\delta W_{\\mathrm{int}} = (\\delta u)^T r_e^{\\mathrm{int}}$, where $r_e^{\\mathrm{int}}$ is the element internal residual (or force) vector. Comparing the two expressions gives the definition of the internal residual:\n$$\nr_e^{\\mathrm{int}} = \\int_{\\Omega_e} B^T \\sigma \\, \\mathrm{d}\\Omega\n$$\nThis confirms the starting point given in the problem. For the specified $1$D bar element, the cross-sectional area $A$ is constant, and both the strain $\\varepsilon$ and stress $\\sigma$ are constant throughout the element. The differential volume element is $\\mathrm{d}\\Omega = A \\, \\mathrm{d}x$. The matrix $B = \\frac{1}{L}[-1, 1]$ is also constant. Therefore, all terms can be moved outside the integral:\n$$\nr_e^{\\mathrm{int}} = B^T \\sigma A \\int_0^L \\mathrm{d}x = B^T \\sigma A L\n$$\nSubstituting the expression for $B^T$:\n$$\nr_e^{\\mathrm{int}} = \\left( \\frac{1}{L} \\begin{bmatrix} -1 \\\\ 1 \\end{bmatrix} \\right) \\sigma A L = A \\sigma \\begin{bmatrix} -1 \\\\ 1 \\end{bmatrix}\n$$\nThis derivation confirms the expression required in the problem statement. The components of the residual vector are $r_1 = -A \\sigma$ and $r_2 = A \\sigma$, representing the internal forces at nodes $1$ and $2$, respectively.\n\n#### 2. Consistent Algorithmic Tangent Modulus, $D_{\\mathrm{alg}}$, and Element Stiffness Matrix, $K_e^{\\mathrm{int}}$\n\nThe consistent algorithmic tangent modulus is defined as the derivative of the updated stress $\\sigma_{n+1}$ with respect to the total strain $\\varepsilon_{n+1}$ at the end of the time step:\n$$\nD_{\\mathrm{alg}} = \\frac{\\partial \\sigma_{n+1}}{\\partial \\varepsilon_{n+1}}\n$$\nThe stress update rule is given by:\n$$\n\\sigma_{n+1} = E \\left( \\varepsilon_{n+1} - \\varepsilon_{n+1}^p \\right) = E \\left( \\varepsilon_{n+1} - (\\varepsilon_n^p + \\Delta\\varepsilon^p) \\right)\n$$\nwhere $\\varepsilon_n^p$ is the plastic strain from the previous step (a known constant at step $n+1$), and $\\Delta\\varepsilon^p$ is the viscoplastic strain increment, which is a function of $\\varepsilon_{n+1}$.\nLet's rewrite the stress update using the trial stress, $\\sigma_{\\mathrm{tr}} = E(\\varepsilon_{n+1} - \\varepsilon_n^p)$:\n$$\n\\sigma_{n+1} = \\sigma_{\\mathrm{tr}} - E \\Delta\\varepsilon^p\n$$\nDifferentiating $\\sigma_{n+1}$ with respect to $\\varepsilon_{n+1}$ using the chain rule:\n$$\nD_{\\mathrm{alg}} = \\frac{\\partial \\sigma_{\\mathrm{tr}}}{\\partial \\varepsilon_{n+1}} - E \\frac{\\partial (\\Delta\\varepsilon^p)}{\\partial \\varepsilon_{n+1}}\n$$\nSince $\\sigma_{\\mathrm{tr}} = E(\\varepsilon_{n+1} - \\varepsilon_n^p)$, we have $\\frac{\\partial \\sigma_{\\mathrm{tr}}}{\\partial \\varepsilon_{n+1}} = E$. So:\n$$\nD_{\\mathrm{alg}} = E - E \\frac{\\partial (\\Delta\\varepsilon^p)}{\\partial \\varepsilon_{n+1}}\n$$\nThe term $\\Delta\\varepsilon^p$ depends on $\\varepsilon_{n+1}$ through $\\sigma_{\\mathrm{tr}}$. We can apply the chain rule again:\n$$\n\\frac{\\partial (\\Delta\\varepsilon^p)}{\\partial \\varepsilon_{n+1}} = \\frac{\\partial (\\Delta\\varepsilon^p)}{\\partial \\sigma_{\\mathrm{tr}}} \\frac{\\partial \\sigma_{\\mathrm{tr}}}{\\partial \\varepsilon_{n+1}} = \\frac{\\partial (\\Delta\\varepsilon^p)}{\\partial \\sigma_{\\mathrm{tr}}} E\n$$\nSubstituting this into the expression for $D_{\\mathrm{alg}}$ yields:\n$$\nD_{\\mathrm{alg}} = E - E^2 \\frac{\\partial (\\Delta\\varepsilon^p)}{\\partial \\sigma_{\\mathrm{tr}}}\n$$\nNow we must evaluate $\\frac{\\partial (\\Delta\\varepsilon^p)}{\\partial \\sigma_{\\mathrm{tr}}}$ based on the Perzyna model definition for $\\Delta\\varepsilon^p$:\n$$\n\\Delta\\varepsilon^p = \\frac{\\Delta t}{\\eta \\, s_0^m} \\left\\langle |\\sigma_{\\mathrm{tr}}| - \\sigma_y(\\kappa_n) \\right\\rangle^m \\, \\mathrm{sign}(\\sigma_{\\mathrm{tr}})\n$$\nLet $f_n = |\\sigma_{\\mathrm{tr}}| - \\sigma_y(\\kappa_n)$ be the yield function value.\n\n**Case I: Inactive Viscoplastic Flow ($f_n \\le 0$)**\nIn this case, the Macaulay bracket is zero, $\\langle f_n \\rangle = 0$. Therefore, $\\Delta\\varepsilon^p = 0$. The derivative is also zero:\n$$\n\\frac{\\partial (\\Delta\\varepsilon^p)}{\\partial \\sigma_{\\mathrm{tr}}} = 0\n$$\nThe algorithmic tangent modulus reduces to the elastic modulus:\n$$\nD_{\\mathrm{alg}} = E - E^2(0) = E\n$$\n\n**Case II: Active Viscoplastic Flow ($f_n  0$)**\nIn this case, $\\langle f_n \\rangle = f_n$, so the expression for the increment becomes:\n$$\n\\Delta\\varepsilon^p = \\frac{\\Delta t}{\\eta \\, s_0^m} \\left( |\\sigma_{\\mathrm{tr}}| - \\sigma_y(\\kappa_n) \\right)^m \\, \\mathrm{sign}(\\sigma_{\\mathrm{tr}})\n$$\nWe differentiate this with respect to $\\sigma_{\\mathrm{tr}}$, assuming $\\sigma_{\\mathrm{tr}} \\neq 0$ so that $\\mathrm{sign}(\\sigma_{\\mathrm{tr}})$ is locally constant.\n$$\n\\frac{\\partial (\\Delta\\varepsilon^p)}{\\partial \\sigma_{\\mathrm{tr}}} = \\frac{\\Delta t}{\\eta \\, s_0^m} \\cdot \\mathrm{sign}(\\sigma_{\\mathrm{tr}}) \\cdot \\frac{\\partial}{\\partial \\sigma_{\\mathrm{tr}}} \\left[ \\left( |\\sigma_{\\mathrm{tr}}| - \\sigma_y(\\kappa_n) \\right)^m \\right]\n$$\nUsing the chain rule for the power term:\n$$\n\\frac{\\partial}{\\partial \\sigma_{\\mathrm{tr}}} \\left[ \\dots \\right]^m = m \\left( |\\sigma_{\\mathrm{tr}}| - \\sigma_y(\\kappa_n) \\right)^{m-1} \\cdot \\frac{\\partial}{\\partial \\sigma_{\\mathrm{tr}}} (|\\sigma_{\\mathrm{tr}}|) = m f_n^{m-1} \\mathrm{sign}(\\sigma_{\\mathrm{tr}})\n$$\nSubstituting this back:\n$$\n\\frac{\\partial (\\Delta\\varepsilon^p)}{\\partial \\sigma_{\\mathrm{tr}}} = \\frac{\\Delta t}{\\eta \\, s_0^m} \\cdot m f_n^{m-1} \\cdot (\\mathrm{sign}(\\sigma_{\\mathrm{tr}}))^2 = \\frac{\\Delta t \\, m}{\\eta \\, s_0^m} f_n^{m-1}\n$$\nFinally, we substitute this into the expression for $D_{\\mathrm{alg}}$:\n$$\nD_{\\mathrm{alg}} = E - E^2 \\left( \\frac{\\Delta t \\, m}{\\eta \\, s_0^m} f_n^{m-1} \\right) = E - \\frac{E^2 \\Delta t \\, m}{\\eta \\, s_0^m} \\left( |\\sigma_{\\mathrm{tr}}| - \\sigma_y(\\kappa_n) \\right)^{m-1}\n$$\n\nWith the scalar algorithmic tangent modulus $D_{\\mathrm{alg}}$ determined, the element stiffness matrix $K_e^{\\mathrm{int}}$ is derived by linearizing the internal residual, or equivalently, from the provided integral form:\n$$\nK_e^{\\mathrm{int}} = \\frac{\\partial r_e^{\\mathrm{int}}}{\\partial u} = \\int_{\\Omega_e} B^T \\frac{\\partial \\sigma}{\\partial \\varepsilon} \\frac{\\partial \\varepsilon}{\\partial u} \\, \\mathrm{d}\\Omega = \\int_{\\Omega_e} B^T D_{\\mathrm{alg}} B \\, \\mathrm{d}\\Omega\n$$\nSince $B$, $A$, and $D_{\\mathrm{alg}}$ are all constant over the element, they can be taken out of the integral:\n$$\nK_e^{\\mathrm{int}} = B^T D_{\\mathrm{alg}} B \\int_{\\Omega_e} \\mathrm{d}\\Omega = B^T D_{\\mathrm{alg}} B (A L)\n$$\nSubstituting $B = \\frac{1}{L}[-1, 1]$:\n$$\nK_e^{\\mathrm{int}} = \\left( \\frac{1}{L} \\begin{bmatrix} -1 \\\\ 1 \\end{bmatrix} \\right) D_{\\mathrm{alg}} \\left( \\frac{1}{L} [-1, 1] \\right) (A L) = \\frac{A D_{\\mathrm{alg}}}{L} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}\n$$\nThis derivation confirms the expression for the element stiffness matrix.\n\n#### 3. Assembly into Global System\n\nIn a finite element analysis, the global system of equations is formed by assembling the contributions from all individual elements. For a Newton-Raphson procedure to solve a nonlinear quasi-static problem, one must assemble both the global residual vector, $R_g$, and the global tangent stiffness matrix, $K_g$.\n\nThe assembly process is governed by the connectivity of the elements. Let an element $e$ connect global nodes $I$ and $J$. The element residual vector $r_e^{\\mathrm{int}} = [r_1, r_2]^T$ contributes to the global residual $R_g$ by adding its components to the corresponding global degrees of freedom: $r_1$ is added to the entry $R_{g,I}$ and $r_2$ is added to $R_{g,J}$.\n\nSimilarly, the $2 \\times 2$ element stiffness matrix $K_e^{\\mathrm{int}}$ is added to the global stiffness matrix $K_g$. The entries of $K_e^{\\mathrm{int}}$ are added to the corresponding locations in $K_g$ according to the element's nodal connectivity:\n$$\nK_e^{\\mathrm{int}} = \\begin{bmatrix} K_{11}  K_{12} \\\\ K_{21}  K_{22} \\end{bmatrix} \\implies K_{g,IJ} \\mathrel{+}= K_{12}, \\ K_{g,JI} \\mathrel{+}= K_{21}, \\ K_{g,II} \\mathrel{+}= K_{11}, \\ K_{g,JJ} \\mathrel{+}= K_{22}\n$$\nFor the Newton-Raphson method to exhibit its characteristic quadratic convergence rate, the global stiffness matrix $K_g$ must be the true tangent of the global residual vector $R_g$. This is achieved by ensuring that at the element level, the stiffness matrix $K_e^{\\mathrm{int}}$ is derived from the consistent algorithmic tangent modulus $D_{\\mathrm{alg}}$, which is itself derived from the exact same stress update algorithm used to compute $\\sigma_{n+1}$ (and thus $r_e^{\\mathrm{int}}$). The derivations above ensure this consistency.\n\n### Task B: Numerical Implementation\n\nThe following algorithm implements the derived formulas to compute the element residual and stiffness for the given test cases. The implementation is provided in the final answer block.\n\n1.  **Input:** All material and geometric parameters ($E, H, \\sigma_{y0}, s_0, \\eta, m, A, L$), the time step $\\Delta t$, the nodal displacement vector $u=[u_1, u_2]$, and the plastic strain from the previous step, $\\varepsilon_n^p$.\n2.  **Kinematics:** Compute the total strain at step $n+1$: $\\varepsilon_{n+1} = (u_2 - u_1) / L$.\n3.  **Previous State:** Calculate the hardening variable $\\kappa_n = |\\varepsilon_n^p|$ and the yield stress $\\sigma_y(\\kappa_n) = \\sigma_{y0} + H \\kappa_n$.\n4.  **Trial State:** Compute the trial stress $\\sigma_{\\mathrm{tr}} = E(\\varepsilon_{n+1} - \\varepsilon_n^p)$.\n5.  **Yield Check:** Evaluate the yield function $f_n = |\\sigma_{\\mathrm{tr}}| - \\sigma_y(\\kappa_n)$.\n6.  **Constitutive Update:**\n    -   If $f_n \\le 0$ (elastic step): Set $\\sigma_{n+1} = \\sigma_{\\mathrm{tr}}$ and $D_{\\mathrm{alg}} = E$.\n    -   If $f_n  0$ (viscoplastic step):\n        a.  Compute the viscoplastic strain increment: $\\Delta\\varepsilon^p = \\frac{\\Delta t}{\\eta s_0^m} f_n^m \\, \\mathrm{sign}(\\sigma_{\\mathrm{tr}})$.\n        b.  Update the stress: $\\sigma_{n+1} = \\sigma_{\\mathrm{tr}} - E \\Delta\\varepsilon^p$.\n        c.  Compute the consistent tangent: $D_{\\mathrm{alg}} = E - \\frac{E^2 \\Delta t \\, m}{\\eta \\, s_0^m} f_n^{m-1}$.\n7.  **Element Matrices:**\n    -   Compute the internal residual vector: $r_e^{\\mathrm{int}} = [-A \\sigma_{n+1}, A \\sigma_{n+1}]$.\n    -   Compute the stiffness matrix: $K_e^{\\mathrm{int}} = \\frac{A D_{\\mathrm{alg}}}{L} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}$.\n8.  **Output:** Return the components of $r_e^{\\mathrm{int}}$ and $K_e^{\\mathrm{int}}$ in the specified flattened list format.\n\nThis algorithm is applied to each test case provided in the problem.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    It computes the element internal residual vector and consistent element\n    stiffness matrix for a 1D elasto-viscoplastic bar element.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a dictionary of parameters.\n    test_cases = [\n        { # Case 1: Elastic regime\n            \"E\": 30e9, \"H\": 1e8, \"sigma_y0\": 5e6, \"s0\": 5e6, \"eta\": 1e9,\n            \"dt\": 1e-1, \"A\": 1.0, \"L\": 2.0, \"u\": np.array([0.0, 1e-4]),\n            \"eps_p_n\": 0.0, \"m\": 1.0\n        },\n        { # Case 2: Active viscoplastic flow, m=1\n            \"E\": 30e9, \"H\": 1e8, \"sigma_y0\": 5e6, \"s0\": 5e6, \"eta\": 1e6,\n            \"dt\": 1e2, \"A\": 1.0, \"L\": 2.0, \"u\": np.array([0.0, 8e-4]),\n            \"eps_p_n\": 0.0, \"m\": 1.0\n        },\n        { # Case 3: Boundary case at yield, m=2\n            \"E\": 30e9, \"H\": 1e8, \"sigma_y0\": 5e6, \"s0\": 5e6, \"eta\": 1e6,\n            \"dt\": 1e-1, \"A\": 1.0, \"L\": 2.0, \"u\": np.array([0.0, 3.333333333333333e-4]),\n            \"eps_p_n\": 0.0, \"m\": 2.0\n        },\n        { # Case 4: Edge case with large time step, m=1\n            \"E\": 30e9, \"H\": 1e8, \"sigma_y0\": 5e6, \"s0\": 5e6, \"eta\": 1e6,\n            \"dt\": 2e2, \"A\": 1.0, \"L\": 2.0, \"u\": np.array([0.0, 1e-3]),\n            \"eps_p_n\": 0.0, \"m\": 1.0\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        result = compute_evp_element(params)\n        results.append(result)\n\n    # Format the final output string as a list of lists of floats.\n    str_results = []\n    for res_list in results:\n        str_results.append(f\"[{','.join(map(str, res_list))}]\")\n    \n    print(f\"[{','.join(str_results)}]\")\n\ndef compute_evp_element(params):\n    \"\"\"\n    Computes residual and stiffness for a single 1D EVP bar element.\n    \n    Args:\n        params (dict): A dictionary containing all necessary parameters for the calculation.\n    \n    Returns:\n        list: A flattened list [r1, r2, K00, K01, K10, K11].\n    \"\"\"\n    # Unpack parameters\n    E = params[\"E\"]\n    H = params[\"H\"]\n    sigma_y0 = params[\"sigma_y0\"]\n    s0 = params[\"s0\"]\n    eta = params[\"eta\"]\n    dt = params[\"dt\"]\n    A = params[\"A\"]\n    L = params[\"L\"]\n    u = params[\"u\"]\n    eps_p_n = params[\"eps_p_n\"]\n    m = params[\"m\"]\n\n    # 1. Kinematics: Compute total strain at step n+1\n    # B = [-1/L, 1/L]\n    eps_n1 = (u[1] - u[0]) / L\n\n    # 2. State from previous step (n)\n    kappa_n = abs(eps_p_n)\n    sigma_y_n = sigma_y0 + H * kappa_n\n\n    # 3. Trial state (elastic predictor)\n    sigma_tr = E * (eps_n1 - eps_p_n)\n\n    # 4. Check for viscoplastic flow\n    f_n = abs(sigma_tr) - sigma_y_n\n    \n    sigma_n1 = 0.0\n    D_alg = 0.0\n\n    if f_n = 0:\n        # Elastic or on yield surface: No viscoplastic flow\n        # delta_eps_p = 0.0\n        # eps_p_n1 = eps_p_n\n        sigma_n1 = sigma_tr\n        D_alg = E\n    else:\n        # Active viscoplastic flow\n        # Compute viscoplastic strain increment\n        sign_sigma_tr = np.sign(sigma_tr)\n        # Using np.power for the case m=1 and f_n=0, where 0**0 = 1\n        # The logic f_n > 0 already ensures f_n is positive.\n        delta_eps_p = (dt / (eta * (s0**m))) * (f_n**m) * sign_sigma_tr\n\n        # Update stress\n        sigma_n1 = sigma_tr - E * delta_eps_p\n        \n        # Update plastic strain (not needed for this problem but for completeness)\n        # eps_p_n1 = eps_p_n + delta_eps_p\n\n        # Compute consistent algorithmic tangent\n        # D_alg = E - (E**2 * dt * m / (eta * s0**m)) * f_n**(m-1)\n        # For m=1, f_n**0 = 1.\n        # For m>1 and f_n->0, the derivative term tends to 0 (if m-1>0)\n        # or a constant (if m-1=0 e.g. m=2), or infinity (if m-10).\n        # We assume m >= 1 as per problem statement.\n        if m == 1:\n            power_term = 1.0\n        else:\n            power_term = f_n**(m - 1)\n        \n        D_alg = E - (E**2 * dt * m / (eta * s0**m)) * power_term\n\n    # 5. Compute Element Quantities\n    # Internal residual vector: r_e = A * sigma * [-1, 1]^T\n    r_e_int = A * sigma_n1 * np.array([-1.0, 1.0])\n\n    # Element stiffness matrix: K_e = (A * D_alg / L) * [[1, -1], [-1, 1]]\n    stiffness_factor = A * D_alg / L\n    K_e_int = stiffness_factor * np.array([[1.0, -1.0], [-1.0, 1.0]])\n\n    # 6. Format and return results\n    return [\n        r_e_int[0], r_e_int[1],\n        K_e_int[0, 0], K_e_int[0, 1],\n        K_e_int[1, 0], K_e_int[1, 1]\n    ]\n\n# Run the solver\nsolve()\n```", "id": "3521706"}]}