{"hands_on_practices": [{"introduction": "To truly master computational geomechanics, it's crucial to understand not just what works, but why certain methods fail. This first practice invites you to diagnose the fundamental cause of volumetric locking from first principles. By analyzing the stiffness operator of a simple Q4 element as it approaches the incompressible limit, you will quantify the pathological ill-conditioning that leads to an artificially stiff response, providing a clear mathematical basis for this pervasive numerical issue [@problem_id:3522660].", "problem": "Consider a unit square domain $\\Omega=[0,1]\\times[0,1]$ in plane strain, occupied by a homogeneous, isotropic, linear elastic material with Young's modulus $E$ and Poisson's ratio $v$. The boundary $\\partial\\Omega$ is subjected to a uniform hydrostatic traction $\\mathbf{t}=-p\\,\\mathbf{n}$, where $p>0$ is constant and $\\mathbf{n}$ is the outward unit normal. Discretize $\\Omega$ with a single bilinear four-node quadrilateral element (Q4) with full $2\\times 2$ Gauss integration. The Four-Node Quadrilateral (Q4) element with full integration exactly reproduces constant strain fields.\n\nStarting from the fundamental constitutive law of isotropic linear elasticity in plane strain and the definition of the Lamé parameters, analyze the stiffness operator associated with the constant-strain subspace that the Q4 element reproduces exactly under uniform hydrostatic loading. Let the material stiffness matrix in Voigt form be denoted by $\\mathbf{D}$, and let the element stiffness be $\\mathbf{K}_e=\\int_{\\Omega}\\mathbf{B}^{\\top}\\mathbf{D}\\mathbf{B}\\,\\mathrm{d}\\Omega$, where $\\mathbf{B}$ is the strain-displacement matrix. Focus on the restriction of $\\mathbf{K}_e$ to the three-dimensional constant-strain subspace spanned by the uniform volumetric and deviatoric strain modes and the uniform shear mode.\n\nDerive, from first principles, the eigenstructure of the isotropic plane-strain material stiffness $\\mathbf{D}$ on this constant-strain subspace and deduce the conditioning of $\\mathbf{K}_e$ in terms of $v$ by taking the ratio of its largest to its smallest positive eigenvalue. Use the relations between $E$, $v$ and the Lamé parameters $\\lambda$ and $\\mu$ appropriate for plane strain. Your final answer must be a single closed-form analytic expression in $v$ that captures the conditioning as $v\\to 0.5$, thus quantifying the increase in apparent bulk stiffness associated with volumetric locking under hydrostatic loading. No numerical evaluation is required.", "solution": "The problem requires an analysis of the conditioning of the stiffness operator for a single four-node quadrilateral (Q4) element under plane strain conditions, as the material approaches the incompressible limit ($v \\to 0.5$). The analysis is restricted to the constant-strain subspace, which the problem states is exactly reproduced by the Q4 element with full integration. This key fact implies that the element's stiffness behavior for these modes is a direct reflection of the underlying material's constitutive response. Therefore, the problem reduces to analyzing the eigenstructure of the plane-strain material stiffness matrix, $\\mathbf{D}$. The conditioning is defined as the ratio of the largest to the smallest positive eigenvalue of this operator.\n\nFirst, we establish the material stiffness matrix $\\mathbf{D}$ for a homogeneous, isotropic, linear elastic material under plane strain conditions. The general three-dimensional constitutive law (Hooke's Law) is given by:\n$$ \\boldsymbol{\\sigma} = \\lambda \\text{tr}(\\boldsymbol{\\varepsilon}) \\mathbf{I} + 2\\mu \\boldsymbol{\\varepsilon} $$\nwhere $\\boldsymbol{\\sigma}$ is the stress tensor, $\\boldsymbol{\\varepsilon}$ is the strain tensor, $\\mathbf{I}$ is the second-order identity tensor, and $\\lambda$ and $\\mu$ are the Lamé parameters. The parameter $\\mu$ is the shear modulus, also denoted by $G$.\n\nIn plane strain, the strain components normal to the plane are zero: $\\varepsilon_{zz} = \\varepsilon_{xz} = \\varepsilon_{yz} = 0$. The strain tensor trace (volumetric strain) simplifies to $\\text{tr}(\\boldsymbol{\\varepsilon}) = \\varepsilon_{xx} + \\varepsilon_{yy}$. The in-plane stress components are:\n$$ \\sigma_{xx} = \\lambda(\\varepsilon_{xx} + \\varepsilon_{yy}) + 2\\mu \\varepsilon_{xx} = (\\lambda + 2\\mu)\\varepsilon_{xx} + \\lambda\\varepsilon_{yy} $$\n$$ \\sigma_{yy} = \\lambda(\\varepsilon_{xx} + \\varepsilon_{yy}) + 2\\mu \\varepsilon_{yy} = \\lambda\\varepsilon_{xx} + (\\lambda + 2\\mu)\\varepsilon_{yy} $$\n$$ \\sigma_{xy} = 2\\mu \\varepsilon_{xy} $$\nUsing Voigt notation with engineering shear strain $\\gamma_{xy} = 2\\varepsilon_{xy}$, the stress and strain vectors are $\\boldsymbol{\\sigma} = [\\sigma_{xx}, \\sigma_{yy}, \\tau_{xy}]^\\top$ and $\\boldsymbol{\\varepsilon} = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^\\top$. The stress-strain relationship $\\boldsymbol{\\sigma} = \\mathbf{D}\\boldsymbol{\\varepsilon}$ is given by:\n$$ \\begin{pmatrix} \\sigma_{xx} \\\\ \\sigma_{yy} \\\\ \\tau_{xy} \\end{pmatrix} = \\begin{pmatrix} \\lambda + 2\\mu & \\lambda & 0 \\\\ \\lambda & \\lambda + 2\\mu & 0 \\\\ 0 & 0 & \\mu \\end{pmatrix} \\begin{pmatrix} \\varepsilon_{xx} \\\\ \\varepsilon_{yy} \\\\ \\gamma_{xy} \\end{pmatrix} $$\nThe material stiffness matrix is thus:\n$$ \\mathbf{D} = \\begin{pmatrix} \\lambda + 2\\mu & \\lambda & 0 \\\\ \\lambda & \\lambda + 2\\mu & 0 \\\\ 0 & 0 & \\mu \\end{pmatrix} $$\nThe Lamé parameters are related to Young's modulus $E$ and Poisson's ratio $v$ by:\n$$ \\mu = \\frac{E}{2(1+v)} $$\n$$ \\lambda = \\frac{vE}{(1+v)(1-2v)} $$\nNext, we find the eigenvalues of $\\mathbf{D}$ to understand its stiffness characteristics along its principal strain directions. The matrix $\\mathbf{D}$ is block-diagonal. One eigenvalue can be read directly from the shear component:\n$$ k_1 = \\mu $$\nThe corresponding eigenvector is $[0, 0, 1]^\\top$, which represents a pure shear strain mode.\n\nThe other two eigenvalues are found from the upper-left $2 \\times 2$ block:\n$$ \\mathbf{D}_{11,22} = \\begin{pmatrix} \\lambda + 2\\mu & \\lambda \\\\ \\lambda & \\lambda + 2\\mu \\end{pmatrix} $$\nThe characteristic equation is $\\det(\\mathbf{D}_{11,22} - k\\mathbf{I}) = 0$, which is $(\\lambda + 2\\mu - k)^2 - \\lambda^2 = 0$. This implies $\\lambda + 2\\mu - k = \\pm\\lambda$. This yields the remaining two eigenvalues: $k_2 = 2\\mu$ and $k_3 = 2\\lambda + 2\\mu$. The eigenvector for $k_2=2\\mu$ corresponds to a pure deviatoric (volume-preserving) strain mode, while the eigenvector for $k_3=2\\lambda+2\\mu$ corresponds to a pure volumetric (dilatational) strain mode. The complete set of eigenvalues for $\\mathbf{D}$ is thus $\\{\\mu, 2\\mu, 2\\lambda+2\\mu\\}$.\n\nThe problem states that the hydrostatic loading excites the volumetric mode. This corresponds to the eigenvalue $k_{\\text{vol}} = 2\\lambda + 2\\mu$, which governs the material's stiffness against volumetric deformation. The other eigenvalues, $k_{\\text{dev}} = 2\\mu$ and $k_{\\text{shear}} = \\mu$, relate to shear deformations.\n\nFor a physically realistic material, $E>0$ and $v \\in [0, 0.5)$, which implies $\\lambda>0$ and $\\mu>0$. Thus, the eigenvalues are ordered as:\n$k_{\\text{max}} = 2\\lambda + 2\\mu$\n$k_{\\min} = \\mu$\n\nThe condition number, $\\kappa$, of the stiffness operator $\\mathbf{D}$ is the ratio of its largest to smallest positive eigenvalue:\n$$ \\kappa(\\mathbf{D}) = \\frac{k_{\\text{max}}}{k_{\\text{min}}} = \\frac{2\\lambda + 2\\mu}{\\mu} = 2\\frac{\\lambda}{\\mu} + 2 $$\nTo analyze the behavior as $v \\to 0.5$, we express this ratio in terms of $v$. The ratio of the Lamé parameters is:\n$$ \\frac{\\lambda}{\\mu} = \\frac{\\frac{vE}{(1+v)(1-2v)}}{\\frac{E}{2(1+v)}} = \\frac{vE}{(1+v)(1-2v)} \\cdot \\frac{2(1+v)}{E} = \\frac{2v}{1-2v} $$\nSubstituting this into the expression for the condition number:\n$$ \\kappa = 2\\left(\\frac{2v}{1-2v}\\right) + 2 = \\frac{4v + 2(1-2v)}{1-2v} = \\frac{4v + 2 - 4v}{1-2v} = \\frac{2}{1-2v} $$\nThis expression quantifies the conditioning of the material stiffness. As Poisson's ratio $v$ approaches the incompressible limit of $0.5$, the denominator $(1-2v)$ approaches $0$, and the condition number $\\kappa$ diverges to infinity.\n$$ \\lim_{v \\to 0.5} \\kappa = \\lim_{v \\to 0.5} \\frac{2}{1-2v} = \\infty $$\nThis ill-conditioning is the root cause of volumetric locking in low-order finite elements with full integration. The stiffness associated with the volumetric strain mode ($k_{\\text{vol}} \\propto \\lambda$) becomes infinitely large compared to the stiffness of the shear modes ($k_{\\text{shear}} = \\mu$, which remains finite). An element formulation that cannot kinematically accommodate the near-zero volumetric strain constraint will exhibit an artificially stiff, or \"locked\", response. The derived expression precisely captures this pathological increase in stiffness disparity.\nThe conditioning of the element stiffness matrix $\\mathbf{K}_e$ on the constant-strain subspace is directly governed by the conditioning of $\\mathbf{D}$, as the element kinematics exactly represent these constant strain fields. Therefore, the conditioning of the restricted $\\mathbf{K}_e$ also behaves as $\\frac{2}{1-2v}$.", "answer": "$$\\boxed{\\frac{2}{1-2v}}$$", "id": "3522660"}, {"introduction": "Having diagnosed volumetric locking, our next step is to explore a cure. This exercise introduces the widely-used $\\bar{B}$ method, a technique that modifies the element's strain field to alleviate the incompressibility constraint. You will prove its efficacy by performing a volumetric patch test—a key consistency check—and analyze its superior convergence properties compared to the standard, locking-prone element, demonstrating how a thoughtful formulation can restore accuracy in the incompressible limit [@problem_id:3522668].", "problem": "Consider small-strain, plane strain, isotropic linear elasticity on a simply connected domain $\\Omega \\subset \\mathbb{R}^{2}$ with boundary $\\partial \\Omega$, Lamé parameters $\\lambda>0$ and $\\mu>0$, and body force per unit volume $\\mathbf{b}$. Let $\\mathbf{u}:\\Omega\\to\\mathbb{R}^{2}$ denote the displacement field, $\\boldsymbol{\\epsilon}(\\mathbf{u})=\\tfrac{1}{2}\\left(\\nabla \\mathbf{u}+\\nabla \\mathbf{u}^{\\top}\\right)$ the strain tensor, its volumetric part $\\epsilon_{v}(\\mathbf{u})=\\operatorname{tr}(\\boldsymbol{\\epsilon}(\\mathbf{u}))=\\nabla\\cdot\\mathbf{u}$, and its deviatoric part $\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u})=\\boldsymbol{\\epsilon}(\\mathbf{u})-\\tfrac{1}{2}\\epsilon_{v}(\\mathbf{u})\\mathbf{I}$. The constitutive law is $\\boldsymbol{\\sigma}(\\mathbf{u})=2\\mu\\,\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u})+\\lambda\\,\\epsilon_{v}(\\mathbf{u})\\,\\mathbf{I}$. The weak form is: find $\\mathbf{u}\\in\\mathcal{V}$ such that, for all test functions $\\mathbf{w}\\in\\mathcal{V}_{0}$,\n$$\na(\\mathbf{u},\\mathbf{w})=\\ell(\\mathbf{w}),\n$$\nwhere\n$$\na(\\mathbf{u},\\mathbf{w})=\\int_{\\Omega}\\left(2\\mu\\,\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}):\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{w})+\\lambda\\,\\epsilon_{v}(\\mathbf{u})\\,\\epsilon_{v}(\\mathbf{w})\\right)\\,d\\Omega,\\qquad \\ell(\\mathbf{w})=\\int_{\\Omega}\\mathbf{b}\\cdot\\mathbf{w}\\,d\\Omega+\\int_{\\partial\\Omega_{t}}\\mathbf{t}\\cdot\\mathbf{w}\\,ds.\n$$\nDiscretize $\\Omega$ by a shape-regular, quasi-uniform mesh of bilinear quadrilaterals (isoparametric $Q4$ elements) with characteristic size $h$, and use the standard $Q4$ displacement finite element space $\\mathcal{V}_{h}\\subset\\mathcal{V}$ with full integration. Define the $\\bar{B}$ (B-bar) modification as follows: for each element $\\Omega_{e}$, let the elementwise volumetric strain projection be\n$$\n\\bar{\\epsilon}_{v}^{h}\\big|_{\\Omega_{e}}=\\frac{1}{|\\Omega_{e}|}\\int_{\\Omega_{e}}\\epsilon_{v}^{h}\\,d\\Omega,\n$$\nwith $\\epsilon_{v}^{h}=\\nabla\\cdot\\mathbf{u}_{h}$ and $|\\Omega_{e}|$ the element area. The $\\bar{B}$ element replaces the volumetric term $\\lambda\\,\\epsilon_{v}^{h}$ by $\\lambda\\,\\bar{\\epsilon}_{v}^{h}$ in the stress, while leaving the deviatoric term $2\\mu\\,\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}_{h})$ unchanged. Consider the following two tasks:\n\n1. Volumetric patch test. Let $\\Omega$ be partitioned into a mesh of parallelogram $Q4$ elements (i.e., the element mappings are affine). Prescribe boundary displacements consistent with a uniform dilatational exact solution $\\mathbf{u}^{\\ast}(x,y)=\\tfrac{\\epsilon_{0}}{2}[x\\;\\;y]^{\\top}$, with a constant volumetric strain $\\epsilon_{v}(\\mathbf{u}^{\\ast})=\\epsilon_{0}\\neq 0$ and zero deviatoric strain. Show that, under these conditions, the $\\bar{B}$ element produces an exactly uniform hydrostatic stress field $\\boldsymbol{\\sigma}^{h}= \\lambda\\,\\epsilon_{0}\\,\\mathbf{I}$ within each element, i.e., it passes the volumetric patch test.\n\n2. Convergence rate in the incompressible limit. Consider a smooth problem with the exact incompressible solution $\\mathbf{u}$ satisfying $\\epsilon_{v}(\\mathbf{u})=0$ in $\\Omega$ and the same constitutive law with $\\mu$ fixed. Define the incompressible limit as $\\lambda\\to\\infty$ with $\\mu$ held fixed. For the standard $Q4$ element and for the $\\bar{B}$ element, derive the asymptotic rate $p$ in the bound\n$$\n\\|\\mathbf{u}-\\mathbf{u}_{h}\\|_{H^{1}(\\Omega)}\\leq C\\,h^{p},\n$$\nwhere $C$ is independent of $\\lambda$ in the incompressible limit. Report the ordered pair of rates $\\left(p_{\\text{Q4}},\\,p_{\\bar{B}}\\right)$, defined with respect to the Sobolev $H^{1}$-seminorm. Express your final pair as a row matrix containing two analytical numbers with no units.\n\nNo shortcut formulas are allowed; you must start from the weak form, the definitions of strain decomposition and the projection operator, and reason about consistency and stability. The scenario parameters are physically consistent. The final answer must be a single row matrix, as specified above; no rounding is required.", "solution": "This problem consists of two parts. The first part requires proving that the $\\bar{B}$ element passes the volumetric patch test. The second part asks for the convergence rates of the standard $Q4$ element and the $\\bar{B}$ element in the incompressible limit.\n\n**Part 1: Volumetric Patch Test**\n\nThe patch test verifies the consistency of a finite element formulation. We are given a mesh of parallelogram $Q4$ elements and prescribed boundary displacements corresponding to a uniform dilatational displacement field $\\mathbf{u}^{\\ast}(x,y)=\\tfrac{\\epsilon_{0}}{2}[x\\;\\;y]^{\\top}$, where $\\epsilon_{0}$ is a non-zero constant.\n\nFirst, we compute the exact strain tensor associated with $\\mathbf{u}^{\\ast}$. The gradient of the displacement field is\n$$\n\\nabla\\mathbf{u}^{\\ast} = \\begin{pmatrix} \\frac{\\partial u_x^{\\ast}}{\\partial x} & \\frac{\\partial u_x^{\\ast}}{\\partial y} \\\\ \\frac{\\partial u_y^{\\ast}}{\\partial x} & \\frac{\\partial u_y^{\\ast}}{\\partial y} \\end{pmatrix} = \\begin{pmatrix} \\frac{\\epsilon_{0}}{2} & 0 \\\\ 0 & \\frac{\\epsilon_{0}}{2} \\end{pmatrix} = \\frac{\\epsilon_{0}}{2}\\mathbf{I}.\n$$\nThe exact strain tensor $\\boldsymbol{\\epsilon}(\\mathbf{u}^{\\ast})$ is the symmetric part of the gradient:\n$$\n\\boldsymbol{\\epsilon}(\\mathbf{u}^{\\ast}) = \\frac{1}{2}\\left(\\nabla\\mathbf{u}^{\\ast} + (\\nabla\\mathbf{u}^{\\ast})^{\\top}\\right) = \\frac{1}{2}\\left(\\frac{\\epsilon_{0}}{2}\\mathbf{I} + \\frac{\\epsilon_{0}}{2}\\mathbf{I}\\right) = \\frac{\\epsilon_{0}}{2}\\mathbf{I}.\n$$\nThe exact volumetric strain $\\epsilon_{v}(\\mathbf{u}^{\\ast})$ is the trace of the strain tensor:\n$$\n\\epsilon_{v}(\\mathbf{u}^{\\ast}) = \\operatorname{tr}(\\boldsymbol{\\epsilon}(\\mathbf{u}^{\\ast})) = \\operatorname{tr}\\left(\\frac{\\epsilon_{0}}{2}\\mathbf{I}\\right) = \\frac{\\epsilon_{0}}{2}\\operatorname{tr}(\\mathbf{I}) = \\frac{\\epsilon_{0}}{2}(2) = \\epsilon_{0}.\n$$\nThe exact deviatoric strain $\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}^{\\ast})$ is given by:\n$$\n\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}^{\\ast}) = \\boldsymbol{\\epsilon}(\\mathbf{u}^{\\ast}) - \\frac{1}{2}\\epsilon_{v}(\\mathbf{u}^{\\ast})\\mathbf{I} = \\frac{\\epsilon_{0}}{2}\\mathbf{I} - \\frac{1}{2}(\\epsilon_{0})\\mathbf{I} = \\mathbf{0}.\n$$\nThe displacement field $\\mathbf{u}^{\\ast}(x,y)$ is linear in $x$ and $y$. The standard bilinear quadrilateral ($Q4$) element can exactly represent any function that is a linear polynomial in its local coordinates. Since the element mappings for a mesh of parallelograms are affine, a linear field in global coordinates $(x,y)$ remains linear in the element's local coordinates. A key property of the finite element method is that if the exact solution belongs to the finite element space $\\mathcal{V}_{h}$, and the boundary conditions are interpolated from the exact solution, then the finite element solution $\\mathbf{u}_{h}$ will be identical to the exact solution, i.e., $\\mathbf{u}_{h} = \\mathbf{u}^{\\ast}$.\n\nTherefore, within each element $\\Omega_{e}$, the finite element displacement field is $\\mathbf{u}_{h} = \\mathbf{u}^{\\ast}$. Consequently, the strain tensor computed from the finite element solution, $\\boldsymbol{\\epsilon}^{h} = \\boldsymbol{\\epsilon}(\\mathbf{u}_{h})$, is constant within each element and equal to the exact strain:\n$$\n\\boldsymbol{\\epsilon}^{h}\\big|_{\\Omega_{e}} = \\boldsymbol{\\epsilon}(\\mathbf{u}^{\\ast}) = \\frac{\\epsilon_{0}}{2}\\mathbf{I}.\n$$\nThis means the discrete volumetric strain $\\epsilon_{v}^{h} = \\nabla\\cdot\\mathbf{u}_{h}$ is also constant within each element:\n$$\n\\epsilon_{v}^{h}\\big|_{\\Omega_{e}} = \\epsilon_{v}(\\mathbf{u}^{\\ast}) = \\epsilon_{0}.\n$$\nNow we apply the $\\bar{B}$ projection to the volumetric strain. For each element $\\Omega_{e}$, the projected volumetric strain $\\bar{\\epsilon}_{v}^{h}$ is defined as the element-wise average of $\\epsilon_{v}^{h}$:\n$$\n\\bar{\\epsilon}_{v}^{h}\\big|_{\\Omega_{e}} = \\frac{1}{|\\Omega_{e}|}\\int_{\\Omega_{e}}\\epsilon_{v}^{h}\\,d\\Omega.\n$$\nSince $\\epsilon_{v}^{h}$ is constant and equal to $\\epsilon_{0}$ over the element $\\Omega_e$, the integral simplifies:\n$$\n\\bar{\\epsilon}_{v}^{h}\\big|_{\\Omega_{e}} = \\frac{1}{|\\Omega_{e}|}\\int_{\\Omega_{e}}\\epsilon_{0}\\,d\\Omega = \\frac{1}{|\\Omega_{e}|}\\epsilon_{0}|\\Omega_{e}| = \\epsilon_{0}.\n$$\nThus, the projected volumetric strain is exactly equal to the constant exact volumetric strain.\n\nThe stress tensor for the $\\bar{B}$ element, $\\boldsymbol{\\sigma}^{h}$, is computed using the modified volumetric strain:\n$$\n\\boldsymbol{\\sigma}^{h} = 2\\mu\\,\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}_{h}) + \\lambda\\,\\bar{\\epsilon}_{v}^{h}\\,\\mathbf{I}.\n$$\nThe deviatoric strain of the finite element solution is $\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}_{h}) = \\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}^{\\ast}) = \\mathbf{0}$. Substituting this and the value for $\\bar{\\epsilon}_{v}^{h}$ into the stress formula, we get:\n$$\n\\boldsymbol{\\sigma}^{h}\\big|_{\\Omega_{e}} = 2\\mu(\\mathbf{0}) + \\lambda\\,\\epsilon_{0}\\,\\mathbf{I} = \\lambda\\,\\epsilon_{0}\\,\\mathbf{I}.\n$$\nThis result shows that the computed stress is a uniform hydrostatic stress field within each element and is identical to the exact stress $\\boldsymbol{\\sigma}(\\mathbf{u}^{\\ast}) = \\lambda\\epsilon_{v}(\\mathbf{u}^{\\ast})\\mathbf{I} = \\lambda\\epsilon_{0}\\mathbf{I}$ (since $\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}^\\ast)=\\mathbf{0}$). This confirms that the $\\bar{B}$ element passes the volumetric patch test.\n\n**Part 2: Convergence Rate in the Incompressible Limit**\n\nThe problem of linear elasticity in the incompressible limit ($\\lambda \\to \\infty$) is best analyzed within the framework of mixed finite element methods. The constraint of incompressibility, $\\epsilon_{v}(\\mathbf{u}) = \\nabla\\cdot\\mathbf{u} = 0$, is enforced via a Lagrange multiplier, which can be identified with the pressure $p$. The stability and convergence of the numerical method depend on whether the discrete displacement and pressure spaces satisfy the Ladyzhenskaya-Babuška-Brezzi (LBB) or inf-sup condition. A failure to satisfy this condition leads to \"locking,\" a numerical artifact where the solution becomes overly stiff and does not converge to the correct solution as the mesh is refined.\n\nThe convergence rate $p$ in the error estimate $\\|\\mathbf{u}-\\mathbf{u}_{h}\\|_{H^{1}(\\Omega)}\\leq C\\,h^{p}$ is determined by the approximation properties of the finite element space $\\mathcal{V}_h$, provided the method is stable (i.e., locking-free). For a method that locks, the constant $C$ depends on $\\lambda$, and as $\\lambda \\to \\infty$, the error does not converge, meaning the effective rate $p$ is $0$.\n\n**Standard $Q4$ Element:**\nIn the standard displacement-based formulation with $Q4$ elements, the finite element space $\\mathcal{V}_h$ consists of continuous, piecewise bilinear functions. The incompressibility constraint is implicitly enforced through the penalty term $\\lambda\\int_{\\Omega}(\\nabla\\cdot\\mathbf{u}_h)(\\nabla\\cdot\\mathbf{w}_h)d\\Omega$. This formulation is equivalent to a mixed method where the discrete pressure space $\\mathcal{Q}_h$ is the space of volumetric strains $\\{\\nabla\\cdot\\mathbf{w}_h \\mid \\mathbf{w}_h \\in \\mathcal{V}_h\\}$. For $Q4$ elements, the components of $\\nabla\\mathbf{u}_h$ are linear (but not bilinear) within each element. This results in a discrete pressure space that is too large and has too many constraints relative to the discrete displacement space. Specifically, for a grid of four elements meeting at a vertex, there exists a \"checkerboard\" pressure mode that is not controllable by the displacement field.\nThis mismatch means that the pair of spaces $(\\mathcal{V}_h, \\mathcal{Q}_h)$ for the standard $Q4$ element does not satisfy the LBB condition. As a result, the element exhibits severe volumetric locking in the incompressible limit. The stiffness matrix becomes ill-conditioned, and the numerical solution for displacement does not converge to the exact solution as $h\\to 0$. The error bound's constant $C$ is not independent of $\\lambda$. The asymptotic convergence rate is therefore lost.\n$$\np_{\\text{Q4}} = 0.\n$$\n\n**$\\bar{B}$ Element:**\nThe $\\bar{B}$ modification replaces the true volumetric strain $\\epsilon_{v}^{h}$ in the energy functional with its element-wise average, $\\bar{\\epsilon}_{v}^{h}$. This is equivalent to choosing a different, and more suitable, discrete pressure space. The formulation becomes:\n$$\na_h(\\mathbf{u}_h, \\mathbf{w}_h) = \\int_{\\Omega} 2\\mu\\,\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{u}_{h}):\\boldsymbol{\\epsilon}^{\\text{dev}}(\\mathbf{w}_h)\\,d\\Omega + \\sum_{e} \\int_{\\Omega_e} \\lambda\\,\\bar{\\epsilon}_{v}(\\mathbf{u}_{h})\\,\\bar{\\epsilon}_{v}(\\mathbf{w}_{h})\\,d\\Omega.\n$$\nThis modification corresponds to a mixed method where the pressure is approximated as being piecewise constant over each element. The resulting pair of spaces, bilinear continuous displacements ($\\mathcal{V}_h$ from $Q4$) and piecewise constant pressures ($\\mathcal{Q}_h$ from $P0$), is known as the $Q4-P0$ element. This pair is proven to satisfy the LBB condition.\nSince the $\\bar{B}$ formulation is LBB-stable, it is free of volumetric locking. The error constant $C$ is independent of $\\lambda$ as $\\lambda\\to\\infty$. The convergence rate $p$ is therefore governed by the approximation properties of the finite element spaces. For a sufficiently smooth exact solution $\\mathbf{u} \\in [H^{k+1}(\\Omega)]^2$, the standard interpolation error estimate for the $H^1$-norm using polynomials of degree $k$ is $O(h^k)$. The bilinear functions of the $Q4$ element correspond to $k=1$. Thus, the error in the $H^1$-norm (and seminorm) for displacement behaves as:\n$$\n\\|\\mathbf{u}-\\mathbf{u}_{h}\\|_{H^{1}(\\Omega)} \\leq C h |\\mathbf{u}|_{H^{2}(\\Omega)}.\n$$\nThe asymptotic convergence rate is therefore optimal for a linear element.\n$$\np_{\\bar{B}} = 1.\n$$\nThe ordered pair of rates $(p_{\\text{Q4}},\\,p_{\\bar{B}})$ is $(0, 1)$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & 1\n\\end{pmatrix}\n}\n$$", "id": "3522668"}, {"introduction": "The ultimate test of a mixed finite element's suitability for undrained or incompressible analysis is its stability, governed by the Ladyzhenskaya–Babuška–Brezzi (LBB) condition. This advanced practice challenges you to implement a numerical patch test that directly probes the LBB condition by analyzing the eigenvalues of the Schur complement matrix. By contrasting stable and unstable element formulations on both regular and distorted meshes, you will build a robust computational tool for verifying element performance and identifying spurious pressure modes in practice [@problem_id:3522635].", "problem": "Design a three-dimensional undrained patch test that detects element locking phenomena associated with volumetric incompressibility in computational geomechanics. Start from the mixed small-strain incompressible elasticity formulation, which is the undrained limit of linear poroelasticity where the pore water pressure acts as a Lagrange multiplier enforcing zero volumetric strain. The fundamental base is the principle of virtual work and the definition of deviatoric and volumetric strain. In the undrained regime, the kinematic constraint is $\\Delta \\epsilon_v = 0$, and the pore water pressure $p_{\\mathrm{w}}$ enforces this constraint. Consider the weak form: find displacement $\\boldsymbol{u}$ and pore water pressure $p_{\\mathrm{w}}$ such that, for all kinematically admissible virtual displacements $\\boldsymbol{v}$ and virtual pressures $q$, \n$$\n\\int_{\\Omega} 2\\mu\\,\\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{u}) : \\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{v}) \\, \\mathrm{d}\\Omega\n\\;+\\;\n\\int_{\\Omega} p_{\\mathrm{w}}\\,\\nabla\\cdot \\boldsymbol{v}\\, \\mathrm{d}\\Omega\n\\;+\\;\n\\int_{\\Omega} q\\,\\nabla\\cdot \\boldsymbol{u}\\, \\mathrm{d}\\Omega\n\\;=\\; 0,\n$$\nwith $\\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{u}) = \\boldsymbol{\\varepsilon}(\\boldsymbol{u}) - \\tfrac{1}{3}\\operatorname{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}))\\mathbf{I}$ and $\\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = \\tfrac{1}{2}(\\nabla \\boldsymbol{u} + \\nabla \\boldsymbol{u}^{\\mathsf{T}})$. The shear modulus is $\\mu>0$. The undrained constraint is enforced by $p_{\\mathrm{w}}$; there is no separate volumetric penalty in the deviatoric stiffness term.\n\nTo expose discrete volumetric locking and spurious pressure modes, your task is to develop a computable, finite element (FE) patch test on a simple mesh of the unit cube $\\Omega = [0,1]^3$ partitioned into a regular grid of $2\\times 2\\times 2$ trilinear hexahedra. Use the following discrete mixed formulation: let $V_h$ be the conforming trilinear displacement space ($Q_1$) with three components, and let $Q_h$ be one of the following pressure spaces:\n- $Q_h = P_0$ (piecewise constant per element), denoted $Q_1{-}P_0$.\n- $Q_h = Q_1$ (continuous trilinear per node), denoted $Q_1{-}Q_1$.\n\nDefine the discrete matrices:\n- The deviatoric stiffness $K \\in \\mathbb{R}^{n_u \\times n_u}$ with entries\n$$\nK_{ij} \\;=\\; \\int_{\\Omega} 2\\mu\\,\\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{\\phi}_j) : \\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{\\phi}_i) \\,\\mathrm{d}\\Omega,\n$$\nwhere $\\boldsymbol{\\phi}_j$ is the $j$-th vector-valued displacement basis function in $V_h$.\n- The discrete divergence coupling $G \\in \\mathbb{R}^{n_p \\times n_u}$ with entries\n$$\nG_{\\alpha j} \\;=\\; \\int_{\\Omega} \\psi_\\alpha \\,\\nabla\\cdot \\boldsymbol{\\phi}_j \\,\\mathrm{d}\\Omega,\n$$\nwhere $\\psi_\\alpha$ is the $\\alpha$-th scalar pressure basis function in $Q_h$.\n\nIn the undrained mixed saddle-point system, the Schur complement on the pressure space is $S = G K^{-1} G^{\\mathsf{T}}$. The discrete Ladyzhenskaya–Babuška–Brezzi (LBB) inf-sup stability for incompressibility requires that $S$ be positive semidefinite with a one-dimensional nullspace spanned by the constant pressure field. Any additional near-zero eigenvalues correspond to spurious pressure modes that manifest as volumetric locking or pressure checkerboarding under $p_{\\mathrm{w}}$ constraints.\n\nYour program must:\n1. Assemble $K$ using only the deviatoric part of the strain energy (no volumetric bulk penalty in $K$), with $Q_1$ hexahedral elements and exact $2{\\times}2{\\times}2$ Gauss integration.\n2. Assemble $G$ for both $Q_1{-}P_0$ and $Q_1{-}Q_1$ pairs using the same quadrature. \n3. Regularize $K$ minimally to compute $K^{-1}$ numerically (e.g., add a tiny multiple of the identity) while ensuring the deviatoric nature is preserved in the limit.\n4. Compute the symmetric Schur complement $S = G K^{-1} G^{\\mathsf{T}}$ and its eigenvalues.\n5. Declare “pass” if and only if $S$ has exactly one near-zero eigenvalue (the constant pressure mode) and all others are strictly positive relative to the spectral radius; otherwise “fail.”\n\nTo test mesh sensitivity representative of practical geomechanics meshes, also include a smooth interior distortion of the coordinates that preserves the boundary but warps the interior nodes. Use the smooth bubble distortion\n$$\n\\mathbf{x}' \\;=\\; \\mathbf{x} \\;+\\; s\\,\\beta(\\mathbf{x})\\,\\mathbf{1}, \n\\quad\n\\beta(\\mathbf{x}) \\;=\\; x(1{-}x)\\,y(1{-}y)\\,z(1{-}z),\n$$\nwhere $s$ is a dimensionless amplitude and $\\mathbf{1}$ is the vector with all components equal to $1$. This distortion leaves the boundary fixed and perturbs only interior nodes.\n\nTest Suite and Output:\n- Use three test cases:\n  1. $Q_1{-}P_0$ on the regular mesh ($s=0$).\n  2. $Q_1{-}Q_1$ on the regular mesh ($s=0$).\n  3. $Q_1{-}P_0$ on the distorted mesh with $s=0.3$.\n- For each case, compute the number of near-zero eigenvalues of $S$. Define “near-zero” as eigenvalues less than $\\tau = \\max(10^{-8}\\lambda_{\\max}, 10^{-12})$, where $\\lambda_{\\max}$ is the largest eigenvalue of $S$.\n- Report a boolean for each case: $\\mathrm{True}$ if exactly one near-zero eigenvalue is found, $\\mathrm{False}$ otherwise.\n\nFinal Output Format:\n- Your program should produce a single line of output containing the results as a comma-separated list of booleans enclosed in square brackets (e.g., “[True,False,True]”). No additional text should be printed.\n\nAll quantities are non-dimensional; no physical units are required. Angles are not involved. Percentages are not involved. The required output types are booleans. The computation must be self-contained and reproducible with the specified quadrature and element definitions.", "solution": "The user wants to design a numerical patch test to detect volumetric locking in 3D finite element analysis. This is a standard procedure in computational mechanics for validating mixed finite element formulations. The problem is scientifically sound, well-posed, and all necessary details for implementation are provided.\n\n### Principle-Based Design\n\nThe patch test is based on the mixed formulation of incompressible elasticity and the Ladyzhenskaya–Babuška–Brezzi (LBB) stability condition.\n\n#### 1. Mixed Formulation for Incompressibility\nThe governing equations are derived from the principle of virtual work for a nearly incompressible material, taken to the limit of perfect incompressibility. In this limit, the material cannot undergo volumetric strain ($\\epsilon_v = \\nabla \\cdot \\boldsymbol{u} = 0$), and the pressure field ($p$) acts as a Lagrange multiplier to enforce this kinematic constraint. The weak form of the equilibrium equations is a saddle-point problem: find the displacement $\\boldsymbol{u}$ and pressure $p$ that satisfy the given variational equation for all kinematically admissible virtual fields.\n\nThe problem statement provides the weak form specific to the deviatoric part of the strain energy, which is appropriate for the incompressible limit:\n$$\n\\int_{\\Omega} 2\\mu\\,\\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{u}) : \\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{v}) \\, \\mathrm{d}\\Omega\n\\;+\\;\n\\int_{\\Omega} p\\,\\nabla\\cdot \\boldsymbol{v}\\, \\mathrm{d}\\Omega\n\\;+\\;\n\\int_{\\Omega} q\\,\\nabla\\cdot \\boldsymbol{u}\\, \\mathrm{d}\\Omega\n\\;=\\; 0\n$$\nwhere $\\boldsymbol{v}$ is the virtual displacement and $q$ is the virtual pressure.\n\n#### 2. Finite Element Discretization\nWe discretize the continuous fields $\\boldsymbol{u}$ and $p$ using finite element basis functions. The displacement field $\\boldsymbol{u}$ is approximated using trilinear ($Q_1$) vector basis functions ($\\boldsymbol{\\phi}_i$), and the pressure field $p$ is approximated using either piecewise constant ($P_0$) or continuous trilinear ($Q_1$) scalar basis functions ($\\psi_\\alpha$). This leads to a linear system of equations:\n$$\n\\begin{pmatrix} \\mathbf{K} & \\mathbf{G}^{\\mathsf{T}} \\\\ \\mathbf{G} & \\mathbf{0} \\end{pmatrix}\n\\begin{pmatrix} \\mathbf{d} \\\\ \\mathbf{p} \\end{pmatrix}\n=\n\\begin{pmatrix} \\mathbf{f} \\\\ \\mathbf{0} \\end{pmatrix}\n$$\nwhere $\\mathbf{d}$ and $\\mathbf{p}$ are vectors of unknown displacement and pressure degrees of freedom (DOFs). The matrices are:\n- $\\mathbf{K}$: The deviatoric stiffness matrix, $K_{ij} = \\int_{\\Omega} 2\\mu\\,\\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{\\phi}_j) : \\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{\\phi}_i) \\,\\mathrm{d}\\Omega$. This matrix is derived strictly from the deviatoric strain energy and is singular due to unconstrained rigid body motions.\n- $\\mathbf{G}$: The discrete divergence (or coupling) matrix, $G_{\\alpha j} = \\int_{\\Omega} \\psi_\\alpha \\,\\nabla\\cdot \\boldsymbol{\\phi}_j \\,\\mathrm{d}\\Omega$.\n\n#### 3. LBB Stability and the Schur Complement\nThe stability and well-posedness of the discrete system depend on the choice of finite element spaces for displacement and pressure, encapsulated by the LBB (or inf-sup) condition. An unstable element pair can lead to numerical artifacts like volumetric locking (an overly stiff response) or spurious pressure oscillations (checkerboarding).\n\nA standard method to analyze LBB stability is to examine the spectrum of the pressure-space Schur complement matrix, $\\mathbf{S} = \\mathbf{G} \\mathbf{K}^{-1} \\mathbf{G}^{\\mathsf{T}}$.\n- The matrix $\\mathbf{K}$ on its own is singular because the problem formulation does not include boundary conditions to prevent rigid body motions. To compute its inverse for the Schur complement, $\\mathbf{K}$ must be regularized. A common technique is to add a small diagonal perturbation, $\\mathbf{K}_{\\text{reg}} = \\mathbf{K} + \\alpha \\mathbf{I}$, which physically corresponds to weakly grounding the body, thereby removing the nullity due to rigid body modes.\n- For a stable element, the Schur complement matrix $\\mathbf{S}$ should be positive semidefinite and have a nullspace of dimension one. This single zero eigenvalue corresponds to the physically meaningful constant pressure mode, which does no work.\n- Any additional zero or near-zero eigenvalues indicate the presence of spurious, non-physical pressure modes. These modes are artifacts of the discretization and are the cause of locking and instability.\n\n#### 4. Algorithmic Implementation of the Patch Test\nThe patch test is implemented as follows:\n1.  **Mesh Generation**: A $2 \\times 2 \\times 2$ grid of trilinear hexahedral elements is defined over the unit cube $\\Omega = [0,1]^3$. To test robustness, a coordinate distortion is applied for one test case, which perturbs interior nodes while keeping the boundary fixed.\n2.  **Matrix Assembly**: The matrices $\\mathbf{K}$ and $\\mathbf{G}$ are assembled element by element using $2 \\times 2 \\times 2$ Gauss quadrature.\n    - For element stiffness $\\mathbf{K}^e$, the integrand is computed using the strain-displacement matrix $\\mathbf{B}$ and the deviatoric constitutive matrix $\\mathbf{D}_{\\text{dev}}$. $k^e = \\int_{V^e} \\mathbf{B}^{\\mathsf{T}} \\mathbf{D}_{\\text{dev}} \\mathbf{B} \\, \\mathrm{d}V$.\n    - For the coupling matrix $\\mathbf{G}^e$, the integrand is $\\psi_\\alpha (\\nabla \\cdot \\boldsymbol{\\phi}_j)$.\n3.  **Schur Complement and Eigen-analysis**: The global matrix $\\mathbf{K}$ is regularized. The Schur complement $\\mathbf{S} = \\mathbf{G} \\mathbf{K}_{\\text{reg}}^{-1} \\mathbf{G}^{\\mathsf{T}}$ is formed. Its eigenvalues are then computed.\n4.  **Verdict**: The number of eigenvalues that are \"near-zero\" (relative to the largest eigenvalue and an absolute tolerance) is counted. If this count is exactly one, the element passes the patch test; otherwise, it fails.\n\nThis procedure is performed for the three specified cases: stable ($Q_1{-}P_0$) and unstable ($Q_1{-}Q_1$) elements on a regular mesh, and the stable element on a distorted mesh. The expected results are `pass`, `fail`, `pass`, respectively, demonstrating the method's ability to detect instability and confirm the robustness of the stable formulation.", "answer": "```python\n# The final runnable code for the volumetric locking patch test.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef get_q1_hex_shape_functions_and_derivs(xi, eta, zeta):\n    \"\"\"\n    Computes Q1 (trilinear) shape functions and their derivatives in the reference element.\n    The reference element is the cube [-1, 1]^3.\n\n    Args:\n        xi, eta, zeta (float): Coordinates of a point within the reference element.\n\n    Returns:\n        tuple[np.ndarray, np.ndarray]:\n            - N: An array of 8 shape function values.\n            - dN_dxi: A (8, 3) array of shape function derivatives w.r.t. (xi, eta, zeta).\n    \"\"\"\n    N = np.zeros(8)\n    dN_dxi = np.zeros((8, 3))\n\n    # Nodal coordinates in the reference element [-1, 1]^3\n    # Ordered CCW from bottom-left-front for bottom face, then top face.\n    xi_coords = np.array([-1, 1, 1, -1, -1, 1, 1, -1])\n    eta_coords = np.array([-1, -1, 1, 1, -1, -1, 1, 1])\n    zeta_coords = np.array([-1, -1, -1, -1, 1, 1, 1, 1])\n\n    for i in range(8):\n        xi_i, eta_i, zeta_i = xi_coords[i], eta_coords[i], zeta_coords[i]\n        \n        term_xi = (1 + xi_i * xi)\n        term_eta = (1 + eta_i * eta)\n        term_zeta = (1 + zeta_i * zeta)\n        \n        N[i] = 0.125 * term_xi * term_eta * term_zeta\n        \n        dN_dxi[i, 0] = 0.125 * xi_i * term_eta * term_zeta\n        dN_dxi[i, 1] = 0.125 * term_xi * eta_i * term_zeta\n        dN_dxi[i, 2] = 0.125 * term_xi * term_eta * zeta_i\n\n    return N, dN_dxi\n\ndef run_patch_test(pressure_space, distortion_s):\n    \"\"\"\n    Performs the 3D undrained patch test for a given element formulation.\n    \"\"\"\n    mu = 1.0  # Shear modulus, can be 1.0 without loss of generality\n\n    # 1. Mesh Generation: 2x2x2 grid on the unit cube [0,1]^3\n    nx, ny, nz = 3, 3, 3  # Number of nodes in each direction\n    num_nodes = nx * ny * nz\n    elem_nx, elem_ny, elem_nz = nx - 1, ny - 1, nz - 1\n    num_elements = elem_nx * elem_ny * elem_nz\n    \n    # Generate node coordinates\n    node_coords = np.mgrid[0:1:nx*1j, 0:1:ny*1j, 0:1:nz*1j].reshape(3, -1).T\n    \n    # Apply smooth interior distortion if specified\n    if distortion_s > 0:\n        s = distortion_s\n        x, y, z = node_coords[:, 0], node_coords[:, 1], node_coords[:, 2]\n        beta = x * (1 - x) * y * (1 - y) * z * (1 - z)\n        node_coords += s * beta[:, np.newaxis] * np.array([1.0, 1.0, 1.0])\n\n    # Define element connectivity\n    elements = []\n    for k in range(elem_nz):\n        for j in range(elem_ny):\n            for i in range(elem_nx):\n                n0 = k * (nx * ny) + j * nx + i\n                elements.append([\n                    n0, n0 + 1, n0 + 1 + nx, n0 + nx,\n                    n0 + nx * ny, n0 + nx * ny + 1, n0 + nx * ny + 1 + nx, n0 + nx * ny + nx\n                ])\n    elements = np.array(elements)\n\n    # 2. Quadrature: 2x2x2 Gaussian quadrature for hexahedra\n    gp_loc, gp_w = np.polynomial.legendre.leggauss(2)\n    \n    # 3. Matrix Assembly\n    num_disp_dofs = num_nodes * 3\n    if pressure_space == 'P0':\n        num_pressure_dofs = num_elements\n    else:  # 'Q1'\n        num_pressure_dofs = num_nodes\n\n    K = np.zeros((num_disp_dofs, num_disp_dofs))\n    G = np.zeros((num_pressure_dofs, num_disp_dofs))\n\n    # Deviatoric constitutive matrix in Voigt notation for engineering strain\n    D_dev = 2 * mu * np.array([\n        [2./3., -1./3., -1./3., 0, 0, 0],\n        [-1./3., 2./3., -1./3., 0, 0, 0],\n        [-1./3., -1./3., 2./3., 0, 0, 0],\n        [0, 0, 0, 0.5, 0, 0],\n        [0, 0, 0, 0, 0.5, 0],\n        [0, 0, 0, 0, 0, 0.5]\n    ])\n\n    for elem_idx, el_nodes in enumerate(elements):\n        coords_el = node_coords[el_nodes]\n        K_el = np.zeros((24, 24))\n        \n        G_el_size = (1, 24) if pressure_space == 'P0' else (8, 24)\n        G_el = np.zeros(G_el_size)\n\n        for z_loc, z_w in zip(gp_loc, gp_w):\n            for y_loc, y_w in zip(gp_loc, gp_w):\n                for x_loc, x_w in zip(gp_loc, gp_w):\n                    w = x_w * y_w * z_w\n                    \n                    N, dN_dxi = get_q1_hex_shape_functions_and_derivs(x_loc, y_loc, z_loc)\n                    J = dN_dxi.T @ coords_el\n                    detJ = np.linalg.det(J)\n                    \n                    if detJ <= 1e-12: continue  # Skip distorted elements with zero/negative volume\n                    J_inv = np.linalg.inv(J)\n                    dN_dX = dN_dxi @ J_inv\n\n                    # Strain-displacement matrix B(6x24) for the element\n                    B = np.zeros((6, 24))\n                    for i in range(8):\n                        dN_dx, dN_dy, dN_dz = dN_dX[i]\n                        B[0, i*3] = dN_dx\n                        B[1, i*3+1] = dN_dy\n                        B[2, i*3+2] = dN_dz\n                        B[3, i*3] = dN_dy; B[3, i*3+1] = dN_dx\n                        B[4, i*3+1] = dN_dz; B[4, i*3+2] = dN_dy\n                        B[5, i*3] = dN_dz; B[5, i*3+2] = dN_dx\n                    \n                    K_el += B.T @ D_dev @ B * detJ * w\n                    \n                    # Divergence of vector basis functions\n                    div_phi = np.zeros(24)\n                    for i in range(8):\n                        div_phi[i*3] = dN_dX[i,0]\n                        div_phi[i*3+1] = dN_dX[i,1]\n                        div_phi[i*3+2] = dN_dX[i,2]\n                        \n                    if pressure_space == 'P0':\n                        psi = 1.0  # Piecewise-constant basis function\n                        G_el[0, :] += psi * div_phi * detJ * w\n                    else:  # Q1\n                        psi = N  # Trilinear basis functions\n                        G_el += np.outer(psi, div_phi) * detJ * w\n\n        # Assemble element matrices into global matrices\n        dof_map = np.array([[3*n, 3*n+1, 3*n+2] for n in el_nodes]).flatten()\n        K[np.ix_(dof_map, dof_map)] += K_el\n\n        if pressure_space == 'P0':\n            G[elem_idx, dof_map] += G_el[0,:]\n        else:  # Q1\n            pressure_dof_map = el_nodes\n            G[np.ix_(pressure_dof_map, dof_map)] += G_el\n\n    # 4. Schur Complement Computation\n    # Regularize K to handle rigid body modes, making it invertible\n    trace_K = np.trace(K)\n    reg_alpha = 1e-10 * trace_K / num_disp_dofs if trace_K > 0 else 1e-10\n    K_reg = K + reg_alpha * np.identity(num_disp_dofs)\n    \n    try:\n        K_inv = np.linalg.inv(K_reg)\n    except np.linalg.LinAlgError:\n        return False  # Singular K, should not occur with regularization\n\n    S = G @ K_inv @ G.T\n    \n    # 5. Eigenvalue Analysis of Schur Complement\n    try:\n        # Use eigh for symmetric matrices\n        eigenvalues = eigh(S, eigvals_only=True)\n    except np.linalg.LinAlgError:\n        return False\n        \n    eigenvalues = np.sort(np.abs(eigenvalues))\n    \n    if len(eigenvalues) == 0 or eigenvalues[-1] < 1e-15:\n        return False  # All eigenvalues are zero, indicates a problem\n\n    lambda_max = eigenvalues[-1]\n    tau = max(1e-8 * lambda_max, 1e-12)\n    near_zero_count = np.sum(eigenvalues < tau)\n    \n    return near_zero_count == 1\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        ('P0', 0.0),    # Case 1: Q1-P0 on a regular mesh\n        ('Q1', 0.0),    # Case 2: Q1-Q1 on a regular mesh\n        ('P0', 0.3),    # Case 3: Q1-P0 on a distorted mesh\n    ]\n\n    results = []\n    for p_space, s_distort in test_cases:\n        result = run_patch_test(pressure_space=p_space, distortion_s=s_distort)\n        results.append(result)\n        \n    # Format the output as specified: a list of booleans\n    # str(True) -> \"True\", str(False) -> \"False\"\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3522635"}]}