{"hands_on_practices": [{"introduction": "This exercise is a foundational skill in computational dynamics, bridging the gap between the theoretical weak form and a computable element matrix. You will implement the standard procedure for deriving the consistent mass matrix for a bilinear quadrilateral element, a workhorse in 2D finite element analysis. By performing the numerical integration and then comparing the result to a simple row-sum lumped matrix, you will gain a concrete understanding of how these two common formulations distribute an element's mass among its nodes [@problem_id:3540965].", "problem": "Consider a single four-node bilinear quadrilateral finite element used to model a homogeneous soil domain in plane strain within the Finite Element Method (FEM). The element occupies a rectangle in physical coordinates with nodes at $(0,0)$, $(L_{x},0)$, $(L_{x},L_{y})$, and $(0,L_{y})$, where $L_{x} > 0$ and $L_{y} > 0$. The soil has uniform mass density $\\rho$ and a uniform out-of-plane thickness $b$. Let the isoparametric parent coordinates be $(\\xi,\\eta) \\in [-1,1] \\times [-1,1]$, and adopt the standard bilinear shape functions\n$$\nN_{1}(\\xi,\\eta) = \\frac{1}{4}(1 - \\xi)(1 - \\eta), \\quad\nN_{2}(\\xi,\\eta) = \\frac{1}{4}(1 + \\xi)(1 - \\eta), \\quad\nN_{3}(\\xi,\\eta) = \\frac{1}{4}(1 + \\xi)(1 + \\eta), \\quad\nN_{4}(\\xi,\\eta) = \\frac{1}{4}(1 - \\xi)(1 + \\eta).\n$$\nStart from the dynamic equilibrium statement and its Galerkin projection to identify the element-level consistent mass matrix $\\mathbf{M}^{\\mathrm{c}}$ with entries $M_{ij}^{\\mathrm{c}} = \\int_{\\Omega_{e}} \\rho\\, b\\, N_{i}\\, N_{j}\\, \\mathrm{d}\\Omega$ for $i,j \\in \\{1,2,3,4\\}$. Using the $2 \\times 2$ Gaussian quadrature rule with points $(\\xi,\\eta) = \\left(\\pm \\frac{1}{\\sqrt{3}}, \\pm \\frac{1}{\\sqrt{3}}\\right)$ and weights all equal to $1$, evaluate the consistent mass matrix $\\mathbf{M}^{\\mathrm{c}}$ exactly for this rectangular element. Then construct the row-sum lumped diagonal by defining $m_{i}^{\\mathrm{L}} = \\sum_{j=1}^{4} M_{ij}^{\\mathrm{c}}$ and forming a diagonal matrix $\\mathbf{M}^{\\mathrm{L}} = \\mathrm{diag}(m_{1}^{\\mathrm{L}}, m_{2}^{\\mathrm{L}}, m_{3}^{\\mathrm{L}}, m_{4}^{\\mathrm{L}})$. Finally, quantify the comparison of the nodal mass distribution by computing the ratio\n$$\nr \\;=\\; \\frac{m_{1}^{\\mathrm{L}}}{M_{11}^{\\mathrm{c}}}.\n$$\nExpress the final answer as an exact simplified fraction with no units.", "solution": "The user wants me to solve a problem in computational geomechanics.\n\nHere's my plan:\n1.  **Validate the problem statement.**\n    *   **Step 1: Extract Givens.** I will list all the provided information: element type, geometry, material properties, shape functions, definition of the consistent mass matrix, the numerical integration scheme, the definition of the lumped mass matrix, and the final quantity to be calculated.\n    *   **Step 2: Validate.** I will check if the problem is scientifically grounded, well-posed, objective, complete, and non-trivial.\n        *   **Scientific Grounding:** The problem deals with standard FEM concepts (bilinear quad, shape functions, consistent and lumped mass matrices, Gaussian quadrature). This is textbook material in computational mechanics.\n        *   **Well-Posed:** The problem asks for a specific ratio based on well-defined quantities and provides a clear path for calculation. A unique solution exists.\n        *   **Objective:** The language is technical and precise.\n        *   **Completeness:** It provides all necessary information including geometry, shape functions, density, thickness, the formula for the consistent mass matrix, the integration rule, and the lumping definition.\n        *   **Realism:** This is a standard academic problem used for teaching and verification in FEM.\n    *   **Step 3: Verdict.** The problem is valid. I will proceed with the solution.\n\n2.  **Solve the problem.**\n    *   **Part 1: Integral Transformation.** I will transform the integral for the consistent mass matrix, $M_{ij}^{\\mathrm{c}} = \\int_{\\Omega_{e}} \\rho b N_{i} N_{j} \\mathrm{d}\\Omega$, from the physical domain $\\Omega_e$ to the parent domain $(\\xi,\\eta) \\in [-1,1] \\times [-1,1]$. This requires calculating the Jacobian determinant, $\\det(\\mathbf{J})$.\n    *   **Part 2: Jacobian Calculation.** I will find the coordinate transformation $x(\\xi, \\eta)$, $y(\\xi, \\eta)$ and then compute the Jacobian matrix $\\mathbf{J}$ and its determinant.\n    *   **Part 3: Numerical Integration Setup.** I will write the integral for $M_{ij}^{\\mathrm{c}}$ in the parent domain and state the formula for the $2 \\times 2$ Gaussian quadrature. The problem states this is an exact method for this case, which is correct because the integrand is a polynomial of degree at most $2$ in each variable, and a $2$-point Gauss rule is exact for polynomials up to degree $2 \\times 2 - 1 = 3$.\n    *   **Part 4: Shape Function Evaluation.** I will calculate the values of the shape functions at the four specified Gauss quadrature points.\n    *   **Part 5: Calculation of $m_{1}^{\\mathrm{L}}$ and $M_{11}^{\\mathrm{c}}$.**\n        *   I will first define the row-sum lumped mass for node 1, $m_{1}^{\\mathrm{L}} = \\sum_{j=1}^{4} M_{1j}^{\\mathrm{c}}$. A key simplification arises from the property $\\sum_{j=1}^{4} N_j = 1$.\n        *   I will apply the Gaussian quadrature formula to compute both $m_{1}^{\\mathrm{L}}$ and the diagonal term $M_{11}^{\\mathrm{c}}$.\n    *   **Part 6: Final Ratio Calculation.** I will compute the ratio $r = m_{1}^{\\mathrm{L}} / M_{11}^{\\mathrm{c}}$.\n\nI will ensure strict adherence to all formatting rules, especially the mandatory use of LaTeX for all mathematical entities.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n-   Element type: Four-node bilinear quadrilateral finite element in plane strain.\n-   Geometry: A rectangle with nodes at $(0,0)$, $(L_{x},0)$, $(L_{x},L_{y})$, and $(0,L_{y})$, where $L_{x} > 0$ and $L_{y} > 0$.\n-   Material properties: Uniform mass density $\\rho$, uniform out-of-plane thickness $b$.\n-   Parent coordinates: $(\\xi,\\eta) \\in [-1,1] \\times [-1,1]$.\n-   Shape functions:\n    $N_{1}(\\xi,\\eta) = \\frac{1}{4}(1 - \\xi)(1 - \\eta)$\n    $N_{2}(\\xi,\\eta) = \\frac{1}{4}(1 + \\xi)(1 - \\eta)$\n    $N_{3}(\\xi,\\eta) = \\frac{1}{4}(1 + \\xi)(1 + \\eta)$\n    $N_{4}(\\xi,\\eta) = \\frac{1}{4}(1 - \\xi)(1 + \\eta)$\n-   Consistent mass matrix definition: $M_{ij}^{\\mathrm{c}} = \\int_{\\Omega_{e}} \\rho\\, b\\, N_{i}\\, N_{j}\\, \\mathrm{d}\\Omega$ for $i,j \\in \\{1,2,3,4\\}$.\n-   Numerical integration rule: $2 \\times 2$ Gaussian quadrature with points $(\\xi,\\eta) = \\left(\\pm \\frac{1}{\\sqrt{3}}, \\pm \\frac{1}{\\sqrt{3}}\\right)$ and weights all equal to $1$.\n-   Lumped mass matrix definition: $m_{i}^{\\mathrm{L}} = \\sum_{j=1}^{4} M_{ij}^{\\mathrm{c}}$, forming a diagonal matrix $\\mathbf{M}^{\\mathrm{L}} = \\mathrm{diag}(m_{1}^{\\mathrm{L}}, m_{2}^{\\mathrm{L}}, m_{3}^{\\mathrm{L}}, m_{4}^{\\mathrm{L}})$.\n-   Quantity to compute: The ratio $r = \\frac{m_{1}^{\\mathrm{L}}}{M_{11}^{\\mathrm{c}}}$.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientifically Grounded:** The problem is firmly based on the standard theory of the Finite Element Method (FEM) as applied to structural or continuum dynamics. The concepts of consistent mass matrices, lumped mass matrices, bilinear shape functions, and Gaussian quadrature are cornerstones of computational mechanics.\n-   **Well-Posed:** The problem provides a clear, quantitative task with all necessary data and definitions. The steps are logical and lead to a unique, deterministic result.\n-   **Objective:** The problem is stated in precise, mathematical language, free of any subjectivity or ambiguity.\n-   **Completeness:** The problem is self-contained. It provides the geometry, material properties, shape functions, and the specific numerical method to be used.\n-   **No other flaws detected:** The problem is non-trivial, requiring a detailed calculation. It is not circular, contradictory, or based on unrealistic physics.\n\n**Step 3: Verdict and Action**\nThe problem is valid. I will proceed with the solution.\n\n### Solution\n\nThe consistent mass matrix for a finite element is derived from the kinetic energy term in the principle of virtual work. Its entries are given by\n$$\nM_{ij}^{\\mathrm{c}} = \\int_{\\Omega_{e}} \\rho\\, b\\, N_{i}\\, N_{j}\\, \\mathrm{d}\\Omega\n$$\nwhere $\\rho$ is the mass density, $b$ is the thickness, $N_i$ and $N_j$ are the shape functions, and the integral is taken over the element domain $\\Omega_e$. To evaluate this integral, we transform it into the isoparametric parent domain $(\\xi,\\eta) \\in [-1,1] \\times [-1,1]$. The differential area element transforms as $\\mathrm{d}\\Omega = \\det(\\mathbf{J})\\, \\mathrm{d}\\xi\\, \\mathrm{d}\\eta$, where $\\mathbf{J}$ is the Jacobian of the coordinate mapping.\n\nThe physical coordinates $(x,y)$ are mapped from the parent coordinates $(\\xi,\\eta)$ using the shape functions:\n$$\nx(\\xi,\\eta) = \\sum_{k=1}^{4} N_{k}(\\xi,\\eta) x_{k} \\quad \\text{and} \\quad y(\\xi,\\eta) = \\sum_{k=1}^{4} N_{k}(\\xi,\\eta) y_{k}\n$$\nThe nodal coordinates are $(x_1, y_1) = (0,0)$, $(x_2, y_2) = (L_x, 0)$, $(x_3, y_3) = (L_x, L_y)$, and $(x_4, y_4) = (0, L_y)$. Substituting these gives:\n$$\nx(\\xi,\\eta) = N_2(\\xi,\\eta)L_x + N_3(\\xi,\\eta)L_x = \\frac{1}{4}(1+\\xi)(1-\\eta)L_x + \\frac{1}{4}(1+\\xi)(1+\\eta)L_x = \\frac{L_x}{4}(1+\\xi)(1-\\eta+1+\\eta) = \\frac{L_x}{2}(1+\\xi)\n$$\n$$\ny(\\xi,\\eta) = N_3(\\xi,\\eta)L_y + N_4(\\xi,\\eta)L_y = \\frac{1}{4}(1+\\xi)(1+\\eta)L_y + \\frac{1}{4}(1-\\xi)(1+\\eta)L_y = \\frac{L_y}{4}(1+\\eta)(1+\\xi+1-\\xi) = \\frac{L_y}{2}(1+\\eta)\n$$\nThe Jacobian matrix $\\mathbf{J}$ is\n$$\n\\mathbf{J} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} = \\begin{pmatrix} \\frac{L_x}{2} & 0 \\\\ 0 & \\frac{L_y}{2} \\end{pmatrix}\n$$\nThe determinant of the Jacobian is constant for this rectangular element:\n$$\n\\det(\\mathbf{J}) = \\frac{L_x L_y}{4}\n$$\nThe integral for the mass matrix entries becomes\n$$\nM_{ij}^{\\mathrm{c}} = \\rho\\, b\\, \\frac{L_x L_y}{4} \\int_{-1}^{1}\\int_{-1}^{1} N_{i}(\\xi,\\eta) N_{j}(\\xi,\\eta)\\, \\mathrm{d}\\xi\\, \\mathrm{d}\\eta\n$$\nThe problem specifies using a $2 \\times 2$ Gaussian quadrature rule. The integral of a function $f(\\xi,\\eta)$ is approximated as\n$$\n\\int_{-1}^{1}\\int_{-1}^{1} f(\\xi,\\eta)\\, \\mathrm{d}\\xi\\, \\mathrm{d}\\eta \\approx \\sum_{k=1}^{4} w_k f(\\xi_k, \\eta_k)\n$$\nThe Gauss points are $(\\xi_k, \\eta_k) = \\left(\\pm \\frac{1}{\\sqrt{3}}, \\pm \\frac{1}{\\sqrt{3}}\\right)$ and the weights are $w_k = 1$ for all $k \\in \\{1,2,3,4\\}$. Since the integrand $N_i N_j$ is a polynomial of degree at most $2$ in $\\xi$ and $2$ in $\\eta$, this rule (which is exact for polynomials up to degree $3$) provides the exact value of the integral.\nLet $C = \\rho b \\frac{L_x L_y}{4}$. Then,\n$$\nM_{ij}^{\\mathrm{c}} = C \\sum_{k=1}^{4} N_{i}(\\xi_k, \\eta_k) N_{j}(\\xi_k, \\eta_k)\n$$\nFirst, we compute the diagonal entry $M_{11}^{\\mathrm{c}}$:\n$$\nM_{11}^{\\mathrm{c}} = C \\sum_{k=1}^{4} [N_{1}(\\xi_k, \\eta_k)]^2\n$$\nNext, we determine the lumped mass at node $1$, $m_{1}^{\\mathrm{L}}$, using the row-sum lumping method:\n$$\nm_{1}^{\\mathrm{L}} = \\sum_{j=1}^{4} M_{1j}^{\\mathrm{c}} = \\sum_{j=1}^{4} C \\sum_{k=1}^{4} N_{1}(\\xi_k, \\eta_k) N_{j}(\\xi_k, \\eta_k) = C \\sum_{k=1}^{4} N_{1}(\\xi_k, \\eta_k) \\left( \\sum_{j=1}^{4} N_{j}(\\xi_k, \\eta_k) \\right)\n$$\nA fundamental property of these shape functions is that they form a partition of unity, i.e., $\\sum_{j=1}^{4} N_{j}(\\xi,\\eta) = 1$ for all $(\\xi,\\eta)$. Thus, the expression for the lumped mass simplifies to\n$$\nm_{1}^{\\mathrm{L}} = C \\sum_{k=1}^{4} N_{1}(\\xi_k, \\eta_k)\n$$\nLet $\\alpha = \\frac{1}{\\sqrt{3}}$. The four Gauss points are $p_1=(-\\alpha, -\\alpha)$, $p_2=(\\alpha, -\\alpha)$, $p_3=(\\alpha, \\alpha)$, and $p_4=(-\\alpha, \\alpha)$. We evaluate $N_1(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta)$ at these points:\n$N_1(p_1) = N_1(-\\alpha, -\\alpha) = \\frac{1}{4}(1+\\alpha)^2$\n$N_1(p_2) = N_1(\\alpha, -\\alpha) = \\frac{1}{4}(1-\\alpha)(1+\\alpha) = \\frac{1}{4}(1-\\alpha^2)$\n$N_1(p_3) = N_1(\\alpha, \\alpha) = \\frac{1}{4}(1-\\alpha)^2$\n$N_1(p_4) = N_1(-\\alpha, \\alpha) = \\frac{1}{4}(1+\\alpha)(1-\\alpha) = \\frac{1}{4}(1-\\alpha^2)$\n\nNow we can compute $m_{1}^{\\mathrm{L}}$:\n$$\nm_{1}^{\\mathrm{L}} = C \\left[ \\frac{1}{4}(1+\\alpha)^2 + \\frac{1}{4}(1-\\alpha^2) + \\frac{1}{4}(1-\\alpha)^2 + \\frac{1}{4}(1-\\alpha^2) \\right]\n$$\n$$\nm_{1}^{\\mathrm{L}} = \\frac{C}{4} \\left[ (1+2\\alpha+\\alpha^2) + (1-\\alpha^2) + (1-2\\alpha+\\alpha^2) + (1-\\alpha^2) \\right] = \\frac{C}{4} [1+1+1+1] = \\frac{C}{4}(4) = C\n$$\nSo, $m_{1}^{\\mathrm{L}} = C = \\rho b \\frac{L_x L_y}{4}$. This is expected, as row-sum lumping allocates one-quarter of the total element mass ($\\rho b L_x L_y$) to each node for a rectangular element.\n\nNext, we compute $M_{11}^{\\mathrm{c}}$:\n$$\nM_{11}^{\\mathrm{c}} = C \\left( [N_1(p_1)]^2 + [N_1(p_2)]^2 + [N_1(p_3)]^2 + [N_1(p_4)]^2 \\right)\n$$\n$$\nM_{11}^{\\mathrm{c}} = C \\left[ \\left(\\frac{1}{4}(1+\\alpha)^2\\right)^2 + \\left(\\frac{1}{4}(1-\\alpha^2)\\right)^2 + \\left(\\frac{1}{4}(1-\\alpha)^2\\right)^2 + \\left(\\frac{1}{4}(1-\\alpha^2)\\right)^2 \\right]\n$$\n$$\nM_{11}^{\\mathrm{c}} = \\frac{C}{16} \\left[ (1+\\alpha)^4 + 2(1-\\alpha^2)^2 + (1-\\alpha)^4 \\right]\n$$\nWe use the identity $(1+\\alpha)^4 + (1-\\alpha)^4 = 2(1+6\\alpha^2+\\alpha^4)$.\n$$\nM_{11}^{\\mathrm{c}} = \\frac{C}{16} \\left[ 2(1+6\\alpha^2+\\alpha^4) + 2(1-2\\alpha^2+\\alpha^4) \\right] = \\frac{C}{8} \\left[ (1+6\\alpha^2+\\alpha^4) + (1-2\\alpha^2+\\alpha^4) \\right] = \\frac{C}{8} [2+4\\alpha^2+2\\alpha^4] = \\frac{C}{4} [1+2\\alpha^2+\\alpha^4]\n$$\nSubstituting $\\alpha^2 = \\left(\\frac{1}{\\sqrt{3}}\\right)^2 = \\frac{1}{3}$ and $\\alpha^4 = \\frac{1}{9}$:\n$$\nM_{11}^{\\mathrm{c}} = \\frac{C}{4} \\left[ 1 + 2\\left(\\frac{1}{3}\\right) + \\frac{1}{9} \\right] = \\frac{C}{4} \\left[ 1 + \\frac{2}{3} + \\frac{1}{9} \\right] = \\frac{C}{4} \\left[ \\frac{9+6+1}{9} \\right] = \\frac{C}{4} \\left( \\frac{16}{9} \\right) = \\frac{4}{9}C\n$$\nFinally, we compute the required ratio $r$:\n$$\nr = \\frac{m_{1}^{\\mathrm{L}}}{M_{11}^{\\mathrm{c}}} = \\frac{C}{\\frac{4}{9}C} = \\frac{1}{\\frac{4}{9}} = \\frac{9}{4}\n$$\nThe ratio of the lumped mass at a node to the diagonal entry of the consistent mass matrix for a bilinear rectangular element is $\\frac{9}{4}$.", "answer": "$$\n\\boxed{\\frac{9}{4}}\n$$", "id": "3540965"}, {"introduction": "The choice between a consistent and a lumped mass matrix has profound consequences for the behavior of a dynamic simulation. This exercise moves from element formulation to the analysis of the global equations of motion, probing the critical concepts of numerical stability and accuracy. By examining the properties of the energy-conserving average-acceleration Newmark method, you will learn to distinguish which effects are due to the time integration algorithm versus the spatial discretization choice [@problem_id:3541023].", "problem": "Consider the undamped, linear semi-discrete equations of motion arising in computational geomechanics after a standard spatial discretization of small-strain elasticity: $M \\ddot{d} + K d = 0$, where $M \\in \\mathbb{R}^{n \\times n}$ and $K \\in \\mathbb{R}^{n \\times n}$ are symmetric positive definite mass and stiffness matrices, respectively, and $d(t) \\in \\mathbb{R}^{n}$ is the displacement vector. Time integration is performed using the average-acceleration Newmark method (parameters $\\gamma = 1/2$, $\\beta = 1/4$) with a fixed time step $\\Delta t > 0$. The discrete mechanical energy at step $n$ is defined by $E^{n} = \\tfrac{1}{2} (v^{n})^{\\top} M v^{n} + \\tfrac{1}{2} (d^{n})^{\\top} K d^{n}$, where $v^{n}$ and $d^{n}$ are the discrete velocity and displacement at time $t^{n} = t^{0} + n \\Delta t$. Two alternative mass matrix constructions are considered for the same mesh and material model: a consistent mass matrix and a lumped (diagonal) mass matrix. The stiffness matrix $K$ and initial conditions are the same in both cases. Neglecting any algebraic solver error and round-off, and keeping $\\Delta t$ fixed, which statement best describes the long-time behavior of the numerical energy $E^{n}$ and the interplay between stability, accuracy, and the choice of mass matrix?\n\nA. For both consistent and lumped mass matrices, $E^{n}$ remains exactly constant for all $n$ (no numerical energy drift), and the scheme is unconditionally stable; the differences between the two mass formulations manifest in the discrete spectrum and phase accuracy (modal dispersion), not in algorithmic dissipation.\n\nB. With a consistent mass matrix, $E^{n}$ is exactly conserved, but with a lumped mass matrix, $E^{n}$ decays monotonically because mass lumping introduces artificial numerical damping into the average-acceleration Newmark method.\n\nC. With a lumped mass matrix, $E^{n}$ is exactly conserved, but with a consistent mass matrix, $E^{n}$ grows for sufficiently large $\\Delta t$ because the average-acceleration Newmark method is only conditionally stable when $M$ has off-diagonal terms.\n\nD. For both consistent and lumped mass matrices, $E^{n}$ decays at a rate proportional to $\\Delta t$, because the average-acceleration Newmark method is intrinsically dissipative even for undamped linear systems.", "solution": "The user-provided problem statement is subjected to validation.\n\n### Step 1: Extract Givens\n- The governing equation for the semi-discretized system is $M \\ddot{d} + K d = 0$.\n- $M \\in \\mathbb{R}^{n \\times n}$ is the symmetric positive definite mass matrix.\n- $K \\in \\mathbb{R}^{n \\times n}$ is the symmetric positive definite stiffness matrix.\n- $d(t) \\in \\mathbb{R}^{n}$ is the vector of time-dependent displacements.\n- The system is linear and undamped.\n- The time integration scheme is the average-acceleration Newmark method, with parameters $\\gamma = 1/2$ and $\\beta = 1/4$.\n- The time step is a fixed value $\\Delta t > 0$.\n- The discrete mechanical energy at step $n$ is defined as $E^{n} = \\tfrac{1}{2} (v^{n})^{\\top} M v^{n} + \\tfrac{1}{2} (d^{n})^{\\top} K d^{n}$.\n- $v^n$ and $d^n$ are the discrete velocity and displacement vectors at time $t^n$.\n- Two types of mass matrices are considered: a consistent mass matrix and a lumped (diagonal) mass matrix.\n- The stiffness matrix $K$ and initial conditions are identical for both cases.\n- It is assumed that algebraic solver errors and round-off errors are negligible.\n- The question asks for a description of the long-time behavior of the numerical energy $E^n$ and the relationship between stability, accuracy, and the choice of mass matrix.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded**: The problem is based on the fundamental equations of linear elastodynamics as discretized by the finite element method, and their numerical solution using the well-established Newmark time integration family. The concepts of consistent vs. lumped mass matrices, numerical energy, stability, and accuracy (dispersion) are standard and central to computational mechanics. The problem is scientifically and mathematically sound.\n2.  **Well-Posed**: The problem is clearly defined. It provides the governing equation, the numerical method with its specific parameters, and the definition of the quantity of interest ($E^n$). The question is specific enough to be answered by analyzing the properties of the given numerical scheme.\n3.  **Objective**: The terminology used is precise, standard, and free of bias or subjective interpretation within the context of computational engineering.\n\nThe problem is self-contained, consistent, and scientifically valid. It does not exhibit any of the flaws listed in the validation checklist.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid**. A solution will be derived.\n\n### Derivation\nThe problem concerns the properties of the average-acceleration Newmark method when applied to the linear undamped equation of motion $M \\ddot{d} + K d = 0$.\n\nThe Newmark method's update rules for displacement and velocity are given by:\n$$ d^{n+1} = d^{n} + \\Delta t v^{n} + (\\Delta t)^2 \\left[ (\\tfrac{1}{2} - \\beta) a^{n} + \\beta a^{n+1} \\right] $$\n$$ v^{n+1} = v^{n} + \\Delta t \\left[ (1 - \\gamma) a^{n} + \\gamma a^{n+1} \\right] $$\nwhere $d^n, v^n, a^n$ are the displacement, velocity, and acceleration at time $t^n$. The problem specifies the average-acceleration method, for which $\\gamma = 1/2$ and $\\beta = 1/4$. Substituting these values, the update rules simplify to:\n$$ d^{n+1} = d^{n} + \\Delta t v^{n} + \\frac{(\\Delta t)^2}{4} (a^{n} + a^{n+1}) \\quad (1) $$\n$$ v^{n+1} = v^{n} + \\frac{\\Delta t}{2} (a^{n} + a^{n+1}) \\quad (2) $$\nFrom equation $(2)$, we can rearrange to find $a^n + a^{n+1} = \\frac{2}{\\Delta t} (v^{n+1} - v^n)$. Substituting this into equation $(1)$ yields:\n$$ d^{n+1} = d^{n} + \\Delta t v^{n} + \\frac{(\\Delta t)^2}{4} \\frac{2}{\\Delta t} (v^{n+1} - v^n) = d^{n} + \\Delta t v^{n} + \\frac{\\Delta t}{2} (v^{n+1} - v^n) $$\n$$ d^{n+1} = d^{n} + \\frac{\\Delta t}{2} (v^{n} + v^{n+1}) \\quad (3) $$\nThis relation shows that the displacement is updated assuming a constant average velocity over the interval $[t^n, t^{n+1}]$, which is characteristic of the trapezoidal rule.\n\nWe now analyze the change in discrete energy $E^n$ over one time step. The change is $\\Delta E = E^{n+1} - E^n$.\n$$ \\Delta E = \\left( \\tfrac{1}{2} (v^{n+1})^{\\top} M v^{n+1} + \\tfrac{1}{2} (d^{n+1})^{\\top} K d^{n+1} \\right) - \\left( \\tfrac{1}{2} (v^{n})^{\\top} M v^{n} + \\tfrac{1}{2} (d^{n})^{\\top} K d^{n} \\right) $$\nThis can be written as the sum of the change in kinetic energy, $\\Delta T$, and the change in potential energy, $\\Delta U$.\n$$ \\Delta T = \\tfrac{1}{2} (v^{n+1})^{\\top} M v^{n+1} - \\tfrac{1}{2} (v^{n})^{\\top} M v^{n} = \\tfrac{1}{2} (v^{n+1} - v^n)^{\\top} M (v^{n+1} + v^n) $$\n$$ \\Delta U = \\tfrac{1}{2} (d^{n+1})^{\\top} K d^{n+1} - \\tfrac{1}{2} (d^{n})^{\\top} K d^{n} = \\tfrac{1}{2} (d^{n+1} - d^n)^{\\top} K (d^{n+1} + d^n) $$\nThe factorizations above rely on the symmetry of $M$ and $K$. Now, we use the Newmark relations. From $(3)$, we have $(v^n + v^{n+1}) = \\frac{2}{\\Delta t}(d^{n+1} - d^n)$. Substitute this into the expression for $\\Delta T$:\n$$ \\Delta T = \\tfrac{1}{2} (v^{n+1} - v^n)^{\\top} M \\left( \\frac{2}{\\Delta t}(d^{n+1} - d^n) \\right) = \\frac{1}{\\Delta t} (v^{n+1} - v^n)^{\\top} M (d^{n+1} - d^n) $$\nThe work-energy principle in the discrete setting states that the change in kinetic energy equals the work done by the forces. The work done by the internal forces is approximated using the trapezoidal rule as:\n$$ W^{n \\to n+1} = -\\tfrac{1}{2} (F^{n} + F^{n+1})^{\\top} (d^{n+1} - d^n) $$\nwhere the internal force is $F = -Kd$. So, $W^{n \\to n+1} = \\tfrac{1}{2} (Kd^n + Kd^{n+1})^{\\top} (d^{n+1} - d^n)$. The equation of motion holds at the discrete time points: $Ma^n = -Kd^n$ and $Ma^{n+1} = -Kd^{n+1}$. Therefore, $M(a^n+a^{n+1}) = -K(d^n+d^{n+1})$.\nLet's evaluate $\\Delta T+\\Delta U$.\n$\\Delta T + \\Delta U = \\tfrac{1}{2} (v^{n+1} - v^n)^{\\top} M (v^{n+1} + v^n) + \\tfrac{1}{2} (d^{n+1} - d^n)^{\\top} K (d^{n+1} + d^n)$.\nSubstitute $v^{n+1} - v^n = \\frac{\\Delta t}{2}(a^n + a^{n+1})$ from $(2)$ and $d^{n+1} - d^n = \\frac{\\Delta t}{2}(v^n + v^{n+1})$ from $(3)$:\n$$ \\Delta E = \\tfrac{1}{2} \\left[ \\frac{\\Delta t}{2}(a^n + a^{n+1}) \\right]^{\\top} M (v^{n+1} + v^n) + \\tfrac{1}{2} \\left[ \\frac{\\Delta t}{2}(v^n + v^{n+1}) \\right]^{\\top} K (d^{n+1} + d^n) $$\n$$ \\Delta E = \\frac{\\Delta t}{4} \\left[ (a^n + a^{n+1})^{\\top} M (v^{n+1} + v^n) + (v^n + v^{n+1})^{\\top} K (d^{n+1} + d^n) \\right] $$\nUsing the symmetry of $K$, the second term is $(d^{n+1} + d^n)^{\\top} K (v^n + v^{n+1})$. This does not appear to simplify easily.\nLet's return to the work-energy connection. The change in kinetic energy can be expressed as:\n$\\Delta T = \\frac{1}{2} (v^{n+1}+v^n)^\\top M (v^{n+1}-v^n)$. Using $(2)$, $v^{n+1}-v^n = (\\Delta t/2) (a^n+a^{n+1})$.\n$\\Delta T = \\frac{\\Delta t}{4} (v^{n+1}+v^n)^\\top M (a^n+a^{n+1})$.\nFrom the equation of motion, $M(a^n+a^{n+1}) = -K(d^n+d^{n+1})$.\n$\\Delta T = -\\frac{\\Delta t}{4} (v^{n+1}+v^n)^\\top K (d^n+d^{n+1})$.\nNow, using $(3)$, $(v^n+v^{n+1}) = (2/\\Delta t)(d^{n+1}-d^n)$.\n$\\Delta T = -\\frac{\\Delta t}{4} \\left(\\frac{2}{\\Delta t}(d^{n+1}-d^n)\\right)^\\top K (d^n+d^{n+1}) = -\\frac{1}{2} (d^{n+1}-d^n)^\\top K (d^n+d^{n+1})$.\nRecall that $\\Delta U = \\frac{1}{2} (d^{n+1}-d^n)^\\top K (d^{n+1}+d^n)$.\nThus, we have proven that $\\Delta T = -\\Delta U$, which implies $\\Delta T + \\Delta U = 0$.\nThe total discrete energy change is $\\Delta E = 0$.\n\nThis result demonstrates that the average-acceleration Newmark method is exactly energy-conserving for any linear undamped system. The derivation relies only on the symmetry of $M$ and $K$, not on whether $M$ is diagonal or full. Therefore, energy is conserved for **both** the consistent and lumped mass matrix formulations.\n\nFurthermore, for linear systems, the average-acceleration method ($\\gamma=1/2, \\beta=1/4$) is known to be **unconditionally stable**. The stability does not depend on the time step $\\Delta t$ and is not affected by whether the mass matrix is consistent or lumped.\n\nThe primary difference between using a consistent mass matrix and a lumped one lies in the spatial accuracy of the semi-discretization. The two matrices lead to different generalized eigenvalue problems, $(K - \\omega_i^2 M) \\phi_i = 0$, resulting in different sets of natural frequencies $\\{\\omega_i\\}$ and mode shapes $\\{\\phi_i\\}$. A consistent mass matrix generally yields a \"stiffer\" discrete system with higher natural frequencies than a lumped mass matrix for the same mesh. The time integration accuracy, particularly the phase error (numerical dispersion), is a function of $\\omega_i \\Delta t$. Since the frequencies $\\omega_i$ differ, the phase accuracy and thus the overall solution will differ between the two formulations, even though both are stable and energy-conserving. This difference in spectral properties is a key aspect of their distinct behaviors.\n\n### Option-by-Option Analysis\n\n*   **A. For both consistent and lumped mass matrices, $E^{n}$ remains exactly constant for all $n$ (no numerical energy drift), and the scheme is unconditionally stable; the differences between the two mass formulations manifest in the discrete spectrum and phase accuracy (modal dispersion), not in algorithmic dissipation.**\n    Our derivation proved that $E^n$ is exactly conserved ($\\Delta E=0$) for any symmetric positive definite $M$, which includes both consistent and lumped matrices. The scheme is indeed unconditionally stable for linear systems. The choice of $M$ alters the eigenvalue problem, thereby affecting the system's spectrum and the resulting phase accuracy of the numerical solution. The scheme itself has no algorithmic dissipation. This statement is perfectly aligned with the theoretical properties of the method.\n    **Verdict: Correct.**\n\n*   **B. With a consistent mass matrix, $E^{n}$ is exactly conserved, but with a lumped mass matrix, $E^{n}$ decays monotonically because mass lumping introduces artificial numerical damping into the average-acceleration Newmark method.**\n    This is incorrect. The property of energy conservation for the average-acceleration Newmark method is independent of whether the mass matrix is full or diagonal, as shown in the derivation. Mass lumping is a spatial discretization choice and does not introduce damping into this specific time integration algorithm.\n    **Verdict: Incorrect.**\n\n*   **C. With a lumped mass matrix, $E^{n}$ is exactly conserved, but with a consistent mass matrix, $E^{n}$ grows for sufficiently large $\\Delta t$ because the average-acceleration Newmark method is only conditionally stable when $M$ has off-diagonal terms.**\n    This is incorrect. The average-acceleration Newmark method is unconditionally stable for linear systems, irrespective of the structure of the symmetric positive definite mass matrix $M$. The solution does not grow unboundedly for any $\\Delta t > 0$, hence the energy does not grow.\n    **Verdict: Incorrect.**\n\n*   **D. For both consistent and lumped mass matrices, $E^{n}$ decays at a rate proportional to $\\Delta t$, because the average-acceleration Newmark method is intrinsically dissipative even for undamped linear systems.**\n    This is incorrect. Our derivation showed $\\Delta E = 0$. The average-acceleration method is a non-dissipative (energy-conserving) scheme for linear systems. Some other time integration methods are designed to be dissipative, but this is not one of them.\n    **Verdict: Incorrect.**", "answer": "$$\\boxed{A}$$", "id": "3541023"}, {"introduction": "Theoretical principles are best solidified through practical demonstration. This final practice challenges you to create a \"virtual experiment\" that vividly illustrates a crucial concept: the importance of consistency between mass and force representations in a simulation [@problem_id:3541036]. By coding a simple free-fall test, you will directly observe how an inconsistent formulation can violate a fundamental law of physics—the conservation of energy—providing a powerful lesson on the subtleties of numerical modeling.", "problem": "Consider the semi-discrete dynamics of a two-dimensional continuum in free fall under a uniform gravitational acceleration. Start from Newton’s second law and its Galerkin weak form for a body of density $\\rho$ and out-of-plane unit thickness, under gravity $g$ acting in the negative $y$-direction. With a Finite Element Method (FEM) discretization using bilinear isoparametric quadrilateral shape functions $\\{N_i\\}_{i=1}^{4}$ and nodal vertical positions $\\mathbf{y} = [y_1,y_2,y_3,y_4]^T$, the semi-discrete equations for vertical motion read\n$$\n\\mathbf{M}\\,\\mathbf{a} = \\mathbf{f},\n$$\nwhere $\\mathbf{M}$ is the mass matrix and $\\mathbf{f}$ is the gravitational load vector. The consistent mass matrix is defined by\n$$\n\\mathbf{M}_\\text{cons} = \\int_{\\Omega_e} \\rho\\, \\mathbf{N}^{\\mathsf{T}} \\mathbf{N}\\, \\mathrm{d}\\Omega,\n$$\nwith $\\mathbf{N} = [N_1, N_2, N_3, N_4]$ and the element domain $\\Omega_e$, and the consistent body force vector (gravity in the negative $y$ direction with upward-positive coordinate convention) is\n$$\n\\mathbf{f}_\\text{cons} = - \\int_{\\Omega_e} \\rho\\, g\\, \\mathbf{N}^{\\mathsf{T}} \\,\\mathrm{d}\\Omega.\n$$\nLet $\\mathbf{r} = \\int_{\\Omega_e} \\rho\\, \\mathbf{N}^{\\mathsf{T}} \\,\\mathrm{d}\\Omega$ denote the vector of consistent “row masses,” so that $\\mathbf{f}_\\text{cons} = - g \\mathbf{r}$. Consider also a diagonal “lumped” mass matrix $\\mathbf{M}_\\text{lump} = \\mathrm{diag}(m_1,m_2,m_3,m_4)$ obtained by equally distributing the total element mass to its four nodes, $m_i = (\\int_{\\Omega_e} \\rho\\, \\mathrm{d}\\Omega)/4$, regardless of shape distortion. The free-fall initial conditions are $\\mathbf{y}(0) = \\mathbf{y}_0$ (the initial nodal coordinates in meters), and $\\mathbf{v}(0) = \\mathbf{0}$ (initial velocities), with no displacement constraints and no internal stiffness (pure rigid-body free fall of a deformable discretization).\n\nDefine the physical total mechanical energy as the sum of kinetic energy and gravitational potential energy,\n$$\nE(t) = \\tfrac{1}{2}\\, \\mathbf{v}(t)^{\\mathsf{T}}\\, \\mathbf{M}_\\text{cons}\\, \\mathbf{v}(t) \\;+\\; g\\, \\mathbf{r}^{\\mathsf{T}} \\mathbf{y}(t),\n$$\nwhich corresponds to the continuum energy discretized consistently (note the potential energy $g\\,\\mathbf{r}^{\\mathsf{T}}\\mathbf{y}$ equals $\\int_{\\Omega_e} \\rho\\, g\\, y\\, \\mathrm{d}\\Omega$ for upward-positive $y$). Under exact rigid-body free fall, $E(t)$ must remain constant in time.\n\nYou are to construct a counterexample showing that using the diagonal equal-node “lumped” mass matrix $\\mathbf{M}_\\text{lump}$ together with the consistent gravitational load vector $\\mathbf{f}_\\text{cons}$ can inject nonphysical rigid-body energy in a distorted element, even though the consistent formulation $\\mathbf{M}_\\text{cons}$ with the same $\\mathbf{f}_\\text{cons}$ preserves the correct energy balance.\n\nAlgorithmic task:\n- For each element below, compute $\\mathbf{M}_\\text{cons}$ and $\\mathbf{r}$ by $2\\times 2$ Gauss integration over the parent square in isoparametric coordinates, using bilinear shape functions with the standard mapping to the given physical-node coordinates.\n- Form $\\mathbf{M}_\\text{lump}$ by distributing the total element mass equally to the four nodes, $m_i = (\\sum_j r_j)/4$.\n- Compute the nodal accelerations for the consistent and lumped formulations, respectively,\n  $$\n  \\mathbf{a}_\\text{cons} = \\mathbf{M}_\\text{cons}^{-1} \\mathbf{f}_\\text{cons},\\quad\n  \\mathbf{a}_\\text{lump} = \\mathbf{M}_\\text{lump}^{-1} \\mathbf{f}_\\text{cons}.\n  $$\n- Using the exact constant-acceleration kinematics with $\\mathbf{v}(0)=\\mathbf{0}$, advance to time $t$:\n  $$\n  \\mathbf{v}(t) = \\mathbf{a}\\, t,\\qquad \\mathbf{y}(t) = \\mathbf{y}_0 + \\tfrac{1}{2}\\,\\mathbf{a}\\, t^2.\n  $$\n  Do this separately for $\\mathbf{a}_\\text{cons}$ and $\\mathbf{a}_\\text{lump}$ to obtain $\\mathbf{v}_\\text{cons}(t), \\mathbf{y}_\\text{cons}(t)$ and $\\mathbf{v}_\\text{lump}(t), \\mathbf{y}_\\text{lump}(t)$.\n- Compute the energy change relative to the initial energy $E(0)$ for both formulations,\n  $$\n  \\Delta E_\\text{cons}(t) = E_\\text{cons}(t) - E(0),\\qquad\n  \\Delta E_\\text{lump}(t) = E_\\text{lump}(t) - E(0),\n  $$\n  with $E_\\text{cons}(t)$ and $E_\\text{lump}(t)$ both evaluated using the same physical energy definition $E(t) = \\tfrac{1}{2}\\mathbf{v}^{\\mathsf{T}} \\mathbf{M}_\\text{cons}\\mathbf{v} + g \\mathbf{r}^{\\mathsf{T}} \\mathbf{y}$. Use the SI unit Joules (J) for energies.\n\nTest suite and parameters:\n- Material density $\\rho = 1700$ kg/m$^3$, gravitational acceleration $g = 9.81$ m/s$^2$, time $t = 0.2$ s, and unit out-of-plane thickness. Upward-positive $y$-coordinate.\n- Three single-element cases (each case is one bilinear isoparametric quadrilateral with four nodes in counterclockwise order, given as $(x_i, y_i)$ in meters):\n  1. Rectangular (baseline, constant Jacobian): $[(0,0),(2,0),(2,1),(0,1)]$.\n  2. Mildly distorted trapezoid: $[(0,0),(2,0.2),(2,1.2),(0,1)]$.\n  3. Strongly distorted trapezoid: $[(0,0),(2,0.8),(2,1.6),(0,1)]$.\n\nComputational requirements:\n- Implement robust numerical quadrature (exact for bilinear mapping under $2\\times 2$ Gauss rule) to assemble $\\mathbf{M}_\\text{cons}$ and $\\mathbf{r}$.\n- Use the consistent energy definition for both formulations when computing $E(t)$.\n\nDeliverables and final output format:\n- For each test case, output the pair of floats $\\big[\\Delta E_\\text{cons}(t), \\Delta E_\\text{lump}(t)\\big]$ in Joules, rounded to six decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list of these pairs enclosed in square brackets (e.g., \"[[e1_cons,e1_lump],[e2_cons,e2_lump],[e3_cons,e3_lump]]\").\n\nNotes:\n- The counterexample is established if the mildly and strongly distorted cases exhibit $\\Delta E_\\text{lump}(t) > 0$ while $\\Delta E_\\text{cons}(t)$ remains numerically near zero, both reported in Joules. The rectangular case serves as a boundary condition where both should be numerically near zero due to exact equivalence.", "solution": "The problem statement is a valid exercise in computational mechanics, specifically within the domain of the Finite Element Method (FEM) applied to structural dynamics. It is scientifically grounded in the principles of Newtonian mechanics and the Galerkin method, is well-posed with all necessary data and conditions provided, and is objectively formulated. The task is to demonstrate via a counterexample that an inconsistent pairing of a lumped mass matrix with a consistent force vector can lead to a nonphysical violation of energy conservation during simulated rigid-body motion.\n\nThe fundamental physical principle at stake is the conservation of total mechanical energy for a system moving under the influence of a conservative force field. For a body in free fall under uniform gravity, the sum of its kinetic and potential energy must remain constant. The semi-discrete equation of motion derived from a Galerkin finite element formulation is given by:\n$$\n\\mathbf{M}\\,\\mathbf{a} = \\mathbf{f}\n$$\nwhere $\\mathbf{M}$ is the mass matrix, $\\mathbf{a}$ is the vector of nodal accelerations, and $\\mathbf{f}$ is the vector of nodal forces.\n\nThe consistent mass matrix, $\\mathbf{M}_\\text{cons}$, arises directly from the Galerkin procedure and is defined as:\n$$\n\\mathbf{M}_\\text{cons} = \\int_{\\Omega_e} \\rho\\, \\mathbf{N}^{\\mathsf{T}} \\mathbf{N}\\, \\mathrm{d}\\Omega\n$$\nwhere $\\rho$ is the material density, $\\mathbf{N} = [N_1, N_2, N_3, N_4]$ is the vector of bilinear shape functions, and the integral is taken over the element domain $\\Omega_e$. This matrix correctly represents the kinetic energy of the velocity field interpolated by the shape functions.\n\nSimilarly, the consistent body force vector for gravity acting in the negative $y$-direction is:\n$$\n\\mathbf{f}_\\text{cons} = - \\int_{\\Omega_e} \\rho\\, g\\, \\mathbf{N}^{\\mathsf{T}} \\,\\mathrm{d}\\Omega = -g \\mathbf{r}\n$$\nwhere $g$ is the gravitational acceleration and $\\mathbf{r} = \\int_{\\Omega_e} \\rho\\, \\mathbf{N}^{\\mathsf{T}} \\,\\mathrm{d}\\Omega$ is the vector of consistent nodal mass contributions.\n\nA common simplification is to use a diagonal, or \"lumped,\" mass matrix, $\\mathbf{M}_\\text{lump}$, for computational efficiency. The problem specifies a particular lumping scheme where the total element mass, $M_{tot} = \\int_{\\Omega_e} \\rho\\, \\mathrm{d}\\Omega = \\sum_i r_i$, is distributed equally among the four nodes:\n$$\n\\mathbf{M}_\\text{lump} = \\mathrm{diag}\\left(\\frac{M_{tot}}{4}, \\frac{M_{tot}}{4}, \\frac{M_{tot}}{4}, \\frac{M_{tot}}{4}\\right)\n$$\nThe core of this investigation lies in analyzing the \"inconsistent\" system $\\mathbf{M}_\\text{lump} \\mathbf{a} = \\mathbf{f}_\\text{cons}$ and comparing its energy behavior to the consistent system $\\mathbf{M}_\\text{cons} \\mathbf{a} = \\mathbf{f}_\\text{cons}$.\n\nThe total mechanical energy of the discretized system is defined consistently as:\n$$\nE(t) = \\frac{1}{2}\\, \\mathbf{v}(t)^{\\mathsf{T}}\\, \\mathbf{M}_\\text{cons}\\, \\mathbf{v}(t) \\;+\\; g\\, \\mathbf{r}^{\\mathsf{T}} \\mathbf{y}(t)\n$$\nGiven the initial conditions of rest, $\\mathbf{v}(0) = \\mathbf{0}$, the initial energy is purely potential: $E(0) = g\\, \\mathbf{r}^{\\mathsf{T}} \\mathbf{y}_0$. Using constant acceleration kinematics, we have $\\mathbf{v}(t) = \\mathbf{a}t$ and $\\mathbf{y}(t) = \\mathbf{y}_0 + \\frac{1}{2}\\mathbf{a}t^2$. The change in energy from $t=0$ to a later time $t$ is:\n$$\n\\Delta E(t) = E(t) - E(0) = \\left( \\frac{1}{2}(\\mathbf{a}t)^{\\mathsf{T}} \\mathbf{M}_\\text{cons} (\\mathbf{a}t) + g\\mathbf{r}^{\\mathsf{T}} (\\mathbf{y}_0 + \\frac{1}{2}\\mathbf{a}t^2) \\right) - g\\mathbf{r}^{\\mathsf{T}}\\mathbf{y}_0\n$$\n$$\n\\Delta E(t) = \\frac{1}{2}t^2 \\mathbf{a}^{\\mathsf{T}} \\mathbf{M}_\\text{cons} \\mathbf{a} + \\frac{1}{2}t^2 g\\mathbf{r}^{\\mathsf{T}} \\mathbf{a}\n$$\nSubstituting $\\mathbf{f}_\\text{cons} = -g\\mathbf{r}$, we obtain a compact expression for the energy change:\n$$\n\\Delta E(t) = \\frac{1}{2}t^2 \\left( \\mathbf{a}^{\\mathsf{T}} \\mathbf{M}_\\text{cons} \\mathbf{a} - \\mathbf{f}_\\text{cons}^{\\mathsf{T}} \\mathbf{a} \\right)\n$$\nFor the consistent formulation, $\\mathbf{a} = \\mathbf{a}_\\text{cons} = \\mathbf{M}_\\text{cons}^{-1} \\mathbf{f}_\\text{cons}$. This implies $\\mathbf{M}_\\text{cons} \\mathbf{a}_\\text{cons} = \\mathbf{f}_\\text{cons}$. Since $\\mathbf{M}_\\text{cons}$ is symmetric, $\\mathbf{a}_\\text{cons}^{\\mathsf{T}} \\mathbf{M}_\\text{cons} = \\mathbf{f}_\\text{cons}^{\\mathsf{T}}$. Substituting this into the energy change equation yields $\\Delta E_\\text{cons}(t) = \\frac{1}{2}t^2 (\\mathbf{f}_\\text{cons}^{\\mathsf{T}} \\mathbf{a}_\\text{cons} - \\mathbf{f}_\\text{cons}^{\\mathsf{T}} \\mathbf{a}_\\text{cons}) = 0$. Thus, the consistent formulation exactly conserves energy.\n\nFor the lumped formulation specified, $\\mathbf{a} = \\mathbf{a}_\\text{lump} = \\mathbf{M}_\\text{lump}^{-1} \\mathbf{f}_\\text{cons}$. In general, $\\mathbf{M}_\\text{cons} \\mathbf{a}_\\text{lump} \\neq \\mathbf{f}_\\text{cons}$, so the term in the parenthesis for $\\Delta E_\\text{lump}(t)$ will not be zero, leading to a nonphysical change in energy.\n\nThe computational procedure is as follows:\n1.  For each element geometry, the integrals for $\\mathbf{M}_\\text{cons}$ and $\\mathbf{r}$ are computed numerically using a $2 \\times 2$ Gauss quadrature rule over the isoparametric parent element domain $[-1,1] \\times [-1,1]$. This rule is exact for the integrands encountered with bilinear elements, as they are at most cubic polynomials in each parent coordinate $\\xi$ and $\\eta$.\n2.  The Jacobian of the isoparametric mapping, $J(\\xi, \\eta) = \\det(\\mathbf{J})$, is evaluated at each Gauss point. The differential area element is $\\mathrm{d}\\Omega = J(\\xi, \\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$.\n3.  $\\mathbf{M}_\\text{cons}$ and $\\mathbf{r}$ are assembled by summing their respective integrands evaluated at the four Gauss points, multiplied by the material density $\\rho$ and the local Jacobian determinant $J_k$. Since all Gauss weights are $1$, the assembly is:\n    $$\n    \\mathbf{M}_\\text{cons} = \\rho \\sum_{k=1}^{4} \\mathbf{N}(\\xi_k, \\eta_k)^{\\mathsf{T}} \\mathbf{N}(\\xi_k, \\eta_k) J_k, \\quad \\mathbf{r} = \\rho \\sum_{k=1}^{4} \\mathbf{N}(\\xi_k, \\eta_k)^{\\mathsf{T}} J_k\n    $$\n4.  The lumped mass matrix $\\mathbf{M}_\\text{lump}$ and consistent force vector $\\mathbf{f}_\\text{cons}$ are constructed.\n5.  Nodal accelerations $\\mathbf{a}_\\text{cons}$ and $\\mathbf{a}_\\text{lump}$ are calculated by solving the respective linear systems.\n6.  The energy changes $\\Delta E_\\text{cons}(t)$ and $\\Delta E_\\text{lump}(t)$ are computed using the derived formula for a time step of $t=0.2\\,\\text{s}$ with the given material parameters.\n\nThis procedure is implemented for the three specified element geometries. The results are expected to show that for the undistorted rectangular element, both formulations conserve energy. However, for the distorted trapezoidal elements, the inconsistent lumped formulation will inject a spurious, positive amount of energy into the system, with the effect being more pronounced for stronger distortion. This demonstrates the potential for numerical error and instability when consistency between mass and force representations is broken.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and compares the energy conservation of consistent versus\n    inconsistent (lumped mass, consistent force) FEM formulations for\n    a 2D element in free fall.\n    \"\"\"\n    #\n    # --- Problem Parameters ---\n    #\n    rho = 1700.0  # kg/m^3\n    g = 9.81      # m/s^2\n    t = 0.2       # s\n\n    #\n    # --- Test Cases: Nodal coordinates (x, y) in meters ---\n    # Node ordering is counter-clockwise starting from bottom-left.\n    #\n    test_cases = [\n        # Case 1: Rectangular element (baseline)\n        np.array([(0.0, 0.0), (2.0, 0.0), (2.0, 1.0), (0.0, 1.0)]),\n        # Case 2: Mildly distorted trapezoid\n        np.array([(0.0, 0.0), (2.0, 0.2), (2.0, 1.2), (0.0, 1.0)]),\n        # Case 3: Strongly distorted trapezoid\n        np.array([(0.0, 0.0), (2.0, 0.8), (2.0, 1.6), (0.0, 1.0)])\n    ]\n\n    all_results = []\n\n    #\n    # --- Numerical Integration Setup (2x2 Gauss Quadrature) ---\n    #\n    gauss_p = 1.0 / np.sqrt(3.0)\n    gauss_points = [\n        (-gauss_p, -gauss_p), (gauss_p, -gauss_p),\n        (gauss_p, gauss_p), (-gauss_p, gauss_p)\n    ]\n    # Weights for 2x2 Gauss quadrature are all 1.0\n    gauss_weights = [1.0, 1.0, 1.0, 1.0]\n\n    #\n    # --- Main Calculation Loop ---\n    #\n    for nodes in test_cases:\n        #\n        # Step 1: Compute Consistent Mass Matrix (M_cons) and Row-Mass Vector (r_vec)\n        #\n        M_cons = np.zeros((4, 4))\n        r_vec = np.zeros(4)\n\n        for i in range(len(gauss_points)):\n            xi, eta = gauss_points[i]\n            weight = gauss_weights[i]\n\n            # Bilinear shape functions N(xi, eta) at the current Gauss point\n            N = 0.25 * np.array([\n                (1 - xi) * (1 - eta),\n                (1 + xi) * (1 - eta),\n                (1 + xi) * (1 + eta),\n                (1 - xi) * (1 + eta)\n            ])\n\n            # Derivatives of N w.r.t. parent coordinates (xi, eta)\n            dN_dxi = 0.25 * np.array([-(1 - eta), (1 - eta), (1 + eta), -(1 + eta)])\n            dN_deta = 0.25 * np.array([-(1 - xi), -(1 + xi), (1 + xi), (1 - xi)])\n\n            # Jacobian matrix of the isoparametric mapping\n            J_mat = np.array([\n                [np.dot(dN_dxi, nodes[:, 0]), np.dot(dN_dxi, nodes[:, 1])],\n                [np.dot(dN_deta, nodes[:, 0]), np.dot(dN_deta, nodes[:, 1])]\n            ])\n\n            # Jacobian determinant\n            det_J = np.linalg.det(J_mat)\n            if det_J <= 0:\n                raise ValueError(\"Jacobian is non-positive. Element is degenerate or inverted.\")\n\n            # Accumulate contributions to M_cons and r_vec integrals\n            # Unit thickness is assumed (h=1)\n            M_cons += rho * np.outer(N, N) * det_J * weight\n            r_vec += rho * N * det_J * weight\n\n        #\n        # Step 2: Form other matrices and vectors\n        #\n        # Consistent gravitational force vector\n        f_cons = -g * r_vec\n\n        # Lumped mass matrix (equal distribution of total mass)\n        total_mass = np.sum(r_vec)\n        m_lump_diag_val = total_mass / 4.0\n        M_lump = np.diag([m_lump_diag_val] * 4)\n\n        #\n        # Step 3: Compute nodal accelerations for both formulations\n        #\n        # a_cons = inv(M_cons) * f_cons\n        a_cons = np.linalg.solve(M_cons, f_cons)\n        \n        # a_lump = inv(M_lump) * f_cons\n        a_lump = f_cons / m_lump_diag_val\n\n        #\n        # Step 4: Compute the change in total mechanical energy for both cases\n        # Delta_E = 0.5 * t^2 * (a.T @ M_cons @ a - f_cons.T @ a)\n        #\n        \n        # Consistent formulation\n        delta_E_cons = 0.5 * t**2 * (a_cons.T @ M_cons @ a_cons - f_cons.T @ a_cons)\n\n        # Inconsistent \"lumped\" formulation (energy is still measured via M_cons)\n        delta_E_lump = 0.5 * t**2 * (a_lump.T @ M_cons @ a_lump - f_cons.T @ a_lump)\n        \n        # Store results rounded to 6 decimal places\n        all_results.append([round(delta_E_cons, 6), round(delta_E_lump, 6)])\n\n    #\n    # --- Final Output ---\n    #\n    output_str = \"[\" + \",\".join([f\"[{e_c},{e_l}]\" for e_c, e_l in all_results]) + \"]\"\n    print(output_str)\n\nsolve()\n```", "id": "3541036"}]}