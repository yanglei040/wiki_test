{"hands_on_practices": [{"introduction": "Before diving into complex numerical implementations, it is crucial to build a strong intuition for the physical meaning of different boundary conditions. This analytical exercise explores the mixed (or Robin) boundary condition, demonstrating how it serves as a general framework that connects the fundamental Dirichlet (fixed value) and Neumann (fixed flux) types. By analyzing its limiting behavior, you will gain a deeper understanding of how these conditions represent physical interactions at the boundaries of a model [@problem_id:3504212].", "problem": "Consider a one-dimensional vertical soil column, idealized as a prismatic, linearly elastic bar of length $L$, uniform cross-sectional area $A$, and Young's modulus $E$. Let the bar deform only axially, with displacement field $u(x)$ defined along the axis coordinate $x \\in [0,L]$. The column is subjected to a uniform axial body force per unit length $q$ (for example, $q=\\rho g A$ from buoyant self-weight, where $\\rho$ is mass density and $g$ is gravitational acceleration), and there is no inertia or time dependence, so the configuration is in static equilibrium. The fundamental balance of linear momentum in one dimension gives the axial force $N(x)$ satisfying $\\mathrm{d}N/\\mathrm{d}x + q = 0$. The constitutive relation for small-strain linear elasticity gives $N(x) = E A\\, u'(x)$. The base at $x=0$ is fixed by a Dirichlet boundary condition $u(0)=0$. The top end at $x=L$ is connected to a control device that imposes a mixed (Robin) boundary condition\n$$E A\\, u'(L) = k\\big(u(L) - \\bar{u}\\big),$$\nwhere $k \\ge 0$ is an adjustable interface stiffness and $\\bar{u}$ is a target displacement, both real constants. Assume $E0$, $A0$, $L0$, $q$ is finite, and $EA \\neq kL$.\n\nStarting from the stated fundamental laws, derive the closed-form expression for the static displacement $u(x)$ as a function of $x$, $E$, $A$, $L$, $q$, $k$, and $\\bar{u}$. Then, using only analytic reasoning from the derived expression, quantify the limiting displacement field for the two asymptotic regimes $k \\to 0$ and $k \\to \\infty$, and present the three expressions in terms of the same parameters. Express your final answer as analytic expressions (no numerical evaluation is required). If you give multiple expressions, present them in a single row matrix, ordered as $\\big(u(x),\\, \\lim_{k\\to 0}u(x),\\, \\lim_{k\\to\\infty}u(x)\\big)$.", "solution": "The problem provides the fundamental equations governing the static, one-dimensional deformation of a linearly elastic bar. The balance of linear momentum is given by:\n$$\n\\frac{\\mathrm{d}N}{\\mathrm{d}x} + q = 0\n$$\nwhere $N(x)$ is the axial force and $q$ is the distributed body force per unit length. The linear elastic constitutive relation is:\n$$\nN(x) = E A \\frac{\\mathrm{d}u}{\\mathrm{d}x}\n$$\nwhere $u(x)$ is the axial displacement, $E$ is Young's modulus, and $A$ is the cross-sectional area.\n\nBy substituting the constitutive relation into the momentum balance equation, we obtain the governing second-order ordinary differential equation for the displacement $u(x)$. Since $E$ and $A$ are constants, we have:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}x}\\left(E A \\frac{\\mathrm{d}u}{\\mathrm{d}x}\\right) + q = 0 \\implies E A \\frac{\\mathrm{d}^2u}{\\mathrm{d}x^2} = -q\n$$\nThe governing equation is therefore:\n$$\n\\frac{\\mathrm{d}^2u}{\\mathrm{d}x^2} = -\\frac{q}{EA}\n$$\nWe find the general solution by integrating this equation twice with respect to $x$. The first integration yields the strain, $u'(x)$:\n$$\n\\frac{\\mathrm{d}u}{\\mathrm{d}x} = -\\frac{q}{EA}x + C_1\n$$\nwhere $C_1$ is the first integration constant. A second integration yields the displacement field, $u(x)$:\n$$\nu(x) = -\\frac{q}{2EA}x^2 + C_1x + C_2\n$$\nwhere $C_2$ is the second integration constant.\n\nThe two integration constants, $C_1$ and $C_2$, are determined by applying the specified boundary conditions.\nThe first boundary condition is a Dirichlet condition at the base, $x=0$:\n$$\nu(0) = 0\n$$\nSubstituting $x=0$ into the general solution for $u(x)$:\n$$\nu(0) = -\\frac{q}{2EA}(0)^2 + C_1(0) + C_2 = 0 \\implies C_2 = 0\n$$\nThus, the displacement field simplifies to:\n$$\nu(x) = -\\frac{q}{2EA}x^2 + C_1x\n$$\nThe second boundary condition is a mixed (Robin) condition at the top, $x=L$:\n$$\nE A u'(L) = k\\big(u(L) - \\bar{u}\\big)\n$$\nWe need expressions for $u(L)$ and $u'(L)$ from our intermediate solution:\n$$\nu(L) = -\\frac{qL^2}{2EA} + C_1L\n$$\n$$\nu'(L) = -\\frac{qL}{EA} + C_1\n$$\nSubstituting these into the Robin boundary condition:\n$$\nEA \\left(-\\frac{qL}{EA} + C_1\\right) = k\\left(\\left(-\\frac{qL^2}{2EA} + C_1L\\right) - \\bar{u}\\right)\n$$\nWe now solve this equation for the remaining constant, $C_1$.\n$$\n-qL + E A C_1 = -\\frac{kqL^2}{2EA} + kC_1L - k\\bar{u}\n$$\nGathering terms with $C_1$ on one side:\n$$\nE A C_1 - kL C_1 = qL - \\frac{kqL^2}{2EA} - k\\bar{u}\n$$\n$$\nC_1(EA - kL) = qL - k\\left(\\frac{qL^2}{2EA} + \\bar{u}\\right)\n$$\nThe problem states that $EA \\neq kL$, so $(EA - kL) \\neq 0$, and we can divide by this term:\n$$\nC_1 = \\frac{qL - k(\\frac{qL^2}{2EA} + \\bar{u})}{EA - kL}\n$$\nSubstituting this expression for $C_1$ back into the solution for $u(x)$, we obtain the final closed-form expression for the static displacement:\n$$\nu(x) = -\\frac{qx^2}{2EA} + \\left( \\frac{qL - k(\\bar{u} + \\frac{qL^2}{2EA})}{EA - kL} \\right) x\n$$\n\nNext, we analyze the two asymptotic regimes for the interface stiffness $k$.\n\nCase 1: $k \\to 0$. This corresponds to a physically free end, where the boundary condition becomes $EA u'(L) = 0$, a zero-traction (Neumann) condition.\n$$\n\\lim_{k\\to 0} u(x) = \\lim_{k\\to 0} \\left[ -\\frac{qx^2}{2EA} + \\left( \\frac{qL - k(\\bar{u} + \\frac{qL^2}{2EA})}{EA - kL} \\right) x \\right]\n$$\nIn the limit as $k \\to 0$, the term multiplying $x$ simplifies:\n$$\n\\lim_{k\\to 0} \\frac{qL - k(\\bar{u} + \\frac{qL^2}{2EA})}{EA - kL} = \\frac{qL - 0}{EA - 0} = \\frac{qL}{EA}\n$$\nSo, the limiting displacement field is:\n$$\n\\lim_{k\\to 0} u(x) = -\\frac{qx^2}{2EA} + \\frac{qL}{EA}x\n$$\n\nCase 2: $k \\to \\infty$. This physically corresponds to an infinitely stiff connection enforcing a fixed displacement. The boundary condition $EA u'(L) = k(u(L) - \\bar{u})$ can be rewritten as $u(L) - \\bar{u} = \\frac{EA}{k}u'(L)$. As $k \\to \\infty$, the right-hand side goes to zero (assuming finite strain $u'(L)$), which implies $u(L) = \\bar{u}$. This is a fixed displacement (Dirichlet) condition.\nTo find the limit of the expression for $u(x)$, we evaluate the limit of the coefficient of $x$:\n$$\n\\lim_{k\\to \\infty} \\left( \\frac{qL - k(\\bar{u} + \\frac{qL^2}{2EA})}{EA - kL} \\right)\n$$\nThis is an indeterminate form of type $\\infty/\\infty$. We can resolve it by dividing the numerator and denominator by $k$:\n$$\n\\lim_{k\\to \\infty} \\frac{\\frac{qL}{k} - (\\bar{u} + \\frac{qL^2}{2EA})}{\\frac{EA}{k} - L} = \\frac{0 - (\\bar{u} + \\frac{qL^2}{2EA})}{0 - L} = \\frac{\\bar{u} + \\frac{qL^2}{2EA}}{L} = \\frac{\\bar{u}}{L} + \\frac{qL}{2EA}\n$$\nSo, the limiting displacement field is:\n$$\n\\lim_{k\\to\\infty} u(x) = -\\frac{qx^2}{2EA} + \\left(\\frac{\\bar{u}}{L} + \\frac{qL}{2EA}\\right)x\n$$\n\nThe three required expressions are the general solution $u(x)$, the limit for $k \\to 0$, and the limit for $k \\to \\infty$.", "answer": "$$\n\\boxed{\\begin{pmatrix} \\left( \\frac{qL - k(\\bar{u} + \\frac{qL^2}{2EA})}{EA - kL} \\right) x - \\frac{qx^2}{2EA}  \\frac{qLx}{EA} - \\frac{qx^2}{2EA}  \\left(\\frac{\\bar{u}}{L} + \\frac{qL}{2EA}\\right)x - \\frac{qx^2}{2EA} \\end{pmatrix}}\n$$", "id": "3504212"}, {"introduction": "Moving from theory to practice, this exercise focuses on the numerical implementation of essential (Dirichlet) boundary conditions, which is a cornerstone of the finite element method. You will implement the penalty method, an intuitive and widely used technique, for a simple one-dimensional elastic bar. This practice will guide you through the process of modifying the system of equations and highlights the critical choice of the penalty parameter, which must be large enough to enforce the constraint but not so large as to cause numerical ill-conditioning [@problem_id:3504185].", "problem": "A one-dimensional linearly elastic bar occupies the interval $[0,L]$ with constant cross-sectional area $A$ and Young's modulus $E$. The unknown axial displacement field is $u(x)$. The strong form of equilibrium for a body-force-free bar is $ \\frac{d}{dx}\\left(EA \\frac{du}{dx}\\right)=0 $ for $x\\in(0,L)$, with a Dirichlet boundary condition prescribed at $x=0$ as $u(0)=\\bar{u}$ and a Neumann boundary condition prescribed at $x=L$ as $EA\\,u'(L)=\\bar{N}$. Starting from the Principle of Virtual Work (PVW) and basic finite element interpolation with linear shape functions, derive the weak form that incorporates the Dirichlet boundary condition via the penalty method and the Neumann boundary condition in its natural form. Carefully justify the scaling of the penalty parameter with mesh size.\n\nImplement a program that assembles the global stiffness matrix and load vector for a uniform mesh of $N$ linear elements on $[0,L]$, imposes $u(0)=\\bar{u}$ via a penalty term with penalty parameter $\\beta$, imposes the traction at $x=L$ as a natural boundary term, and solves the resulting linear system for the nodal displacements. For the penalty parameter, use the mesh-dependent scaling $\\beta=\\alpha\\,EA/h$, where $h=L/N$ and $\\alpha>0$ is a dimensionless tuning parameter. For each test case, compute the absolute boundary displacement error $e_0=| u_h(0)-\\bar{u} |$ in meters, where $u_h(0)$ is the finite element approximation at $x=0$.\n\nUse the following physically and numerically realistic parameters common in computational geomechanics: $E=50\\times 10^6$ pascals, $A=1.0$ square meters, $L=10.0$ meters, $\\bar{N}=1.0\\times 10^5$ newtons, and $\\bar{u}=0.0$ meters. These values correspond to a stiff geomaterial bar with a moderate axial end load, and the exact analytical solution under these boundary conditions is $u(x)=\\frac{\\bar{N}}{EA}\\,x$, which satisfies $u(0)=0$ and $EA\\,u'(L)=\\bar{N}$.\n\nThe program must evaluate the following test suite of $(\\alpha,N)$ pairs to assess both penalty magnitude and mesh refinement effects:\n- $(\\alpha,N)=\\left(10^{-2},5\\right)$,\n- $(\\alpha,N)=\\left(10^{-2},20\\right)$,\n- $(\\alpha,N)=\\left(10^{-2},80\\right)$,\n- $(\\alpha,N)=\\left(10^{0},5\\right)$,\n- $(\\alpha,N)=\\left(10^{0},20\\right)$,\n- $(\\alpha,N)=\\left(10^{0},80\\right)$,\n- $(\\alpha,N)=\\left(10^{2},5\\right)$,\n- $(\\alpha,N)=\\left(10^{2},20\\right)$,\n- $(\\alpha,N)=\\left(10^{2},80\\right)$.\n\nFor each test case, compute and return the single scalar $e_0$ in meters. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[\\text{result}_1,\\text{result}_2,\\dots,\\text{result}_9]$). All displacement errors must be expressed in meters (m) as floating-point numbers on this single output line in the specified order of the test suite.", "solution": "The problem statement is complete, scientifically sound, and well-posed. It presents a standard problem in one-dimensional computational solid mechanics, requiring the derivation and implementation of the finite element method for a linearly elastic bar with mixed boundary conditions. The physical parameters and numerical methods are standard and appropriate for the field of computational geomechanics. We may therefore proceed with the solution.\n\nThe solution begins with the Principle of Virtual Work (PVW), which provides the integral-based weak form of the equilibrium problem. For a one-dimensional bar in the absence of body forces, the PVW states that the internal virtual work must equal the external virtual work for any kinematically admissible virtual displacement field $\\delta u(x)$.\n\nThe internal virtual work is the integral of the virtual strain energy density over the domain:\n$$ \\delta W_{int} = \\int_{0}^{L} \\sigma(x) \\delta\\epsilon(x) A \\,dx $$\nHere, $\\sigma(x)$ is the axial stress, $\\delta\\epsilon(x)$ is the virtual axial strain, and $A$ is the constant cross-sectional area. The domain is the interval $[0, L]$.\n\nThe external virtual work is the work done by applied external forces through the virtual displacements. In this problem, the only external force is the point load $\\bar{N}$ applied at $x=L$. Therefore, the external virtual work is:\n$$ \\delta W_{ext} = \\bar{N} \\delta u(L) $$\n\nThe constitutive relation for linear elasticity is $\\sigma(x) = E \\epsilon(x)$, where $E$ is Young's modulus. The strain-displacement kinematic relation is $\\epsilon(x) = \\dfrac{du}{dx}$. The virtual strain is similarly related to the virtual displacement: $\\delta\\epsilon(x) = \\dfrac{d(\\delta u)}{dx}$.\n\nSubstituting these relations into the PVW statement ($\\delta W_{int} = \\delta W_{ext}$) yields the weak form of the equilibrium equation:\nFind $u(x)$ such that $u(0)=\\bar{u}$ and for all admissible virtual displacements $\\delta u(x)$ (where $\\delta u(0) = 0$ in a classical Galerkin formulation):\n$$ \\int_{0}^{L} EA \\dfrac{du}{dx} \\dfrac{d(\\delta u)}{dx} \\,dx = \\bar{N} \\delta u(L) $$\nThis equation is the foundation for our finite element formulation. The Neumann boundary condition $EA u'(L) = \\bar{N}$ is incorporated naturally into the weak form as a work term on the right-hand side, which is why it is termed a natural boundary condition. The Dirichlet boundary condition $u(0)=\\bar{u}$ is an essential boundary condition that must be imposed separately.\n\nTo solve this problem numerically, we employ the finite element method. The domain $[0,L]$ is discretized into $N$ linear elements of equal length $h = L/N$. The total number of nodes is $n_{nodes} = N+1$. Within each element $e$, spanning from global coordinates $x_i$ to $x_{i+1}$, the displacement field $u^{(e)}(x)$ is approximated using linear shape functions $N_i(x)$ and nodal displacements $d_i$:\n$$ u^{(e)}(x) = N_i(x) d_i + N_{i+1}(x) d_{i+1} $$\nSimilarly, the virtual displacement is approximated as:\n$$ \\delta u^{(e)}(x) = N_i(x) \\delta d_i + N_{i+1}(x) \\delta d_{i+1} $$\nThe strain within the element is found by differentiating the displacement approximation:\n$$ \\dfrac{du^{(e)}}{dx} = \\dfrac{dN_i}{dx} d_i + \\dfrac{dN_{i+1}}{dx} d_{i+1} = \\dfrac{1}{h} \\begin{bmatrix} -1  1 \\end{bmatrix} \\begin{Bmatrix} d_i \\\\ d_{i+1} \\end{Bmatrix} = \\mathbf{B}^{(e)} \\mathbf{d}^{(e)} $$\nHere, $\\mathbf{B}^{(e)}$ is the strain-displacement matrix for the element.\n\nThe weak form integral is computed as a sum over all elements. For a single element $e$, the contribution to the internal virtual work is:\n$$ (\\delta\\mathbf{d}^{(e)})^T \\left( \\int_{x_i}^{x_{i+1}} (\\mathbf{B}^{(e)})^T EA \\mathbf{B}^{(e)} \\,dx \\right) \\mathbf{d}^{(e)} = (\\delta\\mathbf{d}^{(e)})^T \\mathbf{k}^{(e)} \\mathbf{d}^{(e)} $$\nThe term $\\mathbf{k}^{(e)}$ is the element stiffness matrix. Since $\\mathbf{B}^{(e)}$, $E$, and $A$ are constant within the element, the integral is straightforward:\n$$ \\mathbf{k}^{(e)} = \\int_{0}^{h} \\left(\\dfrac{EA}{h^2} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}\\right) dx' = \\dfrac{EA}{h} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix} $$\nThe element stiffness matrices are assembled into a global $(N+1) \\times (N+1)$ stiffness matrix $\\mathbf{K}$. The global system of equations before imposing boundary conditions is $\\mathbf{K}\\mathbf{d} = \\mathbf{F}$, where $\\mathbf{d}$ is the vector of global nodal displacements and $\\mathbf{F}$ is the global force vector. The natural boundary condition at $x=L$ (node $N$) contributes $\\bar{N}$ to the $N$-th component of $\\mathbf{F}$.\n\nThe Dirichlet condition $u(0)=\\bar{u}$, or $d_0=\\bar{u}$, is imposed using the penalty method. This method modifies the total potential energy $\\Pi$ of the system by adding a penalty term:\n$$ \\Pi_{pen} = \\Pi + \\dfrac{1}{2} \\beta (u(0) - \\bar{u})^2 = \\dfrac{1}{2} \\int_{0}^{L} EA \\left(\\dfrac{du}{dx}\\right)^2 dx - \\bar{N} u(L) + \\dfrac{1}{2} \\beta (u(0) - \\bar{u})^2 $$\nwhere $\\beta \\gg 0$ is the penalty parameter. Taking the variation of $\\Pi_{pen}$ and setting it to zero ($\\delta \\Pi_{pen}=0$) gives the modified weak form:\n$$ \\int_{0}^{L} EA \\dfrac{du}{dx} \\dfrac{d(\\delta u)}{dx} \\,dx + \\beta (u(0)-\\bar{u})\\delta u(0) = \\bar{N} \\delta u(L) $$\nIn the discrete system, this modification affects the equations for node $0$:\n$$ (\\mathbf{K}\\mathbf{d})_0 + \\beta (d_0 - \\bar{u}) = F_0 $$\nThis is implemented by adding $\\beta$ to the diagonal stiffness term $K_{0,0}$ and adding $\\beta \\bar{u}$ to the force term $F_0$. The modified system of equations $\\mathbf{K}_{pen}\\mathbf{d} = \\mathbf{F}_{pen}$ is:\n$$ K_{0,0} \\rightarrow K_{0,0} + \\beta $$\n$$ F_0 \\rightarrow F_0 + \\beta \\bar{u} $$\nThe problem specifies the scaling for the penalty parameter as $\\beta = \\alpha \\dfrac{EA}{h}$. The physical stiffness at node $0$ is dominated by the contribution from the first element, $K_{0,0} = \\dfrac{EA}{h}$. The modified stiffness term becomes $K'_{0,0} = \\dfrac{EA}{h} + \\alpha \\dfrac{EA}{h} = (1+\\alpha)\\dfrac{EA}{h}$. This scaling ensures that the ratio of the penalty stiffness to the physical stiffness is given by the dimensionless parameter $\\alpha$. It makes the choice of the penalty strength independent of mesh size $h$. For the method to be effective, $\\alpha$ should be large enough (e.g., $\\alpha \\gg 1$) to enforce the constraint accurately, but not so large as to cause numerical ill-conditioning of the matrix $\\mathbf{K}_{pen}$.\n\nThe algorithm to be implemented is as follows:\n1.  For each test case $(\\alpha, N)$, define the mesh parameters: $h=L/N$ and $n_{nodes}=N+1$.\n2.  Calculate the penalty parameter $\\beta = \\alpha\\,EA/h$.\n3.  Initialize the global stiffness matrix $\\mathbf{K}$ of size $(N+1) \\times (N+1)$ and the global force vector $\\mathbf{F}$ of size $(N+1)$ to zeros.\n4.  Compute the element stiffness matrix $\\mathbf{k}^{(e)} = \\dfrac{EA}{h} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}$.\n5.  Assemble $\\mathbf{K}$ by iterating through all $N$ elements and adding their contributions to the global matrix.\n6.  Apply the natural boundary condition by setting the last component of the force vector, $F_N = \\bar{N}$.\n7.  Apply the penalty Dirichlet boundary condition by modifying the first row/column of the system: $K_{0,0} \\leftarrow K_{0,0} + \\beta$ and $F_0 \\leftarrow F_0 + \\beta\\bar{u}$.\n8.  Solve the linear system $\\mathbf{K}\\mathbf{d} = \\mathbf{F}$ for the nodal displacement vector $\\mathbf{d}$.\n9.  Calculate the boundary displacement error $e_0 = |d_0 - \\bar{u}|$. Since $\\bar{u}=0.0$, this is simply $e_0 = |d_0|$.\n10. Store the result and repeat for all test cases.\n\nLet's specify the parameters for computation:\n- Young's Modulus: $E = 50 \\times 10^6$ Pa\n- Cross-sectional Area: $A = 1.0$ m$^2$\n- Bar Length: $L = 10.0$ m\n- Prescribed Displacement: $\\bar{u} = 0.0$ m\n- Prescribed Force: $\\bar{N} = 1.0 \\times 10^5$ N\n- Test Suite: $(\\alpha, N)$ pairs are $\\left(10^{-2},5\\right)$, $\\left(10^{-2},20\\right)$, $\\left(10^{-2},80\\right)$, $\\left(10^{0},5\\right)$, $\\left(10^{0},20\\right)$, $\\left(10^{0},80\\right)$, $\\left(10^{2},5\\right)$, $\\left(10^{2},20\\right)$, and $\\left(10^{2},80\\right)$.\nThe computation will yield nine values for the error $e_0$, which will be reported in the specified format. The analytical solution for the exact displacement $u(x) = \\frac{\\bar{N}}{EA}x$ confirms that $u(0)=0$, so any non-zero value of $u_h(0)$ is due to the approximation error of the penalty method.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No scipy needed, numpy.linalg.solve is sufficient.\n\ndef solve():\n    \"\"\"\n    Solves the 1D elastic bar problem using the Finite Element Method \n    with penalty imposition of Dirichlet boundary conditions.\n    \"\"\"\n\n    # Define physical and material parameters from the problem statement\n    E = 50.0e6  # Young's modulus in Pascals (Pa)\n    A = 1.0     # Cross-sectional area in square meters (m^2)\n    L = 10.0    # Length of the bar in meters (m)\n    N_bar = 1.0e5 # Applied axial force at x=L in Newtons (N)\n    u_bar = 0.0   # Prescribed displacement at x=0 in meters (m)\n\n    # Define the test suite of (alpha, N) pairs\n    test_cases = [\n        (1e-2, 5),\n        (1e-2, 20),\n        (1e-2, 80),\n        (1e0, 5),\n        (1e0, 20),\n        (1e0, 80),\n        (1e2, 5),\n        (1e2, 20),\n        (1e2, 80),\n    ]\n\n    results = []\n    for alpha, N in test_cases:\n        # 1. Preprocessing and Mesh Definition\n        h = L / N                  # Element length\n        num_nodes = N + 1          # Number of nodes\n        \n        # 2. Calculate Penalty Parameter\n        # As per the problem, beta = alpha * E * A / h\n        beta = alpha * E * A / h\n\n        # 3. Element Stiffness Matrix Calculation\n        # For a 1D linear bar element, k_e = (EA/h) * [[1, -1], [-1, 1]]\n        elem_stiffness = (E * A / h) * np.array([[1.0, -1.0], [-1.0, 1.0]])\n\n        # 4. Assembly of Global Stiffness Matrix and Force Vector\n        # Initialize global matrix and vector with zeros\n        K = np.zeros((num_nodes, num_nodes))\n        F = np.zeros(num_nodes)\n\n        # Assemble the stiffness matrix by looping through elements\n        for i in range(N):\n            # Global indices for the element connecting nodes i and i+1\n            g_indices = [i, i + 1]\n            # Add element stiffness contribution to the global matrix\n            K[np.ix_(g_indices, g_indices)] += elem_stiffness\n\n        # 5. Application of Boundary Conditions\n        # a) Natural Boundary Condition (Neumann)\n        # Add the point load N_bar to the last node's force component.\n        F[N] += N_bar\n\n        # b) Essential Boundary Condition (Dirichlet) via Penalty Method\n        # Modify the stiffness and force for the constrained DOF (node 0)\n        # K_00 = K_00 + beta\n        K[0, 0] += beta\n        # F_0 = F_0 + beta * u_bar\n        F[0] += beta * u_bar\n\n        # 6. Solve the Linear System\n        # Solve Kd = F for the nodal displacement vector d\n        d = np.linalg.solve(K, F)\n\n        # 7. Post-processing: Calculate Error\n        # The FEA displacement at x=0 is the first component of the solution vector.\n        u_h_at_0 = d[0]\n        # Calculate the absolute boundary displacement error.\n        e0 = abs(u_h_at_0 - u_bar)\n\n        results.append(e0)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3504185"}, {"introduction": "While the penalty method is straightforward, more advanced techniques offer improved accuracy and robustness for enforcing constraints. This exercise provides a comparative study of three key methods for weakly imposing Dirichlet conditions: the penalty method, the Lagrange multiplier method, and Nitsche's method. By implementing these techniques for a 1D consolidation problem and evaluating the global mass conservation error, you will gain practical insight into the trade-offs and relative performance of these state-of-the-art approaches [@problem_id:3504268].", "problem": "Consider one-dimensional small-strain Biot consolidation in a rigid skeleton limit, so that the fluid pressure field is governed by a diffusion-type Partial Differential Equation (PDE) derived from fluid mass balance and Darcy’s law. Let the spatial domain be $x \\in [0,L]$, with $L$ in meters. The governing equation for the fluid pressure $p(x,t)$ is\n$$\nS \\, \\frac{\\partial p}{\\partial t}(x,t) - \\frac{\\partial}{\\partial x}\\!\\left( K \\, \\frac{\\partial p}{\\partial x}(x,t) \\right) = 0,\n$$\nwhere $S$ is the storativity (with unit $\\mathrm{Pa}^{-1}$) and $K = k/\\mu$ is the hydraulic diffusivity factor (permeability divided by dynamic viscosity, with unit $\\mathrm{m}^2/(\\mathrm{Pa}\\cdot\\mathrm{s})$). The initial condition is uniform $p(x,0) = p_0$ with $p_0$ in pascals. The left boundary $x=0$ is no-flow (homogeneous Neumann), and the right boundary $x=L$ is drained (Dirichlet), i.e., $p(L,t)=0$. The drained boundary is to be imposed by one of three weak-enforcement strategies: penalty, Lagrange multiplier, and Nitsche’s method.\n\nStarting from the weak form obtained by multiplying the PDE by a test function $w(x)$ and integrating over the domain $[0,L]$,\n$$\n\\int_0^L S \\, w \\, \\frac{\\partial p}{\\partial t} \\, dx + \\int_0^L K \\, \\frac{\\partial w}{\\partial x} \\, \\frac{\\partial p}{\\partial x} \\, dx - w(0) \\, q_N(0,t) - w(L) \\, q_N(L,t) = 0,\n$$\nwith $q_N(x,t)$ denoting the prescribed normal flux, derive a semi-discrete spatial approximation using the Finite Element Method (FEM) with linear (two-node) elements, uniform mesh of $N_e$ elements and $N_n=N_e+1$ nodes, and piecewise linear trial and test functions on each element. Use backward Euler time integration with constant time step $\\Delta t$ to obtain a fully discrete system at each time step. Enforce the drained boundary condition $p(L,t)=0$ by each of the following methods:\n\n1) Penalty method: Add a boundary penalty term proportional to $(p(L,t) - p_D)$ with $p_D=0$, scaled by a dimensionless stabilization parameter $\\gamma_p$ as $\\gamma_p K/h$, where $h$ is the element size of the last element adjacent to $x=L$.\n\n2) Lagrange multiplier method: Impose the constraint $p(L,t)=p_D$ by augmenting the discrete system with a constraint equation using a Lagrange multiplier. Optionally use an augmented Lagrangian regularization adding $\\beta K/h$ on the diagonal of the drained boundary degree of freedom, where $\\beta$ is a dimensionless stabilization parameter (set $\\beta=0$ for the pure Lagrange multiplier and $\\beta > 0$ for the augmented variant).\n\n3) Nitsche’s method: Use the symmetric Nitsche formulation on the drained boundary with stabilization parameter $\\gamma_N$ (dimensionless), adding the consistent terms\n$$\n- \\int_{\\Gamma_D} w \\, (n \\cdot K \\nabla p) \\, ds - \\int_{\\Gamma_D} (n \\cdot K \\nabla w) \\, (p - p_D) \\, ds\n$$\nand a penalty term\n$$\n\\int_{\\Gamma_D} \\gamma_N \\, \\frac{K}{h} \\, w \\, (p - p_D) \\, ds,\n$$\nwhere $n$ is the outward unit normal and $\\Gamma_D=\\{x=L\\}$ in one dimension.\n\nLet the physical parameters be $L = 1\\,\\mathrm{m}$, $S = 1.0\\times 10^{-9}\\,\\mathrm{Pa}^{-1}$, $K = 1.0\\times 10^{-6}\\,\\mathrm{m}^2/(\\mathrm{Pa}\\cdot\\mathrm{s})$, $p_0 = 1.0\\times 10^{5}\\,\\mathrm{Pa}$, and a uniform mesh with $N_e = 40$ so that $h = L/N_e$. Use backward Euler with $\\Delta t = 10\\,\\mathrm{s}$ for a final time $T = 1000\\,\\mathrm{s}$ (i.e., $N_t = T/\\Delta t$ steps).\n\nDefine the total fluid content per unit cross-sectional area at time $t$ as\n$$\nM(t) = S \\int_0^L p(x,t)\\, dx,\n$$\nwhich in the finite element discretization equals $M(t) \\approx \\mathbf{1}^\\top \\mathbf{M}\\, \\mathbf{p}(t)$, where $\\mathbf{M}$ is the consistent mass matrix and $\\mathbf{p}(t)$ is the vector of nodal pressures. Define the outward flux at the drained boundary by Darcy’s law as\n$$\nq_\\mathrm{out}(t) = - K \\, \\frac{\\partial p}{\\partial x}(L,t),\n$$\nand approximate it at each time step by the gradient over the last element as\n$$\nq_\\mathrm{out}(t_n) \\approx K \\, \\frac{p_{N_n-2}(t_n) - p_{N_n-1}(t_n)}{h}.\n$$\nDefine the cumulative discharged fluid content per unit area up to time $T$ as\n$$\nQ(T) = \\sum_{n=1}^{N_t} q_\\mathrm{out}(t_n)\\, \\Delta t.\n$$\nBy global mass conservation, in the absence of sources and with zero flux at $x=0$, the conservation identity is\n$$\nM(T) - M(0) + Q(T) = 0.\n$$\nDefine the mass conservation error as\n$$\n\\Delta m = \\left| M(T) - M(0) + Q(T) \\right|,\n$$\nwith unit meters (fluid content per unit cross-sectional area). Implement and compare the three boundary enforcement strategies by computing $\\Delta m$ for a set of stabilization parameters. Treat $p_D=0$.\n\nYour program must solve the discrete system for each of the following test cases:\n- Penalty method with $\\gamma_p = 0.1$, $\\gamma_p = 10.0$, and $\\gamma_p = 1000.0$.\n- Nitsche’s method with $\\gamma_N = 1.0$, $\\gamma_N = 10.0$, and $\\gamma_N = 100.0$.\n- Lagrange multiplier method with augmented parameter $\\beta = 0.0$ (pure Lagrange multiplier) and $\\beta = 10.0$.\n\nFor each test case, compute and return $\\Delta m$ in meters. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[0.00123,0.00045, \\ldots ]$). All numerical values must be in meters, expressed as floating-point decimal numbers in base-10 notation.", "solution": "The user wants to solve a 1D consolidation problem and compare three different methods for weakly enforcing a Dirichlet boundary condition. I will first validate the problem statement.\n\n### Step 1: Extract Givens\n- **Governing PDE**: $S \\, \\frac{\\partial p}{\\partial t}(x,t) - \\frac{\\partial}{\\partial x}\\!\\left( K \\, \\frac{\\partial p}{\\partial x}(x,t) \\right) = 0$ for $x \\in [0,L]$.\n- **Parameters**: Storativity $S$, hydraulic diffusivity factor $K$.\n- **Initial Condition**: $p(x,0) = p_0$.\n- **Boundary Conditions**: Homogeneous Neumann at $x=0$ (no-flow), Dirichlet at $x=L$ ($p(L,t)=p_D=0$).\n- **Weak Form**: $\\int_0^L S \\, w \\, \\frac{\\partial p}{\\partial t} \\, dx + \\int_0^L K \\, \\frac{\\partial w}{\\partial x} \\, \\frac{\\partial p}{\\partial x} \\, dx - w(0) \\, q_N(0,t) - w(L) \\, q_N(L,t) = 0$.\n- **Discretization**: Linear two-node finite elements ($N_e$ elements, $N_n=N_e+1$ nodes), uniform mesh size $h=L/N_e$. Backward Euler time integration with step $\\Delta t$.\n- **Physical/Numerical Constants**: $L = 1\\,\\mathrm{m}$, $S = 1.0\\times 10^{-9}\\,\\mathrm{Pa}^{-1}$, $K = 1.0\\times 10^{-6}\\,\\mathrm{m}^2/(\\mathrm{Pa}\\cdot\\mathrm{s})$, $p_0 = 1.0\\times 10^{5}\\,\\mathrm{Pa}$, $N_e = 40$, $h = L/N_e$, $\\Delta t = 10\\,\\mathrm{s}$, $T = 1000\\,\\mathrm{s}$.\n- **Boundary Condition Enforcement Methods**:\n    1.  **Penalty**: Add penalty term $\\gamma_p \\, K/h \\, (p(L,t) - p_D)$.\n    2.  **Lagrange Multiplier**: Augment system with constraint $p(L,t)=p_D$ and optional regularization $\\beta \\, K/h$.\n    3.  **Symmetric Nitsche**: Add terms $- \\int_{\\Gamma_D} w \\, (n \\cdot K \\nabla p) \\, ds - \\int_{\\Gamma_D} (n \\cdot K \\nabla w) \\, (p - p_D) \\, ds + \\int_{\\Gamma_D} \\gamma_N \\, \\frac{K}{h} \\, w \\, (p - p_D) \\, ds$.\n- **Analysis Quantities**:\n    -   Total fluid content: $M(t) = S \\int_0^L p(x,t)\\, dx \\approx \\mathbf{1}^\\top \\mathbf{M}\\, \\mathbf{p}(t)$.\n    -   Outward flux: $q_\\mathrm{out}(t) = - K \\, \\frac{\\partial p}{\\partial x}(L,t) \\approx K \\, (p_{N_n-2}(t_n) - p_{N_n-1}(t_n))/h$.\n    -   Cumulative discharge: $Q(T) = \\sum_{n=1}^{N_t} q_\\mathrm{out}(t_n)\\, \\Delta t$.\n    -   Mass conservation error: $\\Delta m = \\left| M(T) - M(0) + Q(T) \\right|$.\n- **Test Cases**:\n    -   Penalty: $\\gamma_p \\in \\{0.1, 10.0, 1000.0\\}$.\n    -   Nitsche: $\\gamma_N \\in \\{1.0, 10.0, 100.0\\}$.\n    -   Lagrange Multiplier: $\\beta \\in \\{0.0, 10.0\\}$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded**: The problem describes 1D fluid diffusion in a porous medium, a cornerstone of geomechanics and hydrology, based on mass conservation and Darcy's law. All models and methods are standard in computational mechanics. The setup is scientifically valid.\n2.  **Well-Posed**: The problem is a well-posed initial-boundary value problem for a parabolic PDE. The numerical formulation is standard and leads to a solvable system of linear equations at each time step.\n3.  **Objective**: All terms are defined with mathematical precision. No subjective language is used.\n4.  **Scientific or Factual Unsoundness**: None. The physics, mathematics, and numerical methods are correct.\n5.  **Non-Formalizable or Irrelevant**: The problem is highly formalizable and directly relevant to the specified topic.\n6.  **Incomplete or Contradictory Setup**: The problem is fully specified. The definition of the discrete total fluid content $M(t) \\approx \\mathbf{1}^\\top \\mathbf{M}\\, \\mathbf{p}(t)$ is correct because for a test function $w(x)=1 = \\sum_i N_i(x)$, the corresponding vector of nodal weights is $\\mathbf{w}=\\mathbf{1}$, and the integral $\\int S w p \\,dx$ becomes $\\mathbf{w}^\\top \\mathbf{M} \\mathbf{p} = \\mathbf{1}^\\top \\mathbf{M} \\mathbf{p}$. The flux approximation is a valid finite difference over the last element. All definitions are consistent.\n7.  **Unrealistic or Infeasible**: The physical parameters are plausible for materials like sand or silt. The numerical parameters define a numerically stable simulation (the backward-Euler scheme is unconditionally stable).\n8.  **Ill-Posed or Poorly Structured**: Not ill-posed. The structure is clear and logical.\n9.  **Pseudo-Profound, Trivial, or Tautological**: The problem is a substantive exercise in numerical analysis, comparing the practical performance of different established numerical techniques.\n10. **Outside Scientific Verifiability**: The results are numerically computable and verifiable.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will proceed with the solution derivation.\n\nThe governing PDE for the fluid pressure $p(x,t)$ is a diffusion equation:\n$$S \\, \\frac{\\partial p}{\\partial t} - \\frac{\\partial}{\\partial x}\\!\\left( K \\, \\frac{\\partial p}{\\partial x} \\right) = 0$$\nWe begin by deriving the semi-discrete finite element approximation. Multiplying by a test function $w(x)$ and integrating over the domain $[0,L]$ yields the weak form. After integration by parts of the second term, we have:\n$$\\int_0^L S \\, w \\, \\frac{\\partial p}{\\partial t} \\, dx + \\int_0^L K \\, \\frac{\\partial w}{\\partial x} \\, \\frac{\\partial p}{\\partial x} \\, dx - \\left[ w K \\frac{\\partial p}{\\partial x} \\right]_0^L = 0$$\nThe boundary term can be written in terms of the Darcy flux $q(x,t) = -K \\frac{\\partial p}{\\partial x}(x,t)$. The weak form becomes:\n$$\\int_0^L S \\, w \\, \\frac{\\partial p}{\\partial t} \\, dx + \\int_0^L K \\, \\frac{\\partial w}{\\partial x} \\, \\frac{\\partial p}{\\partial x} \\, dx + w(L)q(L,t) - w(0)q(0,t) = 0$$\nThe no-flow condition at $x=0$ implies $q(0,t)=0$. The condition at $x=L$ will be handled by the various weak enforcement methods.\n\nWe discretize the spatial domain with $N_e$ linear finite elements of uniform size $h = L/N_e$, having $N_n = N_e+1$ nodes. We approximate the pressure field as $p(x,t) \\approx \\sum_{j=0}^{N_n-1} p_j(t) N_j(x)$, where $p_j(t)$ are the nodal pressure values and $N_j(x)$ are the piecewise linear basis functions. Using the Galerkin method, the test function $w(x)$ is chosen from the same basis, $w(x) = N_i(x)$. This leads to a system of ordinary differential equations:\n$$\\mathbf{M} \\frac{d\\mathbf{p}}{dt} + \\mathbf{K} \\mathbf{p} = \\mathbf{f}$$\nwhere $\\mathbf{p}$ is the vector of nodal pressures, and the matrices are assembled from element contributions:\n-   Consistent Mass Matrix: $\\mathbf{M}_{ij} = \\int_0^L S N_i(x) N_j(x) \\, dx$. For a linear element, $\\mathbf{M}^e = \\frac{S h}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}$.\n-   Stiffness Matrix: $\\mathbf{K}_{ij} = \\int_0^L K N_i'(x) N_j'(x) \\, dx$. For a linear element, $\\mathbf{K}^e = \\frac{K}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$.\n-   Force Vector $\\mathbf{f}$: arises from boundary terms. For now, $f_i(t) = -w(L)q(L,t)|_{w=N_i}$, which is non-zero only for $i=N_n-1$.\n\nApplying the backward Euler scheme for time integration, $\\frac{d\\mathbf{p}}{dt} \\approx \\frac{\\mathbf{p}^{n+1} - \\mathbf{p}^n}{\\Delta t}$, we obtain a fully discrete system to be solved at each time step $n+1$:\n$$(\\mathbf{M} + \\Delta t \\mathbf{K}) \\mathbf{p}^{n+1} = \\mathbf{M} \\mathbf{p}^n + \\Delta t \\mathbf{f}^{n+1}$$\nwhere $\\mathbf{p}^{n+1}$ is the unknown pressure vector at time $t_{n+1}$. The boundary condition $p(L,t) = p_D=0$ is imposed on the node $i=N_n-1$.\n\n**1. Penalty Method**\nThe Dirichlet constraint is enforced approximately by adding a penalty term to the weak form, which can be interpreted as a Robin-type boundary condition where the flux is proportional to the constraint violation: $q(L,t) \\approx \\alpha (p(L,t) - p_D)$. The penalty parameter is given as $\\alpha = \\gamma_p K/h$. The force vector contribution is $f_{N_n-1}^{n+1} = -q(L,t_{n+1}) \\approx -\\alpha (p_{N_n-1}^{n+1} - p_D)$. With $p_D=0$, the system becomes:\n$$(\\mathbf{M} + \\Delta t \\mathbf{K}) \\mathbf{p}^{n+1} + \\Delta t \\alpha \\begin{pmatrix} 0 \\\\ \\vdots \\\\ 0 \\\\ 1 \\end{pmatrix} p_{N_n-1}^{n+1} = \\mathbf{M} \\mathbf{p}^n$$\nThis is equivalent to modifying the system matrix $\\mathbf{A} = \\mathbf{M} + \\Delta t \\mathbf{K}$ by adding a term to its last diagonal entry:\n$$A_{N_n-1, N_n-1} \\rightarrow A_{N_n-1, N_n-1} + \\Delta t \\, \\gamma_p \\frac{K}{h}$$\nThe right-hand side vector is $\\mathbf{b} = \\mathbf{M} \\mathbf{p}^n$. We solve $(\\mathbf{A}_{mod}) \\mathbf{p}^{n+1} = \\mathbf{b}$.\n\n**2. Lagrange Multiplier Method**\nThis method introduces a new unknown, the Lagrange multiplier $\\lambda$, which represents the reaction flux at the boundary, $\\lambda \\approx q(L,t)$. The system is augmented by the exact constraint equation $p_{N_n-1}^{n+1} = p_D = 0$. The force vector becomes $\\mathbf{f}^{n+1} = [0, \\dots, 0, -\\lambda^{n+1}]^\\top$. The full system at step $n+1$ combines the discretized PDE and the constraint:\n$$ \\begin{cases} (\\mathbf{M} + \\Delta t \\mathbf{K}) \\mathbf{p}^{n+1} + \\Delta t \\lambda^{n+1} \\mathbf{c} = \\mathbf{M} \\mathbf{p}^n \\\\ \\mathbf{c}^\\top \\mathbf{p}^{n+1} = p_D \\end{cases} $$\nwhere $\\mathbf{c}$ is a vector with $1$ at index $N_n-1$ and $0$ elsewhere. This forms an $(N_n+1) \\times (N_n+1)$ saddle-point system:\n$$ \\begin{pmatrix} \\mathbf{M} + \\Delta t \\mathbf{K}  \\Delta t \\, \\mathbf{c} \\\\ \\mathbf{c}^\\top  0 \\end{pmatrix} \\begin{pmatrix} \\mathbf{p}^{n+1} \\\\ \\lambda^{n+1} \\end{pmatrix} = \\begin{pmatrix} \\mathbf{M} \\mathbf{p}^n \\\\ p_D \\end{pmatrix} $$\nThe augmented variant adds a stabilization term $\\beta K/h$ to the diagonal entry of the primary degree of freedom, $p_{N_n-1}$. This modifies the $(N_n-1, N_n-1)$ entry of the top-left block of the system matrix:\n$$(\\mathbf{M} + \\Delta t \\mathbf{K})_{N_n-1, N_n-1} \\rightarrow (\\mathbf{M} + \\Delta t \\mathbf{K})_{N_n-1, N_n-1} + \\Delta t \\beta \\frac{K}{h}$$\nFor the pure Lagrange multiplier method, $\\beta=0$. Since $p_D=0$, the last entry of the right-hand side vector is $0$.\n\n**3. Nitsche’s Method**\nThe symmetric Nitsche method modifies the weak form by replacing the natural boundary term $w(L)q(L,t)$ with three terms that weakly enforce the Dirichlet condition. The final weak form is:\n$$\\int_0^L S w \\dot{p}\\,dx + \\int_0^L K w'p'\\,dx - [K p' w]_L - [K w'(p-p_D)]_L + [\\gamma_N \\frac{K}{h}w(p-p_D)]_L = 0$$\nThe three boundary terms contribute to the stiffness matrix $\\mathbf{K}$ and the load vector $\\mathbf{f}$. Discretizing these terms gives rise to modifications of the stiffness matrix entries corresponding to the boundary nodes ($N_n-2$ and $N_n-1$). The total contribution to be added to the standard stiffness matrix, for the sub-block corresponding to these two nodes, is:\n$$ \\mathbf{K}^N = \\frac{K}{h} \\begin{pmatrix} 0  1 \\\\ 1  \\gamma_N-2 \\end{pmatrix} $$\nThe total system stiffness matrix $\\mathbf{K}_{Nitsche}$ is $\\mathbf{K}_{std} + \\mathbf{K}^N$. This results in specific modifications. The standard stiffness matrix block for nodes $(N_n-2, N_n-1)$ is $\\frac{K}{h}\\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$. Adding $\\mathbf{K}^N$ modifies the coupling:\n$$ (\\mathbf{K}_{Nitsche})_{N_n-2, N_n-1} = (\\mathbf{K}_{Nitsche})_{N_n-1, N_n-2} = -K/h + K/h = 0 $$\n$$ (\\mathbf{K}_{Nitsche})_{N_n-1, N_n-1} = K/h + (\\gamma_N - 2)K/h = (\\gamma_N - 1)K/h $$\nThe terms involving $p_D$ contribute to the load vector, but since $p_D=0$, this contribution vanishes. The system to solve is $(\\mathbf{M} + \\Delta t \\mathbf{K}_{Nitsche})\\mathbf{p}^{n+1} = \\mathbf{M} \\mathbf{p}^n$.\n\n**Mass Conservation Error**\nThe mass conservation error $\\Delta m = | M(T) - M(0) + Q(T) |$ is computed to assess the accuracy of each method.\n-   The initial fluid content is $M(0) = S \\int_0^L p_0 \\, dx = S p_0 L$.\n-   The final fluid content is calculated from the final pressure vector $\\mathbf{p}(T)$: $M(T) \\approx \\mathbf{1}^\\top \\mathbf{M} \\mathbf{p}(T)$.\n-   The cumulative outflow $Q(T)$ is the sum of outflows at each time step, $Q(T) = \\sum_{n=1}^{N_t} q_\\mathrm{out}(t_n)\\, \\Delta t$, where the outflow flux is approximated from the solution as $q_\\mathrm{out}(t_n) \\approx K (p_{N_n-2}(t_n) - p_{N_n-1}(t_n))/h$.\n\nThe implementation will simulate the pressure evolution up to $T=1000\\,\\mathrm{s}$ for each of the $8$ test cases and compute the corresponding $\\Delta m$.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D consolidation problem using FEM with different\n    weak boundary condition enforcement methods and calculates the\n    mass conservation error for each.\n    \"\"\"\n\n    # Physical and numerical parameters from the problem statement\n    L = 1.0  # m\n    S = 1.0e-9  # Pa^-1\n    K = 1.0e-6  # m^2/(Pa*s)\n    p0 = 1.0e5  # Pa\n    Ne = 40  # Number of elements\n    h = L / Ne  # Element size\n    Nn = Ne + 1  # Number of nodes\n    T = 1000.0  # s\n    dt = 10.0  # s\n    Nt = int(T / dt)  # Number of time steps\n    pD = 0.0 # Prescribed pressure at drained boundary\n\n    # Test cases from the problem statement\n    test_cases = [\n        ('penalty', 0.1),\n        ('penalty', 10.0),\n        ('penalty', 1000.0),\n        ('nitsche', 1.0),\n        ('nitsche', 10.0),\n        ('nitsche', 100.0),\n        ('lagrange', 0.0),\n        ('lagrange', 10.0),\n    ]\n\n    results = []\n\n    # Assemble global mass (M) and stiffness (K) matrices\n    M = np.zeros((Nn, Nn))\n    K_std = np.zeros((Nn, Nn))\n\n    # Element-level matrices\n    m_e = (S * h / 6.0) * np.array([[2.0, 1.0], [1.0, 2.0]])\n    k_e = (K / h) * np.array([[1.0, -1.0], [-1.0, 1.0]])\n\n    for e in range(Ne):\n        # Global indices for the element's nodes\n        i, j = e, e + 1\n        # Add element contributions to global matrices\n        M[np.ix_([i, j], [i, j])] += m_e\n        K_std[np.ix_([i, j], [i, j])] += k_e\n\n    # Calculate initial mass M(0)\n    M0 = S * p0 * L\n\n    for method, param in test_cases:\n        p = np.full(Nn, p0) # Initial condition p(x,0) = p0\n        Q_T = 0.0 # Cumulative discharged fluid\n\n        for _ in range(Nt):\n            # Form the basic system Ax=b where A = M + dt*K and b = M*p_prev\n            # Make copies to avoid modifying the base matrices\n            K_eff = K_std.copy()\n            \n            # Right-hand side is the same for all methods\n            b_sys = M @ p\n            \n            if method == 'penalty':\n                gamma_p = param\n                A_sys = M + dt * K_eff\n                A_sys[Nn - 1, Nn - 1] += dt * gamma_p * K / h\n                p = np.linalg.solve(A_sys, b_sys)\n\n            elif method == 'nitsche':\n                gamma_N = param\n                # Modify the standard stiffness matrix for Nitsche's method\n                K_eff[Nn - 2, Nn - 1] = 0.0\n                K_eff[Nn - 1, Nn - 2] = 0.0\n                K_eff[Nn - 1, Nn - 1] = (gamma_N - 1.0) * K / h\n                A_sys = M + dt * K_eff\n                p = np.linalg.solve(A_sys, b_sys)\n\n            elif method == 'lagrange':\n                beta = param\n                A = M + dt * K_eff\n                # Add augmentation term if beta > 0\n                if beta > 0:\n                    A[Nn - 1, Nn - 1] += dt * beta * K / h\n                \n                # Assemble augmented system matrix\n                A_aug = np.zeros((Nn + 1, Nn + 1))\n                A_aug[:Nn, :Nn] = A\n                # Sign convention: (M+dt*K)p - dt*lambda*c = M*p_prev\n                # The lambda term is moved to the LHS, so it gets a negative sign.\n                A_aug[Nn - 1, Nn] = -dt\n                A_aug[Nn, Nn - 1] = 1.0\n\n                # Assemble augmented RHS vector\n                b_aug = np.zeros(Nn + 1)\n                b_aug[:Nn] = b_sys\n                b_aug[Nn] = pD\n                \n                sol = np.linalg.solve(A_aug, b_aug)\n                p = sol[:Nn]\n            \n            # Calculate outflow flux for the current time step\n            q_out = K * (p[Nn - 2] - p[Nn - 1]) / h\n            # Accumulate total outflow\n            Q_T += q_out * dt\n        \n        # Calculate final mass M(T)\n        MT = np.ones(Nn) @ M @ p\n        \n        # Calculate mass conservation error\n        delta_m = abs(MT - M0 + Q_T)\n        results.append(delta_m)\n\n    # Print results in the required format\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```", "id": "3504268"}]}