{"hands_on_practices": [{"introduction": "Before diving into complex analyses, it is crucial to master the fundamentals. This first exercise [@problem_id:3264015] challenges you to connect the core assumption of randomized quicksort—a uniformly random pivot choice—to a specific, tangible outcome. By calculating the probability of a \"perfectly balanced\" split, you will solidify your understanding of the probabilistic foundation upon which the entire analysis rests.", "problem": "Consider the standard randomized quicksort on an input array of $n$ distinct keys drawn from a totally ordered set. At the root of the recursion, the algorithm selects a pivot uniformly at random from the $n$ keys, partitions the remaining $n-1$ keys into those less than the pivot and those greater than the pivot, and then recursively sorts the two resulting subarrays. Let $k$ denote the number of keys strictly less than the pivot (so the left subproblem has size $k$ and the right subproblem has size $n-1-k$). Define a perfectly balanced split to mean $k=\\lfloor n/2 \\rfloor$.\n\nStarting from the core definition that the pivot is chosen uniformly at random from the $n$ distinct keys and that its rank among the $n$ keys is equally likely to be any of the integers from $1$ through $n$, derive from first principles the exact probability, as a function of $n$, that the root split is perfectly balanced in the sense $k=\\lfloor n/2 \\rfloor$.\n\nExpress your final answer as a single simplified closed-form expression in terms of $n$. No rounding is required.", "solution": "The problem asks for the probability that the first partition in randomized quicksort on an array of $n$ distinct elements results in a left subproblem of size $k = \\lfloor n/2 \\rfloor$.\n\nLet the distinct input keys, sorted, be $z_1  z_2  \\dots  z_n$. The pivot, let's call it $p$, is chosen uniformly at random from these $n$ keys. This means that the probability of choosing any specific key $z_i$ as the pivot is $P(p=z_i) = \\frac{1}{n}$ for any $i \\in \\{1, 2, \\dots, n\\}$.\n\nLet $R$ be the random variable for the rank of the chosen pivot. The uniform selection rule implies that the probability of the pivot having rank $i$ is $P(R=i) = \\frac{1}{n}$ for all $i \\in \\{1, 2, \\dots, n\\}$.\n\nThe size of the left subproblem, $k$, is the number of elements strictly smaller than the pivot. If the pivot's rank is $R$, then there are $R-1$ elements smaller than it. Thus, $k = R-1$.\n\nWe are interested in the event $k = \\lfloor n/2 \\rfloor$. This is equivalent to the event $R-1 = \\lfloor n/2 \\rfloor$, which can be rewritten as $R = \\lfloor n/2 \\rfloor + 1$.\n\nLet $i_0 = \\lfloor n/2 \\rfloor + 1$. This is a specific integer rank. For any $n \\ge 1$, this rank $i_0$ is a valid rank in the range $\\{1, \\dots, n\\}$.\n\nSince the probability of the pivot having any specific rank $i_0$ is exactly $\\frac{1}{n}$, we have:\n$$P(k = \\lfloor n/2 \\rfloor) = P(R = \\lfloor n/2 \\rfloor + 1) = \\frac{1}{n}$$\nThe probability of a perfectly balanced split, as defined, is therefore $\\frac{1}{n}$.", "answer": "$$\\boxed{\\frac{1}{n}}$$", "id": "3264015"}, {"introduction": "We now move to the classic and most celebrated analysis of randomized quicksort: determining its expected number of comparisons. Instead of wrestling with the entire recursion tree at once, this problem [@problem_id:3263936] guides you through a more elegant approach using indicator random variables and linearity of expectation. This powerful technique allows us to find the total expected cost by simply summing the probabilities of all possible pairwise comparisons.", "problem": "Consider a version of the QuickSort algorithm on an input array $A$ that is a permutation of the set $\\{1, 2, \\ldots, n\\}$, where $n \\geq 2$. At every recursive call that operates on a contiguous subarray $A[L..R]$, let $m = R - L + 1$ denote the subarray length. The algorithm chooses the pivot index uniformly at random from the subarray by calling a Random Number Generator (RNG) that returns an Independent and Identically Distributed (i.i.d.) real value $\\operatorname{rand}()$ drawn uniformly from the interval $[0, 1)$, and then sets the pivot index to $L - 1 + \\lceil \\operatorname{rand}() \\cdot m \\rceil$. The subarray is then partitioned using only key comparisons that compare the pivot key to each other key in the subarray exactly once, and the algorithm recurses on the two partitions. Assume that the RNG calls at different recursive levels are mutually independent.\n\nUsing only foundational definitions of expectation in probability theory, the uniformity of the pivot selection described above, and the structural behavior of QuickSort, derive the exact expected total number of key comparisons performed by the algorithm over the entire execution, expressed as a closed-form analytic expression in terms of $n$ and the $n$-th harmonic number $H_n = \\sum_{k=1}^{n} \\frac{1}{k}$.\n\nYour final answer must be a single analytic expression in terms of $n$ and $H_n$. No numerical rounding is required.", "solution": "Let $X$ be the random variable for the total number of key comparisons. We wish to compute its expectation, $\\mathbb{E}[X]$, using the method of indicator random variables.\n\nLet the distinct input elements, in sorted order, be $z_1  z_2  \\ldots  z_n$. For any pair of indices $i  j$, let $X_{ij}$ be an indicator random variable for the event that the elements $z_i$ and $z_j$ are compared at some point during the algorithm's execution.\n\nThe total number of comparisons is the sum over all pairs:\n$$ X = \\sum_{i=1}^{n-1} \\sum_{j=i+1}^{n} X_{ij} $$\nBy the linearity of expectation, the expected total number of comparisons is:\n$$ \\mathbb{E}[X] = \\mathbb{E}\\left[\\sum_{i=1}^{n-1} \\sum_{j=i+1}^{n} X_{ij}\\right] = \\sum_{i=1}^{n-1} \\sum_{j=i+1}^{n} \\mathbb{E}[X_{ij}] $$\nThe expectation of an indicator variable is the probability of the event it indicates, so $\\mathbb{E}[X_{ij}] = P(z_i \\text{ and } z_j \\text{ are compared})$.\n\nTwo elements $z_i$ and $z_j$ are compared if and only if one of them is selected as a pivot while the other is still in the same subarray. Consider the set of elements $S_{ij} = \\{z_i, z_{i+1}, \\ldots, z_j\\}$. If the first pivot chosen from this set $S_{ij}$ is some element $z_k$ where $i  k  j$, then $z_i$ and $z_j$ will be permanently separated into different subarrays and will never be compared. Therefore, $z_i$ and $z_j$ are compared if and only if the first pivot selected from the set $S_{ij}$ is either $z_i$ or $z_j$.\n\nSince the pivot is chosen uniformly at random from the current subarray, any element in $S_{ij}$ is equally likely to be the first pivot chosen from that set. The set $S_{ij}$ contains $j - i + 1$ elements. There are two \"favorable\" outcomes for a comparison (the pivot is $z_i$ or $z_j$). The probability of comparison is therefore:\n$$ P(z_i \\text{ and } z_j \\text{ are compared}) = \\frac{2}{j - i + 1} $$\nWe now compute the total expected number of comparisons:\n$$ \\mathbb{E}[X] = \\sum_{i=1}^{n-1} \\sum_{j=i+1}^{n} \\frac{2}{j-i+1} $$\nTo evaluate this sum, we group terms by the size of the rank interval, $k = j-i+1$. For a fixed $k \\in \\{2, \\ldots, n\\}$, there are $n-k+1$ pairs $(i,j)$ with this interval size.\n$$ \\mathbb{E}[X] = \\sum_{k=2}^{n} (n-k+1) \\frac{2}{k} = 2 \\sum_{k=2}^{n} \\left(\\frac{n+1}{k} - 1\\right) $$\n$$ \\mathbb{E}[X] = 2 \\left( (n+1)\\sum_{k=2}^{n} \\frac{1}{k} - \\sum_{k=2}^{n} 1 \\right) $$\nUsing the definition of the $n$-th harmonic number, $H_n = \\sum_{k=1}^{n} \\frac{1}{k}$, we have $\\sum_{k=2}^{n} \\frac{1}{k} = H_n - 1$. The second sum is $\\sum_{k=2}^{n} 1 = n-1$.\n$$ \\mathbb{E}[X] = 2 \\left( (n+1)(H_n - 1) - (n-1) \\right) = 2((n+1)H_n - (n+1) - (n-1)) $$\n$$ \\mathbb{E}[X] = 2((n+1)H_n - n - 1 - n + 1) = 2((n+1)H_n - 2n) = 2(n+1)H_n - 4n $$", "answer": "$$\\boxed{2(n+1)H_n - 4n}$$", "id": "3263936"}, {"introduction": "The performance of an algorithm is not just about its average runtime; understanding its structural behavior, such as how often it encounters \"worst-case\" scenarios, is also vital. This practice [@problem_id:3263955] explores the expected number of times a partition results in a highly unbalanced split. You will employ another essential tool for analyzing recursive algorithms—setting up and solving a recurrence relation for an expected value—to arrive at a surprisingly simple and elegant result.", "problem": "Consider the standard randomized quicksort on an array of $n$ distinct keys, where at each recursive call the pivot is selected uniformly at random from the current subarray, and a partition operation splits the subarray into elements less than the pivot and elements greater than the pivot. Assume that the partition procedure is invoked only on subarrays of size at least $2$, and that subarrays of size $0$ or $1$ constitute base cases for which no partition is performed.\n\nDefine a partition to be one in which one of the two resulting sides has size $0$; equivalently, the pivot chosen for that partition is either the minimum or the maximum element of the subarray being partitioned. Let $X_n$ denote the total number of such partitions during the complete execution of randomized quicksort on an input of size $n$.\n\nStarting only from the algorithmic definition above and fundamental rules of probability (such as conditioning and linearity of expectation), derive a closed-form expression for the expected value $\\mathbb{E}[X_n]$ as a function of $n$, for $n \\ge 2$. Your final answer must be a single analytic expression in $n$ with no unevaluated sums or recurrences.", "solution": "Let $X_n$ be the random variable representing the total number of partitions where the pivot is the minimum or maximum element in its subarray, during the execution of randomized quicksort on an array of $n$ distinct keys. We are asked to find the expected value of $X_n$, denoted by $E_n = \\mathbb{E}[X_n]$, for $n \\ge 2$.\n\nThe problem states that a partition operation is invoked only on subarrays of size at least $2$. This implies that for subarrays of size $0$ or $1$, the recursion terminates and no partitions are performed. Therefore, the corresponding expected values are $E_0 = \\mathbb{E}[X_0] = 0$ and $E_1 = \\mathbb{E}[X_1] = 0$.\n\nFor $n \\ge 2$, the algorithm selects a pivot uniformly at random from the $n$ elements. Let the rank of the chosen pivot be $k$, where $k \\in \\{1, 2, \\dots, n\\}$. The probability of any specific rank $k$ being chosen is $\\frac{1}{n}$.\n\nLet $I$ be an indicator random variable for the event that the first partition (on the array of size $n$) is one where the pivot is the minimum or maximum element. This occurs if the pivot has rank $k=1$ or $k=n$. The probability of this is $P(k=1) + P(k=n) = \\frac{1}{n} + \\frac{1}{n} = \\frac{2}{n}$ for $n \\ge 2$. So, $\\mathbb{E}[I] = \\frac{2}{n}$.\n\nWe can set up a recurrence for $E_n$ using the law of total expectation, conditioning on the rank $k$ of the first pivot. If the pivot has rank $k$, the array splits into subarrays of sizes $k-1$ and $n-k$. The total number of specified partitions is the sum of the contribution from the first partition and from the recursive calls.\n$$E_n = \\mathbb{E}[X_n] = \\sum_{k=1}^{n} \\mathbb{E}[X_n | \\text{pivot rank is } k] \\cdot P(\\text{pivot rank is } k)$$\n$$\\mathbb{E}[X_n | \\text{pivot rank is } k] = (\\delta_{k,1} + \\delta_{k,n}) + E_{k-1} + E_{n-k}$$\nwhere $\\delta_{i,j}$ is the Kronecker delta. Substituting this into the recurrence:\n$$E_n = \\frac{1}{n} \\sum_{k=1}^{n} \\left[ (\\delta_{k,1} + \\delta_{k,n}) + E_{k-1} + E_{n-k} \\right]$$\n$$E_n = \\frac{1}{n} \\left[ \\sum_{k=1}^{n}(\\delta_{k,1} + \\delta_{k,n}) + \\sum_{k=1}^{n}E_{k-1} + \\sum_{k=1}^{n}E_{n-k} \\right]$$\nThe first sum is $2$. The next two sums are identical: $\\sum_{k=1}^{n}E_{n-k} = \\sum_{j=0}^{n-1}E_j$.\n$$E_n = \\frac{1}{n} \\left[ 2 + 2\\sum_{j=0}^{n-1}E_j \\right]$$\nThis holds for $n \\ge 2$. To solve this recurrence, we first multiply by $n$:\n$$n E_n = 2 + 2\\sum_{j=0}^{n-1}E_j \\quad (*)$$\nThis also holds for $n-1$ (for $n \\ge 3$):\n$$(n-1)E_{n-1} = 2 + 2\\sum_{j=0}^{n-2}E_j \\quad (**)$$\nSubtracting $(**)$ from $(*)$ for $n \\ge 3$:\n$$n E_n - (n-1)E_{n-1} = \\left(2 + 2\\sum_{j=0}^{n-1}E_j\\right) - \\left(2 + 2\\sum_{j=0}^{n-2}E_j\\right) = 2E_{n-1}$$\n$$n E_n = (n-1)E_{n-1} + 2E_{n-1} = (n+1)E_{n-1}$$\nThis gives a simpler recurrence for $n \\ge 3$: $E_n = \\frac{n+1}{n} E_{n-1}$. We can solve this by unrolling it down to $E_2$:\n$$E_n = \\frac{n+1}{n}E_{n-1} = \\frac{n+1}{n} \\cdot \\frac{n}{n-1}E_{n-2} = \\dots = \\left(\\frac{n+1}{n} \\cdot \\frac{n}{n-1} \\cdots \\frac{4}{3}\\right)E_2 = \\frac{n+1}{3}E_2$$\nTo find $E_2$, we use the recurrence $(*)$ for $n=2$:\n$$2 E_2 = 2 + 2\\sum_{j=0}^{1}E_j = 2 + 2(E_0 + E_1) = 2 + 2(0+0) = 2 \\implies E_2 = 1$$\nThis is also correct by inspection: for an array of size $2$, the pivot must be the minimum or maximum, so exactly one partition occurs, and it is always of the specified type.\nSubstituting $E_2=1$ into our solution:\n$$E_n = \\frac{n+1}{3} \\quad \\text{for } n \\ge 3$$\nChecking the formula for $n=2$: $E_2 = \\frac{2+1}{3} = 1$, which is correct.\nTherefore, the expression holds for all $n \\ge 2$.", "answer": "$$\n\\boxed{\\frac{n+1}{3}}\n$$", "id": "3263955"}]}