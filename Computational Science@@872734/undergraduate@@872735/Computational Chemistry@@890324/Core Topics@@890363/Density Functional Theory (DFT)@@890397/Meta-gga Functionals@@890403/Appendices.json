{"hands_on_practices": [{"introduction": "This first exercise goes to the heart of *why* we develop more sophisticated functionals like meta-GGAs. It asks you to consider a seemingly simple case—a single electron—to uncover a fundamental flaw in many approximate density functionals. By working through this thought experiment [@problem_id:2457652], you will identify the crucial property a functional must have to be \"exact\" for one-electron systems, a concept known as the self-interaction-free condition.", "problem": "A student proposes a meta–Generalized Gradient Approximation (meta-GGA) exchange–correlation functional within Kohn–Sham Density Functional Theory (KS-DFT). They claim it is exact for all $1$-electron systems, in the sense that when applied to any external potential that binds exactly $1$ electron, it yields the exact ground-state energy and density within KS-DFT. Which single property must their functional satisfy for this claim to hold?\n\nA. It must be free of $1$-electron self-interaction, i.e., for any $1$-electron density the exchange–correlation contribution exactly cancels the classical self-Coulomb (Hartree) energy.\n\nB. It must reduce to the Local Density Approximation (LDA) in the uniform-electron-gas limit, i.e., for constant density it reproduces the uniform-gas exchange–correlation energy density.\n\nC. It must reproduce the second-order gradient expansion of the exchange–correlation energy for slowly varying densities.\n\nD. It must satisfy the Lieb–Oxford bound as an equality for all densities.\n\nE. It must be invariant under all unitary rotations of the occupied Kohn–Sham orbitals.", "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n-   **Context**: Kohn–Sham Density Functional Theory (KS-DFT).\n-   **Object**: A proposed meta–Generalized Gradient Approximation (meta-GGA) exchange–correlation functional.\n-   **Claim**: The functional is exact for all $1$-electron systems.\n-   **Definition of Exactness**: When applied to any external potential that binds exactly $1$ electron, the functional yields the exact ground-state energy and density within the KS-DFT framework.\n-   **Question**: What single property must the functional satisfy for this claim to be true?\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientific Grounding**: The problem is firmly rooted in the principles of quantum mechanics and density functional theory. The concepts of meta-GGA functionals, self-interaction error, and the treatment of $1$-electron systems are central and well-established topics in computational chemistry and physics.\n-   **Well-Posedness**: The question asks for a necessary condition for a well-defined property (exactness for all $1$-electron systems). The problem is structured to have a unique and meaningful answer based on the fundamental equations of KS-DFT.\n-   **Objectivity**: The problem is formulated using precise, technical language with no subjective or ambiguous terms.\n\n**Step 3: Verdict and Action**\nThe problem is scientifically sound, well-posed, and objective. It is **valid**. A solution will be derived.\n\n**Principle-Based Derivation**\n\nThe total energy of an $N$-electron system in Kohn–Sham Density Functional Theory (KS-DFT) is given by the functional:\n$$ E_{KS}[\\rho] = T_s[\\rho] + V_{ext}[\\rho] + J[\\rho] + E_{xc}[\\rho] $$\nwhere:\n-   $T_s[\\rho]$ is the kinetic energy of the non-interacting Kohn–Sham reference system.\n-   $V_{ext}[\\rho] = \\int v_{ext}(\\mathbf{r})\\rho(\\mathbf{r})d\\mathbf{r}$ is the energy of interaction with the external potential $v_{ext}(\\mathbf{r})$.\n-   $J[\\rho] = \\frac{1}{2} \\iint \\frac{\\rho(\\mathbf{r})\\rho(\\mathbf{r'})}{|\\mathbf{r}-\\mathbf{r'}|}d\\mathbf{r}d\\mathbf{r'}$ is the classical Coulomb repulsion energy of the electron density $\\rho(\\mathbf{r})$ with itself, also known as the Hartree energy.\n-   $E_{xc}[\\rho]$ is the exchange–correlation energy, which contains all the quantum mechanical effects not captured by the other terms.\n\nWe consider the specific case of a $1$-electron system. For such a system, the exact ground-state energy is obtained by solving the time-independent Schrödinger equation, $\\hat{H}\\Psi = E\\Psi$, where the Hamiltonian is $\\hat{H} = \\hat{T} + \\hat{V}_{ext}$. The electron does not interact with other electrons. Therefore, the exact energy is:\n$$ E_{exact} = \\langle \\Psi | \\hat{T} + \\hat{V}_{ext} | \\Psi \\rangle $$\nFor a $1$-electron system, the wavefunction $\\Psi$ is a single orbital, and the density is $\\rho = |\\Psi|^2$. The kinetic energy operator $\\hat{T}$ gives the exact kinetic energy $T[\\rho]$. Thus, the exact energy is:\n$$ E_{exact} = T[\\rho] + V_{ext}[\\rho] $$\n\nNow we apply the KS-DFT energy expression to this $1$-electron system.\n-   The number of electrons is $N=1$. The KS system consists of a single electron in a single occupied orbital, $\\psi_1$.\n-   The non-interacting kinetic energy $T_s[\\rho]$ is the kinetic energy of this one electron, which is precisely the exact kinetic energy of the system: $T_s[\\rho] = T[\\rho]$.\n-   The external potential term $V_{ext}[\\rho]$ is identical in both formalisms.\n-   The Hartree term $J[\\rho]$ represents the classical electrostatic repulsion of the electron's charge cloud with itself. This is an unphysical artifact for a single particle, which cannot interact with itself. This term is known as the self-interaction energy.\n-   The exchange-correlation energy $E_{xc}[\\rho]$ must, among other things, correct for the errors introduced by the approximate nature of the KS framework.\n\nFor the student's claim to be true, the KS-DFT calculation must yield the exact ground-state energy for any $1$-electron system. This means $E_{KS}[\\rho]$ must equal $E_{exact}$ when evaluated on the exact $1$-electron density $\\rho$.\n$$ T_s[\\rho] + V_{ext}[\\rho] + J[\\rho] + E_{xc}[\\rho] = T_s[\\rho] + V_{ext}[\\rho] $$\nThis equation simplifies to the fundamental condition:\n$$ J[\\rho] + E_{xc}[\\rho] = 0 \\quad \\text{or} \\quad E_{xc}[\\rho] = -J[\\rho] $$\nThis condition must hold for any density $\\rho$ corresponding to a $1$-electron ground state. It states that the exchange–correlation functional must exactly cancel the spurious Hartree self-interaction energy for any $1$-electron system. This is the definition of being free from $1$-electron self-interaction.\n\nFurthermore, if this condition is met, the KS-DFT calculation will also yield the exact density. The effective potential in the KS equation is $v_{s}(\\mathbf{r}) = v_{ext}(\\mathbf{r}) + v_{H}(\\mathbf{r}) + v_{xc}(\\mathbf{r})$, where $v_H(\\mathbf{r}) = \\frac{\\delta J}{\\delta \\rho}$ and $v_{xc}(\\mathbf{r}) = \\frac{\\delta E_{xc}}{\\delta \\rho}$. If $E_{xc}[\\rho] = -J[\\rho]$, then $v_{xc}(\\mathbf{r}) = -v_{H}(\\mathbf{r})$. The effective potential becomes $v_s(\\mathbf{r}) = v_{ext}(\\mathbf{r})$. The KS equation for the single orbital $\\psi_1$ then reduces to:\n$$ \\left( -\\frac{1}{2}\\nabla^2 + v_{ext}(\\mathbf{r}) \\right) \\psi_1(\\mathbf{r}) = \\epsilon_1 \\psi_1(\\mathbf{r}) $$\nThis is identical to the Schrödinger equation for the $1$-electron system. Thus, solving the KS equations yields the exact orbital $\\psi_1$, and therefore the exact density $\\rho = |\\psi_1|^2$ and exact energy $E = \\epsilon_1$.\n\nThus, the necessary and sufficient condition for a functional to be exact for all $1$-electron systems is that it is free of $1$-electron self-interaction.\n\n**Option-by-Option Analysis**\n\n**A. It must be free of $1$-electron self-interaction, i.e., for any $1$-electron density the exchange–correlation contribution exactly cancels the classical self-Coulomb (Hartree) energy.**\nThis statement is a precise description of the condition $E_{xc}[\\rho] + J[\\rho] = 0$ derived above. As demonstrated, this is the exact requirement for a DFT functional to be exact for any $1$-electron system.\nVerdict: **Correct**.\n\n**B. It must reduce to the Local Density Approximation (LDA) in the uniform-electron-gas limit, i.e., for constant density it reproduces the uniform-gas exchange–correlation energy density.**\nThis is a boundary condition often imposed on functionals to ensure they behave correctly for metallic systems. However, a $1$-electron system is characterized by a localized, rapidly varying density, which is the antithesis of the uniform electron gas. This condition is not relevant for ensuring exactness in the $1$-electron case. For instance, Hartree-Fock theory is exact for $1$-electron systems (i.e., it is self-interaction free), but it provides a poor description of the uniform electron gas (it lacks correlation entirely).\nVerdict: **Incorrect**.\n\n**C. It must reproduce the second-order gradient expansion of the exchange–correlation energy for slowly varying densities.**\nThis condition aims to improve upon the LDA for systems where the density varies slowly, forming the basis for Generalized Gradient Approximations (GGAs). The density of a bound $1$-electron system (like the Hydrogen atom) is not slowly varying, especially near the nucleus. While this is a useful constraint for general-purpose functionals, it does not guarantee the cancellation of self-interaction energy. Many GGAs that satisfy this to some degree still suffer from significant self-interaction error.\nVerdict: **Incorrect**.\n\n**D. It must satisfy the Lieb–Oxford bound as an equality for all densities.**\nThe Lieb-Oxford bound is a rigorous lower limit on the magnitude of the exchange-correlation energy, $E_{xc}[\\rho] \\ge -C \\int \\rho^{4/3} d\\mathbf{r}$. Turning this bound into an equality for *all* densities is an extremely strong and generally incorrect constraint. The required condition is $E_{xc}[\\rho] = -J[\\rho]$. In general, $J[\\rho] \\neq C \\int \\rho^{4/3} d\\mathbf{r}$ for an arbitrary $1$-electron density. Therefore, this condition is not equivalent to being self-interaction free.\nVerdict: **Incorrect**.\n\n**E. It must be invariant under all unitary rotations of the occupied Kohn–Sham orbitals.**\nFor a functional to be a valid functional of the density (or density matrix), it must be invariant to a unitary transformation of the occupied orbitals, as this does not change the total density. This is a fundamental consistency requirement for most functionals (LDA, GGA, meta-GGA). However, for a $1$-electron system, there is only one occupied orbital, so any \"rotation\" is simply a multiplication by a phase factor, which leaves the density, its gradient, and the kinetic energy density unchanged. Thus, any standard meta-GGA trivially satisfies this for a $1$-electron system. This general property does not, however, imply absence of self-interaction error. Standard LDA and GGA functionals are unitarily invariant but are not exact for $1$-electron systems because they are not self-interaction free.\nVerdict: **Incorrect**.", "answer": "$$\\boxed{A}$$", "id": "2457652"}, {"introduction": "Having established the goal of correcting self-interaction, we now dive into the mechanics of a meta-GGA functional. This practice problem [@problem_id:2457672] demystifies the complex equations by having you perform a calculation for a single point in space. You will see firsthand how the local electron density ($n$), its gradient ($|\\nabla n|$), and the kinetic energy density ($\\tau$) are transformed into the dimensionless ingredients that allow a meta-GGA to recognize different chemical environments.", "problem": "Consider a single real-space integration point $\\mathbf{r}$ on a numerical quadrature grid for a closed-shell Neon atom treated within Kohn–Sham Density Functional Theory (DFT) using a meta-Generalized Gradient Approximation (meta-GGA) exchange functional. Assume a spin-unpolarized density at this point so that the spin-up and spin-down densities are equal. Work entirely in atomic units (Hartree for energy and Bohr for length), and treat the following as given at $\\mathbf{r}$:\n- Electron density $n(\\mathbf{r}) = 0.200$,\n- Density gradient magnitude $|\\nabla n(\\mathbf{r})| = 0.350$,\n- Kohn–Sham orbital kinetic energy density $\\tau(\\mathbf{r}) = 0.150$.\n\nStarting from first principles of the uniform electron gas and standard meta-GGA ingredients, proceed through the following definitions to obtain the meta-GGA exchange energy density $e_{x}^{\\text{meta}}(\\mathbf{r})$:\n1. The Fermi wavevector $k_{F}(\\mathbf{r})$ of the uniform electron gas at density $n(\\mathbf{r})$ is $k_{F}(\\mathbf{r}) = \\big(3\\pi^{2} n(\\mathbf{r})\\big)^{1/3}$.\n2. The reduced density gradient $s(\\mathbf{r})$ is $s(\\mathbf{r}) = \\dfrac{\\lvert \\nabla n(\\mathbf{r}) \\rvert}{2 k_{F}(\\mathbf{r})\\, n(\\mathbf{r})}$.\n3. The von Weizsäcker kinetic energy density is $\\tau_{W}(\\mathbf{r}) = \\dfrac{\\lvert \\nabla n(\\mathbf{r}) \\rvert^{2}}{8\\, n(\\mathbf{r})}$.\n4. The uniform-gas kinetic energy density is $\\tau_{\\text{unif}}(\\mathbf{r}) = \\dfrac{3}{10}\\big(3\\pi^{2}\\big)^{2/3} n(\\mathbf{r})^{5/3}$.\n5. The iso-orbital indicator is $\\alpha(\\mathbf{r}) = \\dfrac{\\tau(\\mathbf{r}) - \\tau_{W}(\\mathbf{r})}{\\tau_{\\text{unif}}(\\mathbf{r})}$.\n6. The Local Density Approximation (LDA) exchange energy density is $e_{x}^{\\text{LDA}}(\\mathbf{r}) = - C_{x}\\, n(\\mathbf{r})^{4/3}$, where $C_{x} = \\dfrac{3}{4}\\big(\\dfrac{3}{\\pi}\\big)^{1/3}$.\n7. The meta-GGA exchange enhancement factor is defined (for this problem) by\n$$\nF_{x}(s(\\mathbf{r}), \\alpha(\\mathbf{r})) \\;=\\; 1 + \\kappa \\;-\\; \\dfrac{\\kappa}{1 + \\mu\\, s(\\mathbf{r})^{2} + \\beta\\, \\alpha(\\mathbf{r})},\n$$\nwith constants $\\kappa = 0.804$, $\\mu = 0.21951$, and $\\beta = 0.100$.\n8. The meta-GGA exchange energy density is $e_{x}^{\\text{meta}}(\\mathbf{r}) = e_{x}^{\\text{LDA}}(\\mathbf{r}) \\, F_{x}(s(\\mathbf{r}), \\alpha(\\mathbf{r}))$.\n\nCompute $e_{x}^{\\text{meta}}(\\mathbf{r})$ numerically using the values provided. Express your final answer as a single number in Hartree per Bohr$^{3}$, rounded to four significant figures.", "solution": "The problem statement is validated as self-contained, scientifically grounded in the principles of Kohn-Sham Density Functional Theory, and numerically well-posed. All required constants, variables, and functional forms are explicitly provided, allowing for a direct, unambiguous calculation. A unique solution exists and will be derived by methodically applying the given definitions.\n\nWe are provided with the following local quantities at a point $\\mathbf{r}$ in atomic units:\n- Electron density: $n(\\mathbf{r}) = 0.200$\n- Magnitude of the density gradient: $\\lvert \\nabla n(\\mathbf{r}) \\rvert = 0.350$\n- Kohn-Sham orbital kinetic energy density: $\\tau(\\mathbf{r}) = 0.150$\n\nThe calculation proceeds sequentially through the defined steps.\n\n1.  Compute the Fermi wavevector, $k_{F}(\\mathbf{r})$.\n    The formula for the Fermi wavevector of a uniform electron gas is given as $k_{F}(\\mathbf{r}) = \\big(3\\pi^{2} n(\\mathbf{r})\\big)^{1/3}$.\n    Substituting the given electron density $n(\\mathbf{r}) = 0.200$:\n    $$k_{F}(\\mathbf{r}) = \\big(3\\pi^{2} \\times 0.200\\big)^{1/3} = (0.6\\pi^{2})^{1/3} \\approx 1.80918$$\n\n2.  Compute the reduced density gradient, $s(\\mathbf{r})$.\n    The definition provided is $s(\\mathbf{r}) = \\dfrac{\\lvert \\nabla n(\\mathbf{r}) \\rvert}{2 k_{F}(\\mathbf{r})\\, n(\\mathbf{r})}$.\n    Using the given values and the computed $k_{F}(\\mathbf{r})$:\n    $$s(\\mathbf{r}) = \\dfrac{0.350}{2 \\times 1.80918 \\times 0.200} \\approx \\dfrac{0.350}{0.723672} \\approx 0.48364$$\n\n3.  Compute the von Weizsäcker kinetic energy density, $\\tau_{W}(\\mathbf{r})$.\n    This is defined as $\\tau_{W}(\\mathbf{r}) = \\dfrac{\\lvert \\nabla n(\\mathbf{r}) \\rvert^{2}}{8\\, n(\\mathbf{r})}$.\n    Substituting the given values:\n    $$\\tau_{W}(\\mathbf{r}) = \\dfrac{(0.350)^{2}}{8 \\times 0.200} = \\dfrac{0.1225}{1.6} = 0.0765625$$\n\n4.  Compute the uniform-gas kinetic energy density, $\\tau_{\\text{unif}}(\\mathbf{r})$.\n    The formula is $\\tau_{\\text{unif}}(\\mathbf{r}) = \\dfrac{3}{10}\\big(3\\pi^{2}\\big)^{2/3} n(\\mathbf{r})^{5/3}$.\n    Substituting $n(\\mathbf{r}) = 0.200$:\n    $$\\tau_{\\text{unif}}(\\mathbf{r}) = \\dfrac{3}{10}\\big(3\\pi^{2}\\big)^{2/3} (0.200)^{5/3} \\approx 0.3 \\times 9.58231 \\times 0.068399 \\approx 0.196388$$\n\n5.  Compute the iso-orbital indicator, $\\alpha(\\mathbf{r})$.\n    The definition is $\\alpha(\\mathbf{r}) = \\dfrac{\\tau(\\mathbf{r}) - \\tau_{W}(\\mathbf{r})}{\\tau_{\\text{unif}}(\\mathbf{r})}$.\n    Using the given $\\tau(\\mathbf{r})$ and the computed $\\tau_{W}(\\mathbf{r})$ and $\\tau_{\\text{unif}}(\\mathbf{r})$:\n    $$\\alpha(\\mathbf{r}) = \\dfrac{0.150 - 0.0765625}{0.196388} = \\dfrac{0.0734375}{0.196388} \\approx 0.37394$$\n\n6.  Compute the Local Density Approximation (LDA) exchange energy density, $e_{x}^{\\text{LDA}}(\\mathbf{r})$.\n    This is given by $e_{x}^{\\text{LDA}}(\\mathbf{r}) = - C_{x}\\, n(\\mathbf{r})^{4/3}$, with the constant $C_{x} = \\dfrac{3}{4}\\big(\\dfrac{3}{\\pi}\\big)^{1/3}$.\n    First, we evaluate $C_x$:\n    $$C_{x} = \\dfrac{3}{4}\\big(\\dfrac{3}{\\pi}\\big)^{1/3} \\approx 0.75 \\times (0.95493)^{1/3} \\approx 0.75 \\times 0.984745 \\approx 0.73856$$\n    Now, we compute $e_{x}^{\\text{LDA}}(\\mathbf{r})$:\n    $$e_{x}^{\\text{LDA}}(\\mathbf{r}) = - (0.73856) \\times (0.200)^{4/3} \\approx -0.73856 \\times 0.11696 \\approx -0.086383$$\n\n7.  Compute the meta-GGA exchange enhancement factor, $F_{x}(s(\\mathbf{r}), \\alpha(\\mathbf{r}))$.\n    The problem specifies the form $F_{x} = 1 + \\kappa - \\dfrac{\\kappa}{1 + \\mu\\, s(\\mathbf{r})^{2} + \\beta\\, \\alpha(\\mathbf{r})}$, with constants $\\kappa = 0.804$, $\\mu = 0.21951$, and $\\beta = 0.100$.\n    We substitute the computed values of $s(\\mathbf{r})$ and $\\alpha(\\mathbf{r})$:\n    $$F_{x} = 1 + 0.804 - \\dfrac{0.804}{1 + (0.21951)(0.48364)^{2} + (0.100)(0.37394)}$$\n    $$F_{x} = 1.804 - \\dfrac{0.804}{1 + (0.21951)(0.233908) + 0.037394}$$\n    $$F_{x} = 1.804 - \\dfrac{0.804}{1 + 0.051346 + 0.037394} = 1.804 - \\dfrac{0.804}{1.08874} \\approx 1.804 - 0.73847 \\approx 1.06553$$\n\n8.  Compute the final meta-GGA exchange energy density, $e_{x}^{\\text{meta}}(\\mathbf{r})$.\n    This is the product of the LDA energy density and the enhancement factor: $e_{x}^{\\text{meta}}(\\mathbf{r}) = e_{x}^{\\text{LDA}}(\\mathbf{r}) \\, F_{x}(s(\\mathbf{r}), \\alpha(\\mathbf{r}))$.\n    $$e_{x}^{\\text{meta}}(\\mathbf{r}) \\approx -0.086383 \\times 1.06553 \\approx -0.092036$$\n\nThe problem requires the final answer to be rounded to four significant figures.\nThe calculated value is $-0.092036$. Rounding this to four significant figures yields $-0.09204$.", "answer": "$$\\boxed{-0.09204}$$", "id": "2457672"}, {"introduction": "Building on the point-wise calculation, this final practice extends the analysis to an entire region of space, revealing how a meta-GGA's behavior changes in different chemical contexts. This problem [@problem_id:2457711] introduces a \"switching function,\" a key component of modern meta-GGAs like TPSS, which uses the iso-orbital indicator $\\alpha$ to interpolate between different physical limits. By analyzing the activity of this function in model systems representing uniform matter, isolated atoms, and a chemical bond, you will gain a deeper intuition for how these advanced functionals achieve their accuracy.", "problem": "You are asked to study, in a controlled and fully specified setting, the role of the switching function in the Tao–Perdew–Staroverov–Scuseria (TPSS) meta-generalized gradient approximation by quantifying where it is most active for model systems constructed from normalized Gaussian orbitals. All computations are to be carried out in Hartree atomic units.\n\nA spin-unpolarized, closed-shell Kohn–Sham system with spatial orbitals $\\{\\phi_n(\\mathbf{r})\\}$ has electron density $\\rho(\\mathbf{r}) = 2 \\sum_n |\\phi_n(\\mathbf{r})|^2$ and positive kinetic energy density $\\tau(\\mathbf{r}) = \\sum_n |\\nabla \\phi_n(\\mathbf{r})|^2$. The von Weizsäcker kinetic energy density is $\\tau_{\\mathrm{W}}(\\mathbf{r}) = \\dfrac{|\\nabla \\rho(\\mathbf{r})|^2}{8\\,\\rho(\\mathbf{r})}$ for $\\rho(\\mathbf{r})>0$, and the uniform electron gas kinetic energy density is $\\tau_{\\mathrm{unif}}(\\mathbf{r}) = \\dfrac{3}{10}\\left(3\\pi^2\\right)^{2/3}\\rho(\\mathbf{r})^{5/3}$. The iso-orbital indicator is\n$$\n\\alpha(\\mathbf{r}) = \\frac{\\tau(\\mathbf{r}) - \\tau_{\\mathrm{W}}(\\mathbf{r})}{\\tau_{\\mathrm{unif}}(\\mathbf{r})},\n$$\nwith the convention that $\\alpha(\\mathbf{r})=0$ when $\\rho(\\mathbf{r})=0$.\n\nConsider the idealized TPSS-like switching function (a smooth interpolator between the one-orbital and slowly varying limits)\n$$\nw(\\alpha) = \\frac{\\alpha^2}{1+\\alpha^2},\n$$\nwith derivative\n$$\nw'(\\alpha) = \\frac{2\\alpha}{\\left(1+\\alpha^2\\right)^2}.\n$$\nLet $w'_{\\max}$ denote the global maximum of $w'(\\alpha)$ for $\\alpha\\ge 0$. Define the local activity indicator\n$$\nA(\\mathbf{r}) =\n\\begin{cases}\n1, & \\text{if } \\rho(\\mathbf{r}) \\ge \\rho_{\\mathrm{cut}} \\text{ and } w'(\\alpha(\\mathbf{r})) \\ge \\frac{1}{2}w'_{\\max},\\\\\n0, & \\text{otherwise,}\n\\end{cases}\n$$\nwhere $\\rho_{\\mathrm{cut}} = 10^{-8}$ in bohr$^{-3}$. The active fraction $F$ for a system is the ratio of the number of grid points with $A(\\mathbf{r})=1$ to the number of grid points with $\\rho(\\mathbf{r}) \\ge \\rho_{\\mathrm{cut}}$.\n\nAll spatial fields must be evaluated on a uniform Cartesian grid spanning the cube $[-L,L]^3$ with $L=6$ in bohr, using $N=33$ equispaced points per axis.\n\nYou will evaluate $F$ for the following three test cases (the test suite), each specified entirely by first-principles constructs:\n\n1. Uniform electron gas in a box. The density is constant, $\\rho(\\mathbf{r})=\\rho_0$ with $\\rho_0=0.05$ in bohr$^{-3}$, so that $\\nabla \\rho(\\mathbf{r})=\\mathbf{0}$, $\\tau(\\mathbf{r})=\\tau_{\\mathrm{unif}}(\\mathbf{r})$, and $\\tau_{\\mathrm{W}}(\\mathbf{r})=0$ at all points.\n\n2. One-orbital atom-like system. A single normalized $s$-type Gaussian spatial orbital at the origin, doubly occupied,\n$$\n\\phi(\\mathbf{r}) = \\mathcal{N}\\, e^{-a|\\mathbf{r}|^2}, \\quad \\mathcal{N} = \\left(\\frac{2a}{\\pi}\\right)^{3/4}, \\quad a=0.5 \\text{ in bohr}^{-2}.\n$$\n\n3. Two-center diatomic-like system. Two normalized $s$-type Gaussian functions with the same exponent $a=0.5$ in bohr$^{-2}$, centered at $\\mathbf{R}_A=(0,0,-R/2)$ and $\\mathbf{R}_B=(0,0,R/2)$,\n$$\ng_A(\\mathbf{r})=\\mathcal{N}\\,e^{-a|\\mathbf{r}-\\mathbf{R}_A|^2}, \\quad g_B(\\mathbf{r})=\\mathcal{N}\\,e^{-a|\\mathbf{r}-\\mathbf{R}_B|^2},\n$$\nwith overlap $S=\\exp\\left(-\\frac{aR^2}{2}\\right)$. Construct the orthonormal bonding and antibonding orbitals\n$$\n\\phi_b(\\mathbf{r}) = \\frac{g_A(\\mathbf{r})+g_B(\\mathbf{r})}{\\sqrt{2(1+S)}}, \\quad\n\\phi_a(\\mathbf{r}) = \\frac{g_A(\\mathbf{r})-g_B(\\mathbf{r})}{\\sqrt{2(1-S)}},\n$$\neach doubly occupied. For the candidate separations $R \\in \\{0.5,\\,1.5,\\,3.0,\\,5.0\\}$ in bohr, compute the active fraction $F(R)$ for each and report the value $R^\\star$ that maximizes $F(R)$; if multiple $R$ attain the same maximal $F$, report the smallest such $R$.\n\nAngle units are not applicable. All lengths must be treated in bohr, and all densities in bohr$^{-3}$.\n\nYour program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[F_{\\mathrm{UEG}}, F_{\\mathrm{1G}}, R^\\star]$, where $F_{\\mathrm{UEG}}$ is the active fraction for case $1$, $F_{\\mathrm{1G}}$ is the active fraction for case $2$, and $R^\\star$ is in bohr for case $3$. Express all three outputs as floats rounded to three decimal places, with no units printed. For example, a valid output format is like $[0.123,0.000,1.500]$.", "solution": "The problem presented is a well-posed and scientifically grounded exercise in computational quantum chemistry, specifically concerning the behavior of meta-Generalized Gradient Approximation (meta-GGA) density functionals. The task is to analyze an idealized switching function, characteristic of the Tao-Perdew-Staroverov-Scuseria (TPSS) functional, for several model electronic systems. All specified quantities are standard within Density Functional Theory (DFT), and the models—uniform electron gas, a single Gaussian orbital, and a diatomic system constructed from Gaussian orbitals—are canonical examples used to understand the behavior of such functionals. The problem statement is complete, consistent, and requires a direct numerical implementation of established physical and mathematical formulas. Therefore, the problem is valid, and a solution will be furnished.\n\nThe core of the problem lies in the iso-orbital indicator, $\\alpha(\\mathbf{r})$, which distinguishes different bonding environments. It is defined as:\n$$\n\\alpha(\\mathbf{r}) = \\frac{\\tau(\\mathbf{r}) - \\tau_{\\mathrm{W}}(\\mathbf{r})}{\\tau_{\\mathrm{unif}}(\\mathbf{r})}\n$$\nwhere $\\tau$ is the positive kinetic energy density, $\\tau_{\\mathrm{W}} = \\frac{|\\nabla \\rho|^2}{8\\rho}$ is the von Weizsäcker kinetic energy density, and $\\tau_{\\mathrm{unif}} = \\frac{3}{10}(3\\pi^2)^{2/3}\\rho^{5/3}$ is the kinetic energy density of a uniform electron gas (UEG) of density $\\rho$. By design, $\\alpha=0$ for any single-orbital region and $\\alpha=1$ for the UEG.\n\nThe problem investigates the local activity of a TPSS-like switching function, $w(\\alpha) = \\frac{\\alpha^2}{1+\\alpha^2}$. The activity is tied to the magnitude of its derivative, $w'(\\alpha) = \\frac{2\\alpha}{(1+\\alpha^2)^2}$. We must first find the maximum value of $w'(\\alpha)$ for $\\alpha \\ge 0$. We set the derivative of $w'(\\alpha)$ with respect to $\\alpha$ to zero:\n$$\n\\frac{d w'(\\alpha)}{d\\alpha} = \\frac{d}{d\\alpha} \\left( \\frac{2\\alpha}{(1+\\alpha^2)^2} \\right) = \\frac{2(1+\\alpha^2)^2 - 2\\alpha \\cdot 2(1+\\alpha^2)(2\\alpha)}{(1+\\alpha^2)^4} = 0\n$$\n$$\n2(1+\\alpha^2) - 8\\alpha^2 = 0 \\implies 2 - 6\\alpha^2 = 0 \\implies \\alpha^2 = \\frac{1}{3}\n$$\nSince $\\alpha \\ge 0$, the maximum occurs at $\\alpha = 1/\\sqrt{3}$. The maximum value is:\n$$\nw'_{\\max} = w'(1/\\sqrt{3}) = \\frac{2(1/\\sqrt{3})}{(1 + 1/3)^2} = \\frac{2/\\sqrt{3}}{(16/9)} = \\frac{2}{\\sqrt{3}}\\frac{9}{16} = \\frac{9}{8\\sqrt{3}} = \\frac{3\\sqrt{3}}{8}\n$$\nThe local activity indicator, $A(\\mathbf{r})$, is $1$ if $\\rho(\\mathbf{r}) \\ge \\rho_{\\mathrm{cut}} = 10^{-8}$ and $w'(\\alpha(\\mathbf{r})) \\ge \\frac{1}{2}w'_{\\max}$. The active fraction, $F$, is the ratio of the number of grid points where $A(\\mathbf{r})=1$ to the total number of points where $\\rho(\\mathbf{r}) \\ge \\rho_{\\mathrm{cut}}$.\n\nWe now analyze the three specified cases.\n\n**Case 1: Uniform Electron Gas (UEG)**\nFor the UEG, the density is constant, $\\rho(\\mathbf{r}) = \\rho_0 = 0.05$. Thus, its gradient is zero, $\\nabla \\rho(\\mathbf{r}) = \\mathbf{0}$. This immediately implies that $\\tau_{\\mathrm{W}}(\\mathbf{r})=0$. The problem states that for this system, $\\tau(\\mathbf{r}) = \\tau_{\\mathrm{unif}}(\\mathbf{r})$. Substituting these into the definition of $\\alpha$:\n$$\n\\alpha(\\mathbf{r}) = \\frac{\\tau_{\\mathrm{unif}}(\\mathbf{r}) - 0}{\\tau_{\\mathrm{unif}}(\\mathbf{r})} = 1\n$$\nThe value of the derivative at $\\alpha=1$ is $w'(1) = \\frac{2(1)}{(1+1^2)^2} = \\frac{2}{4} = \\frac{1}{2}$. The activity condition is $w'(1) \\ge \\frac{1}{2}w'_{\\max}$, which is $\\frac{1}{2} \\ge \\frac{1}{2}\\frac{3\\sqrt{3}}{8}$, or $1 \\ge \\frac{3\\sqrt{3}}{8}$. Since $8^2 = 64$ and $(3\\sqrt{3})^2 = 27$, this inequality holds. The density is constant at $0.05$, which is much greater than $\\rho_{\\mathrm{cut}}$. Therefore, $A(\\mathbf{r})=1$ at every grid point. The number of active points equals the total number of points satisfying the density cutoff, yielding an active fraction $F_{\\mathrm{UEG}}=1$.\n\n**Case 2: One-Orbital Atom-like System**\nThe system consists of a single, doubly occupied, real spatial orbital $\\phi(\\mathbf{r})$. The density is $\\rho(\\mathbf{r}) = 2\\phi(\\mathbf{r})^2$. The gradient of the density is $\\nabla\\rho = 4\\phi(\\nabla\\phi)$. The kinetic energy density, as defined in the problem for a single spatial orbital, is $\\tau(\\mathbf{r}) = |\\nabla\\phi(\\mathbf{r})|^2$. The von Weizsäcker kinetic energy density is:\n$$\n\\tau_{\\mathrm{W}}(\\mathbf{r}) = \\frac{|\\nabla\\rho|^2}{8\\rho} = \\frac{|4\\phi(\\nabla\\phi)|^2}{8(2\\phi^2)} = \\frac{16\\phi^2|\\nabla\\phi|^2}{16\\phi^2} = |\\nabla\\phi|^2 = \\tau(\\mathbf{r})\n$$\nSince $\\tau(\\mathbf{r}) = \\tau_{\\mathrm{W}}(\\mathbf{r})$ everywhere that $\\rho(\\mathbf{r})>0$, the numerator of $\\alpha$ is identically zero. Thus, $\\alpha(\\mathbf{r}) = 0$ for all $\\mathbf{r}$.\nAt $\\alpha=0$, the derivative of the switching function is $w'(0)=0$. The activity condition is $0 \\ge \\frac{1}{2}w'_{\\max}$, which is false as $w'_{\\max}>0$. Hence, $A(\\mathbf{r})=0$ everywhere. The number of active points is zero, and the active fraction is $F_{\\mathrm{1G}}=0$.\n\n**Case 3: Two-Center Diatomic-like System**\nThis system consists of two doubly occupied orthonormal orbitals, a bonding orbital $\\phi_b$ and an antibonding orbital $\\phi_a$, constructed from Gaussian basis functions $g_A$ and $g_B$.\n$$\n\\phi_b(\\mathbf{r}) = \\frac{g_A(\\mathbf{r})+g_B(\\mathbf{r})}{\\sqrt{2(1+S)}}, \\quad \\phi_a(\\mathbf{r}) = \\frac{g_A(\\mathbf{r})-g_B(\\mathbf{r})}{\\sqrt{2(1-S)}}\n$$\nThe total density and kinetic energy density for this four-electron system, according to the problem definitions, are:\n$$\n\\rho(\\mathbf{r}) = 2|\\phi_b(\\mathbf{r})|^2 + 2|\\phi_a(\\mathbf{r})|^2\n$$\n$$\n\\tau(\\mathbf{r}) = |\\nabla\\phi_b(\\mathbf{r})|^2 + |\\nabla\\phi_a(\\mathbf{r})|^2\n$$\nThe calculation of the active fraction $F(R)$ must be performed numerically for each specified internuclear distance $R$. The procedure is as follows:\n1.  Define a uniform Cartesian grid over $[-6,6]^3$ bohr with $33$ points per axis.\n2.  For each value of $R \\in \\{0.5, 1.5, 3.0, 5.0\\}$, perform the following steps.\n3.  For each point $\\mathbf{r}$ on the grid, calculate the values of the basis functions $g_{A,B}(\\mathbf{r})$ and their gradients $\\nabla g_{A,B}(\\mathbf{r})$.\n4.  From these, construct the orbitals $\\phi_{b,a}(\\mathbf{r})$ and their gradients $\\nabla \\phi_{b,a}(\\mathbf{r})$.\n5.  Compute the total density $\\rho(\\mathbf{r})$, its gradient $\\nabla\\rho(\\mathbf{r})$, and the kinetic energy density $\\tau(\\mathbf{r})$.\n6.  Calculate $\\tau_{\\mathrm{W}}(\\mathbf{r})$, $\\tau_{\\mathrm{unif}}(\\mathbf{r})$, and finally the iso-orbital indicator $\\alpha(\\mathbf{r})$. Special care is taken for regions where $\\rho(\\mathbf{r}) \\to 0$, setting the result of indeterminate forms like $0/0$ to $0$.\n7.  Evaluate the activity condition $w'(\\alpha(\\mathbf{r})) \\ge \\frac{1}{2}w'_{\\max}$ for all points where $\\rho(\\mathbf{r}) \\ge \\rho_{\\mathrm{cut}}$.\n8.  Compute the active fraction $F(R)$ as the ratio of points satisfying the condition to the total number of points above the density cutoff.\n9.  After computing $F(R)$ for all candidate $R$, identify $R^\\star$ as the value of $R$ that maximizes $F(R)$. In case of a tie, the smallest $R$ is chosen.\n\nThis numerical calculation will yield the final required value, $R^\\star$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the computational chemistry problem as specified.\n    1. Calculates F_UEG analytically.\n    2. Calculates F_1G analytically.\n    3. Numerically calculates F(R) for the diatomic system for several R\n       and finds R* that maximizes F(R).\n    \"\"\"\n\n    # --- Case 1: Uniform Electron Gas ---\n    # As derived in the solution, alpha = 1 for the UEG.\n    # w'(1) = 2/(1+1)^2 = 0.5.\n    # w'_max = 3*sqrt(3)/8.\n    # The condition is 0.5 >= 0.5 * (3*sqrt(3)/8), which is true.\n    # Since rho > rho_cut everywhere, all points are active.\n    f_ueg = 1.0\n\n    # --- Case 2: One-Orbital Atom-like System ---\n    # As derived in the solution, alpha = 0 for any one-orbital system.\n    # w'(0) = 0. The activity condition is 0 >= 0.5 * w'_max, which is false.\n    # No points are active.\n    f_1g = 0.0\n\n    # --- Case 3: Two-center Diatomic-like System ---\n    # Numerical calculation is required.\n\n    # Grid and constant setup\n    L = 6.0\n    N = 33\n    a = 0.5\n    rho_cut = 1.0e-8\n    candidate_R = [0.5, 1.5, 3.0, 5.0]\n\n    # Pre-calculate grid coordinates\n    points = np.linspace(-L, L, N, dtype=np.float64)\n    xx, yy, zz = np.meshgrid(points, points, points, indexing='ij')\n    grid = np.stack((xx, yy, zz), axis=-1)\n\n    # Pre-calculate constants for w'\n    w_prime_max = 3 * np.sqrt(3) / 8\n    activity_threshold = 0.5 * w_prime_max\n    \n    # Constant for tau_unif\n    tau_unif_const = (3.0 / 10.0) * (3.0 * np.pi**2)**(2.0 / 3.0)\n\n    # Gaussian normalization constant\n    norm_gauss = (2 * a / np.pi)**(3.0 / 4.0)\n\n    f_values = []\n    \n    for R in candidate_R:\n        # Define atom centers\n        R_A = np.array([0.0, 0.0, -R / 2.0])\n        R_B = np.array([0.0, 0.0, R / 2.0])\n\n        # Overlap and normalization for orbitals\n        if R == 0.0:\n            S = 1.0\n        else:\n            S = np.exp(-a * R**2 / 2.0)\n        \n        # Avoid division by zero if R is very large and 1-S is close to 0, though not an issue for given R\n        C_b = np.sqrt(2.0 * (1.0 + S))\n        C_a = np.sqrt(2.0 * (1.0 - S)) if (1.0-S) > 1e-12 else 1e-6 # Avoid instability at small R\n\n        # Calculate Gaussian basis functions and their gradients\n        r_minus_RA = grid - R_A\n        r_minus_RB = grid - R_B\n        r_A_sq = np.sum(r_minus_RA**2, axis=-1)\n        r_B_sq = np.sum(r_minus_RB**2, axis=-1)\n\n        g_A = norm_gauss * np.exp(-a * r_A_sq)\n        g_B = norm_gauss * np.exp(-a * r_B_sq)\n        \n        # Using [..., np.newaxis] to facilitate broadcasting\n        grad_g_A = -2.0 * a * r_minus_RA * g_A[..., np.newaxis]\n        grad_g_B = -2.0 * a * r_minus_RB * g_B[..., np.newaxis]\n\n        # Construct orthonormal orbitals and their gradients\n        phi_b = (g_A + g_B) / C_b\n        phi_a = (g_A - g_B) / C_a\n        grad_phi_b = (grad_g_A + grad_g_B) / C_b\n        grad_phi_a = (grad_g_A - grad_g_B) / C_a\n\n        # Calculate total density and kinetic energy density\n        rho = 2.0 * (phi_b**2 + phi_a**2)\n        tau = np.sum(grad_phi_b**2, axis=-1) + np.sum(grad_phi_a**2, axis=-1)\n\n        # Calculate quantities for alpha\n        grad_rho = 4.0 * (phi_b[..., np.newaxis] * grad_phi_b + phi_a[..., np.newaxis] * grad_phi_a)\n        \n        # Use np.divide to handle rho=0 case safely\n        tau_W = np.divide(np.sum(grad_rho**2, axis=-1), 8.0 * rho, \n                          out=np.zeros_like(rho), where=rho > 1e-15)\n                          \n        tau_unif = tau_unif_const * rho**(5.0 / 3.0)\n\n        # Calculate alpha, handling tau_unif=0 case safely\n        numerator_alpha = tau - tau_W\n        alpha = np.divide(numerator_alpha, tau_unif, \n                          out=np.zeros_like(rho), where=tau_unif > 1e-15)\n\n        # Calculate w'(alpha)\n        w_prime_alpha = 2.0 * alpha / (1.0 + alpha**2)**2\n\n        # Determine active fraction F\n        rho_mask = rho >= rho_cut\n        num_rho_points = np.sum(rho_mask)\n\n        if num_rho_points == 0:\n            F = 0.0\n        else:\n            active_mask = (w_prime_alpha >= activity_threshold) & rho_mask\n            num_active_points = np.sum(active_mask)\n            F = num_active_points / num_rho_points\n        \n        f_values.append(F)\n\n    # Find R* that maximizes F(R)\n    max_f = -1.0\n    r_star = -1.0\n    for R, F in zip(candidate_R, f_values):\n        if F > max_f:\n            max_f = F\n            r_star = R\n\n    # Assemble final results and format output\n    results = [f_ueg, f_1g, r_star]\n    formatted_results = [f\"{val:.3f}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2457711"}]}