{"hands_on_practices": [{"introduction": "The two most critical numerical parameters in any plane-wave calculation are the kinetic energy cutoff, $E_{\\text{cut}}$, and the density of the k-point mesh used to sample the Brillouin zone. By calculating the band gap of a model crystal, this exercise provides first-hand experience in how these parameters control the accuracy of a simulation. Mastering this type of convergence testing is a fundamental skill for producing reliable results in computational materials science [@problem_id:2460283].", "problem": "You are asked to study the convergence of the indirect band gap of crystalline silicon with respect to the plane-wave kinetic energy cutoff and the density of the crystal momentum sampling mesh. For computational tractability while retaining key physics of a plane-wave basis and Bragg scattering, use a simplified three-dimensional nearly-free-electron model with a cosine periodic potential on a simple cubic Bravais lattice, which captures an indirect gap via coupling at the Brillouin zone boundary. The task is to implement a complete program that constructs the single-electron Hamiltonian in a plane-wave basis at each crystal momentum point, diagonalizes it to obtain the lowest two energy bands, and estimates the indirect band gap as the difference between the minimum of the second band and the maximum of the first band across sampled crystal momentum points. All energies must be reported in electronvolts, and all lengths in angstroms.\n\nDefinitions and model:\n- Let the lattice parameter be $a = 5.43\\,\\text{\\AA}$. The reciprocal lattice primitive vectors are $\\mathbf{b}_1 = \\frac{2\\pi}{a}\\hat{\\mathbf{x}}$, $\\mathbf{b}_2 = \\frac{2\\pi}{a}\\hat{\\mathbf{y}}$, and $\\mathbf{b}_3 = \\frac{2\\pi}{a}\\hat{\\mathbf{z}}$. The first Brillouin zone is the cube $k_i \\in [-\\pi/a,\\pi/a)$ for $i \\in \\{x,y,z\\}$.\n- The electron kinetic energy is $T(\\mathbf{q}) = \\frac{\\hbar^2 |\\mathbf{q}|^2}{2 m_e}$ with $\\frac{\\hbar^2}{2m_e} = 3.8099819442818976\\,\\text{eV}\\cdot\\text{\\AA}^2$.\n- The periodic potential is $V(\\mathbf{r}) = 2 V_c \\left[\\cos\\left(\\mathbf{b}_1 \\cdot \\mathbf{r}\\right) + \\cos\\left(\\mathbf{b}_2 \\cdot \\mathbf{r}\\right) + \\cos\\left(\\mathbf{b}_3 \\cdot \\mathbf{r}\\right)\\right]$, with Fourier coefficients $V_{\\pm \\mathbf{b}_1} = V_{\\pm \\mathbf{b}_2} = V_{\\pm \\mathbf{b}_3} = V_c$ and all other Fourier coefficients equal to zero. Use $V_c = -1.25\\,\\text{eV}$. The unit-cell average of $V(\\mathbf{r})$ is zero.\n- For each crystal momentum $\\mathbf{k}$, the plane-wave basis consists of the set of states indexed by integer triples $\\mathbf{n} = (n_x,n_y,n_z)$ with wavevectors $\\mathbf{q}_{\\mathbf{n}}(\\mathbf{k}) = \\mathbf{k} + n_x \\mathbf{b}_1 + n_y \\mathbf{b}_2 + n_z \\mathbf{b}_3$ that satisfy the kinetic energy cutoff condition $T\\left(\\mathbf{q}_{\\mathbf{n}}(\\mathbf{k})\\right) \\le E_{\\text{cut}}$, where $E_{\\text{cut}}$ is a positive parameter in electronvolts. The Hamiltonian in this basis has matrix elements\n$$\nH_{\\mathbf{n},\\mathbf{m}}(\\mathbf{k}) =\n\\begin{cases}\nT\\left(\\mathbf{q}_{\\mathbf{n}}(\\mathbf{k})\\right), & \\text{if } \\mathbf{n} = \\mathbf{m},\\\\\nV_c, & \\text{if } \\mathbf{n} - \\mathbf{m} \\in \\{\\pm(1,0,0), \\pm(0,1,0), \\pm(0,0,1)\\},\\\\\n0, & \\text{otherwise.}\n\\end{cases}\n$$\n\nCrystal momentum sampling:\n- For an integer $N_k \\ge 1$, sample the first Brillouin zone on a uniform grid with $N_k$ points per Cartesian direction at\n$$\nk_i(j) = -\\frac{\\pi}{a} + \\frac{2\\pi}{a}\\,\\frac{j}{N_k}, \\quad j \\in \\{0,1,\\dots,N_k-1\\}, \\quad i \\in \\{x,y,z\\}.\n$$\nThis yields $N_k^3$ points $\\mathbf{k}$ to evaluate. For each such $\\mathbf{k}$, construct $H(\\mathbf{k})$ using the basis defined by the cutoff.\n\nBand edges and gap:\n- For each $\\mathbf{k}$ where the basis contains at least one plane wave, let $E_1(\\mathbf{k}) \\le E_2(\\mathbf{k}) \\le \\dots$ be the ascending eigenvalues of $H(\\mathbf{k})$. Across the set of $\\mathbf{k}$ points where at least one eigenvalue exists, define the valence band maximum as $E_v = \\max_{\\mathbf{k}} E_1(\\mathbf{k})$. Across the set of $\\mathbf{k}$ points where at least two eigenvalues exist, define the conduction band minimum as $E_c = \\min_{\\mathbf{k}} E_2(\\mathbf{k})$. The estimated indirect band gap is $E_g = E_c - E_v$ in electronvolts. If no $\\mathbf{k}$ point has at least two eigenvalues, $E_g$ is undefined.\n\nTest suite:\nCompute $E_g$ (in electronvolts) for the following parameter pairs $(E_{\\text{cut}}, N_k)$:\n- Case $1$: $(6.0, 1)$.\n- Case $2$: $(6.0, 4)$.\n- Case $3$: $(8.0, 4)$.\n- Case $4$: $(12.0, 10)$.\n- Case $5$: $(20.0, 12)$.\n\nOutput requirements:\n- Your program must produce a single line of output containing the five results as a comma-separated list enclosed in square brackets, for example $[x_1,x_2,x_3,x_4,x_5]$, with each $x_i$ the floating-point value of $E_g$ in electronvolts for the corresponding case, rounded to $6$ decimal places. If a particular $E_g$ is undefined due to insufficient basis size, output the string representation of a not-a-number value as given by the programming language for that case, but do not change the formatting of the list.", "solution": "The problem statement has been subjected to rigorous validation and is deemed valid. It is scientifically grounded, well-posed, objective, and contains all necessary information to proceed with a unique and verifiable solution. It represents a standard, albeit simplified, problem in computational solid-state physics, suitable for illustrating the principles of electronic band structure calculation using a plane-wave basis set. We shall now proceed to the solution.\n\nThe fundamental task is to solve the time-independent Schrödinger equation for a single electron in a periodic potential, $\\hat{H}\\psi(\\mathbf{r}) = E\\psi(\\mathbf{r})$, where the Hamiltonian is $\\hat{H} = \\hat{T} + \\hat{V} = -\\frac{\\hbar^2}{2m_e}\\nabla^2 + V(\\mathbf{r})$. The periodicity of the potential, $V(\\mathbf{r}) = V(\\mathbf{r}+\\mathbf{R})$ for any direct lattice vector $\\mathbf{R}$, imposes a specific structure on the eigenstates. According to Bloch's theorem, the solutions can be written in the form $\\psi_{\\mathbf{k}}(\\mathbf{r}) = e^{i\\mathbf{k}\\cdot\\mathbf{r}}u_{\\mathbf{k}}(\\mathbf{r})$, where $\\mathbf{k}$ is a crystal momentum vector in the first Brillouin zone and $u_{\\mathbf{k}}(\\mathbf{r})$ is a cell-periodic function, $u_{\\mathbf{k}}(\\mathbf{r}) = u_{\\mathbf{k}}(\\mathbf{r}+\\mathbf{R})$.\n\nGiven that $u_{\\mathbf{k}}(\\mathbf{r})$ is periodic, it can be expanded in a Fourier series over the reciprocal lattice vectors $\\mathbf{G}$: $u_{\\mathbf{k}}(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{\\mathbf{k}}(\\mathbf{G}) e^{i\\mathbf{G}\\cdot\\mathbf{r}}$. Substituting this into the Bloch form for the wavefunction gives the plane-wave expansion:\n$$\n\\psi_{\\mathbf{k}}(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{\\mathbf{k}}(\\mathbf{G}) e^{i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}}\n$$\nInserting this expansion into the Schrödinger equation transforms it into an infinite-dimensional matrix eigenvalue problem for the coefficients $c_{\\mathbf{k}}(\\mathbf{G})$ for each $\\mathbf{k}$. The matrix elements of the Hamiltonian in this plane-wave basis $|\\mathbf{k}+\\mathbf{G}\\rangle$ are given by $H_{\\mathbf{G},\\mathbf{G}'}(\\mathbf{k}) = \\langle \\mathbf{k}+\\mathbf{G} | \\hat{H} | \\mathbf{k}+\\mathbf{G}' \\rangle$.\n\nThe kinetic energy operator $\\hat{T}$ is diagonal in this basis:\n$$\n\\langle \\mathbf{k}+\\mathbf{G} | \\hat{T} | \\mathbf{k}+\\mathbf{G}' \\rangle = \\frac{\\hbar^2 |\\mathbf{k}+\\mathbf{G}|^2}{2m_e} \\delta_{\\mathbf{G},\\mathbf{G}'}\n$$\nThe potential energy operator $\\hat{V}$ has matrix elements determined by the Fourier coefficients of the potential, $V(\\mathbf{r}) = \\sum_{\\mathbf{G}} V_{\\mathbf{G}} e^{i\\mathbf{G}\\cdot\\mathbf{r}}$:\n$$\n\\langle \\mathbf{k}+\\mathbf{G} | \\hat{V} | \\mathbf{k}+\\mathbf{G}' \\rangle = V_{\\mathbf{G}-\\mathbf{G}'}\n$$\nCombining these, the full Hamiltonian matrix elements are:\n$$\nH_{\\mathbf{G},\\mathbf{G}'}(\\mathbf{k}) = \\frac{\\hbar^2 |\\mathbf{k}+\\mathbf{G}|^2}{2m_e} \\delta_{\\mathbf{G},\\mathbf{G}'} + V_{\\mathbf{G}-\\mathbf{G}'}\n$$\nThe problem specifies a simple cubic Bravais lattice with lattice parameter $a = 5.43\\,\\text{\\AA}$. The reciprocal lattice is also simple cubic, with primitive vectors $\\mathbf{b}_1 = \\frac{2\\pi}{a}\\hat{\\mathbf{x}}$, $\\mathbf{b}_2 = \\frac{2\\pi}{a}\\hat{\\mathbf{y}}$, and $\\mathbf{b}_3 = \\frac{2\\pi}{a}\\hat{\\mathbf{z}}$. A general reciprocal lattice vector is $\\mathbf{G}_{\\mathbf{n}} = n_x \\mathbf{b}_1 + n_y \\mathbf{b}_2 + n_z \\mathbf{b}_3$ for an integer vector $\\mathbf{n} = (n_x, n_y, n_z)$.\n\nThe periodic potential is $V(\\mathbf{r}) = 2 V_c \\left[\\cos\\left(\\mathbf{b}_1 \\cdot \\mathbf{r}\\right) + \\cos\\left(\\mathbf{b}_2 \\cdot \\mathbf{r}\\right) + \\cos\\left(\\mathbf{b}_3 \\cdot \\mathbf{r}\\right)\\right]$. Using Euler's formula, $\\cos(x) = (e^{ix}+e^{-ix})/2$, we identify its non-zero Fourier coefficients as $V_{\\mathbf{G}} = V_c$ for $\\mathbf{G} \\in \\{\\pm\\mathbf{b}_1, \\pm\\mathbf{b}_2, \\pm\\mathbf{b}_3\\}$ and $V_{\\mathbf{G}} = 0$ for all other $\\mathbf{G} \\ne 0$. The average potential $V_{\\mathbf{G}=0}$ is zero. This implies that the potential couples a plane wave $|\\mathbf{k}+\\mathbf{G}_{\\mathbf{n}}\\rangle$ only to plane waves $|\\mathbf{k}+\\mathbf{G}_{\\mathbf{m}}\\rangle$ where the difference $\\mathbf{G}_{\\mathbf{n}}-\\mathbf{G}_{\\mathbf{m}}$ is one of the six shortest non-zero reciprocal lattice vectors. This corresponds to the condition that $\\mathbf{n}-\\mathbf{m}$ is one of $\\pm(1,0,0)$, $\\pm(0,1,0)$, or $\\pm(0,0,1)$.\n\nIn a practical computation, the infinite basis must be truncated. This is achieved via a kinetic energy cutoff, $E_{\\text{cut}}$. For each crystal momentum $\\mathbf{k}$, we include in our basis only those plane waves $|\\mathbf{k}+\\mathbf{G}_{\\mathbf{n}}\\rangle$ for which the kinetic energy is below the cutoff:\n$$\nT(\\mathbf{k}+\\mathbf{G}_{\\mathbf{n}}) = \\frac{\\hbar^2 |\\mathbf{k}+\\mathbf{G}_{\\mathbf{n}}|^2}{2m_e} \\le E_{\\text{cut}}\n$$\nThis results in a finite-dimensional, $\\mathbf{k}$-dependent Hamiltonian matrix $H(\\mathbf{k})$, whose elements are precisely those specified in the problem statement. The eigenvalues of this matrix, $E_1(\\mathbf{k}) \\le E_2(\\mathbf{k}) \\le \\dots$, constitute the electronic band structure.\n\nThe computational algorithm is as follows:\n1.  For each given pair of parameters $(E_{\\text{cut}}, N_k)$, initialize the calculation. The required physical constants are $a = 5.43\\,\\text{\\AA}$, $\\frac{\\hbar^2}{2m_e} = 3.8099819442818976\\,\\text{eV}\\cdot\\text{\\AA}^2$, and $V_c = -1.25\\,\\text{eV}$.\n2.  Generate the uniform grid of $N_k^3$ crystal momentum vectors $\\mathbf{k}$ sampling the first Brillouin zone according to the rule $k_i(j) = -\\frac{\\pi}{a} + \\frac{2\\pi}{a}\\,\\frac{j}{N_k}$ for $j=0, \\dots, N_k-1$.\n3.  For each $\\mathbf{k}$ vector in the grid:\n    a. Determine the finite set of integer vectors $\\mathbf{n} = (n_x, n_y, n_z)$ that satisfy the kinetic energy cutoff condition. This is done by searching a sufficiently large cubic range of integers $\\mathbf{n}$ and retaining those that satisfy $T(\\mathbf{k}+\\mathbf{G}_{\\mathbf{n}}) \\le E_{\\text{cut}}$.\n    b. If the basis set is empty, no eigenvalues can be computed for this $\\mathbf{k}$. Proceed to the next $\\mathbf{k}$.\n    c. If the basis is non-empty, construct the Hamiltonian matrix $H(\\mathbf{k})$ of size $N_{basis} \\times N_{basis}$. The diagonal elements are $H_{\\mathbf{n},\\mathbf{n}}(\\mathbf{k}) = T(\\mathbf{k}+\\mathbf{G}_{\\mathbf{n}})$. The off-diagonal element $H_{\\mathbf{n},\\mathbf{m}}(\\mathbf{k})$ is $V_c$ if $\\mathbf{n}-\\mathbf{m}$ is a unit vector in one of the six Cartesian directions, and $0$ otherwise.\n    d. The resulting matrix is Hermitian. Diagonalize it to find its real eigenvalues. The eigenvalues are sorted in ascending order: $E_1(\\mathbf{k}) \\le E_2(\\mathbf{k}) \\le \\dots \\le E_{N_{basis}}(\\mathbf{k})$.\n    e. Collect the first eigenvalue $E_1(\\mathbf{k})$ and, if it exists, the second eigenvalue $E_2(\\mathbf{k})$.\n4.  After iterating through all $\\mathbf{k}$ points, determine the valence band maximum, $E_v = \\max_{\\mathbf{k}} E_1(\\mathbf{k})$, where the maximum is taken over all $\\mathbf{k}$ points that yielded at least one eigenvalue.\n5.  Similarly, determine the conduction band minimum, $E_c = \\min_{\\mathbf{k}} E_2(\\mathbf{k})$, where the minimum is taken over all $\\mathbf{k}$ points that yielded at least two eigenvalues.\n6.  If $E_c$ could not be determined (i.e., no $\\mathbf{k}$ point produced a basis of size two or greater), the band gap $E_g$ is undefined. Otherwise, calculate the indirect band gap as $E_g = E_c - E_v$.\n7.  This procedure is repeated for all five test cases, and the results are reported in the specified format. This systematic process ensures a correct and reproducible numerical solution to the problem as stated.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the indirect band gap of a model crystal using a plane-wave basis.\n    \"\"\"\n    # Physical constants and model parameters\n    A_LATTICE = 5.43  # Lattice parameter in Angstroms\n    HBAR_SQ_2ME = 3.8099819442818976  # h-bar^2 / (2*m_e) in eV * Angstrom^2\n    V_C = -1.25  # Potential strength in eV\n\n    # Reciprocal lattice vector magnitude\n    B_SCALAR = 2 * np.pi / A_LATTICE\n\n    # Test cases: (E_cut in eV, N_k)\n    test_cases = [\n        (6.0, 1),\n        (6.0, 4),\n        (8.0, 4),\n        (12.0, 10),\n        (20.0, 12),\n    ]\n\n    results = []\n    for E_cut, N_k in test_cases:\n        e1_all_k = []\n        e2_all_k = []\n\n        # Generate k-point mesh\n        k_coords_1d = -np.pi / A_LATTICE + (2 * np.pi / A_LATTICE) * np.arange(N_k) / N_k\n        kx_grid, ky_grid, kz_grid = np.meshgrid(k_coords_1d, k_coords_1d, k_coords_1d, indexing='ij')\n        k_points = np.stack([kx_grid.ravel(), ky_grid.ravel(), kz_grid.ravel()], axis=-1)\n\n        # Determine search range for integer vectors n = (nx, ny, nz)\n        # Bounding box must account for k-vector shift.\n        # |k_i| <= pi/a. We need C * (k_i + n_i*B)^2 <= E_cut.\n        # |n_i*B| <= sqrt(E_cut/C) + |k_i| <= sqrt(E_cut/C) + pi/a\n        # |n_i| <= (sqrt(E_cut/C) + pi/a) / B = a/(2pi) * sqrt(E_cut/C) + 1/2\n        n_lim = int(np.ceil((np.sqrt(E_cut / HBAR_SQ_2ME) + np.pi / A_LATTICE) / B_SCALAR))\n        n_range = np.arange(-n_lim, n_lim + 1)\n        nx_v, ny_v, nz_v = np.meshgrid(n_range, n_range, n_range, indexing='ij')\n        n_candidates = np.stack([nx_v.ravel(), ny_v.ravel(), nz_v.ravel()], axis=-1)\n\n        for k_vec in k_points:\n            # Generate basis set for the current k-point\n            G_vectors = n_candidates * B_SCALAR\n            q_vectors = k_vec + G_vectors\n            \n            kinetic_energies = HBAR_SQ_2ME * np.sum(q_vectors**2, axis=-1)\n            \n            basis_indices = np.where(kinetic_energies <= E_cut)[0]\n            \n            if basis_indices.size == 0:\n                continue\n            \n            basis_n_vectors = n_candidates[basis_indices]\n            basis_ke = kinetic_energies[basis_indices]\n            N_basis = len(basis_n_vectors)\n            \n            # Construct Hamiltonian\n            H = np.diag(basis_ke)\n            \n            # Map n-vectors to matrix indices for efficient lookup\n            n_to_idx = {tuple(n): i for i, n in enumerate(basis_n_vectors)}\n            \n            # Off-diagonal elements\n            deltas = np.array([[1,0,0], [-1,0,0], [0,1,0], [0,-1,0], [0,0,1], [0,0,-1]])\n            for i, n_i in enumerate(basis_n_vectors):\n                for delta in deltas:\n                    n_j_tuple = tuple(n_i + delta)\n                    if n_j_tuple in n_to_idx:\n                        j = n_to_idx[n_j_tuple]\n                        # Only fill upper triangle for eigh\n                        if i < j:\n                            H[i, j] = V_C\n                            H[j, i] = V_C\n\n            # Diagonalize and collect eigenvalues\n            if N_basis > 0:\n                # eigvalsh is efficient for Hermitian matrices and returns sorted eigenvalues\n                eigenvalues = np.linalg.eigvalsh(H)\n                e1_all_k.append(eigenvalues[0])\n                if N_basis >= 2:\n                    e2_all_k.append(eigenvalues[1])\n\n        # Calculate band gap for the current (E_cut, N_k) pair\n        if not e2_all_k:\n            Eg = np.nan\n        else:\n            E_v = np.max(e1_all_k)\n            E_c = np.min(e2_all_k)\n            Eg = E_c - E_v\n            \n        results.append(Eg)\n\n    # Format output as specified\n    formatted_results = []\n    for r in results:\n        if np.isnan(r):\n            formatted_results.append(\"nan\")\n        else:\n            formatted_results.append(f\"{r:.6f}\")\n\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2460283"}, {"introduction": "While plane-wave methods are intrinsically designed for periodic systems, they are routinely used to study isolated objects like molecules by placing them in a large simulation box. This powerful technique introduces artificial electrostatic interactions between the object and its periodic images, a significant finite-size error that must be understood. This practice guides you through quantifying the leading-order spurious energy for a polar molecule, demonstrating its characteristic $1/L^3$ decay with the size of the simulation cell, $L$ [@problem_id:2460290].", "problem": "You are asked to model the finite-size error in the total energy of a neutral, polar molecule represented in a plane-wave basis set with three-dimensional Periodic Boundary Conditions (PBC) and a conducting external boundary condition, as used in many Density Functional Theory (DFT) calculations. Consider a single water molecule with a gas-phase permanent dipole moment magnitude of $\\mu = 1.8546$ Debye, oriented arbitrarily in space. The molecule is placed at the center of a cubic simulation cell of edge length $L$, replicated periodically by PBC. Assume the system is overall neutral and that higher-order multipoles beyond the dipole are negligible. Focus on the asymptotic regime where the leading-order interaction between periodic images dominates the spurious contribution to the energy.\n\nYour task is to compute, for each specified box size $L$, the leading-order spurious dipole-dipole image interaction contribution to the total energy relative to the isolated-molecule limit. Report these energies in electronvolts, as non-negative real numbers. You must express all final energies in electronvolts, rounded to eight decimal places.\n\nUse the following test suite of cubic box sizes expressed in angstroms:\n- $6.0$\n- $10.0$\n- $12.0$\n- $20.0$\n- $100.0$\n\nOutput specification:\n- Your program must produce a single line of output containing a Python-like list of the five energies, ordered as above, each rounded to eight decimal places, and separated by commas without spaces. For example: \"[$E_1$,$E_2$,$E_3$,$E_4$,$E_5$]\" where each $E_i$ is a decimal-formatted floating-point number in electronvolts.\n- The only line printed by the program must be this list.\n\nPhysical unit requirements:\n- The edge length $L$ is given in angstroms.\n- The energy must be output in electronvolts, rounded to eight decimal places.\n- No angles are involved.\n\nAssumptions to use in your model:\n- The water molecule is neutral with permanent dipole moment magnitude $\\mu = 1.8546$ Debye.\n- The simulation cell is a cube of volume $\\Omega = L^3$ with three-dimensional PBC and a conducting external boundary.\n- Only the leading-order periodic image interaction term associated with the net dipole moment contributes; all higher-order terms are neglected.\n- The energy should be reported as the excess energy above the isolated-molecule limit due to periodic images, which is a non-negative scalar depending on $L$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, \"[$\\text{result}_1$,$\\text{result}_2$,$\\text{result}_3$,$\\text{result}_4$,$\\text{result}_5$]\").", "solution": "The problem statement has been critically evaluated and is deemed valid. It is scientifically grounded, well-posed, objective, and contains all necessary information for a unique and meaningful solution. The problem addresses a standard and important topic in computational materials science: the correction of finite-size errors in simulations employing periodic boundary conditions (PBC). We shall now proceed with a formal solution.\n\nThe problem asks for the leading-order spurious electrostatic energy contribution for a neutral molecule with a permanent dipole moment $\\vec{\\mu}$ placed in a cubic simulation cell of side length $L$ under three-dimensional PBC and conducting external boundary conditions. This spurious energy arises from the artificial interaction of the central dipole with its periodic images.\n\nIn the framework of Ewald summation for a lattice of dipoles, the long-range electrostatic interaction is conditionally convergent. Its value depends on the macroscopic shape of the simulated crystal and the dielectric properties of the surrounding medium. The problem specifies \"conducting external boundary condition,\" which corresponds to embedding the macroscopic sample within a medium of infinite dielectric constant ($\\epsilon \\to \\infty$). For a system with a net dipole moment density, this specific boundary condition gives rise to a non-zero depolarization field. The interaction energy of the dipole with this field and all its images under these conditions is given by the well-established formula:\n$$\nU = -\\frac{2\\pi}{3\\Omega} |\\vec{\\mu}|^2\n$$\nHere, $\\Omega = L^3$ is the volume of the cubic simulation cell and $|\\vec{\\mu}|$ is the magnitude of the dipole moment. This energy, $U$, represents the lowering of the system's total energy due to spurious attractive interactions with the periodic images in a conducting background. The quantity requested is the \"excess energy above the isolated-molecule limit,\" which is the correction $\\Delta E$ that must be added to the calculated PBC energy to approximate the energy of an isolated molecule. This correction is therefore non-negative:\n$$\n\\Delta E = -U = \\frac{2\\pi \\mu^2}{3 L^3}\n$$\nThe calculation must be performed using a consistent set of units. The provided data are in mixed units: the dipole moment $\\mu$ is in Debye (D), the box length $L$ is in angstroms ($\\text{Å}$), and the final energy must be in electronvolts (eV). A systematic conversion is required. The most direct approach is to convert all quantities into Hartree atomic units (a.u.), where the formula is simplest, and then convert the final energy from Hartrees to electronvolts.\n\nThe fundamental constants and conversion factors used are as follows:\n- Dipole moment magnitude: $\\mu = 1.8546$ D\n-\n- Conversion from Debye to a.u. of dipole moment ($e \\cdot a_0$): $1$ D $\\approx 0.393430307$ a.u.\n- Conversion from angstroms to a.u. of length (Bohr radius, $a_0$): $1$ $\\text{Å}$ $\\approx 1.8897261246$ a.u.\n- Conversion from Hartrees ($E_h$) to electronvolts (eV): $1$ $E_h \\approx 27.211386246$ eV\n\nFirst, we convert the given dipole moment magnitude into atomic units:\n$$\n\\mu_{\\text{a.u.}} = 1.8546 \\text{ D} \\times 0.393430307 \\frac{\\text{a.u.}}{\\text{D}} \\approx 0.7297926 \\text{ a.u.}\n$$\nNext, we express the box length $L$ in atomic units. For a given value $L_{\\text{Å}}$ in angstroms:\n$$\nL_{\\text{a.u.}} = L_{\\text{Å}} \\times 1.8897261246 \\frac{\\text{a.u.}}{\\text{Å}}\n$$\nSubstituting these into the energy formula gives the energy correction in Hartrees:\n$$\n\\Delta E_{E_h} = \\frac{2\\pi \\mu_{\\text{a.u.}}^2}{3 L_{\\text{a.u.}}^3} = \\frac{2\\pi (0.7297926)^2}{3 (L_{\\text{Å}} \\times 1.8897261246)^3}\n$$\nFinally, we convert this energy to electronvolts:\n$$\n\\Delta E_{\\text{eV}} = \\Delta E_{E_h} \\times 27.211386246 \\frac{\\text{eV}}{E_h}\n$$\nCombining these steps, we can define a single numerical constant $C$ such that $\\Delta E_{\\text{eV}} = C / L_{\\text{Å}}^3$:\n$$\nC = \\frac{2\\pi \\mu^2_{\\text{a.u.}}}{3} \\times \\frac{1}{\\left(1.8897261246 \\frac{\\text{a.u.}}{\\text{Å}}\\right)^3} \\times 27.211386246 \\frac{\\text{eV}}{E_h}\n$$\n$$\nC \\approx 4.5003362 \\text{ eV} \\cdot \\text{Å}^3\n$$\nThus, the energy correction for each box size $L_{\\text{Å}}$ is calculated as:\n$$\n\\Delta E(L_{\\text{Å}}) = \\frac{4.5003362}{L_{\\text{Å}}^3} \\text{ eV}\n$$\nWe now apply this formula to the specified test cases, rounding the final results to eight decimal places.\n\n1.  For $L = 6.0$ $\\text{Å}$:\n    $\\Delta E = \\frac{4.5003362}{(6.0)^3} = \\frac{4.5003362}{216.0} \\approx 0.0208348898$ eV $\\to 0.02083489$ eV\n\n2.  For $L = 10.0$ $\\text{Å}$:\n    $\\Delta E = \\frac{4.5003362}{(10.0)^3} = \\frac{4.5003362}{1000.0} \\approx 0.0045003362$ eV $\\to 0.00450034$ eV\n\n3.  For $L = 12.0$ $\\text{Å}$:\n    $\\Delta E = \\frac{4.5003362}{(12.0)^3} = \\frac{4.5003362}{1728.0} \\approx 0.0026043612$ eV $\\to 0.00260436$ eV\n\n4.  For $L = 20.0$ $\\text{Å}$:\n    $\\Delta E = \\frac{4.5003362}{(20.0)^3} = \\frac{4.5003362}{8000.0} \\approx 0.0005625420$ eV $\\to 0.00056254$ eV\n\n5.  For $L = 100.0$ $\\text{Å}$:\n    $\\Delta E = \\frac{4.5003362}{(100.0)^3} = \\frac{4.5003362}{1000000.0} \\approx 0.0000045003$ eV $\\to 0.00000450$ eV\n\nThese calculated values will be formatted into the specified output list.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the leading-order spurious dipole-dipole interaction energy\n    for a polar molecule in a cubic box with periodic boundary conditions.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Box edge lengths L in angstroms.\n    test_cases = [6.0, 10.0, 12.0, 20.0, 100.0]\n\n    # --- Givens and Constants ---\n    # Dipole moment of water molecule in Debye.\n    mu_D = 1.8546\n\n    # --- Conversion Factors (CODATA 2018 recommendations where applicable) ---\n    # 1 Debye to a.u. of dipole moment (e*a0).\n    # Based on 1 D = 3.33564095e-30 C*m and e*a0 = 1.602176634e-19 C * 0.529177210903e-10 m.\n    DEBYE_TO_AU_DIPOLE = 0.393430307\n\n    # 1 Angstrom to a.u. of length (Bohr, a0).\n    # Based on 1 Angstrom = 1e-10 m and a0 = 0.529177210903e-10 m.\n    ANGSTROM_TO_AU_LENGTH = 1.8897261246\n\n    # 1 Hartree to electronvolts (eV).\n    HARTREE_TO_EV = 27.211386245988\n\n    # --- Calculation ---\n    # Convert dipole moment to atomic units.\n    mu_au = mu_D * DEBYE_TO_AU_DIPOLE\n\n    results = []\n    for L_A in test_cases:\n        # Convert box length L from angstroms to atomic units.\n        L_au = L_A * ANGSTROM_TO_AU_LENGTH\n\n        # The formula for the leading-order energy correction in atomic units (Hartrees) is:\n        # E = (2 * pi * mu^2) / (3 * L^3)\n        # This is the correction to be added to the PBC total energy to get the isolated molecule energy.\n        energy_hartree = (2 * np.pi * mu_au**2) / (3 * L_au**3)\n\n        # Convert energy from Hartrees to electronvolts.\n        energy_ev = energy_hartree * HARTREE_TO_EV\n\n        # The problem requires non-negative energies rounded to 8 decimal places.\n        results.append(round(energy_ev, 8))\n\n    # Format the results into the required string format \"[E1,E2,E3,E4,E5]\".\n    # Using 'f-string' with a format specifier for floating point numbers.\n    # The '.8f' ensures 8 digits after the decimal point.\n    result_str = \",\".join([f\"{res:.8f}\" for res in results])\n    \n    # Final print statement in the exact required format.\n    print(f\"[{result_str}]\")\n\nsolve()\n\n```", "id": "2460290"}, {"introduction": "The supercell method is an essential technique for modeling localized, aperiodic features, such as point defects or surfaces, within a periodic computational framework. In this exercise, you will model a single impurity in a one-dimensional crystal and investigate how the calculated impurity energy shift converges as the supercell size increases. This process illustrates the critical trade-off between computational cost and the accuracy required to minimize spurious interactions between periodic images of the defect [@problem_id:2460291].", "problem": "Consider a one-dimensional crystal modeled with periodic boundary conditions and a plane-wave basis. A primitive crystal has lattice constant $a$ and host potential $V_{\\text{host}}(x)=V_c \\cos\\left(\\frac{2\\pi x}{a}\\right)$. A single substitutional impurity is modeled within a supercell of length $L=N a$ by adding a localized impurity potential $V_{\\text{imp}}(x)$ centered at $x=0$, repeated periodically with period $L$ by virtue of the boundary conditions. The impurity potential is given by a Gaussian of amplitude $A$ and width $\\sigma$, that is, $V_{\\text{imp}}(x) = A \\sum_{m\\in\\mathbb{Z}} \\exp\\!\\left(-\\frac{(x-mL)^2}{\\sigma^2}\\right)$. The total potential in the supercell is thus $V(x)=V_{\\text{host}}(x)+V_{\\text{imp}}(x)$.\n\nIn Hartree atomic units (length in bohr and energy in Hartree), consider a single non-interacting electron governed by the time-independent Schrödinger equation with periodic boundary conditions in the supercell,\n$$\n\\hat{H} \\psi(x) = E \\psi(x), \\quad \\hat{H} = -\\frac{1}{2}\\frac{\\mathrm{d}^2}{\\mathrm{d}x^2} + V(x), \\quad \\psi(x+L)=\\psi(x).\n$$\nRestrict the Hilbert space to plane waves at the Gamma point (zero crystal momentum), truncated by a kinetic energy cutoff $E_{\\text{cut}}$. That is, use basis functions $\\phi_G(x) = \\frac{1}{\\sqrt{L}} e^{i G x}$ with reciprocal vectors $G=\\frac{2\\pi n}{L}$ for integer $n$ such that $\\frac{1}{2}G^2 \\le E_{\\text{cut}}$.\n\nFor each parameter set below, compute the lowest eigenvalue $E_{\\text{defect}}(N,E_{\\text{cut}})$ of $\\hat{H}$ with the total potential $V(x)$, and the lowest eigenvalue $E_{\\text{host}}(N,E_{\\text{cut}})$ of $\\hat{H}$ with the host potential $V_{\\text{host}}(x)$ alone (that is, with $A=0$). Report the impurity-induced energy shift\n$$\n\\Delta E(N,E_{\\text{cut}}) = E_{\\text{defect}}(N,E_{\\text{cut}}) - E_{\\text{host}}(N,E_{\\text{cut}}),\n$$\nin Hartree. Study the convergence of $\\Delta E$ with supercell size $N$.\n\nAll quantities must be treated in Hartree atomic units, and all reported energies must be expressed in Hartree as decimal floats.\n\nUse the following test suite of parameter values, where each tuple is $(N,E_{\\text{cut}},a,V_c,A,\\sigma)$:\n\n- Case $1$: $(4, 20.0, 1.0, 0.5, -0.4, 0.15)$\n- Case $2$: $(8, 20.0, 1.0, 0.5, -0.4, 0.15)$\n- Case $3$: $(16, 20.0, 1.0, 0.5, -0.4, 0.15)$\n- Case $4$: $(6, 20.0, 1.0, 0.5, 0.0, 0.15)$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the cases above. For example, the format must be exactly like $[\\Delta E_1,\\Delta E_2,\\Delta E_3,\\Delta E_4]$, where each $\\Delta E_i$ is a float in Hartree. No other text must be printed.", "solution": "The problem presented is a standard exercise in computational solid-state physics, specifically the application of a plane-wave basis set to solve the time-independent Schrödinger equation for a one-dimensional periodic system with an impurity. The problem is scientifically grounded, well-posed, and all necessary parameters are provided. Therefore, a solution can be constructed.\n\nThe governing equation is the one-dimensional, single-electron Schrödinger equation in Hartree atomic units ($\\hbar = 1, m_e = 1, e=1, 4\\pi\\epsilon_0=1$):\n$$\n\\hat{H} \\psi(x) = \\left( -\\frac{1}{2}\\frac{\\mathrm{d}^2}{\\mathrm{d}x^2} + V(x) \\right) \\psi(x) = E \\psi(x)\n$$\nThe calculation is performed within a supercell of length $L = N a$, imposing periodic boundary conditions $\\psi(x+L)=\\psi(x)$. The total potential is $V(x) = V_{\\text{host}}(x) + V_{\\text{imp}}(x)$.\n\nWe expand the wavefunction $\\psi(x)$ in a basis of plane waves. As the problem specifies calculations at the Gamma point (crystal momentum $k=0$), the basis functions are the reciprocal lattice vectors of the supercell:\n$$\n\\phi_G(x) = \\frac{1}{\\sqrt{L}} e^{i G x}, \\quad \\text{where} \\quad G = \\frac{2\\pi n}{L} \\quad \\text{for } n \\in \\mathbb{Z}\n$$\nThe expansion is $\\psi(x) = \\sum_{G} c_G \\phi_G(x)$. This converts the differential Schrödinger equation into a matrix eigenvalue problem in the basis of plane-wave coefficients $\\{c_G\\}$. The Hamiltonian matrix elements are $H_{G', G} = \\langle \\phi_{G'} | \\hat{H} | \\phi_G \\rangle$.\n\nThe Hilbert space is truncated by a kinetic energy cutoff $E_{\\text{cut}}$, which restricts the set of basis functions to those with kinetic energy $\\frac{1}{2}G^2 \\le E_{\\text{cut}}$. This implies:\n$$\n\\frac{1}{2} \\left(\\frac{2\\pi n}{L}\\right)^2 \\le E_{\\text{cut}} \\implies |n| \\le \\frac{L}{\\pi}\\sqrt{\\frac{E_{\\text{cut}}}{2}}\n$$\nLet $n_{\\text{max}} = \\lfloor \\frac{L}{\\pi}\\sqrt{\\frac{E_{\\text{cut}}}{2}} \\rfloor$. The basis will consist of plane waves with integer indices $n$ from $-n_{\\text{max}}$ to $n_{\\text{max}}$, resulting in a basis of size $N_b = 2n_{\\text{max}}+1$.\n\nThe Hamiltonian matrix elements $H_{G', G}$ are the sum of the kinetic and potential energy matrix elements:\n$$\nH_{G', G} = \\langle \\phi_{G'} | -\\frac{1}{2}\\frac{\\mathrm{d}^2}{\\mathrm{d}x^2} | \\phi_G \\rangle + \\langle \\phi_{G'} | V(x) | \\phi_G \\rangle\n$$\n\nThe kinetic energy operator is diagonal in the plane-wave basis:\n$$\nT_{G', G} = \\langle \\phi_{G'} | \\frac{1}{2}G^2 | \\phi_G \\rangle = \\frac{1}{2}G^2 \\delta_{G',G}\n$$\nOn our integer index grid, this becomes $T_{n', n} = \\frac{1}{2}\\left(\\frac{2\\pi n}{L}\\right)^2 \\delta_{n',n}$.\n\nThe potential energy matrix element is given by the Fourier transform of the potential:\n$$\nV_{G', G} = \\frac{1}{L} \\int_0^L e^{-iG'x} V(x) e^{iGx} dx = \\frac{1}{L} \\int_0^L V(x) e^{i(G-G')x} dx = V_{G'-G}\n$$\nwhere $V_{K}$ is the Fourier coefficient of $V(x)$ for the wavevector $K = G'-G$. Since the total potential is a sum, its Fourier coefficients are the sum of the coefficients of its parts: $V_{G'-G} = V_{\\text{host}, G'-G} + V_{\\text{imp}, G'-G}$.\n\nFor the host potential, $V_{\\text{host}}(x)=V_c \\cos\\left(\\frac{2\\pi x}{a}\\right) = \\frac{V_c}{2}\\left( e^{i\\frac{2\\pi x}{a}} + e^{-i\\frac{2\\pi x}{a}} \\right)$. Its Fourier coefficients are non-zero only for wavevectors $K = \\pm \\frac{2\\pi}{a}$. The matrix element $V_{\\text{host}, G'-G}$ is non-zero if $G'-G = \\pm \\frac{2\\pi}{a}$. In terms of integer indices:\n$$\n\\frac{2\\pi n'}{L} - \\frac{2\\pi n}{L} = \\pm \\frac{2\\pi}{a} \\implies \\frac{n'-n}{Na} = \\pm \\frac{1}{a} \\implies n'-n = \\pm N\n$$\nThus, $V_{\\text{host}, n', n} = \\frac{V_c}{2}$ if $n'-n = \\pm N$, and $0$ otherwise.\n\nFor the impurity potential, $V_{\\text{imp}}(x) = A \\sum_{m\\in\\mathbb{Z}} \\exp\\!\\left(-\\frac{(x-mL)^2}{\\sigma^2}\\right)$, the Fourier coefficient for a wavevector $K$ is found by integrating over one period:\n$$\nV_{\\text{imp}, K} = \\frac{1}{L} \\int_{-\\infty}^{\\infty} A \\exp\\left(-\\frac{x^2}{\\sigma^2}\\right) e^{-iKx} dx = \\frac{A}{L} \\left( \\sigma\\sqrt{\\pi} \\exp\\left(-\\frac{K^2\\sigma^2}{4}\\right) \\right)\n$$\nThis is derived by recognizing the sum of shifted Gaussians is a periodic function, and its Fourier coefficient integral over one period equals the Fourier transform of a single Gaussian. Substituting $K=G'-G=\\frac{2\\pi(n'-n)}{L}$, the impurity potential matrix elements are:\n$$\nV_{\\text{imp}, n', n} = \\frac{A \\sigma\\sqrt{\\pi}}{L} \\exp\\left(-\\frac{1}{4}\\left(\\frac{2\\pi(n'-n)}{L}\\right)^2 \\sigma^2 \\right)\n$$\nSince both potentials $V_{\\text{host}}(x)$ and $V_{\\text{imp}}(x)$ are real and even functions, the resulting Hamiltonian matrix is real and symmetric.\n\nThe algorithm proceeds as follows for each test case:\n$1$. Define the basis set by calculating $n_{\\text{max}}$.\n$2$. Construct the host Hamiltonian matrix, $H_{\\text{host}}$, of size $(2n_{\\text{max}}+1) \\times (2n_{\\text{max}}+1)$. Its elements are $H_{\\text{host}, n', n} = T_{n', n} + V_{\\text{host}, n', n}$.\n$3$. Construct the defect Hamiltonian matrix, $H_{\\text{defect}}$, by adding the impurity potential matrix to the host Hamiltonian: $H_{\\text{defect}, n', n} = H_{\\text{host}, n', n} + V_{\\text{imp}, n', n}$.\n$4$. Numerically diagonalize both real symmetric matrices to find their eigenvalues. The lowest eigenvalue for each system, $E_{\\text{host}}$ and $E_{\\text{defect}}$, is the ground state energy.\n$5$. The impurity-induced energy shift is $\\Delta E = E_{\\text{defect}} - E_{\\text{host}}$. For Case $4$, $A=0$, so $V_{\\text{imp}}=0$, and thus $\\Delta E$ must be $0$. This serves as a validation of the method.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to process test cases and print results.\n    \"\"\"\n    test_cases = [\n        (4, 20.0, 1.0, 0.5, -0.4, 0.15),\n        (8, 20.0, 1.0, 0.5, -0.4, 0.15),\n        (16, 20.0, 1.0, 0.5, -0.4, 0.15),\n        (6, 20.0, 1.0, 0.5, 0.0, 0.15),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, E_cut, a, V_c, A, sigma = case\n        \n        # Calculate lowest eigenvalues for the defect and host systems.\n        E_defect = calculate_lowest_eigenvalue(N, E_cut, a, V_c, A, sigma)\n        E_host = calculate_lowest_eigenvalue(N, E_cut, a, V_c, 0.0, sigma)\n        \n        # Calculate the impurity-induced energy shift.\n        delta_E = E_defect - E_host\n        results.append(delta_E)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\ndef calculate_lowest_eigenvalue(N, E_cut, a, V_c, A, sigma):\n    \"\"\"\n    Calculates the lowest eigenvalue of the Hamiltonian for a given set of parameters.\n    The parameter A (impurity amplitude) determines whether it is a defect (A != 0)\n    or host (A = 0) calculation.\n    \"\"\"\n    # 1. Define the supercell and basis set parameters\n    L = N * a\n    \n    # Determine the range of integer indices n for the plane-wave basis\n    # based on the kinetic energy cutoff E_cut.\n    n_max = int(np.floor((L / np.pi) * np.sqrt(E_cut / 2.0)))\n    basis_size = 2 * n_max + 1\n    \n    # Array of integer indices for G vectors: n = -n_max, ..., n_max\n    n_indices = np.arange(-n_max, n_max + 1)\n\n    # 2. Construct the Hamiltonian matrix\n    H = np.zeros((basis_size, basis_size), dtype=float)\n\n    # 2a. Kinetic Energy Term (diagonal)\n    # G_n = 2*pi*n/L. T = 0.5 * G_n^2\n    G_vals = 2.0 * np.pi * n_indices / L\n    T_matrix_diag = 0.5 * G_vals**2\n    H += np.diag(T_matrix_diag)\n\n    # 2b. Host Potential Term (off-diagonal)\n    # V_host couples states n and n' where |n - n'| = N.\n    # In matrix indices (i,j), this means |i-j| = N.\n    if V_c != 0.0:\n        for i in range(basis_size):\n            if i + N < basis_size:\n                H[i, i + N] += V_c / 2.0\n                H[i + N, i] += V_c / 2.0\n\n    # 2c. Impurity Potential Term (dense matrix)\n    # This term is added only if the impurity amplitude A is non-zero.\n    if A != 0.0:\n        # Create a matrix of index differences (j - i) using broadcasting\n        # This corresponds to n' - n for matrix element H[j, i]\n        matrix_indices = np.arange(basis_size)\n        diff_n_matrix = matrix_indices[:, None] - matrix_indices[None, :]\n        \n        # K = G' - G = 2*pi*(n'-n)/L\n        K_matrix = 2.0 * np.pi * diff_n_matrix / L\n        \n        # V_imp(K) = (A * sigma * sqrt(pi) / L) * exp(-K^2 * sigma^2 / 4)\n        V_imp_matrix = (A * sigma * np.sqrt(np.pi) / L) * \\\n                       np.exp(-K_matrix**2 * sigma**2 / 4.0)\n        \n        H += V_imp_matrix\n\n    # 3. Diagonalize the Hamiltonian\n    # Since H is a real symmetric matrix, np.linalg.eigh is efficient\n    # and returns sorted eigenvalues.\n    eigenvalues = np.linalg.eigh(H)[0]\n    \n    # The lowest eigenvalue is the first element.\n    return eigenvalues[0]\n\nsolve()\n```", "id": "2460291"}]}