{"hands_on_practices": [{"introduction": "The power of the Adaptive Biasing Force method hinges on achieving sufficient sampling to establish equilibrium at each point along the reaction coordinate. This thought experiment probes what happens when this crucial condition is not met, a common challenge in simulations of systems with high energy barriers. By analyzing the outcome of an incomplete simulation, you will develop a crucial skill: recognizing the tell-tale signs of non-convergence in a computed free energy profile [@problem_id:2448538].", "problem": "Consider a molecular system described by a one-dimensional collective variable (CV) $\\xi$ that exhibits two deep, non-equivalent free-energy minima separated by a high barrier. The Potential of Mean Force (PMF) $A(\\xi)$ is defined by the reversible work along $\\xi$, with its derivative given by\n$$\n\\frac{\\mathrm{d}A(\\xi)}{\\mathrm{d}\\xi} = - \\left\\langle F_{\\xi} \\right\\rangle_{\\xi},\n$$\nwhere $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$ is the conditional equilibrium average of the instantaneous generalized force projected along $\\xi$ at fixed $\\xi$. In Adaptive Biasing Force (ABF), a biasing potential $V_{\\mathrm{ABF}}(\\xi)$ is constructed so that $\\mathrm{d}V_{\\mathrm{ABF}}/\\mathrm{d}\\xi$ adaptively approaches $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$, with the aim of improving sampling and reconstructing $A(\\xi)$ by numerical integration of the estimated mean force.\n\nSuppose an ABF simulation is initialized in the lower free-energy minimum and is terminated long before the system has undergone adequately many transitions in both directions across the barrier (i.e., before local conditional equilibrium is reached in each bin and before reversibility along $\\xi$ is established). Which option best describes the qualitative appearance of the resulting estimated PMF $\\hat{A}(\\xi)$?\n\nA. Nearly flat $\\hat{A}(\\xi)$ with two wells of equal depth and a strongly underestimated barrier, because the adaptive bias flattens the profile even with few samples.\n\nB. An apparent preference for the initial basin: $\\hat{A}(\\xi)$ reproduces the local curvature near the starting minimum, but the barrier height is overestimated and the other minimum appears too high in free energy; poorly sampled regions are noisy or irregular.\n\nC. Exact $A(\\xi)$ within the visited interval and no estimate elsewhere, because the local force average enforces the exact gradient regardless of sampling directionality.\n\nD. A symmetric double-well $\\hat{A}(\\xi)$ differing from the true $A(\\xi)$ only by an additive constant, despite the non-equivalence of the minima.\n\nE. A PMF $\\hat{A}(\\xi)$ that is essentially random and uncorrelated with the true landscape, because the imposed bias dominates the dynamics from the outset.", "solution": "The problem statement must first be subjected to rigorous validation.\n\n### Step 1: Extract Givens\n- The system is described by a one-dimensional collective variable (CV) $\\xi$.\n- The Potential of Mean Force (PMF), $A(\\xi)$, has two deep, non-equivalent minima separated by a high barrier.\n- The derivative of the PMF is defined as $\\frac{\\mathrm{d}A(\\xi)}{\\mathrm{d}\\xi} = - \\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$, where $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$ is the conditional equilibrium average of the instantaneous generalized force projected along $\\xi$ at fixed $\\xi$.\n- In the Adaptive Biasing Force (ABF) method, a biasing potential $V_{\\mathrm{ABF}}(\\xi)$ is constructed such that its derivative, $\\frac{\\mathrm{d}V_{\\mathrm{ABF}}}{\\mathrm{d}\\xi}$, adaptively approaches $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$.\n- The objective of ABF is to improve sampling and reconstruct $A(\\xi)$ by numerical integration of the estimated mean force.\n- The simulation conditions are:\n    1.  Initialization in the lower free-energy minimum.\n    2.  Termination occurs \"long before the system has undergone adequately many transitions in both directions across the barrier\".\n    3.  This implies \"local conditional equilibrium is not reached in each bin\" and \"reversibility along $\\xi$ is not established\".\n- The question asks for the qualitative appearance of the resulting estimated PMF, $\\hat{A}(\\xi)$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement describes a standard scenario in the application of an enhanced sampling method, specifically ABF, in computational statistical mechanics.\n\n- **Scientifically Grounded:** The definitions of the PMF, $A(\\xi)$, and its relation to the mean force, $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$, are fundamental principles of statistical mechanics. The description of the ABF method is consistent with its standard formulation. The scenario of a non-converged simulation is a common and practical problem.\n- **Well-Posed:** The problem is well-defined. It specifies the system (two non-equivalent minima), the method (ABF), the initial conditions (start in the lower minimum), and the termination condition (insufficient sampling across the barrier). The question asks for a qualitative but physically determined outcome. A unique conceptual answer exists based on the principles of the method.\n- **Objective:** The language is precise and technical. It avoids subjectivity and ambiguity.\n\n### Step 3: Verdict and Action\nThe problem statement is valid. It is scientifically sound, well-posed, and objective. I will proceed with the derivation of the solution.\n\nThe core principle of the Adaptive Biasing Force method is the estimation of the true mean force, $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$, by accumulating a running average of the instantaneous force, $F_{\\xi}$, within discrete bins along the collective variable $\\xi$. The estimated PMF, $\\hat{A}(\\xi)$, is then obtained by integrating the negative of this estimated mean force:\n$$\n\\hat{A}(\\xi) = \\int_{\\xi_0}^{\\xi} \\frac{\\mathrm{d}A(x)}{\\mathrm{d}x} \\, \\mathrm{d}x \\approx - \\int_{\\xi_0}^{\\xi} \\hat{\\left\\langle F_{x} \\right\\rangle}_{x} \\, \\mathrm{d}x + C\n$$\nwhere $\\hat{\\left\\langle F_{x} \\right\\rangle}_{x}$ is the estimated mean force in the bin corresponding to coordinate $x$ and $C$ is an integration constant.\n\nThe problem specifies two critical conditions: the simulation is initiated in one basin and is terminated before convergence. Convergence in ABF requires two conditions to be met for each bin along $\\xi$:\n1.  **Statistical convergence**: Sufficient samples of $F_{\\xi}$ must be collected so that the statistical error on the average is low.\n2.  **Equilibrium of orthogonal degrees of freedom**: The system, constrained at a value of $\\xi$, must have had time to equilibrate in all other degrees of freedom. This is what \"conditional equilibrium average\" $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$ signifies. This requires the system to have visited the bin from all adjacent regions (e.g., from both the left and the right) multiple times, establishing reversibility.\n\nThe problem explicitly states that the simulation is terminated before \"adequately many transitions in both directions across the barrier\" have occurred. This is a direct violation of the second condition for convergence, particularly in the barrier region.\n\nLet us analyze the consequences:\n- **In the initial basin**: The system is initialized here and spends a significant amount of time exploring this region before crossing the barrier. Sampling is therefore dense. The force estimates, $\\hat{\\left\\langle F_{\\xi} \\right\\rangle}_{\\xi}$, will be statistically reliable, and the system is in local equilibrium. Consequently, the integral, $\\hat{A}(\\xi)$, will accurately reproduce the true shape and local curvature of the PMF, $A(\\xi)$, within this initial free-energy well.\n\n- **On the barrier and in the second basin**: As the ABF bias pushes the system away from the initial minimum and up the free-energy barrier, the sampling becomes progressively sparser. The crucial failure is the lack of reversibility. The forces $F_{\\xi}$ are sampled almost exclusively from trajectories moving \"uphill\" from the first basin. The system is being actively driven into a high-energy region and does not have time to relax its orthogonal degrees of freedom to the new constrained condition. This phenomenon, known as hysteresis or system lag, results in a systematic error. The measured restoring force is typically overestimated; it is the force required to drag a non-equilibrated system, which is greater than the force required to hold an equilibrated one. Therefore, the magnitude of the estimated mean force, $|\\hat{\\left\\langle F_{\\xi} \\right\\rangle}_{\\xi}|$, will be systematically larger than the true equilibrium value, $|\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}|$, in the barrier region.\n\n- **Consequences for $\\hat{A}(\\xi)$**: Integrating a mean force whose magnitude is overestimated leads to a reconstructed PMF that is too steep. This means the free-energy difference between the minimum and the transition state—the barrier height—will be **overestimated**. Following this overestimated barrier, the subsequent descent into the second basin will start from an artificially high free-energy value. As a result, the second minimum will appear to be at a much higher free energy relative to the first minimum than it is in reality. Furthermore, in regions with very few samples (the barrier top and the second basin), the high statistical uncertainty in the force estimate will manifest as noise or irregular, jagged features in the reconstructed PMF, $\\hat{A}(\\xi)$.\n\n### Option-by-Option Analysis\n\n**A. Nearly flat $\\hat{A}(\\xi)$ with two wells of equal depth and a strongly underestimated barrier, because the adaptive bias flattens the profile even with few samples.**\n**Incorrect.** The ABF method flattens the *modified* free-energy surface (physical plus bias), not the reconstructed PMF $\\hat{A}(\\xi)$. $\\hat{A}(\\xi)$ is the estimate of the original, un-flattened PMF. There is no reason for the wells to become of equal depth, especially with biased sampling. An underestimated barrier is also contrary to the expected hysteresis effect.\n\n**B. An apparent preference for the initial basin: $\\hat{A}(\\xi)$ reproduces the local curvature near the starting minimum, but the barrier height is overestimated and the other minimum appears too high in free energy; poorly sampled regions are noisy or irregular.**\n**Correct.** This statement accurately summarizes the consequences of a non-converged ABF simulation with insufficient barrier crossings. Good sampling in the initial basin ensures correct local curvature. Lack of reversible sampling leads to force overestimation (hysteresis), causing an overestimated barrier. This, in turn, makes the subsequent basin appear artificially high in energy. Poor statistics in sparsely sampled regions lead to noise.\n\n**C. Exact $A(\\xi)$ within the visited interval and no estimate elsewhere, because the local force average enforces the exact gradient regardless of sampling directionality.**\n**Incorrect.** This is fundamentally wrong. The local force average only converges to the exact gradient, $-\\frac{\\mathrm{d}A(\\xi)}{\\mathrm{d}\\xi}$, under conditions of local equilibrium and sufficient sampling. The problem explicitly states these conditions are not met. The directionality of sampling is critical for avoiding systematic bias.\n\n**D. A symmetric double-well $\\hat{A}(\\xi)$ differing from the true $A(\\xi)$ only by an additive constant, despite the non-equivalence of the minima.**\n**Incorrect.** The true PMF is asymmetric (\"non-equivalent minima\"). There is no physical or algorithmic reason why a non-converged simulation, started asymmetrically, would produce a symmetric result. The result will be a distorted version of the true asymmetric profile, not a perfectly symmetric one.\n\n**E. A PMF $\\hat{A}(\\xi)$ that is essentially random and uncorrelated with the true landscape, because the imposed bias dominates the dynamics from the outset.**\n**Incorrect.** The result is not random. It is systematically biased. In the well-sampled initial region, the correlation with the true landscape is high. The bias does not dominate from the outset; it is built up adaptively from an initial value of zero. Therefore, the initial part of the simulation explores the true potential. The final result, while flawed, is far from random.", "answer": "$$\\boxed{B}$$", "id": "2448538"}, {"introduction": "An accurate Potential of Mean Force relies on an accurate estimation of the mean force. This exercise presents a hypothetical scenario where a software bug introduces a systematic error into the force calculation. By tracing the consequences of this error, you will gain a deeper understanding of the direct mathematical link between the mean force and the free energy profile, as defined in the ABF method [@problem_id:2448553].", "problem": "In Adaptive Biasing Force (ABF) molecular simulation, one estimates the potential of mean force (PMF) along a chosen reaction coordinate $\\xi$ by accumulating the mean generalized force conjugate to $\\xi$ and integrating along $\\xi$. Consider an ABF calculation of the PMF $A(\\xi)$ for a system with well-behaved sampling. Due to a software bug, the instantaneous generalized force along $\\xi$ is systematically underestimated by $10\\%$ at all configurations, and this flawed force is used both to accumulate the mean force and to apply the bias during the simulation. Assume very long sampling so that statistical noise is negligible, and that all other aspects of the calculation are correct.\n\nWhich statement best describes the impact of this $10\\%$ underestimation on the computed PMF $\\widehat{A}(\\xi)$ relative to the true PMF $A(\\xi)$?\n\nA. $\\widehat{A}(\\xi)$ differs from $A(\\xi)$ only by an additive constant; all free-energy barriers and differences are unchanged.\n\nB. $\\widehat{A}(\\xi)$ is uniformly scaled toward its reference level by a factor of $0.9$: for any two values $\\xi_1$ and $\\xi_2$, the free-energy difference $\\widehat{A}(\\xi_2)-\\widehat{A}(\\xi_1)$ equals $0.9\\,[A(\\xi_2)-A(\\xi_1)]$; barrier heights are underestimated by $10\\%$, while the locations of minima and maxima in $\\xi$ are unchanged.\n\nC. $\\widehat{A}(\\xi)$ has all barrier heights and free-energy differences overestimated by $10\\%$ relative to $A(\\xi)$.\n\nD. $\\widehat{A}(\\xi)$ is unaffected because the ABF bias compensates exactly for any systematic error in the force estimator.\n\nE. $\\widehat{A}(\\xi)$ acquires an additional linear tilt with constant slope equal to $10\\%$ of the average true force along $\\xi$, regardless of the detailed shape of $A(\\xi)$.", "solution": "The problem statement must first be validated for its scientific and logical integrity.\n\n**Step 1: Extract Givens**\n-   Method: Adaptive Biasing Force (ABF) molecular simulation.\n-   Target quantity: Potential of Mean Force (PMF), $A(\\xi)$, along a reaction coordinate $\\xi$.\n-   True relationship: The derivative of the PMF is the negative of the mean generalized force, $\\frac{dA(\\xi)}{d\\xi} = -\\langle F(\\xi) \\rangle_\\xi$.\n-   Systematic error: The instantaneous generalized force, $F$, is systematically underestimated by $10\\%$. The measured force is $\\widehat{F} = (1 - 0.1)F = 0.9F$.\n-   Usage of flawed force: The flawed force $\\widehat{F}$ is used for both (1) accumulating the mean force estimate and (2) applying the biasing force during the simulation.\n-   Computed PMF: The computed PMF, denoted $\\widehat{A}(\\xi)$, is obtained by integrating the accumulated mean of the flawed force.\n-   Assumptions: The simulation is very long, making statistical noise negligible. Sampling is \"well-behaved\".\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded in the principles of statistical mechanics and enhanced sampling methods. The concept of a systematic error in a force calculation is a plausible scenario for theoretical analysis. The problem is well-posed, providing sufficient information to deduce the consequence of the error. The core of the problem lies in the dual use of the erroneous force, which is a critical and well-defined condition. The assumption of \"very long sampling\" allows us to analyze the converged, systematic error, ignoring stochastic fluctuations. The phrase \"well-behaved sampling\" implies that despite the imperfect bias, the system explores the entire relevant range of $\\xi$, allowing for the convergence of conditional averages. This is a standard idealization. The problem statement is therefore valid.\n\n**Step 3: Derivation of the Solution**\n\nThe true Potential of Mean Force, $A(\\xi)$, is defined by its relationship with the true mean force, $\\langle F \\rangle_\\xi$, which is the conditional ensemble average of the instantaneous force $F$ for a given value of the reaction coordinate $\\xi$:\n$$ \\frac{dA(\\xi)}{d\\xi} = -\\langle F \\rangle_\\xi $$\n\nIn the described scenario, the force measured at every step is a flawed force, $\\widehat{F}$, given by:\n$$ \\widehat{F} = 0.9 F $$\n\nThe ABF algorithm estimates the mean force by accumulating these measured instantaneous forces into bins along $\\xi$. Given sufficient sampling, this running average, $\\overline{\\widehat{F}}(\\xi)$, converges to the true conditional mean of the measured force, $\\langle \\widehat{F} \\rangle_\\xi$. A foundational principle of methods like ABF and umbrella sampling is that a biasing potential that is a function of $\\xi$ only does not alter the conditional average of observables at a fixed $\\xi$. The average is over all other degrees of freedom, which are not directly affected by such a bias. Therefore, the converged estimate of the mean force is:\n$$ \\overline{\\widehat{F}}(\\xi) = \\langle \\widehat{F} \\rangle_\\xi = \\langle 0.9 F \\rangle_\\xi = 0.9 \\langle F \\rangle_\\xi $$\n\nThe computed PMF, $\\widehat{A}(\\xi)$, is obtained by integrating the negative of this accumulated mean force:\n$$ \\frac{d\\widehat{A}(\\xi)}{d\\xi} = -\\overline{\\widehat{F}}(\\xi) = -0.9 \\langle F \\rangle_\\xi $$\n\nBy substituting the definition of the true PMF's derivative, $-\\langle F \\rangle_\\xi = \\frac{dA(\\xi)}{d\\xi}$, we obtain the relationship between the derivatives of the computed and true PMFs:\n$$ \\frac{d\\widehat{A}(\\xi)}{d\\xi} = 0.9 \\frac{dA(\\xi)}{d\\xi} $$\n\nTo understand the impact on free energy differences, we integrate this equation from a reference point $\\xi_1$ to another point $\\xi_2$:\n$$ \\int_{\\xi_1}^{\\xi_2} \\frac{d\\widehat{A}(\\zeta)}{d\\zeta} d\\zeta = \\int_{\\xi_1}^{\\xi_2} 0.9 \\frac{dA(\\zeta)}{d\\zeta} d\\zeta $$\n$$ \\widehat{A}(\\xi_2) - \\widehat{A}(\\xi_1) = 0.9 \\left( A(\\xi_2) - A(\\xi_1) \\right) $$\n\nThis result demonstrates that any free energy difference computed from the flawed simulation is exactly $90\\%$ of the true free energy difference. Consequently, the heights of free energy barriers, being differences between a maximum and a minimum, will be underestimated by $10\\%$.\n\nNext, we identify the locations of the stationary points (minima and maxima) on the PMF profile. These occur where the gradient of the PMF is zero.\n-   For the true PMF, $A(\\xi)$, stationary points are at $\\xi$ where $\\frac{dA(\\xi)}{d\\xi} = 0$.\n-   For the computed PMF, $\\widehat{A}(\\xi)$, stationary points are at $\\xi$ where $\\frac{d\\widehat{A}(\\xi)}{d\\xi} = 0$.\n\nSince $\\frac{d\\widehat{A}(\\xi)}{d\\xi} = 0.9 \\frac{dA(\\xi)}{d\\xi}$, the condition $\\frac{d\\widehat{A}(\\xi)}{d\\xi} = 0$ is met if and only if $\\frac{dA(\\xi)}{d\\xi} = 0$ (as $0.9 \\neq 0$). Thus, the locations of the minima and maxima of $\\widehat{A}(\\xi)$ are identical to those of $A(\\xi)$.\n\nIn summary, the systematic underestimation of the force by $10\\%$ leads to a computed PMF profile $\\widehat{A}(\\xi)$ that is a \"flattened\" version of the true profile $A(\\xi)$, where all free energy differences are scaled down by a factor of $0.9$, but the positions of the features remain unchanged.\n\n**Option-by-Option Analysis**\n\nA. $\\widehat{A}(\\xi)$ differs from $A(\\xi)$ only by an additive constant; all free-energy barriers and differences are unchanged.\nThis statement implies $\\widehat{A}(\\xi_2) - \\widehat{A}(\\xi_1) = A(\\xi_2) - A(\\xi_1)$. Our derivation shows the free-energy differences are scaled by a factor of $0.9$. Therefore, this option is **Incorrect**.\n\nB. $\\widehat{A}(\\xi)$ is uniformly scaled toward its reference level by a factor of $0.9$: for any two values $\\xi_1$ and $\\xi_2$, the free-energy difference $\\widehat{A}(\\xi_2)-\\widehat{A}(\\xi_1)$ equals $0.9\\,[A(\\xi_2)-A(\\xi_1)]$; barrier heights are underestimated by $10\\%$, while the locations of minima and maxima in $\\xi$ are unchanged.\nThis statement is a complete and accurate description of our derived results. The relation $\\widehat{A}(\\xi_2)-\\widehat{A}(\\xi_1) = 0.9\\,[A(\\xi_2)-A(\\xi_1)]$ is what we derived. This directly implies that barrier heights are underestimated by $10\\%$. We also proved that the locations of minima and maxima are unchanged. Therefore, this option is **Correct**.\n\nC. $\\widehat{A}(\\xi)$ has all barrier heights and free-energy differences overestimated by $10\\%$ relative to $A(\\xi)$.\nThis would mean the scaling factor is $1.1$. Our derivation shows the factor is $0.9$. Therefore, this option is **Incorrect**.\n\nD. $\\widehat{A}(\\xi)$ is unaffected because the ABF bias compensates exactly for any systematic error in the force estimator.\nThe compensation is not exact. The bias applied is $F_{bias}(\\xi) = -\\overline{\\widehat{F}}(\\xi) = -0.9 \\langle F \\rangle_\\xi$. The total mean force on the system is $\\langle F_{total} \\rangle_\\xi = \\langle F \\rangle_\\xi + F_{bias}(\\xi) = \\langle F \\rangle_\\xi - 0.9 \\langle F \\rangle_\\xi = 0.1 \\langle F \\rangle_\\xi$. Since the residual mean force is not zero, the compensation is incomplete. The computed PMF is based on the flawed force integral, and it is therefore affected. Therefore, this option is **Incorrect**.\n\nE. $\\widehat{A}(\\xi)$ acquires an additional linear tilt with constant slope equal to $10\\%$ of the average true force along $\\xi$, regardless of the detailed shape of $A(\\xi)$.\nThis suggests an error of the form $\\frac{d\\widehat{A}}{d\\xi} = \\frac{dA}{d\\xi} + c$. Our derivation shows $\\frac{d\\widehat{A}}{d\\xi} = 0.9 \\frac{dA}{d\\xi}$, which is a multiplicative (scaling) error on the slope, not an additive one. The error in the slope, $\\frac{d\\widehat{A}}{d\\xi} - \\frac{dA}{d\\xi} = -0.1 \\frac{dA}{d\\xi}$, is not constant but depends on $\\xi$. Therefore, this option is **Incorrect**.", "answer": "$$\\boxed{B}$$", "id": "2448553"}, {"introduction": "The final step of any ABF study is to reconstruct the Potential of Mean Force by integrating the collected mean force data. This practical coding exercise places you in the role of a data analyst, tasking you with processing the output of a simulation. You will not only perform the numerical integration but also tackle a realistic challenge: handling regions where data is missing or corrupted, a common occurrence that requires robust interpolation techniques to resolve [@problem_id:2448511].", "problem": "You are given a one-dimensional adaptive biasing force (ABF) data reconstruction task expressed in purely mathematical terms. Consider a dimensionless reaction coordinate $z \\in [0,1]$ with an unknown true mean force $f_{\\star}(z)$. From a completed simulation, you have binned mean-force samples $\\{(z_i,\\bar{F}_i)\\}_{i=0}^{N-1}$ on the uniform grid $z_i = \\frac{i}{N-1}$ for $i \\in \\{0,1,\\dots,N-1\\}$. The data in a specified subinterval is corrupted and must be treated as missing. Assume that for $i$ corresponding to uncorrupted grid points, the samples are exact: $\\bar{F}_i = f_{\\star}(z_i)$.\n\nYour task is to reconstruct a twice continuously differentiable function $f:[0,1]\\to\\mathbb{R}$ that satisfies the following:\n\n- For all uncorrupted indices $i$, $f(z_i) = \\bar{F}_i$.\n- Among all such functions, $f$ minimizes the bending energy\n$$\n\\int_{0}^{1} \\left(f''(z)\\right)^2 \\, dz\n$$\nsubject to the natural boundary conditions $f''(0)=0$ and $f''(1)=0$.\n\nDefine the reconstructed potential of mean force (PMF) $W(z)$ by\n$$\nW(z) = -\\int_{0}^{z} f(s)\\, ds,\n$$\nwith $W(0)=0$. Let the exact PMF be $W_{\\star}(z) = -\\int_{0}^{z} f_{\\star}(s)\\, ds$ with $W_{\\star}(0)=0$.\n\nFor each test case below, compute the root-mean-square error (RMSE) between $W$ and $W_{\\star}$ on a dense grid of $M$ equispaced points $z^{(k)}=\\frac{k}{M-1}$, $k \\in \\{0,1,\\dots,M-1\\}$:\n$$\n\\varepsilon = \\sqrt{\\frac{1}{M}\\sum_{k=0}^{M-1} \\left( W\\!\\left(z^{(k)}\\right) - W_{\\star}\\!\\left(z^{(k)}\\right) \\right)^2 }.\n$$\n\nAll quantities are dimensionless. Use $M = 1001$.\n\nTest suite. For each case, the exact force $f_{\\star}(z)$, the number of samples $N$, and the corrupted interval $\\mathcal{I}$ are specified. Construct the grid $z_i=\\frac{i}{N-1}$ and form the exact samples $\\bar{F}_i=f_{\\star}(z_i)$. Treat any $z_i \\in \\mathcal{I}$ as corrupted and exclude those constraints in the reconstruction. The endpoints $z=0$ and $z=1$ are uncorrupted in all cases.\n\n- Case $1$ (happy path): $f_{\\star}(z) = \\sin\\!\\left(2\\pi z\\right)$, $N=33$, corrupted interval $\\mathcal{I}=[0.45,\\,0.55]$.\n- Case $2$ (boundary consistency): $f_{\\star}(z) = 3 z - 1$, $N=21$, corrupted interval $\\mathcal{I}=[0.35,\\,0.50]$.\n- Case $3$ (wide missing region): $f_{\\star}(z) = e^{z}$, $N=15$, corrupted interval $\\mathcal{I}=[0.30,\\,0.70]$.\n\nYour program should produce a single line of output containing the three RMSE values for Cases $1$–$3$ as a comma-separated list enclosed in square brackets, with each value rounded to six decimal places (e.g., \"[0.001234,0.000000,0.012345]\").", "solution": "We begin from the physical definition that in adaptive biasing force (ABF) analysis the potential of mean force (PMF) $W(z)$ satisfies $W'(z) = -f_{\\star}(z)$, where $f_{\\star}(z)$ is the exact mean force along the reaction coordinate $z$. When we only have samples of the force at discrete points and a region is corrupted, we must interpolate or infer the force in the missing region while maintaining physical consistency, namely that the force should be sufficiently smooth in $z$ for macroscopic collective variables. The requirement to minimize the bending energy $\\int_{0}^{1} \\left(f''(z)\\right)^2 dz$ among functions that pass through the uncorrupted samples and satisfy $f''(0)=f''(1)=0$ formalizes this as a well-posed variational problem.\n\nPrinciple 1: Variational characterization of the interpolant. Consider the space of functions $\\mathcal{H} = \\{ f \\in C^2([0,1]) : f'' \\in L^2([0,1]) \\}$ and the linear constraints $f(z_i)=\\bar{F}_i$ for all uncorrupted $i$. The functional\n$$\nJ[f] = \\int_{0}^{1} \\left(f''(z)\\right)^2 \\, dz\n$$\nis strictly convex on $\\mathcal{H}$, and the feasible set defined by the interpolation constraints is affine and non-empty (since a piecewise-cubic function through the data exists). The Euler–Lagrange equation for the associated constrained minimization implies that the minimizer is a piecewise-cubic polynomial with continuous first and second derivatives at the interpolation nodes, and $f''(0)=f''(1)=0$ (natural boundary conditions). Uniqueness follows from strict convexity. This minimizer is the natural cubic spline interpolant through the uncorrupted points.\n\nPrinciple 2: Reconstruction of the PMF. Once $f$ is reconstructed, the PMF is given by\n$$\nW(z) = -\\int_{0}^{z} f(s)\\, ds,\n$$\nwith $W(0)=0$. This is a direct application of the fundamental theorem of calculus and the ABF definition of the PMF.\n\nPrinciple 3: Error quantification. To quantify the reconstruction quality, we compute the root-mean-square error (RMSE) over a dense grid $\\{ z^{(k)} \\}_{k=0}^{M-1}$,\n$$\n\\varepsilon = \\sqrt{\\frac{1}{M}\\sum_{k=0}^{M-1}\\left( W\\!\\left(z^{(k)}\\right) - W_{\\star}\\!\\left(z^{(k)}\\right) \\right)^2 }.\n$$\nFor each test case, $W_{\\star}(z)$ is derived analytically from the exact force $f_{\\star}(z)$:\n- Case $1$: $f_{\\star}(z) = \\sin\\!\\left(2\\pi z\\right)$. Then\n$$\nW_{\\star}(z) = -\\int_{0}^{z} \\sin(2\\pi s)\\, ds = -\\left[-\\frac{\\cos(2\\pi s)}{2\\pi}\\right]_{0}^{z} = \\frac{\\cos(2\\pi z) - 1}{2\\pi}.\n$$\n- Case $2$: $f_{\\star}(z) = 3 z - 1$. Then\n$$\nW_{\\star}(z) = -\\int_{0}^{z} (3 s - 1)\\, ds = -\\left(\\frac{3}{2} z^2 - z\\right) = -\\frac{3}{2} z^2 + z.\n$$\n- Case $3$: $f_{\\star}(z) = e^{z}$. Then\n$$\nW_{\\star}(z) = -\\int_{0}^{z} e^{s}\\, ds = -\\left(e^{z} - 1\\right) = 1 - e^{z}.\n$$\n\nAlgorithmic realization. To compute the minimizer, we employ the natural cubic spline interpolant through the uncorrupted nodes $\\{(z_i,\\bar{F}_i)\\}$, which is justified by the variational characterization above. A natural cubic spline produces a piecewise-cubic $f$ with continuous first and second derivatives and satisfies $f''(0)=f''(1)=0$. The reconstructed $f$ is then integrated to obtain $W$. Numerically, the antiderivative of a cubic spline can be constructed exactly by integrating its piecewise-polynomial representation, enabling accurate evaluation of $W(z)$ for any $z$. We then compute the RMSE $\\varepsilon$ on the dense grid of $M=1001$ points for each test case.\n\nTest suite coverage. The three cases probe different behaviors:\n- Case $1$ tests a smooth oscillatory force with a modest corrupted interval.\n- Case $2$ tests linear force; the spline exactly reproduces linear functions, so the RMSE is expected to be near machine precision.\n- Case $3$ tests a rapidly varying monotonic force with a wide missing interval, stressing the extrapolative behavior across the gap.\n\nThe final program constructs the grids, removes points whose $z_i$ lie in the specified corrupted interval $\\mathcal{I}$, fits the natural cubic spline to the remaining points, forms the antiderivative to compute $W$, evaluates $W$ and $W_{\\star}$ on the dense grid, computes the RMSE, and prints the three RMSE values rounded to six decimal places in a single comma-separated list enclosed in square brackets, as required.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.interpolate import CubicSpline\n\ndef true_force(case_id, z):\n    if case_id == 1:\n        return np.sin(2*np.pi*z)\n    elif case_id == 2:\n        return 3.0*z - 1.0\n    elif case_id == 3:\n        return np.exp(z)\n    else:\n        raise ValueError(\"Invalid case_id\")\n\ndef true_pmf(case_id, z):\n    # W*(z) with W*(0)=0\n    if case_id == 1:\n        return (np.cos(2*np.pi*z) - 1.0) / (2*np.pi)\n    elif case_id == 2:\n        return -1.5*z*z + z\n    elif case_id == 3:\n        return 1.0 - np.exp(z)\n    else:\n        raise ValueError(\"Invalid case_id\")\n\ndef reconstruct_rmse(case_id, N, corrupt_interval, M=1001):\n    # Build nodes and exact samples\n    z_nodes = np.linspace(0.0, 1.0, N)\n    f_exact = true_force(case_id, z_nodes)\n\n    a, b = corrupt_interval\n    # Keep points not in corrupted interval (inclusive bounds)\n    mask = ~((z_nodes >= a) & (z_nodes <= b))\n    # Ensure endpoints are kept (as stated in problem); just in case tolerance issues\n    mask[0] = True\n    mask[-1] = True\n\n    x = z_nodes[mask]\n    y = f_exact[mask]\n\n    # Fit natural cubic spline interpolant through uncorrupted points\n    spline = CubicSpline(x, y, bc_type='natural')\n\n    # Construct antiderivative to get PMF: W(z) = -(F(z) - F(0))\n    anti = spline.antiderivative()\n    F0 = anti(0.0)\n\n    # Dense grid for RMSE\n    z_dense = np.linspace(0.0, 1.0, M)\n    W_rec = -(anti(z_dense) - F0)\n    W_true = true_pmf(case_id, z_dense)\n\n    rmse = np.sqrt(np.mean((W_rec - W_true)**2))\n    return rmse\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (case_id, N, (a, b))\n        (1, 33, (0.45, 0.55)),  # Case 1\n        (2, 21, (0.35, 0.50)),  # Case 2\n        (3, 15, (0.30, 0.70)),  # Case 3\n    ]\n\n    results = []\n    for case_id, N, interval in test_cases:\n        rmse = reconstruct_rmse(case_id, N, interval, M=1001)\n        results.append(rmse)\n\n    # Round to six decimals and format\n    results_str = \",\".join(f\"{x:.6f}\" for x in results)\n    print(f\"[{results_str}]\")\n\nsolve()\n```", "id": "2448511"}]}