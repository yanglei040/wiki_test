{"hands_on_practices": [{"introduction": "The choice of network topology is a foundational decision in system design, directly influencing performance and cost. This first practice provides a quantitative comparison of three canonical topologies: the shared bus, the ring, and the mesh. By calculating the average hop count for a random communication event in each network [@problem_id:3652325], you will develop a first-principles understanding of how a network's structure determines its intrinsic latency and scalability.", "problem": "A multiprocessor system-on-chip employs three alternative interconnection topologies to carry coherence traffic for moving cache lines between sharers: a shared bus, a bidirectional ring, and a two-dimensional mesh Network-on-Chip (NoC). All topologies have the same number of cores, $N = 64$. In the mesh case, cores are laid out on a regular $8 \\times 8$ grid with routers at grid intersections, and cache line data follows dimension-order paths (Manhattan routing) between source and destination. In the ring case, routers are connected in a cycle and data always follows the shorter of the two directions around the ring. In the bus case, all cores attach to a single shared medium. Assume a directory-based cache coherence protocol (DCCP) and that transfers of cache lines from the current owner to a requesting sharer proceed along the shortest path in the topology, without indirections through a home node and without contention or queuing.\n\nDefine the hop count for a transfer as the number of distinct inter-router link segments traversed by the cache line data along the shortest path from source to destination. For the bus, treat the shared medium traversal as a single hop regardless of source and destination attachment points. Suppose two distinct sharers of a given cache line are selected uniformly at random among the $N$ cores, and the line migrates from one to the other. Using only core definitions of these topologies and first-principles counting arguments, compute the average hop count for this migration under each topology: mesh, ring, and bus. Report your three answers in the order mesh, ring, bus. Round each value to four significant figures. No physical units are required; report dimensionless hop counts.", "solution": "The problem asks for the average hop count for a cache line migration between two distinct, randomly chosen cores in a system with $N=64$ cores for three different interconnection topologies: an $8 \\times 8$ two-dimensional mesh, a $64$-node bidirectional ring, and a shared bus.\n\nThe average hop count, $\\bar{H}$, is defined as the sum of all shortest-path hop counts between distinct source-destination pairs, divided by the total number of such pairs. Since the two distinct cores are chosen uniformly at random, there are $N$ choices for the source core and $N-1$ choices for the destination core. The total number of ordered pairs of distinct cores is $N(N-1)$.\n\nThe general formula for the average hop count is:\n$$ \\bar{H} = \\frac{\\sum_{i=1}^{N} \\sum_{j=1, j \\neq i}^{N} H(i, j)}{N(N-1)} $$\nwhere $H(i, j)$ is the hop count from a source core $i$ to a destination core $j$.\n\nWe will now analyze each topology separately.\n\n### 1. Shared Bus Topology\nFor a shared bus, the problem statement specifies that a transfer between any two attachment points constitutes a single hop. Therefore, for any distinct source core $i$ and destination core $j$, the hop count is constant.\n$$ H_{bus}(i, j) = 1 \\quad \\forall i \\neq j $$\nThe sum of hop counts over all distinct pairs is:\n$$ \\sum_{i=1}^{N} \\sum_{j=1, j \\neq i}^{N} H_{bus}(i, j) = \\sum_{i=1}^{N} \\sum_{j=1, j \\neq i}^{N} 1 = N(N-1) $$\nThe average hop count is therefore:\n$$ \\bar{H}_{bus} = \\frac{N(N-1)}{N(N-1)} = 1 $$\nFor $N=64$, the average hop count for the bus is exactly $1$.\n\n### 2. Bidirectional Ring Topology\nIn a bidirectional ring with $N$ cores, we can label the cores from $0$ to $N-1$. The hop count between core $i$ and core $j$ is the length of the shorter path along the ring. The distance in one direction is $|i-j|$, and in the other direction is $N - |i-j|$. Thus, the hop count is:\n$$ H_{ring}(i, j) = \\min(|i-j|, N - |i-j|) $$\nDue to the symmetry of the ring topology, the sum of distances from any given core to all other cores is the same. We can, therefore, calculate this sum for a single source, say core $0$, and then multiply by $N$ to get the total sum over all source cores.\nThe sum of distances from core $0$ to all other cores $j \\in \\{1, 2, \\dots, N-1\\}$ is:\n$$ S_0 = \\sum_{j=1}^{N-1} H_{ring}(0, j) = \\sum_{j=1}^{N-1} \\min(j, N-j) $$\nGiven $N=64$, which is an even number, the maximum shortest-path distance is $N/2 = 32$. This distance is unique to the diametrically opposite node. For all other distances $d  N/2$, there are two nodes at that distance.\nThe sum can be written as:\n$$ S_0 = \\sum_{j=1}^{N/2 - 1} j + \\frac{N}{2} + \\sum_{j=N/2 + 1}^{N-1} (N-j) $$\nThe second summation can be re-indexed. Let $k = N-j$. When $j=N/2+1$, $k=N/2-1$. When $j=N-1$, $k=1$. So, $\\sum_{j=N/2 + 1}^{N-1} (N-j) = \\sum_{k=1}^{N/2-1} k$.\n$$ S_0 = 2 \\sum_{j=1}^{N/2 - 1} j + \\frac{N}{2} $$\nUsing the formula for the sum of the first $m$ integers, $\\sum_{j=1}^{m} j = \\frac{m(m+1)}{2}$:\n$$ S_0 = 2 \\left( \\frac{(\\frac{N}{2}-1)(\\frac{N}{2}-1+1)}{2} \\right) + \\frac{N}{2} = (\\frac{N}{2}-1)\\frac{N}{2} + \\frac{N}{2} = \\frac{N}{2}(\\frac{N}{2}-1+1) = \\left(\\frac{N}{2}\\right)^2 = \\frac{N^2}{4} $$\nThe total sum of hop counts for all distinct pairs is $N \\times S_0 = N \\cdot \\frac{N^2}{4} = \\frac{N^3}{4}$.\nThe average hop count is this total sum divided by the number of pairs, $N(N-1)$:\n$$ \\bar{H}_{ring} = \\frac{N^3/4}{N(N-1)} = \\frac{N^2}{4(N-1)} $$\nFor $N=64$:\n$$ \\bar{H}_{ring} = \\frac{64^2}{4(64-1)} = \\frac{4096}{4 \\times 63} = \\frac{1024}{63} \\approx 16.253968... $$\n\n### 3. 2D Mesh Topology\nThe system has $N=64$ cores arranged in a regular $K \\times K$ grid, where $K = \\sqrt{N} = \\sqrt{64} = 8$. A core's position can be identified by coordinates $(x, y)$, where $x, y \\in \\{0, 1, \\dots, K-1\\}$.\nThe problem specifies Manhattan routing, so the hop count between a source core at $(x_s, y_s)$ and a destination core at $(x_d, y_d)$ is:\n$$ H_{mesh}((x_s, y_s), (x_d, y_d)) = |x_s - x_d| + |y_s - y_d| $$\nThe average hop count is the expectation of this quantity over all distinct source-destination pairs. By the linearity of expectation, this is:\n$$ \\bar{H}_{mesh} = E[|x_s - x_d| + |y_s - y_d|] = E[|x_s - x_d|] + E[|y_s - y_d|] $$\nThe average displacement in the x-dimension, $E[|x_s - x_d|]$, is the total sum of x-displacements divided by the total number of distinct pairs, $N(N-1)$.\n$$ E[|x_s - x_d|] = \\frac{\\sum_{s \\neq d} |x_s - x_d|}{N(N-1)} $$\nThe sum is over all $N(N-1)$ pairs of distinct cores. We can compute the sum over all $N^2$ pairs (including self-pairs) and note that for self-pairs ($s=d$), the displacement $|x_s - x_s|$ is $0$. Thus, the sum over distinct pairs is the same as the sum over all pairs.\n$$ \\sum_{s \\neq d} |x_s - x_d| = \\sum_{s=1}^{N} \\sum_{d=1}^{N} |x_s - x_d| = \\sum_{y_s=0}^{K-1} \\sum_{x_s=0}^{K-1} \\sum_{y_d=0}^{K-1} \\sum_{x_d=0}^{K-1} |x_s - x_d| $$\nWe can rearrange a summation:\n$$ \\sum_{y_s=0}^{K-1} \\sum_{y_d=0}^{K-1} \\left( \\sum_{x_s=0}^{K-1} \\sum_{x_d=0}^{K-1} |x_s - x_d| \\right) $$\nThe outer two sums over $y_s$ and $y_d$ yield a factor of $K^2$. The inner double summation is the total 1D distance sum for a line of $K$ nodes. This sum, for all pairs including self-pairs, is $\\frac{K(K^2-1)}{3}$.\nThus, the total sum of x-displacements is $K^2 \\times \\frac{K(K^2-1)}{3} = \\frac{K^3(K^2-1)}{3}$.\nThe average x-displacement is:\n$$ E[|x_s - x_d|] = \\frac{K^3(K^2-1)/3}{N(N-1)} = \\frac{K^3(K^2-1)/3}{K^2(K^2-1)} = \\frac{K}{3} $$\nBy symmetry, the average y-displacement $E[|y_s - y_d|]$ is also $\\frac{K}{3}$.\nThe average total hop count for the mesh is:\n$$ \\bar{H}_{mesh} = \\frac{K}{3} + \\frac{K}{3} = \\frac{2K}{3} $$\nFor $K=8$:\n$$ \\bar{H}_{mesh} = \\frac{2 \\times 8}{3} = \\frac{16}{3} = 5.333333... $$\n\n### Summary of Results\nThe computed average hop counts are:\n- Mesh: $\\bar{H}_{mesh} = \\frac{16}{3} \\approx 5.3333...$\n- Ring: $\\bar{H}_{ring} = \\frac{1024}{63} \\approx 16.2539...$\n- Bus: $\\bar{H}_{bus} = 1$\n\nRounding each value to four significant figures, as requested:\n- Mesh: $5.333$\n- Ring: $16.25$\n- Bus: $1.000$\n\nThe problem requests the answers in the order: mesh, ring, bus.", "answer": "$$\n\\boxed{\\begin{pmatrix} 5.333  16.25  1.000 \\end{pmatrix}}\n$$", "id": "3652325"}, {"introduction": "As systems scale, simple direct networks become insufficient, leading to the use of multistage interconnection networks (MINs) built from smaller switches. However, these fabrics introduce a new challenge: internal blocking, where certain communication patterns can create conflicts inside the network even if the endpoints are distinct. This exercise uses the classic Banyan network to explore the phenomenon of blocking, analyze its performance impact, and introduce the principles of non-blocking switch design [@problem_id:3652356].", "problem": "Consider an $N \\times N$ Banyan network built from $2 \\times 2$ switching elements, where $N = 2^{k}$ for some integer $k \\ge 1$. The network has $k$ stages, each stage containing $N/2$ identical $2 \\times 2$ switches. The interstage interconnection is a perfect shuffle, and the network is self-routing: at stage $s \\in \\{1,\\dots,k\\}$, each packet chooses the upper or lower output of its current $2 \\times 2$ switch according to the $s$-th most significant bit of its destination address. Each $2 \\times 2$ switch is unbuffered and can forward at most one packet per output link per time slot; if both inputs request the same output, exactly one packet advances and the other cannot be forwarded in that slot.\n\nAssume synchronous operation in discrete time slots and permutation traffic in a slot, meaning every input injects one packet and the $N$ destinations are all distinct (one-to-one mapping). You may use the following fundamental bases:\n- The structural definition of the Banyan network and its unique path under self-routing by destination bits.\n- Basic probability counting under uniformly random permutations.\n- Link-capacity constraints: at most one packet per directed link per time slot.\n\nWhich of the following statements are correct? Select all that apply.\n\nA. For a uniformly random permutation drawn independently each slot and for large $N$, an independence approximation across stages yields that the expected fraction of inputs that successfully reach their destinations in one pass through a $k$-stage unbuffered Banyan is approximately $(3/4)^k$.\n\nB. For $N = 8$ and the complement permutation $d(i) = 7 - i$ for inputs $i \\in \\{0,1,\\dots,7\\}$, every first-stage $2 \\times 2$ switch faces both inputs requesting the same output, so in any single slot with no internal buffering at most $4$ packets can reach any outputs.\n\nC. Prepending a Batcher sorting network that sorts packets by destination address before the Banyan eliminates internal blocking for permutation traffic in a single slot, so the combined sorter-plus-Banyan can deliver $N$ packets per slot for any permutation.\n\nD. For any permutation on $N = 2^{k}$ inputs, partitioning the packets into two disjoint sets based on the most significant destination bit (send those with a $0$ in that bit in slot $1$, those with a $1$ in slot $2$) always suffices to realize the full permutation over two slots on the plain Banyan without any additional hardware.\n\nProvide your choice(s).", "solution": "The problem asks to evaluate four statements about the behavior of an unbuffered $N \\times N$ Banyan network.\n\n**A. For a uniformly random permutation drawn independently each slot and for large $N$, an independence approximation across stages yields that the expected fraction of inputs that successfully reach their destinations in one pass through a $k$-stage unbuffered Banyan is approximately $(3/4)^k$.**\n\nThis statement describes a simplified probabilistic analysis of the network's throughput. Let's analyze the probability of conflict within a single $2 \\times 2$ switch.\nLet a switch receive two packets. For a random permutation and large $N$, the destination addresses of these two packets are approximately independent and uniformly distributed. The routing at stage $s$ depends on the $s$-th most significant bit of the destination. Let these bits for the two packets be $b_1$ and $b_2$.\nThe probability of each bit being $0$ or $1$ is $1/2$.\n-   A conflict occurs if $b_1 = b_2$. The probability is $P(b_1=0, b_2=0) + P(b_1=1, b_2=1) = (1/2)(1/2) + (1/2)(1/2) = 1/2$. In this case, one packet passes, one is blocked.\n-   No conflict occurs if $b_1 \\neq b_2$. The probability is $1/2$. In this case, both packets pass.\n\nThe expected number of packets that pass through a switch that receives two packets is $1 \\times P(\\text{conflict}) + 2 \\times P(\\text{no conflict}) = 1 \\times (1/2) + 2 \\times (1/2) = 3/2$.\nSince two packets entered, the probability that a *specific* packet passes, given that two packets arrived at its switch, is $(3/2)/2 = 3/4$.\n\nThe \"independence approximation\" mentioned in the statement implies a simplified model where the probability of a packet passing any given stage is independent of its history and the behavior of other stages.\n-   At stage $1$, every input is active, so every switch receives two packets. The fraction of packets passing stage $1$ is exactly $3/4$.\n-   The approximation assumes that for any subsequent stage $s$, the probability that a packet successfully traverses it is also $3/4$. This effectively assumes that every packet entering stage $s$ will face a competitor at its switch, which is not strictly true as some packets have already been blocked. A more precise analysis shows the throughput at stage $s$ is $p_s = p_{s-1} - p_{s-1}^2/4$, where $p_{s-1}$ is the throughput of the previous stage. For $s>1$, $p_{s-1}  1$, so the conditional probability of passing stage $s$, which is $1-p_{s-1}/4$, is actually greater than $3/4$.\nHowever, the statement describes the result of a *specific, named approximation method*. Under this simplified model—approximating the pass probability at each stage as $3/4$ independently—the total probability of a packet passing all $k$ stages is the product of the probabilities for each stage, which is $(3/4) \\times (3/4) \\times \\dots \\times (3/4) = (3/4)^k$. The statement is a correct description of the result obtained from this particular approximation.\n\nThus, statement A is **Correct**.\n\n**B. For $N = 8$ and the complement permutation $d(i) = 7 - i$ for inputs $i \\in \\{0,1,\\dots,7\\}$, every first-stage $2 \\times 2$ switch faces both inputs requesting the same output, so in any single slot with no internal buffering at most $4$ packets can reach any outputs.**\n\nLet's analyze this specific case. For $N=8$, $k=\\log_2 8 = 3$. The network has $N/2 = 4$ switches in the first stage. A standard Banyan assumes switch $j$ receives inputs $2j$ and $2j+1$. Routing at stage $1$ is based on the most significant bit (MSB) of the destination address. Let's convention be that MSB=$0$ selects the upper output and MSB=$1$ selects the lower output.\n\nWe map each input $i$ to its destination $d(i)=7-i$ and find the MSB of $d(i)$.\n-   Input $i=0$: $d(0)=7=(111)_2$. MSB is $1$.\n-   Input $i=1$: $d(1)=6=(110)_2$. MSB is $1$.\n-   Input $i=2$: $d(2)=5=(101)_2$. MSB is $1$.\n-   Input $i=3$: $d(3)=4=(100)_2$. MSB is $1$.\n-   Input $i=4$: $d(4)=3=(011)_2$. MSB is $0$.\n-   Input $i=5$: $d(5)=2=(010)_2$. MSB is $0$.\n-   Input $i=6$: $d(6)=1=(001)_2$. MSB is $0$.\n-   Input $i=7$: $d(7)=0=(000)_2$. MSB is $0$.\n\nNow, let's check the conflicts at the first-stage switches:\n-   Switch 0 (inputs $0, 1$): Packet from input $0$ has dest MSB=$1$. Packet from input $1$ has dest MSB=$1$. Both request the same output. **Conflict**.\n-   Switch 1 (inputs $2, 3$): Packet from input $2$ has dest MSB=$1$. Packet from input $3$ has dest MSB=$1$. Both request the same output. **Conflict**.\n-   Switch 2 (inputs $4, 5$): Packet from input $4$ has dest MSB=$0$. Packet from input $5$ has dest MSB=$0$. Both request the same output. **Conflict**.\n-   Switch 3 (inputs $6, 7$): Packet from input $6$ has dest MSB=$0$. Packet from input $7$ has dest MSB=$0$. Both request the same output. **Conflict**.\n\nThe first part of the statement, \"every first-stage $2 \\times 2$ switch faces both inputs requesting the same output,\" is true.\nDue to these conflicts, each of the $4$ switches can forward only one of its two input packets. The other is blocked. Therefore, a total of $4$ packets pass stage $1$, and $4$ packets are blocked.\nSince only $4$ packets emerge from stage $1$, a maximum of $4$ packets can possibly reach the final network outputs, regardless of what happens in subsequent stages. The conclusion \"at most $4$ packets can reach any outputs\" is correct.\n\nThus, statement B is **Correct**.\n\n**C. Prepending a Batcher sorting network that sorts packets by destination address before the Banyan eliminates internal blocking for permutation traffic in a single slot, so the combined sorter-plus-Banyan can deliver $N$ packets per slot for any permutation.**\n\nThis describes the classic Batcher-Banyan non-blocking switch architecture.\nA Banyan network is a blocking network; as shown in option B, certain permutations lead to internal conflicts.\nA Batcher sorting network is a non-blocking network capable of sorting its $N$ inputs based on a key. In this context, the key is the packet's destination address.\nThe Batcher network takes packets from arbitrary source ports and arranges them at its outputs such that the packet with the smallest destination address appears at output $0$, the next smallest at output $1$, and so on.\nThis sorted stream of packets is then fed into the Banyan network. It is a fundamental theorem in the theory of interconnection networks that a Banyan network (and its isomorphic variants like the Omega network) is non-blocking for any permutation whose destination addresses are monotonically sorted with respect to their input port addresses. The Batcher network enforces exactly this condition.\nBecause the inputs to the Banyan are sorted by destination, no two packets will ever conflict for an output link within any $2 \\times 2$ switch inside the Banyan. The entire Batcher-Banyan assembly can thus route any permutation without internal blocking.\nThe claim that this combined network \"can deliver $N$ packets per slot for any permutation\" is the direct consequence of this non-blocking property. A \"slot\" in this context refers to the time for a set of packets to pass through the entire network.\n\nThus, statement C is **Correct**.\n\n**D. For any permutation on $N = 2^{k}$ inputs, partitioning the packets into two disjoint sets based on the most significant destination bit (send those with a $0$ in that bit in slot $1$, those with a $1$ in slot $2$) always suffices to realize the full permutation over two slots on the plain Banyan without any additional hardware.**\n\nThis statement proposes a two-pass routing scheme to avoid conflicts. Let's test this proposal.\n-   In slot 1, all packets with destination MSB=$0$ are sent.\n-   In slot 2, all packets with destination MSB=$1$ are sent.\n\nThe scheme aims to prevent conflicts at stage $1$ between packets wanting the upper output (MSB=$0$) and packets wanting the lower output (MSB=$1$) by separating them in time. However, it does not prevent conflicts between packets that *both* want the upper output or *both* want the lower output.\nA conflict will occur in slot $1$ if two packets, both having destination MSB=$0$, are routed to the same first-stage switch.\nConsider the identity permutation $d(i)=i$ on an $N=4$ network ($k=2$).\n-   Destinations: $d(0)=0=(00)_2$, $d(1)=1=(01)_2$, $d(2)=2=(10)_2$, $d(3)=3=(11)_2$.\n-   Packets with destination MSB=$0$: from source $0$ (to dest $0$) and source $1$ (to dest $1$).\n-   Packets with destination MSB=$1$: from source $2$ (to dest $2$) and source $3$ (to dest $3$).\n\nAccording to the scheme, in slot $1$, packets from sources $0$ and $1$ are sent.\n-   Inputs $0$ and $1$ feed into the first-stage switch 0.\n-   The packet from source $0$ has destination $0$, MSB=$0$. It wants the upper output.\n-   The packet from source $1$ has destination $1$, MSB=$0$. It wants the upper output.\nBoth packets arrive at the same switch and request the same output. This causes a conflict, and one of the packets will be blocked.\nThe scheme fails to realize the permutation in two slots for this simple case. Since the statement claims it works for *any* permutation, this one counterexample is sufficient to invalidate it.\n\nThus, statement D is **Incorrect**.", "answer": "$$\\boxed{ABC}$$", "id": "3652356"}, {"introduction": "Modern data centers and high-performance computers require networks that are both highly scalable and robust. The folded-Clos topology, a variant of the classic Clos network, has emerged as a dominant architecture for this purpose by providing rich path diversity between endpoints. In this final practice, you will analyze the structure of a folded-Clos network to determine its pathing properties and explore how techniques like Equal-Cost Multi-Path (ECMP) routing leverage this diversity to balance traffic load and maximize throughput [@problem_id:3652394].", "problem": "A folded-Clos interconnection network is organized into two switch tiers: an edge tier and a spine tier. Consider a symmetric folded-Clos with the following structure. There are $P$ pods. Each pod contains $E$ edge switches, and each edge switch has $H$ host ports and $S$ uplinks, one to each of the $S$ spine switches. Each spine switch has exactly one downlink to every edge switch in every pod. Hosts connect only to edge switches; there are no direct links between edge switches, and there are no direct links between spine switches. Assume full bisection bandwidth wiring and that all links are identical and unidirectional pairs arranged as full-duplex links. Model the interconnection as an undirected graph where vertices are hosts and switches, and edges are physical links.\n\nUsing only the definition that the length of a path in a graph is the number of edges it contains, and the structural facts given above, do the following for two hosts $h_{s}$ and $h_{d}$ attached to edge switches in different pods:\n1. Derive the minimal link-hop count between $h_{s}$ and $h_{d}$.\n2. Derive the number $m$ of distinct equal-cost minimal paths between $h_{s}$ and $h_{d}$.\n3. Propose an Equal-Cost Multi-Path (ECMP) selection: for each flow identified by a key, compute a $b$-bit hash $h$ that is uniformly distributed over $\\{0,1,\\dots,2^{b}-1\\}$, and choose one of the $m$ minimal paths by selecting a spine index via $h \\bmod m$. For the specific parameters $S=12$ and $b=10$, compute the maximum selection probability that any particular spine is chosen by a single flow under this ECMP-like modulo selection, assuming an ideal uniform hash and that $m$ equals the number you derived in part $2$.\n\nProvide as your final answer only the value of this maximum probability as a reduced fraction. Do not include units. Do not round.", "solution": "The network is a symmetric folded-Clos with $P$ pods, $E$ edge switches per pod, and $S$ spine switches in total. Each edge switch has $H$ host ports and $S$ uplinks. A source host $h_s$ and a destination host $h_d$ are in different pods. Let $e_s$ be the edge switch connected to $h_s$, and $e_d$ be the edge switch connected to $h_d$. Since the hosts are in different pods, $e_s$ and $e_d$ are in different pods. The network is modeled as an undirected graph, and path length is the number of edges (hops).\n\n1.  Derivation of the minimal link-hop count:\n\nA path from $h_s$ to $h_d$ must traverse the network components.\n-   The first hop is from the host $h_s$ to its connected edge switch $e_s$. This path segment has length $1$.\n-   From $e_s$, the path must go upward to the spine tier, as there are no direct links between edge switches. Let the path go to some spine switch $sp_i$. This path segment, $e_s \\rightarrow sp_i$, has length $1$. The problem states that each edge switch has an uplink to each of the $S$ spine switches, so this link exists.\n-   From the spine switch $sp_i$, the path must go downward to an edge switch, as there are no direct links between spine switches. To reach $h_d$, the path must go to the edge switch $e_d$. The problem states that each spine switch has a downlink to every edge switch. Therefore, the link $sp_i \\rightarrow e_d$ exists. This path segment has length $1$.\n-   The final hop is from the edge switch $e_d$ to the destination host $h_d$. This path segment has length $1$.\n\nThe total constructed path is $h_s \\rightarrow e_s \\rightarrow sp_i \\rightarrow e_d \\rightarrow h_d$. The length of this path is the sum of the lengths of its segments: $1 + 1 + 1 + 1 = 4$.\n\nTo confirm this is the minimal path length, we must show no shorter path exists.\n-   A path of length $1$ or $2$ would imply $h_s$ and $h_d$ are connected to the same switch, but they are in different pods, which means their respective edge switches, $e_s$ and $e_d$, are different and in different pods. This is not possible.\n-   A path of length $3$ could take the form $h_s \\rightarrow e_s \\rightarrow \\text{switch} \\rightarrow h_d$ or $h_s \\rightarrow \\text{switch} \\rightarrow e_d \\rightarrow h_d$. The intermediate switch cannot be a host. If the path is $h_s \\rightarrow e_s \\rightarrow e_d \\rightarrow h_d$, it would require a direct link between edge switches $e_s$ and $e_d$. The problem explicitly states there are \"no direct links between edge switches\". If the path is $h_s \\rightarrow e_s \\rightarrow sp_i \\rightarrow h_d$, it would require a direct link between a spine switch and a host. The problem states \"Hosts connect only to edge switches\". Thus, a path of length $3$ is impossible.\n\nTherefore, the minimal link-hop count between $h_s$ and $h_d$ is $4$.\n\n2.  Derivation of the number of distinct equal-cost minimal paths:\n\nThe minimal path is of the form $h_s \\rightarrow e_s \\rightarrow sp_i \\rightarrow e_d \\rightarrow h_d$. For a given pair of hosts $(h_s, h_d)$, their respective edge switches $(e_s, e_d)$ are fixed. The first hop ($h_s \\rightarrow e_s$) and the last hop ($e_d \\rightarrow h_d$) are therefore unique for any path.\n\nThe variability in the path comes from the choice of the intermediate spine switch, $sp_i$. We need to count how many valid choices exist for $sp_i$.\n-   The link $e_s \\rightarrow sp_i$ must exist. The problem states: \"each edge switch has $S$ uplinks, one to each of the $S$ spine switches.\" This means $e_s$ is connected to all $S$ spine switches.\n-   The link $sp_i \\rightarrow e_d$ must exist. The problem states: \"Each spine switch has exactly one downlink to every edge switch in every pod.\" This means any of the $S$ spine switches is connected to $e_d$.\n\nSince any of the $S$ spine switches provides a valid intermediate hop, there are $S$ distinct paths of minimal length. Each path corresponds to a unique choice of spine switch. Thus, the number of distinct equal-cost minimal paths is $m = S$.\n\n3.  ECMP selection probability calculation:\n\nThe Equal-Cost Multi-Path (ECMP) selection rule is to choose one of the $m$ minimal paths by selecting a spine switch index via $k = h \\bmod m$. The hash $h$ is a $b$-bit integer, a random variable uniformly distributed over the set $\\{0, 1, \\dots, 2^b-1\\}$.\nThe specific parameters are $S=12$ and $b=10$.\n\nFrom part 2, the number of minimal paths is $m=S$. So, for this problem, $m=12$.\nThe total number of possible hash values is $N = 2^b = 2^{10} = 1024$.\nThe spine switch is selected based on the value of $h \\bmod 12$. The possible outcomes are $\\{0, 1, \\dots, 11\\}$.\n\nWe need to find the maximum probability that any particular spine is chosen. Let $P_k$ be the probability that spine $k$ is chosen, where $k \\in \\{0, 1, \\dots, 11\\}$.\n$$P_k = P(h \\bmod 12 = k) = \\frac{|\\{h \\mid 0 \\le h  N \\text{ and } h \\equiv k \\pmod{12}\\}|}{N}$$\nSince the hash value $h$ is uniformly distributed, we need to count how many of the $N=1024$ possible values of $h$ map to each remainder $k$ when divided by $12$.\n\nLet $N = qS + r$, where $q = \\lfloor N/S \\rfloor$ is the quotient and $r = N \\bmod S$ is the remainder, with $0 \\le r  S$.\nFor the given parameters: $N=1024$ and $S=12$.\n$1024 = q \\cdot 12 + r$.\n$1024 \\div 12 = 85$ with a remainder of $4$. So, $q=85$ and $r=4$.\n\nThe $N=1024$ hash values are $\\{0, 1, \\dots, 1023\\}$.\nThe first $qS = 85 \\times 12 = 1020$ hash values (from $0$ to $1019$) are distributed perfectly among the $12$ spine switches, with each spine being selected $q=85$ times.\nThe remaining $r=4$ hash values are $\\{1020, 1021, 1022, 1023\\}$.\nThese hash values, when taken modulo $12$, are $\\{0, 1, 2, 3\\}$.\nSo, the spine switches with indices $0, 1, 2, 3$ are selected one additional time.\n\n-   For $k \\in \\{0, 1, 2, 3\\}$, the number of hash values mapping to $k$ is $q+1 = 85+1 = 86$.\n-   For $k \\in \\{4, 5, \\dots, 11\\}$, the number of hash values mapping to $k$ is $q = 85$.\n\nThe probabilities are:\n-   $P_k = \\frac{86}{1024}$ for $k \\in \\{0, 1, 2, 3\\}$.\n-   $P_k = \\frac{85}{1024}$ for $k \\in \\{4, 5, \\dots, 11\\}$.\n\nThe maximum selection probability is $\\frac{86}{1024}$.\nThis can be expressed generally. The maximum number of hash values that can map to a single spine is $\\lceil N/S \\rceil$.\nFor $N=1024$ and $S=12$, $N/S = 1024/12 = 256/3 \\approx 85.333$.\n$\\lceil 1024/12 \\rceil = 86$.\nThe maximum probability is $\\frac{\\lceil N/S \\rceil}{N} = \\frac{86}{1024}$.\n\nThe final step is to reduce this fraction.\n$86 = 2 \\times 43$.\n$1024 = 2^{10}$.\n$$P_{max} = \\frac{86}{1024} = \\frac{2 \\times 43}{2^{10}} = \\frac{43}{2^9} = \\frac{43}{512}$$\nSince $43$ is a prime number and $512$ is a power of $2$, the fraction is fully reduced.", "answer": "$$\\boxed{\\frac{43}{512}}$$", "id": "3652394"}]}