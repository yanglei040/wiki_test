{"hands_on_practices": [{"introduction": "Before performing any arithmetic, we must first correctly interpret the data we receive. This exercise explores the fundamental relationship between a number's abstract value and its physical byte-level representation in memory [@problem_id:3641292]. By diagnosing a common 'endianness' mismatch, you will see how a simple byte-reversal can drastically alter a fixed-point value, reinforcing the importance of data format conventions in system design.", "problem": "A $32$-bit signed fixed-point field is communicated between a sensor and a host. The sensor encodes real values using two's complement $Qm.n$ with $m=7$ and $n=24$, so there are $1$ sign bit, $m=7$ integer bits, and $n=24$ fractional bits (total width $1+m+n=32$). The real value represented by a bit pattern with signed integer interpretation $I$ is $r=I/2^n$.\n\nDue to a mixed-endian implementation bug, the host reverses the order of the $4$ bytes in each received field before interpreting it, even though the sensor already sends bytes in the host's native order. In other words, the host applies a $4$-byte reversal to the transmitted $32$-bit pattern.\n\nTo diagnose the problem, you command the sensor to emit the exact real value $x=1$ (that is, the real number one). Let $y$ be the real value that the host computes from the byte-reversed $32$-bit pattern under the same $Q7.24$ interpretation.\n\nStarting only from the definitions above and bit-index reasoning, derive the ratio $y/x$ and show that it is a power of two. Let $s$ be the signed integer such that $y/x=2^s$. What is $s$?\n\nYour final answer must be the single integer $s$. No rounding is required.", "solution": "The problem requires the derivation of an integer $s$ such that the ratio of two fixed-point numbers, $y/x$, is equal to $2^s$. The value $x$ is the number encoded by a sensor, and $y$ is the number decoded by a host after a byte-reversal error. The number format is a $32$-bit signed two's complement $Qm.n$ representation with $m=7$ and $n=24$.\n\nFirst, we determine the $32$-bit binary representation for the real value $x=1$. In a fixed-point system, a real value $r$ is represented by a scaled integer $I$. The relationship is given by $r = I / 2^n$. For the $Q7.24$ format, the number of fractional bits is $n=24$.\nTo represent the real value $x=1$, we must find the corresponding integer $I_x$:\n$$x = \\frac{I_x}{2^{n}} \\implies 1 = \\frac{I_x}{2^{24}}$$\nSolving for $I_x$, we find:\n$$I_x = 2^{24}$$\nThe next step is to represent this integer, $I_x = 2^{24}$, in $32$-bit two's complement binary format. Let the bits of the $32$-bit word be indexed from $b_0$ (Least Significant Bit, LSB) to $b_{31}$ (Most Significant Bit, MSB). The integer value of a positive binary number is given by $\\sum_{k=0}^{30} b_k 2^k$. The value $2^{24}$ is represented by a word where only the bit at position $24$ is set to $1$, and all other bits are $0$.\nThe bit pattern, let's call it $W_x$, is:\n$$W_x = \\underbrace{0000000}_{b_{31}-b_{25}}1_{b_{24}}\\underbrace{000000000000000000000000}_{b_{23}-b_0}$$\nThe sign bit $b_{31}$ is $0$, which is consistent with a positive number.\n\nThis $32$-bit word is composed of four $8$-bit bytes. Let's denote the bytes from most significant to least significant as $B_3, B_2, B_1, B_0$.\n$B_3$ contains bits $b_{31}, b_{30}, \\ldots, b_{24}$.\n$B_2$ contains bits $b_{23}, b_{22}, \\ldots, b_{16}$.\n$B_1$ contains bits $b_{15}, b_{14}, \\ldots, b_8$.\n$B_0$ contains bits $b_7, b_6, \\ldots, b_0$.\n\nThe only non-zero bit in $W_x$ is $b_{24}$. This bit is the least significant bit of the most significant byte, $B_3$.\nThe values of the four bytes are:\n$$B_3 = (00000001)_2 = 1$$\n$$B_2 = (00000000)_2 = 0$$\n$$B_1 = (00000000)_2 = 0$$\n$$B_0 = (00000000)_2 = 0$$\n\nAccording to the problem, the host reverses the order of these four bytes. If the transmitted byte stream is conceptually $(B_3, B_2, B_1, B_0)$, the host reassembles them into a new $32$-bit word, $W_y$, with the byte order $(B_0, B_1, B_2, B_3)$.\nThe bytes of the new word $W_y$ are:\nNew most significant byte, $B'_3 = B_0 = (00000000)_2$.\nNew second byte, $B'_2 = B_1 = (00000000)_2$.\nNew third byte, $B'_1 = B_2 = (00000000)_2$.\nNew least significant byte, $B'_0 = B_3 = (00000001)_2$.\n\nThe resulting $32$-bit pattern $W_y$ in the host is:\n$$W_y = \\underbrace{00000000}_{B'_3}\\underbrace{00000000}_{B'_2}\\underbrace{00000000}_{B'_1}\\underbrace{00000001}_{B'_0}$$\nThis bit pattern has a single $1$ at the LSB position, $b_0$.\n\nThe host interprets this pattern $W_y$ to obtain an integer value $I_y$. Since the sign bit $b'_{31}$ is $0$, the number is positive. The integer value is:\n$$I_y = 1 \\cdot 2^0 = 1$$\nThe host then converts this integer $I_y$ to the real value $y$ using the same $Q7.24$ format:\n$$y = \\frac{I_y}{2^n} = \\frac{1}{2^{24}}$$\n\nWe are asked to find the ratio $y/x$. We have $x=1$ and $y=1/2^{24}$.\n$$\\frac{y}{x} = \\frac{1/2^{24}}{1} = \\frac{1}{2^{24}} = 2^{-24}$$\nThe problem states that this ratio is $2^s$. By equating the expressions, we get:\n$$2^s = 2^{-24}$$\nTherefore, the integer $s$ is $-24$.\nThe logic used relies solely on the definitions of fixed-point representation and the specified bit/byte manipulation, as required. The ratio is indeed a power of two.", "answer": "$$\\boxed{-24}$$", "id": "3641292"}, {"introduction": "Division is often a bottleneck in high-performance systems. This practice introduces a classic optimization: replacing costly division with a faster multiplication and bit-shift operation [@problem_id:3641212]. Your task is to derive the correct shift amount, which will give you direct experience with 'binary point tracking'—the essential process of managing scale factors throughout a fixed-point calculation to ensure a correctly scaled result.", "problem": "A digital signal processing pipeline replaces division by a positive constant with multiplication by a precomputed reciprocal, using signed fixed-point numbers in Two's Complement (TC) $Qm.n$ format. In $Qm.n$, a real value $v$ is represented by an integer $I$ such that $v = I \\cdot 2^{-n}$. Let $x$ be represented in $Qm_{x}.n_{x}$ with integer $I_{x}$, and let the reciprocal approximation $r \\approx 1/c$ be represented in $Qm_{r}.n_{r}$ with integer $I_{r}$. The target result $z = x/c$ is to be represented in $Qm_{z}.n_{z}$ with integer $I_{z}$. The hardware computes the integer product $P = I_{x} \\cdot I_{r}$ with full precision, then forms $J = \\operatorname{round}(P / 2^{s})$, where $\\operatorname{round}(\\cdot)$ denotes round-to-nearest with ties to even, and finally interprets $I_{z} = J$ as the output in $Qm_{z}.n_{z}$. Assume no overflow or saturation occurs and that the rounding mode has zero-mean error. For the special case where $r$ equals the exact reciprocal $1/c$, impose the unbiasedness requirement that the expected represented output equals the exact real result, namely $\\mathbb{E}[I_{z} \\cdot 2^{-n_{z}}] = x/c$, for every representable $x$.\n\nDerive, from first principles of fixed-point representation and rounding, a closed-form expression for the shift $s$ in terms of $n_{x}$, $n_{r}$, and $n_{z}$ that guarantees unbiasedness in the above sense. Your final answer must be a single analytic expression for $s$.", "solution": "We begin with the core definition of fixed-point $Qm.n$: a real value $v$ is represented by an integer $I$ according to $v = I \\cdot 2^{-n}$. For signed values in Two’s Complement (TC), the mapping between $I$ and $v$ is linear within the representable range, and multiplication of two fixed-point values corresponds to multiplication of their integers accompanied by additive exponents in the power of $2$ scale factor.\n\nLet $x$ be represented as $x = I_{x} \\cdot 2^{-n_{x}}$ in $Qm_{x}.n_{x}$, and let $r$ be represented as $r = I_{r} \\cdot 2^{-n_{r}}$ in $Qm_{r}.n_{r}$. Consider the exact real product when $r$ equals the exact reciprocal: since $r = 1/c$, the exact target is\n$$\nz = \\frac{x}{c} = x \\cdot r = \\left(I_{x} \\cdot 2^{-n_{x}}\\right) \\left(I_{r} \\cdot 2^{-n_{r}}\\right) = \\left(I_{x} I_{r}\\right) \\cdot 2^{-(n_{x} + n_{r})}.\n$$\nThe hardware computes the integer product $P = I_{x} I_{r}$, then forms\n$$\nJ = \\operatorname{round}\\!\\left(\\frac{P}{2^{s}}\\right).\n$$\nFinally, $J$ is interpreted in the target format $Qm_{z}.n_{z}$ as the output integer $I_{z} = J$, which corresponds to the represented real value\n$$\nz_{\\text{fp}} = I_{z} \\cdot 2^{-n_{z}} = J \\cdot 2^{-n_{z}}.\n$$\nUnder round-to-nearest with ties to even, the rounding error is zero-mean when considered over the fractional part distribution or tie-breaking randomness. Thus, for any deterministic $P$,\n$$\n\\mathbb{E}[J] = \\mathbb{E}\\!\\left[\\operatorname{round}\\!\\left(\\frac{P}{2^{s}}\\right)\\right] = \\frac{P}{2^{s}}.\n$$\nConsequently, the expected represented output is\n$$\n\\mathbb{E}[z_{\\text{fp}}] = \\mathbb{E}[J] \\cdot 2^{-n_{z}} = \\frac{P}{2^{s}} \\cdot 2^{-n_{z}} = \\left(I_{x} I_{r}\\right) \\cdot 2^{-(s + n_{z})}.\n$$\nFor unbiasedness with respect to the exact real result $z = \\left(I_{x} I_{r}\\right) \\cdot 2^{-(n_{x} + n_{r})}$ when $r = 1/c$, we require\n$$\n\\mathbb{E}[z_{\\text{fp}}] = z \\quad \\text{for all representable } x,\n$$\nwhich, because $I_{x} I_{r}$ factors cancel for arbitrary representable $I_{x}$ and $I_{r}$, reduces to the condition on the scaling exponents:\n$$\n2^{-(s + n_{z})} = 2^{-(n_{x} + n_{r})}.\n$$\nEquating exponents yields the necessary and sufficient condition\n$$\ns + n_{z} = n_{x} + n_{r} \\quad \\Longrightarrow \\quad s = n_{x} + n_{r} - n_{z}.\n$$\nThis shift $s$ ensures that, aside from zero-mean rounding noise, the represented result has the correct scale so that its expected value matches the exact division $x/c$ when $r$ is the exact reciprocal. If $r$ is an approximation to $1/c$, any residual bias arises from the approximation error in $r$ itself, not from the scaling, which the derived $s$ has made unbiased with respect to the ideal reciprocal.", "answer": "$$\\boxed{n_{x}+n_{r}-n_{z}}$$", "id": "3641212"}, {"introduction": "Fixed-point design is an art of compromise between range and precision. In this practical scenario, you will tackle the challenge of fitting a large dot product result into a limited-size register without losing too much accuracy [@problem_id:3641311]. You will determine an optimal scaling factor that satisfies both an overflow constraint and a numerical error budget, a core trade-off in designing efficient and reliable signal processing pipelines.", "problem": "Consider a fixed-point data path that stores scalar results in the two's complement (2C) fixed-point format $Qm.n$ with parameters $m=6$ and $n=10$. In the $Qm.n$ format, the representable values are integer multiples of the resolution $2^{-n}$, and the representable range is $[-2^{m}, 2^{m}-2^{-n}]$. A round-to-nearest rule is used when mapping real values to the $Qm.n$ grid.\n\nYou are given the dot product\n$$y=\\sum_{i=1}^{N} a_i b_i,$$\nwith $N=8$, $a_i \\in \\mathbb{Z}$, and $b_i \\in \\mathbb{Z}$ specified by\n$$[a_1,a_2,a_3,a_4,a_5,a_6,a_7,a_8]=[5,-7,3,12,-9,4,2,-6],$$\n$$[b_1,b_2,b_3,b_4,b_5,b_6,b_7,b_8]=[3,8,-11,5,-2,1,-4,9].$$\n\nTo store the result of the dot product in $Q6.10$ without overflow and later recover a scaled approximation of the original $y$, you may apply a real-valued scaling factor $s>0$ to the final sum before storage, i.e., store $y_s=\\operatorname{round}_{Q6.10}(s\\,y)$, and subsequently de-scale by $1/s$ to form $\\hat{y}=y_s/s$. The round-to-nearest mapping is to the nearest $Q6.10$ grid point.\n\nDetermine the largest scaling factor $s$ that simultaneously:\n- avoids overflow when storing $y_s$ in $Q6.10$, and\n- guarantees that the absolute de-scaled error $|\\hat{y}-y|$ does not exceed the bound $\\epsilon=8.0\\times 10^{-4}$.\n\nRound your final scaling factor to six significant figures. No physical units are required for the answer.", "solution": "The problem asks for the largest scaling factor $s$ that satisfies two conditions: avoiding overflow in a fixed-point representation and maintaining a specified error bound.\n\nFirst, we compute the exact value of the dot product $y = \\sum_{i=1}^{N} a_i b_i$.\nThe dimension is $N=8$, and the integer vectors are given as\n$[a_1, a_2, a_3, a_4, a_5, a_6, a_7, a_8] = [5, -7, 3, 12, -9, 4, 2, -6]$\n$[b_1, b_2, b_3, b_4, b_5, b_6, b_7, b_8] = [3, 8, -11, 5, -2, 1, -4, 9]$\nThe dot product calculation is:\n$$y = (5)(3) + (-7)(8) + (3)(-11) + (12)(5) + (-9)(-2) + (4)(1) + (2)(-4) + (-6)(9)$$\n$$y = 15 - 56 - 33 + 60 + 18 + 4 - 8 - 54$$\n$$y = (15 + 60 + 18 + 4) - (56 + 33 + 8 + 54) = 97 - 151$$\n$$y = -54$$\n\nNext, we establish the constraints on the scaling factor $s$. The fixed-point format is $Qm.n$ with $m=6$ and $n=10$. The resolution, which is the smallest positive value representable, is $\\Delta = 2^{-n} = 2^{-10}$.\n\nThe first constraint relates to the de-scaled error. The original value $y$ is scaled by $s$ to get $s \\cdot y$. This real value is then quantized to the nearest grid point in the $Q6.10$ format, yielding the stored value $y_s = \\operatorname{round}_{Q6.10}(s \\cdot y)$. The quantization error $E_q = y_s - s \\cdot y$ is bounded in magnitude by half the resolution for round-to-nearest: $|E_q| \\le \\frac{\\Delta}{2}$.\nThe de-scaled value is $\\hat{y} = y_s / s$. The de-scaled error is $|\\hat{y} - y|$. We can express this in terms of the quantization error:\n$$|\\hat{y} - y| = \\left| \\frac{y_s}{s} - y \\right| = \\left| \\frac{s \\cdot y + E_q}{s} - y \\right| = \\left| y + \\frac{E_q}{s} - y \\right| = \\frac{|E_q|}{s}$$\nUsing the bound for $|E_q|$, we get an upper bound on the de-scaled error:\n$$|\\hat{y} - y| \\le \\frac{\\Delta / 2}{s} = \\frac{\\Delta}{2s}$$\nThe problem requires this error to not exceed $\\epsilon = 8.0 \\times 10^{-4}$.\n$$\\frac{\\Delta}{2s} \\le \\epsilon$$\nSolving for $s$, we obtain a lower bound:\n$$s \\ge \\frac{\\Delta}{2\\epsilon} = \\frac{2^{-10}}{2 \\cdot (8.0 \\times 10^{-4})} = \\frac{2^{-10}}{1.6 \\times 10^{-3}} = \\frac{2^{-10}}{16 \\times 10^{-4}} = \\frac{2^{-10}}{2^4 \\times 10^{-4}} = \\frac{10^4}{2^{14}}$$\nSince $2^{14} = 16384$, the lower bound on $s$ is $s \\ge \\frac{10000}{16384} = 0.6103515625$.\n\nThe second constraint is the avoidance of overflow. The representable range for the $Q6.10$ format is $[-2^m, 2^m - 2^{-n}]$, which is $[-2^6, 2^6 - 2^{-10}]$, or $[-64, 64 - 2^{-10}]$. The stored value $y_s$ must fall within this range.\nTo guarantee that $y_s = \\operatorname{round}_{Q6.10}(s \\cdot y)$ is in range, the pre-quantized value $q = s \\cdot y$ must be such that it rounds to a valid number.\nThe minimum representable value is $V_{min} = -2^m = -64$. The maximum is $V_{max} = 2^m - \\Delta = 64 - 2^{-10}$.\nTo avoid negative overflow, $q$ must round to a value greater than or equal to $V_{min}$. This is guaranteed if $q \\ge V_{min} - \\frac{\\Delta}{2}$.\nTo avoid positive overflow, $q$ must round to a value less than or equal to $V_{max}$. This is guaranteed if $q \\le V_{max} + \\frac{\\Delta}{2}$.\nThus, the pre-quantized value must satisfy:\n$$V_{min} - \\frac{\\Delta}{2} \\le s \\cdot y \\le V_{max} + \\frac{\\Delta}{2}$$\n$$-2^m - \\frac{\\Delta}{2} \\le s \\cdot y \\le (2^m - \\Delta) + \\frac{\\Delta}{2}$$\n$$-2^m - \\frac{\\Delta}{2} \\le s \\cdot y \\le 2^m - \\frac{\\Delta}{2}$$\nSubstituting the values $y=-54$, $m=6$, and $\\Delta=2^{-10}$:\n$$-64 - \\frac{2^{-10}}{2} \\le -54s \\le 64 - \\frac{2^{-10}}{2}$$\n$$-64 - 2^{-11} \\le -54s \\le 64 - 2^{-11}$$\nSince $s > 0$, the term $-54s$ is negative, so the right-hand inequality ($-54s \\le 64 - 2^{-11}$) is always satisfied. The constraint on $s$ comes from the left-hand inequality:\n$$-64 - 2^{-11} \\le -54s$$\nMultiplying by $-1$ and reversing the inequality sign gives the upper bound for $s$:\n$$64 + 2^{-11} \\ge 54s \\implies s \\le \\frac{64 + 2^{-11}}{54}$$\n\nTo satisfy both conditions, $s$ must be in the interval $\\left[ \\frac{10^4}{2^{14}}, \\frac{64 + 2^{-11}}{54} \\right]$. We seek the largest possible value of $s$, which is the upper bound of this interval:\n$$s_{max} = \\frac{64 + 2^{-11}}{54}$$\nWe calculate this value:\n$$s_{max} = \\frac{64 + \\frac{1}{2048}}{54} = \\frac{\\frac{64 \\cdot 2048 + 1}{2048}}{54} = \\frac{131072 + 1}{2048 \\cdot 54} = \\frac{131073}{110592}$$\n$$s_{max} \\approx 1.18519422735...$$\nRounding this to six significant figures, we look at the seventh digit. The first six digits are $1.18519$. The seventh digit is $4$, so we round down.\n$$s_{max} \\approx 1.18519$$", "answer": "$$\\boxed{1.18519}$$", "id": "3641311"}]}