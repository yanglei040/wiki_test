{"hands_on_practices": [{"introduction": "Local conservation is a defining feature of Discontinuous Galerkin methods, ensuring that the change of a quantity within any element is perfectly balanced by the flux across its boundaries. This exercise [@problem_id:2385273] challenges you to explore the robustness of this principle through a thought experiment. By considering different numerical flux functions for the domain's interior and its boundary, you will determine if local conservation is an intrinsic property of the DG formulation itself, or if it depends on specific flux choices.", "problem": "Consider the scalar conservation law $u_t + \\nabla \\cdot \\boldsymbol{f}(u) = 0$ on a bounded domain $\\Omega \\subset \\mathbb{R}^d$, with appropriate boundary data on $\\partial \\Omega$. Let $\\Omega$ be partitioned into non-overlapping elements $\\{K\\}$ that form a conforming mesh. A discontinuous Galerkin (DG) semi-discretization is formed by seeking $u_h$ piecewise in a polynomial space on each $K$, multiplying the conservation law by a test function $v_h$ supported on $K$, integrating over $K$, and applying integration by parts on $K$. The boundary flux integral on each face is replaced by a single-valued numerical flux. On interior faces shared by two elements, a numerical flux function $\\widehat{\\boldsymbol{f}}_i(u_h^-, u_h^+, \\boldsymbol{n}^-)$ that depends on the traces from the two neighboring elements and the outward unit normal $\\boldsymbol{n}^-$ of the current element is used. On boundary faces, suppose one uses a possibly different flux function $\\widehat{\\boldsymbol{f}}_b(u_h, \\boldsymbol{n}, \\text{BC})$ that depends on the interior trace $u_h$, the outward unit normal $\\boldsymbol{n}$, and the boundary condition data, without requiring $\\widehat{\\boldsymbol{f}}_b$ to coincide with $\\widehat{\\boldsymbol{f}}_i$ specialized to a boundary state.\n\nFrom first principles, local conservation on an element $K$ refers to the statement that the time rate of change of the cell average of $u_h$ over $K$ equals the net numerical flux through $\\partial K$ (with signs taken via the outward normal of $K$). Specifically, it asks whether the semi-discrete scheme implies an exact balance of the form\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_K u_h \\,\\mathrm{d}\\boldsymbol{x} + \\int_{\\partial K} \\widehat{\\boldsymbol{f}}(u_h) \\cdot \\boldsymbol{n} \\,\\mathrm{d}s = 0,\n$$\nfor some single-valued choice of numerical flux $\\widehat{\\boldsymbol{f}}$ on each face of $\\partial K$.\n\nAssume that on every interior face a single numerical flux value $\\widehat{\\boldsymbol{f}}_i(u_h^-, u_h^+, \\boldsymbol{n}^-)$ is used consistently by both neighboring elements (with opposite normals), while on boundary faces a possibly different function $\\widehat{\\boldsymbol{f}}_b$ is used. There are no source terms.\n\nWhich statement best describes what happens to local conservation when the boundary flux integrals are computed with $\\widehat{\\boldsymbol{f}}_b \\neq \\widehat{\\boldsymbol{f}}_i$?\n\nA. Local conservation on every element $K$ is preserved exactly; the element-average evolution balances the sum of the single-valued numerical fluxes on $\\partial K$, with interior faces using $\\widehat{\\boldsymbol{f}}_i$ and boundary faces using $\\widehat{\\boldsymbol{f}}_b$. Interior-face cancellations underpin global conservation, which remains unaffected by using a different $\\widehat{\\boldsymbol{f}}_b$.\n\nB. Local conservation is violated on elements adjacent to $\\partial \\Omega$, because using $\\widehat{\\boldsymbol{f}}_b \\neq \\widehat{\\boldsymbol{f}}_i$ creates two different flux values on the same boundary face, preventing a conservative balance.\n\nC. Local conservation and global conservation both fail unless $\\widehat{\\boldsymbol{f}}_b$ coincides with $\\widehat{\\boldsymbol{f}}_i$; otherwise, the scheme cannot be conservative even in the element-average sense.\n\nD. Local conservation holds on interior elements but fails on boundary-adjacent elements because the element-average update includes an extra residual that cannot be written as a boundary flux when $\\widehat{\\boldsymbol{f}}_b \\neq \\widehat{\\boldsymbol{f}}_i$.", "solution": "The problem statement is subjected to validation.\n\n### Step 1: Extract Givens\n-   **Governing Equation**: Scalar conservation law $u_t + \\nabla \\cdot \\boldsymbol{f}(u) = 0$ on a bounded domain $\\Omega \\subset \\mathbb{R}^d$.\n-   **Discretization**: Domain $\\Omega$ partitioned into non-overlapping elements $\\{K\\}$ of a conforming mesh.\n-   **Approximation Space**: The solution $u_h$ is sought piecewise in a polynomial space on each element $K$.\n-   **Weak Formulation**: The DG semi-discretization is obtained by multiplying the PDE by a test function $v_h$ from the same polynomial space, integrating over an element $K$, and applying integration by parts.\n-   **Interior Numerical Flux**: On an interior face shared by two elements, a single-valued numerical flux function $\\widehat{\\boldsymbol{f}}_i(u_h^-, u_h^+, \\boldsymbol{n}^-)$ is used. This flux is used consistently by both neighboring elements.\n-   **Boundary Numerical Flux**: On a boundary face, a possibly different numerical flux function $\\widehat{\\boldsymbol{f}}_b(u_h, \\boldsymbol{n}, \\text{BC})$ is used.\n-   **Condition Under Study**: The case where the boundary flux function is not the same as the interior flux function, i.e., $\\widehat{\\boldsymbol{f}}_b \\neq \\widehat{\\boldsymbol{f}}_i$.\n-   **Definition of Local Conservation**: A scheme satisfies local conservation on an element $K$ if the following exact balance holds:\n    $$\n    \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_K u_h \\,\\mathrm{d}\\boldsymbol{x} + \\int_{\\partial K} \\widehat{\\boldsymbol{f}}(u_h) \\cdot \\boldsymbol{n} \\,\\mathrm{d}s = 0,\n    $$\n    where $\\widehat{\\boldsymbol{f}}$ is a single-valued numerical flux on each face of the element boundary $\\partial K$.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientific Grounding**: The problem is correctly framed within the established theory of discontinuous Galerkin methods for hyperbolic conservation laws, a standard topic in numerical analysis and computational engineering. All concepts are scientifically sound.\n-   **Well-Posedness**: The question is specific and answerable through a direct derivation from the principles of the DG method. It asks for the consequence of a particular, well-defined choice in the numerical scheme.\n-   **Objectivity**: The problem is stated using precise, objective, and standard mathematical terminology.\n-   **Flaw Assessment**: The problem setup is self-contained, consistent, and free of scientific fallacies or ambiguities. The condition $\\widehat{\\boldsymbol{f}}_b \\neq \\widehat{\\boldsymbol{f}}_i$ is a valid scenario in the implementation of DG schemes and does not represent a contradiction.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid**. A solution will be derived.\n\n### Derivation\nThe discontinuous Galerkin (DG) semi-discrete formulation for the conservation law $u_t + \\nabla \\cdot \\boldsymbol{f}(u) = 0$ on an element $K$ is: Find $u_h$ in the approximation space $V_h(K)$ such that for all test functions $v_h \\in V_h(K)$,\n$$\n\\int_K \\frac{\\partial u_h}{\\partial t} v_h \\, \\mathrm{d}\\boldsymbol{x} + \\int_K (\\nabla \\cdot \\boldsymbol{f}(u_h)) v_h \\, \\mathrm{d}\\boldsymbol{x} = 0.\n$$\nApplying integration by parts (the divergence theorem) to the second term gives:\n$$\n\\int_K \\frac{\\partial u_h}{\\partial t} v_h \\, \\mathrm{d}\\boldsymbol{x} - \\int_K \\boldsymbol{f}(u_h) \\cdot \\nabla v_h \\, \\mathrm{d}\\boldsymbol{x} + \\int_{\\partial K} \\boldsymbol{f}(u_h) \\cdot \\boldsymbol{n} \\, v_h \\, \\mathrm{d}s = 0.\n$$\nIn the DG method, the boundary flux $\\boldsymbol{f}(u_h) \\cdot \\boldsymbol{n}$ is replaced by a numerical flux $\\widehat{\\boldsymbol{f}} \\cdot \\boldsymbol{n}$, which is single-valued on each face. The formulation becomes:\n$$\n\\int_K \\frac{\\partial u_h}{\\partial t} v_h \\, \\mathrm{d}\\boldsymbol{x} - \\int_K \\boldsymbol{f}(u_h) \\cdot \\nabla v_h \\, \\mathrm{d}\\boldsymbol{x} + \\int_{\\partial K} (\\widehat{\\boldsymbol{f}} \\cdot \\boldsymbol{n}) v_h \\, \\mathrm{d}s = 0.\n$$\nHere, on any face $e \\subset \\partial K$, the flux $\\widehat{\\boldsymbol{f}}$ is specified as $\\widehat{\\boldsymbol{f}}_i$ for interior faces and $\\widehat{\\boldsymbol{f}}_b$ for boundary faces.\n\nLocal conservation, as defined in the problem, concerns the evolution of the cell average of $u_h$. The cell average is $\\bar{u}_K(t) = \\frac{1}{|K|} \\int_K u_h(\\boldsymbol{x},t) \\, \\mathrm{d}\\boldsymbol{x}$, where $|K|$ is the measure (area or volume) of element $K$. To obtain an equation for the evolution of $\\int_K u_h \\, \\mathrm{d}\\boldsymbol{x}$, we select a specific test function, $v_h(\\boldsymbol{x}) = 1$ for all $\\boldsymbol{x} \\in K$. This is a valid choice as the polynomial approximation space is assumed to contain constants (i.e., polynomials of degree $k \\geq 0$).\n\nSubstituting $v_h = 1$ into the DG weak form:\n1.  The first term becomes $\\int_K \\frac{\\partial u_h}{\\partial t} \\cdot 1 \\, \\mathrm{d}\\boldsymbol{x} = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_K u_h \\, \\mathrm{d}\\boldsymbol{x}$.\n2.  The second term involves $\\nabla v_h = \\nabla(1) = \\boldsymbol{0}$, so $\\int_K \\boldsymbol{f}(u_h) \\cdot \\boldsymbol{0} \\, \\mathrm{d}\\boldsymbol{x} = 0$.\n3.  The third term becomes $\\int_{\\partial K} (\\widehat{\\boldsymbol{f}} \\cdot \\boldsymbol{n}) \\cdot 1 \\, \\mathrm{d}s$.\n\nThe weak formulation thus simplifies to:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_K u_h \\, \\mathrm{d}\\boldsymbol{x} - 0 + \\int_{\\partial K} \\widehat{\\boldsymbol{f}} \\cdot \\boldsymbol{n} \\, \\mathrm{d}s = 0,\n$$\nwhich is precisely the statement of local conservation given in the problem:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_K u_h \\, \\mathrm{d}\\boldsymbol{x} + \\int_{\\partial K} \\widehat{\\boldsymbol{f}} \\cdot \\boldsymbol{n} \\, \\mathrm{d}s = 0.\n$$\nThis derivation is valid for **any** element $K$, whether it is in the interior of the domain $\\Omega$ or adjacent to the boundary $\\partial\\Omega$. It is a direct consequence of testing the DG formulation with a constant function. The result demonstrates that the time rate of change of the total amount of the quantity $u_h$ in an element $K$ is exactly balanced by the total numerical flux through its boundary $\\partial K$. This property is inherent to the construction of the DG scheme. The specific functional forms of the numerical fluxes, $\\widehat{\\boldsymbol{f}}_i$ and $\\widehat{\\boldsymbol{f}}_b$, and the condition $\\widehat{\\boldsymbol{f}}_b \\neq \\widehat{\\boldsymbol{f}}_i$, do not alter this fundamental balance.\n\n### Option-by-Option Analysis\n\n**A. Local conservation on every element K is preserved exactly; the element-average evolution balances the sum of the single-valued numerical fluxes on $\\partial K$, with interior faces using $\\widehat{\\boldsymbol{f}}_i$ and boundary faces using $\\widehat{\\boldsymbol{f}}_b$. Interior-face cancellations underpin global conservation, which remains unaffected by using a different $\\widehat{\\boldsymbol{f}}_b$.**\nThis statement is correct. Our derivation shows that local conservation holds exactly on every element $K$. The element-average evolution is balanced by the net numerical flux, where fluxes are computed using $\\widehat{\\boldsymbol{f}}_i$ and $\\widehat{\\boldsymbol{f}}_b$ on the respective faces. Global conservation is obtained by summing the local conservation laws over all elements $K$. The consistency of the interior flux $\\widehat{\\boldsymbol{f}}_i$ ensures that flux contributions over all interior faces cancel out, leaving only the sum of fluxes over the domain boundary $\\partial\\Omega$. This structure is independent of the choice of $\\widehat{\\boldsymbol{f}}_b$, which merely defines the flux through $\\partial\\Omega$.\n**Verdict: Correct.**\n\n**B. Local conservation is violated on elements adjacent to $\\partial \\Omega$, because using $\\widehat{\\boldsymbol{f}}_b \\neq \\widehat{\\boldsymbol{f}}_i$ creates two different flux values on the same boundary face, preventing a conservative balance.**\nThis statement is incorrect. As derived, local conservation holds for *all* elements, including those adjacent to the boundary. The reasoning provided is fallacious. A boundary face is adjacent to only one element within the domain. There is no second, competing flux value on that face. The flux is uniquely determined by $\\widehat{\\boldsymbol{f}}_b$. The condition $\\widehat{\\boldsymbol{f}}_b \\neq \\widehat{\\boldsymbol{f}}_i$ only means different functions are used for different types of faces, not that two values exist on one face.\n**Verdict: Incorrect.**\n\n**C. Local conservation and global conservation both fail unless $\\widehat{\\boldsymbol{f}}_b$ coincides with $\\widehat{\\boldsymbol{f}}_i$; otherwise, the scheme cannot be conservative even in the element-average sense.**\nThis statement is incorrect. Local conservation holds regardless of the relationship between $\\widehat{\\boldsymbol{f}}_b$ and $\\widehat{\\boldsymbol{f}}_i$. Global conservation also holds, as it relies on the cancellation of interior fluxes, which is a property of $\\widehat{\\boldsymbol{f}}_i$ alone. The condition $\\widehat{\\boldsymbol{f}}_b = \\widehat{\\boldsymbol{f}}_i$ (applied with a ghost state for the boundary) is a form of consistency, but it is not a prerequisite for conservation in the element-average sense.\n**Verdict: Incorrect.**\n\n**D. Local conservation holds on interior elements but fails on boundary-adjacent elements because the element-average update includes an extra residual that cannot be written as a boundary flux when $\\widehat{\\boldsymbol{f}}_b \\neq \\widehat{\\boldsymbol{f}}_i$.**\nThis statement is incorrect. It correctly states that local conservation holds on interior elements but wrongly claims it fails on boundary-adjacent elements. Our derivation shows it holds for all elements. The reasoning is also flawed; the element-average update, derived from the weak form with $v_h=1$, contains no \"extra residual.\" The entire balance is between the time derivative of the cell average and the integral of the numerical flux over the boundary, as shown in the derivation.\n**Verdict: Incorrect.**", "answer": "$$\\boxed{A}$$", "id": "2385273"}, {"introduction": "Having established the inherent local conservation of DG schemes, we now turn to a practical demonstration of what happens when this principle is deliberately violated. This coding exercise [@problem_id:2385236] asks you to implement a scheme with an intentionally non-conservative numerical flux. By measuring the change in the total \"mass\" of the system over time, you will gain a tangible understanding of why flux consistency is critical and directly observe the numerical creation or destruction of the conserved quantity.", "problem": "Consider the scalar conservation law in one spatial dimension,\n$$\n\\partial_t u(x,t) + \\partial_x f\\big(u(x,t)\\big) = 0,\n$$\nposed on the periodic domain $[0,L]$ with period $L$. Let the physical flux be $f(u)=a\\,u$, with constant advection speed $a0$. Discretize the domain into $N$ uniform cells of width $h=L/N$, and approximate $u$ by piecewise constant cell averages. Initialize with\n$$\nu(x,0) = 1 + 0.2 \\sin\\!\\big(2\\pi x/L\\big),\n$$\nwhere angles are in radians. Evolve the cell averages by an explicit forward Euler time integrator from $t=0$ to $t=T$, using the following intentionally non-conservative interface flux pair at each inter-cell interface with left and right traces $u_L$ and $u_R$:\n$$\n\\widehat{F}^{-}(u_L,u_R) = a\\,u_L - \\varepsilon,\\qquad\n\\widehat{F}^{+}(u_L,u_R) = a\\,u_L + \\varepsilon,\n$$\nwhere $\\varepsilon$ is a real parameter. Use $\\widehat{F}^{-}$ only on the right face of a cell (the interface where the current cell is the left state), and use $\\widehat{F}^{+}$ only on the left face of a cell (the interface where the current cell is the right state). With these definitions, the semi-discrete update for cell $i$ with periodic indexing is\n$$\n\\frac{d}{dt}\\,\\bar{u}_i(t) \\;=\\; -\\frac{1}{h}\\left[\\,\\widehat{F}^{-}\\big(\\bar{u}_i,\\bar{u}_{i+1}\\big)\\;-\\;\\widehat{F}^{+}\\big(\\bar{u}_{i-1},\\bar{u}_i\\big)\\,\\right],\n$$\nand the forward Euler step is\n$$\n\\bar{u}_i^{n+1} \\;=\\; \\bar{u}_i^{n} \\;-\\; \\frac{\\Delta t}{h}\\left[\\,\\widehat{F}^{-}\\big(\\bar{u}_i^{n},\\bar{u}_{i+1}^{n}\\big)\\;-\\;\\widehat{F}^{+}\\big(\\bar{u}_{i-1}^{n},\\bar{u}_i^{n}\\big)\\,\\right].\n$$\nChoose the time step by the Courant–Friedrichs–Lewy (CFL) condition with a user-specified constant $\\mathrm{CFL}\\in(0,1]$:\n$$\n\\Delta t \\le \\mathrm{CFL}\\,\\frac{h}{a}.\n$$\nDefine the discrete total mass at time $t^n$ as\n$$\nM^n = \\sum_{i=0}^{N-1} \\bar{u}_i^{n}\\,h,\n$$\nand define the measured mass-creation rate over $[0,T]$ as the time-averaged quantity\n$$\nR = \\frac{M^N - M^0}{T}.\n$$\nImplement the above and, for each test case, output the measured rate $R$ as a floating-point number.\n\nUse the following fixed parameters: $L=1$, $a=1$, $T=0.2$, and $\\mathrm{CFL}=0.9$. The test suite to be run consists of the four $(N,\\varepsilon)$ pairs:\n- $(20,\\,0.05)$,\n- $(20,\\,-0.05)$,\n- $(50,\\,0.01)$,\n- $(37,\\,0.0)$.\n\nYour program should produce a single line of output containing the four measured rates corresponding to these test cases, as a comma-separated list enclosed in square brackets (e.g., \"[r1,r2,r3,r4]\"), with each entry being a floating-point number.", "solution": "The problem statement has been critically examined and is determined to be valid. It presents a well-posed numerical experiment in computational engineering, designed to investigate the properties of an intentionally non-conservative finite volume scheme for a scalar conservation law. The problem is scientifically grounded, objective, and contains all necessary information to proceed with a unique and meaningful solution. The minor ambiguity regarding the exact time-stepping procedure to reach the final time $T$ is a common detail in numerical implementations, and a standard, rigorous approach will be adopted. The notation $M^N$ is interpreted as a typographical error for the mass at the final time, $M(T)$.\n\nThe core of the problem is to quantify the mass generation or destruction caused by a non-conservative numerical flux. A theoretical analysis must precede the numerical implementation.\n\nLet us analyze the semi-discrete scheme provided for the cell average $\\bar{u}_i$:\n$$\n\\frac{d}{dt}\\,\\bar{u}_i(t) \\;=\\; -\\frac{1}{h}\\left[\\,\\widehat{F}^{-}\\big(\\bar{u}_i,\\bar{u}_{i+1}\\big)\\;-\\;\\widehat{F}^{+}\\big(\\bar{u}_{i-1},\\bar{u}_i\\big)\\,\\right]\n$$\nThe numerical fluxes are defined as $\\widehat{F}^{-}(u_L,u_R) = a\\,u_L - \\varepsilon$ and $\\widehat{F}^{+}(u_L,u_R) = a\\,u_L + \\varepsilon$. The flux on the right face of cell $i$ (interface $i+1/2$) uses the left state $\\bar{u}_i$ and the right state $\\bar{u}_{i+1}$. The flux on the left face of cell $i$ (interface $i-1/2$) uses the left state $\\bar{u}_{i-1}$ and the right state $\\bar{u}_i$.\nSubstituting the specific flux definitions:\n- The flux at the right face, $i+1/2$, is $\\widehat{F}^{-}\\big(\\bar{u}_i,\\bar{u}_{i+1}\\big) = a\\,\\bar{u}_i - \\varepsilon$.\n- The flux at the left face, $i-1/2$, is $\\widehat{F}^{+}\\big(\\bar{u}_{i-1},\\bar{u}_i\\big) = a\\,\\bar{u}_{i-1} + \\varepsilon$.\n\nThe semi-discrete equation for cell $i$ becomes:\n$$\n\\frac{d}{dt}\\,\\bar{u}_i(t) \\;=\\; -\\frac{1}{h}\\left[ (a\\,\\bar{u}_i - \\varepsilon) - (a\\,\\bar{u}_{i-1} + \\varepsilon) \\right] \\;=\\; -\\frac{a}{h}(\\bar{u}_i - \\bar{u}_{i-1}) + \\frac{2\\varepsilon}{h}\n$$\nThis reveals that the scheme is equivalent to a standard first-order upwind discretization of the advection term $\\partial_x f(u) = a \\partial_x u$ (since $a0$, the upwind information comes from cell $i-1$), supplemented by a constant source term of $\\frac{2\\varepsilon}{h}$.\n\nThe primary task is to find the rate of change of total mass, $M(t) = \\sum_{i=0}^{N-1} \\bar{u}_i(t)\\,h$. Let us compute its time derivative:\n$$\n\\frac{dM}{dt} = \\frac{d}{dt} \\sum_{i=0}^{N-1} \\bar{u}_i(t)\\,h = h \\sum_{i=0}^{N-1} \\frac{d\\bar{u}_i}{dt}\n$$\nSubstituting the expression for $\\frac{d\\bar{u}_i}{dt}$:\n$$\n\\frac{dM}{dt} = h \\sum_{i=0}^{N-1} \\left( -\\frac{a}{h}(\\bar{u}_i - \\bar{u}_{i-1}) + \\frac{2\\varepsilon}{h} \\right) = -a \\sum_{i=0}^{N-1} (\\bar{u}_i - \\bar{u}_{i-1}) + \\sum_{i=0}^{N-1} 2\\varepsilon\n$$\nThe first summation, $\\sum_{i=0}^{N-1} (\\bar{u}_i - \\bar{u}_{i-1})$, is a telescoping series. Due to the periodic boundary conditions, where $\\bar{u}_{-1} = \\bar{u}_{N-1}$, this sum is identically zero.\nThe second summation is over $N$ identical terms: $\\sum_{i=0}^{N-1} 2\\varepsilon = 2N\\varepsilon$.\nTherefore, the rate of change of total mass is constant and given by:\n$$\n\\frac{dM}{dt} = 2N\\varepsilon\n$$\nThis is a powerful analytical result. It shows that the mass of the system changes linearly with time. Integrating from $t=0$ to $t=T$ gives:\n$$\nM(T) - M(0) = \\int_0^T (2N\\varepsilon) \\, dt = 2N\\varepsilon T\n$$\nThe problem defines the measured mass-creation rate $R$ as $R = \\frac{M(T) - M(0)}{T}$. From our derivation, this yields a simple, exact expression:\n$$\nR = \\frac{2N\\varepsilon T}{T} = 2N\\varepsilon\n$$\nThis result is independent of the initial data, the advection speed $a$, the cell width $h$ (as long as $N$ is fixed), the CFL number, and the details of the time integration scheme, provided the scheme correctly integrates the constant source term. The numerical simulation is thus a verification of this theoretical result.\n\nThe algorithm to implement is as follows:\n1.  For each test case with parameters $(N, \\varepsilon)$, set the global parameters $L=1$, $a=1$, $T=0.2$, and $\\mathrm{CFL}=0.9$.\n2.  Define the spatial grid. The domain $[0,L]$ is divided into $N$ cells. Cell $i$ spans the interval $[i h, (i+1)h]$, where $h=L/N$.\n3.  Calculate the initial cell averages $\\bar{u}_i(0)$. This requires integrating the initial condition $u(x,0) = 1 + 0.2 \\sin(2\\pi x/L)$ over each cell:\n    $$\n    \\bar{u}_i(0) = \\frac{1}{h} \\int_{ih}^{(i+1)h} \\left(1 + 0.2 \\sin\\left(\\frac{2\\pi x}{L}\\right)\\right) dx = 1 - \\frac{0.2 L}{2\\pi h} \\left[ \\cos\\left(\\frac{2\\pi(i+1)h}{L}\\right) - \\cos\\left(\\frac{2\\pi ih}{L}\\right) \\right]\n    $$\n4.  Calculate the initial total mass $M^0 = h \\sum_{i=0}^{N-1} \\bar{u}_i(0)$.\n5.  Set the time step $\\Delta t = \\mathrm{CFL} \\frac{h}{a}$.\n6.  Evolve the solution from $t=0$ to $t=T$. A fixed time step $\\Delta t$ is used for as many full steps as possible. A final, smaller step is taken to land exactly at $t=T$. The `Forward Euler` update is:\n    $$\n    \\bar{u}_i^{n+1} = \\bar{u}_i^{n} + \\Delta t \\left( -\\frac{a}{h}(\\bar{u}_i^n - \\bar{u}_{i-1}^n) + \\frac{2\\varepsilon}{h} \\right)\n    $$\n    This is applied for each time step, respecting the periodic boundary condition $\\bar{u}_{-1}^n = \\bar{u}_{N-1}^n$. This update can be efficiently vectorized.\n7.  After evolving to $t=T$, calculate the final total mass $M^T = h \\sum_{i=0}^{N-1} \\bar{u}_i(T)$.\n8.  Compute the measured mass-creation rate $R = \\frac{M^T - M^0}{T}$.\n9.  The results for all test cases are collected and printed in the specified format. The numerical results are expected to match the analytical prediction $R=2N\\varepsilon$ to within floating-point precision.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the given problem for a set of test cases.\n    It simulates a 1D linear advection equation with a non-conservative\n    numerical scheme and calculates the rate of mass creation.\n    \"\"\"\n\n    # Define fixed parameters from the problem statement.\n    L = 1.0\n    a = 1.0\n    T = 0.2\n    CFL = 0.9\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (20, 0.05),\n        (20, -0.05),\n        (50, 0.01),\n        (37, 0.0),\n    ]\n\n    results = []\n    for N, epsilon in test_cases:\n        # 1. Discretization parameters\n        h = L / N\n        dt = CFL * h / a\n\n        # 2. Initial condition: cell averages\n        # u(x,0) = 1 + 0.2 * sin(2*pi*x/L)\n        # We need the integral of u(x,0) over each cell.\n        # The antiderivative of u(x,0) is x - 0.2 * (L/(2*pi)) * cos(2*pi*x/L)\n        x_boundaries = np.linspace(0.0, L, N + 1)\n        \n        # Vectorized calculation of initial cell averages\n        # integral_u(x) = x - (0.2*L/(2*pi)) * cos(2*pi*x/L)\n        antiderivative_vals = x_boundaries - 0.2 * (L / (2.0 * np.pi)) * np.cos(2.0 * np.pi * x_boundaries / L)\n        # The integral over cell i is integral_u(x_{i+1}) - integral_u(x_i)\n        u0 = np.diff(antiderivative_vals) / h\n        \n        # 3. Initial mass calculation\n        M0 = np.sum(u0) * h\n\n        # 4. Time evolution using Forward Euler\n        u = u0.copy()\n        current_time = 0.0\n\n        num_steps = int(T / dt)\n        \n        # Vectorized update terms\n        advection_coeff = -a / h\n        source_term = 2.0 * epsilon / h\n\n        # Main time loop for full steps\n        for _ in range(num_steps):\n            u_prev = np.roll(u, 1)\n            dudt = advection_coeff * (u - u_prev) + source_term\n            u += dt * dudt\n            current_time += dt\n\n        # Take one final partial step to reach T exactly\n        last_dt = T - current_time\n        if last_dt  1e-12: # Tolerance for floating point inaccuracy\n            u_prev = np.roll(u, 1)\n            dudt = advection_coeff * (u - u_prev) + source_term\n            u += last_dt * dudt\n\n        # 5. Final mass calculation\n        M_final = np.sum(u) * h\n\n        # 6. Measured mass-creation rate\n        R = (M_final - M0) / T\n        results.append(R)\n\n    # Final print statement in the exact required format.\n    # The format specifier ensures standard float representation.\n    print(f\"[{','.join(f'{r:.15f}' for r in results)}]\")\n\nsolve()\n```", "id": "2385236"}, {"introduction": "Beyond conservation, ensuring stability is paramount, especially when simulating solutions with sharp gradients or discontinuities. This is the role of slope limiters, which prevent the growth of spurious oscillations. This exercise [@problem_id:2385285] presents a conceptual deep dive into the logic of limiters by proposing the replacement of a standard `minmod` limiter with a hypothetical `maxmod` function. Analyzing the consequences of this change will illuminate why limiters are fundamentally diffusive and what happens when a scheme becomes \"anti-diffusive\" and nonlinearly unstable.", "problem": "Consider the one-dimensional scalar conservation law $u_t + f(u)_x = 0$ on a periodic domain $x \\in [0,1]$ with a uniform mesh of $N$ cells of size $h = 1/N$, constant advection speed $a  0$, and an upwind numerical flux consistent with $f(u) = a u$. A piecewise-linear discontinuous Galerkin (DG) discretization is used with cellwise linear reconstructions. To control spurious oscillations, a slope limiter is applied to each cell $i$ by replacing the raw DG slope $\\sigma_i^{\\mathrm{raw}}$ with a limited slope $\\sigma_i = \\phi(v_1,v_2,v_3)$ constructed from the three arguments $v_1 = \\theta \\,(u_i - u_{i-1})/h$, $v_2 = \\frac{1}{2}\\,(u_{i+1} - u_{i-1})/h$, and $v_3 = \\theta \\,(u_{i+1} - u_i)/h$, where $\\theta \\in [1,2]$ and $u_i$ denotes the cell average in cell $i$. The limiter function is the classical $\\mathrm{minmod}$ function\n$$\n\\mathrm{minmod}(v_1,v_2,v_3) = \n\\begin{cases}\n\\mathrm{sign}(v_1)\\,\\min\\{|v_1|,|v_2|,|v_3|\\},  \\text{if } \\mathrm{sign}(v_1) = \\mathrm{sign}(v_2) = \\mathrm{sign}(v_3),\\\\\n0,  \\text{otherwise},\n\\end{cases}\n$$\nknown to enforce monotonicity and bound total variation under Courant–Friedrichs–Lewy (CFL) conditions with Strong Stability Preserving (SSP) time stepping.\n\nSuppose instead that the limiter is modified by replacing $\\mathrm{minmod}$ with the $\\mathrm{maxmod}$ function\n$$\n\\mathrm{maxmod}(v_1,v_2,v_3) = \n\\begin{cases}\n\\mathrm{sign}(v_1)\\,\\max\\{|v_1|,|v_2|,|v_3|\\},  \\text{if } \\mathrm{sign}(v_1) = \\mathrm{sign}(v_2) = \\mathrm{sign}(v_3),\\\\\n0,  \\text{otherwise}.\n\\end{cases}\n$$\nAssume explicit time integration by a Strong Stability Preserving Runge–Kutta method of order $2$ with time step $\\Delta t$ satisfying a standard CFL condition $a\\,\\Delta t/h \\le 1$.\n\nWhich statement best characterizes the effect of using $\\mathrm{maxmod}$ in place of $\\mathrm{minmod}$ on the nonlinear stability of the DG method for discontinuous data (for example, a square wave initial condition), keeping all other components unchanged?\n\nA. The limiter becomes anti-diffusive: the total variation increases with time even under CFL-compliant time steps, leading to growing Gibbs-type oscillations near discontinuities, overshoots/undershoots that violate a maximum principle, and possible blow-up in $L^\\infty$.\n\nB. The method remains total variation diminishing (TVD) but produces sharper, nonoscillatory shocks and strictly reduced numerical diffusion compared to $\\mathrm{minmod}$.\n\nC. The method becomes more diffusive but unconditionally stable, effectively reverting to first order everywhere and suppressing oscillations.\n\nD. The method remains linearly stable in the $L^2$ norm for all CFL numbers $a\\,\\Delta t/h \\le 1$, exhibiting only a benign phase error without growth of spurious oscillations near discontinuities.", "solution": "The problem statement describes a piecewise-linear discontinuous Galerkin (DG) method for the scalar linear advection equation, $u_t + (au)_x = 0$. The core of the question is the replacement of a standard monotonicity-preserving slope limiter, the $\\mathrm{minmod}$ function, with a non-standard function, $\\mathrm{maxmod}$. We must analyze the consequence of this modification on the nonlinear stability of the numerical scheme.\n\nLet us begin with a formal validation of the problem statement.\n\n**Step 1: Extract Givens**\n- Conservation Law: $u_t + f(u)_x = 0$\n- Domain: periodic, $x \\in [0,1]$\n- Mesh: uniform with $N$ cells of size $h = 1/N$\n- Flux Function: $f(u) = a u$, with constant advection speed $a  0$\n- Spatial Discretization: Piecewise-linear discontinuous Galerkin (DG) method\n- Numerical Flux: Upwind\n- Slope Limiter Modification: The raw DG slope $\\sigma_i^{\\mathrm{raw}}$ in each cell $i$ is replaced by a limited slope $\\sigma_i = \\phi(v_1, v_2, v_3)$.\n- Limiter inputs: $v_1 = \\theta \\,(u_i - u_{i-1})/h$, $v_2 = \\frac{1}{2}\\,(u_{i+1} - u_{i-1})/h$, $v_3 = \\theta \\,(u_{i+1} - u_i)/h$, where $u_i$ is the cell average in cell $i$ and $\\theta \\in [1,2]$.\n- Standard Limiter: $\\phi = \\mathrm{minmod}$, defined as\n$$\n\\mathrm{minmod}(v_1,v_2,v_3) = \n\\begin{cases}\n\\mathrm{sign}(v_1)\\,\\min\\{|v_1|,|v_2|,|v_3|\\},  \\text{if } \\mathrm{sign}(v_1) = \\mathrm{sign}(v_2) = \\mathrm{sign}(v_3),\\\\\n0,  \\text{otherwise}.\n\\end{cases}\n$$\n- Modified Limiter: $\\phi = \\mathrm{maxmod}$, defined as\n$$\n\\mathrm{maxmod}(v_1,v_2,v_3) = \n\\begin{cases}\n\\mathrm{sign}(v_1)\\,\\max\\{|v_1|,|v_2|,|v_3|\\},  \\text{if } \\mathrm{sign}(v_1) = \\mathrm{sign}(v_2) = \\mathrm{sign}(v_3),\\\\\n0,  \\text{otherwise}.\n\\end{cases}\n$$\n- Time Integration: Strong Stability Preserving Runge–Kutta method of order $2$ (SSP-RK2) with time step $\\Delta t$ satisfying the CFL condition $a\\,\\Delta t/h \\le 1$.\n- Question: Characterize the effect of using $\\mathrm{maxmod}$ instead of $\\mathrm{minmod}$ on nonlinear stability for discontinuous initial data.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is well-defined within the field of numerical methods for partial differential equations, specifically for hyperbolic conservation laws. The concepts of DG methods, slope limiting, Total Variation Diminishing (TVD) properties, SSP time integrators, and CFL conditions are standard. The limiter inputs $v_1$, $v_2$, and $v_3$ represent backward, central, and forward difference approximations to the solution's spatial derivative, respectively, which are common ingredients in limiters for finite volume and DG methods. The functions $\\mathrm{minmod}$ and $\\mathrm{maxmod}$ are mathematically precise. The question asks for an analysis of the stability properties resulting from a specific, well-defined modification to the algorithm. The problem is scientifically grounded, well-posed, and objective. It contains no contradictions or missing information required for a qualitative analysis.\n\n**Step 3: Verdict and Action**\nThe problem statement is valid. I will proceed with the derivation of the solution.\n\n**Derivation of Solution**\n\nThe purpose of a slope limiter in a high-order scheme (like second-order DG) for conservation laws is to enforce nonlinear stability by preventing the formation of spurious oscillations near discontinuities. This is typically achieved by making the scheme monotonicity-preserving. A scheme is monotonicity-preserving if, given a monotonic discrete solution at time $t^n$, the solution at time $t^{n+1}$ remains monotonic. For scalar problems, this property implies that the total variation (TV) of the solution does not increase, i.e., the scheme is TVD.\n$TV(u) = \\sum_i |u_{i+1} - u_i|$.\n\nThe reconstruction within cell $i$ is a linear polynomial: $u_h(x) = u_i + \\sigma_i (x - x_i)$. To preserve monotonicity, the values of this polynomial at the cell edges, $x_{i \\pm 1/2}$, must not create new local extrema. This means the edge values must be bounded by the cell averages of the adjacent cells. For example, at the right cell edge $x_{i+1/2}$, the reconstructed value from within cell $i$, $u_h(x_{i+1/2}^-) = u_i + \\sigma_i h/2$, must lie between $u_i$ and $u_{i+1}$.\n\nLet us assume a locally monotonic profile, for instance $u_{i-1}  u_i  u_{i+1}$. The monotonicity constraints require:\n$u_{i-1} \\le u_i - \\sigma_i h/2$ and $u_i + \\sigma_i h/2 \\le u_{i+1}$.\nThese inequalities give bounds on the slope $\\sigma_i$:\n$\\sigma_i \\le \\frac{u_i - u_{i-1}}{h/2}$ and $\\sigma_i \\le \\frac{u_{i+1} - u_i}{h/2}$.\nSo the slope must be bounded by $2(u_i - u_{i-1})/h$ and $2(u_{i+1} - u_i)/h$. Note that the limiter inputs $v_1$ and $v_3$ for $\\theta=2$ correspond exactly to these bounds.\n\nThe $\\mathrm{minmod}$ limiter is designed to satisfy such constraints. When the candidate slopes ($v_1$, $v_2$, $v_3$) all have the same sign (indicating a locally monotonic region), $\\mathrm{minmod}$ selects the one with the smallest magnitude. This is a conservative choice that limits the 'steepness' of the reconstruction, ensuring the resulting scheme is TVD. This limiting action introduces numerical diffusion, which is the price paid for preventing oscillations.\n\nNow, consider the modified limiter, $\\mathrm{maxmod}$. In a region where the solution is monotonic and the candidate slopes $v_1, v_2, v_3$ are non-zero with the same sign, $\\mathrm{maxmod}$ selects the slope with the largest magnitude. This is an \"anti-limiting\" or \"compressive\" behavior. Instead of restricting the slope to prevent overshoots, it actively chooses the steepest possible reconstruction among the candidates.\n\nThis choice will almost certainly violate the monotonicity-preserving bounds. By selecting the maximum slope, the reconstructed value at a cell edge, e.g., $u_i + \\sigma_i h/2$, is highly likely to overshoot the neighboring cell average $u_{i+1}$ (or undershoot it). This creates new, spurious local extrema in the solution.\n\nThe creation of new extrema means the scheme is not monotonicity-preserving. Consequently, the scheme is not TVD; its total variation will increase with time, $TV(u^{n+1})  TV(u^n)$. This increase in total variation manifests as growing oscillations, particularly near discontinuities where the differences in cell averages are large. These oscillations resemble the Gibbs phenomenon but grow in amplitude over time, rather than being damped. This uncontrolled growth is a sign of nonlinear instability. The values can grow beyond the initial maximum and minimum values of the data (violating the maximum principle), and may eventually lead to a numerical blow-up, where the solution magnitude tends to infinity. This behavior is characteristic of an anti-diffusive scheme.\n\nThe use of an SSP time integrator and a CFL-compliant time step does not remedy this fundamental flaw in the spatial discretization. SSP methods are only guaranteed to preserve stability properties (like the TVD property) that are already held by the simple forward Euler update with the same spatial operator. If the spatial operator itself is TV-increasing, an SSP method will faithfully reproduce this instability.\n\n**Evaluation of Options**\n\nA. **The limiter becomes anti-diffusive: the total variation increases with time even under CFL-compliant time steps, leading to growing Gibbs-type oscillations near discontinuities, overshoots/undershoots that violate a maximum principle, and possible blow-up in $L^\\infty$.**\nThis statement accurately describes the consequences of using the $\\mathrm{maxmod}$ limiter. The selection of the maximum magnitude slope is an anti-diffusive action that leads to a violation of monotonicity, an increase in total variation, and the growth of spurious oscillations, which can ultimately cause the solution to blow up. **Correct.**\n\nB. **The method remains total variation diminishing (TVD) but produces sharper, nonoscillatory shocks and strictly reduced numerical diffusion compared to `minmod`.**\nThis is incorrect. The core premise that the method remains TVD is false. The `maxmod` function inherently violates the conditions required for a limiter to be TVD. While it attempts to produce sharper features (by being anti-diffusive or compressive), this comes at the cost of introducing severe, growing oscillations. **Incorrect.**\n\nC. **The method becomes more diffusive but unconditionally stable, effectively reverting to first order everywhere and suppressing oscillations.**\nThis statement describes the opposite behavior. The `maxmod` limiter is anti-diffusive, not more diffusive. A more diffusive limiter would choose an even smaller slope than `minmod`, or simply zero (reverting to a first-order scheme). The method is unstable, not unconditionally stable. **Incorrect.**\n\nD. **The method remains linearly stable in the $L^2$ norm for all CFL numbers $a\\,\\Delta t/h \\le 1$, exhibiting only a benign phase error without growth of spurious oscillations near discontinuities.**\nThis is incorrect. The primary issue here is nonlinear stability, which is not captured by linear stability analysis. The problem specifically asks about discontinuous data, where nonlinear effects are dominant. The oscillations are not benign and do not represent a mere phase error; they are a manifestation of amplitude growth and a severe nonlinear instability. **Incorrect.**", "answer": "$$\\boxed{A}$$", "id": "2385285"}]}