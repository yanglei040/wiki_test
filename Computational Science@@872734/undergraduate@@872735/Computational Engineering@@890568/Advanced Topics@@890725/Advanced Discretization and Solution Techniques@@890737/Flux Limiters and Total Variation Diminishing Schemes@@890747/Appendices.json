{"hands_on_practices": [{"introduction": "To appreciate the role of flux limiters, it is insightful to analyze classic higher-order schemes through the lens of the modern Total Variation Diminishing (TVD) framework. This exercise asks you to deconstruct the well-known Beam-Warming scheme to find its equivalent flux limiter function, $\\phi(r)$. By comparing this derived function against the established constraints for a TVD scheme [@problem_id:2394439], you will gain a deeper understanding of why un-limited higher-order methods can produce spurious oscillations and why the TVD conditions are crucial for robust shock-capturing.", "problem": "Consider the linear advection equation $u_{t} + a\\,u_{x} = 0$ with constant positive wave speed $a0$ on a uniform grid with spacing $\\Delta x$ and a forward Euler time update of size $\\Delta t$. Denote the Courant number by $\\nu = a\\,\\Delta t/\\Delta x$, with $0\\nu\\leq 1$. Work in a conservative finite volume framework,\n$$\nu_{i}^{n+1} \\;=\\; u_{i}^{n} \\;-\\; \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^{n} - F_{i-1/2}^{n}\\right),\n$$\nand use the standard upwind numerical flux $F_{i+1/2}^{n}=a\\,u_{i+1/2}^{-,n}$ for $a0$, where $u_{i+1/2}^{-,n}$ is a left-sided reconstruction of $u$ at the interface $x_{i+1/2}$. Let the smoothness indicator be\n$$\nr_{i}^{n} \\;=\\; \\frac{\\Delta_{i-1/2}^{n}}{\\Delta_{i+1/2}^{n}}, \n\\quad \\text{where} \\quad \\Delta_{j+1/2}^{n} \\;=\\; u_{j+1}^{n} - u_{j}^{n}.\n$$\nIn the high-resolution flux-limiter formulation for $a0$, the fully discrete update can be written in the one-parameter form\n$$\nu_{i}^{n+1} \\;=\\; u_{i}^{n} \\;-\\; \\nu\\left(u_{i}^{n}-u_{i-1}^{n}\\right)\n\\;-\\; \\frac{1}{2}\\,\\nu\\left(1-\\nu\\right)\\left[\\,\\phi\\!\\left(r_{i}^{n}\\right)\\left(u_{i+1}^{n}-u_{i}^{n}\\right) \\;-\\; \\phi\\!\\left(r_{i-1}^{n}\\right)\\left(u_{i}^{n}-u_{i-1}^{n}\\right)\\right].\n$$\nThe classic Beam–Warming scheme is the second-order accurate upwind-biased method that, for $a0$, uses the upwind one-sided slope in its reconstruction so that the anti-diffusive correction at each interface is proportional to the upwind gradient.\n\nTask:\n1) From first principles, determine the unique flux limiter function $\\phi(r)$ that makes the above flux-limiter update reduce to the classic Beam–Warming scheme for $a0$.\n2) Using well-established Total Variation Diminishing (TVD) constraints (Sweby’s sufficient conditions) for explicit schemes with $0\\nu\\leq 1$, namely that for $r\\ge 0$ one must have $0\\le \\phi(r)\\le \\min\\{2r,\\,2\\}$ and that $\\phi(r)\\ge 0$ whenever $r\\ge 0$ (and no anti-diffusion is permitted at non-monotone points, typically necessitating $\\phi(r)=0$ for $r\\le 0$), explain concisely why the identified $\\phi(r)$ does not define a TVD scheme.\n\nYour final answer must be the single closed-form expression for $\\phi(r)$. No numerical rounding is required.", "solution": "The problem requires, first, the derivation of the flux limiter function $\\phi(r)$ that corresponds to the classic Beam-Warming scheme, and second, an explanation for why this function does not result in a Total Variation Diminishing (TVD) scheme.\n\n**Part 1: Derivation of the Flux Limiter Function $\\phi(r)$**\n\nThe analysis starts from the conservative finite volume update for the linear advection equation $u_t + a u_x = 0$ with $a0$:\n$$\nu_{i}^{n+1} = u_{i}^{n} - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^{n} - F_{i-1/2}^{n}\\right)\n$$\nThe problem gives the general high-resolution flux-limiter update in the one-parameter form:\n$$\nu_{i}^{n+1} = u_{i}^{n} - \\nu\\left(u_{i}^{n}-u_{i-1}^{n}\\right) - \\frac{1}{2}\\nu\\left(1-\\nu\\right)\\left[\\phi(r_{i}^{n})\\left(u_{i+1}^{n}-u_{i}^{n}\\right) - \\phi(r_{i-1}^{n})\\left(u_{i}^{n}-u_{i-1}^{n}\\right)\\right]\n$$\nwhere $\\nu = a \\Delta t / \\Delta x$ is the Courant number. This update form is generated by a numerical flux $F_{i+1/2}$ that combines a low-order (first-order upwind) flux and a limited high-order correction term. The corresponding numerical flux is:\n$$\nF_{i+1/2}^n = \\underbrace{a u_i^n}_{\\text{1st-order upwind flux}} + \\underbrace{\\frac{1}{2}a(1-\\nu)\\phi(r_i^n)(u_{i+1}^n - u_i^n)}_{\\text{anti-diffusive correction flux}}\n$$\nThe Beam-Warming scheme is a second-order accurate upwind-biased method. For $a0$, its reconstruction is based on an upwind-biased stencil. The scheme can be understood as a modification of the second-order Lax-Wendroff scheme. The flux for the Lax-Wendroff scheme is:\n$$\nF_{i+1/2}^{\\text{LW}} = a u_i^n + \\frac{1}{2}a(1-\\nu)(u_{i+1}^n - u_i^n)\n$$\nThe anti-diffusive correction term, $\\frac{1}{2}a(1-\\nu)(u_{i+1}^n - u_i^n)$, depends on the downwind difference $(u_{i+1}^n - u_i^n)$ for $a0$.\n\nThe problem states that the Beam-Warming scheme \"uses the upwind one-sided slope in its reconstruction\". This implies that the anti-diffusive correction term must be proportional to the upwind difference, which for $a0$ is $(u_{i}^n - u_{i-1}^n)$. Thus, we replace the downwind difference in the Lax-Wendroff correction with the upwind difference to obtain the Beam-Warming flux:\n$$\nF_{i+1/2}^{\\text{BW}} = a u_i^n + \\frac{1}{2}a(1-\\nu)(u_i^n - u_{i-1}^n)\n$$\nTo find the flux limiter function $\\phi(r)$ for the Beam-Warming scheme, we equate the general flux-limiter expression for $F_{i+1/2}^n$ with $F_{i+1/2}^{\\text{BW}}$:\n$$\na u_i^n + \\frac{1}{2}a(1-\\nu)\\phi(r_i^n)(u_{i+1}^n - u_i^n) = a u_i^n + \\frac{1}{2}a(1-\\nu)(u_i^n - u_{i-1}^n)\n$$\nAssuming $a(1-\\nu) \\neq 0$ and $u_{i+1}^n - u_i^n \\neq 0$, we can cancel terms and isolate $\\phi(r_i^n)$:\n$$\n\\phi(r_i^n)(u_{i+1}^n - u_i^n) = (u_i^n - u_{i-1}^n)\n$$\n$$\n\\phi(r_i^n) = \\frac{u_i^n - u_{i-1}^n}{u_{i+1}^n - u_i^n}\n$$\nThe problem defines the smoothness indicator $r_i^n$ as the ratio of consecutive gradients:\n$$\nr_{i}^{n} = \\frac{\\Delta_{i-1/2}^{n}}{\\Delta_{i+1/2}^{n}} = \\frac{u_{i}^{n} - u_{i-1}^{n}}{u_{i+1}^{n} - u_{i}^{n}}\n$$\nComparing our result for $\\phi(r_i^n)$ with the definition of $r_i^n$, we find that the flux limiter function is simply the identity function:\n$$\n\\phi(r) = r\n$$\n\n**Part 2: TVD Analysis**\n\nA numerical scheme is TVD if its total variation does not increase over time. For explicit schemes of the form given, sufficient conditions for the scheme to be TVD (known as Sweby's conditions) are provided for the flux limiter $\\phi(r)$ when $0  \\nu \\le 1$:\n1.  For non-monotone data ($r \\le 0$), no anti-diffusion is permitted: $\\phi(r) = 0$.\n2.  For monotone data ($r  0$), the limiter must lie within a specific region: $0 \\le \\phi(r) \\le \\min\\{2r, 2\\}$.\n\nWe now test the Beam-Warming limiter, $\\phi(r) = r$, against these two conditions.\n\n- **Condition 1 ($r \\le 0$):** The TVD condition is $\\phi(r) = 0$. The limiter for Beam-Warming is $\\phi(r) = r$. For any $r  0$, $\\phi(r) = r \\neq 0$. Thus, the scheme violates this condition. This violation means the scheme adds anti-diffusion at local extrema, which is a known source of spurious oscillations near discontinuities.\n\n- **Condition 2 ($r  0$):** This condition breaks into two parts:\n    -   $0 \\le \\phi(r) \\le 2r$: For $\\phi(r)=r$, this becomes $0 \\le r \\le 2r$. This is true for all $r  0$.\n    -   $0 \\le \\phi(r) \\le 2$: For $\\phi(r)=r$, this becomes $0 \\le r \\le 2$. This inequality is only satisfied when $r$ is in the interval $(0, 2]$. For any $r  2$, we have $\\phi(r) = r  2$, which violates the condition.\n\nSince the flux limiter $\\phi(r) = r$ for the Beam-Warming scheme fails to satisfy the sufficient TVD conditions for all $r  0$ and for all $r  2$, the scheme is not TVD. Graphically, in the Sweby diagram (a plot of $\\phi$ versus $r$), the line $\\phi = r$ exits the polygonal TVD region, confirming its non-TVD nature and explaining its propensity to produce oscillations.", "answer": "$$\n\\boxed{\\phi(r) = r}\n$$", "id": "2394439"}, {"introduction": "Having established the theoretical basis for TVD schemes, this practice shifts the focus to implementation and performance. You will solve the linear advection of a square wave, a classic benchmark problem that exposes the strengths and weaknesses of numerical methods when dealing with sharp discontinuities. By implementing and comparing several popular flux limiters such as minmod, Superbee, and van Leer [@problem_id:2448960], you will observe firsthand the critical trade-offs between dissipative and compressive behavior in capturing sharp profiles without oscillations.", "problem": "Consider the one-dimensional linear advection equation\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0\n$$\non the periodic spatial domain $[0,1)$ with constant positive velocity $a0$. All quantities are dimensionless. The initial condition is a unit-amplitude square wave\n$$\nu(x,0) = \\begin{cases}\n1,  x \\in [0.25,\\,0.5),\\\\\n0,  \\text{otherwise,}\n\\end{cases}\n$$\nwith periodic boundary conditions.\n\nUse a uniform grid of $N$ control volumes with mesh width $\\Delta x = 1/N$, and denote by $u_i^n$ the cell average in cell $i \\in \\{0,1,\\dots,N-1\\}$ at time level $t^n$. Let the non-dimensional Courant number be\n$$\n\\lambda \\equiv \\frac{a\\,\\Delta t}{\\Delta x}.\n$$\nEvolve the cell averages with the conservative explicit update\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}}^n - F_{i-\\frac{1}{2}}^n\\right),\n$$\nwhere, for $a0$, the numerical flux at the interface $x_{i+\\frac{1}{2}}$ is defined by the flux-limited high-resolution upwind form\n$$\nF_{i+\\frac{1}{2}}^n = a\\,u_i^n + \\frac{a}{2}\\left(1-\\lambda\\right)\\,\\phi(r_i^n)\\,\\left(u_{i+1}^n - u_i^n\\right),\n$$\nwith periodic indexing modulo $N$. The smoothness indicator $r_i^n$ is given by\n$$\nr_i^n = \\frac{u_i^n - u_{i-1}^n}{u_{i+1}^n - u_i^n + \\varepsilon},\n$$\nwhere $\\varepsilon$ is a small positive number to avoid division by zero, and $\\phi(\\cdot)$ is a flux limiter chosen from the following set:\n- Minmod limiter:\n$$\n\\phi_{\\text{minmod}}(r) = \\max\\left(0, \\min(1, r)\\right).\n$$\n- Superbee limiter:\n$$\n\\phi_{\\text{superbee}}(r) = \\max\\left(0, \\min(2r,1), \\min(r,2)\\right).\n$$\n- Van Leer limiter:\n$$\n\\phi_{\\text{van Leer}}(r) = \\frac{r + |r|}{1 + |r|}.\n$$\n\nInitialize $u_i^0$ as the exact cell averages of the square wave over each control volume. Evolve the solution to the final time $T=1$ (one full advection period for $a=1$ on $[0,1)$), using a time step $\\Delta t$ such that $\\lambda \\le \\text{CFL}$, where the number of time steps is chosen to exactly reach $T$.\n\nFor each simulation, compute the following three quantitative diagnostics at $t=T$:\n- The discrete $L^1$ error against the exact solution $u(x,T) = u(x,0)$:\n$$\nE_1 = \\sum_{i=0}^{N-1} \\left|u_i^N - u_i^0\\right|\\,\\Delta x.\n$$\n- The maximum overshoot above the nominal maximum value $1$:\n$$\nO = \\max\\left(0, \\max_{i} u_i^N - 1\\right).\n$$\n- The minimum undershoot below the nominal minimum value $0$:\n$$\nU = \\min\\left(0, \\min_{i} u_i^N\\right).\n$$\n\nAdopt the following fixed parameters for all tests: $a=1$, $T=1$, and $\\varepsilon = 10^{-12}$. All quantities are dimensionless. Use periodic boundary conditions for all indexing operations.\n\nTest Suite:\nCompute $(E_1, O, U)$ for each of the following parameter sets $(N,\\ \\text{CFL},\\ \\text{limiter})$:\n1. $(200,\\ 0.5,\\ \\text{minmod})$\n2. $(200,\\ 0.5,\\ \\text{Superbee})$\n3. $(200,\\ 0.5,\\ \\text{van Leer})$\n4. $(200,\\ 0.95,\\ \\text{Superbee})$\n5. $(40,\\ 0.5,\\ \\text{van Leer})$\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list of floats enclosed in square brackets. Aggregate the nine values by flattening the triplets case-by-case in the exact order of the test suite, i.e.,\n$$\n[E_1^{(1)},\\,O^{(1)},\\,U^{(1)},\\,E_1^{(2)},\\,O^{(2)},\\,U^{(2)},\\,E_1^{(3)},\\,O^{(3)},\\,U^{(3)},\\,E_1^{(4)},\\,O^{(4)},\\,U^{(4)},\\,E_1^{(5)},\\,O^{(5)},\\,U^{(5)}].\n$$\nEach float must be rounded to exactly $6$ decimal places in the printed output. No additional text should be printed.", "solution": "The problem statement has been subjected to rigorous validation and is found to be scientifically sound, complete, and well-posed. It constitutes a standard benchmark problem in the field of computational methods for hyperbolic conservation laws. We will proceed to construct the solution.\n\nThe problem requires the numerical solution of the one-dimensional linear advection equation,\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0,\n$$\nfor a scalar quantity $u(x,t)$ with a constant positive advection speed $a  0$ on a periodic domain $x \\in [0,1)$. This equation is the archetypal hyperbolic conservation law. Its exact solution is a simple translation of the initial profile, $u(x,t) = u_0(x-at)$. For the given parameters $a=1$ and final time $T=1$, the exact solution on the periodic domain $[0,1)$ is identical to the initial condition, $u(x,T) = u(x-1,0) = u(x,0)$.\n\nThe numerical solution will be obtained using a finite volume method. The domain is discretized into $N$ uniform control volumes, or cells, each of width $\\Delta x = 1/N$. The $i$-th cell, for $i \\in \\{0, 1, \\dots, N-1\\}$, occupies the spatial interval $[x_{i-1/2}, x_{i+1/2}]$, where $x_{i-1/2} = i\\Delta x$. The numerical solution is represented by the cell averages,\n$$\nu_i^n \\approx \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x, t^n) \\, dx.\n$$\nThe initial condition $u_i^0$ is calculated by exactly evaluating this integral for the given square wave profile $u(x,0)$. For a cell $i$, the initial average value is the fraction of the cell's volume occupied by the wave, which is given by\n$$\nu_i^0 = \\frac{1}{\\Delta x} \\int_{i\\Delta x}^{(i+1)\\Delta x} u(x,0) \\, dx = \\frac{\\text{length}([i\\Delta x, (i+1)\\Delta x] \\cap [0.25, 0.5))}{\\Delta x}.\n$$\nThis is computed as $u_i^0 = \\max(0, \\min((i+1)\\Delta x, 0.5) - \\max(i\\Delta x, 0.25)) / \\Delta x$. This initialization ensures that the discrete total mass, $\\sum_i u_i^0 \\Delta x$, is consistent with the continuous initial condition.\n\nThe time evolution is governed by the explicit conservative formula:\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+\\frac{1}{2}}^n - F_{i-\\frac{1}{2}}^n \\right).\n$$\nThis form guarantees that the change in the average value in cell $i$ is solely due to the net flux across its boundaries at $x_{i-1/2}$ and $x_{i+1/2}$, thus ensuring discrete conservation. The time step $\\Delta t$ is determined such that the final time $T$ is reached in an integer number of steps, $N_t$. Given a Courant-Friedrichs-Lewy (CFL) number, the maximum allowable time step is $\\Delta t_{\\max} = \\text{CFL} \\cdot \\Delta x / a$. We choose the number of time steps as $N_t = \\lceil T/\\Delta t_{\\max} \\rceil$, and the actual time step is then $\\Delta t = T/N_t$. The resulting Courant number $\\lambda = a \\Delta t / \\Delta x$ is guaranteed to be less than or equal to the specified $\\text{CFL}$ value, which is a necessary condition for the stability of explicit schemes.\n\nThe core of the method lies in the definition of the numerical flux, $F_{i+1/2}^n$. The specified flux is a high-resolution, flux-limited scheme. For $a0$, the flux at the interface $x_{i+1/2}$ between cells $i$ and $i+1$ is given by\n$$\nF_{i+\\frac{1}{2}}^n = a\\,u_i^n + \\frac{a}{2}\\left(1-\\lambda\\right)\\,\\phi(r_i^n)\\,\\left(u_{i+1}^n - u_i^n\\right).\n$$\nThe first term, $a\\,u_i^n$, is the first-order upwind flux. This flux alone would yield a stable but very dissipative scheme that smears sharp features. The second term is a limited anti-diffusive correction. It is constructed to counteract the excessive numerical diffusion of the first-order scheme while preventing the introduction of spurious oscillations, a common problem with higher-order linear schemes (e.g., Lax-Wendroff) near discontinuities.\n\nThe correction term is modulated by a flux limiter function, $\\phi(r)$, which depends on the smoothness indicator,\n$$\nr_i^n = \\frac{u_i^n - u_{i-1}^n}{u_{i+1}^n - u_i^n + \\varepsilon}.\n$$\nThe ratio $r_i^n$ compares the gradient in the upwind cell $(u_i^n - u_{i-1}^n)$ to the gradient in the downwind cell $(u_{i+1}^n - u_i^n)$. In smooth regions of the solution, $r \\approx 1$, and the limiter $\\phi(r)$ should be chosen such that the scheme approaches a higher order of accuracy. Near discontinuities or extrema, $r$ can vary significantly, and the limiter must reduce the magnitude of the correction term, i.e., $\\phi \\to 0$, forcing the scheme to revert to the robust first-order upwind method. This adaptive behavior is key to achieving high resolution without oscillations, a property known as being Total Variation Diminishing (TVD). The parameter $\\varepsilon=10^{-12}$ is a small number to prevent division by zero when the gradient $u_{i+1}^n - u_i^n$ is zero.\n\nThe problem specifies three different flux limiters:\n1.  **Minmod**: $\\phi_{\\text{minmod}}(r) = \\max(0, \\min(1, r))$. This is the most dissipative of the TVD limiters, providing strong enforcement of monotonicity (no new extrema) at the cost of smearing profiles more than other limiters.\n2.  **Superbee**: $\\phi_{\\text{superbee}}(r) = \\max(0, \\min(2r,1), \\min(r,2))$. This is a more compressive limiter, designed to maintain sharp resolution of contact discontinuities. It is less dissipative than Minmod but can slightly steepen smooth profiles.\n3.  **Van Leer**: $\\phi_{\\text{van Leer}}(r) = \\frac{r + |r|}{1 + |r|}$. This limiter provides a good balance between controlling oscillations and maintaining accuracy, and is differentiable, which can be advantageous in some contexts.\n\nThe simulation proceeds by iteratively applying the update formula for $N_t$ steps. Periodic boundary conditions are enforced by using modular arithmetic for all spatial indices, e.g., $u_{N} \\equiv u_0$ and $u_{-1} \\equiv u_{N-1}$. After reaching the final time $T$, the numerical solution $u_i^{N_t}$ is compared to the initial (and exact final) solution $u_i^0$ to compute the $L^1$ error $E_1$, the maximum overshoot $O$, and the minimum undershoot $U$. These diagnostics quantify the accuracy and monotonicity-preserving properties of the scheme for each parameter set.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D linear advection equation using a high-resolution flux-limited scheme\n    for a set of test cases and prints the diagnostic results.\n    \"\"\"\n\n    # --- Flux Limiter Functions ---\n    def limiter_minmod(r):\n        return np.maximum(0, np.minimum(1, r))\n\n    def limiter_superbee(r):\n        term1 = np.minimum(2 * r, 1)\n        term2 = np.minimum(r, 2)\n        return np.maximum(0, np.maximum(term1, term2))\n\n    def limiter_vanleer(r):\n        # Note: abs(r) is used, equivalent to |r|\n        return (r + np.abs(r)) / (1 + np.abs(r))\n\n    limiter_map = {\n        'minmod': limiter_minmod,\n        'superbee': limiter_superbee,\n        'van_Leer': limiter_vanleer\n    }\n\n    # --- Problem Parameters ---\n    a = 1.0\n    T = 1.0\n    epsilon = 1e-12\n\n    test_cases = [\n        (200, 0.5, 'minmod'),\n        (200, 0.5, 'superbee'),\n        (200, 0.5, 'van_Leer'),\n        (200, 0.95, 'superbee'),\n        (40, 0.5, 'van_Leer'),\n    ]\n\n    all_results = []\n\n    for N, CFL, limiter_name in test_cases:\n        # --- Discretization ---\n        dx = 1.0 / N\n        x_faces = np.linspace(0.0, 1.0, N + 1)\n        \n        # --- Initial Condition (Cell Averages) ---\n        # u(x,0) is 1 on [0.25, 0.5), 0 otherwise\n        overlap = np.maximum(0, np.minimum(x_faces[1:], 0.5) - np.maximum(x_faces[:-1], 0.25))\n        u0 = overlap / dx\n        \n        # --- Time Stepping ---\n        dt_max = CFL * dx / a\n        num_steps = int(np.ceil(T / dt_max))\n        dt = T / num_steps\n        lambda_val = a * dt / dx\n\n        # --- Select Limiter ---\n        selected_limiter = limiter_map[limiter_name]\n        \n        # --- Time Evolution Loop ---\n        u_current = u0.copy()\n        \n        for _ in range(num_steps):\n            # Enforce periodic boundary conditions using np.roll\n            u_im1 = np.roll(u_current, 1)  # u_{i-1}\n            u_ip1 = np.roll(u_current, -1) # u_{i+1}\n            \n            # Gradients\n            du_forward = u_ip1 - u_current  # u_{i+1} - u_i\n            du_backward = u_current - u_im1 # u_i - u_{i-1}\n            \n            # Smoothness indicator r\n            # Suppress division by zero warnings, handled by epsilon\n            with np.errstate(divide='ignore', invalid='ignore'):\n                r = du_backward / (du_forward + epsilon)\n                r[np.isnan(r)] = 0  # Handle potential 0/0 - NaN cases\n\n            # Limiter values\n            phi = selected_limiter(r)\n            \n            # Numerical flux F_{i+1/2}\n            # F[i] corresponds to F_{i+1/2}\n            flux = a * u_current + (a / 2.0) * (1.0 - lambda_val) * phi * du_forward\n            \n            # Flux difference across cell i: F_{i+1/2} - F_{i-1/2}\n            flux_diff = flux - np.roll(flux, 1)\n            \n            # Update solution\n            u_current -= (dt / dx) * flux_diff\n\n        u_final = u_current\n\n        # --- Diagnostics ---\n        # L1 error\n        e1 = np.sum(np.abs(u_final - u0)) * dx\n        \n        # Overshoot\n        overshoot = np.maximum(0, np.max(u_final) - 1.0)\n        \n        # Undershoot\n        # np.min(u_final) could be positive, so we need min(0, ...)\n        undershoot = np.minimum(0, np.min(u_final))\n        \n        # Append results for this case\n        all_results.extend([e1, overshoot, undershoot])\n\n    # --- Final Output Formatting ---\n    formatted_results = [f\"{val:.6f}\" for val in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2448960"}, {"introduction": "Many introductory examples of flux limiters assume a uniform computational grid, but real-world engineering problems often require non-uniform meshes to resolve complex geometries or flow features efficiently. This practice challenges you to generalize your understanding by deriving the form of the smoothness indicator, $r$, for a non-uniform grid [@problem_id:2394403]. Successfully completing this derivation demonstrates a deeper grasp of the underlying principle: $r$ is a ratio of physical gradients, not just a simple ratio of differences in cell-average values.", "problem": "Consider the scalar linear advection equation $u_{t} + a\\,u_{x} = 0$ with constant speed $a  0$ on a one-dimensional domain. Use a finite-volume discretization on a strictly increasing, non-uniform grid with cell centers located at positions $\\{x_{j}\\}_{j\\in\\mathbb{Z}}$, where $h_{j+1/2} \\equiv x_{j+1} - x_{j}$ and $h_{j-1/2} \\equiv x_{j} - x_{j-1}$. Let $u_{j}$ denote the cell-averaged solution in cell $j$. In a Total Variation Diminishing (TVD) scheme, a flux limiter function uses the dimensionless ratio $r_{j+1/2}$ at the interface $x_{j+1/2}$ to compare upwind and downwind gradients for $a0$.\n\nAssume piecewise-linear reconstruction in each cell, and define $r_{j+1/2}$ as the ratio of the left-biased to right-biased linear estimates of the spatial gradient at the interface $x_{j+1/2}$, each constructed from the nearest-neighbor cell averages on the non-uniform grid. Derive a closed-form analytic expression for $r_{j+1/2}$ in terms of $u_{j-1}$, $u_{j}$, $u_{j+1}$ and the grid spacings $h_{j-1/2}$ and $h_{j+1/2}$. Provide your final result as a single simplified expression. No numerical evaluation or rounding is required.", "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n-   Governing Equation: Scalar linear advection equation $u_{t} + a\\,u_{x} = 0$, with constant speed $a  0$.\n-   Discretization: One-dimensional finite-volume scheme on a strictly increasing, non-uniform grid.\n-   Grid Geometry: Cell centers are located at positions $\\{x_{j}\\}_{j\\in\\mathbb{Z}}$.\n-   Grid Spacing Definitions: $h_{j+1/2} \\equiv x_{j+1} - x_{j}$ and $h_{j-1/2} \\equiv x_{j} - x_{j-1}$.\n-   Solution Variables: $u_{j}$ represents the cell-averaged solution in cell $j$.\n-   Scheme Context: The scheme is Total Variation Diminishing (TVD).\n-   Core Quantity: A dimensionless ratio $r_{j+1/2}$ is used at the interface $x_{j+1/2}$.\n-   Reconstruction: Piecewise-linear reconstruction is assumed in each cell.\n-   Definition of $r_{j+1/2}$: The ratio of the left-biased to right-biased linear estimates of the spatial gradient at the interface $x_{j+1/2}$, constructed from the nearest-neighbor cell averages.\n-   Objective: Derive a closed-form analytic expression for $r_{j+1/2}$ in terms of $u_{j-1}$, $u_{j}$, $u_{j+1}$, $h_{j-1/2}$, and $h_{j+1/2}$.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientific Grounding**: The problem is well-grounded in the established theory of numerical methods for hyperbolic conservation laws, specifically concerning high-resolution finite-volume schemes and the concept of flux limiters. All concepts are standard in computational engineering and applied mathematics.\n-   **Well-Posedness**: The problem is well-posed. It provides an explicit definition for the quantity to be derived, $r_{j+1/2}$, and lists all necessary input variables. The objective is to perform a mathematical derivation, for which a unique result exists.\n-   **Objectivity**: The problem is stated in precise, objective, and technical language, free from ambiguity or subjective claims.\n\n**Step 3: Verdict and Action**\nThe problem is scientifically sound, self-contained, and well-posed. It is therefore deemed **valid**. A rigorous derivation will be performed.\n\nThe objective is to derive an expression for the ratio $r_{j+1/2}$ at the interface $x_{j+1/2}$. The problem defines this ratio as:\n$$\nr_{j+1/2} = \\frac{\\text{left-biased gradient estimate}}{\\text{right-biased gradient estimate}}\n$$\nThe estimates are for the spatial gradient, $\\frac{\\partial u}{\\partial x}$, and are constructed from the nearest-neighbor cell averages on the non-uniform grid. The interface $x_{j+1/2}$ is located between cell centers $x_j$ and $x_{j+1}$.\n\nFirst, we must formalize the \"left-biased linear estimate\" of the gradient. This estimate is constructed using cell averages from the \"left\" side relative to the region of interest. For the interface at $x_{j+1/2}$, the most immediate data points to its left are the cell averages $u_j$ and $u_{j-1}$, located at cell centers $x_j$ and $x_{j-1}$, respectively. A linear estimate of the gradient from these two points is given by the finite difference:\n$$\n(\\nabla u)_{\\text{left}} = \\frac{u_{j} - u_{j-1}}{x_{j} - x_{j-1}}\n$$\nUsing the provided definition for grid spacing, $h_{j-1/2} \\equiv x_{j} - x_{j-1}$, this becomes:\n$$\n(\\nabla u)_{\\text{left}} = \\frac{u_{j} - u_{j-1}}{h_{j-1/2}}\n$$\nThis represents the average gradient over the interval $[x_{j-1}, x_j]$.\n\nNext, we formalize the \"right-biased linear estimate\" of the gradient. Following the same logic, this estimate is constructed using cell averages that define the slope on the \"right\" side. The relevant data points are the cell averages $u_{j+1}$ and $u_j$, located at cell centers $x_{j+1}$ and $x_j$. The corresponding linear estimate of the gradient is:\n$$\n(\\nabla u)_{\\text{right}} = \\frac{u_{j+1} - u_{j}}{x_{j+1} - x_{j}}\n$$\nUsing the provided definition for grid spacing, $h_{j+1/2} \\equiv x_{j+1} - x_j$, this becomes:\n$$\n(\\nabla u)_{\\text{right}} = \\frac{u_{j+1} - u_{j}}{h_{j+1/2}}\n$$\nThis represents the average gradient over the interval $[x_j, x_{j+1}]$.\n\nThe problem explicitly states that $r_{j+1/2}$ is the ratio of the left-biased estimate to the right-biased estimate. Therefore, we construct this ratio using the expressions derived above:\n$$\nr_{j+1/2} = \\frac{(\\nabla u)_{\\text{left}}}{(\\nabla u)_{\\text{right}}} = \\frac{\\frac{u_{j} - u_{j-1}}{h_{j-1/2}}}{\\frac{u_{j+1} - u_{j}}{h_{j+1/2}}}\n$$\nThis expression is a compound fraction. To obtain the final simplified form, we rearrange the terms:\n$$\nr_{j+1/2} = \\left( \\frac{u_{j} - u_{j-1}}{u_{j+1} - u_{j}} \\right) \\left( \\frac{h_{j+1/2}}{h_{j-1/2}} \\right)\n$$\nThis expression is the closed-form result for $r_{j+1/2}$ in terms of the specified quantities. It represents the ratio of consecutive gradient approximations, correctly scaled for the non-uniform grid spacings.", "answer": "$$\\boxed{\\frac{(u_{j} - u_{j-1}) h_{j+1/2}}{(u_{j+1} - u_{j}) h_{j-1/2}}}$$", "id": "2394403"}]}