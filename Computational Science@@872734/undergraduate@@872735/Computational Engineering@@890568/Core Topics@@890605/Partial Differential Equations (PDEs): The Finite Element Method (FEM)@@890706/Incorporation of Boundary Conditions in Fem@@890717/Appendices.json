{"hands_on_practices": [{"introduction": "A common task in engineering analysis is to model the effect of pressure or surface tractions, which are known as Neumann boundary conditions. Since the Finite Element Method (FEM) operates on a discrete set of nodes, these continuous loads must be converted into a set of equivalent forces acting at the nodes. This first exercise provides hands-on practice with this fundamental procedure, focusing on the crucial role of geometry when handling a uniform pressure on an element edge that is not aligned with the global coordinate axes.", "problem": "A planar three-node linear triangular finite element with constant thickness is embedded in a two-dimensional solid. The nodal coordinates in meters are: node $A$ at $(x,y)=(1,2)$, node $B$ at $(x,y)=(5,5)$, and node $C$ at $(x,y)=(2,7)$. The element has uniform thickness $t=0.010~\\mathrm{m}$. A uniform pressure of magnitude $p=3.2\\times 10^{3}~\\mathrm{N/m^{2}}$ is applied on the element edge connecting nodes $A$ and $B$. The pressure acts in the direction of the inward unit normal to the element along that edge (i.e., into the element interior).\n\nTreat this as a boundary traction (a Neumann boundary condition) and determine, in the global coordinate system, the $x$-component of the single equivalent nodal force at node $A$ that results from correctly incorporating this boundary condition in the finite element formulation.\n\nExpress your final answer in $\\mathrm{N}$ and round your result to four significant figures.", "solution": "The problem requires the calculation of an equivalent nodal force component due to a uniformly distributed pressure acting on one edge of a linear triangular finite element. This is a standard procedure in the Finite Element Method (FEM) for incorporating Neumann boundary conditions.\n\nFirst, the problem statement must be validated.\n**Step 1: Extract Givens**\n- Element Type: Planar three-node linear triangular finite element.\n- Nodal Coordinates: Node $A$ at $(x,y)=(1,2)$, Node $B$ at $(x,y)=(5,5)$, Node $C$ at $(x,y)=(2,7)$. All coordinates are in meters $(\\mathrm{m})$.\n- Element Thickness: $t=0.010~\\mathrm{m}$.\n- Applied Load: Uniform pressure $p=3.2\\times 10^{3}~\\mathrm{N/m^{2}}$.\n- Load Application: On the element edge connecting nodes $A$ and $B$.\n- Load Direction: Inward unit normal to the element along the edge $AB$.\n- Objective: Determine the $x$-component of the equivalent nodal force at node $A$, denoted $F_{Ax}$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, being a direct application of established principles of continuum mechanics and the Finite Element Method. It is well-posed, providing all necessary geometric and loading data to compute a unique solution. The language is objective and precise. The problem is complete, consistent, and feasible.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A solution will be derived.\n\nThe equivalent nodal forces $\\{f^e\\}$ for an element due to a surface traction $\\{T\\}$ are found by ensuring that the work done by the nodal forces is equal to the work done by the traction. This principle of virtual work leads to the following integral expression:\n$$ \\{f^e\\} = \\int_{S_e} [N]^T \\{T\\} \\, dS $$\nwhere $[N]$ is the matrix of element shape functions and $S_e$ is the surface on which the traction is applied. For this problem, the surface is the face of the edge connecting nodes $A$ and $B$. The differential surface area is $dS = t \\, dL$, where $t$ is the element thickness and $dL$ is the differential length along the edge.\n\nFor a linear element, the displacement field along the edge $A-B$ is interpolated linearly from the nodal displacements at $A$ and $B$. The shape functions for nodes $A$ and $B$ vary linearly along this edge, while the shape function for node $C$ is zero. For a uniform traction $\\{T\\}$ and linear shape functions, the integral simplifies such that the total force acting on the edge is distributed equally between the two nodes defining the edge.\n\nThe total force vector, $\\vec{F}_{total}$, is the product of the traction vector, $\\vec{T}$, and the area of the edge face, $A_{edge}$.\n$$ \\vec{F}_{total} = \\vec{T} \\cdot A_{edge} $$\nThe area is $A_{edge} = L_{AB} \\cdot t$, where $L_{AB}$ is the length of the edge $A-B$.\n\nFirst, we determine the geometry of the edge $A-B$. The coordinates are $A(1, 2)$ and $B(5, 5)$.\nThe vector along the edge from $A$ to $B$ is:\n$$ \\vec{V}_{AB} = (x_B - x_A, y_B - y_A) = (5 - 1, 5 - 2) = (4, 3) $$\nThe length of this edge is:\n$$ L_{AB} = \\sqrt{(x_B - x_A)^2 + (y_B - y_A)^2} = \\sqrt{4^2 + 3^2} = \\sqrt{16 + 9} = \\sqrt{25} = 5~\\mathrm{m} $$\nThe area of the face on which the pressure acts is:\n$$ A_{edge} = L_{AB} \\cdot t = (5~\\mathrm{m}) \\cdot (0.010~\\mathrm{m}) = 0.05~\\mathrm{m^2} $$\n\nNext, we establish the traction vector $\\vec{T}$. The magnitude of the traction is the pressure, $p = 3.2 \\times 10^3~\\mathrm{N/m^2}$. The direction is the inward unit normal to the edge $A-B$.\nTo find the inward normal, we first find the outward normal. Given the element nodes $A(1,2)$, $B(5,5)$, and $C(2,7)$, we can check their orientation. The signed area calculation gives:\n$$ 2 \\times \\text{Area} = \\det \\begin{pmatrix} x_A & y_A & 1 \\\\ x_B & y_B & 1 \\\\ x_C & y_C & 1 \\end{pmatrix} = \\det \\begin{pmatrix} 1 & 2 & 1 \\\\ 5 & 5 & 1 \\\\ 2 & 7 & 1 \\end{pmatrix} = 1(5-7) - 2(5-2) + 1(35-10) = -2 - 6 + 25 = 17 $$\nSince the result is positive, the nodes $A-B-C$ are listed in a counter-clockwise (CCW) order. For a CCW-ordered element, the outward unit normal vector $\\hat{n}_{out}$ to the edge from node $A$ to node $B$ is given by:\n$$ \\hat{n}_{out} = \\frac{1}{L_{AB}}(y_B - y_A, -(x_B - x_A)) = \\frac{1}{5}(5-2, -(5-1)) = \\frac{1}{5}(3, -4) $$\nThe problem specifies the pressure acts in the direction of the inward unit normal, $\\hat{n}_{in}$, which is opposite to the outward normal:\n$$ \\hat{n}_{in} = -\\hat{n}_{out} = -\\frac{1}{5}(3, -4) = \\begin{pmatrix} -3/5 \\\\ 4/5 \\end{pmatrix} $$\nThe traction vector $\\vec{T}$ is the pressure multiplied by this direction vector:\n$$ \\vec{T} = p \\cdot \\hat{n}_{in} = (3.2 \\times 10^3~\\mathrm{N/m^2}) \\cdot \\begin{pmatrix} -3/5 \\\\ 4/5 \\end{pmatrix} = \\begin{pmatrix} -1920 \\\\ 2560 \\end{pmatrix}~\\mathrm{N/m^2} $$\nSo, $T_x = -1920~\\mathrm{N/m^2}$ and $T_y = 2560~\\mathrm{N/m^2}$.\n\nThe total force vector on the edge is:\n$$ \\vec{F}_{total} = \\vec{T} \\cdot A_{edge} = \\begin{pmatrix} -1920 \\\\ 2560 \\end{pmatrix} \\cdot (0.05) = \\begin{pmatrix} -96 \\\\ 128 \\end{pmatrix}~\\mathrm{N} $$\nFor a linear element with a uniform traction applied along an edge, this total force is distributed equally to the two nodes on that edge, $A$ and $B$. The forces at node $C$ are zero.\n$$ \\vec{F}_A = \\vec{F}_B = \\frac{1}{2} \\vec{F}_{total} $$\nThe equivalent nodal force vector at node $A$ is:\n$$ \\vec{F}_A = \\frac{1}{2} \\begin{pmatrix} -96 \\\\ 128 \\end{pmatrix} = \\begin{pmatrix} -48 \\\\ 64 \\end{pmatrix}~\\mathrm{N} $$\nThe components of the force at node $A$ are $F_{Ax} = -48~\\mathrm{N}$ and $F_{Ay} = 64~\\mathrm{N}$.\n\nThe problem asks for the $x$-component of the equivalent nodal force at node $A$, which is $F_{Ax}$.\n$$ F_{Ax} = -48~\\mathrm{N} $$\nThe problem requires the answer to be rounded to four significant figures.\n$$ F_{Ax} = -48.00~\\mathrm{N} $$", "answer": "$$\\boxed{-48.00}$$", "id": "2402849"}, {"introduction": "Building on the concept of nodal forces, we now address more realistic scenarios where the applied load is not uniform. When a traction varies across an element's boundary, simply dividing the total force among the nodes is incorrect. This is where the principle of virtual work leads to the rigorously defined \"consistent\" nodal load vector. This practice challenges you to derive the consistent nodal forces for a linearly varying hydrostatic pressure, reinforcing how shape functions are used to distribute loads in a work-equivalent manner.", "problem": "A vertical concrete dam is modeled in two dimensions under plane strain with unit out-of-plane thickness. The upstream water face coincides with the global line $x=0$ from the free surface at $z=0$ to depth $z=H$. The coordinate system is defined with $x$ horizontal pointing into the dam and $z$ vertical downward from the free surface. The hydrostatic pressure exerted by the water on the dam is $p(z)=\\rho g z$, where $\\rho$ is the fluid density and $g$ is the gravitational acceleration. The pressure acts normal to the face and into the dam.\n\nConsider a single straight boundary finite element along the upstream face, connecting node $1$ at $(x,z)=(0,0)$ and node $2$ at $(x,z)=(0,H)$. Use a linear interpolation along this boundary segment with nodal degrees of freedom ordered as $\\big[u_{1x},u_{1z},u_{2x},u_{2z}\\big]$. Determine the consistent equivalent nodal force vector for this boundary element in global components, expressed as a row vector $\\big[F_{1x},F_{1z},F_{2x},F_{2z}\\big]$ in terms of $\\rho$, $g$, and $H$.\n\nExpress the final result in Newton per unit out-of-plane thickness. Provide your answer as a single row matrix. No rounding is required.", "solution": "The problem statement will first be subjected to a rigorous validation to ascertain its scientific and logical integrity.\n\n**Step 1: Extract Givens**\n\n*   **Model**: A two-dimensional vertical concrete dam under plane strain conditions, with a unit out-of-plane thickness.\n*   **Coordinate System**: The $x$-axis is horizontal, pointing into the dam. The $z$-axis is vertical, pointing downward from the water's free surface.\n*   **Geometry**: The upstream face of the dam is a vertical line at $x=0$, extending from the free surface at $z=0$ to a depth of $z=H$.\n*   **Loading**: A hydrostatic pressure $p(z) = \\rho g z$ is exerted by the water on the upstream face, where $\\rho$ is the fluid density and $g$ is the gravitational acceleration. The pressure acts normal to the face and into thedam.\n*   **Finite Element Discretization**: A single straight boundary element is used to model the upstream face. This element connects node $1$ at $(x,z)=(0,0)$ and node $2$ at $(x,z)=(0,H)$.\n*   **Interpolation**: Linear interpolation is used along the boundary element.\n*   **Degrees of Freedom**: The nodal degrees of freedom are ordered as the vector $\\big[u_{1x}, u_{1z}, u_{2x}, u_{2z}\\big]$.\n*   **Objective**: To determine the consistent equivalent nodal force vector for this boundary element, expressed as a row vector $\\big[F_{1x}, F_{1z}, F_{2x}, F_{2z}\\big]$ in terms of $\\rho$, $g$, and $H$. The result is to be in units of force per unit out-of-plane thickness.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem is analyzed against the required criteria.\n\n*   **Scientifically Grounded**: The problem is a standard application of the Finite Element Method (FEM) in structural mechanics. The formula for hydrostatic pressure, $p(z) = \\rho g z$, is a fundamental principle of fluid statics. The concept of consistent nodal loads derived from the principle of virtual work is a core tenet of FEM. The setup is a valid and common simplification for analyzing dams.\n*   **Well-Posed**: The problem provides all necessary information—geometry, loading function, element type, shape functions (implied by \"linear interpolation\"), and degrees of freedom—to uniquely determine the equivalent nodal force vector.\n*   **Objective**: The problem is stated using precise, objective, and unambiguous technical language.\n\nThe problem does not exhibit any flaws. It is scientifically sound, well-posed, completely specified, and directly solvable using established principles of computational engineering.\n\n**Step 3: Verdict and Action**\n\nThe problem is deemed **valid**. A solution will be derived.\n\n**Derivation of the Solution**\n\nThe consistent equivalent nodal force vector, $\\mathbf{F}_e$, is derived by equating the virtual work done by the distributed traction vector, $\\mathbf{t}$, to the virtual work done by the nodal forces. The governing relationship is:\n$$ \\delta W_{ext} = \\int_{\\Gamma_e} (\\delta \\mathbf{u})^T \\mathbf{t} \\, d\\Gamma = (\\delta \\mathbf{d}_e)^T \\mathbf{F}_e $$\nwhere $\\Gamma_e$ is the boundary of the element, $\\delta \\mathbf{u}$ is the virtual displacement field along the boundary, and $\\delta \\mathbf{d}_e$ is the vector of virtual nodal displacements.\n\nThe displacement field, $\\mathbf{u}(z)$, along the element is interpolated from the nodal displacements, $\\mathbf{d}_e = \\begin{pmatrix} u_{1x} & u_{1z} & u_{2x} & u_{2z} \\end{pmatrix}^T$, using linear shape functions. The element extends from $z=0$ to $z=H$. The linear shape functions in terms of the vertical coordinate $z$ are:\n$$ N_1(z) = 1 - \\frac{z}{H} $$\n$$ N_2(z) = \\frac{z}{H} $$\nThe displacement vector $\\mathbf{u}(z) = \\begin{pmatrix} u_x(z) \\\\ u_z(z) \\end{pmatrix}$ can be written in matrix form as:\n$$ \\mathbf{u}(z) = \\begin{bmatrix} N_1(z) & 0 & N_2(z) & 0 \\\\ 0 & N_1(z) & 0 & N_2(z) \\end{bmatrix} \\mathbf{d}_e = \\mathbf{N}(z) \\mathbf{d}_e $$\nwhere $\\mathbf{N}(z)$ is the shape function matrix. The virtual displacement field is then $\\delta\\mathbf{u}(z) = \\mathbf{N}(z) \\delta\\mathbf{d}_e$.\n\nSubstituting this into the virtual work equation gives:\n$$ (\\delta \\mathbf{d}_e)^T \\mathbf{F}_e = \\int_{\\Gamma_e} (\\mathbf{N}(z) \\delta\\mathbf{d}_e)^T \\mathbf{t}(z) \\, d\\Gamma = (\\delta \\mathbf{d}_e)^T \\int_{\\Gamma_e} \\mathbf{N}(z)^T \\mathbf{t}(z) \\, d\\Gamma $$\nSince this equality must hold for any arbitrary virtual nodal displacement vector $\\delta\\mathbf{d}_e$, we can deduce the expression for the equivalent nodal force vector:\n$$ \\mathbf{F}_e = \\int_{\\Gamma_e} \\mathbf{N}(z)^T \\mathbf{t}(z) \\, d\\Gamma $$\nThe pressure $p(z) = \\rho g z$ acts normal to the dam face and into the structure. The dam face is at $x=0$, so the force is directed along the positive $x$-axis. The traction vector $\\mathbf{t}(z)$ is therefore:\n$$ \\mathbf{t}(z) = \\begin{pmatrix} p(z) \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} \\rho g z \\\\ 0 \\end{pmatrix} $$\nThe integral is performed along the element's length, so $d\\Gamma = dz$ and the integration limits are from $z=0$ to $z=H$. The integral is performed per unit out-of-plane thickness, as specified.\n\nWe compute the product $\\mathbf{N}(z)^T \\mathbf{t}(z)$:\n$$ \\mathbf{N}(z)^T \\mathbf{t}(z) = \\begin{bmatrix} N_1(z) & 0 \\\\ 0 & N_1(z) \\\\ N_2(z) & 0 \\\\ 0 & N_2(z) \\end{bmatrix} \\begin{pmatrix} \\rho g z \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} N_1(z) \\rho g z \\\\ 0 \\\\ N_2(z) \\rho g z \\\\ 0 \\end{pmatrix} $$\nSubstituting the expressions for the shape functions:\n$$ \\mathbf{N}(z)^T \\mathbf{t}(z) = \\begin{pmatrix} (1 - \\frac{z}{H}) \\rho g z \\\\ 0 \\\\ (\\frac{z}{H}) \\rho g z \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} \\rho g (z - \\frac{z^2}{H}) \\\\ 0 \\\\ \\frac{\\rho g z^2}{H} \\\\ 0 \\end{pmatrix} $$\nNow, we integrate this vector from $z=0$ to $z=H$ to find the components of $\\mathbf{F}_e = \\begin{pmatrix} F_{1x} & F_{1z} & F_{2x} & F_{2z} \\end{pmatrix}^T$.\n\nThe first component, $F_{1x}$, is:\n$$ F_{1x} = \\int_{0}^{H} \\rho g \\left(z - \\frac{z^2}{H}\\right) dz = \\rho g \\left[ \\frac{z^2}{2} - \\frac{z^3}{3H} \\right]_{0}^{H} = \\rho g \\left( \\frac{H^2}{2} - \\frac{H^3}{3H} \\right) = \\rho g \\left( \\frac{H^2}{2} - \\frac{H^2}{3} \\right) = \\frac{1}{6} \\rho g H^2 $$\nThe second component, $F_{1z}$, is:\n$$ F_{1z} = \\int_{0}^{H} 0 \\, dz = 0 $$\nThe third component, $F_{2x}$, is:\n$$ F_{2x} = \\int_{0}^{H} \\frac{\\rho g z^2}{H} dz = \\frac{\\rho g}{H} \\left[ \\frac{z^3}{3} \\right]_{0}^{H} = \\frac{\\rho g}{H} \\left( \\frac{H^3}{3} \\right) = \\frac{1}{3} \\rho g H^2 $$\nThe fourth component, $F_{2z}$, is:\n$$ F_{2z} = \\int_{0}^{H} 0 \\, dz = 0 $$\nThe resulting consistent equivalent nodal force vector is $\\mathbf{F}_e = \\begin{pmatrix} \\frac{1}{6} \\rho g H^2 \\\\ 0 \\\\ \\frac{1}{3} \\rho g H^2 \\\\ 0 \\end{pmatrix}$.\nThe problem requests the result as a row vector $\\big[F_{1x}, F_{1z}, F_{2x}, F_{2z}\\big]$.\nThus, the final answer is $\\left[ \\frac{1}{6} \\rho g H^2, 0, \\frac{1}{3} \\rho g H^2, 0 \\right]$.\n\nA brief verification confirms the result. The total horizontal force is $\\int_{0}^{H} \\rho g z \\, dz = \\frac{1}{2} \\rho g H^2$. The sum of the nodal forces is $F_{1x} + F_{2x} = \\frac{1}{6} \\rho g H^2 + \\frac{1}{3} \\rho g H^2 = \\frac{1}{2} \\rho g H^2$. The total force is conserved.\nThe moment about node $1$ (at $z=0$) produced by the pressure is $\\int_{0}^{H} z (\\rho g z) \\, dz = \\frac{1}{3} \\rho g H^3$. The moment from the nodal forces is $H \\cdot F_{2x} = H \\cdot (\\frac{1}{3} \\rho g H^2) = \\frac{1}{3} \\rho g H^3$. The moment is also conserved. The derivation is correct.", "answer": "$$\n\\boxed{\n\\begin{bmatrix}\n\\frac{1}{6} \\rho g H^{2} & 0 & \\frac{1}{3} \\rho g H^{2} & 0\n\\end{bmatrix}\n}\n$$", "id": "2402844"}, {"introduction": "Engineering problems often involve constraints that cannot be expressed as simple point-wise conditions. For instance, we might need to enforce a specific average temperature or a total flux across a boundary. The Lagrange multiplier method provides a powerful and general framework for incorporating such integral or global constraints into the FEM system. This advanced practice guides you through the implementation of this technique, equipping you with a versatile tool to solve a much broader class of complex, constrained engineering problems.", "problem": "Consider the scalar heat conduction problem on the open unit square domain $\\Omega = (0,1)\\times(0,1)$ with boundary $\\partial\\Omega$. Let the thermal conductivity be a positive constant $\\kappa&gt;0$ and let the volumetric source be a constant $q$ over $\\Omega$. The unknown temperature field is $T:\\overline{\\Omega}\\to\\mathbb{R}$. The weak problem is: find $T$ such that\n$$\\int_{\\Omega} \\kappa\\, \\nabla T\\cdot \\nabla v \\, \\mathrm{d}\\Omega \\;=\\; \\int_{\\Omega} q\\, v \\, \\mathrm{d}\\Omega \\quad \\text{for all admissible } v,$$\nsubject to homogeneous natural boundary conditions on $\\partial\\Omega$ and the global boundary-averaged constraint on the right boundary edge $\\Gamma=\\{(x,y)\\in \\partial\\Omega \\mid x=1\\}$,\n$$\\frac{1}{L}\\int_{\\Gamma} T \\,\\mathrm{d}\\Gamma \\;=\\; T_{\\text{avg}},$$\nwhere $L$ is the geometric length of $\\Gamma$ and $T_{\\text{avg}}$ is a prescribed constant. All quantities are non-dimensional; no physical units are used anywhere in this problem.\n\nUsing the Finite Element Method (FEM) with continuous, piecewise linear shape functions on a uniform triangulation of $\\Omega$ obtained by subdividing $\\Omega$ into $N_x\\times N_y$ congruent rectangles and then splitting each rectangle into two triangles by a consistent diagonal, with $N_x=N_y=8$, enforce the average boundary constraint on $\\Gamma$ by introducing a single Lagrange multiplier. Define the discrete scalar unknown vector corresponding to nodal temperatures as $\\mathbf{T}\\in \\mathbb{R}^n$, the Lagrange multiplier as $\\lambda\\in \\mathbb{R}$, and use the standard Galerkin formulation for the bilinear and linear forms. Denote by $\\mathbf{B}\\in \\mathbb{R}^{1\\times n}$ the row vector whose entries are given by the appropriately scaled integrals of the nodal basis functions along $\\Gamma$ so that $\\mathbf{B}\\,\\mathbf{T} = \\frac{1}{L}\\int_{\\Gamma} T_h \\,\\mathrm{d}\\Gamma$, where $T_h$ is the finite element interpolant of $T$.\n\nYour task is to write a program that, for each test case described below, assembles the discrete linear system with the Lagrange multiplier enforcing the average constraint on $\\Gamma$, solves for $(\\mathbf{T},\\lambda)$, and reports two values per test case:\n- the absolute error between the computed average temperature on $\\Gamma$ and the prescribed $T_{\\text{avg}}$, namely $\\left|\\mathbf{B}\\,\\mathbf{T} - T_{\\text{avg}}\\right|$, and\n- the value of the Lagrange multiplier $\\lambda$.\n\nUse the following test suite of parameter triples $(\\kappa, q, T_{\\text{avg}})$:\n- Test $1$: $(\\kappa, q, T_{\\text{avg}}) = (1.0, 0.0, 2.0)$,\n- Test $2$: $(\\kappa, q, T_{\\text{avg}}) = (1.0, 1.0, 0.0)$,\n- Test $3$: $(\\kappa, q, T_{\\text{avg}}) = (2.5, 0.0, -1.0)$,\n- Test $4$: $(\\kappa, q, T_{\\text{avg}}) = (0.7, 0.5, 0.3)$.\n\nAll computations must be performed on the uniform mesh with $N_x=N_y=8$ as specified above. The right boundary $\\Gamma$ is the entire edge at $x=1$, and the homogeneous natural boundary condition applies on the remainder of $\\partial\\Omega$.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain, in sequence, for each test $i$ from $1$ to $4$, first the absolute error $\\left|\\mathbf{B}\\,\\mathbf{T} - T_{\\text{avg}}\\right|$ and then the Lagrange multiplier $\\lambda$, both rounded to six decimal places. Concretely, the output must be of the form\n$$\\big[ \\text{err}_1, \\lambda_1, \\text{err}_2, \\lambda_2, \\text{err}_3, \\lambda_3, \\text{err}_4, \\lambda_4 \\big],$$\nwhere each entry is a decimal number with exactly six digits after the decimal point.", "solution": "The problem statement has been critically examined and is determined to be valid. It describes a well-posed boundary value problem for the Poisson equation, formulated using the Finite Element Method with a Lagrange multiplier to enforce an integral constraint. At first glance, the problem appears ill-posed for a non-zero source term $q$ due to the imposition of homogeneous natural boundary conditions on the entire boundary $\\partial\\Omega$. A standard pure Neumann problem requires that the integral of the source term over the domain must be zero for a solution to exist, a condition violated in test cases where $q \\neq 0$.\n\nHowever, the introduction of a Lagrange multiplier $\\lambda$ to enforce the constraint $\\frac{1}{L}\\int_{\\Gamma} T \\,\\mathrm{d}\\Gamma = T_{\\text{avg}}$ fundamentally alters the problem. The augmented weak formulation leads to a mixed boundary value problem where the natural boundary condition $\\kappa \\nabla T \\cdot \\mathbf{n} = 0$ applies only on $\\partial\\Omega \\setminus \\Gamma$, while on the constrained boundary $\\Gamma$, the condition becomes $\\kappa \\nabla T \\cdot \\mathbf{n} = -\\lambda/L$. In this case, the compatibility condition derived from the divergence theorem becomes $\\int_\\Omega q \\, \\mathrm{d}\\Omega = \\lambda$, which serves to define the value of the Lagrange multiplier. The solution $T$ is rendered unique by the integral constraint on $\\Gamma$. The problem is thus scientifically sound and internally consistent.\n\nThe solution proceeds by discretizing the governing equations using the Finite Element Method. The starting point is the saddle-point problem derived from minimizing the system's potential energy subject to the given constraint. Find $(T, \\lambda) \\in V \\times \\mathbb{R}$ such that:\n$$\n\\int_{\\Omega} \\kappa \\nabla T \\cdot \\nabla v \\, d\\Omega + \\lambda \\left( \\frac{1}{L} \\int_{\\Gamma} v \\, d\\Gamma \\right) = \\int_{\\Omega} q v \\, d\\Omega, \\quad \\forall v \\in V\n$$\n$$\n\\frac{1}{L} \\int_{\\Gamma} T \\, d\\Gamma = T_{\\text{avg}}\n$$\nHere, $V$ is a suitable function space for the temperature field, and $v$ is the test function.\n\nThe domain $\\Omega = (0,1)\\times(0,1)$ is discretized into a uniform mesh of $N_x \\times N_y = 8 \\times 8$ rectangular cells. Each rectangle is then divided into two linear triangular elements using a consistent diagonal, resulting in $128$ elements and $(N_x+1)(N_y+1) = 81$ nodes. The temperature field $T$ is approximated as a continuous, piecewise linear function $T_h = \\sum_{j=1}^{n} T_j N_j$, where $T_j$ are the unknown nodal temperatures and $N_j$ are the linear basis (hat) functions, with $n=81$.\n\nSubstituting the approximation $T_h$ into the weak formulation and choosing the test functions $v$ to be the basis functions $N_i$ for $i=1, \\dots, n$ yields a system of linear algebraic equations. This system is augmented with the discretized constraint equation, forming a block matrix system:\n$$\n\\begin{pmatrix}\n\\mathbf{K} & \\mathbf{B}^T \\\\\n\\mathbf{B} & 0\n\\end{pmatrix}\n\\begin{pmatrix}\n\\mathbf{T} \\\\\n\\lambda\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\mathbf{f} \\\\\nT_{\\text{avg}}\n\\end{pmatrix}\n$$\nwhere $\\mathbf{T} \\in \\mathbb{R}^n$ is the vector of nodal temperatures and $\\lambda \\in \\mathbb{R}$ is the Lagrange multiplier. The components of this system are:\n\nThe global stiffness matrix $\\mathbf{K} \\in \\mathbb{R}^{n \\times n}$, with entries $K_{ij} = \\int_{\\Omega} \\kappa \\nabla N_i \\cdot \\nabla N_j \\, d\\Omega$. It is assembled by iterating over all triangular elements and summing their local contributions. For a single triangular element $e$ with area $A_e$ and nodal coordinates $(x_k, y_k)$, the element stiffness matrix $\\mathbf{k}^e$ has entries $k^e_{rs} = \\frac{\\kappa}{4 A_e} (b_r b_s + c_r c_s)$, where $b_r = y_{r+1} - y_{r+2}$ and $c_r = x_{r+2} - x_{r+1}$ (with cyclic index permutation).\n\nThe global force vector $\\mathbf{f} \\in \\mathbb{R}^n$, with entries $f_i = \\int_{\\Omega} q N_i \\, d\\Omega$. For a constant source $q$, the contribution from a single element $e$ to its three nodes is $f_i^e = \\int_{A_e} q N_i \\, d\\Omega = q A_e / 3$.\n\nThe constraint vector $\\mathbf{B} \\in \\mathbb{R}^{1 \\times n}$, with entries $B_j = \\frac{1}{L} \\int_{\\Gamma} N_j \\, d\\Gamma$. The boundary $\\Gamma$ is the edge at $x=1$ with length $L=1$. The basis function $N_j$ is non-zero on $\\Gamma$ only if node $j$ lies on this edge. The nodes on $\\Gamma$ are at coordinates $(1, j h_y)$ for $j=0, \\dots, N_y$, where $h_y = 1/N_y = 1/8$. The integral of a linear 1D basis function over an interval of length $h_y$ is $h_y/2$. Therefore, the non-zero entries of $\\mathbf{B}$ are:\n- For the two corner nodes on $\\Gamma$ (at $y=0$ and $y=1$), $B_j = (1/L) \\cdot (h_y/2) = (1/1) \\cdot (1/8)/2 = 1/16$.\n- For the $N_y-1=7$ interior nodes on $\\Gamma$, the basis function spans two segments, so $B_j = (1/L) \\cdot (h_y/2 + h_y/2) = h_y = 1/8$.\nAll other entries of $\\mathbf{B}$ are zero.\n\nThe resulting $(n+1) \\times (n+1)$ linear system is constructed as a sparse matrix and solved for the vector $(\\mathbf{T}, \\lambda)^T$. The required outputs are then calculated:\n1. The absolute error $\\left|\\mathbf{B}\\,\\mathbf{T} - T_{\\text{avg}}\\right|$. Since the constraint is enforced as an exact equation in the linear system, this error is expected to be on the order of machine precision.\n2. The Lagrange multiplier $\\lambda$. As shown by the compatibility condition, $\\lambda$ must equal the total source strength, $\\lambda = \\int_\\Omega q \\, d\\Omega = q$.\n\nThe procedure is executed for each set of parameters $(\\kappa, q, T_{\\text{avg}})$ provided in the test suite.\n\n```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Solves the heat conduction problem with an average boundary constraint\n    using the Finite Element Method with a Lagrange multiplier.\n    \"\"\"\n    test_cases = [\n        (1.0, 0.0, 2.0),\n        (1.0, 1.0, 0.0),\n        (2.5, 0.0, -1.0),\n        (0.7, 0.5, 0.3),\n    ]\n\n    results = []\n    \n    # Mesh parameters\n    Nx = 8\n    Ny = 8\n\n    for kappa, q, T_avg in test_cases:\n        # Mesh generation\n        num_nodes_x = Nx + 1\n        num_nodes_y = Ny + 1\n        num_nodes = num_nodes_x * num_nodes_y\n        hx = 1.0 / Nx\n        hy = 1.0 / Ny\n\n        node_coords = np.array([(i * hx, j * hy) for j in range(num_nodes_y) for i in range(num_nodes_x)])\n\n        # Initialize global system matrices\n        K = lil_matrix((num_nodes, num_nodes))\n        f = np.zeros(num_nodes)\n\n        # Assembly loop over rectangular cells\n        for j in range(Ny):\n            for i in range(Nx):\n                # Global indices of the 4 cell nodes (BL, BR, TL, TR)\n                n_bl = i + j * num_nodes_x\n                n_br = (i + 1) + j * num_nodes_x\n                n_tl = i + (j + 1) * num_nodes_x\n                n_tr = (i + 1) + (j + 1) * num_nodes_x\n\n                # Split rectangle into two triangles (using BL-TR diagonal)\n                triangles = [\n                    (n_bl, n_br, n_tr),  # Bottom-right triangle\n                    (n_bl, n_tr, n_tl)   # Top-left triangle\n                ]\n\n                for tri_nodes in triangles:\n                    # Element coordinates\n                    coords = node_coords[list(tri_nodes)]\n                    p1, p2, p3 = coords\n                    \n                    # Element area\n                    Ae = 0.5 * np.abs(p1[0]*(p2[1]-p3[1]) + p2[0]*(p3[1]-p1[1]) + p3[0]*(p1[1]-p2[1]))\n                    \n                    # Gradients of basis functions components\n                    b = np.array([p2[1]-p3[1], p3[1]-p1[1], p1[1]-p2[1]])\n                    c = np.array([p3[0]-p2[0], p1[0]-p3[0], p2[0]-p1[0]])\n                    \n                    # Element stiffness matrix\n                    Ke = (kappa / (4.0 * Ae)) * (np.outer(b, b) + np.outer(c, c))\n                    \n                    # Element force vector\n                    fe = (q * Ae / 3.0) * np.ones(3)\n\n                    # Assemble into global matrices\n                    for r in range(3):\n                        f[tri_nodes[r]] += fe[r]\n                        for s in range(3):\n                            K[tri_nodes[r], tri_nodes[s]] += Ke[r, s]\n        \n        # Assemble constraint vector B\n        L = 1.0 # Length of the boundary Gamma\n        B = np.zeros(num_nodes)\n        \n        # Nodes on the right boundary (x=1)\n        # Corner node at (1,0)\n        idx_bottom = Nx + 0 * num_nodes_x\n        B[idx_bottom] = (hy / 2.0) / L\n        # Corner node at (1,1)\n        idx_top = Nx + Ny * num_nodes_x\n        B[idx_top] = (hy / 2.0) / L\n        # Interior nodes\n        for j in range(1, Ny):\n            idx = Nx + j * num_nodes_x\n            B[idx] = hy / L\n\n        # Construct the augmented saddle-point system\n        n = num_nodes\n        M = lil_matrix((n + 1, n + 1))\n        rhs = np.zeros(n + 1)\n        \n        M[:n, :n] = K\n        M[:n, n] = B.reshape(-1, 1)\n        M[n, :n] = B\n        \n        rhs[:n] = f\n        rhs[n] = T_avg\n        \n        # Solve the linear system\n        M_csc = M.tocsc()\n        solution = spsolve(M_csc, rhs)\n\n        T_vec = solution[:n]\n        lambda_val = solution[n]\n        \n        # Post-processing: calculate error\n        T_avg_computed = np.dot(B, T_vec)\n        error = np.abs(T_avg_computed - T_avg)\n        \n        results.append(\"{:.6f}\".format(error))\n        results.append(\"{:.6f}\".format(lambda_val))\n\n    print(f\"[{','.join(results)}]\")\n\n# solve()\n```", "answer": "`[0.000000,-0.000000,0.000000,1.000000,0.000000,-0.000000,0.000000,0.500000]`", "id": "2402864"}]}