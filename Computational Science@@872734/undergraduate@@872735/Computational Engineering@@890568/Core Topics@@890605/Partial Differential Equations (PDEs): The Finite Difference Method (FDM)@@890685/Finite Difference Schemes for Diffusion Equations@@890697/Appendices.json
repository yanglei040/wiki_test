{"hands_on_practices": [{"introduction": "The Forward-Time Central-Space (FTCS) scheme is often the first method taught for the diffusion equation due to its conceptual simplicity. However, this simplicity comes at the cost of conditional stability, a crucial concept in numerical analysis. This exercise guides you through a von Neumann stability analysis to pinpoint the exact Fourier mode that becomes unstable first, providing a concrete understanding of why and how numerical solutions can fail [@problem_id:2392558]. Mastering this analysis is fundamental to diagnosing and preventing instabilities in more complex simulations.", "problem": "Consider the one-dimensional diffusion equation $u_{t}=\\alpha u_{xx}$ with constant diffusivity $\\alpha>0$ on a spatially periodic domain of length $L>0$. Discretize space with an even number $N$ of uniformly spaced grid points $x_{j}=j\\,\\Delta x$ for $j\\in\\{0,1,\\ldots,N-1\\}$, where $\\Delta x=L/N$, and advance in time with step $\\Delta t>0$ using the Forward Time, Central Space (FTCS) scheme\n$$\nu_{j}^{n+1}=u_{j}^{n}+\\frac{\\alpha\\,\\Delta t}{\\Delta x^{2}}\\left(u_{j+1}^{n}-2\\,u_{j}^{n}+u_{j-1}^{n}\\right),\n$$\nwith periodic boundary conditions. Suppose the time step and grid spacing are chosen such that $\\alpha\\,\\Delta t/\\Delta x^{2}>\\tfrac{1}{2}$, so the scheme is unstable.\n\nAmong all discrete spatial Fourier modes permitted by the grid and periodicity, identify the single wavenumber $\\kappa^{\\star}$ (in radians per meter) whose mode experiences the largest one-step amplification in magnitude under this scheme. Report $\\kappa^{\\star}$ chosen from the principal interval $(-\\pi/\\Delta x,\\pi/\\Delta x]$. Express your final answer as a closed-form analytic expression in terms of $\\Delta x$. No rounding is required, and express the wavenumber in radians per meter.", "solution": "The problem asks to identify the wavenumber $\\kappa^{\\star}$ of the spatial Fourier mode that experiences the largest amplification in magnitude for the Forward Time, Central Space (FTCS) scheme applied to the one-dimensional diffusion equation, under the condition of instability.\n\nThe one-dimensional diffusion equation is given by\n$$u_{t} = \\alpha u_{xx}$$\nwhere $u(x,t)$ is the diffusing quantity, $t$ is time, $x$ is the spatial coordinate, and $\\alpha > 0$ is the constant diffusivity. The domain is periodic with length $L$.\n\nThe FTCS discretization is\n$$u_{j}^{n+1} = u_{j}^{n} + \\frac{\\alpha \\Delta t}{\\Delta x^{2}}(u_{j+1}^{n} - 2u_{j}^{n} + u_{j-1}^{n})$$\nwhere $u_j^n \\approx u(j\\Delta x, n\\Delta t)$, $\\Delta x = L/N$ is the spatial step with $N$ being an even integer, and $\\Delta t$ is the time step. Let us define the diffusion number $r = \\frac{\\alpha \\Delta t}{\\Delta x^{2}}$. The problem states that the scheme is unstable, which corresponds to the condition $r > \\frac{1}{2}$.\n\nTo analyze the stability of the scheme, we use the von Neumann stability analysis. We consider a single Fourier mode as a solution:\n$$u_{j}^{n} = \\hat{u}^{n}(\\kappa) e^{i \\kappa x_{j}} = \\hat{u}^{n}(\\kappa) e^{i \\kappa j \\Delta x}$$\nwhere $\\kappa$ is the wavenumber and $\\hat{u}^{n}(\\kappa)$ is the amplitude of the mode at time step $n$. The amplification of the mode from one time step to the next is given by the amplification factor $G(\\kappa) = \\frac{\\hat{u}^{n+1}(\\kappa)}{\\hat{u}^{n}(\\kappa)}$.\n\nSubstituting the Fourier mode into the FTCS scheme:\n$$\\hat{u}^{n+1}(\\kappa) e^{i \\kappa j \\Delta x} = \\hat{u}^{n}(\\kappa) e^{i \\kappa j \\Delta x} + r \\left( \\hat{u}^{n}(\\kappa) e^{i \\kappa (j+1) \\Delta x} - 2\\hat{u}^{n}(\\kappa) e^{i \\kappa j \\Delta x} + \\hat{u}^{n}(\\kappa) e^{i \\kappa (j-1) \\Delta x} \\right)$$\nDividing by $\\hat{u}^{n}(\\kappa) e^{i \\kappa j \\Delta x}$ (assuming a non-trivial mode), we obtain the amplification factor $G(\\kappa)$:\n$$G(\\kappa) = 1 + r (e^{i \\kappa \\Delta x} - 2 + e^{-i \\kappa \\Delta x})$$\nUsing Euler's identity $e^{i\\theta} + e^{-i\\theta} = 2\\cos(\\theta)$, we can simplify the expression:\n$$G(\\kappa) = 1 + r (2\\cos(\\kappa \\Delta x) - 2) = 1 - 2r(1 - \\cos(\\kappa \\Delta x))$$\nUsing the half-angle trigonometric identity $1 - \\cos(\\theta) = 2\\sin^2(\\frac{\\theta}{2})$, the amplification factor becomes:\n$$G(\\kappa) = 1 - 4r \\sin^2\\left(\\frac{\\kappa \\Delta x}{2}\\right)$$\nWe are tasked with finding the wavenumber $\\kappa^{\\star}$ that maximizes the magnitude of the amplification factor, $|G(\\kappa)|$, for wavenumbers in the principal interval $\\kappa \\in (-\\pi/\\Delta x, \\pi/\\Delta x]$. Since $\\kappa$ is a real number, $G(\\kappa)$ is also a real number. Therefore, we seek to maximize $|G(\\kappa)| = \\left|1 - 4r \\sin^2\\left(\\frac{\\kappa \\Delta x}{2}\\right)\\right|$.\n\nLet the variable $\\theta = \\frac{\\kappa \\Delta x}{2}$. As $\\kappa$ ranges over $(-\\pi/\\Delta x, \\pi/\\Delta x]$, $\\theta$ ranges over $(-\\pi/2, \\pi/2]$.\nLet $S = \\sin^2(\\theta)$. For $\\theta \\in (-\\pi/2, \\pi/2]$, the values of $\\sin(\\theta)$ range from just above $-1$ to $1$, so $S = \\sin^2(\\theta)$ ranges over the interval $[0, 1]$. Specifically, $S=0$ when $\\theta=0$ (i.e. $\\kappa=0$), and $S=1$ when $\\theta=\\pm\\pi/2$ (i.e. $\\kappa=\\pm\\pi/\\Delta x$). The value $\\theta=\\pi/2$ is included in the domain.\n\nThe problem reduces to finding the maximum of the function $f(S) = |1 - 4rS|$ over the interval $S \\in [0, 1]$, with the given condition $r > \\frac{1}{2}$.\nThe function $g(S) = 1 - 4rS$ is linear in $S$. The maximum value of its magnitude, $|g(S)|$, on a closed interval must be attained at one of the endpoints of the interval.\nLet us evaluate $f(S)$ at the endpoints $S=0$ and $S=1$:\n1. At $S=0$: $f(0) = |1 - 4r(0)| = |1| = 1$.\n2. At $S=1$: $f(1) = |1 - 4r(1)| = |1 - 4r|$.\nGiven that $r > \\frac{1}{2}$, it follows that $4r > 2$, and thus $1 - 4r < 1 - 2 = -1$.\nTherefore, $|1 - 4r| = -(1 - 4r) = 4r - 1$.\nComparing the two values, since $r > \\frac{1}{2}$, we have $4r - 1 > 4(\\frac{1}{2}) - 1 = 2-1 = 1$.\nThus, the maximum magnitude of the amplification factor is $4r - 1$, and it occurs when $S=1$.\n\nThe wavenumber $\\kappa^{\\star}$ we seek is the one for which $S = \\sin^2\\left(\\frac{\\kappa^{\\star} \\Delta x}{2}\\right) = 1$.\nThis implies $\\sin\\left(\\frac{\\kappa^{\\star} \\Delta x}{2}\\right) = \\pm 1$.\nThe general solution for this is $\\frac{\\kappa^{\\star} \\Delta x}{2} = \\frac{\\pi}{2} + n\\pi$ for any integer $n$.\nSolving for $\\kappa^{\\star}$:\n$$\\kappa^{\\star} \\Delta x = \\pi + 2n\\pi = (2n+1)\\pi$$\n$$\\kappa^{\\star} = \\frac{(2n+1)\\pi}{\\Delta x}$$\nWe must select the value of $\\kappa^{\\star}$ that lies within the specified principal interval $\\kappa^{\\star} \\in (-\\pi/\\Delta x, \\pi/\\Delta x]$.\n- If $n=0$, $\\kappa^{\\star} = \\frac{\\pi}{\\Delta x}$. This value is in the interval, as $\\pi/\\Delta x \\in (-\\pi/\\Delta x, \\pi/\\Delta x]$.\n- If $n=-1$, $\\kappa^{\\star} = \\frac{-\\pi}{\\Delta x}$. This value is not in the interval, because the lower bound is open.\n- For any other integer $n$, the value of $\\kappa^{\\star}$ will lie outside the interval.\n\nTherefore, the unique wavenumber in the given interval that corresponds to the maximum amplification is $\\kappa^{\\star} = \\frac{\\pi}{\\Delta x}$. This wavenumber corresponds to the highest frequency mode that can be represented on the grid, with a wavelength of $\\lambda = 2\\Delta x$. This is the Nyquist frequency of the spatial grid. This mode has the pattern $u_j \\propto (-1)^j$, which is known to be the most unstable mode for the FTCS scheme when $r > 1/2$.\nThe problem states that the grid has an even number of points, $N$. The set of discrete wavenumbers supported by such a grid is $\\kappa_m = \\frac{2\\pi m}{N\\Delta x}$ for $m \\in \\{-N/2+1, \\dots, N/2\\}$. The wavenumber $\\kappa^{\\star} = \\frac{\\pi}{\\Delta x}$ is part of this discrete set, corresponding to the index $m=N/2$. Thus, our solution is consistent with the discrete nature of the problem.\nThe final answer is the expression for this wavenumber.", "answer": "$$\\boxed{\\frac{\\pi}{\\Delta x}}$$", "id": "2392558"}, {"introduction": "Real-world engineering analyses rarely involve simple, rectangular domains. This practice moves from transient behavior to the steady-state diffusion equation (Laplace's equation) and challenges you to tackle a problem with more complex geometry: a square plate with a circular hole [@problem_id:2392562]. By implementing a finite difference solver for this scenario, you will develop essential skills in handling internal boundaries, assembling sparse linear systems, and verifying your code using the powerful method of manufactured solutions.", "problem": "Consider the steady diffusion of a scalar field $u(x,y)$ with constant diffusivity $k$ in a two-dimensional domain $\\Omega$ that is a square with an internal circular hole. Starting from the conservation of flux and Fick's law, the governing Partial Differential Equation (PDE) for steady diffusion with no volumetric sources is\n$$\n-\\nabla \\cdot (k \\nabla u) = 0 \\quad \\text{in } \\Omega \\setminus \\mathcal{H},\n$$\nwhere $\\mathcal{H}$ is the interior of the hole. On both the external square boundary $\\partial \\Omega$ and the internal boundary $\\partial \\mathcal{H}$, impose Dirichlet boundary conditions $u=g(x,y)$, where $g(x,y)$ is prescribed. For numerical verification, use the method of manufactured solutions with the exact solution\n$$\nu^{\\star}(x,y) = e^{x}\\cos(y),\n$$\nand set $k=1$. Then the source term compatible with $u^{\\star}(x,y)$ satisfies\n$$\n-\\nabla \\cdot (k \\nabla u^{\\star}) = 0,\n$$\nso the PDE remains homogeneous inside $\\Omega \\setminus \\mathcal{H}$ and the Dirichlet data are $u=g=u^{\\star}$ on both boundaries. Discretize $\\Omega=[-1,1]\\times[-1,1]$ with a uniform Cartesian grid of $N\\times N$ nodes, where $N$ is a given integer greater than or equal to $5$, and grid spacing $h = \\frac{2}{N-1}$. Let the node coordinates be $x_i=-1+ih$ and $y_j=-1+jh$ for $i,j\\in\\{0,1,\\dots,N-1\\}$. Define the circular hole by its center $(x_c,y_c)$ and radius $r$. The internal boundary is to be handled as follows:\n- Mark as hole-interior every grid node $(i,j)$ whose center satisfies $(x_i-x_c)^2+(y_j-y_c)^2<r^2$; these nodes are excluded from the computational domain.\n- Mark as internal boundary every grid node $(i,j)$ that is not hole-interior and has at least one of the four grid neighbors hole-interior; impose Dirichlet data $u_{i,j}=u^{\\star}(x_i,y_j)$ on those nodes.\n- Mark as external boundary the nodes with $i\\in\\{0,N-1\\}$ or $j\\in\\{0,N-1\\}$; impose Dirichlet data $u_{i,j}=u^{\\star}(x_i,y_j)$ on those nodes.\n- The unknowns are all remaining nodes, i.e., nodes that are not hole-interior and are not on any boundary.\n\nOn the set of unknowns, derive and implement the second-order five-point Finite Difference Method (FDM) approximation of the Laplacian consistent with the fundamental definition of second derivatives, namely that for any interior unknown $(i,j)$,\n$$\n4u_{i,j} - u_{i-1,j} - u_{i+1,j} - u_{i,j-1} - u_{i,j+1} = 0,\n$$\nwith neighbor contributions moved to the right-hand side if that neighbor is a boundary node with known value. Assemble the resulting linear system in the canonical sparse format and solve for $u$ at unknown nodes. After solving, compute the maximum absolute error with respect to $u^{\\star}$ over all unknown nodes:\n$$\nE_{\\infty} = \\max_{(i,j)\\in \\mathcal{U}} \\left| u_{i,j} - u^{\\star}(x_i,y_j) \\right|,\n$$\nwhere $\\mathcal{U}$ is the index set of unknowns.\n\nThere are no physical units to report in this problem. Angles in $u^{\\star}(x,y)$ use radians, because $y$ is a Cartesian coordinate and the cosine function is in radians.\n\nImplement a complete program that performs the above computation for the following test suite, each specified by $(N, x_c, y_c, r)$:\n- Test $1$: $N=65$, $x_c=0.2$, $y_c=-0.1$, $r=0.35$.\n- Test $2$: $N=65$, $x_c=0.0$, $y_c=0.0$, $r=0.12$.\n- Test $3$: $N=33$, $x_c=-0.3$, $y_c=0.4$, $r=0.30$.\n- Test $4$: $N=97$, $x_c=0.55$, $y_c=0.0$, $r=0.40$.\n\nFor each test, compute $E_{\\infty}$ as defined above. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each error formatted in scientific notation with eight digits after the decimal point (for example, $[1.23456789e-04, 5.00000000e-05]$).", "solution": "The problem statement is critically examined and found to be valid. It is scientifically grounded, well-posed, objective, and self-contained. It describes a standard problem in computational engineering: solving the Laplace equation on a complex domain using the finite difference method with a manufactured solution for verification. We proceed with the derivation and implementation.\n\nThe governing partial differential equation for steady diffusion with constant diffusivity $k=1$ and no sources is the two-dimensional Laplace equation:\n$$\n\\nabla^2 u = \\frac{\\partial^2 u}{\\partial x^2} + \\frac{\\partial^2 u}{\\partial y^2} = 0\n$$\nThis equation holds in the domain $\\Omega \\setminus \\mathcal{H}$, where $\\Omega = [-1,1] \\times [-1,1]$ is a square and $\\mathcal{H}$ is an internal circular hole. Dirichlet boundary conditions are prescribed on the external boundary $\\partial\\Omega$ and the internal boundary $\\partial\\mathcal{H}$ using the manufactured solution $u^{\\star}(x,y) = e^{x}\\cos(y)$.\n\nThe domain is discretized using a uniform Cartesian grid of $N \\times N$ nodes. The coordinates of a node $(i,j)$ for $i,j \\in \\{0, 1, \\dots, N-1\\}$ are given by $(x_i, y_j)$, where $x_i = -1 + ih$ and $y_j = -1 + jh$. The grid spacing is $h = \\frac{2}{N-1}$. Let $u_{i,j}$ denote the numerical approximation of $u(x_i, y_j)$.\n\nThe Laplace operator is approximated at an interior node $(x_i, y_j)$ using second-order central differences:\n$$\n\\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{(x_i, y_j)} \\approx \\frac{u_{i-1,j} - 2u_{i,j} + u_{i+1,j}}{h^2}\n$$\n$$\n\\frac{\\partial^2 u}{\\partial y^2}\\bigg|_{(x_i, y_j)} \\approx \\frac{u_{i,j-1} - 2u_{i,j} + u_{i,j+1}}{h^2}\n$$\nSubstituting these approximations into the Laplace equation and multiplying by $h^2$ yields the five-point finite difference stencil:\n$$\n(u_{i-1,j} - 2u_{i,j} + u_{i+1,j}) + (u_{i,j-1} - 2u_{i,j} + u_{i,j+1}) = 0\n$$\nRearranging the terms gives the equation for each unknown interior node:\n$$\n4u_{i,j} - u_{i-1,j} - u_{i+1,j} - u_{i,j-1} - u_{i,j+1} = 0\n$$\n\nThe core of the numerical procedure is the classification of each grid node $(i,j)$ to determine whether its value $u_{i,j}$ is an unknown to be solved for or a known boundary value. We define three categories of nodes:\n1.  **Hole Nodes**: Nodes whose coordinates $(x_i, y_j)$ satisfy $(x_i - x_c)^2 + (y_j - y_c)^2 < r^2$. These nodes are excluded from the computation.\n2.  **Boundary Nodes**: These are nodes where the value of $u$ is prescribed. This category includes:\n    (a) External boundary nodes on $\\partial\\Omega$, where $i \\in \\{0, N-1\\}$ or $j \\in \\{0, N-1\\}$.\n    (b) Internal boundary nodes, which are non-hole nodes that have at least one of their four cardinal neighbors (left, right, top, bottom) classified as a hole node.\n    For all boundary nodes, the value is set to the exact solution, $u_{i,j} = u^{\\star}(x_i, y_j)$.\n3.  **Unknown Nodes**: These are all nodes within the domain $\\Omega \\setminus \\mathcal{H}$ that are not classified as boundary nodes. The values $u_{i,j}$ at these nodes are the unknowns of the problem.\n\nLet there be $M$ unknown nodes. We construct a linear system of equations $A\\mathbf{u}_{\\text{unk}} = \\mathbf{b}$ of size $M \\times M$. The vector $\\mathbf{u}_{\\text{unk}}$ contains the $M$ unknown values of $u$. A mapping is established between the two-dimensional index $(i,j)$ of an unknown node and a one-dimensional index $k \\in \\{0, 1, \\dots, M-1\\}$.\n\nFor each unknown node $(i,j)$ with corresponding index $k$, we write the $k$-th equation of the linear system based on the five-point stencil. The matrix $A$ and vector $\\mathbf{b}$ are assembled as follows:\n- The diagonal entry is $A_{k,k} = 4$.\n- The right-hand side vector entry $b_k$ is initialized to $0$.\n- For each of the four neighbors of $(i,j)$, say at index $(i', j')$:\n    - If the neighbor is also an unknown node with index $p$, we set the off-diagonal entry $A_{k,p} = -1$.\n    - If the neighbor is a boundary node (either internal or external), its value $u_{i',j'}$ is known. This known value is moved to the right-hand side of the equation. So, we add its value to $b_k$: $b_k \\leftarrow b_k + u^{\\star}(x_{i'}, y_{j'})$.\n\nThe resulting matrix $A$ is sparse, symmetric, and diagonally dominant, which guarantees that a unique solution exists. This system is efficiently solved for $\\mathbf{u}_{\\text{unk}}$ using a sparse linear algebra solver.\n\nAfter obtaining the numerical solution $u_{i,j}$ at all unknown nodes, the maximum absolute error $E_{\\infty}$ is computed to assess the accuracy of the method. The error is calculated with respect to the known manufactured solution $u^{\\star}$:\n$$\nE_{\\infty} = \\max_{(i,j) \\in \\mathcal{U}} | u_{i,j} - u^{\\star}(x_i,y_j) |\n$$\nwhere $\\mathcal{U}$ is the set of indices corresponding to all unknown nodes. This procedure is implemented and applied to the specified test cases.", "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\nfrom scipy.ndimage import binary_dilation\n\ndef solve_one_case(N, xc, yc, r):\n    \"\"\"\n    Solves the 2D Laplace equation on a square domain with a circular hole\n    for a single set of parameters.\n    \"\"\"\n    # Node type constants\n    HOLE = -1\n    UNKNOWN = 0\n    BOUNDARY = 1\n\n    # 1. Grid Generation and Node Classification\n    x = np.linspace(-1, 1, N)\n    y = np.linspace(-1, 1, N)\n    xx, yy = np.meshgrid(x, y, indexing='ij')\n\n    node_type = np.full((N, N), UNKNOWN, dtype=int)\n\n    # Classify hole nodes\n    is_hole = (xx - xc)**2 + (yy - yc)**2 < r**2\n    node_type[is_hole] = HOLE\n\n    # Classify boundary nodes (both external and internal)\n    is_boundary = np.zeros_like(node_type, dtype=bool)\n    \n    # External boundaries\n    is_boundary[0, :] = True\n    is_boundary[N - 1, :] = True\n    is_boundary[:, 0] = True\n    is_boundary[:, N - 1] = True\n    \n    # Internal boundaries (nodes adjacent to the hole)\n    # A 5-point cross-shaped structuring element identifies cardinal neighbors.\n    struct = np.array([[0, 1, 0], [1, 1, 1], [0, 1, 0]], dtype=bool)\n    dilated_hole = binary_dilation(is_hole, structure=struct)\n    is_internal_boundary = dilated_hole & ~is_hole\n    is_boundary |= is_internal_boundary\n\n    # Apply boundary classification, ensuring hole nodes are not overwritten.\n    node_type[is_boundary & ~is_hole] = BOUNDARY\n\n    # 2. Map unknown nodes to linear indices for the linear system\n    unknown_indices = np.where(node_type == UNKNOWN)\n    num_unknowns = len(unknown_indices[0])\n    \n    map_ij_to_k = { (i, j): k for k, (i, j) in enumerate(zip(*unknown_indices)) }\n\n    # 3. Assemble the linear system Ax = b\n    # LIL format is efficient for building the sparse matrix\n    A = lil_matrix((num_unknowns, num_unknowns), dtype=float)\n    b = np.zeros(num_unknowns, dtype=float)\n    \n    u_exact = np.exp(xx) * np.cos(yy)\n\n    for k in range(num_unknowns):\n        i, j = unknown_indices[0][k], unknown_indices[1][k]\n        \n        # Diagonal term from the 5-point stencil\n        A[k, k] = 4.0\n        \n        # Consider the four cardinal neighbors\n        for ni, nj in [(i - 1, j), (i + 1, j), (i, j - 1), (i, j + 1)]:\n            neighbor_type = node_type[ni, nj]\n            \n            if neighbor_type == UNKNOWN:\n                # Off-diagonal term for an unknown neighbor\n                p = map_ij_to_k[(ni, nj)]\n                A[k, p] = -1.0\n            elif neighbor_type == BOUNDARY:\n                # Known value from a boundary neighbor contributes to the RHS\n                b[k] += u_exact[ni, nj]\n\n    # 4. Solve the sparse linear system\n    # Convert to CSR format for efficient solving\n    A_csr = A.tocsr()\n    u_vec_numeric = spsolve(A_csr, b)\n\n    # 5. Compute the maximum absolute error\n    u_vec_exact = u_exact[unknown_indices]\n    max_abs_error = np.max(np.abs(u_vec_numeric - u_vec_exact))\n    \n    return max_abs_error\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, xc, yc, r)\n        (65, 0.2, -0.1, 0.35),\n        (65, 0.0, 0.0, 0.12),\n        (33, -0.3, 0.4, 0.30),\n        (97, 0.55, 0.0, 0.40),\n    ]\n\n    results = []\n    for case in test_cases:\n        error = solve_one_case(*case)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{e:.8e}' for e in results)}]\")\n\nsolve()\n```", "id": "2392562"}, {"introduction": "To overcome the restrictive time-step limitations of explicit schemes in multiple dimensions, we often turn to more advanced methods like Alternating Direction Implicit (ADI) schemes. This exercise delves into the stability of an ADI method applied to a diffusion equation that includes a challenging mixed-derivative term, $\\frac{\\partial^2 u}{\\partial x \\partial y}$ [@problem_id:2392607]. You will combine the analytical rigor of von Neumann analysis with a computational approach to map the stability region, a task that mirrors the process of developing and validating robust numerical methods for cutting-edge applications.", "problem": "Consider the two-dimensional diffusion equation with constant coefficients and a mixed second derivative on a uniform Cartesian grid with equal spacing in both directions, governed by the partial differential equation\n$$\n\\frac{\\partial u}{\\partial t} = \\alpha \\frac{\\partial^{2} u}{\\partial x^{2}} + \\beta \\frac{\\partial^{2} u}{\\partial y^{2}} + \\gamma \\frac{\\partial^{2} u}{\\partial x \\partial y},\n$$\nwhere $u = u(x,y,t)$, $\\alpha > 0$, $\\beta > 0$, and $\\gamma \\in \\mathbb{R}$, with spatial step size $h > 0$ and time step $\\Delta t > 0$. Assume a uniform grid, periodic boundaries, and that the central difference approximations are used for all second derivatives, including the standard $5$-point stencil for the pure second derivatives and the standard $4$-point central stencil for the mixed derivative. Define the dimensionless ratios $r = \\Delta t / h^{2}$, $r_{x} = \\alpha r$, $r_{y} = \\beta r$, and $r_{xy} = \\gamma r$. Consider the following Alternating Direction Implicit (ADI) scheme that treats the mixed derivative term explicitly at each half step:\n- First half-step:\n$$\n\\left(I - \\frac{\\Delta t}{2} \\,\\alpha D_{xx}^{h}\\right) u^{\\star} = \\left(I + \\frac{\\Delta t}{2}\\, \\beta D_{yy}^{h}\\right) u^{n} + \\frac{\\Delta t}{2}\\, \\gamma D_{xy}^{h} \\, u^{n}.\n$$\n- Second half-step:\n$$\n\\left(I - \\frac{\\Delta t}{2} \\,\\beta D_{yy}^{h}\\right) u^{n+1} = \\left(I + \\frac{\\Delta t}{2}\\, \\alpha D_{xx}^{h}\\right) u^{\\star} + \\frac{\\Delta t}{2}\\, \\gamma D_{xy}^{h} \\, u^{\\star}.\n$$\nHere, $D_{xx}^{h}$, $D_{yy}^{h}$, and $D_{xy}^{h}$ denote the standard central difference operators for $\\partial^{2}/\\partial x^{2}$, $\\partial^{2}/\\partial y^{2}$, and $\\partial^{2}/\\partial x \\partial y$, respectively, on the uniform grid with spacing $h$. Assume an infinite periodic grid so that Fourier (von Neumann) analysis applies.\n\nTask:\n- Starting from the definition of von Neumann (Fourier) stability analysis and the symbols of the central difference operators on a uniform grid, derive the scalar amplification factor $G(\\theta_{x}, \\theta_{y}; r_{x}, r_{y}, r_{xy})$ for a single Fourier mode, where $\\theta_{x}$ and $\\theta_{y}$ are the dimensionless wavenumbers in the $x$ and $y$ directions, each in the interval $[-\\pi, \\pi]$.\n- State the stability condition in terms of the amplification factor and explain the roles of $r_{x}$, $r_{y}$, and $r_{xy}$.\n- Design an algorithm that, for given $(\\alpha,\\beta,\\gamma,r)$, computes the maximum modulus of the amplification factor over $(\\theta_{x},\\theta_{y}) \\in [-\\pi,\\pi] \\times [-\\pi,\\pi]$ by uniform sampling on a square grid of $N \\times N$ points with $N$ chosen as $N = 801$. Use this maximum to decide stability by the condition $\\max_{\\theta_{x},\\theta_{y}} |G| \\le 1$.\n- There are no physical units to report in this problem; all quantities are dimensionless by construction.\n\nTest suite:\n- Use the following four parameter sets $(\\alpha,\\beta,\\gamma,r)$:\n    - Case $1$: $(1.0, 1.0, 0.0, 5.0)$.\n    - Case $2$: $(1.0, 1.0, 1.0, 0.25)$.\n    - Case $3$: $(1.0, 1.0, 1.5, 4.0)$.\n    - Case $4$: $(1.0, 2.0, 1.8, 1.0)$.\n- For each case, compute the maximum modulus of the amplification factor and determine stability using the criterion above.\n\nFinal output format requirement:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain, for each case in the order given, first the maximum amplification factor rounded to six decimal places, followed by a boolean stability indicator. For example, the output format must be of the form\n$$\n[\\text{max}_{1}, \\text{stable}_{1}, \\text{max}_{2}, \\text{stable}_{2}, \\text{max}_{3}, \\text{stable}_{3}, \\text{max}_{4}, \\text{stable}_{4}],\n$$\nwhere each $\\text{max}_{k}$ is a float with six digits after the decimal point and each $\\text{stable}_{k}$ is either $\\text{True}$ or $\\text{False}$.", "solution": "The problem requires a rigorous von Neumann stability analysis of a specified Alternating Direction Implicit (ADI) scheme for the two-dimensional diffusion equation with a mixed derivative term. The analysis will proceed methodically, beginning with the derivation of the amplification factor.\n\nFirst, we establish the analytical tools. The von Neumann analysis assumes a single Fourier mode as a solution on the computational grid. For a grid point $(x_j, y_k) = (j h, k h)$ at time $t_n = n \\Delta t$, this mode is expressed as:\n$$\nu_{j,k}^n = \\hat{u}^n e^{i(k_x x_j + k_y y_k)} = \\hat{u}^n e^{i(j \\theta_x + k \\theta_y)}\n$$\nwhere $\\hat{u}^n$ is the complex amplitude of the mode at time step $n$, $k_x$ and $k_y$ are the wavenumbers, and $\\theta_x = k_x h$ and $\\theta_y = k_y h$ are the dimensionless wavenumbers, with $\\theta_x, \\theta_y \\in [-\\pi, \\pi]$. The action of a linear difference operator on this mode is equivalent to multiplying its amplitude by a complex number known as the symbol of the operator.\n\nWe now derive the symbols for the specified central difference operators.\nThe second partial derivative with respect to $x$ is approximated by $D_{xx}^h$:\n$$\nD_{xx}^h u_{j,k}^n = \\frac{u_{j+1,k}^n - 2u_{j,k}^n + u_{j-1,k}^n}{h^2}\n$$\nApplying this to the Fourier mode yields:\n$$\nD_{xx}^h \\left(\\hat{u}^n e^{ij\\theta_x} e^{ik\\theta_y}\\right) = \\frac{\\hat{u}^n e^{ik\\theta_y} (e^{i(j+1)\\theta_x} - 2e^{ij\\theta_x} + e^{i(j-1)\\theta_x})}{h^2} = \\left(\\frac{e^{i\\theta_x} - 2 + e^{-i\\theta_x}}{h^2}\\right) u_{j,k}^n\n$$\nThe symbol of the operator $D_{xx}^h$, denoted $\\widehat{D_{xx}^h}$, is thus:\n$$\n\\widehat{D_{xx}^h} = \\frac{2\\cos(\\theta_x) - 2}{h^2} = -\\frac{4}{h^2}\\sin^2\\left(\\frac{\\theta_x}{2}\\right)\n$$\nBy symmetry, the symbol for $D_{yy}^h$ is:\n$$\n\\widehat{D_{yy}^h} = -\\frac{4}{h^2}\\sin^2\\left(\\frac{\\theta_y}{2}\\right)\n$$\nThe mixed derivative is approximated by the $4$-point central stencil $D_{xy}^h$:\n$$\nD_{xy}^h u_{j,k}^n = \\frac{u_{j+1,k+1}^n - u_{j+1,k-1}^n - u_{j-1,k+1}^n + u_{j-1,k-1}^n}{4h^2}\n$$\nThe symbol for this operator, $\\widehat{D_{xy}^h}$, is derived as follows:\n$$\n\\widehat{D_{xy}^h} = \\frac{e^{i(\\theta_x+\\theta_y)} - e^{i(\\theta_x-\\theta_y)} - e^{i(-\\theta_x+\\theta_y)} + e^{i(-\\theta_x-\\theta_y)}}{4h^2} = \\frac{(e^{i\\theta_x} - e^{-i\\theta_x})(e^{i\\theta_y} - e^{-i\\theta_y})}{4h^2} = \\frac{(2i\\sin\\theta_x)(2i\\sin\\theta_y)}{4h^2}\n$$\n$$\n\\widehat{D_{xy}^h} = -\\frac{\\sin\\theta_x \\sin\\theta_y}{h^2}\n$$\nNotice that all three symbols are purely real quantities.\n\nNext, we transform the two half-steps of the ADI scheme into Fourier space. The amplitudes of the Fourier mode at steps $n$, the intermediate step $\\star$, and $n+1$ are denoted by $\\hat{u}^n$, $\\hat{u}^\\star$, and $\\hat{u}^{n+1}$, respectively.\nThe first half-step is:\n$$\n\\left(I - \\frac{\\Delta t}{2} \\alpha D_{xx}^{h}\\right) u^{\\star} = \\left(I + \\frac{\\Delta t}{2} \\beta D_{yy}^{h} + \\frac{\\Delta t}{2} \\gamma D_{xy}^{h}\\right) u^{n}\n$$\nIn Fourier space, this becomes an algebraic equation:\n$$\n\\left(1 - \\frac{\\Delta t}{2} \\alpha \\widehat{D_{xx}^h}\\right) \\hat{u}^{\\star} = \\left(1 + \\frac{\\Delta t}{2} \\beta \\widehat{D_{yy}^h} + \\frac{\\Delta t}{2} \\gamma \\widehat{D_{xy}^h}\\right) \\hat{u}^{n}\n$$\nThe second half-step is:\n$$\n\\left(I - \\frac{\\Delta t}{2} \\beta D_{yy}^{h}\\right) u^{n+1} = \\left(I + \\frac{\\Delta t}{2} \\alpha D_{xx}^{h} + \\frac{\\Delta t}{2} \\gamma D_{xy}^{h}\\right) u^{\\star}\n$$\nIn Fourier space:\n$$\n\\left(1 - \\frac{\\Delta t}{2} \\beta \\widehat{D_{yy}^h}\\right) \\hat{u}^{n+1} = \\left(1 + \\frac{\\Delta t}{2} \\alpha \\widehat{D_{xx}^h} + \\frac{\\Delta t}{2} \\gamma \\widehat{D_{xy}^h}\\right) \\hat{u}^{\\star}\n$$\nTo simplify, we substitute the symbols and use the dimensionless ratios $r_x = \\alpha \\Delta t/h^2$, $r_y = \\beta \\Delta t/h^2$, and $r_{xy} = \\gamma \\Delta t/h^2$.\nLet's define the following real-valued terms:\n$$\nA = \\frac{\\Delta t}{2} \\alpha \\widehat{D_{xx}^h} = \\frac{\\Delta t \\alpha}{2} \\left(-\\frac{4}{h^2}\\sin^2\\left(\\frac{\\theta_x}{2}\\right)\\right) = -2 r_x \\sin^2\\left(\\frac{\\theta_x}{2}\\right)\n$$\n$$\nB = \\frac{\\Delta t}{2} \\beta \\widehat{D_{yy}^h} = \\frac{\\Delta t \\beta}{2} \\left(-\\frac{4}{h^2}\\sin^2\\left(\\frac{\\theta_y}{2}\\right)\\right) = -2 r_y \\sin^2\\left(\\frac{\\theta_y}{2}\\right)\n$$\n$$\nC = \\frac{\\Delta t}{2} \\gamma \\widehat{D_{xy}^h} = \\frac{\\Delta t \\gamma}{2} \\left(-\\frac{\\sin\\theta_x \\sin\\theta_y}{h^2}\\right) = -\\frac{r_{xy}}{2}\\sin\\theta_x\\sin\\theta_y\n$$\nUsing these definitions, the system of equations simplifies to:\n$$\n(1 - A) \\hat{u}^{\\star} = (1 + B + C) \\hat{u}^{n}\n$$\n$$\n(1 - B) \\hat{u}^{n+1} = (1 + A + C) \\hat{u}^{\\star}\n$$\nThe amplification factor is $G = \\hat{u}^{n+1} / \\hat{u}^{n}$. We solve for $G$ by eliminating $\\hat{u}^\\star$. From the first equation, $\\hat{u}^{\\star} = \\frac{1+B+C}{1-A}\\hat{u}^{n}$. Substituting this into the second equation gives:\n$$\n(1 - B) \\hat{u}^{n+1} = (1 + A + C) \\frac{1+B+C}{1-A}\\hat{u}^{n}\n$$\nTherefore, the amplification factor is:\n$$\nG(\\theta_x, \\theta_y) = \\frac{(1 + A + C)(1 + B + C)}{(1 - A)(1 - B)}\n$$\nSubstituting the expressions for $A$, $B$, and $C$ back into this equation yields the complete formula for the amplification factor:\n$$\nG(\\theta_x, \\theta_y; r_x, r_y, r_{xy}) = \\frac{\\left(1 - 2r_x\\sin^2\\left(\\frac{\\theta_x}{2}\\right) - \\frac{r_{xy}}{2}\\sin\\theta_x\\sin\\theta_y\\right)\\left(1 - 2r_y\\sin^2\\left(\\frac{\\theta_y}{2}\\right) - \\frac{r_{xy}}{2}\\sin\\theta_x\\sin\\theta_y\\right)}{\\left(1 + 2r_x\\sin^2\\left(\\frac{\\theta_x}{2}\\right)\\right)\\left(1 + 2r_y\\sin^2\\left(\\frac{\\theta_y}{2}\\right)\\right)}\n$$\nThe stability of the numerical scheme is governed by the von Neumann criterion, which requires that the modulus of the amplification factor must not exceed unity for any Fourier mode:\n$$\n\\max_{\\theta_x, \\theta_y \\in [-\\pi, \\pi]} |G(\\theta_x, \\theta_y)| \\le 1\n$$\nThe parameters $r_x$ and $r_y$ control the strength of the pure diffusion terms. In this ADI formulation, these terms are treated implicitly in one direction and explicitly in the other at each half-step. If the mixed derivative term were absent ($\\gamma = 0$, thus $r_{xy} = 0$), this scheme would reduce to the Peaceman-Rachford ADI method, which is unconditionally stable for the diffusion equation (i.e., $|G| \\le 1$ for all $r_x, r_y > 0$).\nHowever, the parameter $r_{xy}$ corresponds to the mixed derivative term, which is treated explicitly in both half-steps of this particular scheme. Explicit treatment of derivative terms typically introduces conditional stability. We therefore anticipate that the stability of this scheme will depend on the magnitude of $|r_{xy}|$, likely in relation to $r_x$ and $r_y$. A large value of $|r_{xy}|$ can lead to $|G| > 1$, causing instability.\n\nThe algorithm to assess stability for a given parameter set $(\\alpha, \\beta, \\gamma, r)$ is as follows:\n1.  Calculate the dimensionless ratios $r_x = \\alpha r$, $r_y = \\beta r$, and $r_{xy} = \\gamma r$.\n2.  Define a discrete uniform grid of $N \\times N$ points for $(\\theta_x, \\theta_y)$ over the domain $[-\\pi, \\pi] \\times [-\\pi, \\pi]$, with $N=801$.\n3.  For each point on this grid, evaluate the amplification factor $G$ using the derived formula.\n4.  Compute the modulus $|G|$ at each grid point.\n5.  Determine the maximum value of $|G|$ over the entire grid. This provides a numerical estimate of $\\max_{\\theta_x, \\theta_y} |G|$.\n6.  Compare this maximum modulus to $1$. If the maximum is less than or equal to $1$, the scheme is considered stable for the given parameters. Otherwise, it is unstable.\nThis procedure will be implemented to test the provided cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of determining the stability of an ADI scheme for a 2D diffusion\n    equation with a mixed derivative term.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (alpha, beta, gamma, r)\n        (1.0, 1.0, 0.0, 5.0),    # Case 1\n        (1.0, 1.0, 1.0, 0.25),   # Case 2\n        (1.0, 1.0, 1.5, 4.0),   # Case 3\n        (1.0, 2.0, 1.8, 1.0),   # Case 4\n    ]\n\n    results = []\n    \n    # Grid parameters for the von Neumann analysis\n    N = 801\n    theta_vals = np.linspace(-np.pi, np.pi, N)\n    THETA_X, THETA_Y = np.meshgrid(theta_vals, theta_vals)\n\n    # Pre-compute trigonometric terms for efficiency\n    SIN2_HALF_X = np.sin(THETA_X / 2)**2\n    SIN2_HALF_Y = np.sin(THETA_Y / 2)**2\n    SIN_X = np.sin(THETA_X)\n    SIN_Y = np.sin(THETA_Y)\n\n    for case in test_cases:\n        alpha, beta, gamma, r = case\n        \n        # Calculate dimensionless ratios\n        rx = alpha * r\n        ry = beta * r\n        rxy = gamma * r\n\n        # The amplification factor G is given by:\n        # G = ( (1 + A + C) * (1 + B + C) ) / ( (1 - A) * (1 - B) )\n        # where:\n        # A = -2 * rx * sin^2(theta_x / 2)\n        # B = -2 * ry * sin^2(theta_y / 2)\n        # C = -0.5 * rxy * sin(theta_x) * sin(theta_y)\n        \n        # Numerator calculation\n        # The terms in the numerator are (1 - 2*rx*S_x - C_xy) and (1 - 2*ry*S_y - C_xy)\n        c_xy_term = 0.5 * rxy * SIN_X * SIN_Y\n        \n        num_term_1 = 1.0 - 2.0 * rx * SIN2_HALF_X - c_xy_term\n        num_term_2 = 1.0 - 2.0 * ry * SIN2_HALF_Y - c_xy_term\n        numerator = num_term_1 * num_term_2\n        \n        # Denominator calculation\n        # The terms are (1 + 2*rx*S_x) and (1 + 2*ry*S_y)\n        den_term_1 = 1.0 + 2.0 * rx * SIN2_HALF_X\n        den_term_2 = 1.0 + 2.0 * ry * SIN2_HALF_Y\n        denominator = den_term_1 * den_term_2\n        \n        # Compute amplification factor over the grid\n        # Avoid division by zero, although with rx, ry > 0, denominator is >= 1\n        g_grid = numerator / denominator\n        \n        # Find the maximum modulus of the amplification factor\n        max_abs_g = np.max(np.abs(g_grid))\n        \n        # Determine stability based on the von Neumann criterion\n        is_stable = max_abs_g <= 1.0\n        \n        results.append(f\"{max_abs_g:.6f}\")\n        results.append(str(is_stable))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2392607"}]}