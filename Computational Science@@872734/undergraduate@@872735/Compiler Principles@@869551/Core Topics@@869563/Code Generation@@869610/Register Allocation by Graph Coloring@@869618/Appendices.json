{"hands_on_practices": [{"introduction": "The journey of register allocation begins with translating program semantics into a mathematical structure—the interference graph. This first exercise walks you through this fundamental process, starting from simple three-address code. By performing liveness analysis and identifying overlapping live ranges, you will construct the graph that forms the basis for all subsequent coloring decisions [@problem_id:3675472].", "problem": "Consider the following straight-line Three-Address Code (TAC), where Three-Address Code (TAC) is a representation in which each instruction has at most three operands and assigns to one destination:\n\nInstruction $\\;1$: $x := a + b$; Instruction $\\;2$: $y := x + c$; Instruction $\\;3$: $z := y + d$\n\nAssume the following context and conventions:\n- The variables $a$, $b$, $c$, and $d$ are live at the entry of the basic block (live-in) and are not defined within the block prior to their uses.\n- After Instruction $\\;3$, there is a single-use point immediately following the block where $z$ is consumed as the block’s result, making $z$ live-out at the end.\n- Liveness of a variable is defined in the standard data-flow sense: a variable is live at a program point if its current value may be read along some path starting at that point.\n- The live range of a variable is the set of program points from when it becomes live-in or is defined, through its last use that can affect the observable result.\n- Two variables interfere if their live ranges overlap at any program point; the interference graph has an edge between variables that interfere.\n- Register allocation by graph coloring assigns colors (registers) to variables such that adjacent vertices do not share a color. The minimum number of registers is the smallest number of colors that permits a valid coloring of the interference graph.\n\nTasks:\n- Using the above TAC and assumptions, compute the live ranges of all variables $a$, $b$, $c$, $d$, $x$, $y$, and $z$, indexed against the boundaries between instructions: before Instruction $\\;1$, between Instruction $\\;1$ and Instruction $\\;2$, between Instruction $\\;2$ and Instruction $\\;3$, and after Instruction $\\;3$ but before the final use of $z$.\n- Draw the corresponding live intervals along this linear order and construct the interference graph by connecting pairs of variables whose intervals overlap.\n- Choose a valid coloring of the interference graph and determine the minimum number of colors required.\n\nProvide as your final answer the minimum number of registers required. The answer must be a single integer with no units. No rounding is needed.", "solution": "The problem statement is evaluated to be **valid**. It is self-contained, scientifically grounded in the principles of compiler theory, and well-posed. The definitions of Three-Address Code (TAC), variable liveness, live range, interference graph, and graph coloring are standard and unambiguous. The provided code and assumptions are consistent and sufficient to derive a unique solution.\n\nThe solution proceeds in four steps:\n1.  Perform liveness analysis to determine the set of live variables at each program point.\n2.  Define the live range (or live interval) for each variable.\n3.  Construct the interference graph based on overlapping live ranges.\n4.  Determine the chromatic number of the interference graph, which corresponds to the minimum number of registers required.\n\nLet the program points be defined at the boundaries of the instructions:\n-   $P_0$: The point before Instruction $1$.\n-   $P_1$: The point between Instruction $1$ and Instruction $2$.\n-   $P_2$: The point between Instruction $2$ and Instruction $3$.\n-   $P_3$: The point after Instruction $3$, but before the final use of $z$.\n\nLiveness analysis proceeds backward from the end of the basic block. The live-in set for an instruction $i$, $\\text{Live}_{\\text{in}}(i)$, is calculated from its live-out set, $\\text{Live}_{\\text{out}}(i)$, using the standard data-flow equation:\n$$ \\text{Live}_{\\text{in}}(i) = (\\text{Live}_{\\text{out}}(i) \\setminus \\text{def}(i)) \\cup \\text{use}(i) $$\nwhere $\\text{def}(i)$ is the set of variables defined by instruction $i$, and $\\text{use}(i)$ is the set of variables used by instruction $i$. The live-out set of an instruction is the live-in set of its successor.\n\n**Step 1: Liveness Analysis**\n\n-   **At point $P_3$ (after Instruction $3$):**\n    The problem states that $z$ is live-out of the block. Thus, the set of live variables at this point is $\\{z\\}$. This is the live-out set for Instruction $3$.\n    $$ \\text{Live}_{\\text{out}}(\\text{Inst } 3) = \\{z\\} $$\n\n-   **For Instruction $3: z := y + d$**:\n    -   $\\text{def}(\\text{Inst } 3) = \\{z\\}$\n    -   $\\text{use}(\\text{Inst } 3) = \\{y, d\\}$\n    -   $\\text{Live}_{\\text{in}}(\\text{Inst } 3) = (\\text{Live}_{\\text{out}}(\\text{Inst } 3) \\setminus \\{z\\}) \\cup \\{y, d\\} = (\\{z\\} \\setminus \\{z\\}) \\cup \\{y, d\\} = \\{y, d\\}$.\n    -   The set of live variables at point $P_2$ is $\\{y, d\\}$. This is also $\\text{Live}_{\\text{out}}(\\text{Inst } 2)$.\n\n-   **For Instruction $2: y := x + c$**:\n    -   $\\text{Live}_{\\text{out}}(\\text{Inst } 2) = \\text{Live}_{\\text{in}}(\\text{Inst } 3) = \\{y, d\\}$\n    -   $\\text{def}(\\text{Inst } 2) = \\{y\\}$\n    -   $\\text{use}(\\text{Inst } 2) = \\{x, c\\}$\n    -   $\\text{Live}_{\\text{in}}(\\text{Inst } 2) = (\\text{Live}_{\\text{out}}(\\text{Inst } 2) \\setminus \\{y\\}) \\cup \\{x, c\\} = (\\{y, d\\} \\setminus \\{y\\}) \\cup \\{x, c\\} = \\{d, x, c\\}$.\n    -   The set of live variables at point $P_1$ is $\\{c, d, x\\}$. This is also $\\text{Live}_{\\text{out}}(\\text{Inst } 1)$.\n\n-   **For Instruction $1: x := a + b$**:\n    -   $\\text{Live}_{\\text{out}}(\\text{Inst } 1) = \\text{Live}_{\\text{in}}(\\text{Inst } 2) = \\{c, d, x\\}$\n    -   $\\text{def}(\\text{Inst } 1) = \\{x\\}$\n    -   $\\text{use}(\\text{Inst } 1) = \\{a, b\\}$\n    -   $\\text{Live}_{\\text{in}}(\\text{Inst } 1) = (\\text{Live}_{\\text{out}}(\\text{Inst } 1) \\setminus \\{x\\}) \\cup \\{a, b\\} = (\\{c, d, x\\} \\setminus \\{x\\}) \\cup \\{a, b\\} = \\{a, b, c, d\\}$.\n    -   The set of live variables at point $P_0$ is $\\{a, b, c, d\\}$. This confirms the problem statement that $a$, $b$, $c$, and $d$ are live-in to the block.\n\nSummary of live variables at each program point:\n-   At $P_0$: $\\{a, b, c, d\\}$\n-   At $P_1$: $\\{c, d, x\\}$\n-   At $P_2$: $\\{d, y\\}$\n-   At $P_3$: $\\{z\\}$\n\n**Step 2: Live Ranges**\n\nA variable's live range is the set of program points where it is live.\n-   $a$: live from $P_0$ until its use in Instruction $1$. Range: $[P_0, P_1)$.\n-   $b$: live from $P_0$ until its use in Instruction $1$. Range: $[P_0, P_1)$.\n-   $x$: defined by Instruction $1$, live from $P_1$ until its use in Instruction $2$. Range: $[P_1, P_2)$.\n-   $c$: live from $P_0$ until its use in Instruction $2$. Range: $[P_0, P_2)$.\n-   $y$: defined by Instruction $2$, live from $P_2$ until its use in Instruction $3$. Range: $[P_2, P_3)$.\n-   $d$: live from $P_0$ until its use in Instruction $3$. Range: $[P_0, P_3)$.\n-   $z$: defined by Instruction $3$, live from $P_3$ until its use after the block. Range: $[P_3, \\text{end})$.\n\n**Step 3: Interference Graph Construction**\n\nTwo variables interfere if their live ranges overlap. We list all pairs of variables that are simultaneously live at any program point.\n-   At $P_0$, the set of live variables is $\\{a, b, c, d\\}$. All pairs of these variables interfere. This forms a clique of size $4$ (denoted $K_4$). Edges: $(a,b), (a,c), (a,d), (b,c), (b,d), (c,d)$.\n-   At $P_1$, the set of live variables is $\\{c, d, x\\}$. All pairs of these variables interfere. Edges: $(c,d), (c,x), (d,x)$.\n-   At $P_2$, the set of live variables is $\\{d, y\\}$. These two interfere. Edge: $(d,y)$.\n-   At $P_3$, the set of live variables is $\\{z\\}$. There are no interferences involving $z$.\n\nThe full set of edges in the interference graph $G$ is the union of the interferences found at all points. The adjacency list for the graph is:\n-   $a$: $\\{b, c, d\\}$\n-   $b$: $\\{a, c, d\\}$\n-   $c$: $\\{a, b, d, x\\}$\n-   $d$: $\\{a, b, c, x, y\\}$\n-   $x$: $\\{c, d\\}$\n-   $y$: $\\{d\\}$\n-   $z$: $\\emptyset$\n\n**Step 4: Minimum Number of Registers (Chromatic Number)**\n\nThe minimum number of registers required is the chromatic number, $\\chi(G)$, of the interference graph $G$.\nThe chromatic number must be at least as large as the size of the largest clique in the graph, $\\omega(G)$. From the analysis at point $P_0$, we identified a clique of size $4$ consisting of the vertices $\\{a, b, c, d\\}$. Therefore, $\\omega(G) \\ge 4$, which implies $\\chi(G) \\ge 4$. So, at least $4$ registers are necessary.\n\nWe now check if $4$ registers are sufficient by attempting a $4$-coloring of the graph. Let the colors be $C_1, C_2, C_3, C_4$.\n1.  Color the vertices of the $K_4$ clique $\\{a, b, c, d\\}$ with distinct colors:\n    -   color($a$) := $C_1$\n    -   color($b$) := $C_2$\n    -   color($c$) := $C_3$\n    -   color($d$) := $C_4$\n2.  Color the remaining vertices ($x$, $y$, $z$).\n    -   Vertex $x$ is adjacent to $c$ (color $C_3$) and $d$ (color $C_4$). We can assign it any color other than $C_3$ or $C_4$. Let's choose $C_1$. color($x$) := $C_1$. This is valid as $x$ is not adjacent to $a$.\n    -   Vertex $y$ is adjacent only to $d$ (color $C_4$). We can assign it any color other than $C_4$. Let's choose $C_1$. color($y$) := $C_1$. This is valid.\n    -   Vertex $z$ has no neighbors. We can assign it any color. Let's choose $C_1$. color($z$) := $C_1$.\n\nA valid $4$-coloring is:\n-   $a$: $C_1$\n-   $b$: $C_2$\n-   $c$: $C_3$\n-   $d$: $C_4$\n-   $x$: $C_1$\n-   $y$: $C_1$\n-   $z$: $C_1$\n\nSince a $4$-coloring exists, $4$ registers are sufficient, so $\\chi(G) \\le 4$.\nCombining the two bounds, $\\chi(G) \\ge 4$ and $\\chi(G) \\le 4$, we conclude that the chromatic number is exactly $4$.\n\nThus, the minimum number of registers required is $4$.", "answer": "$$\\boxed{4}$$", "id": "3675472"}, {"introduction": "While constructing the interference graph is the first step, optimizing it is where the real challenge lies. A key optimization is coalescing, which eliminates `move` instructions by merging the live ranges of the source and destination variables. This practice explores a critical pitfall of this technique, demonstrating how an overly aggressive merge can increase a node's degree and complicate the coloring process, potentially forcing a variable to be spilled to memory [@problem_id:3666803].", "problem": "Consider the standard graph-coloring formulation of register allocation. An interference graph $G=(V,E)$ represents variables (nodes) that cannot share the same register (edges). Let $k$ be the number of available machine registers. The simplification phase of a Chaitin-style allocator repeatedly removes a node of degree less than $k$; if none exists, a node is selected as a spill candidate. Coalescing replaces two move-related, non-interfering nodes $x$ and $y$ by a single node that represents assigning $x$ and $y$ to the same register, potentially reducing move instructions but changing the interference graph.\n\nYou are given a worst-case structural pattern in which two non-interfering nodes $x$ and $y$ are move-related, have degrees $d_x$ and $d_y$, and share exactly one common interfering neighbor. All other neighbors of $x$ and $y$ are distinct. Assume $k$ is fixed.\n\n1) Construct a concrete instance consistent with this pattern that demonstrates how coalescing $x$ and $y$ can create a node whose degree is at least $k$, thereby potentially forcing a spill choice in the simplification phase. Use the following parameters in your construction: $k=9$, $d_x=4$, and $d_y=6$.\n\n2) Generalize from first principles. Let $N(x)$ and $N(y)$ denote the neighbor sets of $x$ and $y$ in $G$. Under the stated worst-case pattern ($x$ and $y$ are non-interfering, move-related, and $|N(x)\\cap N(y)|=1$), derive the minimal integer threshold $t(k)$ such that, whenever $d_x+d_y \\ge t(k)$, coalescing $x$ and $y$ yields a merged node whose degree is at least $k$. Provide $t(k)$ as a closed-form expression in terms of $k$.\n\nYour final answer must be the expression for $t(k)$. No rounding is required, and no units are involved. Express the final answer as a single closed-form analytic expression.", "solution": "The problem concerns the effect of coalescing two nodes in an interference graph, a core operation in register allocation via graph coloring. Let the interference graph be $G=(V, E)$, where $V$ is the set of variables (or temporaries) and an edge $(u, v) \\in E$ indicates that variables $u$ and $v$ are live at the same time and thus cannot be assigned to the same register.\n\nWe are given two nodes, $x$ and $y$, that are targets for coalescing. This implies they are move-related (e.g., involved in an instruction like `move y, x`) and do not interfere with each other, meaning $(x, y) \\notin E$. Coalescing merges $x$ and $y$ into a single new node, let's call it $xy$. The neighbors of this new node $xy$ are all nodes that were neighbors of either $x$ or $y$. If $N(u)$ denotes the set of neighbors of a node $u$, then the neighborhood of the coalesced node is $N(xy) = N(x) \\cup N(y)$.\n\nThe degree of a node is the number of its neighbors. The degree of the coalesced node, $d_{xy}$, is therefore the cardinality of the union of the original neighborhoods: $d_{xy} = |N(xy)| = |N(x) \\cup N(y)|$. Using the principle of inclusion-exclusion for two sets, the size of their union is given by:\n$$|N(x) \\cup N(y)| = |N(x)| + |N(y)| - |N(x) \\cap N(y)|$$\nLet $d_x = |N(x)|$ and $d_y = |N(y)|$ be the degrees of nodes $x$ and $y$, respectively. The degree of the coalesced node can then be expressed as:\n$$d_{xy} = d_x + d_y - |N(x) \\cap N(y)|$$\nThe problem specifies a \"worst-case structural pattern\" where $x$ and $y$ share exactly one common neighbor. This means the intersection of their neighbor sets has exactly one element: $|N(x) \\cap N(y)| = 1$. Substituting this into the degree formula gives:\n$$d_{xy} = d_x + d_y - 1$$\nThis equation is the foundation for solving both parts of the problem.\n\nFor the first part, we must construct a concrete instance. We are given the number of available registers $k=9$, and the degrees of the nodes to be coalesced, $d_x=4$ and $d_y=6$. During the simplification phase of a Chaitin-style allocator, nodes with a degree less than $k$ are removed from the graph and pushed onto a stack. A potential issue arises if coalescing creates a node whose degree is not less than $k$, as this new node cannot be immediately simplified and might lead to a spill. We want to show that coalescing $x$ and $y$ can create a node with degree at least $k$.\nUsing the derived formula with the given parameters:\n$$d_{xy} = d_x + d_y - 1 = 4 + 6 - 1 = 9$$\nThe degree of the resulting node is $9$. Since $k=9$, we have $d_{xy} = k$. A node is simplifiable only if its degree is strictly less than $k$. Since $d_{xy} = 9$ is not less than $k=9$, the new node $xy$ is not simplifiable.\nThis confirms that the coalescing operation, under these conditions, can create a node that may force a spill. A concrete graph instance consists of:\n- Nodes $x$ and $y$.\n- A single common neighbor, node $z$.\n- $d_x - 1 = 4 - 1 = 3$ distinct neighbors for $x$ that are not neighbors of $y$, let's call them $\\{a_1, a_2, a_3\\}$.\n- $d_y - 1 = 6 - 1 = 5$ distinct neighbors for $y$ that are not neighbors of $x$, let's call them $\\{b_1, b_2, b_3, b_4, b_5\\}$.\nThe neighborhoods are $N(x) = \\{z, a_1, a_2, a_3\\}$ and $N(y) = \\{z, b_1, b_2, b_3, b_4, b_5\\}$. Before coalescing, both nodes are simplifiable since $d_x = 4  9$ and $d_y = 6  9$. After coalescing, the new node $xy$ has the neighborhood $N(xy) = N(x) \\cup N(y) = \\{z, a_1, a_2, a_3, b_1, b_2, b_3, b_4, b_5\\}$, with degree $d_{xy}=9$.\n\nFor the second part, we generalize this result to derive the minimal integer threshold $t(k)$. We seek the condition on the sum $d_x + d_y$ such that the coalesced node's degree, $d_{xy}$, is at least $k$. This means we require:\n$$d_{xy} \\ge k$$\nSubstituting our formula for $d_{xy}$ under the problem's structural constraint ($|N(x) \\cap N(y)| = 1$):\n$$d_x + d_y - 1 \\ge k$$\nTo find the threshold for the sum of the degrees, we solve the inequality for $d_x + d_y$:\n$$d_x + d_y \\ge k + 1$$\nThis inequality shows that if the sum of the degrees of nodes $x$ and $y$ is greater than or equal to $k+1$, the degree of the coalesced node, $d_{xy}$, is guaranteed to be at least $k$. The problem asks for the minimal integer threshold $t(k)$ for the sum $d_x + d_y$. Based on the derived inequality, the minimum integer value that $d_x+d_y$ must be to satisfy the condition is $k+1$. Any sum less than this, such as $k$, would result in $d_{xy} = k-1$, which is less than $k$. Thus, the threshold is precisely $k+1$.\nTherefore, the minimal integer threshold $t(k)$ is given by the expression:\n$$t(k) = k + 1$$", "answer": "$$\\boxed{k+1}$$", "id": "3666803"}, {"introduction": "In advanced compiler design, decisions are rarely black and white; they involve complex trade-offs. This final exercise delves into the sophisticated interplay between spilling and coalescing, revealing a counterintuitive truth: sometimes, intentionally spilling a variable can unlock greater optimization opportunities. You will analyze a scenario where a strategic spill enables the removal of multiple `move` instructions, leading to a net performance gain and highlighting the cost-benefit analysis at the heart of modern register allocators [@problem_id:3666838].", "problem": "Consider a loop body that executes $N$ times on a target with $k=5$ physical registers. The intermediate representation contains a chain of copy operations among four temporaries, written as moves:\n- $t_{2} \\leftarrow t_{1}$,\n- $t_{3} \\leftarrow t_{2}$,\n- $t_{4} \\leftarrow t_{3}$.\n\nThere are also five live ranges $p$, $q$, $r$, $s$, and $u$ that are used and redefined within the loop so that each of $p$, $q$, $r$, $s$, and $u$ is live across a portion of the loop body. The liveness is arranged so that, at the three program points where the moves occur, the simultaneously live sets are:\n- At the point of $t_{2} \\leftarrow t_{1}$: $\\{t_{1},p,q,r,u\\}$,\n- At the point of $t_{3} \\leftarrow t_{2}$: $\\{t_{2},p,q,s,u\\}$,\n- At the point of $t_{4} \\leftarrow t_{3}$: $\\{t_{3},p,r,s,u\\}$.\n\nThere are no other live ranges in the loop. Assume straight-line code (no branches) within the loop body and that all five live ranges $p$, $q$, $r$, $s$, $u$ are used and then redefined once per iteration so that they are live across the loop body as described.\n\nUse the standard interference-graph model for register allocation by graph coloring: two nodes (live ranges) interfere if they are simultaneously live at some program point. Move-related nodes may be coalesced if a conservative coalescing rule (e.g., the George or Briggs criterion) deems the merge safe with respect to $k$-colorability. Let the execution-cost model be:\n- Each move instruction costs $C_{\\text{move}}$ per dynamic execution.\n- Each memory access due to spilling a live range costs $C_{\\text{spill}}$ per dynamic execution.\n\nSuppose we consider two allocation strategies:\n- Strategy A (no spill, no coalescing): Allocate with $k=5$ without coalescing any of $t_{1}$, $t_{2}$, $t_{3}$, $t_{4}$. This is possible because the maximum simultaneous liveness is $5$. The loop executes $3$ moves per iteration and performs no spill accesses.\n- Strategy B (spill $u$ to memory, then fully coalesce $t_{1}$, $t_{2}$, $t_{3}$, $t_{4}$ into a single node): Spilling $u$ makes the coalescing of the entire chain conservative-safe for $k=5$, so all three moves are eliminated. Because $u$ is used and redefined once per iteration, the spill introduces exactly $2$ memory accesses per iteration (one load before its use and one store after its redefinition).\n\nStarting only from the core definitions of liveness, interference graphs, and conservative coalescing for $k$-coloring, explain why Strategy A admits coloring with $k=5$ but cannot coalesce the entire chain conservatively, while Strategy B admits coloring with $k=5$ and allows coalescing the entire chain. Then, using the stated cost model, derive the break-even ratio $r^{\\ast}$ of $C_{\\text{spill}}$ to $C_{\\text{move}}$ over one loop iteration such that Strategy B has strictly lower execution cost than Strategy A when $\\frac{C_{\\text{spill}}}{C_{\\text{move}}}  r^{\\ast}$. Provide the simplified analytic expression for $r^{\\ast}$. Do not round your answer.", "solution": "The problem asks for an analysis of two register allocation strategies for a given loop body, based on the interference graph model, and a derivation of a cost break-even point. We begin by validating the problem statement.\n\n### Problem Validation\n**Step 1: Extract Givens**\n- Number of physical registers: $k=5$.\n- Loop execution count: $N$ times.\n- Move instructions: $t_{2} \\leftarrow t_{1}$, $t_{3} \\leftarrow t_{2}$, $t_{4} \\leftarrow t_{3}$.\n- Live ranges: $p, q, r, s, u$ and temporaries $t_1, t_2, t_3, t_4$.\n- Simultaneously live sets at specific program points:\n  - At $t_{2} \\leftarrow t_{1}$: $L_1 = \\{t_{1}, p, q, r, u\\}$.\n  - At $t_{3} \\leftarrow t_{2}$: $L_2 = \\{t_{2}, p, q, s, u\\}$.\n  - At $t_{4} \\leftarrow t_{3}$: $L_3 = \\{t_{3}, p, r, s, u\\}$.\n- All other live ranges are accounted for, and interference is determined solely by these sets.\n- Cost model: $C_{\\text{move}}$ per move, $C_{\\text{spill}}$ per memory access for a spilled live range.\n- Strategy A: No spilling, no coalescing. Cost is $3$ moves per iteration. A $k=5$ coloring is stated to be possible.\n- Strategy B: Spill live range $u$. Coalesce the chain $t_1, t_2, t_3, t_4$. Cost is $2$ spill-related memory accesses per iteration. This is stated to be possible.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is well-defined within the standard theoretical framework of compiler design, specifically register allocation via graph coloring. The concepts of liveness, interference graphs, graph coloring, conservative coalescing (Briggs/George criteria), and spilling are all standard. The givens are self-contained and sufficient to construct and analyze the interference graphs for both strategies. The problem's premises—that coloring is possible in Strategy A and that coalescing is possible in Strategy B—are assertions to be explained, which is a valid pedagogical structure. The problem is scientifically grounded, objective, and well-posed.\n\n**Step 3: Verdict and Action**\nThe problem is valid. The solution will proceed.\n\n### Analysis and Solution\nThe core of register allocation by graph coloring is the interference graph $G=(V, E)$, where $V$ is the set of live ranges (temporaries) and an edge $(a, b) \\in E$ exists if live ranges $a$ and $b$ are simultaneously live at any point in the program. Two live ranges that are related by a move instruction, such as $t_1$ and $t_2$ in $t_2 \\leftarrow t_1$, do not interfere by definition, assuming the liveness of $t_1$ ends at this instruction and that of $t_2$ starts.\n\nA graph is $k$-colorable if each node can be assigned one of $k$ colors such that no two adjacent nodes have the same color. A key heuristic for $k$-colorability is that a graph is $k$-colorable if it can be simplified by iteratively removing any node with a degree less than $k$.\n\nCoalescing two move-related nodes $u$ and $v$ (which do not interfere) means merging them into a single node. Conservative coalescing heuristics ensure that this merge does not render a $k$-colorable graph un-colorable. The Briggs criterion states that two nodes $u$ and $v$ can be coalesced if the resulting merged node $uv$ will have fewer than $k$ neighbors of degree $k$ or greater.\n\n**Strategy A: No Spilling, No Coalescing**\n\nFirst, we construct the interference graph $G$ from the given live sets. The set of nodes is $V = \\{t_1, t_2, t_3, t_4, p, q, r, s, u\\}$. The edges are formed by any pair of variables coexisting in any of the live sets $L_1, L_2, L_3$. The temporaries $t_1, t_2, t_3, t_4$ in the move chain have disjoint live ranges and thus do not interfere with each other.\n\nThe neighbors and degrees of each node are calculated as follows:\n- The neighbors of $t_1$ are from $L_1$: $\\text{Neigh}(t_1) = \\{p, q, r, u\\}$. $\\text{deg}(t_1) = 4$.\n- The neighbors of $t_2$ are from $L_2$: $\\text{Neigh}(t_2) = \\{p, q, s, u\\}$. $\\text{deg}(t_2) = 4$.\n- The neighbors of $t_3$ are from $L_3$: $\\text{Neigh}(t_3) = \\{p, r, s, u\\}$. $\\text{deg}(t_3) = 4$.\n- The temporary $t_4$ is defined by $t_4 \\leftarrow t_3$. Since no live set is given that includes $t_4$, and interference is determined solely by the given sets, $t_4$ has no interferences. $\\text{deg}(t_4) = 0$.\n- The neighbors of $p$ are the union of other variables in any set containing $p$: $\\text{Neigh}(p) = \\{t_1, q, r, u\\} \\cup \\{t_2, q, s, u\\} \\cup \\{t_3, r, s, u\\} = \\{t_1, t_2, t_3, q, r, s, u\\}$. $\\text{deg}(p) = 7$.\n- Similarly, we find the degrees of the other nodes:\n  - $\\text{Neigh}(q) = \\{t_1, t_2, p, r, s, u\\}$. $\\text{deg}(q) = 6$.\n  - $\\text{Neigh}(r) = \\{t_1, t_3, p, q, s, u\\}$. $\\text{deg}(r) = 6$.\n  - $\\text{Neigh}(s) = \\{t_2, t_3, p, q, r, u\\}$. $\\text{deg}(s) = 6$.\n  - $\\text{Neigh}(u) = \\{t_1, t_2, t_3, p, q, r, s\\}$. $\\text{deg}(u) = 7$.\n\nThe graph contains several $5$-cliques (e.g., $L_1$, $L_2$, $L_3$), so its chromatic number is at least $5$. The problem correctly states that a $5$-coloring is possible. This relies on the property of interference graphs for structured code, which are often perfect graphs, meaning their chromatic number equals their clique number. With a maximum clique size of $5$, the graph is $5$-colorable.\n\nNow, we explain why the chain $t_1, t_2, t_3, t_4$ cannot be fully coalesced. Let's attempt to coalesce $t_1$ and $t_2$, which are related by the move $t_2 \\leftarrow t_1$. The neighbors of the new merged node $T_{12}$ would be the union of the neighbors of $t_1$ and $t_2$: $\\text{Neigh}(T_{12}) = \\text{Neigh}(t_1) \\cup \\text{Neigh}(t_2) = \\{p, q, r, u\\} \\cup \\{p, q, s, u\\} = \\{p, q, r, s, u\\}$.\nThe degrees of these neighbors in the original graph are $\\text{deg}(p)=7$, $\\text{deg}(q)=6$, $\\text{deg}(r)=6$, $\\text{deg}(s)=6$, and $\\text{deg}(u)=7$. All these degrees are $\\ge k=5$.\nAccording to the Briggs criterion, the number of neighbors of $T_{12}$ with degree $\\ge k$ must be less than $k$. Here, there are $5$ such neighbors. Since $5$ is not strictly less than $k=5$, the conservative coalescing condition fails. Thus, even the first merge in the chain is not permitted. Consequently, the entire chain cannot be coalesced.\n\n**Strategy B: Spill `u`, Then Coalesce**\n\nIn this strategy, the live range $u$ is spilled to memory. This is equivalent to removing the node $u$ and all its incident edges from the interference graph before coloring. Let the new graph be $G'$.\n\nThe nodes and degrees in $G'$ (with $k=5$) are:\n- $\\text{deg}'(t_1) = |\\{p, q, r\\}| = 3$.\n- $\\text{deg}'(t_2) = |\\{p, q, s\\}| = 3$.\n- $\\text{deg}'(t_3) = |\\{p, r, s\\}| = 3$.\n- $\\text{deg}'(t_4) = 0$.\n- $\\text{deg}'(p) = |\\{t_1, t_2, t_3, q, r, s\\}| = 6$.\n- $\\text{deg}'(q) = |\\{t_1, t_2, p, r, s\\}| = 5$.\n- $\\text{deg}'(r) = |\\{t_1, t_3, p, q, s\\}| = 5$.\n- $\\text{deg}'(s) = |\\{t_2, t_3, p, q, r\\}| = 5$.\n\nNow, we attempt to coalesce the chain $t_1, t_2, t_3, t_4$. Let's proceed from $t_4$ to $t_1$.\n1.  **Coalesce $t_3 \\leftarrow t_4$**: The merged node $T_{34}$ has neighbors $\\text{Neigh}'(t_3) \\cup \\text{Neigh}'(t_4) = \\{p, r, s\\}$. The degrees of these neighbors in $G'$ are $\\text{deg}'(p)=6$, $\\text{deg}'(r)=5$, $\\text{deg}'(s)=5$. All three are \"high-degree\" (degree $\\ge k=5$). The number of high-degree neighbors is $3$. Since $3  k=5$, the Briggs criterion is satisfied. The merge is safe. Let the new graph be $G''$.\n\n2.  **Coalesce $t_2 \\leftarrow T_{34}$**: This corresponds to the original move $t_3 \\leftarrow t_2$. In $G''$, the merged node $T_{234}$ has neighbors $\\text{Neigh}''(t_2) \\cup \\text{Neigh}''(T_{34}) = \\{p, q, s\\} \\cup \\{p, r, s\\} = \\{p, q, r, s\\}$. The node degrees in $G''$ need to be considered. The neighbors of the merged node $T_{234}$ are $\\{p,q,r,s\\}$. The original degrees in $G'$ were $\\text{deg}'(p)=6$, $\\text{deg}'(q)=5$, $\\text{deg}'(r)=5$, $\\text{deg}'(s)=5$. All 4 neighbors have degree $\\ge k=5$. The number of high-degree neighbors is $4$. Since $4  k=5$, this merge is also safe by Briggs' criterion. Let the new graph be $G'''$.\n\n3.  **Coalesce $t_1 \\leftarrow T_{234}$**: This corresponds to the original move $t_2 \\leftarrow t_1$. The final merged node $T = T_{1234}$ has neighbors $\\text{Neigh}'''(t_1) \\cup \\text{Neigh}'''(T_{234}) = \\{p, q, r\\} \\cup \\{p, q, r, s\\} = \\{p, q, r, s\\}$. The number of neighbors is $4$. Even if all of them have high degree, $4  k=5$, so the merge is safe.\n\nSince all merges are conservative-safe, the entire chain can be coalesced. The final graph consists of the nodes $\\{T, p, q, r, s\\}$. The node $T$ is connected to $p, q, r, s$. The nodes $\\{p, q, r, s\\}$ form a $4$-clique ($K_4$) among themselves after removing $u$. Therefore, the final graph is a $K_5$ (the wheel graph $W_5$), which is $5$-colorable.\n\n**Cost Analysis**\n\nWe are asked for the break-even ratio $r^{\\ast} = \\frac{C_{\\text{spill}}}{C_{\\text{move}}}$ such that Strategy B is strictly cheaper than Strategy A.\n\n- **Cost of Strategy A, $C_A$**: In this strategy, no spills occur. The three move instructions ($t_2 \\leftarrow t_1, t_3 \\leftarrow t_2, t_4 \\leftarrow t_3$) are executed in each of the $N$ loop iterations.\n  $$ C_A = 3 \\times C_{\\text{move}} \\quad (\\text{per iteration}) $$\n\n- **Cost of Strategy B, $C_B$**: In this strategy, the live range $u$ is spilled. The problem states that $u$ is used once and redefined once per iteration. This requires one load from memory before the use and one store to memory after the redefinition, totaling two memory accesses per iteration. All three move instructions are eliminated by coalescing.\n  $$ C_B = 2 \\times C_{\\text{spill}} \\quad (\\text{per iteration}) $$\n\nStrategy B has a strictly lower cost than Strategy A when $C_B  C_A$.\n$$ 2 \\times C_{\\text{spill}}  3 \\times C_{\\text{move}} $$\nTo find the condition on the ratio $r = \\frac{C_{\\text{spill}}}{C_{\\text{move}}}$, we divide the inequality by $C_{\\text{move}}$ (a positive cost).\n$$ 2 \\left( \\frac{C_{\\text{spill}}}{C_{\\text{move}}} \\right)  3 $$\n$$ 2r  3 $$\n$$ r  \\frac{3}{2} $$\nThe problem asks for the break-even ratio $r^{\\ast}$ such that the condition for Strategy B being cheaper is $r  r^{\\ast}$. From our derived inequality, this value is $r^{\\ast} = \\frac{3}{2}$.", "answer": "$$\\boxed{\\frac{3}{2}}$$", "id": "3666838"}]}