{"hands_on_practices": [{"introduction": "The first step in mastering sparse matrices is learning to speak their language. The Compressed Sparse Row (CSR) format is one of the most widely used methods for efficiently storing sparse data. This exercise will guide you through the process of decoding a matrix from its CSR representation, translating the compact arrays of values, column indices, and row pointers back into the familiar two-dimensional grid of a dense matrix. This foundational skill is crucial for visualizing and verifying data stored in this format. [@problem_id:2204554]", "problem": "In many scientific and engineering applications, matrices are often \"sparse,\" meaning most of their elements are zero. Storing all these zeros is inefficient. The Compressed Sparse Row (CSR) format is a common method for storing sparse matrices by using three one-dimensional arrays.\n\nConsider a sparse matrix $A$ of size $4 \\times 4$. In the CSR format (using 0-based indexing), this matrix is represented by the following three arrays:\n1.  An array `V` containing the non-zero elements of $A$, read row by row, from left to right.\n2.  An array `C` containing the column index for each corresponding element in `V`.\n3.  An array `R` (the row pointer) of size $m+1$ (where $m$ is the number of rows), where the $i$-th element indicates the index in `V` and `C` where the data for the $i$-th row begins. The last element of `R` is the total number of non-zero elements.\n\nThe three arrays for our $4 \\times 4$ matrix $A$ are given as follows:\n- `V = [5.1, -1.2, 2.0, -3.5, 4.0, 9.8]`\n- `C = [1, 3, 0, 2, 3, 0]`\n- `R = [0, 2, 3, 5, 6]`\n\nReconstruct the original dense $4 \\times 4$ matrix $A$. Present your answer as a $4 \\times 4$ matrix.", "solution": "We use the CSR definition with 0-based indexing. For each row index $i \\in \\{0,1,2,3\\}$, the nonzero entries of row $i$ are stored in the segments of `V` and `C` with indices $j$ from $R[i]$ to $R[i+1]-1$, where the column index is $C[j]$ and the value is $V[j]$. The last element $R[4]=6$ equals the total number of nonzeros, which matches $\\lvert V \\rvert=6$.\n\nRow $0$: indices $j=R[0]\\ldots R[1]-1=0\\ldots 1$.\n- $j=0$: $C[0]=1$, $V[0]=5.1$ gives $A_{0,1}=5.1$.\n- $j=1$: $C[1]=3$, $V[1]=-1.2$ gives $A_{0,3}=-1.2$.\nThus row $0$ is $[0,\\,5.1,\\,0,\\,-1.2]$.\n\nRow $1$: indices $j=R[1]\\ldots R[2]-1=2\\ldots 2$.\n- $j=2$: $C[2]=0$, $V[2]=2.0$ gives $A_{1,0}=2.0$.\nThus row $1$ is $[2.0,\\,0,\\,0,\\,0]$.\n\nRow $2$: indices $j=R[2]\\ldots R[3]-1=3\\ldots 4$.\n- $j=3$: $C[3]=2$, $V[3]=-3.5$ gives $A_{2,2}=-3.5$.\n- $j=4$: $C[4]=3$, $V[4]=4.0$ gives $A_{2,3}=4.0$.\nThus row $2$ is $[0,\\,0,\\,-3.5,\\,4.0]$.\n\nRow $3$: indices $j=R[3]\\ldots R[4]-1=5\\ldots 5$.\n- $j=5$: $C[5]=0$, $V[5]=9.8$ gives $A_{3,0}=9.8$.\nThus row $3$ is $[9.8,\\,0,\\,0,\\,0]$.\n\nTherefore, the reconstructed dense matrix $A$ is\n$$\n\\begin{pmatrix}\n0 & 5.1 & 0 & -1.2 \\\\\n2.0 & 0 & 0 & 0 \\\\\n0 & 0 & -3.5 & 4.0 \\\\\n9.8 & 0 & 0 & 0\n\\end{pmatrix}.\n$$", "answer": "$$\\boxed{\\begin{pmatrix}0 & 5.1 & 0 & -1.2 \\\\ 2.0 & 0 & 0 & 0 \\\\ 0 & 0 & -3.5 & 4.0 \\\\ 9.8 & 0 & 0 & 0\\end{pmatrix}}$$", "id": "2204554"}, {"introduction": "Just as the CSR format organizes data by rows, its counterpart, the Compressed Sparse Column (CSC) format, organizes it by columns. Understanding both is key to developing a flexible approach to sparse matrix computations. This practice challenges you to reconstruct a dense matrix from its CSC components, reinforcing the principles of compressed storage while highlighting the column-centric perspective that makes CSC ideal for certain types of operations. [@problem_id:2204531]", "problem": "In numerical analysis and scientific computing, sparse matrices (matrices that are mostly populated with zeros) are often stored in specialized formats to save memory and computational time. One such popular format is the Compressed Sparse Column (CSC) format.\n\nA matrix $M$ with dimensions $m \\times n$ is represented in CSC format by three one-dimensional arrays:\n1.  `values`: An array containing all the non-zero elements of $M$, read column by column, from top to bottom.\n2.  `row_indices`: An array containing the row index for each corresponding element in the `values` array.\n3.  `col_ptr`: An array of size $n+1$. The $j$-th entry (`col_ptr[j]`) gives the index in the `values` array where the elements for column $j$ begin. The last entry, `col_ptr[n]`, is the total number of non-zero elements in the matrix. The indices are 0-based.\n\nYou are given the CSC representation of a $4 \\times 5$ matrix $M$. The arrays are as follows:\n- `values` = $[9, 4, 7, 3, 1, 2, 5]$\n- `row_indices` = $[0, 3, 2, 1, 3, 0, 2]$\n- `col_ptr` = $[0, 2, 3, 5, 6, 7]$\n\nUsing this information, reconstruct the original dense $4 \\times 5$ matrix $M$.", "solution": "We are given a $4 \\times 5$ matrix $M$ stored in Compressed Sparse Column (CSC) format with arrays:\n- $\\text{values} = [9, 4, 7, 3, 1, 2, 5]$,\n- $\\text{row\\_indices} = [0, 3, 2, 1, 3, 0, 2]$,\n- $\\text{col\\_ptr} = [0, 2, 3, 5, 6, 7]$.\n\nBy the CSC definition with 0-based indices: for each column $j \\in \\{0,1,2,3,4\\}$, the nonzero entries in column $j$ are found at positions $k$ in the interval $[\\text{col\\_ptr}[j], \\text{col\\_ptr}[j+1]-1]$ in the arrays, and each such entry sets\n$$\nM_{\\text{row\\_indices}[k],\\, j} = \\text{values}[k].\n$$\nAll other entries of $M$ are zero.\n\nProceed column by column:\n- Column $j=0$: $k \\in [\\text{col\\_ptr}[0], \\text{col\\_ptr}[1]-1] = [0,1]$.\n  - $k=0$: $\\text{row\\_indices}[0]=0$, $\\text{values}[0]=9 \\Rightarrow M_{0,0}=9$.\n  - $k=1$: $\\text{row\\_indices}[1]=3$, $\\text{values}[1]=4 \\Rightarrow M_{3,0}=4$.\n- Column $j=1$: $k \\in [2,2]$.\n  - $k=2$: $\\text{row\\_indices}[2]=2$, $\\text{values}[2]=7 \\Rightarrow M_{2,1}=7$.\n- Column $j=2$: $k \\in [3,4]$.\n  - $k=3$: $\\text{row\\_indices}[3]=1$, $\\text{values}[3]=3 \\Rightarrow M_{1,2}=3$.\n  - $k=4$: $\\text{row\\_indices}[4]=3$, $\\text{values}[4]=1 \\Rightarrow M_{3,2}=1$.\n- Column $j=3$: $k \\in [5,5]$.\n  - $k=5$: $\\text{row\\_indices}[5]=0$, $\\text{values}[5]=2 \\Rightarrow M_{0,3}=2$.\n- Column $j=4$: $k \\in [6,6]$.\n  - $k=6$: $\\text{row\\_indices}[6]=2$, $\\text{values}[6]=5 \\Rightarrow M_{2,4}=5$.\n\nAll unspecified entries are zero. Therefore, the reconstructed dense matrix is\n$$\nM = \\begin{pmatrix}\n9 & 0 & 0 & 2 & 0 \\\\\n0 & 0 & 3 & 0 & 0 \\\\\n0 & 7 & 0 & 0 & 5 \\\\\n4 & 0 & 1 & 0 & 0\n\\end{pmatrix}.\n$$", "answer": "$$\\boxed{\\begin{pmatrix}9&0&0&2&0\\\\0&0&3&0&0\\\\0&7&0&0&5\\\\4&0&1&0&0\\end{pmatrix}}$$", "id": "2204531"}, {"introduction": "Beyond simply using a storage format, a deeper understanding comes from analyzing its performance and limitations. The choice of format is not arbitrary; it depends heavily on the specific sparsity pattern of the matrix. This thought experiment introduces the ELLPACK (ELL) format and asks you to identify a \"poison\" matrix—a structure that makes the format maximally inefficient. By exploring this worst-case scenario, you will develop critical insight into the design trade-offs inherent in different sparse storage schemes. [@problem_id:2440205]", "problem": "In computational physics, sparse linear systems often arise from discretizations of differential operators. Consider the ELLPACK (ELL) format for storing an $n \\times n$ sparse matrix, defined as follows: for each row, ELL stores exactly $k_{\\max}$ entries, where $k_{\\max}$ is the maximum number of nonzero entries in any single row of the matrix. Rows with fewer than $k_{\\max}$ nonzero entries are padded with explicit stored zeros and placeholder column indices so that all rows have equal length. The total number of stored value entries and column-index entries thus scales proportionally to $n \\cdot k_{\\max}$, regardless of the actual total number of nonzeros.\n\nA matrix is called a “poison” matrix for ELL if it maximizes padding overhead and per-row work in ELL relative to the matrix’s true sparsity pattern.\n\nWhich of the following constructions yields, asymptotically as $n \\to \\infty$, a “poison” matrix for ELL under this definition?\n\nA. An $n \\times n$ tridiagonal matrix with nonzeros only on the main diagonal and the first sub- and super-diagonals. Interior rows have exactly $3$ nonzeros; boundary rows have exactly $2$ nonzeros.\n\nB. An $n \\times n$ matrix in which row $1$ is dense (it has nonzeros in all $n$ columns), and each of the remaining rows $2,3,\\dots,n$ has exactly $1$ nonzero on its diagonal.\n\nC. An $n \\times n$ banded matrix with fixed half-bandwidth $w$ (a constant independent of $n$), that is, each row has at most $2w+1$ consecutive nonzeros centered on the diagonal, truncated at boundaries.\n\nD. An $n \\times n$ matrix with exactly two dense columns (say columns $1$ and $2$ are nonzero in every row) and no other nonzeros anywhere else, so every row has exactly $2$ nonzeros.", "solution": "We must identify which matrix construction maximizes the asymptotic ratio of storage cost to the number of nonzero elements. The storage cost is proportional to $S = n \\cdot k_{\\max}$, and the number of nonzero elements is $NNZ$. We analyze the ratio $R = \\frac{S}{NNZ} = \\frac{n \\cdot k_{\\max}}{NNZ}$ as $n \\to \\infty$ for each option. A \"poison\" matrix will exhibit a ratio $R$ that grows with $n$, while an efficient structure for ELL will have a ratio $R$ that approaches a small constant.\n\n**Analysis of Option A**\nThe matrix is tridiagonal.\n- For interior rows ($i=2, \\dots, n-1$), there are $3$ nonzeros.\n- For boundary rows ($i=1, n$), there are $2$ nonzeros.\n- The maximum number of nonzeros in any row is $k_{\\max} = 3$. This is a constant independent of $n$.\n- The total number of nonzeros is $NNZ = 2 \\times 2 + (n-2) \\times 3 = 4 + 3n - 6 = 3n - 2$.\n- The storage cost is proportional to $S = n \\cdot k_{\\max} = 3n$.\n- The ratio is $R_A = \\frac{3n}{3n - 2}$.\n- As $n \\to \\infty$, we have $\\lim_{n \\to \\infty} R_A = \\lim_{n \\to \\infty} \\frac{3n}{3n - 2} = \\lim_{n \\to \\infty} \\frac{3}{3 - 2/n} = 1$.\n- The storage is asymptotically equal to the number of nonzeros. This represents a highly efficient use of the ELL format, with minimal padding overhead. This is the opposite of a \"poison\" matrix.\nTherefore, option A is **Incorrect**.\n\n**Analysis of Option B**\nThe matrix has one dense row and is otherwise extremely sparse.\n- For row $1$, there are $n$ nonzeros.\n- For each of the remaining $n-1$ rows (rows $2, \\dots, n$), there is exactly $1$ nonzero.\n- The maximum number of nonzeros in any row is $k_{\\max} = \\max(n, 1) = n$.\n- The total number of nonzeros is $NNZ = n + (n-1) \\times 1 = 2n - 1$.\n- The storage cost is proportional to $S = n \\cdot k_{\\max} = n \\cdot n = n^2$.\n- The ratio is $R_B = \\frac{n^2}{2n - 1}$.\n- As $n \\to \\infty$, we have $\\lim_{n \\to \\infty} R_B = \\lim_{n \\to \\infty} \\frac{n^2}{2n - 1} = \\lim_{n \\to \\infty} \\frac{n}{2 - 1/n} = \\infty$. The ratio grows as $O(n)$.\n- The storage cost is $O(n^2)$, while the number of nonzeros is only $O(n)$. The padding overhead, $(n^2 - (2n-1))$, is massive and grows quadratically. This structure forces the ELL format to allocate space for a dense matrix, even though the matrix is very sparse overall. This perfectly matches the definition of a \"poison\" matrix.\nTherefore, option B is **Correct**.\n\n**Analysis of Option C**\nThe matrix is banded with a fixed half-bandwidth $w$.\n- The number of nonzeros in any row is at most $2w+1$. Rows near the boundaries may have fewer.\n- The maximum number of nonzeros in any row is $k_{\\max} = 2w+1$. Since $w$ is a constant independent of $n$, $k_{\\max}$ is also a constant.\n- The total number of nonzeros, $NNZ$, depends on the precise structure, but for large $n$, most rows will have $2w+1$ nonzeros. Thus, $NNZ$ is on the order of $n \\cdot (2w+1)$. More precisely, $NNZ \\approx n(2w+1)$, so $NNZ = O(n)$.\n- The storage cost is proportional to $S = n \\cdot k_{\\max} = n(2w+1)$.\n- The ratio is $R_C = \\frac{n(2w+1)}{NNZ}$.\n- As $n \\to \\infty$, since $NNZ \\sim n(2w+1)$, the ratio $\\lim_{n \\to \\infty} R_C \\approx 1$.\n- Similar to the tridiagonal case (which is a special case with $w=1$), this structure is very efficient for the ELL format.\nTherefore, option C is **Incorrect**.\n\n**Analysis of Option D**\nThe matrix has exactly two dense columns.\n- Every row has exactly two nonzeros, one in column $1$ and one in column $2$.\n- The maximum number of nonzeros in any row is constant: $k_{\\max} = 2$.\n- The total number of nonzeros is $NNZ = n \\times 2 = 2n$.\n- The storage cost is proportional to $S = n \\cdot k_{\\max} = n \\cdot 2 = 2n$.\n- The ratio is $R_D = \\frac{2n}{2n} = 1$.\n- This is a perfectly regular structure for which the ELL format requires no padding whatsoever. All rows have the same number of nonzeros, which is equal to $k_{\\max}$. This is an ideal case for ELL, not a \"poison\" matrix.\nTherefore, option D is **Incorrect**.\n\n**Conclusion**\nComparing the asymptotic behavior of the storage-to-nonzero ratio $R$:\n- Option A: $R_A \\to 1$\n- Option B: $R_B \\to \\infty$ (specifically, $O(n)$)\n- Option C: $R_C \\to 1$ (constant)\n- Option D: $R_D = 1$\nThe matrix construction in Option B is the only one that leads to a storage overhead that grows unboundedly with the size of the matrix, thereby maximizing the overhead and fitting the definition of a \"poison\" matrix for the ELL format.", "answer": "$$\\boxed{B}$$", "id": "2440205"}]}