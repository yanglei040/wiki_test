{"hands_on_practices": [{"introduction": "The Markowitz model is built on the principle of managing the trade-off between risk and return. Before we can optimize a portfolio, we must first be able to quantify its risk. This exercise provides foundational practice in calculating portfolio variance, the model's primary measure of risk, for a simple two-asset scenario [@problem_id:2438015]. By working through this calculation, you will gain a concrete understanding of how individual asset volatilities and their correlation combine to determine the total risk of the portfolio.", "problem": "Consider a portfolio in computational finance consisting of $2$ risky assets with returns $r_{1}$ and $r_{2}$. Let the standard deviations of returns be $\\sigma_{1} = 0.4$ and $\\sigma_{2} = 0.2$, and let the correlation be $\\rho = 0.95$. The portfolio weights are $w$ in asset $1$ and $1 - w$ in asset $2$, with no short-selling allowed, so $w \\in [0,1]$. Assume second moments exist and use the definition $\\operatorname{Cov}(r_{1}, r_{2}) = \\rho \\sigma_{1} \\sigma_{2}$. Determine the value of $w \\in [0,1]$ such that the portfolio variance equals the target level $0.085$. Round your answer to $6$ significant figures.", "solution": "The problem is subjected to validation.\n\n**Step 1: Extract Givens**\n-   Number of assets: $2$.\n-   Returns: $r_{1}$, $r_{2}$.\n-   Standard deviation of asset $1$: $\\sigma_{1} = 0.4$.\n-   Standard deviation of asset $2$: $\\sigma_{2} = 0.2$.\n-   Correlation of returns: $\\rho = 0.95$.\n-   Weight in asset $1$: $w$.\n-   Weight in asset $2$: $1 - w$.\n-   Constraint on weight: $w \\in [0,1]$.\n-   Covariance definition: $\\operatorname{Cov}(r_{1}, r_{2}) = \\rho \\sigma_{1} \\sigma_{2}$.\n-   Target portfolio variance: $\\sigma_{p}^2 = 0.085$.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientific Grounding**: The problem is based on Markowitz portfolio theory, a fundamental concept in modern finance. The formula for portfolio variance is standard. All provided constants are numerically plausible. The problem is scientifically grounded.\n-   **Well-Posedness**: The problem asks for a specific value $w$ that produces a target variance. This requires solving an equation for $w$. The setup leads to a quadratic equation, which is a well-posed mathematical problem.\n-   **Objectivity**: The problem is stated using precise, objective, and standard terminology from finance and mathematics.\n-   **Completeness**: All necessary data ($\\sigma_1, \\sigma_2, \\rho$, target variance) and constraints ($w \\in [0,1]$) are provided to formulate and solve the problem.\n-   **Consistency**: The data and conditions are internally consistent. No contradictions are present.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A solution will be provided.\n\nThe variance of a portfolio comprising two assets with weights $w_{1}$ and $w_{2}$ is given by the formula:\n$$\n\\sigma_{p}^2 = w_{1}^2 \\sigma_{1}^2 + w_{2}^2 \\sigma_{2}^2 + 2 w_{1} w_{2} \\operatorname{Cov}(r_{1}, r_{2})\n$$\nThe covariance is defined as $\\operatorname{Cov}(r_{1}, r_{2}) = \\rho \\sigma_{1} \\sigma_{2}$. Substituting this into the variance formula yields:\n$$\n\\sigma_{p}^2 = w_{1}^2 \\sigma_{1}^2 + w_{2}^2 \\sigma_{2}^2 + 2 w_{1} w_{2} \\rho \\sigma_{1} \\sigma_{2}\n$$\nIn this problem, the weights are $w_{1} = w$ and $w_{2} = 1 - w$. We are given the following values: $\\sigma_{1} = 0.4$, $\\sigma_{2} = 0.2$, and $\\rho = 0.95$.\nLet us substitute these into the variance equation:\n$$\n\\sigma_{p}^2(w) = w^2 \\sigma_{1}^2 + (1-w)^2 \\sigma_{2}^2 + 2w(1-w)\\rho\\sigma_{1}\\sigma_{2}\n$$\nFirst, we compute the required terms:\n-   Variance of asset $1$: $\\sigma_{1}^2 = (0.4)^2 = 0.16$.\n-   Variance of asset $2$: $\\sigma_{2}^2 = (0.2)^2 = 0.04$.\n-   Covariance term: $\\rho \\sigma_{1} \\sigma_{2} = (0.95)(0.4)(0.2) = 0.076$.\n\nNow, we substitute these numerical values into the expression for $\\sigma_{p}^2(w)$:\n$$\n\\sigma_{p}^2(w) = w^2(0.16) + (1-w)^2(0.04) + 2w(1-w)(0.076)\n$$\nTo find the value of $w$, we expand and simplify this expression:\n$$\n\\sigma_{p}^2(w) = 0.16w^2 + (1 - 2w + w^2)(0.04) + (2w - 2w^2)(0.076)\n$$\n$$\n\\sigma_{p}^2(w) = 0.16w^2 + 0.04 - 0.08w + 0.04w^2 + 0.152w - 0.152w^2\n$$\nGroup the terms by powers of $w$:\n$$\n\\sigma_{p}^2(w) = (0.16 + 0.04 - 0.152)w^2 + (-0.08 + 0.152)w + 0.04\n$$\n$$\n\\sigma_{p}^2(w) = 0.048w^2 + 0.072w + 0.04\n$$\nThe problem requires that the portfolio variance equals a target level of $0.085$. We set our expression for $\\sigma_{p}^2(w)$ equal to this value:\n$$\n0.048w^2 + 0.072w + 0.04 = 0.085\n$$\nThis forms a quadratic equation. To solve for $w$, we rearrange the equation into the standard form $Aw^2 + Bw + C = 0$:\n$$\n0.048w^2 + 0.072w + (0.04 - 0.085) = 0\n$$\n$$\n0.048w^2 + 0.072w - 0.045 = 0\n$$\nTo simplify the coefficients, we can multiply the entire equation by $1000$:\n$$\n48w^2 + 72w - 45 = 0\n$$\nThis equation can be further simplified by dividing all terms by their greatest common divisor, which is $3$:\n$$\n16w^2 + 24w - 15 = 0\n$$\nThis problem has been reduced to finding the root of a quadratic equation. While a numerical algorithm such as the bisection method could approximate the root, an analytical solution is exact and therefore superior. We apply the quadratic formula, $w = \\frac{-B \\pm \\sqrt{B^2-4AC}}{2A}$, with $A=16$, $B=24$, and $C=-15$.\n\nFirst, calculate the discriminant, $\\Delta = B^2 - 4AC$:\n$$\n\\Delta = (24)^2 - 4(16)(-15) = 576 + 960 = 1536\n$$\nNow, find the roots for $w$:\n$$\nw = \\frac{-24 \\pm \\sqrt{1536}}{2(16)} = \\frac{-24 \\pm \\sqrt{256 \\times 6}}{32} = \\frac{-24 \\pm 16\\sqrt{6}}{32}\n$$\nSimplifying the expression for $w$:\n$$\nw = \\frac{-3 \\pm 2\\sqrt{6}}{4}\n$$\nThis gives two possible solutions for $w$:\n$$\nw_{1} = \\frac{-3 + 2\\sqrt{6}}{4} \\quad \\text{and} \\quad w_{2} = \\frac{-3 - 2\\sqrt{6}}{4}\n$$\nThe problem states that no short-selling is allowed, which imposes the constraint $w \\in [0,1]$. We must check which of these solutions falls within this interval.\nUsing the approximation $\\sqrt{6} \\approx 2.449$:\n$$\nw_{1} \\approx \\frac{-3 + 2(2.449)}{4} = \\frac{-3 + 4.898}{4} = \\frac{1.898}{4} \\approx 0.4745\n$$\nThis solution $w_1$ is in the interval $[0,1]$.\n$$\nw_{2} \\approx \\frac{-3 - 2(2.449)}{4} = \\frac{-3 - 4.898}{4} = \\frac{-7.898}{4} \\approx -1.9745\n$$\nThis solution $w_2$ is negative and thus outside the allowed interval $[0,1]$. It corresponds to a short position in asset $1$, which is forbidden.\n\nTherefore, the only valid weight is $w = \\frac{-3 + 2\\sqrt{6}}{4}$.\nThe problem requires a numerical answer rounded to $6$ significant figures.\n$$\nw = \\frac{-3 + 2\\sqrt{6}}{4} \\approx 0.474744871...\n$$\nRounding this value to $6$ significant figures gives $0.474745$.", "answer": "$$\n\\boxed{0.474745}\n$$", "id": "2438015"}, {"introduction": "Moving from foundational calculations to practical implementation, the next step is to find the optimal portfolio of risky assets, known as the tangency portfolio. This computational exercise challenges you to build portfolios that maximize the Sharpe ratio, both with and without the real-world constraint of no short-selling [@problem_id:2442592]. By implementing a numerical optimizer and comparing the outcomes, you will not only learn how to solve for the efficient frontier but also quantify the \"cost\" that constraints impose on portfolio performance.", "problem": "You are given a series of independent instances of the Markowitz mean–variance portfolio selection environment. In each instance, there are finitely many risky assets with an expected return vector $\\boldsymbol{\\mu} \\in \\mathbb{R}^n$ (in decimal per period) and a symmetric, positive definite covariance matrix $\\boldsymbol{\\Sigma} \\in \\mathbb{R}^{n \\times n}$ (variance per period). A risk-free asset exists with return $r_f$ (in decimal per period). A portfolio is represented by a weight vector $\\boldsymbol{w} \\in \\mathbb{R}^n$ on the risky assets that satisfies the budget constraint $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$, where $\\boldsymbol{1}$ is the vector of ones. The expected return of $\\boldsymbol{w}$ is $\\mathbb{E}[R_p] = \\boldsymbol{\\mu}^\\top \\boldsymbol{w}$ and its variance is $\\mathrm{Var}(R_p) = \\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}$. The Sharpe ratio of $\\boldsymbol{w}$ relative to the risk-free rate $r_f$ is defined as\n$$\nS(\\boldsymbol{w}) = \\frac{\\boldsymbol{\\mu}^\\top \\boldsymbol{w} - r_f}{\\sqrt{\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}}}.\n$$\nThe tangency portfolio is any $\\boldsymbol{w}$ satisfying $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$ that maximizes $S(\\boldsymbol{w})$. Consider two versions of the tangency portfolio problem:\n- Unconstrained: $\\boldsymbol{w}$ may have negative components (short selling allowed).\n- No-short-selling constrained: $\\boldsymbol{w} \\succeq \\boldsymbol{0}$ componentwise (short selling forbidden).\n\nDefine the cost of the no-short-selling constraint as the nonnegative difference between the Sharpe ratios of the unconstrained and constrained tangency portfolios:\n$$\n\\text{cost} = S_{\\text{unconstrained}}^\\star - S_{\\text{constrained}}^\\star,\n$$\nexpressed as a decimal (no percentage sign).\n\nStarting from the foundational definitions above, implement a program that, for each test instance below, computes the unconstrained tangency portfolio’s Sharpe ratio, the no-short-selling constrained tangency portfolio’s Sharpe ratio, and returns the cost as a single floating-point number rounded to six digits after the decimal point. The program must not assume any asset units beyond the stated financial interpretation, and all outputs must be decimals with no percentage sign.\n\nTest suite (each case is $(\\boldsymbol{\\mu}, \\boldsymbol{\\Sigma}, r_f)$):\n\n- Case $1$:\n  - $\\boldsymbol{\\mu} = [\\,0.12,\\,0.10,\\,0.07\\,]$\n  - $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n  0.040  0.006  0.004\\\\\n  0.006  0.0225  0.0025\\\\\n  0.004  0.0025  0.010\n  \\end{bmatrix}$\n  - $r_f = 0.03$\n\n- Case $2$:\n  - $\\boldsymbol{\\mu} = [\\,0.14,\\,0.08,\\,0.06\\,]$\n  - $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n  0.050  0.010  0.008\\\\\n  0.010  0.040  0.012\\\\\n  0.008  0.012  0.030\n  \\end{bmatrix}$\n  - $r_f = 0.03$\n\n- Case $3$:\n  - $\\boldsymbol{\\mu} = [\\,0.11,\\,0.13,\\,0.09,\\,0.07\\,]$\n  - $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n  0.030  0.012  0.006  -0.003\\\\\n  0.012  0.050  0.009  0.000\\\\\n  0.006  0.009  0.020  0.004\\\\\n  -0.003  0.000  0.004  0.015\n  \\end{bmatrix}$\n  - $r_f = 0.02$\n\n- Case $4$:\n  - $\\boldsymbol{\\mu} = [\\,0.09,\\,0.07\\,]$\n  - $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n  0.015  0.006\\\\\n  0.006  0.025\n  \\end{bmatrix}$\n  - $r_f = 0.03$\n\nYour program should produce a single line of output containing the results for all cases as a comma-separated list enclosed in square brackets, for example $[\\,x_1, x_2, x_3, x_4\\,]$, where each $x_i$ is the computed cost rounded to six digits after the decimal point. Only this single line must be printed.", "solution": "The problem as stated is valid. It is scientifically grounded in the established Markowitz mean-variance optimization framework, is mathematically well-posed, and all necessary data and constraints are provided. We may proceed with a formal solution.\n\nThe problem requires the computation of the cost associated with imposing a no-short-selling constraint on a Markowitz tangency portfolio. This cost is defined as the difference in the maximum achievable Sharpe ratios between the unconstrained and constrained optimization problems. We shall analyze each optimization problem sequentially to construct the solution.\n\nLet $\\boldsymbol{\\mu} \\in \\mathbb{R}^n$ be the vector of expected returns, $r_f$ be the risk-free rate, and $\\boldsymbol{\\Sigma} \\in \\mathbb{R}^{n \\times n}$ be the symmetric, positive definite covariance matrix of $n$ risky assets. The vector of excess returns over the risk-free rate is denoted by $\\boldsymbol{\\mu}_e = \\boldsymbol{\\mu} - r_f\\boldsymbol{1}$, where $\\boldsymbol{1}$ is the vector of ones. The Sharpe ratio for a portfolio with weights $\\boldsymbol{w} \\in \\mathbb{R}^n$ is given by:\n$$\nS(\\boldsymbol{w}) = \\frac{\\boldsymbol{\\mu}^\\top \\boldsymbol{w} - r_f}{\\sqrt{\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}}} = \\frac{\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w}}{\\sqrt{\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}}}.\n$$\nThe problem is to find the portfolio weights $\\boldsymbol{w}$ that maximize $S(\\boldsymbol{w})$ under different sets of constraints.\n\nFirst, we address the unconstrained tangency portfolio. The optimization problem is to maximize $S(\\boldsymbol{w})$ subject to the budget constraint $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$. A key property of the Sharpe ratio is its invariance to positive scaling of the weights $\\boldsymbol{w}$. This allows a reformulation of the problem that is more amenable to solution. Maximizing $S(\\boldsymbol{w})$ is equivalent to minimizing the portfolio variance, $\\frac{1}{2}\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}$, subject to a fixed level of portfolio excess return, for instance, $\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w} = 1$. The budget constraint $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$ is not needed to find the maximum Sharpe ratio itself, but to determine the specific weights of the tangency portfolio, which can be found by scaling the solution of the simplified problem. The Lagrangian for this simplified problem is $\\mathcal{L}(\\boldsymbol{w}, \\lambda) = \\frac{1}{2}\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w} - \\lambda(\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w} - 1)$. The first-order condition $\\nabla_{\\boldsymbol{w}}\\mathcal{L} = \\boldsymbol{\\Sigma}\\boldsymbol{w} - \\lambda\\boldsymbol{\\mu}_e = \\boldsymbol{0}$ implies $\\boldsymbol{w} = \\lambda \\boldsymbol{\\Sigma}^{-1}\\boldsymbol{\\mu}_e$. Substituting this into the constraint $\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w} = 1$ gives $\\lambda = (\\boldsymbol{\\mu}_e^\\top \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_e)^{-1}$. The portfolio solving this sub-problem has variance $\\tilde{\\boldsymbol{w}}^\\top \\boldsymbol{\\Sigma} \\tilde{\\boldsymbol{w}} = (\\boldsymbol{\\mu}_e^\\top \\boldsymbol{\\Sigma}^{-1}\\boldsymbol{\\mu}_e)^{-1}$. The Sharpe ratio $S = (\\boldsymbol{\\mu}_e^\\top \\tilde{\\boldsymbol{w}}) / \\sqrt{\\tilde{\\boldsymbol{w}}^\\top \\boldsymbol{\\Sigma} \\tilde{\\boldsymbol{w}}} = 1 / \\sqrt{(\\boldsymbol{\\mu}_e^\\top \\boldsymbol{\\Sigma}^{-1}\\boldsymbol{\\mu}_e)^{-1}}$. Thus, the maximal Sharpe ratio for the unconstrained case is given by the analytical formula:\n$$\nS_{\\text{unconstrained}}^\\star = \\sqrt{\\boldsymbol{\\mu}_e^\\top \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_e} = \\sqrt{(\\boldsymbol{\\mu} - r_f\\boldsymbol{1})^\\top \\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\mu} - r_f\\boldsymbol{1})}.\n$$\n\nNext, we address the no-short-selling constrained tangency portfolio. The optimization problem adds the constraint $\\boldsymbol{w} \\succeq \\boldsymbol{0}$ (component-wise non-negativity). The problem is to maximize $S(\\boldsymbol{w})$ subject to $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$ and $\\boldsymbol{w} \\succeq \\boldsymbol{0}$. Using the same scale-invariance principle, this problem can be transformed into a quadratic program (QP). We minimize the variance for a fixed level of excess return, while respecting the non-negativity constraint. The QP is formulated as follows:\n$$\n\\begin{aligned}\n \\underset{\\boldsymbol{w} \\in \\mathbb{R}^n}{\\text{minimize}}\n  \\frac{1}{2} \\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w} \\\\\n \\text{subject to}\n  \\boldsymbol{\\mu}_e^\\top \\boldsymbol{w} = 1 \\\\\n   \\boldsymbol{w} \\succeq \\boldsymbol{0}.\n\\end{aligned}\n$$\nThis is a convex optimization problem, as the objective function is convex (since $\\boldsymbol{\\Sigma}$ is positive definite) and the constraints are linear. It does not have a general analytical solution and must be solved numerically. Let $\\boldsymbol{w}_c^\\star$ be the optimal weight vector that solves this QP. The minimal variance achieved under these constraints is $(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star$. The corresponding maximum Sharpe ratio is derived from the objective value: $S = (\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w}_c^\\star) / \\sqrt{(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star} = 1 / \\sqrt{(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star}$. Therefore, the maximum Sharpe ratio for the constrained case is:\n$$\nS_{\\text{constrained}}^\\star = \\frac{1}{\\sqrt{(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star}}.\n$$\n\nFinally, the cost of the no-short-selling constraint is computed as the non-negative difference between the two maximal Sharpe ratios:\n$$\n\\text{cost} = S_{\\text{unconstrained}}^\\star - S_{\\text{constrained}}^\\star.\n$$\nThe computational algorithm for each test case is:\n$1$. Construct the excess return vector $\\boldsymbol{\\mu}_e = \\boldsymbol{\\mu} - r_f\\boldsymbol{1}$.\n$2$. Compute the inverse of the covariance matrix, $\\boldsymbol{\\Sigma}^{-1}$.\n$3$. Calculate $S_{\\text{unconstrained}}^\\star$ using the analytical formula derived above.\n$4$. Solve the quadratic program numerically to find the optimal weights $\\boldsymbol{w}_c^\\star$ for the constrained problem.\n$5$. From the solution $\\boldsymbol{w}_c^\\star$, calculate the corresponding portfolio variance $(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star$ and subsequently find $S_{\\text{constrained}}^\\star$.\n$6$. Compute the cost and round the result to the specified precision of six decimal places.\nThis procedure will be implemented for each provided test case.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Computes the cost of the no-short-selling constraint for a series of\n    Markowitz portfolio optimization problems.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: mu, Sigma, rf\n        (np.array([0.12, 0.10, 0.07]),\n         np.array([[0.040, 0.006, 0.004],\n                   [0.006, 0.0225, 0.0025],\n                   [0.004, 0.0025, 0.010]]),\n         0.03),\n        # Case 2: mu, Sigma, rf\n        (np.array([0.14, 0.08, 0.06]),\n         np.array([[0.050, 0.010, 0.008],\n                   [0.010, 0.040, 0.012],\n                   [0.008, 0.012, 0.030]]),\n         0.03),\n        # Case 3: mu, Sigma, rf\n        (np.array([0.11, 0.13, 0.09, 0.07]),\n         np.array([[0.030, 0.012, 0.006, -0.003],\n                   [0.012, 0.050, 0.009, 0.000],\n                   [0.006, 0.009, 0.020, 0.004],\n                   [-0.003, 0.000, 0.004, 0.015]]),\n         0.02),\n        # Case 4: mu, Sigma, rf\n        (np.array([0.09, 0.07]),\n         np.array([[0.015, 0.006],\n                   [0.006, 0.025]]),\n         0.03)\n    ]\n\n    results = []\n    for mu, Sigma, rf in test_cases:\n        n = len(mu)\n        mu_e = mu - rf\n\n        # 1. Unconstrained Tangency Portfolio Sharpe Ratio\n        Sigma_inv = np.linalg.inv(Sigma)\n        # S_unconstrained^2 = mu_e.T * Sigma_inv * mu_e\n        s_unconstrained_sq = mu_e.T @ Sigma_inv @ mu_e\n        s_unconstrained = np.sqrt(s_unconstrained_sq)\n\n        # 2. Constrained (No-Short-Selling) Tangency Portfolio Sharpe Ratio\n        # We solve the QP: min 0.5 * w.T * Sigma * w, s.t. mu_e.T * w = 1 and w >= 0\n        \n        # Objective function to minimize\n        def objective_func(w, S):\n            return 0.5 * w.T @ S @ w\n\n        # Equality constraint: mu_e.T * w - 1 = 0\n        cons = ({'type': 'eq',\n                 'fun': lambda w, me: me.T @ w - 1,\n                 'args': (mu_e,)})\n        \n        # Bounds for weights: w_i >= 0 for all i\n        bnds = tuple((0, None) for _ in range(n))\n        \n        # Initial guess: a feasible point satisfying constraints.\n        # An equal weight portfolio is scaled to meet the equality constraint.\n        w0_init = np.ones(n) / n\n        w0 = w0_init / (mu_e.T @ w0_init)\n\n        # Solve the Quadratic Program using SLSQP\n        qp_result = minimize(objective_func, w0, args=(Sigma,), method='SLSQP',\n                             bounds=bnds, constraints=cons)\n        \n        # w_c_star is the solution to the QP\n        w_c_star = qp_result.x\n        \n        # The minimized variance is w_c_star.T * Sigma * w_c_star = 2 * qp_result.fun\n        # S_constrained = 1 / sqrt(variance)\n        variance_constrained = w_c_star.T @ Sigma @ w_c_star\n        s_constrained = 1 / np.sqrt(variance_constrained)\n        \n        # 3. Cost of the no-short-selling constraint\n        cost = s_unconstrained - s_constrained\n        results.append(cost)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "2442592"}, {"introduction": "A key challenge in finance is that models optimized on past data may perform poorly when market conditions change. This final practice explores the crucial concept of model robustness and out-of-sample testing [@problem_id:2442584]. You will compare the performance of a Markowitz-optimized portfolio, built on pre-crisis data, against a simple \"1/N\" diversification strategy during a simulated financial crisis, providing a powerful lesson on the potential fragility of optimization and the importance of considering model risk.", "problem": "You are given a setting with $N$ risky assets. For each asset $i \\in \\{1,\\dots,N\\}$, let the pre-crisis expected return be the $i$-th component of the vector $\\boldsymbol{\\mu}_{\\text{pre}} \\in \\mathbb{R}^N$, and the pre-crisis covariance matrix of returns be $\\boldsymbol{\\Sigma}_{\\text{pre}} \\in \\mathbb{R}^{N \\times N}$, which is symmetric positive definite. During a financial crisis, expected returns and covariances change to $\\boldsymbol{\\mu}_{\\text{crisis}} \\in \\mathbb{R}^N$ and $\\boldsymbol{\\Sigma}_{\\text{crisis}} \\in \\mathbb{R}^{N \\times N}$, respectively. The per-period risk-free rate is $r_f \\in \\mathbb{R}$. All returns must be treated and reported in decimal form (for example, $0.01$ denotes one percent).\n\nDefine two fully invested portfolios:\n- The equal-weight portfolio with weights $w^{\\text{eq}}_i = \\frac{1}{N}$ for all $i$.\n- The Markowitz-optimized portfolio (tangency portfolio under full investment) computed from pre-crisis parameters as the solution $\\boldsymbol{w}^{\\star} \\in \\mathbb{R}^N$ to the problem of maximizing the pre-crisis Sharpe ratio $(\\boldsymbol{w}^{\\top}\\boldsymbol{\\mu}_{\\text{pre}} - r_f)/\\sqrt{\\boldsymbol{w}^{\\top}\\boldsymbol{\\Sigma}_{\\text{pre}}\\boldsymbol{w}}$ subject to $\\sum_{i=1}^{N} w_i = 1$.\n\nFor each provided test case, compute the out-of-sample crisis-period Sharpe ratio of both portfolios using $\\boldsymbol{\\mu}_{\\text{crisis}}$ and $\\boldsymbol{\\Sigma}_{\\text{crisis}}$:\n$$\n\\text{SR}(\\boldsymbol{w}; \\boldsymbol{\\mu}_{\\text{crisis}}, \\boldsymbol{\\Sigma}_{\\text{crisis}}, r_f)\n= \\frac{\\boldsymbol{w}^{\\top}\\boldsymbol{\\mu}_{\\text{crisis}} - r_f}{\\sqrt{\\boldsymbol{w}^{\\top}\\boldsymbol{\\Sigma}_{\\text{crisis}}\\boldsymbol{w}}}.\n$$\nThen output, for each test case, the difference\n$$\n\\Delta = \\text{SR}(\\boldsymbol{w}^{\\text{eq}}; \\boldsymbol{\\mu}_{\\text{crisis}}, \\boldsymbol{\\Sigma}_{\\text{crisis}}, r_f) - \\text{SR}(\\boldsymbol{w}^{\\star}; \\boldsymbol{\\mu}_{\\text{crisis}}, \\boldsymbol{\\Sigma}_{\\text{crisis}}, r_f),\n$$\nrounded to $6$ decimals.\n\nUse the following test suite, which consists of $3$ cases designed to assess typical performance, equality conditions, and a stress configuration. In all cases, use $r_f = 0.0$ and $N = 3$.\n\n- Test Case $1$ (typical configuration):\n  - $\\boldsymbol{\\mu}_{\\text{pre}} = [0.010, 0.012, 0.008]$\n  - $\\boldsymbol{\\Sigma}_{\\text{pre}} = \\mathrm{diag}([0.0004, 0.0005, 0.0003])$\n  - $\\boldsymbol{\\mu}_{\\text{crisis}} = [-0.025, -0.022, -0.010]$\n  - $\\boldsymbol{\\Sigma}_{\\text{crisis}} = \\mathrm{diag}([0.0012, 0.0015, 0.0009])$\n- Test Case $2$ (symmetry boundary where all assets are identical):\n  - $\\boldsymbol{\\mu}_{\\text{pre}} = [0.010, 0.010, 0.010]$\n  - $\\boldsymbol{\\Sigma}_{\\text{pre}} = \\mathrm{diag}([0.0004, 0.0004, 0.0004])$\n  - $\\boldsymbol{\\mu}_{\\text{crisis}} = [-0.020, -0.020, -0.020]$\n  - $\\boldsymbol{\\Sigma}_{\\text{crisis}} = \\mathrm{diag}([0.0012, 0.0012, 0.0012])$\n- Test Case $3$ (stress configuration with pre-crisis concentration and adverse crisis reversal):\n  - $\\boldsymbol{\\mu}_{\\text{pre}} = [0.020, 0.008, 0.006]$\n  - $\\boldsymbol{\\Sigma}_{\\text{pre}} = \\mathrm{diag}([0.0003, 0.0006, 0.0005])$\n  - $\\boldsymbol{\\mu}_{\\text{crisis}} = [-0.040, -0.010, -0.012]$\n  - $\\boldsymbol{\\Sigma}_{\\text{crisis}} = \\mathrm{diag}([0.0012, 0.0024, 0.0020])$\n\nYour program should produce a single line of output containing the results for the $3$ test cases as a comma-separated list enclosed in square brackets, for example, $[\\Delta_1,\\Delta_2,\\Delta_3]$, where each $\\Delta_k$ is a float rounded to $6$ decimals.", "solution": "The problem statement has been rigorously analyzed. It is self-contained, scientifically grounded in established financial theory, and mathematically well-posed. All parameters are provided, and there are no internal contradictions. Therefore, the problem is deemed valid and a solution will be furnished.\n\nThe task is to compare the out-of-sample (crisis-period) performance of two distinct portfolio allocation strategies: a simple equal-weight portfolio and a Markowitz-optimized tangency portfolio. The performance metric is the Sharpe ratio. The core of the problem lies in first determining the asset weights for each portfolio and then using these weights to calculate their respective Sharpe ratios under crisis conditions.\n\nLet us define the parameters for a market of $N$ risky assets:\n- $\\boldsymbol{\\mu}_{\\text{pre}} \\in \\mathbb{R}^N$: Vector of expected returns, pre-crisis.\n- $\\boldsymbol{\\Sigma}_{\\text{pre}} \\in \\mathbb{R}^{N \\times N}$: Covariance matrix of returns, pre-crisis.\n- $\\boldsymbol{\\mu}_{\\text{crisis}} \\in \\mathbb{R}^N$: Vector of expected returns, during crisis.\n- $\\boldsymbol{\\Sigma}_{\\text{crisis}} \\in \\mathbb{R}^{N \\times N}$: Covariance matrix of returns, during crisis.\n- $r_f \\in \\mathbb{R}$: The risk-free rate of return.\n\nThe Sharpe ratio of a portfolio with weight vector $\\boldsymbol{w} \\in \\mathbb{R}^N$ is given by\n$$\n\\text{SR}(\\boldsymbol{w}; \\boldsymbol{\\mu}, \\boldsymbol{\\Sigma}, r_f) = \\frac{\\boldsymbol{w}^{\\top}\\boldsymbol{\\mu} - r_f}{\\sqrt{\\boldsymbol{w}^{\\top}\\boldsymbol{\\Sigma}\\boldsymbol{w}}}\n$$\nwhere $\\boldsymbol{w}^{\\top}\\boldsymbol{\\mu}$ is the portfolio's expected return and $\\sqrt{\\boldsymbol{w}^{\\top}\\boldsymbol{\\Sigma}\\boldsymbol{w}}$ is its standard deviation (volatility).\n\nThe analysis proceeds in four steps.\n\nStep 1: The Equal-Weight Portfolio ($\\boldsymbol{w}^{\\text{eq}}$)\nThis portfolio is constructed by allocating capital equally among all $N$ assets. The weight for each asset $i$ is thus $w^{\\text{eq}}_i = \\frac{1}{N}$. The weight vector is\n$$\n\\boldsymbol{w}^{\\text{eq}} = \\frac{1}{N}\\boldsymbol{1}\n$$\nwhere $\\boldsymbol{1}$ is the $N$-dimensional vector of ones. For the given problem, $N=3$, so $\\boldsymbol{w}^{\\text{eq}} = [1/3, 1/3, 1/3]^{\\top}$.\n\nStep 2: The Markowitz-Optimized Tangency Portfolio ($\\boldsymbol{w}^{\\star}$)\nThis portfolio, $\\boldsymbol{w}^{\\star}$, is the solution to the problem of maximizing the pre-crisis Sharpe ratio, subject to the constraint that the portfolio is fully invested ($\\sum_{i=1}^{N} w_i = 1$). The optimization problem is:\n$$\n\\max_{\\boldsymbol{w}} \\frac{\\boldsymbol{w}^{\\top}\\boldsymbol{\\mu}_{\\text{pre}} - r_f}{\\sqrt{\\boldsymbol{w}^{\\top}\\boldsymbol{\\Sigma}_{\\text{pre}}\\boldsymbol{w}}} \\quad \\text{subject to} \\quad \\boldsymbol{w}^{\\top}\\boldsymbol{1} = 1\n$$\nLet $\\boldsymbol{\\mu}_{\\text{excess}} = \\boldsymbol{\\mu}_{\\text{pre}} - r_f \\boldsymbol{1}$ be the vector of pre-crisis excess returns over the risk-free rate. The solution to this problem is well-established in portfolio theory. The unscaled optimal weights are proportional to $\\boldsymbol{\\Sigma}_{\\text{pre}}^{-1}\\boldsymbol{\\mu}_{\\text{excess}}$. To satisfy the full investment constraint, we normalize these weights:\n$$\n\\boldsymbol{w}^{\\star} = \\frac{\\boldsymbol{\\Sigma}_{\\text{pre}}^{-1}\\boldsymbol{\\mu}_{\\text{excess}}}{\\boldsymbol{1}^{\\top}(\\boldsymbol{\\Sigma}_{\\text{pre}}^{-1}\\boldsymbol{\\mu}_{\\text{excess}})}\n$$\nThis vector $\\boldsymbol{w}^{\\star}$ is computed using the pre-crisis parameters. It represents the optimal allocation strategy based on the information available before the crisis.\n\nStep 3: Calculation of Out-of-Sample Sharpe Ratios\nWe are required to evaluate the performance of both portfolios during the crisis. This means we use the weight vectors $\\boldsymbol{w}^{\\text{eq}}$ and $\\boldsymbol{w}^{\\star}$ (which are fixed) and compute their Sharpe ratios using the crisis-period parameters $\\boldsymbol{\\mu}_{\\text{crisis}}$ and $\\boldsymbol{\\Sigma}_{\\text{crisis}}$.\nThe Sharpe ratio for the equal-weight portfolio is:\n$$\n\\text{SR}_{\\text{eq}} = \\frac{(\\boldsymbol{w}^{\\text{eq}})^{\\top}\\boldsymbol{\\mu}_{\\text{crisis}} - r_f}{\\sqrt{(\\boldsymbol{w}^{\\text{eq}})^{\\top}\\boldsymbol{\\Sigma}_{\\text{crisis}}\\boldsymbol{w}^{\\text{eq}}}}\n$$\nThe Sharpe ratio for the Markowitz portfolio is:\n$$\n\\text{SR}_{\\star} = \\frac{(\\boldsymbol{w}^{\\star})^{\\top}\\boldsymbol{\\mu}_{\\text{crisis}} - r_f}{\\sqrt{(\\boldsymbol{w}^{\\star})^{\\top}\\boldsymbol{\\Sigma}_{\\text{crisis}}\\boldsymbol{w}^{\\star}}}\n$$\n\nStep 4: Final Difference Calculation\nThe final output for each test case is the difference between these two out-of-sample Sharpe ratios:\n$$\n\\Delta = \\text{SR}_{\\text{eq}} - \\text{SR}_{\\star}\n$$\nThis quantity measures how much better (if positive) or worse (if negative) the naive equal-weight strategy performed compared to the Markowitz-optimized strategy when evaluated on out-of-sample crisis data. A positive $\\Delta$ indicates that the simple diversification was more robust than the optimized portfolio, which was likely over-fitted to the pre-crisis conditions that did not persist.\n\nFor the implementation, we note that all covariance matrices provided are diagonal. A diagonal matrix $\\boldsymbol{\\Sigma} = \\mathrm{diag}([\\sigma_1^2, \\dots, \\sigma_N^2])$ has an inverse that is also diagonal: $\\boldsymbol{\\Sigma}^{-1} = \\mathrm{diag}([1/\\sigma_1^2, \\dots, 1/\\sigma_N^2])$. This simplifies the calculation of $\\boldsymbol{w}^{\\star}$. For all test cases, $N=3$ and $r_f=0.0$, which further simplifies $\\boldsymbol{\\mu}_{\\text{excess}}$ to $\\boldsymbol{\\mu}_{\\text{pre}}$. The computation will be performed for each test case using these formulas.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the portfolio performance comparison problem for the given test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"N\": 3,\n            \"r_f\": 0.0,\n            \"mu_pre\": np.array([0.010, 0.012, 0.008]),\n            \"Sigma_pre\": np.diag([0.0004, 0.0005, 0.0003]),\n            \"mu_crisis\": np.array([-0.025, -0.022, -0.010]),\n            \"Sigma_crisis\": np.diag([0.0012, 0.0015, 0.0009])\n        },\n        {\n            \"N\": 3,\n            \"r_f\": 0.0,\n            \"mu_pre\": np.array([0.010, 0.010, 0.010]),\n            \"Sigma_pre\": np.diag([0.0004, 0.0004, 0.0004]),\n            \"mu_crisis\": np.array([-0.020, -0.020, -0.020]),\n            \"Sigma_crisis\": np.diag([0.0012, 0.0012, 0.0012])\n        },\n        {\n            \"N\": 3,\n            \"r_f\": 0.0,\n            \"mu_pre\": np.array([0.020, 0.008, 0.006]),\n            \"Sigma_pre\": np.diag([0.0003, 0.0006, 0.0005]),\n            \"mu_crisis\": np.array([-0.040, -0.010, -0.012]),\n            \"Sigma_crisis\": np.diag([0.0012, 0.0024, 0.0020])\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N = case[\"N\"]\n        r_f = case[\"r_f\"]\n        mu_pre = case[\"mu_pre\"]\n        Sigma_pre = case[\"Sigma_pre\"]\n        mu_crisis = case[\"mu_crisis\"]\n        Sigma_crisis = case[\"Sigma_crisis\"]\n\n        # 1. Define the equal-weight portfolio\n        w_eq = np.ones(N) / N\n\n        # 2. Compute the Markowitz-optimized portfolio (tangency portfolio)\n        # using pre-crisis parameters.\n        mu_excess_pre = mu_pre - r_f * np.ones(N)\n        Sigma_pre_inv = np.linalg.inv(Sigma_pre)\n        \n        # Unscaled weights for tangency portfolio\n        w_tilde = Sigma_pre_inv @ mu_excess_pre\n        \n        # Normalize weights to sum to 1\n        w_star = w_tilde / np.sum(w_tilde)\n\n        def calculate_sharpe_ratio(w, mu, Sigma, rf):\n            \"\"\"\n            Calculates the Sharpe ratio for a given portfolio and market parameters.\n            \"\"\"\n            portfolio_return = w.T @ mu\n            portfolio_variance = w.T @ Sigma @ w\n            if portfolio_variance = 0:\n                # Handle cases with zero or negative variance for numerical stability.\n                # A portfolio with zero volatility and positive excess return has infinite Sharpe ratio.\n                # Here, we expect positive variance.\n                return np.inf if portfolio_return - rf > 0 else -np.inf if portfolio_return - rf  0 else 0.0\n            \n            portfolio_std_dev = np.sqrt(portfolio_variance)\n            return (portfolio_return - rf) / portfolio_std_dev\n\n        # 3. Calculate out-of-sample Sharpe ratios using crisis parameters\n        sr_eq = calculate_sharpe_ratio(w_eq, mu_crisis, Sigma_crisis, r_f)\n        sr_star = calculate_sharpe_ratio(w_star, mu_crisis, Sigma_crisis, r_f)\n        \n        # 4. Compute the difference and round to 6 decimals\n        delta = sr_eq - sr_star\n        results.append(round(delta, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2442584"}]}