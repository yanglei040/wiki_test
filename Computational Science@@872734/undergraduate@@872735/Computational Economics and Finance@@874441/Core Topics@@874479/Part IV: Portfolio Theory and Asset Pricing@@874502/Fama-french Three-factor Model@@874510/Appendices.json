{"hands_on_practices": [{"introduction": "A central task in empirical finance is to determine whether a new proposed factor adds real explanatory power to an existing model. This exercise provides a hands-on application of the F-test, the standard statistical tool for comparing nested models like the Fama-French model and an augmented version. By working through this problem [@problem_id:2392196], you will learn how to formally assess if the reduction in unexplained variance from adding a new variable is statistically meaningful or simply due to chance.", "problem": "Consider testing whether a predictive variable, the aggregate dividend yield, adds incremental explanatory power for portfolio excess returns after controlling for the Fama-French three-factor model (FF3). You observe monthly data for $T=240$ months on a test asset’s excess return $R_{t}-R_{f,t}$, the market excess return $R_{m,t}-R_{f,t}$, the size factor $\\mathrm{SMB}_{t}$ (Small Minus Big), the value factor $\\mathrm{HML}_{t}$ (High Minus Low), and the dividend yield $\\mathrm{DY}_{t}$. You estimate two Ordinary Least Squares (OLS) regressions:\n\nBaseline FF3 model with intercept:\n$$\nR_{t}-R_{f,t} \\;=\\; \\alpha \\;+\\; \\beta_{m}\\,\\big(R_{m,t}-R_{f,t}\\big) \\;+\\; \\beta_{s}\\,\\mathrm{SMB}_{t} \\;+\\; \\beta_{h}\\,\\mathrm{HML}_{t} \\;+\\; \\varepsilon_{t}.\n$$\n\nAugmented model adding dividend yield:\n$$\nR_{t}-R_{f,t} \\;=\\; \\alpha' \\;+\\; \\beta'_{m}\\,\\big(R_{m,t}-R_{f,t}\\big) \\;+\\; \\beta'_{s}\\,\\mathrm{SMB}_{t} \\;+\\; \\beta'_{h}\\,\\mathrm{HML}_{t} \\;+\\; \\gamma\\,\\mathrm{DY}_{t} \\;+\\; u_{t}.\n$$\n\nBoth models include an intercept. The dividend yield series $\\mathrm{DY}_{t}$ is linearly independent of the FF3 regressors in the sample, and all regressors are observed without error. Let $S_{0}$ denote the sum of squared residuals from the baseline FF3 model and $S_{1}$ denote the sum of squared residuals from the augmented model. You obtain $S_{0}=0.216$ and $S_{1}=0.204$. The number of estimated parameters is $k_{0}=4$ for the baseline model and $k_{1}=5$ for the augmented model.\n\nAt the $5\\%$ significance level, which statement is most appropriate regarding whether the dividend yield has any remaining explanatory power for the asset’s excess returns after accounting for the three FF3 factors?\n\nA. Yes. The reduction in residual variation is statistically significant at the $5\\%$ level, indicating incremental explanatory power for $\\mathrm{DY}_{t}$.\n\nB. No. The value factor already spans dividend yield, making $\\mathrm{DY}_{t}$ perfectly collinear and non-identifiable in the augmented regression.\n\nC. No. The reduction in residual variation is too small to be statistically distinguishable at the $5\\%$ level given $T=240$.\n\nD. Inconclusive. Because no intercept is included, the test for incremental explanatory power cannot be conducted.", "solution": "The problem statement must first be validated for scientific and logical integrity.\n\nThe given data and conditions are as follows:\n- The number of observations is $T=240$ months.\n- The dependent variable is the test asset's excess return, $R_{t}-R_{f,t}$.\n- The baseline (restricted) model is the Fama-French three-factor model with an intercept:\n$$ R_{t}-R_{f,t} \\;=\\; \\alpha \\;+\\; \\beta_{m}\\,\\big(R_{m,t}-R_{f,t}\\big) \\;+\\; \\beta_{s}\\,\\mathrm{SMB}_{t} \\;+\\; \\beta_{h}\\,\\mathrm{HML}_{t} \\;+\\; \\varepsilon_{t} $$\nThe number of estimated parameters in this model is $k_{0}=4$ (corresponding to $\\alpha$, $\\beta_{m}$, $\\beta_{s}$, and $\\beta_{h}$). The sum of squared residuals from this model is $S_{0}=0.216$.\n\n- The augmented (unrestricted) model adds the dividend yield, $\\mathrm{DY}_{t}$:\n$$ R_{t}-R_{f,t} \\;=\\; \\alpha' \\;+\\; \\beta'_{m}\\,\\big(R_{m,t}-R_{f,t}\\big) \\;+\\; \\beta'_{s}\\,\\mathrm{SMB}_{t} \\;+\\; \\beta'_{h}\\,\\mathrm{HML}_{t} \\;+\\; \\gamma\\,\\mathrm{DY}_{t} \\;+\\; u_{t} $$\nThe number of estimated parameters in this model is $k_{1}=5$ (corresponding to $\\alpha'$, $\\beta'_{m}$, $\\beta'_{s}$, $\\beta'_{h}$, and $\\gamma$). The sum of squared residuals from this model is $S_{1}=0.204$.\n\n- A key condition is that $\\mathrm{DY}_{t}$ is linearly independent of the other regressors.\n- The significance level for the test is specified as $5\\%$.\n\nThe problem is scientifically grounded in the domain of financial econometrics, specifically asset pricing model testing. It is well-posed, providing all necessary information to conduct a hypothesis test on the incremental explanatory power of a variable. The stated conditions and data are self-contained and consistent. No flaws are identified. The problem is therefore valid, and we may proceed with the solution.\n\nThe question is whether the dividend yield, $\\mathrm{DY}_{t}$, has incremental explanatory power. This is equivalent to testing the null hypothesis $H_{0}: \\gamma = 0$ against the alternative hypothesis $H_{A}: \\gamma \\neq 0$ in the augmented model. The standard procedure for testing such a restriction on nested linear models is the F-test.\n\nThe F-statistic is formulated as:\n$$ F = \\frac{(S_{0} - S_{1}) / q}{(S_{1}) / (T - k_{1})} $$\nwhere:\n- $S_{0}$ is the sum of squared residuals from the restricted model ($0.216$).\n- $S_{1}$ is the sum of squared residuals from the unrestricted model ($0.204$).\n- $q$ is the number of restrictions, which is the difference in the number of parameters between the two models. Here, $q = k_{1} - k_{0} = 5 - 4 = 1$.\n- $T$ is the number of observations ($240$).\n- $k_{1}$ is the number of parameters in the unrestricted model ($5$).\n\nSubstituting the given values into the formula:\n$$ F = \\frac{(0.216 - 0.204) / 1}{(0.204) / (240 - 5)} = \\frac{0.012}{0.204 / 235} $$\nCalculation of the F-statistic yields:\n$$ F = \\frac{0.012}{0.000868085...} \\approx 13.8235 $$\n\nThis calculated F-statistic must be compared to the critical value from an F-distribution with $(q, T-k_1)$ degrees of freedom at the specified significance level of $5\\%$. The degrees of freedom are $(1, 235)$.\n\nThe critical value, $F_{c}$, for an F-distribution with $(1, 235)$ degrees of freedom at the $\\alpha = 0.05$ significance level is sought. For large denominator degrees of freedom, the F-distribution with $1$ numerator degree of freedom approaches a chi-squared distribution with $1$ degree of freedom. The $95$th percentile of a $\\chi^2(1)$ distribution is $3.841$. A more precise value for $F_{0.05}(1, 235)$ from statistical tables or software is approximately $3.882$.\n\nWe compare the calculated F-statistic with the critical value:\n$$ F_{calculated} \\approx 13.82  F_{critical} \\approx 3.882 $$\nSince the calculated F-statistic is greater than the critical value, we reject the null hypothesis $H_{0}: \\gamma = 0$. The result is statistically significant at the $5\\%$ level. This indicates that the addition of the dividend yield variable, $\\mathrm{DY}_{t}$, leads to a statistically significant reduction in the sum of squared residuals. Therefore, $\\mathrm{DY}_{t}$ possesses incremental explanatory power for the asset's excess returns beyond that provided by the Fama-French three-factor model.\n\nNow, we evaluate each option.\n\nA. Yes. The reduction in residual variation is statistically significant at the $5\\%$ level, indicating incremental explanatory power for $\\mathrm{DY}_{t}$.\nThis statement is a direct and accurate conclusion from our F-test. The test has confirmed that the reduction in the sum of squared residuals from $S_0=0.216$ to $S_1=0.204$ is statistically significant, which by definition means $\\mathrm{DY}_{t}$ has explanatory power.\n**Verdict: Correct.**\n\nB. No. The value factor already spans dividend yield, making $\\mathrm{DY}_{t}$ perfectly collinear and non-identifiable in the augmented regression.\nThis statement is factually incorrect based on the problem's premises. The problem explicitly states that \"The dividend yield series $\\mathrm{DY}_{t}$ is linearly independent of the FF3 regressors in the sample.\" This rules out perfect collinearity. If perfect collinearity were present, the OLS estimation of the augmented model would not have been possible.\n**Verdict: Incorrect.**\n\nC. No. The reduction in residual variation is too small to be statistically distinguishable at the $5\\%$ level given $T=240$.\nThis statement claims the opposite of our finding. The F-test, which is the correct procedure to determine if a reduction in residual variation is \"too small,\" has shown that the reduction is, in fact, statistically significant. The magnitude of the reduction cannot be judged in isolation; it must be evaluated relative to the residual variance and sample size, which is precisely what the F-statistic does. Our calculation proved the reduction is significant.\n**Verdict: Incorrect.**\n\nD. Inconclusive. Because no intercept is included, the test for incremental explanatory power cannot be conducted.\nThis statement is based on a false premise. The problem explicitly states \"Both models include an intercept,\" and the model equations clearly show intercept terms ($\\alpha$ and $\\alpha'$). The parameter counts $k_0=4$ and $k_1=5$ are also consistent with the presence of an intercept.\n**Verdict: Incorrect.**", "answer": "$$\\boxed{A}$$", "id": "2392196"}, {"introduction": "The Fama-French model was developed because the simpler Capital Asset Pricing Model (CAPM) left systematic patterns in asset returns unexplained. This coding exercise [@problem_id:2448010] brings this issue to life by demonstrating a key consequence of model misspecification: autocorrelated residuals. You will simulate data where the Fama-French model is true and see firsthand how the residuals from an incorrectly fitted CAPM fail a 'white noise' test, providing clear evidence that important factors have been omitted.", "problem": "Consider a sequence of excess returns for a single asset modeled as a linear factor model with a white noise disturbance. Let the market factor, the size factor, and the value factor be denoted by $M_t$, $\\mathrm{SMB}_t$, and $\\mathrm{HML}_t$, respectively. For each time index $t \\in \\{1,2,\\dots,T\\}$, the asset’s excess return $R_t^{e}$ is generated by\n$$\nR_t^{e} \\;=\\; \\alpha \\;+\\; \\beta_M M_t \\;+\\; \\beta_S \\mathrm{SMB}_t \\;+\\; \\beta_H \\mathrm{HML}_t \\;+\\; \\varepsilon_t,\n$$\nwhere the disturbance $\\{\\varepsilon_t\\}$ is a white noise process: $\\mathbb{E}[\\varepsilon_t]=0$, $\\operatorname{Var}(\\varepsilon_t)=\\sigma_{\\varepsilon}^2$, and $\\operatorname{Cov}(\\varepsilon_t,\\varepsilon_s)=0$ for $t\\neq s$.\n\nThe factors $(M_t,\\mathrm{SMB}_t,\\mathrm{HML}_t)$ follow independent autoregressive processes of order one with Gaussian innovations and zero initial conditions:\n$$\nM_t \\;=\\; \\phi_M M_{t-1} \\;+\\; \\eta_{M,t}, \\quad \\mathrm{SMB}_t \\;=\\; \\phi_S \\mathrm{SMB}_{t-1} \\;+\\; \\eta_{S,t}, \\quad \\mathrm{HML}_t \\;=\\; \\phi_H \\mathrm{HML}_{t-1} \\;+\\; \\eta_{H,t},\n$$\nwith $M_0=\\mathrm{SMB}_0=\\mathrm{HML}_0=0$, where $\\{\\eta_{M,t}\\}$, $\\{\\eta_{S,t}\\}$, and $\\{\\eta_{H,t}\\}$ are mutually independent sequences of independent and identically distributed Gaussian random variables, each with mean $0$ and variances chosen so that the stationary variance of each factor process is $1$. That is, for $f \\in \\{M,S,H\\}$, the innovation variance satisfies $\\operatorname{Var}(\\eta_{f,t})=1-\\phi_f^2$.\n\nFor a given realization of $\\{(R_t^{e},M_t,\\mathrm{SMB}_t,\\mathrm{HML}_t)\\}_{t=1}^T$, consider two linear regressions with intercept:\n(1) the Capital Asset Pricing Model (CAPM): $R_t^{e}$ on $\\{1,M_t\\}$, and\n(2) the Fama-French three-factor model: $R_t^{e}$ on $\\{1,M_t,\\mathrm{SMB}_t,\\mathrm{HML}_t\\}$.\nBoth are to be estimated by least squares defined as the minimizer of the sum of squared residuals, producing residual sequences $\\{e^{\\mathrm{CAPM}}_t\\}_{t=1}^T$ and $\\{e^{\\mathrm{FF3}}_t\\}_{t=1}^T$.\n\nDefine the sample autocorrelation at lag $k$ for a residual sequence $\\{e_t\\}_{t=1}^T$ by\n$$\n\\hat{r}_k \\;=\\; \\frac{\\sum_{t=k+1}^{T} (e_t - \\bar{e})(e_{t-k} - \\bar{e})}{\\sum_{t=1}^{T} (e_t - \\bar{e})^2}, \\quad \\text{where } \\bar{e}=\\frac{1}{T}\\sum_{t=1}^{T} e_t.\n$$\nDefine the Ljung-Box portmanteau statistic at maximum lag $m$ by\n$$\nQ(m) \\;=\\; T(T+2)\\sum_{k=1}^{m} \\frac{\\hat{r}_k^2}{T-k}.\n$$\nUnder the null hypothesis that the residuals are white noise, take the reference distribution of $Q(m)$ to be the chi-square distribution with $m$ degrees of freedom. For a given residual sequence, let the whiteness $p$-value be $p = 1 - F_{\\chi^2_m}(Q(m))$, where $F_{\\chi^2_m}$ denotes the cumulative distribution function of the chi-square distribution with $m$ degrees of freedom. Define that one set of residuals is “whiter” than another if its Ljung-Box $p$-value is strictly larger.\n\nUsing a fixed random seed for reproducibility, generate the factor processes and asset returns according to the specifications above, and, for each test case below, estimate both regressions and compute the Ljung-Box $p$-values at the specified maximum lag. For each test case, output a boolean equal to true if the Fama-French three-factor residuals are whiter than the CAPM residuals, and false otherwise.\n\nGlobal simulation parameters to be used in all cases:\n- Factor autoregressive coefficients: $\\phi_M=0.6$, $\\phi_S=0.5$, $\\phi_H=0.4$.\n- Initial conditions: $M_0=\\mathrm{SMB}_0=\\mathrm{HML}_0=0$.\n\nTest suite (four cases), each specified by $(T, \\beta_M, \\beta_S, \\beta_H, \\sigma_{\\varepsilon}, m)$:\n- Case $1$: $(T=\\;600,\\;\\beta_M=\\;0.9,\\;\\beta_S=\\;0.5,\\;\\beta_H=\\;-0.3,\\;\\sigma_{\\varepsilon}=\\;0.5,\\;m=\\;10)$.\n- Case $2$: $(T=\\;600,\\;\\beta_M=\\;1.1,\\;\\beta_S=\\;0.0,\\;\\beta_H=\\;0.0,\\;\\sigma_{\\varepsilon}=\\;0.5,\\;m=\\;10)$.\n- Case $3$: $(T=\\;120,\\;\\beta_M=\\;0.0,\\;\\beta_S=\\;0.8,\\;\\beta_H=\\;0.8,\\;\\sigma_{\\varepsilon}=\\;0.5,\\;m=\\;10)$.\n- Case $4$: $(T=\\;60,\\;\\beta_M=\\;0.0,\\;\\beta_S=\\;0.0,\\;\\beta_H=\\;0.0,\\;\\sigma_{\\varepsilon}=\\;1.0,\\;m=\\;10)$.\n\nRandomness and reuse rule:\n- Use a single common realization of the factor processes of length $T_{\\max}$, where $T_{\\max}$ is the largest $T$ among the test cases, and for each case use the first $T$ observations of each factor. Use a fixed and clearly specified random seed so that the realization is uniquely determined.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of four booleans enclosed in square brackets, in the order of the test cases, for example, [True,False,True,False].\n- No physical units are involved. Angles are not involved. If any fraction is needed, it should be represented as a decimal number, but the required outputs here are booleans only.", "solution": "The problem posed is a well-defined simulation exercise in financial econometrics. It is scientifically grounded in the theory of linear factor models and model diagnostics, specifically concerning omitted variable bias and its detection through tests for serial correlation in regression residuals. It is complete, consistent, and objectively stated, hence it is a valid problem. We shall proceed to its solution.\n\nThe fundamental principle being examined is that of correct model specification. The data generating process (DGP) for the asset's excess return, $R_t^{e}$, is given by the Fama-French three-factor model with an appended white noise disturbance term $\\{\\varepsilon_t\\}$:\n$$\nR_t^{e} \\;=\\; \\alpha \\;+\\; \\beta_M M_t \\;+\\; \\beta_S \\mathrm{SMB}_t \\;+\\; \\beta_H \\mathrm{HML}_t \\;+\\; \\varepsilon_t\n$$\nThe factors themselves, $\\{M_t\\}$, $\\{\\mathrm{SMB}_t\\}$, and $\\{\\mathrm{HML}_t\\}$, are not white noise but exhibit temporal dependence as they are modeled by autoregressive processes of order one (AR($1$)).\n\nWhen we estimate the Capital Asset Pricing Model (CAPM) by regressing $R_t^e$ on only a constant and the market factor $M_t$, we introduce a specification error if the true coefficients $\\beta_S$ or $\\beta_H$ are non-zero. The influence of the omitted factors, $\\mathrm{SMB}_t$ and $\\mathrm{HML}_t$, is absorbed by the CAPM's residual term. Let the estimated CAPM be $\\hat{R}_t^e = \\hat{a}_{\\mathrm{CAPM}} + \\hat{b}_M M_t$. The resulting residuals, $e_t^{\\mathrm{CAPM}} = R_t^e - \\hat{R}_t^e$, will then approximate:\n$$\ne_t^{\\mathrm{CAPM}} \\approx (\\alpha - \\hat{a}_{\\mathrm{CAPM}}) + (\\beta_M - \\hat{b}_M) M_t + \\beta_S \\mathrm{SMB}_t + \\beta_H \\mathrm{HML}_t + \\varepsilon_t\n$$\nSince $\\mathrm{SMB}_t$ and $\\mathrm{HML}_t$ are serially correlated, this autocorrelation structure is imparted to the CAPM residuals, causing them to deviate from white noise.\n\nConversely, estimating the Fama-French three-factor model is consistent with the DGP. The residuals from this correctly specified model, $e_t^{\\mathrm{FF3}}$, will be consistent estimators of the true innovations, $\\varepsilon_t$, which are stipulated to be white noise.\n\nThe Ljung-Box test is a formal statistical test for autocorrelation. The test statistic, $Q(m)$, aggregates the first $m$ squared sample autocorrelations. Under the null hypothesis that the series is white noise, $Q(m)$ is approximately distributed as a chi-square random variable with $m$ degrees of freedom. A low p-value indicates a rejection of the null, suggesting the presence of significant serial correlation.\n\nTherefore, we expect the Ljung-Box test applied to the misspecified CAPM residuals to yield a low p-value (detecting autocorrelation) when $\\beta_S$ or $\\beta_H$ are non-zero. The test on the FF3 residuals should yield a high p-value (failing to detect autocorrelation). The problem defines \"whiter\" residuals as those having a strictly larger p-value, so we anticipate the FF3 residuals to be whiter than the CAPM residuals in cases of CAPM misspecification. In cases where the CAPM is the true model (i.e., $\\beta_S = \\beta_H = 0$), both residual series should be approximately white noise, and any difference in p-values arises from finite-sample estimation variance.\n\nThe algorithm to solve the problem is as follows:\n$1$. **Setup**: A fixed random seed ($42$) is used for reproducibility. Global parameters ($\\phi_M=0.6$, $\\phi_S=0.5$, $\\phi_H=0.4$) are defined. The intercept $\\alpha$ in the DGP is set to $0$ without loss of generality, as OLS with an intercept is invariant to such a shift.\n\n$2$. **Factor Generation**: The factor processes ($M_t, \\mathrm{SMB}_t, \\mathrm{HML}_t$) are generated as AR($1$) series for $T_{\\max}=600$ periods, the maximum length required by the test suite. For each factor $f \\in \\{M,S,H\\}$, the innovation variance is set to $\\sigma^2_{\\eta,f} = 1 - \\phi_f^2$ to ensure the stationary variance of the factor is $1$. The initial conditions are $M_0=\\mathrm{SMB}_0=\\mathrm{HML}_0=0$.\n\n$3$. **Iterative Analysis**: We loop through each of the four test cases. For a given case with parameters $(T, \\beta_M, \\beta_S, \\beta_H, \\sigma_{\\varepsilon}, m)$:\n    a. We select the first $T$ observations of the generated factor series.\n    b. The asset return series $R_t^e$ is synthesized using the case-specific $\\beta$ parameters and a new sequence of Gaussian white noise errors $\\varepsilon_t \\sim \\mathcal{N}(0, \\sigma_{\\varepsilon}^2)$.\n    c. Two models are estimated using Ordinary Least Squares (OLS):\n        i. CAPM: $R_t^e$ on a constant and $M_t$.\n        ii. FF3: $R_t^e$ on a constant, $M_t$, $\\mathrm{SMB}_t$, and $\\mathrm{HML}_t$.\n    d. The residual vectors, $e^{\\mathrm{CAPM}}$ and $e^{\\mathrm{FF3}}$, are calculated for each model.\n    e. The Ljung-Box p-value is computed for both residual series using the provided formulas for the sample autocorrelation $\\hat{r}_k$ and the $Q(m)$ statistic, with a $\\chi^2_m$ reference distribution.\n    f. A boolean result is determined by the condition $p_{\\mathrm{FF3}}  p_{\\mathrm{CAPM}}$.\n\n$4$. **Final Output**: The list of four boolean results is formatted and printed as specified.\n\nThe implementation will use `numpy` for array computations and OLS estimation via `numpy.linalg.lstsq`, and `scipy.stats.chi2.cdf` for the chi-square cumulative distribution function.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import chi2\n\ndef solve():\n    \"\"\"\n    Solves the problem by simulating asset returns, estimating CAPM and FF3 models,\n    and comparing the whiteness of their residuals using the Ljung-Box test.\n    \"\"\"\n    # Define global simulation parameters and random seed for reproducibility.\n    SEED = 42\n    rng = np.random.default_rng(SEED)\n    \n    phi_M = 0.6\n    phi_S = 0.5\n    phi_H = 0.4\n    alpha = 0.0  # Assumed value, does not affect residuals with intercept.\n\n    # Define the test suite.\n    test_cases = [\n        # (T, beta_M, beta_S, beta_H, sigma_eps, m)\n        (600, 0.9, 0.5, -0.3, 0.5, 10),\n        (600, 1.1, 0.0, 0.0, 0.5, 10),\n        (120, 0.0, 0.8, 0.8, 0.5, 10),\n        (60, 0.0, 0.0, 0.0, 1.0, 10),\n    ]\n\n    T_max = max(case[0] for case in test_cases)\n\n    def generate_ar1(T, phi, rng_gen):\n        \"\"\"Generates an AR(1) process of length T with stationary variance 1.\"\"\"\n        sigma_eta = np.sqrt(1 - phi**2)\n        eta = rng_gen.normal(loc=0.0, scale=sigma_eta, size=T)\n        process = np.zeros(T)\n        # Process starts at t=1 with F_0 = 0.\n        # F_1 = phi * F_0 + eta_1 = eta_1.\n        if T > 0:\n            process[0] = eta[0]\n            for t in range(1, T):\n                process[t] = phi * process[t-1] + eta[t]\n        return process\n\n    # Generate a single common realization of factor processes.\n    M_full = generate_ar1(T_max, phi_M, rng)\n    SMB_full = generate_ar1(T_max, phi_S, rng)\n    HML_full = generate_ar1(T_max, phi_H, rng)\n    \n    def ljung_box_p_value(residuals, m):\n        \"\"\"Computes the Ljung-Box Q-statistic and its p-value.\"\"\"\n        T = len(residuals)\n        e_bar = np.mean(residuals) # Should be ~0 for OLS with intercept\n        e_demeaned = residuals - e_bar\n        \n        denominator = np.sum(e_demeaned**2)\n        if denominator  1e-12:  # Avoid division by zero\n            return 1.0  # No variation means no autocorrelation.\n\n        q_terms = []\n        for k in range(1, m + 1):\n            numerator_k = np.sum(e_demeaned[k:] * e_demeaned[:-k])\n            r_k = numerator_k / denominator\n            q_terms.append(r_k**2 / (T - k))\n            \n        Q_m = T * (T + 2) * np.sum(q_terms)\n        \n        # p-value from chi-square distribution with m degrees of freedom.\n        p_val = 1.0 - chi2.cdf(Q_m, df=m)\n        return p_val\n\n    results = []\n    for case in test_cases:\n        T, beta_M, beta_S, beta_H, sigma_eps, m = case\n\n        # Use the first T observations of the common factor series.\n        M_t = M_full[:T]\n        SMB_t = SMB_full[:T]\n        HML_t = HML_full[:T]\n\n        # Generate asset returns for the current case.\n        epsilon = rng.normal(loc=0.0, scale=sigma_eps, size=T)\n        R_e = alpha + beta_M * M_t + beta_S * SMB_t + beta_H * HML_t + epsilon\n\n        # (1) Estimate CAPM and get residuals.\n        X_capm = np.vstack([np.ones(T), M_t]).T\n        beta_hat_capm = np.linalg.lstsq(X_capm, R_e, rcond=None)[0]\n        e_capm = R_e - X_capm @ beta_hat_capm\n        \n        # (2) Estimate Fama-French 3-factor model and get residuals.\n        X_ff3 = np.vstack([np.ones(T), M_t, SMB_t, HML_t]).T\n        beta_hat_ff3 = np.linalg.lstsq(X_ff3, R_e, rcond=None)[0]\n        e_ff3 = R_e - X_ff3 @ beta_hat_ff3\n\n        # Compute Ljung-Box p-values for both residual series.\n        p_val_capm = ljung_box_p_value(e_capm, m)\n        p_val_ff3 = ljung_box_p_value(e_ff3, m)\n\n        # Compare p-values to determine which residual set is \"whiter\".\n        is_ff3_whiter = p_val_ff3 > p_val_capm\n        results.append(is_ff3_whiter)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2448010"}, {"introduction": "Factors like SMB (Small Minus Big) and HML (High Minus Low) are not abstract concepts; they are tradable portfolios constructed to isolate specific sources of risk. This practice [@problem_id:2392242] delves into the core methodology of creating such 'factor-mimicking portfolios' through constrained optimization. By building a portfolio that captures a novel characteristic, such as an ESG score, while neutralizing exposure to existing factors, you will engage with a foundational technique in modern quantitative asset pricing.", "problem": "You are given a cross-section of assets and their exposures relevant to the Fama-French three-factor model (FF3) and a novel characteristic. The Fama-French three-factor model (FF3) encompasses the Market factor, Small-Minus-Big (SMB), and High-Minus-Low (HML). The novel characteristic is an Environmental, Social, and Governance (ESG) score. Your task is to construct minimum-variance factor-mimicking portfolios for the ESG characteristic under specified linear exposure constraints using a given panel of asset excess returns.\n\nLet there be $N=6$ assets and $T=10$ time periods. Let $R \\in \\mathbb{R}^{T \\times N}$ denote the matrix of asset excess returns in decimal form, where row $t$ contains the $N$ asset excess returns for period $t$. The data for $R$ are:\n- Row $1$: $(0.012, 0.008, 0.015, 0.005, 0.010, 0.011)$\n- Row $2$: $(-0.020, -0.015, -0.018, -0.022, -0.017, -0.019)$\n- Row $3$: $(0.025, 0.020, 0.028, 0.018, 0.022, 0.024)$\n- Row $4$: $(0.005, 0.007, 0.004, 0.009, 0.006, 0.005)$\n- Row $5$: $(0.030, 0.026, 0.033, 0.021, 0.027, 0.029)$\n- Row $6$: $(-0.010, -0.012, -0.009, -0.013, -0.011, -0.010)$\n- Row $7$: $(0.018, 0.014, 0.020, 0.012, 0.016, 0.017)$\n- Row $8$: $(-0.005, -0.006, -0.004, -0.007, -0.005, -0.005)$\n- Row $9$: $(0.022, 0.019, 0.024, 0.016, 0.020, 0.021)$\n- Row $10$: $(0.003, 0.004, 0.002, 0.005, 0.003, 0.003)$\n\nLet $\\Sigma \\in \\mathbb{R}^{N \\times N}$ denote the covariance matrix of asset excess returns computed as the population covariance estimator:\n$$\n\\Sigma \\;=\\; \\frac{1}{T} \\sum_{t=1}^{T} \\left( r_t - \\bar{r} \\right)\\left( r_t - \\bar{r} \\right)^{\\top},\n$$\nwhere $r_t \\in \\mathbb{R}^{N}$ is the $t$-th row of $R$ and $\\bar{r} \\in \\mathbb{R}^{N}$ is the vector of time-series means of the asset returns.\n\nYou are also given exposure vectors for each asset to the FF3 factors and the ESG characteristic. Let $f^{\\text{MKT}}, f^{\\text{SMB}}, f^{\\text{HML}}, f^{\\text{ESG}} \\in \\mathbb{R}^{N}$ denote the exposures per asset:\n- $f^{\\text{MKT}} = (1.10, 0.90, 1.20, 0.80, 1.00, 1.05)$\n- $f^{\\text{SMB}} = (-0.30, 0.50, -0.20, 0.70, 0.10, -0.40)$\n- $f^{\\text{HML}} = (0.60, -0.20, 0.40, -0.50, 0.00, 0.30)$\n- $f^{\\text{ESG}} = (0.80, 0.20, -0.40, 1.10, -0.60, 0.30)$\n\nA factor-mimicking portfolio is a vector of portfolio weights $w \\in \\mathbb{R}^{N}$ that is chosen to minimize the portfolio variance subject to linear exposure constraints. Formally, for a given constraint matrix $A \\in \\mathbb{R}^{K \\times N}$ and target exposure vector $b \\in \\mathbb{R}^{K}$, the weights $w$ solve:\n$$\n\\min_{w \\in \\mathbb{R}^{N}} \\; w^{\\top}\\Sigma w \\quad \\text{subject to} \\quad A w = b.\n$$\n\nConsider the following four test cases, each specifying a set of constraints. Let $\\mathbf{1} \\in \\mathbb{R}^{N}$ denote the vector of ones.\n\n- Test case $1$ (self-financing, neutral to FF3, unit ESG exposure):\n  - Constraints: $\\mathbf{1}^{\\top} w = 0$, $(f^{\\text{MKT}})^{\\top} w = 0$, $(f^{\\text{SMB}})^{\\top} w = 0$, $(f^{\\text{HML}})^{\\top} w = 0$, $(f^{\\text{ESG}})^{\\top} w = 1$.\n- Test case $2$ (self-financing, neutral to FF3, negative unit ESG exposure):\n  - Constraints: $\\mathbf{1}^{\\top} w = 0$, $(f^{\\text{MKT}})^{\\top} w = 0$, $(f^{\\text{SMB}})^{\\top} w = 0$, $(f^{\\text{HML}})^{\\top} w = 0$, $(f^{\\text{ESG}})^{\\top} w = -1$.\n- Test case $3$ (fully invested, neutral to FF3, half ESG exposure):\n  - Constraints: $\\mathbf{1}^{\\top} w = 1$, $(f^{\\text{MKT}})^{\\top} w = 0$, $(f^{\\text{SMB}})^{\\top} w = 0$, $(f^{\\text{HML}})^{\\top} w = 0$, $(f^{\\text{ESG}})^{\\top} w = 0.5$.\n- Test case $4$ (self-financing, neutral to FF3, zero ESG exposure; boundary case):\n  - Constraints: $\\mathbf{1}^{\\top} w = 0$, $(f^{\\text{MKT}})^{\\top} w = 0$, $(f^{\\text{SMB}})^{\\top} w = 0$, $(f^{\\text{HML}})^{\\top} w = 0$, $(f^{\\text{ESG}})^{\\top} w = 0$.\n\nFor each test case, compute the minimum-variance factor-mimicking portfolio $w$ and report the portfolio variance $v = w^{\\top} \\Sigma w$ as a real number. The return inputs are decimals (unitless), and the reported $v$ must be unitless.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of test cases $1$ through $4$, for example: \"[v1,v2,v3,v4]\".", "solution": "The problem presented is a standard exercise in quantitative finance: the construction of minimum-variance factor-mimicking portfolios under a set of linear constraints. This is a canonical constrained quadratic optimization problem.\n\nThe problem is defined as follows:\n$$ \\min_{w \\in \\mathbb{R}^{N}} \\; v = w^{\\top}\\Sigma w $$\nsubject to the linear equality constraints:\n$$ A w = b $$\nwhere $w \\in \\mathbb{R}^{N}$ is the vector of portfolio weights, $\\Sigma \\in \\mathbb{R}^{N \\times N}$ is the covariance matrix of asset excess returns, $A \\in \\mathbb{R}^{K \\times N}$ is the matrix of constraint coefficients (factor exposures), and $b \\in \\mathbb{R}^{K}$ is the vector of target exposures. Here, the number of assets is $N=6$ and the number of constraints is $K=5$.\n\nThe solution to this problem is derived systematically using the method of Lagrange multipliers. The Lagrangian function $\\mathcal{L}$ is formulated as:\n$$ \\mathcal{L}(w, \\lambda) = w^{\\top}\\Sigma w - \\lambda^{\\top}(Aw - b) $$\nwhere $\\lambda \\in \\mathbb{R}^{K}$ is the vector of Lagrange multipliers.\n\nThe first-order necessary condition for a minimum is found by setting the gradient of the Lagrangian with respect to $w$ to zero:\n$$ \\frac{\\partial \\mathcal{L}}{\\partial w} = 2\\Sigma w - A^{\\top}\\lambda = \\mathbf{0} $$\nAssuming the covariance matrix $\\Sigma$ is invertible, we can solve for $w$:\n$$ w = \\frac{1}{2} \\Sigma^{-1} A^{\\top} \\lambda $$\nTo find $\\lambda$, we substitute this expression for $w$ back into the constraint equation $Aw=b$:\n$$ A \\left( \\frac{1}{2} \\Sigma^{-1} A^{\\top} \\lambda \\right) = b $$\n$$ \\left( A \\Sigma^{-1} A^{\\top} \\right) \\lambda = 2b $$\nThe matrix $A \\Sigma^{-1} A^{\\top}$ is invertible provided that $\\Sigma$ is positive definite and $A$ has full row rank. Both conditions are met in this problem. Thus, we can solve for $\\lambda$:\n$$ \\lambda = 2 \\left( A \\Sigma^{-1} A^{\\top} \\right)^{-1} b $$\nSubstituting $\\lambda$ back into the equation for $w$ yields the optimal weight vector $w^{\\star}$:\n$$ w^{\\star} = \\Sigma^{-1} A^{\\top} \\left( A \\Sigma^{-1} A^{\\top} \\right)^{-1} b $$\nThe minimum portfolio variance $v$ is then given by $v = (w^{\\star})^{\\top}\\Sigma w^{\\star}$. By substituting the expression for $w^{\\star}$, we arrive at a more direct formula for the variance:\n$$ v = \\left( \\Sigma^{-1}A^{\\top}(A\\Sigma^{-1}A^{\\top})^{-1}b \\right)^{\\top} \\Sigma \\left( \\Sigma^{-1}A^{\\top}(A\\Sigma^{-1}A^{\\top})^{-1}b \\right) $$\n$$ v = b^{\\top} \\left( (A\\Sigma^{-1}A^{\\top})^{-1} \\right)^{\\top} (A\\Sigma^{-1})^{\\top} \\Sigma \\Sigma^{-1} A^{\\top} (A\\Sigma^{-1}A^{\\top})^{-1} b $$\n$$ v = b^{\\top} (A\\Sigma^{-1}A^{\\top})^{-1} A \\Sigma^{-1} A^{\\top} (A\\Sigma^{-1}A^{\\top})^{-1} b $$\n$$ v = b^{\\top} (A\\Sigma^{-1}A^{\\top})^{-1} b $$\nThis final expression is computationally efficient and will be used to solve for the variance in each test case.\n\nThe computational procedure is as follows:\n$1$. The asset excess return covariance matrix $\\Sigma \\in \\mathbb{R}^{6 \\times 6}$ is computed from the provided data matrix $R \\in \\mathbb{R}^{10 \\times 6}$ using the specified population covariance formula: $\\Sigma = \\frac{1}{T} \\sum_{t=1}^{T} ( r_t - \\bar{r} )( r_t - \\bar{r} )^{\\top}$, where $T=10$ is the number of time periods, $r_t$ is the vector of returns at time $t$, and $\\bar{r}$ is the time-series mean of returns for each asset.\n\n$2$. The constraint matrix $A \\in \\mathbb{R}^{5 \\times 6}$ is constructed by stacking the vector of ones $\\mathbf{1}$ and the factor exposure vectors $f^{\\text{MKT}}$, $f^{\\text{SMB}}$, $f^{\\text{HML}}$, and $f^{\\text{ESG}}$ as its rows:\n$$ A = \\begin{pmatrix} \\mathbf{1}^{\\top} \\\\ (f^{\\text{MKT}})^{\\top} \\\\ (f^{\\text{SMB}})^{\\top} \\\\ (f^{\\text{HML}})^{\\top} \\\\ (f^{\\text{ESG}})^{\\top} \\end{pmatrix} $$\n\n$3$. For each of the four test cases, the corresponding target exposure vector $b \\in \\mathbb{R}^{5}$ is defined.\n\n$4$. The core matrix $M = (A\\Sigma^{-1}A^{\\top})^{-1}$ is computed.\n\n$5$. The minimum variance for each case is calculated as $v = b^{\\top}Mb$.\n\nThe evaluation of the test cases proceeds as follows:\n- For test case $1$, $b_1 = [0, 0, 0, 0, 1]^{\\top}$. The variance is $v_1 = b_1^{\\top}Mb_1$.\n- For test case $2$, $b_2 = [0, 0, 0, 0, -1]^{\\top}$. Since $b_2 = -b_1$, the variance is $v_2 = (-b_1)^{\\top}M(-b_1) = b_1^{\\top}Mb_1 = v_1$. The variances for cases $1$ and $2$ must be identical.\n- For test case $3$, $b_3 = [1, 0, 0, 0, 0.5]^{\\top}$. The variance is $v_3 = b_3^{\\top}Mb_3$.\n- For test case $4$, $b_4 = [0, 0, 0, 0, 0]^{\\top}$. The target vector is the zero vector. This immediately implies that the variance is $v_4 = \\mathbf{0}^{\\top}M\\mathbf{0} = 0$. The optimal portfolio is simply $w^{\\star} = \\mathbf{0}$, which has zero variance and satisfies the homogeneous constraints $A w = \\mathbf{0}$.\n\nThe following implementation carries out these calculations numerically.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes minimum-variance factor-mimicking portfolio variances for four test cases.\n    \"\"\"\n    # Number of assets N and time periods T\n    N = 6\n    T = 10\n\n    # Data from the problem statement\n    # Asset excess returns matrix R in decimal form\n    R = np.array([\n        [0.012, 0.008, 0.015, 0.005, 0.010, 0.011],\n        [-0.020, -0.015, -0.018, -0.022, -0.017, -0.019],\n        [0.025, 0.020, 0.028, 0.018, 0.022, 0.024],\n        [0.005, 0.007, 0.004, 0.009, 0.006, 0.005],\n        [0.030, 0.026, 0.033, 0.021, 0.027, 0.029],\n        [-0.010, -0.012, -0.009, -0.013, -0.011, -0.010],\n        [0.018, 0.014, 0.020, 0.012, 0.016, 0.017],\n        [-0.005, -0.006, -0.004, -0.007, -0.005, -0.005],\n        [0.022, 0.019, 0.024, 0.016, 0.020, 0.021],\n        [0.003, 0.004, 0.002, 0.005, 0.003, 0.003]\n    ])\n\n    # Factor exposure vectors\n    f_mkt = np.array([1.10, 0.90, 1.20, 0.80, 1.00, 1.05])\n    f_smb = np.array([-0.30, 0.50, -0.20, 0.70, 0.10, -0.40])\n    f_hml = np.array([0.60, -0.20, 0.40, -0.50, 0.00, 0.30])\n    f_esg = np.array([0.80, 0.20, -0.40, 1.10, -0.60, 0.30])\n\n    # Step 1: Compute the population covariance matrix Sigma.\n    # The problem asks for the population covariance estimator, which corresponds\n    # to using a divisor of T (ddof=0 in numpy.cov).\n    Sigma = np.cov(R, rowvar=False, ddof=0)\n\n    # Step 2: Construct the constraint matrix A.\n    # The rows of A are the constraint vectors.\n    ones_vec = np.ones(N)\n    A = np.vstack([ones_vec, f_mkt, f_smb, f_hml, f_esg])\n\n    # Step 3: Compute the core matrix M = (A * Sigma_inv * A^T)^-1.\n    try:\n        Sigma_inv = np.linalg.inv(Sigma)\n        M = np.linalg.inv(A @ Sigma_inv @ A.T)\n    except np.linalg.LinAlgError as e:\n        # This case should not be reached given the problem data.\n        print(f\"Error during matrix inversion: {e}\")\n        return\n\n    # Step 4: Define the target exposure vectors 'b' for each test case.\n    test_cases = [\n        # Case 1: self-financing, FF3-neutral, unit ESG exposure\n        {\"b\": np.array([0., 0., 0., 0., 1.])},\n        # Case 2: self-financing, FF3-neutral, negative unit ESG exposure\n        {\"b\": np.array([0., 0., 0., 0., -1.])},\n        # Case 3: fully invested, FF3-neutral, half ESG exposure\n        {\"b\": np.array([1., 0., 0., 0., 0.5])},\n        # Case 4: self-financing, FF3-neutral, zero ESG exposure (boundary case)\n        {\"b\": np.array([0., 0., 0., 0., 0.])}\n    ]\n\n    results = []\n    # Step 5: Calculate the minimum variance for each test case.\n    for case in test_cases:\n        b = case[\"b\"]\n        variance = b.T @ M @ b\n        results.append(variance)\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2392242"}]}