{"hands_on_practices": [{"introduction": "This problem is a comprehensive exercise in calculating Net Present Value for a project with multiple, distinct phases. Real-world investments rarely have simple, uniform cash flows; they often involve initial costs, transition periods, and long-term growth. This practice challenges you to dissect a complex investment scenario into fundamental components—such as a growing perpetuity and a finite annuity—and correctly discount each back to the present to determine the project's overall viability [@problem_id:2413633].", "problem": "A diversified grain farm is considering a permanent conversion from conventional practices to regenerative agriculture. Evaluate the incremental Net Present Value (NPV) of the conversion relative to continuing conventional operations, using only the data below. All cash flows are in real terms, measured in United States dollars (USD), and occur at the end of each year unless stated otherwise. The appropriate constant real, risk-adjusted annual discount rate is $r=0.07$ with discrete compounding.\n\nData:\n- At time $t=0$, the farm incurs an immediate conversion outlay of $\\$220{,}000$.\n- During the transition period, the incremental net cash flows (relative to continuing conventional operations) are negative due to yield losses and retraining:\n  - End of year $t=1$: $-\\$90{,}000$,\n  - End of year $t=2$: $-\\$50{,}000$.\n- From the end of year $t=3$ onward, the farm realizes a permanent incremental net operating cash flow due to price premia and lower input costs. The incremental net cash flow at the end of year $t=3$ is $\\$95{,}000$, and it grows at a constant real rate $g=0.025$ per year forever.\n- In addition, starting at the end of year $t=4$ and continuing through the end of year $t=13$ (a total of $10$ payments), the farm receives incremental carbon credit revenues of $\\$12{,}000$ per year in real terms.\n\nAssume there are no other incremental effects (for example, no salvage values, taxes are already embedded in the given net cash flows, and no additional working capital requirements). Compute the incremental Net Present Value (NPV) of the conversion at $t=0$. Express your final answer in USD and round to four significant figures.", "solution": "The problem presented is a standard exercise in capital budgeting, a topic within computational finance. It is well-posed, internally consistent, and contains all necessary information for a unique solution. We shall proceed with the calculation of the Net Present Value (NPV).\n\nThe Net Present Value (NPV) of an investment is the sum of the present values of its incremental cash flows, discounted at a specified rate. The formula for discrete, end-of-period cash flows is:\n$$\n\\text{NPV} = \\sum_{t=0}^{\\infty} \\frac{CF_t}{(1+r)^t}\n$$\nwhere $CF_t$ represents the net cash flow at the end of year $t$, and $r$ is the constant real annual discount rate, given as $r=0.07$. The analysis is performed at time $t=0$.\n\nThe project's incremental cash flows can be separated into four distinct components for analysis:\n1.  An initial investment outlay at $t=0$.\n2.  Transitional net cash flows for years $t=1$ and $t=2$.\n3.  A growing perpetuity of operating cash flows starting from year $t=3$.\n4.  A finite annuity of carbon credit revenues spanning from year $t=4$ to $t=13$.\n\nWe will calculate the present value of each component separately and then sum them to find the total NPV.\n\nComponent 1: Initial Outlay\nThe problem states an immediate conversion outlay of $220,000$. This is a cash outflow at $t=0$, so $CF_0 = -220,000$. Its present value is simply the value itself:\n$$\nPV_0 = -220,000\n$$\n\nComponent 2: Transition Period Cash Flows\nThe project incurs net cash outflows during the first two years: $CF_1 = -90,000$ and $CF_2 = -50,000$. The present value of these two flows is calculated by discounting each to $t=0$:\n$$\nPV_{trans} = \\frac{CF_1}{(1+r)^1} + \\frac{CF_2}{(1+r)^2} = \\frac{-90,000}{1+0.07} + \\frac{-50,000}{(1+0.07)^2}\n$$\n\nComponent 3: Growing Perpetuity of Operating Cash Flows\nFrom year $t=3$ onwards, the project generates a perpetual stream of operating cash flows. The first cash flow at $t=3$ is $CF_{op,3} = 95,000$, which grows at a constant rate $g=0.025$ per year. The present value of a growing perpetuity can be calculated at the period just before the first cash flow. Thus, we first find the value of this stream at $t=2$:\n$$\nV_{op, t=2} = \\frac{CF_{op,3}}{r-g}\n$$\nThis formula is applicable as the discount rate $r=0.07$ is greater than the growth rate $g=0.025$.\nTo find the present value at $t=0$, we must discount $V_{op, t=2}$ back by two years:\n$$\nPV_{op} = \\frac{V_{op, t=2}}{(1+r)^2} = \\frac{1}{(1+r)^2} \\left( \\frac{CF_{op,3}}{r-g} \\right) = \\frac{95,000}{(1+0.07)^2 (0.07 - 0.025)}\n$$\n\nComponent 4: Carbon Credit Annuity\nThe farm receives an annuity of $A=12,000$ per year from the end of year $t=4$ to the end of year $t=13$. This constitutes a series of $N=13-4+1=10$ payments. The present value of an ordinary annuity is calculated one period before its first payment. Therefore, we first calculate the value of this annuity at $t=3$:\n$$\nV_{cc, t=3} = A \\left( \\frac{1 - (1+r)^{-N}}{r} \\right) = 12,000 \\left( \\frac{1 - (1+0.07)^{-10}}{0.07} \\right)\n$$\nThis value at $t=3$ is then discounted back to $t=0$:\n$$\nPV_{cc} = \\frac{V_{cc, t=3}}{(1+r)^3} = \\frac{1}{(1+0.07)^3} \\left[ 12,000 \\left( \\frac{1 - (1+0.07)^{-10}}{0.07} \\right) \\right]\n$$\n\nTotal Net Present Value\nThe total NPV is the algebraic sum of the present values of all components:\n$$\n\\text{NPV} = PV_0 + PV_{trans} + PV_{op} + PV_{cc}\n$$\nSubstituting the expressions:\n$$\n\\text{NPV} = -220,000 + \\left(\\frac{-90,000}{1.07} + \\frac{-50,000}{1.07^2}\\right) + \\frac{95,000}{(1.07)^2(0.045)} + \\frac{12,000}{(1.07)^3} \\left( \\frac{1 - (1.07)^{-10}}{0.07} \\right)\n$$\nWe now compute the numerical value for each term:\n$$\nPV_0 = -220,000\n$$\n$$\nPV_{trans} = -84,112.1495... - 43,671.9364... = -127,784.086...\n$$\n$$\nPV_{op} = \\frac{95,000}{1.1449 \\times 0.045} = \\frac{95,000}{0.0515205} = 1,843,941.130...\n$$\n$$\nPV_{cc} = \\frac{12,000}{1.225043...} \\left( \\frac{1 - 0.508349...}{0.07} \\right) = 9795.59... \\times 7.02358... = 68,799.801...\n$$\nSumming these values:\n$$\n\\text{NPV} = -220,000 - 127,784.086 + 1,843,941.130 + 68,799.801 = 1,564,956.845\n$$\nThe problem requires the final answer to be rounded to four significant figures. The calculated value is $1,564,956.845$. The first four significant digits are $1, 5, 6, 4$. The fifth digit is $9$, so we round up the fourth digit from $4$ to $5$. The resulting value is $1,565,000$. Expressed in scientific notation, this is $1.565 \\times 10^6$.", "answer": "$$\\boxed{1.565 \\times 10^{6}}$$", "id": "2413633"}, {"introduction": "Applying financial theory in the real world requires careful attention to economic conditions, especially inflation. A common and costly mistake is to inconsistently mix nominal cash flows, which grow with inflation, and real cash flows, which are adjusted for purchasing power. This exercise will guide you through the process of calculating NPV in a high-inflation environment, emphasizing the critical importance of using the correct discount rate—nominal for nominal flows, and real for real flows—to arrive at a sound investment decision [@problem_id:2413666].", "problem": "A firm operates in a high-inflation environment with a constant expected general inflation rate of $\\pi=20\\%$ per year. The firm evaluates a $3$-year project with the following characteristics, all cash flows occurring at the end of each year unless otherwise stated. The nominal opportunity cost of capital is $i=28\\%$ per year.\n\n- At date $t=0$, the project requires an upfront investment of $\\$1{,}000$ (paid now, in current dollars).\n- Each year $t=1,2,3$, the project sells $100$ units. The product’s price is fully indexed to the general price level and equals $\\$10$ per unit in today’s purchasing power (a real price). The variable cost is fully indexed and equals $\\$6$ per unit in today’s purchasing power (a real cost).\n- There is a fixed license fee of $\\$50$ per year that is not indexed to inflation (a fixed nominal payment of $\\$50$ at each $t=1,2,3$).\n- At $t=3$, the equipment has a salvage value of $\\$400$ expressed in today’s purchasing power (a real amount). Ignore taxes and any additional capital expenditures.\n\nWhen computing the Net Present Value (NPV), correctly distinguish between nominal cash flows discounted at the nominal rate and real cash flows discounted at the real rate. What is the project’s NPV in today’s dollars?\n\nA. $\\$292.32$\n\nB. $\\$253.72$\n\nC. $\\$257.06$\n\nD. $\\$153.22$\n\nE. $\\$962.00$", "solution": "The Net Present Value (NPV) is defined from first principles as the present value of all future cash inflows minus the present value of all cash outflows at the appropriate discount rate. With inflation, internal consistency requires using either (i) nominal cash flows discounted at the nominal rate, or (ii) real cash flows discounted at the real rate. Both approaches must yield the same NPV if implemented correctly.\n\nNominal-cash-flow approach:\n- Revenues and variable costs are fully indexed to the general price level. With $100$ units per year, a real price of $\\$10$ and a real variable cost of $\\$6$, the real margin per year is $\\$4$ per unit, i.e., $\\$400$ per year in today’s purchasing power. In nominal terms, this indexed contribution grows with inflation: the nominal contribution at year $t$ is $400(1+\\pi)^t=400(1.2)^t$.\n- The license fee is a fixed nominal $\\$50$ at each $t=1,2,3$.\n- The salvage value is given as $\\$400$ in today’s purchasing power. Because it tracks the general price level, its nominal amount at $t=3$ is $400(1+\\pi)^3=400(1.2)^3$.\n\nThus, the nominal operating cash flow at $t=1,2$ is\n$$\n\\text{OCF}_t^{\\text{nom}}=400(1.2)^t-50,\n$$\nand at $t=3$ the total nominal cash flow includes salvage:\n$$\n\\text{CF}_3^{\\text{nom}}=\\big[400(1.2)^3-50\\big]+400(1.2)^3=800(1.2)^3-50.\n$$\nThe nominal discount factors are $(1+i)^{-t}=(1.28)^{-t}$. Compute year by year:\n\n- At $t=1$: $400(1.2)^1-50=480-50=430$. Present value: $430/(1.28)=430\\times 0.78125=335.9375$.\n- At $t=2$: $400(1.2)^2-50=576-50=526$. Present value: $526/(1.28)^2=526/(1.6384)\\approx 321.044921875$.\n- At $t=3$: $800(1.2)^3-50=800(1.728)-50=1382.4-50=1332.4$. Present value: $1332.4/(1.28)^3=1332.4/2.097152\\approx 635.3375549316$.\n\nSum of present values of inflows is\n$$\n335.9375+321.044921875+635.3375549316\\approx 1292.319977.\n$$\nSubtract the initial outlay $\\$1{,}000$ at $t=0$ to obtain\n$$\n\\text{NPV}\\approx 1292.319977-1000=292.319977\\ \\text{dollars}.\n$$\nRounded to cents, NPV $\\approx \\$292.32$.\n\nReal-cash-flow approach (consistency check):\nThe real discount rate $r$ must satisfy the exact Fisher relation, which follows from requiring equality of present values under nominal and real discounting with proportional price-level changes:\n$$\n(1+i)=(1+r)(1+\\pi).\n$$\nWith $i=0.28$ and $\\pi=0.20$,\n$$\n1+r=\\frac{1+i}{1+\\pi}=\\frac{1.28}{1.20}=\\frac{16}{15}\\implies r=\\frac{1}{15}\\approx 0.066666\\ldots\n$$\nConstruct real cash flows by deflating nominal components:\n- The indexed contribution is constant in real terms at $\\$400$ per year.\n- The license fee is a fixed nominal $\\$50$; its real value at $t$ is $50/(1.2)^t$.\n- The salvage is already given in real terms as $\\$400$ at $t=3$.\nTherefore, real cash flows are:\n- At $t=1$: $400-50/1.2=400-41.\\overline{6}=358.\\overline{3}$.\n- At $t=2$: $400-50/1.44=400-34.\\overline{72}=365.\\overline{27}$.\n- At $t=3$: $\\big(400-50/1.728\\big)+400=771.0648148\\ldots$\nDiscount at $(1+r)^{-t}=(16/15)^{-t}$:\n- $t=1$: $358.\\overline{3}\\times(15/16)=335.9375$.\n- $t=2$: $365.\\overline{27}\\times(225/256)\\approx 321.044921875$.\n- $t=3$: $771.0648\\ldots\\times(3375/4096)\\approx 635.3375549316$.\nSumming gives the same present value of inflows, $\\approx 1292.319977$, hence the same NPV $\\approx \\$292.32$.\n\nOption-by-option analysis:\n- Option A ($\\$292.32$): Matches the correctly computed NPV using consistent nominal and real approaches. Correct.\n- Option B ($\\$253.72$): This is close to the result obtained if one mistakenly treats the $\\$50$ license fee as a constant real payment instead of a fixed nominal payment (i.e., subtracting $\\$50$ in real terms each year rather than $50/(1.2)^t$), which undervalues the project. Incorrect.\n- Option C ($\\$257.06$): This is consistent with using the approximate Fisher relation $r\\approx i-\\pi=8\\%$ instead of the exact relation, and then discounting the correctly deflated real cash flows. At high inflation, the approximation bias is material, leading to an understated NPV. Incorrect.\n- Option D ($\\$153.22$): This corresponds to omitting inflation on the salvage in the nominal approach (treating the $\\$400$ real salvage as $\\$400$ nominal at $t=3$), which undervalues the terminal cash flow. Incorrect.\n- Option E ($\\$962.00$): This reflects discounting nominal cash flows at the lower real rate, an internally inconsistent procedure that grossly overvalues the project. Incorrect.\n\nTherefore, the correct choice is Option A.", "answer": "$$\\boxed{A}$$", "id": "2413666"}, {"introduction": "While calculating the NPV of a single project is a core skill, firms must often choose from a slate of potential investments under a fixed budget. This capital budgeting problem is a classic application of optimization in finance. This hands-on coding practice will show you how to formulate this selection problem as a 0-1 integer program—often called the \"knapsack problem\"—and solve it to find the portfolio of projects that maximizes total NPV without exceeding the available capital [@problem_id:2413667].", "problem": "You are given a capital budgeting selection problem that must be expressed as a binary (zero-one) integer programming model based on net present value (NPV). There are $n$ candidate projects indexed by $i \\in \\{1,2,\\ldots,n\\}$. Project $i$ has a deterministic stream of cash flows $(c_{i,0},c_{i,1},\\ldots,c_{i,T_i})$ with $c_{i,0} < 0$ representing the initial investment at time $t=0$, and $c_{i,t}$ for $t \\ge 1$ occurring at the end of period $t$. There is a common per-period discount rate $r \\ge 0$ expressed as a decimal (for example, $0.05$) and a single capital budget $B \\ge 0$ constraining the sum of initial investments at time $t=0$. Define the decision variable $x_i \\in \\{0,1\\}$, where $x_i=1$ if project $i$ is undertaken and $x_i=0$ otherwise. The net present value of project $i$ is\n$$\n\\text{NPV}_i(r) \\equiv \\sum_{t=0}^{T_i} \\frac{c_{i,t}}{(1+r)^t}.\n$$\nLet $I_i \\equiv -c_{i,0} > 0$ denote the initial investment of project $i$. Formulate the following zero-one integer program:\n$$\n\\max_{x_1,\\ldots,x_n} \\ \\sum_{i=1}^n \\text{NPV}_i(r)\\, x_i\n$$\nsubject to\n$$\n\\sum_{i=1}^n I_i \\, x_i \\le B, \\quad x_i \\in \\{0,1\\} \\ \\text{for all } i.\n$$\nWrite a program that, for each of the test cases below, computes the optimal objective value of the above integer program, that is, the maximum total net present value over all feasible portfolios. All interest rates must be treated as decimals. The required outputs are real numbers. Round each optimal total net present value to $4$ decimal places.\n\nTest Suite:\n- Test case $1$:\n  - Discount rate $r = 0.08$.\n  - Budget $B = 100$.\n  - Projects with cash flows $(c_{i,0},c_{i,1},c_{i,2})$:\n    - Project $1$: $(-40, 20, 30)$.\n    - Project $2$: $(-50, 0, 60)$.\n    - Project $3$: $(-30, 15, 18)$.\n    - Project $4$: $(-20, 8, 15)$.\n- Test case $2$:\n  - Discount rate $r = 0.05$.\n  - Budget $B = 0$.\n  - Projects with cash flows $(c_{i,0},c_{i,1},c_{i,2})$:\n    - Project $1$: $(-10, 6, 6)$.\n    - Project $2$: $(-8, 4, 5)$.\n    - Project $3$: $(-5, 2, 3)$.\n- Test case $3$:\n  - Discount rate $r = 0.05$.\n  - Budget $B = 30$.\n  - Projects with cash flows $(c_{i,0},c_{i,1},c_{i,2})$:\n    - Project $1$: $(-10, 6, 6)$.\n    - Project $2$: $(-15, 9, 9)$.\n    - Project $3$: $(-5, 3, 3)$.\n- Test case $4$:\n  - Discount rate $r = 0.07$.\n  - Budget $B = 22$.\n  - Projects with cash flows $(c_{i,0},c_{i,1},c_{i,2})$:\n    - Project $1$: $(-10, 4, 4)$.\n    - Project $2$: $(-12, 5, 5)$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[a,b,c,d]$), where each entry is the rounded optimal total net present value for the corresponding test case in the order listed above. Each number must be rounded to exactly $4$ decimal places and written as a decimal (for example, $0.0000$).", "solution": "The problem will first be validated for scientific and logical consistency.\n\n**Problem Validation**\n\n**Step 1: Extract Givens**\n\n- **Decision Variables**: $x_i \\in \\{0,1\\}$ for $i \\in \\{1, 2, \\ldots, n\\}$, where $x_i=1$ if project $i$ is selected, and $x_i=0$ otherwise.\n- **Project Data**: For each project $i$, a stream of deterministic cash flows $(c_{i,0}, c_{i,1}, \\ldots, c_{i,T_i})$.\n- **Initial Investment**: $I_i \\equiv -c_{i,0} > 0$.\n- **Discount Rate**: A common per-period rate $r \\ge 0$.\n- **Budget Constraint**: A single capital budget $B \\ge 0$.\n- **Net Present Value (NPV)**: The NPV for project $i$ is defined as $\\text{NPV}_i(r) \\equiv \\sum_{t=0}^{T_i} \\frac{c_{i,t}}{(1+r)^t}$.\n- **Objective Function**: Maximize the total net present value, $\\max_{x_1,\\ldots,x_n} \\sum_{i=1}^n \\text{NPV}_i(r)\\, x_i$.\n- **Constraint**: The total initial investment must not exceed the budget, $\\sum_{i=1}^n I_i \\, x_i \\le B$.\n- **Test Cases**: Four specific instances of the problem are provided, each with a discount rate $r$, a budget $B$, and a set of projects with their cash flows.\n- **Output Requirement**: The optimal objective value for each test case, rounded to $4$ decimal places.\n\n**Step 2: Validate Using Extracted Givens**\n\n1.  **Scientifically Grounded**: The problem is a standard formulation in corporate finance and operations research for capital budgeting under a single-period capital constraint. The concept of Net Present Value is a fundamental principle of finance for valuing investments over time. The formulation as a binary integer program is canonical. The problem is scientifically sound.\n\n2.  **Well-Posed**: The problem is an instance of the 0/1 knapsack problem, a well-known problem in combinatorial optimization. For the given parameters in each test case (a finite set of projects, a defined budget, and deterministic cash flows), a unique optimal solution exists and can be determined. The problem is well-posed.\n\n3.  **Objective**: The problem statement is composed of precise, mathematical definitions and objective data. There are no subjective, ambiguous, or opinion-based statements.\n\n4.  **Completeness**: All necessary information (discount rates, budgets, cash flows) for each test case is provided. The model is self-contained and requires no external information.\n\n**Step 3: Verdict and Action**\n\nThe problem is valid. It is a clear, self-contained, and scientifically sound problem from computational finance. A solution will be provided.\n\n**Solution Methodology**\n\nThe problem presented is a classic capital budgeting selection problem, which can be modeled as a binary integer program, specifically the 0/1 knapsack problem. The task is to select a portfolio of projects that maximizes the total Net Present Value (NPV) subject to a budget constraint.\n\nFor each project $i$, we have a 'value', which is its $\\text{NPV}_i$, and a 'weight', which is its initial investment $I_i$. The budget $B$ acts as the 'capacity' of the knapsack. The mathematical formulation is:\n$$\n\\max_{x} \\ \\sum_{i=1}^n \\text{NPV}_i(r)\\, x_i\n$$\nsubject to\n$$\n\\sum_{i=1}^n I_i \\, x_i \\le B, \\quad x_i \\in \\{0,1\\} \\ \\text{for all } i \\in \\{1, \\ldots, n\\}.\n$$\nThis type of problem is classified as a Mixed-Integer Linear Program (MILP), since the decision variables are restricted to integer values (in this case, binary). While the problem is NP-hard in general, the provided test cases have a small number of projects ($n \\le 4$), making them computationally tractable. A general-purpose MILP solver is the most robust and appropriate tool for this task.\n\nWe will use the `scipy.optimize.milp` function from the SciPy library. This function is designed to solve minimization problems. To solve our maximization problem, we will minimize the negative of the objective function:\n$$\n\\min_{x} \\ \\sum_{i=1}^n (-\\text{NPV}_i(r))\\, x_i\n$$\nThe procedure for each test case is as follows:\n\n1.  **Parameter Calculation**: For each project $i$, calculate its initial investment $I_i = -c_{i,0}$ and its Net Present Value, $\\text{NPV}_i(r)$, using the formula:\n    $$\n    \\text{NPV}_i(r) = \\sum_{t=0}^{T_i} \\frac{c_{i,t}}{(1+r)^t}\n    $$\n2.  **Solver Configuration**: Configure the inputs for `scipy.optimize.milp`:\n    -   **Objective Coefficients (`c`)**: A vector where the $i$-th element is $-\\text{NPV}_i(r)$.\n    -   **Constraints**: A single linear inequality constraint, $\\sum_{i=1}^n I_i x_i \\le B$. This is represented by a constraint matrix $A = [[I_1, I_2, \\ldots, I_n]]$ and an upper bound of $B$.\n    -   **Variable Bounds**: Each variable $x_i$ is bounded between $0$ and $1$.\n    -   **Integrality**: All variables $x_i$ are specified as integers.\n3.  **Execution and Result Interpretation**: The solver will find the optimal vector $x^*$ that minimizes the negative total NPV. The result from the solver, `res.fun`, is the minimum objective value. The maximum total NPV for our original problem is therefore `-res.fun`.\n4.  **Final Formatting**: The calculated optimal total NPV for each test case is rounded to $4$ decimal places as required. In cases where all projects have negative NPV or the budget is zero with positive investment costs, the optimal action is to select no projects, resulting in a total NPV of $0$.\n\nThis systematic approach ensures correctness and adherence to standard practices in computational optimization.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import milp, LinearConstraint, Bounds\n\ndef solve():\n    \"\"\"\n    Solves a series of capital budgeting problems formulated as 0/1 knapsack problems.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"r\": 0.08,\n            \"B\": 100,\n            \"projects\": [\n                (-40, 20, 30),\n                (-50, 0, 60),\n                (-30, 15, 18),\n                (-20, 8, 15),\n            ]\n        },\n        {\n            \"r\": 0.05,\n            \"B\": 0,\n            \"projects\": [\n                (-10, 6, 6),\n                (-8, 4, 5),\n                (-5, 2, 3),\n            ]\n        },\n        {\n            \"r\": 0.05,\n            \"B\": 30,\n            \"projects\": [\n                (-10, 6, 6),\n                (-15, 9, 9),\n                (-5, 3, 3),\n            ]\n        },\n        {\n            \"r\": 0.07,\n            \"B\": 22,\n            \"projects\": [\n                (-10, 4, 4),\n                (-12, 5, 5),\n            ]\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        r = case[\"r\"]\n        B = case[\"B\"]\n        projects_cash_flows = case[\"projects\"]\n        \n        n_projects = len(projects_cash_flows)\n        \n        if n_projects == 0:\n            results.append(0.0)\n            continue\n\n        npvs = []\n        investments = []\n\n        for cash_flows in projects_cash_flows:\n            # Calculate initial investment\n            investment = -cash_flows[0]\n            investments.append(investment)\n            \n            # Calculate NPV\n            current_npv = 0.0\n            for t, cash_flow in enumerate(cash_flows):\n                current_npv += cash_flow / ((1 + r)**t)\n            npvs.append(current_npv)\n\n        # The scipy.optimize.milp solver minimizes an objective function.\n        # To maximize sum(npv * x), we minimize sum(-npv * x).\n        c = -np.array(npvs)\n\n        # The constraint is sum(investment * x) <= B.\n        A = np.array(investments).reshape(1, n_projects)\n        # The constraint is one-sided: <= B. We set lower bound to -inf.\n        b_l = -np.inf \n        b_u = B\n        constraints = LinearConstraint(A, b_l, b_u)\n\n        # The variables x_i are binary (0 or 1).\n        integrality = np.ones(n_projects)\n        bounds = Bounds(lb=0, ub=1)\n\n        # Solve the mixed-integer linear program\n        res = milp(c=c, constraints=constraints, integrality=integrality, bounds=bounds)\n\n        optimal_total_npv = 0.0\n        if res.success:\n            # The result from the solver is the minimum of the negative NPVs.\n            # To get the maximum NPV, we negate the result.\n            optimal_total_npv = -res.fun\n\n        # A result of -0.0 can occur, ensuring it is formatted as 0.0000\n        if abs(optimal_total_npv) < 1e-9:\n             optimal_total_npv = 0.0\n             \n        results.append(f\"{optimal_total_npv:.4f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2413667"}]}