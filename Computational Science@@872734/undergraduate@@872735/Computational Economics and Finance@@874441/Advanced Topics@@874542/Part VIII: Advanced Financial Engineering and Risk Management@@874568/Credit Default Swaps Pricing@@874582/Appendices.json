{"hands_on_practices": [{"introduction": "The cornerstone of modern derivative pricing is the principle of no-arbitrage, which states that no risk-free profit can be made. This first exercise [@problem_id:2430981] grounds you in this fundamental concept using a simplified one-period, two-state world. By observing the price of a company's bond, you will deduce the market-implied, or \"risk-neutral,\" probability of default and use it to calculate the fair premium for a Credit Default Swap, making the logic of risk-neutral valuation crystal clear.", "problem": "Consider a frictionless, arbitrage-free, single-period market from time $t=0$ to time $t=1$. The continuously traded risk-free asset has a gross return of $1+r$ over the period with $r=0.04$. A reference firm has a one-period zero-coupon bond with face value $1$ that either survives to $t=1$ or defaults by $t=1$. If the firm survives, the bond pays $1$ at $t=1$; if it defaults, the bond pays a recovery equal to a fixed fraction $\\delta$ of face, with $\\delta=0.35$. The current price of this risky bond at $t=0$ is $B_0=0.95$.\n\nA Credit Default Swap (CDS) on this firm with notional $1$ is written for the same period. The contract specifies that at $t=1$:\n- If the firm has defaulted, the protection seller pays the loss given default, equal to $1-\\delta$, to the protection buyer, and the protection buyer makes no premium payment in that state.\n- If the firm has not defaulted, the protection buyer pays a single premium $c$ to the protection seller, and there is no protection payment.\n\nAssuming no arbitrage and that default/no-default are the only states at $t=1$, determine the fair premium $c$ that makes the time-$0$ value of the CDS equal to zero. Provide $c$ as a decimal. Round your answer to four significant figures.", "solution": "The problem statement will be validated for scientific soundness, clarity, and completeness.\n\n**Step 1: Extract Givens**\n- Market type: Frictionless, arbitrage-free, single-period from time $t=0$ to $t=1$.\n- Risk-free asset gross return: $1+r$.\n- Risk-free rate: $r=0.04$.\n- Reference firm's zero-coupon bond: face value $1$, matures at $t=1$.\n- States at $t=1$: Survival or Default.\n- Payoff of bond at $t=1$: $1$ upon survival, $\\delta$ upon default.\n- Recovery rate: $\\delta = 0.35$.\n- Current bond price at $t=0$: $B_0 = 0.95$.\n- Credit Default Swap (CDS) notional: $1$.\n- CDS payoff at $t=1$ if default: Protection seller pays $1-\\delta$ to buyer; buyer pays no premium.\n- CDS payoff at $t=1$ if survival: Protection buyer pays premium $c$ to seller; no protection payment.\n- Condition: The fair premium $c$ makes the time-$0$ value of the CDS equal to zero.\n- Required output: The value of $c$, as a decimal rounded to four significant figures.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded:** The problem is based on the fundamental principles of quantitative finance, specifically the theory of arbitrage-free pricing and the valuation of credit derivatives in a discrete-time, two-state model. These are standard and well-established concepts.\n- **Well-Posed:** The problem provides all necessary information to determine a unique value for the fair CDS premium, $c$. The market is described as complete, with two states and two traded assets (the risk-free asset and the risky bond), which allows for the derivation of a unique risk-neutral probability measure.\n- **Objective:** The problem is formulated in precise, objective, and unambiguous mathematical and financial language.\n\n**Step 3: Verdict and Action**\nThe problem is valid. It is scientifically grounded, well-posed, objective, and contains sufficient information for a unique solution. The following solution will be derived.\n\nThe fundamental principle of arbitrage-free pricing dictates that the price of any asset at time $t=0$ is its discounted expected payoff at a future time $t=1$, where the expectation is taken with respect to a risk-neutral probability measure. Let $q$ denote the risk-neutral probability of default, and thus $1-q$ is the risk-neutral probability of survival. The risk-free gross return is $R = 1+r = 1+0.04 = 1.04$.\n\nFirst, we use the price of the risky bond, $B_0$, to determine the risk-neutral probability $q$. The payoff of the bond at $t=1$ is $\\delta$ in the default state and $1$ in the survival state. The pricing equation is:\n$$B_0 = \\frac{1}{1+r} \\left[ q \\cdot \\delta + (1-q) \\cdot 1 \\right]$$\nSubstituting the given values:\n$$0.95 = \\frac{1}{1.04} \\left[ q \\cdot 0.35 + (1-q) \\right]$$\nMultiplying by $1.04$, we get:\n$$0.95 \\times 1.04 = 0.35q + 1 - q$$\n$$0.988 = 1 - 0.65q$$\nThis equation links the model parameters to the unknown risk-neutral probability $q$. We can solve for $q$, but it is more robust to solve for expressions involving $q$ that appear in the CDS pricing formula. From this equation, we can isolate two key terms: $q(1-\\delta) = 0.65q = 1 - 0.988 = 0.012$.\n\nNext, we analyze the Credit Default Swap (CDS). The fair premium $c$ is defined such that the time-$0$ value of the contract, $V_{CDS}(0)$, is zero. The payoffs for the protection buyer at $t=1$ are:\n- In case of default (with risk-neutral probability $q$): a payment of $1-\\delta$ is received.\n- In case of survival (with risk-neutral probability $1-q$): a premium payment of $c$ is made, so the payoff is $-c$.\n\nThe time-$0$ value of the CDS is the discounted expected payoff:\n$$V_{CDS}(0) = \\frac{1}{1+r} \\left[ q \\cdot (1-\\delta) + (1-q) \\cdot (-c) \\right]$$\nSetting $V_{CDS}(0) = 0$ for a fair premium, and noting that $1+r \\neq 0$, we have:\n$$q(1-\\delta) - (1-q)c = 0$$\n$$c = \\frac{q(1-\\delta)}{1-q}$$\nWe have already found that $q(1-\\delta) = q(1-0.35) = 0.65q = 0.012$.\nWe now need an expression for $1-q$. From the bond pricing equation $0.988 = 1 - 0.65q$, we can express $q$ as:\n$$q = \\frac{0.012}{0.65}$$\nThen, $1-q$ is:\n$$1-q = 1 - \\frac{0.012}{0.65} = \\frac{0.65 - 0.012}{0.65} = \\frac{0.638}{0.65}$$\nNow we substitute these expressions for $q(1-\\delta)$ and $1-q$ into the formula for $c$:\n$$c = \\frac{q(1-\\delta)}{1-q} = \\frac{0.012}{\\frac{0.638}{0.65}}$$\n$$c = \\frac{0.012 \\times 0.65}{0.638} = \\frac{0.0078}{0.638}$$\nNow, we compute the numerical value:\n$$c \\approx 0.0122257053...$$\nThe problem requires the answer to be rounded to four significant figures. The first significant figure is $1$, so we round to the fifth decimal place.\n$$c \\approx 0.01223$$\nThis is the fair premium for the CDS.", "answer": "$$\\boxed{0.01223}$$", "id": "2430981"}, {"introduction": "Real-world financial modeling often happens in continuous time. This next practice [@problem_id:2385463] transitions from the simple discrete model to a standard continuous-time \"reduced-form\" framework, where default arrives as a random event with a given intensity. You will price a hypothetical \"Power-CDS\" with an unusual payoff structure, a task that hones your ability to apply the fundamental expectation-based pricing formula to novel financial products and incorporate features like stochastic recovery rates.", "problem": "Consider a hypothetical contract, a \"Power Credit Default Swap (Power-CDS),\" written on a single reference entity. Under the risk-neutral measure, assume the following setup.\n\n- The contract has maturity $T = 5$ years and unit notional.\n- The continuously compounded risk-free interest rate is constant at $r = 0.02$ per year.\n- The default time $\\tau$ of the reference entity has a constant hazard (intensity) rate $\\lambda = 0.05$ per year, so that the survival probability is $\\mathbb{Q}(\\tau  t) = \\exp(-\\lambda t)$ for $t \\ge 0$.\n- Upon default at time $\\tau \\le T$, the contract pays immediately the amount $(1 - R)^{2}$ per unit notional, where $R \\in [0,1]$ is the recovery rate.\n- The recovery rate $R$ is independent of $\\tau$ and has a Beta distribution with parameters $\\alpha = 4$ and $\\beta = 6$.\n- The premium leg pays continuously at a constant rate $S$ per year until default or maturity, whichever occurs first.\n\nFind the par annual premium rate $S$ (per unit notional) that makes the contract have zero value at inception, that is, the rate $S$ that equates the present value of the premium leg and the present value of the protection leg. Express your final answer as a decimal per year and round your result to four significant figures.", "solution": "The problem statement will be validated for scientific soundness, clarity, and completeness.\n\n**Step 1: Extract Givens**\n- Contract Type: \"Power Credit Default Swap (Power-CDS)\" on a single reference entity.\n- Contract Maturity: $T = 5$ years.\n- Notional Amount: $1$ unit.\n- Risk-Free Interest Rate: $r = 0.02$ per year, continuously compounded.\n- Default Time: $\\tau$.\n- Default Intensity (Hazard Rate): $\\lambda = 0.05$ per year, constant.\n- Survival Probability: $\\mathbb{Q}(\\tau  t) = \\exp(-\\lambda t)$ for $t \\ge 0$.\n- Payout upon default at $\\tau \\le T$: $(1 - R)^2$ per unit notional.\n- Recovery Rate: $R \\in [0,1]$.\n- Independence: $R$ and $\\tau$ are independent random variables.\n- Distribution of $R$: Beta distribution with parameters $\\alpha = 4$ and $\\beta = 6$.\n- Premium Leg: Continuous payment at a constant rate $S$ per year until $\\min(\\tau, T)$.\n- Objective: Find the par annual premium rate $S$ such that the value of the contract at inception is zero.\n- Output Format: Decimal, rounded to four significant figures.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is set within the standard risk-neutral pricing framework of mathematical finance. All components are well-defined.\n- **Scientific Grounding**: The model is a reduced-form credit risk model with a constant intensity, a standard textbook case (e.g., Jarrow-Turnbull model). The stochastic recovery rate following a Beta distribution is a common and reasonable extension. The \"Power-CDS\" is a non-standard but mathematically tractable derivative. The problem is scientifically grounded in established financial mathematics.\n- **Well-Posed**: All parameters required for the calculation ($T$, $r$, $\\lambda$, $\\alpha$, $\\beta$) are explicitly given. The objective is clear: to find the rate $S$ that equates the present values of two cash flow streams. A unique solution exists and is derivable. The problem is well-posed.\n- **Objective**: The problem is stated in precise, objective mathematical terms, free of ambiguity or subjective claims.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A solution will be derived.\n\nThe par spread $S$ is the rate that equates the present value of the premium leg ($PV_{premium}$) and the present value of the protection leg ($PV_{protection}$). The valuation is performed under the risk-neutral measure $\\mathbb{Q}$.\nThe condition is $PV_{protection} = PV_{premium}$.\n\nFirst, we determine the present value of the protection leg, $PV_{protection}$. This is the risk-neutral expectation of the discounted payout. The payout of $(1-R)^2$ is made at the time of default $\\tau$, provided $\\tau \\le T$.\n$$\nPV_{protection} = \\mathbb{E}^{\\mathbb{Q}} \\left[ (1 - R)^2 e^{-r\\tau} \\mathbb{1}_{\\{\\tau \\le T\\}} \\right]\n$$\nGiven that the recovery rate $R$ and the default time $\\tau$ are independent, the expectation can be separated:\n$$\nPV_{protection} = \\mathbb{E}^{\\mathbb{Q}} \\left[ (1 - R)^2 \\right] \\cdot \\mathbb{E}^{\\mathbb{Q}} \\left[ e^{-r\\tau} \\mathbb{1}_{\\{\\tau \\le T\\}} \\right]\n$$\nThe first term, $\\mathbb{E}^{\\mathbb{Q}}[(1-R)^2]$, is computed using the properties of the Beta distribution. For a random variable $X \\sim \\text{Beta}(\\alpha, \\beta)$, the moments are known.\n$$\n\\mathbb{E}^{\\mathbb{Q}}[(1-R)^2] = \\mathbb{E}^{\\mathbb{Q}}[1 - 2R + R^2] = 1 - 2\\mathbb{E}^{\\mathbb{Q}}[R] + \\mathbb{E}^{\\mathbb{Q}}[R^2]\n$$\nThe first and second moments of the Beta distribution are:\n$$\n\\mathbb{E}^{\\mathbb{Q}}[R] = \\frac{\\alpha}{\\alpha + \\beta}\n$$\n$$\n\\mathbb{E}^{\\mathbb{Q}}[R^2] = \\frac{\\alpha(\\alpha+1)}{(\\alpha+\\beta)(\\alpha+\\beta+1)}\n$$\nSubstituting the given parameters $\\alpha = 4$ and $\\beta = 6$:\n$$\n\\mathbb{E}^{\\mathbb{Q}}[R] = \\frac{4}{4+6} = \\frac{4}{10} = \\frac{2}{5}\n$$\n$$\n\\mathbb{E}^{\\mathbb{Q}}[R^2] = \\frac{4(4+1)}{(4+6)(4+6+1)} = \\frac{4 \\cdot 5}{10 \\cdot 11} = \\frac{20}{110} = \\frac{2}{11}\n$$\nTherefore, the expected squared loss given default is:\n$$\n\\mathbb{E}^{\\mathbb{Q}}[(1-R)^2] = 1 - 2\\left(\\frac{2}{5}\\right) + \\frac{2}{11} = 1 - \\frac{4}{5} + \\frac{2}{11} = \\frac{1}{5} + \\frac{2}{11} = \\frac{11 + 10}{55} = \\frac{21}{55}\n$$\nThe second term in the $PV_{protection}$ expression, $\\mathbb{E}^{\\mathbb{Q}}[e^{-r\\tau} \\mathbb{1}_{\\{\\tau \\le T\\}}]$, is calculated by integrating against the default time probability density function, $f(t) = \\lambda e^{-\\lambda t}$ for $t \\ge 0$.\n$$\n\\mathbb{E}^{\\mathbb{Q}}[e^{-r\\tau} \\mathbb{1}_{\\{\\tau \\le T\\}}] = \\int_0^T e^{-rt} f(t) \\,dt = \\int_0^T e^{-rt} \\lambda e^{-\\lambda t} \\,dt = \\lambda \\int_0^T e^{-(r+\\lambda)t} \\,dt\n$$\n$$\n\\lambda \\int_0^T e^{-(r+\\lambda)t} \\,dt = \\lambda \\left[ \\frac{e^{-(r+\\lambda)t}}{-(r+\\lambda)} \\right]_0^T = \\frac{\\lambda}{r+\\lambda} \\left( 1 - e^{-(r+\\lambda)T} \\right)\n$$\nCombining the terms, the full expression for the protection leg is:\n$$\nPV_{protection} = \\frac{21}{55} \\cdot \\frac{\\lambda}{r+\\lambda} \\left( 1 - e^{-(r+\\lambda)T} \\right)\n$$\n\nNext, we determine the present value of the premium leg, $PV_{premium}$. This is the present value of the continuous payment of $S$ until the time of default $\\tau$ or maturity $T$, whichever occurs first. This is equivalent to integrating the discounted payment rate over time, weighted by the probability of survival up to that time.\n$$\nPV_{premium} = \\mathbb{E}^{\\mathbb{Q}} \\left[ \\int_0^{\\min(\\tau, T)} S e^{-rt} \\,dt \\right] = S \\int_0^T e^{-rt} \\mathbb{Q}(\\tau  t) \\,dt\n$$\nSubstituting the survival probability $\\mathbb{Q}(\\tau  t) = e^{-\\lambda t}$:\n$$\nPV_{premium} = S \\int_0^T e^{-rt} e^{-\\lambda t} \\,dt = S \\int_0^T e^{-(r+\\lambda)t} \\,dt\n$$\nThis integral is recognized from the previous calculation:\n$$\nPV_{premium} = S \\left( \\frac{1 - e^{-(r+\\lambda)T}}{r+\\lambda} \\right)\n$$\nThis term is often called a \"risky annuity.\"\n\nTo find the par spread $S$, we set $PV_{premium} = PV_{protection}$:\n$$\nS \\left( \\frac{1 - e^{-(r+\\lambda)T}}{r+\\lambda} \\right) = \\frac{21}{55} \\cdot \\frac{\\lambda}{r+\\lambda} \\left( 1 - e^{-(r+\\lambda)T} \\right)\n$$\nAssuming $T  0$, the term $\\frac{1 - e^{-(r+\\lambda)T}}{r+\\lambda}$ is non-zero and cancels from both sides. This yields a remarkably simple expression for the spread:\n$$\nS = \\lambda \\cdot \\mathbb{E}^{\\mathbb{Q}}[(1-R)^2]\n$$\nThis result is intuitive: the premium rate must equal the expected loss rate. The expected loss rate is the product of the default arrival rate ($\\lambda$) and the expected loss given default (which for this contract is $\\mathbb{E}^{\\mathbb{Q}}[(1-R)^2]$). The interest rate $r$ and maturity $T$ do not affect the par spread in this constant-intensity model with immediate payout.\n\nNow, we substitute the numerical values:\n$\\lambda = 0.05$\n$\\mathbb{E}^{\\mathbb{Q}}[(1-R)^2] = \\frac{21}{55}$\n$$\nS = 0.05 \\cdot \\frac{21}{55} = \\frac{5}{100} \\cdot \\frac{21}{55} = \\frac{1}{20} \\cdot \\frac{21}{55} = \\frac{21}{1100}\n$$\nTo express this as a decimal, we perform the division:\n$$\nS = \\frac{21}{1100} \\approx 0.01909090...\n$$\nThe problem requires the answer to be rounded to four significant figures. The first significant figure is $1$. The subsequent figures are $9$, $0$, $9$. The fifth significant figure is $0$, so we do not round up.\n$$\nS \\approx 0.01909\n$$\nThis is the par annual premium rate per unit notional.", "answer": "$$\n\\boxed{0.01909}\n$$", "id": "2385463"}, {"introduction": "Beyond pricing individual contracts, a quantitative analyst must understand the dynamics that drive the entire market. This final exercise [@problem_id:2385459] moves from pricing theory to empirical data analysis, introducing Principal Component Analysis (PCA) as a powerful tool to dissect the movements of a CDS spread curve. By analyzing historical data, you will identify the dominant underlying factors—like parallel shifts and changes in slope—that explain the majority of credit risk fluctuations, a foundational technique in modern risk management.", "problem": "You are given three historical datasets of Credit Default Swap (CDS) term structures across five maturities. Each dataset is a matrix where each row represents a date and each column corresponds to a maturity in years. The five maturities are $[1, 3, 5, 7, 10]$ (years). For each dataset, treat the columns as coordinates in a five-dimensional space and analyze the time series of changes in the CDS spreads.\n\nFor each dataset:\n- Compute the row-to-row differences of the spreads across time (i.e., the first difference along the time dimension).\n- Using these differences, compute the sample covariance matrix across maturities, using the unbiased estimator with divisor $n - 1$, where $n$ is the number of differences.\n- Perform Principal Component Analysis (PCA), defined as the eigenvalue decomposition of this covariance matrix. Order components by decreasing eigenvalue.\n- Let the first principal component loading vector be the eigenvector corresponding to the largest eigenvalue, normalized to have Euclidean norm equal to $1$. Resolve the sign indeterminacy by requiring that the sum of its entries be nonnegative; if the sum is negative, multiply the vector by $-1$.\n- Define the explained variance ratio of the first principal component as the largest eigenvalue divided by the trace of the covariance matrix. Express this explained variance ratio as a decimal (not a percentage) rounded to six decimal places. Express each entry of the first loading vector as a decimal rounded to six decimal places.\n- If the total variance (the trace of the covariance matrix) is zero, define the explained variance ratio to be $0.0$ and the first loading vector to be the zero vector in $\\mathbb{R}^{5}$.\n\nDatasets (entries are CDS spreads in basis points):\n- Dataset A (matrix $S_A \\in \\mathbb{R}^{6 \\times 5}$):\n  $$\n  \\begin{bmatrix}\n  80  100  120  140  160 \\\\\n  90  110  130  150  170 \\\\\n  85  105  125  145  165 \\\\\n  98  118  138  158  178 \\\\\n  88  108  128  148  168 \\\\\n  92  112  132  152  172\n  \\end{bmatrix}\n  $$\n- Dataset B (matrix $S_B \\in \\mathbb{R}^{8 \\times 5}$):\n  $$\n  \\begin{bmatrix}\n  80  100  120  140  160 \\\\\n  84  104  124  144  164 \\\\\n  80  102  124  146  168 \\\\\n  76  98  120  142  164 \\\\\n  80  100  120  140  160 \\\\\n  84  104  124  144  164 \\\\\n  84  104  124  144  164 \\\\\n  80  100  120  140  160\n  \\end{bmatrix}\n  $$\n- Dataset C (matrix $S_C \\in \\mathbb{R}^{5 \\times 5}$):\n  $$\n  \\begin{bmatrix}\n  120  140  160  180  200 \\\\\n  120  140  160  180  200 \\\\\n  120  140  160  180  200 \\\\\n  120  140  160  180  200 \\\\\n  120  140  160  180  200\n  \\end{bmatrix}\n  $$\n\nTest suite and required outputs:\n- For each dataset, output a list containing the explained variance ratio of the first principal component followed by the five entries of the first loading vector, all rounded to six decimal places as specified above.\n- Your program should produce a single line of output containing the results for Datasets A, B, and C as a comma-separated list of the three inner lists, enclosed in square brackets, with each number rounded as specified. For example: $[ [\\ldots], [\\ldots], [\\ldots] ]$. The final output must use decimals (not percentages).\n\nYour program must compute results for the following test suite of datasets: $S_A$, $S_B$, and $S_C$. The final output must be a single line of the form $[[r_{A}, l_{A,1}, l_{A,2}, l_{A,3}, l_{A,4}, l_{A,5}], [r_{B}, l_{B,1}, l_{B,2}, l_{B,3}, l_{B,4}, l_{B,5}], [r_{C}, l_{C,1}, l_{C,2}, l_{C,3}, l_{C,4}, l_{C,5}]]$, where $r_{\\cdot}$ are floats and $l_{\\cdot,\\cdot}$ are floats, all rounded to six decimals.", "solution": "The given problem is a well-defined exercise in computational statistics, specifically Principal Component Analysis (PCA) applied to financial time series data. The problem is scientifically grounded, internally consistent, and contains all necessary information for its resolution. I will proceed with a systematic, step-by-step solution for each provided dataset.\n\nThe core task is to identify the dominant mode of variation in the daily changes of Credit Default Swap (CDS) spreads across different maturities. This is achieved by performing an eigenvalue decomposition of the sample covariance matrix of these changes.\n\nLet a dataset be represented by a matrix $S \\in \\mathbb{R}^{m \\times k}$, where $m$ is the number of observations (dates) and $k=5$ is the number of maturities. The procedure is as follows:\n\n1.  Compute the matrix of first differences (daily changes) $\\Delta S \\in \\mathbb{R}^{n \\times k}$, where $n = m-1$. Each row of $\\Delta S$ is a vector of spread changes $\\mathbf{d}_i = S_{i+1, \\cdot} - S_{i, \\cdot}$ for $i=1, \\dots, n$.\n2.  Calculate the sample covariance matrix $C \\in \\mathbb{R}^{k \\times k}$. Given the mean vector of changes $\\bar{\\mathbf{d}} = \\frac{1}{n} \\sum_{i=1}^{n} \\mathbf{d}_i$, the unbiased sample covariance matrix is $C = \\frac{1}{n-1} \\sum_{i=1}^{n} (\\mathbf{d}_i - \\bar{\\mathbf{d}})(\\mathbf{d}_i - \\bar{\\mathbf{d}})^T$.\n3.  Perform PCA by solving the eigenvalue problem $C\\mathbf{v}_j = \\lambda_j \\mathbf{v}_j$. The eigenvalues $\\lambda_j$ are sorted such that $\\lambda_1 \\ge \\lambda_2 \\ge \\dots \\ge \\lambda_k$. The corresponding eigenvectors $\\mathbf{v}_j$ are the principal component loading vectors.\n4.  The first principal component loading vector $\\mathbf{l}_1$ is derived from $\\mathbf{v}_1$ (corresponding to $\\lambda_1$) by normalizing it to a unit Euclidean norm and ensuring the sum of its elements is non-negative.\n5.  The explained variance ratio of the first component is $r_1 = \\frac{\\lambda_1}{\\text{Tr}(C)}$, where $\\text{Tr}(C) = \\sum_{j=1}^k \\lambda_j$ is the total variance.\n\nI will now apply this procedure to each dataset.\n\n**Dataset A**\n\nThe given data matrix is $S_A \\in \\mathbb{R}^{6 \\times 5}$. The number of difference vectors is $n = 6-1=5$.\n$$\nS_A = \\begin{bmatrix}\n80  100  120  140  160 \\\\\n90  110  130  150  170 \\\\\n85  105  125  145  165 \\\\\n98  118  138  158  178 \\\\\n88  108  128  148  168 \\\\\n92  112  132  152  172\n\\end{bmatrix}\n$$\nThe matrix of differences $\\Delta S_A \\in \\mathbb{R}^{5 \\times 5}$ is:\n$$\n\\Delta S_A = \\begin{bmatrix}\n10  10  10  10  10 \\\\\n-5  -5  -5  -5  -5 \\\\\n13  13  13  13  13 \\\\\n-10  -10  -10  -10  -10 \\\\\n4  4  4  4  4\n\\end{bmatrix}\n$$\nEvery row vector $\\mathbf{d}_i$ is of the form $c_i \\mathbf{u}$, where $\\mathbf{u} = [1, 1, 1, 1, 1]^T$ and $c = [10, -5, 13, -10, 4]^T$. The data of differences is one-dimensional. The mean of the scalars is $\\bar{c} = \\frac{1}{5}(10-5+13-10+4) = 2.4$. The sample variance is $\\text{Var}(c) = \\frac{1}{5-1}\\sum_{i=1}^5(c_i-\\bar{c})^2 = \\frac{1}{4}(7.6^2 + (-7.4)^2 + 10.6^2 + (-12.4)^2 + 1.6^2) = \\frac{381.2}{4} = 95.3$.\nThe covariance matrix is $C_A = \\text{Var}(c) \\cdot \\mathbf{u}\\mathbf{u}^T = 95.3 \\begin{bmatrix} 1  \\dots  1 \\\\ \\vdots  \\ddots  \\vdots \\\\ 1  \\dots  1 \\end{bmatrix}$.\nThis is a rank-1 matrix. Its only non-zero eigenvalue is $\\lambda_1 = \\text{Tr}(C_A) = 5 \\times 95.3 = 476.5$.\nThe explained variance ratio for the first principal component is $r_A = \\frac{\\lambda_1}{\\text{Tr}(C_A)} = \\frac{476.5}{476.5} = 1.0$.\nThe eigenvector corresponding to $\\lambda_1$ is $\\mathbf{v}_1 = \\mathbf{u} = [1, 1, 1, 1, 1]^T$.\nTo find the loading vector, we normalize $\\mathbf{v}_1$. The Euclidean norm is $\\|\\mathbf{v}_1\\| = \\sqrt{1^2+1^2+1^2+1^2+1^2} = \\sqrt{5}$.\nThe normalized vector is $\\hat{\\mathbf{v}}_1 = \\frac{1}{\\sqrt{5}}[1, 1, 1, 1, 1]^T$. The sum of its entries is $\\frac{5}{\\sqrt{5}} = \\sqrt{5}  0$, so no sign change is necessary.\nThe loading vector is $\\mathbf{l}_A = [\\frac{1}{\\sqrt{5}}, \\frac{1}{\\sqrt{5}}, \\frac{1}{\\sqrt{5}}, \\frac{1}{\\sqrt{5}}, \\frac{1}{\\sqrt{5}}]^T$.\nNumerically, $\\frac{1}{\\sqrt{5}} \\approx 0.4472135955$.\nRounding to six decimal places, the result for Dataset A is:\n$r_A = 1.000000$ and $\\mathbf{l}_A = [0.447214, 0.447214, 0.447214, 0.447214, 0.447214]^T$.\n\n**Dataset B**\n\nThe data matrix $S_B \\in \\mathbb{R}^{8 \\times 5}$ yields $n=7$ difference vectors. The difference matrix $\\Delta S_B$ is:\n$$\n\\Delta S_B = \\begin{bmatrix}\n4  4  4  4  4 \\\\\n-4  -2  0  2  4 \\\\\n-4  -4  -4  -4  -4 \\\\\n4  2  0  -2  -4 \\\\\n4  4  4  4  4 \\\\\n0  0  0  0  0 \\\\\n-4  -4  -4  -4  -4\n\\end{bmatrix}\n$$\nThe mean of these difference vectors is $\\bar{\\mathbf{d}} = \\mathbf{0}$. The sample covariance matrix is $C_B = \\frac{1}{6}(\\Delta S_B)^T (\\Delta S_B)$.\nThe rows of $\\Delta S_B$ can be expressed as linear combinations of two orthogonal vectors: $\\mathbf{a} = [1, 1, 1, 1, 1]^T$ and $\\mathbf{b} = [-4, -2, 0, 2, 4]^T$. Note that $\\mathbf{a}^T\\mathbf{b} = 0$.\nThe difference vectors are $\\{4\\mathbf{a}, \\mathbf{b}, -4\\mathbf{a}, -\\mathbf{b}, 4\\mathbf{a}, \\mathbf{0}, -4\\mathbf{a}\\}$.\nThe covariance matrix is $C_B = \\frac{1}{6} \\sum \\mathbf{d}_i\\mathbf{d}_i^T = \\frac{1}{6} [ (4^2 + (-4)^2 + 4^2 + (-4)^2)\\mathbf{a}\\mathbf{a}^T + (1^2 + (-1)^2)\\mathbf{b}\\mathbf{b}^T ] = \\frac{64}{6}\\mathbf{a}\\mathbf{a}^T + \\frac{2}{6}\\mathbf{b}\\mathbf{b}^T = \\frac{32}{3}\\mathbf{a}\\mathbf{a}^T + \\frac{1}{3}\\mathbf{b}\\mathbf{b}^T$.\nSince $\\mathbf{a}$ and $\\mathbf{b}$ are orthogonal, they are the eigenvectors of $C_B$.\n$C_B\\mathbf{a} = \\frac{32}{3}(\\mathbf{a}^T\\mathbf{a})\\mathbf{a} = \\frac{32}{3}(5)\\mathbf{a} = \\frac{160}{3}\\mathbf{a}$. So, $\\lambda_a = 160/3$.\n$C_B\\mathbf{b} = \\frac{1}{3}(\\mathbf{b}^T\\mathbf{b})\\mathbf{b} = \\frac{1}{3}(40)\\mathbf{b} = \\frac{40}{3}\\mathbf{b}$. So, $\\lambda_b = 40/3$.\nThe eigenvalues are $\\lambda_1 = 160/3 \\approx 53.333$ and $\\lambda_2 = 40/3 \\approx 13.333$. The remaining three eigenvalues are zero.\nThe total variance is $\\text{Tr}(C_B) = \\lambda_1 + \\lambda_2 = \\frac{160}{3} + \\frac{40}{3} = \\frac{200}{3}$.\nThe largest eigenvalue is $\\lambda_1 = 160/3$. The explained variance ratio is $r_B = \\frac{160/3}{200/3} = \\frac{160}{200} = 0.8$.\nThe first principal component loading vector corresponds to $\\mathbf{v}_1 = \\mathbf{a} = [1, 1, 1, 1, 1]^T$. This is the same (unnormalized) vector as in Dataset A.\nFollowing the same normalization and sign check, the loading vector is $\\mathbf{l}_B = [\\frac{1}{\\sqrt{5}}, \\frac{1}{\\sqrt{5}}, \\frac{1}{\\sqrt{5}}, \\frac{1}{\\sqrt{5}}, \\frac{1}{\\sqrt{5}}]^T$.\nRounding to six decimal places, the result for Dataset B is:\n$r_B = 0.800000$ and $\\mathbf{l}_B = [0.447214, 0.447214, 0.447214, 0.447214, 0.447214]^T$.\n\n**Dataset C**\n\nThe data matrix $S_C \\in \\mathbb{R}^{5 \\times 5}$ has identical rows:\n$$\nS_C = \\begin{bmatrix}\n120  140  160  180  200 \\\\\n120  140  160  180  200 \\\\\n120  140  160  180  200 \\\\\n120  140  160  180  200 \\\\\n120  140  160  180  200\n\\end{bmatrix}\n$$\nThe matrix of differences $\\Delta S_C \\in \\mathbb{R}^{4 \\times 5}$ is a zero matrix, as each row-to-row difference is a zero vector. The sample covariance matrix $C_C$ is therefore the $5 \\times 5$ zero matrix.\nThe total variance is $\\text{Tr}(C_C) = 0$.\nThe problem statement provides a specific rule for this case: the explained variance ratio is $0.0$ and the first loading vector is the zero vector in $\\mathbb{R}^5$.\nThus, for Dataset C, the result is:\n$r_C = 0.000000$ and $\\mathbf{l}_C = [0.000000, 0.000000, 0.000000, 0.000000, 0.000000]^T$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef analyze_cds_data(S: np.ndarray) -> list[float]:\n    \"\"\"\n    Performs PCA on the time series of changes in CDS spreads.\n\n    Args:\n        S (np.ndarray): A matrix of CDS spreads where rows are time\n                        and columns are maturities.\n\n    Returns:\n        list[float]: A list containing the explained variance ratio of the\n                     first principal component, followed by the five entries\n                     of the first loading vector, all rounded to six decimal places.\n    \"\"\"\n    num_observations = S.shape[0]\n    num_maturities = S.shape[1]\n\n    # The problem guarantees at least 2 observations, so num_observations  1.\n    # Compute row-to-row differences (changes in spreads over time).\n    diffs = np.diff(S, axis=0)\n    \n    # n is the number of difference vectors.\n    n = diffs.shape[0]\n\n    # The problem guarantees n = 2 for unbiased covariance calculation.\n    # Compute the unbiased sample covariance matrix. rowvar=False treats columns as variables.\n    # ddof=1 uses n-1 as the divisor.\n    cov_matrix = np.cov(diffs, rowvar=False, ddof=1)\n    \n    # Total variance is the trace of the covariance matrix.\n    total_variance = np.trace(cov_matrix)\n\n    # Handle the special case where there is no variance.\n    if total_variance == 0.0:\n        explained_variance_ratio = 0.0\n        loading_vector = np.zeros(num_maturities)\n    else:\n        # Perform eigenvalue decomposition on the covariance matrix.\n        # np.linalg.eigh is for Hermitian matrices and returns sorted eigenvalues.\n        eigenvalues, eigenvectors = np.linalg.eigh(cov_matrix)\n        \n        # Eigenvalues are sorted in ascending order. The largest is the last one.\n        largest_eigenvalue = eigenvalues[-1]\n        \n        # The first principal component loading vector (unnormalized) is the last column.\n        first_pc_vector = eigenvectors[:, -1]\n        \n        # Explained variance ratio of the first principal component.\n        explained_variance_ratio = largest_eigenvalue / total_variance\n        \n        # The eigenvectors from np.linalg.eigh are already normalized to unit length.\n        # Resolve sign indeterminacy: sum of entries must be non-negative.\n        if np.sum(first_pc_vector)  0:\n            first_pc_vector = -first_pc_vector\n        \n        loading_vector = first_pc_vector\n\n    # Format the results as specified, rounding to six decimal places.\n    # Note: Using f-string for precise rounding control to avoid potential\n    # floating point representation issues with np.round for some numbers.\n    # However, for this problem, np.round works as expected.\n    # For consistency with standard practice, we use np.round.\n    \n    final_evr = np.round(explained_variance_ratio, 6)\n    final_loadings = np.round(loading_vector, 6).tolist()\n    \n    return [final_evr] + final_loadings\n\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all given datasets.\n    \"\"\"\n    # Dataset A (matrix S_A)\n    S_A = np.array([\n        [80, 100, 120, 140, 160],\n        [90, 110, 130, 150, 170],\n        [85, 105, 125, 145, 165],\n        [98, 118, 138, 158, 178],\n        [88, 108, 128, 148, 168],\n        [92, 112, 132, 152, 172]\n    ], dtype=float)\n\n    # Dataset B (matrix S_B)\n    S_B = np.array([\n        [80, 100, 120, 140, 160],\n        [84, 104, 124, 144, 164],\n        [80, 102, 124, 146, 168],\n        [76, 98, 120, 142, 164],\n        [80, 100, 120, 140, 160],\n        [84, 104, 124, 144, 164],\n        [84, 104, 124, 144, 164],\n        [80, 100, 120, 140, 160]\n    ], dtype=float)\n    \n    # Dataset C (matrix S_C)\n    S_C = np.array([\n        [120, 140, 160, 180, 200],\n        [120, 140, 160, 180, 200],\n        [120, 140, 160, 180, 200],\n        [120, 140, 160, 180, 200],\n        [120, 140, 160, 180, 200]\n    ], dtype=float)\n\n    test_cases = [S_A, S_B, S_C]\n    \n    results = []\n    for case in test_cases:\n        result = analyze_cds_data(case)\n        results.append(result)\n\n    # Format the final output string exactly as required.\n    # The format is a string representation of a list of lists of floats.\n    # e.g., \"[[1.0, 0.447, ...], [0.8, 0.447, ...], ...]\"\n    # It must not contain spaces after commas inside the inner lists.\n    inner_lists_str = []\n    for res_list in results:\n        # Format each number to 6 decimal places and join with commas\n        formatted_nums = [f\"{num:.6f}\" for num in res_list]\n        inner_lists_str.append(f\"[{','.join(formatted_nums)}]\")\n    \n    # Join inner lists and enclose in square brackets\n    final_output = f\"[{','.join(inner_lists_str)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "2385459"}]}