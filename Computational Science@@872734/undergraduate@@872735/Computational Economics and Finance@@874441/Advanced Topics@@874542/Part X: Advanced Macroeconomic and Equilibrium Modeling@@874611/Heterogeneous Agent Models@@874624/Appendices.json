{"hands_on_practices": [{"introduction": "This first exercise grounds us in the fundamentals of asset pricing with heterogeneous agents. We explore a classic scenario where traders differ in both their risk aversion and their beliefs about a risky asset's future payoff [@problem_id:2445904]. By deriving and implementing the market-clearing equilibrium, you will see firsthand how the market price elegantly aggregates this diversity into a single value, acting as a weighted average of beliefs where more risk-tolerant agents have a greater influence.", "problem": "Consider a single-period market with one risk-free asset and one risky asset. There are $N$ agents indexed by $i \\in \\{1,\\dots,N\\}$. Each agent has Constant Absolute Risk Aversion (CARA) utility over end-of-period wealth given by $U_i(w) = -\\exp(-\\gamma_i w)$ with risk aversion parameter $\\gamma_i > 0$. The risky asset pays a random payoff $D$ at the end of the period. Agent $i$ holds a subjective belief that $D$ is normally distributed with mean $\\mu_i$ and variance $\\sigma_i^2$, written $D \\sim \\mathcal{N}(\\mu_i,\\sigma_i^2)$. The gross risk-free return is $R_f > 0$. The risky asset has an exogenous aggregate net supply $s \\in \\mathbb{R}$ (measured in units of the risky asset). Let $P$ denote the date-$0$ price of the risky asset.\n\nEach agent chooses a position $x_i$ in the risky asset at date $0$ to maximize expected utility of end-of-period wealth, taking $P$ as given. Market clearing requires $\\sum_{i=1}^N x_i = s$. Assume all given parameters imply existence and uniqueness of the competitive equilibrium price $P$.\n\nDefine the risk premium for a given instance as the difference between the simple average of agents’ expected payoffs and the required gross payoff at price $P$, that is,\n$$\\text{RP} \\equiv \\bar{\\mu} - P R_f, \\quad \\text{where} \\quad \\bar{\\mu} \\equiv \\frac{1}{N}\\sum_{i=1}^N \\mu_i.$$\nReport the risk premium as a real number in the same units as $D$ (for example, dollars). Express the answer in decimal form (no percentage sign).\n\nYour task is to write a program that, for each test case below, computes the unique competitive equilibrium price $P$ that clears the market and then outputs the corresponding risk premium $\\text{RP}$ defined above. Round each risk premium to $6$ decimal places.\n\nTest Suite (each test case specifies $(N, R_f, s, \\{\\gamma_i\\}_{i=1}^N, \\{\\mu_i\\}_{i=1}^N, \\{\\sigma_i^2\\}_{i=1}^N)$):\n- Test case A:\n  - $N = 3$, $R_f = 1.02$, $s = 1.0$,\n  - $\\{\\gamma_i\\} = [2.0, 3.0, 1.0]$,\n  - $\\{\\mu_i\\} = [1.0, 1.2, 0.8]$,\n  - $\\{\\sigma_i^2\\} = [0.25, 0.25, 0.25]$.\n- Test case B:\n  - $N = 3$, $R_f = 1.01$, $s = 1000.0$,\n  - $\\{\\gamma_i\\} = [1.0, 2.0, 3.0]$,\n  - $\\{\\mu_i\\} = [1.0, 1.0, 1.0]$,\n  - $\\{\\sigma_i^2\\} = [10^{-6}, 10^{-6}, 10^{-6}]$.\n- Test case C:\n  - $N = 3$, $R_f = 1.00$, $s = 50.0$,\n  - $\\{\\gamma_i\\} = [10^{-6}, 2.0, 3.0]$,\n  - $\\{\\mu_i\\} = [1.1, 1.1, 1.1]$,\n  - $\\{\\sigma_i^2\\} = [9.0, 9.0, 9.0]$.\n- Test case D:\n  - $N = 3$, $R_f = 1.05$, $s = 0.0$,\n  - $\\{\\gamma_i\\} = [2.0, 1.0, 4.0]$,\n  - $\\{\\mu_i\\} = [0.9, 1.4, 1.1]$,\n  - $\\{\\sigma_i^2\\} = [0.16, 0.36, 0.25]$.\n\nFinal output format: Your program should produce a single line of output containing the risk premia for the four test cases, each rounded to $6$ decimals, as a comma-separated list enclosed in square brackets, for example, $[r_A,r_B,r_C,r_D]$, where $r_A$ corresponds to Test case A, and so on. No additional text should be printed.", "solution": "The problem presented is a standard asset pricing model with heterogeneous agents, which is scientifically grounded, well-posed, and objective. It is therefore valid for a full analysis. We proceed to derive the solution from first principles.\n\nThe model consists of $N$ agents, a risk-free asset with gross return $R_f > 0$, and a risky asset with date-$0$ price $P$ and random date-$1$ payoff $D$. Agent $i \\in \\{1, \\dots, N\\}$ has a Constant Absolute Risk Aversion (CARA) utility function $U_i(w) = -\\exp(-\\gamma_i w)$, where $\\gamma_i > 0$ is the coefficient of absolute risk aversion. Each agent $i$ has a subjective belief that the payoff $D$ is normally distributed, $D \\sim \\mathcal{N}(\\mu_i, \\sigma_i^2)$.\n\nAgent $i$ chooses a quantity $x_i$ of the risky asset to hold. The remainder of their initial wealth, $w_{i,0}$, is invested in the risk-free asset. The date-$1$ wealth of agent $i$ is thus given by:\n$$w_i = (w_{i,0} - x_i P)R_f + x_i D = w_{i,0}R_f + x_i(D - PR_f)$$\nThe agent's objective is to maximize the expected utility of terminal wealth, based on their subjective beliefs:\n$$\\max_{x_i} \\mathbb{E}_i[U_i(w_i)] = \\max_{x_i} \\mathbb{E}_i[-\\exp(-\\gamma_i w_i)]$$\nSubstituting the expression for $w_i$:\n$$\\max_{x_i} \\mathbb{E}_i[-\\exp(-\\gamma_i (w_{i,0}R_f + x_i(D - PR_f)))]$$\nSince $w_{i,0}$ and $R_f$ are constant, and maximizing $-f(x)$ is equivalent to minimizing $f(x)$, the problem is equivalent to:\n$$\\min_{x_i} \\exp(-\\gamma_i w_{i,0}R_f) \\mathbb{E}_i[\\exp(-\\gamma_i x_i(D - PR_f))]$$\nThe term $\\exp(-\\gamma_i w_{i,0}R_f)$ is a positive constant with respect to the choice variable $x_i$ and can be ignored. The optimization is thus equivalent to minimizing the expectation term. Let the random variable be $Z_i = -\\gamma_i x_i(D - PR_f)$. From agent $i$'s perspective, since $D \\sim \\mathcal{N}(\\mu_i, \\sigma_i^2)$, the term $(D - PR_f)$ is also normally distributed with mean $\\mu_i - PR_f$ and variance $\\sigma_i^2$. Consequently, $Z_i$ is a normally distributed random variable with mean $\\mathbb{E}_i[Z_i] = -\\gamma_i x_i(\\mu_i - PR_f)$ and variance $\\text{Var}_i(Z_i) = (-\\gamma_i x_i)^2 \\sigma_i^2 = \\gamma_i^2 x_i^2 \\sigma_i^2$.\n\nThe expectation $\\mathbb{E}_i[\\exp(Z_i)]$ is the moment-generating function of the normal variable $Z_i$ evaluated at $t=1$. For a general normal variable $X \\sim \\mathcal{N}(\\mu_X, \\sigma_X^2)$, its MGF is $M_X(t) = \\exp(\\mu_X t + \\frac{1}{2}\\sigma_X^2 t^2)$. Applying this to $Z_i$:\n$$\\mathbb{E}_i[\\exp(Z_i)] = \\exp(\\mathbb{E}_i[Z_i] \\cdot 1 + \\frac{1}{2}\\text{Var}_i(Z_i) \\cdot 1^2) = \\exp(-\\gamma_i x_i(\\mu_i - PR_f) + \\frac{1}{2}\\gamma_i^2 x_i^2 \\sigma_i^2)$$\nThe agent's problem reduces to choosing $x_i$ to minimize this expression, which is equivalent to minimizing its exponent (the certainty equivalent rate of return):\n$$\\min_{x_i} \\left\\{ -\\gamma_i x_i(\\mu_i - PR_f) + \\frac{1}{2}\\gamma_i^2 x_i^2 \\sigma_i^2 \\right\\}$$\nThis is a convex quadratic function of $x_i$. The first-order condition for a minimum is found by differentiating with respect to $x_i$ and setting the result to zero:\n$$\\frac{\\partial}{\\partial x_i} \\left[ -\\gamma_i x_i(\\mu_i - PR_f) + \\frac{1}{2}\\gamma_i^2 x_i^2 \\sigma_i^2 \\right] = -\\gamma_i(\\mu_i - PR_f) + \\gamma_i^2 x_i \\sigma_i^2 = 0$$\nSince $\\gamma_i > 0$, we can divide by $\\gamma_i$ and solve for $x_i$ to obtain the individual demand for the risky asset:\n$$x_i(P) = \\frac{\\mu_i - PR_f}{\\gamma_i \\sigma_i^2}$$\nThis expression shows that demand is driven by the perceived expected excess return per unit of the risky asset, scaled by the agent's risk tolerance, which is the reciprocal of the product of risk aversion and perceived variance.\n\nThe equilibrium price $P$ is determined by the market clearing condition, which equates the aggregate demand to the exogenous aggregate supply $s$:\n$$\\sum_{i=1}^N x_i = s$$\nSubstituting the individual demand functions:\n$$\\sum_{i=1}^N \\frac{\\mu_i - PR_f}{\\gamma_i \\sigma_i^2} = s$$\nWe can solve this linear equation for $P$. Let us separate the terms:\n$$\\sum_{i=1}^N \\frac{\\mu_i}{\\gamma_i \\sigma_i^2} - \\sum_{i=1}^N \\frac{PR_f}{\\gamma_i \\sigma_i^2} = s$$\n$$PR_f \\left( \\sum_{i=1}^N \\frac{1}{\\gamma_i \\sigma_i^2} \\right) = \\left( \\sum_{i=1}^N \\frac{\\mu_i}{\\gamma_i \\sigma_i^2} \\right) - s$$\nSolving for the required gross payoff, $PR_f$:\n$$PR_f = \\frac{\\left( \\sum_{i=1}^N \\frac{\\mu_i}{\\gamma_i \\sigma_i^2} \\right) - s}{\\sum_{i=1}^N \\frac{1}{\\gamma_i \\sigma_i^2}}$$\nThe problem defines the risk premium as $\\text{RP} \\equiv \\bar{\\mu} - PR_f$, where $\\bar{\\mu} = \\frac{1}{N}\\sum_{i=1}^N \\mu_i$. Substituting the derived expression for $PR_f$ yields the final formula for the risk premium:\n$$\\text{RP} = \\left(\\frac{1}{N}\\sum_{i=1}^N \\mu_i\\right) - \\frac{\\left( \\sum_{i=1}^N \\frac{\\mu_i}{\\gamma_i \\sigma_i^2} \\right) - s}{\\sum_{i=1}^N \\frac{1}{\\gamma_i \\sigma_i^2}}$$\nThis analytical expression will be implemented to compute the risk premium for each test case.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the competitive equilibrium price and risk premium for a set of test cases\n    in a CARA-Normal asset pricing model with heterogeneous beliefs.\n    \"\"\"\n\n    def calculate_risk_premium(N, Rf, s, gammas, mus, sigmas_sq):\n        \"\"\"\n        Calculates the risk premium for a single market instance.\n\n        Args:\n            N (int): Number of agents.\n            Rf (float): Gross risk-free return.\n            s (float): Aggregate net supply of the risky asset.\n            gammas (np.ndarray): Array of risk aversion parameters.\n            mus (np.ndarray): Array of subjective expected payoffs.\n            sigmas_sq (np.ndarray): Array of subjective payoff variances.\n\n        Returns:\n            float: The calculated risk premium.\n        \"\"\"\n        # Average of agents' expected payoffs\n        mu_bar = np.mean(mus)\n\n        # Risk tolerances tau_i = 1 / (gamma_i * sigma_i^2)\n        taus = 1.0 / (gammas * sigmas_sq)\n\n        # Numerator of the PR_f expression: sum(mu_i * tau_i) - s\n        numerator_pr_f = np.sum(mus * taus) - s\n\n        # Denominator of the PR_f expression: sum(tau_i)\n        denominator_pr_f = np.sum(taus)\n\n        # Required gross payoff at equilibrium price P\n        pr_f = numerator_pr_f / denominator_pr_f\n\n        # Risk premium RP = mu_bar - P * R_f\n        risk_premium = mu_bar - pr_f\n        \n        return risk_premium\n\n    # Test Suite\n    test_cases = [\n        # Test case A: (N, Rf, s, {gamma_i}, {mu_i}, {sigma_i^2})\n        (3, 1.02, 1.0, np.array([2.0, 3.0, 1.0]), np.array([1.0, 1.2, 0.8]), np.array([0.25, 0.25, 0.25])),\n        # Test case B:\n        (3, 1.01, 1000.0, np.array([1.0, 2.0, 3.0]), np.array([1.0, 1.0, 1.0]), np.array([1e-6, 1e-6, 1e-6])),\n        # Test case C:\n        (3, 1.00, 50.0, np.array([1e-6, 2.0, 3.0]), np.array([1.1, 1.1, 1.1]), np.array([9.0, 9.0, 9.0])),\n        # Test case D:\n        (3, 1.05, 0.0, np.array([2.0, 1.0, 4.0]), np.array([0.9, 1.4, 1.1]), np.array([0.16, 0.36, 0.25])),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, Rf, s, gammas, mus, sigmas_sq = case\n        rp = calculate_risk_premium(N, Rf, s, gammas, mus, sigmas_sq)\n        results.append(rp)\n    \n    # Format the output as a comma-separated list of values rounded to 6 decimal places.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```", "id": "2445904"}, {"introduction": "Building on the static equilibrium, our next practice introduces the element of time and the interaction between different types of traders. We will model a market populated by two groups: highly informed \"AI\" agents with perfect foresight and heuristic agents who simply extrapolate from past prices [@problem_id:2399044]. This setup allows us to derive a dynamic equation for the price path, providing a clear and powerful illustration of how the interplay between \"smart money\" and \"noise traders\" can cause asset prices to fluctuate and systematically deviate from their fundamental value.", "problem": "Consider a single risky asset traded over $T$ discrete periods indexed by $t \\in \\{0,1,\\dots,T-1\\}$. There are $N$ risk-averse agents who trade against an exogenous net supply $Q$ of the asset in each period. The asset delivers a deterministic fundamental payoff $F_t$ at the end of period $t$. A fraction $\\phi$ of agents have a perfect forecast of the fundamental payoff (for each period $t$ they know $F_t$ exactly), representing agents equipped with Artificial Intelligence (AI). The remaining fraction $1-\\phi$ of agents are heuristic forecasters who form expectations using a simple rule.\n\nEach agent $i$ has mean-variance preferences with identical constant absolute risk aversion $a$ and common perceived payoff variance $s^2$ for the asset in each period. In period $t$, given price $P_t$ and agent-specific expectation $E_i[F_t]$ of the period-$t$ payoff, agent $i$ demands\n$$\nD_{i,t} \\;=\\; \\frac{E_i[F_t] - P_t}{a\\,s^2}.\n$$\nMarket clearing in each period requires\n$$\n\\sum_{i=1}^{N} D_{i,t} \\;=\\; Q.\n$$\nExpectations are heterogeneous as follows:\n- For AI-informed agents, $E_i[F_t] = F_t$.\n- For heuristic agents, the expectation is the previous period price, i.e.,\n$$\nE_i[F_t] \\;=\\; H_t \\;=\\; P_{t-1}.\n$$\nThe initial condition is given by $P_{-1} = F_0$ so that the heuristic expectation in the first trading period is well-defined.\n\nThe fundamental payoff path is common across all test cases and is defined deterministically by\n$$\nF_t \\;=\\; 100 \\;+\\; 5 \\,\\sin\\!\\left( \\frac{2\\pi t}{10} \\right) \\;+\\; 0.5\\,t\n$$\nfor all $t \\in \\{0,1,\\dots,T-1\\}$, with the sine function taking its argument in radians.\n\nYour task is to compute the price sequence $\\{P_t\\}_{t=0}^{T-1}$ implied by the above market for given parameters $\\left(T,N,\\phi,a,s^2,Q\\right)$, using the market clearing condition and the specified expectations. For each parameter set, compute the mean absolute deviation between prices and fundamentals,\n$$\n\\mathrm{MAD} \\;=\\; \\frac{1}{T}\\sum_{t=0}^{T-1} \\left| P_t - F_t \\right|,\n$$\nas a real number.\n\nUse the following fixed model ingredients for all test cases:\n- Number of periods $T=20$.\n- Number of agents $N=100$.\n\nTest suite of parameter sets to evaluate:\n- Case $1$: $\\phi=0.4$, $a=2.0$, $s^2=1.0$, $Q=10.0$.\n- Case $2$: $\\phi=1.0$, $a=3.0$, $s^2=2.0$, $Q=0.0$.\n- Case $3$: $\\phi=0.0$, $a=2.0$, $s^2=1.0$, $Q=5.0$.\n- Case $4$: $\\phi=0.5$, $a=10^6$, $s^2=1.0$, $Q=0.0$.\n- Case $5$: $\\phi=0.6$, $a=2.0$, $s^2=1.0$, $Q=100.0$.\n\nYour program must compute the $\\mathrm{MAD}$ for each case, in the order listed above, and produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each value rounded to $6$ decimal places (for example, $\\left[\\text{result}_1,\\text{result}_2,\\dots\\right]$). No other text should be printed.", "solution": "The problem statement has been subjected to rigorous validation and is found to be valid. It is scientifically sound, well-posed, and objective. It presents a standard heterogeneous agent model from computational economics, providing all necessary parameters and initial conditions to derive a unique, computable solution. We will proceed to solve it.\n\nThe model consists of $N$ agents trading a risky asset. A fraction $\\phi$ of these agents are \"AI-informed,\" with perfect foresight of the fundamental payoff $F_t$. Their expectation is $E_{\\text{AI}}[F_t] = F_t$. The remaining fraction $1-\\phi$ are \"heuristic\" agents, who form their expectation based on the previous period's price: $E_{\\text{Heuristic}}[F_t] = P_{t-1}$. All agents share the same constant absolute risk aversion coefficient $a$ and perceived payoff variance $s^2$. The demand for agent $i$ in period $t$ is given by:\n$$\nD_{i,t} = \\frac{E_i[F_t] - P_t}{a s^2}\n$$\nMarket clearing dictates that total demand equals the net supply $Q$:\n$$\n\\sum_{i=1}^{N} D_{i,t} = Q\n$$\nWe can express the total demand by summing the demands from each agent type. The number of AI-informed agents is $N\\phi$ and the number of heuristic agents is $N(1-\\phi)$. The market clearing condition thus becomes:\n$$\n(N\\phi) \\left( \\frac{F_t - P_t}{a s^2} \\right) + N(1-\\phi) \\left( \\frac{P_{t-1} - P_t}{a s^2} \\right) = Q\n$$\nTo find the equilibrium price $P_t$, we must solve this equation for $P_t$. First, we multiply both sides by $\\frac{a s^2}{N}$:\n$$\n\\phi(F_t - P_t) + (1-\\phi)(P_{t-1} - P_t) = \\frac{a s^2 Q}{N}\n$$\nNext, we expand and collect the terms involving $P_t$:\n$$\n\\phi F_t - \\phi P_t + (1-\\phi) P_{t-1} - (1-\\phi) P_t = \\frac{a s^2 Q}{N}\n$$\n$$\n\\phi F_t + (1-\\phi) P_{t-1} - (\\phi + 1 - \\phi) P_t = \\frac{a s^2 Q}{N}\n$$\n$$\n\\phi F_t + (1-\\phi) P_{t-1} - P_t = \\frac{a s^2 Q}{N}\n$$\nIsolating $P_t$ yields the first-order linear recurrence relation for the price path:\n$$\nP_t = \\phi F_t + (1-\\phi) P_{t-1} - \\frac{a s^2 Q}{N}\n$$\nThis equation shows that the current price is a weighted average of the fundamental value $F_t$ and the previous price $P_{t-1}$, adjusted for a risk premium term related to the net supply $Q$. The weights are determined by the fraction of AI-informed agents, $\\phi$.\n\nThe problem provides the deterministic path for the fundamental value $F_t$ over $T=20$ periods:\n$$\nF_t = 100 + 5 \\sin\\left(\\frac{2\\pi t}{10}\\right) + 0.5t \\quad \\text{for } t \\in \\{0, 1, \\dots, T-1\\}\n$$\nAn initial condition is required to start the recursion. It is given as $P_{-1} = F_0$. With this, we can compute the entire price sequence $\\{P_t\\}_{t=0}^{T-1}$ iteratively.\n\nThe algorithm for each test case is as follows:\n1.  Set the parameters $(T, N, \\phi, a, s^2, Q)$.\n2.  Generate the fundamental value series $\\{F_t\\}_{t=0}^{T-1}$ according to its definition.\n3.  Initialize the price recursion with $P_{-1} = F_0$.\n4.  Iterate for $t$ from $0$ to $T-1$, applying the derived recurrence relation to compute each $P_t$.\n5.  Once the price series $\\{P_t\\}_{t=0}^{T-1}$ is computed, calculate the mean absolute deviation (MAD) from the fundamental values:\n    $$\n    \\mathrm{MAD} = \\frac{1}{T} \\sum_{t=0}^{T-1} |P_t - F_t|\n    $$\nThis procedure is applied to each of the five specified parameter sets to obtain the required results. The implementation will utilize numerical libraries to ensure precision.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the price path and Mean Absolute Deviation (MAD) for a\n    heterogeneous agent model based on the problem specification.\n    \"\"\"\n    \n    # Fixed model parameters\n    T = 20\n    N = 100\n\n    # Test suite of parameter sets (phi, a, s^2, Q)\n    test_cases = [\n        (0.4, 2.0, 1.0, 10.0),  # Case 1\n        (1.0, 3.0, 2.0, 0.0),   # Case 2\n        (0.0, 2.0, 1.0, 5.0),   # Case 3\n        (0.5, 1e6, 1.0, 0.0),   # Case 4\n        (0.6, 2.0, 1.0, 100.0)  # Case 5\n    ]\n\n    results = []\n\n    # Generate the fundamental payoff path\n    t_vals = np.arange(T)\n    F = 100.0 + 5.0 * np.sin(2.0 * np.pi * t_vals / 10.0) + 0.5 * t_vals\n\n    for case in test_cases:\n        phi, a, s2, Q = case\n        \n        # Initialize the price array\n        P = np.zeros(T)\n        \n        # Set the initial condition P_{-1} = F_0\n        P_prev = F[0]\n        \n        # Define the constant term from the recurrence relation\n        const_term = (a * s2 * Q) / N\n        \n        # Iterate through time to compute the price path\n        for t in range(T):\n            # Price recurrence relation: P_t = phi*F_t + (1-phi)*P_{t-1} - (a*s^2*Q)/N\n            P[t] = phi * F[t] + (1 - phi) * P_prev - const_term\n            P_prev = P[t]\n            \n        # Calculate the Mean Absolute Deviation (MAD)\n        mad = np.mean(np.abs(P - F))\n        \n        # Append formatted result\n        results.append(f\"{mad:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2399044"}, {"introduction": "Our final practice takes us into the realm of full-scale agent-based simulation, where market dynamics are truly emergent. In this model, agents are not only heterogeneous in their risk preferences but also in how quickly they learn from new information [@problem_id:2399122]. You will simulate an economy where agents adapt their forecasts based on realized returns and, crucially, their wealth evolves based on their portfolio performance, demonstrating how successful strategies can gain market influence over time.", "problem": "Consider a large population of agents making portfolio choices between a safe asset and a risky asset. Time is discrete, indexed by $t \\in \\{0,1,2,\\dots,T-1\\}$. Each agent $i \\in \\{1,\\dots,N\\}$ chooses, at the start of period $t$, a portfolio share $x_{i,t} \\in [0,1]$ to invest in the risky asset, with the remaining share $1-x_{i,t}$ invested in the safe asset. The safe asset has a constant gross return $R_f > 0$. The risky asset has a net return $r_t$ that is independent and identically distributed (i.i.d.) across time with unknown mean $\\mu^\\star$ and known variance $\\sigma^2$. Returns are expressed in decimals; for example, a five percent return is $0.05$ and a one percent gross risk-free return per period is $R_f = 1.01$.\n\nAgents are heterogeneous in two dimensions:\n- Each agent $i$ has a risk-aversion coefficient $\\gamma_i > 0$.\n- Each agent $i$ has a learning rate $\\alpha_i \\in (0,1]$ used to adaptively update her estimate of the risky asset’s expected net return.\n\nAt time $t$, before observing $r_t$, each agent holds a belief $\\mu_{i,t}$ about the risky asset’s expected net return. Beliefs evolve according to adaptive learning:\n$$\n\\mu_{i,t+1} \\;=\\; \\mu_{i,t} + \\alpha_i \\left(r_t - \\mu_{i,t}\\right).\n$$\nAssume all agents know the variance $\\sigma^2$ and the safe gross return $R_f$, but not $\\mu^\\star$. There is a no-short, no-leverage constraint: $x_{i,t} \\in [0,1]$ for all $i,t$.\n\nWealth evolves according to standard gross returns aggregation:\n$$\nW_{i,t+1} \\;=\\; W_{i,t} \\left[ R_f \\left(1-x_{i,t}\\right) + \\left(1+r_t\\right) x_{i,t} \\right],\n$$\nwith initial wealth $W_{i,0} = 1$ for all $i$.\n\nAgents choose $x_{i,t}$ to maximize a mean-variance objective grounded in the Markowitz framework, which can be rationalized by exponential utility under normal returns. Starting from the definitions of expectation and variance for linear portfolios and the normality assumption for $r_t$, derive from first principles the one-period optimal risky share $x_{i,t}$ as a function of the agent’s belief $\\mu_{i,t}$, the safe return $R_f$, the risk-aversion parameter $\\gamma_i$, and the return variance $\\sigma^2$, under the constraint $x_{i,t} \\in [0,1]$. The final choice rule must be obtained from first-order conditions and then projected onto the feasible set $[0,1]$.\n\nDefine the wealth-weighted aggregate risky share at time $t$ as\n$$\n\\bar{x}_t \\;=\\; \\frac{\\sum_{i=1}^{N} W_{i,t} \\, x_{i,t}}{\\sum_{i=1}^{N} W_{i,t}}.\n$$\n\nYour task is to implement a simulation of this heterogeneous-agent economy and compute, for each parameter set in the test suite below, the time average of the wealth-weighted risky share over the last $L$ periods:\n$$\n\\bar{x}_{\\text{avg}} \\;=\\; \\frac{1}{L} \\sum_{t=T-L}^{T-1} \\bar{x}_t.\n$$\n\nInitial beliefs are set to the safe net return for all agents:\n$$\n\\mu_{i,0} \\;=\\; R_f - 1.\n$$\n\nHeterogeneity is assigned deterministically using index-based cycles. Let $\\gamma_{\\text{base}} > 0$ and $\\alpha_{\\text{base}} \\in (0,1]$ be given. For agent indices $i = 1,\\dots,N$, define\n$$\n\\gamma_i \\;=\\; \\gamma_{\\text{base}} \\times m_{(i \\bmod 4)},\n\\quad \\text{where } m_{0}=0.5,\\; m_{1}=1.0,\\; m_{2}=1.5,\\; m_{3}=2.0,\n$$\nand\n$$\n\\alpha_i \\;=\\; \\min\\left(0.9,\\; \\alpha_{\\text{base}} \\times a_{(i \\bmod 4)}\\right),\n\\quad \\text{where } a_{0}=0.5,\\; a_{1}=1.0,\\; a_{2}=2.0,\\; a_{3}=4.0.\n$$\n\nSimulation protocol:\n- Use $N$ agents and $T$ periods.\n- The risky net return is drawn as $r_t \\sim \\mathcal{N}(\\mu^\\star,\\sigma^2)$ independently across $t$.\n- Use a fixed pseudo-random number generator seed for reproducibility: a base seed of $12345$, offset by the zero-based test case index $k \\in \\{0,1,2,3\\}$ so that the seed for case $k$ is $12345 + k$.\n- Compute $\\bar{x}_{\\text{avg}}$ as defined above.\n\nTest suite (each item is a parameter tuple $(\\mu^\\star,\\sigma,R_f,\\gamma_{\\text{base}},\\alpha_{\\text{base}},N,T,L)$; all returns are decimals):\n1. Case $1$: $(0.06,\\,0.15,\\,1.01,\\,3.0,\\,0.20,\\,200,\\,2000,\\,500)$.\n2. Case $2$: $(0.01,\\,0.15,\\,1.01,\\,3.0,\\,0.20,\\,200,\\,2000,\\,500)$.\n3. Case $3$: $(0.06,\\,0.20,\\,1.01,\\,3.0,\\,0.20,\\,200,\\,2000,\\,500)$.\n4. Case $4$: $(0.06,\\,0.15,\\,1.01,\\,6.0,\\,0.05,\\,200,\\,2000,\\,500)$.\n\nYour program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the same order as the cases above, for example\n$[r_1,r_2,r_3,r_4]$,\nwhere each $r_k$ is the floating-point value of $\\bar{x}_{\\text{avg}}$ for case $k$, expressed as a decimal (not a percentage). Round or format as you see fit, but ensure standard floating-point formatting is used so that each $r_k$ can be parsed as a float.", "solution": "The problem statement is critically validated and found to be valid. It is a well-posed problem in the field of computational economics, grounded in established economic theory, and all necessary parameters and functional forms for a simulation are provided. The model combines a standard Markowitz-style portfolio choice problem with an adaptive learning dynamic, which is a common structure for heterogeneous agent models in finance. There are no scientific inconsistencies, contradictions, or critical ambiguities that would prevent a unique and meaningful solution. The minor ambiguity regarding the agent indexing `i mod 4` is resolved by adopting the standard computational convention of using a zero-based index derived from the one-based agent index, i.e., `(i-1) mod 4`, which aligns with the provided multiplier indices $\\{0,1,2,3\\}$.\n\nThe solution proceeds in two parts: first, the derivation of the agent's optimal decision rule from first principles, and second, the description of the simulation algorithm constructed upon this rule.\n\n**Part 1: Derivation of the Optimal Risky Asset Share**\n\nEach agent $i$ chooses the share of their wealth $x_{i,t} \\in [0,1]$ to invest in the risky asset to maximize a one-period mean-variance objective. The gross return on the agent's portfolio, $R_{p,i,t}$, is a weighted average of the safe asset gross return, $R_f$, and the risky asset gross return, $1+r_t$:\n$$\nR_{p,i,t} \\;=\\; (1-x_{i,t})R_f + x_{i,t}(1+r_t)\n$$\nThis can be rewritten in terms of the excess return of the risky asset over the safe asset:\n$$\nR_{p,i,t} \\;=\\; R_f + x_{i,t}(1+r_t - R_f) \\;=\\; R_f + x_{i,t}(r_t - (R_f-1))\n$$\nLet $r_f = R_f-1$ be the net risk-free rate.\n$$\nR_{p,i,t} \\;=\\; R_f + x_{i,t}(r_t - r_f)\n$$\nThe agent's decision is made at time $t$ before $r_t$ is known. Therefore, the agent uses their subjective expectation $E_t[\\cdot]$ based on their belief $\\mu_{i,t}$ and the known variance $\\sigma^2$. The expected portfolio return is:\n$$\nE_t[R_{p,i,t}] \\;=\\; E_t[R_f + x_{i,t}(r_t - r_f)] \\;=\\; R_f + x_{i,t}(E_t[r_t] - r_f) \\;=\\; R_f + x_{i,t}(\\mu_{i,t} - r_f)\n$$\nThe variance of the portfolio return is:\n$$\nVar_t(R_{p,i,t}) \\;=\\; Var_t(R_f + x_{i,t}(r_t - r_f)) \\;=\\; Var_t(x_{i,t}r_t) \\;=\\; x_{i,t}^2 Var_t(r_t) \\;=\\; x_{i,t}^2 \\sigma^2\n$$\nThe mean-variance objective function for agent $i$ is to maximize:\n$$\nU(x_{i,t}) \\;=\\; E_t[R_{p,i,t}] - \\frac{\\gamma_i}{2} Var_t(R_{p,i,t})\n$$\nSubstituting the expressions for the expected value and variance:\n$$\nU(x_{i,t}) \\;=\\; \\left( R_f + x_{i,t}(\\mu_{i,t} - r_f) \\right) - \\frac{\\gamma_i}{2} x_{i,t}^2 \\sigma^2\n$$\nThis is a concave quadratic function of $x_{i,t}$. To find the optimal unconstrained share, $x_{i,t}^*$, we take the first derivative with respect to $x_{i,t}$ and set it to zero (the first-order condition for a maximum):\n$$\n\\frac{\\mathrm{d}U}{\\mathrm{d}x_{i,t}} \\;=\\; (\\mu_{i,t} - r_f) - \\gamma_i \\sigma^2 x_{i,t} \\;=\\; 0\n$$\nSolving for $x_{i,t}$:\n$$\nx_{i,t}^* \\;=\\; \\frac{\\mu_{i,t} - r_f}{\\gamma_i \\sigma^2} \\;=\\; \\frac{\\mu_{i,t} - (R_f - 1)}{\\gamma_i \\sigma^2}\n$$\nThis is the classic Merton's share. The numerator represents the perceived excess net return of the risky asset, and the denominator is the product of risk aversion and return variance.\n\nThe problem specifies a no-short-selling and no-leverage constraint, meaning $x_{i,t}$ must lie in the interval $[0,1]$. The final optimal choice is the projection of the unconstrained solution $x_{i,t}^*$ onto this feasible set:\n$$\nx_{i,t} \\;=\\; \\max\\left(0, \\min\\left(1, x_{i,t}^*\\right)\\right)\n$$\n\n**Part 2: Simulation Algorithm**\n\nThe simulation models the economy over $T$ discrete time periods for a population of $N$ heterogeneous agents. The algorithm proceeds as follows:\n\n1.  **Initialization (at $t=0$):**\n    *   Set the global parameters $(\\mu^\\star, \\sigma, R_f, N, T, L)$ and heterogeneity base parameters $(\\gamma_{\\text{base}}, \\alpha_{\\text{base}})$ from the test case.\n    *   Initialize the pseudo-random number generator with the specified seed.\n    *   Create the population of $N$ agents. For each agent $i \\in \\{1, \\dots, N\\}$, assign the heterogeneous parameters $\\gamma_i$ and $\\alpha_i$ according to the deterministic cycle. Let $j = (i-1) \\pmod 4$. Then:\n        $$\n        \\gamma_i \\;=\\; \\gamma_{\\text{base}} \\times m_j, \\quad \\text{where } m \\in \\{0.5, 1.0, 1.5, 2.0\\}\n        $$\n        $$\n        \\alpha_i \\;=\\; \\min(0.9, \\alpha_{\\text{base}} \\times a_j), \\quad \\text{where } a \\in \\{0.5, 1.0, 2.0, 4.0\\}\n        $$\n    *   Set the initial state variables for each agent $i$:\n        *   Initial wealth: $W_{i,0} = 1$.\n        *   Initial belief: $\\mu_{i,0} = R_f - 1$.\n\n2.  **Time Loop (for $t=0, 1, \\dots, T-1$):**\n    The following steps are executed in each period $t$:\n    *   **a. Portfolio Choice:** Each agent $i$ calculates their optimal risky asset allocation $x_{i,t}$ using their current belief $\\mu_{i,t}$ and the derived formula from Part 1.\n    *   **b. Aggregation:** The wealth-weighted aggregate risky share for the economy, $\\bar{x}_t$, is computed:\n        $$\n        \\bar{x}_t \\;=\\; \\frac{\\sum_{i=1}^{N} W_{i,t} \\, x_{i,t}}{\\sum_{i=1}^{N} W_{i,t}}\n        $$\n        If the current period $t$ is within the final averaging window, i.e., $t \\ge T-L$, the value of $\\bar{x}_t$ is stored.\n    *   **c. Market Realization:** A random net return for the risky asset, $r_t$, is drawn from a normal distribution with the true mean $\\mu^\\star$ and variance $\\sigma^2$: $r_t \\sim \\mathcal{N}(\\mu^\\star, \\sigma^2)$.\n    *   **d. State Update:** The states of all agents are updated to reflect the outcome of period $t$, preparing for period $t+1$:\n        *   Wealth evolution: $$W_{i,t+1} = W_{i,t} [ R_f (1-x_{i,t}) + (1+r_t) x_{i,t} ]$$\n        *   Belief evolution: $$\\mu_{i,t+1} = \\mu_{i,t} + \\alpha_i (r_t - \\mu_{i,t})$$\n\n3.  **Final Calculation:**\n    After the simulation loop completes, the final output, $\\bar{x}_{\\text{avg}}$, is calculated by taking the arithmetic mean of the stored $\\bar{x}_t$ values from the last $L$ periods:\n    $$\n    \\bar{x}_{\\text{avg}} \\;=\\; \\frac{1}{L} \\sum_{t=T-L}^{T-1} \\bar{x}_t\n    $$\n\nThis algorithm is implemented using vectorized operations with the `numpy` library to ensure computational efficiency.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(mu_star, sigma, R_f, gamma_base, alpha_base, N, T, L, seed):\n    \"\"\"\n    Runs a single simulation of the heterogeneous agent model.\n\n    Args:\n        mu_star (float): True mean of the risky asset net return.\n        sigma (float): True standard deviation of the risky asset net return.\n        R_f (float): Gross risk-free return.\n        gamma_base (float): Base risk-aversion coefficient.\n        alpha_base (float): Base learning rate.\n        N (int): Number of agents.\n        T (int): Number of time periods.\n        L (int): Number of last periods to average over.\n        seed (int): Seed for the pseudo-random number generator.\n\n    Returns:\n        float: The time average of the wealth-weighted risky share over the last L periods.\n    \"\"\"\n    # Initialize the pseudo-random number generator for reproducibility.\n    rng = np.random.default_rng(seed)\n\n    # Define heterogeneity multipliers\n    m_multipliers = np.array([0.5, 1.0, 1.5, 2.0])\n    a_multipliers = np.array([0.5, 1.0, 2.0, 4.0])\n\n    # Assign heterogeneous parameters to agents based on index-based cycles.\n    agent_indices_mod_4 = np.arange(N) % 4\n    gamma_i = gamma_base * m_multipliers[agent_indices_mod_4]\n    alpha_i = np.minimum(0.9, alpha_base * a_multipliers[agent_indices_mod_4])\n\n    # Initial state variables\n    r_f_net = R_f - 1.0\n    mu_i_t = np.full(N, r_f_net)\n    W_i_t = np.ones(N)\n    \n    # Pre-calculate constant variance\n    sigma2 = sigma**2\n\n    # Storage for results in the final averaging window\n    x_bar_history = []\n\n    # Simulation loop over T periods\n    for t in range(T):\n        # 1. Agents make portfolio choices\n        # Calculate unconstrained optimal share\n        x_i_t_star = (mu_i_t - r_f_net) / (gamma_i * sigma2)\n        # Apply no-short, no-leverage constraint [0, 1]\n        x_i_t = np.clip(x_i_t_star, 0.0, 1.0)\n        \n        # 2. Compute and store aggregate risky share if in the final L periods\n        if t >= T - L:\n            total_W_t = np.sum(W_i_t)\n            # Avoid division by zero, though unlikely with these parameters\n            if total_W_t > 0:\n                x_bar_t = np.sum(W_i_t * x_i_t) / total_W_t\n                x_bar_history.append(x_bar_t)\n            else:\n                 x_bar_history.append(0.0)\n\n        # 3. Realize the risky asset's net return for the period\n        r_t = rng.normal(loc=mu_star, scale=sigma)\n        \n        # 4. Update agent states for the next period\n        # Update wealth\n        portfolio_gross_return = R_f * (1.0 - x_i_t) + (1.0 + r_t) * x_i_t\n        W_i_t = W_i_t * portfolio_gross_return\n        # Update beliefs\n        mu_i_t = mu_i_t + alpha_i * (r_t - mu_i_t)\n\n    # 5. Final calculation: average of the stored aggregate shares\n    x_bar_avg = np.mean(x_bar_history) if x_bar_history else 0.0\n    \n    return x_bar_avg\n\ndef solve():\n    \"\"\"\n    Main function to run simulations for all test cases and print the results.\n    \"\"\"\n    _ = np.set_printoptions # Scipy and numpy are permitted; not used here.\n\n    # Test suite: (mu_star, sigma, R_f, gamma_base, alpha_base, N, T, L)\n    test_cases = [\n        (0.06, 0.15, 1.01, 3.0, 0.20, 200, 2000, 500),\n        (0.01, 0.15, 1.01, 3.0, 0.20, 200, 2000, 500),\n        (0.06, 0.20, 1.01, 3.0, 0.20, 200, 2000, 500),\n        (0.06, 0.15, 1.01, 6.0, 0.05, 200, 2000, 500),\n    ]\n\n    results = []\n    base_seed = 12345\n    for i, case in enumerate(test_cases):\n        mu_star, sigma, R_f, gamma_base, alpha_base, N, T, L = case\n        # Set seed based on test case index\n        seed = base_seed + i\n        result = run_simulation(mu_star, sigma, R_f, gamma_base, alpha_base, N, T, L, seed)\n        results.append(result)\n\n    # Format the output as a comma-separated list in brackets, with standard float precision.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "2399122"}]}