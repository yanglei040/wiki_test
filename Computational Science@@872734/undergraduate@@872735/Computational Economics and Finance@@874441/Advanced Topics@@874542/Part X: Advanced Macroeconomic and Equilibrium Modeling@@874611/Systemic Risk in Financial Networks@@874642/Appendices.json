{"hands_on_practices": [{"introduction": "A crucial first step in managing systemic risk is measuring it. This exercise challenges you to construct a 'financial brittleness' index, a composite metric that synthesizes risk from two distinct sources: the network's topological structure and the aggregate financial leverage of its institutions [@problem_id:2435773]. By learning to combine these factors into a single, calibrated indicator, you gain practical experience in how risk managers and regulators develop dashboards to monitor the health of a financial system.", "problem": "A financial system is represented by an undirected network of $5$ banks labeled $A,B,C,D,E$, where an undirected edge between two banks indicates a bilateral exposure relationship. The edge set is $\\{AB,AC,BC,BD,CD,DE\\}$. Each bank $i$ has total assets $A_i$ and equity $E_i$ given by:\n- Bank $A$: $A_A=100$, $E_A=10$.\n- Bank $B$: $A_B=150$, $E_B=12.5$.\n- Bank $C$: $A_C=120$, $E_C=15$.\n- Bank $D$: $A_D=80$, $E_D=8$.\n- Bank $E$: $A_E=50$, $E_E=10$.\n\nDefine the following primitives:\n1. The global clustering coefficient $C$ (transitivity) of an undirected simple graph is defined as $C = \\dfrac{3 T}{W}$, where $T$ is the number of triangles in the graph and $W$ is the number of connected triples of vertices. A connected triple is an unordered triple of distinct vertices with at least two edges that share a common vertex.\n2. The node leverage of bank $i$ is $L_i = \\dfrac{A_i}{E_i}$. The aggregate leverage is the asset-weighted average leverage\n$$\n\\bar{L} = \\sum_{i \\in \\{A,B,C,D,E\\}} \\omega_i L_i, \\quad \\text{with } \\omega_i = \\dfrac{A_i}{\\sum_{j \\in \\{A,B,C,D,E\\}} A_j}.\n$$\n\nA “financial brittleness” index $B$ is to be constructed by combining topology and leverage under the following calibration protocol. First, define linearly normalized measures\n$$\nx_C = \\dfrac{C - C_{\\mathrm{S}}}{C_{\\mathrm{R}} - C_{\\mathrm{S}}}, \\qquad x_L = \\dfrac{\\bar{L} - \\bar{L}_{\\mathrm{S}}}{\\bar{L}_{\\mathrm{R}} - \\bar{L}_{\\mathrm{S}}},\n$$\nrelative to two anchor states: a “safe” anchor with $(C_{\\mathrm{S}}, \\bar{L}_{\\mathrm{S}}) = (0, 5)$ and a “risky” anchor with $(C_{\\mathrm{R}}, \\bar{L}_{\\mathrm{R}}) = (0.6, 15)$.\n\nLet\n$$\nB = \\gamma + \\lambda \\big( w x_L + (1-w) x_C \\big),\n$$\nwhere leverage receives twice the weight of clustering, so $w = \\dfrac{2}{3}$. The constants $\\gamma$ and $\\lambda$ are determined by the calibration conditions $B=0.2$ at the safe anchor and $B=0.8$ at the risky anchor.\n\nCompute the brittleness index $B$ for the given network using these definitions and calibration. Round your final result to four significant figures. Express the answer as a pure number without units.", "solution": "The problem is well-defined, self-contained, and consistent with principles of network science and financial modeling. All necessary data and definitions are provided, allowing for a unique solution. I will therefore proceed with a systematic calculation of the financial brittleness index $B$.\n\nThe calculation proceeds in five sequential steps: ($1$) computing the network's global clustering coefficient $C$, ($2$) computing the system's aggregate leverage $\\bar{L}$, ($3$) normalizing these two measures, ($4$) calibrating the brittleness index formula, and ($5$) computing the final value of $B$.\n\nFirst, we analyze the network topology to find the global clustering coefficient, $C = \\frac{3T}{W}$. The network consists of $N=5$ vertices (banks) $\\{A, B, C, D, E\\}$ and the edge set $\\{AB, AC, BC, BD, CD, DE\\}$.\n$T$ is the number of triangles (complete subgraphs of $3$ vertices). By inspection of the edge set:\n-   The vertex set $\\{A, B, C\\}$ forms a triangle because the edges $AB$, $AC$, and $BC$ are all present.\n-   The vertex set $\\{B, C, D\\}$ forms a triangle because the edges $BC$, $BD$, and $CD$ are all present.\nNo other combination of three vertices forms a triangle. Therefore, the number of triangles is $T=2$.\n\n$W$ is the number of connected triples, which are paths of length $2$. The number of such paths centered at a vertex $v$ is given by $\\binom{d(v)}{2}$, where $d(v)$ is the degree of vertex $v$. We first compute the degrees of all vertices:\n-   $d(A) = 2$ (connected to $B, C$)\n-   $d(B) = 3$ (connected to $A, C, D$)\n-   $d(C) = 3$ (connected to $A, B, D$)\n-   $d(D) = 3$ (connected to $B, C, E$)\n-   $d(E) = 1$ (connected to $D$)\nThe total number of connected triples is the sum over all vertices:\n$$W = \\sum_{i \\in \\{A,B,C,D,E\\}} \\binom{d(i)}{2} = \\binom{2}{2} + \\binom{3}{2} + \\binom{3}{2} + \\binom{3}{2} + \\binom{1}{2}$$\n$$W = 1 + 3 + 3 + 3 + 0 = 10$$\nNow, we can compute the global clustering coefficient:\n$$C = \\frac{3T}{W} = \\frac{3 \\times 2}{10} = \\frac{6}{10} = 0.6$$\n\nSecond, we compute the aggregate leverage $\\bar{L}$. First, we find the leverage $L_i = \\frac{A_i}{E_i}$ for each bank:\n-   $L_A = \\frac{A_A}{E_A} = \\frac{100}{10} = 10$\n-   $L_B = \\frac{A_B}{E_B} = \\frac{150}{12.5} = 12$\n-   $L_C = \\frac{A_C}{E_C} = \\frac{120}{15} = 8$\n-   $L_D = \\frac{A_D}{E_D} = \\frac{80}{8} = 10$\n-   $L_E = \\frac{A_E}{E_E} = \\frac{50}{10} = 5$\nNext, we determine the asset-weighted average. The total assets in the system are:\n$$\\sum_{j} A_j = A_A + A_B + A_C + A_D + A_E = 100 + 150 + 120 + 80 + 50 = 500$$\nThe weights $\\omega_i = \\frac{A_i}{\\sum_j A_j}$ are:\n-   $\\omega_A = \\frac{100}{500} = 0.2$\n-   $\\omega_B = \\frac{150}{500} = 0.3$\n-   $\\omega_C = \\frac{120}{500} = 0.24$\n-   $\\omega_D = \\frac{80}{500} = 0.16$\n-   $\\omega_E = \\frac{50}{500} = 0.1$\nThe aggregate leverage $\\bar{L}$ is the weighted sum:\n$$\\bar{L} = \\sum_{i} \\omega_i L_i = (0.2)(10) + (0.3)(12) + (0.24)(8) + (0.16)(10) + (0.1)(5)$$\n$$\\bar{L} = 2.0 + 3.6 + 1.92 + 1.6 + 0.5 = 9.62$$\n\nThird, we normalize the computed values $C$ and $\\bar{L}$ using the given anchor states: the \"safe\" anchor $(C_{\\mathrm{S}}, \\bar{L}_{\\mathrm{S}}) = (0, 5)$ and the \"risky\" anchor $(C_{\\mathrm{R}}, \\bar{L}_{\\mathrm{R}}) = (0.6, 15)$.\nThe normalized clustering measure is:\n$$x_C = \\frac{C - C_{\\mathrm{S}}}{C_{\\mathrm{R}} - C_{\\mathrm{S}}} = \\frac{0.6 - 0}{0.6 - 0} = 1$$\nThe normalized leverage measure is:\n$$x_L = \\frac{\\bar{L} - \\bar{L}_{\\mathrm{S}}}{\\bar{L}_{\\mathrm{R}} - \\bar{L}_{\\mathrm{S}}} = \\frac{9.62 - 5}{15 - 5} = \\frac{4.62}{10} = 0.462$$\n\nFourth, we calibrate the brittleness index $B = \\gamma + \\lambda(w x_L + (1-w) x_C)$ using the boundary conditions.\nAt the safe anchor, $(x_C, x_L)=(0,0)$ and $B=0.2$. Substituting these values gives:\n$$0.2 = \\gamma + \\lambda(w \\cdot 0 + (1-w) \\cdot 0) \\implies \\gamma = 0.2$$\nAt the risky anchor, $(x_C, x_L)=(1,1)$ and $B=0.8$. Substituting these values gives:\n$$0.8 = \\gamma + \\lambda(w \\cdot 1 + (1-w) \\cdot 1) = \\gamma + \\lambda$$\nUsing $\\gamma = 0.2$, we solve for $\\lambda$:\n$$0.8 = 0.2 + \\lambda \\implies \\lambda = 0.6$$\nThe calibrated brittleness index formula is $B = 0.2 + 0.6(w x_L + (1-w) x_C)$.\n\nFifth, we compute the final value of $B$ for the given network. We use the calculated normalized values $x_C=1$ and $x_L=0.462$, and the prescribed weight $w = \\frac{2}{3}$.\n$$B = 0.2 + 0.6 \\left( \\left(\\frac{2}{3}\\right) x_L + \\left(1-\\frac{2}{3}\\right) x_C \\right)$$\n$$B = 0.2 + 0.6 \\left( \\left(\\frac{2}{3}\\right)(0.462) + \\left(\\frac{1}{3}\\right)(1) \\right)$$\n$$B = 0.2 + 0.6 \\left( \\frac{2 \\times 0.462 + 1}{3} \\right)$$\n$$B = 0.2 + 0.2 (0.924 + 1)$$\n$$B = 0.2 + 0.2 (1.924)$$\n$$B = 0.2 + 0.3848 = 0.5848$$\nThe problem requires the result to be rounded to four significant figures. The calculated value $0.5848$ already has four significant figures.", "answer": "$$\n\\boxed{0.5848}\n$$", "id": "2435773"}, {"introduction": "Static risk measures provide a snapshot, but systemic risk is a dynamic process. This practice asks you to simulate a default cascade and explore how 'regulatory arbitrage'—the shifting of assets to a less-regulated and more fragile 'shadow' banking layer—can dramatically amplify contagion [@problem_id:2435816]. Implementing this model will give you a hands-on understanding of how rational individual actions can unintentionally increase the fragility of the entire system, a key theme in modern financial regulation.", "problem": "You are given a stylized interbank network with two layers of obligations that represent a regulated layer and a shadow (unregulated) layer. Banks can reroute a fraction of their gross interbank obligations through the shadow layer, which is more fragile due to lower recoveries in default. The financial system evolves deterministically according to balance-sheet identities and a discrete-time default cascade with losses on default.\n\nFundamental base:\n- Equity is defined by the accounting identity, for each bank $i$: $q_i = A_i - P_i$, where $A_i$ are total assets and $P_i$ are total liabilities. Limited liability implies that default occurs when $q_i  0$.\n- Interbank obligations are represented by a liabilities matrix $\\mathbf{L} \\in \\mathbb{R}_+^{N \\times N}$ with entries $L_{ij}$ meaning bank $i$ owes $L_{ij}$ to bank $j$. For each bank $i$, total interbank liabilities are $\\bar{p}_i = \\sum_{j=1}^N L_{ij}$ and total interbank assets are $\\sum_{k=1}^N L_{ki}$.\n- External assets $e_i \\ge 0$ are shocked by an exogenous, deterministic amount $\\Delta_i \\ge 0$, yielding post-shock external assets $e_i - \\Delta_i$.\n- Loss Given Default (LGD) is modeled deterministically: when a borrower defaults, each creditor realizes a fixed recovery on the defaulted exposure. The regulated layer has recovery $r_R \\in [0,1]$ and the shadow layer has recovery $r_S \\in [0,1]$ with $r_S  r_R$. The corresponding LGD values are $1 - r_R$ and $1 - r_S$.\n\nLayer construction and regulatory arbitrage:\n- For a given shift fraction $s \\in [0,1]$, each gross bilateral obligation is decomposed as $L_{ij}^{(R)} = (1-s) L_{ij}$ in the regulated layer and $L_{ij}^{(S)} = s L_{ij}$ in the shadow layer.\n- When a bank $j$ defaults, any creditor $i$ with exposure to $j$ loses deterministically\n$$\n\\text{loss}_{i \\leftarrow j}(s) = (1-r_R) L_{j i}^{(R)} + (1-r_S) L_{j i}^{(S)} = \\big( (1-s)(1-r_R) + s(1-r_S) \\big) L_{j i}.\n$$\nDefine the effective loss multiplier\n$$\nm(s) = (1-s)(1-r_R) + s(1-r_S).\n$$\n\nContagion mechanism (discrete-time cascade):\n- Step $0$: Compute initial post-shock equity for each bank $i$,\n$$\nq_i^{(0)} = \\big(e_i - \\Delta_i\\big) + \\sum_{k=1}^N L_{k i} - \\sum_{j=1}^N L_{i j}.\n$$\nAny bank $i$ with $q_i^{(0)}  0$ defaults at step $0$.\n- Step $t \\ge 1$: For each borrower $j$ that newly defaulted at step $t-1$, reduce the equity of each creditor $i$ by $\\text{loss}_{i \\leftarrow j}(s) = m(s) L_{j i}$. If this reduction pushes some solvent bank $i$ to $q_i^{(t)}  0$, then bank $i$ becomes a new defaulter at step $t$. Each borrower triggers losses only once (upon its first default). Iterate until no new defaults occur.\n\nYour task:\n- Implement this deterministic cascade algorithm for the fixed network and parameter values below.\n- For each test case, output the final total number of defaulted banks as a nonnegative integer.\n\nFixed network and recoveries:\n- Number of banks: $N = 3$.\n- Interbank liabilities matrix $\\mathbf{L}$ with rows as borrowers and columns as creditors:\n$$\n\\mathbf{L} =\n\\begin{bmatrix}\n0  70  0 \\\\\n0  0  80 \\\\\n30  0  0\n\\end{bmatrix}.\n$$\n- External assets vector:\n$$\n\\mathbf{e} = \\begin{bmatrix} 60 \\\\ 30 \\\\ 5 \\end{bmatrix}.\n$$\n- Regulated-layer recovery $r_R = 0.9$ and shadow-layer recovery $r_S = 0.2$.\n\nTest suite:\nEach test case specifies the shift fraction $s$ and the external shock vector $\\boldsymbol{\\Delta}$. All $s$ values are decimals in $[0,1]$, and all components of $\\boldsymbol{\\Delta}$ are nonnegative reals.\n\n- Test $1$: $s = 0.0$, $\\boldsymbol{\\Delta} = \\begin{bmatrix} 55 \\\\ 0 \\\\ 0 \\end{bmatrix}$.\n- Test $2$: $s = 0.3$, $\\boldsymbol{\\Delta} = \\begin{bmatrix} 55 \\\\ 0 \\\\ 0 \\end{bmatrix}$.\n- Test $3$: $s = 0.5$, $\\boldsymbol{\\Delta} = \\begin{bmatrix} 55 \\\\ 0 \\\\ 0 \\end{bmatrix}$.\n- Test $4$: $s = 1.0$, $\\boldsymbol{\\Delta} = \\begin{bmatrix} 55 \\\\ 0 \\\\ 0 \\end{bmatrix}$.\n- Test $5$: $s = 0.8$, $\\boldsymbol{\\Delta} = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\end{bmatrix}$.\n\nProgram requirements:\n- Write a complete, runnable program that computes the final number of defaults for each test case, using the cascade mechanism above and the fixed data. No randomness is allowed.\n- Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[x_1,x_2,\\dots,x_5]$, where each $x_k$ is the integer number of defaults for test $k$ in the order listed above.", "solution": "The problem presented is a well-posed exercise in computational finance, specifically concerning systemic risk propagation in a stylized, multi-layered interbank network. All necessary parameters and dynamics are provided with sufficient clarity and mathematical rigor. The problem is therefore valid, and a deterministic solution can be derived.\n\nThe core of the problem lies in tracking the evolution of bank equities under an initial shock and subsequent contagion effects. The system is defined by a set of $N$ banks, their interbank obligations, and their holdings of external assets. The financial structure is governed by the fundamental balance sheet identity for each bank $i$:\n$$\nq_i = A_i - P_i\n$$\nwhere $q_i$ is the equity, $A_i$ are the total assets, and $P_i$ are the total liabilities. A bank is considered to be in default if its equity becomes negative, $q_i  0$, consistent with the principle of limited liability.\n\nThe total assets $A_i$ of bank $i$ are composed of its external assets $e_i$ and its interbank assets $\\bar{a}_i$, which are claims on other banks. The total liabilities $P_i$ are its interbank liabilities $\\bar{p}_i$, which are obligations to other banks. The interbank exposures are encoded in the liabilities matrix $\\mathbf{L}$, where $L_{ij}$ represents the amount bank $i$ owes to bank $j$.\nThus, for each bank $i$, we can write:\n- Total interbank liabilities: $\\bar{p}_i = \\sum_{j=1}^N L_{ij}$\n- Total interbank assets: $\\bar{a}_i = \\sum_{k=1}^N L_{ki}$\n\nThe initial, pre-shock equity of bank $i$ is therefore:\n$$\nq_{i, \\text{pre-shock}} = e_i + \\bar{a}_i - \\bar{p}_i\n$$\n\nFor the given network with $N=3$:\n- Liabilities matrix: $\\mathbf{L} = \\begin{bmatrix} 0  70  0 \\\\ 0  0  80 \\\\ 30  0  0 \\end{bmatrix}$\n- External assets: $\\mathbf{e} = \\begin{bmatrix} 60 \\\\ 30 \\\\ 5 \\end{bmatrix}$\n\nWe first compute the vector of total interbank liabilities, $\\bar{\\mathbf{p}}$, by summing the rows of $\\mathbf{L}$:\n$$\n\\bar{\\mathbf{p}} = \\begin{bmatrix} 0+70+0 \\\\ 0+0+80 \\\\ 30+0+0 \\end{bmatrix} = \\begin{bmatrix} 70 \\\\ 80 \\\\ 30 \\end{bmatrix}\n$$\nNext, we compute the vector of total interbank assets, $\\bar{\\mathbf{a}}$, by summing the columns of $\\mathbf{L}$:\n$$\n\\bar{\\mathbf{a}} = \\begin{bmatrix} 0+0+30 \\\\ 70+0+0 \\\\ 0+80+0 \\end{bmatrix} = \\begin{bmatrix} 30 \\\\ 70 \\\\ 80 \\end{bmatrix}\n$$\nThe initial, pre-shock equity vector $\\mathbf{q}_{\\text{pre-shock}}$ is:\n$$\n\\mathbf{q}_{\\text{pre-shock}} = \\mathbf{e} + \\bar{\\mathbf{a}} - \\bar{\\mathbf{p}} = \\begin{bmatrix} 60 \\\\ 30 \\\\ 5 \\end{bmatrix} + \\begin{bmatrix} 30 \\\\ 70 \\\\ 80 \\end{bmatrix} - \\begin{bmatrix} 70 \\\\ 80 \\\\ 30 \\end{bmatrix} = \\begin{bmatrix} 20 \\\\ 20 \\\\ 55 \\end{bmatrix}\n$$\nAll banks are initially solvent. The contagion process begins with an exogenous shock $\\boldsymbol{\\Delta}$ to external assets.\n\nThe contagion mechanism depends critically on the loss-given-default, which is determined by the recoveries on the regulated ($r_R=0.9$) and shadow ($r_S=0.2$) layers. The fraction of obligations shifted to the shadow layer is $s$. When a bank defaults, its creditors incur a loss. The loss is magnified by the effective loss multiplier, $m(s)$:\n$$\nm(s) = (1-s)(1-r_R) + s(1-r_S) = (1-s)(1-0.9) + s(1-0.2) = 0.1(1-s) + 0.8s = 0.1 + 0.7s\n$$\nThe cascade proceeds in discrete time steps.\n\n**Step 0: Initial Shock**\nThe initial post-shock equity vector $\\mathbf{q}^{(0)}$ is computed as:\n$$\n\\mathbf{q}^{(0)} = \\mathbf{q}_{\\text{pre-shock}} - \\boldsymbol{\\Delta}\n$$\nAny bank $i$ with $q_i^{(0)}  0$ is declared defaulted.\n\n**Step $t \\ge 1$: Contagion**\nIf a set of banks $D_{t-1}$ newly defaulted at step $t-1$, then for each non-defaulted bank $i$, its equity is updated to reflect losses from these new defaults:\n$$\nq_i^{(t)} = q_i^{(t-1)} - \\sum_{j \\in D_{t-1}} m(s) L_{ji}\n$$\nAny bank $i$ for which $q_i^{(t)}$ falls below zero becomes a new defaulter at step $t$. The process is iterated until no new defaults occur in a step.\n\nWe now solve for each test case.\n\n**Test Case 1:** $s = 0.0$, $\\boldsymbol{\\Delta} = [55, 0, 0]^T$\n- Loss multiplier: $m(0.0) = 0.1 + 0.7(0.0) = 0.1$.\n- Step 0: $\\mathbf{q}^{(0)} = [20, 20, 55]^T - [55, 0, 0]^T = [-35, 20, 55]^T$. Bank 1 ($q_1^{(0)} = -35  0$) defaults. Defaulted set: $\\{1\\}$.\n- Step 1: Bank 1 owes $L_{12} = 70$ to bank 2.\n  - Loss for bank 2: $m(0.0) \\times L_{12} = 0.1 \\times 70 = 7$.\n  - Equity of bank 2: $q_2^{(1)} = q_2^{(0)} - 7 = 20 - 7 = 13$. Bank 2 remains solvent.\n- No further defaults. Cascade terminates.\n- Total defaults: $1$.\n\n**Test Case 2:** $s = 0.3$, $\\boldsymbol{\\Delta} = [55, 0, 0]^T$\n- Loss multiplier: $m(0.3) = 0.1 + 0.7(0.3) = 0.1 + 0.21 = 0.31$.\n- Step 0: $\\mathbf{q}^{(0)} = [-35, 20, 55]^T$. Bank 1 defaults. Defaulted set: $\\{1\\}$.\n- Step 1: Bank 1's default propagates.\n  - Loss for bank 2: $m(0.3) \\times L_{12} = 0.31 \\times 70 = 21.7$.\n  - Equity of bank 2: $q_2^{(1)} = 20 - 21.7 = -1.7$. Bank 2 ($q_2^{(1)}  0$) defaults. Defaulted set: $\\{1, 2\\}$.\n- Step 2: Bank 2's default propagates. Bank 2 owes $L_{23} = 80$ to bank 3.\n  - Loss for bank 3: $m(0.3) \\times L_{23} = 0.31 \\times 80 = 24.8$.\n  - Equity of bank 3: $q_3^{(2)} = q_3^{(0)} - 24.8 = 55 - 24.8 = 30.2$. Bank 3 remains solvent.\n- No further defaults. Cascade terminates.\n- Total defaults: $2$.\n\n**Test Case 3:** $s = 0.5$, $\\boldsymbol{\\Delta} = [55, 0, 0]^T$\n- Loss multiplier: $m(0.5) = 0.1 + 0.7(0.5) = 0.1 + 0.35 = 0.45$.\n- Step 0: $\\mathbf{q}^{(0)} = [-35, 20, 55]^T$. Bank 1 defaults. Defaulted set: $\\{1\\}$.\n- Step 1: Bank 1's default propagates.\n  - Loss for bank 2: $m(0.5) \\times L_{12} = 0.45 \\times 70 = 31.5$.\n  - Equity of bank 2: $q_2^{(1)} = 20 - 31.5 = -11.5$. Bank 2 defaults. Defaulted set: $\\{1, 2\\}$.\n- Step 2: Bank 2's default propagates.\n  - Loss for bank 3: $m(0.5) \\times L_{23} = 0.45 \\times 80 = 36$.\n  - Equity of bank 3: $q_3^{(2)} = 55 - 36 = 19$. Bank 3 remains solvent.\n- No further defaults.\n- Total defaults: $2$.\n\n**Test Case 4:** $s = 1.0$, $\\boldsymbol{\\Delta} = [55, 0, 0]^T$\n- Loss multiplier: $m(1.0) = 0.1 + 0.7(1.0) = 0.8$.\n- Step 0: $\\mathbf{q}^{(0)} = [-35, 20, 55]^T$. Bank 1 defaults. Defaulted set: $\\{1\\}$.\n- Step 1: Bank 1 defaults.\n  - Loss for bank 2: $m(1.0) \\times L_{12} = 0.8 \\times 70 = 56$.\n  - Equity of bank 2: $q_2^{(1)} = 20 - 56 = -36$. Bank 2 defaults. Defaulted set: $\\{1, 2\\}$.\n- Step 2: Bank 2 defaults.\n  - Loss for bank 3: $m(1.0) \\times L_{23} = 0.8 \\times 80 = 64$.\n  - Equity of bank 3: $q_3^{(2)} = 55 - 64 = -9$. Bank 3 defaults. Defaulted set: $\\{1, 2, 3\\}$.\n- Step 3: Bank 3's default propagates. Bank 3 owes $L_{31}=30$ to bank 1. Since bank 1 is already defaulted, this has no effect on the set of defaulters.\n- The entire system has collapsed.\n- Total defaults: $3$.\n\n**Test Case 5:** $s = 0.8$, $\\boldsymbol{\\Delta} = [0, 0, 0]^T$\n- Loss multiplier: $m(0.8) = 0.1 + 0.7(0.8) = 0.66$.\n- Step 0: $\\mathbf{q}^{(0)} = \\mathbf{q}_{\\text{pre-shock}} - [0, 0, 0]^T = [20, 20, 55]^T$.\n- All initial equities are positive. There are no initial defaults.\n- The cascade is not initiated.\n- Total defaults: $0$.\n\nThe analysis demonstrates a critical phenomenon: as the financial system shifts obligations to a less regulated, more fragile \"shadow\" layer (increasing $s$), its resilience to initial shocks deteriorates. A shock that was contained at $s=0.0$ leads to a partial cascade for intermediate $s$ values and a full systemic collapse when $s=1.0$.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the number of defaulted banks in a stylized interbank network\n    for a given set of test cases.\n    \"\"\"\n\n    # Fixed network parameters\n    # L_ij means bank i (row) owes bank j (column)\n    L = np.array([\n        [0.0, 70.0, 0.0],\n        [0.0, 0.0, 80.0],\n        [30.0, 0.0, 0.0]\n    ])\n    e = np.array([60.0, 30.0, 5.0])\n    r_R = 0.9\n    r_S = 0.2\n    N = 3\n\n    # Test cases: (shift fraction s, shock vector Delta)\n    test_cases = [\n        (0.0, np.array([55.0, 0.0, 0.0])),\n        (0.3, np.array([55.0, 0.0, 0.0])),\n        (0.5, np.array([55.0, 0.0, 0.0])),\n        (1.0, np.array([55.0, 0.0, 0.0])),\n        (0.8, np.array([0.0, 0.0, 0.0]))\n    ]\n\n    results = []\n\n    # Calculate fixed network properties once\n    p_bar = np.sum(L, axis=1)  # Total interbank liabilities (row sums)\n    a_bar = np.sum(L, axis=0)  # Total interbank assets (column sums)\n    q_pre_shock = e + a_bar - p_bar\n\n    for s, Delta in test_cases:\n        # Effective loss multiplier for the current s\n        m_s = (1 - s) * (1 - r_R) + s * (1 - r_S)\n\n        # Step 0: Initial shock and defaults\n        q = q_pre_shock - Delta\n        \n        # Sets to track defaulted banks\n        # Bank indices are 1-based, numpy arrays are 0-based\n        defaulted_banks = set(np.where(q  0)[0] + 1)\n        newly_defaulted = defaulted_banks.copy()\n        \n        # Iterative contagion process\n        while newly_defaulted:\n            # Banks that defaulted in the previous wave trigger new losses\n            current_wave_defaulters = newly_defaulted.copy()\n            newly_defaulted.clear()\n            \n            for j_defaulter in current_wave_defaulters:\n                # Propagate losses to creditors of the defaulted bank j_defaulter\n                # A bank i is a creditor if L[j-1, i-1]  0\n                for i_creditor in range(1, N + 1):\n                    # Continue if creditor is already defaulted\n                    if i_creditor in defaulted_banks:\n                        continue\n                    \n                    # Calculate loss for creditor i from defaulter j\n                    # L is indexed by (borrower, creditor)\n                    loss = m_s * L[j_defaulter - 1, i_creditor - 1]\n                    \n                    if loss  0:\n                        # Update equity of the creditor\n                        q[i_creditor - 1] -= loss\n                        \n                        # Check if the creditor defaults\n                        if q[i_creditor - 1]  0:\n                            defaulted_banks.add(i_creditor)\n                            newly_defaulted.add(i_creditor)\n        \n        # The result for this case is the total number of defaulted banks\n        results.append(len(defaulted_banks))\n\n    # Print the final results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2435816"}, {"introduction": "Once a crisis begins, the focus shifts from measurement to mitigation. In this exercise, you will act as a regulator searching for the optimal 'fire-break' to halt a contagion cascade already in motion [@problem_id:2435828]. Your task is to computationally evaluate various intervention strategies—specifically, guaranteeing a single interbank liability—to find the one that stops the cascade at the minimum possible cost, introducing you to the powerful concept of using models to guide real-time policy decisions.", "problem": "You are given a model of interbank contagion with a fixed set of banks indexed by integers from $0$ to $n-1$. Let $L \\in \\mathbb{R}_{\\ge 0}^{n \\times n}$ be the matrix of gross interbank liabilities, where $L_{ij}$ is the nominal amount owed by bank $i$ to bank $j$. Let $E \\in \\mathbb{R}_{0}^n$ be the vector of initial equities, where $E_i$ is the initial equity of bank $i$. Let $R \\in [0,1]$ be a common exogenous recovery rate on interbank claims, so that the loss-given-default fraction is $\\lambda = 1 - R$. A single exogenous shock hits one designated bank $s \\in \\{0,1,\\dots,n-1\\}$ by reducing its equity by an amount $\\Delta \\in \\mathbb{R}_{\\ge 0}$. The dynamics of contagion follow these principles.\n\n- Balance-sheet impact rule: When a bank $i$ defaults at some contagion round, each of its creditor banks $j$ suffers a loss of $\\lambda \\, L_{ij}$ to equity in the subsequent update.\n- Default criterion: A bank $i$ is in default as soon as and if its equity is less than or equal to zero at any round. Once a bank is in default, it remains in default and does not recover.\n- Update schedule: At time $t=0$, apply the exogenous shock to bank $s$, setting its equity to $E_s - \\Delta$. Identify the set $D_0$ of banks with equity less than or equal to zero. For $t=1,2,\\dots$, let $N_t$ be the subset of banks that newly defaulted at round $t-1$ (that is, those in $D_{t-1}$ but not in $D_{t-2}$, with the convention $D_{-1}=\\varnothing$). Each creditor $j$ of any $i \\in N_t$ suffers an equity loss of $\\lambda \\, L_{ij}$ at round $t$. Then update the set $D_t$ of all banks with equity less than or equal to zero. The process terminates at the first $T$ such that $D_T = D_{T-1}$.\n- Guarantee intervention: A regulator may choose at most one ordered pair $(i,j)$ with $L_{ij}  0$ to guarantee. If bank $i$ defaults, the creditor $j$ does not suffer any loss along the guaranteed liability $(i,j)$. The realized fiscal cost of guaranteeing liability $(i,j)$ is $\\lambda \\, L_{ij}$ if and only if bank $i$ defaults during the contagion process; otherwise, the cost is $0$.\n\nLet the goal be to halt the contagion cascade in the following precise sense: After the contagion process terminates with the guarantee in place, either no bank defaults at all, or the only defaulted bank is the initially shocked bank $s$. Among all single-liability guarantees that achieve this, the regulator should choose one that minimizes the realized fiscal cost as defined above. If multiple guarantees achieve the minimum realized cost, choose the one with lexicographically smallest index pair $(i,j)$, where $(i,j)  (i',j')$ if and only if either $i  i'$ or $i=i'$ and $j  j'$. If the cascade is already halted without any guarantee, choose no action. If no single guarantee can halt the cascade, report that it is impossible.\n\nYour program must, for each test case in the following test suite, output the chosen guarantee as a list $[i,j,c]$ where $i$ and $j$ are integers and $c$ is the realized cost as a real number. Use the following conventions for special cases:\n- If no guarantee is needed because the cascade is already halted without intervention, output $[-1,-1,0.0]$.\n- If it is impossible to halt the cascade with any single guarantee, output $[-2,-2,-1.0]$.\n\nTest suite:\n- Case $1$:\n  - $n = 4$.\n  - $R = 0.4$.\n  - $E = [0.3,\\, 0.5,\\, 0.7,\\, 0.5]$.\n  - $L$ has nonzero entries $L_{0,1} = 1.0$, $L_{0,2} = 0.1$, $L_{1,2} = 1.2$, $L_{2,3} = 1.0$, and all other $L_{i,j} = 0$.\n  - Shocked bank $s = 0$ with shock magnitude $\\Delta = 0.5$.\n- Case $2$:\n  - $n = 3$.\n  - $R = 0.5$.\n  - $E = [0.2,\\, 0.2,\\, 0.2]$.\n  - $L$ has nonzero entries $L_{0,1} = 0.5$, $L_{0,2} = 0.5$, and all other $L_{i,j} = 0$.\n  - Shocked bank $s = 0$ with shock magnitude $\\Delta = 0.5$.\n- Case $3$:\n  - $n = 3$.\n  - $R = 0.4$.\n  - $E = [0.5,\\, 0.5,\\, 0.5]$.\n  - $L$ has nonzero entries $L_{0,1} = 0.1$, $L_{0,2} = 0.1$, and all other $L_{i,j} = 0$.\n  - Shocked bank $s = 0$ with shock magnitude $\\Delta = 0.4$.\n- Case $4$:\n  - $n = 5$.\n  - $R = 0.2$.\n  - $E = [0.3,\\, 0.9,\\, 0.6,\\, 0.6,\\, 1.0]$.\n  - $L$ has nonzero entries $L_{0,1} = 0.2$, $L_{0,2} = 0.8$, $L_{2,3} = 0.8$, $L_{3,4} = 0.9$, and all other $L_{i,j} = 0$.\n  - Shocked bank $s = 0$ with shock magnitude $\\Delta = 0.5$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for the cases as a comma-separated list enclosed in square brackets, where each result is itself a list of the form $[i,j,c]$, with no spaces. For example, an output with three cases should look like $[[i_1,j_1,c_1],[i_2,j_2,c_2],[i_3,j_3,c_3]]$.", "solution": "The problem requires us to find an optimal single-liability guarantee to mitigate systemic risk in a financial network. The network consists of $n$ banks, and their interconnectedness is described by a liability matrix $L \\in \\mathbb{R}_{\\ge 0}^{n \\times n}$, where $L_{ij}$ is the amount bank $i$ owes to bank $j$. Each bank $i$ has an initial capital buffer, its equity $E_i  0$. A contagion process is triggered by an exogenous shock of magnitude $\\Delta \\ge 0$ to the equity of a single bank $s$. The objective is to select a guarantee that \"halts\" the ensuing cascade of defaults, defined as achieving a final state where either no bank defaults or only the initially shocked bank $s$ defaults. Among all guarantees that achieve this, we must select one that minimizes the realized fiscal cost, with a lexicographical tie-breaking rule for the guaranteed liability $(i,j)$.\n\nThe dynamics of the system are discrete in time. At time $t=0$, the shock is applied, so the equity of bank $s$ becomes $E_s - \\Delta$. A bank $i$ is defined to be in default if its equity becomes less than or equal to $0$. Let $D_t$ be the set of all banks in default at the end of round $t$. The set $D_0$ is determined immediately after the initial shock. For subsequent rounds $t=1, 2, \\dots$, we identify the set of newly defaulted banks $N_t = D_{t-1} \\setminus D_{t-2}$ (with $D_{-1} = \\varnothing$). The failure of these banks causes losses to their creditors. Specifically, for each $i \\in N_t$, every creditor bank $j$ suffers a loss equal to $\\lambda L_{ij}$, where $\\lambda = 1-R$ is the loss-given-default rate, and $R \\in [0,1]$ is the recovery rate. These losses are subtracted from the creditors' current equities. Following this, the set of defaulted banks $D_t$ is updated to include any banks whose equity has now fallen to or below $0$. The process terminates when a round occurs with no new defaults, i.e., $D_T = D_{T-1}$ for some round $T$.\n\nA guarantee on a liability $(i,j)$ implies that if bank $i$ defaults, the associated loss $\\lambda L_{ij}$ is not passed on to bank $j$. The realized fiscal cost of this guarantee is $\\lambda L_{ij}$ if bank $i$ defaults during the process, and $0$ otherwise. Our task is to find the best such guarantee.\n\nThe solution strategy is a systematic search over all possible single-liability guarantees. The core of the strategy is a function that simulates the contagion process for any given scenario, including a specified guarantee.\n\nFirst, we must establish a baseline by simulating the contagion with no guarantee in place. Let the initial equity vector be $E$. The equity of bank $s$ is reduced to $E_s - \\Delta$. We then iteratively compute the consequences. Let $E^{(t)}$ be the equity vector at the start of round $t$. We begin with $E^{(0)} = E$. A temporary vector $E'_{s} = E^{(0)}_{s} - \\Delta$ and $E'_{k}=E^{(0)}_{k}$ for $k \\ne s$ is used to determine $D_0$. Let $D_{new}$ be the set of newly defaulted banks in a round. The simulation proceeds as follows:\n1. Initialize current equities $E_{current}$ from the initial vector $E$. Apply the shock to bank $s$: $E_{current,s} \\leftarrow E_{current,s} - \\Delta$.\n2. Identify the set of initially defaulted banks $D_0 = \\{i \\mid E_{current,i} \\le 0\\}$. Set $D_{total} = D_0$ and $D_{new} = D_0$.\n3. While $D_{new}$ is not empty:\n    a. Calculate total losses for each bank. For each creditor bank $k$, the total loss is $\\sum_{i \\in D_{new}} \\lambda L_{ik}(\\mathcal{G})$, where $L_{ik}(\\mathcal{G})$ is $0$ if $(i,k)$ is the guaranteed liability $\\mathcal{G}$, and $L_{ik}$ otherwise.\n    b. Update equities: $E_{current} \\leftarrow E_{current} - \\text{losses}$.\n    c. Identify the new set of defaults for this round: $D_{round} = \\{j \\mid E_{current,j} \\le 0 \\text{ and } j \\notin D_{total}\\}$.\n    d. Update sets: $D_{new} = D_{round}$, and $D_{total} = D_{total} \\cup D_{new}$.\n4. The simulation terminates when $D_{new}$ is empty. The final set of defaulted banks is $D_{total}$.\n\nIf the baseline simulation results in a defaulted set that is empty or contains only bank $s$, no intervention is necessary, and the correct output is $[-1, -1, 0.0]$.\n\nOtherwise, we must search for an optimal guarantee. The set of possible guarantees consists of all pairs $(i,j)$ for which $L_{ij}  0$. We generate a list of these pairs and sort them lexicographically to adhere to the tie-breaking rule. We initialize a minimum cost found so far, $c_{min}$, to infinity and the best choice of guarantee to a null value.\n\nWe then iterate through the sorted list of potential guarantees. For each guarantee $(i,j)$:\n1. We run the contagion simulation with this guarantee in place.\n2. We check if the resulting set of defaulted banks $D_{final}$ meets the halting condition: $D_{final} = \\varnothing$ or $D_{final} = \\{s\\}$.\n3. If the condition is met, we calculate the realized cost. The cost is $c = \\lambda L_{ij}$ if the debtor bank $i$ is in $D_{final}$, and $c=0$ otherwise.\n4. We compare this cost $c$ with the minimum cost found so far, $c_{min}$. If $c  c_{min}$, we have found a new best solution. We update $c_{min} = c$ and store $(i,j,c)$ as the current best choice. Because we are iterating through guarantees in lexicographical order, this procedure automatically respects the tie-breaking rule.\n\nAfter checking all possible guarantees, if we have found at least one that halts the contagion, the stored best choice is our answer. If no single guarantee was able to halt the cascade, it is deemed impossible, and the output is $[-2, -2, -1.0]$. This comprehensive search ensures the identification of the optimal intervention according to the problem's criteria.", "answer": "```python\nimport numpy as np\n\ndef simulate_contagion(n, L, E, R, s, delta, guarantee=(-1, -1)):\n    \"\"\"\n    Simulates the interbank contagion process.\n\n    Args:\n        n (int): Number of banks.\n        L (np.array): n x n liability matrix.\n        E (list or np.array): Vector of initial equities.\n        R (float): Recovery rate.\n        s (int): Index of the shocked bank.\n        delta (float): Magnitude of the shock.\n        guarantee (tuple): The (i, j) pair for the guaranteed liability.\n\n    Returns:\n        set: The set of indices of defaulted banks at the end of the process.\n    \"\"\"\n    lambda_val = 1.0 - R\n    E_current = np.array(E, dtype=float)\n\n    # Apply initial shock\n    E_current[s] -= delta\n\n    defaulted_total = set()\n    newly_defaulted = set()\n\n    # Check for initial defaults after the shock (round 0)\n    for i in range(n):\n        if E_current[i] = 0:\n            newly_defaulted.add(i)\n    \n    defaulted_total.update(newly_defaulted)\n\n    # Propagate contagion in rounds\n    while newly_defaulted:\n        losses = np.zeros(n)\n        for i in newly_defaulted:\n            for j in range(n):\n                if L[i, j]  0:\n                    if (i, j) == guarantee:\n                        # This liability is guaranteed, no loss passes to bank j\n                        pass\n                    else:\n                        losses[j] += lambda_val * L[i, j]\n        \n        E_current -= losses\n        \n        round_defaults = set()\n        for k in range(n):\n            if E_current[k] = 0 and k not in defaulted_total:\n                round_defaults.add(k)\n        \n        newly_defaulted = round_defaults\n        defaulted_total.update(newly_defaulted)\n        \n    return defaulted_total\n\ndef solve_case(n, L_raw, E, R, s, delta):\n    \"\"\"\n    Solves a single test case for the optimal guarantee problem.\n    \"\"\"\n    L = np.zeros((n, n))\n    for i, j, val in L_raw:\n        L[i, j] = val\n\n    # 1. Baseline simulation (no guarantee)\n    defaulted_base = simulate_contagion(n, L, E, R, s, delta)\n    \n    # Check if cascade is already halted (final defaults are none or only the shocked bank)\n    if not defaulted_base or defaulted_base == {s}:\n        return [-1, -1, 0.0]\n\n    # 2. Search for optimal guarantee\n    potential_guarantees = []\n    for i in range(n):\n        for j in range(n):\n            if L[i, j]  0:\n                potential_guarantees.append((i, j))\n    \n    min_cost = float('inf')\n    best_guarantee_info = None\n\n    for i, j in potential_guarantees:\n        guarantee = (i, j)\n        defaulted_final = simulate_contagion(n, L, E, R, s, delta, guarantee)\n        \n        # Check if cascade is halted\n        if not defaulted_final or defaulted_final == {s}:\n            # Calculate realized cost\n            cost = 0.0\n            if i in defaulted_final:\n                cost = (1.0 - R) * L[i, j]\n            \n            # Check if this is a better solution (lower cost)\n            if cost  min_cost:\n                min_cost = cost\n                best_guarantee_info = [i, j, cost]\n\n    if best_guarantee_info is not None:\n        return best_guarantee_info\n    else:\n        # No single guarantee could halt the cascade\n        return [-2, -2, -1.0]\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # Case 1\n        {\n            \"n\": 4, \"R\": 0.4, \"E\": [0.3, 0.5, 0.7, 0.5],\n            \"L_raw\": [(0, 1, 1.0), (0, 2, 0.1), (1, 2, 1.2), (2, 3, 1.0)],\n            \"s\": 0, \"delta\": 0.5\n        },\n        # Case 2\n        {\n            \"n\": 3, \"R\": 0.5, \"E\": [0.2, 0.2, 0.2],\n            \"L_raw\": [(0, 1, 0.5), (0, 2, 0.5)],\n            \"s\": 0, \"delta\": 0.5\n        },\n        # Case 3\n        {\n            \"n\": 3, \"R\": 0.4, \"E\": [0.5, 0.5, 0.5],\n            \"L_raw\": [(0, 1, 0.1), (0, 2, 0.1)],\n            \"s\": 0, \"delta\": 0.4\n        },\n        # Case 4\n        {\n            \"n\": 5, \"R\": 0.2, \"E\": [0.3, 0.9, 0.6, 0.6, 1.0],\n            \"L_raw\": [(0, 1, 0.2), (0, 2, 0.8), (2, 3, 0.8), (3, 4, 0.9)],\n            \"s\": 0, \"delta\": 0.5\n        }\n    ]\n    \n    results = []\n    for case in test_cases:\n        result = solve_case(case[\"n\"], case[\"L_raw\"], case[\"E\"], case[\"R\"], case[\"s\"], case[\"delta\"])\n        results.append(str(result).replace(\" \", \"\"))\n\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == '__main__':\n    solve()\n```", "id": "2435828"}]}