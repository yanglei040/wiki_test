{"hands_on_practices": [{"introduction": "Understanding sparse matrix formats begins with the ability to interpret their structure. This first exercise focuses on decoding the Compressed Sparse Row (CSR) format, one of the most widely used storage schemes in computational science. By reconstructing the full dense matrix from its three constituent arrays—`values`, `col_indices`, and `row_ptr`—you will gain a concrete understanding of how CSR efficiently represents sparsity by storing only non-zero elements and their locations. [@problem_id:2204554]", "problem": "In many scientific and engineering applications, matrices are often \"sparse,\" meaning most of their elements are zero. Storing all these zeros is inefficient. The Compressed Sparse Row (CSR) format is a common method for storing sparse matrices by using three one-dimensional arrays.\n\nConsider a sparse matrix $A$ of size $4 \\times 4$. In the CSR format (using 0-based indexing), this matrix is represented by the following three arrays:\n1.  An array `V` containing the non-zero elements of $A$, read row by row, from left to right.\n2.  An array `C` containing the column index for each corresponding element in `V`.\n3.  An array `R` (the row pointer) of size $m+1$ (where $m$ is the number of rows), where the $i$-th element indicates the index in `V` and `C` where the data for the $i$-th row begins. The last element of `R` is the total number of non-zero elements.\n\nThe three arrays for our $4 \\times 4$ matrix $A$ are given as follows:\n- `V = [5.1, -1.2, 2.0, -3.5, 4.0, 9.8]`\n- `C = [1, 3, 0, 2, 3, 0]`\n- `R = [0, 2, 3, 5, 6]`\n\nReconstruct the original dense $4 \\times 4$ matrix $A$. Present your answer as a $4 \\times 4$ matrix.", "solution": "We use the CSR definition with 0-based indexing. For each row index $i \\in \\{0,1,2,3\\}$, the nonzero entries of row $i$ are stored in the segments of `V` and `C` with indices $j$ from $R[i]$ to $R[i+1]-1$, where the column index is $C[j]$ and the value is $V[j]$. The last element $R[4]=6$ equals the total number of nonzeros, which matches $\\lvert V \\rvert=6$.\n\nRow $0$: indices $j=R[0]\\ldots R[1]-1=0\\ldots 1$.\n- $j=0$: $C[0]=1$, $V[0]=5.1$ gives $A_{0,1}=5.1$.\n- $j=1$: $C[1]=3$, $V[1]=-1.2$ gives $A_{0,3}=-1.2$.\nThus row $0$ is $[0,\\,5.1,\\,0,\\,-1.2]$.\n\nRow $1$: indices $j=R[1]\\ldots R[2]-1=2\\ldots 2$.\n- $j=2$: $C[2]=0$, $V[2]=2.0$ gives $A_{1,0}=2.0$.\nThus row $1$ is $[2.0,\\,0,\\,0,\\,0]$.\n\nRow $2$: indices $j=R[2]\\ldots R[3]-1=3\\ldots 4$.\n- $j=3$: $C[3]=2$, $V[3]=-3.5$ gives $A_{2,2}=-3.5$.\n- $j=4$: $C[4]=3$, $V[4]=4.0$ gives $A_{2,3}=4.0$.\nThus row $2$ is $[0,\\,0,\\,-3.5,\\,4.0]$.\n\nRow $3$: indices $j=R[3]\\ldots R[4]-1=5\\ldots 5$.\n- $j=5$: $C[5]=0$, $V[5]=9.8$ gives $A_{3,0}=9.8$.\nThus row $3$ is $[9.8,\\,0,\\,0,\\,0]$.\n\nTherefore, the reconstructed dense matrix $A$ is\n$$\n\\begin{pmatrix}\n0 & 5.1 & 0 & -1.2 \\\\\n2.0 & 0 & 0 & 0 \\\\\n0 & 0 & -3.5 & 4.0 \\\\\n9.8 & 0 & 0 & 0\n\\end{pmatrix}.\n$$", "answer": "$$\\boxed{\\begin{pmatrix}0 & 5.1 & 0 & -1.2 \\\\ 2.0 & 0 & 0 & 0 \\\\ 0 & 0 & -3.5 & 4.0 \\\\ 9.8 & 0 & 0 & 0\\end{pmatrix}}$$", "id": "2204554"}, {"introduction": "In many real-world applications, sparse matrix data is first generated in a simple, intuitive format like the Coordinate (COO) list. However, for high-performance computations such as matrix-vector multiplication, a more structured format like CSR is far more efficient. This practice problem guides you through the essential process of converting a matrix from COO to CSR format, a fundamental skill that involves careful sorting and the construction of the row pointer array. [@problem_id:2204580]", "problem": "In scientific computing, sparse matrices, which are matrices populated primarily with zeros, are often stored in specialized formats to save memory and computational time. One such format is the Coordinate (COO) format, which represents a matrix using three arrays: `values` (containing the non-zero elements), `row_indices` (the row index of each non-zero element), and `col_indices` (the column index of each non-zero element).\n\nAnother common and more efficient format for matrix operations is the Compressed Sparse Row (CSR) format. It also uses three arrays:\n1.  `values`: An array of the non-zero values, ordered by row and then by column within each row.\n2.  `col_indices`: An array of the column indices corresponding to the elements in the `values` array.\n3.  `row_ptr`: An array of size `(number of rows + 1)`. The value `row_ptr[i]` indicates the index in the `values` array where the elements for row `i` begin. The last element of `row_ptr` is the total number of non-zero elements.\n\nConsider a 5x5 sparse matrix representing a small network, initially given in COO format. The non-zero elements are provided in an arbitrary order:\n\n`values = [3, 8, 1, 5, 9, 2, 7]`\n`row_indices = [1, 0, 4, 0, 2, 2, 4]`\n`col_indices = [2, 1, 3, 4, 3, 0, 1]`\n\nConvert this matrix representation from COO format to CSR format. Which of the following options correctly represents the resulting `values`, `col_indices`, and `row_ptr` arrays?\n\nA.\n`values = [8, 5, 3, 2, 9, 7, 1]`\n`col_indices = [1, 4, 2, 0, 3, 1, 3]`\n`row_ptr = [0, 2, 1, 2, 0, 2]`\n\nB.\n`values = [3, 8, 1, 5, 9, 2, 7]`\n`col_indices = [2, 1, 3, 4, 3, 0, 1]`\n`row_ptr = [0, 2, 3, 5, 5, 7]`\n\nC.\n`values = [8, 5, 3, 2, 9, 7, 1]`\n`col_indices = [1, 4, 2, 0, 3, 1, 3]`\n`row_ptr = [1, 3, 4, 6, 6, 8]`\n\nD.\n`values = [8, 5, 3, 2, 9, 7, 1]`\n`col_indices = [1, 4, 2, 0, 3, 1, 3]`\n`row_ptr = [0, 2, 3, 5, 5, 7]`", "solution": "We are given a sparse matrix in COO format via three arrays. Define the COO triplets as $(r_{k}, c_{k}, v_{k})$ for each nonzero entry. From the data:\n$$\n\\begin{aligned}\n&v = [3,8,1,5,9,2,7],\\\\\n&r = [1,0,4,0,2,2,4],\\\\\n&c = [2,1,3,4,3,0,1].\n\\end{aligned}\n$$\nThis yields the unordered list of triplets:\n$$\n(1,2;3),\\ (0,1;8),\\ (4,3;1),\\ (0,4;5),\\ (2,3;9),\\ (2,0;2),\\ (4,1;7).\n$$\n\nTo convert to CSR, we sort the entries by row index ascending, and within each row by column index ascending. Grouping by row and sorting within each row:\n- Row $0$: entries $(0,1;8)$ and $(0,4;5)$, already ordered by column $1<4$.\n- Row $1$: entry $(1,2;3)$.\n- Row $2$: entries $(2,0;2)$ and $(2,3;9)$, ordered by column $0<3$.\n- Row $3$: no entries.\n- Row $4$: entries $(4,1;7)$ and $(4,3;1)$, ordered by column $1<3$.\n\nConcatenating by row gives the CSR-ordered arrays:\n$$\n\\text{values} = [8,\\,5,\\,3,\\,2,\\,9,\\,7,\\,1],\n$$\n$$\n\\text{col\\_indices} = [1,\\,4,\\,2,\\,0,\\,3,\\,1,\\,3].\n$$\n\nNext, compute the row pointer array $\\text{row\\_ptr}$ of length $5+1=6$. Count nonzeros per row:\n- Row $0$: $2$,\n- Row $1$: $1$,\n- Row $2$: $2$,\n- Row $3$: $0$,\n- Row $4$: $2$.\n\nTake cumulative sums starting at $0$:\n$$\n\\text{row\\_ptr} = [0,\\ 0+2,\\ 2+1,\\ 3+2,\\ 5+0,\\ 5+2] = [0,\\,2,\\,3,\\,5,\\,5,\\,7].\n$$\n\nComparing with the options, this matches option D exactly.", "answer": "$$\\boxed{D}$$", "id": "2204580"}, {"introduction": "The true power of sparse formats is realized when we design algorithms that operate directly on the compressed data, avoiding the massive memory and computational cost of explicit matrix operations. This exercise challenges you to compute a transpose-vector product, $y = A^T x$, for a matrix $A$ stored in CSR format. This task requires you to think creatively about how to perform a seemingly column-centric operation using a row-major data structure, without the inefficient step of explicitly forming the transpose matrix $A^T$. [@problem_id:2204555]", "problem": "In numerical linear algebra, sparse matrices are often stored in specialized formats to save memory and computational cost. One of the most common is the Compressed Sparse Row (CSR) format. A sparse matrix $A$ of size $m \\times n$ is represented by three one-dimensional arrays, using 0-based indexing:\n\n1.  `values`: An array containing all the non-zero elements of $A$, listed in row-major order.\n2.  `col_indices`: An array of the same size as `values`, storing the column index for each corresponding non-zero value.\n3.  `row_ptr`: An array of size $m+1$. The entries for row `i` (where $0 \\le i < m$) start at `values[row_ptr[i]]` and end at `values[row_ptr[i+1] - 1]`. The last element, `row_ptr[m]`, stores the total number of non-zero elements.\n\nConsider a sparse matrix $A$ of size $4 \\times 5$ represented in CSR format by the following arrays:\n`values` = `[2.0, -1.0, 3.0, 5.0, 1.0, 4.0, -3.0, 2.0]`\n`col_indices` = `[1, 3, 0, 4, 1, 2, 0, 3]`\n`row_ptr` = `[0, 2, 4, 6, 8]`\n\nYou are also given a vector $x = [1.0, 0.5, -2.0, -1.0]^T$.\n\nYour task is to compute the transpose-vector product $y = A^T x$ without explicitly constructing the matrix $A$ or its transpose $A^T$. Determine the components of the resulting vector $y$. Your answer should be the components of $y$ listed in order from $y_0$ to $y_4$.", "solution": "We are given a sparse matrix $A \\in \\mathbb{R}^{4 \\times 5}$ in CSR format with\n$\\text{values} = [2.0, -1.0, 3.0, 5.0, 1.0, 4.0, -3.0, 2.0]$, $\\text{col\\_indices} = [1, 3, 0, 4, 1, 2, 0, 3]$, and $\\text{row\\_ptr} = [0, 2, 4, 6, 8]$, and a vector $x = [1.0, 0.5, -2.0, -1.0]^{T}$. The goal is to compute $y = A^{T} x$ without forming $A$ or $A^{T}$. By definition of matrix-vector multiplication with a transpose, each component satisfies\n$$\ny_{j} = \\sum_{i=0}^{3} A_{i,j} x_{i} \\quad \\text{for } j \\in \\{0,1,2,3,4\\}.\n$$\nIn CSR, for each row $i$, the nonzeros are at indices $k$ from $\\text{row\\_ptr}[i]$ to $\\text{row\\_ptr}[i+1]-1$, with column $j = \\text{col\\_indices}[k]$ and value $A_{i,j} = \\text{values}[k]$. Thus we can accumulate\n$$\ny_{j} \\mathrel{+}= \\text{values}[k] \\, x_{i} \\quad \\text{for each nonzero } (i,j).\n$$\nInitialize $y = [0,0,0,0,0]$. Process each row:\n\nRow $i=0$ uses $k \\in \\{0,1\\}$ since $\\text{row\\_ptr}[0]=0$ and $\\text{row\\_ptr}[1]=2$, with $x_{0} = 1.0$.\n- For $k=0$: $j=\\text{col\\_indices}[0]=1$, $\\text{values}[0]=2.0$, so $y_{1} \\mathrel{+}= 2.0 \\cdot 1.0 = 2.0$.\n- For $k=1$: $j=\\text{col\\_indices}[1]=3$, $\\text{values}[1]=-1.0$, so $y_{3} \\mathrel{+}= (-1.0) \\cdot 1.0 = -1.0$.\n\nRow $i=1$ uses $k \\in \\{2,3\\}$ with $x_{1} = 0.5$.\n- For $k=2$: $j=\\text{col\\_indices}[2]=0$, $\\text{values}[2]=3.0$, so $y_{0} \\mathrel{+}= 3.0 \\cdot 0.5 = 1.5$.\n- For $k=3$: $j=\\text{col\\_indices}[3]=4$, $\\text{values}[3]=5.0$, so $y_{4} \\mathrel{+}= 5.0 \\cdot 0.5 = 2.5$.\n\nRow $i=2$ uses $k \\in \\{4,5\\}$ with $x_{2} = -2.0$.\n- For $k=4$: $j=\\text{col\\_indices}[4]=1$, $\\text{values}[4]=1.0$, so $y_{1} \\mathrel{+}= 1.0 \\cdot (-2.0) = -2.0$.\n- For $k=5$: $j=\\text{col\\_indices}[5]=2$, $\\text{values}[5]=4.0$, so $y_{2} \\mathrel{+}= 4.0 \\cdot (-2.0) = -8.0$.\n\nRow $i=3$ uses $k \\in \\{6,7\\}$ with $x_{3} = -1.0$.\n- For $k=6$: $j=\\text{col\\_indices}[6]=0$, $\\text{values}[6]=-3.0$, so $y_{0} \\mathrel{+}= (-3.0) \\cdot (-1.0) = 3.0$.\n- For $k=7$: $j=\\text{col\\_indices}[7]=3$, $\\text{values}[7]=2.0$, so $y_{3} \\mathrel{+}= 2.0 \\cdot (-1.0) = -2.0$.\n\nSumming contributions componentwise gives\n$$\ny_{0} = 1.5 + 3.0 = 4.5,\\quad\ny_{1} = 2.0 - 2.0 = 0,\\quad\ny_{2} = -8.0,\\quad\ny_{3} = -1.0 - 2.0 = -3.0,\\quad\ny_{4} = 2.5.\n$$\nTherefore,\n$$ y = \\begin{pmatrix} 4.5 & 0 & -8 & -3 & 2.5 \\end{pmatrix}. $$", "answer": "$$\\boxed{\\begin{pmatrix}4.5 & 0 & -8 & -3 & 2.5\\end{pmatrix}}$$", "id": "2204555"}]}