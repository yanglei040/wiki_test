{"hands_on_practices": [{"introduction": "Before diving into complex numerical solutions, a physicist's first step is often to understand the character of the flow. This practice guides you through a fundamental scaling analysis of the Navier-Stokes equations to determine the dominant physical forces at play [@problem_id:2654181]. By calculating the Reynolds number for a real-world biological system, you'll gain a tangible understanding of how inertia and viscosity compete, and why the fluid dynamics of the microscopic world are so different from our everyday experience.", "problem": "In the zebrafish (Danio rerio) embryo, the left–right organizer known as Kupffer’s vesicle (KV) is a fluid-filled cavity whose internal flow is driven by motile cilia and is thought to contribute to left–right patterning. From first principles, the regime of this flow can be assessed by comparing the characteristic magnitudes of inertial and viscous terms in the incompressible Navier–Stokes equations. Using this comparison, identify the dimensionless group that quantifies the ratio of inertial to viscous effects and compute its value for KV flow given the following physically realistic parameters: characteristic length scale $L = 50\\,\\mu\\mathrm{m}$, characteristic flow speed $U = 50\\,\\mu\\mathrm{m/s}$, fluid mass density $\\rho = 10^{3}\\,\\mathrm{kg/m^{3}}$, and dynamic viscosity $\\mu = 10^{-3}\\,\\mathrm{Pa\\cdot s}$. All quantities are to be interpreted in the International System of Units (SI) after appropriate conversion. Based on the magnitude of the computed dimensionless group relative to $1$, explain in your reasoning whether the KV flow is inertia-dominated or viscosity-dominated and what qualitative regime (for example, laminar creeping flow) is expected.\n\nProvide only the numerical value of the dimensionless group as your final answer. Express it as a dimensionless decimal; no rounding is required.", "solution": "The problem is first subjected to validation.\n\nThe givens extracted verbatim from the problem statement are:\n- System: Kupffer’s vesicle (KV) in the zebrafish (*Danio rerio*) embryo.\n- Task: Identify the dimensionless group for the ratio of inertial to viscous effects from first principles and compute its value.\n- Characteristic length scale: $L = 50\\,\\mu\\mathrm{m}$.\n- Characteristic flow speed: $U = 50\\,\\mu\\mathrm{m/s}$.\n- Fluid mass density: $\\rho = 10^{3}\\,\\mathrm{kg/m^{3}}$.\n- Dynamic viscosity: $\\mu = 10^{-3}\\,\\mathrm{Pa\\cdot s}$.\n- Instruction: Interpret all quantities in the International System of Units (SI).\n- Instruction: Compare the result to $1$ to determine the dominant regime (inertia vs. viscosity) and expected flow type.\n\nThe problem is deemed valid. It is a well-posed problem in biophysical fluid dynamics, based on the fundamental principles of the Navier-Stokes equations. The biological context is scientifically accurate, and the provided physical parameters are realistic for fluid dynamics at the cellular scale. The problem is free of ambiguity, contradiction, and factual unsoundness.\n\nWe proceed to the solution. The motion of a viscous, incompressible Newtonian fluid is described by the Navier-Stokes equations. For a fluid with constant density $\\rho$ and dynamic viscosity $\\mu$, the equation for conservation of momentum is:\n$$ \\rho \\left( \\frac{\\partial \\mathbf{v}}{\\partial t} + (\\mathbf{v} \\cdot \\nabla) \\mathbf{v} \\right) = -\\nabla p + \\mu \\nabla^2 \\mathbf{v} $$\nHere, $\\mathbf{v}$ is the fluid velocity vector, $p$ is the pressure, and $t$ is time. We have neglected body forces, as they are typically insignificant compared to viscous and pressure forces at this microscopic scale.\n\nThe term on the left, specifically the convective acceleration term $\\rho (\\mathbf{v} \\cdot \\nabla) \\mathbf{v}$, represents inertial effects. The term on the right, $\\mu \\nabla^2 \\mathbf{v}$, represents viscous effects due to friction within the fluid. To determine the character of the flow, we compare the characteristic magnitudes of these two terms. This is accomplished through scaling analysis.\n\nWe introduce the characteristic scales provided in the problem: velocity scale $U$ and length scale $L$. The differential operator $\\nabla$ can be scaled as $\\nabla \\sim 1/L$.\nThe magnitude of the inertial term is estimated as:\n$$ |\\rho (\\mathbf{v} \\cdot \\nabla) \\mathbf{v}| \\sim \\rho \\frac{U^2}{L} $$\nThe magnitude of the viscous term is estimated as:\n$$ |\\mu \\nabla^2 \\mathbf{v}| \\sim \\mu \\frac{U}{L^2} $$\nThe dimensionless group that quantifies the ratio of inertial to viscous effects is the ratio of these two magnitudes. This group is known as the Reynolds number, denoted $Re$.\n$$ Re = \\frac{\\text{Magnitude of inertial term}}{\\text{Magnitude of viscous term}} \\sim \\frac{\\rho U^2 / L}{\\mu U / L^2} = \\frac{\\rho U L}{\\mu} $$\nNow we must compute the numerical value of $Re$. First, we convert all given parameters to base SI units.\n- Characteristic length scale: $L = 50\\,\\mu\\mathrm{m} = 50 \\times 10^{-6}\\,\\mathrm{m}$.\n- Characteristic flow speed: $U = 50\\,\\mu\\mathrm{m/s} = 50 \\times 10^{-6}\\,\\mathrm{m/s}$.\n- Mass density: $\\rho = 10^{3}\\,\\mathrm{kg/m^{3}}$ (already in SI).\n- Dynamic viscosity: $\\mu = 10^{-3}\\,\\mathrm{Pa\\cdot s}$. The unit Pascal-second is an SI unit, equivalent to $\\mathrm{kg} \\cdot \\mathrm{m}^{-1} \\cdot \\mathrm{s}^{-1}$.\n\nWe substitute these values into the expression for the Reynolds number:\n$$ Re = \\frac{(10^{3}\\,\\mathrm{kg/m^{3}}) \\times (50 \\times 10^{-6}\\,\\mathrm{m/s}) \\times (50 \\times 10^{-6}\\,\\mathrm{m})}{10^{-3}\\,\\mathrm{Pa\\cdot s}} $$\nThe calculation proceeds as follows:\n$$ Re = \\frac{10^{3} \\times (50 \\times 50) \\times (10^{-6} \\times 10^{-6})}{10^{-3}} = \\frac{10^{3} \\times 2500 \\times 10^{-12}}{10^{-3}} $$\n$$ Re = \\frac{2.5 \\times 10^{3} \\times 10^{3} \\times 10^{-12}}{10^{-3}} = \\frac{2.5 \\times 10^{6} \\times 10^{-12}}{10^{-3}} = \\frac{2.5 \\times 10^{-6}}{10^{-3}} $$\n$$ Re = 2.5 \\times 10^{-6 - (-3)} = 2.5 \\times 10^{-3} $$\nThe numerical value is $Re = 0.0025$.\n\nAs requested, we interpret this result. The computed Reynolds number $Re = 2.5 \\times 10^{-3}$ is significantly smaller than $1$ ($Re \\ll 1$). Since the Reynolds number represents the ratio of inertial to viscous forces, this result indicates that viscous forces are overwhelmingly dominant over inertial forces. The flow in the Kupffer’s vesicle is therefore viscosity-dominated. This flow regime is known as Stokes flow or creeping flow. Such flows are characterized by being laminar, orderly, and time-reversible (in the absence of diffusion), with negligible momentum advection. This is the expected physical regime for most biological processes at the cellular and sub-cellular level.", "answer": "$$\\boxed{2.5 \\times 10^{-3}}$$", "id": "2654181"}, {"introduction": "In incompressible flows, pressure acts not as a thermodynamic variable but as a Lagrange multiplier, enforcing the constraint $\\nabla \\cdot \\mathbf{u} = 0$. This exercise tackles the crucial inverse problem of finding the pressure field required to sustain a given velocity field, a common task in fluid dynamics analysis [@problem_id:2416637]. You will derive the classic pressure Poisson equation and solve it using powerful spectral methods, gaining essential skills for nearly any incompressible flow simulation.", "problem": "You are given a two-dimensional, steady, incompressible viscous flow governed by the Navier–Stokes equations in the absence of body forces. The fundamental base is Newton’s Second Law per unit volume and mass conservation for a Newtonian fluid: the momentum equation for steady incompressible flow,\n$$\n(\\mathbf{u}\\cdot\\nabla)\\mathbf{u} \\;=\\; -\\frac{1}{\\rho}\\nabla p \\;+\\; \\nu \\nabla^2 \\mathbf{u},\n$$\ntogether with the incompressibility constraint,\n$$\n\\nabla\\cdot \\mathbf{u} \\;=\\; 0,\n$$\nwhere $\\mathbf{u} = (u_x,u_y)$ is the velocity, $p$ is the pressure, $\\rho$ is the constant density, and $\\nu$ is the constant kinematic viscosity. On a periodic square domain of side length $L$ in meters, the target velocity field is a spatially periodic vortex array parameterized by a speed scale $U$ and two integers $(m_x,m_y)$ that specify the number of periods in the $x$ and $y$ directions. Define the wave numbers $k_x = 2\\pi m_x/L$ and $k_y = 2\\pi m_y/L$. Consider the incompressible target field\n$$\nu_x(x,y) \\;=\\; U \\,\\sin(k_x x)\\,\\cos(k_y y), \\qquad\nu_y(x,y) \\;=\\; -\\,U \\,\\frac{k_x}{k_y}\\,\\cos(k_x x)\\,\\sin(k_y y),\n$$\nwhich satisfies $\\nabla\\cdot \\mathbf{u} = 0$ for all $m_x \\ge 1$, $m_y \\ge 1$.\n\nYour tasks are:\n- Starting from the steady incompressible momentum equation and the incompressibility constraint, derive a scalar Poisson equation for the pressure $p(x,y)$ with periodic boundary conditions on the square domain. Your derivation must begin from these fundamental laws and eliminate the pressure gradient by taking the divergence of the momentum equation, using that $\\nabla\\cdot\\mathbf{u}=0$ and that $\\nabla\\cdot(\\nabla^2 \\mathbf{u}) = \\nabla^2 (\\nabla\\cdot\\mathbf{u})$.\n- Implement a spectral solver on a uniform $N\\times N$ grid using the Fast Fourier Transform to compute $p(x,y)$ up to an arbitrary additive constant by solving the derived Poisson equation in Fourier space. Impose the zero-mean gauge by setting the zero-wave-number Fourier coefficient of $p$ to zero.\n- Quantify how well the target field can be sustained by pressure alone in the absence of body forces by evaluating the residual acceleration field\n$$\n\\mathbf{a}_{\\mathrm{res}}(x,y) \\;=\\; -\\frac{1}{\\rho}\\nabla p(x,y) \\;+\\; \\nu \\nabla^2 \\mathbf{u}(x,y) \\;-\\; (\\mathbf{u}\\cdot\\nabla)\\mathbf{u}(x,y).\n$$\nCompute the root-mean-square magnitude\n$$\na_{\\mathrm{rms}} \\;=\\; \\sqrt{\\langle \\|\\mathbf{a}_{\\mathrm{res}}(x,y)\\|^2 \\rangle},\n$$\nwhere $\\langle\\cdot\\rangle$ denotes the spatial average over the domain and $\\|\\cdot\\|$ is the Euclidean norm. The quantity $a_{\\mathrm{rms}}$ has units of meters per second squared and represents the magnitude of a body force per unit mass that would be required, in addition to pressure, to sustain the target field exactly.\n- For each test case below, report two scalars:\n  1. The maximum absolute pressure over the grid, $p_{\\max} = \\max_{x,y} |p(x,y)|$, expressed in Pascals.\n  2. The residual root-mean-square acceleration $a_{\\mathrm{rms}}$, expressed in meters per second squared.\n  \nUse the following parameters for all cases unless otherwise specified: domain side length $L = 1$ meter, grid size $N = 128$, density $\\rho = 1$ kilogram per cubic meter. The three test cases are:\n- Case $1$ (happy path): $U = 1$ meter per second, $\\nu = 0.05$ square meters per second, $(m_x,m_y) = (1,1)$.\n- Case $2$ (Euler limit): $U = 1$ meter per second, $\\nu = 0$ square meters per second, $(m_x,m_y) = (2,1)$.\n- Case $3$ (higher wavenumbers and viscosity): $U = 0.5$ meter per second, $\\nu = 0.1$ square meters per second, $(m_x,m_y) = (3,2)$.\n\nYour program must:\n- Construct $\\mathbf{u}(x,y)$ for each case on the specified grid.\n- Solve for $p(x,y)$ by the pressure Poisson equation with periodic boundary conditions using a spectral method.\n- Compute $p_{\\max}$ in Pascals and $a_{\\mathrm{rms}}$ in meters per second squared for each case.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of lists, where each inner list corresponds to one test case and contains $[p_{\\max},a_{\\mathrm{rms}}^{(1)}],[p_{\\max}^{(2)},a_{\\mathrm{rms}}^{(2)}],[p_{\\max}^{(3)},a_{\\mathrm{rms}}^{(3)}]$ in that order.\n- All quantities must be in International System of Units (SI): pressure in Pascals, accelerations in meters per second squared, lengths in meters, velocities in meters per second, density in kilograms per cubic meter, and viscosity in square meters per second.", "solution": "The problem presented is a well-posed and scientifically sound exercise in computational fluid dynamics. It requires the derivation of the pressure Poisson equation from the fundamental Navier-Stokes equations for a steady, incompressible viscous flow, followed by the implementation of a spectral method to solve for the pressure field and evaluate a residual acceleration. The problem is self-contained and free of contradictions. I will therefore proceed with a complete solution.\n\nThe first task is to derive the Poisson equation for pressure $p(x,y)$. We begin with the steady, incompressible momentum equation in the absence of body forces:\n$$(\\mathbf{u}\\cdot\\nabla)\\mathbf{u} = -\\frac{1}{\\rho}\\nabla p + \\nu \\nabla^2 \\mathbf{u}$$\nwhere $\\mathbf{u}$ is the velocity field, $p$ is the pressure, $\\rho$ is the constant density, and $\\nu$ is the constant kinematic viscosity. To isolate the pressure term, we take the divergence of this equation:\n$$\\nabla \\cdot ((\\mathbf{u}\\cdot\\nabla)\\mathbf{u}) = \\nabla \\cdot \\left(-\\frac{1}{\\rho}\\nabla p\\right) + \\nabla \\cdot (\\nu \\nabla^2 \\mathbf{u})$$\nGiven that $\\rho$ and $\\nu$ are constants, they can be moved outside the divergence operator. The divergence of a gradient is the Laplacian, so $\\nabla \\cdot (\\nabla p) = \\nabla^2 p$. This gives:\n$$\\nabla \\cdot ((\\mathbf{u}\\cdot\\nabla)\\mathbf{u}) = -\\frac{1}{\\rho}\\nabla^2 p + \\nu \\nabla \\cdot (\\nabla^2 \\mathbf{u})$$\nThe problem states to use the identity $\\nabla\\cdot(\\nabla^2 \\mathbf{u}) = \\nabla^2 (\\nabla\\cdot\\mathbf{u})$. The flow is incompressible, which is expressed by the constraint $\\nabla\\cdot\\mathbf{u} = 0$. Applying this, the viscous term's divergence vanishes:\n$$\\nu \\nabla \\cdot (\\nabla^2 \\mathbf{u}) = \\nu \\nabla^2 (\\nabla\\cdot\\mathbf{u}) = \\nu \\nabla^2(0) = 0$$\nThe equation thus simplifies to:\n$$\\nabla \\cdot ((\\mathbf{u}\\cdot\\nabla)\\mathbf{u}) = -\\frac{1}{\\rho}\\nabla^2 p$$\nRearranging for the Laplacian of pressure yields the desired Poisson equation for pressure:\n$$\\nabla^2 p = -\\rho \\nabla \\cdot ((\\mathbf{u}\\cdot\\nabla)\\mathbf{u})$$\nThis equation dictates that the pressure field adjusts to counteract the divergence of the advective acceleration, ensuring the flow remains incompressible at all times.\n\nThe second task is to solve this equation numerically on a periodic square domain of side length $L$ using a spectral method based on the Fast Fourier Transform (FFT). The domain is discretized into a uniform $N \\times N$ grid. The key principle of a spectral method is that differentiation in physical space corresponds to multiplication in Fourier space. If $\\hat{g}(k_x, k_y)$ is the 2D discrete Fourier transform of a function $g(x,y)$, then the Fourier transform of its partial derivative with respect to $x$ is given by $i k_x \\hat{g}(k_x, k_y)$, where $k_x$ is the wavenumber in the $x$-direction.\n\nApplying the Fourier transform, denoted by $\\mathcal{F}$, to the pressure Poisson equation yields:\n$$\\mathcal{F}\\{\\nabla^2 p\\} = \\mathcal{F}\\{-\\rho \\nabla \\cdot ((\\mathbf{u}\\cdot\\nabla)\\mathbf{u})\\}$$\nThe Fourier transform of the Laplacian operator $\\nabla^2 = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}$ is multiplication by $-(k_x^2 + k_y^2)$. Let $S(x,y) = -\\rho \\nabla \\cdot ((\\mathbf{u}\\cdot\\nabla)\\mathbf{u})$ be the source term. The equation in Fourier space becomes:\n$$-(k_x^2 + k_y^2) \\hat{p}(k_x, k_y) = \\hat{S}(k_x, k_y)$$\nThe Fourier coefficients of the pressure field, $\\hat{p}$, can be found by algebraic division:\n$$\\hat{p}(k_x, k_y) = -\\frac{\\hat{S}(k_x, k_y)}{k_x^2 + k_y^2}$$\nA singularity exists at the zero-wavenumber mode $(k_x, k_y) = (0,0)$, where the denominator is zero. This reflects the physical fact that pressure is determined only up to an arbitrary additive constant. The problem specifies the \"zero-mean gauge,\" which is enforced by setting the zero-wavenumber Fourier coefficient of pressure to zero: $\\hat{p}(0,0) = 0$. For this to be consistent, the source term's zero-wavenumber mode, $\\hat{S}(0,0)$, must also be zero. This is guaranteed because $S$ is the divergence of a vector field, and the integral of a divergence over a periodic domain is zero.\n\nThe numerical implementation proceeds as follows:\n1. Define the $N \\times N$ spatial grid $(x_i, y_j)$ and the corresponding wavenumber grids $(K_x, K_y)$ using `numpy.fft.fftfreq`.\n2. Construct the velocity field components $u_x$ and $u_y$ on the spatial grid.\n3. Compute the advection term components, $A_x = (\\mathbf{u}\\cdot\\nabla)u_x$ and $A_y = (\\mathbf{u}\\cdot\\nabla)u_y$. The required spatial derivatives (e.g., $\\frac{\\partial u_x}{\\partial x}$) are computed spectrally by FFT, multiplication by $i K_x$, and inverse FFT.\n4. Calculate the Poisson source term $S = -\\rho(\\frac{\\partial A_x}{\\partial x} + \\frac{\\partial A_y}{\\partial y})$, again using spectral differentiation.\n5. Compute $\\hat{S}$ via a 2D FFT.\n6. Solve for $\\hat{p}$ in Fourier space, handling the $k=0$ mode as described.\n7. Compute the pressure field $p(x,y)$ by applying a 2D inverse FFT to $\\hat{p}$. The maximum absolute pressure $p_{\\max}$ is then found from this grid.\n\nFinally, we must compute the root-mean-square residual acceleration, $a_{\\mathrm{rms}}$. The residual acceleration field is defined as:\n$$\\mathbf{a}_{\\mathrm{res}}(x,y) = -\\frac{1}{\\rho}\\nabla p(x,y) + \\nu \\nabla^2 \\mathbf{u}(x,y) - (\\mathbf{u}\\cdot\\nabla)\\mathbf{u}(x,y)$$\nThis residual represents the forcing per unit mass required to make the given velocity field an exact solution of the steady Navier-Stokes equations with the computed pressure field. All terms are computed on the grid. The gradient $\\nabla p$ and Laplacian $\\nabla^2 \\mathbf{u}$ are computed spectrally for consistency. The advection term $(\\mathbf{u}\\cdot\\nabla)\\mathbf{u}$ has already been computed.\nThe root-mean-square magnitude is given by:\n$$a_{\\mathrm{rms}} = \\sqrt{\\frac{1}{N^2}\\sum_{i,j=0}^{N-1} \\| \\mathbf{a}_{\\mathrm{res}}(x_i, y_j) \\|^2}$$\nwhere the sum is over all grid points. For the specific velocity field given, analytical investigation reveals that the advection term $(\\mathbf{u}\\cdot\\nabla)\\mathbf{u}$ is curl-free, meaning it can be expressed as the gradient of a scalar potential. The pressure field $p$ computed via the Poisson equation is precisely the one that makes $-\\frac{1}{\\rho}\\nabla p$ balance $(\\mathbf{u}\\cdot\\nabla)\\mathbf{u}$. Consequently, the first and third terms in the residual definition cancel, and the residual simplifies to $\\mathbf{a}_{\\mathrm{res}} = \\nu \\nabla^2 \\mathbf{u}$. This implies that for the inviscid case ($\\nu=0$), the residual acceleration should be zero. The numerical implementation will compute the full residual expression to remain general and robust.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the pressure Poisson equation for a given 2D periodic flow\n    and computes the residual of the Navier-Stokes equations.\n    \"\"\"\n    # Global parameters\n    L = 1.0  # meters\n    N = 128  # grid size\n    rho = 1.0  # kg/m^3\n\n    # Test cases from the problem statement\n    test_cases = [\n        # (U, nu, (mx, my))\n        (1.0, 0.05, (1, 1)),  # Case 1\n        (1.0, 0.0, (2, 1)),   # Case 2\n        (0.5, 0.1, (3, 2)),   # Case 3\n    ]\n\n    results = []\n\n    # Discretization\n    delta = L / N\n    x = np.arange(N) * delta\n    y = np.arange(N) * delta\n    X, Y = np.meshgrid(x, y, indexing='ij')\n\n    # Wavenumbers\n    k_freq = np.fft.fftfreq(N, d=delta)\n    Kx_1d = 2 * np.pi * k_freq\n    Ky_1d = 2 * np.pi * k_freq\n    Kx, Ky = np.meshgrid(Kx_1d, Ky_1d, indexing='ij')\n\n    # Laplacian operator in Fourier space\n    lap_fourier = -(Kx**2 + Ky**2)\n\n    for U, nu, (mx, my) in test_cases:\n        # Case-specific parameters\n        kx = 2 * np.pi * mx / L\n        ky = 2 * np.pi * my / L\n\n        # 1. Construct velocity field u = (ux, uy)\n        ux = U * np.sin(kx * X) * np.cos(ky * Y)\n        uy = -U * (kx / ky) * np.cos(kx * X) * np.sin(ky * Y)\n\n        # Fourier transform of velocity components\n        ux_hat = np.fft.fft2(ux)\n        uy_hat = np.fft.fft2(uy)\n\n        # 2. Compute derivatives and advection term (u.grad)u\n        # Derivatives are computed in Fourier space\n        dux_dx = np.fft.ifft2(1j * Kx * ux_hat).real\n        dux_dy = np.fft.ifft2(1j * Ky * ux_hat).real\n        duy_dx = np.fft.ifft2(1j * Kx * uy_hat).real\n        duy_dy = np.fft.ifft2(1j * Ky * uy_hat).real\n        \n        # Advection term components\n        adv_x = ux * dux_dx + uy * dux_dy\n        adv_y = ux * duy_dx + uy * duy_dy\n\n        # 3. Solve pressure Poisson equation: lap(p) = -rho * div((u.grad)u)\n        # Source term for Poisson equation\n        adv_x_hat = np.fft.fft2(adv_x)\n        adv_y_hat = np.fft.fft2(adv_y)\n        \n        # Divergence in Fourier space\n        div_adv_hat = 1j * Kx * adv_x_hat + 1j * Ky * adv_y_hat\n        \n        source_hat = -rho * div_adv_hat\n\n        # Solve for pressure in Fourier space\n        p_hat = np.zeros_like(source_hat, dtype=complex)\n        \n        # Avoid division by zero at k=0 mode\n        non_zero_k = lap_fourier != 0\n        p_hat[non_zero_k] = source_hat[non_zero_k] / lap_fourier[non_zero_k]\n        \n        # Impose zero-mean gauge explicitly\n        p_hat[0, 0] = 0.0\n\n        # Transform pressure back to physical space\n        p = np.fft.ifft2(p_hat).real\n        \n        # 4. Calculate maximum absolute pressure\n        p_max = np.max(np.abs(p))\n\n        # 5. Compute residual acceleration: a_res = -1/rho*grad(p) + nu*lap(u) - (u.grad)u\n        \n        # Pressure gradient term\n        dp_dx = np.fft.ifft2(1j * Kx * p_hat).real\n        dp_dy = np.fft.ifft2(1j * Ky * p_hat).real\n        \n        grad_p_x = dp_dx\n        grad_p_y = dp_dy\n\n        # Viscous term\n        lap_ux = np.fft.ifft2(lap_fourier * ux_hat).real\n        lap_uy = np.fft.ifft2(lap_fourier * uy_hat).real\n\n        # Assemble residual components\n        a_res_x = - (1 / rho) * grad_p_x + nu * lap_ux - adv_x\n        a_res_y = - (1 / rho) * grad_p_y + nu * lap_uy - adv_y\n\n        # 6. Compute RMS of residual acceleration\n        a_res_sq_mag = a_res_x**2 + a_res_y**2\n        a_rms = np.sqrt(np.mean(a_res_sq_mag))\n\n        results.append([p_max, a_rms])\n\n    # Format the final output string as a list of lists\n    result_str = \",\".join([f\"[{res[0]},{res[1]}]\" for res in results])\n    print(f\"[{result_str}]\")\n\nsolve()\n```", "id": "2416637"}, {"introduction": "Having explored flow regimes and the role of pressure, we now turn to simulating the motion of objects within a fluid. This advanced practice challenges you to model the coupled translational and rotational dynamics of an elliptical particle sedimenting in a low-Reynolds-number shear flow [@problem_id:2416656]. This problem requires deriving the equations of motion from first principles, including the effects of anisotropic mobility, and implementing a numerical integrator to simulate its trajectory, providing a complete \"first-principles to simulation\" experience.", "problem": "A single rigid elliptical particle sediments in an infinite, quiescent, viscous Newtonian fluid under gravity, while the ambient fluid simultaneously sustains a uniform plane shear background flow. The particle is modeled in two spatial dimensions by its center-of-mass position $(x(t),y(t))$ and its in-plane orientation angle $\\theta(t)$ measured from the laboratory $x$-axis to the particle major axis. Assume low Reynolds number so that linear Stokes flow applies and inertia of both fluid and particle is negligible. The particle is force- and torque-free except for a constant gravitational-buoyancy force acting at its center of mass. The gravitational-buoyancy force vector is $\\mathbf{F}=(0,-F_g)$ with $F_g0$, in units of newtons (N). The uniform plane shear background flow is $\\mathbf{u}_{bg}(x,y)=(\\dot{\\gamma}\\,y,0)$ with shear rate $\\dot{\\gamma}$ in inverse seconds (s$^{-1}$). The particle has an aspect ratio $\\lambda=a/b$ ($\\lambda\\ge 1$) where $a$ and $b$ are its semi-axes.\n\nStarting from the fundamental base of the Navier–Stokes equations, take the low Reynolds number limit to obtain Stokes flow, use linearity and kinematic reversibility to construct the translational mobility tensor for an in-plane ellipse with anisotropic mobilities along and across its major axis, and use the classical rigid-body orientation dynamics of an axisymmetric ellipsoid in simple shear to close the system. In particular, construct the following, entirely from first principles without invoking any shortcut formulas:\n\n- The translational slip velocity relative to the local fluid, $\\mathbf{U}_{slip}$, as the action of an orientation-dependent mobility tensor $\\boldsymbol{\\mu}(\\theta)$ on the constant force $\\mathbf{F}$. The tensor must decompose along the particle’s body frame using two scalar mobilities: the mobility parallel to the major axis $\\mu_{\\parallel}$ and the mobility perpendicular to it $\\mu_{\\perp}$, both in meters per newton-second (m/(N·s)). The body-frame unit vectors are $\\mathbf{e}_{\\parallel}=(\\cos\\theta,\\sin\\theta)$ and $\\mathbf{e}_{\\perp}=(-\\sin\\theta,\\cos\\theta)$.\n- The orientation kinematics $\\mathrm{d}\\theta/\\mathrm{d}t$ in planar simple shear, based on the decomposition of the velocity gradient into its symmetric (rate-of-strain) and antisymmetric (vorticity) parts and the shape parameter determined by $\\lambda$.\n\nCombine the above to form a closed system of ordinary differential equations for $(x(t),y(t),\\theta(t))$ driven by $\\dot{\\gamma}$, $F_g$, $\\mu_{\\parallel}$, $\\mu_{\\perp}$, and $\\lambda$. The final equations must be valid in the creeping-flow regime and must use the following physical units: positions in meters (m), time in seconds (s), and orientation in radians.\n\nImplement a fixed-step explicit fourth-order Runge–Kutta time integrator to advance the system from initial conditions $(x(0),y(0),\\theta(0))=(0,0,\\theta_0)$ to time $t=T$. Use the following test suite of three parameter sets, all in Standard International (SI) units:\n\n- Test 1 (happy path): $\\dot{\\gamma}=1.0$ s$^{-1}$, $\\lambda=3.0$, $\\mu_{\\parallel}=8.0\\times 10^{6}$ m/(N·s), $\\mu_{\\perp}=4.0\\times 10^{6}$ m/(N·s), $F_g=2.0\\times 10^{-12}$ N, $\\theta_0=0.3$ rad, $T=5.0$ s.\n- Test 2 (boundary, zero shear): $\\dot{\\gamma}=0.0$ s$^{-1}$, $\\lambda=3.0$, $\\mu_{\\parallel}=8.0\\times 10^{6}$ m/(N·s), $\\mu_{\\perp}=4.0\\times 10^{6}$ m/(N·s), $F_g=2.0\\times 10^{-12}$ N, $\\theta_0=1.0$ rad, $T=3.0$ s.\n- Test 3 (edge, isotropic mobility): $\\dot{\\gamma}=0.5$ s$^{-1}$, $\\lambda=2.0$, $\\mu_{\\parallel}=\\mu_{\\perp}=5.0\\times 10^{6}$ m/(N·s), $F_g=1.5\\times 10^{-12}$ N, $\\theta_0=0.8$ rad, $T=4.0$ s.\n\nCompute $(x(T),y(T),\\theta(T))$ for each test. Express $x(T)$ and $y(T)$ in meters and $\\theta(T)$ in radians. Round each reported value to $6$ decimal places.\n\nYour program should produce a single line of output containing a comma-separated list of $9$ floats in the following order:\n$[x_1,y_1,\\theta_1,x_2,y_2,\\theta_2,x_3,y_3,\\theta_3]$\nwhere the subscript denotes the test number. The line must be printed exactly in this bracketed, comma-separated format, with each number rounded to $6$ decimal places as specified, and with no additional text.", "solution": "The problem statement has been evaluated and is deemed valid. It is scientifically grounded in the established principles of low-Reynolds-number hydrodynamics, is well-posed as an initial value problem for a system of ordinary differential equations, and is expressed in objective, formal language. The provided parameters are physically plausible for a microscale system. The problem is self-contained, with the minor exception of the numerical time step, which is a standard choice left to the implementer in computational tasks. We will proceed with the derivation and solution.\n\nThe motion of the particle is governed by the principles of linear Stokes flow, which is the zero-Reynolds-number limit of the Navier–Stokes equations. The linearity of the Stokes equations permits the superposition of velocities. The particle's translational velocity, $\\mathbf{U}_{p} = (\\,dx/dt, dy/dt\\,)$, is the sum of the local ambient fluid velocity at the particle's center of mass, $\\mathbf{u}_{bg}(x,y)$, and the slip velocity, $\\mathbf{U}_{slip}$, induced by the external gravitational-buoyancy force $\\mathbf{F}$.\n$$\n\\mathbf{U}_{p}(t) = \\mathbf{u}_{bg}(x(t), y(t)) + \\mathbf{U}_{slip}(t)\n$$\nThe background flow is a simple shear flow $\\mathbf{u}_{bg}(x,y) = (\\,\\dot{\\gamma}y, 0\\,)$, where $\\dot{\\gamma}$ is the shear rate. The slip velocity is related to the external force $\\mathbf{F} = (\\,0, -F_g\\,)$ via the mobility tensor $\\boldsymbol{\\mu}(\\theta)$, where $\\theta$ is the particle's orientation angle.\n$$\n\\mathbf{U}_{slip} = \\boldsymbol{\\mu}(\\theta) \\cdot \\mathbf{F}\n$$\nThe mobility tensor $\\boldsymbol{\\mu}$ in the laboratory frame depends on the particle's orientation. We construct it from its representation in the particle's body frame, which is diagonal with components $\\mu_{\\parallel}$ and $\\mu_{\\perp}$ corresponding to motion parallel and perpendicular to the particle's major axis. The body-frame unit vectors are $\\mathbf{e}_{\\parallel} = (\\,\\cos\\theta, \\sin\\theta\\,)^T$ and $\\mathbf{e}_{\\perp} = (\\,-\\sin\\theta, \\cos\\theta\\,)^T$. Using the spectral decomposition, the mobility tensor in the lab frame is:\n$$\n\\boldsymbol{\\mu}(\\theta) = \\mu_{\\parallel} (\\mathbf{e}_{\\parallel} \\otimes \\mathbf{e}_{\\parallel}) + \\mu_{\\perp} (\\mathbf{e}_{\\perp} \\otimes \\mathbf{e}_{\\perp})\n$$\nwhere $\\otimes$ denotes the outer product. In matrix form, with $c = \\cos\\theta$ and $s = \\sin\\theta$:\n$$\n\\boldsymbol{\\mu}(\\theta) = \\mu_{\\parallel} \\begin{pmatrix} c^2  sc \\\\ sc  s^2 \\end{pmatrix} + \\mu_{\\perp} \\begin{pmatrix} s^2  -sc \\\\ -sc  c^2 \\end{pmatrix} = \\begin{pmatrix} \\mu_{\\parallel}c^2 + \\mu_{\\perp}s^2  (\\mu_{\\parallel} - \\mu_{\\perp})sc \\\\ (\\mu_{\\parallel} - \\mu_{\\perp})sc  \\mu_{\\parallel}s^2 + \\mu_{\\perp}c^2 \\end{pmatrix}\n$$\nApplying this tensor to the force $\\mathbf{F} = (\\,0, -F_g\\,)^T$ yields the components of the slip velocity:\n$$\nU_{slip,x} = -F_g (\\mu_{\\parallel} - \\mu_{\\perp})\\sin\\theta\\cos\\theta = -\\frac{F_g}{2}(\\mu_{\\parallel} - \\mu_{\\perp})\\sin(2\\theta)\n$$\n$$\nU_{slip,y} = -F_g (\\mu_{\\parallel}\\sin^2\\theta + \\mu_{\\perp}\\cos^2\\theta) = -F_g \\left( \\frac{\\mu_{\\parallel}+\\mu_{\\perp}}{2} - \\frac{\\mu_{\\parallel}-\\mu_{\\perp}}{2}\\cos(2\\theta) \\right)\n$$\nCombining these with the background flow, we obtain the translational equations of motion:\n$$\n\\frac{dx}{dt} = \\dot{\\gamma}y - \\frac{F_g}{2}(\\mu_{\\parallel} - \\mu_{\\perp})\\sin(2\\theta)\n$$\n$$\n\\frac{dy}{dt} = -F_g \\left( \\frac{\\mu_{\\parallel}+\\mu_{\\perp}}{2} - \\frac{\\mu_{\\parallel}-\\mu_{\\perp}}{2}\\cos(2\\theta) \\right)\n$$\nNext, we derive the equation for the particle's orientation dynamics, $\\mathrm{d}\\theta/\\mathrm{d}t$. In a general linear flow, the angular velocity of an elongated particle is given by Jeffery's equation. This arises from the decomposition of the background velocity gradient tensor, $\\mathbf{L} = \\nabla\\mathbf{u}_{bg}$, into its symmetric part, the rate-of-strain tensor $\\mathbf{E} = \\frac{1}{2}(\\mathbf{L} + \\mathbf{L}^T)$, and its antisymmetric part, the vorticity tensor $\\mathbf{\\Omega} = \\frac{1}{2}(\\mathbf{L} - \\mathbf{L}^T)$. For the given shear flow, $\\mathbf{u}_{bg} = (\\,\\dot{\\gamma}y, 0\\,)$, the gradient tensor is:\n$$\n\\mathbf{L} = \\begin{pmatrix} 0  \\dot{\\gamma} \\\\ 0  0 \\end{pmatrix}\n$$\nThe decomposition yields:\n$$\n\\mathbf{E} = \\frac{\\dot{\\gamma}}{2} \\begin{pmatrix} 0  1 \\\\ 1  0 \\end{pmatrix} \\quad \\text{and} \\quad \\mathbf{\\Omega} = \\frac{\\dot{\\gamma}}{2} \\begin{pmatrix} 0  1 \\\\ -1  0 \\end{pmatrix}\n$$\nThe vorticity tensor imparts an angular velocity on the particle equal to the local fluid vorticity, $\\omega_z = \\Omega_{21} = -\\dot{\\gamma}/2$. The rate-of-strain tensor also exerts a torque on an anisotropic particle, causing an additional rotation with rate $B (\\mathbf{e}_{\\perp}^T \\mathbf{E} \\mathbf{e}_{\\parallel})$. The shape parameter, or Bretherton constant, $B$ is determined by the particle's aspect ratio $\\lambda = a/b$:\n$$\nB = \\frac{\\lambda^2 - 1}{\\lambda^2 + 1}\n$$\nThe strain-induced rotation rate is calculated as:\n$$\n\\mathbf{e}_{\\perp}^T \\mathbf{E} \\mathbf{e}_{\\parallel} = (-\\sin\\theta, \\cos\\theta) \\frac{\\dot{\\gamma}}{2} \\begin{pmatrix} 0  1 \\\\ 1  0 \\end{pmatrix} \\begin{pmatrix} \\cos\\theta \\\\ \\sin\\theta \\end{pmatrix} = \\frac{\\dot{\\gamma}}{2}(-\\sin^2\\theta + \\cos^2\\theta) = \\frac{\\dot{\\gamma}}{2}\\cos(2\\theta)\n$$\nThe total angular velocity is the sum of the vorticity and strain-induced contributions:\n$$\n\\frac{d\\theta}{dt} = \\omega_z + B (\\mathbf{e}_{\\perp}^T \\mathbf{E} \\mathbf{e}_{\\parallel}) = -\\frac{\\dot{\\gamma}}{2} + B \\frac{\\dot{\\gamma}}{2}\\cos(2\\theta)\n$$\nThis gives the final equation for the orientation:\n$$\n\\frac{d\\theta}{dt} = \\frac{\\dot{\\gamma}}{2} \\left[ \\left( \\frac{\\lambda^2 - 1}{\\lambda^2 + 1} \\right) \\cos(2\\theta) - 1 \\right]\n$$\nThe complete system of first-order ordinary differential equations for the state vector $\\mathbf{Y}(t) = (x(t), y(t), \\theta(t))^T$ is:\n$$\n\\frac{d\\mathbf{Y}}{dt} = \\mathbf{f}(\\mathbf{Y}) = \n\\begin{pmatrix}\n\\dot{\\gamma}y - \\frac{F_g}{2}(\\mu_{\\parallel} - \\mu_{\\perp})\\sin(2\\theta) \\\\\n-F_g \\left( \\frac{\\mu_{\\parallel}+\\mu_{\\perp}}{2} - \\frac{\\mu_{\\parallel}-\\mu_{\\perp}}{2}\\cos(2\\theta) \\right) \\\\\n\\frac{\\dot{\\gamma}}{2} \\left[ \\left( \\frac{\\lambda^2 - 1}{\\lambda^2 + 1} \\right) \\cos(2\\theta) - 1 \\right]\n\\end{pmatrix}\n$$\nThis system is to be solved numerically from the initial condition $\\mathbf{Y}(0) = (0, 0, \\theta_0)^T$ up to time $T$. We employ the explicit fourth-order Runge-Kutta (RK4) method. Given $\\mathbf{Y}_n$ at time $t_n$, the next state $\\mathbf{Y}_{n+1}$ at $t_{n+1} = t_n + \\Delta t$ is computed as:\n$$\n\\mathbf{k}_1 = \\Delta t \\cdot \\mathbf{f}(\\mathbf{Y}_n)\n$$\n$$\n\\mathbf{k}_2 = \\Delta t \\cdot \\mathbf{f}(\\mathbf{Y}_n + \\frac{1}{2}\\mathbf{k}_1)\n$$\n$$\n\\mathbf{k}_3 = \\Delta t \\cdot \\mathbf{f}(\\mathbf{Y}_n + \\frac{1}{2}\\mathbf{k}_2)\n$$\n$$\n\\mathbf{k}_4 = \\Delta t \\cdot \\mathbf{f}(\\mathbf{Y}_n + \\mathbf{k}_3)\n$$\n$$\n\\mathbf{Y}_{n+1} = \\mathbf{Y}_n + \\frac{1}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)\n$$\nTo ensure numerical stability and accuracy sufficient for the required output precision of $6$ decimal places, a small time step $\\Delta t$ is necessary. We choose a fixed number of integration steps, $N = 100000$, resulting in a time step of $\\Delta t=T/N$. This step is much smaller than the characteristic timescales of the system, such as the period of Jeffery rotation, and is adequate for convergence.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the final state (x, y, theta) of an elliptical particle\n    sedimenting in a sheared viscous fluid for three test cases.\n    The system of ODEs is solved using a fourth-order Runge-Kutta method.\n    \"\"\"\n\n    test_cases = [\n        # Test 1 (happy path)\n        {\n            \"gamma_dot\": 1.0, \"lambda_\": 3.0, \"mu_par\": 8.0e6, \"mu_perp\": 4.0e6,\n            \"Fg\": 2.0e-12, \"theta0\": 0.3, \"T\": 5.0\n        },\n        # Test 2 (boundary, zero shear)\n        {\n            \"gamma_dot\": 0.0, \"lambda_\": 3.0, \"mu_par\": 8.0e6, \"mu_perp\": 4.0e6,\n            \"Fg\": 2.0e-12, \"theta0\": 1.0, \"T\": 3.0\n        },\n        # Test 3 (edge, isotropic mobility)\n        {\n            \"gamma_dot\": 0.5, \"lambda_\": 2.0, \"mu_par\": 5.0e6, \"mu_perp\": 5.0e6,\n            \"Fg\": 1.5e-12, \"theta0\": 0.8, \"T\": 4.0\n        }\n    ]\n\n    results = []\n    \n    # Number of steps for the RK4 integrator\n    N = 100000\n\n    for case in test_cases:\n        gamma_dot = case[\"gamma_dot\"]\n        lambda_ = case[\"lambda_\"]\n        mu_par = case[\"mu_par\"]\n        mu_perp = case[\"mu_perp\"]\n        Fg = case[\"Fg\"]\n        theta0 = case[\"theta0\"]\n        T = case[\"T\"]\n\n        # Initial state vector Y = [x, y, theta]\n        Y = np.array([0.0, 0.0, theta0], dtype=float)\n        \n        # Time step\n        dt = T / N\n\n        # Shape parameter B (Bretherton constant)\n        if lambda_ >= 1.0:\n            B = (lambda_**2 - 1) / (lambda_**2 + 1)\n        else: # Should not happen based on problem spec lambda >= 1\n            B = 0\n\n        # Mobility term simplifications\n        mu_diff = mu_par - mu_perp\n        mu_sum = mu_par + mu_perp\n\n        def f(y_vec):\n            \"\"\"\n            Defines the system of ODEs dY/dt = f(Y).\n            Y = [x, y, theta]\n            \"\"\"\n            x, y, theta = y_vec\n            \n            cos2th = np.cos(2 * theta)\n            sin2th = np.sin(2 * theta)\n\n            dxdt = gamma_dot * y - 0.5 * Fg * mu_diff * sin2th\n            dydt = -Fg * (0.5 * mu_sum - 0.5 * mu_diff * cos2th)\n            \n            if gamma_dot == 0:\n                dthdt = 0.0\n            else:\n                dthdt = 0.5 * gamma_dot * (B * cos2th - 1)\n\n            return np.array([dxdt, dydt, dthdt])\n\n        # RK4 integration loop\n        for _ in range(N):\n            k1 = dt * f(Y)\n            k2 = dt * f(Y + 0.5 * k1)\n            k3 = dt * f(Y + 0.5 * k2)\n            k4 = dt * f(Y + k3)\n            Y += (k1 + 2*k2 + 2*k3 + k4) / 6.0\n        \n        # Store final state\n        results.extend(Y)\n\n    # Format output as a single string with 6 decimal places per value.\n    formatted_results = [f\"{val:.6f}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```", "id": "2416656"}]}