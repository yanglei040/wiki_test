{"hands_on_practices": [{"introduction": "To truly grasp the mechanics of the Boundary Element Method, there is no substitute for building a small system by hand. This exercise [@problem_id:2374819] guides you through the assembly and solution of a $4 \\times 4$ linear system for a classic potential problem on a unit square. By manually calculating the entries of the influence matrices, you will gain a concrete understanding of how the geometry and the Green's function translate into the final algebraic equations that we solve.", "problem": "Consider the interior boundary value problem for Laplace’s equation in two dimensions ($2$D) on the unit square domain $\\Omega = (0,1)\\times(0,1)$ with boundary $\\Gamma = \\partial\\Omega$. Let $u$ denote the potential, and let $q = \\partial u/\\partial n$ denote the outward normal flux. Use the direct boundary integral equation for the Laplace operator with the two-dimensional free-space Green’s function\n$$\nG(\\mathbf{x},\\mathbf{y}) \\;=\\; -\\frac{1}{2\\pi}\\,\\ln|\\mathbf{x}-\\mathbf{y}|\\;,\n$$\nand adopt the standard interior convention $c(\\mathbf{x}) = \\tfrac{1}{2}$ at smooth boundary points $\\mathbf{x}\\in\\Gamma$. Discretize the boundary with one straight constant-strength element per side (four elements total), with collocation at each element’s midpoint. Index the elements as follows:\n- $\\Gamma_{1}:\\ \\{(s,0)\\,|\\,0\\le s\\le 1\\}$ with outward normal $\\mathbf{n}_{1}=(0,-1)$,\n- $\\Gamma_{2}:\\ \\{(1,s)\\,|\\,0\\le s\\le 1\\}$ with outward normal $\\mathbf{n}_{2}=(1,0)$,\n- $\\Gamma_{3}:\\ \\{(s,1)\\,|\\,0\\le s\\le 1\\}$ with outward normal $\\mathbf{n}_{3}=(0,1)$,\n- $\\Gamma_{4}:\\ \\{(0,s)\\,|\\,0\\le s\\le 1\\}$ with outward normal $\\mathbf{n}_{4}=(-1,0)$,\nand collocation points\n$$\n\\mathbf{x}_{1}=(\\tfrac{1}{2},0),\\quad \\mathbf{x}_{2}=(1,\\tfrac{1}{2}),\\quad \\mathbf{x}_{3}=(\\tfrac{1}{2},1),\\quad \\mathbf{x}_{4}=(0,\\tfrac{1}{2}).\n$$\nImpose Dirichlet data\n$$\nu=0\\ \\text{on}\\ \\Gamma_{1}\\cup\\Gamma_{4},\\qquad u=1\\ \\text{on}\\ \\Gamma_{2}\\cup\\Gamma_{3}.\n$$\nWith piecewise-constant $u$ and $q$ per element and collocation at the midpoints, assemble the resulting $4\\times 4$ linear system from first principles by evaluating the required boundary integrals exactly. Then solve the system for the four unknown element-constant outward fluxes $\\{q_{j}\\}_{j=1}^{4}$. Use principal values of inverse trigonometric functions in radians, and express your final result exactly (no numerical rounding) as a row matrix $(q_{1}\\ q_{2}\\ q_{3}\\ q_{4})$.", "solution": "The problem posed is a well-defined boundary value problem for the two-dimensional Laplace equation, to be solved using a direct boundary element method. All required data, including the geometry, boundary conditions, and discretization scheme, are provided. The problem is scientifically grounded, self-contained, and objective. It is therefore deemed valid and a solution will be provided.\n\nThe direct boundary integral equation (BIE) for an interior potential problem governed by Laplace's equation is given by\n$$c(\\mathbf{x}) u(\\mathbf{x}) + \\int_{\\Gamma} u(\\mathbf{y}) \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_y} \\, d\\Gamma_y = \\int_{\\Gamma} q(\\mathbf{y}) G(\\mathbf{x}, \\mathbf{y}) \\, d\\Gamma_y$$\nwhere $\\mathbf{x}$ is a point on the boundary $\\Gamma$, $c(\\mathbf{x})$ is the solid angle coefficient, $u$ is the potential, $q = \\partial u/\\partial n$ is the normal flux, and $G(\\mathbf{x},\\mathbf{y})$ is the free-space Green's function. For this problem, $G(\\mathbf{x},\\mathbf{y}) = -\\frac{1}{2\\pi}\\ln|\\mathbf{x}-\\mathbf{y}|$. The normal derivative of the Green's function is $\\frac{\\partial G}{\\partial n_y} = \\nabla_y G \\cdot \\mathbf{n}_y = -\\frac{1}{2\\pi} \\frac{(\\mathbf{y}-\\mathbf{x})\\cdot\\mathbf{n}_y}{|\\mathbf{y}-\\mathbf{x}|^2}$.\n\nThe boundary $\\Gamma$ is discretized into four constant-strength elements $\\Gamma_j$, with $j=1,2,3,4$. The potential $u$ and flux $q$ are assumed to be piecewise constant, $u_j$ and $q_j$, on each element $\\Gamma_j$. Applying the BIE at the mid-point $\\mathbf{x}_i$ of each element $\\Gamma_i$ yields a system of linear algebraic equations. Since the collocation points are at the midpoints of straight line segments, they are smooth points on the boundary, so $c(\\mathbf{x}_i) = 1/2$ for all $i$. The discretized BIE is:\n$$\\frac{1}{2} u_i + \\sum_{j=1}^{4} u_j \\left( \\int_{\\Gamma_j} \\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y})}{\\partial n_y} \\, d\\Gamma_y \\right) = \\sum_{j=1}^{4} q_j \\left( \\int_{\\Gamma_j} G(\\mathbf{x}_i, \\mathbf{y}) \\, d\\Gamma_y \\right)$$\nThis can be written in matrix form as $(\\mathbf{H} + \\frac{1}{2}\\mathbf{I})\\mathbf{u} = \\mathbf{G}\\mathbf{q}$, where the matrix entries are given by:\n$$H_{ij} = \\int_{\\Gamma_j} \\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y})}{\\partial n_y} \\, d\\Gamma_y \\quad \\text{and} \\quad G_{ij} = \\int_{\\Gamma_j} G(\\mathbf{x}_i, \\mathbf{y}) \\, d\\Gamma_y$$\nThe knowns are the potentials on each element, given by the Dirichlet boundary conditions: $u_1 = 0$, $u_2 = 1$, $u_3 = 1$, $u_4 = 0$. The vector of potentials is $\\mathbf{u} = (0, 1, 1, 0)^T$. The unknowns are the fluxes $\\mathbf{q} = (q_1, q_2, q_3, q_4)^T$.\n\nWe must now evaluate the matrix coefficients $H_{ij}$ and $G_{ij}$.\nDue to the square geometry and the choice of collocation points, the matrices $\\mathbf{H}$ and $\\mathbf{G}$ will exhibit a symmetric structure. We will have diagonal elements ($i=j$), adjacent elements (e.g., $i=1, j=2$), and opposite elements ($i=1, j=3$).\n\nCalculation of $H_{ij}$:\nFor a straight element, the vector $\\mathbf{y}-\\mathbf{x}_i$ is tangential to the element $\\Gamma_i$ when $i=j$. The normal vector $\\mathbf{n}_i$ is orthogonal to the element. Thus, $(\\mathbf{y}-\\mathbf{x}_i) \\cdot \\mathbf{n}_i = 0$, which implies $H_{ii} = 0$ for all $i=1,2,3,4$.\nFor off-diagonal elements, we compute the integrals. Let's compute the first row ($i=1$, with $\\mathbf{x}_1 = (1/2, 0)$).\n$H_{12}$: Integration over $\\Gamma_2$, where $\\mathbf{y}=(1,s)$ for $s\\in[0,1]$ and $\\mathbf{n}_2=(1,0)$.\n$H_{12} = -\\frac{1}{2\\pi} \\int_0^1 \\frac{((1,s)-(1/2,0))\\cdot(1,0)}{|(1,s)-(1/2,0)|^2} ds = -\\frac{1}{2\\pi} \\int_0^1 \\frac{1/2}{(1/2)^2+s^2} ds = -\\frac{1}{4\\pi} \\left[2\\arctan(2s)\\right]_0^1 = -\\frac{\\arctan(2)}{2\\pi}$.\n$H_{14}$: Integration over $\\Gamma_4$, where $\\mathbf{y}=(0,s)$ for $s\\in[0,1]$ and $\\mathbf{n}_4=(-1,0)$.\n$H_{14} = -\\frac{1}{2\\pi} \\int_0^1 \\frac{((0,s)-(1/2,0))\\cdot(-1,0)}{|(0,s)-(1/2,0)|^2} ds = -\\frac{1}{2\\pi} \\int_0^1 \\frac{1/2}{(-1/2)^2+s^2} ds = H_{12} = -\\frac{\\arctan(2)}{2\\pi}$.\n$H_{13}$: Integration over $\\Gamma_3$, where $\\mathbf{y}=(s,1)$ for $s\\in[0,1]$ and $\\mathbf{n}_3=(0,1)$.\n$H_{13} = -\\frac{1}{2\\pi} \\int_0^1 \\frac{((s,1)-(1/2,0))\\cdot(0,1)}{|(s,1)-(1/2,0)|^2} ds = -\\frac{1}{2\\pi} \\int_0^1 \\frac{1}{(s-1/2)^2+1^2} ds = -\\frac{1}{2\\pi} \\left[\\arctan(s-1/2)\\right]_0^1 = -\\frac{1}{2\\pi}(\\arctan(1/2)-\\arctan(-1/2)) = -\\frac{\\arctan(1/2)}{\\pi}$.\nBy symmetry, let $h_a = H_{12} = H_{14} = H_{21} = \\dots = -\\frac{\\arctan(2)}{2\\pi}$ and $h_o = H_{13} = H_{31} = \\dots = -\\frac{\\arctan(1/2)}{\\pi}$.\nThe matrix $\\mathbf{H}$ is:\n$\\mathbf{H} = \\begin{pmatrix} 0 & h_a & h_o & h_a \\\\ h_a & 0 & h_a & h_o \\\\ h_o & h_a & 0 & h_a \\\\ h_a & h_o & h_a & 0 \\end{pmatrix}$.\nNote that the sum of each row is $2h_a+h_o = -\\frac{\\arctan(2)}{\\pi} - \\frac{\\arctan(1/2)}{\\pi} = -\\frac{1}{\\pi}(\\arctan(2)+\\arctan(1/2)) = -\\frac{1}{\\pi}(\\frac{\\pi}{2}) = -1/2$, which satisfies the sum rule $\\sum_j H_{ij} = -c(\\mathbf{x}_i)$.\n\nCalculation of $G_{ij}$:\nWe use the general integral formula: $\\int \\ln(t^2+c^2)dt = t\\ln(t^2+c^2) - 2t + 2c\\arctan(t/c)$.\n$G_{11}$: Integration over $\\Gamma_1$, where $\\mathbf{y}=(s,0)$ for $s\\in[0,1]$.\n$G_{11} = -\\frac{1}{2\\pi}\\int_0^1 \\ln|s-1/2| ds = -\\frac{1}{2\\pi} (2 \\int_0^{1/2} \\ln(t) dt) = -\\frac{1}{\\pi}[t\\ln t - t]_0^{1/2} = -\\frac{1}{\\pi}(\\frac{1}{2}\\ln(1/2)-\\frac{1}{2}) = \\frac{1+\\ln 2}{2\\pi}$.\n$G_{12}$: Integration over $\\Gamma_2$, $\\mathbf{y}=(1,s)$, $s\\in[0,1]$.\n$G_{12} = -\\frac{1}{2\\pi} \\int_0^1 \\ln\\sqrt{(1/2)^2+s^2} ds = -\\frac{1}{4\\pi}\\int_0^1 \\ln(s^2+(1/2)^2) ds = -\\frac{1}{4\\pi}[s\\ln(s^2+1/4)-2s+\\arctan(2s)]_0^1 = -\\frac{1}{4\\pi}(\\ln(5/4)-2+\\arctan(2)) = \\frac{2-\\ln(5/4)-\\arctan(2)}{4\\pi}$.\n$G_{13}$: Integration over $\\Gamma_3$, $\\mathbf{y}=(s,1)$, $s\\in[0,1]$.\n$G_{13} = -\\frac{1}{2\\pi} \\int_0^1 \\ln\\sqrt{(s-1/2)^2+1^2} ds = -\\frac{1}{4\\pi}\\int_{-1/2}^{1/2} \\ln(t^2+1) dt = -\\frac{2}{4\\pi}\\int_0^{1/2} \\ln(t^2+1) dt = -\\frac{1}{2\\pi}[t\\ln(t^2+1)-2t+2\\arctan(t)]_0^{1/2} = -\\frac{1}{2\\pi}(\\frac{1}{2}\\ln(5/4)-1+2\\arctan(1/2)) = \\frac{1-\\frac{1}{2}\\ln(5/4)-2\\arctan(1/2)}{2\\pi}$.\nBy symmetry, let $g_d = G_{11} = G_{22} = \\dots = \\frac{1+\\ln 2}{2\\pi}$, $g_a = G_{12} = G_{14} = \\dots = \\frac{2-\\ln(5/4)-\\arctan(2)}{4\\pi}$, and $g_o = G_{13} = G_{31} = \\dots = \\frac{2-\\ln(5/4)-4\\arctan(1/2)}{4\\pi}$.\nThe matrix $\\mathbf{G}$ is:\n$\\mathbf{G} = \\begin{pmatrix} g_d & g_a & g_o & g_a \\\\ g_a & g_d & g_a & g_o \\\\ g_o & g_a & g_d & g_a \\\\ g_a & g_o & g_a & g_d \\end{pmatrix}$.\n\nNow we assemble and solve the system $\\mathbf{G}\\mathbf{q}=\\mathbf{v}$, where $\\mathbf{v} = (\\mathbf{H} + \\frac{1}{2}\\mathbf{I})\\mathbf{u}$.\nWith $\\mathbf{u}=(0,1,1,0)^T$:\n$v_1 = \\frac{1}{2}u_1 + H_{12}u_2 + H_{13}u_3 + H_{14}u_4 = h_a(1) + h_o(1) = h_a+h_o$.\n$v_2 = H_{21}u_1 + \\frac{1}{2}u_2 + H_{23}u_3 + H_{24}u_4 = \\frac{1}{2}(1) + h_a(1) = 1/2+h_a$.\n$v_3 = H_{31}u_1 + H_{32}u_2 + \\frac{1}{2}u_3 + H_{34}u_4 = h_a(1) + \\frac{1}{2}(1) = 1/2+h_a$.\n$v_4 = H_{41}u_1 + H_{42}u_2 + H_{43}u_3 + \\frac{1}{2}u_4 = h_o(1) + h_a(1) = h_a+h_o$.\nSo, $\\mathbf{v} = (h_a+h_o, 1/2+h_a, 1/2+h_a, h_a+h_o)^T$.\n\nThe problem has reflectional symmetry about the line $y=x$. The boundary conditions respect this symmetry. Therefore, the solution for the fluxes must also be symmetric: $q_1=q_4$ and $q_2=q_3$. Let $q_1=q_4=A$ and $q_2=q_3=B$. The $4 \\times 4$ system reduces to a $2 \\times 2$ system:\n\\begin{align*} (g_d+g_a)A + (g_a+g_o)B &= h_a+h_o \\\\ (g_a+g_o)A + (g_d+g_a)B &= 1/2+h_a \\end{align*}\nSubtracting the two equations gives:\n$((g_d+g_a)-(g_a+g_o))A + ((g_a+g_o)-(g_d+g_a))B = (h_a+h_o)-(1/2+h_a)$\n$(g_d-g_o)A - (g_d-g_o)B = h_o-1/2$\n$(g_d-g_o)(A-B) = h_o-1/2$.\nAdding the two equations gives:\n$((g_d+g_a)+(g_a+g_o))(A+B) = (h_a+h_o) + (1/2+h_a)$\n$(g_d+2g_a+g_o)(A+B) = 1/2+2h_a+h_o$.\nSince $2h_a+h_o = -1/2$, the right side is $0$. The sum $g_d+2g_a+g_o$ is non-zero, hence we must have $A+B=0$, so $B=-A$. This is consistent with the physical requirement that the total flux out of the source-free domain is zero: $\\sum q_j L_j = q_1(1)+q_2(1)+q_3(1)+q_4(1) = A+B+B+A = 2(A+B)=0$.\nSubstituting $B=-A$ into the first equation of the $2 \\times 2$ system:\n$(g_d+g_a)A - (g_a+g_o)A = h_a+h_o$\n$(g_d-g_o)A = h_a+h_o \\implies A = \\frac{h_a+h_o}{g_d-g_o}$.\nWe compute the numerator and denominator.\n$h_a+h_o = -\\frac{\\arctan(2)}{2\\pi} - \\frac{\\arctan(1/2)}{\\pi} = -\\frac{1}{2\\pi}(\\arctan(2)+2\\arctan(1/2))$. Using the identity $\\arctan(2)+\\arctan(1/2)=\\pi/2$, so $\\arctan(2)=\\pi/2-\\arctan(1/2)$, we get:\n$h_a+h_o = -\\frac{1}{2\\pi}(\\pi/2 - \\arctan(1/2) + 2\\arctan(1/2)) = -\\frac{1}{2\\pi}(\\frac{\\pi}{2}+\\arctan(1/2))$.\nFor the denominator:\n$g_d=\\frac{1+\\ln 2}{2\\pi}$ and $g_o=\\frac{2-\\ln(5/4)-4\\arctan(1/2)}{4\\pi}=\\frac{1-\\frac{1}{2}(\\ln 5 - 2\\ln 2)-2\\arctan(1/2)}{2\\pi}$.\n$g_d-g_o = \\frac{1}{2\\pi}[(1+\\ln 2) - (1-\\frac{1}{2}\\ln 5 + \\ln 2-2\\arctan(1/2))] = \\frac{1}{2\\pi}(\\frac{1}{2}\\ln 5 + 2\\arctan(1/2))$.\nThus,\n$A = \\frac{-\\frac{1}{2\\pi}(\\frac{\\pi}{2}+\\arctan(1/2))}{\\frac{1}{2\\pi}(\\frac{1}{2}\\ln 5+2\\arctan(1/2))} = -\\frac{\\frac{\\pi}{2}+\\arctan(1/2)}{\\frac{1}{2}\\ln 5+2\\arctan(1/2)}$.\nThe fluxes are then:\n$q_1=q_4=A = -\\frac{\\pi/2+\\arctan(1/2)}{1/2\\ln 5+2\\arctan(1/2)}$\n$q_2=q_3=B=-A = \\frac{\\pi/2+\\arctan(1/2)}{1/2\\ln 5+2\\arctan(1/2)}$.\n\nThe final result is the row matrix $(q_1 \\ q_2 \\ q_3 \\ q_4)$.\nLet the constant $C = \\frac{\\frac{\\pi}{2}+\\arctan(\\frac{1}{2})}{\\frac{1}{2}\\ln 5+2\\arctan(\\frac{1}{2})} = \\frac{\\pi+2\\arctan(\\frac{1}{2})}{\\ln 5+4\\arctan(\\frac{1}{2})}$.\nThen $q_1 = -C$, $q_2 = C$, $q_3 = C$, $q_4 = -C$.\nThe final answer is presented below.", "answer": "$$ \\boxed{ \\begin{pmatrix} -\\frac{\\pi+2\\arctan(\\frac{1}{2})}{\\ln 5+4\\arctan(\\frac{1}{2})} & \\frac{\\pi+2\\arctan(\\frac{1}{2})}{\\ln 5+4\\arctan(\\frac{1}{2})} & \\frac{\\pi+2\\arctan(\\frac{1}{2})}{\\ln 5+4\\arctan(\\frac{1}{2})} & -\\frac{\\pi+2\\arctan(\\frac{1}{2})}{\\ln 5+4\\arctan(\\frac{1}{2})} \\end{pmatrix} } $$", "id": "2374819"}, {"introduction": "While manual calculations are insightful, practical BEM implementations rely on robust code to evaluate the boundary integrals. A critical and challenging aspect is the handling of the singular kernel that arises when a source element influences itself, a key feature in the diagonal entries of the system matrix. This practice [@problem_id:2377305] focuses on deriving and implementing the exact analytical formula for the integral of the logarithmic kernel over a straight-line element, a fundamental building block for any 2D potential BEM solver.", "problem": "Consider the two-dimensional logarithmic kernel of the Laplace equation, defined as the scalar function $K(\\mathbf{x},\\mathbf{x}_0) = \\ln r$, where $r = \\|\\mathbf{x} - \\mathbf{x}_0\\|$ is the Euclidean distance between a source point $\\mathbf{x}$ and a field point $\\mathbf{x}_0$. For a straight-line constant element, let the element be the line segment $\\Gamma$ joining endpoints $\\mathbf{A} = (x_1, y_1)$ and $\\mathbf{B} = (x_2, y_2)$ in the plane, and let the field point be $\\mathbf{P} = (x_f, y_f)$. Define the line integral\n$$\nI(\\mathbf{A}, \\mathbf{B}, \\mathbf{P}) = \\int_{\\Gamma} \\ln\\!\\left(\\frac{\\|\\mathbf{x} - \\mathbf{P}\\|}{L_0}\\right)\\, d\\ell,\n$$\nwhere $d\\ell$ is the line element along $\\Gamma$, and $L_0$ is a fixed reference length introduced to render the logarithm argument dimensionless. All distances must be measured in meters, and use $L_0 = 1\\,\\mathrm{m}$. The quantity $I(\\mathbf{A}, \\mathbf{B}, \\mathbf{P})$ has units of meters.\n\nTasks:\n- Starting from first principles, derive a closed-form expression for $I(\\mathbf{A}, \\mathbf{B}, \\mathbf{P})$ valid for any non-degenerate straight segment $\\Gamma$ and for any field point $\\mathbf{P}$ in the plane, including the limiting case where the perpendicular distance from $\\mathbf{P}$ to the line of the segment is zero and the projection of $\\mathbf{P}$ onto the line lies within the segment.\n- Implement a program that evaluates $I(\\mathbf{A}, \\mathbf{B}, \\mathbf{P})$ using the derived closed-form expression for the following test suite, where all coordinates are in meters:\n  - Test $1$: $\\mathbf{A} = (0,0)$, $\\mathbf{B} = (1,0)$, $\\mathbf{P} = (0.3,0.4)$.\n  - Test $2$: $\\mathbf{A} = (0,0)$, $\\mathbf{B} = (1,0)$, $\\mathbf{P} = (0.3,0)$.\n  - Test $3$: $\\mathbf{A} = (0,0)$, $\\mathbf{B} = (1,0)$, $\\mathbf{P} = (0.3,10^{-12})$.\n  - Test $4$: $\\mathbf{A} = (0,0)$, $\\mathbf{B} = (1,0)$, $\\mathbf{P} = (-0.5,0)$.\n  - Test $5$: $\\mathbf{A} = (1,2)$, $\\mathbf{B} = (4,6)$, $\\mathbf{P} = (3,3)$.\n  - Test $6$: $\\mathbf{A} = (0,0)$, $\\mathbf{B} = (10^{-9},0)$, $\\mathbf{P} = (0,1)$.\n  - Test $7$: $\\mathbf{A} = (0,0)$, $\\mathbf{B} = (1,0)$, $\\mathbf{P} = (1,0)$.\n\nAngle units, when applicable in any intermediate expression (for example, an inverse tangent), must be in radians. The final numeric results must be expressed in meters.\n\nYour program must produce a single line of output containing the results for Tests $1$ through $7$ as a comma-separated list of decimal numbers with exactly $12$ digits after the decimal point, enclosed in square brackets. For example, the output format must be\n$[r_1,r_2,r_3,r_4,r_5,r_6,r_7]$\nwhere each $r_k$ is a float in meters corresponding to Test $k$, formatted to $12$ digits after the decimal point. No additional output is permitted.", "solution": "The problem is subjected to validation and is deemed valid. It is scientifically grounded, well-posed, and objective. The problem statement is complete, consistent, and formalizable. The integral is a standard element in two-dimensional potential theory and boundary element methods. The logarithmic singularity is integrable, ensuring the problem is well-posed even when the evaluation point lies on the integration path.\n\nThe problem requires the derivation and implementation of a closed-form solution for the integral:\n$$\nI(\\mathbf{A}, \\mathbf{B}, \\mathbf{P}) = \\int_{\\Gamma} \\ln\\!\\left(\\frac{\\|\\mathbf{x} - \\mathbf{P}\\|}{L_0}\\right)\\, d\\ell\n$$\nGiven the reference length $L_0=1$, the argument of the logarithm becomes dimensionless. Since $\\ln(1)=0$, we have $\\ln(\\|\\mathbf{x} - \\mathbf{P}\\|/L_0) = \\ln(\\|\\mathbf{x} - \\mathbf{P}\\|) - \\ln(L_0) = \\ln(\\|\\mathbf{x} - \\mathbf{P}\\|)$. Let $r = \\|\\mathbf{x} - \\mathbf{P}\\|$. The integral simplifies to:\n$$\nI = \\int_{\\Gamma} \\ln r \\, d\\ell\n$$\n\nTo solve this integral, we establish a local coordinate system $(\\xi, \\eta)$ for the line segment $\\Gamma$. Let the origin be at point $\\mathbf{A}$, and let the $\\xi$-axis be aligned with the vector from $\\mathbf{A}$ to $\\mathbf{B}$. The length of the segment is $L = \\|\\mathbf{B} - \\mathbf{A}\\|$. A point $\\mathbf{x}$ on the segment can be parameterized by $\\xi \\in [0, L]$. The line element is $d\\ell = d\\xi$.\n\nThe unit tangent vector along the segment is $\\mathbf{t} = (\\mathbf{B} - \\mathbf{A})/L$. The unit normal vector, rotated counter-clockwise from $\\mathbf{t}$, is $\\mathbf{n}$. The field point $\\mathbf{P}$ can be described in this local system by coordinates $(\\xi_p, \\eta_p)$, which are the projections of the vector $\\mathbf{P} - \\mathbf{A}$ onto the local axes:\n$$\n\\xi_p = (\\mathbf{P} - \\mathbf{A}) \\cdot \\mathbf{t}\n$$\n$$\n\\eta_p = (\\mathbf{P} - \\mathbf{A}) \\cdot \\mathbf{n}\n$$\nThe distance $r$ from a point $\\mathbf{x}(\\xi)$ on the segment (with local coordinates $(\\xi, 0)$) to the field point $\\mathbf{P}$ (with local coordinates $(\\xi_p, \\eta_p)$) is given by:\n$$\nr = \\sqrt{(\\xi - \\xi_p)^2 + \\eta_p^2}\n$$\nThe integral becomes:\n$$\nI = \\int_{0}^{L} \\ln \\sqrt{(\\xi - \\xi_p)^2 + \\eta_p^2} \\, d\\xi = \\frac{1}{2} \\int_{0}^{L} \\ln \\left( (\\xi - \\xi_p)^2 + \\eta_p^2 \\right) \\, d\\xi\n$$\n\nWe solve the indefinite integral $J(\\xi) = \\int \\ln \\left( (\\xi - \\xi_p)^2 + \\eta_p^2 \\right) \\, d\\xi$ using integration by parts, $\\int u \\, dv = uv - \\int v \\, du$. Let $u = \\ln((\\xi - \\xi_p)^2 + \\eta_p^2)$ and $dv = d\\xi$. We choose $v = \\xi - \\xi_p$ for convenience. Then $du = \\frac{2(\\xi - \\xi_p)}{(\\xi - \\xi_p)^2 + \\eta_p^2} d\\xi$.\n$$\nJ(\\xi) = (\\xi - \\xi_p) \\ln \\left( (\\xi - \\xi_p)^2 + \\eta_p^2 \\right) - \\int (\\xi - \\xi_p) \\frac{2(\\xi - \\xi_p)}{(\\xi - \\xi_p)^2 + \\eta_p^2} \\, d\\xi\n$$\nThe remaining integral is evaluated by substitution. Let $s = \\xi - \\xi_p$:\n$$\n\\int \\frac{2s^2}{s^2 + \\eta_p^2} \\, ds = \\int \\frac{2(s^2 + \\eta_p^2) - 2\\eta_p^2}{s^2 + \\eta_p^2} \\, ds = \\int \\left( 2 - \\frac{2\\eta_p^2}{s^2 + \\eta_p^2} \\right) ds\n$$\n$$\n= 2s - 2\\eta_p^2 \\int \\frac{1}{s^2 + \\eta_p^2} ds = 2s - 2\\eta_p \\arctan\\left(\\frac{s}{\\eta_p}\\right)\n$$\nThis holds for any sign of $\\eta_p \\neq 0$. Substituting back $s = \\xi - \\xi_p$:\n$$\nJ(\\xi) = (\\xi - \\xi_p) \\ln\\left( (\\xi - \\xi_p)^2 + \\eta_p^2 \\right) - 2(\\xi - \\xi_p) + 2\\eta_p \\arctan\\left(\\frac{\\xi - \\xi_p}{\\eta_p}\\right)\n$$\nThe definite integral is $I = \\frac{1}{2}[J(L) - J(0)]$. Let $R_A = \\|\\mathbf{P} - \\mathbf{A}\\| = \\sqrt{\\xi_p^2 + \\eta_p^2}$ and $R_B = \\|\\mathbf{P} - \\mathbf{B}\\| = \\sqrt{(L-\\xi_p)^2 + \\eta_p^2}$.\n$$\nJ(L) = (L-\\xi_p)\\ln(R_B^2) - 2(L-\\xi_p) + 2\\eta_p \\arctan\\left(\\frac{L-\\xi_p}{\\eta_p}\\right)\n$$\n$$\nJ(0) = (-\\xi_p)\\ln(R_A^2) - 2(-\\xi_p) + 2\\eta_p \\arctan\\left(\\frac{-\\xi_p}{\\eta_p}\\right)\n$$\nSubtracting and simplifying gives:\n$$\nI = (L - \\xi_p) \\ln R_B + \\xi_p \\ln R_A - L + \\eta_p \\left( \\arctan\\left(\\frac{L - \\xi_p}{\\eta_p}\\right) - \\arctan\\left(\\frac{-\\xi_p}{\\eta_p}\\right) \\right)\n$$\nUsing the identity $\\arctan(-x) = -\\arctan(x)$, the expression simplifies to:\n$$\nI = (L - \\xi_p) \\ln R_B + \\xi_p \\ln R_A - L + \\eta_p \\left( \\arctan\\left(\\frac{L - \\xi_p}{\\eta_p}\\right) + \\arctan\\left(\\frac{\\xi_p}{\\eta_p}\\right) \\right)\n$$\nThis expression is an even function of $\\eta_p$, since for $\\eta_p < 0$, the initial factor $\\eta_p$ is negative, but each $\\arctan$ term also flips sign, resulting in the same value. Thus, we can write the formula using $|\\eta_p|$ to emphasize this symmetry:\n$$\nI = (L - \\xi_p) \\ln R_B + \\xi_p \\ln R_A - L + |\\eta_p| \\left( \\arctan\\left(\\frac{L - \\xi_p}{|\\eta_p|}\\right) + \\arctan\\left(\\frac{\\xi_p}{|\\eta_p|}\\right) \\right)\n$$\n\nNow, consider the limiting case where $\\mathbf{P}$ lies on the line containing the segment $\\Gamma$, i.e., $\\eta_p = 0$. We evaluate the integral directly for this case:\n$$\nI = \\int_0^L \\ln|\\xi - \\xi_p| \\, d\\xi\n$$\nUsing the antiderivative of $\\ln|u|$, which is $u \\ln|u| - u$:\n$$\nI = \\left[ (\\xi - \\xi_p) \\ln|\\xi - \\xi_p| - (\\xi - \\xi_p) \\right]_0^L\n$$\n$$\n= \\left((L - \\xi_p)\\ln|L - \\xi_p| - (L - \\xi_p)\\right) - \\left((-\\xi_p)\\ln|-\\xi_p| - (-\\xi_p)\\right)\n$$\n$$\nI = (L - \\xi_p)\\ln|L - \\xi_p| + \\xi_p\\ln|\\xi_p| - L\n$$\nThis expression is also the limit of the general formula as $\\eta_p \\to 0$, since $\\lim_{y \\to 0} y \\arctan(K/y) = 0$. When implementing, care must be taken for the cases where the argument of the logarithm is zero (i.e., $\\xi_p=0$ or $\\xi_p=L$). In these cases, the term $x \\ln|x|$ must be evaluated as its limit, which is $0$.\n\nThe implementation will use these two formulae. A small numerical tolerance on $|\\eta_p|/L$ is used to select between the general formula and the numerically more stable collinear case formula.\nThe coordinates of $\\mathbf{P}$ in the local system are computed as:\n$L = \\sqrt{(x_2-x_1)^2 + (y_2-y_1)^2}$\n$\\xi_p = \\frac{(x_f-x_1)(x_2-x_1) + (y_f-y_1)(y_2-y_1)}{L}$\n$\\eta_p = \\frac{(y_f-y_1)(x_2-x_1) - (x_f-x_1)(y_2-y_1)}{L}$\nThe quantity $(y_f-y_1)(x_2-x_1) - (x_f-x_1)(y_2-y_1)$ is related to the 2D vector cross product and represents the signed area of the parallelogram formed by vectors $\\mathbf{P}-\\mathbf{A}$ and $\\mathbf{B}-\\mathbf{A}$.", "answer": "```python\nimport numpy as np\n\ndef _x_times_log_abs_x(x):\n    \"\"\"\n    Calculates x * log(|x|) with a safeguard for x=0.\n    The limit of x*log|x| as x approaches 0 is 0.\n    \"\"\"\n    if np.abs(x) < 1e-30:\n        return 0.0\n    return x * np.log(np.abs(x))\n\ndef calculate_integral(A_coords, B_coords, P_coords):\n    \"\"\"\n    Calculates the integral I = integral over Gamma of ln(r) dl,\n    where Gamma is the line segment from A to B and r is the distance from a point on Gamma to P.\n    \n    Args:\n        A_coords (tuple): Coordinates of point A (x1, y1).\n        B_coords (tuple): Coordinates of point B (x2, y2).\n        P_coords (tuple): Coordinates of field point P (xf, yf).\n\n    Returns:\n        float: The value of the integral.\n    \"\"\"\n    A = np.array(A_coords, dtype=np.float64)\n    B = np.array(B_coords, dtype=np.float64)\n    P = np.array(P_coords, dtype=np.float64)\n\n    vec_AB = B - A\n    L_sq = vec_AB.dot(vec_AB)\n\n    # If the segment is a point (degenerate), the integral is zero.\n    if L_sq < 1e-30:\n        return 0.0\n    \n    L = np.sqrt(L_sq)\n    vec_AP = P - A\n\n    # Project P onto the local coordinate system of the segment.\n    # xi_p is the coordinate along the segment.\n    xi_p = vec_AP.dot(vec_AB) / L\n    \n    # eta_p is the perpendicular distance from P to the line containing the segment.\n    # It is calculated using the 2D cross product equivalent.\n    # The sign convention here corresponds to a normal vector obtained by a\n    # counter-clockwise rotation of the tangent vector.\n    # However, the final formula is independent of the sign of eta_p.\n    cross_prod = vec_AP[0] * vec_AB[1] - vec_AP[1] * vec_AB[0]\n    eta_p = -cross_prod / L\n\n    # Check for collinearity using a relative tolerance.\n    # If P is on (or very close to) the line containing the segment.\n    if np.abs(eta_p) / L < 1e-15:\n        term1 = _x_times_log_abs_x(L - xi_p)\n        term2 = _x_times_log_abs_x(xi_p)\n        return term1 + term2 - L\n    else:\n        # General case where P is not on the line.\n        abs_eta_p = np.abs(eta_p)\n        \n        # Distances from P to endpoints A and B.\n        # Calculated using local coordinates for robustness.\n        R_A = np.sqrt(xi_p**2 + eta_p**2)\n        R_B = np.sqrt((L - xi_p)**2 + eta_p**2)\n\n        term_log_A = xi_p * np.log(R_A)\n        term_log_B = (L - xi_p) * np.log(R_B)\n        \n        # Arctangent term.\n        arg1 = (L - xi_p) / abs_eta_p\n        arg2 = xi_p / abs_eta_p\n        term_atan = abs_eta_p * (np.arctan(arg1) + np.arctan(arg2))\n        \n        return term_log_A + term_log_B - L + term_atan\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test cases and prints the results\n    in the required format.\n    \"\"\"\n    test_cases = [\n        # Test 1: General case\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (0.3, 0.4)},\n        # Test 2: P on the segment\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (0.3, 0.0)},\n        # Test 3: P very close to the segment\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (0.3, 1e-12)},\n        # Test 4: P on line extension\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (-0.5, 0.0)},\n        # Test 5: General segment and point\n        {'A': (1.0, 2.0), 'B': (4.0, 6.0), 'P': (3.0, 3.0)},\n        # Test 6: Very short segment\n        {'A': (0.0, 0.0), 'B': (1e-9, 0.0), 'P': (0.0, 1.0)},\n        # Test 7: P at an endpoint\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (1.0, 0.0)},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_integral(case['A'], case['B'], case['P'])\n        results.append(f\"{result:.12f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2377305"}, {"introduction": "With the core components in place, we can now assemble them to tackle a physically meaningful application. This exercise [@problem_id:2377246] demonstrates how BEM can be used to model a complex phenomenon: the enhancement of the electric field at the tip of a growing metallic dendrite. By developing a solver for this problem, you will see how BEM excels at handling problems with intricate geometries and how it can be used to extract important physical quantities like field enhancement factors.", "problem": "Consider a two-dimensional, quasi-static electrochemical deposition scenario in which a metallic dendrite is modeled by an impenetrable, perfectly conducting inclusion embedded in a homogeneous electrolyte. In the dilute-solution, steady regime, the electrostatic potential satisfies the Laplace equation. You will model the electric field enhancement at the dendrite tip using the Boundary Element Method (BEM).\n\nFundamental base and model. Let the electrolyte occupy the bounded domain $\\Omega \\subset \\mathbb{R}^2$ defined as the region between an outer circle of radius $R$ centered at the origin and an inner metallic inclusion approximating the dendrite cross-section by an ellipse with semi-axes $a$ and $b$ aligned with the coordinate axes, also centered at the origin. The electrostatic potential $\\phi(\\mathbf{x})$ satisfies the Laplace equation $\\nabla^2 \\phi = 0$ in $\\Omega$. The metallic inclusion boundary $\\Gamma_c$ is an equipotential conductor, so impose Dirichlet data $\\phi = 0$ on $\\Gamma_c$. The far-field is approximated by a large bounding circle $\\Gamma_R$ of radius $R$, on which Dirichlet data $\\phi(\\mathbf{x}) = -E_0 x$ is prescribed to emulate a uniform applied electric field of magnitude $E_0$ directed along the positive $x$-axis. Here $x$ denotes the first Cartesian coordinate and $E_0 > 0$ is a constant. All lengths are nondimensional and angles must be treated in radians.\n\nBoundary integral formulation. Use the two-dimensional free-space Green’s function for the Laplace equation, $G(\\mathbf{x},\\mathbf{y}) = -\\dfrac{1}{2\\pi} \\ln \\|\\mathbf{x}-\\mathbf{y}\\|$. Represent the solution in $\\Omega$ using a single-layer potential with unknown density $\\sigma$ supported on the union of boundaries $\\Gamma = \\Gamma_c \\cup \\Gamma_R$:\n$$\n\\phi(\\mathbf{x}) = \\int_{\\Gamma} G(\\mathbf{x},\\mathbf{y}) \\, \\sigma(\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}}, \\quad \\mathbf{x} \\in \\Omega \\cup \\Gamma.\n$$\nEnforce the Dirichlet conditions at boundary collocation points to obtain an integral equation for $\\sigma$ that is to be solved numerically.\n\nNumerical discretization. Discretize $\\Gamma_c$ by a polyline obtained from a uniform parametrization of the ellipse $(x(t),y(t)) = (a \\cos t, b \\sin t)$ for $t \\in [0, 2\\pi)$ with $N_c$ straight elements, and discretize $\\Gamma_R$ by a polyline obtained from a uniform parametrization of the circle $(x(\\theta),y(\\theta)) = (R \\cos \\theta, R \\sin \\theta)$ for $\\theta \\in [0,2\\pi)$ with $N_R$ straight elements. Use constant basis functions on each element and collocate at element midpoints. For the single-layer operator, approximate off-diagonal interactions by the midpoint rule, and treat the self-term by evaluating the exact integral over a straight segment. Specifically, for the element $j$ of length $L_j$ with midpoint $\\mathbf{y}_j$, and a collocation point $\\mathbf{x}_i$ on element $i \\neq j$, approximate\n$$\n\\int_{\\Gamma_j} G(\\mathbf{x}_i,\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}} \\approx G(\\mathbf{x}_i,\\mathbf{y}_j) \\, L_j,\n$$\nwhere $G(\\mathbf{x},\\mathbf{y}) = -\\dfrac{1}{2\\pi} \\ln \\|\\mathbf{x}-\\mathbf{y}\\|$. For the diagonal entry $i=j$, use the analytic self-term for a straight segment of length $L_i$ centered at the collocation point,\n$$\n\\int_{-L_i/2}^{L_i/2} \\left(-\\dfrac{1}{2\\pi}\\right) \\ln |s| \\, \\mathrm{d}s \\;=\\; -\\dfrac{1}{2\\pi} \\left( L_i \\ln\\frac{L_i}{2} - L_i \\right).\n$$\nAssemble the dense linear system for the unknown vector of single-layer densities $\\boldsymbol{\\sigma}$ and solve it directly.\n\nElectric field evaluation and enhancement factor. The electric field is $\\mathbf{E}(\\mathbf{x}) = -\\nabla \\phi(\\mathbf{x})$. After solving for $\\boldsymbol{\\sigma}$, evaluate $\\nabla \\phi$ at a point near the forward tip of the ellipse at $(x,y) = (a+\\delta, 0)$, with a small positive offset $\\delta$ specified in the test suite. Using the constant element and midpoint approximation,\n$$\n\\nabla \\phi(\\mathbf{x}) \\approx \\sum_{j=1}^{N} \\sigma_j \\, \\left[ \\int_{\\Gamma_j} \\nabla_{\\mathbf{x}} G(\\mathbf{x},\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}} \\right] \\approx \\sum_{j=1}^{N} \\sigma_j \\, \\left( \\nabla_{\\mathbf{x}} G(\\mathbf{x},\\mathbf{y}_j) \\, L_j \\right),\n$$\nwith\n$$\n\\nabla_{\\mathbf{x}} G(\\mathbf{x},\\mathbf{y}) = -\\dfrac{1}{2\\pi} \\dfrac{\\mathbf{x}-\\mathbf{y}}{\\|\\mathbf{x}-\\mathbf{y}\\|^2}.\n$$\nCompute the enhancement factor $\\beta = \\dfrac{\\|\\mathbf{E}(a+\\delta,0)\\|}{E_0}$.\n\nTest suite. Implement the described algorithm and compute $\\beta$ for the following three parameter sets, which are designed to probe a circular inclusion, a moderately elongated ellipse, and a highly elongated ellipse, respectively. In all cases, angles are in radians, and the results are dimensionless numbers.\n\n- Case $1$ (baseline, approximately circular conductor): $a = 1.0$, $b = 1.0$, $R = 10.0$, $N_c = 120$, $N_R = 180$, $E_0 = 1.0$, $\\delta = 0.02 \\, a$.\n- Case $2$ (moderately elongated dendrite): $a = 2.0$, $b = 0.5$, $R = 12.0$, $N_c = 140$, $N_R = 200$, $E_0 = 1.0$, $\\delta = 0.02 \\, a$.\n- Case $3$ (highly elongated dendrite): $a = 3.0$, $b = 0.3$, $R = 15.0$, $N_c = 160$, $N_R = 220$, $E_0 = 1.0$, $\\delta = 0.02 \\, a$.\n\nFinal output format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the cases above, for example, $[\\beta_1,\\beta_2,\\beta_3]$. Each $\\beta_k$ must be a floating-point number.", "solution": "We start from the fundamental governing equation for a homogeneous, steady, electrostatic field in an electrolyte with no free charge, namely the Laplace equation $\\nabla^2 \\phi = 0$ within the domain $\\Omega$. The boundary is the union $\\Gamma = \\Gamma_c \\cup \\Gamma_R$, where $\\Gamma_c$ denotes the metallic inclusion (the dendrite cross-section) and $\\Gamma_R$ denotes a large artificial boundary that approximates the far-field. Dirichlet data are specified: $\\phi = 0$ on $\\Gamma_c$ because the conductor is equipotential, and $\\phi = -E_0 x$ on $\\Gamma_R$ to emulate a uniform applied field of magnitude $E_0$ aligned with the $x$-axis.\n\nPrinciple of boundary integral representation. For the two-dimensional Laplace equation, the fundamental solution (free-space Green’s function) is $G(\\mathbf{x},\\mathbf{y}) = -\\dfrac{1}{2\\pi} \\ln \\|\\mathbf{x}-\\mathbf{y}\\|$. A classical representation formula expresses the harmonic function $\\phi$ as a single-layer potential supported on the boundary,\n$$\n\\phi(\\mathbf{x}) = \\int_{\\Gamma} G(\\mathbf{x},\\mathbf{y}) \\, \\sigma(\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}}, \\quad \\mathbf{x} \\in \\Omega \\cup \\Gamma.\n$$\nFor the Dirichlet boundary-value problem on a sufficiently smooth boundary, the single-layer ansatz yields a Fredholm integral equation of the first kind for the unknown density $\\sigma$, obtained by taking the limit $\\mathbf{x} \\to \\Gamma$ from within the domain and enforcing the prescribed boundary values. The resulting equation is\n$$\n\\int_{\\Gamma} G(\\mathbf{x},\\mathbf{y}) \\, \\sigma(\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}} = f(\\mathbf{x}), \\quad \\mathbf{x} \\in \\Gamma,\n$$\nwith $f(\\mathbf{x}) = 0$ on $\\Gamma_c$ and $f(\\mathbf{x}) = -E_0 x$ on $\\Gamma_R$. For the Dirichlet problem, this operator is invertible up to technical conditions that hold for the present geometry, ensuring a unique solution $\\sigma$.\n\nDiscretization by constant elements and collocation. We partition the boundary $\\Gamma$ into $N = N_c + N_R$ straight segments. On the ellipse, we use the parametric curve $(x(t),y(t)) = (a\\cos t,b\\sin t)$ with $t \\in [0,2\\pi)$ and uniform partition into $N_c$ segments; on the circle, we use $(x(\\theta),y(\\theta)) = (R\\cos \\theta,R\\sin \\theta)$ with $\\theta \\in [0,2\\pi)$ and uniform partition into $N_R$ segments. On each segment $j$, we approximate $\\sigma$ as constant with value $\\sigma_j$ and collocate the integral equation at the segment midpoint $\\mathbf{x}_i$. For $i \\neq j$, a midpoint rule yields\n$$\n\\int_{\\Gamma_j} G(\\mathbf{x}_i,\\mathbf{y}) \\, \\sigma_j \\, \\mathrm{d}s_{\\mathbf{y}} \\approx G(\\mathbf{x}_i,\\mathbf{y}_j) \\, L_j \\, \\sigma_j,\n$$\nwhere $\\mathbf{y}_j$ is the midpoint of segment $j$ and $L_j$ is its length. For the diagonal self-term $i=j$, we evaluate the integral exactly for a straight segment centered at the collocation point. In local coordinates where the segment coincides with the $s$-axis on $s \\in [-L_i/2,L_i/2]$ and the collocation point is at $s=0$, we have\n$$\n\\int_{\\Gamma_i} G(\\mathbf{x}_i,\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}} = -\\frac{1}{2\\pi} \\int_{-L_i/2}^{L_i/2} \\ln|s| \\, \\mathrm{d}s = -\\frac{1}{2\\pi} \\left( \\int_{0}^{L_i/2} 2 \\ln s \\, \\mathrm{d}s \\right).\n$$\nUsing the antiderivative $\\int \\ln s \\, \\mathrm{d}s = s \\ln s - s$, we obtain\n$$\n\\int_{0}^{L_i/2} 2 \\ln s \\, \\mathrm{d}s = 2 \\left[ s \\ln s - s \\right]_{0}^{L_i/2} = 2 \\left( \\frac{L_i}{2} \\ln \\frac{L_i}{2} - \\frac{L_i}{2} \\right) = L_i \\ln \\frac{L_i}{2} - L_i.\n$$\nHence, the diagonal entry is\n$$\n\\int_{\\Gamma_i} G(\\mathbf{x}_i,\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}} = -\\frac{1}{2\\pi} \\left( L_i \\ln \\frac{L_i}{2} - L_i \\right).\n$$\nCollecting all entries defines a dense linear system $\\mathbf{A} \\boldsymbol{\\sigma} = \\mathbf{f}$, where\n$$\nA_{ij} = \\begin{cases}\n-\\dfrac{1}{2\\pi} \\ln \\|\\mathbf{x}_i - \\mathbf{y}_j\\| \\cdot L_j, & i \\neq j \\\\[6pt]\n-\\dfrac{1}{2\\pi} \\left( L_i \\ln \\dfrac{L_i}{2} - L_i \\right), & i = j\n\\end{cases}\n$$\nand $\\mathbf{f}$ stacks the boundary data values at the midpoints: $f(\\mathbf{x}_i) = 0$ for $\\mathbf{x}_i \\in \\Gamma_c$ and $f(\\mathbf{x}_i) = -E_0 x_i$ for $\\mathbf{x}_i \\in \\Gamma_R$. Solving this system yields the constant-element approximation of the single-layer density $\\boldsymbol{\\sigma}$.\n\nElectric field evaluation. The electric field is $\\mathbf{E} = -\\nabla \\phi$. Differentiating the single-layer potential under the integral sign gives\n$$\n\\nabla_{\\mathbf{x}} \\phi(\\mathbf{x}) = \\int_{\\Gamma} \\nabla_{\\mathbf{x}} G(\\mathbf{x},\\mathbf{y}) \\, \\sigma(\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}}, \\quad \\nabla_{\\mathbf{x}} G(\\mathbf{x},\\mathbf{y}) = -\\frac{1}{2\\pi} \\frac{\\mathbf{x}-\\mathbf{y}}{\\|\\mathbf{x}-\\mathbf{y}\\|^2}.\n$$\nUsing the constant element and midpoint approximation,\n$$\n\\nabla_{\\mathbf{x}} \\phi(\\mathbf{x}) \\approx \\sum_{j=1}^{N} \\sigma_j \\left( -\\frac{1}{2\\pi} \\frac{\\mathbf{x}-\\mathbf{y}_j}{\\|\\mathbf{x}-\\mathbf{y}_j\\|^2} \\right) L_j.\n$$\nWe evaluate this at $\\mathbf{x}_{\\mathrm{tip}} = (a+\\delta, 0)$ with a small positive $\\delta$ to avoid singular behavior exactly on the boundary. The enhancement factor is then\n$$\n\\beta = \\frac{\\|\\mathbf{E}(\\mathbf{x}_{\\mathrm{tip}})\\|}{E_0} = \\frac{\\| -\\nabla \\phi(\\mathbf{x}_{\\mathrm{tip}}) \\|}{E_0}.\n$$\n\nAlgorithmic steps integrated with principles.\n- Construct $\\Gamma_c$ and $\\Gamma_R$ by sampling $t \\in [0,2\\pi)$ and $\\theta \\in [0,2\\pi)$ uniformly with $N_c$ and $N_R$ points, respectively, forming straight segments between successive samples. Compute segment midpoints $\\mathbf{y}_j$ and lengths $L_j$.\n- Build the dense matrix $\\mathbf{A}$ using the above expressions for $A_{ij}$, with a vectorized computation for off-diagonal entries and analytic diagonal entries. Assemble the right-hand side $\\mathbf{f}$ from the prescribed boundary values.\n- Solve $\\mathbf{A} \\boldsymbol{\\sigma} = \\mathbf{f}$ using a direct linear solver.\n- Evaluate $\\nabla \\phi$ at $\\mathbf{x}_{\\mathrm{tip}}$ via the midpoint quadrature formula and compute $\\beta$.\n- Repeat for each test case.\n\nValidation expectations. For the circular inclusion case $a=b$, classical potential theory for a cylindrical conductor in a uniform field implies a surface field magnitude approximately $2 E_0$ at the forward pole, so a computed $\\beta$ close to $2$ indicates the implementation is consistent. Increasing aspect ratio $a/b$ sharpens the tip and increases $\\beta$, consistent with field enhancement at sharp conductors.\n\nThe program will output a single line in the format $[\\beta_1,\\beta_2,\\beta_3]$, where each $\\beta_k$ is the computed floating-point enhancement factor for the corresponding test case.", "answer": "```python\nimport numpy as np\n\ndef discretize_ellipse(a, b, N):\n    # Uniform parameterization in radians\n    t = np.linspace(0.0, 2.0*np.pi, N+1)\n    x = a * np.cos(t)\n    y = b * np.sin(t)\n    # Segment endpoints\n    x0, y0 = x[:-1], y[:-1]\n    x1, y1 = x[1:], y[1:]\n    # Midpoints and lengths\n    cx = 0.5 * (x0 + x1)\n    cy = 0.5 * (y0 + y1)\n    lengths = np.sqrt((x1 - x0)**2 + (y1 - y0)**2)\n    centers = np.column_stack((cx, cy))\n    return centers, lengths\n\ndef discretize_circle(R, N):\n    theta = np.linspace(0.0, 2.0*np.pi, N+1)\n    x = R * np.cos(theta)\n    y = R * np.sin(theta)\n    x0, y0 = x[:-1], y[:-1]\n    x1, y1 = x[1:], y[1:]\n    cx = 0.5 * (x0 + x1)\n    cy = 0.5 * (y0 + y1)\n    lengths = np.sqrt((x1 - x0)**2 + (y1 - y0)**2)\n    centers = np.column_stack((cx, cy))\n    return centers, lengths\n\ndef assemble_single_layer_matrix(centers, lengths):\n    # centers: (N,2), lengths: (N,)\n    X = centers[:, 0][:, None]\n    Y = centers[:, 1][:, None]\n    dX = X - X.T\n    dY = Y - Y.T\n    r = np.sqrt(dX**2 + dY**2)\n    # Avoid log(0) on diagonal temporarily\n    np.fill_diagonal(r, 1.0)\n    G = -(1.0/(2.0*np.pi)) * np.log(r)\n    # Multiply each column by source element length\n    A = G * lengths[None, :]\n    # Replace diagonal with analytic self-term\n    diag = -(1.0/(2.0*np.pi)) * (lengths * (np.log(lengths/2.0) - 1.0))\n    np.fill_diagonal(A, diag)\n    return A\n\ndef solve_bem_beta(a, b, R, Nc, NR, E0, delta_frac):\n    # Discretize boundaries\n    c_centers, c_lengths = discretize_ellipse(a, b, Nc)\n    R_centers, R_lengths = discretize_circle(R, NR)\n    centers = np.vstack((c_centers, R_centers))\n    lengths = np.concatenate((c_lengths, R_lengths))\n    N = centers.shape[0]\n    # Boundary data f: 0 on conductor, -E0*x on outer boundary\n    f_conductor = np.zeros(Nc)\n    f_outer = -E0 * R_centers[:, 0]\n    f = np.concatenate((f_conductor, f_outer))\n    # Assemble matrix and solve\n    A = assemble_single_layer_matrix(centers, lengths)\n    sigma = np.linalg.solve(A, f)\n    # Evaluate gradient at tip point (a+delta, 0)\n    delta = delta_frac * a\n    x_eval = np.array([a + delta, 0.0])\n    dx = x_eval[0] - centers[:, 0]\n    dy = x_eval[1] - centers[:, 1]\n    r2 = dx*dx + dy*dy\n    # Gradient of Green's function wrt field point: -(1/(2π)) * (r_vec)/|r|^2\n    factor = -(1.0/(2.0*np.pi))\n    # Weighted by element lengths and densities\n    w = sigma * lengths\n    grad_phi_x = np.sum(w * factor * (dx / r2))\n    grad_phi_y = np.sum(w * factor * (dy / r2))\n    Ex = -grad_phi_x\n    Ey = -grad_phi_y\n    E_mag = np.sqrt(Ex*Ex + Ey*Ey)\n    beta = E_mag / E0\n    return beta\n\ndef solve():\n    # Test cases: (a, b, R, Nc, NR, E0, delta_frac)\n    test_cases = [\n        (1.0, 1.0, 10.0, 120, 180, 1.0, 0.02),\n        (2.0, 0.5, 12.0, 140, 200, 1.0, 0.02),\n        (3.0, 0.3, 15.0, 160, 220, 1.0, 0.02),\n    ]\n\n    results = []\n    for case in test_cases:\n        a, b, R, Nc, NR, E0, delta_frac = case\n        beta = solve_bem_beta(a, b, R, Nc, NR, E0, delta_frac)\n        results.append(beta)\n\n    # Print in required single-line format\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2377246"}]}