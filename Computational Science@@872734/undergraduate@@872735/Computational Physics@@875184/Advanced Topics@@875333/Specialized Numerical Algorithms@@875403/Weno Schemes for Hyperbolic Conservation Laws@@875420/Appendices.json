{"hands_on_practices": [{"introduction": "The core strength of a Weighted Essentially Non-Oscillatory (WENO) scheme is its ability to automatically use a high-order, centered-like stencil in smooth regions while switching to a lower-order, upwind-biased stencil to avoid oscillations near discontinuities. This exercise provides a hands-on look at this fundamental mechanism. By calculating the nonlinear weights across a simple step-function, you will directly observe how the scheme penalizes stencils that cross the shock and selects the smoothest available data for reconstruction [@problem_id:2450629].", "problem": "Consider the scalar hyperbolic conservation law $u_{t} + f(u)_{x} = 0$ with linear advection flux $f(u) = a u$, where $a > 0$ is a constant advection speed. You will analyze the behavior of the nonlinear weights $\\omega_{k}$ in the fifth-order Weighted Essentially Non-Oscillatory (WENO) reconstruction of Jiang–Shu for the left-biased interface value, applied to a discontinuous initial condition. The purpose is to determine how $\\omega_{k}$ behave as a function of the grid resolution $\\Delta x$ as the mesh is refined across a discontinuity.\n\nYou must use the following fundamental setup and assumptions, which are standard in computational physics for hyperbolic conservation laws:\n- Use the scalar advection equation $u_{t} + a u_{x} = 0$ with $a > 0$ and the left-biased fifth-order WENO reconstruction (the Jiang–Shu formulation) for the interfacial state at $x_{i+\\frac{1}{2}}$.\n- The nonlinear weights $\\omega_{k}$ are computed from smoothness indicators that penalize stencils crossing discontinuities and favor stencils that are locally smooth, with a small positive parameter $\\varepsilon$ to avoid division by zero and an exponent $p$ to control sensitivity.\n- The linear weights $d_{k}$ sum to $1$ and correspond to the optimal linear fifth-order scheme in smooth regions.\n\nDefine the initial data to be a Riemann step:\n- $u(x) = 0$ for $x  0$, $u(x) = 1$ for $x > 0$, and $u(0) = \\frac{1}{2}$.\n\nAdopt a uniform nodal grid defined by\n- $x_{j} = \\left(j + \\frac{1}{2}\\right)\\Delta x$, where $j \\in \\mathbb{Z}$ and $\\Delta x > 0$, so that interfaces are located at $x = m \\Delta x$ for any integer $m$.\n- For each chosen interface location $x = m \\Delta x$, reconstruct the left-biased fifth-order WENO value at that interface using the five-point stencil $\\{u_{i-2}, u_{i-1}, u_{i}, u_{i+1}, u_{i+2}\\}$ with $i = m - 1$ so that the interface is $x_{i+\\frac{1}{2}} = (i+1)\\Delta x = m \\Delta x$.\n- Assume $a > 0$, so the left-biased reconstruction applies. Use point values $u_{j} = u(x_{j})$.\n\nUse the standard parameters for the WENO-JS weights:\n- Linear weights $d_{0} = 0.1$, $d_{1} = 0.6$, $d_{2} = 0.3$.\n- Small parameter $\\varepsilon = 10^{-6}$.\n- Exponent $p = 2$.\n\nYour task:\n- For each test case specified below, compute the nonlinear weight vector $\\left[\\omega_{0}, \\omega_{1}, \\omega_{2}\\right]$ at the specified interface. Each $\\omega_{k}$ must be returned as a floating-point number rounded to $6$ decimal places.\n\nTest suite:\n- Use the following grid spacings $\\Delta x \\in \\{0.5, 0.25, 0.125\\}$ and interface offsets $m \\in \\{-2, 0, 1\\}$.\n- This yields $9$ test cases in the order listed below:\n    1. $(\\Delta x, m) = (0.5, -2)$\n    2. $(\\Delta x, m) = (0.25, -2)$\n    3. $(\\Delta x, m) = (0.125, -2)$\n    4. $(\\Delta x, m) = (0.5, 0)$\n    5. $(\\Delta x, m) = (0.25, 0)$\n    6. $(\\Delta x, m) = (0.125, 0)$\n    7. $(\\Delta x, m) = (0.5, 1)$\n    8. $(\\Delta x, m) = (0.25, 1)$\n    9. $(\\Delta x, m) = (0.125, 1)$\n\nImplementation notes:\n- Treat the scalar field values as pointwise samples $u_{j} = u(x_{j})$ of the discontinuous function defined above. In particular, $u(0) = \\frac{1}{2}$ is specified for completeness, but with $x_{j} = \\left(j + \\frac{1}{2}\\right)\\Delta x$ no grid node lies exactly at $x = 0$ for these test cases.\n- Use the canonical fifth-order WENO-JS smoothness indicators and weight definitions associated with the three substencils of size $3$. Do not introduce alternative smoothness indicators or mapped weights; use the original Jiang–Shu form.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets.\n- Each entry must be the list $\\left[\\omega_{0}, \\omega_{1}, \\omega_{2}\\right]$ for the corresponding test case, with each weight rounded to $6$ decimal places.\n- Concretely, the output should look like a single Python-style list of lists, for example: $[[\\omega_{0}^{(1)},\\omega_{1}^{(1)},\\omega_{2}^{(1)}],[\\omega_{0}^{(2)},\\omega_{1}^{(2)},\\omega_{2}^{(2)}],\\dots,[\\omega_{0}^{(9)},\\omega_{1}^{(9)},\\omega_{2}^{(9)}]]$.\n\nNo physical units are involved; report pure numbers. Angles are not used. Percentages are not used. The final output must be exactly one line as described above, with no additional text.", "solution": "We analyze the nonlinear weights $\\omega_{k}$ of the fifth-order Weighted Essentially Non-Oscillatory (WENO) scheme of Jiang–Shu for a scalar hyperbolic conservation law with linear advection. The fundamental base includes: the scalar advection equation $u_{t} + a u_{x} = 0$ with $a > 0$ (a hyperbolic conservation law), and the core definition of WENO-JS nonlinear weights computed from smoothness indicators that measure local variation on substencils and blend linear weights accordingly.\n\nPrinciple and definitions:\n- For $a > 0$, the left-biased reconstruction provides an approximation at interface $x_{i+\\frac{1}{2}}$ based on the five nodal values $\\{u_{i-2}, u_{i-1}, u_{i}, u_{i+1}, u_{i+2}\\}$.\n- The fifth-order WENO-JS method forms three third-degree polynomials on three substencils $S_{0} = \\{i-2,i-1,i\\}$, $S_{1} = \\{i-1,i,i+1\\}$, $S_{2} = \\{i,i+1,i+2\\}$, with associated linear weights $d_{0} = 0.1$, $d_{1} = 0.6$, $d_{2} = 0.3$ which sum to $1$.\n- The Jiang–Shu smoothness indicators $\\beta_{k}$ quantify the local smoothness on each substencil via discrete approximations of squared derivatives. The nonlinear weights are defined by\n$$\n\\alpha_{k} = \\frac{d_{k}}{(\\varepsilon + \\beta_{k})^{p}}, \\quad \\omega_{k} = \\frac{\\alpha_{k}}{\\alpha_{0} + \\alpha_{1} + \\alpha_{2}},\n$$\nwith $\\varepsilon = 10^{-6}$ and $p = 2$.\n\nGrid geometry and sampling:\n- The nodes are $x_{j} = \\left(j + \\frac{1}{2}\\right)\\Delta x$, hence interfaces are at $x = m \\Delta x$ for integer $m$, with $x_{i+\\frac{1}{2}} = (i+1)\\Delta x$ corresponding to $i = m - 1$.\n- The initial condition is the Riemann step $u(x) = 0$ for $x  0$, $u(x) = 1$ for $x > 0$, and $u(0) = \\frac{1}{2}$. For the chosen nodes $x_{j} = \\left(j + \\frac{1}{2}\\right)\\Delta x$, no node lies exactly at $x=0$, so $u(0)$ is not sampled.\n\nBehavior near the discontinuity from first principles:\n- The WENO mechanism increases the weight $\\omega_{k}$ for substencils where the solution is smooth (small $\\beta_{k}$) and decreases it for substencils crossing a discontinuity (large $\\beta_{k}$). This behavior is independent of the precise flux, provided the reconstruction direction is fixed by the sign of $a$.\n- Consider the interface at $x = 0$ corresponding to $m = 0$ and $i = -1$. The five nodes involved are at positions $x_{-3} = (-2.5)\\Delta x$, $x_{-2} = (-1.5)\\Delta x$, $x_{-1} = (-0.5)\\Delta x$, $x_{0} = (0.5)\\Delta x$, $x_{1} = (1.5)\\Delta x$. The samples are $u_{-3} = 0$, $u_{-2} = 0$, $u_{-1} = 0$, $u_{0} = 1$, $u_{1} = 1$. The leftmost substencil $S_{0} = \\{-3,-2,-1\\}$ is strictly on the left, where the data are constant; hence its smoothness indicator satisfies $\\beta_{0} = 0$. The other substencils $S_{1}$ and $S_{2}$ cross the discontinuity, and their smoothness indicators are $O(1)$ constants depending on the jump amplitude, but not on $\\Delta x$, because the samples are piecewise constant across the jump.\n- With $\\varepsilon$ fixed and very small, this yields $\\alpha_{0} = d_{0}/\\varepsilon^{p}$, which is extremely large compared to $\\alpha_{1}$ and $\\alpha_{2}$, and therefore $\\omega_{0} \\approx 1$, $\\omega_{1} \\approx 0$, $\\omega_{2} \\approx 0$. Importantly, this conclusion is independent of $\\Delta x$ because the indicators on stencils crossing the jump remain $O(1)$ under refinement and the smooth stencil indicator remains $0$ for this sampling.\n- Consider the interface at $x = \\Delta x$ corresponding to $m = 1$ and $i = 0$. The five nodes are at $x_{-2} = (-1.5)\\Delta x$, $x_{-1} = (-0.5)\\Delta x$, $x_{0} = (0.5)\\Delta x$, $x_{1} = (1.5)\\Delta x$, $x_{2} = (2.5)\\Delta x$ with samples $u_{-2} = 0$, $u_{-1} = 0$, $u_{0} = 1$, $u_{1} = 1$, $u_{2} = 1$. Now the rightmost substencil $S_{2} = \\{0,1,2\\}$ is strictly on the right smooth side; hence $\\beta_{2} = 0$ and $\\omega_{2} \\approx 1$, $\\omega_{0}, \\omega_{1} \\approx 0$, again independent of $\\Delta x$.\n- Consider a fully smooth left region at an interface far enough from the discontinuity, e.g., $x = -2\\Delta x$ with $m = -2$ and $i = -3$. The five nodes are strictly on the left of the discontinuity, so all samples are $0$ and every smoothness indicator satisfies $\\beta_{k} = 0$. In that case, the nonlinear weights reduce to the linear weights exactly:\n$$\n\\alpha_{k} = \\frac{d_{k}}{\\varepsilon^{p}}, \\quad \\sum_{k=0}^{2} \\alpha_{k} = \\frac{1}{\\varepsilon^{p}} \\sum_{k=0}^{2} d_{k} = \\frac{1}{\\varepsilon^{p}},\n$$\nso $\\omega_{k} = d_{k}$ for $k \\in \\{0,1,2\\}$, again independent of $\\Delta x$.\n\nTherefore, the theoretical expectation is that for this discontinuous initial condition and nodal sampling:\n- At $m = 0$ (interface at the discontinuity), $\\omega_{0} \\to 1$ and $\\omega_{1}, \\omega_{2} \\to 0$ independent of $\\Delta x$.\n- At $m = 1$ (interface one cell to the right), $\\omega_{2} \\to 1$ and $\\omega_{0}, \\omega_{1} \\to 0$ independent of $\\Delta x$.\n- At $m = -2$ (interface two cells to the left in a smooth region), $\\omega_{k} = d_{k}$ for all $k$, independent of $\\Delta x$.\n\nAlgorithmic design to compute the test suite:\n- For each test case $(\\Delta x, m)$, set $i = m - 1$. Form the five-point vector $\\{u_{i-2},u_{i-1},u_{i},u_{i+1},u_{i+2}\\}$ by sampling $u_{j} = u(x_{j})$ with $x_{j} = \\left(j + \\frac{1}{2}\\right)\\Delta x$ and the piecewise constant step $u(x)$ as defined.\n- Compute the Jiang–Shu smoothness indicators $(\\beta_{0},\\beta_{1},\\beta_{2})$ on the substencils $S_{0},S_{1},S_{2}$ using the standard discrete formulas based on undivided differences. These indicators are nonnegative and vanish exactly on constant data.\n- Form $\\alpha_{k} = d_{k}/(\\varepsilon + \\beta_{k})^{p}$ with $d_{0} = 0.1$, $d_{1} = 0.6$, $d_{2} = 0.3$, $\\varepsilon = 10^{-6}$, $p = 2$, then normalize to $\\omega_{k} = \\alpha_{k}/\\sum_{j=0}^{2}\\alpha_{j}$.\n- Round each $\\omega_{k}$ to $6$ decimal places for reporting.\n\nQualitative outcome and numerical values:\n- For $(\\Delta x, m) = (0.5, -2)$, $(0.25, -2)$, $(0.125, -2)$, all five points lie on the left smooth side with $u_{j} = 0$, hence $(\\omega_{0},\\omega_{1},\\omega_{2}) = (0.1, 0.6, 0.3)$ exactly after normalization, so the reported values are $[0.1, 0.6, 0.3]$.\n- For $(\\Delta x, m) = (0.5, 0)$, $(0.25, 0)$, $(0.125, 0)$, only the leftmost substencil is smooth; thus $(\\omega_{0},\\omega_{1},\\omega_{2}) \\approx (1, 0, 0)$; rounding to $6$ decimals yields $[1.0, 0.0, 0.0]$.\n- For $(\\Delta x, m) = (0.5, 1)$, $(0.25, 1)$, $(0.125, 1)$, only the rightmost substencil is smooth; thus $(\\omega_{0},\\omega_{1},\\omega_{2}) \\approx (0, 0, 1)$; rounding to $6$ decimals yields $[0.0, 0.0, 1.0]$.\n\nThese results confirm, from first principles and computation, that across a discontinuity the WENO-JS nonlinear weights saturate to those stencils that remain entirely within the smooth side, and this saturation is effectively independent of $\\Delta x$ for the given nodal sampling and fixed $\\varepsilon$. In fully smooth regions, the weights reduce to the linear weights, also independent of $\\Delta x$.", "answer": "```python\nimport numpy as np\n\ndef weno_js_weights(u_im2, u_im1, u_i, u_ip1, u_ip2, eps=1e-6, p=2):\n    \"\"\"\n    Compute WENO-JS (5th order, left-biased) nonlinear weights at an interface\n    using point values u_{i-2},...,u_{i+2}. Returns [omega0, omega1, omega2].\n    \"\"\"\n    # Smoothness indicators (Jiang–Shu) for left-biased reconstruction\n    beta0 = (13.0/12.0)*(u_im2 - 2.0*u_im1 + u_i)**2 + 0.25*(u_im2 - 4.0*u_im1 + 3.0*u_i)**2\n    beta1 = (13.0/12.0)*(u_im1 - 2.0*u_i + u_ip1)**2 + 0.25*(u_im1 - u_ip1)**2\n    beta2 = (13.0/12.0)*(u_i - 2.0*u_ip1 + u_ip2)**2 + 0.25*(3.0*u_i - 4.0*u_ip1 + u_ip2)**2\n\n    d0, d1, d2 = 0.1, 0.6, 0.3\n\n    alpha0 = d0 / (eps + beta0)**p\n    alpha1 = d1 / (eps + beta1)**p\n    alpha2 = d2 / (eps + beta2)**p\n\n    asum = alpha0 + alpha1 + alpha2\n    omega0 = alpha0 / asum\n    omega1 = alpha1 / asum\n    omega2 = alpha2 / asum\n    return [omega0, omega1, omega2]\n\ndef step_ic(x):\n    # u(x) = 0 for x0, 1 for x0, 0.5 for x==0\n    if x  0.0:\n        return 1.0\n    elif x  0.0:\n        return 0.0\n    else:\n        return 0.5\n\ndef weights_for_case(dx, m):\n    \"\"\"\n    Nodes: x_j = (j + 0.5) * dx\n    Interface at x = m * dx corresponds to i = m - 1, interface is between i and i+1.\n    Left-biased WENO uses stencil u_{i-2},...,u_{i+2}.\n    \"\"\"\n    i = m - 1\n    # Collect nodal values u_{i-2} ... u_{i+2}\n    us = []\n    for j in range(i-2, i+3):\n        xj = (j + 0.5) * dx\n        us.append(step_ic(xj))\n    omega = weno_js_weights(us[0], us[1], us[2], us[3], us[4])\n    # Round to 6 decimals as required\n    omega = [float(f\"{w:.6f}\") for w in omega]\n    return omega\n\ndef solve():\n    # Define the test cases from the problem statement: 9 cases\n    dxs = [0.5, 0.25, 0.125]\n    ms = [-2, 0, 1]\n    test_cases = []\n    # Order: for each m in [-2,0,1], sweep dxs in order listed to match the problem ordering\n    # The problem lists in blocks: (dx,-2) for all dxs, then (dx,0), then (dx,1).\n    for m in [-2, 0, 1]:\n        for dx in [0.5, 0.25, 0.125]:\n            test_cases.append((dx, m))\n\n    results = []\n    for dx, m in test_cases:\n        omega = weights_for_case(dx, m)\n        results.append(omega)\n\n    # Final print statement: a single line list of lists\n    # Format exactly as a Python-style list of lists with commas.\n    inner = \",\".join(\"[\" + \",\".join(str(v) for v in trip) + \"]\" for trip in results)\n    print(f\"[{inner}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2450629"}, {"introduction": "While WENO schemes are designed for high-order accuracy in smooth regions, their performance can degrade at specific \"critical points\" where derivatives of the solution vanish. This analytical exercise challenges you to explore such a scenario, where $u'(x) = u''(x) = 0$ but $u'''(x) \\neq 0$. By performing a Taylor series analysis of the smoothness indicators, you will uncover why the standard Jiang-Shu WENO-5 formulation drops to third-order accuracy at these locations, a crucial insight into the scheme's limitations [@problem_id:2450599].", "problem": "Consider the one-dimensional linear advection equation $u_{t} + a\\,u_{x} = 0$ with constant advection speed $a > 0$ on a uniform grid with spacing $\\Delta x$. Focus on the spatial reconstruction of the left state at the interface $x_{i+\\frac{1}{2}}$ using the fifth-order Weighted Essentially Non-Oscillatory (WENO-$5$) scheme of Jiang and Shu. For $a>0$, the upwind-biased third-order candidate reconstructions at $x_{i+\\frac{1}{2}}$ are\n$$\np_{0} = \\frac{1}{3}u_{i-2} - \\frac{7}{6}u_{i-1} + \\frac{11}{6}u_{i},\\quad\np_{1} = -\\frac{1}{6}u_{i-1} + \\frac{5}{6}u_{i} + \\frac{1}{3}u_{i+1},\\quad\np_{2} = \\frac{1}{3}u_{i} + \\frac{5}{6}u_{i+1} - \\frac{1}{6}u_{i+2}.\n$$\nThe linear weights are\n$$\nd_{0} = \\frac{1}{10},\\quad d_{1} = \\frac{6}{10},\\quad d_{2} = \\frac{3}{10}.\n$$\nThe smoothness indicators (Jiang–Shu) are\n$$\n\\beta_{0} = \\frac{13}{12}\\left(u_{i-2} - 2u_{i-1} + u_{i}\\right)^{2} + \\frac{1}{4}\\left(u_{i-2} - 4u_{i-1} + 3u_{i}\\right)^{2},\n$$\n$$\n\\beta_{1} = \\frac{13}{12}\\left(u_{i-1} - 2u_{i} + u_{i+1}\\right)^{2} + \\frac{1}{4}\\left(u_{i-1} - u_{i+1}\\right)^{2},\n$$\n$$\n\\beta_{2} = \\frac{13}{12}\\left(u_{i} - 2u_{i+1} + u_{i+2}\\right)^{2} + \\frac{1}{4}\\left(3u_{i} - 4u_{i+1} + u_{i+2}\\right)^{2}.\n$$\nThe nonlinear weights are defined by\n$$\n\\alpha_{k} = \\frac{d_{k}}{\\left(\\epsilon + \\beta_{k}\\right)^{r}},\\quad \\omega_{k} = \\frac{\\alpha_{k}}{\\alpha_{0} + \\alpha_{1} + \\alpha_{2}},\n$$\nwith $r=2$ and $\\epsilon=0$. The reconstructed left state at the interface is\n$$\nu_{i+\\frac{1}{2}}^{\\text{WENO}} = \\omega_{0} p_{0} + \\omega_{1} p_{1} + \\omega_{2} p_{2}.\n$$\nAssume $u(x)$ is smooth and satisfies $u'(x_{i}) = 0$, $u''(x_{i}) = 0$, and $u^{(3)}(x_{i}) \\neq 0$. Let the local truncation error of the reconstruction be written as\n$$\nu_{i+\\frac{1}{2}}^{\\text{WENO}} - u\\left(x_{i+\\frac{1}{2}}\\right) = \\mathcal{O}(\\Delta x^{p})\n$$\nfor some integer $p \\ge 1$. Determine the integer $p$. Express your answer as a single integer with no units.", "solution": "The problem requires determining the order of accuracy $p$ of a fifth-order Weighted Essentially Non-Oscillatory (WENO-5) reconstruction at an interface $x_{i+\\frac{1}{2}}$, given that the underlying smooth function $u(x)$ satisfies $u'(x_{i}) = 0$, $u''(x_{i}) = 0$, and $u^{(3)}(x_{i}) \\neq 0$.\n\nFirst, we must clarify the nature of the values $\\{u_j\\}$. The provided formulas for the candidate reconstructions,\n$$\np_{0} = \\frac{1}{3}u_{i-2} - \\frac{7}{6}u_{i-1} + \\frac{11}{6}u_{i},\n$$\n$$\np_{1} = -\\frac{1}{6}u_{i-1} + \\frac{5}{6}u_{i} + \\frac{1}{3}u_{i+1},\n$$\n$$\np_{2} = \\frac{1}{3}u_{i} + \\frac{5}{6}u_{i+1} - \\frac{1}{6}u_{i+2},\n$$\nare the standard formulas for reconstructing the value $u(x_{i+1/2})$ from cell averages $u_j = \\frac{1}{\\Delta x} \\int_{x_{j-1/2}}^{x_{j+1/2}} u(\\xi) d\\xi$. The use of $u_j$ to denote cell averages is conventional in the literature on finite volume methods, although it creates ambiguity when properties are given for the point values of a function $u(x)$. We will proceed under the assumption that $u_j$ are cell averages, which makes the problem formulation consistent with the established theory of WENO schemes.\n\nThe order of accuracy is determined by the local truncation error, $u_{i+1/2}^{\\text{WENO}} - u(x_{i+1/2})$. We perform Taylor series expansions of all quantities around the point $x_i$, with grid spacing $\\Delta x$. Let $u^{(n)}_i = u^{(n)}(x_i)$. The given conditions are $u^{(1)}_i = 0$, $u^{(2)}_i = 0$, and $u^{(3)}_i \\neq 0$.\n\nThe analysis proceeds in three steps:\n1.  Determine the asymptotic behavior of the smoothness indicators $\\beta_k$ as $\\Delta x \\to 0$.\n2.  Analyze the resulting nonlinear weights $\\omega_k$.\n3.  Evaluate the truncation error of the full reconstruction $u_{i+1/2}^{\\text{WENO}} = \\sum_k \\omega_k p_k$.\n\nWe begin by expanding the finite difference terms present in the smoothness indicators. For a smooth function $u(x)$, we have the centered differences:\n$$\nu_{j-1} - 2u_j + u_{j+1} = (\\Delta x)^2 u''(x_j) + \\frac{(\\Delta x)^4}{12}u^{(4)}(x_j) + \\mathcal{O}(\\Delta x^6)\n$$\n$$\nu_{j-1} - u_{j+1} = -2\\Delta x u'(x_j) - \\frac{(\\Delta x)^3}{3}u^{(3)}(x_j) + \\mathcal{O}(\\Delta x^5)\n$$\nThese must be interpreted as differences of cell averages. In the specific case where $u'_i=u''_i=0$, the relationship between the cell average $u_j$ and the point value $u(x_j)$ simplifies analysis. However, a more direct expansion of the discrete operators on the point values $u(x_j)$ is more straightforward and reveals the essential behavior. Let's analyze the problem using point values $u_j=u(x_j)$ and the provided formulae for $p_k$ and $\\beta_k$. The core behavior at the critical point is driven by the structure of the smoothness indicators, which will be similar regardless of the interpretation of $u_j$. The use of cell averages leads to the same order of accuracy, albeit through more complex intermediate calculations. Let $u_j = u(x_i + (j-i)\\Delta x)$.\n\nThe Taylor expansion around $x_i$ is $u(x_i + \\delta) = u_i + \\frac{u_i^{(3)}}{6}\\delta^3 + \\frac{u_i^{(4)}}{24}\\delta^4 + \\mathcal{O}(\\delta^5)$.\n\nLet's analyze the smoothness indicators $\\beta_k$ with $u_j = u(x_j)$:\nFor $\\beta_1 = \\frac{13}{12}\\left(u_{i-1} - 2u_{i} + u_{i+1}\\right)^{2} + \\frac{1}{4}\\left(u_{i-1} - u_{i+1}\\right)^{2}$:\nThe first term is $u_{i-1} - 2u_i + u_{i+1} = (\\Delta x)^2 u''_i + \\frac{(\\Delta x)^4}{12}u^{(4)}_i + \\mathcal{O}(\\Delta x^6) = \\frac{(\\Delta x)^4}{12}u^{(4)}_i + \\mathcal{O}(\\Delta x^6)$.\nThe second term is $u_{i-1} - u_{i+1} = -2\\Delta x u'_i - \\frac{(\\Delta x)^3}{3}u^{(3)}_i + \\mathcal{O}(\\Delta x^5) = -\\frac{(\\Delta x)^3}{3}u^{(3)}_i + \\mathcal{O}(\\Delta x^5)$.\nThe squares are $(\\frac{(\\Delta x)^4}{12}u^{(4)}_i)^2 = \\mathcal{O}(\\Delta x^8)$ and $(-\\frac{(\\Delta x)^3}{3}u^{(3)}_i)^2 = \\mathcal{O}(\\Delta x^6)$.\nSince $u^{(3)}_i \\neq 0$, the dominant term in $\\beta_1$ comes from $(u_{i-1}-u_{i+1})^2$.\n$$\n\\beta_1 = \\frac{1}{4} \\left(-\\frac{(\\Delta x)^3}{3}u^{(3)}_i\\right)^2 + \\mathcal{O}(\\Delta x^7) = \\frac{1}{36}\\left(u^{(3)}_i\\right)^2 (\\Delta x)^6 + \\mathcal{O}(\\Delta x^7).\n$$\nFor $\\beta_0 = \\frac{13}{12}\\left(u_{i-2} - 2u_{i-1} + u_{i}\\right)^{2} + \\frac{1}{4}\\left(u_{i-2} - 4u_{i-1} + 3u_{i}\\right)^{2}$:\nThe first term $u_{i-2} - 2u_{i-1} + u_i$ is a second difference centered at $x_{i-1}$.\n$u_{i-2} - 2u_{i-1} + u_i = (\\Delta x)^2 u''_{i-1} + \\mathcal{O}(\\Delta x^4) = (\\Delta x)^2 (u''_i - \\Delta x u^{(3)}_i + \\dots) = -(\\Delta x)^3 u^{(3)}_i + \\mathcal{O}(\\Delta x^4)$.\nThe second term $u_{i-2} - 4u_{i-1} + 3u_i$ can be expanded as:\n$u_{i-2}=u_i-\\frac{8}{6}(\\Delta x)^3u_i^{(3)}+\\mathcal{O}(\\Delta x^4)$ and $u_{i-1}=u_i-\\frac{1}{6}(\\Delta x)^3u_i^{(3)}+\\mathcal{O}(\\Delta x^4)$.\n$u_{i-2} - 4u_{i-1} + 3u_i = (u_i - \\frac{8}{6}(\\Delta x)^3 u_i^{(3)}) - 4(u_i - \\frac{1}{6}(\\Delta x)^3 u_i^{(3)}) + 3u_i + \\mathcal{O}(\\Delta x^4) = (-\\frac{8}{6}+\\frac{4}{6})(\\Delta x)^3 u_i^{(3)} + \\mathcal{O}(\\Delta x^4) = -\\frac{2}{3}(\\Delta x)^3 u_i^{(3)} + \\mathcal{O}(\\Delta x^4)$.\nThus, both terms in $\\beta_0$ are of order $(\\Delta x^3)^2 = \\Delta x^6$.\n$$\n\\beta_0 = \\left(\\frac{13}{12}(-1)^2 + \\frac{1}{4}(-\\frac{2}{3})^2\\right) \\left(u_i^{(3)}\\right)^2 (\\Delta x)^6 + \\mathcal{O}(\\Delta x^7) = \\left(\\frac{13}{12}+\\frac{1}{9}\\right)\\left(u_i^{(3)}\\right)^2 (\\Delta x)^6 = \\frac{43}{36}\\left(u_i^{(3)}\\right)^2 (\\Delta x)^6 + \\mathcal{O}(\\Delta x^7).\n$$\nBy symmetry, $\\beta_2$ has the same leading-order behavior as $\\beta_0$.\n$$\n\\beta_2 = \\frac{43}{36}\\left(u_i^{(3)}\\right)^2 (\\Delta x)^6 + \\mathcal{O}(\\Delta x^7).\n$$\nAll three smoothness indicators are of the same order, $\\mathcal{O}(\\Delta x^6)$. The nonlinear weights are $\\alpha_k = \\frac{d_k}{(\\epsilon+\\beta_k)^r}$. With $\\epsilon=0$ and $r=2$:\n$$\n\\alpha_k = \\frac{d_k}{\\beta_k^2} \\propto \\frac{d_k}{(C_k (\\Delta x)^6)^2} = \\frac{d_k}{C_k^2 (\\Delta x)^{12}}.\n$$\nThe weights $\\omega_k = \\frac{\\alpha_k}{\\sum_j \\alpha_j}$ are independent of $\\Delta x$ at leading order:\n$$\n\\omega_k = \\frac{d_k/C_k^2}{\\sum_j d_j/C_j^2}.\n$$\nHere, $C_0 = C_2 = \\frac{43}{36}(u_i^{(3)})^2$ and $C_1 = \\frac{1}{36}(u_i^{(3)})^2$. The $\\omega_k$ are constants for small $\\Delta x$, but they are not equal to the linear weights $d_k$ because the constants $C_k$ are not all equal ($C_0=C_2 \\neq C_1$).\nThe WENO reconstruction becomes, for small $\\Delta x$, a fixed-stencil linear scheme:\n$$\nu_{i+1/2}^{\\text{WENO}} \\approx \\sum_{k=0}^2 \\omega_k p_k\n$$\nwhere $\\omega_k$ are constants. The error is then:\n$u_{i+1/2}^{\\text{WENO}} - u(x_{i+1/2}) = \\sum_{k=0}^2 \\omega_k p_k - u(x_{i+1/2}) = \\sum_{k=0}^2 \\omega_k (p_k - u(x_{i+1/2}))$.\n\nEach candidate reconstruction $p_k$ comes from a third-order stencil. Let's analyze the error of one such reconstruction, for example $p_1$, using the provided coefficients and assuming $u_j=u(x_j)$.\n$p_1 = -\\frac{1}{6}u_{i-1} + \\frac{5}{6}u_i + \\frac{1}{3}u_{i+1}$. Expanding around $x_i$:\n$p_1 = u_i(-\\frac{1}{6}+\\frac{5}{6}+\\frac{1}{3}) + u_i^{(3)}(\\Delta x)^3(\\frac{1}{36} + \\frac{1}{18}) + \\mathcal{O}(\\Delta x^4) = u_i + \\frac{1}{12}u_i^{(3)}(\\Delta x)^3 + \\mathcal{O}(\\Delta x^4)$.\nThe true value is $u(x_{i+1/2}) = u(x_i + \\frac{\\Delta x}{2}) = u_i + \\frac{u^{(3)}_i}{6}(\\frac{\\Delta x}{2})^3 + \\mathcal{O}(\\Delta x^4) = u_i + \\frac{1}{48}u_i^{(3)}(\\Delta x)^3 + \\mathcal{O}(\\Delta x^4)$.\nThe error of the reconstruction $p_1$ is:\n$$\np_1 - u(x_{i+1/2}) = \\left(\\frac{1}{12} - \\frac{1}{48}\\right) u_i^{(3)}(\\Delta x)^3 + \\mathcal{O}(\\Delta x^4) = \\frac{1}{16}u_i^{(3)}(\\Delta x)^3 + \\mathcal{O}(\\Delta x^4).\n$$\nSince $u_i^{(3)} \\neq 0$, the error is of order $(\\Delta x)^3$. Similarly, one can show that $p_0$ and $p_2$ also have errors of order $(\\Delta x)^3$.\nThe total error is a linear combination of these $\\mathcal{O}(\\Delta x^3)$ errors with constant coefficients $\\omega_k$. This linear combination is in general of order $(\\Delta x)^3$, unless the coefficients lead to a cancellation of the leading error term. Such a cancellation is not guaranteed and does not occur here. The scheme thus falls to third-order accuracy.\n\nTherefore, the integer $p$ is $3$.", "answer": "$$\n\\boxed{3}\n$$", "id": "2450599"}, {"introduction": "The robustness of WENO schemes comes at a high computational cost, making them inefficient for problems that are mostly smooth. This practice guides you through the implementation of a more practical, efficient hybrid scheme that combines the best of both worlds. You will develop a solver that uses a simple, fast linear high-order method by default, but intelligently switches to the more expensive WENO reconstruction only in regions where a special \"smoothness sensor\" detects a potential discontinuity [@problem_id:2450580].", "problem": "You are to design and implement a complete, runnable program that solves a one-dimensional hyperbolic conservation law with a hybrid high-order spatial discretization. The hybrid approach must use a cheap linear high-order finite-volume method in smooth regions and switch to a fifth-order Weighted Essentially Non-Oscillatory (WENO) scheme only near detected discontinuities. The governing equation is the linear advection equation\n$$\n\\partial_t u(x,t) + \\partial_x f(u(x,t)) = 0, \\quad f(u) = a\\,u,\n$$\non the periodic domain $[0,1)$, where $a$ is a constant advection speed. The task must be derived from the following fundamental base: (i) the conservation law definition, (ii) finite-volume discretization on a uniform mesh, (iii) upwinding consistent with the sign of $a$, and (iv) strong stability preserving time stepping.\n\nYour implementation must satisfy the following requirements.\n\n1. Spatial discretization and fluxes:\n- Use a uniform grid with $N$ cells, cell centers $x_i$ for $i=0,\\dots,N-1$, and mesh width $\\Delta x = 1/N$. Apply periodic boundary conditions.\n- Use a finite-volume update for cell averages $u_i(t)$,\n$$\n\\frac{d u_i}{d t} = - \\frac{F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}}{\\Delta x},\n$$\nwhere $F_{i+\\frac{1}{2}}$ is a consistent numerical flux at the interface $x_{i+\\frac{1}{2}}$.\n- For $a>0$, use upwinding from the left: $F_{i+\\frac{1}{2}} = a\\,u_{i+\\frac{1}{2}}^{-}$. For $a0$, use upwinding from the right: $F_{i+\\frac{1}{2}} = a\\,u_{i+\\frac{1}{2}}^{+}$. Here $u_{i+\\frac{1}{2}}^{-}$ (left state) and $u_{i+\\frac{1}{2}}^{+}$ (right state) are reconstructions from neighboring cell averages.\n\n2. Hybrid reconstruction:\n- At each face $x_{i+\\frac{1}{2}}$, decide between a cheap linear fifth-order upwind reconstruction and a fifth-order WENO reconstruction by means of a smoothness sensor.\n- Define the smoothness sensor at cell $i$ by\n$$\nS_i = \\frac{\\left|\\Delta^2 u_i\\right|}{\\left|\\Delta^{+} u_i\\right| + \\left|\\Delta^{-} u_i\\right| + \\varepsilon_s},\n$$\nwith $\\Delta^{+} u_i = u_{i+1} - u_i$, $\\Delta^{-} u_i = u_i - u_{i-1}$, and $\\Delta^2 u_i = u_{i+1} - 2u_i + u_{i-1}$. Use periodic indexing for $u_{i\\pm 1}$.\n- Define a face sensor at $x_{i+\\frac{1}{2}}$ as $S_{i+\\frac{1}{2}} = \\max(S_i, S_{i+1})$.\n- Use a threshold $\\tau = C_{\\tau}\\Delta x$, where $C_{\\tau}$ is a fixed constant. If $S_{i+\\frac{1}{2}} > \\tau$, use the WENO reconstruction at that face, otherwise use the linear fifth-order upwind reconstruction at that face.\n- Use a small $\\varepsilon_s$ to avoid division by zero in the sensor; choose a constant value that is independent of the grid and time.\n\n3. Time integration:\n- Advance in time using the third-order Strong Stability Preserving Runge–Kutta scheme (SSP-RK3) with time step $\\Delta t$ determined by a Courant–Friedrichs–Lewy (CFL) condition\n$$\n\\Delta t = \\text{CFL} \\cdot \\frac{\\Delta x}{|a|},\n$$\nand adjust the final time step so that the solution is advanced exactly to the final time for each test case.\n\n4. Test suite and outputs:\nRun your solver on the three test cases below. In all cases, the domain is periodic on $[0,1)$ and angles are in radians. There are no physical unit conversions required; report the requested values as dimensionless real numbers.\n\n- Test case A (smooth advection accuracy):\n  - Parameters: $a = 1$, $N = 200$, $\\text{CFL} = 0.45$, $t_{\\text{final}} = 0.25$, $C_{\\tau} = 1$, $\\varepsilon_s = 10^{-12}$.\n  - Initial condition: $u(x,0) = \\sin(2\\pi x)$.\n  - Exact solution: $u(x,t) = \\sin(2\\pi(x - a t))$.\n  - Output: the $L^1$ error\n    $$\n    E_1 = \\sum_{i=0}^{N-1} |u_i^{\\text{num}}(t_{\\text{final}}) - u_i^{\\text{exact}}(t_{\\text{final}})| \\Delta x.\n    $$\n\n- Test case B (hybrid switching near discontinuities):\n  - Parameters: $a = 1$, $N = 200$, $\\text{CFL} = 0.45$, $t_{\\text{final}} = 0.50$, $C_{\\tau} = 1$, $\\varepsilon_s = 10^{-12}$.\n  - Initial condition: \n    $$\n    u(x,0) = \\chi_{[0.1,\\,0.3)}(x)\\cdot 1 + 0.2\\sin(2\\pi x),\n    $$\n    where $\\chi_{[0.1,\\,0.3)}(x)$ is the indicator function equal to $1$ for $x \\in [0.1,0.3)$ (with periodic wrap on $[0,1)$) and $0$ otherwise.\n  - Exact solution: $u(x,t) = u_0(\\operatorname{mod}(x - a t, 1))$.\n  - Output: the $L^1$ error $E_2$ defined analogously to $E_1$.\n\n- Test case C (non-oscillatory property near sharp fronts):\n  - Parameters: $a = 1$, $N = 400$, $\\text{CFL} = 0.45$, $t_{\\text{final}} = 0.30$, $C_{\\tau} = 1$, $\\varepsilon_s = 10^{-12}$.\n  - Initial condition: \n    $$\n    u(x,0) = \\chi_{[0.4,\\,0.6)}(x)\\cdot 1.\n    $$\n  - Output: the overshoot magnitude\n    $$\n    O = \\max\\left( \\max_i u_i^{\\text{num}}(t_{\\text{final}}) - 1, 0 \\right) + \\max\\left( 0 - \\min_i u_i^{\\text{num}}(t_{\\text{final}}), 0 \\right).\n    $$\n\n5. Final output format:\n- Your program must produce a single line of output containing the three results as a comma-separated list enclosed in square brackets, in the order $[E_1, E_2, O]$.\n- Each number must be printed as a floating-point value rounded to eight decimal places.\n- No other text should be printed.\n\nYour program must be self-contained, use only a standard numerical library for arrays, and must not require user input. The implementation language and environment are specified in the final answer section and must be strictly followed.", "solution": "The problem presented is a well-defined task in computational physics, specifically the numerical solution of the one-dimensional linear advection equation using a hybrid high-order finite-volume method. The problem statement is scientifically sound, internally consistent, and provides sufficient detail to construct a unique algorithmic solution. All components—the governing equation, the numerical schemes (finite volume, linear fifth-order, WENO5, SSP-RK3), the hybrid switching logic, and the test cases—are standard and well-established in the field of numerical methods for partial differential equations. The problem is deemed valid and a solution will be provided.\n\nThe problem requires the implementation of a hybrid scheme for the linear advection equation:\n$$\n\\partial_t u + a \\partial_x u = 0, \\quad x \\in [0, 1)\n$$\nwith periodic boundary conditions. Here, $u(x,t)$ is the conserved quantity and $a$ is the constant advection speed. All test cases use $a>0$, so for brevity we will only detail the implementation for this case. The extension to $a0$ is symmetric.\n\nWe employ a finite-volume method on a uniform grid with $N$ cells, cell width $\\Delta x = 1/N$, and cell centers $x_i = (i+0.5)\\Delta x$ for $i=0, \\dots, N-1$. The semi-discretized form for the cell-average $u_i(t)$ is:\n$$\n\\frac{d u_i}{d t} = L(u)_i = - \\frac{F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}}{\\Delta x}\n$$\nHere, $F_{i+\\frac{1}{2}}$ is the numerical flux at the interface between cell $i$ and cell $i+1$. Since $a>0$, we use upwinding from the left, meaning the flux depends on the state reconstructed at the left of the interface, denoted $u_{i+\\frac{1}{2}}^{-}$. The flux is given by:\n$$\nF_{i+\\frac{1}{2}} = a \\, u_{i+\\frac{1}{2}}^{-}\n$$\nThe core of the method lies in the hybrid reconstruction of $u_{i+\\frac{1}{2}}^{-}$ from the cell averages $\\{u_j\\}$.\n\nThe choice between a computationally inexpensive linear scheme and a robust WENO scheme is made locally at each interface $x_{i+\\frac{1}{2}}$ based on a smoothness sensor. The sensor for cell $i$ is defined as:\n$$\nS_i = \\frac{\\left|\\Delta^2 u_i\\right|}{\\left|\\Delta^{+} u_i\\right| + \\left|\\Delta^{-} u_i\\right| + \\varepsilon_s}\n$$\nwhere $\\Delta^{+} u_i = u_{i+1} - u_i$, $\\Delta^{-} u_i = u_i - u_{i-1}$, and $\\Delta^2 u_i = u_{i+1} - 2u_i + u_{i-1}$ are finite difference operators. Periodic boundary conditions are applied for indices outside of the range $[0, N-1]$. The term $\\varepsilon_s$ is a small positive constant to prevent division by zero. The sensor at the interface is taken as the maximum of the sensors of the two adjacent cells:\n$$\nS_{i+\\frac{1}{2}} = \\max(S_i, S_{i+1})\n$$\nA threshold $\\tau = C_{\\tau} \\Delta x$ is used. If $S_{i+\\frac{1}{2}} > \\tau$, the solution is deemed non-smooth near the interface, and the fifth-order WENO reconstruction is used. Otherwise, the fifth-order linear upwind reconstruction is used.\n\n**1. Fifth-Order Linear Upwind Reconstruction**\nFor smooth regions, we use a standard fifth-order accurate reconstruction for $u_{i+\\frac{1}{2}}^{-}$ based on a five-point stencil $\\{u_{i-2}, u_{i-1}, u_i, u_{i+1}, u_{i+2}\\}$. The formula is:\n$$\nu_{i+\\frac{1}{2}}^{-, \\text{lin}} = \\frac{1}{60} (2 u_{i-2} - 13 u_{i-1} + 47 u_i + 27 u_{i+1} - 3 u_{i+2})\n$$\n\n**2. Fifth-Order WENO Reconstruction**\nNear discontinuities, we use the fifth-order Weighted Essentially Non-Oscillatory (WENO) scheme (WENO5-JS) to compute $u_{i+\\frac{1}{2}}^{-}$. This scheme combines three third-order reconstructions from three-point sub-stencils in a nonlinear fashion to avoid oscillations. The sub-stencils are $S_0=\\{u_{i-2}, u_{i-1}, u_i\\}$, $S_1=\\{u_{i-1}, u_i, u_{i+1}\\}$, and $S_2=\\{u_i, u_{i+1}, u_{i+2}\\}$.\nThe reconstructions on these sub-stencils are:\n$$\n\\begin{aligned}\nu_{i+\\frac{1}{2}}^{(0)} = \\frac{1}{6}(2u_{i-2} - 7u_{i-1} + 11u_i) \\\\\nu_{i+\\frac{1}{2}}^{(1)} = \\frac{1}{6}(-u_{i-1} + 5u_i + 2u_{i+1}) \\\\\nu_{i+\\frac{1}{2}}^{(2)} = \\frac{1}{6}(2u_i + 5u_{i+1} - u_{i+2})\n\\end{aligned}\n$$\nSmoothness indicators $\\beta_k$ are computed for each sub-stencil:\n$$\n\\begin{aligned}\n\\beta_0 = \\frac{13}{12}(u_{i-2} - 2u_{i-1} + u_i)^2 + \\frac{1}{4}(u_{i-2} - 4u_{i-1} + 3u_i)^2 \\\\\n\\beta_1 = \\frac{13}{12}(u_{i-1} - 2u_i + u_{i+1})^2 + \\frac{1}{4}(u_{i-1} - u_{i+1})^2 \\\\\n\\beta_2 = \\frac{13}{12}(u_i - 2u_{i+1} + u_{i+2})^2 + \\frac{1}{4}(3u_i - 4u_{i+1} + u_{i+2})^2\n\\end{aligned}\n$$\nNonlinear weights $\\omega_k$ are calculated using ideal weights $c_0=1/10$, $c_1=6/10$, $c_2=3/10$:\n$$\n\\alpha_k = \\frac{c_k}{(\\beta_k + \\varepsilon_w)^2}, \\quad \\omega_k = \\frac{\\alpha_k}{\\sum_{j=0}^{2} \\alpha_j}\n$$\nHere, $\\varepsilon_w$ is a small parameter to avoid division by zero. A standard value of $\\varepsilon_w = 10^{-6}$ will be used.\nThe final WENO reconstruction is the convex combination:\n$$\nu_{i+\\frac{1}{2}}^{-, \\text{weno}} = \\sum_{k=0}^{2} \\omega_k u_{i+\\frac{1}{2}}^{(k)}\n$$\n\n**3. Time Integration**\nThe system of ordinary differential equations $\\frac{d\\mathbf{u}}{dt} = \\mathbf{L}(\\mathbf{u})$ is advanced in time using the third-order Strong Stability Preserving Runge-Kutta (SSP-RK3) scheme. Given the solution $\\mathbf{u}^n$ at time $t^n$, the solution at $t^{n+1} = t^n + \\Delta t$ is found via:\n$$\n\\begin{aligned}\n\\mathbf{u}^{(1)} = \\mathbf{u}^n + \\Delta t \\mathbf{L}(\\mathbf{u}^n) \\\\\n\\mathbf{u}^{(2)} = \\frac{3}{4}\\mathbf{u}^n + \\frac{1}{4}\\mathbf{u}^{(1)} + \\frac{1}{4}\\Delta t \\mathbf{L}(\\mathbf{u}^{(1)}) \\\\\n\\mathbf{u}^{n+1} = \\frac{1}{3}\\mathbf{u}^n + \\frac{2}{3}\\mathbf{u}^{(2)} + \\frac{2}{3}\\Delta t \\mathbf{L}(\\mathbf{u}^{(2)})\n\\end{aligned}\n$$\nThe time step $\\Delta t$ is determined by the CFL condition: $\\Delta t = \\text{CFL} \\cdot \\frac{\\Delta x}{|a|}$. The final time step is adjusted to ensure the final time $t_{\\text{final}}$ is reached exactly.\n\nThe algorithm proceeds by iterating through time steps. In each step, and for each stage of the SSP-RK3 integrator, the spatial operator $\\mathbf{L}(\\mathbf{u})$ is evaluated by first computing the smoothness sensor across the grid, then selecting the appropriate reconstruction method (linear or WENO) at each cell interface to compute fluxes, and finally computing the flux divergence. The resulting solution is then used to perform the test-specific measurements.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D linear advection equation using a hybrid 5th-order\n    WENO/linear scheme with SSP-RK3 time stepping.\n    \"\"\"\n\n    test_cases = [\n        # Test Case A\n        {\n            \"id\": \"A\",\n            \"a\": 1.0, \"N\": 200, \"CFL\": 0.45, \"t_final\": 0.25, \n            \"C_tau\": 1.0, \"eps_s\": 1e-12,\n            \"u0_func\": lambda x: np.sin(2 * np.pi * x),\n            \"exact_sol_func\": lambda x, t, a, u0: u0(np.mod(x - a * t, 1.0)),\n            \"metric\": \"L1_error\"\n        },\n        # Test Case B\n        {\n            \"id\": \"B\",\n            \"a\": 1.0, \"N\": 200, \"CFL\": 0.45, \"t_final\": 0.50,\n            \"C_tau\": 1.0, \"eps_s\": 1e-12,\n            \"u0_func\": lambda x: np.where((x = 0.1)  (x  0.3), 1.0, 0.0) + 0.2 * np.sin(2 * np.pi * x),\n            \"exact_sol_func\": lambda x, t, a, u0: u0(np.mod(x - a * t, 1.0)),\n            \"metric\": \"L1_error\"\n        },\n        # Test Case C\n        {\n            \"id\": \"C\",\n            \"a\": 1.0, \"N\": 400, \"CFL\": 0.45, \"t_final\": 0.30,\n            \"C_tau\": 1.0, \"eps_s\": 1e-12,\n            \"u0_func\": lambda x: np.where((x = 0.4)  (x  0.6), 1.0, 0.0),\n            \"exact_sol_func\": None, # Not needed for overshoot\n            \"metric\": \"overshoot\"\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(case)\n        results.append(result)\n\n    results_str = [f\"{r:.8f}\" for r in results]\n    print(f\"[{','.join(results_str)}]\")\n\n\ndef get_rhs(u, a, dx, C_tau, eps_s):\n    \"\"\"\n    Computes the right-hand side of the semi-discretized advection equation\n    du/dt = L(u), using a hybrid 5th-order scheme.\n    \"\"\"\n    N = u.shape[0]\n    \n    # --- Smoothness Sensor ---\n    # Finite differences for the sensor\n    u_p1 = np.roll(u, -1)\n    u_m1 = np.roll(u, 1)\n    \n    delta_plus = u_p1 - u\n    delta_minus = u - u_m1\n    delta_2 = u_p1 - 2 * u + u_m1\n    \n    # Cell-centered sensor Si\n    sensor_i = np.abs(delta_2) / (np.abs(delta_plus) + np.abs(delta_minus) + eps_s)\n    \n    # Face-centered sensor S_{i+1/2}\n    sensor_face = np.maximum(sensor_i, np.roll(sensor_i, -1))\n    \n    # Threshold for switching\n    tau = C_tau * dx\n    \n    # --- Reconstructions (assuming a  0) ---\n    # Stencil values (periodic)\n    u_m2 = np.roll(u, 2)\n    u_p2 = np.roll(u, -2)\n    \n    # 5th-order linear reconstruction for u_{i+1/2}^-\n    u_rec_lin = (2 * u_m2 - 13 * u_m1 + 47 * u + 27 * u_p1 - 3 * u_p2) / 60.0\n\n    # 5th-order WENO reconstruction for u_{i+1/2}^-\n    # This function is written to be vectorized over the whole grid.\n    u_rec_weno = weno5_reconstruction(u, u_m1, u_m2, u_p1, u_p2)\n    \n    # --- Hybridization ---\n    # The `where` mask will be True for faces that need WENO\n    weno_mask = sensor_face  tau\n    u_rec = np.where(weno_mask, u_rec_weno, u_rec_lin)\n    \n    # --- Flux calculation and divergence ---\n    # Fluxes at faces i+1/2\n    flux = a * u_rec\n    \n    # Flux difference term -(F_{i+1/2} - F_{i-1/2}) / dx\n    flux_diff = flux - np.roll(flux, 1)\n    rhs = -flux_diff / dx\n\n    return rhs\n\ndef weno5_reconstruction(u, u_m1, u_m2, u_p1, u_p2):\n    \"\"\"\n    Computes the 5th-order WENO reconstruction u_{i+1/2}^- for a  0.\n    Vectorized for efficiency.\n    \"\"\"\n    eps_w = 1e-6 # Regularization for WENO weights\n\n    # Ideal weights\n    c0, c1, c2 = 0.1, 0.6, 0.3\n\n    # Smoothness indicators (beta_k)\n    b0 = (13./12.) * (u_m2 - 2*u_m1 + u)**2 + (1./4.) * (u_m2 - 4*u_m1 + 3*u)**2\n    b1 = (13./12.) * (u_m1 - 2*u + u_p1)**2 + (1./4.) * (u_m1 - u_p1)**2\n    b2 = (13./12.) * (u - 2*u_p1 + u_p2)**2 + (1./4.) * (3*u - 4*u_p1 + u_p2)**2\n\n    # Alpha weights\n    a0 = c0 / (b0 + eps_w)**2\n    a1 = c1 / (b1 + eps_w)**2\n    a2 = c2 / (b2 + eps_w)**2\n\n    # WENO weights (omega_k)\n    sum_a = a0 + a1 + a2\n    w0 = a0 / sum_a\n    w1 = a1 / sum_a\n    w2 = a2 / sum_a\n\n    # Reconstructions on sub-stencils\n    u_rec0 = (2*u_m2 - 7*u_m1 + 11*u) / 6.0\n    u_rec1 = (-u_m1 + 5*u + 2*u_p1) / 6.0\n    u_rec2 = (2*u + 5*u_p1 - u_p2) / 6.0\n\n    # Final WENO reconstruction\n    return w0 * u_rec0 + w1 * u_rec1 + w2 * u_rec2\n\ndef run_simulation(params):\n    \"\"\"\n    Main simulation driver for a single test case.\n    \"\"\"\n    a = params[\"a\"]\n    N = params[\"N\"]\n    CFL = params[\"CFL\"]\n    t_final = params[\"t_final\"]\n    C_tau = params[\"C_tau\"]\n    eps_s = params[\"eps_s\"]\n    u0_func = params[\"u0_func\"]\n    exact_sol_func = params[\"exact_sol_func\"]\n\n    # Grid setup\n    dx = 1.0 / N\n    x = np.linspace(0.5 * dx, 1.0 - 0.5 * dx, N)\n\n    # Initial condition\n    u = u0_func(x)\n\n    # Time-stepping\n    dt = CFL * dx / np.abs(a)\n    t = 0.0\n    \n    num_steps = int(np.floor(t_final / dt))\n\n    # SSP-RK3 time integration loop\n    for _ in range(num_steps):\n        # Stage 1\n        rhs1 = get_rhs(u, a, dx, C_tau, eps_s)\n        u1 = u + dt * rhs1\n        \n        # Stage 2\n        rhs2 = get_rhs(u1, a, dx, C_tau, eps_s)\n        u2 = 0.75 * u + 0.25 * u1 + 0.25 * dt * rhs2\n\n        # Stage 3\n        rhs3 = get_rhs(u2, a, dx, C_tau, eps_s)\n        u = (1./3.) * u + (2./3.) * u2 + (2./3.) * dt * rhs3\n\n        t += dt\n\n    # Final step to reach t_final exactly\n    dt_final = t_final - t\n    if dt_final  1e-12: # Avoid tiny steps\n        # Stage 1\n        rhs1 = get_rhs(u, a, dx, C_tau, eps_s)\n        u1 = u + dt_final * rhs1\n        \n        # Stage 2\n        rhs2 = get_rhs(u1, a, dx, C_tau, eps_s)\n        u2 = 0.75 * u + 0.25 * u1 + 0.25 * dt_final * rhs2\n\n        # Stage 3\n        rhs3 = get_rhs(u2, a, dx, C_tau, eps_s)\n        u = (1./3.) * u + (2./3.) * u2 + (2./3.) * dt_final * rhs3\n\n    # --- Compute final metric ---\n    if params[\"metric\"] == \"L1_error\":\n        u_exact = exact_sol_func(x, t_final, a, u0_func)\n        error = np.sum(np.abs(u - u_exact)) * dx\n        return error\n    elif params[\"metric\"] == \"overshoot\":\n        u_num_max = np.max(u)\n        u_num_min = np.min(u)\n        # For this case, the exact solution is bounded by [0, 1]\n        overshoot = max(u_num_max - 1.0, 0.0)\n        undershoot = max(0.0 - u_num_min, 0.0)\n        return overshoot + undershoot\n\nif __name__ == '__main__':\n    solve()\n\n```", "id": "2450580"}]}