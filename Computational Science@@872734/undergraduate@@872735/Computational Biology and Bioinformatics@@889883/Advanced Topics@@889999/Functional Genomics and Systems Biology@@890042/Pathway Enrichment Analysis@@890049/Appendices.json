{"hands_on_practices": [{"introduction": "The hypergeometric test is the statistical engine at the heart of Over-Representation Analysis (ORA). This exercise, [@problem_id:2412461], provides a crucial hands-on experience with this test by asking you to calculate how the $p$-value changes when the background gene \"universe\" is altered. By working through this calculation, you will gain a deeper, quantitative appreciation for how the significance of an observed gene overlap is highly dependent on the context provided by the background set.", "problem": "In a pathway enrichment analysis based on a targeted gene panel, a researcher considers a gene universe of size $N$ and evaluates enrichment of a specific pathway that contains $M$ genes present in this universe. A list of differentially expressed genes (DEGs) of size $n$ is obtained from an experiment, and the observed overlap between the DEG list and the pathway is $k$. The one-sided enrichment $p$-value is defined as the right-tail probability $\\Pr(X \\geq k)$ where $X$ is the number of pathway genes observed in a sample of size $n$ drawn without replacement from the universe of size $N$.\n\nSuppose initially the universe size is $N_{1} = 20$, the pathway contains $M = 6$ genes, the DEG list size is $n = 5$, and the observed overlap is $k = 3$. Now the universe is doubled to $N_{2} = 40$ by adding genes that are not members of the pathway, while $M = 6$, $n = 5$, and $k = 3$ remain unchanged.\n\nLet $p_{1}$ denote the enrichment $p$-value at $N = N_{1}$ and $p_{2}$ denote the enrichment $p$-value at $N = N_{2}$. Compute the exact ratio $r = \\dfrac{p_{2}}{p_{1}}$ and express your final answer as a single reduced fraction. Do not round.", "solution": "The problem statement is subjected to validation and is found to be valid. It is scientifically grounded, well-posed, objective, and self-contained. It describes a standard statistical test for pathway enrichment analysis, for which the underlying probability distribution is the hypergeometric distribution. I will proceed with the solution.\n\nThe problem requires the calculation of a ratio of two enrichment $p$-values. The enrichment test is based on sampling without replacement, which is correctly modeled by the hypergeometric distribution. Let $N$ be the total number of genes in the universe, $M$ be the number of genes in the pathway (successes in population), $n$ be the size of the sample drawn (the DEG list), and $i$ be the number of genes from the pathway found in the sample (successes in sample). The probability mass function (PMF) for observing exactly $i$ successful draws is given by:\n$$P(X=i) = \\frac{\\binom{M}{i} \\binom{N-M}{n-i}}{\\binom{N}{n}}$$\nThe one-sided enrichment $p$-value is defined as the right-tail probability $P(X \\ge k)$, where $k$ is the observed number of pathway genes in the sample. This is calculated as:\n$$p = P(X \\ge k) = \\sum_{i=k}^{\\min(n,M)} P(X=i) = \\sum_{i=k}^{\\min(n,M)} \\frac{\\binom{M}{i} \\binom{N-M}{n-i}}{\\binom{N}{n}}$$\n\nFirst, we calculate the $p$-value for the initial condition, $p_1$.\nThe parameters are $N_1 = 20$, $M = 6$, $n = 5$, and $k = 3$. The maximum possible overlap is $\\min(n, M) = \\min(5, 6) = 5$.\n$$p_1 = P(X_1 \\ge 3) = P(X_1=3) + P(X_1=4) + P(X_1=5)$$\nUsing the PMF, we express $p_1$ as:\n$$p_1 = \\frac{\\binom{6}{3}\\binom{20-6}{5-3}}{\\binom{20}{5}} + \\frac{\\binom{6}{4}\\binom{20-6}{5-4}}{\\binom{20}{5}} + \\frac{\\binom{6}{5}\\binom{20-6}{5-5}}{\\binom{20}{5}}$$\n$$p_1 = \\frac{1}{\\binom{20}{5}} \\left[ \\binom{6}{3}\\binom{14}{2} + \\binom{6}{4}\\binom{14}{1} + \\binom{6}{5}\\binom{14}{0} \\right]$$\nWe compute the binomial coefficients:\n$\\binom{6}{3} = \\frac{6 \\cdot 5 \\cdot 4}{3 \\cdot 2 \\cdot 1} = 20$\n$\\binom{6}{4} = \\binom{6}{2} = \\frac{6 \\cdot 5}{2 \\cdot 1} = 15$\n$\\binom{6}{5} = \\binom{6}{1} = 6$\n$\\binom{14}{2} = \\frac{14 \\cdot 13}{2 \\cdot 1} = 91$\n$\\binom{14}{1} = 14$\n$\\binom{14}{0} = 1$\n$\\binom{20}{5} = \\frac{20 \\cdot 19 \\cdot 18 \\cdot 17 \\cdot 16}{5 \\cdot 4 \\cdot 3 \\cdot 2 \\cdot 1} = 15504$\nSubstituting these values, we find the numerator for $p_1$:\n$$ \\text{Numerator}_1 = (20)(91) + (15)(14) + (6)(1) = 1820 + 210 + 6 = 2036 $$\nSo, $p_1 = \\frac{2036}{15504}$.\n\nNext, we calculate the $p$-value for the second condition, $p_2$.\nThe parameters are $N_2 = 40$, $M = 6$, $n = 5$, and $k = 3$. The number of genes not in the pathway is $N_2 - M = 40 - 6 = 34$.\n$$p_2 = P(X_2 \\ge 3) = P(X_2=3) + P(X_2=4) + P(X_2=5)$$\n$$p_2 = \\frac{1}{\\binom{40}{5}} \\left[ \\binom{6}{3}\\binom{34}{2} + \\binom{6}{4}\\binom{34}{1} + \\binom{6}{5}\\binom{34}{0} \\right]$$\nWe compute the required binomial coefficients:\nThe coefficients for $M$ are the same: $\\binom{6}{3}=20$, $\\binom{6}{4}=15$, $\\binom{6}{5}=6$.\n$\\binom{34}{2} = \\frac{34 \\cdot 33}{2 \\cdot 1} = 17 \\cdot 33 = 561$\n$\\binom{34}{1} = 34$\n$\\binom{34}{0} = 1$\n$\\binom{40}{5} = \\frac{40 \\cdot 39 \\cdot 38 \\cdot 37 \\cdot 36}{5 \\cdot 4 \\cdot 3 \\cdot 2 \\cdot 1} = 658008$\nSubstituting these values, we find the numerator for $p_2$:\n$$ \\text{Numerator}_2 = (20)(561) + (15)(34) + (6)(1) = 11220 + 510 + 6 = 11736 $$\nSo, $p_2 = \\frac{11736}{658008}$.\n\nFinally, we compute the ratio $r = \\frac{p_2}{p_1}$:\n$$r = \\frac{p_2}{p_1} = \\frac{11736/658008}{2036/15504} = \\frac{11736}{2036} \\times \\frac{15504}{658008}$$\nWe simplify each fraction separately.\nFor the first fraction:\n$$\\frac{11736}{2036} = \\frac{4 \\times 2934}{4 \\times 509} = \\frac{2934}{509}$$\nFor the second fraction:\n$$\\frac{15504}{658008} = \\frac{\\binom{20}{5}}{\\binom{40}{5}} = \\frac{20 \\cdot 19 \\cdot 18 \\cdot 17 \\cdot 16 / 5!}{40 \\cdot 39 \\cdot 38 \\cdot 37 \\cdot 36 / 5!} = \\frac{20 \\cdot 19 \\cdot 18 \\cdot 17 \\cdot 16}{40 \\cdot 39 \\cdot 38 \\cdot 37 \\cdot 36}$$\nBy canceling common factors from the numerator and denominator:\n$$ \\frac{20 \\cdot 19 \\cdot 18 \\cdot 17 \\cdot 16}{40 \\cdot 39 \\cdot 38 \\cdot 37 \\cdot 36} = \\frac{17 \\times 16}{2 \\times 39 \\times 2 \\times 37 \\times 2} = \\frac{17 \\times 2}{39 \\times 37} = \\frac{34}{1443} $$\nNow we multiply the simplified fractions to find $r$:\n$$r = \\frac{2934}{509} \\times \\frac{34}{1443}$$\nTo simplify this product, we use the prime factorizations: $2934 = 2 \\times 3^2 \\times 163$ and $1443 = 3 \\times 13 \\times 37$.\n$$r = \\frac{(2 \\times 3^2 \\times 163) \\times 34}{509 \\times (3 \\times 13 \\times 37)}$$\nCancel one factor of $3$:\n$$r = \\frac{2 \\times 3 \\times 163 \\times 34}{509 \\times 13 \\times 37} = \\frac{978 \\times 34}{509 \\times 481} = \\frac{33252}{244829}$$\nSince the prime factors of the numerator ($2, 3, 17, 163$) and denominator ($13, 37, 509$) have no common elements, the fraction is fully reduced.\nThe exact ratio is:\n$$r = \\frac{33252}{244829}$$", "answer": "$$\\boxed{\\frac{33252}{244829}}$$", "id": "2412461"}, {"introduction": "Moving beyond threshold-based methods, Gene Set Enrichment Analysis (GSEA) offers a powerful alternative by analyzing the entire ranked list of genes. At its core is the Enrichment Score ($ES$), which tracks the distribution of a gene set across the ranked list. This conceptual problem, [@problem_id:2412426], tests your understanding of what the $ES$ represents, specifically in the null case where it is zero, which is key to interpreting GSEA's output correctly.", "problem": "In Gene Set Enrichment Analysis (GSEA), consider a ranked list of $N$ genes ordered by a continuous statistic $r_j$ (for example, a signal-to-noise ratio), and a gene set $S$ of size $N_S$. Define a running-sum statistic $R(i)$ along the ranked list that increases by a positive, normalized weight when the $i$-th gene belongs to $S$, and decreases by a positive, normalized weight when it does not, with the total increment over all members of $S$ equal to $1$ and the total decrement over all non-members equal to $1$. The Enrichment Score $(ES)$ for $S$ is the extreme deviation of $R(i)$ from $0$: a positive peak indicates concentration of $S$ near the top of the ranked list, and a negative trough indicates concentration near the bottom. Suppose that for a given gene set $S$, the observed enrichment score is $ES=0$. Which interpretation is most appropriate?\n\n- A. The gene set shows no systematic enrichment toward either end of the ranked list; its members are distributed approximately uniformly, so the running-sum does not deviate from $0$.\n\n- B. All genes in the set are among the highest-ranked entries, indicating maximal positive enrichment.\n\n- C. The permutation-based $p$-value is exactly $0$, indicating perfect statistical significance.\n\n- D. The Normalized Enrichment Score (NES) is undefined because normalization would require division by $0$.\n\n- E. The gene set has $0$ overlap with the ranked list, so the enrichment score defaults to $0$.", "solution": "By construction, the running-sum statistic $R(i)$ starts at $0$, increases on indices $i$ where the gene belongs to the set $S$, and decreases otherwise, with the normalizations ensuring that the total increase over all hits is $1$ and the total decrease over all misses is $1$. The Enrichment Score $ES$ is defined as the extreme deviation of $R(i)$ from $0$: if members of $S$ tend to appear early (near the top of the ranked list), then $R(i)$ will rise and attain a positive peak, yielding $ES0$; if members of $S$ tend to appear late (near the bottom), then $R(i)$ will tend to decrease and attain a negative trough, yielding $ES0$. Under the null hypothesis that members of $S$ are positioned like a random subset with respect to the ranking by $r_j$, the locations of the increases and decreases tend to balance, and the trajectory of $R(i)$ exhibits only small fluctuations around $0$, producing an $ES$ near $0$.\n\nTherefore, an observed value $ES=0$ signifies that the running-sum trajectory did not exhibit any net positive or negative deviation away from $0$. Interpreted at the level of gene-set biology, this corresponds to a lack of systematic enrichment of $S$ toward either the top or the bottom of the ranked list, consistent with an approximately uniform (null-like) distribution of the set members across the ranking.\n\nEvaluate each option:\n\n- A. The statement matches the definition-based interpretation above: if $ES=0$, the running sum never deviates away from $0$ in a sustained manner, which is expected when the members of $S$ are distributed as if at random across the ranked list. This is the appropriate interpretation. Verdict: Correct.\n\n- B. If all genes in $S$ are among the highest-ranked, the running sum $R(i)$ would exhibit a pronounced positive peak early in the list, leading to $ES0$ (and typically large in magnitude), not $ES=0$. Verdict: Incorrect.\n\n- C. A permutation-based $p$-value of exactly $0$ would indicate that no null permutation produced an $|ES|$ at least as extreme as observed. An observed $ES=0$ is not extreme; indeed, it is consistent with the null. In practice, this would yield a large $p$-value, not $0$. Verdict: Incorrect.\n\n- D. The Normalized Enrichment Score (NES) is typically computed by dividing the observed $ES$ by a positive scaling factor derived from the mean (or mean of positives/negatives) of $|ES|$ under permutations for gene sets of comparable size. If $ES=0$, then the numerator is $0$, and the denominator is positive, so $NES=0$, not undefined. Verdict: Incorrect.\n\n- E. If the gene set has $0$ overlap with the ranked list, the GSEA statistic is not meaningfully defined for that set and is usually excluded from analysis. Moreover, if one were to proceed mechanically, the running sum would only decrease on every step (no hits), producing a negative trough and hence $ES0$, not $0$. Thus, “defaults to $0$” is not a correct interpretation. Verdict: Incorrect.", "answer": "$$\\boxed{A}$$", "id": "2412426"}, {"introduction": "In practice, you will often find that different enrichment methods yield different conclusions from the same data. This scenario-based problem, [@problem_id:2412467], presents a classic discrepancy: a pathway is found to be significant by GSEA but not by ORA. Resolving this apparent contradiction requires a firm grasp of the fundamental strengths and weaknesses of each method, a critical skill for drawing nuanced and accurate biological inferences.", "problem": "You analyze an RNA-sequencing experiment comparing two phenotypes and obtain a ranked list of all genes by a signed differential expression statistic. Gene Set Enrichment Analysis (GSEA) on the full ranked list reports the gene set labeled \"Immune Response\" as significantly enriched at a False Discovery Rate (FDR) below $0.05$. Separately, you perform Over-Representation Analysis (ORA) using a hypergeometric framework on the top $200$ differentially expressed genes (DEGs) defined at FDR below $0.05$, and for this analysis the \"Immune Response\" gene set is not significant. Which of the following is the most likely biological interpretation of these findings? Here, Gene Set Enrichment Analysis (GSEA), Over-Representation Analysis (ORA), and differentially expressed genes (DEGs) are defined in their standard bioinformatics usage.\n\nA. Many immune response genes exhibit small, coordinated shifts that are consistent in direction but too modest to cross the individual DEG threshold, producing a distributional shift detectable by GSEA while yielding insufficient overlap among the top $200$ DEGs for ORA.\n\nB. The immune response pathway is entirely inactive in all samples; the GSEA result arises solely from gene set size bias and should be disregarded.\n\nC. Over-Representation Analysis is inherently more sensitive than Gene Set Enrichment Analysis; therefore the lack of ORA significance demonstrates there is no true immune involvement.\n\nD. The discordance necessarily indicates a severe batch effect affecting housekeeping genes, which is the only plausible explanation for a significant GSEA result without a matching ORA signal.\n\nE. The immune response signal is driven exclusively by a few extremely strong differentially expressed genes, which ORA would tend to miss but GSEA would detect.", "solution": "The problem statement will first be subjected to rigorous validation.\n\nStep 1: Extract Givens\n- An RNA-sequencing experiment compares two phenotypes.\n- A ranked list of all genes is generated based on a signed differential expression statistic.\n- Gene Set Enrichment Analysis (GSEA) is performed on the full ranked list.\n- The gene set \"Immune Response\" is reported as significantly enriched by GSEA at a False Discovery Rate (FDR) below $0.05$.\n- Over-Representation Analysis (ORA) is performed separately using a hypergeometric framework.\n- The input for ORA is the list of the top $200$ differentially expressed genes (DEGs), which are themselves defined at an FDR below $0.05$.\n- The \"Immune Response\" gene set is not found to be significant in the ORA.\n- The task is to determine the most likely biological interpretation of these findings.\n\nStep 2: Validate Using Extracted Givens\nThe problem describes a standard, and indeed common, scenario in the analysis of transcriptomic data. The methods mentioned—GSEA and ORA—are fundamental techniques in computational biology for pathway analysis. The premise involves comparing the results of a threshold-based method (ORA) with a threshold-free method (GSEA), which is a classic topic in bioinformatics education and practice. The data provided are internally consistent and describe a plausible, non-contradictory set of analytical outcomes. The problem is scientifically grounded, well-posed, objective, and directly relevant to its stated field. It does not violate any principles of scientific logic, nor does it contain ambiguity or missing information that would preclude a reasoned solution.\n\nStep 3: Verdict and Action\nThe problem statement is valid. I will proceed with a full derivation and analysis.\n\nThe core of this problem lies in understanding the fundamental methodological differences between Over-Representation Analysis (ORA) and Gene Set Enrichment Analysis (GSEA).\n\nFirst, let us define the principles of each method.\nOver-Representation Analysis (ORA) is a threshold-dependent method. It begins by partitioning the entire set of measured genes into two groups: a small list of \"interesting\" genes (in this case, the top $200$ differentially expressed genes, or DEGs) and all other genes. This partitioning is based on a somewhat arbitrary significance threshold (here, a rank cutoff combined with an FDR threshold of $0.05$). ORA then uses a statistical test, typically the hypergeometric test or Fisher's exact test, to determine if a predefined gene set (e.g., \"Immune Response\") is statistically over-represented in the list of \"interesting\" genes compared to the background of all genes. The critical weakness of ORA is the information loss it incurs: all quantitative information about genes that do not pass the stringent threshold is discarded. Genes with modest but biologically relevant changes are treated identically to genes with no change at all.\n\nGene Set Enrichment Analysis (GSEA), in contrast, is a threshold-free method. It does not begin with an arbitrary cutoff to select a small list of DEGs. Instead, it considers all genes measured in the experiment, ranked according to a differential expression metric (e.g., signal-to-noise ratio, log-fold change). The method walks down the ranked list of genes and calculates a running-sum statistic, which increases when a gene from the set of interest is encountered and decreases when a gene not in the set is encountered. The maximum deviation of this running sum from zero is the Enrichment Score (ES). This ES reflects the degree to which a gene set is over-represented at the extremes (top or bottom) of the entire ranked list. The statistical significance of the ES is assessed using permutation testing, which generates a null distribution by shuffling the gene labels or sample labels, followed by correction for multiple testing (FDR). The primary strength of GSEA is its ability to detect subtle, coordinated changes in the expression of many genes within a pathway, even if none of those individual genes demonstrates a change sufficient to pass a strict DEG cutoff.\n\nNow, we analyze the specific results presented. GSEA finds the \"Immune Response\" gene set to be significant (FDR $ 0.05$), while ORA does not.\nThe significant GSEA result indicates that genes belonging to the \"Immune Response\" set are not randomly distributed throughout the ranked list. They are, as a group, enriched towards one end of the list, implying a coordinated, directional shift (e.g., mild but consistent upregulation) across the phenotype comparison.\nThe non-significant ORA result indicates that when we consider only the most extremely perturbed $200$ genes, the number of \"Immune Response\" genes found in this short list is not statistically surprising.\n\nThe most logical synthesis of these two findings is that the \"Immune Response\" pathway is indeed transcriptionally perturbed, but this perturbation manifests as a subtle, widespread, and coordinated shift in the expression of many genes in the set. The magnitude of these individual changes is too modest for most of these genes to qualify for inclusion in the top $200$ DEGs. GSEA, by integrating these small effects across the entire gene set, correctly identifies the significant biological signal. ORA, by focusing only on the \"tip of the iceberg\" (the top $200$ DEGs), fails to see the broader pattern and therefore incorrectly concludes there is no significant enrichment.\n\nWith this foundation, we evaluate each option:\n\nA. Many immune response genes exhibit small, coordinated shifts that are consistent in direction but too modest to cross the individual DEG threshold, producing a distributional shift detectable by GSEA while yielding insufficient overlap among the top $200$ DEGs for ORA.\nThis statement accurately describes the exact scenario for which GSEA was designed and where it excels in sensitivity over ORA. It perfectly reconciles the two seemingly contradictory results based on the fundamental principles of the methods.\nVerdict: **Correct**.\n\nB. The immune response pathway is entirely inactive in all samples; the GSEA result arises solely from gene set size bias and should be disregarded.\nThis is an unsound assertion. A significant GSEA result, especially with an FDR corrected by permutation testing below $0.05$, is strong evidence *against* the pathway being inactive. While gene set size can be a confounding factor, standard GSEA implementations include normalization steps to account for it. To dismiss a statistically significant finding as a mere artifact without further evidence is poor scientific practice. The statement that the pathway is \"entirely inactive\" is an extreme claim that is contradicted by the GSEA result.\nVerdict: **Incorrect**.\n\nC. Over-Representation Analysis is inherently more sensitive than Gene Set Enrichment Analysis; therefore the lack of ORA significance demonstrates there is no true immune involvement.\nThis premise is factually incorrect. The bioinformatics literature and community widely acknowledge that GSEA and similar threshold-free methods are generally *more* sensitive than ORA, precisely because they avoid arbitrary cutoffs and can detect subtle, cumulative effects. The logic of the option is based on a false premise.\nVerdict: **Incorrect**.\n\nD. The discordance necessarily indicates a severe batch effect affecting housekeeping genes, which is the only plausible explanation for a significant GSEA result without a matching ORA signal.\nThis is an overly strong and unsubstantiated claim. A batch effect is a potential issue in any high-throughput experiment, but it is far from the \"only plausible explanation.\" The methodological difference between GSEA and ORA provides a much more direct and parsimonious explanation for the observed results. There is no basis to \"necessarily\" conclude a batch effect is the cause, nor is there any information to specifically implicate housekeeping genes.\nVerdict: **Incorrect**.\n\nE. The immune response signal is driven exclusively by a few extremely strong differentially expressed genes, which ORA would tend to miss but GSEA would detect.\nThis statement demonstrates a misunderstanding of ORA. If the signal were driven by a few extremely strong DEGs, those genes would, by definition, be at the very top of the ranked list and would be included in the top $200$ DEGs used for the ORA. In such a scenario, ORA would be *highly likely* to return a significant result. This situation would lead to both GSEA and ORA being significant, which contradicts the problem statement that ORA was not significant.\nVerdict: **Incorrect**.\n\nIn summary, the discrepancy between GSEA and ORA results is a classic illustration of their respective strengths and weaknesses. Option A provides the only correct and mechanistically sound interpretation.", "answer": "$$\\boxed{A}$$", "id": "2412467"}]}