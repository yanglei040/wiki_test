{"hands_on_practices": [{"introduction": "The foundation of any molecular mechanics simulation is the potential energy function, which describes how a system's energy changes with the positions of its atoms. This first exercise takes you back to basics by having you calculate the total potential energy of a single water molecule from its constituent parts [@problem_id:2407803]. By implementing the harmonic bond stretching, angle bending, and non-bonded electrostatic terms yourself, you will gain a concrete understanding of how a molecule's geometry translates directly into its potential energy according to a force field.", "problem": "You are given a single, isolated water molecule composed of three atoms labeled hydrogen $H_1$, oxygen $O$, and hydrogen $H_2$. The total potential energy is to be computed from molecular mechanics first principles as the sum of harmonic bond stretching for the two $O\\!-\\!H$ bonds, harmonic angle bending for the $H\\!-\\!O\\!-\\!H$ angle, and electrostatic Coulomb interaction between the two hydrogens only. Interactions between directly bonded atom pairs are excluded from electrostatics. There are no Lennard–Jones contributions in this setup.\n\nDefine the following total potential energy:\n$$\nE_{\\text{total}} = \\sum_{i=1}^{2} \\frac{1}{2} k_r \\left(r_i - r_0\\right)^2 \\;+\\; \\frac{1}{2} k_\\theta \\left(\\theta - \\theta_0\\right)^2 \\;+\\; k_e \\frac{q_H q_H}{r_{HH}},\n$$\nwhere $r_1$ and $r_2$ are the lengths of the two $O\\!-\\!H$ bonds, $\\theta$ is the $H\\!-\\!O\\!-\\!H$ bond angle at the oxygen atom, and $r_{HH}$ is the distance between the two hydrogen atoms. The hydrogens carry identical partial charges $q_H$, the bond force constant is $k_r$, and the angle force constant is $k_\\theta$. The Coulomb constant is $k_e$. The bond energy equilibrium parameters are $r_0$ and $\\theta_0$. The $O\\!-\\!H$ electrostatics are excluded because those atoms are directly bonded; only the $H_1\\!-\\!H_2$ Coulomb interaction is included. All energies must be expressed in kilojoules per mole.\n\nUse the following fixed parameters for all calculations:\n- Bond equilibrium length $r_0 = 0.9572$ Å.\n- Angle equilibrium value $\\theta_0 = 104.52$ degrees.\n- Bond force constant $k_r = 1882.8$ kJ/mol·Å$^2$.\n- Angle force constant $k_\\theta = 230.12$ kJ/mol·rad$^2$.\n- Hydrogen partial charge $q_H = +0.417$ elementary charge.\n- Coulomb constant $k_e = 138.935456$ kJ·Å/(mol·e$^2$).\n\nGeometric conventions:\n- The input angle $\\theta$ is provided in degrees and must be treated in degrees for input, but the harmonic angle bending term must use radians. Therefore, convert $\\theta$ and $\\theta_0$ to radians for the angle bending term and for trigonometric functions.\n- The distance $r_{HH}$ is the length of the side opposite the angle $\\theta$ in the triangle with sides $r_1$ and $r_2$ that meet at the oxygen atom, and must be computed consistently with Euclidean geometry.\n- Bond lengths $r_1$ and $r_2$ are provided in Ångström (Å), and all distances in the calculation must be in Ångström (Å) to be consistent with the units of $k_e$.\n\nTest suite (each test case is a tuple $(r_1, r_2, \\theta_{\\text{deg}})$):\n- Case $1$: $(0.9572, 0.9572, 104.52)$\n- Case $2$: $(1.0000, 1.0000, 104.52)$\n- Case $3$: $(0.9572, 0.9572, 100.00)$\n- Case $4$: $(0.9500, 1.0000, 104.52)$\n\nYour task is to write a complete, runnable program that computes $E_{\\text{total}}$ for each case using the definitions above and produces the results in kilojoules per mole. Angles used inside trigonometric functions and in the angle bending term must be in radians. The final output must be a single line containing a comma-separated list of the four energies, rounded to six decimal places, enclosed in square brackets, for example, $[x_1,x_2,x_3,x_4]$ where each $x_i$ is a float in kJ/mol. No additional text should be printed.", "solution": "The problem statement is scientifically grounded, well-posed, objective, and self-contained. It presents a standard exercise in computational chemistry, specifically the calculation of potential energy using a simplified molecular mechanics force field. All necessary parameters, formulas, and conditions are provided, and there are no internal contradictions or violations of scientific principles. Thus, the problem is valid, and a solution will be provided.\n\nThe objective is to compute the total potential energy, $E_{\\text{total}}$, of a single water molecule for four different geometric configurations. The total energy is defined as the sum of three components: a bond stretching term, $E_{\\text{bond}}$, an angle bending term, $E_{\\text{angle}}$, and a non-bonded electrostatic term, $E_{\\text{Coulomb}}$.\n$$\nE_{\\text{total}} = E_{\\text{bond}} + E_{\\text{angle}} + E_{\\text{Coulomb}}\n$$\nWe will analyze the calculation of each term based on the provided parameters.\n\nThe fixed parameters are:\n- Bond equilibrium length $r_0 = 0.9572$ Å.\n- Angle equilibrium value $\\theta_0 = 104.52$ degrees.\n- Bond force constant $k_r = 1882.8$ kJ/mol·Å$^2$.\n- Angle force constant $k_\\theta = 230.12$ kJ/mol·rad$^2$.\n- Hydrogen partial charge $q_H = +0.417$ elementary charge.\n- Coulomb constant $k_e = 138.935456$ kJ·Å/(mol·e$^2$).\n\n**1. Bond Stretching Energy ($E_{\\text{bond}}$)**\n\nThe bond energy term models the potential energy stored in the two $O-H$ bonds when their lengths deviate from the equilibrium length $r_0$. The energy is calculated using a harmonic potential for each bond:\n$$\nE_{\\text{bond}} = \\sum_{i=1}^{2} \\frac{1}{2} k_r (r_i - r_0)^2 = \\frac{1}{2} k_r (r_1 - r_0)^2 + \\frac{1}{2} k_r (r_2 - r_0)^2\n$$\nHere, $r_1$ and $r_2$ are the given lengths of the two $O-H$ bonds in Ångströms (Å). The constants $k_r = 1882.8$ kJ/mol·Å$^2$ and $r_0 = 0.9572$ Å are used. The units are consistent, yielding an energy in kJ/mol.\n\n**2. Angle Bending Energy ($E_{\\text{angle}}$)**\n\nThe angle bending energy term models the potential energy change when the $H-O-H$ angle, $\\theta$, deviates from its equilibrium value, $\\theta_0$. This is also described by a harmonic potential:\n$$\nE_{\\text{angle}} = \\frac{1}{2} k_\\theta (\\theta_{\\text{rad}} - \\theta_{0,\\text{rad}})^2\n$$\nA critical step here is the conversion of angles from degrees to radians, as the force constant $k_\\theta$ is given in units of kJ/mol·rad$^2$. The input angle $\\theta_{\\text{deg}}$ and the equilibrium angle $\\theta_0 = 104.52$ degrees must both be converted. The conversion formula is:\n$$\n\\alpha_{\\text{rad}} = \\alpha_{\\text{deg}} \\times \\frac{\\pi}{180}\n$$\nSo, we compute $\\theta_{\\text{rad}}$ from the input $\\theta_{\\text{deg}}$, and the constant $\\theta_{0,\\text{rad}}$ from $\\theta_0$:\n$$\n\\theta_{0,\\text{rad}} = 104.52 \\times \\frac{\\pi}{180} \\approx 1.824218 \\text{ rad}\n$$\nWith the angles in radians, we can calculate $E_{\\text{angle}}$ using $k_\\theta = 230.12$ kJ/mol·rad$^2$.\n\n**3. Electrostatic Energy ($E_{\\text{Coulomb}}$)**\n\nThe electrostatic energy arises from the Coulomb interaction between the two hydrogen atoms, which carry partial charges. The problem specifies that only the $H_1-H_2$ interaction is considered. The energy is given by Coulomb's law:\n$$\nE_{\\text{Coulomb}} = k_e \\frac{q_H q_H}{r_{HH}} = k_e \\frac{q_H^2}{r_{HH}}\n$$\nwhere $q_H = +0.417$ e, $k_e = 138.935456$ kJ·Å/(mol·e$^2$), and $r_{HH}$ is the distance between the two hydrogen atoms in Å.\n\nThe distance $r_{HH}$ must be calculated from the molecule's geometry. The atoms $H_1$, $O$, and $H_2$ form a triangle, with the $O-H_1$ and $O-H_2$ bonds of lengths $r_1$ and $r_2$ forming two sides adjacent to the angle $\\theta$ at the oxygen atom. The distance $r_{HH}$ is the length of the side opposite to angle $\\theta$. By the Law of Cosines:\n$$\nr_{HH}^2 = r_1^2 + r_2^2 - 2 r_1 r_2 \\cos(\\theta_{\\text{rad}})\n$$\nThus, the distance is:\n$$\nr_{HH} = \\sqrt{r_1^2 + r_2^2 - 2 r_1 r_2 \\cos(\\theta_{\\text{rad}})}\n$$\nIt is essential that the angle $\\theta$ used in the cosine function is in radians. Once $r_{HH}$ is determined, $E_{\\text{Coulomb}}$ can be calculated. The units are consistent and yield an energy in kJ/mol.\n\n**Summary of Calculation for each Test Case $(r_1, r_2, \\theta_{\\text{deg}})$**\n\nFor each given tuple, the total energy is calculated by summing the three components:\n1. Calculate $E_{\\text{bond}}$ using the bond lengths $r_1$ and $r_2$.\n2. Convert $\\theta_{\\text{deg}}$ to $\\theta_{\\text{rad}}$ and calculate $E_{\\text{angle}}$.\n3. Use $\\theta_{\\text{rad}}$, $r_1$, and $r_2$ to compute $r_{HH}$ via the Law of Cosines.\n4. Use $r_{HH}$ to calculate $E_{\\text{Coulomb}}$.\n5. Sum the energies: $E_{\\text{total}} = E_{\\text{bond}} + E_{\\text{angle}} + E_{\\text{Coulomb}}$.\nThis procedure is repeated for all four test cases provided in the problem statement.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the total potential energy of a water molecule based on a\n    simplified molecular mechanics force field.\n    \"\"\"\n\n    # Define the fixed parameters with their respective units.\n    # Bond equilibrium length in Angstroms\n    r_0 = 0.9572  # Å\n    # Angle equilibrium value in degrees\n    theta_0_deg = 104.52  # degrees\n    # Bond force constant in kJ/mol·Å^2\n    k_r = 1882.8  # kJ/mol·Å^2\n    # Angle force constant in kJ/mol·rad^2\n    k_theta = 230.12  # kJ/mol·rad^2\n    # Hydrogen partial charge in elementary charge units\n    q_H = 0.417  # e\n    # Coulomb constant in kJ·Å/(mol·e^2)\n    k_e = 138.935456  # kJ·Å/(mol·e^2)\n\n    # Pre-calculate angle in radians for efficiency\n    theta_0_rad = np.deg2rad(theta_0_deg)\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (r1, r2, theta_deg) where r1, r2 are in Å\n    # and theta_deg is in degrees.\n    test_cases = [\n        (0.9572, 0.9572, 104.52),  # Case 1\n        (1.0000, 1.0000, 104.52),  # Case 2\n        (0.9572, 0.9572, 100.00),  # Case 3\n        (0.9500, 1.0000, 104.52),  # Case 4\n    ]\n\n    results = []\n    for r1, r2, theta_deg in test_cases:\n        # 1. Calculate Bond Stretching Energy (E_bond)\n        e_bond = 0.5 * k_r * ((r1 - r_0)**2 + (r2 - r_0)**2)\n\n        # 2. Calculate Angle Bending Energy (E_angle)\n        # Convert the current angle from degrees to radians for the calculation\n        theta_rad = np.deg2rad(theta_deg)\n        e_angle = 0.5 * k_theta * (theta_rad - theta_0_rad)**2\n\n        # 3. Calculate Electrostatic Energy (E_coulomb)\n        # First, calculate the distance between the two hydrogen atoms (r_HH)\n        # using the Law of Cosines. The angle must be in radians.\n        r_hh_squared = r1**2 + r2**2 - 2 * r1 * r2 * np.cos(theta_rad)\n        r_hh = np.sqrt(r_hh_squared)\n        \n        # Then, calculate the Coulombic potential energy.\n        e_coulomb = k_e * (q_H**2) / r_hh\n\n        # 4. Calculate Total Potential Energy\n        e_total = e_bond + e_angle + e_coulomb\n        results.append(e_total)\n\n    # Format the results to six decimal places as required.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2407803"}, {"introduction": "Force fields are powerful tools for investigating the consequences of biological changes, such as mutations in a protein. In this problem, you will apply a simplified electrostatic model to estimate the energetic impact of mutating an aspartate residue to a glutamate within a protein salt bridge [@problem_id:2407798]. This practice demonstrates how core physical principles like Coulomb's law, even in an idealized form, can provide valuable \"back-of-the-envelope\" insights into changes in molecular stability.", "problem": "A point-charge molecular mechanics (MM) model is used to estimate how a mutation from aspartate (D) to glutamate (E) perturbs the electrostatic stabilization of a nearby salt bridge with an arginine (R) in a protein interior. Assume the following idealized model:\n- The arginine side chain bears a charge of $+e$ localized at the center of its guanidinium group, and the aspartate/glutamate side chain bears a charge of $-e$ localized at the center of its carboxylate group.\n- The local environment is homogeneous with relative permittivity $\\varepsilon_{r} = 4$.\n- The center-to-center separation between the charged groups is $r_{D} = 3.0\\,\\text{\\AA}$ for the aspartate–arginine pair and $r_{E} = 4.5\\,\\text{\\AA}$ for the glutamate–arginine pair.\n- Use the Coulomb interaction in a uniform dielectric to estimate the electrostatic pair energy.\n- Define the change in electrostatic energy as $\\Delta E_{\\text{elec}} = E_{\\text{elec}}(\\text{E}) - E_{\\text{elec}}(\\text{D})$.\n\nUse the constants $e = 1.602176634 \\times 10^{-19}\\,\\text{C}$, $\\varepsilon_{0} = 8.8541878128 \\times 10^{-12}\\,\\text{C}^{2}\\,\\text{N}^{-1}\\,\\text{m}^{-2}$, $N_{A} = 6.02214076 \\times 10^{23}\\,\\text{mol}^{-1}$, and $1\\,\\text{\\AA} = 1.0 \\times 10^{-10}\\,\\text{m}$. Compute $\\Delta E_{\\text{elec}}$ per mole and express your final result in $\\text{kJ}\\,\\text{mol}^{-1}$. Round your answer to three significant figures.", "solution": "The electrostatic interaction energy between two point charges $q_{1}$ and $q_{2}$ separated by distance $r$ in a homogeneous medium of relative permittivity $\\varepsilon_{r}$ is given by\n$$\nE_{\\text{pair}} = \\frac{1}{4\\pi \\varepsilon_{0} \\varepsilon_{r}} \\frac{q_{1} q_{2}}{r}.\n$$\nFor the salt bridge, take $q_{1} = +e$ (arginine) and $q_{2} = -e$ (aspartate or glutamate carboxylate), so\n$$\nE_{\\text{pair}}(r) = -\\frac{1}{4\\pi \\varepsilon_{0} \\varepsilon_{r}} \\frac{e^{2}}{r}.\n$$\nDefine the change in electrostatic energy upon mutation as\n$$\n\\Delta E_{\\text{elec}} = E_{\\text{elec}}(\\text{E}) - E_{\\text{elec}}(\\text{D}) = -\\frac{1}{4\\pi \\varepsilon_{0} \\varepsilon_{r}} e^{2} \\left(\\frac{1}{r_{E}} - \\frac{1}{r_{D}}\\right).\n$$\nTo express per mole, multiply by Avogadro’s number $N_{A}$:\n$$\n\\Delta E_{\\text{elec, mol}} = -N_{A}\\,\\frac{1}{4\\pi \\varepsilon_{0} \\varepsilon_{r}} e^{2} \\left(\\frac{1}{r_{E}} - \\frac{1}{r_{D}}\\right).\n$$\nInsert the given parameters. First convert distances to meters:\n$$\nr_{D} = 3.0 \\times 10^{-10}\\,\\text{m}, \\quad r_{E} = 4.5 \\times 10^{-10}\\,\\text{m}.\n$$\nIt is convenient to denote $k_{e} = \\frac{1}{4\\pi \\varepsilon_{0}}$. Then the expression becomes\n$$\n\\Delta E_{\\text{elec, mol}} = -N_{A}\\,\\frac{k_{e}\\,e^{2}}{\\varepsilon_{r}} \\left(\\frac{1}{r_{E}} - \\frac{1}{r_{D}}\\right).\n$$\nUsing $k_{e} = \\frac{1}{4\\pi \\varepsilon_{0}}$, $e$, $N_{A}$, and $\\varepsilon_{r} = 4$, compute the numerical value stepwise. Keep symbols until the final substitution:\n\n1. Symbolic form:\n$$\n\\Delta E_{\\text{elec, mol}} = -\\frac{N_{A} e^{2}}{4\\pi \\varepsilon_{0} \\varepsilon_{r}} \\left(\\frac{1}{r_{E}} - \\frac{1}{r_{D}}\\right).\n$$\n\n2. Note that $r_{E}  r_{D}$, so $\\frac{1}{r_{E}} - \\frac{1}{r_{D}}  0$, and the overall $\\Delta E_{\\text{elec, mol}}$ is positive, reflecting a loss of stabilization.\n\n3. Substitute numerical values:\n- $N_{A} = 6.02214076 \\times 10^{23}\\,\\text{mol}^{-1}$,\n- $e = 1.602176634 \\times 10^{-19}\\,\\text{C}$,\n- $\\varepsilon_{0} = 8.8541878128 \\times 10^{-12}\\,\\text{C}^{2}\\,\\text{N}^{-1}\\,\\text{m}^{-2}$,\n- $\\varepsilon_{r} = 4$,\n- $r_{D} = 3.0 \\times 10^{-10}\\,\\text{m}$,\n- $r_{E} = 4.5 \\times 10^{-10}\\,\\text{m}$.\n\nFirst compute $k_{e} e^{2} = \\frac{e^{2}}{4\\pi \\varepsilon_{0}}$. Numerically,\n$$\nk_{e} e^{2} \\approx 8.9875517923 \\times 10^{9}\\,\\text{N}\\,\\text{m}^{2}\\,\\text{C}^{-2} \\times \\left(1.602176634 \\times 10^{-19}\\,\\text{C}\\right)^{2} \\approx 2.30707755 \\times 10^{-28}\\,\\text{J}\\,\\text{m}.\n$$\nThen\n$$\n\\Delta E_{\\text{elec, mol}} = -\\frac{N_{A}}{\\varepsilon_{r}} \\, (k_{e} e^{2}) \\left(\\frac{1}{r_{E}} - \\frac{1}{r_{D}}\\right).\n$$\nEvaluate the bracket:\n$$\n\\frac{1}{r_{E}} - \\frac{1}{r_{D}} = \\frac{1}{4.5 \\times 10^{-10}\\,\\text{m}} - \\frac{1}{3.0 \\times 10^{-10}\\,\\text{m}} = \\left(2.222\\dots - 3.333\\dots\\right) \\times 10^{9}\\,\\text{m}^{-1} = -1.111\\overline{1} \\times 10^{9}\\,\\text{m}^{-1}.\n$$\nThus\n$$\n\\Delta E_{\\text{elec, mol}} = -\\frac{6.02214076 \\times 10^{23}}{4} \\times \\left(2.30707755 \\times 10^{-28}\\,\\text{J}\\,\\text{m}\\right) \\times \\left(-1.111\\overline{1} \\times 10^{9}\\,\\text{m}^{-1}\\right).\n$$\nCombine signs and powers of ten:\n$$\n\\Delta E_{\\text{elec, mol}} \\approx \\frac{6.02214076 \\times 10^{23}}{4} \\times 2.30707755 \\times 10^{-28} \\times 1.111\\overline{1} \\times 10^{9}\\,\\text{J}\\,\\text{mol}^{-1}.\n$$\nCompute the numeric factor:\n$$\n\\frac{6.02214076}{4} \\times 2.30707755 \\times 1.111\\overline{1} \\approx 1.50553519 \\times 2.30707755 \\times 1.111\\overline{1} \\approx 3.840 \\,\\,(\\text{approximately}),\n$$\nand combine the exponents $10^{23-28+9} = 10^{4}$, giving\n$$\n\\Delta E_{\\text{elec, mol}} \\approx 3.859 \\times 10^{4}\\,\\text{J}\\,\\text{mol}^{-1} = 38.59\\,\\text{kJ}\\,\\text{mol}^{-1}.\n$$\nRounding to three significant figures,\n$$\n\\Delta E_{\\text{elec, mol}} = 38.6\\,\\text{kJ}\\,\\text{mol}^{-1}.\n$$\nThis positive value indicates that the mutation from aspartate to glutamate weakens the salt bridge (less favorable electrostatics) under the stated geometric and dielectric assumptions.", "answer": "$$\\boxed{38.6}$$", "id": "2407798"}, {"introduction": "A molecular dynamics simulation produces a trajectory—a high-resolution \"movie\" of atoms in motion. This final practice challenges you to analyze such a trajectory to determine which type of motion contributes most to the system's total energy fluctuations [@problem_id:2407812]. By calculating the covariance between individual energy terms and the total energy, you will learn a powerful, quantitative technique for dissecting and interpreting the rich dynamical information contained in simulation data.", "problem": "You are given a minimal molecular mechanics model for a linear triatomic molecule with atoms labeled $0$, $1$, and $2$, interacting through a bonded force field composed of a harmonic bond term, a harmonic angle term, and a van der Waals term modeled by a Lennard–Jones potential between atoms $0$ and $2$. At trajectory frame $k$, the total potential energy is the sum of the three contributions\n$$\nE_{\\text{tot}}^{(k)} = E_{\\text{bond}}^{(k)} + E_{\\text{angle}}^{(k)} + E_{\\text{vdW}}^{(k)}.\n$$\nThe bonded terms are defined by first principles. For each frame $k$, the bond stretching energy is\n$$\nE_{\\text{bond}}^{(k)} = \\tfrac{1}{2} k_b \\left(r_{01}^{(k)} - r_0\\right)^2 + \\tfrac{1}{2} k_b \\left(r_{12}^{(k)} - r_0\\right)^2,\n$$\nthe angle bending energy at atom $1$ is\n$$\nE_{\\text{angle}}^{(k)} = \\tfrac{1}{2} k_{\\theta} \\left(\\theta^{(k)} - \\theta_0\\right)^2,\n$$\nand the van der Waals energy between atoms $0$ and $2$ is\n$$\nE_{\\text{vdW}}^{(k)} = 4 \\varepsilon \\left[\\left(\\frac{\\sigma}{r_{02}^{(k)}}\\right)^{12} - \\left(\\frac{\\sigma}{r_{02}^{(k)}}\\right)^6 \\right].\n$$\nHere $r_{ij}^{(k)}$ denotes the distance between atoms $i$ and $j$ at frame $k$, $\\theta^{(k)}$ is the bond angle at atom $1$ formed by atoms $(0,1,2)$, $r_0$ is the equilibrium bond length, $\\theta_0$ is the equilibrium angle, $k_b$ and $k_{\\theta}$ are the bond and angle force constants, and $\\varepsilon$ and $\\sigma$ are the Lennard–Jones parameters. All distances must be in nanometers (nm), angles in radians, and energies in kilojoules per mole (kJ/mol). The angle must be computed in radians.\n\nFor each frame $k$, you are provided the triplet of internal coordinates $\\left(r_{01}^{(k)}, r_{12}^{(k)}, \\theta^{(k)}\\right)$. The nonbonded distance $r_{02}^{(k)}$ is obtained from these by the law of cosines,\n$$\nr_{02}^{(k)} = \\sqrt{\\left(r_{01}^{(k)}\\right)^2 + \\left(r_{12}^{(k)}\\right)^2 - 2 \\, r_{01}^{(k)} r_{12}^{(k)} \\cos\\!\\left(\\theta^{(k)}\\right)}.\n$$\n\nDefine the fluctuation contribution of each term $i \\in \\{\\text{bond}, \\text{angle}, \\text{vdW}\\}$ to the total energy fluctuation over $N$ frames as the covariance-based fraction\n$$\nc_i \\equiv \\frac{\\mathrm{Cov}\\!\\left(E_i, E_{\\text{tot}}\\right)}{\\mathrm{Var}\\!\\left(E_{\\text{tot}}\\right)},\n$$\nwhere, using the population (not sample) definitions,\n$$\n\\mu_X = \\frac{1}{N}\\sum_{k=1}^{N} X^{(k)}, \\quad\n\\mathrm{Cov}(X,Y) = \\frac{1}{N}\\sum_{k=1}^{N} \\left(X^{(k)} - \\mu_X\\right)\\left(Y^{(k)} - \\mu_Y\\right), \\quad\n\\mathrm{Var}(X) = \\mathrm{Cov}(X,X).\n$$\nIf $\\mathrm{Var}\\!\\left(E_{\\text{tot}}\\right) = 0$, define the result for that test as $-1$ (undefined contribution because there is no fluctuation). Otherwise, define the “most contributing” term as the one with the largest absolute contribution $\\arg\\max_{i \\in \\{\\text{bond}, \\text{angle}, \\text{vdW}\\}} \\left|c_i\\right|$ and encode it as an integer according to the mapping: bond $\\rightarrow$ $0$, angle $\\rightarrow$ $1$, van der Waals $\\rightarrow$ $2$.\n\nUse the following test suite. Each test case specifies $(k_b, r_0, k_{\\theta}, \\theta_0, \\varepsilon, \\sigma)$ followed by the ordered list of frames as $\\left(r_{01}^{(k)}, r_{12}^{(k)}, \\theta^{(k)}\\right)$.\n\n- Test case $1$ (bond-dominated variation):\n  - Parameters: $k_b = 5000$, $r_0 = 0.100$, $k_{\\theta} = 50$, $\\theta_0 = 2.09439510239$, $\\varepsilon = 0.05$, $\\sigma = 0.200$.\n  - Frames (nm, nm, rad):\n    - $\\left(0.080, 0.100, 2.10\\right)$,\n    - $\\left(0.100, 0.100, 2.09\\right)$,\n    - $\\left(0.120, 0.100, 2.08\\right)$,\n    - $\\left(0.090, 0.100, 2.11\\right)$,\n    - $\\left(0.110, 0.100, 2.09\\right)$.\n\n- Test case $2$ (angle-dominated variation):\n  - Parameters: $k_b = 100$, $r_0 = 0.100$, $k_{\\theta} = 3000$, $\\theta_0 = 2.09439510239$, $\\varepsilon = 0.05$, $\\sigma = 0.200$.\n  - Frames (nm, nm, rad):\n    - $\\left(0.100, 0.100, 1.80\\right)$,\n    - $\\left(0.100, 0.100, 2.00\\right)$,\n    - $\\left(0.100, 0.100, 2.10\\right)$,\n    - $\\left(0.100, 0.100, 2.30\\right)$.\n\n- Test case $3$ (van der Waals-dominated variation):\n  - Parameters: $k_b = 50$, $r_0 = 0.100$, $k_{\\theta} = 20$, $\\theta_0 = 2.09439510239$, $\\varepsilon = 5.0$, $\\sigma = 0.200$.\n  - Frames (nm, nm, rad):\n    - $\\left(0.100, 0.100, 1.60\\right)$,\n    - $\\left(0.100, 0.100, 1.80\\right)$,\n    - $\\left(0.100, 0.100, 2.00\\right)$,\n    - $\\left(0.100, 0.100, 2.20\\right)$.\n\n- Test case $4$ (no fluctuation):\n  - Parameters: $k_b = 5000$, $r_0 = 0.100$, $k_{\\theta} = 50$, $\\theta_0 = 2.09439510239$, $\\varepsilon = 0.05$, $\\sigma = 0.200$.\n  - Frames (nm, nm, rad):\n    - $\\left(0.100, 0.100, 2.09439510239\\right)$,\n    - $\\left(0.100, 0.100, 2.09439510239\\right)$,\n    - $\\left(0.100, 0.100, 2.09439510239\\right)$.\n\nYour task is to write a complete, runnable program that, for each test case, computes $E_{\\text{bond}}^{(k)}$, $E_{\\text{angle}}^{(k)}$, $E_{\\text{vdW}}^{(k)}$, and $E_{\\text{tot}}^{(k)}$ for all frames $k$, then computes $c_{\\text{bond}}$, $c_{\\text{angle}}$, and $c_{\\text{vdW}}$ as defined above, and finally outputs the encoded index of the term with the largest absolute contribution. If $\\mathrm{Var}\\!\\left(E_{\\text{tot}}\\right) = 0$, output $-1$ for that test case.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list of integers enclosed in square brackets (for example, \"[i1,i2,i3,i4]\"), in the same order as the test cases $1$ through $4$.", "solution": "We base the solution on molecular mechanics definitions and probability theory for fluctuations. For each frame $k \\in \\{1,\\dots,N\\}$ we have internal coordinates $\\left(r_{01}^{(k)}, r_{12}^{(k)}, \\theta^{(k)}\\right)$. The bonded energy terms follow directly from their harmonic forms, and the van der Waals interaction is given by the Lennard–Jones potential evaluated at the nonbonded separation $r_{02}^{(k)}$, which is obtained via the law of cosines:\n$$\nr_{02}^{(k)} = \\sqrt{\\left(r_{01}^{(k)}\\right)^2 + \\left(r_{12}^{(k)}\\right)^2 - 2 r_{01}^{(k)} r_{12}^{(k)} \\cos\\!\\left(\\theta^{(k)}\\right)}.\n$$\nThus, for each frame $k$,\n$$\nE_{\\text{bond}}^{(k)} = \\tfrac{1}{2} k_b \\left(r_{01}^{(k)} - r_0\\right)^2 + \\tfrac{1}{2} k_b \\left(r_{12}^{(k)} - r_0\\right)^2,\n$$\n$$\nE_{\\text{angle}}^{(k)} = \\tfrac{1}{2} k_{\\theta} \\left(\\theta^{(k)} - \\theta_0\\right)^2,\n$$\n$$\nE_{\\text{vdW}}^{(k)} = 4 \\varepsilon \\left[\\left(\\frac{\\sigma}{r_{02}^{(k)}}\\right)^{12} - \\left(\\frac{\\sigma}{r_{02}^{(k)}}\\right)^6 \\right],\n$$\nand\n$$\nE_{\\text{tot}}^{(k)} = E_{\\text{bond}}^{(k)} + E_{\\text{angle}}^{(k)} + E_{\\text{vdW}}^{(k)}.\n$$\n\nTo quantify the contribution of each term to the total fluctuation, we adopt a covariance-based decomposition. Let $E_i$ denote the time series $\\{E_i^{(k)}\\}_{k=1}^{N}$ for $i \\in \\{\\text{bond}, \\text{angle}, \\text{vdW}\\}$, and let $E_{\\text{tot}}$ denote $\\{E_{\\text{tot}}^{(k)}\\}_{k=1}^{N}$. Using the population definitions,\n$$\n\\mu_X = \\frac{1}{N}\\sum_{k=1}^{N} X^{(k)}, \\quad \\mathrm{Cov}(X,Y) = \\frac{1}{N}\\sum_{k=1}^{N} \\left(X^{(k)} - \\mu_X\\right)\\left(Y^{(k)} - \\mu_Y\\right), \\quad \\mathrm{Var}(X) = \\mathrm{Cov}(X,X),\n$$\nwe define\n$$\nc_i = \\frac{\\mathrm{Cov}\\!\\left(E_i, E_{\\text{tot}}\\right)}{\\mathrm{Var}\\!\\left(E_{\\text{tot}}\\right)}.\n$$\nBy bilinearity of covariance and the identity $E_{\\text{tot}} = E_{\\text{bond}} + E_{\\text{angle}} + E_{\\text{vdW}}$, we have\n$$\n\\mathrm{Var}\\!\\left(E_{\\text{tot}}\\right) = \\sum_{i \\in \\{\\text{bond}, \\text{angle}, \\text{vdW}\\}} \\mathrm{Cov}\\!\\left(E_i, E_{\\text{tot}}\\right),\n$$\nso the $c_i$ sum to $1$. If $\\mathrm{Var}\\!\\left(E_{\\text{tot}}\\right) = 0$, there is no fluctuation and the contributions are undefined; per the specification, we output $-1$ in that case. Otherwise, the requested index is the $\\arg\\max$ of $\\left|c_i\\right|$, encoded as bond $\\rightarrow 0$, angle $\\rightarrow 1$, van der Waals $\\rightarrow 2$.\n\nApplying this to the test suite:\n\n- Test case $1$ has $k_b = 5000$ and significant variation in $r_{01}^{(k)}$ with $r_{12}^{(k)}$ held at $r_0$, while $k_{\\theta} = 50$ and $\\varepsilon = 0.05$ keep angle and van der Waals contributions comparatively small. Therefore $E_{\\text{bond}}$ dominates the fluctuation, giving index $0$.\n\n- Test case $2$ has $k_{\\theta} = 3000$ with varying $\\theta^{(k)}$ and bonds fixed at $r_0$, while $\\varepsilon = 0.05$ produces modest van der Waals variability. Thus $E_{\\text{angle}}$ dominates, giving index $1$.\n\n- Test case $3$ has $\\varepsilon = 5.0$ with $\\sigma = 0.200$ and varying $\\theta^{(k)}$ at relatively small $k_{\\theta} = 20$ and $k_b = 50$ with bonds fixed at $r_0$. The variation in $\\theta^{(k)}$ induces changes in $r_{02}^{(k)}$ that, through the Lennard–Jones potential with large $\\varepsilon$, produce dominant $E_{\\text{vdW}}$ fluctuations, giving index $2$.\n\n- Test case $4$ repeats the exact equilibrium frame, so $\\mathrm{Var}\\!\\left(E_{\\text{tot}}\\right) = 0$ and the result is $-1$.\n\nTherefore, the program should output a single line with the list of integers $[0, 1, 2, -1]$ in that order, using the exact format specified.", "answer": "```python\nimport numpy as np\n\ndef compute_contributions(frames, kb, r0, ktheta, theta0, eps, sigma, eps_var=1e-12):\n    \"\"\"\n    Compute the dominant contributor index for a given trajectory.\n\n    Parameters:\n        frames: list of tuples (r01, r12, theta) for each frame\n        kb, r0, ktheta, theta0, eps, sigma: force field parameters\n        eps_var: tolerance for zero variance detection\n\n    Returns:\n        int: 0 for bond, 1 for angle, 2 for vdW, or -1 if total variance is zero\n    \"\"\"\n    frames = np.array(frames, dtype=float)  # shape (N, 3)\n    r01 = frames[:, 0]\n    r12 = frames[:, 1]\n    theta = frames[:, 2]\n\n    # Compute r02 via law of cosines\n    r02_sq = r01**2 + r12**2 - 2.0 * r01 * r12 * np.cos(theta)\n    # Guard against tiny negative due to numerical errors\n    r02_sq = np.maximum(r02_sq, 0.0)\n    r02 = np.sqrt(r02_sq)\n\n    # Energies per frame\n    e_bond = 0.5 * kb * ((r01 - r0)**2 + (r12 - r0)**2)\n    e_angle = 0.5 * ktheta * ((theta - theta0)**2)\n    # Avoid division by zero by adding a tiny epsilon where r02 is zero\n    # (not expected in provided test cases)\n    safe_r02 = np.where(r02 > 0.0, r02, 1e-30)\n    ratio = sigma / safe_r02\n    ratio6 = ratio**6\n    e_vdw = 4.0 * eps * (ratio6**2 - ratio6)\n\n    e_tot = e_bond + e_angle + e_vdw\n\n    # Population variance and covariance\n    def pop_var(x):\n        xm = x - np.mean(x)\n        return np.mean(xm * xm)\n\n    def pop_cov(x, y):\n        xm = x - np.mean(x)\n        ym = y - np.mean(y)\n        return np.mean(xm * ym)\n\n    var_tot = pop_var(e_tot)\n    if var_tot = eps_var:\n        return -1\n\n    cov_b = pop_cov(e_bond, e_tot)\n    cov_a = pop_cov(e_angle, e_tot)\n    cov_v = pop_cov(e_vdw, e_tot)\n\n    contributions = np.array([cov_b / var_tot, cov_a / var_tot, cov_v / var_tot], dtype=float)\n    idx = int(np.argmax(np.abs(contributions)))\n    return idx\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1\n        {\n            \"kb\": 5000.0, \"r0\": 0.100, \"ktheta\": 50.0, \"theta0\": 2.09439510239, \"eps\": 0.05, \"sigma\": 0.200,\n            \"frames\": [\n                (0.080, 0.100, 2.10),\n                (0.100, 0.100, 2.09),\n                (0.120, 0.100, 2.08),\n                (0.090, 0.100, 2.11),\n                (0.110, 0.100, 2.09),\n            ],\n        },\n        # Test case 2\n        {\n            \"kb\": 100.0, \"r0\": 0.100, \"ktheta\": 3000.0, \"theta0\": 2.09439510239, \"eps\": 0.05, \"sigma\": 0.200,\n            \"frames\": [\n                (0.100, 0.100, 1.80),\n                (0.100, 0.100, 2.00),\n                (0.100, 0.100, 2.10),\n                (0.100, 0.100, 2.30),\n            ],\n        },\n        # Test case 3\n        {\n            \"kb\": 50.0, \"r0\": 0.100, \"ktheta\": 20.0, \"theta0\": 2.09439510239, \"eps\": 5.0, \"sigma\": 0.200,\n            \"frames\": [\n                (0.100, 0.100, 1.60),\n                (0.100, 0.100, 1.80),\n                (0.100, 0.100, 2.00),\n                (0.100, 0.100, 2.20),\n            ],\n        },\n        # Test case 4\n        {\n            \"kb\": 5000.0, \"r0\": 0.100, \"ktheta\": 50.0, \"theta0\": 2.09439510239, \"eps\": 0.05, \"sigma\": 0.200,\n            \"frames\": [\n                (0.100, 0.100, 2.09439510239),\n                (0.100, 0.100, 2.09439510239),\n                (0.100, 0.100, 2.09439510239),\n            ],\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        idx = compute_contributions(\n            frames=case[\"frames\"],\n            kb=case[\"kb\"],\n            r0=case[\"r0\"],\n            ktheta=case[\"ktheta\"],\n            theta0=case[\"theta0\"],\n            eps=case[\"eps\"],\n            sigma=case[\"sigma\"],\n        )\n        results.append(idx)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2407812"}]}