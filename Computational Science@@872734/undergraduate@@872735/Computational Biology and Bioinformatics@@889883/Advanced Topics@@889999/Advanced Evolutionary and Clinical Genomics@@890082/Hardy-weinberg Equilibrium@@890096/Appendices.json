{"hands_on_practices": [{"introduction": "The Hardy-Weinberg principle provides a mathematical baseline for a non-evolving population. A fundamental skill is to apply this principle to real-world data. This first exercise [@problem_id:1852915] walks you through a classic scenario in conservation biology, using observed phenotype counts from a field survey to first calculate the underlying allele frequencies and then to predict the expected genotype frequencies in the next generation, assuming the population is in equilibrium.", "problem": "A team of conservation biologists is monitoring a large, isolated population of the rare sky-petal orchid (*Orchis caelestis*). The flower color in this species is determined by a single gene with two alleles, which exhibit incomplete dominance. The allele for blue petals is denoted by $C^B$, and the allele for white petals is denoted by $C^W$. Plants with the genotype $C^B C^B$ produce blue flowers, plants with $C^W C^W$ produce white flowers, and heterozygous plants ($C^B C^W$) produce light-blue flowers.\n\nDuring a recent field survey, the biologists counted the number of plants with each phenotype. Their census data revealed:\n- 721 plants with blue flowers\n- 438 plants with light-blue flowers\n- 71 plants with white flowers\n\nAssuming the population adheres to the conditions for Hardy-Weinberg equilibrium (i.e., mating is random and there is no mutation, selection, gene flow, or genetic drift), calculate the expected frequency of heterozygous individuals in the next generation. Report your answer rounded to three significant figures.", "solution": "Let $p$ be the allele frequency of $C^{B}$ and $q$ be the allele frequency of $C^{W}$, with $p+q=1$. Under Hardy-Weinberg equilibrium, the genotype frequencies are $p^{2}$ for $C^{B}C^{B}$ (blue), $2pq$ for $C^{B}C^{W}$ (light-blue), and $q^{2}$ for $C^{W}C^{W}$ (white).\n\nFrom the census:\n- $N_{BB}=721$,\n- $N_{BW}=438$,\n- $N_{WW}=71$,\n- $N=N_{BB}+N_{BW}+N_{WW}=721+438+71=1230$.\n\nAllele frequencies are computed from genotype counts by\n$$\np=\\frac{2N_{BB}+N_{BW}}{2N}, \\quad q=\\frac{2N_{WW}+N_{BW}}{2N}=1-p.\n$$\nSubstituting the counts,\n$$\np=\\frac{2\\cdot 721+438}{2\\cdot 1230}=\\frac{1880}{2460}=\\frac{94}{123}, \\quad q=1-\\frac{94}{123}=\\frac{29}{123}.\n$$\nThe expected heterozygote frequency in the next generation under Hardy-Weinberg equilibrium is\n$$\n2pq=2\\left(\\frac{94}{123}\\right)\\left(\\frac{29}{123}\\right)=\\frac{5452}{15129}\\approx 0.360367\\ldots\n$$\nRounding to three significant figures gives $0.360$.", "answer": "$$\\boxed{0.360}$$", "id": "1852915"}, {"introduction": "While calculating expected frequencies is a key first step, in practice, observed and expected counts rarely match perfectly. The crucial question then becomes: is the difference significant enough to reject the Hardy-Weinberg null hypothesis? This practice [@problem_id:2396513] introduces the chi-squared ($\\chi^2$) goodness-of-fit test, a standard statistical tool for this purpose. More importantly, it challenges you to deconstruct the test statistic to pinpoint which genotype contributes most to the deviation, offering valuable clues about potential evolutionary pressures like selection or non-random mating.", "problem": "A biallelic autosomal locus is genotyped in a cohort of $n$ diploid individuals. The observed genotype counts are $O_{AA}=150$, $O_{Aa}=300$, and $O_{aa}=50$, so that $n=500$. Under the null hypothesis of Hardy-Weinberg equilibrium (HWE), use the sample to estimate the allele frequency of allele $A$, then obtain the corresponding expected genotype counts. Using the chi-squared ($\\chi^{2}$) goodness-of-fit framework for HWE based on these expected counts, compute the per-genotype contributions $\\left(O_{g}-E_{g}\\right)^{2}/E_{g}$ for $g\\in\\{AA,Aa,aa\\}$ and determine the largest single contribution. Report only the numerical value of this largest per-genotype contribution. Round your answer to three significant figures.", "solution": "The first step is to estimate the allele frequencies from the observed sample data. Let $\\hat{p}$ be the estimated frequency of allele $A$ and $\\hat{q}$ be the estimated frequency of allele $a$. The total number of alleles in the sample of $n=500$ diploid individuals is $2n = 1000$. The frequency of allele $A$ is calculated by counting all $A$ alleles and dividing by the total number of alleles.\n\nThe number of $A$ alleles is given by $2 \\times O_{AA} + O_{Aa}$.\n$$ \\text{Count}(A) = 2 \\times 150 + 300 = 300 + 300 = 600 $$\nThe estimated frequency of allele $A$ is therefore:\n$$ \\hat{p} = \\frac{2 \\times O_{AA} + O_{Aa}}{2n} = \\frac{600}{1000} = 0.6 $$\n\nSimilarly, the number of $a$ alleles is given by $2 \\times O_{aa} + O_{Aa}$.\n$$ \\text{Count}(a) = 2 \\times 50 + 300 = 100 + 300 = 400 $$\nThe estimated frequency of allele $a$ is:\n$$ \\hat{q} = \\frac{2 \\times O_{aa} + O_{Aa}}{2n} = \\frac{400}{1000} = 0.4 $$\nAs a necessary check, the sum of allele frequencies must be unity: $\\hat{p} + \\hat{q} = 0.6 + 0.4 = 1.0$. This is correct.\n\nNext, under the null hypothesis of Hardy-Weinberg equilibrium, we calculate the expected genotype counts ($E_{g}$) using these estimated allele frequencies. The expected genotype frequencies are $P(AA) = \\hat{p}^2$, $P(Aa) = 2\\hat{p}\\hat{q}$, and $P(aa) = \\hat{q}^2$. The expected counts are these frequencies multiplied by the total sample size $n$.\n\nThe expected count for genotype $AA$ is:\n$$ E_{AA} = n \\times \\hat{p}^2 = 500 \\times (0.6)^2 = 500 \\times 0.36 = 180 $$\n\nThe expected count for genotype $Aa$ is:\n$$ E_{Aa} = n \\times 2\\hat{p}\\hat{q} = 500 \\times 2 \\times 0.6 \\times 0.4 = 500 \\times 0.48 = 240 $$\n\nThe expected count for genotype $aa$ is:\n$$ E_{aa} = n \\times \\hat{q}^2 = 500 \\times (0.4)^2 = 500 \\times 0.16 = 80 $$\nAs a check, the sum of expected counts must equal the total sample size: $E_{AA} + E_{Aa} + E_{aa} = 180 + 240 + 80 = 500 = n$. This is also correct.\n\nFinally, we compute the per-genotype contribution to the chi-squared statistic using the formula $\\frac{(O_{g}-E_{g})^{2}}{E_{g}}$.\n\nFor genotype $AA$:\n$$ \\chi_{AA}^2 = \\frac{(O_{AA} - E_{AA})^2}{E_{AA}} = \\frac{(150 - 180)^2}{180} = \\frac{(-30)^2}{180} = \\frac{900}{180} = 5 $$\n\nFor genotype $Aa$:\n$$ \\chi_{Aa}^2 = \\frac{(O_{Aa} - E_{Aa})^2}{E_{Aa}} = \\frac{(300 - 240)^2}{240} = \\frac{(60)^2}{240} = \\frac{3600}{240} = 15 $$\n\nFor genotype $aa$:\n$$ \\chi_{aa}^2 = \\frac{(O_{aa} - E_{aa})^2}{E_{aa}} = \\frac{(50 - 80)^2}{80} = \\frac{(-30)^2}{80} = \\frac{900}{80} = 11.25 $$\n\nThe per-genotype contributions are $5$, $15$, and $11.25$. The problem requires identifying the largest single contribution.\n$$ \\max(\\chi_{AA}^2, \\chi_{Aa}^2, \\chi_{aa}^2) = \\max(5, 15, 11.25) = 15 $$\nThe value is an integer. The problem specifies rounding to three significant figures. The number $15$ has two significant figures. To represent it with three, it must be written as $15.0$.", "answer": "$$\\boxed{15.0}$$", "id": "2396513"}, {"introduction": "Statistical tests, including the chi-squared test for HWE, rely on certain assumptions and approximations that can break down under specific conditions. For a computational biologist, simulation is a powerful method for exploring the behavior and limitations of these statistical tools. In this advanced practice [@problem_id:2396474], you will write a program to simulate populations that are known to be in HWE. By testing these simulated populations, you can quantify how often the $\\chi^2$ test produces a 'false positive' result, particularly with small sample sizes or rare alleles, thereby gaining a deeper, practical understanding of statistical power and error rates.", "problem": "You are asked to implement a complete, runnable program that simulates genotype data under Hardyâ€“Weinberg equilibrium (HWE) and quantifies how small sample sizes, combined with the large-sample chi-square approximation, can produce statistically significant but false deviations purely by chance. The core of the simulation must adhere to first principles: ideal random mating with no selection, mutation, migration, or inbreeding, and accurate accounting of allele frequencies and genotype counts. The goal is to compute the empirical false positive rate under the null hypothesis that HWE holds exactly.\n\nFoundational base:\n- Under random mating in a diploid organism with a bi-allelic locus and true allele-$A$ frequency $p$, with $q = 1 - p$, the genotype probabilities are given by the binomial expansion of $(p + q)^2$, yielding $p^2$ for $AA$, $2pq$ for $Aa$, and $q^2$ for $aa$.\n- A goodness-of-fit chi-square test compares observed counts to expected counts. When the allele frequency is estimated from the data, the appropriate degrees of freedom is $1$.\n\nYour program must:\n- Simulate $R$ replicate samples of $n$ diploid individuals under exact HWE at a specified true allele-$A$ frequency $p$.\n- In each replicate, compute the sample allele-$A$ frequency $\\hat{p}$ from observed genotype counts, compute the expected genotype counts under HWE at $\\hat{p}$, compute the Pearson chi-square statistic with $1$ degree of freedom, and the associated $p$-value using the chi-square survival function.\n- Record whether the replicate is a false positive, defined as the event that the $p$-value is strictly less than the nominal significance level $\\alpha$, even though the data were generated under true HWE.\n- Return the fraction of false positives (a decimal in $[0,1]$) across the $R$ replicates for each test case.\n\nMathematical specification:\n- For a given replicate with observed genotype counts $(O_{AA}, O_{Aa}, O_{aa})$ summing to $n$, compute the sample allele-$A$ frequency $\\hat{p} = \\dfrac{2 O_{AA} + O_{Aa}}{2n}$ and $\\hat{q} = 1 - \\hat{p}$.\n- Compute the expected counts under HWE at $\\hat{p}$: $E_{AA} = n \\hat{p}^2$, $E_{Aa} = n \\cdot 2 \\hat{p} \\hat{q}$, $E_{aa} = n \\hat{q}^2$.\n- Compute the Pearson chi-square statistic\n\n$$\nX^2 \\;=\\; \\sum_{g \\in \\{AA, Aa, aa\\}} \\frac{(O_g - E_g)^2}{E_g}.\n$$\n\n- Compute the $p$-value as $P(\\chi^2_{1} \\ge X^2)$, where $\\chi^2_{1}$ denotes a chi-square random variable with $1$ degree of freedom.\n\nImplementation requirements:\n- All random number generation must be reproducible by using the provided integer seeds.\n- Genotype sampling under HWE must be performed directly from a multinomial distribution with category probabilities $p^2$, $2p(1-p)$, and $(1-p)^2$ for $(AA, Aa, aa)$, respectively.\n- The final answers for each test case must be expressed as decimals in $[0,1]$ rounded to exactly four digits after the decimal point. Do not use the percentage sign.\n\nTest suite:\nImplement the simulation for the following parameter sets. Each test case is a tuple $(n, p, \\alpha, R, \\text{seed})$.\n- Case A: $(n = 20, p = 0.5, \\alpha = 0.05, R = 50000, \\text{seed} = 314159)$.\n- Case B: $(n = 50, p = 0.05, \\alpha = 0.05, R = 100000, \\text{seed} = 271828)$.\n- Case C: $(n = 200, p = 0.5, \\alpha = 0.05, R = 50000, \\text{seed} = 161803)$.\n- Case D: $(n = 1000, p = 0.5, \\alpha = 0.05, R = 50000, \\text{seed} = 141421)$.\n\nOutput specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test cases above. Each entry must be a float rounded to exactly four digits after the decimal point. For example, an output with four results must look like $[0.0612,0.0840,0.0504,0.0489]$.\n\nNotes on coverage and edge cases:\n- Case A probes small-sample behavior around the common recommendation that expected counts be at least $5$.\n- Case B probes a rare-allele regime where small expected counts can inflate the false positive rate under the chi-square approximation.\n- Cases C and D probe larger $n$, illustrating that with increasing $n$, the false positive rate should approach the nominal $\\alpha$ under the ideal null.\n- There are no physical units involved. All numerical answers must be decimals as specified.", "solution": "The task is to perform a Monte Carlo simulation to estimate the true Type I error rate (the false positive rate) of the Pearson's chi-square test for Hardy-Weinberg equilibrium. The null hypothesis, $H_0$, is that the population is in HWE. The simulation generates data for which $H_0$ is true by design. Any rejection of $H_0$ is therefore a Type I error. The fraction of such rejections across many replicates provides an empirical estimate of this error rate. The expectation is that this rate will approximate the nominal significance level $\\alpha$ only when the assumptions of the chi-square test are met, namely, sufficiently large expected counts for each genotype.\n\nThe algorithmic procedure for each test case is as follows:\n\n1.  **Initialization**: The random number generator is initialized with the specified `seed`. This step is non-negotiable for ensuring the reproducibility of scientific computation.\n\n2.  **Data Generation**: For each of the $R$ replicates, we must generate a random sample of $n$ individuals. The genotypes are $\\{AA, Aa, aa\\}$. Under HWE with a true allele-$A$ frequency of $p$, the probabilities of these genotypes are $\\{p^2, 2p(1-p), (1-p)^2\\}$. The counts of these genotypes, $(O_{AA}, O_{Aa}, O_{aa})$, in a sample of size $n$ follow a multinomial distribution. We generate $R$ such sets of counts. For efficiency, this is vectorized, generating an $R \\times 3$ matrix of observed counts in a single operation.\n\n3.  **Parameter Estimation**: For each of the $R$ replicates, the true allele frequency $p$ is considered unknown, as it would be in a real experiment. We must estimate it from the sampled data. The maximum likelihood estimate of the allele-$A$ frequency, denoted $\\hat{p}$, is calculated from the observed genotype counts:\n    $$\n    \\hat{p} = \\frac{2 \\cdot O_{AA} + 1 \\cdot O_{Aa}}{2n}\n    $$\n    The denominator $2n$ represents the total number of alleles in the sample. The frequency of the other allele is simply $\\hat{q} = 1 - \\hat{p}$.\n\n4.  **Calculation of Expected Counts**: Based on the estimated allele frequency $\\hat{p}$, we calculate the expected genotype counts under the null hypothesis of HWE for each replicate:\n    $$\n    E_{AA} = n \\hat{p}^2 \\\\\n    E_{Aa} = n \\cdot 2\\hat{p}\\hat{q} \\\\\n    E_{aa} = n \\hat{q}^2\n    $$\n    These are the counts we would expect to see if the sample were in HWE with the allele frequency $\\hat{p}$.\n\n5.  **Chi-Square Statistic Calculation**: The Pearson's chi-square statistic, $X^2$, measures the discrepancy between observed and expected counts. It is computed for each replicate:\n    $$\n    X^2 = \\sum_{g \\in \\{AA, Aa, aa\\}} \\frac{(O_g - E_g)^2}{E_g}\n    $$\n    A critical detail in implementation is the handling of division by zero. If an expected count $E_g$ is $0$, it must be that the corresponding observed count $O_g$ is also $0$ (this occurs if $\\hat{p}=0$ or $\\hat{p}=1$). In such cases, the term $\\frac{(0-0)^2}{0}$ is defined as $0$. The implementation must enforce this to avoid computational errors.\n\n6.  **P-Value Determination**: When the allele frequency is estimated from the data, the $X^2$ statistic asymptotically follows a chi-square distribution with $k - 1 - m$ degrees of freedom, where $k$ is the number of categories ($3$ genotypes) and $m$ is the number of estimated parameters ($1$ parameter, $p$). Thus, the degrees of freedom is $3 - 1 - 1 = 1$. The $p$-value for each replicate is the probability of obtaining a test statistic at least as extreme as the observed $X^2$, given that the null hypothesis is true. This is calculated using the survival function (SF) of the $\\chi^2_1$ distribution:\n    $$\n    p\\text{-value} = P(\\chi^2_{df=1} \\ge X^2)\n    $$\n\n7.  **False Positive Rate**: For each replicate, the $p$-value is compared against the pre-defined significance level $\\alpha$. If $p\\text{-value} < \\alpha$, the null hypothesis is rejected. Since we know the null hypothesis is true by construction, this rejection is a false positive. The total number of false positives is counted across all $R$ replicates. The empirical false positive rate is then:\n    $$\n    \\text{Rate} = \\frac{\\text{Number of False Positives}}{R}\n    $$\n    This value is then rounded to four decimal places as required.\n\nThe implementation will leverage the `numpy` library for vectorized computations to efficiently handle the large number of replicates and `scipy.stats.chi2` for the statistical calculation.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import chi2\n\ndef solve():\n    \"\"\"\n    Simulates genotype data under Hardy-Weinberg equilibrium (HWE) to\n    calculate the empirical false positive rate of the chi-square test.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (n, p, alpha, R, seed)\n        (20, 0.5, 0.05, 50000, 314159),   # Case A\n        (50, 0.05, 0.05, 100000, 271828), # Case B\n        (200, 0.5, 0.05, 50000, 161803),  # Case C\n        (1000, 0.5, 0.05, 50000, 141421), # Case D\n    ]\n\n    results = []\n    \n    for n, p, alpha, R, seed in test_cases:\n        # 1. Initialization\n        # Set the seed for reproducible random number generation.\n        rng = np.random.default_rng(seed)\n        \n        # 2. Data Generation\n        # Define HWE genotype probabilities: p^2 for AA, 2pq for Aa, q^2 for aa.\n        q = 1.0 - p\n        hwe_probs = np.array([p**2, 2*p*q, q**2])\n        \n        # Generate R replicate samples of size n from the multinomial distribution.\n        # observed_counts will be an (R, 3) NumPy array.\n        observed_counts = rng.multinomial(n, hwe_probs, size=R)\n        \n        # 3. Parameter Estimation\n        # Calculate the sample allele-A frequency (p_hat) for each replicate.\n        # O_AA is in column 0, O_Aa is in column 1.\n        p_hat = (2 * observed_counts[:, 0] + observed_counts[:, 1]) / (2 * n)\n        q_hat = 1.0 - p_hat\n        \n        # 4. Calculation of Expected Counts\n        # Calculate expected counts under HWE using the estimated p_hat.\n        E_AA = n * p_hat**2\n        E_Aa = n * 2 * p_hat * q_hat\n        E_aa = n * q_hat**2\n        \n        expected_counts = np.stack([E_AA, E_Aa, E_aa], axis=1)\n        \n        # 5. Chi-Square Statistic Calculation\n        # Compute the chi-square statistic for each replicate.\n        # Handle the case where expected_counts can be zero to avoid division by zero.\n        # If E_g is 0, then O_g must also be 0, and the term (O_g-E_g)^2/E_g is 0.\n        diff_sq = (observed_counts - expected_counts)**2\n        \n        # Initialize terms to zero.\n        terms = np.zeros_like(diff_sq)\n        \n        # Create a mask to avoid division by zero.\n        # This is the correct way to handle the sum: only divide where expected > 0.\n        mask = expected_counts > 0\n        terms[mask] = diff_sq[mask] / expected_counts[mask]\n        \n        # Sum the terms over the three genotypes for each replicate.\n        chi2_stat = np.sum(terms, axis=1)\n        \n        # 6. P-Value Determination\n        # Calculate the p-value from the chi-square survival function with df=1.\n        # The degrees of freedom is 1 (3 categories - 1 constraint - 1 estimated param).\n        p_values = chi2.sf(chi2_stat, df=1)\n        \n        # 7. False Positive Rate\n        # Count how many p-values are less than the significance level alpha.\n        false_positives_count = np.sum(p_values < alpha)\n        \n        # The empirical false positive rate is the fraction of false positives.\n        fp_rate = false_positives_count / R\n        \n        # Store the result.\n        results.append(fp_rate)\n\n    # Format the final results to exactly four decimal places.\n    formatted_results = [f\"{r:.4f}\" for r in results]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2396474"}]}