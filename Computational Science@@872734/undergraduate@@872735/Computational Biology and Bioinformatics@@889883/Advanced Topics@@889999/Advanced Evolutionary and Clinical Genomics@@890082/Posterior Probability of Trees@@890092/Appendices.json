{"hands_on_practices": [{"introduction": "A primary goal of Bayesian phylogenetics is to quantify our confidence in specific evolutionary relationships. This is often done by calculating the posterior probability of a 'clade,' or monophyletic group. This first exercise [@problem_id:2415452] demonstrates the most fundamental hands-on skill in this process: estimating a clade's posterior probability directly from the set of trees sampled by a Markov chain Monte Carlo (MCMC) simulation.", "problem": "A Bayesian phylogenetic analysis of a molecular sequence alignment produced a Markov chain Monte Carlo (MCMC) posterior sample of $10{,}000$ rooted trees under a specified substitution model and prior. The Maximum A Posteriori (MAP) tree is the single tree $T^{\\ast}$ in the sample with the highest posterior probability among sampled states. Consider a particular monophyletic group $C$ defined by a fixed set of taxa. This group $C$ is not present in the MAP tree $T^{\\ast}$. The MCMC was diagnosed to have reached stationarity after iteration $2{,}000$, and the first $2{,}000$ trees were discarded as burn-in. To reduce autocorrelation, every $5$th tree was retained from the remaining $8{,}000$ trees, yielding a posterior sample of $1{,}600$ trees. In this retained sample, the group $C$ occurs in exactly $482$ trees. Using only this retained posterior sample, compute the posterior probability $\\Pr(C \\mid D)$ of the monophyletic group $C$ given the data $D$. Express your answer as a decimal and round your answer to $4$ significant figures.", "solution": "The problem requires the computation of the posterior probability of a monophyletic group, or clade, denoted as $C$, given a set of molecular sequence data, $D$. This quantity is represented as $\\Pr(C \\mid D)$.\n\nIn the framework of Bayesian phylogenetics, the central object of inference is the posterior probability distribution of phylogenetic trees, $\\Pr(T \\mid D)$, where $T$ represents a tree topology along with its associated branch lengths. This distribution is obtained via Bayes' theorem:\n$$\n\\Pr(T \\mid D) = \\frac{\\Pr(D \\mid T) \\Pr(T)}{\\Pr(D)}\n$$\nwhere $\\Pr(D \\mid T)$ is the likelihood of the data given the tree, $\\Pr(T)$ is the prior probability on trees, and $\\Pr(D)$ is the marginal likelihood, a normalizing constant.\n\nThe posterior probability of a specific feature of the tree, such as the clade $C$, is defined as the sum of the posterior probabilities of all trees that contain this feature. This corresponds to marginalizing over the posterior distribution. If we let $I(C \\in T)$ be an indicator function that equals $1$ if tree $T$ contains clade $C$ and $0$ otherwise, the posterior probability of $C$ is given by the expectation of this indicator function over the posterior distribution:\n$$\n\\Pr(C \\mid D) = \\int I(C \\in T) \\Pr(T \\mid D) \\, dT\n$$\nThis integral over the vast space of all possible trees is computationally intractable to solve analytically. Therefore, it is approximated using a set of samples drawn from the posterior distribution $\\Pr(T \\mid D)$ via a Markov chain Monte Carlo (MCMC) algorithm.\n\nThe Ergodic theorem for Markov chains states that for a sufficiently long chain, the frequency of a state in the sampled sequence converges to the true probability of that state in the stationary distribution. Thus, the posterior probability of clade $C$ can be estimated as the proportion of trees in the MCMC sample that contain $C$.\n\nThe problem provides the following details about the MCMC simulation:\n- The initial MCMC run produced a sample of $10{,}000$ trees.\n- The first $2{,}000$ trees were discarded as burn-in. This is a standard procedure to ensure that the samples are drawn from the stationary distribution of the Markov chain.\n- The number of trees remaining after burn-in is $10{,}000 - 2{,}000 = 8{,}000$.\n- The chain was thinned by retaining every $5$th tree to reduce autocorrelation between successive samples.\n- The final, effective posterior sample consists of $N = \\frac{8{,}000}{5} = 1{,}600$ trees.\n\nThe problem states that within this final sample of $1{,}600$ trees, the clade $C$ is present in exactly $N_C = 482$ trees.\n\nThe estimate for the posterior probability of clade $C$ is the frequency of its occurrence in this final sample:\n$$\n\\Pr(C \\mid D) \\approx \\frac{N_C}{N} = \\frac{482}{1{,}600}\n$$\nThe information that clade $C$ is not present in the Maximum A Posteriori (MAP) tree, $T^{\\ast}$, is irrelevant for this calculation. The MAP tree is the single point estimate corresponding to the mode of the posterior distribution. The posterior probability of a clade, however, is a marginal probability that represents the total probability mass of all trees containing that clade. It is a common occurrence in phylogenetic inference for a clade to have a significant posterior probability (e.g., greater than $0.5$) yet be absent from the MAP tree, especially when the posterior distribution is diffuse across multiple conflicting topologies with similar probabilities.\n\nPerforming the calculation:\n$$\n\\frac{482}{1{,}600} = 0.30125\n$$\nThe problem requires the answer to be expressed as a decimal rounded to $4$ significant figures. The first four significant figures are $3$, $0$, $1$, and $2$. The fifth digit is $5$, so we round up the fourth digit. This yields:\n$$\n\\Pr(C \\mid D) \\approx 0.3013\n$$", "answer": "$$\\boxed{0.3013}$$", "id": "2415452"}, {"introduction": "Beyond simple monophyly, Bayesian methods allow us to test more complex evolutionary scenarios. This practice [@problem_id:2415499] builds on the previous exercise by asking you to calculate the posterior probability that a group of taxa is 'paraphyletic.' Successfully solving this requires translating a qualitative biological hypothesis into a precise set of topological conditions that can be counted within the posterior sample of trees.", "problem": "You are analyzing DNA sequence data $\\mathcal{D}$ from four taxa: three ingroup species $A$, $B$, and $C$ (collectively denoted $G = \\{A, B, C\\}$), and a focal taxon $O$. You perform Bayesian phylogenetic inference under a time-reversible substitution model with a strict molecular clock and fossil calibrations that identify the root, and you place a uniform prior over all rooted binary topologies on these four taxa. After discarding burn-in and confirming convergence, you obtain an equally weighted posterior sample of $N=2000$ rooted trees using Markov chain Monte Carlo (MCMC).\n\nDefine the event $E$ to be: “$G$ is paraphyletic with respect to $O$,” meaning that the most recent common ancestor of $A$, $B$, and $C$ has $O$ as a descendant (equivalently, the minimal clade containing $A$, $B$, and $C$ also contains $O$).\n\nYour MCMC sample can be partitioned into the following mutually exclusive and exhaustive categories, with counts:\n- $1200$ trees in which $G$ is monophyletic and $O$ is outside the clade containing $A$, $B$, and $C$.\n- $400$ trees in which $O$ forms a clade with $A$ inside the clade subtended by the most recent common ancestor of $A$, $B$, and $C$.\n- $280$ trees in which $O$ forms a clade with $B$ inside the clade subtended by the most recent common ancestor of $A$, $B$, and $C$.\n- $120$ trees in which $O$ forms a clade with $C$ inside the clade subtended by the most recent common ancestor of $A$, $B$, and $C$.\n\nStarting from the definition of a Bayesian posterior over trees and the interpretation of posterior probability as an expectation under that posterior, derive an expression for the posterior probability $\\Pr(E \\mid \\mathcal{D})$ and evaluate it using the MCMC sample provided. Express your final answer as a decimal and round your answer to four significant figures. Do not use a percentage sign.", "solution": "We begin from Bayes’ theorem for a discrete space of rooted binary trees $\\mathcal{T}$ on the given taxa. For any tree $T \\in \\mathcal{T}$,\n$$\n\\Pr(T \\mid \\mathcal{D}) \\propto \\Pr(\\mathcal{D} \\mid T)\\,\\Pr(T),\n$$\nwith the proportionality constant given by the model evidence. Under the stated uniform prior over rooted binary topologies and with branch lengths integrated under their priors, this defines a posterior probability mass function over $\\mathcal{T}$.\n\nFor an event $E \\subseteq \\mathcal{T}$, the posterior probability is the posterior expectation of the indicator function $I_{E}(T)$,\n$$\n\\Pr(E \\mid \\mathcal{D}) \\;=\\; \\sum_{T \\in \\mathcal{T}} I_{E}(T)\\,\\Pr(T \\mid \\mathcal{D}) \\;=\\; \\mathbb{E}_{T \\sim \\Pr(\\cdot \\mid \\mathcal{D})}\\!\\big[I_{E}(T)\\big],\n$$\nwhere $I_{E}(T)=1$ if $T \\in E$ and $I_{E}(T)=0$ otherwise.\n\nMarkov chain Monte Carlo (MCMC) provides an empirical approximation to this expectation via Monte Carlo integration. Given an equally weighted posterior sample $\\{T_{i}\\}_{i=1}^{N}$ drawn from $\\Pr(\\cdot \\mid \\mathcal{D})$, the Monte Carlo estimator for $\\Pr(E \\mid \\mathcal{D})$ is\n$$\n\\widehat{\\Pr}(E \\mid \\mathcal{D}) \\;=\\; \\frac{1}{N}\\sum_{i=1}^{N} I_{E}(T_{i}) \\;=\\; \\frac{\\#\\{i: T_{i} \\in E\\}}{N}.\n$$\n\nBy the problem’s definition, $E$ occurs precisely when $O$ is a descendant of the most recent common ancestor of $A$, $B$, and $C$, i.e., when $O$ is nested within the minimal clade containing $A$, $B$, and $C$. In the provided categorization, the event $E$ corresponds exactly to the three categories in which $O$ forms a clade with one of $A$, $B$, or $C$ inside the clade subtended by the most recent common ancestor of $A$, $B$, and $C$.\n\nLet $n_{AO}$, $n_{BO}$, and $n_{CO}$ denote the counts of trees in which $O$ forms a clade with $A$, $B$, and $C$, respectively, and let $n_{\\text{mono}}$ denote the count in which $G$ is monophyletic with $O$ outside. We are given\n$$\nn_{\\text{mono}} = 1200,\\quad n_{AO} = 400,\\quad n_{BO} = 280,\\quad n_{CO} = 120,\\quad N=2000.\n$$\nThe number of samples satisfying $E$ is\n$$\nn_{E} \\;=\\; n_{AO} + n_{BO} + n_{CO} \\;=\\; 400 + 280 + 120 \\;=\\; 800.\n$$\nTherefore,\n$$\n\\widehat{\\Pr}(E \\mid \\mathcal{D}) \\;=\\; \\frac{n_{E}}{N} \\;=\\; \\frac{800}{2000} \\;=\\; 0.4.\n$$\n\nRounding to four significant figures as required yields $0.4000$.", "answer": "$$\\boxed{0.4000}$$", "id": "2415499"}, {"introduction": "While posterior probabilities for individual clades are crucial, it is also useful to have a single measure of the *overall* uncertainty in the tree topology. Is the posterior probability concentrated on one tree, or is it spread thinly across many competing hypotheses? This final practice [@problem_id:2415418] introduces Shannon entropy, a concept from information theory, as a powerful tool to quantify the total uncertainty of the posterior distribution over tree topologies.", "problem": "A Bayesian phylogenetic analysis was performed on four taxa, yielding a posterior distribution over the three possible unrooted, fully resolved tree topologies, denoted by $T_{1}$, $T_{2}$, and $T_{3}$. After integrating over branch lengths and substitution model parameters, the marginal posterior probabilities for the topologies are:\n$p(T_{1}) = 0.60$, $p(T_{2}) = 0.25$, and $p(T_{3}) = 0.15$.\nTreat this as a discrete posterior distribution over tree topologies. Compute the Shannon entropy $H$ of this distribution using the natural logarithm, that is, measured in nats. Report your final result as a pure number (dimensionless) rounded to $4$ significant figures.", "solution": "The problem requires the computation of the Shannon entropy for a given discrete probability distribution. The distribution describes the posterior probabilities of three distinct unrooted phylogenetic tree topologies, denoted as $T_{1}$, $T_{2}$, and $T_{3}$. The given probabilities are $p(T_{1}) = 0.60$, $p(T_{2}) = 0.25$, and $p(T_{3}) = 0.15$. These probabilities sum to $0.60 + 0.25 + 0.15 = 1.00$, which confirms it is a valid probability mass function.\n\nThe Shannon entropy, $H$, of a discrete random variable with a set of possible outcomes $\\{x_1, x_2, \\dots, x_n\\}$ and associated probabilities $p(x_i)$ is defined by the formula:\n$$ H = - \\sum_{i=1}^{n} p(x_i) \\log_{b} p(x_i) $$\nIn this problem, the entropy is to be measured in nats, which implies the use of the natural logarithm (base $e$). Therefore, the formula becomes:\n$$ H = - \\sum_{i=1}^{n} p(x_i) \\ln(p(x_i)) $$\n\nFor the given set of three topologies and their posterior probabilities, the entropy is calculated as follows:\n$$ H = - \\left[ p(T_{1})\\ln(p(T_{1})) + p(T_{2})\\ln(p(T_{2})) + p(T_{3})\\ln(p(T_{3})) \\right] $$\nSubstituting the numerical values for the probabilities:\n$$ H = - \\left[ 0.60 \\ln(0.60) + 0.25 \\ln(0.25) + 0.15 \\ln(0.15) \\right] $$\nWe proceed to evaluate the expression.\nThe individual terms within the bracket are:\n$$ 0.60 \\ln(0.60) \\approx 0.60 \\times (-0.5108256) \\approx -0.30649536 $$\n$$ 0.25 \\ln(0.25) \\approx 0.25 \\times (-1.3862944) \\approx -0.34657360 $$\n$$ 0.15 \\ln(0.15) \\approx 0.15 \\times (-1.8971200) \\approx -0.28456800 $$\nSumming these values gives the total sum inside the brackets:\n$$ \\sum_{i=1}^{3} p(T_{i}) \\ln(p(T_{i})) \\approx -0.30649536 - 0.34657360 - 0.28456800 \\approx -0.93763696 $$\nThe entropy $H$ is the negative of this sum:\n$$ H = -(-0.93763696) \\approx 0.93763696 $$\nThe problem requires the final answer to be reported as a pure number rounded to $4$ significant figures. The first four significant figures are $9, 3, 7, 6$. The fifth significant figure is $3$, which is less than $5$, so we do not round up the last digit.\nTherefore, the entropy rounded to $4$ significant figures is $0.9376$.", "answer": "$$\\boxed{0.9376}$$", "id": "2415418"}]}