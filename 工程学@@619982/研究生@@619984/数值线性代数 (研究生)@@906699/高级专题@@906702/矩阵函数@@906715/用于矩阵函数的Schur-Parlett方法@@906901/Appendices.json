{
        "hands_on_practices": [
            {
                "introduction": "第一个实践旨在奠定基础。我们将通过一个带有复共轭特征值的 $2 \\times 2$ 实矩阵，逐步演练 Schur-Parlett 方法的核心流程。这个练习 [@problem_id:3596559] 揭示了该方法的基本思想：将问题变换到一个更简单的（上三角）基底下求解，然后再将结果变换回来。",
                "problem": "设 $B \\in \\mathbb{R}^{2 \\times 2}$ 为\n$$\nB \\;=\\; \\begin{pmatrix} 4  6 \\\\ -6  4 \\end{pmatrix}.\n$$\n考虑由主标量对数导出的主矩阵函数，即通过解析函数演算定义的主矩阵对数 $\\log(B)$。仅使用舒尔分解的基本原理以及上三角矩阵上主矩阵函数的定义，计算标量\n$$\n\\operatorname{trace}\\big(\\log(B)\\big).\n$$\n你的方法必须首先将 $B$ 变换为其复舒尔形式，然后将标量函数应用于复特征值以获得舒尔因子的函数，最后映射回实数算术以确定与共轭特征对对应的实 $2 \\times 2$ 块。将你的最终答案表示为单个闭式解析表达式。不需要四舍五入。[@problem_id:48]",
                "solution": "问题是计算给定 $2 \\times 2$ 实矩阵 $B$ 的主矩阵对数的迹。问题指定方法必须基于复舒尔分解。\n\n首先，我们对问题陈述进行验证。\n给定矩阵为 $B = \\begin{pmatrix} 4  6 \\\\ -6  4 \\end{pmatrix}$。这是一个 $\\mathbb{R}^{2 \\times 2}$ 中的矩阵。要应用的函数是主矩阵对数 $\\log(B)$。要计算的量是 $\\operatorname{trace}(\\log(B))$。方法是指定的：使用复舒尔分解。\n该问题在科学上基于数值线性代数，特别是矩阵函数理论。为了定义矩阵的主对数，其特征值不能位于非正实轴 $(-\\infty, 0]$ 上。我们通过求解特征方程 $\\det(B - \\lambda I) = 0$ 来求 $B$ 的特征值。\n$$\n\\det\\begin{pmatrix} 4-\\lambda  6 \\\\ -6  4-\\lambda \\end{pmatrix} = (4-\\lambda)^2 - (6)(-6) = (4-\\lambda)^2 + 36 = 0\n$$\n这得到 $(4-\\lambda)^2 = -36$，所以 $4-\\lambda = \\pm\\sqrt{-36} = \\pm 6i$。\n特征值为 $\\lambda_1 = 4 - 6i$ 和 $\\lambda_2 = 4 + 6i$。\n由于两个特征值都不是非正实数，因此主对数对于 $B$ 的谱是良定义的，因此，主矩阵函数 $\\log(B)$ 是良定义的。因此，该问题在数学和科学上是合理的、适定的、客观的和完整的。我们可以继续进行求解。\n\n指定的方法始于 $B$ 的复舒尔分解，该分解指出任何方阵 $B$ 都可以写成 $B = UTU^*$，其中 $U$ 是一个酉矩阵，$T$ 是一个上三角矩阵。$T$ 的对角线元素是 $B$ 的特征值。\n\n由于 $B$ 是一个实矩阵且具有复共轭特征值，它是正规矩阵 ($BB^T = B^TB$) 的一个特例，因此可以通过酉变换对角化。这意味着它的舒尔形式 $T$ 将是一个对角矩阵。\n\n我们来求特征向量。对于 $\\lambda_1 = 4 - 6i$：\n$$\n(B - \\lambda_1 I)v_1 = \\begin{pmatrix} 6i  6 \\\\ -6  6i \\end{pmatrix} \\begin{pmatrix} x \\\\ y \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n第一行意味着 $6ix + 6y = 0$，或 $y = -ix$。我们可以选择 $v_1 = \\begin{pmatrix} 1 \\\\ -i \\end{pmatrix}$。\n对于 $\\lambda_2 = 4 + 6i$：\n$$\n(B - \\lambda_2 I)v_2 = \\begin{pmatrix} -6i  6 \\\\ -6  -6i \\end{pmatrix} \\begin{pmatrix} x \\\\ y \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n第一行意味着 $-6ix + 6y = 0$，或 $y = ix$。我们可以选择 $v_2 = \\begin{pmatrix} 1 \\\\ i \\end{pmatrix}$。\n\n我们将特征向量归一化以形成酉矩阵 $U$ 的列：\n$$\nu_1 = \\frac{1}{\\sqrt{|1|^2 + |-i|^2}} \\begin{pmatrix} 1 \\\\ -i \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ -i \\end{pmatrix}\n$$\n$$\nu_2 = \\frac{1}{\\sqrt{|1|^2 + |i|^2}} \\begin{pmatrix} 1 \\\\ i \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ i \\end{pmatrix}\n$$\n酉矩阵 $U$ 为 $U = \\frac{1}{\\sqrt{2}}\\begin{pmatrix} 1  1 \\\\ -i  i \\end{pmatrix}$。其共轭转置为 $U^* = \\frac{1}{\\sqrt{2}}\\begin{pmatrix} 1  i \\\\ 1  -i \\end{pmatrix}$。\n舒尔分解为 $B = UTU^*$，其中 $T = \\begin{pmatrix} \\lambda_1  0 \\\\ 0  \\lambda_2 \\end{pmatrix} = \\begin{pmatrix} 4-6i  0 \\\\ 0  4+6i \\end{pmatrix}$。\n\n下一步是计算 $F = \\log(T)$。对于对角矩阵，这是通过将函数应用于每个对角元素来完成的。\n$$\nF = \\log(T) = \\begin{pmatrix} \\log(4-6i)  0 \\\\ 0  \\log(4+6i) \\end{pmatrix}\n$$\n主复对数定义为 $\\log(z) = \\ln|z| + i \\operatorname{Arg}(z)$，其中 $\\operatorname{Arg}(z) \\in (-\\pi, \\pi]$。\n对于 $z_1 = 4-6i$：\n$|z_1| = \\sqrt{4^2 + (-6)^2} = \\sqrt{16+36} = \\sqrt{52}$。\n$\\operatorname{Arg}(z_1) = \\arctan\\left(\\frac{-6}{4}\\right) = -\\arctan\\left(\\frac{3}{2}\\right)$。\n所以，$\\log(4-6i) = \\ln(\\sqrt{52}) - i\\arctan\\left(\\frac{3}{2}\\right) = \\frac{1}{2}\\ln(52) - i\\arctan\\left(\\frac{3}{2}\\right)$。\n\n对于 $z_2 = 4+6i$：\n$|z_2| = \\sqrt{4^2 + 6^2} = \\sqrt{52}$。\n$\\operatorname{Arg}(z_2) = \\arctan\\left(\\frac{6}{4}\\right) = \\arctan\\left(\\frac{3}{2}\\right)$。\n所以，$\\log(4+6i) = \\ln(\\sqrt{52}) + i\\arctan\\left(\\frac{3}{2}\\right) = \\frac{1}{2}\\ln(52) + i\\arctan\\left(\\frac{3}{2}\\right)$。\n\n矩阵函数 $\\log(B)$ 由 $\\log(B) = U F U^*$ 给出。\n我们需要计算 $\\operatorname{trace}(\\log(B))$。利用迹的循环性质 $\\operatorname{trace}(ABC) = \\operatorname{trace}(CAB)$：\n$$\n\\operatorname{trace}(\\log(B)) = \\operatorname{trace}(U F U^*) = \\operatorname{trace}(F U^* U)\n$$\n由于 $U$ 是酉矩阵，$U^*U = I$，单位矩阵。\n$$\n\\operatorname{trace}(\\log(B)) = \\operatorname{trace}(F)\n$$\n$F$ 的迹是其对角元素之和，这等于 $B$ 的特征值的主对数之和：\n$$\n\\operatorname{trace}(F) = \\log(4-6i) + \\log(4+6i)\n$$\n$$\n\\operatorname{trace}(F) = \\left( \\frac{1}{2}\\ln(52) - i\\arctan\\left(\\frac{3}{2}\\right) \\right) + \\left( \\frac{1}{2}\\ln(52) + i\\arctan\\left(\\frac{3}{2}\\right) \\right)\n$$\n虚部相消：\n$$\n\\operatorname{trace}(\\log(B)) = \\frac{1}{2}\\ln(52) + \\frac{1}{2}\\ln(52) = \\ln(52)\n$$\n这个问题还要求我们考虑将结果映射回实数算术。如果我们计算完整的矩阵 $\\log(B) = UFU^*$，我们会得到：\n设 $\\log(\\lambda_1) = x-iy$ 和 $\\log(\\lambda_2)=x+iy$，其中 $x=\\frac{1}{2}\\ln(52)$ 且 $y=\\arctan(\\frac{3}{2})$。\n$$\n\\log(B) = \\frac{1}{2} \\begin{pmatrix} 1  1 \\\\ -i  i \\end{pmatrix} \\begin{pmatrix} x-iy  0 \\\\ 0  x+iy \\end{pmatrix} \\begin{pmatrix} 1  i \\\\ 1  -i \\end{pmatrix}\n$$\n$$\n\\log(B) = \\frac{1}{2} \\begin{pmatrix} x-iy  x+iy \\\\ -i(x-iy)  i(x+iy) \\end{pmatrix} \\begin{pmatrix} 1  i \\\\ 1  -i \\end{pmatrix} = \\frac{1}{2} \\begin{pmatrix} (x-iy)+(x+iy)  i(x-iy)-i(x+iy) \\\\ -i(x-iy)+i(x+iy)  (x-iy)+(x+iy) \\end{pmatrix}\n$$\n$$\n\\log(B) = \\frac{1}{2} \\begin{pmatrix} 2x  -2iy-2iy \\\\ -y+y  2x \\end{pmatrix} = \\begin{pmatrix} x  -2y \\\\ -y+y  2x \\end{pmatrix}  = \\begin{pmatrix} x  y \\\\ -y  x \\end{pmatrix}\n$$\n抱歉，计算中有错误。让我们重新计算最后一步：\n$$\n\\log(B) = \\frac{1}{2} \\begin{pmatrix} (x-iy) + (x+iy)  i(x-iy) - i(x+iy) \\\\ -i(x-iy) + i(x+iy)  (-i)i(x-iy) + i(-i)(x+iy) \\end{pmatrix}\n= \\frac{1}{2} \\begin{pmatrix} 2x  ix+y-ix+y \\\\ -ix-y+ix-y  (x-iy)+(x+iy) \\end{pmatrix}\n= \\frac{1}{2} \\begin{pmatrix} 2x  2y \\\\ -2y  2x \\end{pmatrix} = \\begin{pmatrix} x  y \\\\ -y  x \\end{pmatrix}\n$$\n代入 $x$ 和 $y$ 的值：\n$$\n\\log(B) = \\begin{pmatrix} \\frac{1}{2}\\ln(52)  \\arctan(\\frac{3}{2}) \\\\ -\\arctan(\\frac{3}{2})  \\frac{1}{2}\\ln(52) \\end{pmatrix}\n$$\n这个实的 $2 \\times 2$ 块的迹是 $\\frac{1}{2}\\ln(52) + \\frac{1}{2}\\ln(52) = \\ln(52)$。所有步骤都证实了该结果。",
                "answer": "$$\\boxed{\\ln(52)}$$",
                "id": "3596559"
            },
            {
                "introduction": "标量 Parlett 递推存在一个致命弱点：当特征值重复时，该方法会失效。本练习将直面这一问题，通过一个具体例子展示在特征值重复时，朴素的逐元素计算方法如何导致除以零的错误。通过切换到分块的视角 [@problem_id:3596561]，我们将看到 Schur-Parlett 方法是如何巧妙地规避这一奇点，从而突显分块策略的重要性。",
                "problem": "设 $T\\in\\mathbb{C}^{4\\times 4}$ 是一个显式上三角矩阵\n$$\nT=\\begin{pmatrix}\n1  2  1  -2\\\\\n0  1  3  5\\\\\n0  0  2  4\\\\\n0  0  0  3\n\\end{pmatrix},\n$$\n其对角元（特征值）满足 $\\lambda_{1}=\\lambda_{2}=1$, $\\lambda_{3}=2$ 和 $\\lambda_{4}=3$，并且所有超对角元均非零。考虑标量函数 $f(z)=\\frac{1}{z}$，该函数在任何不包含 $z=0$ 的域上都是解析的。在 Schur–Parlett 方法中，首先将矩阵约化为上三角形式（此处 $T$ 已是上三角矩阵），然后应用递推关系逐元计算 $f(T)$。\n\n从有理泛函演算给出的矩阵函数的基本定义出发（即，对于有理函数 $f$，通过对定义了该函数的矩阵有效的代数恒等式来解释 $f(T)$），解答以下问题：\n\n- 从概念层面解释，并基于这些定义，且不使用现成的快捷公式，为什么标量（逐元）Parlett 递推在试图确定跨越重复特征值的非对角元 $[f(T)]_{ij}$ 时（具体来说，是当 $\\lambda_{1}=\\lambda_{2}=1$ 时，对于 $i=1$ 和 $j=2$ 的情况）会遇到奇异方程。特别地，阐明相等的对角元如何导致一个不定条件，而从差商的角度看，这个不定条件可以被识别为一个除零障碍。\n\n- 为避免此障碍，将 $T$ 划分成一个与重复特征值对应的 $2\\times 2$ 主对角块和一个 $2\\times 2$ 尾对角块，并使用与 Schur–Parlett 方法一致的分块推理来精确计算单个元素 $[f(T)]_{14}$。你的计算必须从有理泛函演算所蕴含的基本分块方程出发，并且不得假定任何快捷的求逆公式。给出 $[f(T)]_{14}$ 的精确值作为你的最终答案。无需四舍五入。",
                "solution": "有理泛函演算为矩阵函数提供了一个基本的出发点：如果 $f$ 是一个有理函数，且 $T$ 是一个 $f$ 在其上有定义的矩阵（即，$f$ 的极点均不在 $T$ 的谱中），那么 $f(T)$ 是满足从 $f$ 继承的代数恒等式的唯一矩阵。对于 $f(z)=\\frac{1}{z}$ 和一个可逆矩阵 $T$，该定义特化为 $f(T)=T^{-1}$，因为恒等式 $z\\cdot \\frac{1}{z}=1$ 转移到矩阵上即为 $T\\cdot f(T)=I$ 和 $f(T)\\cdot T=I$，其中 $I$ 是单位矩阵。我们的矩阵 $T$ 的对角元为 $1, 1, 2, 3$，均不为 $0$，因此 $T$ 是可逆的，且 $f(T)=T^{-1}$ 存在。\n\n**第一部分：解释奇异性**\n\n标量 Parlett 递推源于对易关系 $X T = T X$，其中 $X = f(T)$。考察该矩阵方程的 $(i, j)$ 元素（$i  j$），我们得到：\n$$ \\sum_{k=i}^{j} X_{ik} T_{kj} = \\sum_{k=i}^{j} T_{ik} X_{kj} $$\n分离出 $X_{ij}$ 项：\n$$ X_{ii} T_{ij} + X_{ij} T_{jj} + \\sum_{k=i+1}^{j-1} X_{ik} T_{kj} = T_{ii} X_{ij} + T_{ij} X_{jj} + \\sum_{k=i+1}^{j-1} T_{ik} X_{kj} $$\n整理后得到 $X_{ij}$ 的表达式：\n$$ X_{ij} (T_{ii} - T_{jj}) = T_{ij}(X_{jj} - X_{ii}) + \\sum_{k=i+1}^{j-1} (T_{ik} X_{kj} - X_{ik} T_{kj}) $$\n因为 $X_{kk} = f(T_{kk})$，即 $X_{ii}=f(\\lambda_i)$ 和 $X_{jj}=f(\\lambda_j)$，其中 $\\lambda_k=T_{kk}$ 是特征值。\n\n当 $i=1, j=2$ 时，特征值 $\\lambda_1 = T_{11} = 1$ 和 $\\lambda_2 = T_{22} = 1$ 是重复的。代入上述方程，左边的因子 $(T_{11} - T_{22})$ 变为 0。右边的因子 $(X_{22} - X_{11})$ 也变为 $f(\\lambda_2) - f(\\lambda_1) = f(1) - f(1) = 0$。求和项为空。于是方程变为：\n$$ X_{12} \\cdot 0 = T_{12} \\cdot 0 $$\n即 $0 = 0$。这是一个不确定方程，无法唯一确定 $X_{12}$ 的值。\n从差商的角度看，如果 $\\lambda_1 \\neq \\lambda_2$，我们可以解得 $X_{12} = T_{12} \\frac{f(\\lambda_1) - f(\\lambda_2)}{\\lambda_1 - \\lambda_2}$。当 $\\lambda_1 = \\lambda_2$ 时，这会导致形式为 $0/0$ 的不定式，即除零障碍。\n\n**第二部分：使用分块方法计算 $[f(T)]_{14}$**\n\n为了避免这个问题，我们采用分块方法。我们将 $T$ 划分为 $2 \\times 2$ 的块：\n$$ T = \\begin{pmatrix} T_{11}  T_{12} \\\\ 0  T_{22} \\end{pmatrix}, \\quad \\text{其中} \\quad T_{11} = \\begin{pmatrix} 1  2 \\\\ 0  1 \\end{pmatrix}, \\quad T_{12} = \\begin{pmatrix} 1  -2 \\\\ 3  5 \\end{pmatrix}, \\quad T_{22} = \\begin{pmatrix} 2  4 \\\\ 0  3 \\end{pmatrix} $$\n矩阵 $X=f(T)=T^{-1}$ 同样具有分块上三角结构：$X = \\begin{pmatrix} X_{11}  X_{12} \\\\ 0  X_{22} \\end{pmatrix}$。\n对角块的函数是块的函数：$X_{11} = f(T_{11}) = T_{11}^{-1}$ 且 $X_{22} = f(T_{22}) = T_{22}^{-1}$。\n非对角块 $X_{12}$ 由西尔维斯特方程确定。从 $TX=I$ 的分块形式 $\\begin{pmatrix} T_{11}  T_{12} \\\\ 0  T_{22} \\end{pmatrix} \\begin{pmatrix} X_{11}  X_{12} \\\\ 0  X_{22} \\end{pmatrix} = \\begin{pmatrix} I  0 \\\\ 0  I \\end{pmatrix}$ 中，我们得到右上角块的方程：\n$$ T_{11} X_{12} + T_{12} X_{22} = 0 $$\n因此，$T_{11} X_{12} = -T_{12} X_{22}$。由于 $T_{11}$ 和 $T_{22}$ 的谱（分别为 $\\{1\\}$ 和 $\\{2, 3\\}$）不相交，这个方程有唯一解。\n\n我们先计算 $X_{22} = T_{22}^{-1}$：\n$$ T_{22}^{-1} = \\begin{pmatrix} 2  4 \\\\ 0  3 \\end{pmatrix}^{-1} = \\frac{1}{2 \\cdot 3 - 4 \\cdot 0} \\begin{pmatrix} 3  -4 \\\\ 0  2 \\end{pmatrix} = \\begin{pmatrix} 1/2  -2/3 \\\\ 0  1/3 \\end{pmatrix} $$\n然后，我们计算右侧项 $-T_{12} X_{22}$：\n$$ -T_{12} X_{22} = - \\begin{pmatrix} 1  -2 \\\\ 3  5 \\end{pmatrix} \\begin{pmatrix} 1/2  -2/3 \\\\ 0  1/3 \\end{pmatrix} = - \\begin{pmatrix} 1/2  -2/3 - 2/3 \\\\ 3/2  -6/3 + 5/3 \\end{pmatrix} = - \\begin{pmatrix} 1/2  -4/3 \\\\ 3/2  -1/3 \\end{pmatrix} = \\begin{pmatrix} -1/2  4/3 \\\\ -3/2  1/3 \\end{pmatrix} $$\n现在我们求解 $T_{11} X_{12} = \\begin{pmatrix} -1/2  4/3 \\\\ -3/2  1/3 \\end{pmatrix}$。令 $X_{12} = \\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix}$。\n$$ \\begin{pmatrix} 1  2 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix} = \\begin{pmatrix} a+2c  b+2d \\\\ c  d \\end{pmatrix} = \\begin{pmatrix} -1/2  4/3 \\\\ -3/2  1/3 \\end{pmatrix} $$\n从第二行，我们直接得到 $c = -3/2$ 和 $d = 1/3$。\n将这些值代入第一行：\n$a + 2(-3/2) = -1/2 \\implies a - 3 = -1/2 \\implies a = 5/2$。\n$b + 2(1/3) = 4/3 \\implies b + 2/3 = 4/3 \\implies b = 2/3$。\n所以，$X_{12} = \\begin{pmatrix} 5/2  2/3 \\\\ -3/2  1/3 \\end{pmatrix}$。\n\n我们要求解的元素是 $[f(T)]_{14}$，即 $X$ 矩阵中第 1 行第 4 列的元素。这对应于 $X_{12}$ 块中的第 1 行第 2 列的元素，即 $b$。\n因此，$[f(T)]_{14} = 2/3$。",
                "answer": "$$\\boxed{\\frac{2}{3}}$$",
                "id": "3596561"
            },
            {
                "introduction": "理论是一回事，但浮点运算带来了其独特的挑战。最后一个动手实践是一个编码练习，旨在探索当特征值并非完全相等但极其接近时，该方法的数值脆弱性。通过实现一个朴素的差商计算 [@problem_id:3596587]，你将亲眼见证灾难性抵消现象，并理解为何稳健的算法实现必须采用更复杂的技巧来处理这种情况。",
                "problem": "考虑一个解析矩阵函数 $f$ 通过解析函数演算作用于一个方阵 $A \\in \\mathbb{C}^{n \\times n}$：对于在一个包含 $A$ 的谱的域上解析的函数 $f$，$f(A)$ 通过围道积分定义，或者在幂级数收敛时等价地由幂级数定义。Schur–Parlett 方法通过首先计算酉 Schur 分解 $A = Q T Q^{*}$（其中 $T$ 是上三角矩阵），然后通过 Parlett 递推来计算 $f(T)$，从而计算 $f(A)$。当 $T$ 的对角线元素互不相同时，Parlett 递推使用差商系统地计算 $f(T)$ 的元素；当对角线元素聚集或重合时，则使用分块方法。本问题的理论基础是矩阵的解析函数演算、酉 Schur 分解的存在性以及解析函数的泰勒级数表示。\n\n您将研究 Schur–Parlett 方法在处理具有非平凡 Jordan 块且趋近于亏损的矩阵时的行为，此时特征值的聚集/合并会导致差商的敏感性。重点关注整函数 $f(z) = e^{z}$。\n\n构造上三角矩阵族\n$$\nA(\\varepsilon) = \\begin{bmatrix}\n\\lambda  1  0 \\\\\n0  \\lambda + \\varepsilon  1 \\\\\n0  0  \\lambda + 2\\varepsilon\n\\end{bmatrix},\n$$\n其中 $\\lambda \\in \\mathbb{R}$，参数 $\\varepsilon \\in \\mathbb{R}$。当 $\\varepsilon = 0$ 时，$A(0)$ 是亏损的，在特征值 $\\lambda$ 处有一个大小为 $3$ 的 Jordan 块。\n\n对于 $f(z) = e^{z}$ 和上述特殊的三角结构， $f(A(\\varepsilon))$ 的元素可以用差商 $f^{[k]}(\\cdot)$ 来表征。差商由 $f$ 递归定义，并将导数推广到多个节点。当 $\\varepsilon \\to 0$ 时，对近乎重合的节点计算这些差商，如果采用朴素计算，会变得病态，导致敏感性和潜在的数值不稳定性。\n\n任务：\n1. 对此 $3 \\times 3$ 结构，实现 $f(A(\\varepsilon))$ 的朴素差商计算：\n   - 令 $F_{ii} = f(\\lambda_i)$，其中 $\\lambda_0 = \\lambda$，$\\lambda_1 = \\lambda + \\varepsilon$，$\\lambda_2 = \\lambda + 2\\varepsilon$。\n   - 令 $F_{i,i+1} = f^{[1]}(\\lambda_i, \\lambda_{i+1})$，其中 $i = 0,1$，且 $f^{[1]}(x,y) = \\dfrac{f(x) - f(y)}{x - y}$ 是直接由 $f$ 计算，不使用任何特殊的数值稳定化方法。\n   - 令 $F_{0,2} = f^{[2]}(\\lambda_0, \\lambda_1, \\lambda_2)$，使用标准递推公式 $f^{[2]}(x_0,x_1,x_2) = \\dfrac{f^{[1]}(x_0,x_1) - f^{[1]}(x_1,x_2)}{x_0 - x_2}$，同样是直接由 $f$ 计算，不进行稳定化处理。\n   - 将其余所有元素设为零；得到的矩阵 $F$ 是基于差商的 $f(A(\\varepsilon))$ 的朴素近似。\n\n2. 对于 $\\varepsilon = 0$ 的情况，使用作用于幂零扰动的解析函数的精确 Jordan 块级数来计算 $f(A(0))$：\n   - 将 $A(0)$ 写为 $A(0) = \\lambda I + N$，其中 $N$ 是严格上三角矩阵且 $N^3 = 0$。\n   - 使用 $f(\\lambda I + N) = e^{\\lambda} \\sum_{k=0}^{2} \\dfrac{N^k}{k!}$ 计算精确的 $f(A(0))$。\n\n3. 在每种情况下，将您的近似与一个可信参考值进行比较，测量其相对 Frobenius 范数误差。该参考值由 Scientific Python (SciPy) 中的稳健的缩放-平方 Padé 方法实现 $\\operatorname{expm}(A)$ 计算得出。\n\n使用以下测试套件，其中 $\\lambda = 0$：\n- 理想情况：$\\varepsilon = 10^{-1}$。\n- 近乎合并：$\\varepsilon = 10^{-8}$。\n- 极端合并：$\\varepsilon = 10^{-20}$。\n- 亏损 Jordan 情况：$\\varepsilon = 0$。\n\n对于前三种情况，计算朴素差商近似的相对 Frobenius 范数误差。对于亏损 Jordan 情况，计算基于精确级数计算的相对 Frobenius 范数误差。定义近似值 $F_{\\text{approx}}$ 和参考值 $F_{\\text{ref}}$ 的相对 Frobenius 范数误差为\n$$\n\\operatorname{rel\\_err} = \\frac{\\lVert F_{\\text{approx}} - F_{\\text{ref}} \\rVert_{F}}{\\lVert F_{\\text{ref}} \\rVert_{F}},\n$$\n其中 $\\lVert \\cdot \\rVert_{F}$ 是 Frobenius 范数。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的、由逗号分隔的四个浮点数列表，其顺序与四个测试用例相对应：\n$$\n[\\operatorname{rel\\_err}(10^{-1}), \\operatorname{rel\\_err}(10^{-8}), \\operatorname{rel\\_err}(10^{-20}), \\operatorname{rel\\_err}(0)].\n$$\n本问题不涉及物理单位或角度。输出必须严格遵守指定格式。",
                "solution": "该问题要求研究 Schur-Parlett 方法在计算矩阵指数 $f(A) = e^A$ 时的数值稳定性，特别是当矩阵 $A$ 具有近乎合并的特征值时。给定一个特定的 $3 \\times 3$ 上三角矩阵族 $A(\\varepsilon)$，它由 $\\varepsilon \\in \\mathbb{R}$ 参数化，并且当 $\\varepsilon \\to 0$ 时，该矩阵族趋近于一个亏损矩阵。\n\n该矩阵族定义为：\n$$\nA(\\varepsilon) = \\begin{bmatrix}\n\\lambda  1  0 \\\\\n0  \\lambda + \\varepsilon  1 \\\\\n0  0  \\lambda + 2\\varepsilon\n\\end{bmatrix}\n$$\n测试用例指定 $\\lambda = 0$，因此特征值为 $\\lambda_0 = 0$，$\\lambda_1 = \\varepsilon$ 和 $\\lambda_2 = 2\\varepsilon$。\n\n$f(A(\\varepsilon))$ 的计算根据 $\\varepsilon$ 是否为零分为两种主要情况。\n\n**情况 1：非亏损矩阵 ($\\varepsilon \\neq 0$)**\n对于 $\\varepsilon \\neq 0$，$A(\\varepsilon)$ 矩阵具有互异的特征值，因此是可对角化的。由于 $A(\\varepsilon)$ 已经是上三角形式（一种 Schur 型），我们可以通过直接确定其元素来计算 $F = f(A(\\varepsilon))$。矩阵 $F$ 也必须是上三角矩阵，并满足 Sylvester 方程 $F A(\\varepsilon) = A(\\varepsilon) F$。$F$ 的元素可以用函数 $f$ 及其在 $A(\\varepsilon)$ 特征值处的差商来表示。\n\n对于上三角矩阵 $T$（其元素为 $t_{ij}$），$F=f(T)$ 的元素的一般公式由 Parlett 递推给出。对于我们特定的 $3 \\times 3$ 矩阵 $A(\\varepsilon)$，其中 $t_{01} = 1$、$t_{12} = 1$ 且 $t_{02} = 0$，矩阵 $F$ 的元素为：\n- 对角线元素：$F_{ii} = f(\\lambda_i)$。\n$$F_{00} = f(\\lambda_0), \\quad F_{11} = f(\\lambda_1), \\quad F_{22} = f(\\lambda_2)$$\n- 第一条超对角线元素：\n$$F_{01} = A_{01} f^{[1]}(\\lambda_0, \\lambda_1) = 1 \\cdot \\frac{f(\\lambda_0) - f(\\lambda_1)}{\\lambda_0 - \\lambda_1}$$\n$$F_{12} = A_{12} f^{[1]}(\\lambda_1, \\lambda_2) = 1 \\cdot \\frac{f(\\lambda_1) - f(\\lambda_2)}{\\lambda_1 - \\lambda_2}$$\n- 第二条超对角线元素：\n$(0,2)$ 元素的一般公式是 $F_{02} = A_{02}f^{[1]}(\\lambda_0, \\lambda_2) + A_{01}A_{12}f^{[2]}(\\lambda_0, \\lambda_1, \\lambda_2)$。由于 $A_{02} = 0$，这简化为：\n$$F_{02} = f^{[2]}(\\lambda_0, \\lambda_1, \\lambda_2) = \\frac{f^{[1]}(\\lambda_0, \\lambda_1) - f^{[1]}(\\lambda_1, \\lambda_2)}{\\lambda_0 - \\lambda_2}$$\n\n问题要求对这些公式进行“朴素”计算。这意味着我们直接使用它们的定义来计算差商，当 $\\varepsilon$ 很小时，这涉及到分子中两个几乎相等的数的减法。这个过程由于灾难性抵消而导致数值不稳定。例如，当 $\\varepsilon \\to 0$ 时，$f(\\lambda_0)$ 和 $f(\\lambda_1)$ 都趋近于 $f(0)=1$，它们的差 $f(\\lambda_0) - f(\\lambda_1)$ 会损失显著的相对精度。该问题旨在量化这种精度损失。\n\n**情况 2：亏损矩阵 ($\\varepsilon = 0$)**\n当 $\\varepsilon = 0$ 且 $\\lambda = 0$ 时，矩阵变为：\n$$\nA(0) = \\begin{bmatrix}\n0  1  0 \\\\\n0  0  1 \\\\\n0  0  0\n\\end{bmatrix}\n$$\n这是一个幂零 Jordan 块，我们可以将其表示为 $N$。$A(0)$ 是一个亏损矩阵，只有一个代数重数为 $3$、几何重数为 $1$ 的特征值 $0$。\n$f(A(0))$ 可以使用 $f(z)$ 在特征值 $\\lambda=0$ 附近的泰勒级数展开来计算。由于 $A(0)$ 可以写成 $A(0) = \\lambda I + N = N$，我们有：\n$$\nf(A(0)) = \\sum_{k=0}^{\\infty} \\frac{f^{(k)}(0)}{k!} (A(0))^k\n$$\n对于我们的矩阵 $N$，我们有 $N^2 = \\begin{bmatrix} 0  0  1 \\\\ 0  0  0 \\\\ 0  0  0 \\end{bmatrix}$ 并且对于所有 $k \\ge 3$ 都有 $N^k = 0$。因此级数是有限的：\n$$\nf(A(0)) = f(0)I + f'(0)N + \\frac{f''(0)}{2!}N^2\n$$\n给定 $f(z) = e^z$，它的所有导数也都是 $e^z$，因此对于所有 $k \\ge 0$ 都有 $f^{(k)}(0) = e^0 = 1$。所以，$f(A(0))$ 的精确矩阵为：\n$$\nf(A(0)) = 1 \\cdot I + 1 \\cdot N + \\frac{1}{2} N^2 = \\begin{bmatrix} 1  1  0.5 \\\\ 0  1  1 \\\\ 0  0  1 \\end{bmatrix}\n$$\n这种计算是精确的，不会遇到差商方法中的数值不稳定性问题。\n\n**误差测量**\n对于每个测试用例，我们使用上述方法计算一个近似矩阵 $F_{\\text{approx}}$。将其与从 `scipy.linalg.expm` 获得的高保真参考 $F_{\\text{ref}}$ 进行比较，该函数实现了一个稳健的带 Padé 近似的缩放-平方算法。误差通过相对 Frobenius 范数来量化：\n$$\n\\operatorname{rel\\_err} = \\frac{\\lVert F_{\\text{approx}} - F_{\\text{ref}} \\rVert_{F}}{\\lVert F_{\\text{ref}} \\rVert_{F}}\n$$\n我们预计，对于 $\\varepsilon \\neq 0$ 的情况，随着 $\\varepsilon$ 的减小，误差会增加，这表明了朴素方法的失败。对于 $\\varepsilon = 0$ 的情况，由于使用了精确的解析公式，其误差应该接近于机器精度。",
                "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm, norm\n\ndef solve():\n    \"\"\"\n    Solves the problem by evaluating the exponential of a matrix family A(epsilon)\n    using two different methods and comparing the results to a reference implementation.\n\n    The problem investigates the numerical stability of naive divided-difference\n    formulas for computing functions of matrices with nearly coalescing eigenvalues.\n    \"\"\"\n\n    # Define the test suite from the problem statement.\n    test_cases = [\n        # (epsilon_value)\n        1e-1,\n        1e-8,\n        1e-20,\n        0.0,\n    ]\n\n    results = []\n    lambda_val = 0.0\n\n    for eps in test_cases:\n        # Construct the matrix A(epsilon)\n        A = np.array([\n            [lambda_val, 1.0, 0.0],\n            [0.0, lambda_val + eps, 1.0],\n            [0.0, 0.0, lambda_val + 2 * eps]\n        ], dtype=float)\n\n        if eps != 0:\n            # Task 1: Naive divided-difference evaluation for epsilon != 0\n            \n            # Eigenvalues\n            l0 = lambda_val\n            l1 = lambda_val + eps\n            l2 = lambda_val + 2 * eps\n            \n            # Function f(z) = e^z\n            f = np.exp\n            \n            # Initialize approximation matrix F\n            F_approx = np.zeros((3, 3), dtype=float)\n            \n            # Diagonal entries: F_ii = f(lambda_i)\n            F_approx[0, 0] = f(l0)\n            F_approx[1, 1] = f(l1)\n            F_approx[2, 2] = f(l2)\n            \n            # First superdiagonal: F_{i,i+1} = f^{[1]}(lambda_i, lambda_{i+1})\n            # Naive computation: f[1](x, y) = (f(x) - f(y)) / (x - y)\n            F_approx[0, 1] = (f(l0) - f(l1)) / (l0 - l1)\n            F_approx[1, 2] = (f(l1) - f(l2)) / (l1 - l2)\n            \n            # Second superdiagonal: F_{0,2} = f^{[2]}(lambda_0, lambda_1, lambda_2)\n            # Naive computation: f[2](x0, x1, x2) = (f[1](x0, x1) - f[1](x1, x2)) / (x0 - x2)\n            F_approx[0, 2] = (F_approx[0, 1] - F_approx[1, 2]) / (l0 - l2)\n            \n        else: # eps == 0\n            # Task 2: Exact Jordan-block series evaluation for epsilon = 0\n            # For lambda=0 and eps=0, A(0) = N, a nilpotent matrix.\n            # f(A(0)) = I + N + (1/2!) * N^2\n            N = np.array([\n                [0.0, 1.0, 0.0],\n                [0.0, 0.0, 1.0],\n                [0.0, 0.0, 0.0]\n            ], dtype=float)\n            N2 = np.dot(N, N)\n            I = np.identity(3, dtype=float)\n            \n            F_approx = I + N + 0.5 * N2\n\n        # Task 3: Measure relative Frobenius-norm error\n        F_ref = expm(A)\n        \n        error_norm = norm(F_approx - F_ref, 'fro')\n        ref_norm = norm(F_ref, 'fro')\n        \n        # Handle the case where the reference norm is zero to avoid division by zero.\n        if ref_norm == 0:\n            relative_error = error_norm\n        else:\n            relative_error = error_norm / ref_norm\n\n        results.append(relative_error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```",
                "id": "3596587"
            }
        ]
    }