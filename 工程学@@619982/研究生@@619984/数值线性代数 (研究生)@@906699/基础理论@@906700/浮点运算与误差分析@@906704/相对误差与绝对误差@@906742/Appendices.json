{
        "hands_on_practices": [
            {
                "introduction": "我们从一个经典而深刻的问题开始：求解二次方程。虽然二次公式是初等的，但其在浮点运算中的直接实现可能因灾难性抵消而导致精度的灾难性损失。此练习 [@problem_id:2370392] 不仅要求您量化此误差，还要求您从第一性原理出发，推导出一个数值稳定的算法，从而为算法重构的重要性提供一个切实的教训。",
                "problem": "一个具有实数系数的二次方程形式为 $a x^2 + b x + c = 0$，其中 $a \\neq 0$。当判别式 $D = b^2 - 4 a c \\ge 0$ 时，存在精确的实数根。在浮点 (FP) 运算中，当 $b^2 \\gg 4 a c$ 时，直接计算求根公式可能会遭受灾难性相消，因为其中一个根是通过两个几乎相等的数相减得到的。本问题要求您量化那个易于发生相消的根的绝对误差和相对误差，并通过一个从基本原理推导出的代数等价重构形式来减轻该误差。\n\n您可以使用的基本依据：\n- 二次方程的韦达定理：如果 $r_1$ 和 $r_2$ 是精确根，则 $r_1 + r_2 = -\\dfrac{b}{a}$ 且 $r_1 r_2 = \\dfrac{c}{a}$。\n- 在 $D \\ge 0$ 时，用实数运算表示精确根的求根公式。\n- 绝对误差和相对误差的定义。对于一个非零精确值 $x$ 的近似值 $\\tilde{x}$，绝对误差为 $|\\tilde{x} - x|$，相对误差为 $\\dfrac{|\\tilde{x} - x|}{|x|}$。如果 $x = 0$，则定义相对误差为绝对误差。\n\n您的任务：\n1. 对于下面的每个测试用例，通过在标准双精度下直接应用求根公式（即，以最直接的方式计算 $\\dfrac{-b \\pm \\sqrt{b^2 - 4 a c}}{2 a}$），计算两个根的浮点近似值。按如下方式识别易于发生相消的根：如果 $b  0$，则易于发生相消的根是使用 $+$ 号计算的那个；如果 $b  0$，则是使用 $-$ 号计算的那个。当 $b^2 \\gg 4 a c$ 时，这种识别方式反映了哪个公式在计算中减去了两个几乎相等的量。\n2. 严格地从韦达定理和基础代数出发，为易于发生相消的根推导出一个避免两近数相减的数值稳定重构形式，并实现它。您的实现不得依赖任何“给定”的稳定化公式；它必须源于您自己的推导。但是，您可以用您推导中隐含的任何稳定方式计算另一个根，然后使用 $r_1 r_2 = \\dfrac{c}{a}$ 来恢复出易于发生相消的根。\n3. 作为基准真相，使用至少有80位十进制精度的实数运算来计算精确根的高精度近似值，然后将其转换为双精度值以进行比较。对于每个测试用例，选择与易于发生相消的根相对应的精确根（即当 $b^2 \\gg 4 a c$ 时量级较小的那个根），并为朴素计算（任务1）和您的稳定重构形式（任务2）计算其绝对误差和相对误差。\n4. 您的程序必须将所有测试用例的结果汇总到一个单一的浮点数扁平列表中，每个测试用例按顺序为：$[\\text{abs\\_err\\_naive}, \\text{rel\\_err\\_naive}, \\text{abs\\_err\\_stable}, \\text{rel\\_err\\_stable}]$，并按照下面列出的相同顺序将各测试用例的结果串联起来。\n\n测试套件（每个三元组为 $(a,b,c)$）：\n- 情况1：$(a,b,c) = (\\,1\\,,\\,10^8\\,,\\,1\\,)$。\n- 情况2：$(a,b,c) = (\\,1\\,,\\,-10^8\\,,\\,1\\,)$。\n- 情况3：$(a,b,c) = (\\,1\\,,\\,3\\,,\\,10^{-3}\\,)$。\n- 情况4：$(a,b,c) = (\\,10^{-3}\\,,\\,10^5\\,,\\,10^{-3}\\,)$。\n\n数值和输出要求：\n- 如果出现任何角度计算，请使用弧度，尽管这里预计不会有。\n- 不涉及物理单位。\n- 所有输出必须是原始数字；不要使用百分号。相对误差必须是纯数（例如，对于千分之一，输出 $0.001$）。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果（例如，$ [r_1,r_2,\\dots]$）。最终列表必须精确包含 $\\;16\\;$ 个浮点数，对应 $\\;4\\;$ 个测试用例中每个用例的 $\\;4\\;$ 个值，顺序与测试套件中的顺序相同。",
                "solution": "所提出的问题是数值分析中的一个经典练习，涉及使用浮点运算求解二次方程 $a x^2 + b x + c = 0$ 时的精度损失问题。对该问题有效性的分析证实了其具有科学依据、是适定的且客观的。我们将以严谨的解法继续。\n\n标准的求根公式给出两个精确根 $r_1$ 和 $r_2$ 如下：\n$$\nr_{1,2} = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}\n$$\n问题关注 $b^2 \\gg 4ac$ 的情况。在这种情况下，判别式 $D = b^2 - 4ac$ 由 $b^2$ 项主导。因此，平方根 $\\sqrt{b^2 - 4ac}$ 可以通过泰勒级数展开来近似：\n$$\n\\sqrt{b^2 - 4ac} = |b| \\sqrt{1 - \\frac{4ac}{b^2}} \\approx |b| \\left(1 - \\frac{2ac}{b^2}\\right) = |b| - \\frac{2ac}{|b|}\n$$\n这个近似表明 $\\sqrt{b^2 - 4ac}$ 是一个非常接近 $|b|$ 的量。\n\n这种接近性是数值不稳定的根源。该现象被称为灾难性相消。\n\\begin{itemize}\n    \\item 如果 $b  0$，其中一个根的分子是 $-b + \\sqrt{b^2-4ac}$。由于 $\\sqrt{b^2-4ac} \\approx b$，这个表达式涉及两个几乎相等的数相减。此操作导致计算结果的相对精度显著损失。受影响的根是 $r_1 = \\frac{-b + \\sqrt{b^2-4ac}}{2a}$。\n    \\item 如果 $b  0$，那么 $-b$ 是一个正数。项 $\\sqrt{b^2-4ac} \\approx \\sqrt{b^2} = |b| = -b$。其中一个根的分子变为 $-b - \\sqrt{b^2-4ac}$，这同样是两个几乎相等的正数相减（例如，如果 $b=-10^8$，则 $-b=10^8$ 且 $\\sqrt{D} \\approx 10^8$）。这会影响根 $r_2 = \\frac{-b - \\sqrt{b^2-4ac}}{2a}$。\n\\end{itemize}\n在这两种情况下，绝对值较小的根是易受这种灾难性相消影响的根。另一个根涉及同号项的相加（如果 $b0$ 则为 $-b$ 和 $-\\sqrt{D}$，如果 $b0$ 则为 $-b$ 和 $+\\sqrt{D}$），因此可以稳定地计算。\n\n为了减轻这种数值误差，我们必须推导一个替代公式。问题要求此推导从基本原理开始，特别是韦达定理。策略是首先精确计算“稳定”的根，然后用它来找到“不稳定”（易于发生相消）的根。\n\n令 $r_{\\text{stable}}$ 为不经由相减抵消计算的根。它可以用符号函数 $\\text{sgn}(b)$ 以统一的方式表示：\n$$\nr_{\\text{stable}} = \\frac{-b - \\text{sgn}(b)\\sqrt{b^2-4ac}}{2a}\n$$\n这个公式确保了分子中的两项 $-b$ 和 $-\\text{sgn}(b)\\sqrt{b^2-4ac}$ 具有相同的符号，它们的和可以被稳健地计算。对于 $b^2 \\gg 4ac$ 的非平凡情况，$b$ 非零，因此 $\\text{sgn}(b)$ 为 $1$ 或 $-1$。\n\n在获得 $r_{\\text{stable}}$ 的精确值后，我们使用韦达定理中的根之积公式 $r_1 r_2 = c/a$。如果 $r_{\\text{prone}}$ 是另一个根（易于发生相消的那个），那么：\n$$\nr_{\\text{prone}} \\cdot r_{\\text{stable}} = \\frac{c}{a}\n$$\n由此，我们可以解出 $r_{\\text{prone}}$：\n$$\nr_{\\text{prone}} = \\frac{c/a}{r_{\\text{stable}}} = \\frac{c}{a \\cdot r_{\\text{stable}}}\n$$\n这个 $r_{\\text{prone}}$ 的表达式只涉及除法和乘法，在当前上下文中这些是数值稳定的运算，从而避免了朴素公式中固有的灾难性相消。\n\n解决该问题的计算步骤如下：\n\\begin{enumerate}\n    \\item 对于每个测试用例 $(a, b, c)$，我们首先为易于发生相消的根建立一个基准真相值。这通过使用高精度算术（至少80位十进制数字，使用Python的 `decimal` 模块）计算标准求根公式来实现。与近数相减相对应的根被识别为精确值 $x_{\\text{exact}}$，并转换为标准双精度浮点数。\n\n    \\item 我们使用标准双精度浮点运算中的直接求根公式，计算易于发生相消的根 $\\tilde{x}_{\\text{naive}}$。\n\n    \\item 我们使用推导出的稳定方法计算易于发生相消的根 $\\tilde{x}_{\\text{stable}}$。首先，计算稳定根 $\\tilde{r}_{\\text{stable}}$。然后，通过 $\\tilde{x}_{\\text{stable}} = (c/a) / \\tilde{r}_{\\text{stable}}$ 找到易于发生相消的根。\n\n    \\item 对于朴素方法和稳定方法，我们都计算绝对误差 $|\\tilde{x} - x_{\\text{exact}}|$ 和相对误差 $|\\tilde{x} - x_{\\text{exact}}| / |x_{\\text{exact}}|$。如果 $x_{\\text{exact}}=0$，相对误差被视为绝对误差。\n\\end{enumerate}\n然后为每个测试用例收集这四个误差度量，并汇总到一个单一列表中作为最终输出。",
                "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom decimal import Decimal, getcontext\n\ndef solve():\n    \"\"\"\n    Solves for the roots of a quadratic equation using naive and stable methods,\n    and calculates the absolute and relative errors for the cancellation-prone root.\n    \"\"\"\n    # Set the precision for the decimal module to 85, which is more than the required 80 digits,\n    # to ensure accuracy of the ground truth calculations.\n    getcontext().prec = 85\n\n    # Define the test cases from the problem statement. Each tuple is (a, b, c).\n    test_cases = [\n        (1.0, 1e8, 1.0),\n        (1.0, -1e8, 1.0),\n        (1.0, 3.0, 1e-3),\n        (1e-3, 1e5, 1e-3),\n    ]\n\n    all_results = []\n    for a, b, c in test_cases:\n        # Use standard double-precision floats for coefficients in FP calculations\n        a_fp, b_fp, c_fp = float(a), float(b), float(c)\n\n        # Task 3: Ground truth using high-precision arithmetic\n        a_d, b_d, c_d = Decimal(a), Decimal(b), Decimal(c)\n        discriminant_d = (b_d**2 - 4 * a_d * c_d).sqrt()\n\n        # Identify the exact cancellation-prone root based on the sign of b.\n        # This is the root with the smaller magnitude.\n        if b_fp  0:\n            # The root from (-b + sqrt(D)) suffers cancellation\n            x_exact_d = (-b_d + discriminant_d) / (2 * a_d)\n        else: # b  0 or b = 0\n            # The root from (-b - sqrt(D)) suffers cancellation\n            x_exact_d = (-b_d - discriminant_d) / (2 * a_d)\n        \n        # Cast the high-precision ground truth to a standard float for comparison\n        x_exact = float(x_exact_d)\n\n        # Task 1: Naive evaluation using the standard quadratic formula in double precision\n        discriminant_fp = np.sqrt(b_fp**2 - 4 * a_fp * c_fp)\n        \n        # Identify the cancellation-prone root from the naive calculation\n        if b_fp  0:\n            x_naive_prone = (-b_fp + discriminant_fp) / (2 * a_fp)\n        else:\n            x_naive_prone = (-b_fp - discriminant_fp) / (2 * a_fp)\n\n        # Task 2: Stable reformulation derived from first principles\n        # First, compute the stable root (the one without subtractive cancellation)\n        # np.copysign is robust and correctly applies the sign of b.\n        # It's equivalent to sgn(b) for b!=0.\n        stable_root = (-b_fp - np.copysign(1.0, b_fp) * discriminant_fp) / (2 * a_fp)\n        \n        # Then, use Vieta's formula (r1 * r2 = c/a) to find the cancellation-prone root.\n        # This avoids the subtraction of nearly equal numbers.\n        if stable_root == 0:\n            # Handle the unlikely case of the stable root being exactly zero\n            # This would imply c=0, in which case the prone root is also 0.\n            x_stable_prone = 0.0\n        else:\n            x_stable_prone = (c_fp / a_fp) / stable_root\n\n        # Task 4: Compute absolute and relative errors for both methods\n        # Naive method errors\n        abs_err_naive = abs(x_naive_prone - x_exact)\n        # Per problem spec, if x_exact is 0, relative error is absolute error\n        if x_exact != 0:\n            rel_err_naive = abs_err_naive / abs(x_exact)\n        else:\n            rel_err_naive = abs_err_naive\n        \n        # Stable method errors\n        abs_err_stable = abs(x_stable_prone - x_exact)\n        if x_exact != 0:\n            rel_err_stable = abs_err_stable / abs(x_exact)\n        else:\n            rel_err_stable = abs_err_stable\n\n        # Aggregate the results for this test case\n        all_results.extend([abs_err_naive, rel_err_naive, abs_err_stable, rel_err_stable])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.17e}' for r in all_results)}]\")\n\nsolve()\n```",
                "id": "2370392"
            },
            {
                "introduction": "从单个方程转向线性方程组，我们现在探讨矩阵条件数的关键作用。一个小的相对残差 $\\frac{\\\\|b - A\\hat{x}\\|_{2}}{\\\\|b\\|_{2}}$ 通常被认为是解质量好的标志，但这可能是危险的误导。此练习 [@problem_id:3574233] 要求您构建一个病态矩阵的情景，其中微小的残差掩盖了巨大的解误差，揭示了近似零方向如何放大误差背后的几何直觉。",
                "problem": "考虑一个数值线性代数背景下的线性系统，其系数矩阵接近秩亏。设\n$$\nA \\;=\\; \\begin{pmatrix}\n1   1 \\\\\n1   1 + 10^{-8}\n\\end{pmatrix}, \\qquad x^{\\star} \\;=\\; \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}, \\qquad b \\;=\\; A x^{\\star}.\n$$\n假设计算出的解是通过沿 $A$ 的一个近零方向移动得到的，具体为\n$$\n\\hat{x} \\;=\\; x^{\\star} + s\\,v, \\qquad v \\;=\\; \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}, \\qquad s \\;=\\; 10^{3}.\n$$\n仅使用残差和误差的核心定义，定义相对残差\n$$\n\\mathrm{rr} \\;=\\; \\frac{\\|b - A\\hat{x}\\|_{2}}{\\|b\\|_{2}},\n$$\n和相对解误差\n$$\n\\mathrm{re} \\;=\\; \\frac{\\|\\hat{x} - x^{\\star}\\|_{2}}{\\|x^{\\star}\\|_{2}}.\n$$\n计算这两个量，然后计算放大因子\n$$\n\\alpha \\;=\\; \\frac{\\mathrm{re}}{\\mathrm{rr}}.\n$$\n最后，从 $A$ 的近零方向的角度，简要解释为什么在这种构造下，$\\mathrm{rr}$ 可以很小而 $\\mathrm{re}$ 很大。报告 $\\alpha$ 的单个数值，并将答案四舍五入到四位有效数字。",
                "solution": "经评估，该问题陈述有效。它在数值线性代数方面具有科学依据，问题设定良好，提供了所有必要信息，并以客观、正式的语言表述。我们可以开始求解。\n\n任务是为一个给定的线性系统计算相对残差 $\\mathrm{rr}$、相对解误差 $\\mathrm{re}$ 和放大因子 $\\alpha = \\mathrm{re}/\\mathrm{rr}$，并对结果给出几何解释。\n\n首先，我们列出给定的量：\n矩阵 $A$ 为\n$$ A = \\begin{pmatrix} 1  1 \\\\ 1  1 + 10^{-8} \\end{pmatrix} $$\n精确解 $x^{\\star}$ 为\n$$ x^{\\star} = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} $$\n右端向量 $b$ 定义为 $b = A x^{\\star}$。我们来计算 $b$：\n$$ b = \\begin{pmatrix} 1  1 \\\\ 1  1 + 10^{-8} \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 1 \\cdot 1 + 1 \\cdot 1 \\\\ 1 \\cdot 1 + (1 + 10^{-8}) \\cdot 1 \\end{pmatrix} = \\begin{pmatrix} 2 \\\\ 2 + 10^{-8} \\end{pmatrix} $$\n计算出的解 $\\hat{x}$ 由下式给出\n$$ \\hat{x} = x^{\\star} + s\\,v $$\n其中 $s = 10^3$ 且 $v = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。\n$$ \\hat{x} = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} + 10^3 \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 1 + 1000 \\\\ 1 - 1000 \\end{pmatrix} = \\begin{pmatrix} 1001 \\\\ -999 \\end{pmatrix} $$\n\n接下来，我们计算相对解误差 $\\mathrm{re} = \\frac{\\|\\hat{x} - x^{\\star}\\|_{2}}{\\|x^{\\star}\\|_{2}}$。\n误差向量为 $\\hat{x} - x^{\\star} = s\\,v = 10^3 \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 1000 \\\\ -1000 \\end{pmatrix}$。\n误差向量的欧几里得范数为：\n$$ \\|\\hat{x} - x^{\\star}\\|_{2} = \\|s\\,v\\|_{2} = |s| \\cdot \\|v\\|_{2} = 10^3 \\sqrt{1^2 + (-1)^2} = 10^3 \\sqrt{2} $$\n精确解的欧几里得范数为：\n$$ \\|x^{\\star}\\|_{2} = \\sqrt{1^2 + 1^2} = \\sqrt{2} $$\n因此，相对解误差为：\n$$ \\mathrm{re} = \\frac{10^3 \\sqrt{2}}{\\sqrt{2}} = 10^3 $$\n\n现在，我们计算相对残差 $\\mathrm{rr} = \\frac{\\|b - A\\hat{x}\\|_{2}}{\\|b\\|_{2}}$。\n首先，我们求残差向量 $r = b - A\\hat{x}$。使用定义 $b = A x^{\\star}$ 和 $\\hat{x} = x^{\\star} + s\\,v$：\n$$ r = A x^{\\star} - A(x^{\\star} + s\\,v) = A x^{\\star} - A x^{\\star} - s(Av) = -s(Av) $$\n我们来计算向量 $Av$：\n$$ Av = \\begin{pmatrix} 1  1 \\\\ 1  1 + 10^{-8} \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 1 \\cdot 1 + 1 \\cdot (-1) \\\\ 1 \\cdot 1 + (1 + 10^{-8}) \\cdot (-1) \\end{pmatrix} = \\begin{pmatrix} 1 - 1 \\\\ 1 - 1 - 10^{-8} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -10^{-8} \\end{pmatrix} $$\n现在，我们可以求出残差向量 $r$：\n$$ r = -s(Av) = -10^3 \\begin{pmatrix} 0 \\\\ -10^{-8} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 10^{-5} \\end{pmatrix} $$\n残差向量的欧几里得范数为：\n$$ \\|b - A\\hat{x}\\|_{2} = \\|r\\|_{2} = \\sqrt{0^2 + (10^{-5})^2} = 10^{-5} $$\n接下来，我们需要 $b$ 的欧几里得范数：\n$$ \\|b\\|_{2} = \\left\\| \\begin{pmatrix} 2 \\\\ 2 + 10^{-8} \\end{pmatrix} \\right\\|_{2} = \\sqrt{2^2 + (2 + 10^{-8})^2} = \\sqrt{4 + 4 + 4 \\cdot 10^{-8} + 10^{-16}} = \\sqrt{8 + 4 \\cdot 10^{-8} + 10^{-16}} $$\n相对残差为：\n$$ \\mathrm{rr} = \\frac{10^{-5}}{\\sqrt{8 + 4 \\cdot 10^{-8} + 10^{-16}}} $$\n\n最后，我们计算放大因子 $\\alpha$：\n$$ \\alpha = \\frac{\\mathrm{re}}{\\mathrm{rr}} = \\frac{10^3}{\\frac{10^{-5}}{\\sqrt{8 + 4 \\cdot 10^{-8} + 10^{-16}}}} = 10^3 \\cdot 10^5 \\sqrt{8 + 4 \\cdot 10^{-8} + 10^{-16}} $$\n$$ \\alpha = 10^8 \\sqrt{8 + 4 \\cdot 10^{-8} + 10^{-16}} $$\n$4 \\cdot 10^{-8}$ 和 $10^{-16}$ 这两项与 $8$ 相比非常小。为了进行数值计算，我们有：\n$$ \\alpha = 10^8 \\sqrt{8.000000040000001} \\approx 10^8 \\cdot 2.8284271284 $$\n$$ \\alpha \\approx 2.8284271284 \\times 10^8 $$\n四舍五入到四位有效数字，我们得到：\n$$ \\alpha \\approx 2.828 \\times 10^8 $$\n\n几何解释：\n放大因子 $\\alpha$ 如此之大的原因在于矩阵 $A$ 的性质。$A$ 是近奇异的（或称病态的），这意味着它有一个“近零方向”。这是定义域空间中的一个方向，它被映射到陪域中一个模长非常小的向量。在这个问题中，向量 $v = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$ 代表了这个近零方向。正如我们计算的，$Av = \\begin{pmatrix} 0 \\\\ -10^{-8} \\end{pmatrix}$，其范数 $\\|Av\\|_2 = 10^{-8}$ 与 $v$ 的范数 $\\|v\\|_2 = \\sqrt{2}$ 相比非常小。\n\n解的误差 $\\hat{x} - x^{\\star} = s\\,v$ 是一个大向量，因为它是 $v$ 的一个大倍数（$s=10^3$）。这导致了一个大的相对误差 $\\mathrm{re} = 10^3$。\n\n然而，残差向量 $r = b - A\\hat{x}$ 等于 $-A(\\hat{x} - x^{\\star}) = -s(Av)$。因为矩阵向量乘积 $Av$ 非常小，所以残差向量 $r$ 的范数也很小，$\\|r\\|_2 = |s| \\|Av\\|_2 = 10^3 \\cdot 10^{-8} = 10^{-5}$。右端向量 $b$ 的范数约为 $\\|b\\|_2 \\approx \\sqrt{8} \\approx 2.828$。这导致了一个非常小的相对残差 $\\mathrm{rr} \\approx 10^{-5}/2.828$，其数量级为 $10^{-6}$。\n\n从几何上看，由 $A$ 定义的线性变换会严重“挤压”位于其近零空间方向上的向量。误差向量 $\\hat{x} - x^{\\star}$ 被特意构造成位于这个方向上。因此，输入空间（解空间）中的一个非常大的误差被映射到输出空间中的一个非常小的向量。这个小的输出向量是 $A\\hat{x}$ 和 $b$ 之间的差，即残差。因此，当矩阵是病态的时，小的残差并不能保证小的解误差。放大因子 $\\alpha$ 量化了这一现象；在本例中，解误差比残差误差大 $10^8$ 倍以上。这个因子与矩阵 $A$ 的条件数有关。",
                "answer": "$$\n\\boxed{2.828 \\times 10^8}\n$$",
                "id": "3574233"
            },
            {
                "introduction": "在看到病态条件如何放大误差之后，我们现在转向控制这种关系的理论界限。连接前向误差、相对残差和条件数的著名不等式是数值分析的基石。这个高级练习 [@problem_id:3574243] 将指导您构建一个特定的矩阵和扰动族，以证明该界限的锐度，证明它不仅仅是一个悲观的估计，而是一个可以达到的极限。",
                "problem": "设 $u \\in (0,10^{-1})$ 表示一个假想浮点机的单位舍入。对每个 $u$，定义一个非奇异的参数化 $2 \\times 2$ 矩阵\n$$\nA(\\varepsilon) \\;=\\; \\begin{pmatrix} 1  1 \\\\ 1  1+\\varepsilon \\end{pmatrix}, \\qquad \\varepsilon  0.\n$$\n全文使用谱（二）范数。回顾以下基本定义：\n- 谱条件数为 $\\kappa_{2}(A) = \\|A\\|_{2}\\,\\|A^{-1}\\|_{2} = \\sigma_{\\max}(A)/\\sigma_{\\min}(A)$，其中 $\\sigma_{\\max}(A)$ 和 $\\sigma_{\\min}(A)$ 分别是 $A$ 的最大和最小奇异值。\n- 给定 $A x = b$ 的精确解 $x$ 和一个近似解 $\\hat{x}$，前向相对误差为 $\\|\\hat{x}-x\\|_{2}/\\|x\\|_{2}$。残差为 $r = b - A \\hat{x}$，相对残差为 $\\|r\\|_{2}/\\|b\\|_{2}$。\n- 一个关于右端项的后向稳定求解过程被建模为产生一个解 $\\hat{x}$，该解满足 $A \\hat{x} = b + \\Delta b$，其中 $\\|\\Delta b\\|_{2}/\\|b\\|_{2} \\le c\\,u$，$c$ 是一个与问题条件无关的适中常数。\n\n考虑以下依赖于 $u$ 的构造：\n- 设参数为 $\\varepsilon(u) = 4u$，矩阵为 $A(u) := A(\\varepsilon(u))$。\n- 设 $v_{\\max}(u)$ 和 $u_{\\min}(u)$ 分别是对应于 $\\sigma_{\\max}(A(u))$ 和 $\\sigma_{\\min}(A(u))$ 的单位右奇异向量和单位左奇异向量。\n- 定义精确解 $x(u) := v_{\\max}(u)$ 和右端项 $b(u) := A(u)\\,x(u)$。\n- 设计算解 $\\hat{x}(u)$ 是扰动系统 $A(u)\\,\\hat{x}(u) = b(u) + \\Delta b(u)$ 的精确解，其中后向扰动选择为 $\\Delta b(u) = u\\,\\|b(u)\\|_{2}\\,u_{\\min}(u)$。\n\n仅从这些定义和标准的奇异值性质出发，完成以下任务：\n- 证明对于所有 $\\varepsilon0$，$A(\\varepsilon)$ 都是非奇异的，并且当 $\\varepsilon \\to 0^{+}$ 时，$\\kappa_{2}(A(\\varepsilon)) \\to \\infty$。\n- 证明相对残差满足 $\\|r(u)\\|_{2}/\\|b(u)\\|_{2} = u$，其中 $r(u) = b(u) - A(u)\\hat{x}(u)$。\n- 推导前向相对误差 $\\|\\hat{x}(u) - x(u)\\|_{2}/\\|x(u)\\|_{2}$ 关于 $\\kappa_{2}(A(u))$ 和 $u$ 的显式表达式，然后使用 $\\varepsilon(u)=4u$ 将其具体化。\n- 计算当 $u \\to 0^{+}$ 时，前向相对误差 $\\|\\hat{x}(u) - x(u)\\|_{2}/\\|x(u)\\|_{2}$ 的极限。\n\n你的最终答案必须是一个实数。不需要四舍五入。",
                "solution": "该问题在数值线性代数领域是有良好定义且有科学依据的。我们按顺序完成这四个任务来解决它。\n\n首先，我们分析当 $\\varepsilon  0$ 时矩阵 $A(\\varepsilon) = \\begin{pmatrix} 1  1 \\\\ 1  1+\\varepsilon \\end{pmatrix}$ 的性质。\n$A(\\varepsilon)$ 的行列式由 $\\det(A(\\varepsilon)) = (1)(1+\\varepsilon) - (1)(1) = \\varepsilon$ 给出。由于已知 $\\varepsilon  0$，行列式不为零，这证明了对于所有 $\\varepsilon  0$，$A(\\varepsilon)$ 都是非奇异的。\n\n接下来，我们研究当 $\\varepsilon \\to 0^{+}$ 时谱条件数 $\\kappa_{2}(A(\\varepsilon))$ 的行为。条件数定义为最大奇异值与最小奇异值之比，即 $\\kappa_{2}(A) = \\sigma_{\\max}(A)/\\sigma_{\\min}(A)$。奇异值是矩阵 $A(\\varepsilon)^T A(\\varepsilon)$ 特征值的平方根。\n$$\nA(\\varepsilon)^T A(\\varepsilon) = \\begin{pmatrix} 1  1 \\\\ 1  1+\\varepsilon \\end{pmatrix} \\begin{pmatrix} 1  1 \\\\ 1  1+\\varepsilon \\end{pmatrix} = \\begin{pmatrix} 1^2+1^2  1 \\cdot 1 + 1 \\cdot (1+\\varepsilon) \\\\ 1 \\cdot 1 + (1+\\varepsilon) \\cdot 1  1^2 + (1+\\varepsilon)^2 \\end{pmatrix} = \\begin{pmatrix} 2  2+\\varepsilon \\\\ 2+\\varepsilon  2+2\\varepsilon+\\varepsilon^2 \\end{pmatrix}.\n$$\n$A^T A$ 的特征值 $\\lambda$ 是特征多项式 $\\det(A^T A - \\lambda I) = 0$ 的根。\n$$\n(2-\\lambda)(2+2\\varepsilon+\\varepsilon^2-\\lambda) - (2+\\varepsilon)^2 = 0\n$$\n$$\n\\lambda^2 - (2+2+2\\varepsilon+\\varepsilon^2)\\lambda + 2(2+2\\varepsilon+\\varepsilon^2) - (4+4\\varepsilon+\\varepsilon^2) = 0\n$$\n$$\n\\lambda^2 - (4+2\\varepsilon+\\varepsilon^2)\\lambda + (4+4\\varepsilon+2\\varepsilon^2) - (4+4\\varepsilon+\\varepsilon^2) = 0\n$$\n$$\n\\lambda^2 - (4+2\\varepsilon+\\varepsilon^2)\\lambda + \\varepsilon^2 = 0\n$$\n两个特征值 $\\lambda_{\\max}$ 和 $\\lambda_{\\min}$ 是这个二次方程的根。奇异值为 $\\sigma_{\\max} = \\sqrt{\\lambda_{\\max}}$ 和 $\\sigma_{\\min} = \\sqrt{\\lambda_{\\min}}$。条件数的平方是 $\\kappa_2(A(\\varepsilon))^2 = \\sigma_{\\max}^2 / \\sigma_{\\min}^2 = \\lambda_{\\max} / \\lambda_{\\min}$。\n根据韦达定理，$\\lambda_{\\max} \\lambda_{\\min} = \\varepsilon^2$ 且 $\\lambda_{\\max} + \\lambda_{\\min} = 4+2\\varepsilon+\\varepsilon^2$。\n当 $\\varepsilon \\to 0^{+}$ 时，两根之和趋近于 $4$，两根之积趋近于 $0$。这意味着一个根趋近于 $4$，另一个根趋近于 $0$。令 $\\lambda_{\\max} \\to 4$ 且 $\\lambda_{\\min} \\to 0$。\n更精确地说，$\\lambda_{\\min} = \\frac{\\varepsilon^2}{\\lambda_{\\max}}$。当 $\\varepsilon \\to 0^{+}$ 时，$\\lambda_{\\max} \\approx 4$，因此 $\\lambda_{\\min} \\approx \\varepsilon^2/4$。\n条件数 $\\kappa_2(A(\\varepsilon)) = \\sqrt{\\lambda_{\\max}/\\lambda_{\\min}} \\approx \\sqrt{4/(\\varepsilon^2/4)} = \\sqrt{16/\\varepsilon^2} = 4/\\varepsilon$。\n因此，$\\lim_{\\varepsilon \\to 0^+} \\kappa_2(A(\\varepsilon)) = \\lim_{\\varepsilon \\to 0^+} \\frac{4}{\\varepsilon} = \\infty$。这就完成了第一个任务。\n\n第二，我们证明相对残差 $\\|r(u)\\|_{2}/\\|b(u)\\|_{2} = u$。\n残差定义为 $r(u) = b(u) - A(u)\\hat{x}(u)$。计算解 $\\hat{x}(u)$ 被定义为扰动系统 $A(u)\\hat{x}(u) = b(u) + \\Delta b(u)$ 的精确解。\n将此代入残差的定义，我们得到：\n$$\nr(u) = b(u) - (b(u) + \\Delta b(u)) = -\\Delta b(u).\n$$\n题目指定扰动为 $\\Delta b(u) = u\\,\\|b(u)\\|_{2}\\,u_{\\min}(u)$。\n取残差向量的谱范数：\n$$\n\\|r(u)\\|_{2} = \\|-\\Delta b(u)\\|_{2} = \\|\\Delta b(u)\\|_{2} = \\|u\\,\\|b(u)\\|_{2}\\,u_{\\min}(u)\\|_{2}.\n$$\n由于 $u  0$ 且 $\\|b(u)\\|_2$ 是一个标量，我们可以将它们从范数中提出：\n$$\n\\|r(u)\\|_{2} = u\\,\\|b(u)\\|_{2}\\,\\|u_{\\min}(u)\\|_{2}.\n$$\n向量 $u_{\\min}(u)$ 被定义为一个单位左奇异向量，因此 $\\|u_{\\min}(u)\\|_{2} = 1$。\n这将表达式简化为 $\\|r(u)\\|_{2} = u\\,\\|b(u)\\|_{2}$。\n于是，相对残差为：\n$$\n\\frac{\\|r(u)\\|_{2}}{\\|b(u)\\|_{2}} = \\frac{u\\,\\|b(u)\\|_{2}}{\\|b(u)\\|_{2}} = u.\n$$\n这就完成了第二个任务。\n\n第三，我们推导前向相对误差 $\\|\\hat{x}(u) - x(u)\\|_{2}/\\|x(u)\\|_{2}$ 的表达式。\n我们从精确解和计算解的定义方程开始：\n1. $A(u)x(u) = b(u)$\n2. $A(u)\\hat{x}(u) = b(u) + \\Delta b(u)$\n第二个方程减去第一个方程得到：$A(u)(\\hat{x}(u) - x(u)) = \\Delta b(u)$。\n由于 $A(u)$ 是非奇异的，误差向量为 $\\hat{x}(u) - x(u) = A(u)^{-1} \\Delta b(u)$。\n我们代入给定形式的 $\\Delta b(u) = u\\,\\|b(u)\\|_{2}\\,u_{\\min}(u)$：\n$$\n\\hat{x}(u) - x(u) = u\\,\\|b(u)\\|_{2}\\,A(u)^{-1}u_{\\min}(u).\n$$\n根据奇异值分解 (SVD) 的定义，$A(u)v_i(u) = \\sigma_i(u)u_i(u)$ 和 $A(u)^{-1}u_i(u) = \\frac{1}{\\sigma_i(u)}v_i(u)$，其中 $v_i(u)$ 和 $u_i(u)$ 是对应于奇异值 $\\sigma_i(u)$ 的右奇异向量和左奇异向量。因此，$A(u)^{-1}u_{\\min}(u) = \\frac{1}{\\sigma_{\\min}(A(u))}v_{\\min}(u)$。\n并且，$b(u) = A(u)x(u) = A(u)v_{\\max}(u) = \\sigma_{\\max}(A(u))u_{\\max}(u)$。取范数，$\\|b(u)\\|_2 = \\sigma_{\\max}(A(u))\\|u_{\\max}(u)\\|_2 = \\sigma_{\\max}(A(u))$。\n将这些代入误差向量的表达式：\n$$\n\\hat{x}(u) - x(u) = u\\,\\sigma_{\\max}(A(u))\\,\\left(\\frac{1}{\\sigma_{\\min}(A(u))}v_{\\min}(u)\\right) = u\\,\\frac{\\sigma_{\\max}(A(u))}{\\sigma_{\\min}(A(u))}\\,v_{\\min}(u) = u\\,\\kappa_2(A(u))\\,v_{\\min}(u).\n$$\n取误差向量的范数：\n$$\n\\|\\hat{x}(u) - x(u)\\|_{2} = \\|u\\,\\kappa_2(A(u))\\,v_{\\min}(u)\\|_{2} = u\\,\\kappa_2(A(u))\\,\\|v_{\\min}(u)\\|_{2}.\n$$\n由于 $v_{\\min}(u)$ 是单位右奇异向量，$\\|v_{\\min}(u)\\|_2=1$，所以 $\\|\\hat{x}(u) - x(u)\\|_{2} = u\\,\\kappa_2(A(u))$。\n前向相对误差通过除以 $\\|x(u)\\|_2$ 得到。题目定义 $x(u) = v_{\\max}(u)$，它是一个单位向量，所以 $\\|x(u)\\|_2 = 1$。\n前向相对误差为 $\\frac{\\|\\hat{x}(u) - x(u)\\|_{2}}{\\|x(u)\\|_{2}} = u\\,\\kappa_{2}(A(u))$。\n\n现在我们使用 $\\varepsilon(u)=4u$ 将其具体化。根据第一个任务的分析，特征多项式 $\\lambda^2 - (4+2\\varepsilon+\\varepsilon^2)\\lambda + \\varepsilon^2 = 0$ 的根是 $\\lambda = \\frac{(4+2\\varepsilon+\\varepsilon^2) \\pm \\sqrt{(4+2\\varepsilon+\\varepsilon^2)^2 - 4\\varepsilon^2}}{2}$。\n条件数为 $\\kappa_2(A(\\varepsilon)) = \\sqrt{\\lambda_{\\max}/\\lambda_{\\min}}$。\n$$\n\\kappa_2(A(\\varepsilon)) = \\sqrt{\\frac{4+2\\varepsilon+\\varepsilon^2 + \\sqrt{D}}{4+2\\varepsilon+\\varepsilon^2 - \\sqrt{D}}} = \\frac{4+2\\varepsilon+\\varepsilon^2 + \\sqrt{D}}{2\\varepsilon}\n$$\n其中 $D=(4+2\\varepsilon+\\varepsilon^2)^2-4\\varepsilon^2$。\n前向相对误差为 $u\\,\\kappa_2(A(u)) = u\\,\\kappa_2(A(4u))$。\n$$\n\\text{Fwd. Rel. Err.} = u \\cdot \\frac{4+2(4u)+(4u)^2 + \\sqrt{(4+2(4u)+(4u)^2)^2-4(4u)^2}}{2(4u)}\n$$\n$$\n= u \\cdot \\frac{4+8u+16u^2 + \\sqrt{(4+8u+16u^2)^2-64u^2}}{8u}\n$$\n$$\n= \\frac{4+8u+16u^2 + \\sqrt{(4+8u+16u^2)^2-64u^2}}{8}.\n$$\n这就完成了第三个任务。\n\n第四，我们计算当前向相对误差在 $u \\to 0^{+}$ 时的极限。\n$$\nL = \\lim_{u \\to 0^+} \\frac{4+8u+16u^2 + \\sqrt{(4+8u+16u^2)^2-64u^2}}{8}.\n$$\n该表达式是 $u$ 在 $u=0$ 处的连续函数。我们可以通过直接代入 $u=0$ 来计算极限：\n$$\nL = \\frac{4+8(0)+16(0)^2 + \\sqrt{(4+8(0)+16(0)^2)^2-64(0)^2}}{8}\n$$\n$$\nL = \\frac{4 + \\sqrt{4^2 - 0}}{8} = \\frac{4 + \\sqrt{16}}{8} = \\frac{4+4}{8} = \\frac{8}{8} = 1.\n$$\n前向相对误差的极限是 $1$。\n这个结果展示了数值分析中的一个关键概念：一个小的相对残差（大小为 $u$）并不能保证一个小的前向误差。在这里，前向误差被条件数 $\\kappa_2(A(u))$ 放大，根据构造，该条件数约为 $1/u$，导致一个数量级为 $1$ 的常数前向误差。",
                "answer": "$$\\boxed{1}$$",
                "id": "3574243"
            }
        ]
    }