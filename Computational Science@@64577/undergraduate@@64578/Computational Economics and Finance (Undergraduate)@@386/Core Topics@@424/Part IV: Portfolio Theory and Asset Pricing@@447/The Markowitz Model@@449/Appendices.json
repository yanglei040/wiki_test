{"hands_on_practices": [{"introduction": "The journey into Markowitz portfolio theory begins with its most fundamental building block: understanding how the risks of individual assets combine. This exercise tasks you with a core calculation—determining the composition of a two-asset portfolio to meet a specific risk target [@problem_id:2438015]. By working through this problem, you will gain hands-on experience with the portfolio variance formula and develop an intuition for how correlation governs the power of diversification.", "id": "2438015", "problem": "Consider a portfolio in computational finance consisting of $2$ risky assets with returns $r_{1}$ and $r_{2}$. Let the standard deviations of returns be $\\sigma_{1} = 0.4$ and $\\sigma_{2} = 0.2$, and let the correlation be $\\rho = 0.95$. The portfolio weights are $w$ in asset $1$ and $1 - w$ in asset $2$, with no short-selling allowed, so $w \\in [0,1]$. Assume second moments exist and use the definition $\\operatorname{Cov}(r_{1}, r_{2}) = \\rho \\sigma_{1} \\sigma_{2}$. Determine the value of $w \\in [0,1]$ such that the portfolio variance equals the target level $0.085$. Round your answer to $6$ significant figures.", "solution": "The problem is subjected to validation.\n\n**Step 1: Extract Givens**\n-   Number of assets: $2$.\n-   Returns: $r_{1}$, $r_{2}$.\n-   Standard deviation of asset $1$: $\\sigma_{1} = 0.4$.\n-   Standard deviation of asset $2$: $\\sigma_{2} = 0.2$.\n-   Correlation of returns: $\\rho = 0.95$.\n-   Weight in asset $1$: $w$.\n-   Weight in asset $2$: $1 - w$.\n-   Constraint on weight: $w \\in [0,1]$.\n-   Covariance definition: $\\operatorname{Cov}(r_{1}, r_{2}) = \\rho \\sigma_{1} \\sigma_{2}$.\n-   Target portfolio variance: $\\sigma_{p}^2 = 0.085$.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientific Grounding**: The problem is based on Markowitz portfolio theory, a fundamental concept in modern finance. The formula for portfolio variance is standard. All provided constants are numerically plausible. The problem is scientifically grounded.\n-   **Well-Posedness**: The problem asks for a specific value $w$ that produces a target variance. This requires solving an equation for $w$. The setup leads to a quadratic equation, which is a well-posed mathematical problem.\n-   **Objectivity**: The problem is stated using precise, objective, and standard terminology from finance and mathematics.\n-   **Completeness**: All necessary data ($\\sigma_1, \\sigma_2, \\rho$, target variance) and constraints ($w \\in [0,1]$) are provided to formulate and solve the problem.\n-   **Consistency**: The data and conditions are internally consistent. No contradictions are present.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A solution will be provided.\n\nThe variance of a portfolio comprising two assets with weights $w_{1}$ and $w_{2}$ is given by the formula:\n$$\n\\sigma_{p}^2 = w_{1}^2 \\sigma_{1}^2 + w_{2}^2 \\sigma_{2}^2 + 2 w_{1} w_{2} \\operatorname{Cov}(r_{1}, r_{2})\n$$\nThe covariance is defined as $\\operatorname{Cov}(r_{1}, r_{2}) = \\rho \\sigma_{1} \\sigma_{2}$. Substituting this into the variance formula yields:\n$$\n\\sigma_{p}^2 = w_{1}^2 \\sigma_{1}^2 + w_{2}^2 \\sigma_{2}^2 + 2 w_{1} w_{2} \\rho \\sigma_{1} \\sigma_{2}\n$$\nIn this problem, the weights are $w_{1} = w$ and $w_{2} = 1 - w$. We are given the following values: $\\sigma_{1} = 0.4$, $\\sigma_{2} = 0.2$, and $\\rho = 0.95$.\nLet us substitute these into the variance equation:\n$$\n\\sigma_{p}^2(w) = w^2 \\sigma_{1}^2 + (1-w)^2 \\sigma_{2}^2 + 2w(1-w)\\rho\\sigma_{1}\\sigma_{2}\n$$\nFirst, we compute the required terms:\n-   Variance of asset $1$: $\\sigma_{1}^2 = (0.4)^2 = 0.16$.\n-   Variance of asset $2$: $\\sigma_{2}^2 = (0.2)^2 = 0.04$.\n-   Covariance term: $\\rho \\sigma_{1} \\sigma_{2} = (0.95)(0.4)(0.2) = 0.076$.\n\nNow, we substitute these numerical values into the expression for $\\sigma_{p}^2(w)$:\n$$\n\\sigma_{p}^2(w) = w^2(0.16) + (1-w)^2(0.04) + 2w(1-w)(0.076)\n$$\nTo find the value of $w$, we expand and simplify this expression:\n$$\n\\sigma_{p}^2(w) = 0.16w^2 + (1 - 2w + w^2)(0.04) + (2w - 2w^2)(0.076)\n$$\n$$\n\\sigma_{p}^2(w) = 0.16w^2 + 0.04 - 0.08w + 0.04w^2 + 0.152w - 0.152w^2\n$$\nGroup the terms by powers of $w$:\n$$\n\\sigma_{p}^2(w) = (0.16 + 0.04 - 0.152)w^2 + (-0.08 + 0.152)w + 0.04\n$$\n$$\n\\sigma_{p}^2(w) = 0.048w^2 + 0.072w + 0.04\n$$\nThe problem requires that the portfolio variance equals a target level of $0.085$. We set our expression for $\\sigma_{p}^2(w)$ equal to this value:\n$$\n0.048w^2 + 0.072w + 0.04 = 0.085\n$$\nThis forms a quadratic equation. To solve for $w$, we rearrange the equation into the standard form $Aw^2 + Bw + C = 0$:\n$$\n0.048w^2 + 0.072w + (0.04 - 0.085) = 0\n$$\n$$\n0.048w^2 + 0.072w - 0.045 = 0\n$$\nTo simplify the coefficients, we can multiply the entire equation by $1000$:\n$$\n48w^2 + 72w - 45 = 0\n$$\nThis equation can be further simplified by dividing all terms by their greatest common divisor, which is $3$:\n$$\n16w^2 + 24w - 15 = 0\n$$\nThis problem has been reduced to finding the root of a quadratic equation. While a numerical algorithm such as the bisection method could approximate the root, an analytical solution is exact and therefore superior. We apply the quadratic formula, $w = \\frac{-B \\pm \\sqrt{B^2-4AC}}{2A}$, with $A=16$, $B=24$, and $C=-15$.\n\nFirst, calculate the discriminant, $\\Delta = B^2 - 4AC$:\n$$\n\\Delta = (24)^2 - 4(16)(-15) = 576 + 960 = 1536\n$$\nNow, find the roots for $w$:\n$$\nw = \\frac{-24 \\pm \\sqrt{1536}}{2(16)} = \\frac{-24 \\pm \\sqrt{256 \\times 6}}{32} = \\frac{-24 \\pm 16\\sqrt{6}}{32}\n$$\nSimplifying the expression for $w$:\n$$\nw = \\frac{-3 \\pm 2\\sqrt{6}}{4}\n$$\nThis gives two possible solutions for $w$:\n$$\nw_{1} = \\frac{-3 + 2\\sqrt{6}}{4} \\quad \\text{and} \\quad w_{2} = \\frac{-3 - 2\\sqrt{6}}{4}\n$$\nThe problem states that no short-selling is allowed, which imposes the constraint $w \\in [0,1]$. We must check which of these solutions falls within this interval.\nUsing the approximation $\\sqrt{6} \\approx 2.449$:\n$$\nw_{1} \\approx \\frac{-3 + 2(2.449)}{4} = \\frac{-3 + 4.898}{4} = \\frac{1.898}{4} \\approx 0.4745\n$$\nThis solution $w_1$ is in the interval $[0,1]$.\n$$\nw_{2} \\approx \\frac{-3 - 2(2.449)}{4} = \\frac{-3 - 4.898}{4} = \\frac{-7.898}{4} \\approx -1.9745\n$$\nThis solution $w_2$ is negative and thus outside the allowed interval $[0,1]$. It corresponds to a short position in asset $1$, which is forbidden.\n\nTherefore, the only valid weight is $w = \\frac{-3 + 2\\sqrt{6}}{4}$.\nThe problem requires a numerical answer rounded to $6$ significant figures.\n$$\nw = \\frac{-3 + 2\\sqrt{6}}{4} \\approx 0.474744871...\n$$\nRounding this value to $6$ significant figures gives $0.474745$.", "answer": "$$\n\\boxed{0.474745}\n$$"}, {"introduction": "Having mastered the calculation of portfolio risk, we now delve into the strategic logic of portfolio optimization. This problem presents a thought-provoking scenario: should a risky asset whose expected return is no better than the risk-free rate be included in an optimal portfolio? By analyzing this question [@problem_id:2442560], you will uncover the profound importance of covariance and an asset's hedging properties, which are central to the Markowitz model's concept of diversification.", "id": "2442560", "problem": "Consider a standard mean–variance setting with $N \\ge 2$ risky assets whose excess return vector is $R - R_f \\mathbf{1}$, where the expected returns are $\\boldsymbol{\\mu} = \\mathbb{E}[\\mathbf{R}]$, the risk-free rate is $R_f$, $\\mathbf{1}$ is the $N \\times 1$ vector of ones, and the risky return covariance matrix is $\\boldsymbol{\\Sigma}$, which is symmetric positive definite. Assume investors can borrow or lend unlimitedly at the risk-free rate $R_f$, and short sales in risky assets are allowed. The optimal risky portfolio that supports the Capital Allocation Line (CAL) is the unique tangency portfolio.\n\nSuppose one particular risky asset $i$ satisfies $\\mathbb{E}[R_i] = R_f$ and $\\operatorname{Var}(R_i) &gt; 0$.\n\nWhich of the following statements about the composition of the tangency portfolio is/are correct?\n\nA. The weight of asset $i$ in the tangency portfolio must be zero because its stand-alone Sharpe ratio is zero.\n\nB. Even though $\\mathbb{E}[R_i] = R_f$, asset $i$ can receive a nonzero weight in the tangency portfolio due to its covariance with other assets.\n\nC. If short selling is disallowed, asset $i$ must enter the tangency portfolio with a strictly positive weight to improve diversification.\n\nD. If asset $i$ is uncorrelated with all other risky assets, then its weight in the tangency portfolio is zero.\n\nE. Adding asset $i$ to the investable universe cannot change the slope of the CAL relative to the universe without asset $i$.", "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n- We are in a standard mean–variance setting.\n- There are $N \\ge 2$ risky assets.\n- The excess return vector is $\\mathbf{R} - R_f \\mathbf{1}$.\n- The expected returns vector is $\\boldsymbol{\\mu} = \\mathbb{E}[\\mathbf{R}]$.\n- The risk-free rate is $R_f$.\n- $\\mathbf{1}$ is the $N \\times 1$ vector of ones.\n- The risky return covariance matrix is $\\boldsymbol{\\Sigma}$, which is symmetric and positive definite.\n- Investors can borrow or lend unlimitedly at the risk-free rate $R_f$.\n- Short sales in risky assets are allowed.\n- The optimal risky portfolio is the unique tangency portfolio supporting the Capital Allocation Line (CAL).\n- For a particular risky asset $i$, it is given that $\\mathbb{E}[R_i] = R_f$ and $\\operatorname{Var}(R_i) > 0$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, rooted in the established Markowitz portfolio theory. The concepts of mean-variance optimization, tangency portfolio, and Capital Allocation Line are standard in financial economics. The language is precise and objective. All necessary components to define the problem are provided: a set of risky assets with known expected returns $\\boldsymbol{\\mu}$ and a positive definite covariance matrix $\\boldsymbol{\\Sigma}$, and a risk-free asset. The condition on asset $i$, $\\mathbb{E}[R_i] = R_f$ and $\\operatorname{Var}(R_i) > 0$, is a specific, well-defined scenario within this framework. An implicit assumption, standard for such problems, is that not all risky assets have an expected return equal to the risk-free rate, i.e., $\\boldsymbol{\\mu} \\ne R_f \\mathbf{1}$, ensuring a non-trivial tangency portfolio exists. The problem is well-posed and internally consistent.\n\n**Step 3: Verdict and Action**\nThe problem statement is valid. A solution will be derived.\n\nThe tangency portfolio is the portfolio of risky assets that maximizes the Sharpe ratio. Its weight vector, $\\mathbf{w}_{TP}$, is proportional to the solution of the unconstrained optimization problem leading to the highest Sharpe ratio. The un-normalized weights, denoted by $\\mathbf{w}^*$, are given by the formula:\n$$ \\mathbf{w}^* = k \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_e $$\nfor some positive scaling constant $k$. Here, $\\boldsymbol{\\mu}_e$ is the vector of expected excess returns over the risk-free rate:\n$$ \\boldsymbol{\\mu}_e = \\boldsymbol{\\mu} - R_f \\mathbf{1} $$\nThe individual un-normalized weight for asset $j$, $w_j^*$, is given by the $j$-th component of this vector product:\n$$ w_j^* = k \\sum_{l=1}^N (\\boldsymbol{\\Sigma}^{-1})_{jl} (\\mu_l - R_f) $$\nWe are interested in the weight of asset $i$, for which we have the specific condition $\\mu_i = \\mathbb{E}[R_i] = R_f$. This implies that the $i$-th component of the expected excess return vector is zero: $(\\boldsymbol{\\mu}_e)_i = \\mu_i - R_f = 0$.\n\nLet us write the expression for the un-normalized weight of asset $i$, $w_i^*$:\n$$ w_i^* = k \\sum_{l=1}^N (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f) $$\nWe can separate the term for $l=i$ from the sum:\n$$ w_i^* = k \\left( (\\boldsymbol{\\Sigma}^{-1})_{ii} (\\mu_i - R_f) + \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f) \\right) $$\nSubstituting the given condition $\\mu_i - R_f = 0$:\n$$ w_i^* = k \\left( (\\boldsymbol{\\Sigma}^{-1})_{ii} \\cdot 0 + \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f) \\right) = k \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f) $$\nThe normalized weight $w_{i,TP}$ is $w_i^* / (\\mathbf{1}^T \\mathbf{w}^*)$. If $w_i^* = 0$, then $w_{i,TP} = 0$. If $w_i^* \\ne 0$, then $w_{i,TP} \\ne 0$, provided the tangency portfolio itself is well-defined (i.e., $\\mathbf{1}^T \\mathbf{w}^* \\ne 0$).\n\nWe now evaluate each statement.\n\n**A. The weight of asset $i$ in the tangency portfolio must be zero because its stand-alone Sharpe ratio is zero.**\nThe stand-alone Sharpe ratio for asset $i$ is indeed $(\\mu_i - R_f) / \\sigma_i = 0$, as $\\mu_i=R_f$ and $\\sigma_i = \\sqrt{\\operatorname{Var}(R_i)} > 0$. However, the conclusion that its weight *must* be zero is incorrect. Our derived formula for $w_i^*$ is $k \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f)$. This sum is not in general equal to zero. The terms $(\\boldsymbol{\\Sigma}^{-1})_{il}$ for $l \\neq i$ are the off-diagonal elements of the inverse covariance matrix, which are generally non-zero if asset $i$ is correlated with other assets. If at least one other asset $l$ has an excess return $\\mu_l - R_f \\neq 0$ and its corresponding inverse covariance term $(\\boldsymbol{\\Sigma}^{-1})_{il}$ is also non-zero, the weight $w_i^*$ can be non-zero. This non-zero weight arises from the diversification benefit (or hedging role) asset $i$ provides within the portfolio, which is not captured by its stand-alone characteristics.\n**Verdict: Incorrect.**\n\n**B. Even though $\\mathbb{E}[R_i] = R_f$, asset $i$ can receive a nonzero weight in the tangency portfolio due to its covariance with other assets.**\nThis statement claims that it is possible for $w_i^*$ to be non-zero. As shown in the general formula $w_i^* = k \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f)$, a non-zero weight is indeed possible. The matrix $\\boldsymbol{\\Sigma}^{-1}$ (the precision matrix) reflects the entire covariance structure of the assets. A non-zero weight for asset $i$ will arise unless the weighted sum of the excess returns of other assets, where weights are elements from the $i$-th row of the precision matrix, happens to be exactly zero. This is not the general case. Thus, the covariances of asset $i$ with other assets can, and generally do, lead to a non-zero weight.\n**Verdict: Correct.**\n\n**C. If short selling is disallowed, asset $i$ must enter the tangency portfolio with a strictly positive weight to improve diversification.**\nWith the constraint $w_j \\ge 0$ for all $j$, the solution is found using Kuhn-Tucker conditions. An asset $j$ with $w_j=0$ can enter the portfolio with a positive weight only if its marginal contribution to the portfolio's Sharpe ratio is positive. The marginal change in the Sharpe ratio $S_P$ of a portfolio $P$ with respect to a small addition of asset $i$ is given by $\\frac{\\partial S_P}{\\partial w_i}$. Since $\\mu_i - R_f = 0$, this derivative at $w_i = 0$ simplifies to being proportional to $-\\operatorname{Cov}(R_i, R_P)$, where $R_P$ is the return of the optimal portfolio formed from the other assets. For asset $i$ to enter with a strictly positive weight, this derivative must be positive. This requires $\\operatorname{Cov}(R_i, R_P) < 0$. That is, asset $i$ must be negatively correlated with the tangency portfolio of the other available assets. This condition is not always met. If the covariance is non-negative, asset $i$ will have an optimal weight of zero. The statement that it *must* enter is therefore false.\n**Verdict: Incorrect.**\n\n**D. If asset $i$ is uncorrelated with all other risky assets, then its weight in the tangency portfolio is zero.**\nThe condition that asset $i$ is uncorrelated with all other risky assets means $\\Sigma_{il} = \\operatorname{Cov}(R_i, R_l) = 0$ for all $l \\neq i$. This implies that the $i$-th row and $i$-th column of the covariance matrix $\\boldsymbol{\\Sigma}$ have zero entries everywhere except for the diagonal element $\\Sigma_{ii} = \\sigma_i^2$. For the inverse matrix $\\boldsymbol{\\Sigma}^{-1}$, this structure implies that its $i$-th row and column are also zero except for the diagonal element. Specifically, $(\\boldsymbol{\\Sigma}^{-1})_{il} = 0$ for all $l \\neq i$, and $(\\boldsymbol{\\Sigma}^{-1})_{ii} = 1/\\Sigma_{ii} = 1/\\sigma_i^2$.\nSubstituting this into our formula for $w_i^*$:\n$$ w_i^* = k \\left( (\\boldsymbol{\\Sigma}^{-1})_{ii} (\\mu_i - R_f) + \\sum_{l \\neq i} (\\boldsymbol{\\Sigma}^{-1})_{il} (\\mu_l - R_f) \\right) $$\n$$ w_i^* = k \\left( \\frac{1}{\\sigma_i^2} \\cdot 0 + \\sum_{l \\neq i} 0 \\cdot (\\mu_l - R_f) \\right) = 0 $$\nSince the un-normalized weight $w_i^*$ is zero, the normalized weight $w_{i,TP}$ must also be zero. An asset with zero excess return that is also uncorrelated with all other assets offers no return premium and no diversification benefits, so it is logically excluded from the optimal risky portfolio.\n**Verdict: Correct.**\n\n**E. Adding asset $i$ to the investable universe cannot change the slope of the CAL relative to the universe without asset $i$.**\nThe slope of the CAL is the Sharpe ratio of the tangency portfolio, $S_{TP}$. Adding a new asset to an investment universe can never decrease the maximum attainable Sharpe ratio; it can either leave it unchanged or increase it. The question is whether it is possible for the slope to increase. Let $S_A$ be the maximal Sharpe ratio for the universe without asset $i$, and $S_B$ be the maximal Sharpe ratio for the universe including asset $i$. It can be shown that the relationship between the two squared Sharpe ratios is:\n$$ S_B^2 = S_A^2 + \\frac{(\\operatorname{Cov}(R_i, R_{TP_A}))^2 / \\sigma_{TP_A}^2}{\\sigma_i^2(1-\\rho_{i,TP_A}^2)} \\ge S_A^2 $$\nwhere $R_{TP_A}$ is the return on the tangency portfolio of the original universe, and $\\rho_{i,TP_A}$ is the correlation between asset $i$ and that portfolio. An increase in the Sharpe ratio ($S_B > S_A$) will occur unless $\\operatorname{Cov}(R_i, R_{TP_A}) = 0$. In the general case, this covariance is not zero. Therefore, adding asset $i$ will generally change (increase) the slope of the CAL. The statement that it \"cannot change\" is false.\n**Verdict: Incorrect.**", "answer": "$$\\boxed{BD}$$"}, {"introduction": "The final step in mastering the Markowitz model is to bridge the gap between abstract theory and computational practice. This exercise challenges you to implement the optimization process and quantify the impact of a common real-world friction: the no-short-selling constraint [@problem_id:2442592]. By comparing the unconstrained and constrained optimal portfolios, you will not only gain practical coding experience but also develop a concrete understanding of the economic 'cost' that such constraints impose on portfolio performance.", "id": "2442592", "problem": "You are given a series of independent instances of the Markowitz mean–variance portfolio selection environment. In each instance, there are finitely many risky assets with an expected return vector $\\boldsymbol{\\mu} \\in \\mathbb{R}^n$ (in decimal per period) and a symmetric, positive definite covariance matrix $\\boldsymbol{\\Sigma} \\in \\mathbb{R}^{n \\times n}$ (variance per period). A risk-free asset exists with return $r_f$ (in decimal per period). A portfolio is represented by a weight vector $\\boldsymbol{w} \\in \\mathbb{R}^n$ on the risky assets that satisfies the budget constraint $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$, where $\\boldsymbol{1}$ is the vector of ones. The expected return of $\\boldsymbol{w}$ is $\\mathbb{E}[R_p] = \\boldsymbol{\\mu}^\\top \\boldsymbol{w}$ and its variance is $\\mathrm{Var}(R_p) = \\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}$. The Sharpe ratio of $\\boldsymbol{w}$ relative to the risk-free rate $r_f$ is defined as\n$$\nS(\\boldsymbol{w}) = \\frac{\\boldsymbol{\\mu}^\\top \\boldsymbol{w} - r_f}{\\sqrt{\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}}}.\n$$\nThe tangency portfolio is any $\\boldsymbol{w}$ satisfying $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$ that maximizes $S(\\boldsymbol{w})$. Consider two versions of the tangency portfolio problem:\n- Unconstrained: $\\boldsymbol{w}$ may have negative components (short selling allowed).\n- No-short-selling constrained: $\\boldsymbol{w} \\succeq \\boldsymbol{0}$ componentwise (short selling forbidden).\n\nDefine the cost of the no-short-selling constraint as the nonnegative difference between the Sharpe ratios of the unconstrained and constrained tangency portfolios:\n$$\n\\text{cost} = S_{\\text{unconstrained}}^\\star - S_{\\text{constrained}}^\\star,\n$$\nexpressed as a decimal (no percentage sign).\n\nStarting from the foundational definitions above, implement a program that, for each test instance below, computes the unconstrained tangency portfolio’s Sharpe ratio, the no-short-selling constrained tangency portfolio’s Sharpe ratio, and returns the cost as a single floating-point number rounded to six digits after the decimal point. The program must not assume any asset units beyond the stated financial interpretation, and all outputs must be decimals with no percentage sign.\n\nTest suite (each case is $(\\boldsymbol{\\mu}, \\boldsymbol{\\Sigma}, r_f)$):\n\n- Case $1$:\n  - $\\boldsymbol{\\mu} = [\\,0.12,\\,0.10,\\,0.07\\,]$\n  - $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n  0.040 & 0.006 & 0.004\\\\\n  0.006 & 0.0225 & 0.0025\\\\\n  0.004 & 0.0025 & 0.010\n  \\end{bmatrix}$\n  - $r_f = 0.03$\n\n- Case $2$:\n  - $\\boldsymbol{\\mu} = [\\,0.14,\\,0.08,\\,0.06\\,]$\n  - $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n  0.050 & 0.010 & 0.008\\\\\n  0.010 & 0.040 & 0.012\\\\\n  0.008 & 0.012 & 0.030\n  \\end{bmatrix}$\n  - $r_f = 0.03$\n\n- Case $3$:\n  - $\\boldsymbol{\\mu} = [\\,0.11,\\,0.13,\\,0.09,\\,0.07\\,]$\n  - $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n  0.030 & 0.012 & 0.006 & -0.003\\\\\n  0.012 & 0.050 & 0.009 & 0.000\\\\\n  0.006 & 0.009 & 0.020 & 0.004\\\\\n  -0.003 & 0.000 & 0.004 & 0.015\n  \\end{bmatrix}$\n  - $r_f = 0.02$\n\n- Case $4$:\n  - $\\boldsymbol{\\mu} = [\\,0.09,\\,0.07\\,]$\n  - $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n  0.015 & 0.006\\\\\n  0.006 & 0.025\n  \\end{bmatrix}$\n  - $r_f = 0.03$\n\nYour program should produce a single line of output containing the results for all cases as a comma-separated list enclosed in square brackets, for example $[\\,x_1, x_2, x_3, x_4\\,]$, where each $x_i$ is the computed cost rounded to six digits after the decimal point. Only this single line must be printed.", "solution": "The problem as stated is valid. It is scientifically grounded in the established Markowitz mean-variance optimization framework, is mathematically well-posed, and all necessary data and constraints are provided. We may proceed with a formal solution.\n\nThe problem requires the computation of the cost associated with imposing a no-short-selling constraint on a Markowitz tangency portfolio. This cost is defined as the difference in the maximum achievable Sharpe ratios between the unconstrained and constrained optimization problems. We shall analyze each optimization problem sequentially to construct the solution.\n\nLet $\\boldsymbol{\\mu} \\in \\mathbb{R}^n$ be the vector of expected returns, $r_f$ be the risk-free rate, and $\\boldsymbol{\\Sigma} \\in \\mathbb{R}^{n \\times n}$ be the symmetric, positive definite covariance matrix of $n$ risky assets. The vector of excess returns over the risk-free rate is denoted by $\\boldsymbol{\\mu}_e = \\boldsymbol{\\mu} - r_f\\boldsymbol{1}$, where $\\boldsymbol{1}$ is the vector of ones. The Sharpe ratio for a portfolio with weights $\\boldsymbol{w} \\in \\mathbb{R}^n$ is given by:\n$$\nS(\\boldsymbol{w}) = \\frac{\\boldsymbol{\\mu}^\\top \\boldsymbol{w} - r_f}{\\sqrt{\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}}} = \\frac{\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w}}{\\sqrt{\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}}}.\n$$\nThe problem is to find the portfolio weights $\\boldsymbol{w}$ that maximize $S(\\boldsymbol{w})$ under different sets of constraints.\n\nFirst, we address the unconstrained tangency portfolio. The optimization problem is to maximize $S(\\boldsymbol{w})$ subject to the budget constraint $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$. A key property of the Sharpe ratio is its invariance to positive scaling of the weights $\\boldsymbol{w}$. This allows a reformulation of the problem that is more amenable to solution. Maximizing $S(\\boldsymbol{w})$ is equivalent to minimizing the portfolio variance, $\\frac{1}{2}\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}$, subject to a fixed level of portfolio excess return, for instance, $\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w} = 1$. The budget constraint $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$ is not needed to find the maximum Sharpe ratio itself, but to determine the specific weights of the tangency portfolio, which can be found by scaling the solution of the simplified problem. The Lagrangian for this simplified problem is $\\mathcal{L}(\\boldsymbol{w}, \\lambda) = \\frac{1}{2}\\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w} - \\lambda(\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w} - 1)$. The first-order condition $\\nabla_{\\boldsymbol{w}}\\mathcal{L} = \\boldsymbol{\\Sigma}\\boldsymbol{w} - \\lambda\\boldsymbol{\\mu}_e = \\boldsymbol{0}$ implies $\\boldsymbol{w} = \\lambda \\boldsymbol{\\Sigma}^{-1}\\boldsymbol{\\mu}_e$. Substituting this into the constraint $\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w} = 1$ gives $\\lambda = (\\boldsymbol{\\mu}_e^\\top \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_e)^{-1}$. The portfolio solving this sub-problem has variance $\\tilde{\\boldsymbol{w}}^\\top \\boldsymbol{\\Sigma} \\tilde{\\boldsymbol{w}} = (\\boldsymbol{\\mu}_e^\\top \\boldsymbol{\\Sigma}^{-1}\\boldsymbol{\\mu}_e)^{-1}$. The Sharpe ratio $S = (\\boldsymbol{\\mu}_e^\\top \\tilde{\\boldsymbol{w}}) / \\sqrt{\\tilde{\\boldsymbol{w}}^\\top \\boldsymbol{\\Sigma} \\tilde{\\boldsymbol{w}}} = 1 / \\sqrt{(\\boldsymbol{\\mu}_e^\\top \\boldsymbol{\\Sigma}^{-1}\\boldsymbol{\\mu}_e)^{-1}}$. Thus, the maximal Sharpe ratio for the unconstrained case is given by the analytical formula:\n$$\nS_{\\text{unconstrained}}^\\star = \\sqrt{\\boldsymbol{\\mu}_e^\\top \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_e} = \\sqrt{(\\boldsymbol{\\mu} - r_f\\boldsymbol{1})^\\top \\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\mu} - r_f\\boldsymbol{1})}.\n$$\n\nNext, we address the no-short-selling constrained tangency portfolio. The optimization problem adds the constraint $\\boldsymbol{w} \\succeq \\boldsymbol{0}$ (component-wise non-negativity). The problem is to maximize $S(\\boldsymbol{w})$ subject to $\\boldsymbol{1}^\\top \\boldsymbol{w} = 1$ and $\\boldsymbol{w} \\succeq \\boldsymbol{0}$. Using the same scale-invariance principle, this problem can be transformed into a quadratic program (QP). We minimize the variance for a fixed level of excess return, while respecting the non-negativity constraint. The QP is formulated as follows:\n$$\n\\begin{aligned}\n& \\underset{\\boldsymbol{w} \\in \\mathbb{R}^n}{\\text{minimize}}\n& & \\frac{1}{2} \\boldsymbol{w}^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w} \\\\\n& \\text{subject to}\n& & \\boldsymbol{\\mu}_e^\\top \\boldsymbol{w} = 1 \\\\\n& & & \\boldsymbol{w} \\succeq \\boldsymbol{0}.\n\\end{aligned}\n$$\nThis is a convex optimization problem, as the objective function is convex (since $\\boldsymbol{\\Sigma}$ is positive definite) and the constraints are linear. It does not have a general analytical solution and must be solved numerically. Let $\\boldsymbol{w}_c^\\star$ be the optimal weight vector that solves this QP. The minimal variance achieved under these constraints is $(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star$. The corresponding maximum Sharpe ratio is derived from the objective value: $S = (\\boldsymbol{\\mu}_e^\\top \\boldsymbol{w}_c^\\star) / \\sqrt{(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star} = 1 / \\sqrt{(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star}$. Therefore, the maximum Sharpe ratio for the constrained case is:\n$$\nS_{\\text{constrained}}^\\star = \\frac{1}{\\sqrt{(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star}}.\n$$\n\nFinally, the cost of the no-short-selling constraint is computed as the non-negative difference between the two maximal Sharpe ratios:\n$$\n\\text{cost} = S_{\\text{unconstrained}}^\\star - S_{\\text{constrained}}^\\star.\n$$\nThe computational algorithm for each test case is:\n$1$. Construct the excess return vector $\\boldsymbol{\\mu}_e = \\boldsymbol{\\mu} - r_f\\boldsymbol{1}$.\n$2$. Compute the inverse of the covariance matrix, $\\boldsymbol{\\Sigma}^{-1}$.\n$3$. Calculate $S_{\\text{unconstrained}}^\\star$ using the analytical formula derived above.\n$4$. Solve the quadratic program numerically to find the optimal weights $\\boldsymbol{w}_c^\\star$ for the constrained problem.\n$5$. From the solution $\\boldsymbol{w}_c^\\star$, calculate the corresponding portfolio variance $(\\boldsymbol{w}_c^\\star)^\\top \\boldsymbol{\\Sigma} \\boldsymbol{w}_c^\\star$ and subsequently find $S_{\\text{constrained}}^\\star$.\n$6$. Compute the cost and round the result to the specified precision of six decimal places.\nThis procedure will be implemented for each provided test case.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Computes the cost of the no-short-selling constraint for a series of\n    Markowitz portfolio optimization problems.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: mu, Sigma, rf\n        (np.array([0.12, 0.10, 0.07]),\n         np.array([[0.040, 0.006, 0.004],\n                   [0.006, 0.0225, 0.0025],\n                   [0.004, 0.0025, 0.010]]),\n         0.03),\n        # Case 2: mu, Sigma, rf\n        (np.array([0.14, 0.08, 0.06]),\n         np.array([[0.050, 0.010, 0.008],\n                   [0.010, 0.040, 0.012],\n                   [0.008, 0.012, 0.030]]),\n         0.03),\n        # Case 3: mu, Sigma, rf\n        (np.array([0.11, 0.13, 0.09, 0.07]),\n         np.array([[0.030, 0.012, 0.006, -0.003],\n                   [0.012, 0.050, 0.009, 0.000],\n                   [0.006, 0.009, 0.020, 0.004],\n                   [-0.003, 0.000, 0.004, 0.015]]),\n         0.02),\n        # Case 4: mu, Sigma, rf\n        (np.array([0.09, 0.07]),\n         np.array([[0.015, 0.006],\n                   [0.006, 0.025]]),\n         0.03)\n    ]\n\n    results = []\n    for mu, Sigma, rf in test_cases:\n        n = len(mu)\n        mu_e = mu - rf\n\n        # 1. Unconstrained Tangency Portfolio Sharpe Ratio\n        Sigma_inv = np.linalg.inv(Sigma)\n        # S_unconstrained^2 = mu_e.T * Sigma_inv * mu_e\n        s_unconstrained_sq = mu_e.T @ Sigma_inv @ mu_e\n        s_unconstrained = np.sqrt(s_unconstrained_sq)\n\n        # 2. Constrained (No-Short-Selling) Tangency Portfolio Sharpe Ratio\n        # We solve the QP: min 0.5 * w.T * Sigma * w, s.t. mu_e.T * w = 1 and w >= 0\n        \n        # Objective function to minimize\n        def objective_func(w, S):\n            return 0.5 * w.T @ S @ w\n\n        # Equality constraint: mu_e.T * w - 1 = 0\n        cons = ({'type': 'eq',\n                 'fun': lambda w, me: me.T @ w - 1,\n                 'args': (mu_e,)})\n        \n        # Bounds for weights: w_i >= 0 for all i\n        bnds = tuple((0, None) for _ in range(n))\n        \n        # Initial guess: a feasible point satisfying constraints.\n        # An equal weight portfolio is scaled to meet the equality constraint.\n        w0_init = np.ones(n) / n\n        w0 = w0_init / (mu_e.T @ w0_init)\n\n        # Solve the Quadratic Program using SLSQP\n        qp_result = minimize(objective_func, w0, args=(Sigma,), method='SLSQP',\n                             bounds=bnds, constraints=cons)\n        \n        # w_c_star is the solution to the QP\n        w_c_star = qp_result.x\n        \n        # The minimized variance is w_c_star.T * Sigma * w_c_star = 2 * qp_result.fun\n        # S_constrained = 1 / sqrt(variance)\n        variance_constrained = w_c_star.T @ Sigma @ w_c_star\n        s_constrained = 1 / np.sqrt(variance_constrained)\n        \n        # 3. Cost of the no-short-selling constraint\n        cost = s_unconstrained - s_constrained\n        results.append(cost)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"}]}